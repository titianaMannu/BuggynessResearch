{"sha":"07d94cb0638ff1c1d1ef7cc3b11c49290b82e428","node_id":"MDQ6QmxvYjIwNjM2NDowN2Q5NGNiMDYzOGZmMWMxZDFlZjdjYzNiMTFjNDkyOTBiODJlNDI4","size":9967,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/07d94cb0638ff1c1d1ef7cc3b11c49290b82e428","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmRh\ndGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKCi8qKgogKiBEZWZhdWx0IHtAbGluayBQ\nQ0RhdGF9IGltcGxlbWVudGF0aW9uLgogKgogKiBAYXV0aG9yIFBhdHJpY2sg\nTGluc2tleQogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAq\nLwpwdWJsaWMgY2xhc3MgUENEYXRhSW1wbAogICAgZXh0ZW5kcyBBYnN0cmFj\ndFBDRGF0YSB7CgogICAgcHJpdmF0ZSBmaW5hbCBPYmplY3QgX29pZDsKICAg\nIHByaXZhdGUgZmluYWwgQ2xhc3M8Pz4gX3R5cGU7CiAgICBwcml2YXRlIGZp\nbmFsIFN0cmluZyBfY2FjaGU7CiAgICBwcml2YXRlIGZpbmFsIE9iamVjdFtd\nIF9kYXRhOwogICAgcHJpdmF0ZSBmaW5hbCBCaXRTZXQgX2xvYWRlZDsKICAg\nIHByaXZhdGUgT2JqZWN0IF92ZXJzaW9uID0gbnVsbDsKICAgIHByaXZhdGUg\nT2JqZWN0IF9pbXBsID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0W10gX2Zp\nZWxkSW1wbCA9IG51bGw7CgogICAgcHVibGljIFBDRGF0YUltcGwoT2JqZWN0\nIG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgdGhpcyhvaWQs\nIG1ldGEsIERhdGFDYWNoZS5OQU1FX0RFRkFVTFQpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMg\nUENEYXRhSW1wbChPYmplY3Qgb2lkLCBDbGFzc01ldGFEYXRhIG1ldGEsIFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgX29pZCA9IG9pZDsKICAgICAgICBfdHlw\nZSA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgIF9jYWNoZSA9\nIG5hbWU7CgogICAgICAgIGludCBsZW4gPSBtZXRhLmdldEZpZWxkcygpLmxl\nbmd0aDsKICAgICAgICBfZGF0YSA9IG5ldyBPYmplY3RbbGVuXTsKICAgICAg\nICBfbG9hZGVkID0gbmV3IEJpdFNldChsZW4pOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0SWQoKSB7CiAgICAgICAgcmV0dXJuIF9vaWQ7CiAgICB9\nCgogICAgcHVibGljIENsYXNzPD8+IGdldFR5cGUoKSB7CiAgICAgICAgcmV0\ndXJuIF90eXBlOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0TG9hZGVk\nKCkgewogICAgICAgIHJldHVybiBfbG9hZGVkOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0RGF0YShpbnQgaW5kZXgpIHsKICAgICAgICAvLyBtYWtl\nIHN1cmUgaW5kZXggaXMgYWN0dWFsbHkgbG9hZGVkIHRvIGF2b2lkIHJldHVy\nbmluZyBhbgogICAgICAgIC8vIGludGVybWVkaWF0ZSB2YWx1ZQogICAgICAg\nIHJldHVybiAoX2xvYWRlZC5nZXQoaW5kZXgpKSA/IF9kYXRhW2luZGV4XSA6\nIG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGF0YShpbnQgaW5k\nZXgsIE9iamVjdCB2YWwpIHsKICAgICAgICBfbG9hZGVkLnNldChpbmRleCk7\nCiAgICAgICAgX2RhdGFbaW5kZXhdID0gdmFsOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNsZWFyRGF0YShpbnQgaW5kZXgpIHsKICAgICAgICBfbG9hZGVk\nLmNsZWFyKGluZGV4KTsKICAgICAgICBfZGF0YVtpbmRleF0gPSBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SW1wbERhdGEoKSB7CiAgICAg\nICAgcmV0dXJuIF9pbXBsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldElt\ncGxEYXRhKE9iamVjdCB2YWwpIHsKICAgICAgICBfaW1wbCA9IHZhbDsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEltcGxEYXRhKGludCBpbmRleCkg\newogICAgICAgIHJldHVybiAoX2ZpZWxkSW1wbCAhPSBudWxsKSA/IF9maWVs\nZEltcGxbaW5kZXhdIDogbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRJbXBsRGF0YShpbnQgaW5kZXgsIE9iamVjdCB2YWwpIHsKICAgICAgICBp\nZiAodmFsICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9maWVsZEltcGwg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9maWVsZEltcGwgPSBuZXcgT2Jq\nZWN0W19kYXRhLmxlbmd0aF07CiAgICAgICAgICAgIF9maWVsZEltcGxbaW5k\nZXhdID0gdmFsOwogICAgICAgIH0gZWxzZSBpZiAoX2ZpZWxkSW1wbCAhPSBu\ndWxsKQogICAgICAgICAgICBfZmllbGRJbXBsW2luZGV4XSA9IG51bGw7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBnZXRJbnRlcm1lZGlhdGUoaW50IGlu\nZGV4KSB7CiAgICAgICAgcmV0dXJuICghX2xvYWRlZC5nZXQoaW5kZXgpKSA/\nIF9kYXRhW2luZGV4XSA6IG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0SW50ZXJtZWRpYXRlKGludCBpbmRleCwgT2JqZWN0IHZhbCkgewogICAg\nICAgIF9sb2FkZWQuY2xlYXIoaW5kZXgpOwogICAgICAgIF9kYXRhW2luZGV4\nXSA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0xvYWRlZChp\nbnQgaW5kZXgpIHsKICAgICAgICByZXR1cm4gX2xvYWRlZC5nZXQoaW5kZXgp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExvYWRlZChpbnQgaW5kZXgs\nIGJvb2xlYW4gbG9hZGVkKSB7CiAgICAgICAgaWYgKGxvYWRlZCkKICAgICAg\nICAgICAgX2xvYWRlZC5zZXQoaW5kZXgpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX2xvYWRlZC5jbGVhcihpbmRleCk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRWZXJzaW9uKCkgewogICAgICAgIHJldHVybiBfdmVyc2lv\nbjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRWZXJzaW9uKE9iamVjdCB2\nZXJzaW9uKSB7CiAgICAgICAgX3ZlcnNpb24gPSB2ZXJzaW9uOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIE9iamVjdCBjb250\nZXh0KSB7CiAgICAgICAgbG9hZFZlcnNpb24oc20pOwogICAgICAgIGxvYWRJ\nbXBsRGF0YShzbSk7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICAoKFN0YXRl\nTWFuYWdlckltcGwpc20pLnNldExvYWRpbmcodHJ1ZSk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIC8vIGxvYWQgaW50ZXJtZWRpYXRlIGRhdGEgZm9yIGFsbCB1bmxvYWRl\nZCBmaWVsZHMgYW5kIGRhdGEgZm9yCiAgICAgICAgICAgIC8vIGZpZWxkcyBp\nbiBjb25maWd1cmVkIGZldGNoIGdyb3VwcwogICAgICAgICAgICBpZiAoIWlz\nTG9hZGVkKGkpKQogICAgICAgICAgICAgICAgbG9hZEludGVybWVkaWF0ZShz\nbSwgZm1kc1tpXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKCFzbS5nZXRMb2Fk\nZWQoKS5nZXQoaSkgJiYgZmV0Y2gucmVxdWlyZXNGZXRjaChmbWRzW2ldKSAK\nICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJhdGlvbi5GRVRDSF9O\nT05FKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKHNtLCBmbWRzW2ldLCBm\nZXRjaCwgY29udGV4dCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxk\ncywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgbG9hZFZlcnNpb24oc20pOwogICAgICAgIGxv\nYWRJbXBsRGF0YShzbSk7CgogICAgICAgIC8vIGF0dGVtcHQgdG8gbG9hZCBn\naXZlbiBmaWVsZHMKICAgICAgICBpbnQgbGVuID0gKGZpZWxkcyA9PSBudWxs\nKSA/IDAgOiBmaWVsZHMubGVuZ3RoKCk7CiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykg\newogICAgICAgICAgICBpZiAoIWZpZWxkcy5nZXQoaSkpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGZtZCA9IHNtLmdldE1ldGFE\nYXRhKCkuZ2V0RmllbGQoaSk7CiAgICAgICAgICAgIGlmICghaXNMb2FkZWQo\naSkpCiAgICAgICAgICAgICAgICBsb2FkSW50ZXJtZWRpYXRlKHNtLCBmbWQp\nOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGxvYWRGaWVs\nZChzbSwgZm1kLCBmZXRjaCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICBs\nb2FkSW1wbERhdGEoc20sIGZtZCk7CiAgICAgICAgICAgICAgICBmaWVsZHMu\nY2xlYXIoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdmVyc2lvbiBpbmZvcm1hdGlvbiBpbnRvIHRoZSBn\naXZlbiBzdGF0ZSBtYW5hZ2VyLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBsb2FkVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAg\nICAgaWYgKHNtLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAgICAgICAgICBz\nbS5zZXRWZXJzaW9uKGdldFZlcnNpb24oKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgaW1wbCBkYXRhIGluZm9ybWF0aW9uIGludG8gdGhlIGdpdmVu\nIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGxv\nYWRJbXBsRGF0YShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAg\nT2JqZWN0IGltcGwgPSBnZXRJbXBsRGF0YSgpOwogICAgICAgIGlmIChzbS5n\nZXRJbXBsRGF0YSgpID09IG51bGwgJiYgaW1wbCAhPSBudWxsKQogICAgICAg\nICAgICBzbS5zZXRJbXBsRGF0YShpbXBsLCB0cnVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCBmaWVsZC1sZXZlbCBpbmZvcm1hdGlvbiBpbnRvIHRo\nZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBsb2FkRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRN\nZXRhRGF0YSBmbWQsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIGludCBpbmRleCA9IGZtZC5n\nZXRJbmRleCgpOwogICAgICAgIE9iamVjdCB2YWwgPSB0b0ZpZWxkKHNtLCBm\nbWQsIGdldERhdGEoaW5kZXgpLCBmZXRjaCwgY29udGV4dCk7CiAgICAgICAg\nc20uc3RvcmVGaWVsZChpbmRleCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCBmaWVsZC1sZXZlbCBpbXBsIGRhdGEgaW50byB0aGUgZ2l2ZW4g\nc3RhdGUgbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgbG9h\nZEltcGxEYXRhKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgaW50IGluZGV4ID0gZm1kLmdldEluZGV4KCk7\nCiAgICAgICAgT2JqZWN0IGltcGwgPSBnZXRJbXBsRGF0YShpbmRleCk7CiAg\nICAgICAgaWYgKGltcGwgIT0gbnVsbCkKICAgICAgICAgICAgc20uc2V0SW1w\nbERhdGEoaW5kZXgsIGltcGwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIGludGVybWVkaWF0ZSBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIGZpZWxk\nIGludG8gdGhlIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGxvYWRJbnRlcm1lZGlhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpbnQgaW5kZXggPSBm\nbWQuZ2V0SW5kZXgoKTsKICAgICAgICBPYmplY3QgaW50ZXIgPSBnZXRJbnRl\ncm1lZGlhdGUoaW5kZXgpOwogICAgICAgIGlmIChpbnRlciAhPSBudWxsICYm\nICFzbS5nZXRMb2FkZWQoKS5nZXQoaW5kZXgpKQogICAgICAgICAgICBzbS5z\nZXRJbnRlcm1lZGlhdGUoaW5kZXgsIGludGVyKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdG9yZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAg\nICAgc3RvcmVWZXJzaW9uKHNtKTsKICAgICAgICBzdG9yZUltcGxEYXRhKHNt\nKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBzbS5nZXRNZXRh\nRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoc20uZ2V0\nTG9hZGVkKCkuZ2V0KGkpKSB7CiAgICAgICAgICAgICAgICBzdG9yZUZpZWxk\nKHNtLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIHN0b3JlSW1wbERhdGEo\nc20sIGZtZHNbaV0sIGlzTG9hZGVkKGkpKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmICghaXNMb2FkZWQoaSkpCiAgICAgICAgICAgICAgICBzdG9yZUludGVy\nbWVkaWF0ZShzbSwgZm1kc1tpXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0b3JlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNl\ndCBmaWVsZHMpIHsKICAgICAgICBzdG9yZVZlcnNpb24oc20pOwogICAgICAg\nIHN0b3JlSW1wbERhdGEoc20pOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChmaWVsZHMgIT0gbnVsbCAmJiBmaWVsZHMuZ2V0KGkpKSB7\nCiAgICAgICAgICAgICAgICBzdG9yZUZpZWxkKHNtLCBmbWRzW2ldKTsKICAg\nICAgICAgICAgICAgIHN0b3JlSW1wbERhdGEoc20sIGZtZHNbaV0sIGlzTG9h\nZGVkKGkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmICghaXNMb2FkZWQoaSkp\nCiAgICAgICAgICAgICAgICBzdG9yZUludGVybWVkaWF0ZShzbSwgZm1kc1tp\nXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdmVy\nc2lvbiBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2Vy\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9yZVZlcnNpb24oT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIHNldFZlcnNpb24oc20u\nZ2V0VmVyc2lvbigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGlt\ncGwgZGF0YSBmcm9tIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9yZUltcGxEYXRhKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20pIHsKICAgICAgICBpZiAoc20uaXNJbXBsRGF0YUNhY2hl\nYWJsZSgpKQogICAgICAgICAgICBzZXRJbXBsRGF0YShzbS5nZXRJbXBsRGF0\nYSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGZpZWxkLWxldmVs\nIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHN0b3JlRmllbGQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBp\nZiAoZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBmbWQuTUFOQUdFX1BFUlNJU1RF\nTlQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaW50IGluZGV4ID0g\nZm1kLmdldEluZGV4KCk7CiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBk\nc20gPSBudWxsOwogICAgICAgIGlmIChzbS5nZXRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKS5wY0lzRGV0YWNoZWQoKSkgewogICAgICAgICAgICBkc20gPSAoRGV0\nYWNoZWRTdGF0ZU1hbmFnZXIpIHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nLgogICAgICAgICAgICAgICAgcGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAg\nICAgICAgc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkucGNSZXBsYWNlU3Rh\ndGVNYW5hZ2VyKHNtKTsKICAgICAgICB9CgogICAgICAgIE9iamVjdCB2YWwg\nPSB0b0RhdGEoZm1kLCBzbS5mZXRjaEZpZWxkKGluZGV4LCBmYWxzZSksCiAg\nICAgICAgICAgIHNtLmdldENvbnRleHQoKSk7CiAgICAgICAgaWYgKGRzbSAh\nPSBudWxsKQogICAgICAgICAgICBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUo\nKS5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIoZHNtKTsKICAgICAgICBpZiAodmFs\nICE9IE5VTEwpCiAgICAgICAgICAgIHNldERhdGEoaW5kZXgsIHZhbCk7CiAg\nICAgICAgZWxzZSAvLyB1bmFibGUgdG8gc3RvcmUgZmllbGQgdmFsdWU7IGNs\nZWFyIG91dCBhbnkgb2xkIHZhbHVlcwogICAgICAgICAgICBjbGVhckRhdGEo\naW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIGludGVy\nbWVkaWF0ZSBmaWVsZCB2YWx1ZSBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9yZUludGVybWVkaWF0ZShPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgaW50IGluZGV4ID0gZm1kLmdldEluZGV4KCk7CiAgICAg\nICAgT2JqZWN0IHZhbCA9IHNtLmdldEludGVybWVkaWF0ZShpbmRleCk7CiAg\nICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICBzZXRJbnRlcm1l\nZGlhdGUoaW5kZXgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9y\nZSBpbXBsIGRhdGEgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc3RvcmVJbXBsRGF0YShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBib29sZWFuIGZp\nZWxkTG9hZGVkKSB7CiAgICAgICAgaW50IGluZGV4ID0gZm1kLmdldEluZGV4\nKCk7CiAgICAgICAgaWYgKGZpZWxkTG9hZGVkKSB7CiAgICAgICAgICAgIC8v\nIGlzIHRoZXJlIGltcGwgZGF0YSB0byBzdG9yZT8KICAgICAgICAgICAgT2Jq\nZWN0IGltcGwgPSBzbS5nZXRJbXBsRGF0YShpbmRleCk7CiAgICAgICAgICAg\nIGlmIChpbXBsICE9IG51bGwgJiYgc20uaXNJbXBsRGF0YUNhY2hlYWJsZShp\nbmRleCkpCiAgICAgICAgICAgICAgICBzZXRJbXBsRGF0YShpbmRleCwgaW1w\nbCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHNldEltcGxEYXRhKGlu\nZGV4LCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5l\ndyB7QGxpbmsgUENEYXRhfSBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgcmlnaHQg\ndHlwZSBmb3IKICAgICAqIGVtYmVkZGVkIGluc3RhbmNlcy4gUmV0dXJucyBh\nIHtAbGluayBQQ0RhdGFJbXBsfSBieSBkZWZhdWx0LgogICAgICovCiAgICBw\ndWJsaWMgQWJzdHJhY3RQQ0RhdGEgbmV3RW1iZWRkZWRQQ0RhdGEoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIHJldHVybiBuZXcgUENEYXRh\nSW1wbChzbS5nZXRJZCAoKSwgc20uZ2V0TWV0YURhdGEgKCksIF9jYWNoZSk7\nCgl9CgogICAgcHVibGljIFN0cmluZyBnZXRDYWNoZSgpIHsKICAgICAgICBy\nZXR1cm4gX2NhY2hlOwogICAgfQp9Cg==\n","encoding":"base64"}

