{"sha":"a62eaa22fa6e58300153fa4c0e32f7ea4812fa24","node_id":"MDQ6QmxvYjIwNjM2NDphNjJlYWEyMmZhNmU1ODMwMDE1M2ZhNGMwZTMyZjdlYTQ4MTJmYTI0","size":114823,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a62eaa22fa6e58300153fa4c0e32f7ea4812fa24","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk5vdFNlcmlhbGl6\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJl\nYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEu\naW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5TZXJpYWxp\nemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRp\nbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5U\naW1lWm9uZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmxvY2tzLlJl\nZW50cmFudExvY2s7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkR5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5GaWVsZE1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5NYW5hZ2VkSW5zdGFuY2VQ\ncm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBD\nUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5Q\nZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWRlZmluaXRpb25IZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFjY2Vzc0NvZGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hHcm91cDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5VcGRhdGVTdHJhdGVnaWVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2ll\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9u\nSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0aW9u\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRT\ndGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuUHJveHlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3I7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQg\nc2VycC51dGlsLk51bWJlcnM7CgovKioKICogSW1wbGVtZW50YXRpb24gb2Yg\ndGhlIHtAbGluayBPcGVuSlBBU3RhdGVNYW5hZ2VyfSBpbnRlcmZhY2UgZm9y\nIHVzZQogKiB3aXRoIHRoaXMgcnVudGltZS4gRWFjaCBzdGF0ZSBtYW5hZ2Vy\nIG1hbmFnZXMgdGhlIHN0YXRlIG9mIGEgc2luZ2xlCiAqIHBlcnNpc3RlbmNl\nIGNhcGFibGUgaW5zdGFuY2UuIFRoZSBzdGF0ZSBtYW5hZ2VyIGlzIGFsc28g\ncmVzcG9uc2libGUgZm9yCiAqIGFsbCBjb21tdW5pY2F0aW9ucyBhYm91dCB0\naGUgaW5zdGFuY2UgdG8gdGhlIHtAbGluayBTdG9yZU1hbmFnZXJ9LgogKiAg\nVGhlIHN0YXRlIG1hbmFnZXIgdXNlcyB0aGUgU3RhdGUgcGF0dGVybiBpbiBi\nb3RoIGl0cyBpbnRlcmFjdGlvbiB3aXRoCiAqIHRoZSBnb3Zlcm5lZCBpbnN0\nYW5jZSBhbmQgaXRzIGludGVyYWN0aW9uIHdpdGggdGhlIGJyb2tlci4KICog\nSW4gaXRzIGludGVyYWN0aW9ucyB3aXRoIHRoZSBwZXJzaXN0ZW5jZSBjYXBh\nYmxlIGluc3RhbmNlLCBpdCB1c2VzIHRoZQogKiB7QGxpbmsgRmllbGRNYW5h\nZ2VyfSBpbnRlcmZhY2UuIFNpbWlsYXJseSwgd2hlbiBpbnRlcmFjdGluZyB3\naXRoIHRoZQogKiBicm9rZXIsIGl0IHVzZXMgdGhlIHtAbGluayBQQ1N0YXRl\nfSBzaW5nbGV0b24gdGhhdCByZXByZXNlbnRzCiAqIHRoZSBjdXJyZW50IGxp\nZmVjeWNsZSBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UuCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgU3RhdGVNYW5hZ2VySW1wbAog\nICAgaW1wbGVtZW50cyBPcGVuSlBBU3RhdGVNYW5hZ2VyLCBTZXJpYWxpemFi\nbGUgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IExPQURfRkdTID0g\nMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IExPQURfQUxMID0gMTsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IExPQURfU0VSSUFMSVpFID0g\nMjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TQVZFID0g\nMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfREVS\nRUYgPSAyIDw8IDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19MT0FERUQgPSAyIDw8IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19SRUFEX0xPQ0tFRCA9IDIgPDwgMzsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBGTEFHX1dSSVRFX0xPQ0tFRCA9IDIgPDwgNDsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX09JRF9BU1NJR05FRCA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0xP\nQURJTkcgPSAyIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQg\nRkxBR19QUkVfREVMRVRJTkcgPSAyIDw8IDc7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19GTFVTSEVEID0gMiA8PCA4OwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUFJFX0ZMVVNIRUQgPSAyIDw8IDk7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSEVEX0RJ\nUlRZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX0lNUExfQ0FDSEUgPSAyIDw8IDExOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfSU5WRVJTRVMgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfTk9fVU5QUk9YWSA9IDIgPDwgMTM7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19WRVJTSU9OX0NI\nRUNLID0gMiA8PCAxNDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1ZFUlNJT05fVVBEQVRFID0gMiA8PCAxNTsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBGTEFHX0RFVEFDSElORyA9IDIgPDwgMTY7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19FTUJFRF9ERVJFRiA9IDIg\nPDwgMTc7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9s\nb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChTdGF0ZU1hbmFn\nZXJJbXBsLmNsYXNzKTsKCiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCB0aGUg\naW5zdGFuY2UKICAgIHByaXZhdGUgdHJhbnNpZW50IFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBfcGMgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ2xhc3NN\nZXRhRGF0YSBfbWV0YSA9IG51bGw7CiAgICBwcml2YXRlIEJpdFNldCBfbG9h\nZGVkID0gbnVsbDsKICAgIHByaXZhdGUgQml0U2V0IF9kaXJ0eSA9IG51bGw7\nCiAgICBwcml2YXRlIEJpdFNldCBfZmx1c2ggPSBudWxsOwogICAgcHJpdmF0\nZSBpbnQgX2ZsYWdzID0gMDsKCiAgICAvLyBpZCBpcyB0aGUgc3RhdGUgbWFu\nYWdlciBpZGVudGl0eTsgb2lkIGlzIHRoZSBwZXJzaXN0ZW50IGlkZW50aXR5\nLiAgb2lkCiAgICAvLyBtYXkgYmUgbnVsbCBmb3IgZW1iZWRkZWQgYW5kIHRy\nYW5zaWVudC10cmFuc2FjdGlvbmFsIG9iamVjdHMgb3IgbmV3CiAgICAvLyBp\nbnN0YW5jZXMgdGhhdCBoYXZlbid0IGJlZW4gYXNzaWduZWQgYW4gb2lkLiAg\naWQgaXMgcmVhc3NpZ25lZCB0byBvaWQKICAgIC8vIG9uIHN1Y2Nlc3NmdWwg\nb2lkIGFzc2lnbm1lbnQgKG9yIGZsdXNoIGNvbXBsZXRpb24gaWYgYXNzaWdu\nbWVudCBpcwogICAgLy8gZHVyaW5nIGZsdXNoKQogICAgcHJpdmF0ZSBPYmpl\nY3QgX2lkID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0IF9vaWQgPSBudWxs\nOwoKICAgIC8vIHRoZSBtYW5hZ2luZyBwZXJzaXN0ZW5jZSBtYW5hZ2VyIGFu\nZCBsaWZlY3ljbGUgc3RhdGUKICAgIHByaXZhdGUgdHJhbnNpZW50IEJyb2tl\nckltcGwgX2Jyb2tlcjsgLy8gdGhpcyBpcyBzZXJpYWxpemVkIHNwZWNpYWxs\neQogICAgcHJpdmF0ZSBQQ1N0YXRlIF9zdGF0ZSA9IFBDU3RhdGUuVFJBTlNJ\nRU5UOwoKICAgIC8vIHRoZSBjdXJyZW50IGFuZCBsYXN0IGxvYWRlZCB2ZXJz\naW9uIGluZGljYXRvcnMsIGFuZCB0aGUgbG9jayBvYmplY3QKICAgIHByaXZh\ndGUgT2JqZWN0IF92ZXJzaW9uID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0\nIF9sb2FkVmVyc2lvbiA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfbG9j\nayA9IG51bGw7CiAgICBwcml2YXRlIGludCBfcmVhZExvY2tMZXZlbCA9IC0x\nOwogICAgcHJpdmF0ZSBpbnQgX3dyaXRlTG9ja0xldmVsID0gLTE7CgogICAg\nLy8gZGVsZWdhdGVzIHdoZW4gcHJvdmlkaW5nL3JlcGxhY2luZyBpbnN0YW5j\nZSBkYXRhCiAgICBwcml2YXRlIFNpbmdsZUZpZWxkTWFuYWdlciBfc2luZ2xl\nID0gbnVsbDsKICAgIHByaXZhdGUgU2F2ZUZpZWxkTWFuYWdlciBfc2F2ZWQg\nPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1hbmFnZXIgX2ZtID0gbnVsbDsK\nCiAgICAvLyBpbXBsZGF0YTsgZmllbGQgaW1wbGRhdGEgYW5kIGludGVybWVk\naWF0ZSBkYXRhIHNoYXJlIHRoZSBzYW1lIGFycmF5CiAgICBwcml2YXRlIE9i\namVjdCBfaW1wbCA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdFtdIF9maWVs\nZEltcGwgPSBudWxsOwoKICAgIC8vIGluZm9ybWF0aW9uIGFib3V0IHRoZSBv\nd25lciBvZiB0aGlzIGluc3RhbmNlLCBpZiBpdCBpcyBlbWJlZGRlZAogICAg\ncHJpdmF0ZSBTdGF0ZU1hbmFnZXJJbXBsIF9vd25lciA9IG51bGw7CiAgICAv\nLyBmb3IgZW1iZWRkYWJsZSBvYmplY3QgZnJvbSBxdWVyeSByZXN1bHQKICAg\nIHByaXZhdGUgT2JqZWN0IF9vd25lcklkID0gbnVsbDsKICAgIHByaXZhdGUg\naW50IF9vd25lckluZGV4ID0gLTE7CiAgICBwcml2YXRlIExpc3Q8RmllbGRN\nZXRhRGF0YT4gX21hcHBlZEJ5SWRGaWVsZHMgPSBudWxsOwogICAgCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBSZWVudHJhbnRMb2NrIF9pbnN0YW5jZUxvY2sg\nPSBudWxsOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3I7IHN1cHBseSBp\nZCwgdHlwZSBtZXRhZGF0YSwgYW5kIG93bmluZyBwZXJzaXN0ZW5jZSBtYW5h\nZ2VyLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbChP\nYmplY3QgaWQsIENsYXNzTWV0YURhdGEgbWV0YSwgCiAgICAgICAgQnJva2Vy\nSW1wbCBicm9rZXIpIHsKICAgICAgICBfaWQgPSBpZDsKICAgICAgICBfbWV0\nYSA9IG1ldGE7CiAgICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAgICBf\nc2luZ2xlID0gbmV3IFNpbmdsZUZpZWxkTWFuYWdlcih0aGlzLCBicm9rZXIp\nOwogICAgICAgIGlmIChicm9rZXIuZ2V0TXVsdGl0aHJlYWRlZCgpKQogICAg\nICAgIAlfaW5zdGFuY2VMb2NrID0gbmV3IFJlZW50cmFudExvY2soKTsKCiAg\nICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0\nYURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgX21ldGEpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBTdGF0ZU1hbmFn\nZXIgaW5zdGFuY2UgYmFzZWQgb24gdGhlIFN0YXRlTWFuYWdlciBwcm92aWRl\nZC4gQQogICAgICogbmV3IFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZSB3\naWxsIGJlIGNyZWF0ZWQgYW5kIGFzc29jaWF0ZWQgd2l0aCB0aGUKICAgICAq\nIG5ldyBTdGF0ZU1hbmFnZXIuIEFsbCBmaWVsZHMgd2lsbCBiZSBjb3BpZWQg\naW50byB0aGUgbmUgUEMgaW5zdGFuY2UgYXMKICAgICAqIHdlbGwgYXMgdGhl\nIGRpcnR5LCBsb2FkZWQsIGFuZCBmbHVzaGVkIGJpdHNldHMuCiAgICAgKiAK\nICAgICAqIEBwYXJhbSBzbSBBIHN0YXRlbWFuYWdlciBpbnN0YW5jZSB3aGlj\naCB3aWxsIGVmZmVjdGl2ZWx5IGJlIGNsb25lZC4KICAgICAqLwogICAgcHVi\nbGljIFN0YXRlTWFuYWdlckltcGwoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewog\nICAgICAgIHRoaXMoc20sIHNtLmdldFBDU3RhdGUoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgU3RhdGVNYW5hZ2VyIGluc3RhbmNl\nLCBvcHRpb25hbGx5IG92ZXJyaWRpbmcgdGhlIHN0YXRlCiAgICAgKiAoRkxV\nU0hFRCwgREVMRVRFRCwgZXRjKSBvZiB0aGUgdW5kZXJseWluZyBQZXJzaXN0\nZW5jZUNhcGFibGUgaW5zdGFuY2UpLgogICAgICogCiAgICAgKiBAcGFyYW0g\nc20KICAgICAqICAgICAgICAgICAgQSBzdGF0ZW1hbmFnZXIgaW5zdGFuY2Ug\nd2hpY2ggd2lsbCBlZmZlY3RpdmVseSBiZSBjbG9uZWQuCiAgICAgKiBAcGFy\nYW0gbmV3U3RhdGUKICAgICAqICAgICAgICAgICAgVGhlIG5ldyBzdGF0ZSBv\nZiB0aGUgdW5kZXJseWluZyBwZXJzaXN0ZW5jZSBjYXBhYmxlIG9iamVjdC4K\nICAgICAqLwogICAgcHVibGljIFN0YXRlTWFuYWdlckltcGwoU3RhdGVNYW5h\nZ2VySW1wbCBzbSwgUENTdGF0ZSBuZXdTdGF0ZSkgeyAKICAgICAgICB0aGlz\nKHNtLmdldElkKCksIHNtLmdldE1ldGFEYXRhKCksIHNtLmdldEJyb2tlcigp\nKTsKCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIG9yaWdQQyA9IHNtLmdl\ndFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIF9wYyA9IG9yaWdQQy5w\nY05ld0luc3RhbmNlKHNtLCBmYWxzZSk7CiAgICAgICAgCiAgICAgICAgaW50\nW10gZmllbGRzID0gbmV3IGludFtzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxk\ncygpLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVs\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZmllbGRzW2ldID0gaTsK\nICAgICAgICB9CiAgICAgICAgX3BjLnBjQ29weUZpZWxkcyhvcmlnUEMsIGZp\nZWxkcyk7CiAgICAgICAgX3BjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcih0aGlz\nKTsKICAgICAgICBfc3RhdGUgPSBuZXdTdGF0ZTsKCiAgICAgICAgLy8gY2xv\nbmUgdGhlIGZpZWxkIGJpdHNldHMuIAogICAgICAgIF9kaXJ0eT0oQml0U2V0\nKXNtLmdldERpcnR5KCkuY2xvbmUoKTsKICAgICAgICBfbG9hZGVkID0gKEJp\ndFNldClzbS5nZXRMb2FkZWQoKS5jbG9uZSgpOwogICAgICAgIF9mbHVzaCA9\nIChCaXRTZXQpIHNtLmdldEZsdXNoZWQoKS5jbG9uZSgpOwogICAgICAgIF92\nZXJzaW9uID0gc20uZ2V0VmVyc2lvbigpOwogICAgICAgIAogICAgICAgIF9v\naWQgPSBzbS5nZXRPYmplY3RJZCgpOyAKICAgICAgICBfaWQgPSBzbS5nZXRJ\nZCgpOwogICAgICAgIAogICAgICAgIC8vIG1vcmUgZGF0YSBtYXkgbmVlZCB0\nbyBiZSBjb3BpZWQuIAogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBv\nd25pbmcgc3RhdGUgYW5kIGZpZWxkIGlmIHRoaXMgaXMgYW4gZW1iZWRkZWQg\naW5zdGFuY2UuCiAgICAgKi8KICAgIHZvaWQgc2V0T3duZXIoU3RhdGVNYW5h\nZ2VySW1wbCBvd25lciwgVmFsdWVNZXRhRGF0YSBvd25lck1ldGEpIHsKICAg\nICAgICBfb3duZXIgPSBvd25lcjsKICAgICAgICBfb3duZXJJbmRleCA9IG93\nbmVyTWV0YS5nZXRGaWVsZE1ldGFEYXRhKCkuZ2V0SW5kZXgoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBzdGF0ZSBtYW5hZ2VyIGlz\nIGluIHRoZSBtaWRkbGUgb2YgYSBsb2FkLgogICAgICovCiAgICBib29sZWFu\nIGlzTG9hZGluZygpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdf\nTE9BRElORykgPiAwOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0\naGlzIHN0YXRlIG1hbmFnZXIgaXMgaW4gdGhlIG1pZGRsZSBvZiBhIGxvYWQg\naW5pdGlhdGVkCiAgICAgKiBieSBvdXRzaWRlIGNvZGU7IGZvciBhbnkgaW50\nZXJuYWwgbWV0aG9kcyB0aGF0IGNhdXNlIGxvYWRpbmcsIHRoZQogICAgICog\nbG9hZGluZyBmbGFnIGlzIHNldCBhdXRvbWF0aWNhbGx5LgogICAgICovCiAg\nICB2b2lkIHNldExvYWRpbmcoYm9vbGVhbiBsb2FkaW5nKSB7CiAgICAgICAg\naWYgKGxvYWRpbmcpCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0xPQURJ\nTkc7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nTE9BRElORzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBvciByZXNldCB0\naGUgbGlmZWN5Y2xlIHN0YXRlIG9mIHRoZSBtYW5hZ2VkIGluc3RhbmNlLiBJ\nZiB0aGUKICAgICAqIHRyYW5zYWN0aW9uYWwgc3RhdGUgb2YgdGhlIGluc3Rh\nbmNlIGNoYW5nZXMsIGl0IHdpbGwgYmUgZW5saXN0ZWQvCiAgICAgKiBkZWxp\nc3RlZCBmcm9tIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uIGFzIG5lY2Vzc2Fy\neS4gVGhlIGdpdmVuCiAgICAgKiBzdGF0ZSB3aWxsIGJlIGluaXRpYWxpemVk\nIGFmdGVyIGJlaW5nIHNldC4gSWYgdGhlIGdpdmVuIHN0YXRlCiAgICAgKiBp\ncyB0aGUgc2FtZSBhcyB0aGUgY3VycmVudCBzdGF0ZSwgdGhpcyBtZXRob2Qg\nd2lsbCBoYXZlIG5vIGVmZmVjdC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHNldFBDU3RhdGUoUENTdGF0ZSBzdGF0ZSkgewogICAgICAgIGlmIChfc3Rh\ndGUgPT0gc3RhdGUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIG5vdGlmeSB0aGUg\nc3RvcmUgbWFuYWdlciB0aGF0IHdlJ3JlIGNoYW5naW5nIHN0YXRlczsgY2Fu\nIHZldG8KICAgICAgICAgICAgX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5i\nZWZvcmVTdGF0ZUNoYW5nZSh0aGlzLCBfc3RhdGUsIHN0YXRlKTsKCiAgICAg\nICAgICAgIC8vIHJlcGxhY2Ugc3RhdGUKICAgICAgICAgICAgYm9vbGVhbiB3\nYXNEZWxldGVkID0gX3N0YXRlLmlzRGVsZXRlZCgpOwogICAgICAgICAgICBi\nb29sZWFuIHdhc0RpcnR5ID0gX3N0YXRlLmlzRGlydHkoKTsKICAgICAgICAg\nICAgYm9vbGVhbiB3YXNQZW5kaW5nID0gX3N0YXRlLmlzUGVuZGluZ1RyYW5z\nYWN0aW9uYWwoKTsKICAgICAgICAgICAgX3N0YXRlID0gc3RhdGU7CgogICAg\nICAgICAgICAvLyBlbmxpc3QvZGVsaXN0IGZyb20gdHJhbnNhY3Rpb24KICAg\nICAgICAgICAgaWYgKF9zdGF0ZS5pc1RyYW5zYWN0aW9uYWwoKSkgewogICAg\nICAgICAgICAgICAgX2Jyb2tlci5hZGRUb1RyYW5zYWN0aW9uKHRoaXMpOwog\nICAgICAgICAgICAgICAgaWYgKF9zdGF0ZS5pc0RlbGV0ZWQoKSAhPSB3YXNE\nZWxldGVkKQogICAgICAgICAgICAgICAgICAgIF9icm9rZXIuc2V0RGlydHko\ndGhpcywgIXdhc0RpcnR5IHx8IGlzRmx1c2hlZCgpKTsKICAgICAgICAgICAg\nICAgIGVsc2UgaWYgKF9zdGF0ZS5pc0RpcnR5KCkgJiYgIXdhc0RpcnR5KQog\nICAgICAgICAgICAgICAgICAgIF9icm9rZXIuc2V0RGlydHkodGhpcywgdHJ1\nZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXdhc1BlbmRpbmcgJiYgX3N0\nYXRlLmlzUGVuZGluZ1RyYW5zYWN0aW9uYWwoKSkKICAgICAgICAgICAgICAg\nIF9icm9rZXIuYWRkVG9QZW5kaW5nVHJhbnNhY3Rpb24odGhpcyk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKHdhc1BlbmRpbmcgJiYgIV9zdGF0ZS5pc1BlbmRp\nbmdUcmFuc2FjdGlvbmFsKCkpCiAgICAgICAgICAgICAgICBfYnJva2VyLnJl\nbW92ZUZyb21QZW5kaW5nVHJhbnNhY3Rpb24odGhpcyk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIF9icm9rZXIucmVtb3ZlRnJvbVRyYW5z\nYWN0aW9uKHRoaXMpOwoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZQogICAg\nICAgICAgICBfc3RhdGUuaW5pdGlhbGl6ZSh0aGlzKTsKICAgICAgICAgICAg\naWYgKF9zdGF0ZS5pc0RlbGV0ZWQoKSAmJiAhd2FzRGVsZXRlZCkKICAgICAg\nICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5B\nRlRFUl9ERUxFVEUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gT3BlbkpQQVN0YXRl\nTWFuYWdlciBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBpbml0aWFs\naXplKENsYXNzIGNscywgUENTdGF0ZSBzdGF0ZSkgewogICAgICAgIC8vIGNo\nZWNrIHRvIHNlZSBpZiBvdXIgY3VycmVudCBvYmplY3QgaWQgaW5zdGFuY2Ug\naXMgdGhlCiAgICAgICAgLy8gY29ycmVjdCBpZCB0eXBlIGZvciB0aGUgc3Bl\nY2lmaWVkIGNsYXNzOyB0aGlzIGlzIGZvciBjYXNlcwogICAgICAgIC8vIHdo\nZW4gd2UgaGF2ZSBhbiBhcHBsaWNhdGlvbiBpZCBoaWVyYXJjaHkgYW5kIHdl\nIGhhZCBzZXQgdGhlCiAgICAgICAgLy8gbWV0YWRhdGEgdG8gYSBzdXBlcmNs\nYXNzIGlkIC0tIHRoZSBzdWJjbGFzcycgaWQgbWF5IGJlIGEKICAgICAgICAv\nLyBkaWZmZXJlbnQgY2xhc3MsIHNvIHdlIG5lZWQgdG8gcmVzZXQgaXQKICAg\nICAgICBpZiAoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpICE9IGNscykgewog\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1YiA9IF9tZXRhLmdldFJlcG9z\naXRvcnkoKS5nZXRNZXRhRGF0YQogICAgICAgICAgICAgICAgKGNscywgX2Jy\nb2tlci5nZXRDbGFzc0xvYWRlcigpLCB0cnVlKTsKICAgICAgICAgICAgaWYg\nKF9vaWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9tZXRhLmdl\ndElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JF\nKQogICAgICAgICAgICAgICAgICAgIF9vaWQgPSBfYnJva2VyLmdldFN0b3Jl\nTWFuYWdlcigpLmNvcHlEYXRhU3RvcmVJZChfb2lkLAogICAgICAgICAgICAg\nICAgICAgICAgICBzdWIpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoX21l\ndGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkKICAgICAgICAgICAgICAgICAgICBf\nb2lkID0gQXBwbGljYXRpb25JZHMuY29weShfb2lkLCBzdWIpOwogICAgICAg\nICAgICAgICAgZWxzZSBpZiAoc3ViLmdldE9iamVjdElkVHlwZSgpICE9IF9t\nZXRhLmdldE9iamVjdElkVHlwZSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nT2JqZWN0W10gcGtGaWVsZHMgPSBBcHBsaWNhdGlvbklkcy50b1BLVmFsdWVz\nKF9vaWQsIF9tZXRhKTsKICAgICAgICAgICAgICAgICAgICBfb2lkID0gQXBw\nbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKHBrRmllbGRzLCBzdWIpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9tZXRh\nID0gc3ViOwogICAgICAgIH0KCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxl\nIGluc3QgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKGNscywgdGhpcywgX29p\nZCwgdHJ1ZSk7CiAgICAgICAgaWYgKGluc3QgPT0gbnVsbCkgewogICAgICAg\nICAgICAvLyB0aGUgaW5zdGFuY2Ugd2FzIG51bGw6IGNoZWNrIHRvIHNlZSBp\nZiB0aGUgaW5zdGFuY2UgaXMKICAgICAgICAgICAgLy8gYWJzdHJhY3QgKGFz\nIGNhbiBzb21ldGltZXMgYmUgdGhlIGNhc2Ugd2hlbiB0aGUKICAgICAgICAg\nICAgLy8gY2xhc3MgZGlzY3JpbWluYXRvciBzdHJhdGVneSBpcyBub3QgY29u\nZmlndXJlZCBjb3JyZWN0bHkpCiAgICAgICAgICAgIGlmIChNb2RpZmllci5p\nc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaW5zdGFudGlh\ndGUtYWJzdHJhY3QiLAogICAgICAgICAgICAgICAgICAgIGNscy5nZXROYW1l\nKCksIF9vaWQpKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBpbml0aWFsaXplKGluc3Qs\nIHN0YXRlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgd2l0\naCB0aGUgZ2l2ZW4gaW5zdGFuY2UgYW5kIHN0YXRlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgUENTdGF0ZSBzdGF0ZSkgewogICAgICAgIGlmIChwYyA9PSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\naW5pdC1udWxsLXBjIiwgX21ldGEpKTsKICAgICAgICBpZiAocGMucGNHZXRT\ndGF0ZU1hbmFnZXIoKSAhPSBudWxsICYmIHBjLnBjR2V0U3RhdGVNYW5hZ2Vy\nKCkgIT0gdGhpcykKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoImluaXQtc20tcGMiLAogICAgICAgICAgICAgICAgRXhj\nZXB0aW9ucy50b1N0cmluZyhwYykpKS5zZXRGYWlsZWRPYmplY3QocGMpOwog\nICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcih0aGlzKTsKCiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsK\nICAgICAgICBfbG9hZGVkID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAg\nICAgICAgX2ZsdXNoID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAgICAg\nICAgX2RpcnR5ID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CgogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAvLyBtYXJrIHByaW1hcnkga2V5IGFuZCBub24tcGVyc2lzdGVu\ndCBmaWVsZHMgYXMgbG9hZGVkCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmlz\nUHJpbWFyeUtleSgpCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldE1h\nbmFnZW1lbnQoKSAhPSBmbWRzW2ldLk1BTkFHRV9QRVJTSVNURU5UKQogICAg\nICAgICAgICAgICAgX2xvYWRlZC5zZXQoaSk7CiAgICAgICAgICAgIAogICAg\nICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nZXRhRGF0YS5JRF9BUFBMSUNBVElPTikgewogICAgICAgICAgICAgICAgU3Ry\naW5nIG1hcHBlZEJ5SWRWYWx1ZSA9IGZtZHNbaV0uZ2V0TWFwcGVkQnlJZFZh\nbHVlKCk7IAogICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5SWRWYWx1ZSAh\nPSBudWxsKSB7IAogICAgICAgICAgICAgICAgICAgIGlmICghQXBwbGljYXRp\nb25JZHMuaXNJZFNldChfaWQsIF9tZXRhLCBtYXBwZWRCeUlkVmFsdWUpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfbWFwcGVkQnlJZEZpZWxk\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX21hcHBl\nZEJ5SWRGaWVsZHMgPSBuZXcgQXJyYXlMaXN0PEZpZWxkTWV0YURhdGE+KCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9tYXBwZWRCeUlkRmllbGRzLmFk\nZChmbWRzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmVjb3JkIHdo\nZXRoZXIgdGhlcmUgYXJlIGFueSBtYW5hZ2VkIGludmVyc2UgZmllbGRzCiAg\nICAgICAgICAgIGlmIChfYnJva2VyLmdldEludmVyc2VNYW5hZ2VyKCkgIT0g\nbnVsbAogICAgICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXRJbnZlcnNlTWV0\nYURhdGFzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIF9mbGFncyB8\nPSBGTEFHX0lOVkVSU0VTOwogICAgICAgIH0KCiAgICAgICAgcGMucGNTZXRE\nZXRhY2hlZFN0YXRlKG51bGwpOwogICAgICAgIF9wYyA9IHBjOwoKICAgICAg\nICBpZiAoX29pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAgICAgICAgICAg\nKChPcGVuSlBBSWQpIF9vaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKCiAgICAgICAgLy8gaW5pdGlhbGl6\nZSBvdXIgc3RhdGUgYW5kIGFkZCBvdXJzZWx2ZXMgdG8gdGhlIGJyb2tlcidz\nIGNhY2hlCiAgICAgICAgc2V0UENTdGF0ZShzdGF0ZSk7CiAgICAgICAgaWYg\nKCBfb2lkID09IG51bGwgfHwgIAogICAgICAgICAgICBfYnJva2VyLmdldFN0\nYXRlTWFuYWdlckltcGxCeUlkKF9vaWQsIGZhbHNlKSA9PSBudWxsKSB7CiAg\nICAgICAgCV9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKF9pZCwgdGhpcywgQnJv\na2VySW1wbC5TVEFUVVNfSU5JVCk7CiAgICAgICAgfQogICAgICAgIGlmIChz\ndGF0ZSA9PSBQQ1N0YXRlLlBORVcpCiAgICAgICAgICAgIGZpcmVMaWZlY3lj\nbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9QRVJTSVNUKTsKCiAgICAg\nICAgLy8gaWYgdGhpcyBpcyBhIG5vbi10cmFja2luZyBQQywgYWRkIGEgaGFy\nZCByZWYgdG8gdGhlIGFwcHJvcHJpYXRlIGRhdGEKICAgICAgICAvLyBzZXRz\nIGFuZCBnaXZlIGl0IGFuIG9wcG9ydHVuaXR5IHRvIG1ha2UgYSBzdGF0ZSBz\nbmFwc2hvdC4KICAgICAgICBpZiAoIWlzSW50ZXJjZXB0aW5nKCkpIHsKICAg\nICAgICAgICAgc2F2ZUZpZWxkcyh0cnVlKTsKICAgICAgICAgICAgaWYgKCFp\nc05ldygpKQogICAgICAgICAgICAgICAgUmVkZWZpbml0aW9uSGVscGVyLmFz\nc2lnbkxhenlMb2FkUHJveGllcyh0aGlzKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCBkYXRhIGFjY2VzcyBpbiB0\naGlzIGluc3RhbmNlIGlzIGludGVyY2VwdGVkLiBUaGlzIGRpZmZlcnMKICAg\nICAqIGZyb20ge0BsaW5rIENsYXNzTWV0YURhdGEjaXNJbnRlcmNlcHRpbmco\nKX0gaW4gdGhhdCBpdCBjaGVja3MgZm9yCiAgICAgKiBwcm9wZXJ0eSBhY2Nl\nc3MgKyBzdWJjbGFzc2luZyBpbiBhZGRpdGlvbiB0byB0aGUgcmVkZWZpbml0\naW9uIC8KICAgICAqIGVuaGFuY2VtZW50IGNoZWNrcy4KICAgICAqCiAgICAg\nKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNJ\nbnRlcmNlcHRpbmcoKSB7CiAgICAgICAgaWYgKGdldE1ldGFEYXRhKCkuaXNJ\nbnRlcmNlcHRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgLy8gVE9ETzpKUkIgSW50ZXJjZXB0aW5nIAogICAgICAgIGlmIChBY2Nl\nc3NDb2RlLmlzUHJvcGVydHkoZ2V0TWV0YURhdGEoKS5nZXRBY2Nlc3NUeXBl\nKCkpCiAgICAgICAgICAgICYmIF9wYyBpbnN0YW5jZW9mIER5bmFtaWNQZXJz\naXN0ZW5jZUNhcGFibGUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUg\ndGhlIGdpdmVuIGxpZmVjeWNsZSBldmVudCB0byBhbGwgbGlzdGVuZXJzLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZmlyZUxpZmVjeWNsZUV2ZW50\nKGludCB0eXBlKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gTGlmZWN5Y2xlRXZl\nbnQuQUZURVJfUEVSU0lTVAogICAgICAgICAgICAgICAgJiYgX2Jyb2tlci5n\nZXRDb25maWd1cmF0aW9uKCkuZ2V0Q2FsbGJhY2tPcHRpb25zSW5zdGFuY2Uo\nKS5nZXRQb3N0UGVyc2lzdENhbGxiYWNrSW1tZWRpYXRlKCkpIHsKICAgICAg\nICAgICAgZmV0Y2hPYmplY3RJZCgpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2Jyb2tlci5maXJlTGlmZWN5Y2xlRXZlbnQoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCksIG51bGwsIF9tZXRhLCB0eXBlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBsb2FkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIGxvYWQoZmV0Y2gsIExPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBzdGF0ZSBvZiB0aGlzIGlu\nc3RhbmNlIGJhc2VkIG9uIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1cmF0aW9u\nCiAgICAgKiBhbmQgbG9hZCBtb2RlLiBSZXR1cm4gdHJ1ZSBpZiBhbnkgZGF0\nYSB3YXMgbG9hZGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBib29sZWFuIGxvYWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBpbnQgbG9hZE1vZGUsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUsIE9iamVj\ndCBzZGF0YSwgYm9vbGVhbiBmb3JXcml0ZSkgewogICAgICAgIGlmICghZm9y\nV3JpdGUKICAgICAgICAgICAgJiYgKCFpc1BlcnNpc3RlbnQoKSB8fCAoaXNO\nZXcoKSAmJiAhaXNGbHVzaGVkKCkpIHx8IGlzRGVsZXRlZCgpKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBpZiBhbnkgZmllbGRz\nIGJlaW5nIGxvYWRlZCwgZG8gc3RhdGUgdHJhbnNpdGlvbnMgZm9yIHJlYWQK\nICAgICAgICBCaXRTZXQgZmllbGRzID0gZ2V0VW5sb2FkZWRJbnRlcm5hbChm\nZXRjaCwgbG9hZE1vZGUsIGV4Y2x1ZGUpOwogICAgICAgIGJvb2xlYW4gYWN0\naXZlID0gX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAgICAgIGlmICghZm9yV3Jp\ndGUgJiYgZmllbGRzICE9IG51bGwpCiAgICAgICAgICAgIGJlZm9yZVJlYWQo\nLTEpOwoKICAgICAgICAvLyBjYWxsIGxvYWQgZXZlbiBpZiBubyBmaWVsZHMg\nYXJlIGJlaW5nIGxvYWRlZCwgYmVjYXVzZSBpdCB0YWtlcwogICAgICAgIC8v\nIGNhcmUgb2YgY2hlY2tpbmcgaWYgdGhlIERGRyBpcyBsb2FkZWQsIG1ha2lu\nZyBzdXJlIHZlcnNpb24gaW5mbwogICAgICAgIC8vIGlzIGxvYWRlZCwgZXRj\nCiAgICAgICAgaW50IGxvY2tMZXZlbCA9IGNhbGN1bGF0ZUxvY2tMZXZlbChh\nY3RpdmUsIGZvcldyaXRlLCBmZXRjaCk7CiAgICAgICAgYm9vbGVhbiByZXQg\nPSBsb2FkRmllbGRzKGZpZWxkcywgZmV0Y2gsIGxvY2tMZXZlbCwgc2RhdGEp\nOwogICAgICAgIG9idGFpbkxvY2tzKGFjdGl2ZSwgZm9yV3JpdGUsIGxvY2tM\nZXZlbCwgZmV0Y2gsIHNkYXRhKTsKICAgICAgICByZXR1cm4gcmV0OwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0TWFuYWdlZEluc3RhbmNlKCkgewog\nICAgICAgIGlmIChfcGMgaW5zdGFuY2VvZiBNYW5hZ2VkSW5zdGFuY2VQcm92\naWRlcikKICAgICAgICAgICAgcmV0dXJuICgoTWFuYWdlZEluc3RhbmNlUHJv\ndmlkZXIpIF9wYykuZ2V0TWFuYWdlZEluc3RhbmNlKCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICByZXR1cm4gX3BjOwogICAgfQoKICAgIHB1YmxpYyBQ\nZXJzaXN0ZW5jZUNhcGFibGUgZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkgewog\nICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAgcHVibGljIENsYXNzTWV0\nYURhdGEgZ2V0TWV0YURhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9tZXRhOwog\nICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGdldE93bmVy\nKCkgewogICAgICAgIHJldHVybiBfb3duZXI7CiAgICB9CgogICAgcHVibGlj\nIGludCBnZXRPd25lckluZGV4KCkgewogICAgICAgIHJldHVybiBfb3duZXJJ\nbmRleDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRPd25lcihPYmplY3Qg\nb2lkKSB7CiAgICAgICAgX293bmVySWQgPSBvaWQ7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNFbWJlZGRlZCgpIHsKICAgICAgICAvLyBfb3duZXIg\nbWF5IG5vdCBiZSBzZXQgaWYgZW1iZWQgb2JqZWN0IGlzIGZyb20gcXVlcnkg\ncmVzdWx0CiAgICAgICAgcmV0dXJuIF9vd25lciAhPSBudWxsIHx8IF9zdGF0\nZSBpbnN0YW5jZW9mIEVOb25UcmFuc1N0YXRlOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzRmx1c2hlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFn\ncyAmIEZMQUdfRkxVU0hFRCkgPiAwOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzRmx1c2hlZERpcnR5KCkgewogICAgICAgIHJldHVybiAoX2ZsYWdz\nICYgRkxBR19GTFVTSEVEX0RJUlRZKSA+IDA7CiAgICB9CgogICAgcHVibGlj\nIEJpdFNldCBnZXRMb2FkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZWQ7\nCiAgICB9CgogICAgcHVibGljIEJpdFNldCBnZXRGbHVzaGVkKCkgewogICAg\nICAgIHJldHVybiBfZmx1c2g7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBn\nZXREaXJ0eSgpIHsKICAgICAgICByZXR1cm4gX2RpcnR5OwogICAgfQoKICAg\nIHB1YmxpYyBCaXRTZXQgZ2V0VW5sb2FkZWQoRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgLy8gY29sbGVjdCBmaWVsZHMgdG8gbG9hZCBm\ncm9tIGRhdGEgc3RvcmUgYmFzZWQgb24gZmV0Y2ggY29uZmlndXJhdGlvbgog\nICAgICAgIEJpdFNldCBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZl\ndGNoLCBMT0FEX0ZHUywgbnVsbCk7CiAgICAgICAgcmV0dXJuIChmaWVsZHMg\nPT0gbnVsbCkgPyBuZXcgQml0U2V0KDApIDogZmllbGRzOwogICAgfQoKICAg\nIC8qKgogICAgICogSW50ZXJuYWwgdmVyc2lvbiBvZiB7QGxpbmsgT3BlbkpQ\nQVN0YXRlTWFuYWdlciNnZXRVbmxvYWRlZH0gdGhhdCBhdm9pZHMKICAgICAq\nIGNyZWF0aW5nIGFuIGVtcHR5IGJpdCBzZXQgYnkgcmV0dXJuaW5nIG51bGwg\nd2hlbiB0aGVyZSBhcmUgbm8gdW5sb2FkZWQKICAgICAqIGZpZWxkcy4KICAg\nICAqLwogICAgcHJpdmF0ZSBCaXRTZXQgZ2V0VW5sb2FkZWRJbnRlcm5hbChG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBtb2RlLAogICAgICAgIEJp\ndFNldCBleGNsdWRlKSB7CiAgICAgICAgaWYgKGV4Y2x1ZGUgPT0gU3RvcmVD\nb250ZXh0LkVYQ0xVREVfQUxMKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgQml0U2V0IGZpZWxkcyA9IG51bGw7CiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBi\nb29sZWFuIGxvYWQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChp\nKSB8fCAoZXhjbHVkZSAhPSBudWxsICYmIGV4Y2x1ZGUuZ2V0KGkpKSkKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgc3dpdGNoICht\nb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNlIExPQURfU0VSSUFMSVpFOgog\nICAgICAgICAgICAgICAgICAgIGxvYWQgPSAhZm1kc1tpXS5pc1RyYW5zaWVu\ndCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBMT0FEX0ZHUzoKICAgICAgICAgICAgICAgICAgICBsb2FkID0g\nZmV0Y2ggPT0gbnVsbCB8fCBmZXRjaC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0p\nIAogICAgICAgICAgICAgICAgICAgICAgICAhPSBGZXRjaENvbmZpZ3VyYXRp\nb24uRkVUQ0hfTk9ORTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGRlZmF1bHQ6IC8vIExPQURfQUxMCiAgICAgICAgICAg\nICAgICAgICAgbG9hZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChsb2FkKSB7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRzID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEJpdFNl\ndChmbWRzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmaWVsZHMuc2V0KGkp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmaWVs\nZHM7CiAgICB9CgogICAgcHVibGljIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0\nKCkgewogICAgICAgIHJldHVybiBfYnJva2VyOwogICAgfQoKICAgIC8qKgog\nICAgICogTWFuYWdpbmcgYnJva2VyLgogICAgICovCiAgICBCcm9rZXJJbXBs\nIGdldEJyb2tlcigpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlcjsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGdldElkKCkgewogICAgICAgIHJldHVybiBf\naWQ7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRPYmplY3RJZCgpIHsK\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gdGhpczsKICAgICAgICB3\naGlsZSAoc20uZ2V0T3duZXIoKSAhPSBudWxsKQogICAgICAgICAgICBzbSA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBzbS5nZXRPd25lcigpOwogICAgICAgIGlm\nIChzbS5pc0VtYmVkZGVkKCkgJiYgc20uZ2V0T3duZXIoKSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gc20uX293bmVySWQ7CiAgICAgICAgcmV0dXJu\nIHNtLl9vaWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T2JqZWN0SWQo\nT2JqZWN0IG9pZCkgewogICAgICAgIF9vaWQgPSBvaWQ7CiAgICAgICAgaWYg\nKF9wYyAhPSBudWxsICYmIG9pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAg\nICAgICAgICAgKChPcGVuSlBBSWQpIG9pZCkuc2V0TWFuYWdlZEluc3RhbmNl\nVHlwZShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgfQoKICAgIHB1\nYmxpYyBTdGF0ZU1hbmFnZXJJbXBsIGdldE9iamVjdElkT3duZXIoKSB7CiAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IHRoaXM7CiAgICAgICAgd2hp\nbGUgKHNtLmdldE93bmVyKCkgIT0gbnVsbCkKICAgICAgICAgICAgc20gPSAo\nU3RhdGVNYW5hZ2VySW1wbCkgc20uZ2V0T3duZXIoKTsKICAgICAgICByZXR1\ncm4gc207CiAgICB9CiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25PYmplY3RJ\nZChib29sZWFuIGZsdXNoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJZChmbHVzaCwg\nZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFzayBzdG9y\nZSBtYW5hZ2VyIHRvIGFzc2lnbiBvdXIgb2lkLCBvcHRpb25hbGx5IGZsdXNo\naW5nIGFuZAogICAgICogb3B0aW9uYWxseSByZWNhY2hpbmcgb24gdGhlIG5l\ndyBvaWQuCiAgICAgKi8KICAgIGJvb2xlYW4gYXNzaWduT2JqZWN0SWQoYm9v\nbGVhbiBmbHVzaCwgYm9vbGVhbiBwcmVGbHVzaGluZykgewogICAgICAgIGlm\nIChfb2lkICE9IG51bGwgfHwgaXNFbWJlZGRlZCgpIHx8ICFpc1BlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIGlmIChf\nYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmFzc2lnbk9iamVjdElkKHRoaXMs\nIHByZUZsdXNoaW5nKSkgewogICAgICAgICAgICBpZiAoIXByZUZsdXNoaW5n\nKQogICAgICAgICAgICAgICAgYXNzZXJ0T2JqZWN0SWRBc3NpZ25lZCh0cnVl\nKTsKICAgICAgICB9IGVsc2UgaWYgKGZsdXNoKQogICAgICAgICAgICBfYnJv\na2VyLmZsdXNoKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYWtlIHN1cmUgd2Ugd2VyZSBhc3NpZ25lZCBhbiBvaWQsIGFuZCBw\nZXJmb3JtIGFjdGlvbnMgdG8gbWFrZSBpdAogICAgICogcGVybWFuZW50Lgog\nICAgICoKICAgICAqIEBwYXJhbSByZWNhY2hlIHdoZXRoZXIgdG8gcmVjYWNo\nZSBvdXJzZWxmIG9uIHRoZSBuZXcgb2lkCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKGJvb2xlYW4gcmVjYWNoZSkg\newogICAgICAgIGlmICghaXNOZXcoKSB8fCBpc0RlbGV0ZWQoKSB8fCBpc1By\nb3Zpc2lvbmFsKCkgCiAgICAgICAgICAgIHx8IChfZmxhZ3MgJiBGTEFHX09J\nRF9BU1NJR05FRCkgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIGlmIChfb2lkID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9tZXRhLmdl\ndElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JF\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKEV4Y2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAgICAgICAgICAoZ2V0\nTWFuYWdlZEluc3RhbmNlKCkpKTsKICAgICAgICAgICAgX29pZCA9IEFwcGxp\nY2F0aW9uSWRzLmNyZWF0ZShfcGMsIF9tZXRhKTsKICAgICAgICB9CgogICAg\nICAgIE9iamVjdCBvcmlnID0gX2lkOwogICAgICAgIF9pZCA9IF9vaWQ7CiAg\nICAgICAgaWYgKHJlY2FjaGUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIF9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKG9yaWcsIHRoaXMs\nCiAgICAgICAgICAgICAgICAgICAgQnJva2VySW1wbC5TVEFUVVNfT0lEX0FT\nU0lHTik7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgICAgIF9pZCA9IG9yaWc7CiAgICAgICAgICAg\nICAgICBfb2lkID0gbnVsbDsKICAgICAgICAgICAgICAgIHRocm93IHJlOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9mbGFncyB8PSBGTEFH\nX09JRF9BU1NJR05FRDsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiB0\naGUgcHJvcGVyIGdlbmVyYXRlZCB2YWx1ZSB0byB0aGUgZ2l2ZW4gZmllbGQg\nYmFzZWQgb24gaXRzCiAgICAgKiB2YWx1ZS1zdHJhdGVneS4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGFzc2lnbkZpZWxkKGludCBmaWVsZCwgYm9v\nbGVhbiBwcmVGbHVzaGluZykgewogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20gPSB0aGlzOwogICAgICAgIHdoaWxlIChzbSAhPSBudWxsICYmIHNt\nLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgc20gPSBzbS5nZXRPd25lcigp\nOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgaWYgKCFzbS5pc05ldygpIHx8IHNtLmlzRmx1c2hl\nZCgpIHx8IHNtLmlzRGVsZXRlZCgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIC8vIHNwZWNpYWwtY2FzZSBvaWQgZmllbGRzLCB3aGlj\naCByZXF1aXJlIHVzIHRvIGxvb2sgaW5zaWRlIHRoZSBvaWQKICAgICAgICAv\nLyBvYmplY3QKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKSB7CiAgICAgICAgICAgIC8vIHRy\neSB0byBzaG9ydGN1dCBpZiBwb3NzaWJsZQogICAgICAgICAgICBpZiAoX29p\nZCAhPSBudWxsIHx8IGlzRW1iZWRkZWQoKSB8fCAhaXNQZXJzaXN0ZW50KCkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgICAgIC8v\nIGNoZWNrIGVtYmVkZGVkIGZpZWxkcyBvZiBvaWQgZm9yIHZhbHVlIHN0cmF0\nZWd5ICsgZGVmYXVsdCB2YWx1ZQogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gcGtzID0gZm1kLmdldEVtYmVkZGVkTWV0YURhdGEoKS5nZXRGaWVsZHMo\nKTsKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBvaWRzbSA9IG51\nbGw7CiAgICAgICAgICAgIGJvb2xlYW4gYXNzaWduID0gZmFsc2U7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyAhYXNzaWduICYmIGkgPCBwa3MubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFs\ndWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKG9p\nZHNtID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgb2lkc20gPSBuZXcg\nT2JqZWN0SWRTdGF0ZU1hbmFnZXIoZmV0Y2hPYmplY3RGaWVsZChmaWVsZCks\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMsIGZtZCk7CiAgICAgICAg\nICAgICAgICBhc3NpZ24gPSBvaWRzbS5pc0RlZmF1bHRWYWx1ZShpKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYXNzaWduICYmIGFzc2ln\nbk9iamVjdElkKCFwcmVGbHVzaGluZywgcHJlRmx1c2hpbmcpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gSnVzdCByZXR1cm4gaWYgdGhlcmUncyBubyB2YWx1\nZSBnZW5lcmF0aW9uIHN0cmF0ZWd5CiAgICAgICAgaWYgKGZtZC5nZXRWYWx1\nZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAvLyBUaHJvdyBl\neGNlcHRpb24gaWYgZmllbGQgYWxyZWFkeSBoYXMgYSB2YWx1ZSBhc3NpZ25l\nZC4KICAgICAgICAvLyBAR2VuZXJhdGVkVmFsdWUgb3ZlcnJpZGVzIFBPSk8g\naW5pdGlhbCB2YWx1ZXMgYW5kIHNldHRlciBtZXRob2RzCiAgICAgICAgaWYg\nKCFmbWQuaXNWYWx1ZUdlbmVyYXRlZCgpICYmICFpc0RlZmF1bHRWYWx1ZShm\naWVsZCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoCiAgICAgICAgICAgICAgICAiZXhpc3RpbmctdmFs\ndWUtb3ZlcnJpZGUtZXhjZXAiLCBmbWQuZ2V0RnVsbE5hbWUoZmFsc2UpKSk7\nCgogICAgICAgIC8vIGZvciBwcmltYXJ5IGtleSBmaWVsZHMsIGFzc2lnbiB0\naGUgb2JqZWN0IGlkIGFuZCByZWNhY2hlIHNvIHRoYXQKICAgICAgICAvLyB0\nbyB0aGUgdXNlciwgc28gaXQgbG9va3MgbGlrZSB0aGUgb2lkIGFsd2F5cyBt\nYXRjaGVzIHRoZSBwayBmaWVsZHMKICAgICAgICBpZiAoZm1kLmlzUHJpbWFy\neUtleSgpICYmICFpc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIHJldHVybiBh\nc3NpZ25PYmplY3RJZCghcHJlRmx1c2hpbmcsIHByZUZsdXNoaW5nKTsKCiAg\nICAgICAgLy8gZm9yIG90aGVyIGZpZWxkcyBqdXN0IGFzc2lnbiB0aGUgZmll\nbGQgb3IgZmx1c2ggaWYgbmVlZGVkCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0\nU3RvcmVNYW5hZ2VyKCkuYXNzaWduRmllbGQodGhpcywgZmllbGQsIHByZUZs\ndXNoaW5nKSkgewogICAgICAgICAgICBmbWQuc2V0VmFsdWVHZW5lcmF0ZWQo\ndHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nICAgICBpZiAoIXByZUZsdXNoaW5nKQogICAgICAgICAgICBfYnJva2VyLmZs\ndXNoKCk7CiAgICAgICAgcmV0dXJuICFwcmVGbHVzaGluZzsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGdldExvY2soKSB7CiAgICAgICAgcmV0dXJuIF9s\nb2NrOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExvY2soT2JqZWN0IGxv\nY2spIHsKICAgICAgICBfbG9jayA9IGxvY2s7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRWZXJzaW9uKCkgewogICAgICAgIHJldHVybiBfdmVyc2lv\nbjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRWZXJzaW9uKE9iamVjdCB2\nZXJzaW9uKSB7CiAgICAgICAgX2xvYWRWZXJzaW9uID0gdmVyc2lvbjsKICAg\nICAgICBhc3NpZ25WZXJzaW9uRmllbGQodmVyc2lvbik7CiAgICB9CgogICAg\nT2JqZWN0IGdldExvYWRWZXJzaW9uKCkgewogICAgICAgIHJldHVybiBfbG9h\nZFZlcnNpb247CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TmV4dFZlcnNp\nb24oT2JqZWN0IHZlcnNpb24pIHsKICAgICAgICBhc3NpZ25WZXJzaW9uRmll\nbGQodmVyc2lvbik7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFzc2lnblZl\ncnNpb25GaWVsZChPYmplY3QgdmVyc2lvbikgewogICAgICAgIF92ZXJzaW9u\nID0gdmVyc2lvbjsKICAgICAgICBGaWVsZE1ldGFEYXRhIHZmaWVsZCA9IF9t\nZXRhLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgIGlmICh2ZmllbGQgIT0g\nbnVsbCkKICAgICAgICAgICAgc3RvcmUodmZpZWxkLmdldEluZGV4KCksIEph\ndmFUeXBlcy5jb252ZXJ0KHZlcnNpb24sCiAgICAgICAgICAgICAgICB2Zmll\nbGQuZ2V0VHlwZUNvZGUoKSkpOwogICAgfQoKICAgIHB1YmxpYyBQQ1N0YXRl\nIGdldFBDU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZTsKICAgIH0K\nCiAgICBwdWJsaWMgc3luY2hyb25pemVkIE9iamVjdCBnZXRJbXBsRGF0YSgp\nIHsKICAgICAgICByZXR1cm4gX2ltcGw7CiAgICB9CgogICAgcHVibGljIHN5\nbmNocm9uaXplZCBPYmplY3Qgc2V0SW1wbERhdGEoT2JqZWN0IGRhdGEsIGJv\nb2xlYW4gY2FjaGVhYmxlKSB7CiAgICAgICAgT2JqZWN0IG9sZCA9IF9pbXBs\nOwogICAgICAgIF9pbXBsID0gZGF0YTsKICAgICAgICBpZiAoY2FjaGVhYmxl\nICYmIGRhdGEgIT0gbnVsbCkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nSU1QTF9DQUNIRTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19JTVBMX0NBQ0hFOwogICAgICAgIHJldHVybiBvbGQ7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaXNJbXBsRGF0YUNhY2hlYWJsZSgpIHsK\nICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfSU1QTF9DQUNIRSkgIT0g\nMDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEltcGxEYXRhKGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBnZXRFeHRyYUZpZWxkRGF0YShmaWVs\nZCwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBzZXRJbXBsRGF0\nYShpbnQgZmllbGQsIE9iamVjdCBkYXRhKSB7CiAgICAgICAgcmV0dXJuIHNl\ndEV4dHJhRmllbGREYXRhKGZpZWxkLCBkYXRhLCB0cnVlKTsKICAgIH0KCiAg\nICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gaXNJbXBsRGF0YUNhY2hl\nYWJsZShpbnQgZmllbGQpIHsKICAgICAgICBpZiAoX2ZpZWxkSW1wbCA9PSBu\ndWxsIHx8ICFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBpZiAoX21ldGEuZ2V0RmllbGQoZmllbGQpLnVz\nZXNJbXBsRGF0YSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJ\nbmRleChmaWVsZCk7CiAgICAgICAgcmV0dXJuIGlkeCAhPSAtMSAmJiBfZmll\nbGRJbXBsW2lkeF0gIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldEludGVybWVkaWF0ZShpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4g\nZ2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGZhbHNlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRJbnRlcm1lZGlhdGUoaW50IGZpZWxkLCBPYmplY3Qg\nZGF0YSkgewogICAgICAgIHNldEV4dHJhRmllbGREYXRhKGZpZWxkLCBkYXRh\nLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRh\ndGEgZnJvbSB0aGUgcHJvcGVyIGluZGV4IG9mIHRoZSBleHRyYSBmaWVsZCBk\nYXRhIGFycmF5LgogICAgICovCiAgICBwcml2YXRlIHN5bmNocm9uaXplZCBP\nYmplY3QgZ2V0RXh0cmFGaWVsZERhdGEoaW50IGZpZWxkLCBib29sZWFuIGlz\nTG9hZGVkKSB7CiAgICAgICAgLy8gb25seSByZXR1cm4gdGhlIGZpZWxkIGRh\ndGEgaWYgdGhlIGZpZWxkIGlzIGluIHRoZSByaWdodCBsb2FkZWQKICAgICAg\nICAvLyBzdGF0ZTsgb3RoZXJ3aXNlIHdlIG1pZ2h0IHJldHVybiBpbnRlcm1l\nZGlhdGUgZm9yIGltcGwgZGF0YSBvcgogICAgICAgIC8vIHZpY2UgdmVyc2EK\nICAgICAgICBpZiAoX2ZpZWxkSW1wbCA9PSBudWxsIHx8IF9sb2FkZWQuZ2V0\nKGZpZWxkKSAhPSBpc0xvYWRlZCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5k\nZXgoZmllbGQpOwogICAgICAgIHJldHVybiAoaWR4ID09IC0xKSA/IG51bGwg\nOiBfZmllbGRJbXBsW2lkeF07CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIGRhdGEgZnJvbSB0byBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZp\nZWxkIGRhdGEgYXJyYXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25p\nemVkIE9iamVjdCBzZXRFeHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIE9iamVj\ndCBkYXRhLAogICAgICAgIGJvb2xlYW4gbG9hZGVkKSB7CiAgICAgICAgaW50\nIGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5kZXgoZmllbGQpOwog\nICAgICAgIGlmIChpZHggPT0gLTEpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihfbWV0YS5nZXRGaWVs\nZChmaWVsZCkpKTsKCiAgICAgICAgT2JqZWN0IG9sZCA9IChfZmllbGRJbXBs\nID09IG51bGwpID8gbnVsbCA6IF9maWVsZEltcGxbaWR4XTsKICAgICAgICBp\nZiAoZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNhbm5vdCBzZXQg\naWYgZmllbGQgaW4gd3JvbmcgbG9hZGVkIHN0YXRlCiAgICAgICAgICAgIGlm\nIChfbG9hZGVkLmdldChmaWVsZCkgIT0gbG9hZGVkKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9m\nKF9tZXRhLmdldEZpZWxkCiAgICAgICAgICAgICAgICAgICAgKGZpZWxkKSkp\nOwoKICAgICAgICAgICAgLy8gc2V0IGRhdGEKICAgICAgICAgICAgaWYgKF9m\naWVsZEltcGwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9maWVsZEltcGwg\nPSBuZXcgT2JqZWN0W19tZXRhLmdldEV4dHJhRmllbGREYXRhTGVuZ3RoKCld\nOwogICAgICAgICAgICBfZmllbGRJbXBsW2lkeF0gPSBkYXRhOwogICAgICAg\nIH0gZWxzZSBpZiAoX2ZpZWxkSW1wbCAhPSBudWxsICYmIF9sb2FkZWQuZ2V0\nKGZpZWxkKSA9PSBsb2FkZWQpCiAgICAgICAgICAgIF9maWVsZEltcGxbaWR4\nXSA9IG51bGw7CiAgICAgICAgcmV0dXJuIG9sZDsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGZldGNoKGludCBmaWVsZCkgewogICAgICAgIE9iamVjdCB2\nYWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJu\nIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5nZXRFeHRlcm5hbFZhbHVlKHZhbCwg\nX2Jyb2tlcik7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaEZpZWxk\nKGludCBmaWVsZCwgYm9vbGVhbiB0cmFuc2l0aW9ucykgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWZpZWxkIiwKICAgICAgICAgICAg\nICAgIFN0cmluZy52YWx1ZU9mKGZpZWxkKSwgZ2V0TWFuYWdlZEluc3RhbmNl\nKCkuZ2V0Q2xhc3MoKSkpLgogICAgICAgICAgICAgICAgc2V0RmFpbGVkT2Jq\nZWN0KGdldE1hbmFnZWRJbnN0YW5jZSgpKTsKCiAgICAgICAgLy8gZG8gbm9y\nbWFsIHN0YXRlIHRyYW5zaXRpb25zCiAgICAgICAgaWYgKCFmbWQuaXNQcmlt\nYXJ5S2V5KCkgJiYgdHJhbnNpdGlvbnMpCiAgICAgICAgICAgIGFjY2Vzc2lu\nZ0ZpZWxkKGZpZWxkKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNU\nUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaFN0cmluZ0ZpZWxk\nKGZpZWxkKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAg\nICAgICAgICAgcmV0dXJuIChmZXRjaEJvb2xlYW5GaWVsZChmaWVsZCkpID8g\nQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICAgICAgOiBCb29sZWFuLkZB\nTFNFOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBCeXRlKGZldGNoQnl0ZUZpZWxkKGZpZWxk\nKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IENoYXJhY3RlcihmZXRjaENoYXJGaWVsZChm\naWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZShmZXRjaERvdWJsZUZp\nZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdChmZXRjaEZsb2F0\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5U\nOgogICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmZXRj\naEludEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKGZldGNoTG9uZ0ZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaG9y\ndChmZXRjaFNob3J0RmllbGQoZmllbGQpKTsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaE9iamVjdEZpZWxkKGZp\nZWxkKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmUo\naW50IGZpZWxkLCBPYmplY3QgdmFsKSB7CiAgICAgICAgdmFsID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpLmdldEZpZWxkVmFsdWUodmFsLCBfYnJva2VyKTsK\nICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCB2YWwpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0b3JlRmllbGQoaW50IGZpZWxkLCBPYmplY3QgdmFsKSB7\nCiAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgdmFsLCB0aGlzKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIDxwPkNoZWNrcyB3aGV0aGVyIG9yIG5vdCA8Y29k\nZT5fcGM8L2NvZGU+IGlzIGRpcnR5LiBJbiB0aGUgY2FzZXMgd2hlcmUKICAg\nICAqIGZpZWxkIHRyYWNraW5nIGlzIG5vdCBoYXBwZW5pbmcgKHNlZSBiZWxv\ndyksIHRoaXMgbWV0aG9kIHdpbGwgZG8gYQogICAgICogc3RhdGUgY29tcGFy\naXNvbiB0byBmaW5kIHdoZXRoZXIgPGNvZGU+X3BjPC9jb2RlPiBpcyBkaXJ0\neSwgYW5kIHdpbGwKICAgICAqIHVwZGF0ZSB0aGlzIGluc3RhbmNlIHdpdGgg\ndGhpcyBpbmZvcm1hdGlvbi4gSW4gdGhlIGNhc2VzIHdoZXJlIGZpZWxkCiAg\nICAgKiB0cmFja2luZyBpcyBoYXBwZW5pbmcsIHRoaXMgbWV0aG9kIGlzIGEg\nbm8tb3AuPC9wPgogICAgICoKICAgICAqIDxwPkZpZWxkcyBhcmUgdHJhY2tl\nZCBmb3IgYWxsIGNsYXNzZXMgdGhhdCBhcmUgcnVuIHRocm91Z2ggdGhlIE9w\nZW5KUEEKICAgICAqIGVuaGFuY2VyIHByaW9yIHRvIG9yIGR1cmluZyBkZXBs\nb3ltZW50LCBhbmQgYWxsIGNsYXNzZXMgKGVuaGFuY2VkIG9yCiAgICAgKiB1\nbmVuaGFuY2VkKSBpbiBhIEphdmEgNiBlbnZpcm9ubWVudCBvciBuZXdlci48\nL3A+CiAgICAgKgogICAgICogPHA+SW4gYSBKYXZhIDUgVk0gb3Igb2xkZXI6\nCiAgICAgKiA8YnI+LSBpbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBjbGFzc2Vz\nIHRoYXQgdXNlCiAgICAgKiBwcm9wZXJ0eSBhY2Nlc3MgYW5kIG9iZXkgdGhl\nIHByb3BlcnR5IGFjY2VzcyBsaW1pdGF0aW9ucyBhcmUgdHJhY2tlZAogICAg\nICogd2hlbiB0aGUgaW5zdGFuY2VzIGFyZSBsb2FkZWQgZnJvbSB0aGUgZGF0\nYWJhc2UgYnkgT3BlbkpQQSwgYW5kIGFyZQogICAgICogbm90IHRyYWNrZWQg\nd2hlbiB0aGUgaW5zdGFuY2VzIGFyZSBjcmVhdGVkIGJ5IGFwcGxpY2F0aW9u\nIGNvZGUuCiAgICAgKiA8YnI+LSBpbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBj\nbGFzc2VzIHRoYXQgdXNlIGZpZWxkIGFjY2VzcyBhcmUKICAgICAqIG5ldmVy\nIHRyYWNrZWQuPC9wPgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBkaXJ0eUNoZWNrKCkgewogICAgICAgIGlm\nICghbmVlZHNEaXJ0eUNoZWNrKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgU2F2ZUZpZWxkTWFuYWdlciBzYXZlZCA9IGdldFNhdmVGaWVsZE1h\nbmFnZXIoKTsKICAgICAgICBpZiAoc2F2ZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1z\nYXZlZC1maWVsZHMiLAogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoKS5n\nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CgogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgLy8gcGsgYW5kIHZlcnNpb24gZmllbGRzIGNhbm5v\ndCBiZSBtdXRhdGVkOyBkb24ndCBtYXJrIHRoZW0KICAgICAgICAgICAgLy8g\nYXMgc3VjaC4gIyMjIyMgdmFsaWRhdGU/CiAgICAgICAgICAgIGlmICghZm1k\nc1tpXS5pc1ByaW1hcnlLZXkoKSAmJiAhZm1kc1tpXS5pc1ZlcnNpb24oKQog\nICAgICAgICAgICAgICAgJiYgX2xvYWRlZC5nZXQoaSkpIHsKICAgICAgICAg\nICAgICAgIGlmICghc2F2ZWQuaXNGaWVsZEVxdWFsKGksIGZldGNoKGkpKSkg\newogICAgICAgICAgICAgICAgICAgIGRpcnR5KGkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgYm9vbGVhbiBuZWVkc0RpcnR5Q2hlY2soKSB7CiAgICAgICAgaWYgKGlz\nSW50ZXJjZXB0aW5nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAoaXNEZWxldGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoaXNOZXcoKSAmJiAhaXNGbHVzaGVkKCkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoSW5pdGlhbEZpZWxkKGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVT\ndGF0ZSgpID09IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUKICAgICAgICAg\nICAgJiYgKChfZmxhZ3MgJiBGTEFHX0lOVkVSU0VTKSA9PSAwCiAgICAgICAg\nICAgIHx8IGZtZC5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDAp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJyZXN0b3JlLXVuc2V0IikpOwoKICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ0FMRU5EQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIG5v\ndCBzYXZpbmcgbXV0YWJsZSB0eXBlcywgdGhyb3cgYW4gZXhjZXB0aW9uCiAg\nICAgICAgICAgICAgICBpZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3RhdGUoKSAh\nPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9BTEwKICAgICAgICAgICAgICAgICAg\nICAmJiAoKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAg\nICAgICAgICAgICB8fCBmbWQuZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0\naCA9PSAwKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAg\nICAgICgibXV0YWJsZS1yZXN0b3JlLXVuc2V0IikpOwogICAgICAgIH0KCiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChf\nc2F2ZWQgPT0gbnVsbCB8fCAhX2xvYWRlZC5nZXQoZmllbGQpIHx8ICFfZGly\ndHkuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaEZp\nZWxkKGZpZWxkLCBmYWxzZSk7CgogICAgICAgICAgICAvLyBpZiB0aGUgZmll\nbGQgaXMgZGlydHkgYnV0IHdlIG5ldmVyIGxvYWRlZCBpdCwgd2UgY2FuJ3Qg\ncmVzdG9yZSBpdAogICAgICAgICAgICBpZiAoX3NhdmVkLmdldFVubG9hZGVk\nKCkuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImluaXRpYWwtdW5sb2FkZWQi\nLAogICAgICAgICAgICAgICAgICAgIGZtZCkpOwoKICAgICAgICAgICAgcHJv\ndmlkZUZpZWxkKF9zYXZlZC5nZXRTdGF0ZSgpLCBfc2luZ2xlLCBmaWVsZCk7\nCiAgICAgICAgICAgIHJldHVybiBmZXRjaEZpZWxkKF9zaW5nbGUsIGZtZCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmV0Y2ggdGhlIHNwZWNp\nZmllZCBmaWVsZCBmcm9tIHRoZSBzcGVjaWZpZWQgZmllbGQgbWFuYWdlciwg\nd3JhcHBpbmcgaXQKICAgICAqIGluIGFuIG9iamVjdCBpZiBpdCdzIGEgcHJp\nbWl0aXZlLiBBIGZpZWxkIHNob3VsZCBiZSBwcm92aWRlZCB0byB0aGUKICAg\nICAqIGZpZWxkIG1hbmFnZXIgYmVmb3JlIHRoaXMgY2FsbCBpcyBtYWRlLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgZmV0Y2hGaWVsZChG\naWVsZE1hbmFnZXIgZm0sIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\naW50IGZpZWxkID0gZm1kLmdldEluZGV4KCk7CiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICByZXR1cm4gKGZt\nLmZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKSkgPyBCb29sZWFuLlRSVUUKICAg\nICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IEJ5dGUoZm0uZmV0Y2hCeXRlRmllbGQoZmllbGQpKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgQ2hhcmFjdGVyKGZtLmZldGNoQ2hhckZpZWxkKGZpZWxkKSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgRG91YmxlKGZtLmZldGNoRG91YmxlRmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZtLmZldGNoRmxvYXRGaWVs\nZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZtLmZldGNo\nSW50RmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTE9ORzoKICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2Yo\nZm0uZmV0Y2hMb25nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNo\nb3J0KGZtLmZldGNoU2hvcnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZm0uZmV0Y2hTdHJpbmdGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZm0uZmV0Y2hPYmplY3RGaWVs\nZChmaWVsZCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndFJlbW90ZShpbnQgZmllbGQsIE9iamVjdCB2YWx1ZSkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQg\nPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgZmFsc2UpOwogICAgICAg\nICAgICBzdG9yZUZpZWxkKGZpZWxkLCB2YWx1ZSwgX3NpbmdsZSk7CiAgICAg\nICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIExpZmVjeWNsZSBvcGVy\nYXRpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioK\nICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHRoZSBvYmplY3QgaXMgYWJvdXQg\ndG8gYmUgYWNjZXNzZWQuCiAgICAgKgogICAgICogQHBhcmFtIGZpZWxkIHRo\nZSBmaWVsZCBudW1iZXIgYmVpbmcgcmVhZCwgb3IgLTEgaWYgbm90IGEgc2lu\nZ2xlCiAgICAgKiBmaWVsZCByZWFkCiAgICAgKi8KICAgIHZvaWQgYmVmb3Jl\nUmVhZChpbnQgZmllbGQpIHsKICAgICAgICAvLyBhbGxvdyB1bm1lZGlhdGVk\nIHJlYWRzIG9mIHByaW1hcnkga2V5IGZpZWxkcwogICAgICAgIGlmIChmaWVs\nZCAhPSAtMSAmJiBfbWV0YS5nZXRGaWVsZChmaWVsZCkuaXNQcmltYXJ5S2V5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9icm9rZXIu\naXNBY3RpdmUoKSAmJiAhX2Jyb2tlci5pc1RyYW5zYWN0aW9uRW5kaW5nKCkp\nIHsKICAgICAgICAgICAgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQog\nICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlT3B0aW1p\nc3RpY1JlYWQodGhpcywgZmllbGQpKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlUmVhZCh0aGlz\nLCBmaWVsZCkpOwogICAgICAgIH0gZWxzZSBpZiAoX2Jyb2tlci5nZXROb250\ncmFuc2FjdGlvbmFsUmVhZCgpKQogICAgICAgICAgICBzZXRQQ1N0YXRlKF9z\ndGF0ZS5iZWZvcmVOb250cmFuc2FjdGlvbmFsUmVhZCh0aGlzLCBmaWVsZCkp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRT\ndGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm9uLXRyYW5zLXJlYWQiKSkuCiAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRo\nZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNi\nZWZvcmVGbHVzaAogICAgICovCiAgICB2b2lkIGJlZm9yZUZsdXNoKGludCBy\nZWFzb24sIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBfc3RhdGUuYmVm\nb3JlRmx1c2godGhpcywgcmVhc29uID09IEJyb2tlckltcGwuRkxVU0hfTE9H\nSUNBTCwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMg\ndG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0\nYXRlI2ZsdXNoCiAgICAgKi8KICAgIHZvaWQgYWZ0ZXJGbHVzaChpbnQgcmVh\nc29uKSB7CiAgICAgICAgLy8gbm90aGluZyBoYXBwZW5zIHdoZW4gd2UgZmx1\nc2ggbm9uLXBlcnNpc3RlbnQgc3RhdGVzCiAgICAgICAgaWYgKCFpc1BlcnNp\nc3RlbnQoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAocmVh\nc29uICE9IEJyb2tlckltcGwuRkxVU0hfUk9MTEJBQ0sKICAgICAgICAgICAg\nJiYgcmVhc29uICE9IEJyb2tlckltcGwuRkxVU0hfTE9HSUNBTCkgewogICAg\nICAgICAgICAvLyBhbmFseXplIHByZXZpb3VzIHN0YXRlIGZvciBsYXRlcgog\nICAgICAgICAgICBib29sZWFuIHdhc05ldyA9IGlzTmV3KCk7CiAgICAgICAg\nICAgIGJvb2xlYW4gd2FzRmx1c2hlZCA9IGlzRmx1c2hlZCgpOwogICAgICAg\nICAgICBib29sZWFuIHdhc0RlbGV0ZWQgPSBpc0RlbGV0ZWQoKTsKICAgICAg\nICAgICAgYm9vbGVhbiBuZWVkUG9zdFVwZGF0ZSA9ICEod2FzTmV3ICYmICF3\nYXNGbHVzaGVkKQogICAgICAgICAgICAgICAgICAgICYmIChJbXBsSGVscGVy\nLmdldFVwZGF0ZUZpZWxkcyh0aGlzKSAhPSBudWxsKTsKCiAgICAgICAgICAg\nIC8vIGFsbCBkaXJ0eSBmaWVsZHMgd2VyZSBmbHVzaGVkCiAgICAgICAgICAg\nIF9mbHVzaC5vcihfZGlydHkpOwoKICAgICAgICAgICAgLy8gaW1wb3J0YW50\nIHRvIHNldCBmbHVzaGVkIGJpdCBhZnRlciBjYWxsaW5nIF9zdGF0ZS5mbHVz\naCBzbwogICAgICAgICAgICAvLyB0aGF0IHRoZSBzdGF0ZSBjYW4gdGVsbCB3\naGV0aGVyIHRoaXMgaXMgdGhlIGZpcnN0IGZsdXNoCiAgICAgICAgICAgIHNl\ndFBDU3RhdGUoX3N0YXRlLmZsdXNoKHRoaXMpKTsKICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX0ZMVVNIRURfRElSVFk7CgogICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfVkVSU0lPTl9DSEVDSzsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFH\nX1ZFUlNJT05fVVBEQVRFOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyB3YXMg\nYW4gaW5jIGZsdXNoIGR1cmluZyB3aGljaCB3ZSBoYWQgb3VyIGlkZW50aXR5\nCiAgICAgICAgICAgIC8vIGFzc2lnbmVkLCB0ZWxsIHRoZSBicm9rZXIgdG8g\nY2FjaGUgdXMgdW5kZXIgb3VyIGZpbmFsIG9pZAogICAgICAgICAgICBpZiAo\ncmVhc29uID09IEJyb2tlckltcGwuRkxVU0hfSU5DKQogICAgICAgICAgICAg\nICAgYXNzZXJ0T2JqZWN0SWRBc3NpZ25lZCh0cnVlKTsKCiAgICAgICAgICAg\nIC8vIGlmIHRoaXMgb2JqZWN0IHdhcyBzdG9yZWQgd2l0aCBwcmVGbHVzaCwg\nZG8gcG9zdC1zdG9yZSBjYWxsYmFjawogICAgICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfUFJFX0ZMVVNIRUQpID4gMCkKICAgICAgICAgICAgICAgIGZp\ncmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9TVE9SRSk7\nCgogICAgICAgICAgICAvLyBkbyBwb3N0LXVwZGF0ZSBhcyBuZWVkZWQKICAg\nICAgICAgICAgaWYgKHdhc05ldyAmJiAhd2FzRmx1c2hlZCkKICAgICAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRF\nUl9QRVJTSVNUX1BFUkZPUk1FRCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHdh\nc0RlbGV0ZWQpCiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQo\nTGlmZWN5Y2xlRXZlbnQuQUZURVJfREVMRVRFX1BFUkZPUk1FRCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKG5lZWRQb3N0VXBkYXRlKQogICAgICAgICAgICAg\nICAgLy8gdXBkYXRlcyBhbmQgbmV3LWZsdXNoZWQgd2l0aCBjaGFuZ2VzCiAg\nICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZl\nbnQuQUZURVJfVVBEQVRFX1BFUkZPUk1FRCk7CiAgICAgICAgfSBlbHNlIGlm\nIChyZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9ST0xMQkFDSykgewogICAg\nICAgICAgICAvLyByZXZlcnQgdG8gbGFzdCBsb2FkZWQgdmVyc2lvbiBhbmQg\nb3JpZ2luYWwgb2lkCiAgICAgICAgICAgIGFzc2lnblZlcnNpb25GaWVsZChf\nbG9hZFZlcnNpb24pOwogICAgICAgICAgICBpZiAoaXNOZXcoKSAmJiAoX2Zs\nYWdzICYgRkxBR19PSURfQVNTSUdORUQpID09IDApCiAgICAgICAgICAgICAg\nICBfb2lkID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX1BSRV9GTFVTSEVEOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdh\ndGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlIGFmdGVyIGNoZWNraW5nIHRoZSB2\nYWx1ZQogICAgICogb2YgdGhlIFJldGFpblN0YXRlIGZsYWcuCiAgICAgKgog\nICAgICogQHNlZSBQQ1N0YXRlI2NvbW1pdAogICAgICogQHNlZSBQQ1N0YXRl\nI2NvbW1pdFJldGFpbgogICAgICovCiAgICB2b2lkIGNvbW1pdCgpIHsKICAg\nICAgICAvLyByZWxlYXNlIGxvY2tzIGJlZm9yZSBvaWQgdXBkYXRlZAogICAg\nICAgIHJlbGVhc2VMb2NrcygpOwoKICAgICAgICAvLyB1cGRhdGUgdmVyc2lv\nbiBhbmQgb2lkIGluZm9ybWF0aW9uCiAgICAgICAgc2V0VmVyc2lvbihfdmVy\nc2lvbik7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAg\nICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7CgogICAgICAgIE9i\namVjdCBvcmlnID0gX2lkOwogICAgICAgIGFzc2VydE9iamVjdElkQXNzaWdu\nZWQoZmFsc2UpOwoKICAgICAgICBib29sZWFuIHdhc05ldyA9IGlzTmV3KCkg\nJiYgIWlzRGVsZXRlZCgpICYmICFpc1Byb3Zpc2lvbmFsKCk7CiAgICAgICAg\naWYgKF9icm9rZXIuZ2V0UmV0YWluU3RhdGUoKSkKICAgICAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUuY29tbWl0UmV0YWluKHRoaXMpKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmNvbW1pdCh0aGlz\nKSk7CgogICAgICAgIC8vIGFzayB0aGUgYnJva2VyIHRvIHJlLWNhY2hlIHVz\nIGlmIHdlIHdlcmUgbmV3IHByZXZpb3VzbHkKICAgICAgICBpZiAod2FzTmV3\nKQogICAgICAgICAgICBfYnJva2VyLnNldFN0YXRlTWFuYWdlcihvcmlnLCB0\naGlzLCBCcm9rZXJJbXBsLlNUQVRVU19DT01NSVRfTkVXKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZSBh\nZnRlciBjaGVja2luZyB0aGUgdmFsdWUKICAgICAqIG9mIHRoZSBSZXRhaW5T\ndGF0ZSBmbGFnLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNyb2xsYmFj\nawogICAgICogQHNlZSBQQ1N0YXRlI3JvbGxiYWNrUmVzdG9yZQogICAgICov\nCiAgICB2b2lkIHJvbGxiYWNrKCkgewogICAgICAgIC8vIHJlbGVhc2UgbG9j\na3MKICAgICAgICByZWxlYXNlTG9ja3MoKTsKICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hF\nRF9ESVJUWTsKICAgICAgICBhZnRlckZsdXNoKEJyb2tlckltcGwuRkxVU0hf\nUk9MTEJBQ0spOwoKICAgICAgICBpZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3Rh\ndGUoKSAhPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05FKQogICAgICAgICAg\nICBzZXRQQ1N0YXRlKF9zdGF0ZS5yb2xsYmFja1Jlc3RvcmUodGhpcykpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUucm9s\nbGJhY2sodGhpcykpOwogICAgfQoKICAgIC8qKgogICAgICogUm9sbGJhY2sg\nc3RhdGUgb2YgdGhlIG1hbmFnZWQgaW5zdGFuY2UgdG8gdGhlIGdpdmVuIHNh\ndmVwb2ludC4KICAgICAqLwogICAgdm9pZCByb2xsYmFja1RvU2F2ZXBvaW50\nKFNhdmVwb2ludEZpZWxkTWFuYWdlciBzYXZlcG9pbnQpIHsKICAgICAgICBf\nc3RhdGUgPSBzYXZlcG9pbnQuZ2V0UENTdGF0ZSgpOwogICAgICAgIEJpdFNl\ndCBsb2FkZWQgPSBzYXZlcG9pbnQuZ2V0TG9hZGVkKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDAsIGxlbiA9IGxvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsg\naSsrKSB7CiAgICAgICAgICAgIGlmIChsb2FkZWQuZ2V0KGkpICYmIHNhdmVw\nb2ludC5yZXN0b3JlRmllbGQoaSkpIHsKICAgICAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChzYXZlcG9pbnQuZ2V0Q29weSgpLCBzYXZlcG9pbnQsIGkpOwog\nICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgc2F2ZXBvaW50LCBp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfbG9hZGVkID0g\nbG9hZGVkOwogICAgICAgIF9kaXJ0eSA9IHNhdmVwb2ludC5nZXREaXJ0eSgp\nOwogICAgICAgIF9mbHVzaCA9IHNhdmVwb2ludC5nZXRGbHVzaGVkKCk7CiAg\nICAgICAgX3ZlcnNpb24gPSBzYXZlcG9pbnQuZ2V0VmVyc2lvbigpOwogICAg\nICAgIF9sb2FkVmVyc2lvbiA9IHNhdmVwb2ludC5nZXRMb2FkVmVyc2lvbigp\nOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJy\nZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNwZXJzaXN0\nCiAgICAgKiBAc2VlIEJyb2tlciNwZXJzaXN0CiAgICAgKi8KICAgIHZvaWQg\ncGVyc2lzdCgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5wZXJzaXN0\nKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0\naGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUj\nZGVsZXRlCiAgICAgKiBAc2VlIEJyb2tlciNkZWxldGUKICAgICAqLwogICAg\ndm9pZCBkZWxldGUoKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuZGVs\nZXRlKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0\nbyB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3Rh\ndGUjbm9udHJhbnNhY3Rpb25hbAogICAgICogQHNlZSBCcm9rZXIjbm9udHJh\nbnNhY3Rpb25hbAogICAgICovCiAgICB2b2lkIG5vbnRyYW5zYWN0aW9uYWwo\nKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUubm9udHJhbnNhY3Rpb25h\nbCh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8g\ndGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRl\nI3RyYW5zYWN0aW9uYWwKICAgICAqIEBzZWUgQnJva2VyI3RyYW5zYWN0aW9u\nYWwKICAgICAqLwogICAgdm9pZCB0cmFuc2FjdGlvbmFsKCkgewogICAgICAg\nIHNldFBDU3RhdGUoX3N0YXRlLnRyYW5zYWN0aW9uYWwodGhpcykpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0\nYXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNub25wcm92aXNpb25h\nbAogICAgICovCiAgICB2b2lkIG5vbnByb3Zpc2lvbmFsKGJvb2xlYW4gbG9n\naWNhbCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHNldFBDU3RhdGUo\nX3N0YXRlLm5vbnByb3Zpc2lvbmFsKHRoaXMsIGxvZ2ljYWwsIGNhbGwpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVu\ndCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjcmVsZWFzZQog\nICAgICogQHNlZSBCcm9rZXIjcmVsZWFzZQogICAgICovCiAgICB2b2lkIHJl\nbGVhc2UoYm9vbGVhbiB1bnByb3h5KSB7CiAgICAgICAgcmVsZWFzZSh1bnBy\nb3h5LCBmYWxzZSk7CiAgICB9CgogICAgdm9pZCByZWxlYXNlKGJvb2xlYW4g\ndW5wcm94eSwgYm9vbGVhbiBmb3JjZSkgewogICAgICAgIC8vIG9wdGltaXph\ndGlvbiBmb3IgZGV0YWNoLWluLXBsYWNlIHNwZWNpYWwgY2FzZSB3aGVuIGZp\nZWxkcyBhcmUKICAgICAgICAvLyBhbHJlYWR5ICh1bilwcm94aWVkIGNvcnJl\nY3RseQogICAgICAgIGlmICghdW5wcm94eSkKICAgICAgICAgICAgX2ZsYWdz\nIHw9IEZMQUdfTk9fVU5QUk9YWTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoZm9yY2UpCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKFBDU3Rh\ndGUuVFJBTlNJRU5UKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgc2V0UENTdGF0ZShfc3RhdGUucmVsZWFzZSh0aGlzKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX05PX1VO\nUFJPWFk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdh\ndGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUg\nUENTdGF0ZSNldmljdAogICAgICogQHNlZSBCcm9rZXIjZXZpY3QKICAgICAq\nLwogICAgdm9pZCBldmljdCgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0\nZS5ldmljdCh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHYXRoZXIg\ncmVsYXRpb25zIHJlYWNoYWJsZSBmcm9tIHZhbHVlcyB1c2luZwogICAgICog\ne0BsaW5rIFZhbHVlTWV0YURhdGEjQ0FTQ0FERV9JTU1FRElBVEV9LgogICAg\nICovCiAgICB2b2lkIGdhdGhlckNhc2NhZGVSZWZyZXNoKE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRh\nLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0\nKGkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBp\nZiAoZm1kc1tpXS5nZXRDYXNjYWRlUmVmcmVzaCgpID09IFZhbHVlTWV0YURh\ndGEuQ0FTQ0FERV9JTU1FRElBVEUKICAgICAgICAgICAgICAgIHx8IGZtZHNb\naV0uZ2V0S2V5KCkuZ2V0Q2FzY2FkZVJlZnJlc2goKQogICAgICAgICAgICAg\nICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAg\nICAgICAgICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZVJl\nZnJlc2goKQogICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVND\nQURFX0lNTUVESUFURSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5zdG9y\nZU9iamVjdEZpZWxkKGksIGZldGNoRmllbGQoaSwgZmFsc2UpKTsKICAgICAg\nICAgICAgICAgIF9zaW5nbGUuZ2F0aGVyQ2FzY2FkZVJlZnJlc2goY2FsbCk7\nCiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYmVmb3Jl\nUmVmcmVzaChib29sZWFuIHJlZnJlc2hBbGwpIHsKICAgICAgICAvLyBub3Rl\nOiBhbGwgbG9naWMgcGxhY2VkIGhlcmUgcmF0aGVyIHRoYW4gaW4gdGhlIHN0\nYXRlcyBmb3IKICAgICAgICAvLyBvcHRpbWl6YXRpb247IHRoaXMgbWV0aG9k\nIHB1YmxpYyBiL2MgdXNlZCBieSByZW1vdGUgcGFja2FnZQoKICAgICAgICAv\nLyBub3RoaW5nIHRvIGRvIGZvciBub24gcGVyc2lzdGVudCBvciBuZXcgdW5m\nbHVzaGVkIGluc3RhbmNlcwogICAgICAgIGlmICghaXNQZXJzaXN0ZW50KCkg\nfHwgKGlzTmV3KCkgJiYgIWlzRmx1c2hlZCgpKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gaWYgZGlydHkgbmVlZCB0byBjbGVhciBmaWVsZHMKICAg\nICAgICAgICAgaWYgKGlzRGlydHkoKSkgewogICAgICAgICAgICAgICAgY2xl\nYXJGaWVsZHMoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiBzb21lIGZpZWxkcyBoYXZl\nIGJlZW4gbG9hZGVkIGJ1dCB0aGUgaW5zdGFuY2UgaXMgb3V0IG9mCiAgICAg\nICAgICAgIC8vIGRhdGUgb3IgdGhpcyBpcyBwYXJ0IG9mIGEgcmVmcmVzaEFs\nbCgpIGFuZCB3ZSBkb24ndCB3YW50IHRvCiAgICAgICAgICAgIC8vIHRha2Ug\ndGhlIGV4dHJhIGhpdCB0byBzZWUgaWYgdGhlIGluc3RhbmNlIGlzIG91dCBv\nZiBkYXRlLCBjbGVhcgogICAgICAgICAgICBpZiAoX2xvYWRlZC5sZW5ndGgo\nKSA+IDAgJiYgKHJlZnJlc2hBbGwgfHwgaXNFbWJlZGRlZCgpCiAgICAgICAg\nICAgICAgICB8fCAhc3luY1ZlcnNpb24obnVsbCkpKSB7CiAgICAgICAgICAg\nICAgICBPYmplY3QgdmVyc2lvbiA9IF92ZXJzaW9uOwogICAgICAgICAgICAg\nICAgY2xlYXJGaWVsZHMoKTsKCiAgICAgICAgICAgICAgICAvLyBpZiBzeW5j\nVmVyc2lvbiBqdXN0IHJlcGxhY2VkIHRoZSB2ZXJzaW9uLCByZXNldCBpdAog\nICAgICAgICAgICAgICAgaWYgKCFyZWZyZXNoQWxsICYmICFpc0VtYmVkZGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0VmVyc2lvbih2ZXJzaW9uKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQZXJmb3JtIHN0YXRlIHRyYW5zaXRpb25zIGFmdGVyIHJlZnJl\nc2guIFRoaXMgbWV0aG9kIGlzIG9ubHkKICAgICAqIGNhbGxlZCBpZiB7QGxp\nbmsgI2JlZm9yZVJlZnJlc2h9IHJldHVybnMgdHJ1ZS4KICAgICAqLwogICAg\ndm9pZCBhZnRlclJlZnJlc2goKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIHRyYW5zaXRpb24gdG8gY2xlYW4gb3Ig\nbm9udHJhbnNhY3Rpb25hbCBkZXBlbmRpbmcgb24gdHJhbnMgc3RhdHVzCiAg\nICAgICAgICAgIGlmICghX2Jyb2tlci5pc0FjdGl2ZSgpKQogICAgICAgICAg\nICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYWZ0ZXJOb250cmFuc2FjdGlvbmFs\nUmVmcmVzaCgpKTsKICAgICAgICAgICAgZWxzZSBpZiAoX2Jyb2tlci5nZXRP\ncHRpbWlzdGljKCkpCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0\nZS5hZnRlck9wdGltaXN0aWNSZWZyZXNoKCkpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5hZnRlclJlZnJl\nc2goKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGlz\nIG9iamVjdCBhcyBhIGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQgb2JqZWN0Lgog\nICAgICovCiAgICB2b2lkIHNldERlcmVmZXJlbmNlZERlcGVuZGVudChib29s\nZWFuIGRlcmVmLCBib29sZWFuIG5vdGlmeSkgewogICAgICAgIGlmICghZGVy\nZWYgJiYgKF9mbGFncyAmIEZMQUdfREVSRUYpID4gMCkgewogICAgICAgICAg\nICBpZiAobm90aWZ5KQogICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1vdmVE\nZXJlZmVyZW5jZWREZXBlbmRlbnQodGhpcyk7CiAgICAgICAgICAgIF9mbGFn\ncyAmPSB+RkxBR19ERVJFRjsKICAgICAgICB9IGVsc2UgaWYgKGRlcmVmICYm\nIChfZmxhZ3MgJiBGTEFHX0RFUkVGKSA9PSAwKSB7CiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX0RFUkVGOwogICAgICAgICAgICBpZiAobm90aWZ5KQog\nICAgICAgICAgICAgICAgX2Jyb2tlci5hZGREZXJlZmVyZW5jZWREZXBlbmRl\nbnQodGhpcyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICB2b2lkIHNldERl\ncmVmZXJlbmNlZEVtYmVkRGVwZW5kZW50KGJvb2xlYW4gZGVyZWYpIHsKICAg\nICAgICBpZiAoIWRlcmVmICYmIChfZmxhZ3MgJiBGTEFHX0VNQkVEX0RFUkVG\nKSA+IDApIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0VNQkVEX0RF\nUkVGOwogICAgICAgIH0gZWxzZSBpZiAoZGVyZWYgJiYgKF9mbGFncyAmIEZM\nQUdfRU1CRURfREVSRUYpID09IDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfRU1CRURfREVSRUY7CiAgICAgICAgfQogICAgfQogICAgCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXREZXJlZmVyZW5jZWRFbWJlZERlcGVuZGVudCgp\nIHsKICAgICAgICByZXR1cm4gKChfZmxhZ3MgJiBGTEFHX0VNQkVEX0RFUkVG\nKSA9PSAwID8gZmFsc2UgOiB0cnVlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLwogICAgLy8gTG9ja2luZwogICAgLy8vLy8vLy8vLy8KCiAgICAvKioKICAg\nICAqIE5vdGlmaWNhdGlvbiB0aGF0IHdlJ3ZlIGJlZW4gcmVhZC1sb2NrZWQu\nIFBhc3MgaW4gdGhlIGxldmVsIGF0IHdoaWNoCiAgICAgKiB3ZSB3ZXJlIGxv\nY2tlZCBhbmQgdGhlIGxldmVsIGF0IHdoaWNoIHdlIHNob3VsZCB3cml0ZSBs\nb2NrIG91cnNlbHZlcwogICAgICogb24gZGlydHkuCiAgICAgKi8KICAgIHZv\naWQgcmVhZExvY2tlZChpbnQgcmVhZExvY2tMZXZlbCwgaW50IHdyaXRlTG9j\na0xldmVsKSB7CiAgICAgICAgLy8gbWFrZSBzdXJlIG9iamVjdCBpcyBhZGRl\nZCB0byB0cmFuc2FjdGlvbiBzbyBsb2NrIHdpbGwgZ2V0CiAgICAgICAgLy8g\nY2xlYXJlZCBvbiBjb21taXQvcm9sbGJhY2sKICAgICAgICBpZiAocmVhZExv\nY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSkKICAgICAgICAgICAg\ndHJhbnNhY3Rpb25hbCgpOwoKICAgICAgICBfcmVhZExvY2tMZXZlbCA9IHJl\nYWRMb2NrTGV2ZWw7CiAgICAgICAgX3dyaXRlTG9ja0xldmVsID0gd3JpdGVM\nb2NrTGV2ZWw7CiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVBRF9MT0NLRUQ7\nCiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1dSSVRFX0xPQ0tFRDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbG9jayBsZXZlbCB0byB1c2Ug\nd2hlbiBsb2FkaW5nIHN0YXRlLgogICAgICovCiAgICBwcml2YXRlIGludCBj\nYWxjdWxhdGVMb2NrTGV2ZWwoYm9vbGVhbiBhY3RpdmUsIGJvb2xlYW4gZm9y\nV3JpdGUsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgaWYgKCFhY3RpdmUpCiAgICAgICAgICAgIHJldHVybiBMb2NrTGV2\nZWxzLkxPQ0tfTk9ORTsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAg\nICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlv\nbigpOwoKICAgICAgICBpZiAoX3JlYWRMb2NrTGV2ZWwgPT0gLTEpCiAgICAg\nICAgICAgIF9yZWFkTG9ja0xldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZl\nbCgpOwogICAgICAgIGlmIChfd3JpdGVMb2NrTGV2ZWwgPT0gLTEpCiAgICAg\nICAgICAgIF93cml0ZUxvY2tMZXZlbCA9IGZldGNoLmdldFdyaXRlTG9ja0xl\ndmVsKCk7CiAgICAgICAgcmV0dXJuIChmb3JXcml0ZSkgPyBfd3JpdGVMb2Nr\nTGV2ZWwgOiBfcmVhZExvY2tMZXZlbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1ha2Ugc3VyZSB3ZSdyZSBsb2NrZWQgYXQgdGhlIGdpdmVuIGxldmVsLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgb2J0YWluTG9ja3MoYm9vbGVhbiBh\nY3RpdmUsIGJvb2xlYW4gZm9yV3JpdGUsIGludCBsb2NrTGV2ZWwsCiAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3Qgc2RhdGEpIHsK\nICAgICAgICBpZiAoIWFjdGl2ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBpZiB3ZSBoYXZlbid0IGJlZW4gbG9ja2VkIHlldCwgbG9jayBu\nb3cgYXQgdGhlIGdpdmVuIGxldmVsCiAgICAgICAgaW50IGZsYWcgPSAoZm9y\nV3JpdGUpID8gRkxBR19XUklURV9MT0NLRUQgOiBGTEFHX1JFQURfTE9DS0VE\nOwogICAgICAgIGlmICgoX2ZsYWdzICYgZmxhZykgPT0gMCkgewogICAgICAg\nICAgICAvLyBtYWtlIHN1cmUgb2JqZWN0IGlzIGFkZGVkIHRvIHRyYW5zYWN0\naW9uIHNvIGxvY2sgd2lsbCBnZXQKICAgICAgICAgICAgLy8gY2xlYXJlZCBv\nbiBjb21taXQvcm9sbGJhY2sKICAgICAgICAgICAgaWYgKGxvY2tMZXZlbCAh\nPSBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSkKICAgICAgICAgICAgICAgIHRyYW5z\nYWN0aW9uYWwoKTsKCiAgICAgICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQog\nICAgICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29uZmln\ndXJhdGlvbigpOwogICAgICAgICAgICBfYnJva2VyLmdldExvY2tNYW5hZ2Vy\nKCkubG9jayh0aGlzLCBsb2NrTGV2ZWwsCiAgICAgICAgICAgICAgICBmZXRj\naC5nZXRMb2NrVGltZW91dCgpLCBzZGF0YSk7CiAgICAgICAgICAgIF9mbGFn\ncyB8PSBGTEFHX1JFQURfTE9DS0VEOwogICAgICAgICAgICBfZmxhZ3MgfD0g\nZmxhZzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNl\nIGxvY2tzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVsZWFzZUxvY2tz\nKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQogICAgICAgICAgICBf\nYnJva2VyLmdldExvY2tNYW5hZ2VyKCkucmVsZWFzZSh0aGlzKTsKICAgICAg\nICBfcmVhZExvY2tMZXZlbCA9IC0xOwogICAgICAgIF93cml0ZUxvY2tMZXZl\nbCA9IC0xOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19SRUFEX0xPQ0tFRDsK\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfV1JJVEVfTE9DS0VEOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBTdGF0ZU1hbmFnZXIgaW50\nZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQHJldHVybiB3aGV0aGVyIG9y\nIG5vdCB1bmxvYWRlZCBmaWVsZHMgc2hvdWxkIGJlIGNsb3NlZC4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gc2VyaWFsaXppbmcoKSB7CiAgICAgICAg\nLy8gaWYgdGhlIGJyb2tlciBpcyBpbiB0aGUgbWlkc3Qgb2YgYSBzZXJpYWxp\nemF0aW9uLCB0aGVuIG5vIHNwZWNpYWwKICAgICAgICAvLyBoYW5kbGluZyBz\naG91bGQgYmUgcGVyZm9ybWVkIG9uIHRoZSBpbnN0YW5jZSwgYW5kIG5vIHN1\nYnNlcXVlbnQKICAgICAgICAvLyBsb2FkIHNob3VsZCBoYXBwZW4KICAgICAg\nICBpZiAoX2Jyb2tlci5pc1NlcmlhbGl6aW5nKCkpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9t\nZXRhLmlzRGV0YWNoYWJsZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIERl\ndGFjaE1hbmFnZXIucHJlU2VyaWFsaXplKHRoaXMpOwoKICAgICAgICAgICAg\nbG9hZChfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpLCBMT0FEX1NF\nUklBTElaRSwgbnVsbCwgbnVsbCwgCiAgICAgICAgICAgICAgICBmYWxzZSk7\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5z\nbGF0ZShyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHdyaXRlRGV0YWNoZWQoT2JqZWN0T3V0cHV0IG91dCkKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIEJpdFNldCBpZHhzID0gbmV3IEJp\ndFNldChfbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGgpOwogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIGRldHNtID0g\nRGV0YWNoTWFuYWdlci53cml0ZURldGFjaGVkU3RhdGUodGhpcywgb3V0LCBp\nZHhzKTsKICAgICAgICAgICAgaWYgKGRldHNtKQogICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfREVUQUNISU5HOwoKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgcHJv\ndmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICBf\nc2luZ2xlLnNlcmlhbGl6ZShvdXQsICFpZHhzLmdldChpKSk7CiAgICAgICAg\nICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+\nRkxBR19ERVRBQ0hJTkc7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm94eURldGFjaGVkRGVzZXJp\nYWxpemVkKGludCBpZHgpIHsKICAgICAgICAvLyB3ZSBkb24ndCBzZXJpYWxp\nemUgc3RhdGUgbWFuYWdlciBpbXBscwogICAgICAgIHRocm93IG5ldyBJbnRl\ncm5hbEV4Y2VwdGlvbigpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nVHJhbnNhY3Rpb25hbCgpIHsKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9y\nIFRDTEVBTiwgd2hpY2ggd2Ugd2FudCB0byBhcHBlYXIgbm9uLXRyYW5zIHRv\nCiAgICAgICAgLy8gaW50ZXJuYWwgY29kZSwgYnV0IHdoaWNoIHB1YmxpY2x5\nIHNob3VsZCBiZSB0cmFuc2FjdGlvbmFsCiAgICAgICAgcmV0dXJuIF9zdGF0\nZSA9PSBQQ1N0YXRlLlRDTEVBTiB8fCBfc3RhdGUuaXNUcmFuc2FjdGlvbmFs\nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQZW5kaW5nVHJhbnNh\nY3Rpb25hbCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzUGVuZGluZ1Ry\nYW5zYWN0aW9uYWwoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1By\nb3Zpc2lvbmFsKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNQcm92aXNp\nb25hbCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUGVyc2lzdGVu\ndCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzUGVyc2lzdGVudCgpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTmV3KCkgewogICAgICAgIHJl\ndHVybiBfc3RhdGUuaXNOZXcoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0RlbGV0ZWQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc0RlbGV0\nZWQoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewog\nICAgICAgIHJldHVybiBfc3RhdGUuaXNEaXJ0eSgpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzRGV0YWNoZWQoKSB7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBGTEFHX0RFVEFDSElORykgIT0gMDsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldEdlbmVyaWNDb250ZXh0KCkgewogICAgICAgIHJldHVy\nbiBfYnJva2VyOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmpl\nY3RJZCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoaGFzR2Vu\nZXJhdGVkS2V5KCkgJiYgX3N0YXRlIGluc3RhbmNlb2YgUE5ld1N0YXRlICYm\nIAogICAgICAgICAgICAgICAgX29pZCA9PSBudWxsKSAKICAgICAgICAgICAg\nICAgIHJldHVybiBfb2lkOwogICAgICAgICAgICBhc3NpZ25PYmplY3RJZCh0\ncnVlKTsKICAgICAgICAgICAgaWYgKF9vaWQgPT0gbnVsbCB8fCAhX2Jyb2tl\nci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICBnZXRDb21w\nYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXRDb3B5T2JqZWN0SWRzKCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gX29pZDsKCiAgICAgICAgICAgIGlmIChfbWV0\nYS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFT\nVE9SRSkKICAgICAgICAgICAgICAgIHJldHVybiBfYnJva2VyLmdldFN0b3Jl\nTWFuYWdlcigpLmNvcHlEYXRhU3RvcmVJZChfb2lkLCBfbWV0YSk7CiAgICAg\nICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5jb3B5KF9vaWQsIF9tZXRh\nKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICBwcml2YXRlIGJvb2xlYW4gaGFzR2VuZXJhdGVkS2V5KCkg\newogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa0ZpZWxkcyA9IF9tZXRhLmdl\ndFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHBrRmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChw\na0ZpZWxkc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVn\naWVzLkFVVE9BU1NJR04pCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZ2V0UENQcmltYXJ5S2V5KE9iamVjdCBvaWQsIGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIE9iamVjdCBwayA9IEFwcGxpY2F0aW9u\nSWRzLmdldChvaWQsIGZtZCk7CiAgICAgICAgaWYgKHBrID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDbGFzc01ldGFEYXRh\nIHJlbG1ldGEgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAg\nICAgICBwayA9IEFwcGxpY2F0aW9uSWRzLndyYXAocmVsbWV0YSwgcGspOwog\nICAgICAgIGlmIChyZWxtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNz\nTWV0YURhdGEuSURfREFUQVNUT1JFCiAgICAgICAgICAgICYmIGZtZC5nZXRP\nYmplY3RJZEZpZWxkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuTE9ORykKICAg\nICAgICAgICAgcGsgPSBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLm5ld0Rh\ndGFTdG9yZUlkKHBrLCByZWxtZXRhKTsKICAgICAgICBlbHNlIGlmIChyZWxt\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQ\nTElDQVRJT04gCiAgICAgICAgICAgICYmIGZtZC5nZXRPYmplY3RJZEZpZWxk\nVHlwZSgpICE9IHJlbG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCkpCiAgICAgICAg\nICAgIHBrID0gQXBwbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKG5ldyBPYmpl\nY3RbXSB7IHBrIH0sIHJlbG1ldGEpOwogICAgICAgIHJldHVybiBfYnJva2Vy\nLmZpbmQocGssIGZhbHNlLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYnl0\nZSByZXBsYWNlRmxhZ3MoKSB7CiAgICAgICAgLy8gd2UgYWx3YXlzIHVzZSBs\nb2FkIHJlcXVpcmVkIHNvIHRoYXQgd2UgY2FuIGRldGVjdCB3aGVuIG9iamVj\ndHMKICAgICAgICAvLyBhcmUgdG91Y2hlZCBmb3IgbG9ja2luZyBvciBtYWtp\nbmcgdHJhbnNhY3Rpb25hbAogICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZUNh\ncGFibGUuTE9BRF9SRVFVSVJFRDsKICAgIH0KCiAgICBwdWJsaWMgU3RhdGVN\nYW5hZ2VyIHJlcGxhY2VTdGF0ZU1hbmFnZXIoU3RhdGVNYW5hZ2VyIHNtKSB7\nCiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFj\nY2Vzc2luZ0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIC8vIHBvc3NpYmx5\nIGNoYW5nZSBzdGF0ZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJlZm9y\nZVJlYWQoZmllbGQpOwogICAgICAgICAgICBiZWZvcmVBY2Nlc3NGaWVsZChm\naWVsZCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIGZpZWxkIGJl\nZm9yZSBhY2Nlc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGJlZm9y\nZUFjY2Vzc0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9r\nZXIuaXNBY3RpdmUoKTsKICAgICAgICAgICAgaW50IGxvY2tMZXZlbCA9IGNh\nbGN1bGF0ZUxvY2tMZXZlbChhY3RpdmUsIGZhbHNlLCBudWxsKTsKICAgICAg\nICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAg\nICBsb2FkRmllbGQoZmllbGQsIGxvY2tMZXZlbCwgZmFsc2UsIHRydWUpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhc3NpZ25GaWVsZChm\naWVsZCwgZmFsc2UpOwogICAgICAgICAgICBvYnRhaW5Mb2NrcyhhY3RpdmUs\nIGZhbHNlLCBsb2NrTGV2ZWwsIG51bGwsIG51bGwpOwogICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cg\ndHJhbnNsYXRlKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZGlydHkoU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZCA9\nPSBudWxsKQogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUobmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLWZpZWxkIiwgZmllbGQsCiAgICAgICAg\nICAgICAgICBJbXBsSGVscGVyLmdldE1hbmFnZWRJbnN0YW5jZShfcGMpLmdl\ndENsYXNzKCkpKQogICAgICAgICAgICAgICAgLnNldEZhaWxlZE9iamVjdChn\nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwoKICAgICAgICBkaXJ0eShmbWQuZ2V0\nSW5kZXgoKSwgbnVsbCwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZGlydHkoaW50IGZpZWxkKSB7CiAgICAgICAgZGlydHkoZmllbGQsIG51bGws\nIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBpc0VtYmVkZGVk\nTm90VXBkYXRhYmxlKCkgewogICAgICAgIC8vIGVtYmVkZGFibGUgb2JqZWN0\nIHJldHVybmVkIGZyb20gcXVlcnkgcmVzdWx0IGlzIG5vdCB1cHRhYmxlCiAg\nICAgICAgcmV0dXJuIChfb3duZXIgPT0gbnVsbCAmJiBfb3duZXJJZCAhPSBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdpdmVuIGZp\nZWxkIGRpcnR5LgogICAgICoKICAgICAqIEBwYXJhbSBtdXRhdGUgaWYgbnVs\nbCwgbWF5IGJlIGFuIFNDTyBtdXRhdGlvbjsgaWYgdHJ1ZSwgaXMgY2VydGFp\nbmx5CiAgICAgKiBhIG11dGF0aW9uIChvciBhdCBsZWFzdCB0cmVhdCBhcyBv\nbmUpCiAgICAgKiBAcmV0dXJuIHtAbGluayBCb29sZWFuI0ZBTFNFfSBpZiB0\naGlzIGluc3RhbmNlIHdhcyBhbHJlYWR5IGRpcnR5LAogICAgICogPGNvZGU+\nbnVsbDwvY29kZT4gaWYgaXQgd2FzIGRpcnR5IGJ1dCBub3Qgc2luY2UgZmx1\nc2gsIGFuZAogICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0gaWYgaXQgd2Fz\nIG5vdCBkaXJ0eQogICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gZGlydHko\naW50IGZpZWxkLCBCb29sZWFuIG11dGF0ZSwgYm9vbGVhbiBsb2FkRmV0Y2hH\ncm91cCkgewogICAgICAgIGJvb2xlYW4gbG9ja2VkID0gZmFsc2U7CiAgICAg\nICAgYm9vbGVhbiBuZXdGbHVzaCA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4g\nY2xlYW4gPSBmYWxzZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAg\nICAgICAgaWYgKCFpc05ldygpIHx8IGlzRmx1c2hlZCgpKSB7CiAgICAgICAg\nICAgICAgICBpZiAoZm1kLmdldFVwZGF0ZVN0cmF0ZWd5KCkgPT0gVXBkYXRl\nU3RyYXRlZ2llcy5SRVNUUklDVCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAgICAgICAgICgidXBkYXRlLXJlc3RyaWN0IiwgZm1kKSk7CiAg\nICAgICAgICAgICAgICBpZiAoZm1kLmdldFVwZGF0ZVN0cmF0ZWd5KCkgPT0g\nVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChpc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgIGlmIChp\nc0VtYmVkZGVkTm90VXBkYXRhYmxlKCkpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAg\nICAgICAgICAgICAgKCJjYW50LXVwZGF0ZS1lbWJlZC1pbi1xdWVyeS1yZXN1\nbHQiKSkuc2V0RmFpbGVkT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAg\nIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgLy8gbm90aWZ5IG93bmVyIG9mIGNoYW5n\nZQogICAgICAgICAgICAgICAgICAgIF9vd25lci5kaXJ0eShfb3duZXJJbmRl\neCwgQm9vbGVhbi5UUlVFLCBsb2FkRmV0Y2hHcm91cCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGlzIHRoaXMgYSBkaXJlY3QgbXV0YXRpb24g\nb2YgYW4gc2NvIGZpZWxkPwogICAgICAgICAgICBpZiAobXV0YXRlID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRB\nVEU6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5E\nQVI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUgPSBCb29sZWFuLlRS\nVUU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAg\nICAgICAgICBtdXRhdGUgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKGZtZC5pc0VtYmVkZGVkKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAg\nbXV0YXRlID0gQm9vbGVhbi5GQUxTRTsgLy8gbm90IHNjbwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBwb3NzaWJs\neSBjaGFuZ2Ugc3RhdGUKICAgICAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSBf\nYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgICAgIGNsZWFuID0gIV9zdGF0\nZS5pc0RpcnR5KCk7IC8vIGludGVudGlvbmFsIGRpcmVjdCBhY2Nlc3MKCiAg\nICAgICAgICAgIC8vIGZpcmUgZXZlbnQgZmFzdCBiZWZvcmUgc3RhdGUgY2hh\nbmdlLgogICAgICAgICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgICAgICBm\naXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RJUlRZ\nKTsKICAgICAgICAgICAgaWYgKGFjdGl2ZSkgewogICAgICAgICAgICAgICAg\naWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAgICAg\nICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZU9wdGltaXN0aWNXcml0ZSh0\naGlzLCBmaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJv\nb2xlYW5WYWx1ZSgpKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlV3JpdGUodGhp\ncywgZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZS5ib29s\nZWFuVmFsdWUoKSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZtZC5nZXRN\nYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVO\nVCkgewogICAgICAgICAgICAgICAgaWYgKGlzUGVyc2lzdGVudCgpICYmICFf\nYnJva2VyLmdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJub24tdHJhbnMtd3Jp\ndGUiKSkuc2V0RmFpbGVkT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAg\nIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CgogICAgICAgICAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUuYmVmb3JlTm9udHJhbnNhY3Rpb25hbFdyaXRlKHRo\naXMsIGZpZWxkLAogICAgICAgICAgICAgICAgICAgIG11dGF0ZS5ib29sZWFu\nVmFsdWUoKSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCkgewogICAgICAgICAgICAgICAg\nbmV3Rmx1c2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZKSA9PSAw\nOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRF9ESVJU\nWTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jaygpOwogICAgICAg\nICAgICBsb2NrZWQgPSB0cnVlOwoKICAgICAgICAgICAgLy8gbm90ZSB0aGF0\nIHRoZSBmaWVsZCBpcyBpbiBuZWVkIG9mIGZsdXNoaW5nIGFnYWluLCBhbmQg\ndGVsbCB0aGUKICAgICAgICAgICAgLy8gYnJva2VyIHRvbwogICAgICAgICAg\nICBfZmx1c2guY2xlYXIoZmllbGQpOwogICAgICAgICAgICBfYnJva2VyLnNl\ndERpcnR5KHRoaXMsIG5ld0ZsdXNoICYmICFjbGVhbik7CgogICAgICAgICAg\nICAvLyBzYXZlIHRoZSBmaWVsZCBmb3Igcm9sbGJhY2sgaWYgbmVlZGVkCiAg\nICAgICAgICAgIHNhdmVGaWVsZChmaWVsZCk7CgogICAgICAgICAgICAvLyBk\naXJ0eSB0aGUgZmllbGQgYW5kIG1hcmsgbG9hZGVkOyBsb2FkIGZldGNoIGdy\nb3VwIGlmIG5lZWRlZAogICAgICAgICAgICBpbnQgbG9ja0xldmVsID0gY2Fs\nY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwgdHJ1ZSwgbnVsbCk7CiAgICAgICAg\nICAgIGlmICghX2RpcnR5LmdldChmaWVsZCkpIHsKICAgICAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBfZGly\ndHkuc2V0KGZpZWxkKTsKCiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUg\ndGhlIGZpZWxkJ3MgZmV0Y2ggZ3JvdXAgaXMgbG9hZGVkCiAgICAgICAgICAg\nICAgICBpZiAobG9hZEZldGNoR3JvdXAgJiYgaXNQZXJzaXN0ZW50KCkKICAg\nICAgICAgICAgICAgICAgICAmJiBmbWQuZ2V0TWFuYWdlbWVudCgpID09IGZt\nZC5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICBsb2Fk\nRmllbGQoZmllbGQsIGxvY2tMZXZlbCwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCB0cnVlLCBs\nb2NrTGV2ZWwsIG51bGwsIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRl\nKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAobG9j\na2VkKQogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRS\nVUU7CiAgICAgICAgaWYgKG5ld0ZsdXNoKSB7CiAgICAgICAgICAgIC8vIHRo\naXMgZXZlbnQgY2FuIGJlIGZpcmVkIGxhdGVyIGNhdXNlIHdlJ3JlIGFscmVh\nZHkgZGlydHkuCiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZl\nY3ljbGVFdmVudC5CRUZPUkVfRElSVFlfRkxVU0hFRCk7CiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQm9vbGVh\nbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgcG9zdC1kaXJ0\neSBldmVudHMgYWZ0ZXIgZmllbGQgdmFsdWUgY2hhbmdlcy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gc3RhdHVzIHJldHVybiB2YWx1ZSBmcm9tIHtAbGluayAj\nZGlydHkoaW50LCBCb29sZWFuLCBib29sZWFuKX0KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHBvc3REaXJ0eShCb29sZWFuIHN0YXR1cykgewogICAgICAg\nIGlmIChCb29sZWFuLlRSVUUuZXF1YWxzKHN0YXR1cykpCiAgICAgICAgICAg\nIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9ESVJU\nWSk7CiAgICAgICAgZWxzZSBpZiAoc3RhdHVzID09IG51bGwpCiAgICAgICAg\nICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9E\nSVJUWV9GTFVTSEVEKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVk\nKGludCBmaWVsZCwgT2JqZWN0IHJlbW92ZWQsIGJvb2xlYW4ga2V5KSB7CiAg\nICAgICAgaWYgKHJlbW92ZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBkZXJlZmVyZW5jZSBk\nZXBlbmRlbnQgZmllbGRzLCBkZWxldGUgZW1iZWRkZWQKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgICAgIFZhbHVlTWV0YURhdGEgdm1kID0gKGtleSkgPyBmbWQuZ2V0\nS2V5KCkgOiBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAgICAgICBpZiAodm1k\nLmlzRW1iZWRkZWRQQygpKQogICAgICAgICAgICAgICAgX3NpbmdsZS5kZWxl\ndGUodm1kLCByZW1vdmVkLCBudWxsKTsKICAgICAgICAgICAgZWxzZSBpZiAo\ndm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfQVVUTykKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVyZWZlcmVuY2VE\nZXBlbmRlbnQocmVtb3ZlZCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld1Byb3h5\nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21l\ndGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJu\nYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBuZXdGaWVsZFByb3h5KGZp\nZWxkKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0VHlwZUNvZGUoKSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAg\nICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBqYXZhLnNxbC5EYXRl\nLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgamF2YS5z\ncWwuRGF0ZShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAgICAg\nICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEuc3Fs\nLlRpbWVzdGFtcC5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IGphdmEuc3FsLlRpbWVzdGFtcChTeXN0ZW0uY3VycmVudFRpbWVNaWxs\naXMoKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlw\nZSgpID09IGphdmEuc3FsLlRpbWUuY2xhc3MpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBqYXZhLnNxbC5UaW1lKFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAg\nICAgICAgICAgIHJldHVybiBDYWxlbmRhci5nZXRJbnN0YW5jZSgpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBI\nYXNoTWFwKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RmllbGRQcm94eShpbnQgZmllbGQp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBQcm94eU1hbmFnZXIgbWdyID0gX2Jyb2tlci5n\nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldFByb3h5TWFuYWdl\nckluc3RhbmNlKCk7CiAgICAgICAgT2JqZWN0IGluaXQgPSBmbWQuZ2V0SW5p\ndGlhbGl6ZXIoKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0RhdGVQcm94eShmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3Q2Fs\nZW5kYXJQcm94eShmbWQuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAg\nICAgICAgICAgaW5pdCBpbnN0YW5jZW9mIFRpbWVab25lID8gKFRpbWVab25l\nKSBpbml0IDogbnVsbCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNP\nTExFQ1RJT046CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0NvbGxl\nY3Rpb25Qcm94eShmbWQuZ2V0UHJveHlUeXBlKCksCiAgICAgICAgICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAg\nICAgICAgICAgICAgICAgICBpbml0IGluc3RhbmNlb2YgQ29tcGFyYXRvciA/\nIChDb21wYXJhdG9yKSBpbml0IDogbnVsbCwKICAgICAgICAgICAgICAgICAg\nICAgICAgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0aWJp\nbGl0eUluc3RhbmNlKCkuZ2V0QXV0b09mZigpKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgcmV0dXJuIG1nci5u\nZXdNYXBQcm94eShmbWQuZ2V0UHJveHlUeXBlKCksCiAgICAgICAgICAgICAg\nICAgICAgZm1kLmdldEtleSgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAg\nICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBl\nKCksCiAgICAgICAgICAgICAgICAgICAgaW5pdCBpbnN0YW5jZW9mIENvbXBh\ncmF0b3IgPyAoQ29tcGFyYXRvcikgaW5pdCA6IG51bGwsCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldENv\nbXBhdGliaWxpdHlJbnN0YW5jZSgpLmdldEF1dG9PZmYoKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzRGVmYXVsdFZhbHVlKGludCBmaWVsZCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgYm9vbGVhbiByZXQgPSBfc2luZ2xlLmlzRGVmYXVs\ndFZhbHVlKCk7CiAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAg\nICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBSZWNvcmQgdGhhdCB0aGUgZmllbGQgaXMgZGlydHkgKHdo\naWNoIG1pZ2h0IGxvYWQgREZHKQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVi\nbGljIHZvaWQgc2V0dGluZ0Jvb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBib29sZWFuIGN1clZhbCwgYm9v\nbGVhbiBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNF\nVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwg\nJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQp\nOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFu\nLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAg\nICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXR0aW5nQnl0ZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\naW50IGZpZWxkLAogICAgICAgIGJ5dGUgY3VyVmFsLCBieXRlIG5ld1ZhbCwg\naW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewog\nICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdl\ndChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9v\nbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9\nPSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVCeXRlRmll\nbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChw\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3Rh\ndCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdDaGFy\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAg\nICAgY2hhciBjdXJWYWwsIGNoYXIgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAg\nICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChu\nZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5\nS2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0\neShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAg\nICAgICAgICAgX3NpbmdsZS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgbmV3VmFs\nKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0dGluZ0RvdWJsZUZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJsZSBjdXJW\nYWwsIGRvdWJsZSBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0\nICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBj\ndXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2Uo\nZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBC\nb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBf\nc2luZ2xlLnN0b3JlRG91YmxlRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAg\nICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldHRpbmdGbG9hdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkLAogICAgICAgIGZsb2F0IGN1clZhbCwgZmxvYXQg\nbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVN\nT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9s\nb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAg\nICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxT\nRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9y\nZUZsb2F0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxh\nY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0\nRGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndHRpbmdJbnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVs\nZCwKICAgICAgICBpbnQgY3VyVmFsLCBpbnQgbmV3VmFsLCBpbnQgc2V0KSB7\nCiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAg\nIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9Q\ncmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQg\nPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VS\nKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUludEZpZWxkKGZpZWxkLCBu\nZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nTG9uZ0ZpZWxkKFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGxvbmcgY3Vy\nVmFsLCBsb25nIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQg\nIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1\nclZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShm\naWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJv\nb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVMb25nRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldHRpbmdPYmplY3RGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMsIGludCBmaWVsZCwKICAgICAgICBPYmplY3QgY3VyVmFsLCBPYmplY3Qg\nbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVN\nT1RFKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQo\nZmllbGQpKSB7CiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZh\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAg\nICAgLy8gb25seSBjb21wYXJlIG5ldyB0byBvbGQgdmFsdWVzIGlmIHRoZSBj\nb21wYXJpc29uIGlzIGdvaW5nIHRvCiAgICAgICAgICAgICAgICAvLyBiZSBj\naGVhcCAtLSBkb24ndCBjb21wYXJlIGNvbGxlY3Rpb25zLCBtYXBzLCBVRFRz\nCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5B\nUlJBWToKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1B\nUDoKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3\nVmFsICE9IG51bGwgJiYgbmV3VmFsLmVxdWFscyhjdXJWYWwpKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaWYg\ndGhpcyBpcyBhIGRlcGVuZGVudCB1bmxvYWRlZCBmaWVsZCwgbWFrZSBzdXJl\nIHRvIGxvYWQKICAgICAgICAgICAgICAgIC8vIGl0IG5vdwogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0FVVE8KICAgICAgICAgICAgICAgICAgICB8fCBmbWQu\nZ2V0S2V5KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAgICAgICAg\nICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8KICAgICAgICAgICAg\nICAgICAgICB8fCBmbWQuZ2V0RWxlbWVudCgpLmdldENhc2NhZGVEZWxldGUo\nKQogICAgICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9BVVRPKQogICAgICAgICAgICAgICAgICAgIGN1clZhbCA9IGZldGNoT2Jq\nZWN0RmllbGQoZmllbGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBh\nc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgICAgICBp\nZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lE\nKQogICAgICAgICAgICAgICAgYXNzZXJ0Tm90TWFuYWdlZE9iamVjdElkKG5l\nd1ZhbCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJv\nb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIGlm\nIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAg\nICAgICAgX3NpbmdsZS51bnByb3h5KCk7CiAgICAgICAgICAgICAgICBfc2lu\nZ2xlLmRlcmVmZXJlbmNlRGVwZW5kZW50KCk7CiAgICAgICAgICAgICAgICBf\nc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3Np\nbmdsZS5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAg\nICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAg\nICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXR0aW5nU2hvcnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMsIGludCBmaWVsZCwKICAgICAgICBzaG9ydCBjdXJWYWwsIHNob3J0IG5l\nd1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9U\nRSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAg\nICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0Us\nIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVT\naG9ydEZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNl\nRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERp\ncnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0\naW5nU3RyaW5nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQsCiAgICAgICAgU3RyaW5nIGN1clZhbCwgU3RyaW5nIG5ld1ZhbCwgaW50\nIHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAg\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKG5ld1ZhbCwgY3VyVmFs\nKSAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVs\nZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xl\nYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5n\nbGUuc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEaXNhbGxvd3MgY2hhbmdpbmcgcHJpbWFyeSBrZXkgZmllbGRzIGZv\nciBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhc3NlcnRO\nb1ByaW1hcnlLZXlDaGFuZ2UoaW50IGZpZWxkKSB7CiAgICAgICAgaWYgKF9v\naWQgIT0gbnVsbCAmJiBfbWV0YS5nZXRGaWVsZChmaWVsZCkuaXNQcmltYXJ5\nS2V5KCkpCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoImNo\nYW5nZS1pZGVudGl0eSIpKS5zZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZElu\nc3RhbmNlKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc2FsbG93cyBz\nZXR0aW5nIGFuIG9iamVjdCBpZCBmaWVsZCB0byBhIG1hbmFnZWQgaW5zdGFu\nY2UuCiAgICAgKi8KICAgIHZvaWQgYXNzZXJ0Tm90TWFuYWdlZE9iamVjdElk\nKE9iamVjdCB2YWwpIHsKICAgICAgICBpZiAodmFsICE9IG51bGwKICAgICAg\nICAgICAgJiYgKEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodmFs\nLAogICAgICAgICAgICAgICAgIGdldENvbnRleHQoKS5nZXRDb25maWd1cmF0\naW9uKCkpKS5wY0dldEdlbmVyaWNDb250ZXh0KCkhPSBudWxsKQogICAgICAg\nICAgICB0aHJvdyB0cmFuc2xhdGUobmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJtYW5hZ2VkLW9pZCIsIEV4\nY2VwdGlvbnMudG9TdHJpbmcodmFsKSwKICAgICAgICAgICAgICAgICAgICBF\neGNlcHRpb25zLnRvU3RyaW5nKGdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgog\nICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFnZWRJbnN0\nYW5jZSgpKSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gRGVsZWdhdGUgdG8gRmllbGRNYW5hZ2VyCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgcHJv\ndmlkZWRCb29sZWFuRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgYm9vbGVhbiBjdXJWYWwpIHsKICAgICAgICBfZm0u\nc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcHJvdmlkZWRCeXRlRmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgYnl0ZSBjdXJWYWwpIHsKICAg\nICAgICBfZm0uc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRDaGFyRmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgY2hhciBjdXJWYWwp\nIHsKICAgICAgICBfZm0uc3RvcmVDaGFyRmllbGQoZmllbGQsIGN1clZhbCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlkZWREb3VibGVGaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBkb3Vi\nbGUgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlRG91YmxlRmllbGQoZmll\nbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRG\nbG9hdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIGZsb2F0IGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUZsb2F0\nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncHJvdmlkZWRJbnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBpbnQgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3Jl\nSW50RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgcHJvdmlkZWRMb25nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQsCiAgICAgICAgbG9uZyBjdXJWYWwpIHsKICAgICAgICBfZm0u\nc3RvcmVMb25nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcHJvdmlkZWRPYmplY3RGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBPYmplY3QgY3VyVmFsKSB7CiAg\nICAgICAgX2ZtLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRTaG9ydEZpZWxkKFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIHNob3J0IGN1\nclZhbCkgewogICAgICAgIF9mbS5zdG9yZVNob3J0RmllbGQoZmllbGQsIGN1\nclZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRTdHJpbmdG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAg\nICBTdHJpbmcgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlU3RyaW5nRmll\nbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\ncmVwbGFjZUJvb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGlu\ndCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hCb29sZWFuRmll\nbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBieXRlIHJlcGxhY2VCeXRl\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAg\nICAgICByZXR1cm4gX2ZtLmZldGNoQnl0ZUZpZWxkKGZpZWxkKTsKICAgIH0K\nCiAgICBwdWJsaWMgY2hhciByZXBsYWNlQ2hhckZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5m\nZXRjaENoYXJGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIGRvdWJs\nZSByZXBsYWNlRG91YmxlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoRG91YmxlRmll\nbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBmbG9hdCByZXBsYWNlRmxv\nYXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewog\nICAgICAgIHJldHVybiBfZm0uZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKTsKICAg\nIH0KCiAgICBwdWJsaWMgaW50IHJlcGxhY2VJbnRGaWVsZChQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0u\nZmV0Y2hJbnRGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIGxvbmcg\ncmVwbGFjZUxvbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hMb25nRmllbGQoZmll\nbGQpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgcmVwbGFjZU9iamVjdEZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAg\nICAgcmV0dXJuIF9mbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAgIH0K\nCiAgICBwdWJsaWMgc2hvcnQgcmVwbGFjZVNob3J0RmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2Zt\nLmZldGNoU2hvcnRGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIFN0\ncmluZyByZXBsYWNlU3RyaW5nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBj\nLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoU3RyaW5n\nRmllbGQoZmllbGQpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIEZpZWxk\nTWFuYWdlcgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBib29sZWFuIGZldGNoQm9vbGVhbihpbnQgZmllbGQp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQog\nICAgICAgICAgICByZXR1cm4gZmV0Y2hCb29sZWFuRmllbGQoZmllbGQpOwoK\nICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2Up\nOwogICAgICAgIHJldHVybiAoKEJvb2xlYW4pIGZtZC5nZXRFeHRlcm5hbFZh\nbHVlKHZhbCwgX2Jyb2tlcikpLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGZldGNoQm9vbGVhbkZpZWxkKGludCBmaWVsZCkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRG\naWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxz\nZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoQm9vbGVh\nbkZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJ5dGUg\nZmV0Y2hCeXRlKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1k\nLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaEJ5\ndGVGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZp\nZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBm\nbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5ieXRlVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgYnl0ZSBmZXRjaEJ5dGVGaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAg\nICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxz\nZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRj\naEJ5dGVGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBj\naGFyIGZldGNoQ2hhcihpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAo\nIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0\nY2hDaGFyRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0\nY2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoKENoYXJh\nY3RlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSkuY2hh\nclZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGNoYXIgZmV0Y2hDaGFyRmll\nbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAg\nICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9O\nRSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChf\ncGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5n\nbGUuZmV0Y2hDaGFyRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgZG91YmxlIGZldGNoRG91YmxlKGludCBmaWVsZCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAg\nIHJldHVybiBmZXRjaERvdWJsZUZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2Jq\nZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICBy\nZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jy\nb2tlcikpLmRvdWJsZVZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGRvdWJs\nZSBmZXRjaERvdWJsZUZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0\nKGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9j\na0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAg\nICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIHJldHVybiBfc2luZ2xlLmZldGNoRG91YmxlRmllbGQoZmllbGQpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZmxvYXQgZmV0Y2hGbG9hdChpbnQg\nZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXpl\nZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hGbG9hdEZpZWxkKGZpZWxk\nKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZh\nbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5h\nbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmZsb2F0VmFsdWUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgZmxvYXQgZmV0Y2hGbG9hdEZpZWxkKGludCBmaWVsZCkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVs\nZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7\nCgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoRmxvYXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBpbnQgZmV0Y2hJ\nbnQoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoSW50RmllbGQo\nZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVs\nZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4\ndGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSkuaW50VmFsdWUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGZldGNoSW50RmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxk\nKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsK\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hJbnRGaWVsZChm\naWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBsb25nIGZldGNoTG9u\nZyhpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVy\nbmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hMb25nRmllbGQo\nZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVs\nZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4\ndGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSkubG9uZ1ZhbHVlKCk7CiAgICB9\nCgogICAgcHVibGljIGxvbmcgZmV0Y2hMb25nRmllbGQoaW50IGZpZWxkKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZp\nZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNl\nKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hMb25nRmll\nbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZl\ndGNoT2JqZWN0KGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1k\nLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaE9i\namVjdEZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNo\nRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gZm1kLmdldEV4\ndGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGZldGNoT2JqZWN0RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRl\nZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxk\nLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAg\nICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hPYmplY3RGaWVsZChmaWVs\nZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzaG9ydCBmZXRjaFNob3J0\nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21l\ndGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJu\nYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaFNob3J0RmllbGQo\nZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVs\nZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4\ndGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSkuc2hvcnRWYWx1ZSgpOwogICAg\nfQoKICAgIHB1YmxpYyBzaG9ydCBmZXRjaFNob3J0RmllbGQoaW50IGZpZWxk\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9h\nZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZh\nbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTaG9y\ndEZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyBmZXRjaFN0cmluZyhpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAo\nIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0\nY2hTdHJpbmdGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBm\nZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIChTdHJp\nbmcpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAgICB9\nCgogICAgcHVibGljIFN0cmluZyBmZXRjaFN0cmluZ0ZpZWxkKGludCBmaWVs\nZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxv\nYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBm\nYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xl\nLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoU3Ry\naW5nRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdG9yZUJvb2xlYW4oaW50IGZpZWxkLCBib29sZWFuIGV4dGVybmFsVmFs\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGV4dGVybmFs\nVmFsKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9\nIChleHRlcm5hbFZhbCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRW\nYWx1ZSh2YWwsIF9icm9rZXIpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RvcmVCb29sZWFuRmllbGQoaW50IGZpZWxkLCBib29sZWFu\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAg\nICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVCeXRlKGludCBmaWVsZCwgYnl0ZSBl\neHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21l\ndGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJu\nYWxpemVkKCkpCiAgICAgICAgICAgIHN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBl\neHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZp\nZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgQnl0ZShleHRlcm5h\nbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVCeXRlRmllbGQoaW50IGZpZWxkLCBieXRlIGN1\nclZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBfc2luZ2xlLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwog\nICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7\nCiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAg\nICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVDaGFyKGludCBmaWVsZCwgY2hhciBleHRlcm5h\nbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHN0b3JlQ2hhckZpZWxkKGZpZWxkLCBleHRlcm5h\nbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZp\nZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgQ2hhcmFjdGVyKGV4dGVybmFs\nVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZUNoYXJGaWVsZChpbnQgZmllbGQsIGNoYXIgY3Vy\nVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIF9zaW5nbGUuc3RvcmVDaGFyRmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAg\nICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZURvdWJsZShpbnQgZmllbGQsIGRvdWJsZSBleHRl\ncm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxp\nemVkKCkpCiAgICAgICAgICAgIHN0b3JlRG91YmxlRmllbGQoZmllbGQsIGV4\ndGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmll\nbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBEb3VibGUoZXh0ZXJu\nYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHN0b3JlRG91YmxlRmllbGQoaW50IGZpZWxkLCBkb3Vi\nbGUgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIF9zaW5nbGUuc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwog\nICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXQoaW50IGZpZWxkLCBmbG9h\ndCBleHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0\nZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0b3JlRmxvYXRGaWVsZChmaWVs\nZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rv\ncmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IEZsb2F0KGV4\ndGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZUZsb2F0RmllbGQoaW50IGZpZWxkLCBm\nbG9hdCBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGN1\nclZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsK\nICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUludChpbnQgZmllbGQsIGludCBl\neHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21l\ndGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJu\nYWxpemVkKCkpCiAgICAgICAgICAgIHN0b3JlSW50RmllbGQoZmllbGQsIGV4\ndGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmll\nbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKE51bWJlcnMudmFsdWVPZihl\neHRlcm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVJbnRGaWVsZChpbnQgZmllbGQsIGlu\ndCBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3NpbmdsZS5zdG9yZUludEZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAg\nICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RvcmVMb25nKGludCBmaWVsZCwgbG9uZyBleHRl\ncm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxp\nemVkKCkpCiAgICAgICAgICAgIHN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBleHRl\ncm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxk\nKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShOdW1iZXJzLnZhbHVlT2YoZXh0\nZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlTG9uZ0ZpZWxkKGludCBmaWVsZCwgbG9u\nZyBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3NpbmdsZS5zdG9yZUxvbmdGaWVsZChmaWVsZCwgY3VyVmFs\nKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAg\nICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlT2JqZWN0KGludCBmaWVsZCwgT2JqZWN0\nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgZXh0ZXJuYWxWYWwgPSBm\nbWQub3JkZXIoZXh0ZXJuYWxWYWwpOwogICAgICAgIGlmICghZm1kLmlzRXh0\nZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0b3JlT2JqZWN0RmllbGQoZmll\nbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0\nb3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKGV4dGVybmFsVmFs\nLCBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVPYmpl\nY3RGaWVsZChpbnQgZmllbGQsIE9iamVjdCBjdXJWYWwpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9y\nZU9iamVjdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBfc2lu\nZ2xlLnByb3h5KHRydWUsIGZhbHNlKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2Fk\nZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwg\nbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hv\ncnQoaW50IGZpZWxkLCBzaG9ydCBleHRlcm5hbFZhbCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0\nb3JlU2hvcnRGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxk\nVmFsdWUobmV3IFNob3J0KGV4dGVybmFsVmFsKSwKICAgICAgICAgICAgICAg\nIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0\nRmllbGQoaW50IGZpZWxkLCBzaG9ydCBjdXJWYWwpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVNo\nb3J0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9h\nZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQs\nIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZVN0\ncmluZyhpbnQgZmllbGQsIFN0cmluZyBleHRlcm5hbFZhbCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAg\nIHN0b3JlU3RyaW5nRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRG\naWVsZFZhbHVlKGV4dGVybmFsVmFsLCBfYnJva2VyKSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVTdHJpbmdGaWVsZChpbnQgZmllbGQsIFN0cmlu\nZyBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3NpbmdsZS5zdG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAg\nICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTdG9yZSB0aGUgZ2l2ZW4gZmllbGQgdmFsdWUg\naW50byB0aGUgZ2l2ZW4gZmllbGQgbWFuYWdlci4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHN0b3JlRmllbGQoaW50IGZpZWxkLCBPYmplY3QgdmFsLCBG\naWVsZE1hbmFnZXIgZm0pIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoZm1kID09IG51\nbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1maWVsZC1pbmRleCIsCiAgICAgICAgICAgICAgICBTdHJpbmcu\ndmFsdWVPZihmaWVsZCksIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpLgog\nICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFnZWRJbnN0\nYW5jZSgpKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46\nCiAgICAgICAgICAgICAgICBib29sZWFuIGJvb2wgPSB2YWwgIT0gbnVsbCAm\nJiAoKEJvb2xlYW4pIHZhbCkuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAg\nICAgICBmbS5zdG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgYm9vbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURToKICAgICAgICAgICAgICAgIGJ5dGUgYiA9ICh2YWwgPT0gbnVsbCkg\nPyAwIDogKChOdW1iZXIpIHZhbCkuYnl0ZVZhbHVlKCk7CiAgICAgICAgICAg\nICAgICBmbS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgYik7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoK\nICAgICAgICAgICAgICAgIGNoYXIgYyA9ICh2YWwgPT0gbnVsbCkgPyAwIDog\nKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCk7CiAgICAgICAgICAgICAg\nICBmbS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgYyk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgog\nICAgICAgICAgICAgICAgZG91YmxlIGQgPSAodmFsID09IG51bGwpID8gMCA6\nICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCk7CiAgICAgICAgICAgICAg\nICBmbS5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBkKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgICAgIGZsb2F0IGYgPSAodmFsID09IG51bGwpID8gMCA6\nICgoTnVtYmVyKSB2YWwpLmZsb2F0VmFsdWUoKTsKICAgICAgICAgICAgICAg\nIGZtLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgZik7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAg\nICAgICAgICAgICAgaW50IGkgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVt\nYmVyKSB2YWwpLmludFZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9y\nZUludEZpZWxkKGZpZWxkLCBpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAg\nICAgbG9uZyBsID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFs\nKS5sb25nVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlTG9uZ0Zp\nZWxkKGZpZWxkLCBsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHNo\nb3J0IHMgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLnNo\nb3J0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlU2hvcnRGaWVs\nZChmaWVsZCwgcyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgZm0u\nc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgKFN0cmluZykgdmFsKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgZm0uc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgdmFsKTsKICAg\nICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0\naWVzCiAgICAvLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBFcmFzZSB0\naGUgZmFjdCB0aGF0IHRoaXMgaW5zdGFuY2UgaGFzIGJlZW4gZmx1c2hlZC4K\nICAgICAqLwogICAgdm9pZCBlcmFzZUZsdXNoKCkgewogICAgICAgIF9mbGFn\ncyAmPSB+RkxBR19GTFVTSEVEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19G\nTFVTSEVEX0RJUlRZOwoKICAgICAgICBpbnQgZm1kcyA9IF9tZXRhLmdldEZp\nZWxkcygpLmxlbmd0aDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHM7IGkrKykKICAgICAgICAgICAgX2ZsdXNoLmNsZWFyKGkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVjb3JkcyB0aGF0IGFsbCBpbnN0YW5jZSBmaWVs\nZHMgYXJlL2FyZSBub3QgbG9hZGVkLgogICAgICogUHJpbWFyeSBrZXkgYW5k\nIG5vbi1wZXJzaXN0ZW50IGZpZWxkcyBhcmUgbm90IGFmZmVjdGVkLgogICAg\nICovCiAgICB2b2lkIHNldExvYWRlZChib29sZWFuIHZhbCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKQogICAg\nICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkgPT0gZm1k\nc1tpXS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgIHNldExv\nYWRlZChpLCB2YWwpOwogICAgICAgIH0KICAgICAgICBpZiAoIXZhbCkgewog\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfTE9BREVEOwogICAgICAgICAg\nICBzZXREaXJ0eShmYWxzZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX0xPQURFRDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlY29yZHMgdGhhdCBhbGwgaW5zdGFuY2UgZmllbGRzIGFyZS9hcmUgbm90\nIGRpcnR5LAogICAgICogYW5kIGNoYW5nZXMgdGhlIGZsYWdzIG9mIHRoZSBp\nbnN0YW5jZSBhY2NvcmRpbmdseS4KICAgICAqLwogICAgdm9pZCBzZXREaXJ0\neShib29sZWFuIHZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgYm9vbGVhbiB1cGRhdGUg\nPSAhaXNOZXcoKSB8fCBpc0ZsdXNoZWQoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKHZhbCAmJiAoIXVwZGF0ZQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5n\nZXRVcGRhdGVTdHJhdGVneSgpICE9IFVwZGF0ZVN0cmF0ZWdpZXMuSUdOT1JF\nKSkKICAgICAgICAgICAgICAgIF9kaXJ0eS5zZXQoaSk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKCF2YWwpIHsKICAgICAgICAgICAgICAgIC8vIHdlIG5ldmVy\nIGNvbnNpZGVyIGNsZWFuIGZpZWxkcyBmbHVzaGVkOyB0aGlzIGFsc28gdGFr\nZXMKICAgICAgICAgICAgICAgIC8vIGNhcmUgb2YgY2xlYXJpbmcgdGhlIGZs\ndXNoZWQgZmllbGRzIG9uIGNvbW1pdC9yb2xsYmFjawogICAgICAgICAgICAg\nICAgX2ZsdXNoLmNsZWFyKGkpOwogICAgICAgICAgICAgICAgX2RpcnR5LmNs\nZWFyKGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\ndmFsKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBFeGVjdXRlcyBwcmUtY2xlYXIgY2FsbGJhY2tz\nLCBjbGVhcnMgYWxsIG1hbmFnZWQgZmllbGRzLCBhbmQgY2FsbHMgdGhlCiAg\nICAgKiB7QGxpbmsgI3NldExvYWRlZH0gbWV0aG9kIHdpdGggYSB2YWx1ZSBv\nZiBmYWxzZS4gUHJpbWFyeSBrZXkgZmllbGRzCiAgICAgKiBhcmUgbm90IGNs\nZWFyZWQuCiAgICAgKi8KICAgIHZvaWQgY2xlYXJGaWVsZHMoKSB7CiAgICAg\nICAgaWYgKCFpc0ludGVyY2VwdGluZygpKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5C\nRUZPUkVfQ0xFQVIpOwoKICAgICAgICAvLyB1bnByb3h5IGFsbCBmaWVsZHMK\nICAgICAgICB1bnByb3h5RmllbGRzKCk7CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBjbGVhciBub24tcGsgZmllbGRz\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKCFmbWRzW2ld\nLmlzUHJpbWFyeUtleSgpICYmIGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpCiAg\nICAgICAgICAgICAgICAgICAgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVS\nU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3Bj\nLCBDbGVhckZpZWxkTWFuYWdlci5nZXRJbnN0YW5jZSgpLCBpKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gZm9yZ2V0IHZlcnNpb24gaW5mbyBh\nbmQgaW1wbCBkYXRhIHNvIHdlIHJlLXJlYWQgbmV4dCB0aW1lCiAgICAgICAg\nICAgIHNldExvYWRlZChmYWxzZSk7CiAgICAgICAgICAgIF92ZXJzaW9uID0g\nbnVsbDsKICAgICAgICAgICAgX2xvYWRWZXJzaW9uID0gbnVsbDsKICAgICAg\nICAgICAgaWYgKF9maWVsZEltcGwgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIEFycmF5cy5maWxsKF9maWVsZEltcGwsIG51bGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KCiAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0NM\nRUFSKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZCB0aGF0IHdlIHNo\nb3VsZCBzYXZlIGFueSBmaWVsZHMgdGhhdCBjaGFuZ2UgZnJvbSB0aGlzIHBv\naW50CiAgICAgKiBmb3J3YXJkLgogICAgICovCiAgICB2b2lkIHNhdmVGaWVs\nZHMoYm9vbGVhbiBpbW1lZGlhdGUpIHsKICAgICAgICBpZiAoX2Jyb2tlci5n\nZXRSZXN0b3JlU3RhdGUoKSA9PSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05F\nCiAgICAgICAgICAgICYmIChfZmxhZ3MgJiBGTEFHX0lOVkVSU0VTKSA9PSAw\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIF9mbGFncyB8PSBGTEFH\nX1NBVkU7CiAgICAgICAgaWYgKGltbWVkaWF0ZSkgewogICAgICAgICAgICBm\nb3IgKGludCBpID0gMCwgbGVuID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxl\nbjsgaSsrKQogICAgICAgICAgICAgICAgc2F2ZUZpZWxkKGkpOwogICAgICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfU0FWRTsKICAgICAgICAgICAgLy8gT1BF\nTkpQQS02NTkKICAgICAgICAgICAgLy8gcmVjb3JkIGEgc2F2ZWQgZmllbGQg\nbWFuYWdlciBldmVuIGlmIG5vIGZpZWxkIGlzIGN1cnJlbnRseSBsb2FkZWQK\nICAgICAgICAgICAgLy8gYXMgZXhpc3RlbmNlIG9mIGEgU2F2ZUZpZWxkTWFu\nYWdlciBpcyBjcml0aWNhbCBmb3IgYSBkaXJ0eSBjaGVjawogICAgICAgICAg\nICBpZiAoX3NhdmVkID09IG51bGwpCiAgICAgICAgICAgIAlfc2F2ZWQgPSBu\nZXcgU2F2ZUZpZWxkTWFuYWdlcih0aGlzLCBnZXRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKSwgCiAgICAgICAgICAgIAkJCQlfZGlydHkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBmaWVsZCBpc24ndCBhbHJlYWR5\nIHNhdmVkLCBzYXZlcyB0aGUgY3VycmVudGx5IGxvYWRlZCBmaWVsZAogICAg\nICogc3RhdGUgb2YgdGhlIGluc3RhbmNlLiBUaGUgc2F2ZWQgdmFsdWVzIGNh\nbiBhbGwgYmUgcmVzdG9yZWQgdmlhCiAgICAgKiB7QGxpbmsgI3Jlc3RvcmVG\naWVsZHN9LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2F2ZUZpZWxkKGlu\ndCBmaWVsZCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TQVZFKSA9\nPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIHRoaXMg\naXMgYSBtYW5hZ2VkIGludmVyc2UgZmllbGQsIGxvYWQgaXQgc28gd2UncmUg\nc3VyZSB0byBoYXZlCiAgICAgICAgLy8gdGhlIG9yaWdpbmFsIHZhbHVlCiAg\nICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkgJiYgKChfZmxhZ3MgJiBG\nTEFHX0lOVkVSU0VTKSAhPSAwCiAgICAgICAgICAgICYmIF9tZXRhLmdldEZp\nZWxkKGZpZWxkKS5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID4gMCkp\nCiAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NL\nX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgIC8vIGRvbid0IGJvdGhl\nciBjcmVhdGluZyB0aGUgc2F2ZSBmaWVsZCBtYW5hZ2VyIGlmIHdlJ3JlIG5v\ndCBnb2luZyB0bwogICAgICAgIC8vIHNhdmUgdGhlIG9sZCBmaWVsZCB2YWx1\nZSBhbnl3YXkKICAgICAgICBpZiAoX3NhdmVkID09IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAg\nIF9zYXZlZCA9IG5ldyBTYXZlRmllbGRNYW5hZ2VyKHRoaXMsIG51bGwsIF9k\naXJ0eSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIC8vIGNvcHkgdGhlIGZpZWxkIHRvIHNh\ndmUgZmllbGQgbWFuYWdlcjsgaWYgdGhlIGZpZWxkIGlzIG5vdCBkaXJlY3Rs\neQogICAgICAgIC8vIGNvcHlhYmxlLCBpbW1lZGlhdGVseSBwcm92aWRlIGFu\nZCByZXBsYWNlIGl0IHZpYSB0aGUgc2F2ZSBmaWVsZAogICAgICAgIC8vIG1h\nbmFnZXIsIHdoaWNoIHdpbGwgY29weSB0aGUgbXV0YWJsZSB2YWx1ZSB0byBw\ncmV2ZW50IGJ5LXJlZiBtb2RzCiAgICAgICAgaWYgKF9zYXZlZC5zYXZlRmll\nbGQoZmllbGQpKSB7CiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9z\nYXZlZCwgZmllbGQpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3NhdmVk\nLmdldFN0YXRlKCksIF9zYXZlZCwgZmllbGQpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHRoZSBzdGF0ZSB3\naWxsIG5vdCBuZWVkIHRvIGJlIHJvbGxlZCBiYWNrCiAgICAgKiB0byB0aGF0\nIG9mIHRoZSBsYXN0IGNhbGwgdG8ge0BsaW5rICNzYXZlRmllbGRzfS4KICAg\nICAqLwogICAgdm9pZCBjbGVhclNhdmVkRmllbGRzKCkgewogICAgICAgIGlm\nIChpc0ludGVyY2VwdGluZygpKSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+\nRkxBR19TQVZFOwogICAgICAgICAgICBfc2F2ZWQgPSBudWxsOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgU2F2ZUZpZWxkTWFuYWdlciBnZXRTYXZl\nRmllbGRNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfc2F2ZWQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSb2xsYmFjayB0aGUgc3RhdGUgb2YgdGhlIGlu\nc3RhbmNlIHRvIHRoZSBzYXZlZCBzdGF0ZSBmcm9tIHRoZQogICAgICogbGFz\ndCBjYWxsIHRvIHtAbGluayAjc2F2ZUZpZWxkc30sIG9yIHRvIGRlZmF1bHQg\ndmFsdWVzIGlmIG5ldmVyIHNhdmVkLgogICAgICovCiAgICB2b2lkIHJlc3Rv\ncmVGaWVsZHMoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChfc2F2ZWQgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NBVkUpID09IDApCiAgICAgICAgICAg\nICAgICAgICAgY2xlYXJGaWVsZHMoKTsKICAgICAgICAgICAgICAgIGVsc2Ug\nLy8gb25seSB1bmxvYWRlZCBmaWVsZHMgd2VyZSBkaXJ0aWVkCiAgICAgICAg\nICAgICAgICAgICAgX2xvYWRlZC5hbmROb3QoX2xvYWRlZCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gd2UgZGlyZWN0IHN0YXRlIHRyYW5zaXRp\nb25zIGJhc2VkIG9uIG91ciBvd24gZ2V0UmVzdG9yZVN0YXRlCiAgICAgICAg\nICAgIC8vIG1ldGhvZCwgYnV0IHRvIGRlY2lkZSB3aGV0aGVyIHRvIGFjdHVh\nbGx5IHJvbGxiYWNrIGZpZWxkCiAgICAgICAgICAgIC8vIHZhbHVlcywgd2Ug\nY29uc3VsdCB0aGUgYnJva2VyIGZvciB0aGUgdXNlcidzIHNldHRpbmcKICAg\nICAgICAgICAgZWxzZSBpZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3RhdGUoKSAh\nPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05FKSB7CiAgICAgICAgICAgICAg\nICAvLyByb2xsYmFjayBhbGwgY3VycmVudGx5LWxvYWRlZCBmaWVsZHMKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxl\nbmd0aCgpOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9sb2FkZWQuZ2V0KGkpICYmIF9zYXZlZC5yZXN0b3JlRmllbGQoaSkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zYXZl\nZCwgaSk7CgogICAgICAgICAgICAgICAgLy8gcm9sbGJhY2sgbG9hZGVkIHNl\ndAogICAgICAgICAgICAgICAgX2xvYWRlZC5hbmROb3QoX3NhdmVkLmdldFVu\nbG9hZGVkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXBsYWNlcyBhbGwgc2Vjb25kIGNsYXNzIG9i\namVjdCBmaWVsZHMgd2l0aCBmcmVzaCBwcm94aWVkIGluc3RhbmNlcwogICAg\nICogY29udGFpbmluZyB0aGUgc2FtZSBpbmZvcm1hdGlvbiBhcyB0aGUgb3Jp\nZ2luYWxzLgogICAgICovCiAgICB2b2lkIHByb3h5RmllbGRzKGJvb2xlYW4g\ncmVzZXQsIGJvb2xlYW4gcmVwbGFjZU51bGwpIHsKICAgICAgICAvLyB3ZSBv\nbmx5IHJlcGxhY2UgbnVsbHMgaWYgdGhlIHJ1bnRpbWUgY2FuJ3QgZGlmZmVy\nZW50aWF0ZSBiZXR3ZWVuCiAgICAgICAgLy8gbnVsbCBhbmQgZW1wdHkgY29u\ndGFpbmVycy4gIHdlIHJlcGxhY2UgbnVsbHMgaW4gdGhpcyBjYXNlIHRvCiAg\nICAgICAgLy8gbWFpbnRhaW4gY29uc2lzdGVuY3kgd2hldGhlciB2YWx1ZXMg\nYXJlIGJlaW5nIHJldGFpbmVkIG9yIG5vdAogICAgICAgIGlmIChyZXBsYWNl\nTnVsbCkKICAgICAgICAgICAgcmVwbGFjZU51bGwgPSAhX2Jyb2tlci5nZXRD\nb25maWd1cmF0aW9uKCkuc3VwcG9ydGVkT3B0aW9ucygpLgogICAgICAgICAg\nICAgICAgY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BUSU9OX05V\nTExfQ09OVEFJTkVSKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxl\nbmd0aCgpOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChf\nbG9hZGVkLmdldChpKSkgewogICAgICAgICAgICAgICAgICAgIHByb3ZpZGVG\naWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChfc2luZ2xlLnByb3h5KHJlc2V0LCByZXBsYWNlTnVsbCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGkp\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVW5wcm94\neSBhbGwgZmllbGRzLgogICAgICovCiAgICB2b2lkIHVucHJveHlGaWVsZHMo\nKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX05PX1VOUFJPWFkpICE9\nIDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBf\nbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAg\nICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAg\nICAgICAgX3NpbmdsZS51bnByb3h5KCk7CiAgICAgICAgICAgICAgICBfc2lu\nZ2xlLnJlbGVhc2VFbWJlZGRlZCgpOwogICAgICAgICAgICAgICAgX3Npbmds\nZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZXQgcmVhZHkgZm9yIGEgZmx1c2guIFBlcnNp\nc3RzIGFsbCBwZXJzaXN0ZW5jZS1jYXBhYmxlIG9iamVjdCBmaWVsZHMsCiAg\nICAgKiBhbmQgY2hlY2tzIGZvciBpbGxlZ2FsIG51bGwgdmFsdWVzLiBBbHNv\nIGFzc2lnbnMgb2lkcyBhbmQgZmllbGQgdmFsdWVzCiAgICAgKiBmb3IgYWxs\nIHN0cmF0ZWdpZXMgdGhhdCBkb24ndCByZXF1aXJlIGZsdXNoaW5nLgogICAg\nICovCiAgICB2b2lkIHByZUZsdXNoKGJvb2xlYW4gbG9naWNhbCwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVf\nRkxVU0hFRCkgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBp\nZiAoaXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgZmlyZUxpZmVjeWNs\nZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9TVE9SRSk7CiAgICAgICAg\nICAgIC8vIEJFRk9SRV9QRVJTSVNUIGlzIGhhbmRsZWQgZHVyaW5nIEJyb2tl\nci5wZXJzaXN0IGFuZCBCcm9rZXIuYXR0YWNoCiAgICAgICAgICAgIGlmIChp\nc0RlbGV0ZWQoKSkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVu\ndChMaWZlY3ljbGVFdmVudC5CRUZPUkVfREVMRVRFKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoIShpc05ldygpICYmICFpc0ZsdXNoZWQoKSkKCQkJCSYmIChJ\nbXBsSGVscGVyLmdldFVwZGF0ZUZpZWxkcyh0aGlzKSAhPSBudWxsKSkKICAg\nICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVu\ndC5CRUZPUkVfVVBEQVRFKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nUFJFX0ZMVVNIRUQ7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFsb2dpY2FsKQogICAgICAgICAg\nICAgICAgYXNzaWduT2JqZWN0SWQoZmFsc2UsIHRydWUpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMCwgbGVuID0gX21ldGEuZ2V0RmllbGRzKCkubGVu\nZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICgobG9n\naWNhbCB8fCAhYXNzaWduRmllbGQoaSwgdHJ1ZSkpICYmICFfZmx1c2guZ2V0\nKGkpCiAgICAgICAgICAgICAgICAgICAgJiYgX2RpcnR5LmdldChpKSkgewog\nICAgICAgICAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUs\nIGkpOwogICAgICAgICAgICAgICAgICAgIGlmIChfc2luZ2xlLnByZUZsdXNo\nKGxvZ2ljYWwsIGNhbGwpKQogICAgICAgICAgICAgICAgICAgICAgICByZXBs\nYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIo\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgZGlydHlDaGVjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE1ha2UgY2FsbGJhY2tzIGZvciBkZWxldGlvbi4KICAgICAqLwogICAgdm9p\nZCBwcmVEZWxldGUoKSB7CiAgICAgICAgLy8gc2V0IGEgZmxhZyB3aGlsZSBj\nYWxsIHByZSBkZWxldGUgY2FsbGJhY2sgc28gdGhhdCB1c2VyIGNhbid0CiAg\nICAgICAgLy8gZ2V0IGludG8gaW5maW5pdGUgcmVjdXJzaW9uIGJ5IGNhbGxp\nbmcgZGVsZXRlKHRoaXMpCiAgICAgICAgLy8gd2l0aGluIGhpcyBjYWxsYmFj\nayBtZXRob2QKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFX0RFTEVU\nSU5HKSA9PSAwKSB7CiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1BSRV9E\nRUxFVElORzsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZp\ncmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfREVMRVRF\nKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9m\nbGFncyAmPSB+RkxBR19QUkVfREVMRVRJTkc7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDYXNjYWRlIGRlbGV0ZXMg\nYW5kIGRlcmVmZXJlbmNlIGRlcGVuZGVudCBmaWVsZHMuCiAgICAgKi8KICAg\nIHZvaWQgY2FzY2FkZURlbGV0ZShPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZURlbGV0ZSgp\nICE9IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FCiAgICAgICAgICAgICAg\nICB8fCBmbWRzW2ldLmdldEtleSgpLmdldENhc2NhZGVEZWxldGUoKQogICAg\nICAgICAgICAgICAgIT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUKICAg\nICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2Nh\nZGVEZWxldGUoKQogICAgICAgICAgICAgICAgIT0gVmFsdWVNZXRhRGF0YS5D\nQVNDQURFX05PTkUpIHsKICAgICAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVP\nYmplY3RGaWVsZChpLCBmZXRjaEZpZWxkKGksIGZhbHNlKSk7CiAgICAgICAg\nICAgICAgICBfc2luZ2xlLmRlbGV0ZShjYWxsKTsKICAgICAgICAgICAgICAg\nIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENhbGxlZCBhZnRlciBhbiBpbnN0YW5jZSBp\ncyBwZXJzaXN0ZWQgYnkgYSB1c2VyIHRocm91Z2ggdGhlIGJyb2tlci4KICAg\nICAqIENhc2NhZGVzIHRoZSBwZXJzaXN0IG9wZXJhdGlvbiB0byBmaWVsZHMg\nbWFya2VkCiAgICAgKiB7QGxpbmsgVmFsdWVNZXRhRGF0YSNDQVNDQURFX0lN\nTUVESUFURX0uCiAgICAgKi8KICAgIHZvaWQgY2FzY2FkZVBlcnNpc3QoT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghX2xv\nYWRlZC5nZXQoaSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIGlmIChmbWRzW2ldLmdldENhc2NhZGVQZXJzaXN0KCkgPT0gVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAgICAgICAgfHwg\nZm1kc1tpXS5nZXRLZXkoKS5nZXRDYXNjYWRlUGVyc2lzdCgpID09IFZhbHVl\nTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUKICAgICAgICAgICAgIHx8IGZt\nZHNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2NhZGVQZXJzaXN0KCkgPT0gVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAgICAg\nICAgX3NpbmdsZS5zdG9yZU9iamVjdEZpZWxkKGksIGZldGNoRmllbGQoaSwg\nZmFsc2UpKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUucGVyc2lzdChjYWxs\nKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhl\nIGdpdmVuIGZpZWxkIHNldCBmcm9tIHRoZSBkYXRhIHN0b3JlIGludG8gdGhl\nIGluc3RhbmNlLgogICAgICogUmV0dXJuIHRydWUgaWYgYW55IGRhdGEgaXMg\nbG9hZGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGJvb2xlYW4g\nbG9hZEZpZWxkcyhCaXRTZXQgZmllbGRzLCBGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGludCBsb2NrTGV2ZWwsCiAgICAgICAgT2JqZWN0IHNkYXRhKSB7\nCiAgICAgICAgLy8gY2FuJ3QgbG9hZCB2ZXJzaW9uIGZpZWxkIGZyb20gc3Rv\ncmUKICAgICAgICBpZiAoZmllbGRzICE9IG51bGwpIHsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSB2ZmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQo\nKTsKICAgICAgICAgICAgaWYgKHZmaWVsZCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgZmllbGRzLmNsZWFyKHZmaWVsZC5nZXRJbmRleCgpKTsKICAgICAg\nICB9CgogICAgICAgIGJvb2xlYW4gcmV0ID0gZmFsc2U7CiAgICAgICAgc2V0\nTG9hZGluZyh0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBp\nZiBhbnkgZmllbGRzIGdpdmVuLCBsb2FkIHRoZW0KICAgICAgICAgICAgaW50\nIGxlbiA9IChmaWVsZHMgPT0gbnVsbCkgPyAwIDogZmllbGRzLmxlbmd0aCgp\nOwogICAgICAgICAgICBpZiAobGVuID4gMCkgewogICAgICAgICAgICAgICAg\naWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZmV0Y2gg\nPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgICAg\nICAgICAgaWYgKCFfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmxvYWQodGhp\ncywgZmllbGRzLCBmZXRjaCwgbG9ja0xldmVsLCBzZGF0YSkpIHsKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRp\nb24oX2xvYy5nZXQoImRlbC1pbnN0YW5jZSIsIF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwgX29pZCkpLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHZlcnNpb24gaW5mb3Jt\nYXRpb24gaGFzIGJlZW4gc2V0OyB2ZXJzaW9uIGluZm8gbXVzdAogICAgICAg\nICAgICAvLyBhbHdheXMgYmUgc2V0IGFmdGVyIHRoZSBmaXJzdCBzdGF0ZSBs\nb2FkIG9yIHNldCAod2hpY2ggaXMgd2h5CiAgICAgICAgICAgIC8vIHdlIGRv\nIHRoaXMgZXZlbiBpZiBubyBmaWVsZHMgd2VyZSBsb2FkZWQgLS0gY291bGQg\nYmUgdGhhdCB0aGlzCiAgICAgICAgICAgIC8vIG1ldGhvZCBpcyBiZWluZyBj\nYWxsZWQgYWZ0ZXIgYSBmaWVsZCBpcyBzZXQpCiAgICAgICAgICAgIGlmIChf\nbG9hZFZlcnNpb24gPT0gbnVsbCAmJiAoX21ldGEgPT0gbnVsbCB8fCBfbWV0\nYS5nZXRWZXJzaW9uRmllbGQoKSAhPSBudWxsKSkgewogICAgICAgICAgICAg\nICAgc3luY1ZlcnNpb24oc2RhdGEpOwogICAgICAgICAgICAgICAgcmV0ID0g\ncmV0IHx8IF9sb2FkVmVyc2lvbiAhPSBudWxsOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBzZXRMb2Fk\naW5nKGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIC8vIHNlZSBpZiB0aGUg\nZGZnIGlzIG5vdyBsb2FkZWQ7IGRvIHRoaXMgcmVnYXJkbGVzcyBvZiB3aGV0\naGVyIHdlCiAgICAgICAgLy8gbG9hZGVkIGFueSBmaWVsZHMsIGNhdXNlIG1h\neSBhbHJlYWR5IGhhdmUgYmVlbiBsb2FkZWQgYnkKICAgICAgICAvLyBTdG9y\nZU1hbmFnZXIgZHVyaW5nIGluaXRpYWxpemF0aW9uCiAgICAgICAgcG9zdExv\nYWQoLTEsIGZldGNoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAg\nIC8qKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gZmllbGQncyBmZXRjaCBncm91\ncDsgdGhlIGZpZWxkIGl0c2VsZiBtYXkgYWxyZWFkeSBiZQogICAgICogbG9h\nZGVkIGlmIGl0IGlzIGJlaW5nIHNldCBieSB0aGUgdXNlci4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgbG9hZEZpZWxkKGludCBmaWVsZCwgaW50IGxv\nY2tMZXZlbCwgYm9vbGVhbiBmb3JXcml0ZSwKICAgICAgICBib29sZWFuIGZn\ncykgewogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IF9icm9r\nZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgQml0\nU2V0IGZpZWxkcyA9IG51bGw7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBk\nZmcgZmllbGQgb3Igd2UgbmVlZCB0byBsb2FkIG91ciBkZmcsIGRvIHNvCiAg\nICAgICAgaWYgKGZncyAmJiAoX2ZsYWdzICYgRkxBR19MT0FERUQpID09IDAp\nCiAgICAgICAgICAgIGZpZWxkcyA9IGdldFVubG9hZGVkSW50ZXJuYWwoZmV0\nY2gsIExPQURfRkdTLCBudWxsKTsKICAgICAgICAKICAgICAgICAvLyBjaGVj\nayBmb3IgbG9hZCBmZXRjaCBncm91cAogICAgICAgIFN0cmluZyBsZmcgPSBm\nbWQuZ2V0TG9hZEZldGNoR3JvdXAoKTsKICAgICAgICBib29sZWFuIGxmZ0Fk\nZGVkID0gZmFsc2U7CiAgICAgICAgaWYgKGxmZyAhPSBudWxsKSB7ICAKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVs\nZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0\nKGkpICYmIChpID09IGZpZWxkCiAgICAgICAgICAgICAgICAgICAgfHwgZm1k\nc1tpXS5pc0luRmV0Y2hHcm91cChsZmcpKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChmaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgZmllbGRzID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAgICAgICAg\nICAgICAgICAgICAgZmllbGRzLnNldChpKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcmVsYXRpb24gZmllbGQg\naXMgbG9hZGVkIHdpdGggdGhlIGxvYWQtZmV0Y2gtZ3JvdXAKICAgICAgICAg\nICAgLy8gYnV0IHRoaXMgYWRkaXRpb24gbXVzdCBiZSByZXZlcnRlZCBvbmNl\nIHRoZSBsb2FkIGlzIG92ZXIKICAgICAgICAgICAgaWYgKCFmZXRjaC5oYXNG\nZXRjaEdyb3VwKGxmZykpIHsKICAgICAgICAgICAgICAgIGZldGNoLmFkZEZl\ndGNoR3JvdXAobGZnKTsKICAgICAgICAgICAgICAgIGxmZ0FkZGVkID0gdHJ1\nZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZm1kLmlzSW5E\nZWZhdWx0RmV0Y2hHcm91cCgpICYmIGZpZWxkcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIG5vIGxvYWQgZ3JvdXAgYnV0IGRmZzogYWRkIGRmZyBmaWVs\nZHMgaWYgd2UgaGF2ZW4ndCBhbHJlYWR5CiAgICAgICAgICAgIGZpZWxkcyA9\nIGdldFVubG9hZGVkSW50ZXJuYWwoZmV0Y2gsIExPQURfRkdTLCBudWxsKTsK\nICAgICAgICB9IGVsc2UgaWYgKCFfbG9hZGVkLmdldChmbWQuZ2V0SW5kZXgo\nKSkpIHsKICAgICAgICAgICAgLy8gbm8gbG9hZCBncm91cCBvciBkZmc6IGxv\nYWQgaW5kaXZpZHVhbCBmaWVsZAogICAgICAgICAgICBpZiAoZmllbGRzID09\nIG51bGwpCiAgICAgICAgICAgICAgICBmaWVsZHMgPSBuZXcgQml0U2V0KCk7\nCiAgICAgICAgICAgIGZpZWxkcy5zZXQoZm1kLmdldEluZGV4KCkpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gY2FsbCB0aGlzIG1ldGhvZCBldmVuIGlmIHRo\nZXJlIGFyZSBubyB1bmxvYWRlZCBmaWVsZHM7IGxvYWRGaWVsZHMKICAgICAg\nICAvLyB0YWtlcyBjYXJlIG9mIHRoaW5ncyBsaWtlIGxvYWRpbmcgdmVyc2lv\nbiBpbmZvIGFuZCBzZXR0aW5nIFBDIGZsYWdzCiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgbG9hZEZpZWxkcyhmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWws\nIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChs\nZmdBZGRlZCkKICAgICAgICAgICAgICAgIGZldGNoLnJlbW92ZUZldGNoR3Jv\ndXAobGZnKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHByb3ZpZGUgdGhlIGdpdmVuIGZpZWxkIG51bWJlciB0\nbyB0aGUgZ2l2ZW4KICAgICAqIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8KICAg\nIHZvaWQgcHJvdmlkZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgRmll\nbGRNYW5hZ2VyIHN0b3JlLCBpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1h\nbmFnZXIgYmVmb3JlRk0gPSBfZm07CiAgICAgICAgX2ZtID0gc3RvcmU7CiAg\nICAgICAgcGMucGNQcm92aWRlRmllbGQoZmllbGQpOwogICAgICAgIC8vIFJl\ndGFpbmluZyBvcmlnaW5hbCBGTSBiZWNhdXNlIG9mIHRoZSBwb3NzaWJpbGl0\neSBvZiByZWVudHJhbnQgY2FsbHMKICAgICAgICBpZiAoYmVmb3JlRk0gIT0g\nbnVsbCkgX2ZtID0gYmVmb3JlRk07CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRvIHJlcGxhY2UgdGhlIGdpdmVuIGZpZWxkIG51bWJl\nciB0byB0aGUgZ2l2ZW4KICAgICAqIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8K\nICAgIHZvaWQgcmVwbGFjZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\nRmllbGRNYW5hZ2VyIGxvYWQsIGludCBmaWVsZCkgewogICAgICAgIEZpZWxk\nTWFuYWdlciBiZWZvcmVGTSA9IF9mbTsKICAgICAgICBfZm0gPSBsb2FkOwog\nICAgICAgIHBjLnBjUmVwbGFjZUZpZWxkKGZpZWxkKTsKICAgICAgICAvLyBS\nZXRhaW5pbmcgb3JpZ2luYWwgRk0gYmVjYXVzZSBvZiB0aGUgcG9zc2liaWxp\ndHkgb2YgcmVlbnRyYW50IGNhbGxzCiAgICAgICAgaWYgKGJlZm9yZUZNICE9\nIG51bGwpIF9mbSA9IGJlZm9yZUZNOwogICAgfQoKICAgIC8qKgogICAgICog\nTWFyayB0aGUgZmllbGQgYXMgbG9hZGVkIG9yIHVubG9hZGVkLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgc2V0TG9hZGVkKGludCBmaWVsZCwgYm9vbGVh\nbiBpc0xvYWRlZCkgewogICAgICAgIC8vIGRvbid0IGNvbnRpbnVlIGlmIGxv\nYWRlZCBzdGF0ZSBpcyBhbHJlYWR5IGNvcnJlY3Q7IG90aGVyd2lzZSB3ZQog\nICAgICAgIC8vIGNhbiBlbmQgdXAgY2xlYXJpbmcgX2ZpZWxkSW1wbCB3aGVu\nIHdlIHNob3VsZG4ndAogICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkg\nPT0gaXNMb2FkZWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\naWYgbG9hZGluZywgY2xlYXIgaW50ZXJtZWRpYXRlIGRhdGE7IGlmIHVubG9h\nZGluZywgY2xlYXIgaW1wbCBkYXRhCiAgICAgICAgaWYgKF9maWVsZEltcGwg\nIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0\ncmFGaWVsZERhdGFJbmRleChmaWVsZCk7CiAgICAgICAgICAgIGlmIChpZHgg\nIT0gLTEpCiAgICAgICAgICAgICAgICBfZmllbGRJbXBsW2lkeF0gPSBudWxs\nOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTG9hZGVkKQogICAgICAgICAg\nICBfbG9hZGVkLnNldChmaWVsZCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfbG9hZGVkLmNsZWFyKGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBlcmZvcm0gcG9zdC1sb2FkIHN0ZXBzLCBpbmNsdWRpbmcgdGhlIHBvc3Qg\nbG9hZCBjYWxsYmFjay4KICAgICAqIFdlIGhhdmUgdG8gY2hlY2sgdGhlIGRm\nZyBhZnRlciBhbGwgZmllbGQgbG9hZHMgYmVjYXVzZSBpdCBtaWdodCBiZQog\nICAgICogbG9hZGVkIGluIG11bHRpcGxlIHN0ZXBzIHdoZW4gcGFnaW5nIGlz\nIGludm9sdmVkOyB0aGUgaW5pdGlhbCBsb2FkCiAgICAgKiBtaWdodCBleGNs\ndWRlIHNvbWUgZmllbGRzIHdoaWNoIGFyZSB0aGVuIGltbWVkaWF0ZWx5IGxv\nYWRlZCBpbiBhCiAgICAgKiBzZXBhcmF0ZSBzdGVwIGJlZm9yZSBiZWluZyBy\nZXR1cm5lZCB0byB0aGUgdXNlci4KICAgICAqCiAgICAgKiBAcGFyYW0gZmll\nbGQgdGhlIGZpZWxkIGluZGV4IHRoYXQgd2FzIGxvYWRlZCwgb3IgLTEgdG8g\naW5kaWNhdGUKICAgICAqIHRoYXQgYSBncm91cCBvZiBwb3NzaWJseSB1bmtu\nb3duIGZpZWxkcyB3YXMgbG9hZGVkCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwb3N0TG9hZChpbnQgZmllbGQsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIC8vIG5vIG5lZWQgZm9yIHBvc3RMb2FkIGNhbGxiYWNr\nPwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19MT0FERUQpICE9IDApCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaW4gdGhlIG1pZGRsZSBv\nZiBhIGdyb3VwIGxvYWQsIGFmdGVyIHdoaWNoIHRoaXMgbWV0aG9kIHdpbGwg\nYmUKICAgICAgICAvLyBjYWxsZWQgYWdhaW4/CiAgICAgICAgaWYgKGZpZWxk\nICE9IC0xICYmIGlzTG9hZGluZygpKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIC8vIG5vIGxpc3RlbmVycz8KICAgICAgICBMaWZlY3ljbGVFdmVu\ndE1hbmFnZXIgbWdyID0gX2Jyb2tlci5nZXRMaWZlY3ljbGVFdmVudE1hbmFn\nZXIoKTsKICAgICAgICBpZiAobWdyID09IG51bGwgfHwgIW1nci5oYXNMb2Fk\nTGlzdGVuZXJzKGdldE1hbmFnZWRJbnN0YW5jZSgpLCBfbWV0YSkpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAg\nICAgICAgICAgIGZldGNoID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICAvLyBpcyB0aGlzIGZpZWxkIGEgcG9zdC1sb2FkIGZp\nZWxkPwogICAgICAgIGlmIChmaWVsZCAhPSAtMSkgewogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAg\nICAgICAgICAgaWYgKGZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAg\nICAgICAgICAgICAgICYmIGZldGNoLmhhc0ZldGNoR3JvdXAoRmV0Y2hHcm91\ncC5OQU1FX0RFRkFVTFQpCiAgICAgICAgICAgICAgICAmJiBwb3N0TG9hZChG\nZXRjaEdyb3VwLk5BTUVfREVGQVVMVCwgZmV0Y2gpKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBTdHJpbmdbXSBmZ3MgPSBmbWQuZ2V0\nQ3VzdG9tRmV0Y2hHcm91cHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAo\nZmV0Y2guaGFzRmV0Y2hHcm91cChmZ3NbaV0pICYmIHBvc3RMb2FkKGZnc1tp\nXSwgZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGZl\ndGNoLmdldEZldGNoR3JvdXBzKCkuaXRlcmF0b3IoKTsgCiAgICAgICAgICAg\nICAgICBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYgKHBv\nc3RMb2FkKChTdHJpbmcpIGl0ci5uZXh0KCksIGZldGNoKSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHBvc3QtbG9hZCBhY3Rpb25z\nIGlmIHRoZSBnaXZlbiBmZXRjaCBncm91cCBpcyBhIHBvc3QtbG9hZCBncm91\ncAogICAgICogYW5kIGlzIGZ1bGx5IGxvYWRlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIHBvc3RMb2FkKFN0cmluZyBmZ05hbWUsIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIEZldGNoR3JvdXAgZmcgPSBf\nbWV0YS5nZXRGZXRjaEdyb3VwKGZnTmFtZSk7CiAgICAgICAgaWYgKGZnID09\nIG51bGwgfHwgIWZnLmlzUG9zdExvYWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRh\nLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChp\nKSAmJiBmbWRzW2ldLmlzSW5GZXRjaEdyb3VwKGZnTmFtZSkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIF9mbGFncyB8PSBGTEFH\nX0xPQURFRDsKICAgICAgICBfYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudChn\nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgZmV0Y2gsIF9tZXRhLCAKICAgICAgICAJ\nTGlmZWN5Y2xlRXZlbnQuQUZURVJfTE9BRCk7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5jaHJvbml6ZSBvdXIgdmVy\nc2lvbiBvYmplY3Qgd2l0aCB0aGUgZGF0YXN0b3JlLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gc3luY1ZlcnNpb24oT2JqZWN0IHNkYXRhKSB7CiAg\nICAgICAgcmV0dXJuIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuc3luY1Zl\ncnNpb24odGhpcywgc2RhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgbmVlZHMgYSB2ZXJzaW9uIGNo\nZWNrLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZlcnNpb25DaGVj\na1JlcXVpcmVkKCkgewogICAgICAgIC8vIGV4cGxpY2l0IGZsYWcgZm9yIHZl\ncnNpb24gY2hlY2sKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfVkVSU0lP\nTl9DSEVDSykgIT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAg\nICAgIGlmICghX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkgJiYgIV9icm9rZXIu\nZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRDb21wYXRpYmls\naXR5SW5zdGFuY2UoKS5nZXROb25PcHRpbWlzdGljVmVyc2lvbkNoZWNrKCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX3N0\nYXRlLmlzVmVyc2lvbkNoZWNrUmVxdWlyZWQodGhpcyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgd2hldGhlciB0aGlzIGluc3RhbmNlIHJlcXVpcmVz\nIGEgdmVyc2lvbiBjaGVjayBvbiB0aGUgbmV4dCBmbHVzaC4KICAgICAqLwog\nICAgdm9pZCBzZXRDaGVja1ZlcnNpb24oYm9vbGVhbiB2ZXJzaW9uQ2hlY2sp\nIHsKICAgICAgICBpZiAodmVyc2lvbkNoZWNrKQogICAgICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19WRVJTSU9OX0NIRUNLOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJT05fQ0hFQ0s7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBpbnN0YW5jZSBu\nZWVkcyBhIHZlcnNpb24gdXBkYXRlLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1ZlcnNpb25VcGRhdGVSZXF1aXJlZCgpIHsKICAgICAgICByZXR1\ncm4gKF9mbGFncyAmIEZMQUdfVkVSU0lPTl9VUERBVEUpID4gMDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgcmVx\ndWlyZXMgYSB2ZXJzaW9uIHVwZGF0ZSBvbiB0aGUgbmV4dCBmbHVzaC4KICAg\nICAqLwogICAgdm9pZCBzZXRVcGRhdGVWZXJzaW9uKGJvb2xlYW4gdmVyc2lv\nblVwZGF0ZSkgewogICAgICAgIGlmICh2ZXJzaW9uVXBkYXRlKQogICAgICAg\nICAgICBfZmxhZ3MgfD0gRkxBR19WRVJTSU9OX1VQREFURTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19WRVJTSU9OX1VQREFU\nRTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zbGF0ZSB0aGUgZ2l2ZW4g\nZXhjZXB0aW9uIGJhc2VkIG9uIHRoZSBicm9rZXIncyBpbXBsaWNpdCBiZWhh\ndmlvci4KICAgICAqIFRyYW5zbGF0aW9uIG9ubHkgb2NjdXJzIGlmIHRoZSBl\neGNlcHRpb24gaXMgaW5pdGlhdGVkIGJ5IGEgdXNlciBhY3Rpb24KICAgICAq\nIG9uIGFuIGluc3RhbmNlLCBhbmQgdGhlcmVmb3JlIHdpbGwgbm90IGJlIGNh\ndWdodCBhbmQgdHJhbnNsYXRlZCBieSB0aGUKICAgICAqIGJyb2tlci4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFJ1bnRpbWVFeGNlcHRpb24gdHJhbnNsYXRl\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICBSdW50aW1lRXhjZXB0\naW9uVHJhbnNsYXRvciB0cmFucyA9IF9icm9rZXIuZ2V0SW5zdGFuY2VFeGNl\ncHRpb25UcmFuc2xhdG9yKCk7CiAgICAgICAgcmV0dXJuICh0cmFucyA9PSBu\ndWxsKSA/IHJlIDogdHJhbnMudHJhbnNsYXRlKHJlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIExvY2sgdGhlIHN0YXRlIG1hbmFnZXIgaWYgdGhlIG11bHRp\ndGhyZWFkZWQgb3B0aW9uIGlzIHNldC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2luc3RhbmNlTG9jayAhPSBu\ndWxsKQogICAgICAgIAlfaW5zdGFuY2VMb2NrLmxvY2soKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFVubG9jayB0aGUgc3RhdGUgbWFuYWdlci4KICAgICAq\nLwoJcHJvdGVjdGVkIHZvaWQgdW5sb2NrICgpIHsKICAgICAgICBpZiAoX2lu\nc3RhbmNlTG9jayAhPSBudWxsKQogICAgICAgIAlfaW5zdGFuY2VMb2NrLnVu\nbG9jaygpOwoJfQoKICAgIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdChPYmpl\nY3RPdXRwdXRTdHJlYW0gb29zKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIG9vcy53cml0ZU9iamVjdChfYnJva2VyKTsKICAgICAgICBvb3MuZGVm\nYXVsdFdyaXRlT2JqZWN0KCk7CiAgICAgICAgb29zLndyaXRlT2JqZWN0KF9t\nZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgd3JpdGVQQyhvb3Ms\nIF9wYyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSA8Y29kZT5wYzwv\nY29kZT4gdG8gPGNvZGU+b29zPC9jb2RlPiwgaGFuZGxpbmcgaW50ZXJuYWwt\nZm9ybQogICAgICogc2VyaWFsaXphdGlvbi4gPGNvZGU+cGM8L2NvZGU+IG11\nc3QgYmUgb2YgdGhlIHNhbWUgdHlwZSB0aGF0IHRoaXMKICAgICAqIHN0YXRl\nIG1hbmFnZXIgbWFuYWdlcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAK\nICAgICAqLwogICAgdm9pZCB3cml0ZVBDKE9iamVjdE91dHB1dFN0cmVhbSBv\nb3MsIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYykKICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGlmICghU2VyaWFsaXphYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE5vdFNlcmlhbGl6YWJsZUV4Y2VwdGlvbihf\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKTsKCiAgICAgICAg\nb29zLndyaXRlT2JqZWN0KHBjKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQg\ncmVhZE9iamVjdChPYmplY3RJbnB1dFN0cmVhbSBpbikKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gewogICAg\nICAgIF9icm9rZXIgPSAoQnJva2VySW1wbCkgaW4ucmVhZE9iamVjdCgpOwog\nICAgICAgIGluLmRlZmF1bHRSZWFkT2JqZWN0KCk7CgogICAgICAgIC8vIHdl\nIG5lZWQgdG8gc3RvcmUgdGhlIGNsYXNzIGJlZm9yZSB0aGUgcGMgaW5zdGFu\nY2Ugc28gdGhhdCB3ZSBjYW4KICAgICAgICAvLyBjcmVhdGUgX21ldGEgYmVm\nb3JlIGNhbGxpbmcgcmVhZFBDKCksIHdoaWNoIHJlbGllcyBvbiBfbWV0YSBi\nZWluZwogICAgICAgIC8vIG5vbi1udWxsIHdoZW4gcmVjb25zdGl0dXRpbmcg\nUmVmbGVjdGluZ1BDIGluc3RhbmNlcy4gU2FkbHksIHRoaXMKICAgICAgICAv\nLyBwZW5hbGl6ZXMgdGhlIHNlcmlhbGl6YXRpb24gZm9vdHByaW50IG9mIG5v\nbi1SZWZsZWN0aW5nUEMgU01zIGFsc28uCiAgICAgICAgQ2xhc3MgbWFuYWdl\nZFR5cGUgPSAoQ2xhc3MpIGluLnJlYWRPYmplY3QoKTsKICAgICAgICBfbWV0\nYSA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVw\nb3NpdG9yeUluc3RhbmNlKCkKICAgICAgICAgICAgLmdldE1ldGFEYXRhKG1h\nbmFnZWRUeXBlLCBudWxsLCB0cnVlKTsKCiAgICAgICAgX3BjID0gcmVhZFBD\nKGluKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBkZXNl\ncmlhbGl6ZWQgPGNvZGU+bzwvY29kZT4gdG8gYSB7QGxpbmsgUGVyc2lzdGVu\nY2VDYXBhYmxlfQogICAgICogaW5zdGFuY2UgYXBwcm9wcmlhdGUgZm9yIHN0\nb3JpbmcgaW4gPGNvZGU+X3BjPC9jb2RlPi4KICAgICAqCiAgICAgKiBAc2lu\nY2UgMS4xLjAKICAgICAqLwogICAgUGVyc2lzdGVuY2VDYXBhYmxlIHJlYWRQ\nQyhPYmplY3RJbnB1dFN0cmVhbSBpbikKICAgICAgICB0aHJvd3MgQ2xhc3NO\nb3RGb3VuZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gewogICAgICAgIE9iamVj\ndCBvID0gaW4ucmVhZE9iamVjdCgpOwoKICAgICAgICBpZiAobyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjOwogICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBQZXJz\naXN0ZW5jZUNhcGFibGUpKQogICAgICAgICAgICBwYyA9IEltcGxIZWxwZXIu\ndG9QZXJzaXN0ZW5jZUNhcGFibGUobywgdGhpcyk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpIG87CgogICAg\nICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcih0aGlzKTsKICAgICAgICBy\nZXR1cm4gcGM7CiAgICB9CiAgICAKICAgIHB1YmxpYyBMaXN0PEZpZWxkTWV0\nYURhdGE+IGdldE1hcHBlZEJ5SWRGaWVsZHMoKSB7CiAgICAgICAgcmV0dXJu\nIF9tYXBwZWRCeUlkRmllbGRzOwogICAgfQp9Cg==\n","encoding":"base64"}

