{"sha":"b35ed4d423c7755f0955f852a7c25c047526882f","node_id":"MDQ6QmxvYjIwNjM2NDpiMzVlZDRkNDIzYzc3NTVmMDk1NWY4NTJhN2MyNWMwNDc1MjY4ODJm","size":87120,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b35ed4d423c7755f0955f852a7c25c047526882f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc3FsLlRpbWU7\nCmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkRhdGU7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlu\na2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGph\ndmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmNvbmYuQ29tcGF0aWJpbGl0eTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXJGYWN0b3J5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVy\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmlsbFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5\nT3BlcmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUmVzdWx0U2hhcGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5BYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkNvbnRleHQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9u\nRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5MaXRlcmFsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLlBhcmFtZXRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5QYXRoOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5leHBzLlF1ZXJ5RXhwcmVzc2lvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLmV4cHMuUmVzb2x2ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuU3VicXVlcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFsdWU7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLk9yZGVyZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRp\nb247CgppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogQnVpbGRl\nciBmb3IgSlBRTCBleHByZXNzaW9ucy4gVGhpcyBjbGFzcyB0YWtlcyB0aGUg\ncXVlcnkgcGFyc2VkCiAqIGluIHtAbGluayBKUFFMfSBhbmQgY29udmVydHMg\naXQgdG8gYW4gZXhwcmVzc2lvbiB0cmVlIHVzaW5nCiAqIGFuIHtAbGluayBF\neHByZXNzaW9uRmFjdG9yeX0uIFB1YmxpYyBmb3IgdW5pdCB0ZXN0aW5nIHB1\ncnBvc2VzLgogKgogKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogKiBA\nYXV0aG9yIFBhdHJpY2sgTGluc2tleQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgSlBRTEV4cHJlc3Npb25CdWlsZGVyCiAgICBleHRlbmRzIEFi\nc3RyYWN0RXhwcmVzc2lvbkJ1aWxkZXIKICAgIGltcGxlbWVudHMgSlBRTFRy\nZWVDb25zdGFudHMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBW\nQVJfUEFUSCA9IDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgVkFS\nX0VSUk9SID0gMjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6\nZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEpQUUxF\neHByZXNzaW9uQnVpbGRlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBT\ndGFjazxDb250ZXh0PiBjb250ZXh0cyA9IG5ldyBTdGFjazxDb250ZXh0Pigp\nOwogICAgcHJpdmF0ZSBPcmRlcmVkTWFwPE9iamVjdCwgQ2xhc3M8Pz4+IHBh\ncmFtZXRlclR5cGVzOwogICAgcHJpdmF0ZSBpbnQgYWxpYXNDb3VudCA9IDA7\nCiAgICBwcml2YXRlIGJvb2xlYW4gaW5Bc3NpZ25TdWJzZWxlY3RQcm9qZWN0\naW9uID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAg\nICAqCiAgICAgKiBAcGFyYW0gZmFjdG9yeSB0aGUgZXhwcmVzc2lvbiBmYWN0\nb3J5IHRvIHVzZQogICAgICogQHBhcmFtIHF1ZXJ5IHVzZWQgdG8gcmVzb2x2\nZSB2YXJpYWJsZXMsIHBhcmFtZXRlcnMsCiAgICAgKiBhbmQgY2xhc3MgbmFt\nZXMgdXNlZCBpbiB0aGUgcXVlcnkKICAgICAqIEBwYXJhbSBwYXJzZWRRdWVy\neSB0aGUgcGFyc2VkIHF1ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyBKUFFMRXhw\ncmVzc2lvbkJ1aWxkZXIoRXhwcmVzc2lvbkZhY3RvcnkgZmFjdG9yeSwKICAg\nICAgICBFeHByZXNzaW9uU3RvcmVRdWVyeSBxdWVyeSwgT2JqZWN0IHBhcnNl\nZFF1ZXJ5KSB7CiAgICAgICAgc3VwZXIoZmFjdG9yeSwgcXVlcnkuZ2V0UmVz\nb2x2ZXIoKSk7CgogICAgICAgIGNvbnRleHRzLnB1c2gobmV3IENvbnRleHQo\ncGFyc2VkUXVlcnkgaW5zdGFuY2VvZiBQYXJzZWRKUFFMCiAgICAgICAgICAg\nID8gKFBhcnNlZEpQUUwpIHBhcnNlZFF1ZXJ5CiAgICAgICAgICAgIDogcGFy\nc2VkUXVlcnkgaW5zdGFuY2VvZiBTdHJpbmcKICAgICAgICAgICAgPyBnZXRQ\nYXJzZWRRdWVyeSgoU3RyaW5nKSBwYXJzZWRRdWVyeSkKICAgICAgICAgICAg\nOiBudWxsLCBudWxsLCBudWxsKSk7CgogICAgICAgIGlmIChjdHgoKS5wYXJz\nZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKHBhcnNlZFF1ZXJ5ICsgIiIpOwogICAgfQoKICAgIHByb3RlY3Rl\nZCBMb2NhbGl6ZXIgZ2V0TG9jYWxpemVyKCkgewogICAgICAgIHJldHVybiBf\nbG9jOwogICAgfQoKICAgIHByb3RlY3RlZCBDbGFzc0xvYWRlciBnZXRDbGFz\nc0xvYWRlcigpIHsKICAgICAgICAvLyB3ZSBkb24ndCByZXNvbHZlIGluIHRo\nZSBjb250ZXh0IG9mIGFueXRoaW5nIGJ1dCBvdXJzZWx2ZXMKICAgICAgICBy\nZXR1cm4gZ2V0Q2xhc3MoKS5nZXRDbGFzc0xvYWRlcigpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBQYXJzZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KCkgewogICAg\nICAgIHJldHVybiBjdHgoKS5wYXJzZWQ7CiAgICB9CgogICAgcHJvdGVjdGVk\nIFBhcnNlZEpQUUwgZ2V0UGFyc2VkUXVlcnkoU3RyaW5nIGpwcWwpIHsKICAg\nICAgICByZXR1cm4gbmV3IFBhcnNlZEpQUUwoanBxbCk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIHNldENhbmRpZGF0ZShDbGFzc01ldGFEYXRhIGNtZCwg\nU3RyaW5nIHNjaGVtYUFsaWFzKSB7CiAgICAgICAgYWRkQWNjZXNzUGF0aChj\nbWQpOwoKICAgICAgICBpZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgIGN0\neCgpLm1ldGEgPSBjbWQ7CgogICAgICAgIGlmIChzY2hlbWFBbGlhcyAhPSBu\ndWxsKQogICAgICAgICAgICBjdHgoKS5zY2hlbWFBbGlhcyA9IHNjaGVtYUFs\naWFzOwogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIG5leHRBbGlhcygpIHsK\nICAgICAgICByZXR1cm4gImpwcWxhbGlhcyIgKyAoKythbGlhc0NvdW50KTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YSByZXNvbHZlQ2xh\nc3NNZXRhRGF0YShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgLy8gaGFuZGxl\nIGxvb2tpbmcgdXAgYWxpYXMgbmFtZXMKICAgICAgICBTdHJpbmcgc2NoZW1h\nTmFtZSA9IGFzc2VydFNjaGVtYU5hbWUobm9kZSk7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBjbWQgPSBnZXRDbGFzc01ldGFEYXRhKHNjaGVtYU5hbWUsIGZh\nbHNlKTsKICAgICAgICBpZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBjbWQ7CgogICAgICAgIC8vIHdlIG1pZ2h0IGJlIHJlZmVyZW5jaW5n\nIGEgY29sbGVjdGlvbiBmaWVsZCBvZiBhIHN1YnF1ZXJ5J3MgcGFyZW50CiAg\nICAgICAgaWYgKGlzUGF0aChub2RlKSkgewogICAgICAgICAgICBQYXRoIHBh\ndGggPSBnZXRQYXRoKG5vZGUpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IHBhdGgubGFzdCgpOwogICAgICAgICAgICBjbWQgPSBnZXRGaWVs\nZFR5cGUoZm1kKTsKICAgICAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGZt\nZC5pc0VsZW1lbnRDb2xsZWN0aW9uKCkpCiAgICAgICAgICAgICAgICBjbWQg\nPSBmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpOwogICAgICAgICAgICByZXR1\ncm4gY21kOwogICAgICAgIH0KCiAgICAgICAgLy8gbm93IHJ1biBhZ2FpbiB0\nbyB0aHJvdyB0aGUgY29ycmVjdCBleGNlcHRpb24KICAgICAgICByZXR1cm4g\nZ2V0Q2xhc3NNZXRhRGF0YShzY2hlbWFOYW1lLCB0cnVlKTsKICAgIH0KCiAg\nICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0Q2xhc3NNZXRhRGF0YShTdHJp\nbmcgYWxpYXMsIGJvb2xlYW4gYXNzZXJ0VmFsaWQpIHsKICAgICAgICBDbGFz\nc0xvYWRlciBsb2FkZXIgPSBnZXRDbGFzc0xvYWRlcigpOwogICAgICAgIE1l\ndGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IHJlc29sdmVyLmdldENvbmZpZ3Vy\nYXRpb24oKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKTsKCiAgICAgICAgLy8gZmlyc3QgY2hlY2sgZm9yIHRoZSBhbGlh\ncwogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gcmVwb3MuZ2V0TWV0YURh\ndGEoYWxpYXMsIGxvYWRlciwgZmFsc2UpOwoKICAgICAgICBpZiAoY21kICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBjbWQ7CgogICAgICAgIC8vIG5v\ndyBjaGVjayBmb3IgdGhlIGNsYXNzIG5hbWU7IHRoaXMgaXMgbm90IHRlY2hu\naWNhbGx5IHBlcm1pdHRlZAogICAgICAgIC8vIGJ5IHRoZSBKUEEgc3BlYywg\nYnV0IGlzIHJlcXVpcmVkIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gZXhlY3V0\nZQogICAgICAgIC8vIEpQUUwgcXVlcmllcyBmcm9tIG90aGVyIGZhY2FkZXMg\nKGxpa2UgSkRPKSB0aGF0IGRvIG5vdCBoYXZlCiAgICAgICAgLy8gdGhlIGNv\nbmNlcHQgb2YgZW50aXR5IG5hbWVzIG9yIGFsaWFzZXMKICAgICAgICBDbGFz\nczw/PiBjID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKGFsaWFzLCBudWxsKTsK\nICAgICAgICBpZiAoYyAhPSBudWxsKQogICAgICAgICAgICBjbWQgPSByZXBv\ncy5nZXRNZXRhRGF0YShjLCBsb2FkZXIsIGFzc2VydFZhbGlkKTsKICAgICAg\nICBlbHNlIGlmIChhc3NlcnRWYWxpZCkKICAgICAgICAgICAgY21kID0gcmVw\nb3MuZ2V0TWV0YURhdGEoYWxpYXMsIGxvYWRlciwgZmFsc2UpOwoKICAgICAg\nICBpZiAoY21kID09IG51bGwgJiYgYXNzZXJ0VmFsaWQpIHsKICAgICAgICAg\nICAgU3RyaW5nIGNsb3NlID0gcmVwb3MuZ2V0Q2xvc2VzdEFsaWFzTmFtZShh\nbGlhcyk7CiAgICAgICAgICAgIGlmIChjbG9zZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1z\nY2hlbWEtbmFtZS1oaW50IiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IGFsaWFzLCBjbG9zZSwgcmVwb3MuZ2V0QWxpYXNOYW1lcygpIH0s\nIG51bGwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwK\nICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGFsaWFzLCByZXBv\ncy5nZXRBbGlhc05hbWVzKCkgfSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gY21kOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3M8Pz4gZ2V0\nQ2FuZGlkYXRlVHlwZSgpIHsKICAgICAgICByZXR1cm4gZ2V0Q2FuZGlkYXRl\nTWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICB9CgogICAgcHJp\ndmF0ZSBDbGFzc01ldGFEYXRhIGdldENhbmRpZGF0ZU1ldGFEYXRhKCkgewog\nICAgICAgIGlmIChjdHgoKS5tZXRhICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBjdHgoKS5tZXRhOwoKICAgICAgICBDbGFzc01ldGFEYXRhIGNscyA9\nIGdldENhbmRpZGF0ZU1ldGFEYXRhKHJvb3QoKSk7CiAgICAgICAgaWYgKGNs\ncyA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihF\nWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXsgcm9vdCgpIH0sIG51bGwpOwoKICAgICAgICBzZXRDYW5k\naWRhdGUoY2xzLCBudWxsKTsKICAgICAgICByZXR1cm4gY2xzOwogICAgfQoK\nICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIGdldENhbmRpZGF0ZU1ldGFE\nYXRhKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICAvLyBleGFtaW5nIHRoZSBu\nb2RlIHRvIGZpbmQgdGhlIGNhbmRpZGF0ZSBxdWVyeQogICAgICAgIC8vICMj\nIyB0aGlzIHNob3VsZCBhY3R1YWxseSBiZSB0aGUgcHJpbWFyeSBTRUxFQ1Qg\naW5zdGFuY2UKICAgICAgICAvLyByZXNvbHZlZCBhZ2FpbnN0IHRoZSBmcm9t\nIHZhcmlhYmxlIGRlY2xhcmF0aW9ucwogICAgICAgIEpQUUxOb2RlIGZyb20g\nPSBub2RlLmZpbmRDaGlsZEJ5SUQoSkpURlJPTUlURU0sIHRydWUpOwogICAg\nICAgIGlmIChmcm9tID09IG51bGwpIHsKICAgICAgICAgICAgLy8gT1BFTkpQ\nQS0xNSBhbGxvdyBzdWJxdWVyeSB3aXRob3V0IGEgRlJPTUlURU0KICAgICAg\nICAgICAgaWYgKG5vZGUuaWQgPT0gSkpUU1VCU0VMRUNUKSB7IAogICAgICAg\nICAgICAgICAgZnJvbSA9IG5vZGUuZmluZENoaWxkQnlJRChKSlRGUk9NLCB0\ncnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJuby1m\ncm9tLWNsYXVzZSIsIG51bGwsIG51bGwpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZyb20uY2hpbGRy\nZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgSlBRTE5vZGUgbiA9IGZy\nb20uY2hpbGRyZW5baV07CgogICAgICAgICAgICBpZiAobi5pZCA9PSBKSlRB\nQlNUUkFDVFNDSEVNQU5BTUUpIHsKICAgICAgICAgICAgICAgIC8vIHdlIHNp\nbXBseSByZXR1cm4gdGhlIGZpcnN0IGFic3RyYWN0IHNjaGVtYSBjaGlsZAog\nICAgICAgICAgICAgICAgLy8gYXMgcmVzb2x2ZWQgaW50byBhIGNsYXNzCiAg\nICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlc29sdmVDbGFz\nc01ldGFEYXRhKG4pOwoKICAgICAgICAgICAgICAgIGlmIChjbWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAg\nICAgICAgIC8vIG5vdCBhIHNjaGVtYTogdHJlYXQgaXQgYXMgYSBjbGFzcwog\nICAgICAgICAgICAgICAgU3RyaW5nIGNscyA9IGFzc2VydFNjaGVtYU5hbWUo\nbik7CiAgICAgICAgICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5v\ndC1zY2hlbWEtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgcm9vdCgpIH0sIG51bGwpOwoKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRDbGFzc01ldGFEYXRhKGNscywgdHJ1ZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgLy8gT1BFTkpQQS0xNSBzdXBwb3J0IHN1YnF1ZXJ5\nJ3MgZnJvbSBjbGF1c2UgZG8gbm90IHN0YXJ0IHdpdGggCiAgICAgICAgICAg\nIC8vIGlkZW50aWZpY2F0aW9uX3ZhcmlhYmxlX2RlY2xhcmF0aW9uKCkKICAg\nICAgICAgICAgaWYgKG5vZGUuaWQgPT0gSkpUU1VCU0VMRUNUKSB7CiAgICAg\nICAgICAgICAgICBpZiAobi5pZCA9PSBKSlRJTk5FUkpPSU4pIHsKICAgICAg\nICAgICAgICAgICAgICBuID0gbi5nZXRDaGlsZCgwKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGlmIChuLmlkID09IEpKVFBBVEgpIHsK\nICAgICAgICAgICAgICAgICAgICBQYXRoIHBhdGggPSBnZXRQYXRoKG4pOwog\nICAgICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5s\nYXN0KCk7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQg\nPSBnZXRGaWVsZFR5cGUoZm1kKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nY21kID09IG51bGwgJiYgZm1kLmlzRWxlbWVudENvbGxlY3Rpb24oKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgY21kID0gZm1kLmdldERlZmluaW5nTWV0\nYURhdGEoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY21kICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNtZDsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VTRVIsICJuby1hbGlhcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgbiB9LCBudWxsKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gICAg\nICAgICAgIAogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgcHJvdGVjdGVkIFN0cmluZyBjdXJyZW50UXVlcnkoKSB7CiAgICAg\nICAgcmV0dXJuIGN0eCgpLnBhcnNlZCA9PSBudWxsIHx8IHJvb3QoKS5wYXJz\nZXIgPT0gbnVsbCA/IG51bGwKICAgICAgICAgICAgOiByb290KCkucGFyc2Vy\nLmpwcWw7CiAgICB9CgogICAgUXVlcnlFeHByZXNzaW9ucyBnZXRRdWVyeUV4\ncHJlc3Npb25zKCkgewogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcyA9\nIG5ldyBRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgZXhwcy5zZXRDb250\nZXh0cyhjb250ZXh0cyk7CgogICAgICAgIGV2YWxRdWVyeU9wZXJhdGlvbihl\neHBzKTsKCiAgICAgICAgRXhwcmVzc2lvbiBmaWx0ZXIgPSBudWxsOwogICAg\nICAgIEV4cHJlc3Npb24gZnJvbSA9IGN0eCgpLmZyb207CiAgICAgICAgaWYg\nKGZyb20gPT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9IGV2YWxGcm9tQ2xh\ndXNlKHJvb3QoKS5pZCA9PSBKSlRTRUxFQ1QpOwogICAgICAgIGZpbHRlciA9\nIGFuZChmcm9tLCBmaWx0ZXIpOwogICAgICAgIGZpbHRlciA9IGFuZChldmFs\nV2hlcmVDbGF1c2UoKSwgZmlsdGVyKTsKICAgICAgICBmaWx0ZXIgPSBhbmQo\nZXZhbFNlbGVjdENsYXVzZShleHBzKSwgZmlsdGVyKTsKCiAgICAgICAgZXhw\ncy5maWx0ZXIgPSBmaWx0ZXIgPT0gbnVsbCA/IGZhY3RvcnkuZW1wdHlFeHBy\nZXNzaW9uKCkgOiBmaWx0ZXI7CgogICAgICAgIGV2YWxHcm91cGluZ0NsYXVz\nZShleHBzKTsKICAgICAgICBldmFsSGF2aW5nQ2xhdXNlKGV4cHMpOwogICAg\nICAgIGV2YWxGZXRjaEpvaW5zKGV4cHMpOwogICAgICAgIGV2YWxTZXRDbGF1\nc2UoZXhwcyk7CiAgICAgICAgZXZhbE9yZGVyaW5nQ2xhdXNlcyhleHBzKTsK\nCiAgICAgICAgaWYgKHBhcmFtZXRlclR5cGVzICE9IG51bGwpCiAgICAgICAg\nICAgIGV4cHMucGFyYW1ldGVyVHlwZXMgPSBwYXJhbWV0ZXJUeXBlczsKCiAg\nICAgICAgZXhwcy5hY2Nlc3NQYXRoID0gZ2V0QWNjZXNzUGF0aCgpOwoKICAg\nICAgICByZXR1cm4gZXhwczsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Np\nb24gYW5kKEV4cHJlc3Npb24gZTEsIEV4cHJlc3Npb24gZTIpIHsKICAgICAg\nICByZXR1cm4gZTEgPT0gbnVsbCA/IGUyIDogZTIgPT0gbnVsbCA/IGUxIDog\nZmFjdG9yeS5hbmQoZTEsIGUyKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBTdHJpbmcgYXNzZW1ibGUoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJl\ndHVybiBhc3NlbWJsZShub2RlLCAiLiIsIDApOwogICAgfQoKICAgIC8qKgog\nICAgICogQXNzZW1ibGUgdGhlIGNoaWxkcmVuIG9mIHRoZSBzcGVjaWZpYyBu\nb2RlIGJ5IGFwcGVuZGluZyBlYWNoCiAgICAgKiBjaGlsZCwgc2VwYXJhdGVk\nIGJ5IHRoZSBkZWxpbWl0ZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIFN0cmluZyBhc3NlbWJsZShKUFFMTm9kZSBub2RlLCBTdHJpbmcgZGVsaW1p\ndGVyLCBpbnQgbGFzdCkgewogICAgICAgIFN0cmluZ0J1aWxkZXIgcmVzdWx0\nID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBKUFFMTm9kZVtdIHBh\ncnRzID0gbm9kZS5jaGlsZHJlbjsKICAgICAgICBmb3IgKGludCBpID0gMDsg\ncGFydHMgIT0gbnVsbCAmJiBpIDwgcGFydHMubGVuZ3RoIC0gbGFzdDsgaSsr\nKQogICAgICAgICAgICByZXN1bHQuYXBwZW5kKHJlc3VsdC5sZW5ndGgoKSA+\nIDAgPyBkZWxpbWl0ZXIgOiAiIikuCiAgICAgICAgICAgICAgICBhcHBlbmQo\ncGFydHNbaV0udGV4dCk7CgogICAgICAgIHJldHVybiByZXN1bHQudG9TdHJp\nbmcoKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gYXNzaWduU3Vi\nc2VsZWN0UHJvamVjdGlvbihKUFFMTm9kZSBub2RlLAogICAgICAgIFF1ZXJ5\nRXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIGluQXNzaWduU3Vic2VsZWN0\nUHJvamVjdGlvbiA9IHRydWU7CiAgICAgICAgZXhwcy5wcm9qZWN0aW9ucyA9\nIG5ldyBWYWx1ZVsxXTsKICAgICAgICBleHBzLnByb2plY3Rpb25DbGF1c2Vz\nID0gbmV3IFN0cmluZ1sxXTsKICAgICAgICBleHBzLnByb2plY3Rpb25BbGlh\nc2VzID0gbmV3IFN0cmluZ1sxXTsKCiAgICAgICAgVmFsdWUgdmFsID0gZ2V0\nVmFsdWUobm9kZSk7CiAgICAgICAgZXhwcy5wcm9qZWN0aW9uc1swXSA9IHZh\nbDsKICAgICAgICBleHBzLnByb2plY3Rpb25DbGF1c2VzWzBdID0gCiAgICAg\nICAgICAgIHByb2plY3Rpb25DbGF1c2Uobm9kZS5pZCA9PSBKSlRTQ0FMQVJF\nWFBSRVNTSU9OID8KICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQobm9kZSkg\nOiBub2RlKTsKICAgICAgICBpbkFzc2lnblN1YnNlbGVjdFByb2plY3Rpb24g\nPSBmYWxzZTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFzc2lnbiBwcm9qZWN0aW9ucyBmb3IgTkVXIGNvbnRydWN0b3Ig\naW4gc2VsZWN0aW9uIGxpc3QuCiAgICAgKiAgICAgRXhhbXBsZTogIFNFTEVD\nVCBORVcgUGVyc29uKHAubmFtZSkgRlJPTSBQZXJzb24gcCBXSEVSRSAuLi4K\nICAgICAqLwogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGFzc2lnblByb2plY3Rp\nb25zKEpQUUxOb2RlIHBhcmFtZXRlcnNOb2RlLAogICAgICAgIFF1ZXJ5RXhw\ncmVzc2lvbnMgZXhwcywgTGlzdDxWYWx1ZT4gcHJvamVjdGlvbnMsCiAgICAg\nICAgTGlzdDxTdHJpbmc+IHByb2plY3Rpb25DbGF1c2VzLCBMaXN0PFN0cmlu\nZz4gcHJvamVjdGlvbkFsaWFzZXMpIHsKICAgICAgICBpbnQgY291bnQgPSBw\nYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZENvdW50KCk7CgogICAgICAgIEV4cHJl\nc3Npb24gZXhwID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvdW50OyBpKyspIHsKICAgICAgICAgICAgSlBRTE5vZGUgcGFyZW50ID0g\ncGFyYW1ldGVyc05vZGUuZ2V0Q2hpbGQoaSk7CiAgICAgICAgICAgIEpQUUxO\nb2RlIG5vZGUgPSBmaXJzdENoaWxkKHBhcmVudCk7CiAgICAgICAgICAgIEpQ\nUUxOb2RlIGFsaWFzTm9kZSA9IHBhcmVudC5jaGlsZHJlbi5sZW5ndGggPiAx\nID8gcmlnaHQocGFyZW50KQogICAgICAgICAgICAgICAgOiBudWxsOyAKICAg\nICAgICAgICAgVmFsdWUgcHJvaiA9IGdldFZhbHVlKG5vZGUpOwogICAgICAg\nICAgICBTdHJpbmcgYWxpYXMgPSBhbGlhc05vZGUgIT0gbnVsbCA/IGFsaWFz\nTm9kZS50ZXh0IDoKICAgICAgICAgICAgICAgIHByb2plY3Rpb25DbGF1c2Uo\nbm9kZS5pZCA9PSBKSlRTQ0FMQVJFWFBSRVNTSU9OID8KICAgICAgICAgICAg\nICAgICAgICAgICAgZmlyc3RDaGlsZChub2RlKSA6IG5vZGUpOwogICAgICAg\nICAgICBpZiAoYWxpYXNOb2RlICE9IG51bGwpCiAgICAgICAgICAgICAgICBw\ncm9qLnNldEFsaWFzKGFsaWFzKTsKICAgICAgICAgICAgcHJvamVjdGlvbnMu\nYWRkKHByb2opOwogICAgICAgICAgICBwcm9qZWN0aW9uQ2xhdXNlcy5hZGQo\nYWxpYXMpOwogICAgICAgICAgICBwcm9qZWN0aW9uQWxpYXNlcy5hZGQoYWxp\nYXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhwOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBldmFsUHJvamVjdGlvbnNSZXN1bHRTaGFwZShKUFFM\nTm9kZSBzZWxlY3Rpb25zTm9kZSwKICAgICAgICBRdWVyeUV4cHJlc3Npb25z\nIGV4cHMsCiAgICAgICAgTGlzdDxWYWx1ZT4gcHJvamVjdGlvbnMsCiAgICAg\nICAgTGlzdDxTdHJpbmc+IHByb2plY3Rpb25DbGF1c2VzLAogICAgICAgIExp\nc3Q8U3RyaW5nPiBwcm9qZWN0aW9uQWxpYXNlcykgewogICAgICAgIGludCBj\nb3VudCA9IHNlbGVjdGlvbnNOb2RlLmdldENoaWxkQ291bnQoKTsKICAgICAg\nICBDbGFzczw/PiByZXN1bHRDbGFzcyA9IG51bGw7CiAgICAgICAgUmVzdWx0\nU2hhcGU8Pz4gcmVzdWx0U2hhcGUgPSBudWxsOwogICAgICAgIGlmIChjb3Vu\ndCA+IDEpIHsKICAgICAgICAgICAgLy8gbXV0aS1zZWxlY3Rpb24KICAgICAg\nICAgICAgcmVzdWx0Q2xhc3MgPSBPYmplY3RbXS5jbGFzczsKICAgICAgICAg\nICAgcmVzdWx0U2hhcGUgPSBuZXcgUmVzdWx0U2hhcGUocmVzdWx0Q2xhc3Ms\nIG5ldyBGaWxsU3RyYXRlZ3kuQXJyYXk8T2JqZWN0W10+KE9iamVjdFtdLmNs\nYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvdW50OyBpKyspIHsKICAgICAgICAgICAgSlBRTE5vZGUgcGFyZW50ID0g\nc2VsZWN0aW9uc05vZGUuZ2V0Q2hpbGQoaSk7CiAgICAgICAgICAgIEpQUUxO\nb2RlIG5vZGUgPSBmaXJzdENoaWxkKHBhcmVudCk7CiAgICAgICAgICAgIGlm\nIChub2RlLmlkID09IEpKVENPTlNUUlVDVE9SKSB7CiAgICAgICAgICAgICAg\nICAvLyBidWlsZCB1cCB0aGUgZnVsbHktcXVhbGlmaWVkIHJlc3VsdCBjbGFz\ncyBuYW1lIGJ5CiAgICAgICAgICAgICAgICAvLyBhcHBlbmRpbmcgdG9nZXRo\nZXIgdGhlIGNvbXBvbmVudHMgb2YgdGhlIGNoaWxkcmVuCiAgICAgICAgICAg\nICAgICBTdHJpbmcgcmVzdWx0Q2xhc3NOYW1lID0gYXNzZW1ibGUobGVmdChu\nb2RlKSk7CiAgICAgICAgICAgICAgICBDbGFzczw/PiBjb25zdHJ1Y3RvciA9\nIHJlc29sdmVyLmNsYXNzRm9yTmFtZShyZXN1bHRDbGFzc05hbWUsIG51bGwp\nOwogICAgICAgICAgICAgICAgaWYgKGNvbnN0cnVjdG9yID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyB0cnkgcmVzb2x2ZSBpdCBhZ2FpbiB1\nc2luZyBzaW1wbGUgbmFtZQogICAgICAgICAgICAgICAgICAgIGludCBuID0g\nbGVmdChub2RlKS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAgICAgICAgICAg\nICAgU3RyaW5nIGJhc2VOYW1lID0gbGVmdChub2RlKS5nZXRDaGlsZChuLTEp\nLnRleHQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3RydWN0b3IgPSByZXNv\nbHZlci5jbGFzc0Zvck5hbWUoYmFzZU5hbWUsIG51bGwpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbnN0cnVjdG9yID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24o\nRVhfVVNFUiwgIm5vLWNvbnN0cnVjdG9yIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgcmVzdWx0Q2xhc3NOYW1lIH0sIG51\nbGwpOwoKICAgICAgICAgICAgICAgIExpc3Q8VmFsdWU+IHRlcm1zID0gbmV3\nIEFycmF5TGlzdDxWYWx1ZT4oKTsKICAgICAgICAgICAgICAgIExpc3Q8U3Ry\naW5nPiBhbGlhc2VzID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAg\nICAgICAgICAgICBMaXN0PFN0cmluZz4gY2xhdXNlcyA9IG5ldyBBcnJheUxp\nc3Q8U3RyaW5nPigpOwogICAgICAgICAgICAgICAgLy8gbm93IGFzc2lnbiB0\naGUgYXJndW1lbnRzIHRvIHRoZSBzZWxlY3QgY2xhdXNlIGFzIHRoZSBwcm9q\nZWN0aW9ucwogICAgICAgICAgICAgICAgYXNzaWduUHJvamVjdGlvbnMocmln\naHQobm9kZSksIGV4cHMsIHRlcm1zLCBhbGlhc2VzLCBjbGF1c2VzKTsKICAg\nICAgICAgICAgICAgIEZpbGxTdHJhdGVneSBmaWxsID0gbmV3IEZpbGxTdHJh\ndGVneS5OZXdJbnN0YW5jZShjb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgICAg\nICBSZXN1bHRTaGFwZTw/PiBjb25zID0gbmV3IFJlc3VsdFNoYXBlKGNvbnN0\ncnVjdG9yLCBmaWxsKTsKICAgICAgICAgICAgICAgIGZvciAoVmFsdWUgdmFs\nIDogdGVybXMpIHsKICAgICAgICAgICAgICAgICAgICBDbGFzczw/PiB0eXBl\nID0gdmFsLmdldFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICBjb25zLm5l\nc3QobmV3IFJlc3VsdFNoYXBlKHR5cGUsIG5ldyBGaWxsU3RyYXRlZ3kuQXNz\naWduKCksIHR5cGUuaXNQcmltaXRpdmUoKSkpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgaWYgKGNvdW50ID09IDEpIHsKICAgICAgICAg\nICAgICAgICAgICByZXN1bHRDbGFzcyA9IGNvbnN0cnVjdG9yOwogICAgICAg\nICAgICAgICAgICAgIHJlc3VsdFNoYXBlID0gY29uczsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICByZXN1bHRTaGFwZS5uZXN0KGNvbnMpOwogICAgICAgICAgICAgICAgcHJv\namVjdGlvbnMuYWRkQWxsKHRlcm1zKTsKICAgICAgICAgICAgICAgIHByb2pl\nY3Rpb25BbGlhc2VzLmFkZEFsbChhbGlhc2VzKTsKICAgICAgICAgICAgICAg\nIHByb2plY3Rpb25DbGF1c2VzLmFkZEFsbChjbGF1c2VzKTsKCiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBKUFFMTm9kZSBhbGlhc05v\nZGUgPSBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoID4gMSA/IHJpZ2h0KHBhcmVu\ndCkKICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsOyAKICAgICAgICAg\nICAgICAgIFZhbHVlIHByb2ogPSBnZXRWYWx1ZShub2RlKTsKICAgICAgICAg\nICAgICAgIFN0cmluZyBhbGlhcyA9IGFsaWFzTm9kZSAhPSBudWxsID8gYWxp\nYXNOb2RlLnRleHQgOgogICAgICAgICAgICAgICAgICAgIHByb2plY3Rpb25D\nbGF1c2Uobm9kZS5pZCA9PSBKSlRTQ0FMQVJFWFBSRVNTSU9OID8KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQobm9kZSkgOiBub2Rl\nKTsKICAgICAgICAgICAgICAgIGlmIChhbGlhc05vZGUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBwcm9qLnNldEFsaWFzKGFsaWFzKTsKICAgICAg\nICAgICAgICAgIHByb2plY3Rpb25zLmFkZChwcm9qKTsKICAgICAgICAgICAg\nICAgIHByb2plY3Rpb25DbGF1c2VzLmFkZChhbGlhcyk7CiAgICAgICAgICAg\nICAgICBwcm9qZWN0aW9uQWxpYXNlcy5hZGQoYWxpYXMpOwogICAgICAgICAg\nICAgICAgQ2xhc3M8Pz4gdHlwZSA9IHByb2ouZ2V0VHlwZSgpOwogICAgICAg\nICAgICAgICAgUmVzdWx0U2hhcGU8Pz4gcHJvalNoYXBlID0gbmV3IFJlc3Vs\ndFNoYXBlKHR5cGUsIG5ldyBGaWxsU3RyYXRlZ3kuQXNzaWduKCksIHR5cGUu\naXNQcmltaXRpdmUoKSk7CgogICAgICAgICAgICAgICAgaWYgKGNvdW50ID09\nIDEpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0U2hhcGUgPSBwcm9qU2hh\ncGU7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\ncmVzdWx0U2hhcGUubmVzdChwcm9qU2hhcGUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGV4cHMuc2hhcGUgPSByZXN1bHRTaGFwZTsKICAg\nICAgICBleHBzLnJlc3VsdENsYXNzID0gcmVzdWx0Q2xhc3M7CiAgICB9Cgog\nICAgcHJpdmF0ZSBTdHJpbmcgcHJvamVjdGlvbkNsYXVzZShKUFFMTm9kZSBu\nb2RlKSB7CiAgICAgICAgc3dpdGNoIChub2RlLmlkKSB7CiAgICAgICAgY2Fz\nZSBKSlRUWVBFOgogICAgICAgICAgICByZXR1cm4gcHJvamVjdGlvbkNsYXVz\nZShmaXJzdENoaWxkKG5vZGUpKTsKICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICByZXR1cm4gYXNzZW1ibGUobm9kZSk7CiAgICAgICAgfQogICAgfQog\nICAgCiAgICBwcml2YXRlIHZvaWQgZXZhbFF1ZXJ5T3BlcmF0aW9uKFF1ZXJ5\nRXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8vIGRldGVybWluZSB3aGV0\naGVyIHdlIHdhbnQgdG8gc2VsZWN0LCBkZWxldGUsIG9yIHVwZGF0ZQogICAg\nICAgIGlmIChyb290KCkuaWQgPT0gSkpUU0VMRUNUIHx8IHJvb3QoKS5pZCA9\nPSBKSlRTVUJTRUxFQ1QpCiAgICAgICAgICAgIGV4cHMub3BlcmF0aW9uID0g\nUXVlcnlPcGVyYXRpb25zLk9QX1NFTEVDVDsKICAgICAgICBlbHNlIGlmIChy\nb290KCkuaWQgPT0gSkpUREVMRVRFKQogICAgICAgICAgICBleHBzLm9wZXJh\ndGlvbiA9IFF1ZXJ5T3BlcmF0aW9ucy5PUF9ERUxFVEU7CiAgICAgICAgZWxz\nZSBpZiAocm9vdCgpLmlkID09IEpKVFVQREFURSkKICAgICAgICAgICAgZXhw\ncy5vcGVyYXRpb24gPSBRdWVyeU9wZXJhdGlvbnMuT1BfVVBEQVRFOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhf\nVU5TVVBQT1JURUQsICJ1bnJlY29nbml6ZWQtb3BlcmF0aW9uIiwKICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgcm9vdCgpIH0sIG51bGwpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBldmFsR3JvdXBpbmdDbGF1c2UoUXVlcnlF\neHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgLy8gaGFuZGxlIEdST1VQIEJZ\nIGNsYXVzZXMKICAgICAgICBKUFFMTm9kZSBncm91cEJ5Tm9kZSA9IHJvb3Qo\nKS5maW5kQ2hpbGRCeUlEKEpKVEdST1VQQlksIGZhbHNlKTsKCiAgICAgICAg\naWYgKGdyb3VwQnlOb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgaW50IGdyb3VwQnlDb3VudCA9IGdyb3VwQnlOb2RlLmdldENo\naWxkQ291bnQoKTsKCiAgICAgICAgZXhwcy5ncm91cGluZyA9IG5ldyBWYWx1\nZVtncm91cEJ5Q291bnRdOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGdyb3VwQnlDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG5v\nZGUgPSBncm91cEJ5Tm9kZS5nZXRDaGlsZChpKTsKICAgICAgICAgICAgVmFs\ndWUgdmFsID0gZ2V0VmFsdWUobm9kZSk7CiAgICAgICAgICAgIGlmICh2YWwg\naW5zdGFuY2VvZiBQYXRoKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9ICgoUGF0aCkgdmFsKS5sYXN0KCk7CiAgICAgICAgICAgICAg\nICBpZiAoZm1kICE9IG51bGwgJiYgZm1kLmdldFZhbHVlKCkuZ2V0VHlwZU1l\ndGFEYXRhKCkgIT0gbnVsbCAmJiBmbWQuZ2V0VmFsdWUoKS5pc0VtYmVkZGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24o\nRVhfVVNFUiwgImNhbnQtZ3JvdXBieS1lbWJlZGRhYmxlIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlLmdldENoaWxkQ291\nbnQoKSA+IDEgPyBhc3NlbWJsZShub2RlKSA6IG5vZGUudGV4dCB9LCBudWxs\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBleHBzLmdyb3VwaW5nW2ld\nID0gdmFsOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZh\nbEhhdmluZ0NsYXVzZShRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAg\nICAvLyBoYW5kbGUgSEFWSU5HIGNsYXVzZXMKICAgICAgICBKUFFMTm9kZSBo\nYXZpbmdOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5SUQoSkpUSEFWSU5HLCBm\nYWxzZSk7CgogICAgICAgIGlmIChoYXZpbmdOb2RlID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgZXhwcy5oYXZpbmcgPSBnZXRFeHBy\nZXNzaW9uKG9ubHlDaGlsZChoYXZpbmdOb2RlKSk7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGV2YWxPcmRlcmluZ0NsYXVzZXMoUXVlcnlFeHByZXNzaW9u\ncyBleHBzKSB7CiAgICAgICAgLy8gaGFuZGxlIE9SREVSIEJZIGNsYXVzZXMK\nICAgICAgICBKUFFMTm9kZSBvcmRlcmJ5ID0gcm9vdCgpLmZpbmRDaGlsZEJ5\nSUQoSkpUT1JERVJCWSwgZmFsc2UpOwogICAgICAgIGlmIChvcmRlcmJ5ICE9\nIG51bGwpIHsKICAgICAgICAgICAgaW50IG9yZGVyY291bnQgPSBvcmRlcmJ5\nLmdldENoaWxkQ291bnQoKTsKICAgICAgICAgICAgZXhwcy5vcmRlcmluZyA9\nIG5ldyBWYWx1ZVtvcmRlcmNvdW50XTsKICAgICAgICAgICAgZXhwcy5vcmRl\ncmluZ0NsYXVzZXMgPSBuZXcgU3RyaW5nW29yZGVyY291bnRdOwogICAgICAg\nICAgICBleHBzLm9yZGVyaW5nQWxpYXNlcyA9IG5ldyBTdHJpbmdbb3JkZXJj\nb3VudF07CiAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nID0gbmV3IGJvb2xl\nYW5bb3JkZXJjb3VudF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgb3JkZXJjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBKUFFMTm9k\nZSBub2RlID0gb3JkZXJieS5nZXRDaGlsZChpKTsKICAgICAgICAgICAgICAg\nIEpQUUxOb2RlIGZpcnN0Q2hpbGQgPSBmaXJzdENoaWxkKG5vZGUpOwogICAg\nICAgICAgICAgICAgZXhwcy5vcmRlcmluZ1tpXSA9IGdldFZhbHVlKGZpcnN0\nQ2hpbGQpOwogICAgICAgICAgICAgICAgZXhwcy5vcmRlcmluZ0NsYXVzZXNb\naV0gPSBhc3NlbWJsZShmaXJzdENoaWxkKTsKICAgICAgICAgICAgICAgIGV4\ncHMub3JkZXJpbmdBbGlhc2VzW2ldID0gZmlyc3RDaGlsZC50ZXh0OwoKICAg\nICAgICAgICAgICAgIC8vIG9tbWlzc2lvbiBvZiBBU0MvREVTQyB0b2tlbiBp\nbXBsaWVzIGFzY2VuZGluZwogICAgICAgICAgICAgICAgZXhwcy5hc2NlbmRp\nbmdbaV0gPSBub2RlLmdldENoaWxkQ291bnQoKSA8PSAxIHx8CiAgICAgICAg\nICAgICAgICAgICAgbGFzdENoaWxkKG5vZGUpLmlkID09IEpKVEFTQ0VORElO\nRyA/IHRydWUgOiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBjaGVjayBpZiBvcmRlciBieSBzZWxlY3QgaXRlbSByZXN1bHQgYWxpYXMK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBvcmRlcmNvdW50OyBp\nKyspIHsKICAgICAgICAgICAgICAgIGlmIChleHBzLm9yZGVyaW5nQ2xhdXNl\nc1tpXSAhPSBudWxsICYmIAogICAgICAgICAgICAgICAgICAgICFleHBzLm9y\nZGVyaW5nQ2xhdXNlc1tpXS5lcXVhbHMoIiIpKQogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCBleHBzLnByb2plY3Rpb25zLmxlbmd0aDsgaisrKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGV4cHMucHJvamVjdGlvbkFsaWFzZXNbal0uZXF1\nYWxzSWdub3JlQ2FzZSgKICAgICAgICAgICAgICAgICAgICAgICAgZXhwcy5v\ncmRlcmluZ0FsaWFzZXNbaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGV4cHMub3JkZXJpbmdbaV0gPSBleHBzLnByb2plY3Rpb25zW2pdOwogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxTZWxlY3RDbGF1\nc2UoUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaWYgKGV4cHMu\nb3BlcmF0aW9uICE9IFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1QpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3RO\nb2RlID0gcm9vdCgpOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3RDbGF1c2Ug\nPSBzZWxlY3ROb2RlLgogICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVFNF\nTEVDVENMQVVTRSwgZmFsc2UpOwogICAgICAgIGlmIChzZWxlY3RDbGF1c2Ug\nIT0gbnVsbCAmJiBzZWxlY3RDbGF1c2UuaGFzQ2hpbGRJRChKSlRESVNUSU5D\nVCkpCiAgICAgICAgICAgIGV4cHMuZGlzdGluY3QgPSBRdWVyeUV4cHJlc3Np\nb25zLkRJU1RJTkNUX1RSVUUgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nfCBRdWVyeUV4cHJlc3Npb25zLkRJU1RJTkNUX0FVVE87CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBleHBzLmRpc3RpbmN0ID0gUXVlcnlFeHByZXNzaW9u\ncy5ESVNUSU5DVF9GQUxTRTsKCiAgICAgICAgLy8gaGFuZGxlIFNFTEVDVCBj\nbGF1c2VzCiAgICAgICAgSlBRTE5vZGUgZXhwTm9kZSA9IHNlbGVjdE5vZGUu\nCiAgICAgICAgZmluZENoaWxkQnlJRChKSlRTRUxFQ1RFWFBSRVNTSU9OUywg\ndHJ1ZSk7CiAgICAgICAgaWYgKGV4cE5vZGUgPT0gbnVsbCkgewogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIGludCBzZWxl\nY3RDb3VudCA9IGV4cE5vZGUuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgIEpQ\nUUxOb2RlIHNlbGVjdENoaWxkID0gZmlyc3RDaGlsZChleHBOb2RlKTsKCiAg\nICAgICAgaWYgKHNlbGVjdENsYXVzZS5wYXJlbnQuaWQgPT0gSkpUU1VCU0VM\nRUNUKSB7CiAgICAgICAgICAgIGV4cHMuZGlzdGluY3QgJj0gflF1ZXJ5RXhw\ncmVzc2lvbnMuRElTVElOQ1RfQVVUTzsKICAgICAgICAgICAgcmV0dXJuIGFz\nc2lnblN1YnNlbGVjdFByb2plY3Rpb24ob25seUNoaWxkKHNlbGVjdENoaWxk\nKSwgZXhwcyk7CiAgICAgICAgfQogICAgICAgIC8vIGlmIHdlIGFyZSBzZWxl\nY3RpbmcganVzdCBvbmUgdGhpbmcgYW5kIHRoYXQgdGhpbmcgaXMgdGhlCiAg\nICAgICAgLy8gc2NoZW1hJ3MgYWxpYXMsIHRoZW4gZG8gbm90IHRyZWF0IGl0\nIGFzIGEgcHJvamVjdGlvbgogICAgICAgIGlmIChzZWxlY3RDb3VudCA9PSAx\nICYmIHNlbGVjdENoaWxkICE9IG51bGwgJiYKICAgICAgICAgICAgc2VsZWN0\nQ2hpbGQuZ2V0Q2hpbGRDb3VudCgpID09IDEgJiYKICAgICAgICAgICAgb25s\neUNoaWxkKHNlbGVjdENoaWxkKSAhPSBudWxsKSB7CiAgICAgICAgICAgIEpQ\nUUxOb2RlIGNoaWxkID0gb25seUNoaWxkKHNlbGVjdENoaWxkKTsKICAgICAg\nICAgICAgaWYgKGNoaWxkLmlkID09IEpKVFNDQUxBUkVYUFJFU1NJT04pCiAg\nICAgICAgICAgICAgICBjaGlsZCA9IG9ubHlDaGlsZChjaGlsZCk7CiAgICAg\nICAgICAgIGlmIChhc3NlcnRTY2hlbWFBbGlhcygpLmVxdWFsc0lnbm9yZUNh\nc2UoY2hpbGQudGV4dCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgICAgICB9CiAgICAgICAgfSAKICAgICAgICAvLyBKUFFMIGRv\nZXMgbm90IGZpbHRlciByZWxhdGlvbmFsIGpvaW5zIGZvciBwcm9qZWN0aW9u\ncwogICAgICAgIGV4cHMuZGlzdGluY3QgJj0gflF1ZXJ5RXhwcmVzc2lvbnMu\nRElTVElOQ1RfQVVUTzsKICAgICAgICBleHBzLnByb2plY3Rpb25zID0gbmV3\nIFZhbHVlW3NlbGVjdENvdW50XTsKICAgICAgICBMaXN0PFZhbHVlPiBwcm9q\nZWN0aW9ucyA9IG5ldyBBcnJheUxpc3Q8VmFsdWU+KCk7CiAgICAgICAgTGlz\ndDxTdHJpbmc+IGFsaWFzZXMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTsK\nICAgICAgICBMaXN0PFN0cmluZz4gY2xhdXNlcyA9IG5ldyBBcnJheUxpc3Q8\nU3RyaW5nPigpOwogICAgICAgIGV2YWxQcm9qZWN0aW9uc1Jlc3VsdFNoYXBl\nKGV4cE5vZGUsIGV4cHMsIHByb2plY3Rpb25zLCBhbGlhc2VzLCBjbGF1c2Vz\nKTsKICAgICAgICBleHBzLnByb2plY3Rpb25zID0gcHJvamVjdGlvbnMudG9B\ncnJheShuZXcgVmFsdWVbcHJvamVjdGlvbnMuc2l6ZSgpXSk7CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9uQWxpYXNlcyA9IGFsaWFzZXMudG9BcnJheShuZXcg\nU3RyaW5nW2FsaWFzZXMuc2l6ZSgpXSk7CiAgICAgICAgZXhwcy5wcm9qZWN0\naW9uQ2xhdXNlcyA9IGNsYXVzZXMudG9BcnJheShuZXcgU3RyaW5nW2NsYXVz\nZXMuc2l6ZSgpXSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\ncHJpdmF0ZSBTdHJpbmcgYXNzZXJ0U2NoZW1hQWxpYXMoKSB7CiAgICAgICAg\nU3RyaW5nIGFsaWFzID0gY3R4KCkuc2NoZW1hQWxpYXM7CgogICAgICAgIGlm\nIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2Vw\ndGlvbihFWF9VU0VSLCAiYWxpYXMtcmVxdWlyZWQiLAogICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBjdHgoKS5tZXRhIH0sIG51bGwpOwoKICAgICAg\nICByZXR1cm4gYWxpYXM7CiAgICB9CgogICAgcHJvdGVjdGVkIEV4cHJlc3Np\nb24gZXZhbEZldGNoSm9pbnMoUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAg\nICAgICAgRXhwcmVzc2lvbiBmaWx0ZXIgPSBudWxsOwoKICAgICAgICAvLyBo\nYW5kbGUgSk9JTiBGRVRDSAogICAgICAgIFNldDxTdHJpbmc+IGpvaW5zID0g\nbnVsbDsKICAgICAgICBTZXQ8U3RyaW5nPiBpbm5lckpvaW5zID0gbnVsbDsK\nCiAgICAgICAgSlBRTE5vZGVbXSBvdXRlcnMgPSByb290KCkuZmluZENoaWxk\ncmVuQnlJRChKSlRPVVRFUkZFVENISk9JTik7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IG91dGVycyAhPSBudWxsICYmIGkgPCBvdXRlcnMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIChqb2lucyA9PSBudWxsID8gam9pbnMgPSBuZXcg\nVHJlZVNldDxTdHJpbmc+KCkgOiBqb2lucykuCiAgICAgICAgICAgICAgICBh\nZGQoZ2V0UGF0aChvbmx5Q2hpbGQob3V0ZXJzW2ldKSkubGFzdCgpLmdldEZ1\nbGxOYW1lKGZhbHNlKSk7CgogICAgICAgIEpQUUxOb2RlW10gaW5uZXJzID0g\ncm9vdCgpLmZpbmRDaGlsZHJlbkJ5SUQoSkpUSU5ORVJGRVRDSEpPSU4pOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpbm5lcnMgIT0gbnVsbCAmJiBpIDwg\naW5uZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFN0cmluZyBwYXRo\nID0gZ2V0UGF0aChvbmx5Q2hpbGQoaW5uZXJzW2ldKSkubGFzdCgpCiAgICAg\nICAgICAgICAgICAuZ2V0RnVsbE5hbWUoZmFsc2UpOwogICAgICAgICAgICAo\nam9pbnMgPT0gbnVsbCA/IGpvaW5zID0gbmV3IFRyZWVTZXQ8U3RyaW5nPigp\nIDogam9pbnMpLmFkZChwYXRoKTsKICAgICAgICAgICAgKGlubmVySm9pbnMg\nPT0gbnVsbCAKICAgICAgICAgICAgICAgICAgICA/IGlubmVySm9pbnMgPSBu\nZXcgVHJlZVNldDxTdHJpbmc+KCkgCiAgICAgICAgICAgICAgICAgICAgOiBp\nbm5lckpvaW5zKS5hZGQocGF0aCk7CiAgICAgICAgfQoKICAgICAgICBpZiAo\nam9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgZXhwcy5mZXRjaFBhdGhzID0g\nKFN0cmluZ1tdKSBqb2lucy4KICAgICAgICAgICAgICAgIHRvQXJyYXkobmV3\nIFN0cmluZ1tqb2lucy5zaXplKCldKTsKICAgICAgICBpZiAoaW5uZXJKb2lu\ncyAhPSBudWxsKQogICAgICAgICAgICBleHBzLmZldGNoSW5uZXJQYXRocyA9\nIChTdHJpbmdbXSkgaW5uZXJKb2lucy4KICAgICAgICAgICAgICAgIHRvQXJy\nYXkobmV3IFN0cmluZ1tpbm5lckpvaW5zLnNpemUoKV0pOwoKICAgICAgICBy\nZXR1cm4gZmlsdGVyOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGV2YWxT\nZXRDbGF1c2UoUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgLy8g\naGFuZGxlIFNFVCBmaWVsZCA9IHZhbHVlCiAgICAgICAgSlBRTE5vZGVbXSBu\nb2RlcyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpKVFVQREFURUlURU0p\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBub2RlcyAhPSBudWxsICYmIGkg\nPCBub2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBQYXRoIHBhdGgg\nPSBnZXRQYXRoKGZpcnN0Q2hpbGQobm9kZXNbaV0pKTsKICAgICAgICAgICAg\naWYgKHBhdGgubGFzdCgpLmdldFZhbHVlKCkuZ2V0RW1iZWRkZWRNZXRhRGF0\nYSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2Vw\ndGlvbihFWF9VU0VSLCAiY2FudC1idWxrLXVwZGF0ZS1lbWJlZGRhYmxlIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtde2Fzc2VtYmxl\nKGZpcnN0Q2hpbGQobm9kZXNbaV0pKX0sIG51bGwpOwoKICAgICAgICAgICAg\nSlBRTE5vZGUgbGFzdENoaWxkID0gbGFzdENoaWxkKG5vZGVzW2ldKTsKICAg\nICAgICAgICAgVmFsdWUgdmFsID0gKGxhc3RDaGlsZC5jaGlsZHJlbiA9PSBu\ndWxsKSAKICAgICAgICAgICAgICAgICAgICAgID8gbnVsbCA6IGdldFZhbHVl\nKG9ubHlDaGlsZChsYXN0Q2hpbGQpKTsKICAgICAgICAgICAgZXhwcy5wdXRV\ncGRhdGUocGF0aCwgdmFsKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGV2YWxXaGVyZUNsYXVzZSgpIHsKICAgICAgICAvLyBl\ndmFsdWF0ZSB0aGUgV0hFUkUgY2xhdXNlCiAgICAgICAgSlBRTE5vZGUgd2hl\ncmVOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5SUQoSkpUV0hFUkUsIGZhbHNl\nKTsKICAgICAgICBpZiAod2hlcmVOb2RlID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoRXhwcmVzc2lvbikgZXZh\nbCh3aGVyZU5vZGUpOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBl\ndmFsRnJvbUNsYXVzZShib29sZWFuIG5lZWRzQWxpYXMpIHsKICAgICAgICAv\nLyBidWlsZCB1cCB0aGUgYWxpYXMgbWFwIGluIHRoZSBGUk9NIGNsYXVzZQog\nICAgICAgIEpQUUxOb2RlIGZyb20gPSByb290KCkuZmluZENoaWxkQnlJRChK\nSlRGUk9NLCBmYWxzZSk7CiAgICAgICAgaWYgKGZyb20gPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZy\nb20tY2xhdXNlIiwgbnVsbCwgbnVsbCk7CiAgICAgICAgcmV0dXJuIGV2YWxG\ncm9tQ2xhdXNlKGZyb20sIG5lZWRzQWxpYXMpOwogICAgfQoKICAgIHByaXZh\ndGUgRXhwcmVzc2lvbiBldmFsRnJvbUNsYXVzZShKUFFMTm9kZSBmcm9tLCBi\nb29sZWFuIG5lZWRzQWxpYXMpIHsKICAgICAgICBFeHByZXNzaW9uIGV4cCA9\nIG51bGw7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbS5jaGls\nZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBKUFFMTm9kZSBub2Rl\nID0gZnJvbS5jaGlsZHJlbltpXTsKCiAgICAgICAgICAgIGlmIChub2RlLmlk\nID09IEpKVEZST01JVEVNKQogICAgICAgICAgICAgICAgZXhwID0gZXZhbEZy\nb21JdGVtKGV4cCwgbm9kZSwgbmVlZHNBbGlhcyk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKG5vZGUuaWQgPT0gSkpUT1VURVJKT0lOKQogICAgICAgICAgICAg\nICAgZXhwID0gYWRkSm9pbihub2RlLCBmYWxzZSwgZXhwKTsKICAgICAgICAg\nICAgZWxzZSBpZiAobm9kZS5pZCA9PSBKSlRJTk5FUkpPSU4pCiAgICAgICAg\nICAgICAgICBleHAgPSBhZGRKb2luKG5vZGUsIHRydWUsIGV4cCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpUSU5ORVJGRVRDSEpPSU4p\nCiAgICAgICAgICAgICAgICA7IC8vIHdlIGhhbmRsZSBpbm5lciBmZXRjaCBq\nb2lucyBpbiB0aGUgZXZhbEZldGNoSm9pbnMoKSBtZXRob2QKICAgICAgICAg\nICAgZWxzZSBpZiAobm9kZS5pZCA9PSBKSlRPVVRFUkZFVENISk9JTikKICAg\nICAgICAgICAgICAgIDsgLy8gd2UgaGFuZGxlIG91dGVyIGZldGNoIGpvaW5z\nIGluIHRoZSBldmFsRmV0Y2hKb2lucygpIG1ldGhvZAogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117IG5vZGUgfSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gZXhwOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBn\nZXRTdWJxdWVyeShTdHJpbmcgYWxpYXMsIFBhdGggcGF0aCwgRXhwcmVzc2lv\nbiBleHApIHsKICAgICAgICBWYWx1ZSB2YXIgPSBnZXRWYXJpYWJsZShhbGlh\ncywgdHJ1ZSk7CiAgICAgICAgLy8gdGhpcyBiaW5kIGlzIGZvciB2YWxpZGF0\nZU1hcFBhdGggdG8gcmVzb2x2ZSBhbGlhcwogICAgICAgIEV4cHJlc3Npb24g\nYmluZFZhciA9IGZhY3RvcnkuYmluZFZhcmlhYmxlKHZhciwgcGF0aCk7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXRoLmxhc3QoKTsKICAgICAg\nICBDbGFzc01ldGFEYXRhIGNhbmRpZGF0ZSA9IGdldEZpZWxkVHlwZShmbWQp\nOwogICAgICAgIGlmIChjYW5kaWRhdGUgPT0gbnVsbCAmJiBmbWQuaXNFbGVt\nZW50Q29sbGVjdGlvbigpKQogICAgICAgICAgICBjYW5kaWRhdGUgPSBmbWQu\nZ2V0RGVmaW5pbmdNZXRhRGF0YSgpOwoKICAgICAgICBzZXRDYW5kaWRhdGUo\nY2FuZGlkYXRlLCBhbGlhcyk7CgogICAgICAgIENvbnRleHQgc3ViQ29udGV4\ndCA9IGN0eCgpOwogICAgICAgIFN1YnF1ZXJ5IHN1YnF1ZXJ5ID0gY3R4KCku\nZ2V0U3VicXVlcnkoKTsKICAgICAgICBpZiAoc3VicXVlcnkgPT0gbnVsbCl7\nCiAgICAgICAgICAgIHN1YnF1ZXJ5ID0gZmFjdG9yeS5uZXdTdWJxdWVyeShj\nYW5kaWRhdGUsIHRydWUsIGFsaWFzKTsKICAgICAgICAgICAgc3ViQ29udGV4\ndC5zZXRTdWJxdWVyeShzdWJxdWVyeSk7CiAgICAgICAgfQogICAgICAgIGVs\nc2UgewogICAgICAgICAgICBzdWJxdWVyeS5zZXRTdWJxQWxpYXMoYWxpYXMp\nOwogICAgICAgIH0KCiAgICAgICAgUGF0aCBzdWJwYXRoID0gZmFjdG9yeS5u\nZXdQYXRoKHN1YnF1ZXJ5KTsKICAgICAgICBzdWJwYXRoLnNldFNjaGVtYUFs\naWFzKHBhdGguZ2V0Q29ycmVsYXRpb25WYXIoKSk7CiAgICAgICAgc3VicGF0\naC5zZXRNZXRhRGF0YShjYW5kaWRhdGUpOwogICAgICAgIHN1YnF1ZXJ5LnNl\ndE1ldGFEYXRhKGNhbmRpZGF0ZSk7CiAgICAgICAgaWYgKGZtZC5pc0VsZW1l\nbnRDb2xsZWN0aW9uKCkpCiAgICAgICAgICAgIGV4cCA9IGFuZChleHAsIGJp\nbmRWYXIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZXhwID0gYW5kKGV4\ncCwgZmFjdG9yeS5lcXVhbChwYXRoLCBzdWJwYXRoKSk7CgogICAgICAgIHJl\ndHVybiBleHA7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgam9pbiBj\nb25kaXRpb24gdG8gdGhlIGdpdmVuIGV4cHJlc3Npb24uCiAgICAgKgogICAg\nICogQHBhcmFtIG5vZGUgdGhlIG5vZGUgdG8gY2hlY2sKICAgICAqIEBwYXJh\nbSBpbm5lciB3aGV0aGVyIG9yIG5vdCB0aGUgam9pbiBzaG91bGQgYmUgYW4g\naW5uZXIgam9pbgogICAgICogQHBhcmFtIGV4cCBhbiBleGlzdGluZyBleHBy\nZXNzaW9uIHRvIEFORCwgb3IgbnVsbCBpZiBub25lCiAgICAgKiBAcmV0dXJu\nIHRoZSBFeHByZXNzaW9uIHdpdGggdGhlIGpvaW4gY29uZGl0aW9uIGFkZGVk\nCiAgICAgKi8KICAgIHByaXZhdGUgRXhwcmVzc2lvbiBhZGRKb2luKEpQUUxO\nb2RlIG5vZGUsIGJvb2xlYW4gaW5uZXIsIEV4cHJlc3Npb24gZXhwKSB7CiAg\nICAgICAgLy8gdGhlIHR5cGUgd2lsbCBiZSB0aGUgZGVjbGFyZWQgdHlwZSBm\nb3IgdGhlIGZpZWxkCiAgICAgICAgSlBRTE5vZGUgZmlyc3RDaGlsZCA9IGZp\ncnN0Q2hpbGQobm9kZSk7CiAgICAgICAgUGF0aCBwYXRoID0gbnVsbDsKICAg\nICAgICBpZiAoZmlyc3RDaGlsZC5pZCA9PSBKSlRRVUFMSUZJRURQQVRIKQog\nICAgICAgICAgICBwYXRoID0gKFBhdGgpIGdldFF1YWxpZmllZFBhdGgoZmly\nc3RDaGlsZCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwYXRoID0gZ2V0\nUGF0aChmaXJzdENoaWxkLCBmYWxzZSwgaW5uZXIpOwoKICAgICAgICBKUFFM\nTm9kZSBhbGlhcyA9IG5vZGUuZ2V0Q2hpbGRDb3VudCgpID49IDIgPyByaWdo\ndChub2RlKSA6IG51bGw7CiAgICAgICAgLy8gT1BFTkpQQS0xNSBzdXBwb3J0\nIHN1YnF1ZXJ5J3MgZnJvbSBjbGF1c2UgZG8gbm90IHN0YXJ0IHdpdGggCiAg\nICAgICAgLy8gaWRlbnRpZmljYXRpb25fdmFyaWFibGVfZGVjbGFyYXRpb24o\nKQogICAgICAgIGlmIChpbm5lciAmJiBjdHgoKS5nZXRQYXJlbnQoKSAhPSBu\ndWxsICYmIGN0eCgpLnNjaGVtYUFsaWFzID09IG51bGwpIHsKICAgICAgICAg\nICAgcmV0dXJuIGdldFN1YnF1ZXJ5KGFsaWFzLnRleHQsIHBhdGgsIGV4cCk7\nCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYWRkSm9pbihwYXRoLCBhbGlh\ncywgZXhwKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gYWRkSm9p\nbihQYXRoIHBhdGgsIEpQUUxOb2RlIGFsaWFzTm9kZSwKICAgICAgICBFeHBy\nZXNzaW9uIGV4cCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0\naC5sYXN0KCk7CgogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgInBhdGgtbm8tbWV0\nYSIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHBhdGgsIG51bGwg\nfSwgbnVsbCk7CgogICAgICAgIFN0cmluZyBhbGlhcyA9IGFsaWFzTm9kZSAh\nPSBudWxsID8gYWxpYXNOb2RlLnRleHQgOiBuZXh0QWxpYXMoKTsKCiAgICAg\nICAgVmFsdWUgdmFyID0gZ2V0VmFyaWFibGUoYWxpYXMsIHRydWUpOwogICAg\nICAgIHZhci5zZXRNZXRhRGF0YShnZXRGaWVsZFR5cGUoZm1kKSk7CgogICAg\nICAgIEV4cHJlc3Npb24gam9pbiA9IG51bGw7CgogICAgICAgIC8vIGlmIHRo\nZSB2YXJpYWJsZSBpcyBhbHJlYWR5IGJvdW5kLCBnZXQgdGhlIHZhcidzIHZh\nbHVlIGFuZAogICAgICAgIC8vIGRvIGEgcmVndWxhciBjb250YWlucyB3aXRo\nIHRoYXQKICAgICAgICBib29sZWFuIGJvdW5kID0gaXNCb3VuZCh2YXIpOwog\nICAgICAgIGlmIChib3VuZCkgewogICAgICAgICAgICB2YXIgPSBnZXRWYWx1\nZShhbGlhc05vZGUsIFZBUl9QQVRIKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBiaW5kKHZhcik7CiAgICAgICAgICAgIGpvaW4gPSBhbmQoam9p\nbiwgZmFjdG9yeS5iaW5kVmFyaWFibGUodmFyLCBwYXRoKSk7CiAgICAgICAg\nfQoKICAgICAgICBpZiAoIWZtZC5pc1R5cGVQQygpKSAvLyBtdWx0aS12YWx1\nZWQgcmVsYXRpb24KICAgICAgICB7CiAgICAgICAgICAgIGlmIChib3VuZCkK\nICAgICAgICAgICAgICAgIGpvaW4gPSBhbmQoam9pbiwgZmFjdG9yeS5jb250\nYWlucyhwYXRoLCB2YXIpKTsKCiAgICAgICAgICAgIHNldEltcGxpY2l0Q29u\ndGFpbnNUeXBlcyhwYXRoLCB2YXIsIENPTlRBSU5TX1RZUEVfRUxFTUVOVCk7\nCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYW5kKGV4cCwgam9pbik7CiAg\nICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxGcm9tSXRlbShFeHBy\nZXNzaW9uIGV4cCwgSlBRTE5vZGUgbm9kZSwKICAgICAgICBib29sZWFuIG5l\nZWRzQWxpYXMpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlc29s\ndmVDbGFzc01ldGFEYXRhKGZpcnN0Q2hpbGQobm9kZSkpOwoKICAgICAgICBT\ndHJpbmcgYWxpYXMgPSBudWxsOwoKICAgICAgICBpZiAobm9kZS5nZXRDaGls\nZENvdW50KCkgPCAyKSB7CiAgICAgICAgICAgIGlmIChuZWVkc0FsaWFzKQog\nICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwg\nImFsaWFzLXJlcXVpcmVkIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IGNtZCB9LCBudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBhbGlhcyA9IHJpZ2h0KG5vZGUpLnRleHQ7CiAgICAgICAgICAgIEpQ\nUUxOb2RlIGxlZnQgPSBsZWZ0KG5vZGUpOwogICAgICAgICAgICBhZGRTY2hl\nbWFUb0NvbnRleHQoYWxpYXMsIGNtZCk7CgogICAgICAgICAgICAvLyBjaGVj\nayB0byBzZWUgaWYgdGhlIHdlIGFyZSByZWZlcnJpbmcgdG8gYSBwYXRoIGlu\nIHRoZSBmcm9tCiAgICAgICAgICAgIC8vIGNsYXVzZSwgc2luY2Ugd2UgbWln\naHQgYmUgaW4gYSBzdWJxdWVyeSBhZ2FpbnN0IGEgY29sbGVjdGlvbgogICAg\nICAgICAgICBpZiAoaXNQYXRoKGxlZnQpKSB7CiAgICAgICAgICAgICAgICBQ\nYXRoIHBhdGggPSBnZXRQYXRoKGxlZnQpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFN1YnF1ZXJ5KGFsaWFzLCBwYXRoLCBleHApOwogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gd2UgaGF2ZSBhbiBhbGlh\nczogYmluZCBpdCBhcyBhIHZhcmlhYmxlCiAgICAgICAgICAgICAgICBWYWx1\nZSB2YXIgPSBnZXRWYXJpYWJsZShhbGlhcywgdHJ1ZSk7CiAgICAgICAgICAg\nICAgICB2YXIuc2V0TWV0YURhdGEoY21kKTsKICAgICAgICAgICAgICAgIGJp\nbmQodmFyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nIyMjIHdlIGFzc2lnbiB0aGUgZmlyc3QgRlJPTUlURU0gaW5zdGFuY2Ugd2Ug\nc2VlIGFzCiAgICAgICAgLy8gdGhlIGdsb2JhbCBjYW5kaWRhdGUsIHdoaWNo\nIGlzIGluY29ycmVjdDogd2Ugc2hvdWxkCiAgICAgICAgLy8gaW5zdGVhZCBi\nZSBtYXBwaW5nIHRoaXMgdG8gdGhlIFNFTEVDVElURU0gdG8gc2VlCiAgICAg\nICAgLy8gd2hpY2ggaXMgdGhlIGRlc2lyZWQgY2FuZGlkYXRlCiAgICAgICAg\naWYgKGN0eCgpLnNjaGVtYUFsaWFzID09IG51bGwpCiAgICAgICAgICAgIHNl\ndENhbmRpZGF0ZShjbWQsIGFsaWFzKTsKICAgICAgICBlbHNlICAKICAgICAg\nICAgICAgYWRkQWNjZXNzUGF0aChjbWQpOwoKICAgICAgICByZXR1cm4gZXhw\nOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlzRGVjbGFyZWRWYXJp\nYWJsZShTdHJpbmcgbmFtZSkgewogICAgICAgIC8vIEpQUUwgZG9lc24ndCBz\ndXBwb3J0IGRlY2xhcmluZyB2YXJpYWJsZXMKICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0byBzZWUgaWYgdGhl\nIHNwZWNpZmljIG5vZGUgaXMgYSBwYXRoICh2cy4gYSBzY2hlbWEgbmFtZSkK\nICAgICAqLwogICAgYm9vbGVhbiBpc1BhdGgoSlBRTE5vZGUgbm9kZSkgewog\nICAgICAgIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA8IDIpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgU3RyaW5nIG5hbWUg\nPSBmaXJzdENoaWxkKG5vZGUpLnRleHQ7CiAgICAgICAgaWYgKG5hbWUgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBo\nYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMgdGhlIGFs\naWFzCiAgICAgICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRvbid0IHVz\nZSB2YXJpYWJsZXMgZm9yIHRoaXMpCiAgICAgICAgaWYgKGdldE1ldGFEYXRh\nRm9yQWxpYXMobmFtZSkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CgogICAgICAgIGlmICghaXNTZWVuVmFyaWFibGUobmFtZSkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgVmFsdWUgdmFy\nID0gZ2V0VmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICBpZiAodmFy\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBpc0JvdW5kKHZhcik7Cgog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBDbGFzc01ldGFEYXRhIGdldEZpZWxkVHlwZShGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gbnVsbDsK\nICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZDsKCiAgICAgICAgaWYgKCh2bWQg\nPSBmbWQuZ2V0RWxlbWVudCgpKSAhPSBudWxsKQogICAgICAgICAgICBjbWQg\nPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICBlbHNl\nIGlmICgodm1kID0gZm1kLmdldEtleSgpKSAhPSBudWxsKQogICAgICAgICAg\nICBjbWQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICBlbHNlIGlmICgodm1kID0gZm1kLmdldFZhbHVlKCkpICE9IG51bGwpCiAg\nICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgp\nOwoKICAgICAgICBpZiAoY21kID09IG51bGwgfHwgY21kLmdldERlc2NyaWJl\nZFR5cGUoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNtZCA9IGZt\nZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwoKICAgICAgICByZXR1cm4g\nY21kOwogICAgfQoKICAgIC8qKgogICAgICogSWRlbnRpZmljYXRpb24gdmFy\naWFibGVzIGluIEpQUUwgYXJlIGNhc2UgaW5zZW5zaXRpdmUsIHNvIGxvd2Vy\nLWNhc2UKICAgICAqIGFsbCB2YXJpYWJsZXMgd2UgYXJlIGdvaW5nIHRvIGJp\nbmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZSBnZXRWYXJpYWJsZShT\ndHJpbmcgaWQsIGJvb2xlYW4gYmluZCkgewogICAgICAgIGlmIChpZCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKGJp\nbmQgJiYgZ2V0RGVmaW5lZFZhcmlhYmxlKGlkKSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gY3JlYXRlVmFyaWFibGUoaWQsIGJpbmQpOwoKICAgICAg\nICByZXR1cm4gc3VwZXIuZ2V0VmFyaWFibGUoaWQudG9Mb3dlckNhc2UoKSwg\nYmluZCk7CiAgICB9CgogICAgcHJvdGVjdGVkIFZhbHVlIGdldERlZmluZWRW\nYXJpYWJsZShTdHJpbmcgaWQpIHsKICAgICAgICByZXR1cm4gY3R4KCkuZ2V0\nVmFyaWFibGUoaWQpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlz\nU2VlblZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICBDb250ZXh0IGMg\nPSBjdHgoKS5maW5kQ29udGV4dCh2YXIpOwogICAgICAgIGlmIChjICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsYXNz\nIG5hbWUgdXNpbmcgdGhlIGNoaWxkcmVuIG9mIHRoZSBKUFFMTm9kZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgYXNzZXJ0U2NoZW1hTmFtZShKUFFM\nTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuaWQgIT0gSkpUQUJTVFJB\nQ1RTQ0hFTUFOQU1FKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAibm90LWlkZW50aWZlciIsCiAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117IG5vZGUgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBh\nc3NlbWJsZShub2RlKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY2hlY2tF\nbWJlZGRhYmxlKFZhbHVlIHZhbCkgewogICAgICAgIGNoZWNrRW1iZWRkYWJs\nZSh2YWwsIGN1cnJlbnRRdWVyeSgpKTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHN0YXRpYyB2b2lkIGNoZWNrRW1iZWRkYWJsZShWYWx1ZSB2YWwsIFN0cmlu\nZyBjdXJyZW50UXVlcnkpIHsKICAgICAgICBQYXRoIHBhdGggPSB2YWwgaW5z\ndGFuY2VvZiBQYXRoID8gKFBhdGgpIHZhbCA6IG51bGw7CiAgICAgICAgaWYg\nKHBhdGggPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCA9IHBhdGgubGFzdCgpOwogICAgICAgIGlmIChm\nbWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBWYWx1\nZU1ldGFEYXRhIHZtID0gZm1kLmlzRWxlbWVudENvbGxlY3Rpb24oKSA/IGZt\nZC5nZXRFbGVtZW50KCkKICAgICAgICAgICAgOiBmbWQuZ2V0VmFsdWUoKTsK\nICAgICAgICBpZiAodm0uZ2V0RW1iZWRkZWRNZXRhRGF0YSgpICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy90aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAiYmFkLXByZWRpY2F0ZSIsCiAgICAgICAgICAgIC8vICAgIG5ldyBPYmpl\nY3RbXXsgY3VycmVudFF1ZXJ5KCkgfSwgbnVsbCk7CiAgICAgICAgICAgIFN0\ncmluZyBhcmdTdHIgPSBfbG9jLmdldCgiYmFkLXByZWRpY2F0ZSIsIAogICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdIHtmbWQuZ2V0TmFtZSgpfSkuZ2V0\nTWVzc2FnZSgpOwogICAgICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0\nKCJwYXJzZS1lcnJvciIsIGFyZ1N0ciwgY3VycmVudFF1ZXJ5KTsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24obXNnLCBudWxsKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVy\nIG1ldGhvZCB0byBldmFsdWF0ZSB0aGUgZ2l2ZW4gbm9kZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBPYmplY3QgZXZhbChKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgVmFsdWUgdmFsMSA9IG51bGw7CiAgICAgICAgVmFsdWUgdmFsMiA9IG51\nbGw7CiAgICAgICAgVmFsdWUgdmFsMyA9IG51bGw7CgogICAgICAgIGJvb2xl\nYW4gbm90ID0gbm9kZS5ub3Q7CgogICAgICAgIHN3aXRjaCAobm9kZS5pZCkg\newogICAgICAgICAgICBjYXNlIEpKVFNDQUxBUkVYUFJFU1NJT046CiAgICAg\nICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9kZSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRUWVBFOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFR5cGUob25seUNoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUVFlQRUxJVEVSQUw6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VHlw\nZUxpdGVyYWwobm9kZSk7CgogICAgICAgICAgICBjYXNlIEpKVENMQVNTTkFN\nRToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXRoT3JDb25zdGFudChu\nb2RlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ0FTRToKICAgICAgICAgICAg\nICAgIHJldHVybiBldmFsKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVFNJTVBMRUNBU0U6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0U2ltcGxlQ2FzZUV4cHJlc3Npb24obm9kZSk7CgogICAgICAgICAgICBj\nYXNlIEpKVEdFTkVSQUxDQVNFOgogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndEdlbmVyYWxDYXNlRXhwcmVzc2lvbihub2RlKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUV0hFTjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRXaGVuQ29u\nZGl0aW9uKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRXSEVOU0NBTEFS\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFdoZW5TY2FsYXIobm9kZSk7\nCgogICAgICAgICAgICBjYXNlIEpKVENPQUxFU0NFOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldENvYWxlc2NlRXhwcmVzc2lvbihub2RlKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUTlVMTElGOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldE51bGxJZkV4cHJlc3Npb24obm9kZSk7CgogICAgICAgICAgICBjYXNl\nIEpKVFdIRVJFOiAvLyB0b3AtbGV2ZWwgV0hFUkUgY2xhdXNlCiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0RXhwcmVzc2lvbihvbmx5Q2hpbGQobm9kZSkp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRCT09MRUFOTElURVJBTDoKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwoInRydWUiLmVx\ndWFsc0lnbm9yZUNhc2UKICAgICAgICAgICAgICAgICAgICAobm9kZS50ZXh0\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsCiAgICAgICAgICAg\nICAgICAgICAgTGl0ZXJhbC5UWVBFX0JPT0xFQU4pOwoKICAgICAgICAgICAg\nY2FzZSBKSlRJTlRFR0VSTElURVJBTDoKICAgICAgICAgICAgICAgIC8vIHVz\nZSBCaWdEZWNpbWFsIGJlY2F1c2UgaXQgY2FuIGhhbmRsZSBwYXJzaW5nIGV4\ncG9uZW50cwogICAgICAgICAgICAgICAgQmlnRGVjaW1hbCBpbnRsaXQgPSBu\nZXcgQmlnRGVjaW1hbAogICAgICAgICAgICAgICAgICAgIChub2RlLnRleHQu\nZW5kc1dpdGgoImwiKSB8fCBub2RlLnRleHQuZW5kc1dpdGgoIkwiKQogICAg\nICAgICAgICAgICAgICAgICAgICA/IG5vZGUudGV4dC5zdWJzdHJpbmcoMCwg\nbm9kZS50ZXh0Lmxlbmd0aCgpIC0gMSkKICAgICAgICAgICAgICAgICAgICAg\nICAgOiBub2RlLnRleHQpLgogICAgICAgICAgICAgICAgICAgIG11bHRpcGx5\nKG5ldyBCaWdEZWNpbWFsKG5lZ2F0aXZlKG5vZGUpKSk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFsKG5ldyBMb25nKGludGxp\ndC5sb25nVmFsdWUoKSksCiAgICAgICAgICAgICAgICAgICAgTGl0ZXJhbC5U\nWVBFX05VTUJFUik7CgogICAgICAgICAgICBjYXNlIEpKVERFQ0lNQUxMSVRF\nUkFMOgogICAgICAgICAgICAgICAgQmlnRGVjaW1hbCBkZWNsaXQgPSBuZXcg\nQmlnRGVjaW1hbAogICAgICAgICAgICAgICAgICAgIChub2RlLnRleHQuZW5k\nc1dpdGgoImQiKSB8fCBub2RlLnRleHQuZW5kc1dpdGgoIkQiKSB8fAogICAg\nICAgICAgICAgICAgICAgICAgICBub2RlLnRleHQuZW5kc1dpdGgoImYiKSB8\nfCBub2RlLnRleHQuZW5kc1dpdGgoIkYiKQogICAgICAgICAgICAgICAgICAg\nICAgICA/IG5vZGUudGV4dC5zdWJzdHJpbmcoMCwgbm9kZS50ZXh0Lmxlbmd0\naCgpIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBub2RlLnRleHQp\nLgogICAgICAgICAgICAgICAgICAgIG11bHRpcGx5KG5ldyBCaWdEZWNpbWFs\nKG5lZ2F0aXZlKG5vZGUpKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5uZXdMaXRlcmFsKGRlY2xpdCwgTGl0ZXJhbC5UWVBFX05VTUJFUik7\nCgogICAgICAgICAgICBjYXNlIEpKVFNUUklOR0xJVEVSQUw6CiAgICAgICAg\nICAgIGNhc2UgSkpUVFJJTUNIQVJBQ1RFUjoKICAgICAgICAgICAgY2FzZSBK\nSlRFU0NBUEVDSEFSQUNURVI6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5uZXdMaXRlcmFsKHRyaW1RdW90ZXMobm9kZS50ZXh0KSwKICAgICAg\nICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVfU1FfU1RSSU5HKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUUEFUVEVSTlZBTFVFOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGV2YWwoZmlyc3RDaGlsZChub2RlKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVE5BTUVESU5QVVRQQVJBTUVURVI6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UGFyYW1ldGVyKG9ubHlDaGlsZChub2RlKS50ZXh0LCBmYWxz\nZSwgZmFsc2UpOwoKICAgICAgICAgICAgY2FzZSBKSlRQT1NJVElPTkFMSU5Q\nVVRQQVJBTUVURVI6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGFyYW1l\ndGVyKG5vZGUudGV4dCwgdHJ1ZSwgZmFsc2UpOwoKICAgICAgICAgICAgY2Fz\nZSBKSlRDT0xMRUNUSU9OUEFSQU1FVEVSOgogICAgICAgICAgICAgICAgSlBR\nTE5vZGUgY2hpbGQgPSBvbmx5Q2hpbGQobm9kZSk7CiAgICAgICAgICAgICAg\nICBib29sZWFuIHBvc2l0aW9uYWwgPSBjaGlsZC5pZCA9PSBKSlRQT1NJVElP\nTkFMSU5QVVRQQVJBTUVURVI7CiAgICAgICAgICAgICAgICBpZiAoIXBvc2l0\naW9uYWwpCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBvbmx5Q2hpbGQo\nY2hpbGQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFBhcmFtZXRlcihj\naGlsZC50ZXh0LCAKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbmFsLCB0\ncnVlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUT1I6IC8vIHggT1IgeQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkub3IoZ2V0RXhwcmVzc2lvbihs\nZWZ0KG5vZGUpKSwKICAgICAgICAgICAgICAgICAgICBnZXRFeHByZXNzaW9u\nKHJpZ2h0KG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFORDogLy8g\neCBBTkQgeQogICAgICAgICAgICAgICAgcmV0dXJuIGFuZChnZXRFeHByZXNz\naW9uKGxlZnQobm9kZSkpLAogICAgICAgICAgICAgICAgICAgIGdldEV4cHJl\nc3Npb24ocmlnaHQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpURVFV\nQUxTOiAvLyB4ID0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVl\nKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVl\nKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUTk9URVFVQUxTOiAvLyB4IDw+IHkKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwodmFsMSwgdmFsMik7CgogICAg\nICAgICAgICBjYXNlIEpKVExFU1NUSEFOOiAvLyB4IDwgeQogICAgICAgICAg\nICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAg\nICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAg\nICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5sZXNzVGhhbih2YWwxLCB2\nYWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTEVTU09SRVFVQUw6IC8vIHgg\nPD0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9k\nZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5v\nZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwg\ndmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5s\nZXNzVGhhbkVxdWFsKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRHUkVBVEVSVEhBTjogLy8geCA+IHkKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3RvcnkuZ3JlYXRlclRoYW4odmFsMSwgdmFsMik7Cgog\nICAgICAgICAgICBjYXNlIEpKVEdSRUFURVJPUkVRVUFMOiAvLyB4ID49IHkK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIs\nIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ3JlYXRl\nclRoYW5FcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nQUREOiAvLyB4ICsgeQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVl\nKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVl\nKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhY3RvcnkuYWRkKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAg\nY2FzZSBKSlRTVUJUUkFDVDogLy8geCAtIHkKICAgICAgICAgICAgICAgIHZh\nbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZh\nbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBz\nZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1YnRyYWN0KHZhbDEsIHZh\nbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRNVUxUSVBMWTogLy8geCAqIHkK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIs\nIFRZUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLm11bHRpcGx5KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRE\nSVZJREU6IC8vIHggLyB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFs\ndWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFs\ndWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRU\neXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5kaXZpZGUodmFsMSwgdmFsMik7CgogICAgICAg\nICAgICBjYXNlIEpKVEJFVFdFRU46IC8vIHguZmllbGQgW05PVF0gQkVUV0VF\nTiA1IEFORCAxMAogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGNo\naWxkKG5vZGUsIDAsIDMpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRW\nYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7CiAgICAgICAgICAgICAgICB2YWwz\nID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMiwgMykpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAg\nICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMywgbnVsbCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsIGFuZChmYWN0\nb3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwgdmFsMiksCiAgICAgICAgICAg\nICAgICAgICAgZmFjdG9yeS5sZXNzVGhhbkVxdWFsKHZhbDEsIHZhbDMpKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVElOOiAvLyB4LmZpZWxkIFtOT1RdIElO\nICgnYScsICdiJywgJ2MnKQogICAgICAgICAgICAgICAgICAgICAgICAvLyBU\nWVBFKHguLi4pIFtOT1RdIElOIChlbnRpdHlUeXBlTGl0ZXJhbDEsLi4uKQog\nICAgICAgICAgICAgICAgRXhwcmVzc2lvbiBpbkV4cCA9IG51bGw7CiAgICAg\nICAgICAgICAgICBJdGVyYXRvcjxKUFFMTm9kZT4gaW5JdGVyYXRvciA9IG5v\nZGUuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIC8vIHRoZSBmaXJzdCBj\naGlsZCBpcyB0aGUgcGF0aAogICAgICAgICAgICAgICAgSlBRTE5vZGUgZmly\nc3QgPSBpbkl0ZXJhdG9yLm5leHQoKTsKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShmaXJzdCk7CgogICAgICAgICAgICAgICAgd2hpbGUgKGlu\nSXRlcmF0b3IuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgSlBR\nTE5vZGUgbmV4dCA9IGluSXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChmaXJzdC5pZCA9PSBKSlRUWVBFICYmIG5leHQuaWQgPT0g\nSkpUVFlQRUxJVEVSQUwpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRUeXBlTGl0ZXJhbChuZXh0KTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShu\nZXh0KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGZv\nciA8dmFsdWU+IElOICg8c3VicXVlcnk+KSBvcgogICAgICAgICAgICAgICAg\nICAgIC8vIDx2YWx1ZT4gSU4gKDxzaW5nbGUgdmFsdWU+KQogICAgICAgICAg\nICAgICAgICAgIGlmICghKHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsKSAmJiBu\nb2RlLmdldENoaWxkQ291bnQoKSA9PSAyKQogICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZXZhbE5vdChub3QsIGZhY3RvcnkuY29udGFpbnModmFs\nMiwgdmFsMSkpOyAKCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBj\ndXJyZW50bHkgYSBzZXF1ZW5jZSBvZiBPUiBleHByZXNzaW9ucywgc2luY2Ug\nd2UKICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3QgaGF2ZSBzdXBwb3J0\nIGZvciBJTiBleHByZXNzaW9ucwogICAgICAgICAgICAgICAgICAgIHNldElt\ncGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGluRXhwID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGluRXhwID0gZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlu\nRXhwID0gZmFjdG9yeS5vcihpbkV4cCwgZmFjdG9yeS5lcXVhbCh2YWwxLCB2\nYWwyKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g\nd2UgYWRkaXRpb25hbGx5IG5lZWQgdG8gYWRkIGluIGEgIk5PVCBOVUxMIiBj\nbGF1c2UsIHNpbmNlCiAgICAgICAgICAgICAgICAvLyB0aGUgSU4gYmVoYXZp\nb3IgdGhhdCBpcyBleHBlY3RlZCBieSB0aGUgQ1RTIGFsc28gZXhwZWN0cwog\nICAgICAgICAgICAgICAgLy8gdG8gZmlsdGVyIG91ciBOVUxMcwogICAgICAg\nICAgICAgICAgcmV0dXJuIGFuZChldmFsTm90KG5vdCwgaW5FeHApLAogICAg\nICAgICAgICAgICAgICAgIGZhY3Rvcnkubm90RXF1YWwodmFsMSwgZmFjdG9y\neS5nZXROdWxsKCkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSVNOVUxMOiAv\nLyB4LmZpZWxkIElTIFtOT1RdIE5VTEwKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nY2hlY2tFbWJlZGRhYmxlKHZhbDEpOwogICAgICAgICAgICAgICAgaWYgKG5v\ndCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5ub3RFcXVh\nbAogICAgICAgICAgICAgICAgICAgICAgICAodmFsMSwgZmFjdG9yeS5nZXRO\ndWxsKCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWN0b3J5LmVxdWFsCiAgICAgICAgICAgICAgICAgICAg\nICAgICh2YWwxLCBmYWN0b3J5LmdldE51bGwoKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVFBBVEg6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGF0aE9y\nQ29uc3RhbnQobm9kZSk7CgogICAgICAgICAgICBjYXNlIEpKVElERU5USUZJ\nRVI6CiAgICAgICAgICAgIGNhc2UgSkpUSURFTlRJRklDQVRJT05WQVJJQUJM\nRToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRJZGVudGlmaWVyKG5vZGUp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRRVUFMSUZJRURQQVRIOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFF1YWxpZmllZFBhdGgobm9kZSk7CgogICAg\nICAgICAgICBjYXNlIEpKVFFVQUxJRklFRElERU5USUZJRVI6CiAgICAgICAg\nICAgICAgICAvLyBLRVkoZSksIFZBTFVFKGUpLCBFTlRSWShlKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFF1YWxpZmllZElkZW50aWZpZXIobm9kZSk7\nCgogICAgICAgICAgICBjYXNlIEpKVEdFTkVSQUxJREVOVElGSUVSOgogICAg\nICAgICAgICAgICAgLy8gS0VZKGUpLCBWQUxVRShlKQogICAgICAgICAgICAg\nICAgaWYgKG5vZGUucGFyZW50LnBhcmVudC5pZCA9PSBKSlRXSEVSRSB8fCBu\nb2RlLnBhcmVudC5pZCA9PSBKSlRHUk9VUEJZKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRHZW5lcmFsSWRlbnRpZmllcihvbmx5Q2hpbGQobm9k\nZSksIHRydWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFF1YWxpZmll\nZElkZW50aWZpZXIob25seUNoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUTk9UOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90\nKGdldEV4cHJlc3Npb24ob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVExJS0U6IC8vIGZpZWxkIExJS0UgJyVzb21ldmFsJScKICAg\nICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7Cgog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RS\nSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwyLCBU\nWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgLy8gbG9vayBmb3IgYW4g\nZXNjYXBlIGNoYXJhY3RlciBiZW5lYXRoIHRoZSBub2RlCiAgICAgICAgICAg\nICAgICBTdHJpbmcgZXNjYXBlID0gbnVsbDsKICAgICAgICAgICAgICAgIEpQ\nUUxOb2RlIGVzY2FwZU5vZGUgPSByaWdodChub2RlKS4KICAgICAgICAgICAg\nICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVEVTQ0FQRUNIQVJBQ1RFUiwgdHJ1\nZSk7CiAgICAgICAgICAgICAgICBpZiAoZXNjYXBlTm9kZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIGVzY2FwZSA9IHRyaW1RdW90ZXMob25seUNo\naWxkKGVzY2FwZU5vZGUpLnRleHQpOwoKICAgICAgICAgICAgICAgIGlmIChu\nb3QpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90TWF0\nY2hlcyh2YWwxLCB2YWwyLCAiXyIsICIlIiwgZXNjYXBlKTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5tYXRjaGVzKHZhbDEsIHZhbDIsICJfIiwgIiUiLCBlc2NhcGUpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRJU0VNUFRZOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGV2YWxOb3Qobm90LAogICAgICAgICAgICAgICAgICAgIGZhY3Rvcnku\naXNFbXB0eShnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKSk7CgogICAgICAg\nICAgICBjYXNlIEpKVFNJWkU6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5zaXplKGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRJTkRFWDoKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LmluZGV4KGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRVUFBFUjoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5HKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5LnRvVXBwZXJDYXNlKHZhbDEpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRMT1dFUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LnRvTG93ZXJDYXNlKGdldFN0cmluZ1ZhbHVlKG9ubHlDaGls\nZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRMRU5HVEg6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdHJpbmdMZW5ndGgoZ2V0U3Ry\naW5nVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVEFCUzoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFicyhn\nZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUU1FSVDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLnNxcnQoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVE1PRDoKICAgICAgICAgICAgICAgIHZhbDEgPSBn\nZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBn\nZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBs\naWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm1vZCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUVFJJTTogLy8gVFJJTShbW3doZXJlXSBbY2hhcl0g\nRlJPTV0gZmllbGQpCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nbGFzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgQm9v\nbGVhbiB0cmltV2hlcmUgPSBudWxsOwoKICAgICAgICAgICAgICAgIEpQUUxO\nb2RlIGZpcnN0VHJpbUNoaWxkID0gZmlyc3RDaGlsZChub2RlKTsKCiAgICAg\nICAgICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPiAxKSB7CiAg\nICAgICAgICAgICAgICAgICAgdHJpbVdoZXJlID0KICAgICAgICAgICAgICAg\nICAgICAgICAgZmlyc3RUcmltQ2hpbGQuaWQgPT0gSkpUVFJJTUxFQURJTkcg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VHJpbUNoaWxkLmlk\nID09IEpKVFRSSU1UUkFJTElORyA/IEJvb2xlYW4uRkFMU0UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICA6IG51bGw7CiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgVmFsdWUgdHJpbUNoYXI7CgogICAgICAg\nICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIDMgY2hpbGRyZW4sIHRoZW4gd2Ug\na25vdyB0aGUgdHJpbQogICAgICAgICAgICAgICAgLy8gY2hhciBpcyB0aGUg\nc2Vjb25kIG5vZGUKICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxk\nQ291bnQoKSA9PSAzKQogICAgICAgICAgICAgICAgICAgIHRyaW1DaGFyID0g\nZ2V0VmFsdWUoc2Vjb25kQ2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZXJlIGFyZSB0d28gY2hpbGRyZW4sIHRoZW4gd2UgbmVl\nZCB0byBjaGVjayB0byBzZWUKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0\naGUgZmlyc3QgY2hpbGQgaXMgYSBsZWFkaW5nL3RyYWlsaW5nL2JvdGggbm9k\nZSwKICAgICAgICAgICAgICAgICAgICAvLyBvciB0aGUgdHJpbSBjaGFyYWN0\nZXIgbm9kZQogICAgICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5nZXRDaGls\nZENvdW50KCkgPT0gMgogICAgICAgICAgICAgICAgICAgICYmIGZpcnN0VHJp\nbUNoaWxkLmlkICE9IEpKVFRSSU1MRUFESU5HCiAgICAgICAgICAgICAgICAg\nICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJTVRSQUlMSU5HCiAg\nICAgICAgICAgICAgICAgICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpU\nVFJJTUJPVEgpCiAgICAgICAgICAgICAgICAgICAgdHJpbUNoYXIgPSBnZXRW\nYWx1ZShmaXJzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgICAgICAv\nLyBvdGh3ZXJ3aXNlLCB3ZSBkZWZhdWx0IHRvIHRyaW1taW5nIHRoZSBzcGFj\nZSBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICB0cmltQ2hhciA9IGZhY3RvcnkubmV3TGl0ZXJhbCgiICIsIExp\ndGVyYWwuVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LnRyaW0odmFsMSwgdHJpbUNoYXIsIHRyaW1XaGVyZSk7CgogICAg\nICAgICAgICBjYXNlIEpKVENPTkNBVDoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIFRZUEVfU1RSSU5HKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LmNvbmNhdCh2YWwxLCB2YWwyKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUU1VCU1RSSU5HOgogICAgICAgICAgICAg\nICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09IDMpIHsKICAgICAgICAg\nICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMCwgMykp\nOwogICAgICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShjaGlsZChu\nb2RlLCAxLCAzKSk7CiAgICAgICAgICAgICAgICAgICAgdmFsMyA9IGdldFZh\nbHVlKGNoaWxkKG5vZGUsIDIsIDMpKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggPT0gMikgewogICAgICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAwLCAyKSk7\nCiAgICAgICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKGNoaWxkKG5v\nZGUsIDEsIDIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CiAgICAgICAg\nICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMiwgSW50ZWdlci5UWVBFKTsK\nICAgICAgICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0aCA9PSAz\nKQogICAgICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwzLCBJ\nbnRlZ2VyLlRZUEUpOwoKICAgICAgICAgICAgICAgIHJldHVybiBjb252ZXJ0\nU3Vic3RyaW5nQXJndW1lbnRzKGZhY3RvcnksIHZhbDEsIHZhbDIsIHZhbDMp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRMT0NBVEU6CiAgICAgICAgICAgICAg\nICAvLyBhcyB3aXRoIFNVQlNUUklORyAoYWJvdmUpLCB0aGUgc2VtYW50aWNz\nIGZvciBMT0NBVEUgZGlmZmVyCiAgICAgICAgICAgICAgICAvLyBmcm9tIEV4\ncHJlc3Npb25GYWN0b3J5LmluZGV4T2YgaW4gdGhhdCBMT0NBVEUgdXNlcyBh\nCiAgICAgICAgICAgICAgICAvLyAwLWJhc2VkIGluZGV4LCBhbmQgaW5kZXhP\nZiB1c2VzIGEgMS1iYXNlZCBpbmRleAogICAgICAgICAgICAgICAgVmFsdWUg\nbG9jYXRlUGF0aCA9IGdldFZhbHVlKGZpcnN0Q2hpbGQobm9kZSkpOwogICAg\nICAgICAgICAgICAgVmFsdWUgbG9jYXRlU2VhcmNoID0gZ2V0VmFsdWUoc2Vj\nb25kQ2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAgVmFsdWUgbG9jYXRl\nRnJvbUluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChub2RlLmdl\ndENoaWxkQ291bnQoKSA+IDIpIC8vIG9wdGlvbmFsIHN0YXJ0IGluZGV4IGFy\nZwogICAgICAgICAgICAgICAgICAgIGxvY2F0ZUZyb21JbmRleCA9IGdldFZh\nbHVlKHRoaXJkQ2hpbGQobm9kZSkpOwoKICAgICAgICAgICAgICAgIHNldElt\ncGxpY2l0VHlwZShsb2NhdGVQYXRoLCBUWVBFX1NUUklORyk7CiAgICAgICAg\nICAgICAgICBzZXRJbXBsaWNpdFR5cGUobG9jYXRlU2VhcmNoLCBUWVBFX1NU\nUklORyk7CgogICAgICAgICAgICAgICAgaWYgKGxvY2F0ZUZyb21JbmRleCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZShs\nb2NhdGVGcm9tSW5kZXgsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5hZGQoZmFjdG9yeS5pbmRleE9mKGxvY2F0ZVNl\nYXJjaCwKICAgICAgICAgICAgICAgICAgICBsb2NhdGVGcm9tSW5kZXggPT0g\nbnVsbCA/IGxvY2F0ZVBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgOiBm\nYWN0b3J5Lm5ld0FyZ3VtZW50TGlzdChsb2NhdGVQYXRoLAogICAgICAgICAg\nICAgICAgICAgICAgICBmYWN0b3J5LnN1YnRyYWN0KGxvY2F0ZUZyb21JbmRl\neCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3RvcnkubmV3TGl0\nZXJhbChOdW1iZXJzLnZhbHVlT2YoMSksCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgTGl0ZXJhbC5UWVBFX05VTUJFUikpKSksCiAgICAgICAg\nICAgICAgICAgICAgZmFjdG9yeS5uZXdMaXRlcmFsKE51bWJlcnMudmFsdWVP\nZigxKSwKICAgICAgICAgICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBFX05V\nTUJFUikpOwoKICAgICAgICAgICAgY2FzZSBKSlRBR0dSRUdBVEU6CiAgICAg\nICAgICAgICAgICAvLyBzaW1wbHkgcGFzcy10aHJvdWdoIHdoaWxlIGFzc2Vy\ndGluZyBhIHNpbmdsZSBjaGlsZAogICAgICAgICAgICAgICAgcmV0dXJuIGV2\nYWwob25seUNoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09V\nTlQ6CiAgICAgICAgICAgICAgICBKUFFMTm9kZSBjID0gbGFzdENoaWxkKG5v\nZGUpOwogICAgICAgICAgICAgICAgaWYgKGMuaWQgPT0gSkpUSURFTlRJRklF\nUikKICAgICAgICAgICAgICAgICAgICAvLyBjb3VudChlKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LmNvdW50KGdldFBhdGgobm9kZSwg\nZmFsc2UsIHRydWUpKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLmNvdW50KGdldFZhbHVlKGMpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTUFY\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubWF4KGdldE51bWJl\nclZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRNSU46CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5taW4oZ2V0\nTnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVFNVTToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1\nbShnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpUQVZFUkFHRToKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LmF2ZyhnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpURElTVElOQ1RQQVRIOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkuZGlzdGluY3QoZ2V0VmFsdWUob25seUNo\naWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEVYSVNUUzoKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmlzTm90RW1wdHkoKFZhbHVl\nKSBldmFsKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRBTlk6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hbnkoKFZh\nbHVlKSBldmFsKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2Fz\nZSBKSlRBTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hbGwo\nKFZhbHVlKSBldmFsKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAg\nY2FzZSBKSlRTVUJTRUxFQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nU3VicXVlcnkobm9kZSk7CgogICAgICAgICAgICBjYXNlIEpKVE1FTUJFUk9G\nOgogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSks\nIFZBUl9QQVRIKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShy\naWdodChub2RlKSwgVkFSX1BBVEgpOwogICAgICAgICAgICAgICAgY2hlY2tF\nbWJlZGRhYmxlKHZhbDIpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRD\nb250YWluc1R5cGVzKHZhbDIsIHZhbDEsIENPTlRBSU5TX1RZUEVfRUxFTUVO\nVCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsIGZhY3Rv\ncnkuY29udGFpbnModmFsMiwgdmFsMSkpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRDVVJSRU5UREFURToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLmdldEN1cnJlbnREYXRlKERhdGUuY2xhc3MpOwoKICAgICAgICAgICAgY2Fz\nZSBKSlRDVVJSRU5UVElNRToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0\nb3J5LmdldEN1cnJlbnRUaW1lKFRpbWUuY2xhc3MpOwoKICAgICAgICAgICAg\nY2FzZSBKSlRDVVJSRU5UVElNRVNUQU1QOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhY3RvcnkuZ2V0Q3VycmVudFRpbWVzdGFtcChUaW1lc3RhbXAuY2xh\nc3MpOwoKICAgICAgICAgICAgY2FzZSBKSlRTRUxFQ1RFWFRFTlNJT046CiAg\nICAgICAgICAgICAgICBhc3NlcnRRdWVyeUV4dGVuc2lvbnMoIlNFTEVDVCIp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwob25seUNoaWxkKG5vZGUp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUR1JPVVBCWUVYVEVOU0lPTjoKICAg\nICAgICAgICAgICAgIGFzc2VydFF1ZXJ5RXh0ZW5zaW9ucygiR1JPVVAgQlki\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBldmFsKG9ubHlDaGlsZChub2Rl\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVE9SREVSQllFWFRFTlNJT046CiAg\nICAgICAgICAgICAgICBhc3NlcnRRdWVyeUV4dGVuc2lvbnMoIk9SREVSIEJZ\nIik7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9k\nZSkpOwoKICAgICAgICAgICAgY2FzZSBKSlREQVRFTElURVJBTDoKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwobm9kZS50ZXh0\nLCBMaXRlcmFsLlRZUEVfREFURSk7CgogICAgICAgICAgICBjYXNlIEpKVFRJ\nTUVMSVRFUkFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3\nTGl0ZXJhbChub2RlLnRleHQsIExpdGVyYWwuVFlQRV9USU1FKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUVElNRVNUQU1QTElURVJBTDogICAgCiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFsKG5vZGUudGV4dCwg\nTGl0ZXJhbC5UWVBFX1RJTUVTVEFNUCk7CgogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfRkFU\nQUwsICJiYWQtdHJlZSIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVj\ndFtdeyBub2RlIH0sIG51bGwpOwogICAgICAgIH0KICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBDb252ZXJ0cyBKUFFMIHN1YnN0cmluZygpIGZ1bmN0aW9u\nIHRvIE9wZW5KUEEgRXhwcmVzc2lvbkZhY3RvcnkgCiAgICAgKiBzdWJzdHJp\nbmcoKSBhcmd1bWVudHMuCiAgICAgKiAKICAgICAqIFRoZSBzZW1hbnRpY3Mg\nb2YgdGhlIEpQUUwgc3Vic3RyaW5nKCkgZnVuY3Rpb24gYXJlIHRoYXQgYXJn\nMiBpcyB0aGUgCiAgICAgKiAxLWJhc2VkIHN0YXJ0IGluZGV4LCBhbmQgYXJn\nMyBpcyB0aGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcgdG8gYmUgcmV0dXJuLgog\nICAgICogVGhpcyBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgc2VtYW50aWNzIG9m\nIHRoZSBFeHByZXNzaW9uRmFjdG9yeSdzIAogICAgICogc3Vic3RyaW5nKCks\nIHdoaWNoIG1hdGNoZXMgdGhlIEphdmEgbGFuZ3VhZ2UgKDAtYmFzZWQgc3Rh\ncnQgaW5kZXgsCiAgICAgKiBhcmcyIGlzIHRoZSBlbmQgaW5kZXgpOiB3ZSBw\nZXJmb3JtIHRoZSB0cmFuc2xhdGlvbiBieSBhZGRpbmcgb25lIHRvIHRoZSAK\nICAgICAqIGZpcnN0IGFyZ3VtZW50LCBhbmQgdGhlbiBhZGRpbmcgdGhlIGZp\ncnN0IGFyZ3VtZW50IHRvIHRoZSBzZWNvbmQgIAogICAgICogYXJndW1lbnQg\ndG8gZ2V0IHRoZSBlbmRJbmRleC4KICAgICAqIAogICAgICogQHBhcmFtIHZh\nbDEgdGhlIG9yaWdpbmFsIFN0cmluZwogICAgICogQHBhcmFtIHZhbDIgdGhl\nIDEtYmFzZWQgc3RhcnQgaW5kZXggYXMgcGVyIEpQUUwgc3Vic3RyaW5nKCkg\nc2VtYW50aWNzCiAgICAgKiBAcGFyYW0gdmFsMyB0aGUgbGVuZ3RoIG9mIHRo\nZSByZXR1cm5lZCBzdHJpbmcgYXMgcGVyIEpQUUwgc2VtYW50aWNzCiAgICAg\nKiAKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBWYWx1ZSBjb252ZXJ0U3Vi\nc3RyaW5nQXJndW1lbnRzKEV4cHJlc3Npb25GYWN0b3J5IGZhY3RvcnksIAog\nICAgCQlWYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyLCBWYWx1ZSB2YWwzKSB7CiAg\nICAgICAgVmFsdWUgc3RhcnQgPSBudWxsOwogICAgICAgIFZhbHVlIGVuZCA9\nIG51bGw7CiAgICAgICAgaWYgKHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsICYm\nIAogICAgICAgICAgICAodmFsMyA9PSBudWxsIHx8IHZhbDMgaW5zdGFuY2Vv\nZiBMaXRlcmFsKSkgewogICAgICAgICAgICAvLyBvcHRpbWl6ZSBTUUwgZm9y\nIHRoZSBjb21tb24gY2FzZSBvZiB0d28gbGl0ZXJhbHMKICAgICAgICAgICAg\nbG9uZyBqcHFsU3RhcnQgPSAoKE51bWJlcikgKChMaXRlcmFsKSB2YWwyKS5n\nZXRWYWx1ZSgpKQogICAgICAgICAgICAgICAgLmxvbmdWYWx1ZSgpOwogICAg\nICAgICAgICBzdGFydCA9IGZhY3RvcnkubmV3TGl0ZXJhbChuZXcgTG9uZyhq\ncHFsU3RhcnQgLSAxKSwKICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9O\nVU1CRVIpOwogICAgICAgICAgICBpZiAodmFsMyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIAlsb25nIGxlbmd0aCA9ICgoTnVtYmVyKSAoKExpdGVyYWwpIHZh\nbDMpLmdldFZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAgLmxvbmdWYWx1\nZSgpOwogICAgICAgICAgICBsb25nIGVuZEluZGV4ID0gbGVuZ3RoICsgKGpw\ncWxTdGFydCAtIDEpOwogICAgICAgICAgICBlbmQgPSBmYWN0b3J5Lm5ld0xp\ndGVyYWwobmV3IExvbmcoZW5kSW5kZXgpLAogICAgICAgICAgICAgICAgTGl0\nZXJhbC5UWVBFX05VTUJFUik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBzdGFydCA9IGZhY3Rvcnkuc3VidHJhY3QodmFs\nMiwgZmFjdG9yeS5uZXdMaXRlcmFsCiAgICAgICAgICAgICAgICAoTnVtYmVy\ncy52YWx1ZU9mKDEpLCBMaXRlcmFsLlRZUEVfTlVNQkVSKSk7CiAgICAgICAg\nICAgIGlmICh2YWwzICE9IG51bGwpCiAgICAgICAgICAgIGVuZCA9IGZhY3Rv\ncnkuYWRkKHZhbDMsCiAgICAgICAgICAgICAgICAoZmFjdG9yeS5zdWJ0cmFj\ndCh2YWwyLCBmYWN0b3J5Lm5ld0xpdGVyYWwKICAgICAgICAgICAgICAgICAg\nICAoTnVtYmVycy52YWx1ZU9mKDEpLCBMaXRlcmFsLlRZUEVfTlVNQkVSKSkp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbDMgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGZhY3Rvcnkuc3Vic3RyaW5nKHZhbDEsIGZhY3Rvcnku\nbmV3QXJndW1lbnRMaXN0KHN0YXJ0LCBlbmQpKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1YnN0cmluZyh2YWwxLCBzdGFy\ndCk7CiAgICAJCiAgICB9CiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0UXVlcnlF\neHRlbnNpb25zKFN0cmluZyBjbGF1c2UpIHsKICAgICAgICBPcGVuSlBBQ29u\nZmlndXJhdGlvbiBjb25mID0gcmVzb2x2ZXIuZ2V0Q29uZmlndXJhdGlvbigp\nOwogICAgICAgIHN3aXRjaChjb25mLmdldENvbXBhdGliaWxpdHlJbnN0YW5j\nZSgpLmdldEpQUUwoKSkgewogICAgICAgICAgICBjYXNlIENvbXBhdGliaWxp\ndHkuSlBRTF9XQVJOOgogICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgd2Un\ndmUgYWxyZWFkeSB3YXJuZWQgZm9yIHRoaXMgcXVlcnktZmFjdG9yeSBjb21i\nbwogICAgICAgICAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHJlc29sdmVy\nLmdldFF1ZXJ5Q29udGV4dCgpLmdldFN0b3JlQ29udGV4dCgpOwogICAgICAg\nICAgICAgICAgU3RyaW5nIHF1ZXJ5ID0gY3VycmVudFF1ZXJ5KCk7CiAgICAg\nICAgICAgICAgICBpZiAoY3R4LmdldEJyb2tlcigpICE9IG51bGwgJiYgcXVl\ncnkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBrZXkg\nPSBnZXRDbGFzcygpLmdldE5hbWUoKSArICI6IiArIHF1ZXJ5OwogICAgICAg\nICAgICAgICAgICAgIEJyb2tlckZhY3RvcnkgZmFjdG9yeSA9IGN0eC5nZXRC\ncm9rZXIoKS5nZXRCcm9rZXJGYWN0b3J5KCk7CiAgICAgICAgICAgICAgICAg\nICAgT2JqZWN0IGhhc1dhcm5lZCA9IGZhY3RvcnkuZ2V0VXNlck9iamVjdChr\nZXkpOwogICAgICAgICAgICAgICAgICAgIGlmIChoYXNXYXJuZWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmYWN0b3J5\nLnB1dFVzZXJPYmplY3Qoa2V5LCBCb29sZWFuLlRSVUUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9n\nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19RVUVSWSk7CiAgICAgICAgICAg\nICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBsb2cud2FybihfbG9jLmdldCgicXVlcnktZXh0ZW5zaW9ucy13YXJu\naW5nIiwgY2xhdXNlLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50\nUXVlcnkoKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgQ29tcGF0aWJpbGl0eS5KUFFMX1NUUklDVDoKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBQYXJzZUV4Y2VwdGlvbihfbG9jLmdldCgicXVlcnkt\nZXh0ZW5zaW9ucy1lcnJvciIsCiAgICAgICAgICAgICAgICAgICAgY2xhdXNl\nLCBjdXJyZW50UXVlcnkoKSkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAg\nY2FzZSBDb21wYXRpYmlsaXR5LkpQUUxfRVhURU5ERUQ6CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAgICAgIkNvbXBhdGliaWxpdHkuZ2V0SlBRTCgpID09ICIKICAg\nICAgICAgICAgICAgICAgICAgICAgKyBjb25mLmdldENvbXBhdGliaWxpdHlJ\nbnN0YW5jZSgpLmdldEpQUUwoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldEltcGxpY2l0VHlwZXMoVmFsdWUgdmFsMSwgVmFsdWUg\ndmFsMiwgCiAgICAgICAgQ2xhc3M8Pz4gZXhwZWN0ZWQpIHsKICAgICAgICBT\ndHJpbmcgY3VyclF1ZXJ5ID0gY3VycmVudFF1ZXJ5KCk7CiAgICAgICAgc2V0\nSW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBleHBlY3RlZCwgcmVzb2x2ZXIs\nIHBhcmFtZXRlclR5cGVzLCAKICAgICAgICAgICAgY3VyclF1ZXJ5KTsKICAg\nIH0KICAgIAogICAgCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgc2V0SW1wbGlj\naXRUeXBlcyhWYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyLCAKICAgICAgICBDbGFz\nczw/PiBleHBlY3RlZCwgUmVzb2x2ZXIgcmVzb2x2ZXIsIE9yZGVyZWRNYXA8\nT2JqZWN0LENsYXNzPD8+PiBwYXJhbWV0ZXJUeXBlcywKICAgICAgICBTdHJp\nbmcgY3VycmVudFF1ZXJ5KSB7CiAgICAgICAgQWJzdHJhY3RFeHByZXNzaW9u\nQnVpbGRlci5zZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIGV4cGVjdGVk\nLCAKICAgICAgICAgICAgcmVzb2x2ZXIpOwoKICAgICAgICAvLyBhcyB3ZWxs\nIGFzIHNldHRpbmcgdGhlIHR5cGVzIGZvciBjb252ZXJzaW9ucywgd2UgYWxz\nbyBuZWVkIHRvCiAgICAgICAgLy8gZW5zdXJlIHRoYXQgYW55IHBhcmFtZXRl\ncnMgYXJlIGRlY2xhcmVkIHdpdGggdGhlIGNvcnJlY3QgdHlwZSwKICAgICAg\nICAvLyBzaW5jZSB0aGUgSlBBIHNwZWMgZXhwZWN0cyB0aGF0IHRoZXNlIHdp\nbGwgYmUgdmFsaWRhdGVkCiAgICAgICAgUGFyYW1ldGVyIHBhcmFtID0gdmFs\nMSBpbnN0YW5jZW9mIFBhcmFtZXRlciA/IChQYXJhbWV0ZXIpIHZhbDEKICAg\nICAgICAgICAgOiB2YWwyIGluc3RhbmNlb2YgUGFyYW1ldGVyID8gKFBhcmFt\nZXRlcikgdmFsMiA6IG51bGw7CiAgICAgICAgUGF0aCBwYXRoID0gdmFsMSBp\nbnN0YW5jZW9mIFBhdGggPyAoUGF0aCkgdmFsMQogICAgICAgICAgICA6IHZh\nbDIgaW5zdGFuY2VvZiBQYXRoID8gKFBhdGgpIHZhbDIgOiBudWxsOwoKICAg\nICAgICAvLyB3ZSBvbmx5IGNoZWNrIGZvciBwYXJhbWV0ZXItdG8tcGF0aCBj\nb21wYXJpc29ucwogICAgICAgIGlmIChwYXJhbSA9PSBudWxsIHx8IHBhdGgg\nPT0gbnVsbCB8fCBwYXJhbWV0ZXJUeXBlcyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5s\nYXN0KCk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGlmIChleHBlY3RlZCA9PSBudWxsKQogICAgICAg\nICAgICBjaGVja0VtYmVkZGFibGUocGF0aCwgY3VycmVudFF1ZXJ5KTsKCiAg\nICAgICAgQ2xhc3M8Pz4gdHlwZSA9IHBhdGguZ2V0VHlwZSgpOwogICAgICAg\nIGlmICh0eXBlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgT2JqZWN0IHBhcmFtS2V5ID0gcGFyYW0uZ2V0UGFyYW1ldGVyS2V5KCk7\nCiAgICAgICAgaWYgKHBhcmFtS2V5ID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgYWxyZWFkeSBk\nZWNsYXJlZCB0aGUgcGFyYW1ldGVyCiAgICAgICAgaWYgKHBhcmFtZXRlclR5\ncGVzLmNvbnRhaW5zS2V5KHBhcmFtS2V5KSkKICAgICAgICAgICAgcGFyYW1l\ndGVyVHlwZXMucHV0KHBhcmFtS2V5LCB0eXBlKTsKICAgIH0KCiAgICBwcml2\nYXRlIFZhbHVlIGdldFN0cmluZ1ZhbHVlKEpQUUxOb2RlIG5vZGUpIHsKICAg\nICAgICByZXR1cm4gZ2V0VHlwZVZhbHVlKG5vZGUsIFRZUEVfU1RSSU5HKTsK\nICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldE51bWJlclZhbHVlKEpQUUxO\nb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gZ2V0VHlwZVZhbHVlKG5vZGUs\nIFRZUEVfTlVNQkVSKTsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFR5\ncGVWYWx1ZShKUFFMTm9kZSBub2RlLCBDbGFzczw/PiBpbXBsaWNpdFR5cGUp\nIHsKICAgICAgICBWYWx1ZSB2YWwgPSBnZXRWYWx1ZShub2RlKTsKICAgICAg\nICBzZXRJbXBsaWNpdFR5cGUodmFsLCBpbXBsaWNpdFR5cGUpOwogICAgICAg\nIHJldHVybiB2YWw7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRTdWJx\ndWVyeShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgZmluYWwgYm9vbGVhbiBz\ndWJjbGFzc2VzID0gdHJ1ZTsKCiAgICAgICAgLy8gcGFyc2UgdGhlIHN1YnF1\nZXJ5CiAgICAgICAgUGFyc2VkSlBRTCBwYXJzZWQgPSBuZXcgUGFyc2VkSlBR\nTChub2RlLnBhcnNlci5qcHFsLCBub2RlKTsKICAgICAgICBDb250ZXh0IHN1\nYkNvbnRleHQgPSBuZXcgQ29udGV4dChwYXJzZWQsIG51bGwsIGN0eCgpKTsK\nICAgICAgICBjb250ZXh0cy5wdXNoKHN1YkNvbnRleHQpOwoKICAgICAgICBD\nbGFzc01ldGFEYXRhIGNhbmRpZGF0ZSA9IGdldENhbmRpZGF0ZU1ldGFEYXRh\nKG5vZGUpOwogICAgICAgIFN1YnF1ZXJ5IHN1YnEgPSBzdWJDb250ZXh0Lmdl\ndFN1YnF1ZXJ5KCk7CiAgICAgICAgaWYgKHN1YnEgPT0gbnVsbCkgewogICAg\nICAgICAgICBzdWJxID0gZmFjdG9yeS5uZXdTdWJxdWVyeShjYW5kaWRhdGUs\nIHN1YmNsYXNzZXMsIG5leHRBbGlhcygpKTsKICAgICAgICAgICAgc3ViQ29u\ndGV4dC5zZXRTdWJxdWVyeShzdWJxKTsKICAgICAgICB9CiAgICAgICAgc3Vi\ncS5zZXRNZXRhRGF0YShjYW5kaWRhdGUpOwogICAgICAgIAogICAgICAgIC8v\nIGV2YWx1YXRlIGZyb20gY2xhdXNlIGZvciByZXNvbHZpbmcgdmFyaWFibGVz\nIGRlZmluZWQgaW4gc3VicXVlcnkKICAgICAgICBKUFFMTm9kZSBmcm9tID0g\nbm9kZS5nZXRDaGlsZCgxKTsKICAgICAgICBzdWJDb250ZXh0LmZyb20gPSBl\ndmFsRnJvbUNsYXVzZShmcm9tLCB0cnVlKTsKCiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBzdWJleHAgPSBnZXRRdWVyeUV4\ncHJlc3Npb25zKCk7CiAgICAgICAgICAgIHN1YnEuc2V0UXVlcnlFeHByZXNz\naW9ucyhzdWJleHApOwogICAgICAgICAgICBpZiAoc3ViZXhwLnByb2plY3Rp\nb25zLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBjaGVja0VtYmVkZGFi\nbGUoc3ViZXhwLnByb2plY3Rpb25zWzBdKTsKICAgICAgICAgICAgcmV0dXJu\nIHN1YnE7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgLy8gcmVt\nb3ZlIHRoZSBzdWJxdWVyeSBwYXJzZSBjb250ZXh0CiAgICAgICAgICAgIGNv\nbnRleHRzLnBvcCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZXMgYW5kIHJlY29yZHMgdGhlIG5hbWVzIGFuZCBvcmRlciBvZiBw\nYXJhbWV0ZXJzLiBUaGUgcGFyYW1ldGVycyBhcmUKICAgICAqIGlkZW50aWZp\nZWQgYnkgYSBrZXkgd2l0aCBpdHMgdHlwZSBwcmVzZXJ2ZWQuIFRoZSBzZWNv\nbmQgYXJndW1lbnQKICAgICAqIGRldGVybWluZXMgd2hldGhlciB0aGUgZmly\nc3QgYXJndW1lbnQgaXMgdXNlZCBhcy1pcyBvciBjb252ZXJ0ZWQgdG8KICAg\nICAqIGFuIEludGVnZXIgYXMgcGFyYW1ldGVyIGtleS4gCiAgICAgKiAKICAg\nICAqIEBwYXJhbSB0aGUgdGV4dCBhcyBpdCBhcHBlYXJzIGluIHRoZSBwYXJz\nZWQgbm9kZQogICAgICogQHBhcmFtIHBvc2l0aW9uYWwgaWYgdHJ1ZSB0aGUg\nZmlyc3QgYXJndW1lbnQgaXMgY29udmVydGVkIHRvIGFuIGludGVnZXIKICAg\nICAqIEBwYXJhbSBpc0NvbGxlY3Rpb25WYWx1ZWQgdHJ1ZSBmb3IgY29sbGVj\ndGlvbi12YWx1ZWQgcGFyYW1ldGVycwogICAgICovCiAgICBwcml2YXRlIFBh\ncmFtZXRlciBnZXRQYXJhbWV0ZXIoU3RyaW5nIGlkLCBib29sZWFuIHBvc2l0\naW9uYWwsIAogICAgICAgIGJvb2xlYW4gaXNDb2xsZWN0aW9uVmFsdWVkKSB7\nCiAgICAgICAgaWYgKHBhcmFtZXRlclR5cGVzID09IG51bGwpCiAgICAgICAg\nICAgIHBhcmFtZXRlclR5cGVzID0gbmV3IE9yZGVyZWRNYXA8T2JqZWN0LCBD\nbGFzczw/Pj4oKTsKICAgICAgICBPYmplY3QgcGFyYW1LZXkgPSBwb3NpdGlv\nbmFsID8gSW50ZWdlci5wYXJzZUludChpZCkgOiBpZDsKICAgICAgICBpZiAo\nIXBhcmFtZXRlclR5cGVzLmNvbnRhaW5zS2V5KHBhcmFtS2V5KSkKICAgICAg\nICAgICAgcGFyYW1ldGVyVHlwZXMucHV0KHBhcmFtS2V5LCBUWVBFX09CSkVD\nVCk7CgogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG51bGw7CiAgICAg\nICAgaW50IGluZGV4OwogICAgICAgIGlmIChwb3NpdGlvbmFsKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBpbmRleGVzIGluIEpQ\nUUwgYXJlIDEtYmFzZWQsIGFzIG9wcG9zZWQgdG8gMC1iYXNlZCBpbgogICAg\nICAgICAgICAgICAgLy8gdGhlIGNvcmUgRXhwcmVzc2lvbkZhY3RvcnkKICAg\nICAgICAgICAgICAgIGluZGV4ID0gSW50ZWdlci5wYXJzZUludChpZCkgLSAx\nOwogICAgICAgICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhf\nVVNFUiwgImJhZC1wb3NpdGlvbmFsLXBhcmFtZXRlciIsCiAgICAgICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyBpZCB9LCBlKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgICAg\nIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJiYWQtcG9zaXRpb25h\nbC1wYXJhbWV0ZXIiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgaWQgfSwgbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\naW5kZXggPSBwYXJhbWV0ZXJUeXBlcy5pbmRleE9mKGlkKTsKICAgICAgICB9\nCiAgICAgICAgUGFyYW1ldGVyIHBhcmFtID0gaXNDb2xsZWN0aW9uVmFsdWVk\nIAogICAgICAgICAgICA/IGZhY3RvcnkubmV3Q29sbGVjdGlvblZhbHVlZFBh\ncmFtZXRlcihwYXJhbUtleSwgVFlQRV9PQkpFQ1QpIAogICAgICAgICAgICA6\nIGZhY3RvcnkubmV3UGFyYW1ldGVyKHBhcmFtS2V5LCBUWVBFX09CSkVDVCk7\nCiAgICAgICAgcGFyYW0uc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgcGFy\nYW0uc2V0SW5kZXgoaW5kZXgpOwogICAgICAgIAogICAgICAgIHJldHVybiBw\nYXJhbTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrcyB0byBzZWUgaWYg\nd2Ugc2hvdWxkIGV2YWx1YXRlIGZvciBhIE5PVCBleHByZXNzaW9uLgogICAg\nICovCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbE5vdChib29sZWFuIG5v\ndCwgRXhwcmVzc2lvbiBleHApIHsKICAgICAgICByZXR1cm4gbm90ID8gZmFj\ndG9yeS5ub3QoZXhwKSA6IGV4cDsKICAgIH0KCiAgICAvKioKICAgICAqIFRy\naW0gb2ZmIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNpbmdsZS1xdW90ZXMsIGFu\nZCB0aGVuCiAgICAgKiByZXBsYWNlIGFueSBpbnRlcm5hbCAnJyBpbnN0YW5j\nZXMgd2l0aCAnIChzaW5jZSByZXBlYXRpbmcgdGhlCiAgICAgKiBxdW90ZSBp\ncyB0aGUgSlBRTCBtZWNoYW5pc20gb2YgZXNjYXBpbmcgYSBzaW5nbGUgcXVv\ndGUpLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyB0cmltUXVvdGVzKFN0\ncmluZyBzdHIpIHsKICAgICAgICBpZiAoc3RyID09IG51bGwgfHwgc3RyLmxl\nbmd0aCgpIDw9IDEpCiAgICAgICAgICAgIHJldHVybiBzdHI7CgogICAgICAg\nIGlmIChzdHIuc3RhcnRzV2l0aCgiJyIpICYmIHN0ci5lbmRzV2l0aCgiJyIp\nKQogICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDEsIHN0ci5sZW5n\ndGgoKSAtIDEpOwoKICAgICAgICBpbnQgaW5kZXggPSAtMTsKCiAgICAgICAg\nd2hpbGUgKChpbmRleCA9IHN0ci5pbmRleE9mKCInJyIsIGluZGV4ICsgMSkp\nICE9IC0xKQogICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDAsIGlu\nZGV4ICsgMSkgKyBzdHIuc3Vic3RyaW5nKGluZGV4ICsgMik7CgogICAgICAg\nIHJldHVybiBzdHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbiBJbnRlZ2Vy\nTGl0ZXJhbCBhbmQgRGVjaW1hbExpdGVyYWwgbm9kZSB3aWxsCiAgICAgKiBo\nYXZlIGEgY2hpbGQgbm9kZSBvZiBOZWdhdGl2ZSBpZiBpdCBpcyBuZWdhdGl2\nZToKICAgICAqIGlmIHNvLCB0aGlzIG1ldGhvZCByZXR1cm5zIC0xLCBlbHNl\nIGl0IHJldHVybnMgMS4KICAgICAqLwogICAgcHJpdmF0ZSBzaG9ydCBuZWdh\ndGl2ZShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuY2hpbGRy\nZW4gIT0gbnVsbCAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PSAxCiAgICAg\nICAgICAgICYmIGZpcnN0Q2hpbGQobm9kZSkuaWQgPT0gSkpUTkVHQVRJVkUp\nCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHJldHVybiAxOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0SWRl\nbnRpZmllcihKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgZmluYWwgU3RyaW5n\nIG5hbWUgPSBub2RlLnRleHQ7CiAgICAgICAgZmluYWwgVmFsdWUgdmFsID0g\nZ2V0VmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICBDbGFzc01ldGFE\nYXRhIGNtZCA9IGdldE1ldGFEYXRhRm9yQWxpYXMobmFtZSk7CgogICAgICAg\nIGlmIChjbWQgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBoYW5kbGUgdGhl\nIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMgdGhlIGFsaWFzCiAgICAg\nICAgICAgIC8vIGZvciB0aGUgY2FuZGlkYXRlICh3ZSBkb24ndCB1c2UgdmFy\naWFibGVzIGZvciB0aGlzKQogICAgICAgICAgICBWYWx1ZSB0aGl6ID0gbnVs\nbDsKICAgICAgICAgICAgaWYgKGN0eCgpLnN1YnF1ZXJ5ID09IG51bGwgfHwg\nCiAgICAgICAgICAgICAgICBjdHgoKS5nZXRTY2hlbWEobmFtZS50b0xvd2Vy\nQ2FzZSgpKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoY3R4KCku\nc3VicXVlcnkgIT0gbnVsbCAmJiBpbkFzc2lnblN1YnNlbGVjdFByb2plY3Rp\nb24pCiAgICAgICAgICAgICAgICAgICAgdGhpeiA9IGZhY3RvcnkubmV3UGF0\naChjdHgoKS5zdWJxdWVyeSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgdGhpeiA9IGZhY3RvcnkuZ2V0VGhpcygpOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpeiA9IGZhY3Rv\ncnkubmV3UGF0aChjdHgoKS5zdWJxdWVyeSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgKChQYXRoKXRoaXopLnNldFNjaGVtYUFsaWFzKG5hbWUpOwog\nICAgICAgICAgICB0aGl6LnNldE1ldGFEYXRhKGNtZCk7CiAgICAgICAgICAg\nIHJldHVybiB0aGl6OwogICAgICAgIH0gZWxzZSBpZiAodmFsIGluc3RhbmNl\nb2YgUGF0aCkgewogICAgICAgICAgICByZXR1cm4gKFBhdGgpIHZhbDsKICAg\nICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFZhbHVlKSB7CiAgICAg\nICAgICAgIGlmICh2YWwuaXNWYXJpYWJsZSgpKSB7CiAgICAgICAgICAgICAg\nICAvLyBjYW4gYmUgYW4gZW50aXR5IHR5cGUgbGl0ZXJhbAogICAgICAgICAg\nICAgICAgQ2xhc3M8Pz4gYyA9IHJlc29sdmVyLmNsYXNzRm9yTmFtZShuYW1l\nLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChjICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICBWYWx1ZSBsaXQgPSBmYWN0b3J5Lm5ld1R5cGVM\naXRlcmFsKGMsIExpdGVyYWwuVFlQRV9DTEFTUyk7CiAgICAgICAgICAgICAg\nICAgICAgQ2xhc3M8Pz4gY2FuZGlkYXRlID0gZ2V0Q2FuZGlkYXRlVHlwZSgp\nOwogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgY2FuID0gZ2V0\nQ2xhc3NNZXRhRGF0YShjYW5kaWRhdGUuZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgICAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IGdldENsYXNzTWV0YURhdGEobmFtZSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGlmIChjYW5kaWRhdGUuaXNB\nc3NpZ25hYmxlRnJvbShjKSkKICAgICAgICAgICAgICAgICAgICAgICAgbGl0\nLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgbGl0LnNldE1ldGFEYXRhKGNhbik7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpdDsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKFZhbHVl\nKSB2YWw7CiAgICAgICAgfQoKICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAidW5rbm93bi1pZGVudGlmaWVyIiwKICAgICAgICAgICAg\nbmV3IE9iamVjdFtdeyBuYW1lIH0sIG51bGwpOwogICAgfQoKICAgIHByaXZh\ndGUgUGF0aCB2YWxpZGF0ZU1hcFBhdGgoSlBRTE5vZGUgbm9kZSwgSlBRTE5v\nZGUgaWQpIHsKICAgICAgICBQYXRoIHBhdGggPSAoUGF0aCkgZ2V0VmFsdWUo\naWQpOwogICAgICAgIEZpZWxkTWV0YURhdGEgZmxkID0gcGF0aC5sYXN0KCk7\nCgogICAgICAgIGlmIChmbGQgPT0gbnVsbCAmJiBjdHgoKS5zdWJxdWVyeSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIFZhbHVlIHZhciA9IGdldFZhcmlhYmxl\nKGlkLnRleHQsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKHZhciAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBwYXRoID0gZmFjdG9yeS5uZXdQYXRoKHZh\ncik7CiAgICAgICAgICAgICAgICBmbGQgPSBwYXRoLmxhc3QoKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoZmxkICE9\nIG51bGwpIHsgICAgICAgICAgICAKICAgICAgICAgICAgLy8gdmFsaWRhdGUg\ndGhlIGZpZWxkIGlzIG9mIHR5cGUgamF2YS51dGlsLk1hcAogICAgICAgICAg\nICBpZiAoZmxkLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMu\nTUFQKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcgb3BlciA9ICJWQUxVRSI7\nCiAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PSBKSlRFTlRSWSkKICAg\nICAgICAgICAgICAgICAgICBvcGVyID0gIkVOVFJZIjsgICAgICAgIAogICAg\nICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5pZCA9PSBKSlRLRVkpCiAgICAg\nICAgICAgICAgICAgICAgb3BlciA9ICJLRVkiOwogICAgICAgICAgICAgICAg\ndGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1xdWFsaWZpZWQt\naWRlbnRpZmllciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\neyBpZC50ZXh0LCBvcGVyfSwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2Vw\ndGlvbihFWF9VU0VSLCAidW5rbm93bi10eXBlIiwKICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXXsgaWQudGV4dH0sIG51bGwpOwogICAgICAgICAgICAK\nICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVl\nIGdldEdlbmVyYWxJZGVudGlmaWVyKEpQUUxOb2RlIG5vZGUsIGJvb2xlYW4g\ndmVyaWZ5RW1iZWRkYWJsZSkgewogICAgICAgIEpQUUxOb2RlIGlkID0gb25s\neUNoaWxkKG5vZGUpOwogICAgICAgIFBhdGggcGF0aCA9IHZhbGlkYXRlTWFw\nUGF0aChub2RlLCBpZCk7CgogICAgICAgIGlmIChub2RlLmlkID09IEpKVEtF\nWSkKICAgICAgICAgICAgcGF0aCA9IChQYXRoKSBmYWN0b3J5LmdldEtleShw\nYXRoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZsZCA9IHBhdGgubGFzdCgp\nOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGZsZC5nZXRLZXkoKS5n\nZXRUeXBlTWV0YURhdGEoKTsKICAgICAgICBpZiAodmVyaWZ5RW1iZWRkYWJs\nZSAmJgogICAgICAgICAgICAobm9kZS5pZCA9PSBKSlRLRVkgJiYgbWV0YSAh\nPSBudWxsICYmIGZsZC5nZXRLZXkoKS5pc0VtYmVkZGVkKCkpIHx8CiAgICAg\nICAgICAgIChub2RlLmlkID09IEpKVFZBTFVFICYmIGZsZC5pc0VsZW1lbnRD\nb2xsZWN0aW9uKCkgJiYKICAgICAgICAgICAgICAgICBmbGQuZ2V0RWxlbWVu\ndCgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSAhPSBudWxsKSkgeyAKICAgICAg\nICAgICAgICAgICAvLyBjaGVjayBiYXNpYyB0eXBlCiAgICAgICAgICAgIGlm\nIChub2RlLnBhcmVudC5wYXJlbnQuaWQgPT0gSkpUR1JPVVBCWSkKICAgICAg\nICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJjYW50\nLWdyb3VwYnkta2V5LXZhbHVlLWVtYmVkZGFibGUiLAogICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZS5pZCA9PSBKSlRWQUxVRSA/ICJW\nQUxVRSIgOiAiS0VZIiwgaWQudGV4dCB9LCBudWxsKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhf\nVVNFUiwgImJhZC1nZW5lcmFsLWlkZW50aWZpZXIiLAogICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZS5pZCA9PSBKSlRWQUxVRSA/ICJW\nQUxVRSIgOiAiS0VZIiwgaWQudGV4dCB9LCBudWxsKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHBhdGg7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBn\nZXRRdWFsaWZpZWRJZGVudGlmaWVyKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICBKUFFMTm9kZSBpZCA9IG9ubHlDaGlsZChub2RlKTsgICAgICAgICAgICAg\nICAKICAgICAgICBQYXRoIHBhdGggPSB2YWxpZGF0ZU1hcFBhdGgobm9kZSwg\naWQpOwoKICAgICAgICBpZiAobm9kZS5pZCA9PSBKSlRWQUxVRSkKICAgICAg\nICAgICAgcmV0dXJuIHBhdGg7CgogICAgICAgIFZhbHVlIHZhbHVlID0gZ2V0\nVmFsdWUoaWQpOwogICAgICAgIGlmIChub2RlLmlkID09IEpKVEtFWSkKICAg\nICAgICAgICAgcmV0dXJuIGZhY3RvcnkubWFwS2V5KHBhdGgsIHZhbHVlKTsK\nICAgICAgICBlbHNlICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5Lm1hcEVudHJ5KHBhdGgsIHZhbHVlKTsKICAgIH0KCiAgICBwcml2\nYXRlIFBhdGggZ2V0UXVhbGlmaWVkUGF0aChKUFFMTm9kZSBub2RlKSB7CiAg\nICAgICAgcmV0dXJuIGdldFF1YWxpZmllZFBhdGgobm9kZSwgZmFsc2UsIHRy\ndWUpOwogICAgfQoKICAgIHByaXZhdGUgUGF0aCBnZXRRdWFsaWZpZWRQYXRo\nKEpQUUxOb2RlIG5vZGUsIGJvb2xlYW4gcGNPbmx5LCBib29sZWFuIGlubmVy\nKQogICAgewogICAgICAgIGludCBuQ2hpbGQgPSBub2RlLmdldENoaWxkQ291\nbnQoKTsKICAgICAgICBKUFFMTm9kZSBmaXJzdENoaWxkID0gZmlyc3RDaGls\nZChub2RlKTsKICAgICAgICBKUFFMTm9kZSBpZCA9IGZpcnN0Q2hpbGQuaWQg\nPT0gSkpUS0VZID8gb25seUNoaWxkKGZpcnN0Q2hpbGQpIDoKICAgICAgICAg\nICAgICAgZmlyc3RDaGlsZDsgICAgICAgICAgICAgICAKICAgICAgICBQYXRo\nIHBhdGggPSB2YWxpZGF0ZU1hcFBhdGgoZmlyc3RDaGlsZCwgaWQpOwoKICAg\nICAgICBpZiAoZmlyc3RDaGlsZC5pZCA9PSBKSlRJREVOVElGSUVSKQogICAg\nICAgICAgICByZXR1cm4gZ2V0UGF0aChub2RlKTsKCiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbGQgPSBwYXRoLmxhc3QoKTsKICAgICAgICBwYXRoID0gKFBh\ndGgpIGZhY3RvcnkuZ2V0S2V5KHBhdGgpOwogICAgICAgIENsYXNzTWV0YURh\ndGEgbWV0YSA9IGZsZC5nZXRLZXkoKS5nZXRUeXBlTWV0YURhdGEoKTsKCiAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1xdWFsaWZpZWQtcGF0aCIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGlkLnRleHQgfSwgbnVsbCk7\nCiAgICAgICAgCiAgICAgICAgcGF0aC5zZXRNZXRhRGF0YShtZXRhKTsKCiAg\nICAgICAgLy8gd2FsayB0aHJvdWdoIHRoZSBjaGlsZHJlbiBhbmQgYXNzZW1i\nbGUgdGhlIHBhdGgKICAgICAgICBib29sZWFuIGFsbG93TnVsbCA9ICFpbm5l\ncjsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IG5DaGlsZDsgaSsrKSB7\nCiAgICAgICAgICAgIHBhdGggPSAoUGF0aCkgdHJhdmVyc2VQYXRoKHBhdGgs\nIG5vZGUuY2hpbGRyZW5baV0udGV4dCwgcGNPbmx5LAogICAgICAgICAgICAg\nICAgYWxsb3dOdWxsKTsKCiAgICAgICAgICAgIC8vIGFsbCB0cmF2ZXJzYWxz\nIGJ1dCB0aGUgZmlyc3Qgb25lIHdpbGwgYWx3YXlzIGJlIGlubmVyIGpvaW5z\nCiAgICAgICAgICAgIGFsbG93TnVsbCA9IGZhbHNlOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdl\ndFR5cGVMaXRlcmFsKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBKUFFMTm9k\nZSB0eXBlID0gb25seUNoaWxkKG5vZGUpOwogICAgICAgIGZpbmFsIFN0cmlu\nZyBuYW1lID0gdHlwZS50ZXh0OwogICAgICAgIGZpbmFsIFZhbHVlIHZhbCA9\nIGdldFZhcmlhYmxlKG5hbWUsIGZhbHNlKTsKCiAgICAgICAgaWYgKHZhbCBp\nbnN0YW5jZW9mIFZhbHVlICYmIHZhbC5pc1ZhcmlhYmxlKCkpIHsKICAgICAg\nICAgICAgQ2xhc3M8Pz4gYyA9IHJlc29sdmVyLmNsYXNzRm9yTmFtZShuYW1l\nLCBudWxsKTsKICAgICAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgVmFsdWUgdHlwZUxpdCA9IGZhY3RvcnkubmV3VHlwZUxpdGVy\nYWwoYywgTGl0ZXJhbC5UWVBFX0NMQVNTKTsKICAgICAgICAgICAgICAgIHR5\ncGVMaXQuc2V0TWV0YURhdGEoZ2V0Q2xhc3NNZXRhRGF0YShuYW1lLCBmYWxz\nZSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVMaXQ7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9u\nKEVYX1VTRVIsICJub3QtdHlwZS1saXRlcmFsIiwKICAgICAgICAgICAgbmV3\nIE9iamVjdFtdeyBuYW1lIH0sIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUg\nVmFsdWUgZ2V0UGF0aE9yQ29uc3RhbnQoSlBRTE5vZGUgbm9kZSkgewogICAg\nICAgIC8vIGZpcnN0IGNoZWNrIHRvIHNlZSBpZiB0aGUgcGF0aCBpcyBhbiBl\nbnVtIG9yIHN0YXRpYyBmaWVsZCwgYW5kCiAgICAgICAgLy8gaWYgc28sIGxv\nYWQgaXQKICAgICAgICBTdHJpbmcgY2xhc3NOYW1lID0gYXNzZW1ibGUobm9k\nZSwgIi4iLCAxKTsKICAgICAgICBDbGFzczw/PiBjID0gcmVzb2x2ZXIuY2xh\nc3NGb3JOYW1lKGNsYXNzTmFtZSwgbnVsbCk7CiAgICAgICAgaWYgKGMgIT0g\nbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gbGFzdENo\naWxkKG5vZGUpLnRleHQ7CiAgICAgICAgICAgIGludCB0eXBlID0gKGMuaXNF\nbnVtKCkgPyBMaXRlcmFsLlRZUEVfRU5VTSA6IExpdGVyYWwuVFlQRV9VTktO\nT1dOKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIEZpZWxk\nIGZpZWxkID0gYy5nZXRGaWVsZChmaWVsZE5hbWUpOwogICAgICAgICAgICAg\nICAgT2JqZWN0IHZhbHVlID0gZmllbGQuZ2V0KG51bGwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0ZXJhbCh2YWx1ZSwgdHlwZSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaEZpZWxkRXhjZXB0aW9uIG5z\nZmUpIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmluRW51bVBhdGgpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNF\nUiwgIm5vLWZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBjLmdldE5hbWUoKSwgZmllbGROYW1lIH0sIG5zZmUpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQYXRoKG5vZGUsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IHBhcnNl\nRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmFjY2Vzc2libGUtZmllbGQiLAogICAg\nICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgY2xhc3NOYW1lLCBmaWVs\nZE5hbWUgfSwgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICByZXR1cm4gZ2V0UGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUHJvY2VzcyB0eXBl\nX2Rpc2NyaW1pbmF0b3IKICAgICAqICAgICB0eXBlX2Rpc2NyaW1pbmF0b3Ig\nOjo9CiAgICAgKiAgICAgICAgIFRZUEUoZ2VuZXJhbF9pZGVudGlmaWNhdGlv\nbl92YXJpYWJsZSB8CiAgICAgKiAgICAgICAgIHNpbmdsZV92YWx1ZWRfb2Jq\nZWN0X3BhdGhfZXhwcmVzc2lvbiB8CiAgICAgKiAgICAgICAgIGlucHV0X3Bh\ncmFtZXRlciApCiAgICAgKi8KICAgIHByaXZhdGUgVmFsdWUgZ2V0VHlwZShK\nUFFMTm9kZSBub2RlKSB7CiAgICAgICAgc3dpdGNoIChub2RlLmlkKSB7CiAg\nICAgICAgY2FzZSBKSlRJREVOVElGSUVSOgogICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS50eXBlKGdldFZhbHVlKG5vZGUpKTsKCiAgICAgICAgY2FzZSBK\nSlROQU1FRElOUFVUUEFSQU1FVEVSOgogICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS50eXBlKGdldFBhcmFtZXRlcihub2RlLnRleHQsIGZhbHNlLCBmYWxz\nZSkpOwoKICAgICAgICBjYXNlIEpKVFBPU0lUSU9OQUxJTlBVVFBBUkFNRVRF\nUjoKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudHlwZShnZXRQYXJhbWV0\nZXIobm9kZS50ZXh0LCB0cnVlLCBmYWxzZSkpOwoKICAgICAgICBjYXNlIEpK\nVEdFTkVSQUxJREVOVElGSUVSOgogICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS50eXBlKGdldFF1YWxpZmllZElkZW50aWZpZXIob25seUNoaWxkKG5vZGUp\nKSk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIC8vIFRPRE86IGVu\nZm9yY2UganBhMi4wIHNwZWMgcnVsZXMuCiAgICAgICAgICAgIC8vIEEgc2lu\nZ2xlX3ZhbHVlZF9vYmplY3RfZmllbGQgaXMgZGVzaWduYXRlZCBieSB0aGUg\nbmFtZSBvZgogICAgICAgICAgICAvLyBhbiBhc3NvY2lhdGlvbiBmaWVsZCBp\nbiBhIG9uZS10by1vbmUgb3IgbWFueS10by1vbmUgcmVsYXRpb25zaGlwCiAg\nICAgICAgICAgIC8vIG9yIGEgZmllbGQgb2YgZW1iZWRkYWJsZSBjbGFzcyB0\neXBlLgogICAgICAgICAgICAvLyBUaGUgdHlwZSBvZiBhIHNpbmdsZV92YWx1\nZWRfb2JqZWN0X2ZpZWxkIGlzIHRoZSBhYnN0cmFjdCBzY2hlbWEKICAgICAg\nICAgICAgLy8gdHlwZSBvZiB0aGUgcmVsYXRlZCBlbnRpdHkgb3IgZW1iZWRk\nYWJsZSBjbGFzcwogICAgICAgICAgICBWYWx1ZSBwYXRoID0gZ2V0UGF0aChu\nb2RlLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLnR5cGUocGF0aCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgUGF0\naCBnZXRQYXRoKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gZ2V0\nUGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSBQ\nYXRoIGdldFBhdGgoSlBRTE5vZGUgbm9kZSwgYm9vbGVhbiBwY09ubHksIGJv\nb2xlYW4gaW5uZXIpIHsKICAgICAgICAvLyByZXNvbHZlIHRoZSBmaXJzdCBl\nbGVtZW50IGFnYWluc3QgdGhlIGFsaWFzZXMgbWFwIC4uLgogICAgICAgIC8v\nIGkuZS4sIHRoZSBwYXRoICJTRUxFQ1QgeC5pZCBGUk9NIFNvbWVDbGFzcyB4\nIHdoZXJlIHguaWQgPiAxMCIKICAgICAgICAvLyB3aWxsIG5lZWQgdG8gaGF2\nZSAieCIgaW4gdGhlIGFsaWFzIG1hcCBpbiBvcmRlciB0byByZXNvbHZlCiAg\nICAgICAgUGF0aCBwYXRoID0gbnVsbDsKCiAgICAgICAgZmluYWwgU3RyaW5n\nIG5hbWUgPSBmaXJzdENoaWxkKG5vZGUpLnRleHQ7CiAgICAgICAgZmluYWwg\nVmFsdWUgdmFsID0gZ2V0VmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAg\nICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMg\ndGhlIGFsaWFzCiAgICAgICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRv\nbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRoaXMpCiAgICAgICAgaWYgKG5hbWUu\nZXF1YWxzSWdub3JlQ2FzZShjdHgoKS5zY2hlbWFBbGlhcykpIHsKICAgICAg\nICAgICAgaWYgKGN0eCgpLnN1YnF1ZXJ5ICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHBhdGggPSBmYWN0b3J5Lm5ld1BhdGgoY3R4KCkuc3VicXVlcnkp\nOwogICAgICAgICAgICAgICAgcGF0aC5zZXRNZXRhRGF0YShjdHgoKS5zdWJx\ndWVyeS5nZXRNZXRhRGF0YSgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIHBhdGggPSBmYWN0b3J5Lm5ld1BhdGgoKTsKICAgICAg\nICAgICAgICAgIHBhdGguc2V0TWV0YURhdGEoY3R4KCkubWV0YSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGdldE1ldGFEYXRhRm9yQWxp\nYXMobmFtZSkgIT0gbnVsbCkKICAgICAgICAgICAgcGF0aCA9IG5ld1BhdGgo\nbnVsbCwgZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1lKSk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgUGF0aCkKICAgICAgICAgICAgcGF0aCA9\nIChQYXRoKSB2YWw7CiAgICAgICAgZWxzZSBpZiAodmFsLmdldE1ldGFEYXRh\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcGF0aCA9IG5ld1BhdGgodmFsLCB2\nYWwuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0\naHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAicGF0aC1pbnZhbGlkIiwK\nICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgYXNzZW1ibGUobm9kZSks\nIG5hbWUgfSwgbnVsbCk7CgogICAgICAgIHBhdGguc2V0U2NoZW1hQWxpYXMo\nbmFtZSk7CgogICAgICAgIC8vIHdhbGsgdGhyb3VnaCB0aGUgY2hpbGRyZW4g\nYW5kIGFzc2VtYmxlIHRoZSBwYXRoCiAgICAgICAgYm9vbGVhbiBhbGxvd051\nbGwgPSAhaW5uZXI7CiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCBub2Rl\nLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwYXRo\nLmlzWFBhdGgoKSkgewogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IGk7\nIGogPG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAg\nICAgICAgcGF0aCA9IChQYXRoKSB0cmF2ZXJzZVhQYXRoKHBhdGgsIG5vZGUu\nY2hpbGRyZW5bal0udGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcGF0\naDsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXRoID0gKFBhdGgpIHRy\nYXZlcnNlUGF0aChwYXRoLCBub2RlLmNoaWxkcmVuW2ldLnRleHQsIHBjT25s\neSwKICAgICAgICAgICAgICAgIGFsbG93TnVsbCk7CiAgICAgICAgICAgIGlm\nIChjdHgoKS5nZXRQYXJlbnQoKSAhPSBudWxsICYmIGN0eCgpLmdldFZhcmlh\nYmxlKHBhdGguZ2V0U2NoZW1hQWxpYXMoKSkgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgcGF0aC5zZXRTdWJxdWVyeUNvbnRleHQoY3R4KCksIG5hbWUp\nOwogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgICAgIC8vIGFsbCB0\ncmF2ZXJzYWxzIGJ1dCB0aGUgZmlyc3Qgb25lIHdpbGwgYWx3YXlzIGJlIGlu\nbmVyIGpvaW5zCiAgICAgICAgICAgIGFsbG93TnVsbCA9IGZhbHNlOwogICAg\nICAgIH0KCiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICB9CgogICAgcHJvdGVj\ndGVkIENsYXNzPD8+IGdldERlY2xhcmVkVmFyaWFibGVUeXBlKFN0cmluZyBu\nYW1lKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRNZXRhRGF0\nYUZvckFsaWFzKG5hbWUpOwogICAgICAgIGlmIChjbWQgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGNtZC5nZXREZXNjcmliZWRUeXBlKCk7CgogICAg\nICAgIGlmIChuYW1lICE9IG51bGwgJiYgbmFtZS5lcXVhbHMoY3R4KCkuc2No\nZW1hQWxpYXMpKQogICAgICAgICAgICByZXR1cm4gZ2V0Q2FuZGlkYXRlVHlw\nZSgpOwoKICAgICAgICAvLyBKUFFMIGhhcyBubyBkZWNsYXJlZCB2YXJpYWJs\nZXMKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgYW4gRXhwcmVzc2lvbiBmb3IgdGhlIGdpdmVuIG5vZGUgYnkg\nZXZhbCdpbmcgaXQuCiAgICAgKi8KICAgIHByaXZhdGUgRXhwcmVzc2lvbiBn\nZXRFeHByZXNzaW9uKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBPYmplY3Qg\nZXhwID0gZXZhbChub2RlKTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIGJvb2xl\nYW4gdmFsdWVzIHVzZWQgYXMgZXhwcmVzc2lvbnMKICAgICAgICBpZiAoIShl\neHAgaW5zdGFuY2VvZiBFeHByZXNzaW9uKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkuYXNFeHByZXNzaW9uKChWYWx1ZSkgZXhwKTsKICAgICAgICBy\nZXR1cm4gKEV4cHJlc3Npb24pIGV4cDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgYSBTaW1wbGUgQ2FzZSBFeHByZXNzaW9uIGZvciB0aGUgZ2l2\nZW4gbm9kZSBieSBldmFsJ2luZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBW\nYWx1ZSBnZXRTaW1wbGVDYXNlRXhwcmVzc2lvbihKUFFMTm9kZSBub2RlKSB7\nCiAgICAgICAgT2JqZWN0IGNhc2VPcGVyYW5kID0gZXZhbChub2RlLmdldENo\naWxkKDApKTsKICAgICAgICBpbnQgbkNoaWxkID0gbm9kZS5nZXRDaGlsZENv\ndW50KCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBldmFsKGxhc3RDaGlsZChu\nb2RlKSk7CiAgICAgICAgT2JqZWN0IGV4cFtdID0gbmV3IEV4cHJlc3Npb25b\nbkNoaWxkIC0gMl07CiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCBuQ2hp\nbGQgLSAxOyBpKyspCiAgICAgICAgICAgIGV4cFtpLTFdID0gZXZhbChub2Rl\nLmNoaWxkcmVuW2ldKTsKICAgICAgICAKICAgICAgICByZXR1cm4gZmFjdG9y\neS5zaW1wbGVDYXNlRXhwcmVzc2lvbigoVmFsdWUpIGNhc2VPcGVyYW5kLAog\nICAgICAgICAgICAoRXhwcmVzc2lvbltdKSBleHAsIChWYWx1ZSkgdmFsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSBHZW5lcmFsIENhc2Ug\nRXhwcmVzc2lvbiBmb3IgdGhlIGdpdmVuIG5vZGUgYnkgZXZhbCdpbmcgaXQu\nCiAgICAgKi8KICAgIHByaXZhdGUgVmFsdWUgZ2V0R2VuZXJhbENhc2VFeHBy\nZXNzaW9uKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpbnQgbkNoaWxkID0g\nbm9kZS5nZXRDaGlsZENvdW50KCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBl\ndmFsKGxhc3RDaGlsZChub2RlKSk7CiAgICAgICAgT2JqZWN0IGV4cFtdID0g\nbmV3IEV4cHJlc3Npb25bbkNoaWxkIC0gMV07CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBuQ2hpbGQgLSAxOyBpKyspCiAgICAgICAgICAgIGV4cFtp\nXSA9IChFeHByZXNzaW9uKSBldmFsKG5vZGUuY2hpbGRyZW5baV0pOwogICAg\nICAgIAogICAgICAgIHJldHVybiBmYWN0b3J5LmdlbmVyYWxDYXNlRXhwcmVz\nc2lvbigoRXhwcmVzc2lvbltdKSBleHAsIChWYWx1ZSkgdmFsKTsKICAgIH0K\nCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZ2V0V2hlbkNvbmRpdGlvbihKUFFM\nTm9kZSBub2RlKSB7CiAgICAgICAgT2JqZWN0IGV4cCA9IGV2YWwoZmlyc3RD\naGlsZChub2RlKSk7CiAgICAgICAgT2JqZWN0IHZhbCA9IGV2YWwoc2Vjb25k\nQ2hpbGQobm9kZSkpOwogICAgICAgIHJldHVybiBmYWN0b3J5LndoZW5Db25k\naXRpb24oKEV4cHJlc3Npb24pIGV4cCwgKFZhbHVlKSB2YWwpOwogICAgfQoK\nICAgIHByaXZhdGUgRXhwcmVzc2lvbiBnZXRXaGVuU2NhbGFyKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICBPYmplY3QgdmFsMSA9IGV2YWwoZmlyc3RDaGls\nZChub2RlKSk7CiAgICAgICAgT2JqZWN0IHZhbDIgPSBldmFsKHNlY29uZENo\naWxkKG5vZGUpKTsKICAgICAgICByZXR1cm4gZmFjdG9yeS53aGVuU2NhbGFy\nKChWYWx1ZSkgdmFsMSwgKFZhbHVlKSB2YWwyKTsKICAgIH0KCiAgICBwcml2\nYXRlIFZhbHVlIGdldENvYWxlc2NlRXhwcmVzc2lvbihKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgaW50IG5DaGlsZCA9IG5vZGUuZ2V0Q2hpbGRDb3VudCgp\nOwogICAgICAgIAogICAgICAgIE9iamVjdCB2YWxzW10gPSBuZXcgVmFsdWVb\nbkNoaWxkXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG5DaGlsZDsg\naSsrKQogICAgICAgICAgICB2YWxzW2ldID0gZXZhbChub2RlLmNoaWxkcmVu\nW2ldKTsKICAgICAgICAKICAgICAgICByZXR1cm4gZmFjdG9yeS5jb2FsZXNj\nZUV4cHJlc3Npb24oKFZhbHVlW10pIHZhbHMpOwogICAgfQoKICAgIHByaXZh\ndGUgVmFsdWUgZ2V0TnVsbElmRXhwcmVzc2lvbihKUFFMTm9kZSBub2RlKSB7\nCiAgICAgICAgT2JqZWN0IHZhbDEgPSBldmFsKGZpcnN0Q2hpbGQobm9kZSkp\nOwogICAgICAgIE9iamVjdCB2YWwyID0gZXZhbChzZWNvbmRDaGlsZChub2Rl\nKSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGZhY3RvcnkubnVsbElmRXhw\ncmVzc2lvbigoVmFsdWUpIHZhbDEsIChWYWx1ZSkgdmFsMik7CiAgICB9Cgog\nICAgcHJpdmF0ZSBWYWx1ZSBnZXRWYWx1ZShKUFFMTm9kZSBub2RlKSB7CiAg\nICAgICAgaWYgKG5vZGUuaWQgPT0gSkpUUVVBTElGSUVESURFTlRJRklFUikK\nICAgICAgICAgICAgcmV0dXJuIGdldFF1YWxpZmllZElkZW50aWZpZXIob25s\neUNoaWxkKG5vZGUpKTsKICAgICAgICByZXR1cm4gZ2V0VmFsdWUobm9kZSwg\nVkFSX1BBVEgpOwogICAgfQoKICAgIHByaXZhdGUgUGF0aCBuZXdQYXRoKFZh\nbHVlIHZhbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgUGF0aCBw\nYXRoID0gdmFsID09IG51bGwgPyBmYWN0b3J5Lm5ld1BhdGgoKSA6IGZhY3Rv\ncnkubmV3UGF0aCh2YWwpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAg\nICAgICAgICAgIHBhdGguc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgcmV0\ndXJuIHBhdGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgVmFs\ndWUgZm9yIHRoZSBnaXZlbiBub2RlIGJ5IGV2YWwnaW5nIGl0LgogICAgICov\nCiAgICBwcml2YXRlIFZhbHVlIGdldFZhbHVlKEpQUUxOb2RlIG5vZGUsIGlu\ndCBoYW5kbGVWYXIpIHsKICAgICAgICBWYWx1ZSB2YWwgPSAoVmFsdWUpIGV2\nYWwobm9kZSk7CgogICAgICAgIC8vIGRldGVybWluZWQgaG93IHRvIGV2YWx1\nYXRlIGEgdmFyaWFibGUKICAgICAgICBpZiAoIXZhbC5pc1ZhcmlhYmxlKCkp\nCiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgZWxzZSBpZiAoaGFu\nZGxlVmFyID09IFZBUl9QQVRIICYmICEodmFsIGluc3RhbmNlb2YgUGF0aCkp\nCiAgICAgICAgICAgIHJldHVybiBuZXdQYXRoKHZhbCwgdmFsLmdldE1ldGFE\nYXRhKCkpOwogICAgICAgIGVsc2UgaWYgKGhhbmRsZVZhciA9PSBWQVJfRVJS\nT1IpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIs\nICJ1bmV4cGVjdGVkLXZhciIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IG5vZGUudGV4dCB9LCBudWxsKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHJldHVybiB2YWw7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gUGFyc2UgQ29udGV4dCBNYW5hZ2VtZW50CiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHJpdmF0ZSBD\nb250ZXh0IGN0eCgpIHsKICAgICAgICByZXR1cm4gIGNvbnRleHRzLnBlZWso\nKTsKICAgIH0KCiAgICBwcml2YXRlIEpQUUxOb2RlIHJvb3QoKSB7CiAgICAg\nICAgcmV0dXJuIGN0eCgpLnBhcnNlZC5yb290OwogICAgfQoKICAgIHByaXZh\ndGUgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YUZvckFsaWFzKFN0cmluZyBh\nbGlhcykgewogICAgICAgIGZvciAoaW50IGkgPSBjb250ZXh0cy5zaXplKCkg\nLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICBDb250ZXh0IGNvbnRl\neHQgPSAgY29udGV4dHMuZ2V0KGkpOwogICAgICAgICAgICBpZiAoYWxpYXMu\nZXF1YWxzSWdub3JlQ2FzZShjb250ZXh0LnNjaGVtYUFsaWFzKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBjb250ZXh0Lm1ldGE7CiAgICAgICAgfQoKICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBh\nZGRTY2hlbWFUb0NvbnRleHQoU3RyaW5nIGlkLCBDbGFzc01ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBjdHgoKS5hZGRTY2hlbWEoaWQudG9Mb3dlckNhc2Uo\nKSwgbWV0YSk7ICAgIAogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZFZh\ncmlhYmxlVG9Db250ZXh0KFN0cmluZyBpZCwgVmFsdWUgdmFyKSB7CiAgICAg\nICAgY3R4KCkuYWRkVmFyaWFibGUoaWQsIHZhcik7CiAgICB9CgogICAgcHJv\ndGVjdGVkIFZhbHVlIGdldFZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAgICAg\nICBDb250ZXh0IGMgPSBjdHgoKTsKICAgICAgICBWYWx1ZSB2ID0gYy5nZXRW\nYXJpYWJsZSh2YXIpOwogICAgICAgIGlmICh2ICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiB2OwogICAgICAgIGlmIChjLmdldFBhcmVudCgpICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBjLmdldFBhcmVudCgpLmZpbmRWYXJp\nYWJsZSh2YXIpOwoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBOb2RlIHRyYXZl\ncnNhbCB1dGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KCiAgICBwcml2YXRlIEpQUUxOb2RlIG9ubHlDaGlsZChKUFFMTm9kZSBu\nb2RlKQogICAgICAgIHRocm93cyBVc2VyRXhjZXB0aW9uIHsKICAgICAgICBK\nUFFMTm9kZSBjaGlsZCA9IGZpcnN0Q2hpbGQobm9kZSk7CgogICAgICAgIGlm\nIChub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJtdWx0aS1jaGlsZHJlbiIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUsIEFycmF5cy5hc0xp\nc3Qobm9kZS5jaGlsZHJlbikgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBj\naGlsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGxlZnQg\nbm9kZSAodGhlIGZpcnN0IG9mIHRoZSBjaGlsZHJlbiksIGFuZCBhc3NlcnRz\nCiAgICAgKiB0aGF0IHRoZXJlIGFyZSBleGFjdGx5IHR3byBjaGlsZHJlbi4K\nICAgICAqLwogICAgcHJpdmF0ZSBKUFFMTm9kZSBsZWZ0KEpQUUxOb2RlIG5v\nZGUpIHsKICAgICAgICByZXR1cm4gY2hpbGQobm9kZSwgMCwgMik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSByaWdodCBub2RlICh0aGUg\nc2Vjb25kIG9mIHRoZSBjaGlsZHJlbiksIGFuZCBhc3NlcnRzCiAgICAgKiB0\naGF0IHRoZXJlIGFyZSBleGFjdGx5IHR3byBjaGlsZHJlbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBKUFFMTm9kZSByaWdodChKUFFMTm9kZSBub2RlKSB7CiAg\nICAgICAgcmV0dXJuIGNoaWxkKG5vZGUsIDEsIDIpOwogICAgfQoKICAgIHBy\naXZhdGUgSlBRTE5vZGUgY2hpbGQoSlBRTE5vZGUgbm9kZSwgaW50IGNoaWxk\nTnVtLCBpbnQgYXNzZXJ0Q291bnQpIHsKICAgICAgICBpZiAobm9kZS5jaGls\nZHJlbi5sZW5ndGggIT0gYXNzZXJ0Q291bnQpCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ3cm9uZy1jaGlsZC1jb3VudCIs\nCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5ldyBJbnRlZ2VyKGFz\nc2VydENvdW50KSwgbm9kZSwKICAgICAgICAgICAgICAgICAgICBBcnJheXMu\nYXNMaXN0KG5vZGUuY2hpbGRyZW4pIH0sIG51bGwpOwoKICAgICAgICByZXR1\ncm4gbm9kZS5jaGlsZHJlbltjaGlsZE51bV07CiAgICB9CgogICAgcHJpdmF0\nZSBKUFFMTm9kZSBmaXJzdENoaWxkKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICBpZiAobm9kZS5jaGlsZHJlbiA9PSBudWxsIHx8IG5vZGUuY2hpbGRyZW4u\nbGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9u\nKEVYX1VTRVIsICJuby1jaGlsZHJlbiIsCiAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W117IG5vZGUgfSwgbnVsbCk7CiAgICAgICAgcmV0dXJuIG5vZGUu\nY2hpbGRyZW5bMF07CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5v\nZGUgc2Vjb25kQ2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVy\nbiBub2RlLmNoaWxkcmVuWzFdOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIEpQUUxOb2RlIHRoaXJkQ2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIHJldHVybiBub2RlLmNoaWxkcmVuWzJdOwogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIEpQUUxOb2RlIGxhc3RDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAg\nICAgICAgcmV0dXJuIGxhc3RDaGlsZChub2RlLCAwKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBOdGggZnJvbSB0aGUgbGFzdCBjaGlsZC4gRS5nLiwK\nICAgICAqIGxhc3RDaGlsZCgxKSB3aWxsIHJldHVybiB0aGUgc2Vjb25kLXRv\nLXRoZS1sYXN0IGNoaWxkLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBK\nUFFMTm9kZSBsYXN0Q2hpbGQoSlBRTE5vZGUgbm9kZSwgaW50IGZyb21MYXN0\nKSB7CiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW5bbm9kZS5jaGlsZHJl\nbi5sZW5ndGggLSAoMSArIGZyb21MYXN0KV07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBCYXNlIG5vZGUgdGhhdCB3aWxsIGJlIGdlbmVyYXRlZCBieSB0aGUg\nSlBRTEV4cHJlc3Npb25CdWlsZGVyOyBiYXNlCiAgICAgKiBjbGFzcyBvZiB0\naGUge0BsaW5rIFNpbXBsZU5vZGV9IHRoYXQgaXMgdXNlZCBieSB7QGxpbmsg\nSlBRTH0uCiAgICAgKgogICAgICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVh\ndXgKICAgICAqIEBzZWUgTm9kZQogICAgICogQHNlZSBTaW1wbGVOb2RlCiAg\nICAgKi8KICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJzZXJpYWwiKQogICAgcHJv\ndGVjdGVkIGFic3RyYWN0IHN0YXRpYyBjbGFzcyBKUFFMTm9kZQogICAgICAg\nIGltcGxlbWVudHMgTm9kZSwgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgZmlu\nYWwgaW50IGlkOwogICAgICAgIGZpbmFsIEpQUUwgcGFyc2VyOwogICAgICAg\nIEpQUUxOb2RlIHBhcmVudDsKICAgICAgICBKUFFMTm9kZVtdIGNoaWxkcmVu\nOwogICAgICAgIFN0cmluZyB0ZXh0OwogICAgICAgIGJvb2xlYW4gbm90ID0g\nZmFsc2U7CiAgICAgICAgYm9vbGVhbiBpbkVudW1QYXRoID0gZmFsc2U7Cgog\nICAgICAgIHB1YmxpYyBKUFFMTm9kZShKUFFMIHBhcnNlciwgaW50IGlkKSB7\nCiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDsKICAgICAgICAgICAgdGhpcy5w\nYXJzZXIgPSBwYXJzZXI7CiAgICAgICAgICAgIHRoaXMuaW5FbnVtUGF0aCA9\nIHBhcnNlci5pbkVudW1QYXRoOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgamp0T3BlbigpIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGpqdENsb3NlKCkgewogICAgICAgIH0KCiAgICAgICAgSlBRTE5vZGVb\nXSBmaW5kQ2hpbGRyZW5CeUlEKGludCBpZCkgewogICAgICAgICAgICBDb2xs\nZWN0aW9uPEpQUUxOb2RlPiBzZXQgPSBuZXcgTGlua2VkSGFzaFNldDxKUFFM\nTm9kZT4oKTsKICAgICAgICAgICAgZmluZENoaWxkcmVuQnlJRChpZCwgc2V0\nKTsKICAgICAgICAgICAgcmV0dXJuIHNldC50b0FycmF5KG5ldyBKUFFMTm9k\nZVtzZXQuc2l6ZSgpXSk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZv\naWQgZmluZENoaWxkcmVuQnlJRChpbnQgaWQsIENvbGxlY3Rpb248SlBRTE5v\nZGU+IHNldCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgY2hpbGRy\nZW4gIT0gbnVsbCAmJiBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pZCA9PSBpZCkKICAgICAg\nICAgICAgICAgICAgICBzZXQuYWRkKGNoaWxkcmVuW2ldKTsKCiAgICAgICAg\nICAgICAgICBjaGlsZHJlbltpXS5maW5kQ2hpbGRyZW5CeUlEKGlkLCBzZXQp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGhh\nc0NoaWxkSUQoaW50IGlkKSB7CiAgICAgICAgICAgIHJldHVybiBmaW5kQ2hp\nbGRCeUlEKGlkLCBmYWxzZSkgIT0gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIEpQUUxOb2RlIGZpbmRDaGlsZEJ5SUQoaW50IGlkLCBib29sZWFuIHJlY3Vy\nc2UpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNoaWxkcmVuICE9\nIG51bGwgJiYgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBKUFFMTm9kZSBjaGlsZCA9IGNoaWxkcmVuW2ldOwoKICAgICAg\nICAgICAgICAgIGlmIChjaGlsZC5pZCA9PSBpZCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gY2hpbGRyZW5baV07CgogICAgICAgICAgICAgICAgaWYg\nKHJlY3Vyc2UpIHsKICAgICAgICAgICAgICAgICAgICBKUFFMTm9kZSBmb3Vu\nZCA9IGNoaWxkLmZpbmRDaGlsZEJ5SUQoaWQsIHJlY3Vyc2UpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChmb3VuZCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZm91bmQ7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdCBmb3VuZAogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGpqdFNldFBhcmVudChOb2RlIHBhcmVudCkgewogICAgICAgICAgICB0\naGlzLnBhcmVudCA9IChKUFFMTm9kZSkgcGFyZW50OwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE5vZGUgamp0R2V0UGFyZW50KCkgewogICAgICAgICAg\nICByZXR1cm4gdGhpcy5wYXJlbnQ7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBqanRBZGRDaGlsZChOb2RlIG4sIGludCBpKSB7CiAgICAgICAg\nICAgIGlmIChjaGlsZHJlbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBj\naGlsZHJlbiA9IG5ldyBKUFFMTm9kZVtpICsgMV07CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoaSA+PSBjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgICAg\nICAgIEpQUUxOb2RlIGNbXSA9IG5ldyBKUFFMTm9kZVtpICsgMV07CiAgICAg\nICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGNoaWxkcmVuLCAwLCBjLCAw\nLCBjaGlsZHJlbi5sZW5ndGgpOwogICAgICAgICAgICAgICAgY2hpbGRyZW4g\nPSBjOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaGlsZHJlbltpXSA9\nIChKUFFMTm9kZSkgbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOb2Rl\nIGpqdEdldENoaWxkKGludCBpKSB7CiAgICAgICAgICAgIHJldHVybiBjaGls\nZHJlbltpXTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0Q2hp\nbGRDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIGpqdEdldE51bUNoaWxk\ncmVuKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSlBRTE5vZGUgZ2V0\nQ2hpbGQoaW50IGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiAoSlBRTE5v\nZGUpIGpqdEdldENoaWxkKGluZGV4KTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBJdGVyYXRvcjxKUFFMTm9kZT4gaXRlcmF0b3IoKSB7CiAgICAgICAg\nICAgIHJldHVybiBBcnJheXMuYXNMaXN0KGNoaWxkcmVuKS5pdGVyYXRvcigp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBqanRHZXROdW1DaGls\nZHJlbigpIHsKICAgICAgICAgICAgcmV0dXJuIChjaGlsZHJlbiA9PSBudWxs\nKSA/IDAgOiBjaGlsZHJlbi5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgICB2\nb2lkIHNldFRleHQoU3RyaW5nIHRleHQpIHsKICAgICAgICAgICAgdGhpcy50\nZXh0ID0gdGV4dDsKICAgICAgICB9CgogICAgICAgIHZvaWQgc2V0VG9rZW4o\nVG9rZW4gdCkgewogICAgICAgICAgICBzZXRUZXh0KHQuaW1hZ2UpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgcmV0dXJuIEpQUUxUcmVlQ29uc3RhbnRzLmpqdE5vZGVOYW1l\nW3RoaXMuaWRdOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0\nb1N0cmluZyhTdHJpbmcgcHJlZml4KSB7CiAgICAgICAgICAgIHJldHVybiBw\ncmVmaXggKyB0b1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogRGVidWdnaW5nIG1ldGhvZC4KICAgICAgICAgKgogICAgICAg\nICAqIEBzZWUgI2R1bXAoamF2YS5pby5QcmludFN0cmVhbSxTdHJpbmcpCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZHVtcChTdHJpbmcgcHJl\nZml4KSB7CiAgICAgICAgICAgIGR1bXAoU3lzdGVtLm91dCwgcHJlZml4KTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGR1bXAoKSB7CiAgICAg\nICAgICAgIGR1bXAoIiAiKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIERlYnVnZ2luZyBtZXRob2QgdG8gb3V0cHV0IGEgcGFyc2UgdHJl\nZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdXQgdGhlIHN0cmVh\nbSB0byB3aGljaCB0byB3cml0ZSB0aGUgZGVidWdnaW5nIGluZm8KICAgICAg\nICAgKiBAcGFyYW0gcHJlZml4IHRoZSBwcmVmaXggdG8gd3JpdGUgb3V0IGJl\nZm9yZSBsaW5lcwogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGR1\nbXAoUHJpbnRTdHJlYW0gb3V0LCBTdHJpbmcgcHJlZml4KSB7CiAgICAgICAg\nICAgIGR1bXAob3V0LCBwcmVmaXgsIGZhbHNlKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGR1bXAoUHJpbnRTdHJlYW0gb3V0LCBTdHJpbmcg\ncHJlZml4LCBib29sZWFuIHRleHQpIHsKICAgICAgICAgICAgb3V0LnByaW50\nbG4odG9TdHJpbmcocHJlZml4KQogICAgICAgICAgICAgICAgKyAodGV4dCAm\nJiB0aGlzLnRleHQgIT0gbnVsbCA/ICIgWyIgKyB0aGlzLnRleHQgKyAiXSIg\nOiAiIikpOwogICAgICAgICAgICBpZiAoY2hpbGRyZW4gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaGlsZHJlbi5s\nZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgIEpQUUxOb2RlIG4g\nPSAoSlBRTE5vZGUpIGNoaWxkcmVuW2ldOwogICAgICAgICAgICAgICAgICAg\nIGlmIChuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbi5k\ndW1wKG91dCwgcHJlZml4ICsgIiAiLCB0ZXh0KTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQdWJsaWMgZm9yIHVuaXQgdGVz\ndGluZyBwdXJwb3Nlcy4KICAgICAqIEBub2phdmFkb2MKICAgICAqLwogICAg\nQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIpCiAgICBwdWJsaWMgc3RhdGlj\nIGNsYXNzIFBhcnNlZEpQUUwKICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6\nYWJsZSB7CgogICAgICAgIC8vIFRoaXMgaXMgb25seSBldmVyIHVzZWQgZHVy\naW5nIHBhcnNlOyB3aGVuIFBhcnNlZEpQUUwgaW5zdGFuY2VzCiAgICAgICAg\nLy8gYXJlIHNlcmlhbGl6ZWQsIHRoZXkgd2lsbCBoYXZlIGFscmVhZHkgYmVl\nbiBwYXJzZWQuCiAgICAgICAgcHJpdmF0ZSBmaW5hbCB0cmFuc2llbnQgSlBR\nTE5vZGUgcm9vdDsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgcXVl\ncnk7CiAgICAgICAgCiAgICAgICAgLy8gY2FjaGUgb2YgY2FuZGlkYXRlIHR5\ncGUgZGF0YS4gVGhpcyBpcyBzdG9yZWQgaGVyZSBpbiBjYXNlIHRoaXMgIAog\nICAgICAgIC8vIHBhcnNlIHRyZWUgaXMgcmV1c2VkIGluIGEgY29udGV4dCB0\naGF0IGRvZXMgbm90IGtub3cgd2hhdCB0aGUgCiAgICAgICAgLy8gY2FuZGlk\nYXRlIHR5cGUgaXMgYWxyZWFkeS4gCiAgICAgICAgcHJpdmF0ZSBDbGFzczw/\nPiBfY2FuZGlkYXRlVHlwZTsKCiAgICAgICAgUGFyc2VkSlBRTChTdHJpbmcg\nanBxbCkgewogICAgICAgICAgICB0aGlzKGpwcWwsIHBhcnNlKGpwcWwpKTsK\nICAgICAgICB9CgogICAgICAgIFBhcnNlZEpQUUwoU3RyaW5nIHF1ZXJ5LCBK\nUFFMTm9kZSByb290KSB7CiAgICAgICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7\nCiAgICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTsKICAgICAgICB9Cgog\nICAgICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIHBhcnNlKFN0cmluZyBq\ncHFsKSB7CiAgICAgICAgICAgIGlmIChqcHFsID09IG51bGwpCiAgICAgICAg\nICAgICAgICBqcHFsID0gIiI7CgogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIChKUFFMTm9kZSkgbmV3IEpQUUwoanBxbCkucGFy\nc2VRdWVyeSgpOwogICAgICAgICAgICB9IGNhdGNoIChFcnJvciBlKSB7CiAg\nICAgICAgICAgICAgICAvLyBzcGVjaWFsIGhhbmRsaW5nIGZvciBFcnJvciBz\ndWJjbGFzc2VzLCB3aGljaCB0aGUKICAgICAgICAgICAgICAgIC8vIHBhcnNl\nciBtYXkgc29tZXRpbWVzICh1bmZvcnR1bmF0ZWx5KSB0aHJvdwogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBh\ncnNlLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIGUudG9TdHJpbmcoKSwganBxbCB9KSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHZvaWQgcG9wdWxhdGUoRXhwcmVzc2lvblN0b3JlUXVl\ncnkgcXVlcnkpIHsKICAgICAgICAgICAgUXVlcnlDb250ZXh0IGN0eCA9IHF1\nZXJ5LmdldENvbnRleHQoKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBvd25p\nbmcgcXVlcnkncyBjb250ZXh0IGRvZXMgbm90IGhhdmUKICAgICAgICAgICAg\nLy8gYW55IGNhbmRpZGF0ZSBjbGFzcywgdGhlbiBzZXQgaXQgaGVyZQogICAg\nICAgICAgICBpZiAoY3R4LmdldENhbmRpZGF0ZVR5cGUoKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoX2NhbmRpZGF0ZVR5cGUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBfY2FuZGlkYXRlVHlwZSA9IG5ldyBKUFFM\nRXhwcmVzc2lvbkJ1aWxkZXIKICAgICAgICAgICAgICAgICAgICAgICAgKG51\nbGwsIHF1ZXJ5LCB0aGlzKS5nZXRDYW5kaWRhdGVUeXBlKCk7CiAgICAgICAg\nICAgICAgICBjdHguc2V0Q2FuZGlkYXRlVHlwZShfY2FuZGlkYXRlVHlwZSwg\ndHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgLyoqCiAgICAgICAgICogUHVibGljIGZvciB1bml0IHRlc3RpbmcgcHVy\ncG9zZXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENsYXNzPD8+IGdl\ndENhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfY2FuZGlk\nYXRlVHlwZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9T\ndHJpbmcgKCkKCQl7CgkJCXJldHVybiB0aGlzLnF1ZXJ5OwoJCX0KCX0KfQoK\n","encoding":"base64"}

