{"sha":"7f588d224ae9f38d2b481164e80d64d32b23d9bd","node_id":"MDQ6QmxvYjIwNjM2NDo3ZjU4OGQyMjRhZTlmMzhkMmI0ODExNjRlODBkNjRkMzJiMjNkOWJk","size":91514,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7f588d224ae9f38d2b481164e80d64d32b23d9bd","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5J\ndGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51\ndGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0\naWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5T\ndHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9w\nZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmRhdGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZUxpc3RlbmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5tZXRhLlNvdXJjZVRyYWNrZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi54bWwuQ29tbWVudGFibGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CaWdEZWNpbWFsSWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CaWdJbnRlZ2VySWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CeXRlSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFySWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkludElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRh\nRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3Bl\nbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU2hvcnRJ\nZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0cmluZ0lkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CgppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQ29u\ndGFpbnMgbWV0YWRhdGEgYWJvdXQgYSBwZXJzaXN0ZW50IHR5cGUuCiAqIFRo\naXMgbWV0YWRhdGEgaXMgYXZhaWxhYmxlIGJvdGggYXQgZW5oYW5jZW1lbnQg\ndGltZSBhbmQgcnVudGltZS4KICogIE5vdGUgdGhhdCB0aGlzIGNsYXNzIGVt\ncGxveXMgYWdncmVzc2l2ZSBjYWNoaW5nLCBhbmQgdGhlcmVmb3JlIGl0IGlz\nCiAqIGltcG9ydGFudCB0byBmaW5hbGl6ZSB0aGUgY29uZmlndXJhdGlvbiBv\nZiBmaWVsZCBtZXRhZGF0YXMgYmVmb3JlIGludm9raW5nCiAqIG1ldGhvZHMg\ndGhhdCBkZXBlbmQgb24gdGhhdCBjb25maWd1cmF0aW9uLCBzdWNoIGFzCiAq\nIHtAbGluayAjZ2V0UHJpbWFyeUtleUZpZWxkc30uCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVi\nbGljIGNsYXNzIENsYXNzTWV0YURhdGEKICAgIGV4dGVuZHMgRXh0ZW5zaW9u\ncwogICAgaW1wbGVtZW50cyBDb21wYXJhYmxlPENsYXNzTWV0YURhdGE+LCBT\nb3VyY2VUcmFja2VyLCBNZXRhRGF0YUNvbnRleHQsIAogICAgTWV0YURhdGFN\nb2RlcywgQ29tbWVudGFibGUsIFZhbHVlTGlzdGVuZXIgewoKICAgIC8qKgog\nICAgICogVW5rbm93biBpZGVudGl0eSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBJRF9VTktOT1dOID0gMDsKCiAgICAvKioK\nICAgICAqIERhdGFzdG9yZSBpZGVudGl0eSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBJRF9EQVRBU1RPUkUgPSAxOwoKICAg\nIC8qKgogICAgICogQXBwbGljYXRpb24gaWRlbnRpdHkgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSURfQVBQTElDQVRJT04g\nPSAyOwoKICAgIC8qKgogICAgICogVW5rbm93biBhY2Nlc3MgdHlwZS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQUNDRVNTX1VOS05P\nV04gPSBBY2Nlc3NDb2RlLlVOS05PV047CgogICAgLyoqCiAgICAgKiBQZXJz\naXN0ZW50IGF0dHJpYnV0ZXMgYXJlIGFjY2Vzc2VkIHZpYSBkaXJlY3QgZmll\nbGQgYWNjZXNzLiBCaXQgZmxhZy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgQUNDRVNTX0ZJRUxEID0gQWNjZXNzQ29kZS5GSUVMRDsK\nCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBhcmUgYWNj\nZXNzZWQgdmlhIHNldHRlcnMgYW5kIGdldHRlcnMuIEJpdCBmbGFnLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1NfUFJPUEVS\nVFkgPSBBY2Nlc3NDb2RlLlBST1BFUlRZOwoKICAgIC8qKgogICAgICogUGVy\nc2lzdGVudCBjbGFzcyBoYXMgZXhwbGljaXRseSBkZWZpbmVkIGFuIGFjY2Vz\ncyB0eXBlLiAKICAgICAqIFRoaXMgd2lsbCBhbGxvdyB0aGUgYXR0cmlidXRl\ncyB0byB1c2UgbWl4ZWQgYWNjZXNzIGkuZS4gc29tZSBmaWVsZCAKICAgICAq\nIG1heSB1c2UgQUNDRVNTX0ZJRUxEIHdoaWxlIG90aGVycyBBQ0NFU1NfUFJP\nUEVSVFkuIAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBB\nQ0NFU1NfRVhQTElDSVQgPSBBY2Nlc3NDb2RlLkVYUExJQ0lUOwogICAgCiAg\nICAvKioKICAgICAqIFZhbHVlIGZvciB1c2luZyBhIHN5bnRoZXRpYyBkZXRh\nY2hlZCBzdGF0ZSBmaWVsZCwgd2hpY2ggaXMgdGhlIGRlZmF1bHQuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFNZTlRIRVRJQyA9\nICJgc3luIjsKCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIFN0cmluZyBE\nRUZBVUxUX1NUUklORyA9ICJgIjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAg\nICAgKENsYXNzTWV0YURhdGEuY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIEZldGNoR3JvdXBbXSBFTVBUWV9GRVRDSF9HUk9VUF9BUlJBWQog\nICAgICAgID0gbmV3IEZldGNoR3JvdXBbMF07CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmdbXSBFTVBUWV9TVFJJTkdfQVJSQVkgPSBuZXcgU3Ry\naW5nWzBdOwoKICAgIHByaXZhdGUgTWV0YURhdGFSZXBvc2l0b3J5IF9yZXBv\nczsKICAgIHByaXZhdGUgdHJhbnNpZW50IENsYXNzTG9hZGVyIF9sb2FkZXIg\nPSBudWxsOwoKICAgIHByaXZhdGUgZmluYWwgVmFsdWVNZXRhRGF0YSBfb3du\nZXI7CiAgICBwcml2YXRlIGZpbmFsIExpZmVjeWNsZU1ldGFEYXRhIF9saWZl\nTWV0YSA9IG5ldyBMaWZlY3ljbGVNZXRhRGF0YSh0aGlzKTsKICAgIHByaXZh\ndGUgRmlsZSBfc3JjRmlsZSA9IG51bGw7CiAgICBwcml2YXRlIGludCBfc3Jj\nVHlwZSA9IFNSQ19PVEhFUjsKICAgIHByaXZhdGUgaW50IF9saW5lTnVtID0g\nMDsgIAogICAgcHJpdmF0ZSBpbnQgX2NvbE51bSA9IDA7ICAKICAgIHByaXZh\ndGUgU3RyaW5nW10gX2NvbW1lbnRzID0gbnVsbDsKICAgIHByaXZhdGUgaW50\nIF9saXN0SW5kZXggPSAtMTsKICAgIHByaXZhdGUgaW50IF9zcmNNb2RlID0g\nTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HOwogICAgcHJpdmF0ZSBpbnQgX3Jl\nc01vZGUgPSBNT0RFX05PTkU7CgogICAgcHJpdmF0ZSBDbGFzczw/PiBfdHlw\nZSA9IE9iamVjdC5jbGFzczsKICAgIHByaXZhdGUgZmluYWwgTWFwPFN0cmlu\nZyxGaWVsZE1ldGFEYXRhPiBfZmllbGRNYXAgPSAKICAgIAluZXcgVHJlZU1h\ncDxTdHJpbmcsRmllbGRNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPFN0\ncmluZyxGaWVsZE1ldGFEYXRhPiBfc3VwRmllbGRNYXAgPSBudWxsOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9kZWZTdXBGaWVsZHMgPSBmYWxzZTsKICAgIHBy\naXZhdGUgQ29sbGVjdGlvbjxTdHJpbmc+IF9zdGF0aWNGaWVsZHMgPSBudWxs\nOwogICAgcHJpdmF0ZSBpbnRbXSBfZmllbGREYXRhVGFibGUgPSBudWxsOwog\nICAgcHJpdmF0ZSBNYXA8U3RyaW5nLEZldGNoR3JvdXA+IF9mZ01hcCA9IG51\nbGw7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE5vdGU6\nIGlmIHlvdSBhZGQgYWRkaXRpb25hbCBzdGF0ZSwgbWFrZSBzdXJlIHRvIGFk\nZCBpdCB0byBjb3B5KCkKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgcHJpdmF0ZSBDbGFzczw/PiBfb2JqZWN0SWQgPSBudWxsOwogICAgcHJp\ndmF0ZSBCb29sZWFuIF9vYmplY3RJZFNoYXJlZCA9IG51bGw7CiAgICBwcml2\nYXRlIEJvb2xlYW4gX29wZW5qcGFJZCA9IG51bGw7CiAgICBwcml2YXRlIEJv\nb2xlYW4gX2V4dGVudCA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX2Vt\nYmVkZGVkID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfZW1iZWRkYWJs\nZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBCb29sZWFuIF9pbnRlcmZhY2UgPSBu\ndWxsOwogICAgcHJpdmF0ZSBDbGFzczw/PiBfaW1wbCA9IG51bGw7CiAgICBw\ncml2YXRlIExpc3Q8Q2xhc3M8Pz4+IF9pbnRlcmZhY2VzID0gbnVsbDsKICAg\nIHByaXZhdGUgZmluYWwgTWFwPENsYXNzPD8+LE1hcDxTdHJpbmcsU3RyaW5n\nPj4gX2lmYWNlTWFwID0gCiAgICAJbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sTWFw\nPFN0cmluZyxTdHJpbmc+PigpOwogICAgcHJpdmF0ZSBpbnQgX2lkZW50aXR5\nID0gSURfVU5LTk9XTjsKICAgIHByaXZhdGUgaW50IF9pZFN0cmF0ZWd5ID0g\nVmFsdWVTdHJhdGVnaWVzLk5PTkU7CiAgICBwcml2YXRlIGludCBfYWNjZXNz\nVHlwZSA9IEFjY2Vzc0NvZGUuVU5LTk9XTjsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfcmVwbGljYXRlZCA9IGZhbHNlOwogICAgCiAgICBwcml2YXRlIFN0cmlu\nZyBfc2VxTmFtZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBTZXF1\nZW5jZU1ldGFEYXRhIF9zZXFNZXRhID0gbnVsbDsKICAgIHByaXZhdGUgU3Ry\naW5nIF9jYWNoZU5hbWUgPSBERUZBVUxUX1NUUklORzsgLy8gbnVsbCBpbXBs\naWVzIEBEYXRhQ2FjaGUoZW5hYmxlZD1mYWxzZSkKICAgIHByaXZhdGUgQm9v\nbGVhbiBfY2FjaGVFbmFibGVkID0gbnVsbDsgICAgICAgLy8gZGVub3RlcyBz\ndGF0dXMgb2YgSlBBIDIgQENhY2hlYWJsZSBhbm5vdGF0aW9uCiAgICBwcml2\nYXRlIGludCBfY2FjaGVUaW1lb3V0ID0gSW50ZWdlci5NSU5fVkFMVUU7CiAg\nICBwcml2YXRlIEJvb2xlYW4gX2RldGFjaGFibGUgPSBudWxsOwogICAgcHJp\ndmF0ZSBTdHJpbmcgX2RldGFjaFN0YXRlID0gREVGQVVMVF9TVFJJTkc7CiAg\nICBwcml2YXRlIFN0cmluZyBfYWxpYXMgPSBudWxsOwogICAgcHJpdmF0ZSBp\nbnQgX3ZlcnNpb25JZHggPSBJbnRlZ2VyLk1JTl9WQUxVRTsKCiAgICBwcml2\nYXRlIENsYXNzPD8+IF9zdXBlciA9IG51bGw7CiAgICBwcml2YXRlIENsYXNz\nTWV0YURhdGEgX3N1cGVyTWV0YSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNz\nPD8+W10gX3N1YnMgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRh\nW10gX3N1Yk1ldGFzID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0\nYVtdIF9tYXBTdWJNZXRhcyA9IG51bGw7CgogICAgcHJpdmF0ZSBGaWVsZE1l\ndGFEYXRhW10gX2ZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZpZWxkTWV0\nYURhdGFbXSBfdW5tZ2RGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVs\nZE1ldGFEYXRhW10gX2FsbEZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZp\nZWxkTWV0YURhdGFbXSBfYWxsUEtGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0\nZSBGaWVsZE1ldGFEYXRhW10gX2FsbERGR0ZpZWxkcyA9IG51bGw7CiAgICBw\ncml2YXRlIEZpZWxkTWV0YURhdGFbXSBfZGVmaW5lZEZpZWxkcyA9IG51bGw7\nCiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBfbGlzdGluZ0ZpZWxkcyA9\nIG51bGw7CiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBfYWxsTGlzdGlu\nZ0ZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZldGNoR3JvdXBbXSBfZmdz\nID0gbnVsbDsKICAgIHByaXZhdGUgRmV0Y2hHcm91cFtdIF9jdXN0b21GR3Mg\nPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9pbnRlcmNlcHRpbmcgPSBm\nYWxzZTsKICAgIHByaXZhdGUgQm9vbGVhbiBfdXNlSWRDbGFzc0Zyb21QYXJl\nbnQgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9hYnN0cmFjdCA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBCb29sZWFuIF9oYXNBYnN0cmFjdFBLRmllbGQg\nPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9oYXNQS0ZpZWxkc0Zyb21B\nYnN0cmFjdENsYXNzID0gbnVsbDsKICAgIAogICAgLyoqCiAgICAgKiBDb25z\ndHJ1Y3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCByZXBvc2l0b3J5\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YShDbGFzczw/\nPiB0eXBlLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBf\ncmVwb3MgPSByZXBvczsKICAgICAgICBfb3duZXIgPSBudWxsOwogICAgICAg\nIHNldERlc2NyaWJlZFR5cGUodHlwZSk7CiAgICAgICAgcmVnaXN0ZXJGb3JW\nYWx1ZVVwZGF0ZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8q\nKgogICAgICogRW1iZWRkZWQgY29uc3RydWN0b3IuIFN1cHBseSBlbWJlZGRp\nbmcgdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRh\nKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICBfb3duZXIgPSBvd25l\ncjsKICAgICAgICBfcmVwb3MgPSBvd25lci5nZXRSZXBvc2l0b3J5KCk7CiAg\nICAgICAgc2V0RW52Q2xhc3NMb2FkZXIob3duZXIuZ2V0RmllbGRNZXRhRGF0\nYSgpLmdldERlZmluaW5nTWV0YURhdGEoKS4KICAgICAgICAgICAgZ2V0RW52\nQ2xhc3NMb2FkZXIoKSk7CiAgICAgICAgcmVnaXN0ZXJGb3JWYWx1ZVVwZGF0\nZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVi\nbGljIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCkgewogICAg\nICAgIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0\naGlzIG1ldGFkYXRhIGlzIGZvciBhbiBlbWJlZGRlZCBvYmplY3QsIHJldHVy\nbmluZyB0aGUgb3duaW5nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgVmFs\ndWVNZXRhRGF0YSBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpIHsKICAgICAgICBy\nZXR1cm4gX293bmVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNp\nc3RlbmNlIGNhcGFibGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRoaXMgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzczw/PiBnZXREZXNjcmliZWRU\neXBlKCkgewogICAgICAgIHJldHVybiBfdHlwZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRoaXMgbWV0YWRh\ndGEuIFRoZSB0eXBlIG1heSBiZSByZXNldCB3aGVuCiAgICAgKiBhbiBlbWJl\nZGRlZCB2YWx1ZSBjaGFuZ2VzIGl0cyBkZWNsYXJlZCB0eXBlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXREZXNjcmliZWRUeXBlKENsYXNzPD8+\nIHR5cGUpIHsKICAgICAgICBpZiAodHlwZS5nZXRTdXBlcmNsYXNzKCkgIT0g\nbnVsbCAmJiAiamF2YS5sYW5nLkVudW0iLmVxdWFscwogICAgICAgICAgICAo\ndHlwZS5nZXRTdXBlcmNsYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbnVtIiwg\ndHlwZSkpOwogICAgICAgIF90eXBlID0gdHlwZTsKICAgICAgICBpZiAoUGVy\nc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkp\nCiAgICAgICAgICAgIHNldEludGVyY2VwdGluZyh0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBlbnZpcm9ubWVudGFsIGxvYWRlciB1c2VkIHdo\nZW4gbG9hZGluZyB0aGlzIG1ldGFkYXRhLgogICAgICogVGhlIGNsYXNzIG1l\ndGFkYXRhIHNob3VsZCB1c2UgdGhpcyBsb2FkZXIgd2hlbiBsb2FkaW5nIG1l\ndGFkYXRhIGZvcgogICAgICogaXRzIHN1cGVyY2xhc3MgYW5kIGZpZWxkIHR5\ncGVzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0RW52Q2xh\nc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgZW52aXJvbm1lbnRhbCBsb2FkZXIg\ndXNlZCB3aGVuIGxvYWRpbmcgdGhpcyBtZXRhZGF0YS4KICAgICAqIFRoZSBj\nbGFzcyBtZXRhZGF0YSBzaG91bGQgdXNlIHRoaXMgbG9hZGVyIHdoZW4gbG9h\nZGluZyBtZXRhZGF0YSBmb3IKICAgICAqIGl0cyBzdXBlcmNsYXNzIGFuZCBm\naWVsZCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RW52Q2xh\nc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgX2xvYWRl\nciA9IGxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwZXJzaXN0\nZW5jZSBjYXBhYmxlIHN1cGVyY2xhc3Mgb2YgdGhlIGRlc2NyaWJlZCB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0UENTdXBlcmNsYXNz\nKCkgewogICAgICAgIHJldHVybiBfc3VwZXI7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBzdXBlcmNsYXNzIG9mIHRo\nZSBkZXNjcmliZWQgdHlwZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nUENTdXBlcmNsYXNzKENsYXNzPD8+IHBjKSB7CiAgICAgICAgY2xlYXJBbGxG\naWVsZENhY2hlKCk7CiAgICAgICAgX3N1cGVyID0gcGM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgZm9yIHRoaXMgY2xhc3MnIHN1cGVy\nY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCkgewogICAgICAgIGlmIChfc3VwZXJNZXRh\nID09IG51bGwgJiYgX3N1cGVyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYg\nKF9vd25lciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfc3VwZXJNZXRh\nID0gX3JlcG9zLm5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShfb3duZXIpOwog\nICAgICAgICAgICAgICAgX3N1cGVyTWV0YS5zZXREZXNjcmliZWRUeXBlKF9z\ndXBlcik7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgX3N1\ncGVyTWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YShfc3VwZXIsIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3N1cGVyTWV0YTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSBmb3IgdGhpcyBj\nbGFzcycgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX3N1cGVyTWV0\nYSA9IG1ldGE7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAg\nICAgc2V0UENTdXBlcmNsYXNzKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBjbGFzcyBpcyBt\nYXBwZWQgdG8gdGhlIGRhdGFzdG9yZS4gQnkgZGVmYXVsdCwgb25seQogICAg\nICogcmV0dXJucyBmYWxzZSBpZiBjbGFzcyBpcyBlbWJlZGRlZC1vbmx5LCBi\ndXQgc3ViY2xhc3NlcyBtaWdodCBvdmVycmlkZQogICAgICogdG8gYWxsb3cg\ndW5tYXBwZWQgb3RoZXIgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGlzTWFwcGVkKCkgewogICAgICAgIHJldHVybiBfZW1iZWRkZWQgIT0g\nQm9vbGVhbi5UUlVFOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBjbG9zZXN0IG1hcHBlZCBzdXBlcmNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3NNZXRhRGF0YSBnZXRNYXBwZWRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsIHx8IHN1\ncC5pc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4gc3VwOwogICAgICAg\nIHJldHVybiBzdXAuZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUga25vd24gcGVyc2lz\ndGVuY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9mIHRoZSBkZXNjcmliZWQgdHlw\nZSwKICAgICAqIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUgb3IgaWYgdGhpcyBp\ncyBlbWJlZGRlZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIENsYXNz\nPD8+W10gZ2V0UENTdWJjbGFzc2VzKCkgewogICAgICAgIGlmIChfb3duZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ldGFEYXRhUmVwb3NpdG9y\neS5FTVBUWV9DTEFTU0VTOwoKICAgICAgICBfcmVwb3MucHJvY2Vzc1JlZ2lz\ndGVyZWRDbGFzc2VzKF9sb2FkZXIpOwogICAgICAgIGlmIChfc3VicyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHN1YnMg\nPSBfcmVwb3MuZ2V0UENTdWJjbGFzc2VzKF90eXBlKTsKICAgICAgICAgICAg\nX3N1YnMgPSAoQ2xhc3NbXSkgc3Vicy50b0FycmF5KG5ldyBDbGFzc1tzdWJz\nLnNpemUoKV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3N1YnM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0\naGUga25vd24gcGVyc2lzdGVuY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9mCiAg\nICAgKiB0aGUgZGVzY3JpYmVkIHR5cGUsIG9yIGVtcHR5IGFycmF5IGlmIG5v\nbmUgb3IgaWYgdGhpcyBpcyBlbWJlZGRlZAogICAgICogbWV0YWRhdGEuCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0UENTdWJjbGFz\nc01ldGFEYXRhcygpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1QVFlfTUVUQVM7CgogICAgICAg\nIENsYXNzPD8+W10gc3VicyA9IGdldFBDU3ViY2xhc3NlcygpOyAvLyBjaGVj\na3MgZm9yIG5ldwogICAgICAgIGlmIChfc3ViTWV0YXMgPT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT0gMCkKICAgICAgICAgICAg\nICAgIF9zdWJNZXRhcyA9IF9yZXBvcy5FTVBUWV9NRVRBUzsKICAgICAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0\nYXMgPSBfcmVwb3MubmV3Q2xhc3NNZXRhRGF0YUFycmF5CiAgICAgICAgICAg\nICAgICAgICAgKHN1YnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgICAgICBtZXRhc1tpXSA9IF9yZXBvcy5nZXRNZXRhRGF0YShzdWJzW2ld\nLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9zdWJNZXRhcyA9\nIG1ldGFzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfc3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxs\nIG1hcHBlZCBzdWJjbGFzc2VzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NN\nZXRhRGF0YVtdIGdldE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0YXMoKSB7CiAg\nICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nX3JlcG9zLkVNUFRZX01FVEFTOwoKICAgICAgICBDbGFzc01ldGFEYXRhW10g\nc3VicyA9IGdldFBDU3ViY2xhc3NNZXRhRGF0YXMoKTsgLy8gY2hlY2tzIGZv\nciBuZXcKICAgICAgICBpZiAoX21hcFN1Yk1ldGFzID09IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAg\nICBfbWFwU3ViTWV0YXMgPSBzdWJzOwogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIExpc3Q8Q2xhc3NNZXRhRGF0YT4gbWFwcGVkID0gCiAg\nICAgICAgICAgICAgICAJbmV3IEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPihz\ndWJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYg\nKHN1YnNbaV0uaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nbWFwcGVkLmFkZChzdWJzW2ldKTsKICAgICAgICAgICAgICAgIF9tYXBTdWJN\nZXRhcyA9IChDbGFzc01ldGFEYXRhW10pIG1hcHBlZC50b0FycmF5CiAgICAg\nICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdDbGFzc01ldGFEYXRhQXJyYXko\nbWFwcGVkLnNpemUoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfbWFwU3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgdHlwZSBvZiBpZGVudGl0eSBiZWluZyB1c2VkLiBUaGlzIHdpbGwg\nYmUgb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxpPntAbGluayAjSURf\nVU5LTk9XTn06IHVua25vd24gaWRlbnRpdHkgdHlwZTwvbGk+CiAgICAgKiA8\nbGk+e0BsaW5rICNJRF9EQVRBU1RPUkV9OiBpZGVudGl0eSBtYW5hZ2VkIGJ5\nIHRoZSBkYXRhIHN0b3JlIGFuZAogICAgICogaW5kZXBlbmRlbnQJb2YgdGhl\nIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICogPGxpPntAbGlu\nayAjSURfQVBQTElDQVRJT059OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBh\ncHBsaWNhdGlvbiBhbmQKICAgICAqIGRlZmluZWQgYnkgb25lIG9yIG1vcmUg\nZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8L3VsPiBJZiB1\nbnNwZWNpZmllZCwgZGVmYXVsdHMgdG8ge0BsaW5rICNJRF9EQVRBU1RPUkV9\nIGlmIHRoZXJlIGFyZSBubwogICAgICogcHJpbWFyeSBrZXkgZmllbGRzLCBh\nbmQge0BsaW5rICNJRF9BUFBMSUNBVElPTn0gb3RoZXJ3aXNlLgogICAgICov\nCiAgICBwdWJsaWMgaW50IGdldElkZW50aXR5VHlwZSgpIHsKICAgICAgICBp\nZiAoX2lkZW50aXR5ID09IElEX1VOS05PV04pIHsKICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwog\nICAgICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5\nVHlwZSgpICE9IElEX1VOS05PV04pCiAgICAgICAgICAgICAgICBfaWRlbnRp\ndHkgPSBzdXAuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKGdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGggPiAwKQogICAgICAg\nICAgICAgICAgX2lkZW50aXR5ID0gSURfQVBQTElDQVRJT047CiAgICAgICAg\nICAgIGVsc2UgaWYgKGlzTWFwcGVkKCkpCiAgICAgICAgICAgICAgICBfaWRl\nbnRpdHkgPSBJRF9EQVRBU1RPUkU7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIF9pZGVudGl0eSA9IF9yZXBvcy5nZXRNZXRhRGF0YUZhY3Rv\ncnkoKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIGdldERl\nZmF1bHRJZGVudGl0eVR5cGUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9pZGVudGl0eTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0eXBlIG9m\nIGlkZW50aXR5IGJlaW5nIHVzZWQuIFRoaXMgd2lsbCBiZSBvbmUgb2Y6CiAg\nICAgKiA8dWw+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9VTktOT1dOfTogdW5r\nbm93biBpZGVudGl0eSB0eXBlPC9saT4KICAgICAqIDxsaT57QGxpbmsgI0lE\nX0RBVEFTVE9SRX06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGRhdGEgc3Rv\ncmUgYW5kCiAgICAgKiBpbmRlcGVuZGVudAlvZiB0aGUgZmllbGRzIG9mIHRo\nZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9BUFBMSUNB\nVElPTn06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGFwcGxpY2F0aW9uIGFu\nZAogICAgICogZGVmaW5lZCBieSBvbmUgb3IgbW9yZSBmaWVsZHMgb2YgdGhl\nIGluc3RhbmNlPC9saT4KICAgICAqIDwvdWw+IElmIHVuc3BlY2lmaWVkLCBk\nZWZhdWx0cyB0byB7QGxpbmsgI0lEX0RBVEFTVE9SRX0gaWYgdGhlcmUgYXJl\nIG5vCiAgICAgKiBwcmltYXJ5IGtleSBmaWVsZHMsIGFuZCB7QGxpbmsgI0lE\nX0FQUExJQ0FUSU9OfSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldElkZW50aXR5VHlwZShpbnQgdHlwZSkgewogICAgICAgIF9pZGVu\ndGl0eSA9IHR5cGU7CiAgICAgICAgaWYgKHR5cGUgIT0gSURfQVBQTElDQVRJ\nT04pIHsKICAgICAgICAgICAgX29iamVjdElkID0gbnVsbDsKICAgICAgICAg\nICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG1ldGFkYXRhLXNwZWNpZmllZCBjbGFzcyB0byB1c2Ug\nZm9yIHRoZSBvYmplY3QgSUQuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzczw/\nPiBnZXRPYmplY3RJZFR5cGUoKSB7CiAgICAgICAgLy8gaWYgdGhpcyBlbnRp\ndHkgZG9lcyBub3QgdXNlIElkQ2xhc3MgZnJvbSB0aGUgcGFyZW50IGVudGl0\neSwKICAgICAgICAvLyBqdXN0IHJldHVybiB0aGUgX29iamVjdElkIHNldCBk\ndXJpbmcgYW5ub3RhdGlvbiBwYXJzaW5nIHRpbWUuCiAgICAgICAgaWYgKCF1\nc2VJZENsYXNzRnJvbVBhcmVudCgpKSB7CiAgICAgICAgICAgIGlmIChfb2Jq\nZWN0SWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0\nSWQ7CiAgICAgICAgfSAKICAgICAgICAKICAgICAgICAvLyBpZiB0aGlzIGVu\ndGl0eSB1c2VzIElkQ2xhc3MgZnJvbSB0aGUgcGFyZW50IGVudGl0eSwKICAg\nICAgICAvLyB0aGUgX29iamVjdElkIHNldCBkdXJpbmcgdGhlIHBhcnNpbmcg\ndGltZSBzaG91bGQgYmUKICAgICAgICAvLyBpZ25vcmVkLCBhbmQgbGV0IHRo\nZSBzeXN0ZW0gZGV0ZXJtaW5lIHRoZSBvYmplY3RJZCB0eXBlCiAgICAgICAg\nLy8gb2YgdGhpcyBlbnRpdHkuCiAgICAgICAgaWYgKGdldElkZW50aXR5VHlw\nZSgpICE9IElEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5n\nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOKSB7CiAgICAgICAgICAg\nIF9vYmplY3RJZCA9IHN1cC5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAg\nICAgcmV0dXJuIF9vYmplY3RJZDsKICAgICAgICB9CgogICAgICAgIC8vIGZp\nZ3VyZSBvdXQgT3BlbkpQQSBpZGVudGl0eSB0eXBlIGJhc2VkIG9uIHByaW1h\ncnkga2V5IGZpZWxkCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IGdl\ndFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAocGtzLmxlbmd0aCAh\nPSAxKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBzd2l0Y2gg\nKHBrc1swXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkgewogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9\nIEJ5dGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9\nIENoYXJJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0\nSWQgPSBEb3VibGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgX29i\namVjdElkID0gRmxvYXRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBfb2Jq\nZWN0SWQgPSBJbnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgIF9vYmpl\nY3RJZCA9IExvbmdJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgX29i\namVjdElkID0gU2hvcnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAg\nICAgICAgICBfb2JqZWN0SWQgPSBTdHJpbmdJZC5jbGFzczsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRF\nOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gRGF0ZUlkLmNsYXNzOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk9JRDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgog\nICAgICAgICAgICAgICAgX29iamVjdElkID0gT2JqZWN0SWQuY2xhc3M7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEJp\nZ0RlY2ltYWxJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAg\nICAgICAgX29iamVjdElkID0gQmlnSW50ZWdlcklkLmNsYXNzOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb2Jq\nZWN0SWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEtc3Bl\nY2lmaWVkIGNsYXNzIHRvIHVzZSBmb3IgdGhlIG9iamVjdCBJRC4KICAgICAq\nIFdoZW4gdGhlcmUgaXMgSWRDbGFzcyBhbm5vdGF0aW9uLCBBbm5vdGF0aW9u\nTWV0YURhdGFQYXJzZXIKICAgICAqIHdpbGwgY2FsbCB0aGlzIG1ldGhvZCB0\nbyBzZXQgT2JqZWN0SWQgdHlwZS4gSG93ZXZlciwgaWYgCiAgICAgKiB0aGlz\nIGlzIGEgZGVyaXZlZCBpZGVudGl0eSBpbiB0aGUgY2hpbGQgZW50aXR5IHdo\nZXJlIGEgCiAgICAgKiByZWxhdGlvbiBmaWVsZCAocGFyZW50IGVudGl0eSkg\naXMgdXNlZCBhcyBhbiBpZCwgYW5kIHRoaXMgCiAgICAgKiByZWxhdGlvbiBm\naWVsZCBoYXMgYW4gSWRDbGFzcywgdGhlIElkQ2xhc3MgYW5ub3RhdGlvbiBp\nbiAKICAgICAqIHRoZSBjaGlsZCBlbnRpdHkgY2FuIGJlIGlnbm9yZWQgYXMg\nT3BlbmpwYSB3aWxsIGF1dG9tYXRpY2FsbHkgICAKICAgICAqIHdyYXAgcGFy\nZW50J3MgSWRDbGFzcyBhcyBjaGlsZCdzIElkQ2xhc3MuIAogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRPYmplY3RJZFR5cGUoQ2xhc3M8Pz4gY2xzLCBi\nb29sZWFuIHNoYXJlZCkgewogICAgICAgIF9vYmplY3RJZCA9IG51bGw7CiAg\nICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgX29iamVjdElkU2hh\ncmVkID0gbnVsbDsKICAgICAgICBpZiAoY2xzICE9IG51bGwpIHsKICAgICAg\nICAgICAgLy8gZG9uJ3QgbGV0IHBlb3BsZSBhc3NpZ24gT3BlbkpQQUlkIHR5\ncGVzOyBzYWZlciB0byBjYWxjdWxhdGUgaXQKICAgICAgICAgICAgLy8gb3Vy\nc2VsdmVzCiAgICAgICAgICAgIHNldElkZW50aXR5VHlwZShJRF9BUFBMSUNB\nVElPTik7CiAgICAgICAgICAgIGlmICghT3BlbkpQQUlkLmNsYXNzLmlzQXNz\naWduYWJsZUZyb20oY2xzKSkgewogICAgICAgICAgICAgICAgX29iamVjdElk\nID0gY2xzOwogICAgICAgICAgICAgICAgX29iamVjdElkU2hhcmVkID0gKHNo\nYXJlZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGlzIHR5cGUgdXNlcyBhbiBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFz\ncyB0aGF0IGlzIHNoYXJlZAogICAgICogd2l0aCBvdGhlciBjbGFzc2VzLCBh\nbmQgaXMgdGhlcmVmb3JlIHdyYXBwZWQgaW4gYW4ge0BsaW5rIE9iamVjdElk\nfS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNPYmplY3RJZFR5cGVT\naGFyZWQoKSB7CiAgICAgICAgaWYgKF9vYmplY3RJZFNoYXJlZCAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gX29iamVjdElkU2hhcmVkLmJvb2xlYW5W\nYWx1ZSgpOwogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuaXNPYmplY3RJ\nZFR5cGVTaGFyZWQoKTsKICAgICAgICByZXR1cm4gaXNPcGVuSlBBSWRlbnRp\ndHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyB0eXBl\nIHVzZXMgT3BlbkpQQSBpZGVudGl0eS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gaXNPcGVuSlBBSWRlbnRpdHkoKSB7CiAgICAgICAgaWYgKF9vcGVu\nanBhSWQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzczw/PiBjbHMgPSBn\nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAgaWYgKGNscyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBf\nb3BlbmpwYUlkID0gKE9wZW5KUEFJZC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9t\nKGNscykpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICA6IEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb3BlbmpwYUlk\nLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0\ncmF0ZWd5IHRvIHVzZSBmb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdlbmVyYXRp\nb24uCiAgICAgKiBPbmUgb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtAbGluayBW\nYWx1ZVN0cmF0ZWdpZXN9LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldElk\nZW50aXR5U3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKGdldElkZW50aXR5VHlw\nZSgpID09IElEX0RBVEFTVE9SRQogICAgICAgICAgICAmJiBfaWRTdHJhdGVn\neSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkgewogICAgICAgICAgICBDbGFz\nc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAg\nICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlU\neXBlKCkgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIF9pZFN0cmF0\nZWd5ID0gc3VwLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kgPSBWYWx1ZVN0cmF0\nZWdpZXMuTkFUSVZFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2lkU3Ry\nYXRlZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdG8g\ndXNlIGZvciBkYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJhdGlvbi4KICAgICAq\nIE9uZSBvZiB0aGUgY29uc3RhbnRzIGZyb20ge0BsaW5rIFZhbHVlU3RyYXRl\nZ2llc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElkZW50aXR5U3Ry\nYXRlZ3koaW50IHN0cmF0ZWd5KSB7CiAgICAgICAgX2lkU3RyYXRlZ3kgPSBz\ndHJhdGVneTsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gVmFsdWVTdHJhdGVn\naWVzLlNFUVVFTkNFKQogICAgICAgICAgICBzZXRJZGVudGl0eVNlcXVlbmNl\nTmFtZShudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkYXRhc3Rv\ncmUgaWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBmb3Igbm9uZS4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJZGVudGl0eVNlcXVlbmNl\nTmFtZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9z\nZXFOYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfc2VxTmFtZSA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgX3NlcU5hbWUgPSBudWxsOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gX3NlcU5hbWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNlIG5hbWUsIG9y\nIG51bGwgZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElk\nZW50aXR5U2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1lKSB7CiAgICAgICAg\nX3NlcU5hbWUgPSBzZXFOYW1lOwogICAgICAgIF9zZXFNZXRhID0gbnVsbDsK\nICAgICAgICBpZiAoc2VxTmFtZSAhPSBudWxsKQogICAgICAgICAgICBzZXRJ\nZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBmb3IgdGhlIGRhdGFzdG9y\nZSBpZGVudGl0eSBzZXF1ZW5jZS4KICAgICAqLwogICAgcHVibGljIFNlcXVl\nbmNlTWV0YURhdGEgZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRhKCkgewog\nICAgICAgIGlmIChfc2VxTWV0YSA9PSBudWxsICYmIGdldElkZW50aXR5U2Vx\ndWVuY2VOYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAgX3NlcU1ldGEgPSBf\ncmVwb3MuZ2V0U2VxdWVuY2VNZXRhRGF0YSh0aGlzLAogICAgICAgICAgICAg\nICAgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSwgdHJ1ZSk7CiAgICAgICAg\ncmV0dXJuIF9zZXFNZXRhOwogICAgfQoKICAgIC8qKgogICAgICogSW5mb3Jt\nYXRpb24gYWJvdXQgbGlmZWN5Y2xlIGNhbGxiYWNrcyBmb3IgdGhpcyBjbGFz\ncy4KICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZU1ldGFEYXRhIGdldExp\nZmVjeWNsZU1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbGlmZU1ldGE7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBhbGlhcyBmb3Ig\ndGhlIGRlc2NyaWJlZCB0eXBlLCBvciA8Y29kZT5udWxsPC9jb2RlPiBpZiBu\nb25lCiAgICAgKiBoYXMgYmVlbiBzZXQuCiAgICAgKiAKICAgICAqIEBzZWUg\nI3NldFR5cGVBbGlhcwogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5\ncGVBbGlhcygpIHsKICAgICAgICBpZiAoX2FsaWFzID09IG51bGwpCiAgICAg\nICAgICAgIF9hbGlhcyA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKF90eXBlKTsK\nICAgICAgICByZXR1cm4gX2FsaWFzOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0cyB0aGUgYWxpYXMgZm9yIHRoZSBkZXNjcmliZWQgdHlwZS4gVGhlIGFs\naWFzIGNhbiBiZQogICAgICogYW55IGFyYml0cmFyeSBzdHJpbmcgdGhhdCB0\naGUgaW1wbGVtZW50YXRpb24gY2FuIGxhdGVyIHVzZSB0bwogICAgICogcmVm\nZXIgdG8gdGhlIGNsYXNzLiBOb3RlIHRoYXQgYXQgcnVudGltZSwgb25seSB0\naGUgYWxpYXMKICAgICAqIGNvbXB1dGVkIHdoZW4gdGhlIHBlcnNpc3RlbnQg\ndHlwZSB3YXMgZW5oYW5jZWQgaXMgdXNlZC4KICAgICAqCiAgICAgKiBAcGFy\nYW0gYWxpYXMgdGhlIGFsaWFzIG5hbWUgdG8gYXBwbHkgdG8gdGhlIGRlc2Ny\naWJlZCB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFR5cGVBbGlh\ncyhTdHJpbmcgYWxpYXMpIHsKICAgICAgICBfYWxpYXMgPSBhbGlhczsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2VkIGJ5IHRo\naXMgY2xhc3MuIAogICAgICogCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nQWNjZXNzVHlwZSgpIHsKICAgICAgICByZXR1cm4gX2FjY2Vzc1R5cGU7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB0aGUgYWNjZXNzIHR5cGUu\nIAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBY2Nlc3NUeXBlKGludCB0\neXBlKSB7CiAgICAJaWYgKHR5cGUgPT0gX2FjY2Vzc1R5cGUgfHwgdHlwZSA9\nPSBBY2Nlc3NDb2RlLlVOS05PV04pCiAgICAJCXJldHVybjsKICAgIAlpZiAo\nIUFjY2Vzc0NvZGUuaXNWYWxpZENsYXNzQ29kZSh0eXBlKSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJhY2Nlc3MtdHlwZS1pbnZhbGlkIiwgCiAgICAJCSAgICB0aGlzLCBB\nY2Nlc3NDb2RlLnRvQ2xhc3NTdHJpbmcodHlwZSkpLmdldE1lc3NhZ2UoKSk7\nCiAgICAJfQogICAgCWlmIChfYWNjZXNzVHlwZSAhPSBBY2Nlc3NDb2RlLlVO\nS05PV04pIHsgLy8gY2hhbmdpbmcgYWNjZXNzIHR5cGUKICAgIAkgICAgX3Jl\ncG9zLmdldExvZygpLnRyYWNlKF9sb2MuZ2V0KCJhY2Nlc3MtdHlwZS1jaGFu\nZ2UiLCAKICAgIAkJICAgIHRoaXMsIEFjY2Vzc0NvZGUudG9DbGFzc1N0cmlu\nZyh0eXBlKSwgCiAgICAJCSAgICBBY2Nlc3NDb2RlLnRvQ2xhc3NTdHJpbmco\nX2FjY2Vzc1R5cGUpKS5nZXRNZXNzYWdlKCkpOwogICAgCX0KICAgICAgICBf\nYWNjZXNzVHlwZSA9IHR5cGU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nQXNzZXJ0cyB0aGUgdGhlIGdpdmVuIGZpZWxkICh3aGljaCBtdXN0IGJlbG9u\nZyB0byB0aGlzIHJlY2VpdmVyKQogICAgICogY2FuIGJlIHNldCB0byB0aGUg\nZ2l2ZW4gYWNjZXNzIGNvZGUuIElmIHRoZSBmaWVsZCBjb2RlIGlzIGFsbG93\nZWQsCiAgICAgKiBpdCBtYXkgaGF2ZSB0aGUgc2lkZS1lZmZlY3Qgb2YgY2hh\nbmdpbmcgdGhlIGFjY2VzcyBjb2RlIG9mIHRoaXMgcmVjZWl2ZXIuCiAgICAg\nKi8KICAgIHZvaWQgbWVyZ2VGaWVsZEFjY2VzcyhGaWVsZE1ldGFEYXRhIGZt\nZCwgaW50IGZDb2RlKSB7CiAgICAJc2V0QWNjZXNzVHlwZShBY2Nlc3NDb2Rl\nLm1lcmdlRmllbGRDb2RlKHRoaXMsIGZtZCwgZkNvZGUpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFmZmlybXMgaWYgYWNjZXNzIHN0eWxlIGlzIGV4cGxp\nY2l0bHkgZGVmaW5lZC4KICAgICAqLyAgICAKICAgIHB1YmxpYyBib29sZWFu\nIGlzRXhwbGljaXRBY2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuIEFjY2Vzc0Nv\nZGUuaXNFeHBsaWNpdChfYWNjZXNzVHlwZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZmZpcm1zIGlmIGF0dHJpYnV0ZXMgb2YgdGhpcyBjbGFzcyB1c2Ug\nbWl4ZWQgYWNjZXNzIHR5cGVzLgogICAgICovICAgIAogICAgcHVibGljIGJv\nb2xlYW4gaXNNaXhlZEFjY2VzcygpIHsKICAgIAlyZXR1cm4gQWNjZXNzQ29k\nZS5pc01peGVkKF9hY2Nlc3NUeXBlKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHRoZSB0eXBlIHJlcXVpcmVzIGV4dGVudCBtYW5hZ2Vt\nZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXF1aXJlc0V4\ndGVudCgpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51bGwgfHwgaXNFbWJl\nZGRlZE9ubHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICBpZiAoX2V4dGVudCA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAg\nICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICAgICAgX2V4dGVu\ndCA9IChzdXAuZ2V0UmVxdWlyZXNFeHRlbnQoKSkgPyBCb29sZWFuLlRSVUUK\nICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIF9leHRlbnQgPSBCb29sZWFuLlRS\nVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZXh0ZW50LmJvb2xlYW5W\nYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlw\nZSByZXF1aXJlcyBleHRlbnQgbWFuYWdlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0UmVxdWlyZXNFeHRlbnQoYm9vbGVhbiByZXEpIHsKICAg\nICAgICBfZXh0ZW50ID0gKHJlcSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlw\nZSBjYW4gb25seSBiZSB1c2VkIGFzIGFuIGVtYmVkZGVkIG9iamVjdC4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNFbWJlZGRlZE9ubHkoKSB7CiAg\nICAgICAgaWYgKF9lbWJlZGRlZCA9PSBudWxsKSB7CiAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2VtYmVkZGVkID0gKHN1cC5pc0VtYmVkZGVkT25seSgpKSA/IEJvb2xlYW4u\nVFJVRQogICAgICAgICAgICAgICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2VtYmVkZGVkID0gQm9v\nbGVhbi5GQUxTRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9lbWJlZGRl\nZC5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIHR5cGUgY2FuIG9ubHkgYmUgdXNlZCBhcyBhbiBlbWJlZGRlZCBv\nYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVtYmVkZGVkT25s\neShib29sZWFuIGVtYmVkKSB7CiAgICAgICAgX2VtYmVkZGVkID0gKGVtYmVk\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkYWJsZSgpIHsKICAgICAgICBy\nZXR1cm4gX2VtYmVkZGFibGU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lk\nIHNldEVtYmVkZGFibGUoKSB7CiAgICAgICAgX2VtYmVkZGFibGUgPSB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSdzIGZp\nZWxkcyBhcmUgYWN0aXZlbHkgaW50ZXJjZXB0ZWQsIGVpdGhlciBieQogICAg\nICogcmVkZWZpbml0aW9uIG9yIGVuaGFuY2VtZW50LgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0ludGVyY2VwdGluZygpIHsKICAgICAgICByZXR1\ncm4gX2ludGVyY2VwdGluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIHR5cGUncyBmaWVsZHMgYXJlIGFjdGl2ZWx5IGludGVyY2VwdGVk\nLCBlaXRoZXIgYnkKICAgICAqIHJlZGVmaW5pdGlvbiBvciBlbmhhbmNlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50ZXJjZXB0aW5nKGJv\nb2xlYW4gaW50ZXJjZXB0aW5nKSB7CiAgICAgICAgX2ludGVyY2VwdGluZyA9\nIGludGVyY2VwdGluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhlIHR5cGUgaXMgYSBtYW5hZ2VkIGludGVyZmFjZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNNYW5hZ2VkSW50ZXJmYWNlKCkgewogICAgICAg\nIGlmICghX3R5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIHJldHVybiBfaW50ZXJmYWNlID09IG51bGwgPyBm\nYWxzZSA6IF9pbnRlcmZhY2UuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIGlzIGEgbWFuYWdlZCBpbnRl\ncmZhY2UKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWFuYWdlZEludGVy\nZmFjZShib29sZWFuIG1hbmFnZWRJbnRlcmZhY2UpIHsKICAgICAgICBpZiAo\nIV90eXBlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWludGVyZmFjZSIsIF90\neXBlKSk7CiAgICAgICAgX2ludGVyZmFjZSA9IG1hbmFnZWRJbnRlcmZhY2Ug\nPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBt\nYW5hZ2VkIGludGVyZmFjZXMgYWx3YXlzIGRvIHByb3BlciBpbnRlcmNlcHRp\nb247IE9wZW5KUEEgZ2VuZXJhdGVzCiAgICAgICAgLy8gdGhlIGltcGxlbWVu\ndGF0aW9ucy4KICAgICAgICBpZiAoaXNNYW5hZ2VkSW50ZXJmYWNlKCkpCiAg\nICAgICAgICAgIHNldEludGVyY2VwdGluZyh0cnVlKTsKCiAgICAgICAgLy8g\nbWFuYWdlZCBpbnRlcmZhY2VzIGFsd2F5cyB1c2UgcHJvcGVydHkgYWNjZXNz\nLgogICAgICAgIHNldEFjY2Vzc1R5cGUoQWNjZXNzQ29kZS5QUk9QRVJUWSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1hbmFnZWQgaW50\nZXJmYWNlIGltcGxlbWVudG9yIGlmIGFueS4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzPD8+IGdldEludGVyZmFjZUltcGwoKSB7CiAgICAgICAgcmV0dXJu\nIF9pbXBsOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtYW5hZ2Vk\nIGludGVyZmFjZSBpbXBsZW1lbnRvciBjbGFzcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0SW50ZXJmYWNlSW1wbChDbGFzczw/PiBpbXBsKSB7CiAg\nICAgICAgX2ltcGwgPSBpbXBsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGFsbCBleHBsaWNpdGx5IGRlY2xhcmVkIGludGVyZmFjZXMgdGhpcyBj\nbGFzcyBpbXBsZW1lbnRzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3M8Pz5b\nXSBnZXREZWNsYXJlZEludGVyZmFjZXMoKSB7CiAgICAgICAgaWYgKF9pbnRl\ncmZhY2VzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNZXRhRGF0YVJl\ncG9zaXRvcnkuRU1QVFlfQ0xBU1NFUzsKICAgICAgICByZXR1cm4gKENsYXNz\nW10pIF9pbnRlcmZhY2VzLnRvQXJyYXkobmV3IENsYXNzW19pbnRlcmZhY2Vz\nLnNpemUoKV0pOwogICAgfQoKICAgIC8qKgogICAgICogRXhwbGljaXRseSBk\nZWNsYXJlIHRoZSBnaXZlbiBpbnRlcmZhY2UgYW1vbmcgdGhlIG9uZXMgdGhp\ncwogICAgICogY2xhc3MgaW1wbGVtZW50cy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgYWRkRGVjbGFyZWRJbnRlcmZhY2UoQ2xhc3M8Pz4gaWZhY2UpIHsK\nICAgICAgICBpZiAoaWZhY2UgPT0gbnVsbCB8fCAhaWZhY2UuaXNJbnRlcmZh\nY2UoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJkZWNsYXJlLW5vbi1pbnRlcmZhY2UiLAogICAgICAgICAg\nICAgICAgdGhpcywgaWZhY2UpKTsKICAgICAgICBpZiAoX2ludGVyZmFjZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgX2ludGVyZmFjZXMgPSBuZXcgQXJyYXlM\naXN0PENsYXNzPD8+PigpOwogICAgICAgIF9pbnRlcmZhY2VzLmFkZChpZmFj\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIGlu\ndGVyZmFjZSBmcm9tIHRoZSBkZWNsYXJlZCBsaXN0LgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiByZW1vdmVEZWNsYXJlZEludGVyZmFjZShDbGFzczw/\nPiBpZmFjZSkgewogICAgICAgIGlmIChfaW50ZXJmYWNlcyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9pbnRl\ncmZhY2VzLnJlbW92ZShpZmFjZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nbGlhcyBwcm9wZXJ0aWVzIGZyb20gdGhlIGdpdmVuIGludGVyZmFjZSBkdXJp\nbmcgIHF1ZXJpZXMgdG8KICAgICAqIHRoZSBsb2NhbCBmaWVsZC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0SW50ZXJmYWNlUHJvcGVydHlBbGlhcyhD\nbGFzczw/PiBpZmFjZSwgU3RyaW5nIG9yaWcsIAogICAgICAgIFN0cmluZyBs\nb2NhbCkgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAg\nICAgICAgICAgIE1hcDxTdHJpbmcsU3RyaW5nPiBmaWVsZHMgPSBfaWZhY2VN\nYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBmaWVsZHMgPSBuZXcgSGFzaE1hcDxTdHJp\nbmcsU3RyaW5nPigpOwogICAgICAgICAgICAgICAgX2lmYWNlTWFwLnB1dChp\nZmFjZSwgZmllbGRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAo\nZmllbGRzLmNvbnRhaW5zS2V5KG9yaWcpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXBsaWNhdGUt\naWZhY2UtYWxpYXMiLCAKICAgICAgICAgICAgICAgICAgICB0aGlzLCBvcmln\nLCBsb2NhbCkpOwogICAgICAgICAgICBmaWVsZHMucHV0KG9yaWcsIGxvY2Fs\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0IGxv\nY2FsIGZpZWxkIGFsaWFzIGZvciB0aGUgZ2l2ZW4gaW50ZXJmYWNlIHByb3Bl\ncnR5LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEludGVyZmFjZVBy\nb3BlcnR5QWxpYXMoQ2xhc3M8Pz4gaWZhY2UsIFN0cmluZyBvcmlnKSB7CiAg\nICAgICAgc3luY2hyb25pemVkIChfaWZhY2VNYXApIHsKICAgICAgICAgICAg\nTWFwPFN0cmluZyxTdHJpbmc+IGZpZWxkcyA9IF9pZmFjZU1hcC5nZXQoaWZh\nY2UpOwogICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIGZpZWxk\ncy5nZXQob3JpZyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFJldHVybiBhbGwgYWxpYXNlcyBwcm9wZXJ0eSBuYW1lZCBmb3IgdGhl\nIGdpdmVuIGludGVyZmFjZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1td\nIGdldEludGVyZmFjZUFsaWFzZWRQcm9wZXJ0aWVzKENsYXNzPD8+IGlmYWNl\nKSB7CiAgICAgICAgc3luY2hyb25pemVkIChfaWZhY2VNYXApIHsKICAgICAg\nICAgICAgTWFwPFN0cmluZyxTdHJpbmc+IGZpZWxkcyA9IF9pZmFjZU1hcC5n\nZXQoaWZhY2UpOwogICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gRU1QVFlfU1RSSU5HX0FSUkFZOwogICAg\nICAgICAgICByZXR1cm4gZmllbGRzLmtleVNldCgpLnRvQXJyYXkobmV3IFN0\ncmluZ1tmaWVsZHMuc2l6ZSgpXSk7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIGZpZWxkcyB0aGF0\nIHVzZSBpbXBsIG9yIGludGVybWVkaWF0ZSBkYXRhLCBpbgogICAgICogb3Jk\nZXIgdG8gY3JlYXRlIGEgY29tcGFjdGVkIGFycmF5IGZvciBzdG9yYWdlIG9m\nIHNhaWQgZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRFeHRyYUZp\nZWxkRGF0YUxlbmd0aCgpIHsKICAgICAgICBpbnRbXSB0YWJsZSA9IGdldEV4\ndHJhRmllbGREYXRhVGFibGUoKTsKICAgICAgICBmb3IgKGludCBpID0gdGFi\nbGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pCiAgICAgICAgICAgIGlmICh0\nYWJsZVtpXSAhPSAtMSkKICAgICAgICAgICAgICAgIHJldHVybiB0YWJsZVtp\nXSArIDE7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGludGVybWVkaWF0ZSBmaWVsZCBkYXRhIGluZGV4IG9m\nIHRoZSBnaXZlbiBmaWVsZAogICAgICogaW4gdGhlIGNvbXBhY3RlZCBhcnJh\neSwgb3IgLTEgaWYgdGhlIGZpZWxkIGRvZXMgbm90IHVzZSBleHRyYSBkYXRh\nLgogICAgICoKICAgICAqIEBzZWUgI2dldEV4dHJhRmllbGREYXRhTGVuZ3Ro\nCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RXh0cmFGaWVsZERhdGFJbmRl\neChpbnQgZmllbGQpIHsKICAgICAgICBpbnRbXSBhcnJheSA9IGdldEV4dHJh\nRmllbGREYXRhVGFibGUoKTsKICAgICAgICBpZiAoZmllbGQgPCAwIHx8IGZp\nZWxkID49IGFycmF5Lmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIC0xOwog\nICAgICAgIHJldHVybiBhcnJheVtmaWVsZF07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGVzIGEgdGFibGUgbWFwcGluZyBlYWNoIGZpZWxkIGluZGV4\nIHRvIGl0cyBleHRyYSBkYXRhIGluZGV4LgogICAgICovCiAgICBwcml2YXRl\nIGludFtdIGdldEV4dHJhRmllbGREYXRhVGFibGUoKSB7CiAgICAgICAgaWYg\nKF9maWVsZERhdGFUYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGlu\ndFtdIHRhYmxlID0gbmV3IGludFtmbWRzLmxlbmd0aF07CiAgICAgICAgICAg\nIGludCBpZHggPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmbWRz\nW2ldLnVzZXNJbnRlcm1lZGlhdGUoKQogICAgICAgICAgICAgICAgICAgIHx8\nIGZtZHNbaV0udXNlc0ltcGxEYXRhKCkgIT0gQm9vbGVhbi5GQUxTRSkKICAg\nICAgICAgICAgICAgICAgICB0YWJsZVtpXSA9IGlkeCsrOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRhYmxlW2ldID0gLTE7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0g\ndGFibGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZmllbGREYXRhVGFi\nbGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUg\nZ2l2ZW4gbmFtZSByZXByZXNlbnRzIGEgbWFuYWdlZCBvciBzdGF0aWMgZmll\nbGQgb2YKICAgICAqIHRoaXMgY2xhc3MsIGluY2x1ZGluZyBzdXBlcmNsYXNz\nIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNBY2Nlc3Np\nYmxlRmllbGQoU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGdldERlY2xh\ncmVkRmllbGQoZmllbGQpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGlmIChfc3RhdGljRmllbGRzID09IG51bGwpIHsKICAg\nICAgICAgICAgRmllbGRbXSBmaWVsZHMgPSAoRmllbGRbXSkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXREZWNsYXJlZEZpZWxkc0FjdGlvbihfdHlwZSkpOyAKICAg\nICAgICAgICAgU2V0PFN0cmluZz4gbmFtZXMgPSBuZXcgSGFzaFNldDxTdHJp\nbmc+KCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlz\nU3RhdGljKGZpZWxkc1tpXS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAg\nICAgICAgICAgbmFtZXMuYWRkKGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAg\nICAgICAgICBfc3RhdGljRmllbGRzID0gbmFtZXM7CiAgICAgICAgfQogICAg\nICAgIGlmIChfc3RhdGljRmllbGRzLmNvbnRhaW5zKGZpZWxkKSkKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKS5pc0FjY2Vzc2libGVGaWVsZChmaWVsZCk7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmaWVsZCBt\nZXRhZGF0YSwgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLgogICAgICov\nCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldEZpZWxkcygpIHsKICAg\nICAgICBpZiAoX2FsbEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlm\nIChfc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hbGxGaWVsZHMg\nPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXREZWNs\nYXJlZEZpZWxkcygpOwogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIHN1cEZpZWxkcyA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAg\nICAgICAgICAgICAgICAgZ2V0RmllbGRzKCk7CgogICAgICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGFsbEZpZWxkcyA9IF9yZXBvcy5uZXdGaWVsZE1l\ndGFEYXRhQXJyYXkKICAgICAgICAgICAgICAgICAgICAoZmllbGRzLmxlbmd0\naCArIHN1cEZpZWxkcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVt\nLmFycmF5Y29weShzdXBGaWVsZHMsIDAsIGFsbEZpZWxkcywgMCwgc3VwRmll\nbGRzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICByZXBsYWNlRGVmaW5lZFN1\ncGVyY2xhc3NGaWVsZHMoYWxsRmllbGRzLCBzdXBGaWVsZHMubGVuZ3RoKTsK\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5z\nZXRJbmRleChzdXBGaWVsZHMubGVuZ3RoICsgaSk7CiAgICAgICAgICAgICAg\nICAgICAgYWxsRmllbGRzW3N1cEZpZWxkcy5sZW5ndGggKyBpXSA9IGZpZWxk\nc1tpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9hbGxG\naWVsZHMgPSBhbGxGaWVsZHM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9hbGxGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXBsYWNlIHN1cGVyY2xhc3MgZmllbGRzIHRoYXQgd2UgZGVmaW5lIHdp\ndGggb3VyIHZlcnNpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXBs\nYWNlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoRmllbGRNZXRhRGF0YVtdIGZp\nZWxkcywKICAgICAgICBpbnQgbGVuKSB7CiAgICAgICAgaWYgKF9zdXBGaWVs\nZE1hcCA9PSBudWxsIHx8ICFfZGVmU3VwRmllbGRzKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIC8vIGRvbid0IGFzc3VtZSBmaWVsZHMgYXJlIGlu\nIG9yZGVyOyB0aGlzIG1ldGhvZCBpcyB1c2VkIGZvcgogICAgICAgIC8vIGxp\nc3Rpbmcgb3JkZXIgYXMgd2VsbAogICAgICAgIEZpZWxkTWV0YURhdGEgc3Vw\nRmllbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykg\newogICAgICAgICAgICBzdXBGaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBfc3Vw\nRmllbGRNYXAuZ2V0KGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAg\nICBpZiAoc3VwRmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmll\nbGRzW2ldID0gc3VwRmllbGQ7CiAgICAgICAgICAgICAgICBzdXBGaWVsZC5z\nZXRJbmRleChpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgc3VwZXJjbGFzcyBjb3B5IG9mIHRo\nZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWV0\nYURhdGEgZ2V0U3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURhdGEgc3VwRmll\nbGQpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHNtID0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHNt\nID09IG51bGwgPyBudWxsIDogc20uZ2V0RmllbGQoc3VwRmllbGQuZ2V0TmFt\nZSgpKTsKICAgICAgICBpZiAoZm1kID09IG51bGwgCiAgICAgICAgfHwgZm1k\nLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJT\nSVNURU5UKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoInVubWFuYWdlZC1zdXAtZmllbGQiLAogICAgICAgICAg\nICAgICAgc3VwRmllbGQsIHRoaXMpKTsKICAgICAgICByZXR1cm4gZm1kOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIG9ubHkgdGhlIGZpZWxkcyBm\nb3IgdGhpcyBjbGFzcywgd2l0aG91dCBzdXBlcmNsYXNzIGZpZWxkcy4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJlZEZp\nZWxkcygpIHsKICAgICAgICBpZiAoX2ZpZWxkcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIExpc3Q8RmllbGRNZXRhRGF0YT4gZmllbGRzID0gCiAgICAgICAg\nICAgIAluZXcgQXJyYXlMaXN0PEZpZWxkTWV0YURhdGE+KF9maWVsZE1hcC5z\naXplKCkpOwogICAgICAgICAgICA7CiAgICAgICAgICAgIGZvciAoRmllbGRN\nZXRhRGF0YSBmbWQgOiBfZmllbGRNYXAudmFsdWVzKCkpIHsKICAgICAgICAg\nICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURh\ndGEuTUFOQUdFX05PTkUpIHsKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0\nRGVjbGFyZWRJbmRleChmaWVsZHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBmbWQuc2V0SW5kZXgoZm1kLmdldERlY2xhcmVkSW5kZXgoKSk7CiAg\nICAgICAgICAgICAgICAgICAgZmllbGRzLmFkZChmbWQpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZHMgPSBm\naWVsZHMudG9BcnJheQogICAgICAgICAgICAJKF9yZXBvcy5uZXdGaWVsZE1l\ndGFEYXRhQXJyYXkoZmllbGRzLnNpemUoKSkpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX2ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBwcmltYXJ5IGtleSBmaWVsZHMsIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUu\nIFRoZSBvcmRlcgogICAgICogaW4gd2hpY2ggdGhlIGtleXMgYXJlIHJldHVy\nbmVkIHdpbGwgYmUgdGhlIG9yZGVyIGluIHdoaWNoCiAgICAgKiB0aGUgZmll\nbGRzIGFyZSBkZWNsYXJlZCwgc3RhcnRpbmcgYXQgdGhlIGxlYXN0LWRlcml2\nZWQgc3VwZXJjbGFzcwogICAgICogYW5kIGVuZGluZyB3aXRoIHRoZSBwcmlt\nYXJ5IGtleSBmaWVsZHMgb2YgdGhlIG1vc3QtZGVyaXZlZCBzdWJjbGFzcy4K\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRQcmltYXJ5\nS2V5RmllbGRzKCkgewogICAgICAgIC8vIGNoZWNrIGZvciBwcmltYXJ5IGtl\neSBmaWVsZHMgZXZlbiBpZiBub3Qgc2V0IHRvIElEX0FQUExJQ0FUSU9OIHNv\nIAogICAgICAgIC8vIHRoYXQgQXBwbGljYXRpb24gSWQgdG9vbCBzZWVzIHRo\nZW0gZXZlbiB3aGVuIHVzZXIgZG9lc24ndCBkZWNsYXJlIAogICAgCS8vIEFw\ncGxpY2F0aW9uIGlkZW50aXR5CiAgICAgICAgaWYgKF9hbGxQS0ZpZWxkcyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMg\nPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IG51bSA9IDA7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc1ByaW1hcnlLZXko\nKSkKICAgICAgICAgICAgICAgICAgICBudW0rKzsKCiAgICAgICAgICAgIGlm\nIChudW0gPT0gMCkKICAgICAgICAgICAgICAgIF9hbGxQS0ZpZWxkcyA9IF9y\nZXBvcy5FTVBUWV9GSUVMRFM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IF9yZXBvcy5uZXdGaWVs\nZE1ldGFEYXRhQXJyYXkobnVtKTsKICAgICAgICAgICAgICAgIG51bSA9IDA7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZHNb\naV0uaXNQcmltYXJ5S2V5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nZmllbGRzW2ldLnNldFByaW1hcnlLZXlJbmRleChudW0pOwogICAgICAgICAg\nICAgICAgICAgICAgICBwa3NbbnVtXSA9IGZpZWxkc1tpXTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbnVtKys7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX2FsbFBLRmllbGRz\nID0gcGtzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfYWxsUEtGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGxpc3Qgb2YgZmllbGRzIGluIHRoZSBkZWZhdWx0IGZldGNoIGdyb3Vw\nLAogICAgICogaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLCBvciBhbiBl\nbXB0eSBhcnJheSBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YVtdIGdldERlZmF1bHRGZXRjaEdyb3VwRmllbGRzKCkgewogICAg\nICAgIGlmIChfYWxsREZHRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAg\nICAgICBpbnQgbnVtID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAo\nZmllbGRzW2ldLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAg\nICAgICAgICAgIG51bSsrOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGRmZ3MgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KG51bSk7CiAg\nICAgICAgICAgIG51bSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkc1tpXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAg\nICAgICAgICAgICBkZmdzW251bSsrXSA9IGZpZWxkc1tpXTsKICAgICAgICAg\nICAgX2FsbERGR0ZpZWxkcyA9IGRmZ3M7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfYWxsREZHRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSB2ZXJzaW9uIGZpZWxkIGZvciB0aGlzIGNsYXNzLCBpZiBhbnku\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldFZlcnNpb25G\naWVsZCgpIHsKICAgICAgICBpZiAoX3ZlcnNpb25JZHggPT0gSW50ZWdlci5N\nSU5fVkFMVUUpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxk\ncyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBpbnQgaWR4ID0gLTE7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzVmVyc2lv\nbigpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIm11\nbHQtdmVycy1maWVsZHMiLCB0aGlzLCBmaWVsZHNbaWR4XSwgZmllbGRzW2ld\nKSk7CiAgICAgICAgICAgICAgICAgICAgaWR4ID0gaTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfdmVyc2lvbklkeCA9\nIGlkeDsKICAgICAgICB9CiAgICAgICAgaWYgKF92ZXJzaW9uSWR4ID09IC0x\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0\nRmllbGRzKClbX3ZlcnNpb25JZHhdOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJh\nbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gYWJzb2x1\ndGUgaW5kZXguCiAgICAgKgogICAgICogQHJldHVybiB0aGUgZmllbGQncyBt\nZXRhZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwogICAgcHVi\nbGljIEZpZWxkTWV0YURhdGEgZ2V0RmllbGQoaW50IGluZGV4KSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAg\nICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gZmllbGRzLmxlbmd0aCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxk\nc1tpbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1l\ndGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZp\nZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiByZWxhdGl2ZSBpbmRleC4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBu\ndWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRh\nRGF0YSBnZXREZWNsYXJlZEZpZWxkKGludCBpbmRleCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwog\nICAgICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gZmllbGRzLmxlbmd0\naCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZp\nZWxkc1tpbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFs\nIGZpZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBuYW1lLgogICAgICoKICAg\nICAqIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYg\nbm90IGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdl\ndEZpZWxkKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBnZXREZWNsYXJlZEZpZWxkKG5hbWUpOwogICAgICAgIGlmIChmbWQg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZtZDsKICAgICAgICBpZiAo\nX3N1cEZpZWxkTWFwICE9IG51bGwgJiYgX2RlZlN1cEZpZWxkcykgewogICAg\nICAgICAgICBmbWQgPSAoRmllbGRNZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdl\ndChuYW1lKTsKICAgICAgICAgICAgaWYgKGZtZCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZtZDsKICAgICAgICB9CiAgICAgICAgaWYgKF9z\ndXBlciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKS5nZXRGaWVsZChuYW1lKTsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRh\ndGEgZm9yIHRoZSBwZXJzaXN0ZW50IG9yIHRyYW5zYWN0aW9uYWwgZmllbGQg\nd2l0aAogICAgICogdGhlIGdpdmVuIG5hbWUsIHdpdGhvdXQgaW5jbHVkaW5n\nIHN1cGVyY2xhc3MgZmllbGRzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhl\nIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldERlY2xhcmVkRmllbGQo\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkID0g\nKEZpZWxkTWV0YURhdGEpIF9maWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAg\naWYgKGZpZWxkID09IG51bGwgfHwgZmllbGQuZ2V0TWFuYWdlbWVudCgpID09\nIEZpZWxkTWV0YURhdGEuTUFOQUdFX05PTkUpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIHJldHVybiBmaWVsZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhbnkgZmllbGRzIHRoYXQgd2VyZSBhZGRlZCBhcyBu\nb24tbWFuYWdlZC4KICAgICAqIEFsbCBvdGhlciBtZXRob2RzIHRvIGdldCBm\naWVsZHMgcmV0dXJuIG9ubHkgdGhvc2UgdGhhdCBhcmUgbWFuYWdlZC4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJlZFVu\nbWFuYWdlZEZpZWxkcygpIHsKICAgICAgICBpZiAoX3VubWdkRmllbGRzID09\nIG51bGwpIHsKICAgICAgICAgICAgTGlzdDxGaWVsZE1ldGFEYXRhPiB1bm1h\nbmFnZWQgPSBuZXcgQXJyYXlMaXN0PEZpZWxkTWV0YURhdGE+KDMpOwogICAg\nICAgICAgICA7CiAgICAgICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBmaWVs\nZCA6IF9maWVsZE1hcC52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFH\nRV9OT05FKQogICAgICAgICAgICAgICAgICAgIHVubWFuYWdlZC5hZGQoZmll\nbGQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF91bm1nZEZpZWxkcyA9\nIHVubWFuYWdlZC50b0FycmF5CiAgICAgICAgICAgICAgICAoX3JlcG9zLm5l\nd0ZpZWxkTWV0YURhdGFBcnJheSh1bm1hbmFnZWQuc2l6ZSgpKSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfdW5tZ2RGaWVsZHM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgYSBuZXcgZmllbGQgbWV0YWRhdGEgdG8gdGhpcyBj\nbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgYWRkRGVj\nbGFyZWRGaWVsZChTdHJpbmcgbmFtZSwgQ2xhc3M8Pz4gdHlwZSkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURh\ndGEobmFtZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgY2xlYXJGaWVsZENhY2hl\nKCk7CiAgICAgICAgX2ZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAgICAg\nIHJldHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhl\nIGdpdmVuIGZpZWxkIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxzZSBv\ndGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVj\nbGFyZWRGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAgaWYg\nKGZpZWxkICE9IG51bGwgJiYgX2ZpZWxkTWFwLnJlbW92ZShmaWVsZC5nZXRO\nYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJGaWVsZENhY2hl\nKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGRlZmluZWQgc3VwZXJjbGFzcyBmaWVsZCB3aXRoIHRoZSBnaXZlbiBu\nYW1lLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVs\nZE1ldGFEYXRhIGdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoRmllbGRNZXRh\nRGF0YSkgX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCBhIG5ldyBkZWZpbmVkIHN1cGVyY2xhc3MgZmllbGQgbWV0\nYWRhdGEgdG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxk\nTWV0YURhdGEgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChTdHJpbmcgbmFt\nZSwgQ2xhc3M8Pz4gdHlwZSwKICAgICAgICBDbGFzczw/PiBzdXApIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFE\nYXRhKG5hbWUsIHR5cGUsIHRoaXMpOwogICAgICAgIGZtZC5zZXREZWNsYXJp\nbmdUeXBlKHN1cCk7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAg\nICAgICAgX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgICAgIGlmIChfc3Vw\nRmllbGRNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX3N1cEZpZWxkTWFwID0g\nbmV3IEhhc2hNYXA8U3RyaW5nLEZpZWxkTWV0YURhdGE+KCk7CiAgICAgICAg\nX3N1cEZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAgICAgIHJldHVybiBm\nbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIGZp\nZWxkIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxzZSBvdGhlcndpc2UK\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAgaWYg\nKGZpZWxkICE9IG51bGwgJiYgX3N1cEZpZWxkTWFwICE9IG51bGwKICAgICAg\nICAgICAgJiYgX3N1cEZpZWxkTWFwLnJlbW92ZShmaWVsZC5nZXROYW1lKCkp\nICE9IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7\nCiAgICAgICAgICAgIF9kZWZTdXBGaWVsZHMgPSBmYWxzZTsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEluY29ycG9yYXRlIHN1cGVyY2xh\nc3MgZmllbGRzIHJlZGVmaW5lZCBpbiB0aGlzIHN1YmNsYXNzIGludG8gdGhp\ncwogICAgICogbWV0YWRhdGEuIFRoaXMgbWV0aG9kIGlzIGdlbmVyYWxseSBj\nYWxsZWQgYWZ0ZXIgbWV0YWRhdGEgaXMgcmVzb2x2ZWQKICAgICAqIGFuZCBt\nYXBwaW5nIGluZm9ybWF0aW9uIGlzIGxvYWRlZCwgYnV0IGJlZm9yZSBtYXBw\naW5nIHJlc29sdmUuCiAgICAgKgogICAgICogQHBhcmFtIGZvcmNlIHdoZXRo\nZXIgdG8gZm9yY2UgcmUtbWFwcGluZyBvZiBldmVuIG1hcHBlZCBzdXBlcmNs\nYXNzIGZpZWxkcwogICAgICovCiAgICBwdWJsaWMgdm9pZCBkZWZpbmVTdXBl\ncmNsYXNzRmllbGRzKGJvb2xlYW4gZm9yY2UpIHsKICAgICAgICBpZiAoX2Rl\nZlN1cEZpZWxkcykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFz\nc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAg\nICAgICAgaWYgKGlzTWFwcGVkKCkgJiYgc3VwICE9IG51bGwpIHsKICAgICAg\nICAgICAgLy8gcmVkZWZpbmUgYWxsIHVubWFwcGVkIHN1cGVyY2xhc3MgZmll\nbGRzCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBzID0gc3VwLmdl\ndEZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1\ncHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICgoZm9yY2Ug\nfHwgIXN1cHNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmlzTWFwcGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgJiYgZ2V0RGVmaW5lZFN1cGVyY2xhc3NG\naWVsZChzdXBzW2ldLmdldE5hbWUoKSkgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tpXS5n\nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCksIHN1cHNbaV0uZ2V0RGVjbGFyaW5nVHlwZSgpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoKTsKCiAgICAg\nICAgLy8gdGhpcyBlbnN1cmVzIHRoYXQgYWxsIGZpZWxkIGluZGV4ZXMgZ2V0\nIHNldCB3aGVuIGZpZWxkcyBhcmUgY2FjaGVkLgogICAgICAgIC8vIEkgZG9u\nJ3QgbGlrZSBkb2luZyB0aGlzIHR3aWNlIChpdCdzIGFsc28gZG9uZSBpbiBy\nZXNvbHZlTWV0YSksIGJ1dAogICAgICAgIC8vIHdlIGhhdmUgdG8gcmUtY2Fj\naGUgaW4gY2FzZSB0aGlzIGNsYXNzIG9yIGFueSBzdXBlcmNsYXNzIHJlcGxh\nY2VkCiAgICAgICAgLy8gc29tZSBmaWVsZHMgd2l0aCByZWRlZmluZWQgdmVy\nc2lvbnMsIGFuZCBJIGRvbid0IHdhbnQgb3V0c2lkZSBjb2RlCiAgICAgICAg\nLy8gdG8gaGF2ZSB0byBjYWxsIHRoaXMgbWV0aG9kIGFmdGVyIHJlc29sdmUg\nanVzdCB0byBnZXQgZmllbGQgaW5kZXhlcywKICAgICAgICAvLyBldGMgc2V0\nIGNvcnJlY3RseQogICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAg\nICAgIGNhY2hlRmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNv\nbHZlIHN1cGVyY2xhc3MgZmllbGRzIHdlJ3ZlIHJlZGVmaW5lZC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVEZWZpbmVkU3VwZXJjbGFzc0Zp\nZWxkcygpIHsKICAgICAgICBfZGVmU3VwRmllbGRzID0gdHJ1ZTsKICAgICAg\nICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBzdXA7CiAgICAgICAgZm9yIChG\naWVsZE1ldGFEYXRhIGZtZCA6IF9zdXBGaWVsZE1hcC52YWx1ZXMoKSkgewog\nICAgICAgICAgICBzdXAgPSBnZXRTdXBlcmNsYXNzRmllbGQoZm1kKTsKCiAg\nICAgICAgICAgIC8vIEpQQSBtZXRhZGF0YSBkb2Vzbid0IHF1YWxpZnkgc3Vw\nZXJjbGFzcyBmaWVsZCBuYW1lcywgc28gd2UKICAgICAgICAgICAgLy8gbWln\naHQgbm90IGtub3cgdGhlIGRlY2xhcmluZyB0eXBlIHVudGlsIG5vdwogICAg\nICAgICAgICBpZiAoZm1kLmdldERlY2xhcmluZ1R5cGUoKSA9PSBPYmplY3Qu\nY2xhc3MpIHsKICAgICAgICAgICAgICAgIGZtZC5zZXREZWNsYXJpbmdUeXBl\nKHN1cC5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgZm1k\nLmJhY2tpbmdNZW1iZXIoZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhRmFj\ndG9yeSgpLgogICAgICAgICAgICAgICAgICAgIGdldERlZmF1bHRzKCkuZ2V0\nQmFja2luZ01lbWJlcihmbWQpKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBmbWQuY29weShzdXApOwogICAgICAgICAgICBmbWQucmVzb2x2ZShNT0RF\nX01FVEEpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgYW4gYXJyYXkgb2YgYWxsIHRoZSBmaWVsZHMgZGVmaW5lZCBieSB0aGlz\nIGNsYXNzLgogICAgICogVGhpcyBpbmNsdWRlcyBtYXBwZWQgZGVjbGFyZWQg\nZmllbGRzIGFuZCBhbnkgY29uY3JldGUgbWFwcGluZyBvZgogICAgICogdW5t\nYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMgcGVyZm9ybWVkIGJ5IHRoaXMgY2xh\nc3MuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVm\naW5lZEZpZWxkcygpIHsKICAgICAgICBpZiAoX2RlZmluZWRGaWVsZHMgPT0g\nbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0g\nZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIExpc3Q8RmllbGRNZXRhRGF0YT4g\nZGVmaW5lZCA9IAogICAgICAgICAgICAJbmV3IEFycmF5TGlzdDxGaWVsZE1l\ndGFEYXRhPihmaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChGaWVs\nZE1ldGFEYXRhIGZtZCA6IGZpZWxkcykgewogICAgICAgICAgICAgICAgaWYg\nKGZtZC5pc01hcHBlZCgpCiAgICAgICAgICAgICAgICAgICAgJiYgZm1kLmdl\ndERlZmluaW5nTWV0YURhdGEoKSA9PSB0aGlzKQogICAgICAgICAgICAgICAg\nICAgIGRlZmluZWQuYWRkKGZtZCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgX2RlZmluZWRGaWVsZHMgPSAoRmllbGRNZXRhRGF0YVtdKSBkZWZpbmVk\nLnRvQXJyYXkKICAgICAgICAgICAgICAgIChfcmVwb3MubmV3RmllbGRNZXRh\nRGF0YUFycmF5KGRlZmluZWQuc2l6ZSgpKSk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBfZGVmaW5lZEZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgYWxsIGZpZWxkcyBpbiB0aGUgb3JkZXIgdGhleSBhcmUgbGlz\ndGVkIGluIHRoZSBtZXRhZGF0YQogICAgICogZmlsZS4gVW5saXN0ZWQgZmll\nbGRzIGFyZSBwbGFjZWQgYWZ0ZXIgbGlzdGVkIG9uZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RmllbGRzSW5MaXN0aW5nT3Jk\nZXIoKSB7CiAgICAgICAgaWYgKF9hbGxMaXN0aW5nRmllbGRzID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gY29tYmluZSBkZWNsYXJlZCBhbmQgdW5tYW5h\nZ2VkIGZpZWxkcyBpbnRvIGxpc3Rpbmcgb3JkZXIgYXJyYXkKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGRlYyA9IGdldERlY2xhcmVkRmllbGRzKCk7\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9IGdldERlY2xh\ncmVkVW5tYW5hZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBkZWNMaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJh\neQogICAgICAgICAgICAgICAgKGRlYy5sZW5ndGggKyB1bm1nZC5sZW5ndGgp\nOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGRlYywgMCwgZGVjTGlz\ndGluZywgMCwgZGVjLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkodW5tZ2QsIDAsIGRlY0xpc3RpbmcsIGRlYy5sZW5ndGgsIHVubWdk\nLmxlbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KGRlY0xpc3Rpbmcs\nIExpc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2UoKSk7CgogICAg\nICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBf\nYWxsTGlzdGluZ0ZpZWxkcyA9IGRlY0xpc3Rpbmc7CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgLy8gcGxhY2Ugc3VwZXJjbGFzcyBmaWVs\nZHMgaW4gbGlzdGluZyBvcmRlciBiZWZvcmUgb3VyCiAgICAgICAgICAgICAg\nICAvLyBsaXN0aW5nLW9yZGVyIGRlY2xhcmVkIGZpZWxkcwogICAgICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIHN1cCA9IGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGRzSW5MaXN0\naW5nT3JkZXIoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBs\naXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAg\nICAgICAgICAgICAgIChzdXAubGVuZ3RoICsgZGVjTGlzdGluZy5sZW5ndGgp\nOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShzdXAsIDAsIGxp\nc3RpbmcsIDAsIHN1cC5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmVwbGFj\nZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKGxpc3RpbmcsIHN1cC5sZW5ndGgp\nOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShkZWNMaXN0aW5n\nLCAwLCBsaXN0aW5nLCBzdXAubGVuZ3RoLAogICAgICAgICAgICAgICAgICAg\nIGRlY0xpc3RpbmcubGVuZ3RoKTsKICAgICAgICAgICAgICAgIF9hbGxMaXN0\naW5nRmllbGRzID0gbGlzdGluZzsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2FsbExpc3RpbmdGaWVsZHM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBmaWVsZHMgZGVmaW5lZCBieSB0aGlz\nIGNsYXNzIGluIHRoZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQKICAgICAqIGlu\nIHRoZSBtZXRhZGF0YSBmaWxlLiBVbmxpc3RlZCBmaWVsZHMgYXJlIHBsYWNl\nZCBhZnRlciBsaXN0ZWQgb25lcy4KICAgICAqIFRoaXMgYXJyYXkgaW5jbHVk\nZXMgZGVjbGFyZWQgdHJhbnNhY3Rpb25hbCBhbmQgdW5tYW5hZ2VkIGZpZWxk\ncy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZp\nbmVkRmllbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAgICAgICAgaWYgKF9saXN0\naW5nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBMaXN0PEZp\nZWxkTWV0YURhdGE+IGRlZmluZWQgPSAKICAgICAgICAgICAgCW5ldyBBcnJh\neUxpc3Q8RmllbGRNZXRhRGF0YT4oZmllbGRzLmxlbmd0aCk7CiAgICAgICAg\nICAgIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBmaWVsZHMpCiAgICAgICAg\nICAgICAgICBpZiAoZm1kLmdldERlZmluaW5nTWV0YURhdGEoKSA9PSB0aGlz\nKQogICAgICAgICAgICAgICAgICAgIGRlZmluZWQuYWRkKGZtZCk7CiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9IGdldERlY2xhcmVkVW5t\nYW5hZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBs\naXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAg\nICAgICAgICAgKGRlZmluZWQuc2l6ZSgpICsgdW5tZ2QubGVuZ3RoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkZWZpbmVkLnNpemUoKTsg\naSsrKQogICAgICAgICAgICAgICAgbGlzdGluZ1tpXSA9IChGaWVsZE1ldGFE\nYXRhKSBkZWZpbmVkLmdldChpKTsKICAgICAgICAgICAgU3lzdGVtLmFycmF5\nY29weSh1bm1nZCwgMCwgbGlzdGluZywgZGVmaW5lZC5zaXplKCksIHVubWdk\nLmxlbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KGxpc3RpbmcsIExp\nc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2UoKSk7CiAgICAgICAg\nICAgIF9saXN0aW5nRmllbGRzID0gbGlzdGluZzsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9saXN0aW5nRmllbGRzOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIG5hbWUgb2YgdGhlIGRhdGEgY2FjaGUgdGhhdCBzdG9yZXMgdGhl\nIG1hbmFnZWQgaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcywgYnkgZGVmYXVsdC4K\nICAgICAqIFRoaXMgY2FuIGJlIG92ZXJ3cml0dGVuIGJ5IHBlci1pbnN0YW5j\nZSBiYXNpcyB7QGxpbmtwbGFpbiBDYWNoZURpc3RyaWJ1dGlvblBvbGljeSBj\nYWNoZSBkaXN0cmlidXRpb24gcG9saWN5fS4gCiAgICAgKiAKICAgICAqIEBy\nZXR1cm4gbnVsbCBpZiB0aGlzIGNsYXNzIGlzIGRpc2FibGVkIGZyb20gY2Fj\naGUgYnkgQERhdGFDYWNoZShlbmFibGVkPWZhbHNlKS4KICAgICAqICAgICAg\nICAge0BsaW5rcGxhaW4gRGF0YUNhY2hlI05BTUVfREVGQVVMVCBkZWZhdWx0\nfSBpZiBARGF0YUNhY2hlKGVuYWJsZWQ9dHJ1ZSkgd2l0aG91dCBhIG5hbWUu\nCiAgICAgKiAgICAgICAgIE90aGVyd2lzZSwgZGF0YSBjYWNoZSBuYW1lIHNl\ndCBieSB0aGUgdXNlciB2aWEgQERhdGFDYWNoZSBuYW1lIGF0dHJpYnV0ZS4g\nCiAgICAgKiAKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXREYXRhQ2Fj\naGVOYW1lKCkgewogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMo\nX2NhY2hlTmFtZSkpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAhPSBudWxs\nICYmIFN0cmluZ1V0aWxzLmlzTm90RW1wdHkoZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKS5nZXREYXRhQ2FjaGVOYW1lKCkpKSB7CiAgICAgICAgICAgICAg\nICBfY2FjaGVOYW1lID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRE\nYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBfY2FjaGVOYW1lID0gRGF0YUNhY2hlLk5BTUVfREVGQVVMVDsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NhY2hl\nTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY2FjaGUgbmFt\nZSBmb3IgdGhpcyBjbGFzcy4gCiAgICAgKiAKICAgICAqIEBwYXJhbSBjYW4g\nYmUgbnVsbCB0byBkaXNhYmxlIGNhY2hlLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXREYXRhQ2FjaGVOYW1lKFN0cmluZyBuYW1lKSB7CiAgICAgICAg\nX2NhY2hlTmFtZSA9IG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nY2FjaGUgdGltZW91dCBmb3IgdGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVzIG5v\nIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RGF0YUNhY2hl\nVGltZW91dCgpIHsKICAgICAgICBpZiAoX2NhY2hlVGltZW91dCA9PSBJbnRl\nZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfY2FjaGVUaW1lb3V0ID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKS4KICAgICAgICAgICAgICAgICAgICBnZXREYXRh\nQ2FjaGVUaW1lb3V0KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIF9jYWNoZVRpbWVvdXQgPSBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigp\nLgogICAgICAgICAgICAgICAgICAgIGdldERhdGFDYWNoZVRpbWVvdXQoKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jYWNoZVRpbWVvdXQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgY2FjaGUgdGltZW91dCBmb3IgdGhpcyBj\nbGFzcy4gLTEgaW5kaWNhdGVzIG5vIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldERhdGFDYWNoZVRpbWVvdXQoaW50IHRpbWVvdXQpIHsK\nICAgICAgICBfY2FjaGVUaW1lb3V0ID0gdGltZW91dDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZGF0YSBjYWNoZSBmb3IgdGhpcyBjbGFz\ncywgb3IgbnVsbCBpZiBpdCBpcyBub3QgY2FjaGFibGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBEYXRhQ2FjaGUgZ2V0RGF0YUNhY2hlKCkgewogICAgICAgIFN0\ncmluZyBuYW1lID0gZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAgICAgIGlmIChu\nYW1lID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigp\nLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLmdldERhdGFDYWNoZShu\nYW1lLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgaW5z\ndGFuY2VzIGFyZSBkZXRhY2hhYmxlLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0RldGFjaGFibGUoKSB7CiAgICAgICAgaWYgKF9kZXRhY2hhYmxl\nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2RldGFjaGFibGUgPSAoZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKS5pc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAgICAg\nICA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIF9kZXRhY2hhYmxlID0gQm9vbGVhbi5G\nQUxTRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9kZXRhY2hhYmxlLmJv\nb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBp\nbnN0YW5jZXMgYXJlIGRldGFjaGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldERldGFjaGFibGUoYm9vbGVhbiBkZXRhY2hhYmxlKSB7CiAgICAg\nICAgX2RldGFjaGFibGUgPSAoZGV0YWNoYWJsZSkgPyBCb29sZWFuLlRSVUUg\nOiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG5h\nbWUgb2YgdGhlIGRldGFjaCBzdGF0ZSBmaWVsZCwgb3IgbnVsbCBpZiBub25l\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldERldGFjaGVkU3RhdGUo\nKSB7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVxdWFscyhfZGV0YWNo\nU3RhdGUpKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAh\nPSBudWxsICYmIHN1cC5pc0RldGFjaGFibGUoKSA9PSBpc0RldGFjaGFibGUo\nKSkKICAgICAgICAgICAgICAgIF9kZXRhY2hTdGF0ZSA9IHN1cC5nZXREZXRh\nY2hlZFN0YXRlKCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgQm9vbGVhbiB1c2UgPSB1c2VzRGV0YWNoZWRTdGF0ZShTWU5USEVUSUMs\nIHRydWUpOwogICAgICAgICAgICAgICAgX2RldGFjaFN0YXRlID0gKEJvb2xl\nYW4uRkFMU0UuZXF1YWxzKHVzZSkpID8gbnVsbCA6IFNZTlRIRVRJQzsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2RldGFjaFN0\nYXRlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG5hbWUgb2YgdGhlIGRl\ndGFjaCBzdGF0ZSBmaWVsZCwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREZXRhY2hlZFN0YXRlKFN0cmluZyBmaWVsZCkg\newogICAgICAgIF9kZXRhY2hTdGF0ZSA9IGZpZWxkOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51\nbGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIEZpZWxkIGdldERldGFj\naGVkU3RhdGVGaWVsZCgpIHsKICAgICAgICAvLyBubyBjYWNoaW5nOyBvbmx5\nIHVzZWQgYXQgZW5oYW5jZW1lbnQKICAgICAgICBTdHJpbmcgZmllbGROYW1l\nID0gZ2V0RGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIGlmIChmaWVsZE5hbWUg\nPT0gbnVsbCB8fCBTWU5USEVUSUMuZXF1YWxzKGZpZWxkTmFtZSkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBGaWVsZCBmID0gUmVmbGVj\ndGlvbi5maW5kRmllbGQoX3R5cGUsIGZpZWxkTmFtZSwgZmFsc2UpOwogICAg\nICAgIGlmIChmICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKAogICAgICAgICAgICAgICAgX2xvYy5nZXQoIm5vLWRldGFjaC1zdGF0\nZSIsIGZpZWxkTmFtZSwgX3R5cGUpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgYW4gaW5zdGFuY2Ugb2YgdGhpcyB0eXBlIGhhcyBkZXRhY2hl\nZCBzdGF0ZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYSBkZXRh\nY2hlZCBpbnN0YW5jZSBtdXN0IGhhdmUgZGV0YWNoZWQgc3RhdGUsIGZhbHNl\nCiAgICAgKiBpZiBpdCBkb2VzIG5vdCwgYW5kIG51bGwgaWYgaXQgbWF5IHVz\nZSBhCiAgICAgKiBtYW51YWxseS1jb25zdHJ1Y3RlZCBpbnN0YW5jZSB3aXRo\nb3V0IGRldGFjaGVkIHN0YXRlCiAgICAgKi8KICAgIHB1YmxpYyBCb29sZWFu\nIHVzZXNEZXRhY2hlZFN0YXRlKCkgewogICAgICAgIC8vIG5vIG5lZWQgdG8g\nbGV0IGNvbmYgZGlzYWxsb3cgYmVjYXVzZSBpdCdzIHRha2VuIGludG8gYWNj\nb3VudCBpbgogICAgICAgIC8vIGdldERldGFjaGVkU3RhdGUoKSBjYWxsCiAg\nICAgICAgcmV0dXJuIHVzZXNEZXRhY2hlZFN0YXRlKGdldERldGFjaGVkU3Rh\ndGUoKSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBh\nbiBpbnN0YW5jZSBvZiB0aGlzIHR5cGUgaGFzIGRldGFjaGVkIHN0YXRlLCBh\nc3N1bWluZyB0aGUgZ2l2ZW4KICAgICAqIGRldGFjaGVkIHN0YXRlIGZpZWxk\nLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhIGRldGFjaGVkIGlu\nc3RhbmNlIG11c3QgaGF2ZSBkZXRhY2hlZCBzdGF0ZSwgZmFsc2UKICAgICAq\nIGlmIGl0IGRvZXMgbm90LCBhbmQgbnVsbCBpZiBpdCBtYXkgdXNlIGEKICAg\nICAqIG1hbnVhbGx5LWNvbnN0cnVjdGVkIGluc3RhbmNlIHdpdGhvdXQgZGV0\nYWNoZWQgc3RhdGUKICAgICAqLwogICAgcHJpdmF0ZSBCb29sZWFuIHVzZXNE\nZXRhY2hlZFN0YXRlKFN0cmluZyBkZXRhY2hlZEZpZWxkLAogICAgICAgIGJv\nb2xlYW4gY29uZkRpc2FsbG93cykgewogICAgICAgIGlmICghaXNEZXRhY2hh\nYmxlKCkpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwoKICAg\nICAgICAvLyBpZiB3ZSBkZWNsYXJlIGEgZGV0YWNoZWQgc3RhdGUgZmllbGQs\nIGhhdmUgdG8gdXNlIGl0CiAgICAgICAgaWYgKGRldGFjaGVkRmllbGQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgaWYgKCFTWU5USEVUSUMuZXF1YWxzKGRldGFjaGVkRmllbGQpKQogICAg\nICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwoKICAgICAgICAvLyBhbGxv\ndyBjb25mIHRvIGRpc2FsbG93CiAgICAgICAgaWYgKGNvbmZEaXNhbGxvd3Mg\nJiYgIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdl\ndERldGFjaFN0YXRlSW5zdGFuY2UoKS5nZXREZXRhY2hlZFN0YXRlRmllbGQo\nKSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CgogICAgICAg\nIC8vIGhhdmUgdG8gdXNlIGRldGFjaGVkIHN0YXRlIHRvIHN0b3JlIGRhdGFz\ndG9yZSBpZAogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9E\nQVRBU1RPUkUpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7Cgog\nICAgICAgIC8vIGFsbG93IGRldGFjaGVkIHN0YXRlIHVzZSwgYnV0IGRvbid0\nIHJlcXVpcmUKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIENsZWFyIGNhY2hlZCBmaWVsZCBkYXRhLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBjbGVhckFsbEZpZWxkQ2FjaGUoKSB7CiAgICAgICAg\nX2FsbEZpZWxkcyA9IG51bGw7CiAgICAgICAgX2FsbERGR0ZpZWxkcyA9IG51\nbGw7CiAgICAgICAgX2FsbFBLRmllbGRzID0gbnVsbDsKICAgICAgICBfZGVm\naW5lZEZpZWxkcyA9IG51bGw7CiAgICAgICAgX2xpc3RpbmdGaWVsZHMgPSBu\ndWxsOwogICAgICAgIF9hbGxMaXN0aW5nRmllbGRzID0gbnVsbDsKICAgICAg\nICBfZmllbGREYXRhVGFibGUgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2xlYXIgZGVmaW5lZCBmaWVsZCBkYXRhLgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBjbGVhckRlZmluZWRGaWVsZENhY2hlKCkgewogICAgICAg\nIF9kZWZpbmVkRmllbGRzID0gbnVsbDsKICAgICAgICBfbGlzdGluZ0ZpZWxk\ncyA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQg\nZmllbGQgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJG\naWVsZENhY2hlKCkgewogICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwog\nICAgICAgIF9maWVsZHMgPSBudWxsOwogICAgICAgIF91bm1nZEZpZWxkcyA9\nIG51bGw7CiAgICAgICAgX3ZlcnNpb25JZHggPSBJbnRlZ2VyLk1JTl9WQUxV\nRTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlZCBzdWJjbGFz\ncyBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhclN1YmNs\nYXNzQ2FjaGUoKSB7CiAgICAgICAgX3N1YnMgPSBudWxsOwogICAgICAgIF9z\ndWJNZXRhcyA9IG51bGw7CiAgICAgICAgX21hcFN1Yk1ldGFzID0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGltcGwgZGF0YSBhbmQgaW50\nZXJtZWRpYXRlIGRhdGEgdGFibGUuCiAgICAgKi8KICAgIHZvaWQgY2xlYXJF\neHRyYUZpZWxkRGF0YVRhYmxlKCkgewogICAgICAgIF9maWVsZERhdGFUYWJs\nZSA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBmaWVsZCBh\ncnJheXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjYWNoZUZpZWxkcygp\nIHsKICAgICAgICBnZXRGaWVsZHMoKTsKICAgICAgICBnZXRQcmltYXJ5S2V5\nRmllbGRzKCk7CiAgICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsK\nICAgICAgICByZXR1cm4gX3R5cGUuZ2V0TmFtZSgpLmhhc2hDb2RlKCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikg\newogICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIENsYXNz\nTWV0YURhdGEpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\ncmV0dXJuIF90eXBlID09ICgoQ2xhc3NNZXRhRGF0YSkgb3RoZXIpLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGNvbXBhcmVU\nbyhDbGFzc01ldGFEYXRhIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09\nIHRoaXMpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiBf\ndHlwZS5nZXROYW1lKCkuY29tcGFyZVRvKCgoQ2xhc3NNZXRhRGF0YSkgb3Ro\nZXIpLgogICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgp\nKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAg\nICAgIHJldHVybiBnZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpOwogICAg\nfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVzb2x2\nZSBhbmQgdmFsaWRhdGUKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIC8qKgogICAgICogVGhlIHJlc29sdmUgbW9kZSBmb3IgdGhpcyBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRSZXNvbHZlKCkgewog\nICAgICAgIHJldHVybiBfcmVzTW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMgbWV0YWRhdGEuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1vZGUpIHsKICAgICAg\nICBfcmVzTW9kZSA9IG1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\ncmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1ldGFkYXRhLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlLCBib29sZWFuIG9uKSB7\nCiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAgICBf\ncmVzTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAg\nICAgIF9yZXNNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfcmVzTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nc29sdmUgYW5kIHZhbGlkYXRlIG1ldGFkYXRhLiBSZXR1cm4gdHJ1ZSBpZiBh\nbHJlYWR5IHJlc29sdmVkLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgaWYgKChfcmVzTW9kZSAmIG1v\nZGUpID09IG1vZGUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIGludCBjdXIgPSBfcmVzTW9kZTsKICAgICAgICBfcmVzTW9kZSB8PSBtb2Rl\nOwoKICAgICAgICBpbnQgdmFsID0gX3JlcG9zLmdldFZhbGlkYXRlKCk7CiAg\nICAgICAgYm9vbGVhbiBydW50aW1lID0gKHZhbCAmIE1ldGFEYXRhUmVwb3Np\ndG9yeS5WQUxJREFURV9SVU5USU1FKSAhPSAwOwogICAgICAgIGJvb2xlYW4g\ndmFsaWRhdGUgPQogICAgICAgICAgICAhSW1wbEhlbHBlci5pc01hbmFnZWRU\neXBlKGdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCksIF90eXBl\nKQogICAgICAgICAgICB8fCAodmFsICYgTWV0YURhdGFSZXBvc2l0b3J5LlZB\nTElEQVRFX1VORU5IQU5DRUQpID09IDA7CgogICAgICAgIC8vIHdlIG9ubHkg\nZG8gYW55IGFjdGlvbnMgZm9yIG1ldGFkYXRhIG1vZGUKICAgICAgICBpZiAo\nKG1vZGUgJiBNT0RFX01FVEEpICE9IDAgJiYgKGN1ciAmIE1PREVfTUVUQSkg\nPT0gMCkgewogICAgICAgICAgICByZXNvbHZlTWV0YShydW50aW1lKTsKICAg\nICAgICAgICAgaWYgKHZhbGlkYXRlICYmICh2YWwgJiBNZXRhRGF0YVJlcG9z\naXRvcnkuVkFMSURBVEVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgICAgIHZh\nbGlkYXRlTWV0YShydW50aW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKCht\nb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJ\nTkcpID09IDApIHsKICAgICAgICAgICAgcmVzb2x2ZU1hcHBpbmcocnVudGlt\nZSk7CiAgICAgICAgICAgIGlmICh2YWxpZGF0ZSAmJiAodmFsICYgTWV0YURh\ndGFSZXBvc2l0b3J5LlZBTElEQVRFX01BUFBJTkcpICE9IDApCiAgICAgICAg\nICAgICAgICB2YWxpZGF0ZU1hcHBpbmcocnVudGltZSk7CiAgICAgICAgfQog\nICAgICAgIGlmICgobW9kZSAmIE1PREVfTUFQUElOR19JTklUKSAhPSAwICYm\nIChjdXIgJiBNT0RFX01BUFBJTkdfSU5JVCkgPT0gMCkKICAgICAgICAgICAg\naW5pdGlhbGl6ZU1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIG1ldGFkYXRhLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNvbHZlTWV0YShib29sZWFuIHJ1bnRp\nbWUpIHsKICAgICAgICBib29sZWFuIGVtYmVkID0gX293bmVyICE9IG51bGwg\nJiYgX293bmVyLmdldERlY2xhcmVkVHlwZSgpID09IF90eXBlOwogICAgICAg\nIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5p\nc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5n\nZXQoKGVtYmVkKSA/ICJyZXNvbHZlLWVtYmVkLW1ldGEiIDogInJlc29sdmUt\nbWV0YSIsCiAgICAgICAgICAgICAgICB0aGlzICsgIkAiICsgU3lzdGVtLmlk\nZW50aXR5SGFzaENvZGUodGhpcykpKTsKCiAgICAgICAgaWYgKHJ1bnRpbWUg\nJiYgIV90eXBlLmlzSW50ZXJmYWNlKCkgJiYKICAgICAgICAgICAgIUltcGxI\nZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmln\ndXJhdGlvbigpLF90eXBlKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW5oYW5jZWQiLCBfdHlwZSkp\nOwoKICAgICAgICAvLyBhcmUgd2UgdGhlIHRhcmdldCBvZiBhbiBlbWJlZGRl\nZCB2YWx1ZT8KICAgICAgICBpZiAoZW1iZWQpIHsKICAgICAgICAgICAgaWYg\nKHJlY3Vyc2l2ZUVtYmVkKF9vd25lcikpIHsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVjdXJzZS1l\nbWJlZCIsIF9vd25lcikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBjb3B5IGluZm8gZnJvbSB0aGUgInJlYWwiIG1ldGFkYXRhIGZvciB0aGlz\nIHR5cGUKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX3JlcG9z\nLmdldE1ldGFEYXRhKF90eXBlLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAg\nICAgbWV0YS5yZXNvbHZlKE1PREVfTUVUQSk7CiAgICAgICAgICAgIGNvcHko\ndGhpcywgbWV0YSk7CiAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4u\nRkFMU0U7IC8vIGVtYmVkZGVkIGluc3RhbmNlIGlzbid0IGVtYmVkZGVkLW9u\nbHkKICAgICAgICB9CgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNz\nIGlzIHJlc29sdmVkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVs\nbCkgewogICAgICAgICAgICBzdXAucmVzb2x2ZShNT0RFX01FVEEpOwogICAg\nICAgICAgICBpZiAoZW1iZWQpIHsKICAgICAgICAgICAgICAgIC8vIGVtYmVk\nZGVkIGluc3RhbmNlIGFsd2F5cyByZWRlZmluZSBhbGwgc3VwZXJjbGFzcyBm\naWVsZHMKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBzID0g\nc3VwLmdldEZpZWxkcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsCiAgICAgICAgICAgICAgICAg\nICAgICAgIHx8ICFfc3VwRmllbGRNYXAuY29udGFpbnNLZXkoc3Vwc1tpXS5n\nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERlZmlu\nZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tpXS5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzdXBzW2ldLmdldERlY2xhcmVkVHlwZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNs\nYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\ncmVzb2x2ZSBmaWVsZHMgYW5kIHJlbW92ZSBpbnZhbGlkcwogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kOwogICAgICAgIGZvciAoSXRlcmF0b3I8RmllbGRN\nZXRhRGF0YT4gaXRyID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7\nIAogICAgICAgIAlpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAvLyBv\nbmx5IHBhc3Mgb24gbWV0YWRhdGEgcmVzb2x2ZSBtb2RlIHNvIHRoYXQgbWV0\nYWRhdGEgaXMgYWx3YXlzCiAgICAgICAgICAgIC8vIHJlc29sdmVkIGJlZm9y\nZSBhbnkgb3RoZXIgcmVzb2x2ZSBtb2RlcyBvdXIgc3ViY2xhc3NlcyBwYXNz\nIGFsb25nCiAgICAgICAgICAgIGZtZCA9IGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGZtZC5yZXNvbHZlKE1PREVfTUVUQSk7CgogICAgICAgICAgICBpZiAo\nIWZtZC5pc0V4cGxpY2l0KCkKICAgICAgICAgICAgICAgICYmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PQkpFQ1QKICAgICAg\nICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2\nYVR5cGVzLlBDX1VOVFlQRUQKICAgICAgICAgICAgICAgIHx8IChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWQogICAgICAg\nICAgICAgICAgJiYgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkKICAgICAgICAgICAgICAgID09IEphdmFUeXBlcy5PQkpFQ1QpKSkg\newogICAgICAgICAgICAgICAgX3JlcG9zLmdldExvZygpLndhcm4oX2xvYy5n\nZXQoInJtLWZpZWxkIiwgZm1kKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1k\nLmdldExpc3RpbmdJbmRleCgpICE9IC0xKQogICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRNYW5hZ2VtZW50KEZpZWxkTWV0YURhdGEuTUFOQUdFX05PTkUp\nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGl0\nci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIGNsZWFyRmllbGRDYWNoZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBlbWJlZGRl\nZCBpbnN0YW5jZXMgbXVzdCBlbWJlZCBhbGwgc3VwZXJjbGFzcyBmaWVsZHMg\ndG9vCiAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAgIGNsZWFyQWxs\nRmllbGRDYWNoZSgpOwogICAgICAgICAgICByZXNvbHZlRGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIHRoaXMgZW5z\ndXJlcyB0aGF0IGFsbCBmaWVsZCBpbmRleGVzIGdldCBzZXQgd2hlbiBmaWVs\nZHMgYXJlIGNhY2hlZAogICAgICAgIGNhY2hlRmllbGRzKCk7CgogICAgICAg\nIC8vIHJlc29sdmUgbGlmZWN5Y2xlIG1ldGFkYXRhIG5vdyB0byBwcmV2ZW50\nIGxhenkgdGhyZWFkaW5nIHByb2JsZW1zCiAgICAgICAgX2xpZmVNZXRhLnJl\nc29sdmUoKTsKCiAgICAgICAgLy8gcmVjb3JkIGltcGxlbWVudHMgaW4gdGhl\nIHJlcG9zaXRvcnkKICAgICAgICBpZiAoX2ludGVyZmFjZXMgIT0gbnVsbCkg\newogICAgICAgICAgICBmb3IgKENsYXNzPD8+IGlmYWNlIDogX2ludGVyZmFj\nZXMpCiAgICAgICAgICAgICAgICBfcmVwb3MuYWRkRGVjbGFyZWRJbnRlcmZh\nY2VJbXBsKHRoaXMsIGlmYWNlKTsKICAgICAgICB9CgogICAgICAgIC8vIHJl\nc29sdmUgZmV0Y2ggZ3JvdXBzCiAgICAgICAgaWYgKF9mZ01hcCAhPSBudWxs\nKQogICAgICAgICAgICBmb3IgKEZldGNoR3JvdXAgZmcgOiBfZmdNYXAudmFs\ndWVzKCkpCiAgICAgICAgICAgICAgICBmZy5yZXNvbHZlKCk7CgogICAgICAg\nIGlmICghZW1iZWQgJiYgX3R5cGUuaXNJbnRlcmZhY2UoKSkgewogICAgICAg\nICAgICBpZiAoX2ludGVyZmFjZSAhPSBCb29sZWFuLlRSVUUpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImludGVyZmFjZSIsIF90eXBlKSk7CgogICAgICAgICAgICBpZiAocnVudGlt\nZSkgewogICAgICAgICAgICAgICAgX2ltcGwgPSBfcmVwb3MuZ2V0SW1wbEdl\nbmVyYXRvcigpLmNyZWF0ZUltcGwodGhpcyk7CiAgICAgICAgICAgICAgICBf\ncmVwb3Muc2V0SW50ZXJmYWNlSW1wbCh0aGlzLCBfaW1wbCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgaXMgcnVudGlt\nZSwgY3JlYXRlIGEgcGMgaW5zdGFuY2UgYW5kIHNjYW4gaXQgZm9yIGNvbXBh\ncmF0b3JzCiAgICAgICAgaWYgKHJ1bnRpbWUgJiYgIU1vZGlmaWVyLmlzQWJz\ndHJhY3QoX3R5cGUuZ2V0TW9kaWZpZXJzKCkpKSB7CiAgICAgICAgICAgIFBy\nb3h5U2V0dXBTdGF0ZU1hbmFnZXIgc20gPSBuZXcgUHJveHlTZXR1cFN0YXRl\nTWFuYWdlcigpOwogICAgICAgICAgICBzbS5zZXRQcm94eURhdGEoUENSZWdp\nc3RyeS5uZXdJbnN0YW5jZShfdHlwZSwgc20sIGZhbHNlKSwgdGhpcyk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiByZWN1cnNpdmVF\nbWJlZChWYWx1ZU1ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBjbSA9IG93bmVyLmdldEZpZWxkTWV0YURhdGEoKS5nZXREZWZpbmlu\nZ01ldGFEYXRhKCk7IAogICAgICAgIGlmIChjbS5nZXREZXNjcmliZWRUeXBl\nKCkuaXNBc3NpZ25hYmxlRnJvbShfdHlwZSkpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIFZhbHVlTWV0YURhdGEgb3duZXIxID0gY20uZ2V0\nRW1iZWRkaW5nTWV0YURhdGEoKTsKICAgICAgICBpZiAob3duZXIxID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBlbHNlIAog\nICAgICAgICAgICByZXR1cm4gcmVjdXJzaXZlRW1iZWQob3duZXIxKTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSByZXNvbHZlZCBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNZXRh\nKGJvb2xlYW4gcnVudGltZSkgewogICAgICAgIHZhbGlkYXRlRGF0YUNhY2hl\nKCk7CiAgICAgICAgdmFsaWRhdGVEZXRhY2hhYmxlKCk7CiAgICAgICAgdmFs\naWRhdGVFeHRlbnNpb25LZXlzKCk7CiAgICAgICAgdmFsaWRhdGVJZGVudGl0\neSgpOwogICAgICAgIHZhbGlkYXRlQWNjZXNzVHlwZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVzb2x2ZSBtYXBwaW5nIGRhdGEuIExvZ3MgcmVzb2x2\nZSBtZXNzYWdlIGFuZCByZXNvbHZlcyBzdXBlciBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNvbHZlTWFwcGluZyhib29sZWFu\nIHJ1bnRpbWUpIHsKICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygp\nOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJyZXNvbHZlLW1hcHBpbmciLCB0aGlz\nICsgIkAiCiAgICAgICAgICAgICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hD\nb2RlKHRoaXMpKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNz\nIGlzIHJlc29sdmVkIGZpcnN0CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAg\nPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAg\nIT0gbnVsbCkKICAgICAgICAgICAgc3VwLnJlc29sdmUoTU9ERV9NQVBQSU5H\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIG1hcHBpbmcgZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNYXBwaW5n\nKGJvb2xlYW4gcnVudGltZSkgewogICAgfQoKICAgIC8qKgogICAgICogSW5p\ndGlhbGl6ZSBtYXBwaW5nLiBMb2dzIGluaXQgbWVzc2FnZSBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFwcGlu\nZygpIHsKICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJpbml0LW1hcHBpbmciLCB0aGlzICsgIkAiCiAg\nICAgICAgICAgICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMp\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBkYXRhIGNhY2hl\nIHNldHRpbmdzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVE\nYXRhQ2FjaGUoKSB7CiAgICAgICAgaW50IHRpbWVvdXQgPSBnZXREYXRhQ2Fj\naGVUaW1lb3V0KCk7CiAgICAgICAgaWYgKHRpbWVvdXQgPCAtMSB8fCB0aW1l\nb3V0ID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgiY2FjaGUtdGltZW91dC1pbnZhbGlkIiwKICAgICAg\nICAgICAgICAgIF90eXBlLCBTdHJpbmcudmFsdWVPZih0aW1lb3V0KSkpOwoK\nICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpIHsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KICAgICAgICBTdHJpbmcgY2FjaGUgPSBnZXREYXRh\nQ2FjaGVOYW1lKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51bGwpIHsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIHN1\ncGVyQ2FjaGUgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldERhdGFD\nYWNoZU5hbWUoKTsKICAgICAgICAKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoc3VwZXJDYWNoZSkpIHsgIAogICAgICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmVxdWFscyhjYWNoZSwgc3VwZXJDYWNoZSkpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiY2FjaGUtbmFtZXMiLCBuZXcgT2JqZWN0W10geyBfdHlwZSwgY2FjaGUs\nIF9zdXBlciwgc3VwZXJDYWNoZSB9KSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgaWRl\nbnRpdHkgaGFuZGxpbmcgZm9yIHRoaXMgY2xhc3MgaXMgdmFsaWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUlkZW50aXR5KCkgewogICAg\nICAgIC8vIG1ha2Ugc3VyZSBpZGVudGl0eSB0eXBlcyBhcmUgY29uc2lzdGVu\ndAogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKTsKICAgICAgICBpbnQgaWQgPSBnZXRJZGVudGl0eVR5cGUo\nKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5\nVHlwZSgpICE9IElEX1VOS05PV04KICAgICAgICAgICAgJiYgc3VwLmdldElk\nZW50aXR5VHlwZSgpICE9IGlkKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImlkLXR5cGVzIiwgX3R5cGUpKTsK\nCiAgICAgICAgLy8gY2hlY2sgZm9yIHRoaW5ncyB0aGUgZGF0YSBzdG9yZSBk\nb2Vzbid0IHN1cHBvcnQKICAgICAgICBDb2xsZWN0aW9uPFN0cmluZz4gb3B0\ncyA9IF9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuc3VwcG9ydGVkT3B0aW9u\ncygpOwogICAgICAgIGlmIChpZCA9PSBJRF9BUFBMSUNBVElPTgogICAgICAg\nICAgICAmJiAhb3B0cy5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5P\nUFRJT05fSURfQVBQTElDQVRJT04pKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiYXBwaWQtbm90LXN1\ncHBvcnRlZCIsCiAgICAgICAgICAgICAgICBfdHlwZSkpOwogICAgICAgIH0K\nICAgICAgICBpZiAoaWQgPT0gSURfREFUQVNUT1JFCiAgICAgICAgICAgICYm\nICFvcHRzLmNvbnRhaW5zKE9wZW5KUEFDb25maWd1cmF0aW9uLk9QVElPTl9J\nRF9EQVRBU1RPUkUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJkYXRh\nc3RvcmVpZC1ub3Qtc3VwcG9ydGVkIiwgX3R5cGUpKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChpZCA9PSBJRF9BUFBMSUNBVElPTikgewogICAgICAgICAg\nICBpZiAoX2lkU3RyYXRlZ3kgIT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImFwcGlkLXN0cmF0ZWd5IiwgX3R5cGUpKTsKICAgICAgICAgICAg\ndmFsaWRhdGVBcHBJZENsYXNzKCk7CiAgICAgICAgfSBlbHNlIGlmIChpZCAh\nPSBJRF9VTktOT1dOKQogICAgICAgICAgICB2YWxpZGF0ZU5vUEtGaWVsZHMo\nKTsKCiAgICAgICAgaW50IHN0cmF0ZWd5ID0gZ2V0SWRlbnRpdHlTdHJhdGVn\neSgpOwogICAgICAgIGlmIChzdHJhdGVneSA9PSBWYWx1ZVN0cmF0ZWdpZXMu\nU0VRVUVOQ0UKICAgICAgICAgICAgJiYgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5h\nbWUoKSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLXNlcS1uYW1lIiwgX3R5cGUpKTsKCiAg\nICAgICAgVmFsdWVTdHJhdGVnaWVzLmFzc2VydFN1cHBvcnRlZChzdHJhdGVn\neSwgdGhpcywKICAgICAgICAgICAgImRhdGFzdG9yZSBpZGVudGl0eSBzdHJh\ndGVneSIpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBzdXJlIHRoZSBh\ncHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzcyBpcyB2YWxpZC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlQXBwSWRDbGFzcygpIHsKICAgICAg\nICAvLyBiYXNlIHR5cGVzIG11c3QgZGVjbGFyZSBhbiBvaWQgY2xhc3MgaWYg\nbm90IHNpbmdsZS1maWVsZCBpZGVudGl0eQogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBwa3MgPSBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgaWYg\nKGdldE9iamVjdElkVHlwZSgpID09IG51bGwpIHsKICAgICAgICAgICAgaWYg\nKHBrcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQtaWQtdHlw\nZSIsCiAgICAgICAgICAgICAgICAgICAgX3R5cGUsIHBrc1swXS5nZXROYW1l\nKCksCiAgICAgICAgICAgICAgICAgICAgcGtzWzBdLmdldERlY2xhcmVkVHlw\nZSgpLmdldE5hbWUoKSkpOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWlkLWNsYXNzIiwgX3R5cGUsIAog\nICAgICAgICAgICAJCUFycmF5cy5hc0xpc3QodG9OYW1lcyhwa3MpKSkpOwog\nICAgICAgIH0KICAgICAgICBpZiAoX29iamVjdElkID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGlzT3BlbkpQQUlkZW50aXR5\nKCkpIHsKICAgICAgICAgICAgaWYgKHBrc1swXS5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBlbWJlZCA9IHBrc1swXS5nZXRFbWJlZGRlZE1ldGFEYXRh\nKCk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NNZXRob2Rz\nKGVtYmVkLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB2\nYWxpZGF0ZUFwcElkQ2xhc3NQS3MoZW1iZWQsIGVtYmVkLmdldEZpZWxkcygp\nLAogICAgICAgICAgICAgICAgICAgIGVtYmVkLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKSB7CiAgICAgICAgICAg\nIC8vIGNvbmNyZXRlIHN1cGVyY2xhc3Mgb2lkIG11c3QgbWF0Y2ggb3IgYmUg\ncGFyZW50IG9mIG91cnMKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAg\nPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBDbGFz\nczw/PiBvYmplY3RJZFR5cGUgPSBzdXAuZ2V0T2JqZWN0SWRUeXBlKCk7CiAg\nICAgICAgICAgIGlmIChvYmplY3RJZFR5cGUgIT0gbnVsbCAmJiAKICAgICAg\nICAgICAgICAgICFvYmplY3RJZFR5cGUuaXNBc3NpZ25hYmxlRnJvbShfb2Jq\nZWN0SWQpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJpZC1jbGFzc2VzIiwKICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IF90eXBlLCBfb2JqZWN0SWQsIF9zdXBlciwK\nICAgICAgICAgICAgICAgICAgICAgICAgc3VwLmdldE9iamVjdElkVHlwZSgp\nIH0pKTsKCiAgICAgICAgICAgIC8vIHZhbGlkYXRlIHRoYXQgbm8gb3RoZXIg\ncGtzIGFyZSBkZWNsYXJlZCBpZiB3ZSBoYXZlIGEKICAgICAgICAgICAgLy8g\nY29uY3JldGUgUEMgc3VwZXJjbGFzcwogICAgICAgICAgICBpZiAoaGFzQ29u\nY3JldGVQQ1N1cGVyY2xhc3MoKSkKICAgICAgICAgICAgICAgIHZhbGlkYXRl\nTm9QS0ZpZWxkcygpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBj\nbGFzcyBoYXMgaXRzIG93biBvaWQgY2xhc3MsIGRvIHNvbWUgbW9yZSB2YWxp\nZGF0aW9uCiAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsCiAgICAgICAgICAg\nIHx8IF9vYmplY3RJZCAhPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdl\ndE9iamVjdElkVHlwZSgpKSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBu\nb24tYWJzdHJhY3Qgb2lkIGNsYXNzZXMgb3ZlcnJpZGUgdGhlIHByb3BlciBt\nZXRob2RzCiAgICAgICAgICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChf\nb2JqZWN0SWQuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAgdmFs\naWRhdGVBcHBJZENsYXNzTWV0aG9kcyhfb2JqZWN0SWQpOwoKICAgICAgICAg\nICAgLy8gbWFrZSBzdXJlIHRoZSBhcHBsaWNhdGlvbiBpZCBjbGFzcyBoYXMg\nYWxsIHByaW1hcnkga2V5IGZpZWxkcwogICAgICAgICAgICB2YWxpZGF0ZUFw\ncElkQ2xhc3NQS3ModGhpcywgcGtzLCBfb2JqZWN0SWQpOwogICAgICAgIH0K\nICAgIH0KICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhpcyBjbGFz\ncyB1c2VzIElkQ2xhc3MgZGVyaXZlZCBmcm9tIGlkQ2xhc3Mgb2YgdGhlIAog\nICAgICogcGFyZW50IGVudGl0eSB3aGljaCBhbm5vdGF0ZWQgYXMgaWQgaW4g\ndGhlIGNoaWxkIGNsYXNzLiAKICAgICAqIEluIHRoaXMgY2FzZSwgdGhlcmUg\nYXJlIG5vIGtleSBmaWVsZHMgaW4gdGhlIGNoaWxkIGVudGl0eSBjb3JyZXNw\nb25kaW5nIAogICAgICogdG8gdGhlIGZpZWxkcyBpbiB0aGUgSWRDbGFzcy4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gdXNlSWRDbGFzc0Zyb21QYXJl\nbnQoKSB7CiAgICAgICAgaWYgKF91c2VJZENsYXNzRnJvbVBhcmVudCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChfb2JqZWN0SWQgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF91c2VJZENsYXNzRnJvbVBhcmVudCA9IGZhbHNlOwog\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBwa3MgPSBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgICAg\nICAgICBpZiAocGtzLmxlbmd0aCAhPSAxKSAKICAgICAgICAgICAgICAgICAg\nICBfdXNlSWRDbGFzc0Zyb21QYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\ncGtNZXRhID0gcGtzWzBdLmdldFR5cGVNZXRhRGF0YSgpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChwa01ldGEgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgX3VzZUlkQ2xhc3NGcm9tUGFyZW50ID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIENsYXNzPD8+IHBrVHlwZSA9IHBrTWV0YS5nZXRPYmplY3RJZFR5cGUoKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBrVHlwZSA9PSBPYmplY3RJ\nZC5jbGFzcykgLy9wYXJlbnQgaWQgaXMgRW1iZWRkZWRJZAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcGtUeXBlID0gcGtNZXRhLmdldFByaW1hcnlL\nZXlGaWVsZHMoKVswXS5nZXRUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChwa1R5cGUgPT0gX29iamVjdElkKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX3VzZUlkQ2xhc3NGcm9tUGFyZW50ID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBGaWVsZCBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQoX29i\namVjdElkLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwa3Nb\nMF0uZ2V0TmFtZSgpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoZiAhPSBudWxsKSAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBfdXNlSWRDbGFzc0Zyb21QYXJlbnQgPSBmYWxzZTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgImludmFsaWQtaWQiLCBfdHlwZSwgcGtzWzBdLmdldE5hbWUoKSkpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfdXNlSWRDbGFzc0Zyb21QYXJlbnQuYm9vbGVhblZh\nbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0\naGlzIGNsYXNzIGhhcyBhIGNvbmNyZXRlIHBlcnNpc3RlbnQgc3VwZXJjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGhhc0NvbmNyZXRlUENT\ndXBlcmNsYXNzKCkgewogICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghTW9kaWZpZXIu\naXNBYnN0cmFjdChfc3VwZXIuZ2V0TW9kaWZpZXJzKCkpICYmIAogICAgICAg\nIAkJKCFnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmlzQWJzdHJhY3QoKSkp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmhhc0NvbmNyZXRlUENTdXBlcmNsYXNz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbnN1cmUgdGhhdCB0aGUgdXNl\nciBoYXMgb3ZlcnJpZGRlbiB0aGUgZXF1YWxzIGFuZCBoYXNoQ29kZSBtZXRo\nb2RzLAogICAgICogYW5kIGhhcyB0aGUgcHJvcGVyIGNvbnN0cnVjdG9ycy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlQXBwSWRDbGFzc01l\ndGhvZHMoQ2xhc3M8Pz4gb2lkKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgb2lkLmdldENvbnN0cnVjdG9yKChDbGFzc1tdKSBudWxsKTsKICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtY29ucyIsIG9p\nZCwgX3R5cGUpKS4KICAgICAgICAgICAgICAgIHNldENhdXNlKGUpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gY2hlY2sgZm9yIGVxdWFscyBhbmQgaGFzaGNv\nZGUgb3ZlcnJpZGVzOyBkb24ndCBlbmZvcmNlIGl0CiAgICAgICAgLy8gZm9y\nIGFic3RyYWN0IGFwcGxpY2F0aW9uIGlkIGNsYXNzZXMsIHNpbmNlIHRoZXkg\nbWF5IG5vdCBuZWNlc3NhcmlseQogICAgICAgIC8vIGRlY2xhcmUgcHJpbWFy\neSBrZXkgZmllbGRzCiAgICAgICAgTWV0aG9kIG1ldGhvZDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBtZXRob2QgPSBvaWQuZ2V0TWV0aG9kKCJlcXVh\nbHMiLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKGUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0K\nCiAgICAgICAgYm9vbGVhbiBhYnMgPSBNb2RpZmllci5pc0Fic3RyYWN0KF90\neXBlLmdldE1vZGlmaWVycygpKTsKICAgICAgICBpZiAoIWFicyAmJiBtZXRo\nb2QuZ2V0RGVjbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nZXEtbWV0aG9kIiwgX3R5cGUpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgbWV0aG9kID0gb2lkLmdldE1ldGhvZCgiaGFzaENvZGUiLCAoQ2xhc3Nb\nXSkgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSkuc2V0RmF0\nYWwodHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlmICghYWJzICYmIG1ldGhv\nZC5nZXREZWNsYXJpbmdDbGFzcygpID09IE9iamVjdC5jbGFzcykKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJo\nYy1tZXRob2QiLCBfdHlwZSkpOwogICAgfQoKICAgIC8qKgogICAgICogVmFs\naWRhdGUgdGhhdCB0aGUgcHJpbWFyeSBrZXkgY2xhc3MgaGFzIGFsbCBwayBm\naWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElk\nQ2xhc3NQS3MoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzLCBDbGFzczw/PiBvaWQpIHsKICAgICAgICBpZiAoZm1k\ncy5sZW5ndGggPT0gMCAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TW9kaWZpZXJzKCkp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLXBrIiwgX3R5cGUpKTsKCiAgICAgICAgLy8gY2hlY2sgdGhh\ndCB0aGUgb2lkIHR5cGUgY29udGFpbnMgYWxsIHBrIGZpZWxkcwogICAgICAg\nIEZpZWxkIGY7CiAgICAgICAgTWV0aG9kIG07CiAgICAgICAgQ2xhc3M8Pz4g\nYzsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlKCkuZ2V0Q29tcG9uZW50VHlwZSgpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChjID09IGJ5dGUuY2xhc3MgfHwgYyA9PSBCeXRlLmNsYXNz\nCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IGMgPT0gY2hhci5jbGFzcyB8\nfCBjID09IENoYXJhY3Rlci5jbGFzcykgewogICAgICAgICAgICAgICAgICAg\nICAgICBjID0gZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuT0lEOiAvLyB3ZSdyZSB2YWxpZGF0aW5nIGVtYmVkZGVkIGZp\nZWxkcwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLXBrLXR5cGUiLAogICAgICAgICAgICAg\nICAgICAgICAgICBmbWRzW2ldKSk7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIGMgPSBmbWRzW2ldLmdldE9iamVjdElk\nRmllbGRUeXBlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChB\nY2Nlc3NDb2RlLmlzRmllbGQoZm1kc1tpXS5nZXRBY2Nlc3NUeXBlKCkpKSB7\nCiAgICAgICAgICAgICAgICBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lk\nLCBmbWRzW2ldLmdldE5hbWUoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\naWYgKGYgPT0gbnVsbCB8fCAhZi5nZXRUeXBlKCkuaXNBc3NpZ25hYmxlRnJv\nbShjKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQtaWQiLAogICAgICAgICAgICAg\nICAgICAgICAgICBfdHlwZSwgZm1kc1tpXS5nZXROYW1lKCkpKTsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChBY2Nlc3NDb2RlLmlzUHJvcGVydHkoZm1kc1tp\nXS5nZXRBY2Nlc3NUeXBlKCkpKSB7CiAgICAgICAgICAgICAgICBtID0gUmVm\nbGVjdGlvbi5maW5kR2V0dGVyKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGlmIChtID09IG51bGwgfHwgIW0uZ2V0\nUmV0dXJuVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oYykpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJpbnZhbGlkLWlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgX3R5cGUs\nIGZtZHNbaV0uZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgICAgICBtID0gUmVm\nbGVjdGlvbi5maW5kU2V0dGVyKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlw\nZSgpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAobSA9PSBudWxsIHx8\nIG0uZ2V0UmV0dXJuVHlwZSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJpbnZhbGlkLWlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgX3R5cGUs\nIGZtZHNbaV0uZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRoaXMgY2xh\nc3MgZG9lc24ndCBkZWNsYXJlIGFueSBwcmltYXJ5IGtleSBmaWVsZHMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZU5vUEtGaWVsZHMoKSB7\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldERlY2xhcmVk\nRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNQcmlt\nYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImJhZC1wayIsIGZpZWxkc1tpXSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhpcyBjbGFzcycgYWNj\nZXNzIHR5cGUgaXMgYWxsb3dlZC4KICAgICAqIElmIG5vIGFjY2VzcyBzdHls\nZSBpcyBzZXQgb3IgYW4gZXhwbGljaXQgc3R5bGUgaXMgc2V0IHJldHVybi4K\nICAgICAqIE90aGVyd2lzZSwgaWYgdGhlIHN1cGVyY2xhc3MgaGFzIHBlcnNp\nc3RlbnQgYXR0cmlidXRlcywgIGNoZWNrIHRoYXQgCiAgICAgKiB0aGUgc3Vw\nZXJjbGFzcyBhY2Nlc3Mgc3R5bGUsIGlmIGRlZmF1bHRlZCwgaXMgdGhlIHNh\nbWUgYXMgdGhhdCBvZiB0aGlzIAogICAgICogcmVjZWl2ZXIuIAogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBY2Nlc3NUeXBlKCkgewogICAg\nICAgIGlmIChBY2Nlc3NDb2RlLmlzRW1wdHkoX2FjY2Vzc1R5cGUpIAogICAg\nICAgICAgIHx8IEFjY2Vzc0NvZGUuaXNFeHBsaWNpdChfYWNjZXNzVHlwZSkp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1\ncCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgd2hpbGUg\nKHN1cCAhPSBudWxsICYmIHN1cC5pc0V4cGxpY2l0QWNjZXNzKCkpCiAgICAg\nICAgCXN1cCA9IHN1cC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0RGVjbGFyZWRGaWVsZHMo\nKS5sZW5ndGggPiAwKSB7CiAgICAgICAgCWludCBzdXBDb2RlID0gc3VwLmdl\ndEFjY2Vzc1R5cGUoKTsKICAgICAgICAJaWYgKCFBY2Nlc3NDb2RlLmlzQ29t\ncGF0aWJsZVN1cGVyKF9hY2Nlc3NUeXBlLCBzdXBDb2RlKSkKICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYWNj\nZXNzLWluY29uc2lzdGVudC1pbmhlcml0IiwKICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXt0aGlzLCBBY2Nlc3NDb2RlLnRvQ2xhc3NTdHJpbmcoX2FjY2Vz\nc1R5cGUpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICBzdXAsIEFjY2Vz\nc0NvZGUudG9DbGFzc1N0cmluZyhzdXBDb2RlKX0pLnRvU3RyaW5nKCkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IGRl\ndGFjaG1lbnQgY29uZmlndXJhdGlvbiBpcyB2YWxpZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHZhbGlkYXRlRGV0YWNoYWJsZSgpIHsKICAgICAgICBi\nb29sZWFuIGZpcnN0ID0gdHJ1ZTsKICAgICAgICBmb3IgKENsYXNzTWV0YURh\ndGEgcGFyZW50ID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAg\nICAgICAgZmlyc3QgJiYgcGFyZW50ICE9IG51bGw7IHBhcmVudCA9IHBhcmVu\ndC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKQogICAgICAgIHsKICAgICAg\nICAgICAgaWYgKHBhcmVudC5pc0RldGFjaGFibGUoKSkKICAgICAgICAgICAg\nICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBGaWVsZCBm\naWVsZCA9IGdldERldGFjaGVkU3RhdGVGaWVsZCgpOwogICAgICAgIGlmIChm\naWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmICghZmlyc3QpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoInBhcmVudC1kZXRhY2gtc3RhdGUiLAogICAgICAgICAgICAgICAgICAg\nIF90eXBlKSk7CiAgICAgICAgICAgIGlmIChnZXRGaWVsZChmaWVsZC5nZXRO\nYW1lKCkpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm1hbmFnZWQtZGV0YWNoLXN0YXRl\nIiwKICAgICAgICAgICAgICAgICAgICBmaWVsZC5nZXROYW1lKCksIF90eXBl\nKSk7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRUeXBlKCkgIT0gT2JqZWN0\nLmNsYXNzKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAg\nICAgICAgICAgICBmaWVsZC5nZXROYW1lKCksIF90eXBlKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8gRmV0Y2ggR3Jv\ndXAKICAgIC8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBmZXRjaCBncm91cHMgZGVjbGFyZWQgZXhwbGljaXRseSBpbiB0aGlz\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3VwW10gZ2V0RGVj\nbGFyZWRGZXRjaEdyb3VwcygpIHsKICAgICAgICBpZiAoX2ZncyA9PSBudWxs\nKQogICAgICAgICAgICBfZmdzID0gKF9mZ01hcCA9PSBudWxsKSA/IEVNUFRZ\nX0ZFVENIX0dST1VQX0FSUkFZIDogKEZldGNoR3JvdXBbXSkKICAgICAgICAg\nICAgICAgIF9mZ01hcC52YWx1ZXMoKS50b0FycmF5KG5ldyBGZXRjaEdyb3Vw\nW19mZ01hcC5zaXplKCldKTsgCiAgICAgICAgcmV0dXJuIF9mZ3M7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGZldGNoIGdyb3VwcyBmb3Ig\ndGhpcyB0eXBlLCBpbmNsdWRpbmcgc3VwZXJjbGFzcyBncm91cHMuCiAgICAg\nKi8KICAgIHB1YmxpYyBGZXRjaEdyb3VwW10gZ2V0Q3VzdG9tRmV0Y2hHcm91\ncHMoKSB7CiAgICAgICAgaWYgKF9jdXN0b21GR3MgPT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBtYXAgZmV0Y2ggZ3JvdXBzIHRvIG5hbWVzLCBhbGxvd2lu\nZyBvdXIgZ3JvdXBzIHRvIG92ZXJyaWRlIHN1cGVyCiAgICAgICAgICAgIE1h\ncDxTdHJpbmcsRmV0Y2hHcm91cD4gZmdzID0gbmV3IEhhc2hNYXA8U3RyaW5n\nLEZldGNoR3JvdXA+KCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3Vw\nID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYg\nKHN1cCAhPSBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBG\nZXRjaEdyb3VwW10gc3VwRkdzID0gc3VwLmdldEN1c3RvbUZldGNoR3JvdXBz\nKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1cEZH\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBmZ3MucHV0KHN1\ncEZHc1tpXS5nZXROYW1lKCksIHN1cEZHc1tpXSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgRmV0Y2hHcm91cFtdIGRlY3MgPSBnZXREZWNsYXJlZEZl\ndGNoR3JvdXBzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZGVjcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZncy5wdXQoZGVj\nc1tpXS5nZXROYW1lKCksIGRlY3NbaV0pOwogICAgICAgICAgICAKICAgICAg\nICAgICAgLy8gcmVtb3ZlIHN0YW5kYXJkIGdyb3VwcwogICAgICAgICAgICBm\nZ3MucmVtb3ZlKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxUKTsKICAgICAgICAg\nICAgZmdzLnJlbW92ZShGZXRjaEdyb3VwLk5BTUVfQUxMKTsKCiAgICAgICAg\nICAgIF9jdXN0b21GR3MgPSAoRmV0Y2hHcm91cFtdKSBmZ3MudmFsdWVzKCku\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBGZXRjaEdyb3VwW2Zncy5z\naXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jdXN0b21GR3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIGEgbmFtZWQgZmV0Y2ggZ3Jv\ndXAuIElmIG5vdCBhdmFpbGFibGUgaW4gdGhpcyByZWNlaXZlciB0aGVuIGxv\nb2tzCiAgICAgKiB1cCB0aGUgaW5oZXJpdGFuY2UgaGllcmFyY2h5LiAKICAg\nICAqCiAgICAgKiBAcGFyYW0gbmFtZSBuYW1lIG9mIGEgZmV0Y2ggZ3JvdXAu\nCiAgICAgKiBAcmV0dXJuIGFuIGV4aXN0aW5nIGZldGNoIGdyb3VwIG9mIHRo\nZSBnaXZlbiBuYW1lIGlmIGtub3duIHRvIHRoaXMgCiAgICAgKiByZWNlaXZl\nciBvciBhbnkgb2YgaXRzIHN1cGVyY2xhc3Nlcy4gT3RoZXJ3aXNlIG51bGwu\nCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3VwIGdldEZldGNoR3JvdXAo\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gKF9mZ01h\ncCA9PSBudWxsKSA/IG51bGwgOiAoRmV0Y2hHcm91cCkgX2ZnTWFwLmdldChu\nYW1lKTsKICAgICAgICBpZiAoZmcgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGZnOwogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBzdXAuZ2V0RmV0Y2hHcm91cChuYW1lKTsKICAg\nICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQuZXF1YWxzKG5hbWUp\nKQogICAgICAgICAgICByZXR1cm4gRmV0Y2hHcm91cC5ERUZBVUxUOwogICAg\nICAgIGlmIChGZXRjaEdyb3VwLk5BTUVfQUxMLmVxdWFscyhuYW1lKSkKICAg\nICAgICAgICAgcmV0dXJuIEZldGNoR3JvdXAuQUxMOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBmZXRjaCBncm91\ncCBvZiB0aGUgZ2l2ZW4gbmFtZSwgb3IgcmV0dXJucyBleGlzdGluZyBpbnN0\nYW5jZS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSBhIG5vbi1udWxsLCBu\nb24tZW1wdHkgbmFtZS4gTXVzdCBiZSB1bmlxdWUgd2l0aGluIHRoaXMKICAg\nICAqIHJlY2VpdmVyJ3Mgc2NvcGUuIFRoZSBzdXBlciBjbGFzcyA8ZW0+bWF5\nPC9lbT4gaGF2ZSBhIGdyb3VwIHdpdGgKICAgICAqIHRoZSBzYW1lIG5hbWUu\nCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3VwIGFkZERlY2xhcmVkRmV0\nY2hHcm91cChTdHJpbmcgbmFtZSkgewogICAgCWlmIChTdHJpbmdVdGlscy5p\nc0VtcHR5KG5hbWUpKQogICAgCQl0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImVtcHR5LWZnLW5hbWUiLCB0aGlzKSk7CiAgICAgICAg\naWYgKF9mZ01hcCA9PSBudWxsKQogICAgICAgICAgICBfZmdNYXAgPSBuZXcg\nSGFzaE1hcDxTdHJpbmcsRmV0Y2hHcm91cD4oKTsKICAgICAgICBGZXRjaEdy\nb3VwIGZnID0gKEZldGNoR3JvdXApIF9mZ01hcC5nZXQobmFtZSk7CiAgICAg\nICAgaWYgKGZnID09IG51bGwpIHsKICAgICAgICAJZmcgPSBuZXcgRmV0Y2hH\ncm91cCh0aGlzLCBuYW1lKTsKICAgICAgICAJX2ZnTWFwLnB1dChuYW1lLCBm\nZyk7CiAgICAgICAgICAgIF9mZ3MgPSBudWxsOwogICAgICAgICAgICBfY3Vz\ndG9tRkdzID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZnOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgZGVjbGFyZWQgZmV0Y2gg\nZ3JvdXAuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURlY2xh\ncmVkRmV0Y2hHcm91cChGZXRjaEdyb3VwIGZnKSB7CiAgICAgICAgaWYgKGZn\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBp\nZiAoX2ZnTWFwLnJlbW92ZShmZy5nZXROYW1lKCkpICE9IG51bGwpIHsKICAg\nICAgICAgICAgX2ZncyA9IG51bGw7CiAgICAgICAgICAgIF9jdXN0b21GR3Mg\nPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBTb3VyY2VUcmFja2VyCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9zcmNGaWxlOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0\nU291cmNlU2NvcGUoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgcHVibGljIGludCBnZXRTb3VyY2VUeXBlKCkgewogICAgICAgIHJldHVy\nbiBfc3JjVHlwZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2Uo\nRmlsZSBmaWxlLCBpbnQgc3JjVHlwZSkgewogICAgICAgIF9zcmNGaWxlID0g\nZmlsZTsKICAgICAgICBfc3JjVHlwZSA9IHNyY1R5cGU7CiAgICB9CgogICAg\ncHVibGljIFN0cmluZyBnZXRSZXNvdXJjZU5hbWUoKSB7CiAgICAgICAgcmV0\ndXJuIF90eXBlLmdldE5hbWUoKTsKICAgIH0KICAgIAogICAgcHVibGljIGlu\ndCBnZXRMaW5lTnVtYmVyKCkgewogICAgICAgIHJldHVybiBfbGluZU51bTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMaW5lTnVtYmVyKGludCBsaW5l\nTnVtKSB7CiAgICAgICAgX2xpbmVOdW0gPSBsaW5lTnVtOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0Q29sTnVtYmVyKCkgewogICAgICAgIHJldHVybiBf\nY29sTnVtOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbE51bWJlcihp\nbnQgY29sTnVtKSB7CiAgICAgICAgX2NvbE51bSA9IGNvbE51bTsKICAgIH0K\nICAgIAoKICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIHRoaXMgbWV0\nYWRhdGEgaGFzIGJlZW4gbG9hZGVkIHVuZGVyLgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9zcmNN\nb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIHRo\naXMgbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVkIHVuZGVyLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlKSB7CiAgICAg\nICAgX3NyY01vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIHNvdXJjZSBtb2RlIHRoaXMgbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVkIHVu\nZGVyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGlu\ndCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9E\nRV9OT05FKQogICAgICAgICAgICBfc3JjTW9kZSA9IG1vZGU7CiAgICAgICAg\nZWxzZSBpZiAob24pCiAgICAgICAgICAgIF9zcmNNb2RlIHw9IG1vZGU7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfc3JjTW9kZSAmPSB+bW9kZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBpbiB3aGljaCB0aGlzIGNs\nYXNzIHdhcyBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLiBEZWZhdWx0cyB0bwog\nICAgICogPGNvZGU+LTE8L2NvZGU+IGlmIHRoaXMgY2xhc3Mgd2FzIG5vdCBs\naXN0ZWQgaW4gdGhlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldExpc3RpbmdJbmRleCgpIHsKICAgICAgICByZXR1cm4gX2xpc3RJbmRl\neDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBpbiB3aGljaCB0\naGlzIGZpZWxkIHdhcyBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLiBEZWZhdWx0\ncyB0bwogICAgICogPGNvZGU+LTE8L2NvZGU+IGlmIHRoaXMgY2xhc3Mgd2Fz\nIG5vdCBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRMaXN0aW5nSW5kZXgoaW50IGluZGV4KSB7CiAgICAgICAg\nX2xpc3RJbmRleCA9IGluZGV4OwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gQ29tbWVudGFibGUKICAgIC8vLy8vLy8vLy8vLy8vLwoKICAg\nIHB1YmxpYyBTdHJpbmdbXSBnZXRDb21tZW50cygpIHsKICAgICAgICByZXR1\ncm4gKF9jb21tZW50cyA9PSBudWxsKSA/IEVNUFRZX0NPTU1FTlRTIDogX2Nv\nbW1lbnRzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbW1lbnRzKFN0\ncmluZ1tdIGNvbW1lbnRzKSB7CiAgICAgICAgX2NvbW1lbnRzID0gY29tbWVu\ndHM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8KICAgIC8vIFN0YXRlIGNv\ncHkKICAgIC8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBDb3B5IHRo\nZSBtZXRhZGF0YSBmcm9tIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGlzIG9u\nZS4gRG8gbm90CiAgICAgKiBjb3B5IG1hcHBpbmcgaW5mb3JtYXRpb24uCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvcHkoQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpICE9IF90\neXBlKQogICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24o\nKTsKICAgICAgICBzdXBlci5jb3B5KG1ldGEpOwoKICAgICAgICAvLyBjb3B5\nIGNsYXNzLWxldmVsIGluZm87IHVzZSBnZXQgbWV0aG9kcyB0byBmb3JjZSBy\nZXNvbHV0aW9uIG9mCiAgICAgICAgLy8gbGF6eSBkYXRhCiAgICAgICAgX3N1\ncGVyID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKTsKICAgICAgICBfb2JqZWN0\nSWQgPSBtZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIF9leHRlbnQg\nPSAobWV0YS5nZXRSZXF1aXJlc0V4dGVudCgpKSA/IEJvb2xlYW4uVFJVRSA6\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgX2VtYmVkZGVkID0gKG1ldGEuaXNF\nbWJlZGRlZE9ubHkoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgIF9lbWJlZGRhYmxlID0gbWV0YS5fZW1iZWRkYWJsZTsKICAg\nICAgICBfaW50ZXJmYWNlID0gKG1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkp\nID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBzZXRJ\nbnRlcmNlcHRpbmcobWV0YS5pc0ludGVyY2VwdGluZygpKTsKICAgICAgICBf\naW1wbCA9IG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIF9pZGVu\ndGl0eSA9IG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgX2lkU3Ry\nYXRlZ3kgPSBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBf\nc2VxTmFtZSA9IG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAg\nICAgICBfc2VxTWV0YSA9IG51bGw7CiAgICAgICAgX2FsaWFzID0gbWV0YS5n\nZXRUeXBlQWxpYXMoKTsKICAgICAgICBfYWNjZXNzVHlwZSA9IG1ldGEuZ2V0\nQWNjZXNzVHlwZSgpOwoKICAgICAgICAvLyBvbmx5IGNvcHkgdGhpcyBpbmZv\ncm1hdGlvbiBpZiBpdCB3YXNuJ3Qgc2V0IGV4cGxpY2l0bHkgZm9yIHRoaXMK\nICAgICAgICAvLyBpbnN0YW5jZQogICAgICAgIGlmIChERUZBVUxUX1NUUklO\nRy5lcXVhbHMoX2NhY2hlTmFtZSkpCiAgICAgICAgICAgIF9jYWNoZU5hbWUg\nPSBtZXRhLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAoX2NhY2hl\nVGltZW91dCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkKICAgICAgICAgICAgX2Nh\nY2hlVGltZW91dCA9IG1ldGEuZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAg\nICAgIF9jYWNoZUVuYWJsZWQgPSBtZXRhLmdldENhY2hlRW5hYmxlZCgpOwog\nICAgICAgIGlmIChfZGV0YWNoYWJsZSA9PSBudWxsKQogICAgICAgICAgICBf\nZGV0YWNoYWJsZSA9IG1ldGEuX2RldGFjaGFibGU7CiAgICAgICAgaWYgKERF\nRkFVTFRfU1RSSU5HLmVxdWFscyhfZGV0YWNoU3RhdGUpKQogICAgICAgICAg\nICBfZGV0YWNoU3RhdGUgPSBtZXRhLmdldERldGFjaGVkU3RhdGUoKTsKCiAg\nICAgICAgLy8gc3luY2ggZmllbGQgaW5mb3JtYXRpb247IGZpcnN0IHJlbW92\nZSBleHRyYSBmaWVsZHMKICAgICAgICBjbGVhckZpZWxkQ2FjaGUoKTsKICAg\nICAgICBfZmllbGRNYXAua2V5U2V0KCkucmV0YWluQWxsKG1ldGEuX2ZpZWxk\nTWFwLmtleVNldCgpKTsKCiAgICAgICAgLy8gYWRkIGNvcGllcyBvZiBkZWNs\nYXJlZCBmaWVsZHM7IG90aGVyIGRlZmluZWQgZmllbGRzIGFscmVhZHkgY29w\naWVkCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEuZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxk\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGZpZWxkID0gZ2V0RGVjbGFyZWRGaWVsZChm\naWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgaWYgKGZpZWxkID09\nIG51bGwpCiAgICAgICAgICAgICAgICBmaWVsZCA9IGFkZERlY2xhcmVkRmll\nbGQoZmllbGRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBm\naWVsZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBmaWVs\nZC5zZXREZWNsYXJlZEluZGV4KC0xKTsKICAgICAgICAgICAgZmllbGQuc2V0\nSW5kZXgoLTEpOwogICAgICAgICAgICBmaWVsZC5jb3B5KGZpZWxkc1tpXSk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBjb3B5IGZldGNoIGdyb3VwcwogICAg\nICAgIEZldGNoR3JvdXBbXSBmZ3MgPSBtZXRhLmdldERlY2xhcmVkRmV0Y2hH\ncm91cHMoKTsKICAgICAgICBGZXRjaEdyb3VwIGZnOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGZnID0gYWRkRGVjbGFyZWRGZXRjaEdyb3VwKGZnc1tpXS5nZXROYW1lKCkp\nOwogICAgICAgICAgICBmZy5jb3B5KGZnc1tpXSk7IAogICAgICAgIH0KCiAg\nICAgICAgLy8gY29weSBpbnRlcmZhY2UgcmUtbWFwcGluZwogICAgICAgIF9p\nZmFjZU1hcC5jbGVhcigpOwogICAgICAgIF9pZmFjZU1hcC5wdXRBbGwobWV0\nYS5faWZhY2VNYXApOwogICAgfQoKICAgIC8qKgogICAgICogUmVjdXJzaXZl\nIGhlbHBlciB0byBjb3B5IGVtYmVkZGVkIG1ldGFkYXRhLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyB2b2lkIGNvcHkoQ2xhc3NNZXRhRGF0YSBlbWJl\nZCwgQ2xhc3NNZXRhRGF0YSBkZWMpIHsKICAgICAgICBDbGFzc01ldGFEYXRh\nIHN1cCA9IGRlYy5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAg\nIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAgICAgICBlbWJlZC5zZXRQQ1N1\ncGVyY2xhc3Moc3VwLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAg\nIGNvcHkoZW1iZWQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSwgc3VwKTsK\nICAgICAgICB9CiAgICAgICAgZW1iZWQuY29weShkZWMpOwogICAgfQoKICAg\nIHByb3RlY3RlZCB2b2lkIGFkZEV4dGVuc2lvbktleXMoQ29sbGVjdGlvbiBl\neHRzKSB7CiAgICAgICAgX3JlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpLmFk\nZENsYXNzRXh0ZW5zaW9uS2V5cyhleHRzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbXBhcmF0b3IgdXNlZCB0byBwdXQgZmllbGQgbWV0YWRhdGEgaW50\nbyBsaXN0aW5nIG9yZGVyLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBMaXN0aW5nT3JkZXJDb21wYXJhdG9yCiAgICAgICAgaW1wbGVtZW50\ncyBDb21wYXJhdG9yPEZpZWxkTWV0YURhdGE+IHsKCiAgICAgICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTGlzdGluZ09yZGVyQ29tcGFyYXRvciBfaW5zdGFu\nY2UKICAgICAgICAgICAgPSBuZXcgTGlzdGluZ09yZGVyQ29tcGFyYXRvcigp\nOwoKICAgICAgICAvKioKICAgICAgICAgKiBBY2Nlc3Mgc2luZ2xldG9uIGlu\nc3RhbmNlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBzdGF0aWMgTGlz\ndGluZ09yZGVyQ29tcGFyYXRvciBnZXRJbnN0YW5jZSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9pbnN0YW5jZTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBpbnQgY29tcGFyZShGaWVsZE1ldGFEYXRhIGYxLCBGaWVsZE1ldGFEYXRh\nIGYyKSB7CiAgICAgICAgICAgIGlmIChmMSA9PSBmMikKICAgICAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgICAgICBpZiAoZjEgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICBpZiAoZjIgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgICAg\nIGlmIChmMS5nZXRMaXN0aW5nSW5kZXgoKSA9PSBmMi5nZXRMaXN0aW5nSW5k\nZXgoKSkgewogICAgICAgICAgICAgICAgaWYgKGYxLmdldEluZGV4KCkgPT0g\nZjIuZ2V0SW5kZXgoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZjEu\nZ2V0RnVsbE5hbWUoZmFsc2UpLmNvbXBhcmVUbwogICAgICAgICAgICAgICAg\nICAgICAgICAoZjIuZ2V0RnVsbE5hbWUoZmFsc2UpKTsKCQkJCWlmIChmMS5n\nZXRJbmRleCAoKSA9PSAtMSkKCQkJCQlyZXR1cm4gMTsKCQkJCWlmIChmMi5n\nZXRJbmRleCAoKSA9PSAtMSkKCQkJCQlyZXR1cm4gLTE7CgkJCQlyZXR1cm4g\nZjEuZ2V0SW5kZXggKCkgLSBmMi5nZXRJbmRleCAoKTsKCQkJfQkKCQkJaWYg\nKGYxLmdldExpc3RpbmdJbmRleCAoKSA9PSAtMSkKCQkJCXJldHVybiAxOwoJ\nCQlpZiAoZjIuZ2V0TGlzdGluZ0luZGV4ICgpID09IC0xKQoJCQkJcmV0dXJu\nIC0xOwoJCQlyZXR1cm4gZjEuZ2V0TGlzdGluZ0luZGV4ICgpIC0gZjIuZ2V0\nTGlzdGluZ0luZGV4ICgpOwoJCX0KCX0KICAgIAogICAgcHVibGljIHZvaWQg\ncmVnaXN0ZXJGb3JWYWx1ZVVwZGF0ZShTdHJpbmcuLi52YWx1ZXMpIHsKICAg\nIAlpZiAodmFsdWVzID09IG51bGwpCiAgICAJCXJldHVybjsKICAgIAlmb3Ig\nKFN0cmluZyBrZXkgOiB2YWx1ZXMpIHsKICAgIAkJVmFsdWUgdmFsdWUgPSBn\nZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpCiAgICAJCQkuZ2V0\nVmFsdWUoa2V5KTsKICAgIAkJaWYgKHZhbHVlICE9IG51bGwpCiAgICAJCQl2\nYWx1ZS5hZGRMaXN0ZW5lcih0aGlzKTsKICAgIAl9CiAgICB9CiAgICAKICAg\nIHB1YmxpYyB2b2lkIHZhbHVlQ2hhbmdlZChWYWx1ZSB2YWwpIHsKICAgIAlp\nZiAodmFsICE9IG51bGwgJiYgdmFsLm1hdGNoZXMoIkRhdGFDYWNoZVRpbWVv\ndXQiKSkgewogICAgCQlfY2FjaGVUaW1lb3V0ID0gSW50ZWdlci5NSU5fVkFM\nVUU7CiAgICAJfQogICAgfQogICAgCiAgICAvKioKICAgICAqIFV0aWxpdHkg\nbWV0aG9kIHRvIGdldCBuYW1lcyBvZiBhbGwgZmllbGRzIGluY2x1ZGluZyB0\naGUgc3VwZXJjbGFzc2VzJwogICAgICogc29ydGVkIGluIGxleGljYWwgb3Jk\nZXIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRGaWVsZE5hbWVz\nKCkgewogICAgCXJldHVybiB0b05hbWVzKGdldEZpZWxkcygpKTsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBVdGlsaXR5IG1ldGhvZCB0byBnZXQgbmFt\nZXMgb2YgYWxsIGRlY2xhcmVkIGZpZWxkcyBleGNsdWRpbmcgdGhlIAogICAg\nICogc3VwZXJjbGFzc2VzJyBzb3J0ZWQgaW4gbGV4aWNhbCBvcmRlci4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERlY2xhcmVkRmllbGROYW1l\ncygpIHsKICAgIAlyZXR1cm4gdG9OYW1lcyhnZXREZWNsYXJlZEZpZWxkcygp\nKTsKICAgIH0KICAgIAogICAgU3RyaW5nW10gdG9OYW1lcyhGaWVsZE1ldGFE\nYXRhW10gZmllbGRzKSB7CiAgICAJTGlzdDxTdHJpbmc+IHJlc3VsdCA9IG5l\ndyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgCWZvciAoRmllbGRNZXRhRGF0\nYSBmbWQgOiBmaWVsZHMpIHsKICAgIAkJcmVzdWx0LmFkZChmbWQuZ2V0TmFt\nZSgpKTsKICAgIAl9CiAgICAJQ29sbGVjdGlvbnMuc29ydChyZXN1bHQpOwog\nICAgCXJldHVybiByZXN1bHQudG9BcnJheShuZXcgU3RyaW5nW3Jlc3VsdC5z\naXplKCldKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIHRo\nZSBwZXJzaXN0ZW5jZSBpbnN0YW5jZXMgb2YgdGhpcyByZWNlaXZlciBpcyBy\nZXBsaWNhdGVkIGFjcm9zcwogICAgICogbXVsdGlwbGUgZGF0YWJhc2VzLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1JlcGxpY2F0ZWQoKSB7CiAg\nICAJcmV0dXJuIF9yZXBsaWNhdGVkOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFNldHMgdGhlIHBlcnNpc3RlbmNlIGluc3RhbmNlcyBvZiB0aGlzIHJl\nY2VpdmVyIHRvIGJlIHJlcGxpY2F0ZWQgYWNyb3NzCiAgICAgKiBtdWx0aXBs\nZSBkYXRhYmFzZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcGxp\nY2F0ZWQoYm9vbGVhbiBmbGFnKSB7CiAgICAJX3JlcGxpY2F0ZWQgPSBmbGFn\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzQWJzdHJhY3QoKSB7CiAg\nICAgICAgcmV0dXJuIF9hYnN0cmFjdDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRBYnN0cmFjdChib29sZWFuIGZsYWcpIHsKICAgICAgICBfYWJzdHJh\nY3QgPSBmbGFnOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIGRldGVybWluZSBpZiB0aGUgcGNUeXBlIG1vZGVsZWQgYnkK\nICAgICAqIHRoaXMgQ2xhc3NNZXRhRGF0YSBvYmplY3QgaXMgYm90aCBhYnN0\ncmFjdCBhbmQgZGVjbGFyZXMgUEtGaWVsZHMuIFRoaXMKICAgICAqIG1ldGhv\nZCBpcyB1c2VkIGJ5IHRoZSBQQ0VuaGFuY2VyIHRvIGRldGVybWluZSBpZiBz\ncGVjaWFsIGhhbmRsaW5nIGlzCiAgICAgKiByZXF1aXJlZC4KICAgICAqCiAg\nICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGhhc0Fi\nc3RyYWN0UEtGaWVsZCgpIHsKICAgICAgICBpZiAoX2hhc0Fic3RyYWN0UEtG\naWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBfaGFzQWJzdHJh\nY3RQS0ZpZWxkLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gRGVmYXVsdCB0byBmYWxzZSwgc2V0IHRvIHRydWUgb25seSBpZiB0aGlz\nIHR5cGUgaXMgYWJzdHJhY3QgYW5kCiAgICAgICAgLy8gZGVjbGFyZXMgYSBQ\nS0ZpZWxkLgogICAgICAgIF9oYXNBYnN0cmFjdFBLRmllbGQgPSBCb29sZWFu\nLkZBTFNFOwoKICAgICAgICBpZiAoaXNBYnN0cmFjdCgpID09IHRydWUpIHsK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRlY2xhcmVkRmllbGRzID0g\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgaWYgKGRlY2xhcmVk\nRmllbGRzICE9IG51bGwgJiYgZGVjbGFyZWRGaWVsZHMubGVuZ3RoICE9IDAp\nIHsKICAgICAgICAgICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBk\nZWNsYXJlZEZpZWxkcykgewogICAgICAgICAgICAgICAgICAgIGlmIChmbWQu\naXNQcmltYXJ5S2V5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2hh\nc0Fic3RyYWN0UEtGaWVsZCA9IEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gX2hhc0Fic3RyYWN0UEtGaWVsZC5ib29sZWFuVmFsdWUoKTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2Qg\ndG8gZGV0ZXJtaW5lIGlmIHRoaXMgdHlwZSBpcyBhIGRpcmVjdAogICAgICog\nZGVjZW5kZW50IG9mIGFuIGFic3RyYWN0IHR5cGUgZGVjbGFyaW5nIFBLRmll\nbGRzLiBSZXR1cm5zIHRydWUgaWYgdGhlcmUKICAgICAqIGFyZSBubyBwY1R5\ncGVzIG1hcHBlZCB0byBhIHRhYmxlIGJldHdlZW4gdGhpcyB0eXBlIGFuZCBh\nbiBhYnN0cmFjdCBwY1R5cGUKICAgICAqIGRlY2xhcmluZyBQS0ZpZWxkcy4g\nUmV0dXJucyBmYWxzZSBpZiB0aGVyZSBubyBzdWNoIGFic3RyYWN0IHBjVHlw\nZXMgaW4KICAgICAqIHRoZSBpbmhlcml0YW5jZSBoaWVyYXJjaHkgb3IgaWYg\ndGhlcmUgYXJlIGFueSBwY1R5cGVzIG1hcHBlZCB0byB0YWJsZXMgaW4KICAg\nICAqIGJldHdlZW4gdGhlIHR5cGUgcmVwcmVzZW50ZWQgYnkgdGhpcyBDbGFz\nc01ldGFEYXRhIG9iamVjdCBhbmQgdGhlCiAgICAgKiBhYnN0cmFjdCBwY1R5\ncGUgZGVjbGFyaW5nIFBLRmllbGRzLgogICAgICoKICAgICAqIEByZXR1cm4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaGFzUEtGaWVsZHNGcm9tQWJz\ndHJhY3RDbGFzcygpIHsKICAgICAgICBpZiAoX2hhc1BLRmllbGRzRnJvbUFi\nc3RyYWN0Q2xhc3MgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gX2hh\nc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3MuYm9vbGVhblZhbHVlKCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBEZWZhdWx0IHRvIEZBTFNFLCB1bnRpbCBw\ncm92ZW4gdHJ1ZS4KICAgICAgICBfaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RD\nbGFzcyA9IEJvb2xlYW4uRkFMU0U7CgogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBwa0ZpZWxkcyA9IGdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBm\nb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogcGtGaWVsZHMpIHsKICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBmbWRETURBID0gZm1kLmdldERlY2xhcmluZ01l\ndGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChmbWRETURBLmlzQWJzdHJhY3Qo\nKSkgewogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgd2hpbGUg\nKGNtZCAhPSBmbWRETURBKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZt\nZERNREEuaXNBYnN0cmFjdCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNtZCA9IGNtZC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGlmIChjbWQgPT0gZm1kRE1EQSkgewogICAg\nICAgICAgICAgICAgICAgIF9oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNz\nID0gQm9vbGVhbi5UUlVFOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICByZXR1cm4gX2hhc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3MuYm9v\nbGVhblZhbHVlKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB0\naGUgZWxpZ2liaWxpdHkgc3RhdHVzIG9mIHRoaXMgY2xhc3MgZm9yIGNhY2hl\nLgogICAgICogCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENhY2hlRW5h\nYmxlZChib29sZWFuIGVuYWJsZWQpIHsgCiAgICAgICAgX2NhY2hlRW5hYmxl\nZCA9IGVuYWJsZWQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJu\ncyB0cmktc3RhdGUgc3RhdHVzIG9uIHdoZXRoZXIgdGhpcyBjbGFzcyBoYXMg\nYmVlbiBlbmFibGVkIGZvciBjYWNoaW5nLgogICAgICogCiAgICAgKiBAcmV0\ndXJuIFRSVUUgb3IgRkFMU0UgZGVub3RlIHRoaXMgY2xhc3MgaGFzIGJlZW4g\nZXhwbGljaXRseSBlbmFibGVkIG9yIGRpc2FibGVkIGZvciBjYWNoaW5nLgog\nICAgICogSWYgbm8gc3RhdHVzIGhhcyBiZWVuIGV4cGxpY2l0bHkgc2V0LCB0\naGVuIHRoZSBzdGF0dXMgb2YgdGhlIHBlcnNpc3RlbnQgc3VwZXIgY2xhc3Ms\nIGlmIGFueSwgaXMgcmV0dXJuZWQuIAogICAgICovCiAgICBwdWJsaWMgQm9v\nbGVhbiBnZXRDYWNoZUVuYWJsZWQoKSB7IAogICAgICAgIGlmIChfY2FjaGVF\nbmFibGVkICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FjaGVFbmFi\nbGVkOwogICAgICAgIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nICE9IG51bGwgPyAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRDYWNo\nZUVuYWJsZWQoKSA6IG51bGw7IAogICAgfQp9Cgo=\n","encoding":"base64"}

