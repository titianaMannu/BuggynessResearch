{"sha":"e67fe41659919597d59b1d49fcfc2bd2762048d3","node_id":"MDQ6QmxvYjIwNjM2NDplNjdmZTQxNjU5OTE5NTk3ZDU5YjFkNDlmY2ZjMmJkMjc2MjA0OGQz","size":37390,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e67fe41659919597d59b1d49fcfc2bd2762048d3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmY7CgppbXBvcnQg\namF2YS5hd3QuKjsKaW1wb3J0IGphdmEuYmVhbnMuQmVhbkRlc2NyaXB0b3I7\nCmltcG9ydCBqYXZhLmJlYW5zLkJlYW5JbmZvOwppbXBvcnQgamF2YS5iZWFu\ncy5FdmVudFNldERlc2NyaXB0b3I7CmltcG9ydCBqYXZhLmJlYW5zLkludHJv\nc3BlY3Rpb25FeGNlcHRpb247CmltcG9ydCBqYXZhLmJlYW5zLkludHJvc3Bl\nY3RvcjsKaW1wb3J0IGphdmEuYmVhbnMuTWV0aG9kRGVzY3JpcHRvcjsKaW1w\nb3J0IGphdmEuYmVhbnMuUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcjsKaW1wb3J0\nIGphdmEuYmVhbnMuUHJvcGVydHlDaGFuZ2VTdXBwb3J0OwppbXBvcnQgamF2\nYS5iZWFucy5Qcm9wZXJ0eURlc2NyaXB0b3I7CmltcG9ydCBqYXZhLmlvLkV4\ndGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2\nYS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXQ7\nCmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEuaW8u\nUHJpbnRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1w\nb3J0IGphdmEuaW8uU3RyaW5nV3JpdGVyOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5J\nbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLkxpbmtlZEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuTWlz\nc2luZ1Jlc291cmNlRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLlByb3Bl\ncnRpZXM7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGls\nLlRyZWVNYXA7CmltcG9ydCBqYXZhLnV0aWwuVHJlZVNldDsKCmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZ0ZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2dGYWN0b3J5SW1wbDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLk5vbmVMb2dGYWN0b3J5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3NlYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTXVsdGlD\nbGFzc0xvYWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5QYXJzZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5TZXJ2aWNlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5TdHJpbmdEaXN0YW5jZTsKaW1wb3J0IHNlcnAudXRpbC5TdHJp\nbmdzOwoKLyoqCiAqIERlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIHtA\nbGluayBDb25maWd1cmF0aW9ufSBpbnRlcmZhY2UuCiAqIFN1YmNsYXNzZXMg\nY2FuIGNob29zZSB0byBvYnRhaW4gY29uZmlndXJhdGlvbgogKiBpbmZvcm1h\ndGlvbiBmcm9tIEpOREksIFByb3BlcnRpZXMsIGEgQmVhbi1idWlsZGVyLCBl\ndGMuIFRoaXMgY2xhc3MKICogcHJvdmlkZXMgYmFzZSBjb25maWd1cmF0aW9u\nIGZ1bmN0aW9uYWxpdHksIGluY2x1ZGluZyBzZXJpYWxpemF0aW9uLAogKiB0\naGUgPGNvZGU+ZXF1YWxzPC9jb2RlPiBhbmQgPGNvZGU+aGFzaENvZGU8L2Nv\nZGU+IGNvbnRyYWN0cywgYW5kIGRlZmF1bHQKICogcHJvcGVydHkgbG9hZGlu\nZy4KICogUHJvcGVydHkgZGVzY3JpcHRvcnMgZm9yIHtAbGluayBWYWx1ZX0g\naW5zdGFuY2VzIGFyZSBjb25zdHJ1Y3RlZCBmcm9tCiAqIHRoZSB7QGxpbmsg\nTG9jYWxpemVyfSBmb3IgdGhlIHBhY2thZ2Ugb2YgdGhlIGNvbmZpZ3VyYXRp\nb24gY2xhc3MuIFRoZQogKiBmb2xsb3dpbmcgbG9jYWxpemVkIHN0cmluZ3Mg\nd2lsbCBiZSB1c2VkIGZvciBkZXNjcmliaW5nIGEgdmFsdWUsIHdoZXJlCiAq\nIDxlbT5uYW1lPC9lbT4gaXMgdGhlIGxhc3QgdG9rZW4gb2YgdGhlIHZhbHVl\nJ3MgcHJvcGVydHkgc3RyaW5nOgogKiA8dWw+CiAqIDxsaT48ZW0+bmFtZTwv\nZW0+LW5hbWU6IFRoZSBuYW1lIHRoYXQgd2lsbCBiZSBkaXNwbGF5ZWQgZm9y\nIHRoZQogKiBvcHRpb24gaW4gYSB1c2VyIGludGVyZmFjZTsgcmVxdWlyZWQu\nPC9saT4KICogPGxpPjxlbT5uYW1lPC9lbT4tZGVzYzogQSBicmllZiBkZXNj\ncmlwdGlvbiBvZiB0aGUgb3B0aW9uOyByZXF1aXJlZC48L2xpPgogKiA8bGk+\nPGVtPm5hbWU8L2VtPi10eXBlOiBUaGUgdHlwZSBvciBjYXRlZ29yeSBuYW1l\nIGZvciB0aGlzIG9wdGlvbjsKICogcmVxdWlyZWQuPC9saT4KICogPGxpPjxl\nbT5uYW1lPC9lbT4tZXhwZXJ0OiBUcnVlIGlmIHRoaXMgaXMgYW4gZXhwZXJ0\nIG9wdGlvbiwgZmFsc2UKICogb3RoZXJ3aXNlOyBkZWZhdWx0cyB0byBmYWxz\nZS48L2xpPgogKiA8bGk+PGVtPm5hbWU8L2VtPi12YWx1ZXM6IFNldCBvZiBl\neHBlY3RlZCBvciBjb21tb24gdmFsdWVzLCBleGNsdWRpbmcKICogYWxpYXMg\na2V5czsgb3B0aW9uYWwuPC9saT4KICogPGxpPjxlbT5uYW1lPC9lbT4taW50\nZXJmYWNlOiBUaGUgY2xhc3MgbmFtZSBvZiBhbiBpbnRlcmZhY2Ugd2hvc2UK\nICogZGlzY292ZXJhYmxlIGltcGxlbWVudGF0aW9ucyBzaG91bGQgYmUgaW5j\nbHVkZWQgaW4gdGhlIHNldCBvZiBleHBlY3RlZAogKiBvciBjb21tb24gdmFs\ndWVzOyBvcHRpb25hbC48L2xpPgogKiA8bGk+PGVtPm5hbWU8L2VtPi1jYXQ6\nIFRoZSBoaWVyYXJjaGljYWwgY2F0ZWdvcnkgZm9yIHRoZSBwcm9wZXJ0eQog\nKiBuYW1lLCBzZXBhcmF0ZWQgYnkgIi4iLgogKiA8bGk+PGVtPm5hbWU8L2Vt\nPi1kaXNwbGF5b3JkZXI6IFRoZSBvcmRlciBpbiB3aGljaCB0aGUgcHJvcGVy\ndHkgc2hvdWxkCiAqIGJlIGRpc3BsYXllci48L2xpPgogKiA8L3VsPgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIENvbmZpZ3Vy\nYXRpb25JbXBsCiAgICBpbXBsZW1lbnRzIENvbmZpZ3VyYXRpb24sIEV4dGVy\nbmFsaXphYmxlLCBWYWx1ZUxpc3RlbmVyIHsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgU0VQID0gSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNl\ncGFyYXRvcigpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQ29uZmln\ndXJhdGlvbkltcGwuY2xhc3MpOwoKICAgIHB1YmxpYyBPYmplY3RWYWx1ZSBs\nb2dGYWN0b3J5UGx1Z2luOwogICAgcHVibGljIFN0cmluZ1ZhbHVlIGlkOwoK\nICAgIHByaXZhdGUgU3RyaW5nIF9wcm9kdWN0ID0gbnVsbDsKICAgIHByaXZh\ndGUgaW50IF9yZWFkT25seVN0YXRlID0gSU5JVF9TVEFURV9MSVFVSUQ7CiAg\nICBwcml2YXRlIE1hcCBfcHJvcHMgPSBudWxsOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9nbG9iYWxzID0gZmFsc2U7CiAgICBwcml2YXRlIFN0cmluZyBfYXV0\nbyA9IG51bGw7CiAgICBwcml2YXRlIGZpbmFsIExpc3Q8VmFsdWU+IF92YWxz\nID0gbmV3IEFycmF5TGlzdDxWYWx1ZT4oKTsKICAgIHByaXZhdGUgU2V0PFN0\ncmluZz4gX3N1cHBvcnRlZEtleXM7CiAgICAKICAgIC8vIHByb3BlcnR5IGxp\nc3RlbmVyIGhlbHBlcgogICAgcHJpdmF0ZSBQcm9wZXJ0eUNoYW5nZVN1cHBv\ncnQgX2NoYW5nZVN1cHBvcnQgPSBudWxsOwoKICAgIC8vIGNhY2hlIGRlc2Ny\naXB0b3JzCiAgICBwcml2YXRlIFByb3BlcnR5RGVzY3JpcHRvcltdIF9wZHMg\nPSBudWxsOwogICAgcHJpdmF0ZSBNZXRob2REZXNjcmlwdG9yW10gX21kcyA9\nIG51bGw7CgogICAgLyoqCiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLiBB\ndHRlbXB0cyB0byBsb2FkIGRlZmF1bHQgcHJvcGVydGllcyB0aHJvdWdoCiAg\nICAgKiBzeXN0ZW0ncyBjb25maWd1cmVkIHtAbGluayBQcm9kdWN0RGVyaXZh\ndGlvbn1zLgogICAgICovCiAgICBwdWJsaWMgQ29uZmlndXJhdGlvbkltcGwo\nKSB7CiAgICAgICAgdGhpcyh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbnN0cnVjdG9yLgogICAgICoKICAgICAqIEBwYXJhbSBsb2FkR2xvYmFs\ncyB3aGV0aGVyIHRvIGF0dGVtcHQgdG8gbG9hZCB0aGUgZ2xvYmFsIHByb3Bl\ncnRpZXMKICAgICAqLwogICAgcHVibGljIENvbmZpZ3VyYXRpb25JbXBsKGJv\nb2xlYW4gbG9hZEdsb2JhbHMpIHsKICAgICAgICBzZXRQcm9kdWN0TmFtZSgi\nb3BlbmpwYSIpOwoKICAgICAgICBsb2dGYWN0b3J5UGx1Z2luID0gYWRkUGx1\nZ2luKCJMb2ciLCB0cnVlKTsKICAgICAgICBTdHJpbmdbXSBhbGlhc2VzID0g\nbmV3IFN0cmluZ1tdewogICAgICAgICAgICAidHJ1ZSIsIExvZ0ZhY3RvcnlJ\nbXBsLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgIm9wZW5qcGEiLCBM\nb2dGYWN0b3J5SW1wbC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICJj\nb21tb25zIiwgIm9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkNvbW1vbnNM\nb2dGYWN0b3J5IiwKICAgICAgICAgICAgImxvZzRqIiwgIm9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzRKTG9nRmFjdG9yeSIsCiAgICAgICAgICAg\nICJub25lIiwgTm9uZUxvZ0ZhY3RvcnkuY2xhc3MuZ2V0TmFtZSgpLAogICAg\nICAgICAgICAiZmFsc2UiLCBOb25lTG9nRmFjdG9yeS5jbGFzcy5nZXROYW1l\nKCksCiAgICAgICAgfTsKICAgICAgICBsb2dGYWN0b3J5UGx1Z2luLnNldEFs\naWFzZXMoYWxpYXNlcyk7CiAgICAgICAgbG9nRmFjdG9yeVBsdWdpbi5zZXRE\nZWZhdWx0KGFsaWFzZXNbMF0pOwogICAgICAgIGxvZ0ZhY3RvcnlQbHVnaW4u\nc2V0U3RyaW5nKGFsaWFzZXNbMF0pOwogICAgICAgIGxvZ0ZhY3RvcnlQbHVn\naW4uc2V0SW5zdGFudGlhdGluZ0dldHRlcigiZ2V0TG9nRmFjdG9yeSIpOwoK\nICAgICAgICBpZCA9IGFkZFN0cmluZygiSWQiKTsKICAgICAgICAKICAgICAg\nICBpZiAobG9hZEdsb2JhbHMpCiAgICAgICAgICAgIGxvYWRHbG9iYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBdXRvbWF0aWNhbGx5IGxvYWQgZ2xv\nYmFsIHZhbHVlcyBmcm9tIHRoZSBzeXN0ZW0ncwogICAgICoge0BsaW5rIFBy\nb2R1Y3REZXJpdmF0aW9ufXMsIGFuZCBmcm9tIFN5c3RlbSBwcm9wZXJ0aWVz\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBsb2FkR2xvYmFscygpIHsK\nICAgICAgICBNdWx0aUNsYXNzTG9hZGVyIGxvYWRlciA9IEFjY2Vzc0NvbnRy\nb2xsZXIKICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\nci5uZXdNdWx0aUNsYXNzTG9hZGVyQWN0aW9uKCkpOyAKICAgICAgICBsb2Fk\nZXIuYWRkQ2xhc3NMb2FkZXIoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENvbnRleHRDbGFz\nc0xvYWRlckFjdGlvbigpKSk7CiAgICAgICAgbG9hZGVyLmFkZENsYXNzTG9h\nZGVyKGdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSk7CiAgICAgICAgQ29u\nZmlndXJhdGlvblByb3ZpZGVyIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRp\nb25zLmxvYWRHbG9iYWxzKGxvYWRlcik7CiAgICAgICAgaWYgKHByb3ZpZGVy\nICE9IG51bGwpCiAgICAgICAgICAgIHByb3ZpZGVyLnNldEludG8odGhpcyk7\nCgogICAgICAgIC8vIGxldCBzeXN0ZW0gcHJvcGVydGllcyBvdmVycmlkZSBv\ndGhlciBnbG9iYWxzCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZnJvbVBy\nb3BlcnRpZXMobmV3IEhhc2hNYXAoCiAgICAgICAgICAgICAgICBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXRQcm9wZXJ0aWVzQWN0aW9uKCkpKSk7CiAgICAg\nICAgfSBjYXRjaCAoU2VjdXJpdHlFeGNlcHRpb24gc2UpIHsKICAgICAgICAg\nICAgLy8gc2VjdXJpdHkgbWFuYWdlciBtaWdodCBkaXNhbGxvdwogICAgICAg\nIH0KCiAgICAgICAgX2dsb2JhbHMgPSB0cnVlOwogICAgICAgIGlmIChwcm92\naWRlciA9PSBudWxsKSB7CiAgICAgICAgICAgIExvZyBsb2cgPSBnZXRDb25m\naWd1cmF0aW9uTG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgi\nbm8tZGVmYXVsdC1wcm92aWRlcnMiKSk7CiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZyBnZXRQcm9kdWN0TmFtZSgpIHsKICAgICAgICBy\nZXR1cm4gX3Byb2R1Y3Q7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UHJv\nZHVjdE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBfcHJvZHVjdCA9IG5h\nbWU7CiAgICB9CgogICAgcHVibGljIExvZ0ZhY3RvcnkgZ2V0TG9nRmFjdG9y\neSgpIHsKICAgICAgICBpZiAobG9nRmFjdG9yeVBsdWdpbi5nZXQoKSA9PSBu\ndWxsKQogICAgICAgICAgICBsb2dGYWN0b3J5UGx1Z2luLmluc3RhbnRpYXRl\nKExvZ0ZhY3RvcnkuY2xhc3MsIHRoaXMpOwogICAgICAgIHJldHVybiAoTG9n\nRmFjdG9yeSkgbG9nRmFjdG9yeVBsdWdpbi5nZXQoKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRMb2dGYWN0b3J5KExvZ0ZhY3RvcnkgbG9nRmFjdG9y\neSkgewogICAgICAgIGxvZ0ZhY3RvcnlQbHVnaW4uc2V0KGxvZ0ZhY3Rvcnkp\nOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0TG9nKCkgewogICAgICAg\nIHJldHVybiBsb2dGYWN0b3J5UGx1Z2luLmdldFN0cmluZygpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldExvZyhTdHJpbmcgbG9nKSB7CiAgICAgICAg\nbG9nRmFjdG9yeVBsdWdpbi5zZXRTdHJpbmcobG9nKTsKICAgIH0KCiAgICBw\ndWJsaWMgTG9nIGdldExvZyhTdHJpbmcgY2F0ZWdvcnkpIHsKICAgICAgICBy\nZXR1cm4gZ2V0TG9nRmFjdG9yeSgpLmdldExvZyhjYXRlZ29yeSk7CiAgICB9\nCgogICAgcHVibGljIFN0cmluZyBnZXRJZCgpIHsKICAgICAgICByZXR1cm4g\naWQuZ2V0KCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHNldElkKFN0\ncmluZyBpZCkgewogICAgICAgIHRoaXMuaWQuc2V0KGlkKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIGxvZ2dpbmcgY2hhbm5lbCA8Y29k\nZT5vcGVuanBhLlJ1bnRpbWU8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8K\nICAgIHB1YmxpYyBMb2cgZ2V0Q29uZmlndXJhdGlvbkxvZygpIHsKICAgICAg\nICByZXR1cm4gZ2V0TG9nKCJvcGVuanBhLlJ1bnRpbWUiKTsKICAgIH0KCiAg\nICBwdWJsaWMgVmFsdWVbXSBnZXRWYWx1ZXMoKSB7CiAgICAgICAgcmV0dXJu\nIChWYWx1ZVtdKSBfdmFscy50b0FycmF5KG5ldyBWYWx1ZVtfdmFscy5zaXpl\nKCldKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIHJlZ2lzdGVy\nZWQgVmFsdWUgZm9yIHRoZSBnaXZlbiBwcm9wZXJ0eU5hbWUuCiAgICAgKiAK\nICAgICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUgY2FuIGJlIGVpdGhlciBmdWxs\neS1xdWFsaWZpZWQgbmFtZSBvciB0aGUgc2ltcGxlIG5hbWUKICAgICAqIHdp\ndGggd2hpY2ggdGhlIHZhbHVlIGhhcyBiZWVuIHJlZ2lzdGVyZWQuIEEgdmFs\ndWUgbWF5IGhhdmUgbXVsdGlwbGUKICAgICAqIGVxdWl2YWxlbnQgbmFtZXMg\nYW5kIHRoaXMgbWV0aG9kIHNlYXJjaGVzIHdpdGggYWxsIGVxdWl2YWxlbnQg\nbmFtZXMuCiAgICAgKi8KICAgIHB1YmxpYyBWYWx1ZSBnZXRWYWx1ZShTdHJp\nbmcgcHJvcGVydHkpIHsKICAgICAgICBpZiAocHJvcGVydHkgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHNlYXJjaCBi\nYWNrd2FyZHMgc28gdGhhdCBjdXN0b20gdmFsdWVzIGFkZGVkIGFmdGVyIGNv\nbnN0cnVjdGlvbgogICAgICAgIC8vIGFyZSBmb3VuZCBxdWlja2x5LCBzaW5j\nZSB0aGlzIHdpbGwgYmUgdGhlIHN0ZCB3YXkgb2YgYWNjZXNzaW5nIHRoZW0K\nICAgICAgICBmb3IgKGludCBpID0gX3ZhbHMuc2l6ZSgpLTE7IGkgPj0gMDsg\naS0tKSB7IAogICAgICAgICAgICBpZiAoX3ZhbHMuZ2V0KGkpLm1hdGNoZXMo\ncHJvcGVydHkpKQogICAgICAgICAgICAgICAgcmV0dXJuIF92YWxzLmdldChp\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0UmVhZE9ubHkoaW50IG5ld1N0YXRlKSB7CiAgICAg\nICAgaWYgKG5ld1N0YXRlID49IF9yZWFkT25seVN0YXRlKSB7CiAgICAgICAg\nCV9yZWFkT25seVN0YXRlID0gbmV3U3RhdGU7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGluc3RhbnRpYXRlQWxsKCkgewogICAgICAgIFN0\ncmluZ1dyaXRlciBlcnJzID0gbnVsbDsKICAgICAgICBQcmludFdyaXRlciBz\ndGFjayA9IG51bGw7CiAgICAgICAgU3RyaW5nIGdldHRlck5hbWU7CiAgICAg\nICAgTWV0aG9kIGdldHRlcjsKICAgICAgICBPYmplY3QgZ2V0dGVyVGFyZ2V0\nOwogICAgICAgIGZvcihWYWx1ZSB2YWwgOiBfdmFscykgeyAKICAgICAgICAg\nICAgZ2V0dGVyTmFtZSA9IHZhbC5nZXRJbnN0YW50aWF0aW5nR2V0dGVyKCk7\nCiAgICAgICAgICAgIGlmIChnZXR0ZXJOYW1lID09IG51bGwpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGdldHRlclRhcmdldCA9\nIHRoaXM7CiAgICAgICAgICAgIGlmIChnZXR0ZXJOYW1lLnN0YXJ0c1dpdGgo\nInRoaXMuIikpIHsKICAgICAgICAgICAgICAgIGdldHRlck5hbWUgPSBnZXR0\nZXJOYW1lLnN1YnN0cmluZygidGhpcy4iLmxlbmd0aCgpKTsKICAgICAgICAg\nICAgICAgIGdldHRlclRhcmdldCA9IHZhbDsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdldHRlciA9IGdldHRl\nclRhcmdldC5nZXRDbGFzcygpLmdldE1ldGhvZChnZXR0ZXJOYW1lLAogICAg\nICAgICAgICAgICAgICAgIChDbGFzc1tdKSBudWxsKTsKICAgICAgICAgICAg\nICAgIGdldHRlci5pbnZva2UoZ2V0dGVyVGFyZ2V0LCAoT2JqZWN0W10pIG51\nbGwpOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAg\nICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBJbnZvY2F0aW9uVGFyZ2V0\nRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgICAgIHQgPSAoKEludm9jYXRp\nb25UYXJnZXRFeGNlcHRpb24pIHQpLmdldFRhcmdldEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICAgICAgaWYgKGVycnMgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGVycnMgPSBuZXcgU3RyaW5nV3JpdGVyKCk7CiAgICAgICAg\nICAgICAgICAgICAgc3RhY2sgPSBuZXcgUHJpbnRXcml0ZXIoZXJycyk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBlcnJz\nLndyaXRlKFNFUCk7CiAgICAgICAgICAgICAgICB0LnByaW50U3RhY2tUcmFj\nZShzdGFjayk7CiAgICAgICAgICAgICAgICBzdGFjay5mbHVzaCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChlcnJzICE9IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJnZXQtcHJvcC1lcnJzIiwKICAgICAgICAgICAgICAgIGVycnMudG9T\ndHJpbmcoKSkuZ2V0TWVzc2FnZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1JlYWRPbmx5KCkgewogICAgICAgIHJldHVybiBfcmVhZE9ubHlT\ndGF0ZT09SU5JVF9TVEFURV9GUk9aRU47CiAgICB9CgogICAgcHVibGljIHZv\naWQgYWRkUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihQcm9wZXJ0eUNoYW5nZUxp\nc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgaWYgKF9jaGFuZ2VTdXBwb3J0\nID09IG51bGwpCiAgICAgICAgICAgIF9jaGFuZ2VTdXBwb3J0ID0gbmV3IFBy\nb3BlcnR5Q2hhbmdlU3VwcG9ydCh0aGlzKTsKICAgICAgICBfY2hhbmdlU3Vw\ncG9ydC5hZGRQcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKGxpc3RlbmVyKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVQcm9wZXJ0eUNoYW5nZUxpc3Rl\nbmVyKFByb3BlcnR5Q2hhbmdlTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAg\nICBpZiAoX2NoYW5nZVN1cHBvcnQgIT0gbnVsbCkKICAgICAgICAgICAgX2No\nYW5nZVN1cHBvcnQucmVtb3ZlUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihsaXN0\nZW5lcik7CiAgICB9CgogICAgcHVibGljIHZvaWQgdmFsdWVDaGFuZ2VkKFZh\nbHVlIHZhbCkgewogICAgICAgIGlmIChfY2hhbmdlU3VwcG9ydCA9PSBudWxs\nICYmIF9wcm9wcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIFN0cmluZyBuZXdTdHJpbmcgPSB2YWwuZ2V0U3RyaW5nKCk7CiAgICAg\nICAgaWYgKF9jaGFuZ2VTdXBwb3J0ICE9IG51bGwpCiAgICAgICAgICAgIF9j\naGFuZ2VTdXBwb3J0LmZpcmVQcm9wZXJ0eUNoYW5nZSh2YWwuZ2V0UHJvcGVy\ndHkoKSwgbnVsbCwgbmV3U3RyaW5nKTsKCiAgICAgICAgLy8ga2VlcCBjYWNo\nZWQgcHJvcHMgdXAgdG8gZGF0ZQogICAgICAgIGlmIChfcHJvcHMgIT0gbnVs\nbCkgewogICAgICAgICAgICBpZiAobmV3U3RyaW5nID09IG51bGwpCiAgICAg\nICAgICAgICAgICBDb25maWd1cmF0aW9ucy5yZW1vdmVQcm9wZXJ0eSh2YWwu\nZ2V0UHJvcGVydHkoKSwgX3Byb3BzKTsKICAgICAgICAgICAgZWxzZSBpZiAo\nQ29uZmlndXJhdGlvbnMuY29udGFpbnNQcm9wZXJ0eSh2YWwsIF9wcm9wcykK\nICAgICAgICAgICAgICAgIHx8IHZhbC5nZXREZWZhdWx0KCkgPT0gbnVsbAog\nICAgICAgICAgICAgICAgfHwgIXZhbC5nZXREZWZhdWx0KCkuZXF1YWxzKG5l\nd1N0cmluZykpCiAgICAgICAgICAgICAgICBzZXRWYWx1ZShfcHJvcHMsIHZh\nbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2VzIGFs\nbCBjbG9zZWFibGUgdmFsdWVzIGFuZCBwbHVnaW5zLgogICAgICovCiAgICBw\ndWJsaWMgZmluYWwgdm9pZCBjbG9zZSgpIHsKICAgICAgICBQcm9kdWN0RGVy\naXZhdGlvbnMuYmVmb3JlQ2xvc2UodGhpcyk7CiAgICAgICAgCiAgICAgICAg\ncHJlQ2xvc2UoKTsKICAgICAgICAKICAgICAgICBPYmplY3RWYWx1ZSB2YWw7\nCiAgICAgICAgZm9yKFZhbHVlIHYgOiBfdmFscykgeyAKICAgICAgICAgICAg\naWYgKHYgaW5zdGFuY2VvZiBDbG9zZWFibGUpIHsKICAgICAgICAgICAgICAg\nIHRyeSB7ICgoQ2xvc2VhYmxlKXYpLmNsb3NlKCk7IH0KICAgICAgICAgICAg\nICAgIGNhdGNoIChFeGNlcHRpb24gZSkge30gCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEodiAg\naW5zdGFuY2VvZiBPYmplY3RWYWx1ZSkpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgIHZhbCA9IChPYmplY3RWYWx1ZSkgdjsKICAg\nICAgICAgICAgaWYgKHZhbC5nZXQoKSBpbnN0YW5jZW9mIENsb3NlYWJsZSkg\newogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAo\nKENsb3NlYWJsZSkgdmFsLmdldCgpKS5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBJbnZva2VkIGJ5IGZpbmFsIG1ldGhvZCB7QGxpbmsgI2Nsb3NlfSBh\nZnRlciBpbnZva2luZyB0aGUgCiAgICAgKiB7QGxpbmsgUHJvZHVjdERlcml2\nYXRpb24jYmVmb3JlQ29uZmlndXJhdGlvbkNsb3NlfSBjYWxsYmFja3MKICAg\nICAqIGJ1dCBiZWZvcmUgcGVyZm9ybWluZyBpbnRlcm5hbCBjbG9zZSBvcGVy\nYXRpb25zLgogICAgICogCiAgICAgKiBAc2luY2UgMC45LjcKICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgcHJlQ2xvc2UoKSB7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBCZWFuSW5mbyBpbXBs\nZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgcHVibGljIEJlYW5JbmZvW10gZ2V0QWRkaXRpb25hbEJlYW5JbmZvKCkg\newogICAgICAgIHJldHVybiBuZXcgQmVhbkluZm9bMF07CiAgICB9CgogICAg\ncHVibGljIEJlYW5EZXNjcmlwdG9yIGdldEJlYW5EZXNjcmlwdG9yKCkgewog\nICAgICAgIHJldHVybiBuZXcgQmVhbkRlc2NyaXB0b3IoZ2V0Q2xhc3MoKSk7\nCiAgICB9CgogICAgcHVibGljIGludCBnZXREZWZhdWx0RXZlbnRJbmRleCgp\nIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdl\ndERlZmF1bHRQcm9wZXJ0eUluZGV4KCkgewogICAgICAgIHJldHVybiAwOwog\nICAgfQoKICAgIHB1YmxpYyBFdmVudFNldERlc2NyaXB0b3JbXSBnZXRFdmVu\ndFNldERlc2NyaXB0b3JzKCkgewogICAgICAgIHJldHVybiBuZXcgRXZlbnRT\nZXREZXNjcmlwdG9yWzBdOwogICAgfQoKICAgIHB1YmxpYyBJbWFnZSBnZXRJ\nY29uKGludCBraW5kKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgcHVibGljIHN5bmNocm9uaXplZCBNZXRob2REZXNjcmlwdG9yW10gZ2V0\nTWV0aG9kRGVzY3JpcHRvcnMoKSB7CiAgICAgICAgaWYgKF9tZHMgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIF9tZHM7CgogICAgICAgIFByb3BlcnR5\nRGVzY3JpcHRvcltdIHBkcyA9IGdldFByb3BlcnR5RGVzY3JpcHRvcnMoKTsK\nICAgICAgICBMaXN0PE1ldGhvZERlc2NyaXB0b3I+IGRlc2NzID0gbmV3IEFy\ncmF5TGlzdDxNZXRob2REZXNjcmlwdG9yPigpOyAKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHBkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBN\nZXRob2Qgd3JpdGUgPSBwZHNbaV0uZ2V0V3JpdGVNZXRob2QoKTsKICAgICAg\nICAgICAgTWV0aG9kIHJlYWQgPSBwZHNbaV0uZ2V0UmVhZE1ldGhvZCgpOwog\nICAgICAgICAgICBpZiAocmVhZCAhPSBudWxsICYmIHdyaXRlICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGRlc2NzLmFkZChuZXcgTWV0aG9kRGVzY3Jp\ncHRvcih3cml0ZSkpOwogICAgICAgICAgICAgICAgZGVzY3MuYWRkKG5ldyBN\nZXRob2REZXNjcmlwdG9yKHJlYWQpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBfbWRzID0gKE1ldGhvZERlc2NyaXB0b3JbXSkgZGVzY3Mu\nCiAgICAgICAgICAgIHRvQXJyYXkobmV3IE1ldGhvZERlc2NyaXB0b3JbZGVz\nY3Muc2l6ZSgpXSk7CiAgICAgICAgcmV0dXJuIF9tZHM7CiAgICB9CgogICAg\ncHVibGljIHN5bmNocm9uaXplZCBQcm9wZXJ0eURlc2NyaXB0b3JbXSBnZXRQ\ncm9wZXJ0eURlc2NyaXB0b3JzKCkgewogICAgICAgIGlmIChfcGRzICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBfcGRzOwoKICAgICAgICBfcGRzID0g\nbmV3IFByb3BlcnR5RGVzY3JpcHRvcltfdmFscy5zaXplKCldOwogICAgICAg\nIAogICAgICAgIExpc3Q8U3RyaW5nPiBmYWlsdXJlcyA9IG51bGw7CiAgICAg\nICAgVmFsdWUgdmFsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3Zh\nbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgdmFsID0gKFZhbHVlKSBf\ndmFscy5nZXQoaSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBfcGRzW2ldID0gZ2V0UHJvcGVydHlEZXNjcmlwdG9yKHZhbCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE1pc3NpbmdSZXNvdXJjZUV4Y2VwdGlvbiBtcmUp\nIHsKICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGZhaWx1cmVzID0gbmV3IEFycmF5TGlzdDxTdHJp\nbmc+KCk7CiAgICAgICAgICAgICAgICBmYWlsdXJlcy5hZGQodmFsLmdldFBy\nb3BlcnR5KCkpOwogICAgICAgICAgICB9IGNhdGNoIChJbnRyb3NwZWN0aW9u\nRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmYWlsdXJlcyA9IG5ldyBB\ncnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgICAgICAgICAgZmFpbHVyZXMu\nYWRkKHZhbC5nZXRQcm9wZXJ0eSgpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBpZiAoZmFpbHVyZXMgIT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFBhcnNlRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLXBy\nb3BlcnR5LWRlc2NyaXB0b3JzIiwKICAgICAgICAgICAgICAgIGZhaWx1cmVz\nKSk7CgogICAgICAgIHJldHVybiBfcGRzOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgcHJvcGVydHkgZGVzY3JpcHRvciBmb3IgdGhlIGdpdmVu\nIHZhbHVlLgogICAgICovCiAgICBwcml2YXRlIFByb3BlcnR5RGVzY3JpcHRv\nciBnZXRQcm9wZXJ0eURlc2NyaXB0b3IoVmFsdWUgdmFsKQogICAgICAgIHRo\ncm93cyBJbnRyb3NwZWN0aW9uRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcg\ncHJvcCA9IHZhbC5nZXRQcm9wZXJ0eSgpOwogICAgICAgIHByb3AgPSBwcm9w\nLnN1YnN0cmluZyhwcm9wLmxhc3RJbmRleE9mKCcuJykgKyAxKTsKCiAgICAg\nICAgLy8gc2V0IHVwIHByb3BlcnR5IGRlc2NyaXB0b3IKICAgICAgICBQcm9w\nZXJ0eURlc2NyaXB0b3IgcGQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncGQgPSBuZXcgUHJvcGVydHlEZXNjcmlwdG9yKEludHJvc3BlY3Rvci5kZWNh\ncGl0YWxpemUocHJvcCksIAogICAgICAgICAgICAgICAgZ2V0Q2xhc3MoKSk7\nCiAgICAgICAgfSBjYXRjaCAoSW50cm9zcGVjdGlvbkV4Y2VwdGlvbiBpZSkg\newogICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmVuJ3QgYW55IG1ldGhvZHMg\nZm9yIHRoaXMgdmFsdWUoaS5lLiwgaWYgaXQncyBhCiAgICAgICAgICAgIC8v\nIGR5bmFtaWNhbGx5LWFkZGVkIHZhbHVlKSwgdGhlbiBhbiBJbnRyb3NwZWN0\naW9uRXhjZXB0aW9uIHdpbGwKICAgICAgICAgICAgLy8gYmUgdGhyb3duLiBU\ncnkgdG8gY3JlYXRlIGEgUEQgd2l0aCBubyByZWFkIG9yIHdyaXRlIG1ldGhv\nZHMuCiAgICAgICAgICAgIHBkID0gbmV3IFByb3BlcnR5RGVzY3JpcHRvcihJ\nbnRyb3NwZWN0b3IuZGVjYXBpdGFsaXplKHByb3ApLAogICAgICAgICAgICAg\nICAgKE1ldGhvZCkgbnVsbCwgKE1ldGhvZCkgbnVsbCk7CiAgICAgICAgfQog\nICAgICAgIHBkLnNldERpc3BsYXlOYW1lKGZpbmRMb2NhbGl6ZWQocHJvcCAr\nICItbmFtZSIsIHRydWUsIHZhbC5nZXRTY29wZSgpKSk7CiAgICAgICAgcGQu\nc2V0U2hvcnREZXNjcmlwdGlvbihmaW5kTG9jYWxpemVkKHByb3AgKyAiLWRl\nc2MiLCB0cnVlLAogICAgICAgICAgICB2YWwuZ2V0U2NvcGUoKSkpOwogICAg\nICAgIHBkLnNldEV4cGVydCgidHJ1ZSIuZXF1YWxzKGZpbmRMb2NhbGl6ZWQo\ncHJvcCArICItZXhwZXJ0IiwgZmFsc2UsCiAgICAgICAgICAgIHZhbC5nZXRT\nY29wZSgpKSkpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBwZC5zZXRS\nZWFkTWV0aG9kKGdldENsYXNzKCkuZ2V0TWV0aG9kKCJnZXQiCiAgICAgICAg\nICAgICAgICArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUocHJvcCksIChDbGFz\nc1tdKSBudWxsKSk7CiAgICAgICAgICAgIHBkLnNldFdyaXRlTWV0aG9kKGdl\ndENsYXNzKCkuZ2V0TWV0aG9kKCJzZXQiCiAgICAgICAgICAgICAgICArIFN0\ncmluZ1V0aWxzLmNhcGl0YWxpemUocHJvcCksIG5ldyBDbGFzc1tdCiAgICAg\nICAgICAgICAgICB7IHBkLmdldFJlYWRNZXRob2QoKS5nZXRSZXR1cm5UeXBl\nKCkgfSkpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAg\nICAgICAgIC8vIGlmIGFuIGVycm9yIG9jY3VycywgaXQgbWlnaHQgYmUgYmVj\nYXVzZSB0aGUgdmFsdWUgaXMgYQogICAgICAgICAgICAvLyBkeW5hbWljIHBy\nb3BlcnR5LgogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIHR5cGUgPSBmaW5k\nTG9jYWxpemVkKHByb3AgKyAiLXR5cGUiLCB0cnVlLCB2YWwuZ2V0U2NvcGUo\nKSk7CiAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAgcGQu\nc2V0VmFsdWUoQVRUUklCVVRFX1RZUEUsIHR5cGUpOwoKICAgICAgICBTdHJp\nbmcgY2F0ID0gZmluZExvY2FsaXplZChwcm9wICsgIi1jYXQiLCBmYWxzZSwg\ndmFsLmdldFNjb3BlKCkpOwogICAgICAgIGlmIChjYXQgIT0gbnVsbCkKICAg\nICAgICAgICAgcGQuc2V0VmFsdWUoQVRUUklCVVRFX0NBVEVHT1JZLCBjYXQp\nOwogICAgICAgIAogICAgICAgIHBkLnNldFZhbHVlKEFUVFJJQlVURV9YTUws\nIHRvWE1MTmFtZShwcm9wKSk7CgogICAgICAgIFN0cmluZyBvcmRlciA9IGZp\nbmRMb2NhbGl6ZWQocHJvcCArICItZGlzcGxheW9yZGVyIiwgZmFsc2UsCiAg\nICAgICAgICAgIHZhbC5nZXRTY29wZSgpKTsKICAgICAgICBpZiAob3JkZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgcGQuc2V0VmFsdWUoQVRUUklCVVRFX09S\nREVSLCBvcmRlcik7CgogICAgICAgIC8vIGNvbGxlY3QgYWxsb3dlZCB2YWx1\nZXMgZnJvbSBhbGlhcyBrZXlzLCBsaXN0ZWQgdmFsdWVzLCBhbmQKICAgICAg\nICAvLyBpbnRlcmZhY2UgaW1wbGVtZW50b3JzCiAgICAgICAgQ29sbGVjdGlv\nbjxTdHJpbmc+IGFsbG93ZWQgPSBuZXcgVHJlZVNldDxTdHJpbmc+KCk7CiAg\nICAgICAgTGlzdDxTdHJpbmc+IGFsaWFzZXMgPSBDb2xsZWN0aW9ucy5lbXB0\neUxpc3QoKTsKICAgICAgICBpZiAodmFsLmdldEFsaWFzZXMoKSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGFsaWFzZXMgPSBBcnJheXMuYXNMaXN0KHZhbC5n\nZXRBbGlhc2VzKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFsaWFzZXMuc2l6ZSgpOyBpICs9IDIpCiAgICAgICAgICAgICAgICBhbGxv\nd2VkLmFkZChhbGlhc2VzLmdldChpKSk7CiAgICAgICAgfQogICAgICAgIFN0\ncmluZ1tdIHZhbHMgPSBTdHJpbmdzLnNwbGl0KGZpbmRMb2NhbGl6ZWQocHJv\ncAogICAgICAgICAgICArICItdmFsdWVzIiwgZmFsc2UsIHZhbC5nZXRTY29w\nZSgpKSwgIiwiLCAwKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHZh\nbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghYWxpYXNlcy5jb250\nYWlucyh2YWxzW2ldKSkKICAgICAgICAgICAgICAgIGFsbG93ZWQuYWRkKHZh\nbHNbaV0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNzPD8+IGlu\ndGYgPSBDbGFzcy5mb3JOYW1lKGZpbmRMb2NhbGl6ZWQocHJvcAogICAgICAg\nICAgICAgICAgKyAiLWludGVyZmFjZSIsIHRydWUsIHZhbC5nZXRTY29wZSgp\nKSwgZmFsc2UsCiAgICAgICAgICAgICAgICBnZXRDbGFzcygpLmdldENsYXNz\nTG9hZGVyKCkpOwogICAgICAgICAgICBwZC5zZXRWYWx1ZShBVFRSSUJVVEVf\nSU5URVJGQUNFLCBpbnRmLmdldE5hbWUoKSk7CiAgICAgICAgICAgIFN0cmlu\nZ1tdIGltcGxzID0gU2VydmljZXMuZ2V0SW1wbGVtZW50b3JzKGludGYpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGltcGxzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgaWYgKCFhbGlhc2VzLmNvbnRhaW5zKGlt\ncGxzW2ldKSkKICAgICAgICAgICAgICAgICAgICBhbGxvd2VkLmFkZChpbXBs\nc1tpXSk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICB9CiAgICAgICAgaWYgKCFhbGxvd2VkLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcGQuc2V0VmFsdWUoQVRUUklCVVRFX0FMTE9XRURfVkFMVUVTLCAoU3Ry\naW5nW10pIGFsbG93ZWQudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBT\ndHJpbmdbYWxsb3dlZC5zaXplKCldKSk7CgogICAgICAgIHJldHVybiBwZDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIGdpdmVuIGxvY2FsaXpl\nZCBzdHJpbmcsIG9yIHJldHVybiBudWxsIGlmIG5vdCBmb3VuZC4KICAgICAq\nLwogICAgQFN1cHByZXNzV2FybmluZ3MoInVuY2hlY2tlZCIpCiAgICBwcml2\nYXRlIFN0cmluZyBmaW5kTG9jYWxpemVkKFN0cmluZyBrZXksIGJvb2xlYW4g\nZmF0YWwsIENsYXNzPD8+IHNjb3BlKSB7CiAgICAgICAgLy8gZmluZCB0aGUg\nbG9jYWxpemVyIHBhY2thZ2UgdGhhdCBjb250YWlucyB0aGlzIGtleQogICAg\nICAgIExvY2FsaXplciBsb2MgPSBudWxsOwoKICAgICAgICAvLyBjaGVjayB0\naGUgcGFja2FnZSB0aGF0IHRoZSB2YWx1ZSBjbGFpbXMgdG8gYmUgZGVmaW5l\nZCBpbiwgaWYKICAgICAgICAvLyBhdmFpbGFibGUsIGJlZm9yZSB3ZSBzdGFy\ndCBndWVzc2luZy4KICAgICAgICBpZiAoc2NvcGUgIT0gbnVsbCkgewogICAg\nICAgICAgICBsb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZShzY29wZSk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbG9jLmdl\ndEZhdGFsKGtleSkuZ2V0TWVzc2FnZSgpOwogICAgICAgICAgICB9IGNhdGNo\nIChNaXNzaW5nUmVzb3VyY2VFeGNlcHRpb24gbXNlKSB7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGZvciAoQ2xhc3MgY2xzID0gZ2V0Q2xh\nc3MoKTsgY2xzICE9IE9iamVjdC5jbGFzczsKICAgICAgICAgICAgY2xzID0g\nY2xzLmdldFN1cGVyY2xhc3MoKSkgewogICAgICAgICAgICBsb2MgPSBMb2Nh\nbGl6ZXIuZm9yUGFja2FnZShjbHMpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGxvYy5nZXRGYXRhbChrZXkpLmdldE1lc3Nh\nZ2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoTWlzc2luZ1Jlc291cmNlRXhj\nZXB0aW9uIG1zZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBpZiAoZmF0YWwpCiAgICAgICAgICAgIHRocm93IG5ldyBNaXNzaW5nUmVz\nb3VyY2VFeGNlcHRpb24oa2V5LCBnZXRDbGFzcygpLmdldE5hbWUoKSwga2V5\nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBUby9mcm9tIG1hcHMKICAgIC8vLy8vLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIEFuIGludGVybmFsIG1ldGhvZCB0byByZXRy\naWV2ZSBwcm9wZXJ0aWVzLCB0byBzdXBwb3J0IDIgcHVibGljIG1ldGhvZHMs\nCiAgICAgKiBnZXRBbGxQcm9wZXJ0aWVzKCkgYW5kIHRvUHJvcGVydGllcyhi\nb29sZWFuKS4KICAgICAqIAogICAgICogQHBhcmFtIHN0b3JlRGVmYXVsdHMK\nICAgICAqICAgICAgICAgICAgd2hldGhlciBvciBub3QgdG8gcmV0cmlldmUg\nYSBwcm9wZXJ0eSBpZiBpdHMgdmFsdWUgaXMgdGhlCiAgICAgKiAgICAgICAg\nICAgIGRlZmF1bHQgdmFsdWUuIFRoaXMgcGFyYW1ldGVyIGlzIGlycmVsZXZh\nbnQgaWYgZ2V0QWxsIGlzIHRydWUuCiAgICAgKiBAcGFyYW0gZ2V0QWxsCiAg\nICAgKiAgICAgICAgICAgIHdoZXRoZXIgb3Igbm90IHRvIGdldCBhbGwgb2Yg\ndGhlIHByb3BlcnRpZXMKICAgICAqIEByZXR1cm4KICAgICAqLwogICAgcHVi\nbGljIE1hcCB0b1Byb3BlcnRpZXMoYm9vbGVhbiBzdG9yZURlZmF1bHRzKSB7\nCiAgICAgICAgLy8gY2xvbmUgcHJvcGVydGllcyBiZWZvcmUgbWFraW5nIGFu\neSBtb2RpZmljYXRpb25zOyB3ZSBuZWVkIHRvIGtlZXAKICAgICAgICAvLyB0\naGUgaW50ZXJuYWwgcHJvcGVydGllcyBpbnN0YW5jZSBjb25zaXN0ZW50IHRv\nIG1haW50YWluIGVxdWFscyBhbmQKICAgICAgICAvLyBoYXNoY29kZSBjb250\ncmFjdHMKICAgICAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IGNsb25lOwogICAg\nICAgIGlmIChfcHJvcHMgPT0gbnVsbCkKICAgICAgICAgICAgY2xvbmUgPSBu\nZXcgVHJlZU1hcDxTdHJpbmcsIFN0cmluZz4oKTsKICAgICAgICBlbHNlIGlm\nIChfcHJvcHMgaW5zdGFuY2VvZiBQcm9wZXJ0aWVzKQogICAgICAgICAgICBj\nbG9uZSA9IChNYXApICgoUHJvcGVydGllcykgX3Byb3BzKS5jbG9uZSgpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgY2xvbmUgPSBuZXcgVHJlZU1hcDxT\ndHJpbmcsIFN0cmluZz4oX3Byb3BzKTsKCiAgICAgICAgLy8gaWYgbm8gZXhp\nc3RpbmcgcHJvcGVydGllcyBvciB0aGUgcHJvcGVydGllcyBzaG91bGQgY29u\ndGFpbiBlbnRyaWVzCiAgICAgICAgLy8gd2l0aCBkZWZhdWx0IHZhbHVlcywg\nYWRkIHZhbHVlcyB0byBwcm9wZXJ0aWVzCiAgICAgICAgaWYgKF9wcm9wcyA9\nPSBudWxsIHx8IHN0b3JlRGVmYXVsdHMpIHsKICAgICAgICAgICAgU3RyaW5n\nIHN0cjsKICAgICAgICAgICAgZm9yIChWYWx1ZSB2YWwgOiBfdmFscykgeyAK\nICAgICAgICAgICAgICAgIC8vIGlmIGtleSBpbiBleGlzdGluZyBwcm9wZXJ0\naWVzLCB3ZSBhbHJlYWR5IGtub3cgdmFsdWUgaXMgdXAgdG8gZGF0ZQovLyAg\nICAgICAgICAgICAgICBpZiAoX3Byb3BzICE9IG51bGwgJiYgQ29uZmlndXJh\ndGlvbnMuY29udGFpbnNQcm9wZXJ0eSh2YWwsIF9wcm9wcykgJiYgdmFsLmlz\nVmlzaWJsZSgpKQovLyAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICBzdHIgPSB2YWwuZ2V0U3RyaW5nKCk7CiAgICAgICAg\nICAgICAgICBpZiAoKHN0ciAhPSBudWxsICYmIChzdG9yZURlZmF1bHRzIHx8\nICFzdHIuZXF1YWxzKHZhbC5nZXREZWZhdWx0KCkpKSkpCiAgICAgICAgICAg\nICAgICAgICAgc2V0VmFsdWUoY2xvbmUsIHZhbCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKF9wcm9wcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgX3Byb3BzID0gbmV3IFRyZWVNYXAoY2xvbmUpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gY2xvbmU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lk\nIGZyb21Qcm9wZXJ0aWVzKE1hcCBtYXApIHsKICAgICAgICBpZiAobWFwID09\nIG51bGwgfHwgbWFwLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIGlmIChpc1JlYWRPbmx5KCkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlYWQtb25seSIp\nLmdldE1lc3NhZ2UoKSk7CgogICAgICAgIC8vIGlmIHRoZSBvbmx5IHByZXZp\nb3VzIGNhbGwgd2FzIHRvIGxvYWQgZGVmYXVsdHMsIGZvcmdldCB0aGVtLgog\nICAgICAgIC8vIHRoaXMgd2F5IHdlIHByZXNlcnZlIHRoZSBvcmlnaW5hbCBm\nb3JtYXR0aW5nIG9mIHRoZSB1c2VyJ3MgcHJvcHMKICAgICAgICAvLyBpbnN0\nZWFkIG9mIHRoZSBkZWZhdWx0cy4gIHRoaXMgaXMgaW1wb3J0YW50IGZvciBj\nYWNoaW5nIG9uCiAgICAgICAgLy8gY29uZmlndXJhdGlvbiBvYmplY3RzCiAg\nICAgICAgaWYgKF9nbG9iYWxzKSB7CiAgICAgICAgICAgIF9wcm9wcyA9IG51\nbGw7CiAgICAgICAgICAgIF9nbG9iYWxzID0gZmFsc2U7CiAgICAgICAgfQoK\nICAgICAgICAvLyBjb3B5IHRoZSBpbnB1dCB0byBhdm9pZCBtdXRhdGlvbiBp\nc3N1ZXMKICAgICAgICBpZiAobWFwIGluc3RhbmNlb2YgSGFzaE1hcCkKICAg\nICAgICAgICAgbWFwID0gKE1hcCkgKChIYXNoTWFwKSBtYXApLmNsb25lKCk7\nCiAgICAgICAgZWxzZSBpZiAobWFwIGluc3RhbmNlb2YgUHJvcGVydGllcykK\nICAgICAgICAgICAgbWFwID0gKE1hcCkgKChQcm9wZXJ0aWVzKSBtYXApLmNs\nb25lKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtYXAgPSBuZXcgTGlu\na2VkSGFzaE1hcChtYXApOwoKICAgICAgICBNYXAgcmVtYWluaW5nID0gbmV3\nIEhhc2hNYXAobWFwKTsKICAgICAgICBib29sZWFuIHNlciA9IHRydWU7CiAg\nICAgICAgT2JqZWN0IG87CiAgICAgICAgZm9yIChWYWx1ZSB2YWwgOiBfdmFs\ncykgewogICAgICAgICAgICBvID0gZmluZFZhbHVlKG1hcCwgdmFsKTsKICAg\nICAgICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICBpZiAobyBpbnN0YW5jZW9mIFN0cmluZykgewog\nICAgICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5lcXVhbHMoKFN0cmlu\nZykgbywgdmFsLmdldFN0cmluZygpKSkKICAgICAgICAgICAgICAgICAgICB2\nYWwuc2V0U3RyaW5nKChTdHJpbmcpIG8pOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgc2VyICY9IG8gaW5zdGFuY2VvZiBTZXJpYWxp\nemFibGU7CiAgICAgICAgICAgICAgICB2YWwuc2V0T2JqZWN0KG8pOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLnJlbW92ZVBy\nb3BlcnR5KHZhbC5nZXRQcm9wZXJ0eSgpLCByZW1haW5pbmcpOwogICAgICAg\nIH0KICAgICAgICAKICAgICAgICAvLyBjb252ZW50aW9uIGlzIHRvIHBvaW50\nIHByb2R1Y3QgYXQgYSByZXNvdXJjZSB3aXRoIHRoZQogICAgICAgIC8vIDxw\ncmVmaXg+LnByb3BlcnRpZXMgU3lzdGVtIHByb3BlcnR5OyByZW1vdmUgdGhh\ndCBwcm9wZXJ0eSBzbyB3ZQogICAgICAgIC8vIHdlIGRvbid0IHdhcm4gYWJv\ndXQgaXQKICAgICAgICBDb25maWd1cmF0aW9ucy5yZW1vdmVQcm9wZXJ0eSgi\ncHJvcGVydGllcyIsIHJlbWFpbmluZyk7CgogICAgICAgIC8vIG5vdyB3YXJu\nIGlmIHRoZXJlIGFyZSBhbnkgcmVtYWluaW5nIHByb3BlcnRpZXMgdGhhdCB0\naGVyZQogICAgICAgIC8vIGlzIGFuIHVuaGFuZGxlZCBwcm9wLCBhbmQgcmVt\nb3ZlIHRoZSB1bmtub3duIHByb3BlcnRpZXMKICAgICAgICBNYXAuRW50cnkg\nZW50cnk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSByZW1haW5pbmcu\nZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgIE9iamVjdCBrZXkgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAg\nICAgaWYgKGtleSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB3YXJuSW52\nYWxpZFByb3BlcnR5KChTdHJpbmcpIGtleSk7CiAgICAgICAgICAgICAgICBt\nYXAucmVtb3ZlKGtleSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIGNhY2hlIHByb3BlcnRpZXMKICAgICAgICBpZiAoX3Byb3BzID09\nIG51bGwgJiYgc2VyKQogICAgICAgICAgICBfcHJvcHMgPSBtYXA7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBMaXN0PFN0cmluZz4gZ2V0UHJvcGVydHlLZXlz\nKFN0cmluZyBwcm9wZXJ0eU5hbWUpIHsKICAgICAgICBWYWx1ZSB2YWx1ZSA9\nIGdldFZhbHVlKHByb3BlcnR5TmFtZSk7CiAgICAgICAgcmV0dXJuIHZhbHVl\nID09IG51bGwgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUIDogdmFsdWUuZ2V0\nUHJvcGVydHlLZXlzKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0\ncyBhbGwga25vd24gcHJvcGVydHkga2V5cy4KICAgICAqIFRoZSBrZXlzIGFy\nZSBoYXJ2ZXN0ZWQgZnJvbSB0aGUgcHJvcGVydHkgbmFtZXMgKGluY2x1ZGlu\nZyB0aGUgZXF1aXZhbGVudCBuYW1lcykgb2YgdGhlIHJlZ2lzdGVyZWQgdmFs\ndWVzLgogICAgICogQSBrZXkgbWF5IGJlIHByZWZpeGVkIGlmIHRoZSBjb3Jy\nZXNwb25kaW5nIHByb3BlcnR5IG5hbWUgd2FzIHdpdGhvdXQgYSBwcmVmaXgu\nCiAgICAgKiBAc2VlICNmaXhQcmVmaXgoU3RyaW5nKQogICAgICogVGhlIFZh\nbHVlcyB0aGF0IGFyZSB7QGxpbmtwbGFpbiBWYWx1ZSNtYWtlUHJpdmF0ZSgp\nIG1hcmtlZCBwcml2YXRlfSBhcmUgZmlsdGVyZWQgb3V0LiAKICAgICAqLwog\nICAgcHVibGljIFNldDxTdHJpbmc+IGdldFByb3BlcnR5S2V5cygpIHsKICAg\nICAgICBpZiAoX3N1cHBvcnRlZEtleXMgIT0gbnVsbCkgCiAgICAgICAgICAg\nIHJldHVybiBfc3VwcG9ydGVkS2V5czsKICAgICAgICAKICAgICAgICBfc3Vw\ncG9ydGVkS2V5cyA9IG5ldyBUcmVlU2V0PFN0cmluZz4oKTsKICAgICAgICBm\nb3IgKFZhbHVlIHZhbCA6IF92YWxzKSB7CiAgICAgICAgICAgIGlmICh2YWwu\naXNQcml2YXRlKCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgTGlzdDxTdHJpbmc+IGtleXMgPSB2YWwuZ2V0UHJvcGVydHlLZXlz\nKCk7CiAgICAgICAgICAgIGZvciAoU3RyaW5nIGtleSA6IGtleXMpIHsKICAg\nICAgICAgICAgICAgIF9zdXBwb3J0ZWRLZXlzLmFkZChmaXhQcmVmaXgoa2V5\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9z\ndXBwb3J0ZWRLZXlzOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFkZHMg\nYSBwcmVmaXggPGNvZGU+Im9wZW5qcGEuIjwvY29kZT4gdG8gdGhlIGdpdmVu\nIGtleSwgaWYgbmVjZXNzYXJ5LiBBIGtleSBpcyAKICAgICAqIGNvbnNpZGVy\nZWQgd2l0aG91dCBwcmVmaXggaWYgaXQgc3RhcnRzIG5laXRoZXIgb2YgPGNv\nZGU+Im9wZW5qcGEuIjwvY29kZT4sIAogICAgICogPGNvZGU+ImphdmEuIjwv\nY29kZT4gYW5kIDxjb2RlPiJqYXZheC4iPC9jb2RlPi4gCiAgICAgKi8KICAg\nIFN0cmluZyBmaXhQcmVmaXgoU3RyaW5nIGtleSkgewogICAgICAgIHJldHVy\nbiAoa2V5ID09IG51bGwgfHwgaGFzS25vd25QcmVmaXgoa2V5KSkgPyBrZXkg\nOiAib3BlbmpwYS4iK2tleTsKICAgIH0KICAgIAogICAgYm9vbGVhbiBoYXNL\nbm93blByZWZpeChTdHJpbmcga2V5KSB7CiAgICAgICAgU3RyaW5nW10gcHJl\nZml4ZXMgPSBQcm9kdWN0RGVyaXZhdGlvbnMuZ2V0Q29uZmlndXJhdGlvblBy\nZWZpeGVzKCk7CiAgICAgICAgZm9yIChTdHJpbmcgcHJlZml4IDogcHJlZml4\nZXMpIHsKICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKHByZWZpeCkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyA8\nY29kZT5vPC9jb2RlPiB0byA8Y29kZT5tYXA8L2NvZGU+IHVuZGVyIGtleSBm\nb3IgPGNvZGU+dmFsPC9jb2RlPi4KICAgICAqIFVzZSB0aGlzIG1ldGhvZCBp\nbnN0ZWFkIG9mIGF0dGVtcHRpbmcgdG8gYWRkIHRoZSB2YWx1ZSBkaXJlY3Rs\neSBiZWNhdXNlIAogICAgICogdGhpcyB3aWxsIGFjY291bnQgZm9yIHRoZSBw\ncm9wZXJ0eSBwcmVmaXguCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRW\nYWx1ZShNYXAgbWFwLCBWYWx1ZSB2YWwpIHsKICAgICAgICBPYmplY3Qga2V5\nID0gdmFsLmdldExvYWRLZXkoKTsKICAgICAgICBpZiAoa2V5ID09IG51bGwp\nIHsKICAgICAgICAgICAgTGlzdDxTdHJpbmc+IGtleXMgPSB2YWwuZ2V0UHJv\ncGVydHlLZXlzKCk7CiAgICAgICAgICAgIGZvciAoU3RyaW5nIGsgOiBrZXlz\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaGFzS25vd25QcmVmaXgoaykpIHsK\nICAgICAgICAgICAgICAgICAgICBrZXkgPSBrOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChrZXkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\na2V5ID0gIm9wZW5qcGEuIiArIHZhbC5nZXRQcm9wZXJ0eSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdCBleHRlcm5hbCA9IHZh\nbC5pc0hpZGRlbigpID8gVmFsdWUuSU5WSVNJQkxFIDogCiAgICAgICAgICAg\nIHZhbCBpbnN0YW5jZW9mIE9iamVjdFZhbHVlID8gdmFsLmdldFN0cmluZygp\nIDogdmFsLmdldCgpOwogICAgICAgIG1hcC5wdXQoa2V5LCBleHRlcm5hbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBMb29rIHVwIHRoZSBnaXZlbiB2YWx1\nZSwgdGVzdGluZyBhbGwgYXZhaWxhYmxlIHByZWZpeGVzIGFuZCBhbGwgcG9z\nc2libGUKICAgICAqIHByb3BlcnR5IG5hbWVzLiBEZXRlY3RzIGlmIHRoZSBn\naXZlbiBtYXAgY29udGFpbnMgbXVsdGlwbGUga2V5cyB0aGF0CiAgICAgKiBh\ncmUgZXF1aXZhbGVudCBuYW1lcyBmb3IgdGhlIGdpdmVuIHZhbHVlLiAKICAg\nICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZmluZFZhbHVlKE1hcCBtYXAsIFZh\nbHVlIHZhbCkgewogICAgICAgIE9iamVjdCByZXN1bHQgPSBudWxsOwogICAg\nICAgIExpc3Q8U3RyaW5nPiBwYXJ0aWFsS2V5cyA9IHZhbC5nZXRQcm9wZXJ0\neUtleXMoKTsKICAgICAgICBmb3IgKFN0cmluZyBwYXJ0aWFsS2V5IDogcGFy\ndGlhbEtleXMpIHsKICAgICAgICAgICAgU3RyaW5nIGtleSA9IFByb2R1Y3RE\nZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9uS2V5KAogICAgICAgICAgICAg\nICAgcGFydGlhbEtleSwgbWFwKTsKICAgICAgICAgICAgaWYgKG1hcC5jb250\nYWluc0tleShrZXkpKSB7CiAgICAgICAgICAgICAgICAvLyBkbyBub3QgcmV0\ndXJuIGltbWVkaWF0ZWx5LiBMb29waW5nIHRocm91Z2ggYWxsIGVxdWl2YWxl\nbnQKICAgICAgICAgICAgICAgIC8vIHByb3BlcnR5IG5hbWVzIHdpbGwgZGV0\nZWN0IGlmIHRoZSBNYXAgY29udGFpbnMgbXVsdGlwbGUga2V5cwogICAgICAg\nICAgICAgICAgLy8gdGhhdCBhcmUgZXF1aXZhbGVudCBhcyBpdCB0cmllcyB0\nbyBzZXQgbG9hZCBrZXkuCiAgICAgICAgICAgICAgICB2YWwuc2V0TG9hZEtl\neShrZXkpOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gbWFwLmdldChrZXkp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1\nbHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBJc3N1ZSBhIHdhcm5pbmcgdGhh\ndCB0aGUgc3BlY2lmaWVkIHByb3BlcnR5IGlzIG5vdCB2YWxpZC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHdhcm5JbnZhbGlkUHJvcGVydHkoU3RyaW5n\nIHByb3BOYW1lKSB7CiAgICAgICAgaWYgKHByb3BOYW1lICE9IG51bGwgJiYg\nCiAgICAgICAgICAgKHByb3BOYW1lLnN0YXJ0c1dpdGgoImphdmEuIikgfHwg\ncHJvcE5hbWUuc3RhcnRzV2l0aCgiamF2YXgucGVyc2lzdGVuY2UiKXx8IHBy\nb3BOYW1lLnN0YXJ0c1dpdGgoInN1bi4iKSkpIAogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgaWYgKCFpc0ludmFsaWRQcm9wZXJ0eShwcm9wTmFtZSkp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBMb2cgbG9nID0gZ2V0Q29u\nZmlndXJhdGlvbkxvZygpOwogICAgICAgIGlmIChsb2cgPT0gbnVsbCB8fCAh\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyB0cnkgdG8gZmluZCB0aGUgY2xvc2VzdCBzdHJpbmcgdG8gdGhl\nIGludmFsaWQgcHJvcGVydHkKICAgICAgICAvLyBzbyB0aGF0IHdlIGNhbiBw\ncm92aWRlIGEgaGludCBpbiBjYXNlIG9mIGEgbWlzc3BlbGxpbmcKICAgICAg\nICBTdHJpbmcgY2xvc2VzdCA9IFN0cmluZ0Rpc3RhbmNlLmdldENsb3Nlc3RM\nZXZlbnNodGVpbkRpc3RhbmNlCiAgICAgICAgICAgIChwcm9wTmFtZSwgbmV3\nUHJvcGVydHlMaXN0KCksIDE1KTsKCiAgICAgICAgaWYgKGNsb3Nlc3QgPT0g\nbnVsbCkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQt\ncHJvcGVydHkiLCBwcm9wTmFtZSkpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQtcHJvcGVydHktaGludCIs\nIHByb3BOYW1lLCBjbG9zZXN0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBjb21wcmVoZW5zaXZlIGxpc3Qgb2YgcmVjb2duaXplZCBtYXAg\na2V5cy4KICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uPFN0cmluZz4g\nbmV3UHJvcGVydHlMaXN0KCkgewogICAgICAgIFN0cmluZ1tdIHByZWZpeGVz\nID0gUHJvZHVjdERlcml2YXRpb25zLmdldENvbmZpZ3VyYXRpb25QcmVmaXhl\ncygpOwogICAgICAgIExpc3Q8U3RyaW5nPiBsID0gbmV3IEFycmF5TGlzdDxT\ndHJpbmc+KF92YWxzLnNpemUoKSAqIHByZWZpeGVzLmxlbmd0aCk7CiAgICAg\nICAgZm9yKFZhbHVlIHYgOiBfdmFscykgeyAKICAgICAgICAgICAgZm9yIChp\nbnQgaiA9IDA7IGogPCBwcmVmaXhlcy5sZW5ndGg7IGorKykKICAgICAgICAg\nICAgICAgIGwuYWRkKHByZWZpeGVzW2pdICsgIi4iICsgdi5nZXRQcm9wZXJ0\neSgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHNwZWNpZmllZCBwcm9w\nZXJ0eSBuYW1lIHNob3VsZCByYWlzZSBhIHdhcm5pbmcKICAgICAqIGlmIGl0\nIGlzIG5vdCBmb3VuZCBpbiB0aGUgbGlzdCBvZiBrbm93biBwcm9wZXJ0aWVz\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc0ludmFsaWRQcm9w\nZXJ0eShTdHJpbmcgcHJvcE5hbWUpIHsKICAgICAgICAvLyBoYW5kbGUgd2Fy\nbmluZ3MgZm9yIG9wZW5qcGEuU29tZVN0cmluZywgYnV0IG5vdCBmb3IKICAg\nICAgICAvLyBvcGVuanBhLnNvbWUuc3VicGFja2FnZS5Tb21lU3RyaW5nLCBz\naW5jZSBpdCBtaWdodCBiZSB2YWxpZCBmb3Igc29tZQogICAgICAgIC8vIHNw\nZWNpZmljIGltcGxlbWVudGF0aW9uIG9mIE9wZW5KUEEKICAgICAgICBTdHJp\nbmdbXSBwcmVmaXhlcyA9IFByb2R1Y3REZXJpdmF0aW9ucy5nZXRDb25maWd1\ncmF0aW9uUHJlZml4ZXMoKTsKICAgICAgICBmb3IgKFN0cmluZyBwcmVmaXgg\nOiBwcmVmaXhlcykgewogICAgICAgICAgICBpZiAocHJvcE5hbWUudG9Mb3dl\nckNhc2UoKS5zdGFydHNXaXRoKHByZWZpeCkKICAgICAgICAgICAgICAgICYm\nIHByb3BOYW1lLmxlbmd0aCgpID4gcHJlZml4Lmxlbmd0aCgpICsgMQogICAg\nICAgICAgICAgICAgJiYgcHJvcE5hbWUuaW5kZXhPZignLicsIHByZWZpeC5s\nZW5ndGgoKSkgPT0gcHJlZml4Lmxlbmd0aCgpCiAgICAgICAgICAgICAgICAm\nJiBwcm9wTmFtZS5pbmRleE9mKCcuJywgcHJlZml4Lmxlbmd0aCgpICsgMSkg\nPT0gLTEKICAgICAgICAgICAgICAgICYmICJvcGVuanBhIi5lcXVhbHMocHJl\nZml4KSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gQXV0by1jb25maWd1cmF0aW9uCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhv\nZCBsb2FkcyB0aGUgbmFtZWQgcmVzb3VyY2UgYXMgYSBwcm9wZXJ0aWVzIGZp\nbGUuIEl0IGlzCiAgICAgKiB1c2VmdWwgZm9yIGF1dG8tY29uZmlndXJhdGlv\nbiB0b29scyBzbyB1c2VycyBjYW4gc3BlY2lmeSBhCiAgICAgKiA8Y29kZT5w\ncm9wZXJ0aWVzPC9jb2RlPiB2YWx1ZSB3aXRoIHRoZSBuYW1lIG9mIGEgcmVz\nb3VyY2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFByb3BlcnRpZXMo\nU3RyaW5nIHJlc291cmNlTmFtZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBQcm9kdWN0RGVyaXZhdGlvbnMubG9hZChyZXNvdXJjZU5hbWUsIG51\nbGwsIAogICAgICAgICAgICBnZXRDbGFzcygpLmdldENsYXNzTG9hZGVyKCkp\nLnNldEludG8odGhpcyk7CiAgICAgICAgX2F1dG8gPSByZXNvdXJjZU5hbWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBsb2FkcyB0aGUg\nbmFtZWQgZmlsZSBhcyBhIHByb3BlcnRpZXMgZmlsZS4gSXQgaXMKICAgICAq\nIHVzZWZ1bCBmb3IgYXV0by1jb25maWd1cmF0aW9uIHRvb2xzIHNvIHVzZXJz\nIGNhbiBzcGVjaWZ5IGEKICAgICAqIDxjb2RlPnByb3BlcnRpZXNGaWxlPC9j\nb2RlPiB2YWx1ZSB3aXRoIHRoZSBuYW1lIG9mIGEgZmlsZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0UHJvcGVydGllc0ZpbGUoRmlsZSBmaWxlKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIFByb2R1Y3REZXJpdmF0aW9u\ncy5sb2FkKGZpbGUsIG51bGwsIGdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIo\nKSkuCiAgICAgICAgICAgIHNldEludG8odGhpcyk7CiAgICAgICAgX2F1dG8g\nPSBmaWxlLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHJlc291cmNlIHRoYXQgd2FzIHNldCB2aWEgYXV0by1jb25maWd1\ncmF0aW9uIG1ldGhvZHMKICAgICAqIHtAbGluayAjc2V0UHJvcGVydGllc30g\nb3Ige0BsaW5rICNzZXRQcm9wZXJ0aWVzRmlsZX0sIG9yIG51bGwgaWYgbm9u\nZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRQcm9wZXJ0aWVzUmVz\nb3VyY2UoKSB7CiAgICAgICAgcmV0dXJuIF9hdXRvOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8KICAgIC8vIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8v\nLwoKICAgIC8qKgogICAgICogUGVyZm9ybXMgYW4gZXF1YWxpdHkgY2hlY2sg\nYmFzZWQgb24gZXF1YWxpdHkgb2YgdmFsdWVzLgogICAgICoge0BsaW5rIFZh\nbHVlI2VxdWFscyhPYmplY3QpIEVxdWFsaXR5fSBvZiBWYWx1ZXMgdmFyaWVz\nIGlmIHRoZSBWYWx1ZSBpcwogICAgICoge0BsaW5rIFZhbHVlI2lzRHluYW1p\nYygpIGR5bmFtaWN9LiAgCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGVx\ndWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhp\ncykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKG90aGVy\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBp\nZiAoIWdldENsYXNzKCkuZXF1YWxzKG90aGVyLmdldENsYXNzKCkpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGNvbXBhcmUgcHJv\ncGVydGllcwogICAgICAgIENvbmZpZ3VyYXRpb25JbXBsIGNvbmYgPSAoQ29u\nZmlndXJhdGlvbkltcGwpIG90aGVyOwogICAgICAgIGlmIChfdmFscy5zaXpl\nKCkgIT0gY29uZi5nZXRWYWx1ZXMoKS5sZW5ndGgpCiAgICAgICAgCXJldHVy\nbiBmYWxzZTsKICAgICAgICBmb3IoVmFsdWUgdiA6IF92YWxzKSB7IAogICAg\nICAgIAlWYWx1ZSB0aGF0ViA9IGNvbmYuZ2V0VmFsdWUodi5nZXRQcm9wZXJ0\neSgpKTsKICAgICAgICAJaWYgKCF2LmVxdWFscyh0aGF0VikpIHsKICAgICAg\nICAJCXJldHVybiBmYWxzZTsKICAgICAgICAJfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbXB1dGVz\nIGhhc2ggY29kZSBiYXNlZCBvbiB0aGUgaGFzaENvZGVzIG9mIHRoZSB2YWx1\nZXMuCiAgICAgKiB7QGxpbmsgVmFsdWUjaGFzaENvZGUoKSBIYXNoQ29kZX0g\nb2YgYSBWYWx1ZSB2YXJpZXMgaWYgdGhlIFZhbHVlIGlzCiAgICAgKiB7QGxp\nbmsgVmFsdWUjaXNEeW5hbWljKCkgZHluYW1pY30uICAKICAgICAqLwogICAg\ncHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICBpbnQgaGFzaCA9IDA7\nCiAgICAgICAgZm9yKFZhbHVlIHYgOiBfdmFscykgeyAKICAgICAgICAJaGFz\naCArPSB2Lmhhc2hDb2RlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBo\nYXNoOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCA8Y29kZT5wcm9w\nTmFtZTwvY29kZT4gdG8gYSBsb3dlcmNhc2Utd2l0aC1oeXBoZW5zLXN0eWxl\nIHN0cmluZy4KICAgICAqIFRoaXMgYWxnb3JpdGhtIGlzIG9ubHkgZGVzaWdu\nZWQgZm9yIG1peGVzIG9mIHVwcGVyY2FzZSBhbmQgbG93ZXJjYXNlIAogICAg\nICogbGV0dGVycyBhbmQgbG9uZSBkaWdpdHMuIEEgbW9yZSBzb3BoaXN0aWNh\ndGVkIGNvbnZlcnNpb24gc2hvdWxkIHByb2JhYmx5IAogICAgICogYmUgaGFu\nZGxlZCBieSBhIHByb3BlciBwYXJzZXIgZ2VuZXJhdG9yIG9yIHJlZ3VsYXIg\nZXhwcmVzc2lvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5n\nIHRvWE1MTmFtZShTdHJpbmcgcHJvcE5hbWUpIHsKICAgICAgICBpZiAocHJv\ncE5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgU3RyaW5nQnVpbGRlciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwog\nICAgICAgIGNoYXIgYzsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBy\nb3BOYW1lLmxlbmd0aCgpOyBpKyspIHsKICAgICAgICAgICAgYyA9IHByb3BO\nYW1lLmNoYXJBdChpKTsKCiAgICAgICAgICAgIC8vIGNvbnZlcnQgc2VxdWVu\nY2VzIG9mIGFsbC1jYXBzIHRvIGRvd25jYXNlIHdpdGggZGFzaGVzIGFyb3Vu\nZCAKICAgICAgICAgICAgLy8gdGhlbS4gcHV0IGEgdHJhaWxpbmcgY2FwIHRo\nYXQgaXMgZm9sbG93ZWQgYnkgZG93bmNhc2UgaW50byB0aGUKICAgICAgICAg\nICAgLy8gZG93bmNhc2Ugd29yZC4KICAgICAgICAgICAgaWYgKGkgIT0gMCAm\nJiBDaGFyYWN0ZXIuaXNVcHBlckNhc2UoYykgCiAgICAgICAgICAgICAgICAm\nJiAoQ2hhcmFjdGVyLmlzTG93ZXJDYXNlKHByb3BOYW1lLmNoYXJBdChpLTEp\nKQogICAgICAgICAgICAgICAgfHwgKGkgPiAxICYmIGkgPCBwcm9wTmFtZS5s\nZW5ndGgoKSAtIDEKICAgICAgICAgICAgICAgICYmIENoYXJhY3Rlci5pc1Vw\ncGVyQ2FzZShwcm9wTmFtZS5jaGFyQXQoaS0xKSkgCiAgICAgICAgICAgICAg\nICAmJiBDaGFyYWN0ZXIuaXNMb3dlckNhc2UocHJvcE5hbWUuY2hhckF0KGkr\nMSkpKSkpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCctJyk7CiAgICAg\nICAgICAgIAogICAgICAgICAgICAvLyBzdXJyb3VuZCBzZXF1ZW5jZXMgb2Yg\nZGlnaXRzIHdpdGggZGFzaGVzLgogICAgICAgICAgICBpZiAoaSAhPSAwCiAg\nICAgICAgICAgICAgICAmJiAoKCFDaGFyYWN0ZXIuaXNMZXR0ZXIoYykgJiYg\nQ2hhcmFjdGVyLmlzTGV0dGVyKHByb3BOYW1lCiAgICAgICAgICAgICAgICAg\nICAgLmNoYXJBdChpIC0gMSkpKSAKICAgICAgICAgICAgICAgIHx8IChDaGFy\nYWN0ZXIuaXNMZXR0ZXIoYykgJiYgIUNoYXJhY3Rlci5pc0xldHRlcihwcm9w\nTmFtZQogICAgICAgICAgICAgICAgICAgIC5jaGFyQXQoaSAtIDEpKSkpKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgnLScpOwogICAgICAgICAgICAK\nICAgICAgICAgICAgYnVmLmFwcGVuZChDaGFyYWN0ZXIudG9Mb3dlckNhc2Uo\nYykpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogSW1wbGVtZW50YXRpb24gb2Yg\ndGhlIHtAbGluayBFeHRlcm5hbGl6YWJsZX0gaW50ZXJmYWNlIHRvIHJlYWQg\nZnJvbQogICAgICogdGhlIHByb3BlcnRpZXMgd3JpdHRlbiBieSB7QGxpbmsg\nI3dyaXRlRXh0ZXJuYWx9LgogICAgICovCiAgICBAU3VwcHJlc3NXYXJuaW5n\ncygidW5jaGVja2VkIikKICAgIHB1YmxpYyB2b2lkIHJlYWRFeHRlcm5hbChP\nYmplY3RJbnB1dCBpbikKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENs\nYXNzTm90Rm91bmRFeGNlcHRpb24gewogICAgICAgIGZyb21Qcm9wZXJ0aWVz\nKChNYXApIGluLnJlYWRPYmplY3QoKSk7CiAgICAgICAgX3Byb3BzID0gKE1h\ncCkgaW4ucmVhZE9iamVjdCgpOwogICAgICAgIF9nbG9iYWxzID0gaW4ucmVh\nZEJvb2xlYW4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVudGF0\naW9uIG9mIHRoZSB7QGxpbmsgRXh0ZXJuYWxpemFibGV9IGludGVyZmFjZSB0\nbyB3cml0ZQogICAgICogdGhlIHByb3BlcnRpZXMgcmV0dXJuZWQgYnkge0Bs\naW5rICN0b1Byb3BlcnRpZXN9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCB3\ncml0ZUV4dGVybmFsKE9iamVjdE91dHB1dCBvdXQpIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KHRvUHJvcGVydGllcyh0\ncnVlKSk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KF9wcm9wcyk7CiAgICAg\nICAgb3V0LndyaXRlQm9vbGVhbihfZ2xvYmFscyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBVc2VzIHtAbGluayAjdG9Qcm9wZXJ0aWVzfSBhbmQge0BsaW5r\nICNmcm9tUHJvcGVydGllc30gdG8gY2xvbmUKICAgICAqIGNvbmZpZ3VyYXRp\nb24uCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKSB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGdldENs\nYXNzKCkuZ2V0Q29uc3RydWN0b3IKICAgICAgICAgICAgICAgIChuZXcgQ2xh\nc3NbXXsgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgQ29uZmlndXJh\ndGlvbkltcGwgY2xvbmUgPSAoQ29uZmlndXJhdGlvbkltcGwpIGNvbnMubmV3\nSW5zdGFuY2UKICAgICAgICAgICAgICAgIChuZXcgT2JqZWN0W117IEJvb2xl\nYW4uRkFMU0UgfSk7CiAgICAgICAgICAgIGNsb25lLmZyb21Qcm9wZXJ0aWVz\nKHRvUHJvcGVydGllcyh0cnVlKSk7CiAgICAgICAgICAgIGNsb25lLl9wcm9w\ncyA9IChfcHJvcHMgPT0gbnVsbCkgPyBudWxsIDogbmV3IEhhc2hNYXAoX3By\nb3BzKTsKICAgICAgICAgICAgY2xvbmUuX2dsb2JhbHMgPSBfZ2xvYmFsczsK\nICAgICAgICAgICAgcmV0dXJuIGNsb25lOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgcmU7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFBhcnNlRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiByZW1vdmVWYWx1ZShWYWx1ZSB2YWwpIHsKICAg\nICAgICBpZiAoIV92YWxzLnJlbW92ZSh2YWwpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgdmFsLnJlbW92ZUxpc3RlbmVyKHRoaXMpOwog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyA8VCBleHRl\nbmRzIFZhbHVlPiBUIGFkZFZhbHVlKFQgdmFsKSB7CiAgICAgICAgX3ZhbHMu\nYWRkKHZhbCk7CiAgICAgICAgdmFsLmFkZExpc3RlbmVyKHRoaXMpOwogICAg\nICAgIHJldHVybiB2YWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhl\nIGdpdmVuIHZhbHVlIHRvIHRoZSBzZXQgb2YgY29uZmlndXJhdGlvbiBwcm9w\nZXJ0aWVzLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nVmFsdWUgYWRkU3Ry\naW5nKFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAgIFN0cmluZ1ZhbHVlIHZh\nbCA9IG5ldyBTdHJpbmdWYWx1ZShwcm9wZXJ0eSk7CiAgICAgICAgYWRkVmFs\ndWUodmFsKTsKICAgICAgICByZXR1cm4gdmFsOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHRoZSBnaXZlbiB2YWx1ZSB0byB0aGUgc2V0IG9mIGNvbmZp\nZ3VyYXRpb24gcHJvcGVydGllcy4KICAgICAqLwogICAgcHVibGljIEZpbGVW\nYWx1ZSBhZGRGaWxlKFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAgIEZpbGVW\nYWx1ZSB2YWwgPSBuZXcgRmlsZVZhbHVlKHByb3BlcnR5KTsKICAgICAgICBh\nZGRWYWx1ZSh2YWwpOwogICAgICAgIHJldHVybiB2YWw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBzZXQgb2Yg\nY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzLgogICAgICovCiAgICBwdWJsaWMg\nSW50VmFsdWUgYWRkSW50KFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAgIElu\ndFZhbHVlIHZhbCA9IG5ldyBJbnRWYWx1ZShwcm9wZXJ0eSk7CiAgICAgICAg\nYWRkVmFsdWUodmFsKTsKICAgICAgICByZXR1cm4gdmFsOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiB2YWx1ZSB0byB0aGUgc2V0IG9m\nIGNvbmZpZ3VyYXRpb24gcHJvcGVydGllcy4KICAgICAqLwogICAgcHVibGlj\nIERvdWJsZVZhbHVlIGFkZERvdWJsZShTdHJpbmcgcHJvcGVydHkpIHsKICAg\nICAgICBEb3VibGVWYWx1ZSB2YWwgPSBuZXcgRG91YmxlVmFsdWUocHJvcGVy\ndHkpOwogICAgICAgIGFkZFZhbHVlKHZhbCk7CiAgICAgICAgcmV0dXJuIHZh\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gdmFsdWUg\ndG8gdGhlIHNldCBvZiBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBCb29sZWFuVmFsdWUgYWRkQm9vbGVhbihTdHJpbmcg\ncHJvcGVydHkpIHsKICAgICAgICBCb29sZWFuVmFsdWUgdmFsID0gbmV3IEJv\nb2xlYW5WYWx1ZShwcm9wZXJ0eSk7CiAgICAgICAgYWRkVmFsdWUodmFsKTsK\nICAgICAgICB2YWwuc2V0RGVmYXVsdCgiZmFsc2UiKTsKICAgICAgICByZXR1\ncm4gdmFsOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiB2\nYWx1ZSB0byB0aGUgc2V0IG9mIGNvbmZpZ3VyYXRpb24gcHJvcGVydGllcy4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZ0xpc3RWYWx1ZSBhZGRTdHJpbmdM\naXN0KFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAgIFN0cmluZ0xpc3RWYWx1\nZSB2YWwgPSBuZXcgU3RyaW5nTGlzdFZhbHVlKHByb3BlcnR5KTsKICAgICAg\nICBhZGRWYWx1ZSh2YWwpOwogICAgICAgIHJldHVybiB2YWw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBzZXQg\nb2YgY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzLgogICAgICovCiAgICBwdWJs\naWMgT2JqZWN0VmFsdWUgYWRkT2JqZWN0KFN0cmluZyBwcm9wZXJ0eSkgewog\nICAgICAgIE9iamVjdFZhbHVlIHZhbCA9IG5ldyBPYmplY3RWYWx1ZShwcm9w\nZXJ0eSk7CiAgICAgICAgYWRkVmFsdWUodmFsKTsKICAgICAgICByZXR1cm4g\ndmFsOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiB2YWx1\nZSB0byB0aGUgc2V0IG9mIGNvbmZpZ3VyYXRpb24gcHJvcGVydGllcy4KICAg\nICAqLwogICAgcHVibGljIFBsdWdpblZhbHVlIGFkZFBsdWdpbihTdHJpbmcg\ncHJvcGVydHksIGJvb2xlYW4gc2luZ2xldG9uKSB7CiAgICAgICAgUGx1Z2lu\nVmFsdWUgdmFsID0gbmV3IFBsdWdpblZhbHVlKHByb3BlcnR5LCBzaW5nbGV0\nb24pOwogICAgICAgIGFkZFZhbHVlKHZhbCk7CiAgICAgICAgcmV0dXJuIHZh\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gdmFsdWUg\ndG8gdGhlIHNldCBvZiBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBQbHVnaW5MaXN0VmFsdWUgYWRkUGx1Z2luTGlzdChT\ndHJpbmcgcHJvcGVydHkpIHsKICAgICAgICBQbHVnaW5MaXN0VmFsdWUgdmFs\nID0gbmV3IFBsdWdpbkxpc3RWYWx1ZShwcm9wZXJ0eSk7CiAgICAgICAgYWRk\nVmFsdWUodmFsKTsKICAgICAgICByZXR1cm4gdmFsOwogICAgfQp9Cg==\n","encoding":"base64"}

