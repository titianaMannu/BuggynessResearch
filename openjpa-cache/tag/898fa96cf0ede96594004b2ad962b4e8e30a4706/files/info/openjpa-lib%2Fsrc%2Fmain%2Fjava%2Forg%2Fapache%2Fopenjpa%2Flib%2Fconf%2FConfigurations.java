{"sha":"fb4d9cd03bf908db1cdbeb7f7116633611bb6db1","node_id":"MDQ6QmxvYjIwNjM2NDpmYjRkOWNkMDNiZjkwOGRiMWNkYmViN2Y3MTE2NjMzNjExYmI2ZGIx","size":28043,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fb4d9cd03bf908db1cdbeb7f7116633611bb6db1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmY7CgppbXBvcnQg\namF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwppbXBvcnQgamF2YS51dGlsLk1pc3NpbmdSZXNvdXJjZUV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwppbXBvcnQgamF2YS51dGls\nLlRyZWVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJy\nZW50SGFzaE1hcDsKCmltcG9ydCBqYXZheC5uYW1pbmcuQ29udGV4dDsKaW1w\nb3J0IGphdmF4Lm5hbWluZy5Jbml0aWFsQ29udGV4dDsKaW1wb3J0IGphdmF4\nLm5hbWluZy5OYW1pbmdFeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5j\nb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5leGNlcHRpb24uTmVzdGFibGVSdW50aW1lRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5NdWx0aUNs\nYXNzTG9hZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nUGFyc2VFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50UmVmZXJlbmNlSGFz\naE1hcDsKCmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBVdGls\naXR5IG1ldGhvZHMgZGVhbGluZyB3aXRoIGNvbmZpZ3VyYXRpb24uCiAqCiAq\nIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBj\nbGFzcyBDb25maWd1cmF0aW9ucyB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAg\nICAgIChDb25maWd1cmF0aW9ucy5jbGFzcyk7CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwIF9sb2Fk\nZXJzID0gbmV3CiAgICAgICAgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAo\nQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAuV0VBSywgCiAgICAgICAgICAg\nICAgICBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1hcC5IQVJEKTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgTlVMTF9MT0FERVIgPSAibnVs\nbC1sb2FkZXIiOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjbGFzcyBu\nYW1lIGZyb20gdGhlIGdpdmVuIHBsdWdpbiBzdHJpbmcsIG9yIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0Q2xh\nc3NOYW1lKFN0cmluZyBwbHVnaW4pIHsKICAgICAgICByZXR1cm4gZ2V0UGx1\nZ2luQ29tcG9uZW50KHBsdWdpbiwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHByb3BlcnRpZXMgcGFydCBvZiB0aGUgZ2l2ZW4g\ncGx1Z2luIHN0cmluZywgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIFN0cmluZyBnZXRQcm9wZXJ0aWVzKFN0cmluZyBwbHVn\naW4pIHsKICAgICAgICByZXR1cm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdp\nbiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGVpdGhl\nciB0aGUgY2xhc3MgbmFtZSBvciBwcm9wZXJ0aWVzIHN0cmluZyBmcm9tIGEg\ncGx1Z2luIHN0cmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3Ry\naW5nIGdldFBsdWdpbkNvbXBvbmVudChTdHJpbmcgcGx1Z2luLCBib29sZWFu\nIGNsc05hbWUpIHsKICAgICAgICBpZiAocGx1Z2luICE9IG51bGwpCiAgICAg\nICAgICAgIHBsdWdpbiA9IHBsdWdpbi50cmltKCk7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkocGx1Z2luKSkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIGludCBvcGVuUGFyZW4gPSAtMTsKICAgICAgICBp\nZiAocGx1Z2luLmNoYXJBdChwbHVnaW4ubGVuZ3RoKCkgLSAxKSA9PSAnKScp\nCiAgICAgICAgICAgIG9wZW5QYXJlbiA9IHBsdWdpbi5pbmRleE9mKCcoJyk7\nCiAgICAgICAgaWYgKG9wZW5QYXJlbiA9PSAtMSkgewogICAgICAgICAgICBp\nbnQgZXEgPSBwbHVnaW4uaW5kZXhPZignPScpOwogICAgICAgICAgICBpZiAo\nZXEgPT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gKGNsc05hbWUpID8g\ncGx1Z2luIDogbnVsbDsKICAgICAgICAgICAgcmV0dXJuIChjbHNOYW1lKSA/\nIG51bGwgOiBwbHVnaW47CiAgICAgICAgfQoKICAgICAgICAvLyBjbHNOYW1l\nKHByb3BzKSBmb3JtCiAgICAgICAgaWYgKGNsc05hbWUpCiAgICAgICAgICAg\nIHJldHVybiBwbHVnaW4uc3Vic3RyaW5nKDAsIG9wZW5QYXJlbikudHJpbSgp\nOwogICAgICAgIFN0cmluZyBwcm9wID0gcGx1Z2luLnN1YnN0cmluZyhvcGVu\nUGFyZW4gKyAxLAogICAgICAgICAgICBwbHVnaW4ubGVuZ3RoKCkgLSAxKS50\ncmltKCk7CiAgICAgICAgcmV0dXJuIChwcm9wLmxlbmd0aCgpID09IDApID8g\nbnVsbCA6IHByb3A7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRo\nZSBnaXZlbiBjbGFzcyBuYW1lIGFuZCBwcm9wZXJ0aWVzIGludG8gYSBwbHVn\naW4gc3RyaW5nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBn\nZXRQbHVnaW4oU3RyaW5nIGNsc05hbWUsIFN0cmluZyBwcm9wcykgewogICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGNsc05hbWUpKQogICAgICAg\nICAgICByZXR1cm4gcHJvcHM7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkocHJvcHMpKQogICAgICAgICAgICByZXR1cm4gY2xzTmFtZTsKICAg\nICAgICByZXR1cm4gY2xzTmFtZSArICIoIiArIHByb3BzICsgIikiOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgcGx1Z2luIHN0cmluZyB0aGF0\nIGNvbWJpbmVzIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbiBwbHVnaW4K\nICAgICAqIHN0cmluZ3MsIHdoZXJlIHByb3BlcnRpZXMgb2YgPGNvZGU+b3Zl\ncnJpZGU8L2NvZGU+IHdpbGwgb3ZlcnJpZGUgdGhlCiAgICAgKiBzYW1lIHBy\nb3BlcnRpZXMgb2YgPGNvZGU+b3JpZzwvY29kZT4uCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgU3RyaW5nIGNvbWJpbmVQbHVnaW5zKFN0cmluZyBvcmln\nLCBTdHJpbmcgb3ZlcnJpZGUpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShvcmlnKSkKICAgICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOwog\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXJyaWRlKSkKICAg\nICAgICAgICAgcmV0dXJuIG9yaWc7CgogICAgICAgIFN0cmluZyBvcmlnQ2xz\nID0gZ2V0Q2xhc3NOYW1lKG9yaWcpOwogICAgICAgIFN0cmluZyBvdmVycmlk\nZUNscyA9IGdldENsYXNzTmFtZShvdmVycmlkZSk7CiAgICAgICAgU3RyaW5n\nIGNsczsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnQ2xz\nKSkKICAgICAgICAgICAgY2xzID0gb3ZlcnJpZGVDbHM7CiAgICAgICAgZWxz\nZSBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvdmVycmlkZUNscykpCiAgICAg\nICAgICAgIGNscyA9IG9yaWdDbHM7CiAgICAgICAgZWxzZSBpZiAoIW9yaWdD\nbHMuZXF1YWxzKG92ZXJyaWRlQ2xzKSkKICAgICAgICAgICAgcmV0dXJuIG92\nZXJyaWRlOyAvLyBjb21wbGV0ZWx5IGRpZmZlcmVudCBwbHVnaW4KICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGNscyA9IG9yaWdDbHM7CgogICAgICAgIFN0\ncmluZyBvcmlnUHJvcHMgPSBnZXRQcm9wZXJ0aWVzKG9yaWcpOwogICAgICAg\nIFN0cmluZyBvdmVycmlkZVByb3BzID0gZ2V0UHJvcGVydGllcyhvdmVycmlk\nZSk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkob3JpZ1Byb3Bz\nKSkKICAgICAgICAgICAgcmV0dXJuIGdldFBsdWdpbihjbHMsIG92ZXJyaWRl\nUHJvcHMpOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXJy\naWRlUHJvcHMpKQogICAgICAgICAgICByZXR1cm4gZ2V0UGx1Z2luKGNscywg\nb3JpZ1Byb3BzKTsKCiAgICAgICAgUHJvcGVydGllcyBwcm9wcyA9IHBhcnNl\nUHJvcGVydGllcyhvcmlnUHJvcHMpOwogICAgICAgIHByb3BzLnB1dEFsbChw\nYXJzZVByb3BlcnRpZXMob3ZlcnJpZGVQcm9wcykpOwogICAgICAgIHJldHVy\nbiBnZXRQbHVnaW4oY2xzLCBzZXJpYWxpemVQcm9wZXJ0aWVzKHByb3BzKSk7\nIAogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBpbnN0YW5jZSB3\naXRoIHRoZSBnaXZlbiBjbGFzcyBuYW1lLCB1c2luZyB0aGUgZ2l2ZW4KICAg\nICAqIGNsYXNzIGxvYWRlci4gTm8gY29uZmlndXJhdGlvbiBvZiB0aGUgaW5z\ndGFuY2UgaXMgcGVyZm9ybWVkIGJ5CiAgICAgKiB0aGlzIG1ldGhvZC4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgbmV3SW5zdGFuY2UoU3Ry\naW5nIGNsc05hbWUsIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIHJl\ndHVybiBuZXdJbnN0YW5jZShjbHNOYW1lLCBudWxsLCBudWxsLCBsb2FkZXIs\nIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuZCBjb25m\naWd1cmUgYW4gaW5zdGFuY2Ugd2l0aCB0aGUgZ2l2ZW4gY2xhc3MgbmFtZSBh\nbmQKICAgICAqIHByb3BlcnRpZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBjbHNOYW1lLCBDb25maWd1\ncmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3BzLCBDbGFzc0xvYWRl\nciBsb2FkZXIpIHsKICAgICAgICBPYmplY3Qgb2JqID0gbmV3SW5zdGFuY2Uo\nY2xzTmFtZSwgbnVsbCwgY29uZiwgbG9hZGVyLCB0cnVlKTsKICAgICAgICBj\nb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BzKTsKICAgICAgICBy\nZXR1cm4gb2JqOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhv\nZCB1c2VkIGJ5IG1lbWJlcnMgb2YgdGhpcyBwYWNrYWdlIHRvIGluc3RhbnRp\nYXRlIHBsdWdpbgogICAgICogdmFsdWVzLgogICAgICovCiAgICBzdGF0aWMg\nT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBjbHNOYW1lLCBWYWx1ZSB2YWws\nIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBDbGFzc0xvYWRlciBsb2Fk\nZXIsIGJvb2xlYW4gZmF0YWwpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShjbHNOYW1lKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIENsYXNzIGNscyA9IG51bGw7IAoKICAgICAgICB3aGlsZSAoY2xz\nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gY2FuJ3QgaGF2ZSBhIG51bGwg\ncmVmZXJlbmNlIGluIHRoZSBtYXAsIHNvIHVzZSBzeW1ib2xpYwogICAgICAg\nICAgICAvLyBjb25zdGFudCBhcyBrZXkKICAgICAgICAgICAgT2JqZWN0IGtl\neSA9IGxvYWRlciA9PSBudWxsID8gTlVMTF9MT0FERVIgOiBsb2FkZXI7CiAg\nICAgICAgICAgIE1hcCBsb2FkZXJDYWNoZSA9IChNYXApIF9sb2FkZXJzLmdl\ndChrZXkpOwogICAgICAgICAgICBpZiAobG9hZGVyQ2FjaGUgPT0gbnVsbCkg\neyAvLyBXZSBkb24ndCBoYXZlIGEgY2FjaGUgZm9yIHRoaXMgbG9hZGVyLgog\nICAgICAgICAgICAgICAgbG9hZGVyQ2FjaGUgPSBuZXcgQ29uY3VycmVudEhh\nc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9sb2FkZXJzLnB1dChrZXksIGxv\nYWRlckNhY2hlKTsKICAgICAgICAgICAgfSBlbHNlIHsgIC8vIFdlIGhhdmUg\nYSBjYWNoZSBmb3IgdGhpcyBsb2FkZXIuCiAgICAgICAgICAgICAgICBjbHMg\nPSAoQ2xhc3MpIGxvYWRlckNhY2hlLmdldChjbHNOYW1lKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKGNscyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNscyA9IFN0cmlu\nZ3MudG9DbGFzcyhjbHNOYW1lLCBmaW5kRGVyaXZlZExvYWRlcihjb25mLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyKSk7CiAgICAgICAg\nICAgICAgICAgICAgbG9hZGVyQ2FjaGUucHV0KGNsc05hbWUsIGNscyk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRlciAhPSBudWxsKSAgLy8g\nVHJ5IG9uZSBtb3JlIHRpbWUgd2l0aCBsb2FkZXI9bnVsbAogICAgICAgICAg\nICAgICAgICAgICAgICBsb2FkZXIgPSBudWxsOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZSA9IGdldENy\nZWF0ZUV4Y2VwdGlvbihjbHNOYW1lLCB2YWwsIHJlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGZhdGFsKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyBs\nb2cgPSAoY29uZiA9PSBudWxsKSA/IG51bGwgOiBjb25mCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLmdldENvbmZpZ3VyYXRpb25Mb2coKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZyAhPSBudWxsICYmIGxv\nZy5pc0Vycm9yRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbG9nLmVycm9yKF9sb2MKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLmdldCgicGx1Z2luLWNyZWF0aW9uLWV4Y2VwdGlvbiIsIHZh\nbCksIHJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihj\nbHMpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24pIHsKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOyAgIAogICAgICAgICAgICB9\nCiAgICAgICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gcmUgPSBuZXcgTmVzdGFi\nbGVSdW50aW1lRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAo\nIm9iai1jcmVhdGUiLCBjbHMpLmdldE1lc3NhZ2UoKSwgZSk7CiAgICAgICAg\nICAgIGlmIChmYXRhbCkKICAgICAgICAgICAgICAgIHRocm93IHJlOwogICAg\nICAgICAgICBMb2cgbG9nID0gKGNvbmYgPT0gbnVsbCkgPyBudWxsIDogY29u\nZi5nZXRDb25maWd1cmF0aW9uTG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cg\nIT0gbnVsbCAmJiBsb2cuaXNFcnJvckVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy5lcnJvcihfbG9jLmdldCgicGx1Z2luLWNyZWF0aW9uLWV4Y2Vw\ndGlvbiIsIHZhbCksIHJlKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXR0ZW1wdCB0byBmaW5k\nIGEgZGVyaXZlZCBsb2FkZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gb3VyIHRhcmdl\ndCBsb2FkZXIuCiAgICAgKiBUaGlzIGFsbG93cyBhcHBsaWNhdGlvbiBsb2Fk\nZXJzIHRoYXQgZGVsZWdhdGUgYXBwcm9wcmlhdGVseSBmb3Iga25vd24KICAg\nICAqIGNsYXNzZXMgZmlyc3QgY3JhY2sgYXQgY2xhc3MgbmFtZXMuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNzTG9hZGVyIGZpbmREZXJpdmVk\nTG9hZGVyKENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBDbGFzc0xvYWRl\nciBsb2FkZXIpIHsKICAgICAgICAvLyB3ZSBhbHdheXMgcHJlZmVyIHRoZSB0\naHJlYWQgbG9hZGVyLCBiZWNhdXNlIGl0J3MgdGhlIG9ubHkgdGhpbmcgd2UK\nICAgICAgICAvLyBjYW4gYWNjZXNzIHRoYXQgaXNuJ3QgYm91bmQgdG8gdGhl\nIE9wZW5KUEEgY2xhc3Nsb2FkZXIsIHVubGVzcwogICAgICAgIC8vIHRoZSBj\nb25mIG9iamVjdCBpcyBvZiBhIGN1c3RvbSBjbGFzcwogICAgICAgIENsYXNz\nTG9hZGVyIGN0eExvYWRlciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xh\nc3NMb2FkZXJBY3Rpb24oKSk7CiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChjdHhMb2FkZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBjdHhMb2FkZXI7CiAgICAgICAgICAgIGlmIChj\nb25mICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY29uZi5nZXRDbGFz\ncygpKSk7IAogICAgICAgICAgICByZXR1cm4gQ29uZmlndXJhdGlvbnMuY2xh\nc3MuZ2V0Q2xhc3NMb2FkZXIoKTsKICAgICAgICB9CgogICAgICAgIGZvciAo\nQ2xhc3NMb2FkZXIgcGFyZW50ID0gY3R4TG9hZGVyOyBwYXJlbnQgIT0gbnVs\nbDsgCiAgICAgICAgICAgIHBhcmVudCA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nUGFyZW50QWN0aW9uKHBhcmVudCkpKSB7CiAgICAgICAgICAgIGlmIChwYXJl\nbnQgPT0gbG9hZGVyKQogICAgICAgICAgICAgICAgcmV0dXJuIGN0eExvYWRl\ncjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbmYgIT0gbnVsbCkgewogICAg\nICAgICAgICBmb3IgKENsYXNzTG9hZGVyIHBhcmVudCA9IChDbGFzc0xvYWRl\ncikKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGNvbmYuZ2V0Q2xhc3MoKSkpOyAKICAgICAgICAg\nICAgICAgIHBhcmVudCAhPSBudWxsOyAKICAgICAgICAgICAgICAgIHBhcmVu\ndCA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldFBhcmVudEFjdGlvbihwYXJl\nbnQpKSkgewogICAgICAgICAgICAgICAgaWYgKHBhcmVudCA9PSBsb2FkZXIp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihjb25mLmdldENsYXNzKCkp\nKTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxv\nYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIExpc3Q8U3Ry\naW5nPiBvZiBhbGwgdGhlIGZ1bGx5LXF1YWxpZmllZCBhbmNob3JzIHNwZWNp\nZmllZCBpbiB0aGUKICAgICAqIHByb3BlcnRpZXMgbG9jYXRpb24gbGlzdGVk\nIGluIDxjb2RlPm9wdHM8L2NvZGU+LiBJZiBubyBwcm9wZXJ0aWVzCiAgICAg\nKiBsb2NhdGlvbiBpcyBsaXN0ZWQgaW4gPGNvZGU+b3B0czwvY29kZT4sIHRo\naXMgcmV0dXJucyB3aGF0ZXZlciB0aGUKICAgICAqIHByb2R1Y3QgZGVyaXZh\ndGlvbnMgY2FuIGZpbmQgaW4gdGhlaXIgZGVmYXVsdCBjb25maWd1cmF0aW9u\ncy4KICAgICAqIElmIHRoZSBwcm9wZXJ0aWVzIGxvY2F0aW9uIHNwZWNpZmll\nZCBpbiA8Y29kZT5vcHRzPC9jb2RlPiBhbHJlYWR5CiAgICAgKiBjb250YWlu\ncyBhbiBhbmNob3Igc3BlYywgdGhpcyByZXR1cm5zIHRoYXQgYW5jaG9yLiBO\nb3RlIHRoYXQgaW4gdGhpcwogICAgICogZnVsbHktcXVhbGlmaWVkLWlucHV0\nIGNhc2UsIHRoZSBsb2dpYyBpbnZvbHZpbmcgcHJvZHVjdCBkZXJpdmF0aW9u\ncwogICAgICogYW5kIHJlc291cmNlIHBhcnNpbmcgaXMgc2hvcnQtY2lyY3Vp\ndGVkLCBzbyB0aGlzIG1ldGhvZAogICAgICogc2hvdWxkIG5vdCBiZSB1c2Vk\nIGFzIGEgbWVhbnMgdG8gdGVzdCB0aGF0IGEgcGFydGljdWxhciBhbmNob3Ig\naXMKICAgICAqIGRlZmluZWQgaW4gYSBnaXZlbiBsb2NhdGlvbiBieSBpbnZv\na2luZyB3aXRoIGEgZnVsbHktcXVhbGlmaWVkIGFuY2hvci4KICAgICAqCiAg\nICAgKiBUaGlzIGRvZXMgbm90IG11dGF0ZSA8Y29kZT5vcHRzPC9jb2RlPi4K\nICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBMaXN0PFN0cmluZz4gZ2V0RnVsbHlRdWFsaWZpZWRBbmNob3Jz\nSW5Qcm9wZXJ0aWVzTG9jYXRpb24oCiAgICAgICAgT3B0aW9ucyBvcHRzKSB7\nCiAgICAgICAgU3RyaW5nIHByb3BzID0gb3B0cy5nZXRQcm9wZXJ0eSgicHJv\ncGVydGllcyIsICJwIiwgbnVsbCk7CiAgICAgICAgaWYgKHByb3BzICE9IG51\nbGwpIHsKICAgICAgICAgICAgaW50IGFuY2hvclBvc2l0aW9uID0gcHJvcHMu\naW5kZXhPZigiIyIpOwogICAgICAgICAgICBpZiAoYW5jaG9yUG9zaXRpb24g\nPiAtMSkKICAgICAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KG5l\ndyBTdHJpbmdbXSB7IHByb3BzIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0\ndXJuIFByb2R1Y3REZXJpdmF0aW9ucy5nZXRGdWxseVF1YWxpZmllZEFuY2hv\ncnNJblByb3BlcnRpZXNMb2NhdGlvbigKICAgICAgICAgICAgcHJvcHMpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB7QGxpbmsgQ29u\nZmlndXJhdGlvbn0gaW5zdGFuY2UgZnJvbSB0aGUgY29tbWFuZCBsaW5lCiAg\nICAgKiBvcHRpb25zIHByb3ZpZGVkLiBBbGwgcHJvcGVydHkgbmFtZXMgb2Yg\ndGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gYXJlCiAgICAgKiByZWNvZ25pemVk\nOyBhZGRpdGlvbmFsbHksIGlmIGEgPGNvZGU+cHJvcGVydGllczwvY29kZT4g\nb3IKICAgICAqIDxjb2RlPnA8L2NvZGU+IGFyZ3VtZW50IGV4aXN0cywgdGhl\nIHJlc291cmNlIGl0CiAgICAgKiBwb2ludHMgdG8gd2lsbCBiZSBsb2FkZWQg\nYW5kIHNldCBpbnRvIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGluc3RhbmNl\nLgogICAgICogSXQgY2FuIHBvaW50IHRvIGVpdGhlciBhIGZpbGUgb3IgYSBy\nZXNvdXJjZSBuYW1lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQg\ncG9wdWxhdGVDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZiwgT3B0\naW9ucyBvcHRzKSB7CiAgICAgICAgU3RyaW5nIHByb3BzID0gb3B0cy5yZW1v\ndmVQcm9wZXJ0eSgicHJvcGVydGllcyIsICJwIiwgbnVsbCk7CiAgICAgICAg\nQ29uZmlndXJhdGlvblByb3ZpZGVyIHByb3ZpZGVyOwogICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShwcm9wcykpIHsKICAgICAgICAgICAgU3Ry\naW5nIHBhdGggPSBwcm9wczsKICAgICAgICAgICAgU3RyaW5nIGFuY2hvciA9\nIG51bGw7CiAgICAgICAgICAgIGludCBpZHggPSBwYXRoLmxhc3RJbmRleE9m\nKCcjJyk7CiAgICAgICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAg\nICAgICAgIGlmIChpZHggPCBwYXRoLmxlbmd0aCgpIC0gMSkKICAgICAgICAg\nICAgICAgICAgICBhbmNob3IgPSBwYXRoLnN1YnN0cmluZyhpZHggKyAxKTsK\nICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygwLCBpZHgp\nOwogICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoKCkgPT0gMCkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ1Jlc291cmNlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJhbmNob3Itb25seSIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIHByb3BzKS5nZXRNZXNzYWdlKCksIENvbmZpZ3VyYXRpb25z\nLmNsYXNzLmdldE5hbWUoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHBy\nb3BzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRmlsZSBmaWxlID0g\nbmV3IEZpbGUocGF0aCk7CiAgICAgICAgICAgIGlmICgoQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAg\nICAgIC5pc0ZpbGVBY3Rpb24oZmlsZSkpKS5ib29sZWFuVmFsdWUoKSkKICAg\nICAgICAgICAgICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxv\nYWQoZmlsZSwgYW5jaG9yLCBudWxsKTsKICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICBmaWxlID0gbmV3IEZpbGUoIk1FVEEtSU5GIiArIEZp\nbGUuc2VwYXJhdG9yQ2hhciArIHBhdGgpOwogICAgICAgICAgICAgICAgaWYg\nKChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncgogICAgICAgICAgICAgICAgICAgIC5pc0ZpbGVBY3Rpb24oZmlsZSkpKS5i\nb29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICBwcm92aWRlciA9\nIFByb2R1Y3REZXJpdmF0aW9ucy5sb2FkKGZpbGUsIGFuY2hvciwgbnVsbCk7\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcHJv\ndmlkZXIgPSBQcm9kdWN0RGVyaXZhdGlvbnMubG9hZChwYXRoLCBhbmNob3Is\nIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwcm92aWRl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgcHJvdmlkZXIuc2V0SW50byhj\nb25mKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1pc3NpbmdSZXNvdXJjZUV4Y2VwdGlvbihfbG9jLmdldCgibm8tcHJv\ndmlkZXIiLAogICAgICAgICAgICAgICAgICAgIHByb3BzKS5nZXRNZXNzYWdl\nKCksIENvbmZpZ3VyYXRpb25zLmNsYXNzLmdldE5hbWUoKSwgCiAgICAgICAg\nICAgICAgICAgICAgcHJvcHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxvYWREZWZhdWx0\ncyhudWxsKTsKICAgICAgICAgICAgaWYgKHByb3ZpZGVyICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBwcm92aWRlci5zZXRJbnRvKGNvbmYpOwogICAgICAg\nIH0KICAgICAgICBvcHRzLnNldEludG8oY29uZik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHRocm93IGFuIGluZm9ybWF0aXZl\nIGRlc2NyaXB0aW9uIG9uIGluc3RhbnRpYXRpb24gZXJyb3IuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIFJ1bnRpbWVFeGNlcHRpb24gZ2V0Q3JlYXRl\nRXhjZXB0aW9uKFN0cmluZyBjbHNOYW1lLAogICAgICAgIFZhbHVlIHZhbCwg\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAvLyByZS10aHJvdyB0aGUgZXhjZXB0\naW9uIHdpdGggc29tZSBiZXR0ZXIgaW5mb3JtYXRpb24KICAgICAgICBmaW5h\nbCBTdHJpbmcgbXNnOwogICAgICAgIGZpbmFsIE9iamVjdFtdIHBhcmFtczsK\nCiAgICAgICAgU3RyaW5nIGFsaWFzID0gdmFsLmFsaWFzKGNsc05hbWUpOwog\nICAgICAgIFN0cmluZ1tdIGFsaWFzZXMgPSB2YWwuZ2V0QWxpYXNlcygpOwog\nICAgICAgIFN0cmluZ1tdIGtleXM7CiAgICAgICAgaWYgKGFsaWFzZXMubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIGtleXMgPSBhbGlhc2VzOwogICAgICAg\nIGVsc2UgewogICAgICAgICAgICBrZXlzID0gbmV3IFN0cmluZ1thbGlhc2Vz\nLmxlbmd0aCAvIDJdOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFsaWFzZXMubGVuZ3RoOyBpICs9IDIpCiAgICAgICAgICAgICAgICBrZXlz\nW2kgLyAyXSA9IGFsaWFzZXNbaV07CiAgICAgICAgfQoKICAgICAgICBTdHJp\nbmcgY2xvc2VzdDsKICAgICAgICBpZiAoa2V5cy5sZW5ndGggPT0gMCkgewog\nICAgICAgICAgICBtc2cgPSAiaW52YWxpZC1wbHVnaW4iOwogICAgICAgICAg\nICBwYXJhbXMgPSBuZXcgT2JqZWN0W117IHZhbC5nZXRQcm9wZXJ0eSgpLCBh\nbGlhcywgZS50b1N0cmluZygpLCB9OwogICAgICAgIH0gZWxzZSBpZiAoKGNs\nb3Nlc3QgPSBTdHJpbmdEaXN0YW5jZS5nZXRDbG9zZXN0TGV2ZW5zaHRlaW5E\naXN0YW5jZQogICAgICAgICAgICAoYWxpYXMsIGtleXMsIDAuNWYpKSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIG1zZyA9ICJpbnZhbGlkLXBsdWdpbi1hbGlh\nc2VzIjsKICAgICAgICAgICAgcGFyYW1zID0gbmV3IE9iamVjdFtdewogICAg\nICAgICAgICAgICAgdmFsLmdldFByb3BlcnR5KCksIGFsaWFzLCBlLnRvU3Ry\naW5nKCksCiAgICAgICAgICAgICAgICBuZXcgVHJlZVNldDxTdHJpbmc+KEFy\ncmF5cy5hc0xpc3Qoa2V5cykpLCB9OwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIG1zZyA9ICJpbnZhbGlkLXBsdWdpbi1hbGlhc2VzLWhpbnQiOwog\nICAgICAgICAgICBwYXJhbXMgPSBuZXcgT2JqZWN0W117CiAgICAgICAgICAg\nICAgICB2YWwuZ2V0UHJvcGVydHkoKSwgYWxpYXMsIGUudG9TdHJpbmcoKSwK\nICAgICAgICAgICAgICAgIG5ldyBUcmVlU2V0PFN0cmluZz4oQXJyYXlzLmFz\nTGlzdChrZXlzKSksIGNsb3Nlc3QsIH07CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBuZXcgUGFyc2VFeGNlcHRpb24oX2xvYy5nZXQobXNnLCBwYXJhbXMp\nLCBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdp\ndmVuIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAg\nKiBtYXRjaGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVj\ndCdzIHNldHRlcgogICAgICogbWV0aG9kcy4gVGhlIHByb3BlcnRpZXMgc3Ry\naW5nIHNob3VsZCBiZSBpbiB0aGUgZm9ybQogICAgICogInByb3AxPXZhbDEs\nIHByb3AyPXZhbDIgLi4uIi4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0\nZXIKICAgICAqIG1ldGhvZHMgZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgog\nICAgICoKICAgICAqIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25m\naWd1cmF0aW9uIGVycm9yCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBjb25maWd1cmVJbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9u\nIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3BlcnRpZXMpIHsKICAgICAgICBj\nb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51bGwp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4g\nb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1h\ndGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mg\nc2V0dGVyCiAgICAgKiBtZXRob2RzLiBUaGUgcHJvcGVydGllcyBzdHJpbmcg\nc2hvdWxkIGJlIGluIHRoZSBmb3JtCiAgICAgKiAicHJvcDE9dmFsMSwgcHJv\ncDI9dmFsMiAuLi4iLiBWYWxpZGF0ZXMgdGhhdCBzZXR0ZXIgbWV0aG9kcwog\nICAgICogZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAq\nIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVy\ncm9yCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJ\nbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAg\nICAgU3RyaW5nIHByb3BlcnRpZXMsIFN0cmluZyBjb25maWd1cmF0aW9uTmFt\nZSkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBQcm9wZXJ0aWVzIHByb3BzID0gbnVsbDsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcGVydGllcykpCiAgICAg\nICAgICAgIHByb3BzID0gcGFyc2VQcm9wZXJ0aWVzKHByb3BlcnRpZXMpOwog\nICAgICAgIGNvbmZpZ3VyZUluc3RhbmNlKG9iaiwgY29uZiwgcHJvcHMsIGNv\nbmZpZ3VyYXRpb25OYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbmZp\nZ3VyZXMgdGhlIGdpdmVuIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0\naWVzIGJ5CiAgICAgKiBtYXRjaGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcg\ndG8gdGhlIG9iamVjdCdzIHNldHRlcgogICAgICogbWV0aG9kcy4gRG9lcyBu\nb3QgdmFsaWRhdGUgdGhhdCBzZXR0ZXIgbWV0aG9kcyBleGlzdCBmb3IgdGhl\nIHByb3BlcnRpZXMuCiAgICAgKgogICAgICogQHRocm93cyBSdW50aW1lRXhj\nZXB0aW9uIG9uIGNvbmZpZ3VyYXRpb24gZXJyb3IKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyB2b2lkIGNvbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmos\nIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBQcm9wZXJ0aWVzIHByb3Bl\ncnRpZXMpIHsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYs\nIHByb3BlcnRpZXMsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3Bl\ncnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmlu\nZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBtZXRob2RzLiBJZiA8\nY29kZT5jb25maWd1cmF0aW9uTmFtZTwvY29kZT4gaXMKICAgICAqIG5vbi08\nY29kZT5udWxsPC9jb2RlPiwgdmFsaWRhdGVzIHRoYXQgc2V0dGVyIG1ldGhv\nZHMgZXhpc3QgZm9yCiAgICAgKiB0aGUgcHJvcGVydGllcy4KICAgICAqCiAg\nICAgKiBAdGhyb3dzIFJ1bnRpbWVFeGNlcHRpb24gb24gY29uZmlndXJhdGlv\nbiBlcnJvcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY29uZmln\ndXJlSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29uZmlndXJhdGlvbiBjb25mLAog\nICAgICAgIFByb3BlcnRpZXMgcHJvcGVydGllcywgU3RyaW5nIGNvbmZpZ3Vy\nYXRpb25OYW1lKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIE9wdGlvbnMgb3B0czsKICAgICAgICBp\nZiAocHJvcGVydGllcyBpbnN0YW5jZW9mIE9wdGlvbnMpCiAgICAgICAgICAg\nIG9wdHMgPSAoT3B0aW9ucykgcHJvcGVydGllczsKICAgICAgICBlbHNlIHsg\nCiAgICAgICAgICAgIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgICAg\nICBpZiAocHJvcGVydGllcyAhPSBudWxsKQogICAgICAgICAgICAgICAgb3B0\ncy5wdXRBbGwocHJvcGVydGllcyk7CiAgICAgICAgfQoKICAgICAgICBDb25m\naWd1cmFibGUgY29uZmlndXJhYmxlID0gbnVsbDsKICAgICAgICBpZiAoY29u\nZiAhPSBudWxsICYmIG9iaiBpbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkKICAg\nICAgICAgICAgY29uZmlndXJhYmxlID0gKENvbmZpZ3VyYWJsZSkgb2JqOwoK\nICAgICAgICBpZiAoY29uZmlndXJhYmxlICE9IG51bGwpIHsKICAgICAgICAg\nICAgY29uZmlndXJhYmxlLnNldENvbmZpZ3VyYXRpb24oY29uZik7CiAgICAg\nICAgICAgIGNvbmZpZ3VyYWJsZS5zdGFydENvbmZpZ3VyYXRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgT3B0aW9ucyBpbnZhbGlkRW50cmllcyA9IG9wdHMu\nc2V0SW50byhvYmopOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBHZW5l\ncmljQ29uZmlndXJhYmxlKQogICAgICAgICAgICAoKEdlbmVyaWNDb25maWd1\ncmFibGUpIG9iaikuc2V0SW50byhpbnZhbGlkRW50cmllcyk7CgoJCWlmICgh\naW52YWxpZEVudHJpZXMuaXNFbXB0eSgpICYmIGNvbmZpZ3VyYXRpb25OYW1l\nICE9IG51bGwpIHsKCQkJTG9jYWxpemVyLk1lc3NhZ2UgbXNnID0gbnVsbDsK\nICAgICAgICAgICAgU3RyaW5nIGZpcnN0ID0gKFN0cmluZykgaW52YWxpZEVu\ndHJpZXMua2V5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCk7CgkJCWlmIChpbnZh\nbGlkRW50cmllcy5rZXlTZXQoKS5zaXplKCkgPT0gMSAmJgoJCQkJZmlyc3Qu\naW5kZXhPZignLicpID09IC0xKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0\naGVyZSdzIGp1c3Qgb25lIG1pc3NwZWxsaW5nIGFuZCB0aGlzIGlzIG5vdCBh\nCgkJCQkvLyBwYXRoIHRyYXZlcnNhbCwgY2hlY2sgZm9yIG5lYXIgbWlzc2Vz\nLgogICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IG9wdGlvbnMg\nPSBmaW5kT3B0aW9uc0ZvcihvYmouZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgY2xvc2UgPSBTdHJpbmdEaXN0YW5jZS5nZXRDbG9zZXN0\nTGV2ZW5zaHRlaW5EaXN0YW5jZQoJCQkJCShmaXJzdCwgb3B0aW9ucywgMC43\nNWYpOwoJCQkJaWYgKGNsb3NlICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgbXNnID0gX2xvYy5nZXQoImludmFsaWQtY29uZmlnLXBhcmFtLWhpbnQi\nLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nb25maWd1cmF0aW9uTmFtZSwgb2JqLmdldENsYXNzKCksIGZpcnN0LCBjbG9z\nZSwKCQkJCQkJICAgIG9wdGlvbnMsIH0pOwoJCQl9CgogICAgICAgICAgICBp\nZiAobXNnID09IG51bGwpIHsKICAgICAgICAgICAgICAgIG1zZyA9IF9sb2Mu\nZ2V0KCJpbnZhbGlkLWNvbmZpZy1wYXJhbXMiLCBuZXcgU3RyaW5nW117CiAg\nICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbk5hbWUsIG9iai5nZXRD\nbGFzcygpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBpbnZhbGlk\nRW50cmllcy5rZXlTZXQoKS50b1N0cmluZygpLAogICAgICAgICAgICAgICAg\nICAgIGZpbmRPcHRpb25zRm9yKG9iai5nZXRDbGFzcygpKS50b1N0cmluZygp\nLCB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgUGFy\nc2VFeGNlcHRpb24obXNnKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbmZp\nZ3VyYWJsZSAhPSBudWxsKQogICAgICAgICAgICBjb25maWd1cmFibGUuZW5k\nQ29uZmlndXJhdGlvbigpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIENv\nbGxlY3Rpb248U3RyaW5nPiBmaW5kT3B0aW9uc0ZvcihDbGFzczw/PiBjbHMp\nIHsKICAgICAgICBDb2xsZWN0aW9uPFN0cmluZz4gYyA9IE9wdGlvbnMuZmlu\nZE9wdGlvbnNGb3IoY2xzKTsKICAgICAgICAKICAgICAgICAvLyByZW1vdmUg\nQ29uZmlndXJhYmxlLnNldENvbmZpZ3VyYXRpb24oKSBhbmQgCiAgICAgICAg\nLy8gR2VuZXJpY0NvbmZpZ3VyYWJsZS5zZXRJbnRvKCkgZnJvbSB0aGUgc2V0\nLCBpZiBhcHBsaWNhYmxlLgogICAgICAgIGlmIChDb25maWd1cmFibGUuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAgICBjLnJlbW92\nZSgiQ29uZmlndXJhdGlvbiIpOwogICAgICAgIGlmIChHZW5lcmljQ29uZmln\ndXJhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAg\nICAgYy5yZW1vdmUoIkludG8iKTsKICAgICAgICAKICAgICAgICByZXR1cm4g\nYzsKICAgIH0KCiAgICAvKioKICAgICAqIFR1cm4gYSBzZXQgb2YgcHJvcGVy\ndGllcyBpbnRvIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZy4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBTdHJpbmcgc2VyaWFsaXplUHJvcGVydGllcyhN\nYXAgbWFwKSB7CiAgICAgICAgaWYgKG1hcCA9PSBudWxsIHx8IG1hcC5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJp\nbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAg\nTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIFN0cmluZyB2YWw7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAu\nRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChidWYubGVuZ3Ro\nKCkgPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZChlbnRyeS5nZXRLZXkoKSkuYXBwZW5kKCc9\nJyk7CiAgICAgICAgICAgIHZhbCA9IFN0cmluZy52YWx1ZU9mKGVudHJ5Lmdl\ndFZhbHVlKCkpOwogICAgICAgICAgICBpZiAodmFsLmluZGV4T2YoJywnKSAh\nPSAtMSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoJyInKS5hcHBlbmQo\ndmFsKS5hcHBlbmQoJyInKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZCh2YWwpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBhIHNldCBvZiBwcm9wZXJ0aWVzIGZyb20gYSBjb21tYS1zZXBhcmF0ZWQg\nc3RyaW5nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9wdGlvbnMgcGFy\nc2VQcm9wZXJ0aWVzKFN0cmluZyBwcm9wZXJ0aWVzKSB7CiAgICAgICAgT3B0\naW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBwcm9wZXJ0aWVz\nID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChwcm9wZXJ0aWVzKTsKICAgICAg\nICBpZiAocHJvcGVydGllcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nb3B0czsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5nW10gcHJv\ncHMgPSBTdHJpbmdzLnNwbGl0KHByb3BlcnRpZXMsICIsIiwgMCk7CiAgICAg\nICAgICAgIGludCBpZHg7CiAgICAgICAgICAgIGNoYXIgcXVvdGU7CiAgICAg\nICAgICAgIFN0cmluZyBwcm9wOwogICAgICAgICAgICBTdHJpbmcgdmFsOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZHggPSBwcm9wc1tpXS5pbmRleE9m\nKCc9Jyk7CiAgICAgICAgICAgICAgICBpZiAoaWR4ID09IC0xKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gaWYgdGhlIGtleSBpcyBub3QgYXNzaWduZWQg\ndG8gYW55IHZhbHVlLCBzZXQgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8g\ndmFsdWUgdG8gdGhlIHNhbWUgdGhpbmcgYXMgdGhlIGtleSwgYW5kIGNvbnRp\nbnVlLgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgcGVybWl0cyBHZW5l\ncmljQ29uZmlndXJhYmxlIGluc3RhbmNlcyB0bwogICAgICAgICAgICAgICAg\nICAgIC8vIGJlaGF2ZSBtZWFuaW5nZnVsbHkuIFdlIG1pZ2h0IGNvbnNpZGVy\nIHNldHRpbmcgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gdmFsdWUgdG8g\nc29tZSB3ZWxsLWtub3duICJ2YWx1ZSB3YXMgbm90IHNldCwgYnV0CiAgICAg\nICAgICAgICAgICAgICAgLy8ga2V5IGlzIHByZXNlbnQiIHN0cmluZyBzbyB0\naGF0IGluc3RhbmNlcyBnZXR0aW5nCiAgICAgICAgICAgICAgICAgICAgLy8g\ndmFsdWVzIGluamVjdGVkIGNhbiBkaWZmZXJlbnRpYXRlIGJldHdlZW4gYSBt\nZW50aW9uZWQKICAgICAgICAgICAgICAgICAgICAvLyBwcm9wZXJ0eSBhbmQg\nb25lIHNldCB0byBhIHBhcnRpY3VsYXIgdmFsdWUuCiAgICAgICAgICAgICAg\nICAgICAgcHJvcCA9IHByb3BzW2ldOwogICAgICAgICAgICAgICAgICAgIHZh\nbCA9IHByb3A7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHByb3AgPSBwcm9wc1tpXS5zdWJzdHJpbmcoMCwgaWR4KS50\ncmltKCk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gcHJvcHNbaV0uc3Vi\nc3RyaW5nKGlkeCArIDEpLnRyaW0oKTsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICAvLyBpZiB0aGUgdmFsdWUgaXMgcXVvdGVkLCByZWFk\nIHVudGlsIHRoZSBlbmQgcXVvdGUKICAgICAgICAgICAgICAgIGlmICgoKHZh\nbC5zdGFydHNXaXRoKCJcIiIpICYmIHZhbC5lbmRzV2l0aCgiXCIiKSkKICAg\nICAgICAgICAgICAgICAgICB8fCAodmFsLnN0YXJ0c1dpdGgoIiciKSAmJiB2\nYWwuZW5kc1dpdGgoIiciKSkpCiAgICAgICAgICAgICAgICAgICAgJiYgdmFs\nLmxlbmd0aCgpID4gMSkKICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwu\nc3Vic3RyaW5nKDEsIHZhbC5sZW5ndGgoKSAtIDEpOwogICAgICAgICAgICAg\nICAgZWxzZSBpZiAodmFsLnN0YXJ0c1dpdGgoIlwiIikgfHwgdmFsLnN0YXJ0\nc1dpdGgoIiciKSkgewogICAgICAgICAgICAgICAgICAgIHF1b3RlID0gdmFs\nLmNoYXJBdCgwKTsKICAgICAgICAgICAgICAgICAgICBTdHJpbmdCdWlsZGVy\nIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKHZhbC5zdWJzdHJpbmcoMSkpOwog\nICAgICAgICAgICAgICAgICAgIGludCBxdW90SWR4OwogICAgICAgICAgICAg\nICAgICAgIHdoaWxlICgrK2kgPCBwcm9wcy5sZW5ndGgpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCIpOwoKICAgICAgICAgICAg\nICAgICAgICAgICAgcXVvdElkeCA9IHByb3BzW2ldLmluZGV4T2YocXVvdGUp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVvdElkeCAhPSAtMSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChwcm9w\nc1tpXS5zdWJzdHJpbmcoMCwgcXVvdElkeCkpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHF1b3RJZHggKyAxIDwgcHJvcHNbaV0ubGVuZ3Ro\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZChwcm9wc1tpXS5zdWJzdHJpbmcocXVvdElkeCArIDEpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQocHJvcHNbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB2YWwgPSBidWYudG9TdHJpbmcoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIG9wdHMucHV0KHByb3AsIHZhbCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9wdHM7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgUGFyc2VFeGNlcHRpb24oX2xvYy5nZXQoInByb3AtcGFy\nc2UiLCBwcm9wZXJ0aWVzKSwgcmUpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIExvb2tzIHVwIHRoZSBnaXZlbiBuYW1lIGluIEpOREkuIElm\nIHRoZSBuYW1lIGlzIG51bGwsIG51bGwgaXMgcmV0dXJuZWQuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGxvb2t1cChTdHJpbmcgbmFtZSwg\nU3RyaW5nIHVzZXJLZXksIExvZyBsb2cpIHsKICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENvbnRleHQgY3R4ID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBjdHggPSBuZXcgSW5pdGlhbENvbnRleHQoKTsKICAgICAg\nICAgICAgT2JqZWN0IHJlc3VsdCA9IGN0eC5sb29rdXAobmFtZSk7CiAgICAg\nICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCAmJiBsb2cgIT0gbnVsbCAmJiBs\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAJbG9nLndhcm4oX2xv\nYy5nZXQoImpuZGktbG9va3VwLWZhaWxlZCIsIHVzZXJLZXksIG5hbWUpKTsK\nICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9IGNhdGNoIChO\nYW1pbmdFeGNlcHRpb24gbmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5l\nc3RhYmxlUnVudGltZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgIF9sb2Mu\nZ2V0KCJuYW1pbmctZXJyIiwgbmFtZSkuZ2V0TWVzc2FnZSgpLCBuZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGN0eCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsgY3R4LmNsb3NlKCk7IH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7fQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3Qgd2hldGhlciB0aGUgbWFwIGNvbnRhaW5zIHRoZSBnaXZlbiBw\nYXJ0aWFsIGtleSwgcHJlZml4ZWQgd2l0aCBhbnkKICAgICAqIHBvc3NpYmxl\nIGNvbmZpZ3VyYXRpb24gcHJlZml4LgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGJvb2xlYW4gY29udGFpbnNQcm9wZXJ0eShWYWx1ZSB2YWx1ZSwgTWFw\nIHByb3BzKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgcHJvcHMg\nPT0gbnVsbCB8fCBwcm9wcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBMaXN0PFN0cmluZz4gcGFydGlhbEtleXMgPSB2\nYWx1ZS5nZXRQcm9wZXJ0eUtleXMoKTsKICAgICAgICBmb3IgKFN0cmluZyBw\nYXJ0aWFsS2V5IDogcGFydGlhbEtleXMpIHsKICAgICAgICAgICAgaWYgKHBy\nb3BzLmNvbnRhaW5zS2V5KAogICAgICAgICAgICAgICAgUHJvZHVjdERlcml2\nYXRpb25zLmdldENvbmZpZ3VyYXRpb25LZXkocGFydGlhbEtleSwgcHJvcHMp\nKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nVGVzdCB3aGV0aGVyIHRoZSBtYXAgY29udGFpbnMgdGhlIGdpdmVuIHBhcnRp\nYWwga2V5LCBwcmVmaXhlZCB3aXRoIGFueQogICAgICogcG9zc2libGUgY29u\nZmlndXJhdGlvbiBwcmVmaXguCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nYm9vbGVhbiBjb250YWluc1Byb3BlcnR5KFN0cmluZyBwYXJ0aWFsS2V5LCBN\nYXAgcHJvcHMpIHsKICAgICAgICBpZiAocGFydGlhbEtleSA9PSBudWxsIHx8\nIHByb3BzID09IG51bGwgfHwgcHJvcHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1\ncm4gcHJvcHMuY29udGFpbnNLZXkoCiAgICAgICAgICAgICAgICBQcm9kdWN0\nRGVyaXZhdGlvbnMuZ2V0Q29uZmlndXJhdGlvbktleShwYXJ0aWFsS2V5LCBw\ncm9wcykpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBwcm9wZXJ0\neSB1bmRlciB0aGUgZ2l2ZW4gcGFydGlhbCBrZXksIHByZWZpeGVkIHdpdGgg\nYW55IHBvc3NpYmxlCiAgICAgKiBjb25maWd1cmF0aW9uIHByZWZpeC4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZ2V0UHJvcGVydHkoU3Ry\naW5nIHBhcnRpYWxLZXksIE1hcCBtKSB7CiAgICAgICAgaWYgKHBhcnRpYWxL\nZXkgPT0gbnVsbCB8fCBtID09IG51bGwgfHwgbS5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGVsc2UgCiAgICAgICAgICAg\nIHJldHVybiBtLmdldChQcm9kdWN0RGVyaXZhdGlvbnMuZ2V0Q29uZmlndXJh\ndGlvbktleShwYXJ0aWFsS2V5LCBtKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgdGhlIHByb3BlcnR5IHVuZGVyIHRoZSBnaXZlbiBwYXJ0aWFs\nIGtleSwgcHJlZml4ZWQgd2l0aCBhbnkKICAgICAqIHBvc3NpYmxlIGNvbmZp\nZ3VyYXRpb24gcHJlZml4LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9i\namVjdCByZW1vdmVQcm9wZXJ0eShTdHJpbmcgcGFydGlhbEtleSwgTWFwIHBy\nb3BzKSB7CiAgICAgICAgaWYgKHBhcnRpYWxLZXkgPT0gbnVsbCB8fCBwcm9w\ncyA9PSBudWxsIHx8IHByb3BzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAJaWYgKGNvbnRhaW5zUHJvcGVydHkocGFydGlhbEtleSwg\ncHJvcHMpKQoJICAgIHJldHVybiBwcm9wcy5yZW1vdmUoUHJvZHVjdERlcml2\nYXRpb25zLmdldENvbmZpZ3VyYXRpb25LZXkocGFydGlhbEtleSwgcHJvcHMp\nKTsKCWVsc2UgCgkgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSdW5zIDxjb2RlPnJ1bm5hYmxlPC9jb2RlPiBhZ2FpbnN0IGFsbCB0\naGUgYW5jaG9ycyBpbiB0aGUgY29uZmlndXJhdGlvbgogICAgICogcG9pbnRl\nZCB0byBieSA8Y29kZT5vcHRzPC9jb2RlPi4gRWFjaCBpbnZvY2F0aW9uIGdl\ndHMgYSBmcmVzaCBjbG9uZSBvZiAKICAgICAqIDxjb2RlPm9wdHM8L2NvZGU+\nIHdpdGggdGhlIDxjb2RlPnByb3BlcnRpZXM8L2NvZGU+IG9wdGlvbiBzZXQK\nICAgICAqIGFwcHJvcHJpYXRlbHkuCiAgICAgKgogICAgICogQHNpbmNlIDEu\nMS4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW5BZ2Fp\nbnN0QWxsQW5jaG9ycyhPcHRpb25zIG9wdHMsCiAgICAgICAgQ29uZmlndXJh\ndGlvbnMuUnVubmFibGUgcnVubmFibGUpIHsKICAgICAgICBpZiAob3B0cy5j\nb250YWluc0tleSgiaGVscCIpIHx8IG9wdHMuY29udGFpbnNLZXkoIi1oZWxw\nIikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAg\nICAgICBMaXN0PFN0cmluZz4gYW5jaG9ycyA9CiAgICAgICAgICAgIENvbmZp\nZ3VyYXRpb25zLmdldEZ1bGx5UXVhbGlmaWVkQW5jaG9yc0luUHJvcGVydGll\nc0xvY2F0aW9uKG9wdHMpOwoKICAgICAgICAvLyBXZSB1c2UgJ3Byb3BlcnRp\nZXMnIGJlbG93OyBnZXQgcmlkIG9mICdwJyB0byBhdm9pZCBjb25mbGljdHMu\nIFRoaXMKICAgICAgICAvLyByZWxpZXMgb24ga25vd2luZyB3aGF0IGdldEZ1\nbGx5UXVhbGlmaWVkQW5jaG9yc0luUHJvcGVydGllc0xvY2F0aW9uCiAgICAg\nICAgLy8gbG9va3MgZm9yLgogICAgICAgIGlmIChvcHRzLmNvbnRhaW5zS2V5\nKCJwIikpCiAgICAgICAgICAgIG9wdHMucmVtb3ZlKCJwIik7CgogICAgICAg\nIGJvb2xlYW4gcmV0ID0gdHJ1ZTsKICAgICAgICBpZiAoYW5jaG9ycy5zaXpl\nKCkgPT0gMCkgewogICAgICAgICAgICByZXQgPSBsYXVuY2hSdW5uYWJsZShv\ncHRzLCBydW5uYWJsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nZm9yKFN0cmluZyBzIDogYW5jaG9ycyApIHsgCiAgICAgICAgICAgICAgICBP\ncHRpb25zIGNsb25lZE9wdGlvbnMgPSAoT3B0aW9ucykgb3B0cy5jbG9uZSgp\nOwogICAgICAgICAgICAgICAgY2xvbmVkT3B0aW9ucy5zZXRQcm9wZXJ0eSgi\ncHJvcGVydGllcyIsIHMpOwogICAgICAgICAgICAgICAgcmV0ICY9IGxhdW5j\naFJ1bm5hYmxlKGNsb25lZE9wdGlvbnMsIHJ1bm5hYmxlKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gbGF1bmNoUnVubmFibGUoT3B0aW9u\ncyBvcHRzLAogICAgICAgIENvbmZpZ3VyYXRpb25zLlJ1bm5hYmxlIHJ1bm5h\nYmxlKSB7CiAgICAgICAgYm9vbGVhbiByZXQgPSB0cnVlOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldCA9IHJ1bm5hYmxlLnJ1bihvcHRzKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAo\nIShlIGluc3RhbmNlb2YgUnVudGltZUV4Y2VwdGlvbikpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbihlKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgKFJ1bnRpbWVFeGNlcHRp\nb24pIGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICB9Cgog\nICAgcHVibGljIGludGVyZmFjZSBSdW5uYWJsZSB7CiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gcnVuKE9wdGlvbnMgb3B0cykgdGhyb3dzIEV4Y2VwdGlvbjsK\nICAgIH0KfQo=\n","encoding":"base64"}

