{"sha":"642fd1a2593cb052bc4cb66a6919b1ccc207b8cc","node_id":"MDQ6QmxvYjIwNjM2NDo2NDJmZDFhMjU5M2NiMDUyYmM0Y2I2NmE2OTE5YjFjY2MyMDdiOGNj","size":21821,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/642fd1a2593cb052bc4cb66a6919b1ccc207b8cc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGE7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uRmlsZTsK\naW1wb3J0IGphdmEuaW8uRmlsZUlucHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5GaWxlTm90Rm91bmRFeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLkZpbGVS\nZWFkZXI7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW1S\nZWFkZXI7CmltcG9ydCBqYXZhLmlvLlJlYWRlcjsKaW1wb3J0IGphdmEuc2Vj\ndXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0YWJsZVJ1bnRpbWVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJE\nb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgc2VycC5ieXRlY29kZS5sb3dsZXZlbC5D\nb25zdGFudFBvb2xUYWJsZTsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoK\nLyoqCiAqIFBhcnNlciB1c2VkIHRvIHJlc29sdmUgYXJndW1lbnRzIGludG8g\namF2YSBjbGFzc2VzLgogKiBJbnRlcnByZXRzIGNvbW1hbmQtbGluZSBhcmdz\nIGFzIGVpdGhlciBjbGFzcyBuYW1lcywgLmNsYXNzIGZpbGVzIG9yCiAqIHJl\nc291cmNlcywgLmphdmEgZmlsZXMgb3IgcmVzb3VyY2VzLCBvciBtZXRhZGF0\nYSBmaWxlcyBvciByZXNvdXJjZXMKICogY29uZm9ybWluZyB0byB0aGUgY29t\nbW9uIGZvcm1hdCBkZWZpbmVkIGJ5IHtAbGluayBDRk1ldGFEYXRhUGFyc2Vy\nfS4KICogVHJhbnNmb3JtcyB0aGUgaW5mb3JtYXRpb24gaW4gdGhlc2UgYXJn\ncyBpbnRvIHtAbGluayBDbGFzc30gaW5zdGFuY2VzLgogKiBOb3RlIHRoYXQg\nd2hlbiBwYXJzaW5nIC5qYXZhIGZpbGVzLCBvbmx5IHRoZSBtYWluIGNsYXNz\nIGluIHRoZSBmaWxlCiAqIGlzIGRldGVjdGVkLiBPdGhlciBjbGFzc2VzIGRl\nZmluZWQgaW4gdGhlIGZpbGUsIHN1Y2ggYXMgaW5uZXIgY2xhc3NlcywKICog\nYXJlIG5vdCBhZGRlZCB0byB0aGUgcmV0dXJuZWQgY2xhc3NlcyBsaXN0Lgog\nKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgQ2xhc3NBcmdQYXJzZXIgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBUT0tFTl9FT0YgPSAtMTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBUT0tFTl9OT05FID0gMDsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBUT0tFTl9QQUNLQUdFID0gMTsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBUT0tFTl9DTEFTUyA9IDI7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgVE9LRU5fUEFDS0FHRV9OT0FUVFIgPSAzOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFRPS0VOX0NMQVNTX05PQVRUUiA9\nIDQ7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2Mg\nPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChDbGFzc0FyZ1BhcnNl\nci5jbGFzcyk7CgogICAgcHJpdmF0ZSBDbGFzc0xvYWRlciBfbG9hZGVyID0g\nbnVsbDsKICAgIHByaXZhdGUgY2hhcltdIF9wYWNrYWdlQXR0ciA9ICJuYW1l\nIi50b0NoYXJBcnJheSgpOwogICAgcHJpdmF0ZSBjaGFyW10gX2NsYXNzQXR0\nciA9ICJuYW1lIi50b0NoYXJBcnJheSgpOwogICAgcHJpdmF0ZSBjaGFyW11b\nXSBfYmVnaW5FbGVtZW50cyA9IHsgeyAncCcgfSwgeyAnYycgfSB9OwogICAg\ncHJpdmF0ZSBjaGFyW11bXSBfZW5kRWxlbWVudHMgPSB7ICJhY2thZ2UiLnRv\nQ2hhckFycmF5KCksCiAgICAgICAgImxhc3MiLnRvQ2hhckFycmF5KCkgfTsK\nCiAgICAvKioKICAgICAqIFRoZSBjbGFzcyBsb2FkZXIgd2l0aCB3aGljaCB0\nbyBsb2FkIHBhcnNlZCBjbGFzc2VzLgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NMb2FkZXIgZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9s\nb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgbG9hZGVy\nIHdpdGggd2hpY2ggdG8gbG9hZCBwYXJzZWQgY2xhc3Nlcy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgX2xvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgdGhlIHJlbGV2YW50IG1ldGFkYXRhIGZpbGUg\nc3RydWN0dXJlIHNvIHRoYXQgbWV0YWRhdGEgZmlsZXMKICAgICAqIGNvbnRh\naW5pbmcgY2xhc3MgbmFtZXMgY2FuIGJlIHBhcnNlZC4gTnVsbCBhdHRyaWJ1\ndGUgbmFtZXMgaW5kaWNhdGUKICAgICAqIHRoYXQgdGhlIHRleHQgY29udGVu\ndCBvZiB0aGUgZWxlbWVudCBjb250YWlucyB0aGUgZGF0YS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TWV0YURhdGFTdHJ1Y3R1cmUoU3RyaW5nIHBh\nY2thZ2VFbGVtZW50TmFtZSwKICAgICAgICBTdHJpbmcgcGFja2FnZUF0dHJp\nYnV0ZU5hbWUsIFN0cmluZ1tdIGNsYXNzRWxlbWVudE5hbWVzLAogICAgICAg\nIFN0cmluZyBjbGFzc0F0dHJpYnV0ZU5hbWUpIHsKICAgICAgICAvLyBjYWxj\ndWxhdGUgaG93IG1hbnkgY2hhcnMgZGVlcCB3ZSBoYXZlIHRvIGdvIHRvIGlk\nZW50aWZ5IGVhY2ggZWxlbWVudAogICAgICAgIC8vIG5hbWUgYXMgdW5pcXVl\nLiAgdGhpcyBpcyBleHRyZW1lbHkgaW5lZmZpY2llbnQgZm9yIGxhcmdlIE4s\nIGJ1dAogICAgICAgIC8vIHNob3VsZCBuZXZlciBiZSBjYWxsZWQgZm9yIG1v\ncmUgdGhhbiBhIGZldyBlbGVtZW50cwogICAgICAgIGNoYXJbXSBidWYgPSBu\nZXcgY2hhcltjbGFzc0VsZW1lbnROYW1lcy5sZW5ndGggKyAxXTsKICAgICAg\nICBpbnQgY2hhcklkeCA9IDA7CiAgICAgICAgZm9yICg7IHRydWU7IGNoYXJJ\nZHgrKykgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJ1Zi5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGkgPT0gMCkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChjaGFySWR4ID09IHBhY2thZ2VFbGVt\nZW50TmFtZS5sZW5ndGgoKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoImNhbnQtZGlmZi1lbGVt\ncyIpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICAgICAgYnVmW2ld\nID0gcGFja2FnZUVsZW1lbnROYW1lLmNoYXJBdChjaGFySWR4KTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNo\nYXJJZHggPT0gY2xhc3NFbGVtZW50TmFtZXNbaSAtIDFdLmxlbmd0aCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRP\ncGVyYXRpb25FeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICgiY2FudC1kaWZmLWVsZW1zIikuZ2V0TWVzc2FnZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBidWZbaV0gPSBjbGFzc0VsZW1lbnROYW1l\nc1tpIC0gMV0uY2hhckF0KGNoYXJJZHgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaGFyc1VuaXF1ZShidWYp\nKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBf\ncGFja2FnZUF0dHIgPSAocGFja2FnZUF0dHJpYnV0ZU5hbWUgPT0gbnVsbCkg\nPyBudWxsCiAgICAgICAgICAgIDogcGFja2FnZUF0dHJpYnV0ZU5hbWUudG9D\naGFyQXJyYXkoKTsKICAgICAgICBfY2xhc3NBdHRyID0gKGNsYXNzQXR0cmli\ndXRlTmFtZSA9PSBudWxsKSA/IG51bGwKICAgICAgICAgICAgOiBjbGFzc0F0\ndHJpYnV0ZU5hbWUudG9DaGFyQXJyYXkoKTsKICAgICAgICBfYmVnaW5FbGVt\nZW50cyA9IG5ldyBjaGFyW2NsYXNzRWxlbWVudE5hbWVzLmxlbmd0aCArIDFd\nW107CiAgICAgICAgX2VuZEVsZW1lbnRzID0gbmV3IGNoYXJbY2xhc3NFbGVt\nZW50TmFtZXMubGVuZ3RoICsgMV1bXTsKICAgICAgICBfYmVnaW5FbGVtZW50\nc1swXSA9IHBhY2thZ2VFbGVtZW50TmFtZS5zdWJzdHJpbmcoMCwgY2hhcklk\neCArIDEpLgogICAgICAgICAgICB0b0NoYXJBcnJheSgpOwogICAgICAgIF9l\nbmRFbGVtZW50c1swXSA9IHBhY2thZ2VFbGVtZW50TmFtZS5zdWJzdHJpbmco\nY2hhcklkeCArIDEpLgogICAgICAgICAgICB0b0NoYXJBcnJheSgpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2xhc3NFbGVtZW50TmFtZXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgX2JlZ2luRWxlbWVudHNbaSArIDFd\nID0gY2xhc3NFbGVtZW50TmFtZXNbaV0uCiAgICAgICAgICAgICAgICBzdWJz\ndHJpbmcoMCwgY2hhcklkeCArIDEpLnRvQ2hhckFycmF5KCk7CiAgICAgICAg\nICAgIF9lbmRFbGVtZW50c1tpICsgMV0gPSBjbGFzc0VsZW1lbnROYW1lc1tp\nXS4KICAgICAgICAgICAgICAgIHN1YnN0cmluZyhjaGFySWR4ICsgMSkudG9D\naGFyQXJyYXkoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiBhbGwgY2hhcmFjdGVycyBpbiBnaXZlbiBidWZmZXIg\nYXJlIHVuaXF1ZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVh\nbiBjaGFyc1VuaXF1ZShjaGFyW10gYnVmKSB7CiAgICAgICAgZm9yIChpbnQg\naSA9IGJ1Zi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICAgICAg\nZm9yIChpbnQgaiA9IDA7IGogPCBpOyBqKyspCiAgICAgICAgICAgICAgICBp\nZiAoYnVmW2pdID09IGJ1ZltpXSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHtAbGluayBDbGFzc30gcmVwcmVzZW50YXRp\nb24gb2YgdGhlIGNsYXNzKGVzKSBuYW1lZCBpbiB0aGUKICAgICAqIGdpdmVu\nIGFyZy4KICAgICAqCiAgICAgKiBAcGFyYW0gYXJnIGEgY2xhc3MgbmFtZSwg\nLmphdmEgZmlsZSwgLmNsYXNzIGZpbGUsIG9yIG1ldGFkYXRhCiAgICAgKiBm\naWxlIG5hbWluZyB0aGUgdHlwZShzKSB0byBhY3Qgb24KICAgICAqLwogICAg\ncHVibGljIENsYXNzPD8+W10gcGFyc2VUeXBlcyhTdHJpbmcgYXJnKSB7CiAg\nICAgICAgU3RyaW5nW10gbmFtZXMgPSBwYXJzZVR5cGVOYW1lcyhhcmcpOwog\nICAgICAgIENsYXNzPD8+W10gb2JqcyA9IG5ldyBDbGFzc1tuYW1lcy5sZW5n\ndGhdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbmFtZXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIG9ianNbaV0gPSBTdHJpbmdzLnRvQ2xhc3Mo\nbmFtZXNbaV0sIF9sb2FkZXIpOwogICAgICAgIHJldHVybiBvYmpzOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB7QGxpbmsgQ2xhc3N9IHJl\ncHJlc2VudGF0aW9uIG9mIHRoZSBjbGFzcyhlcykgbmFtZWQgaW4gdGhlCiAg\nICAgKiBnaXZlbiBtZXRhZGF0YXMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nczw/PltdIHBhcnNlVHlwZXMoTWV0YURhdGFJdGVyYXRvciBpdHIpIHsKICAg\nICAgICBTdHJpbmdbXSBuYW1lcyA9IHBhcnNlVHlwZU5hbWVzKGl0cik7CiAg\nICAgICAgQ2xhc3M8Pz5bXSBvYmpzID0gbmV3IENsYXNzW25hbWVzLmxlbmd0\naF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBuYW1lcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgb2Jqc1tpXSA9IFN0cmluZ3MudG9DbGFzcyhu\nYW1lc1tpXSwgX2xvYWRlcik7CiAgICAgICAgcmV0dXJuIG9ianM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBtYXBwaW5nIG9mIGVhY2ggbWV0\nYWRhdGEgcmVzb3VyY2UgdG8gYW4gYXJyYXkgb2YgaXRzCiAgICAgKiBjb250\nYWluZWQgY2xhc3Nlcy4KICAgICAqLwogICAgcHVibGljIE1hcDxPYmplY3Qs\nIENsYXNzPD8+W10+IG1hcFR5cGVzKE1ldGFEYXRhSXRlcmF0b3IgaXRyKSB7\nCiAgICAgICAgTWFwPE9iamVjdCwgU3RyaW5nW10+IG1hcCA9IG1hcFR5cGVO\nYW1lcyhpdHIpOwogICAgICAgIE1hcDxPYmplY3QsIENsYXNzPD8+W10+IHJ2\nYWwgPSBuZXcgSGFzaE1hcDxPYmplY3QsIENsYXNzPD8+W10+KCk7CiAgICAg\nICAgTWFwLkVudHJ5PE9iamVjdCwgU3RyaW5nW10+IGVudHJ5OwogICAgICAg\nIFN0cmluZ1tdIG5hbWVzOwogICAgICAgIENsYXNzPD8+W10gb2JqczsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yPE1hcC5FbnRyeTxPYmplY3QsIFN0cmluZ1td\nPj4gaSA9CiAgICAgICAgICAgIG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7\nIGkuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IGkubmV4dCgp\nOwogICAgICAgICAgICBuYW1lcyA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAg\nICAgICAgIG9ianMgPSBuZXcgQ2xhc3NbbmFtZXMubGVuZ3RoXTsKICAgICAg\nICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBuYW1lcy5sZW5ndGg7IGorKykg\newogICAgICAgICAgICAgICAgb2Jqc1tqXSA9IFN0cmluZ3MudG9DbGFzcyhu\nYW1lc1tqXSwgX2xvYWRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncnZhbC5wdXQoZW50cnkuZ2V0S2V5KCksIG9ianMpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcnZhbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbmFtZXMgb2YgdGhlIGNsYXNzKGVzKSBmcm9tIHRoZSBnaXZlbiBh\ncmcuCiAgICAgKgogICAgICogQHBhcmFtIGFyZyBhIGNsYXNzIG5hbWUsIC5q\nYXZhIGZpbGUsIC5jbGFzcyBmaWxlLCBvciBtZXRhZGF0YQogICAgICogZmls\nZSBuYW1pbmcgdGhlIHR5cGUocykgdG8gYWN0IG9uCiAgICAgKiBAdGhyb3dz\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiB3aXRoIGFwcHJvcHJpYXRlIG1l\nc3NhZ2Ugb24gZXJyb3IKICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIHBh\ncnNlVHlwZU5hbWVzKFN0cmluZyBhcmcpIHsKICAgICAgICBpZiAoYXJnID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwoKICAg\nICAgICB0cnkgewogICAgICAgICAgICBGaWxlIGZpbGUgPSBGaWxlcy5nZXRG\naWxlKGFyZywgX2xvYWRlcik7CiAgICAgICAgICAgIGlmIChhcmcuZW5kc1dp\ndGgoIi5jbGFzcyIpKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJp\nbmdbXXsgZ2V0RnJvbUNsYXNzRmlsZShmaWxlKSB9OwogICAgICAgICAgICBp\nZiAoYXJnLmVuZHNXaXRoKCIuamF2YSIpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTdHJpbmdbXXsgZ2V0RnJvbUphdmFGaWxlKGZpbGUpIH07CiAg\nICAgICAgICAgIGlmICgoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5leGlzdHNBY3Rpb24o\nZmlsZSkpKS5ib29sZWFuVmFsdWUoKSkgewogICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbjxTdHJpbmc+IGNvbCA9IGdldEZyb21NZXRhRGF0YUZpbGUoZmls\nZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29sLnRvQXJyYXkobmV3IFN0\ncmluZ1tjb2wuc2l6ZSgpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgTmVz\ndGFibGVSdW50aW1lRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgX2xvYy5n\nZXQoImNsYXNzLWFyZyIsIGFyZykuZ2V0TWVzc2FnZSgpLCBlKTsKICAgICAg\nICB9CgogICAgICAgIC8vIG11c3QgYmUgYSBjbGFzcyBuYW1lCiAgICAgICAg\ncmV0dXJuIG5ldyBTdHJpbmdbXXsgYXJnIH07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG5hbWVzIG9mIHRoZSBjbGFzcyhlcykgZnJvbSB0\naGUgZ2l2ZW4gbWV0YWRhdGFzLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nW10gcGFyc2VUeXBlTmFtZXMoTWV0YURhdGFJdGVyYXRvciBpdHIpIHsKICAg\nICAgICBpZiAoaXRyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nWzBdOwoKICAgICAgICBMaXN0PFN0cmluZz4gbmFtZXMgPSBuZXcg\nQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBPYmplY3Qgc291cmNlID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAoaXRyLmhh\nc05leHQoKSkgewogICAgICAgICAgICAgICAgc291cmNlID0gaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIGFwcGVuZFR5cGVOYW1lcyhzb3VyY2UsIGl0\nci5nZXRJbnB1dFN0cmVhbSgpLCBuYW1lcyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKAogICAgICAgICAgICAg\nICAgX2xvYy5nZXQoImNsYXNzLWFyZyIsIHNvdXJjZSkuZ2V0TWVzc2FnZSgp\nLCBlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hbWVzLnRvQXJyYXko\nbmV3IFN0cmluZ1tuYW1lcy5zaXplKCldKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIHRoZSBuYW1lcyBpbiB0aGUgZ2l2ZW4gbWV0YWRhdGEgaXRl\ncmF0b3Igc3RyZWFtLCBjbG9zaW5nIHRoZQogICAgICogc3RyZWFtIG9uIGNv\nbXBsZXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRUeXBl\nTmFtZXMoT2JqZWN0IHNvdXJjZSwgSW5wdXRTdHJlYW0gaW4sCiAgICAgICAg\nTGlzdDxTdHJpbmc+IG5hbWVzKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzb3VyY2UudG9TdHJpbmcoKS5l\nbmRzV2l0aCgiLmNsYXNzIikpCiAgICAgICAgICAgICAgICBuYW1lcy5hZGQo\nZ2V0RnJvbUNsYXNzKGluKSk7CiAgICAgICAgICAgIG5hbWVzLmFkZEFsbChn\nZXRGcm9tTWV0YURhdGEobmV3IElucHV0U3RyZWFtUmVhZGVyKGluKSkpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBpbi5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4\nY2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIG1hcHBpbmcgb2YgZWFjaCBtZXRh\nZGF0YSByZXNvdXJjZSB0byBhbiBhcnJheSBvZiBpdHMgY29udGFpbmVkCiAg\nICAgKiBjbGFzcyBuYW1lcy4KICAgICAqLwogICAgcHVibGljIE1hcDxPYmpl\nY3QsIFN0cmluZ1tdPiBtYXBUeXBlTmFtZXMoTWV0YURhdGFJdGVyYXRvciBp\ndHIpIHsKICAgICAgICBpZiAoaXRyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBDb2xsZWN0aW9ucy5lbXB0eU1hcCgpOwoKICAgICAgICBNYXA8T2Jq\nZWN0LCBTdHJpbmcgW10+IG1hcCA9IG5ldyBIYXNoTWFwPE9iamVjdCwgU3Ry\naW5nW10+KCk7CiAgICAgICAgT2JqZWN0IHNvdXJjZSA9IG51bGw7CiAgICAg\nICAgTGlzdDxTdHJpbmc+IG5hbWVzID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUgKGl0ci5oYXNO\nZXh0KCkpIHsKICAgICAgICAgICAgICAgIHNvdXJjZSA9IGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBhcHBlbmRUeXBlTmFtZXMoc291cmNlLCBpdHIu\nZ2V0SW5wdXRTdHJlYW0oKSwgbmFtZXMpOwogICAgICAgICAgICAgICAgaWYg\nKCFuYW1lcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXAu\ncHV0KHNvdXJjZSwgbmFtZXMudG9BcnJheShuZXcgU3RyaW5nW25hbWVzLnNp\nemUoKV0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5h\nbWVzLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgTmVzdGFibGVS\ndW50aW1lRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgX2xvYy5nZXQoImNs\nYXNzLWFyZyIsIHNvdXJjZSkuZ2V0TWVzc2FnZSgpLCBlKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG1hcDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdGhlIGNsYXNzIG5hbWVkIGluIHRoZSBnaXZlbiAuY2xhc3MgZmls\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0RnJvbUNsYXNzRmls\nZShGaWxlIGZpbGUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmls\nZUlucHV0U3RyZWFtIGZpbiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZmluID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdGaWxlSW5wdXRTdHJl\nYW1BY3Rpb24oZmlsZSkpOwogICAgICAgICAgICByZXR1cm4gZ2V0RnJvbUNs\nYXNzKGZpbik7CiAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4\nY2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgdGhyb3cgKEZpbGVOb3RGb3Vu\nZEV4Y2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChmaW4gIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZmluLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBjbGFzcyBuYW1lIGluIHRoZSBnaXZlbiAuY2xh\nc3MgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEZy\nb21DbGFzcyhJbnB1dFN0cmVhbSBpbikgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBDb25zdGFudFBvb2xUYWJsZSB0YWJsZSA9IG5ldyBDb25zdGFu\ndFBvb2xUYWJsZShpbik7CiAgICAgICAgaW50IGlkeCA9IHRhYmxlLmdldEVu\nZEluZGV4KCk7CiAgICAgICAgaWR4ICs9IDI7IC8vIGFjY2VzcyBmbGFncwog\nICAgICAgIGludCBjbHNFbnRyeSA9IHRhYmxlLnJlYWRVbnNpZ25lZFNob3J0\nKGlkeCk7CiAgICAgICAgaW50IHV0ZkVudHJ5ID0gdGFibGUucmVhZFVuc2ln\nbmVkU2hvcnQodGFibGUuZ2V0KGNsc0VudHJ5KSk7CiAgICAgICAgcmV0dXJu\nIHRhYmxlLnJlYWRTdHJpbmcodGFibGUuZ2V0KHV0ZkVudHJ5KSkucmVwbGFj\nZSgnLycsICcuJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRo\nZSBjbGFzcyBuYW1lZCBpbiB0aGUgZ2l2ZW4gLmphdmEgZmlsZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0RnJvbUphdmFGaWxlKEZpbGUgZmls\nZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBCdWZmZXJlZFJlYWRl\nciBpbiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gZmlu\nZCB0aGUgbGluZSB3aXRoIHRoZSBwYWNrYWdlIGRlY2xhcmF0aW9uCiAgICAg\nICAgICAgIGluID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5ldyBGaWxlUmVhZGVy\nKGZpbGUpKTsKICAgICAgICAgICAgU3RyaW5nIGxpbmU7CiAgICAgICAgICAg\nIFN0cmluZ0J1aWxkZXIgcGFjayA9IG51bGw7CiAgICAgICAgICAgIHdoaWxl\nICgobGluZSA9IGluLnJlYWRMaW5lKCkpICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGxpbmUgPSBsaW5lLnRyaW0oKTsKICAgICAgICAgICAgICAgIGlm\nIChsaW5lLnN0YXJ0c1dpdGgoInBhY2thZ2UgIikpIHsKICAgICAgICAgICAg\nICAgICAgICBsaW5lID0gbGluZS5zdWJzdHJpbmcoOCkudHJpbSgpOwoKICAg\nICAgICAgICAgICAgICAgICAvLyBzdHJpcCBvZmYgYW55dGhpbmcgYmV5b25k\nIHRoZSBwYWNrYWdlIGRlY2xhcmF0aW9uCiAgICAgICAgICAgICAgICAgICAg\ncGFjayA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaW5lLmxlbmd0aCgpOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKENoYXJhY3Rlci5pc0phdmFJ\nZGVudGlmaWVyUGFydChsaW5lLmNoYXJBdChpKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHx8IGxpbmUuY2hhckF0KGkpID09ICcuJykKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHBhY2suYXBwZW5kKGxpbmUuY2hhckF0\nKGkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzdHJpcCAnLmphdmEn\nCiAgICAgICAgICAgIFN0cmluZyBjbHNOYW1lID0gZmlsZS5nZXROYW1lKCk7\nCiAgICAgICAgICAgIGNsc05hbWUgPSBjbHNOYW1lLnN1YnN0cmluZygwLCBj\nbHNOYW1lLmxlbmd0aCgpIC0gNSk7CgogICAgICAgICAgICAvLyBwcmVmaXgg\nd2l0aCBwYWNrYWdlCiAgICAgICAgICAgIGlmIChwYWNrICE9IG51bGwgJiYg\ncGFjay5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICBjbHNOYW1lID0g\ncGFjayArICIuIiArIGNsc05hbWU7CgogICAgICAgICAgICByZXR1cm4gY2xz\nTmFtZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoaW4g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IGluLmNsb3NlKCk7IH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkge30KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjbGFzc2VzIG5hbWVkIGluIHRo\nZSBnaXZlbiBjb21tb24gZm9ybWF0IG1ldGFkYXRhIGZpbGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgQ29sbGVjdGlvbjxTdHJpbmc+IGdldEZyb21NZXRhRGF0\nYUZpbGUoRmlsZSBmaWxlKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgRmlsZVJlYWRlciBpbiA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaW4gPSBuZXcgRmlsZVJlYWRlcihmaWxlKTsKICAgICAg\nICAgICAgcmV0dXJuIGdldEZyb21NZXRhRGF0YShpbik7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKGluICE9IG51bGwpCiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGluLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBjbGFzc2VzIG5hbWVkIGluIHRoZSBnaXZlbiBj\nb21tb24gZm9ybWF0IG1ldGFkYXRhIHN0cmVhbS4KICAgICAqLwogICAgcHJp\ndmF0ZSBDb2xsZWN0aW9uPFN0cmluZz4gZ2V0RnJvbU1ldGFEYXRhKFJlYWRl\nciB4bWwpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQ29sbGVjdGlv\nbjxTdHJpbmc+IG5hbWVzID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAg\nICAgICAgQnVmZmVyZWRSZWFkZXIgaW4gPSBuZXcgQnVmZmVyZWRSZWFkZXIo\neG1sKTsKCiAgICAgICAgYm9vbGVhbiBjb21tZW50ID0gZmFsc2U7CiAgICAg\nICAgaW50IHRva2VuID0gVE9LRU5fTk9ORTsKICAgICAgICBTdHJpbmcgcGtn\nID0gIiI7CiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgcmVhZDoKICAg\nICAgICBmb3IgKGludCBjaCA9IDAsIGxhc3QgPSAwLCBsYXN0MiA9IDA7CiAg\nICAgICAgICAgIGNoID09ICc8JyB8fCAoY2ggPSBpbi5yZWFkKCkpICE9IC0x\nOyBsYXN0MiA9IGxhc3QsIGxhc3QgPSBjaCkgewogICAgICAgICAgICAvLyBo\nYW5kbGUgY29tbWVudHMKICAgICAgICAgICAgaWYgKGNvbW1lbnQgJiYgbGFz\ndDIgPT0gJy0nICYmIGxhc3QgPT0gJy0nICYmIGNoID09ICc+JykgewogICAg\nICAgICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvbW1l\nbnQpIHsKICAgICAgICAgICAgICAgIGlmIChjaCA9PSAnPCcpIHsKICAgICAg\nICAgICAgICAgICAgICBjaCA9IGluLnJlYWQoKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrIHJlYWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGFzdDIg\nPT0gJzwnICYmIGxhc3QgPT0gJyEnICYmIGNoID09ICctJykgewogICAgICAg\nICAgICAgICAgY29tbWVudCA9IHRydWU7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbm90IGFu\nIGVsZW1lbnQgc3RhcnQsIHNraXAgaXQKICAgICAgICAgICAgaWYgKGNoICE9\nICc8JykKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB0\nb2tlbiA9IFRPS0VOX05PTkU7IC8vIHJlc2V0IHRva2VuCiAgICAgICAgICAg\nIGxhc3QgPSBjaDsgLy8gdXBkYXRlIG5lZWRlZCBmb3IgY29tbWVudCBkZXRl\nY3Rpb24KICAgICAgICAgICAgY2ggPSByZWFkVGhyb3VnaFdoaXRlc3BhY2Uo\naW4pOwogICAgICAgICAgICBpZiAoY2ggPT0gJy8nIHx8IGNoID09ICchJyB8\nfCBjaCA9PSAnPycpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIC8vIHJlYWQgZWxlbWVudCBuYW1lOyBsb29rIGZvciBwYWNrYWdl\ncyBhbmQgY2xhc3NlcwogICAgICAgICAgICB0b2tlbiA9IHJlYWRFbGVtZW50\nVG9rZW4oY2gsIGluKTsKICAgICAgICAgICAgc3dpdGNoICh0b2tlbikgewog\nICAgICAgICAgICAgICAgY2FzZSBUT0tFTl9FT0Y6CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWsgcmVhZDsKICAgICAgICAgICAgICAgIGNhc2UgVE9LRU5f\nUEFDS0FHRToKICAgICAgICAgICAgICAgICAgICBwa2cgPSByZWFkQXR0cmli\ndXRlKGluLCBfcGFja2FnZUF0dHIpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwa2cgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsg\ncmVhZDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgVE9LRU5fUEFDS0FHRV9OT0FUVFI6CiAgICAgICAgICAgICAg\nICAgICAgcGtnID0gcmVhZEVsZW1lbnRUZXh0KGluKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAocGtnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrIHJlYWQ7CiAgICAgICAgICAgICAgICAgICAgY2ggPSAnPCc7\nIC8vIHJlYWRpbmcgZWxlbWVudCB0ZXh0IHJlYWRzIHRvIG5leHQgJzwnCiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFRPS0VOX0NMQVNTOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSByZWFk\nQXR0cmlidXRlKGluLCBfY2xhc3NBdHRyKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBi\ncmVhayByZWFkOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2cubGVuZ3Ro\nKCkgPiAwICYmIG5hbWUuaW5kZXhPZignLicpID09IC0xKQogICAgICAgICAg\nICAgICAgICAgICAgICBuYW1lcy5hZGQocGtnICsgIi4iICsgbmFtZSk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICBuYW1lcy5hZGQobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFRPS0VOX0NMQVNTX05PQVRUUjoKICAg\nICAgICAgICAgICAgICAgICBuYW1lID0gcmVhZEVsZW1lbnRUZXh0KGluKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhayByZWFkOwogICAgICAgICAgICAgICAg\nICAgIGNoID0gJzwnOyAvLyByZWFkaW5nIGVsZW1lbnQgdGV4dCByZWFkcyB0\nbyBuZXh0ICc8JwogICAgICAgICAgICAgICAgICAgIGlmIChwa2cubGVuZ3Ro\nKCkgPiAwICYmIG5hbWUuaW5kZXhPZignLicpID09IC0xKQogICAgICAgICAg\nICAgICAgICAgICAgICBuYW1lcy5hZGQocGtnICsgIi4iICsgbmFtZSk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICBuYW1lcy5hZGQobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hbWVz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZCB0aGUgbmFtZSBvZiB0aGUg\nY3VycmVudCBYTUwgZWxlbWVudCBhbmQgcmV0dXJuIHRoZSBtYXRjaGluZyB0\nb2tlbi4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgcmVhZEVsZW1lbnRUb2tl\nbihpbnQgY2gsIFJlYWRlciBpbikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBsb29rIHRocm91Z2ggdGhlIGJlZ2lubmluZyBlbGVtZW50IG5h\nbWVzIHRvIGZpbmQgd2hhdCBlbGVtZW50IHRoaXMKICAgICAgICAvLyBtaWdo\ndCBiZShpZiBhbnkpCiAgICAgICAgaW50IG1hdGNoSWR4ID0gLTE7CiAgICAg\nICAgaW50IG1hdGNoZWQgPSAwOwogICAgICAgIGludCBkcSA9IDA7CiAgICAg\nICAgZm9yIChpbnQgYmVnaW5JZHggPSAwOyBiZWdpbklkeCA8IF9iZWdpbkVs\nZW1lbnRzWzBdLmxlbmd0aDsgYmVnaW5JZHgrKykKICAgICAgICB7CiAgICAg\nICAgICAgIGlmIChiZWdpbklkeCAhPSAwKQogICAgICAgICAgICAgICAgY2gg\nPSBpbi5yZWFkKCk7CiAgICAgICAgICAgIGlmIChjaCA9PSAtMSkKICAgICAg\nICAgICAgICAgIHJldHVybiBUT0tFTl9FT0Y7CgogICAgICAgICAgICBtYXRj\naGVkID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfYmVn\naW5FbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKChkcSAmICgyIDw8IGkpKSAhPSAwKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlmIChjaCA9PSBfYmVnaW5FbGVt\nZW50c1tpXVtiZWdpbklkeF0pIHsKICAgICAgICAgICAgICAgICAgICBtYXRj\naElkeCA9IGk7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZCsrOwogICAg\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgZHEgfD0g\nMiA8PCBpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobWF0Y2hl\nZCA9PSAwKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAg\nICAgIGlmIChtYXRjaGVkICE9IDEpCiAgICAgICAgICAgIHJldHVybiBUT0tF\nTl9OT05FOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJlc3Qgb2YgdGhl\nIGVsZW1lbnQgbmFtZSBtYXRjaGVzCiAgICAgICAgY2hhcltdIG1hdGNoID0g\nX2VuZEVsZW1lbnRzW21hdGNoSWR4XTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1hdGNoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNoID0g\naW4ucmVhZCgpOwogICAgICAgICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAg\nICAgICAgICByZXR1cm4gVE9LRU5fRU9GOwogICAgICAgICAgICBpZiAoY2gg\nIT0gbWF0Y2hbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gVE9LRU5fTk9O\nRTsKICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgdGhlIG5leHQgY2hhciB0\nbyBtYWtlIHN1cmUgd2UgZmluaXNoZWQgdGhlIGVsZW1lbnQgbmFtZQogICAg\nICAgIGNoID0gaW4ucmVhZCgpOwogICAgICAgIGlmIChjaCA9PSAtMSkKICAg\nICAgICAgICAgcmV0dXJuIFRPS0VOX0VPRjsKICAgICAgICBpZiAoY2ggPT0g\nJz4nKSB7CiAgICAgICAgICAgIGlmIChtYXRjaElkeCA9PSAwICYmIF9wYWNr\nYWdlQXR0ciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIFRPS0VO\nX1BBQ0tBR0VfTk9BVFRSOwogICAgICAgICAgICBpZiAobWF0Y2hJZHggIT0g\nMCAmJiBfY2xhc3NBdHRyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gVE9LRU5fQ0xBU1NfTk9BVFRSOwogICAgICAgIH0gZWxzZSBpZiAoQ2hh\ncmFjdGVyLmlzV2hpdGVzcGFjZSgoY2hhcikgY2gpKSB7CiAgICAgICAgICAg\nIGlmIChtYXRjaElkeCA9PSAwICYmIF9wYWNrYWdlQXR0ciAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIFRPS0VOX1BBQ0tBR0U7CiAgICAgICAg\nICAgIGlmIChtYXRjaElkeCAhPSAwICYmIF9jbGFzc0F0dHIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBUT0tFTl9DTEFTUzsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIFRPS0VOX05PTkU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWFkIHRoZSBhdHRyaWJ1dGUgd2l0aCB0aGUgZ2l2ZW4gbmFtZSBp\nbiBjaGFycyBvZiB0aGUgY3VycmVudCBYTUwKICAgICAqIGVsZW1lbnQuCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIHJlYWRBdHRyaWJ1dGUoUmVhZGVy\nIGluLCBjaGFyW10gbmFtZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBpbnQgZXhwZWN0ZWQgPSAwOwogICAgICAgIGZvciAoaW50IGNoLCBsYXN0\nID0gMDsgdHJ1ZTsgbGFzdCA9IGNoKSB7CiAgICAgICAgICAgIGNoID0gaW4u\ncmVhZCgpOwogICAgICAgICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKGNoID09ICc+JykK\nICAgICAgICAgICAgICAgIHJldHVybiAiIjsKCiAgICAgICAgICAgIC8vIGlm\nIG5vdCBleHBlY3RlZCBjaGFyIG9yIHN0aWxsIGxvb2tpbmcgZm9yICduJyBh\nbmQgcHJldmlvdXMKICAgICAgICAgICAgLy8gY2hhciBpcyBub3Qgd2hpdGVz\ncGFjZSwga2VlcCBsb29raW5nCiAgICAgICAgICAgIGlmIChjaCAhPSBuYW1l\nW2V4cGVjdGVkXSB8fCAoZXhwZWN0ZWQgPT0gMCAmJiBsYXN0ICE9IDAKICAg\nICAgICAgICAgICAgICYmICFDaGFyYWN0ZXIuaXNXaGl0ZXNwYWNlKChjaGFy\nKSBsYXN0KSkpIHsKICAgICAgICAgICAgICAgIGV4cGVjdGVkID0gMDsKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBmb3VuZCBleHBlY3RlZCBjaGFyOyBoYXZlIHdlIGZvdW5kIHRo\nZSB3aG9sZSAibmFtZSI/CiAgICAgICAgICAgIGV4cGVjdGVkKys7CiAgICAg\nICAgICAgIGlmIChleHBlY3RlZCA9PSBuYW1lLmxlbmd0aCkgewogICAgICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBuZXh0IGNoYXIgaXMgJz0nCiAg\nICAgICAgICAgICAgICBjaCA9IHJlYWRUaHJvdWdoV2hpdGVzcGFjZShpbik7\nCiAgICAgICAgICAgICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBpZiAoY2ggIT0g\nJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQgPSAwOwogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIC8vIHRvc3Mgb3V0IGFueSBzdWJzZXF1ZW50IHdo\naXRlc3BhY2UgYW5kIHRoZSBuZXh0IGNoYXIsIHdoaWNoCiAgICAgICAgICAg\nICAgICAvLyBpcyB0aGUgb3BlbmluZyBxdW90ZSBmb3IgdGhlIGF0dHIgdmFs\ndWUsIHRoZW4gcmVhZCB1bnRpbCB0aGUKICAgICAgICAgICAgICAgIC8vIGNs\nb3NpbmcgcXVvdGUKICAgICAgICAgICAgICAgIHJlYWRUaHJvdWdoV2hpdGVz\ncGFjZShpbik7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVhZEF0dHJpYnV0\nZVZhbHVlKGluKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJlYWQgdGhlIGN1cnJlbnQgdGV4dCB2YWx1ZSB1bnRp\nbCB0aGUgbmV4dCBlbGVtZW50LgogICAgICovCiAgICBwcml2YXRlIFN0cmlu\nZyByZWFkRWxlbWVudFRleHQoUmVhZGVyIGluKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbnVsbDsKICAgICAg\nICBpbnQgY2g7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAg\nY2ggPSBpbi5yZWFkKCk7CiAgICAgICAgICAgIGlmIChjaCA9PSAtMSkKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoY2gg\nPT0gJzwnKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGlm\nIChDaGFyYWN0ZXIuaXNXaGl0ZXNwYWNlKChjaGFyKSBjaCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGJ1ZiA9PSBudWxs\nKQogICAgICAgICAgICAgICAgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgoY2hhcikgY2gpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gKGJ1ZiA9PSBudWxsKSA/ICIiIDogYnVmLnRvU3Ry\naW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIHVudGlsIHRoZSBu\nZXh0IG5vbi13aGl0ZXNwYWNlIGNoYXJhY3Rlci4KICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgcmVhZFRocm91Z2hXaGl0ZXNwYWNlKFJlYWRlciBpbikgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpbnQgY2g7CiAgICAgICAgd2hp\nbGUgKHRydWUpIHsKICAgICAgICAgICAgY2ggPSBpbi5yZWFkKCk7CiAgICAg\nICAgICAgIGlmIChjaCA9PSAtMSB8fCAhQ2hhcmFjdGVyLmlzV2hpdGVzcGFj\nZSgoY2hhcikgY2gpKQogICAgICAgICAgICAgICAgcmV0dXJuIGNoOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY3VycmVu\ndCBhdHRyaWJ1dGUgdmFsdWUuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5n\nIHJlYWRBdHRyaWJ1dGVWYWx1ZShSZWFkZXIgaW4pIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgU3RyaW5nQnVpbGRlciBidWYgPSBuZXcgU3RyaW5n\nQnVpbGRlcigpOwogICAgICAgIGludCBjaDsKICAgICAgICB3aGlsZSAodHJ1\nZSkgewogICAgICAgICAgICBjaCA9IGluLnJlYWQoKTsKICAgICAgICAgICAg\naWYgKGNoID09IC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgICAgIGlmIChjaCA9PSAnXCcnIHx8IGNoID09ICciJykKICAgICAg\nICAgICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgoY2hhcikgY2gpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

