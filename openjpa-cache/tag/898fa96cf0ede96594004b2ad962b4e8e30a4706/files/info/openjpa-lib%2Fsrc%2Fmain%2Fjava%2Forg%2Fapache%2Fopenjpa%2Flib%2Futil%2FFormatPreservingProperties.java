{"sha":"c87bd6d380fffdab171986cbb783269096f31d91","node_id":"MDQ6QmxvYjIwNjM2NDpjODdiZDZkMzgwZmZmZGFiMTcxOTg2Y2JiNzgzMjY5MDk2ZjMxZDkx","size":23580,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c87bd6d380fffdab171986cbb783269096f31d91","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uRmlsdGVy\nSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSW5wdXRT\ndHJlYW1SZWFkZXI7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFt\nOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07CmltcG9ydCBq\nYXZhLmlvLk91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3Ry\nZWFtV3JpdGVyOwppbXBvcnQgamF2YS5pby5QcmludFdyaXRlcjsKaW1wb3J0\nIGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkNhbGVu\nZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGls\nLkxpbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuUHJvcGVydGllczsKaW1w\nb3J0IGphdmEudXRpbC5TZXQ7CgovKgogKiAjIyMgdGhpbmdzIHRvIGFkZDog\nLSBzaG91bGQgcHJvYmFibHkgYmUgYSBTb3VyY2VUcmFja2VyCiAqIC0gaWYg\nYW4gZW50cnkgaXMgcmVtb3ZlZCwgc2hvdWxkIHRoZXJlIGJlIGFuIG9wdGlv\nbiB0byByZW1vdmUgY29tbWVudHMKICoganVzdCBiZWZvcmUgdGhlIGVudHJ5\nKGEgbGEgamF2YWRvYyk/CiAqIC0gc2hvdWxkIHdlIGhhdmUgYW4gb3B0aW9u\nIHRvIGNsZWFuIHVwIHdoaXRlc3BhY2U/CiAqIC0gcG90ZW50aWFsbHkgd291\nbGQgYmUgaW50ZXJlc3RpbmcgdG8gYWRkIGNvbW1lbnRzIGFib3V0IGVhY2gK\nICogcHJvcGVydHkgdGhhdCBPcGVuSlBBIGFkZHMgdG8gdGhpcyBvYmplY3Qu\nIFdlJ2Qgd2FudCB0byBtYWtlIHRoZQogKiBhdXRvbWF0aWMgY29tbWVudC1y\nZW1vdmluZyBjb2RlIHdvcmsgZmlyc3QsIHRob3VnaCwgc28gdGhhdCBpZgog\nKiBzb21lb25lIHRoZW4gcmVtb3ZlZCB0aGUgcHJvcGVydHksIHRoZSBjb21t\nZW50cyB3b3VsZCBnbyBhd2F5LgogKiAtIHdvdWxkIGJlIG5lYXQgaWYgRHVw\nbGljYXRlS2V5RXhjZXB0aW9uIGNvdWxkIHJlcG9ydCBsaW5lIG51bWJlcnMg\nb2YKICogb2ZmZW5kaW5nIGVudHJpZXMuCiAqIC0gcHV0QWxsKCkgd2l0aCBh\nbm90aGVyIEZvcm1hdFByZXNlcnZpbmdQcm9wZXJ0aWVzIHNob3VsZCBiZSBz\nbWFydGVyCiAqLwoKLyoqCiAqIEEgc3BlY2lhbGl6YXRpb24gb2Yge0BsaW5r\nIFByb3BlcnRpZXN9IHRoYXQgc3RvcmVzIGl0cyBjb250ZW50cwogKiBpbiB0\naGUgc2FtZSBvcmRlciBhbmQgd2l0aCB0aGUgc2FtZSBmb3JtYXR0aW5nIGFz\nIHdhcyB1c2VkIHRvIHJlYWQKICogdGhlIGNvbnRlbnRzIGZyb20gYW4gaW5w\ndXQgc3RyZWFtLiBUaGlzIGlzIHVzZWZ1bCBiZWNhdXNlIGl0IG1lYW5zCiAq\nIHRoYXQgYSBwcm9wZXJ0aWVzIGZpbGUgbG9hZGVkIHZpYSB0aGlzIG9iamVj\ndCBhbmQgdGhlbiB3cml0dGVuCiAqIGJhY2sgb3V0IGxhdGVyIG9uIHdpbGwg\nb25seSBiZSBkaWZmZXJlbnQgd2hlcmUgY2hhbmdlcyBvcgogKiBhZGRpdGlv\nbnMgd2VyZSBtYWRlLgogKiBCeSBkZWZhdWx0LCB0aGUge0BsaW5rICNzdG9y\nZX0gbWV0aG9kIGluIHRoaXMgY2xhc3MgZG9lcyBub3QKICogYmVoYXZlIHRo\nZSBzYW1lIGFzIHtAbGluayBQcm9wZXJ0aWVzI3N0b3JlfS4gWW91IGNhbiBj\nYXVzZSBhbgogKiBpbnN0YW5jZSB0byBhcHByb3hpbWF0ZSB0aGUgYmVoYXZp\nb3Igb2Yge0BsaW5rIFByb3BlcnRpZXMjc3RvcmV9CiAqIGJ5IGludm9raW5n\nIHtAbGluayAjc2V0RGVmYXVsdEVudHJ5RGVsaW1pdGVyfSB3aXRoIDxjb2Rl\nPj08L2NvZGU+LAogKiB7QGxpbmsgI3NldEFkZFdoaXRlc3BhY2VBZnRlckRl\nbGltaXRlcn0gd2l0aCA8Y29kZT5mYWxzZTwvY29kZT4sIGFuZAogKiB7QGxp\nbmsgI3NldEFsbG93RHVwbGljYXRlc30gd2l0aCA8Y29kZT50cnVlPC9jb2Rl\nPi4gSG93ZXZlciwgdGhpcwogKiB3aWxsIG9ubHkgaW5mbHVlbmNlIGhvdyB0\naGUgaW5zdGFuY2Ugd2lsbCB3cml0ZSBuZXcgdmFsdWVzLCBub3QgaG93CiAq\nIGl0IHdpbGwgd3JpdGUgZXhpc3Rpbmcga2V5LXZhbHVlIHBhaXJzIHRoYXQg\nYXJlIG1vZGlmaWVkLgogKiBJbiBjb25qdW5jdGlvbiB3aXRoIGEgY29uc2Vy\ndmF0aXZlIG91dHB1dCB3cml0ZXIsIGl0IGlzCiAqIHBvc3NpYmxlIHRvIG9u\nbHkgd3JpdGUgdG8gZGlzayBjaGFuZ2VzIC8gYWRkaXRpb25zLgogKiBUaGlz\nIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IHBlcm1pdCBlc2NhcGVkICcgJywg\nJz0nLCAnOicKICogY2hhcmFjdGVycyBpbiBrZXkgbmFtZXMuCiAqCiAqIEBz\naW5jZSAwLjMuMwogKi8KcHVibGljIGNsYXNzIEZvcm1hdFByZXNlcnZpbmdQ\ncm9wZXJ0aWVzIGV4dGVuZHMgUHJvcGVydGllcyB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChGb3JtYXRQcmVzZXJ2aW5nUHJvcGVydGllcy5jbGFzcyk7Cgog\nICAgcHJpdmF0ZSBjaGFyIGRlZmF1bHRFbnRyeURlbGltaXRlciA9ICc6JzsK\nICAgIHByaXZhdGUgYm9vbGVhbiBhZGRXaGl0ZXNwYWNlQWZ0ZXJEZWxpbWl0\nZXIgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIGFsbG93RHVwbGljYXRl\ncyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIGluc2VydFRpbWVzdGFt\ncCA9IGZhbHNlOwoKICAgIHByaXZhdGUgUHJvcGVydHlTb3VyY2Ugc291cmNl\nOwogICAgcHJpdmF0ZSBMaW5rZWRIYXNoU2V0IG5ld0tleXMgPSBuZXcgTGlu\na2VkSGFzaFNldCgpOwogICAgcHJpdmF0ZSBIYXNoU2V0IG1vZGlmaWVkS2V5\ncyA9IG5ldyBIYXNoU2V0KCk7CgogICAgLy8gbWFya2VyIHRoYXQgaW5kaWNh\ndGVzIHRoYXQgd2UncmUgbm90IGRlc2VyaWFsaXppbmcKICAgIHByaXZhdGUg\ndHJhbnNpZW50IGJvb2xlYW4gaXNOb3REZXNlcmlhbGl6aW5nID0gdHJ1ZTsK\nICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gaXNMb2FkaW5nID0gZmFs\nc2U7CgogICAgcHVibGljIEZvcm1hdFByZXNlcnZpbmdQcm9wZXJ0aWVzKCkg\newogICAgICAgIHRoaXMobnVsbCk7CiAgICB9CgogICAgcHVibGljIEZvcm1h\ndFByZXNlcnZpbmdQcm9wZXJ0aWVzKFByb3BlcnRpZXMgZGVmYXVsdHMpIHsK\nICAgICAgICBzdXBlcihkZWZhdWx0cyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgY2hhcmFjdGVyIHRvIHVzZSBhcyBhIGRlbGltaXRlciBiZXR3ZWVu\nIHByb3BlcnR5IGtleXMgYW5kIHZhbHVlcy4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZGVmYXVsdEVudHJ5RGVsaW1pdGVyIGVpdGhlciAnOicgb3IgJz0nCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHRFbnRyeURlbGltaXRl\ncihjaGFyIGRlZmF1bHRFbnRyeURlbGltaXRlcikgewogICAgICAgIHRoaXMu\nZGVmYXVsdEVudHJ5RGVsaW1pdGVyID0gZGVmYXVsdEVudHJ5RGVsaW1pdGVy\nOwogICAgfQoKICAgIC8qKgogICAgICogU2VlIHtAbGluayAjc2V0RGVmYXVs\ndEVudHJ5RGVsaW1pdGVyfQogICAgICovCiAgICBwdWJsaWMgY2hhciBnZXRE\nZWZhdWx0RW50cnlEZWxpbWl0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMu\nZGVmYXVsdEVudHJ5RGVsaW1pdGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+LCB0aGlzIHByb3BlcnRpZXMg\nb2JqZWN0IHdpbGwgYWRkIGEKICAgICAqIHNwYWNlIGFmdGVyIHRoZSBkZWxp\nbWl0ZXIgY2hhcmFjdGVyKGlmIHRoZSBkZWxpbWl0ZXIgaXMgbm90CiAgICAg\nKiB0aGUgc3BhY2UgY2hhcmFjdGVyKS4gRWxzZSwgdGhpcyB3aWxsIG5vdCBh\nZGQgYSBzcGFjZS4KICAgICAqIERlZmF1bHQgdmFsdWU6IDxjb2RlPnRydWU8\nL2NvZGU+LiBOb3RlIHRoYXQge0BsaW5rCiAgICAgKiBQcm9wZXJ0aWVzI3N0\nb3JlfSBuZXZlciB3cml0ZXMgd2hpdGVzcGFjZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0QWRkV2hpdGVzcGFjZUFmdGVyRGVsaW1pdGVyKGJvb2xl\nYW4gYWRkKSB7CiAgICAgICAgdGhpcy5hZGRXaGl0ZXNwYWNlQWZ0ZXJEZWxp\nbWl0ZXIgPSBhZGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8g\nPGNvZGU+dHJ1ZTwvY29kZT4sIHRoaXMgcHJvcGVydGllcyBvYmplY3Qgd2ls\nbCBhZGQgYQogICAgICogc3BhY2UgYWZ0ZXIgdGhlIGRlbGltaXRlciBjaGFy\nYWN0ZXIoaWYgdGhlIGRlbGltaXRlciBpcyBub3QKICAgICAqIHRoZSBzcGFj\nZSBjaGFyYWN0ZXIpLiBFbHNlLCB0aGlzIHdpbGwgbm90IGFkZCBhIHNwYWNl\nLgogICAgICogRGVmYXVsdCB2YWx1ZTogPGNvZGU+dHJ1ZTwvY29kZT4uIE5v\ndGUgdGhhdCB7QGxpbmsKICAgICAqIFByb3BlcnRpZXMjc3RvcmV9IG5ldmVy\nIHdyaXRlcyB3aGl0ZXNwYWNlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRBZGRXaGl0ZXNwYWNlQWZ0ZXJEZWxpbWl0ZXIoKSB7CiAgICAgICAg\ncmV0dXJuIHRoaXMuYWRkV2hpdGVzcGFjZUFmdGVyRGVsaW1pdGVyOwogICAg\nfQoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+\nLCB0aGlzIHByb3BlcnRpZXMgb2JqZWN0IHdpbGwgYWRkIGEKICAgICAqIHRp\nbWVzdGFtcCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBmaWxlLCBqdXN0IGFm\ndGVyIHRoZSBoZWFkZXIKICAgICAqIChpZiBhbnkpIGlzIHByaW50ZWQuIEVs\nc2UsIHRoaXMgd2lsbCBub3QgYWRkIGEgdGltZXN0YW1wLgogICAgICogRGVm\nYXVsdCB2YWx1ZTogPGNvZGU+ZmFsc2U8L2NvZGU+LiBOb3RlIHRoYXQge0Bs\naW5rCiAgICAgKiBQcm9wZXJ0aWVzI3N0b3JlfSBhbHdheXMgd3JpdGVzIGEg\ndGltZXN0YW1wLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnNlcnRU\naW1lc3RhbXAoYm9vbGVhbiBpbnNlcnRUaW1lc3RhbXApIHsKICAgICAgICB0\naGlzLmluc2VydFRpbWVzdGFtcCA9IGluc2VydFRpbWVzdGFtcDsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHNldCB0byA8Y29kZT50cnVlPC9jb2RlPiwg\ndGhpcyBwcm9wZXJ0aWVzIG9iamVjdCB3aWxsIGFkZCBhCiAgICAgKiB0aW1l\nc3RhbXAgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgZmlsZSwganVzdCBhZnRl\nciB0aGUgaGVhZGVyCiAgICAgKiAoaWYgYW55KSBpcyBwcmludGVkLiBFbHNl\nLCB0aGlzIHdpbGwgbm90IGFkZCBhIHRpbWVzdGFtcC4KICAgICAqIERlZmF1\nbHQgdmFsdWU6IDxjb2RlPmZhbHNlPC9jb2RlPi4gTm90ZSB0aGF0IHtAbGlu\nawogICAgICogUHJvcGVydGllcyNzdG9yZX0gYWx3YXlzIHdyaXRlcyBhIHRp\nbWVzdGFtcC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0SW5zZXJ0\nVGltZXN0YW1wKCkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydFRpbWVz\ndGFtcDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHNldCB0byA8Y29kZT50\ncnVlPC9jb2RlPiwgZHVwbGljYXRlIHByb3BlcnRpZXMgYXJlIGFsbG93ZWQs\nIGFuZAogICAgICogdGhlIGxhc3QgcHJvcGVydHkgc2V0dGluZyBpbiB0aGUg\naW5wdXQgd2lsbCBvdmVyd3JpdGUgYW55IHByZXZpb3VzCiAgICAgKiBzZXR0\naW5ncy4gSWYgc2V0IHRvIDxjb2RlPmZhbHNlPC9jb2RlPiwgZHVwbGljYXRl\nIHByb3BlcnR5IGRlZmluaXRpb25zCiAgICAgKiBpbiB0aGUgaW5wdXQgd2ls\nbCBjYXVzZSBhbiBleGNlcHRpb24gdG8gYmUgdGhyb3duIGR1cmluZyB7QGxp\nbmsgI2xvYWR9LgogICAgICogRGVmYXVsdCB2YWx1ZTogPGNvZGU+ZmFsc2U8\nL2NvZGU+LiBOb3RlIHRoYXQge0BsaW5rCiAgICAgKiBQcm9wZXJ0aWVzI3N0\nb3JlfSBhbHdheXMgYWxsb3dzIGR1cGxpY2F0ZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEFsbG93RHVwbGljYXRlcyhib29sZWFuIGFsbG93RHVw\nbGljYXRlcykgewogICAgICAgIHRoaXMuYWxsb3dEdXBsaWNhdGVzID0gYWxs\nb3dEdXBsaWNhdGVzOwogICAgfQoKICAgIC8qKgogICAgICogSWYgc2V0IHRv\nIDxjb2RlPnRydWU8L2NvZGU+LCBkdXBsaWNhdGUgcHJvcGVydGllcyBhcmUg\nYWxsb3dlZCwgYW5kCiAgICAgKiB0aGUgbGFzdCBwcm9wZXJ0eSBzZXR0aW5n\nIGluIHRoZSBpbnB1dCB3aWxsIG92ZXJ3cml0ZSBhbnkgcHJldmlvdXMKICAg\nICAqIHNldHRpbmdzLiBJZiBzZXQgdG8gPGNvZGU+ZmFsc2U8L2NvZGU+LCBk\ndXBsaWNhdGUgcHJvcGVydHkgZGVmaW5pdGlvbnMKICAgICAqIGluIHRoZSBp\nbnB1dCB3aWxsIGNhdXNlIGFuIGV4Y2VwdGlvbiB0byBiZSB0aHJvd24gZHVy\naW5nIHtAbGluayAjbG9hZH0uCiAgICAgKiBEZWZhdWx0IHZhbHVlOiA8Y29k\nZT5mYWxzZTwvY29kZT4uIE5vdGUgdGhhdCB7QGxpbmsKICAgICAqIFByb3Bl\ncnRpZXMjc3RvcmV9IGFsd2F5cyBhbGxvd3MgZHVwbGljYXRlcy4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gZ2V0QWxsb3dEdXBsaWNhdGVzKCkgewog\nICAgICAgIHJldHVybiB0aGlzLmFsbG93RHVwbGljYXRlczsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFByb3BlcnR5KFN0cmluZyBrZXkpIHsKICAg\nICAgICByZXR1cm4gc3VwZXIuZ2V0UHJvcGVydHkoa2V5KTsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFByb3BlcnR5KFN0cmluZyBrZXksIFN0cmlu\nZyBkZWZhdWx0VmFsdWUpIHsKICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJv\ncGVydHkoa2V5LCBkZWZhdWx0VmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3Qgc2V0UHJvcGVydHkoU3RyaW5nIGtleSwgU3RyaW5nIHZhbHVlKSB7\nCiAgICAgICAgcmV0dXJuIHB1dChrZXksIHZhbHVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENpcmN1bXZlbnRzIHRoZSBzdXBlcmNsYXNzIHtAbGluayAj\ncHV0QWxsfSBpbXBsZW1lbnRhdGlvbiwKICAgICAqIHB1dHRpbmcgYWxsIHRo\nZSBrZXktdmFsdWUgcGFpcnMgdmlhIHtAbGluayAjcHV0fS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgcHV0QWxsKE1hcCBtKSB7CiAgICAgICAgTWFwLkVu\ndHJ5IGU7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0gbS5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBlID0gKE1hcC5FbnRyeSkgaXRlci5uZXh0KCk7CiAgICAgICAgICAgIHB1\ndChlLmdldEtleSgpLCBlLmdldFZhbHVlKCkpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZXMgdGhlIGtleSBmcm9tIHRoZSBib29r\na2VlcGluZyBjb2xsZWN0aW90bnMgYXMgd2VsbC4KICAgICAqLwogICAgcHVi\nbGljIE9iamVjdCByZW1vdmUoT2JqZWN0IGtleSkgewogICAgICAgIG5ld0tl\neXMucmVtb3ZlKGtleSk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnJlbW92ZShr\nZXkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAg\nIHN1cGVyLmNsZWFyKCk7CgogICAgICAgIGlmIChzb3VyY2UgIT0gbnVsbCkK\nICAgICAgICAgICAgc291cmNlLmNsZWFyKCk7CgogICAgICAgIG5ld0tleXMu\nY2xlYXIoKTsKICAgICAgICBtb2RpZmllZEtleXMuY2xlYXIoKTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkgewogICAgICAgIEZvcm1hdFBy\nZXNlcnZpbmdQcm9wZXJ0aWVzIGMgPSAoRm9ybWF0UHJlc2VydmluZ1Byb3Bl\ncnRpZXMpCiAgICAgICAgICAgIHN1cGVyLmNsb25lKCk7CgogICAgICAgIGlm\nIChzb3VyY2UgIT0gbnVsbCkKICAgICAgICAgICAgYy5zb3VyY2UgPSAoUHJv\ncGVydHlTb3VyY2UpIHNvdXJjZS5jbG9uZSgpOwoKICAgICAgICBpZiAobW9k\naWZpZWRLZXlzICE9IG51bGwpCiAgICAgICAgICAgIGMubW9kaWZpZWRLZXlz\nID0gKEhhc2hTZXQpIG1vZGlmaWVkS2V5cy5jbG9uZSgpOwoKICAgICAgICBp\nZiAobmV3S2V5cyAhPSBudWxsKSB7CiAgICAgICAgICAgIGMubmV3S2V5cyA9\nIG5ldyBMaW5rZWRIYXNoU2V0KCk7CiAgICAgICAgICAgIGMubmV3S2V5cy5h\nZGRBbGwobmV3S2V5cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYzsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVPYmplY3QoT2JqZWN0T3V0\ncHV0U3RyZWFtIG91dCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBv\ndXQuZGVmYXVsdFdyaXRlT2JqZWN0KCk7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIHJlYWRPYmplY3QoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAgICAg\ndGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsK\nICAgICAgICBpbi5kZWZhdWx0UmVhZE9iamVjdCgpOwoKICAgICAgICBpc05v\ndERlc2VyaWFsaXppbmcgPSB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgcHV0KE9iamVjdCBrZXksIE9iamVjdCB2YWwpIHsKICAgICAgICBPYmpl\nY3QgbyA9IHN1cGVyLnB1dChrZXksIHZhbCk7CgogICAgICAgIC8vIGlmIHdl\nJ3JlIG5vIGxvbmdlciBsb2FkaW5nIGZyb20gcHJvcGVydGllcyBhbmQgdGhp\ncyBwdXQKICAgICAgICAvLyByZXByZXNlbnRzIGFuIGFjdHVhbCBjaGFuZ2Ug\naW4gdmFsdWUsIG1hcmsgdGhlIG1vZGlmaWNhdGlvbgogICAgICAgIC8vIG9y\nIGFkZGl0aW9uIGluIHRoZSBib29ra2VlcGluZyBjb2xsZWN0aW9ucy4KICAg\nICAgICBpZiAoIWlzTG9hZGluZyAmJiBpc05vdERlc2VyaWFsaXppbmcgJiYg\nIXZhbC5lcXVhbHMobykpIHsKICAgICAgICAgICAgaWYgKG8gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIG1vZGlmaWVkS2V5cy5hZGQoa2V5KTsKICAgICAg\nICAgICAgZWxzZSBpZiAoIW5ld0tleXMuY29udGFpbnMoa2V5KSkKICAgICAg\nICAgICAgICAgIG5ld0tleXMuYWRkKGtleSk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBvOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZHMgdGhlIHBy\nb3BlcnRpZXMgaW4gPGNvZGU+aW48L2NvZGU+LCBhY2NvcmRpbmcgdG8gdGhl\nIHJ1bGVzCiAgICAgKiBkZXNjcmliZWQgaW4ge0BsaW5rIFByb3BlcnRpZXMj\nbG9hZH0uIElmIHtAbGluayAjZ2V0QWxsb3dEdXBsaWNhdGVzfQogICAgICog\ncmV0dXJucyA8Y29kZT50cnVlPC9jb2RlPiwgdGhpcyB3aWxsIHRocm93IGEg\ne0BsaW5rCiAgICAgKiBEdXBsaWNhdGVLZXlFeGNlcHRpb259IGlmIGR1cGxp\nY2F0ZSBwcm9wZXJ0eSBkZWNsYXJhdGlvbnMgYXJlCiAgICAgKiBlbmNvdW50\nZXJlZC4KICAgICAqCiAgICAgKiBAc2VlIFByb3BlcnRpZXMjbG9hZAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBsb2FkKElucHV0U3RyZWFtIGluKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlzTG9hZGluZyA9IHRydWU7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9hZFByb3BlcnRpZXMoaW4pOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlzTG9hZGluZyA9IGZh\nbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgbG9hZFBy\nb3BlcnRpZXMoSW5wdXRTdHJlYW0gaW4pIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgc291cmNlID0gbmV3IFByb3BlcnR5U291cmNlKCk7CgogICAg\nICAgIFByb3BlcnR5TGluZVJlYWRlciByZWFkZXIgPSBuZXcgUHJvcGVydHlM\naW5lUmVhZGVyKGluLCBzb3VyY2UpOwoKICAgICAgICBTZXQgbG9hZGVkS2V5\ncyA9IG5ldyBIYXNoU2V0KCk7CgogICAgICAgIGZvciAoUHJvcGVydHlMaW5l\nIGw7CiAgICAgICAgICAgIChsID0gcmVhZGVyLnJlYWRQcm9wZXJ0eUxpbmUo\nKSkgIT0gbnVsbCAmJiBzb3VyY2UuYWRkKGwpOykgewogICAgICAgICAgICBT\ndHJpbmcgbGluZSA9IGwubGluZS50b1N0cmluZygpOwoKICAgICAgICAgICAg\nY2hhciBjID0gMDsKICAgICAgICAgICAgaW50IHBvcyA9IDA7CgogICAgICAg\nICAgICB3aGlsZSAocG9zIDwgbGluZS5sZW5ndGgoKSAmJiBpc1NwYWNlKGMg\nPSBsaW5lLmNoYXJBdChwb3MpKSkKICAgICAgICAgICAgICAgIHBvcysrOwoK\nICAgICAgICAgICAgaWYgKChsaW5lLmxlbmd0aCgpIC0gcG9zKSA9PSAwCiAg\nICAgICAgICAgICAgICB8fCBsaW5lLmNoYXJBdChwb3MpID09ICcjJyB8fCBs\naW5lLmNoYXJBdChwb3MpID09ICchJykKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBrZXkgPSBuZXcgU3Ry\naW5nQnVpbGRlcigpOwogICAgICAgICAgICB3aGlsZSAocG9zIDwgbGluZS5s\nZW5ndGgoKSAmJiAhaXNTcGFjZShjID0gbGluZS5jaGFyQXQocG9zKyspKQog\nICAgICAgICAgICAgICAgJiYgYyAhPSAnPScgJiYgYyAhPSAnOicpIHsKICAg\nICAgICAgICAgICAgIGlmIChjID09ICdcXCcpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAocG9zID09IGxpbmUubGVuZ3RoKCkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgbC5hcHBlbmQobGluZSA9IHJlYWRlci5yZWFkTGluZSgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gMDsKICAgICAgICAg\nICAgICAgICAgICAgICAgd2hpbGUgKHBvcyA8IGxpbmUubGVuZ3RoKCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICYmIGlzU3BhY2UoYyA9IGxpbmUu\nY2hhckF0KHBvcykpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9z\nKys7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgcG9zID0gcmVhZEVzY2FwZShsaW5lLCBwb3MsIGtleSk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICBrZXkuYXBwZW5kKGMpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBib29sZWFu\nIGlzRGVsaW0gPSAoYyA9PSAnOicgfHwgYyA9PSAnPScpOwoKICAgICAgICAg\nICAgZm9yICg7IHBvcyA8IGxpbmUubGVuZ3RoKCkKICAgICAgICAgICAgICAg\nICYmIGlzU3BhY2UoYyA9IGxpbmUuY2hhckF0KHBvcykpOyBwb3MrKykKICAg\nICAgICAgICAgICAgIDsKCiAgICAgICAgICAgIGlmICghaXNEZWxpbSAmJiAo\nYyA9PSAnOicgfHwgYyA9PSAnPScpKSB7CiAgICAgICAgICAgICAgICBwb3Mr\nKzsKICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgPCBsaW5lLmxlbmd0aCgp\nICYmIGlzU3BhY2UoYyA9IGxpbmUuY2hhckF0KHBvcykpKQogICAgICAgICAg\nICAgICAgICAgIHBvcysrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBT\ndHJpbmdCdWlsZGVyIGVsZW1lbnQgPSBuZXcgU3RyaW5nQnVpbGRlcihsaW5l\nLmxlbmd0aCgpIC0gcG9zKTsKCiAgICAgICAgICAgIHdoaWxlIChwb3MgPCBs\naW5lLmxlbmd0aCgpKSB7CiAgICAgICAgICAgICAgICBjID0gbGluZS5jaGFy\nQXQocG9zKyspOwogICAgICAgICAgICAgICAgaWYgKGMgPT0gJ1xcJykgewog\nICAgICAgICAgICAgICAgICAgIGlmIChwb3MgPT0gbGluZS5sZW5ndGgoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBsLmFwcGVuZChsaW5lID0gcmVh\nZGVyLnJlYWRMaW5lKCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGxpbmUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gMDsKICAgICAg\nICAgICAgICAgICAgICAgICAgd2hpbGUgKHBvcyA8IGxpbmUubGVuZ3RoKCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIGlzU3BhY2UoYyA9IGxp\nbmUuY2hhckF0KHBvcykpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncG9zKys7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZW5zdXJl\nQ2FwYWNpdHkobGluZS5sZW5ndGgoKSAtIHBvcyArCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBlbGVtZW50Lmxlbmd0aCgpKTsKICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwb3Mg\nPSByZWFkRXNjYXBlKGxpbmUsIHBvcywgZWxlbWVudCk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgZWxlbWVudC5hcHBlbmQoYyk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmICghbG9hZGVkS2V5cy5hZGQoa2V5LnRvU3RyaW5nKCkp\nICYmICFhbGxvd0R1cGxpY2F0ZXMpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgRHVwbGljYXRlS2V5RXhjZXB0aW9uKGtleS50b1N0cmluZygpLAogICAg\nICAgICAgICAgICAgICAgIGdldFByb3BlcnR5KGtleS50b1N0cmluZygpKSwg\nZWxlbWVudC50b1N0cmluZygpKTsKCiAgICAgICAgICAgIGwuc2V0UHJvcGVy\ndHlLZXkoa2V5LnRvU3RyaW5nKCkpOwogICAgICAgICAgICBsLnNldFByb3Bl\ncnR5VmFsdWUoZWxlbWVudC50b1N0cmluZygpKTsKICAgICAgICAgICAgcHV0\nKGtleS50b1N0cmluZygpLCBlbGVtZW50LnRvU3RyaW5nKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgdGhlIG5leHQgZXNjYXBl\nZCBjaGFyYWN0ZXI6IGhhbmRsZSBuZXdsaW5lcywgdGFicywgcmV0dXJucywg\nYW5kCiAgICAgKiBmb3JtIGZlZWRzIHdpdGggdGhlIGFwcHJvcHJpYXRlIGVz\nY2FwZWQgY2hhcmFjdGVyLCB0aGVuIHRyeSB0bwogICAgICogZGVjb2RlIHVu\naWNvZGUgY2hhcmFjdGVycy4gRmluYWxseSwganVzdCBhZGQgdGhlIGNoYXJh\nY3RlciBleHBsaWNpdGx5LgogICAgICoKICAgICAqIEBwYXJhbSBzb3VyY2Ug\ndGhlIHNvdXJjZSBvZiB0aGUgY2hhcmFjdGVycwogICAgICogQHBhcmFtIHBv\ncyB0aGUgcG9zaXRpb24gYXQgd2hpY2ggdG8gc3RhcnQgcmVhZGluZwogICAg\nICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSB3ZSBhcmUgYXBwZW5kaW5nIHRv\nCiAgICAgKiBAcmV0dXJuIHRoZSBwb3NpdGlvbiBhZnRlciB0aGUgcmVhZGlu\nZyBpcyBkb25lCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGludCByZWFk\nRXNjYXBlKFN0cmluZyBzb3VyY2UsIGludCBwb3MsIFN0cmluZ0J1aWxkZXIg\ndmFsdWUpIHsKICAgICAgICBjaGFyIGMgPSBzb3VyY2UuY2hhckF0KHBvcysr\nKTsKICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgY2FzZSAnbic6\nCiAgICAgICAgICAgICAgICB2YWx1ZS5hcHBlbmQoJ1xuJyk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAndCc6CiAgICAgICAg\nICAgICAgICB2YWx1ZS5hcHBlbmQoJ1x0Jyk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSAnZic6CiAgICAgICAgICAgICAgICB2\nYWx1ZS5hcHBlbmQoJ1xmJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgICB2YWx1ZS5hcHBl\nbmQoJ1xyJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSAndSc6CiAgICAgICAgICAgICAgICBpZiAocG9zICsgNCA8PSBzb3Vy\nY2UubGVuZ3RoKCkpIHsKICAgICAgICAgICAgICAgICAgICBjaGFyIHVuaSA9\nIChjaGFyKSBJbnRlZ2VyLnBhcnNlSW50CiAgICAgICAgICAgICAgICAgICAg\nICAgIChzb3VyY2Uuc3Vic3RyaW5nKHBvcywgcG9zICsgNCksIDE2KTsKICAg\nICAgICAgICAgICAgICAgICB2YWx1ZS5hcHBlbmQodW5pKTsKICAgICAgICAg\nICAgICAgICAgICBwb3MgKz0gNDsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdmFsdWUuYXBwZW5kKGMpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcG9zOwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNTcGFjZShjaGFyIGNoKSB7CiAg\nICAgICAgcmV0dXJuIENoYXJhY3Rlci5pc1doaXRlc3BhY2UoY2gpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNhdmUoT3V0cHV0U3RyZWFtIG91dCwgU3Ry\naW5nIGhlYWRlcikgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0b3Jl\nKG91dCwgaGVhZGVyKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBl\neCkgewogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZShP\ndXRwdXRTdHJlYW0gb3V0LCBTdHJpbmcgaGVhZGVyKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIGJvb2xlYW4gZW5kV2l0aE5ld2xpbmUgPSBzb3Vy\nY2UgIT0gbnVsbCAmJiBzb3VyY2UuZW5kc0luTmV3bGluZTsKCiAgICAgICAg\nLy8gTXVzdCBiZSBJU08tODg1OS0xIGVjb2RpbmcgYWNjb3JkaW5nIHRvIFBy\nb3BlcnRpZXMubG9hZCBqYXZhZG9jCiAgICAgICAgUHJpbnRXcml0ZXIgd3Jp\ndGVyID0gbmV3IFByaW50V3JpdGVyCiAgICAgICAgICAgIChuZXcgT3V0cHV0\nU3RyZWFtV3JpdGVyKG91dCwgIklTTy04ODU5LTEiKSwgZmFsc2UpOwoKICAg\nICAgICBpZiAoaGVhZGVyICE9IG51bGwpCiAgICAgICAgICAgIHdyaXRlci5w\ncmludGxuKCIjIiArIGhlYWRlcik7CgogICAgICAgIGlmIChpbnNlcnRUaW1l\nc3RhbXApCiAgICAgICAgICAgIHdyaXRlci5wcmludGxuKCIjIiArIENhbGVu\nZGFyLmdldEluc3RhbmNlKCkuZ2V0VGltZSgpKTsKCiAgICAgICAgTGlzdCBs\naW5lcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgLy8gZmlyc3Qgd3Jp\ndGUgYWxsIHRoZSBleGlzdGluZyBwcm9wcyBhcyB0aGV5IHdlcmUgaW5pdGlh\nbGx5IHJlYWQKICAgICAgICBpZiAoc291cmNlICE9IG51bGwpCiAgICAgICAg\nICAgIGxpbmVzLmFkZEFsbChzb3VyY2UpOwoKICAgICAgICAvLyBuZXh0IHdy\naXRlIG91dCBuZXcga2V5cywgdGhlbiB0aGUgcmVzdCBvZiB0aGUga2V5cwog\nICAgICAgIExpbmtlZEhhc2hTZXQga2V5cyA9IG5ldyBMaW5rZWRIYXNoU2V0\nKCk7CiAgICAgICAga2V5cy5hZGRBbGwobmV3S2V5cyk7CiAgICAgICAga2V5\ncy5hZGRBbGwoa2V5U2V0KCkpOwoKICAgICAgICBsaW5lcy5hZGRBbGwoa2V5\ncyk7CgogICAgICAgIGtleXMucmVtb3ZlKG51bGwpOwoKICAgICAgICBib29s\nZWFuIG5lZWRzTmV3bGluZSA9IGZhbHNlOwoKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGkgPSBsaW5lcy5pdGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgT2JqZWN0IG5leHQgPSBpLm5leHQoKTsKCiAgICAgICAgICAg\nIGlmIChuZXh0IGluc3RhbmNlb2YgUHJvcGVydHlMaW5lKSB7CiAgICAgICAg\nICAgICAgICBpZiAoKChQcm9wZXJ0eUxpbmUpIG5leHQpLndyaXRlKHdyaXRl\nciwga2V5cywgbmVlZHNOZXdsaW5lKSkKICAgICAgICAgICAgICAgICAgICBu\nZWVkc05ld2xpbmUgPSBpLmhhc05leHQoKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChuZXh0IGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAg\nICBTdHJpbmcga2V5ID0gKFN0cmluZykgbmV4dDsKICAgICAgICAgICAgICAg\nIGlmIChrZXlzLnJlbW92ZShrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHdyaXRlUHJvcGVydHkoa2V5LCB3cml0ZXIsIG5lZWRzTmV3bGluZSkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmVlZHNOZXdsaW5lID0gaS5o\nYXNOZXh0KCkgJiYga2V5cy5zaXplKCkgPiAwOwoKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gYW55IG5ldyBvciBtb2RpZmllZCBwcm9wZXJ0aWVzIHdp\nbGwgY2F1c2UKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGZpbGUg\ndG8gZW5kIHdpdGggYSBuZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgICAg\nIGVuZFdpdGhOZXdsaW5lID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBlbmQgaW4gYSBuZXdsaW5lIGlmIHRo\nZSBzb3VyY2UgZW5kZWQgaW4gaXQKICAgICAgICBpZiAoZW5kV2l0aE5ld2xp\nbmUpCiAgICAgICAgICAgIHdyaXRlci5wcmludGxuKCk7CgogICAgICAgIHdy\naXRlci5mbHVzaCgpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiB3cml0\nZVByb3BlcnR5KFN0cmluZyBrZXksIFByaW50V3JpdGVyIHdyaXRlciwKICAg\nICAgICBib29sZWFuIG5lZWRzTmV3bGluZSkgewogICAgICAgIFN0cmluZ0J1\naWxkZXIgcyA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CgogICAgICAgIGlmIChr\nZXkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICBTdHJpbmcgdmFsID0gZ2V0UHJvcGVydHkoa2V5KTsKICAgICAgICBpZiAo\ndmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgZm9ybWF0VmFsdWUoa2V5LCBzLCB0cnVlKTsKICAgICAgICBzLmFwcGVu\nZChkZWZhdWx0RW50cnlEZWxpbWl0ZXIpOwogICAgICAgIGlmIChhZGRXaGl0\nZXNwYWNlQWZ0ZXJEZWxpbWl0ZXIpCiAgICAgICAgICAgIHMuYXBwZW5kKCcg\nJyk7CiAgICAgICAgZm9ybWF0VmFsdWUodmFsLCBzLCBmYWxzZSk7CgogICAg\nICAgIGlmIChuZWVkc05ld2xpbmUpCiAgICAgICAgICAgIHdyaXRlci5wcmlu\ndGxuKCk7CgogICAgICAgIHdyaXRlci5wcmludChzKTsKCiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JtYXQgdGhlIGdp\ndmVuIHN0cmluZyBhcyBhbiBlbmNvZGVkIHZhbHVlIGZvciBzdG9yYWdlLiBU\naGlzIHdpbGwKICAgICAqIHBlcmZvcm0gYW55IG5lY2Vzc2FyeSBlc2NhcGlu\nZyBvZiBzcGVjaWFsIGNoYXJhY3RlcnMuCiAgICAgKgogICAgICogQHBhcmFt\nIHN0ciB0aGUgdmFsdWUgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0gYnVmIHRo\nZSBidWZmZXIgdG8gd2hpY2ggdG8gYXBwZW5kIHRoZSBlbmNvZGVkIHZhbHVl\nCiAgICAgKiBAcGFyYW0gaXNLZXkgaWYgdHJ1ZSwgdGhlbiB0aGUgc3RyaW5n\nIGlzIGEgUHJvcGVydHkga2V5LCBvdGhlcndpc2UKICAgICAqIGl0IGlzIGEg\ndmFsdWUKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBmb3JtYXRW\nYWx1ZShTdHJpbmcgc3RyLCBTdHJpbmdCdWlsZGVyIGJ1ZiwKICAgICAgICBi\nb29sZWFuIGlzS2V5KSB7CiAgICAgICAgaWYgKGlzS2V5KSB7CiAgICAgICAg\nICAgIGJ1Zi5zZXRMZW5ndGgoMCk7CiAgICAgICAgICAgIGJ1Zi5lbnN1cmVD\nYXBhY2l0eShzdHIubGVuZ3RoKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIGJ1Zi5lbnN1cmVDYXBhY2l0eShidWYubGVuZ3RoKCkgKyBzdHIu\nbGVuZ3RoKCkpOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBlc2NhcGVT\ncGFjZSA9IHRydWU7CiAgICAgICAgaW50IHNpemUgPSBzdHIubGVuZ3RoKCk7\nCgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAg\nICAgICAgICAgIGNoYXIgYyA9IHN0ci5jaGFyQXQoaSk7CgogICAgICAgICAg\nICBpZiAoYyA9PSAnXG4nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nXFxuIik7CiAgICAgICAgICAgIGVsc2UgaWYgKGMgPT0gJ1xyJykKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxcciIpOwogICAgICAgICAgICBlbHNl\nIGlmIChjID09ICdcdCcpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCJc\nXHQiKTsKICAgICAgICAgICAgZWxzZSBpZiAoYyA9PSAnXGYnKQogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiXFxmIik7CiAgICAgICAgICAgIGVsc2Ug\naWYgKGMgPT0gJyAnKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChlc2Nh\ncGVTcGFjZSA/ICJcXCAiIDogIiAiKTsKICAgICAgICAgICAgZWxzZSBpZiAo\nYyA9PSAnXFwnIHx8IGMgPT0gJyEnIHx8IGMgPT0gJyMnIHx8IGMgPT0gJz0n\nIHx8IGMgPT0gJzonKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgnXFwn\nKS5hcHBlbmQoYyk7CiAgICAgICAgICAgIGVsc2UgaWYgKGMgPCAnICcgfHwg\nYyA+ICd+JykKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxcdTAwMDAi\nLnN1YnN0cmluZygwLCA2IC0gSW50ZWdlci50b0hleFN0cmluZyhjKS4KICAg\nICAgICAgICAgICAgICAgICBsZW5ndGgoKSkpLmFwcGVuZChJbnRlZ2VyLnRv\nSGV4U3RyaW5nKGMpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChjKTsKCiAgICAgICAgICAgIGlmIChjICE9ICcgJykK\nICAgICAgICAgICAgICAgIGVzY2FwZVNwYWNlID0gaXNLZXk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRHVwbGljYXRlS2V5\nRXhjZXB0aW9uIGV4dGVuZHMgUnVudGltZUV4Y2VwdGlvbiB7CgogICAgICAg\nIHB1YmxpYyBEdXBsaWNhdGVLZXlFeGNlcHRpb24oU3RyaW5nIGtleSwgT2Jq\nZWN0IGZpcnN0VmFsLAogICAgICAgICAgICBTdHJpbmcgc2Vjb25kVmFsKSB7\nCiAgICAgICAgICAgIHN1cGVyKF9sb2MuZ2V0KCJkdXAta2V5Iiwga2V5LCBm\naXJzdFZhbCwgc2Vjb25kVmFsKS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnRhaW5zIHRoZSBvcmlnaW5hbCBs\naW5lIG9mIHRoZSBwcm9wZXJ0aWVzIGZpbGU6IGNhbiBiZSBhCiAgICAgKiBw\ncm9wZXIga2V5L3ZhbHVlIHBhaXIsIG9yIGEgY29tbWVudCwgb3IganVzdCB3\naGl0ZXNwYWNlLgogICAgICovCiAgICBwcml2YXRlIGNsYXNzIFByb3BlcnR5\nTGluZSBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHByaXZh\ndGUgZmluYWwgU3RyaW5nQnVpbGRlciBsaW5lID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKTsKICAgICAgICBwcml2YXRlIFN0cmluZyBwcm9wZXJ0eUtleTsKICAg\nICAgICBwcml2YXRlIFN0cmluZyBwcm9wZXJ0eVZhbHVlOwoKICAgICAgICBw\ndWJsaWMgUHJvcGVydHlMaW5lKFN0cmluZyBsaW5lKSB7CiAgICAgICAgICAg\nIHRoaXMubGluZS5hcHBlbmQobGluZSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBhcHBlbmQoU3RyaW5nIG5ld2xpbmUpIHsKICAgICAgICAg\nICAgbGluZS5hcHBlbmQoSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRv\ncigpKTsKICAgICAgICAgICAgbGluZS5hcHBlbmQobmV3bGluZSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXRQcm9wZXJ0eUtleShTdHJp\nbmcgcHJvcGVydHlLZXkpIHsKICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eUtl\neSA9IHByb3BlcnR5S2V5OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0\ncmluZyBnZXRQcm9wZXJ0eUtleSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRo\naXMucHJvcGVydHlLZXk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBzZXRQcm9wZXJ0eVZhbHVlKFN0cmluZyBwcm9wZXJ0eVZhbHVlKSB7CiAg\nICAgICAgICAgIHRoaXMucHJvcGVydHlWYWx1ZSA9IHByb3BlcnR5VmFsdWU7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFByb3BlcnR5\nVmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BlcnR5VmFs\ndWU7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBXcml0ZSB0\naGUgZ2l2ZW4gbGluZS4gSXQgd2lsbCBvbmx5IGJlIHdyaXR0ZW4gaWYgdGhl\nIGxpbmUgaXMgYQogICAgICAgICAqIGNvbW1lbnQsIG9yIGlmIGl0IGlzIGEg\ncHJvcGVydHkgYW5kIGl0cyB2YWx1ZSBpcyB1bmNoYW5nZWQKICAgICAgICAg\nKiBmcm9tIHRoZSBvcmlnaW5hbC4KICAgICAgICAgKgogICAgICAgICAqIEBw\nYXJhbSBwdyB0aGUgUHJpbnRXcml0ZXIgdG8gd2hpY2ggdGhlIHdyaXRlCiAg\nICAgICAgICogQHJldHVybiB3aGV0aGVyIG9yIG5vdCB0aGlzIHdhcyBhIGtu\nb3duIGtleQogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBib29sZWFuIHdy\naXRlKFByaW50V3JpdGVyIHB3LCBDb2xsZWN0aW9uIGtleXMsCiAgICAgICAg\nICAgIGJvb2xlYW4gbmVlZHNOZXdsaW5lKSB7CiAgICAgICAgICAgIC8vIG5v\nIHByb3BlcnR5PyBJdCBtYXkgYmUgYSBjb21tZW50IG9yIGp1c3Qgd2hpdGVz\ncGFjZQogICAgICAgICAgICBpZiAocHJvcGVydHlLZXkgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKG5lZWRzTmV3bGluZSkKICAgICAgICAgICAg\nICAgICAgICBwdy5wcmludGxuKCk7CiAgICAgICAgICAgICAgICBwdy5wcmlu\ndChsaW5lLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNoZWNrIHRvIHNl\nZSBpZiB3ZSBhcmUgdGhlIHNhbWUgdmFsdWUgd2UgaW5pdGlhbGx5IHJlYWQ6\nCiAgICAgICAgICAgIC8vIGlmIHNvLCB0aGVuIGp1c3Qgd3JpdGUgaXQgYmFj\nayBleGFjdGx5IGFzIGl0IHdhcyByZWFkCiAgICAgICAgICAgIGlmIChwcm9w\nZXJ0eVZhbHVlICE9IG51bGwgJiYgY29udGFpbnNLZXkocHJvcGVydHlLZXkp\nICYmCiAgICAgICAgICAgICAgICAocHJvcGVydHlWYWx1ZS5lcXVhbHMoZ2V0\nUHJvcGVydHkocHJvcGVydHlLZXkpKSB8fAogICAgICAgICAgICAgICAgICAg\nICghbmV3S2V5cy5jb250YWlucyhwcm9wZXJ0eUtleSkgJiYKICAgICAgICAg\nICAgICAgICAgICAgICAgIW1vZGlmaWVkS2V5cy5jb250YWlucyhwcm9wZXJ0\neUtleSkpKSkgewogICAgICAgICAgICAgICAgaWYgKG5lZWRzTmV3bGluZSkK\nICAgICAgICAgICAgICAgICAgICBwdy5wcmludGxuKCk7CiAgICAgICAgICAg\nICAgICBwdy5wcmludChsaW5lLnRvU3RyaW5nKCkpOwoKICAgICAgICAgICAg\nICAgIGtleXMucmVtb3ZlKHByb3BlcnR5S2V5KTsKCiAgICAgICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\naWYgd2UgaGF2ZSBtb2RpZmllZCBvciBhZGRlZCB0aGUgc3BlY2lmaWVkIGtl\neSwgdGhlbiB3cml0ZQogICAgICAgICAgICAvLyBpdCBiYWNrIHRvIHRoZSBz\nYW1lIGxvY2F0aW9uIGluIHRoZSBmaWxlIGZyb20gd2hpY2ggaXQKICAgICAg\nICAgICAgLy8gd2FzIG9yaWdpbmFsbHkgcmVhZCwgc28gdGhhdCBpdCB3aWxs\nIGJlIGluIHRoZSBwcm94aW1pdHkKICAgICAgICAgICAgLy8gdG8gdGhlIGNv\nbW1lbnQKICAgICAgICAgICAgaWYgKGNvbnRhaW5zS2V5KHByb3BlcnR5S2V5\nKSAmJgogICAgICAgICAgICAgICAgKG1vZGlmaWVkS2V5cy5jb250YWlucyhw\ncm9wZXJ0eUtleSkgfHwKICAgICAgICAgICAgICAgICAgICBuZXdLZXlzLmNv\nbnRhaW5zKHByb3BlcnR5S2V5KSkpIHsKICAgICAgICAgICAgICAgIHdoaWxl\nIChrZXlzLnJlbW92ZShwcm9wZXJ0eUtleSkpIDsKICAgICAgICAgICAgICAg\nIHJldHVybiB3cml0ZVByb3BlcnR5KHByb3BlcnR5S2V5LCBwdywgbmVlZHNO\nZXdsaW5lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gdGhpcyBp\ncyBhIG5ldyBvciBjaGFuZ2VkIHByb3BlcnR5OiBkb24ndCBkbyBhbnl0aGlu\nZwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgY2xhc3MgUHJvcGVydHlMaW5lUmVhZGVyIGV4dGVuZHMg\nQnVmZmVyZWRSZWFkZXIgewoKICAgICAgICBwdWJsaWMgUHJvcGVydHlMaW5l\nUmVhZGVyKElucHV0U3RyZWFtIGluLCBQcm9wZXJ0eVNvdXJjZSBzb3VyY2Up\nCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIC8vIE11c3QgYmUgSVNPLTg4NTktMSBlY29kaW5nIGFjY29yZGluZyB0byBQ\ncm9wZXJ0aWVzLmxvYWQgamF2YWRvYwogICAgICAgICAgICBzdXBlcihuZXcg\nSW5wdXRTdHJlYW1SZWFkZXIobmV3IExpbmVFbmRpbmdTdHJlYW0oaW4sIHNv\ndXJjZSksCiAgICAgICAgICAgICAgICAiSVNPLTg4NTktMSIpKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBQcm9wZXJ0eUxpbmUgcmVhZFByb3BlcnR5\nTGluZSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIFN0cmlu\nZyBsID0gcmVhZExpbmUoKTsKICAgICAgICAgICAgaWYgKGwgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgUHJv\ncGVydHlMaW5lIHBsID0gbmV3IFByb3BlcnR5TGluZShsKTsKICAgICAgICAg\nICAgcmV0dXJuIHBsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFNpbXBsZSBGaWx0ZXJJbnB1dFN0cmVhbSB0aGF0IG1lcmVseSByZW1lbWJl\ncnMgaWYgdGhlIGxhc3QKICAgICAqIGNoYXJhY3RlciB0aGF0IGl0IHJlYWQg\nd2FzIGEgbmV3bGluZSBvciBub3QuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGNsYXNzIExpbmVFbmRpbmdTdHJlYW0gZXh0ZW5kcyBGaWx0ZXJJbnB1\ndFN0cmVhbSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUHJvcGVydHlTb3Vy\nY2Ugc291cmNlOwoKICAgICAgICBMaW5lRW5kaW5nU3RyZWFtKElucHV0U3Ry\nZWFtIGluLCBQcm9wZXJ0eVNvdXJjZSBzb3VyY2UpIHsKICAgICAgICAgICAg\nc3VwZXIoaW4pOwoKICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHJlYWQoKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgICAgICBpbnQgYyA9IHN1cGVyLnJlYWQo\nKTsKICAgICAgICAgICAgc291cmNlLmVuZHNJbk5ld2xpbmUgPSAoYyA9PSAn\nXG4nIHx8IGMgPT0gJ1xyJyk7CiAgICAgICAgICAgIHJldHVybiBjOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCByZWFkKGJ5dGVbXSBiLCBpbnQg\nb2ZmLCBpbnQgbGVuKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAg\nICBpbnQgbiA9IHN1cGVyLnJlYWQoYiwgb2ZmLCBsZW4pOwogICAgICAgICAg\nICBpZiAobiA+IDApCiAgICAgICAgICAgICAgICBzb3VyY2UuZW5kc0luTmV3\nbGluZSA9CiAgICAgICAgICAgICAgICAgICAgKGJbbiArIG9mZiAtIDFdID09\nICdcbicgfHwgYltuICsgb2ZmIC0gMV0gPT0gJ1xyJyk7CiAgICAgICAgICAg\nIHJldHVybiBuOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgY2xhc3Mg\nUHJvcGVydHlTb3VyY2UgZXh0ZW5kcyBMaW5rZWRMaXN0CiAgICAgICAgaW1w\nbGVtZW50cyBDbG9uZWFibGUsIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHBy\naXZhdGUgYm9vbGVhbiBlbmRzSW5OZXdsaW5lID0gZmFsc2U7CiAgICB9Cn0K\n","encoding":"base64"}

