{"sha":"a07b934a7b29a5ca157588fd58c7e2ba713fb98f","node_id":"MDQ6QmxvYjIwNjM2NDphMDdiOTM0YTdiMjlhNWNhMTU3NTg4ZmQ1OGM3ZTJiYTcxM2ZiOThm","size":71563,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a07b934a7b29a5ca157588fd58c7e2ba713fb98f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBz\ndGF0aWMgamF2YXgucGVyc2lzdGVuY2UuR2VuZXJhdGlvblR5cGUuQVVUTzsK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2Uu\nTWV0YURhdGFUYWcuKjsKCmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBq\nYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0\naW9uLkFubm90YXRpb247CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Bbm5v\ndGF0ZWRFbGVtZW50OwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZW1iZXI7CmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVj\ndC5Nb2RpZmllcjsKaW1wb3J0IGphdmEubmV0LlVSSVN5bnRheEV4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmV0LlVSTDsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVl\nU2V0OwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkFjY2VzczsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkFjY2Vzc1R5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5CYXNpYzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkNh\nY2hlYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkNhc2NhZGVUeXBl\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRWxlbWVudENvbGxlY3Rpb247\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5FbWJlZGRlZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nRW50aXR5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVu\nZXJzOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRM\naXN0ZW5lcnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3Vw\nZXJjbGFzc0xpc3RlbmVyczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZl\ndGNoVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5\ncGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwoKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLklkOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuSWRDbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkxvYjsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hbnlUb01hbnk7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9PbmU7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5NYXBLZXk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBL\nZXlDbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHNJZDsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xhc3M7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJpZXM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyaWVzOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuTmFtZWRRdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLk9uZVRvTWFueTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk9uZVRv\nT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT3JkZXJCeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlBvc3RMb2FkOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuUG9zdFBlcnNpc3Q7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5Qb3N0UmVtb3ZlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdFVw\nZGF0ZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVBlcnNpc3Q7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmVSZW1vdmU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5QcmVVcGRhdGU7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5RdWVyeUhpbnQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZXF1\nZW5jZUdlbmVyYXRvcjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlZlcnNp\nb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRp\nbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5C\nZWFuTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LkxpZmVjeWNsZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5NZXRob2RMaWZlY3ljbGVDYWxsYmFja3M7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3Vh\nZ2VzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5qcHFsLkpQ\nUUxQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYu\nQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEu\nU291cmNlVHJhY2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5BY2Nlc3NDb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkRlbGVnYXRpbmdNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rvcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1vZGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuT3JkZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0ZVN0cmF0ZWdp\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJh\ndGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhl\nbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFs\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0\nYURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgppbXBvcnQgc2VycC51dGlsLk51\nbWJlcnM7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBQZXJz\naXN0ZW5jZSBhbm5vdGF0aW9uIG1ldGFkYXRhIHBhcnNlci4gQ3VycmVudGx5\nIGRvZXMgbm90IHBhcnNlCiAqIGRlcGxveW1lbnQgZGVzY3JpcHRvcnMuCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RldmUgS2ltCiAq\nIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBBbm5vdGF0aW9uUGVyc2lz\ndGVuY2VNZXRhRGF0YVBhcnNlcgogICAgaW1wbGVtZW50cyBNZXRhRGF0YU1v\nZGVzIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEFubm90YXRpb25Q\nZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2VyLmNsYXNzKTsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBNYXA8Q2xhc3M8Pz4sIE1ldGFEYXRhVGFnPiBfdGFn\ncyA9CiAgICAgICAgbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE1ldGFEYXRhVGFn\nPigpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX3RhZ3MucHV0KEFjY2Vzcy5j\nbGFzcywgQUNDRVNTKTsKICAgICAgICBfdGFncy5wdXQoQ2FjaGVhYmxlLmNs\nYXNzLCBDQUNIRUFCTEUpOwogICAgICAgIF90YWdzLnB1dChFbWJlZGRlZElk\nLmNsYXNzLCBFTUJFRERFRF9JRCk7CiAgICAgICAgX3RhZ3MucHV0KEVudGl0\neUxpc3RlbmVycy5jbGFzcywgRU5USVRZX0xJU1RFTkVSUyk7CiAgICAgICAg\nX3RhZ3MucHV0KEV4Y2x1ZGVEZWZhdWx0TGlzdGVuZXJzLmNsYXNzLCBFWENM\nVURFX0RFRkFVTFRfTElTVEVORVJTKTsKICAgICAgICBfdGFncy5wdXQoRXhj\nbHVkZVN1cGVyY2xhc3NMaXN0ZW5lcnMuY2xhc3MsCiAgICAgICAgICAgIEVY\nQ0xVREVfU1VQRVJDTEFTU19MSVNURU5FUlMpOwogICAgICAgIF90YWdzLnB1\ndChGbHVzaE1vZGVUeXBlLmNsYXNzLCBGTFVTSF9NT0RFKTsKICAgICAgICBf\ndGFncy5wdXQoR2VuZXJhdGVkVmFsdWUuY2xhc3MsIEdFTkVSQVRFRF9WQUxV\nRSk7CiAgICAgICAgX3RhZ3MucHV0KElkLmNsYXNzLCBJRCk7CiAgICAgICAg\nX3RhZ3MucHV0KElkQ2xhc3MuY2xhc3MsIElEX0NMQVNTKTsKICAgICAgICBf\ndGFncy5wdXQoTWFwS2V5LmNsYXNzLCBNQVBfS0VZKTsKICAgICAgICBfdGFn\ncy5wdXQoTWFwS2V5Q2xhc3MuY2xhc3MsIE1BUF9LRVlfQ0xBU1MpOwogICAg\nICAgIF90YWdzLnB1dChNYXBzSWQuY2xhc3MsIE1BUFBFRF9CWV9JRCk7CiAg\nICAgICAgX3RhZ3MucHV0KE5hbWVkTmF0aXZlUXVlcmllcy5jbGFzcywgTkFU\nSVZFX1FVRVJJRVMpOwogICAgICAgIF90YWdzLnB1dChOYW1lZE5hdGl2ZVF1\nZXJ5LmNsYXNzLCBOQVRJVkVfUVVFUlkpOwogICAgICAgIF90YWdzLnB1dChO\nYW1lZFF1ZXJpZXMuY2xhc3MsIFFVRVJJRVMpOwogICAgICAgIF90YWdzLnB1\ndChOYW1lZFF1ZXJ5LmNsYXNzLCBRVUVSWSk7CiAgICAgICAgX3RhZ3MucHV0\nKE9yZGVyQnkuY2xhc3MsIE9SREVSX0JZKTsKICAgICAgICBfdGFncy5wdXQo\nUG9zdExvYWQuY2xhc3MsIFBPU1RfTE9BRCk7CiAgICAgICAgX3RhZ3MucHV0\nKFBvc3RQZXJzaXN0LmNsYXNzLCBQT1NUX1BFUlNJU1QpOwogICAgICAgIF90\nYWdzLnB1dChQb3N0UmVtb3ZlLmNsYXNzLCBQT1NUX1JFTU9WRSk7CiAgICAg\nICAgX3RhZ3MucHV0KFBvc3RVcGRhdGUuY2xhc3MsIFBPU1RfVVBEQVRFKTsK\nICAgICAgICBfdGFncy5wdXQoUHJlUGVyc2lzdC5jbGFzcywgUFJFX1BFUlNJ\nU1QpOwogICAgICAgIF90YWdzLnB1dChQcmVSZW1vdmUuY2xhc3MsIFBSRV9S\nRU1PVkUpOwogICAgICAgIF90YWdzLnB1dChQcmVVcGRhdGUuY2xhc3MsIFBS\nRV9VUERBVEUpOwogICAgICAgIF90YWdzLnB1dChTZXF1ZW5jZUdlbmVyYXRv\nci5jbGFzcywgU0VRX0dFTkVSQVRPUik7CiAgICAgICAgX3RhZ3MucHV0KFZl\ncnNpb24uY2xhc3MsIFZFUlNJT04pOwogICAgICAgIF90YWdzLnB1dChEYXRh\nQ2FjaGUuY2xhc3MsIERBVEFfQ0FDSEUpOwogICAgICAgIF90YWdzLnB1dChE\nYXRhU3RvcmVJZC5jbGFzcywgREFUQVNUT1JFX0lEKTsKICAgICAgICBfdGFn\ncy5wdXQoRGVwZW5kZW50LmNsYXNzLCBERVBFTkRFTlQpOwogICAgICAgIF90\nYWdzLnB1dChEZXRhY2hlZFN0YXRlLmNsYXNzLCBERVRBQ0hFRF9TVEFURSk7\nCiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnREZXBlbmRlbnQuY2xhc3MsIEVM\nRU1fREVQRU5ERU5UKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudFR5cGUu\nY2xhc3MsIEVMRU1fVFlQRSk7CiAgICAgICAgX3RhZ3MucHV0KEV4dGVybmFs\nVmFsdWVzLmNsYXNzLCBFWFRFUk5BTF9WQUxTKTsKICAgICAgICBfdGFncy5w\ndXQoRXh0ZXJuYWxpemVyLmNsYXNzLCBFWFRFUk5BTElaRVIpOwogICAgICAg\nIF90YWdzLnB1dChGYWN0b3J5LmNsYXNzLCBGQUNUT1JZKTsKICAgICAgICBf\ndGFncy5wdXQoRmV0Y2hHcm91cC5jbGFzcywgRkVUQ0hfR1JPVVApOwogICAg\nICAgIF90YWdzLnB1dChGZXRjaEdyb3Vwcy5jbGFzcywgRkVUQ0hfR1JPVVBT\nKTsKICAgICAgICBfdGFncy5wdXQoSW52ZXJzZUxvZ2ljYWwuY2xhc3MsIElO\nVkVSU0VfTE9HSUNBTCk7CiAgICAgICAgX3RhZ3MucHV0KEtleURlcGVuZGVu\ndC5jbGFzcywgS0VZX0RFUEVOREVOVCk7CiAgICAgICAgX3RhZ3MucHV0KEtl\neVR5cGUuY2xhc3MsIEtFWV9UWVBFKTsKICAgICAgICBfdGFncy5wdXQoTG9h\nZEZldGNoR3JvdXAuY2xhc3MsIExPQURfRkVUQ0hfR1JPVVApOwogICAgICAg\nIF90YWdzLnB1dChMUlMuY2xhc3MsIExSUyk7CiAgICAgICAgX3RhZ3MucHV0\nKE1hbmFnZWRJbnRlcmZhY2UuY2xhc3MsIE1BTkFHRURfSU5URVJGQUNFKTsK\nICAgICAgICBfdGFncy5wdXQoUmVhZE9ubHkuY2xhc3MsIFJFQURfT05MWSk7\nCiAgICAgICAgX3RhZ3MucHV0KFR5cGUuY2xhc3MsIFRZUEUpOwogICAgICAg\nIF90YWdzLnB1dChSZXBsaWNhdGVkLmNsYXNzLCBSRVBMSUNBVEVEKTsKICAg\nIH0KCiAgICBwcml2YXRlIGZpbmFsIE9wZW5KUEFDb25maWd1cmF0aW9uIF9j\nb25mOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cgX2xvZzsKICAgIHByaXZhdGUg\nTWV0YURhdGFSZXBvc2l0b3J5IF9yZXBvcyA9IG51bGw7CiAgICBwcml2YXRl\nIENsYXNzTG9hZGVyIF9lbnZMb2FkZXIgPSBudWxsOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9vdmVycmlkZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX21v\nZGUgPSBNT0RFX05PTkU7CgogICAgLy8gcGFja2FnZXMgYW5kIHRoZWlyIHBh\ncnNlIG1vZGVzCiAgICBwcml2YXRlIGZpbmFsIE1hcDxQYWNrYWdlLCBJbnRl\nZ2VyPiBfcGtncyA9IG5ldyBIYXNoTWFwPFBhY2thZ2UsIEludGVnZXI+KCk7\nCgogICAgLy8gdGhlIGNsYXNzIHdlIHdlcmUgaW52b2tlZCB0byBwYXJzZQog\nICAgcHJvdGVjdGVkIENsYXNzPD8+IF9jbHMgPSBudWxsOwogICAgcHJvdGVj\ndGVkIFN0YWNrPENsYXNzPD8+PiBfc3RhY2sgPSBuZXcgU3RhY2s8Q2xhc3M8\nPz4+KCk7CiAgICBwcml2YXRlIEZpbGUgX2ZpbGUgPSBudWxsOwoKICAgIC8q\nKgogICAgICogQ29uc3RydWN0b3I7IHN1cHBseSBjb25maWd1cmF0aW9uLgog\nICAgICovCiAgICBwdWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURh\ndGFQYXJzZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAg\nIF9jb25mID0gY29uZjsKICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24uTE9HX01FVEFEQVRBKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbmZpZ3VyYXRpb24gc3VwcGxpZWQgb24gY29uc3RydWN0\naW9uLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24g\nZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBsb2cuCiAgICAgKi8KICAg\nIHB1YmxpYyBMb2cgZ2V0TG9nKCkgewogICAgICAgIHJldHVybiBfbG9nOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgcmVwb3NpdG9yeSBm\nb3IgdGhpcyBwYXJzZXIuIElmIG5vbmUgaGFzIGJlZW4gc2V0LAogICAgICog\nY3JlYXRlIGEgbmV3IHJlcG9zaXRvcnkgYW5kIHNldHMgaXQuCiAgICAgKi8K\nICAgIHB1YmxpYyBNZXRhRGF0YVJlcG9zaXRvcnkgZ2V0UmVwb3NpdG9yeSgp\nIHsKICAgICAgICBpZiAoX3JlcG9zID09IG51bGwpIHsKICAgICAgICAgICAg\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYubmV3TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgTWV0YURhdGFGYWN0\nb3J5IG1kZiA9IHJlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpOwogICAgICAg\nICAgICBpZiAobWRmIGluc3RhbmNlb2YgRGVsZWdhdGluZ01ldGFEYXRhRmFj\ndG9yeSkKICAgICAgICAgICAgICAgIG1kZiA9ICgoRGVsZWdhdGluZ01ldGFE\nYXRhRmFjdG9yeSkgbWRmKS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAg\nICAgICAgICBpZiAobWRmIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VNZXRhRGF0\nYUZhY3RvcnkpCiAgICAgICAgICAgICAgICAoKFBlcnNpc3RlbmNlTWV0YURh\ndGFGYWN0b3J5KSBtZGYpLnNldEFubm90YXRpb25QYXJzZXIodGhpcyk7CiAg\nICAgICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX3JlcG9zOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBt\nZXRhZGF0YSByZXBvc2l0b3J5IGZvciB0aGlzIHBhcnNlci4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0UmVwb3NpdG9yeShNZXRhRGF0YVJlcG9zaXRv\ncnkgcmVwb3MpIHsKICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBs\nb2FkZXIgdG8gcGFzcyBvbiB0byBwYXJzZWQKICAgICAqIG1ldGFkYXRhIGlu\nc3RhbmNlcy4KICAgICAqLwogICAgcHVibGljIENsYXNzTG9hZGVyIGdldEVu\ndkNsYXNzTG9hZGVyKCkgewogICAgICAgIHJldHVybiBfZW52TG9hZGVyOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBlbnZpcm9ubWVudGFsIGNs\nYXNzIGxvYWRlciB0byBwYXNzIG9uIHRvIHBhcnNlZAogICAgICogbWV0YWRh\ndGEgaW5zdGFuY2VzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbnZD\nbGFzc0xvYWRlcihDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfZW52\nTG9hZGVyID0gbG9hZGVyOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0byBhbGxvdyBsYXRlciBwYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlv\nbiB0byBvdmVycmlkZQogICAgICogZWFybGllciBpbmZvcm1hdGlvbiBmb3Ig\ndGhlIHNhbWUgY2xhc3MuIERlZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAg\nICAqIHdoZW4gYSB0b29sIGlzIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBh\nbm5vdGF0aW9uIHBhcnRpYWwgbWFwcGluZwogICAgICogaW5mb3JtYXRpb24g\nY2FuIGJlIHVzZWQgZXZlbiB3aGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4g\nYW5vdGhlcgogICAgICogbG9jYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGdldE1hcHBpbmdPdmVycmlkZSgpIHsKICAgICAgICByZXR1cm4g\nX292ZXJyaWRlOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBh\nbGxvdyBsYXRlciBwYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlvbiB0byBv\ndmVycmlkZQogICAgICogZWFybGllciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNh\nbWUgY2xhc3MuIERlZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAgICAqIHdo\nZW4gYSB0b29sIGlzIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBhbm5vdGF0\naW9uIHBhcnRpYWwgbWFwcGluZwogICAgICogaW5mb3JtYXRpb24gY2FuIGJl\nIHVzZWQgZXZlbiB3aGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4gYW5vdGhl\ncgogICAgICogbG9jYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndE1hcHBpbmdPdmVycmlkZShib29sZWFuIG92ZXJyaWRlKSB7CiAgICAgICAg\nX292ZXJyaWRlID0gb3ZlcnJpZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgcGFyc2UgbW9kZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRNb2Rl\nKCkgewogICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBwYXJzZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRNb2RlKGludCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1v\nZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAgICBfbW9kZSA9IE1PREVfTk9O\nRTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX21vZGUgfD0g\nbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9tb2RlICY9IH5tb2Rl\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldE1vZGUoaW50IG1vZGUpIHsKICAgICAg\nICBfbW9kZSA9IG1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01ldGFEYXRhTW9k\nZSgpIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTU9ERV9NRVRBKSAhPSAw\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZv\nciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gaXNRdWVyeU1vZGUoKSB7CiAgICAgICAgcmV0\ndXJuIChfbW9kZSAmIE1PREVfUVVFUlkpICE9IDA7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7\nQGxpbmsgI2dldE1vZGV9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBpc01hcHBpbmdNb2RlKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBN\nT0RFX01BUFBJTkcpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRydWUgaWYgd2UncmUgaW4gbWFwcGluZyBtb2RlIG9yIGluIG1ldGFk\nYXRhIG1vZGUgd2l0aAogICAgICogbWFwcGluZyBvdmVyaWRlIGVuYWJsZWQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzTWFwcGluZ092ZXJy\naWRlTW9kZSgpIHsKICAgICAgICByZXR1cm4gaXNNYXBwaW5nTW9kZSgpIHx8\nIChfb3ZlcnJpZGUgJiYgaXNNZXRhRGF0YU1vZGUoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDbGVhciBjYWNoZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGNsZWFyKCkgewogICAgCV9zdGFjay5jbGVhcigpOwogICAgICAgIF9j\nbHMgPSBudWxsOwogICAgICAgIF9maWxlID0gbnVsbDsKICAgICAgICBfcGtn\ncy5jbGVhcigpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgcGVyc2lz\ndGVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgcGFyc2UoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgicGFyc2UtY2xhc3MiLCBjbHMuZ2V0TmFtZSgpKSk7\nCgogICAgICAgIF9jbHMgPSBjbHM7CiAgICAgICAgX3N0YWNrLnB1c2goY2xz\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBwYXJzZVBhY2thZ2VBbm5v\ndGF0aW9ucygpOwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBw\nYXJzZUNsYXNzQW5ub3RhdGlvbnMoKTsKICAgICAgICAgICAgdXBkYXRlU291\ncmNlTW9kZShtZXRhKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgIAlf\nc3RhY2sucG9wKCk7CiAgICAgICAgICAgIF9jbHMgPSBfc3RhY2suaXNFbXB0\neSgpID8gbnVsbCA6IF9zdGFjay5wZWVrKCk7CiAgICAgICAgICAgIF9maWxl\nID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRh\ndGUgdGhlIHNvdXJjZSBtb2RlIHRvIHRoZSBjbGFzcyBwYWNrYWdlIGFuZCBj\nbGFzcyB0byBpbmRpY2F0ZSB0aGF0CiAgICAgKiB3ZSd2ZSBmdWxseSBwYXJz\nZWQgdGhlbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZVNvdXJj\nZU1vZGUoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKF9jbHMu\nZ2V0UGFja2FnZSgpICE9IG51bGwpCiAgICAgICAgICAgIGFkZFNvdXJjZU1v\nZGUoX2Nscy5nZXRQYWNrYWdlKCksIF9tb2RlKTsKICAgICAgICBpZiAobWV0\nYSAhPSBudWxsKQogICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoX21v\nZGUsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgaW5mb3Jt\nYXRpb24gaW4gcGFja2FnZS1sZXZlbCBjbGFzcyBhbm5vdGF0aW9ucy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGFja2FnZUFubm90YXRpb25z\nKCkgewogICAgICAgIFBhY2thZ2UgcGtnID0gX2Nscy5nZXRQYWNrYWdlKCk7\nCiAgICAgICAgaWYgKHBrZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGludCBwa2dNb2RlID0gZ2V0U291cmNlTW9kZShwa2cpOwog\nICAgICAgIGlmIChwa2dNb2RlID09IDAgJiYgX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1w\nYWNrYWdlIiwgX2Nscy5nZXROYW1lKCkpKTsKICAgICAgICBpZiAoKHBrZ01v\nZGUgJiBfbW9kZSkgPT0gX21vZGUpIC8vIGFscmVhZHkgdmlzaXRlZAogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIE1ldGFEYXRhVGFnIHRhZzsKICAg\nICAgICBmb3IgKEFubm90YXRpb24gYW5ubyA6IHBrZy5nZXREZWNsYXJlZEFu\nbm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFnID0gX3RhZ3MuZ2V0KGFu\nbm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgIGlmICh0YWcgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxlVW5rbm93blBhY2thZ2VB\nbm5vdGF0aW9uKHBrZywgYW5ubyk7CiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgTkFUSVZFX1FVRVJJRVM6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKHBrZ01vZGUgJiBN\nT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJz\nZU5hbWVkTmF0aXZlUXVlcmllcyhwa2csCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAoKE5hbWVkTmF0aXZlUXVlcmllcykgYW5ubykudmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIE5BVElWRV9RVUVSWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNR\ndWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVz\nKHBrZywgKE5hbWVkTmF0aXZlUXVlcnkpIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBRVUVSSUVTOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dN\nb2RlICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAg\nICAgcGFyc2VOYW1lZFF1ZXJpZXMocGtnLCAoKE5hbWVkUXVlcmllcykgYW5u\nbykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFFVRVJZOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9RVUVSWSkgPT0g\nMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMo\ncGtnLCAoTmFtZWRRdWVyeSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNFUV9HRU5FUkFUT1I6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgp\nICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChwa2dNb2RlICYgTU9ERV9N\nQVBQSU5HKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZVNl\ncXVlbmNlR2VuZXJhdG9yKHBrZywgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIHBrZywK\nICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFsd2F5cyBwYXJz\nZSBtYXBwaW5nIHN0dWZmIGFmdGVyIG1ldGFkYXRhIHN0dWZmLCBpbiBjYXNl\nIHRoZXJlIGFyZQogICAgICAgIC8vIGRlcGVuZGVuY2llcyBvbiBtZXRhZGF0\nYQogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJiAocGtn\nTW9kZSAmIE1PREVfTUFQUElORykgPT0gMCkKICAgICAgICAgICAgcGFyc2VQ\nYWNrYWdlTWFwcGluZ0Fubm90YXRpb25zKHBrZyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBwYWNrYWdlIG1hcHBpbmcgYW5ub3RhdGlvbnMuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlUGFja2FnZU1hcHBpbmdB\nbm5vdGF0aW9ucyhQYWNrYWdlIHBrZykgewogICAgfQoKICAgIC8qKgogICAg\nICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93biBhbm5vdGF0\naW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFuZGxlVW5r\nbm93blBhY2thZ2VBbm5vdGF0aW9uKFBhY2thZ2UgcGtnLAogICAgICAgIEFu\nbm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSBmb3IgdGhlIGdpdmVu\nIHBhY2thZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldFNvdXJjZU1v\nZGUoUGFja2FnZSBwa2cpIHsKICAgICAgICBOdW1iZXIgbnVtID0gX3BrZ3Mu\nZ2V0KHBrZyk7CiAgICAgICAgcmV0dXJuIChudW0gPT0gbnVsbCkgPyAwIDog\nbnVtLmludFZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdG8g\ndGhlIHNvdXJjZSBtb2RlIGZvciB0aGUgZ2l2ZW4gcGFja2FnZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNvdXJjZU1vZGUoUGFja2FnZSBwa2cs\nIGludCBtb2RlKSB7CiAgICAgICAgSW50ZWdlciBudW0gPSBfcGtncy5nZXQo\ncGtnKTsKICAgICAgICBpZiAobnVtID09IG51bGwpCiAgICAgICAgICAgIG51\nbSA9IE51bWJlcnMudmFsdWVPZihtb2RlKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIG51bSA9IE51bWJlcnMudmFsdWVPZihudW0uaW50VmFsdWUoKSB8\nIG1vZGUpOwogICAgICAgIF9wa2dzLnB1dChwa2csIG51bSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWFkIGFubm90YXRpb25zIGZvciB0aGUgY3VycmVu\ndCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgcGFy\nc2VDbGFzc0Fubm90YXRpb25zKCkgewogICAgICAgIC8vIENoZWNrIHRvIHNl\nZSBpZiB0aGVyZSBpcyBjYWNoZWQgbWV0YWRhdGEgZm9yIHRoZSBjbGFzcyB0\naGF0IHdlIGFyZSBjdXJyZW50bHkgcGFyc2luZy4gSXQKICAgICAgICAvLyBp\ncyBwb3NzaWJsZSB0aGF0IG9uZSBvZiB0aGUgYW5ub3RhdGlvbnMgKEVudGl0\neSwgRW1iZWRkYWJsZSwgTWFwcGVkU3VwZXJjbGFzcykgaXMgaW4gdGhlCiAg\nICAgICAgLy8gb3JtLnhtbC4gV2Ugc3RpbGwgbmVlZCB0byBsb29rIGF0IHRo\nZXNlIGZpbGVzIGZvciBvdGhlciBhbm5vdGF0aW9ucyBhbmQgbW9yZSBpbXBv\ncnRhbnRseQogICAgICAgIC8vIHNldHVwIGRlZmF1bHRzIChpZTogQmFzaWMg\nZmllbGRzKS4KICAgICAgICBDbGFzc01ldGFEYXRhIG0gPSBnZXRSZXBvc2l0\nb3J5KCkuZ2V0Q2FjaGVkTWV0YURhdGEoX2Nscyk7CiAgICAgICAgaWYgKG0g\nPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIShBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5pc0Fubm90YXRpb25QcmVz\nZW50QWN0aW9uKF9jbHMsIEVudGl0eS5jbGFzcykpKQogICAgICAgICAgICAg\nICAgLmJvb2xlYW5WYWx1ZSgpCiAgICAgICAgICAgICAgICAmJiAhKEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyLmlzQW5u\nb3RhdGlvblByZXNlbnRBY3Rpb24oX2NscywgRW1iZWRkYWJsZS5jbGFzcykp\nKQogICAgICAgICAgICAgICAgICAgIC5ib29sZWFuVmFsdWUoKQogICAgICAg\nICAgICAgICAgJiYgIShBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChK\nMkRvUHJpdkhlbHBlci5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKF9jbHMs\nCiAgICAgICAgICAgICAgICAgICAgTWFwcGVkU3VwZXJjbGFzcy5jbGFzcykp\nKS5ib29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KICAgICAgICAvLyBmaW5kIC8gY3JlYXRlIG1ldGFkYXRh\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gKG0gPT0gbnVsbCkgPyBn\nZXRNZXRhRGF0YSgpIDogbTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRW50aXR5IGVudGl0\neSA9IF9jbHMuZ2V0QW5ub3RhdGlvbihFbnRpdHkuY2xhc3MpOwogICAgICAg\nIE1hcHBlZFN1cGVyY2xhc3MgbWFwcGVkID0gX2Nscy5nZXRBbm5vdGF0aW9u\nKE1hcHBlZFN1cGVyY2xhc3MuY2xhc3MpOwogICAgICAgIEVtYmVkZGFibGUg\nZW1iZWRkYWJsZSA9IF9jbHMuZ2V0QW5ub3RhdGlvbihFbWJlZGRhYmxlLmNs\nYXNzKTsKICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAgICAg\nICAgICBtZXRhLnNldEFic3RyYWN0KG1hcHBlZCAhPSBudWxsKTsKICAgICAg\nICAgICAgaWYgKGVtYmVkZGFibGUgIT0gbnVsbCkgbWV0YS5zZXRFbWJlZGRh\nYmxlKCk7CiAgICAgICAgICAgIC8vIHdoaWxlIHRoZSBzcGVjIG9ubHkgcHJv\ndmlkZXMgZm9yIGVtYmVkZGVkIGV4Y2x1c2l2ZSwgaXQgZG9lc24ndAogICAg\nICAgICAgICAvLyBzZWVtIGhhcmQgdG8gc3VwcG9ydCBvdGhlcndpc2UKICAg\nICAgICAgICAgaWYgKGVudGl0eSA9PSBudWxsKQogICAgICAgICAgICAgICAg\nbWV0YS5zZXRFbWJlZGRlZE9ubHkodHJ1ZSk7CiAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgbWV0YS5zZXRFbWJlZGRlZE9ubHkoZmFsc2Up\nOwogICAgICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGVu\ndGl0eS5uYW1lKCkpKQogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0VHlw\nZUFsaWFzKGVudGl0eS5uYW1lKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICAvLyB0cmFjayBmZXRjaCBncm91cHMgdG8gcGFyc2UgdGhl\nbSBhZnRlciBmaWVsZHMsIHNpbmNlIHRoZXkKICAgICAgICAvLyByZWx5IG9u\nIGZpZWxkIG1ldGFkYXRhCiAgICAgICAgRmV0Y2hHcm91cFtdIGZncyA9IG51\nbGw7CiAgICAgICAgRGV0YWNoZWRTdGF0ZSBkZXRhY2hlZCA9IG51bGw7Cgog\nICAgICAgIC8vIHRyYWNrIGxpc3RlbmVycyBzaW5jZSB3ZSBuZWVkIHRvIG1l\ncmdlIHRoZW0gd2l0aCBlbnRpdHkgY2FsbGJhY2tzCiAgICAgICAgQ29sbGVj\ndGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gbGlzdGVuZXJzID0gbnVsbDsK\nICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0\naW9uIGFubm8gOiBfY2xzLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewog\nICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlw\nZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBoYW5kbGVVbmtub3duQ2xhc3NBbm5vdGF0aW9uKG1ldGEsIGFu\nbm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIEVOVElUWV9MSVNURU5FUlM6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxp\nc3RlbmVycyA9IHBhcnNlRW50aXR5TGlzdGVuZXJzKG1ldGEsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAoRW50aXR5TGlzdGVuZXJzKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgRVhDTFVERV9ERUZBVUxUX0xJU1RFTkVSUzoKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgbWV0YS5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuc2V0SWdub3JlU3lzdGVtTGlzdGVuZXJzKHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBFWENMVURFX1NVUEVSQ0xBU1NfTElTVEVORVJTOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhLmdldExpZmVjeWNsZU1ldGFEYXRhKCkuc2V0\nSWdub3JlU3VwZXJjbGFzc0NhbGxiYWNrcwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKExpZmVjeWNsZU1ldGFEYXRhLklHTk9SRV9ISUdIKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRkxVU0hfTU9ERToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgd2FybkZsdXNoTW9k\nZShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSURfQ0xBU1M6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1l\ndGEuc2V0T2JqZWN0SWRUeXBlKCgoSWRDbGFzcykgYW5ubykudmFsdWUoKSwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgogICAgICAgICAgICAgICAgICAg\nIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChtZXRhLmdldFNvdXJjZU1vZGUoKSAm\nIE1PREVfUVVFUlkpPT0wKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJz\nZU5hbWVkTmF0aXZlUXVlcmllcyhfY2xzLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKChOYW1lZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBOQVRJVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nUXVlcnlNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9R\nVUVSWSk9PTApCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRO\nYXRpdmVRdWVyaWVzKF9jbHMsIChOYW1lZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgUVVFUklFUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1v\nZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZKT09\nMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMo\nX2NscywgKChOYW1lZFF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBRVUVS\nWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAo\nbWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZKT09MCkKICAgICAg\nICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMoX2NscywgKE5h\nbWVkUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihfY2xz\nLCAoU2VxdWVuY2VHZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBEQVRBX0NBQ0hFOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBwYXJzZURhdGFDYWNoZShtZXRhLCAoRGF0\nYUNhY2hlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgREFUQVNUT1JFX0lEOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBwYXJzZURhdGFTdG9yZUlkKG1ldGEsIChEYXRhU3RvcmVJZCkg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIERFVEFDSEVEX1NUQVRFOgogICAgICAgICAgICAgICAgICAg\nIGRldGFjaGVkID0gKERldGFjaGVkU3RhdGUpIGFubm87CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZFVENIX0dS\nT1VQOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBmZ3MgPSBuZXcgRmV0Y2hHcm91\ncFtdeyAoRmV0Y2hHcm91cCkgYW5ubyB9OwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGRVRDSF9HUk9VUFM6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZncyA9ICgoRmV0Y2hHcm91cHMpIGFubm8p\nLnZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIE1BTkFHRURfSU5URVJGQUNFOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBwYXJzZU1hbmFnZWRJbnRlcmZhY2UobWV0YSwgKE1hbmFnZWRJ\nbnRlcmZhY2UpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBSRVBMSUNBVEVEOgogICAgICAgICAgICAg\nICAgCW1ldGEuc2V0UmVwbGljYXRlZCh0cnVlKTsKICAgICAgICAgICAgICAg\nIAlicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQUNDRVNTOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBwYXJzZUFjY2VzcyhtZXRhLCAoQWNjZXNzKWFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBDQUNIRUFCTEU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VD\nYWNoZShtZXRhLCAoQ2FjaGVhYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBf\nY2xzLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5nKCkp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpIHsKICAgICAgICAgICAgcGFyc2VEZXRhY2hlZFN0YXRl\nKG1ldGEsIGRldGFjaGVkKTsKCiAgICAgICAgICAgIC8vIG1lcmdlIGNhbGxi\nYWNrIG1ldGhvZHMgd2l0aCBkZWNsYXJlZCBsaXN0ZW5lcnMKICAgICAgICAg\nICAgaW50W10gaGlnaHMgPSBudWxsOwogICAgICAgICAgICBpZiAobGlzdGVu\nZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGhpZ2hzID0gbmV3IGlu\ndFtsaXN0ZW5lcnMubGVuZ3RoXTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgICAgIGlmIChsaXN0ZW5lcnNbaV0gIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgaGlnaHNbaV0gPSBsaXN0ZW5lcnNbaV0uc2l6ZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlY29yZENhbGxiYWNrcyht\nZXRhLCBwYXJzZUNhbGxiYWNrTWV0aG9kcyhfY2xzLCBsaXN0ZW5lcnMsIGZh\nbHNlLAogICAgICAgICAgICAgICAgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSks\nIGhpZ2hzLCBmYWxzZSk7CgogICAgICAgICAgICAvLyBzY2FuIHBvc3NpYmx5\nIG5vbi1QQyBoaWVyYXJjaHkgZm9yIGNhbGxiYWNrcy4KICAgICAgICAgICAg\nLy8gcmVkdW5kYW50IGZvciBQQyBzdXBlcmNsYXNzIGJ1dCB3ZSBkb24ndCBr\nbm93IHRoYXQgeWV0CiAgICAgICAgICAgIC8vIHNvIGxldCBMaWZlY3ljbGVN\nZXRhRGF0YSBkZXRlcm1pbmUgdGhhdAogICAgICAgICAgICBpZiAoX2Nscy5n\nZXRTdXBlcmNsYXNzKCkgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgIU9i\namVjdC5jbGFzcy5lcXVhbHMoX2Nscy5nZXRTdXBlcmNsYXNzKCkpKSB7CiAg\nICAgICAgICAgICAgICByZWNvcmRDYWxsYmFja3MobWV0YSwgcGFyc2VDYWxs\nYmFja01ldGhvZHMoX2Nscy5nZXRTdXBlcmNsYXNzKCksCiAgICAgICAgICAg\nICAgICAgICAgbnVsbCwgdHJ1ZSwgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSks\nIG51bGwsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogbWV0YS5nZXREZWNsYXJlZEZp\nZWxkcygpKQogICAgICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9\nPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAg\nICAgICAgcGFyc2VNZW1iZXJBbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIC8v\nIHBhcnNlIGZldGNoIGdyb3VwcyBhZnRlciBmaWVsZHMKICAgICAgICBpZiAo\nZmdzICE9IG51bGwpCiAgICAgICAgICAgIHBhcnNlRmV0Y2hHcm91cHMobWV0\nYSwgZmdzKTsKCiAgICAgICAgLy8gYWx3YXlzIHBhcnNlIG1hcHBpbmcgYWZ0\nZXIgbWV0YWRhdGEgaW4gY2FzZSB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzCiAg\nICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKSB7CiAgICAgICAg\nICAgIHBhcnNlQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbnMobWV0YSk7CiAgICAg\nICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBtZXRhLmdldERlY2xh\ncmVkRmllbGRzKCkpCiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldE1hbmFn\nZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQog\nICAgICAgICAgICAgICAgICAgIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRp\nb25zKGZtZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBleHBsaWNpdCBhY2Nlc3MgdHlw\nZSwgaWYgc3BlY2lmaWVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VBY2Nlc3MoQ2xhc3NNZXRhRGF0YSBtZXRhLCBBY2Nlc3MgYWNjZXNzKSB7\nCiAgICAJaWYgKGFjY2VzcyAhPSBudWxsKSB7CiAgICAJCW1ldGEuc2V0QWNj\nZXNzVHlwZShBY2Nlc3NDb2RlLkVYUExJQ0lUCiAgICAgICAgICAgIHwgKGFj\nY2Vzcy52YWx1ZSgpID09IEFjY2Vzc1R5cGUuRklFTEQgPwogICAgICAgICAg\nICAJQWNjZXNzQ29kZS5GSUVMRCA6IEFjY2Vzc0NvZGUuUFJPUEVSVFkpKTsK\nICAgIAl9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBjbGFzcyBtYXBw\naW5nIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBw\nYXJzZUNsYXNzTWFwcGluZ0Fubm90YXRpb25zKENsYXNzTWV0YURhdGEgbWV0\nYSkgewogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0\nbyBoYW5kbGUgdW5rbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaGFuZGxlVW5rbm93bkNsYXNzQW5ub3RhdGlvbihD\nbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nRmluZCBvciBjcmVhdGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiB0eXBlLiBN\nYXkgcmV0dXJuIG51bGwgaWYKICAgICAqIHRoaXMgY2xhc3MgaGFzIGFscmVh\nZHkgYmVlbiBwYXJzZWQgZnVsbHkuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xh\nc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q2FjaGVkTWV0YURhdGEo\nX2Nscyk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCAmJgogICAgICAgICAg\nICAoKGlzTWV0YURhdGFNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgp\nICYgTU9ERV9NRVRBKSAhPSAwKSB8fAogICAgICAgICAgICAgICAgKGlzTWFw\ncGluZ01vZGUoKSAmJgogICAgICAgICAgICAgICAgICAgIChtZXRhLmdldFNv\ndXJjZU1vZGUoKSAmIE1PREVfTUFQUElORykgIT0gMCkpKSB7CiAgICAgICAg\nICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIF9sb2cud2FybihfbG9jLmdldCgiZHVwLW1ldGFkYXRhIiwgX2Nscy5nZXRO\nYW1lKCkpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBpZiAobWV0YSA9PSBudWxsKSB7CiAgICAgICAgICAgIG1ldGEg\nPSBnZXRSZXBvc2l0b3J5KCkuYWRkTWV0YURhdGEoX2NscywgZ2V0QWNjZXNz\nQ29kZShfY2xzKSk7CiAgICAgICAgICAgIG1ldGEuc2V0RW52Q2xhc3NMb2Fk\nZXIoX2VudkxvYWRlcik7CiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9k\nZShNT0RFX05PTkUpOwogICAgICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRT\nb3VyY2VGaWxlKCksIFNvdXJjZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05TKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBHZXRzIHRoZSBleHBsaWNpdCBhY2Nlc3MgZm9yIHRoZSBjbGFz\ncywgaWYgYW55LgogICAgICogRXhwbGljaXQgYWNjZXNzIHR5cGUgc3BlY2lm\naWNhdGlvbiBkb2VzIG5vdCBhZmZlY3QgdGhlIGFjY2VzcyB0eXBlIG9mCiAg\nICAgKiBvdGhlciBlbnRpdHkgY2xhc3NlcyBvciBtYXBwZWQgc3VwZXIgY2xh\nc3NlcyBpbiB0aGUgZW50aXR5IGhpZXJhcmNoeS4KICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgZ2V0QWNjZXNzQ29kZShDbGFzczw/PiBjbHMpIHsKICAgICAg\nICBpbnQgYWNjZXNzQ29kZSA9IEFjY2Vzc0NvZGUuVU5LTk9XTjsKICAgICAg\nICBBY2Nlc3MgYWNjZXNzID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldEFubm90YXRpb25B\nY3Rpb24oY2xzLCBBY2Nlc3MuY2xhc3MpKTsKICAgICAgICBpZiAoYWNjZXNz\nICE9IG51bGwpIHsKICAgICAgICAgICAgYWNjZXNzQ29kZSB8PSAgQWNjZXNz\nQ29kZS5FWFBMSUNJVCB8CiAgICAgICAgICAgICAgICAoYWNjZXNzLnZhbHVl\nKCkgPT0gQWNjZXNzVHlwZS5GSUVMRCA/CiAgICAgICAgICAgICAgICBBY2Nl\nc3NDb2RlLkZJRUxEIDogQWNjZXNzQ29kZS5QUk9QRVJUWSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBhY2Nlc3NDb2RlOwogICAgfQoKICAgIC8qKgog\nICAgICogRGV0ZXJtaW5lIHRoZSBzb3VyY2UgZmlsZSB3ZSdyZSBwYXJzaW5n\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmlsZSBnZXRTb3VyY2VGaWxlKCkg\newogICAgICAgIGlmIChfZmlsZSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gX2ZpbGU7CgogICAgICAgIENsYXNzPD8+IGNscyA9IF9jbHM7CiAgICAg\nICAgd2hpbGUgKGNscy5nZXRFbmNsb3NpbmdDbGFzcygpICE9IG51bGwpCiAg\nICAgICAgICAgIGNscyA9IGNscy5nZXRFbmNsb3NpbmdDbGFzcygpOwoKICAg\nICAgICBTdHJpbmcgcnNyYyA9IFN0cmluZ1V0aWxzLnJlcGxhY2UoY2xzLmdl\ndE5hbWUoKSwgIi4iLCAiLyIpOwogICAgICAgIENsYXNzTG9hZGVyIGxvYWRl\nciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihjbHMpKTsK\nICAgICAgICBpZiAobG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIGxvYWRl\nciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0U3lzdGVtQ2xhc3NMb2FkZXJBY3Rp\nb24oKSk7CiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBVUkwgdXJsID0gQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLmdldFJlc291cmNlQWN0aW9uKGxvYWRlciwgcnNyYyArICIuamF2YSIpKTsK\nICAgICAgICBpZiAodXJsID09IG51bGwpIHsKICAgICAgICAgICAgdXJsID0g\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXRSZXNvdXJjZUFjdGlvbihsb2FkZXIsIHJz\ncmMgKyAiLmNsYXNzIikpOwogICAgICAgICAgICBpZiAodXJsID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgX2ZpbGUgPSBuZXcgRmlsZSh1cmwudG9V\nUkkoKSk7CiAgICAgICAgfSBjYXRjaCAoVVJJU3ludGF4RXhjZXB0aW9uIGUp\nIHsKICAgICAgICB9IGNhdGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24g\naWFlKSB7CiAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhyb3duIHdoZW4gdGhl\nIFVSSSBpcyBub24taGllcmFyY2hpY2FsIChha2EgSkJvc3MpCiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfZmlsZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIEBEYXRhU3RvcmVJZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlRGF0YVN0b3JlSWQoQ2xhc3NNZXRhRGF0YSBtZXRhLCBEYXRhU3Rv\ncmVJZCBpZCkgewogICAgICAgIG1ldGEuc2V0SWRlbnRpdHlUeXBlKENsYXNz\nTWV0YURhdGEuSURfREFUQVNUT1JFKTsKCiAgICAgICAgaW50IHN0cmF0ID0g\nZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShtZXRhLCBpZC5zdHJhdGVneSgp\nLAogICAgICAgICAgICBpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgaWYgKHN0\ncmF0ICE9IC0xKQogICAgICAgICAgICBtZXRhLnNldElkZW50aXR5U3RyYXRl\nZ3koc3RyYXQpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2gg\nKGlkLnN0cmF0ZWd5KCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEU6\nCiAgICAgICAgICAgICAgICBjYXNlIFNFUVVFTkNFOgogICAgICAgICAgICAg\nICAgICAgIC8vIHRlY2huaWNhbGx5IHdlIHNob3VsZCBoYXZlIHNlcGFyYXRl\nIHN5c3RlbSB0YWJsZSBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBzZXF1\nZW5jZSBnZW5lcmF0b3JzLCBidXQgaXQncyBlYXNpZXIgdG8ganVzdCByZWx5\nIG9uCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHN5c3RlbSBvcmcuYXBh\nY2hlLm9wZW5qcGEuU2VxdWVuY2Ugc2V0dGluZyBmb3IgYm90aAogICAgICAg\nICAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGlkLmdlbmVy\nYXRvcigpKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVu\ndGl0eVNlcXVlbmNlTmFtZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIFNlcXVlbmNlTWV0YURhdGEuTkFNRV9TWVNURU0pOwogICAgICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJ\nZGVudGl0eVNlcXVlbmNlTmFtZShpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFVVE86\nCiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0cmF0ZWd5\nKFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJREVOVElUWToKICAgICAg\nICAgICAgICAgICAgICBtZXRhLnNldElkZW50aXR5U3RyYXRlZ3koVmFsdWVT\ndHJhdGVnaWVzLkFVVE9BU1NJR04pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oaWQuc3RyYXRl\nZ3koKS50b1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhhdCBARmx1c2hNb2RlIGlzIG5v\ndCBzdXBwb3J0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3YXJuRmx1\nc2hNb2RlKE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgaWYgKF9sb2cuaXNX\nYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQo\nInVuc3VwcG9ydGVkIiwgIkZsdXNoTW9kZSIsIGNvbnRleHQpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIEBEYXRhQ2FjaGUuCiAgICAgKiAKICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRGF0YUNhY2hlKENsYXNzTWV0\nYURhdGEgbWV0YSwgRGF0YUNhY2hlIGNhY2hlKSB7CiAgICAgICAgaWYgKGNh\nY2hlLnRpbWVvdXQoKSAhPSBJbnRlZ2VyLk1JTl9WQUxVRSkgewogICAgICAg\nICAgICBtZXRhLnNldERhdGFDYWNoZVRpbWVvdXQoY2FjaGUudGltZW91dCgp\nKTsKICAgICAgICB9CiAgICAgICAgU3RyaW5nIGNhY2hlTmFtZSA9IGNhY2hl\nLm5hbWUoKTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjYWNo\nZU5hbWUpKSB7CiAgICAgICAgICAgIGNhY2hlTmFtZSA9IG9yZy5hcGFjaGUu\nb3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlLk5BTUVfREVGQVVMVDsKICAg\nICAgICB9CiAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVOYW1lKGNhY2hlLmVu\nYWJsZWQoKSA/IGNhY2hlTmFtZSA6IG51bGwpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBwYXJzZU1hbmFnZWRJbnRlcmZhY2UoQ2xhc3NNZXRhRGF0YSBt\nZXRhLAogICAgICAgIE1hbmFnZWRJbnRlcmZhY2UgaWZhY2UpIHsKICAgICAg\nICBtZXRhLnNldE1hbmFnZWRJbnRlcmZhY2UodHJ1ZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBARGV0YWNoZWRTdGF0ZS4gVGhlIGFubm90YXRp\nb24gbWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZURldGFjaGVkU3RhdGUoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIERl\ndGFjaGVkU3RhdGUgZGV0YWNoZWQpIHsKICAgICAgICBpZiAoZGV0YWNoZWQg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIWRldGFjaGVkLmVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShudWxs\nKTsKICAgICAgICAgICAgZWxzZSBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShk\nZXRhY2hlZC5maWVsZE5hbWUoKSkpCiAgICAgICAgICAgICAgICBtZXRhLnNl\ndERldGFjaGVkU3RhdGUoQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtZXRhLnNldERldGFjaGVk\nU3RhdGUoZGV0YWNoZWQuZmllbGROYW1lKCkpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIEZpZWxkW10gZmllbGRzID0gKEZpZWxkW10pIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRGaWVsZHNBY3Rpb24oCiAgICAgICAg\nICAgICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBpZiAoKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAgICAgLmlz\nQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oZmllbGRzW2ldLCBEZXRhY2hlZFN0\nYXRlLmNsYXNzKSkpCiAgICAgICAgICAgICAgICAgICAgLmJvb2xlYW5WYWx1\nZSgpKQogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0\nZShmaWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBARW50aXR5TGlzdGVuZXJzCiAgICAgKi8KICAg\nIHByaXZhdGUgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gcGFy\nc2VFbnRpdHlMaXN0ZW5lcnMKICAgICAgICAoQ2xhc3NNZXRhRGF0YSBtZXRh\nLCBFbnRpdHlMaXN0ZW5lcnMgbGlzdGVuZXJzKSB7CiAgICAgICAgQ2xhc3M8\nPz5bXSBjbGFzc2VzID0gbGlzdGVuZXJzLnZhbHVlKCk7CiAgICAgICAgQ29s\nbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gcGFyc2VkID0gbnVsbDsK\nICAgICAgICBmb3IgKENsYXNzPD8+IGNscyA6IGNsYXNzZXMpCiAgICAgICAg\nICAgIHBhcnNlZCA9IHBhcnNlQ2FsbGJhY2tNZXRob2RzKGNscywgcGFyc2Vk\nLCB0cnVlLCB0cnVlLAogICAgICAgICAgICAgICAgZ2V0UmVwb3NpdG9yeSgp\nKTsKICAgICAgICByZXR1cm4gcGFyc2VkOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgY2FsbGJhY2sgbWV0aG9kcyBpbnRvIHRoZSBnaXZlbiBhcnJh\neSwgYW5kIHJldHVybiB0aGF0IGFycmF5LAogICAgICogY3JlYXRpbmcgb25l\nIGlmIG51bGwuIEVhY2ggaW5kZXggaW50byB0aGUgYXJyYXkgaXMgYSBjb2xs\nZWN0aW9uIG9mCiAgICAgKiBjYWxsYmFjayBhZGFwdGVycyBmb3IgdGhhdCBu\ndW1lcmljIGV2ZW50IHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIHN1cHMg\nd2hldGhlciB0byBzY2FuIHN1cGVyY2xhc3NlcwogICAgICogQHBhcmFtIGxp\nc3RlbmVyIHdoZXRoZXIgdGhpcyBpcyBhIGxpc3RlbmVyIG9yIG5vdAogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2Fs\nbGJhY2tzPltdIHBhcnNlQ2FsbGJhY2tNZXRob2RzCiAgICAgICAgKENsYXNz\nPD8+IGNscywgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gY2Fs\nbGJhY2tzLCBib29sZWFuIHN1cHMsCiAgICAgICAgYm9vbGVhbiBsaXN0ZW5l\nciwgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CgogICAgICAgIGlmIChj\nbHMgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbigiY2xzIGNhbm5vdCBiZSBudWxsIik7CgogICAgICAg\nIC8vIGZpcnN0IHNvcnQgLyBmaWx0ZXIgYmFzZWQgb24gaW5oZXJpdGFuY2UK\nICAgICAgICBTZXQ8TWV0aG9kPiBtZXRob2RzID0gbmV3IFRyZWVTZXQ8TWV0\naG9kPihNZXRob2RDb21wYXJhdG9yLgogICAgICAgICAgICBnZXRJbnN0YW5j\nZSgpKTsKCiAgICAgICAgaW50IG1vZHM7CiAgICAgICAgQ2xhc3M8Pz4gc3Vw\nID0gY2xzOwogICAgICAgIE1ldGhvZEtleSBrZXk7CiAgICAgICAgU2V0PE1l\ndGhvZEtleT4gc2VlbiA9IG5ldyBIYXNoU2V0PE1ldGhvZEtleT4oKTsKICAg\nICAgICBkbyB7CiAgICAgICAgICAgIGZvciAoTWV0aG9kIG0gOiAoTWV0aG9k\nW10pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RzQWN0aW9u\nKHN1cCkpKSB7CiAgICAgICAgICAgICAgICBtb2RzID0gbS5nZXRNb2RpZmll\ncnMoKTsKICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1N0YXRpYyht\nb2RzKSB8fCBNb2RpZmllci5pc0ZpbmFsKG1vZHMpIHx8CiAgICAgICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLmVxdWFscyhtLmdldERlY2xhcmluZ0Ns\nYXNzKCkpKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAg\nICAgICAgICAgIGtleSA9IG5ldyBNZXRob2RLZXkobSk7CiAgICAgICAgICAg\nICAgICBpZiAoIXNlZW4uY29udGFpbnMoa2V5KSkgewogICAgICAgICAgICAg\nICAgICAgIG1ldGhvZHMuYWRkKG0pOwogICAgICAgICAgICAgICAgICAgIHNl\nZW4uYWRkKGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsKICAgICAg\nICB9IHdoaWxlIChzdXBzICYmICFPYmplY3QuY2xhc3MuZXF1YWxzKHN1cCkp\nOwoKICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0gcmVwb3Mu\nZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIGZvciAoTWV0aG9kIG0gOiBt\nZXRob2RzKSB7CiAgICAgICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDog\nKEFubm90YXRpb25bXSkgQWNjZXNzQ29udHJvbGxlcgogICAgICAgICAgICAg\nICAgLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAg\nICAgICAgIC5nZXREZWNsYXJlZEFubm90YXRpb25zQWN0aW9uKG0pKSkgewog\nICAgICAgICAgICAgICAgTWV0YURhdGFUYWcgdGFnID0gX3RhZ3MuZ2V0KGFu\nbm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgICAgICBpZiAodGFn\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgICAgICBpbnRbXSBldmVudHMgPSBNZXRhRGF0YVBhcnNlcnMuZ2V0\nRXZlbnRUeXBlcyh0YWcsIGNvbmYpOwogICAgICAgICAgICAgICAgaWYgKGV2\nZW50cyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3MgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBjYWxsYmFja3MgPSAoQ29sbGVjdGlvbjxMaWZlY3lj\nbGVDYWxsYmFja3M+W10pCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBD\nb2xsZWN0aW9uW0xpZmVjeWNsZUV2ZW50LkFMTF9FVkVOVFMubGVuZ3RoXTsK\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV2ZW50cy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGludCBlID0gZXZl\nbnRzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3NbZV0g\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2Vd\nID0gbmV3IEFycmF5TGlzdDxMaWZlY3ljbGVDYWxsYmFja3M+KDMpOwogICAg\nICAgICAgICAgICAgICAgIE1ldGFEYXRhUGFyc2Vycy52YWxpZGF0ZU1ldGhv\nZHNGb3JTYW1lQ2FsbGJhY2soY2xzLAogICAgICAgICAgICAgICAgICAgICAg\nICBjYWxsYmFja3NbZV0sIG0sIHRhZywgY29uZiwgcmVwb3MuZ2V0TG9nKCkp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAg\nICAgICAgICAgICAgICAgICBjYWxsYmFja3NbZV0uYWRkKG5ldyBCZWFuTGlm\nZWN5Y2xlQ2FsbGJhY2tzKGNscywgbSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZhbHNlKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdLmFkZChuZXcg\nTWV0aG9kTGlmZWN5Y2xlQ2FsbGJhY2tzKG0sCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmYWxzZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gY2FsbGJhY2tzOwogICAgfQoKICAgIC8qKgogICAgICogU3Rv\ncmUgbGlmZWN5Y2xlIG1ldGFkYXRhLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVjb3JkQ2FsbGJhY2tzKENsYXNzTWV0YURhdGEgY2xzLAogICAgICAg\nIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIGNhbGxiYWNrcywg\naW50W10gaGlnaHMsCiAgICAgICAgYm9vbGVhbiBzdXBlckNsYXNzKSB7CiAg\nICAgICAgaWYgKGNhbGxiYWNrcyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgTGlmZWN5Y2xlTWV0YURhdGEgbWV0YSA9IGNscy5nZXRM\naWZlY3ljbGVNZXRhRGF0YSgpOwogICAgICAgIExpZmVjeWNsZUNhbGxiYWNr\nc1tdIGFycmF5OwogICAgICAgIGZvciAoaW50IGV2ZW50IDogTGlmZWN5Y2xl\nRXZlbnQuQUxMX0VWRU5UUykgewogICAgICAgICAgICBpZiAoY2FsbGJhY2tz\nW2V2ZW50XSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgIGFycmF5ID0gY2FsbGJhY2tzW2V2ZW50XS50b0FycmF5CiAg\nICAgICAgICAgICAgICAobmV3IExpZmVjeWNsZUNhbGxiYWNrc1tjYWxsYmFj\na3NbZXZlbnRdLnNpemUoKV0pOwoKICAgICAgICAgICAgaWYgKHN1cGVyQ2xh\nc3MpIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0Tm9uUENTdXBlcmNsYXNz\nQ2FsbGJhY2tzKGV2ZW50LCBhcnJheSwKICAgICAgICAgICAgICAgICAgICAo\naGlnaHMgPT0gbnVsbCkgPyAwIDogaGlnaHNbZXZlbnRdKTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGVjbGFyZWRD\nYWxsYmFja3MoZXZlbnQsIGFycmF5LAogICAgICAgICAgICAgICAgICAgICho\naWdocyA9PSBudWxsKSA/IDAgOiBoaWdoc1tldmVudF0pOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGZl\ndGNoIGdyb3Vwcy4KICAgICAqIElmIEZldGNoR3JvdXAgQSBpbmNsdWRlcyBG\nZXRjaEdyb3VwIEIsIHRoZW4gYSBiaS1saW5rIGlzIHNldCBiZXR3ZWVuCiAg\nICAgKiBBIGFuZCBCLiBCb3RoIEEgYW5kIEIgbXVzdCBiZSBkZWNsYXJlZCBp\nbiB0aGUgc2FtZSBDbGFzcy4KICAgICAqIDxicj4KICAgICAqIENhbGwge0Bs\naW5rICNwYXJzZUZldGNoQXR0cmlidXRlKENsYXNzTWV0YURhdGEsCiAgICAg\nKiBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwLCBGZXRjaEF0\ndHJpYnV0ZSkgb25seSBhZnRlciB0aGUKICAgICAqIGJpLWxpbmtzIGhhdmUg\nYmVlbiBlc3RhYmxpc2hlZCwgYmVjYXVzZSBhIGZpZWxkIGYgd2lsbCBub3Qg\nb25seSBhZGQgdGhlCiAgICAgKiBmZXRjaCBncm91cCBBIHdoaWNoIGV4cGxp\nY3RseSBpbmNsdWRlcyBmIHRvIGl0cyBjdXN0b20gZmV0Y2ggZ3JvdXBzIGJ1\ndAogICAgICogYWxzbyB3aWxsIGFsc28gYWRkIGFueSBmZXRjaCBncm91cCBC\nIHRoYXQgaW5jbHVkZXMgQS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlRmV0Y2hHcm91cHMoQ2xhc3NNZXRhRGF0YSBtZXRhLCBGZXRjaEdyb3Vw\nLi4uIGdyb3VwcykgewogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkZldGNoR3JvdXAgZmc7CiAgICAgICAgZm9yIChGZXRjaEdyb3VwIGdyb3Vw\nIDogZ3JvdXBzKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KGdyb3VwLm5hbWUoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVubmFtZWQtZmciLCBtZXRh\nKSk7CgogICAgICAgICAgICBmZyA9IG1ldGEuYWRkRGVjbGFyZWRGZXRjaEdy\nb3VwKGdyb3VwLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChncm91cC5wb3N0\nTG9hZCgpKQogICAgICAgICAgICAgICAgZmcuc2V0UG9zdExvYWQodHJ1ZSk7\nCiAgICAgICAgICAgIGZvciAoU3RyaW5nIHMgOiBncm91cC5mZXRjaEdyb3Vw\ncygpKSB7CiAgICAgICAgICAgICAgICBmZy5hZGREZWNsYXJlZEluY2x1ZGUo\ncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gQWRkIHRo\nZSBwYXJlbnQtY2hpbGQgc3R5bGUgYmktbGlua3MgYmV0d2VlbiBmZXRjaCBn\ncm91cHMgaW4gYQogICAgICAgIC8vIHNlcGFyYXRlIHBhc3MuCiAgICAgICAg\nZm9yIChGZXRjaEdyb3VwIGdyb3VwOmdyb3VwcykgewogICAgICAgIAlmZyA9\nIG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cC5uYW1lKCkpOwogICAgICAgIAlT\ndHJpbmdbXSBpbmNsdWRlZEZldGNoR3JvcE5hbWVzID0gZmcuZ2V0RGVjbGFy\nZWRJbmNsdWRlcygpOwogICAgICAgIAlmb3IgKFN0cmluZyBpbmNsdWRlZEZl\nY3RjaEdyb3VwTmFtZTppbmNsdWRlZEZldGNoR3JvcE5hbWVzKSB7CiAgICAg\nICAgCQlvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwIGNoaWxk\nID0KICAgICAgICAJICAgIG1ldGEuZ2V0RmV0Y2hHcm91cChpbmNsdWRlZEZl\nY3RjaEdyb3VwTmFtZSk7CiAgICAgICAgCQlpZiAoY2hpbGQgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibWlzc2luZy1pbmNsdWRlZC1mZyIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1l\nKCksIGZnLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGluY2x1ZGVkRmVjdGNoR3JvdXBOYW1lKSk7CiAgICAgICAgCQljaGlsZC5h\nZGRDb250YWluZWRCeShmZyk7CiAgICAgICAgCX0KICAgICAgICB9CgogICAg\nICAgIGZvciAoRmV0Y2hHcm91cCBncm91cCA6IGdyb3VwcykgewogICAgICAg\nICAgICBmZyA9IG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cC5uYW1lKCkpOwog\nICAgICAgICAgICBmb3IgKEZldGNoQXR0cmlidXRlIGF0dHIgOiBncm91cC5h\ndHRyaWJ1dGVzKCkpCiAgICAgICAgICAgICAgICBwYXJzZUZldGNoQXR0cmli\ndXRlKG1ldGEsIGZnLCBhdHRyKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8q\nKgogICAgICogU2V0IGEgZmllbGQncyBmZXRjaCBncm91cC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlRmV0Y2hBdHRyaWJ1dGUoQ2xhc3NNZXRh\nRGF0YSBtZXRhLAogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZl\ndGNoR3JvdXAgZmcsIEZldGNoQXR0cmlidXRlIGF0dHIpIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZpZWxkID0gbWV0YS5nZXREZWNsYXJlZEZpZWxkKGF0\ndHIubmFtZSgpKTsKICAgICAgICBpZiAoZmllbGQgPT0gbnVsbAogICAgICAg\nICAgICB8fCBmaWVsZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0\nYS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmctZmllbGQiLCBmZy5n\nZXROYW1lKCksCiAgICAgICAgICAgICAgICBtZXRhLCBhdHRyLm5hbWUoKSkp\nOwoKICAgICAgICBmaWVsZC5zZXRJbkZldGNoR3JvdXAoZmcuZ2V0TmFtZSgp\nLCB0cnVlKTsKICAgICAgICBTZXQ8U3RyaW5nPiBwYXJlbnRGZXRjaEdyb3Vw\ncyA9IGZnLmdldENvbnRhaW5lZEJ5KCk7CiAgICAgICAgZm9yIChPYmplY3Qg\ncGFyZW50RmV0Y2hHcm91cCA6IHBhcmVudEZldGNoR3JvdXBzKQogICAgICAg\nIAlmaWVsZC5zZXRJbkZldGNoR3JvdXAocGFyZW50RmV0Y2hHcm91cC50b1N0\ncmluZygpLCB0cnVlKTsKICAgICAgICBpZiAoYXR0ci5yZWN1cnNpb25EZXB0\naCgpICE9IEludGVnZXIuTUlOX1ZBTFVFKQogICAgICAgICAgICBmZy5zZXRS\nZWN1cnNpb25EZXB0aChmaWVsZCwgYXR0ci5yZWN1cnNpb25EZXB0aCgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgYW5ub3RhdGlvbnMgZm9yIHRo\nZSBnaXZlbiBtZW1iZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZU1lbWJlckFubm90YXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgLy8gbG9vayBmb3IgcGVyc2lzdGVuY2Ugc3RyYXRlZ3kgaW4gYW5ub3Rh\ndGlvbiB0YWJsZQogICAgICAgIE1lbWJlciBtZW1iZXIgPSBnZXRSZXBvc2l0\nb3J5KCkuZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS4KICAg\nICAgICAgICAgZ2V0QmFja2luZ01lbWJlcihmbWQpOwogICAgICAgIFBlcnNp\nc3RlbmNlU3RyYXRlZ3kgcHN0cmF0ID0gUGVyc2lzdGVuY2VNZXRhRGF0YURl\nZmF1bHRzLgogICAgICAgICAgICBnZXRQZXJzaXN0ZW5jZVN0cmF0ZWd5KGZt\nZCwgbWVtYmVyKTsKICAgICAgICBpZiAocHN0cmF0ID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBmbWQuc2V0RXhwbGljaXQodHJ1ZSk7\nCgogICAgICAgIEFubm90YXRlZEVsZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxl\nbWVudCkgbWVtYmVyOwogICAgICAgIGJvb2xlYW4gbG9iID0gKEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAg\nICAgIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGVsLCBMb2IuY2xhc3Mp\nKSkuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2Rl\nKCkpIHsKICAgICAgICAgICAgc3dpdGNoIChwc3RyYXQpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgQkFTSUM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VC\nYXNpYyhmbWQsIChCYXNpYykgZWwuZ2V0QW5ub3RhdGlvbihCYXNpYy5jbGFz\ncyksIGxvYik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlTWFueVRvT25lKGZtZCwgKE1hbnlUb09uZSkgZWwuZ2V0QW5ub3RhdGlv\nbgogICAgICAgICAgICAgICAgICAgICAgICAoTWFueVRvT25lLmNsYXNzKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIE9ORV9PTkU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VPbmVUb09u\nZShmbWQsIChPbmVUb09uZSkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAg\nICAgICAgICAgICAgICAoT25lVG9PbmUuY2xhc3MpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU1CRURERUQ6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbWJlZGRlZChmbWQsIChFbWJl\nZGRlZCkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAg\nICAoRW1iZWRkZWQuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgT05FX01BTlk6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VPbmVUb01hbnkoZm1kLCAoT25lVG9NYW55KSBlbC5n\nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChPbmVUb01h\nbnkuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlTWFueVRvTWFueShmbWQsIChNYW55VG9NYW55KSBlbC5nZXRBbm5v\ndGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChNYW55VG9NYW55LmNs\nYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFBFUlM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJz\naXN0ZW50KGZtZCwgKFBlcnNpc3RlbnQpIGVsLmdldEFubm90YXRpb24KICAg\nICAgICAgICAgICAgICAgICAgICAgKFBlcnNpc3RlbnQuY2xhc3MpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nUEVSU19DT0xMOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUGVyc2lzdGVu\ndENvbGxlY3Rpb24oZm1kLCAoUGVyc2lzdGVudENvbGxlY3Rpb24pCiAgICAg\nICAgICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRpb24oUGVyc2lzdGVu\ndENvbGxlY3Rpb24uY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9DT0xMOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlRWxlbWVudENvbGxlY3Rpb24oZm1kLCAoRWxlbWVu\ndENvbGxlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEFu\nbm90YXRpb24oRWxlbWVudENvbGxlY3Rpb24uY2xhc3MpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVSU19N\nQVA6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJzaXN0ZW50TWFwKGZt\nZCwgKFBlcnNpc3RlbnRNYXApCiAgICAgICAgICAgICAgICAgICAgICAgIGVs\nLmdldEFubm90YXRpb24oUGVyc2lzdGVudE1hcC5jbGFzcykpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUUkFO\nU0lFTlQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgbG9iKQog\nICAgICAgICAgICBwYXJzZUxvYk1hcHBpbmcoZm1kKTsKCiAgICAgICAgLy8g\nZXh0ZW5zaW9ucwogICAgICAgIE1ldGFEYXRhVGFnIHRhZzsKICAgICAgICBm\nb3IgKEFubm90YXRpb24gYW5ubyA6IGVsLmdldERlY2xhcmVkQW5ub3RhdGlv\nbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5v\ndGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duTWVtYmVyQW5ub3RhdGlv\nbihmbWQsIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAg\nICAgICAgICBjYXNlIEFDQ0VTUzoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZUFjY2VzcyhmbWQsIChBY2Nlc3MpYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUoZm1kKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgR0VO\nRVJBVEVEX1ZBTFVFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBp\nbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFy\nc2VHZW5lcmF0ZWRWYWx1ZShmbWQsIChHZW5lcmF0ZWRWYWx1ZSkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIElEOgogICAgICAgICAgICAgICAgY2FzZSBFTUJFRERFRF9JRDoKICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0UHJpbWFyeUtleSh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nTUFQUEVEX0JZX0lEOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwc0lk\nKGZtZCwgKE1hcHNJZClhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5KGZtZCwgKE1hcEtleSkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIE1BUF9LRVlfQ0xBU1M6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBwYXJzZU1hcEtleUNsYXNzKGZtZCwgKE1hcEtleUNsYXNzKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgT1JERVJfQlk6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VPcmRl\nckJ5KGZtZCwKICAgICAgICAgICAgICAgICAgICAgICAgKE9yZGVyQnkpIGVs\nLmdldEFubm90YXRpb24oT3JkZXJCeS5jbGFzcykpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJB\nVE9SOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlk\nZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1ZW5j\nZUdlbmVyYXRvcihlbCwgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nVkVSU0lPTjoKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmVyc2lvbih0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgREVQRU5ERU5UOgogICAgICAgICAgICAgICAgICAgIGlmIChp\nc01ldGFEYXRhTW9kZSgpICYmICgoRGVwZW5kZW50KSBhbm5vKS52YWx1ZSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0Q2FzY2FkZURlbGV0\nZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fREVQRU5E\nRU5UOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgp\nICYmICgoRWxlbWVudERlcGVuZGVudCkgYW5ubykudmFsdWUoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRDYXNjYWRl\nRGVsZXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0FVVE8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX1RZUEU6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0VHlwZU92ZXJyaWRlKHRv\nT3ZlcnJpZGVUeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKChF\nbGVtZW50VHlwZSkgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWFRFUk5BTF9WQUxT\nOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RXh0ZXJuYWxWYWx1ZXMo\nU3RyaW5ncy5qb2luKCgoRXh0ZXJuYWxWYWx1ZXMpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhbm5vKS52YWx1ZSgpLCAiLCIpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhURVJO\nQUxJWkVSOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RXh0ZXJuYWxp\nemVyKCgoRXh0ZXJuYWxpemVyKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkFDVE9S\nWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEZhY3RvcnkoKChGYWN0\nb3J5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSU5WRVJTRV9MT0dJQ0FMOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0SW52ZXJzZSgoKEludmVyc2VMb2dp\nY2FsKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0RFUEVOREVOVDoKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSAmJiAoKEtleURl\ncGVuZGVudCkgYW5ubykudmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZm1kLmdldEtleSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nc2V0Q2FzY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEtFWV9UWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5\nKCkuc2V0VHlwZU92ZXJyaWRlKHRvT3ZlcnJpZGVUeXBlKCgoS2V5VHlwZSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFubm8pLnZhbHVlKCkpKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgTE9BRF9GRVRDSF9HUk9VUDoKICAgICAgICAgICAgICAgIAlpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNl\ndExvYWRGZXRjaEdyb3VwKCgoTG9hZEZldGNoR3JvdXApIGFubm8pLnZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgCWJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBMUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRMUlMoKChM\nUlMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBSRUFEX09OTFk6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHBhcnNlUmVhZE9ubHkoZm1kLCAoUmVhZE9ubHkpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBUWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VHlwZU92\nZXJyaWRlKHRvT3ZlcnJpZGVUeXBlKCgoVHlwZSkgYW5ubykuCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihf\nbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBmbWQsCiAgICAgICAgICAgICAgICAg\nICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgbWVtYmVyIG1hcHBp\nbmcgY29tcG9uZW50cy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFy\nc2VNZW1iZXJNYXBwaW5nQW5ub3RhdGlvbnMoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBDYWNoZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlQ2FjaGUoQ2xhc3NNZXRhRGF0YSBt\nZXRhLCBDYWNoZWFibGUgY2FjaGVhYmxlKSB7CiAgICAgICAgbWV0YS5zZXRD\nYWNoZUVuYWJsZWQoY2FjaGVhYmxlLnZhbHVlKCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93biBh\nbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFu\nZGxlVW5rbm93bk1lbWJlckFubm90YXRpb24oRmllbGRNZXRhRGF0YSBmbWQs\nCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgZ2l2ZW4g\nY2xhc3MgdG8gaXRzIE9wZW5KUEEgdHlwZSBvdmVycmlkZSBlcXVpdmFsZW50\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzczw/PiB0b092ZXJy\naWRlVHlwZShDbGFzczw/PiBjbHMpIHsKICAgICAgICByZXR1cm4gKGNscyA9\nPSBFbnRpdHkuY2xhc3MpCiAgICAgICAgICAgID8gb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzIDogY2xzOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFJlYWRPbmx5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VSZWFkT25seShGaWVsZE1ldGFEYXRh\nIGZtZCwgUmVhZE9ubHkgcm8pIHsKICAgICAgICBpZiAocm8udmFsdWUoKSA9\nPSBVcGRhdGVBY3Rpb24uUkVTVFJJQ1QpCiAgICAgICAgICAgIGZtZC5zZXRV\ncGRhdGVTdHJhdGVneShVcGRhdGVTdHJhdGVnaWVzLlJFU1RSSUNUKTsKICAg\nICAgICBlbHNlIGlmIChyby52YWx1ZSgpID09IFVwZGF0ZUFjdGlvbi5JR05P\nUkUpCiAgICAgICAgICAgIGZtZC5zZXRVcGRhdGVTdHJhdGVneShVcGRhdGVT\ndHJhdGVnaWVzLklHTk9SRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3Ig\ndGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VHZW5lcmF0ZWRWYWx1ZShGaWVsZE1ldGFEYXRhIGZtZCwgR2VuZXJhdGVk\nVmFsdWUgZ2VuKSB7CiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3kg\nPSBnZW4uc3RyYXRlZ3koKTsKICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yID0g\nZ2VuLmdlbmVyYXRvcigpOwogICAgICAgIHBhcnNlR2VuZXJhdGVkVmFsdWUo\nZm1kLCBzdHJhdGVneSwgZ2VuZXJhdG9yKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhl\nIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBzdGF0aWMgdm9pZCBwYXJzZUdl\nbmVyYXRlZFZhbHVlKEZpZWxkTWV0YURhdGEgZm1kLCBHZW5lcmF0aW9uVHlw\nZSBzdHJhdGVneSwKICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yKSB7CiAgICAg\nICAgaW50IHN0cmF0ID0gZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShmbWQs\nIHN0cmF0ZWd5LCBnZW5lcmF0b3IpOwogICAgICAgIGlmIChzdHJhdCAhPSAt\nMSkKICAgICAgICAgICAgZm1kLnNldFZhbHVlU3RyYXRlZ3koc3RyYXQpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7\nCiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAg\nY2FzZSBTRVFVRU5DRToKICAgICAgICAgICAgICAgICAgICAvLyB0ZWNobmlj\nYWxseSB3ZSBzaG91bGQgaGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5k\nCiAgICAgICAgICAgICAgICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywg\nYnV0IGl0J3MgZWFzaWVyIHRvIGp1c3QgcmVseSBvbgogICAgICAgICAgICAg\nICAgICAgIC8vIHRoZSBzeXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVl\nbmNlIHNldHRpbmcgZm9yIGJvdGgKICAgICAgICAgICAgICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuaXNFbXB0eShnZW5lcmF0b3IpKQogICAgICAgICAgICAg\nICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VN\nZXRhRGF0YS5OQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5j\nZU5hbWUoZ2VuZXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgQVVUTzoKICAgICAgICAgICAgICAgICAg\nICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5O\nQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIElERU5USVRZOgogICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRWYWx1ZVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNT\nSUdOKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKHN0cmF0ZWd5LnRvU3RyaW5nKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSB2YWx1ZSBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGdlbmVyYXRv\nciwgb3IgLTEgaWYgdGhlCiAgICAgKiBzdHJhdGVneSBkZXBlbmRzIG9uIHRo\nZSA8Y29kZT5HZW5lcmF0aW9uVHlwZTwvY29kZT4gcmF0aGVyIHRoYW4gdGhl\nCiAgICAgKiBnZW5lcmF0b3IgbmFtZS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgaW50IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3koT2JqZWN0IGNv\nbnRleHQsCiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3ksIFN0cmlu\nZyBnZW5lcmF0b3IpIHsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gQVVUTyB8\nfCBTdHJpbmdVdGlscy5pc0VtcHR5KGdlbmVyYXRvcikpCiAgICAgICAgICAg\nIHJldHVybiAtMTsKCiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX0hFWC5l\ncXVhbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3Ry\nYXRlZ2llcy5VVUlEX0hFWDsKICAgICAgICBpZiAoR2VuZXJhdG9yLlVVSURf\nU1RSSU5HLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1cm4g\nVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RSSU5HOwogICAgICAgIGlmIChHZW5l\ncmF0b3IuVVVJRF9UWVBFNF9IRVguZXF1YWxzKGdlbmVyYXRvcikpCiAgICAg\nICAgICAgIHJldHVybiBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9UWVBFNF9IRVg7\nCiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX1RZUEU0X1NUUklORy5lcXVh\nbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3RyYXRl\nZ2llcy5VVUlEX1RZUEU0X1NUUklORzsKICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImdlbmVyYXRvci1iYWQtc3RyYXRl\nZ3kiLAogICAgICAgICAgICBjb250ZXh0LCBnZW5lcmF0b3IpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIEBCYXNpYy4gR2l2ZW4gYW5ub3RhdGlv\nbiBtYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nQmFzaWMoRmllbGRNZXRhRGF0YSBmbWQsIEJhc2ljIGFubm8sIGJvb2xlYW4g\nbG9iKSB7CiAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IGZtZC5nZXREZWNsYXJl\nZFR5cGUoKTsKICAgICAgICBpZiAobG9iICYmIHR5cGUgIT0gU3RyaW5nLmNs\nYXNzCiAgICAgICAgICAgICYmIHR5cGUgIT0gY2hhcltdLmNsYXNzICYmIHR5\ncGUgIT0gQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgJiYgdHlwZSAh\nPSBieXRlW10uY2xhc3MgJiYgdHlwZSAhPSBCeXRlW10uY2xhc3MpCiAgICAg\nICAgICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAgIGVsc2Ug\naWYgKCFsb2IpIHsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgaWYgKEVudW0uY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBubyBicmVh\nawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgICAgICBp\nZiAoU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRTZXJpYWxpemVkKHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZCwgIkJhc2ljIikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHR5cGUgPT0gY2hhcltdLmNsYXNzIHx8IHR5cGUg\nPT0gQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAg\nfHwgdHlwZSA9PSBieXRlW10uY2xhc3MgfHwgdHlwZSA9PSBCeXRlW10uY2xh\nc3MpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgIGlmIChTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxl\nRnJvbQogICAgICAgICAgICAgICAgICAgICAgICAodHlwZS5nZXRDb21wb25l\nbnRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0U2Vy\naWFsaXplZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmbWQsICJCYXNpYyIpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKGFubm8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZt\nZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRj\naFR5cGUuRUFHRVIpOwogICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQog\nICAgICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVM\nTF9FWENFUFRJT04pOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1h\nbnlUb09uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRv\nT25lKEZpZWxkTWV0YURhdGEgZm1kLCBNYW55VG9PbmUgYW5ubykgewogICAg\nICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiTWFu\neVRvT25lIikpOwoKICAgICAgICAvLyBkb24ndCBzcGVjaWZpY2FsbHkgZXhj\nbHVkZSByZWxhdGlvbiBmcm9tIERGRyBiL2MgdGhhdCB3aWxsIHByZXZlbnQK\nICAgICAgICAvLyB1cyBmcm9tIGV2ZW4gcmVhZGluZyB0aGUgZmsgd2hlbiBy\nZWFkaW5nIGZyb20gdGhlIHByaW1hcnkgdGFibGUsCiAgICAgICAgLy8gd2hp\nY2ggaXMgbm90IHdoYXQgbW9zdCB1c2VycyB3aWxsIHdhbnQKICAgICAgICBp\nZiAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUikKICAgICAgICAg\nICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAgICAg\naWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAgIGZtZC5zZXROdWxs\nVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7CiAgICAgICAg\naWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykKICAgICAg\nICAgICAgZm1kLnNldFR5cGVPdmVycmlkZShhbm5vLnRhcmdldEVudGl0eSgp\nKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2FkZSgpKTsK\nICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0YURhdGEu\nTUFOWV9UT19PTkUpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9u\nZVRvT25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPbmVUb09u\nZShGaWVsZE1ldGFEYXRhIGZtZCwgT25lVG9PbmUgYW5ubykgewogICAgICAg\nIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiT25lVG9P\nbmUiKSk7CgogICAgICAgIC8vIGRvbid0IHNwZWNpZmljYWxseSBleGNsdWRl\nIHJlbGF0aW9uIGZyb20gREZHIGIvYyB0aGF0IHdpbGwgcHJldmVudAogICAg\nICAgIC8vIHVzIGZyb20gZXZlbiByZWFkaW5nIHRoZSBmayB3aGVuIHJlYWRp\nbmcgZnJvbSB0aGUgcHJpbWFyeSB0YWJsZSwKICAgICAgICAvLyB3aGljaCBp\ncyBub3Qgd2hhdCBtb3N0IHVzZXJzIHdpbGwgd2FudAogICAgICAgIGlmIChh\nbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKQogICAgICAgICAgICBm\nbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAgICBpZiAo\nIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAgZm1kLnNldE51bGxWYWx1\nZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9OKTsKCiAgICAgICAgaWYg\nKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYmICFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBw\nZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGlmIChhbm5vLnRhcmdl\ndEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5zZXRU\neXBlT3ZlcnJpZGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0\nQ2FzY2FkZXMoZm1kLCBhbm5vLmNhc2NhZGUoKSk7CiAgICAgICAgc2V0T3Jw\naGFuUmVtb3ZhbChmbWQsIGFubm8ub3JwaGFuUmVtb3ZhbCgpKTsKICAgICAg\nICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0YURhdGEuT05FX1RP\nX09ORSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARW1iZWRkZWQu\nIEdpdmVuIGFubm90YXRpb24gbWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZUVtYmVkZGVkKEZpZWxkTWV0YURhdGEgZm1kLCBF\nbWJlZGRlZCBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwK\nICAgICAgICAgICAgICAgICJFbWJlZGRlZCIpKTsKCiAgICAgICAgZm1kLnNl\ndEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAgICAgZm1kLnNldEVt\nYmVkZGVkKHRydWUpOwoKICAgICAgICBpZiAoZm1kLmdldEVtYmVkZGVkTWV0\nYURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICBmbWQuYWRkRW1iZWRkZWRN\nZXRhRGF0YShnZXRBY2Nlc3NDb2RlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9uZVRvTWFueS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlT25lVG9NYW55KEZpZWxkTWV0\nYURhdGEgZm1kLCBPbmVUb01hbnkgYW5ubykgewogICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgog\nICAgICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRF\nbGVtZW50KCkpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAg\nICAiT25lVG9NYW55IikpOwogICAgICAgIH0KCiAgICAgICAgZm1kLnNldElu\nRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5F\nQUdFUik7CiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYm\nICFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAg\nICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAg\nICAgIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAg\nICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFu\nbm8udGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZC5n\nZXRFbGVtZW50KCksIGFubm8uY2FzY2FkZSgpKTsKICAgICAgICBzZXRPcnBo\nYW5SZW1vdmFsKGZtZC5nZXRFbGVtZW50KCksIGFubm8ub3JwaGFuUmVtb3Zh\nbCgpKTsKICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0\nYURhdGEuT05FX1RPX01BTlkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQE1hbnlUb01hbnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZU1hbnlUb01hbnkoRmllbGRNZXRhRGF0YSBmbWQsIE1hbnlUb01hbnkgYW5u\nbykgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgaWYgKEphdmFU\neXBlcy5tYXliZVBDKGZtZC5nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZt\nZCwKICAgICAgICAgICAgICAgICAgICAiT25lVG9NYW55IikpOwogICAgICAg\nIH0KCiAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5m\nZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGlzTWFw\ncGluZ092ZXJyaWRlTW9kZSgpICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGFu\nbm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShh\nbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGlmIChhbm5vLnRhcmdldEVudGl0\neSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50\nKCkuc2V0RGVjbGFyZWRUeXBlKGFubm8udGFyZ2V0RW50aXR5KCkpOwogICAg\nICAgIHNldENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCksIGFubm8uY2FzY2Fk\nZSgpKTsKICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0\nYURhdGEuTUFOWV9UT19NQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBNYXBLZXkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1h\ncEtleShGaWVsZE1ldGFEYXRhIGZtZCwgTWFwS2V5IGFubm8pIHsKICAgICAg\nICBTdHJpbmcgbmFtZSA9IGFubm8ubmFtZSgpOwogICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICBmbWQuZ2V0S2V5\nKCkuc2V0VmFsdWVNYXBwZWRCeShWYWx1ZU1ldGFEYXRhLk1BUFBFRF9CWV9Q\nSyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmbWQuZ2V0S2V5KCkuc2V0\nVmFsdWVNYXBwZWRCeShuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBNYXBLZXlDbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlTWFwS2V5Q2xhc3MoRmllbGRNZXRhRGF0YSBmbWQsIE1hcEtleUNsYXNz\nIGFubm8pIHsKICAgICAgICBpZiAoYW5uby52YWx1ZSgpICE9IHZvaWQuY2xh\nc3MpCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXREZWNsYXJlZFR5cGUo\nYW5uby52YWx1ZSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oCiAgICAgICAgICAgICAg\nICAgIlRoZSB2YWx1ZSBvZiB0aGUgTWFwQ2xhc3NDbGFzcyBjYW5ub3QgYmUg\nbnVsbCIpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hcHNJZC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFwc0lkKEZpZWxkTWV0\nYURhdGEgZm1kLCBNYXBzSWQgYW5ubykgewogICAgICAgIFN0cmluZyB2YWx1\nZSA9IGFubm8udmFsdWUoKTsKICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkK\nICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5SWRWYWx1ZSh2YWx1ZSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBmbWQuc2V0TWFwcGVkQnlJZFZhbHVl\nKCIiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHVwIHRoZSBmaWVsZCBh\ncyBhIExPQiBtYXBwaW5nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBw\nYXJzZUxvYk1hcHBpbmcoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIEBPcmRlckJ5LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VPcmRlckJ5KEZpZWxkTWV0YURhdGEgZm1kLCBPcmRl\nckJ5IGFubm8pIHsKICAgICAgICBTdHJpbmcgZGVjID0gYW5uby52YWx1ZSgp\nOwogICAgICAgIGlmIChmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpICYmCiAg\nICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0RW1iZWRkZWRNZXRhRGF0\nYSgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChkZWMubGVuZ3Ro\nKCkgPT0gMCB8fCBkZWMuZXF1YWxzKCJBU0MiKSB8fAogICAgICAgICAgICAg\nICAgICAgIGRlYy5lcXVhbHMoIkRFU0MiKSkKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoCiAgICAg\nICAgICAgICAgICAgICAgICAgICJpbnZhbGlkLW9yZGVyQnkiLCBmbWQpKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKGRlYy5sZW5ndGgoKSA9PSAwIHx8IGRl\nYy5lcXVhbHMoIkFTQyIpKQogICAgICAgICAgICBkZWMgPSBPcmRlci5FTEVN\nRU5UICsgIiBhc2MiOwogICAgICAgIGVsc2UgaWYgKGRlYy5lcXVhbHMoIkRF\nU0MiKSkKICAgICAgICAgICAgZGVjID0gT3JkZXIuRUxFTUVOVCArICIgZGVz\nYyI7CgogICAgICAgIGZtZC5zZXRPcmRlckRlY2xhcmF0aW9uKGRlYyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudChGaWVsZE1ldGFE\nYXRhIGZtZCwgUGVyc2lzdGVudCBhbm5vKSB7CiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAgICAgICAgICAgICAg\nICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQnl0ZVtdLmNsYXNz\nCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgp\nID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1l\ndGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVu\ndCIpKTsKICAgICAgICB9CgogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQuc2V0TWFw\ncGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBmbWQuc2V0SW5EZWZh\ndWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VS\nKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAg\nZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9O\nKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2FkZSgpKTsK\nICAgICAgICBpZiAoYW5uby5lbWJlZGRlZCgpKSB7CiAgICAgICAgICAgIGlm\nICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJQ\nZXJzaXN0ZW50KGVtYmVkZGVkPXRydWUpIikpOwogICAgICAgICAgICBmbWQu\nc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGZt\nZC5hZGRFbWJlZGRlZE1ldGFEYXRhKGdldEFjY2Vzc0NvZGUoZm1kLmdldERl\nY2xhcmVkVHlwZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudENvbGxlY3Rpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNpc3RlbnRDb2xs\nZWN0aW9uKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIFBlcnNpc3RlbnRD\nb2xsZWN0aW9uIGFubm8pIHsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuQVJSQVkKICAgICAgICAgICAgJiYg\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuQ09MTEVD\nVElPTikKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAg\nICAgIlBlcnNpc3RlbnRDb2xsZWN0aW9uIikpOwoKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAg\nICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAg\nZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZl\ndGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGFubm8uZWxlbWVudFR5cGUo\nKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgp\nLnNldERlY2xhcmVkVHlwZShhbm5vLmVsZW1lbnRUeXBlKCkpOwogICAgICAg\nIHNldENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCksIGFubm8uZWxlbWVudENh\nc2NhZGUoKSk7CiAgICAgICAgaWYgKGFubm8uZWxlbWVudEVtYmVkZGVkKCkp\nIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0\nRWxlbWVudCgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAg\nICAgICAgICAgICAgICAgICAiUGVyc2lzdGVudENvbGxlY3Rpb24oZW1iZWRk\nZWRFbGVtZW50PXRydWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0RWxlbWVu\ndCgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1kLmdl\ndEVsZW1lbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5hZGRFbWJlZGRlZE1l\ndGFEYXRhKAogICAgICAgICAgICAgICAgICAgIGdldEFjY2Vzc0NvZGUoZm1k\nLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEVs\nZW1lbnRDb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VFbGVtZW50Q29sbGVjdGlvbihGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAg\nICBFbGVtZW50Q29sbGVjdGlvbiBhbm5vKSB7CiAgICAgICAgLy8gVE9ETzog\ndGhyb3cgZXhjZXB0aW9uIGlmIHRoZSBydW50aW1lIGVudiBpcyBPcGVuSnBh\nIDEueAoKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSAh\nPSBKYXZhVHlwZXMuQ09MTEVDVElPTiAmJgogICAgICAgICAgICBmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5NQVApCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJFbGVtZW50Q29s\nbGVjdGlvbiIpKTsKCiAgICAgICAgaWYgKGFubm8udGFyZ2V0Q2xhc3MoKSAh\nPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNl\ndERlY2xhcmVkVHlwZShhbm5vLnRhcmdldENsYXNzKCkpOwogICAgICAgIGZt\nZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRj\naFR5cGUuRUFHRVIpOwogICAgICAgIGZtZC5zZXRFbGVtZW50Q29sbGVjdGlv\nbih0cnVlKTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIGVsZW0gPSBmbWQuZ2V0\nRWxlbWVudCgpOwogICAgICAgIGJvb2xlYW4gaXNFbnVtID0gZWxlbS5nZXRE\nZWNsYXJlZFR5cGUoKS5pc0VudW0oKTsKICAgICAgICBpZiAoIWlzRW51bSAm\nJiBKYXZhVHlwZXMubWF5YmVQQyhlbGVtKSkgewogICAgICAgICAgICBlbGVt\nLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZWxlbS5nZXRF\nbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGVs\nZW0uYWRkRW1iZWRkZWRNZXRhRGF0YShnZXRBY2Nlc3NDb2RlKGVsZW0uZ2V0\nRGVjbGFyZWRUeXBlKCkpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQYXJzZSBAUGVyc2lzdGVudE1hcC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHBhcnNlUGVyc2lzdGVudE1hcChGaWVsZE1ldGFEYXRhIGZtZCwg\nUGVyc2lzdGVudE1hcCBhbm5vKSB7CiAgICAgICAgaWYgKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLk1BUCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0\nYS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRNYXAi\nKSk7CgogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8u\nZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlmIChhbm5v\nLmtleVR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0\nS2V5KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8ua2V5VHlwZSgpKTsKICAgICAg\nICBpZiAoYW5uby5lbGVtZW50VHlwZSgpICE9IHZvaWQuY2xhc3MpCiAgICAg\nICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8u\nZWxlbWVudFR5cGUoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEtl\neSgpLCBhbm5vLmtleUNhc2NhZGUoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMo\nZm1kLmdldEVsZW1lbnQoKSwgYW5uby5lbGVtZW50Q2FzY2FkZSgpKTsKICAg\nICAgICBpZiAoYW5uby5rZXlFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgIGlm\nICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEtleSgpKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVy\nc2lzdGVudE1hcChlbWJlZGRlZEtleT10cnVlKSIpKTsKICAgICAgICAgICAg\nZm1kLmdldEtleSgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBp\nZiAoZm1kLmdldEtleSgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5KCkuYWRkRW1iZWRkZWRN\nZXRhRGF0YSgKICAgICAgICAgICAgICAgICAgICBnZXRBY2Nlc3NDb2RlKGZt\nZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUoKSkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGlmIChhbm5vLmVsZW1lbnRFbWJlZGRlZCgp\nKSB7CiAgICAgICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdl\ndEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAg\nICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRNYXAoZW1iZWRkZWRWYWx1\nZT10cnVlKSIpKTsKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRF\nbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50\nKCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAg\nICAgICBmbWQuZ2V0RWxlbWVudCgpLmFkZEVtYmVkZGVkTWV0YURhdGEoCiAg\nICAgICAgICAgICAgICAgICAgZ2V0QWNjZXNzQ29kZShmbWQuZ2V0RWxlbWVu\ndCgpLmdldERlY2xhcmVkVHlwZSgpKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IGNhc2NhZGVzIG9uIHJlbGF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgc2V0Q2FzY2FkZXMoVmFsdWVNZXRhRGF0YSB2\nbWQsIENhc2NhZGVUeXBlW10gY2FzY2FkZXMpIHsKICAgICAgICBmb3IgKENh\nc2NhZGVUeXBlIGNhc2NhZGUgOiBjYXNjYWRlcykgewogICAgICAgICAgICBp\nZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBD\nYXNjYWRlVHlwZS5SRU1PVkUpCiAgICAgICAgICAgICAgICB2bWQuc2V0Q2Fz\nY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsK\nICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxMIHx8\nIGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuUEVSU0lTVCkKICAgICAgICAgICAg\nICAgIHZtZC5zZXRDYXNjYWRlUGVyc2lzdChWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfSU1NRURJQVRFKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2Fz\nY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuTUVSR0Up\nCiAgICAgICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZUF0dGFjaChWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAgICAgICAgaWYgKGNh\nc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2Fk\nZVR5cGUuREVUQUNIKQogICAgICAgICAgICAgICAgdm1kLnNldENhc2NhZGVE\nZXRhY2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAgICAg\nICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBjYXNj\nYWRlID09IENhc2NhZGVUeXBlLlJFRlJFU0gpCiAgICAgICAgICAgICAgICB2\nbWQuc2V0Q2FzY2FkZVJlZnJlc2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lN\nTUVESUFURSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBz\nZXRPcnBoYW5SZW1vdmFsKFZhbHVlTWV0YURhdGEgdm1kLCBib29sZWFuIG9y\ncGhhblJlbW92YWwpIHsKICAgICAgICBpZiAob3JwaGFuUmVtb3ZhbCkKICAg\nICAgICAgICAgdm1kLnNldENhc2NhZGVEZWxldGUoVmFsdWVNZXRhRGF0YS5D\nQVNDQURFX0FVVE8pOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFNl\ncXVlbmNlR2VuZXJhdG9yLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VTZXF1ZW5jZUdlbmVyYXRvcihBbm5vdGF0ZWRFbGVtZW50IGVsLAogICAg\nICAgIFNlcXVlbmNlR2VuZXJhdG9yIGdlbikgewogICAgICAgIFN0cmluZyBu\nYW1lID0gZ2VuLm5hbWUoKTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShuYW1lKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1zZXEtbmFtZSIsIGVsKSk7CgogICAgICAg\nIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoInBhcnNlLXNlcXVlbmNlIiwgbmFtZSkpOwoKICAg\nICAgICBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCku\nZ2V0Q2FjaGVkU2VxdWVuY2VNZXRhRGF0YQogICAgICAgICAgICAobmFtZSk7\nCiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImR1cC1zZXF1ZW5jZSIsIG5hbWUsIGVsKSk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBu\nZXcgc2VxdWVuY2UKICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFk\nZFNlcXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAgU3RyaW5nIHNlcSA9\nIGdlbi5zZXF1ZW5jZU5hbWUoKTsKICAgICAgICAvLyBEbyBub3Qgbm9ybWFs\naXplIHRoZSBzZXF1ZW5jZSBuYW1lIGlmIGl0IGFwcGVhcnMgdG8gYmUgYSBw\nbHVnaW4gCiAgICAgICAgaWYgKHNlcS5pbmRleE9mKCcoJykgPT0gLTEpewog\nICAgICAgICAgICBzZXEgPSBub3JtYWxpemVTZXF1ZW5jZU5hbWUoc2VxKTsK\nICAgICAgICB9CiAgICAgICAgaW50IGluaXRpYWwgPSBnZW4uaW5pdGlhbFZh\nbHVlKCk7CiAgICAgICAgaW50IGFsbG9jYXRlID0gZ2VuLmFsbG9jYXRpb25T\naXplKCk7CiAgICAgICAgU3RyaW5nIHNjaGVtYSA9IG5vcm1hbGl6ZVNjaGVt\nYU5hbWUoZ2VuLnNjaGVtYSgpKTsKICAgICAgICBTdHJpbmcgY2F0YWxvZyA9\nIG5vcm1hbGl6ZUNhdGFsb2dOYW1lKGdlbi5jYXRhbG9nKCkpOwogICAgICAg\nIC8vIGRvbid0IGFsbG93IGluaXRpYWwgb2YgMCBiL2MgbG9va3MgbGlrZSBk\nZWYgdmFsdWUKICAgICAgICBpZiAoaW5pdGlhbCA9PSAwKQogICAgICAgICAg\nICBpbml0aWFsID0gMTsKCiAgICAgICAgLy8gY3JlYXRlIHBsdWdpbiBzdHJp\nbmcgZnJvbSBpbmZvCiAgICAgICAgU3RyaW5nIGNsc05hbWUsIHByb3BzOwog\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNlcSkpIHsKICAgICAg\nICAgICAgY2xzTmFtZSA9IFNlcXVlbmNlTWV0YURhdGEuSU1QTF9OQVRJVkU7\nCiAgICAgICAgICAgIHByb3BzID0gbnVsbDsKICAgICAgICB9IGVsc2UgaWYg\nKHNlcS5pbmRleE9mKCcoJykgIT0gLTEpIC8vIHBsdWdpbgogICAgICAgIHsK\nICAgICAgICAgICAgY2xzTmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNz\nTmFtZShzZXEpOwogICAgICAgICAgICBwcm9wcyA9IENvbmZpZ3VyYXRpb25z\nLmdldFByb3BlcnRpZXMoc2VxKTsKICAgICAgICAgICAgc2VxID0gbnVsbDsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjbHNOYW1lID0gU2VxdWVu\nY2VNZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJvcHMgPSBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgbWV0YS5zZXRTZXF1ZW5jZVBsdWdp\nbihDb25maWd1cmF0aW9ucy5nZXRQbHVnaW4oY2xzTmFtZSwgcHJvcHMpKTsK\nICAgICAgICBtZXRhLnNldFNlcXVlbmNlKHNlcSk7CiAgICAgICAgbWV0YS5z\nZXRJbml0aWFsVmFsdWUoaW5pdGlhbCk7CiAgICAgICAgbWV0YS5zZXRBbGxv\nY2F0ZShhbGxvY2F0ZSk7CiAgICAgICAgbWV0YS5zZXRTY2hlbWEoc2NoZW1h\nKTsKICAgICAgICBtZXRhLnNldENhdGFsb2coY2F0YWxvZyk7CiAgICAgICAg\nbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNlRmlsZSgpLCAoZWwgaW5zdGFuY2Vv\nZiBDbGFzcykgPyBlbCA6IG51bGwsCiAgICAgICAgICAgIFNvdXJjZVRyYWNr\nZXIuU1JDX0FOTk9UQVRJT05TKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBOYW1lZFF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VOYW1lZFF1ZXJpZXMoQW5ub3RhdGVkRWxlbWVudCBlbCwgTmFtZWRRdWVy\neS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRhOwog\nICAgICAgIGZvciAoTmFtZWRRdWVyeSBxdWVyeSA6IHF1ZXJpZXMpIHsKICAg\nICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkubmFtZSgp\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tcXVlcnktbmFtZSIsIGVsKSk7CiAgICAgICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1xdWVyeS1zdHJpbmciLAogICAgICAgICAgICAgICAgICAgIHF1\nZXJ5Lm5hbWUoKSwgZWwpKTsKCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJwYXJzZS1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSkpOwoKICAgICAgICAg\nICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5zZWFyY2hRdWVyeU1ldGFEYXRh\nQnlOYW1lKHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChtZXRhICE9\nIG51bGwpIHsKICAgICAgICAgICAgCUNsYXNzPD8+IGRlZmluaW5nVHlwZSA9\nIG1ldGEuZ2V0RGVmaW5pbmdUeXBlKCk7CiAgICAgICAgICAgICAgICBpZiAo\nKGRlZmluaW5nVHlwZSA9PSBudWxsIHx8IGRlZmluaW5nVHlwZSAhPSBfY2xz\nKQogICAgICAgICAgICAgICAgICAmJiBfbG9nLmlzV2FybkVuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHVw\nLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBlbCwKICAgICAgICAgICAgICAgICAg\nICAJCWRlZmluaW5nVHlwZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRhKF9jbHMs\nIHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0UXVlcnlTdHJp\nbmcocXVlcnkucXVlcnkoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0TGFuZ3Vh\nZ2UoSlBRTFBhcnNlci5MQU5HX0pQUUwpOwogICAgICAgICAgICBmb3IgKFF1\nZXJ5SGludCBoaW50IDogcXVlcnkuaGludHMoKSkKICAgICAgICAgICAgICAg\nIG1ldGEuYWRkSGludChoaW50Lm5hbWUoKSwgaGludC52YWx1ZSgpKTsKICAg\nICAgICAgICAgaWYgKHF1ZXJ5LmxvY2tNb2RlKCkgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgbWV0YS5hZGRIaW50KCJvcGVuanBhLkZldGNoUGxhbi5S\nZWFkTG9ja01vZGUiLCBxdWVyeS5sb2NrTW9kZSgpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCks\nIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAg\nICAgICAgIFNvdXJjZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05TKTsKICAgICAg\nICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICBt\nZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NRVRBKTsKICAgICAgICAgICAgZWxz\nZSBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0YS5z\nZXRTb3VyY2VNb2RlKE1PREVfTUFQUElORyk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX1FVRVJZ\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATmFt\nZWROYXRpdmVRdWVyeS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nTmFtZWROYXRpdmVRdWVyaWVzKEFubm90YXRlZEVsZW1lbnQgZWwsCiAgICAg\nICAgTmFtZWROYXRpdmVRdWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVl\ncnlNZXRhRGF0YSBtZXRhOwogICAgICAgIGZvciAoTmFtZWROYXRpdmVRdWVy\neSBxdWVyeSA6IHF1ZXJpZXMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkocXVlcnkubmFtZSgpKSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmF0aXZl\nLXF1ZXJ5LW5hbWUiLAogICAgICAgICAgICAgICAgICAgIGVsKSk7CiAgICAg\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1uYXRpdmUtcXVlcnktc3RyaW5nIiwKICAgICAgICAg\nICAgICAgICAgICBxdWVyeS5uYW1lKCksIGVsKSk7CgogICAgICAgICAgICBp\nZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy50cmFjZShfbG9jLmdldCgicGFyc2UtbmF0aXZlLXF1ZXJ5IiwgcXVlcnku\nbmFtZSgpKSk7CgogICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgp\nLnNlYXJjaFF1ZXJ5TWV0YURhdGFCeU5hbWUocXVlcnkubmFtZSgpKTsKICAg\nICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAJQ2xh\nc3M8Pz4gZGVmVHlwZSA9IG1ldGEuZ2V0RGVmaW5pbmdUeXBlKCk7CiAgICAg\nICAgICAgICAgICBpZiAoKGRlZlR5cGUgIT0gX2NscykgJiYgX2xvZy5pc1dh\ncm5FbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4o\nX2xvYy5nZXQoImR1cC1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSwgZWwsIGRlZlR5\ncGUpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtZXRhID0gZ2V0UmVw\nb3NpdG9yeSgpLmFkZFF1ZXJ5TWV0YURhdGEobnVsbCwgcXVlcnkubmFtZSgp\nKTsKICAgICAgICAgICAgbWV0YS5zZXRRdWVyeVN0cmluZyhxdWVyeS5xdWVy\neSgpKTsKICAgICAgICAgICAgbWV0YS5zZXRMYW5ndWFnZShRdWVyeUxhbmd1\nYWdlcy5MQU5HX1NRTCk7CiAgICAgICAgICAgIENsYXNzPD8+IHJlcyA9IHF1\nZXJ5LnJlc3VsdENsYXNzKCk7CiAgICAgICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlZFR5cGUoZ2V0Q29uZmlndXJhdGlvbigpLCByZXMpKQogICAg\nICAgICAgICAgICAgbWV0YS5zZXRDYW5kaWRhdGVUeXBlKHJlcyk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKCF2b2lkLmNsYXNzLmVxdWFscyhyZXMpKQogICAg\nICAgICAgICAgICAgbWV0YS5zZXRSZXN1bHRUeXBlKHJlcyk7CgogICAgICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkucmVzdWx0U2V0\nTWFwcGluZygpKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0UmVzdWx0U2V0\nTWFwcGluZ05hbWUocXVlcnkucmVzdWx0U2V0TWFwcGluZygpKTsKICAgICAg\nICAgICAgZm9yIChRdWVyeUhpbnQgaGludCA6IHF1ZXJ5LmhpbnRzKCkpCiAg\nICAgICAgICAgICAgICBtZXRhLmFkZEhpbnQoaGludC5uYW1lKCksIGhpbnQu\ndmFsdWUoKSk7CgogICAgICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3Vy\nY2VGaWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwK\nICAgICAgICAgICAgICAgIFNvdXJjZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05T\nKTsKICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NRVRBKTsKICAgICAg\nICAgICAgZWxzZSBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUFQUElORyk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShN\nT0RFX1FVRVJZKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGV4cGxpY2l0IGFjY2VzcyB0eXBlLCBpZiBzcGVjaWZpZWQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUFjY2VzcyhGaWVsZE1ldGFE\nYXRhIG1ldGEsIEFjY2VzcyBhY2Nlc3MpIHsKICAgIAlpZiAoYWNjZXNzICE9\nIG51bGwpIHsKICAgIAkJbWV0YS5zZXRBY2Nlc3NUeXBlKEFjY2Vzc0NvZGUu\nRVhQTElDSVQKICAgICAgICAgICAgfCAoYWNjZXNzLnZhbHVlKCkgPT0gQWNj\nZXNzVHlwZS5GSUVMRCA/CiAgICAgICAgICAgIAkJQWNjZXNzQ29kZS5GSUVM\nRCA6IEFjY2Vzc0NvZGUuUFJPUEVSVFkpKTsKICAgIAl9CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWV0aG9kS2V5IHsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBNZXRob2QgX21ldGhvZDsKCiAgICAgICAgcHVibGljIE1l\ndGhvZEtleShNZXRob2QgbSkgewogICAgICAgICAgICBfbWV0aG9kID0gbTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAg\nICAgICAgICAgIGludCBjb2RlID0gNDYgKiAxMiArIF9tZXRob2QuZ2V0TmFt\nZSgpLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIGZvciAoQ2xhc3M8Pz4gcGFy\nYW0gOiBfbWV0aG9kLmdldFBhcmFtZXRlclR5cGVzKCkpCiAgICAgICAgICAg\nICAgICBjb2RlID0gNDYgKiBjb2RlICsgcGFyYW0uaGFzaENvZGUoKTsKICAg\nICAgICAgICAgcmV0dXJuIGNvZGU7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAgICAgaWYg\nKCEobyBpbnN0YW5jZW9mIE1ldGhvZEtleSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIE1ldGhvZCBvdGhlciA9ICgoTWV0\naG9kS2V5KSBvKS5fbWV0aG9kOwogICAgICAgICAgICBpZiAoIV9tZXRob2Qu\nZ2V0TmFtZSgpLmVxdWFscyhvdGhlci5nZXROYW1lKCkpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gQXJyYXlz\nLmVxdWFscyhfbWV0aG9kLmdldFBhcmFtZXRlclR5cGVzKCksCiAgICAgICAg\nICAgICAgICBvdGhlci5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWV0aG9kQ29tcGFy\nYXRvciBpbXBsZW1lbnRzIENvbXBhcmF0b3I8TWV0aG9kPiB7CgogICAgICAg\nIHByaXZhdGUgc3RhdGljIE1ldGhvZENvbXBhcmF0b3IgSU5TVEFOQ0UgPSBu\ndWxsOwoKICAgICAgICBwdWJsaWMgc3RhdGljIE1ldGhvZENvbXBhcmF0b3Ig\nZ2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIGlmIChJTlNUQU5DRSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgSU5TVEFOQ0UgPSBuZXcgTWV0aG9kQ29t\ncGFyYXRvcigpOwogICAgICAgICAgICByZXR1cm4gSU5TVEFOQ0U7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoTWV0aG9kIG0xLCBN\nZXRob2QgbTIpIHsKICAgICAgICAgICAgQ2xhc3M8Pz4gYzEgPSBtMS5nZXRE\nZWNsYXJpbmdDbGFzcygpOwogICAgICAgICAgICBDbGFzczw/PiBjMiA9IG0y\nLmdldERlY2xhcmluZ0NsYXNzKCk7CiAgICAgICAgICAgIGlmICghYzEuZXF1\nYWxzKGMyKSkgewogICAgICAgICAgICAgICAgaWYgKGMxLmlzQXNzaWduYWJs\nZUZyb20oYzIpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAg\nICAgICAgICAgICAgIGVsc2UKCQkJCQlyZXR1cm4gMTsKCQkJfQoJCQlpbnQg\nY29tcGFyZSA9IG0xLmdldE5hbWUgKCkuY29tcGFyZVRvIChtMi5nZXROYW1l\nICgpKTsKCQkJaWYgKGNvbXBhcmUgPT0gMCkKCQkJCXJldHVybiBtMS5oYXNo\nQ29kZSAoKSAtIG0yLmhhc2hDb2RlICgpOwoJCQlyZXR1cm4gY29tcGFyZTsK\nCQl9Cgl9CgogICAgcHJvdGVjdGVkIFN0cmluZyBub3JtYWxpemVTZXF1ZW5j\nZU5hbWUoU3RyaW5nIHNlcU5hbWUpIHsKICAgICAgICByZXR1cm4gc2VxTmFt\nZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG5vcm1hbGl6ZVNjaGVt\nYU5hbWUoU3RyaW5nIHNjaE5hbWUpIHsKICAgICAgICByZXR1cm4gc2NoTmFt\nZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG5vcm1hbGl6ZUNhdGFs\nb2dOYW1lKFN0cmluZyBjYXROYW1lKSB7CiAgICAgICAgcmV0dXJuIGNhdE5h\nbWU7CiAgICB9Cn0KCg==\n","encoding":"base64"}

