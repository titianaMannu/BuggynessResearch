{"sha":"5e0b9d2edadbf001b6abc08da64629ee230e2d21","node_id":"MDQ6QmxvYjIwNjM2NDo1ZTBiOWQyZWRhZGJmMDAxYjZhYmMwOGRhNjQ2MjllZTIzMGUyZDIx","size":51023,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5e0b9d2edadbf001b6abc08da64629ee230e2d21","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJhY2tlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSmF2YVZl\ncnNpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQ\nQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS4qOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxh\nbmd1YWdlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVy\nbmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CgppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLio7CmltcG9ydCBqYXZhLmlv\nLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS5pby5Xcml0ZXI7CmltcG9ydCBqYXZhLmlvLkZpbGVXcml0ZXI7CmltcG9y\ndCBqYXZhLmxhbmcucmVmbGVjdC5NZW1iZXI7CmltcG9ydCBqYXZhLmxhbmcu\ncmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhv\nZDsKaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkFubm90YXRpb247Cgpp\nbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuRW50aXR5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW1iZWRk\nYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xh\nc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5JZENsYXNz\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW1iZWRkZWRJZDsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlZlcnNpb247CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5UcmFuc2llbnQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5C\nYXNpYzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGVkOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5PbmVUb01hbnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9N\nYW55OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT3JkZXJCeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleTsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLkF0dHJpYnV0ZU92ZXJyaWRlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5G\nZXRjaFR5cGU7CgovL0B0b2RvOiBqYXZhZG9jcwoKLyoqCiAqIFNlcmlhbGl6\nZXMgcGVyc2lzdGVuY2UgbWV0YWRhdGEgYXMgYW5ub3RhdGlvbnMuCiAqIFRo\naXMgY2xhc3MgcHJvY2Vzc2VzIGFsbCBvYmplY3QgbGV2ZWwgdGFncyB0aGF0\nIGFyZSBzdG9yZS1hZ25vc3RpYy4KICogSG93ZXZlciwgaXQgcHJvdmlkZXMg\naG9va3MgZm9yIHRoZSBzdWJjbGFzc2VzIHRvIGluY2x1ZGUgc3RvcmUtc3Bl\nY2lmaWMKICogdGFncyB0byBiZSBzZXJpYWxpemVkIGJvdGggYXQgJmx0O2Vu\ndGl0eS1tYXBwaW5ncyZndDsgYW5kCiAqICZsdDtlbnRpdHkmZ3Q7IGxldmVs\nLgogKgogKiBAc2luY2UgMS4wLjAKICogQGF1dGhvciBTdGV2ZSBLaW0KICog\nQGF1dGhvciBHb2toYW4gRXJndWwKICogQG5vamF2YWRvYwogKi8KcHVibGlj\nIGNsYXNzIEFubm90YXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXpl\ncgogICAgaW1wbGVtZW50cyBQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeS5T\nZXJpYWxpemVyIHsKCiAgICAvLyBOT1RFOiBvcmRlciBpcyBpbXBvcnRhbnQh\nIHRoZXNlIGNvbnN0YW50cyBtdXN0IGJlIG1haW50YWluZWQgaW4KICAgIC8v\nIHNlcmlhbGl6YXRpb24gb3JkZXIuIGNvbnN0YW50cyBhcmUgc3BhY2VkIHNv\nIHRoYXQgc3ViY2xhc3NlcyBjYW4KICAgIC8vIHNsaXAgdGFncyBpbi1iZXR3\nZWVuCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUWVBFX1NFUSA9\nIDEwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9RVUVS\nWSA9IDIwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9N\nRVRBID0gMzA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUWVBF\nX0NMQVNTX1NFUVMgPSA0MDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFRZUEVfQ0xBU1NfUVVFUklFUyA9IDUwOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UKICAgICAgICAoQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFTZXJp\nYWxpemVyLmNsYXNzKTsKCiAgICBwcml2YXRlIExvZyBfbG9nID0gbnVsbDsK\nICAgIAogICAgcHJpdmF0ZSBmaW5hbCBPcGVuSlBBQ29uZmlndXJhdGlvbiBf\nY29uZjsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgQ2xhc3NNZXRhRGF0YT4g\nX21ldGFzID0gbnVsbDsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgTGlzdD4g\nX3F1ZXJpZXMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBMaXN0\nPiBfc2VxcyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbW9kZSA9IE1ldGFE\nYXRhTW9kZXMuTU9ERV9OT05FOwogICAgcHJpdmF0ZSBTZXJpYWxpemF0aW9u\nQ29tcGFyYXRvciBfY29tcCA9IG51bGw7CgogICAgcHJpdmF0ZSBNYXA8Q2xh\nc3NNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+IF9jbHNBbm5v\ncyA9IG51bGw7CiAgICBwcml2YXRlIE1hcDxGaWVsZE1ldGFEYXRhLCBMaXN0\nPEFubm90YXRpb25CdWlsZGVyPj4gX2ZsZEFubm9zID0gbnVsbDsKICAgIHBy\naXZhdGUgTWFwPFNlcXVlbmNlTWV0YURhdGEsIExpc3Q8QW5ub3RhdGlvbkJ1\naWxkZXI+PiBfc2VxQW5ub3MgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8UXVl\ncnlNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+IF9xcnlBbm5v\ncyA9IG51bGw7IAoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgQW5ub3RhdGlv\nblBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyKE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAg\nc2V0TG9nKGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19N\nRVRBREFUQSkpOwogICAgICAgIHNldE1vZGUoTWV0YURhdGFNb2Rlcy5NT0RF\nX01FVEEgfCBNZXRhRGF0YU1vZGVzLk1PREVfTUFQUElORyB8CiAgICAgICAg\nICAgIE1ldGFEYXRhTW9kZXMuTU9ERV9RVUVSWSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbG9n\nIHRvIHdyaXRlIHRvLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygp\nIHsKICAgICAgICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBsb2cgdG8gd3JpdGUgdG8uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldExvZyhMb2cgbG9nKSB7CiAgICAgICAgX2xvZyA9IGxvZzsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBUaGUgc2VyaWFsaXphdGlvbiBtb2RlIGFj\nY29yZGluZyB0byB0aGUgZXhwZWN0ZWQgZG9jdW1lbnQgdHlwZS4gVGhlCiAg\nICAgKiBtb2RlIGNvbnN0YW50cyBhY3QgYXMgYml0IGZsYWdzLCBhbmQgdGhl\ncmVmb3JlIGNhbiBiZSBjb21iaW5lZC4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRNb2RlKCkgewogICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBzZXJpYWxpemF0aW9uIG1vZGUgYWNjb3JkaW5n\nIHRvIHRoZSBleHBlY3RlZCBkb2N1bWVudCB0eXBlLiBUaGUKICAgICAqIG1v\nZGUgY29uc3RhbnRzIGFjdCBhcyBiaXQgZmxhZ3MsIGFuZCB0aGVyZWZvcmUg\nY2FuIGJlIGNvbWJpbmVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRN\nb2RlKGludCBtb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNlcmlhbGl6YXRpb24gbW9kZSBhY2NvcmRp\nbmcgdG8gdGhlIGV4cGVjdGVkIGRvY3VtZW50IHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldE1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsK\nICAgICAgICBpZiAobW9kZSA9PSBNZXRhRGF0YU1vZGVzLk1PREVfTk9ORSkK\nICAgICAgICAgICAgc2V0TW9kZShNZXRhRGF0YU1vZGVzLk1PREVfTk9ORSk7\nCiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIHNldE1vZGUoX21v\nZGUgfCBtb2RlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldE1vZGUo\nX21vZGUgJiB+bW9kZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01ldGFEYXRhTW9k\nZSgpIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5N\nT0RFX01FVEEpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1F1ZXJ5TW9kZSgp\nIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5NT0RF\nX1FVRVJZKSAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVu\nY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgp\nIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5NT0RF\nX01BUFBJTkcpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLiBUYWtlcyBpbnRvCiAgICAgKiBhY2NvdW50IHdoZXRoZXIgbWFwcGluZyBp\nbmZvcm1hdGlvbiBpcyBsb2FkZWQgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gaXNNYXBwaW5n\nTW9kZSgpICYmIChtZXRhLmdldFNvdXJjZU1vZGUoKQogICAgICAgICAgICAm\nIE1ldGFEYXRhTW9kZXMuTU9ERV9NQVBQSU5HKSAhPSAwCiAgICAgICAgICAg\nICYmIChtZXRhLmdldEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbAogICAg\nICAgICAgICB8fCAhbWV0YS5pc0VtYmVkZGVkT25seSgpKQogICAgICAgICAg\nICAmJiAobWV0YS5nZXRFbWJlZGRpbmdNZXRhRGF0YSgpID09IG51bGwKICAg\nICAgICAgICAgfHwgaXNNYXBwaW5nTW9kZShtZXRhLmdldEVtYmVkZGluZ01l\ndGFEYXRhKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNl\nIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uIFRh\na2VzIGludG8KICAgICAqIGFjY291bnQgd2hldGhlciBtYXBwaW5nIGluZm9y\nbWF0aW9uIGlzIGxvYWRlZCBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01hcHBpbmdNb2RlKFZhbHVl\nTWV0YURhdGEgdm1kKSB7CiAgICAgICAgcmV0dXJuIGlzTWFwcGluZ01vZGUo\ndm1kLmdldEZpZWxkTWV0YURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgY2xhc3MgbWV0YSBkYXRh\nIHRvIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgYWRkTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpZiAoX21ldGFzID09IG51bGwpCiAgICAgICAgICAgIF9tZXRh\ncyA9IG5ldyBIYXNoTWFwPFN0cmluZywgQ2xhc3NNZXRhRGF0YT4oKTsKICAg\nICAgICBfbWV0YXMucHV0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5h\nbWUoKSwgbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBzZXF1\nZW5jZSBtZXRhIGRhdGEgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRTZXF1ZW5jZU1ldGFEYXRhKFNl\ncXVlbmNlTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdCBzZXFzID0g\nbnVsbDsKICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAgICAg\naWYgKG1ldGEuZ2V0U291cmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQog\nICAgICAgICAgICBkZWZOYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3VyY2VT\nY29wZSgpKS5nZXROYW1lKCk7CiAgICAgICAgaWYgKF9zZXFzID09IG51bGwp\nCiAgICAgICAgICAgIF9zZXFzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBMaXN0\nPigpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VxcyA9IF9zZXFzLmdl\ndChkZWZOYW1lKTsKCiAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkgewogICAg\nICAgICAgICBzZXFzID0gbmV3IEFycmF5TGlzdCgzKTsgLy8gZG9uJ3QgZXhw\nZWN0IG1hbnkgc2VxcyAvIGNsYXNzCiAgICAgICAgICAgIHNlcXMuYWRkKG1l\ndGEpOwogICAgICAgICAgICBfc2Vxcy5wdXQoZGVmTmFtZSwgc2Vxcyk7CiAg\nICAgICAgfSBlbHNlIGlmICghc2Vxcy5jb250YWlucyhtZXRhKSkKICAgICAg\nICAgICAgc2Vxcy5hZGQobWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgYSBxdWVyeSBtZXRhIGRhdGEgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxp\nemVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRRdWVyeU1ldGFEYXRh\nKFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdCBxdWVyaWVz\nID0gbnVsbDsKICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAg\nICAgaWYgKG1ldGEuZ2V0U291cmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNz\nKQogICAgICAgICAgICBkZWZOYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3Vy\nY2VTY29wZSgpKS5nZXROYW1lKCk7CiAgICAgICAgaWYgKF9xdWVyaWVzID09\nIG51bGwpCiAgICAgICAgICAgIF9xdWVyaWVzID0gbmV3IEhhc2hNYXA8U3Ry\naW5nLCBMaXN0PigpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcXVlcmll\ncyA9IF9xdWVyaWVzLmdldChkZWZOYW1lKTsKCiAgICAgICAgaWYgKHF1ZXJp\nZXMgPT0gbnVsbCkgewogICAgICAgICAgICBxdWVyaWVzID0gbmV3IEFycmF5\nTGlzdCgzKTsgLy8gZG9uJ3QgZXhwZWN0IG1hbnkgcXVlcmllcyAvIGNsYXNz\nCiAgICAgICAgICAgIHF1ZXJpZXMuYWRkKG1ldGEpOwogICAgICAgICAgICBf\ncXVlcmllcy5wdXQoZGVmTmFtZSwgcXVlcmllcyk7CiAgICAgICAgfSBlbHNl\nIGlmICghcXVlcmllcy5jb250YWlucyhtZXRhKSkKICAgICAgICAgICAgcXVl\ncmllcy5hZGQobWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYWxs\nIGNvbXBvbmVudHMgaW4gdGhlIGdpdmVuIHJlcG9zaXRvcnkgdG8gdGhlIHNl\ndCB0byBiZSBzZXJpYWxpemVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBh\nZGRBbGwoTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgaWYg\nKHJlcG9zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nZm9yIChDbGFzc01ldGFEYXRhIG1ldGEgOiByZXBvcy5nZXRNZXRhRGF0YXMo\nKSkKICAgICAgICAgICAgYWRkTWV0YURhdGEobWV0YSk7CiAgICAgICAgZm9y\nIChTZXF1ZW5jZU1ldGFEYXRhIHNlcSA6IHJlcG9zLmdldFNlcXVlbmNlTWV0\nYURhdGFzKCkpCiAgICAgICAgICAgIGFkZFNlcXVlbmNlTWV0YURhdGEoc2Vx\nKTsKICAgICAgICBmb3IgKFF1ZXJ5TWV0YURhdGEgcXVlcnkgOiByZXBvcy5n\nZXRRdWVyeU1ldGFEYXRhcygpKQogICAgICAgICAgICBhZGRRdWVyeU1ldGFE\nYXRhKHF1ZXJ5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIG1l\ndGFkYXRhIGZyb20gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICoK\nICAgICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3Qg\naW4gc2V0CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZU1ldGFE\nYXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBfbWV0\nYXMgIT0gbnVsbCAmJiBtZXRhICE9IG51bGwKICAgICAgICAgICAgJiYgX21l\ndGFzLnJlbW92ZShtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkp\nICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzZXF1\nZW5jZSBtZXRhZGF0YSBmcm9tIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2Ug\naWYgbm90IGluIHNldAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1v\ndmVTZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIGlmIChfc2VxcyA9PSBudWxsIHx8IG1ldGEgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIFN0cmluZyBkZWZOYW1l\nID0gbnVsbDsKICAgICAgICBpZiAobWV0YS5nZXRTb3VyY2VTY29wZSgpIGlu\nc3RhbmNlb2YgQ2xhc3MpCiAgICAgICAgICAgIGRlZk5hbWUgPSAoKENsYXNz\nKSBtZXRhLmdldFNvdXJjZVNjb3BlKCkpLmdldE5hbWUoKTsKICAgICAgICBM\naXN0IHNlcXMgPSBfc2Vxcy5nZXQoZGVmTmFtZSk7CiAgICAgICAgaWYgKHNl\ncXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmICghc2Vxcy5yZW1vdmUobWV0YSkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICBpZiAoc2Vxcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIF9zZXFzLnJlbW92ZShkZWZOYW1lKTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIHF1ZXJ5IG1ldGFkYXRh\nIGZyb20gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICoKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gc2V0\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURh\ndGEoUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKF9xdWVyaWVz\nID09IG51bGwgfHwgbWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgU3RyaW5nIGRlZk5hbWUgPSBudWxsOwogICAgICAg\nIGlmIChtZXRhLmdldFNvdXJjZVNjb3BlKCkgaW5zdGFuY2VvZiBDbGFzcykK\nICAgICAgICAgICAgZGVmTmFtZSA9ICgoQ2xhc3MpIG1ldGEuZ2V0U291cmNl\nU2NvcGUoKSkuZ2V0TmFtZSgpOwogICAgICAgIExpc3QgcXVlcmllcyA9IF9x\ndWVyaWVzLmdldChkZWZOYW1lKTsKICAgICAgICBpZiAocXVlcmllcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFx\ndWVyaWVzLnJlbW92ZShtZXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIGlmIChxdWVyaWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\nX3F1ZXJpZXMucmVtb3ZlKGRlZk5hbWUpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGFsbCB0aGUgY29tcG9u\nZW50cyBpbiB0aGUgZ2l2ZW4gcmVwb3NpdG9yeSBmcm9tIHRoZSBzZXQgdG8g\nYmUKICAgICAqIHNlcmlhbGl6ZWQuCiAgICAgKgogICAgICogQHJldHVybiB0\ncnVlIGlmIGFueSBjb21wb25lbnRzIHJlbW92ZWQsIGZhbHNlIGlmIG5vbmUg\naW4gc2V0CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZUFsbChN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBpZiAocmVwb3Mg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBi\nb29sZWFuIHJlbW92ZWQgPSBmYWxzZTsKICAgICAgICBDbGFzc01ldGFEYXRh\nW10gbWV0YXMgPSByZXBvcy5nZXRNZXRhRGF0YXMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICByZW1vdmVkIHw9IHJlbW92ZU1ldGFEYXRhKG1ldGFzW2ldKTsKICAgICAg\nICBTZXF1ZW5jZU1ldGFEYXRhW10gc2VxcyA9IHJlcG9zLmdldFNlcXVlbmNl\nTWV0YURhdGFzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZXFz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVkIHw9IHJlbW92ZVNl\ncXVlbmNlTWV0YURhdGEoc2Vxc1tpXSk7CiAgICAgICAgUXVlcnlNZXRhRGF0\nYVtdIHF1ZXJpZXMgPSByZXBvcy5nZXRRdWVyeU1ldGFEYXRhcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcXVlcmllcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgcmVtb3ZlZCB8PSByZW1vdmVRdWVyeU1ldGFEYXRhKHF1\nZXJpZXNbaV0pOwogICAgICAgIHJldHVybiByZW1vdmVkOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2xlYXIgdGhlIHNldCBvZiBtZXRhZGF0YXMgdG8gYmUg\nc2VyaWFsaXplZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xlYXIoKSB7\nCiAgICAgICAgaWYgKF9tZXRhcyAhPSBudWxsKQogICAgICAgICAgICBfbWV0\nYXMuY2xlYXIoKTsKICAgICAgICBpZiAoX3NlcXMgIT0gbnVsbCkKICAgICAg\nICAgICAgX3NlcXMuY2xlYXIoKTsKICAgICAgICBpZiAoX3F1ZXJpZXMgIT0g\nbnVsbCkKICAgICAgICAgICAgX3F1ZXJpZXMuY2xlYXIoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBzeXN0ZW0tbGV2ZWwgbWFwcGluZyBlbGVtZW50\ncyB0byBiZSBzZXJpYWxpemVkLiBEb2VzIG5vdGhpbmcKICAgICAqIGJ5IGRl\nZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZFN5c3RlbU1h\ncHBpbmdFbGVtZW50cyhDb2xsZWN0aW9uIHRvU2VyaWFsaXplKSB7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTb3J0IHRoZSBnaXZlbiBjb2xsZWN0aW9uIG9m\nIG9iamVjdHMgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHNlcmlhbGl6YXRpb25Tb3J0KExpc3Qgb2JqcykgewogICAgICAg\nIGlmIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAoX2NvbXAgPT0gbnVsbCkKICAgICAg\nICAgICAgX2NvbXAgPSBuZXdTZXJpYWxpemF0aW9uQ29tcGFyYXRvcigpOwog\nICAgICAgIENvbGxlY3Rpb25zLnNvcnQob2JqcywgX2NvbXApOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNvbXBhcmF0b3IgZm9yIG9y\nZGVyaW5nIG9iamVjdHMgdGhhdCBhcmUgdG8gYmUgc2VyaWFsaXplZC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFNlcmlhbGl6YXRpb25Db21wYXJhdG9yIG5l\nd1NlcmlhbGl6YXRpb25Db21wYXJhdG9yKCkgewogICAgICAgIHJldHVybiBf\nY29tcDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBzZXF1ZW5jZSBtZXRh\nZGF0YSB0byB0aGUgZ2l2ZW4gbWV0YWRhdGFzIGNvbGxlY3Rpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXF1ZW5jZU1ldGFEYXRhcyhDb2xs\nZWN0aW9uIGFsbCkgewogICAgICAgIGlmIChfc2VxcyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGZvciAoTWFwLkVudHJ5IGVudHJ5\nIDogX3NlcXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBpZiAoZW50cnku\nZ2V0S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGFsbC5hZGRBbGwo\nKExpc3QpIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAgICBlbHNlIGlm\nIChfbWV0YXMgPT0gbnVsbCB8fCAhX21ldGFzLmNvbnRhaW5zS2V5KGVudHJ5\nLmdldEtleSgpKSkKICAgICAgICAgICAgICAgIGFsbC5hZGQobmV3IENsYXNz\nU2VxcygoTGlzdDxTZXF1ZW5jZU1ldGFEYXRhPikKICAgICAgICAgICAgICAg\nICAgICBlbnRyeS5nZXRWYWx1ZSgpKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIHF1ZXJ5IG1ldGFkYXRhIHRvIHRoZSBnaXZlbiBt\nZXRhZGF0YXMgY29sbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFF1ZXJ5TWV0YURhdGFzKENvbGxlY3Rpb24gYWxsKSB7CiAgICAgICAg\naWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgZm9yIChNYXAuRW50cnkgZW50cnkgOiBfcXVlcmllcy5lbnRyeVNl\ndCgpKSB7CiAgICAgICAgICAgIGlmIChlbnRyeS5nZXRLZXkoKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgYWxsLmFkZEFsbCgoTGlzdCkgZW50cnkuZ2V0\nVmFsdWUoKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKF9tb2RlID09IE1ldGFE\nYXRhTW9kZXMuTU9ERV9RVUVSWSB8fCBfbWV0YXMgPT0gbnVsbAogICAgICAg\nICAgICAgICAgfHwgIV9tZXRhcy5jb250YWluc0tleShlbnRyeS5nZXRLZXko\nKSkpCiAgICAgICAgICAgICAgICBhbGwuYWRkKG5ldyBDbGFzc1F1ZXJpZXMo\nKExpc3Q8UXVlcnlNZXRhRGF0YT4pCiAgICAgICAgICAgICAgICAgICAgZW50\ncnkuZ2V0VmFsdWUoKSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZXMgYSBuZXcgYW5ub3RhdGlvbiBidWlsZGVyIGZvciB0aGUg\nc3BlY2lmaWVkIGFubm90YXRpb24gdHlwZS4KICAgICAqIEByZXR1cm4KICAg\nICAqLwogICAgcHJvdGVjdGVkIEFubm90YXRpb25CdWlsZGVyIG5ld0Fubm90\nYXRpb25CdWlsZGVyKAogICAgICAgIENsYXNzPD8gZXh0ZW5kcyBBbm5vdGF0\naW9uPiBhbm5UeXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBbm5vdGF0aW9u\nQnVpbGRlcihhbm5UeXBlKTsgICAgICAgIAogICAgfQoKICAgIHByb3RlY3Rl\nZCB2b2lkIGFkZEFubm90YXRpb24oQW5ub3RhdGlvbkJ1aWxkZXIgYWIsIE9i\namVjdCBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgaW5zdGFuY2VvZiBDbGFz\nc01ldGFEYXRhKQogICAgICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCAoQ2xh\nc3NNZXRhRGF0YSkgbWV0YSk7CiAgICAgICAgZWxzZSBpZiAobWV0YSBpbnN0\nYW5jZW9mIEZpZWxkTWV0YURhdGEpCiAgICAgICAgICAgIGFkZEFubm90YXRp\nb24oYWIsIChGaWVsZE1ldGFEYXRhKSBtZXRhKTsKICAgICAgICBlbHNlIGlm\nIChtZXRhIGluc3RhbmNlb2YgU2VxdWVuY2VNZXRhRGF0YSkKICAgICAgICAg\nICAgYWRkQW5ub3RhdGlvbihhYiwgKFNlcXVlbmNlTWV0YURhdGEpIG1ldGEp\nOwogICAgICAgIGVsc2UgaWYgKG1ldGEgaW5zdGFuY2VvZiBRdWVyeU1ldGFE\nYXRhKQogICAgICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCAoUXVlcnlNZXRh\nRGF0YSkgbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gYW5u\nb3RhdGlvbiBidWlsZGVyIHRvIGxpc3Qgb2YgYnVpbGRlcnMgZm9yIHRoZSBz\ncGVjaWZpZWQKICAgICAqIGNsYXNzIG1ldGFkYXRhLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBhZGRBbm5vdGF0aW9uKEFubm90YXRpb25CdWlsZGVy\nIGFiLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAoX2Nsc0Fu\nbm9zID09IG51bGwpCiAgICAgICAgICAgIF9jbHNBbm5vcyA9IG5ldyBIYXNo\nTWFwPENsYXNzTWV0YURhdGEsIExpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+Pigp\nOwogICAgICAgIExpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+IGxpc3QgPSBfY2xz\nQW5ub3MuZ2V0KG1ldGEpOwogICAgICAgIGlmIChsaXN0ID09IG51bGwpIHsK\nICAgICAgICAgICAgbGlzdCA9IG5ldyBBcnJheUxpc3Q8QW5ub3RhdGlvbkJ1\naWxkZXI+KCk7CiAgICAgICAgICAgIF9jbHNBbm5vcy5wdXQobWV0YSwgbGlz\ndCk7CiAgICAgICAgfQogICAgICAgIGxpc3QuYWRkKGFiKTsgICAgICAgIAog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFubm90YXRpb24gYnVpbGRl\nciB0byBsaXN0IG9mIGJ1aWxkZXJzIGZvciB0aGUgc3BlY2lmaWVkCiAgICAg\nKiBmaWVsZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nYWRkQW5ub3RhdGlvbihBbm5vdGF0aW9uQnVpbGRlciBhYiwgRmllbGRNZXRh\nRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKF9mbGRBbm5vcyA9PSBudWxsKQog\nICAgICAgICAgICBfZmxkQW5ub3MgPSBuZXcgSGFzaE1hcDxGaWVsZE1ldGFE\nYXRhLCBMaXN0PEFubm90YXRpb25CdWlsZGVyPj4oKTsKICAgICAgICBMaXN0\nPEFubm90YXRpb25CdWlsZGVyPiBsaXN0ID0gX2ZsZEFubm9zLmdldChtZXRh\nKTsKICAgICAgICBpZiAobGlzdCA9PSBudWxsKSB7CiAgICAgICAgICAgIGxp\nc3QgPSBuZXcgQXJyYXlMaXN0PEFubm90YXRpb25CdWlsZGVyPigpOwogICAg\nICAgICAgICBfZmxkQW5ub3MucHV0KG1ldGEsIGxpc3QpOwogICAgICAgIH0K\nICAgICAgICBsaXN0LmFkZChhYik7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgYW4gYW5ub3RhdGlvbiBidWlsZGVyIHRvIGxpc3Qgb2YgYnVpbGRlcnMg\nZm9yIHRoZSBzcGVjaWZpZWQKICAgICAqIHNlcXVlbmNlIG1ldGFkYXRhLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRBbm5vdGF0aW9uKEFubm90\nYXRpb25CdWlsZGVyIGFiLCBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAoX3NlcUFubm9zID09IG51bGwpCiAgICAgICAgICAgIF9zZXFB\nbm5vcyA9IG5ldyBIYXNoTWFwPFNlcXVlbmNlTWV0YURhdGEsCiAgICAgICAg\nICAgICAgICAgICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+KCk7CiAgICAg\nICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4gbGlzdCA9IF9zZXFBbm5vcy5n\nZXQobWV0YSk7CiAgICAgICAgaWYgKGxpc3QgPT0gbnVsbCkgewogICAgICAg\nICAgICBsaXN0ID0gbmV3IEFycmF5TGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4o\nKTsKICAgICAgICAgICAgX3NlcUFubm9zLnB1dChtZXRhLCBsaXN0KTsKICAg\nICAgICB9CiAgICAgICAgbGlzdC5hZGQoYWIpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIGFuIGFubm90YXRpb24gYnVpbGRlciB0byBsaXN0IG9mIGJ1\naWxkZXJzIGZvciB0aGUgc3BlY2lmaWVkCiAgICAgKiBxdWVyeSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYWRkQW5ub3RhdGlvbihB\nbm5vdGF0aW9uQnVpbGRlciBhYiwgUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKF9xcnlBbm5vcyA9PSBudWxsKQogICAgICAgICAgICBfcXJ5\nQW5ub3MgPSBuZXcgSGFzaE1hcDxRdWVyeU1ldGFEYXRhLCBMaXN0PEFubm90\nYXRpb25CdWlsZGVyPj4oKTsKICAgICAgICBMaXN0PEFubm90YXRpb25CdWls\nZGVyPiBsaXN0ID0gX3FyeUFubm9zLmdldChtZXRhKTsKICAgICAgICBpZiAo\nbGlzdCA9PSBudWxsKSB7CiAgICAgICAgICAgIGxpc3QgPSBuZXcgQXJyYXlM\naXN0PEFubm90YXRpb25CdWlsZGVyPigpOwogICAgICAgICAgICBfcXJ5QW5u\nb3MucHV0KG1ldGEsIGxpc3QpOwogICAgICAgIH0KICAgICAgICBsaXN0LmFk\nZChhYik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGFuIGFuIGFu\nbm90YXRpb24gYnVpbGRlciBmb3IgdGhlIHNwZWNpZmllZCBjbGFzcyBtZXRh\nZGF0YQogICAgICogYW5kIGFkZHMgaXQgdG8gbGlzdCBvZiBidWlsZGVycy4K\nICAgICAqLwogICAgcHJvdGVjdGVkIEFubm90YXRpb25CdWlsZGVyIGFkZEFu\nbm90YXRpb24oCiAgICAgICAgQ2xhc3M8PyBleHRlbmRzIEFubm90YXRpb24+\nIGFublR5cGUsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIEFubm90\nYXRpb25CdWlsZGVyIGFiID0gbmV3QW5ub3RhdGlvbkJ1aWxkZXIoYW5uVHlw\nZSk7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGFiOwogICAgICAgIGFkZEFubm90YXRpb24oYWIsIG1ldGEpOwogICAg\nICAgIHJldHVybiBhYjsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMg\nYW4gYW4gYW5ub3RhdGlvbiBidWlsZGVyIGZvciB0aGUgc3BlY2lmaWVkIGNs\nYXNzIG1ldGFkYXRhCiAgICAgKiBhbmQgYWRkcyBpdCB0byBsaXN0IG9mIGJ1\naWxkZXJzLgogICAgICovCiAgICBwcm90ZWN0ZWQgQW5ub3RhdGlvbkJ1aWxk\nZXIgYWRkQW5ub3RhdGlvbigKICAgICAgICBDbGFzczw/IGV4dGVuZHMgQW5u\nb3RhdGlvbj4gYW5uVHlwZSwgRmllbGRNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWIgPSBuZXdBbm5vdGF0aW9uQnVpbGRl\ncihhbm5UeXBlKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gYWI7CiAgICAgICAgYWRkQW5ub3RhdGlvbihhYiwgbWV0\nYSk7CiAgICAgICAgcmV0dXJuIGFiOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlcyBhbiBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIgZm9yIHRoZSBzcGVj\naWZpZWQgY2xhc3MgbWV0YWRhdGEKICAgICAqIGFuZCBhZGRzIGl0IHRvIGxp\nc3Qgb2YgYnVpbGRlcnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBBbm5vdGF0\naW9uQnVpbGRlciBhZGRBbm5vdGF0aW9uKAogICAgICAgIENsYXNzPD8gZXh0\nZW5kcyBBbm5vdGF0aW9uPiBhbm5UeXBlLCBTZXF1ZW5jZU1ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYiA9IG5ld0Fubm90\nYXRpb25CdWlsZGVyKGFublR5cGUpOwogICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBhYjsKICAgICAgICBhZGRBbm5vdGF0\naW9uKGFiLCBtZXRhKTsKICAgICAgICByZXR1cm4gYWI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGVzIGFuIGFuIGFubm90YXRpb24gYnVpbGRlciBm\nb3IgdGhlIHNwZWNpZmllZCBjbGFzcyBtZXRhZGF0YQogICAgICogYW5kIGFk\nZHMgaXQgdG8gbGlzdCBvZiBidWlsZGVycy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIEFubm90YXRpb25CdWlsZGVyIGFkZEFubm90YXRpb24oCiAgICAgICAg\nQ2xhc3M8PyBleHRlbmRzIEFubm90YXRpb24+IGFublR5cGUsIFF1ZXJ5TWV0\nYURhdGEgbWV0YSkgewogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiID0g\nbmV3QW5ub3RhdGlvbkJ1aWxkZXIoYW5uVHlwZSk7CiAgICAgICAgaWYgKG1l\ndGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGFiOwogICAgICAgIGFk\nZEFubm90YXRpb24oYWIsIG1ldGEpOwogICAgICAgIHJldHVybiBhYjsKICAg\nIH0KICAgIAogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplKENvbGxlY3Rp\nb24gb2JqZWN0cykgewogICAgICAgIGZvciAoT2JqZWN0IG9iaiA6IG9iamVj\ndHMpIHsKICAgICAgICAgICAgaW50IHR5cGUgPSB0eXBlKG9iaik7CiAgICAg\nICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSBU\nWVBFX01FVEE6CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQ2xhc3Mo\nKENsYXNzTWV0YURhdGEpIG9iaik7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfU0VROgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNlcmlhbGl6ZVNlcXVlbmNlKChTZXF1ZW5jZU1ldGFEYXRh\nKSBvYmopOwogICAgICAgICAgICAgICAgY2FzZSBUWVBFX1FVRVJZOgogICAg\nICAgICAgICAgICAgICAgIHNlcmlhbGl6ZVF1ZXJ5KChRdWVyeU1ldGFEYXRh\nKSBvYmopOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBUWVBFX0NMQVNTX1FVRVJJRVM6CiAgICAgICAgICAgICAg\nICAgICAgZm9yIChRdWVyeU1ldGFEYXRhIHF1ZXJ5IDogKChDbGFzc1F1ZXJp\nZXMpIG9iaikKICAgICAgICAgICAgICAgICAgICAgICAgLmdldFF1ZXJpZXMo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplUXVlcnkocXVl\ncnkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBUWVBFX0NMQVNTX1NFUVM6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nZm9yIChTZXF1ZW5jZU1ldGFEYXRhIHNlcSA6ICgoQ2xhc3NTZXFzKSBvYmop\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2VxdWVuY2VzKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVTZXF1ZW5j\nZShzZXEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBw\naW5nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVT\neXN0ZW1NYXBwaW5nRWxlbWVudChvYmopOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSB0eXBlIGNvbnN0YW50IGZvciB0aGUgZ2l2\nZW4gb2JqZWN0IGJhc2VkIG9uIGl0cyBydW50aW1lCiAgICAgKiBjbGFzcy4g\nSWYgdGhlIHJ1bnRpbWUgY2xhc3MgZG9lcyBub3QgY29ycmVzcG9uZCB0byBh\nbnkgb2YgdGhlIGtub3duCiAgICAgKiB0eXBlcyB0aGVuIHJldHVybnMgLTEu\nIFRoaXMgY2FuIGhhcHBlbiBmb3IgdGFncwogICAgICogdGhhdCBhcmUgbm90\nIGhhbmRsZWQgYXQgdGhpcyBzdG9yZS1hZ25vc3RpYyBsZXZlbC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGludCB0eXBlKE9iamVjdCBvKSB7CiAgICAgICAg\naWYgKG8gaW5zdGFuY2VvZiBDbGFzc01ldGFEYXRhKQogICAgICAgICAgICBy\nZXR1cm4gVFlQRV9NRVRBOwogICAgICAgIGlmIChvIGluc3RhbmNlb2YgUXVl\ncnlNZXRhRGF0YSkKICAgICAgICAgICAgcmV0dXJuIFRZUEVfUVVFUlk7CiAg\nICAgICAgaWYgKG8gaW5zdGFuY2VvZiBTZXF1ZW5jZU1ldGFEYXRhKQogICAg\nICAgICAgICByZXR1cm4gVFlQRV9TRVE7CiAgICAgICAgaWYgKG8gaW5zdGFu\nY2VvZiBDbGFzc1F1ZXJpZXMpCiAgICAgICAgICAgIHJldHVybiBUWVBFX0NM\nQVNTX1FVRVJJRVM7CiAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBDbGFzc1Nl\ncXMpCiAgICAgICAgICAgIHJldHVybiBUWVBFX0NMQVNTX1NFUVM7CiAgICAg\nICAgcmV0dXJuIC0xOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXpl\nIHVua25vd24gbWFwcGluZyBlbGVtZW50IGF0IHN5c3RlbSBsZXZlbC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplU3lzdGVtTWFwcGlu\nZ0VsZW1lbnQoT2JqZWN0IG9iaikgewogICAgfQoKICAgIC8qKgogICAgICog\nU2VyaWFsaXplIHF1ZXJ5IG1ldGFkYXRhLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgc2VyaWFsaXplUXVlcnkoUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNJ\nbmZvRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGlmIChtZXRhLmdldFNvdXJj\nZVNjb3BlKCkgaW5zdGFuY2VvZiBDbGFzcykKICAgICAgICAgICAgICAgIGxv\nZy5pbmZvKF9sb2MuZ2V0KCJzZXItY2xzLXF1ZXJ5IiwKICAgICAgICAgICAg\nICAgICAgICBtZXRhLmdldFNvdXJjZVNjb3BlKCksIG1ldGEuZ2V0TmFtZSgp\nKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy5pbmZv\nKF9sb2MuZ2V0KCJzZXItcXVlcnkiLCBtZXRhLmdldE5hbWUoKSkpOwogICAg\nICAgIH0KCiAgICAgICAgQ2xhc3M8PyBleHRlbmRzIEFubm90YXRpb24+IGFu\nbiA9CiAgICAgICAgICAgIFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFs\ncyhtZXRhLmdldExhbmd1YWdlKCkpID8KICAgICAgICAgICAgTmFtZWROYXRp\ndmVRdWVyeS5jbGFzcyA6IE5hbWVkUXVlcnkuY2xhc3M7CiAgICAgICAgQW5u\nb3RhdGlvbkJ1aWxkZXIgYWJRcnkgPSBhZGRBbm5vdGF0aW9uKGFubiwgbWV0\nYSk7CiAgICAgICAgYWJRcnkuYWRkKCJuYW1lIiwgbWV0YS5nZXROYW1lKCkp\nOwogICAgICAgIGFiUXJ5LmFkZCgicXVlcnkiLCBtZXRhLmdldFF1ZXJ5U3Ry\naW5nKCkpOwogICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5l\ncXVhbHMobWV0YS5nZXRMYW5ndWFnZSgpKSkgewogICAgICAgICAgICBpZiAo\nbWV0YS5nZXRSZXN1bHRUeXBlKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGFiUXJ5LmFkZCgicmVzdWx0Q2xhc3MiLCBtZXRhLmdldFJlc3VsdFR5cGUo\nKSk7CiAgICAgICAgfQogICAgICAgIHNlcmlhbGl6ZVF1ZXJ5SGludHMobWV0\nYSwgYWJRcnkpOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHF1\nZXJ5IGhpbnRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXpl\nUXVlcnlIaW50cyhRdWVyeU1ldGFEYXRhIG1ldGEsIEFubm90YXRpb25CdWls\nZGVyIGFiKSB7CiAgICAgICAgU3RyaW5nW10gaGludHMgPSBtZXRhLmdldEhp\nbnRLZXlzKCk7CiAgICAgICAgT2JqZWN0W10gdmFsdWVzID0gbWV0YS5nZXRI\naW50VmFsdWVzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBoaW50\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBBbm5vdGF0aW9uQnVpbGRl\nciBhYkhpbnQgPSBuZXdBbm5vdGF0aW9uQnVpbGRlcihRdWVyeUhpbnQuY2xh\nc3MpOwogICAgICAgICAgICBhYkhpbnQuYWRkKCJuYW1lIiwgaGludHNbaV0p\nOwogICAgICAgICAgICBhYkhpbnQuYWRkKCJ2YWx1ZSIsIFN0cmluZy52YWx1\nZU9mKHZhbHVlc1tpXSkpOwogICAgICAgICAgICBhYi5hZGQoImhpbnRzIiwg\nYWJIaW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJp\nYWxpemUgc2VxdWVuY2UgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHNlcmlhbGl6ZVNlcXVlbmNlKFNlcXVlbmNlTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIExvZyBsb2cgPSBnZXRMb2coKTsKICAgICAgICBpZiAo\nbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLmluZm8oX2xv\nYy5nZXQoInNlci1zZXF1ZW5jZSIsIG1ldGEuZ2V0TmFtZSgpKSk7CgogICAg\nICAgIEFubm90YXRpb25CdWlsZGVyIGFiID0gYWRkQW5ub3RhdGlvbihTZXF1\nZW5jZUdlbmVyYXRvci5jbGFzcywgbWV0YSk7CiAgICAgICAgYWIuYWRkKCJu\nYW1lIiwgbWV0YS5nZXROYW1lKCkpOwoKICAgICAgICAvLyBwYXJzZSBvdXQg\ndGhlIGRhdGFzdG9yZSBzZXF1ZW5jZSBuYW1lLCBpZiBhbnkKICAgICAgICBT\ndHJpbmcgcGx1Z2luID0gbWV0YS5nZXRTZXF1ZW5jZVBsdWdpbigpOwogICAg\nICAgIFN0cmluZyBjbHNOYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NO\nYW1lKHBsdWdpbik7CiAgICAgICAgU3RyaW5nIHByb3BzID0gQ29uZmlndXJh\ndGlvbnMuZ2V0UHJvcGVydGllcyhwbHVnaW4pOwogICAgICAgIFN0cmluZyBk\ncyA9IG51bGw7CiAgICAgICAgaWYgKHByb3BzICE9IG51bGwpIHsKICAgICAg\nICAgICAgUHJvcGVydGllcyBtYXAgPSBDb25maWd1cmF0aW9ucy5wYXJzZVBy\nb3BlcnRpZXMocHJvcHMpOwogICAgICAgICAgICBkcyA9IChTdHJpbmcpIG1h\ncC5yZW1vdmUoIlNlcXVlbmNlIik7CiAgICAgICAgICAgIGlmIChkcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBwcm9wcyA9IENvbmZpZ3VyYXRpb25z\nLnNlcmlhbGl6ZVByb3BlcnRpZXMobWFwKTsKICAgICAgICAgICAgICAgIHBs\ndWdpbiA9IENvbmZpZ3VyYXRpb25zLmdldFBsdWdpbihjbHNOYW1lLCBwcm9w\ncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChkcyAh\nPSBudWxsKQogICAgICAgICAgICBhYi5hZGQoInNlcXVlbmNlTmFtZSIsIGRz\nKTsKICAgICAgICBlbHNlIGlmIChwbHVnaW4gIT0gbnVsbCAmJiAhU2VxdWVu\nY2VNZXRhRGF0YS5JTVBMX05BVElWRS5lcXVhbHMKICAgICAgICAgICAgKHBs\ndWdpbikpCiAgICAgICAgICAgIGFiLmFkZCgic2VxdWVuY2VOYW1lIiwgcGx1\nZ2luKTsKICAgICAgICBpZiAobWV0YS5nZXRJbml0aWFsVmFsdWUoKSAhPSAw\nICYmIG1ldGEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gLTEpCiAgICAgICAgICAg\nIGFiLmFkZCgiaW5pdGlhbFZhbHVlIiwgbWV0YS5nZXRJbml0aWFsVmFsdWUo\nKSk7CiAgICAgICAgaWYgKG1ldGEuZ2V0QWxsb2NhdGUoKSAhPSA1MCAmJiBt\nZXRhLmdldEFsbG9jYXRlKCkgIT0gLTEpCiAgICAgICAgICAgIGFiLmFkZCgi\nYWxsb2NhdGlvblNpemUiLCBtZXRhLmdldEFsbG9jYXRlKCkpOwogICAgICAg\nIGlmIChtZXRhLmdldFNjaGVtYSgpICE9IG51bGwpCiAgICAgICAgICAgIGFi\nLmFkZCgic2NoZW1hIiwgbWV0YS5nZXRTY2hlbWEoKSk7CiAgICAgICAgaWYg\nKG1ldGEuZ2V0Q2F0YWxvZygpICE9IG51bGwpCiAgICAgICAgICAgIGFiLmFk\nZCgiY2F0YWxvZyIsIG1ldGEuZ2V0Q2F0YWxvZygpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNlcmlhbGl6ZSBjbGFzcyBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplQ2xhc3MoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAg\nIGlmIChsb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cuaW5m\nbyhfbG9jLmdldCgic2VyLWNsYXNzIiwgbWV0YSkpOwoKICAgICAgICBBbm5v\ndGF0aW9uQnVpbGRlciBhYkVudGl0eSA9IGFkZEFubm90YXRpb24oCiAgICAg\nICAgICAgIGdldEVudGl0eUFubm90YXRpb25UeXBlKG1ldGEpLCBtZXRhKTsK\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKQogICAgICAgICAgICAmJiAh\nbWV0YS5nZXRUeXBlQWxpYXMoKS5lcXVhbHMoU3RyaW5ncy5nZXRDbGFzc05h\nbWUobWV0YS4KICAgICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpKSkpCiAg\nICAgICAgICAgIGFiRW50aXR5LmFkZCgibmFtZSIsIG1ldGEuZ2V0VHlwZUFs\naWFzKCkpOwogICAgICAgIAogICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkp\nCiAgICAgICAgICAgIGFkZENsYXNzTWFwcGluZ0Fubm90YXRpb25zKG1ldGEp\nOwoKICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICBz\nZXJpYWxpemVDbGFzc01hcHBpbmdDb250ZW50KG1ldGEpOwogICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICBzZXJpYWxpemVJZENs\nYXNzKG1ldGEpOwogICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAg\nICAgICAgIHNlcmlhbGl6ZUluaGVyaXRhbmNlQ29udGVudChtZXRhKTsKCiAg\nICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkgewogICAgICAgICAgICBMaXN0\nIHNlcXMgPSAoX3NlcXMgPT0gbnVsbCkgPyBudWxsIDogX3NlcXMuZ2V0CiAg\nICAgICAgICAgICAgICAobWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFt\nZSgpKTsKICAgICAgICAgICAgaWYgKHNlcXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgc2VyaWFsaXphdGlvblNvcnQoc2Vxcyk7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlcXMuc2l6ZSgpOyBpKyspCiAg\nICAgICAgICAgICAgICAgICAgc2VyaWFsaXplU2VxdWVuY2UoKFNlcXVlbmNl\nTWV0YURhdGEpIHNlcXMuZ2V0KGkpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkpIHsKICAgICAgICAgICAg\nTGlzdCBxdWVyaWVzID0gKF9xdWVyaWVzID09IG51bGwpID8gbnVsbCA6IF9x\ndWVyaWVzLmdldAogICAgICAgICAgICAgICAgKG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmIChxdWVyaWVzICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHNlcmlhbGl6YXRpb25Tb3J0KHF1\nZXJpZXMpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBx\ndWVyaWVzLnNpemUoKTsgaSsrKQogICAgICAgICAgICAgICAgICAgIHNlcmlh\nbGl6ZVF1ZXJ5KChRdWVyeU1ldGFEYXRhKSBxdWVyaWVzLmdldChpKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkK\nICAgICAgICAgICAgICAgIHNlcmlhbGl6ZVF1ZXJ5TWFwcGluZ3MobWV0YSk7\nCiAgICAgICAgfQoKICAgICAgICBMaXN0PEZpZWxkTWV0YURhdGE+IGZpZWxk\ncyA9IG5ldyBBcnJheUxpc3QoQXJyYXlzLmFzTGlzdAogICAgICAgICAgICAo\nbWV0YS5nZXREZWZpbmVkRmllbGRzSW5MaXN0aW5nT3JkZXIoKSkpOwogICAg\nICAgIENvbGxlY3Rpb25zLnNvcnQoZmllbGRzLCBuZXcgRmllbGRDb21wYXJh\ndG9yKCkpOwoKICAgICAgICAvLyBzZXJpYWxpemUgYXR0ci1vdmVycmlkZQog\nICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpIHsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQ7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgb3Jp\nZzsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxGaWVsZE1ldGFEYXRhPiBp\ndCA9IGZpZWxkcy5pdGVyYXRvcigpOyBpdC5oYXNOZXh0KCk7KQogICAgICAg\nICAgICB7CiAgICAgICAgICAgICAgICBmbWQgPSBpdC5uZXh0KCk7CiAgICAg\nICAgICAgICAgICBpZiAobWV0YS5nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxk\nKGZtZC5nZXROYW1lKCkpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgICAgICBvcmlnID0gbWV0YS5nZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpLmdldEZpZWxkKGZtZC5nZXROYW1lKCkpOwog\nICAgICAgICAgICAgICAgaWYgKHNlcmlhbGl6ZUF0dHJpYnV0ZU92ZXJyaWRl\nKGZtZCwgb3JpZykpCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQXR0\ncmlidXRlT3ZlcnJpZGVDb250ZW50KGZtZCwgb3JpZyk7CiAgICAgICAgICAg\nICAgICBpdC5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYgKGZpZWxkcy5zaXplKCkgPiAwICYmIChpc01ldGFEYXRhTW9k\nZSgpIHx8IGlzTWFwcGluZ01vZGUoKSkpIHsKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YSBvcmlnOwogICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEg\nZm1kIDogZmllbGRzKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERl\nY2xhcmluZ1R5cGUoKSAhPSBmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLgog\nICAgICAgICAgICAgICAgICAgIGdldERlc2NyaWJlZFR5cGUoKSkgewogICAg\nICAgICAgICAgICAgICAgIG9yaWcgPSBmbWQuZ2V0RGVjbGFyaW5nTWV0YURh\ndGEoKS5nZXREZWNsYXJlZEZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAg\nIChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgICAgIG9yaWcgPSBudWxsOwogICAgICAgICAgICAgICAg\nc2VyaWFsaXplRmllbGQoZm1kLCBvcmlnKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBlbnRpdHkgYW5u\nb3RhdGlvbiB0eXBlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFz\nczw/IGV4dGVuZHMgQW5ub3RhdGlvbj4gZ2V0RW50aXR5QW5ub3RhdGlvblR5\ncGUoCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgc3dp\ndGNoIChnZXRFbnRpdHlUYWcobWV0YSkpIHsKICAgICAgICAgICAgY2FzZSBF\nTlRJVFk6CiAgICAgICAgICAgICAgICByZXR1cm4gRW50aXR5LmNsYXNzOwog\nICAgICAgICAgICBjYXNlIEVNQkVEREFCTEU6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gRW1iZWRkYWJsZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBNQVBQ\nRURfU1VQRVJDTEFTUzoKICAgICAgICAgICAgICAgIHJldHVybiBNYXBwZWRT\ndXBlcmNsYXNzLmNsYXNzOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBmaWVsZCBh\nbm5vdGF0aW9uIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENs\nYXNzPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBnZXRGaWVsZEFubm90YXRpb25U\neXBlICgKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCwgUGVyc2lzdGVuY2VT\ndHJhdGVneSBzdHJhdCkgewogICAgICAgIENsYXNzPD8gZXh0ZW5kcyBBbm5v\ndGF0aW9uPiBhbm4gPSBudWxsOwogICAgICAgIGlmIChmbWQuaXNQcmltYXJ5\nS2V5KCkgJiYgc3RyYXQgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5FTUJFRERF\nRCkKICAgICAgICAgICAgYW5uID0gRW1iZWRkZWRJZC5jbGFzczsKICAgICAg\nICBlbHNlIGlmIChmbWQuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgIGFu\nbiA9IElkLmNsYXNzOwogICAgICAgIGVsc2UgaWYgKGZtZC5pc1ZlcnNpb24o\nKSkKICAgICAgICAgICAgYW5uID0gVmVyc2lvbi5jbGFzczsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgc3dpdGNoIChzdHJhdCkgewogICAgICAgICAg\nICAgICAgY2FzZSBUUkFOU0lFTlQ6CiAgICAgICAgICAgICAgICAgICAgYW5u\nID0gVHJhbnNpZW50LmNsYXNzOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBCQVNJQzoKICAgICAgICAgICAgICAg\nICAgICBhbm4gPSBCYXNpYy5jbGFzczsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU1CRURERUQ6CiAgICAgICAg\nICAgICAgICAgICAgYW5uID0gRW1iZWRkZWQuY2xhc3M7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE1BTllfT05F\nOgogICAgICAgICAgICAgICAgICAgIGFubiA9IE1hbnlUb09uZS5jbGFzczsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgT05FX09ORToKICAgICAgICAgICAgICAgICAgICBhbm4gPSBPbmVUb09u\nZS5jbGFzczsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgT05FX01BTlk6CiAgICAgICAgICAgICAgICAgICAgYW5u\nID0gT25lVG9NYW55LmNsYXNzOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBNQU5ZX01BTlk6CiAgICAgICAgICAg\nICAgICAgICAgYW5uID0gTWFueVRvTWFueS5jbGFzczsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gYW5uOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBNZXRhRGF0YVRhZyBmb3IgdGhlIGdpdmVuIGNsYXNzIG1ldGEgZGF0YS4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgTWV0YURhdGFUYWcgZ2V0RW50\naXR5VGFnKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRh\nLmlzQWJzdHJhY3QoKSkKICAgICAgICAgICAgcmV0dXJuIE1ldGFEYXRhVGFn\nLk1BUFBFRF9TVVBFUkNMQVNTOwogICAgICAgIC8vIEBFbWJlZGRhYmxlIGNs\nYXNzZXMgY2FuJ3QgZGVjbGFyZSBJZCBmaWVsZHMKICAgICAgICBpZiAobWV0\nYS5pc0VtYmVkZGVkT25seSgpICYmIG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxk\ncygpLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gTWV0YURhdGFU\nYWcuRU1CRUREQUJMRTsKICAgICAgICBpZiAobWV0YS5pc01hcHBlZCgpKQog\nICAgICAgICAgICByZXR1cm4gTWV0YURhdGFUYWcuRU5USVRZOwogICAgICAg\nIHJldHVybiBNZXRhRGF0YVRhZy5NQVBQRURfU1VQRVJDTEFTUzsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBtYXBwaW5nIGF0dHJpYnV0ZXMgZm9yIHRo\nZSBnaXZlbiBjbGFzcy4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQKICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgYWRkQ2xhc3NNYXBwaW5nQW5ub3RhdGlv\nbnMoQ2xhc3NNZXRhRGF0YSBtYXBwaW5nKSB7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXJpYWxpemUgaWQtY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBzZXJpYWxpemVJZENsYXNzKENsYXNzTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpICE9IENsYXNzTWV0\nYURhdGEuSURfQVBQTElDQVRJT04KICAgICAgICAgICAgfHwgbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIENsYXNzTWV0YURhdGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgIENsYXNzIG9pZCA9IG1ldGEuZ2V0T2JqZWN0SWRU\neXBlKCk7CiAgICAgICAgaWYgKG9pZCAhPSBudWxsICYmIChzdXAgPT0gbnVs\nbCB8fCBvaWQgIT0gc3VwLmdldE9iamVjdElkVHlwZSgpKSkgewogICAgICAg\nICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYiA9IGFkZEFubm90YXRpb24oSWRD\nbGFzcy5jbGFzcywgbWV0YSk7CiAgICAgICAgICAgIGFiLmFkZChudWxsLCBv\naWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6\nZSBjbGFzcyBtYXBwaW5nIGNvbnRlbnQuIERvZXMgbm90aGluZyBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFz\nc01hcHBpbmdDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykgewogICAg\nfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGluaGVyaXRhbmNlIGNvbnRl\nbnQuIERvZXMgbm90aGluZyBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBzZXJpYWxpemVJbmhlcml0YW5jZUNvbnRlbnQoQ2xhc3NN\nZXRhRGF0YSBtYXBwaW5nKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJp\nYWxpemUgcXVlcnkgbWFwcGluZ3MuIERvZXMgbm90aGluZyBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVRdWVyeU1h\ncHBpbmdzKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgfQoKICAgIC8qKgog\nICAgICogU2VyaWFsaXplIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZUZpZWxkKEZpZWxkTWV0YURhdGEgZm1k\nLCBGaWVsZE1ldGFEYXRhIG9yaWcpIHsKICAgICAgICBpZiAoZm1kLmdldE1h\nbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5U\nCiAgICAgICAgICAgICYmICFmbWQuaXNFeHBsaWNpdCgpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXQg\nPSBnZXRTdHJhdGVneShmbWQpOwogICAgICAgIFZhbHVlTWV0YURhdGEgY2Fz\nY2FkZXMgPSBudWxsOwogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiID0g\nYWRkQW5ub3RhdGlvbigKICAgICAgICAgICAgZ2V0RmllbGRBbm5vdGF0aW9u\nVHlwZSAoZm1kLCBzdHJhdCksIGZtZCk7ICAgICAgICAKICAgICAgICBpZiAo\nZm1kLmlzUHJpbWFyeUtleSgpICYmIHN0cmF0ID09IFBlcnNpc3RlbmNlU3Ry\nYXRlZ3kuRU1CRURERUQpCiAgICAgICAgICAgIDsgLy8gbm9vcAogICAgICAg\nIGVsc2UgaWYgKGZtZC5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgOyAv\nLyBub29wCiAgICAgICAgZWxzZSBpZiAoZm1kLmlzVmVyc2lvbigpKQogICAg\nICAgICAgICA7IC8vIG5vb3AKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nc3dpdGNoIChzdHJhdCkgewogICAgICAgICAgICAgICAgY2FzZSBCQVNJQzoK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgYWRkQmFzaWNBdHRyaWJ1dGVzKGZtZCwg\nYWIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBNQU5ZX09ORToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTWFu\neVRvT25lQXR0cmlidXRlcyhmbWQsIGFiKTsKICAgICAgICAgICAgICAgICAg\nICBjYXNjYWRlcyA9IGZtZDsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgT05FX09ORToKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgYWRkT25lVG9PbmVBdHRyaWJ1dGVzKGZtZCwgYWIpOwogICAgICAg\nICAgICAgICAgICAgIGNhc2NhZGVzID0gZm1kOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPTkVfTUFOWToKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgYWRkT25lVG9NYW55QXR0cmlidXRlcyhmbWQs\nIGFiKTsKICAgICAgICAgICAgICAgICAgICBjYXNjYWRlcyA9IGZtZC5nZXRF\nbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIE1BTllfTUFOWToKICAgICAgICAgICAgICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nYWRkTWFueVRvTWFueUF0dHJpYnV0ZXMoZm1kLCBhYik7CiAgICAgICAgICAg\nICAgICAgICAgY2FzY2FkZXMgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgICAgICBhZGRTdHJh\ndGVneU1hcHBpbmdBdHRyaWJ1dGVzKGZtZCwgYWIpOwogICAgICAgIH0KICAg\nICAgICBpZiAoaXNNYXBwaW5nTW9kZShmbWQpKQogICAgICAgICAgICBhZGRG\naWVsZE1hcHBpbmdBdHRyaWJ1dGVzKGZtZCwgb3JpZywgYWIpOwoKICAgICAg\nICBpZiAoZm1kLmdldE9yZGVyRGVjbGFyYXRpb24oKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmICghKE9yZGVyLkVMRU1FTlQgKyAiIGFzYyIpLmVxdWFs\ncyhmbWQuZ2V0T3JkZXJEZWNsYXJhdGlvbigpKSkKICAgICAgICAgICAgICAg\nIGFkZEFubm90YXRpb24oT3JkZXJCeS5jbGFzcywgZm1kKS4KICAgICAgICAg\nICAgICAgICAgICBhZGQgKG51bGwsIGZtZC5nZXRPcmRlckRlY2xhcmF0aW9u\nKCkpOwogICAgICAgIH0KICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpICYm\nIGZtZC5nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkgewog\nICAgICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYk1hcEtleSA9IGFkZEFu\nbm90YXRpb24oTWFwS2V5LmNsYXNzLCBmbWQpOwogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIG1hcEJ5ID0gZm1kLmdldEtleSgpLmdldFZhbHVlTWFwcGVk\nQnlNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoIW1hcEJ5LmlzUHJpbWFy\neUtleSgpIHx8CiAgICAgICAgICAgICAgICBtYXBCeS5nZXREZWZpbmluZ01l\ndGFEYXRhKCkuZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxlbmd0aCAhPSAxKSB7\nCiAgICAgICAgICAgICAgICBhYk1hcEtleS5hZGQoIm5hbWUiLCBmbWQuZ2V0\nS2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZShmbWQpKQogICAgICAg\nICAgICBzZXJpYWxpemVGaWVsZE1hcHBpbmdDb250ZW50KGZtZCwgc3RyYXQs\nIGFiKTsKICAgICAgICBpZiAoY2FzY2FkZXMgIT0gbnVsbCAmJiBpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICBzZXJpYWxpemVDYXNjYWRlcyhjYXNj\nYWRlcywgYWIpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIG1hcHBpbmcg\nYXR0cmlidXRlcyBmb3IgdGhlIGdpdmVuIGZpZWxkLiBEb2VzIG5vdGhpbmcg\nYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYWRkRmll\nbGRNYXBwaW5nQXR0cmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAg\nICBGaWVsZE1ldGFEYXRhIG9yaWcsIEFubm90YXRpb25CdWlsZGVyIGFiKSB7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWx3YXlzIHJldHVybnMgZmFs\nc2UgYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4g\nc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGUoRmllbGRNZXRhRGF0YSBmbWQs\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBvcmlnKSB7CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGF0dHJp\nYnV0ZSBvdmVycmlkZSBjb250ZW50LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVDb250ZW50KEZpZWxkTWV0\nYURhdGEgZm1kLAogICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZykgewogICAg\nICAgIEFubm90YXRpb25CdWlsZGVyIGFiID0gYWRkQW5ub3RhdGlvbihBdHRy\naWJ1dGVPdmVycmlkZS5jbGFzcywgZm1kKTsKICAgICAgICBhYi5hZGQoIm5h\nbWUiLCBmbWQuZ2V0TmFtZSgpKTsKICAgICAgICBzZXJpYWxpemVBdHRyaWJ1\ndGVPdmVycmlkZU1hcHBpbmdDb250ZW50KGZtZCwgb3JpZywgYWIpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGF0dHJpYnV0ZSBvdmVycmlk\nZSBtYXBwaW5nIGNvbnRlbnQuIERvZXMgbm90aGluZyBieSBkZWZhdWx0LAog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVBdHRyaWJ1dGVP\ndmVycmlkZU1hcHBpbmdDb250ZW50CiAgICAgICAgKEZpZWxkTWV0YURhdGEg\nZm1kLCBGaWVsZE1ldGFEYXRhIG9yaWcsIEFubm90YXRpb25CdWlsZGVyIGFi\nKSB7CiAgICB9CgoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGNhc2NhZGVz\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplQ2FzY2FkZXMo\nVmFsdWVNZXRhRGF0YSB2bWQsIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAg\nICAgICAgRW51bVNldDxDYXNjYWRlVHlwZT4gY2FzY2FkZXMgPSBFbnVtU2V0\nLm5vbmVPZihDYXNjYWRlVHlwZS5jbGFzcyk7CiAgICAgICAgaWYgKHZtZC5n\nZXRDYXNjYWRlUGVyc2lzdCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9J\nTU1FRElBVEUpIHsKICAgICAgICAgICAgY2FzY2FkZXMuYWRkKENhc2NhZGVU\neXBlLlBFUlNJU1QpOwogICAgICAgIH0KICAgICAgICBpZiAodm1kLmdldENh\nc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJ\nQVRFKSB7CiAgICAgICAgICAgIGNhc2NhZGVzLmFkZChDYXNjYWRlVHlwZS5N\nRVJHRSk7CiAgICAgICAgfQogICAgICAgIGlmICh2bWQuZ2V0Q2FzY2FkZURl\nbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpIHsK\nICAgICAgICAgICAgY2FzY2FkZXMuYWRkKENhc2NhZGVUeXBlLlJFTU9WRSk7\nCiAgICAgICAgfQogICAgICAgIGlmICh2bWQuZ2V0Q2FzY2FkZVJlZnJlc2go\nKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAg\nICAgICAgIGNhc2NhZGVzLmFkZChDYXNjYWRlVHlwZS5SRUZSRVNIKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKHZtZC5nZXRDYXNjYWRlRGV0YWNoKCkgPT0g\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAg\nICBjYXNjYWRlcy5hZGQoQ2FzY2FkZVR5cGUuREVUQUNIKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKGNhc2NhZGVzLnNpemUoKSA9PSA1KSAvLyBBTEwKICAg\nICAgICB7CiAgICAgICAgICAgIGNhc2NhZGVzLmNsZWFyKCk7CiAgICAgICAg\nICAgIGNhc2NhZGVzLmFkZChDYXNjYWRlVHlwZS5BTEwpOwogICAgICAgIH0K\nICAgICAgICBpZiAoIWNhc2NhZGVzLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICBhYi5hZGQoImNhc2NhZGUiLCBjYXNjYWRlcyk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXJpYWxpemVkIHN0cmF0\nZWd5IG5hbWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZVN0\ncmF0ZWd5IGdldFN0cmF0ZWd5KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gZm1kLk1BTkFHRV9OT05F\nKQogICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5UUkFO\nU0lFTlQ7CgogICAgICAgIGlmIChmbWQuaXNTZXJpYWxpemVkKCkKICAgICAg\nICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGJ5dGVbXS5jbGFz\ncwogICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQnl0\nZVtdLmNsYXNzCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAgfHwgZm1kLmdldERlY2xh\ncmVkVHlwZSgpID09IENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAgICBy\nZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5CQVNJQzsKCiAgICAgICAgRmll\nbGRNZXRhRGF0YSBtYXBwZWRCeTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAoZm1kLmlzRW1iZWRkZWQoKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVn\neS5FTUJFRERFRDsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0TWFwcGVk\nQnkoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJz\naXN0ZW5jZVN0cmF0ZWd5Lk9ORV9PTkU7CiAgICAgICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gaW52ZXJzZXMgPSBmbWQuZ2V0SW52ZXJzZU1ldGFEYXRh\ncygpOwogICAgICAgICAgICAgICAgaWYgKGludmVyc2VzLmxlbmd0aCA9PSAx\nICYmCiAgICAgICAgICAgICAgICAgICAgaW52ZXJzZXNbMF0uZ2V0VHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuUEMgJiYKICAgICAgICAgICAgICAgICAgICBp\nbnZlcnNlc1swXS5nZXRNYXBwZWRCeU1ldGFEYXRhKCkgPT0gZm1kKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3ku\nT05FX09ORTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5Lk1BTllfT05FOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgbWFwcGVkQnkgPSBmbWQuZ2V0TWFwcGVk\nQnlNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5ID09\nIG51bGwgfHwgbWFwcGVkQnkuZ2V0VHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMu\nUEMpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3Ry\nYXRlZ3kuTUFOWV9NQU5ZOwogICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNp\nc3RlbmNlU3RyYXRlZ3kuT05FX01BTlk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9JRDoKICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5j\nZVN0cmF0ZWd5LkVNQkVEREVEOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuQkFTSUM7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGJhc2ljIGF0\ndHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRCYXNpY0F0\ndHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBmbWQsIEFubm90YXRpb25CdWlsZGVy\nIGFiKSB7CiAgICAgICAgaWYgKCFmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3Vw\nKCkpCiAgICAgICAgICAgIGFiLmFkZCgiZmV0Y2giLCBGZXRjaFR5cGUuTEFa\nWSk7CiAgICAgICAgaWYgKGZtZC5nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1l\ndGFEYXRhLk5VTExfRVhDRVBUSU9OKQogICAgICAgICAgICBhYi5hZGQoIm9w\ndGlvbmFsIiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIG1h\nbnktdG8tb25lIGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRNYW55VG9PbmVBdHRyaWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1kLAog\nICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICAgICAgaWYgKCFm\nbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgIGFiLmFk\nZCgiZmV0Y2giLCBGZXRjaFR5cGUuTEFaWSk7CiAgICAgICAgaWYgKGZtZC5n\nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9O\nKQogICAgICAgICAgICBhYi5hZGQoIm9wdGlvbmFsIiwgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkIG9uZS10by1vbmUgYXR0cmlidXRlcy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE9uZVRvT25lQXR0cmlidXRl\ncyhGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9uQnVpbGRl\nciBhYikgewogICAgICAgIGlmICghZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91\ncCgpKQogICAgICAgICAgICBhYi5hZGQoImZldGNoIiwgRmV0Y2hUeXBlLkxB\nWlkpOwogICAgICAgIGlmIChmbWQuZ2V0TnVsbFZhbHVlKCkgPT0gRmllbGRN\nZXRhRGF0YS5OVUxMX0VYQ0VQVElPTikKICAgICAgICAgICAgYWIuYWRkKCJv\ncHRpb25hbCIsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBv\nbmUtdG8tbWFueSBhdHRyaWJ1dGVzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkT25lVG9NYW55QXR0cmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCwK\nICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAgIGlmIChm\nbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgIGFiLmFk\nZCgiZmV0Y2giLCBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGFkZFRhcmdl\ndEVudGl0eUF0dHJpYnV0ZShmbWQsIGFiKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBtYW55LXRvLW1hbnkgYXR0cmlidXRlcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZE1hbnlUb01hbnlBdHRyaWJ1dGVzKEZpZWxkTWV0\nYURhdGEgZm1kLAogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAg\nICAgICAgaWYgKGZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAg\nICAgICAgYWIuYWRkKCJmZXRjaCIsIEZldGNoVHlwZS5FQUdFUik7CiAgICAg\nICAgYWRkVGFyZ2V0RW50aXR5QXR0cmlidXRlKGZtZCwgYWIpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkIGEgdGFyZ2V0LWVudGl0eSBhdHRyaWJ1dGUg\ndG8gY29sbGVjdGlvbiBhbmQgbWFwIGZpZWxkcyB0aGF0IGRvCiAgICAgKiBu\nb3QgdXNlIGdlbmVyaWNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nVGFyZ2V0RW50aXR5QXR0cmlidXRlKEZpZWxkTWV0YURhdGEgZm1kLAogICAg\nICAgIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICAgICAgTWVtYmVyIG1l\nbWJlciA9IGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgQ2xhc3Nb\nXSB0eXBlczsKICAgICAgICBpZiAobWVtYmVyIGluc3RhbmNlb2YgRmllbGQp\nCiAgICAgICAgICAgIHR5cGVzID0gSmF2YVZlcnNpb25zLmdldFBhcmFtZXRl\ncml6ZWRUeXBlcygoRmllbGQpIG1lbWJlcik7CiAgICAgICAgZWxzZSBpZiAo\nbWVtYmVyIGluc3RhbmNlb2YgTWV0aG9kKQogICAgICAgICAgICB0eXBlcyA9\nIEphdmFWZXJzaW9ucy5nZXRQYXJhbWV0ZXJpemVkVHlwZXMoKE1ldGhvZCkg\nbWVtYmVyKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHR5cGVzID0gbmV3\nIENsYXNzWzBdOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgIGlmICh0eXBlcy5sZW5ndGggIT0gMSkK\nICAgICAgICAgICAgICAgICAgICBhYi5hZGQoInRhcmdldEVudGl0eSIsIGZt\nZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgICAgIGlmICh0eXBlcy5sZW5ndGggIT0gMikKICAgICAg\nICAgICAgICAgICAgICBhYi5hZGQoInRhcmdldEVudGl0eSIsIGZtZC5nZXRF\nbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFs\naXplIGZpZWxkIG1hcHBpbmcgY29udGVudDsgdGhpcyB3aWxsIGJlIGNhbGxl\nZCBiZWZvcmUKICAgICAqIHtAbGluayAjc2VyaWFsaXplVmFsdWVNYXBwaW5n\nQ29udGVudH0uIERvZXMgbm90aGluZyBieSBkZWZhdWx0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVGaWVsZE1hcHBpbmdDb250ZW50\nKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRl\nZ3kgc3RyYXRlZ3ksIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgbWFwcGluZyBhdHRyaWJ1dGVzIGZvciBzdHJh\ndGVneS4gU2V0cyBtYXBwZWQtYnkgYnkgZGVmYXVsdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgYWRkU3RyYXRlZ3lNYXBwaW5nQXR0cmlidXRlcyhG\naWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBh\nYikgewogICAgICAgIGlmIChmbWQuZ2V0TWFwcGVkQnkoKSAhPSBudWxsKQog\nICAgICAgICAgICBhYi5hZGQoIm1hcHBlZEJ5IiwgZm1kLmdldE1hcHBlZEJ5\nKCkpOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRP\nYmplY3RzKCkgewogICAgICAgIExpc3QgYWxsID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpKQogICAgICAgICAgICBhZGRR\ndWVyeU1ldGFEYXRhcyhhbGwpOwogICAgICAgIGlmIChpc01hcHBpbmdNb2Rl\nKCkpCiAgICAgICAgICAgIGFkZFNlcXVlbmNlTWV0YURhdGFzKGFsbCk7CiAg\nICAgICAgaWYgKChpc01ldGFEYXRhTW9kZSgpIHx8IGlzTWFwcGluZ01vZGUo\nKSkgJiYgX21ldGFzICE9IG51bGwpCiAgICAgICAgICAgIGFsbC5hZGRBbGwo\nX21ldGFzLnZhbHVlcygpKTsKICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgp\nKQogICAgICAgICAgICBhZGRTeXN0ZW1NYXBwaW5nRWxlbWVudHMoYWxsKTsK\nICAgICAgICBzZXJpYWxpemF0aW9uU29ydChhbGwpOwogICAgICAgIHJldHVy\nbiBhbGw7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgd3JpdGVBbm5vdGF0\naW9ucyhPYmplY3QgbWV0YSwKICAgICAgICBMaXN0PEFubm90YXRpb25CdWls\nZGVyPiBidWlsZGVycywgTWFwIG91dHB1dCkgewogICAgICAgIExpc3Q8U3Ry\naW5nPiBhbm5vcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAg\nIGZvcihBbm5vdGF0aW9uQnVpbGRlciBhYjogYnVpbGRlcnMpCiAgICAgICAg\nICAgIGFubm9zLmFkZChhYi50b1N0cmluZygpKTsKICAgICAgICBvdXRwdXQu\ncHV0KG1ldGEsIGFubm9zKTsgICAgICAgIAogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNlcmlhbGl6ZShNYXAgb3V0cHV0LCBpbnQgZmxhZ3MpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgQ29sbGVjdGlvbiBhbGwgPSBnZXRPYmpl\nY3RzKCk7CiAgICAgICAgc2VyaWFsaXplKGFsbCk7CgogICAgICAgIGlmIChf\nY2xzQW5ub3MgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChDbGFzc01ldGFE\nYXRhIG1ldGEgOiBfY2xzQW5ub3Mua2V5U2V0KCkpCiAgICAgICAgICAgICAg\nICB3cml0ZUFubm90YXRpb25zKG1ldGEsIF9jbHNBbm5vcy5nZXQobWV0YSks\nIG91dHB1dCk7CiAgICAgICAgaWYgKF9mbGRBbm5vcyAhPSBudWxsKQogICAg\nICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgbWV0YSA6IF9mbGRBbm5vcy5r\nZXlTZXQoKSkKICAgICAgICAgICAgICAgIHdyaXRlQW5ub3RhdGlvbnMobWV0\nYSwgX2ZsZEFubm9zLmdldChtZXRhKSwgb3V0cHV0KTsKICAgICAgICBpZiAo\nX3NlcUFubm9zICE9IG51bGwpCiAgICAgICAgICAgIGZvciAoU2VxdWVuY2VN\nZXRhRGF0YSBtZXRhIDogX3NlcUFubm9zLmtleVNldCgpKQogICAgICAgICAg\nICAgICAgd3JpdGVBbm5vdGF0aW9ucyhtZXRhLCBfc2VxQW5ub3MuZ2V0KG1l\ndGEpLCBvdXRwdXQpOwogICAgICAgIGlmIChfcXJ5QW5ub3MgIT0gbnVsbCkK\nICAgICAgICAgICAgZm9yIChRdWVyeU1ldGFEYXRhIG1ldGEgOiBfcXJ5QW5u\nb3Mua2V5U2V0KCkpCiAgICAgICAgICAgICAgICB3cml0ZUFubm90YXRpb25z\nKG1ldGEsIF9xcnlBbm5vcy5nZXQobWV0YSksIG91dHB1dCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2VyaWFsaXplKEZpbGUgZmlsZSwgaW50IGZsYWdz\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEZpbGVXcml0ZXIgb3V0ID0gbmV3IEZpbGVXcml0ZXIoQWNjZXNzQ29u\ndHJvbGxlcgogICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChKMkRvUHJp\ndkhlbHBlci5nZXRDYW5vbmljYWxQYXRoQWN0aW9uKGZpbGUpKSwKICAgICAg\nICAgICAgICAgIChmbGFncyAmIEFQUEVORCkgPiAwKTsKICAgICAgICAgICAg\nc2VyaWFsaXplKG91dCwgZmxhZ3MpOwogICAgICAgICAgICBvdXQuY2xvc2Uo\nKTsKICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9u\nIHBhZSkgewogICAgICAgICAgICB0aHJvdyAoSU9FeGNlcHRpb24pIHBhZS5n\nZXRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2VyaWFsaXplKFdyaXRlciBvdXQsIGludCBmbGFncykgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBNYXAgb3V0cHV0ID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICBzZXJpYWxpemUob3V0cHV0LCBmbGFncyk7CgogICAgICAg\nIGZvcihPYmplY3QgbWV0YTogb3V0cHV0LmtleVNldCgpKSB7CiAgICAgICAg\nICAgIG91dC53cml0ZSgiLS0iK21ldGEudG9TdHJpbmcoKSk7CiAgICAgICAg\nICAgIG91dC53cml0ZSgiXG4iKTsKICAgICAgICAgICAgTGlzdDxTdHJpbmc+\nIGFubm9zID0gKExpc3Q8U3RyaW5nPikgb3V0cHV0LmdldChtZXRhKTsKICAg\nICAgICAgICAgZm9yKFN0cmluZyBhbm46IGFubm9zKSB7CiAgICAgICAgICAg\nICAgICBvdXQud3JpdGUoIlx0Iik7CiAgICAgICAgICAgICAgICBvdXQud3Jp\ndGUoYW5uKTsKICAgICAgICAgICAgICAgIG91dC53cml0ZSgiXG4iKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXJpYWxpemUoaW50IGZsYWdzKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBvcmRlcmVkIHNl\ndCBvZiAKICAgICAqIHtAbGluayBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5T\nZXF1ZW5jZU1ldGFEYXRhfXMgd2l0aCBhIGNvbW1vbiBjbGFzcwogICAgICog\nc2NvcGUuCiAgICAgKgogICAgICogQGF1dGhvciBTdGVwaGVuIEtpbQogICAg\nICogQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIENsYXNzU2VxcwogICAgICAgIGltcGxlbWVudHMgU291\ncmNlVHJhY2tlciwgQ29tcGFyYWJsZTxDbGFzc1NlcXM+LAogICAgICAgIENv\nbXBhcmF0b3I8U2VxdWVuY2VNZXRhRGF0YT4gewoKICAgICAgICBwcml2YXRl\nIGZpbmFsIFNlcXVlbmNlTWV0YURhdGFbXSBfc2VxczsKCiAgICAgICAgcHVi\nbGljIENsYXNzU2VxcyhMaXN0PFNlcXVlbmNlTWV0YURhdGE+IHNlcXMpIHsK\nICAgICAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCB8fCBzZXFzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbigpOwoKICAgICAgICAgICAgX3NlcXMgPSAoU2VxdWVuY2VNZXRhRGF0YVtd\nKSBzZXFzLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgU2VxdWVuY2VN\nZXRhRGF0YVtzZXFzLnNpemUoKV0pOwogICAgICAgICAgICBBcnJheXMuc29y\ndChfc2VxcywgdGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU2Vx\ndWVuY2VNZXRhRGF0YVtdIGdldFNlcXVlbmNlcygpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9zZXFzOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogQ29tcGFyZSBzZXF1ZW5jZSBtZXRhZGF0YSBvbiBuYW1lLgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShTZXF1ZW5jZU1ldGFE\nYXRhIG8xLCBTZXF1ZW5jZU1ldGFEYXRhIG8yKSB7CiAgICAgICAgICAgIHJl\ndHVybiBvMS5nZXROYW1lKCkuY29tcGFyZVRvKG8yLmdldE5hbWUoKSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgRmlsZSBnZXRTb3VyY2VGaWxlKCkg\newogICAgICAgICAgICByZXR1cm4gX3NlcXNbMF0uZ2V0U291cmNlRmlsZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRTb3VyY2VT\nY29wZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZXFzWzBdLmdldFNvdXJj\nZVNjb3BlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldFNv\ndXJjZVR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfc2Vxc1swXS5nZXRT\nb3VyY2VUeXBlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5n\nIGdldFJlc291cmNlTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZXFz\nWzBdLmdldFJlc291cmNlTmFtZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGludCBnZXRMaW5lTnVtYmVyKCkgewogICAgICAgICAgICByZXR1cm4g\nX3NlcXNbMF0uZ2V0TGluZU51bWJlcigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludCBnZXRDb2xOdW1iZXIoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfc2Vxc1swXS5nZXRDb2xOdW1iZXIoKTsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgcHVibGljIGludCBjb21wYXJlVG8oQ2xhc3NTZXFzIG90aGVy\nKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAg\nICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBDbGFz\ncyBzY29wZSA9IChDbGFzcykgZ2V0U291cmNlU2NvcGUoKTsKICAgICAgICAg\nICAgQ2xhc3Mgb3Njb3BlID0gKENsYXNzKSBvdGhlci5nZXRTb3VyY2VTY29w\nZSgpOwogICAgICAgICAgICByZXR1cm4gc2NvcGUuZ2V0TmFtZSgpLmNvbXBh\ncmVUbyhvc2NvcGUuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXByZXNlbnRzIG9yZGVyZWQgc2V0IG9mIHtAbGluayBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRhfXMKICAgICAq\nIHdpdGggYSBjb21tb24gY2xhc3Mgc2NvcGUuCiAgICAgKgogICAgICogQGF1\ndGhvciBTdGVwaGVuIEtpbQogICAgICogQGF1dGhvciBQaW5ha2kgUG9kZGFy\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENsYXNzUXVlcmll\ncwogICAgICAgIGltcGxlbWVudHMgU291cmNlVHJhY2tlciwgQ29tcGFyYWJs\nZTxDbGFzc1F1ZXJpZXM+LAogICAgICAgIENvbXBhcmF0b3I8UXVlcnlNZXRh\nRGF0YT4gewoKICAgICAgICBwcml2YXRlIGZpbmFsIFF1ZXJ5TWV0YURhdGFb\nXSBfcXVlcmllczsKCiAgICAgICAgcHVibGljIENsYXNzUXVlcmllcyhMaXN0\nPFF1ZXJ5TWV0YURhdGE+IHF1ZXJpZXMpIHsKICAgICAgICAgICAgaWYgKHF1\nZXJpZXMgPT0gbnVsbCB8fCBxdWVyaWVzLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwoKICAgICAg\nICAgICAgX3F1ZXJpZXMgPSAoUXVlcnlNZXRhRGF0YVtdKSBxdWVyaWVzLnRv\nQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgUXVlcnlNZXRhRGF0YVtxdWVy\naWVzLnNpemUoKV0pOwogICAgICAgICAgICBBcnJheXMuc29ydChfcXVlcmll\ncywgdGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUXVlcnlNZXRh\nRGF0YVtdIGdldFF1ZXJpZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBfcXVl\ncmllczsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENvbXBh\ncmUgcXVlcnkgbWV0YWRhdGEuIE5vcm1hbCBxdWVyaWVzIGFwcGVhciBiZWZv\ncmUgbmF0aXZlIHF1ZXJpZXMuCiAgICAgICAgICogSWYgdGhlIGdpdmVuIHF1\nZXJpZXMgdXNlIHNhbWUgbGFuZ3VhZ2UsIHRoZW4gdGhlaXIgbmFtZXMgYXJl\nCiAgICAgICAgICogY29tcGFyZWQuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIGludCBjb21wYXJlKFF1ZXJ5TWV0YURhdGEgbzEsIFF1ZXJ5TWV0YURh\ndGEgbzIpIHsKICAgICAgICAgICAgLy8gbm9ybWFsIHF1ZXJpZXMgYmVmb3Jl\nIG5hdGl2ZQogICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFscyhv\nMS5nZXRMYW5ndWFnZSgpLCBvMi5nZXRMYW5ndWFnZSgpKSkgewogICAgICAg\nICAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhv\nMS5nZXRMYW5ndWFnZSgpKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nMTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG8x\nLmdldE5hbWUoKS5jb21wYXJlVG8obzIuZ2V0TmFtZSgpKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcXVlcmllc1swXS5nZXRTb3VyY2VGaWxlKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldFNvdXJjZVNjb3Bl\nKCkgewogICAgICAgICAgICByZXR1cm4gX3F1ZXJpZXNbMF0uZ2V0U291cmNl\nU2NvcGUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0U291\ncmNlVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9xdWVyaWVzWzBdLmdl\ndFNvdXJjZVR5cGUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0UmVzb3VyY2VOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gX3F1\nZXJpZXNbMF0uZ2V0UmVzb3VyY2VOYW1lKCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IGdldExpbmVOdW1iZXIoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfcXVlcmllc1swXS5nZXRMaW5lTnVtYmVyKCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IGdldENvbE51bWJlcigpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9xdWVyaWVzWzBdLmdldENvbE51bWJlcigpOwogICAgICAg\nIH0KICAgICAgICAKICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmVUbyhDbGFz\nc1F1ZXJpZXMgb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRo\naXMpCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYg\nKG90aGVyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAg\nICAgICAgICAgIENsYXNzIHNjb3BlID0gKENsYXNzKSBnZXRTb3VyY2VTY29w\nZSgpOwogICAgICAgICAgICBDbGFzcyBvc2NvcGUgPSAoQ2xhc3MpIG90aGVy\nLmdldFNvdXJjZVNjb3BlKCk7CiAgICAgICAgICAgIHJldHVybiBzY29wZS5n\nZXROYW1lKCkuY29tcGFyZVRvKG9zY29wZS5nZXROYW1lKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbXBhcmVzIGNsYXNlcywgc2Vx\ndWVuY2VzLCBhbmQgcXVlcmllcyB0byBvcmRlciB0aGVtIGZvciBzZXJpYWxp\nemF0aW9uLgogICAgICogUGxhY2VzIHNlcXVlbmNlcyBmaXJzdCwgdGhlbiBj\nbGFzc2VzLCB0aGVuIHF1ZXJpZXMuIFNlcXVlbmNlcyBhbmQKICAgICAqIHF1\nZXJpZXMgYXJlIG9yZGVyZWQgYWxwaGFiZXRpY2FsbHkgYnkgbmFtZS4gQ2xh\nc3NlcyBhcmUgcGxhY2VkIGluCiAgICAgKiBsaXN0aW5nIG9yZGVyLCBpbiBp\nbmhlcml0YW5jZSBvcmRlciB3aXRoaW4gdGhhdCwgYW5kIGluIGFscGhhYmV0\naWNhbAogICAgICogb3JkZXIgd2l0aGluIHRoYXQuCiAgICAgKgogICAgICog\nQGF1dGhvciBTdGVwaGVuIEtpbQogICAgICovCiAgICBwcm90ZWN0ZWQgY2xh\nc3MgU2VyaWFsaXphdGlvbkNvbXBhcmF0b3IKICAgICAgICBleHRlbmRzIE1l\ndGFEYXRhSW5oZXJpdGFuY2VDb21wYXJhdG9yIHsKCiAgICAgICAgcHVibGlj\nIGludCBjb21wYXJlKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAg\nICAgIGlmIChvMSA9PSBvMikKICAgICAgICAgICAgICAgIHJldHVybiAwOwog\nICAgICAgICAgICBpZiAobzEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiAxOwogICAgICAgICAgICBpZiAobzIgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgICAgIGludCB0MSA9IHR5cGUo\nbzEpOwogICAgICAgICAgICBpbnQgdDIgPSB0eXBlKG8yKTsKICAgICAgICAg\nICAgaWYgKHQxICE9IHQyKQogICAgICAgICAgICAgICAgcmV0dXJuIHQxIC0g\ndDI7CgogICAgICAgICAgICBzd2l0Y2ggKHQxKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIFRZUEVfTUVUQToKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nY29tcGFyZSgoQ2xhc3NNZXRhRGF0YSkgbzEsIChDbGFzc01ldGFEYXRhKSBv\nMik7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfUVVFUlk6CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoKFF1ZXJ5TWV0YURhdGEpIG8x\nLCAoUXVlcnlNZXRhRGF0YSkgbzIpOwogICAgICAgICAgICAgICAgY2FzZSBU\nWVBFX1NFUToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcGFyZSgo\nU2VxdWVuY2VNZXRhRGF0YSkgbzEsCiAgICAgICAgICAgICAgICAgICAgICAg\nIChTZXF1ZW5jZU1ldGFEYXRhKSBvMik7CiAgICAgICAgICAgICAgICBjYXNl\nIFRZUEVfQ0xBU1NfUVVFUklFUzoKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gKChDb21wYXJhYmxlKSBvMSkuY29tcGFyZVRvKG8yKTsKICAgICAgICAg\nICAgICAgIGNhc2UgVFlQRV9DTEFTU19TRVFTOgogICAgICAgICAgICAgICAg\nICAgIHJldHVybiAoKENvbXBhcmFibGUpIG8xKS5jb21wYXJlVG8obzIpOwog\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gY29tcGFyZVVua25vd24obzEsIG8yKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcGFyZSB0d28g\ndW5yZWNvZ25pemVkIGVsZW1lbnRzIG9mIHRoZSBzYW1lIHR5cGUuIFRocm93\ncwogICAgICAgICAqIGV4Y2VwdGlvbiBieSBkZWZhdWx0LgogICAgICAgICAq\nLwogICAgICAgIHByb3RlY3RlZCBpbnQgY29tcGFyZVVua25vd24oT2JqZWN0\nIG8xLCBPYmplY3QgbzIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVy\nbmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBDb21wYXJlIGJldHdlZW4gdHdvIGNsYXNzIG1ldGFkYXRhLgogICAg\nICAgICAqLwogICAgICAgIHByaXZhdGUgaW50IGNvbXBhcmUoQ2xhc3NNZXRh\nRGF0YSBvMSwgQ2xhc3NNZXRhRGF0YSBvMikgewogICAgICAgICAgICBpbnQg\nbGkxID0gbzEuZ2V0TGlzdGluZ0luZGV4KCk7CiAgICAgICAgICAgIGludCBs\naTIgPSBvMi5nZXRMaXN0aW5nSW5kZXgoKTsKICAgICAgICAgICAgaWYgKGxp\nMSA9PSAtMSAmJiBsaTIgPT0gLTEpIHsKICAgICAgICAgICAgICAgIE1ldGFE\nYXRhVGFnIHQxID0gZ2V0RW50aXR5VGFnKG8xKTsKICAgICAgICAgICAgICAg\nIE1ldGFEYXRhVGFnIHQyID0gZ2V0RW50aXR5VGFnKG8yKTsKICAgICAgICAg\nICAgICAgIGlmICh0MS5jb21wYXJlVG8odDIpICE9IDApCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHQxLmNvbXBhcmVUbyh0Mik7CiAgICAgICAgICAg\nICAgICBpbnQgaW5oZXIgPSBzdXBlci5jb21wYXJlKG8xLCBvMik7CiAgICAg\nICAgICAgICAgICBpZiAoaW5oZXIgIT0gMCkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gaW5oZXI7CiAgICAgICAgICAgICAgICByZXR1cm4gbzEuZ2V0\nRGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKS5jb21wYXJlVG8KICAgICAgICAg\nICAgICAgICAgICAobzIuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsaTEgPT0gLTEpCiAg\nICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKGxpMiA9\nPSAtMSkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAg\ncmV0dXJuIGxpMSAtIGxpMjsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIENvbXBhcmUgcXVlcnkgbWV0YWRhdGEuCiAgICAgICAgICovCiAg\nICAgICAgcHJpdmF0ZSBpbnQgY29tcGFyZShRdWVyeU1ldGFEYXRhIG8xLCBR\ndWVyeU1ldGFEYXRhIG8yKSB7CiAgICAgICAgICAgIC8vIG5vcm1hbCBxdWVy\naWVzIGJlZm9yZSBuYXRpdmUKICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5lcXVhbHMobzEuZ2V0TGFuZ3VhZ2UoKSwgbzIuZ2V0TGFuZ3VhZ2UoKSkp\nIHsKICAgICAgICAgICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX1NR\nTC5lcXVhbHMobzEuZ2V0TGFuZ3VhZ2UoKSkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBvMS5nZXROYW1lKCkuY29tcGFyZVRvKG8yLmdldE5hbWUoKSk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDb21wYXJlIHNl\ncXVlbmNlIG1ldGFkYXRhLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUg\naW50IGNvbXBhcmUoU2VxdWVuY2VNZXRhRGF0YSBvMSwgU2VxdWVuY2VNZXRh\nRGF0YSBvMikgewogICAgICAgICAgICByZXR1cm4gbzEuZ2V0TmFtZSgpLmNv\nbXBhcmVUbyhvMi5nZXROYW1lKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFNvcnRzIGZpZWxkcyBhY2NvcmRpbmcgdG8gbGlzdGluZyBv\ncmRlciwgdGhlbiBYU0Qgc3RyYXRlZ3kgb3JkZXIsCiAgICAgKiB0aGVuIG5h\nbWUgb3JkZXIuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgRmllbGRDb21w\nYXJhdG9yCiAgICAgICAgaW1wbGVtZW50cyBDb21wYXJhdG9yIHsKCiAgICAg\nICAgcHVibGljIGludCBjb21wYXJlKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kMSA9IChGaWVsZE1ldGFE\nYXRhKSBvMTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQyID0gKEZp\nZWxkTWV0YURhdGEpIG8yOwogICAgICAgICAgICBpZiAoZm1kMS5pc1ByaW1h\ncnlLZXkoKSkgewogICAgICAgICAgICAgICAgaWYgKGZtZDIuaXNQcmltYXJ5\nS2V5KCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZtZDEuY29tcGFy\nZVRvKGZtZDIpOwogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChmbWQyLmlzUHJpbWFyeUtleSgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIDE7CgogICAgICAgICAgICBpZiAoZm1k\nMS5pc1ZlcnNpb24oKSkgewogICAgICAgICAgICAgICAgaWYgKGZtZDIuaXNW\nZXJzaW9uKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmVM\naXN0aW5nT3JkZXIoZm1kMSwgZm1kMik7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0U3RyYXRlZ3koZm1kMikgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5C\nQVNJQyA/IDEgOiAtMTsKCQkJfQoJCQlpZiAoZm1kMi5pc1ZlcnNpb24oKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRTdHJhdGVneShmbWQxKSA9PSBQ\nZXJzaXN0ZW5jZVN0cmF0ZWd5LkJBU0lDID8gLTEgOiAxOwoKICAgICAgICAg\nICAgaW50IHN0Y21wID0gZ2V0U3RyYXRlZ3koZm1kMSkuY29tcGFyZVRvKGdl\ndFN0cmF0ZWd5KGZtZDIpKTsKICAgICAgICAgICAgaWYgKHN0Y21wICE9IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3RjbXA7CiAgICAgICAgICAgIHJl\ndHVybiBjb21wYXJlTGlzdGluZ09yZGVyKGZtZDEsIGZtZDIpOwogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSBpbnQgY29tcGFyZUxpc3RpbmdPcmRlcihG\naWVsZE1ldGFEYXRhIGZtZDEsIEZpZWxkTWV0YURhdGEgZm1kMil7CiAgICAg\nICAgICAgIGludCBsY21wID0gZm1kMS5nZXRMaXN0aW5nSW5kZXgoKSAtIGZt\nZDIuZ2V0TGlzdGluZ0luZGV4KCk7CiAgICAgICAgICAgIGlmIChsY21wICE9\nIDApCiAgICAgICAgICAgICAgICByZXR1cm4gbGNtcDsKICAgICAgICAgICAg\ncmV0dXJuIGZtZDEuY29tcGFyZVRvKGZtZDIpOwoJCX0KCX0KfQo=\n","encoding":"base64"}

