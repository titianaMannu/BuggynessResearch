{"sha":"8e0f8788ff9f4ee0505c9aa19dfc2b36087464ad","node_id":"MDQ6QmxvYjIwNjM2NDo4ZTBmODc4OGZmOWY0ZWUwNTA1YzlhYTE5ZGZjMmIzNjA4NzQ2NGFk","size":11857,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8e0f8788ff9f4ee0505c9aa19dfc2b36087464ad","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLnNwaS5Mb2FkU3Rh\ndGU7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lz\ndGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFu\nY2UuU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5Ccm9rZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkltcGxIZWxwZXI7CgpwdWJsaWMgY2xhc3MgT3BlbkpQQVBlcnNp\nc3RlbmNlVXRpbCB7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBpZGVu\ndGlmaWVyIG9mIHRoZSBwZXJzaXN0ZW50IGVudGl0eS4KICAgICAqIEBwYXJh\nbSBlbnRpdHkKICAgICAqIEByZXR1cm4gVGhlIGlkZW50aWZpZXIgb2YgdGhl\nIGVudGl0eSBvciBudWxsIGlmIHRoZSBlbnRpdHkKICAgICAqIGlzIG5vdCBw\nZXJzaXN0ZW50LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBn\nZXRJZGVudGlmaWVyKE9iamVjdCBlbnRpdHkpIHsKICAgICAgICByZXR1cm4g\nZ2V0SWRlbnRpZmllcihudWxsLCBlbnRpdHkpOwogICAgfQoKICAgIC8qKgog\nICAgICogR2V0IHRoZSBvYmplY3QgaWRlbnRpZmllciBmb3IgYSBwZXJzaXN0\nZW50IGVudGl0eSBtYW5hZ2VkIGJ5IG9uZQogICAgICogb2YgdGhlIGVudGl0\neSBtYW5hZ2VycyBvZiB0aGUgc3BlY2lmaWVkIGVudGl0eSBtYW5hZ2VyIGZh\nY3RvcnkuCiAgICAgKiBAcmV0dXJuIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBl\nbnRpdHkgb3IgbnVsbCBpZiB0aGUgZW50aXR5IGRvZXMKICAgICAqIG5vdCBo\nYXZlIGFuIGlkZW50aWZpZXIgYXNzaWduZWQgb3IgaXMgbm90IG1hbmFnZWQg\nYnkgYW55IG9mIHRoZQogICAgICogZW50aXR5IG1hbmFnZXJzIG9mIHRoZSBl\nbnRpdHkgbWFuYWdlciBmYWN0b3J5LgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIE9iamVjdCBnZXRJZGVudGlmaWVyKE9wZW5KUEFFbnRpdHlNYW5hZ2Vy\nRmFjdG9yeSBlbWYsIAogICAgICAgIE9iamVjdCBlbnRpdHkpIHsKCiAgICAg\nICAgaWYgKGVudGl0eSBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJsZSkg\newogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lz\ndGVuY2VDYXBhYmxlKWVudGl0eTsKICAgICAgICAgICAgLy8gUGVyIGNvbnRy\nYWN0LCBpZiBub3QgbWFuYWdlZCBieSB0aGUgb3duaW5nIGVtZiwgcmV0dXJu\nIG51bGwuCiAgICAgICAgICAgIGlmIChlbWYgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKCFpc01hbmFnZWRCeShlbWYsIHBjKSkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIFN0YXRlTWFuYWdlciBzbSA9IHBj\nLnBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgIAogICAgICAgICAg\nICBpZiAoc20gIT0gbnVsbCAmJiBzbSBpbnN0YW5jZW9mIE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgb3NtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpc207CiAgICAgICAgICAg\nICAgICByZXR1cm4gb3NtLmdldE9iamVjdElkKCk7ICAgICAgICAgICAgICAg\nIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxs\nOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRo\nZSBzcGVjaWZpZWQgc3RhdGUgbWFuYWdlciBpcyBtYW5hZ2VkIGJ5IGFuIG9w\nZW4KICAgICAqIGJyb2tlciB3aXRoaW4gdGhlIHBlcnNpc3RlbmNlIHVuaXQg\nb2YgdGhlIHByb3ZpZGVkIEVNRiBpbnN0YW5jZS4KICAgICAqIEBwYXJhbSBl\nbWYgT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5CiAgICAgKiBAcGFyYW0g\nc20gU3RhdGVNYW5hZ2VyCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhpcyBz\ndGF0ZSBtYW5hZ2VyIGlzIG1hbmFnZWQgYnkgYSBicm9rZXIgd2l0aGluCiAg\nICAgKiB0aGlzIHBlcnNpc3RlbmNlIHVuaXQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgYm9vbGVhbiBpc01hbmFnZWRCeShPcGVuSlBBRW50aXR5TWFu\nYWdlckZhY3RvcnkgZW1mLCBPYmplY3QgZW50aXR5KSB7CiAgICAgICAgLy8g\nQXNzZXJ0IGEgdmFsaWQgZW1mIHdhcyBwcm92aWRlZCwgaXQgaXMgb3Blbiwg\nYW5kIHRoZSBlbnRpdHkgaXMgUEMKICAgICAgICBpZiAoZW1mID09IG51bGwg\nfHwgIWVtZi5pc09wZW4oKSB8fCAhSW1wbEhlbHBlci5pc01hbmFnZWFibGUo\nZW50aXR5KSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQogICAgICAgIC8vIEFzc2VydCB0aGUgY29udGV4dCBpcyBhIGJyb2tlcgog\nICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNh\ncGFibGUpZW50aXR5OwogICAgICAgIGlmICghKHBjLnBjR2V0R2VuZXJpY0Nv\nbnRleHQoKSBpbnN0YW5jZW9mIEJyb2tlcikpIHsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBBc3NlcnQgdGhlIGJy\nb2tlciBpcyBhdmFpbGFibGUgYW5kIG9wZW4KICAgICAgICBCcm9rZXIgYnJv\na2VyID0gKEJyb2tlcilwYy5wY0dldEdlbmVyaWNDb250ZXh0KCk7CiAgICAg\nICAgaWYgKGJyb2tlciA9PSBudWxsIHx8IGJyb2tlci5pc0Nsb3NlZCgpKSB7\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAg\nLy8gQXNzZXJ0IHRoZSBlbWYgYXNzb2NpYXRlZCB3aXRoIHRoZSBQQyBpcyB0\naGUgc2FtZSBhcyB0aGUgcHJvdmlkZWQgZW1mCiAgICAgICAgT3BlbkpQQUVu\ndGl0eU1hbmFnZXJGYWN0b3J5IGVlbWYgPSBKUEFGYWNhZGVIZWxwZXIudG9F\nbnRpdHlNYW5hZ2VyRmFjdG9yeShicm9rZXIuZ2V0QnJva2VyRmFjdG9yeSgp\nKTsKICAgICAgICBpZiAoZWVtZiA9PSBlbWYgJiYgZWVtZi5pc09wZW4oKSkg\newogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5l\ncyB3aGV0aGVyIHRoZSBhdHRyaWJ1dGUgb24gdGhlIHNwZWNpZmllZCBvYmpl\nY3QgaXMgbG9hZGVkIGFuZAogICAgICogaXMgbWFuYWdlZCBieSBvbmUgb2Yg\ndGhlIGVudGl0eSBtYW5hZ2Vycy4gIFVzZSBpc01hbmFnZWRCeSgpIHRvCiAg\nICAgKiBkZXRlcm1pbmUgaWYgYW4gb2JqZWN0IGlzIG1hbmFnZWQgYnkgYSBz\ncGVjaWZpYyBlbnRpdHkgbWFuYWdlcgogICAgICogZmFjdG9yeS4KICAgICAq\nIAogICAgICogQHJldHVybiBMb2FkU3RhdGUuTE9BREVEIC0gaWYgdGhlIGF0\ndHJpYnV0ZSBpcyBsb2FkZWQuCiAgICAgKiAgICAgICAgIExvYWRTdGF0ZS5O\nT1RfTE9BREVEIC0gaWYgdGhlIGF0dHJpYnV0ZSBpcyBub3QgbG9hZGVkIG9y\nIGFueQogICAgICogICAgICAgICBFQUdFUiBmZXRjaCBhdHRyaWJ1dGVzIG9m\nIHRoZSBlbnRpdHkgYXJlIG5vdCBsb2FkZWQuCiAgICAgKiAgICAgICAgIExv\nYWRTdGF0ZS5VTktOT1dOIC0gaWYgdGhlIGVudGl0eSBpcyBub3QgbWFuYWdl\nZCBieSB0aGlzCiAgICAgKiAgICAgICAgIHByb3ZpZGVyIG9yIGlmIGl0IGRv\nZXMgbm90IGNvbnRhaW4gdGhlIHBlcnNpc3RlbnQKICAgICAqICAgICAgICAg\nYXR0cmlidXRlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIExvYWRTdGF0\nZSBpc0xvYWRlZChPYmplY3Qgb2JqLCBTdHJpbmcgYXR0cikgewoKICAgICAg\nICBpZiAob2JqID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIExvYWRT\ndGF0ZS5VTktOT1dOOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBJ\nZiB0aGUgb2JqZWN0IGhhcyBhIHN0YXRlIG1hbmFnZXIsIGNhbGwgaXQgZGly\nZWN0bHkuCiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNl\nQ2FwYWJsZSkgewogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMg\nPSAoUGVyc2lzdGVuY2VDYXBhYmxlKW9iajsKICAgICAgICAgICAgU3RhdGVN\nYW5hZ2VyIHNtID0gcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAg\nICAgaWYgKHNtICE9IG51bGwgJiYgc20gaW5zdGFuY2VvZiBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXNMb2FkZWQo\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIpc20sIGF0dHIsIG51bGwpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSAgICAgICAgCiAgICAgICAgcmV0dXJuIExvYWRT\ndGF0ZS5VTktOT1dOOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIExvYWRT\ndGF0ZSBpc0xvYWRlZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBTdHJpbmcg\nYXR0ciwgCiAgICAgICAgSGFzaFNldDxPcGVuSlBBU3RhdGVNYW5hZ2VyPiBw\nY3MpIHsKICAgICAgICBib29sZWFuIGlzTG9hZGVkID0gdHJ1ZTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBCaXRTZXQgbG9hZFNldCA9IHNtLmdldExv\nYWRlZCgpOwogICAgICAgICAgICBpZiAoYXR0ciAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHNtLmdldE1ldGFEYXRh\nKCkuZ2V0RmllbGQoYXR0cik7CiAgICAgICAgICAgICAgICAvLyBDb3VsZCBu\nb3QgZmluZCBmaWVsZCBtZXRhZGF0YSBmb3IgdGhlIHNwZWNpZmllZCBhdHRy\naWJ1dGUuCiAgICAgICAgICAgICAgICBpZiAoZm1kID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gTG9hZFN0YXRlLlVOS05PV047CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2Us\nIHJldHVybiB0aGUgbG9hZCBzdGF0ZQogICAgICAgICAgICAgICAgaWYoIWxv\nYWRTZXQuZ2V0KGZtZC5nZXRJbmRleCgpKSkgewogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBMb2FkU3RhdGUuTk9UX0xPQURFRDsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAg\nICAgICAgIC8vIENoZWNrIGxvYWQgc3RhdGUgb2YgYWxsIHBlcnNpc3RlbnQg\nZWFnZXIgZmV0Y2ggYXR0cmlidXRlcwogICAgICAgICAgICBpZiAoZm1kcyAh\nPSBudWxsICYmIGZtZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAg\ncGNzID0gYWRkVG9Mb2FkU2V0KHBjcywgc20pOwogICAgICAgICAgICAgICAg\nZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IGZtZHMpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNMb2FkZWRGaWVsZChzbSwg\nZm1kLCBwY3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0xv\nYWRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwY3Mu\ncmVtb3ZlKHNtKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyB0cmVhdCBhbnkg\nZXhjZXB0aW9ucywgbGlrZSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlv\nbgogICAgICAgICAgICAvLyBmb3IgZGV0YWNoZWQgZW50aXRpZXMsIGFzIExv\nYWRTdGF0ZS5VTktOT1dOCiAgICAgICAgICAgIHJldHVybiBMb2FkU3RhdGUu\nVU5LTk9XTjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGlzTG9hZGVkID8g\nTG9hZFN0YXRlLkxPQURFRCA6IExvYWRTdGF0ZS5OT1RfTE9BREVEOyAgICAg\nICAgCiAgICB9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIEhhc2hTZXQ8T3Bl\nbkpQQVN0YXRlTWFuYWdlcj4gYWRkVG9Mb2FkU2V0KAogICAgICAgIEhhc2hT\nZXQ8T3BlbkpQQVN0YXRlTWFuYWdlcj4gcGNzLCBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtKSB7CiAgICAgICAgaWYgKHBjcyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHBjcyA9IG5ldyBIYXNoU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+KCk7\nCiAgICAgICAgfQogICAgICAgIHBjcy5hZGQoc20pOwogICAgICAgIHJldHVy\nbiBwY3M7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0xv\nYWRlZEZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQsIEhhc2hTZXQ8T3BlbkpQQVN0YXRlTWFuYWdlcj4g\ncGNzKSB7CiAgICAgICAgQml0U2V0IGxvYWRTZXQgPSBzbS5nZXRMb2FkZWQo\nKTsKICAgICAgICAgICAgICAgIAogICAgICAgIC8vIFNpbXBsZSBsb2FkIHN0\nYXRlIGNoZWNrIGZvciB0aGUgZmllbGQKICAgICAgICBpZiAoIWxvYWRTZXQu\nZ2V0KGZtZC5nZXRJbmRleCgpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICBPYmplY3QgZmllbGQgPSBzbS5mZXRjaEZpZWxkKGZtZC5n\nZXRJbmRleCgpLCBmYWxzZSk7CgogICAgICAgIC8vIEdldCB0aGUgc3RhdGUg\nbWFuYWdlciBmb3IgdGhlIGZpZWxkLCBpZiBpdCBpcyBhIFBDCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBvZnNtID0gZ2V0U3RhdGVNYW5hZ2VyKGZp\nZWxkKTsKCiAgICAgICAgLy8gUHJldmVudCBjaXJjdWxhciBsb2FkIHN0YXRl\nIGV2YWx1YXRpb24gZm9yIHRoaXMgc20uCiAgICAgICAgaWYgKG9mc20gIT0g\nbnVsbCAmJiBwY3MuY29udGFpbnMob2ZzbSkpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIAogICAgICAgIC8vIElmIGEgY29sbGVjdGlvbiB0\neXBlLCBkZXRlcm1pbmUgaWYgaXQgaXMgbG9hZGVkCiAgICAgICAgc3dpdGNo\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046ICAgCiAgICAgICAgICAgICAgICBy\nZXR1cm4gaXNMb2FkZWRDb2xsZWN0aW9uKHNtLCBmbWQuZ2V0RWxlbWVudCgp\nLCAKICAgICAgICAgICAgICAgICAgICAoQ29sbGVjdGlvbjw/PilmaWVsZCwg\ncGNzKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGlzTG9hZGVkTWFwKHNtLCBmbWQsIAogICAgICAg\nICAgICAgICAgICAgIChNYXA8Pyw/PilmaWVsZCwgcGNzKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICByZXR1\ncm4gaXNMb2FkZWRBcnJheShzbSwgZm1kLmdldEVsZW1lbnQoKSwgCiAgICAg\nICAgICAgICAgICAgICAgKE9iamVjdFtdKWZpZWxkLCBwY3MpOwogICAgICAg\nIH0KICAgICAgICAvLyBJZiBvdGhlciBQQyB0eXBlLCBkZXRlcm1pbmUgaWYg\naXQgaXMgbG9hZGVkCiAgICAgICAgaWYgKG9mc20gIT0gbnVsbCAmJiBmbWQu\naXNEZWNsYXJlZFR5cGVQQygpKSB7CiAgICAgICAgICAgIHJldHVybiBpc0xv\nYWRlZChvZnNtLCBudWxsLCBwY3MpID09CiAgICAgICAgICAgICAgICBMb2Fk\nU3RhdGUuTE9BREVEOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9IAogICAgCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzTG9h\nZGVkQ29sbGVjdGlvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCAKICAgICAg\nICBWYWx1ZU1ldGFEYXRhIHZtZCwgQ29sbGVjdGlvbjw/PiBjb2xsLCBIYXNo\nU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+IHBjcykgewogICAgICAgIAogICAg\nICAgIC8vIFRoaXMgZmllbGQgcGFzc2VkIHRoZSBsb2FkIHN0YXRlIGNoZWNr\nIGluIGlzTG9hZGVkRmllbGQsIHNvCiAgICAgICAgLy8gaWYgYW55IG9mIHRo\nZXNlIGNvbmRpdGlvbnMgYXJlIHRydWUgdGhlIGNvbGxlY3Rpb24gaXMgbG9h\nZGVkLgogICAgICAgIGlmIChzbSA9PSBudWxsIHx8IGNvbGwgPT0gbnVsbCB8\nfCBjb2xsLnNpemUoKSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDb252ZXJ0IHRvIGFy\ncmF5IHRvIHByZXZlbnQgY29uY3VycmVuY3kgaXNzdWVzCiAgICAgICAgT2Jq\nZWN0W10gYXJyID0gY29sbC50b0FycmF5KCk7CgogICAgICAgIHJldHVybiBp\nc0xvYWRlZEFycmF5KHNtLCB2bWQsIGFyciwgcGNzKTsKICAgIH0KCiAgICBw\ncml2YXRlIHN0YXRpYyBib29sZWFuIGlzTG9hZGVkQXJyYXkoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQsIE9i\namVjdFtdIGFyciwgCiAgICAgICAgSGFzaFNldDxPcGVuSlBBU3RhdGVNYW5h\nZ2VyPiBwY3MpIHsKCiAgICAgICAgLy8gVGhpcyBmaWVsZCBwYXNzZWQgdGhl\nIGxvYWQgc3RhdGUgY2hlY2sgaW4gaXNMb2FkZWRGaWVsZCwgc28KICAgICAg\nICAvLyBpZiBhbnkgb2YgdGhlc2UgY29uZGl0aW9ucyBhcmUgdHJ1ZSB0aGUg\nYXJyYXkgaXMgbG9hZGVkLgogICAgICAgIGlmIChzbSA9PSBudWxsIHx8IGFy\nciA9PSBudWxsIHx8IGFyci5sZW5ndGggPT0gMCkgewogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIE5vdCBhIGNvbGxl\nY3Rpb24gb2YgUEMncyAKICAgICAgICBpZiAoIXZtZC5pc0RlY2xhcmVkVHlw\nZVBDKCkpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nICAgICAKICAgICAgICBmb3IgKE9iamVjdCBwYyA6IGFycikgewogICAgICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGVzbSA9IGdldFN0YXRlTWFuYWdl\ncihwYyk7CiAgICAgICAgICAgIGlmIChlc20gPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKCEoaXNMb2FkZWQoZXNtLCBudWxsLCBwY3MpID09IExvYWRTdGF0\nZS5MT0FERUQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBib29sZWFuIGlzTG9hZGVkTWFwKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kLCBNYXA8Pyw/PiBt\nYXAsIEhhc2hTZXQ8T3BlbkpQQVN0YXRlTWFuYWdlcj4gcGNzKSB7CiAgICAg\nICAgICAgICAgICAKICAgICAgICAvLyBUaGlzIGZpZWxkIHBhc3NlZCB0aGUg\nbG9hZCBzdGF0ZSBjaGVjayBpbiBpc0xvYWRlZEZpZWxkLCBzbwogICAgICAg\nIC8vIGlmIGFueSBvZiB0aGVzZSBjb25kaXRpb25zIGFyZSB0cnVlIHRoZSBt\nYXAgaXMgbG9hZGVkLgogICAgICAgIGlmIChzbSA9PSBudWxsIHx8IG1hcCA9\nPSBudWxsIHx8IG1hcC5zaXplKCkgPT0gMCkgewogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4ga2V5SXNQQyA9\nIGZtZC5nZXRLZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgYm9v\nbGVhbiB2YWxJc1BDID0gZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlw\nZVBDKCk7CgogICAgICAgIC8vIE1hcCBpcyBkb2VzIG5vdCBjb250YWluIFBD\ncyBpbiBlaXRoZXIga2V5cyBvciB2YWx1ZXMKICAgICAgICBpZiAoIShrZXlJ\nc1BDIHx8IHZhbElzUEMpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgT2JqZWN0W10gYXJyID0gbWFwLmtl\neVNldCgpLnRvQXJyYXkoKTsKCiAgICAgICAgZm9yIChPYmplY3Qga2V5IDog\nYXJyKSB7CiAgICAgICAgICAgIGlmIChrZXlJc1BDKSB7CiAgICAgICAgICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGtzbSA9IGdldFN0YXRlTWFuYWdl\ncihrZXkpOwogICAgICAgICAgICAgICAgaWYgKGtzbSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAg\nICB9ICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBp\nZiAoIShpc0xvYWRlZChrc20sIG51bGwsIHBjcykgPT0gTG9hZFN0YXRlLkxP\nQURFRCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWxJc1BDKSB7CiAgICAgICAg\nICAgICAgICBPYmplY3QgdmFsdWUgPSBtYXAuZ2V0KGtleSk7CiAgICAgICAg\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHZzbSA9IGdldFN0YXRlTWFu\nYWdlcih2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAodnNtID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAg\nICAgIGlmICghKGlzTG9hZGVkKHZzbSwgbnVsbCwgcGNzKSA9PSBMb2FkU3Rh\ndGUuTE9BREVEKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGdldFN0YXRlTWFuYWdlcihPYmplY3Qg\nb2JqKSB7ICAgICAgICAKICAgICAgICBpZiAob2JqID09IG51bGwgfHwgIShv\nYmogaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZUNhcGFibGUpKSB7CiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKW9i\najsKICAgICAgICBTdGF0ZU1hbmFnZXIgc20gPSBwYy5wY0dldFN0YXRlTWFu\nYWdlcigpOwogICAgICAgIGlmIChzbSA9PSBudWxsIHx8ICEoc20gaW5zdGFu\nY2VvZiBPcGVuSlBBU3RhdGVNYW5hZ2VyKSkgewogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyKXNtOwogICAgfQp9Cg==\n","encoding":"base64"}

