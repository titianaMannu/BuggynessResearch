{"sha":"4808df8e437cf8f06fa190f469285c196b48d5b8","node_id":"MDQ6QmxvYjIwNjM2NDo0ODA4ZGY4ZTQzN2NmOGYwNmZhMTkwZjQ2OTI4NWMxOTZiNDhkNWI4","size":34568,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4808df8e437cf8f06fa190f469285c196b48d5b8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcuYW5u\nb3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZp\nZWxkOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWVtYmVyOwppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0Nv\nbnRyb2xsZXI7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKCmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5BY2Nlc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5BY2Nlc3NUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQmFz\naWM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbGVtZW50Q29sbGVjdGlv\nbjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGFibGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRlZDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkVtYmVkZGVkSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFueVRv\nT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5Qb3N0TG9hZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLlBvc3RQZXJzaXN0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdFJl\nbW92ZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlBvc3RVcGRhdGU7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmVQZXJzaXN0OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuUHJlUmVtb3ZlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuUHJlVXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVHJh\nbnNpZW50OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoy\nRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFic3Ry\nYWN0TWV0YURhdGFEZWZhdWx0czsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkFjY2Vzc0NvZGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CgppbXBvcnQgc3RhdGljIGphdmF4\nLnBlcnNpc3RlbmNlLkFjY2Vzc1R5cGUuRklFTEQ7CmltcG9ydCBzdGF0aWMg\namF2YXgucGVyc2lzdGVuY2UuQWNjZXNzVHlwZS5QUk9QRVJUWTsKaW1wb3J0\nIHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuUGVyc2lz\ndGVuY2VTdHJhdGVneS4qOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5SZWZsZWN0aW9uOwoKLyoqCiAq\nIEpQQS1iYXNlZCBtZXRhZGF0YSBkZWZhdWx0cy4KICoKICogQGF1dGhvciBQ\nYXRyaWNrIExpbnNrZXkKICogQGF1dGhvciBBYmUgV2hpdGUKICogQGF1dGhv\nciBQaW5ha2kgUG9kZGFyCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFz\ncyBQZXJzaXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMKICAgIGV4dGVuZHMgQWJz\ndHJhY3RNZXRhRGF0YURlZmF1bHRzIHsKCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAg\nICAgICAgKFBlcnNpc3RlbmNlTWV0YURhdGFEZWZhdWx0cy5jbGFzcyk7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENsYXNzPD8+LCBQZXJzaXN0\nZW5jZVN0cmF0ZWd5PiBfc3RyYXRzID0KICAgICAgICBuZXcgSGFzaE1hcDxD\nbGFzczw/PiwgUGVyc2lzdGVuY2VTdHJhdGVneT4oKTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIFNldDxTdHJpbmc+IF9pZ25vcmVkQW5ub3MgPSBuZXcg\nSGFzaFNldDxTdHJpbmc+KCk7CgogICAgc3RhdGljIHsKICAgICAgICBfc3Ry\nYXRzLnB1dChCYXNpYy5jbGFzcywgQkFTSUMpOwogICAgICAgIF9zdHJhdHMu\ncHV0KE1hbnlUb09uZS5jbGFzcywgTUFOWV9PTkUpOwogICAgICAgIF9zdHJh\ndHMucHV0KE9uZVRvT25lLmNsYXNzLCBPTkVfT05FKTsKICAgICAgICBfc3Ry\nYXRzLnB1dChFbWJlZGRlZC5jbGFzcywgRU1CRURERUQpOwogICAgICAgIF9z\ndHJhdHMucHV0KEVtYmVkZGVkSWQuY2xhc3MsIEVNQkVEREVEKTsKICAgICAg\nICBfc3RyYXRzLnB1dChPbmVUb01hbnkuY2xhc3MsIE9ORV9NQU5ZKTsKICAg\nICAgICBfc3RyYXRzLnB1dChNYW55VG9NYW55LmNsYXNzLCBNQU5ZX01BTlkp\nOwogICAgICAgIF9zdHJhdHMucHV0KFBlcnNpc3RlbnQuY2xhc3MsIFBFUlMp\nOwogICAgICAgIF9zdHJhdHMucHV0KFBlcnNpc3RlbnRDb2xsZWN0aW9uLmNs\nYXNzLCBQRVJTX0NPTEwpOwogICAgICAgIF9zdHJhdHMucHV0KEVsZW1lbnRD\nb2xsZWN0aW9uLmNsYXNzLCBFTEVNX0NPTEwpOwogICAgICAgIF9zdHJhdHMu\ncHV0KFBlcnNpc3RlbnRNYXAuY2xhc3MsIFBFUlNfTUFQKTsKCiAgICAgICAg\nX2lnbm9yZWRBbm5vcy5hZGQoRGV0YWNoZWRTdGF0ZS5jbGFzcy5nZXROYW1l\nKCkpOwogICAgICAgIF9pZ25vcmVkQW5ub3MuYWRkKFBvc3RMb2FkLmNsYXNz\nLmdldE5hbWUoKSk7CiAgICAgICAgX2lnbm9yZWRBbm5vcy5hZGQoUG9zdFBl\ncnNpc3QuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICBfaWdub3JlZEFubm9z\nLmFkZChQb3N0UmVtb3ZlLmNsYXNzLmdldE5hbWUoKSk7CiAgICAgICAgX2ln\nbm9yZWRBbm5vcy5hZGQoUG9zdFVwZGF0ZS5jbGFzcy5nZXROYW1lKCkpOwog\nICAgICAgIF9pZ25vcmVkQW5ub3MuYWRkKFByZVBlcnNpc3QuY2xhc3MuZ2V0\nTmFtZSgpKTsKICAgICAgICBfaWdub3JlZEFubm9zLmFkZChQcmVSZW1vdmUu\nY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICBfaWdub3JlZEFubm9zLmFkZChQ\ncmVVcGRhdGUuY2xhc3MuZ2V0TmFtZSgpKTsKICAgIH0KCgkvKioKICAgICAq\nIFNldCBvZiBJbmNsdXNpb24gRmlsdGVycyBiYXNlZCBvbiBtZW1iZXIgdHlw\nZSwgYWNjZXNzIHR5cGUgb3IgdHJhbnNpZW50CiAgICAgKiBhbm5vdGF0aW9u\ncy4gVXNlZCB0byBkZXRlcm1pbmUgdGhlIHBlcnNpc3RlbnQgZmllbGQvbWV0\naG9kcy4KICAgICAqLwogICAgcHJvdGVjdGVkIEFjY2Vzc0ZpbHRlciBwcm9w\nZXJ0eUFjY2Vzc0ZpbHRlciA9IG5ldyBBY2Nlc3NGaWx0ZXIoUFJPUEVSVFkp\nOwogICAgcHJvdGVjdGVkIEFjY2Vzc0ZpbHRlciBmaWVsZEFjY2Vzc0ZpbHRl\nciA9IG5ldyBBY2Nlc3NGaWx0ZXIoRklFTEQpOwoKICAgIHByb3RlY3RlZCBN\nZW1iZXJGaWx0ZXIgZmllbGRGaWx0ZXIgPSBuZXcgTWVtYmVyRmlsdGVyKEZp\nZWxkLmNsYXNzKTsKICAgIHByb3RlY3RlZCBNZW1iZXJGaWx0ZXIgbWV0aG9k\nRmlsdGVyID0gbmV3IE1lbWJlckZpbHRlcihNZXRob2QuY2xhc3MpOwogICAg\ncHJvdGVjdGVkIFRyYW5zaWVudEZpbHRlciBub25UcmFuc2llbnRGaWx0ZXIg\nPSBuZXcgVHJhbnNpZW50RmlsdGVyKCk7CiAgICBwcm90ZWN0ZWQgQW5ub3Rh\ndGVkRmlsdGVyIGFubm90YXRlZEZpbHRlciA9IG5ldyBBbm5vdGF0ZWRGaWx0\nZXIoKTsKICAgIHByb3RlY3RlZCBHZXR0ZXJGaWx0ZXIgZ2V0dGVyRmlsdGVy\nID0gbmV3IEdldHRlckZpbHRlcigpOwogICAgcHJvdGVjdGVkIFNldHRlckZp\nbHRlciBzZXR0ZXJGaWx0ZXIgPSBuZXcgU2V0dGVyRmlsdGVyKCk7CiAgICBw\ncml2YXRlIEJvb2xlYW4gX2lzQWJzdHJhY3RNYXBwaW5nVW5pRGlyZWN0aW9u\nYWwgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9pc05vbkRlZmF1bHRN\nYXBwaW5nQWxsb3dlZCA9IG51bGw7CiAgICAKICAgIHB1YmxpYyBQZXJzaXN0\nZW5jZU1ldGFEYXRhRGVmYXVsdHMoKSB7CiAgICAgICAgc2V0Q2FsbGJhY2tN\nb2RlKENBTExCQUNLX1JFVEhST1cgfCBDQUxMQkFDS19ST0xMQkFDSyB8CiAg\nICAgICAgICAgIENBTExCQUNLX0ZBSUxfRkFTVCk7CiAgICAgICAgc2V0RGF0\nYVN0b3JlT2JqZWN0SWRGaWVsZFVud3JhcHBlZCh0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgY29kZSBmb3IgdGhlIHN0cmF0ZWd5\nIG9mIHRoZSBnaXZlbiBtZW1iZXIuIFJldHVybiBudWxsIGlmCiAgICAgKiBu\nbyBzdHJhdGVneS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBQZXJzaXN0\nZW5jZVN0cmF0ZWd5IGdldFBlcnNpc3RlbmNlU3RyYXRlZ3kKICAgIChGaWVs\nZE1ldGFEYXRhIGZtZCwgTWVtYmVyIG1lbWJlcikgewogICAgICAgIHJldHVy\nbiBnZXRQZXJzaXN0ZW5jZVN0cmF0ZWd5KGZtZCwgbWVtYmVyLCBmYWxzZSk7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb2RlIGZv\nciB0aGUgc3RyYXRlZ3kgb2YgdGhlIGdpdmVuIG1lbWJlci4gUmV0dXJuIG51\nbGwgaWYKICAgICAqIG5vIHN0cmF0ZWd5LgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIFBlcnNpc3RlbmNlU3RyYXRlZ3kgZ2V0UGVyc2lzdGVuY2VTdHJh\ndGVneQogICAgICAgIChGaWVsZE1ldGFEYXRhIGZtZCwgTWVtYmVyIG1lbWJl\nciwgYm9vbGVhbiBpZ25vcmVUcmFuc2llbnQpIHsKICAgICAgICBpZiAobWVt\nYmVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIEFubm90YXRlZEVsZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxlbWVudCkgbWVt\nYmVyOwogICAgICAgIGlmICghaWdub3JlVHJhbnNpZW50ICYmIChBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAg\nICAgICAuaXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihlbCwgVHJhbnNpZW50\nLmNsYXNzKSkpLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICByZXR1cm4g\nVFJBTlNJRU5UOwogICAgICAgIGlmIChmbWQgIT0gbnVsbAogICAgICAgICAg\nICAmJiBmbWQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFO\nQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICAvLyBsb29rIGZvciBwZXJzaXN0ZW5jZSBzdHJhdGVneSBpbiBhbm5v\ndGF0aW9uIHRhYmxlCiAgICAgICAgUGVyc2lzdGVuY2VTdHJhdGVneSBwc3Ry\nYXQgPSBudWxsOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogZWwu\nZ2V0RGVjbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAgIGlmIChw\nc3RyYXQgIT0gbnVsbCAmJiBfc3RyYXRzLmNvbnRhaW5zS2V5KGFubm8uYW5u\nb3RhdGlvblR5cGUoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImFscmVhZHktcGVycyIsIG1lbWJl\ncikpOwogICAgICAgICAgICBpZiAocHN0cmF0ID09IG51bGwpCiAgICAgICAg\nICAgICAgICBwc3RyYXQgPSBfc3RyYXRzLmdldChhbm5vLmFubm90YXRpb25U\neXBlKCkpOwogICAgICAgIH0KICAgICAgICBpZiAocHN0cmF0ICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBwc3RyYXQ7CgogICAgICAgIENsYXNzIHR5\ncGU7CiAgICAgICAgaW50IGNvZGU7CiAgICAgICAgaWYgKGZtZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIHR5cGUgPSBmbWQuZ2V0VHlwZSgpOwogICAgICAg\nICAgICBjb2RlID0gZm1kLmdldFR5cGVDb2RlKCk7CiAgICAgICAgfSBlbHNl\nIGlmIChtZW1iZXIgaW5zdGFuY2VvZiBGaWVsZCkgewogICAgICAgICAgICB0\neXBlID0gKChGaWVsZCkgbWVtYmVyKS5nZXRUeXBlKCk7CiAgICAgICAgICAg\nIGNvZGUgPSBKYXZhVHlwZXMuZ2V0VHlwZUNvZGUodHlwZSk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgdHlwZSA9ICgoTWV0aG9kKSBtZW1iZXIp\nLmdldFJldHVyblR5cGUoKTsKICAgICAgICAgICAgY29kZSA9IEphdmFUeXBl\ncy5nZXRUeXBlQ29kZSh0eXBlKTsKICAgICAgICB9CgogICAgICAgIHN3aXRj\naCAoY29kZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToK\nICAgICAgICAgICAgICAgIGlmICh0eXBlID09IGJ5dGVbXS5jbGFzcwogICAg\nICAgICAgICAgICAgICAgIHx8IHR5cGUgPT0gY2hhcltdLmNsYXNzCiAgICAg\nICAgICAgICAgICAgICAgfHwgdHlwZSA9PSBCeXRlW10uY2xhc3MKICAgICAg\nICAgICAgICAgICAgICB8fCB0eXBlID09IENoYXJhY3RlcltdLmNsYXNzKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBCQVNJQzsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFO\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JK\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5GTE9BVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNI\nT1JUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBCQVNJQzsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAg\naWYgKEVudW0uY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gQkFTSUM7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICB9CgogICAgICAgIC8vIyMjIEVKQjM6IHdoYXQgaWYg\nZGVmaW5lZCBpbiBYTUw/CiAgICAgICAgaWYgKChBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAuaXNB\nbm5vdGF0aW9uUHJlc2VudEFjdGlvbih0eXBlLCBFbWJlZGRhYmxlLmNsYXNz\nKSkpLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICByZXR1cm4gRU1CRURE\nRUQ7CiAgICAgICAgaWYgKFNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKHR5cGUpKQogICAgICAgICAgICByZXR1cm4gQkFTSUM7CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQXV0\nby1jb25maWd1cmF0aW9uIG1ldGhvZCBmb3IgdGhlIGRlZmF1bHQgYWNjZXNz\nIHR5cGUgb2YgYmFzZSBjbGFzc2VzIAogICAgICogd2l0aCBBQ0NFU1NfVU5L\nTk9XTgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZWZhdWx0QWNjZXNz\nVHlwZShTdHJpbmcgdHlwZSkgewogICAgICAgIGlmICgiUFJPUEVSVFkiLmVx\ndWFscyh0eXBlLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICBzZXREZWZh\ndWx0QWNjZXNzVHlwZShBY2Nlc3NDb2RlLlBST1BFUlRZKTsKICAgICAgICBl\nbHNlIGlmICgiRklFTEQiLmVxdWFscyh0eXBlLnRvVXBwZXJDYXNlKCkpKQog\nICAgICAgICAgICBzZXREZWZhdWx0QWNjZXNzVHlwZShBY2Nlc3NDb2RlLkZJ\nRUxEKTsKICAgICAgICBlbHNlCiAgICAgICAgCXRocm93IG5ldyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoImFjY2Vzcy1pbnZhbGlkIiwg\nCiAgICAgICAgCSAgICB0eXBlKS50b1N0cmluZygpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBvcHVsYXRlcyB0aGUgZ2l2ZW4gY2xhc3MgbWV0YWRhdGEu\nIFRoZSBhY2Nlc3Mgc3R5bGUgZGV0ZXJtaW5lcyB3aGljaAogICAgICogZmll\nbGQgYW5kL29yIGdldHRlciBtZXRob2Qgd2lsbCBjb250cmlidXRlIGFzIHRo\nZSBwZXJzaXN0ZW50IHByb3BlcnR5CiAgICAgKiBvZiB0aGUgZ2l2ZW4gY2xh\nc3MuIElmIHRoZSBnaXZlbiBhY2Nlc3MgaXMgdW5rbm93biwgdGhlbiB0aGUg\nYWNjZXNzCiAgICAgKiB0eXBlIGlzIHRvIGJlIGRldGVybWluZWQgYXQgZmly\nc3QuIAogICAgICogCiAgICAgKiBAc2VlICNkZXRlcm1pbmVBY2Nlc3NUeXBl\nKENsYXNzTWV0YURhdGEpCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgcG9wdWxhdGUoQ2xhc3NNZXRhRGF0YSBtZXRhLCBpbnQgYWNj\nZXNzKSB7CiAgICAgICAgcG9wdWxhdGUobWV0YSwgYWNjZXNzLCBmYWxzZSk7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogUG9wdWxhdGVzIHRoZSBnaXZl\nbiBjbGFzcyBtZXRhZGF0YS4gVGhlIGFjY2VzcyBzdHlsZSBkZXRlcm1pbmVz\nIHdoaWNoCiAgICAgKiBmaWVsZCBhbmQvb3IgZ2V0dGVyIG1ldGhvZCB3aWxs\nIGNvbnRyaWJ1dGUgYXMgdGhlIHBlcnNpc3RlbnQgcHJvcGVydHkKICAgICAq\nIG9mIHRoZSBnaXZlbiBjbGFzcy4gSWYgdGhlIGdpdmVuIGFjY2VzcyBpcyB1\nbmtub3duLCB0aGVuIHRoZSBhY2Nlc3MKICAgICAqIHR5cGUgaXMgdG8gYmUg\nZGV0ZXJtaW5lZCBhdCBmaXJzdC4gCiAgICAgKiAKICAgICAqIEBzZWUgI2Rl\ndGVybWluZUFjY2Vzc1R5cGUoQ2xhc3NNZXRhRGF0YSkKICAgICAqLwogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShDbGFzc01ldGFE\nYXRhIG1ldGEsIGludCBhY2Nlc3MsIGJvb2xlYW4gaWdub3JlVHJhbnNpZW50\nKSB7CiAgICAJaWYgKEFjY2Vzc0NvZGUuaXNVbmtub3duKGFjY2VzcykpIHsK\nICAgIAkJYWNjZXNzID0gZGV0ZXJtaW5lQWNjZXNzVHlwZShtZXRhKTsKICAg\nIAl9CiAgICAJaWYgKEFjY2Vzc0NvZGUuaXNVbmtub3duKGFjY2VzcykpIHsK\nICAgIAkJZXJyb3IobWV0YSwgX2xvYy5nZXQoImFjY2Vzcy11bmtub3duIiwg\nbWV0YSkpOwogICAgCX0KICAgICAgICBzdXBlci5wb3B1bGF0ZShtZXRhLCBh\nY2Nlc3MsIGlnbm9yZVRyYW5zaWVudCk7CiAgICAgICAgbWV0YS5zZXREZXRh\nY2hhYmxlKHRydWUpOwogICAgICAgIC8vIGRvIG5vdCBjYWxsIGdldCpGaWVs\nZHMgYXMgaXQgd2lsbCBsb2NrIGRvd24gdGhlIGZpZWxkcy4KICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHBvcHVsYXRlKEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgc2V0Q2FzY2FkZU5vbmUoZm1kKTsK\nICAgICAgICBzZXRDYXNjYWRlTm9uZShmbWQuZ2V0S2V5KCkpOwogICAgICAg\nIHNldENhc2NhZGVOb25lKGZtZC5nZXRFbGVtZW50KCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogVHVybnMgb2ZmIGF1dG8gY2FzY2FkaW5nIG9mIHBlcnNp\nc3QsIHJlZnJlc2gsIGF0dGFjaCwgZGV0YWNoLgogICAgICovCiAgICBzdGF0\naWMgdm9pZCBzZXRDYXNjYWRlTm9uZShWYWx1ZU1ldGFEYXRhIHZtZCkgewog\nICAgICAgIHZtZC5zZXRDYXNjYWRlUGVyc2lzdChWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfTk9ORSk7CiAgICAgICAgdm1kLnNldENhc2NhZGVSZWZyZXNoKFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKTsKICAgICAgICB2bWQuc2V0Q2Fz\nY2FkZUF0dGFjaChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORSk7CiAgICAg\nICAgdm1kLnNldENhc2NhZGVEZXRhY2goVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX05PTkUpOwogICAgfQogICAgCiAgICBDbGFzc01ldGFEYXRhIGdldENhY2hl\nZFN1cGVyY2xhc3NNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nIAlpZiAobWV0YSA9PSBudWxsKQogICAgCQlyZXR1cm4gbnVsbDsKICAgIAlD\nbGFzczw/PiBjbHMgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgIAlD\nbGFzczw/PiBzdXAgPSBjbHMuZ2V0U3VwZXJjbGFzcygpOwogICAgCWlmIChz\ndXAgPT0gbnVsbCB8fCAiamF2YS5sYW5nLk9iamVjdCIuZXF1YWxzKAogICAg\nCSAgICBzdXAuZ2V0TmFtZSgpKSkKICAgIAkJcmV0dXJuIG51bGw7CiAgICAJ\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gbWV0YS5nZXRSZXBvc2l0b3J5\nKCk7CiAgICAJQ2xhc3NNZXRhRGF0YSBzdXBNZXRhID0gcmVwb3MuZ2V0Q2Fj\naGVkTWV0YURhdGEoc3VwKTsKICAgIAlpZiAoc3VwTWV0YSA9PSBudWxsKQog\nICAgCQlzdXBNZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEoc3VwLCBudWxsLCBm\nYWxzZSk7CiAgICAJcmV0dXJuIHN1cE1ldGE7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWN1cnNpdmUgaGVscGVyIHRvIGRldGVybWluZSBhY2Nlc3MgdHlw\nZSBiYXNlZCBvbiBhbm5vdGF0aW9uIHBsYWNlbWVudAogICAgICogb24gbWVt\nYmVycyBmb3IgdGhlIGdpdmVuIGNsYXNzIHdpdGhvdXQgYW4gZXhwbGljaXQg\nYWNjZXNzIGFubm90YXRpb24uCiAgICAgKiAKICAgICAqIEByZXR1cm4gbXVz\ndCByZXR1cm4gYSBub3QtdW5rbm93biBhY2Nlc3MgY29kZSAKICAgICAqLwog\nICAgcHJpdmF0ZSBpbnQgZGV0ZXJtaW5lQWNjZXNzVHlwZShDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgIAlpZiAobWV0YSA9PSBudWxsKQogICAgCQlyZXR1\ncm4gQWNjZXNzQ29kZS5VTktOT1dOOwogICAgICAgIGlmIChtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpKSAvLyBtYW5hZ2VkIGludGVy\nZmFjZXMgCiAgICAgICAgCXJldHVybiBBY2Nlc3NDb2RlLlBST1BFUlRZOwog\nICAgCWlmICghQWNjZXNzQ29kZS5pc1Vua25vd24obWV0YSkpCiAgICAJCXJl\ndHVybiBtZXRhLmdldEFjY2Vzc1R5cGUoKTsKICAgIAlpbnQgYWNjZXNzID0g\nZGV0ZXJtaW5lRXhwbGljaXRBY2Nlc3NUeXBlKG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpKTsKICAgIAlpZiAoIUFjY2Vzc0NvZGUuaXNVbmtub3duKGFjY2Vz\ncykpCiAgICAJCXJldHVybiBhY2Nlc3M7CiAgICAJYWNjZXNzID0gZGV0ZXJt\naW5lSW1wbGljaXRBY2Nlc3NUeXBlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nLAogICAgCSAgICAgICAgICAgIG1ldGEuZ2V0UmVwb3NpdG9yeSgpLmdldENv\nbmZpZ3VyYXRpb24oKSk7CiAgICAJaWYgKCFBY2Nlc3NDb2RlLmlzVW5rbm93\nbihhY2Nlc3MpKQogICAgCQlyZXR1cm4gYWNjZXNzOwogICAgCQogICAgCUNs\nYXNzTWV0YURhdGEgc3VwID0gZ2V0Q2FjaGVkU3VwZXJjbGFzc01ldGFEYXRh\nKG1ldGEpOwogICAgCUNsYXNzTWV0YURhdGEgdG1wU3VwID0gc3VwOwogICAg\nCXdoaWxlICh0bXBTdXAgIT0gbnVsbCAmJiB0bXBTdXAuaXNFeHBsaWNpdEFj\nY2VzcygpKSB7CiAgICAgICAgICAgIHRtcFN1cCA9IGdldENhY2hlZFN1cGVy\nY2xhc3NNZXRhRGF0YSh0bXBTdXApOwogICAgICAgICAgICBpZiAodG1wU3Vw\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHN1cCA9IHRtcFN1cDsKICAg\nICAgICAgICAgfSAgICAJICAgIAogICAgCX0KICAgIAlpZiAoc3VwICE9IG51\nbGwgJiYgIUFjY2Vzc0NvZGUuaXNVbmtub3duKHN1cCkpCiAgICAJCXJldHVy\nbiBzdXAuZ2V0QWNjZXNzVHlwZSgpOwogICAgCQogICAgICAgIHJldHVybiBn\nZXREZWZhdWx0QWNjZXNzVHlwZSgpOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIERldGVybWluZXMgdGhlIGFjY2VzcyB0eXBlIGZvciB0aGUgZ2l2ZW4g\nY2xhc3MgYnkgcGxhY2VtZW50IG9mIAogICAgICogYW5ub3RhdGlvbnMgb24g\nZmllbGQgb3IgZ2V0dGVyIG1ldGhvZC4gRG9lcyBub3QgY29uc3VsdCB0aGUK\nICAgICAqIHN1cGVyIGNsYXNzLgogICAgICogCiAgICAgKiBBbm5vdGF0aW9u\nIGNhbiBiZSBwbGFjZWQgb24gZWl0aGVyIGZpZWxkcyBvciBnZXR0ZXJzIGJ1\ndCBub3Qgb24gYm90aC4KICAgICAqIElmIG5vIGZpZWxkIG9yIGdldHRlciBp\ncyBhbm5vdGF0ZWQgdGhlbiBVTktOT1dOIGFjY2VzcyBjb2RlIGlzIHJldHVy\nbmVkLgogICAgICovCiAgICBwcml2YXRlIGludCBkZXRlcm1pbmVJbXBsaWNp\ndEFjY2Vzc1R5cGUoQ2xhc3M8Pz4gY2xzLCBPcGVuSlBBQ29uZmlndXJhdGlv\nbgogICAgICAgIGNvbmYpIHsKICAgIAlpZiAoY2xzLmlzSW50ZXJmYWNlKCkp\nIC8vIE1hbmFnZWQgaW50ZXJmYWNlcwogICAgCQlyZXR1cm4gQWNjZXNzQ29k\nZS5QUk9QRVJUWTsKICAgICAgICBGaWVsZFtdIGFsbEZpZWxkcyA9IEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyLgogICAg\nICAgICAgICAgICAgZ2V0RGVjbGFyZWRGaWVsZHNBY3Rpb24oY2xzKSk7CgkJ\nTWV0aG9kW10gbWV0aG9kcyA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAoJCQkJSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RzQWN0\naW9uKGNscykpOwogICAgICAgIExpc3Q8RmllbGQ+IGZpZWxkcyA9IGZpbHRl\ncihhbGxGaWVsZHMsIG5vblRyYW5zaWVudEZpbHRlcik7CiAgICAgICAgLyoK\nICAgICAgICAgKiBPcGVuSlBBIDEueCBwZXJtaXR0ZWQgcHJpdmF0ZSBwcm9w\nZXJ0aWVzIHRvIGJlIHBlcnNpc3RlbnQuICBUaGlzIGlzCiAgICAgICAgICog\nY29udHJhcnkgdG8gdGhlIEpQQSAxLjAgc3BlY2lmaWNhdGlvbiwgd2hpY2gg\nc3RhdGVzIHRoYXQgcGVyc2lzdGVudAogICAgICAgICAqIHByb3BlcnRpZXMg\nbXVzdCBiZSBwdWJsaWMgb3IgcHJvdGVjdGVkLiBPcGVuSlBBIDIuMCsgd2ls\nbCBhZGhlcmUKICAgICAgICAgKiB0byB0aGUgc3BlY2lmaWNhdGlvbiBieSBk\nZWZhdWx0LCBidXQgcHJvdmlkZXMgYSBjb21wYXRpYmlsaXR5CiAgICAgICAg\nICogb3B0aW9uIHRvIHByb3ZpZGUgcHJlLTIuMCBiZWhhdmlvci4KICAgICAg\nICAgKi8KICAgICAgICBnZXR0ZXJGaWx0ZXIuc2V0SW5jbHVkZVByaXZhdGUo\nCiAgICAgICAgICAgIGNvbmYuZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCku\nZ2V0UHJpdmF0ZVBlcnNpc3RlbnRQcm9wZXJ0aWVzKCkpOwogICAgICAgIExp\nc3Q8TWV0aG9kPiBnZXR0ZXJzID0gZmlsdGVyKG1ldGhvZHMsIGdldHRlckZp\nbHRlciwgCiAgICAgICAgCQlub25UcmFuc2llbnRGaWx0ZXIpOwogICAgICAg\nIGlmIChmaWVsZHMuaXNFbXB0eSgpICYmIGdldHRlcnMuaXNFbXB0eSgpKQog\nICAgICAgIAlyZXR1cm4gQWNjZXNzQ29kZS5FTVBUWTsKICAgICAgICAKICAg\nICAgICBmaWVsZHMgPSBmaWx0ZXIoZmllbGRzLCBhbm5vdGF0ZWRGaWx0ZXIp\nOwogICAgICAgIGdldHRlcnMgPSBmaWx0ZXIoZ2V0dGVycywgYW5ub3RhdGVk\nRmlsdGVyKTsKICAgICAgICAKCQlMaXN0PE1ldGhvZD4gc2V0dGVycyA9IGZp\nbHRlcihtZXRob2RzLCBzZXR0ZXJGaWx0ZXIpOwogICAgICAgIGdldHRlcnMg\nPSAgbWF0Y2hHZXR0ZXJBbmRTZXR0ZXIoZ2V0dGVycywgc2V0dGVycyk7CiAg\nICAgICAgCiAgICAgICAgYm9vbGVhbiBtaXhlZCA9ICFmaWVsZHMuaXNFbXB0\neSgpICYmICFnZXR0ZXJzLmlzRW1wdHkoKTsKICAgICAgICBpZiAobWl4ZWQp\nCiAgICAgICAgCXRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJh\nY2Nlc3MtbWl4ZWQiLCAKICAgICAgICAJCWNscywgdG9GaWVsZE5hbWVzKGZp\nZWxkcyksIHRvTWV0aG9kTmFtZXMoZ2V0dGVycykpKTsKICAgICAgICBpZiAo\nIWZpZWxkcy5pc0VtcHR5KCkpIHsKICAgICAgICAJcmV0dXJuIEFjY2Vzc0Nv\nZGUuRklFTEQ7CiAgICAgICAgfSAKICAgICAgICBpZiAoIWdldHRlcnMuaXNF\nbXB0eSgpKSB7CiAgICAgICAgCXJldHVybiBBY2Nlc3NDb2RlLlBST1BFUlRZ\nOwogICAgICAgIH0gCiAgICAgICAgcmV0dXJuIEFjY2Vzc0NvZGUuVU5LTk9X\nTjsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBFeHBsaWNpdCBhY2Nlc3Mg\ndHlwZSwgaWYgYW55LCBpcyBnZW5lcmFsbHkgZGV0ZWN0ZWQgYnkgdGhlIHBh\ncnNlci4gVGhpcwogICAgICogaXMgb25seSB1c2VkIGZvciBtZXRhZGF0YSBv\nZiBhbiBlbWJlZGRhYmxlIHR5cGUgd2hpY2ggaXMgZW5jb3VudGVyZWQKICAg\nICAqIGFzIGEgZmllbGQgZHVyaW5nIHNvbWUgb3RoZXIgb3duaW5nIGVudGl0\neS4KICAgICAqIAogICAgICogQHNlZSBWYWx1ZU1ldGFEYXRhI2FkZEVtYmVk\nZGVkTWV0YURhdGEoKQogICAgICovCiAgICBwcml2YXRlIGludCBkZXRlcm1p\nbmVFeHBsaWNpdEFjY2Vzc1R5cGUoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAg\nQWNjZXNzIGFjY2VzcyA9IGNscy5nZXRBbm5vdGF0aW9uKEFjY2Vzcy5jbGFz\ncyk7CiAgICAgICAgcmV0dXJuIGFjY2VzcyA9PSBudWxsID8gQWNjZXNzQ29k\nZS5VTktOT1dOIDogKChhY2Nlc3MudmFsdWUoKSA9PSAKICAgICAgICAgICAg\nQWNjZXNzVHlwZS5GSUVMRCA/IEFjY2Vzc0NvZGUuRklFTEQgOiBBY2Nlc3ND\nb2RlLlBST1BFUlRZKSB8CiAgICAgICAgICAgIEFjY2Vzc0NvZGUuRVhQTElD\nSVQpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIE1hdGNoZXMgdGhlIGdp\ndmVuIGdldHRlcnMgd2l0aCB0aGUgZ2l2ZW4gc2V0dGVycy4gUmVtb3ZlcyB0\naGUgZ2V0dGVycwogICAgICogdGhhdCBkbyBub3QgaGF2ZSBhIGNvcnJlc3Bv\nbmRpbmcgc2V0dGVyLgogICAgICovCiAgICBwcml2YXRlIExpc3Q8TWV0aG9k\nPiBtYXRjaEdldHRlckFuZFNldHRlcihMaXN0PE1ldGhvZD4gZ2V0dGVycywg\nIAogICAgCQlMaXN0PE1ldGhvZD4gc2V0dGVycykgewogICAgICAgIENvbGxl\nY3Rpb248TWV0aG9kPiB1bm1hdGNoZWQgPSAgbmV3IEFycmF5TGlzdDxNZXRo\nb2Q+KCk7CiAgICAgICAKICAgICAgICBmb3IgKE1ldGhvZCBnZXR0ZXIgOiBn\nZXR0ZXJzKSB7CiAgICAgICAgICAgIFN0cmluZyBnZXR0ZXJOYW1lID0gZ2V0\ndGVyLmdldE5hbWUoKTsKICAgICAgICAgICAgQ2xhc3M8Pz4gZ2V0dGVyUmV0\ndXJuVHlwZSA9IGdldHRlci5nZXRSZXR1cm5UeXBlKCk7CiAgICAgICAgICAg\nIFN0cmluZyBleHBlY3RlZFNldHRlck5hbWUgPSAic2V0IiArIGdldHRlck5h\nbWUuc3Vic3RyaW5nKAogICAgICAgICAgICAgICAgKGlzQm9vbGVhbkdldHRl\ncihnZXR0ZXIpID8gImlzIiA6ICJnZXQiKS5sZW5ndGgoKSk7CiAgICAgICAg\nICAgIGJvb2xlYW4gbWF0Y2hlZCA9IGZhbHNlOwogICAgICAgICAgICBmb3Ig\nKE1ldGhvZCBzZXR0ZXIgOiBzZXR0ZXJzKSB7CiAgICAgICAgICAgICAgICBD\nbGFzczw/PiBzZXR0ZXJBcmdUeXBlID0gc2V0dGVyLmdldFBhcmFtZXRlclR5\ncGVzKClbMF07CiAgICAgICAgICAgICAgICBTdHJpbmcgYWN0dWFsU2V0dGVy\nTmFtZSA9IHNldHRlci5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICBtYXRj\naGVkID0gYWN0dWFsU2V0dGVyTmFtZS5lcXVhbHMoZXhwZWN0ZWRTZXR0ZXJO\nYW1lKQogICAgICAgICAgICAgICAgICAgICYmIHNldHRlckFyZ1R5cGUgPT0g\nZ2V0dGVyUmV0dXJuVHlwZTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaGVk\nKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmICghbWF0Y2hlZCkgewogICAgICAgICAgICAgICAgdW5t\nYXRjaGVkLmFkZChnZXR0ZXIpOwogICAgICAgICAgICB9CgogICAgICAgIH0K\nICAgICAgICBnZXR0ZXJzLnJlbW92ZUFsbCh1bm1hdGNoZWQpOwogICAgICAg\nIHJldHVybiBnZXR0ZXJzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0\naGUgZmllbGRzIHRoYXQgYXJlIHBvc3NpYmxlIGNhbmRpZGF0ZSBmb3IgYmVp\nbmcgcGVyc2lzdGVkLiBUaGUgIAogICAgICogcmVzdWx0IGRlcGVuZHMgb24g\ndGhlIGN1cnJlbnQgYWNjZXNzIHN0eWxlIG9mIHRoZSBnaXZlbiBjbGFzcy4g\nCiAgICAgKi8KICAgIExpc3Q8RmllbGQ+IGdldFBlcnNpc3RlbnRGaWVsZHMo\nQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIGlnbm9yZVRyYW5zaWVudCkg\newogICAgCWJvb2xlYW4gZXhwbGljaXQgPSBtZXRhLmlzRXhwbGljaXRBY2Nl\nc3MoKTsKICAgIAlib29sZWFuIHVua25vd24gID0gQWNjZXNzQ29kZS5pc1Vu\na25vd24obWV0YSk7CiAgICAJYm9vbGVhbiBpc0ZpZWxkICA9IEFjY2Vzc0Nv\nZGUuaXNGaWVsZChtZXRhKTsKICAgIAkKICAgIAlpZiAoZXhwbGljaXQgfHwg\ndW5rbm93biB8fCBpc0ZpZWxkKSB7CiAgICAJCUZpZWxkW10gZmllbGRzID0g\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIu\nCiAgICAgICAgICAgICAgICBnZXREZWNsYXJlZEZpZWxkc0FjdGlvbihtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSkpOwogICAgCQkKICAgICAgICAJcmV0dXJu\nIGZpbHRlcihmaWVsZHMsIGZpZWxkRmlsdGVyLCAKICAgICAgICAJICAgIGln\nbm9yZVRyYW5zaWVudCA/IG51bGwgOiBub25UcmFuc2llbnRGaWx0ZXIsIAog\nICAgICAgIAkJdW5rbm93biB8fCBpc0ZpZWxkICA/IG51bGwgOiBhbm5vdGF0\nZWRGaWx0ZXIsIAogICAgICAgIAkgICAgZXhwbGljaXQgPyAoaXNGaWVsZCA/\nIG51bGwgOiBmaWVsZEFjY2Vzc0ZpbHRlcikgOiBudWxsKTsKICAgIAl9IAog\nICAgCXJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEdldHMgdGhlIG1ldGhvZHMgdGhhdCBhcmUgcG9z\nc2libGUgY2FuZGlkYXRlIGZvciBiZWluZyBwZXJzaXN0ZWQuIFRoZSAgCiAg\nICAgKiByZXN1bHQgZGVwZW5kcyBvbiB0aGUgY3VycmVudCBhY2Nlc3Mgc3R5\nbGUgb2YgdGhlIGdpdmVuIGNsYXNzLiAKICAgICAqLwogICAgTGlzdDxNZXRo\nb2Q+IGdldFBlcnNpc3RlbnRNZXRob2RzKENsYXNzTWV0YURhdGEgbWV0YSwg\nYm9vbGVhbiBpZ25vcmVUcmFuc2llbnQpIHsKICAgIAlib29sZWFuIGV4cGxp\nY2l0ID0gbWV0YS5pc0V4cGxpY2l0QWNjZXNzKCk7CiAgICAJYm9vbGVhbiB1\nbmtub3duICA9IEFjY2Vzc0NvZGUuaXNVbmtub3duKG1ldGEuZ2V0QWNjZXNz\nVHlwZSgpKTsKICAgIAlib29sZWFuIGlzUHJvcGVydHkgID0gQWNjZXNzQ29k\nZS5pc1Byb3BlcnR5KG1ldGEuZ2V0QWNjZXNzVHlwZSgpKTsKICAgIAkKICAg\nIAlpZiAoZXhwbGljaXQgfHwgdW5rbm93biB8fCBpc1Byb3BlcnR5KSB7CiAg\nICAJCU1ldGhvZFtdIHB1YmxpY01ldGhvZHMgPSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXREZWNsYXJlZE1ldGhvZHNBY3Rpb24obWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkpKTsKICAgICAgICAKICAgIAkJTGlzdDxNZXRob2Q+IGdldHRlcnMgPSBm\naWx0ZXIocHVibGljTWV0aG9kcywgbWV0aG9kRmlsdGVyLCAKICAgICAgICAg\nICAgICAgIGdldHRlckZpbHRlciwgCiAgICAgICAgICAgICAgICBpZ25vcmVU\ncmFuc2llbnQgPyBudWxsIDogbm9uVHJhbnNpZW50RmlsdGVyLCAKICAgICAg\nICAJCXVua25vd24gfHwgaXNQcm9wZXJ0eSA/IG51bGwgOiBhbm5vdGF0ZWRG\naWx0ZXIsIAogICAgICAgICAgICAgICAgZXhwbGljaXQgPyAoaXNQcm9wZXJ0\neSA/IG51bGwgOiBwcm9wZXJ0eUFjY2Vzc0ZpbHRlcikgOiBudWxsKTsKICAg\nIAkJTGlzdDxNZXRob2Q+IHNldHRlcnMgPSBmaWx0ZXIocHVibGljTWV0aG9k\ncywgc2V0dGVyRmlsdGVyKTsKICAgIAkJcmV0dXJuIGdldHRlcnMgPSBtYXRj\naEdldHRlckFuZFNldHRlcihnZXR0ZXJzLCBzZXR0ZXJzKTsKICAgIAl9CiAg\nICAgICAgCiAgICAJcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAg\nICB9CiAgICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIG1lbWJlcnMgdGhh\ndCBhcmUgYmFja2luZyBtZW1iZXJzIGZvciBhdHRyaWJ1dGVzIGJlaW5nIHBl\ncnNpc3RlZC4KICAgICAqIFVubGlrZSB7QGxpbmtwbGFpbiAjZ2V0UGVyc2lz\ndGVudEZpZWxkcyhDbGFzc01ldGFEYXRhKX0gYW5kIAogICAgICoge0BsaW5r\ncGxhaW4gI2dldFBlcnNpc3RlbnRNZXRob2RzKENsYXNzTWV0YURhdGEpfSB3\naGljaCByZXR1cm5zIAogICAgICogPGVtPnBvc3NpYmxlPC9lbT4gY2FuZGlk\nYXRlcywgdGhlIHJlc3VsdCBvZiB0aGlzIG1ldGhvZCBpcyBkZWZpbml0ZS4K\nICAgICAqIAogICAgICogU2lkZS1lZmZlY3Qgb2YgdGhpcyBtZXRob2QgaXMg\naWYgdGhlIGdpdmVuIGNsYXNzIG1ldGFkYXRhIGhhcyAKICAgICAqIG5vIGFj\nY2VzcyB0eXBlIHNldCwgdGhpcyBtZXRob2Qgd2lsbCBzZXQgaXQuCiAgICAg\nKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIExpc3Q8TWVtYmVyPiBnZXRQ\nZXJzaXN0ZW50TWVtYmVycyhDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4g\naWdub3JlVHJhbnNpZW50KSB7CiAgICAJTGlzdDxNZW1iZXI+IG1lbWJlcnMg\nPSBuZXcgQXJyYXlMaXN0PE1lbWJlcj4oKTsKICAgIAlMaXN0PEZpZWxkPiBm\naWVsZHMgICA9IGdldFBlcnNpc3RlbnRGaWVsZHMobWV0YSwgaWdub3JlVHJh\nbnNpZW50KTsKICAgIAlMaXN0PE1ldGhvZD4gZ2V0dGVycyA9IGdldFBlcnNp\nc3RlbnRNZXRob2RzKG1ldGEsIGlnbm9yZVRyYW5zaWVudCk7CiAgICAJCiAg\nICAJYm9vbGVhbiBpc01peGVkID0gIWZpZWxkcy5pc0VtcHR5KCkgJiYgIWdl\ndHRlcnMuaXNFbXB0eSgpOwogICAgCWJvb2xlYW4gaXNFbXB0eSA9IGZpZWxk\ncy5pc0VtcHR5KCkgJiYgZ2V0dGVycy5pc0VtcHR5KCk7CgogICAgCWJvb2xl\nYW4gZXhwbGljaXQgICAgPSBtZXRhLmlzRXhwbGljaXRBY2Nlc3MoKTsKICAg\nIAlib29sZWFuIHVua25vd24gICAgID0gQWNjZXNzQ29kZS5pc1Vua25vd24o\nbWV0YS5nZXRBY2Nlc3NUeXBlKCkpOwogICAgCQogICAgCWlmIChpc0VtcHR5\nKSB7CiAgICAJCXdhcm4obWV0YSwgX2xvYy5nZXQoImFjY2Vzcy1lbXB0eSIs\nIG1ldGEpKTsKICAgIAkJcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7\nCiAgICAJfQogICAgCWlmIChleHBsaWNpdCkgewogICAgCQlpZiAoaXNNaXhl\nZCkgewogICAgCQkJYXNzZXJ0Tm9EdXBsaWNhdGUoZmllbGRzLCBnZXR0ZXJz\nKTsKICAgICAgICAgICAgICAgIG1ldGEuc2V0QWNjZXNzVHlwZShBY2Nlc3ND\nb2RlLk1JWEVEIHwgbWV0YS5nZXRBY2Nlc3NUeXBlKCkpOwogICAgCQkJbWVt\nYmVycy5hZGRBbGwoZmllbGRzKTsKICAgIAkJCW1lbWJlcnMuYWRkQWxsKGdl\ndHRlcnMpOwogICAgCQl9IGVsc2UgewogICAgCQkJbWVtYmVycy5hZGRBbGwo\nZmllbGRzLmlzRW1wdHkoKSA/IGdldHRlcnMgOiBmaWVsZHMpOwogICAgCQl9\nCiAgICAJfSBlbHNlIHsKICAgIAkJaWYgKGlzTWl4ZWQpCiAgICAgICAgICAg\nICAgICBlcnJvcihtZXRhLCBfbG9jLmdldCgiYWNjZXNzLW1peGVkIiwgbWV0\nYSwgZmllbGRzLCBnZXR0ZXJzKSk7CiAgICAJCWlmIChmaWVsZHMuaXNFbXB0\neSgpKSB7CiAgICAJCQltZXRhLnNldEFjY2Vzc1R5cGUoQWNjZXNzQ29kZS5Q\nUk9QRVJUWSk7CiAgICAJCQltZW1iZXJzLmFkZEFsbChnZXR0ZXJzKTsKICAg\nIAkJfSBlbHNlIHsKICAgIAkJCW1ldGEuc2V0QWNjZXNzVHlwZShBY2Nlc3ND\nb2RlLkZJRUxEKTsKICAgIAkJCW1lbWJlcnMuYWRkQWxsKGZpZWxkcyk7CiAg\nICAJCX0KICAgIAl9CiAgICAJcmV0dXJuIG1lbWJlcnM7CiAgICB9CiAgICAK\nICAgIHZvaWQgYXNzZXJ0Tm9EdXBsaWNhdGUoTGlzdDxGaWVsZD4gZmllbGRz\nLCBMaXN0PE1ldGhvZD4gZ2V0dGVycykgewogICAgCQogICAgfQogICAgCiAg\nICB2b2lkIGVycm9yKENsYXNzTWV0YURhdGEgbWV0YSwgTG9jYWxpemVyLk1l\nc3NhZ2UgbWVzc2FnZSkgewogICAgCUxvZyBsb2cgPSBtZXRhLmdldFJlcG9z\naXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkKICAgIAkJLmdldExvZyhPcGVu\nSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVOVElNRSk7CiAgICAJbG9nLmVycm9y\nKG1lc3NhZ2UudG9TdHJpbmcoKSk7CiAgICAJdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24obWVzc2FnZS50b1N0cmluZygpKTsKICAgIH0KICAgIAogICAgdm9p\nZCB3YXJuKENsYXNzTWV0YURhdGEgbWV0YSwgTG9jYWxpemVyLk1lc3NhZ2Ug\nbWVzc2FnZSkgewogICAgCUxvZyBsb2cgPSBtZXRhLmdldFJlcG9zaXRvcnko\nKS5nZXRDb25maWd1cmF0aW9uKCkKCQkuZ2V0TG9nKE9wZW5KUEFDb25maWd1\ncmF0aW9uLkxPR19SVU5USU1FKTsKICAgIAlsb2cud2FybihtZXNzYWdlLnRv\nU3RyaW5nKCkpOwogICAgfQogICAgCiAgICBAT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCBMaXN0PFN0cmluZz4gZ2V0RmllbGRBY2Nlc3NOYW1lcyhDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgIAlyZXR1cm4gdG9OYW1lcyhnZXRQZXJzaXN0\nZW50RmllbGRzKG1ldGEsIGZhbHNlKSk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgTGlzdDxTdHJpbmc+IGdldFByb3BlcnR5QWNjZXNz\nTmFtZXMoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAJcmV0dXJuIHRvTmFt\nZXMoZ2V0UGVyc2lzdGVudE1ldGhvZHMobWV0YSwgZmFsc2UpKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc0RlZmF1bHRQZXJzaXN0ZW50KENs\nYXNzTWV0YURhdGEgbWV0YSwgTWVtYmVyIG1lbWJlciwKICAgICAgICBTdHJp\nbmcgbmFtZSkgewogICAgICAgIHJldHVybiBpc0RlZmF1bHRQZXJzaXN0ZW50\nKG1ldGEsIG1lbWJlciwgbmFtZSwgZmFsc2UpOwogICAgfQogICAgCiAgICBw\ncm90ZWN0ZWQgYm9vbGVhbiBpc0RlZmF1bHRQZXJzaXN0ZW50KENsYXNzTWV0\nYURhdGEgbWV0YSwgTWVtYmVyIG1lbWJlciwKICAgICAgICBTdHJpbmcgbmFt\nZSwgYm9vbGVhbiBpZ25vcmVUcmFuc2llbnQpIHsKICAgICAgICBpbnQgbW9k\ncyA9IG1lbWJlci5nZXRNb2RpZmllcnMoKTsKICAgICAgICBpZiAoTW9kaWZp\nZXIuaXNUcmFuc2llbnQobW9kcykpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpbnQgYWNjZXNzID0gbWV0YS5nZXRBY2Nlc3NUeXBlKCk7\nICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAobWVtYmVyIGluc3RhbmNl\nb2YgRmllbGQpIHsKICAgICAgICAgICAgLy8gSWYgbWl4ZWQgb3IgdW5rbm93\nbiwgZGVmYXVsdCBwcm9wZXJ0eSBhY2Nlc3MsIGtlZXAgZXhwbGljaXQgCiAg\nICAgICAgICAgIC8vIGZpZWxkIG1lbWJlcnMKICAgICAgICAgICAgaWYgKEFj\nY2Vzc0NvZGUuaXNQcm9wZXJ0eShhY2Nlc3MpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoIWlzQW5ub3RhdGVkQWNjZXNzKG1lbWJlciwgQWNjZXNzVHlwZS5G\nSUVMRCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICB9CiAgICAgICAgfSAgICAgICAgCiAgICAgICAgZWxzZSBpZiAo\nbWVtYmVyIGluc3RhbmNlb2YgTWV0aG9kKSB7CiAgICAgICAgICAgIC8vIElm\nIG1peGVkIG9yIHVua25vd24sIGZpZWxkIGRlZmF1bHQgYWNjZXNzLCBrZWVw\nIGV4cGxpY2l0IHByb3BlcnR5CiAgICAgICAgICAgIC8vIG1lbWJlcnMKICAg\nICAgICAgICAgaWYgKEFjY2Vzc0NvZGUuaXNGaWVsZChhY2Nlc3MpKSB7CiAg\nICAgICAgICAgICAgICBpZiAoIWlzQW5ub3RhdGVkQWNjZXNzKG1lbWJlciwg\nQWNjZXNzVHlwZS5QUk9QRVJUWSkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBjaGVjayBmb3Igc2V0dGVy\ncyBmb3IgbWV0aG9kcwogICAgICAgICAgICAgICAgTWV0aG9kIHNldHRlciA9\nIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0\naG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKSwgInNldCIgKwogICAgICAgICAgICAgICAgICAgICAg\nICBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG5hbWUpLCBuZXcgQ2xhc3NbXSB7\nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKChNZXRob2QpIG1lbWJl\ncikuZ2V0UmV0dXJuVHlwZSgpIH0pKTsKICAgICAgICAgICAgICAgIGlmIChz\nZXR0ZXIgPT0gbnVsbCAmJiAhaXNBbm5vdGF0ZWRUcmFuc2llbnQobWVtYmVy\nKSkgewogICAgICAgICAgICAgICAgICAgIGxvZ05vU2V0dGVyKG1ldGEsIG5h\nbWUsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIGUuZy4sIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbgogICAgICAgICAgICAgICAgaWYgKCFpc0Fubm90YXRlZFRy\nYW5zaWVudChtZW1iZXIpKQogICAgICAgICAgICAgICAgICAgIGxvZ05vU2V0\ndGVyKG1ldGEsIG5hbWUsIGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBQZXJzaXN0\nZW5jZVN0cmF0ZWd5IHN0cmF0ID0gZ2V0UGVyc2lzdGVuY2VTdHJhdGVneShu\ndWxsLCBtZW1iZXIsIGlnbm9yZVRyYW5zaWVudCk7CiAgICAgICAgaWYgKHN0\ncmF0ID09IG51bGwgfHwgc3RyYXQgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5U\nUkFOU0lFTlQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKCX0KCiAgICBwcml2YXRlIGJvb2xlYW4gaXNBbm5vdGF0\nZWRUcmFuc2llbnQoTWVtYmVyIG1lbWJlcikgewogICAgICAgIHJldHVybiBt\nZW1iZXIgaW5zdGFuY2VvZiBBbm5vdGF0ZWRFbGVtZW50CiAgICAgICAgICAg\nICYmIChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rp\nb24oKChBbm5vdGF0ZWRFbGVtZW50KSBtZW1iZXIpLAogICAgICAgICAgICAg\nICAgICAgIFRyYW5zaWVudC5jbGFzcykpKS5ib29sZWFuVmFsdWUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1heSBiZSB1c2VkIHRvIGRldGVybWluZSBp\nZiBtZW1iZXIgaXMgYW5ub3RhdGVkIHdpdGggdGhlIHNwZWNpZmllZCAKICAg\nICAqIGFjY2VzcyB0eXBlLgogICAgICogQHBhcmFtIG1lbWJlciBjbGFzcyBt\nZW1iZXIKICAgICAqIEBwYXJhbSB0eXBlIGV4cGVjdGVkIGFjY2VzcyB0eXBl\nCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYWNjZXNzIGlzIHNwZWNpZmllZCBv\nbiBtZW1iZXIgYW5kIHRoYXQgYWNjZXNzCiAgICAgKiAgICAgICAgIHR5cGUg\nbWF0Y2hlcyB0aGUgZXhwZWN0ZWQgdHlwZQogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gaXNBbm5vdGF0ZWRBY2Nlc3MoTWVtYmVyIG1lbWJlciwgQWNj\nZXNzVHlwZSB0eXBlKSB7CiAgICAJaWYgKG1lbWJlciA9PSBudWxsKQogICAg\nCQlyZXR1cm4gZmFsc2U7CiAgICAgICAgQWNjZXNzIGFubm8gPSAKICAgICAg\nICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZI\nZWxwZXIKICAgICAgICAgICAgICAgIC5nZXRBbm5vdGF0aW9uQWN0aW9uKChB\nbm5vdGF0ZWRFbGVtZW50KW1lbWJlciwgCiAgICAgICAgICAgICAgICBBY2Nl\nc3MuY2xhc3MpKTsKICAgICAgICByZXR1cm4gYW5ubyAhPSBudWxsICYmIGFu\nbm8udmFsdWUoKSA9PSB0eXBlOwogICAgfSAgICAKCiAgICBwcml2YXRlIGJv\nb2xlYW4gaXNBbm5vdGF0ZWQoTWVtYmVyIG1lbWJlcikgewogICAgCXJldHVy\nbiBtZW1iZXIgIT0gbnVsbCAmJiBtZW1iZXIgaW5zdGFuY2VvZiBBbm5vdGF0\nZWRFbGVtZW50CiAgICAJICAgICYmIGFubm90YXRlZEZpbHRlci5pbmNsdWRl\ncygoQW5ub3RhdGVkRWxlbWVudCltZW1iZXIpOwogICAgfQoKICAgIHByaXZh\ndGUgYm9vbGVhbiBpc05vdFRyYW5zaWVudChNZW1iZXIgbWVtYmVyKSB7CiAg\nICAgICAgcmV0dXJuIG1lbWJlciAhPSBudWxsICYmIG1lbWJlciBpbnN0YW5j\nZW9mIEFubm90YXRlZEVsZW1lbnQKICAgICAgICAgICAgJiYgbm9uVHJhbnNp\nZW50RmlsdGVyLmluY2x1ZGVzKChBbm5vdGF0ZWRFbGVtZW50KW1lbWJlcik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIGVpdGhlciB0aGUgaW5zdGFu\nY2UgZmllbGQgb3IgdGhlIGdldHRlciBtZXRob2QgZGVwZW5kaW5nIHVwb24g\ndGhlIAogICAgICogYWNjZXNzIHN0eWxlIG9mIHRoZSBnaXZlbiBtZXRhLWRh\ndGEuCiAgICAgKi8KICAgIHB1YmxpYyBNZW1iZXIgZ2V0TWVtYmVyQnlQcm9w\nZXJ0eShDbGFzc01ldGFEYXRhIG1ldGEsIFN0cmluZyBwcm9wZXJ0eSwgCiAg\nICAJaW50IGFjY2VzcywgYm9vbGVhbiBhcHBseURlZmF1bHRSdWxlKSB7CiAg\nICAJQ2xhc3M8Pz4gY2xzID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7CiAg\nICAgICAgRmllbGQgZmllbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChjbHMs\nIHByb3BlcnR5LCBmYWxzZSk7OwogICAgICAgIE1ldGhvZCBnZXR0ZXIgPSBS\nZWZsZWN0aW9uLmZpbmRHZXR0ZXIoY2xzLCBwcm9wZXJ0eSwgZmFsc2UpOwog\nICAgICAgIE1ldGhvZCBzZXR0ZXIgPSBSZWZsZWN0aW9uLmZpbmRTZXR0ZXIo\nY2xzLCBwcm9wZXJ0eSwgZmFsc2UpOwogICAgICAgIGludCBhY2Nlc3NDb2Rl\nID0gQWNjZXNzQ29kZS5pc1Vua25vd24oYWNjZXNzKSA/IG1ldGEuZ2V0QWNj\nZXNzVHlwZSgpIDoKICAgICAgICAJYWNjZXNzOwogICAgICAgIGlmIChmaWVs\nZCA9PSBudWxsICYmIGdldHRlciA9PSBudWxsKQogICAgICAgIAllcnJvciht\nZXRhLCBfbG9jLmdldCgiYWNjZXNzLW5vLXByb3BlcnR5IiwgY2xzLCBwcm9w\nZXJ0eSkpOwogICAgCWlmICgoaXNOb3RUcmFuc2llbnQoZ2V0dGVyKSAmJiBp\nc0Fubm90YXRlZChnZXR0ZXIpKSAmJiAKICAgIAkgICAgIGlzTm90VHJhbnNp\nZW50KGZpZWxkKSAmJiBpc0Fubm90YXRlZChmaWVsZCkpCiAgICAJCXRocm93\nIG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImFjY2Vzcy1k\ndXBsaWNhdGUiLCAKICAgIAkJCWZpZWxkLCBnZXR0ZXIpLnRvU3RyaW5nKCkp\nOwogICAgCQogICAgICAgIGlmIChBY2Nlc3NDb2RlLmlzRmllbGQoYWNjZXNz\nQ29kZSkpIHsKICAgICAgICAgICBpZiAoaXNBbm5vdGF0ZWRBY2Nlc3MoZ2V0\ndGVyLCBBY2Nlc3NUeXBlLlBST1BFUlRZKSkgewogICAgICAgIAkgICBtZXRh\nLnNldEFjY2Vzc1R5cGUoQWNjZXNzQ29kZS5NSVhFRCB8IG1ldGEuZ2V0QWNj\nZXNzVHlwZSgpKTsKICAgICAgICAgICAgICAgcmV0dXJuIGdldHRlcjsKICAg\nICAgICAgICB9CiAgICAgICAgICAgcmV0dXJuIGZpZWxkID09IG51bGwgPyBn\nZXR0ZXIgOiBmaWVsZDsgCiAgICAgICAgfSBlbHNlIGlmIChBY2Nlc3NDb2Rl\nLmlzUHJvcGVydHkoYWNjZXNzQ29kZSkpIHsKICAgICAgICAgICAgaWYgKGlz\nQW5ub3RhdGVkQWNjZXNzKGZpZWxkLCBBY2Nlc3NUeXBlLkZJRUxEKSkgewog\nICAgICAgICAJICAgbWV0YS5zZXRBY2Nlc3NUeXBlKEFjY2Vzc0NvZGUuTUlY\nRUQgfCBtZXRhLmdldEFjY2Vzc1R5cGUoKSk7CiAgICAgICAgICAgICAgIHJl\ndHVybiBmaWVsZDsKICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAgICAg\nICAgICByZXR1cm4gZ2V0dGVyID09IG51bGwgPyBmaWVsZCA6IGdldHRlcjsK\nICAgICAgICB9IGVsc2UgaWYgKEFjY2Vzc0NvZGUuaXNVbmtub3duKGFjY2Vz\nc0NvZGUpKSB7CiAgICAgICAgCWlmIChpc0Fubm90YXRlZChmaWVsZCkpIHsK\nICAgICAgICAJCW1ldGEuc2V0QWNjZXNzVHlwZShBY2Nlc3NDb2RlLkZJRUxE\nKTsKICAgICAgICAJCXJldHVybiBmaWVsZDsKICAgICAgICAJfSBlbHNlIGlm\nIChpc0Fubm90YXRlZChnZXR0ZXIpKSB7CiAgICAgICAgCQltZXRhLnNldEFj\nY2Vzc1R5cGUoQWNjZXNzQ29kZS5QUk9QRVJUWSk7CiAgICAgICAgCQlyZXR1\ncm4gZ2V0dGVyOwogICAgICAgIAl9IGVsc2UgewogICAgICAgIAkJd2Fybiht\nZXRhLCBfbG9jLmdldCgiYWNjZXNzLW5vbmUiLCBtZXRhLCBwcm9wZXJ0eSkp\nOwogICAgICAgIAkJdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiYWNjZXNzLW5vbmUiLCBt\nZXRhLCBwcm9wZXJ0eSkudG9TdHJpbmcoKSk7CiAgICAgICAgCX0KICAgICAg\nICB9IGVsc2UgewogICAgICAgIAl0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24obWV0YSArICIgIiArIAogICAgICAgIAkJQWNjZXNzQ29kZS50b0NsYXNz\nU3RyaW5nKG1ldGEuZ2V0QWNjZXNzVHlwZSgpKSk7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAg\nIC8vICBTZWxlY3Rpb24gRmlsdGVycyBzZWxlY3Qgc3BlY2lmaWMgZWxlbWVu\ndHMgZnJvbSBhIGNvbGxlY3Rpb24uCiAgICAvLyAgVXNlZCB0byBkZXRlcm1p\nbmUgdGhlIHBlcnNpc3RlbnQgbWVtYmVycyBvZiBhIGdpdmVuIGNsYXNzLgog\nICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAKICAgIC8q\nKgogICAgICogSW5jbHVzaXZlIGVsZW1lbnQgZmlsdGVyaW5nIHByZWRpY2F0\nZS4KICAgICAqCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGludGVyZmFj\nZSBJbmNsdXNpdmVGaWx0ZXI8VCBleHRlbmRzIEFubm90YXRlZEVsZW1lbnQ+\nIHsKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdHJ1ZSB0byBpbmNs\ndWRlIHRoZSBnaXZlbiBlbGVtZW50LgogICAgICAgICAqLwogICAgICAgIGJv\nb2xlYW4gaW5jbHVkZXMoVCBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZp\nbHRlciB0aGUgZ2l2ZW4gY29sbGVjdGlvbiB3aXRoIHRoZSBjb25qdW5jdGlv\nbiBvZiBmaWx0ZXJzLiBUaGUgZ2l2ZW4KICAgICAqIGNvbGxlY3Rpb24gaXRz\nZWxmIGlzIG5vdCBtb2RpZmllZC4KICAgICAqLwogICAgPFQgZXh0ZW5kcyBB\nbm5vdGF0ZWRFbGVtZW50PiBMaXN0PFQ+IGZpbHRlcihUW10gYXJyYXksIAog\nICAgCUluY2x1c2l2ZUZpbHRlci4uLiBmaWx0ZXJzKSB7CiAgICAgICAgTGlz\ndDxUPiByZXN1bHQgPSBuZXcgQXJyYXlMaXN0PFQ+KCk7CiAgICAgICAgZm9y\nIChUIGUgOiBhcnJheSkgewogICAgICAgICAgICBib29sZWFuIGluY2x1ZGUg\nPSB0cnVlOwogICAgICAgICAgICBmb3IgKEluY2x1c2l2ZUZpbHRlciBmIDog\nZmlsdGVycykgewogICAgICAgICAgICAgICAgaWYgKGYgIT0gbnVsbCAmJiAh\nZi5pbmNsdWRlcyhlKSkgewogICAgICAgICAgICAgICAgICAgIGluY2x1ZGUg\nPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaW5jbHVk\nZSkKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQoZSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIDxUIGV4dGVu\nZHMgQW5ub3RhdGVkRWxlbWVudD4gTGlzdDxUPiBmaWx0ZXIoTGlzdDxUPiBs\naXN0LCAKICAgICAgICAJSW5jbHVzaXZlRmlsdGVyLi4uIGZpbHRlcnMpIHsK\nICAgICAgICBMaXN0PFQ+IHJlc3VsdCA9IG5ldyBBcnJheUxpc3Q8VD4oKTsK\nICAgICAgICBmb3IgKFQgZSA6IGxpc3QpIHsKICAgICAgICAgICAgYm9vbGVh\nbiBpbmNsdWRlID0gdHJ1ZTsKICAgICAgICAgICAgZm9yIChJbmNsdXNpdmVG\naWx0ZXIgZiA6IGZpbHRlcnMpIHsKICAgICAgICAgICAgICAgIGlmIChmICE9\nIG51bGwgJiYgIWYuaW5jbHVkZXMoZSkpIHsKICAgICAgICAgICAgICAgICAg\nICBpbmNsdWRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYgKGluY2x1ZGUpCiAgICAgICAgICAgICAgICByZXN1bHQuYWRkKGUpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8q\nKgogICAgICogU2VsZWN0cyBnZXR0ZXIgbWV0aG9kLiBBIGdldHRlciBtZXRo\nb2QgbmFtZSBzdGFydHMgd2l0aCAnZ2V0JywgcmV0dXJucyBhCiAgICAgKiBu\nb24tdm9pZCB0eXBlIGFuZCBoYXMgbm8gYXJndW1lbnQuIE9yIHN0YXJ0cyB3\naXRoICdpcycsIHJldHVybnMgYSBib29sZWFuCiAgICAgKiBhbmQgaGFzIG5v\nIGFyZ3VtZW50LgogICAgICogCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBH\nZXR0ZXJGaWx0ZXIgaW1wbGVtZW50cyBJbmNsdXNpdmVGaWx0ZXI8TWV0aG9k\nPiB7CiAgICAgICAgCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGluY2x1ZGVQ\ncml2YXRlOyAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaW5jbHVkZXMoTWV0aG9kIG1ldGhvZCkgewog\nICAgICAgICAgICByZXR1cm4gaXNHZXR0ZXIobWV0aG9kLCBpc0luY2x1ZGVQ\ncml2YXRlKCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc2V0\nSW5jbHVkZVByaXZhdGUoYm9vbGVhbiBpbmNsdWRlUHJpdmF0ZSkgewogICAg\nICAgICAgICB0aGlzLmluY2x1ZGVQcml2YXRlID0gaW5jbHVkZVByaXZhdGU7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0luY2x1ZGVQ\ncml2YXRlKCkgewogICAgICAgICAgICByZXR1cm4gaW5jbHVkZVByaXZhdGU7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0cyBzZXR0\nZXIgbWV0aG9kLiBBIHNldHRlciBtZXRob2QgbmFtZSBzdGFydHMgd2l0aCAn\nc2V0JywgcmV0dXJucyBhCiAgICAgKiB2b2lkIGFuZCBoYXMgc2luZ2xlIGFy\nZ3VtZW50LgogICAgICogCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBTZXR0\nZXJGaWx0ZXIgaW1wbGVtZW50cyBJbmNsdXNpdmVGaWx0ZXI8TWV0aG9kPiB7\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaW5jbHVkZXMoTWV0aG9kIG1ldGhv\nZCkgewogICAgICAgICAgICByZXR1cm4gaXNTZXR0ZXIobWV0aG9kKTsKICAg\nICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWZmaXJtcyBpZiB0aGUg\nZ2l2ZW4gbWV0aG9kIG1hdGNoZXMgdGhlIGZvbGxvd2luZyBzaWduYXR1cmUK\nICAgICAgICAgKiA8Y29kZT4gcHVibGljIHZvaWQgc2V0WFhYKFQgdCkgPC9j\nb2RlPgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVh\nbiBpc1NldHRlcihNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgCVN0cmluZyBt\nZXRob2ROYW1lID0gbWV0aG9kLmdldE5hbWUoKTsKICAgICAgICAJcmV0dXJu\nIHN0YXJ0c1dpdGgobWV0aG9kTmFtZSwgInNldCIpIAogICAgICAgIAkgICAg\nJiYgbWV0aG9kLmdldFBhcmFtZXRlclR5cGVzKCkubGVuZ3RoID09IDEKICAg\nICAgICAJICAgICYmIG1ldGhvZC5nZXRSZXR1cm5UeXBlKCkgPT0gdm9pZC5j\nbGFzczsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3Rz\nIGVsZW1lbnRzIHdoaWNoIGlzIGFubm90YXRlZCB3aXRoIEBBY2Nlc3MgYW5u\nb3RhdGlvbiBhbmQgdGhhdCAKICAgICAqIGFubm90YXRpb24gaGFzIHRoZSBn\naXZlbiBBY2Nlc3NUeXBlIHZhbHVlLgogICAgICogCiAgICAgKi8KICAgIHN0\nYXRpYyBjbGFzcyBBY2Nlc3NGaWx0ZXIgaW1wbGVtZW50cyBJbmNsdXNpdmVG\naWx0ZXI8QW5ub3RhdGVkRWxlbWVudD4gewogICAgICAgIGZpbmFsIEFjY2Vz\nc1R5cGUgdGFyZ2V0OwoKICAgICAgICBwdWJsaWMgQWNjZXNzRmlsdGVyKEFj\nY2Vzc1R5cGUgdGFyZ2V0KSB7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0g\ndGFyZ2V0OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaW5j\nbHVkZXMoQW5ub3RhdGVkRWxlbWVudCBvYmopIHsKICAgICAgICAJQWNjZXNz\nIGFjY2VzcyA9IG9iai5nZXRBbm5vdGF0aW9uKEFjY2Vzcy5jbGFzcyk7CiAg\nICAgICAgCXJldHVybiBhY2Nlc3MgIT0gbnVsbCAmJiBhY2Nlc3MudmFsdWUo\nKS5lcXVhbHModGFyZ2V0KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogU2VsZWN0cyBlbGVtZW50cyB3aGljaCBpcyBhbm5vdGF0ZWQg\nd2l0aCBAQWNjZXNzIGFubm90YXRpb24gYW5kIHRoYXQgCiAgICAgKiBhbm5v\ndGF0aW9uIGhhcyB0aGUgZ2l2ZW4gQWNjZXNzVHlwZSB2YWx1ZS4KICAgICAq\nIAogICAgICovCiAgICBzdGF0aWMgY2xhc3MgTWVtYmVyRmlsdGVyIGltcGxl\nbWVudHMgSW5jbHVzaXZlRmlsdGVyPEFubm90YXRlZEVsZW1lbnQ+IHsKICAg\nICAgICBmaW5hbCBDbGFzczw/PiB0YXJnZXQ7CgogICAgICAgIHB1YmxpYyBN\nZW1iZXJGaWx0ZXIoQ2xhc3M8Pz4gdGFyZ2V0KSB7CiAgICAgICAgICAgIHRo\naXMudGFyZ2V0ID0gdGFyZ2V0OwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaW5jbHVkZXMoQW5ub3RhdGVkRWxlbWVudCBvYmopIHsKICAg\nICAgICAJaW50IG1vZHMgPSAoKE1lbWJlcilvYmopLmdldE1vZGlmaWVycygp\nOwogICAgICAgIAkKICAgICAgICAgICAgcmV0dXJuIG9iai5nZXRDbGFzcygp\nID09IHRhcmdldCAmJiAKICAgICAgICAgICAgICAgICAhKE1vZGlmaWVyLmlz\nU3RhdGljKG1vZHMpIHx8IE1vZGlmaWVyLmlzRmluYWwobW9kcykgCiAgICAg\nICAgICAgICAgICB8fCBNb2RpZmllci5pc1RyYW5zaWVudChtb2RzKSB8fCBN\nb2RpZmllci5pc05hdGl2ZShtb2RzKSk7CiAgICAgICAgICAgICAgICAgIAog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdHMgYWxsIG5v\nbi10cmFuc2llbnQgZWxlbWVudC4KICAgICAqLwogICAgc3RhdGljIGNsYXNz\nIFRyYW5zaWVudEZpbHRlciBpbXBsZW1lbnRzIEluY2x1c2l2ZUZpbHRlcjxB\nbm5vdGF0ZWRFbGVtZW50PiB7CiAgICAgICAgcHVibGljIGJvb2xlYW4gaW5j\nbHVkZXMoQW5ub3RhdGVkRWxlbWVudCBvYmopIHsKICAgICAgICAJcmV0dXJu\nICFvYmouaXNBbm5vdGF0aW9uUHJlc2VudChUcmFuc2llbnQuY2xhc3MpICYm\nIAogICAgICAgIAkgICAgICAgIU1vZGlmaWVyLmlzVHJhbnNpZW50KCgoTWVt\nYmVyKW9iaikuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBTZWxlY3RzIGFsbCBlbGVtZW50IGFubm90YXRl\nZCB3aXRoIDxjb2RlPmphdmF4LnBlcnNpc3RlbmNlLio8L2NvZGU+IG9yIAog\nICAgICogPGNvZGU+b3JnLmFwYWNoZS5vcGVuanBhLio8L2NvZGU+IGFubm90\nYXRpb24gZXhjZXB0IHRoZSBhbm5vdGF0aW9ucwogICAgICogbWFya2VkIHRv\nIGJlIGlnbm9yZWQuCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBBbm5vdGF0\nZWRGaWx0ZXIgaW1wbGVtZW50cyBJbmNsdXNpdmVGaWx0ZXI8QW5ub3RhdGVk\nRWxlbWVudD4gewogICAgICAgIHB1YmxpYyBib29sZWFuIGluY2x1ZGVzKEFu\nbm90YXRlZEVsZW1lbnQgb2JqKSB7CiAgICAgICAgICAgIEFubm90YXRpb25b\nXSBhbm5vcyA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Q\ncml2SGVscGVyCiAgICAgICAgICAgICAgICAgICAgLmdldEFubm90YXRpb25z\nQWN0aW9uKG9iaikpOwogICAgICAgIAlmb3IgKEFubm90YXRpb24gYW5ubyA6\nIGFubm9zKSB7CiAgICAgICAgCQlTdHJpbmcgbmFtZSA9IGFubm8uYW5ub3Rh\ndGlvblR5cGUoKS5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICBpZiAoKG5h\nbWUuc3RhcnRzV2l0aCgiamF2YXgucGVyc2lzdGVuY2UuIikKICAgICAgICAg\nICAgICAgICAgfHwgbmFtZS5zdGFydHNXaXRoKCJvcmcuYXBhY2hlLm9wZW5q\ncGEucGVyc2lzdGVuY2UuIikpCiAgICAgICAgICAgICAgICAgICYmICFfaWdu\nb3JlZEFubm9zLmNvbnRhaW5zKG5hbWUpKQogICAgICAgICAgICAgICAgCXJl\ndHVybiB0cnVlOwogICAgICAgIAl9CiAgICAgICAgCXJldHVybiBmYWxzZTsK\nICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBsb2dOb1Nl\ndHRlcihDbGFzc01ldGFEYXRhIG1ldGEsIFN0cmluZyBuYW1lLCBFeGNlcHRp\nb24gZSkgewogICAgICAgIExvZyBsb2cgPSBtZXRhLmdldFJlcG9zaXRvcnko\nKS5nZXRDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLmdldExvZyhPcGVu\nSlBBQ29uZmlndXJhdGlvbi5MT0dfTUVUQURBVEEpOwogICAgICAgIGlmIChs\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cud2FybihfbG9j\nLmdldCgibm8tc2V0dGVyLWZvci1nZXR0ZXIiLCBuYW1lLAogICAgICAgICAg\nICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgZWxzZSBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgIC8vIGxvZyB0aGUgZXhjZXB0aW9uLCBpZiBhbnksIGlmIHdlJ3JlIGlu\nIHRyYWNlLWxldmVsIGRlYnVnZ2luZwogICAgICAgICAgICBsb2cud2Fybihf\nbG9jLmdldCgibm8tc2V0dGVyLWZvci1nZXR0ZXIiLCBuYW1lLAogICAgICAg\nICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKSwg\nZSk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgTG9nIGdldExvZyhDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gbWV0YS5nZXRSZXBvc2l0\nb3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5nZXRMb2co\nT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX01FVEFEQVRBKTsKICAgIH0KICAg\nIAogICAgU3RyaW5nIHRvRmllbGROYW1lcyhMaXN0PEZpZWxkPiBmaWVsZHMp\nIHsKICAgIAlyZXR1cm4gZmllbGRzLnRvU3RyaW5nKCk7CiAgICB9CiAgICAK\nICAgIFN0cmluZyB0b01ldGhvZE5hbWVzKExpc3Q8TWV0aG9kPiBtZXRob2Rz\nKSB7CiAgICAJcmV0dXJuIG1ldGhvZHMudG9TdHJpbmcoKTsKICAgIH0KICAg\nIAogICAgcHVibGljIGJvb2xlYW4gaXNBYnN0cmFjdE1hcHBpbmdVbmlEaXJl\nY3Rpb25hbChPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\naWYgKF9pc0Fic3RyYWN0TWFwcGluZ1VuaURpcmVjdGlvbmFsID09IG51bGwp\nCiAgICAgICAgICAgIHNldEFic3RyYWN0TWFwcGluZ1VuaURpcmVjdGlvbmFs\nKGNvbmYpOwogICAgICAgIHJldHVybiBfaXNBYnN0cmFjdE1hcHBpbmdVbmlE\naXJlY3Rpb25hbDsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0QWJz\ndHJhY3RNYXBwaW5nVW5pRGlyZWN0aW9uYWwoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZikgewogICAgICAgIF9pc0Fic3RyYWN0TWFwcGluZ1VuaURpcmVj\ndGlvbmFsID0gY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5pc0Fi\nc3RyYWN0TWFwcGluZ1VuaURpcmVjdGlvbmFsKCk7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBib29sZWFuIGlzTm9uRGVmYXVsdE1hcHBpbmdBbGxvd2VkKE9w\nZW5KUEFDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICBpZiAoX2lzTm9u\nRGVmYXVsdE1hcHBpbmdBbGxvd2VkID09IG51bGwpCiAgICAgICAgICAgIHNl\ndE5vbkRlZmF1bHRNYXBwaW5nQWxsb3dlZChjb25mKTsKICAgICAgICByZXR1\ncm4gX2lzTm9uRGVmYXVsdE1hcHBpbmdBbGxvd2VkOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldE5vbkRlZmF1bHRNYXBwaW5nQWxsb3dlZChPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2lzTm9uRGVmYXVsdE1h\ncHBpbmdBbGxvd2VkID0gY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2Uo\nKS4KICAgICAgICAgICAgaXNOb25EZWZhdWx0TWFwcGluZ0FsbG93ZWQoKTsK\nICAgIH0KfQo=\n","encoding":"base64"}

