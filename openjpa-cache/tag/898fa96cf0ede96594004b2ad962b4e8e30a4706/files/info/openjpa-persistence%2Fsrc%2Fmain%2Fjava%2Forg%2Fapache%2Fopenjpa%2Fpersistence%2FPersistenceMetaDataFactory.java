{"sha":"e39bdd6d2a03ea2ee8c678d14e6e911dd3bb3b6f","node_id":"MDQ6QmxvYjIwNjM2NDplMzliZGQ2ZDJhMDNlYTJlZThjNjc4ZDE0ZTZlOTExZGQzYmIzYjZm","size":20478,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e39bdd6d2a03ea2ee8c678d14e6e911dd3bb3b6f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubmV0LlVSTDsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNj\nZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuU3RhY2s7CgppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW1iZWRkYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudGl0\neTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xhc3M7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJpZXM7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5Owpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyaWVzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyeTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlNxbFJlc3VsdFNldE1hcHBpbmc7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5TcWxSZXN1bHRTZXRNYXBwaW5nczsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLm1ldGFtb2RlbC5TdGF0aWNNZXRhbW9kZWw7CgppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkdlbmVy\naWNDb25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLm1ldGEuQ2xhc3NBbm5vdGF0aW9uTWV0YURhdGFGaWx0ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xhc3NBcmdQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuTWV0YURhdGFGaWx0\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuTWV0YURh\ndGFQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLk11bHRpQ2xhc3NMb2FkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkFic3RyYWN0Q0ZNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhRGVmYXVsdHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkdlbmVyYWxF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRh\nRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiB7QGxpbmsgTWV0YURhdGFGYWN0b3J5\nfSBmb3IgSlBBIG1ldGFkYXRhLgogKgogKiBAYXV0aG9yIFN0ZXZlIEtpbQog\nKiBAc2luY2UgMC40LjAKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNz\nIFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5CiAgICBleHRlbmRzIEFic3Ry\nYWN0Q0ZNZXRhRGF0YUZhY3RvcnkKICAgIGltcGxlbWVudHMgQ29uZmlndXJh\nYmxlLCBHZW5lcmljQ29uZmlndXJhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdl\nCiAgICAgICAgKFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5LmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFBlcnNpc3RlbmNlTWV0YURhdGFEZWZhdWx0\ncyBfZGVmID0gCiAgICAgICAgbmV3IFBlcnNpc3RlbmNlTWV0YURhdGFEZWZh\ndWx0cygpOwogICAgcHJpdmF0ZSBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRh\nRGF0YVBhcnNlciBfYW5ub1BhcnNlciA9IG51bGw7CiAgICBwcml2YXRlIEFu\nbm90YXRpb25QZXJzaXN0ZW5jZVhNTE1ldGFEYXRhUGFyc2VyIF9hbm5vWE1M\nUGFyc2VyID0gbnVsbDsKICAgIHByaXZhdGUgWE1MUGVyc2lzdGVuY2VNZXRh\nRGF0YVBhcnNlciBfeG1sUGFyc2VyID0gbnVsbDsKICAgIHByaXZhdGUgTWFw\nPFVSTCwgU2V0PFN0cmluZz4+IF94bWwgPSBudWxsOyAvLyB4bWwgcnNyYyAt\nPiBjbGFzcyBuYW1lcwogICAgcHJpdmF0ZSBTZXQ8VVJMPiBfdW5wYXJzZWQg\nPSBudWxsOyAvLyB4bWwgcnNyYwogICAgcHJpdmF0ZSBib29sZWFuIF9maWVs\nZE92ZXJyaWRlID0gdHJ1ZTsKCiAgICBwcm90ZWN0ZWQgU3RhY2s8WE1MUGVy\nc2lzdGVuY2VNZXRhRGF0YVBhcnNlcj4gX3N0YWNrID0gCiAgICAgICAgbmV3\nIFN0YWNrPFhNTFBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXI+KCk7CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBmaWVsZC1sZXZlbCBvdmVycmlk\nZSBvciBjbGFzcy1sZXZlbCBvdmVycmlkZS4KICAgICAqIERlZmF1bHRzIHRv\nIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEZpZWxkT3ZlcnJp\nZGUoYm9vbGVhbiBmaWVsZCkgewogICAgICAgIF9maWVsZE92ZXJyaWRlID0g\nZmllbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBm\naWVsZC1sZXZlbCBvdmVycmlkZSBvciBjbGFzcy1sZXZlbCBvdmVycmlkZS4K\nICAgICAqIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGdldEZpZWxkT3ZlcnJpZGUoKSB7CiAgICAgICAgcmV0dXJuIF9m\naWVsZE92ZXJyaWRlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIG1l\ndGFkYXRhIHBhcnNlciwgY3JlYXRpbmcgaXQgaWYgaXQgZG9lcyBub3QgYWxy\nZWFkeSBleGlzdC4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25QZXJz\naXN0ZW5jZU1ldGFEYXRhUGFyc2VyIGdldEFubm90YXRpb25QYXJzZXIoKSB7\nCiAgICAgICAgaWYgKF9hbm5vUGFyc2VyID09IG51bGwpIHsKICAgICAgICAg\nICAgX2Fubm9QYXJzZXIgPSBuZXdBbm5vdGF0aW9uUGFyc2VyKCk7CiAgICAg\nICAgICAgIF9hbm5vUGFyc2VyLnNldFJlcG9zaXRvcnkocmVwb3MpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2Fubm9QYXJzZXI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIG1ldGFkYXRhIHBhcnNlci4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QW5ub3RhdGlvblBhcnNlcigKICAgICAgICBB\nbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlciBwYXJzZXIpIHsK\nICAgICAgICBpZiAoX2Fubm9QYXJzZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nX2Fubm9QYXJzZXIuc2V0UmVwb3NpdG9yeShudWxsKTsKICAgICAgICBpZiAo\ncGFyc2VyICE9IG51bGwpCiAgICAgICAgICAgIHBhcnNlci5zZXRSZXBvc2l0\nb3J5KHJlcG9zKTsKICAgICAgICBfYW5ub1BhcnNlciA9IHBhcnNlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSBwYXJz\nZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBBbm5vdGF0aW9uUGVyc2lzdGVu\nY2VNZXRhRGF0YVBhcnNlciBuZXdBbm5vdGF0aW9uUGFyc2VyKCkgewogICAg\nICAgIHJldHVybiBuZXcgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQ\nYXJzZXIKICAgICAgICAgICAgKHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgYW5ub3RhdGlv\nbiBzZXJpYWxpemVyLgogICAgICovCiAgICBwcm90ZWN0ZWQgQW5ub3RhdGlv\nblBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyCiAgICAgICAgbmV3QW5u\nb3RhdGlvblNlcmlhbGl6ZXIoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBbm5v\ndGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVNlcmlhbGl6ZXIKICAgICAgICAg\nICAgKHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gWE1MIG1ldGFkYXRhIHBhcnNlciwgY3JlYXRpbmcg\naXQgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdCBvcgogICAgICogaWYg\ndGhlIGV4aXN0aW5nIHBhcnNlciBpcyBwYXJzaW5nLgogICAgICovCiAgICBw\ndWJsaWMgWE1MUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlciBnZXRYTUxQYXJz\nZXIoKSB7CiAgICAgICAgaWYgKF94bWxQYXJzZXIgPT0gbnVsbCB8fCBfeG1s\nUGFyc2VyLmlzUGFyc2luZygpKSB7CiAgICAgICAgICAgIENsYXNzPD8+IHBh\ncnNlQ2xzID0gbnVsbDsKICAgICAgICAgICAgQXJyYXlMaXN0PENsYXNzPD8+\nPiBwYXJzZUxpc3QgPSBudWxsOwogICAgICAgICAgICAvLyBJZiB0aGVyZSBp\ncyBhbiBleGlzdGluZyBwYXJzZXIgYW5kIGl0IGlzIHBhcnNpbmcsIHB1c2gg\naXQgb24KICAgICAgICAgICAgLy8gdGhlIHN0YWNrIGFuZCByZXR1cm4gYSBu\nZXcgb25lLgogICAgICAgICAgICBpZiAoX3htbFBhcnNlciAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBfc3RhY2sucHVzaChfeG1sUGFyc2VyKTsKICAg\nICAgICAgICAgICAgIHBhcnNlQ2xzID0gX3htbFBhcnNlci5nZXRQYXJzZUNs\nYXNzKCk7CiAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBfeG1sUGFyc2Vy\nLmdldFBhcnNlTGlzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF94\nbWxQYXJzZXIgPSBuZXdYTUxQYXJzZXIodHJ1ZSk7CiAgICAgICAgICAgIF94\nbWxQYXJzZXIuYWRkVG9QYXJzZUxpc3QocGFyc2VMaXN0KTsKICAgICAgICAg\nICAgX3htbFBhcnNlci5hZGRUb1BhcnNlTGlzdChwYXJzZUNscyk7CiAgICAg\nICAgICAgIF94bWxQYXJzZXIuc2V0UmVwb3NpdG9yeShyZXBvcyk7CiAgICAg\nICAgICAgIGlmIChfZmllbGRPdmVycmlkZSkKICAgICAgICAgICAgICAgIF94\nbWxQYXJzZXIuc2V0QW5ub3RhdGlvblBhcnNlcihnZXRBbm5vdGF0aW9uUGFy\nc2VyKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3htbFBhcnNlcjsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXNldFhNTFBhcnNlcigpIHsKICAg\nICAgICAvLyBJZiBhIHBhcnNlciB3YXMgcHVzaGVkIG9uIHRoZSBzdGFjayBk\ndWUgdG8gbXVsdGktbGV2ZWwgcGFyc2luZywgCiAgICAgICAgLy8gY2xlYXIg\ndGhlIGN1cnJlbnQgcGFyc2VyIGFuZCBwb3AgdGhlIGlubmVyIHBhcnNlciBv\nZmYgdGhlIHN0YWNrLgogICAgICAgIGlmICghX3N0YWNrLmlzRW1wdHkoKSkg\newogICAgICAgICAgICBfeG1sUGFyc2VyLmNsZWFyKCk7CiAgICAgICAgICAg\nIF94bWxQYXJzZXIgPSBfc3RhY2sucG9wKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBtZXRhZGF0YSBwYXJzZXIuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFhNTFBhcnNlcihYTUxQZXJzaXN0ZW5j\nZU1ldGFEYXRhUGFyc2VyIHBhcnNlcikgewogICAgICAgIGlmIChfeG1sUGFy\nc2VyICE9IG51bGwpCiAgICAgICAgICAgIF94bWxQYXJzZXIuc2V0UmVwb3Np\ndG9yeShudWxsKTsKICAgICAgICBpZiAocGFyc2VyICE9IG51bGwpCiAgICAg\nICAgICAgIHBhcnNlci5zZXRSZXBvc2l0b3J5KHJlcG9zKTsKICAgICAgICBf\neG1sUGFyc2VyID0gcGFyc2VyOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgbmV3IG1ldGFkYXRhIHBhcnNlci4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFhNTFBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIgbmV3WE1MUGFyc2Vy\nKGJvb2xlYW4gbG9hZGluZykgewogICAgICAgIHJldHVybiBuZXcgWE1MUGVy\nc2lzdGVuY2VNZXRhRGF0YVBhcnNlcihyZXBvcy5nZXRDb25maWd1cmF0aW9u\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNlcmlh\nbGl6ZXIKICAgICAqLwogICAgcHJvdGVjdGVkIFhNTFBlcnNpc3RlbmNlTWV0\nYURhdGFTZXJpYWxpemVyIG5ld1hNTFNlcmlhbGl6ZXIoKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBYTUxQZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplcihy\nZXBvcy5nZXRDb25maWd1cmF0aW9uKCkpOwogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCBsb2FkKENsYXNzPD8+IGNscywgaW50IG1vZGUsIENsYXNzTG9h\nZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9O\nRSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICghc3RyaWN0ICYm\nIChtb2RlICYgTU9ERV9NRVRBKSAhPSAwKQogICAgICAgICAgICBtb2RlIHw9\nIE1PREVfTUFQUElORzsKCiAgICAgICAgLy8gZ2V0dGluZyB0aGUgbGlzdCBv\nZiBwZXJzaXN0ZW50IHR5cGVzIHJ1bnMgY2FsbGJhY2tzIHRvCiAgICAgICAg\nLy8gbWFwUGVyc2lzdGVudFR5cGVOYW1lcyBpZiBpdCBoYXNuJ3QgYmVlbiBj\nYWxsZWQgYWxyZWFkeSwgd2hpY2gKICAgICAgICAvLyBjYWNoZXMgWE1MIHJl\nc291cmNlcwogICAgICAgIGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2Us\nIGVudkxvYWRlcik7CiAgICAgICAgVVJMIHhtbCA9IGZpbmRYTUwoY2xzKTsK\nCiAgICAgICAgLy8gd2UgaGF2ZSB0byBwYXJzZSBtZXRhZGF0YSB1cC1mcm9u\ndCB0byByZWdpc3RlciBwZXJzaXN0ZW5jZSB1bml0CiAgICAgICAgLy8gZGVm\nYXVsdHMgYW5kIHN5c3RlbSBjYWxsYmFja3MKICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGE7CiAgICAgICAgYm9vbGVhbiBwYXJzZWRYTUwgPSBmYWxzZTsK\nICAgICAgICBpZiAoX3VucGFyc2VkICE9IG51bGwgJiYgIV91bnBhcnNlZC5p\nc0VtcHR5KCkKICAgICAgICAgICAgJiYgKG1vZGUgJiBNT0RFX01FVEEpICE9\nIDApIHsKICAgICAgICAgICAgU2V0PFVSTD4gdW5wYXJzZWQgPSBuZXcgSGFz\naFNldDxVUkw+KF91bnBhcnNlZCk7CiAgICAgICAgICAgIGZvciAoVVJMIHVy\nbCA6IHVucGFyc2VkKSB7CiAgICAgICAgICAgICAgICBwYXJzZVhNTCh1cmws\nIGNscywgbW9kZSwgZW52TG9hZGVyKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwYXJzZWRYTUwgPSB1bnBhcnNlZC5jb250YWlucyh4bWwpOwogICAg\nICAgICAgICAgX3VucGFyc2VkLmNsZWFyKCk7CgogICAgICAgICAgICAvLyBY\nTUwgcHJvY2VzcyBjaGVjawogICAgICAgICAgICBtZXRhID0gcmVwb3MuZ2V0\nQ2FjaGVkTWV0YURhdGEoY2xzKTsKICAgICAgICAgICAgaWYgKG1ldGEgIT0g\nbnVsbCAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBtb2RlKSA9PSBtb2Rl\nKSB7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0cmF0ZWdpZXMobWV0YSk7\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIG1pZ2h0IGhhdmUgYmVlbiBsb29raW5nIGZvciBz\neXN0ZW0tbGV2ZWwgcXVlcnkKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gd2UgbWF5IHN0aWxsIG5l\nZWQgdG8gcGFyc2UgWE1MIGlmIHRoaXMgaXMgYSByZWRlcGxveSBvZiBhIGNs\nYXNzLCBvcgogICAgICAgIC8vIGlmIHdlJ3JlIGluIHN0cmljdCBxdWVyeS1v\nbmx5IG1vZGUKICAgICAgICBpZiAoIXBhcnNlZFhNTCAmJiB4bWwgIT0gbnVs\nbCkgewogICAgICAgICAgICBwYXJzZVhNTCh4bWwsIGNscywgbW9kZSwgZW52\nTG9hZGVyKTsKICAgICAgICAgICAgLy8gWE1MIHByb2Nlc3MgY2hlY2sKICAg\nICAgICAgICAgbWV0YSA9IHJlcG9zLmdldENhY2hlZE1ldGFEYXRhKGNscyk7\nCiAgICAgICAgICAgIGlmIChtZXRhICE9IG51bGwgJiYgKG1ldGEuZ2V0U291\ncmNlTW9kZSgpICYgbW9kZSkgPT0gbW9kZSkgewogICAgICAgICAgICAgICAg\ndmFsaWRhdGVTdHJhdGVnaWVzKG1ldGEpOwogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBBbm5vdGF0\naW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlciBwYXJzZXIgPSBnZXRBbm5v\ndGF0aW9uUGFyc2VyKCk7CiAgICAgICAgcGFyc2VyLnNldEVudkNsYXNzTG9h\nZGVyKGVudkxvYWRlcik7CiAgICAgICAgcGFyc2VyLnNldE1vZGUobW9kZSk7\nCiAgICAgICAgcGFyc2VyLnBhcnNlKGNscyk7CgogICAgICAgIG1ldGEgPSBy\nZXBvcy5nZXRDYWNoZWRNZXRhRGF0YShjbHMpOwogICAgICAgIGlmIChtZXRh\nICE9IG51bGwgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgbW9kZSkgPT0g\nbW9kZSkKICAgICAgICAgICAgdmFsaWRhdGVTdHJhdGVnaWVzKG1ldGEpOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgdGhlIGdpdmVuIFhNTCByZXNv\ndXJjZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlWE1MKFVSTCB4\nbWwsIENsYXNzPD8+IGNscywgaW50IG1vZGUsIAogICAgCUNsYXNzTG9hZGVy\nIGVudkxvYWRlcikgewogICAgICAgIC8vIHNwcmluZyBuZWVkcyB0byB1c2Ug\ndGhlIGVudkxvYWRlciBmaXJzdCBmb3IgYWxsIGNsYXNzIHJlc29sdXRpb24s\nCiAgICAgICAgLy8gYnV0IHdlIG11c3Qgc3RpbGwgZmFsbCBiYWNrIG9uIGFw\ncGxpY2F0aW9uIGxvYWRlcgogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9\nIHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0Q2xh\nc3NSZXNvbHZlckluc3RhbmNlKCkuZ2V0Q2xhc3NMb2FkZXIoY2xzLCBudWxs\nKTsKICAgICAgICBpZiAoZW52TG9hZGVyICE9IG51bGwgJiYgZW52TG9hZGVy\nICE9IGxvYWRlcikgewogICAgICAgICAgTXVsdGlDbGFzc0xvYWRlciBtdWx0\nID0gbmV3IE11bHRpQ2xhc3NMb2FkZXIoKTsKICAgICAgICAgIG11bHQuYWRk\nQ2xhc3NMb2FkZXIoZW52TG9hZGVyKTsKCiAgICAgICAgICAvLyBsb2FkZXIg\nZnJvbSByZXNvbHZlciBpcyB1c3VhbGx5IGEgbXVsdGkgbG9hZGVyIGl0c2Vs\nZgogICAgICAgICAgaWYgKGxvYWRlciBpbnN0YW5jZW9mIE11bHRpQ2xhc3NM\nb2FkZXIpCiAgICAgICAgICAgIG11bHQuYWRkQ2xhc3NMb2FkZXJzKChNdWx0\naUNsYXNzTG9hZGVyKWxvYWRlcik7CiAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgIG11bHQuYWRkQ2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAgICAgIGxv\nYWRlciA9IG11bHQ7CiAgICAgICAgfQogICAgCiAgICAgICAgWE1MUGVyc2lz\ndGVuY2VNZXRhRGF0YVBhcnNlciB4bWxQYXJzZXIgPSBnZXRYTUxQYXJzZXIo\nKTsKICAgICAgICB4bWxQYXJzZXIuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsK\nICAgICAgICB4bWxQYXJzZXIuc2V0RW52Q2xhc3NMb2FkZXIoZW52TG9hZGVy\nKTsKICAgICAgICB4bWxQYXJzZXIuc2V0TW9kZShtb2RlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICB4bWxQYXJzZXIucGFyc2UoeG1sKTsKICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oaW9lKTsKICAgICAgICB9CiAgICAg\nICAgZmluYWxseSB7CiAgICAgICAgICAgIHJlc2V0WE1MUGFyc2VyKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTG9jYXRlIHRoZSBYTUwg\ncmVzb3VyY2UgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBVUkwgZmluZFhNTChDbGFzczw/PiBjbHMpIHsKICAgICAgICBpZiAo\nX3htbCAhPSBudWxsICYmIGNscyAhPSBudWxsKQogICAgICAgICAgICBmb3Ig\nKE1hcC5FbnRyeTxVUkwsIFNldDxTdHJpbmc+PiBlbnRyeSA6IF94bWwuZW50\ncnlTZXQoKSkKICAgICAgICAgICAgICAgIGlmIChlbnRyeS5nZXRWYWx1ZSgp\nLmNvbnRhaW5zKGNscy5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBlbnRyeS5nZXRLZXkoKTsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG1hcFBl\ncnNpc3RlbnRUeXBlTmFtZXMoT2JqZWN0IHJzcmMsIFN0cmluZ1tdIG5hbWVz\nKSB7CiAgICAgICAgaWYgKHJzcmMudG9TdHJpbmcoKS5lbmRzV2l0aCgiLmNs\nYXNzIikpIHsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKAogICAgICAgICAgICAgICAg\nICAgIF9sb2MuZ2V0KCJtYXAtcGVyc2lzdGVudC10eXBlcy1za2lwcGluZy1j\nbGFzcyIsIHJzcmMpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0g\nZWxzZSBpZiAoIShyc3JjIGluc3RhbmNlb2YgVVJMKSkgewogICAgICAgICAg\nICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoCiAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoIm1hcC1w\nZXJzaXN0ZW50LXR5cGVzLXNraXBwaW5nLW5vbi11cmwiLCByc3JjKSk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KAogICAgICAgICAgICAgICAgIm1hcC1wZXJzaXN0ZW50LXR5cGUtbmFt\nZXMiLCByc3JjLCBBcnJheXMuYXNMaXN0KG5hbWVzKSkpOwogICAgICAgIAog\nICAgICAgIGlmIChfeG1sID09IG51bGwpCiAgICAgICAgICAgIF94bWwgPSBu\nZXcgSGFzaE1hcDxVUkwsIFNldDxTdHJpbmc+PigpOwogICAgICAgIF94bWwu\ncHV0KChVUkwpIHJzcmMsIG5ldyBIYXNoU2V0PFN0cmluZz4oQXJyYXlzLmFz\nTGlzdChuYW1lcykpKTsKICAgICAgICBpZiAoX3VucGFyc2VkID09IG51bGwp\nCiAgICAgICAgICAgIF91bnBhcnNlZCA9IG5ldyBIYXNoU2V0PFVSTD4oKTsK\nICAgICAgICBfdW5wYXJzZWQuYWRkKChVUkwpIHJzcmMpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIENsYXNzPD8+IGdldFF1ZXJ5U2NvcGUo\nU3RyaW5nIHF1ZXJ5TmFtZSwgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAg\nICAgaWYgKHF1ZXJ5TmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiBjbGFzc2VzID0g\ncmVwb3MubG9hZFBlcnNpc3RlbnRUeXBlcyhmYWxzZSwgbG9hZGVyKTsKICAg\nICAgICBmb3IgKENsYXNzPD8+IGNscyA6ICBjbGFzc2VzKSB7CiAgICAgICAg\nICAgIGlmICgoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1By\naXZIZWxwZXIKICAgICAgICAgICAgICAgIC5pc0Fubm90YXRpb25QcmVzZW50\nQWN0aW9uKGNscywgTmFtZWRRdWVyeS5jbGFzcykpKQogICAgICAgICAgICAg\nICAgLmJvb2xlYW5WYWx1ZSgpICYmIGhhc05hbWVkUXVlcnkKICAgICAgICAg\nICAgICAgIChxdWVyeU5hbWUsIChOYW1lZFF1ZXJ5KSBjbHMuZ2V0QW5ub3Rh\ndGlvbihOYW1lZFF1ZXJ5LmNsYXNzKSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gY2xzOwogICAgICAgICAgICBpZiAoKEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAuaXNB\nbm5vdGF0aW9uUHJlc2VudEFjdGlvbihjbHMsIE5hbWVkUXVlcmllcy5jbGFz\ncykpKQogICAgICAgICAgICAgICAgLmJvb2xlYW5WYWx1ZSgpICYmCiAgICAg\nICAgICAgICAgICBoYXNOYW1lZFF1ZXJ5KHF1ZXJ5TmFtZSwgKChOYW1lZFF1\nZXJpZXMpIGNscy4KICAgICAgICAgICAgICAgICAgICBnZXRBbm5vdGF0aW9u\nKE5hbWVkUXVlcmllcy5jbGFzcykpLnZhbHVlKCkpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGNsczsKICAgICAgICAgICAgaWYgKChBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAg\nICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oY2xzLCBOYW1lZE5hdGl2\nZVF1ZXJ5LmNsYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVl\nKCkgJiYKICAgICAgICAgICAgICAgIGhhc05hbWVkTmF0aXZlUXVlcnkocXVl\ncnlOYW1lLCAoTmFtZWROYXRpdmVRdWVyeSkgY2xzLgogICAgICAgICAgICAg\nICAgICAgIGdldEFubm90YXRpb24oTmFtZWROYXRpdmVRdWVyeS5jbGFzcykp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGNsczsKICAgICAgICAgICAgaWYg\nKChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncgogICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24o\nY2xzLCBOYW1lZE5hdGl2ZVF1ZXJpZXMuY2xhc3MpKSkKICAgICAgICAgICAg\nICAgIC5ib29sZWFuVmFsdWUoKSAmJgogICAgICAgICAgICAgICAgaGFzTmFt\nZWROYXRpdmVRdWVyeShxdWVyeU5hbWUsICgoTmFtZWROYXRpdmVRdWVyaWVz\nKSBjbHMuCiAgICAgICAgICAgICAgICAgICAgZ2V0QW5ub3RhdGlvbihOYW1l\nZE5hdGl2ZVF1ZXJpZXMuY2xhc3MpKS52YWx1ZSgpKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBjbHM7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxs\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENsYXNzPD8+IGdl\ndFJlc3VsdFNldE1hcHBpbmdTY29wZShTdHJpbmcgcnNNYXBwaW5nTmFtZSwK\nICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBpZiAocnNN\nYXBwaW5nTmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAKICAgICAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiBjbGFzc2Vz\nID0gcmVwb3MubG9hZFBlcnNpc3RlbnRUeXBlcyhmYWxzZSwgbG9hZGVyKTsK\nICAgICAgICBmb3IgKENsYXNzPD8+IGNscyA6IGNsYXNzZXMpIHsKCiAgICAg\nICAgICAgIGlmICgoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgIC5pc0Fubm90YXRpb25QcmVz\nZW50QWN0aW9uKGNscywgU3FsUmVzdWx0U2V0TWFwcGluZy5jbGFzcykpKQog\nICAgICAgICAgICAgICAgLmJvb2xlYW5WYWx1ZSgpICYmCiAgICAgICAgICAg\nICAgICBoYXNSU01hcHBpbmcocnNNYXBwaW5nTmFtZSwgKFNxbFJlc3VsdFNl\ndE1hcHBpbmcpIGNscy4KICAgICAgICAgICAgICAgIGdldEFubm90YXRpb24o\nU3FsUmVzdWx0U2V0TWFwcGluZy5jbGFzcykpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGNsczsKCiAgICAgICAgICAgIGlmICgoQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAg\nIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGNscywgU3FsUmVzdWx0U2V0\nTWFwcGluZ3MuY2xhc3MpKSkKICAgICAgICAgICAgICAgIC5ib29sZWFuVmFs\ndWUoKSAmJgogICAgICAgICAgICAgICAgaGFzUlNNYXBwaW5nKHJzTWFwcGlu\nZ05hbWUsICgoU3FsUmVzdWx0U2V0TWFwcGluZ3MpIGNscy4KICAgICAgICAg\nICAgICAgIGdldEFubm90YXRpb24oU3FsUmVzdWx0U2V0TWFwcGluZ3MuY2xh\nc3MpKS52YWx1ZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiBjbHM7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHByaXZh\ndGUgYm9vbGVhbiBoYXNOYW1lZFF1ZXJ5KFN0cmluZyBxdWVyeSwgTmFtZWRR\ndWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgZm9yIChOYW1lZFF1ZXJ5IHEg\nOiBxdWVyaWVzKSB7CiAgICAgICAgICAgIGlmIChxdWVyeS5lcXVhbHMocS5u\nYW1lKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRlIGJv\nb2xlYW4gaGFzUlNNYXBwaW5nKFN0cmluZyByc01hcHBpbmcsCiAgICAgICAg\nU3FsUmVzdWx0U2V0TWFwcGluZy4uLiBtYXBwaW5ncykgewogICAgICAgIGZv\nciAoU3FsUmVzdWx0U2V0TWFwcGluZyBtIDogbWFwcGluZ3MpIHsKICAgICAg\nICAgICAgaWYgKHJzTWFwcGluZy5lcXVhbHMobS5uYW1lKCkpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gaGFzTmFtZWRO\nYXRpdmVRdWVyeShTdHJpbmcgcXVlcnksCiAgICAgICAgTmFtZWROYXRpdmVR\ndWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgZm9yIChOYW1lZE5hdGl2ZVF1\nZXJ5IHEgOiBxdWVyaWVzKSB7CiAgICAgICAgICAgIGlmIChxdWVyeS5lcXVh\nbHMocS5uYW1lKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHByb3RlY3RlZCBNZXRhRGF0YUZpbHRlciBuZXdNZXRhRGF0\nYUZpbHRlcigpIHsKICAgICAgICBDbGFzc0Fubm90YXRpb25NZXRhRGF0YUZp\nbHRlciBjYW1kZiA9IG5ldyBDbGFzc0Fubm90YXRpb25NZXRhRGF0YUZpbHRl\ncigKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgRW50aXR5LmNsYXNz\nLCBFbWJlZGRhYmxlLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBN\nYXBwZWRTdXBlcmNsYXNzLmNsYXNzIH0pOwogICAgICAgIGNhbWRmLnNldExv\nZyhsb2cpOwogICAgICAgIHJldHVybiBjYW1kZjsKICAgIH0KCiAgICAvKioK\nICAgICAqIEVuc3VyZSBhbGwgZmllbGRzIGhhdmUgZGVjbGFyZWQgYSBzdHJh\ndGVneS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlU3RyYXRl\nZ2llcyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBTdHJpbmdCdWls\nZGVyIGJ1ZiA9IG51bGw7CiAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZt\nZCA6IG1ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKSkgewogICAgICAgICAgICBp\nZiAoIWZtZC5pc0V4cGxpY2l0KCkpIHsKICAgICAgICAgICAgICAgIGlmIChi\ndWYgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBidWYgPSBuZXcgU3Ry\naW5nQnVpbGRlcigpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKGZtZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgaWYgKGJ1ZiAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXBlcnMtc3RyYXQiLCBidWYp\nKTsKICAgIH0KCiAgICBwdWJsaWMgTWV0YURhdGFEZWZhdWx0cyBnZXREZWZh\ndWx0cygpIHsKICAgICAgICByZXR1cm4gX2RlZjsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyBDbGFzc0FyZ1BhcnNlciBuZXdDbGFzc0FyZ1Bh\ncnNlcigpIHsKICAgICAgICBDbGFzc0FyZ1BhcnNlciBwYXJzZXIgPSBuZXcg\nQ2xhc3NBcmdQYXJzZXIoKTsKICAgICAgICBwYXJzZXIuc2V0TWV0YURhdGFT\ndHJ1Y3R1cmUoInBhY2thZ2UiLCBudWxsLCBuZXcgU3RyaW5nW117CiAgICAg\nICAgICAgICJlbnRpdHkiLCAiZW1iZWRkYWJsZSIsICJtYXBwZWQtc3VwZXJj\nbGFzcyIgfSwgImNsYXNzIik7CiAgICAgICAgcmV0dXJuIHBhcnNlcjsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewog\nICAgICAgIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgaWYgKF9hbm5vUGFyc2Vy\nICE9IG51bGwpCiAgICAgICAgICAgIF9hbm5vUGFyc2VyLmNsZWFyKCk7CiAg\nICAgICAgaWYgKF94bWxQYXJzZXIgIT0gbnVsbCkKICAgICAgICAgICAgX3ht\nbFBhcnNlci5jbGVhcigpOwogICAgICAgIGlmIChfeG1sICE9IG51bGwpCiAg\nICAgICAgICAgIF94bWwuY2xlYXIoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nUGFyc2VyIG5ld1BhcnNlcihib29sZWFuIGxvYWRpbmcpIHsKICAgICAgICBy\nZXR1cm4gbmV3WE1MUGFyc2VyKGxvYWRpbmcpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBTZXJpYWxpemVyIG5ld1NlcmlhbGl6ZXIoKSB7CiAgICAgICAgcmV0\ndXJuIG5ld1hNTFNlcmlhbGl6ZXIoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlKE1ldGFEYXRhUGFyc2VyIHBhcnNl\nciwgQ2xhc3NbXSBjbHMpIHsKICAgICAgICBwYXJzZShwYXJzZXIsIENvbGxl\nY3Rpb25zLnNpbmdsZXRvbihkZWZhdWx0WE1MRmlsZSgpKSk7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIEZpbGUgZGVmYXVsdFNvdXJjZUZpbGUoQ2xhc3NNZXRh\nRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRYTUxGaWxlKCk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIEZpbGUgZGVmYXVsdFNvdXJjZUZpbGUo\nUXVlcnlNZXRhRGF0YSBxdWVyeSwgTWFwIGNsc05hbWVzKSB7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0RGVmaW5pbmdNZXRhRGF0YShxdWVy\neSwgY2xzTmFtZXMpOwogICAgICAgIEZpbGUgZmlsZSA9IChtZXRhID09IG51\nbGwpID8gbnVsbCA6IG1ldGEuZ2V0U291cmNlRmlsZSgpOwogICAgICAgIGlm\nIChmaWxlICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmaWxlOwogICAg\nICAgIHJldHVybiBkZWZhdWx0WE1MRmlsZSgpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBGaWxlIGRlZmF1bHRTb3VyY2VGaWxlKFNlcXVlbmNlTWV0YURhdGEg\nc2VxLCBNYXAgY2xzTmFtZXMpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFhN\nTEZpbGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIExvb2sgZm9yIE1FVEEt\nSU5GL29ybS54bWwsIGFuZCBpZiBpdCBkb2Vzbid0IGV4aXN0LCBjaG9vc2Ug\nYSBkZWZhdWx0LgogICAgICovCiAgICBwcml2YXRlIEZpbGUgZGVmYXVsdFhN\nTEZpbGUoKSB7CiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gcmVwb3Mu\nZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRDbGFzc1Jlc29s\ndmVySW5zdGFuY2UoKS5nZXRDbGFzc0xvYWRlcihnZXRDbGFzcygpLCBudWxs\nKTsKICAgICAgICBVUkwgcnNyYyA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRSZXNvdXJj\nZUFjdGlvbihsb2FkZXIsICJNRVRBLUlORi9vcm0ueG1sIikpOwogICAgICAg\nIGlmIChyc3JjICE9IG51bGwpIHsKICAgICAgICAgICAgRmlsZSBmaWxlID0g\nbmV3IEZpbGUocnNyYy5nZXRGaWxlKCkpOwogICAgICAgICAgICBpZiAoKEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZXhpc3RzQWN0aW9uKGZpbGUpKSkuYm9vbGVhblZh\nbHVlKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG5ldyBGaWxlKCJvcm0ueG1sIik7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9u\nIGNvbmYpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3Vy\nYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJh\ndGlvbigpIHsKICAgICAgICBpZiAocnNyY3MgPT0gbnVsbCkKICAgICAgICAg\nICAgcnNyY3MgPSBDb2xsZWN0aW9ucy5zaW5nbGV0b24oIk1FVEEtSU5GL29y\nbS54bWwiKTsKICAgICAgICBlbHNlCgkJCXJzcmNzLmFkZCgiTUVUQS1JTkYv\nb3JtLnhtbCIpOwoJfQoKICAgIHB1YmxpYyB2b2lkIHNldEludG8oT3B0aW9u\ncyBvcHRzKSB7CiAgICAgICAgb3B0cy5rZXlTZXQoKS5yZXRhaW5BbGwob3B0\ncy5zZXRJbnRvKF9kZWYpLmtleVNldCgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBKQVhCIFhNTCBhbm5vdGF0aW9uIHBhcnNlciwgCiAgICAg\nKiBjcmVhdGluZyBpdCBpZiBpdCBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0Lgog\nICAgICovCiAgICBwdWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlWE1MTWV0\nYURhdGFQYXJzZXIgZ2V0WE1MQW5ub3RhdGlvblBhcnNlcigpIHsKICAgICAg\nICBpZiAoX2Fubm9YTUxQYXJzZXIgPT0gbnVsbCkgewogICAgICAgICAgICBf\nYW5ub1hNTFBhcnNlciA9IG5ld1hNTEFubm90YXRpb25QYXJzZXIoKTsKICAg\nICAgICAgICAgX2Fubm9YTUxQYXJzZXIuc2V0UmVwb3NpdG9yeShyZXBvcyk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfYW5ub1hNTFBhcnNlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgSkFYQiBYTUwgYW5ub3RhdGlv\nbiBwYXJzZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFhNTEFubm90\nYXRpb25QYXJzZXIoCiAgICAgICAgQW5ub3RhdGlvblBlcnNpc3RlbmNlWE1M\nTWV0YURhdGFQYXJzZXIgcGFyc2VyKSB7CiAgICAgICAgaWYgKF9hbm5vWE1M\nUGFyc2VyICE9IG51bGwpCiAgICAgICAgICAgIF9hbm5vWE1MUGFyc2VyLnNl\ndFJlcG9zaXRvcnkobnVsbCk7CiAgICAgICAgaWYgKHBhcnNlciAhPSBudWxs\nKQogICAgICAgICAgICBwYXJzZXIuc2V0UmVwb3NpdG9yeShyZXBvcyk7CiAg\nICAgICAgX2Fubm9YTUxQYXJzZXIgPSBwYXJzZXI7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgSkFYQiBYTUwgYW5ub3RhdGlvbiBwYXJz\nZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBBbm5vdGF0aW9uUGVyc2lzdGVu\nY2VYTUxNZXRhRGF0YVBhcnNlciBuZXdYTUxBbm5vdGF0aW9uUGFyc2VyKCkg\newogICAgICAgIHJldHVybiBuZXcgQW5ub3RhdGlvblBlcnNpc3RlbmNlWE1M\nTWV0YURhdGFQYXJzZXIKICAgICAgICAgICAgKHJlcG9zLmdldENvbmZpZ3Vy\nYXRpb24oKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZFhNTE1ldGFE\nYXRhKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQW5ub3RhdGlvblBl\ncnNpc3RlbmNlWE1MTWV0YURhdGFQYXJzZXIgcGFyc2VyCiAgICAgICAgICAg\nID0gZ2V0WE1MQW5ub3RhdGlvblBhcnNlcigpOwogICAgICAgIHBhcnNlci5w\nYXJzZShmbWQpOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBTdHJp\nbmcgVU5ERVJTQ09SRSA9ICJfIjsKICAgIAogICAgcHVibGljIFN0cmluZyBn\nZXRNYW5hZ2VkQ2xhc3NOYW1lKFN0cmluZyBtbUNsYXNzTmFtZSkgewogICAg\nICAgIGlmIChtbUNsYXNzTmFtZSA9PSBudWxsIHx8IG1tQ2xhc3NOYW1lLmxl\nbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGlmIChtbUNsYXNzTmFtZS5lbmRzV2l0aChVTkRFUlNDT1JFKSkKICAgICAg\nICAgICAgcmV0dXJuIG1tQ2xhc3NOYW1lLnN1YnN0cmluZygwLCBtbUNsYXNz\nTmFtZS5sZW5ndGgoKS0xKTsKICAgICAgICByZXR1cm4gbW1DbGFzc05hbWU7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRNZXRhTW9kZWxDbGFzc05h\nbWUoU3RyaW5nIG1hbmFnZWRDbGFzc05hbWUpIHsKICAgICAgICBpZiAobWFu\nYWdlZENsYXNzTmFtZSA9PSBudWxsIHx8IG1hbmFnZWRDbGFzc05hbWUubGVu\nZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\ncmV0dXJuIG1hbmFnZWRDbGFzc05hbWUgKyBVTkRFUlNDT1JFOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzTWV0YUNsYXNzKENsYXNzPD8+IGMpIHsK\nICAgICAgICByZXR1cm4gYyAhPSBudWxsICYmIGMuZ2V0QW5ub3RhdGlvbihT\ndGF0aWNNZXRhbW9kZWwuY2xhc3MpICE9IG51bGw7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBDbGFzczw/PiBnZXRNYW5hZ2VkQ2xhc3MoQ2xhc3M8Pz4gYykg\newogICAgICAgIGlmIChpc01ldGFDbGFzcyhjKSkgewogICAgICAgICAgICBy\nZXR1cm4gYy5nZXRBbm5vdGF0aW9uKFN0YXRpY01ldGFtb2RlbC5jbGFzcyku\ndmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCn0K\n","encoding":"base64"}

