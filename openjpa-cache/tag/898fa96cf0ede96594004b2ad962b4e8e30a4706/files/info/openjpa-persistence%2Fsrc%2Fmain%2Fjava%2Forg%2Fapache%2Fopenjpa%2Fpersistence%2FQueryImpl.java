{"sha":"840d9b7e950fa3f669e0e2167f8988ec133844b3","node_id":"MDQ6QmxvYjIwNjM2NDo4NDBkOWI3ZTk1MGZhM2Y2NjllMGUyMTY3Zjg5ODhlYzEzMzg0NGIz","size":37169,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/840d9b7e950fa3f669e0e2167f8988ec133844b3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5n\ndWFnZXMuTEFOR19QUkVQQVJFRF9TUUw7CgppbXBvcnQgamF2YS5pby5TZXJp\nYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5z\ncWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nbG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5GbHVzaE1vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTG9j\na01vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTm9SZXN1bHRF\neGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Ob25VbmlxdWVS\nZXN1bHRFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QYXJh\nbWV0ZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlRlbXBvcmFsVHlwZTsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlR5cGVkUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5jcml0ZXJpYS5QYXJhbWV0ZXJFeHByZXNzaW9uOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkJyb2tl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGlu\nZ1F1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5EZWxl\nZ2F0aW5nUmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GaWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5QcmVwYXJlZFF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5QcmVwYXJlZFF1ZXJ5Q2FjaGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5U3RhdGlzdGlj\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGlzdGluY3RS\nZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLkFnZ3JlZ2F0ZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5leHBzLkZpbHRlckxpc3RlbmVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5qcHFsLkpQUUxQYXJzZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5PcmRlcmVkTWFwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLmNyaXRlcmlhLkNyaXRlcmlh\nQnVpbGRlckltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUnVu\ndGltZUV4Y2VwdGlvblRyYW5zbGF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKCi8qKgogKiBJbXBsZW1lbnRh\ndGlvbiBvZiB7QGxpbmsgUXVlcnl9IGludGVyZmFjZS4KICogCiAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nIEBub2phdmFkb2MKICovCkBTdXBwcmVzc1dhcm5pbmdzKCJzZXJpYWwiKQpw\ndWJsaWMgY2xhc3MgUXVlcnlJbXBsPFg+IGltcGxlbWVudHMgT3BlbkpQQVF1\nZXJ5U1BJPFg+LCBTZXJpYWxpemFibGUgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2Uo\nUXVlcnlJbXBsLmNsYXNzKTsKCglwcml2YXRlIERlbGVnYXRpbmdRdWVyeSBf\ncXVlcnk7Cglwcml2YXRlIHRyYW5zaWVudCBFbnRpdHlNYW5hZ2VySW1wbCBf\nZW07Cglwcml2YXRlIHRyYW5zaWVudCBGZXRjaFBsYW4gX2ZldGNoOwoKICAg\nIHByaXZhdGUgTWFwPFBhcmFtZXRlcjw/PiwgT2JqZWN0PiBfYm91bmRQYXJh\nbXM7CiAgICBwcml2YXRlIE1hcDxPYmplY3QsIFBhcmFtZXRlcjw/Pj4gX2Rl\nY2xhcmVkUGFyYW1zOwoJcHJpdmF0ZSBTdHJpbmcgX2lkOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgUmVlbnRyYW50TG9jayBfbG9jayA9IG51bGw7Cglwcml2\nYXRlIEhpbnRIYW5kbGVyIF9oaW50SGFuZGxlcjsKCgkvKioKCSAqIENvbnN0\ncnVjdG9yOyBzdXBwbHkgZmFjdG9yeSBleGNlcHRpb24gdHJhbnNsYXRvciBh\nbmQgZGVsZWdhdGUuCgkgKiAKCSAqIEBwYXJhbSBlbSAgVGhlIEVudGl0eU1h\nbmFnZXIgd2hpY2ggY3JlYXRlZCB0aGlzIHF1ZXJ5CgkgKiBAcGFyYW0gcmV0\nIEV4Y2VwdGlvbiB0cmFuc2xhdG9yIGZvciB0aGlzIHF1ZXJ5CgkgKiBAcGFy\nYW0gcXVlcnkgVGhlIHVuZGVybHlpbmcgImtlcm5lbCIgcXVlcnkuCgkgKi8K\nCXB1YmxpYyBRdWVyeUltcGwoRW50aXR5TWFuYWdlckltcGwgZW0sIFJ1bnRp\nbWVFeGNlcHRpb25UcmFuc2xhdG9yIHJldCwKCQkJb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5RdWVyeSBxdWVyeSkgewoJCV9lbSA9IGVtOwoJCV9xdWVy\neSA9IG5ldyBEZWxlZ2F0aW5nUXVlcnkocXVlcnksIHJldCk7CgkJX2xvY2sg\nPSBuZXcgUmVlbnRyYW50TG9jaygpOwoJfQoKCS8qKgoJICogQ29uc3RydWN0\nb3I7IHN1cHBseSBmYWN0b3J5IGFuZCBkZWxlZ2F0ZS4KCSAqIAoJICogQGRl\ncHJlY2F0ZWQKCSAqLwoJcHVibGljIFF1ZXJ5SW1wbChFbnRpdHlNYW5hZ2Vy\nSW1wbCBlbSwKCSAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5R\ndWVyeSBxdWVyeSkgewoJCXRoaXMoZW0sIG51bGwsIHF1ZXJ5KTsKCX0KCgkv\nKioKCSAqIERlbGVnYXRlLgoJICovCglwdWJsaWMgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5RdWVyeSBnZXREZWxlZ2F0ZSgpIHsKCQlyZXR1cm4gX3F1\nZXJ5LmdldERlbGVnYXRlKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyIGdldEVudGl0eU1hbmFnZXIoKSB7CgkJcmV0dXJuIF9lbTsKCX0K\nCglwdWJsaWMgU3RyaW5nIGdldExhbmd1YWdlKCkgewoJCXJldHVybiBfcXVl\ncnkuZ2V0TGFuZ3VhZ2UoKTsKCX0KCglwdWJsaWMgUXVlcnlPcGVyYXRpb25U\neXBlIGdldE9wZXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gUXVlcnlPcGVy\nYXRpb25UeXBlLmZyb21LZXJuZWxDb25zdGFudChfcXVlcnkuZ2V0T3BlcmF0\naW9uKCkpOwoJfQoKCXB1YmxpYyBGZXRjaFBsYW4gZ2V0RmV0Y2hQbGFuKCkg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlfcXVlcnkuYXNz\nZXJ0Tm90U2VyaWFsaXplZCgpOwoJCV9xdWVyeS5sb2NrKCk7CgkJdHJ5IHsK\nCQkJaWYgKF9mZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZldGNo\nID0gKChFbnRpdHlNYW5hZ2VyRmFjdG9yeUltcGwpIF9lbQogICAgICAgICAg\nICAgICAgICAgICAgICAuZ2V0RW50aXR5TWFuYWdlckZhY3RvcnkoKSkudG9G\nZXRjaFBsYW4oX3F1ZXJ5CiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRC\ncm9rZXIoKSwgX3F1ZXJ5LmdldEZldGNoQ29uZmlndXJhdGlvbigpKTsKCQkJ\ncmV0dXJuIF9mZXRjaDsKCQl9IGZpbmFsbHkgewoJCQlfcXVlcnkudW5sb2Nr\nKCk7CgkJfQoJfQoKCXB1YmxpYyBTdHJpbmcgZ2V0UXVlcnlTdHJpbmcoKSB7\nCgkJcmV0dXJuIF9xdWVyeS5nZXRRdWVyeVN0cmluZygpOwoJfQoKCXB1Ymxp\nYyBib29sZWFuIGdldElnbm9yZUNoYW5nZXMoKSB7CgkJcmV0dXJuIF9xdWVy\neS5nZXRJZ25vcmVDaGFuZ2VzKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVy\neTxYPiBzZXRJZ25vcmVDaGFuZ2VzKGJvb2xlYW4gaWdub3JlKSB7CgkJX2Vt\nLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5zZXRJZ25vcmVD\naGFuZ2VzKGlnbm9yZSk7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJcHVibGljIE9w\nZW5KUEFRdWVyeTxYPiBhZGRGaWx0ZXJMaXN0ZW5lcihGaWx0ZXJMaXN0ZW5l\nciBsaXN0ZW5lcikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsK\nCQlfcXVlcnkuYWRkRmlsdGVyTGlzdGVuZXIobGlzdGVuZXIpOwoJCXJldHVy\nbiB0aGlzOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gcmVtb3ZlRmls\ndGVyTGlzdGVuZXIoRmlsdGVyTGlzdGVuZXIgbGlzdGVuZXIpIHsKCQlfZW0u\nYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LnJlbW92ZUZpbHRl\nckxpc3RlbmVyKGxpc3RlbmVyKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJs\naWMgT3BlbkpQQVF1ZXJ5PFg+IGFkZEFnZ3JlZ2F0ZUxpc3RlbmVyKEFnZ3Jl\nZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7CgkJX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwoJCV9xdWVyeS5hZGRBZ2dyZWdhdGVMaXN0ZW5lcihsaXN0\nZW5lcik7CgkJcmV0dXJuIHRoaXM7Cgl9CgogICAgcHVibGljIE9wZW5KUEFR\ndWVyeTxYPiByZW1vdmVBZ2dyZWdhdGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0\nZW5lciBsaXN0ZW5lcikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQo\nKTsKCQlfcXVlcnkucmVtb3ZlQWdncmVnYXRlTGlzdGVuZXIobGlzdGVuZXIp\nOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBDb2xsZWN0aW9uPD8+IGdl\ndENhbmRpZGF0ZUNvbGxlY3Rpb24oKSB7CgkJcmV0dXJuIF9xdWVyeS5nZXRD\nYW5kaWRhdGVDb2xsZWN0aW9uKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVy\neTxYPiBzZXRDYW5kaWRhdGVDb2xsZWN0aW9uKENvbGxlY3Rpb24gY29sbCkg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlfcXVlcnkuc2V0\nQ2FuZGlkYXRlQ29sbGVjdGlvbihjb2xsKTsKCQlyZXR1cm4gdGhpczsKCX0K\nCglwdWJsaWMgQ2xhc3MgZ2V0UmVzdWx0Q2xhc3MoKSB7CgkJQ2xhc3MgcmVz\nID0gX3F1ZXJ5LmdldFJlc3VsdFR5cGUoKTsKCQlpZiAocmVzICE9IG51bGwp\nCgkJCXJldHVybiByZXM7CgkJcmV0dXJuIF9xdWVyeS5nZXRDYW5kaWRhdGVU\neXBlKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRSZXN1bHRD\nbGFzcyhDbGFzcyBjbHMpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2Vk\nKCk7CgkJaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShfZW0uZ2V0Q29u\nZmlndXJhdGlvbigpLCBjbHMpKQoJCQlfcXVlcnkuc2V0Q2FuZGlkYXRlVHlw\nZShjbHMsIHRydWUpOwoJCWVsc2UKCQkJX3F1ZXJ5LnNldFJlc3VsdFR5cGUo\nY2xzKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgYm9vbGVhbiBoYXNT\ndWJjbGFzc2VzKCkgewoJCXJldHVybiBfcXVlcnkuaGFzU3ViY2xhc3Nlcygp\nOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0U3ViY2xhc3Nlcyhi\nb29sZWFuIHN1YnMpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7\nCgkJQ2xhc3M8Pz4gY2xzID0gX3F1ZXJ5LmdldENhbmRpZGF0ZVR5cGUoKTsK\nICAgICAgICBfcXVlcnkuc2V0Q2FuZGlkYXRlRXh0ZW50KF9xdWVyeS5nZXRC\ncm9rZXIoKS5uZXdFeHRlbnQoY2xzLCBzdWJzKSk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIGludCBnZXRGaXJzdFJlc3VsdCgpIHsKCQlyZXR1cm4g\nYXNJbnQoX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7Cgl9CgoJcHVibGljIE9w\nZW5KUEFRdWVyeTxYPiBzZXRGaXJzdFJlc3VsdChpbnQgc3RhcnRQb3NpdGlv\nbikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlsb25nIGVu\nZDsKCQlpZiAoX3F1ZXJ5LmdldEVuZFJhbmdlKCkgPT0gTG9uZy5NQVhfVkFM\nVUUpCgkJCWVuZCA9IExvbmcuTUFYX1ZBTFVFOwoJCWVsc2UKCQkJZW5kID0g\nc3RhcnRQb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICsgKF9xdWVyeS5n\nZXRFbmRSYW5nZSgpIC0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7CgkJX3F1\nZXJ5LnNldFJhbmdlKHN0YXJ0UG9zaXRpb24sIGVuZCk7CgkJcmV0dXJuIHRo\naXM7Cgl9CgoJcHVibGljIGludCBnZXRNYXhSZXN1bHRzKCkgewoJCXJldHVy\nbiBhc0ludChfcXVlcnkuZ2V0RW5kUmFuZ2UoKSAtIF9xdWVyeS5nZXRTdGFy\ndFJhbmdlKCkpOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0TWF4\nUmVzdWx0cyhpbnQgbWF4KSB7CgkJX2VtLmFzc2VydE5vdENsb3NlSW52b2tl\nZCgpOwoJCWxvbmcgc3RhcnQgPSBfcXVlcnkuZ2V0U3RhcnRSYW5nZSgpOwoJ\nCWlmIChtYXggPT0gSW50ZWdlci5NQVhfVkFMVUUpCgkJCV9xdWVyeS5zZXRS\nYW5nZShzdGFydCwgTG9uZy5NQVhfVkFMVUUpOwoJCWVsc2UKCQkJX3F1ZXJ5\nLnNldFJhbmdlKHN0YXJ0LCBzdGFydCArIG1heCk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIE9wZW5KUEFRdWVyeTxYPiBjb21waWxlKCkgewoJCV9l\nbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlfcXVlcnkuY29tcGlsZSgp\nOwoJCXJldHVybiB0aGlzOwoJfQoJCgkvKioKCSAqIEdldHMgYSBtYXAgb2Yg\ndmFsdWVzIG9mIGVhY2ggcGFyYW1ldGVyIGluZGV4ZWQgYnkgdGhlaXIgPGVt\nPm9yaWdpbmFsPC9lbT4ga2V5LgoJICogCgkgKiBAcmV0dXJuIGFuIGVtcHR5\nIG1hcCBpZiBubyBwYXJhbWV0ZXIgaXMgZGVjbGFyZWQgZm9yIHRoaXMgcXVl\ncnkuCiAgICAgKiBUaGUgdW5ib3VuZCBwYXJhbWV0ZXJzIGhhcyBhIHZhbHVl\nIG9mIG51bGwgd2hpY2ggaXMgaW5kaXN0aW5ndWlzaGFibGUKICAgICAqIGZy\nb20gdGhlIHZhbHVlIGJlaW5nIGJvdW5kIHRvIG51bGwuCgkgKi8KCU1hcDxP\nYmplY3QsT2JqZWN0PiBnZXRQYXJhbWV0ZXJWYWx1ZXMoKSB7CgkgICAgTWFw\nPE9iamVjdCxPYmplY3Q+IHJlc3VsdCA9IG5ldyBIYXNoTWFwPE9iamVjdCxP\nYmplY3Q+KCk7CgkgICAgaWYgKF9ib3VuZFBhcmFtcyA9PSBudWxsKQoJICAg\nICAgICByZXR1cm4gcmVzdWx0OwoJICAgIGZvciAoTWFwLkVudHJ5PE9iamVj\ndCxQYXJhbWV0ZXI8Pz4+IGVudHJ5IDogZ2V0RGVjbGFyZWRQYXJhbWV0ZXJz\nKCkuZW50cnlTZXQoKSkgewoJICAgICAgICBPYmplY3QgcGFyYW1LZXkgPSBl\nbnRyeS5nZXRLZXkoKTsKCSAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0g\nZW50cnkuZ2V0VmFsdWUoKTsKCSAgICAgICAgcmVzdWx0LnB1dChwYXJhbUtl\neSwgX2JvdW5kUGFyYW1zLmdldChwYXJhbSkpOwoJICAgIH0KCSAgICByZXR1\ncm4gcmVzdWx0OwoJfQoJCglwcml2YXRlIE9iamVjdCBleGVjdXRlKCkgewog\nICAgICAgIGlmICghaXNOYXRpdmUoKSAmJiBfcXVlcnkuZ2V0T3BlcmF0aW9u\nKCkgIT0gUXVlcnlPcGVyYXRpb25zLk9QX1NFTEVDVCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLXNlbGVjdC1xdWVyeSIsIGdldFF1ZXJ5U3RyaW5nKCkpLCBudWxsLCBudWxs\nLCBmYWxzZSk7CgkJdHJ5IHsKCQkgICAgbG9jaygpOwogICAgICAgICAgICBN\nYXAgcGFyYW1zID0gZ2V0UGFyYW1ldGVyVmFsdWVzKCk7CiAgICAgICAgICAg\nIGJvb2xlYW4gcmVnaXN0ZXJlZCA9IHByZUV4ZWN1dGUocGFyYW1zKTsKICAg\nICAgICAgICAgT2JqZWN0IHJlc3VsdCA9IF9xdWVyeS5leGVjdXRlKHBhcmFt\ncyk7CiAgICAgICAgICAgIGlmIChyZWdpc3RlcmVkKSB7CiAgICAgICAgICAg\nICAgICBwb3N0RXhlY3V0ZShyZXN1bHQpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiByZXN1bHQ7CgkJfSBmaW5hbGx5IHsKCQkgICAgdW5s\nb2NrKCk7CgkJfQoJfQoJCglwdWJsaWMgTGlzdCBnZXRSZXN1bHRMaXN0KCkg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlPYmplY3Qgb2Ig\nPSBleGVjdXRlKCk7CgkJaWYgKG9iIGluc3RhbmNlb2YgTGlzdCkgewoJCQlM\naXN0IHJldCA9IChMaXN0KSBvYjsKCQkJaWYgKHJldCBpbnN0YW5jZW9mIFJl\nc3VsdExpc3QpIHsKCQkJICAgIFJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9y\nIHRyYW5zID0gUGVyc2lzdGVuY2VFeGNlcHRpb25zLmdldFJvbGxiYWNrVHJh\nbnNsYXRvcihfZW0pOwoJCQkgICAgaWYgKF9xdWVyeS5pc0Rpc3RpbmN0KCkp\nIHsKCQkJICAgICAgICByZXR1cm4gbmV3IERpc3RpbmN0UmVzdWx0TGlzdCgo\nUmVzdWx0TGlzdCkgcmV0LCB0cmFucyk7CgkJCSAgICB9IGVsc2UgewoJCQkg\nICAgICAgIHJldHVybiBuZXcgRGVsZWdhdGluZ1Jlc3VsdExpc3QoKFJlc3Vs\ndExpc3QpIHJldCwgdHJhbnMpOwoJCQkgICAgfQoJCQl9IGVsc2UgewoJCQkJ\ncmV0dXJuIHJldDsKCQkJfQoJCX0KCgkJcmV0dXJuIENvbGxlY3Rpb25zLnNp\nbmdsZXRvbkxpc3Qob2IpOwoJfQoKCS8qKgoJICogRXhlY3V0ZSBhIHF1ZXJ5\nIHRoYXQgcmV0dXJucyBhIHNpbmdsZSByZXN1bHQuCgkgKi8KCXB1YmxpYyBY\nIGdldFNpbmdsZVJlc3VsdCgpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZv\na2VkKCk7CiAgICAgICAgc2V0SGludCgib3BlbmpwYS5oaW50Lk9wdGltaXpl\nUmVzdWx0Q291bnQiLCAxKTsgLy8gZm9yIERCMiBvcHRpbWl6YXRpb24KCQlM\naXN0IHJlc3VsdCA9IGdldFJlc3VsdExpc3QoKTsKCQlpZiAocmVzdWx0ID09\nIG51bGwgfHwgcmVzdWx0LmlzRW1wdHkoKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQiLCBn\nZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAgICAgIC5nZXRNZXNz\nYWdlKCkpOwoJCWlmIChyZXN1bHQuc2l6ZSgpID4gMSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE5vblVuaXF1ZVJlc3VsdEV4Y2VwdGlvbihfbG9jLmdldCgi\nbm9uLXVuaXF1ZS1yZXN1bHQiLAogICAgICAgICAgICAgICAgICAgIGdldFF1\nZXJ5U3RyaW5nKCksIHJlc3VsdC5zaXplKCkpLmdldE1lc3NhZ2UoKSk7CgkJ\ndHJ5IHsKCQkgICAgcmV0dXJuIChYKXJlc3VsdC5nZXQoMCk7CgkJfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5vUmVz\ndWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQiLCBnZXRRdWVyeVN0\ncmluZygpKQogICAgICAgICAgICAgICAgLmdldE1lc3NhZ2UoKSk7CgkJfQoJ\nfQoKCXB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHsKCQlfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgTWFwPD8sPz4gcGFyYW1WYWx1\nZXMgPSBnZXRQYXJhbWV0ZXJWYWx1ZXMoKTsKCQlpZiAoX3F1ZXJ5LmdldE9w\nZXJhdGlvbigpID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9ERUxFVEUpIHsKCQkg\nICByZXR1cm4gYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0eSgpID8gX3F1ZXJ5\nLmRlbGV0ZUFsbCgpIDogX3F1ZXJ5LmRlbGV0ZUFsbChwYXJhbVZhbHVlcykp\nOwoJCX0KCQlpZiAoX3F1ZXJ5LmdldE9wZXJhdGlvbigpID09IFF1ZXJ5T3Bl\ncmF0aW9ucy5PUF9VUERBVEUpIHsKCSAgICAgICByZXR1cm4gYXNJbnQocGFy\nYW1WYWx1ZXMuaXNFbXB0eSgpID8gX3F1ZXJ5LnVwZGF0ZUFsbCgpIDogX3F1\nZXJ5LnVwZGF0ZUFsbChwYXJhbVZhbHVlcykpOwoJCX0KICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtdXBk\nYXRlLWRlbGV0ZS1xdWVyeSIsIGdldFF1ZXJ5U3RyaW5nKCkpLCBudWxsLCBu\ndWxsLCBmYWxzZSk7Cgl9CgoJLyoqCgkgKiBDYXN0IHRoZSBzcGVjaWZpZWQg\nbG9uZyBkb3duIHRvIGFuIGludCwgZmlyc3QgY2hlY2tpbmcgZm9yIG92ZXJm\nbG93LgoJICovCglwcml2YXRlIHN0YXRpYyBpbnQgYXNJbnQobG9uZyBsKSB7\nCgkJaWYgKGwgPiBJbnRlZ2VyLk1BWF9WQUxVRSkKCQkJcmV0dXJuIEludGVn\nZXIuTUFYX1ZBTFVFOwogICAgICAgIGlmIChsIDwgSW50ZWdlci5NSU5fVkFM\nVUUpIC8vIHVubGlrZWx5LCBidXQgd2UgbWlnaHQgYXMgd2VsbCBjaGVjawoJ\nCQlyZXR1cm4gSW50ZWdlci5NSU5fVkFMVUU7CgkJcmV0dXJuIChpbnQpIGw7\nCgl9CgoJcHVibGljIEZsdXNoTW9kZVR5cGUgZ2V0Rmx1c2hNb2RlKCkgewoJ\nCXJldHVybiBFbnRpdHlNYW5hZ2VySW1wbC5mcm9tRmx1c2hCZWZvcmVRdWVy\naWVzKF9xdWVyeQogICAgICAgICAgICAgICAgLmdldEZldGNoQ29uZmlndXJh\ndGlvbigpLmdldEZsdXNoQmVmb3JlUXVlcmllcygpKTsKCX0KCglwdWJsaWMg\nT3BlbkpQQVF1ZXJ5PFg+IHNldEZsdXNoTW9kZShGbHVzaE1vZGVUeXBlIGZs\ndXNoTW9kZSkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlf\ncXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuc2V0Rmx1c2hCZWZvcmVR\ndWVyaWVzKAogICAgICAgICAgICAgICAgRW50aXR5TWFuYWdlckltcGwudG9G\nbHVzaEJlZm9yZVF1ZXJpZXMoZmx1c2hNb2RlKSk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIGJvb2xlYW4gaXNOYXRpdmUoKSB7CgkJcmV0dXJuIFF1\nZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhnZXRMYW5ndWFnZSgpKTsK\nCX0KCgkvKioKCSAqIEFzc2VydHMgdGhhdCB0aGlzIHF1ZXJ5IGlzIGEgSlBR\nTCBvciBDcml0ZXJpYSBRdWVyeS4KCSAqLwoJdm9pZCBhc3NlcnRKUFFMT3JD\ncml0ZXJpYVF1ZXJ5KCkgewogICAgICAgIFN0cmluZyBsYW5ndWFnZSA9IGdl\ndExhbmd1YWdlKCk7CiAgICAgICAgaWYgKEpQUUxQYXJzZXIuTEFOR19KUFFM\nLmVxdWFscyhsYW5ndWFnZSkgCiAgICAgICAgIHx8IFF1ZXJ5TGFuZ3VhZ2Vz\nLkxBTkdfUFJFUEFSRURfU1FMLmVxdWFscyhsYW5ndWFnZSkKICAgICAgICAg\nfHwgQ3JpdGVyaWFCdWlsZGVySW1wbC5MQU5HX0NSSVRFUklBLmVxdWFscyhs\nYW5ndWFnZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vdC1qcHFsLW9yLWNyaXRlcmlhLXF1ZXJ5IikuZ2V0\nTWVzc2FnZSgpKTsKICAgICAgICB9Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVy\neTxYPiBjbG9zZUFsbCgpIHsKCQlfcXVlcnkuY2xvc2VBbGwoKTsKCQlyZXR1\ncm4gdGhpczsKCX0KCglwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0\naW9ucyhNYXAgcGFyYW1zKSB7CgkJcmV0dXJuIF9xdWVyeS5nZXREYXRhU3Rv\ncmVBY3Rpb25zKHBhcmFtcyk7Cgl9CgogICAgcHVibGljIExvY2tNb2RlVHlw\nZSBnZXRMb2NrTW9kZSgpIHsKICAgICAgICBhc3NlcnRKUFFMT3JDcml0ZXJp\nYVF1ZXJ5KCk7CiAgICAgICAgcmV0dXJuIGdldEZldGNoUGxhbigpLmdldFJl\nYWRMb2NrTW9kZSgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyBsb2Nr\nIG1vZGUgb24gdGhlIGdpdmVuIHF1ZXJ5LgogICAgICogSWYgdGhlIHRhcmdl\ndCBxdWVyeSBoYXMgYmVlbiBwcmVwYXJlZCBhbmQgY2FjaGVkLCB0aGVuIGln\nbm9yZXMgdGhlIGNhY2hlZCB2ZXJzaW9uLgogICAgICogQHNlZSAjaWdub3Jl\nUHJlcGFyZWRRdWVyeSgpCiAgICAgKi8KICAgIHB1YmxpYyBUeXBlZFF1ZXJ5\nPFg+IHNldExvY2tNb2RlKExvY2tNb2RlVHlwZSBsb2NrTW9kZSkgewogICAg\nICAgIFN0cmluZyBsYW5ndWFnZSA9IGdldExhbmd1YWdlKCk7CiAgICAgICAg\naWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURfU1FMLmVxdWFscyhs\nYW5ndWFnZSkpIHsKICAgICAgICAgICAgaWdub3JlUHJlcGFyZWRRdWVyeSgp\nOwogICAgICAgIH0KICAgICAgICBhc3NlcnRKUFFMT3JDcml0ZXJpYVF1ZXJ5\nKCk7CiAgICAgICBnZXRGZXRjaFBsYW4oKS5zZXRSZWFkTG9ja01vZGUobG9j\na01vZGUpOwogICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgoJcHVibGljIGlu\ndCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gKF9xdWVyeSA9PSBudWxs\nKSA/IDAgOiBfcXVlcnkuaGFzaENvZGUoKTsKCX0KCglwdWJsaWMgYm9vbGVh\nbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CgkJaWYgKG90aGVyID09IHRoaXMp\nCgkJCXJldHVybiB0cnVlOwogICAgICAgIGlmICgob3RoZXIgPT0gbnVsbCkg\nfHwgKG90aGVyLmdldENsYXNzKCkgIT0gdGhpcy5nZXRDbGFzcygpKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChfcXVlcnkgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCXJldHVybiBfcXVl\ncnkuZXF1YWxzKCgoUXVlcnlJbXBsKSBvdGhlcikuX3F1ZXJ5KTsKCX0KCgkv\nKioKCSAqIEdldCBhbGwgdGhlIGFjdGl2ZSBoaW50cyBhbmQgdGhlaXIgdmFs\ndWVzLgoJICogCgkgKi8KICAgIC8vVE9ETzogSlBBIDIuMCBIaW50cyB0aGF0\nIGFyZSBub3Qgc2V0IHRvIEZldGNoQ29uZmlndXJhdGlvbiAKICAgIHB1Ymxp\nYyBNYXA8U3RyaW5nLCBPYmplY3Q+IGdldEhpbnRzKCkgewogICAgICAgIGlm\nIChfaGludEhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLmVtcHR5TWFwKCk7CiAgICAgICAgcmV0dXJuIF9oaW50SGFu\nZGxlci5nZXRIaW50cygpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVl\ncnk8WD4gc2V0SGludChTdHJpbmcga2V5LCBPYmplY3QgdmFsdWUpIHsKICAg\nICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgaWYg\nKF9oaW50SGFuZGxlciA9PSBudWxsKSB7CiAgICAgICAgICAgIF9oaW50SGFu\nZGxlciA9IG5ldyBIaW50SGFuZGxlcih0aGlzKTsKICAgICAgICB9CiAgICAg\nICAgX2hpbnRIYW5kbGVyLnNldEhpbnQoa2V5LCB2YWx1ZSk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNldDxTdHJpbmc+IGdl\ndFN1cHBvcnRlZEhpbnRzKCkgewogICAgICAgIGlmIChfaGludEhhbmRsZXIg\nPT0gbnVsbCkgewogICAgICAgICAgICBfaGludEhhbmRsZXIgPSBuZXcgSGlu\ndEhhbmRsZXIodGhpcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfaGlu\ndEhhbmRsZXIuZ2V0U3VwcG9ydGVkSGludHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIGlubmVybW9zdCBpbXBsZW1lbnRhdGlvbiB0\naGF0IGlzIGFuIGluc3RhbmNlIG9mIHRoZSBnaXZlbiAKICAgICAqIGNsYXNz\nLiAKICAgICAqIAogICAgICogQHRocm93cyBQZXJzaXN0ZW5jZUV4Y2VwdGlv\nbiBpZiBub25lIGluIHRoZSBkZWxlZ2F0ZSBjaGFpbiBpcyBhbiAKICAgICAq\nIGluc3RhbmNlIG9mIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqIAogICAgICog\nQHNpbmNlIDIuMC4wCiAgICAgKi8KICAgIHB1YmxpYyA8VD4gVCB1bndyYXAo\nQ2xhc3M8VD4gY2xzKSB7CiAgICAgICAgT2JqZWN0W10gZGVsZWdhdGVzID0g\nbmV3IE9iamVjdFtde19xdWVyeS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpLCAK\nICAgICAgICAgICAgX3F1ZXJ5LmdldERlbGVnYXRlKCksIF9xdWVyeSwgdGhp\nc307CiAgICAgICAgZm9yIChPYmplY3QgbyA6IGRlbGVnYXRlcykgewogICAg\nICAgICAgICBpZiAoY2xzLmlzSW5zdGFuY2UobykpCiAgICAgICAgICAgICAg\nICByZXR1cm4gKFQpbzsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFBl\ncnNpc3RlbmNlRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bndyYXAtcXVlcnktaW52\nYWxpZCIsIGNscykKICAgICAgICAgICAgLnRvU3RyaW5nKCksIG51bGwsIHRo\naXMsIGZhbHNlKTsKICAgIH0KICAgIAogICAgLy8gPT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT0KICAgIC8vIFByZXBhcmVkIFF1ZXJ5IENhY2hlIHJlbGF0\nZWQgbWV0aG9kcwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0K\nICAgIAogICAgLyoqCiAgICAgKiBJbnZva2VkIGJlZm9yZSBhIHF1ZXJ5IGlz\nIGV4ZWN1dGVkLgogICAgICogSWYgdGhpcyByZWNlaXZlciBpcyBjYWNoZWQg\nYXMgYSB7QGxpbmtwbGFpbiBQcmVwYXJlZFF1ZXJ5IHByZXBhcmVkIHF1ZXJ5\nfQogICAgICogdGhlbiByZS1wYXJhbWV0ZXJpemVzIHRoZSBnaXZlbiB1c2Vy\nIHBhcmFtZXRlcnMuIFRoZSBnaXZlbiBtYXAgaXMgY2xlYXJlZAogICAgICog\nYW5kIHJlLXBhcmFtZXRlcml6ZWQgdmFsdWVzIGFyZSBmaWxsZWQgaW4uIAog\nICAgICogCiAgICAgKiBAcGFyYW0gcGFyYW1zIHVzZXIgc3VwcGxpZWQgcGFy\nYW1ldGVyIGtleS12YWx1ZXMuIEFsd2F5cyBzdXBwbHkgYSAKICAgICAqIG5v\nbi1udWxsIG1hcCBldmVuIGlmIHRoZSB1c2VyIGhhcyBub3Qgc3BlY2lmaWVk\nIGFueSBwYXJhbWV0ZXIsIGJlY2F1c2UgCiAgICAgKiB0aGUgc2FtZSBtYXAg\nd2lsbCB0byBiZSBwb3B1bGF0ZWQgYnkgcmUtcGFyYW1ldGVyaXphdGlvbi4K\nICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHRoaXMgaW52b2NhdGlv\nbiBjYXVzZWQgdGhlIHF1ZXJ5IGJlaW5nIHJlZ2lzdGVyZWQgaW4gdGhlCiAg\nICAgKiBjYWNoZS4gCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBwcmVF\neGVjdXRlKE1hcCBwYXJhbXMpIHsKICAgICAgICBQcmVwYXJlZFF1ZXJ5Q2Fj\naGUgY2FjaGUgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeUNhY2hlKCk7CiAgICAg\nICAgaWYgKGNhY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIH0KICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2ggPSBfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAg\nQm9vbGVhbiByZWdpc3RlcmVkID0gY2FjaGUucmVnaXN0ZXIoX2lkLCBfcXVl\ncnksIGZldGNoKTsKICAgICAgICBib29sZWFuIGFscmVhZHlDYWNoZWQgPSAo\ncmVnaXN0ZXJlZCA9PSBudWxsKTsKICAgICAgICBTdHJpbmcgbGFuZyA9IF9x\ndWVyeS5nZXRMYW5ndWFnZSgpOwogICAgICAgIFF1ZXJ5U3RhdGlzdGljczxT\ndHJpbmc+IHN0YXRzID0gY2FjaGUuZ2V0U3RhdGlzdGljcygpOwogICAgICAg\nIGlmIChhbHJlYWR5Q2FjaGVkICYmIExBTkdfUFJFUEFSRURfU1FMLmVxdWFs\ncyhsYW5nKSkgewogICAgICAgICAgICBQcmVwYXJlZFF1ZXJ5IHBxID0gX2Vt\nLmdldFByZXBhcmVkUXVlcnkoX2lkKTsKICAgICAgICAgICAgaWYgKHBxLmlz\nSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBNYXAgcmVwID0gcHEucmVwYXJhbWV0cml6ZShwYXJh\nbXMsIF9lbS5nZXRCcm9rZXIoKSk7CiAgICAgICAgICAgICAgICAgICAgcGFy\nYW1zLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnB1dEFs\nbChyZXApOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlv\nbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGludmFsaWRhdGVQcmVwYXJl\nZFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICAgICAgTG9nIGxvZyA9IF9lbS5n\nZXRDb25maWd1cmF0aW9uKCkuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9u\nLkxPR19SVU5USU1FKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndh\ncm4odWUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgc3RhdHMucmVjb3JkRXhlY3V0aW9uKHBxLmdldE9yaWdpbmFs\nUXVlcnkoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdHMu\ncmVjb3JkRXhlY3V0aW9uKF9xdWVyeS5nZXRRdWVyeVN0cmluZygpKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHJlZ2lzdGVyZWQgPT0gQm9vbGVhbi5U\nUlVFOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgdGhl\nIHJlZ2lzdGVyZWQgUHJlcGFyZWQgUXVlcnkgZnJvbSB0aGUgZ2l2ZW4gb3Bh\ncXVlIG9iamVjdC4KICAgICAqIAogICAgICogQHBhcmFtIHJlc3VsdCBhbiBv\ncGFxdWUgb2JqZWN0IHJlcHJlc2VudGluZyBleGVjdXRpb24gcmVzdWx0IG9m\nIGEgcXVlcnkKICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBw\ncmVwYXJlZCBxdWVyeSBjYW4gYmUgaW5pdGlhbGl6ZWQuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiBwb3N0RXhlY3V0ZShPYmplY3QgcmVzdWx0KSB7\nCiAgICAgICAgUHJlcGFyZWRRdWVyeUNhY2hlIGNhY2hlID0gX2VtLmdldFBy\nZXBhcmVkUXVlcnlDYWNoZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBudWxs\nKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGNhY2hlLmluaXRpYWxpemUoX2lkLCByZXN1bHQpICE9IG51\nbGw7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmVtb3ZlIHRoaXMgcXVl\ncnkgZnJvbSBQcmVwYXJlZFF1ZXJ5Q2FjaGUuIAogICAgICovCiAgICBib29s\nZWFuIGludmFsaWRhdGVQcmVwYXJlZFF1ZXJ5KCkgewogICAgICAgIFByZXBh\ncmVkUXVlcnlDYWNoZSBjYWNoZSA9IF9lbS5nZXRQcmVwYXJlZFF1ZXJ5Q2Fj\naGUoKTsKICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIGlnbm9yZVByZXBhcmVkUXVlcnkoKTsK\nICAgICAgICByZXR1cm4gY2FjaGUuaW52YWxpZGF0ZShfaWQpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIElnbm9yZXMgdGhpcyBxdWVyeSBmcm9tIFBy\nZXBhcmVkUXVlcnlDYWNoZSBieSByZWNyZWF0aW5nIHRoZSBvcmlnaW5hbAog\nICAgICogcXVlcnkgaWYgaXQgaGFzIGJlZW4gY2FjaGVkLiAKICAgICAqLwog\nICAgdm9pZCBpZ25vcmVQcmVwYXJlZFF1ZXJ5KCkgewogICAgICAgIFByZXBh\ncmVkUXVlcnkgY2FjaGVkID0gX2VtLmdldFByZXBhcmVkUXVlcnkoX2lkKTsK\nICAgICAgICBpZiAoY2FjaGVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICBCcm9rZXIgYnJva2VyID0gX2VtLmdldEJyb2tlcigpOwog\nICAgICAgIC8vIENyaXRpY2FsIGFzc3VtcHRpb246IE9ubHkgSlBRTCBxdWVy\naWVzIGFyZSBjYWNoZWQgYW5kIG1vcmUgCiAgICAgICAgLy8gaW1wb3J0YW50\nbHksIHRoZSBpZGVudGlmaWVyIG9mIHRoZSBwcmVwYXJlZCBxdWVyeSBpcyB0\naGUgb3JpZ2luYWwKICAgICAgICAvLyBKUFFMIFN0cmluZwogICAgICAgIFN0\ncmluZyBKUFFMID0gSlBRTFBhcnNlci5MQU5HX0pQUUw7CiAgICAgICAgU3Ry\naW5nIGpwcWwgPSBfaWQ7CiAgICAgICAgCiAgICAgICAgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeSBuZXdRdWVyeSA9IGJyb2tlci5uZXdRdWVy\neShKUFFMLCBqcHFsKTsKICAgICAgICBuZXdRdWVyeS5nZXRGZXRjaENvbmZp\nZ3VyYXRpb24oKS5jb3B5KF9xdWVyeS5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKSk7CiAgICAgICAgbmV3UXVlcnkuY29tcGlsZSgpOwogICAgICAgIF9xdWVy\neSA9IG5ldyBEZWxlZ2F0aW5nUXVlcnkobmV3UXVlcnksIF9lbS5nZXRFeGNl\ncHRpb25UcmFuc2xhdG9yKCkpOwogICAgfQogICAgCiAgICAvLyBwYWNrYWdl\nIHByb3RlY3RlZAogICAgUXVlcnlJbXBsIHNldElkKFN0cmluZyBpZCkgewog\nICAgICAgIF9pZCA9IGlkOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQog\nICAgLy8gPT09PT09PT09PT09PT09PSBFbmQgb2YgUHJlcGFyZWQgUXVlcnkg\ncmVsYXRlZCBtZXRob2RzID09PT09PT09PT09PT09PT09PT09PQogICAgCiAg\nICB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9IG51bGwpIAog\nICAgICAgICAgICBfbG9jay5sb2NrKCk7CiAgICB9CgogICAgdm9pZCB1bmxv\nY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9IG51bGwpCiAgICAgICAgICAg\nIF9sb2NrLnVubG9jaygpOwogICAgfQoKICAgIAogICAgLy8gPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgIFBhcmFtZXRl\nciBwcm9jZXNzaW5nIHJvdXRpbmVzCiAgICAvLyA9PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT0KCiAgICAvKioKICAgICAqIEJpbmRzIHRo\nZSBwYXJhbWV0ZXIgaWRlbnRpZmllZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24g\ndG8gdGhlIGdpdmVuIHZhbHVlLgogICAgICogVGhlIHBhcmFtZXRlciBhcmUg\nYm91bmQgdG8gYSB2YWx1ZSBpbiB0aGUgY29udGV4dCBvZiB0aGlzIHF1ZXJ5\nLiAKICAgICAqIFRoZSBzYW1lIHBhcmFtZXRlciBtYXkgYmUgYm91bmQgdG8g\nYSBkaWZmZXJlbnQgdmFsdWUgaW4gdGhlIGNvbnRleHQgb2YgCiAgICAgKiBh\nbm90aGVyIHF1ZXJ5LgogICAgICogPGJyPgogICAgICogRm9yIG5vbi1uYXRp\ndmUgcXVlcmllcywgdGhlIGdpdmVuIHBvc2l0aW9uIG11c3QgYmUgYSB2YWxp\nZCBwb3NpdGlvbiBpbgogICAgICogdGhlIGRlY2xhcmVkIHBhcmFtZXRlcnMu\nCiAgICAgKiA8YnI+CiAgICAgKiBBcyBuYXRpdmUgcXVlcmllcyBtYXkgbm90\nIGJlIHBhcnNlZCBhbmQgaGVuY2UgdGhlaXIgZGVjbGFyZWQgcGFyYW1ldGVy\ncwogICAgICogbWF5IG5vdCBiZSBrbm93biwgc2V0dGluZyBhbiBwb3NpdGlv\nbmFsIHBhcmFtZXRlciBoYXMgdGhlIHNpZGUtZWZmZWN0CiAgICAgKiBvZiBh\nIHBvc2l0aW9uYWwgcGFyYW1ldGVyIGJlaW5nIGRlY2xhcmVkLgogICAgICog\nICAKICAgICAqIEBwYXJhbSBwb3NpdGlvbiBwb3NpdGl2ZSwgaW50ZWdlciBw\nb3NpdGlvbiBvZiB0aGUgcGFyYW1ldGVyCiAgICAgKiBAcGFyYW0gdmFsdWUg\nYW4gYXNzaWdubWVudCBjb21wYXRpYmxlIHZhbHVlCiAgICAgKiBAcmV0dXJu\nIHRoZSBzYW1lIHF1ZXJ5IGluc3RhbmNlCiAgICAgKiBAdGhyb3dzIElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBwb3NpdGlvbiBkb2VzIG5vdCBjb3Jy\nZXNwb25kIHRvIGEgcG9zaXRpb25hbCAKICAgICAqIHBhcmFtZXRlciBvZiB0\naGUgcXVlcnkgb3IgaWYgdGhlIGFyZ3VtZW50IGlzIG9mIGluY29ycmVjdCB0\neXBlCiAgICAgKi8gICAgCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNl\ndFBhcmFtZXRlcihpbnQgcG9zLCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBf\ncXVlcnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9lbS5hc3NlcnROb3RDbG9z\nZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChwb3MgPCAxKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0\nKCJpbGxlZ2FsLWluZGV4IiwgcG9zKS5nZXRNZXNzYWdlKCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IG51bGw7\nCiAgICAgICAgICAgIGlmIChpc05hdGl2ZSgpKSB7CiAgICAgICAgICAgICAg\nICBwYXJhbSA9IG5ldyBQYXJhbWV0ZXJJbXBsPE9iamVjdD4ocG9zLCBPYmpl\nY3QuY2xhc3MpOwogICAgICAgICAgICAgICAgZGVjbGFyZVBhcmFtZXRlcihw\nb3MsIHBhcmFtKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIHBhcmFtID0gZ2V0UGFyYW1ldGVyKHBvcyk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgYmluZFZhbHVlKHBhcmFtLCB2YWx1ZSk7CgogICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBfcXVlcnkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFNldHMgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBwb3Np\ndGlvbmFsIHBhcmFtZXRlciBhZnRlciBjb252ZXJzaW9uIG9mIHRoZQogICAg\nICogZ2l2ZW4gdmFsdWUgdG8gdGhlIGdpdmVuIFRlbXBvcmFsIFR5cGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFyYW1ldGVy\nKGludCBwb3NpdGlvbiwgQ2FsZW5kYXIgdmFsdWUsIFRlbXBvcmFsVHlwZSB0\nKSB7CiAgICAgICAgcmV0dXJuIHNldFBhcmFtZXRlcihwb3NpdGlvbiwgY29u\ndmVydFRlbXBvcmFsVHlwZSh2YWx1ZSwgdCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIG5hbWVkIHBhcmFt\nZXRlciBhZnRlciBjb252ZXJzaW9uIG9mIHRoZQogICAgICogZ2l2ZW4gdmFs\ndWUgdG8gdGhlIGdpdmVuIFRlbXBvcmFsIFR5cGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFyYW1ldGVyKGludCBwb3NpdGlv\nbiwgRGF0ZSB2YWx1ZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICBy\nZXR1cm4gc2V0UGFyYW1ldGVyKHBvc2l0aW9uLCBjb252ZXJ0VGVtcG9yYWxU\neXBlKHZhbHVlLCB0eXBlKSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nQ29udmVydHMgdGhlIGdpdmVuIERhdGUgdG8gYSB2YWx1ZSBjb3JyZXNwb25k\naW5nIHRvIGdpdmVuIHRlbXBvcmFsIHR5cGUuCiAgICAgKi8KICAgIE9iamVj\ndCBjb252ZXJ0VGVtcG9yYWxUeXBlKERhdGUgdmFsdWUsIFRlbXBvcmFsVHlw\nZSB0eXBlKSB7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2Fz\nZSBEQVRFOgogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgY2Fz\nZSBUSU1FOgogICAgICAgICAgICByZXR1cm4gbmV3IFRpbWUodmFsdWUuZ2V0\nVGltZSgpKTsKICAgICAgICBjYXNlIFRJTUVTVEFNUDoKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBUaW1lc3RhbXAodmFsdWUuZ2V0VGltZSgpKTsKICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCiAgICB9CgogICAgT2JqZWN0IGNvbnZlcnRUZW1wb3JhbFR5cGUoQ2FsZW5k\nYXIgdmFsdWUsIFRlbXBvcmFsVHlwZSB0eXBlKSB7CiAgICAgICAgcmV0dXJu\nIGNvbnZlcnRUZW1wb3JhbFR5cGUodmFsdWUuZ2V0VGltZSgpLCB0eXBlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgZGVjbGFyZWQgcGFy\nYW1ldGVycyB1c2UgcG9zaXRpb24gaWRlbnRpZmllci4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaGFzUG9zaXRpb25hbFBhcmFtZXRlcnMoKSB7CiAg\nICAgICAgcmV0dXJuICFnZXREZWNsYXJlZFBhcmFtZXRlcktleXMoSW50ZWdl\nci5jbGFzcykuaXNFbXB0eSgpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0\ncyB0aGUgYXJyYXkgb2YgcG9zaXRpb25hbCBwYXJhbWV0ZXIgdmFsdWVzLgog\nICAgICogVGhlIG4tdGggYXJyYXkgZWxlbWVudCByZXByZXNlbnRzIChuKzEp\nLXRoIHBvc2l0aW9uYWwgcGFyYW1ldGVyLiAgCiAgICAgKiBJZiBhIHBhcmFt\nZXRlciBoYXMgYmVlbiBkZWNsYXJlZCBidXQgbm90IGJvdW5kIHRvIGEgdmFs\ndWUgdGhlbgogICAgICogdGhlIHZhbHVlIGlzIG51bGwgYW5kIGhlbmNlIGlz\nIGluZGlzdGluZ3Vpc2hhYmxlIGZyb20gdGhlIHZhbHVlCiAgICAgKiBiZWlu\nZyBhY3R1YWxseSBudWxsLgogICAgICogSWYgdGhlIHBhcmFtZXRlciBpbmRl\neGluZyBpcyBub3QgY29udGlndW91cyB0aGVuIHRoZSB1bnNwZWNpZmllZAog\nICAgICogcGFyYW1ldGVycyBhcmUgY29uc2lkZXJlZCBhcyBudWxsLgogICAg\nICovCiAgICBwdWJsaWMgT2JqZWN0W10gZ2V0UG9zaXRpb25hbFBhcmFtZXRl\ncnMoKSB7CiAgICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBTZXQ8SW50ZWdlcj4gcG9zaXRpb25hbEtleXMgPSBnZXRE\nZWNsYXJlZFBhcmFtZXRlcktleXMoSW50ZWdlci5jbGFzcyk7CiAgICAgICAg\nICAgIE9iamVjdFtdIHJlc3VsdCA9IG5ldyBPYmplY3RbY2FsY3VsYXRlTWF4\nS2V5KHBvc2l0aW9uYWxLZXlzKV07CiAgICAgICAgICAgIGZvciAoSW50ZWdl\nciBwb3MgOiBwb3NpdGlvbmFsS2V5cykgewogICAgICAgICAgICAgICAgUGFy\nYW1ldGVyPD8+IHBhcmFtID0gZ2V0UGFyYW1ldGVyKHBvcyk7CiAgICAgICAg\nICAgICAgICByZXN1bHRbcG9zLmludFZhbHVlKCktMV0gPSBpc0JvdW5kKHBh\ncmFtKSA/IGdldFBhcmFtZXRlclZhbHVlKHBvcykgOiBudWxsOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIG1h\neGltdW0gdmFsdWUgb2YgdGhlIGdpdmVuIHNldC4KICAgICAqLwogICAgaW50\nIGNhbGN1bGF0ZU1heEtleShTZXQ8SW50ZWdlcj4gcCkgewogICAgICAgIGlm\nIChwID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlu\ndCBtYXggPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAgICAgICBmb3IgKEludGVn\nZXIgaSA6IHApCiAgICAgICAgICAgIG1heCA9IE1hdGgubWF4KG1heCwgaSk7\nCiAgICAgICAgcmV0dXJuIG1heDsKICAgIH0KCiAgICAvKioKICAgICAqIEJp\nbmRzIHRoZSBnaXZlbiB2YWx1ZXMgYXMgcG9zaXRpb25hbCBwYXJhbWV0ZXJz\nLiAKICAgICAqIFRoZSBuLXRoIGFycmF5IGVsZW1lbnQgdmFsdWUgaXMgc2V0\nIHRvIGEgUGFyYW1ldGVyIHdpdGggKG4rMSktdGggcG9zaXRpb25hbCBpZGVu\ndGlmaWVyLiAgCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4g\nc2V0UGFyYW1ldGVycyhPYmplY3QuLi4gcGFyYW1zKSB7CiAgICAgICAgX3F1\nZXJ5LmFzc2VydE9wZW4oKTsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJ\nbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBjbGVhckJpbmRpbmcoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IHBhcmFtcyAhPSBudWxsICYmIGkgPCBwYXJhbXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHNldFBhcmFtZXRlcihpICsg\nMSwgcGFyYW1zW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVl\ncnkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICB2b2lkIGNs\nZWFyQmluZGluZygpIHsKICAgICAgICBpZiAoX2JvdW5kUGFyYW1zICE9IG51\nbGwpCiAgICAgICAgICAgIF9ib3VuZFBhcmFtcy5jbGVhcigpOwogICAgfQoK\nICAgIC8qKgogICAgICogR2V0cyB0aGUgdmFsdWUgb2YgYWxsIHRoZSBuYW1l\nZCBwYXJhbWV0ZXJzLiAgCiAgICAgKiAKICAgICAqIElmIGEgcGFyYW1ldGVy\nIGhhcyBiZWVuIGRlY2xhcmVkIGJ1dCBub3QgYm91bmQgdG8gYSB2YWx1ZSB0\naGVuCiAgICAgKiB0aGUgdmFsdWUgaXMgbnVsbCBhbmQgaGVuY2UgaXMgaW5k\naXN0aW5ndWlzaGFibGUgZnJvbSB0aGUgdmFsdWUKICAgICAqIGJlaW5nIGFj\ndHVhbGx5IG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBNYXA8U3RyaW5nLCBP\nYmplY3Q+IGdldE5hbWVkUGFyYW1ldGVycygpIHsKICAgICAgICBfcXVlcnku\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE1hcDxTdHJpbmcs\nIE9iamVjdD4gcmVzdWx0ID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBPYmplY3Q+\nKCk7CiAgICAgICAgICAgIFNldDxTdHJpbmc+IG5hbWVkS2V5cyA9IGdldERl\nY2xhcmVkUGFyYW1ldGVyS2V5cyhTdHJpbmcuY2xhc3MpOwogICAgICAgICAg\nICBmb3IgKFN0cmluZyBuYW1lIDogbmFtZWRLZXlzKSB7CiAgICAgICAgICAg\nICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQYXJhbWV0ZXIobmFtZSk7\nCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KG5hbWUsIGlzQm91bmQocGFy\nYW0pID8gZ2V0UGFyYW1ldGVyVmFsdWUobmFtZSkgOiBudWxsKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSB2YWx1ZXMgb2Yg\ndGhlIHBhcmFtZXRlcnMgZnJvbSB0aGUgZ2l2ZW4gTWFwLgogICAgICogVGhl\nIGtleXMgb2YgdGhlIGdpdmVuIG1hcCBkZXNpZ25hdGUgdGhlIG5hbWUgb2Yg\ndGhlIGRlY2xhcmVkIHBhcmFtZXRlci4KICAgICAgCiAgICAgKi8KICAgIHB1\nYmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFyYW1ldGVycyhNYXAgcGFyYW1z\nKSB7CiAgICAgICAgX3F1ZXJ5LmFzc2VydE9wZW4oKTsKICAgICAgICBfZW0u\nYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBjbGVhckJpbmRpbmcoKTsK\nICAgICAgICAgICAgaWYgKHBhcmFtcyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgZm9yIChNYXAuRW50cnkgZSA6IChTZXQ8TWFwLkVudHJ5PikgcGFyYW1z\nLmVudHJ5U2V0KCkpCiAgICAgICAgICAgICAgICAgICAgc2V0UGFyYW1ldGVy\nKChTdHJpbmcpIGUuZ2V0S2V5KCksIGUuZ2V0VmFsdWUoKSk7CiAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBHZXQgdGhlIHBhcmFtZXRlciBvZiB0aGUgZ2l2ZW4gbmFtZSBh\nbmQgdHlwZS4KICAgICAqIAogICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24gaWYgdGhlIHBhcmFtZXRlciBvZiB0aGUKICAgICAqICAg\nICAgICAgc3BlY2lmaWVkIG5hbWUgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90\nIGFzc2lnbmFibGUKICAgICAqICAgICAgICAgdG8gdGhlIHR5cGUKICAgICAq\nIEB0aHJvd3MgSWxsZWdhbFN0YXRlRXhjZXB0aW9uIGlmIGludm9rZWQgb24g\nYSBuYXRpdmUgcXVlcnkgCiAgICAgKi8KICAgIHB1YmxpYyA8VD4gUGFyYW1l\ndGVyPFQ+IGdldFBhcmFtZXRlcihTdHJpbmcgbmFtZSwgQ2xhc3M8VD4gdHlw\nZSkgewogICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldFBhcmFtZXRl\ncihuYW1lKTsKICAgICAgICBpZiAocGFyYW0uZ2V0UGFyYW1ldGVyVHlwZSgp\nLmlzQXNzaWduYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24ocGFyYW0gKyAiIGRvZXMgbm90\nIG1hdGNoIHRoZSByZXF1ZXN0ZWQgdHlwZSAiICsgdHlwZSk7CiAgICAgICAg\ncmV0dXJuIChQYXJhbWV0ZXI8VD4pcGFyYW07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHZXQgdGhlIHBvc2l0aW9uYWwgcGFyYW1ldGVyIHdpdGggdGhlIGdp\ndmVuIHBvc2l0aW9uIGFuZCB0eXBlLgogICAgICogQHRocm93cyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24gaWYgdGhlIHBhcmFtZXRlciB3aXRoIHRoZQog\nICAgICogICAgICAgICBzcGVjaWZpZWQgcG9zaXRpb24gZG9lcyBub3QgZXhp\nc3Qgb3IgaXMgbm90IGFzc2lnbmFibGUKICAgICAqICAgICAgICAgdG8gdGhl\nIHR5cGUKICAgICAqIEB0aHJvd3MgSWxsZWdhbFN0YXRlRXhjZXB0aW9uIGlm\nIGludm9rZWQgb24gYSBuYXRpdmUgcXVlcnkgdW5sZXNzCiAgICAgKiB0aGUg\nc2FtZSBwYXJhbWV0ZXIgcG9zaXRpb24gaXMgYm91bmQgYWxyZWFkeS4KICAg\nICAqLwogICAgcHVibGljIDxUPiBQYXJhbWV0ZXI8VD4gZ2V0UGFyYW1ldGVy\nKGludCBwb3MsIENsYXNzPFQ+IHR5cGUpIHsKICAgICAgICBQYXJhbWV0ZXI8\nPz4gcGFyYW0gPSBnZXRQYXJhbWV0ZXIocG9zKTsKICAgICAgICBpZiAocGFy\nYW0uZ2V0UGFyYW1ldGVyVHlwZSgpLmlzQXNzaWduYWJsZUZyb20odHlwZSkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24ocGFyYW0gKyAiIGRvZXMgbm90IG1hdGNoIHRoZSByZXF1ZXN0ZWQgdHlw\nZSAiICsgdHlwZSk7CiAgICAgICAgcmV0dXJuIChQYXJhbWV0ZXI8VD4pcGFy\nYW07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIGJv\ndW5kIHRvIHRoZSBwYXJhbWV0ZXIuCiAgICAgKiBAcGFyYW0gcGFyYW0gcGFy\nYW1ldGVyIG9iamVjdAogICAgICogQHJldHVybiBwYXJhbWV0ZXIgdmFsdWUK\nICAgICAqIEB0aHJvd3MgSWxsZWdhbFN0YXRlRXhjZXB0aW9uIGlmIHRoZSBw\nYXJhbWV0ZXIgaGFzIG5vdCBiZWVuIGJlZW4gYm91bmQKICAgICAqIEB0aHJv\nd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHRoZSBwYXJhbWV0ZXIg\nZG9lcyBub3QgYmVsb25nIHRvIHRoaXMgcXVlcnkKICAgICAqLwogICAgcHVi\nbGljIDxUPiBUIGdldFBhcmFtZXRlclZhbHVlKFBhcmFtZXRlcjxUPiBwKSB7\nCiAgICAgICAgaWYgKCFpc0JvdW5kKHApKSB7CiAgICAgICAgICAgdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgicGFyYW0t\nbWlzc2luZyIsIHAsIGdldFF1ZXJ5U3RyaW5nKCksIAogICAgICAgICAgICAg\nICBnZXRCb3VuZFBhcmFtZXRlcktleXMoKSkuZ2V0TWVzc2FnZSgpKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIChUKV9ib3VuZFBhcmFtcy5nZXQocCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBwYXJhbWV0ZXJzIGRl\nY2xhcmVkIGluIHRoaXMgcXVlcnkuCiAgICAgKi8KICAgIHB1YmxpYyBTZXQ8\nUGFyYW1ldGVyPD8+PiBnZXRQYXJhbWV0ZXJzKCkgewogICAgICAgIFNldDxQ\nYXJhbWV0ZXI8Pz4+IHJlc3VsdCA9IG5ldyBIYXNoU2V0PFBhcmFtZXRlcjw/\nPj4oKTsKICAgICAgICByZXN1bHQuYWRkQWxsKGdldERlY2xhcmVkUGFyYW1l\ndGVycygpLnZhbHVlcygpKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAg\nfQoKICAgIHB1YmxpYyA8VD4gT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFtZXRl\ncihQYXJhbWV0ZXI8VD4gcCwgVCBhcmcxKSB7CiAgICAgICAgYmluZFZhbHVl\nKChQYXJhbWV0ZXI8VD4pcCwgYXJnMSk7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0\nZXIoUGFyYW1ldGVyPERhdGU+IHAsIERhdGUgZGF0ZSwgVGVtcG9yYWxUeXBl\nIHR5cGUpIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVyKHAsIChEYXRl\nKWNvbnZlcnRUZW1wb3JhbFR5cGUoZGF0ZSwgdHlwZSkpOwogICAgfQoKICAg\nIHB1YmxpYyBUeXBlZFF1ZXJ5PFg+IHNldFBhcmFtZXRlcihQYXJhbWV0ZXI8\nQ2FsZW5kYXI+IHAsIENhbGVuZGFyIGNhbCwgVGVtcG9yYWxUeXBlIHR5cGUp\nIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVyKHAsIChDYWxlbmRhcilj\nb252ZXJ0VGVtcG9yYWxUeXBlKGNhbCwgdHlwZSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogR2V0IHRoZSBwYXJhbWV0ZXIgb2JqZWN0IGNvcnJlc3BvbmRp\nbmcgdG8gdGhlIGRlY2xhcmVkIHBhcmFtZXRlciBvZiB0aGUgZ2l2ZW4gbmFt\nZS4KICAgICAqIFRoaXMgbWV0aG9kIGlzIG5vdCByZXF1aXJlZCB0byBiZSBz\ndXBwb3J0ZWQgZm9yIG5hdGl2ZSBxdWVyaWVzLgogICAgICogCiAgICAgKiBA\ndGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1l\ndGVyIG9mIHRoZSBzcGVjaWZpZWQgbmFtZSBkb2VzIG5vdCBleGlzdAogICAg\nICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgaW52b2tlZCBv\nbiBhIG5hdGl2ZSBxdWVyeQogICAgICovCiAgICBwdWJsaWMgUGFyYW1ldGVy\nPD8+IGdldFBhcmFtZXRlcihTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChp\nc05hdGl2ZSgpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQoInBhcmFtLW5hbWVkLW5vbi1uYXRpdmUi\nLCBuYW1lKS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgICAgICBQYXJh\nbWV0ZXI8Pz4gcGFyYW0gPSBnZXREZWNsYXJlZFBhcmFtZXRlcnMoKS5nZXQo\nbmFtZSk7CiAgICAgICAgaWYgKHBhcmFtID09IG51bGwpIHsKICAgICAgICAg\nICAgU2V0PFBhcmFtZXRlckV4cHJlc3Npb24+IGV4cHMgPSBnZXREZWNsYXJl\nZFBhcmFtZXRlcktleXMoUGFyYW1ldGVyRXhwcmVzc2lvbi5jbGFzcyk7CiAg\nICAgICAgICAgIGZvciAoUGFyYW1ldGVyRXhwcmVzc2lvbjw/PiBlIDogZXhw\ncykgewogICAgICAgICAgICAgICAgaWYgKG5hbWUuZXF1YWxzKGUuZ2V0TmFt\nZSgpKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1taXNzaW5nLW5hbWUiLCAKICAgICAg\nICAgICAgICAgIG5hbWUsIGdldFF1ZXJ5U3RyaW5nKCksIGdldERlY2xhcmVk\nUGFyYW1ldGVyS2V5cygpKS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcGFyYW07CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQg\ndGhlIHBvc2l0aW9uYWwgcGFyYW1ldGVyIHdpdGggdGhlIGdpdmVuIHBvc2l0\naW9uLgogICAgICogVGhlIHBhcmFtZXRlciBtYXkganVzdCBoYXZlIGJlZW4g\nZGVjbGFyZWQgYW5kIG5vdCBib3VuZCB0byBhIHZhbHVlLgogICAgICogCiAg\nICAgKiBAcGFyYW0gcG9zaXRpb24gc3BlY2lmaWVkIGluIHRoZSB1c2VyIHF1\nZXJ5LgogICAgICogQHJldHVybiBwYXJhbWV0ZXIgb2JqZWN0CiAgICAgKiBA\ndGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1l\ndGVyIHdpdGggdGhlIGdpdmVuIHBvc2l0aW9uIGRvZXMgbm90IGV4aXN0CiAg\nICAgKi8KICAgIHB1YmxpYyBQYXJhbWV0ZXI8Pz4gZ2V0UGFyYW1ldGVyKGlu\ndCBwb3MpIHsKICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXREZWNs\nYXJlZFBhcmFtZXRlcnMoKS5nZXQocG9zKTsKICAgICAgICBpZiAocGFyYW0g\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbihfbG9jLmdldCgicGFyYW0tbWlzc2luZy1wb3MiLCAKICAg\nICAgICAgICAgICAgIHBvcywgZ2V0UXVlcnlTdHJpbmcoKSwgZ2V0RGVjbGFy\nZWRQYXJhbWV0ZXJLZXlzKCkpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgcmV0\ndXJuIHBhcmFtOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2\nYWx1ZSBib3VuZCB0byB0aGUgcGFyYW1ldGVyLgogICAgICogCiAgICAgKiBA\ncGFyYW0gbmFtZSBuYW1lIG9mIHRoZSBwYXJhbWV0ZXIKICAgICAqIEByZXR1\ncm4gcGFyYW1ldGVyIHZhbHVlCiAgICAgKiAKICAgICAqIEB0aHJvd3MgSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uIGlmIHRoaXMgcGFyYW1ldGVyIGhhcyBub3Qg\nYmVlbiBib3VuZAogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldFBhcmFt\nZXRlclZhbHVlKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIF9ib3Vu\nZFBhcmFtcy5nZXQoZ2V0UGFyYW1ldGVyKG5hbWUpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUgYm91bmQgdG8gdGhlIHBhcmFt\nZXRlci4KICAgICAqIAogICAgICogQHBhcmFtIHBvcyBwb3NpdGlvbiBvZiB0\naGUgcGFyYW1ldGVyCiAgICAgKiBAcmV0dXJuIHBhcmFtZXRlciB2YWx1ZQog\nICAgICogCiAgICAgKiBAdGhyb3dzIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBp\nZiB0aGlzIHBhcmFtZXRlciBoYXMgbm90IGJlZW4gYm91bmQKICAgICAqLwog\nICAgcHVibGljIE9iamVjdCBnZXRQYXJhbWV0ZXJWYWx1ZShpbnQgcG9zKSB7\nCiAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0gZ2V0UGFyYW1ldGVyKHBv\ncyk7CiAgICAgICAgYXNzZXJ0Qm91bmQocGFyYW0pOwogICAgICAgIHJldHVy\nbiBfYm91bmRQYXJhbXMuZ2V0KHBhcmFtKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBHZXRzIHRoZSBwYXJhbWV0ZXIga2V5cyBib3VuZCB3aXRoIHRo\naXMgcXVlcnkuCiAgICAgKiBQYXJhbWV0ZXIga2V5IGNhbiBiZSBJbnRlZ2Vy\nLCBTdHJpbmcgb3IgYSBQYXJhbWV0ZXJFeHByZXNzaW9uIGl0c2VsZgogICAg\nICogYnV0IGFsbCBwYXJhbWV0ZXJzIGtleXMgb2YgYSBwYXJ0aWN1bGFyIHF1\nZXJ5IGFyZSBvZiB0aGUgc2FtZSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nU2V0PD8+IGdldEJvdW5kUGFyYW1ldGVyS2V5cygpIHsKICAgICAgICBpZiAo\nX2JvdW5kUGFyYW1zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBDb2xs\nZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgZ2V0RGVjbGFyZWRQYXJhbWV0\nZXJzKCk7CiAgICAgICAgU2V0PE9iamVjdD4gcmVzdWx0ID0gbmV3IEhhc2hT\nZXQ8T2JqZWN0PigpOwogICAgICAgIGZvciAoTWFwLkVudHJ5PE9iamVjdCwg\nUGFyYW1ldGVyPD8+PiBlbnRyeSA6IF9kZWNsYXJlZFBhcmFtcy5lbnRyeVNl\ndCgpKSB7CiAgICAgICAgICAgIGlmIChpc0JvdW5kKGVudHJ5LmdldFZhbHVl\nKCkpKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuYWRkKGVudHJ5LmdldEtl\neSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\ncmVzdWx0OwogICAgfQogICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIGRl\nY2xhcmVkIHBhcmFtZXRlciBrZXlzIGluIHRoZSBnaXZlbiBxdWVyeS4KICAg\nICAqIFRoaXMgaW5mb3JtYXRpb24gaXMgb25seSBhdmFpbGFibGUgYWZ0ZXIg\ndGhlIHF1ZXJ5IGhhcyBiZWVuIHBhcnNlZC4KICAgICAqIEFzIG5hdGl2ZSBs\nYW5ndWFnZSBxdWVyaWVzIGFyZSBub3QgcGFyc2VkLCB0aGlzIGluZm9ybWF0\naW9uIGlzIG5vdCBhdmFpbGFibGUgZm9yIHRoZW0uCiAgICAgKiAgIAogICAg\nICogQHJldHVybiBzZXQgb2YgcGFyYW1ldGVyIGlkZW50aWZpZXJzIGluIGEg\ncGFyc2VkIHF1ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyBTZXQ8Pz4gZ2V0RGVj\nbGFyZWRQYXJhbWV0ZXJLZXlzKCkgewogICAgICAgIHJldHVybiBnZXREZWNs\nYXJlZFBhcmFtZXRlcnMoKS5rZXlTZXQoKTsKICAgIH0KICAgIAogICAgcHVi\nbGljIDxUPiBTZXQ8VD4gZ2V0RGVjbGFyZWRQYXJhbWV0ZXJLZXlzKENsYXNz\nPFQ+IGtleVR5cGUpIHsKICAgICAgICBTZXQ8VD4gcmVzdWx0ID0gbmV3IEhh\nc2hTZXQ8VD4oKTsKICAgICAgICBmb3IgKE9iamVjdCBrZXkgOiBnZXREZWNs\nYXJlZFBhcmFtZXRlcktleXMoKSkgewogICAgICAgICAgICBpZiAoa2V5VHlw\nZS5pc0luc3RhbmNlKGtleSkpCiAgICAgICAgICAgICAgICByZXN1bHQuYWRk\nKChUKWtleSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0aGUgcGFyYW1ldGVyIGlu\nc3RhbmNlcyBkZWNsYXJlZCBpbiB0aGlzIHF1ZXJ5LgogICAgICogQWxsIHBh\ncmFtZXRlciBrZXlzIGFyZSBvZiB0aGUgc2FtZSB0eXBlLiBJdCBpcyBub3Qg\nYWxsb3dlZCB0byBtaXgga2V5cyBvZiBkaWZmZXJlbnQgdHlwZQogICAgICog\nc3VjaCBhcyBuYW1lZCBhbmQgcG9zaXRpb25hbCBrZXlzLiAKICAgICAqIAog\nICAgICogRm9yIHN0cmluZy1iYXNlZCBxdWVyaWVzLCB0aGUgcGFyc2VyIHN1\ncHBsaWVzIHRoZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgZGVjbGFyZWQgcGFy\nYW1ldGVycwogICAgICogYXMgYSBMaW5rZWRNYXAgb2YgZXhwZWN0ZWQgcGFy\nYW1ldGVyIHZhbHVlIHR5cGUgaW5kZXhlZCBieSBwYXJhbWV0ZXIgaWRlbnRp\nZmllci4KICAgICAqIEZvciBub24gc3RyaW5nLWJhc2VkIHF1ZXJpZXMgdGhh\ndCBhIGZhY2FkZSBpdHNlbGYgbWF5IGNvbnN0cnVjdCAoZS5nLiBDcml0ZXJp\nYVF1ZXJ5KSwKICAgICAqIHRoZSBwYXJhbWV0ZXJzIG11c3QgYmUgZGVjbGFy\nZWQgYnkgdGhlIGNhbGxlci4KICAgICAqIFRoaXMgcmVjZWl2ZXIgY29uc3Ry\ndWN0cyBjb25jcmV0ZSBQYXJhbWV0ZXIgaW5zdGFuY2VzIGZyb20gdGhlIGdp\ndmVuIHBhcmFtZXRlciBpZGVudGlmaWVycy4KICAgICAqIAogICAgICogQHJl\ndHVybiBhIE1hcCB3aGVyZSB0aGUga2V5IHJlcHJlc2VudHMgdGhlIG9yaWdp\nbmFsIGlkZW50aWZpZXIgb2YgdGhlIHBhcmFtZXRlciAoY2FuIGJlIGEgU3Ry\naW5nLAogICAgICogSW50ZWdlciBvciBhIFBhcmFtZXRlckV4cHJlc3Npb24g\naXRzZWxmKSBhbmQgdGhlIHZhbHVlIGlzIHRoZSBjb25jcmV0ZSBQYXJhbWV0\nZXIgaW5zdGFuY2UKICAgICAqIGVpdGhlciBjb25zdHJ1Y3RlZCBhcyBhIHJl\nc3VsdCBvZiB0aGlzIGNhbGwgb3Igc3VwcGxpZWQgYnkgZGVjbGFyaW5nIHRo\nZSBwYXJhbWV0ZXIgZXhwbGljaXRseQogICAgICogdmlhIHtAbGlua3BsYWlu\nICNkZWNsYXJlUGFyYW1ldGVyKFBhcmFtZXRlcil9LgogICAgICovCiAgICBw\ndWJsaWMgTWFwPE9iamVjdCwgUGFyYW1ldGVyPD8+PiBnZXREZWNsYXJlZFBh\ncmFtZXRlcnMoKSB7CiAgICAgICAgaWYgKF9kZWNsYXJlZFBhcmFtcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIF9kZWNsYXJlZFBhcmFtcyA9IG5ldyBIYXNo\nTWFwPE9iamVjdCwgUGFyYW1ldGVyPD8+PigpOwogICAgICAgICAgICBPcmRl\ncmVkTWFwPE9iamVjdCxDbGFzczw/Pj4gcGFyYW1UeXBlcyA9IF9xdWVyeS5n\nZXRPcmRlcmVkUGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICAgICAgZm9yIChP\nYmplY3Qga2V5IDogcGFyYW1UeXBlcy5rZXlTZXQoKSkgewogICAgICAgICAg\nICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0gbnVsbDsKICAgICAgICAgICAg\nICAgIENsYXNzPD8+IGV4cGVjdGVkVmFsdWVUeXBlID0gcGFyYW1UeXBlcy5n\nZXQoa2V5KTsKICAgICAgICAgICAgICAgIGlmIChrZXkgaW5zdGFuY2VvZiBJ\nbnRlZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyYW0gPSBuZXcgUGFy\nYW1ldGVySW1wbCgoSW50ZWdlcilrZXksIGV4cGVjdGVkVmFsdWVUeXBlKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5IGluc3RhbmNlb2YgU3Ry\naW5nKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyYW0gPSBuZXcgUGFyYW1l\ndGVySW1wbCgoU3RyaW5nKWtleSwgZXhwZWN0ZWRWYWx1ZVR5cGUpOwogICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgaW5zdGFuY2VvZiBQYXJhbWV0\nZXIpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbSA9IChQYXJhbWV0ZXI8\nPz4pa2V5OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJw\nYXJhbWV0ZXIgaWRlbnRpZmllciAiICsga2V5ICsgIiB1bnJlY29nbml6ZWQi\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlY2xhcmVQ\nYXJhbWV0ZXIoa2V5LCBwYXJhbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIF9kZWNsYXJlZFBhcmFtczsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBEZWNsYXJlcyB0aGUgZ2l2ZW4gcGFyYW1ldGVyIGZv\nciB0aGlzIHF1ZXJ5LiAKICAgICAqIFVzZWQgYnkgbm9uLXN0cmluZyBiYXNl\nZCBxdWVyaWVzIHRoYXQgYXJlIGNvbnN0cnVjdGVkIGJ5IHRoZSBmYWNhZGUg\naXRzZWxmIHJhdGhlciB0aGFuCiAgICAgKiBPcGVuSlBBIHBhcnNpbmcgdGhl\nIHF1ZXJ5IHRvIGRldGVjdCB0aGUgZGVjbGFyZWQgcGFyYW1ldGVycy4KICAg\nICAqIAogICAgICogQHBhcmFtIGtleSB0aGlzIGlzIHRoZSBrZXkgdG8gaWRl\nbnRpZnkgdGhlIHBhcmFtZXRlciBsYXRlciBpbiB0aGUgY29udGV4dCBvZiB0\naGlzIHF1ZXJ5LgogICAgICogVmFsaWQga2V5IHR5cGVzIGFyZSBJbnRlZ2Vy\nLCBTdHJpbmcgb3IgUGFyYW1ldGVyRXhwcmVzc2lvbiBpdHNlbGYuCiAgICAg\nKiBAcGFyYW0gdGhlIHBhcmFtZXRlciBpbnN0YW5jZSB0byBiZSBkZWNsYXJl\nZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBkZWNsYXJlUGFyYW1ldGVyKE9i\namVjdCBrZXksIFBhcmFtZXRlcjw/PiBwYXJhbSkgewogICAgICAgIGlmIChf\nZGVjbGFyZWRQYXJhbXMgPT0gbnVsbCkgewogICAgICAgICAgICBfZGVjbGFy\nZWRQYXJhbXMgPSBuZXcgSGFzaE1hcDxPYmplY3QsIFBhcmFtZXRlcjw/Pj4o\nKTsKICAgICAgICB9CiAgICAgICAgX2RlY2xhcmVkUGFyYW1zLnB1dChrZXks\nIHBhcmFtKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhl\nIGdpdmVuIHBhcmFtZXRlciBpcyBib3VuZCB0byBhIHZhbHVlIGZvciB0aGlz\nIHF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0JvdW5kKFBh\ncmFtZXRlcjw/PiBwYXJhbSkgewogICAgICAgIHJldHVybiBfYm91bmRQYXJh\nbXMgIT0gbnVsbCAmJiBfYm91bmRQYXJhbXMuY29udGFpbnNLZXkocGFyYW0p\nOwogICAgfQogICAgCiAgICB2b2lkIGFzc2VydEJvdW5kKFBhcmFtZXRlcjw/\nPiBwYXJhbSkgewogICAgICAgIGlmICghaXNCb3VuZChwYXJhbSkpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgicGFyYW0tbm90LWJvdW5kIiwgcGFyYW0sIGdldFF1ZXJ5U3RyaW5n\nKCksIAogICAgICAgICAgICAgICAgICAgIGdldEJvdW5kUGFyYW1ldGVyS2V5\ncygpKS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIC8qKgog\nICAgICogQmluZHMgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBnaXZlbiBwYXJh\nbWV0ZXIuCiAgICAgKiBWYWxpZGF0ZXMgaWYgdGhlIHBhcmFtZXRlciBjYW4g\nYWNjZXB0IHRoZSB2YWx1ZSBieSBpdHMgdHlwZS4KICAgICAqLwogICAgdm9p\nZCBiaW5kVmFsdWUoUGFyYW1ldGVyPD8+IHBhcmFtLCBPYmplY3QgdmFsdWUp\nIHsKICAgICAgICBhc3NlcnRWYWx1ZUFzc2lnbmFibGUocGFyYW0sIHZhbHVl\nKTsKICAgICAgICBpZiAoX2JvdW5kUGFyYW1zID09IG51bGwpCiAgICAgICAg\nICAgIF9ib3VuZFBhcmFtcyA9IG5ldyBIYXNoTWFwPFBhcmFtZXRlcjw/Piwg\nT2JqZWN0PigpOwogICAgICAgIF9ib3VuZFBhcmFtcy5wdXQocGFyYW0sIHZh\nbHVlKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFBh\ncmFtZXRlcihTdHJpbmcgbmFtZSwgQ2FsZW5kYXIgdmFsdWUsIFRlbXBvcmFs\nVHlwZSB0eXBlKSB7CiAgICAgICAgcmV0dXJuIHNldFBhcmFtZXRlcihuYW1l\nLCBjb252ZXJ0VGVtcG9yYWxUeXBlKHZhbHVlLCB0eXBlKSk7CiAgICB9Cgog\nICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXIoU3RyaW5n\nIG5hbWUsIERhdGUgdmFsdWUsIFRlbXBvcmFsVHlwZSB0eXBlKSB7CiAgICAg\nICAgcmV0dXJuIHNldFBhcmFtZXRlcihuYW1lLCBjb252ZXJ0VGVtcG9yYWxU\neXBlKHZhbHVlLCB0eXBlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRz\nIHRoZSBwYXJhbWV0ZXIgb2YgdGhlIGdpdmVuIG5hbWUgdG8gdGhlIGdpdmVu\nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNl\ndFBhcmFtZXRlcihTdHJpbmcgbmFtZSwgT2JqZWN0IHZhbHVlKSB7CiAgICAg\nICAgX3F1ZXJ5LmFzc2VydE9wZW4oKTsKICAgICAgICBfZW0uYXNzZXJ0Tm90\nQ2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBuYXRpdmUgcXVlcmllcyBjYW4gbm90\nIGhhdmUgbmFtZWQgcGFyYW1ldGVycwogICAgICAgICAgICBpZiAoaXNOYXRp\ndmUoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmFtZWQtcGFyYW1zIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgbmFtZSwgZ2V0UXVlcnlTdHJpbmcoKSku\ndG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBiaW5kVmFsdWUoZ2V0UGFyYW1ldGVyKG5hbWUpLCB2YWx1ZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS51\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgdm9pZCBhc3NlcnRWYWx1\nZUFzc2lnbmFibGUoUGFyYW1ldGVyPD8+IHBhcmFtLCBPYmplY3Qgdikgewog\nICAgICAgIGlmICh2ID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHBhcmFt\nLmdldFBhcmFtZXRlclR5cGUoKS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9j\nLmdldCgicGFyYW0tbnVsbC1wcmltaXRpdmUiLCBwYXJhbSkuZ2V0TWVzc2Fn\nZSgpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBp\nZiAoIUZpbHRlcnMuY2FuQ29udmVydCh2LmdldENsYXNzKCksIHBhcmFtLmdl\ndFBhcmFtZXRlclR5cGUoKSwgdHJ1ZSkpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgicGFyYW0t\ndHlwZS1taXNtYXRjaCIsIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAg\nIHBhcmFtLCBnZXRRdWVyeVN0cmluZygpLCB2LCB2LmdldENsYXNzKCkuZ2V0\nTmFtZSgpLCBwYXJhbS5nZXRQYXJhbWV0ZXJUeXBlKCkuZ2V0TmFtZSgpfSku\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vID09\nPT09PT09PT09PT09PT09PSBFbmQgb2YgUGFyYW1ldGVyIFByb2Nlc3Npbmcg\ncm91dGluZXMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KfQo=\n","encoding":"base64"}

