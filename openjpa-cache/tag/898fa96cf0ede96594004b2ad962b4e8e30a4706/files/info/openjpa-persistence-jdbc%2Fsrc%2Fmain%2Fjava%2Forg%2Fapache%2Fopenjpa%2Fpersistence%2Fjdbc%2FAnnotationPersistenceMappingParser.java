{"sha":"9ca47021aacf89fb48087fe800f1ddab30d762bc","node_id":"MDQ6QmxvYjIwNjM2NDo5Y2E0NzAyMWFhY2Y4OWZiNDgwODdmZTgwMGYxZGRhYjMwZDc2MmJj","size":85270,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9ca47021aacf89fb48087fe800f1ddab30d762bc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2\nYS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuQXNzb2NpYXRpb25PdmVycmlkZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkFzc29jaWF0aW9uT3ZlcnJpZGVzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQXR0cmlidXRlT3ZlcnJpZGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5BdHRyaWJ1dGVPdmVycmlkZXM7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5Db2xsZWN0aW9uVGFibGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRGlzY3JpbWluYXRvclZhbHVlOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRW50aXR5UmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnVtZXJh\ndGVkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRSZXN1bHQ7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5jZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkpvaW5Db2x1bW47CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5Kb2luQ29sdW1uczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLkpvaW5UYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleUNv\nbHVtbjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleUVudW1lcmF0\nZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBLZXlKb2luQ29sdW1u\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwS2V5Sm9pbkNvbHVtbnM7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBLZXlUZW1wb3JhbDsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByaW1hcnlLZXlKb2luQ29sdW1uOwpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJpbWFyeUtleUpvaW5Db2x1bW5z\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU2Vjb25kYXJ5VGFibGU7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZWNvbmRhcnlUYWJsZXM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5TcWxSZXN1bHRTZXRNYXBwaW5nOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuU3FsUmVzdWx0U2V0TWFwcGluZ3M7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UYWJsZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlRhYmxlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVGVtcG9yYWw7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Vbmlx\ndWVDb25zdHJhaW50OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5n\nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5RdWFsaWZpZWREQklk\nZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVu\ndGlmaWVyLkRCSWRlbnRpZmllci5EQklkZW50aWZpZXJUeXBlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkVhZ2VyRmV0Y2hNb2Rl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5D\nbGFzc01hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5EaXNjcmltaW5hdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZ0luZm87CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLk1hcHBpbmdJbmZvOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5NYXBwaW5nUmVwb3Np\ndG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuUXVl\ncnlSZXN1bHRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5TZXF1ZW5jZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVudW1WYWx1\nZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5GbGF0Q2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZ1bGxDbGFzc1N0cmF0ZWd5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuVmVy\ndGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TY2hlbWFzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5NZXRhRGF0YUNvbnRleHQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuQW5ub3RhdGlvblBlcnNpc3RlbmNl\nTWV0YURhdGFQYXJzZXI7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLmpkYmMuTWFwcGluZ1RhZy4qOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4\nY2VwdGlvbjsKCi8qKgogKiBQZXJzaXN0ZW5jZSBhbm5vdGF0aW9uIG1hcHBp\nbmcgcGFyc2VyLgogKgogKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICogQGF1\ndGhvciBTdGV2ZSBLaW0KICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2\nYWRvYwogKi8KcHVibGljIGNsYXNzIEFubm90YXRpb25QZXJzaXN0ZW5jZU1h\ncHBpbmdQYXJzZXIKICAgIGV4dGVuZHMgQW5ub3RhdGlvblBlcnNpc3RlbmNl\nTWV0YURhdGFQYXJzZXIgewoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFRSVUUgPSAxOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQg\nRkFMU0UgPSAyOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQW5ub3Rh\ndGlvblBlcnNpc3RlbmNlTWFwcGluZ1BhcnNlci5jbGFzcyk7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgTWFwPENsYXNzPD8+LCBNYXBwaW5nVGFnPiBf\ndGFncyA9CiAgICAgICAgbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE1hcHBpbmdU\nYWc+KCk7CiAgICAKICAgIHByaXZhdGUgREJEaWN0aW9uYXJ5IF9kaWN0OyAK\nCiAgICBzdGF0aWMgewogICAgICAgIF90YWdzLnB1dChBc3NvY2lhdGlvbk92\nZXJyaWRlLmNsYXNzLCBBU1NPQ19PVkVSUklERSk7CiAgICAgICAgX3RhZ3Mu\ncHV0KEFzc29jaWF0aW9uT3ZlcnJpZGVzLmNsYXNzLCBBU1NPQ19PVkVSUklE\nRVMpOwogICAgICAgIF90YWdzLnB1dChBdHRyaWJ1dGVPdmVycmlkZS5jbGFz\ncywgQVRUUl9PVkVSUklERSk7CiAgICAgICAgX3RhZ3MucHV0KEF0dHJpYnV0\nZU92ZXJyaWRlcy5jbGFzcywgQVRUUl9PVkVSUklERVMpOwogICAgICAgIF90\nYWdzLnB1dChqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4uY2xhc3MsIENPTCk7\nCiAgICAgICAgX3RhZ3MucHV0KENvbHVtblJlc3VsdC5jbGFzcywgQ09MVU1O\nX1JFU1VMVCk7CiAgICAgICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0b3JDb2x1\nbW4uY2xhc3MsIERJU0NSSU1fQ09MKTsKICAgICAgICBfdGFncy5wdXQoRGlz\nY3JpbWluYXRvclZhbHVlLmNsYXNzLCBESVNDUklNX1ZBTCk7CiAgICAgICAg\nX3RhZ3MucHV0KEVsZW1lbnRDb2x1bW4uY2xhc3MsIEVMRU1fQ09MKTsKICAg\nICAgICBfdGFncy5wdXQoRWxlbWVudENvbHVtbnMuY2xhc3MsIEVMRU1fQ09M\nUyk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRFbWJlZGRlZE1hcHBpbmcu\nY2xhc3MsIEVMRU1fRU1CRURERURfTUFQUElORyk7CiAgICAgICAgX3RhZ3Mu\ncHV0KEVsZW1lbnRTdHJhdGVneS5jbGFzcywgRUxFTV9TVFJBVCk7CiAgICAg\nICAgX3RhZ3MucHV0KEVudGl0eVJlc3VsdC5jbGFzcywgRU5USVRZX1JFU1VM\nVCk7CiAgICAgICAgX3RhZ3MucHV0KEVudW1lcmF0ZWQuY2xhc3MsIEVOVU1F\nUkFURUQpOwogICAgICAgIF90YWdzLnB1dChGaWVsZFJlc3VsdC5jbGFzcywg\nRklFTERfUkVTVUxUKTsKICAgICAgICBfdGFncy5wdXQoSW5oZXJpdGFuY2Uu\nY2xhc3MsIElOSEVSSVRBTkNFKTsKICAgICAgICBfdGFncy5wdXQoSm9pbkNv\nbHVtbi5jbGFzcywgSk9JTl9DT0wpOwogICAgICAgIF90YWdzLnB1dChKb2lu\nQ29sdW1ucy5jbGFzcywgSk9JTl9DT0xTKTsKICAgICAgICBfdGFncy5wdXQo\nSm9pblRhYmxlLmNsYXNzLCBKT0lOX1RBQkxFKTsKICAgICAgICBfdGFncy5w\ndXQoS2V5Q29sdW1uLmNsYXNzLCBLRVlfQ09MKTsKICAgICAgICBfdGFncy5w\ndXQoS2V5Q29sdW1ucy5jbGFzcywgS0VZX0NPTFMpOwogICAgICAgIF90YWdz\nLnB1dChLZXlDbGFzc0NyaXRlcmlhLmNsYXNzLCBLRVlfQ0xBU1NfQ1JJVCk7\nCiAgICAgICAgX3RhZ3MucHV0KEtleUVtYmVkZGVkTWFwcGluZy5jbGFzcywg\nS0VZX0VNQkVEREVEX01BUFBJTkcpOwogICAgICAgIF90YWdzLnB1dChLZXlG\nb3JlaWduS2V5LmNsYXNzLCBLRVlfRkspOwogICAgICAgIF90YWdzLnB1dChL\nZXlJbmRleC5jbGFzcywgS0VZX0lOREVYKTsKICAgICAgICBfdGFncy5wdXQo\nS2V5Sm9pbkNvbHVtbi5jbGFzcywgS0VZX0pPSU5fQ09MKTsKICAgICAgICBf\ndGFncy5wdXQoS2V5Sm9pbkNvbHVtbnMuY2xhc3MsIEtFWV9KT0lOX0NPTFMp\nOwogICAgICAgIF90YWdzLnB1dChLZXlOb25wb2x5bW9ycGhpYy5jbGFzcywg\nS0VZX05PTlBPTFkpOwogICAgICAgIF90YWdzLnB1dChLZXlTdHJhdGVneS5j\nbGFzcywgS0VZX1NUUkFUKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5Q29s\ndW1uLmNsYXNzLCBNQVBfS0VZX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KE1h\ncEtleUVudW1lcmF0ZWQuY2xhc3MsIE1BUF9LRVlfRU5VTUVSQVRFRCk7CiAg\nICAgICAgX3RhZ3MucHV0KE1hcEtleUpvaW5Db2x1bW4uY2xhc3MsIE1BUF9L\nRVlfSk9JTl9DT0wpOwogICAgICAgIF90YWdzLnB1dChNYXBLZXlKb2luQ29s\ndW1ucy5jbGFzcywgTUFQX0tFWV9KT0lOX0NPTFMpOwogICAgICAgIF90YWdz\nLnB1dChNYXBLZXlUZW1wb3JhbC5jbGFzcywgTUFQX0tFWV9URU1QT1JBTCk7\nCiAgICAgICAgX3RhZ3MucHV0KFByaW1hcnlLZXlKb2luQ29sdW1uLmNsYXNz\nLCBQS19KT0lOX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFByaW1hcnlLZXlK\nb2luQ29sdW1ucy5jbGFzcywgUEtfSk9JTl9DT0xTKTsKICAgICAgICBfdGFn\ncy5wdXQoU2Vjb25kYXJ5VGFibGUuY2xhc3MsIFNFQ09OREFSWV9UQUJMRSk7\nCiAgICAgICAgX3RhZ3MucHV0KFNlY29uZGFyeVRhYmxlcy5jbGFzcywgU0VD\nT05EQVJZX1RBQkxFUyk7CiAgICAgICAgX3RhZ3MucHV0KFNxbFJlc3VsdFNl\ndE1hcHBpbmcuY2xhc3MsIFNRTF9SRVNVTFRfU0VUX01BUFBJTkcpOwogICAg\nICAgIF90YWdzLnB1dChTcWxSZXN1bHRTZXRNYXBwaW5ncy5jbGFzcywgU1FM\nX1JFU1VMVF9TRVRfTUFQUElOR1MpOwogICAgICAgIF90YWdzLnB1dChUYWJs\nZS5jbGFzcywgVEFCTEUpOwogICAgICAgIF90YWdzLnB1dChUZW1wb3JhbC5j\nbGFzcywgVEVNUE9SQUwpOwogICAgICAgIF90YWdzLnB1dChUYWJsZUdlbmVy\nYXRvci5jbGFzcywgVEFCTEVfR0VOKTsKICAgICAgICBfdGFncy5wdXQoQ2xh\nc3NDcml0ZXJpYS5jbGFzcywgQ0xBU1NfQ1JJVCk7CiAgICAgICAgX3RhZ3Mu\ncHV0KENvbHVtbnMuY2xhc3MsIENPTFMpOwogICAgICAgIF90YWdzLnB1dChD\nb250YWluZXJUYWJsZS5jbGFzcywgQ09OVEFJTkVSX1RBQkxFKTsKICAgICAg\nICBfdGFncy5wdXQoQ29sbGVjdGlvblRhYmxlLmNsYXNzLCBDT0xMRUNUSU9O\nX1RBQkxFKTsKICAgICAgICBfdGFncy5wdXQoRGF0YVN0b3JlSWRDb2x1bW4u\nY2xhc3MsIERBVEFTVE9SRV9JRF9DT0wpOwogICAgICAgIF90YWdzLnB1dChE\naXNjcmltaW5hdG9yU3RyYXRlZ3kuY2xhc3MsIERJU0NSSU1fU1RSQVQpOwog\nICAgICAgIF90YWdzLnB1dChFYWdlckZldGNoTW9kZS5jbGFzcywgRUFHRVJf\nRkVUQ0hfTU9ERSk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRDbGFzc0Ny\naXRlcmlhLmNsYXNzLCBFTEVNX0NMQVNTX0NSSVQpOwogICAgICAgIF90YWdz\nLnB1dChFbGVtZW50Rm9yZWlnbktleS5jbGFzcywgRUxFTV9GSyk7CiAgICAg\nICAgX3RhZ3MucHV0KEVsZW1lbnRJbmRleC5jbGFzcywgRUxFTV9JTkRFWCk7\nCiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRKb2luQ29sdW1uLmNsYXNzLCBF\nTEVNX0pPSU5fQ09MKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEpvaW5D\nb2x1bW5zLmNsYXNzLCBFTEVNX0pPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3Mu\ncHV0KEVsZW1lbnROb25wb2x5bW9ycGhpYy5jbGFzcywgRUxFTV9OT05QT0xZ\nKTsKICAgICAgICBfdGFncy5wdXQoRW1iZWRkZWRNYXBwaW5nLmNsYXNzLCBF\nTUJFRERFRF9NQVBQSU5HKTsKICAgICAgICBfdGFncy5wdXQoRm9yZWlnbktl\neS5jbGFzcywgRkspOwogICAgICAgIF90YWdzLnB1dChJbmRleC5jbGFzcywg\nSU5ERVgpOwogICAgICAgIF90YWdzLnB1dChNYXBwaW5nT3ZlcnJpZGUuY2xh\nc3MsIE1BUFBJTkdfT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChNYXBw\naW5nT3ZlcnJpZGVzLmNsYXNzLCBNQVBQSU5HX09WRVJSSURFUyk7CiAgICAg\nICAgX3RhZ3MucHV0KE5vbnBvbHltb3JwaGljLmNsYXNzLCBOT05QT0xZKTsK\nICAgICAgICBfdGFncy5wdXQoT3JkZXJDb2x1bW4uY2xhc3MsIE9SREVSX0NP\nTCk7CiAgICAgICAgX3RhZ3MucHV0KGphdmF4LnBlcnNpc3RlbmNlLk9yZGVy\nQ29sdW1uLmNsYXNzLCBPUkRFUl9DT0xVTU4pOwogICAgICAgIF90YWdzLnB1\ndChTdHJhdGVneS5jbGFzcywgU1RSQVQpOwogICAgICAgIF90YWdzLnB1dChT\ndWJjbGFzc0ZldGNoTW9kZS5jbGFzcywgU1VCQ0xBU1NfRkVUQ0hfTU9ERSk7\nCiAgICAgICAgX3RhZ3MucHV0KFVuaXF1ZS5jbGFzcywgVU5JUVVFKTsKICAg\nICAgICBfdGFncy5wdXQoVmVyc2lvbkNvbHVtbi5jbGFzcywgVkVSU0lPTl9D\nT0wpOwogICAgICAgIF90YWdzLnB1dChWZXJzaW9uQ29sdW1ucy5jbGFzcywg\nVkVSU0lPTl9DT0xTKTsKICAgICAgICBfdGFncy5wdXQoVmVyc2lvblN0cmF0\nZWd5LmNsYXNzLCBWRVJTSU9OX1NUUkFUKTsKICAgICAgICBfdGFncy5wdXQo\nWEVtYmVkZGVkTWFwcGluZy5jbGFzcywgWF9FTUJFRERFRF9NQVBQSU5HKTsK\nICAgICAgICBfdGFncy5wdXQoWEpvaW5Db2x1bW4uY2xhc3MsIFhfSk9JTl9D\nT0wpOwogICAgICAgIF90YWdzLnB1dChYSm9pbkNvbHVtbnMuY2xhc3MsIFhf\nSk9JTl9DT0xTKTsKICAgICAgICBfdGFncy5wdXQoWE1hcHBpbmdPdmVycmlk\nZS5jbGFzcywgWF9NQVBQSU5HX09WRVJSSURFKTsKICAgICAgICBfdGFncy5w\ndXQoWE1hcHBpbmdPdmVycmlkZXMuY2xhc3MsIFhfTUFQUElOR19PVkVSUklE\nRVMpOwogICAgICAgIF90YWdzLnB1dChYU2Vjb25kYXJ5VGFibGUuY2xhc3Ms\nIFhfU0VDT05EQVJZX1RBQkxFKTsKICAgICAgICBfdGFncy5wdXQoWFNlY29u\nZGFyeVRhYmxlcy5jbGFzcywgWF9TRUNPTkRBUllfVEFCTEVTKTsKICAgICAg\nICBfdGFncy5wdXQoWFRhYmxlLmNsYXNzLCBYX1RBQkxFKTsKICAgIH0KCiAg\nICBwdWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWFwcGluZ1BhcnNlcihK\nREJDQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgc3VwZXIoY29uZik7\nCiAgICAgICAgX2RpY3QgPSBjb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNl\nKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBw\nYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3RhdGlvbnMoUGFja2FnZSBwa2cpIHsK\nICAgICAgICBNYXBwaW5nVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90YXRp\nb24gYW5ubyA6IHBrZy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAg\nICAgICAgICAgdGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUo\nKSk7CiAgICAgICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgaGFuZGxlVW5rbm93blBhY2thZ2VNYXBwaW5nQW5ub3RhdGlvbihw\na2csIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZVRhYmxlR2VuZXJhdG9yKHBrZywgKFRhYmxlR2VuZXJhdG9yKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIHBrZywKICAg\nICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxv\ndyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duUGFj\na2FnZU1hcHBpbmdBbm5vdGF0aW9uKFBhY2thZ2UgcGtnLAogICAgICAgIEFu\nbm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIEBUYWJsZUdlbmVyYXRvci4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVGFibGVHZW5lcmF0b3IoQW5ub3Rh\ndGVkRWxlbWVudCBlbCwgVGFibGVHZW5lcmF0b3IgZ2VuKSB7CiAgICAgICAg\nU3RyaW5nIG5hbWUgPSBnZW4ubmFtZSgpOwogICAgICAgIGlmIChTdHJpbmdV\ndGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWdlbi1uYW1lIiwgZWwpKTsK\nCiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJwYXJzZS1nZW4iLCBuYW1lKSk7CgogICAgICAgIFNlcXVlbmNlTWFw\ncGluZyBtZXRhID0gKFNlcXVlbmNlTWFwcGluZykgZ2V0UmVwb3NpdG9yeSgp\nLgogICAgICAgICAgICBnZXRDYWNoZWRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUp\nOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2Fy\nbihfbG9jLmdldCgiZHVwLWdlbiIsIG5hbWUsIGVsKSk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1ldGEgPSAoU2VxdWVuY2VN\nYXBwaW5nKSBnZXRSZXBvc2l0b3J5KCkuYWRkU2VxdWVuY2VNZXRhRGF0YShu\nYW1lKTsKICAgICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2luKFNlcXVlbmNl\nTWFwcGluZy5JTVBMX1ZBTFVFX1RBQkxFKTsKICAgICAgICBtZXRhLnNldFRh\nYmxlSWRlbnRpZmllcih0b1RhYmxlSWRlbnRpZmllcihnZW4uc2NoZW1hKCks\nIGdlbi50YWJsZSgpKSk7CiAgICAgICAgbWV0YS5zZXRQcmltYXJ5S2V5Q29s\ndW1uSWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uKGdlbi5wa0Nv\nbHVtbk5hbWUoKSwgZGVsaW1pdCgpKSk7CiAgICAgICAgbWV0YS5zZXRTZXF1\nZW5jZUNvbHVtbklkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbihn\nZW4udmFsdWVDb2x1bW5OYW1lKCksZGVsaW1pdCgpKSk7CiAgICAgICAgbWV0\nYS5zZXRQcmltYXJ5S2V5VmFsdWUoZ2VuLnBrQ29sdW1uVmFsdWUoKSk7CiAg\nICAgICAgbWV0YS5zZXRJbml0aWFsVmFsdWUoZ2VuLmluaXRpYWxWYWx1ZSgp\nKTsKICAgICAgICBtZXRhLnNldEFsbG9jYXRlKGdlbi5hbGxvY2F0aW9uU2l6\nZSgpKTsKICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCks\nIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAg\nICAgbWV0YS5TUkNfQU5OT1RBVElPTlMpOwogICAgICAgIAogICAgICAgIHN3\naXRjaCAoZ2VuLnVuaXF1ZUNvbnN0cmFpbnRzKCkubGVuZ3RoKSB7CiAgICAg\nICAgY2FzZSAwOiAKICAgICAgICAJYnJlYWs7IC8vIG5vdGhpbmcgdG8gZG8K\nICAgICAgICBjYXNlIDE6IAogICAgICAgIAltZXRhLnNldFVuaXF1ZUNvbHVt\nbnNJZGVudGlmaWVyKERCSWRlbnRpZmllci50b0FycmF5KGdlbi51bmlxdWVD\nb25zdHJhaW50cygpWzBdLmNvbHVtbk5hbWVzKCksIAogICAgICAgIAkgICAg\nREJJZGVudGlmaWVyVHlwZS5DT0xVTU4sIGRlbGltaXQoKSkpOwogICAgICAg\nIAltZXRhLnNldFVuaXF1ZUNvbnN0cmFpbnRJZGVudGlmaWVyKERCSWRlbnRp\nZmllci5uZXdDb25zdHJhaW50KGdlbi51bmlxdWVDb25zdHJhaW50cygpWzBd\nLm5hbWUoKSwgCiAgICAgICAgCSAgICBkZWxpbWl0KCkpKTsKICAgICAgICAJ\nYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAJbG9nLndhcm4oX2xv\nYy5nZXQoInVuaXF1ZS1tYW55LW9uLXNlcS11bnN1cHBvcnRlZCIsIGVsLCBu\nYW1lKSk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJv\ndGVjdGVkIHZvaWQgcGFyc2VDbGFzc01hcHBpbmdBbm5vdGF0aW9ucyhDbGFz\nc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBDbGFzc01hcHBpbmcgY20gPSAo\nQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAgICAgIENsYXNzPD8+IGNscyA9IGNt\nLmdldERlc2NyaWJlZFR5cGUoKTsKCiAgICAgICAgTWFwcGluZ1RhZyB0YWc7\nCiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBjbHMuZ2V0RGVjbGFy\nZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdl\ndChhbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFn\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25DbGFz\nc01hcHBpbmdBbm5vdGF0aW9uKGNtLCBhbm5vKTsKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2gg\nKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBBU1NPQ19PVkVSUklERToK\nICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVz\nKGNtLCAoQXNzb2NpYXRpb25PdmVycmlkZSkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFTU09DX09W\nRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0aW9u\nT3ZlcnJpZGVzKGNtLCAoKEFzc29jaWF0aW9uT3ZlcnJpZGVzKSBhbm5vKS4K\nICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFUVFJfT1ZF\nUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBdHRyaWJ1dGVPdmVy\ncmlkZXMoY20sIChBdHRyaWJ1dGVPdmVycmlkZSkgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFUVFJf\nT1ZFUlJJREVTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQXR0cmlidXRl\nT3ZlcnJpZGVzKGNtLCAoKEF0dHJpYnV0ZU92ZXJyaWRlcykgYW5ubykuCiAg\nICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBESVNDUklNX0NP\nTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZURpc2NyaW1pbmF0b3JDb2x1\nbW4oY20sIChEaXNjcmltaW5hdG9yQ29sdW1uKSBhbm5vKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRElTQ1JJ\nTV9WQUw6CiAgICAgICAgICAgICAgICAgICAgY20uZ2V0RGlzY3JpbWluYXRv\ncigpLmdldE1hcHBpbmdJbmZvKCkuc2V0VmFsdWUKICAgICAgICAgICAgICAg\nICAgICAgICAgKCgoRGlzY3JpbWluYXRvclZhbHVlKSBhbm5vKS52YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNBYnN0cmFj\ndChjbS5nZXREZXNjcmliZWRUeXBlKCkuCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBnZXRNb2RpZmllcnMoKSkgJiYgZ2V0TG9nKCkuaXNJbmZvRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdldExvZygpLmlu\nZm8oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiZGlz\nY3JpbWluYXRvci1vbi1hYnN0cmFjdC1jbGFzcyIsIGNtCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXREZXNjcmliZWRUeXBlKCku\nZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJTkhFUklU\nQU5DRToKICAgICAgICAgICAgICAgICAgICBwYXJzZUluaGVyaXRhbmNlKGNt\nLCAoSW5oZXJpdGFuY2UpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQS19KT0lOX0NPTDoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhjbSwg\nKFByaW1hcnlLZXlKb2luQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEtfSk9JTl9DT0xT\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1\nbW5zKGNtLAogICAgICAgICAgICAgICAgICAgICAgICAoKFByaW1hcnlLZXlK\nb2luQ29sdW1ucykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgU0VDT05EQVJZX1RBQkxFOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlU2Vjb25kYXJ5VGFibGVzKGNtLCAoU2Vjb25kYXJ5VGFi\nbGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBTRUNPTkRBUllfVEFCTEVTOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlU2Vjb25kYXJ5VGFibGVzKGNtLCAoKFNlY29uZGFyeVRh\nYmxlcykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNRTF9SRVNVTFRfU0VUX01BUFBJ\nTkc6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VTUUxSZXN1bHRTZXRNYXBw\naW5ncyhjbSwgKFNxbFJlc3VsdFNldE1hcHBpbmcpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTUUxf\nUkVTVUxUX1NFVF9NQVBQSU5HUzoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZVNRTFJlc3VsdFNldE1hcHBpbmdzKGNtLCAoKFNxbFJlc3VsdFNldE1hcHBp\nbmdzKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVGFibGUoY20s\nIChUYWJsZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZVRhYmxlR2VuZXJhdG9yKGNscywgKFRhYmxlR2VuZXJhdG9y\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgREFUQVNUT1JFX0lEX0NPTDoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZURhdGFTdG9yZUlkQ29sdW1uKGNtLCAoRGF0YVN0b3JlSWRD\nb2x1bW4pIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBESVNDUklNX1NUUkFUOgogICAgICAgICAgICAg\nICAgICAgIGNtLmdldERpc2NyaW1pbmF0b3IoKS5nZXRNYXBwaW5nSW5mbygp\nLnNldFN0cmF0ZWd5CiAgICAgICAgICAgICAgICAgICAgICAgICgoKERpc2Ny\naW1pbmF0b3JTdHJhdGVneSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZLOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlRm9yZWlnbktleShjbS5nZXRNYXBwaW5n\nSW5mbygpLCAoRm9yZWlnbktleSkgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE1BUFBJTkdfT1ZFUlJJ\nREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBwaW5nT3ZlcnJpZGVz\nKGNtLCAoTWFwcGluZ092ZXJyaWRlKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQUElOR19PVkVS\nUklERVM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBwaW5nT3ZlcnJp\nZGVzKGNtLAogICAgICAgICAgICAgICAgICAgICAgICAoKE1hcHBpbmdPdmVy\ncmlkZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVFJBVDoKICAgICAgICAgICAg\nICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNldFN0cmF0ZWd5KCgoU3Ry\nYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVUJDTEFTU19GRVRDSF9NT0RF\nOgogICAgICAgICAgICAgICAgICAgIGNtLnNldFN1YmNsYXNzRmV0Y2hNb2Rl\nKHRvRWFnZXJGZXRjaE1vZGVDb25zdGFudAogICAgICAgICAgICAgICAgICAg\nICAgICAoKChTdWJjbGFzc0ZldGNoTW9kZSkgYW5ubykudmFsdWUoKSkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBWRVJTSU9OX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVZlcnNp\nb25Db2x1bW5zKGNtLCAoVmVyc2lvbkNvbHVtbikgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFZFUlNJ\nT05fQ09MUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZVZlcnNpb25Db2x1\nbW5zKGNtLCAoKFZlcnNpb25Db2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nVkVSU0lPTl9TVFJBVDoKICAgICAgICAgICAgICAgICAgICBjbS5nZXRWZXJz\naW9uKCkuZ2V0TWFwcGluZ0luZm8oKS5zZXRTdHJhdGVneQogICAgICAgICAg\nICAgICAgICAgICAgICAoKChWZXJzaW9uU3RyYXRlZ3kpIGFubm8pLnZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBYX01BUFBJTkdfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VNYXBwaW5nT3ZlcnJpZGVzKGNtLCAoWE1hcHBpbmdPdmVycmlk\nZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFhfTUFQUElOR19PVkVSUklERVM6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VNYXBwaW5nT3ZlcnJpZGVzKGNtLAogICAgICAgICAg\nICAgICAgICAgICAgICAoKFhNYXBwaW5nT3ZlcnJpZGVzKSBhbm5vKS52YWx1\nZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgWF9UQUJMRToKICAgICAgICAgICAgICAgIGNhc2UgWF9TRUNP\nTkRBUllfVEFCTEU6CiAgICAgICAgICAgICAgICBjYXNlIFhfU0VDT05EQVJZ\nX1RBQkxFUzoKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhazsgbm90\nIHN1cHBvcnRlZCB5ZXQKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIGNtLAogICAgICAgICAgICAgICAg\nICAgICAgICBhbm5vKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1\nbmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBoYW5kbGVVbmtub3duQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbihDbGFz\nc01hcHBpbmcgY2xzLAogICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBBc3NvY2lhdGlvbk92ZXJyaWRlKHMpLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRlcyhDbGFzc01hcHBpbmcg\nY20sCiAgICAgICAgQXNzb2NpYXRpb25PdmVycmlkZS4uLiBhc3NvY3MpIHsK\nICAgICAgICBGaWVsZE1hcHBpbmcgc3VwOwogICAgICAgIEpvaW5Db2x1bW5b\nXSBzY29sczsKICAgICAgICBpbnQgdW5pcXVlOwogICAgICAgIExpc3Q8Q29s\ndW1uPiBqY29sczsKICAgICAgICBKb2luVGFibGUgam9pblRibDsKICAgICAg\nICBmb3IgKEFzc29jaWF0aW9uT3ZlcnJpZGUgYXNzb2MgOiBhc3NvY3MpIHsK\nICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoYXNzb2MubmFt\nZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tb3ZlcnJpZGUtbmFtZSIsIGNtKSk7CiAgICAg\nICAgICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRTdXBl\ncmNsYXNzRmllbGQoYXNzb2MubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1\ncCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGlu\nZykgY20uYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZAogICAgICAgICAgICAg\nICAgICAgIChhc3NvYy5uYW1lKCksIE9iamVjdC5jbGFzcywgT2JqZWN0LmNs\nYXNzKTsKICAgICAgICAgICAgc2NvbHMgPSBhc3NvYy5qb2luQ29sdW1ucygp\nOwogICAgICAgICAgICBqb2luVGJsID0gYXNzb2Muam9pblRhYmxlKCk7CiAg\nICAgICAgICAgIGlmICgoc2NvbHMgPT0gbnVsbCB8fCBzY29scy5sZW5ndGgg\nPT0gMCkgJiYgam9pblRibCA9PSBudWxsKQogICAgICAgICAgICAgICAgLy9j\nb250aW51ZTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIHN1cCwgYXNzb2MubmFtZSgpKSk7CgogICAg\nICAgICAgICBpZiAoc2NvbHMgIT0gbnVsbCAmJiBzY29scy5sZW5ndGggPiAw\nKSB7CiAgICAgICAgICAgICAgICBqY29scyA9IG5ldyBBcnJheUxpc3Q8Q29s\ndW1uPihzY29scy5sZW5ndGgpOwogICAgICAgICAgICAgICAgdW5pcXVlID0g\nMDsKICAgICAgICAgICAgICAgIGZvciAoSm9pbkNvbHVtbiBzY29sIDogc2Nv\nbHMpIHsKICAgICAgICAgICAgICAgICAgICB1bmlxdWUgfD0gKHNjb2wudW5p\ncXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAgICAgICAgICAgICAgIGpj\nb2xzLmFkZChuZXdDb2x1bW4oc2NvbCkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgc2V0Q29sdW1ucyhzdXAsIHN1cC5nZXRWYWx1ZUlu\nZm8oKSwgamNvbHMsIHVuaXF1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\nam9pblRibCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBwYXJzZUpvaW5U\nYWJsZShzdXAsIGpvaW5UYmwpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEF0dHJpYnV0ZU92ZXJyaWRl\nKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VBdHRyaWJ1dGVP\ndmVycmlkZXMoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIEF0dHJpYnV0ZU92\nZXJyaWRlLi4uIGF0dHJzKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIHN1cDsK\nICAgICAgICBmb3IgKEF0dHJpYnV0ZU92ZXJyaWRlIGF0dHIgOiBhdHRycykg\newogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShhdHRyLm5h\nbWUoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLW92ZXJyaWRlLW5hbWUiLCBjbSkpOwogICAg\nICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5nZXREZWZpbmVkU3Vw\nZXJjbGFzc0ZpZWxkKGF0dHIubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1\ncCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGlu\nZykgY20uYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChhdHRyLm5hbWUoKSwK\nICAgICAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFz\ncyk7CiAgICAgICAgICAgIGlmIChhdHRyLmNvbHVtbigpICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBwYXJzZUNvbHVtbnMoc3VwLCBhdHRyLmNvbHVtbigp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBpbmhl\ncml0YW5jZSBAUHJpbWFyeUtleUpvaW5Db2x1bW4ocykuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhDbGFz\nc01hcHBpbmcgY20sCiAgICAgICAgUHJpbWFyeUtleUpvaW5Db2x1bW4uLi4g\nam9pbnMpIHsKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJh\neUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAgIGZvciAoUHJp\nbWFyeUtleUpvaW5Db2x1bW4gam9pbiA6IGpvaW5zKQogICAgICAgICAgICBj\nb2xzLmFkZChuZXdDb2x1bW4oam9pbikpOwogICAgICAgIGNtLmdldE1hcHBp\nbmdJbmZvKCkuc2V0Q29sdW1ucyhjb2xzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRp\nb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJp\ndmF0ZSBDb2x1bW4gbmV3Q29sdW1uKFByaW1hcnlLZXlKb2luQ29sdW1uIGpv\naW4pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAg\nICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1BLX0pPSU4sIHRydWUpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5u\nZXdDb2x1bW4oam9pbi5uYW1lKCksIGRlbGltaXQoKSkpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24o\nKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlSWRlbnRpZmllcihEQklkZW50\naWZpZXIubmV3Q29sdW1uRGVmaW5pdGlvbihqb2luLmNvbHVtbkRlZmluaXRp\nb24oKSkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2lu\nLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0\nVGFyZ2V0SWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uKGpvaW4u\ncmVmZXJlbmNlZENvbHVtbk5hbWUoKSwgZGVsaW1pdCgpKSk7CiAgICAgICAg\ncmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBTZWNv\nbmRhcnlUYWJsZShzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nU2Vjb25kYXJ5VGFibGVzKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBTZWNv\nbmRhcnlUYWJsZS4uLiB0YWJsZXMpIHsKICAgICAgICBDbGFzc01hcHBpbmdJ\nbmZvIGluZm8gPSBjbS5nZXRNYXBwaW5nSW5mbygpOwoKICAgICAgICBMaXN0\nPENvbHVtbj4gam9pbnMgPSBudWxsOwogICAgICAgIGZvciAoU2Vjb25kYXJ5\nVGFibGUgdGFibGUgOiB0YWJsZXMpIHsKICAgICAgICAgICAgREJJZGVudGlm\naWVyIHNOYW1lID0gREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlLm5hbWUo\nKSwgZGVsaW1pdCgpKTsKICAgICAgICAgICAgaWYgKERCSWRlbnRpZmllci5p\nc0VtcHR5KHNOYW1lKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgic2Vjb25kLW5hbWUiLCBjbSkpOwog\nICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkodGFibGUuc2No\nZW1hKCkpKSB7CiAgICAgICAgICAgICAgICBEQklkZW50aWZpZXIgc1NjaGVt\nYSA9IERCSWRlbnRpZmllci5uZXdTY2hlbWEodGFibGUuc2NoZW1hKCksIGRl\nbGltaXQoKSk7CiAgICAgICAgICAgICAgICBzTmFtZSA9IFF1YWxpZmllZERC\nSWRlbnRpZmllci5uZXdQYXRoKHNTY2hlbWEsIHNOYW1lKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAodGFibGUucGtKb2luQ29sdW1ucygpLmxl\nbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3IEFycmF5\nTGlzdDxDb2x1bW4+KHRhYmxlLnBrSm9pbkNvbHVtbnMoKS5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgZm9yIChQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2lu\nIDogdGFibGUucGtKb2luQ29sdW1ucygpKQogICAgICAgICAgICAgICAgICAg\nIGpvaW5zLmFkZChuZXdDb2x1bW4oam9pbikpOwogICAgICAgICAgICAgICAg\naW5mby5zZXRTZWNvbmRhcnlUYWJsZUpvaW5Db2x1bW5zKHNOYW1lLCBqb2lu\ncyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIAlpbmZvLmFk\nZFNlY29uZGFyeVRhYmxlKHNOYW1lKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBhZGRVbmlxdWVDb25zdHJhaW50cyhzTmFtZS5nZXROYW1lKCksIGNt\nLCBpbmZvLCB0YWJsZS51bmlxdWVDb25zdHJhaW50cygpKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgY2xhc3MgdGFibGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVRhYmxlKENsYXNzTWFwcGluZyBj\nbSwgVGFibGUgdGFibGUpIHsKICAgICAgICBpZiAoY20uaXNBYnN0cmFjdCgp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgidGFibGUtbm90LWFsbG93ZWQiLCBjbSkpOwogICAgICAgIERCSWRlbnRp\nZmllciB0TmFtZSA9IHRvVGFibGVJZGVudGlmaWVyKHRhYmxlLnNjaGVtYSgp\nLCB0YWJsZS5uYW1lKCkpOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlz\nTnVsbCh0TmFtZSkpIHsKICAgICAgICAgICAgY20uZ2V0TWFwcGluZ0luZm8o\nKS5zZXRUYWJsZUlkZW50aWZpZXIodE5hbWUpOwogICAgICAgIH0KICAgICAg\nICBhZGRVbmlxdWVDb25zdHJhaW50cyh0TmFtZS5nZXROYW1lKCksIGNtLCBj\nbS5nZXRNYXBwaW5nSW5mbygpLAogICAgICAgICAgICB0YWJsZS51bmlxdWVD\nb25zdHJhaW50cygpKTsKICAgIH0KICAgIAogICAgVW5pcXVlIGNyZWF0ZVVu\naXF1ZUNvbnN0cmFpbnQoTWV0YURhdGFDb250ZXh0IGN0eCwgVW5pcXVlQ29u\nc3RyYWludCBhbm5vKSB7CiAgICAgICAgU3RyaW5nW10gY29sdW1uTmFtZXMg\nPSBhbm5vLmNvbHVtbk5hbWVzKCk7CiAgICAgICAgaWYgKGNvbHVtbk5hbWVz\nID09IG51bGwgfHwgY29sdW1uTmFtZXMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bmlxdWUt\nbm8tY29sdW1uIiwgY3R4KSk7CiAgICAgICAgREJJZGVudGlmaWVyW10gc0Nv\nbE5hbWVzID0gREJJZGVudGlmaWVyLnRvQXJyYXkoY29sdW1uTmFtZXMsREJJ\nZGVudGlmaWVyVHlwZS5DT0xVTU4sIGRlbGltaXQoKSk7CiAgICAgICAgVW5p\ncXVlIHVuaXF1ZUNvbnN0cmFpbnQgPSBuZXcgVW5pcXVlKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzQ29sTmFtZXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKERCSWRlbnRpZmllci5pc0VtcHR5KHNDb2xOYW1l\nc1tpXSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgidW5pcXVlLWVtcHR5LWNvbHVtbiIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIEFycmF5cy50b1N0cmluZyhzQ29sTmFtZXMpLCBjdHgp\nKTsKICAgICAgICAgICAgQ29sdW1uIGNvbHVtbiA9IG5ldyBDb2x1bW4oKTsK\nICAgICAgICAgICAgY29sdW1uLnNldElkZW50aWZpZXIoc0NvbE5hbWVzW2ld\nKTsKICAgICAgICAgICAgdW5pcXVlQ29uc3RyYWludC5hZGRDb2x1bW4oY29s\ndW1uKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGFubm8ubmFtZSgpKSkgewogICAgICAgICAgICB1bmlxdWVDb25zdHJh\naW50LnNldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbnN0cmFpbnQo\nYW5uby5uYW1lKCksIGRlbGltaXQoKSkpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gdW5pcXVlQ29uc3RyYWludDsKICAgIH0KICAgIAogICAgdm9pZCBh\nZGRVbmlxdWVDb25zdHJhaW50cyhTdHJpbmcgdGFibGUsIE1ldGFEYXRhQ29u\ndGV4dCBjdHgsCiAgICAgICAgTWFwcGluZ0luZm8gaW5mbywgVW5pcXVlQ29u\nc3RyYWludC4uLiB1bmlxdWVDb25zdHJhaW50cykgewogICAgICAgIGZvciAo\nVW5pcXVlQ29uc3RyYWludCBhbm5vIDogdW5pcXVlQ29uc3RyYWludHMpIHsK\nICAgICAgICAgICAgVW5pcXVlIHVuaXF1ZSA9IGNyZWF0ZVVuaXF1ZUNvbnN0\ncmFpbnQoY3R4LCBhbm5vKTsKICAgICAgICAgICAgdW5pcXVlLnNldFRhYmxl\nSWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3VGFibGUodGFibGUsIGRlbGlt\naXQoKSkpOwogICAgICAgICAgICBpZiAoaW5mbyBpbnN0YW5jZW9mIENsYXNz\nTWFwcGluZ0luZm8pCiAgICAgICAgICAgICAgICAoKENsYXNzTWFwcGluZ0lu\nZm8pIGluZm8pLmFkZFVuaXF1ZSh0YWJsZSwgdW5pcXVlKTsKICAgICAgICAg\nICAgZWxzZSBpZiAoaW5mbyBpbnN0YW5jZW9mIEZpZWxkTWFwcGluZ0luZm8p\nCiAgICAgICAgICAgICAgICAoKEZpZWxkTWFwcGluZ0luZm8pIGluZm8pLmFk\nZEpvaW5UYWJsZVVuaXF1ZSh1bmlxdWUpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JtIGEgcXVhbGlm\naWVkIHRhYmxlIG5hbWUgZnJvbSBhIHNjaGVtYSBhbmQgdGFibGUgbmFtZS4K\nICAgICAqLwogICAgcHJpdmF0ZSBEQklkZW50aWZpZXIgdG9UYWJsZUlkZW50\naWZpZXIoU3RyaW5nIHNjaGVtYSwgU3RyaW5nIHRhYmxlKSB7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkodGFibGUpKSB7CiAgICAgICAgICAg\nIHJldHVybiBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICB9CiAgICAgICAg\nREJJZGVudGlmaWVyIHROYW1lID0gREJJZGVudGlmaWVyLm5ld1RhYmxlKHRh\nYmxlLCBkZWxpbWl0KCkpOwogICAgICAgIERCSWRlbnRpZmllciBzTmFtZSA9\nIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hLCBkZWxpbWl0KCkpOwog\nICAgICAgIGlmIChEQklkZW50aWZpZXIuaXNFbXB0eSh0TmFtZSkgfHwgREJJ\nZGVudGlmaWVyLmlzRW1wdHkoc05hbWUpKSB7CiAgICAgICAgICAgIHJldHVy\nbiB0TmFtZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFF1YWxpZmllZERC\nSWRlbnRpZmllci5uZXdQYXRoKHNOYW1lLCB0TmFtZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZXMgdGhlIGdpdmVuIGFubm90YXRpb24gdG8gY3Jl\nYXRlIGFuZCBjYWNoZSBhCiAgICAgKiB7QGxpbmsgU1FMUmVzdWx0U2V0TWFw\ncGluZ01ldGFEYXRhfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nU1FMUmVzdWx0U2V0TWFwcGluZ3MoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAg\nIFNxbFJlc3VsdFNldE1hcHBpbmcuLi4gYW5ub3MpIHsKICAgICAgICBNYXBw\naW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgZ2V0\nUmVwb3NpdG9yeSgpOwogICAgICAgIExvZyBsb2cgPSBnZXRMb2coKTsKICAg\nICAgICBmb3IgKFNxbFJlc3VsdFNldE1hcHBpbmcgYW5ubyA6IGFubm9zKSB7\nCiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgicGFyc2Utc3FscnNtYXBw\naW5nIiwgYW5uby5uYW1lKCkpKTsKCiAgICAgICAgICAgIFF1ZXJ5UmVzdWx0\nTWFwcGluZyByZXN1bHQgPSByZXBvcy5nZXRDYWNoZWRRdWVyeVJlc3VsdE1h\ncHBpbmcKICAgICAgICAgICAgICAgIChudWxsLCBhbm5vLm5hbWUoKSk7CiAg\nICAgICAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgbG9nLndhcm4oX2xvYy5nZXQoImR1cC1zcWxyc21hcHBpbmciLCBhbm5v\nLm5hbWUoKSwgY20pKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICByZXN1bHQgPSByZXBvcy5hZGRRdWVy\neVJlc3VsdE1hcHBpbmcobnVsbCwgYW5uby5uYW1lKCkpOwogICAgICAgICAg\nICByZXN1bHQuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgY20uZ2V0RGVz\nY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgcmVzdWx0LlNSQ19BTk5P\nVEFUSU9OUyk7CgogICAgICAgICAgICBmb3IgKEVudGl0eVJlc3VsdCBlbnRp\ndHkgOiBhbm5vLmVudGl0aWVzKCkpIHsKICAgICAgICAgICAgICAgIFF1ZXJ5\nUmVzdWx0TWFwcGluZy5QQ1Jlc3VsdCBlbnRpdHlSZXN1bHQgPSByZXN1bHQu\nYWRkUENSZXN1bHQKICAgICAgICAgICAgICAgICAgICAoZW50aXR5LmVudGl0\neUNsYXNzKCkpOwogICAgICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5p\nc0VtcHR5KGVudGl0eS5kaXNjcmltaW5hdG9yQ29sdW1uKCkpKQogICAgICAg\nICAgICAgICAgICAgIGVudGl0eVJlc3VsdC5hZGRNYXBwaW5nKGVudGl0eVJl\nc3VsdC5ESVNDUklNSU5BVE9SLAogICAgICAgICAgICAgICAgICAgICAgICBl\nbnRpdHkuZGlzY3JpbWluYXRvckNvbHVtbigpKTsKCiAgICAgICAgICAgICAg\nICBmb3IgKEZpZWxkUmVzdWx0IGZpZWxkIDogZW50aXR5LmZpZWxkcygpKSB7\nCiAgICAgICAgICAgICAgICAgICAgREJJZGVudGlmaWVyIHNDb2xOYW1lID0g\nREJJZGVudGlmaWVyLm5ld0NvbHVtbihmaWVsZC5jb2x1bW4oKSwgZGVsaW1p\ndCgpKTsKICAgICAgICAgICAgICAgICAgICBlbnRpdHlSZXN1bHQuYWRkTWFw\ncGluZyhmaWVsZC5uYW1lKCksIHNDb2xOYW1lLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChD\nb2x1bW5SZXN1bHQgY29sdW1uIDogYW5uby5jb2x1bW5zKCkpIHsKICAgICAg\nICAgICAgICAgIERCSWRlbnRpZmllciBzTmFtZSA9IERCSWRlbnRpZmllci5u\nZXdDb2x1bW4oY29sdW1uLm5hbWUoKSwgZGVsaW1pdCgpKTsKICAgICAgICAg\nICAgICAgIHJlc3VsdC5hZGRDb2x1bW5SZXN1bHQoc05hbWUuZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBEaXNjcmltaW5hdG9yQ29sdW1uLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VEaXNjcmltaW5hdG9yQ29sdW1uKENsYXNzTWFw\ncGluZyBjbSwKICAgICAgICBEaXNjcmltaW5hdG9yQ29sdW1uIGRjb2wpIHsK\nICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShkY29sLm5hbWUoKSkpIHsKICAgICAg\nICAgICAgY29sLnNldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVt\nbihkY29sLm5hbWUoKSxkZWxpbWl0KCkpKTsKICAgICAgICB9CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGRjb2wuY29sdW1uRGVmaW5pdGlv\nbigpKSkgewogICAgICAgICAgICBjb2wuc2V0VHlwZUlkZW50aWZpZXIoREJJ\nZGVudGlmaWVyLm5ld0NvbHVtbkRlZmluaXRpb24oZGNvbC5jb2x1bW5EZWZp\nbml0aW9uKCkpKTsKICAgICAgICB9CiAgICAgICAgRGlzY3JpbWluYXRvciBk\naXNjcmltID0gY20uZ2V0RGlzY3JpbWluYXRvcigpOwogICAgICAgIHN3aXRj\naCAoZGNvbC5kaXNjcmltaW5hdG9yVHlwZSgpKSB7CiAgICAgICAgICAgIGNh\nc2UgQ0hBUjoKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShKYXZh\nVHlwZXMuQ0hBUik7CiAgICAgICAgICAgICAgICBkaXNjcmltLnNldEphdmFU\neXBlKEphdmFUeXBlcy5DSEFSKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIElOVEVHRVI6CiAgICAgICAgICAgICAgICBjb2wu\nc2V0SmF2YVR5cGUoSmF2YVR5cGVzLklOVCk7CiAgICAgICAgICAgICAgICBp\nZiAoZGNvbC5sZW5ndGgoKSAhPSAzMSkKICAgICAgICAgICAgICAgICAgICBj\nb2wuc2V0U2l6ZShkY29sLmxlbmd0aCgpKTsKICAgICAgICAgICAgICAgIGRp\nc2NyaW0uc2V0SmF2YVR5cGUoSmF2YVR5cGVzLklOVCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIGNvbC5zZXRKYXZhVHlwZShKYXZhVHlwZXMuU1RSSU5HKTsKICAgICAg\nICAgICAgICAgIGNvbC5zZXRTaXplKGRjb2wubGVuZ3RoKCkpOwogICAgICAg\nICAgICAgICAgZGlzY3JpbS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuU1RSSU5H\nKTsKICAgICAgICB9CiAgICAgICAgY20uZ2V0RGlzY3JpbWluYXRvcigpLmdl\ndE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucwogICAgICAgICAgICAoQXJyYXlz\nLmFzTGlzdChuZXcgQ29sdW1uW117IGNvbCB9KSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBASW5oZXJpdGFuY2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZUluaGVyaXRhbmNlKENsYXNzTWFwcGluZyBjbSwgSW5o\nZXJpdGFuY2UgaW5oZXJpdCkgewogICAgICAgIENsYXNzTWFwcGluZ0luZm8g\naW5mbyA9IGNtLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgc3dpdGNoIChp\nbmhlcml0LnN0cmF0ZWd5KCkpIHsKICAgICAgICAgICAgY2FzZSBTSU5HTEVf\nVEFCTEU6CiAgICAgICAgICAgICAgICBpbmZvLnNldEhpZXJhcmNoeVN0cmF0\nZWd5KEZsYXRDbGFzc1N0cmF0ZWd5LkFMSUFTKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEpPSU5FRDoKICAgICAgICAgICAg\nICAgIGluZm8uc2V0SGllcmFyY2h5U3RyYXRlZ3koVmVydGljYWxDbGFzc1N0\ncmF0ZWd5LkFMSUFTKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIFRBQkxFX1BFUl9DTEFTUzoKICAgICAgICAgICAgICAgIGlu\nZm8uc2V0SGllcmFyY2h5U3RyYXRlZ3koRnVsbENsYXNzU3RyYXRlZ3kuQUxJ\nQVMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBj\nbGFzcy1sZXZlbCBATWFwcGluZ092ZXJyaWRlKHMpLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VNYXBwaW5nT3ZlcnJpZGVzKENsYXNzTWFwcGlu\nZyBjbSwKICAgICAgICBNYXBwaW5nT3ZlcnJpZGUuLi4gb3ZlcnMpIHsKICAg\nICAgICBGaWVsZE1hcHBpbmcgc3VwOwogICAgICAgIGZvciAoTWFwcGluZ092\nZXJyaWRlIG92ZXIgOiBvdmVycykgewogICAgICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShvdmVyLm5hbWUoKSkpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW92ZXJy\naWRlLW5hbWUiLCBjbSkpOwogICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBw\naW5nKSBjbS5nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKG92ZXIubmFtZSgp\nKTsKICAgICAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAgICAgICAgICAg\nICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20uYWRkRGVmaW5lZFN1cGVyY2xh\nc3NGaWVsZChvdmVyLm5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBPYmpl\nY3QuY2xhc3MsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgIHBvcHVsYXRl\nKHN1cCwgb3Zlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUG9wdWxhdGUgdGhlIGdpdmVuIGZpZWxkIGZyb20gb3ZlcnJpZGUgZGF0YS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBvcHVsYXRlKEZpZWxkTWFwcGlu\nZyBmbSwgTWFwcGluZ092ZXJyaWRlIG92ZXIpIHsKICAgICAgICBpZiAob3Zl\nci5jb250YWluZXJUYWJsZSgpLnNwZWNpZmllZCgpKQogICAgICAgICAgICBw\nYXJzZUNvbnRhaW5lclRhYmxlKGZtLCBvdmVyLmNvbnRhaW5lclRhYmxlKCkp\nOwogICAgICAgIHBhcnNlQ29sdW1ucyhmbSwgb3Zlci5jb2x1bW5zKCkpOwog\nICAgICAgIHBhcnNlWEpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8o\nKSwgdHJ1ZSwgb3Zlci5qb2luQ29sdW1ucygpKTsKICAgICAgICBwYXJzZUVs\nZW1lbnRKb2luQ29sdW1ucyhmbSwgb3Zlci5lbGVtZW50Sm9pbkNvbHVtbnMo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBkYXRhc3RvcmUgaWRl\nbnRpdHkgaW5mb3JtYXRpb24gaW4gQERhdGFTdG9yZUlkQ29sdW1uLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEYXRhU3RvcmVJZENvbHVtbihD\nbGFzc01hcHBpbmcgY20sIERhdGFTdG9yZUlkQ29sdW1uIGlkKSB7CiAgICAg\nICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoaWQubmFtZSgpKSkKICAgICAgICAgICAgY29s\nLnNldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbihpZC5uYW1l\nKCksIGRlbGltaXQoKSkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShpZC5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wu\nc2V0VHlwZUlkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbkRlZmlu\naXRpb24oaWQuY29sdW1uRGVmaW5pdGlvbigpKSk7CiAgICAgICAgaWYgKGlk\nLnByZWNpc2lvbigpICE9IDApCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGlk\nLnByZWNpc2lvbigpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxB\nR19VTklOU0VSVEFCTEUsICFpZC5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNv\nbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhaWQudXBkYXRh\nYmxlKCkpOwogICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1u\ncyhBcnJheXMuYXNMaXN0KG5ldyBDb2x1bW5bXXsgY29sIH0pKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIHRoZSBnaXZlbiBmb3JlaWduIGtleS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRm9yZWlnbktleShNYXBw\naW5nSW5mbyBpbmZvLCBGb3JlaWduS2V5IGZrKSB7CiAgICAJaWYgKCFmay5p\nbXBsaWNpdCgpKSB7CiAgICAJCXBhcnNlRm9yZWlnbktleShpbmZvLCBmay5u\nYW1lKCksIGZrLmVuYWJsZWQoKSwgZmsuZGVmZXJyZWQoKSwKICAgIAkJCQlm\nay5kZWxldGVBY3Rpb24oKSwgZmsudXBkYXRlQWN0aW9uKCkpOwogICAgCX0g\nZWxzZSB7CiAgICAgICAgICAgIGluZm8uc2V0SW1wbGljaXRSZWxhdGlvbih0\ncnVlKTsKICAgICAgICAgICAgYXNzZXJ0RGVmYXVsdChmayk7CiAgICAJfQog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IGZvcmVpZ24ga2V5IGRhdGEgb24g\ndGhlIGdpdmVuIG1hcHBpbmcgaW5mby4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgcGFyc2VGb3JlaWduS2V5KE1hcHBpbmdJbmZvIGluZm8sIFN0cmlu\nZyBuYW1lLAogICAgICAgIGJvb2xlYW4gZW5hYmxlZCwgYm9vbGVhbiBkZWZl\ncnJlZCwgRm9yZWlnbktleUFjdGlvbiBkZWxldGVBY3Rpb24sCiAgICAgICAg\nRm9yZWlnbktleUFjdGlvbiB1cGRhdGVBY3Rpb24pIHsKICAgICAgICBpZiAo\nIWVuYWJsZWQpIHsKICAgICAgICAgICAgaW5mby5zZXRDYW5Gb3JlaWduS2V5\nKGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkg\nZmsgPQogICAgICAgICAgICBuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGZrLnNldElkZW50aWZpZXIo\nREJJZGVudGlmaWVyLm5ld0ZvcmVpZ25LZXkobmFtZSwgZGVsaW1pdCgpKSk7\nCiAgICAgICAgZmsuc2V0RGVmZXJyZWQoZGVmZXJyZWQpOwogICAgICAgIGZr\nLnNldERlbGV0ZUFjdGlvbih0b0ZvcmVpZ25LZXlBY3Rpb24oZGVsZXRlQWN0\naW9uKSk7CiAgICAgICAgZmsuc2V0VXBkYXRlQWN0aW9uKHRvRm9yZWlnbktl\neUFjdGlvbih1cGRhdGVBY3Rpb24pKTsKICAgICAgICBpbmZvLnNldEZvcmVp\nZ25LZXkoZmspOwogICAgfQogICAgCiAgICB2b2lkIGFzc2VydERlZmF1bHQo\nRm9yZWlnbktleSBmaykgewogICAgICAgIGJvb2xlYW4gaXNEZWZhdWx0ID0g\nU3RyaW5nVXRpbHMuaXNFbXB0eShmay5uYW1lKCkpIAogICAgICAgICAgICAm\nJiBmay5lbmFibGVkKCkgCiAgICAgICAgICAgICYmICFmay5kZWZlcnJlZCgp\nIAogICAgICAgICAgICAgICAgJiYgZmsuZGVsZXRlQWN0aW9uKCkgPT0gRm9y\nZWlnbktleUFjdGlvbi5SRVNUUklDVAogICAgICAgICAgICAgICAgJiYgZmsu\ndXBkYXRlQWN0aW9uKCkgPT0gRm9yZWlnbktleUFjdGlvbi5SRVNUUklDVAog\nICAgICAgICAgICAmJiBmay5jb2x1bW5OYW1lcygpLmxlbmd0aCA9PSAwCiAg\nICAgICAgICAgICYmIGZrLnNwZWNpZmllZCgpOwogICAgICAgIGlmICghaXNE\nZWZhdWx0KQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiaW1wbGljaXQtbm9uLWRlZmF1bHQtZmsiLCBfY2xzLAogICAg\nICAgICAgICAgICAgZ2V0U291cmNlRmlsZSgpKS5nZXRNZXNzYWdlKCkpOwog\nICAgfQogICAgCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IG91ciBGSyBhY3Rp\nb24gZW51bSB0byBhbiBpbnRlcm5hbCBPcGVuSlBBIGFjdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSBpbnQgdG9Gb3JlaWduS2V5QWN0aW9uKEZvcmVpZ25L\nZXlBY3Rpb24gYWN0aW9uKSB7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsK\nICAgICAgICAgICAgY2FzZSBSRVNUUklDVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktl\neS4KICAgICAgICAgICAgICAgICAgICAgICAgQUNUSU9OX1JFU1RSSUNUOwog\nICAgICAgICAgICBjYXNlIENBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1\ncm4gb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXku\nQUNUSU9OX0NBU0NBREU7CiAgICAgICAgICAgIGNhc2UgTlVMTDoKICAgICAg\nICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hl\nbWEuRm9yZWlnbktleS5BQ1RJT05fTlVMTDsKICAgICAgICAgICAgY2FzZSBE\nRUZBVUxUOgogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgdGhlIGdpdmVuIGluZGV4LgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VJbmRleChNYXBwaW5nSW5mbyBpbmZvLCBJbmRl\neCBpZHgpIHsKICAgICAgICBwYXJzZUluZGV4KGluZm8sIGlkeC5uYW1lKCks\nIGlkeC5lbmFibGVkKCksIGlkeC51bmlxdWUoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgaW5kZXggZGF0YSBvbiB0aGUgZ2l2ZW4gbWFwcGluZyBp\nbmZvLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUluZGV4KE1h\ncHBpbmdJbmZvIGluZm8sIFN0cmluZyBuYW1lLAogICAgICAgIGJvb2xlYW4g\nZW5hYmxlZCwgYm9vbGVhbiB1bmlxdWUpIHsKICAgICAgICBpZiAoIWVuYWJs\nZWQpIHsKICAgICAgICAgICAgaW5mby5zZXRDYW5JbmRleChmYWxzZSk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleCBpZHggPQogICAgICAgICAg\nICBuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkluZGV4KCk7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAg\nICAgICAgICBpZHguc2V0SWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29u\nc3RyYWludChuYW1lLCBkZWxpbWl0KCkpKTsKICAgICAgICBpZHguc2V0VW5p\ncXVlKHVuaXF1ZSk7CiAgICAgICAgaW5mby5zZXRJbmRleChpZHgpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHVuaXF1ZSBkYXRhIG9uIHRoZSBnaXZl\nbiBtYXBwaW5nIGluZm8uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZVVuaXF1ZShGaWVsZE1hcHBpbmcgZm0sIAogICAgICAgIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5qZGJjLlVuaXF1ZSBhbm5vKSB7CiAgICAg\nICAgVmFsdWVNYXBwaW5nSW5mbyBpbmZvID0gZm0uZ2V0VmFsdWVJbmZvKCk7\nCiAgICAgICAgaWYgKCFhbm5vLmVuYWJsZWQoKSkgewogICAgICAgICAgICBp\nbmZvLnNldENhblVuaXF1ZShmYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5VbmlxdWUgdW5xID0gCiAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlKCk7CiAgICAgICAgaWYgKCFT\ndHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubmFtZSgpKSkKICAgICAgICAgICAg\ndW5xLnNldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0luZGV4KGFubm8u\nbmFtZSgpLCBkZWxpbWl0KCkpKTsKICAgICAgICB1bnEuc2V0RGVmZXJyZWQo\nYW5uby5kZWZlcnJlZCgpKTsKICAgICAgICBpbmZvLnNldFVuaXF1ZSh1bnEp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFZlcnNpb25Db2x1bW4o\ncykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVZlcnNpb25Db2x1\nbW5zKENsYXNzTWFwcGluZyBjbSwgVmVyc2lvbkNvbHVtbi4uLiB2Y29scykg\newogICAgICAgIGlmICh2Y29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJh\neUxpc3Q8Q29sdW1uPih2Y29scy5sZW5ndGgpOwogICAgICAgIGZvciAoVmVy\nc2lvbkNvbHVtbiB2Y29sIDogdmNvbHMpCiAgICAgICAgICAgIGNvbHMuYWRk\nKG5ld0NvbHVtbih2Y29sLCBkZWxpbWl0KCkpKTsKICAgICAgICBjbS5nZXRW\nZXJzaW9uKCkuZ2V0TWFwcGluZ0luZm8oKS5zZXRDb2x1bW5zKGNvbHMpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1\nbW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1u\nKFZlcnNpb25Db2x1bW4gYW5ubywgYm9vbGVhbiBkZWxpbWl0KSB7CiAgICAg\nICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBjb2wuc2V0\nVGFibGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdUYWJsZShhbm5vLnRh\nYmxlKCksIGRlbGltaXQpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoYW5uby5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0SWRlbnRp\nZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uKGFubm8ubmFtZSgpLCBkZWxp\nbWl0KSk7CiAgICAgICAgaWYgKGFubm8ucHJlY2lzaW9uKCkgIT0gMCkKICAg\nICAgICAgICAgY29sLnNldFNpemUoYW5uby5wcmVjaXNpb24oKSk7CiAgICAg\nICAgZWxzZSBpZiAoYW5uby5sZW5ndGgoKSAhPSAyNTUpCiAgICAgICAgICAg\nIGNvbC5zZXRTaXplKGFubm8ubGVuZ3RoKCkpOwogICAgICAgIGNvbC5zZXRO\nb3ROdWxsKCFhbm5vLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5zZXREZWNp\nbWFsRGlnaXRzKGFubm8uc2NhbGUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KGFubm8uY29sdW1uRGVmaW5pdGlvbigpKSkgewogICAg\nICAgICAgICBjb2wuc2V0VHlwZUlkZW50aWZpZXIoREJJZGVudGlmaWVyLm5l\nd0NvbHVtbkRlZmluaXRpb24oYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpKTsK\nICAgICAgICAgICAgY29sLnNldFR5cGUoU2NoZW1hcy5nZXRKREJDVHlwZShj\nb2wuZ2V0VHlwZUlkZW50aWZpZXIoKS5nZXROYW1lKCkpKTsKICAgICAgICAg\nICAgY29sLnNldEphdmFUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29kZShTY2hl\nbWFzLmdldEphdmFUeXBlCiAgICAgICAgICAgIAkoY29sLmdldFR5cGUoKSwg\nY29sLmdldFNpemUoKSwgY29sLmdldERlY2ltYWxEaWdpdHMoKSkpKTsKICAg\nICAgICB9CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNF\nUlRBQkxFLCAhYW5uby5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRG\nbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhYW5uby51cGRhdGFibGUo\nKSk7CiAgICAgICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGNsYXNzLWxldmVsIEBYTWFwcGluZ092ZXJyaWRlKHMpLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYXBwaW5nT3ZlcnJpZGVzKENs\nYXNzTWFwcGluZyBjbSwKICAgICAgICBYTWFwcGluZ092ZXJyaWRlLi4uIG92\nZXJzKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIHN1cDsKICAgICAgICBmb3Ig\nKFhNYXBwaW5nT3ZlcnJpZGUgb3ZlciA6IG92ZXJzKSB7CiAgICAgICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXIubmFtZSgpKSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tb3ZlcnJpZGUtbmFtZSIsIGNtKSk7CiAgICAgICAgICAgIHN1cCA9\nIChGaWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRTdXBlcmNsYXNzRmllbGQo\nb3Zlci5uYW1lKCkpOwogICAgICAgICAgICBpZiAoc3VwID09IG51bGwpCiAg\nICAgICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5hZGREZWZp\nbmVkU3VwZXJjbGFzc0ZpZWxkKG92ZXIubmFtZSgpLAogICAgICAgICAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgT2JqZWN0LmNsYXNzKTsKICAgICAgICAg\nICAgcG9wdWxhdGUoc3VwLCBvdmVyKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQb3B1bGF0ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBvdmVy\ncmlkZSBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcG9wdWxhdGUo\nRmllbGRNYXBwaW5nIGZtLCBYTWFwcGluZ092ZXJyaWRlIG92ZXIpIHsKICAg\nICAgICBpZiAob3Zlci5jb250YWluZXJUYWJsZSgpLnNwZWNpZmllZCgpKQog\nICAgICAgICAgICBwYXJzZUNvbnRhaW5lclRhYmxlKGZtLCBvdmVyLmNvbnRh\naW5lclRhYmxlKCkpOwogICAgICAgIHBhcnNlQ29sdW1ucyhmbSwgb3Zlci5j\nb2x1bW5zKCkpOwogICAgICAgIHBhcnNlWEpvaW5Db2x1bW5zKGZtLCBmbS5n\nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwgb3Zlci5qb2luQ29sdW1ucygpKTsKICAg\nICAgICBwYXJzZUVsZW1lbnRDb2x1bW5zKGZtLCBvdmVyLmVsZW1lbnRDb2x1\nbW5zKCkpOwogICAgICAgIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKGZtLCBv\ndmVyLmVsZW1lbnRKb2luQ29sdW1ucygpKTsKICAgICAgICBwYXJzZUtleUNv\nbHVtbnMoZm0sIG92ZXIua2V5Q29sdW1ucygpKTsKICAgICAgICBwYXJzZUtl\neUpvaW5Db2x1bW5zKGZtLCBvdmVyLmtleUpvaW5Db2x1bW5zKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQEVsZW1lbnRDb2x1bW4ocykuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUVsZW1lbnRDb2x1bW5zKEZp\nZWxkTWFwcGluZyBmbSwgRWxlbWVudENvbHVtbi4uLiBwY29scykgewogICAg\nICAgIGlmIChwY29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8\nQ29sdW1uPihwY29scy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUgPSAw\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGNvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKHBjb2xzW2ld\nLCBkZWxpbWl0KCkpKTsKICAgICAgICAgICAgdW5pcXVlIHw9IChwY29sc1tp\nXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAgICAgICAgfQogICAgICAg\nIHNldENvbHVtbnMoZm0sIGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFs\ndWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9u\nIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oRWxlbWVudENvbHVtbiBhbm5v\nLCBib29sZWFuIGRlbGltaXQpIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3\nIENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShh\nbm5vLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRJZGVudGlmaWVyKERC\nSWRlbnRpZmllci5uZXdDb2x1bW4oYW5uby5uYW1lKCksIGRlbGltaXQpKTsK\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5jb2x1bW5E\nZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZUlkZW50aWZp\nZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbkRlZmluaXRpb24oYW5uby5jb2x1\nbW5EZWZpbml0aW9uKCkpKTsKICAgICAgICBpZiAoYW5uby5wcmVjaXNpb24o\nKSAhPSAwKQogICAgICAgICAgICBjb2wuc2V0U2l6ZShhbm5vLnByZWNpc2lv\nbigpKTsKICAgICAgICBlbHNlIGlmIChhbm5vLmxlbmd0aCgpICE9IDI1NSkK\nICAgICAgICAgICAgY29sLnNldFNpemUoYW5uby5sZW5ndGgoKSk7CiAgICAg\nICAgY29sLnNldE5vdE51bGwoIWFubm8ubnVsbGFibGUoKSk7CiAgICAgICAg\nY29sLnNldERlY2ltYWxEaWdpdHMoYW5uby5zY2FsZSgpKTsKICAgICAgICBj\nb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFhbm5vLmlu\nc2VydGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdf\nVU5VUERBVEFCTEUsICFhbm5vLnVwZGF0YWJsZSgpKTsKICAgICAgICByZXR1\ncm4gY29sOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEtleUpvaW5D\nb2x1bW4ocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUtleUpv\naW5Db2x1bW5zKEZpZWxkTWFwcGluZyBmbSwgS2V5Sm9pbkNvbHVtbi4uLiBq\nb2lucykgewogICAgICAgIGlmIChqb2lucy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5l\ndyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAgIGlu\ndCB1bmlxdWUgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9p\nbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29scy5hZGQobmV3Q29s\ndW1uKGpvaW5zW2ldLCBkZWxpbWl0KCkpKTsKICAgICAgICAgICAgdW5pcXVl\nIHw9IChqb2luc1tpXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAgICAg\nICAgfQogICAgICAgIHNldENvbHVtbnMoZm0sIGZtLmdldEtleU1hcHBpbmco\nKS5nZXRWYWx1ZUluZm8oKSwgY29scywgdW5pcXVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqICBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRoIGlu\nZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oS2V5Sm9pbkNv\nbHVtbiBqb2luLCBib29sZWFuIGRlbGltaXQpIHsKICAgICAgICBDb2x1bW4g\nY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShqb2luLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRJZGVu\ndGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW4oam9pbi5uYW1lKCksZGVs\naW1pdCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2lu\nLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRJZGVu\ndGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW5EZWZpbml0aW9uKGpvaW4u\nY29sdW1uRGVmaW5pdGlvbigpKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSkpCiAgICAg\nICAgICAgIGNvbC5zZXRUYXJnZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5u\nZXdDb2x1bW4oam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpLGRlbGltaXQp\nKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZl\ncmVuY2VkQXR0cmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRh\ncmdldEZpZWxkKGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSk7CiAg\nICAgICAgY29sLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUoKSk7CiAgICAg\nICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAham9p\nbi5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5G\nTEFHX1VOVVBEQVRBQkxFLCAham9pbi51cGRhdGFibGUgKCkpOwogICAgICAg\nIHJldHVybiBjb2w7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVHJhbnNs\nYXRlIHRoZSBmZXRjaCBtb2RlIGVudW0gdmFsdWUgdG8gdGhlIGludGVybmFs\nIE9wZW5KUEEgY29uc3RhbnQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGludCB0b0VhZ2VyRmV0Y2hNb2RlQ29uc3RhbnQoRmV0Y2hNb2RlIG1vZGUp\nIHsKICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICAgICAgY2FzZSBO\nT05FOgogICAgICAgICAgICAgICAgcmV0dXJuIEVhZ2VyRmV0Y2hNb2Rlcy5F\nQUdFUl9OT05FOwogICAgICAgICAgICBjYXNlIEpPSU46CiAgICAgICAgICAg\nICAgICByZXR1cm4gRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU47CiAgICAg\nICAgICAgIGNhc2UgUEFSQUxMRUw6CiAgICAgICAgICAgICAgICByZXR1cm4g\nRWFnZXJGZXRjaE1vZGVzLkVBR0VSX1BBUkFMTEVMOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHJvdGVjdGVkIHZvaWQgcGFyc2VMb2JNYXBwaW5nKEZpZWxkTWV0YURhdGEg\nZm1kKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAg\nICAgICBpbnQgdHlwZUNvZGUgPSBmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigp\nID8gZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgOgog\nICAgICAgICAgICBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpOwogICAgICAg\nIENsYXNzIHR5cGUgPSBmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpID8gZm1k\nLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSA6CiAgICAgICAgICAg\nIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgCiAgICAgICAgaWYgKHR5cGVD\nb2RlID09IEphdmFUeXBlcy5TVFJJTkcKICAgICAgICAgICAgICAgIHx8IHR5\ncGUgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAgICAgICB8fCB0eXBlID09\nIENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAgICBjb2wuc2V0VHlwZShU\neXBlcy5DTE9CKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvbC5zZXRU\neXBlKFR5cGVzLkJMT0IpOwogICAgICAgIGlmIChmbWQuaXNFbGVtZW50Q29s\nbGVjdGlvbigpKQogICAgICAgICAgICAoKEZpZWxkTWFwcGluZykgZm1kKS5n\nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMo\nQXJyYXlzLmFzTGlzdChuZXcgQ29sdW1uW117IGNvbCB9KSk7CiAgICAgICAg\nZWxzZSAgICAKICAgICAgICAgICAgKChGaWVsZE1hcHBpbmcpIGZtZCkuZ2V0\nVmFsdWVJbmZvKCkuc2V0Q29sdW1ucyhBcnJheXMuYXNMaXN0KG5ldyBDb2x1\nbW5bXXsgY29sIH0pKTsKICAgICAgICAKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRp\nb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgRmllbGRNYXBwaW5n\nIGZtID0gKEZpZWxkTWFwcGluZykgZm1kOwogICAgICAgIEFubm90YXRlZEVs\nZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxlbWVudCkgZ2V0UmVwb3NpdG9yeSgp\nLgogICAgICAgICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0\ncygpLmdldEJhY2tpbmdNZW1iZXIoZm1kKTsKCiAgICAgICAgTWFwcGluZ1Rh\nZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBlbC5nZXRE\nZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFnID0gX3Rh\nZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgIGlm\nICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxlVW5rbm93\nbk1lbWJlck1hcHBpbmdBbm5vdGF0aW9uKGZtLCBhbm5vKTsKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBz\nd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBBU1NPQ19PVkVS\nUklERToKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0aW9uT3Zl\ncnJpZGVzKGZtLCAoQXNzb2NpYXRpb25PdmVycmlkZSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFT\nU09DX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29j\naWF0aW9uT3ZlcnJpZGVzKGZtLCAoKEFzc29jaWF0aW9uT3ZlcnJpZGVzKSBh\nbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFU\nVFJfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBdHRyaWJ1\ndGVPdmVycmlkZXMoZm0sIChBdHRyaWJ1dGVPdmVycmlkZSkgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEFUVFJfT1ZFUlJJREVTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQXR0\ncmlidXRlT3ZlcnJpZGVzKGZtLCAoKEF0dHJpYnV0ZU92ZXJyaWRlcykgYW5u\nbykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDT0w6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VDb2x1bW5zKGZtLCAoamF2YXgu\ncGVyc2lzdGVuY2UuQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ09MUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZUNvbHVtbnMoZm0sICgoQ29sdW1ucykgYW5ubyku\ndmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEVOVU1FUkFURUQ6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VFbnVtZXJhdGVkKGZtLCAoRW51bWVyYXRlZCkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpP\nSU5fQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlSm9pbkNvbHVtbnMo\nZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAgICAgICAg\nICAgICAgICAoSm9pbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fQ09MUzoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBmbS5nZXRW\nYWx1ZUluZm8oKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgKChK\nb2luQ29sdW1ucykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fVEFCTEU6CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VKb2luVGFibGUoZm0sIChKb2luVGFi\nbGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBLRVlfQ0xBU1NfQ1JJVDoKICAgICAgICAgICAgICAg\nICAgICBmbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0VXNl\nQ2xhc3NDcml0ZXJpYQogICAgICAgICAgICAgICAgICAgICAgICAoKChLZXlD\nbGFzc0NyaXRlcmlhKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0NPTDoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUtleUNvbHVtbnMoZm0sIChLZXlDb2x1\nbW4pIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBLRVlfQ09MUzoKICAgICAgICAgICAgICAgICAgICBw\nYXJzZUtleUNvbHVtbnMoZm0sICgoS2V5Q29sdW1ucykgYW5ubykudmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEtFWV9FTUJFRERFRF9NQVBQSU5HOgogICAgICAgICAgICAgICAg\nICAgIEtleUVtYmVkZGVkTWFwcGluZyBrZW1iZWQgPSAoS2V5RW1iZWRkZWRN\nYXBwaW5nKSBhbm5vOwogICAgICAgICAgICAgICAgICAgIHBhcnNlRW1iZWRk\nZWRNYXBwaW5nKGZtLmdldEtleU1hcHBpbmcoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgREJJZGVudGlmaWVyLm5ld0NvbHVtbihrZW1iZWQubnVsbElu\nZGljYXRvckNvbHVtbk5hbWUoKSwgZGVsaW1pdCgpKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld0NvbnN0YW50KGtlbWJlZC5u\ndWxsSW5kaWNhdG9yQXR0cmlidXRlTmFtZSgpKSwKICAgICAgICAgICAgICAg\nICAgICAgICAga2VtYmVkLm92ZXJyaWRlcygpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0ZLOgogICAg\nICAgICAgICAgICAgICAgIEtleUZvcmVpZ25LZXkga2ZrID0gKEtleUZvcmVp\nZ25LZXkpIGFubm87CiAgICAgICAgICAgICAgICAgICAgcGFyc2VGb3JlaWdu\nS2V5KGZtLmdldEtleU1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwKICAgICAg\nICAgICAgICAgICAgICAgICAga2ZrLm5hbWUoKSwga2ZrLmVuYWJsZWQoKSwg\na2ZrLmRlZmVycmVkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGtmay5k\nZWxldGVBY3Rpb24oKSwga2ZrLnVwZGF0ZUFjdGlvbigpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0lO\nREVYOgogICAgICAgICAgICAgICAgICAgIEtleUluZGV4IGtpZHggPSAoS2V5\nSW5kZXgpIGFubm87CiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbmRleChm\nbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksIGtpZHgubmFtZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICBraWR4LmVuYWJsZWQoKSwga2lk\neC51bmlxdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEtFWV9KT0lOX0NPTDoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZUtleUpvaW5Db2x1bW5zKGZtLCAoS2V5Sm9pbkNvbHVtbikg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEtFWV9KT0lOX0NPTFM6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VLZXlKb2luQ29sdW1ucyhmbSwgKChLZXlKb2luQ29sdW1ucykgYW5u\nbykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEtFWV9OT05QT0xZOgogICAgICAgICAgICAgICAg\nICAgIGZtLmdldEtleU1hcHBpbmcoKS5zZXRQb2x5bW9ycGhpYyh0b1BvbHlt\nb3JwaGljQ29uc3RhbnQKICAgICAgICAgICAgICAgICAgICAgICAgKCgoS2V5\nTm9ucG9seW1vcnBoaWMpIGFubm8pLnZhbHVlKCkpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX1NUUkFU\nOgogICAgICAgICAgICAgICAgICAgIGZtLmdldEtleU1hcHBpbmcoKS5nZXRW\nYWx1ZUluZm8oKQogICAgICAgICAgICAgICAgICAgICAgICAuc2V0U3RyYXRl\nZ3koKChLZXlTdHJhdGVneSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE1BUF9LRVlf\nQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5Q29sdW1uKGZt\nLCAoTWFwS2V5Q29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9FTlVNRVJBVEVE\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5RW51bWVyYXRlZChm\nbSwgKE1hcEtleUVudW1lcmF0ZWQpIGFubm8pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQVBfS0VZX0pPSU5f\nQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5Sm9pbkNvbHVt\nbnMoZm0sIChNYXBLZXlKb2luQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9K\nT0lOX0NPTFM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBLZXlKb2lu\nQ29sdW1ucyhmbSwKICAgICAgICAgICAgICAgICAgICAgICAgKChNYXBLZXlK\nb2luQ29sdW1ucykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBLX0pPSU5fQ09MOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5z\nKGZtLCAoUHJpbWFyeUtleUpvaW5Db2x1bW4pIGFubm8pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQS19KT0lO\nX0NPTFM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQcmltYXJ5S2V5Sm9p\nbkNvbHVtbnMoZm0sCiAgICAgICAgICAgICAgICAgICAgICAgICgoUHJpbWFy\neUtleUpvaW5Db2x1bW5zKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBUQUJMRV9HRU46CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VUYWJsZUdlbmVyYXRvcihlbCwgKFRhYmxlR2VuZXJhdG9y\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgVEVNUE9SQUw6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VUZW1wb3JhbChmbSwgKFRlbXBvcmFsKSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9U\nRU1QT1JBTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZU1hcEtleVRlbXBv\ncmFsKGZtLCAoTWFwS2V5VGVtcG9yYWwpIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDTEFTU19DUklU\nOgogICAgICAgICAgICAgICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldFVz\nZUNsYXNzQ3JpdGVyaWEKICAgICAgICAgICAgICAgICAgICAgICAgKCgoQ2xh\nc3NDcml0ZXJpYSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIENPTlRBSU5FUl9UQUJM\nRToKICAgICAgICAgICAgICAgICAgICBwYXJzZUNvbnRhaW5lclRhYmxlKGZt\nLCAoQ29udGFpbmVyVGFibGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDT0xMRUNUSU9OX1RBQkxF\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQ29sbGVjdGlvblRhYmxlKGZt\nLCAoQ29sbGVjdGlvblRhYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUFHRVJfRkVUQ0hfTU9E\nRToKICAgICAgICAgICAgICAgICAgICBmbS5zZXRFYWdlckZldGNoTW9kZSh0\nb0VhZ2VyRmV0Y2hNb2RlQ29uc3RhbnQKICAgICAgICAgICAgICAgICAgICAg\nICAgKCgoRWFnZXJGZXRjaE1vZGUpIGFubm8pLnZhbHVlKCkpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxF\nTV9DTEFTU19DUklUOgogICAgICAgICAgICAgICAgICAgIGZtLmdldEVsZW1l\nbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0VXNlQ2xhc3NDcml0ZXJp\nYQogICAgICAgICAgICAgICAgICAgICAgICAoKChFbGVtZW50Q2xhc3NDcml0\nZXJpYSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fQ09MOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlRWxlbWVudENvbHVtbnMoZm0sIChFbGVtZW50Q29s\ndW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgRUxFTV9DT0xTOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlRWxlbWVudENvbHVtbnMoZm0sICgoRWxlbWVudENvbHVtbnMpIGFu\nbm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBFTEVNX0VNQkVEREVEX01BUFBJTkc6CiAgICAg\nICAgICAgICAgICAgICAgRWxlbWVudEVtYmVkZGVkTWFwcGluZyBlZSA9IChF\nbGVtZW50RW1iZWRkZWRNYXBwaW5nKSBhbm5vOwogICAgICAgICAgICAgICAg\nICAgIHBhcnNlRW1iZWRkZWRNYXBwaW5nKGZtLmdldEVsZW1lbnRNYXBwaW5n\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdD\nb25zdGFudChlZS5udWxsSW5kaWNhdG9yQXR0cmlidXRlTmFtZSgpKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld0NvbHVtbihl\nZS5udWxsSW5kaWNhdG9yQ29sdW1uTmFtZSgpLCBkZWxpbWl0KCkpLAogICAg\nICAgICAgICAgICAgICAgICAgICBlZS5vdmVycmlkZXMoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1f\nRks6CiAgICAgICAgICAgICAgICAgICAgRWxlbWVudEZvcmVpZ25LZXkgZWZr\nID0gKEVsZW1lbnRGb3JlaWduS2V5KSBhbm5vOwogICAgICAgICAgICAgICAg\nICAgIHBhcnNlRm9yZWlnbktleShmbS5nZXRFbGVtZW50TWFwcGluZygpLmdl\ndFZhbHVlSW5mbygpLAogICAgICAgICAgICAgICAgICAgICAgICBlZmsubmFt\nZSgpLCBlZmsuZW5hYmxlZCgpLCBlZmsuZGVmZXJyZWQoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgZWZrLmRlbGV0ZUFjdGlvbigpLCBlZmsudXBkYXRl\nQWN0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFTEVNX0lOREVYOgogICAgICAgICAgICAgICAgICAg\nIEVsZW1lbnRJbmRleCBlaWR4ID0gKEVsZW1lbnRJbmRleCkgYW5ubzsKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUluZGV4KGZtLmdldEVsZW1lbnRNYXBw\naW5nKCkuZ2V0VmFsdWVJbmZvKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIGVpZHgubmFtZSgpLCBlaWR4LmVuYWJsZWQoKSwgZWlkeC51bmlxdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEVMRU1fSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VF\nbGVtZW50Sm9pbkNvbHVtbnMoZm0sIChFbGVtZW50Sm9pbkNvbHVtbikgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEVMRU1fSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlRWxlbWVudEpvaW5Db2x1bW5zKGZtLCAoKEVsZW1lbnRKb2luQ29sdW1u\ncykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBFTEVNX05PTlBPTFk6CiAgICAgICAgICAgICAgICAgICAgZm0uZ2V0RWxl\nbWVudE1hcHBpbmcoKS5zZXRQb2x5bW9ycGhpYyh0b1BvbHltb3JwaGljQ29u\nc3RhbnQKICAgICAgICAgICAgICAgICAgICAgICAgKCgoRWxlbWVudE5vbnBv\nbHltb3JwaGljKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fU1RSQVQ6CiAg\nICAgICAgICAgICAgICAgICAgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRW\nYWx1ZUluZm8oKQogICAgICAgICAgICAgICAgICAgICAgICAuc2V0U3RyYXRl\nZ3koKChFbGVtZW50U3RyYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTUJF\nRERFRF9NQVBQSU5HOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRW1iZWRk\nZWRNYXBwaW5nKGZtLCAoRW1iZWRkZWRNYXBwaW5nKSBhbm5vKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRks6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VGb3JlaWduS2V5KGZtLmdldFZh\nbHVlSW5mbygpLCAoRm9yZWlnbktleSkgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElOREVYOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlSW5kZXgoZm0uZ2V0VmFsdWVJbmZvKCks\nIChJbmRleCkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE5PTlBPTFk6CiAgICAgICAgICAgICAgICAg\nICAgZm0uc2V0UG9seW1vcnBoaWModG9Qb2x5bW9ycGhpY0NvbnN0YW50CiAg\nICAgICAgICAgICAgICAgICAgICAgICgoKE5vbnBvbHltb3JwaGljKSBhbm5v\nKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIE9SREVSX0NPTFVNTjoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZUphdmF4T3JkZXJDb2x1bW4oZm0sIAogICAgICAgICAgICAg\nICAgICAgICAgICAoamF2YXgucGVyc2lzdGVuY2UuT3JkZXJDb2x1bW4pYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIE9SREVSX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZU9y\nZGVyQ29sdW1uKGZtLCAoT3JkZXJDb2x1bW4pIGFubm8pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVFJBVDoK\nICAgICAgICAgICAgICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldFN0\ncmF0ZWd5KCgoU3RyYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBVTklRVUU6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VVbmlxdWUoZm0sCiAgICAgICAg\nICAgICAgICAgICAgICAgIChvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVu\nY2UuamRiYy5VbmlxdWUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBYX0VNQkVEREVEX01BUFBJTkc6\nCiAgICAgICAgICAgICAgICAgICAgWEVtYmVkZGVkTWFwcGluZyBlbWJlZCA9\nIChYRW1iZWRkZWRNYXBwaW5nKSBhbm5vOwogICAgICAgICAgICAgICAgICAg\nIHBhcnNlRW1iZWRkZWRNYXBwaW5nKGZtLCBEQklkZW50aWZpZXIubmV3Q29s\ndW1uKGVtYmVkLm51bGxJbmRpY2F0b3JDb2x1bW5OYW1lKCksIGRlbGltaXQo\nKSksCiAgICAgICAgICAgICAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdD\nb25zdGFudChlbWJlZC5udWxsSW5kaWNhdG9yQXR0cmlidXRlTmFtZSgpKSwg\nZW1iZWQub3ZlcnJpZGVzKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBYX0pPSU5fQ09MOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlWEpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUlu\nZm8oKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgKFhKb2luQ29s\ndW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgWF9KT0lOX0NPTFM6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VYSm9pbkNvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0\ncnVlLAogICAgICAgICAgICAgICAgICAgICAgICAoKFhKb2luQ29sdW1ucykg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBw\nb3J0ZWQiLCBmbSwKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0\ncmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3du\nIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBo\nYW5kbGVVbmtub3duTWVtYmVyTWFwcGluZ0Fubm90YXRpb24oRmllbGRNYXBw\naW5nIGZtLAogICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\ne0BsaW5rIFZhbHVlTWFwcGluZ30gPGNvZGU+UE9MWV8qPC9jb2RlPiBjb25z\ndGFudCBmb3IKICAgICAqIHRoZSBnaXZlbiBlbnVtIHZhbHVlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGludCB0b1BvbHltb3JwaGljQ29uc3Rh\nbnQoTm9ucG9seW1vcnBoaWNUeXBlIHZhbCkgewogICAgICAgIHN3aXRjaCAo\ndmFsKSB7CiAgICAgICAgICAgIGNhc2UgRVhBQ1Q6CiAgICAgICAgICAgICAg\nICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlfRkFMU0U7CiAgICAgICAgICAg\nIGNhc2UgSk9JTkFCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWVN\nYXBwaW5nLlBPTFlfSk9JTkFCTEU7CiAgICAgICAgICAgIGNhc2UgRkFMU0U6\nCiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlfVFJV\nRTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIGdpdmVuIEBBc3NvY2lhdGlvbk92ZXJyaWRl\nIGFubm90YXRpb25zIG9uIGFuIGVtYmVkZGVkIG1hcHBpbmcuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKEZp\nZWxkTWFwcGluZyBmbSwKICAgICAgICBBc3NvY2lhdGlvbk92ZXJyaWRlLi4u\nIGFzc29jcykgewoKICAgICAgICBGaWVsZE1hcHBpbmcgZWZtOwogICAgICAg\nIEpvaW5Db2x1bW5bXSBlY29sczsKICAgICAgICBpbnQgdW5pcXVlOwogICAg\nICAgIExpc3Q8Q29sdW1uPiBqY29sczsKICAgICAgICBKb2luVGFibGUgam9p\nblRibDsKICAgICAgICBmb3IgKEFzc29jaWF0aW9uT3ZlcnJpZGUgYXNzb2Mg\nOiBhc3NvY3MpIHsKICAgICAgICAgICAgZWZtID0gZ2V0RW1iZWRkZWRGaWVs\nZE1hcHBpbmcoZm0sIGFzc29jLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChl\nZm0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAg\nICAgICAgICAgICAgICAgICAgZm0sIGFzc29jLm5hbWUoKSkpOwogICAgICAg\nICAgICBlY29scyA9IGFzc29jLmpvaW5Db2x1bW5zKCk7CiAgICAgICAgICAg\nIGpvaW5UYmwgPSBhc3NvYy5qb2luVGFibGUoKTsKICAgICAgICAgICAgaWYg\nKChlY29scyA9PSBudWxsIHx8IGVjb2xzLmxlbmd0aCA9PSAwKSAmJiBqb2lu\nVGJsID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImVtYmVkLW92ZXJyaWRlLW5hbWUiLAog\nICAgICAgICAgICAgICAgICAgIGZtLCBhc3NvYy5uYW1lKCkpKTsKICAgICAg\nICAgICAgaWYgKGVjb2xzICE9IG51bGwgJiYgZWNvbHMubGVuZ3RoID4gMCkg\newogICAgICAgICAgICAgICAgdW5pcXVlID0gMDsKICAgICAgICAgICAgICAg\nIGpjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KGVjb2xzLmxlbmd0aCk7\nCiAgICAgICAgICAgICAgICBmb3IgKEpvaW5Db2x1bW4gZWNvbCA6IGVjb2xz\nKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlIHw9IChlY29sLnVuaXF1\nZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgICAgICAgICBqY29s\ncy5hZGQobmV3Q29sdW1uKGVjb2wpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHNldENvbHVtbnMoZWZtLCBlZm0uZ2V0VmFsdWVJbmZv\nKCksIGpjb2xzLCB1bmlxdWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGpv\naW5UYmwgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcGFyc2VKb2luVGFi\nbGUoZWZtLCBqb2luVGJsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdpdmVuIEBBdHRyaWJ1dGVPdmVy\ncmlkZSBhbm5vdGF0aW9ucyBvbiBhbiBlbWJlZGRlZCBtYXBwaW5nLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMo\nRmllbGRNYXBwaW5nIGZtLAogICAgICAgIEF0dHJpYnV0ZU92ZXJyaWRlLi4u\nIGF0dHJzKSB7CiAgICAgICAgZm9yIChBdHRyaWJ1dGVPdmVycmlkZSBhdHRy\nIDogYXR0cnMpIHsKICAgICAgICAgICAgU3RyaW5nIGF0dHJOYW1lID0gYXR0\nci5uYW1lKCk7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBlZm0gPSBnZXRF\nbWJlZGRlZEZpZWxkTWFwcGluZyhmbSwgYXR0ck5hbWUpOwogICAgICAgICAg\nICBpZiAoYXR0ci5jb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncGFyc2VDb2x1bW5zKGVmbSwgYXR0ci5jb2x1bW4oKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgRmllbGRNYXBwaW5nIGdldEVtYmVk\nZGVkRmllbGRNYXBwaW5nKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBTdHJp\nbmcgYXR0ck5hbWUpIHsKICAgICAgICByZXR1cm4gZ2V0RW1iZWRkZWRGaWVs\nZE1hcHBpbmcoZm0sIGF0dHJOYW1lLCB0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgc3RhdGljIEZpZWxkTWFwcGluZyBnZXRFbWJlZGRlZEZpZWxkTWFwcGlu\nZyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgICAgIFN0cmluZyBhdHRyTmFt\nZSwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nZW1iZWQgPSBudWxsOwogICAgICAgIGJvb2xlYW4gaXNLZXkgPSBmYWxzZTsK\nICAgICAgICBib29sZWFuIGlzVmFsdWUgPSBmYWxzZTsKICAgICAgICBpZiAo\nYXR0ck5hbWUgIT0gbnVsbCAmJiBhdHRyTmFtZS5zdGFydHNXaXRoKCJrZXku\nIikpCiAgICAgICAgICAgIGlzS2V5ID0gdHJ1ZTsKICAgICAgICBlbHNlIGlm\nIChhdHRyTmFtZSAhPSBudWxsICYmIGF0dHJOYW1lLnN0YXJ0c1dpdGgoInZh\nbHVlLiIpKQogICAgICAgICAgICBpc1ZhbHVlID0gdHJ1ZTsKICAgICAgICBp\nZiAoaXNLZXkgfHwgaXNWYWx1ZSkKICAgICAgICAgICAgYXR0ck5hbWUgPSBh\ndHRyTmFtZS5zdWJzdHJpbmcoYXR0ck5hbWUuaW5kZXhPZigiLiIpKzEpOwog\nICAgICAgICAgICAKICAgICAgICBpbnQgdHlwZUNvZGUgPSBmbS5nZXRWYWx1\nZSgpLmdldERlY2xhcmVkVHlwZUNvZGUoKTsKICAgICAgICBzd2l0Y2ggKHR5\ncGVDb2RlKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJ\nT04gOiAvLyBhIGNvbGxlY3Rpb24gb2YgZW1iZWRkYWJsZXMKICAgICAgICAg\nICAgICAgIGlmIChpc0tleSB8fCBpc1ZhbHVlKQogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1i\nZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZt\nLCBhdHRyTmFtZSkpOwogICAgICAgICAgICAgICAgZW1iZWQgPSBmbS5nZXRF\nbGVtZW50TWFwcGluZygpLmdldEVtYmVkZGVkTWFwcGluZygpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1B\nUDogLy8gYSBtYXAKICAgICAgICAgICAgICAgIGlmICghaXNLZXkgJiYgIWlz\nVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgZm0sIGF0dHJOYW1lKSk7CiAgICAgICAg\nICAgICAgICBpZiAoaXNLZXkpIAogICAgICAgICAgICAgICAgICAgIGVtYmVk\nID0gZ2V0RW1iZWRkZWRNYXBwaW5nKGZtLmdldEtleU1hcHBpbmcoKSwgbXVz\ndEV4aXN0KTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzVmFsdWUpICAg\nICAKICAgICAgICAgICAgICAgICAgICBlbWJlZCA9IGdldEVtYmVkZGVkTWFw\ncGluZyhmbS5nZXRFbGVtZW50TWFwcGluZygpLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgbXVzdEV4aXN0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBkZWZhdWx0OiAvLyBhbiBlbWJlZGRhYmxlCiAgICAgICAg\nICAgICAgICBpZiAoaXNLZXkgfHwgaXNWYWx1ZSkKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVt\nYmVkLW92ZXJyaWRlLW5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICBm\nbSwgYXR0ck5hbWUpKTsKICAgICAgICAgICAgICAgIGVtYmVkID0gZ2V0RW1i\nZWRkZWRNYXBwaW5nKGZtLmdldFZhbHVlTWFwcGluZygpLCBtdXN0RXhpc3Qp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIAog\nICAgICAgIGlmIChlbWJlZCA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmICht\ndXN0RXhpc3QpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbWJlZGRlZCIsIGZtKSk7CiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nZ2V0QXR0cmlidXRlT3ZlcnJpZGVGaWVsZChhdHRyTmFtZSwgZm0sIGVtYmVk\nKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIENsYXNzPD8+IGdldEVtYmVk\nZGVkQ2xhc3NUeXBlKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBTdHJpbmcg\nYXR0ck5hbWUpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgZW1iZWQgPSBudWxs\nOwogICAgICAgIGJvb2xlYW4gaXNLZXkgPSBmYWxzZTsKICAgICAgICBib29s\nZWFuIGlzVmFsdWUgPSBmYWxzZTsKICAgICAgICBpZiAoYXR0ck5hbWUgIT0g\nbnVsbCAmJiBhdHRyTmFtZS5zdGFydHNXaXRoKCJrZXkuIikpCiAgICAgICAg\nICAgIGlzS2V5ID0gdHJ1ZTsKICAgICAgICBlbHNlIGlmIChhdHRyTmFtZSAh\nPSBudWxsICYmIGF0dHJOYW1lLnN0YXJ0c1dpdGgoInZhbHVlLiIpKQogICAg\nICAgICAgICBpc1ZhbHVlID0gdHJ1ZTsKICAgICAgICBpZiAoaXNLZXkgfHwg\naXNWYWx1ZSkKICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyTmFtZS5zdWJz\ndHJpbmcoYXR0ck5hbWUuaW5kZXhPZigiLiIpKzEpOwogICAgICAgICAgICAK\nICAgICAgICBpbnQgdHlwZUNvZGUgPSBmbS5nZXRWYWx1ZSgpLmdldERlY2xh\ncmVkVHlwZUNvZGUoKTsKICAgICAgICBzd2l0Y2ggKHR5cGVDb2RlKSB7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT04gOiAvLyBhIGNv\nbGxlY3Rpb24gb2YgZW1iZWRkYWJsZXMKICAgICAgICAgICAgICAgIGlmIChp\nc0tleSB8fCBpc1ZhbHVlKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUt\nbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZtLCBhdHRyTmFtZSkp\nOwogICAgICAgICAgICAgICAgZW1iZWQgPSBmbS5nZXRFbGVtZW50TWFwcGlu\nZygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDogLy8gYSBtYXAKICAgICAgICAgICAgICAgIGlmICgh\naXNLZXkgJiYgIWlzVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJlZC1vdmVycmlk\nZS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgZm0sIGF0dHJOYW1l\nKSk7CiAgICAgICAgICAgICAgICBpZiAoaXNLZXkpIAogICAgICAgICAgICAg\nICAgICAgIGVtYmVkID0gZm0uZ2V0S2V5TWFwcGluZygpOwogICAgICAgICAg\nICAgICAgZWxzZSBpZiAoaXNWYWx1ZSkgICAgIAogICAgICAgICAgICAgICAg\nICAgIGVtYmVkID0gZm0uZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OiAvLyBhbiBlbWJl\nZGRhYmxlCiAgICAgICAgICAgICAgICBpZiAoaXNLZXkgfHwgaXNWYWx1ZSkK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImVtYmVkLW92ZXJyaWRlLW5hbWUiLAogICAgICAgICAg\nICAgICAgICAgICAgICBmbSwgYXR0ck5hbWUpKTsKICAgICAgICAgICAgICAg\nIGVtYmVkID0gZm0uZ2V0VmFsdWVNYXBwaW5nKCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGVtYmVk\nID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW1iZWRkZWQiLCBmbSkpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZW1iZWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAg\nICB9CgogICAgcHVibGljIHN0YXRpYyBDbGFzc01hcHBpbmcgZ2V0RW1iZWRk\nZWRNYXBwaW5nKFZhbHVlTWFwcGluZyB2YWwsIGJvb2xlYW4gCiAgICAgICAg\nY3JlYXRlTmV3KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGVtYmVkID0gdmFs\nLmdldEVtYmVkZGVkTWFwcGluZygpOwogICAgICAgIGlmIChlbWJlZCAhPSBu\ndWxsIHx8ICFjcmVhdGVOZXcpIAogICAgICAgICAgICByZXR1cm4gZW1iZWQ7\nCgogICAgICAgIHZhbC5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAg\ncmV0dXJuIHZhbC5nZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAgIH0KCiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgQ2xhc3NNYXBwaW5nIGdldEVtYmVkZGVkTWFw\ncGluZyhWYWx1ZU1hcHBpbmcgdmFsKSB7CiAgICAgICAgcmV0dXJuIGdldEVt\nYmVkZGVkTWFwcGluZyh2YWwsIHRydWUpOwogICAgfQogICAgCiAgICBwdWJs\naWMgc3RhdGljIEZpZWxkTWFwcGluZyBnZXRBdHRyaWJ1dGVPdmVycmlkZUZp\nZWxkKFN0cmluZyBhdHRyTmFtZSwKICAgICAgICAgICAgRmllbGRNYXBwaW5n\nIGZtLCBDbGFzc01hcHBpbmcgZW1iZWQpIHsKICAgICAgICBGaWVsZE1hcHBp\nbmcgZWZtOwogICAgICAgIGludCBpZHhPZkRvdCA9IGF0dHJOYW1lLmluZGV4\nT2YoIi4iKTsgCiAgICAgICAgaWYgKGlkeE9mRG90ID09IC0xKSB7CiAgICAg\nICAgICAgIGVmbSA9IGVtYmVkLmdldEZpZWxkTWFwcGluZyhhdHRyTmFtZSk7\nCiAgICAgICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1iZWQt\nb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZm0sIGF0dHJO\nYW1lKSk7CiAgICAgICAgICAgIHJldHVybiBlZm07CiAgICAgICAgfSAKICAg\nICAgICBTdHJpbmcgYXR0ck5hbWUxID0gYXR0ck5hbWUuc3Vic3RyaW5nKDAs\nIGlkeE9mRG90KTsKICAgICAgICBTdHJpbmcgYXR0ck5hbWUyID0gYXR0ck5h\nbWUuc3Vic3RyaW5nKGlkeE9mRG90KzEpOwogICAgICAgIGVmbSA9IGVtYmVk\nLmdldEZpZWxkTWFwcGluZyhhdHRyTmFtZTEpOwogICAgICAgIGlmIChlZm0g\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAgICAgICAg\nICAgICAgIGZtLCBhdHRyTmFtZTEpKTsKICAgICAgICBDbGFzc01hcHBpbmcg\nZW1iZWQxID0gZ2V0RW1iZWRkZWRNYXBwaW5nKGVmbS5nZXRWYWx1ZU1hcHBp\nbmcoKSk7CiAgICAgICAgcmV0dXJuIGdldEF0dHJpYnV0ZU92ZXJyaWRlRmll\nbGQoYXR0ck5hbWUyLCBlZm0sIGVtYmVkMSk7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogUGFyc2UgQEVudW1lcmF0ZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZUVudW1lcmF0ZWQoRmllbGRNYXBwaW5nIGZtLCBFbnVt\nZXJhdGVkIGFubm8pIHsKICAgICAgICBTdHJpbmcgc3RyYXQgPSBFbnVtVmFs\ndWVIYW5kbGVyLmNsYXNzLmdldE5hbWUoKSArICIoU3RvcmVPcmRpbmFsPSIK\nICAgICAgICAgICAgKyBTdHJpbmcudmFsdWVPZihhbm5vLnZhbHVlKCkgPT0g\nRW51bVR5cGUuT1JESU5BTCkgKyAiKSI7CiAgICAgICAgaWYgKGZtLmlzRWxl\nbWVudENvbGxlY3Rpb24oKSkgCiAgICAgICAgICAgIGZtLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0U3RyYXRlZ3koc3RyYXQpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0\nU3RyYXRlZ3koc3RyYXQpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQE1hcEtleUVudW1lcmF0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZU1hcEtleUVudW1lcmF0ZWQoRmllbGRNYXBwaW5nIGZtLCBNYXBLZXlF\nbnVtZXJhdGVkIGFubm8pIHsKICAgICAgICBTdHJpbmcgc3RyYXQgPSBFbnVt\nVmFsdWVIYW5kbGVyLmNsYXNzLmdldE5hbWUoKSArICIoU3RvcmVPcmRpbmFs\nPSIKICAgICAgICAgICAgKyBTdHJpbmcudmFsdWVPZihhbm5vLnZhbHVlKCkg\nPT0gRW51bVR5cGUuT1JESU5BTCkgKyAiKSI7CiAgICAgICAgZm0uZ2V0S2V5\nTWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldFN0cmF0ZWd5KHN0cmF0KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBUZW1wb3JhbC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVGVtcG9yYWwoRmllbGRNYXBwaW5n\nIGZtLCBUZW1wb3JhbCBhbm5vKSB7CiAgICAgICAgTGlzdCBjb2xzID0gZm0u\nZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmICghY29s\ncy5pc0VtcHR5KCkgJiYgY29scy5zaXplKCkgIT0gMSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudW0tY29s\ncy1taXNtYXRjaCIsIGZtLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVl\nT2YoY29scy5zaXplKCkpLCAiMSIpKTsKICAgICAgICBpZiAoY29scy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgY29scyA9IEFycmF5cy5hc0xpc3QobmV3\nIENvbHVtbltdeyBuZXcgQ29sdW1uKCkgfSk7CiAgICAgICAgICAgIGlmIChm\nbS5pc0VsZW1lbnRDb2xsZWN0aW9uKCkpIHsKICAgICAgICAgICAgICAgIGlm\nICghZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5nZXRD\nb2x1bW5zKCkuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIGNvbHMg\nPSBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLmdldENv\nbHVtbnMoKTsKICAgICAgICAgICAgICAgIGVsc2UgICAgCiAgICAgICAgICAg\nICAgICAgICAgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8o\nKS5zZXRDb2x1bW5zKGNvbHMpOwogICAgICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoY29scyk7\nCiAgICAgICAgfQoKICAgICAgICBDb2x1bW4gY29sID0gKENvbHVtbikgY29s\ncy5nZXQoMCk7CiAgICAgICAgc3dpdGNoIChhbm5vLnZhbHVlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBEQVRFOgogICAgICAgICAgICAgICAgY29sLnNldFR5\ncGUoVHlwZXMuREFURSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBUSU1FOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUo\nVHlwZXMuVElNRSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBUSU1FU1RBTVA6CiAgICAgICAgICAgICAgICBjb2wuc2V0VHlw\nZShUeXBlcy5USU1FU1RBTVApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFRlbXBvcmFs\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYXBLZXlUZW1wb3Jh\nbChGaWVsZE1hcHBpbmcgZm0sIE1hcEtleVRlbXBvcmFsIGFubm8pIHsKICAg\nICAgICBMaXN0IGNvbHMgPSBmbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJ\nbmZvKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmICghY29scy5pc0VtcHR5\nKCkgJiYgY29scy5zaXplKCkgIT0gMSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudW0tY29scy1taXNtYXRj\naCIsIGZtLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY29scy5z\naXplKCkpLCAiMSIpKTsKICAgICAgICBpZiAoY29scy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgY29scyA9IEFycmF5cy5hc0xpc3QobmV3IENvbHVtbltd\neyBuZXcgQ29sdW1uKCkgfSk7CiAgICAgICAgICAgIGZtLmdldEtleU1hcHBp\nbmcoKS5nZXRWYWx1ZUluZm8oKS5zZXRDb2x1bW5zKGNvbHMpOwogICAgICAg\nIH0KCiAgICAgICAgQ29sdW1uIGNvbCA9IChDb2x1bW4pIGNvbHMuZ2V0KDAp\nOwogICAgICAgIHN3aXRjaCAoYW5uby52YWx1ZSgpKSB7CiAgICAgICAgICAg\nIGNhc2UgREFURToKICAgICAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVz\nLkRBVEUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgVElNRToKICAgICAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVzLlRJ\nTUUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nVElNRVNUQU1QOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMu\nVElNRVNUQU1QKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBDb2x1bW4ocykuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlQ29sdW1ucyhGaWVsZE1hcHBp\nbmcgZm0sCiAgICAgICAgamF2YXgucGVyc2lzdGVuY2UuQ29sdW1uLi4uIHBj\nb2xzKSB7CiAgICAgICAgaWYgKHBjb2xzLmxlbmd0aCA9PSAwKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIG1pZ2h0IGFscmVhZHkgaGF2ZSBz\nb21lIGNvbHVtbiBpbmZvcm1hdGlvbiBmcm9tIG1hcHBpbmcgYW5ub3RhdGlv\nbgogICAgICAgIExpc3QgY29scyA9IGZtLmdldFZhbHVlSW5mbygpLmdldENv\nbHVtbnMoKTsKICAgICAgICBpZiAoIWNvbHMuaXNFbXB0eSgpICYmIGNvbHMu\nc2l6ZSgpICE9IHBjb2xzLmxlbmd0aCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudW0tY29scy1taXNtYXRj\naCIsIGZtLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY29scy5z\naXplKCkpLCBTdHJpbmcudmFsdWVPZihwY29scy5sZW5ndGgpKSk7CgogICAg\nICAgIC8vIGNhY2hlIHRoZSBKQVhCIFhtbFR5cGUgY2xhc3MgaWYgaXQgaXMg\ncHJlc2VudCBzbyB3ZSBkbyBub3QKICAgICAgICAvLyBoYXZlIGEgaGFyZC13\naXJlZCBkZXBlbmRlbmN5IG9uIEpBWEIgaGVyZQogICAgICAgIENsYXNzIHht\nbFR5cGVDbGFzcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\neG1sVHlwZUNsYXNzID0gQ2xhc3MuZm9yTmFtZSgiamF2YXgueG1sLmJpbmQu\nYW5ub3RhdGlvbi5YbWxUeXBlIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICB9CgogICAgICAgIGludCB1bmlxdWUgPSAwOwog\nICAgICAgIERCSWRlbnRpZmllciBzU2Vjb25kYXJ5ID0gREJJZGVudGlmaWVy\nLk5VTEw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwY29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29scy5zaXplKCkgPiBpKQog\nICAgICAgICAgICAgICAgc2V0dXBDb2x1bW4oKENvbHVtbikgY29scy5nZXQo\naSksIHBjb2xzW2ldLCBkZWxpbWl0KCkpOwogICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgICAgICBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KHBjb2xz\nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4o\ncGNvbHNbaV0sIGRlbGltaXQoKSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIAogICAgICAgICAgICBpZiAoeG1sVHlwZUNsYXNzICE9IG51bGwKICAg\nICAgICAgICAgICAgICYmIFN0cmluZ1V0aWxzLmlzRW1wdHkocGNvbHNbaV0u\nY29sdW1uRGVmaW5pdGlvbigpKQogICAgICAgICAgICAgICAgJiYgKEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAg\nICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oZm0u\nZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHht\nbFR5cGVDbGFzcykpKS5ib29sZWFuVmFsdWUoKSkgewogICAgICAgICAgICAg\nICAgREJEaWN0aW9uYXJ5IGRpY3QgPSAoKE1hcHBpbmdSZXBvc2l0b3J5KSBn\nZXRSZXBvc2l0b3J5KCkpCiAgICAgICAgICAgICAgICAgICAgLmdldERCRGlj\ndGlvbmFyeSgpOwogICAgICAgICAgICAgICAgaWYgKGRpY3Quc3VwcG9ydHNY\nTUxDb2x1bW4pCiAgICAgICAgICAgICAgICAgICAgLy8gY29sdW1uIG1hcHMg\ndG8geG1sIHR5cGUKICAgICAgICAgICAgICAgICAgICAoKENvbHVtbikgY29s\ncy5nZXQoaSkpLnNldFR5cGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdD\nb2x1bW5EZWZpbml0aW9uKGRpY3QueG1sVHlwZU5hbWUpKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgdW5pcXVlIHw9IChwY29sc1tpXS51bmlxdWUo\nKSkgPyBUUlVFIDogRkFMU0U7CiAgICAgICAgICAgIERCSWRlbnRpZmllciBz\nU2VjVGFibGUgPSBEQklkZW50aWZpZXIubmV3VGFibGUocGNvbHNbaV0udGFi\nbGUoKSwgZGVsaW1pdCgpKTsKICAgICAgICAJc1NlY29uZGFyeSA9IHRyYWNr\nU2Vjb25kYXJ5VGFibGUoZm0sIHNTZWNvbmRhcnksIHNTZWNUYWJsZSwgaSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAoZm0uaXNFbGVtZW50Q29sbGVjdGlv\nbigpKQogICAgICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRFbGVtZW50\nTWFwcGluZygpLmdldFZhbHVlSW5mbygpLCBjb2xzLCB1bmlxdWUpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgc2V0Q29sdW1ucyhmbSwgZm0uZ2V0VmFs\ndWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAgICAgICAgaWYgKCFEQklkZW50\naWZpZXIuaXNOdWxsKHNTZWNvbmRhcnkpKQogICAgICAgICAgICBmbS5nZXRN\nYXBwaW5nSW5mbygpLnNldFRhYmxlSWRlbnRpZmllcihzU2Vjb25kYXJ5KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzY2hlbWEgY29s\ndW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlv\nbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ29sdW1uIG5ld0NvbHVt\nbihqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4gYW5ubywKICAgICAgICBib29s\nZWFuIGRlbGltaXQpIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVt\nbigpOwogICAgICAgIHNldHVwQ29sdW1uKGNvbCwgYW5ubywgZGVsaW1pdCk7\nCiAgICAgICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndHVwIHRoZSBnaXZlbiBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRo\nZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyB2b2lkIHNldHVwQ29sdW1uKENvbHVtbiBjb2wsIGphdmF4LnBlcnNpc3Rl\nbmNlLkNvbHVtbiBhbm5vLAogICAgICAgIGJvb2xlYW4gZGVsaW1pdCkgewog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5u\nZXdDb2x1bW4oYW5uby5uYW1lKCksZGVsaW1pdCkpOwogICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLmNvbHVtbkRlZmluaXRpb24oKSkp\nCiAgICAgICAgICAgIGNvbC5zZXRUeXBlSWRlbnRpZmllcihEQklkZW50aWZp\nZXIubmV3Q29sdW1uRGVmaW5pdGlvbihhbm5vLmNvbHVtbkRlZmluaXRpb24o\nKSkpOwogICAgICAgIGlmIChhbm5vLnByZWNpc2lvbigpICE9IDApCiAgICAg\nICAgICAgIGNvbC5zZXRTaXplKGFubm8ucHJlY2lzaW9uKCkpOwogICAgICAg\nIGVsc2UgaWYgKGFubm8ubGVuZ3RoKCkgIT0gMjU1KQogICAgICAgICAgICBj\nb2wuc2V0U2l6ZShhbm5vLmxlbmd0aCgpKTsKICAgICAgICBjb2wuc2V0Tm90\nTnVsbCghYW5uby5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RGVjaW1h\nbERpZ2l0cyhhbm5vLnNjYWxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENv\nbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWFubm8uaW5zZXJ0YWJsZSgpKTsK\nICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwg\nIWFubm8udXBkYXRhYmxlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiBjb2x1bW5zIGFzIHRoZSBjb2x1bW5zIGZvciA8Y29kZT5m\nbTwvY29kZT4uCiAgICAgKgogICAgICogQHBhcmFtIHVuaXF1ZSBiaXR3aXNl\nIGNvbWJpbmF0aW9uIG9mIFRSVUUgYW5kIEZBTFNFIGZvciB0aGUKICAgICAq\nIHVuaXF1ZSBhdHRyaWJ1dGUgb2YgZWFjaCBjb2x1bW4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc2V0Q29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sIE1h\ncHBpbmdJbmZvIGluZm8sCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMsIGlu\ndCB1bmlxdWUpIHsKICAgICAgICBpbmZvLnNldENvbHVtbnMoY29scyk7CiAg\nICAgICAgaWYgKHVuaXF1ZSA9PSBUUlVFKQogICAgICAgICAgICBpbmZvLnNl\ndFVuaXF1ZShuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVu\naXF1ZSgpKTsKCiAgICAgICAgLy8jIyMgRUpCMwogICAgICAgIExvZyBsb2cg\nPSBnZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSAm\nJiB1bmlxdWUgPT0gKFRSVUUgfCBGQUxTRSkpCiAgICAgICAgICAgIGxvZy53\nYXJuKF9sb2MuZ2V0KCJpbmNvbnNpc3QtY29sLWF0dHJzIiwgZm0pKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEhlbHBlciB0byB0cmFjayB0aGUgc2Vjb25k\nYXJ5IHRhYmxlIGZvciBhIHNldCBvZiBjb2x1bW5zLgogICAgICoKICAgICAq\nIEBwYXJhbSBzZWNvbmRhcnkgc2Vjb25kYXJ5IHRhYmxlIGZvciBsYXN0IGNv\nbHVtbgogICAgICogQHBhcmFtIGNvbFNlY29uZGFyeSBzZWNvbmRhcnkgdGFi\nbGUgZm9yIGN1cnJlbnQgY29sdW1uCiAgICAgKiBAcmV0dXJuIHNlY29uZGFy\neSB0YWJsZSBmb3IgZmllbGQKICAgICAqLwogICAgcHJpdmF0ZSBEQklkZW50\naWZpZXIgdHJhY2tTZWNvbmRhcnlUYWJsZShGaWVsZE1hcHBpbmcgZm0sIERC\nSWRlbnRpZmllciBzZWNvbmRhcnksCiAgICAgICAgREJJZGVudGlmaWVyIGNv\nbFNlY29uZGFyeSwgaW50IGNvbCkgewogICAgICAgIGlmIChEQklkZW50aWZp\nZXIuaXNFbXB0eShjb2xTZWNvbmRhcnkpKQogICAgICAgICAgICBjb2xTZWNv\nbmRhcnkgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBpZiAoY29sID09\nIDApCiAgICAgICAgICAgIHJldHVybiBjb2xTZWNvbmRhcnk7CiAgICAgICAg\naWYgKCFEQklkZW50aWZpZXIuZXF1YWxzSWdub3JlQ2FzZShzZWNvbmRhcnks\nIGNvbFNlY29uZGFyeSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgic2Vjb25kLWluY29uc2lzdCIsIGZtKSk7\nCiAgICAgICAgcmV0dXJuIHNlY29uZGFyeTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBKb2luVGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZUpvaW5UYWJsZShGaWVsZE1hcHBpbmcgZm0sIEpvaW5UYWJsZSBq\nb2luKSB7CiAgICAJRmllbGRNYXBwaW5nSW5mbyBpbmZvID0gZm0uZ2V0TWFw\ncGluZ0luZm8oKTsKICAgIAlEQklkZW50aWZpZXIgam9pblRibCA9IHRvVGFi\nbGVJZGVudGlmaWVyKGpvaW4uc2NoZW1hKCksIGpvaW4ubmFtZSgpKTsKICAg\nICAgICBpbmZvLnNldFRhYmxlSWRlbnRpZmllcihqb2luVGJsKTsKICAgICAg\nICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBpbmZvLCBmYWxzZSwgam9pbi5qb2lu\nQ29sdW1ucygpKTsKICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBmbS5n\nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLCBmYWxzZSwKICAg\nICAgICAgICAgam9pbi5pbnZlcnNlSm9pbkNvbHVtbnMoKSk7CiAgICAgICAg\nYWRkVW5pcXVlQ29uc3RyYWludHMoaW5mby5nZXRUYWJsZUlkZW50aWZpZXIo\nKS5nZXROYW1lKCksIGZtLCBpbmZvLCAgCiAgICAgICAgICAgIGpvaW4udW5p\ncXVlQ29uc3RyYWludHMoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBnaXZlbiBASm9pbkNvbHVtbiBhbm5vdGF0aW9ucy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlSm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZt\nLCBNYXBwaW5nSW5mbyBpbmZvLAogICAgICAgIGJvb2xlYW4gc2Vjb25kYXJ5\nQWxsb3dlZCwgSm9pbkNvbHVtbi4uLiBqb2lucykgewogICAgICAgIGlmIChq\nb2lucy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihq\nb2lucy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAg\nIERCSWRlbnRpZmllciBzU2Vjb25kYXJ5ID0gREJJZGVudGlmaWVyLk5VTEw7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbnNbaV0p\nKTsKICAgICAgICAgICAgdW5pcXVlIHw9IChqb2luc1tpXS51bmlxdWUoKSkg\nPyBUUlVFIDogRkFMU0U7CiAgICAgICAgICAgIERCSWRlbnRpZmllciBzVGFi\nbGUgPSBEQklkZW50aWZpZXIubmV3VGFibGUoam9pbnNbaV0udGFibGUoKSwg\nZGVsaW1pdCgpKTsKICAgICAgICAgICAgc1NlY29uZGFyeSA9IHRyYWNrU2Vj\nb25kYXJ5VGFibGUoZm0sIHNTZWNvbmRhcnksCiAgICAgICAgICAgICAgICBz\nVGFibGUsIGkpOwogICAgICAgICAgICBpZiAoIXNlY29uZGFyeUFsbG93ZWQg\nJiYgIURCSWRlbnRpZmllci5pc051bGwoc1NlY29uZGFyeSkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1zZWNvbmQiLCBmbSkpOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29s\ndW1ucyhmbSwgaW5mbywgY29scywgdW5pcXVlKTsKICAgICAgICBpZiAoIURC\nSWRlbnRpZmllci5pc051bGwoc1NlY29uZGFyeSkpCiAgICAgICAgICAgIGZt\nLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVJZGVudGlmaWVyKHNTZWNvbmRh\ncnkpOwogICAgICAgIFN0cmluZyBtYXBwZWRCeUlkVmFsdWUgPSBmbS5nZXRN\nYXBwZWRCeUlkVmFsdWUoKTsKICAgICAgICBpZiAobWFwcGVkQnlJZFZhbHVl\nICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gcGtzID0g\nZm0uZ2V0RGVmaW5pbmdNYXBwaW5nKCkuZ2V0UHJpbWFyeUtleUZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICAgICAgcGtzWzBdLnNldE1hcHNJZENvbHModHJ1\nZSk7CiAgICAgICAgICAgIGlmIChtYXBwZWRCeUlkVmFsdWUubGVuZ3RoKCkg\nPT0gMCkgeyAKICAgICAgICAgICAgICAgIHBrc1swXS5nZXRWYWx1ZUluZm8o\nKS5zZXRNYXBzSWRDb2x1bW5zKGNvbHMpOwogICAgICAgICAgICB9IGVsc2Ug\neyAKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZyBlbWJlZGRlZE1ldGEg\nPSAoQ2xhc3NNYXBwaW5nKXBrc1swXS5nZXRWYWx1ZSgpLmdldEVtYmVkZGVk\nTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIGlmIChlbWJlZGRlZE1ldGEg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZyBm\nbWQgPSBlbWJlZGRlZE1ldGEuZ2V0RmllbGRNYXBwaW5nKG1hcHBlZEJ5SWRW\nYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZtZCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0VmFsdWVJbmZvKCkuc2V0\nTWFwc0lkQ29sdW1ucyhjb2xzKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0\naGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBDb2x1\nbW4gbmV3Q29sdW1uKEpvaW5Db2x1bW4gam9pbikgewogICAgICAgIENvbHVt\nbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldElk\nZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbihqb2luLm5hbWUoKSwg\nZGVsaW1pdCgpKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNl\ndFR5cGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW5EZWZpbml0\naW9uKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKSk7IAogICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1l\nKCkpKQogICAgICAgICAgICBjb2wuc2V0VGFyZ2V0SWRlbnRpZmllcihEQklk\nZW50aWZpZXIubmV3Q29sdW1uKGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUo\nKSwgZGVsaW1pdCgpKSk7CiAgICAgICAgY29sLnNldE5vdE51bGwoIWpvaW4u\nbnVsbGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdf\nVU5JTlNFUlRBQkxFLCAham9pbi5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNv\nbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAham9pbi51cGRh\ndGFibGUoKSk7CiAgICAgICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIEBLZXlDb2x1bW4ocykuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZUtleUNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLCBLZXlD\nb2x1bW4uLi4gcGNvbHMpIHsKICAgICAgICBpZiAocGNvbHMubGVuZ3RoID09\nIDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdDxDb2x1bW4+\nIGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4ocGNvbHMubGVuZ3RoKTsK\nICAgICAgICBpbnQgdW5pcXVlID0gMDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbHMu\nYWRkKG5ld0NvbHVtbihwY29sc1tpXSwgZGVsaW1pdCgpKSk7CiAgICAgICAg\nICAgIHVuaXF1ZSB8PSAocGNvbHNbaV0udW5pcXVlKCkpID8gVFJVRSA6IEZB\nTFNFOwogICAgICAgIH0KICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRL\nZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVt\nbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4o\nS2V5Q29sdW1uIGFubm8sIGJvb2xlYW4gZGVsaW1pdCkgewogICAgICAgIENv\nbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KGFubm8ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNl\ndElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbihhbm5vLm5hbWUo\nKSwgZGVsaW1pdCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShhbm5vLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5z\nZXRUeXBlSWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uRGVmaW5p\ndGlvbihhbm5vLmNvbHVtbkRlZmluaXRpb24oKSkpOwogICAgICAgIGlmIChh\nbm5vLnByZWNpc2lvbigpICE9IDApCiAgICAgICAgICAgIGNvbC5zZXRTaXpl\nKGFubm8ucHJlY2lzaW9uKCkpOwogICAgICAgIGVsc2UgaWYgKGFubm8ubGVu\nZ3RoKCkgIT0gMjU1KQogICAgICAgICAgICBjb2wuc2V0U2l6ZShhbm5vLmxl\nbmd0aCgpKTsKICAgICAgICBjb2wuc2V0Tm90TnVsbCghYW5uby5udWxsYWJs\nZSgpKTsKICAgICAgICBjb2wuc2V0RGVjaW1hbERpZ2l0cyhhbm5vLnNjYWxl\nKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJU\nQUJMRSwgIWFubm8uaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wuc2V0Rmxh\nZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWFubm8udXBkYXRhYmxlKCkp\nOwogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBnaXZlbiBAUHJpbWFyeUtleUpvaW5Db2x1bW4gYW5ub3RhdGlvbnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVByaW1hcnlLZXlKb2lu\nQ29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgUHJpbWFyeUtleUpv\naW5Db2x1bW4uLi4gam9pbnMpIHsKICAgICAgICBMaXN0PENvbHVtbj4gY29s\ncyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAg\nICAgIGZvciAoUHJpbWFyeUtleUpvaW5Db2x1bW4gam9pbiA6IGpvaW5zKQog\nICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbikpOwogICAgICAg\nIHNldENvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCBjb2xzLCAwKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdpdmVuIEBYSm9pbkNvbHVt\nbiBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFy\nc2VYSm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLCBNYXBwaW5nSW5mbyBp\nbmZvLAogICAgICAgIGJvb2xlYW4gc2Vjb25kYXJ5QWxsb3dlZCwgWEpvaW5D\nb2x1bW4uLi4gam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMubGVuZ3RoID09\nIDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdDxDb2x1bW4+\nIGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9pbnMubGVuZ3RoKTsK\nICAgICAgICBpbnQgdW5pcXVlID0gMDsKICAgICAgICBEQklkZW50aWZpZXIg\nc1NlY29uZGFyeSA9IERCSWRlbnRpZmllci5OVUxMOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgY29scy5hZGQobmV3Q29sdW1uKGpvaW5zW2ldLCBkZWxpbWl0KCkpKTsK\nICAgICAgICAgICAgdW5pcXVlIHw9IChqb2luc1tpXS51bmlxdWUoKSkgPyBU\nUlVFIDogRkFMU0U7CiAgICAgICAgICAgIHNTZWNvbmRhcnkgPSB0cmFja1Nl\nY29uZGFyeVRhYmxlKGZtLCBzU2Vjb25kYXJ5LAogICAgICAgICAgICAgICAg\nREJJZGVudGlmaWVyLm5ld1RhYmxlKGpvaW5zW2ldLnRhYmxlKCksIGRlbGlt\naXQoKSksIGkpOwogICAgICAgICAgICBpZiAoIXNlY29uZGFyeUFsbG93ZWQg\nJiYgIURCSWRlbnRpZmllci5pc051bGwoc1NlY29uZGFyeSkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1zZWNvbmQiLCBmbSkpOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29s\ndW1ucyhmbSwgaW5mbywgY29scywgdW5pcXVlKTsKICAgICAgICBpZiAoIURC\nSWRlbnRpZmllci5pc051bGwoc1NlY29uZGFyeSkpCiAgICAgICAgICAgIGZt\nLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVJZGVudGlmaWVyKHNTZWNvbmRh\ncnkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVt\nYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5v\ndGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3\nQ29sdW1uKFhKb2luQ29sdW1uIGpvaW4sIGJvb2xlYW4gZGVsaW1pdCkgewog\nICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYg\nKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAg\nICAgY29sLnNldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbihq\nb2luLm5hbWUoKSwgZGVsaW1pdCkpOwogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAg\nICAgIGNvbC5zZXRUeXBlSWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29s\ndW1uRGVmaW5pdGlvbihqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLnJlZmVyZW5jZWRD\nb2x1bW5OYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0VGFyZ2V0SWRlbnRp\nZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uKGpvaW4ucmVmZXJlbmNlZENv\nbHVtbk5hbWUoKSwgZGVsaW1pdCkpOwogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShqb2luLnJlZmVyZW5jZWRBdHRyaWJ1dGVOYW1lKCkpKQog\nICAgICAgICAgICBjb2wuc2V0VGFyZ2V0RmllbGQoam9pbi5yZWZlcmVuY2Vk\nQXR0cmlidXRlTmFtZSgpKTsKICAgICAgICBjb2wuc2V0Tm90TnVsbCgham9p\nbi5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxB\nR19VTklOU0VSVEFCTEUsICFqb2luLmluc2VydGFibGUoKSk7CiAgICAgICAg\nY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUsICFqb2luLnVw\nZGF0YWJsZSgpKTsKICAgICAgICByZXR1cm4gY29sOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgZW1iZWRkZWQgaW5mbyBmb3IgdGhlIGdpdmVuIG1h\ncHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUVtYmVkZGVk\nTWFwcGluZyhGaWVsZE1hcHBpbmcgZm0sIEVtYmVkZGVkTWFwcGluZyBhbm5v\nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGVtYmVkID0gZm0uZ2V0RW1iZWRk\nZWRNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVtYmVkID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm90LWVtYmVkZGVkIiwgZm0pKTsKCiAgICAgICAgRmllbGRNYXBwaW5nIGVm\nbTsKICAgICAgICBmb3IgKE1hcHBpbmdPdmVycmlkZSBvdmVyIDogYW5uby5v\ndmVycmlkZXMoKSkgewogICAgICAgICAgICBlZm0gPSBlbWJlZC5nZXRGaWVs\nZE1hcHBpbmcob3Zlci5uYW1lKCkpOwogICAgICAgICAgICBpZiAoZWZtID09\nIG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImVtYmVkLW92ZXJyaWRlLW5hbWUiLAogICAgICAg\nICAgICAgICAgICAgIGZtLCBvdmVyLm5hbWUoKSkpOwogICAgICAgICAgICBw\nb3B1bGF0ZShlZm0sIG92ZXIpOwogICAgICAgIH0KCiAgICAgICAgREJJZGVu\ndGlmaWVyIG51bGxJbmQgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5udWxsSW5kaWNhdG9yQXR0\ncmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgbnVsbEluZCA9IERCSWRlbnRp\nZmllci5uZXdDb25zdGFudChhbm5vLm51bGxJbmRpY2F0b3JBdHRyaWJ1dGVO\nYW1lKCkpOwogICAgICAgIGVsc2UgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGFubm8ubnVsbEluZGljYXRvckNvbHVtbk5hbWUoKSkpCiAgICAgICAgICAg\nIG51bGxJbmQgPSBEQklkZW50aWZpZXIubmV3Q29sdW1uKGFubm8ubnVsbElu\nZGljYXRvckNvbHVtbk5hbWUoKSwgZGVsaW1pdCgpKTsKICAgICAgICBpZiAo\nREJJZGVudGlmaWVyLmlzTnVsbChudWxsSW5kKSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIGluZm8gPSBmbS5nZXRW\nYWx1ZUluZm8oKTsKICAgICAgICBwb3B1bGF0ZU51bGxJbmRpY2F0b3IobnVs\nbEluZCwgaW5mbyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBlbWJl\nZGRlZCBpbmZvIGZvciB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlRW1iZWRkZWRNYXBwaW5nKFZhbHVlTWFwcGlu\nZyB2bSwgCiAgICAgICAgREJJZGVudGlmaWVyIG51bGxJbmRpY2F0b3JBdHRy\naWJ1dGUsIERCSWRlbnRpZmllciBudWxsSW5kaWNhdG9yQ29sdW1uLAogICAg\nICAgIFhNYXBwaW5nT3ZlcnJpZGVbXSBvdmVycmlkZXMpIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgZW1iZWQgPSB2bS5nZXRFbWJlZGRlZE1hcHBpbmcoKTsK\nICAgICAgICBpZiAoZW1iZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW1iZWRkZWQi\nLCB2bSkpOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZWZtOwogICAgICAgIGZv\nciAoWE1hcHBpbmdPdmVycmlkZSBvdmVyIDogb3ZlcnJpZGVzKSB7CiAgICAg\nICAgICAgIGVmbSA9IGVtYmVkLmdldEZpZWxkTWFwcGluZyhvdmVyLm5hbWUo\nKSk7CiAgICAgICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1i\nZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdm0sIG92\nZXIubmFtZSgpKSk7CiAgICAgICAgICAgIHBvcHVsYXRlKGVmbSwgb3Zlcik7\nCiAgICAgICAgfQoKICAgICAgICBEQklkZW50aWZpZXIgbnVsbEluZCA9IERC\nSWRlbnRpZmllci5OVUxMOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlz\nRW1wdHkobnVsbEluZGljYXRvckF0dHJpYnV0ZSkpCiAgICAgICAgICAgIG51\nbGxJbmQgPSBudWxsSW5kaWNhdG9yQXR0cmlidXRlOwogICAgICAgIGVsc2Ug\naWYgKCFEQklkZW50aWZpZXIuaXNFbXB0eShudWxsSW5kaWNhdG9yQ29sdW1u\nKSkKICAgICAgICAgICAgbnVsbEluZCA9IG51bGxJbmRpY2F0b3JDb2x1bW47\nCiAgICAgICAgaWYgKERCSWRlbnRpZmllci5pc051bGwobnVsbEluZCkpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyBp\nbmZvID0gdm0uZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgcG9wdWxhdGVOdWxs\nSW5kaWNhdG9yKG51bGxJbmQsIGluZm8pOwogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBwb3B1bGF0ZU51bGxJbmRpY2F0b3IoREJJZGVudGlmaWVyIG51bGxJ\nbmQsIFZhbHVlTWFwcGluZ0luZm8gaW5mbykgewogICAgICAgIGlmICgiZmFs\nc2UiLmVxdWFscyhudWxsSW5kLmdldE5hbWUoKSkpCiAgICAgICAgICAgIGlu\nZm8uc2V0Q2FuSW5kaWNhdGVOdWxsKGZhbHNlKTsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAg\nICAgICAgaWYgKCEidHJ1ZSIuZXF1YWxzKG51bGxJbmQuZ2V0TmFtZSgpKSkK\nICAgICAgICAgICAgICAgIGNvbC5zZXRJZGVudGlmaWVyKG51bGxJbmQpOwog\nICAgICAgICAgICBpbmZvLnNldENvbHVtbnMoQXJyYXlzLmFzTGlzdChuZXcg\nQ29sdW1uW117IGNvbCB9KSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgQENvbnRhaW5lclRhYmxlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBwYXJzZUNvbnRhaW5lclRhYmxlKEZpZWxkTWFwcGluZyBm\nbSwgQ29udGFpbmVyVGFibGUgY3RibCkgewogICAgICAgIERCSWRlbnRpZmll\nciB0YmxOYW1lID0gdG9UYWJsZUlkZW50aWZpZXIoY3RibC5zY2hlbWEoKSwg\nY3RibC5uYW1lKCkpOwogICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0\nVGFibGVJZGVudGlmaWVyKHRibE5hbWUpOwogICAgICAgIHBhcnNlWEpvaW5D\nb2x1bW5zKGZtLCBmbS5nZXRNYXBwaW5nSW5mbygpLCBmYWxzZSwgY3RibC5q\nb2luQ29sdW1ucygpKTsKICAgICAgICBpZiAoY3RibC5qb2luRm9yZWlnbktl\neSgpLnNwZWNpZmllZCgpKQogICAgICAgICAgICBwYXJzZUZvcmVpZ25LZXko\nZm0uZ2V0TWFwcGluZ0luZm8oKSwgY3RibC5qb2luRm9yZWlnbktleSgpKTsK\nICAgICAgICBpZiAoY3RibC5qb2luSW5kZXgoKS5zcGVjaWZpZWQoKSkKICAg\nICAgICAgICAgcGFyc2VJbmRleChmbS5nZXRNYXBwaW5nSW5mbygpLCBjdGJs\nLmpvaW5JbmRleCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBD\nb2xsZWN0aW9uVGFibGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBh\ncnNlQ29sbGVjdGlvblRhYmxlKEZpZWxkTWFwcGluZyBmbSwgQ29sbGVjdGlv\nblRhYmxlIGN0YmwpIHsKICAgICAgICBGaWVsZE1hcHBpbmdJbmZvIGluZm8g\nPSBmbS5nZXRNYXBwaW5nSW5mbygpOyAKICAgICAgICBEQklkZW50aWZpZXIg\ndGJsTmFtZSA9IHRvVGFibGVJZGVudGlmaWVyKGN0Ymwuc2NoZW1hKCksIGN0\nYmwubmFtZSgpKTsKICAgICAgICBpbmZvLnNldFRhYmxlSWRlbnRpZmllcih0\nYmxOYW1lKTsKICAgICAgICAvL2N0YmwuY2F0YWxvZygpCiAgICAgICAgcGFy\nc2VKb2luQ29sdW1ucyhmbSwgZm0uZ2V0TWFwcGluZ0luZm8oKSwgZmFsc2Us\nIGN0Ymwuam9pbkNvbHVtbnMoKSk7CiAgICAgICAgYWRkVW5pcXVlQ29uc3Ry\nYWludHMoaW5mby5nZXRUYWJsZUlkZW50aWZpZXIoKS5nZXROYW1lKCksIGZt\nLmdldERlZmluaW5nTWV0YURhdGEoKSwgCiAgICAgICAgICAgIGluZm8sIGN0\nYmwudW5pcXVlQ29uc3RyYWludHMoKSk7CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogUGFyc2UgQG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5q\nZGJjLk9yZGVyQ29sdW1uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VPcmRlckNvbHVtbihGaWVsZE1hcHBpbmcgZm0sIE9yZGVyQ29sdW1uIG9y\nZGVyKSB7CiAgICAgICAgaWYgKCFvcmRlci5lbmFibGVkKCkpIHsKICAgICAg\nICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRDYW5PcmRlckNvbHVtbihm\nYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KG9yZGVyLm5hbWUoKSkpCiAgICAgICAgICAgIGNv\nbC5zZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW4ob3JkZXIu\nbmFtZSgpLCBkZWxpbWl0KCkpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkob3JkZXIuY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAg\nICAgY29sLnNldFR5cGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1\nbW5EZWZpbml0aW9uKG9yZGVyLmNvbHVtbkRlZmluaXRpb24oKSkpOyAKICAg\nICAgICBpZiAob3JkZXIucHJlY2lzaW9uKCkgIT0gMCkKICAgICAgICAgICAg\nY29sLnNldFNpemUob3JkZXIucHJlY2lzaW9uKCkpOwogICAgICAgIGNvbC5z\nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIW9yZGVyLmluc2Vy\ndGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5V\nUERBVEFCTEUsICFvcmRlci51cGRhdGFibGUoKSk7CiAgICAgICAgZm0uZ2V0\nTWFwcGluZ0luZm8oKS5zZXRPcmRlckNvbHVtbihjb2wpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFBhcnNlIEBqYXZheC5wZXJzaXN0ZW5jZS5PcmRl\nckNvbHVtbgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VKYXZheE9y\nZGVyQ29sdW1uKEZpZWxkTWFwcGluZyBmbSwgCiAgICAgICAgamF2YXgucGVy\nc2lzdGVuY2UuT3JkZXJDb2x1bW4gb3JkZXIpIHsKICAgICAgICAKICAgICAg\nICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShvcmRlci5uYW1lKCkpKQogICAgICAgICAgICBj\nb2wuc2V0SWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uKG9yZGVy\nLm5hbWUoKSwgZGVsaW1pdCgpKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KG9yZGVyLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAg\nICAgIGNvbC5zZXRUeXBlSWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29s\ndW1uRGVmaW5pdGlvbihvcmRlci5jb2x1bW5EZWZpbml0aW9uKCkpKTsKICAg\nICAgICBjb2wuc2V0Tm90TnVsbCghb3JkZXIubnVsbGFibGUoKSk7CiAgICAg\nICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhb3Jk\nZXIuaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4u\nRkxBR19VTlVQREFUQUJMRSwgIW9yZGVyLnVwZGF0YWJsZSgpKTsKICAgICAg\nICAKICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldE9yZGVyQ29sdW1u\nKGNvbCk7ICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBF\nbGVtZW50Sm9pbkNvbHVtbihzKS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgcGFyc2VFbGVtZW50Sm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLAog\nICAgICAgIEVsZW1lbnRKb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAg\naWYgKGpvaW5zLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1\nbW4+KGpvaW5zLmxlbmd0aCk7CiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbnNbaV0sIGRl\nbGltaXQoKSkpOwogICAgICAgICAgICB1bmlxdWUgfD0gKGpvaW5zW2ldLnVu\naXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICB9CiAgICAgICAgc2V0\nQ29sdW1ucyhmbSwgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUlu\nZm8oKSwgY29scywgdW5pcXVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJv\nbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgQ29sdW1uIG5ld0NvbHVtbihFbGVtZW50Sm9pbkNvbHVtbiBqb2lu\nLCBib29sZWFuIGRlbGltaXQpIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3\nIENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShq\nb2luLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRJZGVudGlmaWVyKERC\nSWRlbnRpZmllci5uZXdDb2x1bW4oam9pbi5uYW1lKCksIGRlbGltaXQpKTsK\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5jb2x1bW5E\nZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZUlkZW50aWZp\nZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbkRlZmluaXRpb24oam9pbi5jb2x1\nbW5EZWZpbml0aW9uKCkpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKSkKICAgICAgICAg\nICAgY29sLnNldFRhcmdldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0Nv\nbHVtbihqb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCksIGRlbGltaXQpKTsK\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVu\nY2VkQXR0cmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdl\ndEZpZWxkKGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSk7CiAgICAg\nICAgY29sLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUoKSk7CiAgICAgICAg\nY29sLnNldEZsYWcgKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWpvaW4u\naW5zZXJ0YWJsZSAoKSk7CgkJY29sLnNldEZsYWcgKENvbHVtbi5GTEFHX1VO\nVVBEQVRBQkxFLCAham9pbi51cGRhdGFibGUgKCkpOwoJCXJldHVybiBjb2w7\nCgl9CiAgICAKICAgIC8qKgogICAgICogUGFyc2UgQE1hcEtleUNvbHVtbi4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VNYXBLZXlDb2x1bW4o\nRmllbGRNYXBwaW5nIGZtLCBNYXBLZXlDb2x1bW4gYW5ubykgewogICAgICAg\nIGludCB1bmlxdWUgPSAwOwogICAgICAgIEZpZWxkTWFwcGluZ0luZm8gaW5m\nbyA9IGZtLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgaWYgKGFubm8udGFi\nbGUoKSAhPSBudWxsICYmIGFubm8udGFibGUoKS5sZW5ndGgoKSA+IDApIHsK\nICAgICAgICAgICAgaW5mby5zZXRUYWJsZUlkZW50aWZpZXIoREJJZGVudGlm\naWVyLm5ld1RhYmxlKGFubm8udGFibGUoKSwgZGVsaW1pdCgpKSk7CiAgICAg\nICAgfQogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAg\nICAgc2V0dXBNYXBLZXlDb2x1bW4oZm0sIGNvbCwgYW5ubyk7CiAgICAgICAg\ndW5pcXVlIHw9IChhbm5vLnVuaXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAg\nICAgICBzZXRNYXBLZXlDb2x1bW4oZm0sIGZtLmdldEtleU1hcHBpbmcoKS5n\nZXRWYWx1ZUluZm8oKSwgY29sLCB1bmlxdWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0dXAgdGhlIGdpdmVuIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9u\nIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBzZXR1cE1hcEtleUNvbHVtbihGaWVsZE1hcHBpbmcgZm0sIENv\nbHVtbiBjb2wsIAogICAgICAgIE1hcEtleUNvbHVtbiBhbm5vKSB7CiAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubmFtZSgpKSkgewog\nICAgICAgICAgICBjb2wuc2V0SWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3\nQ29sdW1uKGFubm8ubmFtZSgpLCBkZWxpbWl0KCkpKTsKICAgICAgICB9CiAg\nICAgICAgZWxzZSAKICAgICAgICAgICAgY29sLnNldElkZW50aWZpZXIoREJJ\nZGVudGlmaWVyLm5ld0NvbHVtbihmbS5nZXROYW1lKCkgKyAiXyIgKyAiS0VZ\nIiwgZGVsaW1pdCgpKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGFubm8uY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29s\nLnNldFR5cGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW5EZWZp\nbml0aW9uKGFubm8uY29sdW1uRGVmaW5pdGlvbigpKSk7CiAgICAgICAgaWYg\nKGFubm8ucHJlY2lzaW9uKCkgIT0gMCkKICAgICAgICAgICAgY29sLnNldFNp\nemUoYW5uby5wcmVjaXNpb24oKSk7CiAgICAgICAgZWxzZSBpZiAoYW5uby5s\nZW5ndGgoKSAhPSAyNTUpCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8u\nbGVuZ3RoKCkpOwogICAgICAgIGNvbC5zZXROb3ROdWxsKCFhbm5vLm51bGxh\nYmxlKCkpOwogICAgICAgIGNvbC5zZXREZWNpbWFsRGlnaXRzKGFubm8uc2Nh\nbGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNF\nUlRBQkxFLCAhYW5uby5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRG\nbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhYW5uby51cGRhdGFibGUo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIG1hcCBr\nZXkgY29sdW1uIGFzIHRoZSBtYXAga2V5IGNvbHVtbiBmb3IgPGNvZGU+Zm08\nL2NvZGU+LgogICAgICoKICAgICAqIEBwYXJhbSB1bmlxdWUgYml0d2lzZSBj\nb21iaW5hdGlvbiBvZiBUUlVFIGFuZCBGQUxTRSBmb3IgdGhlCiAgICAgKiB1\nbmlxdWUgYXR0cmlidXRlIG9mIHRoZSBjb2x1bW4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgc2V0TWFwS2V5Q29sdW1uKEZpZWxkTWFwcGluZyBmbSwg\nTWFwcGluZ0luZm8gaW5mbywKICAgICAgICBDb2x1bW4gY29sLCBpbnQgdW5p\ncXVlKSB7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBuZXcgQXJyYXlM\naXN0PENvbHVtbj4oKTsKICAgICAgICBjb2xzLmFkZChjb2wpOwogICAgICAg\nIGluZm8uc2V0Q29sdW1ucyhjb2xzKTsKICAgICAgICBpZiAodW5pcXVlID09\nIFRSVUUpCiAgICAgICAgICAgIGluZm8uc2V0VW5pcXVlKG5ldyBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlKCkpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFBhcnNlIEBNYXBLZXlKb2luQ29sdW1uKHMpLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYXBLZXlKb2luQ29sdW1u\ncyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgICAgIE1hcEtleUpvaW5Db2x1\nbW4uLi4gam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdDxDb2x1bW4+IGNv\nbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9pbnMubGVuZ3RoKTsKICAg\nICAgICBpbnQgdW5pcXVlID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbHMuYWRk\nKG5ld0NvbHVtbihqb2luc1tpXSkpOwogICAgICAgICAgICB1bmlxdWUgfD0g\nKGpvaW5zW2ldLnVuaXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICB9\nCiAgICAgICAgc2V0Q29sdW1ucyhmbSwgZm0uZ2V0S2V5TWFwcGluZygpLmdl\ndFZhbHVlSW5mbygpLCBjb2xzLCB1bmlxdWUpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqICBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRoIGlu\nZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgQ29sdW1uIG5ld0NvbHVtbihNYXBLZXlKb2luQ29sdW1u\nIGpvaW4pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5u\nZXdDb2x1bW4oam9pbi5uYW1lKCksIGRlbGltaXQoKSkpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24o\nKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlSWRlbnRpZmllcihEQklkZW50\naWZpZXIubmV3Q29sdW1uRGVmaW5pdGlvbihqb2luLmNvbHVtbkRlZmluaXRp\nb24oKSkpOyAKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9p\nbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNl\ndFRhcmdldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbihqb2lu\nLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCksIGRlbGltaXQoKSkpOyAKICAgICAg\nICBjb2wuc2V0Tm90TnVsbCgham9pbi5udWxsYWJsZSgpKTsKICAgICAgICBj\nb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFqb2luLmlu\nc2VydGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdf\nVU5VUERBVEFCTEUsICFqb2luLnVwZGF0YWJsZSAoKSk7CiAgICAgICAgcmV0\ndXJuIGNvbDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBT\ndHJpbmcgbm9ybWFsaXplU2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1lKSB7\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc2VxTmFtZSkpIHsK\nICAgICAgICAgICAgcmV0dXJuIHNlcU5hbWU7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBEQklkZW50aWZpZXIubmV3U2VxdWVuY2Uoc2VxTmFtZSwgZGVs\naW1pdCgpKS5nZXROYW1lKCk7CiAgICB9CiAgICAKICAgIEBPdmVycmlkZQog\nICAgcHJvdGVjdGVkIFN0cmluZyBub3JtYWxpemVTY2hlbWFOYW1lKFN0cmlu\nZyBzY2hOYW1lKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\nc2NoTmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHNjaE5hbWU7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBEQklkZW50aWZpZXIubmV3U2NoZW1hKHNj\naE5hbWUsIGRlbGltaXQoKSkuZ2V0TmFtZSgpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHJvdGVjdGVkIFN0cmluZyBub3JtYWxpemVDYXRhbG9nTmFt\nZShTdHJpbmcgY2F0TmFtZSkgewogICAgICAgIGlmIChTdHJpbmdVdGlscy5p\nc0VtcHR5KGNhdE5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiBjYXROYW1l\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gREJJZGVudGlmaWVyLm5ld0Nh\ndGFsb2coY2F0TmFtZSwgZGVsaW1pdCgpKS5nZXROYW1lKCk7CiAgICB9Cgog\nICAgcHJpdmF0ZSBib29sZWFuIGRlbGltaXQoKSB7CiAgICAgICAgcmV0dXJu\nIF9kaWN0LmdldERlbGltaXRJZGVudGlmaWVycygpOwogICAgfQp9Cg==\n","encoding":"base64"}

