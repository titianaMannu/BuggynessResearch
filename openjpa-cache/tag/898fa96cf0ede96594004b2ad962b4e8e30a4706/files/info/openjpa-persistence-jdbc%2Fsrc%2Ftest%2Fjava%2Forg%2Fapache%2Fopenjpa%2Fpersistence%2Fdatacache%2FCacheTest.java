{"sha":"f78696b6cd9b8a022528e10b1d6594cdfd795b61","node_id":"MDQ6QmxvYjIwNjM2NDpmNzg2OTZiNmNkOWI4YTAyMjUyOGUxMGIxZDY1OTRjZGZkNzk1YjYx","size":59295,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f78696b6cd9b8a022528e10b1d6594cdfd795b61","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuZGF0YWNh\nY2hlOwoKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBv\ncnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNl\ndDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0\nIGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnRp\ndHlNYW5hZ2VyOwoKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lz\ndGVuY2UuZGF0YWNhY2hlLmNvbW1vbi5hcHBzLkFwcElkQ2FjaGVPYmplY3Q7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuZGF0YWNh\nY2hlLmNvbW1vbi5hcHBzLkNhY2hlT2JqZWN0QTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMu\nQ2FjaGVPYmplY3RBQ2hpbGQxOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnBlcnNpc3RlbmNlLmRhdGFjYWNoZS5jb21tb24uYXBwcy5DYWNoZU9iamVj\ndEFDaGlsZDI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVu\nY2UuZGF0YWNhY2hlLmNvbW1vbi5hcHBzLkNhY2hlT2JqZWN0QjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29t\nbW9uLmFwcHMuQ2FjaGVPYmplY3RCQ2hpbGQxOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLmRhdGFjYWNoZS5jb21tb24uYXBwcy5D\nYWNoZU9iamVjdEM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lz\ndGVuY2UuZGF0YWNhY2hlLmNvbW1vbi5hcHBzLkNhY2hlT2JqZWN0RDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUu\nY29tbW9uLmFwcHMuQ2FjaGVPYmplY3RFOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnBlcnNpc3RlbmNlLmRhdGFjYWNoZS5jb21tb24uYXBwcy5DYWNo\nZU9iamVjdEY7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVu\nY2UuZGF0YWNhY2hlLmNvbW1vbi5hcHBzLkNhY2hlT2JqZWN0RzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29t\nbW9uLmFwcHMuQ2FjaGVPYmplY3RIOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLmRhdGFjYWNoZS5jb21tb24uYXBwcy4KICAgICAg\nICBDYWNoZU9iamVjdEludGVyZmFjZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVP\nYmplY3RKOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNl\nLmRhdGFjYWNoZS5jb21tb24uYXBwcy5SdW50aW1lVGVzdDE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuY29tbW9uLnV0aWxzLkFi\nc3RyYWN0VGVzdENhc2U7CmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuQXNzZXJ0\naW9uRmFpbGVkRXJyb3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0\nYWNhY2hlLkNvbmN1cnJlbnREYXRhQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZGF0YWNhY2hlLkRhdGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5kYXRhY2FjaGUuRGVsZWdhdGluZ0RhdGFDYWNoZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuUXVlcnlDYWNoZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuVHlwZXNDaGFu\nZ2VkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkRhdGFDYWNoZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLkJyb2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuUENEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5qcHFsLkpQUUxQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5FeHRlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuSlBBRmFjYWRlSGVscGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFF\nbnRpdHlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLk9wZW5KUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5PcGVuSlBBRW50aXR5TWFu\nYWdlckZhY3RvcnlTUEk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVy\nc2lzdGVuY2UuT3BlbkpQQVBlcnNpc3RlbmNlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkNhY2hlTWFwOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlByb3h5RGF0ZTsKCi8qKgogKiAjIyMgc2hvdWxkIGFkZCAx\nLi4xIHJlbGF0aW9uIHRlc3QgIyMjIGFwcCBpZCBjb21wb3VuZCBrZXkgdGVz\ndAogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIENhY2hlVGVzdCBleHRlbmRz\nIEFic3RyYWN0VGVzdENhc2UgewoKICAgIHByaXZhdGUgc3RhdGljIFN0cmlu\nZyBPUklHX05BTUUgPSAib3JpZ05hbWUiOwoKICAgIHByaXZhdGUgc3RhdGlj\nIFN0cmluZyBORVdfTkFNRSA9ICJuZXdOYW1lIjsKCiAgICBwcml2YXRlIHN0\nYXRpYyBpbnQgT1JJR19BR0UgPSAzMDsKCiAgICBwcml2YXRlIHN0YXRpYyBT\ndHJpbmcgT1JJR19QQVJFTlRfTkFNRSA9ICJvcmlnUGFyZW50TmFtZSI7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgaW50IE9SSUdfUEFSRU5UX0FHRSA9IDMxOwoK\nICAgIHByaXZhdGUgT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5IHRpbWVv\ndXRGYWN0b3J5ID0gbnVsbDsKCiAgICBwcml2YXRlIE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyRmFjdG9yeSBmYWN0b3J5ID0gbnVsbDsKCiAgICBwcml2YXRlIE9w\nZW5KUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeSBmYWN0b3J5MiA9IG51bGw7Cgog\nICAgcHJpdmF0ZSBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3M7CgogICAgcHJp\ndmF0ZSBPYmplY3Qgb2lkOwoKICAgIHByaXZhdGUgT2JqZWN0IHBhcmVudE9p\nZDsKCiAgICBwcml2YXRlIE9iamVjdCBvaWR3aXRoY2xhc3M7CgogICAgcHJp\ndmF0ZSBPcGVuSlBBRW50aXR5TWFuYWdlciBlbTsKCiAgICBwcml2YXRlIENh\nY2hlT2JqZWN0QSBhOwoKICAgIHB1YmxpYyBDYWNoZVRlc3QoU3RyaW5nIHRl\nc3QpIHsKICAgICAgICBzdXBlcih0ZXN0LCAiZGF0YWNhY2hlY2FjdHVzYXBw\nIik7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXIoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IChP\ncGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeQogICAgICAgICAgICAuY3Jl\nYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIENsYXNzW10gdG9EZWxldGUgPSBuZXcgQ2xhc3NbXXsgQ2FjaGVPYmplY3RB\nLmNsYXNzLAogICAgICAgICAgICAgICAgQ2FjaGVPYmplY3RCLmNsYXNzLCBD\nYWNoZU9iamVjdEMuY2xhc3MsIENhY2hlT2JqZWN0RC5jbGFzcywKICAgICAg\nICAgICAgICAgIENhY2hlT2JqZWN0RS5jbGFzcywgQ2FjaGVPYmplY3RKLmNs\nYXNzLAogICAgICAgICAgICAgICAgQXBwSWRDYWNoZU9iamVjdC5jbGFzcywg\nfTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0b0RlbGV0ZS5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgc3RhcnRUeChlbSk7CiAg\nICAgICAgICAgICAgICBFeHRlbnQgZSA9IGVtLmNyZWF0ZUV4dGVudCh0b0Rl\nbGV0ZVtpXSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBJdGVyYXRvciBpdCA9\nIGUuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIHdoaWxlIChpdC5oYXNO\nZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICBlbS5yZW1vdmUoaXQubmV4\ndCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVuZFR4\nKGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBqcGFlKSB7CiAgICAgICAgICAgIFRocm93YWJs\nZVtdIHRzID0ganBhZS5nZXROZXN0ZWRUaHJvd2FibGVzKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyB0cyAhPSBudWxsICYmIGkgPCB0cy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdHNbaV0ucHJpbnRTdGFja1Ry\nYWNlKCk7CiAgICAgICAgICAgIH0KLy8JCQlqcGFlLnByaW50U3RhY2tUcmFj\nZSgpOwoKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZEVtKGVtKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBzdHJpbmcgYXJyYXkgb2YgZXh0cmEgY29uZmlndXJhdGlvbiBv\ncHRpb25zIGZvciB0aGUgc3BlY2lmaWVkCiAgICAgKiBjYWNoZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IFN0cmluZ1tdIGdldENvbmZzKCk7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzdHJpbmcgYXJyYXkgb2YgZXh0\ncmEgY29uZmlndXJhdGlvbiBvcHRpb25zIGZvciBhIHNlY29uZCBjYWNoZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IFN0cmluZ1tdIGdldENv\nbmZzMigpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhpcyBj\nYWNoZSBpcyBhIGNvaGVyZW50IG9uZSAob25lIHdoZXJlIGNoYW5nZXMgaW4g\nb25lCiAgICAgKiBjYWNoZSBhcmUgaW1tZWRpYXRlbHkgdmlzaWJsZSBlbHNl\nd2hlcmUpOyBvdGhlcndpc2UgcmV0dXJucyBmYWxzZS4gSW4gdGhlCiAgICAg\nKiBjb250ZXh0IG9mIHRoaXMgdGVzdCBjbGFzcywgY29oZXJlbmNlIGlzIGEg\nc2luZ2xlLUpWTSB0aGluZyBvbmx5LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBpc0NhY2hlQ29oZXJlbnQoKSB7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CgogICAgICAgIC8qCiAgICAgICAgICogT3BlbkpQQSBkb2Vz\nIG5vdCBzZWVtIHRvIHN1cHBvcnQgcGx1cmFsIGNvbmZpZ3VyYXRpb24gcHJv\ncGVydGllcy4gIChBbHRob3VnaCBpdCBzZWVtcwogICAgICAgICAqIHRoYXQg\nS29kbyBkb2VzLi4uKSAgVW50aWwgT3BlbkpQQSBpcyB1cGRhdGVkIHRvIHN1\ncHBvcnQgdGhpcyBtdWx0aXBsZSBjb25maWd1cmF0aW9uCiAgICAgICAgICog\nc2V0dGluZywgdGhlIGZvbGxvd2luZyBjb25maWd1cmF0aW9uIGl0ZW0gd2ls\nbCBiZSBkaXNhYmxlZC4uLgogICAgICAgICAqIAogICAgICAgICAqIFNwZWNp\nZmljYWxseSwgdGhpcyB0eXBlIG9mIGNvbmZpZ3VyYXRpb24gaXMgY3VycmVu\ndGx5IG5vdCBhbGxvd2VkLi4uCiAgICAgICAgICogPHByb3BlcnR5IG5hbWU9\nIm9wZW5qcGEuRGF0YUNhY2hlIiB2YWx1ZT0idHJ1ZSwgdHJ1ZShOYW1lPXh4\neCkiLz4KICAgICAgICAgKi8KICAgICAgICBTdHJpbmdbXSBjb25mcyA9IGdl\ndENvbmZzKCk7Ci8vICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbmZz\nLmxlbmd0aDsgaSA9IGkgKyAyKSB7Ci8vICAgICAgICAgICAgaWYgKCJvcGVu\nanBhLkRhdGFDYWNoZSIuZXF1YWxzKGNvbmZzW2ldKSkKLy8gICAgICAgICAg\nICAgICAgY29uZnNbaSArIDFdICs9Ci8vICAgICAgICAgICAgICAgICAgICAi\nLCB0cnVlKE5hbWU9bm90LXRoZS1kZWZhdWx0LWNhY2hlLCBDYWNoZVNpemU9\nMTApIjsKLy8gICAgICAgIH0KLy8KICAgICAgICBTdHJpbmdbXSBjb25mczIg\nPSBnZXRDb25mczIoKTsKLy8gICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY29uZnMyLmxlbmd0aDsgaSA9IGkgKyAyKSB7Ci8vICAgICAgICAgICAgaWYg\nKCJvcGVuanBhLkRhdGFDYWNoZSIuZXF1YWxzKGNvbmZzMltpXSkpCi8vICAg\nICAgICAgICAgICAgIGNvbmZzMltpICsgMV0gKz0KLy8gICAgICAgICAgICAg\nICAgICAgICIsIHRydWUoTmFtZT1ub3QtdGhlLWRlZmF1bHQtY2FjaGUsIENh\nY2hlU2l6ZT0xMCkiOwovLyAgICAgICAgfQoKICAgICAgICBNYXAgcHJvcHNN\nYXAxID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGNvbmZzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgICAgIHByb3Bz\nTWFwMS5wdXQoY29uZnNbaV0sIGNvbmZzW2kgKyAxXSk7CiAgICAgICAgfQog\nICAgICAgIE1hcCBwcm9wc01hcDIgPSBuZXcgSGFzaE1hcCgpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29uZnMyLmxlbmd0aDsgaSArPSAyKSB7\nCiAgICAgICAgICAgIHByb3BzTWFwMi5wdXQoY29uZnMyW2ldLCBjb25mczJb\naSArIDFdKTsKICAgICAgICB9CgogICAgICAgIGZhY3RvcnkgPSAoT3BlbkpQ\nQUVudGl0eU1hbmFnZXJGYWN0b3J5KSBnZXRFbWYocHJvcHNNYXAxKTsKICAg\nICAgICBmYWN0b3J5MiA9IChPcGVuSlBBRW50aXR5TWFuYWdlckZhY3Rvcnkp\nIGdldEVtZihwcm9wc01hcDIpOwoKICAgICAgICByZXBvcyA9IEpQQUZhY2Fk\nZUhlbHBlci50b0Jyb2tlckZhY3RvcnkoZmFjdG9yeSkuZ2V0Q29uZmlndXJh\ndGlvbigpCiAgICAgICAgICAgIC5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpOwoKICAgICAgICBTdHJpbmdbXSBiaWdnZXJDb25mcyA9IG5ldyBT\ndHJpbmdbY29uZnMubGVuZ3RoICsgMl07CiAgICAgICAgU3lzdGVtLmFycmF5\nY29weShjb25mcywgMCwgYmlnZ2VyQ29uZnMsIDAsIGNvbmZzLmxlbmd0aCk7\nCiAgICAgICAgYmlnZ2VyQ29uZnNbYmlnZ2VyQ29uZnMubGVuZ3RoIC0gMl0g\nPSAib3BlbmpwYS5EYXRhQ2FjaGVUaW1lb3V0IjsKICAgICAgICBiaWdnZXJD\nb25mc1tiaWdnZXJDb25mcy5sZW5ndGggLSAxXSA9ICIxMDAwIjsKICAgICAg\nICBNYXAgcHJvcHNNYXAzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGJpZ2dlckNvbmZzLmxlbmd0aDsgaSArPSAyKSB7\nCiAgICAgICAgICAgIHByb3BzTWFwMy5wdXQoYmlnZ2VyQ29uZnNbaV0sIGJp\nZ2dlckNvbmZzW2kgKyAxXSk7CiAgICAgICAgfQogICAgICAgIHRpbWVvdXRG\nYWN0b3J5ID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeSkgZ2V0RW1m\nKHByb3BzTWFwMyk7CgogICAgICAgIGNsZWFyKCk7CgogICAgICAgIE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyIGVtID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBm\nYWN0b3J5CiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7Cgog\nICAgICAgIENhY2hlT2JqZWN0QSBhOwogICAgICAgIENhY2hlT2JqZWN0QSBh\ncGFyZW50OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHdlIGNhbid0\nIHNwZWNpZnkgdGhpcyBmb3IgVXNlclRyYW5zYWN0aW9uCiAgICAgICAgICAg\nIC8qCiAgICAgICAgICAgICAgICAqIHBtLmN1cnJlbnRUcmFuc2FjdGlvbigp\nLnNldE5vbnRyYW5zYWN0aW9uYWxSZWFkKHRydWUpOwogICAgICAgICAgICAg\nICAgKiBwbS5jdXJyZW50VHJhbnNhY3Rpb24oKS5zZXRPcHRpbWlzdGljKHRy\ndWUpOwogICAgICAgICAgICAgICAgKi8KCi8vCQkJZW0uc2V0Tm9udHJhbnNh\nY3Rpb25hbFJlYWQodHJ1ZSk7Ci8vCQkJZW0uc2V0T3B0aW1pc3RpYyh0cnVl\nKTsKCiAgICAgICAgICAgIGEgPSBuZXcgQ2FjaGVPYmplY3RBKE9SSUdfTkFN\nRSwgT1JJR19BR0UpOwogICAgICAgICAgICBhcGFyZW50ID0gbmV3IENhY2hl\nT2JqZWN0QShPUklHX1BBUkVOVF9OQU1FLCBPUklHX1BBUkVOVF9BR0UpOwog\nICAgICAgICAgICBhLnNldFJlbGF0ZWRPYmplY3QoYXBhcmVudCk7CiAgICAg\nICAgICAgIExpbmtlZExpc3QgY2hpbGRyZW4gPSBuZXcgTGlua2VkTGlzdCgp\nOwogICAgICAgICAgICBjaGlsZHJlbi5hZGQoYSk7CiAgICAgICAgICAgIGFw\nYXJlbnQuc2V0UmVsYXRlZENvbGxlY3Rpb24oY2hpbGRyZW4pOwoKICAgICAg\nICAgICAgc3RhcnRUeChlbSk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYSk7\nCiAgICAgICAgICAgIGVtLnBlcnNpc3QoYXBhcmVudCk7CiAgICAgICAgICAg\nIG9pZCA9IGVtLmdldE9iamVjdElkKGEpOwogICAgICAgICAgICBvaWR3aXRo\nY2xhc3MgPSBuZXcgSWQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQudG9TdHJp\nbmcoKSk7CiAgICAgICAgICAgIHBhcmVudE9pZCA9IGVtLmdldE9iamVjdElk\nKGFwYXJlbnQpOwogICAgICAgICAgICBlbmRUeChlbSk7CiAgICAgICAgfQog\nICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRFbShlbSk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBsb2FkIGFuIG9iamVjdCBpbiBhIHNlcGFyYXRl\nIHBtIGJlZm9yZSB0aGUgdXBkYXRlCiAgICAgICAgLy8gaGFwcGVucy4gVGhp\ncyBzaG91bGQgbm90IGNoYW5nZSwgZWxzZSB3ZSdyZSBpbgogICAgICAgIC8v\nIHZpb2xhdGlvbiBvZiB0aGUgc3BlYy4KICAgICAgICB0aGlzLmVtID0gZmFj\ndG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgc3RhcnRUeCh0\naGlzLmVtKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBPcGVuSlBB\nRW50aXR5TWFuYWdlciBvcGVuRW09KE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSB0\naGlzLmVtOwogICAgICAgICAgICB0aGlzLmEgPSAoQ2FjaGVPYmplY3RBKSB0\naGlzLmVtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOwoKICAgICAg\nICAgICAgLy8gbG9hZCB0aGUgcGFyZW50IGZvciB0ZXN0Q29sbGVjdGlvbnMo\nKS4KICAgICAgICAgICAgQ2FjaGVPYmplY3RBIHJlbCA9IHRoaXMuYS5nZXRS\nZWxhdGVkT2JqZWN0KCk7CiAgICAgICAgICAgIHJlbC5nZXRSZWxhdGVkQ29s\nbGVjdGlvbigpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAg\nICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZFR4KHRoaXMu\nZW0pOwogICAgICAgICAgICAvLyBlbmRFbSh0aGlzLmVtKTsKICAgICAgICB9\nCgogICAgICAgIGVtID0gZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RhcnRUeChlbSk7CiAgICAg\nICAgICAgIGEgPSAoQ2FjaGVPYmplY3RBKSBlbS5maW5kKENhY2hlT2JqZWN0\nQS5jbGFzcywgb2lkKTsKICAgICAgICAgICAgYS5zZXROYW1lKE5FV19OQU1F\nKTsKCiAgICAgICAgICAgIGFwYXJlbnQgPSAoQ2FjaGVPYmplY3RBKSBlbS5m\naW5kKENhY2hlT2JqZWN0QS5jbGFzcywgcGFyZW50T2lkKTsKCiAgICAgICAg\nICAgIENhY2hlT2JqZWN0QSBhMiA9IG5ldyBDYWNoZU9iamVjdEEoT1JJR19O\nQU1FLCBPUklHX0FHRSk7CiAgICAgICAgICAgIGEyLnNldFJlbGF0ZWRPYmpl\nY3QoYXBhcmVudCk7CiAgICAgICAgICAgIGFwYXJlbnQuZ2V0UmVsYXRlZENv\nbGxlY3Rpb24oKS5hZGQoYTIpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGEy\nKTsKICAgICAgICAgICAgZW5kVHgoZW0pOwoKICAgICAgICAgICAgYXNzZXJ0\nTmV3KGEpOwogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kRW0oZW0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB0ZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGVuZEVt\nKGVtKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmFjdG9yeS5jbG9z\nZSgpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmFjdG9yeTIu\nY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgfQogICAgICAgIHN1cGVyLnRlYXJEb3duKCk7CgogICAg\nICAgIGZhY3RvcnkgPSBudWxsOwogICAgICAgIGZhY3RvcnkyID0gbnVsbDsK\nICAgICAgICB0aW1lb3V0RmFjdG9yeSA9IG51bGw7CiAgICAgICAgb2lkID0g\nbnVsbDsKICAgICAgICBwYXJlbnRPaWQgPSBudWxsOwogICAgICAgIGVtID0g\nbnVsbDsKICAgICAgICBhID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0RGVsZXRlZE9uZVRvT25lUmVsYXRpb25zKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRW50aXR5TWFuYWdlciBlbSA9IGZhY3RvcnkuY3Jl\nYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHN0YXJ0VHgoZW0pOwogICAgICAgICAgICBDYWNoZU9iamVjdEEgYSA9IChD\nYWNoZU9iamVjdEEpIGVtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQp\nOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGEuZ2V0UmVsYXRlZE9iamVj\ndCgpKTsKICAgICAgICAgICAgZW0ucmVtb3ZlKGEuZ2V0UmVsYXRlZE9iamVj\ndCgpKTsKICAgICAgICAgICAgZW5kVHgoZW0pOwogICAgICAgIH0KICAgICAg\nICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kRW0oZW0pOwogICAgICAgIH0K\nCiAgICAgICAgRW50aXR5TWFuYWdlciBlbTIgPSBmYWN0b3J5LmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDYWNo\nZU9iamVjdEEgYTIgPSAoQ2FjaGVPYmplY3RBKSBlbTIuZmluZChDYWNoZU9i\namVjdEEuY2xhc3MsIG9pZCk7CiAgICAgICAgICAgIGFzc2VydE51bGwoYTIu\nZ2V0UmVsYXRlZE9iamVjdCgpKTsKICAgICAgICB9CiAgICAgICAgZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZEVtKGVtMik7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHRlc3RDYW5DYWNoZUV4dGVuc2lvbigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IGNhY2hl\nTWFuYWdlcihmYWN0b3J5KS5nZXRTeXN0ZW1EYXRhQ2FjaGUoKTsKCiAgICAg\nICAgLy8gZmlyc3QsIHRlc3QgY2FjaGluZyBvZiBuZXdseSBjcmVhdGVkIG9i\namVjdHMuCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSAoT3Bl\nbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkKICAgICAgICAgICAgLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBPYmplY3QgbzsKICAgICAgICBP\nYmplY3Qgb2lkOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0YXJ0VHgo\nZW0pOwogICAgICAgICAgICBvID0gbmV3IENhY2hlT2JqZWN0QigiZm9vIik7\nCiAgICAgICAgICAgIGVtLnBlcnNpc3Qobyk7CiAgICAgICAgICAgIGVuZFR4\nKGVtKTsKICAgICAgICAgICAgb2lkID0gZW0uZ2V0T2JqZWN0SWQobyk7CiAg\nICAgICAgICAgIGFzc2VydE5vdE51bGwob2lkKTsKICAgICAgICAgICAgYXNz\nZXJ0TnVsbChjYWNoZS5nZXQob2lkKSk7CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRFbShlbSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBub3csIHRlc3QgY2FjaGluZyBvZiBkYXRhIGxvYWRlZCBmcm9t\nIHRoZSBkYXRhIHN0b3JlLgogICAgICAgIGVtID0gZmFjdG9yeS5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbyA9\nIGVtLmZpbmQoQ2FjaGVPYmplY3RCLmNsYXNzLCBvaWQpOwogICAgICAgICAg\nICBhc3NlcnROb3ROdWxsKG8pOwogICAgICAgICAgICBhc3NlcnROdWxsKGNh\nY2hlLmdldChvaWQpKTsKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZEVtKGVtKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgdGVzdEdldENhY2hlKCkgewogICAgICAgIC8vIGZpcnN0LCB0\nZXN0IGNhY2hpbmcgb2YgbmV3bHkgY3JlYXRlZCBvYmplY3RzLgogICAgICAg\nIERhdGFDYWNoZSBkZWZhdWx0Q2FjaGUgPSBjYWNoZU1hbmFnZXIoZmFjdG9y\neSkuZ2V0RGF0YUNhY2hlKAogICAgICAgICAgICBEYXRhQ2FjaGUuTkFNRV9E\nRUZBVUxULCBmYWxzZSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChkZWZhdWx0\nQ2FjaGUpOwoKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBjYWNoZU1hbmFn\nZXIoZmFjdG9yeSkuZ2V0U3lzdGVtRGF0YUNhY2hlKCk7CiAgICAgICAgYXNz\nZXJ0RXF1YWxzKGRlZmF1bHRDYWNoZSwgY2FjaGUpOwoKICAgICAgICBDbGFz\nc01ldGFEYXRhIGFNZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEoQ2FjaGVPYmpl\nY3RBLmNsYXNzLCBudWxsLCB0cnVlKTsKICAgICAgICBDbGFzc01ldGFEYXRh\nIGFDaGlsZDFNZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEoQ2FjaGVPYmplY3RB\nQ2hpbGQxLmNsYXNzLAogICAgICAgICAgICBudWxsLCB0cnVlKTsKICAgICAg\nICBDbGFzc01ldGFEYXRhIGFDaGlsZDJNZXRhID0gcmVwb3MuZ2V0TWV0YURh\ndGEoQ2FjaGVPYmplY3RBQ2hpbGQyLmNsYXNzLAogICAgICAgICAgICBudWxs\nLCB0cnVlKTsKICAgICAgICBDbGFzc01ldGFEYXRhIGJNZXRhID0gcmVwb3Mu\nZ2V0TWV0YURhdGEoQ2FjaGVPYmplY3RCLmNsYXNzLCBudWxsLCB0cnVlKTsK\nICAgICAgICBDbGFzc01ldGFEYXRhIGJDaGlsZDFNZXRhID0gcmVwb3MuZ2V0\nTWV0YURhdGEoQ2FjaGVPYmplY3RCQ2hpbGQxLmNsYXNzLAogICAgICAgICAg\nICBudWxsLCB0cnVlKTsKICAgICAgICBDbGFzc01ldGFEYXRhIGNNZXRhID0g\ncmVwb3MuZ2V0TWV0YURhdGEoQ2FjaGVPYmplY3RDLmNsYXNzLCBudWxsLCB0\ncnVlKTsKICAgICAgICBDbGFzc01ldGFEYXRhIGRNZXRhID0gcmVwb3MuZ2V0\nTWV0YURhdGEoQ2FjaGVPYmplY3RELmNsYXNzLCBudWxsLCB0cnVlKTsKICAg\nICAgICBDbGFzc01ldGFEYXRhIGVNZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEo\nQ2FjaGVPYmplY3RFLmNsYXNzLCBudWxsLCB0cnVlKTsKCiAgICAgICAgY2Fj\naGUgPSBhTWV0YS5nZXREYXRhQ2FjaGUoKTsKICAgICAgICBhc3NlcnRFcXVh\nbHMoZGVmYXVsdENhY2hlLCBjYWNoZSk7CiAgICAgICAgU3lzdGVtLm91dC5w\ncmludGxuKCIqKioqKipEYXRhQ2FjaGVOYW1lOiIKICAgICAgICAgICAgKyBh\nQ2hpbGQyTWV0YS5nZXREYXRhQ2FjaGVOYW1lKCkpOwogICAgICAgIGFzc2Vy\ndE51bGwoYUNoaWxkMk1ldGEuZ2V0RGF0YUNhY2hlKCkpOwoKICAgICAgICBh\nc3NlcnROdWxsKGJNZXRhLmdldERhdGFDYWNoZSgpKTsKCiAgICAgICAgYXNz\nZXJ0RXF1YWxzKGNNZXRhLmdldERhdGFDYWNoZSgpLCBkTWV0YS5nZXREYXRh\nQ2FjaGUoKSk7CiAgICAgICAgaWYgKGRNZXRhLmdldERhdGFDYWNoZSgpIGlu\nc3RhbmNlb2YgQ29uY3VycmVudERhdGFDYWNoZSkgewogICAgICAgICAgICBD\nb25jdXJyZW50RGF0YUNhY2hlIGRDYWNoZUltcGwgPQogICAgICAgICAgICAg\nICAgKENvbmN1cnJlbnREYXRhQ2FjaGUpIGRNZXRhLmdldERhdGFDYWNoZSgp\nOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoMTAsIGRDYWNoZUltcGwuZ2V0\nQ2FjaGVTaXplKCkpOwogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMo\nYU1ldGEuZ2V0RGF0YUNhY2hlKCksIGVNZXRhLmdldERhdGFDYWNoZSgpKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0UHJpbWl0aXZlcygpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSAn\nYScgdGhhdCB3YXMgZm91bmQgYmVmb3JlIGNoYW5nZXMKICAgICAgICAvLyB3\nZXJlIG1hZGUgaXMgc3RpbGwgdmFsaWQuCiAgICAgICAgYXNzZXJ0T2xkKGEp\nOwogICAgICAgIGVtLnJlZnJlc2goYSk7CiAgICAgICAgYXNzZXJ0TmV3KGEp\nOwogICAgfQoKICAgIC8vIEZJWE1FIFNlZXRoYSBTZXAgMjUsMjAwNgogICAg\nLyoKICAgICAgKiBwdWJsaWMgdm9pZCB0ZXN0Q29sbGVjdGlvbnMoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsgQ2FjaGVPYmplY3RBIHBhcmVudCA9CiAgICAgICog\nKENhY2hlT2JqZWN0QSkgZW0uZmluZChDYWNoZU9iamVjdEEuY2xhc3MsT1JJ\nR19QQVJFTlRfTkFNRSk7CiAgICAgICogYXNzZXJ0RXF1YWxzKDEsIHBhcmVu\ndC5nZXRSZWxhdGVkQ29sbGVjdGlvbigpLnNpemUoKSk7CiAgICAgICogZW0u\ncmVmcmVzaChwYXJlbnQpOyBhc3NlcnRFcXVhbHMoMiwKICAgICAgKiBwYXJl\nbnQuZ2V0UmVsYXRlZENvbGxlY3Rpb24oKS5zaXplKCkpOyB9CiAgICAgICov\nCgogICAgLy8gRklYTUUgU2VldGhhIFNlcCAyNSwyMDA2CiAgICAvKgogICAg\nICAqIHB1YmxpYyB2b2lkIHRlc3RFeHBpcmVkQ29sbGVjdGlvbnMoKSB7IENh\nY2hlT2JqZWN0QSBwYXJlbnQgPQogICAgICAqIChDYWNoZU9iamVjdEEpIGVt\nLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLE9SSUdfUEFSRU5UX05BTUUpOwog\nICAgICAqIGVtLnJlZnJlc2gocGFyZW50KTsgQ29sbGVjdGlvbiByZWxhdGVk\nT2lkcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICogZm9yIChJdGVyYXRvciBp\ndGVyID0gcGFyZW50LmdldFJlbGF0ZWRDb2xsZWN0aW9uKCkuaXRlcmF0b3Io\nKTsKICAgICAgKiAgICAgaXRlci5oYXNOZXh0KCk7KSB7CiAgICAgICogcmVs\nYXRlZE9pZHMuYWRkKEpET0hlbHBlci5nZXRPYmplY3RJZChpdGVyLm5leHQo\nKSkpOyB9CiAgICAgICoKICAgICAgKiBDbGFzc01ldGFEYXRhIG1ldGEgPSBy\nZXBvcy5nZXRNZXRhRGF0YShDYWNoZU9iamVjdEEuY2xhc3MsIG51bGwsIHRy\ndWUpOwogICAgICAqIERhdGFDYWNoZSBjYWNoZSA9IG1ldGEuZ2V0RGF0YUNh\nY2hlKCk7CiAgICAgICogIC8vIGRyb3AgdGhlIHJlbGF0ZWQgZGF0YSBmcm9t\nIHRoZSBjYWNoZSBmb3IgKEl0ZXJhdG9yIGl0ZXIgPQogICAgICAqIHJlbGF0\nZWRPaWRzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgY2FjaGUucmVt\nb3ZlKGl0ZXIubmV4dCgpKTsKICAgICAgKgogICAgICAqIFBlcnNpc3RlbmNl\nTWFuYWdlciBwbTIgPSBmYWN0b3J5LmdldFBlcnNpc3RlbmNlTWFuYWdlcigp\nOyB0cnkgewogICAgICAqIGFzc2VydFRydWUoY2FjaGUuY29udGFpbnMocGFy\nZW50T2lkKSk7IHBhcmVudCA9IChDYWNoZU9iamVjdEEpCiAgICAgICogcG0y\nLmdldE9iamVjdEJ5SWQocGFyZW50T2lkLCB0cnVlKTsKICAgICAgKgogICAg\nICAqIHRyeSB7IGZvciAoSXRlcmF0b3IgaXRlciA9IHJlbGF0ZWRPaWRzLml0\nZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykKICAgICAgKiBhc3NlcnRGYWxz\nZShjYWNoZS5jb250YWlucyhpdGVyLm5leHQoKSkpOyB9IGNhdGNoIChBc3Nl\ncnRpb25GYWlsZWRFcnJvcgogICAgICAqIGUpIHsgYnVnKDQ2NywgImRhdGEg\nY2FjaGUgY2FuIG92ZXItZWFnZXJseSBsb2FkIHJlbGF0aW9uIGRhdGEiKTsg\nfSB9CiAgICAgICogZmluYWxseSB7IGNsb3NlKHBtMik7IH0gfQogICAgICAq\nLwoKICAgIHB1YmxpYyB2b2lkIHRlc3RFeHBpcmVkUmVsYXRpb25zKCkgewog\nICAgICAgIENhY2hlT2JqZWN0QSBhID0gKENhY2hlT2JqZWN0QSkgZW0uZmlu\nZChDYWNoZU9iamVjdEEuY2xhc3MsIG9pZCk7CiAgICAgICAgZW0ucmVmcmVz\naChhKTsKICAgICAgICBPYmplY3QgcmVsYXRpb25PaWQgPSBlbS5nZXRPYmpl\nY3RJZChhLmdldFJlbGF0ZWRPYmplY3QoKSk7CiAgICAgICAgcmVsYXRpb25P\naWQgPSBuZXcgSWQoQ2FjaGVPYmplY3RBLmNsYXNzLCByZWxhdGlvbk9pZC50\nb1N0cmluZygpKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVw\nb3MuZ2V0TWV0YURhdGEoQ2FjaGVPYmplY3RBLmNsYXNzLCBudWxsLCB0cnVl\nKTsKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBtZXRhLmdldERhdGFDYWNo\nZSgpOwoKICAgICAgICAvLyBkcm9wIHRoZSByZWxhdGVkIGRhdGEgZnJvbSB0\naGUgY2FjaGUKICAgICAgICBjYWNoZS5yZW1vdmUocmVsYXRpb25PaWQpOwoK\nICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbTIgPSAoT3BlbkpQQUVu\ndGl0eU1hbmFnZXIpIGZhY3RvcnkKICAgICAgICAgICAgLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRU\ncnVlKGNhY2hlLmNvbnRhaW5zKG9pZHdpdGhjbGFzcykpOwogICAgICAgICAg\nICAvL2EgPSAoQ2FjaGVPYmplY3RBKSBlbTIuZmluZChDYWNoZU9iamVjdEEu\nY2xhc3MsIG9pZCk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgYXNzZXJ0RmFsc2UoY2FjaGUuY29udGFpbnMocmVsYXRpb25PaWQpKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoQXNzZXJ0aW9uRmFp\nbGVkRXJyb3IgZSkgewogICAgICAgICAgICAgICAgLy8gYnVnKDQ2NywgImRh\ndGEgY2FjaGUgY2FuIG92ZXItZWFnZXJseSBsb2FkIHJlbGF0aW9uIGRhdGEi\nKTsKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBJIGRv\nbid0IHRoaW5rIHRoaXMgaXMgYSBidWcsIG5vciBzaG91bGQgdGhpcyBleGNl\ncHRpb24KICAgICAgICAgICAgICAgICAqIG9jY3VyLiAgU2luY2Ugd2UncmUg\nZG9pbmcgYSBmaW5kKCkgb3BlcmF0aW9uIGFib3ZlIGFuZCB0aGlzCiAgICAg\nICAgICAgICAgICAgKiBmaWVsZCAoUmVsYXRlZE9iaikgaGFzIGEgZGVmYXVs\ndCBGZXRjaCB0eXBlIG9mIEVBR0VSLCB0aGVuCiAgICAgICAgICAgICAgICAg\nKiB3ZSBzaG91bGQgYmUgcmUtbG9hZGluZyB0aGUgUmVsYXRlZE9iaiBhbmQg\naXQgd2lsbCBiZSBwdXQgYmFjawogICAgICAgICAgICAgICAgICogaW4gdGhl\nIGNhY2hlLi4uICBTbywgYnkgY29tbWVudGluZyBvdXQgdGhlIGFib3ZlIGZp\nbmQoKQogICAgICAgICAgICAgICAgICogb3BlcmF0aW9uIChvciBvdmVycmlk\naW5nIHRoZSBkZWZhdWx0IEZldGNoIHR5cGUgdG8gRUFHRVIpLCB0aGVuCiAg\nICAgICAgICAgICAgICAgKiB0aGlzIGFzc2VydEZhbHNlIHdvcmtzLi4uCiAg\nICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGUucHJpbnRTdGFj\na1RyYWNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZEVtKGVtMik7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RQQ0FycmF5cygpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIG5ld0VtID0g\nKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5CiAgICAgICAgICAgIC5j\ncmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgc3RhcnRUeChuZXdFbSk7CiAgICAgICAgICAgIENhY2hlT2JqZWN0QSBw\nYXJlbnQgPSAoQ2FjaGVPYmplY3RBKSBuZXdFbS5maW5kKENhY2hlT2JqZWN0\nQS5jbGFzcywKICAgICAgICAgICAgICAgIHBhcmVudE9pZCk7CiAgICAgICAg\nICAgIENhY2hlT2JqZWN0QSBhID0gKENhY2hlT2JqZWN0QSkgbmV3RW0uZmlu\nZChDYWNoZU9iamVjdEEuY2xhc3MsIG9pZCk7CiAgICAgICAgICAgIGEuc2V0\nUmVsYXRlZEFycmF5KG5ldyBDYWNoZU9iamVjdEFbXXsgcGFyZW50LCBhIH0p\nOwogICAgICAgICAgICBlbmRUeChuZXdFbSk7CiAgICAgICAgfQogICAgICAg\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRFbShuZXdFbSk7CiAgICAgICAg\nfQoKICAgICAgICBuZXdFbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFj\ndG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVP\nYmplY3RBLmNsYXNzLCBvaWQpOwogICAgICAgICAgICBDYWNoZU9iamVjdEFb\nXSBhcnJheSA9IGEuZ2V0UmVsYXRlZEFycmF5KCk7CiAgICAgICAgICAgIGFz\nc2VydEVxdWFscygyLCBhcnJheS5sZW5ndGgpOwogICAgICAgICAgICBhc3Nl\ncnRUcnVlKGFycmF5WzBdIGluc3RhbmNlb2YgQ2FjaGVPYmplY3RBKTsKICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZShhcnJheVsxXSBpbnN0YW5jZW9mIENhY2hl\nT2JqZWN0QSk7CgogICAgICAgICAgICBPYmplY3QgYXJyYXlPaWQgPSBuZXdF\nbS5nZXRPYmplY3RJZChhcnJheVswXSk7CiAgICAgICAgICAgIGlmICghYXJy\nYXlPaWQuZXF1YWxzKHBhcmVudE9pZCkgJiYgIWFycmF5T2lkLmVxdWFscyhv\naWQpKSB7CiAgICAgICAgICAgICAgICBmYWlsKCJhcnJheSBkb2VzIG5vdCBj\nb250YWluIGNvcnJlY3Qgb2lkcyIpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBhcnJheU9pZCA9IG5ld0VtLmdldE9iamVjdElkKGFycmF5WzFdKTsK\nICAgICAgICAgICAgaWYgKCFhcnJheU9pZC5lcXVhbHMocGFyZW50T2lkKSAm\nJiAhYXJyYXlPaWQuZXF1YWxzKG9pZCkpIHsKICAgICAgICAgICAgICAgIGZh\naWwoImFycmF5IGRvZXMgbm90IGNvbnRhaW4gY29ycmVjdCBvaWRzIik7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZEVtKG5ld0VtKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgdGVzdFN0cmluZ0FycmF5cygpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIG5ld0VtID0gKE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5CiAgICAgICAgICAgIC5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3Rh\ncnRUeChuZXdFbSk7CiAgICAgICAgICAgIENhY2hlT2JqZWN0QSBhID0gKENh\nY2hlT2JqZWN0QSkgbmV3RW0uZmluZChDYWNoZU9iamVjdEEuY2xhc3MsIG9p\nZCk7CiAgICAgICAgICAgIGEuc2V0U3RyaW5nQXJyYXkobmV3IFN0cmluZ1td\neyAic3RyaW5nMCIsICJzdHJpbmcxIiwgInN0cmluZzIiIH0pOwogICAgICAg\nICAgICBlbmRUeChuZXdFbSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICBlbmRFbShuZXdFbSk7CiAgICAgICAgfQoKICAgICAg\nICBuZXdFbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeS5jcmVh\ndGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNs\nYXNzLCBvaWQpOwogICAgICAgICAgICBTdHJpbmdbXSBhcnJheSA9IGEuZ2V0\nU3RyaW5nQXJyYXkoKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDMsIGFy\ncmF5Lmxlbmd0aCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygic3RyaW5n\nMCIsIGFycmF5WzBdKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJzdHJp\nbmcxIiwgYXJyYXlbMV0pOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoInN0\ncmluZzIiLCBhcnJheVsyXSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICBlbmRFbShuZXdFbSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHRlc3RQcmltaXRpdmVBcnJheXMoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBuZXdF\nbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeQogICAgICAgICAg\nICAuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHN0YXJ0VHgobmV3RW0pOwogICAgICAgICAgICBDYWNoZU9iamVj\ndEEgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RB\nLmNsYXNzLCBvaWQpOwogICAgICAgICAgICBhLnNldFByaW1pdGl2ZUFycmF5\nKG5ldyBmbG9hdFtdeyAwLCAxLCAyIH0pOwogICAgICAgICAgICBlbmRUeChu\nZXdFbSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRFbShuZXdFbSk7CiAgICAgICAgfQoKICAgICAgICBuZXdFbSA9IChP\ncGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5h\nZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYSA9IChDYWNoZU9i\namVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOwog\nICAgICAgICAgICBmbG9hdFtdIGFycmF5ID0gYS5nZXRQcmltaXRpdmVBcnJh\neSgpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoMywgYXJyYXkubGVuZ3Ro\nKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDAuMEYsIGFycmF5WzBdLCAw\nKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDEuMEYsIGFycmF5WzFdLCAw\nKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDIuMGYsIGFycmF5WzJdLCAw\nKTsKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZEVtKG5ld0VtKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndGVzdERhdGVBcnJheXMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBP\ncGVuSlBBRW50aXR5TWFuYWdlciBuZXdFbSA9IChPcGVuSlBBRW50aXR5TWFu\nYWdlcikgZmFjdG9yeQogICAgICAgICAgICAuY3JlYXRlRW50aXR5TWFuYWdl\ncigpOwogICAgICAgIENhY2hlT2JqZWN0QSBhOwogICAgICAgIERhdGVbXSBk\nYXRlQXJyYXk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RhcnRUeChu\nZXdFbSk7CiAgICAgICAgICAgIGEgPSAoQ2FjaGVPYmplY3RBKSBuZXdFbS5m\naW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsKICAgICAgICAgICAgZGF0\nZUFycmF5ID0gbmV3IERhdGVbXXsgbmV3IERhdGUoKSwgbmV3IERhdGUoKSwg\nbmV3IERhdGUoKSB9OwogICAgICAgICAgICBhLnNldERhdGVBcnJheShkYXRl\nQXJyYXkpOwogICAgICAgICAgICBlbmRUeChuZXdFbSk7CiAgICAgICAgfQog\nICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRFbShuZXdFbSk7CiAg\nICAgICAgfQoKICAgICAgICBuZXdFbSA9IChPcGVuSlBBRW50aXR5TWFuYWdl\ncikgZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQo\nQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOwogICAgICAgICAgICBEYXRlW10g\nYXJyYXkgPSBhLmdldERhdGVBcnJheSgpOwogICAgICAgICAgICBpZiAoYXJy\nYXlbMF0gPT0gZGF0ZUFycmF5WzBdKSB7CiAgICAgICAgICAgICAgICBmYWls\nKCJkYXRlIG9iamVjdHMgYXJlIHRoZSBzYW1lIik7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZEVt\nKG5ld0VtKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVz\ndERhdGUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBPcGVuSlBBRW50\naXR5TWFuYWdlciBuZXdFbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFj\ndG9yeQogICAgICAgICAgICAuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAg\nICAgIENhY2hlT2JqZWN0QSBhOwogICAgICAgIERhdGUgZDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBzdGFydFR4KG5ld0VtKTsKICAgICAgICAgICAg\nYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNs\nYXNzLCBvaWQpOwogICAgICAgICAgICBkID0gbmV3IERhdGUoKTsKICAgICAg\nICAgICAgYS5zZXREYXRlKGQpOwogICAgICAgICAgICBlbmRUeChuZXdFbSk7\nCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRF\nbShuZXdFbSk7CiAgICAgICAgfQoKICAgICAgICAvLyBzbGVlcCBhIGJpdCBz\nbyB3ZSBjYW4gZW5zdXJlIHRoYXQgdGhlIGRhdGUgZG9lc24ndCBqdXN0CiAg\nICAgICAgLy8gaGFwcGVuIHRvIGJlIHRoZSBzYW1lLgogICAgICAgIFRocmVh\nZC5zbGVlcCgxMDApOwoKICAgICAgICBuZXdFbSA9IChPcGVuSlBBRW50aXR5\nTWFuYWdlcikgZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIG5ld0Vt\nLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOwogICAgICAgICAgICBE\nYXRlIGQyID0gYS5nZXREYXRlKCk7CiAgICAgICAgICAgIGlmIChkID09IGQy\nKSB7CiAgICAgICAgICAgICAgICBmYWlsKCJkYXRlIG9iamVjdHMgYXJlIHRo\nZSBzYW1lIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzc2VydEVx\ndWFscyhkLmdldFRpbWUoKSwgZDIuZ2V0VGltZSgpKTsKICAgICAgICB9CiAg\nICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZEVtKG5ld0VtKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdExvY2FsZSgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2Vy\nIG5ld0VtID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5CiAgICAg\nICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgc3RhcnRU\neChuZXdFbSk7CiAgICAgICAgQ2FjaGVPYmplY3RBIGEgPSAoQ2FjaGVPYmpl\nY3RBKSBuZXdFbS5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsKICAg\nICAgICBMb2NhbGUgbCA9IExvY2FsZS5nZXREZWZhdWx0KCk7CiAgICAgICAg\nYS5zZXRMb2NhbGUobCk7CiAgICAgICAgZW5kVHgobmV3RW0pOwoKICAgICAg\nICBPcGVuSlBBRW50aXR5TWFuYWdlciBuZXdFbTIgPSAoT3BlbkpQQUVudGl0\neU1hbmFnZXIpIGZhY3RvcnkKICAgICAgICAgICAgLmNyZWF0ZUVudGl0eU1h\nbmFnZXIoKTsKCiAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtMi5m\naW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsKICAgICAgICBMb2NhbGUg\nbDIgPSBhLmdldExvY2FsZSgpOwogICAgICAgIC8vIGxvY2FsZXMgYXJlIGlt\nbXV0YWJsZSBhbmQgZmluYWwsIHNvIHRoZSBkaWZmZXJlbnQgY2FjaGVkCiAg\nICAgICAgLy8gY29waWVzIHNob3VsZCBiZSA9PS4KICAgICAgICBpZiAobCAh\nPSBsMikgewogICAgICAgICAgICBmYWlsKCJsb2NhbGUgb2JqZWN0cyBhcmUg\nbm90IHRoZSBzYW1lLiIpOwogICAgICAgIH0KCiAgICAgICAgZW5kRW0obmV3\nRW0pOwogICAgICAgIGVuZEVtKG5ld0VtMik7CiAgICB9CgogICAgLy8gLS0t\nLS0tLS0tLSBUZXN0IHF1ZXJ5IGNhY2hpbmcgLS0tLS0tLS0tLQogICAgLy8g\nKiBGQ09zIGFzIHBhcmFtcwogICAgLy8gKiBtdWx0aS10aHJlYWRlZCBzdHVm\nZgogICAgLy8gKiBhY2Nlc3MgcGF0aCBzdHVmZiAoc2VlIGFsc28gVGVzdFF1\nZXJ5QWNjZXNzUGF0aCkKICAgIC8vICogc2VyaWFsaXphYmlsaXR5IG9mIHJl\ndHVybmVkIGxpc3RzCiAgICAvLyAqIFBNLnNldFF1ZXJ5Q2FjaGVFbmFibGVk\nIChmYWxzZSk7CiAgICAvLyAqIFF1ZXJ5LnNldFF1ZXJ5Q2FjaGVFbmFibGVk\nIChmYWxzZSk7CiAgICAvLyAqIFBlc3NpbWlzdGljIHRyYW5zYWN0aW9ucwoK\nICAgIHB1YmxpYyB2b2lkIHRlc3RCYXNpY1F1ZXJ5KCkgewogICAgICAgIGJh\nc2ljUXVlcmllcyhmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKSwgQm9v\nbGVhbi5GQUxTRSwgMywgMSk7CiAgICAgICAgYmFzaWNRdWVyaWVzKGZhY3Rv\ncnkuY3JlYXRlRW50aXR5TWFuYWdlcigpLCBCb29sZWFuLlRSVUUsIDMsIDEp\nOwoKICAgICAgICAvLyBtYW51YWxseSBub3RpZnkgdGhlIGNhY2hlIG9mIGNo\nYW5nZXMKICAgICAgICBRdWVyeUNhY2hlIGNhY2hlID0gY2FjaGVNYW5hZ2Vy\nKGZhY3RvcnkpLmdldFN5c3RlbVF1ZXJ5Q2FjaGUoKTsKCiAgICAgICAgLy8g\ndGVzdCB0byBzZWUgaWYgbW9kaWZ5aW5nIEIgY2F1c2VzIEEncyBxdWVyeSBj\nYWNoZSB0byBiZSBmbHVzaGVkCiAgICAgICAgU2V0IHMgPSBuZXcgSGFzaFNl\ndCgpOwogICAgICAgIHMuYWRkKENhY2hlT2JqZWN0Qi5jbGFzcyk7CiAgICAg\nICAgY2FjaGUub25UeXBlc0NoYW5nZWQobmV3IFR5cGVzQ2hhbmdlZEV2ZW50\nKHRoaXMsIHMpKTsKICAgICAgICBiYXNpY1F1ZXJpZXMoZmFjdG9yeS5jcmVh\ndGVFbnRpdHlNYW5hZ2VyKCksIEJvb2xlYW4uVFJVRSwgMywgMSk7CgogICAg\nICAgIC8vIHRlc3QgdG8gc2VlIGlmIG1vZGlmeWluZyBBIGNhdXNlcyBBJ3Mg\ncXVlcnkgY2FjaGUgdG8gYmUgZmx1c2hlZAogICAgICAgIHMuYWRkKENhY2hl\nT2JqZWN0QS5jbGFzcyk7CiAgICAgICAgY2FjaGUub25UeXBlc0NoYW5nZWQo\nbmV3IFR5cGVzQ2hhbmdlZEV2ZW50KHRoaXMsIHMpKTsKICAgICAgICBiYXNp\nY1F1ZXJpZXMoZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCksIEJvb2xl\nYW4uRkFMU0UsIDMsIDEpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBu\nb24tbWFudWFsIG5vdGlmaWNhdGlvbiB3b3JrcwogICAgICAgIEVudGl0eU1h\nbmFnZXIgZW0gPSBmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBzdGFydFR4KGVtKTsKICAgICAgICAg\nICAgQ2FjaGVPYmplY3RBIGEgPSBuZXcgQ2FjaGVPYmplY3RBKE9SSUdfTkFN\nRSwgT1JJR19BR0UpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGEpOwogICAg\nICAgICAgICBlbmRUeChlbSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICBlbmRFbShlbSk7CiAgICAgICAgfQoKICAgICAgICBi\nYXNpY1F1ZXJpZXMoZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCksIEJv\nb2xlYW4uRkFMU0UsIDQsIDIpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lk\nIGJhc2ljUXVlcmllcyhFbnRpdHlNYW5hZ2VyIGVtLCBCb29sZWFuIGluQ2Fj\naGUsIGludCBhbGxTaXplLAogICAgICAgIGludCBvcmlnU2l6ZSkgewogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGxvbmcgc3RhcnQ7CiAgICAgICAgICAg\nIGxvbmcgcTFwMTsKICAgICAgICAgICAgbG9uZyBxMXAyOwogICAgICAgICAg\nICBsb25nIHEycDE7CiAgICAgICAgICAgIGxvbmcgcTJwMjsKCiAgICAgICAg\nICAgIEJyb2tlciBicm9rZXIgPSBKUEFGYWNhZGVIZWxwZXIudG9Ccm9rZXIo\nZW0pOwogICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1\nZXJ5IHEgPSBicm9rZXIubmV3UXVlcnkoCiAgICAgICAgICAgICAgICBKUFFM\nUGFyc2VyLkxBTkdfSlBRTCwgIlNlbGVjdCBhIEZST00gIgogICAgICAgICAg\nICAgICAgKyBDYWNoZU9iamVjdEEuY2xhc3MuZ2V0U2ltcGxlTmFtZSgpICsg\nIiBhIik7CiAgICAgICAgICAgIHEuc2V0Q2FuZGlkYXRlRXh0ZW50KGJyb2tl\nci5uZXdFeHRlbnQoQ2FjaGVPYmplY3RBLmNsYXNzLCBmYWxzZSkpOwogICAg\nICAgICAgICBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgICAgICBhc3NlcnRJbkNhY2hlKHEsIGluQ2FjaGUpOwogICAgICAg\nICAgICBMaXN0IGwgPSAoTGlzdCkgcS5leGVjdXRlKCk7CiAgICAgICAgICAg\nIGl0ZXJhdGUobCk7CiAgICAgICAgICAgIHExcDEgPSBTeXN0ZW0uY3VycmVu\ndFRpbWVNaWxsaXMoKSAtIHN0YXJ0OwoKICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKGFsbFNpemUsIGwuc2l6ZSgpKTsKCiAgICAgICAgICAgIHN0YXJ0ID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgIExpc3Qg\nbDIgPSAoTGlzdCkgcS5leGVjdXRlKCk7CiAgICAgICAgICAgIGl0ZXJhdGUo\nbDIpOwogICAgICAgICAgICBxMXAyID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCkgLSBzdGFydDsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGFsbFNp\nemUsIGwyLnNpemUoKSk7CgogICAgICAgICAgICBxID0gYnJva2VyLm5ld1F1\nZXJ5KEpQUUxQYXJzZXIuTEFOR19KUFFMLAogICAgICAgICAgICAgICAgInNl\nbGVjdCBhLm5hbWUsYS5hZ2UgZnJvbSAiCiAgICAgICAgICAgICAgICAgICAg\nKyBDYWNoZU9iamVjdEEuY2xhc3MuZ2V0U2ltcGxlTmFtZSgpCiAgICAgICAg\nICAgICAgICAgICAgKyAiIGEgd2hlcmUgYS5uYW1lID0gOm4gQU5EIGEuYWdl\nID0gOmEiKTsKICAgICAgICAgICAgcS5zZXRDYW5kaWRhdGVFeHRlbnQoYnJv\na2VyLm5ld0V4dGVudChDYWNoZU9iamVjdEEuY2xhc3MsIGZhbHNlKSk7CiAg\nICAgICAgICAgIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCiAgICAgICAgICAgIGFzc2VydEluQ2FjaGUocSwgaW5DYWNoZSwgbmV3IE9i\namVjdFtdeyBPUklHX05BTUUsCiAgICAgICAgICAgICAgICBuZXcgSW50ZWdl\ncihPUklHX0FHRSkgfSk7CiAgICAgICAgICAgIGwgPSAoTGlzdCkgcS5leGVj\ndXRlKG5ldyBPYmplY3RbXXsgT1JJR19OQU1FLAogICAgICAgICAgICAgICAg\nbmV3IEludGVnZXIoT1JJR19BR0UpIH0pOwogICAgICAgICAgICBpdGVyYXRl\nKGwpOwogICAgICAgICAgICBxMnAxID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCkgLSBzdGFydDsKCiAgICAgICAgICAgIGFzc2VydEVxdWFscyhvcmln\nU2l6ZSwgbC5zaXplKCkpOwoKICAgICAgICAgICAgc3RhcnQgPSBTeXN0ZW0u\nY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgbDIgPSAoTGlzdCkg\ncS5leGVjdXRlKG5ldyBPYmplY3RbXXsgT1JJR19OQU1FLAogICAgICAgICAg\nICAgICAgbmV3IEludGVnZXIoT1JJR19BR0UpIH0pOwogICAgICAgICAgICBp\ndGVyYXRlKGwyKTsKICAgICAgICAgICAgcTJwMiA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpIC0gc3RhcnQ7CgogICAgICAgICAgICBhc3NlcnRFcXVh\nbHMob3JpZ1NpemUsIGwyLnNpemUoKSk7CiAgICAgICAgICAgIC8vIFN5c3Rl\nbS5vdXQucHJpbnRsbiAoImluQ2FjaGU6ICIgKyBpbkNhY2hlICsgIjtcdCBx\nMXAxOiAiICsgcTFwMQogICAgICAgICAgICAvLyArICI7XHQgcTFwMjogIiAr\nIHExcDIgKyAiO1x0IHEycDE6ICIgKyBxMnAxICsgIjtcdCBxMnAyOiAiCiAg\nICAgICAgICAgIC8vICsgcTJwMik7CiAgICAgICAgfQogICAgICAgIGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRFbShlbSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHRlc3ROb25DYWNoZWFibGVDbGFzcygpIHsKICAg\nICAgICBCcm9rZXIgYnJva2VyID0gSlBBRmFjYWRlSGVscGVyLnRvQnJva2Vy\nRmFjdG9yeShmYWN0b3J5KS5uZXdCcm9rZXIoKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IHEg\nPSBicm9rZXIubmV3UXVlcnkoCiAgICAgICAgICAgICAgICBKUFFMUGFyc2Vy\nLkxBTkdfSlBRTCwgIlNlbGVjdCBhIEZST00gIgogICAgICAgICAgICAgICAg\nKyBDYWNoZU9iamVjdEIuY2xhc3MuZ2V0U2ltcGxlTmFtZSgpICsgIiBhIik7\nCgogICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSAoQ29sbGVjdGlvbikgcS5l\neGVjdXRlKCk7CiAgICAgICAgICAgIGl0ZXJhdGUoYyk7CgogICAgICAgICAg\nICBhc3NlcnRJbkNhY2hlKHEsIEJvb2xlYW4uRkFMU0UpOwogICAgICAgIH0K\nICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgY2xvc2UoYnJva2VyKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdE5vbkNhY2hl\nYWJsZUFjY2Vzc1BhdGgoKSB7CiAgICAgICAgQnJva2VyIGJyb2tlciA9IEpQ\nQUZhY2FkZUhlbHBlci50b0Jyb2tlckZhY3RvcnkoZmFjdG9yeSkubmV3QnJv\na2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeSBxID0gYnJva2VyLm5ld1F1ZXJ5KAogICAg\nICAgICAgICAgICAgSlBRTFBhcnNlci5MQU5HX0pQUUwsICJTZWxlY3QgYSBG\nUk9NICIKICAgICAgICAgICAgICAgICsgQ2FjaGVPYmplY3RBLmNsYXNzLmdl\ndFNpbXBsZU5hbWUoKQogICAgICAgICAgICAgICAgKyAiIGEgd2hlcmUgYS5y\nZWxhdGVkQi5zdHIgPSAnZm9vJyIpOwogICAgICAgICAgICAvLyAicmVsYXRl\nZEIuc3RyID09ICdmb28nIik7CiAgICAgICAgICAgIHEuc2V0Q2FuZGlkYXRl\nRXh0ZW50KGJyb2tlci5uZXdFeHRlbnQoQ2FjaGVPYmplY3RBLmNsYXNzLCBm\nYWxzZSkpOwoKICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gKENvbGxlY3Rp\nb24pIHEuZXhlY3V0ZSgpOwogICAgICAgICAgICBpdGVyYXRlKGMpOwoKICAg\nICAgICAgICAgYXNzZXJ0SW5DYWNoZShxLCBCb29sZWFuLkZBTFNFKTsKICAg\nICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGNsb3NlKGJy\nb2tlcik7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RO\nb25DYWNoZWFibGVTdWJjbGFzc2VzMSgpIHsKICAgICAgICBCcm9rZXIgYnJv\na2VyID0gSlBBRmFjYWRlSGVscGVyLnRvQnJva2VyRmFjdG9yeShmYWN0b3J5\nKS5uZXdCcm9rZXIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBh\nIHF1ZXJ5IG9uIHRoZSBDYWNoZU9iamVjdEEgY2xhc3MgaW5jbHVkZXMgYW4g\ndW5jYWNoZWFibGUKICAgICAgICAgICAgLy8gY2xhc3M7IGl0IHNob3VsZCB0\naGVyZWZvcmUgbm90IGJlIGNhY2hlYWJsZS4KICAgICAgICAgICAgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeSBxID0gYnJva2VyLm5ld1F1ZXJ5\nKAogICAgICAgICAgICAgICAgSlBRTFBhcnNlci5MQU5HX0pQUUwsICJTZWxl\nY3QgYSBGUk9NICIKICAgICAgICAgICAgICAgICsgQ2FjaGVPYmplY3RBLmNs\nYXNzLmdldFNpbXBsZU5hbWUoKSArICIgYSIpOwoKICAgICAgICAgICAgQ29s\nbGVjdGlvbiBjID0gKENvbGxlY3Rpb24pIHEuZXhlY3V0ZSgpOwogICAgICAg\nICAgICBpdGVyYXRlKGMpOwoKICAgICAgICAgICAgYXNzZXJ0SW5DYWNoZShx\nLCBCb29sZWFuLkZBTFNFKTsKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7\nCiAgICAgICAgICAgIGNsb3NlKGJyb2tlcik7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHRlc3ROb25DYWNoZWFibGVTdWJjbGFzc2VzMigp\nIHsKICAgICAgICBCcm9rZXIgYnJva2VyID0gSlBBRmFjYWRlSGVscGVyLnRv\nQnJva2VyRmFjdG9yeShmYWN0b3J5KS5uZXdCcm9rZXIoKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICAvLyBhIHF1ZXJ5IG9uIHRoZSBDYWNoZU9iamVj\ndEEgZXh0ZW50IGNvbmZpZ3VyZWQgd2l0aG91dAogICAgICAgICAgICAvLyBz\ndWJjbGFzc2VzIGRvZXMgbm90IGluY2x1ZGUgYW4gdW5jYWNoZWFibGUgY2xh\nc3M7IGl0IHNob3VsZAogICAgICAgICAgICAvLyB0aGVyZWZvcmUgYmUgY2Fj\naGVhYmxlLgogICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLlF1ZXJ5IHEgPSBicm9rZXIubmV3UXVlcnkoCiAgICAgICAgICAgICAgICBK\nUFFMUGFyc2VyLkxBTkdfSlBRTCwgInNlbGVjdCBhIGZyb20gIgogICAgICAg\nICAgICAgICAgKyBDYWNoZU9iamVjdEEuY2xhc3MuZ2V0U2ltcGxlTmFtZSgp\nICsgIiBhIik7CiAgICAgICAgICAgIHEuc2V0Q2FuZGlkYXRlRXh0ZW50KGJy\nb2tlci5uZXdFeHRlbnQoQ2FjaGVPYmplY3RBLmNsYXNzLCBmYWxzZSkpOwoK\nICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gKENvbGxlY3Rpb24pIHEuZXhl\nY3V0ZSgpOwogICAgICAgICAgICBpdGVyYXRlKGMpOwoKICAgICAgICAgICAg\nYXNzZXJ0SW5DYWNoZShxLCBCb29sZWFuLlRSVUUpOwogICAgICAgIH0KICAg\nICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgY2xvc2UoYnJva2VyKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdENhY2hlTmFtZXMo\nKSB7CiAgICAgICAgYXNzZXJ0Q2FjaGVOYW1lKENhY2hlT2JqZWN0QS5jbGFz\ncywgRGF0YUNhY2hlLk5BTUVfREVGQVVMVCk7CiAgICAgICAgYXNzZXJ0Q2Fj\naGVOYW1lKENhY2hlT2JqZWN0QUNoaWxkMS5jbGFzcywgRGF0YUNhY2hlLk5B\nTUVfREVGQVVMVCk7CiAgICAgICAgYXNzZXJ0Q2FjaGVOYW1lKENhY2hlT2Jq\nZWN0QUNoaWxkMi5jbGFzcywgbnVsbCk7CiAgICAgICAgYXNzZXJ0Q2FjaGVO\nYW1lKENhY2hlT2JqZWN0Qi5jbGFzcywgbnVsbCk7CiAgICAgICAgLyoKICAg\nICAgICAgKiBEdWUgdG8gdGhlIHByb2JsZW0gZG9jdW1lbnRlZCBpbiB0aGUg\nc2V0dXAoKSByb3V0aW5lLCB0aGUgZm9sbG93aW5nIHRlc3RzIGFyZSBub3Qg\ndmFsaWQuLi4KICAgICAgICAgKi8KLy8gICAgICAgIGFzc2VydENhY2hlTmFt\nZShDYWNoZU9iamVjdEJDaGlsZDEuY2xhc3MsIG51bGwpOy8vIHN1Yi1jbGFz\nc2VzIHNob3VsZCBpbmhlcml0IHBhcmVudCdzIEBDYWNoZWFibGUgc2V0dGlu\nZwovLyAgICAgICAgYXNzZXJ0Q2FjaGVOYW1lKENhY2hlT2JqZWN0Qy5jbGFz\ncywgIm5vdC10aGUtZGVmYXVsdC1jYWNoZSIpOyBtdWx0aXBsZSBkYXRhY2Fj\naGUgaW5zdGFudGlhdGlvbiBub3Qgd29ya2luZy4uLgovLyAgICAgICAgYXNz\nZXJ0Q2FjaGVOYW1lKENhY2hlT2JqZWN0RC5jbGFzcywgIm5vdC10aGUtZGVm\nYXVsdC1jYWNoZSIpOwogICAgICAgIGFzc2VydENhY2hlTmFtZShDYWNoZU9i\namVjdEUuY2xhc3MsIERhdGFDYWNoZS5OQU1FX0RFRkFVTFQpOwogICAgICAg\nIGFzc2VydENhY2hlTmFtZShDYWNoZU9iamVjdEYuY2xhc3MsIERhdGFDYWNo\nZS5OQU1FX0RFRkFVTFQpOwogICAgICAgIGFzc2VydENhY2hlTmFtZShDYWNo\nZU9iamVjdEcuY2xhc3MsIERhdGFDYWNoZS5OQU1FX0RFRkFVTFQpOwogICAg\nICAgIGFzc2VydENhY2hlTmFtZShDYWNoZU9iamVjdEguY2xhc3MsIERhdGFD\nYWNoZS5OQU1FX0RFRkFVTFQpOwogICAgICAgIGFzc2VydENhY2hlTmFtZShD\nYWNoZU9iamVjdEouY2xhc3MsIERhdGFDYWNoZS5OQU1FX0RFRkFVTFQpOwog\nICAgICAgIGFzc2VydENhY2hlTmFtZShBcHBJZENhY2hlT2JqZWN0LmNsYXNz\nLCBEYXRhQ2FjaGUuTkFNRV9ERUZBVUxUKTsKICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgYXNzZXJ0Q2FjaGVOYW1lKENsYXNzIGNscywgU3RyaW5nIGNhY2hl\nTmFtZSkgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IEpQQUZhY2Fk\nZUhlbHBlci5nZXRNZXRhRGF0YShmYWN0b3J5LCBjbHMpOwogICAgICAgIGlm\nIChjYWNoZU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgYXNzZXJ0TnVsbCht\nZXRhLmdldERhdGFDYWNoZSgpKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgYXNzZXJ0Tm90TnVsbChtZXRhLmdldERhdGFDYWNoZSgpKTsKICAgICAg\nICAgICAgYXNzZXJ0RXF1YWxzKGNhY2hlTmFtZSwgbWV0YS5nZXREYXRhQ2Fj\naGUoKS5nZXROYW1lKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBGSVhN\nRSBTZWV0aGEgU2VwIDI2LDIwMDYKICAgIC8vIG5vdCBhYmxlIHRvIHJlcGxh\nY2UgcG0ubmV3UXVlcnkoQ2FjaGVPYmplY3RBLmNsYXNzKTsKICAgIC8qCiAg\nICAgICogcHVibGljIHZvaWQgdGVzdFF1ZXJ5QWdncmVnYXRlcygpIHsgUGVy\nc2lzdGVuY2VNYW5hZ2VyIHBtID0KICAgICAgKiBmYWN0b3J5LmdldFBlcnNp\nc3RlbmNlTWFuYWdlcigpOyB0cnkgeyBRdWVyeSBxID0KICAgICAgKiBwbS5u\nZXdRdWVyeShDYWNoZU9iamVjdEEuY2xhc3MpOyBxLnNldFJlc3VsdCgibWF4\nIChhZ2UpIik7IE9iamVjdCBvID0KICAgICAgKiBxLmV4ZWN1dGUoKTsgYXNz\nZXJ0VHJ1ZSgibyBtdXN0IGJlIGluc3RhbmNlb2YgTnVtYmVyIiwgbyBpbnN0\nYW5jZW9mCiAgICAgICogTnVtYmVyKTsgfSBmaW5hbGx5IHsgY2xvc2UocG0p\nOyB9IH0KICAgICAgKi8KCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q2FjaGUyKCkg\newogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtMSA9CiAgICAgICAg\nICAgIChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeS5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0y\nID0gbnVsbDsKICAgICAgICBEYXRhQ2FjaGUgY2FjaGU7CgogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIENhY2hlT2JqZWN0QSBhMSA9IChDYWNoZU9iamVj\ndEEpIGVtMS5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsKCiAgICAg\nICAgICAgIGVtMiA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeTIu\nY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgICAgICBDYWNoZU9iamVj\ndEEgYTIgPSAoQ2FjaGVPYmplY3RBKSBlbTIuZmluZChDYWNoZU9iamVjdEEu\nY2xhc3MsIG9pZCk7CgogICAgICAgICAgICAvLyBhc3NlcnQgdGhhdCB0aGUg\nb2lkIGlzIGluIGZhY3RvcnkyJ3MgY2FjaGUKICAgICAgICAgICAgLy9NZXRh\nRGF0YVJlcG9zaXRvcnkgcmVwb3MyID0gZmFjdG9yeTIuZ2V0Q29uZmlndXJh\ndGlvbigpCiAgICAgICAgICAgIC8vICAgIC5nZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpOwogICAgICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkg\ncmVwb3MyID0KICAgICAgICAgICAgICAgICgoKChPcGVuSlBBRW50aXR5TWFu\nYWdlckZhY3RvcnlTUEkpIGZhY3RvcnkyKSkKICAgICAgICAgICAgICAgIC5n\nZXRDb25maWd1cmF0aW9uKCkpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHJlcG9z\nMgogICAgICAgICAgICAgICAgLmdldE1ldGFEYXRhKENhY2hlT2JqZWN0QS5j\nbGFzcywgZW0yLmdldENsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAgICAg\nICBjYWNoZSA9IG1ldGEuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAgIGFz\nc2VydFRydWUoY2FjaGUuY29udGFpbnMob2lkd2l0aGNsYXNzKSk7CgogICAg\nICAgICAgICAvLyBtb2RpZnkgdGhlIG9iamVjdC4KICAgICAgICAgICAgc3Rh\ncnRUeChlbTEpOwogICAgICAgICAgICBhMS5zZXROYW1lKGExLmdldE5hbWUo\nKSArICIgY2hhbmdlZCIpOwogICAgICAgICAgICBlbmRUeChlbTEpOwogICAg\nICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGVtMiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgZW5kRW0oZW0yKTsKICAgICAgICAg\nICAgZW5kRW0oZW0xKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoZSBj\nYWNoZSBpcyBhIGNvaGVyZW50IG9uZSwgdGhlbiB0aGUgY2hhbmdlcyBzaG91\nbGQgYmUKICAgICAgICAvLyBzZWVuLiBPdGhlcndpc2UsIHRoZXkgc2hvdWxk\nIG5vdC4KICAgICAgICBpZiAoaXNDYWNoZUNvaGVyZW50KCkgfHwgZmFjdG9y\neSA9PSBmYWN0b3J5MikKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgia2V5ICIg\nKyBvaWQgKyAiIHdhcyBub3QgaW4gY2FjaGU7IHNob3VsZCBoYXZlIGJlZW4i\nLAogICAgICAgICAgICAgICAgY2FjaGUuY29udGFpbnMob2lkd2l0aGNsYXNz\nKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBhc3NlcnRGYWxzZSgia2V5\nICIgKyBvaWQgKyAiIHdhcyBpbiBjYWNoZTsgc2hvdWxkIG5vdCBoYXZlIGJl\nZW4iLAogICAgICAgICAgICAgICAgY2FjaGUuY29udGFpbnMob2lkd2l0aGNs\nYXNzKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFRpbWVvdXRzMSgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRpbWVvdXRzVGVzdDEoMSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgdGltZW91dHNUZXN0MShpbnQgdHJp\nZXMpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIHRoaXMgY3Jhenkg\nZm9yIGxvb3Bpbmcgc3R1ZmYgaXMgaGVyZSBiZWNhdXNlIHdlJ3JlIHNlZWlu\nZwogICAgICAgIC8vIGludGVybWl0dGVudCBmYWlsdXJlcyB3aXRoIHRoZSBn\nYXJiYWdlIGNvbGxlY3RvciBraWNraW5nIGluCiAgICAgICAgLy8gZHVyaW5n\nIHRlc3RpbmcuIFNvLCB0aGlzIGRlY3JlYXNlcyB0aGUgY2hhbmNlcyB0aGF0\nIHRoYXQKICAgICAgICAvLyB3aWxsIGhhcHBlbi4KICAgICAgICBFeGNlcHRp\nb24gZSA9IG51bGw7CiAgICAgICAgaW50IGk7CiAgICAgICAgZm9yIChpID0g\nMDsgaSA8IHRyaWVzOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIHRpbWVvdXRzSGVscGVyKGZhY3RvcnkpOwogICAgICAgICAg\nICAgICAgLy8gYW55IHN1Y2Nlc3NlcyB3aWxsIHBhc3MgdGhlIHRlc3QKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgICAgICBlID0g\nZXg7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRocm93IGU7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFRpbWVvdXRzMigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIHRpbWVvdXRzVGVzdDIoMzApOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHRpbWVvdXRzVGVzdDIoaW50IHRyaWVzKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBFcnJvciBlID0gbnVsbDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRyaWVzOyBpKyspIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHRpbWVvdXRzSGVscGVyKHRp\nbWVvdXRGYWN0b3J5KTsKICAgICAgICAgICAgICAgIC8vIGFueSBzdWNjZXNz\nZXMgd2lsbCBwYXNzIHRoZSB0ZXN0CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKEFzc2VydGlvbkZh\naWxlZEVycm9yIGFmZSkgewogICAgICAgICAgICAgICAgZSA9IGFmZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhyb3cgZTsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgdGltZW91dHNIZWxwZXIoT3BlbkpQQUVudGl0\neU1hbmFnZXJGYWN0b3J5IGZhY3RvcnkpCiAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSAoT3Bl\nbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkKICAgICAgICAgICAgLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBz\ndGFydFR4KGVtKTsKCiAgICAgICAgICAgIENhY2hlT2JqZWN0RSBlID0gbmV3\nIENhY2hlT2JqZWN0RSgiZSIpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGUp\nOwoKICAgICAgICAgICAgQ2FjaGVPYmplY3RGIGYgPSBuZXcgQ2FjaGVPYmpl\nY3RGKCJmIik7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoZik7CgogICAgICAg\nICAgICBDYWNoZU9iamVjdEcgZyA9IG5ldyBDYWNoZU9iamVjdEcoImciKTsK\nICAgICAgICAgICAgZW0ucGVyc2lzdChnKTsKCiAgICAgICAgICAgIENhY2hl\nT2JqZWN0SCBoID0gbmV3IENhY2hlT2JqZWN0SCgiaCIpOwogICAgICAgICAg\nICBlbS5wZXJzaXN0KGgpOwoKICAgICAgICAgICAgZW5kVHgoZW0pOwoKICAg\nICAgICAgICAgT2JqZWN0W10gaWRzID0gbmV3IE9iamVjdFs0XTsKICAgICAg\nICAgICAgaWRzWzBdID0gbmV3IElkKENhY2hlT2JqZWN0RS5jbGFzcywgZW0u\nZ2V0T2JqZWN0SWQoZSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGlkc1sx\nXSA9IG5ldyBJZChDYWNoZU9iamVjdEYuY2xhc3MsIGVtLmdldE9iamVjdElk\nKGYpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBpZHNbMl0gPSBuZXcgSWQo\nQ2FjaGVPYmplY3RHLmNsYXNzLCBlbS5nZXRPYmplY3RJZChnKS50b1N0cmlu\nZygpKTsKICAgICAgICAgICAgaWRzWzNdID0gbmV3IElkKENhY2hlT2JqZWN0\nSC5jbGFzcywgZW0uZ2V0T2JqZWN0SWQoaCkudG9TdHJpbmcoKSk7CgogICAg\nICAgICAgICAvLyBidWlsZCB1cCBzb21lIHF1ZXJpZXMgdG8gdGVzdAoKICAg\nICAgICAgICAgLy8gdGhpcyBvbmUgc2hvdWxkIGJlIG9ubHkgb24gdGhlIHN1\ncGVyY2xhc3MsIHNpbmNlCiAgICAgICAgICAgIC8vIENhY2hlT2JqZWN0RiBo\nYXMgYSB0aW1lb3V0LgogICAgICAgICAgICBCcm9rZXIgYnJva2VyID0gSlBB\nRmFjYWRlSGVscGVyLnRvQnJva2VyKGVtKTsKICAgICAgICAgICAgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeSBxMSA9IGJyb2tlci5uZXdRdWVy\neSgKICAgICAgICAgICAgICAgIEpQUUxQYXJzZXIuTEFOR19KUFFMLCAic2Vs\nZWN0IGEgZnJvbSAiCiAgICAgICAgICAgICAgICArIENhY2hlT2JqZWN0RS5j\nbGFzcy5nZXRTaW1wbGVOYW1lKCkgKyAiIGEiKTsKICAgICAgICAgICAgcTEu\nc2V0Q2FuZGlkYXRlRXh0ZW50KGJyb2tlci5uZXdFeHRlbnQoQ2FjaGVPYmpl\nY3RFLmNsYXNzLCBmYWxzZSkpOwogICAgICAgICAgICBpdGVyYXRlKChDb2xs\nZWN0aW9uKSBxMS5leGVjdXRlKCkpOwogICAgICAgICAgICBhc3NlcnRJbkNh\nY2hlKHExLCBCb29sZWFuLlRSVUUpOwoKICAgICAgICAgICAgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5RdWVyeSBxMiA9IGJyb2tlci5uZXdRdWVyeSgK\nICAgICAgICAgICAgICAgIEpQUUxQYXJzZXIuTEFOR19KUFFMLCAiU2VsZWN0\nIGEgRlJPTSAiCiAgICAgICAgICAgICAgICArIENhY2hlT2JqZWN0Ri5jbGFz\ncy5nZXRTaW1wbGVOYW1lKCkgKyAiIGEiKTsKICAgICAgICAgICAgaXRlcmF0\nZSgoQ29sbGVjdGlvbikgcTIuZXhlY3V0ZSgpKTsKICAgICAgICAgICAgYXNz\nZXJ0SW5DYWNoZShxMiwgQm9vbGVhbi5UUlVFKTsKCiAgICAgICAgICAgIERh\ndGFDYWNoZSBjYWNoZSA9IGNhY2hlTWFuYWdlcihmYWN0b3J5KS5nZXREYXRh\nQ2FjaGUoCiAgICAgICAgICAgICAgICBEYXRhQ2FjaGUuTkFNRV9ERUZBVUxU\nLCBmYWxzZSk7CiAgICAgICAgICAgIGNoZWNrQ2FjaGUoY2FjaGUsIGlkcywg\nbmV3IGJvb2xlYW5bXXsgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSB9KTsKCiAg\nICAgICAgICAgIC8vIHNob3VsZCBjYXVzZSBoIHRvIGJlIGRyb3BwZWQuCiAg\nICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuc2xlZXAoNTUxKTsK\nICAgICAgICAgICAgVGhyZWFkLnlpZWxkKCk7CiAgICAgICAgICAgIGNoZWNr\nQ2FjaGUoY2FjaGUsIGlkcywgbmV3IGJvb2xlYW5bXXsgdHJ1ZSwgdHJ1ZSwg\ndHJ1ZSwgZmFsc2UgfSk7CgogICAgICAgICAgICAvLyBpZiB0aGlzIHJ1biBo\nYXMgYSBkZWZhdWx0IHRpbWVvdXQgKHNldCB0byAxIHNlYyBpbiB0aGUgdGVz\ndAogICAgICAgICAgICAvLyBjYXNlKSwgZSBzaG91bGQgYmUgdGltZWQgb3V0\nIGJ5IHRoaXMgcG9pbnQuCiAgICAgICAgICAgIC8vYm9vbGVhbiBlU3RhdHVz\nID0KICAgICAgICAgICAgLy8gICAgIShmYWN0b3J5LmdldENvbmZpZ3VyYXRp\nb24oKS5nZXREYXRhQ2FjaGVUaW1lb3V0KCkgPiAwKTsKICAgICAgICAgICAg\nYm9vbGVhbiBlU3RhdHVzID0gISgoKChPcGVuSlBBRW50aXR5TWFuYWdlckZh\nY3RvcnlTUEkpIGZhY3RvcnkpCiAgICAgICAgICAgICAgICAgICAgLmdldENv\nbmZpZ3VyYXRpb24oKSkuZ2V0RGF0YUNhY2hlVGltZW91dCgpID4gMCk7Cgog\nICAgICAgICAgICAvLyBzaG91bGQgY2F1c2UgZiB0byBiZSBkcm9wcGVkLgog\nICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLnNsZWVwKDU1MCk7\nCiAgICAgICAgICAgIFRocmVhZC55aWVsZCgpOwogICAgICAgICAgICBjaGVj\na0NhY2hlKGNhY2hlLCBpZHMsCiAgICAgICAgICAgICAgICBuZXcgYm9vbGVh\nbltdeyBlU3RhdHVzLCBmYWxzZSwgdHJ1ZSwgZmFsc2UgfSk7CgogICAgICAg\nICAgICAvLyBhdCB0aGlzIHBvaW50LCBxMiBzaG91bGQgYmUgZHJvcHBlZCAo\nYmVjYXVzZSBpdHMgY2FuZGlkYXRlCiAgICAgICAgICAgIC8vIGNsYXNzIGlz\nIENhY2hlT2JqZWN0RiksIGFuZCBxMSBtaWdodCBiZSBkcm9wcGVkLCBkZXBl\nbmRpbmcKICAgICAgICAgICAgLy8gb24gd2hldGhlciBvciBub3Qgd2UndmUg\nZ290IGEgdGltZW91dCBjb25maWd1cmVkLgogICAgICAgICAgICBhc3NlcnRJ\nbkNhY2hlKHExLCAoZVN0YXR1cykgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFKTsKICAgICAgICAgICAgYXNzZXJ0SW5DYWNoZShxMiwgQm9vbGVh\nbi5GQUxTRSk7CgogICAgICAgICAgICAvLyBzaG91bGQgY2F1c2UgZyB0byBi\nZSBkcm9wcGVkLgogICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgp\nLnNsZWVwKDQwNTApOwogICAgICAgICAgICBUaHJlYWQueWllbGQoKTsKICAg\nICAgICAgICAgY2hlY2tDYWNoZShjYWNoZSwgaWRzLAogICAgICAgICAgICAg\nICAgbmV3IGJvb2xlYW5bXXsgZVN0YXR1cywgZmFsc2UsIGZhbHNlLCBmYWxz\nZSB9KTsKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZEVtKGVtKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndGVzdFF1ZXJ5VGltZW91dHMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBxdWVyeVRpbWVvdXRzSGVscGVyKGZhY3RvcnkpOwogICAgICAgIHF1ZXJ5\nVGltZW91dHNIZWxwZXIodGltZW91dEZhY3RvcnkpOwogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBxdWVyeVRpbWVvdXRzSGVscGVyKE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyRmFjdG9yeSBmYWN0b3J5KQogICAgICAgIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gKE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5CiAgICAgICAgICAgIC5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3Rh\ncnRUeChlbSk7CgogICAgICAgICAgICBDYWNoZU9iamVjdEUgZSA9IG5ldyBD\nYWNoZU9iamVjdEUoImUiKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChlKTsK\nCiAgICAgICAgICAgIENhY2hlT2JqZWN0RiBmID0gbmV3IENhY2hlT2JqZWN0\nRigiZiIpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGYpOwoKICAgICAgICAg\nICAgZW5kVHgoZW0pOwoKICAgICAgICAgICAgLy8gYnVpbGQgdXAgc29tZSBx\ndWVyaWVzIHRvIHRlc3QKICAgICAgICAgICAgQnJva2VyIGJyb2tlciA9IEpQ\nQUZhY2FkZUhlbHBlci50b0Jyb2tlcihlbSk7CiAgICAgICAgICAgIG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcTEgPSBicm9rZXIKICAgICAg\nICAgICAgICAgIC5uZXdRdWVyeShKUFFMUGFyc2VyLkxBTkdfSlBRTCwgIlNF\nTEVDVCBhIEZST00gQ2FjaGVPYmplY3RFIGEiKTsKCiAgICAgICAgICAgIHEx\nLnNldENhbmRpZGF0ZUV4dGVudChicm9rZXIubmV3RXh0ZW50KENhY2hlT2Jq\nZWN0RS5jbGFzcywgZmFsc2UpKTsKICAgICAgICAgICAgaXRlcmF0ZSgoQ29s\nbGVjdGlvbikgcTEuZXhlY3V0ZSgpKTsKICAgICAgICAgICAgYXNzZXJ0SW5D\nYWNoZShxMSwgQm9vbGVhbi5UUlVFKTsKCiAgICAgICAgICAgIG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcTIgPSBicm9rZXIKICAgICAgICAg\nICAgICAgIC5uZXdRdWVyeShKUFFMUGFyc2VyLkxBTkdfSlBRTCwgIlNFTEVD\nVCBhIEZST00gQ2FjaGVPYmplY3RGIGEiKTsKICAgICAgICAgICAgaXRlcmF0\nZSgoQ29sbGVjdGlvbikgcTIuZXhlY3V0ZSgpKTsKICAgICAgICAgICAgYXNz\nZXJ0SW5DYWNoZShxMiwgQm9vbGVhbi5UUlVFKTsKCiAgICAgICAgICAgIC8v\nIGlmIHRoaXMgcnVuIGhhcyBhIGRlZmF1bHQgdGltZW91dCAoc2V0IHRvIDEg\nc2VjIGluIHRoZSB0ZXN0CiAgICAgICAgICAgIC8vIGNhc2UpLCBlIHNob3Vs\nZCBiZSB0aW1lZCBvdXQgYnkgdGhpcyBwb2ludC4KICAgICAgICAgICAgLy9i\nb29sZWFuIGVUaW1lZE91dCA9CiAgICAgICAgICAgIC8vICAgIGZhY3Rvcnku\nZ2V0Q29uZmlndXJhdGlvbigpLmdldERhdGFDYWNoZVRpbWVvdXQoKSA+IDA7\nCiAgICAgICAgICAgIGJvb2xlYW4gZVRpbWVkT3V0ID0KICAgICAgICAgICAg\nICAgICgoKChPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnlTUEkpIGZhY3Rv\ncnkpLmdldENvbmZpZ3VyYXRpb24oKSkKICAgICAgICAgICAgICAgICAgICAu\nZ2V0RGF0YUNhY2hlVGltZW91dCgpID4gMCk7CgogICAgICAgICAgICAvLyBz\naG91bGQgY2F1c2UgZiB0byBiZSBkcm9wcGVkLgogICAgICAgICAgICBUaHJl\nYWQuY3VycmVudFRocmVhZCgpLnNsZWVwKDExMDApOwoKICAgICAgICAgICAg\nLy8gYXQgdGhpcyBwb2ludCwgcTIgc2hvdWxkIGJlIGRyb3BwZWQgKGJlY2F1\nc2UgaXRzIGNhbmRpZGF0ZQogICAgICAgICAgICAvLyBjbGFzcyBpcyBDYWNo\nZU9iamVjdEYpLCBhbmQgcTEgbWlnaHQgYmUgZHJvcHBlZCwgZGVwZW5kaW5n\nCiAgICAgICAgICAgIC8vIG9uIHdoZXRoZXIgb3Igbm90IHdlJ3ZlIGdvdCBh\nIHRpbWVvdXQgY29uZmlndXJlZC4KICAgICAgICAgICAgYXNzZXJ0SW5DYWNo\nZShxMSwgKGVUaW1lZE91dCkgPyBCb29sZWFuLkZBTFNFIDogQm9vbGVhbi5U\nUlVFKTsKICAgICAgICAgICAgYXNzZXJ0SW5DYWNoZShxMiwgQm9vbGVhbi5G\nQUxTRSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRFbShlbSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHRlc3RRdWVyeUltcGxpY2l0RXZpY3Rpb25zKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSAoT3BlbkpQ\nQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkKICAgICAgICAgICAgLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBSdW50\naW1lVGVzdDFbXSBoZWxwZXJPYmpzID0gbmV3IFJ1bnRpbWVUZXN0MVs1XTsK\nICAgICAgICAgICAgaGVscGVyT2Jqc1swXSA9IG5ldyBSdW50aW1lVGVzdDEo\nKTsKICAgICAgICAgICAgaGVscGVyT2Jqc1sxXSA9IG5ldyBSdW50aW1lVGVz\ndDEoKTsKICAgICAgICAgICAgaGVscGVyT2Jqc1syXSA9IG5ldyBSdW50aW1l\nVGVzdDEoKTsKICAgICAgICAgICAgaGVscGVyT2Jqc1szXSA9IG5ldyBSdW50\naW1lVGVzdDEoKTsKICAgICAgICAgICAgaGVscGVyT2Jqc1s0XSA9IG5ldyBS\ndW50aW1lVGVzdDEoKTsKICAgICAgICAgICAgc3RhcnRUeChlbSk7CiAgICAg\nICAgICAgIGVtLnBlcnNpc3QoaGVscGVyT2Jqc1swXSk7CiAgICAgICAgICAg\nIGVtLnBlcnNpc3QoaGVscGVyT2Jqc1sxXSk7CiAgICAgICAgICAgIGVtLnBl\ncnNpc3QoaGVscGVyT2Jqc1syXSk7CiAgICAgICAgICAgIGVtLnBlcnNpc3Qo\naGVscGVyT2Jqc1szXSk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoaGVscGVy\nT2Jqc1s0XSk7CiAgICAgICAgICAgIGVuZFR4KGVtKTsKCiAgICAgICAgICAg\nIERhdGFDYWNoZSBjYWNoZSA9IGNhY2hlTWFuYWdlcihmYWN0b3J5KS5nZXRE\nYXRhQ2FjaGUoCiAgICAgICAgICAgICAgICBEYXRhQ2FjaGUuTkFNRV9ERUZB\nVUxULCBmYWxzZSk7CgogICAgICAgICAgICBpZiAoIWlzT3BlbkpQQUNhY2hl\nKGNhY2hlKSkgewogICAgICAgICAgICAgICAgYnVnKDYyNywgIlRhbmdvc29s\nIGNhY2hlIGltcGwgbmVlZHMgbW9kZXJuaXphdGlvbiIpOwogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nY2FjaGUgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nRGF0YUNhY2hlKQogICAgICAg\nICAgICAgICAgY2FjaGUgPSAoKERlbGVnYXRpbmdEYXRhQ2FjaGUpIGNhY2hl\nKS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgICAgICAgICBpZiAoY2Fj\naGUgaW5zdGFuY2VvZiBDb25jdXJyZW50RGF0YUNhY2hlKSB7CiAgICAgICAg\nICAgICAgICBDYWNoZU1hcCBtYXAgPSAoKENvbmN1cnJlbnREYXRhQ2FjaGUp\nIGNhY2hlKS5nZXRDYWNoZU1hcCgpOwogICAgICAgICAgICAgICAgbWFwLnNl\ndENhY2hlU2l6ZSgzKTsKICAgICAgICAgICAgICAgIG1hcC5zZXRTb2Z0UmVm\nZXJlbmNlU2l6ZSgwKTsKICAgICAgICAgICAgfSAKCiAgICAgICAgICAgIHN0\nYXJ0VHgoZW0pOwogICAgICAgICAgICBDYWNoZU9iamVjdEggaCA9IG5ldyBD\nYWNoZU9iamVjdEgoImgiKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChoKTsK\nICAgICAgICAgICAgQ2FjaGVPYmplY3RKIGogPSBuZXcgQ2FjaGVPYmplY3RK\nKCJqIiwgaCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3Qoaik7CiAgICAgICAg\nICAgIGVuZFR4KGVtKTsKICAgICAgICAgICAgT2JqZWN0IGhvaWQgPSBlbS5n\nZXRPYmplY3RJZChoKTsKICAgICAgICAgICAgT2JqZWN0IGpvaWQgPSBlbS5n\nZXRPYmplY3RJZChqKTsKCiAgICAgICAgICAgIE9iamVjdCBob2lkd2l0aGNs\nYXNzID0gbmV3IElkKENhY2hlT2JqZWN0SC5jbGFzcywgaG9pZC50b1N0cmlu\nZygpKTsKICAgICAgICAgICAgT2JqZWN0IGpvaWR3aXRoY2xhc3MgPSBuZXcg\nSWQoQ2FjaGVPYmplY3RKLmNsYXNzLCBqb2lkLnRvU3RyaW5nKCkpOwogICAg\nICAgICAgICBlbmRFbShlbSk7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUg\naiBhbmQgaCBhcmUgaW4gY2FjaGU7IG1heSBub3QgYmUgaWYgbm90IExSVQog\nICAgICAgICAgICBpbnQgYXR0ZW1wdHMgPSAwOwogICAgICAgICAgICBmb3Ig\nKDsgYXR0ZW1wdHMgPCAxMDAgJiYgIWNhY2hlLmNvbnRhaW5zKGpvaWR3aXRo\nY2xhc3MpOyBhdHRlbXB0cysrKQogICAgICAgICAgICB7CiAgICAgICAgICAg\nICAgICBlbSA9IGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAg\nICAgICAgICAgICAgaWYgKCFjYWNoZS5jb250YWlucyhob2lkd2l0aGNsYXNz\nKSkKICAgICAgICAgICAgICAgICAgICBlbS5maW5kKENhY2hlT2JqZWN0SC5j\nbGFzcywgaG9pZCk7CiAgICAgICAgICAgICAgICBpZiAoIWNhY2hlLmNvbnRh\naW5zKGpvaWR3aXRoY2xhc3MpKQogICAgICAgICAgICAgICAgICAgIGVtLmZp\nbmQoQ2FjaGVPYmplY3RKLmNsYXNzLCBqb2lkKTsKICAgICAgICAgICAgICAg\nIGVuZEVtKGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJDb3VsZCBub3QgZ2V0IHF1ZXJpZWQgb2JqZWN0cyBpbnRvIGNhY2hl\nIiwKICAgICAgICAgICAgICAgIGF0dGVtcHRzIDwgMTAwKTsKCiAgICAgICAg\nICAgIC8vIGJ1aWxkIHVwIGEgcXVlcnkgdGhhdCB1c2VzIEggaW4gaXRzIGFj\nY2VzcyBwYXRoLi4uCiAgICAgICAgICAgIGVtID0gZmFjdG9yeS5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgICAgIEJyb2tlciBicm9rZXIgPSBK\nUEFGYWNhZGVIZWxwZXIudG9Ccm9rZXIoZW0pOwogICAgICAgICAgICBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IHEgPSBicm9rZXIubmV3UXVl\ncnkoCiAgICAgICAgICAgICAgICBKUFFMUGFyc2VyLkxBTkdfSlBRTCwgIlNl\nbGVjdCBhIEZST00gIgogICAgICAgICAgICAgICAgKyBDYWNoZU9iamVjdEou\nY2xhc3MuZ2V0U2ltcGxlTmFtZSgpCiAgICAgICAgICAgICAgICArICIgYSB3\naGVyZSBhLnN0ciA9ICdoJyIpOwogICAgICAgICAgICBpdGVyYXRlKChDb2xs\nZWN0aW9uKSBxLmV4ZWN1dGUoKSk7CiAgICAgICAgICAgIGFzc2VydEluQ2Fj\naGUocSwgQm9vbGVhbi5UUlVFKTsKICAgICAgICAgICAgZW5kRW0oZW0pOwoK\nICAgICAgICAgICAgLy8gZm9yY2UgaCBvdXQgb2YgdGhlIGNhY2hlLiB3ZSBt\naWdodCBoYXZlIHRvIHRyeSBtdWx0aXBsZSB0aW1lcwogICAgICAgICAgICAv\nLyBpZiB0aGUgY2FjaGUgaXMgbm90IExSVQogICAgICAgICAgICBhdHRlbXB0\ncyA9IDA7CiAgICAgICAgICAgIGZvciAoOyBhdHRlbXB0cyA8IDEwMCAmJiBj\nYWNoZS5jb250YWlucyhqb2lkd2l0aGNsYXNzKTsgYXR0ZW1wdHMrKykKICAg\nICAgICAgICAgewogICAgICAgICAgICAgICAgZW0gPSBmYWN0b3J5LmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgNTsgaSsrKQogICAgICAgICAgICAgICAgICAgIGVtLmZpbmQo\nUnVudGltZVRlc3QxLmNsYXNzLCBlbS5nZXRPYmplY3RJZChoZWxwZXJPYmpz\nW2ldKSk7CiAgICAgICAgICAgICAgICBlbmRFbShlbSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiQ291bGQgbm90IGtpY2sgcXVl\ncmllZCBvYmplY3RzIG91dCBvZiBjYWNoZSIsCiAgICAgICAgICAgICAgICBh\ndHRlbXB0cyA8IDEwMCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvKgog\nICAgICAgICAgICAgKiBOb3QgYSB2YWxpZCB0ZXN0Li4uICBBdCBsZWFzdCBu\nb3Qgd2l0aCB0aGUgY3VycmVudCBpbXBsZW1lbnRhdGlvbi4uLgogICAgICAg\nICAgICAgKiAKICAgICAgICAgICAgICogSnVzdCByZW1vdmluZyBpdGVtcyBm\ncm9tIHRoZSBEYXRhQ2FjaGUgKGFzIGRvbmUgdmlhIHRoZSBwcmV2aW91cyBs\nb29wKSBpcyBub3Qgc3VmZmljaWVudAogICAgICAgICAgICAgKiB0byByZW1v\ndmUgdGhlIGVudHJpZXMgZnJvbSB0aGUgUXVlcnlDYWNoZS4gIEN1cnJlbnRs\neSwgdGhpcyBub3RpZmljYXRpb24gaXMgZG9uZSBhdCB0aGUgZW5kCiAgICAg\nICAgICAgICAqIG9mIGEgdHJhbnNhY3Rpb24gYWZ0ZXIgaW5zZXJ0cywgdXBk\nYXRlcywgYW5kIGRlbGV0ZXMgaGF2ZSBiZWVuIHBlcmZvcm1lZC4gIFRoZW4s\nIHRoZSAKICAgICAgICAgICAgICogdXBkYXRlQ2FjaGVzKCkgbWV0aG9kIGlz\nIGludm9rZWQgb24gdGhlIERhdGFDYWNoZVN0b3JlTWFuYWdlciB3aGljaCB3\naWxsIGZsb3cgdGhlIHJlcXVlc3QgdG8KICAgICAgICAgICAgICogdGhlIFF1\nZXJ5Q2FjaGUuICBXaXRoIG5vIGRpcmVjdCB1cGRhdGVzIHRvIHRoZSAiRW50\naXRpZXMgb2YgaW50ZXJlc3QiLCB0aGVuIHRoZXJlJ3Mgbm90aGluZyB0bwog\nICAgICAgICAgICAgKiBmbG93IG92ZXIgdG8gdGhlIFF1ZXJ5Q2FjaGUgZm9y\nIGNsZWFudXAuICBFdmVuIHB1dHRpbmcgdGhlIGFib3ZlIGxvb3Agd2l0aGlu\nIGEgdHJhbnNhY3Rpb24gaXMKICAgICAgICAgICAgICogbm90IHN1ZmZpY2ll\nbnQsIHNpbmNlIHRoZXJlIGhhdmUgYmVlbiBubyB1cGRhdGVzIHRvIHRoZSAi\nRW50aXRpZXMgb2YgaW50ZXJlc3QiLgogICAgICAgICAgICAgKi8KLy8gICAg\nICAgICAgICBlbSA9IGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOwov\nLyAgICAgICAgICAgIGJyb2tlciA9IEpQQUZhY2FkZUhlbHBlci50b0Jyb2tl\ncihlbSk7Ci8vICAgICAgICAgICAgcSA9IGJyb2tlci5uZXdRdWVyeShKUFFM\nUGFyc2VyLkxBTkdfSlBRTCwgIlNlbGVjdCBhIEZST00gIgovLyAgICAgICAg\nICAgICAgICArIENhY2hlT2JqZWN0Si5jbGFzcy5nZXRTaW1wbGVOYW1lKCkK\nLy8gICAgICAgICAgICAgICAgKyAiIGEgd2hlcmUgYS5zdHIgPSAnaCciKTsK\nLy8gICAgICAgICAgICB0cnkgewovLyAgICAgICAgICAgICAgICBhc3NlcnRJ\nbkNhY2hlKHEsIG51bGwpOwovLyAgICAgICAgICAgIH0KLy8gICAgICAgICAg\nICBjYXRjaCAoQXNzZXJ0aW9uRmFpbGVkRXJyb3IgZSkgewovLyAgICAgICAg\nICAgICAgICBidWcoNjI2LCAicXVlcnkgY2FjaGUgaW52YWxpZGF0aW9uIGlz\nIGJyb2tlbiIpOwovLyAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vICMj\nIyBzaG91bGQgdGVzdCByZW1vdGUgZXZlbnRzIGNhdXNpbmcgcXVlcmllcyB0\nbyBldmljdC4KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZEVtKGVtKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gRklYTUUg\nU0VldGhhIFNlcCAyNiwyMDA2CiAgICAvLyBub3QgYWJsZSB0byByZXBsYWNl\nIHBtLm5ld1F1ZXJ5KENhY2hlT2JqZWN0RS5jbGFzcyk7CiAgICAvKgogICAg\nICAqIHB1YmxpYyB2b2lkIHRlc3RBbGxlZ2VkUXVlcnlPcmRlcmluZ0NoYW5n\nZXMoKSB0aHJvd3MgRXhjZXB0aW9uIHsgLy8KICAgICAgKiBpbnNwaXJlZCBi\neSB0c2MgMzAxMy4gcGNsOiBJIGhhdmUgbm90IGJlZW4gYWJsZSB0byBnZXQg\ndGhpcyAvLyB0ZXN0IGNhc2UKICAgICAgKiB0byBhY3R1YWxseSBmYWlsLiBI\nb3dldmVyLCBkdXJpbmcgYW5hbHlzaXMgb2YgLy8gMzAxMydzIHN0YWNrIHRy\nYWNlcywgSQogICAgICAqIGRpc2NvdmVyZWQgdGhhdCB0aGUgLy8gUXVlcnlL\nZXkuZXF1YWxzKCkgbWV0aG9kIGRpZCBub3QgZGVhbCB3aXRoIHRoZQogICAg\nICAqIG9yZGVyaW5nIC8vIGZpZWxkIGNvcnJlY3RseSwgcG9zc2libHkgY2F1\nc2luZyB0aGUgcHJvYmxlbS4KICAgICAgKgogICAgICAqIE9wZW5KUEFFbnRp\ndHlNYW5hZ2VyIGVtID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKQogICAgICAq\nIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOyB0cnkgeyBzdGFydFR4\nKGVtLAogICAgICAqICgpKTsgQ2FjaGVPYmplY3RFIGUgPSBuZXcgQ2FjaGVP\nYmplY3RFKCJlIik7IGVtLnBlcnNpc3QoZSk7CiAgICAgICogZW5kVHgoZW0p\nOyB9IGZpbmFsbHkgewogICAgICAqIGVuZEVtKGVtKTsgfQogICAgICAqCiAg\nICAgICogZW0gPSBmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsgUXVl\ncnkgcTsgQ29sbGVjdGlvbiBjOyBMaXN0IGw7IHRyeSB7CiAgICAgICogcSA9\nIGVtLmNyZWF0ZVF1ZXJ5KENhY2hlT2JqZWN0RS5jbGFzcyk7IHEuc2V0T3Jk\nZXJpbmcoInN0ciBhc2NlbmRpbmciKTsKICAgICAgKiBjID0gKENvbGxlY3Rp\nb24pIHEuZXhlY3V0ZSgpOyBsID0gbmV3IExpbmtlZExpc3QoYyk7CiAgICAg\nICogYXNzZXJ0RXF1YWxzKDEsIGMuc2l6ZSgpKTsgfSBmaW5hbGx5IHsgZW5k\nRW0oZW0pOyB9CiAgICAgICoKICAgICAgKiBlbSA9IGZhY3RvcnkuY3JlYXRl\nRW50aXR5TWFuYWdlcigpOyB0cnkgeyBxID0KICAgICAgKiBlbS5jcmVhdGVR\ndWVyeShDYWNoZU9iamVjdEUuY2xhc3MpOyBxLnNldE9yZGVyaW5nKCJzdHIg\nYXNjZW5kaW5nIik7IGMgPQogICAgICAqIChDb2xsZWN0aW9uKSBxLmV4ZWN1\ndGUoKTsgbCA9IG5ldyBMaW5rZWRMaXN0KGMpOyBhc3NlcnRFcXVhbHMoMSwK\nICAgICAgKiBjLnNpemUoKSk7IH0gZmluYWxseSB7IGVuZEVtKGVtKTsgfQog\nICAgICAqCiAgICAgICogdHJ5IHsgZW0gPSBmYWN0b3J5LmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsgcSA9CiAgICAgICogZW0uY3JlYXRlUXVlcnkoQ2FjaGVP\nYmplY3RFLmNsYXNzKTsgcS5zZXRPcmRlcmluZygic3RyIGRlc2NlbmRpbmci\nKTsgYyA9CiAgICAgICogKENvbGxlY3Rpb24pIHEuZXhlY3V0ZSgpOyBhc3Nl\ncnRFcXVhbHMoMSwgYy5zaXplKCkpOyBsID0gbmV3CiAgICAgICogTGlua2Vk\nTGlzdChjKTsgfSBmaW5hbGx5IHsgZW5kRW0oZW0pOyB9IH0KICAgICAgKi8K\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0QWxsZWdlZENvbmN1cnJlbnRNb2RpZmlj\nYXRpb25FeGNlcHRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBP\ncGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IChPcGVuSlBBRW50aXR5TWFuYWdl\ncikgZmFjdG9yeQogICAgICAgICAgICAuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOwogICAgICAgIENhY2hlT2JqZWN0RSBlOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IEpQQUZhY2FkZUhlbHBlci5n\nZXRNZXRhRGF0YShlbSwKICAgICAgICAgICAgICAgIENhY2hlT2JqZWN0RS5j\nbGFzcyk7CiAgICAgICAgICAgIGlmICghaXNPcGVuSlBBQ2FjaGUobWV0YS5n\nZXREYXRhQ2FjaGUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAg\nICAgICAgICBzdGFydFR4KGVtKTsKICAgICAgICAgICAgZSA9IG5ldyBDYWNo\nZU9iamVjdEUoImUiKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChlKTsKICAg\nICAgICAgICAgZW5kVHgoZW0pOwogICAgICAgIH0KICAgICAgICBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kRW0oZW0pOwogICAgICAgIH0KCiAgICAgICAg\nZW0gPSBmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBzdGFydFR4KGVtKTsKCiAgICAgICAgICAgIC8v\nIGZpbmQgdGhlIG5ldyBvYmplY3QuLi4KICAgICAgICAgICAgT3BlbkpQQVF1\nZXJ5IHEgPSBlbS5jcmVhdGVRdWVyeSgic2VsZWN0IGEgRlJPTSAiCiAgICAg\nICAgICAgICAgICArIENhY2hlT2JqZWN0RS5jbGFzcy5nZXRTaW1wbGVOYW1l\nKCkKICAgICAgICAgICAgICAgICsgIiBhIHdoZXJlIGEuc3RyID0gJ2UnIik7\nCiAgICAgICAgICAgIGUgPSAoQ2FjaGVPYmplY3RFKSAoKENvbGxlY3Rpb24p\nIHEuZ2V0UmVzdWx0TGlzdCgpKS5pdGVyYXRvcigpCiAgICAgICAgICAgICAg\nICAubmV4dCgpOwoKICAgICAgICAgICAgLy8gLi4uIGFuZCBtb2RpZnkgdGhl\nIGNoYW5nZWQgb2JqZWN0LgogICAgICAgICAgICBlLnNldFN0cigiZTIiKTsK\nICAgICAgICAgICAgZS5zZXRTdHIoImUzIik7CiAgICAgICAgICAgIGVuZFR4\nKGVtKTsKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZEVtKGVtKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29s\nZWFuIGlzT3BlbkpQQUNhY2hlKERhdGFDYWNoZSBjYWNoZSkgewogICAgICAg\nIGlmIChjYWNoZSBpbnN0YW5jZW9mIERlbGVnYXRpbmdEYXRhQ2FjaGUpCiAg\nICAgICAgICAgIGNhY2hlID0gKChEZWxlZ2F0aW5nRGF0YUNhY2hlKSBjYWNo\nZSkuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKCiAgICAgICAgcmV0dXJuIGNh\nY2hlIGluc3RhbmNlb2YgQ29uY3VycmVudERhdGFDYWNoZTsKICAgIH0KCiAg\nICAvLyAtLS0tLS0tLS0tIHV0aWxpdHkgbWV0aG9kcyAtLS0tLS0tLS0tCgog\nICAgcHJpdmF0ZSB2b2lkIGNoZWNrQ2FjaGUoRGF0YUNhY2hlIGNhY2hlLCBP\nYmplY3RbXSBpZHMsIGJvb2xlYW5bXSBzdGF0aSkgewogICAgICAgIENhY2hl\nVGVzdEhlbHBlci5jaGVja0NhY2hlKHRoaXMsIGNhY2hlLCBpZHMsIHN0YXRp\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0SW5DYWNoZShvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IHEsCiAgICAgICAgQm9vbGVh\nbiBpbkNhY2hlKSB7CiAgICAgICAgQ2FjaGVUZXN0SGVscGVyLmFzc2VydElu\nQ2FjaGUodGhpcywgcSwgaW5DYWNoZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIGFzc2VydEluQ2FjaGUob3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5R\ndWVyeSBxLAogICAgICAgIEJvb2xlYW4gaW5DYWNoZSwgT2JqZWN0W10gYXJn\ncykgewogICAgICAgIENhY2hlVGVzdEhlbHBlci5hc3NlcnRJbkNhY2hlKHRo\naXMsIHEsIGluQ2FjaGUsIGFyZ3MpOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBpdGVyYXRlKENvbGxlY3Rpb24gYykgewogICAgICAgIENhY2hlVGVzdEhl\nbHBlci5pdGVyYXRlKGMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RJ\nbnRlcmZhY2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBPcGVuSlBB\nRW50aXR5TWFuYWdlciBuZXdFbSA9CiAgICAgICAgICAgIChPcGVuSlBBRW50\naXR5TWFuYWdlcikgZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAg\nICAgICAgc3RhcnRUeChuZXdFbSk7CiAgICAgICAgQ2FjaGVPYmplY3RBIGEg\nPSAoQ2FjaGVPYmplY3RBKSBuZXdFbS5maW5kKENhY2hlT2JqZWN0QS5jbGFz\ncywgb2lkKTsKICAgICAgICBDYWNoZU9iamVjdEMgYyA9IG5ldyBDYWNoZU9i\namVjdEMoImJsYWgiKTsKICAgICAgICBhLnNldFJlbGF0ZWRJbnRlcmZhY2Uo\nYyk7CiAgICAgICAgZW5kVHgobmV3RW0pOwogICAgICAgIE9iamVjdCBjSWQg\nPSBuZXdFbS5nZXRPYmplY3RJZChjKTsKICAgICAgICBlbmRFbShuZXdFbSk7\nCgogICAgICAgIG5ld0VtID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0\nb3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBhID0gKENhY2hl\nT2JqZWN0QSkgbmV3RW0uZmluZChDYWNoZU9iamVjdEEuY2xhc3MsIG9pZCk7\nCgogICAgICAgIENhY2hlT2JqZWN0SW50ZXJmYWNlIGMyID0gYS5nZXRSZWxh\ndGVkSW50ZXJmYWNlKCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChjMik7Cgog\nICAgICAgIGFzc2VydEVxdWFscyhjSWQsIG5ld0VtLmdldE9iamVjdElkKGMy\nKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFF1ZXJpZXNPbkNvbGxl\nY3Rpb25zRG9udFVzZUNhY2hlKCkgewogICAgICAgIE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyIGVtID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5CiAg\nICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgc3RhcnRUeChlbSk7CiAgICAgICAgICAgIENhY2hl\nT2JqZWN0RSBlID0gbmV3IENhY2hlT2JqZWN0RSgiZSIpOwogICAgICAgICAg\nICBlbS5wZXJzaXN0KGUpOwogICAgICAgICAgICBlbmRUeChlbSk7CiAgICAg\nICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRFbShlbSk7\nCiAgICAgICAgfQoKICAgICAgICBlbSA9IChPcGVuSlBBRW50aXR5TWFuYWdl\ncikgZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgT3Bl\nbkpQQVF1ZXJ5IHE7CiAgICAgICAgQ29sbGVjdGlvbiBjOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHEgPSBlbS5jcmVhdGVRdWVyeSgic2VsZWN0IGEg\nRlJPTSAiCiAgICAgICAgICAgICAgICArIENhY2hlT2JqZWN0RS5jbGFzcy5n\nZXRTaW1wbGVOYW1lKCkKICAgICAgICAgICAgICAgICsgIiBhIHdoZXJlIGEu\nc3RyID0gJ2UnIik7CiAgICAgICAgICAgIGMgPSBuZXcgQXJyYXlMaXN0KChD\nb2xsZWN0aW9uKSBxLmdldFJlc3VsdExpc3QoKSk7CiAgICAgICAgICAgIGFz\nc2VydEVxdWFscygxLCBjLnNpemUoKSk7CiAgICAgICAgICAgIHEuY2xvc2VB\nbGwoKTsKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZEVtKGVtKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGVtID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5LmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICAgICAgcSA9IGVtLmNyZWF0ZVF1\nZXJ5KCJzZWxlY3QgYSBGUk9NICIKICAgICAgICAgICAgICAgICsgQ2FjaGVP\nYmplY3RFLmNsYXNzLmdldFNpbXBsZU5hbWUoKQogICAgICAgICAgICAgICAg\nKyAiIGEgd2hlcmUgYS5zdHIgPSAnZSciKTsKICAgICAgICAgICAgcS5zZXRD\nYW5kaWRhdGVDb2xsZWN0aW9uKG5ldyBBcnJheUxpc3QoMCkpOwogICAgICAg\nICAgICBjID0gKENvbGxlY3Rpb24pIHEuZ2V0UmVzdWx0TGlzdCgpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoMCwgYy5zaXplKCkpOwogICAgICAgICAg\nICBxLmNsb3NlQWxsKCk7CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRFbShlbSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHRlc3RERkdGaWVsZHNMb2FkZWQxKCkgewogICAgICAgIGRm\nZ0ZpZWxkc0xvYWRlZEhlbHBlcihmYWxzZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgdGVzdERGR0ZpZWxkc0xvYWRlZDIoKSB7CiAgICAgICAgZGZnRmll\nbGRzTG9hZGVkSGVscGVyKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGRmZ0ZpZWxkc0xvYWRlZEhlbHBlcihib29sZWFuIHJlbGF0ZWQpIHsKICAg\nICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IChPcGVuSlBBRW50aXR5\nTWFuYWdlcikgZmFjdG9yeQogICAgICAgICAgICAuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOwogICAgICAgIHN0YXJ0VHgoZW0pOwogICAgICAgIE9wZW5KUEFR\ndWVyeSBxOwogICAgICAgIENvbGxlY3Rpb24gYzsKICAgICAgICB0cnkgewoK\nICAgICAgICAgICAgcSA9IGVtLmNyZWF0ZVF1ZXJ5KAogICAgICAgICAgICAg\nICAgInNlbGVjdCBhIEZST00gIiArIENhY2hlT2JqZWN0QS5jbGFzcy5nZXRT\naW1wbGVOYW1lKCkKICAgICAgICAgICAgICAgICAgICArICIgYSB3aGVyZSBh\nLm5hbWUgPSA6cE5hbWUiKS5zZXRQYXJhbWV0ZXIoInBOYW1lIiwKICAgICAg\nICAgICAgICAgIE9SSUdfTkFNRSk7CgogICAgICAgICAgICBjID0gbmV3IEFy\ncmF5TGlzdCgoQ29sbGVjdGlvbikgcS5nZXRSZXN1bHRMaXN0KCkpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoMSwgYy5zaXplKCkpOwogICAgICAgICAg\nICBDYWNoZU9iamVjdEEgYSA9IChDYWNoZU9iamVjdEEpIGMuaXRlcmF0b3Io\nKS5uZXh0KCk7CiAgICAgICAgICAgIGlmIChyZWxhdGVkKQogICAgICAgICAg\nICAgICAgYS5nZXRSZWxhdGVkQXJyYXkoKTsKICAgICAgICAgICAgZW0uZGV0\nYWNoKGEpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoT1JJR19OQU1FLCBh\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHEuY2xvc2VBbGwoKTsKICAgICAg\nICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHJvbGxiYWNrVHgo\nZW0pOwogICAgICAgICAgICBlbmRFbShlbSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vIEZJWE1FIFNlZXRoYSBTZXAgMjYsMjAwNgogICAgLyoKICAgICAg\nKiBwdWJsaWMgdm9pZCB0ZXN0UXVlcmllc0FmdGVyTW9kaWZpY2F0aW9uQXJl\nTm90SW5DYWNoZSgpIHsKICAgICAgKiBPcGVuSlBBRW50aXR5TWFuYWdlciBl\nbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikKICAgICAgKiBmYWN0b3J5LmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKTsgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0y\nID0KICAgICAgKiAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkuY3Jl\nYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAqCiAgICAgICogLy9GSVhNRSBT\nZWV0aGEgU2VwIDI2LDIwMDYgLy9lbS5zZXRJZ25vcmVDYWNoZShmYWxzZSk7\nCiAgICAgICogLy9lbTIuc2V0SWdub3JlQ2FjaGUoZmFsc2UpOyAoKEZldGNo\nUGxhbikgZW0uZ2V0RmV0Y2hQbGFuKCkpLgogICAgICAqIHNldEZsdXNoQmVm\nb3JlUXVlcmllcyhGZXRjaFBsYW4uRkxVU0hfVFJVRSk7ICgoRmV0Y2hQbGFu\nKQogICAgICAqIGVtMi5nZXRGZXRjaFBsYW4oKSkuIHNldEZsdXNoQmVmb3Jl\nUXVlcmllcyhGZXRjaFBsYW4uRkxVU0hfVFJVRSk7CiAgICAgICoKICAgICAg\nKiB0cnkgeyBzdGFydFR4KGVtKTsgQ2FjaGVPYmplY3RFIGUgPSBuZXcKICAg\nICAgKiBDYWNoZU9iamVjdEUoImUiKTsgZW0ucGVyc2lzdChlKTsgZW5kVHgo\nZW0sCiAgICAgICogKCkpOwogICAgICAqCiAgICAgICogc3RhcnRUeChlbSk7\nCiAgICAgICogIC8vIGZpcnN0LCBhIHF1ZXJ5IHRoYXQgc2hvdWxkIGdldCBp\nbnRvIHRoZSBjYWNoZS4gQnJva2VyIGJyb2tlciA9CiAgICAgICogSlBBRmFj\nYWRlSGVscGVyLnRvQnJva2VyKGVtKTsgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5RdWVyeSBxID0KICAgICAgKiBicm9rZXIubmV3UXVlcnkoSlBRTFBh\ncnNlci5MQU5HX0pQUUwsIENhY2hlT2JqZWN0RS5jbGFzcywgInN0ciA9PQog\nICAgICAqIFwiZVwiIik7IENvbGxlY3Rpb24gYyA9IChDb2xsZWN0aW9uKSBx\nLmV4ZWN1dGUoKTsgZm9yIChJdGVyYXRvciBpdGVyID0KICAgICAgKiBjLml0\nZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgaXRlci5uZXh0KCk7CiAgICAg\nICoKICAgICAgKiBhc3NlcnRFcXVhbHMoMSwgYy5zaXplKCkpOyBhc3NlcnRJ\nbkNhY2hlKHEsIEJvb2xlYW4uVFJVRSk7CiAgICAgICoKICAgICAgKiBCcm9r\nZXIgYnJva2VyMiA9IEpQQUZhY2FkZUhlbHBlci50b0Jyb2tlcihlbTIpOwog\nICAgICAqIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcTIgPSBi\ncm9rZXIyLm5ld1F1ZXJ5KHEuZ2V0TGFuZ3VhZ2UoKSwKICAgICAgKiBxKTsK\nICAgICAgKiAgLy8gbWFrZSBzb21lIG1vZGlmaWNhdGlvbnMgYW5kIGxvb2sg\nYWdhaW4uIFNob3VsZCByZXR1cm4gLy90d28gcmVzdWx0cy4KICAgICAgKiBl\nID0gbmV3IENhY2hlT2JqZWN0RSgiZSIpOyBlbS5wZXJzaXN0KGUpOwogICAg\nICAqCiAgICAgICogcSA9IGJyb2tlci5uZXdRdWVyeShKUFFMUGFyc2VyLkxB\nTkdfSlBRTCwgQ2FjaGVPYmplY3RFLmNsYXNzLCAic3RyID09CiAgICAgICog\nXCJlXCIiKTsgYyA9IChDb2xsZWN0aW9uKSBxLmV4ZWN1dGUoKTsgYXNzZXJ0\nRXF1YWxzKDIsIGMuc2l6ZSgpKTsgZm9yCiAgICAgICogKEl0ZXJhdG9yIGl0\nZXIgPSBjLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgaXRlci5uZXh0\nKCk7CiAgICAgICogIC8vIG9yaWdpbmFsIHF1ZXJ5IHNob3VsZCBzdGlsbCBi\nZSBpbiBjYWNoZSBhc3NlcnRJbkNhY2hlKHEyLAogICAgICAqIEJvb2xlYW4u\nVFJVRSk7CiAgICAgICoKICAgICAgKiBDb2xsZWN0aW9uIGMyID0gKENvbGxl\nY3Rpb24pIHEyLmV4ZWN1dGUoKTsgYXNzZXJ0RXF1YWxzKDEsIGMyLnNpemUo\nKSk7CiAgICAgICogIC8vIG5ldyBxdWVyeSBzaG91bGQgbm90IG1ha2UgaXQg\naW50byBjYWNoZQogICAgICAqCiAgICAgICogcSA9IGJyb2tlciAubmV3UXVl\ncnkoSlBRTFBhcnNlci5MQU5HX0pQUUwsIENhY2hlT2JqZWN0RS5jbGFzcywg\nbnVsbCk7CiAgICAgICogYyA9IChDb2xsZWN0aW9uKSBxLmV4ZWN1dGUoKTsg\nYXNzZXJ0RXF1YWxzKDIsIGMuc2l6ZSgpKTsKICAgICAgKiBmb3IgKEl0ZXJh\ndG9yIGl0ZXIgPSBjLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgaXRl\nci5uZXh0KCk7CiAgICAgICoKICAgICAgKiBhc3NlcnRJbkNhY2hlKHEsIEJv\nb2xlYW4uRkFMU0UpOyB9IGZpbmFsbHkgewogICAgICAqIHJvbGxiYWNrVHgo\nZW0pOwogICAgICAqIGVuZEVtKGVtKTsKICAgICAgKiBlbmRFbShlbTIpOyB9\nIH0KICAgICAgKi8KCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q2FjaGVkUXVlcnlD\nbG9zdXJlUmVsZWFzZXNSZXNvdXJjZXMoKSB7CiAgICAgICAgLy8gUGVyc2lz\ndGVuY2VNYW5hZ2VyRmFjdG9yeSBmYWN0b3J5ID0KICAgICAgICAvLyBLb2Rv\nSGVscGVyLmNyZWF0ZUVudGl0eU1hbmFnZXJGYWN0b3J5ICgpOwogICAgICAg\nIEVudGl0eU1hbmFnZXIgaW5pdEVtID0gZmFjdG9yeS5jcmVhdGVFbnRpdHlN\nYW5hZ2VyKCk7CiAgICAgICAgc3RhcnRUeChpbml0RW0pOwogICAgICAgIENh\nY2hlT2JqZWN0RSBlID0gbmV3IENhY2hlT2JqZWN0RSgiZSIpOwogICAgICAg\nIGluaXRFbS5wZXJzaXN0KGUpOwogICAgICAgIGVuZFR4KGluaXRFbSk7CiAg\nICAgICAgZW5kRW0oaW5pdEVtKTsKCiAgICAgICAgQnJva2VyIGJyb2tlciA9\nIEpQQUZhY2FkZUhlbHBlci50b0Jyb2tlckZhY3RvcnkoZmFjdG9yeSkubmV3\nQnJva2VyKCk7CiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5R\ndWVyeSBxID0gYnJva2VyLm5ld1F1ZXJ5KAogICAgICAgICAgICBKUFFMUGFy\nc2VyLkxBTkdfSlBRTCwgIlNlbGVjdCBhIEZST00gIgogICAgICAgICAgICAr\nIENhY2hlT2JqZWN0RS5jbGFzcy5nZXRTaW1wbGVOYW1lKCkKICAgICAgICAg\nICAgKyAiIGEgd2hlcmUgYS5zdHIgPSAnZSciKTsKICAgICAgICBDb2xsZWN0\naW9uIGMgPSAoQ29sbGVjdGlvbikgcS5leGVjdXRlKCk7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdGVyID0gYy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQo\nKTspCiAgICAgICAgICAgIGl0ZXIubmV4dCgpOwoKICAgICAgICBhc3NlcnRF\ncXVhbHMoMSwgYy5zaXplKCkpOwogICAgICAgIGFzc2VydEluQ2FjaGUocSwg\nQm9vbGVhbi5UUlVFKTsKCiAgICAgICAgSW1wbEhlbHBlci5jbG9zZShjKTsK\nCiAgICAgICAgYnJva2VyLmNsb3NlKCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgdGVzdE11dGFibGVTQ09zQXJlQ29udmVydGVkKCkgewogICAgICAgIE9w\nZW5KUEFFbnRpdHlNYW5hZ2VyIGVtMCA9IChPcGVuSlBBRW50aXR5TWFuYWdl\ncikgZmFjdG9yeQogICAgICAgICAgICAuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOwogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtMSA9IChPcGVuSlBB\nRW50aXR5TWFuYWdlcikgZmFjdG9yeQogICAgICAgICAgICAuY3JlYXRlRW50\naXR5TWFuYWdlcigpOwoKICAgICAgICBzdGFydFR4KGVtMCk7CiAgICAgICAg\nQ2FjaGVPYmplY3RBIGEgPSAoQ2FjaGVPYmplY3RBKSBlbTAuZmluZChDYWNo\nZU9iamVjdEEuY2xhc3MsIG9pZCk7CgogICAgICAgIERhdGUgZCA9IG5ldyBE\nYXRlKCk7CiAgICAgICAgYS5zZXREYXRlKGQpOwoKICAgICAgICBlbmRUeChl\nbTApOwogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IGNhY2hlTWFuYWdlcihm\nYWN0b3J5KS5nZXREYXRhQ2FjaGUoCiAgICAgICAgICAgIERhdGFDYWNoZS5O\nQU1FX0RFRkFVTFQsIGZhbHNlKTsKICAgICAgICBhc3NlcnRUcnVlKGNhY2hl\nLmNvbnRhaW5zKG9pZHdpdGhjbGFzcykpOwogICAgICAgIGNhY2hlLnJlbW92\nZShvaWR3aXRoY2xhc3MpOwoKICAgICAgICBhID0gKENhY2hlT2JqZWN0QSkg\nZW0xLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOwogICAgICAgIGFz\nc2VydFRydWUoY2FjaGUuY29udGFpbnMob2lkd2l0aGNsYXNzKSk7CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFBDRGF0YSBkYXRhID0gY2FjaGUuZ2V0\nKG9pZHdpdGhjbGFzcyk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYSA9CiAgICAgICAgICAgICAgICAoKE9wZW5KUEFFbnRpdHlNYW5hZ2VyRmFj\ndG9yeVNQSSkgT3BlbkpQQVBlcnNpc3RlbmNlCiAgICAgICAgICAgICAgICAg\nICAgLmNhc3QoZmFjdG9yeSkpLmdldENvbmZpZ3VyYXRpb24oKQogICAgICAg\nICAgICAgICAgICAgIC5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgp\nLmdldE1ldGFEYXRhKGEuZ2V0Q2xhc3MoKSwKICAgICAgICAgICAgICAgICAg\nICBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gbWV0YS5nZXRGaWVsZCgiZGF0ZSIpOwogICAgICAgICAgICBkID0gKERh\ndGUpIGRhdGEuZ2V0RGF0YShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAg\nIEJyb2tlciBicm9rZXIgPSBKUEFGYWNhZGVIZWxwZXIudG9Ccm9rZXIoZW0x\nKTsKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IGJyb2tl\nci5nZXRTdGF0ZU1hbmFnZXIoYSk7CiAgICAgICAgICAgIGFzc2VydFRydWUo\nc20gPT0gKChQcm94eURhdGUpIGEuZ2V0RGF0ZSgpKS5nZXRPd25lcigpKTsK\nICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKERhdGUuY2xhc3MsIGQuZ2V0Q2xh\nc3MoKSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRFbShlbTApOwogICAgICAgICAgICBlbmRFbShlbTEpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0RW1wdHlSZXN1bHRzQXJl\nQ2FjaGVkKCkgewogICAgICAgIEJyb2tlciBicm9rZXIgPSBKUEFGYWNhZGVI\nZWxwZXIudG9Ccm9rZXJGYWN0b3J5KGZhY3RvcnkpLm5ld0Jyb2tlcigpOwog\nICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcSA9IGJy\nb2tlci5uZXdRdWVyeSgKICAgICAgICAgICAgSlBRTFBhcnNlci5MQU5HX0pQ\nUUwsICJTZWxlY3QgYSBGUk9NICIKICAgICAgICAgICAgKyBDYWNoZU9iamVj\ndEFDaGlsZDEuY2xhc3MuZ2V0U2ltcGxlTmFtZSgpCiAgICAgICAgICAgICsg\nIiBhIHdoZXJlIGEubmFtZSA9ICd0ZXN0RW1wdHlSZXN1bHRzQXJlQ2FjaGVk\nJyIpOwogICAgICAgIENvbGxlY3Rpb24gYyA9IChDb2xsZWN0aW9uKSBxLmV4\nZWN1dGUoKTsKICAgICAgICBhc3NlcnRFcXVhbHMoMCwgYy5zaXplKCkpOwog\nICAgICAgIGFzc2VydEluQ2FjaGUocSwgQm9vbGVhbi5UUlVFKTsKICAgICAg\nICBicm9rZXIuY2xvc2UoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZG9h\nc3NlcnRUcnVlKEVudGl0eU1hbmFnZXIgZW0sIFN0cmluZyBuYW1lLCBpbnQg\nYWdlKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIENhY2hl\nT2JqZWN0QSBhID0gKENhY2hlT2JqZWN0QSkgZW0uZmluZChDYWNoZU9iamVj\ndEEuY2xhc3MsIG9pZCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShuYW1lLmVxdWFs\ncyhhLmdldE5hbWUoKSkpOwogICAgICAgIGFzc2VydFRydWUoYS5nZXRBZ2Uo\nKSA9PSBhZ2UpOwogICAgICAgIGVuZEVtKGVtKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgYXNzZXJ0TmV3KENhY2hlT2JqZWN0QSBhKSB7CiAgICAgICAg\nYXNzZXJ0VHJ1ZShORVdfTkFNRS5lcXVhbHMoYS5nZXROYW1lKCkpKTsKICAg\nICAgICBhc3NlcnRUcnVlKE9SSUdfQUdFID09IGEuZ2V0QWdlKCkpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBhc3NlcnRPbGQoQ2FjaGVPYmplY3RBIGEp\nIHsKICAgICAgICBhc3NlcnRUcnVlKE9SSUdfTkFNRS5lcXVhbHMoYS5nZXRO\nYW1lKCkpKTsKICAgICAgICBhc3NlcnRUcnVlKE9SSUdfQUdFID09IGEuZ2V0\nQWdlKCkpOwogICAgfQoKICAgIHByaXZhdGUgRGF0YUNhY2hlTWFuYWdlciBj\nYWNoZU1hbmFnZXIoT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5IGZhY3Rv\ncnkpIHsKICAgICAgICByZXR1cm4gQ2FjaGVUZXN0SGVscGVyCiAgICAgICAg\nICAgIC5jYWNoZU1hbmFnZXIoSlBBRmFjYWRlSGVscGVyLnRvQnJva2VyRmFj\ndG9yeShmYWN0b3J5KSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNsb3Nl\nKEVudGl0eU1hbmFnZXIgZW0pIHsKICAgICAgICByb2xsYmFja1R4KGVtKTsK\nICAgICAgICBlbmRFbShlbSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNs\nb3NlKEJyb2tlciBicm9rZXIpIHsKICAgICAgICBpZiAoYnJva2VyLmlzQWN0\naXZlKCkpCiAgICAgICAgICAgIGJyb2tlci5yb2xsYmFjaygpOwogICAgICAg\nIGJyb2tlci5jbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBTdHJpbmcgdHlwZSA9IGFyZ3NbaV07CgogICAgICAgICAg\nICBDYWNoZVRlc3QgYzsKICAgICAgICAgICAgaWYgKHR5cGUuZXF1YWxzKCJ0\nY3AiKSkgewogICAgICAgICAgICAgICAgYyA9IG5ldyBEaXN0cmlidXRlZENh\nY2hlVGVzdCgidGltZSB0ZXN0IiwKICAgICAgICAgICAgICAgICAgICBDb25j\ndXJyZW50RGF0YUNhY2hlLmNsYXNzKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nICh0eXBlLmVxdWFscygiam1zIikpIHsKICAgICAgICAgICAgICAgIGMgPSBu\nZXcgRGlzdHJpYnV0ZWRDYWNoZVRlc3QoInRpbWUgdGVzdCIsCiAgICAgICAg\nICAgICAgICAgICAgQ29uY3VycmVudERhdGFDYWNoZS5jbGFzcyk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjID0gbmV3IFRlc3RM\nb2NhbENhY2hlKCJ0aW1lIHRlc3QiKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgYy5zZXRVcCgpOwogICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgIGludCBjb3Vu\ndCA9IDEwMDA7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgY291\nbnQ7IGorKykgewogICAgICAgICAgICAgICAgYy5kb2Fzc2VydFRydWUoYy5m\nYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKSwgTkVXX05BTUUsCiAgICAg\nICAgICAgICAgICAgICAgT1JJR19BR0UpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbihjb3VudCArICIgaXRlcmF0aW9u\ncyBpbiAiCiAgICAgICAgICAgICAgICArIChTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKSAtIHN0YXJ0KSArICIgbWlsbGlzIik7CiAgICAgICAgICAgIGMu\ndGVhckRvd24oKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

