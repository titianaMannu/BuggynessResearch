{"sha":"ba891f9198a2de85c3aa9fee63791700f39cf8e0","node_id":"MDQ6QmxvYjIwNjM2NDpiYTg5MWY5MTk4YTJkZTg1YzNhYTlmZWU2Mzc5MTcwMGYzOWNmOGUw","size":39193,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ba891f9198a2de85c3aa9fee63791700f39cf8e0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5sb2NrbWdyOwoK\naW1wb3J0IGphdmEuaW8uQnl0ZUFycmF5SW5wdXRTdHJlYW07CmltcG9ydCBq\nYXZhLmlvLkJ5dGVBcnJheU91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8u\nT2JqZWN0SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUHJpbnRXcml0ZXI7CmltcG9ydCBq\nYXZhLmlvLlN0cmluZ1dyaXRlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGls\nLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5FbnRpdHlNYW5hZ2VyOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTG9ja01vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuUXVlcnk7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29u\nZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb25JbXBsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFFbnRpdHlNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLnRlc3QuU1FM\nTGlzdGVuZXJUZXN0Q2FzZTsKCi8qKgogKiBCYXNlIGNsYXNzIHRvIHN1cHBv\ncnQgcHNldWRvIHByb2dyYW1tYWJsZSBwcmUtZGVmaW5lIEpQQSByZWxhdGVk\nCiAqIGFjdGlvbnMgd2hpY2ggaXMgZHJpdmVuIGJ5IGFjdGlvbiB0YWJsZSBk\nZWZpbmUgYnkgYSB0ZXN0IGNhc2UuIEUuZy4KICogPHByZT4KICogT2JqZWN0\nW11bXSBhY3Rpb25zID0gewogKiAgIHsgQWN0LkFjdGlvbnMgWywgYWN0aW9u\nX3NwZWNpZmljX3BhcmFtZXRlcnNdKiB9CiAqIH07CiAqIDwvcHJlPgogKiBT\nZWUgZW51bSB0eXBlIDxjb2RlPkFjdDwvY29kZT4gZm9yIGxpc3Qgb2YgdmFs\naWQgYWN0aW9ucy4KICogPHA+VGhlIGFjdGlvbiBvYmplY3RzIGFyZSBwYXNz\nZWQgYXMgYXJndW1lbnQgdG8gdGhlIGxhdW5jaEFjdGlvblNlcXVlbmNlKCkK\nICogbWV0aG9kLiBUaGUgYWN0aW9ucyBpbiB0aGUgc2VxdWVuY2UgdGFibGUg\nYXJlIGludm9rZWQgaW4gdGhlIG9yZGVyCiAqIHNwZWNpZmllZC4gRWFjaCBh\nY3Rpb24gc2VxdWVuY2UgdGFibGUgaW4gdGhlIGFyZ3VtZW50IGxpc3QgYXJl\nIGxhdW5jaGVkIGluCiAqIGEgc2VwYXJhdGUgdGhyZWFkLgogKgogKiBAYXV0\naG9yIEFsYmVydCBMZWUKICogQHNpbmNlIDIuMAogKi8KcHVibGljIGFic3Ry\nYWN0IGNsYXNzIFNlcXVlbmNlZEFjdGlvbnNUZXN0IGV4dGVuZHMgU1FMTGlz\ndGVuZXJUZXN0Q2FzZSB7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgRGVmYXVsdF9GaXJzdE5hbWUgPSAiRGVmIEZpcnN0TmFtZSI7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIENsYXNzPD8+W10gRXhwZWN0aW5n\nT3B0aW1pc3RpY0xvY2tFeENsYXNzID0KICAgICAgICBuZXcgQ2xhc3M8Pz5b\nXQogICAgICAgICAgICB7IGphdmF4LnBlcnNpc3RlbmNlLk9wdGltaXN0aWNM\nb2NrRXhjZXB0aW9uLmNsYXNzIH07CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIENsYXNzPD8+W10gRXhwZWN0aW5nUGVzc2ltaXN0aWNMb2NrRXhDbGFz\ncyA9CiAgICAgICAgbmV3IENsYXNzPD8+W10KICAgICAgICAgICAgeyBqYXZh\neC5wZXJzaXN0ZW5jZS5QZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24uY2xhc3Mg\nfTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgQ2xhc3M8Pz5bXSBFeHBl\nY3RpbmdMb2NrVGltZW91dEV4Q2xhc3MgPQogICAgICAgIG5ldyBDbGFzczw/\nPltdCiAgICAgICAgICAgIHsgamF2YXgucGVyc2lzdGVuY2UuTG9ja1RpbWVv\ndXRFeGNlcHRpb24uY2xhc3MgfTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgQ2xhc3M8Pz5bXSBFeHBlY3RpbmdBbnlMb2NrRXhDbGFzcyA9CiAgICAg\nICAgbmV3IENsYXNzPD8+W10gewogICAgICAgICAgICBqYXZheC5wZXJzaXN0\nZW5jZS5QZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24uY2xhc3MsCiAgICAgICAg\nICAgIGphdmF4LnBlcnNpc3RlbmNlLkxvY2tUaW1lb3V0RXhjZXB0aW9uLmNs\nYXNzIH07CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTWluVGhy\nZWFkV2FpdEluTXMgPSAxMDAwMDsKCiAgICBwcml2YXRlIHN0YXRpYyBsb25n\nIHdhaXRJbk1zZWMgPSAtMTsKICAgIHByaXZhdGUgU3RyaW5nIGVtcFRhYmxl\nTmFtZTsKICAgIHByaXZhdGUgTGlzdDxUZXN0VGhyZWFkPiB0aHJlYWRzID0g\nbnVsbDsKCiAgICBwcm90ZWN0ZWQgdm9pZCBjb21tb25TZXRVcCgpIHsKICAg\nICAgICBlbXBUYWJsZU5hbWUgPSBnZXRNYXBwaW5nKExvY2tFbXBsb3llZS5j\nbGFzcykuZ2V0VGFibGUoKS5nZXRGdWxsTmFtZSgpOwoKICAgICAgICBjbGVh\nbnVwREIoKTsKCiAgICAgICAgTG9ja0VtcGxveWVlIGUxLCBlMiwgZTM7CiAg\nICAgICAgZTEgPSBuZXdFbXBsb3llZSgxKTsKICAgICAgICBlMiA9IG5ld0Vt\ncGxveWVlKDIpOwogICAgICAgIGUzID0gbmV3RW1wbG95ZWUoMyk7CgogICAg\nICAgIHJlc2V0U1FMKCk7CiAgICAgICAgRW50aXR5TWFuYWdlciBlbSA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZW0gPSBlbWYuY3JlYXRl\nRW50aXR5TWFuYWdlcigpOwogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoZTEpOwogICAg\nICAgICAgICBlbS5wZXJzaXN0KGUyKTsKICAgICAgICAgICAgZW0ucGVyc2lz\ndChlMyk7CiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0\nKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGVtICE9\nIG51bGwgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAgICAgIGVtLmNs\nb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXNzZXJ0\nQWxsU1FMSW5PcmRlcigKICAgICAgICAgICAgIklOU0VSVCBJTlRPICIgKyBl\nbXBUYWJsZU5hbWUgKyAiIC4qIik7CgogICAgICAgIC8vIGR5bmFtaWMgcnVu\ndGltZSB0ZXN0IHRvIGRldGVybWluZSB3YWl0IHRpbWUuCiAgICAgICAgbG9u\nZyBzcGVlZENudCA9IC0xOwogICAgICAgIGlmICh3YWl0SW5Nc2VjID09IC0x\nKSB7CiAgICAgICAgICAgIHNwZWVkQ250ID0gcGxhdGZvcm1TcGVlZFRlc3Qo\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdhaXRJbk1z\nZWMgPSBNaW5UaHJlYWRXYWl0SW5NcyArIDI1MDAwMCAvIChzcGVlZENudCAv\nIDEwMDAwMDApOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh3YWl0SW5N\nc2VjIDw9IDApIHsKICAgICAgICAgICAgd2FpdEluTXNlYyA9IE1pblRocmVh\nZFdhaXRJbk1zOyAvLyBzZXQgdG8gZGVmYXVsdAogICAgICAgIH0KICAgICAg\nICBnZXRMb2coKS50cmFjZSgKICAgICAgICAgICAgIioqKiogU3BlZWQgQ29u\ndD0iICsgc3BlZWRDbnQgKyAiLCB3YWl0VGltZShtcyk9IiArIHdhaXRJbk1z\nZWMpOwogICAgfQoKICAgIHByaXZhdGUgbG9uZyBwbGF0Zm9ybVNwZWVkVGVz\ndCgpIHsKICAgICAgICBQbGF0Zm9ybVNwZWVkVGVzdFRocmVhZCBzcGVlZFRo\ncmVhZCA9IG5ldyBQbGF0Zm9ybVNwZWVkVGVzdFRocmVhZCgpOwogICAgICAg\nIHNwZWVkVGhyZWFkLnN0YXJ0KCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgbG9nU3RhY2soZSk7\nCiAgICAgICAgfQogICAgICAgIHNwZWVkVGhyZWFkLmludGVycnVwdCgpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFRocmVhZC5zbGVlcCg1MCk7CiAg\nICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBsb2dTdGFjayhlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHNwZWVkVGhyZWFkLmdldExvb3BDbnQoKTsKICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgY2xlYW51cERCKCkgewogICAgICAgIEVudGl0eU1hbmFnZXIgZW0g\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVtID0gZW1mLmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5iZWdpbigpOwoKICAgICAgICAgICAgZW0uY3JlYXRlUXVlcnko\nImRlbGV0ZSBmcm9tICIgKyBlbXBUYWJsZU5hbWUpLmV4ZWN1dGVVcGRhdGUo\nKTsKCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7\nCiAgICAgICAgfSBjYXRjaChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBl\nLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChlbSAhPSBudWxsICYmIGVtLmlzT3BlbigpKSB7CiAgICAg\nICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgTG9ja0VtcGxveWVlIG5ld0VtcGxveWVl\nKGludCBpZCkgewogICAgICAgIExvY2tFbXBsb3llZSBlID0gbmV3IExvY2tF\nbXBsb3llZSgpOwogICAgICAgIGUuc2V0SWQoaWQpOwogICAgICAgIHJldHVy\nbiBlOwogICAgfQoKICAgIHByb3RlY3RlZCBMb2cgZ2V0TG9nKCkgewogICAg\nICAgIHJldHVybiBlbWYuZ2V0Q29uZmlndXJhdGlvbigpLmdldExvZygiVGVz\ndHMiKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgTG9nIGdldER1bXBTdGFja0xv\nZygpIHsKICAgICAgICByZXR1cm4gZW1mLmdldENvbmZpZ3VyYXRpb24oKS5n\nZXRMb2coIkR1bXBTdGFjayIpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lk\nIGxvZ1N0YWNrKFRocm93YWJsZSB0KSB7CiAgICAgICAgU3RyaW5nV3JpdGVy\nIHN0ciA9IG5ldyBTdHJpbmdXcml0ZXIoKTsKICAgICAgICBQcmludFdyaXRl\nciBwcmludCA9IG5ldyBQcmludFdyaXRlcihzdHIpOwogICAgICAgIHQucHJp\nbnRTdGFja1RyYWNlKHByaW50KTsKICAgICAgICBnZXREdW1wU3RhY2tMb2co\nKS50cmFjZShzdHIudG9TdHJpbmcoKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIG5vdGlmeVBhcmVudCgpIHsKICAgICAgICBnZXRMb2coKS50cmFjZSgi\nbm90aWZ5UGFyZW50OiIpOwogICAgICAgIHN5bmNocm9uaXplZCAodGhpcykg\newogICAgICAgICAgICBub3RpZnkoKTsKICAgICAgICB9CiAgICB9CgogICAg\nLy8gTGlzdCBvZiBzdXBwb3J0IGFjdGlvbnMgYW5kIHBhcmFtZXRlciBkZWZp\nbml0aW9uLgogICAgcHJvdGVjdGVkIGVudW0gQWN0IHsKICAgICAgICAvLyBK\nUEEgZW50aXR5IG1hbmFnZXIgQVBJCiAgICAgICAgQ3JlYXRlRW0sICAgICAg\nICAgIC8vICgpCiAgICAgICAgQ2xvc2VFbSwgICAgICAgICAgIC8vICgpCiAg\nICAgICAgRmluZCwgICAgICAgICAgICAgIC8vIChbaW50IGlkXSkKICAgICAg\nICBGaW5kV2l0aExvY2ssICAgICAgLy8gKGludCBpZCwgTG9ja01vZGVUeXBl\nIGxvY2tUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAg\nIFtTdHJpbmcgcHJvcGVydGllcywgT2JqZWN0IHZhbHVlXSopCiAgICAgICAg\nRmluZE9iamVjdCwgICAgICAgIC8vIChPYmplY3Qgb2JqLCBMb2NrTW9kZVR5\ncGUgbG9ja1R5cGUpCiAgICAgICAgTmFtZWRRdWVyeVdpdGhMb2NrLC8vIChT\ndHJpbmcgbmFtZWRRdWVyeSwgaW50IGlkLCBMb2NrTW9kZVR5cGUgbG9ja1R5\ncGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgW1N0cmlu\nZyBwcm9wZXJ0aWVzLCBPYmplY3QgdmFsdWVdKikKICAgICAgICBSZWZyZXNo\nLCAgICAgICAgICAgLy8gKFtpbnQgaWRdKQogICAgICAgIFJlZnJlc2hXaXRo\nTG9jaywgICAvLyAoaW50IGlkLCBMb2NrTW9kZVR5cGUgbG9ja1R5cGUsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgW1N0cmluZyBwcm9w\nZXJ0aWVzLCBPYmplY3QgdmFsdWVdKikKICAgICAgICBSZWZyZXNoT2JqZWN0\nLCAgICAgLy8gKE9iamVjdCBvYmosIExvY2tNb2RlVHlwZSBsb2NrVHlwZSkK\nICAgICAgICBMb2NrLCAgICAgICAgICAgICAgLy8gKGludCBpZCwgTG9ja01v\nZGVUeXBlIGxvY2tUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAv\nLyAgICAgIFtTdHJpbmcgcHJvcGVydGllcywgT2JqZWN0IHZhbHVlXSopCiAg\nICAgICAgTG9ja09iamVjdCwgICAgICAgIC8vIChPYmplY3Qgb2JqLCBMb2Nr\nTW9kZVR5cGUgbG9ja1R5cGUpCiAgICAgICAgUGVyc2lzdCwgICAgICAgICAg\nIC8vIChpbnQgaWQsIFN0cmluZyBmaXJzdE5hbWUpCiAgICAgICAgQ2xlYXIs\nICAgICAgICAgICAgIC8vICgpCiAgICAgICAgRmx1c2gsICAgICAgICAgICAg\nIC8vICgpCiAgICAgICAgUmVtb3ZlLCAgICAgICAgICAgIC8vIChbaW50IGlk\nXSkKCiAgICAgICAgVXBkYXRlRW1wbG95ZWUsICAgIC8vIChbaW50IGlkWywg\nU3RyaW5nIG5ld0ZpcnN0TmFtZV1dKQoKICAgICAgICAvLyBPcGVuSlBBIGVu\ndGl0eSBtYW5hZ2VyIEFQSQogICAgICAgIERldGFjaCwgICAgICAgICAgICAv\nLyAoKTsKCiAgICAgICAgLy8gVHJhbnNhY3Rpb24gQVBJCiAgICAgICAgU3Rh\ncnRUeCwgICAgICAgICAgIC8vICgpCiAgICAgICAgQ29tbWl0VHgsICAgICAg\nICAgIC8vICgpCiAgICAgICAgUm9sbGJhY2tUeCwgICAgICAgIC8vICgpCgog\nICAgICAgIC8vIFRocmVhZCBtYW5hZ2VtZW50IGZ1bmN0aW9ucwogICAgICAg\nIE5ld1RocmVhZCwgICAgICAgICAvLyAoaW50IHRocmVhZCkKICAgICAgICBT\ndGFydFRocmVhZCwgICAgICAgLy8gKGludCB0aHJlYWQpCiAgICAgICAgTm90\naWZ5LCAgICAgICAgICAgIC8vIChpbnQgdGhyZWFkLCBbaW50IHNsZWVwVGlt\nZU1zKV0gKQogICAgICAgIFdhaXQsICAgICAgICAgICAgICAvLyAoaW50IHRo\ncmVhZCwgW2ludCBzbGVlcFRpbWVNcyldICkKCiAgICAgICAgV2FpdEFsbENo\naWxkcmVuLCAgIC8vICgpCiAgICAgICAgSm9pblBhcmVudCwgICAgICAgIC8v\nICgpCiAgICAgICAgWWllbGRUaHJlYWQsICAgICAgIC8vICgpCgogICAgICAg\nIC8vIFV0aWxpdHkgZnVuY3Rpb25zCiAgICAgICAgU2xlZXAsICAgICAgICAg\nICAgIC8vIChpbnQgc2xlZXBUaW1lTXMpCiAgICAgICAgSW5mbywgICAgICAg\nICAgICAgIC8vIChPYmplY3QgbXNnKQogICAgICAgIFRyYWNlLCAgICAgICAg\nICAgICAvLyAoT2JqZWN0IG1zZykKICAgICAgICBFcnJvciwgICAgICAgICAg\nICAgLy8gKE9iamVjdCBtc2cpCiAgICAgICAgV2FybiwgICAgICAgICAgICAg\nIC8vIChPYmplY3QgbXNnKQogICAgICAgIERldGFjaFNlcmlhbGl6ZSwgICAv\nLyAoaW50IGlkLCBpbnQgaWR4KQoKICAgICAgICAvLyBUZXN0IGFuZCBhc3Nl\ncnRpb24gZnVuY3Rpb25zCiAgICAgICAgVGVzdEV4Y2VwdGlvbiwgICAgIC8v\nIChpbnQgdGhyZWFkLCBbQ2xhc3MgZXhjZXB0aW9uc10qKQogICAgICAgIFJl\nc2V0RXhjZXB0aW9uLCAgICAvLyAoKQogICAgICAgIFRlc3RFbXBsb3llZSwg\nICAgICAvLyAoaW50IGlkLCBTdHJpbmcgRmlyc3ROYW1lLCBpbnQgdmVyc2lv\nbkluYykKICAgICAgICBFbXBsb3llZU5vdE51bGwsICAgLy8gKGludCBpZCkK\nICAgICAgICBTYXZlVmVyc2lvbiwgICAgICAgLy8gKFtpbnQgaWRdKQogICAg\nICAgIFRlc3RWZXJzaW9uLCAgICAgICAvLyAoaW50IGlkLCBpbnQgaW5jcmVt\nZW50KQogICAgICAgIFRlc3RMb2NrTW9kZSwgICAgICAvLyAoaW50IGlkLCBM\nb2NrTW9kZVR5cGUgbG9ja01vZGUpCgogICAgICAgIFRlc3QsICAgICAgICAg\nICAgICAvLyBPcGVuLWVuZGVkIHRlc3RpbmcgYWN0aW9ucwogICAgfTsKCiAg\nICBwdWJsaWMgdm9pZCBsYXVuY2hBY3Rpb25TZXF1ZW5jZShTdHJpbmcgdGVz\ndE5hbWUsIE9iamVjdCBwYXJhbWV0ZXJzLAogICAgICAgIE9iamVjdFtdW10u\nLi4gYWN0aW9ucykgewogICAgICAgIExvZyBsb2cgPSBnZXRMb2coKTsKICAg\nICAgICBsb2cudHJhY2UoIj09PT09PT09PT09PS8vLyAiICsgdGVzdE5hbWUg\nKyAiIC8vLz09PT09PT09PT09PSIpOwogICAgICAgIGlmIChwYXJhbWV0ZXJz\nICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHBhcmFtZXRlcnMgaW5zdGFu\nY2VvZiBTdHJpbmdbXSkgewogICAgICAgICAgICAgICAgZm9yIChTdHJpbmcg\ncGFyYW1ldGVyIDogKFN0cmluZ1tdKSBwYXJhbWV0ZXJzKSB7CiAgICAgICAg\nICAgICAgICAgICAgbG9nLnRyYWNlKCItLS0+ICIgKyBwYXJhbWV0ZXIpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFt\nZXRlcnMgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAgIGxv\nZy50cmFjZSgiLS0tPiAiICsgKFN0cmluZykgcGFyYW1ldGVycyk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEVudGl0eU1hbmFnZXIgZW0g\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVtID0gZW1mLmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBMb2NrRW1wbG95ZWUgZWkg\nPSBlbS5maW5kKExvY2tFbXBsb3llZS5jbGFzcywgMSk7CiAgICAgICAgICAg\nIGFzc2VydE5vdE51bGwoZWkpOwogICAgICAgICAgICBlaS5zZXRGaXJzdE5h\nbWUoRGVmYXVsdF9GaXJzdE5hbWUpOwogICAgICAgICAgICBlbS5nZXRUcmFu\nc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBleCkgewogICAgICAgICAgICBsb2dTdGFjayhleCk7CiAgICAgICAgICAg\nIFRocm93YWJsZSByb290Q2F1c2UgPSBleC5nZXRDYXVzZSgpOwogICAgICAg\nICAgICBTdHJpbmcgZmFpbFN0ciA9ICJVbmFibGUgdG8gcHJlLWluaXRpYWxp\nemUgRmlyc3ROYW1lIHRvIGtub3duICIKICAgICAgICAgICAgICAgICsgInZh\nbHVlOiIgKyBleC5nZXRDbGFzcygpLmdldE5hbWUoKSArICI6IiArIGV4Owog\nICAgICAgICAgICBpZiAocm9vdENhdXNlICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGZhaWxTdHIgKz0gIlxuICAgICAgICAtLSBDYXVzZSAtLT4gIgog\nICAgICAgICAgICAgICAgICAgICsgcm9vdENhdXNlLmdldENsYXNzKCkuZ2V0\nTmFtZSgpICsgIjoiICsgcm9vdENhdXNlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGZhaWwoZmFpbFN0cik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKGVtICE9IG51bGwgJiYgZW0uaXNPcGVuKCkpIHsKICAg\nICAgICAgICAgICAgIGlmIChlbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZl\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rp\nb24oKS5nZXRSb2xsYmFja09ubHkoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoImZpbmFsbHk6IHJvbGxlZGJhY2siKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFj\naygpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoImZpbmFs\nbHk6IHJvbGxlZGJhY2sgY29tcGxldGVkIik7CiAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNl\nKCJmaW5hbGx5OiBjb21taXQiKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKCJmaW5hbGx5OiBjb21taXQgY29tcGxldGVk\nIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBpbnQgbnVtVGhyZWFkcyA9IGFjdGlvbnMubGVuZ3Ro\nOwogICAgICAgIHRocmVhZHMgPSBuZXcgQXJyYXlMaXN0PFRlc3RUaHJlYWQ+\nKG51bVRocmVhZHMpOwogICAgICAgIFRlc3RUaHJlYWQgbWFpblRocmVhZCA9\nIG5ldyBUZXN0VGhyZWFkKDAsIGFjdGlvbnMpOwogICAgICAgIHRocmVhZHMu\nYWRkKG1haW5UaHJlYWQpOwogICAgICAgIGxhdW5jaENvbW1vblNlcXVlbmNl\nKG1haW5UaHJlYWQpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBsYXVuY2hD\nb21tb25TZXF1ZW5jZShUZXN0VGhyZWFkIHRoaXNUaHJlYWQgKSB7CiAgICAg\nICAgaW50IHRocmVhZFRvUnVuID0gdGhpc1RocmVhZC50aHJlYWRUb1J1bjsK\nICAgICAgICBPYmplY3RbXVtdW10gYWN0aW9ucyA9IHRoaXNUaHJlYWQuYWN0\naW9uczsKICAgICAgICBNYXA8SW50ZWdlcixMb2NrRW1wbG95ZWU+IGVtcGxv\neWVlcyA9IHRoaXNUaHJlYWQuZW1wbG95ZWVzOwoKICAgICAgICBhc3NlcnRO\nb3ROdWxsKCJUZXN0IHNlcXVlbmNlIHRhYmxlIG11c3QgYmUgZGVmaW5lZCIs\nIGFjdGlvbnMpOwogICAgICAgIGFzc2VydCAoYWN0aW9ucy5sZW5ndGggPj0g\nMSk7CgogICAgICAgIGludCBudW1UaHJlYWRzID0gYWN0aW9ucy5sZW5ndGg7\nCiAgICAgICAgaW50IHNhdmVWZXJzaW9uID0gLTE7CgogICAgICAgIExvZyBs\nb2cgPSBnZXRMb2coKTsKICAgICAgICBsb2cudHJhY2UoIj4+Pj4gU2VxdWVu\nY2VkIFRlc3Q6IFRocmVhZHM9IiArIHRocmVhZFRvUnVuICsgJy8nCiAgICAg\nICAgICAgICsgbnVtVGhyZWFkcyk7CiAgICAgICAgbG9uZyBlbmRUaW1lID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgKyB3YWl0SW5Nc2VjOwoKICAg\nICAgICBFbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsKICAgICAgICBJbnRlZ2Vy\nIGlkID0gMTsKICAgICAgICBMb2NrRW1wbG95ZWUgZW1wbG95ZWUgPSBudWxs\nOwogICAgICAgIExvY2tNb2RlVHlwZSBsb2NrTW9kZSA9IG51bGw7CiAgICAg\nICAgQWN0IGN1ckFjdGlvbiA9IG51bGw7CiAgICAgICAgT2JqZWN0W11bXSB0\naHJlYWRTZXF1ZW5jZSA9IGFjdGlvbnNbdGhyZWFkVG9SdW5dOwogICAgICAg\nIGZvciAoT2JqZWN0W10gYXJncyA6IHRocmVhZFNlcXVlbmNlKSB7CiAgICAg\nICAgICAgIGN1ckFjdGlvbiA9IChBY3QpIGFyZ3NbMF07CiAgICAgICAgICAg\nIGxvZy50cmFjZSgiKiogQWN0PSIgKyBBcnJheXMudG9TdHJpbmcoYXJncykp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3dpdGNoIChj\ndXJBY3Rpb24pIHsKICAgICAgICAgICAgICAgIGNhc2UgQ3JlYXRlRW06CiAg\nICAgICAgICAgICAgICAgICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdl\ncigpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBDbG9zZUVtOgogICAgICAgICAgICAgICAgICAgIGlmIChlbSAh\nPSBudWxsICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVtID0g\nbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIENsZWFyOgogICAgICAg\nICAgICAgICAgICAgIGVtLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZsdXNoOgogICAgICAgICAg\nICAgICAgICAgIGVtLmZsdXNoKCk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZpbmQ6CiAgICAgICAgICAgICAg\nICAgICAgaWQgPSAxOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxl\nbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSAoSW50\nZWdlcilhcmdzWzFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBlbXBsb3llZSA9IGVtLmZpbmQoTG9ja0VtcGxveWVlLmNs\nYXNzLCBpZCk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBs\nb3llZT0iICsgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGlmKCBl\nbXBsb3llZSAhPSBudWxsICkgewogICAgICAgICAgICAgICAgICAgICAgICBl\nbXBsb3llZXMucHV0KGlkLCBlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWVz\nLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGaW5kV2l0\naExvY2s6CiAgICAgICAgICAgICAgICAgICAgaWQgPSAxOwogICAgICAgICAg\nICAgICAgICAgIGlmIChhcmdzWzFdICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWQgPSAoSW50ZWdlcilhcmdzWzFdOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsb2NrTW9kZSA9IExv\nY2tNb2RlVHlwZS5OT05FOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdz\nWzJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9ja01v\nZGUgPSAoTG9ja01vZGVUeXBlKWFyZ3NbMl07CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4g\nZmluZFByb3BzID0gYnVpbGRQcm9wc01hcChhcmdzLCAzKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoZmluZFByb3BzICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgZW1wbG95ZWUgPSBlbS5maW5kKExvY2tFbXBsb3ll\nZS5jbGFzcywgaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2Nr\nTW9kZSwgZmluZFByb3BzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICBlbXBsb3llZSA9IGVtCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuZmluZChMb2NrRW1wbG95ZWUuY2xh\nc3MsIGlkLCBsb2NrTW9kZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiRW1wbG95ZWU9IiArIGVtcGxv\neWVlKTsKICAgICAgICAgICAgICAgICAgICBpZiggZW1wbG95ZWUgIT0gbnVs\nbCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWVzLnB1dChp\nZCwgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGVtcGxveWVlcy5yZW1vdmUoaWQpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgRmluZE9iamVjdDoKICAgICAgICAg\nICAgICAgICAgICBlbS5maW5kKChDbGFzczw/PilhcmdzWzFdLCBhcmdzWzJd\nLAogICAgICAgICAgICAgICAgICAgICAgICAoTG9ja01vZGVUeXBlKSBhcmdz\nWzNdKTsKICAgICAgICAgICAgICAgICAgICAvLyBsb2cudHJhY2UoIkVtcGxv\neWVlPSIgKyBlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIE5hbWVkUXVlcnlXaXRoTG9jazoKICAg\nICAgICAgICAgICAgICAgICBTdHJpbmcgbmFtZWRRdWVyeSA9ICI/Pz8/IjsK\nICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAxKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIG5hbWVkUXVlcnkgPSAoU3RyaW5nKWFy\nZ3NbMV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGlkID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5n\ndGggPiAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gKEludGVn\nZXIpYXJnc1syXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgbG9ja01vZGUgPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nIGlmIChhcmdzLmxlbmd0aCA+IDMpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgbG9ja01vZGUgPSAoTG9ja01vZGVUeXBlKWFyZ3NbM107CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIE1hcDxTdHJpbmcs\nIE9iamVjdD4gcXVlcnlQcm9wcyA9IGJ1aWxkUHJvcHNNYXAoYXJncywgNCk7\nCiAgICAgICAgICAgICAgICAgICAgLy9UeXBlZFF1ZXJ5PExvY2tFbXBsb3ll\nZT4gcSA9IGVtLmNyZWF0ZU5hbWVkUXVlcnkobmFtZWRRdWVyeSwgTG9ja0Vt\ncGxveWVlLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBRdWVyeSBxID0g\nZW0uY3JlYXRlTmFtZWRRdWVyeShuYW1lZFF1ZXJ5KTsKICAgICAgICAgICAg\nICAgICAgICBpZiggbG9ja01vZGUgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBxLnNldExvY2tNb2RlKGxvY2tNb2RlKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoIHF1ZXJ5UHJv\ncHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IoIFN0\ncmluZyBuYW1lIDogcXVlcnlQcm9wcy5rZXlTZXQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcS5zZXRIaW50KG5hbWUsIHF1ZXJ5UHJvcHMu\nZ2V0KG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBxLnNldFBhcmFt\nZXRlcigiaWQiLCBpZCk7CiAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWUg\nPSAoTG9ja0VtcGxveWVlKXEuZ2V0U2luZ2xlUmVzdWx0KCk7CiAgICAgICAg\nICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3llZT0iICsgZW1wbG95ZWUp\nOwogICAgICAgICAgICAgICAgICAgIGlmKCBlbXBsb3llZSAhPSBudWxsICkg\newogICAgICAgICAgICAgICAgICAgICAgICBlbXBsb3llZXMucHV0KGlkLCBl\nbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgZW1wbG95ZWVzLnJlbW92ZShpZCk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBQZXJzaXN0OgogICAgICAgICAgICAgICAg\nICAgIGlkID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1sxXSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gKEludGVn\nZXIpYXJnc1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgU3RyaW5nIGZpcnN0TmFtZSA9IChTdHJpbmcpYXJnc1syXTsK\nICAgICAgICAgICAgICAgICAgICBlbXBsb3llZSA9IG5ldyBMb2NrRW1wbG95\nZWUoKTsKICAgICAgICAgICAgICAgICAgICBlbXBsb3llZS5zZXRJZChpZCk7\nCiAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWUuc2V0Rmlyc3ROYW1lKGZp\ncnN0TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBs\nb3llZT0iICsgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGVtLnBl\ncnNpc3QoZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBSZW1vdmU6CiAgICAgICAgICAgICAgICAg\nICAgaWQgPSAxOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0\naCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSAoSW50ZWdl\ncilhcmdzWzFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBlbXBsb3llZSA9IGVtcGxveWVlcy5nZXQoaWQpOwogICAgICAg\nICAgICAgICAgICAgIGxvZy50cmFjZSgiRW1wbG95ZWU9IiArIGVtcGxveWVl\nKTsKICAgICAgICAgICAgICAgICAgICBlbS5yZW1vdmUoZW1wbG95ZWUpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBSZWZyZXNoOgogICAgICAgICAgICAgICAgICAgIGlkID0gMTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAxKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlkID0gKEludGVnZXIpYXJnc1sxXTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWUg\nPSBlbXBsb3llZXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAgICBsb2cu\ndHJhY2UoIkVtcGxveWVlKGJlZm9yZSk9IiArIGVtcGxveWVlKTsKICAgICAg\nICAgICAgICAgICAgICBlbS5yZWZyZXNoKGVtcGxveWVlKTsKICAgICAgICAg\nICAgICAgICAgICBsb2cudHJhY2UoIkVtcGxveWVlKGFmdGVyKSA9IiArIGVt\ncGxveWVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgUmVmcmVzaFdpdGhMb2NrOgogICAgICAgICAgICAgICAg\nICAgIGlkID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1sxXSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gKEludGVn\nZXIpYXJnc1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgbG9ja01vZGUgPSBMb2NrTW9kZVR5cGUuTk9ORTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoYXJnc1syXSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGxvY2tNb2RlID0gKExvY2tNb2RlVHlwZSlhcmdz\nWzJdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBlbXBsb3llZSA9IGVtcGxveWVlcy5nZXQoaWQpOwogICAgICAgICAgICAg\nICAgICAgIGxvZy50cmFjZSgiRW1wbG95ZWUoYmVmb3JlKT0iICsgZW1wbG95\nZWUpOwogICAgICAgICAgICAgICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4g\ncmVmcmVzaFByb3BzID0gYnVpbGRQcm9wc01hcChhcmdzLAogICAgICAgICAg\nICAgICAgICAgICAgICAzKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVm\ncmVzaFByb3BzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nZW0ucmVmcmVzaChlbXBsb3llZSwgbG9ja01vZGUsIHJlZnJlc2hQcm9wcyk7\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgZW0ucmVmcmVzaChlbXBsb3llZSwgbG9ja01vZGUpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsb2cudHJh\nY2UoIkVtcGxveWVlKGFmdGVyKSA9IiArIGVtcGxveWVlKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUmVmcmVz\naE9iamVjdDoKICAgICAgICAgICAgICAgICAgICBlbS5yZWZyZXNoKGFyZ3Nb\nMV0sIChMb2NrTW9kZVR5cGUpIGFyZ3NbMl0pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMb2NrOgogICAgICAg\nICAgICAgICAgICAgIGlkID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nYXJnc1sxXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlk\nID0gKEludGVnZXIpYXJnc1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgbG9ja01vZGUgPSBMb2NrTW9kZVR5cGUuTk9O\nRTsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1syXSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2tNb2RlID0gKExvY2tNb2Rl\nVHlwZSlhcmdzWzJdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBlbXBsb3llZSA9IGVtcGxveWVlcy5nZXQoaWQpOwogICAg\nICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiRW1wbG95ZWU9IiArIGVtcGxv\neWVlKTsKICAgICAgICAgICAgICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+\nIGxvY2tQcm9wcyA9IGJ1aWxkUHJvcHNNYXAoYXJncywgMyk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGxvY2tQcm9wcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGVtLmxvY2soZW1wbG95ZWUsIGxvY2tNb2RlLCBs\nb2NrUHJvcHMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGVtLmxvY2soZW1wbG95ZWUsIGxvY2tNb2Rl\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIExvY2tPYmplY3Q6CiAgICAg\nICAgICAgICAgICAgICAgZW0ubG9jayhhcmdzWzFdLCAoTG9ja01vZGVUeXBl\nKSBhcmdzWzJdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgVXBkYXRlRW1wbG95ZWU6CiAgICAgICAgICAgICAg\nICAgICAgaWQgPSAxOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxl\nbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSAoSW50\nZWdlcikgYXJnc1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgZW1wbG95ZWUgPSBlbXBsb3llZXMuZ2V0KGlkKTsKICAg\nICAgICAgICAgICAgICAgICBsb2cudHJhY2UoIkVtcGxveWVlIChiZWZvcmUp\nOiIgKyBlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIG5l\nd0ZpcnN0TmFtZSA9ICJVbmtub3duIjsKICAgICAgICAgICAgICAgICAgICBp\nZiAoYXJncy5sZW5ndGggPiAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIG5ld0ZpcnN0TmFtZSA9IChTdHJpbmcpIGFyZ3NbMl07CiAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nRmlyc3ROYW1lID0gKG5ldyBEYXRlKCkpLnRvU3RyaW5nKCk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlLnNl\ndEZpcnN0TmFtZShuZXdGaXJzdE5hbWUpOwogICAgICAgICAgICAgICAgICAg\nIGxvZy50cmFjZSgiRW1wbG95ZWUgKGFmdGVyKSA6IiArIGVtcGxveWVlKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBj\nYXNlIERldGFjaDoKICAgICAgICAgICAgICAgICAgICBpZCA9IDE7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGFyZ3NbMV0gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZCA9IChJbnRlZ2VyKWFyZ3NbMV07CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVtcGxveWVl\nID0gZW1wbG95ZWVzLmdldChpZCk7CiAgICAgICAgICAgICAgICAgICAgbG9n\nLnRyYWNlKCJFbXBsb3llZSAoYmVmb3JlKSA6IiArIGVtcGxveWVlKTsKICAg\nICAgICAgICAgICAgICAgICBMb2NrRW1wbG95ZWUgZGV0RW1wbG95ZWUgPSAo\nKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBlbQogICAgICAgICAgICAgICAgICAg\nICAgICAuZ2V0RGVsZWdhdGUoKSkuZGV0YWNoQ29weShlbXBsb3llZSk7CiAg\nICAgICAgICAgICAgICAgICAgZW1wbG95ZWVzLnB1dCgoSW50ZWdlcilhcmdz\nWzJdLCBkZXRFbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKCJFbXBsb3llZSAoYWZ0ZXIpICA6IiArIGRldEVtcGxveWVlKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNl\nIFN0YXJ0VHg6CiAgICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rp\nb24oKS5iZWdpbigpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBDb21taXRUeDoKICAgICAgICAgICAgICAgICAg\nICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBSb2xsYmFja1R4\nOgogICAgICAgICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9s\nbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAg\nICAgICAgICBjYXNlIE5ld1RocmVhZDoKICAgICAgICAgICAgICAgICAgICBp\nbnQgY2hpbGRUb1J1biA9IChJbnRlZ2VyKSBhcmdzWzFdOwogICAgICAgICAg\nICAgICAgICAgIFRlc3RUaHJlYWQgdDEgPSBuZXcgVGVzdFRocmVhZChjaGls\nZFRvUnVuLCBhY3Rpb25zKTsKICAgICAgICAgICAgICAgICAgICB0aHJlYWRz\nLmFkZCh0MSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFN0YXJ0VGhyZWFkOgogICAgICAgICAgICAgICAgICAg\nIHRocmVhZHMuZ2V0KChJbnRlZ2VyKSBhcmdzWzFdKS5zdGFydCgpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBO\nb3RpZnk6CiAgICAgICAgICAgICAgICAJLy8gc2xlZXAgYW5kIGxldCBvdGhl\nciB0aHJlYWRzIGhhcyBhIGNoYW5jZSB0byB3YWl0LAogICAgICAgICAgICAg\nICAgCS8vIG90aGVyd2lzZSB0aGlzIG5vdGlmeSBtYXkgdHJpZ2dlciBiZWZv\ncmUgdGhlIG90aGVyIAogICAgICAgICAgICAgICAgCS8vIHRocmVhZCBoYXMg\nYSBjaGFuY2UgdG8gd2FpdC4KICAgICAgICAgICAgICAgIAlUaHJlYWQuc2xl\nZXAoNTAwKTsKICAgICAgICAgICAgICAgICAgICBpbnQgbm90aWZ5VGhyZWFk\naWQgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+\nIDEgJiYgYXJnc1sxXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIG5vdGlmeVRocmVhZGlkID0gKEludGVnZXIpIGFyZ3NbMV07CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChhcmdz\nLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFk\nLnNsZWVwKChJbnRlZ2VyKSBhcmdzWzJdKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgaWYoIG5vdGlmeVRocmVhZGlkID09\nIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5UGFyZW50KCk7\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyZWFkcy5nZXQobm90aWZ5VGhyZWFkaWQpLm5vdGlmeVRo\ncmVhZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgV2FpdDoKICAgICAg\nICAgICAgICAgICAgICBpbnQgd2FpdFRocmVhZGlkID0gdGhyZWFkVG9SdW47\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSAmJiBh\ncmdzWzFdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2Fp\ndFRocmVhZGlkID0gKEludGVnZXIpIGFyZ3NbMV07CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGludCB3YWl0VGltZSA9IChp\nbnQpKHdhaXRJbk1zZWMgLyA1KTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nYXJncy5sZW5ndGggPiAyICYmIGFyZ3NbMl0gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICB3YWl0VGltZSA9IChJbnRlZ2VyKSBhcmdzWzJd\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBp\nZiAod2FpdFRpbWUgPCBNaW5UaHJlYWRXYWl0SW5NcyAvIDIpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHdhaXRUaW1lID0gTWluVGhyZWFkV2FpdEluTXMg\nLyAyOwogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiPj4gU3RhcnRl\nZCB3YWl0IGZvciAiICsgd2FpdFRpbWUgKyAiIG1zIik7CiAgICAgICAgICAg\nICAgICAgICAgaWYoIHdhaXRUaHJlYWRpZCAhPSAwKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHRoaXNUaHJlYWQud2FpdCh3YWl0VGltZSk7CiAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB3YWl0KHdhaXRUaW1lKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBsb2cudHJhY2UoIjw8IEVuZGVkIHdhaXQiKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIEVtcGxveWVlTm90\nTnVsbDoKICAgICAgICAgICAgICAgICAgICBpZCA9IDE7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGFyZ3NbMV0gIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpZCA9IChJbnRlZ2VyKWFyZ3NbMV07CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gZW1w\nbG95ZWVzLmdldChpZCk7CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Tm90\nTnVsbChlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFRlc3RFbXBsb3llZToKICAgICAgICAgICAg\nICAgICAgICBpZCA9IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3Nb\nMV0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZCA9IChJ\nbnRlZ2VyKWFyZ3NbMV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGVtcGxveWVlID0gZW1wbG95ZWVzLmdldChpZCk7CiAg\nICAgICAgICAgICAgICAgICAgc3dpdGNoIChhcmdzLmxlbmd0aCkgewogICAg\nICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGFyZ3NbM10gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKCIiLCBzYXZlVmVyc2lvbgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgKEludGVnZXIpIGFyZ3NbM10s\nIGVtcGxveWVlLmdldFZlcnNpb24oKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChhcmdzWzJdICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscygiIiwgKFN0cmluZykg\nYXJnc1syXSwgZW1wbG95ZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAuZ2V0Rmlyc3ROYW1lKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoYXJnc1sxXSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoIiIsIGlkLmludFZhbHVl\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWUu\nZ2V0SWQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2Fz\nZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnROdWxsKGVtcGxv\neWVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNhdmVWZXJzaW9uOgog\nICAgICAgICAgICAgICAgICAgIGlkID0gMTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoYXJncy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlkID0gKEludGVnZXIpIGFyZ3NbMV07CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gZW1wbG95ZWVz\nLmdldChpZCk7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVZlcnNpb24gPSBl\nbXBsb3llZS5nZXRWZXJzaW9uKCk7CiAgICAgICAgICAgICAgICAgICAgbG9n\nLnRyYWNlKCJzYXZlIHZlcnNpb249ICIgKyBzYXZlVmVyc2lvbik7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRl\nc3RWZXJzaW9uOgogICAgICAgICAgICAgICAgICAgIGlkID0gMTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoYXJnc1sxXSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlkID0gKEludGVnZXIpIGFyZ3NbMV07CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGludCBpbmNy\nZW1lbnQgPSAoSW50ZWdlcilhcmdzWzJdOwogICAgICAgICAgICAgICAgICAg\nIGVtcGxveWVlID0gZW1wbG95ZWVzLmdldChpZCk7CiAgICAgICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKCJ0ZXN0IHZlcnNpb246IGV4cGVjdGVkPSIKICAg\nICAgICAgICAgICAgICAgICAgICAgKyAoc2F2ZVZlcnNpb24gKyBpbmNyZW1l\nbnQpICsgIiwgdGVzdGluZz0iCiAgICAgICAgICAgICAgICAgICAgICAgICsg\nZW1wbG95ZWUuZ2V0VmVyc2lvbigpKTsKCiAgICAgICAgICAgICAgICAgICAg\nYXNzZXJ0RXF1YWxzKCIiLCBzYXZlVmVyc2lvbiArIGluY3JlbWVudCwgZW1w\nbG95ZWUKICAgICAgICAgICAgICAgICAgICAgICAgLmdldFZlcnNpb24oKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFRlc3RMb2NrTW9kZToKICAgICAgICAgICAgICAgICAgICBpZCA9IDE7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3NbMV0gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZCA9IChJbnRlZ2VyKSBhcmdzWzFd\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBl\nbXBsb3llZSA9IGVtcGxveWVlcy5nZXQoaWQpOwogICAgICAgICAgICAgICAg\nICAgIExvY2tNb2RlVHlwZSBleHBlY3RlZGxvY2tNb2RlID0gKExvY2tNb2Rl\nVHlwZSlhcmdzWzJdOwogICAgICAgICAgICAgICAgICAgIExvY2tNb2RlVHlw\nZSB0ZXN0aW5nbG9ja01vZGUgPSBlbS5nZXRMb2NrTW9kZShlbXBsb3llZSk7\nCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJ0ZXN0IHZlcnNpb246\nIGV4cGVjdGVkPSIgKyBleHBlY3RlZGxvY2tNb2RlCiAgICAgICAgICAgICAg\nICAgICAgICAgICsgIiwgdGVzdGluZz0iICsgdGVzdGluZ2xvY2tNb2RlKTsK\nCiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCIiLCBnZXRDYW5v\nbmljYWwoZXhwZWN0ZWRsb2NrTW9kZSksCiAgICAgICAgICAgICAgICAgICAg\nICAgIGdldENhbm9uaWNhbCh0ZXN0aW5nbG9ja01vZGUpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUmVzZXRF\neGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgdGhpc1RocmVhZC50aHJv\nd2FibGUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBUZXN0RXhjZXB0aW9uOgogICAgICAgICAgICAg\nICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGV4cGVjdGVkRXhjZXB0aW9ucyA9IG51\nbGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMikg\newogICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZEV4Y2VwdGlvbnMg\nPSBuZXcgQXJyYXlMaXN0PENsYXNzPD8+PigpOwogICAgICAgICAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMjsgaSA8IGFyZ3MubGVuZ3RoOyArK2kp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzW2ldIGlu\nc3RhbmNlb2YgT2JqZWN0W10pIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmb3IgKE9iamVjdCBvIDogKE9iamVjdFtdKSBhcmdzW2ldKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvICE9\nIG51bGwgJiYgbyBpbnN0YW5jZW9mIENsYXNzKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZEV4Y2VwdGlvbnMK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nYWRkKChDbGFzczw/Pikgbyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzW2ldICE9IG51bGwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgYXJnc1tp\nXSBpbnN0YW5jZW9mIENsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGV4cGVjdGVkRXhjZXB0aW9ucwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZCgoQ2xhc3M8Pz4pIGFy\nZ3NbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBTdHJpbmcgdGVzdEV4Q2xhc3MgPSBudWxsOwogICAgICAgICAgICAg\nICAgICAgIFRocm93YWJsZSBjdXJUaHJvd2FibGUgPSBudWxsOwogICAgICAg\nICAgICAgICAgICAgIGludCB0aHJlYWRJZCA9IHRocmVhZFRvUnVuOwogICAg\nICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyZWFkSWQgPSAoSW50ZWdlcikgYXJnc1sx\nXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nVGVzdFRocmVhZCBleFRocmVhZCA9IHRocmVhZHMuZ2V0KHRocmVhZElkKTsK\nICAgICAgICAgICAgICAgICAgICBjdXJUaHJvd2FibGUgPSBleFRocmVhZC50\naHJvd2FibGU7CiAgICAgICAgICAgICAgICAgICAgdGVzdEV4Q2xhc3MgPSBw\ncm9jZXNzRXhjZXB0aW9uKGN1ckFjdGlvbiwgY3VyVGhyb3dhYmxlKTsKCiAg\nICAgICAgICAgICAgICAgICAgYm9vbGVhbiBleE1hdGNoZWQgPSBmYWxzZTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWRFeGNlcHRpb25zICE9\nIG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgJiYgZXhwZWN0ZWRFeGNl\ncHRpb25zLnNpemUoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nZm9yIChDbGFzczw/PiBleHBlY3RlZEV4Y2VwdGlvbiA6CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBleHBlY3RlZEV4Y2VwdGlvbnMpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaEV4cGVjdGVkRXhjZXB0\naW9uKGV4cGVjdGVkRXhjZXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGN1clRocm93YWJsZSkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBleE1hdGNoZWQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGN1clRocm93YWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBleE1hdGNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGlmICghZXhNYXRjaGVkKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZy50cmFjZSh0ZXN0RXhDbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChjdXJUaHJvd2FibGUgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbG9nU3RhY2soY3VyVGhyb3dhYmxlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJFeHBlY3Rpbmc9IiAr\nIGV4cGVjdGVkRXhjZXB0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAr\nICIsIFRlc3Rpbmc9IiArIHRlc3RFeENsYXNzLCBleE1hdGNoZWQpOwogICAg\nICAgICAgICAgICAgICAgIGV4VGhyZWFkLnRocm93YWJsZSA9IG51bGw7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2Fz\nZSBXYWl0QWxsQ2hpbGRyZW46CiAgICAgICAgICAgICAgICAgICAgLy8gd2Fp\ndCBmb3IgdGhyZWFkcyB0byBkaWUgb3IgdGltZW91dAogICAgICAgICAgICAg\nICAgICAgIGxvZy50cmFjZSgiY2hlY2tpbmcgaWYgdGhyZWFkIGlzIGFsaXZl\nIGZvciAiICsKICAgICAgICAgICAgICAgICAgICAgICAgKGVuZFRpbWUtU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpICsgIm1zLiIpOwogICAgICAgICAg\nICAgICAgICAgIGludCBkZWFkVGhyZWFkcyA9IDA7CiAgICAgICAgICAgICAg\nICAgICAgTGlzdDxUZXN0VGhyZWFkPiBwcm9jZWVkVGhyZWFkID0KICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IEFycmF5TGlzdDxUZXN0VGhyZWFkPih0\naHJlYWRzKTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAocHJvY2VlZFRo\ncmVhZC5zaXplKCkgPiAwCiAgICAgICAgICAgICAgICAgICAgICAgICYmIFN5\nc3RlbS5jdXJyZW50VGltZU1pbGxpcygpIDwgZW5kVGltZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBmb3IgKFRlc3RUaHJlYWQgdGhyZWFkIDogcHJv\nY2VlZFRocmVhZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHRocmVhZC5pc0FsaXZlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsb2cudHJhY2UodGhyZWFkICsgIiBpcyBzdGlsbCBhbGl2ZSwg\nd2FpdCIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi\nIGZvciA1MDBtcyBhbmQgdHJ5IGFnYWluLiIpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIFRocmVhZC5zbGVlcCg1MDApOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0\naW9uIGUxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgid2Fp\ndGluZyBjaGlsZHJlbiB0aHJlYWQgKCIKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKyAoZW5kVGltZSAtIFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiIG1zIGxlZnQpIik7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRl\nYWRUaHJlYWRzKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYodGhyZWFkLmFzc2VydEVycm9yICE9IG51bGwpewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aHJlYWQuYXNzZXJ0RXJy\nb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZWRUaHJlYWQucmVtb3Zl\nKHRocmVhZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHByb2NlZWRUaHJlYWQuc2l6ZSgpID4gMCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UocHJvY2VlZFRocmVh\nZC5zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiB0aHJl\nYWRzIHN0aWxsIGFsaXZlLiIpOwogICAgICAgICAgICAgICAgICAgICAgICBm\nb3IgKFRlc3RUaHJlYWQgdGhyZWFkIDogcHJvY2VlZFRocmVhZCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJTZW5kIGludGVy\ncnVwdCB0byB0aHJlYWQgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgdGhyZWFkLnRocmVhZFRvUnVuKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHRocmVhZC5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSm9pblBhcmVu\ndDoKICAgICAgICAgICAgICAgICAgICBmb3IgKFRocmVhZCB0aHJlYWQgOiB0\naHJlYWRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW4gYWxp\ndmUgPSB0aHJlYWQuaXNBbGl2ZSgpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoYWxpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxv\nZy50cmFjZSh0aHJlYWQuZ2V0TmFtZSgpICsgIiBpcyBzdGlsbCBhbGl2ZSIp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB0aHJlYWQuaW50ZXJydXB0KCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyZWFkLmpvaW4oKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nU3Rh\nY2soZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFlp\nZWxkVGhyZWFkOgogICAgICAgICAgICAgICAgICAgIFRocmVhZC55aWVsZCgp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAg\nIGNhc2UgU2xlZXA6CiAgICAgICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVw\nKChJbnRlZ2VyKSBhcmdzWzFdKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgRGV0YWNoU2VyaWFsaXplOgogICAg\nICAgICAgICAgICAgICAgIGlkID0gMTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoYXJnc1sxXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlkID0gKEludGVnZXIpIGFyZ3NbMV07CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gZW1wbG95ZWVzLmdl\ndChpZCk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3ll\nZSAoYmVmb3JlKT0iICsgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAg\nIEJ5dGVBcnJheU91dHB1dFN0cmVhbSBiYW9zID0KICAgICAgICAgICAgICAg\nICAgICAgICAgbmV3IEJ5dGVBcnJheU91dHB1dFN0cmVhbSgpOwogICAgICAg\nICAgICAgICAgICAgIE9iamVjdE91dHB1dFN0cmVhbSBvb3MgPSBuZXcgT2Jq\nZWN0T3V0cHV0U3RyZWFtKGJhb3MpOwogICAgICAgICAgICAgICAgICAgIGVt\ncGxveWVlLndyaXRlRXh0ZXJuYWwob29zKTsKICAgICAgICAgICAgICAgICAg\nICBvb3MuZmx1c2goKTsgYmFvcy5mbHVzaCgpOwogICAgICAgICAgICAgICAg\nICAgIEJ5dGVBcnJheUlucHV0U3RyZWFtIGJhaXMgPSBuZXcgQnl0ZUFycmF5\nSW5wdXRTdHJlYW0oCiAgICAgICAgICAgICAgICAgICAgICAgIGJhb3MudG9C\neXRlQXJyYXkoKSk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0SW5wdXRT\ndHJlYW0gb2lzID0gbmV3IE9iamVjdElucHV0U3RyZWFtKGJhaXMpOwogICAg\nICAgICAgICAgICAgICAgIExvY2tFbXBsb3llZSB0cmFuc2Zvcm1lZEVtcGxv\neWVlID0gbmV3IExvY2tFbXBsb3llZSgpOwogICAgICAgICAgICAgICAgICAg\nIHRyYW5zZm9ybWVkRW1wbG95ZWUucmVhZEV4dGVybmFsKG9pcyk7CiAgICAg\nICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3llZSAoYWZ0ZXIpID0i\nICsgdHJhbnNmb3JtZWRFbXBsb3llZSk7CgogICAgICAgICAgICAgICAgICAg\nIGVtcGxveWVlcy5wdXQoKEludGVnZXIpYXJnc1syXSx0cmFuc2Zvcm1lZEVt\ncGxveWVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSW5mbzoKICAgICAgICAgICAgICAgICAgICBsb2cuaW5m\nbyhhcmdzWzFdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgV2FybjoKICAgICAgICAgICAgICAgICAgICBsb2cu\nd2FybihhcmdzWzFdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRXJyb3I6CiAgICAgICAgICAgICAgICAgICAg\nbG9nLmVycm9yKGFyZ3NbMV0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBUcmFjZToKICAgICAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoYXJnc1sxXSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBUZXN0OgogICAgICAgICAg\nICAgICAgICAgIGVtLmxvY2soInh4eCIsIExvY2tNb2RlVHlwZS5XUklURSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgICAgIC8vIG9ubHkgcmVt\nZW1iZXIgdGhlIGZpcnN0IGV4Y2VwdGlvbiBjYXVnaHQKICAgICAgICAgICAg\nICAgIGlmICh0aGlzVGhyZWFkLnRocm93YWJsZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgdGhpc1RocmVhZC50aHJvd2FibGUgPSBleDsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiQ2F1\nZ2h0IGV4Y2VwdGlvbiBhbmQgY29udGludWU6ICIgKyBleCk7CiAgICAgICAg\nICAgICAgICBsb2dTdGFjayhleCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEVy\ncm9yIGVycikgewogICAgICAgICAgICAgICAgLy8gb25seSByZW1lbWJlciB0\naGUgZmlyc3QgZXhjZXB0aW9uIGNhdWdodAogICAgICAgICAgICAgICAgaWYg\nKHRoaXNUaHJlYWQuYXNzZXJ0RXJyb3IgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIHRoaXNUaHJlYWQuYXNzZXJ0RXJyb3IgPSBlcnI7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cudHJhY2UoIkNhdWdo\ndCBleGNlcHRpb24gYW5kIGNvbnRpbnVlOiAiICsgZXJyKTsKICAgICAgICAg\nICAgICAgIGxvZ1N0YWNrKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgaWYgKGVtICE9IG51bGwgJiYgZW0uaXNPcGVuKCkpIHsKICAg\nICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkg\newogICAgICAgICAgICAgICAgaWYgKHRoaXNUaHJlYWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIHRoaXNUaHJlYWQuc3lzdGVtUm9sbGVkYmFj\nayA9IGVtLmdldFRyYW5zYWN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAg\nICAgLmdldFJvbGxiYWNrT25seSgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChlbS5nZXRU\ncmFuc2FjdGlvbigpLmdldFJvbGxiYWNrT25seSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKCJmaW5hbGx5OiByb2xsZWRiYWNrIik7CiAg\nICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFj\naygpOwogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiZmluYWxseTog\ncm9sbGVkYmFjayBjb21wbGV0ZWQiKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJmaW5hbGx5OiBj\nb21taXQiKTsKICAgICAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgi\nZmluYWxseTogY29tbWl0IGNvbXBsZXRlZCIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfSBjYXRjaChFeGNlcHRpb24gZmluYWxFeCkg\newogICAgICAgICAgICAgICAgICAgIFN0cmluZyBmYWlsU3RyID0gcHJvY2Vz\nc0V4Y2VwdGlvbihjdXJBY3Rpb24sIGZpbmFsRXgpOwogICAgICAgICAgICAg\nICAgICAgIGxvZy50cmFjZSgiRmluY2FsbHk6IiArIGZhaWxTdHIpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVtLmNs\nb3NlKCk7CiAgICAgICAgICAgIGlmICh0aGlzVGhyZWFkLmFzc2VydEVycm9y\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRocm93IHRoaXNUaHJlYWQu\nYXNzZXJ0RXJyb3I7CiAgICAgICAgICAgIH0KLy8gICAgICAgICAgICBUaHJv\nd2FibGUgZmlyc3RUaHJvd2FibGUgPSB0aGlzVGhyZWFkLnRocm93YWJsZTsg\nICAgICAgICAgICAKLy8gICAgICAgICAgICBpZiAoZmlyc3RUaHJvd2FibGUg\nIT0gbnVsbCkgewovLyAgICAgICAgICAgICAgICBpZiggZmlyc3RUaHJvd2Fi\nbGUgaW5zdGFuY2VvZiBFcnJvciApCi8vICAgICAgICAgICAgICAgICAgICB0\naHJvdyAoRXJyb3IpZmlyc3RUaHJvd2FibGU7Ci8vICAgICAgICAgICAgfQog\nICAgICAgICAgICBsb2cudHJhY2UoIjw8PDwgU2VxdWVuY2VkIFRlc3Q6IFRo\ncmVhZHM9IiArIHRocmVhZFRvUnVuICsgJy8nCiAgICAgICAgICAgICAgICAr\nIG51bVRocmVhZHMpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIExv\nY2tNb2RlVHlwZSBnZXRDYW5vbmljYWwoTG9ja01vZGVUeXBlIGxvY2tNb2Rl\nKSB7CiAgICAgICAgaWYoIGxvY2tNb2RlID09IExvY2tNb2RlVHlwZS5SRUFE\nICkKICAgICAgICAgICAgcmV0dXJuIExvY2tNb2RlVHlwZS5PUFRJTUlTVElD\nOwogICAgICAgIGlmKCBsb2NrTW9kZSA9PSBMb2NrTW9kZVR5cGUuV1JJVEUg\nKQogICAgICAgICAgICByZXR1cm4gTG9ja01vZGVUeXBlLk9QVElNSVNUSUNf\nRk9SQ0VfSU5DUkVNRU5UOwogICAgICAgIHJldHVybiBsb2NrTW9kZTsKICAg\nIH0KCiAgICBwcml2YXRlIFN0cmluZyBwcm9jZXNzRXhjZXB0aW9uKEFjdCBj\ndXJBY3Rpb24sIFRocm93YWJsZSB0KSB7CiAgICAgICAgU3RyaW5nIGZhaWxT\ndHIgPSAiQ2F1Z2h0IGV4Y2VwdGlvbjogbm9uZSI7CiAgICAgICAgaWYgKHQg\nIT0gbnVsbCkgewogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgKICAgICAg\nICAgICAgICAgICJDYXVnaHQgZXhjZXB0aW9uOiAiICsgdC5nZXRDbGFzcygp\nLmdldE5hbWUoKSArICI6IiArIHQpOwogICAgICAgICAgICBsb2dTdGFjayh0\nKTsKICAgICAgICAgICAgVGhyb3dhYmxlIHJvb3RDYXVzZSA9IHQuZ2V0Q2F1\nc2UoKTsKICAgICAgICAgICAgZmFpbFN0ciA9ICJGYWlsZWQgb24gYWN0aW9u\nICciICsgY3VyQWN0aW9uICsgIicgd2l0aCBleGNlcHRpb24gIgogICAgICAg\nICAgICAgICAgKyB0OwogICAgICAgICAgICBpZiAocm9vdENhdXNlICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGZhaWxTdHIgKz0gIlxuICAgICAgICAt\nLSBDYXVzZSAtLT4gIgogICAgICAgICAgICAgICAgICAgICsgcm9vdENhdXNl\nLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsgcm9vdENhdXNlOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWlsU3RyOwog\nICAgfQoKICAgIHByaXZhdGUgTWFwPFN0cmluZywgT2JqZWN0PiBidWlsZFBy\nb3BzTWFwKE9iamVjdFtdIGFyZ3MsIGludCBzdGFydElkeCkgewogICAgICAg\nIE1hcDxTdHJpbmcsIE9iamVjdD4gcHJvcHMgPSBudWxsOwogICAgICAgIGlm\nIChhcmdzLmxlbmd0aCA+IHN0YXJ0SWR4KSB7CiAgICAgICAgICAgIHByb3Bz\nID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBPYmplY3Q+KCk7CiAgICAgICAgICAg\nIHdoaWxlIChzdGFydElkeCA8IChhcmdzLmxlbmd0aCAtIDEpKSB7CiAgICAg\nICAgICAgICAgICBwcm9wcy5wdXQoKFN0cmluZykgYXJnc1tzdGFydElkeF0s\nIGFyZ3Nbc3RhcnRJZHggKyAxXSk7CiAgICAgICAgICAgICAgICBzdGFydElk\neCArPSAyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGdldExv\nZygpLnRyYWNlKCJQcm9wZXJ0aWVzIE1hcD0gIiArIHByb3BzKTsKICAgICAg\nICByZXR1cm4gcHJvcHM7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIG1h\ndGNoRXhwZWN0ZWRFeGNlcHRpb24oQ2xhc3M8Pz4gZXhwZWN0ZWQsCiAgICAg\nICAgVGhyb3dhYmxlIHRlc3RlZCkgewogICAgICAgIGFzc2VydE5vdE51bGwo\nZXhwZWN0ZWQpOwogICAgICAgIENsYXNzPD8+IHRlc3RFeENsYXNzID0gbnVs\nbDsKICAgICAgICBib29sZWFuIGV4TWF0Y2hlZCA9IHRydWU7CiAgICAgICAg\naWYgKHRlc3RlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHRlc3RFeENsYXNz\nID0gdGVzdGVkLmdldENsYXNzKCk7CiAgICAgICAgICAgIGV4TWF0Y2hlZCA9\nIGV4cGVjdGVkLmlzQXNzaWduYWJsZUZyb20odGVzdEV4Q2xhc3MpOwogICAg\nICAgICAgICBpZiAoIWV4TWF0Y2hlZCkgewogICAgICAgICAgICAgICAgVGhy\nb3dhYmxlIHRlc3RFeCA9IHRlc3RlZC5nZXRDYXVzZSgpOwogICAgICAgICAg\nICAgICAgaWYgKHRlc3RFeCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgdGVzdEV4Q2xhc3MgPSB0ZXN0RXguZ2V0Q2xhc3MoKTsKICAgICAgICAg\nICAgICAgICAgICBleE1hdGNoZWQgPSBleHBlY3RlZC5pc0Fzc2lnbmFibGVG\ncm9tKHRlc3RFeENsYXNzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4TWF0Y2hlZCA9\nIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhNYXRjaGVkOwog\nICAgfQoKICAgIHByaXZhdGUgY2xhc3MgVGVzdFRocmVhZCBleHRlbmRzIFRo\ncmVhZCB7CiAgICAgICAgcHJpdmF0ZSBpbnQgdGhyZWFkVG9SdW47CiAgICAg\nICAgcHJpdmF0ZSBPYmplY3RbXVtdW10gYWN0aW9uczsKICAgICAgICBwcml2\nYXRlIE1hcDxJbnRlZ2VyLCBMb2NrRW1wbG95ZWU+IGVtcGxveWVlcyA9IG51\nbGw7CgogICAgICAgIHB1YmxpYyBUaHJvd2FibGUgdGhyb3dhYmxlID0gbnVs\nbDsKICAgICAgICBwdWJsaWMgRXJyb3IgYXNzZXJ0RXJyb3IgPSBudWxsOwog\nICAgICAgIHB1YmxpYyBib29sZWFuIHN5c3RlbVJvbGxlZGJhY2sgPSBmYWxz\nZTsKCiAgICAgICAgcHVibGljIFRlc3RUaHJlYWQoaW50IHRocmVhZFRvUnVu\nLCBPYmplY3RbXVtdLi4uIGFjdGlvbnMpIHsKICAgICAgICAgICAgZ2V0TG9n\nKCkudHJhY2UoImNyZWF0ZSB0aHJlYWQgIiArIHRocmVhZFRvUnVuKTsKICAg\nICAgICAgICAgdGhpcy50aHJlYWRUb1J1biA9IHRocmVhZFRvUnVuOwogICAg\nICAgICAgICB0aGlzLmFjdGlvbnMgPSBhY3Rpb25zOwoKICAgICAgICAgICAg\ndGhpcy5lbXBsb3llZXMgPSBuZXcgSGFzaE1hcDxJbnRlZ2VyLCBMb2NrRW1w\nbG95ZWU+KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25p\nemVkIHZvaWQgbm90aWZ5VGhyZWFkKCkgewogICAgICAgICAgICBub3RpZnko\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9p\nZCBydW4oKSB7CiAgICAgICAgCS8vIHNsZWVwIGFuZCBsZXQgb3RoZXIgdGhy\nZWFkcyBoYXMgYSBjaGFuY2UgdG8gZG8gc3R1ZmZzLAogICAgICAgIAkvLyBv\ndGhlcndpc2UgdGhpcyBuZXcgdGhyZWFkIG1heSBwZXJmb3JtIGEgbm90aWZ5\nIGJlZm9yZQogICAgICAgIAkvLyB0aGUgb3RoZXIgdGhyZWFkIGhhcyBhIGNo\nYW5jZSB0byB3YWl0LgogICAgICAgIAl0cnkgewoJCQkJVGhyZWFkLnNsZWVw\nKDUwMCk7CgkJCX0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsK\nCQkJfQogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgiVGhyZWFkICIgKyB0\naHJlYWRUb1J1biArICI6IHJ1bigpIik7CiAgICAgICAgICAgIGxhdW5jaENv\nbW1vblNlcXVlbmNlKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICBjbGFz\ncyBQbGF0Zm9ybVNwZWVkVGVzdFRocmVhZCBleHRlbmRzIFRocmVhZCB7CiAg\nICAgICAgbG9uZyBsb29wQ250ID0gMDsKCiAgICAgICAgcHVibGljIGxvbmcg\nZ2V0TG9vcENudCgpIHsKICAgICAgICAgICAgcmV0dXJuIGxvb3BDbnQ7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgcnVu\nKCkgewogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAg\nICAgKytsb29wQ250OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNJbnRl\ncnJ1cHRlZCgpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBlbnVtIERC\nVHlwZSB7CiAgICAgICAgYWNjZXNzLCBkYjIsIGRlcmJ5LCBlbXByZXNzLCBm\nb3hwcm8sIGgyLCBoc3FsLCBpbmZvcm1peCwgaW5ncmVzLCBqZGF0YXN0b3Jl\nLCBteXNxbCwgb3JhY2xlLCBwb2ludGJhc2UsIHBvc3RncmVzLAogICAgICAg\nIHNxbHNlcnZlciwgc3liYXNlCiAgICB9OwoKICAgIHByb3RlY3RlZCBEQlR5\ncGUgZ2V0REJUeXBlKEVudGl0eU1hbmFnZXIgZW0pIHsKICAgICAgICBKREJD\nQ29uZmlndXJhdGlvbkltcGwgY29uZiA9IChKREJDQ29uZmlndXJhdGlvbklt\ncGwpIGdldENvbmZpZ3VyYXRpb24oZW0pOwogICAgICAgIFN0cmluZyBkaWN0\nQ2xhc3NOYW1lID0gZ2V0Q29uZmlndXJhdGlvbihlbSkuZ2V0REJEaWN0aW9u\nYXJ5SW5zdGFuY2UoKS5nZXRDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICBT\ndHJpbmcgZGIgPSBjb25mLmRiZGljdGlvbmFyeVBsdWdpbi5hbGlhcyhkaWN0\nQ2xhc3NOYW1lKTsKICAgICAgICByZXR1cm4gREJUeXBlLnZhbHVlT2YoZGIp\nOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCB7ICJ1bnVzZWQiLCAi\nZGVwcmVjYXRpb24iIH0pCiAgICBwcm90ZWN0ZWQgSkRCQ0NvbmZpZ3VyYXRp\nb24gZ2V0Q29uZmlndXJhdGlvbihFbnRpdHlNYW5hZ2VyIGVtKSB7CiAgICAg\nICAgcmV0dXJuICgoSkRCQ0NvbmZpZ3VyYXRpb24pICgoT3BlbkpQQUVudGl0\neU1hbmFnZXIpIGVtKS5nZXRDb25maWd1cmF0aW9uKCkpOwogICAgfQp9Cg==\n","encoding":"base64"}

