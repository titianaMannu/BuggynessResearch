{"sha":"f213d1917f94a262c90b919f52d77681aa124fcf","node_id":"MDQ6QmxvYjIwNjM2NDpmMjEzZDE5MTdmOTRhMjYyYzkwYjkxOWY1MmQ3NzY4MWFhMTI0ZmNm","size":21415,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f213d1917f94a262c90b919f52d77681aa124fcf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5sb2NrbWdyOwoK\naW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLkVudGl0eU1hbmFnZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5Mb2NrTW9kZVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QZXNz\naW1pc3RpY0xvY2tFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5RdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5VGltZW91\ndEV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5j\nb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS50ZXN0LlNRTExpc3RlbmVyVGVzdENhc2U7\nCgovKioKICogVGVzdCBQZXNzaW1pc3RpYyBMb2NrIGFuZCBleGNlcHRpb24g\nYmVoYXZpb3IgYWdhaW5zdCBFbnRpdHlNYW5hZ2VyIGFuZCBRdWVyeSBpbnRl\ncmZhY2UgbWV0aG9kcy4KICovCnB1YmxpYyBjbGFzcyBUZXN0UGVzc2ltaXN0\naWNMb2NrcyBleHRlbmRzIFNRTExpc3RlbmVyVGVzdENhc2UgewoKICAgIHBy\naXZhdGUgREJEaWN0aW9uYXJ5IGRpY3QgPSBudWxsOwoKICAgIHB1YmxpYyB2\nb2lkIHNldFVwKCkgewogICAgICAgIHNldFN1cHBvcnRlZERhdGFiYXNlcygK\nICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5E\nZXJieURpY3Rpb25hcnkuY2xhc3MsCi8vICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5PcmFjbGVEaWN0aW9uYXJ5LmNsYXNz\nLAogICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkRCMkRpY3Rpb25hcnkuY2xhc3MpOwogICAgICAgIGlmIChpc1Rlc3RzRGlz\nYWJsZWQoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBzZXRVcChFbXBsb3llZS5jbGFzcywgRGVwYXJ0bWVudC5jbGFzcywg\nIm9wZW5qcGEuTG9ja01hbmFnZXIiLCAibWl4ZWQiKTsKICAgICAgICBTdHJp\nbmcgZW1wVGFibGUgPSBnZXRNYXBwaW5nKEVtcGxveWVlLmNsYXNzKS5nZXRU\nYWJsZSgpLmdldEZ1bGxOYW1lKCk7CiAgICAgICAgU3RyaW5nIGRlcHRUYWJs\nZSA9IGdldE1hcHBpbmcoRGVwYXJ0bWVudC5jbGFzcykuZ2V0VGFibGUoKS5n\nZXRGdWxsTmFtZSgpOwoKICAgICAgICBkaWN0PSAoKEpEQkNDb25maWd1cmF0\naW9uKWVtZi5nZXRDb25maWd1cmF0aW9uKCkpLmdldERCRGljdGlvbmFyeUlu\nc3RhbmNlKCk7CgogICAgICAgIEVudGl0eU1hbmFnZXIgZW0gPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5i\nZWdpbigpOwoKICAgICAgICAgICAgZW0uY3JlYXRlUXVlcnkoImRlbGV0ZSBm\ncm9tICIgKyBlbXBUYWJsZSkuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAg\nICBlbS5jcmVhdGVRdWVyeSgiZGVsZXRlIGZyb20gIiArIGRlcHRUYWJsZSku\nZXhlY3V0ZVVwZGF0ZSgpOwoKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rp\nb24oKS5jb21taXQoKTsKCiAgICAgICAgICAgIEVtcGxveWVlIGUxLCBlMjsK\nICAgICAgICAgICAgRGVwYXJ0bWVudCBkMSwgZDI7CiAgICAgICAgICAgIGQx\nID0gbmV3IERlcGFydG1lbnQoKTsKICAgICAgICAgICAgZDEuc2V0SWQoMTAp\nOwogICAgICAgICAgICBkMS5zZXROYW1lKCJEMTAiKTsKCiAgICAgICAgICAg\nIGUxID0gbmV3IEVtcGxveWVlKCk7CiAgICAgICAgICAgIGUxLnNldElkKDEp\nOwogICAgICAgICAgICBlMS5zZXREZXBhcnRtZW50KGQxKTsKICAgICAgICAg\nICAgZTEuc2V0Rmlyc3ROYW1lKCJmaXJzdC4xIik7CiAgICAgICAgICAgIGUx\nLnNldExhc3ROYW1lKCJsYXN0LjEiKTsKCiAgICAgICAgICAgIGQyID0gbmV3\nIERlcGFydG1lbnQoKTsKICAgICAgICAgICAgZDIuc2V0SWQoMjApOwogICAg\nICAgICAgICBkMi5zZXROYW1lKCJEMjAiKTsKCiAgICAgICAgICAgIGUyID0g\nbmV3IEVtcGxveWVlKCk7CiAgICAgICAgICAgIGUyLnNldElkKDIpOwogICAg\nICAgICAgICBlMi5zZXREZXBhcnRtZW50KGQyKTsKICAgICAgICAgICAgZTIu\nc2V0Rmlyc3ROYW1lKCJmaXJzdC4yIik7CiAgICAgICAgICAgIGUyLnNldExh\nc3ROYW1lKCJsYXN0LjIiKTsKCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0\naW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChkMSk7CiAg\nICAgICAgICAgIGVtLnBlcnNpc3QoZDIpOwogICAgICAgICAgICBlbS5wZXJz\naXN0KGUxKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChlMik7CiAgICAgICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZS5wcmludFN0YWNr\nVHJhY2UoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nZW0gIT0gbnVsbCAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAg\nZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKgogICAgICogVGVzdCBmaW5kIHdpdGggcGVzc2ltaXN0aWMgbG9jayBh\nZnRlciBhIHF1ZXJ5IHdpdGggcGVzc2ltaXN0aWMgbG9jay4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgdGVzdEZpbmRBZnRlclF1ZXJ5V2l0aFBlc3NpbWlz\ndGljTG9ja3MoKSB7CiAgICAgICAgRW50aXR5TWFuYWdlciBlbTEgPSBlbWYu\nY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIEVudGl0eU1hbmFnZXIg\nZW0yID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBlbTEuZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwog\nICAgICAgICAgICBRdWVyeSBxdWVyeSA9IGVtMS5jcmVhdGVRdWVyeSgKICAg\nICAgICAgICAgICAgICAgICAic2VsZWN0IGUgZnJvbSBFbXBsb3llZSBlIHdo\nZXJlIGUuaWQgPCAxMCIpLnNldEZpcnN0UmVzdWx0KDEpOwogICAgICAgICAg\nICAvLyBMb2NrIGFsbCBzZWxlY3RlZCBFbXBsb3llZXMsIHNraXAgdGhlIGZp\ncnN0IG9uZSwgaS5lIHNob3VsZCBsb2NrIEVtcGxveWVlKDIpCiAgICAgICAg\nICAgIHF1ZXJ5LnNldExvY2tNb2RlKExvY2tNb2RlVHlwZS5QRVNTSU1JU1RJ\nQ19SRUFEKTsKICAgICAgICAgICAgcXVlcnkuc2V0SGludCgiamF2YXgucGVy\nc2lzdGVuY2UucXVlcnkudGltZW91dCIsIDIwMDApOwogICAgICAgICAgICBM\naXN0PEVtcGxveWVlPiBxID0gcXVlcnkuZ2V0UmVzdWx0TGlzdCgpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoIkV4cGVjdGVkIDEgZWxlbWVudCB3aXRo\nIGVtcGx5ZWUgaWQ9MiIsIHEuc2l6ZSgpLCAxKTsKICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZSgiVGVzdCBFbXBsb3llZSBmaXJzdCBuYW1lID0gJ2ZpcnN0LjIn\nIiwgcS5nZXQoMCkuZ2V0Rmlyc3ROYW1lKCkuZXF1YWxzKCJmaXJzdC4xIikK\nICAgICAgICAgICAgICAgICAgICB8fCBxLmdldCgwKS5nZXRGaXJzdE5hbWUo\nKS5lcXVhbHMoImZpcnN0LjIiKSk7CgogICAgICAgICAgICBlbTIuZ2V0VHJh\nbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBNYXA8U3RyaW5nLE9i\namVjdD4gbWFwID0gbmV3IEhhc2hNYXA8U3RyaW5nLE9iamVjdD4oKTsKICAg\nICAgICAgICAgbWFwLnB1dCgiamF2YXgucGVyc2lzdGVuY2UubG9jay50aW1l\nb3V0IiwgMjAwMCk7CiAgICAgICAgICAgIC8vIGZpbmQgRW1wbG95ZWUoMikg\nd2l0aCBhIGxvY2ssIHNob3VsZCBibG9jayBhbmQgZXhwZWN0ZWQgYSBQZXNz\naW1pc3RpY0xvY2tFeGNlcHRpb24KICAgICAgICAgICAgZW0yLmZpbmQoRW1w\nbG95ZWUuY2xhc3MsIDIsIExvY2tNb2RlVHlwZS5QRVNTSU1JU1RJQ19SRUFE\nLCBtYXApOwogICAgICAgICAgICBmYWlsKCJVbmV4Y3BlY3RlZCBmaW5kIHN1\nY2NlZWRlZC4gU2hvdWxkIHRocm93IGEgUGVzc2ltaXN0aWNMb2NrRXhjZXB0\naW9uLiIpOwogICAgICAgIH0gY2F0Y2ggKFF1ZXJ5VGltZW91dEV4Y2VwdGlv\nbiBlKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRPRE86IERCMjog\nVGhpcyBpcyB0aGUgY3VycmVudCB1bmV4cGVjdGVkIGV4Y2VwdGlvbiBkdWUg\ndG8gT1BFTkpQQS05OTEuCiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGlzIHdo\nZW4gdGhlIHByb2JsZW0gaXMgZml4ZWQKLy8gICAgICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oIkNhdWdodCAiICsgZS5nZXRDbGFzcygpLmdldE5hbWUo\nKSArICI6IiArIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9IGNhdGNoIChQ\nZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBU\nT0RPOiBUaGlzIGlzIHRoZSBleHBlY3RlZCBleGNlcHRpb24gYnV0IHdpbGwg\nYmUgZml4ZWQgdW5kZXIgT1BFTkpQQS05OTEKLy8gICAgICAgICAgICBTeXN0\nZW0ub3V0LnByaW50bG4oIkNhdWdodCAiICsgZS5nZXRDbGFzcygpLmdldE5h\nbWUoKSArICI6IiArIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgZmFpbCgiQ2F1Z2h0IHVu\nZXhwZWN0ZWQgIiArIGV4LmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsg\nZXguZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBpZiggZW0xLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAg\nICAgICAgICAgICAgIGVtMS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7\nCiAgICAgICAgICAgIGlmKCBlbTIuZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2\nZSgpKQogICAgICAgICAgICAgICAgZW0yLmdldFRyYW5zYWN0aW9uKCkucm9s\nbGJhY2soKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGVtMS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIFF1\nZXJ5IHF1ZXJ5ID0gZW0xLmNyZWF0ZVF1ZXJ5KAogICAgICAgICAgICAgICAg\nICAgICJzZWxlY3QgZS5kZXBhcnRtZW50IGZyb20gRW1wbG95ZWUgZSB3aGVy\nZSBlLmlkIDwgMTAiKS5zZXRGaXJzdFJlc3VsdCgxKTsKICAgICAgICAgICAg\nLy8gTG9jayBhbGwgc2VsZWN0ZWQgRGVwYXJ0bWVudHMsIHNraXAgdGhlIGZp\ncnN0IG9uZSwgaS5lIHNob3VsZCBsb2NrIERlcGFydG1lbnQoMjApCiAgICAg\nICAgICAgIHF1ZXJ5LnNldExvY2tNb2RlKExvY2tNb2RlVHlwZS5QRVNTSU1J\nU1RJQ19SRUFEKTsKICAgICAgICAgICAgcXVlcnkuc2V0SGludCgiamF2YXgu\ncGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIsIDIwMDApOwogICAgICAgICAg\nICBMaXN0PERlcGFydG1lbnQ+IHEgPSBxdWVyeS5nZXRSZXN1bHRMaXN0KCk7\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiRXhwZWN0ZWQgMSBlbGVtZW50\nIHdpdGggZGVwYXJ0bWVudCBpZD0yMCIsIHEuc2l6ZSgpLCAxKTsKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgiVGVzdCBkZXBhcnRtZW50IG5hbWUgPSAnRDIw\nJyIsIHEuZ2V0KDApLmdldE5hbWUoKS5lcXVhbHMoIkQxMCIpCiAgICAgICAg\nICAgICAgICAgICAgfHwgcS5nZXQoMCkuZ2V0TmFtZSgpLmVxdWFscygiRDIw\nIikpOwoKICAgICAgICAgICAgZW0yLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4o\nKTsKICAgICAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG1hcCA9IG5ldyBI\nYXNoTWFwPFN0cmluZyxPYmplY3Q+KCk7CiAgICAgICAgICAgIG1hcC5wdXQo\nImphdmF4LnBlcnNpc3RlbmNlLmxvY2sudGltZW91dCIsIDIwMDApOwogICAg\nICAgICAgICAvLyBmaW5kIEVtcGxveWVlKDIpIHdpdGggYSBsb2NrLCBubyBi\nbG9jayBzaW5jZSBvbmx5IGRlcGFydG1lbnQgd2FzIGxvY2tlZAogICAgICAg\nICAgICBFbXBsb3llZSBlbXAgPSBlbTIuZmluZChFbXBsb3llZS5jbGFzcywg\nMSwgTG9ja01vZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQsIG1hcCk7CiAgICAg\nICAgICAgIGFzc2VydE5vdE51bGwoIlF1ZXJ5IGxvY2tzIGRlcGFydG1lbnQg\nb25seSwgdGhlcmVmb3JlIHNob3VsZCBmaW5kIEVtcGxveWVlLiIsIGVtcCk7\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiVGVzdCBFbXBsb3llZSBmaXJz\ndCBuYW1lID0gJ2ZpcnN0LjEnIiwgZW1wLmdldEZpcnN0TmFtZSgpLCAiZmly\nc3QuMSIpOwogICAgICAgIH0gY2F0Y2ggKFF1ZXJ5VGltZW91dEV4Y2VwdGlv\nbiBlKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRPRE86IERCMjog\nVGhpcyBpcyB0aGUgY3VycmVudCB1bmV4cGVjdGVkIGV4Y2VwdGlvbiBkdWUg\ndG8gT1BFTkpQQS05OTEuCiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGlzIHdo\nZW4gdGhlIHByb2JsZW0gaXMgZml4ZWQKLy8gICAgICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oIkNhdWdodCAiICsgZS5nZXRDbGFzcygpLmdldE5hbWUo\nKSArICI6IiArIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYoICEo\nZGljdCBpbnN0YW5jZW9mIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5E\nQjJEaWN0aW9uYXJ5KSkgewogICAgICAgICAgICAgICAgZmFpbCgiQ2F1Z2h0\nIHVuZXhwZWN0ZWQgIiArIGUuZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAiOiIg\nKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNh\ndGNoIChQZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAvLyBUT0RPOiBUaGlzIGlzIHRoZSBleHBlY3RlZCBleGNlcHRpb24gYnV0\nIHdpbGwgYmUgZml4ZWQgdW5kZXIgT1BFTkpQQS05OTEKLy8gICAgICAgICAg\nICBTeXN0ZW0ub3V0LnByaW50bG4oIkNhdWdodCAiICsgZS5nZXRDbGFzcygp\nLmdldE5hbWUoKSArICI6IiArIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAg\nICAgaWYoICEoZGljdCBpbnN0YW5jZW9mIG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5EQjJEaWN0aW9uYXJ5KSkgewogICAgICAgICAgICAgICAgZmFp\nbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgIiArIGUuZ2V0Q2xhc3MoKS5nZXROYW1l\nKCkgKyAiOiIgKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgZmFp\nbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgIiArIGV4LmdldENsYXNzKCkuZ2V0TmFt\nZSgpICsgIjoiICsgZXguZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiggZW0xLmdldFRyYW5zYWN0aW9uKCkuaXNB\nY3RpdmUoKSkKICAgICAgICAgICAgICAgIGVtMS5nZXRUcmFuc2FjdGlvbigp\nLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIGlmKCBlbTIuZ2V0VHJhbnNhY3Rp\nb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgZW0yLmdldFRyYW5z\nYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICB9CiAgICAgICAgZW0xLmNs\nb3NlKCk7CiAgICAgICAgZW0yLmNsb3NlKCk7CiAgICB9CgogICAgLyoKICAg\nICAqIFRlc3QgZmluZCB3aXRoIHBlc3NpbWlzdGljIGxvY2sgYWZ0ZXIgYSBx\ndWVyeSB3aXRoIHBlc3NpbWlzdGljIGxvY2suCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHRlc3RGaW5kQWZ0ZXJRdWVyeU9yZGVyQnlXaXRoUGVzc2ltaXN0\naWNMb2NrcygpIHsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtMSA9IGVtZi5j\ncmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgRW50aXR5TWFuYWdlciBl\nbTIgPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGVtMS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAg\nICAgICAgICAgIFF1ZXJ5IHF1ZXJ5ID0gZW0xLmNyZWF0ZVF1ZXJ5KAogICAg\nICAgICAgICAgICAgICAgICJzZWxlY3QgZSBmcm9tIEVtcGxveWVlIGUgd2hl\ncmUgZS5pZCA8IDEwIG9yZGVyIGJ5IGUuaWQiKS5zZXRGaXJzdFJlc3VsdCgx\nKTsKICAgICAgICAgICAgLy8gTG9jayBhbGwgc2VsZWN0ZWQgRW1wbG95ZWVz\nLCBza2lwIHRoZSBmaXJzdCBvbmUsIGkuZSBzaG91bGQgbG9jayBFbXBsb3ll\nZSgyKQogICAgICAgICAgICBxdWVyeS5zZXRMb2NrTW9kZShMb2NrTW9kZVR5\ncGUuUEVTU0lNSVNUSUNfUkVBRCk7CiAgICAgICAgICAgIHF1ZXJ5LnNldEhp\nbnQoImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiLCAyMDAwKTsK\nICAgICAgICAgICAgTGlzdDxFbXBsb3llZT4gcSA9IHF1ZXJ5LmdldFJlc3Vs\ndExpc3QoKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJFeHBlY3RlZCAx\nIGVsZW1lbnQgd2l0aCBlbXBseWVlIGlkPTIiLCBxLnNpemUoKSwgMSk7CiAg\nICAgICAgICAgIGFzc2VydEVxdWFscygiVGVzdCBFbXBsb3llZSBmaXJzdCBu\nYW1lID0gJ2ZpcnN0LjInIiwgcS5nZXQoMCkuZ2V0Rmlyc3ROYW1lKCksICJm\naXJzdC4yIik7CgogICAgICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rpb24oKS5i\nZWdpbigpOwogICAgICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4gbWFwID0g\nbmV3IEhhc2hNYXA8U3RyaW5nLE9iamVjdD4oKTsKICAgICAgICAgICAgbWFw\nLnB1dCgiamF2YXgucGVyc2lzdGVuY2UubG9jay50aW1lb3V0IiwgMjAwMCk7\nCiAgICAgICAgICAgIC8vIGZpbmQgRW1wbG95ZWUoMikgd2l0aCBhIGxvY2ss\nIHNob3VsZCBibG9jayBhbmQgZXhwZWN0ZWQgYSBQZXNzaW1pc3RpY0xvY2tF\neGNlcHRpb24KICAgICAgICAgICAgZW0yLmZpbmQoRW1wbG95ZWUuY2xhc3Ms\nIDIsIExvY2tNb2RlVHlwZS5QRVNTSU1JU1RJQ19SRUFELCBtYXApOwogICAg\nICAgICAgICBmYWlsKCJVbmV4Y3BlY3RlZCBmaW5kIHN1Y2NlZWRlZC4gU2hv\ndWxkIHRocm93IGEgUGVzc2ltaXN0aWNMb2NrRXhjZXB0aW9uLiIpOwogICAg\nICAgIH0gY2F0Y2ggKFF1ZXJ5VGltZW91dEV4Y2VwdGlvbiBlKSB7ICAgICAg\nICAgICAgCiAgICAgICAgICAgIC8vIFRPRE86IERCMjogVGhpcyBpcyB0aGUg\nY3VycmVudCB1bmV4cGVjdGVkIGV4Y2VwdGlvbiBkdWUgdG8gT1BFTkpQQS05\nOTEuCiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGlzIHdoZW4gdGhlIHByb2Js\nZW0gaXMgZml4ZWQKLy8gICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4o\nIkNhdWdodCAiICsgZS5nZXRDbGFzcygpLmdldE5hbWUoKSArICI6IiArIGUu\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9IGNhdGNoIChQZXNzaW1pc3RpY0xv\nY2tFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBUT0RPOiBUaGlzIGlz\nIHRoZSBleHBlY3RlZCBleGNlcHRpb24gYnV0IHdpbGwgYmUgZml4ZWQgdW5k\nZXIgT1BFTkpQQS05OTEKLy8gICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50\nbG4oIkNhdWdodCAiICsgZS5nZXRDbGFzcygpLmdldE5hbWUoKSArICI6IiAr\nIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZXgpIHsKICAgICAgICAgICAgZmFpbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgIiAr\nIGV4LmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsgZXguZ2V0TWVzc2Fn\nZSgpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiggZW0x\nLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAg\nIGVtMS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAg\nIGlmKCBlbTIuZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAg\nICAgICAgICAgZW0yLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAg\nICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVtMS5nZXRUcmFu\nc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIFF1ZXJ5IHF1ZXJ5ID0g\nZW0xLmNyZWF0ZVF1ZXJ5KAogICAgICAgICAgICAgICAgICAgICJzZWxlY3Qg\nZS5kZXBhcnRtZW50IGZyb20gRW1wbG95ZWUgZSB3aGVyZSBlLmlkIDwgMTAg\nb3JkZXIgYnkgZS5kZXBhcnRtZW50LmlkIikuc2V0Rmlyc3RSZXN1bHQoMSk7\nCiAgICAgICAgICAgIC8vIExvY2sgYWxsIHNlbGVjdGVkIERlcGFydG1lbnRz\nLCBza2lwIHRoZSBmaXJzdCBvbmUsIGkuZSBzaG91bGQgbG9jayBEZXBhcnRt\nZW50KDIwKQogICAgICAgICAgICBxdWVyeS5zZXRMb2NrTW9kZShMb2NrTW9k\nZVR5cGUuUEVTU0lNSVNUSUNfUkVBRCk7CiAgICAgICAgICAgIHF1ZXJ5LnNl\ndEhpbnQoImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiLCAyMDAw\nKTsKICAgICAgICAgICAgTGlzdDxEZXBhcnRtZW50PiBxID0gcXVlcnkuZ2V0\nUmVzdWx0TGlzdCgpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoIkV4cGVj\ndGVkIDEgZWxlbWVudCB3aXRoIGRlcGFydG1lbnQgaWQ9MjAiLCBxLnNpemUo\nKSwgMSk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygiVGVzdCBkZXBhcnRt\nZW50IG5hbWUgPSAnRDIwJyIsIHEuZ2V0KDApLmdldE5hbWUoKSwgIkQyMCIp\nOwoKICAgICAgICAgICAgZW0yLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsK\nICAgICAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+IG1hcCA9IG5ldyBIYXNo\nTWFwPFN0cmluZyxPYmplY3Q+KCk7CiAgICAgICAgICAgIG1hcC5wdXQoImph\ndmF4LnBlcnNpc3RlbmNlLmxvY2sudGltZW91dCIsIDIwMDApOwogICAgICAg\nICAgICAvLyBmaW5kIEVtcGxveWVlKDIpIHdpdGggYSBsb2NrLCBubyBibG9j\nayBzaW5jZSBvbmx5IGRlcGFydG1lbnQgd2FzIGxvY2tlZAogICAgICAgICAg\nICBFbXBsb3llZSBlbXAgPSBlbTIuZmluZChFbXBsb3llZS5jbGFzcywgMSwg\nTG9ja01vZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQsIG1hcCk7CiAgICAgICAg\nICAgIGFzc2VydE5vdE51bGwoIlF1ZXJ5IGxvY2tzIGRlcGFydG1lbnQgb25s\neSwgdGhlcmVmb3JlIHNob3VsZCBmaW5kIEVtcGxveWVlLiIsIGVtcCk7CiAg\nICAgICAgICAgIGFzc2VydEVxdWFscygiVGVzdCBFbXBsb3llZSBmaXJzdCBu\nYW1lID0gJ2ZpcnN0LjEnIiwgZW1wLmdldEZpcnN0TmFtZSgpLCAiZmlyc3Qu\nMSIpOwogICAgICAgIH0gY2F0Y2ggKFF1ZXJ5VGltZW91dEV4Y2VwdGlvbiBl\nKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRPRE86IERCMjogVGhp\ncyBpcyB0aGUgY3VycmVudCB1bmV4cGVjdGVkIGV4Y2VwdGlvbiBkdWUgdG8g\nT1BFTkpQQS05OTEuCiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGlzIHdoZW4g\ndGhlIHByb2JsZW0gaXMgZml4ZWQKLy8gICAgICAgICAgU3lzdGVtLm91dC5w\ncmludGxuKCJDYXVnaHQgIiArIGUuZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAi\nOiIgKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmKCAhKGRpY3Qg\naW5zdGFuY2VvZiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREIyRGlj\ndGlvbmFyeSkpIHsKICAgICAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1bmV4\ncGVjdGVkICIgKyBlLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsgZS5n\nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAo\nUGVzc2ltaXN0aWNMb2NrRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8g\nVE9ETzogVGhpcyBpcyB0aGUgZXhwZWN0ZWQgZXhjZXB0aW9uIGJ1dCB3aWxs\nIGJlIGZpeGVkIHVuZGVyIE9QRU5KUEEtOTkxCi8vICAgICAgICAgIFN5c3Rl\nbS5vdXQucHJpbnRsbigiQ2F1Z2h0ICIgKyBlLmdldENsYXNzKCkuZ2V0TmFt\nZSgpICsgIjoiICsgZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZigg\nIShkaWN0IGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkRCMkRpY3Rpb25hcnkpKSB7CiAgICAgICAgICAgICAgICBmYWlsKCJDYXVn\naHQgdW5leHBlY3RlZCAiICsgZS5nZXRDbGFzcygpLmdldE5hbWUoKSArICI6\nIiArIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBleCkgewogICAgICAgICAgICBmYWlsKCJDYXVn\naHQgdW5leHBlY3RlZCAiICsgZXguZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAi\nOiIgKyBleC5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGlmKCBlbTEuZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgp\nKQogICAgICAgICAgICAgICAgZW0xLmdldFRyYW5zYWN0aW9uKCkucm9sbGJh\nY2soKTsKICAgICAgICAgICAgaWYoIGVtMi5nZXRUcmFuc2FjdGlvbigpLmlz\nQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rpb24o\nKS5yb2xsYmFjaygpOwogICAgICAgIH0KICAgICAgICBlbTEuY2xvc2UoKTsK\nICAgICAgICBlbTIuY2xvc2UoKTsKICAgIH0KCiAgICAvKgogICAgICogVGVz\ndCBxdWVyeSB3aXRoIHBlc3NpbWlzdGljIGxvY2sgYWZ0ZXIgYSBmaW5kIHdp\ndGggcGVzc2ltaXN0aWMgbG9jay4KICAgICAqLwogICAgcHVibGljIHZvaWQg\ndGVzdFF1ZXJ5QWZ0ZXJGaW5kV2l0aFBlc3NpbWlzdGljTG9ja3MoKSB7CiAg\nICAgICAgRW50aXR5TWFuYWdlciBlbTEgPSBlbWYuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOwogICAgICAgIEVudGl0eU1hbmFnZXIgZW0yID0gZW1mLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBl\nbTIuZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBNYXA8\nU3RyaW5nLE9iamVjdD4gbWFwID0gbmV3IEhhc2hNYXA8U3RyaW5nLE9iamVj\ndD4oKTsKICAgICAgICAgICAgbWFwLnB1dCgiamF2YXgucGVyc2lzdGVuY2Uu\nbG9jay50aW1lb3V0IiwgMjAwMCk7CiAgICAgICAgICAgIC8vIExvY2sgRW1w\nbHllZSgxKSwgbm8gZGVwYXJ0bWVudCBzaG91bGQgYmUgbG9ja2VkCiAgICAg\nICAgICAgIGVtMi5maW5kKEVtcGxveWVlLmNsYXNzLCAxLCBMb2NrTW9kZVR5\ncGUuUEVTU0lNSVNUSUNfUkVBRCwgbWFwKTsKCiAgICAgICAgICAgIGVtMS5n\nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIFF1ZXJ5IHF1\nZXJ5ID0gZW0xLmNyZWF0ZVF1ZXJ5KAogICAgICAgICAgICAgICAgICAgICJz\nZWxlY3QgZS5kZXBhcnRtZW50IGZyb20gRW1wbG95ZWUgZSB3aGVyZSBlLmlk\nIDwgMTAiKS5zZXRGaXJzdFJlc3VsdCgxKTsKICAgICAgICAgICAgcXVlcnku\nc2V0TG9ja01vZGUoTG9ja01vZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQpOwog\nICAgICAgICAgICBxdWVyeS5zZXRIaW50KCJqYXZheC5wZXJzaXN0ZW5jZS5x\ndWVyeS50aW1lb3V0IiwgMjAwMCk7CiAgICAgICAgICAgIC8vIExvY2sgYWxs\nIHNlbGVjdGVkIERlcGFydG1lbnQgYnV0IHNraXAgdGhlIGZpcnN0LCBpLmUu\nIGxvY2sgRGVwYXJ0bWVudCgyMCksIHNob3VsZCBxdWVyeSBzdWNjZXNzZnVs\nbHkuCiAgICAgICAgICAgIExpc3Q8RGVwYXJ0bWVudD4gcSA9IHF1ZXJ5Lmdl\ndFJlc3VsdExpc3QoKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJFeHBl\nY3RlZCAxIGVsZW1lbnQgd2l0aCBkZXBhcnRtZW50IGlkPTIwIiwgcS5zaXpl\nKCksIDEpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJUZXN0IGRlcGFydG1l\nbnQgbmFtZSA9ICdEMjAnIiwgcS5nZXQoMCkuZ2V0TmFtZSgpLmVxdWFscygi\nRDEwIikKICAgICAgICAgICAgICAgICAgICB8fCBxLmdldCgwKS5nZXROYW1l\nKCkuZXF1YWxzKCJEMjAiKSk7CiAgICAgICAgfSBjYXRjaCAoUXVlcnlUaW1l\nb3V0RXhjZXB0aW9uIGUpIHsgICAgICAgICAgICAKICAgICAgICAgICAgLy8g\nVE9ETzogREIyOiBUaGlzIGlzIHRoZSBjdXJyZW50IHVuZXhwZWN0ZWQgZXhj\nZXB0aW9uIGR1ZSB0byBPUEVOSlBBLTk5MS4KICAgICAgICAgICAgLy8gUmVt\nb3ZlIHRoaXMgd2hlbiB0aGUgcHJvYmxlbSBpcyBmaXhlZAovLyAgICAgICAg\nICBTeXN0ZW0ub3V0LnByaW50bG4oIkNhdWdodCAiICsgZS5nZXRDbGFzcygp\nLmdldE5hbWUoKSArICI6IiArIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAg\nICAgaWYoICEoZGljdCBpbnN0YW5jZW9mIG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5EQjJEaWN0aW9uYXJ5KSkgewogICAgICAgICAgICAgICAgZmFp\nbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgIiArIGUuZ2V0Q2xhc3MoKS5nZXROYW1l\nKCkgKyAiOiIgKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGNhdGNoIChQZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAvLyBUT0RPOiBUaGlzIGlzIHRoZSBleHBlY3RlZCBleGNl\ncHRpb24gYnV0IHdpbGwgYmUgZml4ZWQgdW5kZXIgT1BFTkpQQS05OTEKLy8g\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJDYXVnaHQgIiArIGUuZ2V0\nQ2xhc3MoKS5nZXROYW1lKCkgKyAiOiIgKyBlLmdldE1lc3NhZ2UoKSk7CiAg\nICAgICAgICAgIGlmKCAhKGRpY3QgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuREIyRGljdGlvbmFyeSkpIHsKICAgICAgICAgICAg\nICAgIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkICIgKyBlLmdldENsYXNzKCku\nZ2V0TmFtZSgpICsgIjoiICsgZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAg\nICAgIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkICIgKyBleC5nZXRDbGFzcygp\nLmdldE5hbWUoKSArICI6IiArIGV4LmdldE1lc3NhZ2UoKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYoIGVtMS5nZXRUcmFuc2FjdGlv\nbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBlbTEuZ2V0VHJhbnNh\nY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICBpZiAoZW0yLmdldFRy\nYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIGVtMi5n\nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgfQogICAgICAg\nIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVtMi5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CgogICAgICAgICAgICBNYXA8U3RyaW5nLE9iamVjdD4g\nbWFwID0gbmV3IEhhc2hNYXA8U3RyaW5nLE9iamVjdD4oKTsKICAgICAgICAg\nICAgbWFwLnB1dCgiamF2YXgucGVyc2lzdGVuY2UubG9jay50aW1lb3V0Iiwg\nMjAwMCk7CiAgICAgICAgICAgIC8vIExvY2sgRW1wbHllZSgyKSwgbm8gZGVw\nYXJ0bWVudCBzaG91bGQgYmUgbG9ja2VkCiAgICAgICAgICAgIGVtMi5maW5k\nKEVtcGxveWVlLmNsYXNzLCAyLCBMb2NrTW9kZVR5cGUuUEVTU0lNSVNUSUNf\nUkVBRCwgbWFwKTsKCiAgICAgICAgICAgIGVtMS5nZXRUcmFuc2FjdGlvbigp\nLmJlZ2luKCk7CiAgICAgICAgICAgIFF1ZXJ5IHF1ZXJ5ID0gZW0xLmNyZWF0\nZVF1ZXJ5KAogICAgICAgICAgICAgICAgICAgICJzZWxlY3QgZSBmcm9tIEVt\ncGxveWVlIGUgd2hlcmUgZS5pZCA8IDEwIikuc2V0Rmlyc3RSZXN1bHQoMSk7\nCiAgICAgICAgICAgIC8vIExvY2sgYWxsIHNlbGVjdGVkIEVtcGxveWVlcywg\nc2tpcCB0aGUgZmlyc3Qgb25lLCBpLmUgc2hvdWxkIGxvY2sgRW1wbG95ZWUo\nMikKICAgICAgICAgICAgcXVlcnkuc2V0TG9ja01vZGUoTG9ja01vZGVUeXBl\nLlBFU1NJTUlTVElDX1JFQUQpOwogICAgICAgICAgICBxdWVyeS5zZXRIaW50\nKCJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0IiwgMjAwMCk7CiAg\nICAgICAgICAgIExpc3Q8RW1wbG95ZWU+IHEgPSBxdWVyeS5nZXRSZXN1bHRM\naXN0KCk7CiAgICAgICAgICAgIGZhaWwoIlVuZXhjcGVjdGVkIGZpbmQgc3Vj\nY2VlZGVkLiBTaG91bGQgdGhyb3cgYSBRdWVyeUxvY2tFeGNlcHRpb24uIik7\nCiAgICAgICAgfSBjYXRjaCAoUXVlcnlUaW1lb3V0RXhjZXB0aW9uIGUpIHsg\nICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZXhwZWN0\nZWQgZXhjZXB0aW9uLgovLyAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRs\nbigiQ2F1Z2h0ICIgKyBlLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsg\nZS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0gY2F0Y2ggKFBlc3NpbWlzdGlj\nTG9ja0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIFRPRE86IFRoaXMg\naXMgdGhlIGV4cGVjdGVkIGV4Y2VwdGlvbiBidXQgd2lsbCBiZSBmaXhlZCB1\nbmRlciBPUEVOSlBBLTk5MQovLyAgICAgICAgICAgIFN5c3RlbS5vdXQucHJp\nbnRsbigiQ2F1Z2h0ICIgKyBlLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoi\nICsgZS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBleCkgewogICAgICAgICAgICBmYWlsKCJDYXVnaHQgdW5leHBlY3RlZCAi\nICsgZXguZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAiOiIgKyBleC5nZXRNZXNz\nYWdlKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmKCBl\nbTEuZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAg\nICAgZW0xLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAg\nICAgaWYoIGVtMi5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAg\nICAgICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwog\nICAgICAgIH0KICAgICAgICBlbTEuY2xvc2UoKTsKICAgICAgICBlbTIuY2xv\nc2UoKTsKICAgIH0KCiAgICAvKgogICAgICogVGVzdCBxdWVyeSB3aXRoIHBl\nc3NpbWlzdGljIGxvY2sgYWZ0ZXIgYSBmaW5kIHdpdGggcGVzc2ltaXN0aWMg\nbG9jay4KICAgICAqLwogICAgcHVibGljIHZvaWQgdGVzdFF1ZXJ5T3JkZXJC\neUFmdGVyRmluZFdpdGhQZXNzaW1pc3RpY0xvY2tzKCkgewogICAgICAgIEVu\ndGl0eU1hbmFnZXIgZW0xID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsK\nICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtMiA9IGVtZi5jcmVhdGVFbnRpdHlN\nYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZW0yLmdldFRy\nYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgTWFwPFN0cmluZyxP\nYmplY3Q+IG1hcCA9IG5ldyBIYXNoTWFwPFN0cmluZyxPYmplY3Q+KCk7CiAg\nICAgICAgICAgIG1hcC5wdXQoImphdmF4LnBlcnNpc3RlbmNlLmxvY2sudGlt\nZW91dCIsIDIwMDApOwogICAgICAgICAgICAvLyBMb2NrIEVtcGx5ZWUoMSks\nIG5vIGRlcGFydG1lbnQgc2hvdWxkIGJlIGxvY2tlZAogICAgICAgICAgICBl\nbTIuZmluZChFbXBsb3llZS5jbGFzcywgMSwgTG9ja01vZGVUeXBlLlBFU1NJ\nTUlTVElDX1JFQUQsIG1hcCk7CgogICAgICAgICAgICBlbTEuZ2V0VHJhbnNh\nY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBRdWVyeSBxdWVyeSA9IGVt\nMS5jcmVhdGVRdWVyeSgKICAgICAgICAgICAgICAgICAgICAic2VsZWN0IGUu\nZGVwYXJ0bWVudCBmcm9tIEVtcGxveWVlIGUgd2hlcmUgZS5pZCA8IDEwIG9y\nZGVyIGJ5IGUuZGVwYXJ0bWVudC5pZCIpLnNldEZpcnN0UmVzdWx0KDEpOwog\nICAgICAgICAgICBxdWVyeS5zZXRMb2NrTW9kZShMb2NrTW9kZVR5cGUuUEVT\nU0lNSVNUSUNfUkVBRCk7CiAgICAgICAgICAgIHF1ZXJ5LnNldEhpbnQoImph\ndmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiLCAyMDAwKTsKICAgICAg\nICAgICAgLy8gTG9jayBhbGwgc2VsZWN0ZWQgRGVwYXJ0bWVudCBidXQgc2tp\ncCB0aGUgZmlyc3QsIGkuZS4gbG9jayBEZXBhcnRtZW50KDIwKSwgc2hvdWxk\nIHF1ZXJ5IHN1Y2Nlc3NmdWxseS4KICAgICAgICAgICAgTGlzdDxEZXBhcnRt\nZW50PiBxID0gcXVlcnkuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAgICAgICBh\nc3NlcnRFcXVhbHMoIkV4cGVjdGVkIDEgZWxlbWVudCB3aXRoIGRlcGFydG1l\nbnQgaWQ9MjAiLCBxLnNpemUoKSwgMSk7CiAgICAgICAgICAgIGFzc2VydEVx\ndWFscygiVGVzdCBkZXBhcnRtZW50IG5hbWUgPSAnRDIwJyIsIHEuZ2V0KDAp\nLmdldE5hbWUoKSwgIkQyMCIpOwogICAgICAgIH0gY2F0Y2ggKFF1ZXJ5VGlt\nZW91dEV4Y2VwdGlvbiBlKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgIC8v\nIFRPRE86IERCMjogVGhpcyBpcyB0aGUgY3VycmVudCB1bmV4cGVjdGVkIGV4\nY2VwdGlvbiBkdWUgdG8gT1BFTkpQQS05OTEuCiAgICAgICAgICAgIC8vIFJl\nbW92ZSB0aGlzIHdoZW4gdGhlIHByb2JsZW0gaXMgZml4ZWQKLy8gICAgICAg\nICAgU3lzdGVtLm91dC5wcmludGxuKCJDYXVnaHQgIiArIGUuZ2V0Q2xhc3Mo\nKS5nZXROYW1lKCkgKyAiOiIgKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAg\nICAgIGlmKCAhKGRpY3QgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuREIyRGljdGlvbmFyeSkpIHsKICAgICAgICAgICAgICAgIGZh\naWwoIkNhdWdodCB1bmV4cGVjdGVkICIgKyBlLmdldENsYXNzKCkuZ2V0TmFt\nZSgpICsgIjoiICsgZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBjYXRjaCAoUGVzc2ltaXN0aWNMb2NrRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgLy8gVE9ETzogVGhpcyBpcyB0aGUgZXhwZWN0ZWQgZXhj\nZXB0aW9uIGJ1dCB3aWxsIGJlIGZpeGVkIHVuZGVyIE9QRU5KUEEtOTkxCi8v\nICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiQ2F1Z2h0ICIgKyBlLmdl\ndENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsgZS5nZXRNZXNzYWdlKCkpOwog\nICAgICAgICAgICBpZiggIShkaWN0IGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCMkRpY3Rpb25hcnkpKSB7CiAgICAgICAgICAg\nICAgICBmYWlsKCJDYXVnaHQgdW5leHBlY3RlZCAiICsgZS5nZXRDbGFzcygp\nLmdldE5hbWUoKSArICI6IiArIGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCkgewogICAgICAg\nICAgICBmYWlsKCJDYXVnaHQgdW5leHBlY3RlZCAiICsgZXguZ2V0Q2xhc3Mo\nKS5nZXROYW1lKCkgKyAiOiIgKyBleC5nZXRNZXNzYWdlKCkpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmKCBlbTEuZ2V0VHJhbnNhY3Rp\nb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgZW0xLmdldFRyYW5z\nYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgaWYgKGVtMi5nZXRU\ncmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBlbTIu\nZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICB0cnkgewogICAgICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rp\nb24oKS5iZWdpbigpOwoKICAgICAgICAgICAgTWFwPFN0cmluZyxPYmplY3Q+\nIG1hcCA9IG5ldyBIYXNoTWFwPFN0cmluZyxPYmplY3Q+KCk7CiAgICAgICAg\nICAgIG1hcC5wdXQoImphdmF4LnBlcnNpc3RlbmNlLmxvY2sudGltZW91dCIs\nIDIwMDApOwogICAgICAgICAgICAvLyBMb2NrIEVtcGx5ZWUoMiksIG5vIGRl\ncGFydG1lbnQgc2hvdWxkIGJlIGxvY2tlZAogICAgICAgICAgICBlbTIuZmlu\nZChFbXBsb3llZS5jbGFzcywgMiwgTG9ja01vZGVUeXBlLlBFU1NJTUlTVElD\nX1JFQUQsIG1hcCk7CgogICAgICAgICAgICBlbTEuZ2V0VHJhbnNhY3Rpb24o\nKS5iZWdpbigpOwogICAgICAgICAgICBRdWVyeSBxdWVyeSA9IGVtMS5jcmVh\ndGVRdWVyeSgKICAgICAgICAgICAgICAgICAgICAic2VsZWN0IGUgZnJvbSBF\nbXBsb3llZSBlIHdoZXJlIGUuaWQgPCAxMCBvcmRlciBieSBlLmRlcGFydG1l\nbnQuaWQiKS5zZXRGaXJzdFJlc3VsdCgxKTsKICAgICAgICAgICAgLy8gTG9j\nayBhbGwgc2VsZWN0ZWQgRW1wbG95ZWVzLCBza2lwIHRoZSBmaXJzdCBvbmUs\nIGkuZSBzaG91bGQgbG9jayBFbXBsb3llZSgyKQogICAgICAgICAgICBxdWVy\neS5zZXRMb2NrTW9kZShMb2NrTW9kZVR5cGUuUEVTU0lNSVNUSUNfUkVBRCk7\nCiAgICAgICAgICAgIHF1ZXJ5LnNldEhpbnQoImphdmF4LnBlcnNpc3RlbmNl\nLnF1ZXJ5LnRpbWVvdXQiLCAyMDAwKTsKICAgICAgICAgICAgTGlzdDxFbXBs\nb3llZT4gcSA9IHF1ZXJ5LmdldFJlc3VsdExpc3QoKTsKICAgICAgICAgICAg\nZmFpbCgiVW5leGNwZWN0ZWQgZmluZCBzdWNjZWVkZWQuIFNob3VsZCB0aHJv\ndyBhIFF1ZXJ5TG9ja0V4Y2VwdGlvbi4iKTsKICAgICAgICB9IGNhdGNoIChR\ndWVyeVRpbWVvdXRFeGNlcHRpb24gZSkgeyAgICAgICAgICAgIAogICAgICAg\nICAgICAvLyBUaGlzIGlzIHRoZSBleHBlY3RlZCBleGNlcHRpb24uCi8vICAg\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJDYXVnaHQgIiArIGUuZ2V0\nQ2xhc3MoKS5nZXROYW1lKCkgKyAiOiIgKyBlLmdldE1lc3NhZ2UoKSk7CiAg\nICAgICAgfSBjYXRjaCAoUGVzc2ltaXN0aWNMb2NrRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgLy8gVE9ETzogVGhpcyBpcyB0aGUgZXhwZWN0ZWQgZXhj\nZXB0aW9uIGJ1dCB3aWxsIGJlIGZpeGVkIHVuZGVyIE9QRU5KUEEtOTkxCi8v\nICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJDYXVnaHQgIiArIGUu\nZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAiOiIgKyBlLmdldE1lc3NhZ2UoKSk7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAg\nIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkICIgKyBleC5nZXRDbGFzcygpLmdl\ndE5hbWUoKSArICI6IiArIGV4LmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYoIGVtMS5nZXRUcmFuc2FjdGlvbigp\nLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBlbTEuZ2V0VHJhbnNhY3Rp\nb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICBpZiggZW0yLmdldFRyYW5z\nYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIGVtMi5nZXRU\ncmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgfQogICAgICAgIGVt\nMS5jbG9zZSgpOwogICAgICAgIGVtMi5jbG9zZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

