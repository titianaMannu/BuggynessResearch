{"sha":"396bd22a147c63694574fe66e0fe57304310d2ed","node_id":"MDQ6QmxvYjIwNjM2NDozOTZiZDIyYTE0N2M2MzY5NDU3NGZlNjZlMGZlNTczMDQzMTBkMmVk","size":13966,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/396bd22a147c63694574fe66e0fe57304310d2ed","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS54bWxzdG9yZTsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5BcnJheTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlv\nbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEluLW1lbW9y\neSBmb3JtIG9mIGRhdGEgaW4gZGF0YXN0b3JlIGJhY2tpbmcgYSBzaW5nbGUg\ncGVyc2lzdGVudCBvYmplY3QuCiAqLwpwdWJsaWMgZmluYWwgY2xhc3MgT2Jq\nZWN0RGF0YQogICAgaW1wbGVtZW50cyBDbG9uZWFibGUgewoKICAgIHByaXZh\ndGUgT2JqZWN0IF9vaWQ7CiAgICBwcml2YXRlIE9iamVjdFtdIF9kYXRhOwog\nICAgcHJpdmF0ZSBMb25nIF92ZXJzaW9uOwogICAgcHJpdmF0ZSBDbGFzc01l\ndGFEYXRhIF9tZXRhOwoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBvYmpl\nY3Qgd2l0aG91dCB1bmRlcmx5aW5nIGRhdGEuIEp1c3QgcGFzcyBpbiB0eXBl\nIHNwZWNpZmljCiAgICAgKiBtZXRhZGF0YSBhbmQgdGhlIG9pZC4KICAgICAq\nLwogICAgcHVibGljIE9iamVjdERhdGEoT2JqZWN0IG9pZCwgQ2xhc3NNZXRh\nRGF0YSBtZXRhKSB7CiAgICAgICAgX29pZCA9IG9pZDsKICAgICAgICBfbWV0\nYSA9IG1ldGE7CiAgICAgICAgX2RhdGEgPSBuZXcgT2JqZWN0W21ldGEuZ2V0\nRmllbGRzKCkubGVuZ3RoXTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHRl\nciBmb3Igb2lkLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldElkKCkg\newogICAgICAgIHJldHVybiBfb2lkOwogICAgfQoKICAgIC8qKgogICAgICog\nR2V0IHRoZSBkYXRhIGZvciB0aGUgZmllbGQgd2l0aCB0aGUgZ2l2ZW4gaW5k\nZXguCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0RmllbGQoaW50IG51\nbSkgewogICAgICAgIHJldHVybiBfZGF0YVtudW1dOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBkYXRhIGZvciB0aGUgZmllbGQgd2l0aCB0aGUg\nZ2l2ZW4gaW5kZXguCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEZpZWxk\nKGludCBudW0sIE9iamVjdCB2YWwpIHsKICAgICAgICBfZGF0YVtudW1dID0g\ndmFsOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2ZXJzaW9uIG51\nbWJlciBvZiB0aGUgb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRWZXJzaW9uKExvbmcgdmVyc2lvbikgewogICAgICAgIF92ZXJzaW9uID0g\ndmVyc2lvbjsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgdmVyc2lv\nbiBudW1iZXIgb2YgdGhlIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIExv\nbmcgZ2V0VmVyc2lvbigpIHsKICAgICAgICByZXR1cm4gX3ZlcnNpb247CiAg\nICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG1ldGFkYXRhIGFzc29jaWF0\nZWQgd2l0aCB0aGUgdHlwZSBvZiBwZXJzaXN0ZW50IG9iamVjdCBmb3IKICAg\nICAqIHdoaWNoIHRoaXMgZGF0YSBhcHBsaWVzLgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1\ncm4gX21ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBkYXRh\nIGFuZCB2ZXJzaW9uIGluZm9ybWF0aW9uIGZvciB0aGlzIG9iamVjdCBpbnRv\nIHRoZQogICAgICogZ2l2ZW4gc3RhdGUgbWFuYWdlci4gT25seSBmaWVsZHMg\naW4gdGhlIGdpdmVuIGZldGNoIGNvbmZpZ3VyYXRpb24gYXJlCiAgICAgKiBs\nb2FkZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgaWYgKHNtLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAgICAgICAg\nICBzbS5zZXRWZXJzaW9uKF92ZXJzaW9uKTsKCiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGlmICghc20uZ2V0TG9hZGVkKCkuZ2V0KGkpICYmIGZldGNoLnJlcXVpcmVz\nRmV0Y2goZm1kc1tpXSkgCiAgICAgICAgICAgICAgICAhPSBGZXRjaENvbmZp\nZ3VyYXRpb24uRkVUQ0hfTk9ORSkKICAgICAgICAgICAgICAgIHNtLnN0b3Jl\nKGksIHRvTG9hZGFibGUoc20sIGZtZHNbaV0sIF9kYXRhW2ldLCBmZXRjaCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZGF0YSBhbmQgdmVy\nc2lvbiBpbmZvcm1hdGlvbiBmb3IgdGhpcyBvYmplY3QgaW50byB0aGUKICAg\nICAqIGdpdmVuIHN0YXRlIG1hbmFnZXIuIE9ubHkgZmllbGRzIGluIHRoZSBn\naXZlbiBiaXQgc2V0IHdpbGwgYmUgbG9hZGVkLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBm\naWVsZHMsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgaWYgKHNtLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAgICAgICAg\nICBzbS5zZXRWZXJzaW9uKF92ZXJzaW9uKTsKCiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGlmIChmaWVsZHMuZ2V0KGkpKQogICAgICAgICAgICAgICAgc20uc3RvcmUo\naSwgdG9Mb2FkYWJsZShzbSwgZm1kc1tpXSwgX2RhdGFbaV0sIGZldGNoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzdG9yZWQgdmFs\ndWUgPGNvZGU+dmFsPC9jb2RlPiBpbnRvIGEgdmFsdWUgZm9yIGxvYWRpbmcK\nICAgICAqIGludG8gYSBzdGF0ZSBtYW5hZ2VyLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBPYmplY3QgdG9Mb2FkYWJsZShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kLCBPYmplY3QgdmFs\nLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBpZiAodmFs\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBD\nb2xsZWN0aW9uIGM7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0VHlwZUNvZGUo\nKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgog\nICAgICAgICAgICAgICAgLy8gdGhlIHN0b3JlZCB2YWx1ZSBtdXN0IGJlIGEg\nY29sbGVjdGlvbgogICAgICAgICAgICAgICAgYyA9IChDb2xsZWN0aW9uKSB2\nYWw7CgogICAgICAgICAgICAgICAgLy8gdGhlIHN0YXRlIG1hbmFnZXIgd2ls\nbCBjcmVhdGUgYSBwcm94eSBjb2xsZWN0aW9uIG9mIHRoZQogICAgICAgICAg\nICAgICAgLy8gbmVlZGVkIHR5cGUgZGVwZW5kaW5nIG9uIHRoZSBkZWNsYXJl\nZCB0eXBlIG9mIHRoZSB1c2VyJ3MKICAgICAgICAgICAgICAgIC8vIGZpZWxk\nOyB0aGUgcHJveHkgd2lsbCBwZXJmb3JtIGRpcnR5IHRyYWNraW5nLCBldGMK\nICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gYzIgPSAoQ29sbGVjdGlvbikg\nc20ubmV3RmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CgogICAgICAgICAg\nICAgICAgLy8gcG9wdWxhdGUgdGhlIHByb3h5IGNvbGxlY3Rpb24gd2l0aCBv\ndXIgc3RvcmVkIGRhdGEsCiAgICAgICAgICAgICAgICAvLyBjb252ZXJ0aW5n\nIGl0IHRvIHRoZSByaWdodCB0eXBlIGZyb20gaXRzIHN0b3JlZCBmb3JtCiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgYzIuYWRk\nKHRvTmVzdGVkTG9hZGFibGUoc20sIGZtZC5nZXRFbGVtZW50KCksIGl0ci5u\nZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoKSk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gYzI7CgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIC8vIHRoZSBzdG9yZWQgdmFs\ndWUgbXVzdCBiZSBhIGNvbGxlY3Rpb247IHdlIHB1dCBhcnJheXMgaW50bwog\nICAgICAgICAgICAgICAgLy8gY29sbGVjdGlvbnMgZm9yIHN0b3JhZ2UKICAg\nICAgICAgICAgICAgIGMgPSAoQ29sbGVjdGlvbikgdmFsOwoKICAgICAgICAg\nICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBhcnJheSBvZiB0aGUgcmlnaHQgdHlw\nZTsgdW5saWtlIGNvbGxlY3Rpb25zIGluCiAgICAgICAgICAgICAgICAvLyB0\naGUgY2FzZSBhYm92ZSwgYXJyYXlzIGNhbm5vdCBiZSBwcm94aWVkCiAgICAg\nICAgICAgICAgICBPYmplY3QgYSA9IEFycmF5Lm5ld0luc3RhbmNlKGZtZC5n\nZXRFbGVtZW50KCkuZ2V0VHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGMu\nc2l6ZSgpKTsKCiAgICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSB0aGUgYXJy\nYXkgd2l0aCBvdXIgc3RvcmVkIGRhdGEsIGNvbnZlcnRpbmcgaXQgdG8gdGhl\nCiAgICAgICAgICAgICAgICAvLyByaWdodCB0eXBlIGZyb20gaXRzIHN0b3Jl\nZCBmb3JtCiAgICAgICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOyBpZHgrKykKICAgICAgICAgICAgICAgICAgICBBcnJheS5z\nZXQoYSwgaWR4LCB0b05lc3RlZExvYWRhYmxlKHNtLCBmbWQuZ2V0RWxlbWVu\ndCgpLAogICAgICAgICAgICAgICAgICAgICAgICBpdHIubmV4dCgpLCBmZXRj\naCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGE7CgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAvLyB0aGUgc3Rv\ncmVkIHZhbHVlIG11c3QgYmUgYSBtYXAKICAgICAgICAgICAgICAgIE1hcCBt\nID0gKE1hcCkgdmFsOwoKICAgICAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSBt\nYW5hZ2VyIHdpbGwgY3JlYXRlIGEgcHJveHkgbWFwIG9mIHRoZSBuZWVkZWQK\nICAgICAgICAgICAgICAgIC8vIHR5cGUgZGVwZW5kaW5nIG9uIHRoZSBkZWNs\nYXJlZCB0eXBlIG9mIHRoZSB1c2VyJ3MgZmllbGQ7IHRoZQogICAgICAgICAg\nICAgICAgLy8gcHJveHkgd2lsbCBwZXJmb3JtIGRpcnR5IHRyYWNraW5nLCBl\ndGMKICAgICAgICAgICAgICAgIE1hcCBtMiA9IChNYXApIHNtLm5ld0ZpZWxk\nUHJveHkoZm1kLmdldEluZGV4KCkpOwoKICAgICAgICAgICAgICAgIC8vIHBv\ncHVsYXRlIHRoZSBwcm94eSBtYXAgd2l0aCBvdXIgc3RvcmVkIGRhdGEsIGNv\nbnZlcnRpbmcKICAgICAgICAgICAgICAgIC8vIGl0IHRvIHRoZSByaWdodCB0\neXBlIGZyb20gaXRzIHN0b3JlZCBmb3JtCiAgICAgICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IG0uZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIE1hcC5FbnRyeSBl\nID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAg\nICBtMi5wdXQodG9OZXN0ZWRMb2FkYWJsZShzbSwgZm1kLmdldEtleSgpLCBl\nLmdldEtleSgpLGZldGNoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9O\nZXN0ZWRMb2FkYWJsZShzbSwgZm1kLmdldEVsZW1lbnQoKSwgZS5nZXRWYWx1\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2gpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBtMjsKCiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyBqdXN0IGNv\nbnZlcnQgdGhlIHN0b3JlZCB2YWx1ZSBpbnRvIGl0cyBsb2FkYWJsZSBlcXVp\ndmFsZW50LgogICAgICAgICAgICAgICAgcmV0dXJuIHRvTmVzdGVkTG9hZGFi\nbGUoc20sIGZtZCwgdmFsLCBmZXRjaCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgZ2l2ZW4gc3RvcmVkIHZhbHVlIDxj\nb2RlPnZhbDwvY29kZT4gdG8gYSB2YWx1ZSBmb3IgbG9hZGluZwogICAgICog\naW50byBhIHN0YXRlIG1hbmFnZXIuIFRoZSB2YWx1ZSA8Y29kZT52YWw8L2Nv\nZGU+IG11c3QgYmUgYSBzaW5ndWxhcgogICAgICogdmFsdWU7IGl0IGNhbm5v\ndCBiZSBhIGNvbnRhaW5lci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nT2JqZWN0IHRvTmVzdGVkTG9hZGFibGUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCwgT2JqZWN0IHZhbCwgRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgc3dpdGNo\nICh2bWQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICAvLyBjbG9uZSB0\naGUgZGF0ZSB0byBwcmV2ZW50IGRpcmVjdCBtb2RpZmljYXRpb24gb2Ygb3Vy\nIHN0b3JlZCB2YWx1ZQogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRF\nOgogICAgICAgICAgICAgICAgcmV0dXJuICgoRGF0ZSkgdmFsKS5jbG9uZSgp\nOwoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICAv\nLyBmb3IgcmVsYXRpb25zIHRvIG90aGVyIHBlcnNpc3RlbnQgb2JqZWN0cywg\nd2Ugc3RvcmUgdGhlCiAgICAgICAgICAgICAgICAvLyByZWxhdGVkIG9iamVj\ndCdzIG9pZCAtLSBjb252ZXJ0IGl0IGJhY2sgaW50byBhIHBlcnNpc3RlbnQK\nICAgICAgICAgICAgICAgIC8vIGluc3RhbmNlCiAgICAgICAgICAgICAgICBT\ndG9yZUNvbnRleHQgY3R4ID0gc20uZ2V0Q29udGV4dCgpOwogICAgICAgICAg\nICAgICAgT2JqZWN0IHBjID0gY3R4LmZpbmQodmFsLCBmZXRjaCwgbnVsbCwg\nbnVsbCwgMCk7CiAgICAgICAgICAgICAgICBpZiAocGMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gcGM7CiAgICAgICAgICAgICAgICBP\ncnBoYW5lZEtleUFjdGlvbiBhY3Rpb24gPSBjdHguZ2V0Q29uZmlndXJhdGlv\nbigpLgogICAgICAgICAgICAgICAgICAgIGdldE9ycGhhbmVkS2V5QWN0aW9u\nSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24ub3Jw\naGFuKHZhbCwgc20sIHZtZCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFN0b3JlIHRoZSBkYXRhIGFuZCB2ZXJzaW9uIGluZm9ybWF0\naW9uIGZvciB0aGlzIG9iamVjdCBmcm9tIHRoZQogICAgICogZ2l2ZW4gc3Rh\ndGUgbWFuYWdlci4gT25seSBkaXJ0eSBmaWVsZHMgd2lsbCBiZSBzdG9yZWQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN0b3JlKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20pIHsKICAgICAgICBfdmVyc2lvbiA9IChMb25nKSBzbS5nZXRW\nZXJzaW9uKCk7CgogICAgICAgIC8vIGlmIHRoZSB2ZXJzaW9uIGhhcyBub3Qg\nYmVlbiBzZXQgaW4gdGhlIHN0YXRlIG1hbmFnZXIgKG9ubHkgdHJ1ZQogICAg\nICAgIC8vIHdoZW4gdGhlIG9iamVjdCBpcyBuZXcpLCBzZXQgdGhlIHZlcnNp\nb24gbnVtYmVyIHRvIDAKICAgICAgICBpZiAoX3ZlcnNpb24gPT0gbnVsbCkK\nICAgICAgICAgICAgX3ZlcnNpb24gPSBOdW1iZXJzLnZhbHVlT2YoMEwpOwoK\nICAgICAgICAvLyBydW4gdGhyb3VnaCBlYWNoIHBlcnNpc3RlbnQgZmllbGQg\naW4gdGhlIHN0YXRlIG1hbmFnZXIgYW5kIHN0b3JlIGl0CiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKHNtLmdldERpcnR5KCkuZ2V0KGkpCiAgICAgICAgICAg\nICAgICAmJiBmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRzW2ldLk1B\nTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgX2RhdGFbaV0gPSB0\nb1N0b3JhYmxlKGZtZHNbaV0sIHNtLmZldGNoKGkpLCBzbS5nZXRDb250ZXh0\nKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIGdpdmVuIGZpZWxkIHZhbHVlIDxjb2RlPnZhbDwvY29kZT4gdG8gYSBm\nb3JtIHdlIGNhbiBzdG9yZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nT2JqZWN0IHRvU3RvcmFibGUoRmllbGRNZXRhRGF0YSBmbWQsIE9iamVjdCB2\nYWwsCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIENvbGxlY3Rpb24gYzsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgICAgICBjID0gKENvbGxlY3Rpb24pIHZhbDsKCiAgICAg\nICAgICAgICAgICAvLyBjcmVhdGUgYSBjb2xsZWN0aW9uIHRvIGNvcHkgdGhl\nIGVsZW1lbnRzIGludG8gZm9yIHN0b3JhZ2UsCiAgICAgICAgICAgICAgICAv\nLyBhbmQgcG9wdWxhdGUgaXQgd2l0aCBjb252ZXJ0ZWQgZWxlbWVudCB2YWx1\nZXMKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gYzIgPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAg\nICAgYzIuYWRkKHRvTmVzdGVkU3RvcmFibGUoZm1kLmdldEVsZW1lbnQoKSwg\naXRyLm5leHQoKSwgY3R4KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYzI7\nCgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAg\nICAgICAgIC8vIGNyZWF0ZSBhIGNvbGxlY3Rpb24gdG8gY29weSB0aGUgZWxl\nbWVudHMgaW50byBmb3Igc3RvcmFnZSwKICAgICAgICAgICAgICAgIC8vIGFu\nZCBwb3B1bGF0ZSBpdCB3aXRoIGNvbnZlcnRlZCBlbGVtZW50IHZhbHVlcwog\nICAgICAgICAgICAgICAgYyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBBcnJheS5nZXRMZW5ndGgo\ndmFsKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICAgICAgICAgIGMuYWRk\nKHRvTmVzdGVkU3RvcmFibGUoZm1kLmdldEVsZW1lbnQoKSwgQXJyYXkuZ2V0\nKHZhbCwgaSksCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eCkpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGM7CgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICBNYXAgbSA9IChNYXApIHZhbDsK\nCiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBtYXAgdG8gY29weSB0aGUg\nZW50cmllcyBpbnRvIGZvciBzdG9yYWdlLCBhbmQKICAgICAgICAgICAgICAg\nIC8vIHBvcHVsYXRlIGl0IHdpdGggY29udmVydGVkIGVudHJ5IHZhbHVlcwog\nICAgICAgICAgICAgICAgTWFwIG0yID0gbmV3IEhhc2hNYXAoKTsKICAgICAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbS5lbnRyeVNldCgpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAg\nICAgTWFwLkVudHJ5IGUgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAg\nICAgICAgICAgICAgICAgIG0yLnB1dCh0b05lc3RlZFN0b3JhYmxlKGZtZC5n\nZXRLZXkoKSwgZS5nZXRLZXkoKSwgY3R4KSwKICAgICAgICAgICAgICAgICAg\nICAgICAgdG9OZXN0ZWRTdG9yYWJsZShmbWQuZ2V0RWxlbWVudCgpLCBlLmdl\ndFZhbHVlKCksIGN0eCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgcmV0dXJuIG0yOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIC8vIGp1c3QgY29udmVydCB0aGUgbG9hZGVkIHZhbHVlIGlu\ndG8gaXRzIHN0b3JhYmxlIGVxdWl2YWxlbnQKICAgICAgICAgICAgICAgIHJl\ndHVybiB0b05lc3RlZFN0b3JhYmxlKGZtZCwgdmFsLCBjdHgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIGxv\nYWRlZCB2YWx1ZSA8Y29kZT52YWw8L2NvZGU+IHRvIGEgdmFsdWUgZm9yIHN0\nb3JpbmcuCiAgICAgKiBUaGUgdmFsdWUgPGNvZGU+dmFsPC9jb2RlPiBtdXN0\nIGJlIGEgc2luZ3VsYXIgdmFsdWU7IGl0IGNhbm5vdCBiZSBhCiAgICAgKiBj\nb250YWluZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCB0\nb05lc3RlZFN0b3JhYmxlKFZhbHVlTWV0YURhdGEgdm1kLCBPYmplY3QgdmFs\nLAogICAgICAgIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBpZiAodmFs\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBz\nd2l0Y2ggKHZtZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZGF0\nZSBpcyBhIHByb3h5IChzaW5jZSBEYXRlcyBhcmUgc2Vjb25kIGNsYXNzCiAg\nICAgICAgICAgICAgICAvLyBvYmplY3RzIChTQ09zKSB0aGV5IGNhbiBiZSBw\ncm94aWVkIGZvciBkaXJ0eSB0cmFja2luZywKICAgICAgICAgICAgICAgIC8v\nIGV0YykgdGhlbiBjb3B5IHRoZSB2YWx1ZSBvdXQgb2YgaXQgZm9yIHN0b3Jh\nZ2UKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQcm94eSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChQcm94eSkgdmFsKS5jb3B5\nKHZhbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gKChEYXRlKSB2YWwpLmNs\nb25lKCk7CgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAg\nICAgIHJldHVybiBjdHguZ2V0T2JqZWN0SWQodmFsKTsKCiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5N\nQVA6CiAgICAgICAgICAgICAgICAvLyBuZXN0ZWQgcmVsYXRpb24gdHlwZXMg\nKGUuZy4gY29sbGVjdGlvbnMgb2YgY29sbGVjdGlvbnMpCiAgICAgICAgICAg\nICAgICAvLyBhcmUgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigiVGhpcyBz\ndG9yZSBkb2VzIG5vdCBzdXBwb3J0ICIKICAgICAgICAgICAgICAgICAgICAr\nICJuZXN0ZWQgY29udGFpbmVycyAoZS5nLiBjb2xsZWN0aW9ucyBvZiBjb2xs\nZWN0aW9ucykuIik7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDbG9uZSB0aGlzIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBPYmpl\nY3QgY2xvbmUoKSB7CiAgICAgICAgT2JqZWN0RGF0YSBkYXRhID0gbmV3IE9i\namVjdERhdGEoX29pZCwgX21ldGEpOwogICAgICAgIGRhdGEuc2V0VmVyc2lv\nbihfdmVyc2lvbik7CgogICAgICAgIC8vIGNvcHkgZWFjaCBmaWVsZAogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBfZGF0YVtpXTsKICAgICAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRh\nLnNldEZpZWxkKGksIG51bGwpOwogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5n\nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgZGF0YS5zZXRGaWVsZChpLCBu\nZXcgQXJyYXlMaXN0KChDb2xsZWN0aW9uKSB2YWwpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk1BUDoKICAgICAgICAgICAgICAgICAgICBkYXRhLnNldEZpZWxkKGksIG5l\ndyBIYXNoTWFwKChNYXApIHZhbCkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nICAgICBkYXRhLnNldEZpZWxkKGksIHZhbCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CgogICAgcHVibGlj\nIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgi\nQ2xhc3M6ICgiICsgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSArICIpXG4iKTsKICAgICAgICBidWYuYXBwZW5kKCJPYmplY3QgSWQ6ICgi\nICsgX29pZCArICIpXG4iKTsKICAgICAgICBidWYuYXBwZW5kKCJWZXJzaW9u\nOiAoIiArIF92ZXJzaW9uICsgIilcbiIpOwogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiAgRmllbGQ6ICgiICsgaSArICIpXG4iKTsKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiICBOYW1lOiAoIiArIGZtZHNbaV0uZ2V0TmFt\nZSgpICsgIilcbiIpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgIFZhbHVl\nOiAoIiArIF9kYXRhW2ldICsgIilcbiIpOwoJCX0KCQlyZXR1cm4gYnVmLnRv\nU3RyaW5nICgpOwoJfQp9Cg==\n","encoding":"base64"}

