{"sha":"6f6e80e0083dc6c27a5cee8009b5d45d1ea6aa07","node_id":"MDQ6QmxvYjIwNjM2NDo2ZjZlODBlMDA4M2RjNmMyN2E1Y2VlODAwOWI1ZDQ1ZDFlYTZhYTA3","size":52422,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6f6e80e0083dc6c27a5cee8009b5d45d1ea6aa07","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuaW50ZWdyYXRpb24udmFsaWRh\ndGlvbjsKCmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlF1ZXJ5OwppbXBvcnQgamF2YXgudmFsaWRhdGlvbi5Db25z\ndHJhaW50VmlvbGF0aW9uOwppbXBvcnQgamF2YXgudmFsaWRhdGlvbi5Db25z\ndHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFFbnRpdHlNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFF\nbnRpdHlNYW5hZ2VyRmFjdG9yeVNQSTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5wZXJzaXN0ZW5jZS5PcGVuSlBBUGVyc2lzdGVuY2U7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UudGVzdC5QZXJzaXN0ZW5j\nZVRlc3RDYXNlOwoKLyoqCiAqIFRlc3RzIHRoZSBuZXcgQmVhbiBWYWxpZGF0\naW9uIGNvbnN0cmFpbnQgc3VwcG9ydCBpbiB0aGUgSlBBIDIuMCBzcGVjIGJ5\nCiAqIGZvY3VzaW5nIG9uIHRoZSBmb2xsb3dpbmcgVmFsaWRhdGlvbiBzY2Vu\nYXJpb3M6CiAqICAgICAgCiAqICAgQ2hlY2sgc3BlY2lhbCB1cGRhdGUvZGVs\nZXRlL2lnbm9yZSBjYXNlcyBvbmNlOgogKiAgIDEpICBVcGRhdGUgQE51bGwg\nY29uc3RyYWludCBleGNlcHRpb24gb24gdmFyaWFibGVzIGluIG1vZGU9QVVU\nTwogKiAgICAgICBUZXN0cyB0aGF0IGEgY29uc3RyYWludCB2aW9sYXRpb24g\nd2lsbCBvY2N1ciBvbiBpbnZhbGlkIHVwZGF0ZS4KICogICAyKSAgTm8gaW52\nYWxpZCBEZWxldGUgQE51bGwgY29uc3RyYWludCBleGNlcHRpb24gd2hlbiBt\nb2RlPUFVVE8KICogICAgICAgVGVzdHMgdGhhdCBhIHZpb2xhdGlvbiB3aWxs\nIG5vdCBvY2N1ciB3aGVuIGRlbGV0aW5nIGludmFsaWQgZW50aXR5LgogKiAg\nIDMpICBObyBpbnZhbGlkIFBlcnNpc3QgY29uc3RyYWludCBleGNlcHRpb24g\nd2hlbiBtb2RlPU5PTkUKICogICAgICAgVGVzdHMgdGhhdCBubyBWYWxpZGF0\naW9uIFByb3ZpZGVycyBhcmUgdXNlZCB3aGVuIGRpc2FibGVkLgogKiAgIAog\nKiAgIEJhc2ljIGNvbnN0cmFpbnQgdGVzdHMgZm9yIHZpb2xhdGlvbiBleGNl\ncHRpb25zOgogKiAgIDQpICBQZXJzaXN0IEBOdWxsIGNvbnN0cmFpbnQgZXhj\nZXB0aW9uIG9uIHZhcmlhYmxlcyBpbiBtb2RlPUFVVE8KICogICA1KSAgUGVy\nc2lzdCBATm90TnVsbCBjb25zdHJhaW50IGV4Y2VwdGlvbiBvbiBnZXR0ZXIg\naW4gbW9kZT1BVVRPCiAqICAgNykgIFRlc3QgQEFzc2VydFRydWUgY29uc3Ry\nYWludCBleGNlcHRpb24gb24gdmFyaWFibGVzIGluIG1vZGU9QVVUTwogKiAg\nIDgpICBUZXN0IEBBc3NlcnRGYWxzZSBjb25zdHJhaW50IGV4Y2VwdGlvbiBv\nbiBnZXR0ZXIgaW4gbW9kZT1BVVRPCiAqICAgMTApIFRlc3QgQERlY2ltYWxN\naW4gY29uc3RyYWludCBleGNlcHRpb24gb24gdmFyaWFibGVzIGluIG1vZGU9\nQVVUTwogKiAgIDExKSBUZXN0IEBEZWNpbWFsTWF4IGNvbnN0cmFpbnQgZXhj\nZXB0aW9uIG9uIGdldHRlciBpbiBtb2RlPUFVVE8KICogICAxMykgVGVzdCBA\nTWluIGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIHZhcmlhYmxlcyBpbiBtb2Rl\nPUFVVE8KICogICAxNCkgVGVzdCBATWF4IGNvbnN0cmFpbnQgZXhjZXB0aW9u\nIG9uIGdldHRlciBpbiBtb2RlPUFVVE8KICogICAxNikgVGVzdCBARGlnaXRz\nIGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIHZhcmlhYmxlcyBpbiBtb2RlPUFV\nVE8KICogICAxNykgVGVzdCBARGlnaXRzIGNvbnN0cmFpbnQgZXhjZXB0aW9u\nIG9uIGdldHRlciBpbiBtb2RlPUFVVE8KICogICAxOSkgVGVzdCBAU2l6ZSBj\nb25zdHJhaW50IGV4Y2VwdGlvbiBvbiB2YXJpYWJsZXMgaW4gbW9kZT1BVVRP\nCiAqICAgMjApIFRlc3QgQFNpemUgY29uc3RyYWludCBleGNlcHRpb24gb24g\nZ2V0dGVyIGluIG1vZGU9QVVUTwogKiAgIDIyKSBUZXN0IEBGdXR1cmUgY29u\nc3RyYWludCBleGNlcHRpb24gb24gdmFyaWFibGVzIGluIG1vZGU9QVVUTwog\nKiAgIDIzKSBUZXN0IEBQYXN0IGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIGdl\ndHRlciBpbiBtb2RlPUFVVE8KICogICAyNSkgVGVzdCBAUGF0dGVybiBjb25z\ndHJhaW50IGV4Y2VwdGlvbiBvbiB2YXJpYWJsZXMgaW4gbW9kZT1BVVRPCiAq\nICAgMjYpIFRlc3QgQFBhdHRlcm4gY29uc3RyYWludCBleGNlcHRpb24gb24g\nZ2V0dGVyIGluIG1vZGU9QVVUTwogKiAgIDI4KSBUZXN0IEBWYWxpZCBjb25z\ndHJhaW50IGV4Y2VwdGlvbnMgaW4gbW9kZT1BVVRPCiAqICAgCiAqICAgQmFz\naWMgY29uc3RyYWludCB0ZXN0IGZvciBubyB2aW9sYXRpb25zOgogKiAgIDYp\nICBQZXJzaXN0IEBOb3ROdWxsIGFuZCBATnVsbCBjb25zdHJhaW50cyBwYXNz\nIGluIG1vZGU9QVVUTwogKiAgIDkpICBUZXN0IEBBc3NlcnRGYWxzZSBhbmQg\nQEFzc2VydFRydWUgY29uc3RyYWludHMgcGFzcyBpbiBtb2RlPUFVVE8KICog\nICAxMikgVGVzdCBARGVjaW1hbE1pbiBhbmQgQERlY2ltYWxNYXggY29uc3Ry\nYWludHMgcGFzcyBpbiBtb2RlPUFVVE8KICogICAxNSkgVGVzdCBATWluIGFu\nZCBATWF4IGNvbnN0cmFpbnRzIHBhc3MgaW4gbW9kZT1BVVRPCiAqICAgMTgp\nIFRlc3QgQERpZ2l0cyBjb25zdHJhaW50cyBwYXNzIGluIG1vZGU9QVVUTwog\nKiAgIDIxKSBUZXN0IEBTaXplIGNvbnN0cmFpbnRzIHBhc3MgaW4gbW9kZT1B\nVVRPCiAqICAgMjQpIFRlc3QgQFBhc3QgYW5kIEBGdXR1cmUgY29uc3RyYWlu\ndHMgcGFzcyBpbiBtb2RlPUFVVE8KICogICAyNykgVGVzdCBAUGF0dGVybiBj\nb25zdHJhaW50cyBwYXNzIGluIG1vZGU9QVVUTwogKiAgIDI5KSBUZXN0IEBW\nYWxpZCBjb25zdHJhaW50cyBwYXNzIGluIG1vZGU9QVVUTwogKgogKiBAdmVy\nc2lvbiAkUmV2JCAkRGF0ZSQKICovCnB1YmxpYyBjbGFzcyBUZXN0Q29uc3Ry\nYWludHMgZXh0ZW5kcyBQZXJzaXN0ZW5jZVRlc3RDYXNlIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnlTUEkgZW1m\nID0gbnVsbDsKICAgIAogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBz\nZXRVcCgpIHsKICAgICAgICAKICAgICAgICBlbWYgPSAoT3BlbkpQQUVudGl0\neU1hbmFnZXJGYWN0b3J5U1BJKSAKICAgICAgICBPcGVuSlBBUGVyc2lzdGVu\nY2UuY3JlYXRlRW50aXR5TWFuYWdlckZhY3RvcnkoCiAgICAgICAgICAgICAg\nICAiQ29uc3RyYWludFBVIiwKICAgICAgICAgICAgICAgICJvcmcvYXBhY2hl\nL29wZW5qcGEvaW50ZWdyYXRpb24vdmFsaWRhdGlvbi9wZXJzaXN0ZW5jZS54\nbWwiKTsKICAgIH0KICAgIAogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCB0ZWFyRG93bigpIHsKICAgICAgICBpZiAoZW1mICE9IG51bGwpIHsKICAg\nICAgICAgICAgY2xlYW51cChlbWYpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDoKICAgICAqICAgMSkg\nVXBkYXRlIEBOdWxsIGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIHZhcmlhYmxl\ncyBpbiBtb2RlPUFVVE8KICAgICAqICAgICAgVGVzdHMgdGhhdCBhIGNvbnN0\ncmFpbnQgdmlvbGF0aW9uIHdpbGwgb2NjdXIgb24gaW52YWxpZCB1cGRhdGUu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3ROdWxsVXBkYXRlQ29uc3Ry\nYWludCgpIHsKICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdE51bGxVcGRh\ndGVDb25zdHJhaW50KCkgc3RhcnRlZCIpOwogICAgICAgIAogICAgICAgIGxv\nbmcgaWQgPSAwOwogICAgICAgIC8vIFBhcnQgMSAtIENyZWF0ZSBhbmQgcGVy\nc2lzdCBhIHZhbGlkIGVudGl0eQogICAgICAgIC8vIGNyZWF0ZSBFTSBmcm9t\nIGRlZmF1bHQgRU1GCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0g\nPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIGFzc2VydE5v\ndE51bGwoZW0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHZlcmlm\neSBWYWxpZGF0aW9uIE1vZGUKICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24gY29uZiA9IGVtLmdldENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAg\nICAgYXNzZXJ0Tm90TnVsbChjb25mKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1\nZSgiVmFsaWRhdGlvbk1vZGUiLAogICAgICAgICAgICAgICAgY29uZi5nZXRW\nYWxpZGF0aW9uTW9kZSgpLmVxdWFsc0lnbm9yZUNhc2UoIkFVVE8iKSk7CiAg\nICAgICAgICAgIC8vIGNyZWF0ZSB2YWxpZCBDb25zdHJhaW50TnVsbCBpbnN0\nYW5jZQogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7\nCiAgICAgICAgICAgIENvbnN0cmFpbnROdWxsIGMgPSBDb25zdHJhaW50TnVs\nbC5jcmVhdGVWYWxpZCgpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGMpOwog\nICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAg\nICAgICAgICBpZCA9IGMuZ2V0SWQoKTsKICAgICAgICAgICAgZ2V0TG9nKCku\ndHJhY2UoInRlc3ROdWxsVXBkYXRlQ29uc3RyYWludCgpIFBhcnQgMSBvZiAy\nIHBhc3NlZCIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIC8vIHVuZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCku\ndHJhY2UoInRlc3ROdWxsVXBkYXRlQ29uc3RyYWludCgpIFBhcnQgMSBvZiAy\nIGZhaWxlZCIpOwogICAgICAgICAgICBmYWlsKCJDYXVnaHQgdW5leHBlY3Rl\nZCBleGNlcHRpb24gPSAiICsgZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKChlbSAhPSBudWxsKSAmJiBlbS5pc09wZW4oKSkgewog\nICAgICAgICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCkuaXNBY3Rp\ndmUoKSkKICAgICAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigp\nLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFBhcnQg\nMiAtIFZlcmlmeSB0aGF0IGludmFsaWQgcHJvcGVydGllcyBhcmUgY2F1Z2h0\nIG9uIGFuIHVwZGF0ZQogICAgICAgIC8vIGNyZWF0ZSBFTSBmcm9tIGRlZmF1\nbHQgRU1GCiAgICAgICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOwogICAgICAgIGFzc2VydE5vdE51bGwoZW0pOyAgICAgICAgCiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gdXBkYXRlIGVudGl0eSB0byBiZSBpbnZh\nbGlkCiAgICAgICAgICAgIENvbnN0cmFpbnROdWxsIGMgPSBlbS5maW5kKENv\nbnN0cmFpbnROdWxsLmNsYXNzLCBpZCk7CiAgICAgICAgICAgIGVtLmdldFRy\nYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgYy5zZXROdWxsUmVx\ndWlyZWQobmV3IFN0cmluZygibm90IG51bGwiKSk7CiAgICAgICAgICAgIGVt\nLmZsdXNoKCk7CiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29t\nbWl0KCk7ICAgICAgICAgICAgCiAgICAgICAgICAgIGdldExvZygpLnRyYWNl\nKCJ0ZXN0TnVsbFVwZGF0ZUNvbnN0cmFpbnQoKSBQYXJ0IDIgb2YgMiBmYWls\nZWQiKTsKICAgICAgICAgICAgZmFpbCgiRXhwZWN0ZWQgYSBDb25zdHJhaW50\nVmlvbGF0aW9uRXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoQ29uc3Ry\nYWludFZpb2xhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGV4\ncGVjdGVkCiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJDYXVnaHQgZXhw\nZWN0ZWQgQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiA9ICIgKyBlKTsK\nICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3ROdWxsVXBkYXRlQ29u\nc3RyYWludCgpIFBhcnQgMiBvZiAyIHBhc3NlZCIpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNP\ncGVuKCkpIHsKICAgICAgICAgICAgICAgIGlmIChlbS5nZXRUcmFuc2FjdGlv\nbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgZW0uY2xv\nc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDoKICAgICAqICAgMikgTm8g\naW52YWxpZCBEZWxldGUgQE51bGwgY29uc3RyYWludCBleGNlcHRpb24gd2hl\nbiBtb2RlPUFVVE8KICAgICAqICAgICAgVGVzdHMgdGhhdCBhIHZpb2xhdGlv\nbiB3aWxsIG5vdCBvY2N1ciB3aGVuIGRlbGV0aW5nIGludmFsaWQgZW50aXR5\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0TnVsbERlbGV0ZUlnbm9y\nZWQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3ROdWxsRGVsZXRl\nSWdub3JlZCgpIHN0YXJ0ZWQiKTsKICAgICAgICAKICAgICAgICAvLyBQYXJ0\nIDEgLSBDcmVhdGUgYW4gaW52YWxpZCBlbnRpdHkKICAgICAgICAvLyBjcmVh\ndGUgb3VyIEVNRiB3LyBwcm9wcwogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5h\nZ2VyRmFjdG9yeVNQSSBlbWYgPSAoT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0\nb3J5U1BJKQogICAgICAgIE9wZW5KUEFQZXJzaXN0ZW5jZS5jcmVhdGVFbnRp\ndHlNYW5hZ2VyRmFjdG9yeSgKICAgICAgICAgICAgICAgICJudWxsLW5vbmUt\nbW9kZSIsCiAgICAgICAgICAgICAgICAib3JnL2FwYWNoZS9vcGVuanBhL2lu\ndGVncmF0aW9uL3ZhbGlkYXRpb24vcGVyc2lzdGVuY2UueG1sIik7CiAgICAg\nICAgYXNzZXJ0Tm90TnVsbChlbWYpOwogICAgICAgIC8vIGNyZWF0ZSBFTQog\nICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBN\nb2RlCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBl\nbS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51\nbGwoY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25N\nb2RlIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUo\nKS5lcXVhbHNJZ25vcmVDYXNlKCJOT05FIikpOwogICAgICAgICAgICAvLyBj\ncmVhdGUgaW52YWxpZCBDb25zdHJhaW50TnVsbCBpbnN0YW5jZQogICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAg\nIENvbnN0cmFpbnROdWxsIGMgPSBDb25zdHJhaW50TnVsbC5jcmVhdGVJbnZh\nbGlkTnVsbCgpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGMpOwogICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAg\nICBnZXRMb2coKS50cmFjZSgidGVzdE51bGxEZWxldGVJZ25vcmVkKCkgUGFy\ndCAxIG9mIDIgcGFzc2VkIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgLy8gdW5leHBlY3RlZAogICAgICAgICAgICBn\nZXRMb2coKS50cmFjZSgidGVzdE51bGxEZWxldGVJZ25vcmVkKCkgUGFydCAx\nIG9mIDIgZmFpbGVkIik7CiAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1bmV4\ncGVjdGVkIGV4Y2VwdGlvbiA9ICIgKyBlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2\nZSgpKSB7CiAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLnJv\nbGxiYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYW51cChl\nbWYpOwogICAgICAgIH0KCiAgICAgICAgLy8gUGFydCAyIC0gVmVyaWZ5IGRl\nbGV0ZSB1c2luZyBkZWZhdWx0IGdyb3VwIGRvZXMgbm90IGNhdXNlIFZhbGlk\nYXRpb24KICAgICAgICAvLyBjcmVhdGUgb3VyIEVNRiB3LyB2YWxpZGF0aW9u\nIG1vZGU9Q0FMTEJBQ0sKICAgICAgICBlbWYgPSAoT3BlbkpQQUVudGl0eU1h\nbmFnZXJGYWN0b3J5U1BJKU9wZW5KUEFQZXJzaXN0ZW5jZQogICAgICAgICAg\nICAuY3JlYXRlRW50aXR5TWFuYWdlckZhY3RvcnkoCiAgICAgICAgICAgICAg\nICAibnVsbC1jYWxsYmFjay1tb2RlIiwKICAgICAgICAgICAgICAgICJvcmcv\nYXBhY2hlL29wZW5qcGEvaW50ZWdyYXRpb24vdmFsaWRhdGlvbi9wZXJzaXN0\nZW5jZS54bWwiKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtZik7CiAgICAg\nICAgLy8gY3JlYXRlIEVNCiAgICAgICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5\nTWFuYWdlcigpOwogICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIHZlcmlmeSBWYWxpZGF0aW9uIE1vZGUK\nICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGVtLmdl\ndENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChj\nb25mKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmFsaWRhdGlvbk1vZGUi\nLAogICAgICAgICAgICAgICAgY29uZi5nZXRWYWxpZGF0aW9uTW9kZSgpLmVx\ndWFsc0lnbm9yZUNhc2UoIkNBTExCQUNLIikpOwogICAgICAgICAgICAvLyBn\nZXQgdGhlIGludmFsaWQgZW50aXR5IHRvIGRlbGV0ZQogICAgICAgICAgICBR\ndWVyeSBxID0gZW0uY3JlYXRlUXVlcnkoIkRFTEVURSBGUk9NIFZOVUxMIGMg\nV0hFUkUgYy5pZCA9IDEiKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rp\nb24oKS5iZWdpbigpOwogICAgICAgICAgICBpbnQgY291bnQgPSBxLmV4ZWN1\ndGVVcGRhdGUoKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5j\nb21taXQoKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3ROdWxs\nRGVsZXRlSWdub3JlZCgpIFBhcnQgMiBvZiAyIHBhc3NlZCIpOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIHVuZXhw\nZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3ROdWxsRGVs\nZXRlSWdub3JlZCgpIFBhcnQgMiBvZiAyIGZhaWxlZCIpOwogICAgICAgICAg\nICBmYWlsKCJDYXVnaHQgdW5leHBlY3RlZCBleGNlcHRpb24gPSAiICsgZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGVtLmdldFRy\nYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkgewogICAgICAgICAgICAgICAgZW0u\nZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGNsZWFudXAoZW1mKTsKICAgICAgICB9CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgogICAgICog\nICAzKSBObyBpbnZhbGlkIFBlcnNpc3QgY29uc3RyYWludCBleGNlcHRpb24g\nd2hlbiBtb2RlPU5PTkUKICAgICAqICAgICAgVGVzdHMgdGhhdCBubyBWYWxp\nZGF0aW9uIFByb3ZpZGVycyBhcmUgdXNlZCB3aGVuIGRpc2FibGVkLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0TnVsbENvbnN0cmFpbnRJZ25vcmVk\nKCkgewogICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0TnVsbENvbnN0cmFp\nbnRJZ25vcmVkKCkgc3RhcnRlZCIpOwogICAgICAgIC8vIGNyZWF0ZSBvdXIg\nRU1GIHcvIHByb3BzCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0\nb3J5U1BJIGVtZiA9IChPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnlTUEkp\nCiAgICAgICAgICAgIE9wZW5KUEFQZXJzaXN0ZW5jZS5jcmVhdGVFbnRpdHlN\nYW5hZ2VyRmFjdG9yeSgKICAgICAgICAgICAgICAgICJudWxsLW5vbmUtbW9k\nZSIsCiAgICAgICAgICAgICAgICAib3JnL2FwYWNoZS9vcGVuanBhL2ludGVn\ncmF0aW9uL3ZhbGlkYXRpb24vcGVyc2lzdGVuY2UueG1sIik7CiAgICAgICAg\nYXNzZXJ0Tm90TnVsbChlbWYpOwogICAgICAgIC8vIGNyZWF0ZSBFTQogICAg\nICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2Rl\nCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5n\nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwo\nY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2Rl\nIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5l\ncXVhbHNJZ25vcmVDYXNlKCJOT05FIikpOwogICAgICAgICAgICAvLyBjcmVh\ndGUgaW52YWxpZCBDb25zdHJhaW50TnVsbCBpbnN0YW5jZQogICAgICAgICAg\nICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIENv\nbnN0cmFpbnROdWxsIGMgPSBDb25zdHJhaW50TnVsbC5jcmVhdGVJbnZhbGlk\nTnVsbCgpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGMpOwogICAgICAgICAg\nICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAgICBn\nZXRMb2coKS50cmFjZSgidGVzdE51bGxDb25zdHJhaW50SWdub3JlZCgpIHBh\nc3NlZCIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIC8vIHVuZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJh\nY2UoInRlc3ROdWxsQ29uc3RyYWludElnbm9yZWQoKSBmYWlsZWQiKTsKICAg\nICAgICAgICAgZmFpbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgZXhjZXB0aW9uID0g\nIiArIGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChl\nbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpIHsKICAgICAgICAgICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBjbGVhbnVwKGVtZik7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgogICAg\nICogICA0KSBUZXN0IEBOdWxsIGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIHZh\ncmlhYmxlcyBpbiBtb2RlPUFVVE8KICAgICAqICAgICAgQmFzaWMgY29uc3Ry\nYWludCB0ZXN0IGZvciBhIHZpb2xhdGlvbiBleGNlcHRpb24uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHRlc3ROdWxsQ29uc3RyYWludCgpIHsKICAgICAg\nICBnZXRMb2coKS50cmFjZSgidGVzdE51bGxDb25zdHJhaW50KCkgc3RhcnRl\nZCIpOwogICAgICAgIC8vIGNyZWF0ZSBFTSBmcm9tIGRlZmF1bHQgRU1GCiAg\nICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50\naXR5TWFuYWdlcigpOwogICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHZlcmlmeSBWYWxpZGF0aW9uIE1v\nZGUKICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGVt\nLmdldENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVs\nbChjb25mKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmFsaWRhdGlvbk1v\nZGUiLAogICAgICAgICAgICAgICAgY29uZi5nZXRWYWxpZGF0aW9uTW9kZSgp\nLmVxdWFsc0lnbm9yZUNhc2UoIkFVVE8iKSk7CiAgICAgICAgICAgIC8vIGNy\nZWF0ZSBpbnZhbGlkIENvbnN0cmFpbnROdWxsIGluc3RhbmNlCiAgICAgICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAg\nQ29uc3RyYWludE51bGwgYyA9IENvbnN0cmFpbnROdWxsLmNyZWF0ZUludmFs\naWROdWxsKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAgICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAg\nIGdldExvZygpLnRyYWNlKCJ0ZXN0TnVsbENvbnN0cmFpbnQoKSBmYWlsZWQi\nKTsKICAgICAgICAgICAgZmFpbCgiRXhwZWN0ZWQgYSBDb25zdHJhaW50Vmlv\nbGF0aW9uRXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoQ29uc3RyYWlu\ndFZpb2xhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGV4cGVj\ndGVkCiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJDYXVnaHQgZXhwZWN0\nZWQgQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiA9ICIgKyBlKTsKICAg\nICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3ROdWxsQ29uc3RyYWludCgp\nIHBhc3NlZCIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlm\nICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChlbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAg\nICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygp\nOwogICAgICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5n\nIHRlc3RlZDoKICAgICAqICAgNSkgVGVzdCBATm90TnVsbCBjb25zdHJhaW50\nIGV4Y2VwdGlvbiBvbiBnZXR0ZXIgaW4gbW9kZT1BVVRPCiAgICAgKiAgICAg\nIEJhc2ljIGNvbnN0cmFpbnQgdGVzdCBmb3IgYSB2aW9sYXRpb24gZXhjZXB0\naW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0Tm90TnVsbENvbnN0\ncmFpbnQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3ROb3ROdWxs\nQ29uc3RyYWludCgpIHN0YXJ0ZWQiKTsKICAgICAgICAvLyBjcmVhdGUgRU0g\nZnJvbSBkZWZhdWx0IEVNRgogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2Vy\nIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBhc3Nl\ncnROb3ROdWxsKGVtKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB2\nZXJpZnkgVmFsaWRhdGlvbiBNb2RlCiAgICAgICAgICAgIE9wZW5KUEFDb25m\naWd1cmF0aW9uIGNvbmYgPSBlbS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAg\nICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7CiAgICAgICAgICAgIGFzc2Vy\ndFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAgICAgICAgICAgICAgIGNvbmYu\nZ2V0VmFsaWRhdGlvbk1vZGUoKS5lcXVhbHNJZ25vcmVDYXNlKCJBVVRPIikp\nOwogICAgICAgICAgICAvLyBjcmVhdGUgaW52YWxpZCBDb25zdHJhaW50TnVs\nbCBpbnN0YW5jZQogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJl\nZ2luKCk7CiAgICAgICAgICAgIENvbnN0cmFpbnROdWxsIGMgPSBDb25zdHJh\naW50TnVsbC5jcmVhdGVJbnZhbGlkTm90TnVsbCgpOwogICAgICAgICAgICBl\nbS5wZXJzaXN0KGMpOwogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigp\nLmNvbW1pdCgpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdE5v\ndE51bGxDb25zdHJhaW50KCkgZmFpbGVkIik7CiAgICAgICAgICAgIGZhaWwo\nIkV4cGVjdGVkIGEgQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiIpOwog\nICAgICAgIH0gY2F0Y2ggKENvbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAvLyBleHBlY3RlZAogICAgICAgICAgICBnZXRM\nb2coKS50cmFjZSgiQ2F1Z2h0IGV4cGVjdGVkIENvbnN0cmFpbnRWaW9sYXRp\nb25FeGNlcHRpb24gPSAiICsgZSk7CiAgICAgICAgICAgIGdldExvZygpLnRy\nYWNlKCJ0ZXN0Tm90TnVsbENvbnN0cmFpbnQoKSBwYXNzZWQiKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoKGVtICE9IG51bGwpICYm\nIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAgICBpZiAoZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgICAg\nIGVtLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTY2VuYXJpbyBiZWluZyB0ZXN0ZWQ6CiAgICAgKiAg\nIDYpIFRlc3QgQE5vdE51bGwgYW5kIEBOdWxsIGNvbnN0cmFpbnRzIHBhc3Mg\naW4gbW9kZT1BVVRPCiAgICAgKiAgICAgIEJhc2ljIGNvbnN0cmFpbnQgdGVz\ndCBmb3Igbm8gdmlvbGF0aW9ucy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\ndGVzdE51bGxOb3ROdWxsQ29uc3RyYWludCgpIHsKICAgICAgICBnZXRMb2co\nKS50cmFjZSgidGVzdE51bGxOb3ROdWxsQ29uc3RyYWludCgpIHN0YXJ0ZWQi\nKTsKICAgICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgogICAg\nICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2Rl\nCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5n\nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwo\nY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2Rl\nIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5l\ncXVhbHNJZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBjcmVh\ndGUgaW52YWxpZCBDb25zdHJhaW50TnVsbCBpbnN0YW5jZQogICAgICAgICAg\nICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIENv\nbnN0cmFpbnROdWxsIGMgPSBDb25zdHJhaW50TnVsbC5jcmVhdGVWYWxpZCgp\nOwogICAgICAgICAgICBlbS5wZXJzaXN0KGMpOwogICAgICAgICAgICBlbS5n\nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAgICBnZXRMb2co\nKS50cmFjZSgidGVzdE51bGxOb3ROdWxsQ29uc3RyYWludCgpIHBhc3NlZCIp\nOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIC8vIHVuZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRl\nc3ROdWxsTm90TnVsbENvbnN0cmFpbnQoKSBmYWlsZWQiKTsKICAgICAgICAg\nICAgZmFpbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgZXhjZXB0aW9uID0gIiArIGUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICgoZW0gIT0g\nbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAgICAgIGlmIChl\nbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAg\nICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAg\nICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDoK\nICAgICAqICAgNykgVGVzdCBAQXNzZXJ0VHJ1ZSBjb25zdHJhaW50IGV4Y2Vw\ndGlvbiBvbiB2YXJpYWJsZXMgaW4gbW9kZT1BVVRPCiAgICAgKiAgICAgIEJh\nc2ljIGNvbnN0cmFpbnQgdGVzdCBmb3IgYSB2aW9sYXRpb24gZXhjZXB0aW9u\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0QXNzZXJ0VHJ1ZUNvbnN0\ncmFpbnQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RBc3NlcnRU\ncnVlQ29uc3RyYWludCgpIHN0YXJ0ZWQiKTsKICAgICAgICAvLyBjcmVhdGUg\nRU0gZnJvbSBkZWZhdWx0IEVNRgogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5h\nZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBh\nc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2RlCiAgICAgICAgICAgIE9wZW5KUEFD\nb25maWd1cmF0aW9uIGNvbmYgPSBlbS5nZXRDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7CiAgICAgICAgICAgIGFz\nc2VydFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAgICAgICAgICAgICAgIGNv\nbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5lcXVhbHNJZ25vcmVDYXNlKCJBVVRP\nIikpOwogICAgICAgICAgICAvLyBjcmVhdGUgaW52YWxpZCBDb25zdHJhaW50\nQm9vbGVhbiBpbnN0YW5jZQogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CiAgICAgICAgICAgIENvbnN0cmFpbnRCb29sZWFuIGMg\nPSBDb25zdHJhaW50Qm9vbGVhbi5jcmVhdGVJbnZhbGlkVHJ1ZSgpOwogICAg\nICAgICAgICBlbS5wZXJzaXN0KGMpOwogICAgICAgICAgICBlbS5nZXRUcmFu\nc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAgICBnZXRMb2coKS50cmFj\nZSgidGVzdEFzc2VydFRydWVDb25zdHJhaW50KCkgZmFpbGVkIik7CiAgICAg\nICAgICAgIGZhaWwoIkV4cGVjdGVkIGEgQ29uc3RyYWludFZpb2xhdGlvbkV4\nY2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKENvbnN0cmFpbnRWaW9sYXRp\nb25FeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBleHBlY3RlZAogICAg\nICAgICAgICBnZXRMb2coKS50cmFjZSgiQ2F1Z2h0IGV4cGVjdGVkIENvbnN0\ncmFpbnRWaW9sYXRpb25FeGNlcHRpb24gPSAiICsgZSk7CiAgICAgICAgICAg\nIGdldExvZygpLnRyYWNlKCJ0ZXN0QXNzZXJ0VHJ1ZUNvbnN0cmFpbnQoKSBw\nYXNzZWQiKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nKGVtICE9IG51bGwpICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAg\nICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsK\nICAgICAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTY2VuYXJpbyBiZWluZyB0\nZXN0ZWQ6CiAgICAgKiAgIDgpIFRlc3QgQEFzc2VydEZhbHNlIGNvbnN0cmFp\nbnQgZXhjZXB0aW9uIG9uIGdldHRlciBpbiBtb2RlPUFVVE8KICAgICAqICAg\nICAgQmFzaWMgY29uc3RyYWludCB0ZXN0IGZvciBhIHZpb2xhdGlvbiBleGNl\ncHRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RBc3NlcnRGYWxz\nZUNvbnN0cmFpbnQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RB\nc3NlcnRGYWxzZUNvbnN0cmFpbnQoKSBzdGFydGVkIik7CiAgICAgICAgLy8g\nY3JlYXRlIEVNIGZyb20gZGVmYXVsdCBFTUYKICAgICAgICBPcGVuSlBBRW50\naXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAg\nICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gdmVyaWZ5IFZhbGlkYXRpb24gTW9kZQogICAgICAgICAgICBP\ncGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0gZW0uZ2V0Q29uZmlndXJhdGlv\nbigpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGNvbmYpOwogICAgICAg\nICAgICBhc3NlcnRUcnVlKCJWYWxpZGF0aW9uTW9kZSIsCiAgICAgICAgICAg\nICAgICBjb25mLmdldFZhbGlkYXRpb25Nb2RlKCkuZXF1YWxzSWdub3JlQ2Fz\nZSgiQVVUTyIpKTsKICAgICAgICAgICAgLy8gY3JlYXRlIGludmFsaWQgQ29u\nc3RyYWludEJvb2xlYW4gaW5zdGFuY2UKICAgICAgICAgICAgZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBDb25zdHJhaW50Qm9v\nbGVhbiBjID0gQ29uc3RyYWludEJvb2xlYW4uY3JlYXRlSW52YWxpZEZhbHNl\nKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAgICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgIGdldExv\nZygpLnRyYWNlKCJ0ZXN0QXNzZXJ0RmFsc2VDb25zdHJhaW50KCkgZmFpbGVk\nIik7CiAgICAgICAgICAgIGZhaWwoIkV4cGVjdGVkIGEgQ29uc3RyYWludFZp\nb2xhdGlvbkV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKENvbnN0cmFp\nbnRWaW9sYXRpb25FeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBleHBl\nY3RlZAogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgiQ2F1Z2h0IGV4cGVj\ndGVkIENvbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24gPSAiICsgZSk7CiAg\nICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0QXNzZXJ0RmFsc2VDb25z\ndHJhaW50KCkgcGFzc2VkIik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgaWYgKChlbSAhPSBudWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAg\nICAgICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUo\nKSkKICAgICAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLnJv\nbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2NlbmFy\naW8gYmVpbmcgdGVzdGVkOgogICAgICogICA5KSBUZXN0IEBBc3NlcnRGYWxz\nZSBhbmQgQEFzc2VydFRydWUgY29uc3RyYWludHMgcGFzcyBpbiBtb2RlPUFV\nVE8KICAgICAqICAgICAgQmFzaWMgY29uc3RyYWludCB0ZXN0IGZvciBubyB2\naW9sYXRpb25zLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0QXNzZXJ0\nVHJ1ZUZhbHNlQ29uc3RyYWludCgpIHsKICAgICAgICBnZXRMb2coKS50cmFj\nZSgidGVzdEFzc2VydFRydWVGYWxzZUNvbnN0cmFpbnQoKSBzdGFydGVkIik7\nCiAgICAgICAgLy8gY3JlYXRlIEVNIGZyb20gZGVmYXVsdCBFTUYKICAgICAg\nICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlN\nYW5hZ2VyKCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gdmVyaWZ5IFZhbGlkYXRpb24gTW9kZQog\nICAgICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0gZW0uZ2V0\nQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGNv\nbmYpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWYWxpZGF0aW9uTW9kZSIs\nCiAgICAgICAgICAgICAgICBjb25mLmdldFZhbGlkYXRpb25Nb2RlKCkuZXF1\nYWxzSWdub3JlQ2FzZSgiQVVUTyIpKTsKICAgICAgICAgICAgLy8gY3JlYXRl\nIHZhbGlkIENvbnN0cmFpbnRCb29sZWFuIGluc3RhbmNlCiAgICAgICAgICAg\nIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgQ29u\nc3RyYWludEJvb2xlYW4gYyA9IENvbnN0cmFpbnRCb29sZWFuLmNyZWF0ZVZh\nbGlkKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAgICAgICAg\nIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgIGdl\ndExvZygpLnRyYWNlKCJ0ZXN0QXNzZXJ0VHJ1ZUZhbHNlQ29uc3RyYWludCgp\nIHBhc3NlZCIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIC8vIHVuZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCku\ndHJhY2UoInRlc3RBc3NlcnRUcnVlRmFsc2VDb25zdHJhaW50KCkgZmFpbGVk\nIik7CiAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkIGV4Y2Vw\ndGlvbiA9ICIgKyBlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAoKGVtICE9IG51bGwpICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAg\nICAgICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQog\nICAgICAgICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJh\nY2soKTsKICAgICAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTY2VuYXJpbyBi\nZWluZyB0ZXN0ZWQ6CiAgICAgKiAgIDEwKSBUZXN0IEBEZWNpbWFsTWluIGNv\nbnN0cmFpbnQgZXhjZXB0aW9uIG9uIHZhcmlhYmxlcyBpbiBtb2RlPUFVVE8K\nICAgICAqICAgICAgIEJhc2ljIGNvbnN0cmFpbnQgdGVzdCBmb3IgYSB2aW9s\nYXRpb24gZXhjZXB0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nRGVjaW1hbE1pbkNvbnN0cmFpbnQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJh\nY2UoInRlc3REZWNpbWFsTWluQ29uc3RyYWludCgpIHN0YXJ0ZWQiKTsKICAg\nICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgogICAgICAgIE9w\nZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFn\nZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2RlCiAgICAg\nICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5nZXRDb25m\naWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7\nCiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAg\nICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5lcXVhbHNJ\nZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBjcmVhdGUgaW52\nYWxpZCBDb25zdHJhaW50Qm9vbGVhbiBpbnN0YW5jZQogICAgICAgICAgICBl\nbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIENvbnN0\ncmFpbnREZWNpbWFsIGMgPSBDb25zdHJhaW50RGVjaW1hbC5jcmVhdGVJbnZh\nbGlkTWluKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAgICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAg\nIGdldExvZygpLnRyYWNlKCJ0ZXN0RGVjaW1hbE1pbkNvbnN0cmFpbnQoKSBm\nYWlsZWQiKTsKICAgICAgICAgICAgZmFpbCgiRXhwZWN0ZWQgYSBDb25zdHJh\naW50VmlvbGF0aW9uRXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoQ29u\nc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8v\nIGV4cGVjdGVkCiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJDYXVnaHQg\nZXhwZWN0ZWQgQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiA9ICIgKyBl\nKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3REZWNpbWFsTWlu\nQ29uc3RyYWludCgpIHBhc3NlZCIpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsK\nICAgICAgICAgICAgICAgIGlmIChlbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0\naXZlKCkpCiAgICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24o\nKS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNj\nZW5hcmlvIGJlaW5nIHRlc3RlZDoKICAgICAqICAgMTEpIFRlc3QgQERlY2lt\nYWxNYXggY29uc3RyYWludCBleGNlcHRpb24gb24gZ2V0dGVyIGluIG1vZGU9\nQVVUTwogICAgICogICAgICAgQmFzaWMgY29uc3RyYWludCB0ZXN0IGZvciBh\nIHZpb2xhdGlvbiBleGNlcHRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHRlc3REZWNpbWFsTWF4Q29uc3RyYWludCgpIHsKICAgICAgICBnZXRMb2co\nKS50cmFjZSgidGVzdERlY2ltYWxNYXhDb25zdHJhaW50KCkgc3RhcnRlZCIp\nOwogICAgICAgIC8vIGNyZWF0ZSBFTSBmcm9tIGRlZmF1bHQgRU1GCiAgICAg\nICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5\nTWFuYWdlcigpOwogICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIHZlcmlmeSBWYWxpZGF0aW9uIE1vZGUK\nICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGVtLmdl\ndENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChj\nb25mKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmFsaWRhdGlvbk1vZGUi\nLAogICAgICAgICAgICAgICAgY29uZi5nZXRWYWxpZGF0aW9uTW9kZSgpLmVx\ndWFsc0lnbm9yZUNhc2UoIkFVVE8iKSk7CiAgICAgICAgICAgIC8vIGNyZWF0\nZSBpbnZhbGlkIENvbnN0cmFpbnRCb29sZWFuIGluc3RhbmNlCiAgICAgICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAg\nQ29uc3RyYWludERlY2ltYWwgYyA9IENvbnN0cmFpbnREZWNpbWFsLmNyZWF0\nZUludmFsaWRNYXgoKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChjKTsKICAg\nICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAg\nICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3REZWNpbWFsTWF4Q29uc3RyYWlu\ndCgpIGZhaWxlZCIpOwogICAgICAgICAgICBmYWlsKCJFeHBlY3RlZCBhIENv\nbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNo\nIChDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoIkNh\ndWdodCBleHBlY3RlZCBDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uID0g\nIiArIGUpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdERlY2lt\nYWxNYXhDb25zdHJhaW50KCkgcGFzc2VkIik7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgaWYgKChlbSAhPSBudWxsKSAmJiBlbS5pc09wZW4o\nKSkgewogICAgICAgICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCku\naXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgogICAgICogICAxMikgVGVzdCBA\nRGVjaW1hbE1pbiBhbmQgQERlY2ltYWxNYXggY29uc3RyYWludHMgcGFzcyBp\nbiBtb2RlPUFVVE8KICAgICAqICAgICAgIEJhc2ljIGNvbnN0cmFpbnQgdGVz\ndCBmb3Igbm8gdmlvbGF0aW9ucy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\ndGVzdERlY2ltYWxNaW5NYXhDb25zdHJhaW50KCkgewogICAgICAgIGdldExv\nZygpLnRyYWNlKCJ0ZXN0RGVjaW1hbE1pbk1heENvbnN0cmFpbnQoKSBzdGFy\ndGVkIik7CiAgICAgICAgLy8gY3JlYXRlIEVNIGZyb20gZGVmYXVsdCBFTUYK\nICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdmVyaWZ5IFZhbGlkYXRpb24g\nTW9kZQogICAgICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0g\nZW0uZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBhc3NlcnROb3RO\ndWxsKGNvbmYpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWYWxpZGF0aW9u\nTW9kZSIsCiAgICAgICAgICAgICAgICBjb25mLmdldFZhbGlkYXRpb25Nb2Rl\nKCkuZXF1YWxzSWdub3JlQ2FzZSgiQVVUTyIpKTsKICAgICAgICAgICAgLy8g\nY3JlYXRlIHZhbGlkIENvbnN0cmFpbnRCb29sZWFuIGluc3RhbmNlCiAgICAg\nICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAg\nICAgQ29uc3RyYWludERlY2ltYWwgYyA9IENvbnN0cmFpbnREZWNpbWFsLmNy\nZWF0ZVZhbGlkKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAg\nICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAg\nICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0RGVjaW1hbE1pbk1heENvbnN0cmFp\nbnQoKSBwYXNzZWQiKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAvLyB1bmV4cGVjdGVkCiAgICAgICAgICAgIGdldExv\nZygpLnRyYWNlKCJ0ZXN0RGVjaW1hbE1pbk1heENvbnN0cmFpbnQoKSBmYWls\nZWQiKTsKICAgICAgICAgICAgZmFpbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgZXhj\nZXB0aW9uID0gIiArIGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChlbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkp\nCiAgICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xs\nYmFjaygpOwogICAgICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNjZW5hcmlv\nIGJlaW5nIHRlc3RlZDoKICAgICAqICAgMTMpIFRlc3QgQE1pbiBjb25zdHJh\naW50IGV4Y2VwdGlvbiBvbiB2YXJpYWJsZXMgaW4gbW9kZT1BVVRPCiAgICAg\nKiAgICAgICBCYXNpYyBjb25zdHJhaW50IHRlc3QgZm9yIGEgdmlvbGF0aW9u\nIGV4Y2VwdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgdGVzdE1pbkNv\nbnN0cmFpbnQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RNaW5D\nb25zdHJhaW50KCkgc3RhcnRlZCIpOwogICAgICAgIC8vIGNyZWF0ZSBFTSBm\ncm9tIGRlZmF1bHQgRU1GCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIg\nZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIGFzc2Vy\ndE5vdE51bGwoZW0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHZl\ncmlmeSBWYWxpZGF0aW9uIE1vZGUKICAgICAgICAgICAgT3BlbkpQQUNvbmZp\nZ3VyYXRpb24gY29uZiA9IGVtLmdldENvbmZpZ3VyYXRpb24oKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbChjb25mKTsKICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZSgiVmFsaWRhdGlvbk1vZGUiLAogICAgICAgICAgICAgICAgY29uZi5n\nZXRWYWxpZGF0aW9uTW9kZSgpLmVxdWFsc0lnbm9yZUNhc2UoIkFVVE8iKSk7\nCiAgICAgICAgICAgIC8vIGNyZWF0ZSBpbnZhbGlkIENvbnN0cmFpbnRCb29s\nZWFuIGluc3RhbmNlCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCku\nYmVnaW4oKTsKICAgICAgICAgICAgQ29uc3RyYWludE51bWJlciBjID0gQ29u\nc3RyYWludE51bWJlci5jcmVhdGVJbnZhbGlkTWluKCk7CiAgICAgICAgICAg\nIGVtLnBlcnNpc3QoYyk7CiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9u\nKCkuY29tbWl0KCk7CiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0\nTWluQ29uc3RyYWludCgpIGZhaWxlZCIpOwogICAgICAgICAgICBmYWlsKCJF\neHBlY3RlZCBhIENvbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24iKTsKICAg\nICAgICB9IGNhdGNoIChDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9n\nKCkudHJhY2UoIkNhdWdodCBleHBlY3RlZCBDb25zdHJhaW50VmlvbGF0aW9u\nRXhjZXB0aW9uID0gIiArIGUpOwogICAgICAgICAgICBnZXRMb2coKS50cmFj\nZSgidGVzdE1pbkNvbnN0cmFpbnQoKSBwYXNzZWQiKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBpZiAoKGVtICE9IG51bGwpICYmIGVtLmlz\nT3BlbigpKSB7CiAgICAgICAgICAgICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rp\nb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgICAgIGVtLmdldFRy\nYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIGVtLmNs\nb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTY2VuYXJpbyBiZWluZyB0ZXN0ZWQ6CiAgICAgKiAgIDE0KSBU\nZXN0IEBNYXggY29uc3RyYWludCBleGNlcHRpb24gb24gZ2V0dGVyIGluIG1v\nZGU9QVVUTwogICAgICogICAgICAgQmFzaWMgY29uc3RyYWludCB0ZXN0IGZv\nciBhIHZpb2xhdGlvbiBleGNlcHRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHRlc3RNYXhDb25zdHJhaW50KCkgewogICAgICAgIGdldExvZygpLnRy\nYWNlKCJ0ZXN0TWF4Q29uc3RyYWludCgpIHN0YXJ0ZWQiKTsKICAgICAgICAv\nLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgogICAgICAgIE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsK\nICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2RlCiAgICAgICAgICAg\nIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5nZXRDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7CiAgICAg\nICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAgICAgICAg\nICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5lcXVhbHNJZ25vcmVD\nYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBjcmVhdGUgaW52YWxpZCBD\nb25zdHJhaW50Qm9vbGVhbiBpbnN0YW5jZQogICAgICAgICAgICBlbS5nZXRU\ncmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIENvbnN0cmFpbnRO\ndW1iZXIgYyA9IENvbnN0cmFpbnROdW1iZXIuY3JlYXRlSW52YWxpZE1heCgp\nOwogICAgICAgICAgICBlbS5wZXJzaXN0KGMpOwogICAgICAgICAgICBlbS5n\nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAgICBnZXRMb2co\nKS50cmFjZSgidGVzdE1heENvbnN0cmFpbnQoKSBmYWlsZWQiKTsKICAgICAg\nICAgICAgZmFpbCgiRXhwZWN0ZWQgYSBDb25zdHJhaW50VmlvbGF0aW9uRXhj\nZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoQ29uc3RyYWludFZpb2xhdGlv\nbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAgICAg\nICAgICAgIGdldExvZygpLnRyYWNlKCJDYXVnaHQgZXhwZWN0ZWQgQ29uc3Ry\nYWludFZpb2xhdGlvbkV4Y2VwdGlvbiA9ICIgKyBlKTsKICAgICAgICAgICAg\nZ2V0TG9nKCkudHJhY2UoInRlc3RNYXhDb25zdHJhaW50KCkgcGFzc2VkIik7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChlbSAhPSBu\ndWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAgaWYgKGVt\nLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAg\nICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgog\nICAgICogICAxNSkgVGVzdCBATWluIGFuZCBATWF4IGNvbnN0cmFpbnRzIHBh\nc3MgaW4gbW9kZT1BVVRPCiAgICAgKiAgICAgICBCYXNpYyBjb25zdHJhaW50\nIHRlc3QgZm9yIG5vIHZpb2xhdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHRlc3RNaW5NYXhDb25zdHJhaW50KCkgewogICAgICAgIGdldExvZygp\nLnRyYWNlKCJ0ZXN0TWluTWF4Q29uc3RyYWludCgpIHN0YXJ0ZWQiKTsKICAg\nICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgogICAgICAgIE9w\nZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFn\nZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2RlCiAgICAg\nICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5nZXRDb25m\naWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7\nCiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAg\nICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5lcXVhbHNJ\nZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBjcmVhdGUgdmFs\naWQgQ29uc3RyYWludEJvb2xlYW4gaW5zdGFuY2UKICAgICAgICAgICAgZW0u\nZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBDb25zdHJh\naW50TnVtYmVyIGMgPSBDb25zdHJhaW50TnVtYmVyLmNyZWF0ZVZhbGlkKCk7\nCiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAgICAgICAgIGVtLmdl\ndFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgIGdldExvZygp\nLnRyYWNlKCJ0ZXN0TWluTWF4Q29uc3RyYWludCgpIHBhc3NlZCIpOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIHVu\nZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RNaW5N\nYXhDb25zdHJhaW50KCkgZmFpbGVkIik7CiAgICAgICAgICAgIGZhaWwoIkNh\ndWdodCB1bmV4cGVjdGVkIGV4Y2VwdGlvbiA9ICIgKyBlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAoKGVtICE9IG51bGwpICYmIGVt\nLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAgICBpZiAoZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgICAgIGVtLmdl\ndFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIGVt\nLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTY2VuYXJpbyBiZWluZyB0ZXN0ZWQ6CiAgICAgKiAgIDE2\nKSBUZXN0IEBEaWdpdHMgY29uc3RyYWludCBleGNlcHRpb24gb24gdmFyaWFi\nbGVzIGluIG1vZGU9QVVUTwogICAgICogICAgICAgQmFzaWMgY29uc3RyYWlu\ndCB0ZXN0IGZvciBhIHZpb2xhdGlvbiBleGNlcHRpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHRlc3REaWdpdHNUd29Db25zdHJhaW50KCkgewogICAg\nICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0RGlnaXRzVHdvQ29uc3RyYWludCgp\nIHN0YXJ0ZWQiKTsKICAgICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0\nIEVNRgogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVt\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRh\ndGlvbiBNb2RlCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNv\nbmYgPSBlbS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2Vy\ndE5vdE51bGwoY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlk\nYXRpb25Nb2RlIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlv\nbk1vZGUoKS5lcXVhbHNJZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAgICAg\nICAvLyBjcmVhdGUgaW52YWxpZCBDb25zdHJhaW50Qm9vbGVhbiBpbnN0YW5j\nZQogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAg\nICAgICAgICAgIENvbnN0cmFpbnREaWdpdHMgYyA9IENvbnN0cmFpbnREaWdp\ndHMuY3JlYXRlSW52YWxpZFR3b0RpZ2l0cygpOwogICAgICAgICAgICBlbS5w\nZXJzaXN0KGMpOwogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNv\nbW1pdCgpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdERpZ2l0\nc1R3b0NvbnN0cmFpbnQoKSBmYWlsZWQiKTsKICAgICAgICAgICAgZmFpbCgi\nRXhwZWN0ZWQgYSBDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uIik7CiAg\nICAgICAgfSBjYXRjaCAoQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAgICAgICAgICAgIGdldExv\nZygpLnRyYWNlKCJDYXVnaHQgZXhwZWN0ZWQgQ29uc3RyYWludFZpb2xhdGlv\nbkV4Y2VwdGlvbiA9ICIgKyBlKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJh\nY2UoInRlc3REaWdpdHNUd29Db25zdHJhaW50KCkgcGFzc2VkIik7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChlbSAhPSBudWxsKSAm\nJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAgaWYgKGVtLmdldFRy\nYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgICAgICBl\nbS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAg\nICBlbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgogICAgICog\nICAxNykgVGVzdCBARGlnaXRzIGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIGdl\ndHRlciBpbiBtb2RlPUFVVE8KICAgICAqICAgICAgIEJhc2ljIGNvbnN0cmFp\nbnQgdGVzdCBmb3IgYSB2aW9sYXRpb24gZXhjZXB0aW9uLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0RGlnaXRzRml2ZUNvbnN0cmFpbnQoKSB7CiAg\nICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3REaWdpdHNGaXZlQ29uc3RyYWlu\ndCgpIHN0YXJ0ZWQiKTsKICAgICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZh\ndWx0IEVNRgogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1m\nLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxs\nKGVtKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFs\naWRhdGlvbiBNb2RlCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYgPSBlbS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFz\nc2VydE5vdE51bGwoY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZh\nbGlkYXRpb25Nb2RlIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRh\ndGlvbk1vZGUoKS5lcXVhbHNJZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAg\nICAgICAvLyBjcmVhdGUgaW52YWxpZCBDb25zdHJhaW50Qm9vbGVhbiBpbnN0\nYW5jZQogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7\nCiAgICAgICAgICAgIENvbnN0cmFpbnREaWdpdHMgYyA9IENvbnN0cmFpbnRE\naWdpdHMuY3JlYXRlSW52YWxpZEZpdmVEaWdpdHMoKTsKICAgICAgICAgICAg\nZW0ucGVyc2lzdChjKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24o\nKS5jb21taXQoKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RE\naWdpdHNGaXZlQ29uc3RyYWludCgpIGZhaWxlZCIpOwogICAgICAgICAgICBm\nYWlsKCJFeHBlY3RlZCBhIENvbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24i\nKTsKICAgICAgICB9IGNhdGNoIChDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAg\nZ2V0TG9nKCkudHJhY2UoIkNhdWdodCBleHBlY3RlZCBDb25zdHJhaW50Vmlv\nbGF0aW9uRXhjZXB0aW9uID0gIiArIGUpOwogICAgICAgICAgICBnZXRMb2co\nKS50cmFjZSgidGVzdERpZ2l0c0ZpdmVDb25zdHJhaW50KCkgcGFzc2VkIik7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChlbSAhPSBu\ndWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAgaWYgKGVt\nLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAg\nICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgog\nICAgICogICAxOCkgVGVzdCBARGlnaXRzIGNvbnN0cmFpbnRzIHBhc3MgaW4g\nbW9kZT1BVVRPCiAgICAgKiAgICAgICBCYXNpYyBjb25zdHJhaW50IHRlc3Qg\nZm9yIG5vIHZpb2xhdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRl\nc3REaWdpdHNDb25zdHJhaW50KCkgewogICAgICAgIGdldExvZygpLnRyYWNl\nKCJ0ZXN0RGlnaXRzQ29uc3RyYWludCgpIHN0YXJ0ZWQiKTsKICAgICAgICAv\nLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgogICAgICAgIE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsK\nICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2RlCiAgICAgICAgICAg\nIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5nZXRDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7CiAgICAg\nICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAgICAgICAg\nICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5lcXVhbHNJZ25vcmVD\nYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBjcmVhdGUgdmFsaWQgQ29u\nc3RyYWludEJvb2xlYW4gaW5zdGFuY2UKICAgICAgICAgICAgZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBDb25zdHJhaW50RGln\naXRzIGMgPSBDb25zdHJhaW50RGlnaXRzLmNyZWF0ZVZhbGlkKCk7CiAgICAg\nICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAgICAgICAgIGVtLmdldFRyYW5z\nYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgIGdldExvZygpLnRyYWNl\nKCJ0ZXN0RGlnaXRzQ29uc3RyYWludCgpIHBhc3NlZCIpOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIHVuZXhwZWN0\nZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3REaWdpdHNDb25z\ndHJhaW50KCkgZmFpbGVkIik7CiAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1\nbmV4cGVjdGVkIGV4Y2VwdGlvbiA9ICIgKyBlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAoKGVtICE9IG51bGwpICYmIGVtLmlzT3Bl\nbigpKSB7CiAgICAgICAgICAgICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24o\nKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgICAgIGVtLmdldFRyYW5z\nYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIGVtLmNsb3Nl\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTY2VuYXJpbyBiZWluZyB0ZXN0ZWQ6CiAgICAgKiAgIDE5KSBUZXN0\nIEBTaXplIGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIHZhcmlhYmxlcyBpbiBt\nb2RlPUFVVE8KICAgICAqICAgICAgIEJhc2ljIGNvbnN0cmFpbnQgdGVzdCBm\nb3IgYSB2aW9sYXRpb24gZXhjZXB0aW9uLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0U2l6ZVN0cmluZ0NvbnN0cmFpbnQoKSB7CiAgICAgICAgZ2V0\nTG9nKCkudHJhY2UoInRlc3RTaXplU3RyaW5nQ29uc3RyYWludCgpIHN0YXJ0\nZWQiKTsKICAgICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgog\nICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBN\nb2RlCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBl\nbS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51\nbGwoY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25N\nb2RlIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUo\nKS5lcXVhbHNJZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBj\ncmVhdGUgaW52YWxpZCBDb25zdHJhaW50Qm9vbGVhbiBpbnN0YW5jZQogICAg\nICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAg\nICAgIENvbnN0cmFpbnRTaXplIGMgPSBDb25zdHJhaW50U2l6ZS5jcmVhdGVJ\nbnZhbGlkU3RyaW5nKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAg\nICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAg\nICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0U2l6ZVN0cmluZ0NvbnN0cmFp\nbnQoKSBmYWlsZWQiKTsKICAgICAgICAgICAgZmFpbCgiRXhwZWN0ZWQgYSBD\nb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRj\naCAoQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIC8vIGV4cGVjdGVkCiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJD\nYXVnaHQgZXhwZWN0ZWQgQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiA9\nICIgKyBlKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RTaXpl\nU3RyaW5nQ29uc3RyYWludCgpIHBhc3NlZCIpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVu\nKCkpIHsKICAgICAgICAgICAgICAgIGlmIChlbS5nZXRUcmFuc2FjdGlvbigp\nLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgZW0uY2xvc2Uo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDoKICAgICAqICAgMjApIFRlc3Qg\nQFNpemUgY29uc3RyYWludCBleGNlcHRpb24gb24gZ2V0dGVyIGluIG1vZGU9\nQVVUTwogICAgICogICAgICAgQmFzaWMgY29uc3RyYWludCB0ZXN0IGZvciBh\nIHZpb2xhdGlvbiBleGNlcHRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHRlc3RTaXplTWFwQ29uc3RyYWludCgpIHsKICAgICAgICBnZXRMb2coKS50\ncmFjZSgidGVzdFNpemVNYXBDb25zdHJhaW50KCkgc3RhcnRlZCIpOwogICAg\nICAgIC8vIGNyZWF0ZSBFTSBmcm9tIGRlZmF1bHQgRU1GCiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdl\ncigpOwogICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIC8vIHZlcmlmeSBWYWxpZGF0aW9uIE1vZGUKICAgICAg\nICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGVtLmdldENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChjb25mKTsK\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmFsaWRhdGlvbk1vZGUiLAogICAg\nICAgICAgICAgICAgY29uZi5nZXRWYWxpZGF0aW9uTW9kZSgpLmVxdWFsc0ln\nbm9yZUNhc2UoIkFVVE8iKSk7CiAgICAgICAgICAgIC8vIGNyZWF0ZSBpbnZh\nbGlkIENvbnN0cmFpbnRCb29sZWFuIGluc3RhbmNlCiAgICAgICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgQ29uc3Ry\nYWludFNpemUgYyA9IENvbnN0cmFpbnRTaXplLmNyZWF0ZUludmFsaWRNYXAo\nKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChjKTsKICAgICAgICAgICAgZW0u\nZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICAgICAgZ2V0TG9n\nKCkudHJhY2UoInRlc3RTaXplTWFwQ29uc3RyYWludCgpIGZhaWxlZCIpOwog\nICAgICAgICAgICBmYWlsKCJFeHBlY3RlZCBhIENvbnN0cmFpbnRWaW9sYXRp\nb25FeGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChDb25zdHJhaW50Vmlv\nbGF0aW9uRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gZXhwZWN0ZWQK\nICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoIkNhdWdodCBleHBlY3RlZCBD\nb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uID0gIiArIGUpOwogICAgICAg\nICAgICBnZXRMb2coKS50cmFjZSgidGVzdFNpemVNYXBDb25zdHJhaW50KCkg\ncGFzc2VkIik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKChlbSAhPSBudWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAg\nICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAg\nICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7\nCiAgICAgICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcg\ndGVzdGVkOgogICAgICogICAyMSkgVGVzdCBAU2l6ZSBjb25zdHJhaW50cyBw\nYXNzIGluIG1vZGU9QVVUTwogICAgICogICAgICAgQmFzaWMgY29uc3RyYWlu\ndCB0ZXN0IGZvciBubyB2aW9sYXRpb25zLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0U2l6ZUNvbnN0cmFpbnQoKSB7CiAgICAgICAgZ2V0TG9nKCku\ndHJhY2UoInRlc3RTaXplQ29uc3RyYWludCgpIHN0YXJ0ZWQiKTsKICAgICAg\nICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgogICAgICAgIE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIo\nKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2RlCiAgICAgICAg\nICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5nZXRDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAgICAg\nICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5lcXVhbHNJZ25v\ncmVDYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBjcmVhdGUgdmFsaWQg\nQ29uc3RyYWludEJvb2xlYW4gaW5zdGFuY2UKICAgICAgICAgICAgZW0uZ2V0\nVHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBDb25zdHJhaW50\nU2l6ZSBjID0gQ29uc3RyYWludFNpemUuY3JlYXRlVmFsaWQoKTsKICAgICAg\nICAgICAgZW0ucGVyc2lzdChjKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5jb21taXQoKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2Uo\nInRlc3RTaXplQ29uc3RyYWludCgpIHBhc3NlZCIpOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIHVuZXhwZWN0ZWQK\nICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RTaXplQ29uc3RyYWlu\ndCgpIGZhaWxlZCIpOwogICAgICAgICAgICBmYWlsKCJDYXVnaHQgdW5leHBl\nY3RlZCBleGNlcHRpb24gPSAiICsgZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKChlbSAhPSBudWxsKSAmJiBlbS5pc09wZW4oKSkg\newogICAgICAgICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCkuaXNB\nY3RpdmUoKSkKICAgICAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgogICAgICogICAyMikgVGVzdCBARnV0\ndXJlIGNvbnN0cmFpbnQgZXhjZXB0aW9uIG9uIHZhcmlhYmxlcyBpbiBtb2Rl\nPUFVVE8KICAgICAqICAgICAgIEJhc2ljIGNvbnN0cmFpbnQgdGVzdCBmb3Ig\nYSB2aW9sYXRpb24gZXhjZXB0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0RGF0ZXNGdXR1cmVDb25zdHJhaW50KCkgewogICAgICAgIGdldExv\nZygpLnRyYWNlKCJ0ZXN0RGF0ZXNGdXR1cmVDb25zdHJhaW50KCkgc3RhcnRl\nZCIpOwogICAgICAgIC8vIGNyZWF0ZSBFTSBmcm9tIGRlZmF1bHQgRU1GCiAg\nICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50\naXR5TWFuYWdlcigpOwogICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHZlcmlmeSBWYWxpZGF0aW9uIE1v\nZGUKICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGVt\nLmdldENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVs\nbChjb25mKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmFsaWRhdGlvbk1v\nZGUiLAogICAgICAgICAgICAgICAgY29uZi5nZXRWYWxpZGF0aW9uTW9kZSgp\nLmVxdWFsc0lnbm9yZUNhc2UoIkFVVE8iKSk7CiAgICAgICAgICAgIC8vIGNy\nZWF0ZSBpbnZhbGlkIENvbnN0cmFpbnRCb29sZWFuIGluc3RhbmNlCiAgICAg\nICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAg\nICAgQ29uc3RyYWludERhdGVzIGMgPSBDb25zdHJhaW50RGF0ZXMuY3JlYXRl\nSW52YWxpZEZ1dHVyZSgpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGMpOwog\nICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAg\nICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdERhdGVzRnV0dXJlQ29uc3Ry\nYWludCgpIGZhaWxlZCIpOwogICAgICAgICAgICBmYWlsKCJFeHBlY3RlZCBh\nIENvbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24iKTsKICAgICAgICB9IGNh\ndGNoIChDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2Uo\nIkNhdWdodCBleHBlY3RlZCBDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9u\nID0gIiArIGUpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdERh\ndGVzRnV0dXJlQ29uc3RyYWludCgpIHBhc3NlZCIpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNP\ncGVuKCkpIHsKICAgICAgICAgICAgICAgIGlmIChlbS5nZXRUcmFuc2FjdGlv\nbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgZW0uY2xv\nc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDoKICAgICAqICAgMjMpIFRl\nc3QgQFBhc3QgY29uc3RyYWludCBleGNlcHRpb24gb24gZ2V0dGVyIGluIG1v\nZGU9QVVUTwogICAgICogICAgICAgQmFzaWMgY29uc3RyYWludCB0ZXN0IGZv\nciBhIHZpb2xhdGlvbiBleGNlcHRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHRlc3REYXRlc1Bhc3RDb25zdHJhaW50KCkgewogICAgICAgIGdldExv\nZygpLnRyYWNlKCJ0ZXN0RGF0ZXNQYXN0Q29uc3RyYWludCgpIHN0YXJ0ZWQi\nKTsKICAgICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0IEVNRgogICAg\nICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRhdGlvbiBNb2Rl\nCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbS5n\nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwo\nY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlkYXRpb25Nb2Rl\nIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlvbk1vZGUoKS5l\ncXVhbHNJZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAgICAgICAvLyBjcmVh\ndGUgaW52YWxpZCBDb25zdHJhaW50Qm9vbGVhbiBpbnN0YW5jZQogICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAg\nIENvbnN0cmFpbnREYXRlcyBjID0gQ29uc3RyYWludERhdGVzLmNyZWF0ZUlu\ndmFsaWRQYXN0KCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAg\nICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAg\nICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0RGF0ZXNQYXN0Q29uc3RyYWludCgp\nIGZhaWxlZCIpOwogICAgICAgICAgICBmYWlsKCJFeHBlY3RlZCBhIENvbnN0\ncmFpbnRWaW9sYXRpb25FeGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChD\nb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nLy8gZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoIkNhdWdo\ndCBleHBlY3RlZCBDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uID0gIiAr\nIGUpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdERhdGVzUGFz\ndENvbnN0cmFpbnQoKSBwYXNzZWQiKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBpZiAoKGVtICE9IG51bGwpICYmIGVtLmlzT3BlbigpKSB7\nCiAgICAgICAgICAgICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24oKS5pc0Fj\ndGl2ZSgpKQogICAgICAgICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9u\nKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nY2VuYXJpbyBiZWluZyB0ZXN0ZWQ6CiAgICAgKiAgIDI0KSBUZXN0IEBQYXN0\nIGFuZCBARnV0dXJlIGNvbnN0cmFpbnRzIHBhc3MgaW4gbW9kZT1BVVRPCiAg\nICAgKiAgICAgICBCYXNpYyBjb25zdHJhaW50IHRlc3QgZm9yIG5vIHZpb2xh\ndGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3REYXRlc0NvbnN0\ncmFpbnQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3REYXRlc0Nv\nbnN0cmFpbnQoKSBzdGFydGVkIik7CiAgICAgICAgLy8gY3JlYXRlIEVNIGZy\nb20gZGVmYXVsdCBFTUYKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBl\nbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgYXNzZXJ0\nTm90TnVsbChlbSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdmVy\naWZ5IFZhbGlkYXRpb24gTW9kZQogICAgICAgICAgICBPcGVuSlBBQ29uZmln\ndXJhdGlvbiBjb25mID0gZW0uZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAg\nICAgICBhc3NlcnROb3ROdWxsKGNvbmYpOwogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJWYWxpZGF0aW9uTW9kZSIsCiAgICAgICAgICAgICAgICBjb25mLmdl\ndFZhbGlkYXRpb25Nb2RlKCkuZXF1YWxzSWdub3JlQ2FzZSgiQVVUTyIpKTsK\nICAgICAgICAgICAgLy8gY3JlYXRlIHZhbGlkIENvbnN0cmFpbnRCb29sZWFu\nIGluc3RhbmNlCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVn\naW4oKTsKICAgICAgICAgICAgQ29uc3RyYWludERhdGVzIGMgPSBDb25zdHJh\naW50RGF0ZXMuY3JlYXRlVmFsaWQoKTsKICAgICAgICAgICAgZW0ucGVyc2lz\ndChjKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQo\nKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3REYXRlc0NvbnN0\ncmFpbnQoKSBwYXNzZWQiKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAvLyB1bmV4cGVjdGVkCiAgICAgICAgICAgIGdl\ndExvZygpLnRyYWNlKCJ0ZXN0RGF0ZXNDb25zdHJhaW50KCkgZmFpbGVkIik7\nCiAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkIGV4Y2VwdGlv\nbiA9ICIgKyBlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAoKGVtICE9IG51bGwpICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAg\nICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAg\nICAgICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2so\nKTsKICAgICAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTY2VuYXJpbyBiZWlu\nZyB0ZXN0ZWQ6CiAgICAgKiAgIDI1KSBUZXN0IEBQYXR0ZXJuIGNvbnN0cmFp\nbnQgZXhjZXB0aW9uIG9uIHZhcmlhYmxlcyBpbiBtb2RlPUFVVE8KICAgICAq\nICAgICAgIEJhc2ljIGNvbnN0cmFpbnQgdGVzdCBmb3IgYSB2aW9sYXRpb24g\nZXhjZXB0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0UGF0dGVy\nbkFscGhhQ29uc3RyYWludCgpIHsKICAgICAgICBnZXRMb2coKS50cmFjZSgi\ndGVzdFBhdHRlcm5BbHBoYUNvbnN0cmFpbnQoKSBzdGFydGVkIik7CiAgICAg\nICAgLy8gY3JlYXRlIEVNIGZyb20gZGVmYXVsdCBFTUYKICAgICAgICBPcGVu\nSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2Vy\nKCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gdmVyaWZ5IFZhbGlkYXRpb24gTW9kZQogICAgICAg\nICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0gZW0uZ2V0Q29uZmln\ndXJhdGlvbigpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGNvbmYpOwog\nICAgICAgICAgICBhc3NlcnRUcnVlKCJWYWxpZGF0aW9uTW9kZSIsCiAgICAg\nICAgICAgICAgICBjb25mLmdldFZhbGlkYXRpb25Nb2RlKCkuZXF1YWxzSWdu\nb3JlQ2FzZSgiQVVUTyIpKTsKICAgICAgICAgICAgLy8gY3JlYXRlIGludmFs\naWQgQ29uc3RyYWludEJvb2xlYW4gaW5zdGFuY2UKICAgICAgICAgICAgZW0u\nZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBDb25zdHJh\naW50UGF0dGVybiBjID0gQ29uc3RyYWludFBhdHRlcm4uY3JlYXRlSW52YWxp\nZFN0cmluZygpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGMpOwogICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAg\nICBnZXRMb2coKS50cmFjZSgidGVzdFBhdHRlcm5BbHBoYUNvbnN0cmFpbnQo\nKSBmYWlsZWQiKTsKICAgICAgICAgICAgZmFpbCgiRXhwZWN0ZWQgYSBDb25z\ndHJhaW50VmlvbGF0aW9uRXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAo\nQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIC8vIGV4cGVjdGVkCiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJDYXVn\naHQgZXhwZWN0ZWQgQ29uc3RyYWludFZpb2xhdGlvbkV4Y2VwdGlvbiA9ICIg\nKyBlKTsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RQYXR0ZXJu\nQWxwaGFDb25zdHJhaW50KCkgcGFzc2VkIik7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgaWYgKChlbSAhPSBudWxsKSAmJiBlbS5pc09wZW4o\nKSkgewogICAgICAgICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCku\naXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgogICAgICogICAyNikgVGVzdCBA\nUGF0dGVybiBjb25zdHJhaW50IGV4Y2VwdGlvbiBvbiBnZXR0ZXIgaW4gbW9k\nZT1BVVRPCiAgICAgKiAgICAgICBCYXNpYyBjb25zdHJhaW50IHRlc3QgZm9y\nIGEgdmlvbGF0aW9uIGV4Y2VwdGlvbi4KICAgICAqLwogICAgcHVibGljIHZv\naWQgdGVzdFBhdHRlcm5OdW1lcmljQ29uc3RyYWludCgpIHsKICAgICAgICBn\nZXRMb2coKS50cmFjZSgidGVzdFBhdHRlcm5OdW1lcmljQ29uc3RyYWludCgp\nIHN0YXJ0ZWQiKTsKICAgICAgICAvLyBjcmVhdGUgRU0gZnJvbSBkZWZhdWx0\nIEVNRgogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVt\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB2ZXJpZnkgVmFsaWRh\ndGlvbiBNb2RlCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNv\nbmYgPSBlbS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFzc2Vy\ndE5vdE51bGwoY29uZik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZhbGlk\nYXRpb25Nb2RlIiwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0VmFsaWRhdGlv\nbk1vZGUoKS5lcXVhbHNJZ25vcmVDYXNlKCJBVVRPIikpOwogICAgICAgICAg\nICAvLyBjcmVhdGUgaW52YWxpZCBDb25zdHJhaW50Qm9vbGVhbiBpbnN0YW5j\nZQogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAg\nICAgICAgICAgIENvbnN0cmFpbnRQYXR0ZXJuIGMgPSBDb25zdHJhaW50UGF0\ndGVybi5jcmVhdGVJbnZhbGlkWmlwY29kZSgpOwogICAgICAgICAgICBlbS5w\nZXJzaXN0KGMpOwogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNv\nbW1pdCgpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdFBhdHRl\ncm5OdW1lcmljQ29uc3RyYWludCgpIGZhaWxlZCIpOwogICAgICAgICAgICBm\nYWlsKCJFeHBlY3RlZCBhIENvbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24i\nKTsKICAgICAgICB9IGNhdGNoIChDb25zdHJhaW50VmlvbGF0aW9uRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAg\nZ2V0TG9nKCkudHJhY2UoIkNhdWdodCBleHBlY3RlZCBDb25zdHJhaW50Vmlv\nbGF0aW9uRXhjZXB0aW9uID0gIiArIGUpOwogICAgICAgICAgICBnZXRMb2co\nKS50cmFjZSgidGVzdFBhdHRlcm5OdW1lcmljQ29uc3RyYWludCgpIHBhc3Nl\nZCIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICgoZW0g\nIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAgICAgIGlm\nIChlbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAg\nICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAg\nICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3Rl\nZDoKICAgICAqICAgMjcpIFRlc3QgQFBhdHRlcm4gY29uc3RyYWludHMgcGFz\ncyBpbiBtb2RlPUFVVE8KICAgICAqICAgICAgIEJhc2ljIGNvbnN0cmFpbnQg\ndGVzdCBmb3Igbm8gdmlvbGF0aW9ucy4KICAgICAqLwogICAgcHVibGljIHZv\naWQgdGVzdFBhdHRlcm5Db25zdHJhaW50KCkgewogICAgICAgIGdldExvZygp\nLnRyYWNlKCJ0ZXN0UGF0dGVybkNvbnN0cmFpbnQoKSBzdGFydGVkIik7CiAg\nICAgICAgLy8gY3JlYXRlIEVNIGZyb20gZGVmYXVsdCBFTUYKICAgICAgICBP\ncGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5h\nZ2VyKCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gdmVyaWZ5IFZhbGlkYXRpb24gTW9kZQogICAg\nICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0gZW0uZ2V0Q29u\nZmlndXJhdGlvbigpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGNvbmYp\nOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWYWxpZGF0aW9uTW9kZSIsCiAg\nICAgICAgICAgICAgICBjb25mLmdldFZhbGlkYXRpb25Nb2RlKCkuZXF1YWxz\nSWdub3JlQ2FzZSgiQVVUTyIpKTsKICAgICAgICAgICAgLy8gY3JlYXRlIHZh\nbGlkIENvbnN0cmFpbnRCb29sZWFuIGluc3RhbmNlCiAgICAgICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgQ29uc3Ry\nYWludFBhdHRlcm4gYyA9IENvbnN0cmFpbnRQYXR0ZXJuLmNyZWF0ZVZhbGlk\nKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYyk7CiAgICAgICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgIGdldExv\nZygpLnRyYWNlKCJ0ZXN0UGF0dGVybkNvbnN0cmFpbnQoKSBwYXNzZWQiKTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAv\nLyB1bmV4cGVjdGVkCiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0\nUGF0dGVybkNvbnN0cmFpbnQoKSBmYWlsZWQiKTsKICAgICAgICAgICAgZmFp\nbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgZXhjZXB0aW9uID0gIiArIGUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICgoZW0gIT0gbnVsbCkg\nJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAgICAgIGlmIChlbS5nZXRU\ncmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICAgICAg\nZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICAg\nICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDoKICAgICAq\nICAgMjgpIFRlc3QgQFZhbGlkIGNvbnN0cmFpbnQgZXhjZXB0aW9ucyBpbiBt\nb2RlPUFVVE8KICAgICAqICAgICAgIEJhc2ljIGNvbnN0cmFpbnQgdGVzdCBm\nb3IgdmlvbGF0aW9uIGV4Y2VwdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHRlc3RWYWxpZEZhaWx1cmVzQ29uc3RyYWludCgpIHsKICAgICAgICBB\nZGRyZXNzIGEgPSBuZXcgQWRkcmVzcygpOwogICAgICAgIGdldExvZygpLnRy\nYWNlKCJ0ZXN0VmFsaWRGYWlsdXJlc0NvbnN0cmFpbnQoKSBzdGFydGVkIik7\nCiAgICAgICAgCiAgICAgICAgLy8gUGFydCAxIC0gQ3JlYXRlIGFuIGludmFs\naWQgQWRkcmVzcyBlbnRpdHkKICAgICAgICB0cnkgewogICAgICAgICAgICBP\ncGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnlTUEkgZW1mID0gKE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyRmFjdG9yeVNQSSkKICAgICAgICAgICAgT3BlbkpQQVBl\ncnNpc3RlbmNlLmNyZWF0ZUVudGl0eU1hbmFnZXJGYWN0b3J5KAogICAgICAg\nICAgICAgICAgICAgICJhZGRyZXNzLW5vbmUtbW9kZSIsCiAgICAgICAgICAg\nICAgICAgICAgIm9yZy9hcGFjaGUvb3BlbmpwYS9pbnRlZ3JhdGlvbi92YWxp\nZGF0aW9uL3BlcnNpc3RlbmNlLnhtbCIpOwogICAgICAgICAgICBhc3NlcnRO\nb3ROdWxsKGVtZik7CiAgICAgICAgICAgIC8vIGNyZWF0ZSBFTQogICAgICAg\nICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwog\nICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAvLyB2ZXJpZnkgVmFs\naWRhdGlvbiBNb2RlCiAgICAgICAgICAgICAgICBPcGVuSlBBQ29uZmlndXJh\ndGlvbiBjb25mID0gZW0uZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbChjb25mKTsKICAgICAgICAgICAgICAgIGFz\nc2VydFRydWUoIlZhbGlkYXRpb25Nb2RlIiwKICAgICAgICAgICAgICAgICAg\nICBjb25mLmdldFZhbGlkYXRpb25Nb2RlKCkuZXF1YWxzSWdub3JlQ2FzZSgi\nTk9ORSIpKTsKICAgICAgICAgICAgICAgIC8vIHByb3ZpZGUgYW4gaW52YWxp\nZCBBZGRyZXNzIChldmVyeSB2YWx1ZSBpcyBpbnZhbGlkKQogICAgICAgICAg\nICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAg\nICAgICAgYS5zZXRTdHJlZXRBZGRyZXNzKG51bGwpOwogICAgICAgICAgICAg\nICAgYS5zZXRDaXR5KCJhMSFiMkBjMyMiKTsKICAgICAgICAgICAgICAgIGEu\nc2V0U3RhdGUoIjAwIik7CiAgICAgICAgICAgICAgICBhLnNldFBvc3RhbENv\nZGUoImExYjJjMyIpOwogICAgICAgICAgICAgICAgLy8gcGVyc2lzdCwgd2hp\nY2ggc2hvdWxkIE5PVCBjYXVzZSBhIENWRQogICAgICAgICAgICAgICAgZW0u\ncGVyc2lzdChhKTsKICAgICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9u\nKCkuY29tbWl0KCk7CiAgICAgICAgICAgICAgICBnZXRMb2coKS50cmFjZSgi\ndGVzdFZhbGlkRmFpbHVyZXNDb25zdHJhaW50KCkgUGFydCAxIG9mIDIgcGFz\nc2VkIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICAvLyB1bmV4cGVjdGVkCiAgICAgICAgICAgICAgICBn\nZXRMb2coKS50cmFjZSgidGVzdFZhbGlkRmFpbHVyZXNDb25zdHJhaW50KCkg\nUGFydCAxIG9mIDIgZmFpbGVkIik7CiAgICAgICAgICAgICAgICBmYWlsKCJD\nYXVnaHQgdW5leHBlY3RlZCBleGNlcHRpb24gPSAiICsgZSk7CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgY2xlYW51cChlbWYpOwogICAgICAgICAg\nICAgICAgZW0gPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gdW5leHBlY3RlZAog\nICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdFZhbGlkRmFpbHVyZXND\nb25zdHJhaW50KCkgUGFydCAxIG9mIDIgZmFpbGVkIik7CiAgICAgICAgICAg\nIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkIGV4Y2VwdGlvbiA9ICIgKyBlKTsK\nICAgICAgICB9CgogICAgICAgIC8vIFBhcnQgMiAtIENyZWF0ZSBhIFBlcnNv\nbiBlbnRpdHkgdGhhdCB1c2VzIHRoZSBpbnZhbGlkIGFkZHJlc3MgYWJvdmUK\nICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdmVyaWZ5IFZhbGlkYXRpb24g\nTW9kZQogICAgICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0g\nZW0uZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBhc3NlcnROb3RO\ndWxsKGNvbmYpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWYWxpZGF0aW9u\nTW9kZSIsCiAgICAgICAgICAgICAgICBjb25mLmdldFZhbGlkYXRpb25Nb2Rl\nKCkuZXF1YWxzSWdub3JlQ2FzZSgiQVVUTyIpKTsKICAgICAgICAgICAgLy8g\nY3JlYXRlIGludmFsaWQgUGVyc29uIGluc3RhbmNlCiAgICAgICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgLy8gY3Jl\nYXRlIGEgdmFsaWQgUGVyc29uLCBtaW51cyB0aGUgYWRkcmVzcwogICAgICAg\nICAgICBQZXJzb24gcCA9IG5ldyBQZXJzb24oKTsKICAgICAgICAgICAgcC5z\nZXRGaXJzdE5hbWUoIkphdmEiKTsKICAgICAgICAgICAgcC5zZXRMYXN0TmFt\nZSgiSm9lIik7CiAgICAgICAgICAgIC8vIHVzZSBpbnZhbGlkIEFkZHJlc3Ms\nIHdoaWNoIHNob3VsZCBjYXVzZSBDVkVzIGR1ZSB0byBAVmFsaWQKICAgICAg\nICAgICAgLy9hID0gZW0uZ2V0UmVmZXJlbmNlKEFkZHJlc3MuY2xhc3MsIGEu\nZ2V0SWQoKSk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoYSk7CiAgICAg\nICAgICAgIHAuc2V0SG9tZUFkZHJlc3MoYSk7CiAgICAgICAgICAgIC8vIHBl\ncnNpc3QsIHdoaWNoIHNob3VsZCBjYXVzZSBhIENWRQogICAgICAgICAgICBl\nbS5wZXJzaXN0KHApOwogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigp\nLmNvbW1pdCgpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdFZh\nbGlkRmFpbHVyZXNDb25zdHJhaW50KCkgUGFydCAyIG9mIDIgZmFpbGVkIik7\nCiAgICAgICAgICAgIGZhaWwoIkV4cGVjdGVkIGEgQ29uc3RyYWludFZpb2xh\ndGlvbkV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKENvbnN0cmFpbnRW\naW9sYXRpb25FeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBleHBlY3Rl\nZAogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgiQ2F1Z2h0IGV4cGVjdGVk\nIENvbnN0cmFpbnRWaW9sYXRpb25FeGNlcHRpb24gPSAiICsgZSk7CiAgICAg\nICAgICAgIFNldDxDb25zdHJhaW50VmlvbGF0aW9uPD8+PiBjdmVzID0gZS5n\nZXRDb25zdHJhaW50VmlvbGF0aW9ucygpOwogICAgICAgICAgICBhc3NlcnRO\nb3ROdWxsKGN2ZXMpOwogICAgICAgICAgICBmb3IgKENvbnN0cmFpbnRWaW9s\nYXRpb248Pz4gY3Y6IGN2ZXMpIHsKICAgICAgICAgICAgICAgIGdldExvZygp\nLnRyYWNlKCJDVkUgQ29udGFpbnMgQ29uc3RyYWludFZpb2xhdGlvbiA9ICIg\nKyBjdi5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGFzc2VydEVxdWFscygiV3JvbmcgbnVtYmVyIG9mIGVtYmVkZGVkIENvbnN0\ncmFpbnRWaW9sYXRpb24gZmFpbHVyZXMiLAogICAgICAgICAgICAgICAgNSwg\nY3Zlcy5zaXplKCkpOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVz\ndFZhbGlkRmFpbHVyZXNDb25zdHJhaW50KCkgUGFydCAyIG9mIDIgcGFzc2Vk\nIik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChlbSAh\nPSBudWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAgaWYg\nKGVtLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAg\nICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAg\nICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSAgICAgICAgICAgIAogICAgfQogICAgCiAgICAvKioKICAgICAqIFNjZW5h\ncmlvIGJlaW5nIHRlc3RlZDoKICAgICAqICAgMjkpIFRlc3QgQFBhdHRlcm4g\nY29uc3RyYWludHMgcGFzcyBpbiBtb2RlPUFVVE8KICAgICAqICAgICAgIEJh\nc2ljIGNvbnN0cmFpbnQgdGVzdCBmb3Igbm8gdmlvbGF0aW9ucy4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgdGVzdFZhbGlkUGFzc0NvbnN0cmFpbnQoKSB7\nCiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RWYWxpZFBhc3NDb25zdHJh\naW50KCkgc3RhcnRlZCIpOwogICAgICAgIC8vIGNyZWF0ZSBFTSBmcm9tIGRl\nZmF1bHQgRU1GCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBl\nbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIGFzc2VydE5vdE51\nbGwoZW0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHByb3ZpZGUg\nYSB2YWxpZCBBZGRyZXNzCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9u\nKCkuYmVnaW4oKTsKICAgICAgICAgICAgQWRkcmVzcyBhID0gbmV3IEFkZHJl\nc3MoKTsKICAgICAgICAgICAgYS5zZXRTdHJlZXRBZGRyZXNzKCI0MjA1IFNv\ndXRoIE1pYW1pIEJsdmQuIik7CiAgICAgICAgICAgIGEuc2V0Q2l0eSgiUi5U\nLlAuIik7CiAgICAgICAgICAgIGEuc2V0U3RhdGUoIk5DIik7CiAgICAgICAg\nICAgIGEuc2V0UG9zdGFsQ29kZSgiMjc3MDkiKTsKICAgICAgICAgICAgLy8g\ncGVyc2lzdCwgd2hpY2ggc2hvdWxkIE5PVCBjYXVzZSBhIENWRQogICAgICAg\nICAgICBlbS5wZXJzaXN0KGEpOwogICAgICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLmNvbW1pdCgpOwoKICAgICAgICAgICAgLy8gY3JlYXRlIGEgdmFs\naWQgUGVyc29uCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVn\naW4oKTsKICAgICAgICAgICAgUGVyc29uIHAgPSBuZXcgUGVyc29uKCk7CiAg\nICAgICAgICAgIHAuc2V0Rmlyc3ROYW1lKCJKYXZhIik7CiAgICAgICAgICAg\nIHAuc2V0TGFzdE5hbWUoIkpvZSIpOwogICAgICAgICAgICBwLnNldEhvbWVB\nZGRyZXNzKGEpOwogICAgICAgICAgICAvLyBwZXJzaXN0LCB3aGljaCBzaG91\nbGQgTk9UIGNhdXNlIGEgQ1ZFCiAgICAgICAgICAgIGVtLnBlcnNpc3QocCk7\nCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAg\nICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0VmFsaWRQYXNzQ29uc3Ry\nYWludCgpIHBhc3NlZCIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIC8vIHVuZXhwZWN0ZWQKICAgICAgICAgICAgZ2V0\nTG9nKCkudHJhY2UoInRlc3RWYWxpZFBhc3NDb25zdHJhaW50KCkgZmFpbGVk\nIik7CiAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkIGV4Y2Vw\ndGlvbiA9ICIgKyBlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAoKGVtICE9IG51bGwpICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAg\nICAgICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQog\nICAgICAgICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJh\nY2soKTsKICAgICAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogSGVscGVyIG1l\ndGhvZCB0byByZW1vdmUgZW50aXRpZXMgYW5kIGNsb3NlIHRoZSBlbWYgYW4g\nYW55IG9wZW4gZW0ncy4KICAgICAqIEBwYXJhbSBlbWYKICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGNsZWFudXAoT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0\nb3J5U1BJIGVtZikgewogICAgICAgIGNsZWFyKGVtZik7CiAgICAgICAgY2xv\nc2VFTUYoZW1mKTsKICAgIH0KICAgICAgICAKICAgIC8qKgogICAgICogSW50\nZXJuYWwgY29udmVuaWVuY2UgbWV0aG9kIGZvciBnZXR0aW5nIHRoZSBPcGVu\nSlBBIGxvZ2dlcgogICAgICogCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAg\nIHByaXZhdGUgTG9nIGdldExvZygpIHsKICAgICAgICByZXR1cm4gZW1mLmdl\ndENvbmZpZ3VyYXRpb24oKS5nZXRMb2coIlRlc3RzIik7CiAgICB9Cn0K\n","encoding":"base64"}

