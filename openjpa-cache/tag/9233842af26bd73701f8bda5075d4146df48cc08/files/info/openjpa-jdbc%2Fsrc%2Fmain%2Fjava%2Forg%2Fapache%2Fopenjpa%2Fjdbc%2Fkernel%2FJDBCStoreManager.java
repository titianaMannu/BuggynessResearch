{"sha":"e6cafc951dec7ed0b180afe1849425563b026ee2","node_id":"MDQ6QmxvYjIwNjM2NDplNmNhZmM5NTFkZWM3ZWQwYjE4MGFmZTE4NDk0MjU1NjNiMDI2ZWUy","size":63089,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e6cafc951dec7ed0b180afe1849425563b026ee2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZh\nLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5z\ncWwuRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5o\nYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1p\nbmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZp\nZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuVmFsdWVNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuU3VwZXJjbGFzc0Rpc2NyaW1pbmF0b3JTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rp\nb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9p\nblN5bnRheGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJl\nc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxF\neGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNRTEZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNlbGVjdEV4ZWN1dG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlVuaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5Ccm9rZXJJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLkZpbmRlckNhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5Mb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nQ29u\nbmVjdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5E\nZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmpkYmMuRGVsZWdhdGluZ1N0YXRlbWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVj\ndFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVyYXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAq\nIFN0b3JlTWFuYWdlciBwbHVnaW4gdGhhdCB1c2VzIEpEQkMgdG8gc3RvcmUg\ncGVyc2lzdGVudCBkYXRhIGluIGEKICogcmVsYXRpb25hbCBkYXRhIHN0b3Jl\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgSkRCQ1N0b3JlTWFuYWdlciAKICAgIGltcGxlbWVudHMg\nU3RvcmVNYW5hZ2VyLCBKREJDU3RvcmUgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoSkRCQ1N0b3JlTWFuYWdlci5jbGFzcyk7CgogICAgcHJpdmF0\nZSBTdG9yZUNvbnRleHQgX2N0eCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkND\nb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgREJEaWN0\naW9uYXJ5IF9kaWN0ID0gbnVsbDsKICAgIHByaXZhdGUgU1FMRmFjdG9yeSBf\nc3FsID0gbnVsbDsKICAgIHByaXZhdGUgSkRCQ0xvY2tNYW5hZ2VyIF9sbSA9\nIG51bGw7CiAgICBwcml2YXRlIERhdGFTb3VyY2UgX2RzID0gbnVsbDsKICAg\nIHByaXZhdGUgUmVmQ291bnRDb25uZWN0aW9uIF9jb25uID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfYWN0aXZlID0gZmFsc2U7CgogICAgLy8gdHJh\nY2sgdGhlIHBlbmRpbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRo\nZW0KICAgIHByaXZhdGUgU2V0IF9zdG1udHMgPSBDb2xsZWN0aW9ucy5zeW5j\naHJvbml6ZWRTZXQobmV3IEhhc2hTZXQoKSk7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgQ29uc3RydWN0b3I8Q2xpZW50Q29ubmVjdGlvbj4gY2xpZW50\nQ29ubmVjdGlvbkltcGw7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDb25z\ndHJ1Y3RvcjxSZWZDb3VudENvbm5lY3Rpb24+IHJlZkNvdW50Q29ubmVjdGlv\nbkltcGw7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDb25zdHJ1Y3RvcjxD\nYW5jZWxTdGF0ZW1lbnQ+IGNhbmNlbFN0YXRlbWVudEltcGw7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBDb25zdHJ1Y3RvcjxDYW5jZWxQcmVwYXJlZFN0\nYXRlbWVudD4gY2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBsOwoKICAgIHN0\nYXRpYyB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY2xpZW50Q29ubmVj\ndGlvbkltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdldENvbmNyZXRl\nQ29uc3RydWN0b3IoQ2xpZW50Q29ubmVjdGlvbi5jbGFzcywgCiAgICAgICAg\nICAgICAgICBDb25uZWN0aW9uLmNsYXNzKTsKICAgICAgICAgICAgcmVmQ291\nbnRDb25uZWN0aW9uSW1wbCA9IENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IuZ2V0\nQ29uY3JldGVDb25zdHJ1Y3RvcihSZWZDb3VudENvbm5lY3Rpb24uY2xhc3Ms\nCiAgICAgICAgICAgICAgICBKREJDU3RvcmVNYW5hZ2VyLmNsYXNzLCBDb25u\nZWN0aW9uLmNsYXNzKTsKICAgICAgICAgICAgY2FuY2VsU3RhdGVtZW50SW1w\nbCA9IENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IuZ2V0Q29uY3JldGVDb25zdHJ1\nY3RvcihDYW5jZWxTdGF0ZW1lbnQuY2xhc3MsCiAgICAgICAgICAgICAgICBK\nREJDU3RvcmVNYW5hZ2VyLmNsYXNzLCBTdGF0ZW1lbnQuY2xhc3MsIENvbm5l\nY3Rpb24uY2xhc3MpOwogICAgICAgICAgICBjYW5jZWxQcmVwYXJlZFN0YXRl\nbWVudEltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdldENvbmNyZXRl\nQ29uc3RydWN0b3IoQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsCiAg\nICAgICAgICAgICAgICBKREJDU3RvcmVNYW5hZ2VyLmNsYXNzLCBQcmVwYXJl\nZFN0YXRlbWVudC5jbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEV4Y2VwdGlvbkluSW5pdGlhbGl6ZXJFcnJvcihlKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewog\nICAgICAgIHJldHVybiBfY3R4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndENvbnRleHQoU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIHNldENvbnRl\neHQoY3R4LCAoSkRCQ0NvbmZpZ3VyYXRpb24pIGN0eC5nZXRDb25maWd1cmF0\naW9uKCkpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRDb250ZXh0\nKFN0b3JlQ29udGV4dCBjdHgsIEpEQkNDb25maWd1cmF0aW9uIGNvbmYpIHsK\nICAgICAgICBfY3R4ID0gY3R4OwogICAgICAgIF9jb25mID0gY29uZjsKICAg\nICAgICBfZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7\nCiAgICAgICAgX3NxbCA9IF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgp\nOwoKICAgICAgICBMb2NrTWFuYWdlciBsbSA9IGN0eC5nZXRMb2NrTWFuYWdl\ncigpOwogICAgICAgIGlmIChsbSBpbnN0YW5jZW9mIEpEQkNMb2NrTWFuYWdl\ncikKICAgICAgICAgICAgX2xtID0gKEpEQkNMb2NrTWFuYWdlcikgbG07Cgog\nICAgICAgIGlmICghY3R4LmlzTWFuYWdlZCgpICYmIF9jb25mLmlzQ29ubmVj\ndGlvbkZhY3RvcnlNb2RlTWFuYWdlZCgpKQogICAgICAgICAgICBfZHMgPSBf\nY29uZi5nZXREYXRhU291cmNlMihjdHgpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX2RzID0gX2NvbmYuZ2V0RGF0YVNvdXJjZShjdHgpOwoKICAgICAg\nICBpZiAoX2NvbmYuZ2V0VXBkYXRlTWFuYWdlckluc3RhbmNlKCkub3JkZXJE\naXJ0eSgpKQogICAgICAgICAgICBjdHguc2V0T3JkZXJEaXJ0eU9iamVjdHMo\ndHJ1ZSk7CiAgICB9CgogICAgcHVibGljIEpEQkNDb25maWd1cmF0aW9uIGdl\ndENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jb25mOwogICAg\nfQoKICAgIHB1YmxpYyBEQkRpY3Rpb25hcnkgZ2V0REJEaWN0aW9uYXJ5KCkg\newogICAgICAgIHJldHVybiBfZGljdDsKICAgIH0KCiAgICBwdWJsaWMgU1FM\nRmFjdG9yeSBnZXRTUUxGYWN0b3J5KCkgewogICAgICAgIHJldHVybiBfc3Fs\nOwogICAgfQoKICAgIHB1YmxpYyBKREJDTG9ja01hbmFnZXIgZ2V0TG9ja01h\nbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sbTsKICAgIH0KCiAgICBwdWJs\naWMgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBnZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKSB7CiAgICAgICAgcmV0dXJuIChKREJDRmV0Y2hDb25maWd1cmF0aW9u\nKSBfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGJlZ2luT3B0aW1pc3RpYygpIHsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByb2xsYmFja09wdGltaXN0aWMoKSB7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYmVnaW4oKSB7CiAgICAgICAgX2FjdGl2ZSA9IHRydWU7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCghX2N0eC5pc01hbmFnZWQo\nKSB8fCAhX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkp\nCiAgICAgICAgICAgICAgICAmJiBfY29ubi5nZXRBdXRvQ29tbWl0KCkpCiAg\nICAgICAgICAgICAgICBfY29ubi5zZXRBdXRvQ29tbWl0KGZhbHNlKTsKICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\nX2FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRp\nb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoIV9jdHguaXNNYW5hZ2VkKCkgfHwgIV9jb25mLmlzQ29ubmVj\ndGlvbkZhY3RvcnlNb2RlTWFuYWdlZCgpKQogICAgICAgICAgICAgICAgX2Nv\nbm4uY29tbWl0KCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfY29ubi5y\nb2xsYmFjaygpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UyKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgU1FMRXhj\nZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBmYWxzZTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2soKSB7CiAgICAgICAgLy8g\nYWxyZWFkeSByb2xsZWQgYmFjayBvdXJzZWx2ZXM/CiAgICAgICAgaWYgKCFf\nYWN0aXZlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChfY29ubiAhPSBudWxsCiAgICAgICAgICAgICAgICAm\nJiAoIV9jdHguaXNNYW5hZ2VkKCkgfHwgIV9jb25mCiAgICAgICAgICAgICAg\nICAgICAgLmlzQ29ubmVjdGlvbkZhY3RvcnlNb2RlTWFuYWdlZCgpKSkKICAg\nICAgICAgICAgICAgIF9jb25uLnJvbGxiYWNrKCk7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4\nY2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJldGFpbkNvbm5lY3Rpb24oKSB7CiAg\nICAgICAgY29ubmVjdChmYWxzZSk7CiAgICAgICAgX2Nvbm4uc2V0UmV0YWlu\nKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VDb25uZWN0\naW9uKCkgewogICAgICAgIGlmIChfY29ubiAhPSBudWxsKQogICAgICAgICAg\nICBfY29ubi5zZXRSZXRhaW4oZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZ2V0Q2xpZW50Q29ubmVjdGlvbigpIHsKICAgICAgICByZXR1cm4g\nQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShjbGllbnRDb25u\nZWN0aW9uSW1wbCwgZ2V0Q29ubmVjdGlvbigpKTsKICAgIH0KCiAgICBwdWJs\naWMgQ29ubmVjdGlvbiBnZXRDb25uZWN0aW9uKCkgewogICAgICAgIGNvbm5l\nY3QodHJ1ZSk7CiAgICAgICAgcmV0dXJuIF9jb25uOwogICAgfQogICAgCiAg\nICBwcm90ZWN0ZWQgRGF0YVNvdXJjZSBnZXREYXRhU291cmNlKCkgewogICAg\nCXJldHVybiBfZHM7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZXhpc3Rz\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBjb250ZXh0KSB7CiAg\nICAgICAgLy8gYWRkIHdoZXJlIGNvbmRpdGlvbnMgb24gYmFzZSBjbGFzcyB0\nbyBhdm9pZCBqb2lucyBpZiBzdWJjbGFzcwogICAgICAgIC8vIGRvZXNuJ3Qg\ndXNlIG9pZCBhcyBpZGVudGlmaWVyCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAg\nICAgIHJldHVybiBleGlzdHMobWFwcGluZywgc20uZ2V0T2JqZWN0SWQoKSwg\nY29udGV4dCk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGV4aXN0cyhD\nbGFzc01hcHBpbmcgbWFwcGluZywgT2JqZWN0IG9pZCwgT2JqZWN0IGNvbnRl\neHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29uZGl0aW9ucyBvbiBiYXNl\nIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNsYXNzCiAgICAgICAgLy8g\nZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIKICAgICAgICBTZWxlY3Qg\nc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICB3aGlsZSAobWFwcGlu\nZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICBtYXBwaW5nID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3Vw\nZXJjbGFzc01hcHBpbmcoKTsKCiAgICAgICAgc2VsLndoZXJlUHJpbWFyeUtl\neShvaWQsIG1hcHBpbmcsIHRoaXMpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiBzZWwuZ2V0Q291bnQodGhpcykgIT0gMDsKICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cg\nU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVyc2lvbihPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIENs\nYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbWFw\ncGluZy5nZXRWZXJzaW9uKCkuY2hlY2tWZXJzaW9uKHNtLCB0aGlzLCB0cnVl\nKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3Qp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGNvbXBhcmVWZXJz\naW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc3RhdGUsIE9iamVjdCB2MSwgT2Jq\nZWN0IHYyKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xh\nc3NNYXBwaW5nKSBzdGF0ZS5nZXRNZXRhRGF0YSgpOwogICAgICAgIHJldHVy\nbiBtYXBwaW5nLmdldFZlcnNpb24oKS5jb21wYXJlVmVyc2lvbih2MSwgdjIp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGluaXRpYWxpemUoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBzdGF0ZSwKICAgICAgICBGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAgICAg\nICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IChDb25uZWN0aW9uSW5mbykgY29u\ndGV4dDsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gaW5pdGlh\nbGl6ZVN0YXRlKHNtLCBzdGF0ZSwgKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24p\nIGZldGNoLCAKICAgICAgICAgICAgICAgIGluZm8pOwogICAgICAgIH0gY2F0\nY2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZVNRTEV4Y2VwdGlvbihzbSwgc2UsIF9kaWN0\nLAogICAgICAgICAgICAgICAgZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGEg\nbmV3bHktbG9hZGVkIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBpbml0aWFsaXplU3RhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgUENTdGF0ZSBzdGF0ZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBDb25uZWN0aW9uSW5mbyBpbmZvKQogICAgICAgIHRocm93\ncyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewogICAg\nICAgIE9iamVjdCBvaWQgPSBzbS5nZXRPYmplY3RJZCgpOwogICAgICAgIENs\nYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICBSZXN1bHQgcmVzID0gbnVsbDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoaW5mbyAhPSBudWxsICYmIGluZm8ucmVz\ndWx0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJlcyA9IGluZm8ucmVz\ndWx0OwogICAgICAgICAgICAgICAgaW5mby5zbSA9IHNtOwogICAgICAgICAg\nICAgICAgaWYgKGluZm8ubWFwcGluZyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIGluZm8ubWFwcGluZyA9IG1hcHBpbmc7CiAgICAgICAgICAgICAg\nICBtYXBwaW5nID0gaW5mby5tYXBwaW5nOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKG9pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZAogICAgICAgICAgICAgICAg\nJiYgISgoT3BlbkpQQUlkKSBvaWQpLmhhc1N1YmNsYXNzZXMoKSkgewogICAg\nICAgICAgICAgICAgQm9vbGVhbiBjdXN0b20gPSBjdXN0b21Mb2FkKHNtLCBt\nYXBwaW5nLCBzdGF0ZSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYgKGN1\nc3RvbSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0\nb20uYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICByZXMgPSBnZXRJ\nbml0aWFsaXplU3RhdGVSZXN1bHQoc20sIG1hcHBpbmcsIGZldGNoLAogICAg\nICAgICAgICAgICAgICAgIFNlbGVjdC5TVUJTX0VYQUNUKTsKICAgICAgICAg\nICAgICAgIGlmIChyZXMgPT0gbnVsbCAmJiAhc2VsZWN0UHJpbWFyeUtleShz\nbSwgbWFwcGluZywgZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChpc0VtcHR5UmVzdWx0KHJl\ncykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nW10g\nbWFwcGluZ3MgPSBtYXBwaW5nLgogICAgICAgICAgICAgICAgICAgIGdldElu\nZGVwZW5kZW50QXNzaWduYWJsZU1hcHBpbmdzKCk7CiAgICAgICAgICAgICAg\nICBpZiAobWFwcGluZ3MubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAg\nICAgICBtYXBwaW5nID0gbWFwcGluZ3NbMF07CiAgICAgICAgICAgICAgICAg\nICAgQm9vbGVhbiBjdXN0b20gPSBjdXN0b21Mb2FkKHNtLCBtYXBwaW5nLCBz\ndGF0ZSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXN0b20g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1c3Rv\nbS5ib29sZWFuVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICByZXMgPSBn\nZXRJbml0aWFsaXplU3RhdGVSZXN1bHQoc20sIG1hcHBpbmcsIGZldGNoLAog\nICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3QuU1VCU19BTllfSk9JTkFC\nTEUpOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXMgPT0gbnVsbCAmJiAh\nc2VsZWN0UHJpbWFyeUtleShzbSwgbWFwcGluZywgZmV0Y2gpKQogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICByZXMgPSBnZXRJbml0aWFs\naXplU3RhdGVVbmlvblJlc3VsdChzbSwgbWFwcGluZywgbWFwcGluZ3MsCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZldGNoKTsKICAgICAgICAgICAgICAg\nIGlmIChpc0VtcHR5UmVzdWx0KHJlcykpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBm\naWd1cmUgb3V0IHdoYXQgdHlwZSBvZiBvYmplY3QgdGhpcyBpczsgdGhlIHN0\nYXRlIG1hbmFnZXIKICAgICAgICAgICAgLy8gb25seSBndWFyYW50ZWVzIHRv\nIHByb3ZpZGUgYSBiYXNlIGNsYXNzCiAgICAgICAgICAgIENsYXNzIHR5cGU7\nCiAgICAgICAgICAgIGlmICgodHlwZSA9IGdldFR5cGUocmVzLCBtYXBwaW5n\nKSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHJlcy5nZXRCYXNl\nTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWFwcGlu\nZyA9IHJlcy5nZXRCYXNlTWFwcGluZygpOwogICAgICAgICAgICAgICAgcmVz\nLnN0YXJ0RGF0YVJlcXVlc3QobWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkp\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB0\neXBlID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0Q2xhc3ModGhp\ncywgbWFwcGluZywKICAgICAgICAgICAgICAgICAgICAgICAgcmVzKTsKICAg\nICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAg\ncmVzLmVuZERhdGFSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHN0YXRl\nIG1hbmFnZXI7IHRoaXMgbWF5IGNoYW5nZSB0aGUgbWFwcGluZwogICAgICAg\nICAgICAvLyBhbmQgdGhlIG9iamVjdCBpZCBpbnN0YW5jZSBpZiB0aGUgdHlw\nZSBhcyBkZXRlcm1pbmVkCiAgICAgICAgICAgIC8vIGZyb20gdGhlIGluZGlj\nYXRvciBpcyBhIHN1YmNsYXNzIG9mIGV4cGVjdGVkIHR5cGUKICAgICAgICAg\nICAgc20uaW5pdGlhbGl6ZSh0eXBlLCBzdGF0ZSk7CgogICAgICAgICAgICBp\nZiAoaW5mbyAhPSBudWxsICYmIGluZm8ucmVzdWx0ICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWRCeUZpZWxkTWFwcGlu\nZyA9IGluZm8ucmVzdWx0LgogICAgICAgICAgICAgICAgICAgIGdldE1hcHBl\nZEJ5RmllbGRNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBPYmplY3QgbWFw\ncGVkQnlPYmplY3QgPSBpbmZvLnJlc3VsdC5nZXRNYXBwZWRCeVZhbHVlKCk7\nCiAgICAgICAgICAgICAgICBpZiAobWFwcGVkQnlGaWVsZE1hcHBpbmcgIT0g\nbnVsbCAmJiBtYXBwZWRCeU9iamVjdCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIGlmIChtYXBwZWRCeU9iamVjdCBpbnN0YW5jZW9mIE9wZW5KUEFJ\nZCAmJgogICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nLmdldEV4dHJh\nRmllbGREYXRhSW5kZXgobWFwcGVkQnlGaWVsZE1hcHBpbmcuCiAgICAgICAg\nICAgICAgICAgICAgICAgIGdldEluZGV4KCkpICE9IC0xKQogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBUaGUgaW52ZXJzZSByZWxhdGlvbiBjYW4gbm90\nIGJlIHNldCBzaW5jZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBh\ncmUgZWFnZXJseSBsb2FkaW5nIHRoaXMgc20gZm9yCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGEgc20gb3duZXIgdGhhdCBpcyBzdGlsbCBpbiB0aGUg\ncHJvY2VzcyBvZiAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5pdGlh\nbGl6aW5nIGl0c2VsZi4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVt\nZW1iZXIgb3duZXIgb2lkIGJ5IHNldEludGVybWVkaWF0ZSgpLgogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBUaGUgaW52ZXJzZSByZWxhdGlvbiBpcyBz\nZXQgbGF0ZXIgYnkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0SW52\nZXJzZVJlbGF0aW9uKCkgd2hlbiB0aGUgc20gb3duZXIgaXMgZnVsbHkKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZWQuCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnNldEludGVybWVkaWF0ZShtYXBwZWRCeUZp\nZWxkTWFwcGluZy5nZXRJbmRleCgpLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbWFwcGVkQnlPYmplY3QpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgc2V0TWFwcGVkQnkoc20sIG1h\ncHBlZEJ5RmllbGRNYXBwaW5nLCBtYXBwZWRCeU9iamVjdCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gbG9hZCB0aGUgc2VsZWN0ZWQgbWFwcGlu\nZ3MgaW50byB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlcgogICAgICAgICAgICBp\nZiAocmVzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIHJlLWdldCB0\naGUgbWFwcGluZyBpbiBjYXNlIHRoZSBpbnN0YW5jZSB3YXMgYSBzdWJjbGFz\ncwogICAgICAgICAgICAgICAgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNt\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICBsb2FkKG1hcHBpbmcs\nIHNtLCBmZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIGdldFZlcnNpb24o\nbWFwcGluZywgc20sIHJlcyk7CiAgICAgICAgICAgICAgICBzZXRJbnZlcnNl\nUmVsYXRpb24oc20sIG1hcHBpbmcsIHJlcyk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKHJlcyAhPSBudWxsICYmIChpbmZvID09IG51bGwgfHwg\ncmVzICE9IGluZm8ucmVzdWx0KSkKICAgICAgICAgICAgICAgIHJlcy5jbG9z\nZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc2V0SW52\nZXJzZVJlbGF0aW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgb3duZXIsCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFJlc3VsdCByZXMpIHsKICAgICAg\nICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldEZpZWxkTWFwcGlu\nZ3MoKTsKCiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCwgdGhlIG93bmVyIGlz\nIGZ1bGx5IGluaXRpYWxpemVkLgogICAgICAgIC8vIENoZWNrIGlmIHRoZSBv\nd25lciBoYXMgZWFnZXJseSBsb2FkZWQgVG9NYW55IHJlbGF0aW9ucy4KICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBpZiAocmVzLmdldEVhZ2VyKGZtc1tpXSkgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgaWYgKGZtc1tpXS5pc0VsZW1lbnRDb2xsZWN0\naW9uKCkgJiYgIWZtc1tpXS5nZXRFbGVtZW50KCkuaXNUeXBlUEMoKSkKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIE9i\namVjdCBjb2xsID0gIG93bmVyLmZldGNoT2JqZWN0KGZtc1tpXS5nZXRJbmRl\neCgpKTsKICAgICAgICAgICAgICAgIGlmIChjb2xsIGluc3RhbmNlb2YgTWFw\nKQogICAgICAgICAgICAgICAgICAgIGNvbGwgPSAoKE1hcCljb2xsKS52YWx1\nZXMoKTsKICAgICAgICAgICAgICAgIGlmIChjb2xsIGluc3RhbmNlb2YgQ29s\nbGVjdGlvbiAmJiAKICAgICAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb24p\nIGNvbGwpLnNpemUoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBG\nb3VuZCBlYWdlcmx5IGxvYWRlZCBjb2xsZWN0aW9uLgogICAgICAgICAgICAg\nICAgICAgIC8vIFB1Ymxpc2hlciAoMSkgPD09PiAgKE0pIE1hZ2F6aW5lCiAg\nICAgICAgICAgICAgICAgICAgLy8gICAgcHVibGlzaGVyIGhhcyBhIEVBR0VS\nIE9uZVRvTWFueSByZWxhdGlvbgogICAgICAgICAgICAgICAgICAgIC8vICAg\nIG1hZ2F6aW5lIGhhcyBhIEVBR0VSIG9yIExBWlkgTWFueVRvT25lIHB1Ymxp\nc2hlcgogICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIG1lbWJlciAo\nTWFnYXppbmUpIGluIHRoZSBjb2xsZWN0aW9uLCAKICAgICAgICAgICAgICAg\nICAgICAvLyBzZXQgaXRzIGludmVyc2UgcmVsYXRpb24gKFB1Ymxpc2hlciku\nCiAgICAgICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSAoKENv\nbGxlY3Rpb24pIGNvbGwpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFi\nbGUpIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\ncGMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBwYy4KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtZCA9ICgoQ2xh\nc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBmbWQubGVuZ3RoOyBq\nKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdCBvaWQg\nPSBzbS5nZXRJbnRlcm1lZGlhdGUoZm1kW2pdLmdldEluZGV4KCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgb2lkIHdhcyBzZXRJbnRl\ncm1lZGlhdGUoKSBwcmV2aW91c2x5CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBhbmQgaXQgaXMgdGhlIHNhbWUgYXMgdGhlIG93bmVyLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlbiBzZXQgdGhlIGludmVy\nc2UgcmVsYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChv\naWQgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG9pZC5lcXVhbHMob3duZXIuZ2V0T2JqZWN0SWQoKSkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBzbS5zdG9yZU9iamVjdChmbWRbal0u\nZ2V0SW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgb3duZXIuZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHNldE1h\ncHBlZEJ5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgRmllbGRN\nYXBwaW5nIG1hcHBlZEJ5RmllbGRNYXBwaW5nLCBPYmplY3QgbWFwcGVkQnlP\nYmplY3QpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFz\nc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgRmllbGRNYXBw\naW5nW10gZm1zID0gbWFwcGluZy5nZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGZtc1tpXSA9PSBtYXBwZWRCeUZpZWxkTWFwcGluZykg\newogICAgICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZm1zW2ldLmdldElu\nZGV4KCksIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5v\nbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9m\nIGdldHRpbmcgdmVyc2lvbiBmcm9tIHRoZSByZXN1bHQgc2V0LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBnZXRWZXJzaW9uKENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIFJlc3Vs\ndCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIG1hcHBpbmcu\nZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVy\ncmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVt\nZW50YXRpb24gb2YgY2hlY2tpbmcgd2hldGhlciB0aGUgcmVzdWx0IHNldCBp\ncyBlbXB0eSBvciBub3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFu\nIGlzRW1wdHlSZXN1bHQoUmVzdWx0IHJlcykgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKHJlcyAhPSBudWxsICYmICFyZXMubmV4dCgpKQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8g\ncHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAog\nICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyB0eXBlIGZyb20gdGhl\nIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzcyBnZXRU\neXBlKFJlc3VsdCByZXMsIENsYXNzTWFwcGluZyBtYXBwaW5nKXsKICAgICAg\nICBpZiAocmVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtYXBwaW5n\nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFsbG93IHRoZSBtYXBwaW5nIHRvIGN1c3Rv\nbSBsb2FkIGRhdGEuIFJldHVybiBudWxsIGlmIHRoZSBtYXBwaW5nCiAgICAg\nKiBkb2VzIG5vdCB1c2UgY3VzdG9tIGxvYWRpbmcuCiAgICAgKi8KICAgIHBy\naXZhdGUgQm9vbGVhbiBjdXN0b21Mb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIFBDU3RhdGUgc3Rh\ndGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhy\nb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBtYXBwaW5nIHRha2VzIGNh\ncmUgb2YgaW5pdGlhbGl6YXRpb24KICAgICAgICBpZiAoIW1hcHBpbmcuY3Vz\ndG9tTG9hZChzbSwgdGhpcywgc3RhdGUsIGZldGNoKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHNtLmdldE1hbmFnZWRJbnN0YW5j\nZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9u\nKCkuYWZ0ZXJMb2FkKHNtLCB0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIEJv\nb2xlYW4uVFJVRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEJvb2xlYW4u\nRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGRhdGEg\nZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSBhbmQgcmV0dXJuIHRoZSByZXN1bHQu\nIFJldHVybgogICAgICogbnVsbCBpZiB0aGVyZSBpcyBubyBkYXRhIGluIHRo\nZSBjdXJyZW50IGZldGNoIGdyb3VwcyB0byBzZWxlY3QuCiAgICAgKi8KICAg\nIHByaXZhdGUgUmVzdWx0IGdldEluaXRpYWxpemVTdGF0ZVJlc3VsdChPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBw\naW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgc3VicykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBGaW5kZXJR\ndWVyeUltcGwgZnEgPSBnZXRGaW5kZXIobWFwcGluZywgZmV0Y2gpOwogICAg\nICAgIGlmIChmcSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZnEuZXhl\nY3V0ZShzbSwgdGhpcywgZmV0Y2gpOwogICAgICAgIFNlbGVjdCBzZWwgPSBf\nc3FsLm5ld1NlbGVjdCgpOwogICAgICAgIGlmICghc2VsZWN0KHNlbCwgbWFw\ncGluZywgc3Vicywgc20sIG51bGwsIGZldGNoLAogICAgICAgICAgICBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sIHRydWUsIGZhbHNlKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgc2VsLndoZXJlUHJp\nbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0aGlzKTsKICAg\nICAgICBzZWwuc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgxLCBmYWxzZSk7CiAg\nICAgICAgUmVzdWx0IHJlc3VsdCA9IHNlbC5leGVjdXRlKHRoaXMsIGZldGNo\nKTsKICAgICAgICBjYWNoZUZpbmRlcihtYXBwaW5nLCBzZWwsIGZldGNoKTsK\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICog\nU2VsZWN0IGEgdW5pb24gb2YgdGhlIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnN0\nYW5jZSBmcm9tIHBvc3NpYmxlIGNvbmNyZXRlCiAgICAgKiBtYXBwaW5ncyBh\nbmQgcmV0dXJuIHRoZSByZXN1bHQuCiAgICAgKi8KICAgIHByaXZhdGUgUmVz\ndWx0IGdldEluaXRpYWxpemVTdGF0ZVVuaW9uUmVzdWx0KGZpbmFsIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIGZpbmFsIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzLAogICAgICAgIGZp\nbmFsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIEZpbmRlclF1ZXJ5SW1wbCBmcSA9IGdldEZp\nbmRlcihtYXBwaW5nLCBmZXRjaCk7CiAgICAgICAgaWYgKGZxICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmcS5leGVjdXRlKHNtLCB0aGlzLCBmZXRj\naCk7CiAgICAgICAgZmluYWwgSkRCQ1N0b3JlTWFuYWdlciBzdG9yZSA9IHRo\naXM7CiAgICAgICAgZmluYWwgaW50IGVhZ2VyID0gTWF0aC5taW4oZmV0Y2gu\nZ2V0RWFnZXJGZXRjaE1vZGUoKSwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbi5FQUdFUl9KT0lOKTsKCiAgICAgICAgVW5pb24gdW5pb24g\nPSBfc3FsLm5ld1VuaW9uKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgdW5p\nb24uc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgxLCBmYWxzZSk7CiAgICAgICAg\naWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGZl\ndGNoLkVBR0VSX0pPSU4pCiAgICAgICAgICAgIHVuaW9uLmFib3J0VW5pb24o\nKTsKICAgICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkg\newogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwg\naW50IGkpIHsKICAgICAgICAgICAgICAgIHNlbC5zZWxlY3QobWFwcGluZ3Nb\naV0sIFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSwgc3RvcmUsIGZldGNoLAog\nICAgICAgICAgICAgICAgICAgIGVhZ2VyKTsKICAgICAgICAgICAgICAgIHNl\nbC53aGVyZVByaW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZ3Nb\naV0sIHN0b3JlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAg\nIFJlc3VsdCByZXN1bHQgPSB1bmlvbi5leGVjdXRlKHRoaXMsIGZldGNoKTsK\nICAgICAgICBjYWNoZUZpbmRlcihtYXBwaW5nLCB1bmlvbiwgZmV0Y2gpOwog\nICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZWxlY3QgcHJpbWFyeSBrZXkgZGF0YSB0byBtYWtlIHN1cmUgdGhlIGdpdmVu\nIGluc3RhbmNlIGV4aXN0cywgbG9ja2luZwogICAgICogaWYgbmVlZGVkLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc2VsZWN0UHJpbWFyeUtleShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIHNlbGVjdCBwa3Mg\nZnJvbSBiYXNlIGNsYXNzIHJlY29yZCB0byBlbnN1cmUgaXQgZXhpc3RzIGFu\nZCBsb2NrCiAgICAgICAgLy8gaXQgaWYgbmVlZGVkCiAgICAgICAgQ2xhc3NN\nYXBwaW5nIGJhc2UgPSBtYXBwaW5nOwogICAgICAgIHdoaWxlIChiYXNlLmdl\ndEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAg\nICAgICAgIGJhc2UgPSBiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFw\ncGluZygpOwoKICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3Qo\nKTsKICAgICAgICBzZWwuc2VsZWN0KGJhc2UuZ2V0UHJpbWFyeUtleUNvbHVt\nbnMoKSk7CiAgICAgICAgc2VsLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmpl\nY3RJZCgpLCBiYXNlLCB0aGlzKTsKICAgICAgICBSZXN1bHQgZXhpc3RzID0g\nc2VsLmV4ZWN1dGUodGhpcywgZmV0Y2gpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChpc0VtcHR5UmVzdWx0KGV4aXN0cykpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAvLyByZWNvcmQgbG9j\na2VkPwogICAgICAgICAgICBpZiAoX2FjdGl2ZSAmJiBfbG0gIT0gbnVsbCAm\nJiBleGlzdHMuaXNMb2NraW5nKCkpCiAgICAgICAgICAgICAgICBfbG0ubG9h\nZGVkRm9yVXBkYXRlKHNtKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZXhpc3RzLmNsb3NlKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGxvYWQoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2NrTGV2ZWwsIE9iamVj\ndCBjb250ZXh0KSB7CiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBq\nZmV0Y2ggPSAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgZmV0Y2g7CgogICAg\nICAgIC8vIGdldCBhIGNvbm5lY3Rpb24sIG9yIHJldXNlIGN1cnJlbnQgb25l\nCiAgICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IChDb25uZWN0aW9uSW5m\nbykgY29udGV4dDsKICAgICAgICBSZXN1bHQgcmVzID0gbnVsbDsKICAgICAg\nICBpZiAoaW5mbyAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIGluaXRp\nYWxpemUoKSBmYWlscyB0byBsb2FkIHJlcXVpcmVkIGZpZWxkcywgdGhlbiB0\naGlzIG1ldGhvZAogICAgICAgICAgICAvLyBpcyBjYWxsZWQ7IG1ha2Ugc3Vy\nZSBub3QgdG8gdHJ5IHRvIHVzZSB0aGUgZ2l2ZW4gcmVzdWx0IGlmIGl0J3MK\nICAgICAgICAgICAgLy8gdGhlIHNhbWUgb25lIHdlIGp1c3QgZmFpbGVkIHRv\nIGNvbXBsZXRlbHkgaW5pdGlhbGl6ZSgpIHdpdGgKICAgICAgICAgICAgaWYg\nKGluZm8uc20gIT0gc20pCiAgICAgICAgICAgICAgICByZXMgPSBpbmZvLnJl\nc3VsdDsKICAgICAgICAgICAgaW5mby5zbSA9IG51bGw7CiAgICAgICAgfQog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYW4gZXhp\nc3RpbmcgcmVzdWx0LCBsb2FkIGFsbCB3ZSBjYW4gZnJvbSBpdAogICAgICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNt\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgbG9hZChtYXBwaW5nLCBzbSwgamZldGNoLCBy\nZXMpOwogICAgICAgICAgICAgICAgcmVtb3ZlTG9hZGVkRmllbGRzKHNtLCBm\naWVsZHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB0aGUg\naW5zdGFuY2UgaXMgaG9sbG93IGFuZCB0aGVyZSdzIGEgY3VzdG9taXplZAog\nICAgICAgICAgICAvLyBnZXQgYnkgaWQgbWV0aG9kLCB1c2UgaXQKICAgICAg\nICAgICAgaWYgKHNtLmdldExvYWRlZCgpLmxlbmd0aCgpID09IDAgCiAgICAg\nICAgICAgICAgICAmJiBtYXBwaW5nLmN1c3RvbUxvYWQoc20sIHRoaXMsIG51\nbGwsIGpmZXRjaCkpCiAgICAgICAgICAgICAgICByZW1vdmVMb2FkZWRGaWVs\nZHMoc20sIGZpZWxkcyk7CgogICAgICAgICAgICAvLyMjIyBzZWxlY3QgaXMg\na2luZCBvZiBhIGJpZyBvYmplY3QsIGFuZCBpbiBzb21lIGNhc2VzIHdlIGRv\nbid0CiAgICAgICAgICAgIC8vIyMjIHVzZSBpdC4uLiB3b3VsZCBpdCBiZSB3\nb3J0aCBpdCB0byBoYXZlIGEgc21hbGwgc2hlbGwgc2VsZWN0CiAgICAgICAg\nICAgIC8vIyMjIG9iamVjdCB0aGF0IG9ubHkgY3JlYXRlcyBhIHJlYWwgc2Vs\nZWN0IHdoZW4gYWN0dWFsbHkgdXNlZD8KCiAgICAgICAgICAgIFNlbGVjdCBz\nZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgICAgICBpZiAoc2VsZWN0\nKHNlbCwgbWFwcGluZywgU2VsZWN0LlNVQlNfRVhBQ1QsIHNtLCBmaWVsZHMs\nIGpmZXRjaCwKICAgICAgICAgICAgICAgIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdF\nUl9KT0lOLCB0cnVlLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIHNlbC53\naGVyZVByaW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZywgdGhp\ncyk7CiAgICAgICAgICAgICAgICByZXMgPSBzZWwuZXhlY3V0ZSh0aGlzLCBq\nZmV0Y2gsIGxvY2tMZXZlbCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgIAlpZiAoaXNFbXB0eVJlc3VsdChyZXMpKQogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAg\nICAgICAgbG9hZChtYXBwaW5nLCBzbSwgamZldGNoLCByZXMpOwogICAgICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICByZXMu\nY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gbm93IGFsbG93IHRoZSBmaWVsZHMgdG8gbG9hZCB0aGVt\nc2VsdmVzIGluZGl2aWR1YWxseSB0b28KICAgICAgICAgICAgRmllbGRNYXBw\naW5nW10gZm1zID0gbWFwcGluZy5nZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgaWYgKGZpZWxkcy5nZXQoaSkgJiYgIXNtLmdldExv\nYWRlZCgpLmdldChpKSkKICAgICAgICAgICAgICAgICAgICBmbXNbaV0ubG9h\nZChzbSwgdGhpcywgamZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pKTsKICAg\nICAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNtLCB0\naGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRj\naCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGxpc3QgZm9ybWVkIGJ5IHJl\nbW92aW5nIGFsbCBsb2FkZWQgZmllbGRzIGZyb20gdGhlIGdpdmVuIG9uZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUxvYWRlZEZpZWxkcyhP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzKSB7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IGZpZWxkcy5sZW5ndGgoKTsgaSA8\nIGxlbjsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSAmJiBz\nbS5nZXRMb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAgICAgICBmaWVsZHMu\nY2xlYXIoaSk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gbG9hZEFs\nbChDb2xsZWN0aW9uIHNtcywgUENTdGF0ZSBzdGF0ZSwgaW50IGxvYWQsCiAg\nICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4\ndCkgewogICAgICAgIHJldHVybiBJbXBsSGVscGVyLmxvYWRBbGwoc21zLCB0\naGlzLCBzdGF0ZSwgbG9hZCwgZmV0Y2gsIGNvbnRleHQpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGJlZm9yZVN0YXRlQ2hhbmdlKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIFBDU3RhdGUgZnJvbVN0YXRlLAogICAgICAgIFBDU3RhdGUg\ndG9TdGF0ZSkgewogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGZsdXNo\nKENvbGxlY3Rpb24gc21zKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKF9jb25uICE9IG51bGwgJiYgX2Nvbm4uZ2V0SW5uZXJtb3N0RGVsZWdh\ndGUoKS5pc1JlYWRPbmx5KCkpCiAgICAgICAgICAgICAgICBfY29ubi5zZXRS\nZWFkT25seShmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIGUpIHsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jb25mLmdldFVwZGF0\nZU1hbmFnZXJJbnN0YW5jZSgpLmZsdXNoKHNtcywgdGhpcyk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gY2FuY2VsQWxsKCkgewogICAgICAgIC8vIG5v\ndGUgdGhhdCB0aGlzIG1ldGhvZCBkb2VzIG5vdCBsb2NrIHRoZSBjb250ZXh0\nLCBzaW5jZQogICAgICAgIC8vIHdlIHdhbnQgdG8gYWxsb3cgYSBkaWZmZXJl\nbnQgdGhyZWFkIHRvIGJlIGFibGUgdG8gY2FuY2VsIHRoZQogICAgICAgIC8v\nIG91dHN0YW5kaW5nIHN0YXRlbWVudCBvbiBhIGRpZmZlcmVudCBjb250ZXh0\nCgogICAgICAgIENvbGxlY3Rpb24gc3RtbnRzOwogICAgICAgIHN5bmNocm9u\naXplZCAoX3N0bW50cykgewogICAgICAgICAgICBpZiAoX3N0bW50cy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIHN0bW50cyA9IG5ldyBBcnJheUxpc3QoX3N0bW50cyk7CiAgICAgICAg\nfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHN0bW50cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgICgoU3RhdGVtZW50KSBpdHIubmV4dCgpKS5jYW5jZWwoKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gYXNzaWduT2JqZWN0SWQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBM\nSUNBVElPTikKICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmFz\nc2lnbihzbSwgdGhpcywgcHJlRmx1c2gpOwoKICAgICAgICAvLyBkYXRhc3Rv\ncmUgaWRlbnRpdHkKICAgICAgICBPYmplY3QgdmFsID0gSW1wbEhlbHBlci5n\nZW5lcmF0ZUlkZW50aXR5VmFsdWUoX2N0eCwgbWV0YSwKICAgICAgICAgICAg\nSmF2YVR5cGVzLkxPTkcpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCAmJiBt\nZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSAhPSBWYWx1ZVN0cmF0ZWdpZXMu\nTkFUSVZFKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICB2YWwgPSBnZXREYXRhU3RvcmVJ\nZFNlcXVlbmNlKG1ldGEpLm5leHQoX2N0eCwgbWV0YSk7CiAgICAgICAgc20u\nc2V0T2JqZWN0SWQobmV3RGF0YVN0b3JlSWQodmFsLCBtZXRhKSk7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYXNz\naWduRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50IGZpZWxkLAog\nICAgICAgIGJvb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIE9iamVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVyYXRlRmllbGRW\nYWx1ZShfY3R4LCBmbWQpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHNtLnN0b3JlKGZpZWxk\nLCB2YWwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzcyBnZXRNYW5hZ2VkVHlwZShPYmplY3Qgb2lkKSB7CiAgICAgICAg\naWYgKG9pZCBpbnN0YW5jZW9mIElkKQogICAgICAgICAgICByZXR1cm4gKChJ\nZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgcHVibGljIENsYXNzIGdldERhdGFTdG9yZUlkVHlwZShDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gSWQuY2xhc3M7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBjb3B5RGF0YVN0b3JlSWQoT2JqZWN0IG9p\nZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgSWQgaWQgPSAoSWQp\nIG9pZDsKICAgICAgICByZXR1cm4gbmV3IElkKG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLCBpZC5nZXRJZCgpLCBpZC5oYXNTdWJjbGFzc2VzKCkpOwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RGF0YVN0b3JlSWQoT2JqZWN0IHZh\nbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIElkLm5l\nd0luc3RhbmNlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB2YWwpOwogICAg\nfQoKICAgIHB1YmxpYyBJZCBuZXdEYXRhU3RvcmVJZChsb25nIGlkLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBzdWJzKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBJZChtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSwgaWQsIHN1\nYnMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBl\neGVjdXRlRXh0ZW50KENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBmaW5h\nbCBib29sZWFuIHN1YmNsYXNzZXMsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFw\ncGluZykgbWV0YTsKICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdbXSBtYXBw\naW5nczsKICAgICAgICBpZiAoc3ViY2xhc3NlcykKICAgICAgICAgICAgbWFw\ncGluZ3MgPSBtYXBwaW5nLmdldEluZGVwZW5kZW50QXNzaWduYWJsZU1hcHBp\nbmdzKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtYXBwaW5ncyA9IG5l\ndyBDbGFzc01hcHBpbmdbXSB7IG1hcHBpbmcgfTsKCiAgICAgICAgUmVzdWx0\nT2JqZWN0UHJvdmlkZXJbXSByb3BzID0gbnVsbDsKICAgICAgICBmaW5hbCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGpmZXRjaCA9IChKREJDRmV0Y2hDb25m\naWd1cmF0aW9uKSBmZXRjaDsKICAgICAgICBpZiAoamZldGNoLmdldFN1YmNs\nYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGpmZXRjaC5FQUdFUl9KT0lOKQog\nICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVyW21h\ncHBpbmdzLmxlbmd0aF07CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8v\nIGNoZWNrIGZvciBjdXN0b20gbG9hZHMKICAgICAgICAgICAgUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIgcm9wOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBy\nb3AgPSBtYXBwaW5nc1tpXS5jdXN0b21Mb2FkKHRoaXMsIHN1YmNsYXNzZXMs\nIGpmZXRjaCwgMCwKICAgICAgICAgICAgICAgICAgICBMb25nLk1BWF9WQUxV\nRSk7CiAgICAgICAgICAgICAgICBpZiAocm9wICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAocm9wcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVyW21h\ncHBpbmdzLmxlbmd0aF07CiAgICAgICAgICAgICAgICAgICAgcm9wc1tpXSA9\nIHJvcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gaWYgd2UncmUgc2VsZWN0aW5nIGluZGVwZW5kZW50IG1hcHBp\nbmdzIHNlcGFyYXRlbHkgb3IgaGF2ZQogICAgICAgICAgICAvLyBjdXN0b20g\nbG9hZHMsIGRvIGluZGl2aWR1YWwgc2VsZWN0cyBmb3IgZWFjaCBjbGFzcwog\nICAgICAgICAgICByb3AgPSBudWxsOwogICAgICAgICAgICBpZiAocm9wcyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHJvcHNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIFNlbGVjdCBzZWwgPSBf\nc3FsLm5ld1NlbGVjdCgpOwogICAgICAgICAgICAgICAgICAgIHNlbC5zZXRM\nUlModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgQml0U2V0IHBhZ2VkID0g\nc2VsZWN0RXh0ZW50KHNlbCwgbWFwcGluZ3NbaV0sIGpmZXRjaCwKICAgICAg\nICAgICAgICAgICAgICAgICAgc3ViY2xhc3Nlcyk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJvcHNbaV0gPSBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRl\ncihzZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nc1tp\nXSwgdGhpcywgamZldGNoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJvcHNbaV0gPSBuZXcgUGFnaW5nUmVz\ndWx0T2JqZWN0UHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbWFwcGluZ3NbaV0sIHRoaXMsIGpmZXRjaCwgcGFnZWQsIExvbmcu\nTUFYX1ZBTFVFKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGlmIChyb3BzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiByb3BzWzBdOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNZXJn\nZWRSZXN1bHRPYmplY3RQcm92aWRlcihyb3BzKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gcGVyZm9ybSBhIHVuaW9uIG9uIGFsbCBpbmRlcGVu\nZGVudCBjbGFzc2VzCiAgICAgICAgICAgIFVuaW9uIHVuaW9uID0gX3NxbC5u\nZXdVbmlvbihtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgICAgICB1bmlvbi5z\nZXRMUlModHJ1ZSk7CiAgICAgICAgICAgIGZpbmFsIEJpdFNldFtdIHBhZ2Vk\nID0gbmV3IEJpdFNldFttYXBwaW5ncy5sZW5ndGhdOwogICAgICAgICAgICB1\nbmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGludCBpZHgp\nIHsKICAgICAgICAgICAgICAgICAgICBwYWdlZFtpZHhdID0gc2VsZWN0RXh0\nZW50KHNlbCwgbWFwcGluZ3NbaWR4XSwgamZldGNoLAogICAgICAgICAgICAg\nICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyB1c2luZyBwYWdpbmcgcm9w\nIGlmIGFueSB1bmlvbiBlbGVtZW50IGhhcyBwYWdlZCBmaWVsZHMKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYWdlZC5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgaWYgKHBhZ2VkW2ldICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWdpbmdSZXN1bHRPYmplY3RQ\ncm92aWRlcih1bmlvbiwgbWFwcGluZ3MsCiAgICAgICAgICAgICAgICAgICAg\nICAgIEpEQkNTdG9yZU1hbmFnZXIudGhpcywgamZldGNoLCBwYWdlZCwgTG9u\nZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcih1bmlvbiwgbWFw\ncGluZ3NbMF0sIHRoaXMsCiAgICAgICAgICAgICAgICBqZmV0Y2gpOwogICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0\naHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBnaXZlbiBt\nYXBwaW5nIGZvciB1c2UgaW4gYW4gZXh0ZW50LCByZXR1cm5pbmcgcGFnZWQg\nZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIEJpdFNldCBzZWxlY3RFeHRl\nbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBzdWJjbGFz\nc2VzKSB7CiAgICAgICAgaW50IHN1YnMgPSAoc3ViY2xhc3NlcykgPyBTZWxl\nY3QuU1VCU19KT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05PTkU7CiAgICAgICAg\nLy8gZGVjaWRlIGJldHdlZW4gcGFnaW5nIGFuZCBzdGFuZGFyZCBpdGVyYXRp\nb24KICAgICAgICBCaXRTZXQgcGFnZWQgPSBQYWdpbmdSZXN1bHRPYmplY3RQ\ncm92aWRlci5nZXRQYWdlZEZpZWxkcyhzZWwsIG1hcHBpbmcsCiAgICAgICAg\nICAgIHRoaXMsIGZldGNoLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VS\nX1BBUkFMTEVMLAogICAgICAgICAgICBMb25nLk1BWF9WQUxVRSk7CiAgICAg\nICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgIHNlbC5zZWxlY3RJ\nZGVudGlmaWVyKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAogICAgICAg\nICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9QQVJBTExF\nTCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWwuc2VsZWN0SWRlbnRp\nZmllcihtYXBwaW5nLCBzdWJzLCB0aGlzLCBmZXRjaCwKICAgICAgICAgICAg\nICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7CiAgICAg\nICAgcmV0dXJuIHBhZ2VkOwogICAgfQoKICAgIHB1YmxpYyBTdG9yZVF1ZXJ5\nIG5ld1F1ZXJ5KFN0cmluZyBsYW5ndWFnZSkgewogICAgICAgIEV4cHJlc3Np\nb25QYXJzZXIgZXAgPSBRdWVyeUxhbmd1YWdlcy5wYXJzZXJGb3JMYW5ndWFn\nZShsYW5ndWFnZSk7CiAgICAgICAgaWYgKGVwICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgSkRCQ1N0b3JlUXVlcnkodGhpcywgZXApOwogICAg\nICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMobGFuZ3Vh\nZ2UpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNRTFN0b3JlUXVlcnkodGhp\ncyk7CiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURf\nU1FMLmVxdWFscyhsYW5ndWFnZSkpCiAgICAgICAgICAgIHJldHVybiBuZXcg\nUHJlcGFyZWRTUUxTdG9yZVF1ZXJ5KHRoaXMpOwogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gbmV3\nRmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwoKTsKICAgIH0KCiAgICBwdWJsaWMg\nU2VxIGdldERhdGFTdG9yZUlkU2VxdWVuY2UoQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpID09\nIFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUKICAgICAgICAgICAgfHwgbWV0YS5n\nZXRJZGVudGl0eVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUp\nCiAgICAgICAgICAgIHJldHVybiBfY29uZi5nZXRTZXF1ZW5jZUluc3RhbmNl\nKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIFNl\ncSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xvc2Uo\nKSB7CiAgICAgICAgaWYgKF9jb25uICE9IG51bGwpCiAgICAgICAgICAgIF9j\nb25uLmZyZWUoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAgICAvLyBV\ndGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIENv\nbm5lY3QgdG8gdGhlIGRiLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29u\nbmVjdChib29sZWFuIHJlZikgewogICAgICAgIF9jdHgubG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbm5lY3QgaWYgdGhlIGNvbm5l\nY3Rpb24gaXMgY3VycmVudGx5IG51bGwsIG9yIGlmCiAgICAgICAgICAgIC8v\nIHRoZSBjb25uZWN0aW9uIGhhcyBiZWVuIGNsb3NlZCBvdXQgZnJvbSB1bmRl\nciB1cwogICAgICAgICAgICBpZiAoX2Nvbm4gPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9jb25uID0gY29ubmVjdEludGVybmFsKCk7CiAgICAgICAgICAg\nIGlmIChyZWYpCiAgICAgICAgICAgICAgICBfY29ubi5yZWYoKTsKICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhy\nb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdCB0byB0aGUgZGF0\nYWJhc2UuIFRoaXMgbWV0aG9kIGlzIHNlcGFyYXRlZCBvdXQgc28gdGhhdCBp\ndAogICAgICogY2FuIGJlIG92ZXJyaWRkZW4uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBSZWZDb3VudENvbm5lY3Rpb24gY29ubmVjdEludGVybmFsKCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIENvbmNyZXRlQ2xh\nc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UocmVmQ291bnRDb25uZWN0aW9uSW1w\nbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBfZHMuZ2V0Q29ubmVjdGlvbigp\nKTsKICAgIH0KICAgIAogICAgcHVibGljIENvbm5lY3Rpb24gZ2V0TmV3Q29u\nbmVjdGlvbigpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nY29ubmVjdEludGVybmFsKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRT\ndG9yZShlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogRmluZCB0aGUgb2JqZWN0IHdpdGggdGhlIGdpdmVuIG9pZC4KICAgICAq\nLwogICAgcHVibGljIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIFZhbHVlTWFw\ncGluZyB2bSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgT2JqZWN0IHBjID0gX2N0eC5maW5kKG9pZCwg\nZmV0Y2gsIG51bGwsIG51bGwsIDApOwogICAgICAgIGlmIChwYyA9PSBudWxs\nICYmIHZtICE9IG51bGwpIHsKICAgICAgICAgICAgT3JwaGFuZWRLZXlBY3Rp\nb24gYWN0aW9uID0gX2NvbmYuZ2V0T3JwaGFuZWRLZXlBY3Rpb25JbnN0YW5j\nZSgpOwogICAgICAgICAgICBwYyA9IGFjdGlvbi5vcnBoYW4ob2lkLCBudWxs\nLCB2bSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYzsKICAgIH0KCiAg\nICAvKioKICAgICAqIExvYWQgdGhlIG9iamVjdCBpbiB0aGUgY3VycmVudCBy\nb3cgb2YgdGhlIGdpdmVuIHJlc3VsdC4KICAgICAqLwogICAgcHVibGljIE9i\namVjdCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBSZXN1\nbHQgcmVzdWx0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nIW1hcHBpbmcuaXNNYXBwZWQoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidmlydHVhbC1tYXBwaW5n\nIiwgCiAgICAgICAgICAgICAgICBtYXBwaW5nKSk7CgogICAgICAgIC8vIGdl\ndCB0aGUgb2JqZWN0IGlkIGZvciB0aGUgcm93OyBiYXNlIGNsYXNzIHNlbGVj\ndHMgcGsgY29sdW1ucwogICAgICAgIENsYXNzTWFwcGluZyBiYXNlID0gbWFw\ncGluZzsKICAgICAgICB3aGlsZSAoYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBiYXNlID0gYmFz\nZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBP\nYmplY3Qgb2lkID0gYmFzZS5nZXRPYmplY3RJZCh0aGlzLCByZXN1bHQsIG51\nbGwsIHRydWUsIG51bGwpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbm5lY3Rpb25JbmZv\nIGluZm8gPSBuZXcgQ29ubmVjdGlvbkluZm8oKTsKICAgICAgICBpbmZvLnJl\nc3VsdCA9IHJlc3VsdDsKICAgICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5n\nOwoKICAgICAgICAvLyBpZiBpbnZlcnNlIHJlbGF0aW9uIGlzIGtub3duLCBl\neGNsdWRlIGxvYWRpbmcgZHVyaW5nIGZpbmQKICAgICAgICBleGNsdWRlID0g\nZXhjbHVkZUludmVyc2VSZWxhdGlvbihtYXBwaW5nLCBpbmZvLCBleGNsdWRl\nKTsKICAgICAgICByZXR1cm4gX2N0eC5maW5kKG9pZCwgZmV0Y2gsIGV4Y2x1\nZGUsIGluZm8sIDApOwogICAgfQoKICAgIHByaXZhdGUgQml0U2V0IGV4Y2x1\nZGVJbnZlcnNlUmVsYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAg\nICAgQ29ubmVjdGlvbkluZm8gaW5mbywgQml0U2V0IGV4Y2x1ZGUpIHsKICAg\nICAgICBGaWVsZE1hcHBpbmcgaW52ZXJzZSA9IGluZm8ucmVzdWx0LmdldE1h\ncHBlZEJ5RmllbGRNYXBwaW5nKCk7CiAgICAgICAgaWYgKGludmVyc2UgIT0g\nbnVsbCkgewogICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBw\naW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgIGlm\nIChleGNsdWRlID09IG51bGwpCiAgICAgICAgICAgICAgICBleGNsdWRlID0g\nbmV3IEJpdFNldChmbXMubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nIGlmIChmbXNbaV0gPT0gaW52ZXJzZSkgewogICAgICAgICAgICAgICAgICAg\nIGV4Y2x1ZGUuc2V0KGZtc1tpXS5nZXRJbmRleCgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhjbHVkZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgd2l0\naCBkYXRhIGZyb20gdGhlIHJlc3VsdCBzZXQuIE9ubHkKICAgICAqIG1hcHBp\nbmdzIG9yaWdpbmFsbHkgc2VsZWN0ZWQgd2lsbCBiZSBsb2FkZWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFueSA9IGxv\nYWQobWFwcGluZywgc20sIGZldGNoLCByZXMsIG51bGwpOwogICAgICAgIGlm\nIChlYWdlclRvTWFueSAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFu\neS5sb2FkRWFnZXJKb2luKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMo\nZWFnZXJUb01hbnkpLAogICAgICAgICAgICAgICAgcmVzKTsKICAgICAgICBp\nZiAoX2FjdGl2ZSAmJiBfbG0gIT0gbnVsbCAmJiByZXMuaXNMb2NraW5nKCkp\nCiAgICAgICAgICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwogICAgfQoK\nICAgIC8qKgogICAgICogTG9hZCB0aGUgZmllbGRzIG9mIHRoZSBnaXZlbiBt\nYXBwaW5nLiBSZXR1cm4gYW55IHRvLW1hbnkgZWFnZXIgZmllbGQKICAgICAq\nIHdpdGhvdXQgbG9hZGluZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBGaWVs\nZE1hcHBpbmcgbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLCBSZXN1bHQgcmVzLCBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG1h\ncHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgZmV0Y2gsIHJlcykpCiAgICAg\nICAgICAgIHJldHVybiBlYWdlclRvTWFueTsKCiAgICAgICAgLy8gbG9hZCBz\ndXBlcmNsYXNzIGRhdGE7IGJhc2UgY2xhc3MgbG9hZHMgdmVyc2lvbgogICAg\nICAgIENsYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdldEpvaW5hYmxl\nUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChwYXJlbnQgIT0g\nbnVsbCkKICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBsb2FkKHBhcmVudCwg\nc20sIGZldGNoLCByZXMsIGVhZ2VyVG9NYW55KTsKICAgICAgICBlbHNlIGlm\nIChzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgbWFwcGlu\nZy5nZXRWZXJzaW9uKCkubG9hZChzbSwgdGhpcywgcmVzKTsKCiAgICAgICAg\nLy8gbG9hZCB1bmxvYWRlZCBmaWVsZHMKICAgICAgICBGaWVsZE1hcHBpbmdb\nXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAg\nICAgICAgT2JqZWN0IGVyZXMsIHByb2Nlc3NlZDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoZm1zW2ldLmlzUHJpbWFyeUtleSgpIHx8IHNtLmdldExvYWRlZCgpLmdl\ndChmbXNbaV0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBlYWdl\nciByZXN1bHQsIGFuZCBpZiBub3QgcHJlc2VudCBkbyBzdGFuZGFyZCBsb2Fk\nCiAgICAgICAgICAgIGVyZXMgPSByZXMuZ2V0RWFnZXIoZm1zW2ldKTsKICAg\nICAgICAgICAgcmVzLnN0YXJ0RGF0YVJlcXVlc3QoZm1zW2ldKTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgaWYgKGVyZXMgPT0gcmVzKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGVhZ2VyVG9NYW55ID09IG51bGwg\nJiYgZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmbXNbaV0u\nbG9hZEVhZ2VySm9pbihzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAg\nICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSBpZiAoZXJlcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgcHJvY2Vzc2VkID0gZm1zW2ldLmxvYWRFYWdlclBhcmFs\nbGVsKHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJh\ndmVyc2VKREJDKGZtc1tpXSksIGVyZXMpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChwcm9jZXNzZWQgIT0gZXJlcykKICAgICAgICAgICAgICAgICAgICAg\nICAgcmVzLnB1dEVhZ2VyKGZtc1tpXSwgcHJvY2Vzc2VkKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5sb2Fk\nKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsK\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHJlcy5l\nbmREYXRhUmVxdWVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZvciBpbXBsZW1lbnRhdGlvbiB1c2Ugb25seS4KICAgICAqIFJldHVybiBh\nIHNlbGVjdCBmb3IgdGhlIHByb3BlciBtYXBwaW5ncy4gUmV0dXJuIG51bGwg\naWYgbm8gc2VsZWN0IGlzCiAgICAgKiBuZWVkZWQuIFRoZSBtZXRob2QgaXMg\nZGVzaWduZWQgdG8gYmUgY29tcGxlbWVudGFyeSB0byB0aGUgbG9hZCBtZXRo\nb2RzLgogICAgICoKICAgICAqIEBwYXJhbSBzZWwgc2VsZWN0IHRvIGJ1aWxk\nIG9uCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbWFwcGluZyBmb3IgdGhl\nIGJhc2UgdHlwZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gc3VicyB3\naGV0aGVyIHRoZSBzZWxlY3QgbWlnaHQgaW5jbHVkZSBzdWJjbGFzc2VzIG9m\nIHRoZQogICAgICogZ2l2ZW4gbWFwcGluZwogICAgICogQHBhcmFtIHNtIHN0\nYXRlIG1hbmFnZXIgaWYgYW4gaW5zdGFuY2UgaXMgYmVpbmcgbG9hZGVkIG9y\nCiAgICAgKiBpbml0aWFsaXplZCwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0g\nZmllbGRzIGlmIGEgc3RhdGUgbWFuYWdlciBpcyBiZWluZyBsb2FkZWQsIHRo\nZSBzZXQgb2YKICAgICAqIGZpZWxkcyB0aGF0IG11c3QgYmUgbG9hZGVkIGlu\nIG9yZGVyLCBlbHNlIG51bGwKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0\nY2ggY29uZmlndXJhdGlvbjsgdXNlZCBpZiBubyBzcGVjaWZpYyBmaWVsZHMK\nICAgICAqIG11c3QgYmUgbG9hZGVkLCBhbmQgdXNlZCB3aGVuIHNlbGVjdGlu\nZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciBlYWdlciBmZXRjaCBt\nb2RlIHRvIHVzZQogICAgICogQHBhcmFtIGlkZW50IHdoZXRoZXIgdG8gc2Vs\nZWN0IHByaW1hcnkga2V5IGNvbHVtbnMgYXMgZGlzdGluY3QKICAgICAqIGlk\nZW50aWZpZXJzCiAgICAgKiBAcGFyYW0gb3V0ZXIgd2hldGhlciB3ZSdyZSBv\ndXRlci1qb2luaW5nIHRvIHRoaXMgdHlwZQogICAgICogQHJldHVybiB0cnVl\nIGlmIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIGZhbHNlIG90aGVyd2lzZQog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU2VsZWN0IHNlbCwg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLAogICAgICAgIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyLCBib29sZWFu\nIGlkZW50LCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gYWRkIGNsYXNz\nIGNvbmRpdGlvbnMgc28gdGhhdCB0aGV5J3JlIGNsb25lZCBmb3IgYW55IGJh\ndGNoZWQgc2VsZWN0cwogICAgICAgIGJvb2xlYW4gam9pbmVkU3VwZXJzID0g\nZmFsc2U7ICAgIAogICAgICAgIGlmKG5lZWRDbGFzc0NvbmRpdGlvbihtYXBw\naW5nLCBzdWJzLCBzbSkpIHsKICAgICAgICAgICAgam9pbmVkU3VwZXJzID0g\nZ2V0Sm9pbmVkU3VwZXJzKHNlbCwgbWFwcGluZywgc3Vicywgb3V0ZXIpOwog\nICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjcmVhdGUgYWxsIG91ciBl\nYWdlciBzZWxlY3RzIHNvIHRoYXQgdGhvc2UgZmllbGRzIGFyZSByZXNlcnZl\nZAogICAgICAgIC8vIGFuZCBjYW5ub3QgYmUgcmV1c2VkIGR1cmluZyB0aGUg\nYWN0dWFsIGVhZ2VyIHNlbGVjdCBwcm9jZXNzLAogICAgICAgIC8vIHByZXZl\nbnRpbmcgaW5maW5pdGUgcmVjdXJzaW9uCiAgICAgICAgZWFnZXIgPSBNYXRo\nLm1pbihlYWdlciwgZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUoKSk7CiAgICAg\nICAgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxl\nY3RzKHNlbCwgbWFwcGluZywgc20sIGZpZWxkcywKICAgICAgICAgICAgZmV0\nY2gsIGVhZ2VyKTsKCiAgICAgICAgLy8gc2VsZWN0IGFsbCBiYXNlIGNsYXNz\nIG1hcHBpbmdzOyBkbyB0aGlzIGFmdGVyIGJhdGNoaW5nIHNvIHRoYXQKICAg\nICAgICAvLyB0aGUgam9pbnMgbmVlZGVkIGJ5IHRoZXNlIHNlbGVjdHMgZG9u\nJ3QgZ2V0IGluIHRoZSBXSEVSRSBjbGF1c2UKICAgICAgICAvLyBvZiB0aGUg\nYmF0Y2hlZCBzZWxlY3RzCiAgICAgICAgaW50IHNlbGQgPSBzZWxlY3RCYXNl\nTWFwcGluZ3Moc2VsLCBtYXBwaW5nLCBtYXBwaW5nLCBzbSwgZmllbGRzLAog\nICAgICAgICAgICBmZXRjaCwgZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwg\nam9pbmVkU3VwZXJzKTsKCiAgICAgICAgLy8gc2VsZWN0IGVhZ2VyIHRvLW1h\nbnkgcmVsYXRpb25zIGxhc3QgYmVjYXVzZSBkdXJpbmcgbG9hZCB0aGV5CiAg\nICAgICAgLy8gYWR2YW5jZSB0aGUgcmVzdWx0IHNldCBhbmQgY291bGQgZXho\nYXVzdCBpdCwgc28gbm8gb3RoZXIgbWFwcGluZ3MKICAgICAgICAvLyBjYW4g\nbG9hZCBhZnRlcndvcmRzCiAgICAgICAgaWYgKGVhZ2VyVG9NYW55ICE9IG51\nbGwpCiAgICAgICAgICAgIGVhZ2VyVG9NYW55LnNlbGVjdEVhZ2VySm9pbihz\nZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIGZldGNoLnRyYXZlcnNl\nSkRCQyhlYWdlclRvTWFueSksIGVhZ2VyKTsKCiAgICAgICAgLy8gb3B0aW9u\nYWxseSBzZWxlY3Qgc3ViY2xhc3MgbWFwcGluZ3MKICAgICAgICBpZiAoc3Vi\ncyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJzID09IFNlbGVjdC5T\nVUJTX0FOWV9KT0lOQUJMRSkKICAgICAgICAgICAgc2VsZWN0U3ViY2xhc3NN\nYXBwaW5ncyhzZWwsIG1hcHBpbmcsIHNtLCBmZXRjaCk7CiAgICAgICAgaWYg\nKHNtICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5zZXREaXN0aW5jdChmYWxz\nZSk7CiAgICAgICAgcmV0dXJuIHNlbGQgPiAwOwogICAgfQoKICAgIHByaXZh\ndGUgYm9vbGVhbiBnZXRKb2luZWRTdXBlcnMoU2VsZWN0IHNlbCwgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLCBib29sZWFuIG91dGVyKSB7CiAg\nICAgICAgbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7IAogICAgICAgIEpvaW5z\nIGpvaW5zID0gKG91dGVyKSA/IHNlbC5uZXdPdXRlckpvaW5zKCkgOiBudWxs\nOwogICAgICAgIHJldHVybiBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5h\nZGRDbGFzc0NvbmRpdGlvbnMoc2VsLCBzdWJzID09IFNlbGVjdC5TVUJTX0pP\nSU5BQkxFLCBqb2lucyk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgYm9vbGVh\nbiBuZWVkQ2xhc3NDb25kaXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGlu\ndCBzdWJzLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAg\nICAgICBib29sZWFuIHJldFZhbCA9IGZhbHNlOwogICAgICAgIGlmKHNtID09\nIG51bGwgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5U\nKSB7CiAgICAgICAgICAgIGlmKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFC\nTEUgfHwgc3VicyA9PSBTZWxlY3QuU1VCU19OT05FKSB7CiAgICAgICAgICAg\nICAgICByZXRWYWwgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmcuZ2V0RGlzY3Jp\nbWluYXRvcigpICE9IG51bGwKICAgICAgICAgICAgICAgICAgICAmJiBTdXBl\ncmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzLmlzSW5zdGFuY2Uo\nbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0U3RyYXRlZ3koKSkKICAg\nICAgICAgICAgICAgICAgICAmJiBtYXBwaW5nLmdldE1hcHBpbmdSZXBvc2l0\nb3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0\nYW5jZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTdXBlcmNsYXNz\nRGlzY3JpbWluYXRvclN0cmF0ZWd5QnlEZWZhdWx0KCkpIHsKICAgICAgICAg\nICAgICAgICAgICByZXRWYWwgPSB0cnVlOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXRWYWw7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogTWFyayB0aGUgZmllbGRzIG9m\nIHRoaXMgbWFwcGluZyBhcyByZXNlcnZlZCBzbyB0aGF0IGVhZ2VyIGZldGNo\nZXMgY2FuJ3QKICAgICAqIGdldCBpbnRvIGluZmluaXRlIHJlY3Vyc2l2ZSBz\naXR1YXRpb25zLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFwcGluZyBj\ncmVhdGVFYWdlclNlbGVjdHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0\nIGZpZWxkcywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAg\nICBpbnQgZWFnZXIpIHsKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8\nIGVhZ2VyID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxkTWFwcGlu\nZyBlYWdlclRvTWFueSA9IGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWwsIAogICAg\nICAgICAgICBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpLCBzbSwgZmllbGRzLCBmZXRjaCwgZWFnZXIpOwoKICAgICAgICBGaWVs\nZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBp\nbmdzKCk7CiAgICAgICAgYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNlbC5oYXNF\nYWdlckpvaW4oZmFsc2UpOwogICAgICAgIGludCBzZWxzOwogICAgICAgIGlu\ndCBqdHlwZTsKICAgICAgICBpbnQgbW9kZTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtb2Rl\nID0gZm1zW2ldLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIGlm\nIChtb2RlID09IGZldGNoLkVBR0VSX05PTkUpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgaWYgKCFyZXF1aXJlc1NlbGVjdChmbXNb\naV0sIHNtLCBmaWVsZHMsIGZldGNoKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRoIGpvaW4g\nZmlyc3QKICAgICAgICAgICAganR5cGUgPSAoZm1zW2ldLmdldE51bGxWYWx1\nZSgpID09IGZtc1tpXS5OVUxMX0VYQ0VQVElPTikgCiAgICAgICAgICAgICAg\nICA/IHNlbC5FQUdFUl9JTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsKICAgICAg\nICAgICAgaWYgKG1vZGUgIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwgJiYgIWZt\nc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYm\nIGZtc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywg\nZmV0Y2gpID4gMAogICAgICAgICAgICAgICAgJiYgc2VsLmVhZ2VyQ2xvbmUo\nZm1zW2ldLCBqdHlwZSwgZmFsc2UsIDEpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGJvb2xlYW4gaGFzSm9pbiA9\nIGZldGNoLmhhc0pvaW4oZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNlKSk7Cgog\nICAgICAgICAgICAvLyBpZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBwcmVmZXJy\nZWQgc2VsZWN0IG1vZGUgb2Ygam9pbiBvciBkb2VzIG5vdAogICAgICAgICAg\nICAvLyBoYXZlIGEgcHJlZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRvaW5nIGEg\nYnktaWQgbG9va3VwLCB0cnkKICAgICAgICAgICAgLy8gdG8gdXNlIGEgdG8t\nbWFueSBqb2luIGFsc28uICBjdXJyZW50bHkgd2UgbGltaXQgZWFnZXIKICAg\nICAgICAgICAgLy8gb3V0ZXIgam9pbnMgdG8gbm9uLUxSUywgbm9uLXJhbmdl\nZCBzZWxlY3RzIHRoYXQgZG9uJ3QgYWxyZWFkeQogICAgICAgICAgICAvLyBo\nYXZlIGFuIGVhZ2VyIHRvLW1hbnkgam9pbgogICAgICAgICAgICBpZiAoKGhh\nc0pvaW4gfHwgbW9kZSA9PSBmZXRjaC5FQUdFUl9KT0lOIAogICAgICAgICAg\nICAgICAgfHwgKG1vZGUgPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAhPSBudWxs\nKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9N\nYW55KCkKICAgICAgICAgICAgICAgICYmICFpbkVhZ2VySm9pbgogICAgICAg\nICAgICAgICAgJiYgIXNlbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAgICAgICAg\nICAgICAgICYmICghc2VsLmdldEF1dG9EaXN0aW5jdCgpIHx8ICghc2VsLmlz\nTFJTKCkKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRTdGFydEluZGV4KCkg\nPT0gMCAKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09\nIExvbmcuTUFYX1ZBTFVFKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5z\ndXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4g\nMCkgewogICAgICAgICAgICAgICAgaWYgKHNlbC5lYWdlckNsb25lKGZtc1tp\nXSwganR5cGUsIHRydWUsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGZpbmFsbHksIHRyeSBwYXJhbGxlbAogICAgICAg\nICAgICBpZiAoZWFnZXIgPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwKICAgICAg\nICAgICAgICAgICYmIChzZWxzID0gZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNl\nbCwgc2VsLkVBR0VSX1BBUkFMTEVMLCBzbSwKICAgICAgICAgICAgICAgIHRo\naXMsIGZldGNoKSkgIT0gMCkKICAgICAgICAgICAgICAgIHNlbC5lYWdlckNs\nb25lKGZtc1tpXSwgU2VsZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAgICAgICAg\nICAgICAgICAgICBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpLCBzZWxz\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAg\nfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZlbiBmaWVs\nZCBuZWVkcyB0byBiZSBzZWxlY3RlZC4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiByZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBpbmcgZm0s\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxk\ncywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlm\nIChmaWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5n\nZXQoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYg\nc20uZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAgICAgICAg\nICAgICYmIHNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBmZXRjaC5y\nZXF1aXJlc0ZldGNoKGZtKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hf\nTE9BRDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZmllbGQg\nbWFwcGluZ3Mgb2YgdGhlIGdpdmVuIGNsYXNzIGFuZCBhbGwgaXRzIHN1cGVy\nY2xhc3Nlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3Qg\ndG8gdXNlCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbW9zdC1kZXJpdmVk\nIHR5cGUgdG8gc2VsZWN0IGZvcgogICAgICogQHBhcmFtIG9yaWcgdGhlIG9y\naWdpbmFsIG1hcHBpbmcgdHlwZSBzZWxlY3RlZAogICAgICogQHBhcmFtIHNt\nIHRoZSBpbnN0YW5jZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYg\nbm9uZQogICAgICogQHBhcmFtIGZpZWxkcyB0aGUgZmllbGRzIHRvIGxvYWQK\nICAgICAqIEBwYXJhbSBmZXRjaCBmZXRjaCBjb25maWd1cmF0aW9uIHRvIHVz\nZSBmb3IgbG9hZGluZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciB0\naGUgZWFnZXIgZmV0Y2ggbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBqb2lu\nZWQgd2hldGhlciB0aGUgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBqb2luZWQg\nZG93biB0bwogICAgICogaXRzIGJhc2UgY2xhc3MKICAgICAqIEByZXR1cm4g\nJmd0OyAwIGlmIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIDAgaWYgZGF0YSB3\nYXMKICAgICAqIHNlbGVjdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQsIGFuZCAm\nbHQ7IDAgaWYgbm90aGluZyB3YXMgc2VsZWN0ZWQKICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgc2VsZWN0QmFzZU1hcHBpbmdzKFNlbGVjdCBzZWwsIENsYXNz\nTWFwcGluZyBtYXBwaW5nLAogICAgICAgIENsYXNzTWFwcGluZyBvcmlnLCBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwgRmll\nbGRNYXBwaW5nIGVhZ2VyVG9NYW55LAogICAgICAgIGJvb2xlYW4gaWRlbnQs\nIGJvb2xlYW4gam9pbmVkKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVu\ndCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7\nCiAgICAgICAgaWYgKHBhcmVudCA9PSBudWxsICYmICFtYXBwaW5nLmlzTWFw\ncGVkKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoInZpcnR1YWwtbWFwcGluZyIsIG1hcHBpbmcuCiAg\nICAgICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkpKTsKCiAgICAgICAg\naW50IHNlbGQgPSAtMTsKICAgICAgICBpbnQgcHNlbGQgPSAtMTsKCiAgICAg\nICAgLy8gYmFzZSBjbGFzcyBzZWxlY3RzIHBrcywgZXRjCiAgICAgICAgaWYg\nKHBhcmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIGluc3Rh\nbmNlLCBzZWxlY3QgcGtzCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaWRlbnQpCiAgICAgICAgICAgICAgICAg\nICAgc2VsLnNlbGVjdElkZW50aWZpZXIobWFwcGluZy5nZXRQcmltYXJ5S2V5\nQ29sdW1ucygpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVt\nbnMoKSk7CiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaWYgbm8gaW5zdGFuY2Ugb3Igbm90IGluaXRp\nYWxpemVkIGFuZCBub3QgZXhhY3Qgb2lkLCBzZWxlY3QgdHlwZQogICAgICAg\nICAgICBpZiAoKHNtID09IG51bGwgfHwgKHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLlRSQU5TSUVOVCAKICAgICAgICAgICAgICAgICYmICghKHNtLmdl\ndE9iamVjdElkKCkgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIAogICAgICAgICAg\nICAgICAgfHwgKChPcGVuSlBBSWQpIHNtLmdldE9iamVjdElkKCkpLmhhc1N1\nYmNsYXNzZXMoKSkpKQogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXRE\naXNjcmltaW5hdG9yKCkuc2VsZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAg\nICAgICBzZWxkID0gMTsKCiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNl\nIG9yIG5vIHZlcnNpb24sIHNlbGVjdCB2ZXJzaW9uCiAgICAgICAgICAgIGlm\nICgoc20gPT0gbnVsbCB8fCBzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICYmIG1hcHBpbmcuZ2V0VmVyc2lvbigpLnNlbGVjdChz\nZWwsIG9yaWcpKQogICAgICAgICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVjdXJzZSBvbiBwYXJlbnQKICAg\nICAgICAgICAgcHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBwYXJl\nbnQsIG9yaWcsIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBmZXRjaCwg\nZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZ3MgaW4gdGhlIGdpdmVu\nIGZpZWxkcyBzZXQsIG9yIGJhc2VkIG9uIGZldGNoCiAgICAgICAgLy8gY29u\nZmlndXJhdGlvbiBpZiBubyBmaWVsZHMgZ2l2ZW4KICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgU2VsZWN0RXhlY3V0b3IgZXNlbDsKICAgICAgICBpbnQg\nZnNlbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgLy8gc2tpcCBlYWdlciB0by1tYW55IHNl\nbGVjdDsgd2UgZG8gdGhhdCBzZXBhcmF0ZWx5IGluIGNhbGxpbmcKICAgICAg\nICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gZWFn\nZXJUb01hbnkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIC8vIGNoZWNrIGZvciBlYWdlciBzZWxlY3QKICAgICAgICAgICAgZXNl\nbCA9IHNlbC5nZXRFYWdlcihmbXNbaV0pOwogICAgICAgICAgICBpZiAoZXNl\nbCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZXNlbCA9PSBzZWwp\nCiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VySm9pbihz\nZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJh\ndmVyc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJQYXJh\nbGxlbChlc2VsLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZl\ndGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAg\nICAgICBzZWxkID0gTWF0aC5tYXgoMCwgc2VsZCk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAocmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmllbGRzLCBm\nZXRjaCkpIHsKICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVj\ndChzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2\nZXJzZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2Vs\nZCA9IE1hdGgubWF4KGZzZWxkLCBzZWxkKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChvcHRTZWxlY3QoZm1zW2ldLCBzZWwsIHNtLCBmZXRjaCkpIHsKICAg\nICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0\naGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1z\nW2ldKSwgZmV0Y2guRUFHRVJfTk9ORSk7CgogICAgICAgICAgICAgICAgLy8g\nZG9uJ3QgdXBncmFkZSBzZWxkIHRvID4gMCBiYXNlZCBvbiB0aGVzZSBmaWVs\nZHMsIHNpbmNlCiAgICAgICAgICAgICAgICAvLyB0aGV5J3JlIG5vdCBpbiB0\naGUgY2FsY3VsYXRlZCBmaWVsZCBzZXQKICAgICAgICAgICAgICAgIGlmIChm\nc2VsZCA+PSAwICYmIHNlbGQgPCAwKQogICAgICAgICAgICAgICAgICAgIHNl\nbGQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBp\nbiBjZXJ0YWluIGNpcmN1bXN0YW5jZXMgZm9yY2Ugam9pbiB0byBzdXBlcmNs\nYXNzIHRhYmxlIHRvIGF2b2lkCiAgICAgICAgLy8gU1FMIGdlbmVyYXRpb24g\nZXJyb3IuCiAgICAgICAgaWYgKCBlYWdlclRvTWFueSAhPSBudWxsICYmIHBz\nZWxkIDwgMCAmJiBzZWxkID4gMCAmJiAham9pbmVkCiAgICAgICAgICAgICAg\nICAmJiBwYXJlbnQgIT0gbnVsbCApIHsKICAgICAgICAgICAgRmllbGRNYXBw\naW5nW10gcGZtcyA9IHBhcmVudC5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygp\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBmbXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwZm1zW2ldID09IGVhZ2Vy\nVG9NYW55ICkgewogICAgICAgICAgICAgICAgICAgIHBzZWxkID0gMDsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBqb2lu\nIHRvIHBhcmVudCB0YWJsZSBpZiB0aGUgcGFyZW50IC8gYW55IGFuY2VzdG9y\ncyBoYXZlIHNlbGVjdGVkCiAgICAgICAgLy8gYW55dGhpbmcKICAgICAgICBp\nZiAoIWpvaW5lZCAmJiBwc2VsZCA+PSAwICYmIHBhcmVudC5nZXRUYWJsZSgp\nICE9IG1hcHBpbmcuZ2V0VGFibGUoKSkKICAgICAgICAgICAgc2VsLndoZXJl\nKG1hcHBpbmcuam9pblN1cGVyY2xhc3Moc2VsLm5ld0pvaW5zKCksIGZhbHNl\nKSk7CgogICAgICAgIC8vIHJldHVybiB0aGUgaGlnaGVzdCB2YWx1ZQogICAg\nICAgIHJldHVybiBNYXRoLm1heChwc2VsZCwgc2VsZCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGVuIHNlbGVjdGluZyBmaWVsZGVzLCBhIHNwZWNpYWwg\nY2FzZSBpcyBtYWRlIGZvciBtYXBwaW5ncyB0aGF0IHVzZQogICAgICogMi1w\nYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QgZXhwbGljaXRseSAqbm90KiBpbiB0\naGUgZGZnIHNvIHRoYXQgdGhleQogICAgICogY2FuIGdldCB0aGVpciBwcmlt\nYXJ5IHRhYmxlIGRhdGEuIFRoaXMgbWV0aG9kIHRlc3RzIGZvciB0aGF0IHNw\nZWNpYWwKICAgICAqIGNhc2UgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gb3B0U2VsZWN0KEZpZWxkTWFwcGluZyBm\nbSwgU2VsZWN0IHNlbCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0\ndXJuICFmbS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAgICAg\nJiYgIWZtLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdCgpCiAgICAgICAg\nICAgICYmIChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0\nYXRlLlRSQU5TSUVOVCAKICAgICAgICAgICAgfHwgIXNtLmdldExvYWRlZCgp\nLmdldChmbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgJiYgZm0uc3VwcG9y\ndHNTZWxlY3Qoc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMsIGZl\ndGNoKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZmllbGQg\nbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJh\ndGlvbiBmb3IKICAgICAqIHN1YmNsYXNzZXMgb2YgdGhlIGdpdmVuIHR5cGUu\nCiAgICAgKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVzZQog\nICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIHR5cGUgd2hvc2Ugc3ViY2xhc3Nl\ncyB0byBzZWxlY3QKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFuY2UgYmVp\nbmcgc2VsZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAgICAqIEBwYXJh\nbSBmZXRjaCB0aGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhTZWxlY3Qgc2Vs\nLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7CiAgICAgICAgQ2xhc3NN\nYXBwaW5nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENT\ndWJjbGFzc01hcHBpbmdzKCk7CiAgICAgICAgaWYgKHN1Yk1hcHBpbmdzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHNl\nbGVjdCBhbGwgc3ViY2xhc3MgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZmV0\nY2ggY29uZmlndXJhdGlvbgogICAgICAgIC8vIGFuZCB3aG9zZSB0YWJsZSBp\ncyBpbiB0aGUgbGlzdCBvZiB0aG9zZSBzZWxlY3RlZCBzbyBmYXI7IHRoaXMK\nICAgICAgICAvLyB3YXkgd2Ugc2VsZWN0IHRoZSBtYXggcG9zc2libGUgd2l0\naG91dCBzZWxlY3RpbmcgYW55IHRhYmxlcyB0aGF0CiAgICAgICAgLy8gYXJl\nbid0IHByZXNlbnQgaW4gYWxsIHBvc3NpYmxlIHF1ZXJ5IG1hdGNoZXM7IGEg\nc3BlY2lhbCBjYXNlCiAgICAgICAgLy8gaXMgbWFkZSBmb3IgbWFwcGluZ3Mg\ndGhhdCB1c2UgMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QKICAgICAgICAv\nLyBleHBsaWNpdGx5ICpub3QqIGluIHRoZSBkZWZhdWx0IHNvIHRoYXQgdGhl\neSBjYW4gZ2V0IHRoZWlyCiAgICAgICAgLy8gcHJpbWFyeSB0YWJsZSBkYXRh\nCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zOwogICAgICAgIGJvb2xlYW4g\nam9pbmVkOwogICAgICAgIGJvb2xlYW4gY2FuSm9pbiA9IF9kaWN0LmpvaW5T\neW50YXggIT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTAogICAg\nICAgICAgICAmJiBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5n\nKSAhPSBmZXRjaC5FQUdFUl9OT05FOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgc3ViTWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\naWYgKCFzdWJNYXBwaW5nc1tpXS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwg\nc20sIHRoaXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICBmZXRjaCkpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGluaXRp\nYWxpemUgc28gdGhhdCBpZiB3ZSBjYW4ndCBqb2luLCB3ZSBwcmV0ZW5kIHdl\nIGFscmVhZHkgaGF2ZQogICAgICAgICAgICBqb2luZWQgPSAhY2FuSm9pbjsK\nICAgICAgICAgICAgZm1zID0gc3ViTWFwcGluZ3NbaV0uZ2V0RGVmaW5lZEZp\nZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCBmbXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSBpbiBvbmUgb2YgY29uZmlndXJlZCBmZXRjaCBncm91cHMKICAgICAg\nICAgICAgCWlmIChmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tqXSkgIT0gRmV0\nY2hDb25maWd1cmF0aW9uLkZFVENIX0xPQUQKICAgICAgICAgICAgICAgICAg\nICAmJiAoKCFmbXNbal0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAg\nICAgICAgICAgICAgICAgJiYgZm1zW2pdLmlzRGVmYXVsdEZldGNoR3JvdXBF\neHBsaWNpdCgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZtc1tqXS5zdXBw\nb3J0c1NlbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhpcywg\nCiAgICAgICAgICAgICAgICAgICAgZmV0Y2gpIDw9IDApKSAKICAgICAgICAg\nICAgCQljb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBjYW4g\nam9pbiB0byB0aGUgc3ViY2xhc3MsIGRvIHNvOyBtdWNoIGJldHRlciBjaGFu\nY2UKICAgICAgICAgICAgICAgIC8vIHRoYXQgdGhlIGZpZWxkIHdpbGwgYmUg\nYWJsZSB0byBzZWxlY3QgaXRzZWxmIHdpdGhvdXQgam9pbnMKICAgICAgICAg\nICAgICAgIGlmICgham9pbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g\nbWFyayBqb2luZWQgd2hldGhlciBvciBub3Qgd2Ugam9pbiwgc28gd2UgZG9u\nJ3QgaGF2ZSB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgY29uZGl0\naW9ucyBhZ2FpbiBmb3IgdGhpcyBzdWJjbGFzcwogICAgICAgICAgICAgICAg\nICAgIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsLndo\nZXJlKGpvaW5TdWJjbGFzcyhzZWwsIG1hcHBpbmcsIHN1Yk1hcHBpbmdzW2ld\nLCBudWxsKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nLy8gaWYgY2FuIHNlbGVjdCB3aXRoIHRhYmxlcyBhbHJlYWR5IHNlbGVjdGVk\nLCBkbyBpdAogICAgICAgICAgICAgICAgaWYgKGZtc1tqXS5zdXBwb3J0c1Nl\nbGVjdChzZWwsIHNlbC5UWVBFX0pPSU5MRVNTLCBzbSwgdGhpcywKICAgICAg\nICAgICAgICAgICAgICBmZXRjaCkgPiAwKQogICAgICAgICAgICAgICAgICAg\nIGZtc1tqXS5zZWxlY3Qoc2VsLCBudWxsLCB0aGlzLCBmZXRjaC50cmF2ZXJz\nZUpEQkMoZm1zW2pdKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2gu\nRUFHRVJfTk9ORSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGpvaW4gZnJvbSBjbGFz\ncyB0byBpdHMgc3ViY2xhc3MuIFJlY3Vyc2l2ZSB0byBhbGxvdwogICAgICog\nZm9yIG11bHRpcGxlIGhvcHMsIHN0YXJ0aW5nIGZyb20gdGhlIGJhc2UgY2xh\nc3MuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpvaW5zIGpvaW5TdWJj\nbGFzcyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgYmFzZSwKICAgICAgICBD\nbGFzc01hcHBpbmcgc3ViLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChz\ndWIgPT0gYmFzZSB8fCBzdWIuZ2V0VGFibGUoKSA9PSBiYXNlLmdldFRhYmxl\nKCkKICAgICAgICAgICAgfHwgc2VsLmlzU2VsZWN0ZWQoc3ViLmdldFRhYmxl\nKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gcmVj\ndXJzZSBmaXJzdCBzbyB3ZSBnbyBsZWFzdC0+bW9zdCBkZXJpdmVkCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIHN1cCA9IHN1Yi5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKTsKICAgICAgICBqb2lucyA9IGpvaW5TdWJjbGFzcyhz\nZWwsIGJhc2UsIHN1cCwgam9pbnMpOwogICAgICAgIGlmIChqb2lucyA9PSBu\ndWxsKQogICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygpOwogICAg\nICAgIHJldHVybiBzdWIuam9pblN1cGVyY2xhc3Moam9pbnMsIHRydWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgc3VyZSBhbGwgc3ViY2xhc3Nl\ncyBvZiB0aGUgZ2l2ZW4gdHlwZSBhcmUgbG9hZGVkIGluIHRoZSBKVk0uCiAg\nICAgKiBUaGlzIGlzIHVzdWFsbHkgZG9uZSBhdXRvbWF0aWNhbGx5LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBsb2FkU3ViY2xhc3NlcyhDbGFzc01hcHBp\nbmcgbWFwcGluZykgewogICAgICAgIERpc2NyaW1pbmF0b3IgZHNjID0gbWFw\ncGluZy5nZXREaXNjcmltaW5hdG9yKCk7CiAgICAgICAgaWYgKGRzYy5nZXRT\ndWJjbGFzc2VzTG9hZGVkKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gaWYgdGhlIHN1YmNsYXNzIGxpc3QgaXMgc2V0LCBubyBuZWVkIHRv\nIGxvYWQgc3VicwogICAgICAgIGlmIChtYXBwaW5nLmdldFJlcG9zaXRvcnko\nKS5nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAgICAgICAgICBf\nY3R4LmdldENsYXNzTG9hZGVyKCkpICE9IG51bGwpIHsKICAgICAgICAgICAg\nZHNjLnNldFN1YmNsYXNzZXNMb2FkZWQodHJ1ZSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRz\nYy5sb2FkU3ViY2xhc3Nlcyh0aGlzKTsKICAgICAgICB9IGNhdGNoIChDbGFz\nc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRp\nb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSB0aGUgc3RhdGVtZW50IGEgY2FuZGlkYXRlIGZv\nciBjYW5jZWxsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZv\ncmVFeGVjdXRlU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAg\nIF9zdG1udHMuYWRkKHN0bW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbW92ZSB0aGUgc3RhdGVtZW50IGZyb20gdGhlIGNhbmNlbGxhYmxlIHNldC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFmdGVyRXhlY3V0ZVN0YXRlbWVu\ndChTdGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3RtbnRzLnJlbW92ZShz\ndG1udCk7CiAgICB9CiAgICAKICAgIEZpbmRlclF1ZXJ5SW1wbCBnZXRGaW5k\nZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIEZpbmRlckNhY2hlIGNhY2hlID0gZ2V0RmluZGVy\nQ2FjaGUoKTsKICAgICAgICByZXR1cm4gY2FjaGUgPT0gbnVsbCAKICAgICAg\nICAgICAgID8gbnVsbCA6IChGaW5kZXJRdWVyeUltcGwpY2FjaGUuZ2V0KG1h\ncHBpbmcsIGZldGNoKTsKICAgIH0KICAgIAogICAgYm9vbGVhbiBjYWNoZUZp\nbmRlcihDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0RXhlY3V0b3Igc2Vs\nZWN0LCAKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAg\nICAgICBGaW5kZXJDYWNoZSBjYWNoZSA9IGdldEZpbmRlckNhY2hlKCk7CiAg\nICAgICAgcmV0dXJuIGNhY2hlICE9IG51bGwgJiYgY2FjaGUuY2FjaGUobWFw\ncGluZywgc2VsZWN0LCBmZXRjaCkgIT0gbnVsbDsKICAgIH0KICAgIAogICAg\nRmluZGVyQ2FjaGUgZ2V0RmluZGVyQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJu\nICgoKEJyb2tlckltcGwpZ2V0Q29udGV4dCgpKS5nZXRDYWNoZUZpbmRlclF1\nZXJ5KCkpCiAgICAgICAgICAgICA/IGdldENvbmZpZ3VyYXRpb24oKS5nZXRG\naW5kZXJDYWNoZUluc3RhbmNlKCkgOiBudWxsOwogICAgfQoKCiAgICAvKioK\nICAgICAqIENvbm5lY3Rpb24gcmV0dXJuZWQgdG8gY2xpZW50IGNvZGUuIE1h\na2VzIHN1cmUgaXRzIHdyYXBwZWQgY29ubmVjdGlvbgogICAgICogcmVmIGNv\ndW50IGlzIGRlY3JlbWVudGVkIG9uIGZpbmFsaXplLgogICAgICovCiAgICBw\ndWJsaWMgYWJzdHJhY3Qgc3RhdGljIGNsYXNzIENsaWVudENvbm5lY3Rpb24g\nZXh0ZW5kcwogICAgICAgICAgICBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7Cgog\nICAgICAgIHByaXZhdGUgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CgogICAg\nICAgIHB1YmxpYyBDbGllbnRDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikg\newogICAgICAgICAgICBzdXBlcihjb25uKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIF9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBzdXBlci5j\nbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZmlu\nYWxpemUoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYg\nKCFfY2xvc2VkKQogICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHdyYXBwZXIgdGhh\ndCBrZWVwcyBhbiBpbnRlcm5hbCByZWYgY291bnQgc28gdGhhdCBpdCBrbm93\ncwogICAgICogd2hlbiB0byByZWFsbHkgY2xvc2UuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBjbGFzcyBSZWZDb3VudENvbm5lY3Rpb24gZXh0\nZW5kcyBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAgICAgIHByaXZhdGUg\nYm9vbGVhbiBfcmV0YWluID0gZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQg\nX3JlZnMgPSAwOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfZnJlZWQgPSBm\nYWxzZTsKCiAgICAgICAgcHVibGljIFJlZkNvdW50Q29ubmVjdGlvbihDb25u\nZWN0aW9uIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXRhaW4oKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcmV0YWluOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgc2V0UmV0YWluKGJvb2xlYW4gcmV0YWluKSB7CiAgICAg\nICAgICAgIGlmIChfcmV0YWluICYmICFyZXRhaW4gJiYgX3JlZnMgPD0gMCkK\nICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAgX3JldGFpbiA9\nIHJldGFpbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlZigp\nIHsKICAgICAgICAgICAgLy8gZG9uJ3QgaGF2ZSB0byBsb2NrOyBjYWxsZWQg\nZnJvbSBjb25uZWN0KCksIHdoaWNoIGlzIGxvY2tlZAogICAgICAgICAgICBf\ncmVmcysrOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2Uo\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8gbG9jayBh\ndCBicm9rZXIgbGV2ZWwgdG8gYXZvaWQgZGVhZGxvY2tzCiAgICAgICAgICAg\nIF9jdHgubG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgX3JlZnMtLTsKICAgICAgICAgICAgICAgIGlmIChfcmVmcyA8PSAwICYm\nICFfcmV0YWluKQogICAgICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9jdHgudW5sb2Nr\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGZyZWUoKSB7CiAgICAgICAgICAgIC8vIGVuc3VyZSB0aGF0IHdlIGRv\nIG5vdCBjbG9zZSB0aGUgdW5kZXJseWluZyBjb25uZWN0aW9uCiAgICAgICAg\nICAgIC8vIG11bHRpcGxlIHRpbWVzOyB0aGlzIGNvdWxkIGhhcHBlbiBpZiBz\nb21lb25lIChlLmcuLCBhbgogICAgICAgICAgICAvLyBFeHRlbnQpIGhvbGRz\nIGEgUmVmQ29ubmVjdGlvbiwgYW5kIHRoZW4gY2xvc2VzIGl0IChlLmcuLCBp\nbgogICAgICAgICAgICAvLyB0aGUgZmluYWxpemVyKSBhZnRlciB0aGUgU3Rv\ncmVNYW5hZ2VyIGhhcyBhbHJlYWR5IGJlZW4gY2xvc2VkLgogICAgICAgICAg\nICBpZiAoX2ZyZWVkKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdldERlbGVnYXRlKCkuY2xv\nc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2ZyZWVkID0gdHJ1ZTsKICAg\nICAgICAgICAgX2Nvbm4gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHJv\ndGVjdGVkIFN0YXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoYm9vbGVhbiB3cmFw\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIENv\nbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UoY2FuY2VsU3RhdGVt\nZW50SW1wbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLAogICAgICAgICAgICAg\nICAgICAgIHN1cGVyLmNyZWF0ZVN0YXRlbWVudChmYWxzZSksIFJlZkNvdW50\nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCByc1R5cGUsIGludCBy\nc0NvbmN1ciwKICAgICAgICAgICAgYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NH\nZW5lcmF0b3IubmV3SW5zdGFuY2UoY2FuY2VsU3RhdGVtZW50SW1wbCwgSkRC\nQ1N0b3JlTWFuYWdlci50aGlzLAogICAgICAgICAgICAgICAgICAgIHN1cGVy\nLmNyZWF0ZVN0YXRlbWVudChyc1R5cGUsIHJzQ29uY3VyLCBmYWxzZSksIFJl\nZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0\ncmluZyBzcWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNz\nR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFByZXBhcmVkU3RhdGVtZW50\nSW1wbCwKICAgICAgICAgICAgICAgICAgICBKREJDU3RvcmVNYW5hZ2VyLnRo\naXMsIHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQoc3FsLCBmYWxzZSksIFJlZkNv\ndW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmlu\nZyBzcWwsIGludCByc1R5cGUsCiAgICAgICAgICAgIGludCByc0NvbmN1ciwg\nYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UK\nICAgICAgICAgICAgICAgIChjYW5jZWxQcmVwYXJlZFN0YXRlbWVudEltcGws\nCiAgICAgICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBz\ndXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgcnNUeXBlLCByc0NvbmN1ciwg\nZmFsc2UpLAogICAgICAgICAgICAgICAgICAgIFJlZkNvdW50Q29ubmVjdGlv\nbi50aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdGF0\nZW1lbnQgdHlwZSB0aGF0IGFkZHMgYW5kIHJlbW92ZXMgaXRzZWxmIGZyb20g\ndGhlIHNldCBvZiBhY3RpdmUKICAgICAqIHN0YXRlbWVudHMgc28gdGhhdCBp\ndCBjYW4gYmUgY2FuY2VsZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0\ncmFjdCBjbGFzcyBDYW5jZWxTdGF0ZW1lbnQgZXh0ZW5kcyBEZWxlZ2F0aW5n\nU3RhdGVtZW50IHsKCiAgICAgICAgcHVibGljIENhbmNlbFN0YXRlbWVudChT\ndGF0ZW1lbnQgc3RtbnQsIENvbm5lY3Rpb24gY29ubikgewogICAgICAgICAg\nICBzdXBlcihzdG1udCwgY29ubik7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGV4ZWN1dGVVcGRhdGUoU3RyaW5nIHNxbCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQo\ndGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZShzcWwpOwogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50\nKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90\nZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJpbmcgc3FsLCBib29s\nZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4\nZWN1dGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCByZW1vdmVzIGl0c2Vs\nZiBmcm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1lbnRzIHNv\nIHRoYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICovCiAgICBwcm90ZWN0\nZWQgYWJzdHJhY3QgY2xhc3MgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQgZXh0\nZW5kcwogICAgICAgICAgICBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQg\newoKICAgICAgICBwdWJsaWMgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgICAgICBDb25uZWN0aW9u\nIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoc3RtbnQsIGNvbm4pOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBleGVjdXRlVXBkYXRlKCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVT\ndGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3Rh\ndGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShib29sZWFuIHdy\nYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVF\neGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVRdWVyeSh3cmFwKTsK\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVy\nRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludFtdIGV4ZWN1dGVCYXRjaCgpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3Rh\ndGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVCYXRjaCgpOwogICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVt\nZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cgo=\n","encoding":"base64"}

