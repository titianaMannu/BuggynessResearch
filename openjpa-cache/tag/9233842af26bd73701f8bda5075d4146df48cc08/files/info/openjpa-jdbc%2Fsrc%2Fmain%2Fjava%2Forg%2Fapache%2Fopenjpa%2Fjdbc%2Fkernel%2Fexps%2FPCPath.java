{"sha":"9a8c52bb25c93ccd44398a846d859161cfb950bd","node_id":"MDQ6QmxvYjIwNjM2NDo5YThjNTJiYjI1YzkzY2NkNDQzOThhODQ2ZDg1OTE2MWNmYjk1MGJk","size":40826,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9a8c52bb25c93ccd44398a846d859161cfb950bd","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc3Fs\nLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3RJdGVyYXRvcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5P\nYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZVF1ZXJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1pbmF0\nb3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxk\nTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLkhhbmRsZXJDb2xsZWN0aW9uVGFibGVGaWVsZFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuSGFuZGxlckhhbmRsZXJNYXBUYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5MUlNNYXBG\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlNjaGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkJyb2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nRmlsdGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3Bl\nbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkNhbmRpZGF0ZVBhdGg7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLlhNTE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioKICogQSBwYXRoIHJl\ncHJlc2VudHMgYSB0cmF2ZXJzYWwgaW50byBmaWVsZHMgb2YgYSBjYW5kaWRh\ndGUgb2JqZWN0LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGlj\nIGNsYXNzIFBDUGF0aAogICAgZXh0ZW5kcyBDYW5kaWRhdGVQYXRoCiAgICBp\nbXBsZW1lbnRzIEpEQkNQYXRoIHsKCQogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBTdHJpbmcgVFJVRSA9ICIxID0gMSI7CiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIFN0cmluZyBGQUxTRSA9ICIxIDw+IDEiOwoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBQQVRIID0gMDsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBCT1VORF9WQVIgPSAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFVOQk9VTkRfVkFSID0gMjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBVTkFDQ0VTU0VEX1ZBUiA9IDM7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgWFBBVEggPSA0OwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UoUENQYXRoLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIENsYXNzTWFw\ncGluZyBfY2FuZGlkYXRlOwogICAgcHJpdmF0ZSBDbGFzc01hcHBpbmcgX2Ns\nYXNzID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfa2V5ID0gZmFsc2U7\nCiAgICBwcml2YXRlIGludCBfdHlwZSA9IFBBVEg7CiAgICBwcml2YXRlIFN0\ncmluZyBfdmFyTmFtZSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzIF9jYXN0\nID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2lkID0gZmFsc2U7CiAg\nICBwcml2YXRlIEZpZWxkTWV0YURhdGEgX3htbGZpZWxkID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfa2V5UGF0aCA9IGZhbHNlOwogICAgcHJpdmF0\nZSBTdHJpbmcgX3NjaGVtYUFsaWFzID0gbnVsbDsKCiAgICAvKioKICAgICAq\nIFJldHVybiBhIHBhdGggc3RhcnRpbmcgd2l0aCB0aGUgJ3RoaXMnIHB0ci4K\nICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFzc01hcHBpbmcgdHlwZSkg\newogICAgICAgIF9jYW5kaWRhdGUgPSB0eXBlOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBmcm9tIHRoZSBnaXZlbiB2\nYXJpYWJsZS4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFzc01hcHBp\nbmcgY2FuZGlkYXRlLCBWYXJpYWJsZSB2YXIpIHsKICAgICAgICBfY2FuZGlk\nYXRlID0gY2FuZGlkYXRlOwogICAgICAgIF9hY3Rpb25zID0gbmV3IExpbmtl\nZExpc3QoKTsKCiAgICAgICAgUENQYXRoIG90aGVyID0gdmFyLmdldFBDUGF0\naCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7CiAg\nICAgICAgYWN0aW9uLnZhciA9IHZhci5nZXROYW1lKCk7CiAgICAgICAgaWYg\nKG90aGVyID09IG51bGwpIHsKICAgICAgICAgICAgX3R5cGUgPSBVTkJPVU5E\nX1ZBUjsKICAgICAgICAgICAgYWN0aW9uLm9wID0gQWN0aW9uLlVOQk9VTkRf\nVkFSOwogICAgICAgICAgICBhY3Rpb24uZGF0YSA9IHZhcjsKICAgICAgICAg\nICAgX3NjaGVtYUFsaWFzID0gdmFyLmdldE5hbWUoKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAvLyBib3VuZCB2YXJpYWJsZTsgY29weSBwYXRo\nCiAgICAgICAgICAgIF90eXBlID0gVU5BQ0NFU1NFRF9WQVI7CiAgICAgICAg\nICAgIF9hY3Rpb25zLmFkZEFsbChvdGhlci5fYWN0aW9ucyk7CiAgICAgICAg\nICAgIF9rZXkgPSBvdGhlci5fa2V5OwoKICAgICAgICAgICAgYWN0aW9uLm9w\nID0gQWN0aW9uLlZBUjsKICAgICAgICAgICAgYWN0aW9uLmRhdGEgPSB2YXIu\nZ2V0TmFtZSgpOwogICAgICAgICAgICBfc2NoZW1hQWxpYXMgPSBvdGhlci5f\nc2NoZW1hQWxpYXM7CiAgICAgICAgICAgIF9jb3JyZWxhdGlvblZhciA9IG90\naGVyLl9jb3JyZWxhdGlvblZhcjsKICAgICAgICB9CiAgICAgICAgX2FjdGlv\nbnMuYWRkKGFjdGlvbik7CiAgICAgICAgX2Nhc3QgPSB2YXIuZ2V0VHlwZSgp\nOyAvLyBpbml0aWFsIHR5cGUgaXMgdmFyIHR5cGUKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHBhdGggc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4g\nc3VicXVlcnkuCiAgICAgKi8KICAgIHB1YmxpYyBQQ1BhdGgoU3ViUSBzdWIp\nIHsKICAgICAgICBfY2FuZGlkYXRlID0gc3ViLmdldENhbmRpZGF0ZSgpOwog\nICAgICAgIF9hY3Rpb25zID0gbmV3IExpbmtlZExpc3QoKTsKCiAgICAgICAg\nQWN0aW9uIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBhY3Rpb24u\nb3AgPSBBY3Rpb24uU1VCUVVFUlk7CiAgICAgICAgYWN0aW9uLmRhdGEgPSBz\ndWIuZ2V0Q2FuZGlkYXRlQWxpYXMoKTsKICAgICAgICBfYWN0aW9ucy5hZGQo\nYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IHN1Yi5nZXRUeXBlKCk7IC8vIGlu\naXRpYWwgdHlwZSBpcyBzdWJxdWVyeSB0eXBlCiAgICAgICAgX3Zhck5hbWUg\nPSBzdWIuZ2V0Q2FuZGlkYXRlQWxpYXMoKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRTY2hlbWFBbGlhcyhTdHJpbmcgc2NoZW1hQWxpYXMpIHsKICAg\nICAgICBpZiAoX3NjaGVtYUFsaWFzID09IG51bGwpIAogICAgICAgICAgICBf\nc2NoZW1hQWxpYXMgPSBzY2hlbWFBbGlhczsKICAgIH0KCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFNjaGVtYUFsaWFzKCkgewogICAgICAgIHJldHVybiBfc2No\nZW1hQWxpYXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHNldFN1YnF1\nZXJ5Q29udGV4dChDb250ZXh0IGNvbnRleHQsIFN0cmluZyBjb3JyZWxhdGlv\nblZhcikgewogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBsYXN0RmllbGRBY3Rp\nb24oKTsKICAgICAgICBpZiAoYWN0aW9uID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBhY3Rpb24uY29udGV4dCA9IGNvbnRleHQ7CiAg\nICAgICAgX2NvcnJlbGF0aW9uVmFyID0gY29ycmVsYXRpb25WYXI7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogU2V0IHRoZSBwYXRoIGFzIGEgYmluZGlu\nZyBvZiB0aGUgZ2l2ZW4gdmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGFkZFZhcmlhYmxlQWN0aW9uKFZhcmlhYmxlIHZhcikgewogICAgICAg\nIF92YXJOYW1lID0gdmFyLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0cnVlIGlmIHRoaXMgaXMgYSBib3VuZCB2YXJpYWJsZSB0\naGF0IGhhcyBub3QgYmVlbiBhY2Nlc3NlZAogICAgICogYWZ0ZXIgYmluZGlu\nZy4gVXNlZnVsIGZvciBmaWx0ZXJzIGxpa2UKICAgICAqICJjb2xsLmNvbnRh\naW5zICh2YXIpICZhbXA7JmFtcDsgdmFyID09IG51bGwiLCB3aGljaCBzaG91\nbGQgcmVhbGx5CiAgICAgKiBqdXN0IGFjdCBsaWtlICJjb2xsLmNvbnRhaW5z\nIChudWxsKSIuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVW5hY2Nl\nc3NlZFZhcmlhYmxlKCkgewogICAgICAgIHJldHVybiBfdHlwZSA9PSBVTkFD\nQ0VTU0VEX1ZBUjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHRoaXMgaXMgYSBwYXRoIGludm9sdmluZyBhIHZhcmlhYmxlLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZhcmlhYmxlUGF0aCgpIHsKICAg\nICAgICByZXR1cm4gX3R5cGUgIT0gUEFUSDsKICAgIH0KCiAgICAvKioKICAg\nICAqIElmIHRoaXMgcGF0aCBpcyBwYXJ0IG9mIGEgY29udGFpbnMgY2xhdXNl\nLCB0aGVuIGFsaWFzIGl0IHRvIHRoZQogICAgICogcHJvcGVyIGNvbnRhaW5z\nIGlkIGJlZm9yZSBpbml0aWFsaXphdGlvbi4KICAgICAqLwogICAgcHVibGlj\nIHN5bmNocm9uaXplZCB2b2lkIHNldENvbnRhaW5zSWQoU3RyaW5nIGlkKSB7\nCiAgICAgICAgaWYgKF9jaWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gdHJlYXQgaXQganVzdCBsaWtlIGEgdW5pcXVlIHZhcmlhYmxlCiAg\nICAgICAgQWN0aW9uIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBh\nY3Rpb24ub3AgPSBBY3Rpb24uVkFSOwogICAgICAgIGFjdGlvbi5kYXRhID0g\naWQ7CiAgICAgICAgaWYgKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAg\nIF9hY3Rpb25zID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBfYWN0aW9u\ncy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2lkID0gdHJ1ZTsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAg\nICByZXR1cm4gX2NsYXNzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1l\ndGFEYXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9jbGFzcyA9\nIChDbGFzc01hcHBpbmcpIG1ldGE7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNLZXkoKSB7CiAgICAgICAgcmV0dXJuIF9rZXk7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBib29sZWFuIGlzWFBhdGgoKSB7CiAgICAgICAgcmV0dXJu\nIF90eXBlID09IFhQQVRIOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFhQYXRoKCkgewogICAgICAgIFN0cmluZ0J1ZmZlciB4cGF0aCA9IG5l\ndyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uOwogICAg\nICAgIEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7CiAgICAg\nICAgCiAgICAgICAgLy8gU2tpcCB2YXJpYWJsZSBhY3Rpb25zIHNpbmNlIHRo\nZXkgYXJlIG5vdCBwYXJ0IG9mIHRoZSB4cGF0aAogICAgICAgIC8vIHVudGls\nIHdlIHJlYWNoIHRoZSBmaXJzdCB4cGF0aCBhY3Rpb24uCiAgICAgICAgLy8g\nVGhlIGZpcnN0IHhwYXRoIGFjdGlvbiBtYXBzIHRvIHRoZSByb290IG9mIGFu\nIHhtbCBkb2N1bWVudC4KICAgICAgICBkbyAKICAgICAgICAgICAgYWN0aW9u\nID0gKEFjdGlvbikgaXRyLm5leHQoKTsgCiAgICAgICAgd2hpbGUgKGFjdGlv\nbi5vcCAhPSBBY3Rpb24uR0VUX1hQQVRIKTsKICAgICAgICAKICAgICAgICAv\nLyBTa2lwIFhtbFJvb3RFbGVtZW50OgogICAgICAgIC8vIFdlIGNhbid0IHJl\nbHkgb24gdGhlIGFjY3VyYWN5IG9mIHRoZSBuYW1lIG9mIHRoZSByb290IGVs\nZW1lbnQsCiAgICAgICAgLy8gYmVjYXVzZSBpdCBjb3VsZCBiZSBzZXQgdG8g\nc29tZSBkZWZhdWx0IGJ5IEpBWEIgWE1MIEJpbmRpbmcuCiAgICAgICAgLy8g\nVGhlIGNhbGxlcihEQkRpY3Rpb25hcnkpIHNob3VsZCBzdGFydCB3aXRoICIv\nKiIgb3IgIi8qLyIsCiAgICAgICAgLy8gd2UgYnVpbGQgdGhlIHJlbWFpbmlu\nZyB4cGF0aCB0aGF0IGZvbGxvd3MgdGhlIHJvb3QgZWxlbWVudC4KICAgICAg\nICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewogICAgICAgICAgICBhY3Rpb24g\nPSAoQWN0aW9uKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoKChYTUxN\nZXRhRGF0YSkgYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgeHBhdGguYXBwZW5kKCgoWE1MTWV0YURhdGEpIGFj\ndGlvbi5kYXRhKS5nZXRYbWxuYW1lKCkpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICB4cGF0aC5hcHBlbmQoIioiKTsKICAgICAgICAgICAg\naWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICB4cGF0aC5hcHBl\nbmQoIi8iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHhwYXRoLnRvU3Ry\naW5nKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UENQYXRo\nU3RyaW5nKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gKF92YXJOYW1lID09IG51bGwpID8gIiIgOiBfdmFy\nTmFtZSArICIuIjsKCiAgICAgICAgU3RyaW5nQnVmZmVyIHBhdGggPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGFjdGlvbiA9IChBY3Rpb24p\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0\naW9uLlZBUiB8fCBhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQogICAg\nICAgICAgICAgICAgcGF0aC5hcHBlbmQoYWN0aW9uLmRhdGEpOwogICAgICAg\nICAgICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlVOQk9VTkRfVkFS\nKQogICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoKChWYXJpYWJsZSkgYWN0\naW9uLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGVsc2UgCiAgICAg\nICAgICAgICAgICBwYXRoLmFwcGVuZCgoKEZpZWxkTWFwcGluZykgYWN0aW9u\nLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHBhdGguYXBwZW5kKCcu\nJyk7CiAgICAgICAgfQogICAgICAgIGlmIChfdmFyTmFtZSAhPSBudWxsKQog\nICAgICAgICAgICBwYXRoLmFwcGVuZChfdmFyTmFtZSkuYXBwZW5kKCcuJyk7\nCiAgICAgICAgcmV0dXJuIHBhdGgudG9TdHJpbmcoKTsKICAgIH0KCiAgICBw\ndWJsaWMgQ2xhc3NNYXBwaW5nIGdldENsYXNzTWFwcGluZyhFeHBTdGF0ZSBz\ndGF0ZSkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4\ncFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBfY2xhc3M7CiAgICAgICAgaWYgKF9r\nZXkpIHsKICAgICAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRLZXkoKS5n\nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAg\nIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFR5cGVN\nYXBwaW5nKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICBpZiAocHN0\nYXRlLmZpZWxkLmlzRWxlbWVudENvbGxlY3Rpb24oKSAmJgogICAgICAgICAg\nICAgICAgcHN0YXRlLmZpZWxkLmdldEVsZW1lbnQoKS5pc0VtYmVkZGVkKCkp\nCiAgICAgICAgICAgICAgICBwc3RhdGUuaXNFbWJlZEVsZW1lbnRDb2xsID0g\ndHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgfQogICAg\nICAgIGlmIChwc3RhdGUuZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuUEMpCiAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlw\nZU1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgRmllbGRNYXBwaW5nIGdldEZpZWxkTWFwcGluZyhFeHBTdGF0ZSBz\ndGF0ZSkgewogICAgICAgIHJldHVybiAoKFBhdGhFeHBTdGF0ZSkgc3RhdGUp\nLmZpZWxkOwogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5z\nKEV4cFN0YXRlIHN0YXRlKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0\nZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChwc3RhdGUu\nY29scyA9PSBudWxsKQogICAgICAgICAgICBwc3RhdGUuY29scyA9IGNhbGN1\nbGF0ZUNvbHVtbnMocHN0YXRlKTsKICAgICAgICByZXR1cm4gcHN0YXRlLmNv\nbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY29sdW1ucyB1c2VkIGJ5\nIHRoaXMgcGF0aC4KICAgICAqLwogICAgcHJpdmF0ZSBDb2x1bW5bXSBjYWxj\ndWxhdGVDb2x1bW5zKFBhdGhFeHBTdGF0ZSBwc3RhdGUpIHsKICAgICAgICBp\nZiAoX2tleSB8fAogICAgICAgICAgICAoX2tleVBhdGggJiYgcHN0YXRlLmZp\nZWxkLmdldEtleSgpICE9IG51bGwgJiYKICAgICAgICAgICAgICAgICFwc3Rh\ndGUuZmllbGQuZ2V0S2V5KCkuaXNFbWJlZGRlZCgpKSkgewogICAgICAgICAg\nICBpZiAoIXBzdGF0ZS5qb2luZWRSZWwgCiAgICAgICAgICAgICAgICAmJiBw\nc3RhdGUuZmllbGQuZ2V0S2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBqb2luUmVsYXRpb24ocHN0YXRlLCBfa2V5\nLCBmYWxzZSwgZmFsc2UpOwogICAgICAgICAgICBlbHNlIGlmIChwc3RhdGUu\nam9pbmVkUmVsIAogICAgICAgICAgICAgICAgJiYgcHN0YXRlLmZpZWxkLmdl\ndEtleSgpLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRLZXlNYXBwaW5nKCku\nZ2V0VHlwZU1hcHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICBnZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpOwogICAgICAgICAgICByZXR1cm4gcHN0YXRlLmZp\nZWxkLmdldEtleU1hcHBpbmcoKS5nZXRDb2x1bW5zKCk7CiAgICAgICAgfQog\nICAgICAgIGlmIChwc3RhdGUuZmllbGQgIT0gbnVsbCkgewogICAgICAgICAg\nICBzd2l0Y2ggKHBzdGF0ZS5maWVsZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgVmFs\ndWVNYXBwaW5nIGVsZW0gPSBwc3RhdGUuZmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKTsKICAgICAgICAgICAgICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmlz\nRWxlbWVudENvbGxlY3Rpb24oKSAmJiBwc3RhdGUuZmllbGQuZ2V0RWxlbWVu\ndCgpLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBT\ndHJhdGVneSBzdHJhdGVneSA9IHBzdGF0ZS5maWVsZC5nZXRTdHJhdGVneSgp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RyYXRlZ3kgaW5zdGFu\nY2VvZiBIYW5kbGVyQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoSGFuZGxlckNv\nbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3kpIHN0cmF0ZWd5KS4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRFbGVtZW50Q29sdW1ucyhl\nbGVtLmdldFR5cGVNYXBwaW5nKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgaWYgKHN0cmF0ZWd5IGluc3RhbmNlb2YgSGFuZGxlckhhbmRs\nZXJNYXBUYWJsZUZpZWxkU3RyYXRlZ3kpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiAoKEhhbmRsZXJIYW5kbGVyTWFwVGFibGVGaWVs\nZFN0cmF0ZWd5KSBzdHJhdGVneSkuCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBnZXRWYWx1ZUNvbHVtbnMoZWxlbS5nZXRUeXBlTWFwcGluZygpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICBpZiAocHN0YXRlLmpvaW5lZFJlbCAm\nJiBlbGVtLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRUeXBlTWFwcGluZygp\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGVsZW0uZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldENvbHVtbnMoKTsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdldENvbHVtbnMo\nKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAg\nICAgICAgICAgICAgIGlmIChwc3RhdGUuam9pbmVkUmVsKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdldFR5cGVNYXBw\naW5nKCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRQcmltYXJ5\nS2V5Q29sdW1ucygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwc3Rh\ndGUuZmllbGQuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdl\ndENvbHVtbnMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gKF9jbGFzcyA9PSBudWxsKSA/IFNjaGVtYXMuRU1QVFlfQ09MVU1O\nUwogICAgICAgICAgICA6IF9jbGFzcy5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVmFyaWFibGUoKSB7CiAg\nICAgICAgaWYgKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBBY3Rpb24gYWN0aW9uID0gKEFjdGlvbikgX2Fj\ndGlvbnMuZ2V0TGFzdCgpOwogICAgICAgIHJldHVybiBhY3Rpb24ub3AgPT0g\nQWN0aW9uLlVOQk9VTkRfVkFSIHx8IGFjdGlvbi5vcCA9PSBBY3Rpb24uVkFS\nOyAKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBnZXQoRmllbGRNZXRhRGF0YSBm\naWVsZCwgYm9vbGVhbiBudWxsVHJhdmVyc2FsKSB7CiAgICAgICAgaWYgKF9h\nY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIF9hY3Rpb25zID0gbmV3IExp\nbmtlZExpc3QoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlv\nbigpOwogICAgICAgIGFjdGlvbi5vcCA9IChudWxsVHJhdmVyc2FsKSA/IEFj\ndGlvbi5HRVRfT1VURVIgOiBBY3Rpb24uR0VUOwogICAgICAgIGFjdGlvbi5k\nYXRhID0gZmllbGQ7CiAgICAgICAgX2FjdGlvbnMuYWRkKGFjdGlvbik7CiAg\nICAgICAgaWYgKF90eXBlID09IFVOQUNDRVNTRURfVkFSKQogICAgICAgICAg\nICBfdHlwZSA9IEJPVU5EX1ZBUjsKICAgICAgICBfY2FzdCA9IG51bGw7CiAg\nICAgICAgX2tleSA9IGZhbHNlOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9p\nZCBnZXQoRmllbGRNZXRhRGF0YSBmbWQsIFhNTE1ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2Fj\ndGlvbnMgPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAgIEFjdGlvbiBhY3Rp\nb24gPSBuZXcgQWN0aW9uKCk7CiAgICAgICAgYWN0aW9uLm9wID0gQWN0aW9u\nLkdFVF9YUEFUSDsKICAgICAgICBhY3Rpb24uZGF0YSA9IG1ldGE7CiAgICAg\nICAgX2FjdGlvbnMuYWRkKGFjdGlvbik7CiAgICAgICAgX2Nhc3QgPSBudWxs\nOwogICAgICAgIF9rZXkgPSBmYWxzZTsKICAgICAgICBfdHlwZSA9IFhQQVRI\nOwogICAgICAgIF94bWxmaWVsZCA9IGZtZDsKICAgIH0KICAgIAogICAgcHVi\nbGljIHZvaWQgZ2V0KFhNTE1ldGFEYXRhIG1ldGEsIFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgQWN0aW9uIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAg\nICBhY3Rpb24ub3AgPSBBY3Rpb24uR0VUX1hQQVRIOwogICAgICAgIGFjdGlv\nbi5kYXRhID0gbWV0YS5nZXRGaWVsZE1hcHBpbmcobmFtZSk7CiAgICAgICAg\nX2FjdGlvbnMuYWRkKGFjdGlvbik7CiAgICAgICAgX2Nhc3QgPSBudWxsOwog\nICAgICAgIF9rZXkgPSBmYWxzZTsKICAgICAgICBfdHlwZSA9IFhQQVRIOwog\nICAgfQogICAgCiAgICBwdWJsaWMgWE1MTWV0YURhdGEgZ2V0WG1sTWFwcGlu\nZygpIHsKICAgICAgICBBY3Rpb24gYWN0ID0gKEFjdGlvbikgX2FjdGlvbnMu\nZ2V0TGFzdCgpOwogICAgICAgIGlmIChhY3QgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIChYTUxNZXRhRGF0YSkgYWN0LmRhdGE7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lk\nIGdldEtleSgpIHsKICAgICAgICBpZiAoX2NpZCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAvLyByZXBsYWNlIHRoZSBsYXN0IGZpZWxkIGFjdGlv\nbiB0byBhIGdldCBrZXkKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbGFzdEZp\nZWxkQWN0aW9uKCk7CiAgICAgICAgQWN0aW9uIGtleSA9IG5ldyBBY3Rpb24o\nKTsKICAgICAgICBrZXkub3AgPSBBY3Rpb24uR0VUX0tFWTsKICAgICAgICBr\nZXkuZGF0YSA9IGFjdGlvbi5kYXRhOwogICAgICAgIGludCBwb3MgPSBfYWN0\naW9ucy5pbmRleE9mKGFjdGlvbik7CiAgICAgICAgX2FjdGlvbnMucmVtb3Zl\nKGFjdGlvbik7CiAgICAgICAgX2FjdGlvbnMuYWRkKHBvcywga2V5KTsKICAg\nICAgICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tleSA9IHRydWU7CiAgICAg\nICAgX3R5cGUgPSBQQVRIOwogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1ldGFE\nYXRhIGxhc3QoKSB7CiAgICAgICAgQWN0aW9uIGFjdCA9IGxhc3RGaWVsZEFj\ndGlvbigpOwogICAgICAgIHJldHVybiAoYWN0ID09IG51bGwpID8gbnVsbCA6\nIGlzWFBhdGgoKSA/CiAgICAgICAgICAgIF94bWxmaWVsZCA6IChGaWVsZE1l\ndGFEYXRhKSBhY3QuZGF0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbGFzdCBhY3Rpb24gdGhhdCBnZXRzIGEgZmllbGQuCiAgICAgKi8K\nICAgIHByaXZhdGUgQWN0aW9uIGxhc3RGaWVsZEFjdGlvbigpIHsKICAgICAg\nICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGlmIChpc1hQYXRoKCkpCiAgICAgICAgICAgIHJldHVy\nbiAoQWN0aW9uKSBfYWN0aW9ucy5nZXRMYXN0KCk7CiAgICAgICAgCiAgICAg\nICAgTGlzdEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLmxpc3RJdGVyYXRvcihf\nYWN0aW9ucy5zaXplKCkpOwogICAgICAgIEFjdGlvbiBwcmV2OwogICAgICAg\nIHdoaWxlIChpdHIuaGFzUHJldmlvdXMoKSkgewogICAgICAgICAgICBwcmV2\nID0gKEFjdGlvbikgaXRyLnByZXZpb3VzKCk7CiAgICAgICAgICAgIGlmIChw\ncmV2Lm9wID09IEFjdGlvbi5HRVQgfHwgcHJldi5vcCA9PSBBY3Rpb24uR0VU\nX09VVEVSCiAgICAgICAgICAgICAgICB8fCBwcmV2Lm9wID09IEFjdGlvbi5H\nRVRfS0VZKQogICAgICAgICAgICAgICAgcmV0dXJuIHByZXY7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBDbGFz\ncyBnZXRUeXBlKCkgewogICAgICAgIGlmIChfY2FzdCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX2Nhc3Q7CiAgICAgICAgQWN0aW9uIGFjdCA9IGxh\nc3RGaWVsZEFjdGlvbigpOwogICAgICAgIGlmIChhY3QgIT0gbnVsbCAmJiBh\nY3Qub3AgPT0gQWN0aW9uLkdFVF9YUEFUSCkKICAgICAgICAgICAgcmV0dXJu\nICgoWE1MTWV0YURhdGEpIGFjdC5kYXRhKS5nZXRUeXBlKCk7CiAgICAgICAg\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbGQgPSAoYWN0ID09IG51bGwpID8g\nbnVsbCA6IChGaWVsZE1ldGFEYXRhKSBhY3QuZGF0YTsKICAgICAgICBib29s\nZWFuIGtleSA9IGFjdCAhPSBudWxsICYmIGFjdC5vcCA9PSBBY3Rpb24uR0VU\nX0tFWTsKICAgICAgICBpZiAoZmxkICE9IG51bGwpIHsKICAgICAgICAgICAg\nc3dpdGNoIChmbGQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAg\nICAgICBpZiAoZmxkLmdldERlY2xhcmVkVHlwZSgpID09IGJ5dGVbXS5jbGFz\ncwogICAgICAgICAgICAgICAgICAgICAgICB8fCBmbGQuZ2V0RGVjbGFyZWRU\neXBlKCkgPT0gQnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgICAg\nIHx8IGZsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBjaGFyW10uY2xhc3MKICAg\nICAgICAgICAgICAgICAgICAgICAgfHwgZmxkLmdldERlY2xhcmVkVHlwZSgp\nID09IENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZmxkLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmbGQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlw\nZSgpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgICAgIGlmIChrZXkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmbGQuZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRFbGVtZW50KCkuZ2V0\nRGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGQu\nZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmxkLmdl\ndERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGlmIChfY2xhc3MgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9j\nbGFzcy5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgcmV0dXJuIE9iamVj\ndC5jbGFzczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJbXBsaWNpdFR5\ncGUoQ2xhc3MgdHlwZSkgewogICAgICAgIF9jYXN0ID0gdHlwZTsKICAgIH0K\nCiAgICBwdWJsaWMgRXhwU3RhdGUgaW5pdGlhbGl6ZShTZWxlY3Qgc2VsLCBF\neHBDb250ZXh0IGN0eCwgaW50IGZsYWdzKSB7CiAgICAgICAgUGF0aEV4cFN0\nYXRlIHBzdGF0ZSA9IG5ldyBQYXRoRXhwU3RhdGUoc2VsLm5ld0pvaW5zKCkp\nOwogICAgICAgIGJvb2xlYW4ga2V5ID0gZmFsc2U7CiAgICAgICAgYm9vbGVh\nbiBmb3JjZU91dGVyID0gZmFsc2U7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHJl\nbCA9IF9jYW5kaWRhdGU7CgogICAgICAgIHNlbC5zZXRTY2hlbWFBbGlhcyhf\nc2NoZW1hQWxpYXMpOwoKICAgICAgICAvLyBpdGVyYXRlIHRvIHRoZSBmaW5h\nbCBmaWVsZAogICAgICAgIENsYXNzTWFwcGluZyBvd25lcjsKICAgICAgICBD\nbGFzc01hcHBpbmcgZnJvbSwgdG87CiAgICAgICAgQWN0aW9uIGFjdGlvbjsK\nICAgICAgICBWYXJpYWJsZSB2YXI7CiAgICAgICAgSXRlcmF0b3IgaXRyID0g\nKF9hY3Rpb25zID09IG51bGwpID8gbnVsbCA6IF9hY3Rpb25zLml0ZXJhdG9y\nKCk7CiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkID0gbnVsbDsKICAgICAg\nICBBY3Rpb24gcHJldmFjdGlvbiA9IG51bGw7CiAgICAgICAgYm9vbGVhbiBp\nc0NvcnJlbGF0ZWRQYXRoID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBmcm9t\nUGFyZW50Um9vdEluU3Vic2VsZWN0ID0gbmF2aWdhdGVGcm9tUGFyZW50Um9v\ndEluU3Vic2VsZWN0KHNlbCk7CiAgICAgICAgICAgICAgICAKICAgICAgICB3\naGlsZSAoaXRyICE9IG51bGwgJiYgaXRyLmhhc05leHQoKSkgewogICAgICAg\nICAgICBhY3Rpb24gPSAoQWN0aW9uKSBpdHIubmV4dCgpOwoKICAgICAgICAg\nICAgLy8gdHJlYXQgc3VicXVlcmllcyBsaWtlIHZhcmlhYmxlcyBmb3IgYWxp\nYXMgZ2VuZXJhdGlvbiBwdXJwb3NlcwogICAgICAgICAgICBpZiAoYWN0aW9u\nLm9wID09IEFjdGlvbi5WQVIpIHsKICAgICAgICAgICAgICAgIGlmIChzZWwu\nZ2V0UGFyZW50KCkgIT0gbnVsbCAmJiBhY3Rpb24udmFyICE9IG51bGwgJiYK\nICAgICAgICAgICAgICAgICAgICBwcmV2YWN0aW9uICE9IG51bGwgJiYgcHJl\ndmFjdGlvbi5kYXRhICE9IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICBz\nZWwuY3R4KCkuZ2V0VmFyaWFibGUoYWN0aW9uLnZhcikgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIGlzQ29ycmVsYXRlZFBhdGggPSB0cnVlOwog\nICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5qb2lu\ncy5zZXRDb3JyZWxhdGVkVmFyaWFibGUoYWN0aW9uLnZhcik7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgCiAgICAgICAgICAgICAgICAgICAgcHN0YXRlLmpv\naW5zID0gcHN0YXRlLmpvaW5zLnNldFZhcmlhYmxlKChTdHJpbmcpIGFjdGlv\nbi5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChh\nY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKSB7CiAgICAgICAgICAgICAg\nICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0U3Vic2VsZWN0KChT\ndHJpbmcpIGFjdGlvbi5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlVOQk9VTkRfVkFSKSB7\nCiAgICAgICAgICAgICAgICAvLyB1bmJvdW5kIHZhcnMgYXJlIGNyb3NzLWpv\naW5lZCB0byB0aGUgY2FuZGlkYXRlIHRhYmxlCiAgICAgICAgICAgICAgICB2\nYXIgPSAoVmFyaWFibGUpIGFjdGlvbi5kYXRhOwogICAgICAgICAgICAgICAg\ncmVsID0gKENsYXNzTWFwcGluZykgdmFyLmdldE1ldGFEYXRhKCk7CiAgICAg\nICAgICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAgICAgICAgICAgICAJ\ndGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgK\nICAgICAgICAgICAgICAgIAkgICAgImludmFsaWQtdW5ib3VuZC12YXIiLCB2\nYXIuZ2V0TmFtZSgpKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIAkg\nICAgCiAgICAgICAgICAgICAgICBpZiAoc2VsLmdldFBhcmVudCgpICE9IG51\nbGwgJiYgYWN0aW9uLnZhciAhPSBudWxsICYmCiAgICAgICAgICAgICAgICAg\nICAgc2VsLmN0eCgpLmdldFZhcmlhYmxlKGFjdGlvbi52YXIpID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAvL1N5c3RlbS5vdXQucHJpbnRsbigi\nQ29ycmVsYXRlZCBhY3Rpb24gdmFyPSIrYWN0aW9uLnZhcik7CiAgICAgICAg\nICAgICAgICAgICAgaXNDb3JyZWxhdGVkUGF0aCA9IHRydWU7CiAgICAgICAg\nICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldENv\ncnJlbGF0ZWRWYXJpYWJsZSh2YXIuZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFZhcmlhYmxlKHZh\nci5nZXROYW1lKCkpOwoKICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9\nIHBzdGF0ZS5qb2lucy5jcm9zc0pvaW4oX2NhbmRpZGF0ZS5nZXRUYWJsZSgp\nLAogICAgICAgICAgICAgICAgICAgIHJlbC5nZXRUYWJsZSgpKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIG1vdmUgcGFzdCB0\naGUgcHJldmlvdXMgZmllbGQsIGlmIGFueQogICAgICAgICAgICAgICAgZmll\nbGQgPSAoRmllbGRNYXBwaW5nKSAoKGFjdGlvbi5vcCA9PSBBY3Rpb24uR0VU\nX1hQQVRIKSA/CiAgICAgICAgICAgICAgICAgICAgX3htbGZpZWxkIDogYWN0\naW9uLmRhdGEpOwoKICAgICAgICAgICAgICAgIGlmIChwc3RhdGUuZmllbGQg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMg\ndGhlIHNlY29uZC10by1sYXN0IGZpZWxkIGFuZCB0aGUgbGFzdCBpcwogICAg\nICAgICAgICAgICAgICAgIC8vIHRoZSByZWxhdGVkIGZpZWxkIHRoaXMgZmll\nbGQgam9pbnMgdG8sIG5vIG5lZWQgdG8KICAgICAgICAgICAgICAgICAgICAv\nLyB0cmF2ZXJzZToganVzdCB1c2UgdGhpcyBmaWVsZCdzIGZrIGNvbHVtbnMK\nICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ci5oYXNOZXh0KCkgJiYgKGZs\nYWdzICYgSk9JTl9SRUwpID09IDAKICAgICAgICAgICAgICAgICAgICAgICAg\nJiYgaXNKb2luZWRGaWVsZChwc3RhdGUuZmllbGQsIGtleSwgZmllbGQpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5jbXBmaWVsZCA9IGZp\nZWxkOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAg\nICAgICAgICAgaWYgKGZyb21QYXJlbnRSb290SW5TdWJzZWxlY3QpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWxhdGVkUGF0aCA9IHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0\nZS5qb2lucy5zZXRDb3JyZWxhdGVkVmFyaWFibGUoX3NjaGVtYUFsaWFzKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zLnNldEpvaW5D\nb250ZXh0KG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZWwgPSB0cmF2ZXJz\nZUZpZWxkKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVyLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gbWFyayBpZiB0aGUg\nbmV4dCB0cmF2ZXJzYWwgc2hvdWxkIGdvIHRocm91Z2gKICAgICAgICAgICAg\nICAgIC8vIHRoZSBrZXkgcmF0aGVyIHRoYW4gdmFsdWUKICAgICAgICAgICAg\nICAgIGtleSA9IGFjdGlvbi5vcCA9PSBBY3Rpb24uR0VUX0tFWTsKICAgICAg\nICAgICAgICAgIGZvcmNlT3V0ZXIgfD0gYWN0aW9uLm9wID09IEFjdGlvbi5H\nRVRfT1VURVI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlm\nIChrZXkgJiYgaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgICAgICBf\na2V5UGF0aCA9IHRydWU7CgogICAgICAgICAgICAgICAgLy8gZ2V0IG1hcHBp\nbmcgZm9yIHRoZSBjdXJyZW50IGZpZWxkCiAgICAgICAgICAgICAgICBwc3Rh\ndGUuZmllbGQgPSBmaWVsZDsKCiAgICAgICAgICAgICAgICBvd25lciA9IHBz\ndGF0ZS5maWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKTsKICAgICAgICAgICAg\nICAgIGlmIChwc3RhdGUuZmllbGQuZ2V0TWFuYWdlbWVudCgpIAogICAgICAg\nICAgICAgICAgICAgICE9IEZpZWxkTWFwcGluZy5NQU5BR0VfUEVSU0lTVEVO\nVCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm9uLXBlcnMtZmllbGQiLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgcHN0YXRlLmZpZWxkKSk7CgogICAgICAgICAgICAgICAgLy8g\nZmluZCB0aGUgbW9zdC1kZXJpdmVkIHR5cGUgYmV0d2VlbiB0aGUgZGVjbGFy\nZWQgcmVsYXRpb24KICAgICAgICAgICAgICAgIC8vIHR5cGUgYW5kIHRoZSBm\naWVsZCdzIG93bmVyLCBhbmQgam9pbiBmcm9tIHRoYXQgdHlwZSB0bwogICAg\nICAgICAgICAgICAgLy8gdGhlIGxlc3NlciBkZXJpdmVkIHR5cGUKICAgICAg\nICAgICAgICAgIGlmIChyZWwgIT0gb3duZXIgJiYgcmVsICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAocmVsLmdldERlc2NyaWJlZFR5cGUo\nKS5pc0Fzc2lnbmFibGVGcm9tCiAgICAgICAgICAgICAgICAgICAgICAgIChv\nd25lci5nZXREZXNjcmliZWRUeXBlKCkpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGZyb20gPSBvd25lcjsKICAgICAgICAgICAgICAgICAgICAgICAg\ndG8gPSByZWw7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgZnJvbSA9IHJlbDsKICAgICAgICAgICAgICAg\nICAgICAgICAgdG8gPSBvd25lcjsKICAgICAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgICAgIGZvciAoOyBmcm9tICE9IG51bGwgJiYgZnJv\nbSAhPSB0bzsKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IGZyb20u\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAJRmllbGRNYXBwaW5nIGNhc3QgPSBmcm9tLmdldEZpZWxk\nTWFwcGluZyhwc3RhdGUuZmllbGQKICAgICAgICAgICAgICAgICAgICAJCQku\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICAJaWYgKGNhc3QgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAJCXBzdGF0ZS5maWVsZCA9IGNh\nc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IGZy\nb20uam9pblN1cGVyY2xhc3MocHN0YXRlLmpvaW5zLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgLy8gbm90aGluZyBtb3JlIHRvIGRvIGZyb20gaGVyZSBvbiBhcyB3\nZSBlbmNvdW50ZXJlZCBhbiB4cGF0aAogICAgICAgICAgICAgICAgLy8gYWN0\naW9uCiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLm9wID09IEFjdGlvbi5H\nRVRfWFBBVEgpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcHJldmFjdGlvbiA9IGFjdGlvbjsKICAgICAg\nICAgICAgaWYgKHByZXZhY3Rpb24gIT0gbnVsbCAmJiBwcmV2YWN0aW9uLmNv\nbnRleHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29udGV4dCBqQ3R4\nID0gSkRCQ1N0b3JlUXVlcnkuZ2V0VGhyZWFkTG9jYWxDb250ZXh0KHByZXZh\nY3Rpb24uY29udGV4dCk7CiAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMg\nPSBwc3RhdGUuam9pbnMuc2V0Sm9pbkNvbnRleHQoakN0eCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF92YXJOYW1lICE9IG51bGwp\nCiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5qb2lucy5zZXRW\nYXJpYWJsZShfdmFyTmFtZSk7CgogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBj\nb21wYXJpbmcgdG8gbnVsbCBvciBkb2luZyBhbiBpc0VtcHR5LCB0aGVuCiAg\nICAgICAgLy8gam9pbiBpbnRvIHRoZSBkYXRhIG9uIHRoZSBmaW5hbCBmaWVs\nZDsgb2J2aW91c2x5IHdlIGNhbid0IGRvIHRoZXNlCiAgICAgICAgLy8gam9p\nbnMgd2hlbiBjb21wYXJpbmcgdG8gbnVsbCBiL2MgdGhlIHdob2xlIHB1cnBv\nc2UgaXMgdG8gc2VlCiAgICAgICAgLy8gd2hldGhlciB0aGUgam9pbnMgZXZl\nbiBleGlzdAogICAgICAgIGlmICgoZmxhZ3MgJiBOVUxMX0NNUCkgPT0gMCkK\nICAgICAgICAgICAgdHJhdmVyc2VGaWVsZChwc3RhdGUsIGtleSwgZm9yY2VP\ndXRlciwgdHJ1ZSk7CiAgICAgICAgcHN0YXRlLmpvaW5lZFJlbCA9IGZhbHNl\nOwogICAgICAgIGlmICgoZmxhZ3MgJiBKT0lOX1JFTCkgIT0gMCkKICAgICAg\nICAgICAgam9pblJlbGF0aW9uKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVyIHx8\nIChmbGFncyAmIEZPUkNFX09VVEVSKSAhPSAwLAogICAgICAgICAgICAgICAg\nZmFsc2UpOwogICAgICAgIGlmIChpc0NvcnJlbGF0ZWRQYXRoKSB7CiAgICAg\nICAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIGFyZSBqb2lucyB0aGF0IGJlbG9u\nZyB0byBwYXJlbnQKICAgICAgICAgICAgcHN0YXRlLmpvaW5zLm1vdmVKb2lu\nc1RvUGFyZW50KCk7CiAgICAgICAgfQogICAgICAgIHBzdGF0ZS5qb2lucy5z\nZXRKb2luQ29udGV4dChudWxsKTsKICAgICAgICAKICAgICAgICBpZiAoX2Fj\ndGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgc3VicUFsaWFz\nID0gZmluZFN1YnFBbGlhcyhzZWwpOwogICAgICAgICAgICBwc3RhdGUuam9p\nbnMgPSBwc3RhdGUuam9pbnMuc2V0U3Vic2VsZWN0KHN1YnFBbGlhcyk7CiAg\nICAgICAgICAgIHBzdGF0ZS5qb2lucy5zZXRDb3JyZWxhdGVkVmFyaWFibGUo\nX3NjaGVtYUFsaWFzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0\ndXJuIHBzdGF0ZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBTdHJpbmcgZmlu\nZFN1YnFBbGlhcyhTZWxlY3Qgc2VsKSB7CiAgICAgICAgU2VsZWN0IHBTZWwg\nPSBzZWwuZ2V0UGFyZW50KCk7CiAgICAgICAgaWYgKHBTZWwgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgQ29udGV4dCBwQ3R4\nID0gcFNlbC5jdHgoKTsKICAgICAgICBpZiAocEN0eC5zdWJxdWVyeSA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAocEN0\neC5nZXRTY2hlbWEoX3NjaGVtYUFsaWFzKSAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gKChTdWJRKXBDdHguc3VicXVlcnkpLmdldENhbmRpZGF0ZUFs\naWFzKCk7CiAgICAgICAgcmV0dXJuIGZpbmRTdWJxQWxpYXMocFNlbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGVuIGEgUENQYXRoIGlzIGluIHN1YnNl\nbGVjdCwgYW5kIGl0IGlzIHNpbXBseSBhIG5hdmlnYXRpb24KICAgICAqIGZy\nb20gdGhlIHBhcmVudCByb290LCB0aGUgam9pbnMgaW52b2x2ZWQgaW4gdGhp\ncyBQQ1BhdGgKICAgICAqIG11c3QgaGFwcGVuIGluIHRoZSBtYWluIHNlbGVj\ndC4gIAogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gbmF2aWdhdGVGcm9t\nUGFyZW50Um9vdEluU3Vic2VsZWN0KFNlbGVjdCBzZWwpIHsKICAgICAgICBp\nZiAoc2VsLmdldFBhcmVudCgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBJdGVyYXRvciBpdHIgPSAoX2FjdGlvbnMgPT0g\nbnVsbCkgPyBudWxsIDogX2FjdGlvbnMuaXRlcmF0b3IoKTsKICAgICAgICBi\nb29sZWFuIG5hdmlnYXRlRnJvbVJvb3QgPSBmYWxzZTsKICAgICAgICBib29s\nZWFuIGhhc1ZhciA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gc3RhcnRzV2l0\naFN1YnF1ZXJ5ID0gZmFsc2U7CiAgICAgICAgd2hpbGUgKGl0ciAhPSBudWxs\nICYmIGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgQWN0aW9uIGFjdGlv\nbiA9IChBY3Rpb24pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhY3Rp\nb24ub3AgPT0gQWN0aW9uLlZBUikgCiAgICAgICAgICAgICAgICBoYXNWYXIg\nPSB0cnVlOwogICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0\naW9uLlNVQlFVRVJZKQogICAgICAgICAgICAgICAgc3RhcnRzV2l0aFN1YnF1\nZXJ5ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICFoYXNWYXIg\nJiYgIXN0YXJ0c1dpdGhTdWJxdWVyeSAmJiBzZWwuY3R4KCkuZ2V0U2NoZW1h\nKF9zY2hlbWFBbGlhcykgPT0gbnVsbDsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gc291cmNlIGZpZWxkIGpv\naW5zIHRvIHRoZSBnaXZlbiB0YXJnZXQgZmllbGQuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGJvb2xlYW4gaXNKb2luZWRGaWVsZChGaWVsZE1hcHBp\nbmcgc3JjLCBib29sZWFuIGtleSwgCiAgICAgICAgRmllbGRNYXBwaW5nIHRh\ncmdldCkgewogICAgICAgIFZhbHVlTWFwcGluZyB2bTsKICAgICAgICBzd2l0\nY2ggKHNyYy5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICAgICAgdm0gPSBzcmMuZ2V0RWxlbWVudE1h\ncHBpbmcoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICB2bSA9IChrZXkp\nID8gc3JjLmdldEtleU1hcHBpbmcoKSA6IHNyYy5nZXRFbGVtZW50TWFwcGlu\nZygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICB2bSA9IHNyYzsKICAgICAgICB9CiAgICAg\nICAgaWYgKHZtLmdldEpvaW5EaXJlY3Rpb24oKSAhPSBWYWx1ZU1hcHBpbmcu\nSk9JTl9GT1JXQVJEKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgRm9yZWlnbktleSBmayA9IHZtLmdldEZvcmVpZ25LZXkoKTsKICAgICAg\nICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAK\nICAgICAgICAKICAgICAgICAvLyBmb3JlaWduIGtleSBtdXN0IGpvaW4gdG8g\ndGFyZ2V0IGNvbHVtbnMKICAgICAgICBDb2x1bW5bXSByZWxzID0gZmsuZ2V0\nQ29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHBrcyA9IHRhcmdldC5nZXRD\nb2x1bW5zKCk7IAogICAgICAgIGlmIChyZWxzLmxlbmd0aCAhPSBwa3MubGVu\nZ3RoKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCByZWxzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoZmsuZ2V0UHJpbWFyeUtleUNvbHVtbihyZWxzW2ldKSAhPSBwa3NbaV0p\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBPYmplY3QgZXZhbChP\nYmplY3QgY2FuZGlkYXRlLCBPYmplY3Qgb3JpZywKICAgICAgICBTdG9yZUNv\nbnRleHQgY3R4LCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICBpZiAoX2Fj\ndGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNhbmRpZGF0ZTsK\nCiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtOwogICAgICAgIEJyb2tlciB0bXBCcm9rZXI7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBfYWN0aW9ucy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBhY3Rpb24gPSAoQWN0aW9uKWl0\nci5uZXh0KCk7CiAgICAgICAgICAgIHNtID0gbnVsbDsKICAgICAgICAgICAg\ndG1wQnJva2VyID0gbnVsbDsKICAgICAgICAgICAgaWYgKEltcGxIZWxwZXIu\naXNNYW5hZ2VhYmxlKGNhbmRpZGF0ZSkpCiAgICAgICAgICAgICAgICBzbSA9\nIChPcGVuSlBBU3RhdGVNYW5hZ2VyKSAoSW1wbEhlbHBlci50b1BlcnNpc3Rl\nbmNlQ2FwYWJsZSgKICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUsIGN0\neC5nZXRDb25maWd1cmF0aW9uKCkpKS4KICAgICAgICAgICAgICAgICAgICBw\nY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAgICAgICBpZiAoc20gPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgdG1wQnJva2VyID0gY3R4LmdldEJyb2tl\ncigpOwogICAgICAgICAgICAgICAgdG1wQnJva2VyLnRyYW5zYWN0aW9uYWwo\nY2FuZGlkYXRlLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICAgICAgICBzbSA9\nIHRtcEJyb2tlci5nZXRTdGF0ZU1hbmFnZXIoY2FuZGlkYXRlKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoYWN0aW9uLm9wICE9IEFjdGlvbi5H\nRVQgJiYgYWN0aW9uLm9wICE9IEFjdGlvbi5HRVRfT1VURVIpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGNhbmRpZGF0ZSA9IHNtLmZldGNoRmllbGQoCiAgICAgICAgICAg\nICAgICAgICAgICAgICgoRmllbGRNYXBwaW5nKWFjdGlvbi5kYXRhKS5nZXRJ\nbmRleCgpLCB0cnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoQ2xhc3NDYXN0\nRXhjZXB0aW9uIGNjZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1\nbnRpbWVFeGNlcHRpb24oYWN0aW9uLmRhdGEgKyAiIG5vdCBhIGZpZWxkIHBh\ndGgiKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIC8vIHRyYW5zYWN0aW9uYWwgZG9lcyBub3QgY2xlYXIgdGhlIHN0YXRlLCB3\naGljaCBpcwogICAgICAgICAgICAgICAgLy8gaW1wb3J0YW50IHNpbmNlIHRt\ncENhbmRpZGF0ZSBtaWdodCBiZSBhbHNvIG1hbmFnZWQgYnkKICAgICAgICAg\nICAgICAgIC8vIGFub3RoZXIgYnJva2VyIGlmIGl0J3MgYSBwcm94aWVkIG5v\nbi1wYyBpbnN0YW5jZQogICAgICAgICAgICAgICAgaWYgKHRtcEJyb2tlciAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRtcEJyb2tlci5ub250cmFu\nc2FjdGlvbmFsKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FuZGlkYXRl\nOwogICAgfQoKICAgIC8qKgogICAgICogRXhwcmVzc2lvbiBzdGF0ZS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBQYXRoRXhwU3RhdGUKICAg\nICAgICBleHRlbmRzIEV4cFN0YXRlIHsKCiAgICAgICAgcHVibGljIEZpZWxk\nTWFwcGluZyBmaWVsZCA9IG51bGw7CiAgICAgICAgcHVibGljIEZpZWxkTWFw\ncGluZyBjbXBmaWVsZCA9IG51bGw7CiAgICAgICAgcHVibGljIENvbHVtbltd\nIGNvbHMgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGpvaW5lZFJl\nbCA9IGZhbHNlOwogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRFbGVt\nZW50Q29sbCA9IGZhbHNlOwogICAgICAgIAogICAgICAgIHB1YmxpYyBQYXRo\nRXhwU3RhdGUoSm9pbnMgam9pbnMpIHsKICAgICAgICAgICAgc3VwZXIoam9p\nbnMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyYXZlcnNl\nIGludG8gdGhlIHByZXZpb3VzIGZpZWxkIG9mIGEgcmVsYXRpb24gcGF0aC4K\nICAgICAqCiAgICAgKiBAcGFyYW0gbGFzdCB3aGV0aGVyIHRoaXMgaXMgdGhl\nIGxhc3QgZmllbGQgaW4gdGhlIHBhdGgKICAgICAqIEByZXR1cm4gdGhlIG1h\ncHBpbmcgb2YgdGhlIHJlbGF0ZWQgdHlwZSwgb3IgbnVsbAogICAgICovCiAg\nICBwcml2YXRlIENsYXNzTWFwcGluZyB0cmF2ZXJzZUZpZWxkKFBhdGhFeHBT\ndGF0ZSBwc3RhdGUsIGJvb2xlYW4ga2V5LCAKICAgICAgICBib29sZWFuIGZv\ncmNlT3V0ZXIsIGJvb2xlYW4gbGFzdCkgewogICAgICAgIGlmIChwc3RhdGUu\nZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIC8vIHRyYXZlcnNlIGludG8gZmllbGQgdmFsdWUKICAgICAgICBpZiAo\na2V5KQogICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQu\nam9pbktleShwc3RhdGUuam9pbnMsIGZvcmNlT3V0ZXIpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmZpZWxkLmpv\naW4ocHN0YXRlLmpvaW5zLCBmb3JjZU91dGVyKTsKCiAgICAgICAgLy8gaWYg\ndGhpcyBpc24ndCB0aGUgbGFzdCBmaWVsZCwgdHJhdmVyc2UgaW50byB0aGUg\ncmVsYXRpb24KICAgICAgICBpZiAoIWxhc3QpCiAgICAgICAgICAgIGpvaW5S\nZWxhdGlvbihwc3RhdGUsIGtleSwgZm9yY2VPdXRlciwgdHJ1ZSk7CgogICAg\nICAgIC8vIHJldHVybiB0aGUgbWFwaW5nIG9mIHRoZSByZWxhdGVkIHR5cGUs\nIGlmIGFueQogICAgICAgIGlmIChrZXkpCiAgICAgICAgICAgIHJldHVybiBw\nc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCk7\nCiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50KCkuZ2V0VHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgIHJldHVybiBw\nc3RhdGUuZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRUeXBlTWFwcGlu\nZygpOwogICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlwZU1hcHBp\nbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEpvaW4gaW50byB0aGUgcmVs\nYXRpb24gcmVwcmVzZW50ZWQgYnkgdGhlIGN1cnJlbnQgZmllbGQsIGlmIGFu\neS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGpvaW5SZWxhdGlvbihQYXRo\nRXhwU3RhdGUgcHN0YXRlLCBib29sZWFuIGtleSwgCiAgICAgICAgYm9vbGVh\nbiBmb3JjZU91dGVyLCBib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAgaWYg\nKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgaWYgKGtleSkKICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0\nYXRlLmZpZWxkLmpvaW5LZXlSZWxhdGlvbihwc3RhdGUuam9pbnMsIAogICAg\nICAgICAgICAgICAgZm9yY2VPdXRlciwgdHJhdmVyc2UpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmZpZWxkLmpv\naW5SZWxhdGlvbihwc3RhdGUuam9pbnMsIGZvcmNlT3V0ZXIsCiAgICAgICAg\nICAgICAgICB0cmF2ZXJzZSk7CiAgICAgICAgcHN0YXRlLmpvaW5lZFJlbCA9\nIHRydWU7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB0b0RhdGFTdG9yZVZh\nbHVlKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0\nZSwgCiAgICAgICAgT2JqZWN0IHZhbCkgewogICAgICAgIFBhdGhFeHBTdGF0\nZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBGaWVs\nZE1hcHBpbmcgZmllbGQgPSAocHN0YXRlLmNtcGZpZWxkICE9IG51bGwpID8g\ncHN0YXRlLmNtcGZpZWxkIAogICAgICAgICAgICA6IHBzdGF0ZS5maWVsZDsK\nICAgICAgICBpZiAoaXNYUGF0aCgpKQogICAgICAgICAgICByZXR1cm4gdmFs\nOwogICAgICAgIGlmIChmaWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlm\nIChfa2V5KQogICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkLnRvS2V5RGF0\nYVN0b3JlVmFsdWUodmFsLCBjdHguc3RvcmUpOwogICAgICAgICAgICBpZiAo\nZmllbGQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBK\nYXZhVHlwZXMuT0JKRUNUKQogICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxk\nLnRvRGF0YVN0b3JlVmFsdWUodmFsLCBjdHguc3RvcmUpOwoKICAgICAgICAg\nICAgdmFsID0gZmllbGQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIGN0eC5zdG9y\nZS5nZXRDb250ZXh0KCkpOwogICAgICAgICAgICByZXR1cm4gZmllbGQudG9E\nYXRhU3RvcmVWYWx1ZSh2YWwsIGN0eC5zdG9yZSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfY2xhc3MudG9EYXRhU3RvcmVWYWx1ZSh2YWwsIF9jbGFz\ncy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpLAogICAgICAgICAgICBjdHguc3Rv\ncmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2Vs\nLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIGJv\nb2xlYW4gcGtzKSB7CiAgICAgICAgc2VsZWN0Q29sdW1ucyhzZWwsIGN0eCwg\nc3RhdGUsIHBrcyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0Q29s\ndW1ucyhTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3Rh\ndGUsIAogICAgICAgIGJvb2xlYW4gcGtzKSB7CiAgICAgICAgc2VsLnNldFNj\naGVtYUFsaWFzKF9zY2hlbWFBbGlhcyk7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcgPSBnZXRDbGFzc01hcHBpbmcoc3RhdGUpOwogICAgICAgIFBh\ndGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAg\nICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8ICFwc3RhdGUuam9pbmVkUmVs\nIHx8CiAgICAgICAgICAgIHBzdGF0ZS5pc0VtYmVkRWxlbWVudENvbGwpICAg\nICAgICAgICAgCiAgICAgICAgICAgIHNlbC5zZWxlY3QoZ2V0Q29sdW1ucyhz\ndGF0ZSksIHBzdGF0ZS5qb2lucyk7CiAgICAgICAgZWxzZSBpZiAoX2tleSAm\nJiBwc3RhdGUuZmllbGQuZ2V0S2V5KCkuaXNFbWJlZGRlZCgpKQogICAgICAg\nICAgICBzZWxlY3RFbWJlZGRlZE1hcEtleShzZWwsIGN0eCwgc3RhdGUpOwog\nICAgICAgIGVsc2UgaWYgKHBrcykKICAgICAgICAgICAgc2VsLnNlbGVjdCht\nYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCksIHBzdGF0ZS5qb2lucyk7\nCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHNlbGVjdCB0aGUgbWFw\ncGluZzsgYWxsb3cgYW55IHN1YnMgYmVjYXVzZSB3ZSBrbm93IHRoaXMgbXVz\ndAogICAgICAgICAgICAvLyBiZSBlaXRoZXIgYSByZWxhdGlvbiwgaW4gd2hp\nY2ggY2FzZSBpdCB3aWxsIGFscmVhZHkgYmUKICAgICAgICAgICAgLy8gY29u\nc3RyYWluZWQgYnkgdGhlIGpvaW5zLCBvciAndGhpcycsIGluIHdoaWNoIGNh\nc2UgdGhlCiAgICAgICAgICAgIC8vIEpEQkNFeHByZXNzaW9uRmFjdG9yeSB0\nYWtlcyBjYXJlIG9mIGFkZGluZyBjbGFzcyBjb25kaXRpb25zIGZvcgogICAg\nICAgICAgICAvLyB0aGUgY2FuZGlkYXRlIGNsYXNzIG9uIHRoZSBzZWxlY3QK\nICAgICAgICAgICAgaW50IHN1YnMgPSAoX3R5cGUgPT0gVU5CT1VORF9WQVIp\nID8gU2VsZWN0LlNVQlNfSk9JTkFCTEUKICAgICAgICAgICAgICAgIDogU2Vs\nZWN0LlNVQlNfQU5ZX0pPSU5BQkxFOwogICAgICAgICAgICBzZWwuc2VsZWN0\nKG1hcHBpbmcsIHN1YnMsIGN0eC5zdG9yZSwgY3R4LmZldGNoLAogICAgICAg\nICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05FLCBz\nZWwub3V0ZXIocHN0YXRlLmpvaW5zKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdyb3VwQnkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBj\ndHgsIEV4cFN0YXRlIHN0YXRlKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcgPSBnZXRDbGFzc01hcHBpbmcoc3RhdGUpOwogICAgICAgIFBhdGhF\neHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAg\nICBpZiAobWFwcGluZyA9PSBudWxsIHx8ICFwc3RhdGUuam9pbmVkUmVsKQog\nICAgICAgICAgICBzZWwuZ3JvdXBCeShnZXRDb2x1bW5zKHN0YXRlKSwgc2Vs\nLm91dGVyKHBzdGF0ZS5qb2lucykpOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICBpbnQgc3VicyA9IChfdHlwZSA9PSBVTkJPVU5EX1ZBUikgPyBTZWxl\nY3QuU1VCU19KT0lOQUJMRQogICAgICAgICAgICAgICAgOiBTZWxlY3QuU1VC\nU19BTllfSk9JTkFCTEU7CiAgICAgICAgICAgIHNlbC5ncm91cEJ5KG1hcHBp\nbmcsIHN1YnMsIGN0eC5zdG9yZSwgY3R4LmZldGNoLCAKICAgICAgICAgICAg\nICAgIHNlbC5vdXRlcihwc3RhdGUuam9pbnMpKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgb3JkZXJCeShTZWxlY3Qgc2VsLCBFeHBDb250\nZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gYXNj\nKSB7CiAgICAgICAgc2VsLm9yZGVyQnkoZ2V0Q29sdW1ucyhzdGF0ZSksIGFz\nYywgc2VsLm91dGVyKHN0YXRlLmpvaW5zKSwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgbG9hZChFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUg\nc3RhdGUsIFJlc3VsdCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIGxvYWQoY3R4LCBzdGF0ZSwgcmVzLCBmYWxz\nZSk7CiAgICB9CgogICAgT2JqZWN0IGxvYWQoRXhwQ29udGV4dCBjdHgsIEV4\ncFN0YXRlIHN0YXRlLCBSZXN1bHQgcmVzLCBib29sZWFuIHBrcykKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZyA9IGdldENsYXNzTWFwcGluZyhzdGF0ZSk7CiAgICAgICAgUGF0\naEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAg\nICAgIGlmIChtYXBwaW5nICE9IG51bGwgJiYgKHBzdGF0ZS5maWVsZCA9PSBu\ndWxsIAogICAgICAgICAgICB8fCAhcHN0YXRlLmZpZWxkLmlzRW1iZWRkZWQo\nKSkpIHsKICAgICAgICAgICAgaWYgKHBrcykKICAgICAgICAgICAgICAgIHJl\ndHVybiBtYXBwaW5nLmdldE9iamVjdElkKGN0eC5zdG9yZSwgcmVzLCBudWxs\nLCB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMpOwog\nICAgICAgICAgICBpZiAoX2tleSAmJiBwc3RhdGUuZmllbGQuZ2V0S2V5KCku\naXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRFbWJl\nZGRlZE1hcEtleShjdHgsIHN0YXRlLCByZXMpOwogICAgICAgICAgICBpZiAo\ncHN0YXRlLmlzRW1iZWRFbGVtZW50Q29sbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBwc3RhdGUuZmllbGQubG9hZFByb2plY3Rpb24oY3R4LnN0b3JlLCBj\ndHguZmV0Y2gsIHJlcywKICAgICAgICAgICAgICAgICAgICBwc3RhdGUuam9p\nbnMpOwogICAgICAgICAgICByZXR1cm4gcmVzLmxvYWQobWFwcGluZywgY3R4\nLnN0b3JlLCBjdHguZmV0Y2gsIHBzdGF0ZS5qb2lucyk7CiAgICAgICAgfQoK\nICAgICAgICBPYmplY3QgcmV0OwogICAgICAgIGlmIChfa2V5KQogICAgICAg\nICAgICAvLyBNYXAga2V5IGlzIGEgamF2YSBwcmltaXRpdmUgdHlwZQogICAg\nICAgICAgICAvLyAgICBleGFtcGxlOiBNYXA8SW50ZWdlciwgRW1wbG95ZWU+\nIGVtcHMKICAgICAgICAgICAgcmV0ID0gcmVzLmdldE9iamVjdChwc3RhdGUu\nY29sc1swXSwKICAgICAgICAgICAgICAgIG51bGwsIHBzdGF0ZS5qb2lucyk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXQgPSBwc3RhdGUuZmllbGQu\nbG9hZFByb2plY3Rpb24oY3R4LnN0b3JlLCBjdHguZmV0Y2gsIHJlcywgCiAg\nICAgICAgICAgICAgICBwc3RhdGUuam9pbnMpOwogICAgICAgIGlmIChfY2Fz\ndCAhPSBudWxsKQogICAgICAgICAgICByZXQgPSBGaWx0ZXJzLmNvbnZlcnQo\ncmV0LCBfY2FzdCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgdmFsaWRhdGVNYXBTdHJhdGVneShTdHJhdGVneSBzdHJh\ndGVneSkgewogICAgICAgIGlmIChzdHJhdGVneSA9PSBudWxsIHx8CiAgICAg\nICAgICAgICEoc3RyYXRlZ3kgaW5zdGFuY2VvZiBMUlNNYXBGaWVsZFN0cmF0\nZWd5KSkKICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24o\nIkludmFsaWQgbWFwIGZpZWxkIHN0cmF0ZWd5OiIrc3RyYXRlZ3kpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBzZWxlY3RFbWJlZGRlZE1hcEtleShTZWxl\nY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwKICAgICAgICBFeHBTdGF0ZSBzdGF0\nZSkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0\nYXRlKSBzdGF0ZTsKICAgICAgICB2YWxpZGF0ZU1hcFN0cmF0ZWd5KHBzdGF0\nZS5maWVsZC5nZXRTdHJhdGVneSgpKTsKICAgICAgICBMUlNNYXBGaWVsZFN0\ncmF0ZWd5IHN0cmF0ZWd5ID0gKExSU01hcEZpZWxkU3RyYXRlZ3kpCiAgICAg\nICAgICAgIHBzdGF0ZS5maWVsZC5nZXRTdHJhdGVneSgpOwogICAgICAgIENs\nYXNzTWFwcGluZyBtYXBwaW5nID0gcHN0YXRlLmZpZWxkLmdldEtleU1hcHBp\nbmcoKS5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHN0cmF0ZWd5LnNlbGVj\ndEtleShzZWwsIG1hcHBpbmcsIG51bGwsIGN0eC5zdG9yZSwgY3R4LmZldGNo\nLAogICAgICAgICAgICBwc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHByaXZh\ndGUgT2JqZWN0IGxvYWRFbWJlZGRlZE1hcEtleShFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUsCiAgICAgICAgUmVzdWx0IHJlcykgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQ\nYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIHZhbGlkYXRlTWFwU3RyYXRl\nZ3kocHN0YXRlLmZpZWxkLmdldFN0cmF0ZWd5KCkpOwogICAgICAgIExSU01h\ncEZpZWxkU3RyYXRlZ3kgc3RyYXRlZ3kgPQogICAgICAgICAgICAoTFJTTWFw\nRmllbGRTdHJhdGVneSkgcHN0YXRlLmZpZWxkLmdldFN0cmF0ZWd5KCk7CiAg\nICAgICAgcmV0dXJuIHN0cmF0ZWd5LmxvYWRLZXkobnVsbCwgY3R4LnN0b3Jl\nLCBjdHguZmV0Y2gsIHJlcywKICAgICAgICAgICAgcHN0YXRlLmpvaW5zKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjYWxjdWxhdGVWYWx1ZShTZWxlY3Qg\nc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAg\nIFZhbCBvdGhlciwgRXhwU3RhdGUgb3RoZXJTdGF0ZSkgewogICAgICAgIC8v\nIHdlIGRvbid0IGNyZWF0ZSB0aGUgU1FMIGIvYyBpdCBmb3JjZXMgdGhlIFNl\nbGVjdCB0byBjYWNoZSBhbGlhc2VzCiAgICAgICAgLy8gZm9yIHRoZSB0YWJs\nZXMgd2UgdXNlLCBhbmQgdGhlc2UgYWxpYXNlcyBtaWdodCBub3QgZXZlciBi\nZSB1c2VkIGlmCiAgICAgICAgLy8gd2UgZXZlbnR1YWxseSBjYWxsIGFwcGVu\nZElzRW1wdHkgb3IgYXBwZW5kSXNOdWxsIHJhdGhlciB0aGFuIGFwcGVuZFRv\nCiAgICB9CgogICAgcHVibGljIHZvaWQgdmVyaWZ5SW5kZXhlZEZpZWxkKCkg\newogICAgICAgIEFjdGlvbiBsYXN0QWN0aW9uID0gKEFjdGlvbikgbGFzdEZp\nZWxkQWN0aW9uKCk7CiAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxk\nTWFwcGluZykgbGFzdEFjdGlvbi5kYXRhOwogICAgICAgIGlmIChmbS5nZXRP\ncmRlckNvbHVtbigpID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vcmRlci1jb2x1bW4iLCBmbS5n\nZXROYW1lKCkpKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGxlbmd0aChTZWxl\nY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUpIHsKICAg\nICAgICByZXR1cm4gZ2V0Q29sdW1ucyhzdGF0ZSkubGVuZ3RoOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGFwcGVuZFRvKFNlbGVjdCBzZWwsIEV4cENvbnRl\neHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgU1FMQnVmZmVyIHNx\nbCwgaW50IGluZGV4KSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IGdldENvbHVt\nbnMoc3RhdGUpW2luZGV4XTsKICAgICAgICBpZiAoc2VsICE9IG51bGwpCiAg\nICAgICAgICAgIHNlbC5zZXRTY2hlbWFBbGlhcyhfc2NoZW1hQWxpYXMpOwoK\nICAgICAgICAvLyBpZiBzZWxlY3QgaXMgbnVsbCwgaXQgbWVhbnMgd2UgYXJl\nIG5vdCBhbGlhc2luZyBjb2x1bW5zCiAgICAgICAgLy8gKGUuZy4sIGR1cmlu\nZyBhIGJ1bGsgdXBkYXRlKQogICAgICAgIGlmIChzZWwgPT0gbnVsbCkKICAg\nICAgICAgICAgc3FsLmFwcGVuZChjb2wuZ2V0TmFtZSgpKTsKICAgICAgICBl\nbHNlIGlmIChfdHlwZSA9PSBYUEFUSCkKICAgICAgICAgICAgLy8gaWYgdGhp\ncyBpcyBhbiB4cGF0aCwgYXBwZW5kIHhwYXRoIHN0cmluZwogICAgICAgICAg\nICBzcWwuYXBwZW5kKGdldFhQYXRoKCkpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sLCBzdGF0\nZS5qb2lucykpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzRW1w\ndHkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRl\nLCAKICAgICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4cFN0\nYXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlm\nIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFwcGVu\nZChGQUxTRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmll\nbGQuYXBwZW5kSXNFbXB0eShzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJc05vdEVtcHR5KFNlbGVjdCBz\nZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAg\nU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUg\nPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoRkFMU0UpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFwcGVuZElz\nTm90RW1wdHkoc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYXBwZW5kSW5kZXgoU2VsZWN0IHNlbCwgRXhwQ29udGV4\ndCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBTUUxCdWZmZXIgc3Fs\nKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3Rh\ndGUpIHN0YXRlOwogICAgICAgIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkK\nICAgICAgICAgICAgc3FsLmFwcGVuZCgiMSIpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgcHN0YXRlLmZpZWxkLmFwcGVuZEluZGV4KHNxbCwgc2VsLCBw\nc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZFR5\ncGUoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRl\nLCAKICAgICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgRGlzY3JpbWlu\nYXRvciBkaXNjID0gbnVsbDsKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0g\nX2NsYXNzOwogICAgICAgIHdoaWxlIChzdXAuZ2V0TWFwcGVkUENTdXBlcmNs\nYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIHN1cCA9IHN1cC5n\nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CgogICAgICAgIGRpc2Mg\nPSBzdXAuZ2V0RGlzY3JpbWluYXRvcigpOwoKICAgICAgICBDb2x1bW5bXSBj\nb2xzID0gbnVsbDsKICAgICAgICBpZiAoZGlzYyAhPSBudWxsKQogICAgICAg\nICAgICBjb2xzID0gZGlzYy5nZXRDb2x1bW5zKCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBjb2xzID0gZ2V0Q29sdW1ucyhzdGF0ZSk7CgogICAgICAg\nIGlmIChjb2xzID09IG51bGwpIHsKICAgICAgICAgICAgc3FsLmFwcGVuZCgi\nMSIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKGkgPiAwKQogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgi\nLCAiKTsKICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxp\nYXMoY29sc1tpXSwgc3RhdGUuam9pbnMpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYXBwZW5kU2l6ZShTZWxlY3Qgc2VsLCBFeHBDb250\nZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBz\ncWwpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBT\ndGF0ZSkgc3RhdGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxs\nKQogICAgICAgICAgICBzcWwuYXBwZW5kKCIxIik7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBwc3RhdGUuZmllbGQuYXBwZW5kU2l6ZShzcWwsIHNlbCwg\ncHN0YXRlLmpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJ\nc051bGwoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0\nYXRlLCAKICAgICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4\ncFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAg\nIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFw\ncGVuZChGQUxTRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUu\nZmllbGQuYXBwZW5kSXNOdWxsKHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90TnVsbChTZWxlY3Qg\nc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAg\nIFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRl\nID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAgaWYgKHBzdGF0ZS5m\naWVsZCA9PSBudWxsKQogICAgICAgICAgICBzcWwuYXBwZW5kKFRSVUUpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFwcGVuZElz\nTm90TnVsbChzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsKICAgIH0KICAgIAog\nICAgcHVibGljIGJvb2xlYW4gaXNTdWJxdWVyeVBhdGgoKSB7CiAgICAgICAg\naWYgKF9hY3Rpb25zICE9IG51bGwgJiYgX2FjdGlvbnMuc2l6ZSgpID09IDEg\nJiYgCiAgICAgICAgICAgKChBY3Rpb24pX2FjdGlvbnMuZ2V0KDApKS5vcCA9\nPSBBY3Rpb24uU1VCUVVFUlkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGhh\nc2hDb2RlKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX2NhbmRpZGF0ZS5oYXNoQ29kZSgpOwogICAgICAg\nIHJldHVybiBfY2FuZGlkYXRlLmhhc2hDb2RlKCkgXiBfYWN0aW9ucy5oYXNo\nQ29kZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmpl\nY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFu\nY2VvZiBQQ1BhdGgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgUENQYXRoIHBhdGggPSAoUENQYXRoKSBvdGhlcjsKICAgICAgICByZXR1\ncm4gT2JqZWN0VXRpbHMuZXF1YWxzKF9jYW5kaWRhdGUsIHBhdGguX2NhbmRp\nZGF0ZSkKICAgICAgICAgICAgJiYgT2JqZWN0VXRpbHMuZXF1YWxzKF9hY3Rp\nb25zLCBwYXRoLl9hY3Rpb25zKTsKICAgIH0KICAgIAogICAgcHVibGljIGlu\ndCBnZXRJZCgpIHsKICAgICAgICByZXR1cm4gVmFsLlZBTDsKICAgIH0KCgog\nICAgLyoqCiAgICAgKiBIZWxwZXIgY2xhc3MgcmVwcmVzZW50aW5nIGFuIGFj\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQWN0aW9u\nCiAgICAgICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBHRVQgPSAwOwogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEdFVF9PVVRFUiA9IDE7CiAgICAgICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgR0VUX0tFWSA9IDI7CiAgICAgICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgVkFSID0gMzsKICAgICAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBTVUJRVUVSWSA9IDQ7CiAgICAgICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgVU5CT1VORF9WQVIgPSA1OwogICAgICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IENBU1QgPSA2OwogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEdFVF9YUEFUSCA9IDc7CgogICAgICAgIHB1\nYmxpYyBpbnQgb3AgPSAtMTsKICAgICAgICBwdWJsaWMgT2JqZWN0IGRhdGEg\nPSBudWxsOwogICAgICAgIHB1YmxpYyBTdHJpbmcgdmFyID0gbnVsbDsKICAg\nICAgICBwdWJsaWMgQ29udGV4dCBjb250ZXh0ID0gbnVsbDsKCiAgICAgICAg\ncHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJu\nIG9wICsgInwiICsgZGF0YTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIGlmIChkYXRhID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gb3A7CiAgICAgICAgICAgIHJldHVy\nbiBvcCBeIGRhdGEuaGFzaENvZGUoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICAg\nICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgQWN0aW9uIGEgPSAoQWN0aW9uKSBvdGhlcjsK\nICAgICAgICAgICAgcmV0dXJuIG9wID09IGEub3AKICAgICAgICAgICAgICAg\nICYmIE9iamVjdFV0aWxzLmVxdWFscyhkYXRhLCBhLmRhdGEpOwogICAgICAg\nIH0KICAgIH0KfQo=\n","encoding":"base64"}

