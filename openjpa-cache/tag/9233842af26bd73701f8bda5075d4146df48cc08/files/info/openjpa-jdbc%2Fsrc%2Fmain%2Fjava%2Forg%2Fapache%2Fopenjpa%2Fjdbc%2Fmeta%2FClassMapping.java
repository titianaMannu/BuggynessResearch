{"sha":"484f17da05c34a93454e8ae5290f63823f0ad808","node_id":"MDQ6QmxvYjIwNjM2NDo0ODRmMTdkYTA1YzM0YTkzNDU0ZThhZTUyOTBmNjM4MjNmMGFkODA4","size":37723,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/484f17da05c34a93454e8ae5290f63823f0ad808","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7Cmlt\ncG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nSGFzaE1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5Q\nZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUNs\nYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuU2NoZW1hczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJ\nZDsKCi8qKgogKiBTcGVjaWFsaXphdGlvbiBvZiBtZXRhZGF0YSBmb3IgcmVs\nYXRpb25hbCBkYXRhYmFzZXMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpwdWJsaWMgY2xhc3MgQ2xhc3NNYXBwaW5nCiAgICBleHRlbmRzIENsYXNz\nTWV0YURhdGEKICAgIGltcGxlbWVudHMgQ2xhc3NTdHJhdGVneSB7CgogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBDbGFzc01hcHBpbmdbXSBFTVBUWV9NQVBQ\nSU5HUyA9IG5ldyBDbGFzc01hcHBpbmdbMF07CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChDbGFzc01hcHBpbmcuY2xhc3MpOwoKICAgIHByaXZhdGUg\nZmluYWwgQ2xhc3NNYXBwaW5nSW5mbyBfaW5mbzsKICAgIHByaXZhdGUgZmlu\nYWwgRGlzY3JpbWluYXRvciBfZGlzY3JpbTsKICAgIHByaXZhdGUgZmluYWwg\nVmVyc2lvbiBfdmVyc2lvbjsKICAgIHByaXZhdGUgQ2xhc3NTdHJhdGVneSBf\nc3RyYXRlZ3kgPSBudWxsOwoKICAgIHByaXZhdGUgVGFibGUgX3RhYmxlID0g\nbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uSU8gX2lvID0gbnVsbDsKICAgIHBy\naXZhdGUgQ29sdW1uW10gX2NvbHMgPSBTY2hlbWFzLkVNUFRZX0NPTFVNTlM7\nCiAgICBwcml2YXRlIEZvcmVpZ25LZXkgX2ZrID0gbnVsbDsKICAgIHByaXZh\ndGUgaW50IF9zdWJjbGFzc01vZGUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKCiAg\nICBwcml2YXRlIENsYXNzTWFwcGluZ1tdIF9qb2luU3ViTWFwcyA9IG51bGw7\nCiAgICBwcml2YXRlIENsYXNzTWFwcGluZ1tdIF9hc3NpZ25NYXBzID0gbnVs\nbDsKCiAgICAvLyBtYXBzIGNvbHVtbnMgdG8gam9pbmFibGVzCiAgICBwcml2\nYXRlIGZpbmFsIE1hcCBfam9pbmFibGVzID0gbmV3IENvbmN1cnJlbnRIYXNo\nTWFwKCk7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGRl\nc2NyaWJlZCB0eXBlIGFuZCBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENsYXNzTWFwcGluZyhDbGFzcyB0eXBlLCBNYXBwaW5n\nUmVwb3NpdG9yeSByZXBvcykgewogICAgICAgIHN1cGVyKHR5cGUsIHJlcG9z\nKTsKICAgICAgICBfZGlzY3JpbSA9IHJlcG9zLm5ld0Rpc2NyaW1pbmF0b3Io\ndGhpcyk7CiAgICAgICAgX3ZlcnNpb24gPSByZXBvcy5uZXdWZXJzaW9uKHRo\naXMpOwogICAgICAgIF9pbmZvID0gcmVwb3MubmV3TWFwcGluZ0luZm8odGhp\ncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbWJlZGRlZCBjb25zdHJ1Y3Rv\nci4gU3VwcGx5IGVtYmVkZGluZyB2YWx1ZSBhbmQgb3duaW5nIHJlcG9zaXRv\ncnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01hcHBpbmcoVmFsdWVN\nZXRhRGF0YSB2bWQpIHsKICAgICAgICBzdXBlcih2bWQpOwogICAgICAgIF9k\naXNjcmltID0gZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5uZXdEaXNjcmltaW5h\ndG9yKHRoaXMpOwogICAgICAgIF92ZXJzaW9uID0gZ2V0TWFwcGluZ1JlcG9z\naXRvcnkoKS5uZXdWZXJzaW9uKHRoaXMpOwogICAgICAgIF9pbmZvID0gZ2V0\nTWFwcGluZ1JlcG9zaXRvcnkoKS5uZXdNYXBwaW5nSW5mbyh0aGlzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBjbGFzcyBkaXNjcmltaW5hdG9yLgog\nICAgICovCiAgICBwdWJsaWMgRGlzY3JpbWluYXRvciBnZXREaXNjcmltaW5h\ndG9yKCkgewogICAgICAgIHJldHVybiBfZGlzY3JpbTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSB2ZXJzaW9uIGluZGljYXRvci4KICAgICAqLwogICAg\ncHVibGljIFZlcnNpb24gZ2V0VmVyc2lvbigpIHsKICAgICAgICByZXR1cm4g\nX3ZlcnNpb247CiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIFJ1bnRp\nbWUKICAgIC8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG9pZCB2YWx1ZSBzdG9yZWQgaW4gdGhlIHJlc3VsdC4gVGhpcyBpbXBsZW1l\nbnRhdGlvbiB3aWxsCiAgICAgKiByZWN1cnNlIHVudGlsIGl0IGZpbmRzIGFu\nIGFuY2VzdG9yIGNsYXNzIHdobyB1c2VzIG9pZCB2YWx1ZXMgZm9yIGl0cwog\nICAgICogcHJpbWFyeSBrZXkuCiAgICAgKgogICAgICogQHBhcmFtIGZrIGlm\nIG5vbi1udWxsLCB1c2UgdGhlIGxvY2FsIGNvbHVtbnMgb2YgdGhlIGdpdmVu\nIGZvcmVpZ24KICAgICAqIGtleSBpbiBwbGFjZSBvZiB0aGlzIGNsYXNzJyBw\ncmltYXJ5IGtleSBjb2x1bW5zCiAgICAgKiBAc2VlICNpc1ByaW1hcnlLZXlP\nYmplY3RJZAogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldE9iamVjdElk\nKEpEQkNTdG9yZSBzdG9yZSwgUmVzdWx0IHJlcywgRm9yZWlnbktleSBmaywK\nICAgICAgICBib29sZWFuIHN1YnMsIEpvaW5zIGpvaW5zKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFZhbHVlTWFwcGluZyBlbWJl\nZCA9IGdldEVtYmVkZGluZ01hcHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGVtYmVkLmdldEZpZWxkTWFw\ncGluZygpLmdldERlZmluaW5nTWFwcGluZygpLgogICAgICAgICAgICAgICAg\nZ2V0T2JqZWN0SWQoc3RvcmUsIHJlcywgZmssIHN1YnMsIGpvaW5zKTsKCiAg\nICAgICAgcmV0dXJuIGdldE9iamVjdElkKHRoaXMsIHN0b3JlLCByZXMsIGZr\nLCBzdWJzLCBqb2lucyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNp\ndmUgaGVscGVyIGZvciBwdWJsaWMgPGNvZGU+Z2V0T2JqZWN0SWQ8L2NvZGU+\nIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZ2V0T2JqZWN0\nSWQoQ2xhc3NNYXBwaW5nIGNscywgSkRCQ1N0b3JlIHN0b3JlLCBSZXN1bHQg\ncmVzLAogICAgICAgIEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gc3VicywgSm9p\nbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKCFpc1ByaW1hcnlLZXlPYmplY3RJZCh0cnVlKSkKICAgICAgICAg\nICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01hcHBpbmcoKS5nZXRPYmplY3RJ\nZChjbHMsIHN0b3JlLCByZXMsIGZrLAogICAgICAgICAgICAgICAgc3Vicywg\nam9pbnMpOwogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9V\nTktOT1dOKQogICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKCiAgICAgICAgQ29sdW1uW10gcGtzID0gZ2V0UHJpbWFyeUtleUNv\nbHVtbnMoKTsKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBlKCkgPT0gSURf\nREFUQVNUT1JFKSB7CiAgICAgICAgICAgIENvbHVtbiBjb2wgPSAoZmsgPT0g\nbnVsbCkgPyBwa3NbMF0gOiBmay5nZXRDb2x1bW4ocGtzWzBdKTsKICAgICAg\nICAgICAgbG9uZyBpZCA9IHJlcy5nZXRMb25nKGNvbCwgam9pbnMpOwogICAg\nICAgICAgICByZXR1cm4gKGlkID09IDAgJiYgcmVzLndhc051bGwoKSkgPyBu\ndWxsCiAgICAgICAgICAgICAgICA6IHN0b3JlLm5ld0RhdGFTdG9yZUlkKGlk\nLCBjbHMsIHN1YnMpOwogICAgICAgIH0KCiAgICAgICAgLy8gYXBwbGljYXRp\nb24gaWRlbnRpdHkKICAgICAgICBPYmplY3RbXSB2YWxzID0gbmV3IE9iamVj\ndFtnZXRQcmltYXJ5S2V5RmllbGRzKCkubGVuZ3RoXTsKICAgICAgICBGaWVs\nZE1hcHBpbmcgZm07CiAgICAgICAgSm9pbmFibGUgam9pbjsKICAgICAgICBp\nbnQgcGtJZHg7CiAgICAgICAgYm9vbGVhbiBjYW5SZWFkRGlzY3JpbWluYXRv\nciA9IHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gd2Uga25vdyB0aGF0IGFsbCBw\nayBjb2x1bW4gam9pbiBtYXBwaW5ncyB1c2UgcHJpbWFyeSBrZXkgZmllbGRz\nLAogICAgICAgICAgICAvLyBjYXVzZSB0aGlzIG1hcHBpbmcgdXNlcyB0aGUg\nb2lkIGFzIGl0cyBwcmltYXJ5IGtleSAod2UgcmVjdXJzZWQKICAgICAgICAg\nICAgLy8gYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgbWV0aG9kIHRvIGVuc3Vy\nZSB0aGlzKQogICAgICAgICAgICBqb2luID0gYXNzZXJ0Sm9pbmFibGUocGtz\nW2ldKTsKICAgICAgICAgICAgZm0gPSBnZXRGaWVsZE1hcHBpbmcoam9pbi5n\nZXRGaWVsZEluZGV4KCkpOwogICAgICAgICAgICBwa0lkeCA9IGZtLmdldFBy\naW1hcnlLZXlJbmRleCgpOwogICAgICAgICAgICBjYW5SZWFkRGlzY3JpbWlu\nYXRvciAmPSBpc1NlbGZSZWZlcmVuY2UoZmssIGpvaW4uZ2V0Q29sdW1ucygp\nKTsgCiAgICAgICAgICAgIC8vIGNvdWxkIGhhdmUgYWxyZWFkeSBzZXQgdmFs\ndWUgd2l0aCBwcmV2aW91cyBtdWx0aS1jb2x1bW4gam9pbmFibGUKICAgICAg\nICAgICAgaWYgKHZhbHNbcGtJZHhdID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KGZtKTsKICAgICAgICAgICAgICAg\nIHZhbHNbcGtJZHhdID0gam9pbi5nZXRQcmltYXJ5S2V5VmFsdWUocmVzLCBq\nb2luLmdldENvbHVtbnMoKSwKICAgICAgICAgICAgICAgICAgICBmaywgc3Rv\ncmUsIGpvaW5zKTsKICAgICAgICAgICAgICAgIHJlcy5lbmREYXRhUmVxdWVz\ndCgpOwogICAgICAgICAgICAgICAgaWYgKHZhbHNbcGtJZHhdID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIHRoZSBvaWQgZGF0YSBpcyBsb2Fk\nZWQgYnkgdGhlIGJhc2UgdHlwZSwgYnV0IGlmIGRpc2NyaW1pbmF0b3IgZGF0\nYQogICAgICAgIC8vIGlzIHByZXNlbnQsIG1ha2Ugc3VyZSB0byB1c2UgaXQg\ndG8gY29uc3RydWN0IHRoZSBhY3R1YWwgb2lkIGluc3RhbmNlCiAgICAgICAg\nLy8gc28gdGhhdCB3ZSBnZXQgdGhlIGNvcnJlY3QgYXBwIGlkIGNsYXNzLCBl\ndGMKICAgICAgICAKICAgICAgICAvLyBEaXNjcmltaW5hdG9yIHJlZmVycyB0\nbyB0aGUgcm93IGJ1dCB0aGUgdmFsc1tdIG1heSBob2xkIGRhdGEgdGhhdAog\nICAgICAgIC8vIHJlZmVyIHRvIGFub3RoZXIgcm93LiBUaGVuIHRoZXJlIGlz\nIGxpdHRsZSBwb2ludCByZWFkaW5nIHRoZSBkaXNjCiAgICAgICAgLy8gdmFs\ndWUKCiAgICAgICAgQ2xhc3NNYXBwaW5nIGRjbHMgPSBjbHM7CiAgICAgICAg\naWYgKHN1YnMgJiYgY2FuUmVhZERpc2NyaW1pbmF0b3IpIHsKICAgICAgICAg\nICAgcmVzLnN0YXJ0RGF0YVJlcXVlc3QoY2xzLmdldERpc2NyaW1pbmF0b3Io\nKSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBDbGFzcyBk\ndHlwZSA9IGNscy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0Q2xhc3Moc3RvcmUs\nIGNscywgcmVzKTsKICAgICAgICAgICAgICAgIGlmIChkdHlwZSAhPSBjbHMu\nZ2V0RGVzY3JpYmVkVHlwZSgpKQogICAgICAgICAgICAgICAgICBkY2xzID0g\nY2xzLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZyhkdHlwZSwg\nCiAgICAgICAgICAgICAgICAgICAgc3RvcmUuZ2V0Q29udGV4dCgpLmdldENs\nYXNzTG9hZGVyKCksIHRydWUpOyAKICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIGludGVudGlvbmFsbHkg\naWdub3JlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcy5lbmREYXRh\nUmVxdWVzdCgpOyAgCiAgICAgICAgfQogICAgICAgIE9iamVjdCBvaWQgPSBB\ncHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXModmFscywgZGNscyk7CiAgICAg\nICAgaWYgKG9pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgewogICAgICAgICAg\nICAoKE9wZW5KUEFJZCkgb2lkKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKGRj\nbHMuZ2V0RGVzY3JpYmVkVHlwZSgpLCAKICAgICAgICAgICAgICAgIHN1YnMp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2lkOwogICAgfQogICAgCiAg\nICBib29sZWFuIGlzU2VsZlJlZmVyZW5jZShGb3JlaWduS2V5IGZrLCBDb2x1\nbW5bXSBjb2xzKSB7CiAgICAJaWYgKGZrID09IG51bGwpCiAgICAJCXJldHVy\nbiB0cnVlOwogICAgCWZvciAoQ29sdW1uIGNvbCA6IGNvbHMpCiAgICAJCWlm\nIChmay5nZXRDb2x1bW4oY29sKSAhPSBjb2wpCiAgICAJCQlyZXR1cm4gZmFs\nc2U7CiAgICAJcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGdpdmVuIGNvbHVtbiB2YWx1ZShzKSBmb3IgdGhlIGdpdmVu\nIG9iamVjdC4gVGhlIGdpdmVuCiAgICAgKiBjb2x1bW5zIHdpbGwgYmUgcHJp\nbWFyeSBrZXkgY29sdW1ucyBvZiB0aGlzIG1hcHBpbmcsIGJ1dCBtYXkgYmUg\naW4KICAgICAqIGFueSBvcmRlci4gSWYgdGhlcmUgaXMgb25seSBvbmUgY29s\ndW1uLCByZXR1cm4gaXRzIHZhbHVlLiBJZiB0aGVyZQogICAgICogYXJlIG11\nbHRpcGxlIGNvbHVtbnMsIHJldHVybiBhbiBvYmplY3QgYXJyYXkgb2YgdGhl\naXIgdmFsdWVzLCBpbiB0aGUKICAgICAqIHNhbWUgb3JkZXIgdGhlIGNvbHVt\nbnMgYXJlIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0\nYVN0b3JlVmFsdWUoT2JqZWN0IG9iaiwgQ29sdW1uW10gY29scywgSkRCQ1N0\nb3JlIHN0b3JlKSB7CiAgICAgICAgT2JqZWN0IHJldCA9IChjb2xzLmxlbmd0\naCA9PSAxKSA/IG51bGwgOiBuZXcgT2JqZWN0W2NvbHMubGVuZ3RoXTsKCiAg\nICAgICAgLy8gaW4gdGhlIHBhc3Qgd2UndmUgYmVlbiBsZW5pZW50IGFib3V0\nIGJlaW5nIGFibGUgdG8gdHJhbnNsYXRlIG9iamVjdHMKICAgICAgICAvLyBm\ncm9tIG90aGVyIHBlcnNpc3RlbmNlIGNvbnRleHRzLCBzbyB0cnkgdG8gZ2V0\nIHNtIGRpcmVjdGx5IGZyb20KICAgICAgICAvLyBpbnN0YW5jZSBiZWZvcmUg\nYXNraW5nIG91ciBjb250ZXh0CiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2Jq\nKSkgewogICAgICAgIAlQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVs\ncGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwKICAgICAgICAgICAgICAg\nICAgICBnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpKTsKICAg\nICAgICAgICAgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgcGMucGNHZXRT\ndGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsK\nICAgICAgICAgICAgCXJldCA9IGdldFZhbHVlRnJvbVVubWFuYWdlZEluc3Rh\nbmNlKG9iaiwgY29scywgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\nc20uaXNEZXRhY2hlZCgpKSB7CiAgICAgICAgICAgIAlvYmogPSBzdG9yZS5n\nZXRDb250ZXh0KCkuZmluZChzbS5nZXRPYmplY3RJZCgpLCBmYWxzZSwgbnVs\nbCk7CiAgICAgICAgICAgIAlzbSA9IHN0b3JlLmdldENvbnRleHQoKS5nZXRT\ndGF0ZU1hbmFnZXIob2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIHNtID0gc3RvcmUuZ2V0Q29udGV4dCgpLmdldFN0\nYXRlTWFuYWdlcihvYmopOwogICAgICAgIH0KICAgICAgICBpZiAoc20gPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJldDsKCiAgICAgICAgT2JqZWN0\nIHZhbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgdmFsID0gYXNzZXJ0Sm9pbmFibGUoY29s\nc1tpXSkuZ2V0Sm9pblZhbHVlKHNtLCBjb2xzW2ldLCBzdG9yZSk7CiAgICAg\nICAgICAgIGlmIChjb2xzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAg\ncmV0ID0gdmFsOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAo\nKE9iamVjdFtdKSByZXQpW2ldID0gdmFsOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcmV0OwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgam9pbmFibGUgZm9yIHRoZSBnaXZlbiBjb2x1bW4sIG9yIHRocm93IGFu\nIGV4Y2VwdGlvbiBpZgogICAgICogbm9uZSBpcyBhdmFpbGFibGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBKb2luYWJsZSBhc3NlcnRKb2luYWJsZShDb2x1bW4g\nY29sKSB7CiAgICAgICAgSm9pbmFibGUgam9pbiA9IGdldEpvaW5hYmxlKGNv\nbCk7CiAgICAgICAgaWYgKGpvaW4gPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1qb2luYWJs\nZSIsCiAgICAgICAgICAgICAgICBjb2wuZ2V0RnVsbE5hbWUoKSkpOwogICAg\nICAgIHJldHVybiBqb2luOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSB7QGxpbmsgSm9pbmFibGV9IGZvciB0aGUgZ2l2ZW4gY29sdW1uLiBB\nbnkgY29sdW1uIHRoYXQKICAgICAqIGFub3RoZXIgbWFwcGluZyBqb2lucyB0\nbyBtdXN0IGJlIGNvbnRyb2xsZWQgYnkgYSBqb2luYWJsZS4KICAgICAqLwog\nICAgcHVibGljIEpvaW5hYmxlIGdldEpvaW5hYmxlKENvbHVtbiBjb2wpIHsK\nICAgICAgICBKb2luYWJsZSBqb2luOwogICAgICAgIGlmIChnZXRFbWJlZGRp\nbmdNZXRhRGF0YSgpICE9IG51bGwpIHsKICAgICAgICAgICAgam9pbiA9IGdl\ndEVtYmVkZGluZ01hcHBpbmcoKS5nZXRGaWVsZE1hcHBpbmcoKS4KICAgICAg\nICAgICAgICAgIGdldERlZmluaW5nTWFwcGluZygpLmdldEpvaW5hYmxlKGNv\nbCk7CiAgICAgICAgICAgIGlmIChqb2luICE9IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gam9pbjsKICAgICAgICB9CiAgICAgICAgQ2xhc3NNYXBw\naW5nIHN1cCA9IGdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwog\nICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAgICAgICBqb2luID0g\nc3VwLmdldEpvaW5hYmxlKGNvbCk7CiAgICAgICAgICAgIGlmIChqb2luICE9\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gam9pbjsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIChKb2luYWJsZSkgX2pvaW5hYmxlcy5nZXQoY29s\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29sdW1u\nLXRvLWpvaW5hYmxlIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEpvaW5hYmxlKENvbHVtbiBjb2wsIEpvaW5hYmxlIGpvaW5hYmxlKSB7\nCiAgICAgICAgLy8gZG9uJ3QgbGV0IG5vbi1wayBvdmVycmlkZSBwawogICAg\nICAgIEpvaW5hYmxlIGpvaW4gPSAoSm9pbmFibGUpIF9qb2luYWJsZXMuZ2V0\nKGNvbCk7CiAgICAgICAgaWYgKGpvaW4gPT0gbnVsbCB8fCAoam9pbi5nZXRG\naWVsZEluZGV4KCkgIT0gLTEKICAgICAgICAgICAgJiYgZ2V0RmllbGQoam9p\nbi5nZXRGaWVsZEluZGV4KCkpLmdldFByaW1hcnlLZXlJbmRleCgpID09IC0x\nKSkKICAgICAgICAgICAgX2pvaW5hYmxlcy5wdXQoY29sLCBqb2luYWJsZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgY29s\ndW1ucyBvZiB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgdG8gdGhpcyBtYXBwaW5n\nCiAgICAgKiBjYW4gYmUgdXNlZCB0byBjb25zdHJ1Y3QgYW4gb2JqZWN0IGlk\nIGZvciB0aGlzIHR5cGUuIFRoaXMgaXMgYQogICAgICogcmVsYXRpdmVseSBl\neHBlbnNpdmUgb3BlcmF0aW9uOyBpdHMgcmVzdWx0cyBzaG91bGQgYmUgY2Fj\naGVkLgogICAgICoKICAgICAqIEByZXR1cm4ge0BsaW5rIEJvb2xlYW4jVFJV\nRX0gaWYgdGhlIGZvcmVpZ24ga2V5IGNvbnRhaW5zIGFsbCBvaWQKICAgICAq\nIGNvbHVtbnMsIDxjb2RlPm51bGw8L2NvZGU+IGlmIGl0IGNvbnRhaW5zIG9u\nbHkgc29tZSBjb2x1bW5zLAogICAgICogb3Ige0BsaW5rIEJvb2xlYW4jRkFM\nU0V9IGlmIGl0IGNvbnRhaW5zIG5vbi1vaWQgY29sdW1ucwogICAgICovCiAg\nICBwdWJsaWMgQm9vbGVhbiBpc0ZvcmVpZ25LZXlPYmplY3RJZChGb3JlaWdu\nS2V5IGZrKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nJ3MgcHJpbWFy\neSBrZXkgY2FuJ3QgY29uc3RydWN0IGFuIG9pZCwgdGhlbiBubyB3YXkKICAg\nICAgICAvLyBmb3JlaWduIGtleSBjYW4KICAgICAgICBpZiAoZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gSURfVU5LTk9XTiB8fCAhaXNQcmltYXJ5S2V5T2JqZWN0\nSWQoZmFsc2UpKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsK\nCiAgICAgICAgLy8gd2l0aCBkYXRhc3RvcmUgaWRlbnRpdHksIGl0J3MgYWxs\nIG9yIG5vdGhpbmcKICAgICAgICBDb2x1bW5bXSBjb2xzID0gZmsuZ2V0UHJp\nbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAgIGlmIChjb2xzLmxl\nbmd0aCAhPSAxIHx8IGNvbHNbMF0gIT0gZ2V0UHJpbWFyeUtleUNvbHVtbnMo\nKVswXSkKICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0KCiAg\nICAgICAgLy8gY2hlY2sgdGhlIGpvaW4gbWFwcGluZyBmb3IgZWFjaCBwayBj\nb2x1bW4gdG8gc2VlIGlmIGl0IGxpbmtzIHVwIHRvCiAgICAgICAgLy8gYSBw\ncmltYXJ5IGtleSBmaWVsZAogICAgICAgIEpvaW5hYmxlIGpvaW47CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGpvaW4gPSBhc3NlcnRKb2luYWJsZShjb2xzW2ldKTsKICAg\nICAgICAgICAgaWYgKGpvaW4uZ2V0RmllbGRJbmRleCgpICE9IC0xCiAgICAg\nICAgICAgICAgICAmJiBnZXRGaWVsZChqb2luLmdldEZpZWxkSW5kZXgoKSku\nZ2V0UHJpbWFyeUtleUluZGV4KCkgPT0gLTEpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIGFsbCBwcmltYXJ5IGtleSBsaW5rcywgc2VlIHdoZXRoZXIgd2Ugam9pbiB0\nbyBhbGwgcGtzCiAgICAgICAgaWYgKGlzUHJpbWFyeUtleU9iamVjdElkKHRy\ndWUpCiAgICAgICAgICAgICYmIGNvbHMubGVuZ3RoID09IGdldFByaW1hcnlL\nZXlDb2x1bW5zKCkubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gQm9vbGVh\nbi5UUlVFOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8vLy8v\nLy8KICAgIC8vIE9STQogICAgLy8vLy8vLwoKICAgIC8qKgogICAgICogUmF3\nIG1hcHBpbmcgZGF0YS4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFwcGlu\nZ0luZm8gZ2V0TWFwcGluZ0luZm8oKSB7CiAgICAgICAgcmV0dXJuIF9pbmZv\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5IHVzZWQgdG8g\nbWFwIHRoaXMgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIENsYXNzU3Ry\nYXRlZ3kgZ2V0U3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9zdHJhdGVn\neTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJhdGVneSB1c2VkIHRv\nIG1hcCB0aGlzIG1hcHBpbmcuIFRoZSA8Y29kZT5hZGFwdDwvY29kZT4KICAg\nICAqIHBhcmFtZXRlciBkZXRlcm1pbmVzIHdoZXRoZXIgdG8gYWRhcHQgd2hl\nbiBtYXBwaW5nIHRoZSBzdHJhdGVneTsKICAgICAqIHVzZSBudWxsIGlmIHRo\nZSBzdHJhdGVneSBzaG91bGQgbm90IGJlIG1hcHBlZC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0U3RyYXRlZ3koQ2xhc3NTdHJhdGVneSBzdHJhdGVn\neSwgQm9vbGVhbiBhZGFwdCkgewogICAgICAgIC8vIHNldCBzdHJhdGVneSBm\naXJzdCBzbyB3ZSBjYW4gYWNjZXNzIGl0IGR1cmluZyBtYXBwaW5nCiAgICAg\nICAgQ2xhc3NTdHJhdGVneSBvcmlnID0gX3N0cmF0ZWd5OwogICAgICAgIF9z\ndHJhdGVneSA9IHN0cmF0ZWd5OwogICAgICAgIGlmIChzdHJhdGVneSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdHJh\ndGVneS5zZXRDbGFzc01hcHBpbmcodGhpcyk7CiAgICAgICAgICAgICAgICBp\nZiAoYWRhcHQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzdHJhdGVn\neS5tYXAoYWRhcHQuYm9vbGVhblZhbHVlKCkpOwogICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAv\nLyByZXNldCBzdHJhdGVneQogICAgICAgICAgICAgICAgX3N0cmF0ZWd5ID0g\nb3JpZzsKICAgICAgICAgICAgICAgIHRocm93IHJlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1hcHBpbmcn\ncyBwcmltYXJ5IHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgVGFibGUgZ2V0\nVGFibGUoKSB7CiAgICAgICAgcmV0dXJuIF90YWJsZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBtYXBwaW5nJ3MgcHJpbWFyeSB0YWJsZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0VGFibGUoVGFibGUgdGFibGUpIHsKICAg\nICAgICBfdGFibGUgPSB0YWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBjb2x1bW5zIHRoaXMgbWFwcGluZyB1c2VzIHRvIHVuaXF1ZWx5IGlkZW50\naWZ5IGFuIG9iamVjdC4KICAgICAqIFRoZXNlIHdpbGwgdHlwaWNhbGx5IGJl\nIHRoZSBwcmltYXJ5IGtleSBjb2x1bW5zIG9yIHRoZSBjb2x1bW5zIHRoaXMK\nICAgICAqIGNsYXNzIHVzZXMgdG8gbGluayB0byBpdHMgc3VwZXJjbGFzcyB0\nYWJsZS4KICAgICAqLwogICAgcHVibGljIENvbHVtbltdIGdldFByaW1hcnlL\nZXlDb2x1bW5zKCkgewogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9\nPSBJRF9BUFBMSUNBVElPTiAmJiBpc01hcHBlZCgpKSB7CiAgICAgICAgICAg\nIGlmIChfY29scy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgRmll\nbGRNYXBwaW5nW10gcGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkTWFwcGluZ3Mo\nKTsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gY29scyA9IG5ldyBBcnJh\neUxpc3QocGtzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBDb2x1bW5bXSBm\naWVsZENvbHM7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHBrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGZpZWxk\nQ29scyA9IHBrc1tpXS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGZpZWxkQ29scy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBfY29scyA9IG5ldyBDb2x1bW5bMF07CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBfY29sczsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBm\naWVsZENvbHMubGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbHMuYWRkKGZpZWxkQ29sc1tqXSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBfY29scyA9IChDb2x1bW5bXSkgY29scy50b0FycmF5\nKG5ldyBDb2x1bW5bY29scy5zaXplKCldKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2NvbHM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgY29sdW1ucyB0aGlzIG1hcHBpbmcgdXNlcyB0byB1bmlxdWVs\neSBpZGVudGlmeSBhbiBvYmplY3QuCiAgICAgKiBUaGVzZSB3aWxsIHR5cGlj\nYWxseSBiZSB0aGUgcHJpbWFyeSBrZXkgY29sdW1ucyBvciB0aGUgY29sdW1u\ncyB0aGlzCiAgICAgKiBjbGFzcyB1c2VzIHRvIGxpbmsgdG8gaXRzIHN1cGVy\nY2xhc3MgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFByaW1h\ncnlLZXlDb2x1bW5zKENvbHVtbltdIGNvbHMpIHsKICAgICAgICBpZiAoY29s\ncyA9PSBudWxsKQogICAgICAgICAgICBjb2xzID0gU2NoZW1hcy5FTVBUWV9D\nT0xVTU5TOwogICAgICAgIF9jb2xzID0gY29sczsKICAgIH0KCiAgICAvKioK\nICAgICAqIEkvTyBpbmZvcm1hdGlvbiBvbiB0aGUga2V5IGNvbHVtbnMgLyBq\nb2luIGtleS4KICAgICAqLwogICAgcHVibGljIENvbHVtbklPIGdldENvbHVt\nbklPKCkgewogICAgICAgIHJldHVybiAoX2lvID09IG51bGwpID8gQ29sdW1u\nSU8uVU5SRVNUUklDVEVEIDogX2lvOwogICAgfQoKICAgIC8qKgogICAgICog\nSS9PIGluZm9ybWF0aW9uIG9uIHRoZSBrZXkgY29sdW1ucyAvIGpvaW4ga2V5\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDb2x1bW5JTyhDb2x1bW5J\nTyBpbykgewogICAgICAgIF9pbyA9IGlvOwogICAgfQoKICAgIC8qKgogICAg\nICogRm9yZWlnbiBrZXkgbGlua2luZyB0aGUgcHJpbWFyeSBrZXkgY29sdW1u\ncyB0byB0aGUgc3VwZXJjbGFzcyB0YWJsZSwKICAgICAqIG9yIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0Sm9pbkZv\ncmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJuIF9mazsKICAgIH0KCiAgICAv\nKioKICAgICAqIEZvcmVpZ24ga2V5IGxpbmtpbmcgdGhlIHByaW1hcnkga2V5\nIGNvbHVtbnMgdG8gdGhlIHN1cGVyY2xhc3MgdGFibGUsCiAgICAgKiBvciBu\ndWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEpvaW5G\nb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBfZmsgPSBmazsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWZTY2hlbWFDb21wb25lbnRzKCkg\newogICAgICAgIGlmIChnZXRFbWJlZGRpbmdNZXRhRGF0YSgpID09IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKF90YWJsZSAhPSBudWxsICYmIF90YWJsZS5n\nZXRQcmltYXJ5S2V5KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF90YWJs\nZS5nZXRQcmltYXJ5S2V5KCkucmVmKCk7CiAgICAgICAgICAgIGlmIChfZmsg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9may5yZWYoKTsKICAgICAgICAg\nICAgQ29sdW1uW10gcGtzID0gZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBwa3NbaV0ucmVmKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gZmllbGRzID0gZ2V0Rmll\nbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZpZWxkc1tp\nXS5yZWZTY2hlbWFDb21wb25lbnRzKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQ2xlYXIgbWFwcGluZyBpbmZvcm1hdGlvbiwgaW5jbHVk\naW5nIHN0cmF0ZWd5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhck1h\ncHBpbmcoKSB7CiAgICAgICAgX3N0cmF0ZWd5ID0gbnVsbDsKICAgICAgICBf\nY29scyA9IFNjaGVtYXMuRU1QVFlfQ09MVU1OUzsKICAgICAgICBfZmsgPSBu\ndWxsOwogICAgICAgIF90YWJsZSA9IG51bGw7CiAgICAgICAgX2luZm8uY2xl\nYXIoKTsKICAgICAgICBzZXRSZXNvbHZlKE1PREVfTUFQUElORyB8IE1PREVf\nTUFQUElOR19JTklULCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBV\ncGRhdGUge0BsaW5rIE1hcHBpbmdJbmZvfSB3aXRoIG91ciBjdXJyZW50IG1h\ncHBpbmcgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN5\nbmNNYXBwaW5nSW5mbygpIHsKICAgICAgICBpZiAoZ2V0RW1iZWRkaW5nTWV0\nYURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICBfaW5mby5zeW5jV2l0aCh0\naGlzKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgX2luZm8uY2xlYXIo\nKTsKICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gZmllbGRzID0gZ2V0Rmll\nbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZpZWxkc1tp\nXS5zeW5jTWFwcGluZ0luZm8oKTsKICAgICAgICB9CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTWV0YURhdGEgaW50ZXJmYWNl\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHJvdGVjdGVkIHZv\naWQgc2V0RGVzY3JpYmVkVHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAgc3Vw\nZXIuc2V0RGVzY3JpYmVkVHlwZSh0eXBlKTsKICAgICAgICAvLyB0aGlzIG1l\ndGhvZCBjYWxsZWQgZnJvbSBzdXBlcmNsYXNzIGNvbnN0cnVjdG9yLCBzbyBf\naW5mbyBub3QgeWV0CiAgICAgICAgLy8gaW5pdGlhbGl6ZWQKICAgICAgICBp\nZiAoX2luZm8gIT0gbnVsbCkKICAgICAgICAgICAgX2luZm8uc2V0Q2xhc3NO\nYW1lKHR5cGUuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBzdWJjbGFzcyBmZXRjaCBtb2RlLCBhcyBvbmUgb2YgdGhlIGVhZ2VyIGNv\nbnN0YW50cyBpbgogICAgICoge0BsaW5rIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb259LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldFN1YmNsYXNzRmV0Y2hN\nb2RlKCkgewogICAgICAgIGlmIChfc3ViY2xhc3NNb2RlID09IEludGVnZXIu\nTUFYX1ZBTFVFKSB7CiAgICAgICAgICAgIGlmIChnZXRQQ1N1cGVyY2xhc3Mo\nKSAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N1YmNsYXNzTW9kZSA9IGdl\ndFBDU3VwZXJjbGFzc01hcHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRTdWJjbGFzc0ZldGNoTW9kZSgpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBfc3ViY2xhc3NNb2RlID0gRmV0Y2hDb25maWd1cmF0aW9u\nLkRFRkFVTFQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfc3ViY2xhc3NN\nb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN1YmNsYXNzIGZldGNo\nIG1vZGUsIGFzIG9uZSBvZiB0aGUgZWFnZXIgY29uc3RhbnRzIGluCiAgICAg\nKiB7QGxpbmsgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbn0uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldFN1YmNsYXNzRmV0Y2hNb2RlKGludCBtb2RlKSB7\nCiAgICAgICAgX3N1YmNsYXNzTW9kZSA9IG1vZGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZy\nb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldFJlcG9zaXRvcnl9\nLgogICAgICovCiAgICBwdWJsaWMgTWFwcGluZ1JlcG9zaXRvcnkgZ2V0TWFw\ncGluZ1JlcG9zaXRvcnkoKSB7CiAgICAgICAgcmV0dXJuIChNYXBwaW5nUmVw\nb3NpdG9yeSkgZ2V0UmVwb3NpdG9yeSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAg\nICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRFbWJlZGRpbmdNZXRhRGF0\nYX0KICAgICAqLwogICAgcHVibGljIFZhbHVlTWFwcGluZyBnZXRFbWJlZGRp\nbmdNYXBwaW5nKCkgewogICAgICAgIHJldHVybiAoVmFsdWVNYXBwaW5nKSBn\nZXRFbWJlZGRpbmdNZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyB0cnVlIGlmIHRoaXMgY2xhc3MgZG9lcyBub3QgdXNlIHRoZSAi\nbm9uZSIgc3RyYXRlZ3kgKGluY2x1ZGluZwogICAgICogaWYgaXQgaGFzIGEg\nbnVsbCBzdHJhdGVneSwgYW5kIHRoZXJlZm9yZSBpcyBwcm9iYWJseSBpbiB0\naGUgcHJvY2VzcyBvZgogICAgICogYmVpbmcgbWFwcGVkKS4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNNYXBwZWQoKSB7CiAgICAgICAgaWYgKCFz\ndXBlci5pc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgaWYgKF9zdHJhdGVneSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gX3N0cmF0ZWd5ICE9IE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNl\nKCk7CiAgICAgICAgcmV0dXJuICFOb25lQ2xhc3NTdHJhdGVneS5BTElBUy5l\ncXVhbHMoX2luZm8uZ2V0U3RyYXRlZ3koKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20K\nICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldFBDU3VwZXJjbGFzc01l\ndGFEYXRhfS4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFwcGluZyBnZXRQ\nQ1N1cGVyY2xhc3NNYXBwaW5nKCkgewogICAgICAgIHJldHVybiAoQ2xhc3NN\nYXBwaW5nKSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2Fz\ndCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRNYXBwZWRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YX0uCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01hcHBpbmcgZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWFwcGluZygpIHsKICAg\nICAgICByZXR1cm4gKENsYXNzTWFwcGluZykgZ2V0TWFwcGVkUENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbmVhcmVzdCBtYXBwZWQgc3VwZXJjbGFzcyB0aGF0IGNhbiBqb2luIHRv\nIHRoaXMgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01hcHBpbmcg\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgewogICAgICAgIENs\nYXNzTWFwcGluZyBzdXAgPSBnZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAoX2ZrICE9IG51bGwgfHwgX3RhYmxlID09\nIG51bGwgfHwgX3RhYmxlLmVxdWFscyhzdXAuZ2V0VGFibGUoKSkpCiAgICAg\nICAgICAgIHJldHVybiBzdXA7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9y\nbSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldFBD\nU3ViY2xhc3NNZXRhRGF0YXN9LgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NN\nYXBwaW5nW10gZ2V0UENTdWJjbGFzc01hcHBpbmdzKCkgewogICAgICAgIHJl\ndHVybiAoQ2xhc3NNYXBwaW5nW10pIGdldFBDU3ViY2xhc3NNZXRhRGF0YXMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0\nbyBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURh\ndGEjZ2V0TWFwcGVkUENTdWJjbGFzc01ldGFEYXRhc30uCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc01hcHBpbmdbXSBnZXRNYXBwZWRQQ1N1YmNsYXNzTWFw\ncGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkgZ2V0\nTWFwcGVkUENTdWJjbGFzc01ldGFEYXRhcygpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIG1hcHBlZCBzdWJjbGFzc2VzIHRoYXQgYXJlIHJlYWNo\nYWJsZSB2aWEgam9pbnMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01hcHBp\nbmdbXSBnZXRKb2luYWJsZVBDU3ViY2xhc3NNYXBwaW5ncygpIHsKICAgICAg\nICBDbGFzc01hcHBpbmdbXSBzdWJzID0gZ2V0TWFwcGVkUENTdWJjbGFzc01h\ncHBpbmdzKCk7IC8vIGNoZWNrcyBmb3IgbmV3CiAgICAgICAgaWYgKF9qb2lu\nU3ViTWFwcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChzdWJzLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICAgICAgX2pvaW5TdWJNYXBzID0gc3ViczsK\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBMaXN0IGpvaW5h\nYmxlID0gbmV3IEFycmF5TGlzdChzdWJzLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzU3ViSm9pbmFibGUoc3Vic1tpXSkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5hYmxlLmFkZChzdWJzW2ld\nKTsKICAgICAgICAgICAgICAgIF9qb2luU3ViTWFwcyA9IChDbGFzc01hcHBp\nbmdbXSkgam9pbmFibGUudG9BcnJheQogICAgICAgICAgICAgICAgICAgIChu\nZXcgQ2xhc3NNYXBwaW5nW2pvaW5hYmxlLnNpemUoKV0pOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfam9pblN1Yk1hcHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB3ZSBjYW4gcmVh\nY2ggdGhlIGdpdmVuIHN1YmNsYXNzIHZpYSBqb2lucy4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGlzU3ViSm9pbmFibGUoQ2xhc3NNYXBwaW5nIHN1\nYikgewogICAgICAgIGlmIChzdWIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIGlmIChzdWIgPT0gdGhpcykKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGlzU3ViSm9pbmFibGUo\nc3ViLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsb3Nlc3QtZGVyaXZlZCBs\naXN0IG9mIG5vbi1pbnRlci1qb2luYWJsZSBtYXBwZWQgdHlwZXMKICAgICAq\nIGFzc2lnbmFibGUgdG8gdGhpcyB0eXBlLiBNYXkgcmV0dXJuIHRoaXMgbWFw\ncGluZy4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdldElu\nZGVwZW5kZW50QXNzaWduYWJsZU1hcHBpbmdzKCkgewogICAgICAgIENsYXNz\nTWFwcGluZ1tdIHN1YnMgPSBnZXRNYXBwZWRQQ1N1YmNsYXNzTWFwcGluZ3Mo\nKTsgLy8gY2hlY2tzIGZvciBuZXcKICAgICAgICBpZiAoX2Fzc2lnbk1hcHMg\nPT0gbnVsbCkgewogICAgICAgICAgICAvLyByZW1vdmUgdW5tYXBwZWQgc3Vi\ncwogICAgICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT0gMCkgewogICAgICAg\nICAgICAgICAgaWYgKGlzTWFwcGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nX2Fzc2lnbk1hcHMgPSBuZXcgQ2xhc3NNYXBwaW5nW117IHRoaXMgfTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfYXNzaWdu\nTWFwcyA9IHN1YnM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBpbnQgc2l6ZSA9IChpbnQpIChzdWJzLmxlbmd0aCAqIDEuMzMgKyAy\nKTsKICAgICAgICAgICAgICAgIFNldCBpbmRlcGVuZGVudCA9IG5ldyBMaW5r\nZWRIYXNoU2V0KHNpemUpOwogICAgICAgICAgICAgICAgaWYgKGlzTWFwcGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgaW5kZXBlbmRlbnQuYWRkKHRoaXMp\nOwogICAgICAgICAgICAgICAgaW5kZXBlbmRlbnQuYWRkQWxsKEFycmF5cy5h\nc0xpc3Qoc3VicykpOwoKICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBhbGwg\nbWFwcGluZ3MgdGhhdCBoYXZlIGEgc3VwZXJjbGFzcyBtYXBwaW5nIGluIHRo\nZSBzZXQKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZyBtYXAsIHN1cDsK\nICAgICAgICAgICAgICAgIExpc3QgY2xlYXIgPSBudWxsOwogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBpbmRlcGVuZGVudC5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIG1h\ncCA9IChDbGFzc01hcHBpbmcpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICAgICAgc3VwID0gbWFwLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBp\nbmRlcGVuZGVudC5jb250YWlucyhzdXApKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChjbGVhciA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY2xlYXIgPSBuZXcgQXJyYXlMaXN0KGluZGVwZW5kZW50LnNp\nemUoKSAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBjbGVhci5hZGQo\nbWFwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBpZiAoY2xlYXIgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBpbmRlcGVuZGVudC5yZW1vdmVBbGwoY2xlYXIpOwoKICAg\nICAgICAgICAgICAgIF9hc3NpZ25NYXBzID0gKENsYXNzTWFwcGluZ1tdKSBp\nbmRlcGVuZGVudC50b0FycmF5CiAgICAgICAgICAgICAgICAgICAgKG5ldyBD\nbGFzc01hcHBpbmdbaW5kZXBlbmRlbnQuc2l6ZSgpXSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hc3NpZ25NYXBzOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZv\ncm0gY2FzdCBmcm9tIHtAbGluayBDbGFzc01ldGFEYXRhI2dldEZpZWxkc30u\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBnZXRGaWVsZE1h\ncHBpbmdzKCkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5nW10pIGdl\ndEZpZWxkcygpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xh\nc3NNZXRhRGF0YSNnZXREZWNsYXJlZEZpZWxkc30uCiAgICAgKi8KICAgIHB1\nYmxpYyBGaWVsZE1hcHBpbmdbXSBnZXREZWNsYXJlZEZpZWxkTWFwcGluZ3Mo\nKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBpbmdbXSkgZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNl\nIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENs\nYXNzTWV0YURhdGEjZ2V0UHJpbWFyeUtleUZpZWxkc30uCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBnZXRQcmltYXJ5S2V5RmllbGRNYXBw\naW5ncygpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBnZXRQ\ncmltYXJ5S2V5RmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtA\nbGluayBDbGFzc01ldGFEYXRhI2dldFZlcnNpb25GaWVsZH0uCiAgICAgKi8K\nICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0VmVyc2lvbkZpZWxkTWFwcGlu\nZygpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZykgZ2V0VmVyc2lv\nbkZpZWxkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBt\nZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFz\nc01ldGFEYXRhI2dldERlZmF1bHRGZXRjaEdyb3VwRmllbGRzfS4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWFwcGluZ1tdIGdldERlZmF1bHRGZXRjaEdy\nb3VwRmllbGRNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFw\ncGluZ1tdKSBnZXREZWZhdWx0RmV0Y2hHcm91cEZpZWxkcygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0g\nY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWZp\nbmVkRmllbGRzfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZ1td\nIGdldERlZmluZWRGaWVsZE1hcHBpbmdzKCkgewogICAgICAgIHJldHVybiAo\nRmllbGRNYXBwaW5nW10pIGdldERlZmluZWRGaWVsZHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNh\nc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0RmllbGRz\nSW5MaXN0aW5nT3JkZXJ9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBw\naW5nW10gZ2V0RmllbGRNYXBwaW5nc0luTGlzdGluZ09yZGVyKCkgewogICAg\nICAgIHJldHVybiAoRmllbGRNYXBwaW5nW10pIGdldEZpZWxkc0luTGlzdGlu\nZ09yZGVyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBt\nZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFz\nc01ldGFEYXRhI2dldERlZmluZWRGaWVsZHNJbkxpc3RpbmdPcmRlcn0uCiAg\nICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBnZXREZWZpbmVkRmll\nbGRNYXBwaW5nc0luTGlzdGluZ09yZGVyKCkgewogICAgICAgIHJldHVybiAo\nRmllbGRNYXBwaW5nW10pIGdldERlZmluZWRGaWVsZHNJbkxpc3RpbmdPcmRl\ncigpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9k\nIHRvIHBlcmZvcm0gY2FzdCBmcm9tIHtAbGluayBDbGFzc01ldGFEYXRhI2dl\ndEZpZWxkfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXRG\naWVsZE1hcHBpbmcoaW50IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIChGaWVs\nZE1hcHBpbmcpIGdldEZpZWxkKGluZGV4KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQog\nICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0RGVjbGFyZWRGaWVsZH0u\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RGVjbGFyZWRG\naWVsZE1hcHBpbmcoaW50IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIChGaWVs\nZE1hcHBpbmcpIGdldERlY2xhcmVkRmllbGQoaW5kZXgpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2Fz\ndCBmcm9tIHtAbGluayBDbGFzc01ldGFEYXRhI2dldEZpZWxkfS4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXRGaWVsZE1hcHBpbmcoU3Ry\naW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZykgZ2V0\nRmllbGQobmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5j\nZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBD\nbGFzc01ldGFEYXRhI2dldERlY2xhcmVkRmllbGR9LgogICAgICovCiAgICBw\ndWJsaWMgRmllbGRNYXBwaW5nIGdldERlY2xhcmVkRmllbGRNYXBwaW5nKFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBpbmcpIGdl\ndERlY2xhcmVkRmllbGQobmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAq\nIHtAbGluayBDbGFzc01ldGFEYXRhI2dldERlY2xhcmVkVW5tYW5hZ2VkRmll\nbGRzfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZ1tdIGdldERl\nY2xhcmVkVW5tYW5hZ2VkRmllbGRNYXBwaW5ncygpIHsKICAgICAgICByZXR1\ncm4gKEZpZWxkTWFwcGluZ1tdKSBnZXREZWNsYXJlZFVubWFuYWdlZEZpZWxk\ncygpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9k\nIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRh\nRGF0YSNhZGREZWNsYXJlZEZpZWxkfS4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkTWFwcGluZyBhZGREZWNsYXJlZEZpZWxkTWFwcGluZyhTdHJpbmcgbmFt\nZSwgQ2xhc3MgdHlwZSkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5n\nKSBhZGREZWNsYXJlZEZpZWxkKG5hbWUsIHR5cGUpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCB2b2lkIHJlc29sdmVNYXBwaW5nKGJvb2xlYW4gcnVudGltZSkg\newogICAgICAgIHN1cGVyLnJlc29sdmVNYXBwaW5nKHJ1bnRpbWUpOwoKICAg\nICAgICAvLyBtYXAgY2xhc3Mgc3RyYXRlZ3k7IGl0IG1heSBhbHJlYWR5IGJl\nIG1hcHBlZCBieSB0aGUgcmVwb3NpdG9yeSBiZWZvcmUKICAgICAgICAvLyB0\naGUgcmVzb2x2ZSBwcm9jZXNzIGJlZ2lucwogICAgICAgIE1hcHBpbmdSZXBv\nc2l0b3J5IHJlcG9zID0gZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKTsKICAgICAg\nICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgIHJlcG9zLmdl\ndFN0cmF0ZWd5SW5zdGFsbGVyKCkuaW5zdGFsbFN0cmF0ZWd5KHRoaXMpOwog\nICAgICAgIExvZyBsb2cgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCk7CiAg\nICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBs\nb2cudHJhY2UoX2xvYy5nZXQoInN0cmF0ZWd5IiwgdGhpcywgX3N0cmF0ZWd5\nLmdldEFsaWFzKCkpKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHVubWFwcGVk\nIHN1cGVyY2xhc3MgZmllbGRzIGFyZSBkZWZpbmVkIGlmIHdlJ3JlIG1hcHBl\nZDsKICAgICAgICAvLyBhbHNvIG1heSBoYXZlIGJlZW4gZG9uZSBieSByZXBv\nc2l0b3J5IGFscmVhZHkKICAgICAgICBkZWZpbmVTdXBlcmNsYXNzRmllbGRz\nKGdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpID09IG51bGwpOwoK\nICAgICAgICAvLyByZXNvbHZlIGV2ZXJ5dGhpbmcgdGhhdCBkb2Vzbid0IHJl\nbHkgb24gYW55IHJlbGF0aW9ucyB0byBhdm9pZAogICAgICAgIC8vIHJlY3Vy\nc2lvbiwgdGhlbiByZXNvbHZlIGFsbCBmaWVsZHMKICAgICAgICByZXNvbHZl\nTm9uUmVsYXRpb25NYXBwaW5ncygpOwogICAgICAgIEZpZWxkTWFwcGluZ1td\nIGZtcyA9IGdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\nZm1zW2ldLmdldERlZmluaW5nTWV0YURhdGEoKSA9PSB0aGlzKSB7CiAgICAg\nICAgICAgICAgICBib29sZWFuIGZpbGwgPSBnZXRNYXBwaW5nUmVwb3NpdG9y\neSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAg\nIGRlZmF1bHRNaXNzaW5nSW5mbygpOwogICAgICAgICAgICAgICAgRm9yZWln\nbktleSBmayA9IGZtc1tpXS5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgICAg\nICAgICBpZiAoZmlsbCAmJiBmayAhPSBudWxsICYmIAogICAgICAgICAgICAg\nICAgICAgIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID09IDAp\nIHsgCiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHJlc29sdmUgbW9kZSB0\nbyBmb3JjZSB0aGlzIGZpZWxkIG1hcHBpbmcgdG8gYmUgCiAgICAgICAgICAg\nICAgICAgICAgLy8gcmVzb2x2ZWQgYWdhaW4uIFRoZSBuZWVkIHRvIHJlc29s\ndmUgYWdhaW4gb2NjdXJzIHdoZW4gCiAgICAgICAgICAgICAgICAgICAgLy8g\nYSBwcmltYXJ5IGtleSBpcyBhIHJlbGF0aW9uIGZpZWxkIHdpdGggdGhlIGZv\ncmVpZ24ga2V5CiAgICAgICAgICAgICAgICAgICAgLy8gYW5ub3RhdGlvbi4g\nSW4gdGhpcyBzaXR1YXRpb24sIHRoaXMgcHJpbWFyeSBrZXkgZmllbGQKICAg\nICAgICAgICAgICAgICAgICAvLyBtYXBwaW5nIGlzIHJlc29sdmVkIGR1cmlu\nZyB0aGUgY2FsbCB0byAKICAgICAgICAgICAgICAgICAgICAvLyByZXNvbHZl\nTm9uUmVsYXRpb25NYXBwaW5nLiBTaW5jZSBpdCBpcyBhIHJlbGF0aW9uCiAg\nICAgICAgICAgICAgICAgICAgLy8gZmllbGQsIHRoZSBmb3JlaWduIGtleSB3\naWxsIGJlIGNvbnN0cnVjdGVkLiBIb3dldmVyLCAKICAgICAgICAgICAgICAg\nICAgICAvLyB0aGUgcHJpbWFyeSBrZXkgb2YgdGhlIHBhcmVudCBlbnRpdHkg\nbWF5IG5vdCBoYXZlIGJlZW4gCiAgICAgICAgICAgICAgICAgICAgLy8gcmVz\nb2x2ZWQgeWV0LCByZXN1bHRpbmcgaW4gbWlzc2luZyBpbmZvcm1hdGlvbiBp\nbiB0aGUgZmsKICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2V0UmVzb2x2\nZShNT0RFX01FVEEpOyAKICAgICAgICAgICAgICAgICAgICBpZiAoZm1zW2ld\nLmdldFN0cmF0ZWd5KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgZm1zW2ldLmdldFN0cmF0ZWd5KCkubWFwKGZhbHNlKTsKICAgICAgICAg\nICAgICAgIH0gICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmbXNb\naV0ucmVzb2x2ZShNT0RFX01BUFBJTkcpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGZtcyA9IGdldERlY2xhcmVkVW5tYW5hZ2VkRmllbGRN\nYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBmbXNbaV0ucmVzb2x2ZShNT0RFX01B\nUFBJTkcpOwoKICAgICAgICAvLyBtYXJrIG1hcHBlZCBjb2x1bW5zCiAgICAg\nICAgaWYgKF9jb2xzICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1uSU8g\naW8gPSBnZXRDb2x1bW5JTygpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBp\nZiAoaW8uaXNJbnNlcnRhYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAgICAg\nICAgICBfY29sc1tpXS5zZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9JTlNF\nUlQsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGlvLmlzVXBkYXRhYmxl\nKGksIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICBfY29sc1tpXS5zZXRG\nbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9VUERBVEUsIHRydWUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIG9uY2UgY29sdW1ucyBhcmUg\ncmVzb2x2ZWQsIHJlc29sdmUgdW5pcXVlIGNvbnN0cmFpbnRzIGFzIHRoZXkg\nbmVlZAogICAgICAgIC8vIHRoZSBjb2x1bW5zIGJlIHJlc29sdmVkIAogICAg\nICAgIF9pbmZvLmdldFVuaXF1ZXModGhpcywgdHJ1ZSk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogUmVzb2x2ZSBub24tcmVsYXRpb24gZmllbGQgbWFw\ncGluZ3Mgc28gdGhhdCB3aGVuIHdlIGRvIHJlbGF0aW9uCiAgICAgKiBtYXBw\naW5ncyB0aGV5IGNhbiByZWx5IG9uIHRoZW0gZm9yIGpvaW5zLgogICAgICov\nCiAgICB2b2lkIHJlc29sdmVOb25SZWxhdGlvbk1hcHBpbmdzKCkgewogICAg\nICAgIC8vIG1ha2Ugc3VyZSBwcmltYXJ5IGtleSBmaWVsZHMgYXJlIHJlc29s\ndmVkIGZpcnN0IGJlY2F1c2Ugb3RoZXIKICAgICAgICAvLyBmaWVsZHMgbWln\naHQgcmVseSBvbiB0aGVtCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0g\nZ2V0UHJpbWFyeUtleUZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgZm1z\nW2ldLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKCiAgICAgICAgLy8gcmVzb2x2\nZSBkZWZpbmVkIGZpZWxkcyB0aGF0IGFyZSBzYWZlOyB0aGF0IGRvbid0IHJl\nbHkgb24gb3RoZXIgdHlwZXMKICAgICAgICAvLyBhbHNvIGJlaW5nIHJlc29s\ndmVkLiAgZG9uJ3QgdXNlIGdldERlZmluZWRGaWVsZHMgYi9jIGl0IHJlbGll\ncyBvbgogICAgICAgIC8vIHdoZXRoZXIgZmllbGRzIGFyZSBtYXBwZWQsIHdo\naWNoIGlzbid0IGtub3duIHlldAogICAgICAgIGZtcyA9IGdldEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZtc1tpXS5nZXREZWZpbmluZ01l\ndGFEYXRhKCkgPT0gdGhpcwogICAgICAgICAgICAgICAgJiYgIWZtc1tpXS5p\nc1R5cGVQQygpICYmICFmbXNbaV0uZ2V0S2V5KCkuaXNUeXBlUEMoKQogICAg\nICAgICAgICAgICAgJiYgIWZtc1tpXS5nZXRFbGVtZW50KCkuaXNUeXBlUEMo\nKSkKICAgICAgICAgICAgICAgIGZtc1tpXS5yZXNvbHZlKE1PREVfTUFQUElO\nRyk7CgogICAgICAgIF9kaXNjcmltLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsK\nICAgICAgICBfdmVyc2lvbi5yZXNvbHZlKE1PREVfTUFQUElORyk7ICAgICAg\nICAKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFwcGlu\nZygpIHsKICAgICAgICBzdXBlci5pbml0aWFsaXplTWFwcGluZygpOwoKICAg\nICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBnZXREZWZpbmVkRmllbGRN\nYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBmaWVsZHNbaV0ucmVzb2x2ZShN\nT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX2Rpc2NyaW0ucmVzb2x2ZShN\nT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX3ZlcnNpb24ucmVzb2x2ZShN\nT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX3N0cmF0ZWd5LmluaXRpYWxp\nemUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckRlZmluZWRG\naWVsZENhY2hlKCkgewogICAgICAgIC8vIGp1c3QgbWFrZSB0aGlzIG1ldGhv\nZCBhdmFpbGFibGUgdG8gb3RoZXIgY2xhc3NlcyBpbiB0aGlzIHBhY2thZ2UK\nICAgICAgICBzdXBlci5jbGVhckRlZmluZWRGaWVsZENhY2hlKCk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJTdWJjbGFzc0NhY2hlKCkgewog\nICAgICAgIHN1cGVyLmNsZWFyU3ViY2xhc3NDYWNoZSgpOwogICAgICAgIF9q\nb2luU3ViTWFwcyA9IG51bGw7CiAgICAgICAgX2Fzc2lnbk1hcHMgPSBudWxs\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvcHkoQ2xhc3NNZXRhRGF0YSBj\nbHMpIHsKICAgICAgICBzdXBlci5jb3B5KGNscyk7CiAgICAgICAgaWYgKF9z\ndWJjbGFzc01vZGUgPT0gSW50ZWdlci5NQVhfVkFMVUUpCiAgICAgICAgICAg\nIF9zdWJjbGFzc01vZGUgPSAoKENsYXNzTWFwcGluZykgY2xzKS5nZXRTdWJj\nbGFzc0ZldGNoTW9kZSgpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFu\nIHZhbGlkYXRlRGF0YVN0b3JlRXh0ZW5zaW9uUHJlZml4KFN0cmluZyBwcmVm\naXgpIHsKICAgICAgICByZXR1cm4gImpkYmMtIi5lcXVhbHMocHJlZml4KTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gQ2xhc3NTdHJhdGVneSBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgU3RyaW5n\nIGdldEFsaWFzKCkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgp\nLmdldEFsaWFzKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFwKGJvb2xl\nYW4gYWRhcHQpIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLm1hcChhZGFw\ndCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZSgpIHsKICAg\nICAgICBhc3NlcnRTdHJhdGVneSgpLmluaXRpYWxpemUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuaW5z\nZXJ0KHNtLCBzdG9yZSwgcm0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVw\nZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS51cGRhdGUoc20sIHN0b3JlLCBy\nbSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRT\ndHJhdGVneSgpLmRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgIH0KCiAgICBw\ndWJsaWMgQm9vbGVhbiBpc0N1c3RvbUluc2VydChPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1cm4gYXNz\nZXJ0U3RyYXRlZ3koKS5pc0N1c3RvbUluc2VydChzbSwgc3RvcmUpOwogICAg\nfQoKICAgIHB1YmxpYyBCb29sZWFuIGlzQ3VzdG9tVXBkYXRlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJl\ndHVybiBhc3NlcnRTdHJhdGVneSgpLmlzQ3VzdG9tVXBkYXRlKHNtLCBzdG9y\nZSk7CiAgICB9CgogICAgcHVibGljIEJvb2xlYW4gaXNDdXN0b21EZWxldGUo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAg\nICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuaXNDdXN0b21EZWxldGUo\nc20sIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjdXN0b21JbnNl\ncnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0\ncmF0ZWd5KCkuY3VzdG9tSW5zZXJ0KHNtLCBzdG9yZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgY3VzdG9tVXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmN1c3RvbVVwZGF0ZShz\nbSwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGN1c3RvbURlbGV0\nZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0U3Ry\nYXRlZ3koKS5jdXN0b21EZWxldGUoc20sIHN0b3JlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRDbGFzc01hcHBpbmcoQ2xhc3NNYXBwaW5nIG93bmVy\nKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5zZXRDbGFzc01hcHBpbmco\nb3duZXIpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUHJpbWFyeUtl\neU9iamVjdElkKGJvb2xlYW4gaGFzQWxsKSB7CiAgICAgICAgcmV0dXJuIGFz\nc2VydFN0cmF0ZWd5KCkuaXNQcmltYXJ5S2V5T2JqZWN0SWQoaGFzQWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pblN1cGVyY2xhc3MoSm9pbnMg\nam9pbnMsIGJvb2xlYW4gdG9UaGlzKSB7CiAgICAgICAgcmV0dXJuIGFzc2Vy\ndFN0cmF0ZWd5KCkuam9pblN1cGVyY2xhc3Moam9pbnMsIHRvVGhpcyk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNFYWdlclNlbGVjdChT\nZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgQ2xhc3NNYXBwaW5nIGJhc2UsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3Ry\nYXRlZ3koKS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20sIHN0b3JlLCBi\nYXNlLAogICAgICAgICAgICBmZXRjaCk7CiAgICB9CgogICAgcHVibGljIFJl\nc3VsdE9iamVjdFByb3ZpZGVyIGN1c3RvbUxvYWQoSkRCQ1N0b3JlIHN0b3Jl\nLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgbG9uZyBzdGFydElkeCwgbG9uZyBlbmRJZHgpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGFz\nc2VydFN0cmF0ZWd5KCkuY3VzdG9tTG9hZChzdG9yZSwgc3ViY2xhc3Nlcywg\nZmV0Y2gsCiAgICAgICAgICAgIHN0YXJ0SWR4LCBlbmRJZHgpOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIFBDU3RhdGUgc3Rh\ndGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tTG9hZChzbSwg\nc3RvcmUsIHN0YXRlLCBmZXRjaCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gY3VzdG9tTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3Rv\ncmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgUmVzdWx0IHJlc3VsdCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5jdXN0b21Mb2Fk\nKHNtLCBzdG9yZSwgZmV0Y2gsIHJlc3VsdCk7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgQ2xhc3NTdHJhdGVneSBhc3NlcnRTdHJhdGVneSgpIHsKICAgICAg\nICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIHJldHVybiBfc3RyYXRl\nZ3k7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogRmluZCB0aGUgZmllbGQg\nbWFwcGluZ3MgdGhhdCBjb3JyZXNwb25kIHRvIHRoZSBnaXZlbiBjb2x1bW5z\nLgogICAgICogCiAgICAgKiBAcmV0dXJuIG51bGwgaWYgbm8gY29sdW1ucyBh\ncmUgZ2l2ZW4gb3Igbm8gZmllbGQgbWFwcGluZyB1c2VzIHRoZSBnaXZlbgog\nICAgICogY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PEZpZWxk\nTWFwcGluZz4gZ2V0RmllbGRNYXBwaW5ncyhDb2x1bW5bXSBjb2xzLCBib29s\nZWFuIHByaW1lKSB7CiAgICAJaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxl\nbmd0aCA9PSAwKQogICAgCQlyZXR1cm4gbnVsbDsKICAgIAlMaXN0PEZpZWxk\nTWFwcGluZz4gcmVzdWx0ID0gbnVsbDsKICAgIAlmb3IgKENvbHVtbiBjIDog\nY29scykgewogICAgCQlMaXN0PEZpZWxkTWFwcGluZz4gZm1zID0gaGFzQ29s\ndW1uKGMsIHByaW1lKTsKICAgIAkJaWYgKGZtcyA9PSBudWxsKSBjb250aW51\nZTsKCQkJaWYgKHJlc3VsdCA9PSBudWxsKQoJCQkJcmVzdWx0ID0gbmV3IEFy\ncmF5TGlzdDxGaWVsZE1hcHBpbmc+KCk7CgkJCWZvciAoRmllbGRNYXBwaW5n\nIGZtIDogZm1zKQoJCQkJaWYgKCFyZXN1bHQuY29udGFpbnMoZm0pKQoJCQkJ\nCXJlc3VsdC5hZGQoZm0pOwogICAgCX0KICAgIAlyZXR1cm4gcmVzdWx0Owog\nICAgfQogICAgCiAgICAvKioKICAgICAqIExvb2tzIHVwIGluIHJldmVyc2Ug\ndG8gZmluZCB0aGUgbGlzdCBvZiBmaWVsZCBtYXBwaW5ncyB0aGF0IGluY2x1\nZGUgdGhlCiAgICAgKiBnaXZlbiBjb2x1bW4uIENvc3RseS4KICAgICAqIAog\nICAgICogQHJldHVybiBudWxsIGlmIG5vIGZpZWxkIG1hcHBpbmdzIGNhcnJ5\nIHRoaXMgY29sdW1uLiAKICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PEZpZWxk\nTWFwcGluZz4gaGFzQ29sdW1uKENvbHVtbiBjLCBib29sZWFuIHByaW1lKSB7\nCiAgICAJTGlzdDxGaWVsZE1hcHBpbmc+IHJlc3VsdCA9IG51bGw7CiAgICAJ\nRmllbGRNYXBwaW5nW10gZm1zID0gKHByaW1lKSA/IAogICAgCQlnZXRQcmlt\nYXJ5S2V5RmllbGRNYXBwaW5ncygpIDogZ2V0RmllbGRNYXBwaW5ncygpOwog\nICAgCWZvciAoRmllbGRNYXBwaW5nIGZtIDogZm1zKSB7CiAgICAJCUNvbHVt\nbltdIGNvbHMgPSBmbS5nZXRDb2x1bW5zKCk7CiAgICAJCWlmIChjb250YWlu\ncyhjb2xzLCBjKSkgewogICAgCQkJaWYgKHJlc3VsdCA9PSBudWxsKQogICAg\nCQkJCXJlc3VsdCA9IG5ldyBBcnJheUxpc3Q8RmllbGRNYXBwaW5nPigpOwog\nICAgCQkJcmVzdWx0LmFkZChmbSk7CiAgICAJCX0KICAgIAl9CiAgICAJcmV0\ndXJuIHJlc3VsdDsKICAgIH0KICAgIAogICAgYm9vbGVhbiBjb250YWlucyhD\nb2x1bW5bXSBjb2xzLCBDb2x1bW4gYykgewogICAgCWZvciAoQ29sdW1uIGNv\nbCA6IGNvbHMpCiAgICAJCWlmIChjb2wgPT0gYykKICAgIAkJCXJldHVybiB0\ncnVlOwogICAgCXJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBHZXRzIHRoZSBmaWVsZCB2YWx1ZXMgb2YgdGhlIGdpdmVuIGluc3Rh\nbmNlIGZvciB0aGUgZ2l2ZW4gY29sdW1ucy4KICAgICAqIFRoZSBnaXZlbiBj\nb2x1bW5zIGFyZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBmaWVsZHMgYnkgYSBy\nZXZlcnNlIGxvb2t1cC4KICAgICAqICAKICAgICAqIEByZXR1cm4gYSBzaW5n\nbGUgb2JqZWN0IG9yIGFuIGFycmF5IG9mIG9iamVjdHMgYmFzZWQgb24gbnVt\nYmVyIG9mIAogICAgICogZmllbGRzIHRoZSBnaXZlbiBjb2x1bW5zIHJlcHJl\nc2VudC4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZ2V0VmFsdWVGcm9t\nVW5tYW5hZ2VkSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29sdW1uW10gY29scywg\nCiAgICAJCWJvb2xlYW4gcHJpbWUpIHsKICAgIAlMaXN0PEZpZWxkTWFwcGlu\nZz4gZm1zID0gZ2V0RmllbGRNYXBwaW5ncyhjb2xzLCBwcmltZSk7CiAgICAJ\naWYgKGZtcyA9PSBudWxsKQogICAgCQlyZXR1cm4gbnVsbDsKICAgIAlpZiAo\nZm1zLnNpemUoKSA9PSAxKQogICAgCQlyZXR1cm4gUmVmbGVjdGlvbi5nZXRW\nYWx1ZShvYmosIGZtcy5nZXQoMCkuZ2V0TmFtZSgpLCB0cnVlKTsKICAgIAlP\nYmplY3RbXSByZXN1bHQgPSBuZXcgT2JqZWN0W2Ztcy5zaXplKCldOwogICAg\nCWludCBpID0gMDsKICAgIAlmb3IgKEZpZWxkTWFwcGluZyBmbSA6IGZtcykg\newogICAgCQlyZXN1bHRbaSsrXSA9IFJlZmxlY3Rpb24uZ2V0VmFsdWUob2Jq\nLCBmbS5nZXROYW1lKCksIHRydWUpOwogICAgCX0KICAgIAlyZXR1cm4gcmVz\ndWx0OwogICAgfQp9Cg==\n","encoding":"base64"}

