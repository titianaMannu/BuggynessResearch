{"sha":"a4d8f5eb165c8c8c60c7a960c2805d6aeeae01af","node_id":"MDQ6QmxvYjIwNjM2NDphNGQ4ZjVlYjE2NWM4YzhjNjBjN2E5NjBjMjgwNWQ2YWVlYWUwMWFm","size":44015,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a4d8f5eb165c8c8c60c7a960c2805d6aeeae01af","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3Rl\nbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNl\nLlJlZmxlY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5r\nZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lRmllbGRTdHJh\ndGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3Ry\nYXRzLlByaW1pdGl2ZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuSW5kZXg7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5zOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJlc3VsdDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3c7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5TUUxCdWZmZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdEV4ZWN1dG9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0YXRl\nTWFuYWdlckltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxv\nZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxk\nTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZh\nVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BcHBsaWNh\ndGlvbklkczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVy\nbmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PYmplY3RJZDsKCi8qKgogKiBTcGVjaWFsaXphdGlvbiBvZiBtZXRh\nZGF0YSBmb3IgcmVsYXRpb25hbCBkYXRhYmFzZXMuCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgRmllbGRNYXBwaW5nCiAgICBl\neHRlbmRzIEZpZWxkTWV0YURhdGEKICAgIGltcGxlbWVudHMgVmFsdWVNYXBw\naW5nLCBGaWVsZFN0cmF0ZWd5IHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAg\nICAgKEZpZWxkTWFwcGluZy5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBW\nYWx1ZU1hcHBpbmcgX3ZhbDsKICAgIHByaXZhdGUgZmluYWwgVmFsdWVNYXBw\naW5nIF9rZXk7CiAgICBwcml2YXRlIGZpbmFsIFZhbHVlTWFwcGluZyBfZWxl\nbTsKICAgIHByaXZhdGUgZmluYWwgRmllbGRNYXBwaW5nSW5mbyBfaW5mbzsK\nICAgIHByaXZhdGUgZmluYWwgSkRCQ0NvbHVtbk9yZGVyIF9vcmRlckNvbCA9\nIG5ldyBKREJDQ29sdW1uT3JkZXIoKTsKICAgIHByaXZhdGUgRmllbGRTdHJh\ndGVneSBfc3RyYXRlZ3kgPSBudWxsOwoKICAgIHByaXZhdGUgRm9yZWlnbktl\neSBfZmsgPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5JTyBfaW8gPSBudWxs\nOwogICAgcHJpdmF0ZSBVbmlxdWUgX3VucSA9IG51bGw7CiAgICBwcml2YXRl\nIEluZGV4IF9pZHggPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9vdXRl\nciA9IGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX2ZldGNoTW9kZSA9IEludGVn\nZXIuTUFYX1ZBTFVFOwogICAgcHJpdmF0ZSBVbmlxdWVbXSBfam9pblRhYmxl\nVW5pcXVlczsgLy8gVW5pcXVlIGNvbnN0cmFpbnRzIG9uIEpvaW5UYWJsZQog\nICAgcHJpdmF0ZSBCb29sZWFuIF9iaWRpcmVjdGlvbmFsSm9pblRhYmxlT3du\nZXIgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9iaWRpcmVjdGlvbmFs\nSm9pblRhYmxlTm9uT3duZXIgPSBudWxsOwogICAgCiAgICBwcml2YXRlIEJv\nb2xlYW4gX2JpX01UbzFfSlQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFu\nIF91bmlfMVRvTV9GSyA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX3Vu\naV9NVG8xX0pUID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfdW5pXzFU\nbzFfSlQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9iaV8xVG8xX0pU\nID0gbnVsbDsKICAgIAogICAgcHJpdmF0ZSBGaWVsZE1hcHBpbmcgX2JpXzFU\nb01fSlRfRmllbGQgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1hcHBpbmcg\nX2JpX01UbzFfSlRfRmllbGQgPSBudWxsOwogICAgcHJpdmF0ZSBGb3JlaWdu\nS2V5IF9iaV8xVG9NX0pvaW5fRksgPSBudWxsOwogICAgcHJpdmF0ZSBGb3Jl\naWduS2V5IF9iaV8xVG9NX0VsZW1fRksgPSBudWxsOwogICAgICAgIAogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkTWFwcGluZyhTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSwgQ2xhc3NNYXBw\naW5nIG93bmVyKSB7CiAgICAgICAgc3VwZXIobmFtZSwgdHlwZSwgb3duZXIp\nOwogICAgICAgIF9pbmZvID0gb3duZXIuZ2V0TWFwcGluZ1JlcG9zaXRvcnko\nKS5uZXdNYXBwaW5nSW5mbyh0aGlzKTsKICAgICAgICBfdmFsID0gKFZhbHVl\nTWFwcGluZykgZ2V0VmFsdWUoKTsKICAgICAgICBfa2V5ID0gKFZhbHVlTWFw\ncGluZykgZ2V0S2V5KCk7CiAgICAgICAgX2VsZW0gPSAoVmFsdWVNYXBwaW5n\nKSBnZXRFbGVtZW50KCk7CgogICAgICAgIHNldFVzZXNJbnRlcm1lZGlhdGUo\nZmFsc2UpOwogICAgICAgIHNldFVzZXNJbXBsRGF0YShCb29sZWFuLkZBTFNF\nKTsKICAgIH0KCiAgICAvLy8vLy8vCiAgICAvLyBPUk0KICAgIC8vLy8vLy8K\nCiAgICAvKioKICAgICAqIFJhdyBtYXBwaW5nIGRhdGEgYWJvdXQgZmllbGQn\ncyBqb2luIHRvIHBhcmVudCB0YWJsZSwgYXMgd2VsbCBhcwogICAgICogbWlz\nY2VsbGFuZW91cyBzcGVjaWFsaXplZCBjb2x1bW5zIGxpa2Ugb3JkZXIgY29s\ndW1uLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nSW5mbyBnZXRN\nYXBwaW5nSW5mbygpIHsKICAgICAgICByZXR1cm4gX2luZm87CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdXNlZCB0byBtYXAgdGhpcyBt\nYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMgRmllbGRTdHJhdGVneSBnZXRT\ndHJhdGVneSgpIHsKICAgICAgICByZXR1cm4gX3N0cmF0ZWd5OwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5IHVzZWQgdG8gbWFwIHRoaXMg\nbWFwcGluZy4gVGhlIDxjb2RlPmFkYXB0PC9jb2RlPgogICAgICogcGFyYW1l\ndGVyIGRldGVybWluZXMgd2hldGhlciB0byBhZGFwdCB3aGVuIG1hcHBpbmcg\ndGhlIHN0cmF0ZWd5OwogICAgICogdXNlIG51bGwgaWYgdGhlIHN0cmF0ZWd5\nIHNob3VsZCBub3QgYmUgbWFwcGVkLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRTdHJhdGVneShGaWVsZFN0cmF0ZWd5IHN0cmF0ZWd5LCBCb29sZWFu\nIGFkYXB0KSB7CiAgICAgICAgLy8gc2V0IHN0cmF0ZWd5IGZpcnN0IHNvIHdl\nIGNhbiBhY2Nlc3MgaXQgZHVyaW5nIG1hcHBpbmcKICAgICAgICBGaWVsZFN0\ncmF0ZWd5IG9yaWcgPSBfc3RyYXRlZ3k7CiAgICAgICAgX3N0cmF0ZWd5ID0g\nc3RyYXRlZ3k7CiAgICAgICAgaWYgKHN0cmF0ZWd5ICE9IG51bGwpIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0cmF0ZWd5LnNldEZp\nZWxkTWFwcGluZyh0aGlzKTsKICAgICAgICAgICAgICAgIGlmIChhZGFwdCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5Lm1hcChhZGFw\ndC5ib29sZWFuVmFsdWUoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIC8vIHJlc2V0IHN0\ncmF0ZWd5CiAgICAgICAgICAgICAgICBfc3RyYXRlZ3kgPSBvcmlnOwogICAg\nICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGlmIHNldCB0byB1bm1hcHBlZCwgY2xlYXIgZGVmaW5lZCBmaWVs\nZCBjYWNoZSBpbiBwYXJlbnQKICAgICAgICAgICAgaWYgKCFpc01hcHBlZCgp\nKQogICAgICAgICAgICAgICAgZ2V0RGVmaW5pbmdNYXBwaW5nKCkuY2xlYXJE\nZWZpbmVkRmllbGRDYWNoZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBtYXBwaW5nJ3MgcHJpbWFyeSB0YWJsZS4KICAgICAqLwog\nICAgcHVibGljIFRhYmxlIGdldFRhYmxlKCkgewogICAgICAgIGlmIChfZmsg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9may5nZXRUYWJsZSgpOwog\nICAgICAgIGlmIChfdmFsLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX3ZhbC5nZXRGb3JlaWduS2V5KCkuZ2V0VGFibGUo\nKTsKICAgICAgICAKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgbWFwIG9mIGJp\nLWRpcmVjdGlvbmFsIHJlbGF0aW9uLAogICAgICAgIC8vIHRoZSBjb2x1bW4g\nb2YgdGhpcyBmaWVsZCBzaG91bGQgYmUgaW4gdGhlIHRhYmxlIAogICAgICAg\nIC8vIG9mIHRoZSBlbnRpdHkgdGhhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIG1h\ncAogICAgICAgIGlmIChfdmFsLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBK\nYXZhVHlwZXMuTUFQKSB7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyBtZXRh\nID0gX2VsZW0uZ2V0RGVjbGFyZWRUeXBlTWFwcGluZygpOwogICAgICAgICAg\nICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG1l\ndGEuZ2V0VGFibGUoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgVmFs\ndWVNYXBwaW5nSW1wbCB2bSA9IChWYWx1ZU1hcHBpbmdJbXBsKWdldERlZmlu\naW5nTWFwcGluZygpLgogICAgICAgICAgICBnZXRFbWJlZGRpbmdNZXRhRGF0\nYSgpOwogICAgICAgIGlmICh2bSAhPSBudWxsICYmIHZtLmdldFZhbHVlTWFw\ncGVkQnkoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiB2bS5nZXRG\naWVsZE1hcHBpbmcoKS5nZXRFbGVtZW50TWFwcGluZygpLgogICAgICAgICAg\nICAgICAgZ2V0RGVjbGFyZWRUeXBlTWFwcGluZygpLmdldFRhYmxlKCk7CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBnZXREZWZpbmluZ01h\ncHBpbmcoKS5nZXRUYWJsZSgpOwogICAgfQoKICAgIC8qKgogICAgICogSS9P\nIGluZm9ybWF0aW9uIG9uIHRoZSBqb2luIGNvbHVtbnMuCiAgICAgKi8KICAg\nIHB1YmxpYyBDb2x1bW5JTyBnZXRKb2luQ29sdW1uSU8oKSB7CiAgICAgICAg\ncmV0dXJuIChfaW8gPT0gbnVsbCkgPyBDb2x1bW5JTy5VTlJFU1RSSUNURUQg\nOiBfaW87CiAgICB9CgogICAgLyoqCiAgICAgKiBJL08gaW5mb3JtYXRpb24g\nb24gdGhlIGpvaW4gY29sdW1ucy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0Sm9pbkNvbHVtbklPKENvbHVtbklPIGlvKSB7CiAgICAgICAgX2lvID0g\naW87CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JlaWduIGtleSBsaW5raW5n\nIHRoZSBmaWVsZCB0YWJsZSB0byB0aGUgY2xhc3MnIHByaW1hcnkgdGFibGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBGb3JlaWduS2V5IGdldEpvaW5Gb3JlaWdu\nS2V5KCkgewogICAgICAgIHJldHVybiBfZms7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBGb3JlaWduIGtleSBsaW5raW5nIHRoZSBmaWVsZCB0YWJsZSB0byB0\naGUgY2xhc3MnIHByaW1hcnkgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldEpvaW5Gb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAgICAg\nICBfZmsgPSBmazsKICAgIH0KCiAgICAvKioKICAgICAqIFVuaXF1ZSBjb25z\ndHJhaW50IG9uIGpvaW4gZm9yZWlnbiBrZXkgY29sdW1ucy4KICAgICAqLwog\nICAgcHVibGljIFVuaXF1ZSBnZXRKb2luVW5pcXVlKCkgewogICAgICAgIHJl\ndHVybiBfdW5xOwogICAgfQoKICAgIC8qKgogICAgICogVW5pcXVlIGNvbnN0\ncmFpbnQgb24gam9pbiBmb3JlaWduIGtleSBjb2x1bW5zLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRKb2luVW5pcXVlKFVuaXF1ZSB1bnEpIHsKICAg\nICAgICBfdW5xID0gdW5xOwogICAgfQoKICAgIHB1YmxpYyBVbmlxdWVbXSBn\nZXRKb2luVGFibGVVbmlxdWVzKCkgewogICAgCXJldHVybiBfam9pblRhYmxl\nVW5pcXVlczsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0Sm9pblRh\nYmxlVW5pcXVlcyhVbmlxdWVbXSB1bnFzKSB7CiAgICAJX2pvaW5UYWJsZVVu\naXF1ZXMgPSB1bnFzOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEluZGV4\nIG9uIGpvaW4gZm9yZWlnbiBrZXkgY29sdW1ucy4KICAgICAqLwogICAgcHVi\nbGljIEluZGV4IGdldEpvaW5JbmRleCgpIHsKICAgICAgICByZXR1cm4gX2lk\neDsKICAgIH0KCiAgICAvKioKICAgICAqIEluZGV4IG9uIGpvaW4gZm9yZWln\nbiBrZXkgY29sdW1ucy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9p\nbkluZGV4KEluZGV4IGlkeCkgewogICAgICAgIF9pZHggPSBpZHg7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBhbiBvdXRlciBqb2lu\nIGZyb20gdGhlIGNsYXNzJyBwcmltYXJ5IHRhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0pvaW5PdXRlcigpIHsKICAgICAgICByZXR1cm4g\nX291dGVyOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byB1c2Ug\nYW4gb3V0ZXIgam9pbiBmcm9tIHRoZSBjbGFzcycgcHJpbWFyeSB0YWJsZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9pbk91dGVyKGJvb2xlYW4g\nb3V0ZXIpIHsKICAgICAgICBfb3V0ZXIgPSBvdXRlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIEZpZWxkIG9yZGVyIGNvbHVtbiwgaWYgYW55LgogICAgICov\nCiAgICBwdWJsaWMgQ29sdW1uIGdldE9yZGVyQ29sdW1uKCkgewogICAgICAg\nIHJldHVybiBfb3JkZXJDb2wuZ2V0Q29sdW1uKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBGaWVsZCBvcmRlciBjb2x1bW4sIGlmIGFueS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0T3JkZXJDb2x1bW4oQ29sdW1uIG9yZGVyKSB7\nCiAgICAgICAgX29yZGVyQ29sLnNldENvbHVtbihvcmRlcik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJL08gaW5mb3JtYXRpb24gZm9yIG9yZGVyIGNvbHVt\nbi4KICAgICAqLwogICAgcHVibGljIENvbHVtbklPIGdldE9yZGVyQ29sdW1u\nSU8oKSB7CiAgICAgICAgcmV0dXJuIF9vcmRlckNvbC5nZXRDb2x1bW5JTygp\nOwogICAgfQoKICAgIC8qKgogICAgICogSS9PIGluZm9ybWF0aW9uIGZvciBv\ncmRlciBjb2x1bW4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9yZGVy\nQ29sdW1uSU8oQ29sdW1uSU8gaW8pIHsKICAgICAgICBfb3JkZXJDb2wuc2V0\nQ29sdW1uSU8oaW8pOwogICAgfQoKICAgIC8qKgogICAgICogSW5jcmVtZW50\nIHRoZSByZWZlcmVuY2UgY291bnQgb2YgdXNlZCBzY2hlbWEgY29tcG9uZW50\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcmVmU2NoZW1hQ29tcG9uZW50\ncygpIHsKICAgICAgICBpZiAoX2ZrICE9IG51bGwpIHsKICAgICAgICAgICAg\nX2ZrLnJlZigpOwogICAgICAgICAgICBfZmsucmVmQ29sdW1ucygpOwogICAg\nICAgIH0KICAgICAgICBpZiAoX29yZGVyQ29sLmdldENvbHVtbigpICE9IG51\nbGwpCiAgICAgICAgICAgIF9vcmRlckNvbC5nZXRDb2x1bW4oKS5yZWYoKTsK\nICAgICAgICBfdmFsLnJlZlNjaGVtYUNvbXBvbmVudHMoKTsKICAgICAgICBf\na2V5LnJlZlNjaGVtYUNvbXBvbmVudHMoKTsKICAgICAgICBfZWxlbS5yZWZT\nY2hlbWFDb21wb25lbnRzKCk7CiAgICAgICAgaWYgKF9qb2luVGFibGVVbmlx\ndWVzICE9IG51bGwpIHsKICAgICAgICAJZm9yIChVbmlxdWUgam9pblVuaXF1\nZSA6IF9qb2luVGFibGVVbmlxdWVzKSB7CiAgICAgICAgCQlmb3IgKENvbHVt\nbiBjb2wgOiBqb2luVW5pcXVlLmdldENvbHVtbnMoKSkgewogICAgICAgIAkJ\nCWNvbC5yZWYoKTsKICAgICAgICAJCX0KICAgICAgICAJfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIG1hcHBpbmcgaW5mb3JtYXRp\nb24sIGluY2x1ZGluZyBzdHJhdGVneS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgY2xlYXJNYXBwaW5nKCkgewogICAgICAgIF9zdHJhdGVneSA9IG51bGw7\nCiAgICAgICAgX2ZrID0gbnVsbDsKICAgICAgICBfdW5xID0gbnVsbDsKICAg\nICAgICBfaWR4ID0gbnVsbDsKICAgICAgICBfb3V0ZXIgPSBmYWxzZTsKICAg\nICAgICBfb3JkZXJDb2wuc2V0Q29sdW1uKG51bGwpOwogICAgICAgIF92YWwu\nY2xlYXJNYXBwaW5nKCk7CiAgICAgICAgX2tleS5jbGVhck1hcHBpbmcoKTsK\nICAgICAgICBfZWxlbS5jbGVhck1hcHBpbmcoKTsKICAgICAgICBfaW5mby5j\nbGVhcigpOwogICAgICAgIHNldFJlc29sdmUoTU9ERV9NQVBQSU5HLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUge0BsaW5rIE1hcHBp\nbmdJbmZvfSB3aXRoIG91ciBjdXJyZW50IG1hcHBpbmcgaW5mb3JtYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN5bmNNYXBwaW5nSW5mbygpIHsK\nICAgICAgICBpZiAoaXNWZXJzaW9uKCkpIHsKICAgICAgICAgICAgLy8gd2Ug\ncmVseSBvbiB0aGUgZmFjdCB0aGF0IHRoZSB2ZXJzaW9uIHdpbGwgc2V0dXAg\nb3VyIG1hcHBpbmcKICAgICAgICAgICAgLy8gaW5mbyBjb3JyZWN0bHkgd2hl\nbiBpdCBpcyBzeW5jZWQKICAgICAgICB9IGVsc2UgaWYgKGdldE1hcHBlZEJ5\nTWFwcGluZygpICE9IG51bGwpIHsKICAgICAgICAgICAgX2luZm8uY2xlYXIo\nKTsKICAgICAgICAgICAgX3ZhbC5nZXRWYWx1ZUluZm8oKS5jbGVhcigpOwog\nICAgICAgICAgICBfa2V5LmdldFZhbHVlSW5mbygpLmNsZWFyKCk7CiAgICAg\nICAgICAgIF9lbGVtLmdldFZhbHVlSW5mbygpLmNsZWFyKCk7CgogICAgICAg\nICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkID0gZ2V0TWFwcGVkQnlNYXBwaW5n\nKCk7CiAgICAgICAgICAgIF9pbmZvLnN5bmNTdHJhdGVneSh0aGlzKTsKICAg\nICAgICAgICAgaWYgKF9vcmRlckNvbC5nZXRDb2x1bW4oKSAhPSBudWxsCiAg\nICAgICAgICAgICAgICAmJiBtYXBwZWQuZ2V0T3JkZXJDb2x1bW4oKSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX2luZm8uc3luY09yZGVyQ29sdW1uKHRo\naXMpOwogICAgICAgICAgICBfdmFsLmdldFZhbHVlSW5mbygpLnNldFVzZUNs\nYXNzQ3JpdGVyaWEKICAgICAgICAgICAgICAgIChfdmFsLmdldFVzZUNsYXNz\nQ3JpdGVyaWEoKSk7CiAgICAgICAgICAgIF9rZXkuZ2V0VmFsdWVJbmZvKCku\nc2V0VXNlQ2xhc3NDcml0ZXJpYQogICAgICAgICAgICAgICAgKF9rZXkuZ2V0\nVXNlQ2xhc3NDcml0ZXJpYSgpKTsKICAgICAgICAgICAgX2VsZW0uZ2V0VmFs\ndWVJbmZvKCkuc2V0VXNlQ2xhc3NDcml0ZXJpYQogICAgICAgICAgICAgICAg\nKF9lbGVtLmdldFVzZUNsYXNzQ3JpdGVyaWEoKSk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgX2luZm8uc3luY1dpdGgodGhpcyk7CiAgICAgICAg\nICAgIF92YWwuc3luY01hcHBpbmdJbmZvKCk7CiAgICAgICAgICAgIF9rZXku\nc3luY01hcHBpbmdJbmZvKCk7CiAgICAgICAgICAgIF9lbGVtLnN5bmNNYXBw\naW5nSW5mbygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdHJ1ZSBpZiBmaWVsZCBjbGFzcyBkb2VzIG5vdCB1c2UgdGhlICJu\nb25lIiBzdHJhdGVneSAoaW5jbHVkaW5nCiAgICAgKiBpZiBpdCBoYXMgYSBu\ndWxsIHN0cmF0ZWd5LCBhbmQgdGhlcmVmb3JlIGlzIHByb2JhYmx5IGluIHRo\nZSBwcm9jZXNzIG9mCiAgICAgKiBiZWluZyBtYXBwZWQpLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc01hcHBlZCgpIHsKICAgICAgICByZXR1cm4g\nX3N0cmF0ZWd5ICE9IE5vbmVGaWVsZFN0cmF0ZWd5LmdldEluc3RhbmNlKCk7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTWV0\nYURhdGEgaW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgLyoqCiAgICAgKiBUaGUgZWFnZXIgZmV0Y2ggbW9kZSwgYXMgb25lIG9m\nIHRoZSBlYWdlciBjb25zdGFudHMgaW4KICAgICAqIHtAbGluayBKREJDRmV0\nY2hDb25maWd1cmF0aW9ufS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRF\nYWdlckZldGNoTW9kZSgpIHsKICAgICAgICBpZiAoX2ZldGNoTW9kZSA9PSBJ\nbnRlZ2VyLk1BWF9WQUxVRSkKICAgICAgICAgICAgX2ZldGNoTW9kZSA9IEZl\ndGNoQ29uZmlndXJhdGlvbi5ERUZBVUxUOwogICAgICAgIHJldHVybiBfZmV0\nY2hNb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGVhZ2VyIGZldGNo\nIG1vZGUsIGFzIG9uZSBvZiB0aGUgZWFnZXIgY29uc3RhbnRzIGluCiAgICAg\nKiB7QGxpbmsgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbn0uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldEVhZ2VyRmV0Y2hNb2RlKGludCBtb2RlKSB7CiAg\nICAgICAgX2ZldGNoTW9kZSA9IG1vZGU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAg\nICAqIHtAbGluayBGaWVsZE1ldGFEYXRhI2dldFJlcG9zaXRvcnl9CiAgICAg\nKi8KICAgIHB1YmxpYyBNYXBwaW5nUmVwb3NpdG9yeSBnZXRNYXBwaW5nUmVw\nb3NpdG9yeSgpIHsKICAgICAgICByZXR1cm4gKE1hcHBpbmdSZXBvc2l0b3J5\nKSBnZXRSZXBvc2l0b3J5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtA\nbGluayBGaWVsZE1ldGFEYXRhI2dldERlZmluaW5nTWV0YURhdGF9CiAgICAg\nKi8KICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0RGVmaW5pbmdNYXBwaW5n\nKCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nKSBnZXREZWZpbmlu\nZ01ldGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5j\nZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBG\naWVsZE1ldGFEYXRhI2dldERlY2xhcmluZ01ldGFEYXRhfQogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldERlY2xhcmluZ01hcHBpbmcoKSB7\nCiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmcpIGdldERlY2xhcmluZ01l\ndGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBt\nZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20ge0BsaW5rIEZpZWxkTWV0YURh\ndGEjZ2V0S2V5fQogICAgICovCiAgICBwdWJsaWMgVmFsdWVNYXBwaW5nIGdl\ndEtleU1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9rZXk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBj\nYXN0IGZyb20ge0BsaW5rIEZpZWxkTWV0YURhdGEjZ2V0RWxlbWVudH0KICAg\nICAqLwogICAgcHVibGljIFZhbHVlTWFwcGluZyBnZXRFbGVtZW50TWFwcGlu\nZygpIHsKICAgICAgICByZXR1cm4gX2VsZW07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20g\ne0BsaW5rIEZpZWxkTWV0YURhdGEjZ2V0VmFsdWV9CiAgICAgKi8KICAgIHB1\nYmxpYyBWYWx1ZU1hcHBpbmcgZ2V0VmFsdWVNYXBwaW5nKCkgewogICAgICAg\nIHJldHVybiAoVmFsdWVNYXBwaW5nKSBnZXRWYWx1ZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2Fz\ndCBmcm9tCiAgICAgKiB7QGxpbmsgRmllbGRNZXRhRGF0YSNnZXRNYXBwZWRC\neU1ldGFEYXRhfQogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGdl\ndE1hcHBlZEJ5TWFwcGluZygpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFw\ncGluZykgZ2V0TWFwcGVkQnlNZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9t\nCiAgICAgKiB7QGxpbmsgRmllbGRNZXRhRGF0YSNnZXRJbnZlcnNlTWV0YURh\ndGFzfQogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nW10gZ2V0SW52\nZXJzZU1hcHBpbmdzKCkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5n\nW10pIGdldEludmVyc2VNZXRhRGF0YXMoKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiByZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgaW50IGN1ciA9\nIGdldFJlc29sdmUoKTsKICAgICAgICBpZiAoc3VwZXIucmVzb2x2ZShtb2Rl\nKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKChtb2Rl\nICYgTU9ERV9NQVBQSU5HKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkcp\nID09IDApCiAgICAgICAgICAgIHJlc29sdmVNYXBwaW5nKCk7CiAgICAgICAg\naWYgKChtb2RlICYgTU9ERV9NQVBQSU5HX0lOSVQpICE9IDAgJiYgKGN1ciAm\nIE1PREVfTUFQUElOR19JTklUKSA9PSAwKQogICAgICAgICAgICBpbml0aWFs\naXplTWFwcGluZygpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlc29sdmUgdGhlIG1hcHBpbmcgaW5mb3JtYXRpb24g\nZm9yIHRoaXMgZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXNv\nbHZlTWFwcGluZygpIHsKICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBv\ncyA9IGdldE1hcHBpbmdSZXBvc2l0b3J5KCk7CiAgICAgICAgaWYgKHJlcG9z\nLmdldE1hcHBpbmdEZWZhdWx0cygpLmRlZmF1bHRNaXNzaW5nSW5mbygpKSB7\nCiAgICAgICAgICAgIC8vIGNvcHkgZW1iZWRkZWQgdGVtcGxhdGUgbWFwcGlu\nZyBpbmZvCiAgICAgICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSBnZXREZWZp\nbmluZ01hcHBpbmcoKTsKICAgICAgICAgICAgaWYgKGNscy5nZXRFbWJlZGRp\nbmdNYXBwaW5nKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ2xhc3NN\nYXBwaW5nIG9yaWcgPSByZXBvcy5nZXRNYXBwaW5nKGNscy5nZXREZXNjcmli\nZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgY2xzLmdldEVudkNsYXNz\nTG9hZGVyKCksIHRydWUpOwogICAgICAgICAgICAgICAgRmllbGRNYXBwaW5n\nIHRtcGxhdGUgPSBvcmlnLmdldEZpZWxkTWFwcGluZyhnZXROYW1lKCkpOwog\nICAgICAgICAgICAgICAgaWYgKHRtcGxhdGUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBjb3B5TWFwcGluZ0luZm8odG1wbGF0ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gY29weSBzdXBlcmNsYXNzIGZpZWxkIGlu\nZm8KICAgICAgICAgICAgZWxzZSBpZiAoY2xzLmlzTWFwcGVkKCkgJiYgY2xz\nLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwKICAgICAgICAgICAgICAgICYm\nIGNscy5nZXREZXNjcmliZWRUeXBlKCkgIT0gZ2V0RGVjbGFyaW5nVHlwZSgp\nKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmcgc3VwID0gY2xzLmdl\ndFBDU3VwZXJjbGFzc01hcHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRGaWVsZE1hcHBpbmcoZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIGlm\nIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb3B5TWFwcGlu\nZ0luZm8oc3VwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\naWYgKF9zdHJhdGVneSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpc1Zl\ncnNpb24oKSkKICAgICAgICAgICAgICAgIF9zdHJhdGVneSA9IE5vbmVGaWVs\nZFN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIHJlcG9zLmdldFN0cmF0ZWd5SW5zdGFsbGVyKCkuaW5z\ndGFsbFN0cmF0ZWd5KHRoaXMpOwogICAgICAgIH0KICAgICAgICBMb2cgbG9n\nID0gZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpOwogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJmaWVsZC1zdHJhdGVneSIsIGdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgIF9zdHJhdGVneS5nZXRBbGlhcygpKSk7CgogICAgICAgIC8vIG1hcmsg\nbWFwcGVkIGNvbHVtbnMKICAgICAgICBpZiAoX29yZGVyQ29sLmdldENvbHVt\nbigpICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGdldE9yZGVyQ29sdW1u\nSU8oKS5pc0luc2VydGFibGUoMCwgZmFsc2UpKQogICAgICAgICAgICAgICAg\nX29yZGVyQ29sLmdldENvbHVtbigpLnNldEZsYWcoQ29sdW1uLkZMQUdfRElS\nRUNUX0lOU0VSVCwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChnZXRPcmRlckNv\nbHVtbklPKCkuaXNVcGRhdGFibGUoMCwgZmFsc2UpKQogICAgICAgICAgICAg\nICAgX29yZGVyQ29sLmdldENvbHVtbigpLnNldEZsYWcoQ29sdW1uLkZMQUdf\nRElSRUNUX1VQREFURSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlmIChf\nZmsgIT0gbnVsbCkgewogICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gX2Zr\nLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgQ29sdW1uSU8gaW8gPSBnZXRK\nb2luQ29sdW1uSU8oKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaW8u\naXNJbnNlcnRhYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICBj\nb2xzW2ldLnNldEZsYWcoQ29sdW1uLkZMQUdfRktfSU5TRVJULCB0cnVlKTsK\nICAgICAgICAgICAgICAgIGlmIChpby5pc1VwZGF0YWJsZShpLCBmYWxzZSkp\nCiAgICAgICAgICAgICAgICAgICAgY29sc1tpXS5zZXRGbGFnKENvbHVtbi5G\nTEFHX0ZLX1VQREFURSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIF92YWwucmVzb2x2ZShNT0RFX01BUFBJTkcpOwogICAgICAg\nIF9rZXkucmVzb2x2ZShNT0RFX01BUFBJTkcpOwogICAgICAgIF9lbGVtLnJl\nc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\ncHkgbWFwcGluZyBpbmZvIGZyb20gdGhlIGdpdmVuIGluc3RhbmNlIHRvIHRo\naXMgb25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjb3B5TWFwcGluZ0lu\nZm8oRmllbGRNYXBwaW5nIGZtKSB7CiAgICAgICAgc2V0TWFwcGVkQnkoZm0u\nZ2V0TWFwcGVkQnkoKSk7CiAgICAgICAgX2luZm8uY29weShmbS5nZXRNYXBw\naW5nSW5mbygpKTsKICAgICAgICBfdmFsLmNvcHlNYXBwaW5nSW5mbyhmbS5n\nZXRWYWx1ZU1hcHBpbmcoKSk7CiAgICAgICAgX2tleS5jb3B5TWFwcGluZ0lu\nZm8oZm0uZ2V0S2V5TWFwcGluZygpKTsKICAgICAgICBfZWxlbS5jb3B5TWFw\ncGluZ0luZm8oZm0uZ2V0RWxlbWVudE1hcHBpbmcoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQcmVwYXJlIG1hcHBpbmcgZm9yIHJ1bnRpbWUgdXNlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgaW5pdGlhbGl6ZU1hcHBpbmcoKSB7\nCiAgICAgICAgX3ZhbC5yZXNvbHZlKE1PREVfTUFQUElOR19JTklUKTsKICAg\nICAgICBfa2V5LnJlc29sdmUoTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAg\nIF9lbGVtLnJlc29sdmUoTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAgIGlm\nIChfc3RyYXRlZ3kgIT0gbnVsbCkKICAgICAgICAgICAgX3N0cmF0ZWd5Lmlu\naXRpYWxpemUoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb3B5KEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgc3VwZXIuY29weShmbWQpOwogICAg\nICAgIGlmIChfZmV0Y2hNb2RlID09IEludGVnZXIuTUFYX1ZBTFVFKQogICAg\nICAgICAgICBfZmV0Y2hNb2RlID0gKChGaWVsZE1hcHBpbmcpIGZtZCkuZ2V0\nRWFnZXJGZXRjaE1vZGUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiB2YWxpZGF0ZURhdGFTdG9yZUV4dGVuc2lvblByZWZpeChTdHJpbmcgcHJl\nZml4KSB7CiAgICAgICAgcmV0dXJuICJqZGJjLSIuZXF1YWxzKHByZWZpeCk7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIEZpZWxkU3RyYXRlZ3kgaW1wbGVtZW50YXRpb24KICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIFN0cmlu\nZyBnZXRBbGlhcygpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3ko\nKS5nZXRBbGlhcygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG1hcChib29s\nZWFuIGFkYXB0KSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5tYXAoYWRh\ncHQpOwogICAgfQoKICAgIC8qKgogICAgICogTWFwIHRoaXMgZmllbGQgdG8g\naXRzIHRhYmxlLCBvcHRpb25hbGx5IHJlcXVpcmluZyB0aGF0IGl0IGJlCiAg\nICAgKiBpbiBhbm90aGVyIHRhYmxlLiBVdGlsaXR5IG1ldGhvZCBmb3IgdXNl\nIGJ5IG1hcHBpbmcgc3RyYXRlZ2llcy4KICAgICAqLwogICAgcHVibGljIHZv\naWQgbWFwSm9pbihib29sZWFuIGFkYXB0LCBib29sZWFuIGpvaW5SZXF1aXJl\nZCkgewogICAgICAgIFRhYmxlIHRhYmxlID0gX2luZm8uZ2V0VGFibGUodGhp\ncywgam9pblJlcXVpcmVkLCBhZGFwdCk7CgogICAgICAgIGlmKHRhYmxlICE9\nIG51bGwgJiYgdGFibGUuZXF1YWxzKGdldERlZmluaW5nTWFwcGluZygpLmdl\ndFRhYmxlKCkpKSB7CiAgICAgICAgICAgIC8vIERvbid0IGNyZWF0ZSBhIGpv\naW4gaWYgdGhlIGZpZWxkJ3MgdGFibGUgaXMgdGhlIHNhbWUgYXMgdGhlCiAg\nICAgICAgICAgIC8vIGNsYXNzJ3MgdGFibGUuIAogICAgICAgICAgICB0YWJs\nZSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBGb3JlaWduS2V5IGpvaW4g\nPSBudWxsOwogICAgICAgIGlmICh0YWJsZSAhPSBudWxsKQogICAgICAgICAg\nICBqb2luID0gX2luZm8uZ2V0Sm9pbih0aGlzLCB0YWJsZSwgYWRhcHQpOwog\nICAgICAgIGlmIChqb2luID09IG51bGwgJiYgam9pblJlcXVpcmVkKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImpvaW4tcmVxdWlyZWQiLCB0aGlzKSk7CgogICAgICAgIGlmIChqb2luID09\nIG51bGwpIHsKICAgICAgICAgICAgX2luZm8uYXNzZXJ0Tm9Kb2luKHRoaXMs\nIHRydWUpOwogICAgICAgICAgICBfaW5mby5hc3NlcnROb0ZvcmVpZ25LZXko\ndGhpcywgIWFkYXB0KTsKICAgICAgICAgICAgX2luZm8uYXNzZXJ0Tm9Vbmlx\ndWUodGhpcywgIWFkYXB0KTsKICAgICAgICAgICAgX2luZm8uYXNzZXJ0Tm9J\nbmRleCh0aGlzLCAhYWRhcHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIF9mayA9IGpvaW47CiAgICAgICAgICAgIF9pbyA9IF9pbmZvLmdldENv\nbHVtbklPKCk7CiAgICAgICAgICAgIF9vdXRlciA9IF9pbmZvLmlzSm9pbk91\ndGVyKCk7CiAgICAgICAgICAgIF91bnEgPSBfaW5mby5nZXRKb2luVW5pcXVl\nKHRoaXMsIGZhbHNlLCBhZGFwdCk7CiAgICAgICAgICAgIF9qb2luVGFibGVV\nbmlxdWVzID0gX2luZm8uZ2V0Sm9pblRhYmxlVW5pcXVlcyh0aGlzLCBmYWxz\nZSwgYWRhcHQpOwogICAgICAgICAgICBfaWR4ID0gX2luZm8uZ2V0Sm9pbklu\nZGV4KHRoaXMsIGFkYXB0KTsKICAgICAgICAgICAgdGFibGUuc2V0QXNzb2Np\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXBz\nIHRoZSBwcmltYXJ5IGtleSBvbiB0aGUgc2Vjb25kYXJ5IHRhYmxlIGZvciB0\naGlzIGZpZWxkLCBpZiB0aGUKICAgICAqIHVzZXIncyBkZWZhdWx0cyBjcmVh\ndGUgb25lLiBUaGlzIG11c3QgYmUgY2FsbGVkIGFmdGVyCiAgICAgKiB0aGlz\nIGZpZWxkIGlzIG1hcHBlZCBzbyB0aGF0IGl0J3MgdGFibGUgaGFzIGl0cyBj\nb2x1bW5zIHNldC4KICAgICAqLwogICAgcHVibGljIHZvaWQgbWFwUHJpbWFy\neUtleShib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKGFkYXB0ICYmIF9m\nayAhPSBudWxsICYmIF9may5nZXRUYWJsZSgpLmdldFByaW1hcnlLZXkoKSA9\nPSBudWxsKQogICAgICAgICAgICBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdl\ndE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgaW5zdGFsbFBy\naW1hcnlLZXkodGhpcywgX2ZrLmdldFRhYmxlKCkpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGluaXRpYWxpemUoKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRl\nZ3koKS5pbml0aWFsaXplKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5z\nZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwg\nUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgIAlzZXRQS1ZhbHVlRnJvbU1hcHBlZEJ5SWRGaWVsZChzbSk7CiAgICAg\nICAgYXNzZXJ0U3RyYXRlZ3koKS5pbnNlcnQoc20sIHN0b3JlLCBybSk7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIHNldFBLVmFsdWVGcm9tTWFwcGVkQnlJ\nZEZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBpZiAo\nc20gaW5zdGFuY2VvZiBTdGF0ZU1hbmFnZXJJbXBsKSB7CiAgICAgICAgICAg\nIExpc3QgbWFwcGVkQnlJZEZpZWxkcyA9ICgoU3RhdGVNYW5hZ2VySW1wbClz\nbSkuCiAgICAgICAgICAgICAgICBnZXRNYXBwZWRCeUlkRmllbGRzKCk7CiAg\nICAgICAgICAgIGlmIChtYXBwZWRCeUlkRmllbGRzID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICghbWFwcGVkQnlJ\nZEZpZWxkcy5jb250YWlucyh0aGlzKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgaWYgKCFpc01hcHBlZEJ5SWQoKSkgCiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpc20uCiAgICAgICAgICAgICAg\nICBmZXRjaE9iamVjdChnZXRJbmRleCgpKTsKICAgICAgICAgICAgaWYgKHBj\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgcGtTbSA9IChTdGF0ZU1hbmFnZXJJbXBsKXBj\nLgogICAgICAgICAgICAgICAgcGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAg\nICAgICAgT2JqZWN0IHBrVmFsID0gZ2V0UEtWYWx1ZShwa1NtKTsKICAgICAg\nICAgICAgaWYgKHBrVmFsID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIHNldFBLVmFsdWUoKFN0YXRlTWFuYWdlckltcGwp\nc20sIHBrVmFsKTsKICAgICAgICAgICAgc20uc2V0T2JqZWN0SWQoCiAgICAg\nICAgICAgIEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShzbS5nZXRQZXJzaXN0ZW5j\nZUNhcGFibGUoKSwgCiAgICAgICAgICAgICAgICBzbS5nZXRNZXRhRGF0YSgp\nKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcml2YXRlIE9iamVjdCBn\nZXRQS1ZhbHVlKFN0YXRlTWFuYWdlckltcGwgcGtTbSkgewogICAgICAgIENs\nYXNzTWV0YURhdGEgcGtNZXRhID0gcGtTbS5nZXRNZXRhRGF0YSgpOwogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gcGtNZXRhLmdldFByaW1hcnlL\nZXlGaWVsZHMoKTsKICAgICAgICAvLyBNYXBwZWRCeUlkIGlzIGZvciBzaW5n\nbGUgdmFsdWUgcHJpbWFyeSBrZXkgb3IgZW1iZWRkYWJsZSBpZAogICAgICAg\nIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBlbHNlIAogICAgICAgICAgICByZXR1cm4gQXBwbGljYXRp\nb25JZHMuZ2V0S2V5KHBrU20uZ2V0T2JqZWN0SWQoKSwgcGtNZXRhKTsKICAg\nIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIHNldFBLVmFsdWUoU3RhdGVNYW5h\nZ2VySW1wbCBzbSwgT2JqZWN0IHBrVmFsKSB7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwog\nICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIFN0cmF0ZWd5IHN0cmF0ID0gKChGaWVsZE1hcHBpbmcp\nZm1kc1swXSkuZ2V0U3RyYXRlZ3koKTsKICAgICAgICAvLyBzaW5nbGUgdmFs\ndWUgcHJpbWFyeSBrZXkKICAgICAgICBpZiAoc3RyYXQgaW5zdGFuY2VvZiBQ\ncmltaXRpdmVGaWVsZFN0cmF0ZWd5KSAKICAgICAgICAgICAgKChQcmltaXRp\ndmVGaWVsZFN0cmF0ZWd5KXN0cmF0KS5zZXRBdXRvQXNzaWduZWRWYWx1ZShz\nbSwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgcGtWYWwpOwogICAgICAgIGVs\nc2UgewogICAgICAgICAgICAvL2NvbXBvc2l0ZSBrZXkKICAgICAgICAgICAg\nU3RyaW5nIG1hcHBlZEJ5SWRGaWVsZE5hbWUgPSBnZXRNYXBwZWRCeUlkVmFs\ndWUoKTsKICAgICAgICAgICAgaWYgKG1hcHBlZEJ5SWRGaWVsZE5hbWUgIT0g\nbnVsbCAmJiAKICAgICAgICAgICAgICAgIG1hcHBlZEJ5SWRGaWVsZE5hbWUu\nbGVuZ3RoKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAvL1RoZSBuYW1lIG9m\nIHRoZSBhdHRyaWJ1dGUgd2l0aGluIHRoZSBjb21wb3NpdGUga2V5IHRvIHdo\naWNoIAogICAgICAgICAgICAgICAgLy90aGUgcmVsYXRpb25zaGlwIGF0dHJp\nYnV0ZSBjb3JyZXNwb25kcy4KICAgICAgICAgICAgICAgIE9iamVjdCB0YXJn\nZXQgPSAoKE9iamVjdElkKXNtLmdldE9iamVjdElkKCkpLmdldElkKCk7CiAg\nICAgICAgICAgICAgICBpZiAodGFyZ2V0ID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgc2V0TWFwcGVkQnlJ\nZFZhbHVlKHRhcmdldCwgcGtWYWwsIG1hcHBlZEJ5SWRGaWVsZE5hbWUpOwog\nICAgICAgICAgICAgICAgcGtWYWwgPSB0YXJnZXQ7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc20uc3RvcmVPYmplY3RGaWVsZChmbWRzWzBdLmdldElu\nZGV4KCksIHBrVmFsKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIHNldE1hcHBlZEJ5SWRWYWx1ZShPYmplY3QgdGFyZ2V0LCAKICAg\nICAgICBPYmplY3QgdmFsLCBTdHJpbmcgbWFwcGVkQnlJZEZpZWxkTmFtZSkg\newogICAgICAgIFJlZmxlY3Rpb24uc2V0KHRhcmdldCwgCiAgICAgICAgICAg\nIFJlZmxlY3Rpb24uZmluZEZpZWxkKHRhcmdldC5nZXRDbGFzcygpLCBtYXBw\nZWRCeUlkRmllbGROYW1lLCB0cnVlKSwgCiAgICAgICAgICAgIHZhbCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgdXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVn\neSgpLnVwZGF0ZShzbSwgc3RvcmUsIHJtKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBkZWxldGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3Jl\nIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuZGVsZXRlKHNtLCBz\ndG9yZSwgcm0pOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZXRlIHRoZSBy\nb3cgZm9yIHRoaXMgb2JqZWN0IGlmIHRoZSByZWZlcmVuY2UgZm9yZWlnbiBr\nZXkgZXhpc3RzLgogICAgICogVXRpbGl0eSBtZXRob2QgZm9yIHVzZSBieSBt\nYXBwaW5nIHN0cmF0ZWdpZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGRl\nbGV0ZVJvdyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3Rv\ncmUsCiAgICAgICAgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2ZrICE9IG51bGwpIHsKICAgICAg\nICAgICAgUm93IHJvdyA9IHJtLmdldFJvdyhnZXRUYWJsZSgpLCBSb3cuQUNU\nSU9OX0RFTEVURSwgc20sIHRydWUpOwogICAgICAgICAgICByb3cud2hlcmVG\nb3JlaWduS2V5KF9maywgc20pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgcm93IHRvIHVzZSBmb3IgdGhpcyBmaWVsZC4g\nVGhpcyBtZXRob2QgaXMgbWVhbnQgb25seSBmb3IKICAgICAqIHNpbmdsZS12\nYWx1ZSBmaWVsZHMgdGhhdCBtaWdodCByZXNpZGUgaW4gYSB0YWJsZSB0aGF0\nIGlzIGpvaW5lZCB0bwogICAgICogdGhlIHByaW1hcnkgdGFibGUgdGhyb3Vn\naCB0aGUgam9pbiBmb3JlaWduIGtleS4gSXQgaXMgbm90CiAgICAgKiBtZWFu\ndCBmb3IgbXVsdGktdmFsdWVkIGZpZWxkcyBsaWtlIGNvbGxlY3Rpb25zIGFu\nZCBtYXBzLiBUaGUgbWV0aG9kCiAgICAgKiBjaGVja3Mgd2hldGhlciB3ZSdy\nZSB1c2luZyBhbiBvdXRlciBqb2luIGFuZCBpZiBzbyBpdCBkZWxldGVzIHRo\nZQogICAgICogZmllbGQncyBwcmV2aW91cyB2YWx1ZSwgdGhlbiBpZiB0aGUg\nZmllbGQgaXMgbm9uLW51bGwgcmV0dXJucyBhbiBpbnNlcnQKICAgICAqIHJv\ndyBmb3IgdGhlIG5ldyB2YWx1ZS4gVGhlIGpvaW4gZm9yZWlnbiBrZXkgd2ls\nbCBhbHJlYWR5IGJlIHNldCBvbgogICAgICogdGhlIHJldHVybmVkIHJvdzsg\nbWFwcGluZyBzdHJhdGVnaWVzIGp1c3QgbmVlZCB0byBzZXQgdGhlaXIgb3du\nIHZhbHVlcy4KICAgICAqIFV0aWxpdHkgbWV0aG9kIGZvciB1c2UgYnkgbWFw\ncGluZyBzdHJhdGVnaWVzLgogICAgICovCiAgICBwdWJsaWMgUm93IGdldFJv\ndyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJv\nd01hbmFnZXIgcm0sCiAgICAgICAgaW50IGFjdGlvbikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBSb3cgcm93ID0gbnVsbDsKICAg\nICAgICBib29sZWFuIG5ld091dGVyUm93ID0gZmFsc2U7CiAgICAgICAgaWYg\nKF9mayAhPSBudWxsICYmIF9vdXRlciAmJiBhY3Rpb24gIT0gUm93LkFDVElP\nTl9ERUxFVEUpIHsKICAgICAgICAgICAgLy8gaWYgdXBkYXRpbmcgd2l0aCBv\ndXRlciBqb2luLCBkZWxldGUgb2xkIHZhbHVlIGZpcnN0LCB0aGVuIGluc2Vy\ndDsKICAgICAgICAgICAgLy8gd2UgY2FuJ3QganVzdCB1cGRhdGUgYi9jIHRo\nZSByb3cgbWlnaHQgbm90IGV4aXN0CiAgICAgICAgICAgIGlmIChhY3Rpb24g\nPT0gUm93LkFDVElPTl9VUERBVEUpIHsKICAgICAgICAgICAgICAgIC8vIG1h\neWJlIHNvbWUgb3RoZXIgZmllbGQgYWxyZWFkeSBpcyB1cGRhdGluZz8KICAg\nICAgICAgICAgICAgIHJvdyA9IHJtLmdldFJvdyhnZXRUYWJsZSgpLCBSb3cu\nQUNUSU9OX1VQREFURSwgc20sIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlm\nIChyb3cgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIFJvdyBkZWwg\nPSBybS5nZXRSb3coZ2V0VGFibGUoKSwgUm93LkFDVElPTl9ERUxFVEUsIHNt\nLAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBkZWwud2hlcmVGb3JlaWduS2V5KF9maywgc20pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nIHJvdyA9IHJtLmdldFJvdyhnZXRUYWJsZSgpLCBSb3cuQUNUSU9OX0lOU0VS\nVCwgc20sIGZhbHNlKTsKCiAgICAgICAgICAgIC8vIG9ubHkgdXBkYXRlL2lu\nc2VydCBpZiB0aGUgcm93IGV4aXN0cyBhbHJlYWR5IG9yIHRoZSB2YWx1ZSBp\ncwogICAgICAgICAgICAvLyBub3QgbnVsbC9kZWZhdWx0CiAgICAgICAgICAg\nIGlmIChyb3cgPT0gbnVsbCAmJiAhaXNOdWxsVmFsdWUoc20pKSB7CiAgICAg\nICAgICAgICAgICByb3cgPSBybS5nZXRSb3coZ2V0VGFibGUoKSwgUm93LkFD\nVElPTl9JTlNFUlQsIHNtLCB0cnVlKTsKICAgICAgICAgICAgICAgIG5ld091\ndGVyUm93ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZQog\nICAgICAgICAgICByb3cgPSBybS5nZXRSb3coZ2V0VGFibGUoKSwgYWN0aW9u\nLCBzbSwgdHJ1ZSk7CgogICAgICAgIC8vIHNldHVwIGZrCiAgICAgICAgaWYg\nKHJvdyAhPSBudWxsICYmIF9mayAhPSBudWxsKSB7CiAgICAgICAgICAgIGlm\nIChyb3cuZ2V0QWN0aW9uKCkgPT0gUm93LkFDVElPTl9JTlNFUlQpCiAgICAg\nICAgICAgICAgICByb3cuc2V0Rm9yZWlnbktleShfZmssIF9pbywgc20pOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByb3cud2hlcmVGb3Jl\naWduS2V5KF9maywgc20pOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBh\nIG5ldyBvdXRlciBqb2luZWQgcm93LCBtYXJrIGl0IGludmFsaWQgdW50aWwK\nICAgICAgICAgICAgLy8gc29tZSBtYXBwaW5nIGFjdHVhbGx5IHNldHMgaW5m\nb3JtYXRpb24gb24gaXQKICAgICAgICAgICAgaWYgKG5ld091dGVyUm93KQog\nICAgICAgICAgICAgICAgcm93LnNldFZhbGlkKGZhbHNlKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHJvdzsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0cnVlIGlmIHRoaXMgZmllbGQgaXMgbnVsbC9kZWZhdWx0IGluIHRo\nZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIGlzTnVsbFZhbHVlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAg\nICBzd2l0Y2ggKGdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIHJldHVybiAhc20u\nZmV0Y2hCb29sZWFuKGdldEluZGV4KCkpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIHNtLmZldGNo\nQnl0ZShnZXRJbmRleCgpKSA9PSAwOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIHNtLmZldGNoQ2hh\ncihnZXRJbmRleCgpKSA9PSAwOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5ET1VCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hEb3Vi\nbGUoZ2V0SW5kZXgoKSkgPT0gMDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hGbG9h\ndChnZXRJbmRleCgpKSA9PSAwOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hJbnQoZ2V0\nSW5kZXgoKSkgPT0gMDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nRzoKICAgICAgICAgICAgICAgIHJldHVybiBzbS5mZXRjaExvbmcoZ2V0SW5k\nZXgoKSkgPT0gMDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hTaG9ydChnZXRJbmRl\neCgpKSA9PSAwOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6\nCiAgICAgICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hTdHJpbmcoZ2V0SW5k\nZXgoKSkgPT0gbnVsbDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIHJldHVybiBzbS5mZXRjaE9iamVjdChnZXRJbmRleCgpKSA9PSBu\ndWxsOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQm9vbGVhbiBpc0N1\nc3RvbUluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUg\nc3RvcmUpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5pc0N1\nc3RvbUluc2VydChzbSwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyBCb29s\nZWFuIGlzQ3VzdG9tVXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpE\nQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVn\neSgpLmlzQ3VzdG9tVXBkYXRlKHNtLCBzdG9yZSk7CiAgICB9CgogICAgcHVi\nbGljIEJvb2xlYW4gaXNDdXN0b21EZWxldGUoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgcmV0dXJuIGFzc2Vy\ndFN0cmF0ZWd5KCkuaXNDdXN0b21EZWxldGUoc20sIHN0b3JlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBjdXN0b21JbnNlcnQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tSW5z\nZXJ0KHNtLCBzdG9yZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY3VzdG9t\nVXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9y\nZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3Nl\ncnRTdHJhdGVneSgpLmN1c3RvbVVwZGF0ZShzbSwgc3RvcmUpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGN1c3RvbURlbGV0ZShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5jdXN0b21EZWxl\ndGUoc20sIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGaWVs\nZE1hcHBpbmcoRmllbGRNYXBwaW5nIG93bmVyKSB7CiAgICAgICAgYXNzZXJ0\nU3RyYXRlZ3koKS5zZXRGaWVsZE1hcHBpbmcob3duZXIpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgc3VwcG9ydHNTZWxlY3QoU2VsZWN0IHNlbCwgaW50IHR5\ncGUsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuc3VwcG9ydHNTZWxlY3Qoc2Vs\nLCB0eXBlLCBzbSwgc3RvcmUsIGZldGNoKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZWxlY3RFYWdlclBhcmFsbGVsKFNlbGVjdEV4ZWN1dG9yIHNlbCwg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJDU3RvcmUgc3Rv\ncmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlck1v\nZGUpIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLnNlbGVjdEVhZ2VyUGFy\nYWxsZWwoc2VsLCBzbSwgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdEVhZ2VySm9pbihTZWxlY3Qgc2Vs\nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nTW9kZSkgewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuc2VsZWN0RWFnZXJK\nb2luKHNlbCwgc20sIHN0b3JlLCBmZXRjaCwgZWFnZXJNb2RlKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0VhZ2VyU2VsZWN0VG9NYW55KCkgewog\nICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmlzRWFnZXJTZWxlY3RU\nb01hbnkoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdChTZWxlY3Qg\nc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVh\nZ2VyTW9kZSkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLnNl\nbGVjdChzZWwsIHNtLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW55IGpvaW5zIG5lZWRlZCB0byBn\nZXQgZnJvbSB0aGUgcHJpbWFyeSB0YWJsZSB0byB0aGlzIHRhYmxlLgogICAg\nICovCiAgICBwdWJsaWMgSm9pbnMgam9pbihTZWxlY3Qgc2VsKSB7CiAgICAg\nICAgaWYgKF9mayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgSm9pbnMgam9pbnMgPSBzZWwubmV3Sm9pbnMoKTsKICAgICAg\nICBpZiAoX291dGVyKQogICAgICAgICAgICByZXR1cm4gam9pbnMub3V0ZXJK\nb2luKF9maywgdHJ1ZSwgZmFsc2UpOwogICAgICAgIHJldHVybiBqb2lucy5q\nb2luKF9maywgdHJ1ZSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIGEgPGNvZGU+d2hlcmVQcmltYXJ5S2V5PC9jb2RlPiBvciA8Y29kZT53\naGVyZUZvcmVpZ25LZXk8L2NvZGU+CiAgICAgKiBjb25kaXRpb24gdG8gdGhl\nIGdpdmVuIHNlbGVjdCwgZGVwZW5kaW5nIG9uIHdoZXRoZXIgd2UgaGF2ZSBh\nIGpvaW4KICAgICAqIGZvcmVpZ24ga2V5LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCB3aGVyZVByaW1hcnlLZXkoU2VsZWN0IHNlbCwgT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAg\nICBpZiAoX2ZrICE9IG51bGwpCiAgICAgICAgICAgIHNlbC53aGVyZUZvcmVp\nZ25LZXkoX2ZrLCBzbS5nZXRPYmplY3RJZCgpLCBnZXREZWZpbmluZ01hcHBp\nbmcoKSwKICAgICAgICAgICAgICAgIHN0b3JlKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQo\nKSwgZ2V0RGVmaW5pbmdNYXBwaW5nKCksCiAgICAgICAgICAgICAgICBzdG9y\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgb3JkZXJpbmcgdG8gdGhl\nIGdpdmVuIHNlbGVjdCBmb3IgYWxsIG5vbi1yZWxhdGlvbiBvcmRlciB2YWx1\nZXMsCiAgICAgKiBpbmNsdWRpbmcgdGhlIHN5bnRoZXRpYyBvcmRlciBjb2x1\nbW4sIGlmIGFueS4KICAgICAqCiAgICAgKiBAcGFyYW0gZWxlbSB0aGUgcmVs\nYXRlZCB0eXBlIHdlJ3JlIGZldGNoaW5nLCBvciBudWxsCiAgICAgKiBAcGFy\nYW0gam9pbnMgdGhlIGpvaW5zIHRvIHRoaXMgZmllbGQncyB0YWJsZQogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBvcmRlckxvY2FsKFNlbGVjdCBzZWwsIENs\nYXNzTWFwcGluZyBlbGVtLCBKb2lucyBqb2lucykgewogICAgICAgIF9vcmRl\nckNvbC5vcmRlcihzZWwsIGVsZW0sIGpvaW5zKTsKICAgICAgICBKREJDT3Jk\nZXJbXSBvcmRlcnMgPSAoSkRCQ09yZGVyW10pIGdldE9yZGVycygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgb3JkZXJzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoIW9yZGVyc1tpXS5pc0luUmVsYXRpb24oKSkKICAg\nICAgICAgICAgICAgIG9yZGVyc1tpXS5vcmRlcihzZWwsIGVsZW0sIGpvaW5z\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBvcmRlcmluZyB0byB0aGUg\nZ2l2ZW4gc2VsZWN0IGZvciBhbGwgcmVsYXRpb24tYmFzZWQgdmFsdWVzLgog\nICAgICoKICAgICAqIEBwYXJhbSBlbGVtIHRoZSByZWxhdGVkIHR5cGUgd2Un\ncmUgZmV0Y2hpbmcKICAgICAqIEBwYXJhbSBqb2lucyB0aGUgam9pbnMgYWNy\nb3NzIHRoZSByZWxhdGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBvcmRl\nclJlbGF0aW9uKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBlbGVtLCBKb2lu\ncyBqb2lucykgewogICAgICAgIEpEQkNPcmRlcltdIG9yZGVycyA9IChKREJD\nT3JkZXJbXSkgZ2V0T3JkZXJzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBvcmRlcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChvcmRl\ncnNbaV0uaXNJblJlbGF0aW9uKCkpCiAgICAgICAgICAgICAgICBvcmRlcnNb\naV0ub3JkZXIoc2VsLCBlbGVtLCBqb2lucyk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBsb2FkRWFnZXJQYXJhbGxlbChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgT2JqZWN0IHJlcykKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5s\nb2FkRWFnZXJQYXJhbGxlbChzbSwgc3RvcmUsIGZldGNoLCByZXMpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGxvYWRFYWdlckpvaW4oT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5s\nb2FkRWFnZXJKb2luKHNtLCBzdG9yZSwgZmV0Y2gsIHJlcyk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBK\nREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgUmVzdWx0IHJlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmxvYWQoc20sIHN0b3Jl\nLCBmZXRjaCwgcmVzKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkubG9h\nZChzbSwgc3RvcmUsIGZldGNoKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIHRvRGF0YVN0b3JlVmFsdWUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3Jl\nKSB7CiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkudG9EYXRhU3Rv\ncmVWYWx1ZSh2YWwsIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIHRvS2V5RGF0YVN0b3JlVmFsdWUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0\nb3JlKSB7CiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkudG9LZXlE\nYXRhU3RvcmVWYWx1ZSh2YWwsIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBhcHBlbmRJc0VtcHR5KFNRTEJ1ZmZlciBzcWwsIFNlbGVjdCBzZWws\nIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5hcHBl\nbmRJc0VtcHR5KHNxbCwgc2VsLCBqb2lucyk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYXBwZW5kSXNOb3RFbXB0eShTUUxCdWZmZXIgc3FsLCBTZWxlY3Qg\nc2VsLCBKb2lucyBqb2lucykgewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCku\nYXBwZW5kSXNOb3RFbXB0eShzcWwsIHNlbCwgam9pbnMpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGFwcGVuZElzTnVsbChTUUxCdWZmZXIgc3FsLCBTZWxl\nY3Qgc2VsLCBKb2lucyBqb2lucykgewogICAgICAgIGFzc2VydFN0cmF0ZWd5\nKCkuYXBwZW5kSXNOdWxsKHNxbCwgc2VsLCBqb2lucyk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYXBwZW5kSXNOb3ROdWxsKFNRTEJ1ZmZlciBzcWwsIFNl\nbGVjdCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRl\nZ3koKS5hcHBlbmRJc05vdE51bGwoc3FsLCBzZWwsIGpvaW5zKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRTaXplKFNRTEJ1ZmZlciBzcWwsIFNl\nbGVjdCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRl\nZ3koKS5hcHBlbmRTaXplKHNxbCwgc2VsLCBqb2lucyk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYXBwZW5kSW5kZXgoU1FMQnVmZmVyIHNxbCwgU2VsZWN0\nIHNlbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgp\nLmFwcGVuZEluZGV4KHNxbCwgc2VsLCBqb2lucyk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYXBwZW5kVHlwZShTUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2Vs\nLCBKb2lucyBqb2lucykgewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuYXBw\nZW5kVHlwZShzcWwsIHNlbCwgam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyBK\nb2lucyBqb2luKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIpIHsK\nICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5qb2luKGpvaW5zLCBm\nb3JjZU91dGVyKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbktleShK\nb2lucyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyKSB7CiAgICAgICAgcmV0\ndXJuIGFzc2VydFN0cmF0ZWd5KCkuam9pbktleShqb2lucywgZm9yY2VPdXRl\ncik7CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihKb2lu\ncyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyLAogICAgICAgIGJvb2xlYW4g\ndHJhdmVyc2UpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5q\nb2luUmVsYXRpb24oam9pbnMsIGZvcmNlT3V0ZXIsIHRyYXZlcnNlKTsKICAg\nIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbktleVJlbGF0aW9uKEpvaW5zIGpv\naW5zLCBib29sZWFuIGZvcmNlT3V0ZXIsCiAgICAgICAgYm9vbGVhbiB0cmF2\nZXJzZSkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmpvaW5L\nZXlSZWxhdGlvbihqb2lucywgZm9yY2VPdXRlciwgdHJhdmVyc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogSm9pbnMgZnJvbSB0aGUgb3duaW5nIGNsYXNz\nJyB0YWJsZSB0byB0aGUgdGFibGUgd2hlcmUgdGhpcyBmaWVsZCBsaWVzCiAg\nICAgKiB1c2luZyB0aGUgam9pbiBmb3JlaWduIGtleS4gVXRpbGl0eSBtZXRo\nb2QgZm9yIHVzZSBieSBtYXBwaW5nIHN0cmF0ZWdpZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNl\nT3V0ZXIsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgaWYgKF9mayA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gam9pbnM7CiAgICAgICAgaWYgKF9v\ndXRlciB8fCBmb3JjZU91dGVyKQogICAgICAgICAgICByZXR1cm4gam9pbnMu\nb3V0ZXJKb2luKF9maywgdHJ1ZSwgdG9NYW55KTsKICAgICAgICByZXR1cm4g\nam9pbnMuam9pbihfZmssIHRydWUsIHRvTWFueSk7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBsb2FkUHJvamVjdGlvbihKREJDU3RvcmUgc3RvcmUsIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgUmVzdWx0IHJl\ncywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAJLy8gT1BFTkpQQS02NjI6IFZlcnNpb24gZmllbGRzIGhhdmUgTm9u\nZUZpZWxkU3RyYXRlZ3kgLS0gaGVuY2UgdGhleQogICAgCS8vIG5lZWQgc3Bl\nY2lhbCB0cmVhdG1lbnQKICAgIAlpZiAoaXNWZXJzaW9uKCkpIHsKICAgIAkJ\ncmV0dXJuIGdldERlZmluaW5nTWFwcGluZygpLmdldFZlcnNpb24oKS5sb2Fk\nKG51bGwsIHN0b3JlLCByZXMpOwogICAgCX0KICAgICAgICByZXR1cm4gYXNz\nZXJ0U3RyYXRlZ3koKS5sb2FkUHJvamVjdGlvbihzdG9yZSwgZmV0Y2gsIHJl\ncywgam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZEtleVBy\nb2plY3Rpb24oSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBh\nc3NlcnRTdHJhdGVneSgpCiAgICAgICAgICAgIC5sb2FkS2V5UHJvamVjdGlv\nbihzdG9yZSwgZmV0Y2gsIHJlcywgam9pbnMpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzVmVyc2lvbmFibGUoKSB7CiAgICAgICAgcmV0dXJuIGFz\nc2VydFN0cmF0ZWd5KCkuaXNWZXJzaW9uYWJsZSgpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHdoZXJlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNT\ndG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSwKICAgICAgICBPYmplY3QgcHJl\ndlZhbHVlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGFzc2VydFN0cmF0ZWd5KCkud2hlcmUoc20sIHN0b3JlLCBybSwgcHJldlZh\nbHVlKTsKICAgIH0KCiAgICBwcml2YXRlIEZpZWxkU3RyYXRlZ3kgYXNzZXJ0\nU3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKF9zdHJhdGVneSA9PSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAg\nICAgICByZXR1cm4gX3N0cmF0ZWd5OwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFZhbHVlTWFwcGluZyBpbXBs\nZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBWYWx1ZU1hcHBpbmdJbmZvIGdldFZhbHVlSW5mbygp\nIHsKICAgICAgICByZXR1cm4gX3ZhbC5nZXRWYWx1ZUluZm8oKTsKICAgIH0K\nCiAgICBwdWJsaWMgVmFsdWVIYW5kbGVyIGdldEhhbmRsZXIoKSB7CiAgICAg\nICAgcmV0dXJuIF92YWwuZ2V0SGFuZGxlcigpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldEhhbmRsZXIoVmFsdWVIYW5kbGVyIGhhbmRsZXIpIHsKICAg\nICAgICBfdmFsLnNldEhhbmRsZXIoaGFuZGxlcik7CiAgICB9CgogICAgcHVi\nbGljIEZpZWxkTWFwcGluZyBnZXRGaWVsZE1hcHBpbmcoKSB7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZyBn\nZXRUeXBlTWFwcGluZygpIHsKICAgICAgICByZXR1cm4gX3ZhbC5nZXRUeXBl\nTWFwcGluZygpOwogICAgfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0\nRGVjbGFyZWRUeXBlTWFwcGluZygpIHsKICAgICAgICByZXR1cm4gX3ZhbC5n\nZXREZWNsYXJlZFR5cGVNYXBwaW5nKCk7CiAgICB9CgogICAgcHVibGljIENs\nYXNzTWFwcGluZyBnZXRFbWJlZGRlZE1hcHBpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIF92YWwuZ2V0RW1iZWRkZWRNYXBwaW5nKCk7CiAgICB9CgogICAgcHVi\nbGljIEZpZWxkTWFwcGluZyBnZXRWYWx1ZU1hcHBlZEJ5TWFwcGluZygpIHsK\nICAgICAgICByZXR1cm4gX3ZhbC5nZXRWYWx1ZU1hcHBlZEJ5TWFwcGluZygp\nOwogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5zKCkgewog\nICAgICAgIC8vIHBjbDogNiBKdWx5IDIwMDc6IHRoaXMgc2VlbXMgYSBiaXQg\naGFja3ksIGJ1dCBpZiB0aGUgbWFwcGluZyBpcyBhCiAgICAgICAgLy8gdmVy\nc2lvbiwgaXQgd2lsbCBoYXZlIGEgTm9uZUZpZWxkTWFwcGluZyAoc2luY2Ug\ndGhlIHZlcnNpb24gc3RyYXRlZ3kKICAgICAgICAvLyBmb3IgdGhlIGNsYXNz\nIHRha2VzIGNhcmUgb2YgaXQncyBtYXBwaW5nKSwgYW5kIE5vbmVGaWVsZFN0\ncmF0ZWdpZXMKICAgICAgICAvLyBkbyBub3QgaGF2ZSBjb2x1bW5zLgogICAg\nICAgIGlmIChpc1ZlcnNpb24oKSkKICAgICAgICAgICAgcmV0dXJuIGdldERl\nY2xhcmluZ01hcHBpbmcoKS5nZXRWZXJzaW9uKCkuZ2V0Q29sdW1ucygpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIF92YWwuZ2V0Q29sdW1u\ncygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbHVtbnMoQ29sdW1u\nW10gY29scykgewogICAgICAgIF92YWwuc2V0Q29sdW1ucyhjb2xzKTsKICAg\nIH0KCiAgICBwdWJsaWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAg\nICAgcmV0dXJuIF92YWwuZ2V0Q29sdW1uSU8oKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRDb2x1bW5JTyhDb2x1bW5JTyBpbykgewogICAgICAgIF92\nYWwuc2V0Q29sdW1uSU8oaW8pOwogICAgfQoKICAgIHB1YmxpYyBGb3JlaWdu\nS2V5IGdldEZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJuIF92YWwuZ2V0\nRm9yZWlnbktleSgpOwogICAgfQoKICAgIHB1YmxpYyBGb3JlaWduS2V5IGdl\ndEZvcmVpZ25LZXkoQ2xhc3NNYXBwaW5nIHRhcmdldCkgewogICAgICAgIHJl\ndHVybiBfdmFsLmdldEZvcmVpZ25LZXkodGFyZ2V0KTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAg\nICAgICBfdmFsLnNldEZvcmVpZ25LZXkoZmspOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgZ2V0Sm9pbkRpcmVjdGlvbigpIHsKICAgICAgICByZXR1cm4gX3Zh\nbC5nZXRKb2luRGlyZWN0aW9uKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0Sm9pbkRpcmVjdGlvbihpbnQgZGlyZWN0aW9uKSB7CiAgICAgICAgX3Zh\nbC5zZXRKb2luRGlyZWN0aW9uKGRpcmVjdGlvbik7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0Rm9yZWlnbktleShSb3cgcm93LCBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIF92YWwuc2V0Rm9yZWlnbktleShyb3csIHNtKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB3aGVyZUZvcmVpZ25LZXkoUm93IHJvdywgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBfdmFsLndoZXJlRm9yZWlnbktleShyb3csIHNtKTsKICAgIH0K\nCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0SW5kZXBlbmRlbnRUeXBl\nTWFwcGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIF92YWwuZ2V0SW5kZXBlbmRl\nbnRUeXBlTWFwcGluZ3MoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFNl\nbGVjdFN1YmNsYXNzZXMoKSB7CiAgICAgICAgcmV0dXJuIF92YWwuZ2V0U2Vs\nZWN0U3ViY2xhc3NlcygpOwogICAgfQoKICAgIHB1YmxpYyBVbmlxdWUgZ2V0\nVmFsdWVVbmlxdWUoKSB7CiAgICAgICAgcmV0dXJuIF92YWwuZ2V0VmFsdWVV\nbmlxdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRWYWx1ZVVuaXF1\nZShVbmlxdWUgdW5xKSB7CiAgICAgICAgX3ZhbC5zZXRWYWx1ZVVuaXF1ZSh1\nbnEpOwogICAgfQoKICAgIHB1YmxpYyBJbmRleCBnZXRWYWx1ZUluZGV4KCkg\newogICAgICAgIHJldHVybiBfdmFsLmdldFZhbHVlSW5kZXgoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRWYWx1ZUluZGV4KEluZGV4IGlkeCkgewog\nICAgICAgIF92YWwuc2V0VmFsdWVJbmRleChpZHgpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGdldFVzZUNsYXNzQ3JpdGVyaWEoKSB7CiAgICAgICAg\ncmV0dXJuIF92YWwuZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFVzZUNsYXNzQ3JpdGVyaWEoYm9vbGVhbiBjcml0\nZXJpYSkgewogICAgICAgIF92YWwuc2V0VXNlQ2xhc3NDcml0ZXJpYShjcml0\nZXJpYSk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRQb2x5bW9ycGhpYygp\nIHsKICAgICAgICByZXR1cm4gX3ZhbC5nZXRQb2x5bW9ycGhpYygpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFBvbHltb3JwaGljKGludCBwb2x5KSB7\nCiAgICAgICAgX3ZhbC5zZXRQb2x5bW9ycGhpYyhwb2x5KTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBtYXBDb25zdHJhaW50cyhTdHJpbmcgbmFtZSwgYm9v\nbGVhbiBhZGFwdCkgewogICAgICAgIF92YWwubWFwQ29uc3RyYWludHMobmFt\nZSwgYWRhcHQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvcHlNYXBwaW5n\nSW5mbyhWYWx1ZU1hcHBpbmcgdm0pIHsKICAgICAgICBfdmFsLmNvcHlNYXBw\naW5nSW5mbyh2bSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJt\ncyBpZiB0aGlzIGZpZWxkIGlzIHRoZSBvd25pbmcgc2lkZSBvZiBhIGJpZGly\nZWN0aW9uYWwgcmVsYXRpb24KICAgICAqIHdpdGggYSBqb2luIHRhYmxlLiBF\ndmFsdWF0ZWQgb25seSBvbmNlIGFuZCB0aGUgcmVzdWx0IGNhY2hlZCBmb3Ig\nCiAgICAgKiBzdWJzZXF1ZW50IGNhbGwuIEhlbmNlIG11c3QgYmUgY2FsbGVk\nIGFmdGVyIHJlc29sdXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzQmlkaXJlY3Rpb25hbEpvaW5UYWJsZU1hcHBpbmdPd25lcigpIHsKICAg\nIAlpZiAoX2JpZGlyZWN0aW9uYWxKb2luVGFibGVPd25lciAhPSBudWxsKQog\nICAgCQlyZXR1cm4gX2JpZGlyZWN0aW9uYWxKb2luVGFibGVPd25lci5ib29s\nZWFuVmFsdWUoKTsKICAgIAkKICAgIAlfYmlkaXJlY3Rpb25hbEpvaW5UYWJs\nZU93bmVyID0gZmFsc2U7CiAgICAgICAgRm9yZWlnbktleSBmayA9IGdldEZv\ncmVpZ25LZXkoKTsKICAgICAgICBpZiAoZmsgIT0gbnVsbCkgCiAgICAgICAg\nCXJldHVybiBmYWxzZTsKICAgICAgICBGb3JlaWduS2V5IGpmayA9IGdldEpv\naW5Gb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGpmayA9PSBudWxsKSAKICAg\nICAgICAJcmV0dXJuIGZhbHNlOwogICAgICAgIEZpZWxkTWFwcGluZyBtYXBw\nZWRCeSA9IGdldFZhbHVlTWFwcGVkQnlNYXBwaW5nKCk7CiAgICAgICAgaWYg\nKG1hcHBlZEJ5ICE9IG51bGwpIAogICAgICAgIAlyZXR1cm4gZmFsc2U7CiAg\nICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBnZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgIGlmIChlbGVtID09IG51bGwpIAogICAgICAgIAlyZXR1cm4g\nZmFsc2U7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbFR5cGUgPSBlbGVtLmdl\ndERlY2xhcmVkVHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAocmVsVHlwZSA9\nPSBudWxsKSAKICAgICAgICAJcmV0dXJuIGZhbHNlOwogICAgICAgIEZpZWxk\nTWFwcGluZ1tdIHJlbEZtZHMgPSByZWxUeXBlLmdldEZpZWxkTWFwcGluZ3Mo\nKTsKICAgICAgICBmb3IgKGludCBpPTA7IGk8cmVsRm1kcy5sZW5ndGg7aSsr\nKSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyByZm0gPSByZWxGbWRzW2ld\nOwogICAgICAgICAgICBpZiAocmZtLmdldERlY2xhcmVkVHlwZU1ldGFEYXRh\nKCkgPT0gZ2V0RGVjbGFyaW5nTWFwcGluZygpKSB7CiAgICAgICAgCQlGb3Jl\naWduS2V5IHJqZmsgPSByZm0uZ2V0Sm9pbkZvcmVpZ25LZXkoKTsKICAgICAg\nICAJCWlmIChyamZrID09IG51bGwpIAogICAgICAgIAkJICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICAgICAgaWYgKHJqZmsuZ2V0VGFibGUoKSA9PSBqZmsu\nZ2V0VGFibGUoKSAmJgogICAgICAgICAgICAgICAgICAgICAgICBqZmsuZ2V0\nVGFibGUoKS5nZXRDb2x1bW5zKCkubGVuZ3RoID09CiAgICAgICAgICAgICAg\nICAgICAgICAgIGpmay5nZXRDb2x1bW5zKCkubGVuZ3RoICsgcmpmay5nZXRD\nb2x1bW5zKCkubGVuZ3RoKSB7CiAgICAgICAgCQkJX2JpZGlyZWN0aW9uYWxK\nb2luVGFibGVPd25lciA9IHRydWU7CiAgICAgICAgCQkJYnJlYWs7CiAgICAg\nICAgCQl9CiAgICAgICAgCX0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9i\naWRpcmVjdGlvbmFsSm9pblRhYmxlT3duZXIuYm9vbGVhblZhbHVlKCk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGlzIGZpZWxk\nIGlzIHRoZSBub24tb3duaW5nIHNpZGUgb2YgYSBiaWRpcmVjdGlvbmFsIHJl\nbGF0aW9uCiAgICAgKiB3aXRoIGEgam9pbiB0YWJsZS4gRXZhbHVhdGVkIG9u\nbHkgb25jZSBhbmQgdGhlIHJlc3VsdCBjYWNoZWQgZm9yIAogICAgICogc3Vi\nc2VxdWVudCBjYWxsLiBIZW5jZSBtdXN0IGJlIGNhbGxlZCBhZnRlciByZXNv\nbHV0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0JpZGlyZWN0\naW9uYWxKb2luVGFibGVNYXBwaW5nTm9uT3duZXIoKSB7CiAgICAJaWYgKF9i\naWRpcmVjdGlvbmFsSm9pblRhYmxlTm9uT3duZXIgIT0gbnVsbCkKICAgIAkJ\ncmV0dXJuIF9iaWRpcmVjdGlvbmFsSm9pblRhYmxlTm9uT3duZXIuYm9vbGVh\nblZhbHVlKCk7CiAgICAJCiAgICAJX2JpZGlyZWN0aW9uYWxKb2luVGFibGVO\nb25Pd25lciA9IGZhbHNlOwogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBnZXRG\nb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpIAogICAgICAg\nIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgRm9yZWlnbktleSBqZmsgPSBnZXRK\nb2luRm9yZWlnbktleSgpOwogICAgICAgIGlmIChqZmsgPT0gbnVsbCkgCiAg\nICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICBGaWVsZE1hcHBpbmcgbWFw\ncGVkQnkgPSBnZXRWYWx1ZU1hcHBlZEJ5TWFwcGluZygpOwogICAgICAgIGlm\nIChtYXBwZWRCeSAhPSBudWxsKSAKICAgICAgICAJcmV0dXJuIGZhbHNlOwog\nICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZ2V0RWxlbWVudE1hcHBpbmco\nKTsKICAgICAgICBpZiAoZWxlbSA9PSBudWxsKSAKICAgICAgICAJcmV0dXJu\nIGZhbHNlOwogICAgICAgIENsYXNzTWFwcGluZyByZWxUeXBlID0gZ2V0RGVj\nbGFyZWRUeXBlTWFwcGluZygpOwogICAgICAgIGlmIChyZWxUeXBlID09IG51\nbGwpIAogICAgICAgIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgRmllbGRNYXBw\naW5nW10gcmVsRm1kcyA9IHJlbFR5cGUuZ2V0RmllbGRNYXBwaW5ncygpOwog\nICAgICAgIGZvciAoaW50IGk9MDsgaTxyZWxGbWRzLmxlbmd0aDtpKyspIHsK\nICAgICAgICAgICAgRmllbGRNYXBwaW5nIHJmbSA9IHJlbEZtZHNbaV07CiAg\nICAgICAgICAgIFZhbHVlTWFwcGluZyByZWxlbSA9IHJmbS5nZXRFbGVtZW50\nTWFwcGluZygpOwogICAgICAgICAgICBpZiAocmVsZW0gIT0gbnVsbCAmJiBy\nZWxlbS5nZXREZWNsYXJlZFR5cGVNYXBwaW5nKCkgPT0KICAgICAgICAgICAg\nICAgICAgICBnZXREZWNsYXJpbmdNYXBwaW5nKCkpIHsKICAgICAgICAJCUZv\ncmVpZ25LZXkgcmpmayA9IHJmbS5nZXRKb2luRm9yZWlnbktleSgpOwogICAg\nICAgIAkJaWYgKHJqZmsgPT0gbnVsbCkgCiAgICAgICAgCQkgICAgY29udGlu\ndWU7CiAgICAgICAgCQlpZiAocmpmay5nZXRUYWJsZSgpID09IGpmay5nZXRU\nYWJsZSgpICYmIAogICAgICAgIAkJICAgICAgICBqZmsuZ2V0VGFibGUoKS5n\nZXRDb2x1bW5zKCkubGVuZ3RoID09CiAgICAgICAgICAgICAgICAgICAgICAg\nIGpmay5nZXRDb2x1bW5zKCkubGVuZ3RoICsgcmpmay5nZXRDb2x1bW5zKCku\nbGVuZ3RoKSB7CiAgICAgICAgCQkJX2JpZGlyZWN0aW9uYWxKb2luVGFibGVO\nb25Pd25lciA9IHRydWU7CiAgICAgICAgCQkJYnJlYWs7CiAgICAgICAgCQl9\nCiAgICAgICAgCX0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9iaWRpcmVj\ndGlvbmFsSm9pblRhYmxlTm9uT3duZXIuYm9vbGVhblZhbHVlKCk7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBib29sZWFuIGlzQmlNVG8xSlQoKSB7CiAgICAg\nICAgaWYgKF9iaV9NVG8xX0pUID09IG51bGwpIHsKICAgICAgICAgICAgX2Jp\nX01UbzFfSlQgPSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmlzQmlNVG8xSlQo\ndGhpcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYmlfTVRvMV9KVDsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1VuaTFUb01GSygpIHsKICAg\nICAgICBpZiAoX3VuaV8xVG9NX0ZLID09IG51bGwpCiAgICAgICAgICAgIF91\nbmlfMVRvTV9GSyA9IGdldE1hcHBpbmdSZXBvc2l0b3J5KCkuaXNVbmkxVG9N\nRksodGhpcyk7CiAgICAgICAgcmV0dXJuIF91bmlfMVRvTV9GSzsKICAgIH0K\nICAgIAogICAgcHVibGljIGJvb2xlYW4gaXNVbmlNVG8xSlQoKSB7CiAgICAg\nICAgaWYgKF91bmlfTVRvMV9KVCA9PSBudWxsKQogICAgICAgICAgICBfdW5p\nX01UbzFfSlQgPSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmlzVW5pTVRvMUpU\nKHRoaXMpOwogICAgICAgIHJldHVybiBfdW5pX01UbzFfSlQ7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNVbmkxVG8xSlQoKSB7CiAgICAgICAgaWYg\nKF91bmlfMVRvMV9KVCA9PSBudWxsKQogICAgICAgICAgICBfdW5pXzFUbzFf\nSlQgPSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmlzVW5pMVRvMUpUKHRoaXMp\nOwogICAgICAgIHJldHVybiBfdW5pXzFUbzFfSlQ7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNCaTFUbzFKVCgpIHsKICAgICAgICBpZiAoX2JpXzFU\nbzFfSlQgPT0gbnVsbCkKICAgICAgICAgICAgX2JpXzFUbzFfSlQgPSBnZXRN\nYXBwaW5nUmVwb3NpdG9yeSgpLmlzQmkxVG8xSlQodGhpcyk7CiAgICAgICAg\ncmV0dXJuIF9iaV8xVG8xX0pUOwogICAgfQogICAgCiAgICBwdWJsaWMgRmll\nbGRNYXBwaW5nIGdldEJpXzFUb01fSlRGaWVsZCgpIHsKICAgICAgICBpZiAo\nX2JpXzFUb01fSlRfRmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBfYmlf\nMVRvTV9KVF9GaWVsZCA9IGdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0Qmlf\nMVRvTV9Kb2luVGFibGVGaWVsZCh0aGlzKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9iaV8xVG9NX0pUX0ZpZWxkOwogICAgfQogICAgCiAgICBwdWJs\naWMgRmllbGRNYXBwaW5nIGdldEJpX01UbzFfSlRGaWVsZCgpIHsKICAgICAg\nICBpZiAoX2JpX01UbzFfSlRfRmllbGQgPT0gbnVsbCkgewogICAgICAgICAg\nICBfYmlfTVRvMV9KVF9GaWVsZCA9IGdldE1hcHBpbmdSZXBvc2l0b3J5KCku\nZ2V0QmlfTVRvMV9Kb2luVGFibGVGaWVsZCh0aGlzKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9iaV9NVG8xX0pUX0ZpZWxkOwogICAgfQoKICAgIHB1\nYmxpYyBGb3JlaWduS2V5IGdldEJpMVRvTUpvaW5GSygpIHsKICAgICAgICBp\nZiAoX2JpXzFUb01fSm9pbl9GSyA9PSBudWxsKSB7CiAgICAgICAgICAgIGdl\ndEJpXzFUb01fSlRGaWVsZCgpOwogICAgICAgICAgICBpZiAoX2JpXzFUb01f\nSlRfRmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9iaV8xVG9NX0pv\naW5fRksgPSBfYmlfMVRvTV9KVF9GaWVsZC5nZXRKb2luRm9yZWlnbktleSgp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2JpXzFUb01fSm9pbl9GSzsK\nICAgIH0KICAgIAogICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0QmkxVG9NRWxl\nbUZLKCkgewogICAgICAgIGlmIChfYmlfMVRvTV9FbGVtX0ZLID09IG51bGwp\nIHsKICAgICAgICAgICAgZ2V0QmlfMVRvTV9KVEZpZWxkKCk7CiAgICAgICAg\nICAgIGlmIChfYmlfMVRvTV9KVF9GaWVsZCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2JpXzFUb01fRWxlbV9GSyA9IF9iaV8xVG9NX0pUX0ZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCkuZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2JpXzFUb01fRWxlbV9GSzsKICAgIH0KICAgIAog\nICAgcHVibGljIHZvaWQgc2V0QmkxTUpvaW5UYWJsZUluZm8oKSB7CiAgICAg\nICAgaWYgKGdldEFzc29jaWF0aW9uVHlwZSgpID09IEZpZWxkTWV0YURhdGEu\nT05FX1RPX01BTlkpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBl\nZCA9IGdldEJpX01UbzFfSlRGaWVsZCgpOwogICAgICAgICAgICBpZiAobWFw\ncGVkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZ0lu\nZm8gaW5mbyA9IGdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgICAgICAgICBG\naWVsZE1hcHBpbmdJbmZvIG1hcHBlZEluZm8gPSBtYXBwZWQuZ2V0TWFwcGlu\nZ0luZm8oKTsKICAgICAgICAgICAgICAgIGluZm8uc2V0VGFibGVOYW1lKG1h\ncHBlZEluZm8uZ2V0VGFibGVOYW1lKCkpOwogICAgICAgICAgICAgICAgaW5m\nby5zZXRDb2x1bW5zKG1hcHBlZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFZh\nbHVlSW5mbygpLmdldENvbHVtbnMoKSk7CiAgICAgICAgICAgICAgICBnZXRF\nbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoCiAg\nICAgICAgICAgICAgICAgICAgbWFwcGVkSW5mby5nZXRDb2x1bW5zKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAKICAgIHB1YmxpYyBi\nb29sZWFuIGlzTm9uRGVmYXVsdE1hcHBpbmdVc2luZ0pvaW5UYWJsZVN0cmF0\nZWd5KCkgewogICAgICAgIHJldHVybiBpc0JpMVRvMUpUKCkgfHwgaXNVbmkx\nVG8xSlQoKSB8fCBpc1VuaU1UbzFKVCgpIHx8IGlzQmlNVG8xSlQoKTsKICAg\nIH0KfQo=\n","encoding":"base64"}

