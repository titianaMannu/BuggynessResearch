{"sha":"f097f0989e281aa2bc394f0f6a607032f2179ece","node_id":"MDQ6QmxvYjIwNjM2NDpmMDk3ZjA5ODllMjgxYWEyYmMzOTRmMGY2YTYwNzAzMmYyMTc5ZWNl","size":15378,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f097f0989e281aa2bc394f0f6a607032f2179ece","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5NYXBUYWJsZUZpZWxkU3Ry\nYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnhtbC5Db21tZW50YWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLk1ldGFEYXRhQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwoKLyoqCiAqIEluZm9y\nbWF0aW9uIGFib3V0IHRoZSBtYXBwaW5nIGZyb20gYSBmaWVsZCB0byB0aGUg\nc2NoZW1hLCBpbiByYXcgZm9ybS4KICogVGhlIGNvbHVtbnMgYW5kIHRhYmxl\ncyB1c2VkIGluIG1hcHBpbmcgaW5mbyB3aWxsIG5vdCBiZSBwYXJ0IG9mIHRo\nZQogKiB7QGxpbmsgU2NoZW1hR3JvdXB9IHVzZWQgYXQgcnVudGltZS4gUmF0\naGVyLCB0aGV5IHdpbGwgYmUgc3RydWN0cwogKiB3aXRoIHRoZSByZWxldmFu\ndCBwaWVjZXMgb2YgaW5mb3JtYXRpb24gZmlsbGVkIGluLgogKgogKiBAYXV0\naG9yIEFiZSBXaGl0ZQogKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICovCnB1\nYmxpYyBjbGFzcyBGaWVsZE1hcHBpbmdJbmZvCiAgICBleHRlbmRzIE1hcHBp\nbmdJbmZvCiAgICBpbXBsZW1lbnRzIENvbW1lbnRhYmxlIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5m\nb3JQYWNrYWdlCiAgICAgICAgKEZpZWxkTWFwcGluZ0luZm8uY2xhc3MpOwoK\nICAgIHByaXZhdGUgU3RyaW5nIF90YWJsZU5hbWUgPSBudWxsOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9vdXRlciA9IGZhbHNlOwogICAgcHJpdmF0ZSBDb2x1\nbW4gX29yZGVyQ29sID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2Fu\nT3JkZXJDb2wgPSB0cnVlOwogICAgcHJpdmF0ZSBTdHJpbmdbXSBfY29tbWVu\ndHMgPSBudWxsOwogICAgcHJpdmF0ZSBMaXN0PFVuaXF1ZT4gX2pvaW5UYWJs\nZVVuaXF1ZXM7IC8vIFVuaXF1ZSBjb25zdHJhaW50cyBvbiBKb2luVGFibGUK\nCiAgICAvKioKICAgICAqIFRoZSB1c2VyLXN1cHBsaWVkIG5hbWUgb2YgdGhl\nIHRhYmxlIGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFRhYmxlTmFtZSgpIHsKICAgICAgICByZXR1cm4gX3RhYmxlTmFt\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyLXN1cHBsaWVkIG5h\nbWUgb2YgdGhlIHRhYmxlIGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRUYWJsZU5hbWUoU3RyaW5nIHRhYmxlTmFtZSkgewog\nICAgICAgIF90YWJsZU5hbWUgPSB0YWJsZU5hbWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSBmaWVsZCdzIHRhYmxlIGlzIGpvaW5lZCB0\nbyB0aGUgY2xhc3MgdGFibGUgdGhyb3VnaCBhbgogICAgICogb3V0ZXIgam9p\nbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNKb2luT3V0ZXIoKSB7\nCiAgICAgICAgcmV0dXJuIF9vdXRlcjsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdGhlIGZpZWxkJ3MgdGFibGUgaXMgam9pbmVkIHRvIHRoZSBj\nbGFzcyB0YWJsZSB0aHJvdWdoIGFuCiAgICAgKiBvdXRlciBqb2luLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luT3V0ZXIoYm9vbGVhbiBvdXRl\ncikgewogICAgICAgIF9vdXRlciA9IG91dGVyOwogICAgfQoKICAgIC8qKgog\nICAgICogUmF3IHN5bnRoZXRpYyBvcmRlcmluZyBjb2x1bW4uCiAgICAgKi8K\nICAgIHB1YmxpYyBDb2x1bW4gZ2V0T3JkZXJDb2x1bW4oKSB7CiAgICAgICAg\ncmV0dXJuIF9vcmRlckNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBz\neW50aGV0aWMgb3JkZXJpbmcgY29sdW1uLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRPcmRlckNvbHVtbihDb2x1bW4gb3JkZXIpIHsKICAgICAgICBf\nb3JkZXJDb2wgPSBvcmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgd2UgY2FuIGhhdmUgYW4gb3JkZXJpbmcgY29sdW1uLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBjYW5PcmRlckNvbHVtbigpIHsKICAgICAgICBy\nZXR1cm4gX2Nhbk9yZGVyQ29sOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB3ZSBjYW4gaGF2ZSBhbiBvcmRlcmluZyBjb2x1bW4uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldENhbk9yZGVyQ29sdW1uKGJvb2xlYW4gY2Fu\nT3JkZXIpIHsKICAgICAgICBfY2FuT3JkZXJDb2wgPSBjYW5PcmRlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdGFibGUgZm9yIHRoZSBn\naXZlbiBmaWVsZCwgb3IgbnVsbCBpZiBubyB0YWJsZSBnaXZlbi4KICAgICAq\nLwogICAgcHVibGljIFRhYmxlIGdldFRhYmxlKGZpbmFsIEZpZWxkTWFwcGlu\nZyBmaWVsZCwgYm9vbGVhbiBjcmVhdGUsCiAgICAgICAgYm9vbGVhbiBhZGFw\ndCkgewogICAgICAgIGlmIChfdGFibGVOYW1lID09IG51bGwgJiYgIWNyZWF0\nZSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFRhYmxlIHRh\nYmxlID0gZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuZ2V0VGFibGUoKTsK\nICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSA9ICh0YWJsZSA9PSBudWxsKSA/\nIG51bGwgCiAgICAgICAgICAgIDogdGFibGUuZ2V0U2NoZW1hKCkuZ2V0TmFt\nZSgpOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlIG5vIGpvaW4gY29sdW1ucyBk\nZWZpbmVkLCB0aGVyZSBtYXkgYmUgY2xhc3MtbGV2ZWwgam9pbgogICAgICAg\nIC8vIGluZm9ybWF0aW9uIHdpdGggYSBtb3JlIGZ1bGx5LXF1YWxpZmllZCBu\nYW1lIGZvciBvdXIgdGFibGUKICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0g\nX3RhYmxlTmFtZTsKICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwgJiYg\nZ2V0Q29sdW1ucygpLmlzRW1wdHkoKSkKICAgICAgICAgICAgdGFibGVOYW1l\nID0gZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuZ2V0TWFwcGluZ0luZm8o\nKS4KICAgICAgICAgICAgICAgIGdldFNlY29uZGFyeVRhYmxlTmFtZSh0YWJs\nZU5hbWUpOwoKICAgICAgICByZXR1cm4gY3JlYXRlVGFibGUoZmllbGQsIG5l\ndyBUYWJsZURlZmF1bHRzKCkgewogICAgICAgICAgICBwdWJsaWMgU3RyaW5n\nIGdldChTY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgICAgICAgICAvLyBkZWxh\neSB0aGlzIHNvIHRoYXQgd2UgZG9uJ3QgZG8gc2NoZW1hIHJlZmxlY3Rpb24g\nZm9yIHVuaXF1ZQogICAgICAgICAgICAgICAgLy8gdGFibGUgbmFtZSB1bmxl\nc3MgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQuZ2V0\nTWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAg\nICAgICAgICAgICAgICAgICBnZXRUYWJsZU5hbWUoZmllbGQsIHNjaGVtYSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9LCBzY2hlbWFOYW1lLCB0YWJsZU5h\nbWUsIGFkYXB0KTsKICAgIH0KCiAgICBwdWJsaWMgRm9yZWlnbktleSBnZXRK\nb2luRm9yZWlnbktleSAoZmluYWwgRmllbGRNYXBwaW5nIGZpZWxkLCBUYWJs\nZSB0YWJsZSwKICAgICAgICBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYg\nKGZpZWxkLmlzVW5pMVRvTUZLKCkpIHsKICAgICAgICAgICAgTGlzdCBjb2xz\nID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIHJldHVybiBnZXRKb2luKGZpZWxk\nLCB0YWJsZSwgYWRhcHQsIGNvbHMpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGpvaW4gZnJvbSB0aGUgZmllbGQgdGFibGUgdG8gdGhlIG93bmluZyBjbGFz\ncyB0YWJsZS4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0Sm9p\nbihmaW5hbCBGaWVsZE1hcHBpbmcgZmllbGQsIFRhYmxlIHRhYmxlLAogICAg\nICAgIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICAvLyBpZiB3ZSBoYXZlIG5v\nIGpvaW4gY29sdW1ucyBkZWZpbmVkLCBjaGVjayBjbGFzcy1sZXZlbCBqb2lu\nCiAgICAJLy8gaWYgdGhlIGdpdmVuIGZpZWxkIGlzIGVtYmVkZGVkIHRoZW4g\nY29uc2lkZXIgcHJpbWFyeSB0YWJsZSBvZiBvd25lcgogICAgICAgIHJldHVy\nbiBnZXRKb2luKGZpZWxkLCB0YWJsZSwgYWRhcHQsIGdldENvbHVtbnMoKSk7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBGb3JlaWduS2V5IGdldEpvaW4oZmlu\nYWwgRmllbGRNYXBwaW5nIGZpZWxkLCBUYWJsZSB0YWJsZSwKICAgICAgICAg\nICAgYm9vbGVhbiBhZGFwdCwgTGlzdCBjb2xzKSB7CiAgICAgICAgaWYgKGNv\nbHMuaXNFbXB0eSgpKSB7CiAgICAgICAgCUNsYXNzTWFwcGluZyBtYXBwaW5n\nOwogICAgICAgIAlpZiAoZmllbGQuaXNFbWJlZGRlZCgpICYmIAogICAgICAg\nICAgICAgICAgICAgIGZpZWxkLmdldERlY2xhcmluZ01hcHBpbmcoKS5nZXRF\nbWJlZGRpbmdNYXBwaW5nKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nbWFwcGluZyA9IGZpZWxkLmdldERlY2xhcmluZ01hcHBpbmcoKS5nZXRFbWJl\nZGRpbmdNYXBwaW5nKCkKICAgICAgICAJCQkuZ2V0RmllbGRNYXBwaW5nKCku\nZ2V0RGVjbGFyaW5nTWFwcGluZygpOwogICAgICAgIAl9IGVsc2UgewogICAg\nICAgIAkJbWFwcGluZyA9IGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpOwog\nICAgICAgIAl9CiAgICAgICAgICAgIGNvbHMgPSBtYXBwaW5nLmdldE1hcHBp\nbmdJbmZvKCkuCiAgICAgICAgICAgICAgICBnZXRTZWNvbmRhcnlUYWJsZUpv\naW5Db2x1bW5zKF90YWJsZU5hbWUpOwogICAgICAgIH0KICAgICAgICBGb3Jl\naWduS2V5RGVmYXVsdHMgZGVmID0gbmV3IEZvcmVpZ25LZXlEZWZhdWx0cygp\nIHsKICAgICAgICAgICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0KFRhYmxlIGxv\nY2FsLCBUYWJsZSBmb3JlaWduLCBib29sZWFuIGludmVyc2UpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgp\nLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIGdl\ndEpvaW5Gb3JlaWduS2V5KGZpZWxkLCBsb2NhbCwgZm9yZWlnbik7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBvcHVsYXRlKFRh\nYmxlIGxvY2FsLCBUYWJsZSBmb3JlaWduLCBDb2x1bW4gY29sLAogICAgICAg\nICAgICAgICAgT2JqZWN0IHRhcmdldCwgYm9vbGVhbiBpbnZlcnNlLCBpbnQg\ncG9zLCBpbnQgY29scykgewogICAgICAgICAgICAgICAgZmllbGQuZ2V0TWFw\ncGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAg\nICAgICAgICAgICAgICBwb3B1bGF0ZUpvaW5Db2x1bW4oZmllbGQsIGxvY2Fs\nLCBmb3JlaWduLCBjb2wsIHRhcmdldCwKICAgICAgICAgICAgICAgICAgICAg\nICAgcG9zLCBjb2xzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIGNscyA9IGdldERlZmluaW5nTWFwcGluZyhmaWVs\nZCk7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUZvcmVpZ25LZXkoZmllbGQsICJq\nb2luIiwgY29scywgZGVmLCB0YWJsZSwgY2xzLCBjbHMsCiAgICAgICAgICAg\nIGZhbHNlLCBhZGFwdCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgQ2xhc3NN\nYXBwaW5nIGdldERlZmluaW5nTWFwcGluZyhGaWVsZE1hcHBpbmcgZmllbGQp\nIHsKICAgICAgICBDbGFzc01hcHBpbmcgY2xtID0gZmllbGQuZ2V0RGVmaW5p\nbmdNYXBwaW5nKCk7CiAgICAgICAgVmFsdWVNYXBwaW5nSW1wbCB2YWx1ZSA9\nIChWYWx1ZU1hcHBpbmdJbXBsKWNsbS5nZXRFbWJlZGRpbmdNZXRhRGF0YSgp\nOwogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gY2xtOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZDEgPSB2YWx1ZS5n\nZXRGaWVsZE1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gZ2V0RGVmaW5pbmdN\nYXBwaW5nKGZpZWxkMSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVW5p\ncXVlIGNvbnN0cmFpbnQgb24gdGhlIGZpZWxkIGpvaW4uCiAgICAgKi8KICAg\nIHB1YmxpYyBVbmlxdWUgZ2V0Sm9pblVuaXF1ZShGaWVsZE1hcHBpbmcgZmll\nbGQsIGJvb2xlYW4gZGVmLAogICAgICAgIGJvb2xlYW4gYWRhcHQpIHsKICAg\nICAgICBGb3JlaWduS2V5IGZrID0gZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXko\nKTsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIFVuaXF1ZSB1bnEgPSBudWxsOwogICAgICAgIGlm\nIChmay5nZXRDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgdW5x\nID0gZmllbGQuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVm\nYXVsdHMoKS4KICAgICAgICAgICAgICAgIGdldEpvaW5VbmlxdWUoZmllbGQs\nIGZrLmdldFRhYmxlKCksIGZrLmdldENvbHVtbnMoKSk7CiAgICAgICAgcmV0\ndXJuIGNyZWF0ZVVuaXF1ZShmaWVsZCwgImpvaW4iLCB1bnEsIGZrLmdldENv\nbHVtbnMoKSwgYWRhcHQpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFk\nZCBVbmlxdWUgQ29uc3RyYWludCB0byB0aGUgSm9pbiBUYWJsZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgYWRkSm9pblRhYmxlVW5pcXVlKFVuaXF1ZSB1\nKSB7CiAgICAJaWYgKF9qb2luVGFibGVVbmlxdWVzID09IG51bGwpCiAgICAJ\nCV9qb2luVGFibGVVbmlxdWVzID0gbmV3IEFycmF5TGlzdDxVbmlxdWU+KCk7\nCiAgICAJX2pvaW5UYWJsZVVuaXF1ZXMuYWRkKHUpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIEdldCB0aGUgdW5pcXVlIGNvbnN0cmFpbnRzIGFzc29j\naWF0ZWQgd2l0aCB0aGUgU2VxdWVuY2UgdGFibGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBVbmlxdWVbXSBnZXRKb2luVGFibGVVbmlxdWVzKEZpZWxkTWFwcGlu\nZyBmaWVsZCwgYm9vbGVhbiBkZWYsIAogICAgCQlib29sZWFuIGFkYXB0KSB7\nCiAgICAgICAgcmV0dXJuIGdldFVuaXF1ZXMoZmllbGQsIF9qb2luVGFibGVV\nbmlxdWVzLCBkZWYsIGFkYXB0KTsKICAgIH0gICAKICAgIAogICAgcHJpdmF0\nZSBVbmlxdWVbXSBnZXRVbmlxdWVzKEZpZWxkTWFwcGluZyBmaWVsZCwgTGlz\ndDxVbmlxdWU+IHVuaXF1ZXMsIAogICAgCQlib29sZWFuIGRlZiwgYm9vbGVh\nbiBhZGFwdCkgewogICAgICAgIGlmICh1bmlxdWVzID09IG51bGwgfHwgdW5p\ncXVlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBuZXcgVW5pcXVl\nWzBdOwogICAgICAgIENvbGxlY3Rpb248VW5pcXVlPiByZXN1bHQgPSBuZXcg\nQXJyYXlMaXN0PFVuaXF1ZT4oKTsKICAgICAgICBmb3IgKFVuaXF1ZSB0ZW1w\nbGF0ZSA6IHVuaXF1ZXMpIHsKICAgICAgICAgICAgQ29sdW1uW10gdGVtcGxh\ndGVDb2x1bW5zID0gdGVtcGxhdGUuZ2V0Q29sdW1ucygpOwogICAgICAgICAg\nICBDb2x1bW5bXSB1bmlxdWVDb2x1bW5zID0gbmV3IENvbHVtblt0ZW1wbGF0\nZUNvbHVtbnMubGVuZ3RoXTsKICAgICAgICAgICAgVGFibGUgdGFibGUgPSBn\nZXRUYWJsZShmaWVsZCwgdHJ1ZSwgYWRhcHQpOwogICAgICAgICAgICBmb3Ig\nKGludCBpPTA7IGk8dW5pcXVlQ29sdW1ucy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgU3RyaW5nIGNvbHVtbk5hbWUgPSB0ZW1wbGF0ZUNvbHVt\nbnNbaV0uZ2V0TmFtZSgpOwogICAgICAgICAgICAgICAgQ29sdW1uIHVuaXF1\nZUNvbHVtbiA9IHRhYmxlLmdldENvbHVtbihjb2x1bW5OYW1lKTsKICAgICAg\nICAgICAgICAgIHVuaXF1ZUNvbHVtbnNbaV0gPSB1bmlxdWVDb2x1bW47CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgVW5pcXVlIHVuaXF1ZSA9IGNyZWF0\nZVVuaXF1ZShmaWVsZCwgInVuaXF1ZSIsIHRlbXBsYXRlLCAgCiAgICAgICAg\nICAgICAgICB1bmlxdWVDb2x1bW5zLCBhZGFwdCk7CiAgICAgICAgICAgIGlm\nICh1bmlxdWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQo\ndW5pcXVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdC50b0Fy\ncmF5KG5ldyBVbmlxdWVbcmVzdWx0LnNpemUoKV0pOwogICAgfSAgIAogICAg\nCiAgIC8qKgogICAgICogSW5kZXggb24gdGhlIGZpZWxkIGpvaW4uCiAgICAg\nKi8KICAgIHB1YmxpYyBJbmRleCBnZXRKb2luSW5kZXgoRmllbGRNYXBwaW5n\nIGZpZWxkLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgRm9yZWlnbktleSBm\nayA9IGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZr\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBJ\nbmRleCBpZHggPSBudWxsOwogICAgICAgIGlmIChmay5nZXRDb2x1bW5zKCku\nbGVuZ3RoID4gMCkKICAgICAgICAgICAgaWR4ID0gZmllbGQuZ2V0TWFwcGlu\nZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAg\nICAgICAgIGdldEpvaW5JbmRleChmaWVsZCwgZmsuZ2V0VGFibGUoKSwgZmsu\nZ2V0Q29sdW1ucygpKTsKICAgICAgICByZXR1cm4gY3JlYXRlSW5kZXgoZmll\nbGQsICJqb2luIiwgaWR4LCBmay5nZXRDb2x1bW5zKCksIGFkYXB0KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgb3JkZXJpbmcgY29sdW1u\nIGZvciB0aGlzIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAg\nIHB1YmxpYyBDb2x1bW4gZ2V0T3JkZXJDb2x1bW4oRmllbGRNYXBwaW5nIGZp\nZWxkLCBUYWJsZSB0YWJsZSwKICAgICAgICBib29sZWFuIGFkYXB0KSB7CiAg\nICAgICAgaWYgKF9vcmRlckNvbCAhPSBudWxsICYmIGZpZWxkLmdldE9yZGVy\nRGVjbGFyYXRpb24oKSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm9yZGVyLWNvbmZsaWN0Iiwg\nZmllbGQpKTsKCiAgICAgICAgLy8gcmVzZXQgSU8KICAgICAgICBzZXRDb2x1\nbW5JTyhudWxsKTsKCiAgICAgICAgLy8gaGFzIHVzZXIgaGFzIGV4cGxpY2l0\nbHkgdHVybmVkIG9yZGVyaW5nIG9mZj8KICAgICAgICBpZiAoIV9jYW5PcmRl\nckNvbCB8fCBmaWVsZC5nZXRPcmRlckRlY2xhcmF0aW9uKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGlmIG5vIGRl\nZmF1bHRzIHJldHVybiBudWxsCiAgICAgICAgTWFwcGluZ0RlZmF1bHRzIGRl\nZiA9IGZpZWxkLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuCiAgICAgICAgICAg\nIGdldE1hcHBpbmdEZWZhdWx0cygpOwogICAgICAgIGlmIChfb3JkZXJDb2wg\nPT0gbnVsbCAmJiAoIWFkYXB0ICYmICFkZWYuZGVmYXVsdE1pc3NpbmdJbmZv\nKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29sdW1u\nIHRtcGxhdGUgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgLy8gQ29tcGF0aWJp\nbGl0eSBvcHRpb24gZGV0ZXJtaW5lcyB3aGF0IHNob3VsZCBiZSB1c2VkIGZv\ncgogICAgICAgIC8vIHRoZSBkZWZhdWx0IG9yZGVyIGNvbHVtbiBuYW1lCiAg\nICAgICAgaWYgKGZpZWxkLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0Q29u\nZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5nZXRDb21wYXRpYmlsaXR5SW5z\ndGFuY2UoKS5nZXRVc2VKUEEyRGVmYXVsdE9yZGVyQ29sdW1uTmFtZSgpKSB7\nCiAgICAgICAgICAgIC8vIFVzZSB0aGUgc2FtZSBzdHJhdGVneSBhcyBjb2x1\nbW4gdG8gYnVpbGQgdGhlIGZpZWxkIG5hbWUKICAgICAgICAgICAgdG1wbGF0\nZS5zZXROYW1lKGZpZWxkLmdldE5hbWUoKSArICJfT1JERVIiKTsgICAgICAg\nICAgICAKICAgICAgICB9IGVsc2UgeyAgICAgICAgCiAgICAgICAgICAgIHRt\ncGxhdGUuc2V0TmFtZSgib3JkciIpOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICB0bXBsYXRlLnNldEphdmFUeXBlKEphdmFUeXBlcy5JTlQpOwogICAg\nICAgIGlmICghZGVmLnBvcHVsYXRlT3JkZXJDb2x1bW5zKGZpZWxkLCB0YWJs\nZSwgbmV3IENvbHVtbltdeyB0bXBsYXRlIH0pCiAgICAgICAgICAgICYmIF9v\ncmRlckNvbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgaWYgKF9vcmRlckNvbCAhPSBudWxsKSB7CiAgICAgICAgICAgIENv\nbHVtbklPIGlvID0gbmV3IENvbHVtbklPKCk7CiAgICAgICAgICAgIGlvLnNl\ndE51bGxJbnNlcnRhYmxlKDAsICFfb3JkZXJDb2wuaXNOb3ROdWxsKCkpOwog\nICAgICAgICAgICBpby5zZXROdWxsVXBkYXRhYmxlKDAsICFfb3JkZXJDb2wu\naXNOb3ROdWxsKCkpOwogICAgICAgICAgICBpby5zZXRJbnNlcnRhYmxlKDAs\nICFfb3JkZXJDb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUp\nKTsKICAgICAgICAgICAgaW8uc2V0VXBkYXRhYmxlKDAsICFfb3JkZXJDb2wu\nZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpOwogICAgICAgICAg\nICBzZXRDb2x1bW5JTyhpbyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4g\nbWVyZ2VDb2x1bW4oZmllbGQsICJvcmRlciIsIHRtcGxhdGUsIHRydWUsIF9v\ncmRlckNvbCwgdGFibGUsCiAgICAgICAgICAgIGFkYXB0LCBkZWYuZGVmYXVs\ndE1pc3NpbmdJbmZvKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU3luY2hy\nb25pemUgaW50ZXJuYWwgaW5mb3JtYXRpb24gd2l0aCB0aGUgbWFwcGluZyBk\nYXRhIGZvciB0aGUgZ2l2ZW4KICAgICAqIGZpZWxkLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzeW5jV2l0aChGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAg\nICAgICBjbGVhcihmYWxzZSk7CgogICAgICAgIGlmIChmaWVsZC5nZXRKb2lu\nRm9yZWlnbktleSgpICE9IG51bGwpCiAgICAgICAgICAgIF90YWJsZU5hbWUg\nPSBmaWVsZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldERCRGljdGlvbmFy\neSgpLgogICAgICAgICAgICAgICAgZ2V0RnVsbE5hbWUoZmllbGQuZ2V0VGFi\nbGUoKSwgdHJ1ZSk7CgogICAgICAgIENsYXNzTWFwcGluZyBkZWYgPSBmaWVs\nZC5nZXREZWZpbmluZ01hcHBpbmcoKTsKICAgICAgICBzZXRDb2x1bW5JTyhm\naWVsZC5nZXRKb2luQ29sdW1uSU8oKSk7CiAgICAgICAgaWYgKGZpZWxkLmdl\ndEpvaW5Gb3JlaWduS2V5KCkgIT0gbnVsbCAmJiBkZWYuZ2V0VGFibGUoKSAh\nPSBudWxsKQogICAgICAgICAgICBzeW5jRm9yZWlnbktleShmaWVsZCwgZmll\nbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwKICAgICAgICAgICAgICAgIGZpZWxk\nLmdldFRhYmxlKCksIGRlZi5nZXRUYWJsZSgpKTsKICAgICAgICBfb3V0ZXIg\nPSBmaWVsZC5pc0pvaW5PdXRlcigpOwoKICAgICAgICBzeW5jSW5kZXgoZmll\nbGQsIGZpZWxkLmdldEpvaW5JbmRleCgpKTsKICAgICAgICBzeW5jVW5pcXVl\nKGZpZWxkLCBmaWVsZC5nZXRKb2luVW5pcXVlKCkpOwogICAgICAgIHN5bmNK\nb2luVGFibGVVbmlxdWVzKGZpZWxkLCBmaWVsZC5nZXRKb2luVGFibGVVbmlx\ndWVzKCkpOwogICAgICAgIHN5bmNPcmRlckNvbHVtbihmaWVsZCk7CiAgICAg\nICAgc3luY1N0cmF0ZWd5KGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFN5bmNocm9uaXplIGludGVybmFsIG1hcHBpbmcgc3RyYXRlZ3kgaW5mb3Jt\nYXRpb24gd2l0aCB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHN5bmNTdHJhdGVneShGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAg\nICAgICBzZXRTdHJhdGVneShudWxsKTsKICAgICAgICBpZiAoZmllbGQuZ2V0\nSGFuZGxlcigpICE9IG51bGwgfHwgZmllbGQuZ2V0U3RyYXRlZ3koKSA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGV4cGxpY2l0\nIHN0cmF0ZWd5IGlmIHRoZSBzdHJhdGVneSBpc24ndCB0aGUgZXhwZWN0ZWQg\nZGVmYXVsdAogICAgICAgIFN0cmF0ZWd5IHN0cmF0ID0gZmllbGQuZ2V0TWFw\ncGluZ1JlcG9zaXRvcnkoKS5kZWZhdWx0U3RyYXRlZ3kKICAgICAgICAgICAg\nKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgaWYgKHN0cmF0ID09IG51bGwgfHwg\nIXN0cmF0LmdldEFsaWFzKCkuZXF1YWxzKGZpZWxkLmdldEFsaWFzKCkpKQog\nICAgICAgICAgICBzZXRTdHJhdGVneShmaWVsZC5nZXRBbGlhcygpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIGludGVybmFsIG9yZGVy\nIGNvbHVtbiBpbmZvcm1hdGlvbiB3aXRoIHRoZSBnaXZlbiBmaWVsZC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc3luY09yZGVyQ29sdW1uKEZpZWxkTWFw\ncGluZyBmaWVsZCkgewogICAgICAgIGlmIChmaWVsZC5nZXRPcmRlckNvbHVt\nbigpICE9IG51bGwpCiAgICAgICAgICAgIF9vcmRlckNvbCA9IHN5bmNDb2x1\nbW4oZmllbGQsIGZpZWxkLmdldE9yZGVyQ29sdW1uKCksIDEsIGZhbHNlLAog\nICAgICAgICAgICAgICAgZmllbGQuZ2V0VGFibGUoKSwgbnVsbCwgbnVsbCwg\nZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX29yZGVyQ29sID0g\nbnVsbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTZXRzIGludGVybmFs\nIGNvbnN0cmFpbnQgaW5mb3JtYXRpb24gdG8gbWF0Y2ggZ2l2ZW4gbWFwcGVk\nIGNvbnN0cmFpbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHN5bmNK\nb2luVGFibGVVbmlxdWVzKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBVbmlx\ndWVbXSB1bnFzKQogICAgewogICAgICAgIGlmICh1bnFzID09IG51bGwpIHsK\nICAgICAgICAgICAgX2pvaW5UYWJsZVVuaXF1ZXMgPSBudWxsOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIF9qb2luVGFibGVVbmlx\ndWVzID0gbmV3IEFycmF5TGlzdDxVbmlxdWU+KCk7CiAgICAgICAgZm9yIChV\nbmlxdWUgdW5pcXVlOnVucXMpIHsKICAgICAgICAJVW5pcXVlIGNvcHkgPSBu\nZXcgVW5pcXVlKCk7CiAgICAgICAgCWNvcHkuc2V0TmFtZSh1bmlxdWUuZ2V0\nTmFtZSgpKTsKICAgICAgICAJY29weS5zZXREZWZlcnJlZCh1bmlxdWUuaXNE\nZWZlcnJlZCgpKTsKICAgICAgICAJX2pvaW5UYWJsZVVuaXF1ZXMuYWRkKHVu\naXF1ZSk7CiAgICAgICAgfQogICAgfQoKCiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNTY2hlbWFDb21wb25lbnRzKCkgewogICAgICAgIHJldHVybiBzdXBlci5o\nYXNTY2hlbWFDb21wb25lbnRzKCkgfHwgX3RhYmxlTmFtZSAhPSBudWxsCiAg\nICAgICAgICAgIHx8IF9vcmRlckNvbCAhPSBudWxsOwogICAgfQoKICAgIHBy\nb3RlY3RlZCB2b2lkIGNsZWFyKGJvb2xlYW4gY2FuRmxhZ3MpIHsKICAgICAg\nICBzdXBlci5jbGVhcihjYW5GbGFncyk7CiAgICAgICAgX3RhYmxlTmFtZSA9\nIG51bGw7CiAgICAgICAgX29yZGVyQ29sID0gbnVsbDsKICAgICAgICBpZiAo\nY2FuRmxhZ3MpCiAgICAgICAgICAgIF9jYW5PcmRlckNvbCA9IHRydWU7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY29weShNYXBwaW5nSW5mbyBpbmZvKSB7\nCiAgICAgICAgc3VwZXIuY29weShpbmZvKTsKICAgICAgICBpZiAoIShpbmZv\nIGluc3RhbmNlb2YgRmllbGRNYXBwaW5nSW5mbykpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgRmllbGRNYXBwaW5nSW5mbyBmaW5mbyA9IChGaWVs\nZE1hcHBpbmdJbmZvKSBpbmZvOwogICAgICAgIGlmIChfdGFibGVOYW1lID09\nIG51bGwpCiAgICAgICAgICAgIF90YWJsZU5hbWUgPSBmaW5mby5nZXRUYWJs\nZU5hbWUoKTsKICAgICAgICBpZiAoIV9vdXRlcikKICAgICAgICAgICAgX291\ndGVyID0gZmluZm8uaXNKb2luT3V0ZXIoKTsKICAgICAgICBpZiAoX2Nhbk9y\nZGVyQ29sICYmIF9vcmRlckNvbCA9PSBudWxsKQogICAgICAgICAgICBfY2Fu\nT3JkZXJDb2wgPSBmaW5mby5jYW5PcmRlckNvbHVtbigpOwogICAgICAgIGlm\nIChfY2FuT3JkZXJDb2wgJiYgZmluZm8uZ2V0T3JkZXJDb2x1bW4oKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChfb3JkZXJDb2wgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9vcmRlckNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAg\nICAgICAgX29yZGVyQ29sLmNvcHkoZmluZm8uZ2V0T3JkZXJDb2x1bW4oKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDb21t\nZW50cygpIHsKICAgICAgICByZXR1cm4gKF9jb21tZW50cyA9PSBudWxsKSA/\nIEVNUFRZX0NPTU1FTlRTIDogX2NvbW1lbnRzOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldENvbW1lbnRzKFN0cmluZ1tdIGNvbW1lbnRzKSB7CiAgICAg\nICAgX2NvbW1lbnRzID0gY29tbWVudHM7CiAgICB9Cn0K\n","encoding":"base64"}

