{"sha":"dd3b004bc51be92cd9b3514777e79da95801746b","node_id":"MDQ6QmxvYjIwNjM2NDpkZDNiMDA0YmM1MWJlOTJjZDliMzUxNDc3N2U3OWRhOTU4MDE3NDZi","size":70290,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/dd3b004bc51be92cd9b3514777e79da95801746b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVt\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5G\nb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlNjaGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUNvbnRleHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEJhc2UgY2xhc3Mgc3Rvcmlu\nZyByYXcgbWFwcGluZyBpbmZvcm1hdGlvbjsgZGVmaW5lcyB1dGlsaXR5IG1l\ndGhvZHMgZm9yCiAqIGNvbnZlcnRpbmcgcmF3IG1hcHBpbmcgaW5mb3JtYXRp\nb24gdG8gZnVsbCBtYXBwaW5nIHRvIHRoZSBzY2hlbWEuCiAqCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgTWFwcGlu\nZ0luZm8KICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBKT0lOX05PTkUgPSAwOwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgSk9JTl9GT1JXQVJEID0gMTsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEpPSU5fSU5WRVJTRSA9IDI7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBuZXcgT2JqZWN0KCk7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChNYXBwaW5nSW5mby5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBTdHJpbmcgX3N0cmF0ZWd5ID0gbnVsbDsKICAg\nIHByaXZhdGUgTGlzdCBfY29scyA9IG51bGw7CiAgICBwcml2YXRlIEluZGV4\nIF9pZHggPSBudWxsOwogICAgcHJpdmF0ZSBVbmlxdWUgX3VucSA9IG51bGw7\nCiAgICBwcml2YXRlIEZvcmVpZ25LZXkgX2ZrID0gbnVsbDsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfY2FuSWR4ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfY2FuVW5xID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2FuRksg\nPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9pbXBsaWNpdFJlbGF0aW9u\nID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfam9pbiA9IEpPSU5fTk9ORTsK\nICAgIHByaXZhdGUgQ29sdW1uSU8gX2lvID0gbnVsbDsKCiAgICAvKioKICAg\nICAqIE1hcHBpbmcgc3RyYXRlZ3kgbmFtZS4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRTdHJhdGVneSgpIHsKICAgICAgICByZXR1cm4gX3N0cmF0\nZWd5OwogICAgfQoKICAgIC8qKgogICAgICogTWFwcGluZyBzdHJhdGVneSBu\nYW1lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJhdGVneShTdHJp\nbmcgc3RyYXRlZ3kpIHsKICAgICAgICBfc3RyYXRlZ3kgPSBzdHJhdGVneTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBjb2x1bW4gZGF0YS4KICAgICAq\nLwogICAgcHVibGljIExpc3QgZ2V0Q29sdW1ucygpIHsKICAgICAgICByZXR1\ncm4gKF9jb2xzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6\nIF9jb2xzOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIGNv\nbHVtbnMgd2hvc2UgdGFibGUgbmFtZSBtYXRjaGVzIHRoZSBnaXZlbiB0YWJs\nZSBuYW1lLiAKICAgICAqLwogICAgcHVibGljIExpc3QgZ2V0Q29sdW1ucyhT\ndHJpbmcgdGFibGVOYW1lKSB7CiAgICAgICAgaWYgKF9jb2xzID09IG51bGwp\nIAogICAgICAgIAlyZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAg\nICAgICBMaXN0IHJlc3VsdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBm\nb3IgKE9iamVjdCBjb2wgOiBfY29scykgewogICAgICAgIAlpZiAoU3RyaW5n\nVXRpbHMuZXF1YWxzKCgoQ29sdW1uKWNvbCkuZ2V0VGFibGVOYW1lKCksIAog\nICAgICAgIAkJCXRhYmxlTmFtZSkpIAogICAgICAgIAkJcmVzdWx0LmFkZChj\nb2wpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoK\nICAgIC8qKgogICAgICogUmF3IGNvbHVtbiBkYXRhLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRDb2x1bW5zKExpc3QgY29scykgewogICAgICAgIF9j\nb2xzID0gY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBpbmRleC4K\nICAgICAqLwogICAgcHVibGljIEluZGV4IGdldEluZGV4KCkgewogICAgICAg\nIHJldHVybiBfaWR4OwogICAgfQoKICAgIC8qKgogICAgICogUmF3IGluZGV4\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbmRleChJbmRleCBpZHgp\nIHsKICAgICAgICBfaWR4ID0gaWR4OwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHVzZXIgY2FuIG1hcmsgY29sdW1ucyBhcyBleHBsaWNpdGx5IG5vbi1p\nbmRleGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNhbkluZGV4\nKCkgewogICAgICAgIHJldHVybiBfY2FuSWR4OwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIHVzZXIgY2FuIG1hcmsgY29sdW1ucyBhcyBleHBsaWNpdGx5\nIG5vbi1pbmRleGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENh\nbkluZGV4KGJvb2xlYW4gaW5kZXhhYmxlKSB7CiAgICAgICAgX2NhbklkeCA9\nIGluZGV4YWJsZTsKICAgIH0KCiAgICAvKiogCiAgICAgKiAgQWZmaXJtcyBp\nZiB0aGlzIGluc3RhbmNlIHJlcHJlc2VudHMgYW4gaW1wbGljaXQgcmVsYXRp\nb24uIEZvciBleGFtcGxlLCBhCiAgICAgKiAgcmVsYXRpb24gZXhwcmVzc2Vk\nIGFzIHRoZSB2YWx1ZSBvZiBwcmltYXJ5IGtleSBvZiB0aGUgcmVsYXRlZCBj\nbGFzcyBhbmQKCSAqICBub3QgYXMgb2JqZWN0IHJlZmVyZW5jZS4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4zLjAKICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNJbXBsaWNpdFJlbGF0aW9uKCkgewogICAgCXJldHVybiBfaW1wbGlj\naXRSZWxhdGlvbjsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTZXRzIGEg\nbWFya2VyIHRvIGltcGx5IGEgbG9naWNhbCByZWxhdGlvbiB0aGF0IGNhbiBu\nb3QgaGF2ZSBhbnkgcGh5c2ljYWwKICAgICAqIG1hbmlmZXN0IGluIHRoZSBk\nYXRhYmFzZS4gRm9yIGV4YW1wbGUsIGEgcmVsYXRpb24gZXhwcmVzc2VkIGFz\nIHRoZSB2YWx1ZQogICAgICogb2YgcHJpbWFyeSBrZXkgb2YgdGhlIHJlbGF0\nZWQgY2xhc3MgYW5kIG5vdCBhcyBvYmplY3QgcmVmZXJlbmNlLgogICAgICog\nUG9wdWxhdGVkIGZyb20gQEZvcmVpZ25LZXkoaW1wbGljaXQ9dHJ1ZSkgYW5u\nb3RhdGlvbi4KICAgICAqIFRoZSBtdXRhdG9yIGNhbiBvbmx5IHRyYW5zaXQg\nZnJvbSBmYWxzZSB0byB0cnVlIGJ1dCBub3QgdmljZSB2ZXJzYS4KICAgICAq\nIAogICAgICogQHNpbmNlIDEuMy4wCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEltcGxpY2l0UmVsYXRpb24oYm9vbGVhbiBmbGFnKSB7CiAgICAJX2lt\ncGxpY2l0UmVsYXRpb24gfD0gZmxhZzsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJhdyBmb3JlaWduIGtleSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVi\nbGljIEZvcmVpZ25LZXkgZ2V0Rm9yZWlnbktleSgpIHsKICAgICAgICByZXR1\ncm4gX2ZrOwogICAgfQoKICAgIC8qKgogICAgICogUmF3IGZvcmVpZ24ga2V5\nIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRGb3Jl\naWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBfZmsgPSBmazsKICAg\nICAgICBpZiAoZmsgIT0gbnVsbCAmJiBfam9pbiA9PSBKT0lOX05PTkUpCiAg\nICAgICAgICAgIF9qb2luID0gSk9JTl9GT1JXQVJEOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIHVzZXIgY2FuIG1hcmsgY29sdW1ucyBhcyBleHBsaWNp\ndGx5IG5vdCBoYXZpbmcgYSBmb3JlaWduIGtleS4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gY2FuRm9yZWlnbktleSgpIHsKICAgICAgICByZXR1cm4g\nX2NhbkZLOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHVzZXIgY2FuIG1h\ncmsgY29sdW1ucyBhcyBleHBsaWNpdGx5IG5vdCBoYXZpbmcgYSBmb3JlaWdu\nIGtleS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FuRm9yZWlnbktl\neShib29sZWFuIGZrYWJsZSkgewogICAgICAgIF9jYW5GSyA9IGZrYWJsZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJhdyB1bmlxdWUgY29uc3RyYWludCBp\nbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIFVuaXF1ZSBnZXRVbmlx\ndWUoKSB7CiAgICAgICAgcmV0dXJuIF91bnE7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSYXcgdW5pcXVlIGNvbnN0cmFpbnQgaW5mb3JtYXRpb24uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFVuaXF1ZShVbmlxdWUgdW5xKSB7CiAg\nICAgICAgX3VucSA9IHVucTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB1\nc2VyIGNhbiBtYXJrIGNvbHVtbnMgYXMgZXhwbGljaXRseSBub3QgaGF2aW5n\nIGEgdW5pcXVlIGNvbnN0cmFpbnQuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGNhblVuaXF1ZSgpIHsKICAgICAgICByZXR1cm4gX2NhblVucTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMg\nYXMgZXhwbGljaXRseSBub3QgaGF2aW5nIGEgdW5pcXVlIGNvbnN0cmFpbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENhblVuaXF1ZShib29sZWFu\nIHVuaXF1YWJsZSkgewogICAgICAgIF9jYW5VbnEgPSB1bmlxdWFibGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJL08gZm9yIHRoZSBjb2x1bW5zIGNyZWF0\nZWQgYnkgdGhlIGxhc3QgY2FsbCB0byB7QGxpbmsgI2NyZWF0ZUNvbHVtbnN9\nLAogICAgICogb3IgZm9yIHRoZSBmb3JlaWduIGtleSBjcmVhdGVkIGJ5IHRo\nZSBsYXN0IGNhbGwgdG8KICAgICAqIHtAbGluayAjY3JlYXRlRm9yZWlnbktl\neX0uIFRoaXMgaXMgYWxzbyBleHBlY3RlZCB0byBiZSBzZXQgY29ycmVjdGx5\nCiAgICAgKiBwcmlvciB0byBjYWxscyB0byB7QGxpbmsgI3N5bmNDb2x1bW5z\nfSBhbmQge0BsaW5rICNzeW5jRm9yZWlnbktleX0uCiAgICAgKi8KICAgIHB1\nYmxpYyBDb2x1bW5JTyBnZXRDb2x1bW5JTygpIHsKICAgICAgICByZXR1cm4g\nX2lvOwogICAgfQoKICAgIC8qKgogICAgICogSS9PIGZvciB0aGUgY29sdW1u\ncyBjcmVhdGVkIGJ5IHRoZSBsYXN0IGNhbGwgdG8ge0BsaW5rICNjcmVhdGVD\nb2x1bW5zfSwKICAgICAqIG9yIGZvciB0aGUgZm9yZWlnbiBrZXkgY3JlYXRl\nZCBieSB0aGUgbGFzdCBjYWxsIHRvCiAgICAgKiB7QGxpbmsgI2NyZWF0ZUZv\ncmVpZ25LZXl9LiBUaGlzIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNv\ncnJlY3RseQogICAgICogcHJpb3IgdG8gY2FsbHMgdG8ge0BsaW5rICNzeW5j\nQ29sdW1uc30gYW5kIHtAbGluayAjc3luY0ZvcmVpZ25LZXl9LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRDb2x1bW5JTyhDb2x1bW5JTyBpbykgewog\nICAgICAgIF9pbyA9IGlvOwogICAgfQoKICAgIC8qKgogICAgICogRGlyZWN0\naW9uIG9mIHRoZSBqb2luIHRoYXQgdGhlIGNvbHVtbnMgb2YgdGhpcyBtYXBw\naW5nIGluZm8gZm9ybS4gVGhpcwogICAgICogaXMgdXN1YWxseSBhdXRvbWF0\naWNhbGx5IHNldCBieSB7QGxpbmsgI2NyZWF0ZUZvcmVpZ25LZXl9LiBUaGlz\nIGZsYWcKICAgICAqIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNvcnJl\nY3RseSBwcmlvciB0byBjYWxscyB0bwogICAgICoge0BsaW5rICNzeW5jRm9y\nZWlnbktleX0gaWYgdGhlIGpvaW4gaXMgaW52ZXJzZWQuCiAgICAgKi8KICAg\nIHB1YmxpYyBpbnQgZ2V0Sm9pbkRpcmVjdGlvbigpIHsKICAgICAgICByZXR1\ncm4gX2pvaW47CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXJlY3Rpb24gb2Yg\ndGhlIGpvaW4gdGhhdCB0aGUgY29sdW1ucyBvZiB0aGlzIG1hcHBpbmcgaW5m\nbyBmb3JtLiBUaGlzCiAgICAgKiBpcyB1c3VhbGx5IGF1dG9tYXRpY2FsbHkg\nc2V0IGJ5IHtAbGluayAjY3JlYXRlRm9yZWlnbktleX0uIFRoaXMgZmxhZwog\nICAgICogaXMgYWxzbyBleHBlY3RlZCB0byBiZSBzZXQgY29ycmVjdGx5IHBy\naW9yIHRvIGNhbGxzIHRvCiAgICAgKiB7QGxpbmsgI3N5bmNGb3JlaWduS2V5\nfSBpZiB0aGUgam9pbiBpcyBpbnZlcnNlZC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Sm9pbkRpcmVjdGlvbihpbnQgam9pbikgewogICAgICAgIF9q\nb2luID0gam9pbjsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBt\nYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBj\nbGVhcigpIHsKICAgICAgICBjbGVhcih0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENsZWFyIG1hcHBpbmcgaW5mb3JtYXRpb24uCiAgICAgKgogICAg\nICogQHBhcmFtIGNhbkZsYWdzIHdoZXRoZXIgdG8gY2xlYXIgaW5mb3JtYXRp\nb24gYWJvdXQgd2hldGhlciB3ZQogICAgICogY2FuIHBsYWNlIGluZGV4ZWQs\nIGZvcmVpZ24ga2V5cywgZXRjIG9uIHRoaXMgbWFwcGluZwogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBjbGVhcihib29sZWFuIGNhbkZsYWdzKSB7CiAg\nICAgICAgX3N0cmF0ZWd5ID0gbnVsbDsKICAgICAgICBfY29scyA9IG51bGw7\nCiAgICAgICAgX2lvID0gbnVsbDsKICAgICAgICBfaWR4ID0gbnVsbDsKICAg\nICAgICBfdW5xID0gbnVsbDsKICAgICAgICBfZmsgPSBudWxsOwogICAgICAg\nIF9qb2luID0gSk9JTl9OT05FOwogICAgICAgIGlmIChjYW5GbGFncykgewog\nICAgICAgICAgICBfY2FuSWR4ID0gdHJ1ZTsKICAgICAgICAgICAgX2NhbkZL\nID0gdHJ1ZTsKICAgICAgICAgICAgX2NhblVucSA9IHRydWU7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ29weSBtaXNzaW5nIGluZm8gZnJv\nbSB0aGUgaW5zdGFuY2UgdG8gdGhpcyBvbmUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGNvcHkoTWFwcGluZ0luZm8gaW5mbykgewogICAgICAgIGlmIChf\nc3RyYXRlZ3kgPT0gbnVsbCkKICAgICAgICAgICAgX3N0cmF0ZWd5ID0gaW5m\nby5nZXRTdHJhdGVneSgpOwogICAgICAgIGlmIChfY2FuSWR4ICYmIF9pZHgg\nPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoaW5mby5nZXRJbmRleCgpICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfaWR4ID0gaW5mby5nZXRJbmRleCgp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfY2FuSWR4ID0g\naW5mby5jYW5JbmRleCgpOwogICAgICAgIH0KICAgICAgICBpZiAoX2NhblVu\ncSAmJiBfdW5xID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKGluZm8uZ2V0\nVW5pcXVlKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF91bnEgPSBpbmZv\nLmdldFVuaXF1ZSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfY2FuVW5xID0gaW5mby5jYW5VbmlxdWUoKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKF9jYW5GSyAmJiBfZmsgPT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoaW5mby5nZXRGb3JlaWduS2V5KCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9mayA9IGluZm8uZ2V0Rm9yZWlnbktleSgpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfY2FuRksgPSBpbmZvLmNhbkZvcmVpZ25L\nZXkoKTsKICAgICAgICB9CiAgICAgICAgX2ltcGxpY2l0UmVsYXRpb24gPSBp\nbmZvLmlzSW1wbGljaXRSZWxhdGlvbigpOwogICAgICAgIExpc3QgY29scyA9\nIGdldENvbHVtbnMoKTsKICAgICAgICBMaXN0IGljb2xzID0gaW5mby5nZXRD\nb2x1bW5zKCk7CiAgICAgICAgaWYgKCFpY29scy5pc0VtcHR5KCkgJiYgKGNv\nbHMuaXNFbXB0eSgpCiAgICAgICAgICAgIHx8IGNvbHMuc2l6ZSgpID09IGlj\nb2xzLnNpemUoKSkpIHsKICAgICAgICAgICAgaWYgKGNvbHMuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgY29scyA9IG5ldyBBcnJheUxpc3QoaWNvbHMu\nc2l6ZSgpKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpY29s\ncy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGNvbHMuc2l6\nZSgpID09IGkpCiAgICAgICAgICAgICAgICAgICAgY29scy5hZGQobmV3IENv\nbHVtbigpKTsKICAgICAgICAgICAgICAgICgoQ29sdW1uKSBjb2xzLmdldChp\nKSkuY29weSgoQ29sdW1uKSBpY29scy5nZXQoaSkpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHNldENvbHVtbnMoY29scyk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhpcyBpbmZvIGhh\ncyBjb2x1bW5zLCBmb3JlaWduIGtleSBpbmZvcm1hdGlvbiwgaW5kZXgKICAg\nICAqIGluZm9ybWF0aW9uLCBldGMuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGhhc1NjaGVtYUNvbXBvbmVudHMoKSB7CiAgICAgICAgcmV0dXJuIChf\nY29scyAhPSBudWxsICYmICFfY29scy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHx8IF9pZHggIT0gbnVsbAogICAgICAgICAgICB8fCBfdW5xICE9IG51bGwK\nICAgICAgICAgICAgfHwgX2ZrICE9IG51bGwKICAgICAgICAgICAgfHwgIV9j\nYW5JZHgKICAgICAgICAgICAgfHwgIV9jYW5GSwogICAgICAgICAgICB8fCAh\nX2NhblVucTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRo\nZSB1c2VyIGRpZCBub3Qgc3VwcGx5IGFueSBjb2x1bW5zLCBpbmRleCwgdW5p\ncXVlCiAgICAgKiBjb25zdHJhaW50LCBvciBmb3JlaWduIGtleSBmb3IgdGhp\ncyBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb1Nj\naGVtYUNvbXBvbmVudHMoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIGJvb2xl\nYW4gZGllKSB7CiAgICAgICAgaWYgKF9jb2xzID09IG51bGwgfHwgX2NvbHMu\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGFzc2VydE5vSW5kZXgoY29udGV4\ndCwgZGllKTsKICAgICAgICAgICAgYXNzZXJ0Tm9VbmlxdWUoY29udGV4dCwg\nZGllKTsKICAgICAgICAgICAgYXNzZXJ0Tm9Gb3JlaWduS2V5KGNvbnRleHQs\nIGRpZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInVuZXhwZWN0ZWQtY29scyIsIGNv\nbnRleHQpOwogICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0\nUmVwb3NpdG9yeSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFzc2VydCB0aGF0IHRoaXMgaW5mbyBoYXMgdGhlIGdpdmVu\nIHN0cmF0ZWd5IG9yIG5vIHN0cmF0ZWd5LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhc3NlcnRTdHJhdGVneShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwg\nT2JqZWN0IGNvbnRleHRTdHJhdCwKICAgICAgICBPYmplY3QgZXhwZWN0ZWQs\nIGJvb2xlYW4gZGllKSB7CiAgICAgICAgaWYgKGNvbnRleHRTdHJhdCA9PSBl\neHBlY3RlZCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJpbmcg\nc3RyYXQ7CiAgICAgICAgaWYgKGNvbnRleHRTdHJhdCA9PSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChfc3RyYXRlZ3kgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKF9zdHJhdGVneS5lcXVhbHMo\nZXhwZWN0ZWQuZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoZXhwZWN0ZWQgaW5zdGFuY2Vv\nZiBTdHJhdGVneQogICAgICAgICAgICAgICAgJiYgX3N0cmF0ZWd5LmVxdWFs\ncygoKFN0cmF0ZWd5KSBleHBlY3RlZCkuZ2V0QWxpYXMoKSkpCiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIHN0cmF0ID0gX3N0cmF0ZWd5\nOwogICAgICAgIH0gZWxzZSBpZiAoY29udGV4dFN0cmF0IGluc3RhbmNlb2Yg\nU3RyYXRlZ3kpCiAgICAgICAgICAgIHN0cmF0ID0gKChTdHJhdGVneSkgY29u\ndGV4dFN0cmF0KS5nZXRBbGlhcygpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgc3RyYXQgPSBjb250ZXh0U3RyYXQuZ2V0Q2xhc3MoKS5nZXROYW1lKCk7\nCgogICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInVuZXhwZWN0ZWQt\nc3RyYXRlZ3kiLCBjb250ZXh0LCBleHBlY3RlZCwKICAgICAgICAgICAgc3Ry\nYXQpOwogICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVw\nb3NpdG9yeSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFzc2VydCB0aGF0IHRoZSB1c2VyIGRpZCBub3QgdHJ5IHRvIHBs\nYWNlIGFuIGluZGV4IG9uIHRoaXMgbWFwcGluZy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgYXNzZXJ0Tm9JbmRleChNZXRhRGF0YUNvbnRleHQgY29udGV4\ndCwgYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX2lkeCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2UgbXNnID0gX2xv\nYy5nZXQoInVuZXhwZWN0ZWQtaW5kZXgiLCBjb250ZXh0KTsKICAgICAgICBp\nZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRvcnkoKS5nZXRM\nb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQg\ndGhhdCB0aGUgdXNlciBkaWQgbm90IHRyeSB0byBwbGFjZSBhIHVuaXF1ZSBj\nb25zdHJhaW50IG9uIHRoaXMKICAgICAqIG1hcHBpbmcuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFzc2VydE5vVW5pcXVlKE1ldGFEYXRhQ29udGV4dCBj\nb250ZXh0LCBib29sZWFuIGRpZSkgewogICAgICAgIGlmIChfdW5xID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWVzc2FnZSBtc2cg\nPSBfbG9jLmdldCgidW5leHBlY3RlZC11bmlxdWUiLCBjb250ZXh0KTsKICAg\nICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRvcnko\nKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nc3NlcnQgdGhhdCB0aGUgdXNlciBkaWQgbm90IHRyeSB0byBwbGFjZSBhIGZv\ncmVpZ24ga2V5IG9uIHRoaXMgbWFwcGluZwogICAgICogb3IgcGxhY2VkIGFu\nIGltcGxpY2l0IGZvcmVpZ24ga2V5LiAKICAgICAqLwogICAgcHVibGljIHZv\naWQgYXNzZXJ0Tm9Gb3JlaWduS2V5KE1ldGFEYXRhQ29udGV4dCBjb250ZXh0\nLCBib29sZWFuIGRpZSkgewogICAgICAgIGlmIChfZmsgPT0gbnVsbCB8fCBp\nc0ltcGxpY2l0UmVsYXRpb24oKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLWZrIiwg\nY29udGV4dCk7CiAgICAgICAgaWYgKGRpZSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgY29udGV4dC5n\nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fybihtc2cpOwogICAgfQoKICAg\nIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhlIHVzZXIgZGlkIG5vdCB0cnkg\ndG8gam9pbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm9Kb2lu\nKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBib29sZWFuIGRpZSkgewogICAg\nICAgIGJvb2xlYW4gam9pbiA9IGZhbHNlOwogICAgICAgIGlmIChfY29scyAh\nPSBudWxsKSB7CiAgICAgICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyAham9pbiAmJiBpIDwgX2NvbHMuc2l6ZSgpOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGNvbCA9IChDb2x1bW4pIF9jb2xzLmdl\ndChpKTsKICAgICAgICAgICAgICAgIGlmIChjb2wuZ2V0VGFyZ2V0KCkgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBqb2luID0gdHJ1ZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWpvaW4pCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgi\ndW5leHBlY3RlZC1qb2luIiwgY29udGV4dCk7CiAgICAgICAgaWYgKGRpZSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7\nCiAgICAgICAgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fy\nbihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCBvciBnZW5lcmF0\nZSBhIHRhYmxlIGZvciBhIG1hcHBpbmcuCiAgICAgKgogICAgICogQHBhcmFt\nIGNvbnRleHQgdGhlIG1hcHBpbmcgdGhhdCB1c2VzIHRoZSB0YWJsZQogICAg\nICogQHBhcmFtIGRlZiBkZWZhdWx0IHRhYmxlIG5hbWUgcHJvdmlkZXIKICAg\nICAqIEBwYXJhbSBzY2hlbWFOYW1lIGRlZmF1bHQgc2NoZW1hIGlmIGtub3du\nLCBvciBudWxsCiAgICAgKiBAcGFyYW0gZ2l2ZW4gZ2l2ZW4gdGFibGUgbmFt\nZQogICAgICogQHBhcmFtIGFkYXB0IHdoZXRoZXIgd2UgY2FuIGFsdGVyIHRo\nZSBzY2hlbWEgb3IgbWFwcGluZ3MKICAgICAqLwogICAgcHVibGljIFRhYmxl\nIGNyZWF0ZVRhYmxlKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBUYWJsZURl\nZmF1bHRzIGRlZiwKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5n\nIGdpdmVuLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgTWFwcGluZ1JlcG9z\naXRvcnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0\nUmVwb3NpdG9yeSgpOwogICAgICAgIGlmIChnaXZlbiA9PSBudWxsICYmIChk\nZWYgPT0gbnVsbCB8fCAoIWFkYXB0CiAgICAgICAgICAgICYmICFyZXBvcy5n\nZXRNYXBwaW5nRGVmYXVsdHMoKS5kZWZhdWx0TWlzc2luZ0luZm8oKSkpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLXRhYmxlIiwgY29udGV4dCkpOwoKICAgICAgICBpZiAoc2NoZW1h\nTmFtZSA9PSBudWxsKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gU2NoZW1h\ncy5nZXROZXdUYWJsZVNjaGVtYSgoSkRCQ0NvbmZpZ3VyYXRpb24pCiAgICAg\nICAgICAgICAgICByZXBvcy5nZXRDb25maWd1cmF0aW9uKCkpOwoKICAgICAg\nICAvLyBpZiBubyBnaXZlbiBhbmQgYWRhcHRpbmcgb3IgZGVmYXVsdGluZyBt\naXNzaW5nIGluZm8sIHVzZSB0ZW1wbGF0ZQogICAgICAgIFNjaGVtYUdyb3Vw\nIGdyb3VwID0gcmVwb3MuZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBTY2hl\nbWEgc2NoZW1hID0gbnVsbDsKICAgICAgICBpZiAoZ2l2ZW4gPT0gbnVsbCkg\newogICAgICAgICAgICBzY2hlbWEgPSBncm91cC5nZXRTY2hlbWEoc2NoZW1h\nTmFtZSk7CiAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmFkZFNjaGVtYShzY2hlbWFOYW1l\nKTsKICAgICAgICAgICAgZ2l2ZW4gPSBkZWYuZ2V0KHNjaGVtYSk7CiAgICAg\nICAgfQoKICAgICAgICBTdHJpbmcgZnVsbE5hbWU7CiAgICAgICAgU3RyaW5n\nIHNlcCA9IHJlcG9zLmdldERCRGljdGlvbmFyeSgpLmNhdGFsb2dTZXBhcmF0\nb3I7CiAgICAgICAgaW50IGRvdElkeCA9IGdpdmVuLmxhc3RJbmRleE9mKHNl\ncCk7CiAgICAgICAgaWYgKGRvdElkeCA9PSAtMSkKICAgICAgICAgICAgZnVs\nbE5hbWUgPSAoc2NoZW1hTmFtZSA9PSBudWxsKSA/IGdpdmVuIDogc2NoZW1h\nTmFtZSArIHNlcCArIGdpdmVuOwogICAgICAgIGVsc2UgewogICAgICAgICAg\nICBmdWxsTmFtZSA9IGdpdmVuOwogICAgICAgICAgICBzY2hlbWEgPSBudWxs\nOwogICAgICAgICAgICBzY2hlbWFOYW1lID0gZ2l2ZW4uc3Vic3RyaW5nKDAs\nIGRvdElkeCk7CiAgICAgICAgICAgIGdpdmVuID0gZ2l2ZW4uc3Vic3RyaW5n\nKGRvdElkeCArIDEpOwogICAgICAgIH0KCiAgICAgICAgLy8gbG9vayBmb3Ig\nbmFtZWQgdGFibGUgdXNpbmcgZnVsbCBuYW1lIGFuZCBmaW5kVGFibGUsIHdo\naWNoIGFsbG93cwogICAgICAgIC8vIHRoZSBkeW5hbWljIHNjaGVtYSBmYWN0\nb3J5IHRvIGNyZWF0ZSB0aGUgdGFibGUgaWYgbmVlZGVkCiAgICAgICAgVGFi\nbGUgdGFibGUgPSBncm91cC5maW5kVGFibGUoZnVsbE5hbWUpOwogICAgICAg\nIGlmICh0YWJsZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGFibGU7\nCiAgICAgICAgaWYgKCFhZGFwdCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtdGFibGUiLCBnaXZlbiwg\nY29udGV4dCkpOwoKICAgICAgICAvLyBuYW1lZCB0YWJsZSBkb2Vzbid0IGV4\naXN0OyBjcmVhdGUgaXQKICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpIHsK\nICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAuZ2V0U2NoZW1hKHNjaGVtYU5h\nbWUpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAgICAgICAg\nICAgICAgICBzY2hlbWEgPSBncm91cC5hZGRTY2hlbWEoc2NoZW1hTmFtZSk7\nCiAgICAgICAgfQogICAgICAgIHRhYmxlID0gc2NoZW1hLmdldFRhYmxlKGdp\ndmVuKTsKICAgICAgICBpZiAodGFibGUgPT0gbnVsbCkKICAgICAgICAgICAg\ndGFibGUgPSBzY2hlbWEuYWRkVGFibGUoZ2l2ZW4pOwogICAgICAgIHJldHVy\nbiB0YWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHJpZXZlL2NyZWF0\nZSBjb2x1bW5zIG9uIHRoZSBnaXZlbiB0YWJsZSBieSBtZXJnaW5nIHRoZSBn\naXZlbgogICAgICogdGVtcGxhdGUgaW5mb3JtYXRpb24gd2l0aCBhbnkgdXNl\nci1wcm92aWRlZCBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0g\nY29udGV4dCB0aGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2aW5nIGNvbHVtbnMg\nZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNz\nYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSB0bXBsYXRlcyB0ZW1wbGF0\nZSBjb2x1bW5zCiAgICAgKiBAcGFyYW0gdGFibGUgdGhlIHRhYmxlIGZvciB0\naGUgY29sdW1ucwogICAgICogQHBhcmFtIGFkYXB0IHdoZXRoZXIgd2UgY2Fu\nIG1vZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGluZyBvciBzY2hlbWEKICAgICAq\nLwogICAgcHJvdGVjdGVkIENvbHVtbltdIGNyZWF0ZUNvbHVtbnMoTWV0YURh\ndGFDb250ZXh0IGNvbnRleHQsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgQ29s\ndW1uW10gdG1wbGF0ZXMsIFRhYmxlIHRhYmxlLCBib29sZWFuIGFkYXB0KSB7\nCiAgICAgICAgYXNzZXJ0VGFibGUoY29udGV4dCwgdGFibGUpOwogICAgICAg\nIGlmIChwcmVmaXggPT0gbnVsbCkKICAgICAgICAgICAgcHJlZml4ID0gImdl\nbmVyaWMiOwoKICAgICAgICAvLyB0aGUgdXNlciBoYXMgdG8gZ2l2ZSB0aGUg\ncmlnaHQgbnVtYmVyIG9mIGV4cGVjdGVkIGNvbHVtbnMgZm9yIHRoaXMKICAg\nICAgICAvLyBtYXBwaW5nLCBvciBub25lIGF0IGFsbCBpZiB3ZSdyZSBhZGFw\ndGluZy4gIGNhbid0IGp1c3QgZ2l2ZW4gb25lIG9mCiAgICAgICAgLy8gbiBj\nb2x1bW5zIGJlY2F1c2Ugd2UgZG9uJ3Qga25vdyB3aGljaCBvZiB0aGUgbiBj\nb2x1bW5zIHRoZSBpbmZvCiAgICAgICAgLy8gYXBwbGllcyB0bwogICAgICAg\nIExpc3QgZ2l2ZW4gPSBnZXRDb2x1bW5zKCk7CiAgICAgICAgYm9vbGVhbiBm\naWxsID0gKChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0\nb3J5KCkpLgogICAgICAgICAgICBnZXRNYXBwaW5nRGVmYXVsdHMoKS5kZWZh\ndWx0TWlzc2luZ0luZm8oKTsKICAgICAgICBpZiAoKCFnaXZlbi5pc0VtcHR5\nKCkgfHwgKCFhZGFwdCAmJiAhZmlsbCkpCiAgICAgICAgICAgICYmIGdpdmVu\nLnNpemUoKSAhPSB0bXBsYXRlcy5sZW5ndGgpIHsKICAgICAgICAJLy8gYWxz\nbyBjb25zaWRlciB3aGVuIHRoaXMgaW5mbyBoYXMgY29sdW1ucyBmcm9tIG11\nbHRpcGxlIHRhYmxlcwogICAgICAgIAlnaXZlbiA9IGdldENvbHVtbnModGFi\nbGUuZ2V0TmFtZSgpKTsKICAgICAgICAJaWYgKCghYWRhcHQgJiYgIWZpbGwp\nICYmIGdpdmVuLnNpemUoKSAhPSB0bXBsYXRlcy5sZW5ndGgpIHsKICAgICAg\nICAJCS8vIHRyeSBkZWZhdWx0IHRhYmxlCiAgICAgICAgCQlnaXZlbiA9IGdl\ndENvbHVtbnMoIiIpOwogICAgICAgICAgICAgICAgaWYgKCghYWRhcHQgJiYg\nIWZpbGwpICYmIGdpdmVuLnNpemUoKSAhPSB0bXBsYXRlcy5sZW5ndGgpIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQocHJlZml4ICsgIi1udW0tY29scyIsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjb250ZXh0LCBTdHJpbmcudmFsdWVPZih0bXBs\nYXRlcy5sZW5ndGgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3Ry\naW5nLnZhbHVlT2YoZ2l2ZW4uc2l6ZSgpKSkpOwogICAgICAgICAgICAJfQog\nICAgICAgIAl9CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xzID0g\nbmV3IENvbHVtblt0bXBsYXRlcy5sZW5ndGhdOwogICAgICAgIF9pbyA9IG51\nbGw7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHRtcGxhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNv\nbCA9IChnaXZlbi5pc0VtcHR5KCkpID8gbnVsbCA6IChDb2x1bW4pIGdpdmVu\nLmdldChpKTsKICAgICAgICAgICAgY29sc1tpXSA9IG1lcmdlQ29sdW1uKGNv\nbnRleHQsIHByZWZpeCwgdG1wbGF0ZXNbaV0sIHRydWUsIGNvbCwKICAgICAg\nICAgICAgICAgIHRhYmxlLCBhZGFwdCwgZmlsbCk7CiAgICAgICAgICAgIHNl\ndElPRnJvbUNvbHVtbkZsYWdzKGNvbCwgaSk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBjb2xzOwogICAgfQogICAgCiAgICBib29sZWFuIGNhbk1lcmdl\nKExpc3QgZ2l2ZW4sIENvbHVtbltdIHRlbXBsYXRlcywgYm9vbGVhbiBhZGFw\ndCwKICAgICAgICAgICAgYm9vbGVhbiBmaWxsKSB7CiAgICAJcmV0dXJuICEo\nKCFnaXZlbi5pc0VtcHR5KCkgfHwgKCFhZGFwdCAmJiAhZmlsbCkpIAogICAg\nCQkJJiYgZ2l2ZW4uc2l6ZSgpICE9IHRlbXBsYXRlcy5sZW5ndGgpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBwcm9wZXIgaW50ZXJuYWwgY29s\ndW1uIEkvTyBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNvbHVtbidzIGZsYWdz\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0SU9Gcm9tQ29sdW1uRmxh\nZ3MoQ29sdW1uIGNvbCwgaW50IGkpIHsKICAgICAgICBpZiAoY29sID09IG51\nbGwgfHwgKCFjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUp\nCiAgICAgICAgICAgICYmICFjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQ\nREFUQUJMRSkKICAgICAgICAgICAgJiYgIWNvbC5pc05vdE51bGwoKSkpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9pbyA9PSBudWxsKQog\nICAgICAgICAgICBfaW8gPSBuZXcgQ29sdW1uSU8oKTsKICAgICAgICBfaW8u\nc2V0SW5zZXJ0YWJsZShpLCAhY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5J\nTlNFUlRBQkxFKSk7CiAgICAgICAgX2lvLnNldFVwZGF0YWJsZShpLCAhY29s\nLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUpKTsKICAgICAgICBf\naW8uc2V0TnVsbEluc2VydGFibGUoaSwgIWNvbC5pc05vdE51bGwoKSk7CiAg\nICAgICAgX2lvLnNldE51bGxVcGRhdGFibGUoaSwgIWNvbC5pc05vdE51bGwo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgZ2l2\nZW4gdGFibGUgaXMgbm9uLW51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIHZvaWQgYXNzZXJ0VGFibGUoTWV0YURhdGFDb250ZXh0IGNvbnRleHQs\nIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgidW5tYXBwZWQiLCBjb250ZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNZXJnZSB0aGUgZ2l2ZW4gY29sdW1ucyBpZiBwb3NzaWJsZS4KICAgICAq\nCiAgICAgKiBAcGFyYW0gY29udGV4dCB0aGUgbWFwcGluZyB3ZSdyZSByZXRy\naWV2aW5nIGNvbHVtbnMgZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2Fs\naXplZCBlcnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSB0\nbXBsYXRlIHRlbXBsYXRlIGZvciBleHBlY3RlZCBjb2x1bW4gaW5mb3JtYXRp\nb24KICAgICAqIEBwYXJhbSBjb21wYXQgd2hldGhlciB0aGUgZXhpc3Rpbmcg\nY29sdW1uIHR5cGUgbXVzdCBiZSBjb21wYXRpYmxlCiAgICAgKiB3aXRoIHRo\nZSB0eXBlIG9mIHRoZSB0ZW1wbGF0ZSBjb2x1bW4KICAgICAqIEBwYXJhbSBn\naXZlbiB0aGUgZ2l2ZW4gY29sdW1uIGluZm9ybWF0aW9uIGZyb20gbWFwcGlu\nZyBpbmZvCiAgICAgKiBAcGFyYW0gdGFibGUgdGhlIHRhYmxlIGZvciB0aGUg\nY29sdW1ucwogICAgICogQHBhcmFtIGFkYXB0IHdoZXRoZXIgd2UgY2FuIG1v\nZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGluZyBvciBzY2hlbWEKICAgICAqIEBw\nYXJhbSBmaWxsIHdoZXRoZXIgdG8gZGVmYXVsdCBtaXNzaW5nIGNvbHVtbiBp\nbmZvcm1hdGlvbgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIENvbHVt\nbiBtZXJnZUNvbHVtbihNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgU3RyaW5n\nIHByZWZpeCwKICAgICAgICBDb2x1bW4gdG1wbGF0ZSwgYm9vbGVhbiBjb21w\nYXQsIENvbHVtbiBnaXZlbiwgVGFibGUgdGFibGUsCiAgICAgICAgYm9vbGVh\nbiBhZGFwdCwgYm9vbGVhbiBmaWxsKSB7CiAgICAgICAgYXNzZXJ0VGFibGUo\nY29udGV4dCwgdGFibGUpOwoKICAgICAgICAvLyBpZiBub3QgYWRhcHRpbmcg\nbXVzdCBwcm92aWRlIGNvbHVtbiBuYW1lIGF0IGEgbWluaW11bQogICAgICAg\nIFN0cmluZyBjb2xOYW1lID0gKGdpdmVuID09IG51bGwpID8gbnVsbCA6IGdp\ndmVuLmdldE5hbWUoKTsKICAgICAgICBpZiAoY29sTmFtZSA9PSBudWxsICYm\nICFhZGFwdCAmJiAhZmlsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCArICItbm8tY29sLW5hbWUi\nLAogICAgICAgICAgICAgICAgY29udGV4dCkpOwoKICAgICAgICBNYXBwaW5n\nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4\ndC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3Qg\nPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKTsKCiAgICAgICAgLy8gZGV0ZXJt\naW5lIHRoZSBjb2x1bW4gbmFtZSBiYXNlZCBvbiBnaXZlbiBpbmZvLCBvciB0\nZW1wbGF0ZSBpZiBub25lOwogICAgICAgIC8vIGFsc28gbWFrZSBzdXJlIHRo\nYXQgaWYgdGhlIHVzZXIgZ2F2ZSBhIGNvbHVtbiBuYW1lLCBoZSBkaWRuJ3Qg\ndHJ5CiAgICAgICAgLy8gdG8gcHV0IHRoZSBjb2x1bW4gaW4gYW4gdW5leHBl\nY3RlZCB0YWJsZQogICAgICAgIGlmIChjb2xOYW1lID09IG51bGwpCiAgICAg\nICAgICAgIGNvbE5hbWUgPSB0bXBsYXRlLmdldE5hbWUoKTsKICAgICAgICBp\nbnQgZG90SWR4ID0gY29sTmFtZS5sYXN0SW5kZXhPZihkaWN0LmNhdGFsb2dT\nZXBhcmF0b3IpOwogICAgICAgIGlmIChkb3RJZHggPT0gMCkKICAgICAgICAg\nICAgY29sTmFtZSA9IGNvbE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIGVs\nc2UgaWYgKGRvdElkeCAhPSAtMSkgewogICAgICAgICAgICBmaW5kVGFibGUo\nY29udGV4dCwgY29sTmFtZS5zdWJzdHJpbmcoMCwgZG90SWR4KSwgdGFibGUs\nCiAgICAgICAgICAgICAgICBudWxsLCBudWxsKTsKICAgICAgICAgICAgY29s\nTmFtZSA9IGNvbE5hbWUuc3Vic3RyaW5nKGRvdElkeCArIDEpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gZmluZCBleGlzdGluZyBjb2x1bW4KICAgICAgICBD\nb2x1bW4gY29sID0gdGFibGUuZ2V0Q29sdW1uKGNvbE5hbWUpOwogICAgICAg\nIGlmIChjb2wgPT0gbnVsbCAmJiAhYWRhcHQpIHsKICAgICAgICAgICAgLy8g\nCiAgICAgICAgICAgIC8vIFNlZSBpZiBjb2x1bW4gbmFtZSBoYXMgYWxyZWFk\neSBiZWVuIHZhbGlkYXRlZCBpbiBhIGR5bmFtaWMgdGFibGUuCiAgICAgICAg\nICAgIC8vIElmIHNvIHRoZW4gd2FudCB0byB1c2UgdGhhdCB2YWxpZGF0ZWQg\nY29sdW1uIG5hbWUgaW5zdGVhZC4gVGhpcwogICAgICAgICAgICAvLyBzaG91\nbGQgc2VsZG9tIGlmIGV2ZXIgb2NjdXIgYXMgbG9uZyBhcyB0aGUgZGF0YWJh\nc2UgZGljdGlvbmFyaWVzCiAgICAgICAgICAgIC8vIGFyZSBrZXB0IHVwLXRv\nLWRhdGUuIAogICAgICAgICAgICAvLyAKICAgICAgICAgICAgaWYgKChjb2xO\nYW1lLmxlbmd0aCgpID4gZGljdC5tYXhDb2x1bW5OYW1lTGVuZ3RoKSB8fCAK\nICAgICAgICAgICAgICAgZGljdC5nZXRJbnZhbGlkQ29sdW1uV29yZFNldCgp\nLmNvbnRhaW5zKGNvbE5hbWUudG9VcHBlckNhc2UoKSkgJiYKICAgICAgICAg\nICAgICAhKHRhYmxlLmdldENsYXNzKCkuZ2V0TmFtZSgpLmNvbnRhaW5zKCJE\neW5hbWljVGFibGUiKSkpIHsKICAgICAgICAgICAgICAgIGNvbE5hbWU9ZGlj\ndC5nZXRWYWxpZENvbHVtbk5hbWUoY29sTmFtZSwgbmV3IFRhYmxlKCkpOwog\nICAgICAgICAgICAgICAgY29sID0gdGFibGUuZ2V0Q29sdW1uKGNvbE5hbWUp\nOwogICAgICAgICAgICAgICAgaWYgKGNvbCA9PSBudWxsICYmICFhZGFwdCkg\newogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLgogICAgICAgICAgICAgICAgICAgICAgICBnZXQocHJlZml4\nICsgIi1iYWQtY29sLW5hbWUiLCBjb250ZXh0LCBjb2xOYW1lLCB0YWJsZSkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuCiAgICAgICAgICAgICAgICAgICAgZ2V0KHByZWZpeCAr\nICItYmFkLWNvbC1uYW1lIiwgY29udGV4dCwgY29sTmFtZSwgdGFibGUpKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gdXNlIGluZm9y\nbWF0aW9uIGZyb20gdGVtcGxhdGUgY29sdW1uIGJ5IGRlZmF1bHQsIGFsbG93\naW5nIGFueQogICAgICAgIC8vIHVzZXItZ2l2ZW4gc3BlY2lmaWNzIHRvIG92\nZXJyaWRlIGl0CiAgICAgICAgaW50IHR5cGUgPSB0bXBsYXRlLmdldFR5cGUo\nKTsKICAgICAgICBpbnQgc2l6ZSA9IHRtcGxhdGUuZ2V0U2l6ZSgpOwogICAg\nICAgIGlmICh0eXBlID09IFR5cGVzLk9USEVSKSB7CiAgICAgICAgICAgIGlu\ndCBwcmVjaXMgPSAwOwogICAgICAgICAgICBpbnQgc2NhbGUgPSAwOwogICAg\nICAgICAgICBpZihnaXZlbiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBw\ncmVjaXMgPSBnaXZlbi5nZXRTaXplKCk7CiAgICAgICAgICAgICAgICBzY2Fs\nZSA9IGdpdmVuLmdldERlY2ltYWxEaWdpdHMoKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICB0eXBlID0KICAgICAgICAgICAgICAgIGRpY3QuZ2V0SkRC\nQ1R5cGUodG1wbGF0ZS5nZXRKYXZhVHlwZSgpLCBzaXplID09IC0xLCBwcmVj\naXMsCiAgICAgICAgICAgICAgICAgICAgc2NhbGUsIHRtcGxhdGUuaXNYTUwo\nKSk7CiAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICBib29sZWFuIHR0\neXBlID0gdHJ1ZTsKICAgICAgICBpbnQgb3R5cGUgPSB0eXBlOwogICAgICAg\nIFN0cmluZyB0eXBlTmFtZSA9IHRtcGxhdGUuZ2V0VHlwZU5hbWUoKTsKICAg\nICAgICBCb29sZWFuIG5vdE51bGwgPSBudWxsOwogICAgICAgIGlmICh0bXBs\nYXRlLmlzTm90TnVsbEV4cGxpY2l0KCkpCiAgICAgICAgICAgIG5vdE51bGwg\nPSAodG1wbGF0ZS5pc05vdE51bGwoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29s\nZWFuLkZBTFNFOwogICAgICAgIGludCBkZWNpbWFscyA9IHRtcGxhdGUuZ2V0\nRGVjaW1hbERpZ2l0cygpOwogICAgICAgIFN0cmluZyBkZWZTdHIgPSB0bXBs\nYXRlLmdldERlZmF1bHRTdHJpbmcoKTsKICAgICAgICBib29sZWFuIGF1dG9B\nc3NpZ24gPSB0bXBsYXRlLmlzQXV0b0Fzc2lnbmVkKCk7CiAgICAgICAgYm9v\nbGVhbiByZWxhdGlvbklkID0gdG1wbGF0ZS5pc1JlbGF0aW9uSWQoKTsKICAg\nICAgICBib29sZWFuIGltcGxpY2l0UmVsYXRpb24gPSB0bXBsYXRlLmlzSW1w\nbGljaXRSZWxhdGlvbigpOwogICAgICAgIFN0cmluZyB0YXJnZXRGaWVsZCA9\nIHRtcGxhdGUuZ2V0VGFyZ2V0RmllbGQoKTsKICAgICAgICBpZiAoZ2l2ZW4g\nIT0gbnVsbCkgewogICAgICAgICAgICAvLyB1c2UgZ2l2ZW4gdHlwZSBpZiBw\ncm92aWRlZCwgYnV0IHdhcm4gaWYgaXQgaXNuJ3QgY29tcGF0aWJsZSB3aXRo\nCiAgICAgICAgICAgIC8vIHRoZSBleHBlY3RlZCBjb2x1bW4gdHlwZQogICAg\nICAgICAgICBpZiAoZ2l2ZW4uZ2V0VHlwZSgpICE9IFR5cGVzLk9USEVSKSB7\nCiAgICAgICAgICAgICAgICB0dHlwZSA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgaWYgKGNvbXBhdCAmJiAhZ2l2ZW4uaXNDb21wYXRpYmxlKHR5cGUsIHR5\ncGVOYW1lLCBzaXplLCAKICAgICAgICAgICAgICAgICAgICBkZWNpbWFscykp\nIHsKICAgICAgICAgICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9n\nKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0\nKHByZWZpeCArICItaW5jb21wYXQtY29sIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRleHQsIGNvbE5hbWUsIFNjaGVtYXMuZ2V0SkRCQ05h\nbWUodHlwZSkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIG90eXBlID0gZ2l2ZW4uZ2V0VHlwZSgpOwogICAgICAgICAgICAgICAgdHlw\nZSA9IGRpY3QuZ2V0UHJlZmVycmVkVHlwZShvdHlwZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgdHlwZU5hbWUgPSBnaXZlbi5nZXRUeXBlTmFtZSgp\nOwogICAgICAgICAgICBzaXplID0gZ2l2ZW4uZ2V0U2l6ZSgpOwogICAgICAg\nICAgICBkZWNpbWFscyA9IGdpdmVuLmdldERlY2ltYWxEaWdpdHMoKTsKCiAg\nICAgICAgICAgIC8vIGxlYXZlIHRoaXMgaW5mbyBhcyB0aGUgdGVtcGxhdGUg\nZGVmYXVsdHMgdW5sZXNzIHRoZSB1c2VyCiAgICAgICAgICAgIC8vIGV4cGxp\nY2l0bHkgdHVybnMgaXQgb24gaW4gdGhlIGdpdmVuIGNvbHVtbgogICAgICAg\nICAgICBpZiAoZ2l2ZW4uaXNOb3ROdWxsRXhwbGljaXQoKSkKICAgICAgICAg\nICAgICAgIG5vdE51bGwgPSAoZ2l2ZW4uaXNOb3ROdWxsKCkpID8gQm9vbGVh\nbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgaWYgKGdpdmVu\nLmdldERlZmF1bHRTdHJpbmcoKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nZGVmU3RyID0gZ2l2ZW4uZ2V0RGVmYXVsdFN0cmluZygpOwogICAgICAgICAg\nICBpZiAoZ2l2ZW4uaXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAgICAgICAg\nIGF1dG9Bc3NpZ24gPSB0cnVlOwogICAgICAgICAgICBpZiAoZ2l2ZW4uaXNS\nZWxhdGlvbklkKCkpCiAgICAgICAgICAgICAgICByZWxhdGlvbklkID0gdHJ1\nZTsKICAgICAgICAgICAgaWYgKGdpdmVuLmlzSW1wbGljaXRSZWxhdGlvbigp\nKQogICAgICAgICAgICAJaW1wbGljaXRSZWxhdGlvbiA9IHRydWU7CiAgICAg\nICAgfQoKICAgICAgICAvLyBkZWZhdWx0IGNoYXIgY29sdW1uIHNpemUgaWYg\nb3JpZ2luYWwgdHlwZSBpcyBjaGFyICh0ZXN0IG9yaWdpbmFsCiAgICAgICAg\nLy8gdHlwZSByYXRoZXIgdGhhbiBmaW5hbCB0eXBlIGJlY2F1c2Ugb3JpZyBt\naWdodCBiZSBjbG9iLCB0cmFuc2xhdGVkCiAgICAgICAgLy8gdG8gYW4gdW5z\naXplZCB2YXJjaGFyLCB3aGljaCBpcyBzdXBwb3J0ZWQgYnkgc29tZSBkYnMp\nCiAgICAgICAgaWYgKHNpemUgPT0gMCAmJiAob3R5cGUgPT0gVHlwZXMuVkFS\nQ0hBUiB8fCBvdHlwZSA9PSBUeXBlcy5DSEFSKSkKICAgICAgICAgICAgc2l6\nZSA9IGRpY3QuY2hhcmFjdGVyQ29sdW1uU2l6ZTsKCiAgICAgICAgLy8gY3Jl\nYXRlIGNvbHVtbiwgb3IgbWFrZSBzdXJlIGV4aXN0aW5nIGNvbHVtbiBtYXRj\naGVzIGV4cGVjdGVkIHR5cGUKICAgICAgICBpZiAoY29sID09IG51bGwpIHsK\nICAgICAgICAgICAgY29sID0gdGFibGUuYWRkQ29sdW1uKGNvbE5hbWUpOwog\nICAgICAgICAgICBjb2wuc2V0VHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2Ug\naWYgKChjb21wYXQgfHwgIXR0eXBlKSAmJiAhY29sLmlzQ29tcGF0aWJsZSh0\neXBlLCB0eXBlTmFtZSwgCiAgICAgICAgICAgIHNpemUsIGRlY2ltYWxzKSkg\newogICAgICAgICAgICAvLyBpZiBleGlzdGluZyBjb2x1bW4gaXNuJ3QgY29t\ncGF0aWJsZSB3aXRoIGRlc2lyZWQgdHlwZSwgZGllIGlmCiAgICAgICAgICAg\nIC8vIGNhbid0IGFkYXB0LCBlbHNlIHdhcm4gYW5kIGNoYW5nZSB0aGUgZXhp\nc3RpbmcgY29sdW1uIHR5cGUKICAgICAgICAgICAgTWVzc2FnZSBtc2cgPSBf\nbG9jLmdldChwcmVmaXggKyAiLWJhZC1jb2wiLCBjb250ZXh0LAogICAgICAg\nICAgICAgICAgU2NoZW1hcy5nZXRKREJDTmFtZSh0eXBlKSwgY29sLmdldERl\nc2NyaXB0aW9uKCkpOwogICAgICAgICAgICBpZiAoIWFkYXB0KQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7CiAg\nICAgICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAg\nICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBs\nb2cud2Fybihtc2cpOwoKICAgICAgICAgICAgY29sLnNldFR5cGUodHlwZSk7\nCiAgICAgICAgfSBlbHNlIGlmIChnaXZlbiAhPSBudWxsICYmIGdpdmVuLmdl\ndFR5cGUoKSAhPSBUeXBlcy5PVEhFUikgewogICAgICAgICAgICAvLyBhcyBs\nb25nIGFzIHR5cGVzIGFyZSBjb21wYXRpYmxlLCBzZXQgY29sdW1uIHRvIGV4\ncGVjdGVkIHR5cGUKICAgICAgICAgICAgY29sLnNldFR5cGUodHlwZSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBhbHdheXMgc2V0IHRoZSBqYXZhIHR5cGUg\nYW5kIGF1dG9hc3NpZ24gdG8gZXhwZWN0ZWQgdmFsdWVzLCBldmVuIG9uCiAg\nICAgICAgLy8gYW4gZXhpc3RpbmcgY29sdW1uLCBzaW5jZSB3ZSBkb24ndCBn\nZXQgdGhpcyBmcm9tIHRoZSBEQgogICAgICAgIGlmIChjb21wYXQpCiAgICAg\nICAgICAgIGNvbC5zZXRKYXZhVHlwZSh0bXBsYXRlLmdldEphdmFUeXBlKCkp\nOwogICAgICAgIGVsc2UgaWYgKGNvbC5nZXRKYXZhVHlwZSgpID09IEphdmFU\neXBlcy5PQkpFQ1QpIHsKICAgICAgICAgICAgaWYgKGdpdmVuICE9IG51bGwg\nJiYgZ2l2ZW4uZ2V0SmF2YVR5cGUoKSAhPSBKYXZhVHlwZXMuT0JKRUNUKQog\nICAgICAgICAgICAgICAgY29sLnNldEphdmFUeXBlKGdpdmVuLmdldEphdmFU\neXBlKCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb2wu\nc2V0SmF2YVR5cGUoSmF2YVR5cGVzLmdldFR5cGVDb2RlCiAgICAgICAgICAg\nICAgICAgICAgKFNjaGVtYXMuZ2V0SmF2YVR5cGUoY29sLmdldFR5cGUoKSwg\nY29sLmdldFNpemUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdl\ndERlY2ltYWxEaWdpdHMoKSkpKTsKICAgICAgICB9CiAgICAgICAgY29sLnNl\ndEF1dG9Bc3NpZ25lZChhdXRvQXNzaWduKTsKICAgICAgICBjb2wuc2V0UmVs\nYXRpb25JZChyZWxhdGlvbklkKTsKICAgICAgICBjb2wuc2V0SW1wbGljaXRS\nZWxhdGlvbihpbXBsaWNpdFJlbGF0aW9uKTsKICAgICAgICBjb2wuc2V0VGFy\nZ2V0RmllbGQodGFyZ2V0RmllbGQpOwoKICAgICAgICAvLyB3ZSBuZWVkIHRo\naXMgZm9yIHJ1bnRpbWUsIGFuZCB0aGUgZHluYW1pYyBzY2hlbWEgZmFjdG9y\neSBtaWdodAogICAgICAgIC8vIG5vdCBrbm93IGl0LCBzbyBzZXQgaXQgZXZl\nbiBpZiBub3QgYWRhcHRpbmcKICAgICAgICBpZiAoZGVmU3RyICE9IG51bGwp\nCiAgICAgICAgICAgIGNvbC5zZXREZWZhdWx0U3RyaW5nKGRlZlN0cik7CiAg\nICAgICAgaWYgKG5vdE51bGwgIT0gbnVsbCkKICAgICAgICAgICAgY29sLnNl\ndE5vdE51bGwobm90TnVsbC5ib29sZWFuVmFsdWUoKSk7CgogICAgICAgIC8v\nIGFkZCBvdGhlciBkZXRhaWxzIGlmIGFkYXB0aW5nCiAgICAgICAgaWYgKGFk\nYXB0KSB7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgY29sLnNldFR5cGVOYW1lKHR5cGVOYW1lKTsKICAgICAg\nICAgICAgaWYgKHNpemUgIT0gMCkKICAgICAgICAgICAgICAgIGNvbC5zZXRT\naXplKHNpemUpOwogICAgICAgICAgICBpZiAoZGVjaW1hbHMgIT0gMCkKICAg\nICAgICAgICAgICAgIGNvbC5zZXREZWNpbWFsRGlnaXRzKGRlY2ltYWxzKTsK\nICAgICAgICB9CgogICAgICAgIGlmICh0bXBsYXRlLmhhc0NvbW1lbnQoKSkK\nICAgICAgICAgICAgY29sLnNldENvbW1lbnQodG1wbGF0ZS5nZXRDb21tZW50\nKCkpOwogICAgICAgIGlmICh0bXBsYXRlLmlzWE1MKCkpCiAgICAgICAgICAg\nIGNvbC5zZXRYTUwodG1wbGF0ZS5pc1hNTCgpKTsKICAgICAgICByZXR1cm4g\nY29sOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUgdGFibGUgbmFt\nZWQgYnkgYSBjb2x1bW4gb3IgdGFyZ2V0LgogICAgICoKICAgICAqIEBwYXJh\nbSBjb250ZXh0IGNvbnRleHQgZm9yIGVycm9yIG1lc3NhZ2VzLCBldGMuCiAg\nICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFibGUgbmFtZSwgcG9zc2libHkgaW5j\nbHVkaW5nIHNjaGVtYQogICAgICogQHBhcmFtIGV4cGVjdGVkIHRoZSBleHBl\nY3RlZCB0YWJsZTsgbWF5IGJlIG51bGwKICAgICAqIEBwYXJhbSBpbnZlcnNl\nIHRoZSBwb3NzaWJsZSBpbnZlcnNlIHRhYmxlOyBtYXkgYmUgbnVsbAogICAg\nICogQHBhcmFtIHJlbCBpZiB3ZSdyZSBmaW5kaW5nIHRoZSB0YXJnZXQgdGFi\nbGUgb2YgYSBqb2luLCB0aGUKICAgICAqIGpvaW5lZC10byB0eXBlOyBhbGxv\nd3MgdXMgdG8gYWxzbyBsb29rIGluIGl0cyBzdXBlcmNsYXNzIHRhYmxlcwog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBUYWJsZSBmaW5kVGFibGUoTWV0\nYURhdGFDb250ZXh0IGNvbnRleHQsIFN0cmluZyBuYW1lLAogICAgICAgIFRh\nYmxlIGV4cGVjdGVkLCBUYWJsZSBpbnZlcnNlLCBDbGFzc01hcHBpbmcgcmVs\nKSB7CiAgICAgICAgLy8gaXMgdGhpcyB0aGUgZXhwZWN0ZWQgdGFibGU/CiAg\nICAgICAgaWYgKGV4cGVjdGVkID09IG51bGwgJiYgcmVsICE9IG51bGwpCiAg\nICAgICAgICAgIGV4cGVjdGVkID0gcmVsLmdldFRhYmxlKCk7CiAgICAgICAg\naWYgKGV4cGVjdGVkICE9IG51bGwgJiYgaXNUYWJsZU5hbWUobmFtZSwgZXhw\nZWN0ZWQpKQogICAgICAgICAgICByZXR1cm4gZXhwZWN0ZWQ7CgogICAgICAg\nIC8vIGNoZWNrIGZvciBpbnZlcnNlCiAgICAgICAgaWYgKGludmVyc2UgIT0g\nbnVsbCAmJiBpc1RhYmxlTmFtZShuYW1lLCBpbnZlcnNlKSkKICAgICAgICAg\nICAgcmV0dXJuIGludmVyc2U7CgogICAgICAgIC8vIHN1cGVyY2xhc3MgdGFi\nbGU/CiAgICAgICAgaWYgKHJlbCAhPSBudWxsKQogICAgICAgICAgICByZWwg\nPSByZWwuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAg\nICAgd2hpbGUgKHJlbCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpc1Rh\nYmxlTmFtZShuYW1lLCByZWwuZ2V0VGFibGUoKSkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gcmVsLmdldFRhYmxlKCk7CiAgICAgICAgICAgIHJlbCA9IHJl\nbC5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICB9\nCgogICAgICAgIC8vIG5vbmUgb2YgdGhlIHBvc3NpYmxlIHRhYmxlcwogICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY29s\nLXdyb25nLXRhYmxlIiwgY29udGV4dCwKICAgICAgICAgICAgZXhwZWN0ZWQs\nIG5hbWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBuYW1lIG1hdGNoZXMgdGhlIGdpdmVuIHRhYmxlLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzVGFibGVOYW1lKFN0\ncmluZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBuYW1l\nLmVxdWFsc0lnbm9yZUNhc2UodGFibGUuZ2V0TmFtZSgpKQogICAgICAgICAg\nICB8fCBuYW1lLmVxdWFsc0lnbm9yZUNhc2UodGFibGUuZ2V0RnVsbE5hbWUo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXRyaWV2ZS9jcmVhdGUgYW4g\naW5kZXggb24gdGhlIGdpdmVuIGNvbHVtbnMgYnkgbWVyZ2luZyB0aGUgZ2l2\nZW4KICAgICAqIHRlbXBsYXRlIGluZm9ybWF0aW9uIHdpdGggYW55IHVzZXIt\ncHJvdmlkZWQgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGNv\nbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBhbiBpbmRleCBm\nb3IKICAgICAqIEBwYXJhbSBwcmVmaXggbG9jYWxpemVkIGVycm9yIG1lc3Nh\nZ2Uga2V5IHByZWZpeAogICAgICogQHBhcmFtIHRtcGxhdGUgdGVtcGxhdGUg\nZm9yIGV4cGVjdGVkIGluZGV4IGluZm9ybWF0aW9uCiAgICAgKiBAcGFyYW0g\nY29scyB0aGUgaW5kZXhlZCBjb2x1bW5zCiAgICAgKiBAcGFyYW0gYWRhcHQg\nd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBwaW5nIG9y\nIHNjaGVtYQogICAgICovCiAgICBwcm90ZWN0ZWQgSW5kZXggY3JlYXRlSW5k\nZXgoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFN0cmluZyBwcmVmaXgsCiAg\nICAgICAgSW5kZXggdG1wbGF0ZSwgQ29sdW1uW10gY29scywgYm9vbGVhbiBh\nZGFwdCkgewogICAgICAgIGlmIChwcmVmaXggPT0gbnVsbCkKICAgICAgICAg\nICAgcHJlZml4ID0gImdlbmVyaWMiOwoKICAgICAgICAvLyBjYW4ndCBjcmVh\ndGUgYW4gaW5kZXggaWYgdGhlcmUgYXJlIG5vIGNvbHMKICAgICAgICBpZiAo\nY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApIHsKICAgICAgICAg\nICAgaWYgKF9pZHggIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAg\nICAgICAgICAgICArICItbm8taW5kZXgtY29scyIsIGNvbnRleHQpKTsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBs\nb29rIGZvciBhbiBleGlzdGluZyBpbmRleCBvbiB0aGVzZSBjb2x1bW5zCiAg\nICAgICAgVGFibGUgdGFibGUgPSBjb2xzWzBdLmdldFRhYmxlKCk7CiAgICAg\nICAgSW5kZXhbXSBpZHhzID0gdGFibGUuZ2V0SW5kZXhlcygpOwogICAgICAg\nIEluZGV4IGV4aXN0ID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGlkeHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGlkeHNb\naV0uY29sdW1uc01hdGNoKGNvbHMpKSB7CiAgICAgICAgICAgICAgICBleGlz\ndCA9IGlkeHNbaV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGV4aXN0aW5nIGlu\nZGV4PwogICAgICAgIGlmICghX2NhbklkeCkgewogICAgICAgICAgICBpZiAo\nZXhpc3QgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICBpZiAoIWFkYXB0KQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCArICItaW5k\nZXgtZXhpc3RzIiwKICAgICAgICAgICAgICAgICAgICBjb250ZXh0KSk7CiAg\nICAgICAgICAgIHRhYmxlLnJlbW92ZUluZGV4KGV4aXN0KTsKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB3ZSBo\nYXZlIGFuIGV4aXN0aW5nIGluZGV4LCBtZXJnZSBnaXZlbiBpbmZvIGludG8g\naXQKICAgICAgICBpZiAoZXhpc3QgIT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoX2lkeCAhPSBudWxsICYmIF9pZHguaXNVbmlxdWUoKSAmJiAhZXhpc3Qu\naXNVbmlxdWUoKSkgewogICAgICAgICAgICAgICAgaWYgKCFhZGFwdCkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAgICAgICsgIi1p\nbmRleC1ub3QtdW5pcXVlIiwgY29udGV4dCkpOwogICAgICAgICAgICAgICAg\nZXhpc3Quc2V0VW5pcXVlKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybiBleGlzdDsKICAgICAgICB9CgogICAgICAgIC8vIGlmIG5v\nIGRlZmF1bHRzIHJldHVybiBudWxsCiAgICAgICAgTWFwcGluZ1JlcG9zaXRv\ncnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVw\nb3NpdG9yeSgpOwogICAgICAgIGJvb2xlYW4gZmlsbCA9IHJlcG9zLmdldE1h\ncHBpbmdEZWZhdWx0cygpLmRlZmF1bHRNaXNzaW5nSW5mbygpOwogICAgICAg\nIGlmIChfaWR4ID09IG51bGwgJiYgKHRtcGxhdGUgPT0gbnVsbCB8fCAoIWFk\nYXB0ICYmICFmaWxsKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBTdHJpbmcgbmFtZSA9IG51bGw7CiAgICAgICAgYm9vbGVhbiB1bnE7\nCiAgICAgICAgaWYgKF9pZHggIT0gbnVsbCkgewogICAgICAgICAgICBuYW1l\nID0gX2lkeC5nZXROYW1lKCk7CiAgICAgICAgICAgIHVucSA9IF9pZHguaXNV\nbmlxdWUoKTsKICAgICAgICAgICAgLy8gcHJlc2VydmUgbXVsdGlwbGUgY29s\ndW1ucyBpZiB0aGV5IGFyZSBzcGVjaWZpZWQgaW4gdGhlIGluZGV4CiAgICAg\nICAgICAgIGlmIChfaWR4LmdldENvbHVtbnMoKSAhPSBudWxsICYmIF9pZHgu\nZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDEpCiAgICAgICAgICAgICAgICBjb2xz\nID0gX2lkeC5nZXRDb2x1bW5zKCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgIHVucSA9IHRtcGxhdGUuaXNVbmlxdWUoKTsKCiAgICAgICAgLy8gaWYg\nbm8gbmFtZSBwcm92aWRlZCBieSB1c2VyIGluZm8sIG1ha2Ugb25lCiAgICAg\nICAgaWYgKG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAodG1wbGF0\nZSAhPSBudWxsKQogICAgICAgICAgICAgICAgbmFtZSA9IHRtcGxhdGUuZ2V0\nTmFtZSgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG5h\nbWUgPSBjb2xzWzBdLmdldE5hbWUoKTsKICAgICAgICAgICAgICAgIG5hbWUg\nPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKS5nZXRWYWxpZEluZGV4TmFtZShu\nYW1lLCB0YWJsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIEluZGV4IGlkeCA9IHRhYmxlLmFkZEluZGV4KG5hbWUpOwogICAgICAgIGlk\neC5zZXRVbmlxdWUodW5xKTsKICAgICAgICBpZHguc2V0Q29sdW1ucyhjb2xz\nKTsKICAgICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0cmlldmUvY3JlYXRlIGEgdW5pcXVlIGNvbnN0cmFpbnQgb24gdGhlIGdp\ndmVuIGNvbHVtbnMgYnkgbWVyZ2luZyB0aGUKICAgICAqIGdpdmVuIHRlbXBs\nYXRlIGluZm9ybWF0aW9uIHdpdGggYW55IHVzZXItcHJvdmlkZWQgaW5mb3Jt\nYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBp\nbmcgd2UncmUgcmV0cmlldmluZyBhIGNvbnN0cmFpbnQgZm9yCiAgICAgKiBA\ncGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBwcmVm\naXgKICAgICAqIEBwYXJhbSB0bXBsYXRlIHRlbXBsYXRlIGZvciBleHBlY3Rl\nZCB1bmlxdWUgaW5mb3JtYXRpb24KICAgICAqIEBwYXJhbSBjb2xzIHRoZSBj\nb25zdHJhaW50IGNvbHVtbnMKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVy\nIHdlIGNhbiBtb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1h\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBVbmlxdWUgY3JlYXRlVW5pcXVlKE1l\ndGFEYXRhQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgcHJlZml4LAogICAgICAg\nIFVuaXF1ZSB0bXBsYXRlLCBDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFkYXB0\nKSB7CiAgICAgICAgaWYgKHByZWZpeCA9PSBudWxsKQogICAgICAgICAgICBw\ncmVmaXggPSAiZ2VuZXJpYyI7CgogICAgICAgIC8vIGNhbid0IGNyZWF0ZSBh\nIGNvbnN0cmFpbnQgaWYgdGhlcmUgYXJlIG5vIGNvbHMKICAgICAgICBpZiAo\nY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApIHsKICAgICAgICAg\nICAgaWYgKF91bnEgIT0gbnVsbCB8fCB0bXBsYXRlICE9IG51bGwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAgKyAiLW5vLXVuaXF1ZS1j\nb2xzIiwgY29udGV4dCkpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9CgogICAgICAgIC8vIGxvb2sgZm9yIGFuIGV4aXN0aW5nIGNvbnN0\ncmFpbnQgb24gdGhlc2UgY29sdW1ucwogICAgICAgIFRhYmxlIHRhYmxlID0g\nY29sc1swXS5nZXRUYWJsZSgpOwogICAgICAgIFVuaXF1ZVtdIHVucXMgPSB0\nYWJsZS5nZXRVbmlxdWVzKCk7CiAgICAgICAgVW5pcXVlIGV4aXN0ID0gbnVs\nbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHVucXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKHVucXNbaV0uY29sdW1uc01hdGNoKGNv\nbHMpKSB7CiAgICAgICAgICAgICAgICBleGlzdCA9IHVucXNbaV07CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gcmVtb3ZlIGV4aXN0aW5nIHVuaXF1ZT8KICAgICAgICBpZiAo\nIV9jYW5VbnEpIHsKICAgICAgICAgICAgaWYgKGV4aXN0ID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCFh\nZGFwdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICIt\ndW5pcXVlLWV4aXN0cyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgdGFibGUu\ncmVtb3ZlVW5pcXVlKGV4aXN0KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyBubyBkZWZhdWx0czsgcmV0dXJuIGV4\naXN0aW5nIGNvbnN0cmFpbnQgKGlmIGFueSkKICAgICAgICBpZiAodG1wbGF0\nZSA9PSBudWxsICYmIF91bnEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGV4aXN0OwoKICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IChN\nYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAg\nICAgICAgaWYgKGV4aXN0ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF91\nbnEgIT0gbnVsbCAmJiBfdW5xLmlzRGVmZXJyZWQoKSAmJiAhZXhpc3QuaXNE\nZWZlcnJlZCgpKSB7CiAgICAgICAgICAgICAgICBMb2cgbG9nID0gcmVwb3Mu\nZ2V0TG9nKCk7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldChw\ncmVmaXggKyAiLWRlZmVyLXVuaXF1ZSIsIGNvbnRleHQpKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gZXhpc3Q7CiAgICAgICAgfQoKICAg\nICAgICAvLyBkaWN0IGNhbid0IGhhbmRsZSB1bmlxdWUgY29uc3RyYWludHM/\nCiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSByZXBvcy5nZXREQkRpY3Rp\nb25hcnkoKTsKICAgICAgICBpZiAoX3VucSAhPSBudWxsICYmICFkaWN0LnN1\ncHBvcnRzVW5pcXVlQ29uc3RyYWludHMpIHsKICAgICAgICAgICAgTG9nIGxv\nZyA9IHJlcG9zLmdldExvZygpOwogICAgICAgICAgICBpZiAobG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0\nKHByZWZpeCArICItdW5pcXVlLXN1cHBvcnQiLCBjb250ZXh0KSk7CiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVh\nbiBmaWxsID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1p\nc3NpbmdJbmZvKCk7CiAgICAgICAgaWYgKCFhZGFwdCAmJiAhZmlsbCAmJiBf\ndW5xID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBTdHJpbmcgbmFtZTsKICAgICAgICBib29sZWFuIGRlZmVycmVkOwogICAg\nICAgIGlmIChfdW5xICE9IG51bGwpIHsKICAgICAgICAgICAgbmFtZSA9IF91\nbnEuZ2V0TmFtZSgpOwogICAgICAgICAgICBkZWZlcnJlZCA9IF91bnEuaXNE\nZWZlcnJlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hbWUg\nPSB0bXBsYXRlLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVmZXJyZWQgPSB0\nbXBsYXRlLmlzRGVmZXJyZWQoKTsKICAgICAgICB9CgogICAgICAgIGlmIChk\nZWZlcnJlZCAmJiAhZGljdC5zdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMp\nIHsKICAgICAgICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCArICItY3JlYXRlLWRlZmVy\nLXVuaXF1ZSIsCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCwgZGljdC5w\nbGF0Zm9ybSkpOwogICAgICAgICAgICBkZWZlcnJlZCA9IGZhbHNlOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShuYW1lKSkgewogICAgICAgIAluYW1lID0gY29sc1swXS5nZXROYW1lKCk7\nCiAgICAgICAgCW5hbWUgPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKS5nZXRW\nYWxpZFVuaXF1ZU5hbWUobmFtZSwgdGFibGUpOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICBVbmlxdWUgdW5xID0gdGFibGUuYWRkVW5pcXVlKG5hbWUp\nOwogICAgICAgIHVucS5zZXREZWZlcnJlZChkZWZlcnJlZCk7CiAgICAgICAg\ndW5xLnNldENvbHVtbnMoY29scyk7CiAgICAgICAgcmV0dXJuIHVucTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHJpZXZlL2NyZWF0ZSBhIGZvcmVpZ24g\na2V5IChwb3NzaWJseSBsb2dpY2FsKSBvbiB0aGUgZ2l2ZW4gY29sdW1ucwog\nICAgICogYnkgbWVyZ2luZyB0aGUgZ2l2ZW4gdGVtcGxhdGUgaW5mb3JtYXRp\nb24gd2l0aCBhbnkgdXNlci1wcm92aWRlZAogICAgICogaW5mb3JtYXRpb24u\nCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2Un\ncmUgcmV0cmlldmluZyBhIGtleSBmb3IKICAgICAqIEBwYXJhbSBwcmVmaXgg\nbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICogQHBh\ncmFtIGdpdmVuIHRoZSBjb2x1bW5zIGdpdmVuIGJ5IHRoZSB1c2VyCiAgICAg\nKiBAcGFyYW0gZGVmIGRlZmF1bHRzIHByb3ZpZGVyCiAgICAgKiBAcGFyYW0g\ndGFibGUgdGhlIHRhYmxlIGZvciB0aGUga2V5CiAgICAgKiBAcGFyYW0gY2xz\nIHR5cGUgd2UncmUgam9pbmluZyBmcm9tCiAgICAgKiBAcGFyYW0gcmVsIHRh\ncmdldCB0eXBlIHdlJ3JlIGpvaW5pbmcgdG8KICAgICAqIEBwYXJhbSBpbnZl\ncnNhYmxlIHdoZXRoZXIgdGhlIGZvcmVpZ24ga2V5IGNhbiBiZSBpbnZlcnNl\nZAogICAgICogQHBhcmFtIGFkYXB0IHdoZXRoZXIgd2UgY2FuIG1vZGlmeSB0\naGUgZXhpc3RpbmcgbWFwcGluZyBvciBzY2hlbWEKICAgICAqLwogICAgcHJv\ndGVjdGVkIEZvcmVpZ25LZXkgY3JlYXRlRm9yZWlnbktleShNZXRhRGF0YUNv\nbnRleHQgY29udGV4dCwKICAgICAgICBTdHJpbmcgcHJlZml4LCBMaXN0IGdp\ndmVuLCBGb3JlaWduS2V5RGVmYXVsdHMgZGVmLCBUYWJsZSB0YWJsZSwKICAg\nICAgICBDbGFzc01hcHBpbmcgY2xzLCBDbGFzc01hcHBpbmcgcmVsLCBib29s\nZWFuIGludmVyc2FibGUsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBhc3Nl\ncnRUYWJsZShjb250ZXh0LCB0YWJsZSk7CiAgICAgICAgaWYgKHByZWZpeCA9\nPSBudWxsKQogICAgICAgICAgICBwcmVmaXggPSAiZ2VuZXJpYyI7CgogICAg\nICAgIC8vIGNvbGxlY3QgdGhlIGZvcmVpZ24ga2V5IGNvbHVtbnMgYW5kIHRo\nZWlyIHRhcmdldHMKICAgICAgICBPYmplY3RbXVtdIGpvaW5zID0gY3JlYXRl\nSm9pbnMoY29udGV4dCwgcHJlZml4LCB0YWJsZSwgY2xzLCByZWwsCiAgICAg\nICAgICAgIGdpdmVuLCBkZWYsIGludmVyc2FibGUsIGFkYXB0KTsKICAgICAg\nICBfam9pbiA9IEpPSU5fRk9SV0FSRDsKCiAgICAgICAgLy8gZXN0YWJsaXNo\nIGxvY2FsIHRhYmxlIHVzaW5nIGFueSBqb2luIGJldHdlZW4gdHdvIGNvbHVt\nbnM7IGlmIHdlIG9ubHkKICAgICAgICAvLyBmaW5kIGNvbnN0YW50IGpvaW5z\nLCB0aGVuIGtlZXAgZGVmYXVsdCBsb2NhbCB0YWJsZSAoZGlyZWN0aW9ubGVz\ncykKICAgICAgICBUYWJsZSBsb2NhbCA9IHRhYmxlOwogICAgICAgIFRhYmxl\nIGZvcmVpZ24gPSByZWwuZ2V0VGFibGUoKTsKICAgICAgICBUYWJsZSB0bXA7\nCiAgICAgICAgYm9vbGVhbiBjb25zdGFudCA9IGZhbHNlOwogICAgICAgIGJv\nb2xlYW4gbG9jYWxTZXQgPSBmYWxzZTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChq\nb2luc1tpXVsxXWluc3RhbmNlb2YgQ29sdW1uKSB7CiAgICAgICAgICAgICAg\nICB0bXAgPSAoKENvbHVtbikgam9pbnNbaV1bMF0pLmdldFRhYmxlKCk7CiAg\nICAgICAgICAgICAgICBpZiAoIWxvY2FsU2V0KSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9jYWwgPSB0bXA7CiAgICAgICAgICAgICAgICAgICAgbG9jYWxT\nZXQgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0bXAgIT0g\nbG9jYWwpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAg\nICAgICArICItbXVsdC1may10YWJsZXMiLCBjb250ZXh0LCBsb2NhbCwgdG1w\nKSk7CiAgICAgICAgICAgICAgICBmb3JlaWduID0gKChDb2x1bW4pIGpvaW5z\nW2ldWzFdKS5nZXRUYWJsZSgpOwoKICAgICAgICAgICAgICAgIGlmIChqb2lu\nc1tpXVsyXSA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICAgICAg\nX2pvaW4gPSBKT0lOX0lOVkVSU0U7CiAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgY29uc3RhbnQgPSB0cnVlOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgdGhpcyBpcyBub3QgYSBjb25zdGFudCBqb2luLCBsb29rIGZv\nciBleGlzdGluZyBmb3JlaWduIGtleQogICAgICAgIC8vIG9uIGxvY2FsIGNv\nbHVtbnMKICAgICAgICBGb3JlaWduS2V5IGV4aXN0ID0gbnVsbDsKICAgICAg\nICBpZiAoIWNvbnN0YW50ICYmIGxvY2FsLmdldEZvcmVpZ25LZXlzKCkubGVu\nZ3RoID4gMCkgewogICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gbmV3IENv\nbHVtbltqb2lucy5sZW5ndGhdOwogICAgICAgICAgICBDb2x1bW5bXSBwa3Mg\nPSBuZXcgQ29sdW1uW2pvaW5zLmxlbmd0aF07CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGNvbHNbaV0gPSAoQ29sdW1uKSBqb2luc1tpXVswXTsKICAgICAg\nICAgICAgICAgIHBrc1tpXSA9IChDb2x1bW4pIGpvaW5zW2ldWzFdOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBGb3JlaWduS2V5W10gZmtzID0gbG9j\nYWwuZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBma3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlm\nIChma3NbaV0uZ2V0Q29uc3RhbnRDb2x1bW5zKCkubGVuZ3RoID09IDAKICAg\nICAgICAgICAgICAgICAgICAmJiBma3NbaV0uZ2V0Q29uc3RhbnRQcmltYXJ5\nS2V5Q29sdW1ucygpLmxlbmd0aCA9PSAwCiAgICAgICAgICAgICAgICAgICAg\nJiYgZmtzW2ldLmNvbHVtbnNNYXRjaChjb2xzLCBwa3MpKSB7CiAgICAgICAg\nICAgICAgICAgICAgZXhpc3QgPSBma3NbaV07CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1h\ncHBpbmdSZXBvc2l0b3J5KSBjb250ZXh0LmdldFJlcG9zaXRvcnkoKTsKICAg\nICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IHJlcG9zLmdldERCRGljdGlvbmFy\neSgpOwogICAgICAgIGlmIChleGlzdCAhPSBudWxsKSB7CiAgICAgICAgICAg\nIC8vIG1ha2UgZXhpc3Rpbmcga2V5IGxvZ2ljYWw/CiAgICAgICAgICAgIGlm\nICghX2NhbkZLKSB7CiAgICAgICAgICAgICAgICBpZiAoZXhpc3QuZ2V0RGVs\nZXRlQWN0aW9uKCkgIT0gZXhpc3QuQUNUSU9OX05PTkUgJiYgIWFkYXB0KQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nLWZrLWV4aXN0cyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgICAgIGV4aXN0\nLnNldERlbGV0ZUFjdGlvbihleGlzdC5BQ1RJT05fTk9ORSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmIChfZmsgIT0gbnVsbCAmJiBfZmsuaXNE\nZWZlcnJlZCgpICYmICFleGlzdC5pc0RlZmVycmVkKCkpIHsKICAgICAgICAg\nICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCArICItZGVmZXItZmsiLCBj\nb250ZXh0KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFsbG93\nIHVzZXItZ2l2ZW4gaW5mbyB0byBvdmVycmlkZSBleGlzdGluZyBrZXkgaWYg\nd2UncmUgYWRhcHRpbmc7CiAgICAgICAgICAgIC8vIHRlbXBsYXRlIGluZm8g\nY2Fubm90IG92ZXJyaWRlIGV4aXN0aW5nIGtleQogICAgICAgICAgICBpZiAo\nYWRhcHQgJiYgX2ZrICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChf\nZmsuZ2V0VXBkYXRlQWN0aW9uKCkgIT0gRm9yZWlnbktleS5BQ1RJT05fTk9O\nRSkKICAgICAgICAgICAgICAgICAgICBleGlzdC5zZXRVcGRhdGVBY3Rpb24o\nX2ZrLmdldFVwZGF0ZUFjdGlvbigpKTsKICAgICAgICAgICAgICAgIGlmIChf\nZmsuZ2V0RGVsZXRlQWN0aW9uKCkgIT0gRm9yZWlnbktleS5BQ1RJT05fTk9O\nRSkKICAgICAgICAgICAgICAgICAgICBleGlzdC5zZXREZWxldGVBY3Rpb24o\nX2ZrLmdldERlbGV0ZUFjdGlvbigpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBzZXRJT0Zyb21Kb2lucyhleGlzdCwgam9pbnMpOwogICAgICAgICAg\nICByZXR1cm4gZXhpc3Q7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgbmFt\nZSA9IG51bGw7CiAgICAgICAgaW50IGRlbEFjdGlvbiA9IEZvcmVpZ25LZXku\nQUNUSU9OX05PTkU7CiAgICAgICAgaW50IHVwQWN0aW9uID0gRm9yZWlnbktl\neS5BQ1RJT05fTk9ORTsKICAgICAgICBib29sZWFuIGRlZmVycmVkID0gZmFs\nc2U7CiAgICAgICAgYm9vbGVhbiBmaWxsID0gcmVwb3MuZ2V0TWFwcGluZ0Rl\nZmF1bHRzKCkuZGVmYXVsdE1pc3NpbmdJbmZvKCk7CiAgICAgICAgRm9yZWln\nbktleSB0bXBsYXRlID0gKGRlZiA9PSBudWxsKSA/IG51bGwKICAgICAgICAg\nICAgOiBkZWYuZ2V0KGxvY2FsLCBmb3JlaWduLCBfam9pbiA9PSBKT0lOX0lO\nVkVSU0UpOwogICAgICAgIGlmIChfZmsgIT0gbnVsbCAmJiAodG1wbGF0ZSA9\nPSBudWxsIHx8ICghYWRhcHQgJiYgIWZpbGwpKSkgewogICAgICAgICAgICAv\nLyBpZiBub3QgYWRhcHRpbmcgb3Igbm8gdGVtcGxhdGUgaW5mbyB1c2UgZ2l2\nZW4gZGF0YQogICAgICAgICAgICBuYW1lID0gX2ZrLmdldE5hbWUoKTsKICAg\nICAgICAgICAgZGVsQWN0aW9uID0gX2ZrLmdldERlbGV0ZUFjdGlvbigpOwog\nICAgICAgICAgICB1cEFjdGlvbiA9IF9may5nZXRVcGRhdGVBY3Rpb24oKTsK\nICAgICAgICAgICAgZGVmZXJyZWQgPSBfZmsuaXNEZWZlcnJlZCgpOwogICAg\nICAgIH0gZWxzZSBpZiAoX2NhbkZLICYmIChhZGFwdCB8fCBmaWxsKSkgewog\nICAgICAgICAgICBpZiAoX2ZrID09IG51bGwgJiYgdG1wbGF0ZSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBubyB1c2VyIGdpdmVuIGluZm87IHVz\nZSB0ZW1wbGF0ZSBkYXRhCiAgICAgICAgICAgICAgICBuYW1lID0gdG1wbGF0\nZS5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICBkZWxBY3Rpb24gPSB0bXBs\nYXRlLmdldERlbGV0ZUFjdGlvbigpOwogICAgICAgICAgICAgICAgdXBBY3Rp\nb24gPSB0bXBsYXRlLmdldFVwZGF0ZUFjdGlvbigpOwogICAgICAgICAgICAg\nICAgZGVmZXJyZWQgPSB0bXBsYXRlLmlzRGVmZXJyZWQoKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChfZmsgIT0gbnVsbCAmJiB0bXBsYXRlICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIC8vIG1lcmdlIHVzZXIgYW5kIHRlbXBsYXRl\nIGRhdGEsIGFsd2F5cyBsZXR0aW5nIHVzZXIgaW5mbyB3aW4KICAgICAgICAg\nICAgICAgIG5hbWUgPSBfZmsuZ2V0TmFtZSgpOwogICAgICAgICAgICAgICAg\naWYgKG5hbWUgPT0gbnVsbCAmJiB0bXBsYXRlLmdldE5hbWUoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSB0bXBsYXRlLmdldE5hbWUo\nKTsKICAgICAgICAgICAgICAgIGRlbEFjdGlvbiA9IF9may5nZXREZWxldGVB\nY3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmIChkZWxBY3Rpb24gPT0gRm9y\nZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgICAgICAgICBkZWxB\nY3Rpb24gPSB0bXBsYXRlLmdldERlbGV0ZUFjdGlvbigpOwogICAgICAgICAg\nICAgICAgdXBBY3Rpb24gPSBfZmsuZ2V0VXBkYXRlQWN0aW9uKCk7CiAgICAg\nICAgICAgICAgICBpZiAodXBBY3Rpb24gPT0gRm9yZWlnbktleS5BQ1RJT05f\nTk9ORSkKICAgICAgICAgICAgICAgICAgICB1cEFjdGlvbiA9IHRtcGxhdGUu\nZ2V0VXBkYXRlQWN0aW9uKCk7CiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9\nIF9may5pc0RlZmVycmVkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGlmICghZGljdC5zdXBwb3J0c0RlbGV0ZUFjdGlvbihkZWxBY3Rp\nb24pCiAgICAgICAgICAgIHx8ICFkaWN0LnN1cHBvcnRzVXBkYXRlQWN0aW9u\nKHVwQWN0aW9uKSkgewogICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0\nTG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4ICsgIi11\nbnN1cHBvcnRlZC1may1hY3Rpb24iLCBjb250ZXh0KSk7CiAgICAgICAgICAg\nIGRlbEFjdGlvbiA9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAg\nICAgIHVwQWN0aW9uID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAg\nICB9CiAgICAgICAgaWYgKGRlZmVycmVkICYmICFkaWN0LnN1cHBvcnRzRGVm\nZXJyZWRDb25zdHJhaW50cykgewogICAgICAgICAgICBMb2cgbG9nID0gcmVw\nb3MuZ2V0TG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4\nICsgIi1jcmVhdGUtZGVmZXItZmsiLAogICAgICAgICAgICAgICAgICAgIGNv\nbnRleHQsIGRpY3QucGxhdGZvcm0pKTsKICAgICAgICAgICAgZGVmZXJyZWQg\nPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBmb3JlaWdu\nIGtleSB3aXRoIG1lcmdlZCBpbmZvCiAgICAgICAgRm9yZWlnbktleSBmayA9\nIGxvY2FsLmFkZEZvcmVpZ25LZXkobmFtZSk7CiAgICAgICAgZmsuc2V0RGVs\nZXRlQWN0aW9uKGRlbEFjdGlvbik7CiAgICAgICAgZmsuc2V0VXBkYXRlQWN0\naW9uKHVwQWN0aW9uKTsKICAgICAgICBmay5zZXREZWZlcnJlZChkZWZlcnJl\nZCk7CgogICAgICAgIC8vIGFkZCBqb2lucyB0byBrZXkKICAgICAgICBDb2x1\nbW4gY29sOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29sID0gKENvbHVtbikgam9pbnNb\naV1bMF07CiAgICAgICAgICAgIGlmIChqb2luc1tpXVsxXWluc3RhbmNlb2Yg\nQ29sdW1uKQogICAgICAgICAgICAgICAgZmsuam9pbihjb2wsIChDb2x1bW4p\nIGpvaW5zW2ldWzFdKTsKICAgICAgICAgICAgZWxzZSBpZiAoKGpvaW5zW2ld\nWzJdID09IEJvb2xlYW4uVFJVRSkgIT0gKF9qb2luID09IEpPSU5fSU5WRVJT\nRSkpCiAgICAgICAgICAgICAgICBmay5qb2luQ29uc3RhbnQoam9pbnNbaV1b\nMV0sIGNvbCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZr\nLmpvaW5Db25zdGFudChjb2wsIGpvaW5zW2ldWzFdKTsKICAgICAgICB9CiAg\nICAgICAgc2V0SU9Gcm9tSm9pbnMoZmssIGpvaW5zKTsKICAgICAgICByZXR1\ncm4gZms7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGpvaW4gaW5m\nb3JtYXRpb24gdG8gcG9wdWxhdGUgb3VyIGludGVybmFsIGNvbHVtbiBJL08g\nZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNldElPRnJvbUpvaW5z\nKEZvcmVpZ25LZXkgZmssIE9iamVjdFtdW10gam9pbnMpIHsKICAgICAgICBM\naXN0IGNvbHMgPSBnZXRDb2x1bW5zKCk7CiAgICAgICAgX2lvID0gbnVsbDsK\nICAgICAgICBpZiAoY29scy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgaW50IGNvbnN0SWR4ID0gMDsKICAgICAgICBpbnQgaWR4\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgLy8gY29uc3QgY29sdW1ucyBhcmUgaW5kZXhl\nZCBhZnRlciBzdGQgam9pbiBjb2x1bW5zIGluIGZrIElPCiAgICAgICAgICAg\nIGlmIChqb2luc1tpXVsxXWluc3RhbmNlb2YgQ29sdW1uKQogICAgICAgICAg\nICAgICAgaWR4ID0gaSAtIGNvbnN0SWR4OwogICAgICAgICAgICBlbHNlIGlm\nICgoam9pbnNbaV1bMl0gPT0gQm9vbGVhbi5UUlVFKSA9PSAoX2pvaW4gPT0g\nSk9JTl9JTlZFUlNFKSkKICAgICAgICAgICAgICAgIGlkeCA9IGZrLmdldENv\nbHVtbnMoKS5sZW5ndGggKyBjb25zdElkeCsrOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgc2V0SU9G\ncm9tQ29sdW1uRmxhZ3MoKENvbHVtbikgY29scy5nZXQoaSksIGlkeCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIG9yIHJldHJp\nZXZlIHRoZSBmb3JlaWduIGtleSBqb2lucy4KICAgICAqCiAgICAgKiBAcGFy\nYW0gY29udGV4dCB0aGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2aW5nIGEga2V5\nIGZvcgogICAgICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJyb3IgbWVz\nc2FnZSBrZXkgcHJlZml4CiAgICAgKiBAcGFyYW0gdGFibGUgdGhlIHRhYmxl\nIGZvciB0aGUga2V5CiAgICAgKiBAcGFyYW0gY2xzIHR5cGUgd2UncmUgam9p\nbmluZyBmcm9tLCBpZiBhcHBsaWNhYmxlCiAgICAgKiBAcGFyYW0gcmVsIHRh\ncmdldCB0eXBlIHdlJ3JlIGpvaW5pbmcgdG8KICAgICAqIEBwYXJhbSBnaXZl\nbiB0aGUgY29sdW1ucyBnaXZlbiBieSB0aGUgdXNlcgogICAgICogQHBhcmFt\nIGRlZiBmb3JlaWduIGtleSBkZWZhdWx0cyBwcm92aWRlcgogICAgICogQHBh\ncmFtIGludmVyc2FibGUgd2hldGhlciB0aGUgZm9yZWlnbiBrZXkgY2FuIGJl\nIGludmVyc2VkCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hldGhlciB3ZSBjYW4g\nbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBwaW5nIG9yIHNjaGVtYQogICAgICog\nQHJldHVybiBhcnJheSBvZiB0dXBsZXMgd2hlcmUgdGhlIGZpcnN0IGVsZW1l\nbnQgaXMgdGhlCiAgICAgKiBsb2NhbCBjb2x1bW4gKG9yIGluIHRoZSBjYXNl\nIG9mIGEgY29uc3RhbnQgam9pbiB0aGUKICAgICAqIHNvbGUgY29sdW1uKSwg\ndGhlIHNlY29uZCBpcyB0aGUgdGFyZ2V0IGNvbHVtbiAob3IKICAgICAqIGNv\nbnN0YW50KSwgYW5kIHRoZSB0aGlyZCBpcyB7QGxpbmsgQm9vbGVhbiNUUlVF\nfSBpZgogICAgICogdGhpcyBpcyBhbiBpbnZlcnNlIGpvaW4KICAgICAqLwog\nICAgcHJpdmF0ZSBPYmplY3RbXVtdIGNyZWF0ZUpvaW5zKE1ldGFEYXRhQ29u\ndGV4dCBjb250ZXh0LAogICAgICAgIFN0cmluZyBwcmVmaXgsIFRhYmxlIHRh\nYmxlLCBDbGFzc01hcHBpbmcgY2xzLCBDbGFzc01hcHBpbmcgcmVsLAogICAg\nICAgIExpc3QgZ2l2ZW4sIEZvcmVpZ25LZXlEZWZhdWx0cyBkZWYsIGJvb2xl\nYW4gaW52ZXJzYWJsZSwgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIE1hcHBp\nbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBjb250\nZXh0LmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBib29sZWFuIGZpbGwgPSBy\nZXBvcy5nZXRNYXBwaW5nRGVmYXVsdHMoKS5kZWZhdWx0TWlzc2luZ0luZm8o\nKTsKICAgICAgICBPYmplY3RbXVtdIGpvaW5zOwoKICAgICAgICAvLyBpZiBu\nbyBjb2x1bW5zIGdpdmVuLCBqdXN0IGNyZWF0ZSBtaXJyb3JzIG9mIHRhcmdl\ndCBjb2x1bW5zCiAgICAgICAgaWYgKGdpdmVuLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICBpZiAoIWFkYXB0ICYmICFmaWxsKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCAr\nICItbm8tZmstY29scyIsCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCkp\nOwoKICAgICAgICAgICAgQ29sdW1uW10gdGFyZ2V0cyA9IHJlbC5nZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpOwogICAgICAgICAgICBqb2lucyA9IG5ldyBPYmpl\nY3RbdGFyZ2V0cy5sZW5ndGhdWzNdOwogICAgICAgICAgICBDb2x1bW4gdG1w\nbGF0ZTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0YXJnZXRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0bXBsYXRlID0gbmV3\nIENvbHVtbigpOwogICAgICAgICAgICAgICAgdG1wbGF0ZS5zZXROYW1lKHRh\ncmdldHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIHRtcGxhdGUu\nc2V0SmF2YVR5cGUodGFyZ2V0c1tpXS5nZXRKYXZhVHlwZSgpKTsKICAgICAg\nICAgICAgICAgIHRtcGxhdGUuc2V0VHlwZSh0YXJnZXRzW2ldLmdldFR5cGUo\nKSk7CiAgICAgICAgICAgICAgICB0bXBsYXRlLnNldFR5cGVOYW1lKHRhcmdl\ndHNbaV0uZ2V0VHlwZU5hbWUoKSk7CiAgICAgICAgICAgICAgICB0bXBsYXRl\nLnNldFNpemUodGFyZ2V0c1tpXS5nZXRTaXplKCkpOwogICAgICAgICAgICAg\nICAgdG1wbGF0ZS5zZXREZWNpbWFsRGlnaXRzKHRhcmdldHNbaV0uZ2V0RGVj\naW1hbERpZ2l0cygpKTsKCiAgICAgICAgICAgICAgICBpZiAoZGVmICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgZGVmLnBvcHVsYXRlKHRhYmxlLCBy\nZWwuZ2V0VGFibGUoKSwgdG1wbGF0ZSwgdGFyZ2V0c1tpXSwKICAgICAgICAg\nICAgICAgICAgICAgICAgZmFsc2UsIGksIHRhcmdldHMubGVuZ3RoKTsKICAg\nICAgICAgICAgICAgIGpvaW5zW2ldWzBdID0gbWVyZ2VDb2x1bW4oY29udGV4\ndCwgcHJlZml4LCB0bXBsYXRlLCB0cnVlLAogICAgICAgICAgICAgICAgICAg\nIG51bGwsIHRhYmxlLCBhZGFwdCwgZmlsbCk7CiAgICAgICAgICAgICAgICBq\nb2luc1tpXVsxXSA9IHRhcmdldHNbaV07CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuIGpvaW5zOwogICAgICAgIH0KCiAgICAgICAgLy8gdXNl\nIGdpdmVuIGNvbHVtbnMgdG8gY3JlYXRlIGpvaW4uICB3ZSBkb24ndCB0cnkg\ndG8gdXNlIGFueSBvZiB0aGUKICAgICAgICAvLyB0ZW1wbGF0ZSBjb2x1bW5z\nLCBldmVuIGlmIHRoZSB1c2VyIGRvZXNuJ3QgZ2l2ZSBhIGNvbHVtbiBsaW5r\naW5nIHRvCiAgICAgICAgLy8gZXZlcnkgcHJpbWFyeSBrZXkgb2YgdGhlIHRh\ncmdldCB0eXBlIC0tIHVzZXJzIGFyZSBhbGxvd2VkIHRvIGNyZWF0ZQogICAg\nICAgIC8vIHBhcnRpYWwgam9pbnMuICB0aGlzIG1lYW5zLCB0aG91Z2gsIHRo\nYXQgaWYgYSB1c2VyIHdhbnRzIHRvIHNwZWNpZnkKICAgICAgICAvLyBpbmZv\nIGZvciBvbmUgam9pbiBjb2x1bW4sIGhlIGhhcyB0byBhdCBsZWFzdCBjcmVh\ndGUgZWxlbWVudHMgZm9yCiAgICAgICAgLy8gYWxsIG9mIHRoZW0KCiAgICAg\nICAgam9pbnMgPSBuZXcgT2JqZWN0W2dpdmVuLnNpemUoKV1bM107CiAgICAg\nICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpv\naW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbCA9IChDb2x1bW4p\nIGdpdmVuLmdldChpKTsKICAgICAgICAgICAgbWVyZ2VKb2luQ29sdW1uKGNv\nbnRleHQsIHByZWZpeCwgY29sLCBqb2lucywgaSwgdGFibGUsIGNscywgcmVs\nLAogICAgICAgICAgICAgICAgZGVmLCBpbnZlcnNhYmxlICYmICFjb2wuZ2V0\nRmxhZyhDb2x1bW4uRkxBR19QS19KT0lOKSwgYWRhcHQsCiAgICAgICAgICAg\nICAgICBmaWxsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpvaW5zOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIG9yIHJldHJpZXZlIGEgZm9y\nZWlnbiBrZXkgY29sdW1uIGZvciBhIGpvaW4uCiAgICAgKgogICAgICogQHBh\ncmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBhIGtl\neSBmb3IKICAgICAqIEBwYXJhbSBwcmVmaXggbG9jYWxpemVkIGVycm9yIG1l\nc3NhZ2Uga2V5IHByZWZpeAogICAgICogQHBhcmFtIGdpdmVuIHRoZSBnaXZl\nbiBsb2NhbCBmb3JlaWduIGtleSBjb2x1bW4KICAgICAqIEBwYXJhbSBqb2lu\ncyBhcnJheSBvZiBqb2lucwogICAgICogQHBhcmFtIGlkeCBpbmRleCBvZiB0\naGUgam9pbiBhcnJheSB0byBwb3B1bGF0ZQogICAgICogQHBhcmFtIHRhYmxl\nIHRoZSB0YWJsZSBmb3IgdGhlIGtleQogICAgICogQHBhcmFtIGNscyB0aGUg\ndHlwZSB3ZSdyZSBqb2luaW5nIGZyb20KICAgICAqIEBwYXJhbSByZWwgdGFy\nZ2V0IHR5cGUgd2UncmUgam9pbmluZyB0bwogICAgICogQHBhcmFtIGRlZiBm\nb3JlaWduIGtleSBkZWZhdWx0cyBwcm92aWRlcjsKICAgICAqIHVzZSBudWxs\nIHRvIG1pcnJvciB0YXJnZXQgY29sdW1uIG5hbWVzCiAgICAgKiBAcGFyYW0g\naW52ZXJzYWJsZSB3aGV0aGVyIHRoZSBmb3JlaWduIGtleSBjYW4gYmUgaW52\nZXJzZWQKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBtb2Rp\nZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKiBAcGFy\nYW0gZmlsbCB3aGV0aGVyIHRvIGRlZmF1bHQgbWlzc2luZyBjb2x1bW4gaW5m\nb3JtYXRpb24KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1lcmdlSm9pbkNv\nbHVtbihNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgU3RyaW5nIHByZWZpeCwK\nICAgICAgICBDb2x1bW4gZ2l2ZW4sIE9iamVjdFtdW10gam9pbnMsIGludCBp\nZHgsIFRhYmxlIHRhYmxlLCBDbGFzc01hcHBpbmcgY2xzLAogICAgICAgIENs\nYXNzTWFwcGluZyByZWwsIEZvcmVpZ25LZXlEZWZhdWx0cyBkZWYsIGJvb2xl\nYW4gaW52ZXJzYWJsZSwKICAgICAgICBib29sZWFuIGFkYXB0LCBib29sZWFu\nIGZpbGwpIHsKICAgICAgICAvLyBkZWZhdWx0IHRvIHRoZSBwcmltYXJ5IGtl\neSBjb2x1bW4gbmFtZSBpZiB0aGlzIGlzIGEgcGsgam9pbgogICAgICAgIFN0\ncmluZyBuYW1lID0gZ2l2ZW4uZ2V0TmFtZSgpOwogICAgICAgIGlmIChuYW1l\nID09IG51bGwgJiYgZ2l2ZW4gIT0gbnVsbAogICAgICAgICAgICAmJiBnaXZl\nbi5nZXRGbGFnKENvbHVtbi5GTEFHX1BLX0pPSU4pICYmIGNscyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIENvbHVtbltdIHBrcyA9IGNscy5nZXRQcmltYXJ5\nS2V5Q29sdW1ucygpOwogICAgICAgICAgICBpZiAocGtzLmxlbmd0aCA9PSAx\nKQogICAgICAgICAgICAgICAgbmFtZSA9IHBrc1swXS5nZXROYW1lKCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZiB3ZSBjYW4ndCBhZGFwdCwgdGhlbiB0\naGUgdXNlciBtdXN0IGF0IGxlYXN0IGdpdmUgYSBjb2x1bW4gbmFtZQogICAg\nICAgIGlmIChuYW1lID09IG51bGwgJiYgIWFkYXB0ICYmICFmaWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\ncHJlZml4ICsgIi1uby1ma2NvbC1uYW1lIiwKICAgICAgICAgICAgICAgIGNv\nbnRleHQpKTsKCiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBjb2x1\nbW4gaXNuJ3QgaW4gdGhlIGV4cGVjdGVkIHRhYmxlOyBpdCBtaWdodAogICAg\nICAgIC8vIGJlIGFuIGludmVyc2Ugam9pbiBvciBhIGpvaW4gdG8gYSBiYXNl\nIGNsYXNzIG9mIHRoZSB0YXJnZXQgdHlwZQogICAgICAgIFRhYmxlIGxvY2Fs\nID0gdGFibGU7CiAgICAgICAgVGFibGUgZm9yZWlnbiA9IHJlbC5nZXRUYWJs\nZSgpOwogICAgICAgIGJvb2xlYW4gZnVsbE5hbWUgPSBmYWxzZTsKICAgICAg\nICBib29sZWFuIGludmVyc2UgPSBmYWxzZTsKICAgICAgICBpZiAobmFtZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGludCBkb3RJZHggPSBuYW1lLmxhc3RJ\nbmRleE9mKCcuJyk7CiAgICAgICAgICAgIGlmIChkb3RJZHggIT0gLTEpIHsK\nICAgICAgICAgICAgICAgIC8vIGFsbG93IHVzZSBvZiAnLicgd2l0aG91dCBw\ncmVmaXggdG8gbWVhbiAidXNlIGV4cGVjdGVkCiAgICAgICAgICAgICAgICAv\nLyBmb3JlaWduIHRhYmxlIgogICAgICAgICAgICAgICAgaWYgKGRvdElkeCA9\nPSAwKQogICAgICAgICAgICAgICAgICAgIGxvY2FsID0gZm9yZWlnbjsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2NhbCA9\nIGZpbmRUYWJsZShjb250ZXh0LCBuYW1lLnN1YnN0cmluZygwLCBkb3RJZHgp\nLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCwgZm9yZWlnbiwgbnVs\nbCk7CiAgICAgICAgICAgICAgICBmdWxsTmFtZSA9IHRydWU7CiAgICAgICAg\nICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7Cgog\nICAgICAgICAgICAgICAgLy8gaWYgaW52ZXJzZSBqb2luLCB0aGVuIHN3YXAg\nbG9jYWwgYW5kIGZvcmVpZ24gdGFibGVzCiAgICAgICAgICAgICAgICBpZiAo\nbG9jYWwgIT0gdGFibGUpIHsKICAgICAgICAgICAgICAgICAgICBmb3JlaWdu\nID0gdGFibGU7CiAgICAgICAgICAgICAgICAgICAgaW52ZXJzZSA9IHRydWU7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgYm9vbGVhbiBmb3JjZUludmVyc2UgPSAhZnVsbE5hbWUgJiYgX2pv\naW4gPT0gSk9JTl9JTlZFUlNFOwogICAgICAgIGlmIChmb3JjZUludmVyc2Up\nIHsKICAgICAgICAgICAgbG9jYWwgPSBmb3JlaWduOwogICAgICAgICAgICBm\nb3JlaWduID0gdGFibGU7CiAgICAgICAgICAgIGludmVyc2UgPSB0cnVlOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZGV0ZXJtaW5lIHRhcmdldAogICAgICAg\nIFN0cmluZyB0YXJnZXROYW1lID0gZ2l2ZW4uZ2V0VGFyZ2V0KCk7CiAgICAg\nICAgT2JqZWN0IHRhcmdldCA9IG51bGw7CiAgICAgICAgVGFibGUgdHRhYmxl\nID0gbnVsbDsKICAgICAgICBib29sZWFuIGNvbnN0YW50ID0gZmFsc2U7CiAg\nICAgICAgYm9vbGVhbiBmdWxsVGFyZ2V0ID0gZmFsc2U7CiAgICAgICAgaWYg\nKHRhcmdldE5hbWUgPT0gbnVsbCAmJiBnaXZlbi5nZXRUYXJnZXRGaWVsZCgp\nICE9IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRjbHMgPSAo\naW52ZXJzZSkgPyBjbHMgOiByZWw7CiAgICAgICAgICAgIFN0cmluZyBmaWVs\nZE5hbWUgPSBnaXZlbi5nZXRUYXJnZXRGaWVsZCgpOwogICAgICAgICAgICBp\nbnQgZG90SWR4ID0gZmllbGROYW1lLmxhc3RJbmRleE9mKCcuJyk7CiAgICAg\nICAgICAgIGZ1bGxUYXJnZXQgPSBkb3RJZHggIT0gLTE7CgogICAgICAgICAg\nICBpZiAoZG90SWR4ID09IDApIHsKICAgICAgICAgICAgICAgIC8vIGFsbG93\nIHVzZSBvZiAnLicgd2l0aG91dCBwcmVmaXggdG8gbWVhbiAidXNlIGV4cGVj\ndGVkIGxvY2FsCiAgICAgICAgICAgICAgICAvLyBjbHMiOyBidXQgaWYgd2Ug\nYWxyZWFkeSBpbnZlcnNlZCBubyBuZWVkIHRvIHN3aXRjaCBhZ2FpbgogICAg\nICAgICAgICAgICAgaWYgKCFpbnZlcnNlKQogICAgICAgICAgICAgICAgICAg\nIHRjbHMgPSBjbHM7CiAgICAgICAgICAgICAgICBmaWVsZE5hbWUgPSBmaWVs\nZE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRv\ndElkeCA+IDApIHsKICAgICAgICAgICAgICAgIC8vIG11c3QgYmUgY2xhc3Mg\nKyBmaWVsZCBuYW1lCiAgICAgICAgICAgICAgICB0Y2xzID0gZmluZENsYXNz\nTWFwcGluZyhjb250ZXh0LCBmaWVsZE5hbWUuc3Vic3RyaW5nCiAgICAgICAg\nICAgICAgICAgICAgKDAsIGRvdElkeCksIGNscywgcmVsKTsKICAgICAgICAg\nICAgICAgIGZpZWxkTmFtZSA9IGZpZWxkTmFtZS5zdWJzdHJpbmcoZG90SWR4\nICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRjbHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICIt\nYmFkLWZrdGFyZ2V0Y2xzIiwgY29udGV4dCwgZmllbGROYW1lLCBuYW1lKSk7\nCgogICAgICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQgPSB0Y2xzLmdldEZp\nZWxkTWFwcGluZyhmaWVsZE5hbWUpOwogICAgICAgICAgICBpZiAoZmllbGQg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICAr\nICItYmFkLWZrdGFyZ2V0ZmllbGQiLCBuZXcgT2JqZWN0W117IGNvbnRleHQs\nIGZpZWxkTmFtZSwKICAgICAgICAgICAgICAgICAgICBuYW1lLCB0Y2xzIH0p\nKTsKICAgICAgICAgICAgaWYgKGZpZWxkLmdldENvbHVtbnMoKS5sZW5ndGgg\nIT0gMSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICIt\nZmt0YXJnZXRmaWVsZC1jb2xzIiwgY29udGV4dCwgZmllbGROYW1lLCBuYW1l\nKSk7CiAgICAgICAgICAgIHR0YWJsZSA9IChmaWVsZC5nZXRKb2luRm9yZWln\nbktleSgpICE9IG51bGwpID8gZmllbGQuZ2V0VGFibGUoKQogICAgICAgICAg\nICAgICAgOiBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKS5nZXRUYWJsZSgp\nOwogICAgICAgICAgICB0YXJnZXROYW1lID0gZmllbGQuZ2V0Q29sdW1ucygp\nWzBdLmdldE5hbWUoKTsKICAgICAgICB9IGVsc2UgaWYgKHRhcmdldE5hbWUg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAodGFyZ2V0TmFtZS5jaGFyQXQo\nMCkgPT0gJ1wnJykgewogICAgICAgICAgICAgICAgY29uc3RhbnQgPSB0cnVl\nOwogICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0TmFtZS5zdWJzdHJp\nbmcoMSwgdGFyZ2V0TmFtZS5sZW5ndGgoKSAtIDEpOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKHRhcmdldE5hbWUuY2hhckF0KDApID09ICctJwogICAgICAg\nICAgICAgICAgfHwgdGFyZ2V0TmFtZS5jaGFyQXQoMCkgPT0gJy4nCiAgICAg\nICAgICAgICAgICB8fCBDaGFyYWN0ZXIuaXNEaWdpdCh0YXJnZXROYW1lLmNo\nYXJBdCgwKSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0YW50ID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHRhcmdldE5hbWUuaW5kZXhPZignLicpID09IC0xKQogICAgICAgICAgICAg\nICAgICAgICAgICB0YXJnZXQgPSBuZXcgSW50ZWdlcih0YXJnZXROYW1lKTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIHRhcmdldCA9IG5ldyBEb3VibGUodGFyZ2V0TmFtZSk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICAgICArICItYmFk\nLWZrY29uc3QiLCBjb250ZXh0LCB0YXJnZXROYW1lLCBuYW1lKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIm51bGwiLmVx\ndWFsc0lnbm9yZUNhc2UodGFyZ2V0TmFtZSkpCiAgICAgICAgICAgICAgICBj\nb25zdGFudCA9IHRydWU7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgaW50IGRvdElkeCA9IHRhcmdldE5hbWUubGFzdEluZGV4T2YoJy4n\nKTsKICAgICAgICAgICAgICAgIGZ1bGxUYXJnZXQgPSBkb3RJZHggIT0gLTE7\nCiAgICAgICAgICAgICAgICBpZiAoZG90SWR4ID09IDApIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBhbGxvdyB1c2Ugb2YgJy4nIHdpdGhvdXQgcHJlZml4\nIHRvIG1lYW4gInVzZSBleHBlY3RlZAogICAgICAgICAgICAgICAgICAgIC8v\nIGxvY2FsIHRhYmxlIiwgYnV0IGlnbm9yZSBpZiB3ZSdyZSBhbHJlYWR5IGlu\ndmVyc2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbnZlcnNlKQogICAg\nICAgICAgICAgICAgICAgICAgICB0dGFibGUgPSBsb2NhbDsKICAgICAgICAg\nICAgICAgICAgICB0YXJnZXROYW1lID0gdGFyZ2V0TmFtZS5zdWJzdHJpbmco\nMSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRvdElkeCAhPSAtMSkg\newogICAgICAgICAgICAgICAgICAgIHR0YWJsZSA9IGZpbmRUYWJsZShjb250\nZXh0LCB0YXJnZXROYW1lLnN1YnN0cmluZygwLAogICAgICAgICAgICAgICAg\nICAgICAgICBkb3RJZHgpLCBmb3JlaWduLCBsb2NhbCwgKGludmVyc2UpID8g\nY2xzIDogcmVsKTsKICAgICAgICAgICAgICAgICAgICB0YXJnZXROYW1lID0g\ndGFyZ2V0TmFtZS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHVz\nZSBleHBsaWNpdCB0YXJnZXQgdGFibGUgaWYgYXZhaWxhYmxlCiAgICAgICAg\naWYgKHR0YWJsZSA9PSBsb2NhbCAmJiBsb2NhbCAhPSBmb3JlaWduKSB7CiAg\nICAgICAgICAgIC8vIHN3YXAsIHVubGVzcyB1c2VyIGdhdmUgaW5jb21wYXRp\nYmxlIHRhYmxlIGluIGNvbHVtbiBuYW1lCiAgICAgICAgICAgIGlmIChmdWxs\nTmFtZSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICIt\nYmFkLWZrdGFyZ2V0LWludmVyc2UiLCBuZXcgT2JqZWN0W117IGNvbnRleHQs\nIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbiwgdHRhYmxlIH0p\nKTsKICAgICAgICAgICAgbG9jYWwgPSBmb3JlaWduOwogICAgICAgICAgICBm\nb3JlaWduID0gdHRhYmxlOwogICAgICAgIH0gZWxzZSBpZiAodHRhYmxlICE9\nIG51bGwpIHsKICAgICAgICAgICAgLy8gdHRhYmxlIG1pZ2h0IGJlIGEgdGFi\nbGUgb2YgYSBiYXNlIGNsYXNzIG9mIHRoZSB0YXJnZXQKICAgICAgICAgICAg\nZm9yZWlnbiA9IHR0YWJsZTsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNr\nIHRvIHNlZSBpZiB3ZSBpbnZlcnNlZDsgaWYgdGhpcyBpcyBhIHNhbWUtdGFi\nbGUgam9pbiwgdGhlbgogICAgICAgIC8vIGNvbnNpZGVyIGl0IGFuIGltcGxp\nY2l0IGludmVyc2UgaWYgdGhlIHVzZXIgaW5jbHVkZXMgdGhlIHRhYmxlIG5h\nbWUKICAgICAgICAvLyBpbiB0aGUgY29sdW1uIG5hbWUsIGJ1dCBub3QgaW4g\ndGhlIGNvbHVtbiB0YXJnZXQsIG9yIGlmIHRoZSB1c2VyCiAgICAgICAgLy8g\nZ2l2ZXMgbm8gY29sdW1uIG5hbWUgYnV0IGEgZnVsbCB0YXJnZXQgbmFtZQog\nICAgICAgIGludmVyc2UgPSBpbnZlcnNlIHx8IGxvY2FsICE9IHRhYmxlIHx8\nIChsb2NhbCA9PSBmb3JlaWduCiAgICAgICAgICAgICYmICgoZnVsbE5hbWUg\nJiYgIWZ1bGxUYXJnZXQpIHx8IChuYW1lID09IG51bGwgJiYgZnVsbFRhcmdl\ndCkpKTsKICAgICAgICBpZiAoIWludmVyc2FibGUgJiYgIWNvbnN0YW50ICYm\nIGludmVyc2UpIHsKICAgICAgICAgICAgaWYgKGxvY2FsID09IGZvcmVpZ24p\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAgKyAiLWJhZC1m\nay1zZWxmLWludmVyc2UiLCBjb250ZXh0LCBsb2NhbCkpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4\nICsgIi1iYWQtZmstaW52ZXJzZSIsCiAgICAgICAgICAgICAgICBjb250ZXh0\nLCBsb2NhbCwgdGFibGUpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG5hbWUg\nPT0gbnVsbCAmJiBjb25zdGFudCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAg\nICAgKyAiLW5vLWZrY29sLW5hbWUtYWRhcHQiLCBjb250ZXh0KSk7CgogICAg\nICAgIGlmIChuYW1lID09IG51bGwgJiYgdGFyZ2V0TmFtZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIGlmIG5vIG5hbWUgb3IgdGFyZ2V0IGlzIHByb3Zp\nZGVkIGFuZCB0aGVyZSdzIG1vcmUgdGhhbiBvbmUgbGlrZWx5CiAgICAgICAg\nICAgIC8vIGpvaW4gcG9zc2liaWxpdHksIHRvbyBhbWJpZ3VvdXMKICAgICAg\nICAgICAgUHJpbWFyeUtleSBwayA9IGZvcmVpZ24uZ2V0UHJpbWFyeUtleSgp\nOwogICAgICAgICAgICBpZiAoam9pbnMubGVuZ3RoICE9IDEgfHwgcGsgPT0g\nbnVsbCB8fCBway5nZXRDb2x1bW5zKCkubGVuZ3RoICE9IDEpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\ncHJlZml4CiAgICAgICAgICAgICAgICAgICAgKyAiLW5vLWZrY29sLW5hbWUt\nYWRhcHQiLCBjb250ZXh0KSk7CgogICAgICAgICAgICAvLyBhc3N1bWUgdGFy\nZ2V0IGlzIHBrIGNvbHVtbgogICAgICAgICAgICB0YXJnZXROYW1lID0gcGsu\nZ2V0Q29sdW1ucygpWzBdLmdldE5hbWUoKTsKICAgICAgICB9IGVsc2UgaWYg\nKG5hbWUgIT0gbnVsbCAmJiB0YXJnZXROYW1lID09IG51bGwpIHsKICAgICAg\nICAgICAgLy8gaWYgb25lIHByaW1hcnkga2V5IGNvbHVtbiB1c2UgaXQgZm9y\nIHRhcmdldDsgaWYgbXVsdGlwbGUgam9pbnMKICAgICAgICAgICAgLy8gbG9v\nayBmb3IgYSBmb3JlaWduIGNvbHVtbiB3aXRoIHNhbWUgbmFtZSBhcyBsb2Nh\nbCBjb2x1bW4KICAgICAgICAgICAgUHJpbWFyeUtleSBwayA9IGZvcmVpZ24u\nZ2V0UHJpbWFyeUtleSgpOwogICAgICAgICAgICBpZiAoam9pbnMubGVuZ3Ro\nID09IDEgJiYgcGsgIT0gbnVsbCAmJiBway5nZXRDb2x1bW5zKCkubGVuZ3Ro\nID09IDEpIHsKICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSBway5nZXRD\nb2x1bW5zKClbMF0uZ2V0TmFtZSgpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGVsc2UgaWYgKGZvcmVpZ24uZ2V0Q29sdW1uKG5hbWUpICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSBuYW1lOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAg\nICAgICAgICAgICAgICAgICsgIi1uby1ma2NvbC10YXJnZXQtYWRhcHQiLCBj\nb250ZXh0LCBuYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIGZpbmQgdGhlIHRhcmdldCBjb2x1bW4sIGFuZCBjcmVhdGUgdGVt\ncGxhdGUgZm9yIGxvY2FsIGNvbHVtbiBiYXNlZAogICAgICAgIC8vIG9uIGl0\nCiAgICAgICAgQ29sdW1uIHRtcGxhdGUgPSBuZXcgQ29sdW1uKCk7CiAgICAg\nICAgdG1wbGF0ZS5zZXROYW1lKG5hbWUpOwogICAgICAgIGlmICghY29uc3Rh\nbnQpIHsKICAgICAgICAgICAgQ29sdW1uIHRjb2wgPSBmb3JlaWduLmdldENv\nbHVtbih0YXJnZXROYW1lKTsKICAgICAgICAgICAgaWYgKHRjb2wgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldChwcmVmaXggKyAiLWJhZC1ma3RhcmdldCIsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjb250ZXh0LCB0YXJnZXROYW1l\nLCBuYW1lLCBmb3JlaWduIH0pKTsKCiAgICAgICAgICAgIGlmIChuYW1lID09\nIG51bGwpCiAgICAgICAgICAgICAgICB0bXBsYXRlLnNldE5hbWUodGNvbC5n\nZXROYW1lKCkpOwogICAgICAgICAgICB0bXBsYXRlLnNldEphdmFUeXBlKHRj\nb2wuZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAgICAgIHRtcGxhdGUuc2V0VHlw\nZSh0Y29sLmdldFR5cGUoKSk7CiAgICAgICAgICAgIHRtcGxhdGUuc2V0VHlw\nZU5hbWUodGNvbC5nZXRUeXBlTmFtZSgpKTsKICAgICAgICAgICAgdG1wbGF0\nZS5zZXRTaXplKHRjb2wuZ2V0U2l6ZSgpKTsKICAgICAgICAgICAgdG1wbGF0\nZS5zZXREZWNpbWFsRGlnaXRzKHRjb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsK\nICAgICAgICAgICAgdGFyZ2V0ID0gdGNvbDsKICAgICAgICB9IGVsc2UgaWYg\nKHRhcmdldCBpbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAgdG1wbGF0\nZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuU1RSSU5HKTsKICAgICAgICBlbHNl\nIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJbnRlZ2VyKQogICAgICAgICAgICB0\nbXBsYXRlLnNldEphdmFUeXBlKEphdmFUeXBlcy5JTlQpOwogICAgICAgIGVs\nc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIERvdWJsZSkKICAgICAgICAgICAg\ndG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuRE9VQkxFKTsKCiAgICAg\nICAgLy8gcG9wdWxhdGUgdGVtcGxhdGUsIGJ1dCBsZXQgdXNlci1naXZlbiBu\nYW1lIG92ZXJyaWRlIGRlZmF1bHQgbmFtZQogICAgICAgIGlmIChkZWYgIT0g\nbnVsbCkKICAgICAgICAgICAgZGVmLnBvcHVsYXRlKGxvY2FsLCBmb3JlaWdu\nLCB0bXBsYXRlLCB0YXJnZXQsIGludmVyc2UsIGlkeCwKICAgICAgICAgICAg\nICAgIGpvaW5zLmxlbmd0aCk7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgdG1wbGF0ZS5zZXROYW1lKG5hbWUpOwoKICAgICAgICAv\nLyBjcmVhdGUgb3IgbWVyZ2UgbG9jYWwgY29sdW1uCiAgICAgICAgQ29sdW1u\nIGNvbCA9IG1lcmdlQ29sdW1uKGNvbnRleHQsIHByZWZpeCwgdG1wbGF0ZSwg\ndHJ1ZSwgZ2l2ZW4sIGxvY2FsLAogICAgICAgICAgICBhZGFwdCwgZmlsbCk7\nCgogICAgICAgIGpvaW5zW2lkeF1bMF0gPSBjb2w7CiAgICAgICAgam9pbnNb\naWR4XVsxXSA9IHRhcmdldDsKICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAg\nICAgICAgam9pbnNbaWR4XVsyXSA9IEJvb2xlYW4uVFJVRTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEZpbmQgdGhlIHRhcmdldCBjbGFzcyBtYXBwaW5nIGdp\ndmVuIHRoZSB1c2VyJ3MgY2xhc3MgbmFtZS4KICAgICAqCiAgICAgKiBAcGFy\nYW0gY29udGV4dCBmb3IgZXJyb3IgbWVzc2FnZXMKICAgICAqIEBwYXJhbSBj\nbHNOYW1lIGNsYXNzIG5hbWUgZ2l2ZW4gYnkgdXNlcgogICAgICogQHBhcmFt\nIGNscyBvcmlnaW5hbCBzb3VyY2UgbWFwcGluZwogICAgICogQHBhcmFtIHJl\nbCBvcmlnaW5hbCB0YXJnZXQgbWFwcGluZwogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBDbGFzc01hcHBpbmcgZmluZENsYXNzTWFwcGluZyhNZXRhRGF0\nYUNvbnRleHQgY29udGV4dCwKICAgICAgICBTdHJpbmcgY2xzTmFtZSwgQ2xh\nc3NNYXBwaW5nIGNscywgQ2xhc3NNYXBwaW5nIHJlbCkgewogICAgICAgIGlm\nIChpc0NsYXNzTWFwcGluZ05hbWUoY2xzTmFtZSwgY2xzKSkKICAgICAgICAg\nICAgcmV0dXJuIGNsczsKICAgICAgICBpZiAoaXNDbGFzc01hcHBpbmdOYW1l\nKGNsc05hbWUsIHJlbCkpCiAgICAgICAgICAgIHJldHVybiByZWw7CiAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJ0YXJn\nZXQtd3JvbmctY2xzIiwgbmV3IE9iamVjdFtdCiAgICAgICAgICAgIHsgY29u\ndGV4dCwgY2xzTmFtZSwgY2xzLCByZWwgfSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIG5hbWUgbWF0Y2hlcyB0\naGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiBpc0NsYXNzTWFwcGluZ05hbWUoU3RyaW5nIG5hbWUsIENsYXNz\nTWFwcGluZyBjbHMpIHsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAobmFtZS5lcXVhbHMo\nY2xzLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpCiAgICAgICAgICAg\nIHx8IG5hbWUuZXF1YWxzKFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKGNscy5nZXRE\nZXNjcmliZWRUeXBlKCkpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgcmV0dXJuIGlzQ2xhc3NNYXBwaW5nTmFtZShuYW1lLCBjbHMuZ2V0\nUENTdXBlcmNsYXNzTWFwcGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldHMgaW50ZXJuYWwgY29sdW1uIGluZm9ybWF0aW9uIHRvIG1hdGNoIHRo\nZSBnaXZlbiBtYXBwZWQgY29sdW1ucy4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZm9yY2VKREJDVHlwZSB3aGV0aGVyIHRvIGZvcmNlIHRoZSBqZGJjLXR5cGUg\nb2YgdGhlIGNvbHVtbnMKICAgICAqIHRvIGJlIHNldCwgZXZlbiB3aGVuIGl0\nIG1hdGNoZXMgdGhlIGRlZmF1bHQgZm9yIHRoZSBjb2x1bW5zJyBqYXZhIHR5\ncGUKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3luY0NvbHVtbnMoTWV0\nYURhdGFDb250ZXh0IGNvbnRleHQsIENvbHVtbltdIGNvbHMsCiAgICAgICAg\nYm9vbGVhbiBmb3JjZUpEQkNUeXBlKSB7CiAgICAgICAgaWYgKGNvbHMgPT0g\nbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBfY29scyA9\nIG51bGw7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9jb2xzID0gbmV3\nIEFycmF5TGlzdChjb2xzLmxlbmd0aCk7CiAgICAgICAgICAgIENvbHVtbiBj\nb2w7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29sID0gc3luY0NvbHVtbihj\nb250ZXh0LCBjb2xzW2ldLCBjb2xzLmxlbmd0aCwKICAgICAgICAgICAgICAg\nICAgICBmb3JjZUpEQkNUeXBlLCBjb2xzW2ldLmdldFRhYmxlKCksIG51bGws\nIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHNldENvbHVtbkZsYWdz\nRnJvbUlPKGNvbCwgaSk7CiAgICAgICAgICAgICAgICBfY29scy5hZGQoY29s\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCBJL08gZmxhZ3Mgb24gdGhlIGNvbHVtbi4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHNldENvbHVtbkZsYWdzRnJvbUlPKENvbHVtbiBjb2ws\nIGludCBpKSB7CiAgICAgICAgaWYgKF9pbyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5V\nUERBVEFCTEUsICFfaW8uaXNVcGRhdGFibGUoaSwgZmFsc2UpKTsKICAgICAg\nICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFfaW8u\naXNJbnNlcnRhYmxlKGksIGZhbHNlKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXRzIGludGVybmFsIGluZGV4IGluZm9ybWF0aW9uIHRvIG1hdGNoIGdp\ndmVuIG1hcHBlZCBpbmRleC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nc3luY0luZGV4KE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBJbmRleCBpZHgp\nIHsKICAgICAgICBpZiAoaWR4ID09IG51bGwpIHsKICAgICAgICAgICAgX2lk\neCA9IG51bGw7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIF9jYW5JZHggPSB0cnVlOwogICAgICAgIF9pZHggPSBuZXcgSW5kZXgo\nKTsKICAgICAgICBfaWR4LnNldE5hbWUoaWR4LmdldE5hbWUoKSk7CiAgICAg\nICAgX2lkeC5zZXRVbmlxdWUoaWR4LmlzVW5pcXVlKCkpOwogICAgICAgIGlm\nIChpZHguZ2V0Q29sdW1ucygpICE9IG51bGwgJiYgaWR4LmdldENvbHVtbnMo\nKS5sZW5ndGggPiAxKQogICAgICAgICAgICBfaWR4LnNldENvbHVtbnMoaWR4\nLmdldENvbHVtbnMoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIGlu\ndGVybmFsIGNvbnN0cmFpbnQgaW5mb3JtYXRpb24gdG8gbWF0Y2ggZ2l2ZW4g\nbWFwcGVkIGNvbnN0cmFpbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHN5bmNVbmlxdWUoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFVuaXF1ZSB1\nbnEpIHsKICAgICAgICBpZiAodW5xID09IG51bGwpIHsKICAgICAgICAgICAg\nX3VucSA9IG51bGw7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIF9jYW5VbnEgPSB0cnVlOwogICAgICAgIF91bnEgPSBuZXcgVW5p\ncXVlKCk7CiAgICAgICAgX3VucS5zZXROYW1lKHVucS5nZXROYW1lKCkpOwog\nICAgICAgIF91bnEuc2V0RGVmZXJyZWQodW5xLmlzRGVmZXJyZWQoKSk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyBpbnRlcm5hbCBjb25zdHJh\naW50IGFuZCBjb2x1bW4gaW5mb3JtYXRpb24gdG8gbWF0Y2ggZ2l2ZW4gbWFw\ncGVkCiAgICAgKiBjb25zdHJhaW50LgogICAgICoKICAgICAqIEBwYXJhbSBs\nb2NhbCBkZWZhdWx0IGxvY2FsIHRhYmxlCiAgICAgKiBAcGFyYW0gdGFyZ2V0\nIGRlZmF1bHQgdGFyZ2V0IHRhYmxlCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIHN5bmNGb3JlaWduS2V5KE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBG\nb3JlaWduS2V5IGZrLAogICAgICAgIFRhYmxlIGxvY2FsLCBUYWJsZSB0YXJn\nZXQpIHsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkgewogICAgICAgICAgICBf\nZmsgPSBudWxsOwogICAgICAgICAgICBfY29scyA9IG51bGw7CiAgICAgICAg\nICAgIF9qb2luID0gSk9JTl9OT05FOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQogICAgICAgIGlmIChfam9pbiA9PSBKT0lOX05PTkUpCiAgICAg\nICAgICAgIF9qb2luID0gSk9JTl9GT1JXQVJEOwoKICAgICAgICBpZiAoZmsu\naXNMb2dpY2FsKCkpCiAgICAgICAgICAgIF9mayA9IG51bGw7CiAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgIF9jYW5GSyA9IHRydWU7CiAgICAgICAgICAg\nIF9mayA9IG5ldyBGb3JlaWduS2V5KCk7CiAgICAgICAgICAgIF9may5zZXRO\nYW1lKGZrLmdldE5hbWUoKSk7CiAgICAgICAgICAgIF9may5zZXREZWxldGVB\nY3Rpb24oZmsuZ2V0RGVsZXRlQWN0aW9uKCkpOwogICAgICAgICAgICBfZmsu\nc2V0VXBkYXRlQWN0aW9uKGZrLmdldFVwZGF0ZUFjdGlvbigpKTsKICAgICAg\nICAgICAgX2ZrLnNldERlZmVycmVkKGZrLmlzRGVmZXJyZWQoKSk7CiAgICAg\nICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gZmsuZ2V0Q29sdW1ucygp\nOwogICAgICAgIENvbHVtbltdIHBrQ29scyA9IGZrLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gY2NvbHMgPSBmay5nZXRDb25z\ndGFudENvbHVtbnMoKTsKICAgICAgICBPYmplY3RbXSBjcyA9IGZrLmdldENv\nbnN0YW50cygpOwogICAgICAgIENvbHVtbltdIGNwa0NvbHMgPSBmay5nZXRD\nb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgT2JqZWN0W10g\nY3BrcyA9IGZrLmdldFByaW1hcnlLZXlDb25zdGFudHMoKTsKCiAgICAgICAg\naW50IHNpemUgPSBjb2xzLmxlbmd0aCArIGNjb2xzLmxlbmd0aCArIGNwa0Nv\nbHMubGVuZ3RoOwogICAgICAgIF9jb2xzID0gbmV3IEFycmF5TGlzdChzaXpl\nKTsKICAgICAgICBDb2x1bW4gY29sOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2wgPSBz\neW5jQ29sdW1uKGNvbnRleHQsIGNvbHNbaV0sIHNpemUsIGZhbHNlLCBsb2Nh\nbCwKICAgICAgICAgICAgICAgIHRhcmdldCwgcGtDb2xzW2ldLCBfam9pbiA9\nPSBKT0lOX0lOVkVSU0UpOwogICAgICAgICAgICBzZXRDb2x1bW5GbGFnc0Zy\nb21JTyhjb2wsIGkpOwogICAgICAgICAgICBfY29scy5hZGQoY29sKTsKICAg\nICAgICB9CiAgICAgICAgT2JqZWN0IGNvbnN0YW50OwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY2NvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgY29uc3RhbnQgPSAoY3NbaV0gPT0gbnVsbCkgPyBOVUxMIDogY3NbaV07\nCiAgICAgICAgICAgIGNvbCA9IHN5bmNDb2x1bW4oY29udGV4dCwgY2NvbHNb\naV0sIHNpemUsIGZhbHNlLCBsb2NhbCwKICAgICAgICAgICAgICAgIHRhcmdl\ndCwgY29uc3RhbnQsIF9qb2luID09IEpPSU5fSU5WRVJTRSk7CiAgICAgICAg\nICAgIHNldENvbHVtbkZsYWdzRnJvbUlPKGNvbCwgY29scy5sZW5ndGggKyBp\nKTsKICAgICAgICAgICAgX2NvbHMuYWRkKGNvbCk7CiAgICAgICAgfQogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY3BrQ29scy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBjb25zdGFudCA9IChjcGtzW2ldID09IG51bGwpID8g\nTlVMTCA6IGNwa3NbaV07CiAgICAgICAgICAgIF9jb2xzLmFkZChzeW5jQ29s\ndW1uKGNvbnRleHQsIGNwa0NvbHNbaV0sIHNpemUsIGZhbHNlLCB0YXJnZXQs\nCiAgICAgICAgICAgICAgICBsb2NhbCwgY29uc3RhbnQsIF9qb2luICE9IEpP\nSU5fSU5WRVJTRSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGdpdmVuIGNvbHVtbiB3aXRoIHRoZSBy\nYXcgbWFwcGluZyBpbmZvcm1hdGlvbgogICAgICogc2V0IGNvcnJlY3RseSwg\nYW5kIHdpdGhvdXQgc2V0dGluZ3MgdGhhdCBtYXRjaCBkZWZhdWx0cy4KICAg\nICAqCiAgICAgKiBAcGFyYW0gbnVtIHRoZSBudW1iZXIgb2YgY29sdW1ucyBm\nb3IgdGhpcyBtYXBwaW5nCiAgICAgKiBAcGFyYW0gZm9yY2VKREJDVHlwZSB3\naGV0aGVyIHRoZSBqZGJjLXR5cGUgb2YgdGhlIGNyZWF0ZWQgY29sdW1uCiAg\nICAgKiBzaG91bGQgYmUgc2V0LCBldmVuIGlmIGl0IG1hdGNoZXMgdGhlIGRl\nZmF1bHQKICAgICAqIGZvciB0aGUgZ2l2ZW4gY29sdW1uJ3MgamF2YSB0eXBl\nCiAgICAgKiBAcGFyYW0gY29sVGFibGUgZXhwZWN0ZWQgdGFibGUgZm9yIHRo\nZSBjb2x1bW4KICAgICAqIEBwYXJhbSB0YXJnZXRUYWJsZSBleHBlY3RlZCB0\nYXJnZXQgdGFibGUgZm9yIGpvaW4gY29sdW1uCiAgICAgKiBAcGFyYW0gdGFy\nZ2V0IHRhcmdldCBjb2x1bW4gb3Igb2JqZWN0IGZvciBqb2luIGNvbHVtbjsg\nZm9yIGEKICAgICAqIGNvbnN0YW50IG51bGwgdGFyZ2V0LCB1c2Uge0BsaW5r\nICNOVUxMfQogICAgICogQHBhcmFtIGludmVyc2Ugd2hldGhlciBqb2luIGNv\nbHVtbiBpcyBmb3IgaW52ZXJzZSBqb2luCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBzdGF0aWMgQ29sdW1uIHN5bmNDb2x1bW4oTWV0YURhdGFDb250ZXh0IGNv\nbnRleHQsIENvbHVtbiBjb2wsCiAgICAgICAgaW50IG51bSwgYm9vbGVhbiBm\nb3JjZUpEQkNUeXBlLCBUYWJsZSBjb2xUYWJsZSwgVGFibGUgdGFyZ2V0VGFi\nbGUsCiAgICAgICAgT2JqZWN0IHRhcmdldCwgYm9vbGVhbiBpbnZlcnNlKSB7\nCiAgICAgICAgLy8gdXNlIGZ1bGwgbmFtZSBmb3IgY29scyB0aGF0IGFyZW4n\ndCBpbiB0aGUgZXhwZWN0ZWQgdGFibGUsIG9yIHRoYXQKICAgICAgICAvLyBh\ncmUgaW52ZXJzZSBqb2lucwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0g\nKChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkp\nLgogICAgICAgICAgICBnZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICBDb2x1\nbW4gY29weSA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoY29sLmdldFRh\nYmxlKCkgIT0gY29sVGFibGUgfHwgaW52ZXJzZSkKICAgICAgICAgICAgY29w\neS5zZXROYW1lKGRpY3QuZ2V0RnVsbE5hbWUoY29sLmdldFRhYmxlKCksIHRy\ndWUpCiAgICAgICAgICAgICAgICArIGRpY3QuY2F0YWxvZ1NlcGFyYXRvciAr\nIGNvbC5nZXROYW1lKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29w\neS5zZXROYW1lKGNvbC5nZXROYW1lKCkpOwoKICAgICAgICAvLyBzZXQgdGFy\nZ2V0IGlmIG5vdCBkZWZhdWx0CiAgICAgICAgaWYgKHRhcmdldCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmICh0YXJnZXQgPT0gTlVMTCkKICAgICAgICAg\nICAgICAgIGNvcHkuc2V0VGFyZ2V0KCJudWxsIik7CiAgICAgICAgICAgIGVs\nc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIENvbHVtbikgewogICAgICAgICAg\nICAgICAgQ29sdW1uIHRjb2wgPSAoQ29sdW1uKSB0YXJnZXQ7CiAgICAgICAg\nICAgICAgICBpZiAoKCFpbnZlcnNlICYmIHRjb2wuZ2V0VGFibGUoKSAhPSB0\nYXJnZXRUYWJsZSkKICAgICAgICAgICAgICAgICAgICB8fCAoaW52ZXJzZSAm\nJiB0Y29sLmdldFRhYmxlKCkgIT0gY29sVGFibGUpKQogICAgICAgICAgICAg\nICAgICAgIGNvcHkuc2V0VGFyZ2V0KGRpY3QuZ2V0RnVsbE5hbWUodGNvbC5n\nZXRUYWJsZSgpLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICArIGRp\nY3QuY2F0YWxvZ1NlcGFyYXRvciArIHRjb2wuZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgICAgIGVsc2UgaWYgKCFkZWZhdWx0VGFyZ2V0KGNvbCwgdGNvbCwg\nbnVtKSkKICAgICAgICAgICAgICAgICAgICBjb3B5LnNldFRhcmdldCh0Y29s\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0IGlu\nc3RhbmNlb2YgTnVtYmVyKQogICAgICAgICAgICAgICAgY29weS5zZXRUYXJn\nZXQodGFyZ2V0LnRvU3RyaW5nKCkpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBjb3B5LnNldFRhcmdldCgiJyIgKyB0YXJnZXQgKyAiJyIp\nOwogICAgICAgIH0gZWxzZSBpZiAobnVtID4gMSkKICAgICAgICAgICAgY29w\neS5zZXRUYXJnZXRGaWVsZChjb2wuZ2V0VGFyZ2V0RmllbGQoKSk7CgogICAg\nICAgIGlmIChjb2wuZ2V0U2l6ZSgpICE9IDAgJiYgY29sLmdldFNpemUoKSAh\nPSBkaWN0LmNoYXJhY3RlckNvbHVtblNpemUKICAgICAgICAgICAgJiYgKGNv\nbC5nZXRTaXplKCkgIT0gLTEgfHwgIWNvbC5pc0xvYigpKSkKICAgICAgICAg\nICAgY29weS5zZXRTaXplKGNvbC5nZXRTaXplKCkpOwogICAgICAgIGlmIChj\nb2wuZ2V0RGVjaW1hbERpZ2l0cygpICE9IDApCiAgICAgICAgICAgIGNvcHku\nc2V0RGVjaW1hbERpZ2l0cyhjb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAg\nICAgICBpZiAoY29sLmdldERlZmF1bHRTdHJpbmcoKSAhPSBudWxsKQogICAg\nICAgICAgICBjb3B5LnNldERlZmF1bHRTdHJpbmcoY29sLmdldERlZmF1bHRT\ndHJpbmcoKSk7CiAgICAgICAgaWYgKGNvbC5pc05vdE51bGwoKSAmJiAhY29s\nLmlzUHJpbWFyeUtleSgpCiAgICAgICAgICAgICYmICghaXNQcmltaXRpdmUo\nY29sLmdldEphdmFUeXBlKCkpIHx8IGlzRm9yZWlnbktleShjb2wpKSkKICAg\nICAgICAgICAgY29weS5zZXROb3ROdWxsKHRydWUpOwoKICAgICAgICAvLyBz\nZXQgdHlwZSBuYW1lIGlmIG5vdCBkZWZhdWx0CiAgICAgICAgU3RyaW5nIHR5\ncGVOYW1lID0gY29sLmdldFR5cGVOYW1lKCk7CiAgICAgICAgaWYgKHR5cGVO\nYW1lICE9IG51bGwgfHwgY29weS5nZXRTaXplKCkgIT0gMAogICAgICAgICAg\nICB8fCBjb3B5LmdldERlY2ltYWxEaWdpdHMoKSAhPSAwKSB7CiAgICAgICAg\nICAgIC8vIGlzIHRoaXMgdGhlIGRpY3QgZGVmYXVsdCB0eXBlPyBoYXZlIHRv\nIGVuc3VyZSBqZGJjLXR5cGUgc2V0CiAgICAgICAgICAgIC8vIHByaW9yIHRv\nIGZpbmRpbmcgZGljdCBkZWZhdWx0CiAgICAgICAgICAgIGNvcHkuc2V0VHlw\nZShjb2wuZ2V0VHlwZSgpKTsKICAgICAgICAgICAgU3RyaW5nIGRlZk5hbWUg\nPSBkaWN0LmdldFR5cGVOYW1lKGNvcHkpOwogICAgICAgICAgICBjb3B5LnNl\ndFR5cGUoVHlwZXMuT1RIRVIpOwoKICAgICAgICAgICAgLy8gY29weSBzaG91\nbGQgbm90IGhhdmUgc2l6ZSBpbmZvIHNldCBpZiBpdCBpc24ndCB1c2VkIGlu\nIHR5cGUgbmFtZQogICAgICAgICAgICBib29sZWFuIGRlZlNpemVkID0gZGVm\nTmFtZS5pbmRleE9mKCcoJykgIT0gLTE7CiAgICAgICAgICAgIGlmICghZGVm\nU2l6ZWQpIHsKICAgICAgICAgICAgICAgIGlmIChjb3B5LmdldFNpemUoKSA+\nIDApCiAgICAgICAgICAgICAgICAgICAgY29weS5zZXRTaXplKDApOwogICAg\nICAgICAgICAgICAgY29weS5zZXREZWNpbWFsRGlnaXRzKDApOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAodHlwZU5hbWUgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRvIHN0cmlwIHNpemUgZm9y\nIGNvbXBhcmlzb24KICAgICAgICAgICAgICAgIGlmICh0eXBlTmFtZS5pbmRl\neE9mKCcoJykgPT0gLTEgJiYgZGVmU2l6ZWQpCiAgICAgICAgICAgICAgICAg\nICAgZGVmTmFtZSA9IGRlZk5hbWUuc3Vic3RyaW5nKDAsIGRlZk5hbWUuaW5k\nZXhPZignKCcpKTsKICAgICAgICAgICAgICAgIGlmICghdHlwZU5hbWUuZXF1\nYWxzSWdub3JlQ2FzZShkZWZOYW1lKSkKICAgICAgICAgICAgICAgICAgICBj\nb3B5LnNldFR5cGVOYW1lKHR5cGVOYW1lKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLy8gc2V0IGpkYmMtdHlwZSBpZiBub3QgZGVmYXVs\ndCBvciBpZiBmb3JjZWQKICAgICAgICBpZiAoZm9yY2VKREJDVHlwZQogICAg\nICAgICAgICB8fCAodGFyZ2V0ICE9IG51bGwgJiYgISh0YXJnZXQgaW5zdGFu\nY2VvZiBDb2x1bW4pCiAgICAgICAgICAgICYmIGNvbC5nZXRUeXBlKCkgIT0g\nVHlwZXMuVkFSQ0hBUikKICAgICAgICAgICAgfHwgZGljdC5nZXRKREJDVHlw\nZShjb2wuZ2V0SmF2YVR5cGUoKSwgZmFsc2UpICE9IGNvbC5nZXRUeXBlKCkp\nCiAgICAgICAgICAgIGNvcHkuc2V0VHlwZShjb2wuZ2V0VHlwZSgpKTsKCiAg\nICAgICAgcmV0dXJuIGNvcHk7CiAgICB9CgogICAgLyoqIAogICAgICogUmV0\ndXJuIHdoZXRoZXIgdGhlIGdpdmVuIGNvbHVtbiBiZWxvbmdzIHRvIGEgZm9y\nZWlnbiBrZXkuCiAgICAgKi8gCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFu\nIGlzRm9yZWlnbktleShDb2x1bW4gY29sKSAKICAgIHsgICAgICAgCiAgICAg\nICAgaWYgKGNvbC5nZXRUYWJsZSgpID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBGb3JlaWduS2V5W10gZmtzID0gY29sLmdl\ndFRhYmxlKCkuZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZrcy5sZW5ndGg7IGkrKykgCiAgICAgICAgICAgIGlmIChm\na3NbaV0uY29udGFpbnNDb2x1bW4oY29sKSAKICAgICAgICAgICAgICAgIHx8\nIGZrc1tpXS5jb250YWluc0NvbnN0YW50Q29sdW1uKGNvbCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4g\ndHlwZSBjb2RlIHJlcHJlc2VudHMgYSBwcmltaXRpdmUuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNQcmltaXRpdmUoaW50IHR5cGUp\nIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiB0YXJnZXQgY29sdW1uIG1h\ndGNoZXMgdGhlIGRlZmF1bHQuCiAgICAgKiBJZiB0aGVyZSBpcyBvbmx5IG9u\nZSBjb2x1bW4gaW52b2x2ZWQgaW4gdGhlIGpvaW4gYW5kIGl0IGxpbmtzIHRv\nIHRoZQogICAgICogc2luZ2xlIHRhcmdldCB0YWJsZSBwayBjb2x1bW4sIG9y\nIGlmIHRoZSBjb2x1bW4gbmFtZSBpcyB0aGUgc2FtZSBhcwogICAgICogdGhl\nIHRhcmdldCBjb2x1bW4gbmFtZSwgdGhlbiB0aGUgdGFyZ2V0IGlzIHRoZSBk\nZWZhdWx0LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGRl\nZmF1bHRUYXJnZXQoQ29sdW1uIGNvbCwgQ29sdW1uIHRhcmdldENvbCwKICAg\nICAgICBpbnQgbnVtKSB7CiAgICAgICAgaWYgKGNvbC5nZXROYW1lKCkuZXF1\nYWxzKHRhcmdldENvbC5nZXROYW1lKCkpKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICBpZiAobnVtID4gMSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBQcmltYXJ5S2V5IHBrID0gdGFyZ2V0Q29sLmdl\ndFRhYmxlKCkuZ2V0UHJpbWFyeUtleSgpOwogICAgICAgIGlmIChwayA9PSBu\ndWxsIHx8IHBrLmdldENvbHVtbnMoKS5sZW5ndGggIT0gMSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0YXJnZXRDb2wgPT0g\ncGsuZ2V0Q29sdW1ucygpWzBdOwogICAgfQoKICAgIC8qKgogICAgICogU3Vw\ncGxpZXMgZGVmYXVsdCB0YWJsZSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBpbnRlcmZhY2UgVGFibGVEZWZhdWx0cyB7CgogICAg\nICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgZGVmYXVsdCB0YWJsZSBu\nYW1lLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0KFNj\naGVtYSBzY2hlbWEpOwogICAgfQoKICAgIC8qKgogICAgICogU3VwcGxpZXMg\nZGVmYXVsdCBmb3JlaWduIGtleSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBpbnRlcmZhY2UgRm9yZWlnbktleURlZmF1bHRzIHsK\nCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgZGVmYXVsdCBmb3Jl\naWduIGtleSBmb3IgdGhlIGdpdmVuIHRhYmxlcywgb3IgbnVsbCB0bwogICAg\nICAgICAqIGNyZWF0ZSBhIGxvZ2ljYWwgZm9yZWlnbiBrZXkgb25seS4gRG8g\nbm90IGZpbGwgaW4gdGhlIGNvbHVtbnMgb2YKICAgICAgICAgKiB0aGUgZm9y\nZWlnbiBrZXksIG9ubHkgYXR0cmlidXRlcyBsaWtlIGl0cyBuYW1lLCBkZWxl\ndGUgYWN0aW9uLCBldGMuCiAgICAgICAgICogRG8gbm90IGFkZCB0aGUgZm9y\nZWlnbiBrZXkgdG8gdGhlIHRhYmxlLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyBGb3JlaWduS2V5IGdldChUYWJsZSBsb2NhbCwgVGFibGUgZm9yZWln\nbiwgYm9vbGVhbiBpbnZlcnNlKTsKCiAgICAgICAgLyoqCiAgICAgICAgICog\nUG9wdWxhdGUgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGNvbHVtbiB3aXRoIGRl\nZmF1bHRzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHRhcmdldCB0\naGUgdGFyZ2V0IGNvbHVtbiBvciBjb25zdGFudCB2YWx1ZQogICAgICAgICAq\nIEBwYXJhbSBwb3MgdGhlIGluZGV4IG9mIHRoaXMgY29sdW1uIGluIHRoZSBm\nb3JlaWduIGtleQogICAgICAgICAqIEBwYXJhbSBjb2xzIHRoZSBudW1iZXIg\nb2YgY29sdW1ucyBpbiB0aGUgZm9yZWlnbiBrZXkKICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShUYWJsZSBsb2NhbCwgVGFibGUg\nZm9yZWlnbiwgQ29sdW1uIGNvbCwKICAgICAgICAgICAgT2JqZWN0IHRhcmdl\ndCwgYm9vbGVhbiBpbnZlcnNlLCBpbnQgcG9zLCBpbnQgY29scyk7Cgl9Cn0K\n","encoding":"base64"}

