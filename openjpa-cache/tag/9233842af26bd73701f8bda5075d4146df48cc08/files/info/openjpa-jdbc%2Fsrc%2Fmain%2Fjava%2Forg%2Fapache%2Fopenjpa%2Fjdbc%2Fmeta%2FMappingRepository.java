{"sha":"082238d9d376500fb2ad792076f90fafd11ffaee","node_id":"MDQ6QmxvYjIwNjM2NDowODIyMzhkOWQzNzY1MDBmYjJhZDc5MjA3NmY5MGZhZmQxMWZmYWVl","size":59924,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/082238d9d376500fb2ad792076f90fafd11ffaee","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Q\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlw\nZXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJD\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLkJsb2JWYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5CeXRlQXJyYXlWYWx1ZUhh\nbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5DaGFyQXJyYXlTdHJlYW1WYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5DaGFyQXJyYXlWYWx1\nZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5DbGFzc05hbWVEaXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5DbG9iVmFs\ndWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuRWxlbWVudEVtYmVkVmFsdWVIYW5kbGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRW1iZWRGaWVsZFN0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5z\ndHJhdHMuRW1iZWRkZWRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRmxhdENsYXNzU3RyYXRlZ3k7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5G\ndWxsQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuc3RyYXRzLkhhbmRsZXJDb2xsZWN0aW9uVGFibGVGaWVsZFN0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5z\ndHJhdHMuSGFuZGxlckZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5IYW5kbGVySGFuZGxlck1hcFRh\nYmxlRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuc3RyYXRzLkhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmllbGRT\ndHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nc3RyYXRzLkltbXV0YWJsZVZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkxvYkZpZWxkU3RyYXRlZ3k7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5N\nYXhFbWJlZGRlZEJsb2JGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTWF4RW1iZWRkZWRCeXRlQXJy\nYXlGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuTWF4RW1iZWRkZWRDaGFyQXJyYXlGaWVsZFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuTWF4RW1iZWRkZWRDbG9iRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk11bHRpQ29sdW1uVmVy\nc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuCiAgICAgICAgTmFub1ByZWNpc2lvblRpbWVzdGFtcFZl\ncnNpb25TdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLk5vbmVDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZURpc2NyaW1pbmF0\nb3JTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuc3RyYXRzLk5vbmVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZVZlcnNpb25TdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRz\nLk51bWJlclZlcnNpb25TdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk9iamVjdElkQ2xhc3NTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk9i\namVjdElkVmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuUHJpbWl0aXZlRmllbGRTdHJhdGVneTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLgogICAg\nICAgIFJlbGF0aW9uQ29sbGVjdGlvbkludmVyc2VLZXlGaWVsZFN0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nUmVsYXRpb25Db2xsZWN0aW9uVGFibGVGaWVsZFN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuUmVsYXRpb25G\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuUmVsYXRpb25IYW5kbGVyTWFwVGFibGVGaWVsZFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuUmVsYXRpb25NYXBJbnZlcnNlS2V5RmllbGRTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlJlbGF0aW9u\nTWFwVGFibGVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuCiAgICAgICAgUmVsYXRpb25SZWxhdGlv\nbk1hcFRhYmxlRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN0YXRlQ29tcGFyaXNvblZlcnNpb25T\ndHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nc3RyYXRzLlN0cmluZ0ZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5TdWJjbGFzc0pvaW5EaXNjcmlt\naW5hdG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLnN0cmF0cy5TdXBlcmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nU3VwZXJjbGFzc1ZlcnNpb25TdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlRpbWVzdGFtcFZlcnNpb25TdHJh\ndGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3Ry\nYXRzLlVudHlwZWRQQ1ZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlZhbHVlTWFwRGlzY3JpbWluYXRv\nclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pblN5bnRheGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25m\naWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5KYXZhVmVyc2lvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5PcmRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIFJlcG9z\naXRvcnkgb2Ygb2JqZWN0L3JlbGF0aW9uYWwgbWFwcGluZyBpbmZvcm1hdGlv\nbi4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBN\nYXBwaW5nUmVwb3NpdG9yeQogICAgZXh0ZW5kcyBNZXRhRGF0YVJlcG9zaXRv\ncnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9j\nID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoTWFwcGluZ1JlcG9z\naXRvcnkuY2xhc3MpOwoKICAgIHByaXZhdGUgdHJhbnNpZW50IERCRGljdGlv\nbmFyeSBfZGljdCA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBNYXBw\naW5nRGVmYXVsdHMgX2RlZmF1bHRzID0gbnVsbDsKICAgIAogICAgcHJpdmF0\nZSBNYXAgX3Jlc3VsdHMgPSBuZXcgSGFzaE1hcCgpOyAvLyBvYmplY3QtPnF1\nZXJ5cmVzdWx0bWFwcGluZwogICAgcHJpdmF0ZSBTY2hlbWFHcm91cCBfc2No\nZW1hID0gbnVsbDsKICAgIHByaXZhdGUgU3RyYXRlZ3lJbnN0YWxsZXIgX2lu\nc3RhbGxlciA9IG51bGw7CgogICAgLyoqCiAgICAgKiBEZWZhdWx0IGNvbnN0\ncnVjdG9yLiAgQ29uZmlndXJlIHZpYSAKICAgICAqIHtAbGluayBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlfS4KICAgICAqLwog\nICAgcHVibGljIE1hcHBpbmdSZXBvc2l0b3J5KCkgewogICAgICAgIHNldFZh\nbGlkYXRlKFZBTElEQVRFX01BUFBJTkcsIHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVuaWVudCBhY2Nlc3MgdG8gZGljdGlvbmFyeSBmb3Ig\nbWFwcGluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBEQkRpY3Rpb25hcnkgZ2V0\nREJEaWN0aW9uYXJ5KCkgewogICAgICAgIHJldHVybiBfZGljdDsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1hcHBpbmcgZGVmYXVsdHMuCiAgICAgKi8KICAg\nIHB1YmxpYyBNYXBwaW5nRGVmYXVsdHMgZ2V0TWFwcGluZ0RlZmF1bHRzKCkg\newogICAgICAgIHJldHVybiBfZGVmYXVsdHM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYXBwaW5nIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldE1hcHBpbmdEZWZhdWx0cyhNYXBwaW5nRGVmYXVsdHMgZGVmYXVsdHMp\nIHsKICAgICAgICBfZGVmYXVsdHMgPSBkZWZhdWx0czsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRhYmFzZSBzY2hl\nbWEuCiAgICAgKi8KICAgIHB1YmxpYyBTY2hlbWFHcm91cCBnZXRTY2hlbWFH\ncm91cCgpIHsKICAgICAgICBpZiAoX3NjaGVtYSA9PSBudWxsKQogICAgICAg\nICAgICBfc2NoZW1hID0gKChKREJDQ29uZmlndXJhdGlvbikgZ2V0Q29uZmln\ndXJhdGlvbigpKS4KICAgICAgICAgICAgICAgIGdldFNjaGVtYUZhY3RvcnlJ\nbnN0YW5jZSgpLnJlYWRTY2hlbWEoKTsKICAgICAgICByZXR1cm4gX3NjaGVt\nYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudGF0aW9uIG9mIHRo\nZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFNjaGVtYUdyb3VwKFNjaGVtYUdyb3VwIHNjaGVtYSkgewogICAgICAgIF9z\nY2hlbWEgPSBzY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YWxs\ncyBtYXBwaW5nIHN0cmF0ZWdpZXMgb24gY29tcG9uZW50cy4KICAgICAqLwog\nICAgcHVibGljIFN0cmF0ZWd5SW5zdGFsbGVyIGdldFN0cmF0ZWd5SW5zdGFs\nbGVyKCkgewogICAgICAgIGlmIChfaW5zdGFsbGVyID09IG51bGwpCiAgICAg\nICAgICAgIF9pbnN0YWxsZXIgPSBuZXcgUnVudGltZVN0cmF0ZWd5SW5zdGFs\nbGVyKHRoaXMpOwogICAgICAgIHJldHVybiBfaW5zdGFsbGVyOwogICAgfQoK\nICAgIC8qKgogICAgICogSW5zdGFsbHMgbWFwcGluZyBzdHJhdGVnaWVzIG9u\nIGNvbXBvbmVudHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFN0cmF0\nZWd5SW5zdGFsbGVyKFN0cmF0ZWd5SW5zdGFsbGVyIGluc3RhbGxlcikgewog\nICAgICAgIF9pbnN0YWxsZXIgPSBpbnN0YWxsZXI7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nIGZvciB0\naGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5UmVzdWx0\nTWFwcGluZyBnZXRRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLAogICAg\nICAgIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xl\nYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMgPSBnZXRRdWVy\neVJlc3VsdE1hcHBpbmdJbnRlcm5hbChjbHMsIG5hbWUsIGVudkxvYWRlcik7\nCiAgICAgICAgICAgIGlmIChyZXMgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLXF1ZXJ5LXJlcyIsIGNscywgbmFtZSkpOwogICAgICAgICAg\nICByZXR1cm4gcmVzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybmVkIHRoZSBxdWVyeSByZXN1bHQgbWFwcGluZyB3aXRoIHRoZSBnaXZl\nbiBuYW1lLgogICAgICovCiAgICBwcml2YXRlIFF1ZXJ5UmVzdWx0TWFwcGlu\nZyBnZXRRdWVyeVJlc3VsdE1hcHBpbmdJbnRlcm5hbChDbGFzcyBjbHMsCiAg\nICAgICAgU3RyaW5nIG5hbWUsIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewog\nICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICAvLyBjaGVjayBjYWNoZQogICAgICAgIE9iamVjdCBr\nZXkgPSBnZXRRdWVyeVJlc3VsdEtleShjbHMsIG5hbWUpOwogICAgICAgIFF1\nZXJ5UmVzdWx0TWFwcGluZyByZXMgPSAoUXVlcnlSZXN1bHRNYXBwaW5nKSBf\ncmVzdWx0cy5nZXQoa2V5KTsKICAgICAgICBpZiAocmVzICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiByZXM7CgogICAgICAgIC8vIGdldCBtZXRhZGF0\nYSBmb3IgY2xhc3MsIHdoaWNoIHdpbGwgZmluZCByZXN1bHRzIGluIG1ldGFk\nYXRhIGZpbGUKICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgZ2V0TWV0YURh\ndGEoY2xzLCBlbnZMb2FkZXIsIGZhbHNlKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIHJlcyA9IChRdWVyeVJlc3VsdE1hcHBpbmcpIF9yZXN1bHRzLmdldChr\nZXkpOwogICAgICAgICAgICBpZiAocmVzICE9IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KICAgICAgICBpZiAoKGdldFNv\ndXJjZU1vZGUoKSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAg\nICAgIGNscyA9IGdldE1ldGFEYXRhRmFjdG9yeSgpCiAgICAgICAgICAgICAg\nICAgICAgLmdldFJlc3VsdFNldE1hcHBpbmdTY29wZShuYW1lLCBlbnZMb2Fk\nZXIpOwogICAgICAgIC8vIG5vdCBpbiBjYWNoZTsgbG9hZAogICAgICAgIGdl\ndE1ldGFEYXRhRmFjdG9yeSgpLmxvYWQoY2xzLCBNT0RFX01FVEEgfCBNT0RF\nX01BUFBJTkcsIGVudkxvYWRlcik7CiAgICAgICAgcmV0dXJuIChRdWVyeVJl\nc3VsdE1hcHBpbmcpIF9yZXN1bHRzLmdldChrZXkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGFsbCBjYWNoZWQgcXVlcnkgcmVzdWx0IG1hcHBp\nbmdzLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFF1ZXJ5UmVz\ndWx0TWFwcGluZ1tdIGdldFF1ZXJ5UmVzdWx0TWFwcGluZ3MoKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENvbGxlY3Rp\nb24gdmFsdWVzID0gX3Jlc3VsdHMudmFsdWVzKCk7CiAgICAgICAgICAgIHJl\ndHVybiAoUXVlcnlSZXN1bHRNYXBwaW5nW10pIHZhbHVlcy50b0FycmF5KG5l\ndyBRdWVyeVJlc3VsdE1hcHBpbmdbdmFsdWVzLnNpemUoKV0pOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHF1ZXJ5\nIHJlc3VsdCBtYXBwaW5nIHdpdGggdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwg\naWYKICAgICAqIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeVJlc3Vs\ndE1hcHBpbmcgZ2V0Q2FjaGVkUXVlcnlSZXN1bHRNYXBwaW5nCiAgICAgICAg\nKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChRdWVyeVJlc3VsdE1h\ncHBpbmcpIF9yZXN1bHRzLmdldChnZXRRdWVyeVJlc3VsdEtleShjbHMsIG5h\nbWUpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBxdWVy\neSByZXN1bHQgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5UmVz\ndWx0TWFwcGluZyBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLAog\nICAgICAgIFN0cmluZyBuYW1lKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMgPSBu\nZXcgUXVlcnlSZXN1bHRNYXBwaW5nKG5hbWUsIHRoaXMpOwogICAgICAgICAg\nICByZXMuc2V0RGVmaW5pbmdUeXBlKGNscyk7CiAgICAgICAgICAgIF9yZXN1\nbHRzLnB1dChnZXRRdWVyeVJlc3VsdEtleShyZXMpLCByZXMpOwogICAgICAg\nICAgICByZXR1cm4gcmVzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbW92ZSBhIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiByZW1vdmVRdWVyeVJlc3VsdE1hcHBpbmcKICAgICAg\nICAoUXVlcnlSZXN1bHRNYXBwaW5nIHJlcykgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMucmVt\nb3ZlKGdldFF1ZXJ5UmVzdWx0S2V5KHJlcykpICE9IG51bGw7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgcXVlcnkgcmVzdWx0IG1h\ncHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5\nUmVzdWx0TWFwcGluZyhDbGFzcyBjbHMsCiAgICAgICAgU3RyaW5nIG5hbWUp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzLnJlbW92ZShnZXRRdWVy\neVJlc3VsdEtleShjbHMsIG5hbWUpKSAhPSBudWxsOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1ZSBrZXkgZm9yIHRoZSBn\naXZlbiBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmpl\nY3QgZ2V0UXVlcnlSZXN1bHRLZXkoUXVlcnlSZXN1bHRNYXBwaW5nIHJlcykg\newogICAgICAgIGlmIChyZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFF1ZXJ5UmVzdWx0S2V5KHJlcy5n\nZXREZWZpbmluZ1R5cGUoKSwgcmVzLmdldE5hbWUoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciB0aGUgZ2l2ZW4g\nY2xhc3MgLyBuYW1lLiBUaGUgY2xhc3MgYXJndW1lbnQKICAgICAqIGNhbiBi\nZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgZ2V0\nUXVlcnlSZXN1bHRLZXkoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSkgewogICAg\nICAgIHJldHVybiBnZXRRdWVyeUtleShjbHMsIG5hbWUpOwogICAgfQoKICAg\nIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0TWFwcGluZyhDbGFzcyBjbHMsIENs\nYXNzTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBib29sZWFuIG11c3RFeGlz\ndCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nKSBzdXBlci5nZXRN\nZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0TWFwcGluZ3MoKSB7CiAgICAg\nICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkgc3VwZXIuZ2V0TWV0YURhdGFz\nKCk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZyBnZXRNYXBwaW5n\nKE9iamVjdCBvaWQsIENsYXNzTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBi\nb29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBw\naW5nKSBzdXBlci5nZXRNZXRhRGF0YShvaWQsIGVudkxvYWRlciwgbXVzdEV4\naXN0KTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0SW1w\nbGVtZW50b3JNYXBwaW5ncyhDbGFzcyBjbHMsCiAgICAgICAgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIHJl\ndHVybiAoQ2xhc3NNYXBwaW5nW10pIHN1cGVyLmdldEltcGxlbWVudG9yTWV0\nYURhdGFzKGNscywgZW52TG9hZGVyLAogICAgICAgICAgICBtdXN0RXhpc3Qp\nOwogICAgfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBjbGVhcigp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nc3VwZXIuY2xlYXIoKTsKICAgICAgICAgICAgX3NjaGVtYSA9IG51bGw7CiAg\nICAgICAgICAgIF9yZXN1bHRzLmNsZWFyKCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByb3RlY3RlZCB2b2lkIHByZXBhcmVNYXBwaW5nKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNzIHJlc29s\ndmVkIGZpcnN0OyByZXNvbHZpbmcgc3VwZXJjbGFzcyBtYXkgaGF2ZQogICAg\nICAgIC8vIHJlc29sdmVkIHRoaXMgbWFwcGluZwogICAgICAgIENsYXNzTWFw\ncGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgbWV0YTsKICAgICAgICBD\nbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIChtYXBwaW5nLmdl\ndFJlc29sdmUoKSAmIE1PREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIAogICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZyBp\ncyBub3QgZm9yIGEgbWFuYWdlZCBpbnRlcmZhY2UsIGVuc3VyZSB0aGF0IGlm\nIAogICAgICAgIC8vIHdlIGhhdmUgYW4gaW5oZXJpdGFuY2UgaGllcmFyY2h5\nIHRoZXJlIGlzIGEgZGVmYXVsdCBzdHJhdGVneQogICAgICAgIC8vIGFwcGxp\nZWQgdG8gdGhlIHJvb3QgY2xhc3MKICAgICAgICBpZiAoIW1hcHBpbmcuZ2V0\nRGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJmYWNlKCkgJiYKICAgICAgICAgICAg\nIW1hcHBpbmcuaXNFbWJlZGRlZE9ubHkoKSkgewogICAgICAgICAgICAvLyBp\nZiBhbiBpbmhlcml0YW5jZSBzdHJhdGVneSBoYXMgbm90IGJlZW4gc2V0IG9u\nIHRoaXMgbWFwcGluZwogICAgICAgICAgICAvLyBkZXRlcm1pbmUgaWYgbmVl\nZHMgb25lIGFuZCBpZiBzbywgc2V0IGl0CiAgICAgICAgICAgIGlmICghaGFz\nSW5oZXJpdGFuY2VTdHJhdGVneShtYXBwaW5nKSkgewogICAgICAgICAgICAg\nICAgQ2xhc3NNYXBwaW5nIGJhc2VNYXBwaW5nID0gZmluZEJhc2VDbGFzc01h\ncHBpbmcobWFwcGluZyk7IAogICAgICAgICAgICAgICAgaWYgKGJhc2VNYXBw\naW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc2V0RGVmYXVsdElu\naGVyaXRhbmNlU3RyYXRlZ3koYmFzZU1hcHBpbmcpOwogICAgICAgICAgICB9\nICAgICAgICAgICAgCiAgICAgICAgfQoKICAgICAgICAvLyBkZWZpbmUgc3Vw\nZXJjbGFzcyBmaWVsZHMgYWZ0ZXIgbWFwcGluZyBjbGFzcywgc28gd2UgY2Fu\nIHRlbGwgd2hldGhlcgogICAgICAgIC8vIHRoZSBjbGFzcyBpcyBtYXBwZWQg\nYW5kIG5lZWRzIHRvIHJlZGVmaW5lIGFic3RyYWN0IHN1cGVyY2xhc3MgZmll\nbGRzCiAgICAgICAgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pbnN0YWxsU3Ry\nYXRlZ3kobWFwcGluZyk7CiAgICAgICAgbWFwcGluZy5kZWZpbmVTdXBlcmNs\nYXNzRmllbGRzKG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCkKICAgICAgICAgICAgPT0gbnVsbCk7CgogICAgICAgIC8vIHJlc29s\ndmUgZXZlcnl0aGluZyB0aGF0IGRvZXNuJ3QgaW52b2x2ZSByZWxhdGlvbnMg\ndG8gYWxsb3cgcmVsYXRpb24KICAgICAgICAvLyBtYXBwaW5ncyB0byB1c2Ug\ndGhlIG90aGVycyBhcyBqb2luYWJsZXMKICAgICAgICBtYXBwaW5nLnJlc29s\ndmVOb25SZWxhdGlvbk1hcHBpbmdzKCk7CiAgICB9CgogICAgcHJvdGVjdGVk\nIENsYXNzTWV0YURhdGEgbmV3Q2xhc3NNZXRhRGF0YShDbGFzcyB0eXBlKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01hcHBpbmcodHlwZSwgdGhpcyk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGFbXSBuZXdDbGFz\nc01ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkgewogICAgICAgIHJldHVybiBu\nZXcgQ2xhc3NNYXBwaW5nW2xlbmd0aF07CiAgICB9CgogICAgcHJvdGVjdGVk\nIEZpZWxkTWV0YURhdGEgbmV3RmllbGRNZXRhRGF0YShTdHJpbmcgbmFtZSwg\nQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG93bmVyKSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBGaWVsZE1hcHBpbmcobmFtZSwgdHlwZSwgKENs\nYXNzTWFwcGluZykgb3duZXIpOwogICAgfQoKICAgIHByb3RlY3RlZCBGaWVs\nZE1ldGFEYXRhW10gbmV3RmllbGRNZXRhRGF0YUFycmF5KGludCBsZW5ndGgp\nIHsKICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWFwcGluZ1tsZW5ndGhdOwog\nICAgfQoKICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIG5ld0VtYmVkZGVk\nQ2xhc3NNZXRhRGF0YShWYWx1ZU1ldGFEYXRhIG93bmVyKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBDbGFzc01hcHBpbmcob3duZXIpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCBWYWx1ZU1ldGFEYXRhIG5ld1ZhbHVlTWV0YURhdGEoRmllbGRN\nZXRhRGF0YSBvd25lcikgewogICAgICAgIHJldHVybiBuZXcgVmFsdWVNYXBw\naW5nSW1wbCgoRmllbGRNYXBwaW5nKSBvd25lcik7CiAgICB9CgogICAgcHJv\ndGVjdGVkIFNlcXVlbmNlTWV0YURhdGEgbmV3U2VxdWVuY2VNZXRhRGF0YShT\ndHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiBuZXcgU2VxdWVuY2VNYXBw\naW5nKG5hbWUsIHRoaXMpOwogICAgfQoKICAgIHByb3RlY3RlZCBPcmRlciBu\nZXdWYWx1ZU9yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsIGJvb2xlYW4gYXNj\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBKREJDVmFsdWVPcmRlcigoRmllbGRN\nYXBwaW5nKSBvd25lciwgYXNjKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgT3Jk\nZXIgbmV3UmVsYXRlZEZpZWxkT3JkZXIoRmllbGRNZXRhRGF0YSBvd25lciwK\nICAgICAgICBGaWVsZE1ldGFEYXRhIHJlbCwgYm9vbGVhbiBhc2MpIHsKICAg\nICAgICByZXR1cm4gbmV3IEpEQkNSZWxhdGVkRmllbGRPcmRlcigoRmllbGRN\nYXBwaW5nKSBvd25lciwKICAgICAgICAgICAgKEZpZWxkTWFwcGluZykgcmVs\nLCBhc2MpOwogICAgfQoKICAgIHByb3RlY3RlZCBPcmRlcltdIG5ld09yZGVy\nQXJyYXkoaW50IHNpemUpIHsKICAgICAgICByZXR1cm4gbmV3IEpEQkNPcmRl\ncltzaXplXTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB2ZXJzaW9u\nIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBWZXJzaW9uIG5ld1ZlcnNpb24oQ2xhc3NNYXBwaW5nIGNscykg\newogICAgICAgIHJldHVybiBuZXcgVmVyc2lvbihjbHMpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGRpc2NyaW1pbmF0b3IgbWV0YWRhdGEgZm9y\nIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIERpc2Ny\naW1pbmF0b3IgbmV3RGlzY3JpbWluYXRvcihDbGFzc01hcHBpbmcgY2xzKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBEaXNjcmltaW5hdG9yKGNscyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmF3IG1hcHBpbmcgaW5mbyBmb3Ig\ndGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xh\nc3NNYXBwaW5nSW5mbyBuZXdNYXBwaW5nSW5mbyhDbGFzc01hcHBpbmcgY2xz\nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0gbmV3IENsYXNz\nTWFwcGluZ0luZm8oKTsKICAgICAgICBpbmZvLnNldENsYXNzTmFtZShjbHMu\nZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSk7CiAgICAgICAgcmV0dXJu\nIGluZm87CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmF3IG1hcHBp\nbmcgaW5mbyBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgRmllbGRNYXBwaW5nSW5mbyBuZXdNYXBwaW5nSW5mbyhGaWVs\nZE1hcHBpbmcgZm0pIHsKICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWFwcGlu\nZ0luZm8oKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSByYXcgbWFw\ncGluZyBpbmZvIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBWYWx1ZU1hcHBpbmdJbmZvIG5ld01hcHBpbmdJbmZvKFZh\nbHVlTWFwcGluZyB2bSkgewogICAgICAgIHJldHVybiBuZXcgVmFsdWVNYXBw\naW5nSW5mbygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHJhdyBt\nYXBwaW5nIGluZm8gZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFZlcnNpb25NYXBwaW5nSW5mbyBuZXdNYXBwaW5nSW5m\nbyhWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICByZXR1cm4gbmV3IFZlcnNp\nb25NYXBwaW5nSW5mbygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIHJhdyBtYXBwaW5nIGluZm8gZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIERpc2NyaW1pbmF0b3JNYXBwaW5nSW5mbyBu\nZXdNYXBwaW5nSW5mbyhEaXNjcmltaW5hdG9yIGRpc2MpIHsKICAgICAgICBy\nZXR1cm4gbmV3IERpc2NyaW1pbmF0b3JNYXBwaW5nSW5mbygpOwogICAgfQoK\nICAgIC8qKgogICAgICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIGNsYXNzJyBu\nYW1lZCBzdHJhdGVneSwgb3IgcmV0dXJuIG51bGwgaWYgbm8KICAgICAqIG5h\nbWVkIHN0cmF0ZWd5LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NTdHJh\ndGVneSBuYW1lZFN0cmF0ZWd5KENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAg\nICBTdHJpbmcgbmFtZSA9IGNscy5nZXRNYXBwaW5nSW5mbygpLmdldFN0cmF0\nZWd5KCk7CiAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlQ2xhc3NTdHJhdGVn\neShuYW1lLCBjbHMpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIG5hbWUuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBDbGFzc1N0cmF0ZWd5IGluc3RhbnRpYXRlQ2xhc3NTdHJhdGVn\neShTdHJpbmcgbmFtZSwKICAgICAgICBDbGFzc01hcHBpbmcgY2xzKSB7CiAg\nICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgaWYgKE5vbmVDbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFs\ncyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVDbGFzc1N0cmF0ZWd5\nLmdldEluc3RhbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENvbmZp\nZ3VyYXRpb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFtZSA9\nIENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAgICBD\nbGFzcyBzdHJhdCA9IG51bGw7CgogICAgICAgIC8vIGJhc2UgYW5kIHZlcnRp\nY2FsIHN0cmF0ZWdpZXMgdXNlIHNhbWUgYWxpYXM7IGRpZmZlcmVudGlhdGUg\nb24gam9pbgogICAgICAgIGlmIChGdWxsQ2xhc3NTdHJhdGVneS5BTElBUy5l\ncXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gRnVsbENsYXNzU3Ry\nYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoRmxhdENsYXNzU3RyYXRl\nZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IEZs\nYXRDbGFzc1N0cmF0ZWd5LmNsYXNzOwogICAgICAgIGVsc2UgaWYgKFZlcnRp\nY2FsQ2xhc3NTdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAg\nICAgIHN0cmF0ID0gVmVydGljYWxDbGFzc1N0cmF0ZWd5LmNsYXNzOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzdHJhdCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgc3RyYXQgPSBKYXZhVHlwZXMuY2xhc3NGb3JOYW1lKG5h\nbWUsIGNscywKICAgICAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBDbGFzc1N0cmF0ZWd5LmNsYXNzKSkpOwogICAgICAg\nICAgICBDbGFzc1N0cmF0ZWd5IHN0cmF0ZWd5ID0gCiAgICAgICAgICAgICAg\nICAoQ2xhc3NTdHJhdGVneSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5z\ndGFuY2VBY3Rpb24oc3RyYXQpKTsKICAgICAgICAgICAgQ29uZmlndXJhdGlv\nbnMuY29uZmlndXJlSW5zdGFuY2Uoc3RyYXRlZ3ksIGdldENvbmZpZ3VyYXRp\nb24oKSwKICAgICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICAgICAgcmV0\ndXJuIHN0cmF0ZWd5OwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlv\nbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRB\nY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1j\nbHMtc3RyYXRlZ3kiLAogICAgICAgICAgICAgICAgY2xzLCBuYW1lKSwgZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGUg\ndGhlIGdpdmVuIGZpZWxkJ3MgbmFtZWQgc3RyYXRlZ3ksIG9yIHJldHVybiBu\ndWxsIGlmIG5vCiAgICAgKiBuYW1lZCBzdHJhdGVneS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgbmFtZWRTdHJhdGVneShGaWVsZE1h\ncHBpbmcgZmllbGQsCiAgICAgICAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMp\nIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGZpZWxkLmdldE1hcHBpbmdJbmZv\nKCkuZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKE5vbmVGaWVs\nZFN0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0\ndXJuIE5vbmVGaWVsZFN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAg\nIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMo\nbmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNz\nTmFtZShuYW1lKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzcyBj\nID0gSmF2YVR5cGVzLmNsYXNzRm9yTmFtZShuYW1lLCBmaWVsZCwKICAgICAg\nICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVy\nQWN0aW9uKEZpZWxkU3RyYXRlZ3kuY2xhc3MpKSk7CiAgICAgICAgICAgIGlm\nIChGaWVsZFN0cmF0ZWd5LmNsYXNzLmlzQXNzaWduYWJsZUZyb20oYykpIHsK\nICAgICAgICAgICAgICAgIEZpZWxkU3RyYXRlZ3kgc3RyYXQgPSAoRmllbGRT\ndHJhdGVneSkKICAgICAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oYykpOwogICAgICAgICAgICAg\nICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2Uoc3RyYXQsIGdl\ndENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgICAgICBwcm9wcyk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyYXQ7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIG11c3QgYmUgbmFtZWQgaGFuZGxlcgogICAgICAg\nICAgICBpZiAoaW5zdGFsbEhhbmRsZXJzKSB7CiAgICAgICAgICAgICAgICBW\nYWx1ZUhhbmRsZXIgdmggPSAoVmFsdWVIYW5kbGVyKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjKSk7CiAgICAgICAgICAgICAg\nICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZSh2aCwgZ2V0Q29u\nZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgICAgIHByb3BzKTsKICAg\nICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRsZXIodmgpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlckZpZWxkU3RyYXRl\nZ3koKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24pCiAgICAgICAgICAgICAgICBlID0gKChQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmllbGQtc3Ry\nYXRlZ3kiLAogICAgICAgICAgICAgICAgZmllbGQsIG5hbWUpLCBlKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUg\nZ2l2ZW4gZGlzY3JpbWluYXRvcidzIG5hbWVkIHN0cmF0ZWd5LCBvciByZXR1\ncm4gbnVsbAogICAgICogaWYgbm8gbmFtZWQgc3RyYXRlZ3kuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBEaXNjcmltaW5hdG9yU3RyYXRlZ3kgbmFtZWRTdHJh\ndGVneShEaXNjcmltaW5hdG9yIGRpc2NyaW0pIHsKICAgICAgICBTdHJpbmcg\nbmFtZSA9IGRpc2NyaW0uZ2V0TWFwcGluZ0luZm8oKS5nZXRTdHJhdGVneSgp\nOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIG5hbWVkIHN0cmF0\nZWd5IHByZXNlbnQsIGRpc2NhcmQgaXQgaWYgaXQgbWF0Y2hlcwogICAgICAg\nIC8vIHRoZSBiYXNlIHN0cmF0ZWd5LCBzbyB0aGF0IHdlIHdvbid0IGNyZWF0\nZSBhbiBpbmRlcGVuZGVudCBpbnN0YW5jZQogICAgICAgIENsYXNzTWFwcGlu\nZyBjbHMgPSBkaXNjcmltLmdldENsYXNzTWFwcGluZygpOwogICAgICAgIHdo\naWxlIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgY2xzID0gY2xzLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpOwogICAgICAgIERpc2NyaW1pbmF0b3IgYmFzZSA9\nIGNscy5nZXREaXNjcmltaW5hdG9yKCk7CiAgICAgICAgaWYgKGJhc2UgIT0g\nZGlzY3JpbSAmJiBiYXNlLmdldFN0cmF0ZWd5KCkgIT0gbnVsbAogICAgICAg\nICAgICAmJiBuYW1lLmVxdWFscyhiYXNlLmdldFN0cmF0ZWd5KCkuZ2V0QWxp\nYXMoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICByZXR1\ncm4gaW5zdGFudGlhdGVEaXNjcmltaW5hdG9yU3RyYXRlZ3kobmFtZSwgZGlz\nY3JpbSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUg\nZ2l2ZW4gZGlzY3JpbWluYXRvciBzdHJhdGVneS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIERpc2NyaW1pbmF0b3JTdHJhdGVneSBpbnN0YW50aWF0ZURpc2Ny\naW1pbmF0b3JTdHJhdGVneQogICAgICAgIChTdHJpbmcgbmFtZSwgRGlzY3Jp\nbWluYXRvciBkaXNjcmltKSB7CiAgICAgICAgaWYgKE5vbmVEaXNjcmltaW5h\ndG9yU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBy\nZXR1cm4gTm9uZURpc2NyaW1pbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgp\nOwoKICAgICAgICBTdHJpbmcgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5nZXRQ\ncm9wZXJ0aWVzKG5hbWUpOwogICAgICAgIG5hbWUgPSBDb25maWd1cmF0aW9u\ncy5nZXRDbGFzc05hbWUobmFtZSk7CiAgICAgICAgQ2xhc3Mgc3RyYXQgPSBu\ndWxsOwoKICAgICAgICBpZiAoQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0cmF0\nZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBD\nbGFzc05hbWVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAg\nZWxzZSBpZiAoVmFsdWVNYXBEaXNjcmltaW5hdG9yU3RyYXRlZ3kuQUxJQVMu\nZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IFZhbHVlTWFwRGlz\nY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzOwogICAgICAgIGVsc2UgaWYgKFN1\nYmNsYXNzSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneS5BTElBUy5lcXVhbHMo\nbmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gU3ViY2xhc3NKb2luRGlzY3Jp\nbWluYXRvclN0cmF0ZWd5LmNsYXNzOwoKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0cmF0\nID0gSmF2YVR5cGVzLmNsYXNzRm9yTmFtZShuYW1lLAogICAgICAgICAgICAg\nICAgICAgIGRpc2NyaW0uZ2V0Q2xhc3NNYXBwaW5nKCksCiAgICAgICAgICAg\nICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9h\nZGVyQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzY3Jp\nbWluYXRvclN0cmF0ZWd5LmNsYXNzKSkpOwogICAgICAgICAgICBEaXNjcmlt\naW5hdG9yU3RyYXRlZ3kgc3RyYXRlZ3kgPSAoRGlzY3JpbWluYXRvclN0cmF0\nZWd5KQogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3\nSW5zdGFuY2VBY3Rpb24oc3RyYXQpKTsKICAgICAgICAgICAgQ29uZmlndXJh\ndGlvbnMuY29uZmlndXJlSW5zdGFuY2Uoc3RyYXRlZ3ksIGdldENvbmZpZ3Vy\nYXRpb24oKSwKICAgICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICAgICAg\ncmV0dXJuIHN0cmF0ZWd5OwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVn\nZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJh\nZC1kaXNjcmltLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAgIGRpc2NyaW0u\nZ2V0Q2xhc3NNYXBwaW5nKCksIG5hbWUpLCBlKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmVyc2lv\nbidzIG5hbWVkIHN0cmF0ZWd5LCBvciByZXR1cm4gbnVsbAogICAgICogaWYg\nbm8gbmFtZWQgc3RyYXRlZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJz\naW9uU3RyYXRlZ3kgbmFtZWRTdHJhdGVneShWZXJzaW9uIHZlcnNpb24pIHsK\nICAgICAgICBTdHJpbmcgbmFtZSA9IHZlcnNpb24uZ2V0TWFwcGluZ0luZm8o\nKS5nZXRTdHJhdGVneSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBpZiB0aGVyZSBp\ncyBhIG5hbWVkIHN0cmF0ZWd5IHByZXNlbnQsIGRpc2NhcmQgaXQgaWYgaXQg\nbWF0Y2hlcwogICAgICAgIC8vIHRoZSBiYXNlIHN0cmF0ZWd5LCBzbyB0aGF0\nIHdlIHdvbid0IGNyZWF0ZSBhbiBpbmRlcGVuZGVudCBpbnN0YW5jZQogICAg\nICAgIENsYXNzTWFwcGluZyBjbHMgPSB2ZXJzaW9uLmdldENsYXNzTWFwcGlu\nZygpOwogICAgICAgIHdoaWxlIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gY2xzLmdl\ndEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIFZlcnNp\nb24gYmFzZSA9IGNscy5nZXRWZXJzaW9uKCk7CiAgICAgICAgaWYgKGJhc2Ug\nIT0gdmVyc2lvbiAmJiBiYXNlLmdldFN0cmF0ZWd5KCkgIT0gbnVsbAogICAg\nICAgICAgICAmJiBuYW1lLmVxdWFscyhiYXNlLmdldFN0cmF0ZWd5KCkuZ2V0\nQWxpYXMoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBy\nZXR1cm4gaW5zdGFudGlhdGVWZXJzaW9uU3RyYXRlZ3kobmFtZSwgdmVyc2lv\nbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2\nZW4gdmVyc2lvbiBzdHJhdGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZl\ncnNpb25TdHJhdGVneSBpbnN0YW50aWF0ZVZlcnNpb25TdHJhdGVneShTdHJp\nbmcgbmFtZSwKICAgICAgICBWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICBp\nZiAoTm9uZVZlcnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAg\nICAgICAgICAgIHJldHVybiBOb25lVmVyc2lvblN0cmF0ZWd5LmdldEluc3Rh\nbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25z\nLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3Vy\nYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAgICBDbGFzcyBzdHJh\ndCA9IG51bGw7CgogICAgICAgIGlmIChOdW1iZXJWZXJzaW9uU3RyYXRlZ3ku\nQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IE51bWJl\nclZlcnNpb25TdHJhdGVneS5jbGFzczsKICAgICAgICBlbHNlIGlmIChNdWx0\naUNvbHVtblZlcnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAg\nICAgICAgCXN0cmF0ID0gTXVsdGlDb2x1bW5WZXJzaW9uU3RyYXRlZ3kuY2xh\nc3M7CiAgICAgICAgZWxzZSBpZiAoVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5\nLkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBUaW1l\nc3RhbXBWZXJzaW9uU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAo\nTmFub1ByZWNpc2lvblRpbWVzdGFtcFZlcnNpb25TdHJhdGVneS5BTElBUy5l\ncXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gTmFub1ByZWNpc2lv\nblRpbWVzdGFtcFZlcnNpb25TdHJhdGVneS5jbGFzczsKICAgICAgICBlbHNl\nIGlmIChTdGF0ZUNvbXBhcmlzb25WZXJzaW9uU3RyYXRlZ3kuQUxJQVMuZXF1\nYWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IFN0YXRlQ29tcGFyaXNv\nblZlcnNpb25TdHJhdGVneS5jbGFzczsKCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgICAgICBzdHJh\ndCA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUobmFtZSwKICAgICAgICAgICAg\nICAgICAgICB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpLAogICAgICAgICAg\nICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xv\nYWRlckFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNp\nb25TdHJhdGVneS5jbGFzcykpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC12ZXJzaW9uLXN0cmF0ZWd5IiwKICAgICAgICAg\nICAgICAgIHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCksIG5hbWUpLCBlKTsK\nICAgICAgICB9CgogICAgICAgIHJldHVybiBpbnN0YW50aWF0ZVZlcnNpb25T\ndHJhdGVneShzdHJhdCwgdmVyc2lvbiwgcHJvcHMpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIHZlcnNpb24gc3RyYXRl\nZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kgaW5z\ndGFudGlhdGVWZXJzaW9uU3RyYXRlZ3koQ2xhc3Mgc3RyYXQsCiAgICAgICAg\nVmVyc2lvbiB2ZXJzaW9uLCBTdHJpbmcgcHJvcHMpIHsKICAgICAgICB0cnkg\newogICAgICAgICAgICBWZXJzaW9uU3RyYXRlZ3kgc3RyYXRlZ3kgPSAoVmVy\nc2lvblN0cmF0ZWd5KQogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oc3RyYXQpKTsKICAgICAgICAgICAg\nQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2Uoc3RyYXRlZ3ksIGdl\ndENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIHByb3BzKTsKICAg\nICAgICAgICAgcmV0dXJuIHN0cmF0ZWd5OwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJp\ndmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIGUgPSAo\nKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigp\nOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC12ZXJzaW9uLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAg\nIHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCksIHN0cmF0ICsgIiIpLCBlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhl\nIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gY2xhc3Mu\nIERvZXMKICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgY3VycmVu\ndCBzdHJhdGVneSwgaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xh\nc3NTdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koQ2xhc3NNYXBwaW5nIGNscykg\newogICAgICAgIHJldHVybiBkZWZhdWx0U3RyYXRlZ3koY2xzLCBnZXRTdHJh\ndGVneUluc3RhbGxlcigpLmlzQWRhcHRpbmcoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNl\nIGZvciB0aGUgZ2l2ZW4gY2xhc3MuIERvZXMKICAgICAqIG5vdCB0YWtlIGlu\ndG8gYWNjb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NTdHJhdGVneSBkZWZhdWx0U3RyYXRl\nZ3koQ2xhc3NNYXBwaW5nIGNscywKICAgICAgICBib29sZWFuIGFkYXB0aW5n\nKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVtYmVkID0gY2xzLmdldEVtYmVk\nZGluZ01hcHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAvLyBzdXBlcmNsYXNzIG9mIGVtYmVkZGVkIGNsYXNzIGlz\nbid0IG1hcHBlZAogICAgICAgICAgICBpZiAoZW1iZWQuZ2V0VHlwZSgpICE9\nIGNscy5nZXREZXNjcmliZWRUeXBlKCkKICAgICAgICAgICAgICAgIHx8IGVt\nYmVkLmdldEZpZWxkTWFwcGluZygpLmdldFN0cmF0ZWd5KCkKICAgICAgICAg\nICAgICAgID09IE5vbmVGaWVsZFN0cmF0ZWd5LmdldEluc3RhbmNlKCkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgaWYgKGVtYmVkLmdldFR5cGVDb2RlKCkg\nPT0gSmF2YVR5cGVzLk9JRCkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\nT2JqZWN0SWRDbGFzc1N0cmF0ZWd5KCk7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgRW1iZWRkZWRDbGFzc1N0cmF0ZWd5KCk7CiAgICAgICAgfQogICAgICAg\nIGlmIChjbHMuaXNFbWJlZGRlZE9ubHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAgIE9i\namVjdCBzdHJhdCA9IF9kZWZhdWx0cy5nZXRTdHJhdGVneShjbHMsIGFkYXB0\naW5nKTsKICAgICAgICBpZiAoc3RyYXQgaW5zdGFuY2VvZiBTdHJpbmcpCiAg\nICAgICAgICAgIHJldHVybiBpbnN0YW50aWF0ZUNsYXNzU3RyYXRlZ3koKFN0\ncmluZykgc3RyYXQsIGNscyk7CiAgICAgICAgaWYgKHN0cmF0ICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiAoQ2xhc3NTdHJhdGVneSkgc3RyYXQ7CiAg\nICAgICAgCiAgICAgICAgLy8gc2VlIGlmIHRoZXJlIGlzIGEgZGVjbGFyZWQg\naGllcmFyY2h5IHN0cmF0ZWd5CiAgICAgICAgQ2xhc3NTdHJhdGVneSBoc3Ry\nYXQgPSBudWxsOwogICAgICAgIGZvciAoQ2xhc3NNYXBwaW5nIGJhc2UgPSBj\nbHM7IGJhc2UgIT0gbnVsbCAmJiBoc3RyYXQgPT0gbnVsbDspIHsKICAgICAg\nICAgICAgaHN0cmF0ID0gaW5zdGFudGlhdGVDbGFzc1N0cmF0ZWd5KGJhc2Uu\nZ2V0TWFwcGluZ0luZm8oKS4KICAgICAgICAgICAgICAgIGdldEhpZXJhcmNo\neVN0cmF0ZWd5KCksIGNscyk7CiAgICAgICAgICAgIGJhc2UgPSBiYXNlLmdl\ndE1hcHBlZFBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHRoZSBmdWxsIHN0cmF0ZWd5IGFzIGFwcGxpZWQgdG8gYSBoaWVy\nYXJjaHkgaXMgYQogICAgICAgIC8vIHRhYmxlLXBlci1jb25jcmV0ZS1jbGFz\ncyBzdHJhdGVneSwgc28gZG9uJ3QgbWFwIGFic3RyYWN0IHR5cGVzCiAgICAg\nICAgaWYgKGhzdHJhdCBpbnN0YW5jZW9mIEZ1bGxDbGFzc1N0cmF0ZWd5CiAg\nICAgICAgICAgICYmICFjbHMuaXNNYW5hZ2VkSW50ZXJmYWNlKCkKICAgICAg\nICAgICAgJiYgTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgcmV0dXJuIE5v\nbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIHN1cCA9IGNscy5nZXRNYXBwZWRQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbmV3IEZ1bGxDbGFzc1N0cmF0ZWd5KCk7CiAgICAgICAg\naWYgKGhzdHJhdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gaHN0cmF0\nOwogICAgICAgIHJldHVybiBuZXcgRmxhdENsYXNzU3RyYXRlZ3koKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVmYXVsdCBzdHJh\ndGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiBmaWVsZC4gRG9lcwogICAgICog\nbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBuYW1lZCBvciBjdXJyZW50IHN0\ncmF0ZWd5LCBpZiBhbnkuIElmIGEKICAgICAqIG5vbi1udWxsIHN0cmF0ZWd5\nIGlzIHJldHVybmVkLCB0aGlzIG1ldGhvZCBtYXkgYXMgYSBzaWRlIGVmZmVj\ndCBpbnN0YWxsCiAgICAgKiB2YWx1ZSBoYW5kbGVycyBvbiB0aGUgZmllbGQn\ncyB2YWx1ZSBtYXBwaW5ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxk\nU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVsZCwK\nICAgICAgICBib29sZWFuIGluc3RhbGxIYW5kbGVycykgewogICAgICAgIHJl\ndHVybiBkZWZhdWx0U3RyYXRlZ3koZmllbGQsIGluc3RhbGxIYW5kbGVycywK\nICAgICAgICAgICAgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5n\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZh\ndWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIGZpZWxkLiBEb2Vz\nCiAgICAgKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIG5hbWVkIG9yIGN1\ncnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4gSWYgYQogICAgICogbm9uLW51bGwg\nc3RyYXRlZ3kgaXMgcmV0dXJuZWQsIHRoaXMgbWV0aG9kIG1heSBhcyBhIHNp\nZGUgZWZmZWN0IGluc3RhbGwKICAgICAqIHZhbHVlIGhhbmRsZXJzIG9uIHRo\nZSBmaWVsZCdzIHZhbHVlIG1hcHBpbmdzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgRmllbGRTdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koRmllbGRNYXBwaW5n\nIGZpZWxkLAogICAgICAgIGJvb2xlYW4gaW5zdGFsbEhhbmRsZXJzLCBib29s\nZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgLy8gbm90IHBlcnNpc3RlbnQ/CiAg\nICAgICAgaWYgKGZpZWxkLmdldE1hbmFnZW1lbnQoKSAhPSBmaWVsZC5NQU5B\nR0VfUEVSU0lTVEVOVAogICAgICAgICAgICB8fCBmaWVsZC5pc1ZlcnNpb24o\nKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVGaWVsZFN0cmF0ZWd5LmdldElu\nc3RhbmNlKCk7CiAgICAgICAgaWYgKGZpZWxkLmdldERlZmluaW5nTWFwcGlu\nZygpLmdldFN0cmF0ZWd5KCkgPT0KICAgICAgICAgICAgTm9uZUNsYXNzU3Ry\nYXRlZ3kuZ2V0SW5zdGFuY2UoKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVG\naWVsZFN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAgIC8vIGNoZWNr\nIGZvciBuYW1lZCBoYW5kbGVyIGZpcnN0CiAgICAgICAgVmFsdWVIYW5kbGVy\nIGhhbmRsZXIgPSBuYW1lZEhhbmRsZXIoZmllbGQpOwogICAgICAgIGlmICho\nYW5kbGVyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGluc3RhbGxIYW5k\nbGVycykKICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRsZXIoaGFuZGxl\ncik7CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlckZpZWxkU3RyYXRl\nZ3koKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaWVsZC5pc1NlcmlhbGl6\nZWQoKSkgewogICAgICAgICAgICBpZiAoX2RpY3QubWF4RW1iZWRkZWRCbG9i\nU2l6ZSAhPSAtMSkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTWF4RW1i\nZWRkZWRCbG9iRmllbGRTdHJhdGVneSgpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIC8vIGNoZWNrIGZvciBtYXBwZWQgc3RyYXRlZ3kKICAgICAg\nICAgICAgT2JqZWN0IHN0cmF0ID0gbWFwcGVkU3RyYXRlZ3koZmllbGQsIGZp\nZWxkLmdldFR5cGUoKSwgYWRhcHRpbmcpOwogICAgICAgICAgICBpZiAoc3Ry\nYXQgaW5zdGFuY2VvZiBGaWVsZFN0cmF0ZWd5KQogICAgICAgICAgICAgICAg\ncmV0dXJuIChGaWVsZFN0cmF0ZWd5KSBzdHJhdDsKICAgICAgICAgICAgaWYg\nKHN0cmF0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChpbnN0YWxs\nSGFuZGxlcnMpCiAgICAgICAgICAgICAgICAgICAgZmllbGQuc2V0SGFuZGxl\ncigoVmFsdWVIYW5kbGVyKSBzdHJhdCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IEhhbmRsZXJGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGZvciBrbm93biBmaWVsZCBz\ndHJhdGVnaWVzCiAgICAgICAgaWYgKCFmaWVsZC5pc1NlcmlhbGl6ZWQoKSAm\nJiAoZmllbGQuZ2V0VHlwZSgpID09IGJ5dGVbXS5jbGFzcwogICAgICAgICAg\nICB8fCBmaWVsZC5nZXRUeXBlKCkgPT0gQnl0ZVtdLmNsYXNzKSkgewogICAg\nICAgICAgICBpZiAoX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6ZSAhPSAtMSkK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTWF4RW1iZWRkZWRCeXRlQXJy\nYXlGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgfSBlbHNlIGlmICghZmllbGQu\naXNTZXJpYWxpemVkKCkKICAgICAgICAgICAgJiYgKGZpZWxkLmdldFR5cGUo\nKSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAgfHwgZmllbGQuZ2V0VHlw\nZSgpID09IENoYXJhY3RlcltdLmNsYXNzKSkgewogICAgICAgICAgICBpZiAo\nX2RpY3QubWF4RW1iZWRkZWRDbG9iU2l6ZSAhPSAtMSAmJiBpc0Nsb2IoZmll\nbGQsIGZhbHNlKSkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTWF4RW1i\nZWRkZWRDaGFyQXJyYXlGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgfSBlbHNl\nIGlmICghZmllbGQuaXNTZXJpYWxpemVkKCkpIHsKICAgICAgICAgICAgRmll\nbGRTdHJhdGVneSBzdHJhdCA9IGRlZmF1bHRUeXBlU3RyYXRlZ3koZmllbGQs\nIGluc3RhbGxIYW5kbGVycywKICAgICAgICAgICAgICAgIGFkYXB0aW5nKTsK\nICAgICAgICAgICAgaWYgKHN0cmF0ICE9IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gc3RyYXQ7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBm\nb3IgZGVmYXVsdCBoYW5kbGVyCiAgICAgICAgaGFuZGxlciA9IGRlZmF1bHRI\nYW5kbGVyKGZpZWxkLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKGhhbmRsZXIg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoaW5zdGFsbEhhbmRsZXJzKQog\nICAgICAgICAgICAgICAgZmllbGQuc2V0SGFuZGxlcihoYW5kbGVyKTsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGVyRmllbGRTdHJhdGVneSgpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZGVmYXVsdCB0byBibG9iCiAgICAgICAg\naWYgKGluc3RhbGxIYW5kbGVycykgewogICAgICAgICAgICBpZiAoZ2V0TG9n\nKCkuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgZ2V0TG9nKCku\nd2FybihfbG9jLmdldCgibm8tZmllbGQtc3RyYXRlZ3kiLCBmaWVsZCkpOwog\nICAgICAgICAgICBmaWVsZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAg\nIH0KICAgICAgICBpZiAoX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6ZSA9PSAt\nMSkgewogICAgICAgICAgICBpZiAoaW5zdGFsbEhhbmRsZXJzKQogICAgICAg\nICAgICAgICAgZmllbGQuc2V0SGFuZGxlcihCbG9iVmFsdWVIYW5kbGVyLmdl\ndEluc3RhbmNlKCkpOwogICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJG\naWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcg\nTWF4RW1iZWRkZWRCbG9iRmllbGRTdHJhdGVneSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBidWlsdC1pbiBzdHJhdGVneSBmb3IgdGhl\nIGZpZWxkJ3MgdHlwZSwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgRmllbGRTdHJhdGVneSBkZWZhdWx0VHlwZVN0cmF0ZWd5KEZp\nZWxkTWFwcGluZyBmaWVsZCwKICAgICAgICBib29sZWFuIGluc3RhbGxIYW5k\nbGVycywgYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIHN3aXRjaCAoZmll\nbGQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBQcmltaXRpdmVGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIGlmICghaXNDbG9i\nKGZpZWxkLCBmYWxzZSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBTdHJpbmdGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgICAgICBpZiAo\nX2RpY3QubWF4RW1iZWRkZWRDbG9iU2l6ZSAhPSAtMSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IE1heEVtYmVkZGVkQ2xvYkZpZWxkU3RyYXRl\nZ3koKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGlmIChmaWVsZC5pc0Vt\nYmVkZGVkUEMoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVt\nYmVkRmllbGRTdHJhdGVneSgpOwogICAgICAgICAgICAgICAgaWYgKGZpZWxk\nLmdldFR5cGVNYXBwaW5nKCkuaXNNYXBwZWQoKQogICAgICAgICAgICAgICAg\nICAgIHx8ICF1c2VVbnR5cGVkUENIYW5kbGVyKGZpZWxkKSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IFJlbGF0aW9uRmllbGRTdHJhdGVneSgp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBm\naWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgICAgICAgICAgVmFs\ndWVIYW5kbGVyIGVoYW5kbGVyID0gbmFtZWRIYW5kbGVyKGVsZW0pOwogICAg\nICAgICAgICAgICAgaWYgKGVoYW5kbGVyID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgZWhhbmRsZXIgPSBkZWZhdWx0SGFuZGxlcihlbGVtKTsKICAg\nICAgICAgICAgICAgIGlmIChlaGFuZGxlciAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBoYW5kbGVyQ29sbGVjdGlvblN0cmF0ZWd5KGZp\nZWxkLCBlaGFuZGxlciwgCiAgICAgICAgICAgICAgICAgICAgICAgIGluc3Rh\nbGxIYW5kbGVycyk7CiAgICAgICAgICAgICAgICBpZiAoZWxlbS5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQwogICAgICAgICAgICAgICAgICAgICYm\nICFlbGVtLmlzU2VyaWFsaXplZCgpICYmICFlbGVtLmlzRW1iZWRkZWRQQygp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUludmVyc2VLZXlNYXBw\naW5nKGZpZWxkKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBSZWxhdGlvbkNvbGxlY3Rpb25JbnZlcnNlS2V5RmllbGRTdHJhdGVneSgp\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25Db2xs\nZWN0aW9uVGFibGVGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgVmFsdWVNYXBwaW5nIGtleSA9\nIGZpZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIFZhbHVl\nSGFuZGxlciBraGFuZGxlciA9IG5hbWVkSGFuZGxlcihrZXkpOwogICAgICAg\nICAgICAgICAgaWYgKGtoYW5kbGVyID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAga2hhbmRsZXIgPSBkZWZhdWx0SGFuZGxlcihrZXkpOwogICAgICAg\nICAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxkLmdldEVsZW1lbnRN\nYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBWYWx1ZUhhbmRsZXIgdmhhbmRs\nZXIgPSBuYW1lZEhhbmRsZXIodmFsKTsKICAgICAgICAgICAgICAgIGlmICh2\naGFuZGxlciA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHZoYW5kbGVy\nID0gZGVmYXVsdEhhbmRsZXIodmFsKTsKICAgICAgICAgICAgICAgIGJvb2xl\nYW4ga3JlbCA9IGtoYW5kbGVyID09IG51bGwgCiAgICAgICAgICAgICAgICAg\nICAgJiYga2V5LmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDCiAgICAg\nICAgICAgICAgICAgICAgJiYgIWtleS5pc1NlcmlhbGl6ZWQoKSAmJiAha2V5\nLmlzRW1iZWRkZWRQQygpOwogICAgICAgICAgICAgICAgYm9vbGVhbiB2cmVs\nID0gdmhhbmRsZXIgPT0gbnVsbCAKICAgICAgICAgICAgICAgICAgICAmJiB2\nYWwuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMKICAgICAgICAgICAg\nICAgICAgICAmJiAhdmFsLmlzU2VyaWFsaXplZCgpICYmICF2YWwuaXNFbWJl\nZGRlZFBDKCk7CiAgICAgICAgICAgICAgICBpZiAodnJlbCAmJiBrZXkuZ2V0\nVmFsdWVNYXBwZWRCeSgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAodXNlSW52ZXJzZUtleU1hcHBpbmcoZmllbGQpKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlbGF0aW9uTWFwSW52ZXJzZUtl\neUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFJlbGF0aW9uTWFwVGFibGVGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAvL1RPRE86IGluIEpQQSAyLjAg\naWYgTWFwS2V5Q2xhc3MgdHlwZSBpcyBub3Qgc3BlY2lmaWVkCiAgICAgICAg\nICAgICAgICAvLyBhbiBleGNlcHRpb24gaXMgdGhyb3duLiBJbiBPcGVuSnBh\nIDEueCwgdGhlIG1hcCB3aWxsCiAgICAgICAgICAgICAgICAvLyBiZSBzZXJp\nYWxpemVkIHRvIGEgYmxvYiAodGhlIG51bGwgdmFsdWUgcmV0dXJuZWQgYnkK\nICAgICAgICAgICAgICAgIC8vIHRoaXMgbWV0aG9kIHdpbGwgbGVhZCB0byBh\nIHN0cmF0ZWd5IHRvIHNlcmlhbGl6ZQogICAgICAgICAgICAgICAgLy8gdGhl\nIG1hcCkuCiAgICAgICAgICAgICAgICBpZiAoIWtyZWwgJiYga2hhbmRsZXIg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGlmICghdnJlbCAmJiB2aGFuZGxlciA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgcmV0dXJuIGhh\nbmRsZXJNYXBTdHJhdGVneShmaWVsZCwga2hhbmRsZXIsIHZoYW5kbGVyLCBr\ncmVsLAogICAgICAgICAgICAgICAgICAgIHZyZWwsIGluc3RhbGxIYW5kbGVy\ncyk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOUFVUX1NUUkVBTToK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5QVVRfUkVBREVSOgogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBMb2JGaWVsZFN0cmF0ZWd5KCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjb2xsZWN0aW9uIHN0cmF0ZWd5IGZvciB0aGUg\nZ2l2ZW4gZWxlbWVudCBoYW5kbGVyLCBvciBudWxsCiAgICAgKiBpZiBub25l\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmllbGRTdHJhdGVneSBoYW5kbGVy\nQ29sbGVjdGlvblN0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVsZCwgCiAgICAg\nICAgVmFsdWVIYW5kbGVyIGVoYW5kbGVyLCBib29sZWFuIGluc3RhbGxIYW5k\nbGVycykgewogICAgICAgIC8vIFRPRE86IEpQQSAyLjAgc2hvdWxkIGlnbm9y\nZSB0aGlzIGZsYWcgYW5kIG5vdCB0byBzZXJpYWxpemUKICAgICAgICBpZiAo\nZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgp\nCiAgICAgICAgICAgIC5nZXRTdG9yZU1hcENvbGxlY3Rpb25JbkVudGl0eUFz\nQmxvYigpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\naW5zdGFsbEhhbmRsZXJzKQogICAgICAgICAgICBmaWVsZC5nZXRFbGVtZW50\nTWFwcGluZygpLnNldEhhbmRsZXIoZWhhbmRsZXIpOwogICAgICAgIHJldHVy\nbiBuZXcgSGFuZGxlckNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3koKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWFwIHN0cmF0ZWd5\nIGZvciB0aGUgZ2l2ZW4ga2V5IGFuZCB2YWx1ZSBoYW5kbGVycyAvIHJlbGF0\naW9ucywKICAgICAqIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIEZpZWxkU3RyYXRlZ3kgaGFuZGxlck1hcFN0cmF0ZWd5KEZpZWxk\nTWFwcGluZyBmaWVsZCwgCiAgICAgICAgVmFsdWVIYW5kbGVyIGtoYW5kbGVy\nLCBWYWx1ZUhhbmRsZXIgdmhhbmRsZXIsIGJvb2xlYW4ga3JlbCwgCiAgICAg\nICAgYm9vbGVhbiB2cmVsLCAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsK\nICAgICAgICAvLyBUT0RPOiBKUEEgMi4wIHNob3VsZCBpZ25vcmUgdGhpcyBm\nbGFnIGFuZCBub3QgdG8gc2VyaWFsaXplCiAgICAgICAgaWYgKGdldENvbmZp\nZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKQogICAgICAg\nICAgICAuZ2V0U3RvcmVNYXBDb2xsZWN0aW9uSW5FbnRpdHlBc0Jsb2IoKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGluc3RhbGxI\nYW5kbGVycykgewogICAgICAgICAgICBmaWVsZC5nZXRLZXlNYXBwaW5nKCku\nc2V0SGFuZGxlcihraGFuZGxlcik7CiAgICAgICAgICAgIGZpZWxkLmdldEVs\nZW1lbnRNYXBwaW5nKCkuc2V0SGFuZGxlcih2aGFuZGxlcik7CiAgICAgICAg\nfQogICAgICAgIGlmICgha3JlbCAmJiAhdnJlbCkKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBIYW5kbGVySGFuZGxlck1hcFRhYmxlRmllbGRTdHJhdGVneSgp\nOwogICAgICAgIGlmICgha3JlbCAmJiB2cmVsKQogICAgICAgICAgICByZXR1\ncm4gbmV3IEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmllbGRTdHJhdGVneSgp\nOwogICAgICAgIGlmIChrcmVsICYmICF2cmVsKQogICAgICAgICAgICByZXR1\ncm4gbmV3IFJlbGF0aW9uSGFuZGxlck1hcFRhYmxlRmllbGRTdHJhdGVneSgp\nOwogICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25SZWxhdGlvbk1hcFRhYmxl\nRmllbGRTdHJhdGVneSgpOwogICAgfQoKICAgIC8qKgogICAgICogVXNlIGhp\nbnRzIGluIG1hcHBpbmcgZGF0YSB0byBmaWd1cmUgb3V0IHdoZXRoZXIgdGhl\nIGdpdmVuIHJlbGF0aW9uCiAgICAgKiBmaWVsZCBzaG91bGQgdXNlIGFuIGlu\ndmVyc2UgZm9yZWlnbiBrZXkgb3IgYW4gYXNzb2NpYXRpb24gdGFibGUgbWFw\ncGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHVzZUludmVyc2VL\nZXlNYXBwaW5nKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAgIEZpZWxk\nTWFwcGluZyBtYXBwZWQgPSBmaWVsZC5nZXRNYXBwZWRCeU1hcHBpbmcoKTsK\nICAgICAgICBpZiAobWFwcGVkICE9IG51bGwpIHsKICAgICAgICAgICAgLy9i\naS0vTS0xL0pvaW5UYWJsZSA9PT4gam9pbiB0YWJsZSBzdHJhdGVneQogICAg\nICAgICAgICBpZiAoaXNCaU1UbzFKVChmaWVsZCkpIAogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAobWFwcGVkLmdldFR5\ncGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIGlmIChtYXBwZWQuZ2V0RWxlbWVudCgp\nLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tYXBwZWQtYnkiLCBmaWVsZCwK\nICAgICAgICAgICAgICAgIG1hcHBlZCkpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gd2l0aG91dCBhIG1hcHBlZC1ieSwgd2UgaGF2ZSB0byBsb29rIGZvciBj\nbHVlcyBhcyB0byB0aGUgbWFwcGluZy4KICAgICAgICAvLyB3ZSBhc3N1bWUg\ndGhhdCBhbnl0aGluZyB3aXRoIGVsZW1lbnQgZm9yZWlnbiBrZXkgY29sdW1u\ncyBidXQgbm8gam9pbgogICAgICAgIC8vIGNvbHVtbnMgb3IgdGFibGUgdXNl\ncyBhbiBpbnZlcnNlIGZvcmVpZ24ga2V5LCBhbmQgYW55dGhpbmcgZWxzZSB1\nc2VzCiAgICAgICAgLy8gYW4gYXNzb2NpYXRpb24gdGFibGUKICAgICAgICBG\naWVsZE1hcHBpbmdJbmZvIGluZm8gPSBmaWVsZC5nZXRNYXBwaW5nSW5mbygp\nOwogICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKTsKICAgICAgICBib29sZWFuIHVzZUludmVyc2VLZXlNYXBw\naW5nID0gaW5mby5nZXRUYWJsZU5hbWUoKSA9PSBudWxsICYmIGluZm8uZ2V0\nQ29sdW1ucygpLmlzRW1wdHkoKQogICAgICAgICAgICAmJiAhZWxlbS5nZXRW\nYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCkuaXNFbXB0eSgpOwogICAgICAgIAog\nICAgICAgIC8vIEpQQSAyLjA6IG5vbi1kZWZhdWx0IG1hcHBpbmc6IHVuaS0v\nMS1NL0pvaW5Db2x1bW4gPT0+IGZvcmVpZ24ga2V5IHN0cmF0ZWd5CiAgICAg\nICAgaWYgKGlzVW5pMVRvTUZLKGZpZWxkKSkgewogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVzZUludmVyc2VL\nZXlNYXBwaW5nOwogICAgfQogICAgICAgIAogICAgcHVibGljIGJvb2xlYW4g\naXNOb25EZWZhdWx0TWFwcGluZ0FsbG93ZWQoKSB7CiAgICAgICAgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiA9IGdldENvbmZpZ3VyYXRpb24oKTsKICAg\nICAgICByZXR1cm4gZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMo\nKS5pc05vbkRlZmF1bHRNYXBwaW5nQWxsb3dlZChjb25mKTsKICAgIH0KICAg\nIAogICAgcHVibGljIGJvb2xlYW4gaXNVbmlNVG8xSlQoRmllbGRNYXBwaW5n\nIGZpZWxkKSB7CiAgICAgICAgaWYgKGlzTm9uRGVmYXVsdE1hcHBpbmdBbGxv\nd2VkKCkgJiYgCiAgICAgICAgICAgIGZpZWxkLmdldEFzc29jaWF0aW9uVHlw\nZSgpID09IEZpZWxkTWV0YURhdGEuTUFOWV9UT19PTkUgJiYKICAgICAgICAg\nICAgaGFzSm9pblRhYmxlKGZpZWxkKSAmJiAKICAgICAgICAgICAgIWlzQmlk\naXJlY3Rpb25hbChmaWVsZCkpICB7CiAgICAgICAgICAgIGZpZWxkLmdldFZh\nbHVlTWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5z\nKCkpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nVW5pMVRvMUpUKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAgIGlmIChp\nc05vbkRlZmF1bHRNYXBwaW5nQWxsb3dlZCgpICYmIAogICAgICAgICAgICBm\naWVsZC5nZXRBc3NvY2lhdGlvblR5cGUoKSA9PSBGaWVsZE1ldGFEYXRhLk9O\nRV9UT19PTkUgJiYgCiAgICAgICAgICAgIGhhc0pvaW5UYWJsZShmaWVsZCkg\nJiYgCiAgICAgICAgICAgICFpc0JpZGlyZWN0aW9uYWwoZmllbGQpKSB7CiAg\nICAgICAgICAgIGZpZWxkLmdldFZhbHVlTWFwcGluZygpLmdldFZhbHVlSW5m\nbygpLnNldENvbHVtbnMoZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRW\nYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCkpOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzQmkxVG8xSlQoRmllbGRNYXBwaW5nIGZp\nZWxkKSB7CiAgICAgICAgaWYgKGlzTm9uRGVmYXVsdE1hcHBpbmdBbGxvd2Vk\nKCkgJiYgCiAgICAgICAgICAgIGZpZWxkLmdldEFzc29jaWF0aW9uVHlwZSgp\nID09IEZpZWxkTWV0YURhdGEuT05FX1RPX09ORSAmJiAKICAgICAgICAgICAg\naGFzSm9pblRhYmxlKGZpZWxkKSAmJiAKICAgICAgICAgICAgaXNCaWRpcmVj\ndGlvbmFsKGZpZWxkKSkgewogICAgICAgICAgICBmaWVsZC5nZXRWYWx1ZU1h\ncHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5zZXRDb2x1bW5zKGZpZWxkLmdldEVs\nZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gaXNV\nbmkxVG9NRksoRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGlz\nTm9uRGVmYXVsdE1hcHBpbmdBbGxvd2VkKCkgJiYgCiAgICAgICAgICAgIGZp\nZWxkLmdldEFzc29jaWF0aW9uVHlwZSgpID09IEZpZWxkTWV0YURhdGEuT05F\nX1RPX01BTlkgJiYKICAgICAgICAgICAgaGFzSm9pbkNvbHVtbihmaWVsZCkg\nJiYKICAgICAgICAgICAgIWlzQmlkaXJlY3Rpb25hbChmaWVsZCkpIHsKICAg\nICAgICAgICAgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUlu\nZm8oKS5zZXRDb2x1bW5zKGZpZWxkLmdldFZhbHVlSW5mbygpLmdldENvbHVt\nbnMoKSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBib29s\nZWFuIGlzQmlNVG8xSlQoRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAg\nRmllbGRNYXBwaW5nIG1hcHBlZCA9IGZpZWxkLmdldE1hcHBlZEJ5TWFwcGlu\nZygpOwogICAgICAgIGlmIChpc05vbkRlZmF1bHRNYXBwaW5nQWxsb3dlZCgp\nKSB7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRBc3NvY2lhdGlvblR5cGUo\nKSA9PSBGaWVsZE1ldGFEYXRhLk9ORV9UT19NQU5ZICkgewogICAgICAgICAg\nICAgICAgaWYgKG1hcHBlZCAhPSBudWxsICYmIGhhc0pvaW5UYWJsZShtYXBw\nZWQpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKGZpZWxkLmdldEFzc29jaWF0aW9uVHlwZSgpID09\nIEZpZWxkTWV0YURhdGEuTUFOWV9UT19PTkUpIHsKICAgICAgICAgICAgICAg\nIGlmIChnZXRCaV8xVG9NX0pvaW5UYWJsZUZpZWxkKGZpZWxkKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvLyByZXR1cm4gdGhlIGludmVyc2UgZmllbGQgb2YgYmlkaXJlY3Rpb25h\nbCBtYW55IHRvIG9uZQogICAgLy8gcmVsYXRpb24gdXNpbmcgam9pbiB0YWJs\nZSBzdHJhdGVneQogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXRCaV8xVG9N\nX0pvaW5UYWJsZUZpZWxkKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAg\nIGlmIChpc05vbkRlZmF1bHRNYXBwaW5nQWxsb3dlZCgpKSB7CiAgICAgICAg\nICAgIGlmIChmaWVsZC5nZXRBc3NvY2lhdGlvblR5cGUoKSA9PSBGaWVsZE1l\ndGFEYXRhLk9ORV9UT19NQU5ZKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1h\ncHBpbmcgbWFwcGVkQnkgPSBmaWVsZC5nZXRNYXBwZWRCeU1hcHBpbmcoKTsK\nICAgICAgICAgICAgICAgIGlmIChtYXBwZWRCeSAhPSBudWxsICYmIGhhc0pv\naW5UYWJsZShtYXBwZWRCeSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGZpZWxkOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLmdldEFzc29j\naWF0aW9uVHlwZSgpID09IEZpZWxkTWV0YURhdGEuTUFOWV9UT19PTkUpIHsK\nICAgICAgICAgICAgICAgIGlmICghaGFzSm9pblRhYmxlKGZpZWxkKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAg\nIENsYXNzTWFwcGluZyBpbnZlcnNlID0gZmllbGQuZ2V0VmFsdWVNYXBwaW5n\nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWFw\ncGluZ1tdIGZtZHMgPSBpbnZlcnNlLmdldEZpZWxkTWFwcGluZ3MoKTsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZCA9PSBmbWRz\nW2ldLmdldE1hcHBlZEJ5TWFwcGluZygpKSAKICAgICAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZtZHNbaV07CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLy8gcmV0dXJuIHRoZSBvd25pbmcgZmllbGQgb2YgYmlkaXJlY3Rp\nb25hbCBvbmUgdG8gbWFueQogICAgLy8gcmVsYXRpb24gdXNpbmcgam9pbiB0\nYWJsZSBzdHJhdGVneQogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXRCaV9N\nVG8xX0pvaW5UYWJsZUZpZWxkKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAg\nICAgIGlmIChpc05vbkRlZmF1bHRNYXBwaW5nQWxsb3dlZCgpKSB7CiAgICAg\nICAgICAgIGlmIChmaWVsZC5nZXRBc3NvY2lhdGlvblR5cGUoKSA9PSBGaWVs\nZE1ldGFEYXRhLk1BTllfVE9fT05FKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIWhhc0pvaW5UYWJsZShmaWVsZCkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgICAgICBpZiAoaXNCaWRpcmVjdGlvbmFs\nKGZpZWxkKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQ7CiAg\nICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLmdldEFzc29jaWF0aW9uVHlw\nZSgpID09IEZpZWxkTWV0YURhdGEuT05FX1RPX01BTlkpIHsKICAgICAgICAg\nICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWRCeSA9IGZpZWxkLmdldE1hcHBl\nZEJ5TWFwcGluZygpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5ICE9\nIG51bGwgJiYgaGFzSm9pblRhYmxlKG1hcHBlZEJ5KSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbWFwcGVkQnk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBib29sZWFuIGhhc0pvaW5Db2x1bW4oRmllbGRNYXBwaW5nIGZpZWxkKSB7\nCiAgICAgICAgYm9vbGVhbiBoYXNKb2luQ29sdW1uID0gKGZpZWxkLmdldFZh\nbHVlSW5mbygpLmdldENvbHVtbnMoKS5zaXplKCkgPiAwID8gdHJ1ZSA6IGZh\nbHNlKTsKICAgICAgICByZXR1cm4gaGFzSm9pbkNvbHVtbjsKICAgIH0KICAg\nIAogICAgcHVibGljIGJvb2xlYW4gaGFzSm9pblRhYmxlKEZpZWxkTWFwcGlu\nZyBmaWVsZCkgewogICAgICAgIGJvb2xlYW4gaGFzSm9pblRhYmxlID0gZmll\nbGQuZ2V0TWFwcGluZ0luZm8oKS5nZXRUYWJsZU5hbWUoKSAhPSBudWxsID8g\ndHJ1ZSA6IGZhbHNlOwogICAgICAgIHJldHVybiBoYXNKb2luVGFibGU7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNCaWRpcmVjdGlvbmFsKEZpZWxk\nTWFwcGluZyBmaWVsZCkgewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRC\neU1hcHBpbmcoKSAhPSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpbnQg\nYXNzb1R5cGUgPSBmaWVsZC5nZXRBc3NvY2lhdGlvblR5cGUoKTsKICAgICAg\nICBpZiAoYXNzb1R5cGUgPT0gRmllbGRNZXRhRGF0YS5PTkVfVE9fT05FIHx8\nIAogICAgICAgICAgICBhc3NvVHlwZSA9PSBGaWVsZE1ldGFEYXRhLk1BTllf\nVE9fT05FKSB7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyBpbnZlcnNlID0g\nZmllbGQuZ2V0VmFsdWVNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAg\nICAgICAgICAgRmllbGRNYXBwaW5nW10gZm1kcyA9IGludmVyc2UuZ2V0Rmll\nbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmaWVs\nZCA9PSBmbWRzW2ldLmdldE1hcHBlZEJ5TWFwcGluZygpKSAKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogQ2hlY2sgdGhlIGdpdmVuIHZhbHVlIGFnYWluc3QgbWFwcGVkIHN0\ncmF0ZWdpZXMuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IG1hcHBlZFN0\ncmF0ZWd5KFZhbHVlTWFwcGluZyB2YWwsIENsYXNzIHR5cGUsCiAgICAgICAg\nYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIGlmICh0eXBlID09IG51bGwg\nfHwgdHlwZSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVsdHMuZ2V0U3Ry\nYXRlZ3kodmFsLCB0eXBlLCBhZGFwdGluZyk7CgogICAgICAgIC8vIHJlY3Vy\nc2Ugb24gc3VwZXJjbGFzcyBzbyB0aGF0LCBmb3IgZXhhbXBsZSwgYSByZWdp\nc3RlcmVkIGhhbmRsZXIKICAgICAgICAvLyBmb3IgamF2YS5sYW5nLkVudW0g\nd2lsbCB3b3JrIG9uIGFsbCBlbnVtcwogICAgICAgIGlmIChzdHJhdCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbWFwcGVkU3RyYXRlZ3kodmFsLCB0\neXBlLmdldFN1cGVyY2xhc3MoKSwgYWRhcHRpbmcpOwogICAgICAgIGlmICgh\nKHN0cmF0IGluc3RhbmNlb2YgU3RyaW5nKSkKICAgICAgICAgICAgcmV0dXJu\nIHN0cmF0OwoKICAgICAgICBTdHJpbmcgbmFtZSA9IChTdHJpbmcpIHN0cmF0\nOwogICAgICAgIGlmIChOb25lRmllbGRTdHJhdGVneS5BTElBUy5lcXVhbHMo\nbmFtZSkpCiAgICAgICAgICAgIHJldHVybiBOb25lRmllbGRTdHJhdGVneS5n\nZXRJbnN0YW5jZSgpOwoKICAgICAgICBTdHJpbmcgcHJvcHMgPSBDb25maWd1\ncmF0aW9ucy5nZXRQcm9wZXJ0aWVzKG5hbWUpOwogICAgICAgIG5hbWUgPSBD\nb25maWd1cmF0aW9ucy5nZXRDbGFzc05hbWUobmFtZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgQ2xhc3MgYyA9IEphdmFUeXBlcy5jbGFzc0Zvck5h\nbWUobmFtZSwgdmFsLAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oRmllbGRTdHJhdGVneS5jbGFz\ncykpKTsKICAgICAgICAgICAgT2JqZWN0IG8gPSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLm5ld0luc3RhbmNlQWN0aW9uKGMpKTsKICAgICAgICAgICAgQ29uZmlndXJh\ndGlvbnMuY29uZmlndXJlSW5zdGFuY2UobywgZ2V0Q29uZmlndXJhdGlvbigp\nLCBwcm9wcyk7CiAgICAgICAgICAgIHJldHVybiBvOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNl\nb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAg\nIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2Vw\ndGlvbigpOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC1tYXBwZWQtc3RyYXRlZ3kiLAogICAgICAgICAg\nICAgICAgdmFsLCBuYW1lKSwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIHZhbHVlJ3MgbmFtZWQg\naGFuZGxlciwgb3IgcmV0dXJuIG51bGwgaWYgbm8KICAgICAqIG5hbWVkIGhh\nbmRsZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZUhhbmRsZXIgbmFt\nZWRIYW5kbGVyKFZhbHVlTWFwcGluZyB2YWwpIHsKICAgICAgICBTdHJpbmcg\nbmFtZSA9IHZhbC5nZXRWYWx1ZUluZm8oKS5nZXRTdHJhdGVneSgpOwogICAg\nICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBTdHJpbmcgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5nZXRQ\ncm9wZXJ0aWVzKG5hbWUpOwogICAgICAgIG5hbWUgPSBDb25maWd1cmF0aW9u\ncy5nZXRDbGFzc05hbWUobmFtZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgQ2xhc3MgYyA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUobmFtZSwgdmFs\nLAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xh\nc3NMb2FkZXJBY3Rpb24oVmFsdWVIYW5kbGVyLmNsYXNzKSkpOwogICAgICAg\nICAgICBpZiAoVmFsdWVIYW5kbGVyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20o\nYykpIHsKICAgICAgICAgICAgICAgIFZhbHVlSGFuZGxlciB2aCA9IChWYWx1\nZUhhbmRsZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0\naW9uKGMpKTsKICAgICAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZp\nZ3VyZUluc3RhbmNlKHZoLCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAg\nICAgICAgICAgICAgcHJvcHMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHZo\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOyAvLyBu\nYW1lZCBmaWVsZCBzdHJhdGVneQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdl\nZEFjdGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZp\nbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC12YWx1ZS1oYW5kbGVyIiwKICAgICAgICAgICAgICAgIHZhbCwgbmFt\nZSksIGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERldGVy\nbWluZSB0aGUgZGVmYXVsdCBoYW5kbGVyIHRvIHVzZSBmb3IgdGhlIGdpdmVu\nIHZhbHVlLiBEb2VzCiAgICAgKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhl\nIG5hbWVkIGhhbmRsZXIsIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFZhbHVlSGFuZGxlciBkZWZhdWx0SGFuZGxlcihWYWx1ZU1hcHBpbmcgdmFs\nKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRIYW5kbGVyKHZhbCwgZ2V0U3Ry\nYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IGhhbmRsZXIgdG8gdXNl\nIGZvciB0aGUgZ2l2ZW4gdmFsdWUuIERvZXMKICAgICAqIG5vdCB0YWtlIGlu\ndG8gYWNjb3VudCB0aGUgbmFtZWQgaGFuZGxlciwgaWYgYW55LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgVmFsdWVIYW5kbGVyIGRlZmF1bHRIYW5kbGVyKFZh\nbHVlTWFwcGluZyB2YWwsIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBp\nZiAodmFsLmlzU2VyaWFsaXplZCgpKSB7CiAgICAgICAgICAgIGlmIChfZGlj\ndC5tYXhFbWJlZGRlZEJsb2JTaXplICE9IC0xKQogICAgICAgICAgICAgICAg\nd2Fybk1heEVtYmVkZGVkKHZhbCwgX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6\nZSk7CiAgICAgICAgICAgIHJldHVybiBCbG9iVmFsdWVIYW5kbGVyLmdldElu\nc3RhbmNlKCk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QgaGFuZGxlciA9\nIG1hcHBlZFN0cmF0ZWd5KHZhbCwgdmFsLmdldFR5cGUoKSwgYWRhcHRpbmcp\nOwogICAgICAgIGlmIChoYW5kbGVyIGluc3RhbmNlb2YgVmFsdWVIYW5kbGVy\nKQogICAgICAgICAgICByZXR1cm4gKFZhbHVlSGFuZGxlcikgaGFuZGxlcjsK\nCiAgICAgICAgaWYgKHZhbC5nZXRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzIAog\nICAgICAgICAgICB8fCB2YWwuZ2V0VHlwZSgpID09IEJ5dGVbXS5jbGFzcykg\newogICAgICAgICAgICBpZiAoX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6ZSAh\nPSAtMSkKICAgICAgICAgICAgICAgIHdhcm5NYXhFbWJlZGRlZCh2YWwsIF9k\naWN0Lm1heEVtYmVkZGVkQmxvYlNpemUpOwogICAgICAgICAgICByZXR1cm4g\nQnl0ZUFycmF5VmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAg\nfQogICAgICAgIGlmICh2YWwuZ2V0VHlwZSgpID09IGNoYXJbXS5jbGFzcwog\nICAgICAgICAgICB8fCB2YWwuZ2V0VHlwZSgpID09IENoYXJhY3RlcltdLmNs\nYXNzKSB7CiAgICAgICAgICAgIGlmIChpc0Nsb2IodmFsLCB0cnVlKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBDaGFyQXJyYXlTdHJlYW1WYWx1ZUhhbmRs\nZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmV0dXJuIENoYXJBcnJh\neVZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgpOwogICAgICAgIH0KCiAgICAg\nICAgc3dpdGNoICh2YWwuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNIQVJfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVf\nT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJJR0lOVEVHRVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RF\nQ0lNQUw6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPQ0FMRToKICAgICAgICAgICAgICAgIHJldHVybiBJbW11dGFibGVW\nYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgaWYgKGlzQ2xvYih2\nYWwsIHRydWUpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDbG9iVmFs\ndWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gSW1tdXRhYmxlVmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgaWYg\nKCF2YWwuZ2V0VHlwZU1hcHBpbmcoKS5pc01hcHBlZCgpCiAgICAgICAgICAg\nICAgICAgICAgJiYgdXNlVW50eXBlZFBDSGFuZGxlcih2YWwpKSAKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gVW50eXBlZFBDVmFsdWVIYW5kbGVyLmdl\ndEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAg\nIHJldHVybiBVbnR5cGVkUENWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBPYmplY3RJZFZhbHVlSGFuZGxlcigpOwogICAgICAg\nIH0KICAgICAgICBpZiAoIWdldENvbmZpZ3VyYXRpb24oKS5nZXRDb21wYXRp\nYmlsaXR5SW5zdGFuY2UoKQogICAgICAgICAgICAuZ2V0U3RvcmVNYXBDb2xs\nZWN0aW9uSW5FbnRpdHlBc0Jsb2IoKQogICAgICAgICAgICAmJiB2YWwuaXNF\nbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIHJldHVybiBuZXcgRWxlbWVudEVt\nYmVkVmFsdWVIYW5kbGVyKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBzaG91bGQgdXNl\nIHRoZSBnZW5lcmljIHVudHlwZWQgUEMgaGFuZGxlciBmb3IgdGhlCiAgICAg\nKiBnaXZlbiB1bm1hcHBlZCByZWxhdGlvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHVzZVVudHlwZWRQQ0hhbmRsZXIoVmFsdWVNYXBwaW5nIHZh\nbCkgewogICAgICAgIENsYXNzTWFwcGluZyByZWwgPSB2YWwuZ2V0VHlwZU1h\ncHBpbmcoKTsKICAgICAgICByZXR1cm4gcmVsLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWFwcGluZy5JRF9VTktOT1dOCiAgICAgICAgICAgIHx8IChy\nZWwuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0FQUExJ\nQ0FUSU9OCiAgICAgICAgICAgICYmIChyZWwuZ2V0UHJpbWFyeUtleUZpZWxk\ncygpLmxlbmd0aCA9PSAwCiAgICAgICAgICAgIHx8ICghcmVsLmlzT3BlbkpQ\nQUlkZW50aXR5KCkgJiYgTW9kaWZpZXIuaXNBYnN0cmFjdAogICAgICAgICAg\nICAocmVsLmdldE9iamVjdElkVHlwZSgpLmdldE1vZGlmaWVycygpKSkpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrcyBmb3IgaGludHMgYXMgdG8g\nd2hldGhlciB0aGUgZ2l2ZW4gY29sdW1uIGlzIGEgQ0xPQi4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGlzQ2xvYihWYWx1ZU1hcHBpbmcgdmFsLCBi\nb29sZWFuIHdhcm4pIHsKICAgICAgICBMaXN0IGNvbHMgPSB2YWwuZ2V0VmFs\ndWVJbmZvKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmIChjb2xzLnNpemUo\nKSAhPSAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIENv\nbHVtbiBjb2wgPSAoQ29sdW1uKSBjb2xzLmdldCgwKTsKICAgICAgICBpZiAo\nY29sLmdldFNpemUoKSAhPSAtMSAmJiBjb2wuZ2V0VHlwZSgpICE9IFR5cGVz\nLkNMT0IpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYg\nKF9kaWN0LmdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0xPQikgIT0gVHlwZXMu\nQ0xPQikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAo\nd2FybiAmJiBfZGljdC5tYXhFbWJlZGRlZENsb2JTaXplICE9IC0xKQogICAg\nICAgICAgICB3YXJuTWF4RW1iZWRkZWQodmFsLCBfZGljdC5tYXhFbWJlZGRl\nZENsb2JTaXplKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdhcm4gdGhhdCB0aGUgZ2l2ZW4gdmFsdWUgaXMgYmVpbmcg\nbWFwcGVkIHRvIGEgaGFuZGxlciB0aGF0IHdpbGwgbm90CiAgICAgKiBiZSBh\nYmxlIHRvIHN0b3JlIGxhcmdlIGxvYnMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB3YXJuTWF4RW1iZWRkZWQoVmFsdWVNYXBwaW5nIHZhbCwgaW50IHNp\nemUpIHsKICAgICAgICBpZiAoZ2V0TG9nKCkuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICBnZXRMb2coKS53YXJuKF9sb2MuZ2V0KCJtYXgtZW1iZWQt\nbG9iIiwgdmFsLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2Yoc2l6\nZSkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVm\nYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiBkaXNjcmltaW5h\ndG9yLgogICAgICogRG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGN1\ncnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIERpc2NyaW1pbmF0b3JTdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koRGlzY3Jp\nbWluYXRvciBkaXNjcmltKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRTdHJh\ndGVneShkaXNjcmltLCBnZXRTdHJhdGVneUluc3RhbGxlcigpLmlzQWRhcHRp\nbmcoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRl\nZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gZGlzY3JpbWlu\nYXRvci4KICAgICAqIERvZXMgbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBj\ndXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBEaXNjcmltaW5hdG9yU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KERpc2Ny\naW1pbmF0b3IgZGlzY3JpbSwKICAgICAgICBib29sZWFuIGFkYXB0aW5nKSB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IGRpc2NyaW0uZ2V0Q2xhc3NN\nYXBwaW5nKCk7CiAgICAgICAgaWYgKGNscy5nZXRFbWJlZGRpbmdNZXRhRGF0\nYSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBOb25lRGlzY3JpbWlu\nYXRvclN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgaWYgKGNscy5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSA9PSBudWxsCiAgICAg\nICAgICAgICYmIChjbHMuZ2V0U3RyYXRlZ3koKSA9PSBOb25lQ2xhc3NTdHJh\ndGVneS5nZXRJbnN0YW5jZSgpCiAgICAgICAgICAgIHx8IE1vZGlmaWVyLmlz\nRmluYWwoZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKS5nZXREZXNjcmliZWRU\neXBlKCkuCiAgICAgICAgICAgIGdldE1vZGlmaWVycygpKSkpCiAgICAgICAg\nICAgIHJldHVybiBOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5LmdldEluc3Rh\nbmNlKCk7CgogICAgICAgIE9iamVjdCBzdHJhdCA9IF9kZWZhdWx0cy5nZXRT\ndHJhdGVneShkaXNjcmltLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKHN0cmF0\nIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICByZXR1cm4gaW5zdGFu\ndGlhdGVEaXNjcmltaW5hdG9yU3RyYXRlZ3koKFN0cmluZykgc3RyYXQsIGRp\nc2NyaW0pOwogICAgICAgIGlmIChzdHJhdCAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gKERpc2NyaW1pbmF0b3JTdHJhdGVneSkgc3RyYXQ7CgogICAg\nICAgIGlmIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdXBlcmNsYXNzRGlz\nY3JpbWluYXRvclN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKGRpc2NyaW0uZ2V0\nTWFwcGluZ0luZm8oKS5nZXRWYWx1ZSgpICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBuZXcgVmFsdWVNYXBEaXNjcmltaW5hdG9yU3RyYXRlZ3koKTsK\nICAgICAgICBpZiAoY2xzLmdldE1hcHBlZFBDU3VwZXJjbGFzc01hcHBpbmco\nKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gTm9uZURpc2NyaW1pbmF0\nb3JTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlmIChhZGFwdGlu\nZyB8fCBfZGVmYXVsdHMuZGVmYXVsdE1pc3NpbmdJbmZvKCkpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0cmF0ZWd5\nKCk7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSAoKEpEQkNDb25maWd1\ncmF0aW9uKSBnZXRDb25maWd1cmF0aW9uKCkpLgogICAgICAgICAgICBnZXRE\nQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAgIGlmIChkaWN0LmpvaW5T\neW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTCkKICAg\nICAgICAgICAgcmV0dXJuIE5vbmVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuZ2V0\nSW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gbmV3IFN1YmNsYXNzSm9pbkRp\nc2NyaW1pbmF0b3JTdHJhdGVneSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhl\nIGdpdmVuIHZlcnNpb24uCiAgICAgKiBEb2VzIG5vdCB0YWtlIGludG8gYWNj\nb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShW\nZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFN0cmF0\nZWd5KHZlcnNpb24sIGdldFN0cmF0ZWd5SW5zdGFsbGVyKCkuaXNBZGFwdGlu\nZygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVm\nYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiB2ZXJzaW9uLgog\nICAgICogRG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGN1cnJlbnQg\nc3RyYXRlZ3ksIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNp\nb25TdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koVmVyc2lvbiB2ZXJzaW9uLAog\nICAgICAgIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBDbGFzc01hcHBp\nbmcgY2xzID0gdmVyc2lvbi5nZXRDbGFzc01hcHBpbmcoKTsKICAgICAgICBp\nZiAoY2xzLmdldEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIE5vbmVWZXJzaW9uU3RyYXRlZ3kuZ2V0SW5zdGFuY2Uo\nKTsKICAgICAgICBpZiAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFw\ncGluZygpID09IG51bGwKICAgICAgICAgICAgJiYgY2xzLmdldFN0cmF0ZWd5\nKCkgPT0gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKSkKICAgICAg\nICAgICAgcmV0dXJuIE5vbmVWZXJzaW9uU3RyYXRlZ3kuZ2V0SW5zdGFuY2Uo\nKTsKCiAgICAgICAgT2JqZWN0IHN0cmF0ID0gX2RlZmF1bHRzLmdldFN0cmF0\nZWd5KHZlcnNpb24sIGFkYXB0aW5nKTsKICAgICAgICBpZiAoc3RyYXQgaW5z\ndGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgIHJldHVybiBpbnN0YW50aWF0\nZVZlcnNpb25TdHJhdGVneSgoU3RyaW5nKSBzdHJhdCwgdmVyc2lvbik7CiAg\nICAgICAgaWYgKHN0cmF0ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiAo\nVmVyc2lvblN0cmF0ZWd5KSBzdHJhdDsKCiAgICAgICAgaWYgKGNscy5nZXRK\nb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbmV3IFN1cGVyY2xhc3NWZXJzaW9uU3RyYXRlZ3koKTsK\nCiAgICAgICAgRmllbGRNYXBwaW5nIHZmaWVsZCA9IHZlcnNpb24uZ2V0Q2xh\nc3NNYXBwaW5nKCkuCiAgICAgICAgICAgIGdldFZlcnNpb25GaWVsZE1hcHBp\nbmcoKTsKICAgICAgICBpZiAodmZpZWxkICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBkZWZhdWx0U3RyYXRlZ3kodmVyc2lvbiwgdmZpZWxkKTsKICAg\nICAgICBpZiAoYWRhcHRpbmcgfHwgX2RlZmF1bHRzLmRlZmF1bHRNaXNzaW5n\nSW5mbygpKQogICAgICAgICAgICByZXR1cm4gbmV3IE51bWJlclZlcnNpb25T\ndHJhdGVneSgpOwogICAgICAgIHJldHVybiBOb25lVmVyc2lvblN0cmF0ZWd5\nLmdldEluc3RhbmNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGRlZmF1bHQgdmVyc2lvbiBzdHJhdGVneSwgZ2l2ZW4gYSB2ZXJzaW9u\nIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0ZWd5\nIGRlZmF1bHRTdHJhdGVneShWZXJzaW9uIHZlcnMsCiAgICAgICAgRmllbGRN\nYXBwaW5nIHZmaWVsZCkgewogICAgICAgIHN3aXRjaCAodmZpZWxkLmdldFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAg\nICAgICAgICByZXR1cm4gKEphdmFWZXJzaW9ucy5WRVJTSU9OID49IDUpIAog\nICAgICAgICAgICAgICAgICAgID8gbmV3IE5hbm9QcmVjaXNpb25UaW1lc3Rh\nbXBWZXJzaW9uU3RyYXRlZ3koKQogICAgICAgICAgICAgICAgICAgIDogbmV3\nIFRpbWVzdGFtcFZlcnNpb25TdHJhdGVneSgpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBOdW1iZXJWZXJzaW9uU3RyYXRlZ3koKTsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJ2ZXJzaW9uLXR5cGUtdW5zdXBwb3J0ZWQiLCB2\nZmllbGQsIHZmaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkpOwovLyAgICAgICAg\nICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJhdGVneS5nZXRJbnN0YW5j\nZSgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgZW5k\nQ29uZmlndXJhdGlvbigpIHsKICAgICAgICBzdXBlci5lbmRDb25maWd1cmF0\naW9uKCk7CgogICAgICAgIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSAoSkRC\nQ0NvbmZpZ3VyYXRpb24pIGdldENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBf\nZGljdCA9IGNvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAg\nICBpZiAoX2RlZmF1bHRzID09IG51bGwpCiAgICAgICAgICAgIF9kZWZhdWx0\ncyA9IGNvbmYuZ2V0TWFwcGluZ0RlZmF1bHRzSW5zdGFuY2UoKTsKICAgICAg\nICBpZiAoX3NjaGVtYSAhPSBudWxsICYmIF9zY2hlbWEgaW5zdGFuY2VvZiBD\nb25maWd1cmFibGUpIHsKICAgICAgICAgICAgKChDb25maWd1cmFibGUpIF9z\nY2hlbWEpLnNldENvbmZpZ3VyYXRpb24oY29uZik7CiAgICAgICAgICAgICgo\nQ29uZmlndXJhYmxlKSBfc2NoZW1hKS5zdGFydENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICAgICAgKChDb25maWd1cmFibGUpIF9zY2hlbWEpLmVuZENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICB9ICAgICAgICAgICAgCiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogRmluZHMgdGhlIGJhc2UgY2xhc3MgbWFwcGluZyBm\nb3IgdGhlIHNwZWNpZmllZCBtYXBwaW5nLiAgTG9hZHMgYWxsCiAgICAgKiBw\nZXJzaXN0ZW50IHR5cGVzIGlmIG5lY2Vzc2FyeSwgc2luY2UgYWxsIHBlcnNp\nc3RlbnQgc3ViY2xhc3NlcyBvZiB0aGlzCiAgICAgKiBtYXBwaW5nIG1heSBu\nb3QgaGF2ZSBiZWVuIHJlc29sdmVkIGJlZm9yZSB0aGlzIG1ldGhvZCBpcyBj\nYWxsZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01hcHBpbmcgZmlu\nZEJhc2VDbGFzc01hcHBpbmcoQ2xhc3NNYXBwaW5nIG1hcHBpbmcpIHsgICAg\nICAgIAogICAgICAgIENsYXNzTWFwcGluZyBiYXNlTWFwcGluZyA9IG51bGw7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IG1hcHBpbmcuZ2V0UENTdXBl\ncmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChzdXAgPT0gbnVsbCkgewog\nICAgICAgICAgICAvLyBubyBzdXBlcmNsYXNzIG1ldGFkYXRhIHdhcyBwcm92\naWRlZC4gIGNoZWNrIHRvIHNlZSBpZiB0aGlzIGNsYXNzCiAgICAgICAgICAg\nIC8vIGhhcyBhbnkgcGVyc2lzdGVudCBzdWJjbGFzc2VzLgogICAgICAgICAg\nICBpZiAobWFwcGluZy5nZXRQQ1N1YmNsYXNzZXMoKS5sZW5ndGggPiAwKQog\nICAgICAgICAgICAgICAgYmFzZU1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHBlcnNpc3RlbnQgc3Vi\nY2xhc3NlcyBtYXkgbm90IGhhdmUgYmVlbiByZXNvbHZlZCB5ZXQuICAKICAg\nICAgICAgICAgICAgIC8vIHJ1biB0aHJvdWdoIHRoZSBwZXJzaXN0ZW50IHR5\ncGVzIHRvIHNlZSBpZiBhbnkgb2YgdGhlbSAKICAgICAgICAgICAgICAgIC8v\nIG9yIHRoZWlyIHN1cGVyY2xhc3MgaXMgYSBzdWJjbGFzcyBvZiB0aGlzIGNs\nYXNzLgogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBjbGFzc2VzID0gbG9h\nZFBlcnNpc3RlbnRUeXBlcyhmYWxzZSwgCiAgICAgICAgICAgICAgICAgICAg\nICAgIG1hcHBpbmcuZ2V0RW52Q2xhc3NMb2FkZXIoKSk7CiAgICAgICAgICAg\nICAgICBDbGFzcyBjbHM7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGNsYXNzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgICAgICBjbHMgPSAoQ2xhc3MpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICAgICAgQ2xhc3Mgc3VwY2wgPSBjbHMuZ2V0U3Vw\nZXJjbGFzcygpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdXBjbCAh\nPSBudWxsICYmIAogICAgICAgICAgICAgICAgICAgICAgICAgICAhc3VwY2wu\nZ2V0Q2xhc3MoKS5lcXVhbHMoamF2YS5sYW5nLk9iamVjdC5jbGFzcykpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdXBjbC5pc0ludGVyZmFj\nZSgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBjbC5lcXVh\nbHMobWFwcGluZy5nZXREZXNjcmliZWRUeXBlKCkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBiYXNlTWFwcGluZyA9IG1hcHBpbmc7ICAgIAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc3VwY2wg\nPSBzdXBjbC5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlTWFwcGluZyAhPSBudWxs\nKSBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0gZWxzZSBpZiAoIXN1cC5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRl\ncmZhY2UoKSkgewogICAgICAgICAgICAvLyBpZiB0aGUgc3VwZXJjbGFzcyBp\ncyBub3QgYSBtYW5hZ2VkIGludGVyZmFjZSwgZmluZCB0aGUgcm9vdAogICAg\nICAgICAgICAvLyBzdXBlcmNsYXNzIGFuZCBnZXQgaXRzIG1hcHBpbmcgaW5m\nbwogICAgICAgICAgICBDbGFzc01hcHBpbmcgc3VwY20gPSBzdXA7CiAgICAg\nICAgICAgIHdoaWxlIChzdXBjbSAhPSBudWxsICYmIAogICAgICAgICAgICAg\nICAgICAgICFzdXBjbS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZhY2Uo\nKSAmJgogICAgICAgICAgICAgICAgICAgICFzdXBjbS5pc0VtYmVkZGVkT25s\neSgpKSB7CiAgICAgICAgICAgICAgICBDbGFzc01hcHBpbmcgc3VwY20yID0g\nc3VwY20uZ2V0UENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAgICAg\nICAgaWYgKHN1cGNtMiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGJh\nc2VNYXBwaW5nID0gc3VwY207CiAgICAgICAgICAgICAgICBzdXBjbSA9IHN1\ncGNtMjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nYmFzZU1hcHBpbmc7CiAgICB9CiAgIAogICAgLyoqCiAgICAgKiBJZiBhbiBp\nbmhlcml0YW5jZSBzdHJhdGVneSBoYXMgbm90IGJlZW4gc2V0IG9uIHRoaXMg\nbWFwcGluZywgc2V0IGl0CiAgICAgKiB0byB0aGUgZGVmYXVsdCAoZmxhdCku\nICBUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBzdHJhdGVn\naWVzCiAgICAgKiBhcmUgY3JlYXRlZCBmb3IgdGhlIHNwZWNpZmllZCBtYXBw\naW5nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXREZWZhdWx0SW5o\nZXJpdGFuY2VTdHJhdGVneShDbGFzc01hcHBpbmcgbWFwcGluZykgewogICAg\nICAgIENsYXNzTWFwcGluZ0luZm8gaW5mbyA9IG1hcHBpbmcuZ2V0TWFwcGlu\nZ0luZm8oKTsKICAgICAgICBpZiAoaW5mbyAhPSBudWxsICYmIGluZm8uZ2V0\nSGllcmFyY2h5U3RyYXRlZ3koKSA9PSBudWxsKQogICAgICAgICAgICBpbmZv\nLnNldEhpZXJhcmNoeVN0cmF0ZWd5KEZsYXRDbGFzc1N0cmF0ZWd5LkFMSUFT\nKTsgICAgICAgIAogICAgfSAKICAgIAogICAgLyoqCiAgICAgKiBEZXRlcm1p\nbmVzIHdoZXRoZXIgYW4gaW5oZXJ0YW5jZSBzdHJhdGVneSBoYXMgYmVlbiBz\nZXQgb24gdGhlCiAgICAgKiBzcGVjaWZpZWQgbWFwcGluZy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFzSW5oZXJpdGFuY2VTdHJhdGVneShD\nbGFzc01hcHBpbmcgbWFwcGluZykgewogICAgICAgIENsYXNzTWFwcGluZ0lu\nZm8gaW5mbyA9IG1hcHBpbmcuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBp\nZiAoaW5mbyAhPSBudWxsICYmIGluZm8uZ2V0SGllcmFyY2h5U3RyYXRlZ3ko\nKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBy\nZXR1cm4gZmFsc2U7ICAgICAgICAKICAgIH0KfQo=\n","encoding":"base64"}

