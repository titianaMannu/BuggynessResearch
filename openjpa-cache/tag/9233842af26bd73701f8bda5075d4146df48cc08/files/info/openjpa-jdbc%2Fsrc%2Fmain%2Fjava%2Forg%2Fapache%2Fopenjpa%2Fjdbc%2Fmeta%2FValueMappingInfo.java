{"sha":"3687aefc51225fc34537b107e4b32b4175032240","node_id":"MDQ6QmxvYjIwNjM2NDozNjg3YWVmYzUxMjI1ZmMzNDUzN2IxMDdlNGIzMmI0MTc1MDMyMjQw","size":12340,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3687aefc51225fc34537b107e4b32b4175032240","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CgovKioKICog\nSW5mb3JtYXRpb24gYWJvdXQgdGhlIG1hcHBpbmcgZnJvbSBhIGZpZWxkIHZh\nbHVlIHRvIHRoZSBzY2hlbWEsIGluCiAqIHJhdyBmb3JtLiBUaGUgY29sdW1u\ncyBhbmQgdGFibGVzIHVzZWQgaW4gbWFwcGluZyBpbmZvIHdpbGwgbm90IGJl\nIHBhcnQgb2YKICogdGhlIHtAbGluayBTY2hlbWFHcm91cH0gdXNlZCBhdCBy\ndW50aW1lLiBSYXRoZXIsIHRoZXkgd2lsbCBiZSBzdHJ1Y3RzCiAqIHdpdGgg\ndGhlIHJlbGV2YW50IHBpZWNlcyBvZiBpbmZvcm1hdGlvbiBmaWxsZWQgaW4u\nCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgVmFs\ndWVNYXBwaW5nSW5mbwogICAgZXh0ZW5kcyBNYXBwaW5nSW5mbyB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6\nZXIuZm9yUGFja2FnZQogICAgICAgIChWYWx1ZU1hcHBpbmdJbmZvLmNsYXNz\nKTsKCiAgICBwcml2YXRlIGJvb2xlYW4gX2NyaXRlcmlhID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2Nhbk51bGwgPSB0cnVlOwoKICAgIC8qKgog\nICAgICogV2hldGhlciB0byB1c2UgY2xhc3MgY3JpdGVyaWEgd2hlbiBqb2lu\naW5nIHRvIHJlbGF0ZWQgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpIHsKICAgICAgICByZXR1cm4gX2Ny\naXRlcmlhOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byB1c2Ug\nY2xhc3MgY3JpdGVyaWEgd2hlbiBqb2luaW5nIHRvIHJlbGF0ZWQgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VXNlQ2xhc3NDcml0ZXJpYShi\nb29sZWFuIGNyaXRlcmlhKSB7CiAgICAgICAgX2NyaXRlcmlhID0gY3JpdGVy\naWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHVzZXIgaGFzIGV4\ncGxpY2l0bHkgdHVybmVkIG51bGwgaW5kaWNhdG9yIGNvbHVtbiBvZmYuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNhbkluZGljYXRlTnVsbCgpIHsK\nICAgICAgICByZXR1cm4gX2Nhbk51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHVzZXIgaGFzIGV4cGxpY2l0bHkgdHVybmVkIG51bGwgaW5k\naWNhdG9yIGNvbHVtbiBvZmYuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndENhbkluZGljYXRlTnVsbChib29sZWFuIGluZCkgewogICAgICAgIF9jYW5O\ndWxsID0gaW5kOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBq\nb2luIGZyb20gdGhpcyB2YWx1ZSB0byBpdHMgcmVsYXRlZCB0eXBlLgogICAg\nICoKICAgICAqIEBwYXJhbSBuYW1lIGJhc2UgbmFtZSBmb3IgdmFsdWUgbWFw\ncGluZwogICAgICogQHBhcmFtIGludmVyc2FibGUgd2hldGhlciBhbiBpbnZl\ncnNlIGpvaW4gaXMgYWxsb3dlZAogICAgICovCiAgICBwdWJsaWMgRm9yZWln\nbktleSBnZXRUeXBlSm9pbihmaW5hbCBWYWx1ZU1hcHBpbmcgdmFsLCBmaW5h\nbCBTdHJpbmcgbmFtZSwKICAgICAgICBib29sZWFuIGludmVyc2FibGUsIGJv\nb2xlYW4gYWRhcHQpIHsKICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gdmFs\nLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgaWYgKHJlbCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRm9yZWlnbktleURl\nZmF1bHRzIGRlZiA9IG5ldyBGb3JlaWduS2V5RGVmYXVsdHMoKSB7CiAgICAg\nICAgICAgIHB1YmxpYyBGb3JlaWduS2V5IGdldChUYWJsZSBsb2NhbCwgVGFi\nbGUgZm9yZWlnbiwgYm9vbGVhbiBpbnZlcnNlKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdmFsLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGlu\nZ0RlZmF1bHRzKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0Rm9yZWlnbktl\neSh2YWwsIG5hbWUsIGxvY2FsLCBmb3JlaWduLCBpbnZlcnNlKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgcG9wdWxhdGUoVGFi\nbGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIENvbHVtbiBjb2wsCiAgICAgICAg\nICAgICAgICBPYmplY3QgdGFyZ2V0LCBib29sZWFuIGludmVyc2UsIGludCBw\nb3MsIGludCBjb2xzKSB7CiAgICAgICAgICAgICAgICB2YWwuZ2V0TWFwcGlu\nZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAg\nICAgICAgICAgICBwb3B1bGF0ZUZvcmVpZ25LZXlDb2x1bW4odmFsLCBuYW1l\nLCBsb2NhbCwgZm9yZWlnbiwgY29sLAogICAgICAgICAgICAgICAgICAgICAg\nICB0YXJnZXQsIGludmVyc2UsIHBvcywgY29scyk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9OwogICAgICAgIFRhYmxlIHRhYmxlID0gZ2V0VGFibGUodmFs\nKTsKICAgICAgICByZXR1cm4gY3JlYXRlRm9yZWlnbktleSh2YWwsIG51bGws\nIGdldENvbHVtbnMoKSwgZGVmLAogICAgICAgICAgICB0YWJsZSwgdmFsLmdl\ndEZpZWxkTWFwcGluZygpLgogICAgICAgICAgICBnZXREZWZpbmluZ01hcHBp\nbmcoKSwgcmVsLCBpbnZlcnNhYmxlLCBhZGFwdCk7CiAgICB9CgogICAgcHVi\nbGljIFRhYmxlIGdldFRhYmxlKFZhbHVlTWFwcGluZyB2YWwpIHsKICAgICAg\nICBGaWVsZE1hcHBpbmcgZmllbGQgPSB2YWwuZ2V0RmllbGRNYXBwaW5nKCk7\nCiAgICAgICAgVGFibGUgdGFibGUgPSBmaWVsZC5nZXRUYWJsZSgpOwogICAg\nICAgIGlmICh0YWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzTWFw\ncGluZyBjbHMgPSAoQ2xhc3NNYXBwaW5nKWZpZWxkLmdldERlZmluaW5nTWV0\nYURhdGEoKTsKICAgICAgICAgICAgVmFsdWVNYXBwaW5nIHZhbDEgPSAoVmFs\ndWVNYXBwaW5nKWNscy5nZXRFbWJlZGRpbmdNZXRhRGF0YSgpOwogICAgICAg\nICAgICBpZiAodmFsMSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFRhYmxlKHZhbDEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGFi\nbGU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2lu\nIGZyb20gdGhlIHJlbGF0ZWQgdHlwZSB0byB0aGlzIHZhbHVlLgogICAgICov\nCiAgICBwdWJsaWMgRm9yZWlnbktleSBnZXRJbnZlcnNlVHlwZUpvaW4oZmlu\nYWwgVmFsdWVNYXBwaW5nIHZhbCwKICAgICAgICBmaW5hbCBTdHJpbmcgbmFt\nZSwgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIENsYXNzTWFwcGluZyByZWwg\nPSB2YWwuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAocmVsID09IG51\nbGwgfHwgcmVsLmdldFRhYmxlKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIEZvcmVpZ25LZXlEZWZhdWx0cyBkZWYgPSBu\nZXcgRm9yZWlnbktleURlZmF1bHRzKCkgewogICAgICAgICAgICBwdWJsaWMg\nRm9yZWlnbktleSBnZXQoVGFibGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIGJv\nb2xlYW4gaW52ZXJzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbC5n\nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgog\nICAgICAgICAgICAgICAgICAgIGdldEZvcmVpZ25LZXkodmFsLCBuYW1lLCBs\nb2NhbCwgZm9yZWlnbiwgIWludmVyc2UpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShUYWJsZSBsb2NhbCwgVGFi\nbGUgZm9yZWlnbiwgQ29sdW1uIGNvbCwKICAgICAgICAgICAgICAgIE9iamVj\ndCB0YXJnZXQsIGJvb2xlYW4gaW52ZXJzZSwgaW50IHBvcywgaW50IGNvbHMp\nIHsKICAgICAgICAgICAgICAgIHZhbC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgp\nLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIHBv\ncHVsYXRlRm9yZWlnbktleUNvbHVtbih2YWwsIG5hbWUsIGxvY2FsLCBmb3Jl\naWduLCBjb2wsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCwgIWlu\ndmVyc2UsIHBvcywgY29scyk7CiAgICAgICAgICAgIH0KICAgICAgICB9Owog\nICAgICAgIHJldHVybiBjcmVhdGVGb3JlaWduS2V5KHZhbCwgbnVsbCwgZ2V0\nQ29sdW1ucygpLCBkZWYsIHJlbC5nZXRUYWJsZSgpLAogICAgICAgICAgICBy\nZWwsIHZhbC5nZXRGaWVsZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBpbmco\nKSwgZmFsc2UsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY29sdW1ucyBmb3IgdGhpcyB2YWx1ZSwgYmFzZWQgb24gdGhlIGdp\ndmVuIHRlbXBsYXRlcy4KICAgICAqLwogICAgcHVibGljIENvbHVtbltdIGdl\ndENvbHVtbnMoVmFsdWVNYXBwaW5nIHZhbCwgU3RyaW5nIG5hbWUsCiAgICAg\nICAgQ29sdW1uW10gdG1wbGF0ZXMsIFRhYmxlIHRhYmxlLCBib29sZWFuIGFk\nYXB0KSB7CiAgICAgICAgb3JkZXJDb2x1bW5zQnlUYXJnZXRGaWVsZCh2YWws\nIHRtcGxhdGVzLCBhZGFwdCk7CiAgICAgICAgdmFsLmdldE1hcHBpbmdSZXBv\nc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkucG9wdWxhdGVDb2x1bW5z\nCiAgICAgICAgICAgICh2YWwsIG5hbWUsIHRhYmxlLCB0bXBsYXRlcyk7CiAg\nICAgICAgcmV0dXJuIGNyZWF0ZUNvbHVtbnModmFsLCBudWxsLCB0bXBsYXRl\ncywgdGFibGUsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nZ2l2ZW4gY29sdW1ucyBtYXRjaCB1cCB3aXRoIHRoZSB0YXJnZXQgZmllbGRz\nIHN1cHBsaWVkIG9uIHRoZQogICAgICogdGVtcGxhdGVzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgb3JkZXJDb2x1bW5zQnlUYXJnZXRGaWVsZChWYWx1\nZU1hcHBpbmcgdmFsLCBDb2x1bW5bXSB0bXBsYXRlcywKICAgICAgICBib29s\nZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKHRtcGxhdGVzLmxlbmd0aCA8IDIg\nfHwgdG1wbGF0ZXNbMF0uZ2V0VGFyZ2V0RmllbGQoKSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgTGlzdCBjb2xzID0gZ2V0Q29sdW1u\ncygpOwogICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSB8fCBjb2xzLnNpemUo\nKSAhPSB0bXBsYXRlcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgaW50IHBvcyA9IDA7CiAgICAgICAgQ29sdW1uIGN1ciA9IChDb2x1\nbW4pIGNvbHMuZ2V0KDApOwogICAgICAgIENvbHVtbiBuZXh0OwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5zaXplKCk7IGkrKykgewogICAg\nICAgICAgICBpZiAoY3VyLmdldFRhcmdldEZpZWxkKCkgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgibm8tdGFyZ2V0ZmllbGQiLCB2YWwpKTsKCiAgICAgICAgICAgIHBv\ncyA9IGZpbmRUYXJnZXRGaWVsZCh0bXBsYXRlcywgY3VyLmdldFRhcmdldEZp\nZWxkKCkpOwogICAgICAgICAgICBpZiAocG9zID09IC0xKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtdGFyZ2V0ZmllbGQiLAogICAgICAgICAgICAgICAgICAgIHZhbCwgY3Vy\nLmdldFRhcmdldEZpZWxkKCkpKTsKCiAgICAgICAgICAgIG5leHQgPSAoQ29s\ndW1uKSBjb2xzLmdldChwb3MpOwogICAgICAgICAgICBjb2xzLnNldChwb3Ms\nIGN1cik7CiAgICAgICAgICAgIGN1ciA9IG5leHQ7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUg\ndGVtcGxhdGUgY29sdW1uIHdpdGggdGhlIGdpdmVuIHRhcmdldCBmaWVsZC4K\nICAgICAqLwogICAgcHVibGljIGludCBmaW5kVGFyZ2V0RmllbGQoQ29sdW1u\nW10gdG1wbGF0ZXMsIFN0cmluZyB0YXJnZXQpIHsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHRtcGxhdGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICBpZiAodGFyZ2V0LmVxdWFscyh0bXBsYXRlc1tpXS5nZXRUYXJnZXRGaWVs\nZCgpKSkKICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgIHJldHVy\nbiAtMTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1ZSBj\nb25zdHJhaW50IGZvciB0aGUgZ2l2ZW4gY29sdW1ucywgb3IgbnVsbCBpZiBu\nb25lLgogICAgICovCiAgICBwdWJsaWMgVW5pcXVlIGdldFVuaXF1ZShWYWx1\nZU1hcHBpbmcgdmFsLCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBhZGFwdCkgewog\nICAgICAgIENvbHVtbltdIGNvbHMgPSB2YWwuZ2V0Q29sdW1ucygpOwogICAg\nICAgIGlmIChjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgVW5pcXVlIHVucSA9IHZhbC5nZXRNYXBwaW5nUmVw\nb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICBn\nZXRVbmlxdWUodmFsLCBuYW1lLCBjb2xzWzBdLmdldFRhYmxlKCksIGNvbHMp\nOwogICAgICAgIHJldHVybiBjcmVhdGVVbmlxdWUodmFsLCBudWxsLCB1bnEs\nIGNvbHMsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nbiBpbmRleCBmb3IgdGhlIGdpdmVuIGNvbHVtbnMsIG9yIG51bGwgaWYgbm9u\nZS4KICAgICAqLwogICAgcHVibGljIEluZGV4IGdldEluZGV4KFZhbHVlTWFw\ncGluZyB2YWwsIFN0cmluZyBuYW1lLCBib29sZWFuIGFkYXB0KSB7CiAgICAg\nICAgQ29sdW1uW10gY29scyA9IHZhbC5nZXRDb2x1bW5zKCk7CiAgICAgICAg\naWYgKGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBJbmRleCBpZHggPSB2YWwuZ2V0TWFwcGluZ1JlcG9zaXRv\ncnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAgICAgZ2V0SW5k\nZXgodmFsLCBuYW1lLCBjb2xzWzBdLmdldFRhYmxlKCksIGNvbHMpOwogICAg\nICAgIHJldHVybiBjcmVhdGVJbmRleCh2YWwsIG51bGwsIGlkeCwgY29scywg\nYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudWxs\nIGluZGljYXRvciBjb2x1bW4gZm9yIHRoaXMgdmFsdWUsIG9yIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIENvbHVtbiBnZXROdWxsSW5kaWNh\ndG9yQ29sdW1uKFZhbHVlTWFwcGluZyB2YWwsIFN0cmluZyBuYW1lLAogICAg\nICAgIFRhYmxlIHRhYmxlLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgLy8g\ncmVzZXQgSU8KICAgICAgICBzZXRDb2x1bW5JTyhudWxsKTsKCiAgICAgICAg\nLy8gaGFzIHRoZSB1c2VyIGV4cGxpY2l0bHkgdHVybmVkIG51bGwgaW5kaWNh\ndG9yIG9mZj8KICAgICAgICBpZiAoIV9jYW5OdWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gZXh0cmFjdCBnaXZlbiBudWxsLWlu\nZCBjb2x1bW4KICAgICAgICBMaXN0IGNvbHMgPSBnZXRDb2x1bW5zKCk7CiAg\nICAgICAgQ29sdW1uIGdpdmVuID0gKGNvbHMuaXNFbXB0eSgpKSA/IG51bGwg\nOiAoQ29sdW1uKSBjb2xzLmdldCgwKTsKICAgICAgICBNYXBwaW5nRGVmYXVs\ndHMgZGVmID0gdmFsLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGlu\nZ0RlZmF1bHRzKCk7CiAgICAgICAgaWYgKGdpdmVuID09IG51bGwgJiYgKCFh\nZGFwdCAmJiAhZGVmLmRlZmF1bHRNaXNzaW5nSW5mbygpKSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbHVtbiB0bXBsYXRlID0gbmV3\nIENvbHVtbigpOwogICAgICAgIHRtcGxhdGUuc2V0TmFtZShuYW1lICsgIl9u\ndWxsIik7CiAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMu\nSU5UKTsKICAgICAgICBpZiAoIWRlZi5wb3B1bGF0ZU51bGxJbmRpY2F0b3JD\nb2x1bW5zKHZhbCwgbmFtZSwgdGFibGUsIG5ldyBDb2x1bW5bXQogICAgICAg\nICAgICB7IHRtcGxhdGUgfSkgJiYgZ2l2ZW4gPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlmIChnaXZlbiAhPSBudWxsICYm\nIChnaXZlbi5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkKICAg\nICAgICAgICAgfHwgZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFU\nQUJMRSkpKSB7CiAgICAgICAgICAgIENvbHVtbklPIGlvID0gbmV3IENvbHVt\nbklPKCk7CiAgICAgICAgICAgIGlvLnNldEluc2VydGFibGUoMCwgIWdpdmVu\nLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKSk7CiAgICAgICAg\nICAgIGlvLnNldFVwZGF0YWJsZSgwLCAhZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4u\nRkxBR19VTlVQREFUQUJMRSkpOwogICAgICAgICAgICBzZXRDb2x1bW5JTyhp\nbyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZ2l2ZW4gIT0gbnVsbCAmJiBn\naXZlbi5nZXROYW1lKCkgIT0gbnVsbCkgewogICAgICAgICAgICAvLyB0ZXN0\nIGlmIGdpdmVuIGNvbHVtbiBuYW1lIGlzIGFjdHVhbGx5IGEgZmllbGQgbmFt\nZSwgaW4gd2hpY2gKICAgICAgICAgICAgLy8gY2FzZSB3ZSB1c2UgaXRzIGNv\nbHVtbiBhcyB0aGUgbnVsbCBpbmRpY2F0b3IgY29sdW1uCiAgICAgICAgICAg\nIENsYXNzTWFwcGluZyBlbWJlZCA9IHZhbC5nZXRFbWJlZGRlZE1hcHBpbmco\nKTsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGVmbSA9IChlbWJlZCA9PSBu\ndWxsKSA/IG51bGwKICAgICAgICAgICAgICAgIDogZW1iZWQuZ2V0RmllbGRN\nYXBwaW5nKGdpdmVuLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmIChlZm0g\nIT0gbnVsbCAmJiBlZm0uZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDApCiAgICAg\nICAgICAgICAgICBnaXZlbi5zZXROYW1lKGVmbS5nZXRDb2x1bW5zKClbMF0u\nZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICAgICAgYm9vbGVhbiBjb21wYXQg\nPSBnaXZlbiA9PSBudWxsIHx8IGdpdmVuLmdldE5hbWUoKSA9PSBudWxsCiAg\nICAgICAgICAgIHx8IHRhYmxlID09IG51bGwgfHwgIXRhYmxlLmlzTmFtZVRh\na2VuKGdpdmVuLmdldE5hbWUoKSk7CgogICAgICAgIHJldHVybiBtZXJnZUNv\nbHVtbih2YWwsICJudWxsLWluZCIsIHRtcGxhdGUsIGNvbXBhdCwgZ2l2ZW4s\nCiAgICAgICAgICAgIHRhYmxlLCBhZGFwdCwgZGVmLmRlZmF1bHRNaXNzaW5n\nSW5mbygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIGlu\ndGVybmFsIGluZm9ybWF0aW9uIHdpdGggdGhlIG1hcHBpbmcgZGF0YSBmb3Ig\ndGhlIGdpdmVuCiAgICAgKiB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc3luY1dpdGgoVmFsdWVNYXBwaW5nIHZhbCkgewogICAgICAgIGNsZWFy\nKGZhbHNlKTsKCiAgICAgICAgX2NyaXRlcmlhID0gdmFsLmdldFVzZUNsYXNz\nQ3JpdGVyaWEoKTsKICAgICAgICBzZXRDb2x1bW5JTyh2YWwuZ2V0Q29sdW1u\nSU8oKSk7CiAgICAgICAgaWYgKHZhbC5nZXRGb3JlaWduS2V5KCkgIT0gbnVs\nbCAmJiB2YWwuZ2V0VHlwZU1hcHBpbmcoKSAhPSBudWxsCiAgICAgICAgICAg\nICYmIHZhbC5nZXRUeXBlTWFwcGluZygpLmdldFRhYmxlKCkgIT0gbnVsbCkg\newogICAgICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSB2YWwuZ2V0RmllbGRN\nYXBwaW5nKCk7CiAgICAgICAgICAgIFRhYmxlIGxvY2FsID0gKGZtLmdldEpv\naW5Gb3JlaWduS2V5KCkgIT0gbnVsbCkgPyBmbS5nZXRUYWJsZSgpCiAgICAg\nICAgICAgICAgICA6IGZtLmdldERlZmluaW5nTWFwcGluZygpLmdldFRhYmxl\nKCk7CiAgICAgICAgICAgIFRhYmxlIGZvcmVpZ247CiAgICAgICAgICAgIGlm\nICh2YWwuZ2V0Sm9pbkRpcmVjdGlvbigpID09IFZhbHVlTWFwcGluZy5KT0lO\nX0VYUEVDVEVEX0lOVkVSU0UpIHsKICAgICAgICAgICAgICAgIGZvcmVpZ24g\nPSBsb2NhbDsKICAgICAgICAgICAgICAgIGxvY2FsID0gdmFsLmdldFR5cGVN\nYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAgIHNldEpvaW5E\naXJlY3Rpb24oSk9JTl9GT1JXQVJEKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGZvcmVpZ24gPSB2YWwuZ2V0VHlwZU1hcHBpbmco\nKS5nZXRUYWJsZSgpOwogICAgICAgICAgICAgICAgc2V0Sm9pbkRpcmVjdGlv\nbigodmFsLmdldEpvaW5EaXJlY3Rpb24oKSA9PSB2YWwuSk9JTl9GT1JXQVJE\nKQogICAgICAgICAgICAgICAgICAgID8gSk9JTl9GT1JXQVJEIDogSk9JTl9J\nTlZFUlNFKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzeW5jRm9yZWln\nbktleSh2YWwsIHZhbC5nZXRGb3JlaWduS2V5KCksIGxvY2FsLCBmb3JlaWdu\nKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgc3luY0NvbHVtbnModmFs\nLCB2YWwuZ2V0Q29sdW1ucygpLCBmYWxzZSk7CgogICAgICAgIHN5bmNJbmRl\neCh2YWwsIHZhbC5nZXRWYWx1ZUluZGV4KCkpOwogICAgICAgIHN5bmNVbmlx\ndWUodmFsLCB2YWwuZ2V0VmFsdWVVbmlxdWUoKSk7CgogICAgICAgIC8vIGV4\ncGxpY2l0IGhhbmRsZXIgc3RyYXRlZ3kgaWYgdGhlIGhhbmRsZXIgaXNuJ3Qg\ndGhlIGV4cGVjdGVkIGRlZmF1bHQKICAgICAgICBpZiAodmFsLmdldEhhbmRs\nZXIoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIFZhbHVlSGFuZGxlciBkZWYg\nPSB2YWwuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0TWFwcGluZ1JlcG9zaXRvcnko\nKS4KICAgICAgICAgICAgICAgIGRlZmF1bHRIYW5kbGVyKHZhbCk7CiAgICAg\nICAgICAgIGlmIChkZWYgPT0gbnVsbCB8fCB2YWwuZ2V0SGFuZGxlcigpLmdl\ndENsYXNzKCkgIT0gZGVmLmdldENsYXNzKCkpCiAgICAgICAgICAgICAgICBz\nZXRTdHJhdGVneSh2YWwuZ2V0SGFuZGxlcigpLmdldENsYXNzKCkuZ2V0TmFt\nZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xl\nYXIoYm9vbGVhbiBjYW5GbGFncykgewogICAgICAgIHN1cGVyLmNsZWFyKGNh\nbkZsYWdzKTsKICAgICAgICBpZiAoY2FuRmxhZ3MpIHsKICAgICAgICAgICAg\nX2NyaXRlcmlhID0gZmFsc2U7CiAgICAgICAgICAgIF9jYW5OdWxsID0gdHJ1\nZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgY29weShNYXBw\naW5nSW5mbyBpbmZvKSB7CiAgICAgICAgc3VwZXIuY29weShpbmZvKTsKICAg\nICAgICBpZiAoIShpbmZvIGluc3RhbmNlb2YgVmFsdWVNYXBwaW5nSW5mbykp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWVNYXBwaW5nSW5m\nbyB2aW5mbyA9IChWYWx1ZU1hcHBpbmdJbmZvKSBpbmZvOwogICAgICAgIGlm\nICghX2NyaXRlcmlhKQogICAgICAgICAgICBfY3JpdGVyaWEgPSB2aW5mby5n\nZXRVc2VDbGFzc0NyaXRlcmlhKCk7CiAgICAgICAgaWYgKF9jYW5OdWxsKQog\nICAgICAgICAgICBfY2FuTnVsbCA9IHZpbmZvLmNhbkluZGljYXRlTnVsbCgp\nOwogICAgfQp9Cg==\n","encoding":"base64"}

