{"sha":"71c0ff208e728a2046a1defa17d25ffaeb99420c","node_id":"MDQ6QmxvYjIwNjM2NDo3MWMwZmYyMDhlNzI4YTIwNDZhMWRlZmExN2QyNWZmYWViOTk0MjBj","size":13427,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/71c0ff208e728a2046a1defa17d25ffaeb99420c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlu\nZ1BlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1h\ncHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZp\nZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLlN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLlZhbHVlTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLlJvd0ltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiBCYXNlIGNs\nYXNzIGZvciBtYXAgbWFwcGluZ3MuIEhhbmRsZXMgbWFuYWdpbmcgdGhlIHNl\nY29uZGFyeSB0YWJsZQogKiB1c2VkIHRvIGhvbGQgbWFwIGtleXMgYW5kIHZh\nbHVlcyBhbmQgbG9hZGluZy4gU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVudAog\nKiBhYnN0cmFjdCBtZXRob2RzIGFuZCBpbnNlcnQvdXBkYXRlIGJlaGF2aW9y\nIGFzIHdlbGwgYXMgb3ZlcnJpZGluZwogKiB7QGxpbmsgRmllbGRTdHJhdGVn\neSN0b0RhdGFTdG9yZVZhbHVlfSwKICoge0BsaW5rIEZpZWxkU3RyYXRlZ3kj\ndG9LZXlEYXRhU3RvcmVWYWx1ZX0sCiAqIHtAbGluayBGaWVsZFN0cmF0ZWd5\nI2pvaW5SZWxhdGlvbn0sIGFuZAogKiB7QGxpbmsgRmllbGRTdHJhdGVneSNq\nb2luS2V5UmVsYXRpb259IGlmIG5lY2Vzc2FyeS4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICovCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBNYXBUYWJsZUZp\nZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgQ29udGFpbmVyRmllbGRTdHJhdGVn\neQogICAgaW1wbGVtZW50cyBMUlNNYXBGaWVsZFN0cmF0ZWd5IHsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKE1hcFRhYmxlRmllbGRTdHJhdGVneS5j\nbGFzcyk7CgogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXRGaWVsZE1hcHBp\nbmcoKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzc01hcHBpbmdbXSBnZXRJbmRlcGVuZGVudEtleU1hcHBpbmdzKGJv\nb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICByZXR1cm4gKHRyYXZlcnNlKSA/\nIGZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRJbmRlcGVuZGVudFR5cGVNYXBw\naW5ncygpCiAgICAgICAgICAgIDogQ2xhc3NNYXBwaW5nLkVNUFRZX01BUFBJ\nTkdTOwogICAgfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmdbXSBnZXRJbmRl\ncGVuZGVudFZhbHVlTWFwcGluZ3MoYm9vbGVhbiB0cmF2ZXJzZSkgewogICAg\nICAgIHJldHVybiAodHJhdmVyc2UpID8gZmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKS4KICAgICAgICAgICAgZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3Mo\nKSA6IENsYXNzTWFwcGluZy5FTVBUWV9NQVBQSU5HUzsKICAgIH0KCiAgICBw\ndWJsaWMgRm9yZWlnbktleSBnZXRKb2luRm9yZWlnbktleShDbGFzc01hcHBp\nbmcgY2xzKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkLmdldEpvaW5Gb3JlaWdu\nS2V5KCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBkZXJpdmVLZXkoSkRC\nQ1N0b3JlIHN0b3JlLCBPYmplY3QgdmFsdWUpIHsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGRlcml2ZVZhbHVlKEpE\nQkNTdG9yZSBzdG9yZSwgT2JqZWN0IGtleSkgewogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlcyB7QGxpbmsgRmll\nbGRTdHJhdGVneSNqb2luS2V5UmVsYXRpb259IGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHB1YmxpYyBKb2lucyBqb2luS2V5UmVsYXRpb24oSm9pbnMgam9p\nbnMsIENsYXNzTWFwcGluZyBrZXkpIHsKICAgICAgICByZXR1cm4gam9pbktl\neVJlbGF0aW9uKGpvaW5zLCBmYWxzZSwgZmFsc2UpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW52b2tlcyB7QGxpbmsgRmllbGRTdHJhdGVneSNqb2luUmVs\nYXRpb259IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBKb2lucyBq\nb2luVmFsdWVSZWxhdGlvbihKb2lucyBqb2lucywgQ2xhc3NNYXBwaW5nIHZh\nbCkgewogICAgICAgIHJldHVybiBqb2luUmVsYXRpb24oam9pbnMsIGZhbHNl\nLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFwKGJvb2xlYW4g\nYWRhcHQpIHsKICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSAhPSBK\nYXZhVHlwZXMuTUFQKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYXAiLCBmaWVsZCkpOwogICAgICAg\nIGlmIChmaWVsZC5nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJtYXBwZWQtYnkta2V5IiwgZmllbGQpKTsKCiAgICAgICAgLy8g\nTm9uLWRlZmF1bHQgbWFwcGluZyBVbmktL09uZVRvTWFueS9Gb3JlaWduS2V5\nIGFsbG93cyBzY2hlbWEgY29tcG9uZW50cwogICAgICAgIGlmIChmaWVsZC5p\nc1VuaTFUb01GSygpKSAgCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBp\nZiAoZmllbGQuaXNCaU1UbzFKVCgpKQogICAgICAgICAgICBmaWVsZC5zZXRC\naTFNSm9pblRhYmxlSW5mbygpOwogICAgICAgIGZpZWxkLmdldFZhbHVlSW5m\nbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsK\nICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgZGVsZXRlKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBSb3cgcm93\nID0gcm0uZ2V0QWxsUm93cyhmaWVsZC5nZXRUYWJsZSgpLCBSb3cuQUNUSU9O\nX0RFTEVURSk7CiAgICAgICAgcm93LndoZXJlRm9yZWlnbktleShmaWVsZC5n\nZXRKb2luRm9yZWlnbktleSgpLCBzbSk7CiAgICAgICAgcm0uZmx1c2hBbGxS\nb3dzKHJvdyk7CiAgICB9CgogICAgcHVibGljIGludCBzdXBwb3J0c1NlbGVj\ndChTZWxlY3Qgc2VsLCBpbnQgdHlwZSwgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNT\ndG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChmaWVsZC5pc0xSUygpKSB7CiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0\nRmllbGQoZmllbGQuZ2V0SW5kZXgoKSwgbmV3IExSU1Byb3h5TWFwKHRoaXMp\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\nc2VsZWN0IGFsbCBhbmQgbG9hZCBpbnRvIGEgbm9ybWFsIHByb3h5CiAgICAg\nICAgSm9pbnNbXSBqb2lucyA9IG5ldyBKb2luc1syXTsKICAgICAgICBSZXN1\nbHRbXSByZXMgPSBnZXRSZXN1bHRzKHNtLCBzdG9yZSwgZmV0Y2gsCiAgICAg\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFSQUxMRUws\nIGpvaW5zLCBmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTWFw\nIG1hcCA9IChNYXApIHNtLm5ld1Byb3h5KGZpZWxkLmdldEluZGV4KCkpOwog\nICAgICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAgICAgICAgICAgIHdoaWxl\nIChyZXNbMF0ubmV4dCgpKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzWzFd\nICE9IHJlc1swXSAmJiAhcmVzWzFdLm5leHQoKSkKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBrZXkgPSBsb2FkS2V5KHNt\nLCBzdG9yZSwgZmV0Y2gsIHJlc1swXSwgam9pbnNbMF0pOwogICAgICAgICAg\nICAgICAgdmFsID0gbG9hZFZhbHVlKHNtLCBzdG9yZSwgZmV0Y2gsIHJlc1sx\nXSwgam9pbnNbMV0pOwogICAgICAgICAgICAgICAgbWFwLnB1dChrZXksIHZh\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc20uc3RvcmVPYmplY3Qo\nZmllbGQuZ2V0SW5kZXgoKSwgbWFwKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICByZXNbMF0uY2xvc2UoKTsKICAgICAgICAgICAgaWYgKHJl\nc1sxXSAhPSByZXNbMF0pCiAgICAgICAgICAgICAgICByZXNbMV0uY2xvc2Uo\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBsb2FkS2V5\nUHJvamVjdGlvbihKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIGxvYWRLZXkobnVsbCwgc3RvcmUsIGZldGNoLCByZXMsIGpvaW5zKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGxvYWRQcm9qZWN0aW9uKEpEQkNTdG9y\nZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAg\nICBSZXN1bHQgcmVzLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gbG9hZFZhbHVlKG51bGwsIHN0\nb3JlLCBmZXRjaCwgcmVzLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIEpv\naW5zIGpvaW4oSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRlcikgewog\nICAgICAgIHJldHVybiBmaWVsZC5qb2luKGpvaW5zLCBmb3JjZU91dGVyLCB0\ncnVlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbktleShKb2lucyBq\nb2lucywgYm9vbGVhbiBmb3JjZU91dGVyKSB7CiAgICAgICAgcmV0dXJuIGZp\nZWxkLmpvaW4oam9pbnMsIGZvcmNlT3V0ZXIsIHRydWUpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBGb3JlaWduS2V5IGdldEpvaW5Gb3JlaWduS2V5KCkgewog\nICAgICAgIHJldHVybiBmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpOwogICAg\nfQoKICAgIHByb3RlY3RlZCBDbGFzc01hcHBpbmdbXSBnZXRJbmRlcGVuZGVu\ndEVsZW1lbnRNYXBwaW5ncyhib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAg\ncmV0dXJuIENsYXNzTWFwcGluZy5FTVBUWV9NQVBQSU5HUzsKICAgIH0KICAg\nIAogICAgcHJvdGVjdGVkIHZvaWQgaGFuZGxlTWFwcGVkQnlGb3JlaWduS2V5\nKGJvb2xlYW4gYWRhcHQpewogICAgICAgIGJvb2xlYW4gY3JpdGVyaWEgPSBm\naWVsZC5nZXRWYWx1ZUluZm8oKS5nZXRVc2VDbGFzc0NyaXRlcmlhKCk7CiAg\nICAgICAgLy8gY2hlY2sgZm9yIG5hbWVkIGludmVyc2UKICAgICAgICBGaWVs\nZE1hcHBpbmcgbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVkQnlNYXBwaW5nKCk7\nCiAgICAgICAgaWYgKG1hcHBlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGZp\nZWxkLmdldFZhbHVlSW5mbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cyhm\naWVsZCwgIWFkYXB0KTsKICAgICAgICAgICAgbWFwcGVkLnJlc29sdmUobWFw\ncGVkLk1PREVfTUVUQSB8IG1hcHBlZC5NT0RFX01BUFBJTkcpOwoKICAgICAg\nICAgICAgaWYgKCFtYXBwZWQuaXNNYXBwZWQoKSB8fCBtYXBwZWQuaXNTZXJp\nYWxpemVkKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm1hcHBlZC1ieS11bm1hcHBlZCIsCiAgICAg\nICAgICAgICAgICAgICAgZmllbGQsIG1hcHBlZCkpOwoKICAgICAgICAgICAg\naWYgKG1hcHBlZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgewog\nICAgICAgICAgICAgICAgaWYgKG1hcHBlZC5nZXRKb2luRGlyZWN0aW9uKCkg\nPT0gbWFwcGVkLkpPSU5fRk9SV0FSRCkgewogICAgICAgICAgICAgICAgICAg\nIGZpZWxkLnNldEpvaW5EaXJlY3Rpb24oZmllbGQuSk9JTl9JTlZFUlNFKTsK\nICAgICAgICAgICAgICAgICAgICBmaWVsZC5zZXRDb2x1bW5zKG1hcHBlZC5n\nZXREZWZpbmluZ01hcHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICAgICAg\nZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgaWYgKGlzVHlwZVVuam9pbmVkU3ViY2xhc3MobWFwcGVkKSkKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJtYXBwZWQtaW52ZXJz\nZS11bmpvaW5lZCIsIGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpLCBtYXBw\nZWQpKTsKICAgICAgICAgICAgICAgIEZvcmVpZ25LZXkgZmsgPSBtYXBwZWQu\nZ2V0Rm9yZWlnbktleSgKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQu\nZ2V0RGVmaW5pbmdNYXBwaW5nKCkpOwogICAgICAgICAgICAgICAgZmllbGQu\nc2V0Rm9yZWlnbktleShmayk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRK\nb2luRm9yZWlnbktleShmayk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWFw\ncGVkLmdldEVsZW1lbnQoKS5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5Q\nQykgewogICAgICAgICAgICAgICAgaWYgKGlzVHlwZVVuam9pbmVkU3ViY2xh\nc3MobWFwcGVkLmdldEVsZW1lbnRNYXBwaW5nKCkpKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICAgICAoIm1hcHBlZC1pbnZlcnNlLXVuam9p\nbmVkIiwgZmllbGQuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCksIG1hcHBlZCkpOwoK\nICAgICAgICAgICAgICAgIC8vIHdhcm4gdGhlIHVzZXIgYWJvdXQgbWFraW5n\nIHRoZSBjb2xsZWN0aW9uIHNpZGUgdGhlIG93bmVyCiAgICAgICAgICAgICAg\nICBMb2cgbG9nID0gZmllbGQuZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpOwog\nICAgICAgICAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoImNvbGwtb3duZXIi\nLCBmaWVsZCwgbWFwcGVkKSk7CiAgICAgICAgICAgICAgICBWYWx1ZU1hcHBp\nbmcgZWxlbSA9IG1hcHBlZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAg\nICAgICAgICAgRm9yZWlnbktleSBmayA9IGVsZW0uZ2V0Rm9yZWlnbktleSgp\nOwogICAgICAgICAgICAgICAgZmllbGQuc2V0Sm9pbkZvcmVpZ25LZXkoZmsp\nOwogICAgICAgICAgICAgICAgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5z\nZXRGb3JlaWduS2V5KAogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWQu\nZ2V0Sm9pbkZvcmVpZ25LZXkoKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtaW52LXJlbGF0aW9uIiwKICAgICAgICAgICAgICAgICAgICBm\naWVsZCwgbWFwcGVkKSk7CgogICAgICAgICAgICBmaWVsZC5zZXRVc2VDbGFz\nc0NyaXRlcmlhKGNyaXRlcmlhKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFVuaS0vT25lVG9NYW55L0Zv\ncmVpbmdLZXkKICAgICAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgICAgIHZhbC5nZXRWYWx1\nZUluZm8oKS5zZXRDb2x1bW5zKGZpZWxkLmdldFZhbHVlSW5mbygpLmdldENv\nbHVtbnMoKSk7CiAgICAgICAgICAgIGlmICh2YWwuZ2V0VHlwZU1hcHBpbmco\nKS5pc01hcHBlZCgpKSB7CiAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmdJ\nbmZvIHZpbmZvID0gdmFsLmdldFZhbHVlSW5mbygpOwogICAgICAgICAgICAg\nICAgRm9yZWlnbktleSBmayA9IHZpbmZvLmdldFR5cGVKb2luKHZhbCwgbnVs\nbCwgZmFsc2UsIGFkYXB0KTsKICAgICAgICAgICAgICAgIHZhbC5zZXRGb3Jl\naWduS2V5KGZrKTsKICAgICAgICAgICAgICAgIHZhbC5zZXRDb2x1bW5JTyh2\naW5mby5nZXRDb2x1bW5JTygpKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICBSZWxhdGlvblN0cmF0ZWdpZXMubWFwUmVsYXRpb25Ub1Vu\nbWFwcGVkUEModmFsLCAidmFsdWUiLCBhZGFwdCk7CgogICAgICAgICAgICB2\nYWwubWFwQ29uc3RyYWludHMoInZhbHVlIiwgYWRhcHQpOwogICAgICAgICAg\nICAKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KLyoKICAgICAgICAv\nLyB0aGlzIGlzIG5lY2Vzc2FyeSB0byBzdXBwb3J0IG9wZW5qcGEgMyBtYXBw\naW5ncywgd2hpY2ggZGlkbid0CiAgICAgICAgLy8gZGlmZmVyZW50aWF0ZSBi\nZXR3ZWVuIHNlY29uZGFyeSB0YWJsZSBqb2lucyBhbmQgcmVsYXRpb25zIGJ1\naWx0CiAgICAgICAgLy8gYXJvdW5kIGFuIGludmVyc2Uga2V5OiBjaGVjayB0\nbyBzZWUgaWYgd2UncmUgbWFwcGVkIGFzIGEgc2Vjb25kYXJ5CiAgICAgICAg\nLy8gdGFibGUgam9pbiBidXQgd2UncmUgaW4gdGhlIHRhYmxlIG9mIHRoZSBy\nZWxhdGVkIHR5cGUsIGFuZCBpZiBzbwogICAgICAgIC8vIHN3aXRjaCBvdXIg\nam9pbiBtYXBwaW5nIGluZm8gdG8gb3VyIHZhbHVlIG1hcHBpbmcgaW5mbwog\nICAgICAgIFN0cmluZyB0YWJsZU5hbWUgPSBmaWVsZC5nZXRNYXBwaW5nSW5m\nbygpLmdldFRhYmxlTmFtZSgpOwogICAgICAgIFRhYmxlIHRhYmxlID0gZmll\nbGQuZ2V0VHlwZU1hcHBpbmcoKS5nZXRUYWJsZSgpOwogICAgICAgIFZhbHVl\nTWFwcGluZ0luZm8gdmluZm8gPSBmaWVsZC5nZXRWYWx1ZUluZm8oKTsKICAg\nICAgICBpZiAodGFibGVOYW1lICE9IG51bGwgJiYgdGFibGUgIT0gbnVsbAog\nICAgICAgICAgICAmJiAodGFibGVOYW1lLmVxdWFsc0lnbm9yZUNhc2UodGFi\nbGUuZ2V0TmFtZSgpKQogICAgICAgICAgICB8fCB0YWJsZU5hbWUuZXF1YWxz\nSWdub3JlQ2FzZSh0YWJsZS5nZXRGdWxsTmFtZSgpKSkpIHsKICAgICAgICAg\nICAgdmluZm8uc2V0Sm9pbkRpcmVjdGlvbihNYXBwaW5nSW5mby5KT0lOX0lO\nVkVSU0UpOwogICAgICAgICAgICB2aW5mby5zZXRDb2x1bW5zKGZpZWxkLmdl\ndE1hcHBpbmdJbmZvKCkuZ2V0Q29sdW1ucygpKTsKICAgICAgICAgICAgZmll\nbGQuZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJsZU5hbWUobnVsbCk7CiAgICAg\nICAgICAgIGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucyhudWxs\nKTsKICAgICAgICB9CiovICAgICAgICAKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBpc1R5cGVVbmpvaW5lZFN1YmNsYXNzKFZhbHVlTWFwcGluZyBt\nYXBwZWQpIHsKICAgICAgICBDbGFzc01hcHBpbmcgZGVmID0gZmllbGQuZ2V0\nRGVmaW5pbmdNYXBwaW5nKCk7CiAgICAgICAgZm9yICg7IGRlZiAhPSBudWxs\nOyBkZWYgPSBkZWYuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkp\nCiAgICAgICAgICAgIGlmIChkZWYgPT0gbWFwcGVkLmdldFR5cGVNYXBwaW5n\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgcHJvdGVjdGVkIGJvb2xlYW4gcG9wdWxh\ndGVLZXkoUm93IHJvdywgT3BlbkpQQVN0YXRlTWFuYWdlciB2YWxzbSwKICAg\nICAgICAgICAgT2JqZWN0IG9iaiwgU3RvcmVDb250ZXh0IGN0eCwgUm93TWFu\nYWdlciBybSwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWV0YSA9IChD\nbGFzc01hcHBpbmcpdmFsc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBGaWVs\nZE1hcHBpbmcgZm0gPSBnZXRGaWVsZE1hcHBpbmcobWV0YSk7CiAgICAgICAg\naWYgKGZtID09IG51bGwpIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgTWFwIG1hcE9iaiA9IChNYXApdmFsc20uZmV0Y2hPYmplY3QoZm0u\nZ2V0SW5kZXgoKSk7CiAgICAgICAgQ29sbGVjdGlvbjxNYXAuRW50cnk+IGVu\ndHJ5U2V0cyA9IG1hcE9iai5lbnRyeVNldCgpOwogICAgICAgIGJvb2xlYW4g\nZm91bmQgPSBmYWxzZTsKICAgICAgICBmb3IgKE1hcC5FbnRyeSBlbnRyeSA6\nIGVudHJ5U2V0cykgewogICAgICAgICAgICBPYmplY3QgdmFsdWUgPSBlbnRy\neS5nZXRWYWx1ZSgpOwogICAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2Yg\nUmVmbGVjdGluZ1BlcnNpc3RlbmNlQ2FwYWJsZSkKICAgICAgICAgICAgICAg\nb2JqID0gKChSZWZsZWN0aW5nUGVyc2lzdGVuY2VDYXBhYmxlKW9iaikuZ2V0\nTWFuYWdlZEluc3RhbmNlKCk7IAogICAgICAgICAgICBpZiAodmFsdWUgPT0g\nb2JqKSB7CiAgICAgICAgICAgICAgICBSb3cgbmV3Um93ID0gKFJvdykgKChS\nb3dJbXBsKXJvdykuY2xvbmUoKTsKICAgICAgICAgICAgICAgIE9iamVjdCBr\nZXlPYmogPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIFN0cmF0\nZWd5IHN0cmF0ID0gZm0uZ2V0U3RyYXRlZ3koKTsKICAgICAgICAgICAgICAg\nIGlmIChzdHJhdCBpbnN0YW5jZW9mIEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxl\nRmllbGRTdHJhdGVneSkgewogICAgICAgICAgICAgICAgICAgIEhhbmRsZXJS\nZWxhdGlvbk1hcFRhYmxlRmllbGRTdHJhdGVneSBoclN0cmF0ID0gCiAgICAg\nICAgICAgICAgICAgICAgICAgIChIYW5kbGVyUmVsYXRpb25NYXBUYWJsZUZp\nZWxkU3RyYXRlZ3kpIHN0cmF0OwogICAgICAgICAgICAgICAgICAgIGhyU3Ry\nYXQuc2V0S2V5KGtleU9iaiwgc3RvcmUsIG5ld1Jvdyk7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGtleU9iaiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNl\nQ2FwYWJsZSkgewogICAgICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIga2V5c20gPSAKICAgICAgICAgICAgICAgICAgICAgICAgUmVsYXRp\nb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihlbnRyeS5nZXRLZXkoKSwg\nY3R4KTsKICAgICAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcga2V5ID0g\nZm0uZ2V0S2V5TWFwcGluZygpOwogICAgICAgICAgICAgICAgICAgIGlmIChr\nZXlzbSAhPSBudWxsKSAKICAgICAgICAgICAgICAgICAgICAgICAga2V5LnNl\ndEZvcmVpZ25LZXkobmV3Um93LCBrZXlzbSk7CiAgICAgICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBrZXkuc2V0Rm9yZWln\nbktleShuZXdSb3csIG51bGwpOwogICAgICAgICAgICAgICAgfSAKICAgICAg\nICAgICAgICAgIHJtLmZsdXNoU2Vjb25kYXJ5Um93KG5ld1Jvdyk7CiAgICAg\nICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgaWYgKGZvdW5kKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICByZXR1cm4gZmFsc2U7ICAgICAgICAKICAgIH0KCiAgICBw\ncml2YXRlIEZpZWxkTWFwcGluZyBnZXRGaWVsZE1hcHBpbmcoQ2xhc3NNYXBw\naW5nIG1ldGEpIHsKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBt\nZXRhLmdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBWYWx1\nZU1hcHBpbmcgdmFsID0gZmllbGRzW2ldLmdldFZhbHVlTWFwcGluZygpOwog\nICAgICAgICAgICBpZiAoZmllbGRzW2ldLmdldE1hcHBlZEJ5TWV0YURhdGEo\nKSA9PSBmaWVsZCAmJiAKICAgICAgICAgICAgICAgICAgICB2YWwuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5NQVApCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmllbGRzW2ldOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KfQo=\n","encoding":"base64"}

