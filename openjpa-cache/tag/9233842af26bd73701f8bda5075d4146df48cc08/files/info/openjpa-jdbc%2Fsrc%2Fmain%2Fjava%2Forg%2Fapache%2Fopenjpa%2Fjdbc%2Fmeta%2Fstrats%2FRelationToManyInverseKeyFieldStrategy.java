{"sha":"9ed2a303aa121765b120f0da4cb9b72846d6ab04","node_id":"MDQ6QmxvYjIwNjM2NDo5ZWQyYTMwM2FhMTIxNzY1YjEyMGYwZGE0Y2I5YjcyODQ2ZDZhYjA0","size":15264,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9ed2a303aa121765b120f0da4cb9b72846d6ab04","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5K\nREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZ0luZm87\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFw\ncGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFs\ndWVNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkNoYW5nZVRyYWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuUHJveGllczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlByb3h5OwoKLyoqCiAqIE1hcHMgYSByZWxhdGlvbiB0byBh\nIHNldCBvZiBvdGhlciBvYmplY3RzIHVzaW5nIGFuIGludmVyc2UKICogZm9y\nZWlnbiBrZXkgaW4gdGhlIHJlbGF0ZWQgb2JqZWN0IHRhYmxlLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIFJl\nbGF0aW9uVG9NYW55SW52ZXJzZUtleUZpZWxkU3RyYXRlZ3kKICAgIGV4dGVu\nZHMgU3RvcmVDb2xsZWN0aW9uRmllbGRTdHJhdGVneSB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChSZWxhdGlvblRvTWFueUludmVyc2VLZXlGaWVs\nZFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwcml2YXRlIGJvb2xlYW4gX29yZGVy\nSW5zZXJ0ID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX29yZGVyVXBk\nYXRlID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3VuaTFNRksgPSBm\nYWxzZTsKCiAgICBwcm90ZWN0ZWQgQ2xhc3NNYXBwaW5nW10gZ2V0SW5kZXBl\nbmRlbnRFbGVtZW50TWFwcGluZ3MoYm9vbGVhbiB0cmF2ZXJzZSkgewogICAg\nICAgIHJldHVybiBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldEluZGVw\nZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICB9CgogICAgcHJvdGVjdGVkIEZv\ncmVpZ25LZXkgZ2V0Sm9pbkZvcmVpZ25LZXkoQ2xhc3NNYXBwaW5nIGVsZW0p\nIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5n\nZXRGb3JlaWduS2V5KGVsZW0pOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lk\nIHNlbGVjdEVsZW1lbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGVsZW0s\nCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlLAogICAgICAgIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgc2VsLnNlbGVjdChlbGVtLCBmaWVsZC5nZXRFbGVtZW50\nTWFwcGluZygpLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwKICAgICAgICAgICAg\nc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIGpvaW5zKTsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgT2JqZWN0IGxvYWRFbGVtZW50KE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzLCBKb2lucyBqb2lucykKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBp\nbmcgZWxlbSA9IHJlcy5nZXRCYXNlTWFwcGluZygpOwogICAgICAgIGlmIChl\nbGVtID09IG51bGwpCiAgICAgICAgICAgIGVsZW0gPSBmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKClbMF07\nCiAgICAgICAgcmV0dXJuIHJlcy5sb2FkKGVsZW0sIHN0b3JlLCBmZXRjaCwg\nam9pbnMpOwogICAgfQoKICAgIHByb3RlY3RlZCBKb2lucyBqb2luKEpvaW5z\nIGpvaW5zLCBDbGFzc01hcHBpbmcgZWxlbSkgewogICAgICAgIFZhbHVlTWFw\ncGluZyB2bSA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAg\nRm9yZWlnbktleSBmayA9IHZtLmdldEZvcmVpZ25LZXkoZWxlbSk7CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG93bmVyID0gZmllbGQuZ2V0RGVmaW5pbmdNYXBw\naW5nKCk7CiAgICAgICAgd2hpbGUgKGZrLmdldFByaW1hcnlLZXlUYWJsZSgp\nICE9IG93bmVyLmdldFRhYmxlKCkpIHsKICAgICAgICAgICAgam9pbnMgPSBv\nd25lci5qb2luU3VwZXJjbGFzcyhqb2lucywgZmFsc2UpOwogICAgICAgICAg\nICBvd25lciA9IG93bmVyLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpOyAKICAgICAgICAgICAgaWYgKG93bmVyID09IG51bGwpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW5SZWxhdGlvbihmaWVsZC5n\nZXROYW1lKCksIGZrLCBlbGVtLCAKICAgICAgICAgICAgdm0uZ2V0U2VsZWN0\nU3ViY2xhc3NlcygpLCB0cnVlLCB0cnVlKTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgSm9pbnMgam9pbkVsZW1lbnRSZWxhdGlvbihKb2lucyBqb2lucywgQ2xh\nc3NNYXBwaW5nIGVsZW0pIHsKICAgICAgICByZXR1cm4gam9pblJlbGF0aW9u\nKGpvaW5zLCBmYWxzZSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIG1hcChib29sZWFuIGFkYXB0KSB7CiAgICAgICAgT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24gY29uZiA9IGZpZWxkLmdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgYm9vbGVhbiBpc05vbkRlZmF1bHRNYXBwaW5n\nQWxsb3dlZCA9IGZpZWxkLmdldFJlcG9zaXRvcnkoKS4KICAgICAgICAgICAg\nZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS5pc05vbkRlZmF1\nbHRNYXBwaW5nQWxsb3dlZChjb25mKTsKICAgICAgICBGaWVsZE1hcHBpbmcg\nbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVkQnlNYXBwaW5nKCk7CgogICAgICAg\nIC8vIEpQQSAyLjAgYWxsb3dzIG5vbi1kZWZhdWx0IG1hcHBpbmc6IFVuaS0v\nMS1NL0BKb2luQ29sdW1uID09PiBmb3JlaWduIGtleSBzdHJhdGVneQogICAg\nICAgIC8vIEJpLS8xLU0vQEpvaW5Db2x1bW4gc2hvdWxkIHJlc3VsdCBpbiBl\neGNlcHRpb24gCiAgICAgICAgaWYgKCFpc05vbkRlZmF1bHRNYXBwaW5nQWxs\nb3dlZCB8fCBtYXBwZWQgIT0gbnVsbCkgewogICAgICAgICAgICBmaWVsZC5n\nZXRWYWx1ZUluZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBvbmVudHMoZmllbGQs\nICFhZGFwdCk7CiAgICAgICAgfQogICAgICAgIGZpZWxkLmdldEtleU1hcHBp\nbmcoKS5nZXRWYWx1ZUluZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBvbmVudHMK\nICAgICAgICAgICAgKGZpZWxkLmdldEtleSgpLCAhYWRhcHQpOwoKICAgICAg\nICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5n\nKCk7CiAgICAgICAgaWYgKGVsZW0uZ2V0VHlwZUNvZGUoKSAhPSBKYXZhVHlw\nZXMuUEMgfHwgZWxlbS5pc0VtYmVkZGVkUEMoKQogICAgICAgICAgICB8fCAh\nZWxlbS5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVs\nZW0tcmVsYXRpb24iLCBmaWVsZCkpOwoKICAgICAgICAvLyBjaGVjayBmb3Ig\nbmFtZWQgaW52ZXJzZQogICAgICAgIEZpZWxkTWFwcGluZ0luZm8gZmluZm8g\nPSBmaWVsZC5nZXRNYXBwaW5nSW5mbygpOwogICAgICAgIFZhbHVlTWFwcGlu\nZ0luZm8gdmluZm8gPSBlbGVtLmdldFZhbHVlSW5mbygpOwogICAgICAgIGJv\nb2xlYW4gY3JpdGVyaWEgPSB2aW5mby5nZXRVc2VDbGFzc0NyaXRlcmlhKCk7\nCiAgICAgICAgaWYgKG1hcHBlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIG1h\ncHBlZC5yZXNvbHZlKG1hcHBlZC5NT0RFX01FVEEgfCBtYXBwZWQuTU9ERV9N\nQVBQSU5HKTsKICAgICAgICAgICAgaWYgKCEobWFwcGVkLmdldFN0cmF0ZWd5\nKCkgaW5zdGFuY2VvZiBSZWxhdGlvbkZpZWxkU3RyYXRlZ3kpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtaW52LXJlbGF0aW9uIiwKICAgICAgICAgICAgICAgICAgICBmaWVs\nZCwgbWFwcGVkKSk7CiAgICAgICAgICAgIHZpbmZvLmFzc2VydE5vU2NoZW1h\nQ29tcG9uZW50cyhlbGVtLCAhYWRhcHQpOwogICAgICAgICAgICBlbGVtLnNl\ndEZvcmVpZ25LZXkobWFwcGVkLmdldEZvcmVpZ25LZXkKICAgICAgICAgICAg\nICAgIChmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSkpOwogICAgICAgICAg\nICBlbGVtLnNldENvbHVtbnMobWFwcGVkLmdldERlZmluaW5nTWFwcGluZygp\nLgogICAgICAgICAgICAgICAgZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAg\nICAgICAgICAgIGVsZW0uc2V0Sm9pbkRpcmVjdGlvbihWYWx1ZU1hcHBpbmcu\nSk9JTl9FWFBFQ1RFRF9JTlZFUlNFKTsKICAgICAgICAgICAgZWxlbS5zZXRV\nc2VDbGFzc0NyaXRlcmlhKGNyaXRlcmlhKTsKCiAgICAgICAgICAgIEZvcmVp\nZ25LZXkgZmsgPSBtYXBwZWQuZ2V0Rm9yZWlnbktleSgpOwogICAgICAgICAg\nICAvKiogRm9yZWlnbiBrZXkgbWF5IGJlIG51bGwgaWYgZGVjbGFyZWQgdHlw\nZSBvZiB0aGUgbWFwcGVkIGZpZWxkIGlzIAogICAgICAgICAgICAgKiBhYnN0\ncmFjdCBhbmQgdW5kZXIgdGFibGUtcGVyLWNsYXNzIGluaGVyaXRhbmNlIHN0\ncmF0ZWd5IHdpbGwgaGF2ZQogICAgICAgICAgICAgKiBubyBtYXBwZWQgdGFi\nbGUuICAKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGlmIChmayAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIAlmaWVsZC5zZXRPcmRlckNvbHVtbihmaW5m\nby5nZXRPcmRlckNvbHVtbihmaWVsZCwKICAgICAgICAgICAgCQkJZmsuZ2V0\nVGFibGUoKSwgYWRhcHQpKTsKICAgICAgICAgICAgCWZpZWxkLnNldE9yZGVy\nQ29sdW1uSU8oZmluZm8uZ2V0Q29sdW1uSU8oKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7IAogICAgICAg\nICAgICBpZiAoZmllbGQuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpLnNp\nemUoKSA+IDAgJiYgCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRBY2Nlc3NU\neXBlKCkgPT0gRmllbGRNZXRhRGF0YS5PTkVfVE9fTUFOWSkgewogICAgICAg\nICAgICAgICAgX3VuaTFNRksgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBtYXAgaW52ZXJzZSBmb3JlaWduIGtleSBpbiBy\nZWxhdGVkIHRhYmxlCiAgICAgICAgRm9yZWlnbktleSBmayA9IHZpbmZvLmdl\ndEludmVyc2VUeXBlSm9pbihlbGVtLCBmaWVsZC5nZXROYW1lKCksIGFkYXB0\nKTsKICAgICAgICBpZiAoX3VuaTFNRkspIHsKICAgICAgICAgICAgQ29sdW1u\nW10gbG9jYWxzID0gZmsuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGxvY2Fscy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIGxvY2Fsc1tpXS5zZXRVbmkxTUZLKHRydWUpOwogICAgICAgIH0K\nICAgICAgICBlbGVtLnNldEZvcmVpZ25LZXkoZmspOwogICAgICAgIGVsZW0u\nc2V0Q29sdW1uSU8odmluZm8uZ2V0Q29sdW1uSU8oKSk7CiAgICAgICAgZWxl\nbS5zZXRDb2x1bW5zKGVsZW0uZ2V0VHlwZU1hcHBpbmcoKS5nZXRQcmltYXJ5\nS2V5Q29sdW1ucygpKTsKICAgICAgICBlbGVtLnNldEpvaW5EaXJlY3Rpb24o\nVmFsdWVNYXBwaW5nLkpPSU5fRVhQRUNURURfSU5WRVJTRSk7CiAgICAgICAg\nZWxlbS5zZXRVc2VDbGFzc0NyaXRlcmlhKGNyaXRlcmlhKTsKICAgICAgICBl\nbGVtLm1hcENvbnN0cmFpbnRzKGZpZWxkLmdldE5hbWUoKSwgYWRhcHQpOwoK\nICAgICAgICBmaWVsZC5zZXRPcmRlckNvbHVtbihmaW5mby5nZXRPcmRlckNv\nbHVtbihmaWVsZCwgZmsuZ2V0VGFibGUoKSwKICAgICAgICAgICAgYWRhcHQp\nKTsKICAgICAgICBmaWVsZC5zZXRPcmRlckNvbHVtbklPKGZpbmZvLmdldENv\nbHVtbklPKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUo\nKSB7CiAgICAgICAgQ29sdW1uIG9yZGVyID0gZmllbGQuZ2V0T3JkZXJDb2x1\nbW4oKTsKICAgICAgICBfb3JkZXJJbnNlcnQgPSBmaWVsZC5nZXRPcmRlckNv\nbHVtbklPKCkuaXNJbnNlcnRhYmxlKG9yZGVyLCBmYWxzZSk7CiAgICAgICAg\nX29yZGVyVXBkYXRlID0gZmllbGQuZ2V0T3JkZXJDb2x1bW5JTygpLmlzVXBk\nYXRhYmxlKG9yZGVyLCBmYWxzZSk7CgogICAgICAgIFZhbHVlTWFwcGluZyBl\nbGVtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBMb2cg\nbG9nID0gZmllbGQuZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpOwogICAgICAg\nIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpID09IG51bGwKICAgICAgICAgICAg\nJiYgZWxlbS5nZXRVc2VDbGFzc0NyaXRlcmlhKCkgJiYgbG9nLmlzV2FybkVu\nYWJsZWQoKSkgewogICAgICAgICAgICBGb3JlaWduS2V5IGZrID0gZWxlbS5n\nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgICAgIGlmIChlbGVtLmdldENvbHVt\nbklPKCkuaXNBbnlVcGRhdGFibGUoZmssIGZhbHNlKSkKICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJjbGFzcy1jcml0LW93bmVyIiwgZmll\nbGQpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5zZXJ0\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93\nTWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoZmllbGQuZ2V0TWFwcGVkQnkoKSA9PSBudWxsIHx8IF9vcmRl\nckluc2VydCB8fCBfb3JkZXJVcGRhdGUpCiAgICAgICAgICAgIGluc2VydChz\nbSwgcm0sIHNtLmZldGNoT2JqZWN0KGZpZWxkLmdldEluZGV4KCkpKTsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIFJvd01hbmFnZXIgcm0sIE9iamVjdCB2YWxzKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBw\nZWRCeSgpICE9IG51bGwgJiYgIV9vcmRlckluc2VydCAmJiAhX29yZGVyVXBk\nYXRlKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ29sbGVjdGlvbiBj\nb2xsID0gdG9Db2xsZWN0aW9uKHZhbHMpOwogICAgICAgIGlmIChjb2xsID09\nIG51bGwgfHwgY29sbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbCA9IGZpZWxkLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBpbnQgaWR4ID0g\nMDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNvbGwuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTsgaWR4KyspCiAgICAgICAgICAgIHVwZGF0ZUlu\ndmVyc2Uoc20uZ2V0Q29udGV4dCgpLCBpdHIubmV4dCgpLCByZWwsIHJtLCBz\nbSwgaWR4KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2Vy\nIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChmaWVsZC5nZXRNYXBwZWRCeSgpICE9IG51bGwgJiYgIV9vcmRlckluc2Vy\ndCAmJiAhX29yZGVyVXBkYXRlKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIE9iamVjdCBvYmogPSBzbS5mZXRjaE9iamVjdChmaWVsZC5nZXRJbmRl\neCgpKTsKICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gbnVsbDsKICAgICAg\nICBpZiAob2JqIGluc3RhbmNlb2YgUHJveHkpIHsKICAgICAgICAgICAgUHJv\neHkgcHJveHkgPSAoUHJveHkpIG9iajsKICAgICAgICAgICAgaWYgKFByb3hp\nZXMuaXNPd25lcihwcm94eSwgc20sIGZpZWxkLmdldEluZGV4KCkpKQogICAg\nICAgICAgICAgICAgY3QgPSBwcm94eS5nZXRDaGFuZ2VUcmFja2VyKCk7CiAg\nICAgICAgfQogICAgICAgIENvbHVtbiBvcmRlciA9IGZpZWxkLmdldE9yZGVy\nQ29sdW1uKCk7CgogICAgICAgIC8vIGlmIG5vIGZpbmUtZ3JhaW5lZCBjaGFu\nZ2UgdHJhY2tpbmcgdGhlbiBqdXN0IGRlbGV0ZSBhbmQgcmVpbnNlcnQKICAg\nICAgICAvLyBpZiBubyBmaW5lLWdyYWluZWQgY2hhbmdlIHRyYWNraW5nIG9y\nIGlmIGFuIGl0ZW0gd2FzIHJlbW92ZWQKICAgICAgICAvLyBmcm9tIGFuIG9y\nZGVyZWQgY29sbGVjdGlvbiwgZGVsZXRlIGFuZCByZWluc2VydAogICAgICAg\nIGlmIChjdCA9PSBudWxsIHx8ICFjdC5pc1RyYWNraW5nKCkgfHwKICAgICAg\nICAgICAgKG9yZGVyICE9IG51bGwgJiYgIWN0LmdldFJlbW92ZWQoKS5pc0Vt\ncHR5KCkpKSB7CiAgICAgICAgICAgIGRlbGV0ZShzbSwgc3RvcmUsIHJtKTsK\nICAgICAgICAgICAgaW5zZXJ0KHNtLCBybSwgb2JqKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gbnVsbCBpbnZlcnNlIGNv\nbHVtbnMgZm9yIGRlbGV0ZXMgYW5kIHVwZGF0ZSB0aGVtIHdpdGggb3VyIG9p\nZCBmb3IKICAgICAgICAvLyBpbnNlcnRzCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHJlbCA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBp\nbmcoKTsKICAgICAgICBTdG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29u\ndGV4dCgpOwogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpID09IG51\nbGwpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiByZW0gPSBjdC5nZXRSZW1v\ndmVkKCk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcmVtLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgdXBk\nYXRlSW52ZXJzZShjdHgsIGl0ci5uZXh0KCksIHJlbCwgcm0sIG51bGwsIDAp\nOwogICAgICAgIH0KCiAgICAgICAgQ29sbGVjdGlvbiBhZGQgPSBjdC5nZXRB\nZGRlZCgpOwogICAgICAgIGludCBzZXEgPSBjdC5nZXROZXh0U2VxdWVuY2Uo\nKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFkZC5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOyBzZXErKykKICAgICAgICAgICAgdXBkYXRlSW52\nZXJzZShjdHgsIGl0ci5uZXh0KCksIHJlbCwgcm0sIHNtLCBzZXEpOwogICAg\nICAgIGlmIChvcmRlciAhPSBudWxsKQogICAgICAgICAgICBjdC5zZXROZXh0\nU2VxdWVuY2Uoc2VxKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZWxldGUo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dN\nYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgbnVsbGFibGUsIG51bGwgYW55\nIGV4aXN0aW5nIGludmVyc2UgY29sdW1ucyB0aGF0IHJlZmVyIHRvIHRoaXMg\nb2JqCiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpOwogICAgICAgIENvbHVtbklPIGlvID0gZWxlbS5nZXRD\nb2x1bW5JTygpOwogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBlbGVtLmdldEZv\ncmVpZ25LZXkoKTsKICAgICAgICBpZiAoIWVsZW0uZ2V0VXNlQ2xhc3NDcml0\nZXJpYSgpICYmIGlvLmlzQW55VXBkYXRhYmxlKGZrLCB0cnVlKSkgeyAKICAg\nICAgICAgICAgYXNzZXJ0SW52ZXJzYWJsZSgpOwogICAgICAgICAgICBSb3cg\ncm93ID0gcm0uZ2V0QWxsUm93cyhmay5nZXRUYWJsZSgpLCBSb3cuQUNUSU9O\nX1VQREFURSk7CiAgICAgICAgICAgIHJvdy5zZXRGb3JlaWduS2V5KGZrLCBp\nbywgbnVsbCk7CiAgICAgICAgICAgIHJvdy53aGVyZUZvcmVpZ25LZXkoZmss\nIHNtKTsKICAgICAgICAgICAgcm0uZmx1c2hBbGxSb3dzKHJvdyk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghc20uZ2V0\nTG9hZGVkKCkuZ2V0KGZpZWxkLmdldEluZGV4KCkpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIC8vIHVwZGF0ZSBmayBvbiBlYWNoIGZpZWxkIHZh\nbHVlIHJvdwogICAgICAgIENsYXNzTWFwcGluZyByZWwgPSBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgU3Rv\ncmVDb250ZXh0IGN0eCA9IHN0b3JlLmdldENvbnRleHQoKTsKICAgICAgICBD\nb2xsZWN0aW9uIG9ianMgPSB0b0NvbGxlY3Rpb24oc20uZmV0Y2hPYmplY3Qo\nZmllbGQuZ2V0SW5kZXgoKSkpOwogICAgICAgIGlmIChvYmpzICE9IG51bGwg\nJiYgIW9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICB1cGRhdGVJbnZlcnNlIChjdHgsIGl0ci5uZXh0KCksIHJl\nbCwgcm0sIHNtLCAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIHVwZGF0ZXMgdGhlIGludmVyc2UgY29sdW1ucyBvZiBhIDEtTSByZWxh\ndGVkIG9iamVjdAogICAgICogd2l0aCB0aGUgZ2l2ZW4gb2lkLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgdXBkYXRlSW52ZXJzZShTdG9yZUNvbnRleHQg\nY3R4LCBPYmplY3QgaW52ZXJzZSwKICAgICAgICBDbGFzc01hcHBpbmcgcmVs\nLCBSb3dNYW5hZ2VyIHJtLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBpbnQg\naWR4KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgaW52c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMu\nZ2V0U3RhdGVNYW5hZ2VyKGludmVyc2UsCiAgICAgICAgICAgIGN0eCk7CiAg\nICAgICAgaWYgKGludnNtID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50\nTWFwcGluZygpOwogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBlbGVtLmdldEZv\ncmVpZ25LZXkoKTsKICAgICAgICBDb2x1bW5JTyBpbyA9IGVsZW0uZ2V0Q29s\ndW1uSU8oKTsKICAgICAgICBDb2x1bW4gb3JkZXIgPSBmaWVsZC5nZXRPcmRl\nckNvbHVtbigpOwoKICAgICAgICBpbnQgYWN0aW9uOwogICAgICAgIGJvb2xl\nYW4gd3JpdGVhYmxlOwogICAgICAgIGJvb2xlYW4gb3JkZXJXcml0ZWFibGU7\nCiAgICAgICAgaWYgKGludnNtLmlzTmV3KCkgJiYgIWludnNtLmlzRmx1c2hl\nZCgpKSB7CiAgICAgICAgICAgIC8vIG5vIG5lZWQgdG8gbnVsbCBpbnZlcnNl\nIGNvbHVtbnMgb2YgbmV3IGluc3RhbmNlCiAgICAgICAgICAgIGlmIChzbSA9\nPSBudWxsIHx8IHNtLmlzRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB3cml0ZWFibGUgPSBpby5pc0FueUluc2VydGFi\nbGUoZmssIGZhbHNlKTsKICAgICAgICAgICAgb3JkZXJXcml0ZWFibGUgPSBf\nb3JkZXJJbnNlcnQ7CiAgICAgICAgICAgIGFjdGlvbiA9IFJvdy5BQ1RJT05f\nSU5TRVJUOwogICAgICAgIH0gZWxzZSBpZiAoaW52c20uaXNEZWxldGVkKCkp\nIHsKICAgICAgICAgICAgLy8gbm8gbmVlZCB0byBudWxsIGludmVyc2UgY29s\ndW1ucyBvZiBkZWxldGVkIGluc3RhbmNlCiAgICAgICAgICAgIGlmIChpbnZz\nbS5pc0ZsdXNoZWQoKSB8fCBzbSA9PSBudWxsIHx8ICFzbS5pc0RlbGV0ZWQo\nKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgd3JpdGVh\nYmxlID0gdHJ1ZTsKICAgICAgICAgICAgb3JkZXJXcml0ZWFibGUgPSBmYWxz\nZTsKICAgICAgICAgICAgYWN0aW9uID0gUm93LkFDVElPTl9ERUxFVEU7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYg\nc20uaXNEZWxldGVkKCkpCiAgICAgICAgICAgICAgICBzbSA9IG51bGw7CiAg\nICAgICAgICAgIHdyaXRlYWJsZSA9IGlvLmlzQW55VXBkYXRhYmxlKGZrLCBz\nbSA9PSBudWxsKTsKICAgICAgICAgICAgb3JkZXJXcml0ZWFibGUgPSBmaWVs\nZC5nZXRPcmRlckNvbHVtbklPKCkuaXNVcGRhdGFibGUKICAgICAgICAgICAg\nICAgIChvcmRlciwgc20gPT0gbnVsbCk7CiAgICAgICAgICAgIGFjdGlvbiA9\nIFJvdy5BQ1RJT05fVVBEQVRFOwogICAgICAgIH0KICAgICAgICBpZiAoIXdy\naXRlYWJsZSAmJiAhb3JkZXJXcml0ZWFibGUpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgYXNzZXJ0SW52ZXJzYWJsZSgpOwoKICAgICAgICAvLyBp\nZiB0aGlzIGlzIGFuIHVwZGF0ZSwgdGhpcyBtaWdodCBiZSB0aGUgb25seSBt\nb2QgdG8gdGhlIHJvdywgc28KICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHdo\nZXJlIGNvbmRpdGlvbiBpcyBzZXQKICAgICAgICBSb3cgcm93ID0gcm0uZ2V0\nUm93KGZrLmdldFRhYmxlKCksIGFjdGlvbiwgaW52c20sIHRydWUpOwogICAg\nICAgIGlmIChhY3Rpb24gPT0gUm93LkFDVElPTl9VUERBVEUpCiAgICAgICAg\nICAgIHJvdy53aGVyZVByaW1hcnlLZXkoaW52c20pOwoKICAgICAgICAvLyB1\ncGRhdGUgdGhlIGludmVyc2UgcG9pbnRlciB3aXRoIG91ciBvaWQgdmFsdWUK\nICAgICAgICBpZiAod3JpdGVhYmxlKQogICAgICAgICAgICByb3cuc2V0Rm9y\nZWlnbktleShmaywgaW8sIHNtKTsKICAgICAgICBpZiAob3JkZXJXcml0ZWFi\nbGUpCiAgICAgICAgICAgIHJvdy5zZXRJbnQob3JkZXIsIGlkeCk7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCB0b0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2\nYWwsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIENsYXNzTWFwcGluZyBj\nbSA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmco\nKTsKICAgICAgICByZXR1cm4gY20udG9EYXRhU3RvcmVWYWx1ZSh2YWwsIGNt\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCksIHN0b3JlKTsKICAgIH0KCiAgICBw\ndWJsaWMgSm9pbnMgam9pbihKb2lucyBqb2lucywgYm9vbGVhbiBmb3JjZU91\ndGVyKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpOwogICAgICAgIENsYXNzTWFwcGluZ1tdIGNsc3Mg\nPSBlbGVtLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICAgICAg\naWYgKGNsc3MubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0\naW9uU3RyYXRlZ2llcy51bmpvaW5hYmxlKGVsZW0pOwogICAgICAgIGlmIChm\nb3JjZU91dGVyKQogICAgICAgICAgICByZXR1cm4gam9pbnMub3V0ZXJKb2lu\nUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLCAKICAgICAgICAgICAgICAgIGVs\nZW0uZ2V0Rm9yZWlnbktleShjbHNzWzBdKSwgY2xzc1swXSwKICAgICAgICAg\nICAgICAgIGVsZW0uZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCB0cnVlLCB0cnVl\nKTsKICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxkLmdl\ndE5hbWUoKSwgZWxlbS5nZXRGb3JlaWduS2V5KGNsc3NbMF0pLAogICAgICAg\nICAgICBjbHNzWzBdLCBlbGVtLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwgdHJ1\nZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFzc2VydEludmVy\nc2FibGUoKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5n\nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGlmIChlbGVtLmdldEluZGVw\nZW5kZW50VHlwZU1hcHBpbmdzKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAg\nIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmludmVyc2FibGUoZWxlbSk7\nCiAgICB9Cn0K\n","encoding":"base64"}

