{"sha":"55514b0ce4ada874f90419321d4a00c0632d47fd","node_id":"MDQ6QmxvYjIwNjM2NDo1NTUxNGIwY2U0YWRhODc0ZjkwNDE5MzIxZDRhMDBjMDYzMmQ0N2Zk","size":11552,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/55514b0ce4ada874f90419321d4a00c0632d47fd","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5K\nREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZ0luZm87\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFw\ncGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFs\ndWVNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlJvd01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5P\ncGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuQ2hhbmdlVHJhY2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuUHJveGllczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlByb3h5OwoKLyoqCiAqIE1hcHMgYSBzZXQgb2YgcmVsYXRlZCBv\nYmplY3RzIHRocm91Z2ggYW4gYXNzb2NpYXRpb24gdGFibGUuCiAqCiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgUmVs\nYXRpb25Ub01hbnlUYWJsZUZpZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgU3Rv\ncmVDb2xsZWN0aW9uRmllbGRTdHJhdGVneSB7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChSZWxhdGlvblRvTWFueVRhYmxlRmllbGRTdHJhdGVneS5j\nbGFzcyk7CgogICAgcHJvdGVjdGVkIENsYXNzTWFwcGluZ1tdIGdldEluZGVw\nZW5kZW50RWxlbWVudE1hcHBpbmdzKGJvb2xlYW4gdHJhdmVyc2UpIHsKICAg\nICAgICByZXR1cm4gKHRyYXZlcnNlKQogICAgICAgICAgICA/IGZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCkuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3Mo\nKQogICAgICAgICAgICA6IENsYXNzTWFwcGluZy5FTVBUWV9NQVBQSU5HUzsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgRm9yZWlnbktleSBnZXRKb2luRm9yZWln\nbktleShDbGFzc01hcHBpbmcgZWxlbSkgewogICAgICAgIHJldHVybiBmaWVs\nZC5nZXRKb2luRm9yZWlnbktleSgpOwogICAgfQoKICAgIHByb3RlY3RlZCB2\nb2lkIHNlbGVjdEVsZW1lbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGVs\nZW0sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlLAogICAgICAgIEpvaW5zIGpv\naW5zKSB7CiAgICAgICAgc2VsLnNlbGVjdChlbGVtLCBmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwKICAgICAgICAg\nICAgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIGpvaW5zKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgT2JqZWN0IGxvYWRFbGVtZW50KE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzLCBKb2lucyBqb2lucykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01h\ncHBpbmcgZWxlbSA9IHJlcy5nZXRCYXNlTWFwcGluZygpOwogICAgICAgIGlm\nIChlbGVtID09IG51bGwpCiAgICAgICAgICAgIGVsZW0gPSBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKClb\nMF07CiAgICAgICAgcmV0dXJuIHJlcy5sb2FkKGVsZW0sIHN0b3JlLCBmZXRj\naCwgam9pbnMpOwogICAgfQoKICAgIHByb3RlY3RlZCBKb2lucyBqb2luKEpv\naW5zIGpvaW5zLCBDbGFzc01hcHBpbmcgZWxlbSkgewogICAgICAgIHJldHVy\nbiBqb2luKGpvaW5zLCBmYWxzZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIEpv\naW5zIGpvaW5FbGVtZW50UmVsYXRpb24oSm9pbnMgam9pbnMsIENsYXNzTWFw\ncGluZyBlbGVtKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIHZtID0gZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gam9pbnMuam9p\nblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwgdm0uZ2V0Rm9yZWlnbktleShl\nbGVtKSwgCiAgICAgICAgICAgIGVsZW0sIHZtLmdldFNlbGVjdFN1YmNsYXNz\nZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBt\nYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGZpZWxkLmdldFZhbHVlSW5m\nbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsK\nICAgICAgICBmaWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCku\nYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzCiAgICAgICAgICAgIChmaWVsZC5n\nZXRLZXkoKSwgIWFkYXB0KTsKCiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0g\nPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGlmIChlbGVt\nLmdldFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlBDIHx8IGVsZW0uaXNFbWJl\nZGRlZFBDKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm90LWVsZW0tcmVsYXRpb24iLCBmaWVsZCkpOwoK\nICAgICAgICAvLyBjaGVjayBmb3IgbmFtZWQgaW52ZXJzZQogICAgICAgIEZp\nZWxkTWFwcGluZyBtYXBwZWQgPSBmaWVsZC5nZXRNYXBwZWRCeU1hcHBpbmco\nKTsKICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZvID0gZWxlbS5nZXRW\nYWx1ZUluZm8oKTsKICAgICAgICBib29sZWFuIGNyaXRlcmlhID0gdmluZm8u\nZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpOwoKICAgICAgICBPcGVuSlBBQ29uZmln\ndXJhdGlvbiBjb25mID0gZmllbGQuZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICBib29sZWFuIGlzTm9uRGVmYXVsdE1hcHBp\nbmdBbGxvd2VkID0gZmllbGQuZ2V0UmVwb3NpdG9yeSgpLgogICAgICAgICAg\nICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpLmlzTm9uRGVm\nYXVsdE1hcHBpbmdBbGxvd2VkKGNvbmYpOwogICAgICAgIC8vIEJpLWRpcmVj\ndGlvbmFsIG9uZVRvTWFueSByZWxhdGlvbiB3aXRoIGpvaW4gdGFibGUgc3Ry\nYXRlZ3kKICAgICAgICAvLyA9PT4gc2hvdWxkIG5vdCBtYXBwZWQgaW4gdGhl\nIG93bmVyJ3MgdGFibGUKICAgICAgICBpZiAobWFwcGVkICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKCFmaWVsZC5pc0JpTVRvMUpUKCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChtYXBwZWQuZ2V0RWxlbWVudCgpLmdldFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLlBDKSB7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtaW52LXJl\nbGF0aW9uLWNvbGwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmll\nbGQsIG1hcHBlZCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBv\nbmVudHMoZmllbGQsICFhZGFwdCk7CiAgICAgICAgICAgICAgICB2aW5mby5h\nc3NlcnROb1NjaGVtYUNvbXBvbmVudHMoZWxlbSwgIWFkYXB0KTsKCiAgICAg\nICAgICAgICAgICBtYXBwZWQucmVzb2x2ZShtYXBwZWQuTU9ERV9NRVRBIHwg\nbWFwcGVkLk1PREVfTUFQUElORyk7CiAgICAgICAgICAgICAgICBpZiAoIW1h\ncHBlZC5pc01hcHBlZCgpIHx8IG1hcHBlZC5pc1NlcmlhbGl6ZWQoKSkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm1hcHBlZC1ieS11bm1hcHBlZCIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmaWVsZCwgbWFwcGVkKSk7CiAgICAgICAgICAgICAg\nICBmaWVsZC5zZXRKb2luRm9yZWlnbktleShtYXBwZWQuZ2V0RWxlbWVudE1h\ncHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Rm9yZWlnbktl\neShmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSkpOwogICAgICAgICAgICAg\nICAgZWxlbS5zZXRGb3JlaWduS2V5KG1hcHBlZC5nZXRKb2luRm9yZWlnbktl\neSgpKTsKICAgICAgICAgICAgICAgIGVsZW0uc2V0VXNlQ2xhc3NDcml0ZXJp\nYShjcml0ZXJpYSk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRPcmRlckNv\nbHVtbihtYXBwZWQuZ2V0T3JkZXJDb2x1bW4oKSk7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nIChtYXBwZWQgPT0gbnVsbCB8fCBmaWVsZC5pc0JpTVRvMUpUKCkpIHsKICAg\nICAgICAgICAgaWYgKGZpZWxkLmlzQmlNVG8xSlQoKSkKICAgICAgICAgICAg\nICAgIGZpZWxkLnNldEJpMU1Kb2luVGFibGVJbmZvKCk7CiAgICAgICAgICAg\nIGZpZWxkLm1hcEpvaW4oYWRhcHQsIHRydWUpOwogICAgICAgICAgICBpZiAo\nZWxlbS5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkpIHsKICAgICAgICAg\nICAgICAgIEZvcmVpZ25LZXkgZmsgPSB2aW5mby5nZXRUeXBlSm9pbihlbGVt\nLCAiZWxlbWVudCIsIGZhbHNlLCBhZGFwdCk7CiAgICAgICAgICAgICAgICBl\nbGVtLnNldEZvcmVpZ25LZXkoZmspOwogICAgICAgICAgICAgICAgZWxlbS5z\nZXRDb2x1bW5JTyh2aW5mby5nZXRDb2x1bW5JTygpKTsKICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICBSZWxhdGlvblN0cmF0ZWdpZXMubWFw\nUmVsYXRpb25Ub1VubWFwcGVkUEMoZWxlbSwgImVsZW1lbnQiLCBhZGFwdCk7\nCiAgICAgICAgICAgIGVsZW0uc2V0VXNlQ2xhc3NDcml0ZXJpYShjcml0ZXJp\nYSk7CiAgICAgICAgICAgIGVsZW0ubWFwQ29uc3RyYWludHMoImVsZW1lbnQi\nLCBhZGFwdCk7CgogICAgICAgICAgICBGaWVsZE1hcHBpbmdJbmZvIGZpbmZv\nID0gZmllbGQuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICAgICAgQ29sdW1u\nIG9yZGVyQ29sID0gZmluZm8uZ2V0T3JkZXJDb2x1bW4oZmllbGQsIGZpZWxk\nLmdldFRhYmxlKCksIGFkYXB0KTsKICAgICAgICAgICAgZmllbGQuc2V0T3Jk\nZXJDb2x1bW4ob3JkZXJDb2wpOwogICAgICAgICAgICBmaWVsZC5zZXRPcmRl\nckNvbHVtbklPKGZpbmZvLmdldENvbHVtbklPKCkpOwogICAgICAgICAgICBm\naWVsZC5tYXBQcmltYXJ5S2V5KGFkYXB0KTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGVk\nQnkoKSA9PSBudWxsIHx8IGZpZWxkLmlzQmlNVG8xSlQoKSkgCiAgICAgICAg\nICAgIGluc2VydChzbSwgcm0sIHNtLmZldGNoT2JqZWN0KGZpZWxkLmdldElu\nZGV4KCkpKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5zZXJ0KE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIFJvd01hbmFnZXIgcm0sIE9iamVjdCB2YWxz\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENvbGxl\nY3Rpb24gY29sbCA9IHRvQ29sbGVjdGlvbih2YWxzKTsKICAgICAgICBpZiAo\nY29sbCA9PSBudWxsIHx8IGNvbGwuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIFJvdyByb3cgPSBybS5nZXRTZWNvbmRhcnlSb3co\nZmllbGQuZ2V0VGFibGUoKSwgUm93LkFDVElPTl9JTlNFUlQpOwogICAgICAg\nIHJvdy5zZXRGb3JlaWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCks\nIGZpZWxkLmdldEpvaW5Db2x1bW5JTygpLAogICAgICAgICAgICBzbSk7Cgog\nICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0RWxlbWVudE1h\ncHBpbmcoKTsKICAgICAgICBTdG9yZUNvbnRleHQgY3R4ID0gc20uZ2V0Q29u\ndGV4dCgpOwogICAgICAgIENvbHVtbiBvcmRlciA9IGZpZWxkLmdldE9yZGVy\nQ29sdW1uKCk7CiAgICAgICAgYm9vbGVhbiBzZXRPcmRlciA9IGZpZWxkLmdl\ndE9yZGVyQ29sdW1uSU8oKS5pc0luc2VydGFibGUob3JkZXIsIGZhbHNlKTsK\nICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIGVzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNvbGwuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspIHsKICAgICAgICAgICAg\nZXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihpdHIu\nbmV4dCgpLCBjdHgpOwogICAgICAgICAgICBlbGVtLnNldEZvcmVpZ25LZXko\ncm93LCBlc20pOwogICAgICAgICAgICBpZiAoc2V0T3JkZXIpCiAgICAgICAg\nICAgICAgICByb3cuc2V0SW50KG9yZGVyLCBpZHgpOwogICAgICAgICAgICBy\nbS5mbHVzaFNlY29uZGFyeVJvdyhyb3cpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRC\neSgpICE9IG51bGwgJiYgIWZpZWxkLmlzQmlNVG8xSlQoKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBPYmplY3Qgb2JqID0gc20uZmV0Y2hPYmpl\nY3QoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAgQ2hhbmdlVHJhY2tlciBj\ndCA9IG51bGw7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFByb3h5KSB7\nCiAgICAgICAgICAgIFByb3h5IHByb3h5ID0gKFByb3h5KSBvYmo7CiAgICAg\nICAgICAgIGlmIChQcm94aWVzLmlzT3duZXIocHJveHksIHNtLCBmaWVsZC5n\nZXRJbmRleCgpKSkKICAgICAgICAgICAgICAgIGN0ID0gcHJveHkuZ2V0Q2hh\nbmdlVHJhY2tlcigpOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uIG9yZGVy\nID0gZmllbGQuZ2V0T3JkZXJDb2x1bW4oKTsKCiAgICAgICAgLy8gaWYgbm8g\nZmluZS1ncmFpbmVkIGNoYW5nZSB0cmFja2luZyBvciBpZiBhbiBpdGVtIHdh\ncyByZW1vdmVkCiAgICAgICAgLy8gZnJvbSBhbiBvcmRlcmVkIGNvbGxlY3Rp\nb24sIGRlbGV0ZSBhbmQgcmVpbnNlcnQKICAgICAgICBpZiAoY3QgPT0gbnVs\nbCB8fCAhY3QuaXNUcmFja2luZygpIHx8CiAgICAgICAgICAgIChvcmRlciAh\nPSBudWxsICYmICFjdC5nZXRSZW1vdmVkKCkuaXNFbXB0eSgpKSkgewogICAg\nICAgICAgICBkZWxldGUoc20sIHN0b3JlLCBybSk7CiAgICAgICAgICAgIGlu\nc2VydChzbSwgcm0sIG9iaik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIFN0b3JlQ29udGV4dCBjdHggPSBzdG9yZS5nZXRDb250\nZXh0KCk7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZXNtOwoKICAgICAgICAvLyBkZWxldGUgdGhlIHJlbW92ZXMKICAgICAgICBD\nb2xsZWN0aW9uIHJlbSA9IGN0LmdldFJlbW92ZWQoKTsKICAgICAgICBpZiAo\nIXJlbS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgUm93IGRlbFJvdyA9IHJt\nLmdldFNlY29uZGFyeVJvdyhmaWVsZC5nZXRUYWJsZSgpLAogICAgICAgICAg\nICAgICAgUm93LkFDVElPTl9ERUxFVEUpOwogICAgICAgICAgICBkZWxSb3cu\nd2hlcmVGb3JlaWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCksIHNt\nKTsKCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcmVtLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlc20g\nPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGl0ci5uZXh0\nKCksIGN0eCk7CiAgICAgICAgICAgICAgICBlbGVtLndoZXJlRm9yZWlnbktl\neShkZWxSb3csIGVzbSk7CiAgICAgICAgICAgICAgICBybS5mbHVzaFNlY29u\nZGFyeVJvdyhkZWxSb3cpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyBpbnNlcnQgdGhlIGFkZHMKICAgICAgICBDb2xsZWN0aW9uIGFk\nZCA9IGN0LmdldEFkZGVkKCk7CiAgICAgICAgaWYgKCFhZGQuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIFJvdyBhZGRSb3cgPSBybS5nZXRTZWNvbmRhcnlS\nb3coZmllbGQuZ2V0VGFibGUoKSwKICAgICAgICAgICAgICAgIFJvdy5BQ1RJ\nT05fSU5TRVJUKTsKICAgICAgICAgICAgYWRkUm93LnNldEZvcmVpZ25LZXko\nZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwKICAgICAgICAgICAgICAgIGZp\nZWxkLmdldEpvaW5Db2x1bW5JTygpLCBzbSk7CgogICAgICAgICAgICBpbnQg\nc2VxID0gY3QuZ2V0TmV4dFNlcXVlbmNlKCk7CiAgICAgICAgICAgIGJvb2xl\nYW4gc2V0T3JkZXIgPSBmaWVsZC5nZXRPcmRlckNvbHVtbklPKCkuaXNJbnNl\ncnRhYmxlKG9yZGVyLAogICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFkZC5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOyBzZXErKykgewogICAgICAgICAgICAgICAgZXNtID0gUmVs\nYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihpdHIubmV4dCgpLCBj\ndHgpOwogICAgICAgICAgICAgICAgZWxlbS5zZXRGb3JlaWduS2V5KGFkZFJv\ndywgZXNtKTsKICAgICAgICAgICAgICAgIGlmIChzZXRPcmRlcikKICAgICAg\nICAgICAgICAgICAgICBhZGRSb3cuc2V0SW50KG9yZGVyLCBzZXEpOwogICAg\nICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coYWRkUm93KTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAob3JkZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGN0LnNldE5leHRTZXF1ZW5jZShzZXEpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZWxldGUoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFJvdyByb3cg\nPSBybS5nZXRBbGxSb3dzKGZpZWxkLmdldFRhYmxlKCksIFJvdy5BQ1RJT05f\nREVMRVRFKTsKICAgICAgICByb3cud2hlcmVGb3JlaWduS2V5KGZpZWxkLmdl\ndEpvaW5Gb3JlaWduS2V5KCksIHNtKTsKICAgICAgICBybS5mbHVzaEFsbFJv\nd3Mocm93KTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0b3Jl\nVmFsdWUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\ncmV0dXJuIFJlbGF0aW9uU3RyYXRlZ2llcy50b0RhdGFTdG9yZVZhbHVlKGZp\nZWxkLmdldEVsZW1lbnRNYXBwaW5nKCksCiAgICAgICAgICAgIHZhbCwgc3Rv\ncmUpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luKEpvaW5zIGpvaW5z\nLCBib29sZWFuIGZvcmNlT3V0ZXIpIHsKICAgICAgICByZXR1cm4gZmllbGQu\nam9pbihqb2lucywgZm9yY2VPdXRlciwgdHJ1ZSk7CiAgICB9CgogICAgcHVi\nbGljIEpvaW5zIGpvaW5SZWxhdGlvbihKb2lucyBqb2lucywgYm9vbGVhbiBm\nb3JjZU91dGVyLAogICAgICAgIGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAg\nICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5n\nKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gY2xzcyA9IGVsZW0uZ2V0SW5k\nZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsKICAgICAgICBpZiAoY2xzcy5sZW5n\ndGggIT0gMSkgewogICAgICAgICAgICBpZiAodHJhdmVyc2UpCiAgICAgICAg\nICAgICAgICB0aHJvdyBSZWxhdGlvblN0cmF0ZWdpZXMudW5qb2luYWJsZShl\nbGVtKTsKICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwogICAgICAgIH0KICAg\nICAgICBpZiAoZm9yY2VPdXRlcikKICAgICAgICAgICAgcmV0dXJuIGpvaW5z\nLm91dGVySm9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgIGVsZW0uZ2V0Rm9yZWlnbktleShjbHNzWzBdKSwgY2xzc1swXSwg\nCiAgICAgICAgICAgICAgICBlbGVtLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwg\nZmFsc2UsIGZhbHNlKTsKICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0\naW9uKGZpZWxkLmdldE5hbWUoKSwgZWxlbS5nZXRGb3JlaWduS2V5KGNsc3Nb\nMF0pLAogICAgICAgICAgICBjbHNzWzBdLCBlbGVtLmdldFNlbGVjdFN1YmNs\nYXNzZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KfQo=\n","encoding":"base64"}

