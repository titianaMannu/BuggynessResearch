{"sha":"6de8402cad8aa6b7c97d1648bb535c9a10d5f53b","node_id":"MDQ6QmxvYjIwNjM2NDo2ZGU4NDAyY2FkOGFhNmI3Yzk3ZDE2NDhiYjUzNWM5YTEwZDVmNTNi","size":13249,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6de8402cad8aa6b7c97d1648bb535c9a10d5f53b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnNxbC5D\nb25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuRHJpdmVyOwppbXBvcnQgamF2\nYS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwu\nSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBqYXZh\neC5zcWwuRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nbGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkNvbmZpZ3VyaW5nQ29ubmVj\ndGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\namRiYy5Db25uZWN0aW9uRGVjb3JhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5qZGJjLkRlY29yYXRpbmdEYXRhU291cmNlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdEYXRhU291\ncmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkpEQkNF\ndmVudENvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmpkYmMuSkRCQ0xpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5qZGJjLkxvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9y\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNvbmNyZXRlQ2xhc3NH\nZW5lcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVzZXJFeGNlcHRpb247CgovKioKICogRmFjdG9yeSBmb3Ige0BsaW5r\nIERhdGFTb3VyY2V9IG9iamVjdHMuIFRoZSBmYWN0b3J5IHVzZXMgdGhlIHN1\ncHBsaWVkCiAqIGNvbmZpZ3VyYXRpb24gdG8gb2J0YWluIGEgM3JkLXBhcnR5\nIGRhdGFzb3VyY2Ugb3IgdG8gY3JlYXRlIG9uZSwgYW5kCiAqIHRvIHNldHVw\nIHByZXBhcmVkIHN0YXRlbWVudCBjYWNoaW5nLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRGF0YVNv\ndXJjZUZhY3RvcnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgIAkgKERhdGFT\nb3VyY2VGYWN0b3J5LmNsYXNzKTsKICAgIHByb3RlY3RlZCBzdGF0aWMgTG9j\nYWxpemVyIF9lbG9jID0gCiAgICAJTG9jYWxpemVyLmZvclBhY2thZ2UoRGVs\nZWdhdGluZ0RhdGFTb3VyY2UuY2xhc3MpOwoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgZGF0YXNvdXJjZSB1c2luZyB0aGUgZ2l2ZW4gY29uZmlndXJhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBEYXRhU291cmNlIG5ld0Rh\ndGFTb3VyY2UoSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBib29s\nZWFuIGZhY3RvcnkyKSB7CiAgICAgICAgU3RyaW5nIGRyaXZlciA9IChmYWN0\nb3J5MikgPyBjb25mLmdldENvbm5lY3Rpb24yRHJpdmVyTmFtZSgpCiAgICAg\nICAgICAgIDogY29uZi5nZXRDb25uZWN0aW9uRHJpdmVyTmFtZSgpOwogICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGRyaXZlcikpCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1kcml2\nZXIiLCBkcml2ZXIpKS4KICAgICAgICAgICAgICAgIHNldEZhdGFsKHRydWUp\nOwoKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSBjb25mLmdldENsYXNz\nUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRDbGFzc0xvYWRl\ncihEYXRhU291cmNlRmFjdG9yeS5jbGFzcywgbnVsbCk7CiAgICAgICAgU3Ry\naW5nIHByb3BzID0gKGZhY3RvcnkyKSA/IGNvbmYuZ2V0Q29ubmVjdGlvbjJQ\ncm9wZXJ0aWVzKCkKICAgICAgICAgICAgOiBjb25mLmdldENvbm5lY3Rpb25Q\ncm9wZXJ0aWVzKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3Mg\nZHJpdmVyQ2xhc3M7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBkcml2ZXJDbGFzcyA9IENsYXNzLmZvck5hbWUoZHJpdmVyLCB0cnVlLCBs\nb2FkZXIpOwogICAgICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhj\nZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgICAgIC8vIHRyeSB3aXRoIHRo\nZSBjb3JlIGNsYXNzIGxvYWRlcgogICAgICAgICAgICAgICAgZHJpdmVyQ2xh\nc3MgPSBDbGFzcy5mb3JOYW1lKGRyaXZlcik7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChEcml2ZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShk\ncml2ZXJDbGFzcykpIHsKICAgICAgICAgICAgICAgIERyaXZlckRhdGFTb3Vy\nY2UgZHMgPSBjb25mLm5ld0RyaXZlckRhdGFTb3VyY2VJbnN0YW5jZSgpOwog\nICAgICAgICAgICAgICAgZHMuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsKICAg\nICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25Ecml2ZXJOYW1lKGRyaXZl\ncik7CiAgICAgICAgICAgICAgICBkcy5zZXRDb25uZWN0aW9uUHJvcGVydGll\ncyhDb25maWd1cmF0aW9ucy4KICAgICAgICAgICAgICAgICAgICBwYXJzZVBy\nb3BlcnRpZXMocHJvcHMpKTsKCiAgICAgICAgICAgICAgICBpZiAoIWZhY3Rv\ncnkyKSB7CiAgICAgICAgICAgICAgICAgICAgZHMuc2V0Q29ubmVjdGlvbkZh\nY3RvcnlQcm9wZXJ0aWVzKENvbmZpZ3VyYXRpb25zLgogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZVByb3BlcnRpZXMoY29uZi5nZXRDb25uZWN0aW9u\nRmFjdG9yeVByb3BlcnRpZXMoKSkpOwogICAgICAgICAgICAgICAgICAgIGRz\nLnNldENvbm5lY3Rpb25VUkwoY29uZi5nZXRDb25uZWN0aW9uVVJMKCkpOwog\nICAgICAgICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25Vc2VyTmFtZShj\nb25mLmdldENvbm5lY3Rpb25Vc2VyTmFtZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBkcy5zZXRDb25uZWN0aW9uUGFzc3dvcmQoY29uZi5nZXRDb25uZWN0\naW9uUGFzc3dvcmQoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25GYWN0b3J5UHJvcGVy\ndGllcwogICAgICAgICAgICAgICAgICAgICAgICAoQ29uZmlndXJhdGlvbnMu\ncGFyc2VQcm9wZXJ0aWVzKGNvbmYuCiAgICAgICAgICAgICAgICAgICAgICAg\nIGdldENvbm5lY3Rpb25GYWN0b3J5MlByb3BlcnRpZXMoKSkpOwogICAgICAg\nICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25VUkwoY29uZi5nZXRDb25u\nZWN0aW9uMlVSTCgpKTsKICAgICAgICAgICAgICAgICAgICBkcy5zZXRDb25u\nZWN0aW9uVXNlck5hbWUoY29uZi5nZXRDb25uZWN0aW9uMlVzZXJOYW1lKCkp\nOwogICAgICAgICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25QYXNzd29y\nZChjb25mLmdldENvbm5lY3Rpb24yUGFzc3dvcmQoKSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZHM7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHNlZSBpZiB0aGVpciBkcml2ZXIgbmFtZSBp\ncyBhY3R1YWxseSBhIGRhdGEgc291cmNlCiAgICAgICAgICAgIGlmIChEYXRh\nU291cmNlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oZHJpdmVyQ2xhc3MpKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gKERhdGFTb3VyY2UpIENvbmZpZ3Vy\nYXRpb25zLm5ld0luc3RhbmNlKGRyaXZlciwKICAgICAgICAgICAgICAgICAg\nICBjb25mLCBwcm9wcywgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENs\nYXNzTG9hZGVyQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nRGF0YVNvdXJjZS5jbGFzcykpKTsgCiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3Q29ubmVjdEV4Y2VwdGlvbihjb25m\nLCBmYWN0b3J5MiwgZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBub3QgYSBk\ncml2ZXIgb3IgYSBkYXRhIHNvdXJjZTsgZGllCiAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kcml2ZXIiLCBkcml2ZXIp\nKS5zZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc3Rh\nbGwgbGlzdGVuZXJzIGFuZCBiYXNlIGRlY29yYXRvcnMuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgRGVjb3JhdGluZ0RhdGFTb3VyY2UgZGVjb3JhdGVE\nYXRhU291cmNlKERhdGFTb3VyY2UgZHMsCiAgICAgICAgSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZiwgYm9vbGVhbiBmYWN0b3J5MikgewogICAgICAgIE9wdGlv\nbnMgb3B0cyA9IENvbmZpZ3VyYXRpb25zLnBhcnNlUHJvcGVydGllcygoZmFj\ndG9yeTIpCiAgICAgICAgICAgID8gY29uZi5nZXRDb25uZWN0aW9uRmFjdG9y\neTJQcm9wZXJ0aWVzKCkKICAgICAgICAgICAgOiBjb25mLmdldENvbm5lY3Rp\nb25GYWN0b3J5UHJvcGVydGllcygpKTsKICAgICAgICBMb2cgamRiY0xvZyA9\nIGNvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKICAg\nICAgICBMb2cgc3FsTG9nID0gY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRp\nb24uTE9HX1NRTCk7CgogICAgICAgIERlY29yYXRpbmdEYXRhU291cmNlIGRk\ncyA9IERlY29yYXRpbmdEYXRhU291cmNlLgogICAgICAgICAgICBuZXdEZWNv\ncmF0aW5nRGF0YVNvdXJjZShkcyk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gYWRkIHVzZXItZGVmaW5lZCBkZWNvcmF0b3JzCiAgICAgICAgICAg\nIExpc3QgZGVjb3JhdG9ycyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAg\nICAgZGVjb3JhdG9ycy5hZGRBbGwoQXJyYXlzLmFzTGlzdChjb25mLgogICAg\nICAgICAgICAgICAgZ2V0Q29ubmVjdGlvbkRlY29yYXRvckluc3RhbmNlcygp\nKSk7CgogICAgICAgICAgICAvLyBhZGQgamRiYyBldmVudHMgZGVjb3JhdG9y\nCiAgICAgICAgICAgIEpEQkNFdmVudENvbm5lY3Rpb25EZWNvcmF0b3IgZWNk\nID0KICAgICAgICAgICAgICAgIG5ldyBKREJDRXZlbnRDb25uZWN0aW9uRGVj\nb3JhdG9yKCk7CiAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3Vy\nZUluc3RhbmNlKGVjZCwgY29uZiwgb3B0cyk7CiAgICAgICAgICAgIEpEQkNM\naXN0ZW5lcltdIGxpc3RlbmVycyA9IGNvbmYuZ2V0SkRCQ0xpc3RlbmVySW5z\ndGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlz\ndGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgZWNkLmFkZExp\nc3RlbmVyKGxpc3RlbmVyc1tpXSk7CiAgICAgICAgICAgIGRlY29yYXRvcnMu\nYWRkKGVjZCk7CgogICAgICAgICAgICAvLyBhc2sgdGhlIERyaXZlckRhdGFT\nb3VyY2UgdG8gcHJvdmlkZSBhbnkgYWRkaXRpb25hbCBkZWNvcmF0b3JzCiAg\nICAgICAgICAgIGlmIChkcyBpbnN0YW5jZW9mIERyaXZlckRhdGFTb3VyY2Up\nIHsKICAgICAgICAgICAgICAgIExpc3QgZGVjcyA9ICgoRHJpdmVyRGF0YVNv\ndXJjZSkgZHMpLgogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUNvbm5lY3Rp\nb25EZWNvcmF0b3JzKCk7CiAgICAgICAgICAgICAgICBpZiAoZGVjcyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGRlY29yYXRvcnMuYWRkQWxsKGRl\nY3MpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBsb2dnaW5nIGRl\nY29yYXRvcgogICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRv\nciBsY2QgPQogICAgICAgICAgICAgICAgbmV3IExvZ2dpbmdDb25uZWN0aW9u\nRGVjb3JhdG9yKCk7CiAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZp\nZ3VyZUluc3RhbmNlKGxjZCwgY29uZiwgb3B0cyk7CiAgICAgICAgICAgIGxj\nZC5nZXRMb2dzKCkuc2V0SkRCQ0xvZyhqZGJjTG9nKTsKICAgICAgICAgICAg\nbGNkLmdldExvZ3MoKS5zZXRTUUxMb2coc3FsTG9nKTsKICAgICAgICAgICAg\nZGVjb3JhdG9ycy5hZGQobGNkKTsKCiAgICAgICAgICAgIGRkcy5hZGREZWNv\ncmF0b3JzKGRlY29yYXRvcnMpOwogICAgICAgICAgICByZXR1cm4gZGRzOwog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3Q29ubmVjdEV4Y2VwdGlvbihjb25m\nLCBmYWN0b3J5MiwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogSW5zdGFsbCB0aGluZ3MgZGVmZXJyZWQgdW50aWwgdGhlIERCRGljdGlv\nbmFyeSBpbnN0YW5jZSBpcyBhdmFpbGFibGUuCiAgICAgKgogICAgICogQGF1\ndGhvciBTdGV2ZSBLaW0KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBEZWNv\ncmF0aW5nRGF0YVNvdXJjZSBpbnN0YWxsREJEaWN0aW9uYXJ5KERCRGljdGlv\nbmFyeSBkaWN0LAogICAgICAgIERlY29yYXRpbmdEYXRhU291cmNlIGRzLCBm\naW5hbCBKREJDQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIGJvb2xlYW4g\nZmFjdG9yeTIpIHsKICAgICAgICBEYXRhU291cmNlIGlubmVyID0gZHMuZ2V0\nSW5uZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICBpZiAoaW5uZXIgaW5zdGFu\nY2VvZiBEcml2ZXJEYXRhU291cmNlKQogICAgICAgICAgICAoKERyaXZlckRh\ndGFTb3VyY2UpIGlubmVyKS5pbml0REJEaWN0aW9uYXJ5KGRpY3QpOwogICAg\nICAgIENvbm5lY3Rpb24gY29ubiA9IG51bGw7CgogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIGFkZCB0aGUgZGljdGlvbmFyeSBhcyBhIHdhcm5pbmcg\naGFuZGxlciBvbiB0aGUgbG9nZ2luZwogICAgICAgICAgICAvLyBkZWNvcmF0\nb3IKICAgICAgICAgICAgQ29ubmVjdGlvbkRlY29yYXRvciBjZDsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBkcy5nZXREZWNvcmF0b3JzKCku\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIGNkID0gKENvbm5lY3Rpb25EZWNvcmF0b3IpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICBpZiAoY2QgaW5zdGFuY2VvZiBMb2dnaW5nQ29ubmVjdGlv\nbkRlY29yYXRvcikKICAgICAgICAgICAgICAgICAgICAoKExvZ2dpbmdDb25u\nZWN0aW9uRGVjb3JhdG9yKSBjZCkuc2V0V2FybmluZ0hhbmRsZXIoZGljdCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1pc2MgY29uZmlndXJh\ndGlvbiBjb25uZWN0aW9uIGRlY29yYXRvciAoc3RhdGVtZW50IHRpbWVvdXRz\nLAogICAgICAgICAgICAvLyB0cmFuc2FjdGlvbiBpc29sYXRpb24sIGV0YykK\nICAgICAgICAgICAgQ29uZmlndXJpbmdDb25uZWN0aW9uRGVjb3JhdG9yIGNj\nZCA9CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlndXJpbmdDb25uZWN0aW9u\nRGVjb3JhdG9yKCk7CiAgICAgICAgICAgIGNjZC5zZXRUcmFuc2FjdGlvbklz\nb2xhdGlvbihjb25mLmdldFRyYW5zYWN0aW9uSXNvbGF0aW9uQ29uc3RhbnQo\nKSk7CiAgICAgICAgICAgIGNjZC5zZXRRdWVyeVRpbWVvdXQoY29uZi5nZXRR\ndWVyeVRpbWVvdXQoKSA9PSAtMSAKICAgICAgICAgICAgICAgID8gLTEgOiBj\nb25mLmdldFF1ZXJ5VGltZW91dCgpICogMTAwMCk7CiAgICAgICAgICAgIExv\nZyBsb2cgPSBjb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfSkRC\nQyk7CiAgICAgICAgICAgIGlmIChmYWN0b3J5MiB8fCAhY29uZi5pc0Nvbm5l\nY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkgewogICAgICAgICAgICAgICAg\naWYgKCFkaWN0LnN1cHBvcnRzTXVsdGlwbGVOb250cmFuc2FjdGlvbmFsUmVz\ndWx0U2V0cykKICAgICAgICAgICAgICAgICAgICBjY2Quc2V0QXV0b0NvbW1p\ndChCb29sZWFuLkZBTFNFKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICBjY2Quc2V0QXV0b0NvbW1pdChCb29sZWFuLlRSVUUp\nOwogICAgICAgICAgICAgICAgLy8gYWRkIHRyYWNlIGluZm8gZm9yIGF1dG9D\nb21taXQgc2V0dGluZwogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9j\nLmdldCgic2V0LWF1dG8tY29tbWl0IiwgbmV3IE9iamVjdFtdIHsKICAgICAg\nICAgICAgICAgICAgICBkaWN0LnN1cHBvcnRzTXVsdGlwbGVOb250cmFuc2Fj\ndGlvbmFsUmVzdWx0U2V0c30pKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBPcHRpb25zIG9wdHMgPSBDb25maWd1cmF0aW9ucy5wYXJzZVByb3BlcnRp\nZXMoKGZhY3RvcnkyKQogICAgICAgICAgICAgICAgPyBjb25mLmdldENvbm5l\nY3Rpb25GYWN0b3J5MlByb3BlcnRpZXMoKQogICAgICAgICAgICAgICAgOiBj\nb25mLmdldENvbm5lY3Rpb25GYWN0b3J5UHJvcGVydGllcygpKTsKICAgICAg\nICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2UoY2NkLCBj\nb25mLCBvcHRzKTsKICAgICAgICAgICAgZHMuYWRkRGVjb3JhdG9yKGNjZCk7\nCgogICAgICAgICAgICAvLyBhbGxvdyB0aGUgZGJkaWN0aW9uYXJ5IHRvIGRl\nY29yYXRlIHRoZSBjb25uZWN0aW9uIGZ1cnRoZXIKICAgICAgICAgICAgZHMu\nYWRkRGVjb3JhdG9yKGRpY3QpOwogICAgICAgICAgICAKICAgICAgICAgICAg\nLy8gZW5zdXJlIGRiZGljdGlvbmFyeSB0byBwcm9jZXNzIGNvbm5lY3RlZENv\nbmZpZ3VyYXRpb24oKQogICAgICAgICAgICBpZiAoIWZhY3RvcnkyKQogICAg\nICAgICAgICAgICAgY29ubiA9IGRzLmdldENvbm5lY3Rpb24oY29uZi5nZXRD\nb25uZWN0aW9uVXNlck5hbWUoKSwgY29uZgogICAgICAgICAgICAgICAgICAg\nICAgICAuZ2V0Q29ubmVjdGlvblBhc3N3b3JkKCkpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBjb25uID0gZHMuZ2V0Q29ubmVjdGlvbihj\nb25mLmdldENvbm5lY3Rpb24yVXNlck5hbWUoKSwgY29uZgogICAgICAgICAg\nICAgICAgICAgICAgICAuZ2V0Q29ubmVjdGlvbjJQYXNzd29yZCgpKTsKCiAg\nICAgICAgICAgIHJldHVybiBkczsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgIAl0aHJvdyBuZXdDb25uZWN0RXhjZXB0aW9uKGNv\nbmYsIGZhY3RvcnkyLCBlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyBpZ25vcmUgYW55IGV4Y2VwdGlvbiBzaW5jZSB0aGUgY29u\nbmVjdGlvbiBpcyBub3QgZ29pbmcKICAgICAgICAgICAgICAgICAgICAvLyB0\nbyBiZSB1c2VkIGFueXdheQogICAgICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KICAgIAogICAgc3RhdGljIE9wZW5KUEFFeGNlcHRpb24gbmV3Q29u\nbmVjdEV4Y2VwdGlvbihKREJDQ29uZmlndXJhdGlvbiBjb25mLCAKICAgIAkJ\nYm9vbGVhbiBmYWN0b3J5MiwgRXhjZXB0aW9uIGNhdXNlKSB7CiAgICAJcmV0\ndXJuIG5ldyBVc2VyRXhjZXB0aW9uKF9lbG9jLmdldCgicG9vbGRzLW51bGwi\nLCBmYWN0b3J5MiAKICAgICAgICAgIAkgID8gbmV3IE9iamVjdFtde2NvbmYu\nZ2V0Q29ubmVjdGlvbjJEcml2ZXJOYW1lKCksIAogICAgICAgICAgCQkJICAg\nICAgICAgY29uZi5nZXRDb25uZWN0aW9uMlVSTCgpfQogICAgICAgICAgCSAg\nOiBuZXcgT2JqZWN0W117Y29uZi5nZXRDb25uZWN0aW9uRHJpdmVyTmFtZSgp\nLAogICAgICAgICAgCQkgICAgICAgICAgICAgY29uZi5nZXRDb25uZWN0aW9u\nVVJMKCl9KSwKICAgICAgICAgIAkJICAgICAgICAgICAgIGNhdXNlKS5zZXRG\nYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGRh\ndGEgc291cmNlIHdpdGggdGhlIGdpdmVuIHVzZXIgbmFtZSBhbmQgcGFzc3dv\ncmQKICAgICAqIHByZS1jb25maWd1cmVkIGFzIHRoZSBkZWZhdWx0cyB3aGVu\nIHtAbGluayBEYXRhU291cmNlI2dldENvbm5lY3Rpb259CiAgICAgKiBpcyBj\nYWxsZWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgRGF0YVNvdXJjZSBk\nZWZhdWx0c0RhdGFTb3VyY2UoRGF0YVNvdXJjZSBkcywKICAgICAgICBTdHJp\nbmcgdXNlciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICBpZiAodXNlciA9PSBu\ndWxsICYmIHBhc3MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGRzOwog\nICAgICAgIC8vIGFsc28gY2hlY2sgaWYgdGhleSBhcmUgYm90aCBibGFuayBz\ndHJpbmdzCiAgICAgICAgaWYgKCIiLmVxdWFscyh1c2VyKSAmJiAiIi5lcXVh\nbHMocGFzcykpCiAgICAgICAgICAgIHJldHVybiBkczsKICAgICAgICByZXR1\ncm4gRGVmYXVsdHNEYXRhU291cmNlLm5ld0luc3RhbmNlKGRzLCB1c2VyLCBw\nYXNzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBnaXZlbiBk\nYXRhIHNvdXJjZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIGNs\nb3NlRGF0YVNvdXJjZShEYXRhU291cmNlIGRzKSB7CiAgICAgICAgaWYgKGRz\nIGluc3RhbmNlb2YgRGVsZWdhdGluZ0RhdGFTb3VyY2UpCiAgICAgICAgICAg\nIGRzID0gKChEZWxlZ2F0aW5nRGF0YVNvdXJjZSkgZHMpLmdldElubmVybW9z\ndERlbGVnYXRlKCk7CiAgICAgICAgSW1wbEhlbHBlci5jbG9zZShkcyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBIGRhdGEgc291cmNlIHdpdGggcHJlLWNv\nbmZpZ3VyZWQgZGVmYXVsdCB1c2VyIG5hbWUgYW5kIHBhc3N3b3JkLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgc3RhdGljIGNsYXNzIERlZmF1\nbHRzRGF0YVNvdXJjZQogICAgICAgIGV4dGVuZHMgRGVsZWdhdGluZ0RhdGFT\nb3VyY2UgewoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDb25zdHJ1\nY3RvcjxEZWZhdWx0c0RhdGFTb3VyY2U+IGltcGxDbGFzczsKCiAgICAgICAg\nc3RhdGljIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlt\ncGxDbGFzcyA9IENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IuZ2V0Q29uY3JldGVD\nb25zdHJ1Y3RvcihEZWZhdWx0c0RhdGFTb3VyY2UuY2xhc3MsIAogICAgICAg\nICAgICAgICAgICAgICAgICBEYXRhU291cmNlLmNsYXNzLCBTdHJpbmcuY2xh\nc3MsIFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9u\nSW5Jbml0aWFsaXplckVycm9yKGUpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBfdXNlcjsKICAgICAg\nICBwcml2YXRlIGZpbmFsIFN0cmluZyBfcGFzczsKCiAgICAgICAgcHVibGlj\nIERlZmF1bHRzRGF0YVNvdXJjZShEYXRhU291cmNlIGRzLCBTdHJpbmcgdXNl\nciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICAgICAgc3VwZXIoZHMpOwogICAg\nICAgICAgICBfdXNlciA9IHVzZXI7CiAgICAgICAgICAgIF9wYXNzID0gcGFz\nczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgRGVmYXVsdHNE\nYXRhU291cmNlIG5ld0luc3RhbmNlKERhdGFTb3VyY2UgZHMsIFN0cmluZyB1\nc2VyLCBTdHJpbmcgcGFzcykgewogICAgICAgICAgICByZXR1cm4gQ29uY3Jl\ndGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShpbXBsQ2xhc3MsIGRzLCB1\nc2VyLCBwYXNzKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBDb25uZWN0\naW9uIGdldENvbm5lY3Rpb24oKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENvbm5lY3Rp\nb24oX3VzZXIsIF9wYXNzKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBD\nb25uZWN0aW9uIGdldENvbm5lY3Rpb24oU3RyaW5nIHVzZXIsIFN0cmluZyBw\nYXNzKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmdldENvbm5lY3Rpb24odXNlciwgcGFzcyk7\nCiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

