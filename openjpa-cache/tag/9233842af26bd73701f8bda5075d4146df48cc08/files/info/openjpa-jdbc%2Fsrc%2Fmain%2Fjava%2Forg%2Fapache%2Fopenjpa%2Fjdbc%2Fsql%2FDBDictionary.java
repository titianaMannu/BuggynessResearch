{"sha":"b48258dab8975ecf2fe7be9c18e9a87dc6b9a2e2","node_id":"MDQ6QmxvYjIwNjM2NDpiNDgyNThkYWI4OTc1ZWNmMmZlN2JlOWMxOGU5YTg3ZGM2YjlhMmUy","size":183497,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b48258dab8975ecf2fe7be9c18e9a87dc6b9a2e2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkNoYXJBcnJheVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7\nCmltcG9ydCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc3Fs\nLkFycmF5OwppbXBvcnQgamF2YS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3Fs\nLkNsb2I7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2\nYS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVmOwppbXBvcnQgamF2\nYS5zcWwuUmVzdWx0U2V0OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5zcWwuU1FMV2FybmluZzsKaW1wb3J0IGphdmEuc3Fs\nLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZh\nLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0\nIGphdmEudGV4dC5NZXNzYWdlRm9ybWF0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZh\nLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkVudW1TZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtl\nZEhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5Mb2NhbGU7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5FeHBDb250ZXh0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhwU3RhdGU7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5G\naWx0ZXJWYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5leHBzLk51bGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5rZXJuZWwuZXhwcy5WYWw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5KYXZhU1FMVHlwZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFTb3VyY2VGYWN0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVp\nZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nTmFtZVNldDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlNjaGVtYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TZXF1ZW5jZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkZpbHRlcnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5QYXRoOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5qZGJjLkNvbm5lY3Rpb25EZWNvcmF0b3I7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuTG9nZ2luZ0Nvbm5l\nY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplci5NZXNzYWdlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0ZUV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkxvY2tFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RFeGlzdHNFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RG\nb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PcHRpbWlzdGljRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuUXVlcnlFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5SZWZlcmVudGlhbEludGVncml0eUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlNlcmlhbGl6YXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9yZUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9ydGVk\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNl\nckV4Y2VwdGlvbjsKCmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIENsYXNzIHdoaWNoIGFsbG93\ncyB0aGUgY3JlYXRpb24gb2YgU1FMIGR5bmFtaWNhbGx5LCBpbiBhCiAqIGRh\ndGFiYXNlIGFnbm9zdGljIGZhc2hpb24uIFN1YmNsYXNzIGZvciB0aGUgbnVh\nbmNlcyBvZiBkaWZmZXJlbnQgZGF0YSBzdG9yZXMuCiAqLwpwdWJsaWMgY2xh\nc3MgREJEaWN0aW9uYXJ5CiAgICBpbXBsZW1lbnRzIENvbmZpZ3VyYWJsZSwg\nQ29ubmVjdGlvbkRlY29yYXRvciwgSm9pblN5bnRheGVzLAogICAgTG9nZ2lu\nZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FMV2FybmluZ0hhbmRsZXIgewoKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFZFTkRPUl9PVEhFUiA9ICJv\ndGhlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBWRU5ET1Jf\nREFUQURJUkVDVCA9ICJkYXRhZGlyZWN0IjsKCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9VUFBFUiA9ICJ1cHBlciI7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9MT1dF\nUiA9ICJsb3dlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBT\nQ0hFTUFfQ0FTRV9QUkVTRVJWRSA9ICJwcmVzZXJ2ZSI7CgogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX0JFRk9SRSA9ICJiZWZv\ncmUiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1F\nX01JRCA9ICJtaWQiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nQ09OU19OQU1FX0FGVEVSID0gImFmdGVyIjsKICAgIAogICAgcHVibGljIGlu\ndCBibG9iQnVmZmVyU2l6ZSA9IDUwMDAwOwogICAgcHVibGljIGludCBjbG9i\nQnVmZmVyU2l6ZSA9IDUwMDAwOwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgaW50IFJBTkdFX1BPU1RfU0VMRUNUID0gMDsKICAgIHByb3RlY3RlZCBz\ndGF0aWMgZmluYWwgaW50IFJBTkdFX1BSRV9ESVNUSU5DVCA9IDE7CiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBSQU5HRV9QT1NUX0RJU1RJTkNU\nID0gMjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BP\nU1RfTE9DSyA9IDM7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQg\nTkFOTyA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBNSUNS\nTyA9IE5BTk8gKiAxMDAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBp\nbnQgTUlMTEkgPSBNSUNSTyAqIDEwMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIGludCBDRU5USSA9IE1JTExJICogMTA7CiAgICBwcm90ZWN0ZWQg\nc3RhdGljIGZpbmFsIGludCBERUNJID0gTUlMTEkgKiAxMDA7CiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIGludCBTRUMgPSBNSUxMSSAqIDEwMDA7Cgog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFNRV9BTlkgPSAwOwog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFNRV9UQUJMRSA9IDE7\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBOQU1FX1NFUVVFTkNF\nID0gMjsKICAgIAogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVU5M\nSU1JVEVEID0gLTE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBO\nT19CQVRDSCA9IDA7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5n\nIFpFUk9fREFURV9TVFIgPQogICAgICAgICInIiArIG5ldyBqYXZhLnNxbC5E\nYXRlKDApICsgIiciOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5n\nIFpFUk9fVElNRV9TVFIgPSAiJyIgKyBuZXcgVGltZSgwKSArICInIjsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBaRVJPX1RJTUVTVEFNUF9T\nVFIgPQogICAgICAgICInIiArIG5ldyBUaW1lc3RhbXAoMCkgKyAiJyI7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2Nh\nbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChEQkRpY3Rpb25hcnkuY2xhc3Mp\nOwoKICAgIC8vIHNjaGVtYSBkYXRhCiAgICBwdWJsaWMgU3RyaW5nIHBsYXRm\nb3JtID0gIkdlbmVyaWMiOwogICAgcHVibGljIFN0cmluZyBkcml2ZXJWZW5k\nb3IgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjYXRhbG9nU2VwYXJhdG9y\nID0gIi4iOwogICAgcHVibGljIGJvb2xlYW4gY3JlYXRlUHJpbWFyeUtleXMg\nPSB0cnVlOwogICAgcHVibGljIFN0cmluZyBjb25zdHJhaW50TmFtZU1vZGUg\nPSBDT05TX05BTUVfQkVGT1JFOwogICAgcHVibGljIGludCBtYXhUYWJsZU5h\nbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heENvbHVtbk5hbWVM\nZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heENvbnN0cmFpbnROYW1l\nTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJbmRleE5hbWVMZW5n\ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heEluZGV4ZXNQZXJUYWJsZSA9\nIEludGVnZXIuTUFYX1ZBTFVFOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNGb3JlaWduS2V5cyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0ZvcmVpZ25LZXlzQ29tcG9zaXRlID0gdHJ1ZTsKICAgIHB1YmxpYyBi\nb29sZWFuIHN1cHBvcnRzVW5pcXVlQ29uc3RyYWludHMgPSB0cnVlOwogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNEZWZlcnJlZENvbnN0cmFpbnRzID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3REZWxl\ndGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHND\nYXNjYWRlRGVsZXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzTnVsbERlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0RlZmF1bHREZWxldGVBY3Rpb24gPSB0cnVlOwog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNSZXN0cmljdFVwZGF0ZUFjdGlv\nbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0Nhc2NhZGVV\ncGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNOdWxsVXBkYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzRGVmYXVsdFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFibGVXaXRoQWRkQ29sdW1uID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQWx0ZXJUYWJsZVdp\ndGhEcm9wQ29sdW1uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzQ29tbWVudHMgPSBmYWxzZTsKICAgIHB1YmxpYyBCb29sZWFuIHN1cHBv\ncnRzR2V0R2VuZXJhdGVkS2V5cyA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5n\nIHJlc2VydmVkV29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzeXN0\nZW1TY2hlbWFzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVtVGFi\nbGVzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VsZWN0V29yZHMgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBmaXhlZFNpemVUeXBlTmFtZXMgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBzY2hlbWFDYXNlID0gU0NIRU1BX0NB\nU0VfVVBQRVI7CiAgICBwdWJsaWMgYm9vbGVhbiBzZXRTdHJpbmdSaWdodFRy\ndW5jYXRpb25PbiA9IHRydWU7CgogICAgLy8gc3FsCiAgICBwdWJsaWMgU3Ry\naW5nIHZhbGlkYXRpb25TUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBj\nbG9zZVBvb2xTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBpbml0aWFs\naXphdGlvblNRTCA9IG51bGw7CiAgICBwdWJsaWMgaW50IGpvaW5TeW50YXgg\nPSBTWU5UQVhfU1FMOTI7CiAgICBwdWJsaWMgU3RyaW5nIG91dGVySm9pbkNs\nYXVzZSA9ICJMRUZUIE9VVEVSIEpPSU4iOwogICAgcHVibGljIFN0cmluZyBp\nbm5lckpvaW5DbGF1c2UgPSAiSU5ORVIgSk9JTiI7CiAgICBwdWJsaWMgU3Ry\naW5nIGNyb3NzSm9pbkNsYXVzZSA9ICJDUk9TUyBKT0lOIjsKICAgIHB1Ymxp\nYyBib29sZWFuIHJlcXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luID0gZmFs\nc2U7CiAgICBwdWJsaWMgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSA9ICJGT1Ig\nVVBEQVRFIjsKICAgIHB1YmxpYyBTdHJpbmcgdGFibGVGb3JVcGRhdGVDbGF1\nc2UgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBkaXN0aW5jdENvdW50Q29s\ndW1uU2VwYXJhdG9yID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzU2VsZWN0Rm9yVXBkYXRlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzTG9ja2luZ1dpdGhEaXN0aW5jdENsYXVzZSA9IHRydWU7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoTXVsdGlwbGVU\nYWJsZXMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2Nr\naW5nV2l0aE9yZGVyQ2xhdXNlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbiA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoU2Vs\nZWN0UmFuZ2UgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNR\ndWVyeVRpbWVvdXQgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc2ltdWxh\ndGVMb2NraW5nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc1N1YnNlbGVjdCA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc0NvcnJlbGF0ZWRTdWJzZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xl\nYW4gc3VwcG9ydHNIYXZpbmcgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gZmFsc2U7CiAgICBw\ndWJsaWMgaW50IHJhbmdlUG9zaXRpb24gPSBSQU5HRV9QT1NUX1NFTEVDVDsK\nICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3Qg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzVGFyZ2V0Rm9y\nRGVsZXRlID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBhbGxvd3NBbGlh\nc0luQnVsa0NsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c011bHRpcGxlTm9udHJhbnNhY3Rpb25hbFJlc3VsdFNldHMgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gcmVxdWlyZXNTZWFyY2hTdHJpbmdFc2Nh\ncGVGb3JMaWtlID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcgc2VhcmNoU3Ry\naW5nRXNjYXBlID0gIlxcIjsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVz\nQ2FzdEZvck1hdGhGdW5jdGlvbnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29s\nZWFuIHJlcXVpcmVzQ2FzdEZvckNvbXBhcmlzb25zID0gZmFsc2U7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c01vZE9wZXJhdG9yID0gZmFsc2U7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1hNTENvbHVtbiA9IGZhbHNlOwog\nICAgcHVibGljIGJvb2xlYW4gcmVwb3J0c1N1Y2Nlc3NOb0luZm9PbkJhdGNo\nVXBkYXRlcyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNT\nZWxlY3RGcm9tRmluYWxUYWJsZSA9IGZhbHNlOwogICAgcHVibGljIGJvb2xl\nYW4gc3VwcG9ydHNTaW1wbGVDYXNlRXhwcmVzc2lvbiA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c0dlbmVyYWxDYXNlRXhwcmVzc2lvbiA9\nIHRydWU7CiAgICAKICAgIC8qKgogICAgICogU29tZSBEYXRhYmFzZXMgYXBw\nZW5kIHdoaXRlc3BhY2UgYWZ0ZXIgdGhlIHNjaGVtYSBuYW1lIAogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiB0cmltU2NoZW1hTmFtZSA9IGZhbHNlOwoK\nICAgIC8vIGZ1bmN0aW9ucwogICAgcHVibGljIFN0cmluZyBjYXN0RnVuY3Rp\nb24gPSAiQ0FTVCh7MH0gQVMgezF9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRv\nTG93ZXJDYXNlRnVuY3Rpb24gPSAiTE9XRVIoezB9KSI7CiAgICBwdWJsaWMg\nU3RyaW5nIHRvVXBwZXJDYXNlRnVuY3Rpb24gPSAiVVBQRVIoezB9KSI7CiAg\nICBwdWJsaWMgU3RyaW5nIHN0cmluZ0xlbmd0aEZ1bmN0aW9uID0gIkNIQVJf\nTEVOR1RIKHswfSkiOwogICAgcHVibGljIFN0cmluZyBiaXRMZW5ndGhGdW5j\ndGlvbiA9ICIoT0NURVRfTEVOR1RIKHswfSkgKiA4KSI7CiAgICBwdWJsaWMg\nU3RyaW5nIHRyaW1MZWFkaW5nRnVuY3Rpb24gPSAiVFJJTShMRUFESU5HIHsx\nfSBGUk9NIHswfSkiOwogICAgcHVibGljIFN0cmluZyB0cmltVHJhaWxpbmdG\ndW5jdGlvbiA9ICJUUklNKFRSQUlMSU5HIHsxfSBGUk9NIHswfSkiOwogICAg\ncHVibGljIFN0cmluZyB0cmltQm90aEZ1bmN0aW9uID0gIlRSSU0oQk9USCB7\nMX0gRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVG\ndW5jdGlvbiA9ICIoezB9fHx7MX0pIjsKICAgIHB1YmxpYyBTdHJpbmcgY29u\nY2F0ZW5hdGVEZWxpbWl0ZXIgPSAiJ09QRU5KUEFUT0tFTiciOwogICAgcHVi\nbGljIFN0cmluZyBzdWJzdHJpbmdGdW5jdGlvbk5hbWUgPSAiU1VCU1RSSU5H\nIjsKICAgIHB1YmxpYyBTdHJpbmcgY3VycmVudERhdGVGdW5jdGlvbiA9ICJD\nVVJSRU5UX0RBVEUiOwogICAgcHVibGljIFN0cmluZyBjdXJyZW50VGltZUZ1\nbmN0aW9uID0gIkNVUlJFTlRfVElNRSI7CiAgICBwdWJsaWMgU3RyaW5nIGN1\ncnJlbnRUaW1lc3RhbXBGdW5jdGlvbiA9ICJDVVJSRU5UX1RJTUVTVEFNUCI7\nCiAgICBwdWJsaWMgU3RyaW5nIGRyb3BUYWJsZVNRTCA9ICJEUk9QIFRBQkxF\nIHswfSI7CgogICAgLy8gdHlwZXMKICAgIHB1YmxpYyBib29sZWFuIHN0b3Jh\nZ2VMaW1pdGF0aW9uc0ZhdGFsID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncyA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3RvcmVDaGFyc0FzTnVtYmVycyA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiB1c2VHZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAg\nICBwdWJsaWMgYm9vbGVhbiB1c2VTZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7\nCiAgICBwdWJsaWMgYm9vbGVhbiB1c2VHZXRPYmplY3RGb3JCbG9icyA9IGZh\nbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0U3RyaW5nRm9yQ2xvYnMg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZVNldFN0cmluZ0ZvckNs\nb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgaW50IG1heEVtYmVkZGVkQmxvYlNp\nemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgbWF4RW1iZWRkZWRDbG9iU2l6ZSA9\nIC0xOwogICAgcHVibGljIGludCBpbkNsYXVzZUxpbWl0ID0gLTE7CiAgICBw\ndWJsaWMgaW50IGRhdGVQcmVjaXNpb24gPSBNSUxMSTsKICAgIHB1YmxpYyBp\nbnQgY2hhcmFjdGVyQ29sdW1uU2l6ZSA9IDI1NTsKICAgIHB1YmxpYyBTdHJp\nbmcgYXJyYXlUeXBlTmFtZSA9ICJBUlJBWSI7CiAgICBwdWJsaWMgU3RyaW5n\nIGJpZ2ludFR5cGVOYW1lID0gIkJJR0lOVCI7CiAgICBwdWJsaWMgU3RyaW5n\nIGJpbmFyeVR5cGVOYW1lID0gIkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5n\nIGJpdFR5cGVOYW1lID0gIkJJVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJsb2JU\neXBlTmFtZSA9ICJCTE9CIjsKICAgIHB1YmxpYyBTdHJpbmcgYm9vbGVhblR5\ncGVOYW1lID0gIkJPT0xFQU4iOwogICAgcHVibGljIFN0cmluZyBjaGFyVHlw\nZU5hbWUgPSAiQ0hBUiI7CiAgICBwdWJsaWMgU3RyaW5nIGNsb2JUeXBlTmFt\nZSA9ICJDTE9CIjsKICAgIHB1YmxpYyBTdHJpbmcgZGF0ZVR5cGVOYW1lID0g\nIkRBVEUiOwogICAgcHVibGljIFN0cmluZyBkZWNpbWFsVHlwZU5hbWUgPSAi\nREVDSU1BTCI7CiAgICBwdWJsaWMgU3RyaW5nIGRpc3RpbmN0VHlwZU5hbWUg\nPSAiRElTVElOQ1QiOwogICAgcHVibGljIFN0cmluZyBkb3VibGVUeXBlTmFt\nZSA9ICJET1VCTEUiOwogICAgcHVibGljIFN0cmluZyBmbG9hdFR5cGVOYW1l\nID0gIkZMT0FUIjsKICAgIHB1YmxpYyBTdHJpbmcgaW50ZWdlclR5cGVOYW1l\nID0gIklOVEVHRVIiOwogICAgcHVibGljIFN0cmluZyBqYXZhT2JqZWN0VHlw\nZU5hbWUgPSAiSkFWQV9PQkpFQ1QiOwogICAgcHVibGljIFN0cmluZyBsb25n\nVmFyYmluYXJ5VHlwZU5hbWUgPSAiTE9OR1ZBUkJJTkFSWSI7CiAgICBwdWJs\naWMgU3RyaW5nIGxvbmdWYXJjaGFyVHlwZU5hbWUgPSAiTE9OR1ZBUkNIQVIi\nOwogICAgcHVibGljIFN0cmluZyBudWxsVHlwZU5hbWUgPSAiTlVMTCI7CiAg\nICBwdWJsaWMgU3RyaW5nIG51bWVyaWNUeXBlTmFtZSA9ICJOVU1FUklDIjsK\nICAgIHB1YmxpYyBTdHJpbmcgb3RoZXJUeXBlTmFtZSA9ICJPVEhFUiI7CiAg\nICBwdWJsaWMgU3RyaW5nIHJlYWxUeXBlTmFtZSA9ICJSRUFMIjsKICAgIHB1\nYmxpYyBTdHJpbmcgcmVmVHlwZU5hbWUgPSAiUkVGIjsKICAgIHB1YmxpYyBT\ndHJpbmcgc21hbGxpbnRUeXBlTmFtZSA9ICJTTUFMTElOVCI7CiAgICBwdWJs\naWMgU3RyaW5nIHN0cnVjdFR5cGVOYW1lID0gIlNUUlVDVCI7CiAgICBwdWJs\naWMgU3RyaW5nIHRpbWVUeXBlTmFtZSA9ICJUSU1FIjsKICAgIHB1YmxpYyBT\ndHJpbmcgdGltZXN0YW1wVHlwZU5hbWUgPSAiVElNRVNUQU1QIjsKICAgIHB1\nYmxpYyBTdHJpbmcgdGlueWludFR5cGVOYW1lID0gIlRJTllJTlQiOwogICAg\ncHVibGljIFN0cmluZyB2YXJiaW5hcnlUeXBlTmFtZSA9ICJWQVJCSU5BUlki\nOwogICAgcHVibGljIFN0cmluZyB2YXJjaGFyVHlwZU5hbWUgPSAiVkFSQ0hB\nUiI7CiAgICBwdWJsaWMgU3RyaW5nIHhtbFR5cGVOYW1lID0gIlhNTCI7CiAg\nICBwdWJsaWMgU3RyaW5nIHhtbFR5cGVFbmNvZGluZyA9ICJVVEYtOCI7CiAg\nICBwdWJsaWMgU3RyaW5nIGdldFN0cmluZ1ZhbCA9ICIiOwoKICAgIC8vIHNj\naGVtYSBtZXRhZGF0YQogICAgcHVibGljIGJvb2xlYW4gdXNlU2NoZW1hTmFt\nZSA9IHRydWU7CiAgICBwdWJsaWMgU3RyaW5nIHRhYmxlVHlwZXMgPSAiVEFC\nTEUiOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRU\nYWJsZXMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTY2hl\nbWFGb3JHZXRDb2x1bW5zID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzTnVsbFRhYmxlRm9yR2V0Q29sdW1ucyA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldFByaW1hcnlLZXlz\nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJs\nZUZvckdldEluZGV4SW5mbyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbXBvcnRlZEtleXMgPSBmYWxzZTsK\nICAgIHB1YmxpYyBib29sZWFuIHVzZUdldEJlc3RSb3dJZGVudGlmaWVyRm9y\nUHJpbWFyeUtleXMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVp\ncmVzQXV0b0NvbW1pdEZvck1ldGFEYXRhID0gZmFsc2U7CgogICAgLy8gYXV0\nby1pbmNyZW1lbnQKICAgIHB1YmxpYyBpbnQgbWF4QXV0b0Fzc2lnbk5hbWVM\nZW5ndGggPSAzMTsKICAgIHB1YmxpYyBTdHJpbmcgYXV0b0Fzc2lnbkNsYXVz\nZSA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIGF1dG9Bc3NpZ25UeXBlTmFt\nZSA9IG51bGw7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0F1dG9Bc3Np\nZ24gPSBmYWxzZTsKICAgIHB1YmxpYyBTdHJpbmcgbGFzdEdlbmVyYXRlZEtl\neVF1ZXJ5ID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgbmV4dFNlcXVlbmNl\nUXVlcnkgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzZXF1ZW5jZVNRTCA9\nIG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHNlcXVlbmNlU2NoZW1hU1FMID0g\nbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VxdWVuY2VOYW1lU1FMID0gbnVs\nbDsKICAgIC8vIG1vc3QgbmF0aXZlIHNlcXVlbmNlcyBjYW4gYmUgcnVuIGlu\nc2lkZSB0aGUgYnVzaW5lc3MgdHJhbnNhY3Rpb24KICAgIHB1YmxpYyBpbnQg\nbmF0aXZlU2VxdWVuY2VUeXBlPSBTZXEuVFlQRV9DT05USUdVT1VTOwoKICAg\nIHByb3RlY3RlZCBKREJDQ29uZmlndXJhdGlvbiBjb25mID0gbnVsbDsKICAg\nIHByb3RlY3RlZCBMb2cgbG9nID0gbnVsbDsKICAgIHByb3RlY3RlZCBib29s\nZWFuIGNvbm5lY3RlZCA9IGZhbHNlOwogICAgcHJvdGVjdGVkIGJvb2xlYW4g\naXNKREJDMyA9IGZhbHNlOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldCByZXNl\ncnZlZFdvcmRTZXQgPSBuZXcgSGFzaFNldCgpOwogICAgLy8gcmVzZXJ2ZWRX\nb3JkU2V0IHN1YnNldCB0aGF0IENBTk5PVCBiZSB1c2VkIGFzIHZhbGlkIGNv\nbHVtbiBuYW1lcwogICAgLy8gKGkuZS4sIHdpdGhvdXQgc3Vycm91bmRpbmcg\ndGhlbSB3aXRoIGRvdWJsZS1xdW90ZXMpCiAgICBwcm90ZWN0ZWQgU2V0PFN0\ncmluZz4gaW52YWxpZENvbHVtbldvcmRTZXQgPSBuZXcgSGFzaFNldDxTdHJp\nbmc+KCk7CiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHN5c3RlbVNjaGVtYVNl\ndCA9IG5ldyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHN5\nc3RlbVRhYmxlU2V0ID0gbmV3IEhhc2hTZXQoKTsKICAgIHByb3RlY3RlZCBm\naW5hbCBTZXQgZml4ZWRTaXplVHlwZU5hbWVTZXQgPSBuZXcgSGFzaFNldCgp\nOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldCB0eXBlTW9kaWZpZXJTZXQgPSBu\nZXcgSGFzaFNldCgpOwogICAgCiAgICBwcml2YXRlIGJvb2xlYW4gZGVsaW1p\ndElkcyA9IGZhbHNlOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3VwcG9ydHNE\nZWxpbWl0ZWRJZHMgPSBmYWxzZTsKICAgIHByb3RlY3RlZCBTdHJpbmcgZGVs\naW1pdGVyID0gIlwiIjsKICAgIC8vIEFzc3VtZSBtaXhlZCBjYXNlIGJ5IGRl\nZmF1bHQuCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGRlbGltaXRlZENhc2UgPSBT\nQ0hFTUFfQ0FTRV9QUkVTRVJWRTsKICAgIAogICAgLy8gVE9ETzogY29tcGxl\ndGUgdGhlIGxpc3QKICAgIHB1YmxpYyBzdGF0aWMgZW51bSBEQklkZW50aWZp\nZXJzIHsKICAgICAgICBUQUJMRV9OQU1FLAogICAgICAgIFRBQkxFX1NDSEVN\nQSwKICAgICAgICBUQUJMRV9DQVRBTE9HLAogICAgICAgIFNFQ09OREFSWV9U\nQUJMRV9OQU1FLAogICAgICAgIFNFQ09OREFSWV9UQUJMRV9TQ0hFTUEsCiAg\nICAgICAgU0VDT05EQVJZX1RBQkxFX0NBVEFMT0csCiAgICAgICAgVEFCTEVf\nR0VOX1RBQkxFLAogICAgICAgIFRBQkxFX0dFTl9TQ0hFTUEsCiAgICAgICAg\nVEFCTEVfR0VOX1BLX0NPTFVNTiwKICAgICAgICBUQUJMRV9HRU5fVkFMVUVf\nQ09MVU1OLAogICAgICAgIENPTFVNTl9OQU1FLAogICAgICAgIENPTFVNTl9D\nT0xVTU5fREVGSU5JVElPTiwKICAgICAgICBDT0xVTU5fVEFCTEUKICAgIH0K\nICAgIAogICAgLy8gVE9ETzogZGVzY3JpYmU7IG1heWJlIG1ha2UgcHJpdmF0\nZQogICAgcHJvdGVjdGVkIEVudW1TZXQ8REJJZGVudGlmaWVycz4gdW5zdXBw\nb3J0ZWREZWxpbWl0ZWRJZHMgPQogICAgICAgIEVudW1TZXQubm9uZU9mKERC\nSWRlbnRpZmllcnMuY2xhc3MpOwogICAgLy8gVE9ETwogICAgLy8gU2hvdWxk\nIHRoaXMgYmUgRW51bVNldC48REJJZGVudGlmaWVycz5ub25lT2YoLi4uLikK\nICAgIC8vIG9yIEVudW1TZXQ8REJJZGVudGlmaWVycz4ubm9uZU9mLi4uLj8K\nCiAgICAvKioKICAgICAqIElmIGEgbmF0aXZlIHF1ZXJ5IGJlZ2lucyB3aXRo\nIGFueSBvZiB0aGUgdmFsdWVzIGZvdW5kIGhlcmUgdGhlbiBpdCB3aWxsCiAg\nICAgKiBiZSB0cmVhdGVkIGFzIGEgc2VsZWN0IHN0YXRlbWVudC4gIAogICAg\nICovCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHNlbGVjdFdvcmRTZXQgPSBu\nZXcgSGFzaFNldCgpOwoKICAgIC8vIHdoZW4gd2Ugc3RvcmUgdmFsdWVzIHRo\nYXQgbG9zZSBwcmVjaXNpb24sIHRyYWNrIHRoZSB0eXBlcyBzbyB0aGF0IHRo\nZQogICAgLy8gZmlyc3QgdGltZSBpdCBoYXBwZW5zIHdlIGNhbiB3YXJuIHRo\nZSB1c2VyCiAgICBwcml2YXRlIFNldCBfcHJlY2lzaW9uV2FybmVkVHlwZXMg\nPSBudWxsOwoKICAgIC8vIGJhdGNoTGltaXQgdmFsdWU6CiAgICAvLyAtMSA9\nIHVubGltaXRlZAogICAgLy8gMCAgPSBubyBiYXRjaAogICAgLy8gYW55IHBv\nc2l0aXZlIG51bWJlciA9IGJhdGNoIGxpbWl0CiAgICBwdWJsaWMgaW50IGJh\ndGNoTGltaXQgPSBOT19CQVRDSDsKICAgIAogICAgcHVibGljIGZpbmFsIE1h\ncDxJbnRlZ2VyLFNldDxTdHJpbmc+PiBzcWxTdGF0ZUNvZGVzID0gCiAgICAg\nICAgbmV3IEhhc2hNYXA8SW50ZWdlciwgU2V0PFN0cmluZz4+KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAg\nIHB1YmxpYyBEQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgZml4ZWRTaXplVHlw\nZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewog\nICAgICAgICAgICAiQklHSU5UIiwgIkJJVCIsICJCTE9CIiwgIkNMT0IiLCAi\nREFURSIsICJERUNJTUFMIiwgIkRJU1RJTkNUIiwKICAgICAgICAgICAgIkRP\nVUJMRSIsICJGTE9BVCIsICJJTlRFR0VSIiwgIkpBVkFfT0JKRUNUIiwgIk5V\nTEwiLCAiTlVNRVJJQyIsIAogICAgICAgICAgICAiT1RIRVIiLCAiUkVBTCIs\nICJSRUYiLCAiU01BTExJTlQiLCAiU1RSVUNUIiwgIlRJTUUiLCAiVElNRVNU\nQU1QIiwKICAgICAgICAgICAgIlRJTllJTlQiLAogICAgICAgIH0pKTsKICAg\nICAgICAKICAgICAgICBzZWxlY3RXb3JkU2V0LmFkZCgiU0VMRUNUIik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hl\nbiB0aGUgZGljdGlvbmFyeSBmaXJzdCBzZWVzIGFueSBjb25uZWN0aW9uLgog\nICAgICogSXQgaXMgdXNlZCB0byBpbml0aWFsaXplIGRpY3Rpb25hcnkgbWV0\nYWRhdGEgaWYgbmVlZGVkLiBJZiB5b3UKICAgICAqIG92ZXJyaWRlIHRoaXMg\nbWV0aG9kLCBiZSBzdXJlIHRvIGNhbGwKICAgICAqIDxjb2RlPnN1cGVyLmNv\nbm5lY3RlZENvbmZpZ3VyYXRpb248L2NvZGU+LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjb25uZWN0ZWRDb25maWd1cmF0aW9uKENvbm5lY3Rpb24gY29u\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nIWNvbm5lY3RlZCkgewogICAgICAgICAgICBEYXRhYmFzZU1ldGFEYXRhIG1l\ndGFEYXRhID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIG1ldGFEYXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBKREJDMy1vbmx5\nIG1ldGhvZCwgc28gaXQgbWlnaHQgdGhyb3cgYSAKICAgICAgICAgICAgICAg\nICAgICAvLyBBYnN0cmFjdE1ldGhvZEVycm9yCiAgICAgICAgICAgICAgICAg\nICAgaXNKREJDMyA9IG1ldGFEYXRhLmdldEpEQkNNYWpvclZlcnNpb24oKSA+\nPSAzOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgaWYgbm90IEpEQkMzCiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKGUudG9TdHJpbmco\nKSwgZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkgeyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAg\nICAgICAgICBsb2cudHJhY2UoREJEaWN0aW9uYXJ5RmFjdG9yeS50b1N0cmlu\nZyhtZXRhRGF0YSkpOwoKICAgICAgICAgICAgICAgIGlmIChpc0pEQkMzKQog\nICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiY29ubmVj\ndGlvbi1kZWZhdWx0cyIsIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAg\nICAgICAgICAgY29ubi5nZXRBdXRvQ29tbWl0KCksIGNvbm4uZ2V0SG9sZGFi\naWxpdHkoKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29ubi5nZXRUcmFu\nc2FjdGlvbklzb2xhdGlvbigpfSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIAogICAgICAgICAgICAvLyBXaGlsZSB3ZSBoYXZlIHRoZSBtZXRhRGF0\nYSwgc2V0IHNvbWUgdmFsdWVzIGZyb20gaXQKICAgICAgICAgICAgc2V0U3Vw\ncG9ydHNEZWxpbWl0ZWRJZHMobWV0YURhdGEpOwogICAgICAgICAgICBzZXRE\nZWxpbWl0ZWRDYXNlKG1ldGFEYXRhKTsKCiAgICAgICAgICAgIC8vIEF1dG8t\nZGV0ZWN0IGdlbmVyYXRlZCBrZXlzIHJldHJpZXZhbCBzdXBwb3J0CiAgICAg\nICAgICAgIC8vIHVubGVzcyB1c2VyIHNwZWNpZmllZCBpdC4KICAgICAgICAg\nICAgaWYgKHN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5cyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZiAoaXNKREJDMykgewogICAgICAgICAgICAgICAg\nICAgIHN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5cyA9CiAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGFEYXRhLnN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5cygp\nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICBzdXBwb3J0c0dldEdlbmVyYXRlZEtleXMgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25u\nZWN0ZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIFJlc3VsdFNldCB3cmFwcGVycwogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBBcnJheSBn\nZXRBcnJheShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEFycmF5\nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBw\ncm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIElu\ncHV0U3RyZWFtIGdldEFzY2lpU3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNv\nbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0QXNjaWlTdHJlYW0oY29sdW1uKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgQmlnRGVjaW1hbCBnZXRCaWdEZWNpbWFs\nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0\ncmluZ3MpIHsKICAgICAgICAgICAgU3RyaW5nIHN0ciA9IGdldFN0cmluZyhy\ncywgY29sdW1uKTsKICAgICAgICAgICAgcmV0dXJuIChzdHIgPT0gbnVsbCkg\nPyBudWxsIDogbmV3IEJpZ0RlY2ltYWwoc3RyKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHJzLmdldEJpZ0RlY2ltYWwoY29sdW1uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIHNwZWNpZmllZCBjb2x1bW4gdmFs\ndWUgYXMgYW4gdW5rbm93biBudW1lcmljIHR5cGU7CiAgICAgKiB3ZSB0cnkg\nZnJvbSB0aGUgbW9zdCBnZW5lcmljIHRvIHRoZSBsZWFzdCBnZW5lcmljLgog\nICAgICovCiAgICBwdWJsaWMgTnVtYmVyIGdldE51bWJlcihSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gdHJ5IGZyb20gdGhlIG1vc3QgZ2VuZXJpYywgYW5kIGlm\nIGVycm9ycyBvY2N1ciwgdHJ5CiAgICAgICAgLy8gbGVzcyBnZW5lcmljIHR5\ncGVzOyB0aGlzIGVuYWJsZXMgdXMgdG8gaGFuZGxlIHZhbHVlcwogICAgICAg\nIC8vIGxpa2UgRG91YmxlLk5hTiB3aXRob3V0IGhhdmluZyB0byBpbnRyb3Nw\nZWN0IG9uIHRoZQogICAgICAgIC8vIFJlc3VsdFNldE1ldGFEYXRhIChidWcg\nIzEwNTMpLiBOb3RlIHRoYXQgd2UgaGFuZGxlCiAgICAgICAgLy8gZ2VuZXJp\nYyBleGNlcHRpb25zLCBzaW5jZSBzb21lIGRyaXZlcnMgbWF5IHRocm93CiAg\nICAgICAgLy8gTnVtYmVyRm9ybWF0RXhjZXB0aW9ucywgd2hlcmVhcyBvdGhl\ncnMgbWF5IHRocm93IFNRTEV4Y2VwdGlvbnMKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gZ2V0QmlnRGVjaW1hbChycywgY29sdW1uKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTEpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlKGdldERvdWJs\nZShycywgY29sdW1uKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlMikgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IEZsb2F0KGdldEZsb2F0KHJzLCBjb2x1bW4pKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMykgewogICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZ2V0TG9uZyhycywgY29sdW1uKSk7\nCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGU0KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGdldEludChy\ncywgY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlNSkgewogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAoZTEgaW5zdGFuY2VvZiBSdW50aW1l\nRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdGhyb3coUnVudGltZUV4Y2Vw\ndGlvbikgZTE7CiAgICAgICAgICAgIGlmIChlMSBpbnN0YW5jZW9mIFNRTEV4\nY2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikg\nZTE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgQmlnSW50ZWdlciBnZXRCaWdJbnRl\nZ2VyKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNB\nc1N0cmluZ3MpIHsKICAgICAgICAgICAgU3RyaW5nIHN0ciA9IGdldFN0cmlu\nZyhycywgY29sdW1uKTsKICAgICAgICAgICAgcmV0dXJuIChzdHIgPT0gbnVs\nbCkgPyBudWxsIDogbmV3IEJpZ0RlY2ltYWwoc3RyKS50b0JpZ0ludGVnZXIo\nKTsKICAgICAgICB9CiAgICAgICAgQmlnRGVjaW1hbCBiZCA9IGdldEJpZ0Rl\nY2ltYWwocnMsIGNvbHVtbik7CiAgICAgICAgcmV0dXJuIChiZCA9PSBudWxs\nKSA/IG51bGwgOiBiZC50b0JpZ0ludGVnZXIoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgSW5wdXRTdHJlYW0gZ2V0QmluYXJ5U3RyZWFt\nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QmluYXJ5U3RyZWFt\nKGNvbHVtbik7CiAgICB9CgogICAgcHVibGljIElucHV0U3RyZWFtIGdldExP\nQlN0cmVhbShKREJDU3RvcmUgc3RvcmUsIFJlc3VsdFNldCBycywKICAgICAg\nICBpbnQgY29sdW1uKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0QmluYXJ5U3RyZWFtKGNvbHVtbik7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBCbG9iIGdldEJsb2IoUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBycy5nZXRCbG9iKGNvbHVtbik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRCbG9iT2Jq\nZWN0KFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgSkRCQ1N0b3JlIHN0b3Jl\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIElucHV0\nU3RyZWFtIGluID0gbnVsbDsKICAgICAgICBpZiAodXNlR2V0Qnl0ZXNGb3JC\nbG9icyB8fCB1c2VHZXRPYmplY3RGb3JCbG9icykgewogICAgICAgICAgICBi\neXRlW10gYnl0ZXMgPSBnZXRCeXRlcyhycywgY29sdW1uKTsKICAgICAgICAg\nICAgaWYgKGJ5dGVzICE9IG51bGwgJiYgYnl0ZXMubGVuZ3RoID4gMCkKICAg\nICAgICAgICAgICAgIGluID0gbmV3IEJ5dGVBcnJheUlucHV0U3RyZWFtKGJ5\ndGVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBCbG9iIGJsb2Ig\nPSBnZXRCbG9iKHJzLCBjb2x1bW4pOwogICAgICAgICAgICBpZiAoYmxvYiAh\nPSBudWxsICYmIGJsb2IubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAgICAg\naW4gPSBibG9iLmdldEJpbmFyeVN0cmVhbSgpOwogICAgICAgIH0KICAgICAg\nICBpZiAoaW4gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzdG9yZSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIFNlcmlhbGl6YXRpb24uZGVzZXJpYWxp\nemUoaW4sIG51bGwpOwogICAgICAgICAgICByZXR1cm4gU2VyaWFsaXphdGlv\nbi5kZXNlcmlhbGl6ZShpbiwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgaW4uY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRp\nb24gaW9lKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Qm9vbGVhbihSZXN1\nbHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJvb2xlYW4oY29sdW1uKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBj\nb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAg\nICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgYnl0ZSBnZXRCeXRl\nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Qnl0ZShjb2x1bW4p\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlW10gZ2V0\nQnl0ZXMoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh1c2VHZXRCeXRlc0ZvckJs\nb2JzKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0Qnl0ZXMoY29sdW1uKTsK\nICAgICAgICBpZiAodXNlR2V0T2JqZWN0Rm9yQmxvYnMpCiAgICAgICAgICAg\nIHJldHVybiAoYnl0ZVtdKSBycy5nZXRPYmplY3QoY29sdW1uKTsKCiAgICAg\nICAgQmxvYiBibG9iID0gZ2V0QmxvYihycywgY29sdW1uKTsKICAgICAgICBp\nZiAoYmxvYiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpbnQgbGVuZ3RoID0gKGludCkgYmxvYi5sZW5ndGgoKTsKICAgICAg\nICBpZiAobGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIHJldHVybiBibG9iLmdldEJ5dGVzKDEsIGxlbmd0aCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4gQ29udmVydHMgdGhlIGRhdGUgZnJvbSBhIHtAbGluayBUaW1l\nc3RhbXB9IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBDYWxlbmRh\nciBnZXRDYWxlbmRhcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRGF0ZSBkID0gZ2V0\nRGF0ZShycywgY29sdW1uKTsKICAgICAgICBpZiAoZCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ2FsZW5kYXIgY2FsID0g\nQ2FsZW5kYXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICBjYWwuc2V0VGltZShk\nKTsKICAgICAgICByZXR1cm4gY2FsOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBjaGFyIGdldENoYXIoUmVzdWx0U2V0IHJzLCBpbnQgY29s\ndW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChzdG9yZUNoYXJzQXNOdW1iZXJzKQogICAgICAgICAgICByZXR1cm4gKGNo\nYXIpIGdldEludChycywgY29sdW1uKTsKCiAgICAgICAgU3RyaW5nIHN0ciA9\nIGdldFN0cmluZyhycywgY29sdW1uKTsKICAgICAgICByZXR1cm4gKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkoc3RyKSkgPyAwIDogc3RyLmNoYXJBdCgwKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgUmVhZGVyIGdldENoYXJh\nY3RlclN0cmVhbShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldENo\nYXJhY3RlclN0cmVhbShjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBDbG9iIGdldENsb2IoUmVzdWx0U2V0IHJzLCBpbnQgY29s\ndW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBycy5nZXRDbG9iKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVz\ndWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRDbG9iU3RyaW5nKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAodXNlR2V0U3RyaW5nRm9yQ2xvYnMpCiAgICAgICAgICAg\nIHJldHVybiBycy5nZXRTdHJpbmcoY29sdW1uKTsKCiAgICAgICAgQ2xvYiBj\nbG9iID0gZ2V0Q2xvYihycywgY29sdW1uKTsKICAgICAgICBpZiAoY2xvYiA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\nY2xvYi5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gIiI7Cgog\nICAgICAgIC8vIHVubGlrZWx5IHRoYXQgd2UnbGwgaGF2ZSBzdHJpbmdzIG92\nZXIgSW50ZWdlci5NQVhfVkFMVUUgY2hhcnMKICAgICAgICByZXR1cm4gY2xv\nYi5nZXRTdWJTdHJpbmcoMSwgKGludCkgY2xvYi5sZW5ndGgoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4gQ29udmVydHMgdGhlIGRhdGUgZnJvbSBhIHtAbGluayBUaW1l\nc3RhbXB9IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBEYXRlIGdl\ndERhdGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIFRpbWVzdGFtcCB0c3RhbXAgPSBn\nZXRUaW1lc3RhbXAocnMsIGNvbHVtbiwgbnVsbCk7CiAgICAgICAgaWYgKHRz\ndGFtcCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgLy8gZ2V0IHRoZSBmcmFjdGlvbmFsIHNlY29uZHMgY29tcG9uZW50LCBy\nb3VuZGluZyBhd2F5IGFueXRoaW5nIGJleW9uZAogICAgICAgIC8vIG1pbGxp\nc2Vjb25kcwogICAgICAgIGludCBmcmFjdGlvbmFsID0gKGludCkgTWF0aC5y\nb3VuZCh0c3RhbXAuZ2V0TmFub3MoKSAvIChkb3VibGUpIE1JTExJKTsKCiAg\nICAgICAgLy8gZ2V0IHRoZSBtaWxsaXMgY29tcG9uZW50OyBzb21lIEpEQkMg\nZHJpdmVycyByb3VuZCB0aGlzIHRvIHRoZQogICAgICAgIC8vIG5lYXJlc3Qg\nc2Vjb25kLCB3aGlsZSBvdGhlcnMgZG8gbm90CiAgICAgICAgbG9uZyBtaWxs\naXMgPSAodHN0YW1wLmdldFRpbWUoKSAvIDEwMDBMKSAqIDEwMDBMOwogICAg\nICAgIHJldHVybiBuZXcgRGF0ZShtaWxsaXMgKyBmcmFjdGlvbmFsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgamF2YS5zcWwuRGF0ZSBn\nZXREYXRlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgQ2FsZW5kYXIgY2Fs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChj\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJzLmdldERhdGUoY29s\ndW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0RGF0ZShjb2x1bW4sIGNhbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGRvdWJsZSBnZXRE\nb3VibGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXREb3VibGUo\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgZmxv\nYXQgZ2V0RmxvYXQoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRG\nbG9hdChjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0\naGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0\naGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBpbnQgZ2V0SW50KFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0\nSW50KGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRo\nZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRo\nZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGlj\nIExvY2FsZSBnZXRMb2NhbGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBz\ndHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkoc3RyKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIFN0cmluZ1tdIHBhcmFtcyA9IFN0cmluZ3Muc3BsaXQoc3Ry\nLCAiXyIsIDMpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoIDwgMykKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIG5ldyBMb2Nh\nbGUocGFyYW1zWzBdLCBwYXJhbXNbMV0sIHBhcmFtc1syXSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9m\nIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEg\ndHlwZS4KICAgICAqLwogICAgcHVibGljIGxvbmcgZ2V0TG9uZyhSZXN1bHRT\nZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldExvbmcoY29sdW1uKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4g\nb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2\nYSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldE9iamVjdChS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIE1hcCBtYXApCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG1hcCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gcnMuZ2V0T2JqZWN0KGNvbHVtbik7CiAgICAg\nICAgcmV0dXJuIHJzLmdldE9iamVjdChjb2x1bW4sIG1hcCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9m\nIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEg\ndHlwZS4KICAgICAqLwogICAgcHVibGljIFJlZiBnZXRSZWYoUmVzdWx0U2V0\nIHJzLCBpbnQgY29sdW1uLCBNYXAgbWFwKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRSZWYoY29sdW1uKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBj\nb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAg\nICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgc2hvcnQgZ2V0U2hv\ncnQoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRTaG9ydChjb2x1\nbW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0U3RyaW5nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0U3Ry\naW5nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRo\nZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRo\nZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGlj\nIFRpbWUgZ2V0VGltZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENhbGVu\nZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5nZXRU\naW1lKGNvbHVtbik7CiAgICAgICAgcmV0dXJuIHJzLmdldFRpbWUoY29sdW1u\nLCBjYWwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3Bl\nY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJv\ncGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBUaW1l\nc3RhbXAgZ2V0VGltZXN0YW1wKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwg\nQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJz\nLmdldFRpbWVzdGFtcChjb2x1bW4pOwogICAgICAgIHJldHVybiBycy5nZXRU\naW1lc3RhbXAoY29sdW1uLCBjYWwpOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHJlcGFyZWRTdGF0ZW1lbnQg\nd3JhcHBlcnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRBcnJheShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\nQXJyYXkgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QXJyYXkoaWR4LCB2\nYWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRBc2NpaVN0cmVhbShQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwKICAgICAgICBJbnB1dFN0cmVhbSB2YWwsIGlu\ndCBsZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QXNjaWlTdHJlYW0oaWR4LCB2YWws\nIGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpZ0RlY2ltYWwoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIEJpZ0RlY2ltYWwgdmFsLAogICAgICAg\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKChjb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21wYXRpYmxlKFR5\ncGVzLlZBUkNIQVIsIG51bGwsIDAsIDApKQogICAgICAgICAgICB8fCAoY29s\nID09IG51bGwgJiYgc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpKQogICAg\nICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCks\nIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udC5zZXRCaWdE\nZWNpbWFsKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QmlnSW50ZWdlcihQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQmlnSW50ZWdlciB2YWws\nCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoKGNvbCAhPSBudWxsICYmIGNvbC5pc0NvbXBh\ndGlibGUoVHlwZXMuVkFSQ0hBUiwgbnVsbCwgMCwgMCkpCiAgICAgICAgICAg\nIHx8IChjb2wgPT0gbnVsbCAmJiBzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5n\ncykpCiAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCB2YWwudG9T\ndHJpbmcoKSwgY29sKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldEJp\nZ0RlY2ltYWwoc3RtbnQsIGlkeCwgbmV3IEJpZ0RlY2ltYWwodmFsKSwgY29s\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0QmluYXJ5U3RyZWFtKFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50LCBpbnQgaWR4LAogICAgICAgIElucHV0U3RyZWFtIHZhbCwgaW50\nIGxlbmd0aCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXRCaW5hcnlTdHJlYW0oaWR4LCB2YWws\nIGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEJsb2IoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIEJsb2IgdmFsLCBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEJsb2Io\naWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZl\nbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LiBVc2Vz\nIHRoZQogICAgICoge0BsaW5rICNzZXJpYWxpemV9IG1ldGhvZCB0byBzZXJp\nYWxpemUgdGhlIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRC\nbG9iT2JqZWN0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBP\nYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wsIEpEQkNTdG9yZSBzdG9y\nZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRC\neXRlcyhzdG1udCwgaWR4LCBzZXJpYWxpemUodmFsLCBzdG9yZSksIGNvbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEJvb2xlYW4oUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nIGludCBpZHgsIGJvb2xlYW4gdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0\nSW50KGlkeCwgKHZhbCkgPyAxIDogMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBz\ndGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJ5dGUoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGJ5dGUgdmFsLCBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHN0bW50LnNldEJ5dGUoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUg\nc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCeXRlcyhQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgYnl0ZVtdIHZhbCwK\nICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICh1c2VTZXRCeXRlc0ZvckJsb2JzKQogICAgICAg\nICAgICBzdG1udC5zZXRCeXRlcyhpZHgsIHZhbCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzZXRCaW5hcnlTdHJlYW0oc3RtbnQsIGlkeCwgbmV3IEJ5\ndGVBcnJheUlucHV0U3RyZWFtKHZhbCksCiAgICAgICAgICAgICAgICB2YWwu\nbGVuZ3RoLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDaGFyKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBjaGFyIHZhbCwgQ29sdW1uIGNvbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoKGNvbCAh\nPSBudWxsICYmIGNvbC5pc0NvbXBhdGlibGUoVHlwZXMuSU5URUdFUiwgbnVs\nbCwgMCwgMCkpCiAgICAgICAgICAgIHx8IChjb2wgPT0gbnVsbCAmJiBzdG9y\nZUNoYXJzQXNOdW1iZXJzKSkKICAgICAgICAgICAgc2V0SW50KHN0bW50LCBp\nZHgsIChpbnQpIHZhbCwgY29sKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHNldFN0cmluZyhzdG1udCwgaWR4LCBTdHJpbmcudmFsdWVPZih2YWwpLCBj\nb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRDaGFyYWN0ZXJTdHJlYW0oUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAgICAgUmVhZGVyIHZhbCwgaW50\nIGxlbmd0aCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXRDaGFyYWN0ZXJTdHJlYW0oaWR4LCB2\nYWwsIGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENsb2IoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIENsb2IgdmFsLCBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldENs\nb2IoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDbG9iU3RyaW5nKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBTdHJpbmcgdmFsLAogICAgICAg\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHVzZVNldFN0cmluZ0ZvckNsb2JzKQogICAgICAgICAgICBz\ndG1udC5zZXRTdHJpbmcoaWR4LCB2YWwpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICAvLyBzZXQgcmVhZGVyIGZyb20gc3RyaW5nCiAgICAgICAgICAg\nIFN0cmluZ1JlYWRlciBpbiA9IG5ldyBTdHJpbmdSZWFkZXIodmFsKTsKICAg\nICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50LCBpZHgsIGluLCB2\nYWwubGVuZ3RoKCksIGNvbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0\naGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRl\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBEYXRlIHZhbCwg\nQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoY29sICE9IG51bGwgJiYgY29sLmdldFR5cGUoKSA9PSBUeXBl\ncy5EQVRFKQogICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIG5ldyBq\nYXZhLnNxbC5EYXRlKHZhbC5nZXRUaW1lKCkpLCBudWxsLCBjb2wpOwogICAg\nICAgIGVsc2UgaWYgKGNvbCAhPSBudWxsICYmIGNvbC5nZXRUeXBlKCkgPT0g\nVHlwZXMuVElNRSkKICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4LCBu\nZXcgVGltZSh2YWwuZ2V0VGltZSgpKSwgbnVsbCwgY29sKTsKICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lc3RhbXApCiAgICAgICAgICAg\nIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LChUaW1lc3RhbXApIHZhbCwgbnVs\nbCwgY29sKTsgICAKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldFRpbWVz\ndGFtcChzdG1udCwgaWR4LCBuZXcgVGltZXN0YW1wKHZhbC5nZXRUaW1lKCkp\nLCBudWxsLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRlKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBqYXZhLnNxbC5EYXRlIHZhbCwKICAgICAg\nICBDYWxlbmRhciBjYWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAg\nICAgICBzdG1udC5zZXREYXRlKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHN0bW50LnNldERhdGUoaWR4LCB2YWwsIGNhbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFy\nYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldENhbGVuZGFyKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBDYWxlbmRhciB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBieSBkZWZhdWx0\nIHdlIG1lcmVseSBkZWxlZ2F0ZSB0byB0aGUgRGF0ZSBwYXJhbWV0ZXIKICAg\nICAgICBzZXREYXRlKHN0bW50LCBpZHgsIHZhbC5nZXRUaW1lKCksIGNvbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldERvdWJsZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgZG91YmxlIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldERv\ndWJsZShpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEZsb2F0KFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBmbG9hdCB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBzdG1udC5zZXRGbG9hdChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEludChQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgaW50IHZhbCwgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBzdG1udC5zZXRJbnQoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUg\nc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMb25nKFBy\nZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBsb25nIHZhbCwgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBzdG1udC5zZXRMb25nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhl\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TG9jYWxl\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBMb2NhbGUgdmFs\nLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC5nZXRM\nYW5ndWFnZSgpICsgIl8iICsgdmFsLmdldENvdW50cnkoKQogICAgICAgICAg\nICArICJfIiArIHZhbC5nZXRWYXJpYW50KCksIGNvbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgbnVsbCBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3Rh\ndGVtZW50LiBUaGUgY29sdW1uCiAgICAgKiB0eXBlIHdpbGwgY29tZSBmcm9t\nIHtAbGluayBUeXBlc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE51\nbGwoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGludCBjb2xU\neXBlLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0TnVsbChpZHgsIGNvbFR5cGUp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBh\ncyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXROdW1iZXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nIGludCBpZHgsIE51bWJlciBudW0sCiAgICAgICAgQ29sdW1uIGNvbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBjaGVjayBm\nb3Iga25vd24gZmxvYXRpbmcgcG9pbnQgdHlwZXMgdG8gZ2l2ZSBkcml2ZXIg\nYSBjaGFuY2UgdG8KICAgICAgICAvLyBoYW5kbGUgc3BlY2lhbCBudW1iZXJz\nIGxpa2UgTmFOIGFuZCBpbmZpbml0eTsgYnVnICMxMDUzCiAgICAgICAgaWYg\nKG51bSBpbnN0YW5jZW9mIERvdWJsZSkKICAgICAgICAgICAgc2V0RG91Ymxl\nKHN0bW50LCBpZHgsICgoRG91YmxlKSBudW0pLmRvdWJsZVZhbHVlKCksIGNv\nbCk7CiAgICAgICAgZWxzZSBpZiAobnVtIGluc3RhbmNlb2YgRmxvYXQpCiAg\nICAgICAgICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoRmxvYXQpIG51bSku\nZmxvYXRWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCBuZXcgQmlnRGVjaW1hbChudW0u\ndG9TdHJpbmcoKSksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1l\nbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBjb21lIGZyb20ge0Bs\naW5rIFR5cGVzfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0T2JqZWN0\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBPYmplY3QgdmFs\nLAogICAgICAgIGludCBjb2xUeXBlLCBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjb2xUeXBlID09IC0x\nIHx8IGNvbFR5cGUgPT0gVHlwZXMuT1RIRVIpCiAgICAgICAgICAgIHN0bW50\nLnNldE9iamVjdChpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBzdG1udC5zZXRPYmplY3QoaWR4LCB2YWwsIGNvbFR5cGUpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRSZWYoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIFJl\nZiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0UmVmKGlkeCwgdmFsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0U2hvcnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIHNo\nb3J0IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldFNob3J0KGlkeCwgdmFs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0U3RyaW5nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBTdHJpbmcgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0\nU3RyaW5nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VGltZShQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwgVGltZSB2YWwsCiAgICAgICAgQ2Fs\nZW5kYXIgY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAg\nc3RtbnQuc2V0VGltZShpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG1udC5zZXRUaW1lKGlkeCwgdmFsLCBjYWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\nciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRUaW1lc3RhbXAoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgs\nCiAgICAgICAgVGltZXN0YW1wIHZhbCwgQ2FsZW5kYXIgY2FsLCBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8v\nIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBpbnNlcnQgZGF0ZXMgYXQgYSBncmVh\ndGVyIHByZWNpc2lvbiB0aGFuCiAgICAgICAgLy8gdGhhdCBhdCB3aGljaCB0\naGV5IHdpbGwgYmUgcmV0dXJuZWQgYnkgYSBTRUxFQ1QKICAgICAgICBpbnQg\ncm91bmRlZCA9IChpbnQpIE1hdGgucm91bmQodmFsLmdldE5hbm9zKCkgLwog\nICAgICAgICAgICAoZG91YmxlKSBkYXRlUHJlY2lzaW9uKTsKICAgICAgICBp\nbnQgbmFub3MgPSByb3VuZGVkICogZGF0ZVByZWNpc2lvbjsKICAgICAgICBp\nZiAobmFub3MgPiA5OTk5OTk5OTkpIHsKICAgICAgICAgICAgLy8gcm9sbG92\nZXIgdG8gbmV4dCBzZWNvbmQKICAgICAgICAgICAgdmFsLnNldFRpbWUodmFs\nLmdldFRpbWUoKSArIDEwMDApOwogICAgICAgICAgICBuYW5vcyA9IDA7CiAg\nICAgICAgfQoKICAgICAgICB2YWwuc2V0TmFub3MobmFub3MpOwoKICAgICAg\nICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0bW50LnNldFRpbWVz\ndGFtcChpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1u\ndC5zZXRUaW1lc3RhbXAoaWR4LCB2YWwsIGNhbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgYSBjb2x1bW4gdmFsdWUgaW50byBhIHByZXBhcmVkIHN0\nYXRlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RtbnQgdGhlIHByZXBh\ncmVkIHN0YXRlbWVudCB0byBwYXJhbWV0ZXJpemUKICAgICAqIEBwYXJhbSBp\nZHggdGhlIGluZGV4IG9mIHRoZSBwYXJhbWV0ZXIgaW4gdGhlIHByZXBhcmVk\nIHN0YXRlbWVudAogICAgICogQHBhcmFtIHZhbCB0aGUgdmFsdWUgb2YgdGhl\nIGNvbHVtbgogICAgICogQHBhcmFtIGNvbCB0aGUgY29sdW1uIGJlaW5nIHNl\ndAogICAgICogQHBhcmFtIHR5cGUgdGhlIGZpZWxkIG1hcHBpbmcgdHlwZSBj\nb2RlIGZvciB0aGUgdmFsdWUKICAgICAqIEBwYXJhbSBzdG9yZSB0aGUgc3Rv\ncmUgbWFuYWdlciBmb3IgdGhlIGN1cnJlbnQgY29udGV4dAogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRUeXBlZChQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29sLCBp\nbnQgdHlwZSwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAgICAg\nICAgICBzZXROdWxsKHN0bW50LCBpZHgsIChjb2wgPT0gbnVsbCkgPyBUeXBl\ncy5PVEhFUiA6IGNvbC5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBjb2wp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBTaXpl\nZCBzOwogICAgICAgIENhbGVuZGFyZCBjOwogICAgICAgIHN3aXRjaCAodHlw\nZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAg\nICAgICAgIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwgKChCb29sZWFuKSB2YWwp\nLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgc2V0\nQnl0ZShzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5ieXRlVmFsdWUoKSwg\nY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nSEFSX09CSjoKICAgICAgICAgICAgICAgIHNldENoYXIoc3RtbnQsIGlkeCwg\nKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCksIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9V\nQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgog\nICAgICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgsICgoTnVtYmVy\nKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAg\nICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmZsb2F0\nVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBzZXRJbnQoc3RtbnQs\nIGlkeCwgKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT05HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAg\nICAgICAgICAgICAgIHNldExvbmcoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZh\nbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgIHNl\ndFNob3J0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLnNob3J0VmFsdWUo\nKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBpZiAoY29s\nICE9IG51bGwgJiYgKGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0xPQgogICAg\nICAgICAgICAgICAgICAgIHx8IGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuTE9O\nR1ZBUkNIQVIpKQogICAgICAgICAgICAgICAgICAgIHNldENsb2JTdHJpbmco\nc3RtbnQsIGlkeCwgKFN0cmluZykgdmFsLCBjb2wpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwg\naWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAg\nICAgICAgICAgc2V0QmxvYk9iamVjdChzdG1udCwgaWR4LCB2YWwsIGNvbCwg\nc3RvcmUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBzZXREYXRlKHN0\nbW50LCBpZHgsIChEYXRlKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAg\nICAgICAgICAgICAgICBzZXRDYWxlbmRhcihzdG1udCwgaWR4LCAoQ2FsZW5k\nYXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAgICAg\nICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVjaW1hbCkgdmFs\nLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICBzZXRC\naWdJbnRlZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNvbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgc2V0TnVtYmVyKHN0bW50\nLCBpZHgsIChOdW1iZXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAg\nICAgICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2FsZSkgdmFs\nLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAgICAgICAgICAgIHNl\ndEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVz\nLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZh\nbDsKICAgICAgICAgICAgICAgIHNldEFzY2lpU3RyZWFtKHN0bW50LCBpZHgs\nIChJbnB1dFN0cmVhbSkgcy52YWx1ZSwgcy5zaXplLCBjb2wpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVz\nLkJJTkFSWV9TVFJFQU06CiAgICAgICAgICAgICAgICBzID0gKFNpemVkKSB2\nYWw7CiAgICAgICAgICAgICAgICBzZXRCaW5hcnlTdHJlYW0oc3RtbnQsIGlk\neCwgKElucHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlw\nZXMuQkxPQjoKICAgICAgICAgICAgICAgIHNldEJsb2Ioc3RtbnQsIGlkeCwg\nKEJsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoKICAgICAgICAgICAg\nICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZhbCwgY29sKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFT\nUUxUeXBlcy5DSEFSX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6\nZWQpIHZhbDsKICAgICAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVhbShz\ndG1udCwgaWR4LCAoUmVhZGVyKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FM\nVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHNldENsb2Ioc3RtbnQsIGlk\neCwgKENsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfREFURToKICAgICAg\nICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcmQpIHsKICAg\nICAgICAgICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFsOwogICAgICAg\nICAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRh\ndGUpIGMudmFsdWUsIGMuY2FsZW5kYXIsCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChqYXZhLnNxbC5EYXRlKSB2\nYWwsIG51bGwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuUkVGOgogICAgICAgICAgICAgICAg\nc2V0UmVmKHN0bW50LCBpZHgsIChSZWYpIHZhbCwgY29sKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5U\nSU1FOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVu\nZGFyZCkgewogICAgICAgICAgICAgICAgICAgIGMgPSAoQ2FsZW5kYXJkKSB2\nYWw7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4LCAo\nVGltZSkgYy52YWx1ZSwgYy5jYWxlbmRhciwgY29sKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFRpbWUoc3RtbnQs\nIGlkeCwgKFRpbWUpIHZhbCwgbnVsbCwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5USU1FU1RB\nTVA6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5k\nYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQpIHZh\nbDsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlk\neCwgKFRpbWVzdGFtcCkgYy52YWx1ZSwgYy5jYWxlbmRhciwKICAgICAgICAg\nICAgICAgICAgICAgICAgY29sKTsKICAgICAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAo\nVGltZXN0YW1wKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlm\nIChjb2wgIT0gbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5CTE9C\nCiAgICAgICAgICAgICAgICAgICAgfHwgY29sLmdldFR5cGUoKSA9PSBUeXBl\ncy5WQVJCSU5BUlkpKQogICAgICAgICAgICAgICAgICAgIHNldEJsb2JPYmpl\nY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2wsIHN0b3JlKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRPYmplY3Qoc3RtbnQs\nIGlkeCwgdmFsLCBjb2wuZ2V0VHlwZSgpLCBjb2wpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCBhIGNvbXBsZXRlbHkgdW5rbm93biBw\nYXJhbWV0ZXIgaW50byBhIHByZXBhcmVkIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0VW5rbm93bihQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29s\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNpemVk\nIHNpemVkID0gbnVsbDsKICAgICAgICBDYWxlbmRhcmQgY2FsZCA9IG51bGw7\nCiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFNpemVkKSB7CiAgICAgICAg\nICAgIHNpemVkID0gKFNpemVkKSB2YWw7CiAgICAgICAgICAgIHZhbCA9IHNp\nemVkLnZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodmFsIGluc3RhbmNlb2Yg\nQ2FsZW5kYXJkKSB7CiAgICAgICAgICAgIGNhbGQgPSAoQ2FsZW5kYXJkKSB2\nYWw7CiAgICAgICAgICAgIHZhbCA9IGNhbGQudmFsdWU7CiAgICAgICAgfQoK\nICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHNldE51bGwo\nc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVzLk9USEVSIDogY29s\nLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICBzZXRT\ndHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCksIGNvbCk7CiAgICAg\nICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgSW50ZWdlcikKICAgICAgICAg\nICAgc2V0SW50KHN0bW50LCBpZHgsICgoSW50ZWdlcikgdmFsKS5pbnRWYWx1\nZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJv\nb2xlYW4pCiAgICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwgKChC\nb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwogICAgICAgIGVs\nc2UgaWYgKHZhbCBpbnN0YW5jZW9mIExvbmcpCiAgICAgICAgICAgIHNldExv\nbmcoc3RtbnQsIGlkeCwgKChMb25nKSB2YWwpLmxvbmdWYWx1ZSgpLCBjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEZsb2F0KQogICAg\nICAgICAgICBzZXRGbG9hdChzdG1udCwgaWR4LCAoKEZsb2F0KSB2YWwpLmZs\nb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFu\nY2VvZiBEb3VibGUpCiAgICAgICAgICAgIHNldERvdWJsZShzdG1udCwgaWR4\nLCAoKERvdWJsZSkgdmFsKS5kb3VibGVWYWx1ZSgpLCBjb2wpOwogICAgICAg\nIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJ5dGUpCiAgICAgICAgICAgIHNl\ndEJ5dGUoc3RtbnQsIGlkeCwgKChCeXRlKSB2YWwpLmJ5dGVWYWx1ZSgpLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENoYXJhY3Rl\ncikKICAgICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAoKENoYXJhY3Rl\ncikgdmFsKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBTaG9ydCkKICAgICAgICAgICAgc2V0U2hvcnQoc3Rt\nbnQsIGlkeCwgKChTaG9ydCkgdmFsKS5zaG9ydFZhbHVlKCksIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgTG9jYWxlKQogICAgICAg\nICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2FsZSkgdmFsLCBjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJpZ0RlY2ltYWwp\nCiAgICAgICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgKEJpZ0Rl\nY2ltYWwpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFu\nY2VvZiBCaWdJbnRlZ2VyKQogICAgICAgICAgICBzZXRCaWdJbnRlZ2VyKHN0\nbW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXkpCiAgICAgICAgICAgIHNldEFy\ncmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wpOwogICAgICAgIGVs\nc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJsb2IpCiAgICAgICAgICAgIHNldEJs\nb2Ioc3RtbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBieXRlW10pCiAgICAgICAgICAgIHNldEJ5\ndGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZhbCwgY29sKTsKICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDbG9iKQogICAgICAgICAgICBzZXRD\nbG9iKHN0bW50LCBpZHgsIChDbG9iKSB2YWwsIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgUmVmKQogICAgICAgICAgICBzZXRSZWYo\nc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIGphdmEuc3FsLkRhdGUpCiAgICAgICAgICAgIHNl\ndERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZhbCwKICAgICAg\nICAgICAgICAgIChjYWxkID09IG51bGwpID8gbnVsbCA6IGNhbGQuY2FsZW5k\nYXIsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgVGlt\nZXN0YW1wKQogICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwg\nKFRpbWVzdGFtcCkgdmFsLAogICAgICAgICAgICAgICAgKGNhbGQgPT0gbnVs\nbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwgY29sKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lKQogICAgICAgICAgICBzZXRUaW1l\nKHN0bW50LCBpZHgsIChUaW1lKSB2YWwsCiAgICAgICAgICAgICAgICAoY2Fs\nZCA9PSBudWxsKSA/IG51bGwgOiBjYWxkLmNhbGVuZGFyLCBjb2wpOwogICAg\nICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpCiAgICAgICAgICAg\nIHNldERhdGUoc3RtbnQsIGlkeCwgKERhdGUpIHZhbCwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcikKICAgICAgICAg\nICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoKENhbGVuZGFyKSB2YWwpLmdldFRp\nbWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBS\nZWFkZXIpCiAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVhbShzdG1udCwg\naWR4LCAoUmVhZGVyKSB2YWwsCiAgICAgICAgICAgICAgICAoc2l6ZWQgPT0g\nbnVsbCkgPyAwIDogc2l6ZWQuc2l6ZSwgY29sKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtcGFyYW0iLCB2YWwuZ2V0Q2xhc3MoKSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBzZXJpYWxpemVkIGJ5dGVzIGZvciB0aGUgZ2l2\nZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgYnl0ZVtdIHNlcmlhbGl6\nZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAodmFsIGluc3RhbmNl\nb2YgU2VyaWFsaXplZERhdGEpCiAgICAgICAgICAgIHJldHVybiAoKFNlcmlh\nbGl6ZWREYXRhKSB2YWwpLmJ5dGVzOwogICAgICAgIHJldHVybiBTZXJpYWxp\nemF0aW9uLnNlcmlhbGl6ZSh2YWwsIHN0b3JlLmdldENvbnRleHQoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIEpESyAxLjQgPGNvZGU+\nc2V0Qnl0ZXM8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQkxPQiBvYmpl\nY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dEJ5dGVzKEJsb2IgYmxv\nYiwgYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgYmxvYi5zZXRCeXRlcygxTCwgZGF0YSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJbnZva2UgdGhlIEpESyAxLjQgPGNvZGU+c2V0U3RyaW5n\nPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIENMT0IKICAgICAqIG9iamVj\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0U3RyaW5nKENsb2IgY2xv\nYiwgU3RyaW5nIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgY2xvYi5zZXRTdHJpbmcoMUwsIGRhdGEpOwogICAgfQoKICAg\nIC8qKgogICAgICogSW52b2tlIHRoZSBKREsgMS40IDxjb2RlPnNldENoYXJh\nY3RlclN0cmVhbTwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbgogICAgICog\nQ0xPQiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dENoYXJz\nKENsb2IgY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgV3JpdGVyIHdyaXRlciA9IGNsb2Iuc2V0Q2hh\ncmFjdGVyU3RyZWFtKDFMKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3\ncml0ZXIud3JpdGUoZGF0YSk7CiAgICAgICAgICAgIHdyaXRlci5mbHVzaCgp\nOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGlvZS50b1N0cmluZygpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXYXJuIHRoYXQgYSBw\nYXJ0aWN1bGFyIHZhbHVlIGNvdWxkIG5vdCBiZSBzdG9yZWQgcHJlY2lzZWx5\nLgogICAgICogQWZ0ZXIgdGhlIGZpcnN0IHdhcm5pbmcgZm9yIGEgcGFydGlj\ndWxhciB0eXBlLCBtZXNzYWdlcwogICAgICogd2lsbCBiZSB0dXJuZWQgaW50\nbyB0cmFjZSBtZXNzYWdlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nc3RvcmFnZVdhcm5pbmcoT2JqZWN0IG9yaWcsIE9iamVjdCBjb252ZXJ0ZWQp\nIHsKICAgICAgICBib29sZWFuIHdhcm47CiAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChfcHJlY2lzaW9uV2FybmVkVHlw\nZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wcmVjaXNpb25XYXJuZWRU\neXBlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIHdhcm4gPSBfcHJl\nY2lzaW9uV2FybmVkVHlwZXMuYWRkKG9yaWcuZ2V0Q2xhc3MoKSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwgfHwg\nKHdhcm4gJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgfHwg\nKCF3YXJuICYmIGxvZy5pc1RyYWNlRW5hYmxlZCgpKSkgewogICAgICAgICAg\nICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJzdG9yYWdlLXJlc3RyaWN0aW9u\nIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgcGxhdGZvcm0sCiAg\nICAgICAgICAgICAgICBvcmlnLAogICAgICAgICAgICAgICAgb3JpZy5nZXRD\nbGFzcygpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGNvbnZlcnRlZCwK\nICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoc3RvcmFnZUxpbWl0\nYXRpb25zRmF0YWwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVF\neGNlcHRpb24obXNnKTsKCiAgICAgICAgICAgIGlmICh3YXJuKQogICAgICAg\nICAgICAgICAgbG9nLndhcm4obXNnKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgbG9nLnRyYWNlKG1zZyk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vLy8vLy8vLwogICAgLy8gVHlwZXMKICAgIC8vLy8vLy8vLwogICAg\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJlZmVycmVkIHtAbGluayBU\neXBlc30gY29uc3RhbnQgZm9yIHRoZSBnaXZlbgogICAgICoge0BsaW5rIEph\ndmFUeXBlc30gb3Ige0BsaW5rIEphdmFTUUxUeXBlc30gY29uc3RhbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0SkRCQ1R5cGUoaW50IG1ldGFUeXBl\nQ29kZSwgYm9vbGVhbiBsb2IpIHsKICAgICAgICByZXR1cm4gZ2V0SkRCQ1R5\ncGUobWV0YVR5cGVDb2RlLCBsb2IsIDAsIDApOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVzfSBjb25z\ndGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5cGVzfSBv\nciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAqLwogICAg\ncHVibGljIGludCBnZXRKREJDVHlwZShpbnQgbWV0YVR5cGVDb2RlLCBib29s\nZWFuIGxvYiwgaW50IHByZWNpcywgCiAgICAgICAgaW50IHNjYWxlLCBib29s\nZWFuIHhtbCkgewogICAgICAgIHJldHVybiBnZXRKREJDVHlwZShtZXRhVHlw\nZUNvZGUsIGxvYiwgcHJlY2lzLCBzY2FsZSk7ICAgICAgICAKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgcHJlZmVycmVkIHtAbGluayBUeXBl\nc30gY29uc3RhbnQgZm9yIHRoZSBnaXZlbgogICAgICoge0BsaW5rIEphdmFU\neXBlc30gb3Ige0BsaW5rIEphdmFTUUxUeXBlc30gY29uc3RhbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgZ2V0SkRCQ1R5cGUoaW50IG1ldGFUeXBlQ29k\nZSwgYm9vbGVhbiBsb2IsIGludCBwcmVjaXMsIAogICAgICAgIGludCBzY2Fs\nZSkgewogICAgICAgIGlmIChsb2IpIHsKICAgICAgICAgICAgc3dpdGNoICht\nZXRhVHlwZUNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNUUklORzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkFT\nQ0lJX1NUUkVBTToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVz\nLkNIQVJfU1RSRUFNOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVk\nVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgc3dpdGNoIChtZXRhVHlwZUNvZGUpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQk9PTEVBTl9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5CSVQpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09C\nSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5\ncGVzLlRJTllJTlQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFS\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAg\nICAgICAgICAgIGlmIChzdG9yZUNoYXJzQXNOdW1iZXJzKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLklOVEVH\nRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUo\nVHlwZXMuQ0hBUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAg\nICAgICAgICAgICAgIGlmKHByZWNpcyA+IDAgfHwgc2NhbGUgPiAwKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlw\nZXMuTlVNRVJJQyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVy\ncmVkVHlwZShUeXBlcy5ET1VCTEUpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgaWYocHJl\nY2lzID4gMCB8fCBzY2FsZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5OVU1FUklDKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlJFQUwp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5J\nTlRFR0VSKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CSUdJTlQpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuU01BTExJTlQpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlw\nZXMuQVNDSUlfU1RSRUFNOgogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5DSEFSX1NUUkVBTToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVm\nZXJyZWRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAgICAgICAgaWYgKHN0b3Jl\nTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQklHSU5U\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAg\nICAgICAgICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVm\nZXJyZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVMYXJn\nZU51bWJlcnNBc1N0cmluZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5OVU1FUklDKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1FU1RBTVApOwogICAgICAg\nICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfQVJSQVk6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5BUlJBWSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJJTkFSWV9TVFJFQU06CiAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJMT0I6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLkJZVEVTOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLkNMT0I6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5DTE9CKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhU1FMVHlwZXMuU1FMX0RBVEU6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5EQVRFKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhU1FMVHlwZXMuVElNRToKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTUUpOwogICAgICAgICAg\nICBjYXNlIEphdmFTUUxUeXBlcy5USU1FU1RBTVA6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1FU1RBTVApOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5\ncGVzfSB0eXBlIGZvciB0aGUgZ2l2ZW4gb25lLiBSZXR1cm5zCiAgICAgKiB0\naGUgZ2l2ZW4gdHlwZSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldFByZWZlcnJlZFR5cGUoaW50IHR5cGUpIHsKICAgICAgICByZXR1\ncm4gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJl\nZmVycmVkIGRhdGFiYXNlIHR5cGUgbmFtZSBmb3IgdGhlIGdpdmVuIGNvbHVt\nbidzIHR5cGUKICAgICAqIGZyb20ge0BsaW5rIFR5cGVzfS4KICAgICAqLwog\nICAgcHVibGljIFN0cmluZyBnZXRUeXBlTmFtZShDb2x1bW4gY29sKSB7CiAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGNvbC5nZXRUeXBlTmFt\nZSgpKSkKICAgICAgICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCBjb2wu\nZ2V0VHlwZU5hbWUoKSk7CgogICAgICAgIGlmIChjb2wuaXNBdXRvQXNzaWdu\nZWQoKSAmJiBhdXRvQXNzaWduVHlwZU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCBhdXRvQXNzaWduVHlwZU5hbWUp\nOwoKICAgICAgICByZXR1cm4gYXBwZW5kU2l6ZShjb2wsIGdldFR5cGVOYW1l\nKGNvbC5nZXRUeXBlKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgdGhlIHR5cGUgbmFtZSBmb3IgdGhlIHNwZWNpZmljIGNvbnN0YW50IGFz\nIGRlZmluZWQKICAgICAqIGJ5IHtAbGluayBqYXZhLnNxbC5UeXBlc30uCiAg\nICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhlIHR5cGUKICAgICAqIEByZXR1\ncm4gdGhlIG5hbWUgZm9yIHRoZSB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0VHlwZU5hbWUoaW50IHR5cGUpIHsKICAgICAgICBzd2l0Y2gg\nKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBUeXBlcy5BUlJBWToKICAgICAg\nICAgICAgICAgIHJldHVybiBhcnJheVR5cGVOYW1lOwogICAgICAgICAgICBj\nYXNlIFR5cGVzLkJJR0lOVDoKICAgICAgICAgICAgICAgIHJldHVybiBiaWdp\nbnRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSU5BUlk6CiAg\nICAgICAgICAgICAgICByZXR1cm4gYmluYXJ5VHlwZU5hbWU7CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuQklUOgogICAgICAgICAgICAgICAgcmV0dXJuIGJp\ndFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJMT0I6CiAgICAg\nICAgICAgICAgICByZXR1cm4gYmxvYlR5cGVOYW1lOwogICAgICAgICAgICBj\nYXNlIFR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICByZXR1cm4gYm9v\nbGVhblR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkNIQVI6CiAg\nICAgICAgICAgICAgICByZXR1cm4gY2hhclR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkNMT0I6CiAgICAgICAgICAgICAgICByZXR1cm4gY2xv\nYlR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRBVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZGF0ZVR5cGVOYW1lOwogICAgICAgICAgICBj\nYXNlIFR5cGVzLkRFQ0lNQUw6CiAgICAgICAgICAgICAgICByZXR1cm4gZGVj\naW1hbFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRJU1RJTkNU\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGRpc3RpbmN0VHlwZU5hbWU7CiAg\nICAgICAgICAgIGNhc2UgVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGRvdWJsZVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgcmV0dXJuIGZsb2F0VHlwZU5hbWU7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuSU5URUdFUjoKICAgICAgICAgICAg\nICAgIHJldHVybiBpbnRlZ2VyVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuSkFWQV9PQkpFQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gamF2\nYU9iamVjdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkxPTkdW\nQVJCSU5BUlk6CiAgICAgICAgICAgICAgICByZXR1cm4gbG9uZ1ZhcmJpbmFy\neVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkxPTkdWQVJDSEFS\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGxvbmdWYXJjaGFyVHlwZU5hbWU7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuTlVMTDoKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nTlVNRVJJQzoKICAgICAgICAgICAgICAgIHJldHVybiBudW1lcmljVHlwZU5h\nbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuT1RIRVI6CiAgICAgICAgICAg\nICAgICByZXR1cm4gb3RoZXJUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBU\neXBlcy5SRUFMOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlYWxUeXBlTmFt\nZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5SRUY6CiAgICAgICAgICAgICAg\nICByZXR1cm4gcmVmVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nU01BTExJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc21hbGxpbnRUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5TVFJVQ1Q6CiAgICAgICAg\nICAgICAgICByZXR1cm4gc3RydWN0VHlwZU5hbWU7CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuVElNRToKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lVHlw\nZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElNRVNUQU1QOgogICAg\nICAgICAgICAgICAgcmV0dXJuIHRpbWVzdGFtcFR5cGVOYW1lOwogICAgICAg\nICAgICBjYXNlIFR5cGVzLlRJTllJTlQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gdGlueWludFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlZB\nUkJJTkFSWToKICAgICAgICAgICAgICAgIHJldHVybiB2YXJiaW5hcnlUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5WQVJDSEFSOgogICAgICAg\nICAgICAgICAgcmV0dXJuIHZhcmNoYXJUeXBlTmFtZTsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBvdGhlclR5cGVOYW1l\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRo\nb2QgdG8gYWRkIHNpemUgcHJvcGVydGllcyB0byB0aGUgc3BlY2lmaWVkIHR5\ncGUuCiAgICAgKiBJZiBwcmVzZW50LCB0aGUgc3RyaW5nICJ7MH0iIHdpbGwg\nYmUgcmVwbGFjZWQgd2l0aCB0aGUgc2l6ZSBkZWZpbml0aW9uOwogICAgICog\nb3RoZXJ3aXNlIHRoZSBzaXplIGRlZmluaXRpb24gd2lsbCBiZSBhcHBlbmRl\nZCB0byB0aGUgdHlwZSBuYW1lLgogICAgICogSWYgeW91ciBkYXRhYmFzZSBo\nYXMgY29sdW1uIHR5cGVzIHRoYXQgZG9uJ3QgYWxsb3cgc2l6ZSBkZWZpbml0\naW9ucywKICAgICAqIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIHJldHVybiB0\naGUgdW5hbHRlcmVkIHR5cGUgbmFtZSBmb3IgY29sdW1ucyBvZgogICAgICog\ndGhvc2UgdHlwZXMgKG9yIGFkZCB0aGUgdHlwZSBuYW1lcyB0byB0aGUKICAg\nICAqIDxjb2RlPmZpeGVkU2l6ZVR5cGVOYW1lU2V0PC9jb2RlPikuCiAgICAg\nKiAKICAgICAqIDxQPlNvbWUgZGF0YWJhc2VzIHN1cHBvcnQgInR5cGUgbW9k\naWZpZXJzIiwgZm9yIGV4YW1wbGUgdGhlIHVuc2lnbmVkCiAgICAgKiAibW9k\naWZpZXIiIGluIE15U1FMLiBJbiB0aGVzZSBjYXNlcyB0aGUgc2l6ZSBzaG91\nbGQgZ28gYmV0d2VlbiB0aGUgdHlwZSAKICAgICAqIGFuZCB0aGUgIm1vZGlm\naWVyIiwgaW5zdGVhZCBvZiBhZnRlciB0aGUgbW9kaWZpZXIuIEZvciBleGFt\ncGxlIAogICAgICogQ1JFQVRFIHRhYmxlIEZPTyAoIG15aW50IElOVCAoMTAp\nIFVOU0lHTkVEIC4gLiAuKSBpbnN0ZWFkIG9mIAogICAgICogQ1JFQVRFIHRh\nYmxlIEZPTyAoIG15aW50IElOVCBVTlNJR05FRCAoMTApIC4gLiAuKS4KICAg\nICAqIFR5cGUgbW9kaWZpZXJzIHNob3VsZCBiZSBhZGRlZCB0byA8Y29kZT50\neXBlTW9kaWZpZXJTZXQ8L2NvZGU+IGluIAogICAgICogc3ViY2xhc3Nlcy4g\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgYXBwZW5kU2l6ZShDb2x1\nbW4gY29sLCBTdHJpbmcgdHlwZU5hbWUpIHsKICAgICAgICBpZiAoZml4ZWRT\naXplVHlwZU5hbWVTZXQuY29udGFpbnModHlwZU5hbWUudG9VcHBlckNhc2Uo\nKSkpCiAgICAgICAgICAgIHJldHVybiB0eXBlTmFtZTsKICAgICAgICBpZiAo\ndHlwZU5hbWUuaW5kZXhPZignKCcpICE9IC0xKQogICAgICAgICAgICByZXR1\ncm4gdHlwZU5hbWU7CgogICAgICAgIFN0cmluZyBzaXplID0gbnVsbDsKICAg\nICAgICBpZiAoY29sLmdldFNpemUoKSA+IDApIHsKICAgICAgICAgICAgU3Ry\naW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoMTApOwogICAgICAg\nICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKGNvbC5nZXRTaXplKCkpOwog\nICAgICAgICAgICBpZiAoY29sLmdldERlY2ltYWxEaWdpdHMoKSA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpLmFwcGVuZChjb2wuZ2V0\nRGVjaW1hbERpZ2l0cygpKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKSIp\nOwogICAgICAgICAgICBzaXplID0gYnVmLnRvU3RyaW5nKCk7CiAgICAgICAg\nfQoKICAgICAgICByZXR1cm4gaW5zZXJ0U2l6ZSh0eXBlTmFtZSwgc2l6ZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRoYXQgaW5z\nZXJ0cyBhIHNpemUgY2xhdXNlIGZvciBhIGdpdmVuIFNRTCB0eXBlLiAKICAg\nICAqIAogICAgICogQHNlZSBhcHBlbmRTaXplCiAgICAgKiAKICAgICAqIEBw\nYXJhbSB0eXBlTmFtZSAgVGhlIFNRTCB0eXBlIGUuZy4gSU5UCiAgICAgKiBA\ncGFyYW0gc2l6ZSAgICAgIFRoZSBzaXplIGNsYXVzZSBlLmcuICgxMCkKICAg\nICAqIEByZXR1cm4gICAgICAgICAgVGhlIHR5cGVOYW1lICsgc2l6ZSBjbGF1\nc2UuIFVzdWFsbHkgdGhlIHNpemUgY2xhdXNlIHdpbGwKICAgICAqICAgICAg\nICAgICAgICAgICAgYmUgYXBwZW5kZWQgdG8gdHlwZU5hbWUuIElmIHRoZSB0\neXBlTmFtZSBjb250YWlucyBhIAogICAgICogICAgICAgICAgICAgICAgICBt\nYXJrZXIgOiB7MH0gb3IgaWYgdHlwZU5hbWUgY29udGFpbnMgYSBtb2RpZmll\nciB0aGUgCiAgICAgKiAgICAgICAgICAgICAgICAgIHNpemUgY2xhdXNlIHdp\nbGwgYmUgaW5zZXJ0ZWQgYXBwcm9wcmlhdGVseS4gICAKICAgICAqLwogICAg\ncHJvdGVjdGVkIFN0cmluZyBpbnNlcnRTaXplKFN0cmluZyB0eXBlTmFtZSwg\nU3RyaW5nIHNpemUpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShzaXplKSkgewogICAgICAgICAgICBpbnQgaWR4ID0gdHlwZU5hbWUuaW5k\nZXhPZigiezB9Iik7CiAgICAgICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgaWR4\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGludCBpZHggPSB0eXBlTmFt\nZS5pbmRleE9mKCJ7MH0iKTsKICAgICAgICBpZiAoaWR4ICE9IC0xKSB7CiAg\nICAgICAgICAgIC8vIHJlcGxhY2UgJ3swfScgd2l0aCBzaXplCiAgICAgICAg\nICAgIFN0cmluZyByZXQgPSB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsK\nICAgICAgICAgICAgaWYgKHNpemUgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldCA9IHJldCArIHNpemU7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZS5s\nZW5ndGgoKSA+IGlkeCArIDMpCiAgICAgICAgICAgICAgICByZXQgPSByZXQg\nKyB0eXBlTmFtZS5zdWJzdHJpbmcoaWR4ICsgMyk7CiAgICAgICAgICAgIHJl\ndHVybiByZXQ7CiAgICAgICAgfQogICAgICAgIGlmICghdHlwZU1vZGlmaWVy\nU2V0LmlzRW1wdHkoKSkgewogICAgICAgICAgICBTdHJpbmcgczsKICAgICAg\nICAgICAgaWR4ID0gdHlwZU5hbWUubGVuZ3RoKCk7CiAgICAgICAgICAgIGlu\ndCBjdXJJZHggPSAtMTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpID0g\ndHlwZU1vZGlmaWVyU2V0Lml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgcyA9IChTdHJpbmcpIGkubmV4dCgpOwogICAgICAg\nICAgICAgICAgaWYgKHR5cGVOYW1lLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihz\nKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIGN1cklkeCA9IHR5cGVO\nYW1lLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihzKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoY3VySWR4ICE9IC0xICYmIGN1cklkeCA8IGlkeCkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZHggPSBjdXJJZHg7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmKGlkeCAhPSB0eXBlTmFtZS5sZW5ndGgoKSkgewogICAg\nICAgICAgICAgICAgU3RyaW5nIHJldCA9IHR5cGVOYW1lLnN1YnN0cmluZygw\nLCBpZHgpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0ICsgc2l6ZTsKICAg\nICAgICAgICAgICAgIHJldCA9IHJldCArICcgJyArIHR5cGVOYW1lLnN1YnN0\ncmluZyhpZHgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHlwZU5hbWUgKyBz\naXplOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3RzCiAg\nICAvLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogU2V0IHRoZSBuYW1lIG9m\nIHRoZSBqb2luIHN5bnRheCB0byB1c2U6IHNxbDkyLCB0cmFkaXRpb25hbCwg\nZGF0YWJhc2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEpvaW5TeW50\nYXgoU3RyaW5nIHN5bnRheCkgewogICAgICAgIGlmICgic3FsOTIiLmVxdWFs\ncyhzeW50YXgpKQogICAgICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFYX1NR\nTDkyOwogICAgICAgIGVsc2UgaWYgKCJ0cmFkaXRpb25hbCIuZXF1YWxzKHN5\nbnRheCkpCiAgICAgICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfVFJBRElU\nSU9OQUw7CiAgICAgICAgZWxzZSBpZiAoImRhdGFiYXNlIi5lcXVhbHMoc3lu\ndGF4KSkKICAgICAgICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9EQVRBQkFT\nRTsKICAgICAgICBlbHNlIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShzeW50\nYXgpKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uKHN5bnRheCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYSBTUUwgc3RyaW5nIHRvIGFjdCBhcyBhIHBsYWNlaG9sZGVyIGZvciB0aGUg\nZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFBs\nYWNlaG9sZGVyVmFsdWVTdHJpbmcoQ29sdW1uIGNvbCkgewogICAgICAgIHN3\naXRjaCAoY29sLmdldFR5cGUoKSkgewogICAgICAgICAgICBjYXNlIFR5cGVz\nLkJJR0lOVDoKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSVQ6CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuSU5URUdFUjoKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5OVU1FUklDOgogICAgICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5UOgog\nICAgICAgICAgICBjYXNlIFR5cGVzLlRJTllJTlQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gIjAiOwogICAgICAgICAgICBjYXNlIFR5cGVzLkNIQVI6CiAg\nICAgICAgICAgICAgICByZXR1cm4gKHN0b3JlQ2hhcnNBc051bWJlcnMpID8g\nIjAiIDogIicgJyI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0xPQjoKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5WQVJDSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuICIn\nJyI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuREFURToKICAgICAgICAgICAg\nICAgIHJldHVybiBaRVJPX0RBVEVfU1RSOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLkRFQ0lNQUw6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuRE9VQkxFOgog\nICAgICAgICAgICBjYXNlIFR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNl\nIFR5cGVzLlJFQUw6CiAgICAgICAgICAgICAgICByZXR1cm4gIjAuMCI7CiAg\nICAgICAgICAgIGNhc2UgVHlwZXMuVElNRToKICAgICAgICAgICAgICAgIHJl\ndHVybiBaRVJPX1RJTUVfU1RSOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJ\nTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJldHVybiBaRVJPX1RJTUVTVEFN\nUF9TVFI7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gIk5VTEwiOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIFNFTEVDVCBDT1VOVCBzdGF0ZW1lbnQgaW4gdGhlIHByb3Bl\nciBqb2luIHN5bnRheCBmb3IgdGhlCiAgICAgKiBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdENvdW50KFNl\nbGVjdCBzZWwpIHsKICAgICAgICBTUUxCdWZmZXIgc2VsZWN0U1FMID0gbmV3\nIFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBTUUxCdWZmZXIgZnJvbTsKICAg\nICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygpOwogICAgICAgIGlm\nIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgIGZy\nb20gPSBnZXRGcm9tU2VsZWN0KHNlbCwgZmFsc2UpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgZnJvbSA9IGdldEZyb20oc2VsLCBmYWxzZSk7CiAgICAg\nICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0V2hlcmUoc2VsLCBmYWxzZSk7Cgog\nICAgICAgIC8vIGlmIG5vIGdyb3VwaW5nIGFuZCBubyByYW5nZSwgd2UgbWln\naHQgYmUgYWJsZSB0byBnZXQgYnkgd2l0aG91dAogICAgICAgIC8vIGEgc3Vi\nc2VsZWN0CiAgICAgICAgaWYgKHNlbC5nZXRHcm91cGluZygpID09IG51bGwg\nJiYgc2VsLmdldFN0YXJ0SW5kZXgoKSA9PSAwCiAgICAgICAgICAgICYmIHNl\nbC5nZXRFbmRJbmRleCgpID09IExvbmcuTUFYX1ZBTFVFKSB7CiAgICAgICAg\nICAgIC8vIGlmIHRoZSBzZWxlY3QgaGFzIG5vIGlkZW50aWZpZXIgY29scywg\ndXNlIENPVU5UKCopCiAgICAgICAgICAgIExpc3QgYWxpYXNlcyA9ICghc2Vs\nLmlzRGlzdGluY3QoKSkgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUCiAgICAg\nICAgICAgICAgICA6IHNlbC5nZXRJZGVudGlmaWVyQWxpYXNlcygpOwogICAg\nICAgICAgICBpZiAoYWxpYXNlcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5UKCopIik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9tLCB3\naGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBm\nYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYSBzaW5nbGUgZGlzdGlu\nY3QgY29sLCB1c2UgQ09VTlQoRElTVElOQ1QgY29sKQogICAgICAgICAgICBp\nZiAoYWxpYXNlcy5zaXplKCkgPT0gMSkgewogICAgICAgICAgICAgICAgc2Vs\nZWN0U1FMLmFwcGVuZCgiQ09VTlQoRElTVElOQ1QgIikuCiAgICAgICAgICAg\nICAgICAgICAgYXBwZW5kKGFsaWFzZXMuZ2V0KDApLnRvU3RyaW5nKCkpLmFw\ncGVuZCgiKSIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0KHNl\nbGVjdFNRTCwgbnVsbCwgZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51bGws\nCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1B\nWF9WQUxVRSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNhbiB3\nZSBjb21iaW5lIGRpc3RpbmN0IGNvbHM/CiAgICAgICAgICAgIGlmIChkaXN0\naW5jdENvdW50Q29sdW1uU2VwYXJhdG9yICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5UKERJU1RJTkNUICIpOwog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLnNp\nemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiAi\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChk\naXN0aW5jdENvdW50Q29sdW1uU2VwYXJhdG9yKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiICIpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5k\nKGFsaWFzZXMuZ2V0KGkpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiKSIpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0KHNlbGVjdFNRTCwgbnVsbCwg\nZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAgICAgICAg\nICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxVRSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHNpbmNlIHdlIGNhbid0\nIGNvbWJpbmUgZGlzdGluY3QgY29scywgd2UgaGF2ZSB0byBwZXJmb3JtIGFu\nIG91dGVyCiAgICAgICAgLy8gQ09VTlQoKikgc2VsZWN0IHVzaW5nIHRoZSBv\ncmlnaW5hbCBzZWxlY3QgYXMgYSBzdWJzZWxlY3QgaW4gdGhlCiAgICAgICAg\nLy8gRlJPTSBjbGF1c2UKICAgICAgICBhc3NlcnRTdXBwb3J0KHN1cHBvcnRz\nU3Vic2VsZWN0LCAiU3VwcG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAgU1FM\nQnVmZmVyIHN1YlNlbGVjdCA9IGdldFNlbGVjdHMoc2VsLCB0cnVlLCBmYWxz\nZSk7CiAgICAgICAgU1FMQnVmZmVyIHN1YkZyb20gPSBmcm9tOwogICAgICAg\nIGZyb20gPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGZyb20uYXBw\nZW5kKCIoIik7CiAgICAgICAgZnJvbS5hcHBlbmQodG9TZWxlY3Qoc3ViU2Vs\nZWN0LCBudWxsLCBzdWJGcm9tLCB3aGVyZSwKICAgICAgICAgICAgc2VsLmdl\ndEdyb3VwaW5nKCksIHNlbC5nZXRIYXZpbmcoKSwgbnVsbCwgc2VsLmlzRGlz\ndGluY3QoKSwKICAgICAgICAgICAgZmFsc2UsIHNlbC5nZXRTdGFydEluZGV4\nKCksIHNlbC5nZXRFbmRJbmRleCgpLCB0cnVlLCBzZWwpKTsKICAgICAgICBm\ncm9tLmFwcGVuZCgiKSIpOwogICAgICAgIGlmIChyZXF1aXJlc0FsaWFzRm9y\nU3Vic2VsZWN0KQogICAgICAgICAgICBmcm9tLmFwcGVuZCgiICIpLmFwcGVu\nZChTZWxlY3QuRlJPTV9TRUxFQ1RfQUxJQVMpOwoKICAgICAgICBzZWxlY3RT\nUUwuYXBwZW5kKCJDT1VOVCgqKSIpOwogICAgICAgIHJldHVybiB0b1NlbGVj\ndChzZWxlY3RTUUwsIG51bGwsIGZyb20sIG51bGwsIG51bGwsIG51bGwsIG51\nbGwsCiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhfVkFM\nVUUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgREVMRVRFIHN0\nYXRlbWVudCBmb3IgdGhlIHNwZWNpZmllZCBTZWxlY3QuIElmIHRoZQogICAg\nICogZGF0YWJhc2UgZG9lcyBub3Qgc3VwcG9ydCB0aGUgYnVsayBkZWxldGUg\nc3RhdGVtZW50IChzdWNoIGFzCiAgICAgKiBjYXNlcyB3aGVyZSBhIHN1YnNl\nbGVjdCBpcyByZXF1aXJlZCBhbmQgdGhlIGRhdGFiYXNlIGRvZXNuJ3Qgc3Vw\ncG9ydAogICAgICogc3Vic2VsZWN0cyksIHRoaXMgbWV0aG9kIHNob3VsZCBy\nZXR1cm4gbnVsbC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b0Rl\nbGV0ZShDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0IHNlbCwgCiAgICAg\nICAgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIHRvQnVsa09w\nZXJhdGlvbihtYXBwaW5nLCBzZWwsIG51bGwsIHBhcmFtcywgbnVsbCk7CiAg\nICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0b1VwZGF0ZShDbGFzc01hcHBp\nbmcgbWFwcGluZywgU2VsZWN0IHNlbCwKICAgICAgICBKREJDU3RvcmUgc3Rv\ncmUsIE9iamVjdFtdIHBhcmFtcywgTWFwIHVwZGF0ZXMpIHsKICAgICAgICBy\nZXR1cm4gdG9CdWxrT3BlcmF0aW9uKG1hcHBpbmcsIHNlbCwgc3RvcmUsIHBh\ncmFtcywgdXBkYXRlcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIHRoZSBTUUwgZm9yIGEgYnVsayBvcGVyYXRpb24sIGVpdGhlciBhIERFTEVU\nRSBvciBhbiBVUERBVEUuCiAgICAgKgogICAgICogQHBhcmFtIG1hcHBpbmcg\ndGhlIG1hcHBpbmcgYWdhaW5zdCB3aGljaCB3ZSBhcmUgb3BlcmF0aW5nCiAg\nICAgKiBAcGFyYW0gc2VsIHRoZSBTZWxlY3QgdGhhdCB3aWxsIGNvbnN0aXR1\ndGUgdGhlIFdIRVJFIGNsYXVzZQogICAgICogQHBhcmFtIHN0b3JlIHRoZSBj\ndXJyZW50IHN0b3JlCiAgICAgKiBAcGFyYW0gdXBkYXRlUGFyYW1zIHRoZSBN\nYXAgdGhhdCBob2xkcyB0aGUgdXBkYXRlIHBhcmFtZXRlcnM7IGEgbnVsbAog\nICAgICogdmFsdWUgaW5kaWNhdGVzIHRoYXQgdGhpcyBpcyBhIGRlbGV0ZSBv\ncGVyYXRpb24KICAgICAqIEByZXR1cm4gdGhlIFNRTEJ1ZmZlciBmb3IgdGhl\nIHVwZGF0ZSwgb3IgPGVtPm51bGw8L2VtPiBpZiBpdCBpcyBub3QKICAgICAq\nIHBvc3NpYmxlIHRvIHBlcmZvcm0gdGhlIGJ1bGsgdXBkYXRlCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgdG9CdWxrT3BlcmF0aW9uKENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLAogICAgICAgIEpEQkNTdG9y\nZSBzdG9yZSwgT2JqZWN0W10gcGFyYW1zLCBNYXAgdXBkYXRlUGFyYW1zKSB7\nCiAgICAgICAgU1FMQnVmZmVyIHNxbCA9IG5ldyBTUUxCdWZmZXIodGhpcyk7\nCiAgICAgICAgaWYgKHVwZGF0ZVBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAg\nICBpZiAocmVxdWlyZXNUYXJnZXRGb3JEZWxldGUpIHsKICAgICAgICAgICAg\nc3FsLmFwcGVuZCgiREVMRVRFICIpOwogICAgICAgICAgICBTUUxCdWZmZXIg\nZGVsZXRlVGFyZ2V0cyA9IGdldERlbGV0ZVRhcmdldHMoc2VsKTsKICAgICAg\nICAgICAgc3FsLmFwcGVuZChkZWxldGVUYXJnZXRzKTsKICAgICAgICAgICAg\nc3FsLmFwcGVuZCgiIEZST00gIik7CiAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBzcWwuYXBwZW5kKCJERUxFVEUgRlJPTSAiKTsKICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgICAgICBzcWwuYXBw\nZW5kKCJVUERBVEUgIik7CiAgICAgICAgc2VsLmFkZEpvaW5DbGFzc0NvbmRp\ndGlvbnMoKTsKCiAgICAgICAgLy8gaWYgdGhlcmUgaXMgb25seSBhIHNpbmds\nZSB0YWJsZSBpbiB0aGUgc2VsZWN0LCB0aGVuIHdlIGNhbgogICAgICAgIC8v\nIGp1c3QgaXNzdWUgYSBzaW5nbGUgREVMRVRFIEZST00gVEFCTEUgV0hFUkUg\nPGNvbmRpdGlvbnM+CiAgICAgICAgLy8gc3RhdGVtZW50OyBvdGhlcndpc2Us\nIHNpbmNlIFNRTCBkb2Vzbid0IGFsbG93IGRlbGV0aW5nCiAgICAgICAgLy8g\nZnJvbSBvbmUgb2YgYSBtdWx0aS10YWJsZSBzZWxlY3QsIHdlIG5lZWQgdG8g\naXNzdWUgYSBzdWJzZWxlY3QKICAgICAgICAvLyBsaWtlIERFTEVURSBGUk9N\nIFRBQkxFIFdIRVJFIEVYSVNUUwogICAgICAgIC8vIChTRUxFQ1QgMSBGUk9N\nIFRBQkxFIHQwIFdIRVJFIHQwLklEID0gVEFCTEUuSUQpOyBhbHNvLCBzb21l\nCiAgICAgICAgLy8gZGF0YWJhc2VzIGRvIG5vdCBhbGxvdyBhbGlhc2VzIGlu\nIGRlbGV0ZSBzdGF0ZW1lbnRzLCB3aGljaAogICAgICAgIC8vIGFsc28gY2F1\nc2VzIHVzIHRvIHVzZSBhIHN1YnNlbGVjdAogICAgICAgIGlmIChzZWwuZ2V0\nVGFibGVBbGlhc2VzKCkuc2l6ZSgpID09IDEgJiYgc3VwcG9ydHNTdWJzZWxl\nY3QKICAgICAgICAgICAgJiYgYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UpIHsK\nICAgICAgICAgICAgU1FMQnVmZmVyIGZyb207CiAgICAgICAgICAgIGlmIChz\nZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBm\ncm9tID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZhbHNlKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgZnJvbSA9IGdldEZyb20oc2VsLCBmYWxz\nZSk7CgogICAgICAgICAgICBzcWwuYXBwZW5kKGZyb20pOwogICAgICAgICAg\nICBhcHBlbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRh\ndGVQYXJhbXMsCiAgICAgICAgICAgICAgICBhbGxvd3NBbGlhc0luQnVsa0Ns\nYXVzZSk7CgogICAgICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBzZWwuZ2V0\nV2hlcmUoKTsKICAgICAgICAgICAgaWYgKHdoZXJlICE9IG51bGwgJiYgIXdo\nZXJlLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgi\nIFdIRVJFICIpOwogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCh3aGVyZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNxbDsKICAgICAg\nICB9CgogICAgICAgIFRhYmxlIHRhYmxlID0gbWFwcGluZy5nZXRUYWJsZSgp\nOwogICAgICAgIFN0cmluZyB0YWJsZU5hbWUgPSBnZXRGdWxsTmFtZSh0YWJs\nZSwgZmFsc2UpOwoKICAgICAgICAvLyBvbmx5IHVzZSBhICBzdWJzZWxlY3Qg\naWYgdGhlIHdoZXJlIGlzIG5vdCBlbXB0eTsgb3RoZXJ3aXNlCiAgICAgICAg\nLy8gYW4gdW5xdWFsaWZpZWQgZGVsZXRlIG9yIHVwZGF0ZSB3aWxsIHdvcmsK\nICAgICAgICBpZiAoc2VsLmdldFdoZXJlKCkgPT0gbnVsbCB8fCBzZWwuZ2V0\nV2hlcmUoKS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgc3FsLmFwcGVuZCh0\nYWJsZU5hbWUpOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNlbCwgc3Rv\ncmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNlKTsKICAgICAg\nICAgICAgcmV0dXJuIHNxbDsKICAgICAgICB9CgogICAgICAgIC8vIHdlIG5l\nZWQgdG8gdXNlIGEgc3Vic2VsZWN0IGlmIHdlIGFyZSB0byBidWxrIGRlbGV0\nZSB3aGVyZQogICAgICAgIC8vIHRoZSBzZWxlY3QgaW5jbHVkZXMgbXVsdGlw\nbGUgdGFibGVzOyBpZiB0aGUgZGF0YWJhc2UKICAgICAgICAvLyBkb2Vzbid0\nIHN1cHBvcnQgaXQsIHRoZW4gd2UgbmVlZCB0byBzaWduYWwgdGhpcyBieSBy\nZXR1cm5pbmcgbnVsbAogICAgICAgIGlmICghc3VwcG9ydHNTdWJzZWxlY3Qg\nfHwgIXN1cHBvcnRzQ29ycmVsYXRlZFN1YnNlbGVjdCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIENvbHVtbltdIHBrcyA9IG1hcHBpbmcu\nZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBzZWwuY2xlYXJTZWxl\nY3RzKCk7CiAgICAgICAgc2VsLnNldERpc3RpbmN0KHRydWUpOwoKICAgICAg\nICAvLyBpZiB3ZSBoYXZlIG9ubHkgYSBzaW5nbGUgUEssIHdlIGNhbiB1c2Ug\nYSBub24tY29ycmVsYXRlZAogICAgICAgIC8vIHN1YnF1ZXJ5ICh1c2luZyBh\nbiBJTiBzdGF0ZW1lbnQpLCB3aGljaCBpcyBtdWNoIGZhc3RlciB0aGFuCiAg\nICAgICAgLy8gYSBjb3JyZWxhdGVkIHN1YnF1ZXJ5IChzaW5jZSBhIGNvcnJl\nbGF0ZWQgc3VicXVlcnkgbmVlZHMKICAgICAgICAvLyB0byBiZSBleGVjdXRl\nZCBvbmNlIGZvciBlYWNoIHJvdyBpbiB0aGUgdGFibGUpCiAgICAgICAgaWYg\nKHBrcy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICBzZWwuc2VsZWN0KHBr\nc1swXSk7CiAgICAgICAgICAgIHNxbC5hcHBlbmQodGFibGVOYW1lKTsKICAg\nICAgICAgICAgYXBwZW5kVXBkYXRlcyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFt\ncywgdXBkYXRlUGFyYW1zLCBmYWxzZSk7CiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoIiBXSEVSRSAiKS4KICAgICAgICAgICAgICAgIGFwcGVuZChwa3NbMF0p\nLmFwcGVuZCgiIElOICgiKS4KICAgICAgICAgICAgICAgIGFwcGVuZChzZWwu\ndG9TZWxlY3QoZmFsc2UsIG51bGwpKS5hcHBlbmQoIikiKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBzZWwuY2xlYXJTZWxlY3RzKCk7CiAgICAg\nICAgICAgIHNlbC5zZXREaXN0aW5jdChmYWxzZSk7CgogICAgICAgICAgICAv\nLyBzaW5jZSB0aGUgc2VsZWN0IGlzIHVzaW5nIGEgY29ycmVsYXRlZCBzdWJx\ndWVyeSwgd2UKICAgICAgICAgICAgLy8gb25seSBuZWVkIHRvIHNlbGVjdCBh\nIGJvZ3VzIHZpcnR1YWwgY29sdW1uCiAgICAgICAgICAgIHNlbC5zZWxlY3Qo\nIjEiLCBudWxsKTsKCiAgICAgICAgICAgIC8vIGFkZCBpbiB0aGUgam9pbnMg\ndG8gdGhlIHRhYmxlCiAgICAgICAgICAgIENvbHVtbltdIGNvbHMgPSB0YWJs\nZS5nZXRQcmltYXJ5S2V5KCkuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICBT\nUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiKCIpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlm\nIChpID4gMCkKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5E\nICIpOwoKICAgICAgICAgICAgICAgIC8vIGFkZCBpbiAidDAuUEsgPSBNWVRB\nQkxFLlBLIgogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChzZWwuZ2V0Q29s\ndW1uQWxpYXMoY29sc1tpXSkpLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAg\nICAgICAgICAgYXBwZW5kKHRhYmxlKS5hcHBlbmQoY2F0YWxvZ1NlcGFyYXRv\ncikuYXBwZW5kKGNvbHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAgICAgICAgc2VsLndoZXJlKGJ1Ziwg\nbnVsbCk7CgogICAgICAgICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAg\nICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJh\nbXMsIHVwZGF0ZVBhcmFtcywgZmFsc2UpOwogICAgICAgICAgICBzcWwuYXBw\nZW5kKCIgV0hFUkUgRVhJU1RTICgiKS4KICAgICAgICAgICAgICAgIGFwcGVu\nZChzZWwudG9TZWxlY3QoZmFsc2UsIG51bGwpKS5hcHBlbmQoIikiKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHNxbDsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgU1FMQnVmZmVyIGdldERlbGV0ZVRhcmdldHMoU2VsZWN0IHNlbCkgewog\nICAgICBTUUxCdWZmZXIgZGVsZXRlVGFyZ2V0cyA9IG5ldyBTUUxCdWZmZXIo\ndGhpcyk7CiAgICAgIENvbGxlY3Rpb24gYWxpYXNlcyA9IHNlbC5nZXRUYWJs\nZUFsaWFzZXMoKTsKICAgICAgLy8gQXNzdW1lcyBhbGlhc2VzIGFyZSBvZiB0\naGUgZm9ybSAiVEFCTEVOQU1FIHQwIgogICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IGFsaWFzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICBTdHJpbmcgdGFibGVBbGlhcyA9IGl0ci5uZXh0KCkudG9TdHJpbmco\nKTsKICAgICAgICBpbnQgc3BhY2VJbmRleCA9IHRhYmxlQWxpYXMuaW5kZXhP\nZignICcpOwogICAgICAgIGlmIChzcGFjZUluZGV4ID4gMCAmJiBzcGFjZUlu\nZGV4IDwgdGFibGVBbGlhcy5sZW5ndGgoKSAtIDEpIHsKICAgICAgICAgIGlm\nIChhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSkgewogICAgICAgICAgICBkZWxl\ndGVUYXJnZXRzLmFwcGVuZCh0YWJsZUFsaWFzLnN1YnN0cmluZyhzcGFjZUlu\nZGV4ICsgMSkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVs\nZXRlVGFyZ2V0cy5hcHBlbmQodGFibGVBbGlhcy5zdWJzdHJpbmcoMCwgc3Bh\nY2VJbmRleCkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICBkZWxldGVUYXJnZXRzLmFwcGVuZCh0YWJsZUFsaWFzKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICBkZWxl\ndGVUYXJnZXRzLmFwcGVuZCgiLCAiKTsKICAgICAgfSAgICAgIAogICAgICBy\nZXR1cm4gZGVsZXRlVGFyZ2V0czsgICAgICAKICAgIH0KCiAgICBwcm90ZWN0\nZWQgdm9pZCBhcHBlbmRVcGRhdGVzKFNlbGVjdCBzZWwsIEpEQkNTdG9yZSBz\ndG9yZSwgU1FMQnVmZmVyIHNxbCwKICAgICAgICBPYmplY3RbXSBwYXJhbXMs\nIE1hcCB1cGRhdGVQYXJhbXMsIGJvb2xlYW4gYWxsb3dBbGlhcykgewogICAg\nICAgIGlmICh1cGRhdGVQYXJhbXMgPT0gbnVsbCB8fCB1cGRhdGVQYXJhbXMu\nc2l6ZSgpID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\nbWFudWFsbHkgYnVpbGQgdXAgdGhlIFNFVCBjbGF1c2UgZm9yIHRoZSBVUERB\nVEUgc3RhdGVtZW50CiAgICAgICAgc3FsLmFwcGVuZCgiIFNFVCAiKTsKICAg\nICAgICBFeHBDb250ZXh0IGN0eCA9IG5ldyBFeHBDb250ZXh0KHN0b3JlLCBw\nYXJhbXMsIAogICAgICAgICAgICBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKSk7CgogICAgICAgIC8vIElmIHRoZSB1cGRhdGVzIG1hcCBjb250YWlu\ncyBhbnkgdmVyc2lvbiBmaWVsZHMsIGFzc3VtZSB0aGF0IHRoZQogICAgICAg\nIC8vIG9wdGltaXN0aWMgbG9jayB2ZXJzaW9uIGRhdGEgaXMgYmVpbmcgaGFu\nZGxlZCBwcm9wZXJseSBieSB0aGUKICAgICAgICAvLyBjYWxsZXIuIE90aGVy\nd2lzZSwgZ2l2ZSB0aGUgdmVyc2lvbiBpbmRpY2F0b3IgYW4gb3Bwb3J0dW5p\ndHkgdG8KICAgICAgICAvLyBhZGQgbW9yZSB1cGRhdGUgY2xhdXNlcyBhcyBu\nZWVkZWQuCiAgICAgICAgYm9vbGVhbiBhdWdtZW50VXBkYXRlcyA9IHRydWU7\nCgogICAgICAgIGZvciAoSXRlcmF0b3IgaSA9IHVwZGF0ZVBhcmFtcy5lbnRy\neVNldCgpLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBNYXAuRW50cnkgbmV4dCA9IChNYXAuRW50cnkpIGkubmV4dCgpOwogICAg\nICAgICAgICBQYXRoIHBhdGggPSAoUGF0aCkgbmV4dC5nZXRLZXkoKTsKICAg\nICAgICAgICAgRmllbGRNYXBwaW5nIGZtZCA9IChGaWVsZE1hcHBpbmcpIHBh\ndGgubGFzdCgpOwoKICAgICAgICAgICAgaWYgKGZtZC5pc1ZlcnNpb24oKSkK\nICAgICAgICAgICAgICAgIGF1Z21lbnRVcGRhdGVzID0gZmFsc2U7CgogICAg\nICAgICAgICBWYWwgdmFsID0gKFZhbCkgbmV4dC5nZXRWYWx1ZSgpOwogICAg\nICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgICAgICB2YWwg\nPSBuZXcgTnVsbCgpOwogICAgICAgICAgICBDb2x1bW4gY29sID0gZm1kLmdl\ndENvbHVtbnMoKVswXTsKICAgICAgICAgICAgaWYgKGFsbG93QWxpYXMpIHsK\nICAgICAgICAgICAgICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhj\nb2wpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzcWwu\nYXBwZW5kKGNvbC5nZXROYW1lKCkpOyAgCiAgICAgICAgICAgIH0gICAgICAg\nICAgICAKICAgICAgICAgICAgc3FsLmFwcGVuZCgiID0gIik7CgogICAgICAg\nICAgICBFeHBTdGF0ZSBzdGF0ZSA9IHZhbC5pbml0aWFsaXplKHNlbCwgY3R4\nLCAwKTsKICAgICAgICAgICAgLy8gSkRCQyBQYXRocyBhcmUgYWx3YXlzIFBD\nUGF0aHM7IFBDUGF0aCBpbXBsZW1lbnRzIFZhbAogICAgICAgICAgICBFeHBT\ndGF0ZSBwYXRoU3RhdGUgPSAoKFZhbCkgcGF0aCkuaW5pdGlhbGl6ZShzZWws\nIGN0eCwgMCk7CiAgICAgICAgICAgIGNhbGN1bGF0ZVZhbHVlKHZhbCwgc2Vs\nLCBjdHgsIHN0YXRlLCBwYXRoLCBwYXRoU3RhdGUpOwoKICAgICAgICAgICAg\nLy8gYXBwZW5kIHRoZSB2YWx1ZSB3aXRoIGEgbnVsbCBmb3IgdGhlIFNlbGVj\ndDsgaQogICAgICAgICAgICAvLyBpbmRpY2F0ZXMgdGhhdCB0aGUKICAgICAg\nICAgICAgaW50IGxlbmd0aCA9IHZhbC5sZW5ndGgoc2VsLCBjdHgsIHN0YXRl\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBsZW5ndGg7IGor\nKykKICAgICAgICAgICAgICAgIHZhbC5hcHBlbmRUbygoYWxsb3dBbGlhcykg\nPyBzZWwgOiBudWxsLCBjdHgsIHN0YXRlLCBzcWwsIGopOwoKICAgICAgICAg\nICAgaWYgKGkuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgc3FsLmFwcGVu\nZCgiLCAiKTsKICAgICAgICB9CgogICAgICAgIGlmIChhdWdtZW50VXBkYXRl\ncykgewogICAgICAgICAgICBQYXRoIHBhdGggPSAoUGF0aCkgdXBkYXRlUGFy\nYW1zLmtleVNldCgpLml0ZXJhdG9yKCkubmV4dCgpOwogICAgICAgICAgICBG\naWVsZE1hcHBpbmcgZm0gPSAoRmllbGRNYXBwaW5nKSBwYXRoLmxhc3QoKTsK\nICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIG1ldGEgPSBmbS5nZXREZWNsYXJp\nbmdNYXBwaW5nKCk7CiAgICAgICAgICAgIE1hcCB1cGRhdGVzID0gbWV0YS5n\nZXRWZXJzaW9uKCkuZ2V0QnVsa1VwZGF0ZVZhbHVlcygpOwogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSB1cGRhdGVzLmVudHJ5U2V0KCkuaXRl\ncmF0b3IoKTsKICAgICAgICAgICAgICAgIGl0ZXIuaGFzTmV4dCgpOyApIHsK\nICAgICAgICAgICAgICAgIE1hcC5FbnRyeSBlID0gKE1hcC5FbnRyeSkgaXRl\nci5uZXh0KCk7CiAgICAgICAgICAgICAgICBDb2x1bW4gY29sID0gKENvbHVt\nbikgZS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIFN0cmluZyB2YWwgPSAo\nU3RyaW5nKSBlLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICBzcWwuYXBw\nZW5kKCIsICIpLmFwcGVuZChjb2wuZ2V0TmFtZSgpKQogICAgICAgICAgICAg\nICAgICAgIC5hcHBlbmQoIiA9ICIpLmFwcGVuZCh2YWwpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0\nZSBTUUwgdG8gZGVsZXRlIHRoZSBjb250ZW50cyBvZiB0aGUgc3BlY2lmaWVk\nIHRhYmxlcy4gCiAgICAgKiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBk\ncm9wcyBhbGwgbm9uLWRlZmVycmVkIFJFU1RSSUNUIGZvcmVpZ24ga2V5IAog\nICAgICogY29uc3RyYWludHMgaW52b2x2aW5nIHRoZSBzcGVjaWZpZWQgdGFi\nbGVzLCBpc3N1ZXMgREVMRVRFIHN0YXRlbWVudHMgCiAgICAgKiBhZ2FpbnN0\nIHRoZSB0YWJsZXMsIGFuZCB0aGVuIGFkZHMgdGhlIGRyb3BwZWQgY29uc3Ry\nYWludHMgYmFjayBpbi4gCiAgICAgKiBEYXRhYmFzZXMgd2l0aCBtb3JlIG9w\ndGltYWwgd2F5cyBvZiBkZWxldGluZyB0aGUgY29udGVudHMgb2Ygc2V2ZXJh\nbCAKICAgICAqIHRhYmxlcyBzaG91bGQgb3ZlcnJpZGUgdGhpcyBtZXRob2Qu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREZWxldGVUYWJsZUNv\nbnRlbnRzU1FMKFRhYmxlW10gdGFibGVzLENvbm5lY3Rpb24gY29ubikgewog\nICAgICAgIENvbGxlY3Rpb248U3RyaW5nPiBzcWwgPSBuZXcgQXJyYXlMaXN0\nPFN0cmluZz4oKTsKICAgICAgICAKICAgICAgICAvLyBjb2xsZWN0IGFuZCBk\ncm9wIG5vbi1kZWZlcnJlZCBwaHlzaWNhbCByZXN0cmljdCBjb25zdHJhaW50\ncywgYW5kCiAgICAgICAgLy8gY29sbGVjdCB0aGUgREVMRVRFIEZST00gc3Rh\ndGVtZW50cwogICAgICAgIENvbGxlY3Rpb248U3RyaW5nPiBkZWxldGVTUUwg\nPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4odGFibGVzLmxlbmd0aCk7CiAgICAg\nICAgQ29sbGVjdGlvbjxGb3JlaWduS2V5PiByZXN0cmljdENvbnN0cmFpbnRz\nID0KICAgICAgICAgICAgbmV3IExpbmtlZEhhc2hTZXQ8Rm9yZWlnbktleT4o\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRhYmxlcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBGb3JlaWduS2V5W10gZmtzID0gdGFibGVz\nW2ldLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgZmtzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBp\nZiAoIWZrc1tqXS5pc0xvZ2ljYWwoKSAmJiAhZmtzW2pdLmlzRGVmZXJyZWQo\nKSAKICAgICAgICAgICAgICAgICAgICAmJiBma3Nbal0uZ2V0RGVsZXRlQWN0\naW9uKCkgPT0gRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1QpCiAgICAgICAg\nICAgICAgICByZXN0cmljdENvbnN0cmFpbnRzLmFkZChma3Nbal0pOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBkZWxldGVTUUwu\nYWRkKCJERUxFVEUgRlJPTSAiICsgdGFibGVzW2ldLmdldEZ1bGxOYW1lKCkp\nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IoRm9yZWlnbktleSBm\nayA6IHJlc3RyaWN0Q29uc3RyYWludHMpIHsKICAgICAgICAgICAgU3RyaW5n\nW10gY29uc3RyYWludFNRTCA9IGdldERyb3BGb3JlaWduS2V5U1FMKGZrLGNv\nbm4pOwogICAgICAgICAgICBzcWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29u\nc3RyYWludFNRTCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBh\nZGQgdGhlIGRlbGV0ZSBzdGF0ZW1lbnRzIGFmdGVyIGFsbCB0aGUgY29uc3Ry\nYWludCBtdXRhdGlvbnMKICAgICAgICBzcWwuYWRkQWxsKGRlbGV0ZVNRTCk7\nCiAgICAgICAgCiAgICAgICAgLy8gYWRkIHRoZSBkZWxldGVkIGNvbnN0cmFp\nbnRzIGJhY2sgdG8gdGhlIHNjaGVtYQogICAgICAgIGZvciAoRm9yZWlnbktl\neSBmayA6IHJlc3RyaWN0Q29uc3RyYWludHMpIHsKICAgICAgICAgICAgU3Ry\naW5nW10gY29uc3RyYWludFNRTCA9IGdldEFkZEZvcmVpZ25LZXlTUUwoZmsp\nOwogICAgICAgICAgICBzcWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29uc3Ry\nYWludFNRTCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4g\nKFN0cmluZ1tdKSBzcWwudG9BcnJheShuZXcgU3RyaW5nW3NxbC5zaXplKCld\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIFNFTEVDVCBzdGF0\nZW1lbnQgaW4gdGhlIHByb3BlciBqb2luIHN5bnRheCBmb3IgdGhlIGdpdmVu\nCiAgICAgKiBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZl\nciB0b1NlbGVjdChTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSwKICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAg\nc2VsLmFkZEpvaW5DbGFzc0NvbmRpdGlvbnMoKTsKICAgICAgICBib29sZWFu\nIHVwZGF0ZSA9IGZvclVwZGF0ZSAmJiBzZWwuZ2V0RnJvbVNlbGVjdCgpID09\nIG51bGw7CiAgICAgICAgU1FMQnVmZmVyIHNlbGVjdCA9IGdldFNlbGVjdHMo\nc2VsLCBmYWxzZSwgdXBkYXRlKTsKICAgICAgICBTUUxCdWZmZXIgb3JkZXJp\nbmcgPSBudWxsOwogICAgICAgIGlmICghc2VsLmlzQWdncmVnYXRlKCkgfHwg\nc2VsLmdldEdyb3VwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgb3JkZXJp\nbmcgPSBzZWwuZ2V0T3JkZXJpbmcoKTsKICAgICAgICBTUUxCdWZmZXIgZnJv\nbTsKICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxsKQog\nICAgICAgICAgICBmcm9tID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZvclVwZGF0\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmcm9tID0gZ2V0RnJvbShz\nZWwsIHVwZGF0ZSk7CiAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0V2hl\ncmUoc2VsLCB1cGRhdGUpOwogICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxl\nY3QsIGZldGNoLCBmcm9tLCB3aGVyZSwgc2VsLmdldEdyb3VwaW5nKCksCiAg\nICAgICAgICAgIHNlbC5nZXRIYXZpbmcoKSwgb3JkZXJpbmcsIHNlbC5pc0Rp\nc3RpbmN0KCksIGZvclVwZGF0ZSwKICAgICAgICAgICAgc2VsLmdldFN0YXJ0\nSW5kZXgoKSwgc2VsLmdldEVuZEluZGV4KCksIHNlbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBz\ndGF0ZW1lbnQgYmV0d2VlbiB0aGUgRlJPTSBrZXl3b3JkCiAgICAgKiBhbmQg\ndGhlIFdIRVJFIGtleXdvcmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxC\ndWZmZXIgZ2V0RnJvbShTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkg\newogICAgICAgIFNRTEJ1ZmZlciBmcm9tU1FMID0gbmV3IFNRTEJ1ZmZlcih0\naGlzKTsKICAgICAgICBDb2xsZWN0aW9uIGFsaWFzZXMgPSBzZWwuZ2V0VGFi\nbGVBbGlhc2VzKCk7CiAgICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpIDwgMiB8\nfCBzZWwuZ2V0Sm9pblN5bnRheCgpICE9IFNZTlRBWF9TUUw5MikgewogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFsaWFzZXMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGZyb21TUUwu\nYXBwZW5kKGl0ci5uZXh0KCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAg\nICBpZiAoZm9yVXBkYXRlICYmIHRhYmxlRm9yVXBkYXRlQ2xhdXNlICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAiKS5h\ncHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAgICAgICAgICAgICAg\naWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNR\nTC5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGFsaWFzZXMuc2l6ZSgpIDwgMiAmJiBzZWwuZ2V0UGFyZW50KCkgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgLy8gc3VicXVlcnkgbWF5IGNvbnRhaW4g\nY29ycmVsYXRlZCBqb2lucwogICAgICAgICAgICAgICAgSXRlcmF0b3IgaXRy\nID0gc2VsLmdldEpvaW5JdGVyYXRvcigpOwogICAgICAgICAgICAgICAgd2hp\nbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICBKb2lu\nIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAg\nICAvLyBhcHBlbmQgd2hlcmUgY2xhdXNlCiAgICAgICAgICAgICAgICAgICAg\naWYgKGpvaW4uaXNDb3JyZWxhdGVkKCkgJiYgam9pbi5nZXRGb3JlaWduS2V5\nKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBTUUxCdWZm\nZXIgd2hlcmUgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgICAgICAg\nICAgICAgICAgICB3aGVyZS5hcHBlbmQoIigiKS5hcHBlbmQodG9UcmFkaXRp\nb25hbEpvaW4oam9pbikpLmFwcGVuZCgiKSIpOwogICAgICAgICAgICAgICAg\nICAgICAgICBzZWwud2hlcmUod2hlcmUuZ2V0U1FMKCkpOwogICAgICAgICAg\nICAgICAgICAgIH0gICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBJ\ndGVyYXRvciBpdHIgPSBzZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAgICAgICAg\nICAgIGJvb2xlYW4gZmlyc3QgPSB0cnVlOwogICAgICAgICAgICB3aGlsZSAo\naXRyLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgSm9pbiBqb2luID0g\nKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoY29ycmVs\nYXRlZEpvaW5Db25kaXRpb24oam9pbiwgc2VsKSkKICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBpZiAoam9pbi5pc0Nv\ncnJlbGF0ZWQoKSkKICAgICAgICAgICAgICAgICAgICB0b0NvcnJlbGF0ZWRK\nb2luKHNlbCwgam9pbiwgZm9yVXBkYXRlLCBmaXJzdCk7ICAgICAgICAgICAg\nICAgICAgICAKICAgICAgICAgICAgICAgIGVsc2UgICAgCiAgICAgICAgICAg\nICAgICAgICAgZnJvbVNRTC5hcHBlbmQodG9TUUw5MkpvaW4oc2VsLCBqb2lu\nLCBmb3JVcGRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0KSk7\nCiAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgaWYgKGl0ci5oYXNOZXh0KCkgJiYgam9pbi5pc0NvcnJlbGF0ZWQoKSkg\newogICAgICAgICAgICAgICAgICAgIGlmIChmcm9tU1FMLmdldFNRTCgpLmxl\nbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5h\ncHBlbmQoIiwgIik7CiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSB0cnVl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0cjIgPSBhbGlhc2VzLml0ZXJhdG9yKCk7IGl0\ncjIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgU3RyaW5nIHRhYmxl\nQWxpYXMgPSBpdHIyLm5leHQoKS50b1N0cmluZygpOwogICAgICAgICAgICAg\nICAgaWYgKGZyb21TUUwuZ2V0U1FMKCkuaW5kZXhPZih0YWJsZUFsaWFzKSA9\nPSAtMSkgewogICAgICAgICAgICAgICAgICAgIGlmICghZmlyc3QgJiYgZnJv\nbVNRTC5nZXRTUUwoKS5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZyb21TUUwuYXBwZW5kKCIsICIpOwogICAgICAgICAgICAgICAg\nICAgIGZyb21TUUwuYXBwZW5kKHRhYmxlQWxpYXMpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2Ug\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBl\nbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAgICAg\nICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZyb21T\nUUw7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGNvcnJlbGF0ZWRKb2lu\nQ29uZGl0aW9uKEpvaW4gam9pbiwgU2VsZWN0IHNlbCkgewogICAgICAgIGlm\nICgham9pbi5pc0NvcnJlbGF0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0\nb3IoKTsKICAgICAgICBib29sZWFuIHNraXAgPSBmYWxzZTsKICAgICAgICAv\nL2lmIHRhYmxlMSBpbiBqb2luIGlzIGluIHRoZSBtYWluIHF1ZXJ5LCB0YWJs\nZTIgaXMgaW4KICAgICAgICAvL3N1YnF1ZXJ5LCBhbmQgdGFibGUyIHBhcnRp\nY2lwYXRlcyBpbiBvdGhlciBqb2lucwogICAgICAgIC8vaW4gc3VicXVlcnks\nIHRoZSBqb2luIGNvbmRpdGlvbiBjYW4gb25seSBiZSBwbGFjZWQgaW4gCiAg\nICAgICAgLy90aGUgd2hlcmUgY2xhdXNlIGluIHRoZSBzdWJxdWVyeQogICAg\nICAgIHdoaWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIEpvaW4g\nam9pbjEgPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGpv\naW4gPT0gam9pbjEgJiYgIWpvaW4uaXNGb3JlaWduS2V5SW52ZXJzZWQoKSkg\newogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKGpvaW4uZ2V0SW5kZXgyKCkgPT0gam9pbjEuZ2V0SW5k\nZXgxKCkgfHwKICAgICAgICAgICAgICAgIGpvaW4uZ2V0SW5kZXgyKCkgPT0g\nam9pbjEuZ2V0SW5kZXgyKCkpIHsKICAgICAgICAgICAgICAgIHNraXAgPSB0\ncnVlOwogICAgICAgICAgICAgICAgaWYgKGpvaW4uZ2V0Rm9yZWlnbktleSgp\nICE9IG51bGwpewogICAgICAgICAgICAgICAgICAgIFNRTEJ1ZmZlciB3aGVy\nZSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgICAgICAgICAgICAg\nd2hlcmUuYXBwZW5kKCIoIikuYXBwZW5kKHRvVHJhZGl0aW9uYWxKb2luKGpv\naW4pKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgICAgICBzZWwud2hl\ncmUod2hlcmUuZ2V0U1FMKCkpOwogICAgICAgICAgICAgICAgfSAgICAgICAg\nICAgICAgICAKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBza2lwOwogICAgfQogICAgCiAg\nICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBGUk9NIGNsYXVzZSBmb3Ig\nYSBzZWxlY3QgdGhhdCBzZWxlY3RzIGZyb20gYSB0bXAgdGFibGUKICAgICAq\nIGNyZWF0ZWQgYnkgYW4gaW5uZXIgc2VsZWN0LgogICAgICovCiAgICBwcm90\nZWN0ZWQgU1FMQnVmZmVyIGdldEZyb21TZWxlY3QoU2VsZWN0IHNlbCwgYm9v\nbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICBTUUxCdWZmZXIgZnJvbVNRTCA9\nIG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQo\nIigiKTsKICAgICAgICBmcm9tU1FMLmFwcGVuZCh0b1NlbGVjdChzZWwuZ2V0\nRnJvbVNlbGVjdCgpLCBmb3JVcGRhdGUsIG51bGwpKTsKICAgICAgICBmcm9t\nU1FMLmFwcGVuZCgiKSIpOwogICAgICAgIGlmIChyZXF1aXJlc0FsaWFzRm9y\nU3Vic2VsZWN0KQogICAgICAgICAgICBmcm9tU1FMLmFwcGVuZCgiICIpLmFw\ncGVuZChTZWxlY3QuRlJPTV9TRUxFQ1RfQUxJQVMpOwogICAgICAgIHJldHVy\nbiBmcm9tU1FMOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBX\nSEVSRSBwb3J0aW9uIG9mIHRoZSBzZWxlY3Qgc3RhdGVtZW50LCBvciBudWxs\nIGlmIG5vIHdoZXJlCiAgICAgKiBjb25kaXRpb25zLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU1FMQnVmZmVyIGdldFdoZXJlKFNlbGVjdCBzZWwsIGJvb2xl\nYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgSm9pbnMgam9pbnMgPSBzZWwuZ2V0\nSm9pbnMoKTsKICAgICAgICBpZiAoc2VsLmdldEpvaW5TeW50YXgoKSA9PSBT\nWU5UQVhfU1FMOTIKICAgICAgICAgICAgfHwgam9pbnMgPT0gbnVsbCB8fCBq\nb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBzZWwuZ2V0V2hl\ncmUoKTsKCiAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgICBpZiAoc2VsLmdldFdoZXJlKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgd2hlcmUuYXBwZW5kKHNlbC5nZXRXaGVyZSgpKTsKICAg\nICAgICBpZiAoam9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgc2VsLmFwcGVu\nZCh3aGVyZSwgam9pbnMpOwogICAgICAgIHJldHVybiB3aGVyZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFVzZSB0aGUgZ2l2ZW4gam9pbiBpbnN0YW5jZSB0\nbyBjcmVhdGUgU1FMIGpvaW5pbmcgaXRzIHRhYmxlcyBpbgogICAgICogdGhl\nIHRyYWRpdGlvbmFsIHN0eWxlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVm\nZmVyIHRvVHJhZGl0aW9uYWxKb2luKEpvaW4gam9pbikgewogICAgICAgIEZv\ncmVpZ25LZXkgZmsgPSBqb2luLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBp\nZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIGJvb2xlYW4gaW52ZXJzZSA9IGpvaW4uaXNGb3JlaWduS2V5SW52ZXJz\nZWQoKTsKICAgICAgICBDb2x1bW5bXSBmcm9tID0gKGludmVyc2UpID8gZmsu\nZ2V0UHJpbWFyeUtleUNvbHVtbnMoKQogICAgICAgICAgICA6IGZrLmdldENv\nbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSB0byA9IChpbnZlcnNlKSA/IGZr\nLmdldENvbHVtbnMoKQogICAgICAgICAgICA6IGZrLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CgogICAgICAgIC8vIGRvIGNvbHVtbiBqb2lucwogICAgICAg\nIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAg\nIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\ncm9tLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChj\nb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkpLmFw\ncGVuZCgiLiIpLmFwcGVuZChmcm9tW2ldKTsKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiID0gIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRB\nbGlhczIoKSkuYXBwZW5kKCIuIikuYXBwZW5kKHRvW2ldKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGRvIGNvbnN0YW50IGpvaW5zCiAgICAgICAgQ29sdW1u\nW10gY29uc3RDb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25zdENvbHMubGVuZ3RoOyBpKyss\nIGNvdW50KyspIHsKICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGlm\nIChpbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZr\nLmdldENvbnN0YW50KGNvbnN0Q29sc1tpXSksIGNvbnN0Q29sc1tpXSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9p\nbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIikuCiAgICAgICAgICAgICAgICAg\nICAgYXBwZW5kKGNvbnN0Q29sc1tpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiA9ICIpOwoKICAgICAgICAgICAgaWYgKGludmVyc2UpCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgi\nLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0p\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nVmFsdWUoZmsuZ2V0Q29uc3RhbnQoY29uc3RDb2xzW2ldKSwgY29uc3RDb2xz\nW2ldKTsKICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGNvbnN0Q29sc1BL\nID0gZmsuZ2V0Q29uc3RhbnRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RDb2xzUEsubGVuZ3RoOyBpKyss\nIGNvdW50KyspIHsKICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGlm\nIChpbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdl\ndEFsaWFzMSgpKS5hcHBlbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBh\ncHBlbmQoY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUoZmsuZ2V0UHJpbWFyeUtleUNv\nbnN0YW50KGNvbnN0Q29sc1BLW2ldKSwKICAgICAgICAgICAgICAgICAgICBj\nb25zdENvbHNQS1tpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIp\nOwoKICAgICAgICAgICAgaWYgKGludmVyc2UpCiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kVmFsdWUoZmsuZ2V0UHJpbWFyeUtleUNvbnN0YW50KGNvbnN0\nQ29sc1BLW2ldKSwKICAgICAgICAgICAgICAgICAgICBjb25zdENvbHNQS1tp\nXSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoam9pbi5nZXRBbGlhczIoKSkuYXBwZW5kKCIuIikuCiAgICAgICAgICAg\nICAgICAgICAgYXBwZW5kKGNvbnN0Q29sc1BLW2ldKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICAvKioKICAgICAqIFVzZSB0\naGUgZ2l2ZW4gam9pbiBpbnN0YW5jZSB0byBjcmVhdGUgU1FMIGpvaW5pbmcg\naXRzIHRhYmxlcyBpbgogICAgICogdGhlIFNRTDkyIHN0eWxlLgogICAgICov\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU1FMOTJKb2luKFNlbGVjdCBzZWws\nIEpvaW4gam9pbiwgYm9vbGVhbiBmb3JVcGRhdGUsCiAgICAgICAgYm9vbGVh\nbiBmaXJzdCkgewogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVm\nZmVyKHRoaXMpOwoKICAgICAgICBpZiAoZmlyc3QpIHsKICAgICAgICAgICAg\nYnVmLmFwcGVuZChqb2luLmdldFRhYmxlMSgpKS5hcHBlbmQoIiAiKS4KICAg\nICAgICAgICAgICAgIGFwcGVuZChqb2luLmdldEFsaWFzMSgpKTsKICAgICAg\nICAgICAgaWYgKGZvclVwZGF0ZSAmJiB0YWJsZUZvclVwZGF0ZUNsYXVzZSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVu\nZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgfQoKICAgICAgICBi\ndWYuYXBwZW5kKCIgIik7CiAgICAgICAgaWYgKGpvaW4uZ2V0VHlwZSgpID09\nIEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgYnVmLmFwcGVuZChvdXRl\nckpvaW5DbGF1c2UpOwogICAgICAgIGVsc2UgaWYgKGpvaW4uZ2V0VHlwZSgp\nID09IEpvaW4uVFlQRV9JTk5FUikKICAgICAgICAgICAgYnVmLmFwcGVuZChp\nbm5lckpvaW5DbGF1c2UpOwogICAgICAgIGVsc2UgLy8gY3Jvc3MKICAgICAg\nICAgICAgYnVmLmFwcGVuZChjcm9zc0pvaW5DbGF1c2UpOwogICAgICAgIGJ1\nZi5hcHBlbmQoIiAiKTsKCiAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldFRh\nYmxlMigpKS5hcHBlbmQoIiAiKS5hcHBlbmQoam9pbi5nZXRBbGlhczIoKSk7\nCiAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiB0YWJsZUZvclVwZGF0ZUNsYXVz\nZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5k\nKHRhYmxlRm9yVXBkYXRlQ2xhdXNlKTsKCiAgICAgICAgaWYgKGpvaW4uZ2V0\nRm9yZWlnbktleSgpICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBPTiAiKS5hcHBlbmQodG9UcmFkaXRpb25hbEpvaW4oam9pbikpOwogICAg\nICAgIGVsc2UgaWYgKHJlcXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luICYm\nCiAgICAgICAgICAgICAgICBqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVf\nQ1JPU1MpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiAoMSA9IDEpIik7\nCiAgICAgICAgCiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICBwcml2\nYXRlIFNRTEJ1ZmZlciB0b0NvcnJlbGF0ZWRKb2luKFNlbGVjdCBzZWwsIEpv\naW4gam9pbiwgYm9vbGVhbiBmb3JVcGRhdGUsCiAgICAgICAgYm9vbGVhbiBm\naXJzdCkgewogICAgICAgIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBu\ndWxsKXsKICAgICAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1\nZmZlcih0aGlzKTsKICAgICAgICAgICAgd2hlcmUuYXBwZW5kKCIoIikuYXBw\nZW5kKHRvVHJhZGl0aW9uYWxKb2luKGpvaW4pKS5hcHBlbmQoIikiKTsKICAg\nICAgICAgICAgc2VsLndoZXJlKHdoZXJlLmdldFNRTCgpKTsKICAgICAgICB9\nCgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nVXNlIHRoZSBnaXZlbiBqb2luIGluc3RhbmNlIHRvIGNyZWF0ZSBTUUwgam9p\nbmluZyBpdHMgdGFibGVzIGluCiAgICAgKiB0aGUgZGF0YWJhc2UncyBuYXRp\ndmUgc3ludGF4LiBUaHJvd3MgYW4gZXhjZXB0aW9uIGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9OYXRpdmVKb2luKEpvaW4g\nam9pbikgewogICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbigpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBpZiB0aGUgZ2l2\nZW4gZm9yZWlnbiBrZXkgY2FuIGJlIGVhZ2VybHkgbG9hZGVkIHVzaW5nIG90\naGVyIGpvaW5zLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5PdXRl\nckpvaW4oaW50IHN5bnRheCwgRm9yZWlnbktleSBmaykgewogICAgICAgIHJl\ndHVybiBzeW50YXggIT0gU1lOVEFYX1RSQURJVElPTkFMOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29tYmluZSB0aGUgZ2l2ZW4gY29tcG9uZW50cyBpbnRv\nIGEgU0VMRUNUIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FM\nQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVm\nZmVyIGhhdmluZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4g\nZGlzdGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25n\nIGVuZCkgewogICAgICAgIHJldHVybiB0b09wZXJhdGlvbihnZXRTZWxlY3RP\ncGVyYXRpb24oZmV0Y2gpLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwKICAgICAg\nICAgICAgZ3JvdXAsIGhhdmluZywgb3JkZXIsIGRpc3RpbmN0LCBzdGFydCwg\nZW5kLAogICAgICAgICAgICBnZXRGb3JVcGRhdGVDbGF1c2UoZmV0Y2gsIGZv\nclVwZGF0ZSwgbnVsbCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tYmlu\nZSB0aGUgZ2l2ZW4gY29tcG9uZW50cyBpbnRvIGEgU0VMRUNUIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciB0b1NlbGVjdChT\nUUxCdWZmZXIgc2VsZWN0cywKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIg\nd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2\naW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5j\ndCwgYm9vbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAog\nICAgICAgIGJvb2xlYW4gc3Vic2VsZWN0LCBTZWxlY3Qgc2VsKSB7CiAgICAg\nICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRj\naCksIHNlbGVjdHMsIGZyb20sIHdoZXJlLAogICAgICAgICAgICBncm91cCwg\naGF2aW5nLCBvcmRlciwgZGlzdGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAg\nICAgIGdldEZvclVwZGF0ZUNsYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBudWxs\nKSwgc3Vic2VsZWN0KTsKICAgIH0KICAgIAogICAgcHVibGljIFNRTEJ1ZmZl\nciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwKICAgICAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNR\nTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgICAgICBT\nUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgICAg\nIGJvb2xlYW4gZGlzdGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0\nYXJ0LCBsb25nIGVuZCwKICAgICAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3Qs\nIGJvb2xlYW4gY2hlY2tUYWJsZUZvclVwZGF0ZSkgewogICAgICAgICAgICBy\nZXR1cm4gdG9PcGVyYXRpb24oZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwg\nc2VsZWN0cywgZnJvbSwgd2hlcmUsCiAgICAgICAgICAgICAgICAgICAgZ3Jv\ndXAsIGhhdmluZywgb3JkZXIsIGRpc3RpbmN0LCBzdGFydCwgZW5kLAogICAg\nICAgICAgICAgICAgICAgIGdldEZvclVwZGF0ZUNsYXVzZShmZXRjaCwgZm9y\nVXBkYXRlLCBudWxsKSwgc3Vic2VsZWN0LAogICAgICAgICAgICAgICAgICAg\nIGNoZWNrVGFibGVGb3JVcGRhdGUpOwogICAgICAgIH0KCiAgICAvKioKICAg\nICAqIENvbWJpbmUgdGhlIGdpdmVuIGNvbXBvbmVudHMgaW50byBhIFNFTEVD\nVCBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZmZXIg\ndG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdHMsIAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgU1FMQnVmZmVyIGZyb20s\nIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNR\nTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29s\nZWFuIGRpc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwg\nbG9uZyBlbmQsCiAgICAgICAgU2VsZWN0IHNlbCkgewogICAgICAgIHJldHVy\nbiB0b09wZXJhdGlvbihnZXRTZWxlY3RPcGVyYXRpb24oZmV0Y2gpLCBzZWxl\nY3RzLCBmcm9tLCB3aGVyZSwKICAgICAgICAgICAgZ3JvdXAsIGhhdmluZywg\nb3JkZXIsIGRpc3RpbmN0LCBzdGFydCwgZW5kLAogICAgICAgICAgICBnZXRG\nb3JVcGRhdGVDbGF1c2UoZmV0Y2gsIGZvclVwZGF0ZSwgc2VsKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHVwZGF0ZSBjbGF1c2UgZm9yIHRo\nZSBxdWVyeSBiYXNlZCBvbiB0aGUKICAgICAqIHVwZGF0ZUNsYXVzZSBhbmQg\naXNvbGF0aW9uTGV2ZWwgaGludHMKICAgICAqLwogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXRGb3JVcGRhdGVDbGF1c2UoSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwKICAgICAgICBib29sZWFuIGlzRm9yVXBkYXRlLCBTZWxlY3Qg\nc2VsKSB7CiAgICAgICAgaWYgKGZldGNoICE9IG51bGwgJiYgZmV0Y2guZ2V0\nSXNvbGF0aW9uKCkgIT0gLTEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAg\nICJpc29sYXRpb24tbGV2ZWwtY29uZmlnLW5vdC1zdXBwb3J0ZWQiLCBnZXRD\nbGFzcygpLmdldE5hbWUoKSkpOwogICAgICAgIH0gZWxzZSBpZiAoaXNGb3JV\ncGRhdGUgJiYgIXNpbXVsYXRlTG9ja2luZykgewogICAgICAgICAgICBhc3Nl\ncnRTdXBwb3J0KHN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlLCAiU3VwcG9ydHNT\nZWxlY3RGb3JVcGRhdGUiKTsKICAgICAgICAgICAgcmV0dXJuIGZvclVwZGF0\nZUNsYXVzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndHJ1ZSBpZiB0aGUgZGljdGlvbmFyeSB1c2VzIGlzb2xhdGlvbiBsZXZlbCB0\nbyBjb21wdXRlIHRoZSAKICAgICAqIHJldHVybmVkIGdldEZvclVwZGF0ZUNs\nYXVzZSgpIFNRTCBjbGF1c2UuICAKICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gc3VwcG9ydHNJc29sYXRpb25Gb3JVcGRhdGUoKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgIlNFTEVDVCIgb3BlcmF0aW9uIGNsYXVzZSwgYWRkaW5nIGFueSBhdmFp\nbGFibGUgaGludHMsIGV0Yy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRTZWxlY3RPcGVyYXRpb24oSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIHJldHVybiAiU0VMRUNUIjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5n\nIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09w\nZXJhdGlvbihTdHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAg\nIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBn\ncm91cCwgU1FMQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3Jk\nZXIsIGJvb2xlYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAog\nICAgICAgIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UpIHsKICAgICAgICByZXR1\ncm4gdG9PcGVyYXRpb24ob3AsIHNlbGVjdHMsIGZyb20sIHdoZXJlLCBncm91\ncCwgaGF2aW5nLCBvcmRlciwKICAgICAgICAgICAgZGlzdGluY3QsIHN0YXJ0\nLCBlbmQsIGZvclVwZGF0ZUNsYXVzZSwgZmFsc2UpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2Vs\nZWN0aW5nIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZl\nciB0b09wZXJhdGlvbihTdHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAog\nICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1\nZmZlciBncm91cCwgU1FMQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZm\nZXIgb3JkZXIsIGJvb2xlYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcg\nZW5kLAogICAgICAgIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UsIGJvb2xlYW4g\nc3Vic2VsZWN0KSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBz\nZWxlY3RzLCBmcm9tLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAg\nICAgICAgICAgICAgICBkaXN0aW5jdCwgc3RhcnQsIGVuZCwgZm9yVXBkYXRl\nQ2xhdXNlLCBzdWJzZWxlY3QsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9w\nZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgdG9PcGVy\nYXRpb24oU3RyaW5nIG9wLCBTUUxCdWZmZXIgc2VsZWN0cywgU1FMQnVmZmVy\nIGZyb20sCiAgICAgICAgICAgIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVy\nIGdyb3VwLCBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAg\nICAgICAgICAgIGJvb2xlYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcg\nZW5kLCBTdHJpbmcgZm9yVXBkYXRlQ2xhdXNlLAogICAgICAgICAgICBib29s\nZWFuIHN1YnNlbGVjdCwgYm9vbGVhbiBjaGVja1RhYmxlRm9yVXBkYXRlKSB7\nCiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7\nCiAgICAgICAgYnVmLmFwcGVuZChvcCk7CgogICAgICAgIGJvb2xlYW4gcmFu\nZ2UgPSBzdGFydCAhPSAwIHx8IGVuZCAhPSBMb25nLk1BWF9WQUxVRTsKICAg\nICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlvbiA9PSBSQU5HRV9QUkVf\nRElTVElOQ1QpCiAgICAgICAgICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwg\nc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsKICAgICAgICBpZiAoZGlzdGluY3Qp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBESVNUSU5DVCIpOwogICAgICAg\nIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1RfRElT\nVElOQ1QpCiAgICAgICAgICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwgc3Rh\ncnQsIGVuZCwgc3Vic2VsZWN0KTsKCiAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZChzZWxlY3RzKS5hcHBlbmQoIiBGUk9NICIpLmFwcGVuZChmcm9t\nKTsKCiAgICAgICAgaWYgKGNoZWNrVGFibGVGb3JVcGRhdGUKICAgICAgICAg\nICAgICAgICYmIChTdHJpbmdVdGlscy5pc0VtcHR5KGZvclVwZGF0ZUNsYXVz\nZSkgJiYgIVN0cmluZ1V0aWxzCiAgICAgICAgICAgICAgICAgICAgICAgIC5p\nc0VtcHR5KHRhYmxlRm9yVXBkYXRlQ2xhdXNlKSkpIHsKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hl\ncmUuaXNFbXB0eSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgV0hFUkUg\nIikuYXBwZW5kKHdoZXJlKTsKICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCAm\nJiAhZ3JvdXAuaXNFbXB0eSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nR1JPVVAgQlkgIikuYXBwZW5kKGdyb3VwKTsKICAgICAgICBpZiAoaGF2aW5n\nICE9IG51bGwgJiYgIWhhdmluZy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nYXNzZXJ0U3VwcG9ydChzdXBwb3J0c0hhdmluZywgIlN1cHBvcnRzSGF2aW5n\nIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBIQVZJTkcgIikuYXBwZW5k\nKGhhdmluZyk7CiAgICAgICAgfQogICAgICAgIGlmIChvcmRlciAhPSBudWxs\nICYmICFvcmRlci5pc0VtcHR5KCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBPUkRFUiBCWSAiKS5hcHBlbmQob3JkZXIpOwogICAgICAgIGlmIChyYW5n\nZSAmJiByYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1RfU0VMRUNUKQogICAg\nICAgICAgICBhcHBlbmRTZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1\nYnNlbGVjdCk7CiAgICAgICAgaWYgKGZvclVwZGF0ZUNsYXVzZSAhPSBudWxs\nKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKGZvclVwZGF0\nZUNsYXVzZSk7CiAgICAgICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRpb24g\nPT0gUkFOR0VfUE9TVF9MT0NLKQogICAgICAgICAgICBhcHBlbmRTZWxlY3RS\nYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAgICAgcmV0\ndXJuIGJ1ZjsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoaXMgZGljdGlv\nbmFyeSBjYW4gc2VsZWN0IHJhbmdlcywKICAgICAqIHVzZSB0aGlzIG1ldGhv\nZCB0byBhcHBlbmQgdGhlIHJhbmdlIFNRTC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgYXBwZW5kU2VsZWN0UmFuZ2UoU1FMQnVmZmVyIGJ1ZiwgbG9u\nZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3Qp\nIHsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcG9ydGlvbiBv\nZiB0aGUgc2VsZWN0IHN0YXRlbWVudCBiZXR3ZWVuIHRoZSBTRUxFQ1Qga2V5\nd29yZAogICAgICogYW5kIHRoZSBGUk9NIGtleXdvcmQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTUUxCdWZmZXIgZ2V0U2VsZWN0cyhTZWxlY3Qgc2VsLCBi\nb29sZWFuIGRpc3RpbmN0SWRlbnRpZmllcnMsCiAgICAgICAgYm9vbGVhbiBm\nb3JVcGRhdGUpIHsKICAgICAgICAvLyBhcHBlbmQgdGhlIGFsaWFzZXMgZm9y\nIGFsbCB0aGUgY29sdW1ucwogICAgICAgIFNRTEJ1ZmZlciBzZWxlY3RTUUwg\nPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIExpc3QgYWxpYXNlczsK\nICAgICAgICBpZiAoZGlzdGluY3RJZGVudGlmaWVycykKICAgICAgICAgICAg\nYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlmaWVyQWxpYXNlcygpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRTZWxlY3RBbGlh\nc2VzKCk7CgogICAgICAgIE9iamVjdCBhbGlhczsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAg\nICAgYWxpYXMgPSBhbGlhc2VzLmdldChpKTsKICAgICAgICAgICAgYXBwZW5k\nU2VsZWN0KHNlbGVjdFNRTCwgYWxpYXMsIHNlbCwgaSk7CiAgICAgICAgICAg\nIGlmIChpIDwgYWxpYXNlcy5zaXplKCkgLSAxKQogICAgICAgICAgICAgICAg\nc2VsZWN0U1FMLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHNlbGVjdFNRTDsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCA8\nY29kZT5lbGVtPC9jb2RlPiB0byA8Y29kZT5zZWxlY3RTUUw8L2NvZGU+Lgog\nICAgICogQHBhcmFtIHNlbGVjdFNRTCBUaGUgU1FMQnVmZmVyIHRvIGFwcGVu\nZCB0by4KICAgICAqIEBwYXJhbSBhbGlhcyBBIHtAbGluayBTUUxCdWZmZXJ9\nIG9yIGEge0BsaW5rIFN0cmluZ30gdG8gYXBwZW5kLgogICAgICoKICAgICAq\nIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBl\nbmRTZWxlY3QoU1FMQnVmZmVyIHNlbGVjdFNRTCwgT2JqZWN0IGVsZW0sIFNl\nbGVjdCBzZWwsCiAgICAgICAgaW50IGlkeCkgewogICAgICAgIGlmIChlbGVt\nIGluc3RhbmNlb2YgU1FMQnVmZmVyKQogICAgICAgICAgICBzZWxlY3RTUUwu\nYXBwZW5kKChTUUxCdWZmZXIpIGVsZW0pOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc2VsZWN0U1FMLmFwcGVuZChlbGVtLnRvU3RyaW5nKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIGEgIkZPUiBVUERB\nVEUiIGNsYXVzZSBjYW4gYmUgdXNlZCBmb3IgdGhlIHNwZWNpZmllZAogICAg\nICogU2VsZWN0IG9iamVjdC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNMb2NraW5nKFNlbGVjdCBzZWwpIHsKICAgICAgICBpZiAoc2Vs\nLmlzQWdncmVnYXRlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAoIXN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdX\naXRoU2VsZWN0UmFuZ2UgJiYgKHNlbC5nZXRTdGFydEluZGV4KCkgIT0gMAog\nICAgICAgICAgICB8fCBzZWwuZ2V0RW5kSW5kZXgoKSAhPSBMb25nLk1BWF9W\nQUxVRSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8g\nb25seSBpbm5lciBzZWxlY3QgaXMgbG9ja2VkCiAgICAgICAgaWYgKHNlbC5n\nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgc2VsID0gc2Vs\nLmdldEZyb21TZWxlY3QoKTsKCiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tp\nbmdXaXRoRGlzdGluY3RDbGF1c2UgJiYgc2VsLmlzRGlzdGluY3QoKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNM\nb2NraW5nV2l0aE11bHRpcGxlVGFibGVzCiAgICAgICAgICAgICYmIHNlbC5n\nZXRUYWJsZUFsaWFzZXMoKS5zaXplKCkgPiAxKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoT3Jk\nZXJDbGF1c2UgJiYgc2VsLmdldE9yZGVyaW5nKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNMb2Nr\naW5nV2l0aE91dGVySm9pbiB8fCAhc3VwcG9ydHNMb2NraW5nV2l0aElubmVy\nSm9pbikgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNlbC5n\nZXRKb2luSXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIEpvaW4gam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoT3V0ZXJKb2luCiAg\nICAgICAgICAgICAgICAgICAgJiYgam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5U\nWVBFX09VVEVSKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aElubmVy\nSm9pbgogICAgICAgICAgICAgICAgICAgICYmIGpvaW4uZ2V0VHlwZSgpID09\nIEpvaW4uVFlQRV9JTk5FUikKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gZmFsc2UgaWYg\ndGhlIGdpdmVuIHNlbGVjdCByZXF1aXJlcyBhIGZvcndhcmQtb25seSByZXN1\nbHQgc2V0LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jh\nbmRvbUFjY2Vzc1Jlc3VsdFNldChTZWxlY3Qgc2VsLAogICAgICAgIGJvb2xl\nYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgcmV0dXJuICFzZWwuaXNBZ2dyZWdh\ndGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSBn\naXZlbiBkaWN0aW9uYXJ5IGZsYWcgaXMgdHJ1ZS4gSWYgaXQgaXMgbm90IHRy\ndWUsCiAgICAgKiB0aHJvdyBhbiBlcnJvciBzYXlpbmcgdGhhdCB0aGUgZ2l2\nZW4gc2V0dGluZyBuZWVkcyB0byByZXR1cm4gdHJ1ZSBmb3IKICAgICAqIHRo\nZSBjdXJyZW50IG9wZXJhdGlvbiB0byB3b3JrLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBhc3NlcnRTdXBwb3J0KGJvb2xlYW4gZmVhdHVyZSwgU3RyaW5n\nIHByb3BlcnR5KSB7CiAgICAgICAgaWYgKCFmZWF0dXJlKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImZl\nYXR1cmUtbm90LXN1cHBvcnRlZCIsCiAgICAgICAgICAgICAgICBnZXRDbGFz\ncygpLCBwcm9wZXJ0eSkpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBRdWVyeSBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhpcyBkYXRhYmFzZSdz\nIHN1YnN0cmluZyBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVm\nIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBzdWJzdHJpbmcgaW52b2Nh\ndGlvbiB0bwogICAgICogQHBhcmFtIHN0ciBhIHF1ZXJ5IHZhbHVlIHJlcHJl\nc2VudGluZyB0aGUgdGFyZ2V0IHN0cmluZwogICAgICogQHBhcmFtIHN0YXJ0\nIGEgcXVlcnkgdmFsdWUgcmVwcmVzZW50aW5nIHRoZSBzdGFydCBpbmRleAog\nICAgICogQHBhcmFtIGVuZCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0\naGUgZW5kIGluZGV4LCBvciBudWxsIGZvciBub25lCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHN1YnN0cmluZyhTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1\nZSBzdHIsIEZpbHRlclZhbHVlIHN0YXJ0LAogICAgICAgIEZpbHRlclZhbHVl\nIGVuZCkgewogICAgICAgIGJ1Zi5hcHBlbmQoc3Vic3RyaW5nRnVuY3Rpb25O\nYW1lKS5hcHBlbmQoIigiKTsKICAgICAgICBzdHIuYXBwZW5kVG8oYnVmKTsK\nICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgIGlmIChzdGFydC5n\nZXRWYWx1ZSgpIGluc3RhbmNlb2YgTnVtYmVyKSB7CiAgICAgICAgICAgIGxv\nbmcgc3RhcnRMb25nID0gdG9Mb25nKHN0YXJ0KTsKICAgICAgICAgICAgYnVm\nLmFwcGVuZChMb25nLnRvU3RyaW5nKHN0YXJ0TG9uZyArIDEpKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBidWYuYXBwZW5kKCIoIik7CiAgICAg\nICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiArIDEpIik7CiAgICAgICAgfQogICAgICAgIGlmIChlbmQgIT0g\nbnVsbCkgewogICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAg\nICAgICBpZiAoc3RhcnQuZ2V0VmFsdWUoKSBpbnN0YW5jZW9mIE51bWJlcgog\nICAgICAgICAgICAgICAgJiYgZW5kLmdldFZhbHVlKCkgaW5zdGFuY2VvZiBO\ndW1iZXIpIHsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnRMb25nID0gdG9M\nb25nKHN0YXJ0KTsKICAgICAgICAgICAgICAgIGxvbmcgZW5kTG9uZyA9IHRv\nTG9uZyhlbmQpOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChMb25nLnRv\nU3RyaW5nKGVuZExvbmcgLSBzdGFydExvbmcpKTsKICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIGVuZC5hcHBlbmRUbyhidWYpOwogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIC0gKCIpOwogICAgICAgICAgICAg\nICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIikiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBi\ndWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgbG9uZyB0b0xvbmcoRmlsdGVy\nVmFsdWUgbGl0VmFsdWUpIHsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGxp\ndFZhbHVlLmdldFZhbHVlKCkpLmxvbmdWYWx1ZSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW52b2tlIHRoaXMgZGF0YWJhc2UncyBpbmRleE9mIGZ1bmN0\naW9uLgogICAgICoKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIg\ndG8gd3JpdGUgdGhlIGluZGV4T2YgaW52b2NhdGlvbiB0bwogICAgICogQHBh\ncmFtIHN0ciBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0\nIHN0cmluZwogICAgICogQHBhcmFtIGZpbmQgYSBxdWVyeSB2YWx1ZSByZXBy\nZXNlbnRpbmcgdGhlIHNlYXJjaCBzdHJpbmcKICAgICAqIEBwYXJhbSBzdGFy\ndCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgc3RhcnQgaW5kZXgs\nIG9yIG51bGwKICAgICAqIHRvIHN0YXJ0IGF0IHRoZSBiZWdpbm5pbmcKICAg\nICAqLwogICAgcHVibGljIHZvaWQgaW5kZXhPZihTUUxCdWZmZXIgYnVmLCBG\naWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVlIGZpbmQsCiAgICAgICAgRmls\ndGVyVmFsdWUgc3RhcnQpIHsKICAgICAgICBidWYuYXBwZW5kKCIoSU5TVFIo\nKCIpOwogICAgICAgIGlmIChzdGFydCAhPSBudWxsKQogICAgICAgICAgICBz\ndWJzdHJpbmcoYnVmLCBzdHIsIHN0YXJ0LCBudWxsKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHN0ci5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIiksICgiKTsKICAgICAgICBmaW5kLmFwcGVuZFRvKGJ1Zik7CiAg\nICAgICAgYnVmLmFwcGVuZCgiKSkgLSAxIik7CiAgICAgICAgaWYgKHN0YXJ0\nICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICsgIik7CiAg\nICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgfQogICAg\nICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFw\ncGVuZCB0aGUgbnVtZXJpYyBwYXJ0cyBvZiBhIG1hdGhlbWF0aWNhbCBmdW5j\ndGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVy\nIHRvIHdyaXRlIHRoZSBtYXRoIGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0gb3Ag\ndGhlIG1hdGhlbWF0aWNhbCBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICog\nQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIG1hdGggZnVu\nY3Rpb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBv\nZiB0aGUgbWF0aCBmdW5jdGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBt\nYXRoRnVuY3Rpb24oU1FMQnVmZmVyIGJ1ZiwgU3RyaW5nIG9wLCBGaWx0ZXJW\nYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVyVmFsdWUgcmhzKSB7CiAgICAgICAg\nYm9vbGVhbiBjYXN0bGhzID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBjYXN0\ncmhzID0gZmFsc2U7CiAgICAgICAgQ2xhc3MgbGMgPSBGaWx0ZXJzLndyYXAo\nbGhzLmdldFR5cGUoKSk7CiAgICAgICAgQ2xhc3MgcmMgPSBGaWx0ZXJzLndy\nYXAocmhzLmdldFR5cGUoKSk7CiAgICAgICAgaW50IHR5cGUgPSAwOwogICAg\nICAgIGlmIChyZXF1aXJlc0Nhc3RGb3JNYXRoRnVuY3Rpb25zICYmIChsYyAh\nPSByYwogICAgICAgICAgICB8fCAobGhzLmlzQ29uc3RhbnQoKSB8fCByaHMu\naXNDb25zdGFudCgpKSkpIHsKICAgICAgICAgICAgQ2xhc3MgYyA9IEZpbHRl\ncnMucHJvbW90ZShsYywgcmMpOwogICAgICAgICAgICB0eXBlID0gZ2V0SkRC\nQ1R5cGUoSmF2YVR5cGVzLmdldFR5cGVDb2RlKGMpLCBmYWxzZSk7CiAgICAg\nICAgICAgIGlmICh0eXBlICE9IFR5cGVzLlZBUkJJTkFSWSAmJiB0eXBlICE9\nIFR5cGVzLkJMT0IpIHsKICAgICAgICAgICAgICAgIGNhc3RsaHMgPSAobGhz\nLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSB8fCBsYyAhPSBj\nOwogICAgICAgICAgICAgICAgY2FzdHJocyA9IChsaHMuaXNDb25zdGFudCgp\nICYmIHJocy5pc0NvbnN0YW50KCkpIHx8IHJjICE9IGM7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gbW9kID0gIk1PRCIuZXF1\nYWxzKG9wKTsKICAgICAgICBpZiAobW9kKSB7CiAgICAgICAgICAgIGlmIChz\ndXBwb3J0c01vZE9wZXJhdG9yKQogICAgICAgICAgICAgICAgb3AgPSAiJSI7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nb3ApOwogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5kKCIoIik7CgogICAg\nICAgIGlmIChjYXN0bGhzKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1Ziwg\nbGhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxocy5hcHBl\nbmRUbyhidWYpOwoKICAgICAgICBpZiAobW9kICYmICFzdXBwb3J0c01vZE9w\nZXJhdG9yKQogICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCku\nYXBwZW5kKCIgIik7CgogICAgICAgIGlmIChjYXN0cmhzKQogICAgICAgICAg\nICBhcHBlbmRDYXN0KGJ1ZiwgcmhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJocy5hcHBlbmRUbyhidWYpOwoKICAgICAgICBidWYuYXBw\nZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBjb21w\nYXJpc29uLgogICAgICoKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZm\nZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0\naGUgY29tcGFyaXNvbiBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBh\ncmFtIGxocyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24K\nICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUg\nY29tcGFyaXNvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjb21wYXJpc29u\nKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhzLAog\nICAgICAgIEZpbHRlclZhbHVlIHJocykgewogICAgICAgIGJvb2xlYW4gbGhz\neG1sID0gbGhzLmdldFhQYXRoKCkgIT0gbnVsbDsKICAgICAgICBib29sZWFu\nIHJoc3htbCA9IHJocy5nZXRYUGF0aCgpICE9IG51bGw7CiAgICAgICAgaWYg\nKGxoc3htbCB8fCByaHN4bWwpIHsKICAgICAgICAgICAgYXBwZW5kWG1sQ29t\ncGFyaXNvbihidWYsIG9wLCBsaHMsIHJocywgbGhzeG1sLCByaHN4bWwpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGJvb2xlYW4g\nY2FzdGxocyA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gY2FzdHJocyA9IGZh\nbHNlOwogICAgICAgIENsYXNzIGxjID0gRmlsdGVycy53cmFwKGxocy5nZXRU\neXBlKCkpOwogICAgICAgIENsYXNzIHJjID0gRmlsdGVycy53cmFwKHJocy5n\nZXRUeXBlKCkpOwogICAgICAgIGludCB0eXBlID0gMDsKICAgICAgICBpZiAo\ncmVxdWlyZXNDYXN0Rm9yQ29tcGFyaXNvbnMgJiYgKGxjICE9IHJjCiAgICAg\nICAgICAgIHx8IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50\nKCkpKSkgewogICAgICAgICAgICBDbGFzcyBjID0gRmlsdGVycy5wcm9tb3Rl\nKGxjLCByYyk7CiAgICAgICAgICAgIHR5cGUgPSBnZXRKREJDVHlwZShKYXZh\nVHlwZXMuZ2V0VHlwZUNvZGUoYyksIGZhbHNlKTsKICAgICAgICAgICAgaWYg\nKHR5cGUgIT0gVHlwZXMuVkFSQklOQVJZICYmIHR5cGUgIT0gVHlwZXMuQkxP\nQikgewogICAgICAgICAgICAgICAgY2FzdGxocyA9IChsaHMuaXNDb25zdGFu\ndCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8IGxjICE9IGM7CiAgICAgICAg\nICAgICAgICBjYXN0cmhzID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlz\nQ29uc3RhbnQoKSkgfHwgcmMgIT0gYzsKICAgICAgICAgICAgICAgIGNhc3Rs\naHMgPSBjYXN0bGhzICYmIGxocy5yZXF1aXJlc0Nhc3QoKTsKICAgICAgICAg\nICAgICAgIGNhc3RyaHMgPSBjYXN0cmhzICYmIHJocy5yZXF1aXJlc0Nhc3Qo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGNhc3Rs\naHMpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCBsaHMsIHR5cGUpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgbGhzLmFwcGVuZFRvKGJ1Zik7Cgog\nICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIp\nOwoKICAgICAgICBpZiAoY2FzdHJocykKICAgICAgICAgICAgYXBwZW5kQ2Fz\ndChidWYsIHJocywgdHlwZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBy\naHMuYXBwZW5kVG8oYnVmKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRo\naXMgZGljdGlvbmFyeSBzdXBwb3J0cyBYTUwgdHlwZSwKICAgICAqIHVzZSB0\naGlzIG1ldGhvZCB0byBhcHBlbmQgeG1sIHByZWRpY2F0ZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgYXBwZW5kWG1sQ29tcGFyaXNvbihTUUxCdWZmZXIg\nYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVlIGxocywKICAgICAgICBGaWx0\nZXJWYWx1ZSByaHMsIGJvb2xlYW4gbGhzeG1sLCBib29sZWFuIHJoc3htbCkg\newogICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNYTUxDb2x1bW4sICJT\ndXBwb3J0c1hNTENvbHVtbiIpOwogICAgfQoKICAgIC8qKgogICAgICogQXBw\nZW5kIFNRTCBmb3IgdGhlIGdpdmVuIG51bWVyaWMgdmFsdWUgdG8gdGhlIGJ1\nZmZlciwgY2FzdGluZyBhcyBuZWVkZWQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGFwcGVuZE51bWVyaWNDYXN0KFNRTEJ1ZmZlciBidWYsIEZpbHRl\nclZhbHVlIHZhbCkgewogICAgICAgIGlmICh2YWwuaXNDb25zdGFudCgpKQog\nICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgdmFsLCBUeXBlcy5OVU1FUklD\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHZhbC5hcHBlbmRUbyhidWYp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2FzdCB0aGUgc3BlY2lmaWVkIHZh\nbHVlIHRvIHRoZSBzcGVjaWZpZWQgdHlwZS4KICAgICAqCiAgICAgKiBAcGFy\nYW0gYnVmIHRoZSBidWZmZXIgdG8gYXBwZW5kIHRoZSBjYXN0IHRvCiAgICAg\nKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBjYXN0CiAgICAgKiBAcGFyYW0g\ndHlwZSB0aGUgdHlwZSBvZiB0aGUgY2FzZSwgZS5nLiB7QGxpbmsgVHlwZXMj\nTlVNRVJJQ30KICAgICAqLwogICAgcHVibGljIHZvaWQgYXBwZW5kQ2FzdChT\nUUxCdWZmZXIgYnVmLCBPYmplY3QgdmFsLCBpbnQgdHlwZSkgewogICAgICAg\nIC8vIENvbnZlcnQgdGhlIGNhc3QgZnVuY3Rpb246ICJDQVNUKHswfSBBUyB7\nMX0pIgogICAgICAgIGludCBmaXJzdFBhcmFtID0gY2FzdEZ1bmN0aW9uLmlu\nZGV4T2YoInswfSIpOwogICAgICAgIFN0cmluZyBwcmUgPSBjYXN0RnVuY3Rp\nb24uc3Vic3RyaW5nKDAsIGZpcnN0UGFyYW0pOyAvLyAiQ0FTVCgiCiAgICAg\nICAgU3RyaW5nIG1pZCA9IGNhc3RGdW5jdGlvbi5zdWJzdHJpbmcoZmlyc3RQ\nYXJhbSArIDMpOwogICAgICAgIGludCBzZWNvbmRQYXJhbSA9IG1pZC5pbmRl\neE9mKCJ7MX0iKTsKICAgICAgICBTdHJpbmcgcG9zdDsKICAgICAgICBpZiAo\nc2Vjb25kUGFyYW0gPiAtMSkgewogICAgICAgICAgICBwb3N0ID0gbWlkLnN1\nYnN0cmluZyhzZWNvbmRQYXJhbSArIDMpOyAvLyAiKSIKICAgICAgICAgICAg\nbWlkID0gbWlkLnN1YnN0cmluZygwLCBzZWNvbmRQYXJhbSk7IC8vICIgQVMg\nIgogICAgICAgIH0gZWxzZQogICAgICAgICAgICBwb3N0ID0gIiI7CgogICAg\nICAgIGJ1Zi5hcHBlbmQocHJlKTsKICAgICAgICBpZiAodmFsIGluc3RhbmNl\nb2YgRmlsdGVyVmFsdWUpCiAgICAgICAgICAgICgoRmlsdGVyVmFsdWUpIHZh\nbCkuYXBwZW5kVG8oYnVmKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFu\nY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoKChTUUxC\ndWZmZXIpIHZhbCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFw\ncGVuZCh2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgYnVmLmFwcGVuZChtaWQp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0VHlwZU5hbWUodHlwZSkpOwogICAg\nICAgIGFwcGVuZExlbmd0aChidWYsIHR5cGUpOwogICAgICAgIGJ1Zi5hcHBl\nbmQocG9zdCk7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVu\nZExlbmd0aChTUUxCdWZmZXIgYnVmLCBpbnQgdHlwZSkgeyAgICAgICAgCiAg\nICB9CgogICAgCiAgICAvKioKICAgICAqIGFkZCBDQVNUIGZvciBhIGZ1bmN0\naW9uIG9wZXJhdG9yIHdoZXJlIG9wZXJhbmQgaXMgYSBwYXJhbQogICAgICog\nQHBhcmFtIGZ1bmMgIGZ1bmN0aW9uIG5hbWUKICAgICAqIEBwYXJhbSB2YWwg\nCiAgICAgKiBAcmV0dXJuIHVwZGF0ZWQgZnVuYwogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGFkZENhc3RBc1R5cGUoU3RyaW5nIGZ1bmMsIFZhbCB2YWwp\nIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0gICAgCgoKICAgIC8vLy8v\nLy8vLy8vCiAgICAvLyBEREwgU1FMCiAgICAvLy8vLy8vLy8vLwoKICAgIC8q\nKgogICAgICogSW5jcmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQgb2YgYW55\nIHRhYmxlIGNvbXBvbmVudHMgdGhhdCB0aGlzCiAgICAgKiBkaWN0aW9uYXJ5\nIGFkZHMgdGhhdCBhcmUgbm90IHVzZWQgYnkgbWFwcGluZ3MuIERvZXMgbm90\naGluZyBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWZT\nY2hlbWFDb21wb25lbnRzKFRhYmxlIHRhYmxlKSB7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRhYmxlLCBp\nbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB7QGxp\nbmsgI2NhdGFsb2dTZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZyBnZXRGdWxsTmFtZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dpY2Fs\nKSB7CiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IHRhYmxlLmdldFNj\naGVtYU5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGFibGUu\nZ2V0TmFtZSgpOwogICAgICAgIGlmIChsb2dpY2FsIHx8ICIuIi5lcXVhbHMo\nY2F0YWxvZ1NlcGFyYXRvcikpCiAgICAgICAgICAgIHJldHVybiB0YWJsZS5n\nZXRGdWxsTmFtZSgpOwogICAgICAgIHJldHVybiB0YWJsZS5nZXRTY2hlbWFO\nYW1lKCkgKyBjYXRhbG9nU2VwYXJhdG9yICsgdGFibGUuZ2V0TmFtZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZnVsbCBuYW1lIG9m\nIHRoZSBpbmRleCwgaW5jbHVkaW5nIHRoZSBzY2hlbWEgKGRlbGltaXRlZAog\nICAgICogYnkgdGhlIHJlc3VsdCBvZiB7QGxpbmsgI2NhdGFsb2dTZXBhcmF0\nb3J9KS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFtZShJ\nbmRleCBpbmRleCkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBp\nbmRleC5nZXRTY2hlbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGluZGV4LmdldE5hbWUoKTsKICAgICAgICBpZiAoIi4iLmVxdWFscyhj\nYXRhbG9nU2VwYXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIGluZGV4Lmdl\ndEZ1bGxOYW1lKCk7CiAgICAgICAgcmV0dXJuIGluZGV4LmdldFNjaGVtYU5h\nbWUoKSArIGNhdGFsb2dTZXBhcmF0b3IgKyBpbmRleC5nZXROYW1lKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2Yg\ndGhlIHNlcXVlbmNlLCBpbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVk\nCiAgICAgKiBieSB0aGUgcmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFy\nYXRvcn0pLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1l\nKFNlcXVlbmNlIHNlcSkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8\nfCBzZXEuZ2V0U2NoZW1hTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBzZXEuZ2V0TmFtZSgpOwogICAgICAgIGlmICgiLiIuZXF1YWxzKGNh\ndGFsb2dTZXBhcmF0b3IpKQogICAgICAgICAgICByZXR1cm4gc2VxLmdldEZ1\nbGxOYW1lKCk7CiAgICAgICAgcmV0dXJuIHNlcS5nZXRTY2hlbWFOYW1lKCkg\nKyBjYXRhbG9nU2VwYXJhdG9yICsgc2VxLmdldE5hbWUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgc3Vic2V0IG9mIHRoZSB3b3JkcyBp\nbiByZXNlcnZlZFdvcmRTZXQgdGhhdCBjYW5ub3QgYmUgdXNlZCBhcwogICAg\nICogdmFsaWQgY29sdW1uIG5hbWVzIGZvciB0aGUgY3VycmVudCBEQi4gSWYg\ndGhlIGNvbHVtbiBuYW1lIGlzIGludmFsaWQgdGhlCiAgICAgKiBnZXRWYWxp\nZENvbHVtbk5hbWUgbWV0aG9kIG9mIHRoZSBEQiBkaWN0aW9uYXJ5IHNob3Vs\nZCBiZSBpbnZva2VkIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkLgogICAgICog\nCiAgICAgKiBAc2VlIGdldFZhbGlkQ29sdW1uTmFtZQogICAgICovCiAgICBw\ndWJsaWMgZmluYWwgU2V0PFN0cmluZz4gZ2V0SW52YWxpZENvbHVtbldvcmRT\nZXQoKSB7CiAgICAgICAgcmV0dXJuIGludmFsaWRDb2x1bW5Xb3JkU2V0Owog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5n\nZXMgdG8gdGhlIGdpdmVuIHRhYmxlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZCBm\nb3IKICAgICAqIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFZhbGlkVGFibGVOYW1lKFN0cmluZyBuYW1lLCBTY2hlbWEg\nc2NoZW1hKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIp\nKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAg\nICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQobmFtZSwgc2NoZW1hLmdldFNjaGVt\nYUdyb3VwKCksCiAgICAgICAgICAgIG1heFRhYmxlTmFtZUxlbmd0aCwgTkFN\nRV9UQUJMRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNl\nc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gc2VxdWVuY2UgbmFtZSB0byBt\nYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRTZXF1ZW5jZU5hbWUoU3Ry\naW5nIG5hbWUsIFNjaGVtYSBzY2hlbWEpIHsKICAgICAgICB3aGlsZSAobmFt\nZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1\nYnN0cmluZygxKTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZCgiU18i\nICsgbmFtZSwgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAg\nIG1heFRhYmxlTmFtZUxlbmd0aCwgTkFNRV9TRVFVRU5DRSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0\naGUgZ2l2ZW4gY29sdW1uIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICog\nZm9yIHRoZSBjdXJyZW50IERCLiAgVGhlIGNvbHVtbiBuYW1lIHdpbGwgYmUg\nbWFkZSB1bmlxdWUgZm9yIHRoZQogICAgICogc3BlY2lmaWVkIHRhYmxlLgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkQ29sdW1uTmFtZShT\ndHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0\nVmFsaWRDb2x1bW5OYW1lKG5hbWUsIHRhYmxlLCB0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRo\nZSBnaXZlbiBjb2x1bW4gbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBm\nb3IgdGhlIGN1cnJlbnQgREIuICBJZiBjaGVja0ZvclVuaXF1ZW5lc3MgaXMg\ndHJ1ZSwgdGhlIGNvbHVtbiBuYW1lIHdpbGwgCiAgICAgKiBiZSBtYWRlIHVu\naXF1ZSBmb3IgdGhlIHNwZWNpZmllZCB0YWJsZS4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyBnZXRWYWxpZENvbHVtbk5hbWUoU3RyaW5nIG5hbWUsIFRh\nYmxlIHRhYmxlLAogICAgICAgIGJvb2xlYW4gY2hlY2tGb3JVbmlxdWVuZXNz\nKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAg\nICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgcmV0\ndXJuIG1ha2VOYW1lVmFsaWQobmFtZSwgdGFibGUsIG1heENvbHVtbk5hbWVM\nZW5ndGgsIE5BTUVfQU5ZLAogICAgICAgICAgICBjaGVja0ZvclVuaXF1ZW5l\nc3MpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5\nIGNoYW5nZXMgdG8gdGhlIGdpdmVuIHByaW1hcnkga2V5IG5hbWUgdG8gbWFr\nZSBpdAogICAgICogdmFsaWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkUHJpbWFyeUtleU5hbWUoU3Ry\naW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUgKG5hbWUu\nc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJz\ndHJpbmcoMSk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlBfIiAr\nIG5hbWUsIHRhYmxlLmdldFNjaGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAg\nICAgICAgICAgIG1heENvbnN0cmFpbnROYW1lTGVuZ3RoLCBOQU1FX0FOWSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hh\nbmdlcyB0byB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgbmFtZSB0byBtYWtlIGl0\nCiAgICAgKiB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRGb3JlaWduS2V5TmFtZShTdHJpbmcg\nbmFtZSwgVGFibGUgdGFibGUsCiAgICAgICAgVGFibGUgdG9UYWJsZSkgewog\nICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAg\nICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIFN0cmluZyB0\nYWJsZU5hbWUgPSB0YWJsZS5nZXROYW1lKCk7CiAgICAgICAgaW50IGxlbiA9\nIE1hdGgubWluKHRhYmxlTmFtZS5sZW5ndGgoKSwgNyk7CiAgICAgICAgbmFt\nZSA9ICJGXyIgKyBzaG9ydGVuKHRhYmxlTmFtZSwgbGVuKSArICJfIiArIG5h\nbWU7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQobmFtZSwgdGFibGUu\nZ2V0U2NoZW1hKCkuZ2V0U2NoZW1hR3JvdXAoKSwKICAgICAgICAgICAgbWF4\nQ29uc3RyYWludE5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBn\naXZlbiBpbmRleCBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0\naGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRW\nYWxpZEluZGV4TmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAg\nICAgICB3aGlsZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAg\nIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBTdHJpbmcgdGFi\nbGVOYW1lID0gdGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBsZW4gPSBN\nYXRoLm1pbih0YWJsZU5hbWUubGVuZ3RoKCksIDcpOwogICAgICAgIFN0cmlu\nZyBzaG9ydFRhYmxlTmFtZSA9IHNob3J0ZW4odGFibGVOYW1lLCBsZW4pOwog\nICAgICAgIG5hbWUgPSBjb21iaW5lTmFtZXMoIkkiLCBzaG9ydFRhYmxlTmFt\nZSwgbmFtZSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFs\naWQobmFtZSwgdGFibGUuZ2V0U2NoZW1hKCkuZ2V0U2NoZW1hR3JvdXAoKSwK\nICAgICAgICAgICAgbWF4SW5kZXhOYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdl\ncyB0byB0aGUgZ2l2ZW4gdW5pcXVlIGNvbnN0cmFpbnQgbmFtZSB0byBtYWtl\nCiAgICAgKiBpdCB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRVbmlxdWVOYW1lKFN0cmluZyBu\nYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0\nc1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5n\nKDEpOwogICAgICAgIFN0cmluZyB0YWJsZU5hbWUgPSB0YWJsZS5nZXROYW1l\nKCk7CiAgICAgICAgaW50IGxlbiA9IE1hdGgubWluKHRhYmxlTmFtZS5sZW5n\ndGgoKSwgNyk7CiAgICAgICAgbmFtZSA9IGNvbWJpbmVOYW1lcygiVSIsIHNo\nb3J0ZW4odGFibGVOYW1lLCBsZW4pLCBuYW1lKTsKICAgICAgICByZXR1cm4g\nbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS5nZXRTY2hl\nbWFHcm91cCgpLAogICAgICAgICAgICBtYXhDb25zdHJhaW50TmFtZUxlbmd0\naCwgTkFNRV9BTlkpOwogICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0RlbGltaXRlZChTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiAobmFt\nZS5zdGFydHNXaXRoKGdldERlbGltaXRlcigpKSAKICAgICAgICAgICAgICAg\nICYmIG5hbWUuZW5kc1dpdGgoZ2V0RGVsaW1pdGVyKCkpKTsKICAgIH0KICAg\nIAogICAgcHVibGljIFN0cmluZyBzdHJpcERlbGltaXRlcnMoU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBTdHJpbmcgZGVsaW1pdGVyID0gZ2V0RGVsaW1pdGVy\nKCk7CiAgICAgICAgaW50IGRlbGltTGVuID0gZGVsaW1pdGVyLmxlbmd0aCgp\nOwogICAgICAgIGlmIChpc0RlbGltaXRlZChuYW1lKSkgewogICAgICAgICAg\nICByZXR1cm4gbmFtZS5zdWJzdHJpbmcoZGVsaW1MZW4sIG5hbWUubGVuZ3Ro\nKCkgLSBkZWxpbUxlbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuYW1l\nOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIGFkZERlbGltaXRlcnMo\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBTdHJpbmcgZGVsaW1pdGVyID0gZ2V0\nRGVsaW1pdGVyKCk7CiAgICAgICAgcmV0dXJuIGRlbGltaXRlciArIG5hbWUg\nKyBkZWxpbWl0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG9ydGVuIHRo\nZSBzcGVjaWZpZWQgbmFtZSB0byB0aGUgc3BlY2lmaWVkIHRhcmdldCBuYW1l\nLiBUaGlzIHdpbGwKICAgICAqIGJlIGRvbmUgYnkgZmlyc3Qgc3RyaXBwaW5n\nIG91dCB0aGUgdm93ZWxzLCBhbmQgdGhlbiByZW1vdmluZwogICAgICogY2hh\ncmFjdGVycyBmcm9tIHRoZSBtaWRkbGUgb2YgdGhlIHdvcmQgdW50aWwgaXQg\ncmVhY2hlcyB0aGUgdGFyZ2V0CiAgICAgKiBsZW5ndGguCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBzdGF0aWMgU3RyaW5nIHNob3J0ZW4oU3RyaW5nIG5hbWUs\nIGludCB0YXJnZXRMZW5ndGgpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxs\nIHx8IG5hbWUubGVuZ3RoKCkgPD0gdGFyZ2V0TGVuZ3RoKQogICAgICAgICAg\nICByZXR1cm4gbmFtZTsKCiAgICAgICAgU3RyaW5nQnVmZmVyIG5tID0gbmV3\nIFN0cmluZ0J1ZmZlcihuYW1lKTsKICAgICAgICB3aGlsZSAobm0ubGVuZ3Ro\nKCkgPiB0YXJnZXRMZW5ndGgpIHsKICAgICAgICAgICAgaWYgKCFzdHJpcFZv\nd2VsKG5tKSkgewogICAgICAgICAgICAgICAgLy8gY3V0IG91dCB0aGUgbWlk\nZGxlIGNoYXIKICAgICAgICAgICAgICAgIG5tLnJlcGxhY2Uobm0ubGVuZ3Ro\nKCkgLyAyLCAobm0ubGVuZ3RoKCkgLyAyKSArIDEsICIiKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbm0udG9TdHJpbmcoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB2b3dlbHMgZnJvbSB0aGUg\nc3BlY2lmaWVkIFN0cmluZ0J1ZmZlci4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgYW55IHZvd2VscyBoYXZlIGJlZW4gcmVtb3ZlZAogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIHN0cmlwVm93ZWwoU3RyaW5n\nQnVmZmVyIG5hbWUpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsIHx8IG5h\nbWUubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICBjaGFyW10gdm93ZWxzID0geyAnQScsICdFJywgJ0knLCAnTycs\nICdVJywgfTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHZvd2Vscy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpbnQgaW5kZXggPSBuYW1lLnRv\nU3RyaW5nKCkudG9VcHBlckNhc2UoKS5pbmRleE9mKHZvd2Vsc1tpXSk7CiAg\nICAgICAgICAgIGlmIChpbmRleCAhPSAtMSkgewogICAgICAgICAgICAgICAg\nbmFtZS5yZXBsYWNlKGluZGV4LCBpbmRleCArIDEsICIiKTsKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNo\nb3J0ZW5zIHRoZSBnaXZlbiBuYW1lIHRvIHRoZSBnaXZlbiBtYXhpbXVtIGxl\nbmd0aCwgdGhlbiBjaGVja3MgdGhhdAogICAgICogaXQgaXMgbm90IGEgcmVz\nZXJ2ZWQgd29yZC4gSWYgaXQgaXMgcmVzZXJ2ZWQsIGFwcGVuZHMgYSAiMCIu\nIElmCiAgICAgKiB0aGUgbmFtZSBjb25mbGljdHMgd2l0aCBhbiBleGlzdGlu\nZyBzY2hlbWEgY29tcG9uZW50LCB0aGUgbGFzdAogICAgICogY2hhcmFjdGVy\nIGlzIHJlcGxhY2Ugd2l0aCAnMCcsIHRoZW4gJzEnLCBldGMuCiAgICAgKiBO\nb3RlIHRoYXQgdGhlIGdpdmVuIG1heCBsZW4gbWF5IGJlIDAgaWYgdGhlIGRh\ndGFiYXNlIG1ldGFkYXRhIGlzCiAgICAgKiBpbmNvbXBsZXRlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG1ha2VOYW1lVmFsaWQoU3RyaW5nIG5h\nbWUsIE5hbWVTZXQgc2V0LCBpbnQgbWF4TGVuLAogICAgICAgIGludCBuYW1l\nVHlwZSkgewogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHNl\ndCwgbWF4TGVuLCBuYW1lVHlwZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4gbWF4\naW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0IGlzIG5v\ndCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBhcHBlbmRz\nIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdpdGggYW4g\nZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCBhbmQgdW5pcXVlbmVzcwogICAg\nICogY2hlY2tpbmcgaXMgZW5hYmxlZCwgdGhlIGxhc3QgY2hhcmFjdGVyIGlz\nIHJlcGxhY2Ugd2l0aCAnMCcsIHRoZW4gCiAgICAgKiAnMScsIGV0Yy4gCiAg\nICAgKiBOb3RlIHRoYXQgdGhlIGdpdmVuIG1heCBsZW4gbWF5IGJlIDAgaWYg\ndGhlIGRhdGFiYXNlIG1ldGFkYXRhIGlzIAogICAgICogaW5jb21wbGV0ZS4K\nICAgICAqIAogICAgICogTm90ZTogSWYgdGhlIG5hbWUgaXMgZGVsaW1pdGVk\nLCBtYWtlIHN1cmUgdGhlIGVuZGluZyBkZWxpbWl0ZXIgaXMKICAgICAqIG5v\ndCBzdHJpcHBlZCBvZmYuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcg\nbWFrZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQsIGludCBt\nYXhMZW4sCiAgICAgICAgaW50IG5hbWVUeXBlLCBib29sZWFuIGNoZWNrRm9y\nVW5pcXVlbmVzcykgewogICAgICAgIGJvb2xlYW4gZGVsaW1pdGVkID0gZmFs\nc2U7CiAgICAgICAgU3RyaW5nIGRlbGltaXRlciA9IGdldERlbGltaXRlcigp\nOwogICAgICAgIGlmIChuYW1lLnN0YXJ0c1dpdGgoZGVsaW1pdGVyKSAmJiBu\nYW1lLmVuZHNXaXRoKGRlbGltaXRlcikpIHsKICAgICAgICAgICAgZGVsaW1p\ndGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG1heExlbiA8IDEp\nCiAgICAgICAgICAgIG1heExlbiA9IDI1NTsKICAgICAgICBpZiAobmFtZS5s\nZW5ndGgoKSA+IG1heExlbikKICAgICAgICAgICAgbmFtZSA9IHJlbW92ZUVu\nZGluZ0NoYXJzKG5hbWUsIG5hbWUubGVuZ3RoKCkgLSBtYXhMZW4sIAogICAg\nICAgICAgICAgICAgZGVsaW1pdGVkLCBkZWxpbWl0ZXIpOwogICAgICAgIGlm\nIChyZXNlcnZlZFdvcmRTZXQuY29udGFpbnMobmFtZS50b1VwcGVyQ2FzZSgp\nKSkgewogICAgICAgICAgICBpZiAobmFtZS5sZW5ndGgoKSA9PSBtYXhMZW4p\nCiAgICAgICAgICAgICAgICBuYW1lID0gcmVtb3ZlRW5kaW5nQ2hhcnMobmFt\nZSwgMSwgZGVsaW1pdGVkLCBkZWxpbWl0ZXIpOwogICAgICAgICAgICBuYW1l\nID0gYWRkQ2hhcnNUb0VuZChuYW1lLCAiMCIsIGRlbGltaXRlZCwgZGVsaW1p\ndGVyKTsKICAgICAgICB9CgogICAgICAgIC8vIG5vdyBtYWtlIHN1cmUgdGhl\nIG5hbWUgaXMgdW5pcXVlCiAgICAgICAgaWYgKHNldCAhPSBudWxsICYmIGNo\nZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAgICAgICBvdXRlcjoKICAgICAg\nICAgICAgZm9yIChpbnQgdmVyc2lvbiA9IDEsIGNoYXJzID0gMTsgdHJ1ZTsg\ndmVyc2lvbisrKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgdGFibGUgbmFt\nZXMsIHdlIGNoZWNrIGZvciB0aGUgdGFibGUgaXRzZWxmIGluIGNhc2UgdGhl\nCiAgICAgICAgICAgICAgICAvLyBuYW1lIHNldCBpcyBsYXp5IGFib3V0IHNj\naGVtYSByZWZsZWN0aW9uCiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hbWVU\neXBlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBOQU1FX1RBQkxFOgog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgoU2NoZW1hR3JvdXApIHNl\ndCkuaXNLbm93blRhYmxlKG5hbWUpKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgTkFNRV9TRVFVRU5DRToK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoKFNjaGVtYUdyb3VwKSBz\nZXQpLmlzS25vd25TZXF1ZW5jZShuYW1lKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrIG91dGVyOwogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoIXNldC5pc05hbWVUYWtlbihuYW1lKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGEgc2luZ2xlIGNo\nYXIgZm9yIHRoZSB2ZXJzaW9uIGlzIHByb2JhYmx5IGVub3VnaCwgYnV0IG1p\nZ2h0CiAgICAgICAgICAgICAgICAvLyBhcyB3ZWxsIGJlIGdlbmVyYWwgYWJv\ndXQgaXQuLi4KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uID4gMSkKICAg\nICAgICAgICAgICAgICAgICBuYW1lID0gcmVtb3ZlRW5kaW5nQ2hhcnMobmFt\nZSwgY2hhcnMsIGRlbGltaXRlZCwgZGVsaW1pdGVyKTsKICAgICAgICAgICAg\nICAgIGlmICh2ZXJzaW9uID49IE1hdGgucG93KDEwLCBjaGFycykpCiAgICAg\nICAgICAgICAgICAgICAgY2hhcnMrKzsKICAgICAgICAgICAgICAgIGlmIChu\nYW1lLmxlbmd0aCgpICsgY2hhcnMgPiBtYXhMZW4pCiAgICAgICAgICAgICAg\nICAgICAgbmFtZSA9IHJlbW92ZUVuZGluZ0NoYXJzKG5hbWUsIAogICAgICAg\nICAgICAgICAgICAgICAgICBuYW1lLmxlbmd0aCgpICsgY2hhcnMgLSBtYXhM\nZW4sIAogICAgICAgICAgICAgICAgICAgICAgICBkZWxpbWl0ZWQsIGRlbGlt\naXRlcik7CiAgICAgICAgICAgICAgICBuYW1lID0gYWRkQ2hhcnNUb0VuZChu\nYW1lLCBuZXcgSW50ZWdlcih2ZXJzaW9uKS50b1N0cmluZygpLCAKICAgICAg\nICAgICAgICAgICAgICBkZWxpbWl0ZWQsIGRlbGltaXRlcik7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGRlbGltaXRl\nZCkgewogICAgICAgICAgICBTdHJpbmcgZGVsaW1DYXNlID0gZ2V0RGVsaW1p\ndGVkQ2FzZSgpOwogICAgICAgICAgICBpZiAoZGVsaW1DYXNlLmVxdWFscyhT\nQ0hFTUFfQ0FTRV9MT1dFUikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBu\nYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZWxzZSBpZiAoZGVsaW1DYXNlLmVxdWFscyhTQ0hFTUFfQ0FTRV9VUFBFUikp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBuYW1lLnRvVXBwZXJDYXNlKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gbmFtZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICAvLyBUT0RPOiBUaGlzIGlzIHRoZSBvcmlnaW5hbC4gU2hvdWxkIHRo\nZSBkYiBzdXBwb3J0ZWQgY2FzZSBiZSBjaGVja2VkPwogICAgICAgIHJldHVy\nbiBuYW1lLnRvVXBwZXJDYXNlKCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\nU3RyaW5nIHJlbW92ZUVuZGluZ0NoYXJzKFN0cmluZyBuYW1lLCAKICAgICAg\nICBpbnQgY2hhcnNUb1JlbW92ZSwKICAgICAgICBib29sZWFuIGRlbGltaXRl\nZCwgCiAgICAgICAgU3RyaW5nIGRlbGltaXRlcikgewogICAgICAgIGlmIChk\nZWxpbWl0ZWQpIHsKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5n\nKDAsIG5hbWUubGVuZ3RoKCkgLSBkZWxpbWl0ZXIubGVuZ3RoKCkpOwogICAg\nICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGgo\nKSAtIGNoYXJzVG9SZW1vdmUpOwogICAgICAgICAgICBuYW1lID0gbmFtZSAr\nIGRlbGltaXRlcjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCgpIC0g\nY2hhcnNUb1JlbW92ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJl\ndHVybiBuYW1lOwogICAgfQogICAgCiAgICBwcml2YXRlIFN0cmluZyBhZGRD\naGFyc1RvRW5kKFN0cmluZyBuYW1lLAogICAgICAgIFN0cmluZyBjaGFyc1Rv\nQWRkLAogICAgICAgIGJvb2xlYW4gZGVsaW1pdGVkLAogICAgICAgIFN0cmlu\nZyBkZWxpbWl0ZXIpIHsKICAgICAgICBpZiAoZGVsaW1pdGVkKSB7CiAgICAg\nICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCgp\nIC0gZGVsaW1pdGVyLmxlbmd0aCgpKTsKICAgICAgICAgICAgbmFtZSA9IG5h\nbWUgKyBjaGFyc1RvQWRkOwogICAgICAgICAgICBuYW1lID0gbmFtZSArIGRl\nbGltaXRlcjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIG5hbWUgPSBuYW1lICsgY2hhcnNUb0FkZDsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gY3JlYXRlIHRo\nZSBnaXZlbiB0YWJsZSwgY29tcGxldGUKICAgICAqIHdpdGggY29sdW1ucy4g\nSW5kZXhlcyBhbmQgY29uc3RyYWludHMgd2lsbCBiZSBjcmVhdGVkIHNlcGFy\nYXRlbHkuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVU\nYWJsZVNRTChUYWJsZSB0YWJsZSkgewogICAgICAgIFN0cmluZ0J1ZmZlciBi\ndWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgU3RyaW5nIHRhYmxl\nTmFtZSA9IGNoZWNrTmFtZUxlbmd0aChnZXRGdWxsTmFtZSh0YWJsZSwgZmFs\nc2UpLCAKICAgICAgICAgICAgICAgIG1heFRhYmxlTmFtZUxlbmd0aCwgImxv\nbmctdGFibGUtbmFtZSIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSBU\nQUJMRSAiKS5hcHBlbmQodGFibGVOYW1lKTsKICAgICAgICBpZiAoc3VwcG9y\ndHNDb21tZW50cyAmJiB0YWJsZS5oYXNDb21tZW50KCkpIHsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAgICAgICBjb21tZW50KGJ1Ziwg\ndGFibGUuZ2V0Q29tbWVudCgpKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nXG4gICAgKCIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiAoIik7CiAgICAgICAgfQoKICAgICAgICAvLyBkbyB0aGlzIGJl\nZm9yZSBnZXR0aW5nIHRoZSBjb2x1bW5zIHNvIHdlIGtub3cgaG93IHRvIGhh\nbmRsZQogICAgICAgIC8vIHRoZSBsYXN0IGNvbW1hCiAgICAgICAgU3RyaW5n\nQnVmZmVyIGVuZEJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBQ\ncmltYXJ5S2V5IHBrID0gdGFibGUuZ2V0UHJpbWFyeUtleSgpOwogICAgICAg\nIFN0cmluZyBwa1N0cjsKICAgICAgICBpZiAocGsgIT0gbnVsbCkgewogICAg\nICAgICAgICBwa1N0ciA9IGdldFByaW1hcnlLZXlDb25zdHJhaW50U1FMKHBr\nKTsKICAgICAgICAgICAgaWYgKHBrU3RyICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBlbmRCdWYuYXBwZW5kKHBrU3RyKTsKICAgICAgICB9CgogICAgICAg\nIFVuaXF1ZVtdIHVucXMgPSB0YWJsZS5nZXRVbmlxdWVzKCk7CiAgICAgICAg\nU3RyaW5nIHVucVN0cjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHVu\ncXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdW5xU3RyID0gZ2V0VW5p\ncXVlQ29uc3RyYWludFNRTCh1bnFzW2ldKTsKICAgICAgICAgICAgaWYgKHVu\ncVN0ciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZW5kQnVmLmxl\nbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgICAgICBlbmRCdWYuYXBwZW5k\nKCIsICIpOwogICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVuZCh1bnFTdHIp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBj\nb2xzID0gdGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBidWYu\nYXBwZW5kKGdldERlY2xhcmVDb2x1bW5TUUwoY29sc1tpXSwgZmFsc2UpKTsK\nICAgICAgICAgICAgaWYgKGkgPCBjb2xzLmxlbmd0aCAtIDEgfHwgZW5kQnVm\nLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwg\nIik7CiAgICAgICAgICAgIGlmIChzdXBwb3J0c0NvbW1lbnRzICYmIGNvbHNb\naV0uaGFzQ29tbWVudCgpKSB7CiAgICAgICAgICAgICAgICBjb21tZW50KGJ1\nZiwgY29sc1tpXS5nZXRDb21tZW50KCkpOwogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiXG4gICAgIik7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGJ1Zi5hcHBlbmQoZW5kQnVmLnRvU3RyaW5nKCkpOwogICAgICAg\nIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1td\neyBidWYudG9TdHJpbmcoKSB9OwogICAgfQogICAgCiAgICBwdWJsaWMgaW50\nIGdldEJhdGNoRmV0Y2hTaXplKGludCBiYXRjaEZldGNoU2l6ZSkgewogICAg\nICAgIHJldHVybiBiYXRjaEZldGNoU2l6ZTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgU3RyaW5nQnVmZmVyIGNvbW1lbnQoU3RyaW5nQnVmZmVyIGJ1ZiwgU3Ry\naW5nIGNvbW1lbnQpIHsKICAgICAgICByZXR1cm4gYnVmLmFwcGVuZCgiLS0g\nIikuYXBwZW5kKGNvbW1lbnQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdp\ndmVuIHRhYmxlLiBJbmRleGVzCiAgICAgKiB3aWxsIGJlIGRyb3BwZWQgc2Vw\nYXJhdGVseS4gUmV0dXJucwogICAgICogPGNvZGU+RFJPUCBUQUJMRSAmbHQ7\ndGFibGUgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wVGFibGVTUUwoVGFibGUgdGFibGUp\nIHsKICAgICAgICBTdHJpbmcgZHJvcCA9IE1lc3NhZ2VGb3JtYXQuZm9ybWF0\nKGRyb3BUYWJsZVNRTCwgbmV3IE9iamVjdFtdewogICAgICAgICAgICBnZXRG\ndWxsTmFtZSh0YWJsZSwgZmFsc2UpIH0pOwogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nW117IGRyb3AgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBjcmVhdGUgdGhlIGdp\ndmVuIHNlcXVlbmNlLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5DUkVBVEUgU0VR\nVUVOQ0UgJmx0O3NlcXVlbmNlIG5hbWUmZ3Q7WyBTVEFSVCBXSVRIICZsdDtz\ndGFydCZndDtdCiAgICAgKiBbIElOQ1JFTUVOVCBCWSAmbHQ7aW5jcmVtZW50\nJmd0O108L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXRDcmVhdGVTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsK\nICAgICAgICBpZiAobmV4dFNlcXVlbmNlUXVlcnkgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYg\nPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiQ1JF\nQVRFIFNFUVVFTkNFICIpOwogICAgICAgIFN0cmluZyBzZXFOYW1lID0gY2hl\nY2tOYW1lTGVuZ3RoKGdldEZ1bGxOYW1lKHNlcSksIG1heFRhYmxlTmFtZUxl\nbmd0aCwgCiAgICAgICAgICAgICAgICAibG9uZy1zZXEtbmFtZSIpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoc2VxTmFtZSk7CiAgICAgICAgaWYgKHNlcS5nZXRJ\nbml0aWFsVmFsdWUoKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nU1RBUlQgV0lUSCAiKS5hcHBlbmQoc2VxLmdldEluaXRpYWxWYWx1ZSgpKTsK\nICAgICAgICBpZiAoc2VxLmdldEluY3JlbWVudCgpID4gMSkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIElOQ1JFTUVOVCBCWSAiKS5hcHBlbmQoc2VxLmdl\ndEluY3JlbWVudCgpKTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBi\ndWYudG9TdHJpbmcoKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVu\nIHNlcXVlbmNlLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5EUk9QIFNFUVVFTkNF\nICZsdDtzZXF1ZW5jZSBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BTZXF1ZW5jZVNRTChT\nZXF1ZW5jZSBzZXEpIHsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAi\nRFJPUCBTRVFVRU5DRSAiICsgZ2V0RnVsbE5hbWUoc2VxKSB9OwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1l\nbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMKICAgICAq\nIDxjb2RlPkNSRUFURSBbVU5JUVVFXSBJTkRFWCAmbHQ7aW5kZXggbmFtZSZn\ndDsgT04gJmx0O3RhYmxlIG5hbWUmZ3Q7CiAgICAgKiAoJmx0O2NvbCBsaXN0\nJmd0Oyk8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXRDcmVhdGVJbmRleFNRTChJbmRleCBpbmRleCkgewogICAg\nICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFICIpOwogICAgICAgIGlmIChpbmRl\neC5pc1VuaXF1ZSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJVTklRVUUg\nIik7CiAgICAgICAgU3RyaW5nIGluZGV4TmFtZSA9IGNoZWNrTmFtZUxlbmd0\naChpbmRleC5nZXROYW1lKCksIG1heEluZGV4TmFtZUxlbmd0aCwgCiAgICAg\nICAgICAgICAgICAibG9uZy1pbmRleC1uYW1lIik7CiAgICAgICAgYnVmLmFw\ncGVuZCgiSU5ERVggIikuYXBwZW5kKGluZGV4TmFtZSk7CiAgICAgICAgYnVm\nLmFwcGVuZCgiIE9OICIpLmFwcGVuZChnZXRGdWxsTmFtZShpbmRleC5nZXRU\nYWJsZSgpLCBmYWxzZSkpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAoIikuYXBw\nZW5kKFN0cmluZ3Muam9pbihpbmRleC5nZXRDb2x1bW5zKCksICIsICIpKS4K\nICAgICAgICAgICAgYXBwZW5kKCIpIik7CgogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nW117IGJ1Zi50b1N0cmluZygpIH07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJv\ncCB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMKICAgICAqIDxjb2RlPkRST1Ag\nSU5ERVggJmx0O2luZGV4IG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcEluZGV4U1FMKElu\nZGV4IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkRS\nT1AgSU5ERVggIiArIGdldEZ1bGxOYW1lKGluZGV4KSB9OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRz\nIHRvIGFkZCB0aGUgZ2l2ZW4gY29sdW1uIHRvCiAgICAgKiBpdHMgdGFibGUu\nIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBv\ncnRlZC4gUmV0dXJucwogICAgICogPGNvZGU+QUxURVIgVEFCTEUgJmx0O3Rh\nYmxlIG5hbWUmZ3Q7IEFERCAoJmx0O2NvbCBkZWMmZ3Q7KTwvY29kZT4KICAg\nICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBn\nZXRBZGRDb2x1bW5TUUwoQ29sdW1uIGNvbHVtbikgewogICAgICAgIGlmICgh\nc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbikKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBTdHJpbmdbMF07CgogICAgICAgIFN0cmluZyBkZWMgPSBn\nZXREZWNsYXJlQ29sdW1uU1FMKGNvbHVtbiwgdHJ1ZSk7CiAgICAgICAgaWYg\nKGRlYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1sw\nXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUg\nIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKGNvbHVtbi5nZXRUYWJsZSgp\nLCBmYWxzZSkgKyAiIEFERCAiICsgZGVjIH07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJv\ncCB0aGUgZ2l2ZW4gY29sdW1uIGZyb20KICAgICAqIGl0cyB0YWJsZS4gUmV0\ndXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVk\nLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUg\nbmFtZSZndDsgRFJPUCBDT0xVTU4gJmx0O2NvbCBuYW1lJmd0OzwvY29kZT4K\nICAgICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXREcm9wQ29sdW1uU1FMKENvbHVtbiBjb2x1bW4pIHsKICAgICAgICBp\nZiAoIXN1cHBvcnRzQWx0ZXJUYWJsZVdpdGhEcm9wQ29sdW1uKQogICAgICAg\nICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3\nIFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1\nbGxOYW1lKGNvbHVtbi5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAg\nKyAiIERST1AgQ09MVU1OICIgKyBjb2x1bW4gfTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBh\nZGQgdGhlIGdpdmVuIHByaW1hcnkga2V5IHRvCiAgICAgKiBpdHMgdGFibGUu\nIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBv\ncnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3Rh\nYmxlIG5hbWUmZ3Q7IEFERAogICAgICogJmx0O3BrIGNvbnMgc3FsICZndDs8\nL2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXRBZGRQcmltYXJ5S2V5U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAg\nICBTdHJpbmcgcGtzcWwgPSBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChw\nayk7CiAgICAgICAgaWYgKHBrc3FsID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUo\ncGsuZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiArIHBrc3FsIH07CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0\nYXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgZnJvbQog\nICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3Bl\ncmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFM\nVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENPTlNUUkFJTlQK\nICAgICAqICZsdDtwayBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BQcmltYXJ5S2V5U1FM\nKFByaW1hcnlLZXkgcGspIHsKICAgICAgICBpZiAocGsuZ2V0TmFtZSgpID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAg\nICAgICAgICsgZ2V0RnVsbE5hbWUocGsuZ2V0VGFibGUoKSwgZmFsc2UpCiAg\nICAgICAgICAgICsgIiBEUk9QIENPTlNUUkFJTlQgIiArIHBrLmdldE5hbWUo\nKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9m\nIFNRTCBzdGF0ZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkg\ndG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlm\nIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0dXJucyA8Y29k\nZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQURECiAgICAgKiAm\nbHQ7ZmsgY29ucyBzcWwgJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZEZvcmVpZ25LZXlTUUwoRm9y\nZWlnbktleSBmaykgewogICAgICAgIFN0cmluZyBma1NRTCA9IGdldEZvcmVp\nZ25LZXlDb25zdHJhaW50U1FMKGZrKTsKICAgICAgICBpZiAoZmtTUUwgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAg\nICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAg\nICAgICAgKyBnZXRGdWxsTmFtZShmay5nZXRUYWJsZSgpLCBmYWxzZSkgKyAi\nIEFERCAiICsgZmtTUUwgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZl\nbiBmb3JlaWduIGtleSBmcm9tCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBh\nbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4KICAg\nICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUm\nZ3Q7IERST1AgQ09OU1RSQUlOVAogICAgICogJmx0O2ZrIG5hbWUmZ3Q7PC9j\nb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10g\nZ2V0RHJvcEZvcmVpZ25LZXlTUUwoRm9yZWlnbktleSBmaywgQ29ubmVjdGlv\nbiBjb25uKSB7CiAgICAgICAgaWYgKGZrLmdldE5hbWUoKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIFN0cmluZ1tdIHJldFZhbDsKICAgICAgICAgICAgU3Ry\naW5nIGZrTmFtZSA9IGZrLmxvYWROYW1lRnJvbURCKHRoaXMsY29ubik7CiAg\nICAgICAgICAgIHJldFZhbCA9IChma05hbWUgPT0gbnVsbCkgPyAgbmV3IFN0\ncmluZ1swXSA6CiAgICAgICAgICAgICAgICBuZXcgU3RyaW5nW117ICJBTFRF\nUiBUQUJMRSAiCiAgICAgICAgICAgICAgICArIGdldEZ1bGxOYW1lKGZrLmdl\ndFRhYmxlKCksIGZhbHNlKQogICAgICAgICAgICAgICAgKyAiIERST1AgQ09O\nU1RSQUlOVCAiICsgZmtOYW1lIH07CiAgICAgICAgICAgIHJldHVybiByZXRW\nYWw7ICAgCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117\nICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoZmsu\nZ2V0VGFibGUoKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENPTlNU\nUkFJTlQgIiArIGZrLmdldE5hbWUoKSB9OwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZlbiBj\nb2x1bW4uIFRoaXMgbWV0aG9kIGlzIHVzZWQKICAgICAqIGZvciBlYWNoIGNv\nbHVtbiBmcm9tIHdpdGhpbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBh\nbmQKICAgICAqIHtAbGluayAjZ2V0QWRkQ29sdW1uU1FMfS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFN0cmluZyBnZXREZWNsYXJlQ29sdW1uU1FMKENvbHVt\nbiBjb2wsIGJvb2xlYW4gYWx0ZXIpIHsKICAgICAgICBTdHJpbmdCdWZmZXIg\nYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIFN0cmluZyBjb2x1\nbW5OYW1lID0gY2hlY2tOYW1lTGVuZ3RoKGNvbC5nZXROYW1lKCksIG1heENv\nbHVtbk5hbWVMZW5ndGgsIAogICAgICAgICAgICAgICAgImxvbmctY29sdW1u\nLW5hbWUiKTsKICAgICAgICBidWYuYXBwZW5kKGNvbHVtbk5hbWUpLmFwcGVu\nZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0VHlwZU5hbWUoY29sKSk7\nCgogICAgICAgIC8vIGNhbid0IGFkZCBjb25zdHJhaW50cyB0byBhIGNvbHVt\nbiB3ZSdyZSBhZGRpbmcgYWZ0ZXIgdGFibGUKICAgICAgICAvLyBjcmVhdGlv\nbiwgY2F1c2Ugc29tZSBkYXRhIG1pZ2h0IGFscmVhZHkgYmUgaW5zZXJ0ZWQK\nICAgICAgICBpZiAoIWFsdGVyKSB7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0\nRGVmYXVsdFN0cmluZygpICE9IG51bGwgJiYgIWNvbC5pc0F1dG9Bc3NpZ25l\nZCgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIERFRkFVTFQgIiku\nYXBwZW5kKGNvbC5nZXREZWZhdWx0U3RyaW5nKCkpOwogICAgICAgICAgICBp\nZiAoY29sLmlzTm90TnVsbCgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIE5PVCBOVUxMIik7CiAgICAgICAgfQogICAgICAgIGlmIChjb2wuaXNB\ndXRvQXNzaWduZWQoKSkgewogICAgICAgICAgICBpZiAoIXN1cHBvcnRzQXV0\nb0Fzc2lnbikKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJp\nbnZhbGlkLWF1dG9hc3NpZ24iLCBwbGF0Zm9ybSwgY29sKSk7CiAgICAgICAg\nICAgIGVsc2UgaWYgKGF1dG9Bc3NpZ25DbGF1c2UgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQoYXV0b0Fzc2lnbkNs\nYXVzZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmco\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVjbGFyYXRp\nb24gU1FMIGZvciB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkuIFRoaXMgbWV0aG9k\nIGlzCiAgICAgKiB1c2VkIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRl\nVGFibGVTUUx9IGFuZAogICAgICoge0BsaW5rICNnZXRBZGRQcmltYXJ5S2V5\nU1FMfS4gUmV0dXJucwogICAgICogPGNvZGU+Q09OU1RSQUlOVCAmbHQ7cGsg\nbmFtZSZndDsgUFJJTUFSWSBLRVkgKCZsdDtjb2wgbGlzdCZndDspPC9jb2Rl\nPgogICAgICogYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChQcmltYXJ5S2V5IHBr\nKSB7CiAgICAgICAgLy8gaWYgd2UgaGF2ZSBkaXNhYmxlZCB0aGUgY3JlYXRp\nb24gb2YgcHJpbWFyeSBrZXlzLCBhYm9ydCBoZXJlCiAgICAgICAgaWYgKCFj\ncmVhdGVQcmltYXJ5S2V5cykKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIFN0cmluZyBuYW1lID0gcGsuZ2V0TmFtZSgpOwogICAgICAgIGlm\nIChuYW1lICE9IG51bGwgJiYgcmVzZXJ2ZWRXb3JkU2V0LmNvbnRhaW5zKG5h\nbWUudG9VcHBlckNhc2UoKSkpCiAgICAgICAgICAgIG5hbWUgPSBudWxsOwoK\nICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigp\nOwogICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgQ09OU19OQU1FX0JFRk9S\nRS5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5hcHBlbmQobmFtZSkuYXBwZW5kKCIg\nIik7CiAgICAgICAgYnVmLmFwcGVuZCgiUFJJTUFSWSBLRVkgIik7CiAgICAg\nICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVfTUlELmVxdWFscyhj\nb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKG5h\nbWUpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIigiKS5hcHBl\nbmQoU3RyaW5ncy5qb2luKHBrLmdldENvbHVtbnMoKSwgIiwgIikpLgogICAg\nICAgICAgICBhcHBlbmQoIikiKTsKICAgICAgICBpZiAobmFtZSAhPSBudWxs\nICYmIENPTlNfTkFNRV9BRlRFUi5lcXVhbHMoY29uc3RyYWludE5hbWVNb2Rl\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIENPTlNUUkFJTlQgIikuYXBw\nZW5kKG5hbWUpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVjbGFyYXRpb24gU1FM\nIGZvciB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXksIG9yIG51bGwgaWYgaXQgaXMK\nICAgICAqIG5vdCBzdXBwb3J0ZWQuIFRoaXMgbWV0aG9kIGlzIHVzZWQgZnJv\nbSB3aXRoaW4KICAgICAqIHtAbGluayAjZ2V0Q3JlYXRlVGFibGVTUUx9IGFu\nZCB7QGxpbmsgI2dldEFkZEZvcmVpZ25LZXlTUUx9LiBSZXR1cm5zCiAgICAg\nKiA8Y29kZT5DT05TVFJBSU5UICZsdDtjb25zIG5hbWUmZ3Q7IEZPUkVJR04g\nS0VZICgmbHQ7Y29sIGxpc3QmZ3Q7KQogICAgICogUkVGRVJFTkNFUyAmbHQ7\nZm9yZWlnbiB0YWJsZSZndDsgKCZsdDtjb2wgbGlzdCZndDspCiAgICAgKiBb\nT04gREVMRVRFICZsdDthY3Rpb24mZ3Q7XSBbT04gVVBEQVRFICZsdDthY3Rp\nb24mZ3Q7XTwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFN0cmluZyBnZXRGb3JlaWduS2V5Q29uc3RyYWludFNRTChGb3JlaWdu\nS2V5IGZrKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoZmsuZ2V0Q29s\ndW1ucygpLmxlbmd0aCA+IDAgJiYgIXN1cHBvcnRzRm9yZWlnbktleXNDb21w\nb3NpdGUpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChm\nay5nZXREZWxldGVBY3Rpb24oKSA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05F\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoZmsuaXNE\nZWZlcnJlZCgpICYmICFzdXBwb3J0c0RlZmVycmVkRm9yZWlnbktleUNvbnN0\ncmFpbnRzKCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nICghc3VwcG9ydHNEZWxldGVBY3Rpb24oZmsuZ2V0RGVsZXRlQWN0aW9uKCkp\nCiAgICAgICAgICAgIHx8ICFzdXBwb3J0c1VwZGF0ZUFjdGlvbihmay5nZXRV\ncGRhdGVBY3Rpb24oKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBDb2x1bW5bXSBsb2NhbHMgPSBmay5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgQ29sdW1uW10gZm9yZWlnbnMgPSBmay5nZXRQcmltYXJ5S2V5Q29sdW1u\ncygpOwoKICAgICAgICBpbnQgZGVsQWN0aW9uSWQgPSBmay5nZXREZWxldGVB\nY3Rpb24oKTsKICAgICAgICBpZiAoZGVsQWN0aW9uSWQgPT0gRm9yZWlnbktl\neS5BQ1RJT05fTlVMTCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGxvY2Fscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKGxvY2Fsc1tpXS5pc05vdE51bGwoKSkKICAgICAgICAgICAgICAgICAgICBk\nZWxBY3Rpb25JZCA9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIFN0cmluZyBkZWxBY3Rpb24gPSBn\nZXRBY3Rpb25OYW1lKGRlbEFjdGlvbklkKTsKICAgICAgICBTdHJpbmcgdXBB\nY3Rpb24gPSBnZXRBY3Rpb25OYW1lKGZrLmdldFVwZGF0ZUFjdGlvbigpKTsK\nCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIo\nKTsKICAgICAgICBpZiAoZmsuZ2V0TmFtZSgpICE9IG51bGwKICAgICAgICAg\nICAgJiYgQ09OU19OQU1FX0JFRk9SRS5lcXVhbHMoY29uc3RyYWludE5hbWVN\nb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5h\ncHBlbmQoZmsuZ2V0TmFtZSgpKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYu\nYXBwZW5kKCJGT1JFSUdOIEtFWSAiKTsKICAgICAgICBpZiAoZmsuZ2V0TmFt\nZSgpICE9IG51bGwgJiYgQ09OU19OQU1FX01JRC5lcXVhbHMoY29uc3RyYWlu\ndE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZChmay5nZXROYW1l\nKCkpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIigiKS5hcHBl\nbmQoU3RyaW5ncy5qb2luKGxvY2FscywgIiwgIikpLmFwcGVuZCgiKSIpOwog\nICAgICAgIGJ1Zi5hcHBlbmQoIiBSRUZFUkVOQ0VTICIpOwogICAgICAgIGJ1\nZi5hcHBlbmQoZ2V0RnVsbE5hbWUoZm9yZWlnbnNbMF0uZ2V0VGFibGUoKSwg\nZmFsc2UpKTsKICAgICAgICBidWYuYXBwZW5kKCIgKCIpLmFwcGVuZChTdHJp\nbmdzLmpvaW4oZm9yZWlnbnMsICIsICIpKS5hcHBlbmQoIikiKTsKICAgICAg\nICBpZiAoZGVsQWN0aW9uICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBPTiBERUxFVEUgIikuYXBwZW5kKGRlbEFjdGlvbik7CiAgICAgICAg\naWYgKHVwQWN0aW9uICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBPTiBVUERBVEUgIikuYXBwZW5kKHVwQWN0aW9uKTsKICAgICAgICBpZiAo\nZmsuaXNEZWZlcnJlZCgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgSU5J\nVElBTExZIERFRkVSUkVEIik7CiAgICAgICAgaWYgKHN1cHBvcnRzRGVmZXJy\nZWRGb3JlaWduS2V5Q29uc3RyYWludHMoKSkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIERFRkVSUkFCTEUiKTsKICAgICAgICBpZiAoZmsuZ2V0TmFtZSgp\nICE9IG51bGwKICAgICAgICAgICAgJiYgQ09OU19OQU1FX0FGVEVSLmVxdWFs\ncyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQoZmsuZ2V0TmFtZSgpKTsKICAgICAg\nICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIG9yIG5vdCB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgZGVm\nZXJyZWQgZm9yZWlnbiBrZXkgY29uc3RyYWludHMuCiAgICAgKiBUaGlzIGlt\ncGxlbWVudGF0aW9uIHJldHVybnMge0BsaW5rICNzdXBwb3J0c1VuaXF1ZUNv\nbnN0cmFpbnRzfS4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAq\nLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3VwcG9ydHNEZWZlcnJlZEZvcmVp\nZ25LZXlDb25zdHJhaW50cygpIHsKICAgICAgICByZXR1cm4gc3VwcG9ydHNE\nZWZlcnJlZENvbnN0cmFpbnRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBuYW1lIG9mIHRoZSBnaXZlbiBmb3JlaWduIGtleSBhY3Rpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEFjdGlvbk5hbWUoaW50\nIGFjdGlvbikgewogICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAg\nICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAg\nICAgICAgIHJldHVybiAiQ0FTQ0FERSI7CiAgICAgICAgICAgIGNhc2UgRm9y\nZWlnbktleS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiAi\nU0VUIE5VTEwiOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9O\nX0RFRkFVTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIlNFVCBERUZBVUxU\nIjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhpcyBkYXRhYmFzZSBzdXBwb3J0cyB0aGUgZ2l2ZW4gZm9yZWlnbiBr\nZXkgZGVsZXRlIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNEZWxldGVBY3Rpb24oaW50IGFjdGlvbikgewogICAgICAgIGlm\nIChhY3Rpb24gPT0gRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25L\nZXlzKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc3dpdGNo\nIChhY3Rpb24pIHsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElP\nTl9SRVNUUklDVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c1Jl\nc3RyaWN0RGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25L\nZXkuQUNUSU9OX0NBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\ncG9ydHNDYXNjYWRlRGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZv\ncmVpZ25LZXkuQUNUSU9OX05VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwcG9ydHNOdWxsRGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZv\ncmVpZ25LZXkuQUNUSU9OX0RFRkFVTFQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBkYXRhYmFz\nZSBzdXBwb3J0cyB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgdXBkYXRlIGFjdGlv\nbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNVcGRhdGVB\nY3Rpb24oaW50IGFjdGlvbikgewogICAgICAgIGlmIChhY3Rpb24gPT0gRm9y\nZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAg\nICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVDoKICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c1Jlc3RyaWN0VXBkYXRlQWN0\naW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0NBU0NB\nREU6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNDYXNjYWRlVXBk\nYXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9O\nX05VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNOdWxsVXBk\nYXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9O\nX0RFRkFVTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZh\ndWx0VXBkYXRlQWN0aW9uOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZGVjbGFyYXRpb24gU1FMIGZvciB0aGUg\nZ2l2ZW4gdW5pcXVlIGNvbnN0cmFpbnQuIFRoaXMKICAgICAqIG1ldGhvZCBp\ncyB1c2VkIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRlVGFibGVTUUx9\nLgogICAgICogUmV0dXJucyA8Y29kZT5DT05TVFJBSU5UICZsdDtuYW1lJmd0\nOyBVTklRVUUgKCZsdDtjb2wgbGlzdCZndDspPC9jb2RlPgogICAgICogYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRVbmlx\ndWVDb25zdHJhaW50U1FMKFVuaXF1ZSB1bnEpIHsKICAgICAgICBpZiAoIXN1\ncHBvcnRzVW5pcXVlQ29uc3RyYWludHMKICAgICAgICAgICAgfHwgKHVucS5p\nc0RlZmVycmVkKCkgJiYgIXN1cHBvcnRzRGVmZXJyZWRVbmlxdWVDb25zdHJh\naW50cygpKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgU3Ry\naW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBp\nZiAodW5xLmdldE5hbWUoKSAhPSBudWxsCiAgICAgICAgICAgICYmIENPTlNf\nTkFNRV9CRUZPUkUuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5kKGNoZWNr\nTmFtZUxlbmd0aCh1bnEuZ2V0TmFtZSgpLCAKICAgICAgICAgICAgICAgIG1h\neENvbnN0cmFpbnROYW1lTGVuZ3RoLCAibG9uZy1jb25zdHJhaW50LW5hbWUi\nKSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiVU5JUVVFICIp\nOwogICAgICAgIGlmICh1bnEuZ2V0TmFtZSgpICE9IG51bGwgJiYgQ09OU19O\nQU1FX01JRC5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCh1bnEuZ2V0TmFtZSgpKS5hcHBlbmQoIiAiKTsKICAg\nICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKFN0cmluZ3Muam9pbih1bnEu\nZ2V0Q29sdW1ucygpLCAiLCAiKSkuCiAgICAgICAgICAgIGFwcGVuZCgiKSIp\nOwogICAgICAgIGlmICh1bnEuaXNEZWZlcnJlZCgpKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgSU5JVElBTExZIERFRkVSUkVEIik7CiAgICAgICAgaWYg\nKHN1cHBvcnRzRGVmZXJyZWRVbmlxdWVDb25zdHJhaW50cygpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgREVGRVJSQUJMRSIpOwogICAgICAgIGlmICh1\nbnEuZ2V0TmFtZSgpICE9IG51bGwKICAgICAgICAgICAgJiYgQ09OU19OQU1F\nX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQodW5xLmdldE5h\nbWUoKSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciBvciBub3QgdGhpcyBkaWN0aW9uYXJ5\nIHN1cHBvcnRzIGRlZmVycmVkIHVuaXF1ZSBjb25zdHJhaW50cy4KICAgICAq\nIFRoaXMgaW1wbGVtZW50YXRpb24gcmV0dXJucyB7QGxpbmsgI3N1cHBvcnRz\nVW5pcXVlQ29uc3RyYWludHN9LgogICAgICoKICAgICAqIEBzaW5jZSAxLjEu\nMAogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdXBwb3J0c0RlZmVy\ncmVkVW5pcXVlQ29uc3RyYWludHMoKSB7CiAgICAgICAgcmV0dXJuIHN1cHBv\ncnRzRGVmZXJyZWRDb25zdHJhaW50czsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIERhdGFiYXNlIG1ldGFkYXRhCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSB0YWJsZXMgZnJvbSBkYXRhYmFz\nZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiB0\nYWJsZSBuYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0gdGFibGUgdGhhdAogICAg\nICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVtYSBkZWZpbml0aW9u\nLiBCeSBkZWZhdWx0LCByZXR1cm5zCiAgICAgKiB0cnVlIG9ubHkgaWYgdGhl\nIGdpdmVuIHRhYmxlIGlzIGluIHRoZSBpbnRlcm5hbCBsaXN0IG9mIHN5c3Rl\nbSB0YWJsZXMsCiAgICAgKiBvciBpZiB0aGUgZ2l2ZW4gc2NoZW1hIGlzIGlu\nIHRoZSBsaXN0IG9mIHN5c3RlbSBzY2hlbWFzIGFuZCBpcyBub3QKICAgICAq\nIHRoZSB0YXJnZXQgc2NoZW1hLgogICAgICoKICAgICAqIEBwYXJhbSBuYW1l\nIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2NoZW1hIHRoZSB0YWJs\nZSBzY2hlbWE7IG1heSBiZSBudWxsCiAgICAgKiBAcGFyYW0gdGFyZ2V0U2No\nZW1hIGlmIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNjaGVtYSB3YXMgbGlzdGVk\nIGJ5CiAgICAgKiB0aGUgdXNlciBhcyBvbmUgb2YgaGlzIHNjaGVtYXMKICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1UYWJsZShTdHJpbmcg\nbmFtZSwgU3RyaW5nIHNjaGVtYSwKICAgICAgICBib29sZWFuIHRhcmdldFNj\naGVtYSkgewogICAgICAgIGlmIChzeXN0ZW1UYWJsZVNldC5jb250YWlucyhu\nYW1lLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICByZXR1cm4gIXRhcmdldFNjaGVtYSAmJiBzY2hlbWEgIT0gbnVs\nbAogICAgICAgICAgICAmJiBzeXN0ZW1TY2hlbWFTZXQuY29udGFpbnMoc2No\nZW1hLnRvVXBwZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogVGhp\ncyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIGluZGV4ZXMgZnJv\nbSBkYXRhYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlmIHRo\nZSBnaXZlbiBpbmRleCBuYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0gaW5kZXgg\ndGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVtYSBk\nZWZpbml0aW9uLiBSZXR1cm5zIGZhbHNlIGJ5IGRlZmF1bHQuCiAgICAgKgog\nICAgICogQHBhcmFtIG5hbWUgdGhlIGluZGV4IG5hbWUKICAgICAqIEBwYXJh\nbSB0YWJsZSB0aGUgaW5kZXggdGFibGUKICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gaXNTeXN0ZW1JbmRleChTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUp\nIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZpbHRlciBzeXN0ZW0gc2VxdWVu\nY2VzIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1\nZSBpZiB0aGUgZ2l2ZW4gc2VxdWVuY2UgcmVwcmVzZW50cyBhIHN5c3RlbSBz\nZXF1ZW5jZSB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVhciBpbiB0aGUg\nc2NoZW1hIGRlZmluaXRpb24uIFJldHVybnMgdHJ1ZSBpZiBzeXN0ZW0KICAg\nICAqIHNjaGVtYSBieSBkZWZhdWx0LgogICAgICoKICAgICAqIEBwYXJhbSBu\nYW1lIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2NoZW1hIHRoZSB0\nYWJsZSBzY2hlbWE7IG1heSBiZSBudWxsCiAgICAgKiBAcGFyYW0gdGFyZ2V0\nU2NoZW1hIGlmIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNjaGVtYSB3YXMgbGlz\ndGVkIGJ5CiAgICAgKiB0aGUgdXNlciBhcyBvbmUgb2YgaGlzIHNjaGVtYXMK\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1TZXF1ZW5jZShT\ndHJpbmcgbmFtZSwgU3RyaW5nIHNjaGVtYSwKICAgICAgICBib29sZWFuIHRh\ncmdldFNjaGVtYSkgewogICAgICAgIHJldHVybiAhdGFyZ2V0U2NoZW1hICYm\nIHNjaGVtYSAhPSBudWxsCiAgICAgICAgICAgICYmIHN5c3RlbVNjaGVtYVNl\ndC5jb250YWlucyhzY2hlbWEudG9VcHBlckNhc2UoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCB0YWJs\nZXMgbWF0Y2hpbmcgdGhlIGdpdmVuIG5hbWUgcGF0dGVybi4KICAgICAqLwog\nICAgcHVibGljIFRhYmxlW10gZ2V0VGFibGVzKERhdGFiYXNlTWV0YURhdGEg\nbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5h\nbWUsIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXN1cHBvcnRz\nU2NoZW1hRm9yR2V0VGFibGVzKQogICAgICAgICAgICBzY2hlbWFOYW1lID0g\nbnVsbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBn\nZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSk7CgogICAgICAg\nIFN0cmluZ1tdIHR5cGVzID0gU3RyaW5ncy5zcGxpdCh0YWJsZVR5cGVzLCAi\nLCIsIDApOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHlwZXMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIHR5cGVzW2ldID0gdHlwZXNbaV0udHJp\nbSgpOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihjb25uKTsK\nICAgICAgICBSZXN1bHRTZXQgdGFibGVzID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICB0YWJsZXMgPSBtZXRhLmdldFRhYmxlcyhnZXRDYXRh\nbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAg\nc2NoZW1hTmFtZSwgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1l\nKSwgdHlwZXMpOwogICAgICAgICAgICBMaXN0IHRhYmxlTGlzdCA9IG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHRhYmxlcyAhPSBudWxs\nICYmIHRhYmxlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICB0YWJsZUxpc3Qu\nYWRkKG5ld1RhYmxlKHRhYmxlcykpOwogICAgICAgICAgICByZXR1cm4gKFRh\nYmxlW10pIHRhYmxlTGlzdC50b0FycmF5KG5ldyBUYWJsZVt0YWJsZUxpc3Qu\nc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKHRhYmxlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICB0YWJsZXMuY2xvc2UoKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHRh\nYmxlIGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBUYWJsZSBuZXdUYWJsZShSZXN1\nbHRTZXQgdGFibGVNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIFRhYmxlIHQgPSBuZXcgVGFibGUoKTsKICAgICAgICB0LnNl\ndE5hbWUodGFibGVNZXRhLmdldFN0cmluZygiVEFCTEVfTkFNRSIpKTsKICAg\nICAgICByZXR1cm4gdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qg\nb24gdGhlIHNjaGVtYSB0byBmaW5kIHNlcXVlbmNlcyBtYXRjaGluZyB0aGUg\nZ2l2ZW4gbmFtZSBwYXR0ZXJuLgogICAgICogUmV0dXJucyBhbiBlbXB0eSBh\ncnJheSBieSBkZWZhdWx0LCBhcyB0aGVyZSBpcyBubyBzdGFuZGFyZCB3YXkg\ndG8KICAgICAqIHJldHJpZXZlIGEgbGlzdCBvZiBzZXF1ZW5jZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBTZXF1ZW5jZVtdIGdldFNlcXVlbmNlcyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmlu\nZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lLCBDb25uZWN0aW9u\nIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nU3RyaW5nIHN0ciA9IGdldFNlcXVlbmNlc1NRTChzY2hlbWFOYW1lLCBzZXF1\nZW5jZU5hbWUpOwogICAgICAgIGlmIChzdHIgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBTZXF1ZW5jZVswXTsKCiAgICAgICAgUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIHN0cik7\nICAgICAgICAKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGludCBpZHggPSAxOwogICAgICAgICAgICBp\nZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAgICAgICAgc3RtbnQu\nc2V0U3RyaW5nKGlkeCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNlKCkpOwog\nICAgICAgICAgICBpZiAoc2VxdWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBzdG1udC5zZXRTdHJpbmcoaWR4KyssIHNlcXVlbmNlTmFtZSk7\nCiAgICAgICAgICAgIHNldFF1ZXJ5VGltZW91dChzdG1udCwgY29uZi5nZXRR\ndWVyeVRpbWVvdXQoKSk7CiAgICAgICAgICAgIHJzID0gZXhlY3V0ZVF1ZXJ5\nKGNvbm4sIHN0bW50LCBzdHIpOwogICAgICAgICAgICByZXR1cm4gZ2V0U2Vx\ndWVuY2UocnMpOyAgICAgICAgICAgIAogICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBpZiAocnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgcnMuY2xvc2UoKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkgICAgCiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHN0bW50\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2VxdWVuY2UgZnJvbSB0aGUg\naW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFNlcXVlbmNlIG5ld1NlcXVlbmNlKFJlc3VsdFNldCBz\nZXF1ZW5jZU1ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgU2VxdWVuY2Ugc2VxID0gbmV3IFNlcXVlbmNlKCk7CiAgICAgICAg\nc2VxLnNldFNjaGVtYU5hbWUoc2VxdWVuY2VNZXRhLmdldFN0cmluZygiU0VR\nVUVOQ0VfU0NIRU1BIikpOwogICAgICAgIHNlcS5zZXROYW1lKHNlcXVlbmNl\nTWV0YS5nZXRTdHJpbmcoIlNFUVVFTkNFX05BTUUiKSk7CiAgICAgICAgcmV0\ndXJuIHNlcTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FM\nIG5lZWRlZCB0byBzZWxlY3QgdGhlIGxpc3Qgb2Ygc2VxdWVuY2VzLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNlcXVlbmNlc1NRTChTdHJp\nbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSkgewogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBv\nbiB0aGUgc2NoZW1hIHRvIGZpbmQgY29sdW1ucyBtYXRjaGluZyB0aGUgZ2l2\nZW4gdGFibGUgYW5kCiAgICAgKiBjb2x1bW4gcGF0dGVybnMuCiAgICAgKi8K\nICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5zKERhdGFiYXNlTWV0YURh\ndGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVt\nYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIFN0cmluZyBjb2x1bW5OYW1lLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBwb3J0c051\nbGxUYWJsZUZvckdldENvbHVtbnMpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBpZiAoIXN1cHBvcnRzU2NoZW1hRm9yR2V0Q29sdW1ucykK\nICAgICAgICAgICAgc2NoZW1hTmFtZSA9IG51bGw7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzY2hlbWFOYW1lID0gZ2V0U2NoZW1hTmFtZUZvck1ldGFk\nYXRhKHNjaGVtYU5hbWUpOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJh\ndGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQgY29scyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgY29scyA9IG1ldGEuZ2V0Q29sdW1u\ncyhnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAg\nICAgICAgICAgc2NoZW1hTmFtZSwgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEo\ndGFibGVOYW1lKSwKICAgICAgICAgICAgICAgIGdldENvbHVtbk5hbWVGb3JN\nZXRhZGF0YShjb2x1bW5OYW1lKSk7CgogICAgICAgICAgICBMaXN0IGNvbHVt\nbkxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChj\nb2xzICE9IG51bGwgJiYgY29scy5uZXh0KCkpCiAgICAgICAgICAgICAgICBj\nb2x1bW5MaXN0LmFkZChuZXdDb2x1bW4oY29scykpOwogICAgICAgICAgICBy\nZXR1cm4gKENvbHVtbltdKSBjb2x1bW5MaXN0LnRvQXJyYXkKICAgICAgICAg\nICAgICAgIChuZXcgQ29sdW1uW2NvbHVtbkxpc3Quc2l6ZSgpXSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGNvbHMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29s\ncy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgY29sdW1uIGZyb20gdGhlIGluZm9y\nbWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBDb2x1bW4gbmV3Q29sdW1uKFJlc3VsdFNldCBjb2xNZXRhKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENvbHVtbiBj\nID0gbmV3IENvbHVtbigpOwogICAgICAgIGMuc2V0U2NoZW1hTmFtZShjb2xN\nZXRhLmdldFN0cmluZygiVEFCTEVfU0NIRU0iKSk7CiAgICAgICAgYy5zZXRU\nYWJsZU5hbWUoY29sTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAg\nICAgICAgYy5zZXROYW1lKGNvbE1ldGEuZ2V0U3RyaW5nKCJDT0xVTU5fTkFN\nRSIpKTsKICAgICAgICBjLnNldFR5cGUoY29sTWV0YS5nZXRJbnQoIkRBVEFf\nVFlQRSIpKTsKICAgICAgICBjLnNldFR5cGVOYW1lKGNvbE1ldGEuZ2V0U3Ry\naW5nKCJUWVBFX05BTUUiKSk7CiAgICAgICAgYy5zZXRTaXplKGNvbE1ldGEu\nZ2V0SW50KCJDT0xVTU5fU0laRSIpKTsKICAgICAgICBjLnNldERlY2ltYWxE\naWdpdHMoY29sTWV0YS5nZXRJbnQoIkRFQ0lNQUxfRElHSVRTIikpOwogICAg\nICAgIGMuc2V0Tm90TnVsbChjb2xNZXRhLmdldEludCgiTlVMTEFCTEUiKQog\nICAgICAgICAgICA9PSBEYXRhYmFzZU1ldGFEYXRhLmNvbHVtbk5vTnVsbHMp\nOwoKICAgICAgICBTdHJpbmcgZGVmID0gY29sTWV0YS5nZXRTdHJpbmcoIkNP\nTFVNTl9ERUYiKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\nZGVmKSAmJiAhIm51bGwiLmVxdWFsc0lnbm9yZUNhc2UoZGVmKSkKICAgICAg\nICAgICAgYy5zZXREZWZhdWx0U3RyaW5nKGRlZik7CiAgICAgICAgcmV0dXJu\nIGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hl\nbWEgdG8gZmluZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBw\nYXR0ZXJuLgogICAgICovCiAgICBwdWJsaWMgUHJpbWFyeUtleVtdIGdldFBy\naW1hcnlLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwKICAgICAgICBTdHJp\nbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5h\nbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAodXNlR2V0QmVzdFJvd0lkZW50aWZpZXJGb3JQ\ncmltYXJ5S2V5cykKICAgICAgICAgICAgcmV0dXJuIGdldFByaW1hcnlLZXlz\nRnJvbUJlc3RSb3dJZGVudGlmaWVyKG1ldGEsIGNhdGFsb2csCiAgICAgICAg\nICAgICAgICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGNvbm4pOwogICAgICAg\nIHJldHVybiBnZXRQcmltYXJ5S2V5c0Zyb21HZXRQcmltYXJ5S2V5cyhtZXRh\nLCBjYXRhbG9nLAogICAgICAgICAgICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUs\nIGNvbm4pOwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUg\nc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBrZXlzIGZvciB0aGUgZ2l2ZW4gdGFi\nbGUgcGF0dGVybi4KICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlLZXlb\nXSBnZXRQcmltYXJ5S2V5c0Zyb21HZXRQcmltYXJ5S2V5cwogICAgICAgIChE\nYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLCBTdHJpbmcg\nc2NoZW1hTmFtZSwKICAgICAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSwgQ29u\nbmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVsbCAmJiAhc3VwcG9ydHNOdWxs\nVGFibGVGb3JHZXRQcmltYXJ5S2V5cykKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwog\nICAgICAgIFJlc3VsdFNldCBwa3MgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHBrcyA9IG1ldGEuZ2V0UHJpbWFyeUtleXMoZ2V0Q2F0YWxv\nZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9nKSwKICAgICAgICAgICAgICAgIGdl\ndFNjaGVtYU5hbWVGb3JNZXRhZGF0YShzY2hlbWFOYW1lKSwKICAgICAgICAg\nICAgICAgIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSkpOwoK\nICAgICAgICAgICAgTGlzdCBwa0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAg\nICAgICAgICAgIHdoaWxlIChwa3MgIT0gbnVsbCAmJiBwa3MubmV4dCgpKQog\nICAgICAgICAgICAgICAgcGtMaXN0LmFkZChuZXdQcmltYXJ5S2V5KHBrcykp\nOwogICAgICAgICAgICByZXR1cm4gKFByaW1hcnlLZXlbXSkgcGtMaXN0LnRv\nQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgUHJpbWFyeUtleVtwa0xpc3Qu\nc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKHBrcyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBwa3MuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHByaW1hcnkg\na2V5IGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmltYXJ5S2V5IG5ld1ByaW1h\ncnlLZXkoUmVzdWx0U2V0IHBrTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBQcmltYXJ5S2V5IHBrID0gbmV3IFByaW1hcnlL\nZXkoKTsKICAgICAgICBway5zZXRTY2hlbWFOYW1lKHBrTWV0YS5nZXRTdHJp\nbmcoIlRBQkxFX1NDSEVNIikpOwogICAgICAgIHBrLnNldFRhYmxlTmFtZShw\na01ldGEuZ2V0U3RyaW5nKCJUQUJMRV9OQU1FIikpOwogICAgICAgIHBrLnNl\ndENvbHVtbk5hbWUocGtNZXRhLmdldFN0cmluZygiQ09MVU1OX05BTUUiKSk7\nCiAgICAgICAgcGsuc2V0TmFtZShwa01ldGEuZ2V0U3RyaW5nKCJQS19OQU1F\nIikpOwogICAgICAgIHJldHVybiBwazsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBm\nb3IgdGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBQcmltYXJ5S2V5W10gZ2V0UHJpbWFyeUtleXNGcm9tQmVzdFJvd0lk\nZW50aWZpZXIKICAgICAgICAoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJp\nbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUsCiAgICAgICAgICAgIFN0\ncmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWZvcmVN\nZXRhZGF0YU9wZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQgcGtz\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBwa3MgPSBtZXRh\nLmdldEJlc3RSb3dJZGVudGlmaWVyKGNhdGFsb2csIHNjaGVtYU5hbWUsCiAg\nICAgICAgICAgICAgICB0YWJsZU5hbWUsIDAsIGZhbHNlKTsKCiAgICAgICAg\nICAgIExpc3QgcGtMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAg\nICB3aGlsZSAocGtzICE9IG51bGwgJiYgcGtzLm5leHQoKSkgewogICAgICAg\nICAgICAgICAgUHJpbWFyeUtleSBwayA9IG5ldyBQcmltYXJ5S2V5KCk7CiAg\nICAgICAgICAgICAgICBway5zZXRTY2hlbWFOYW1lKHNjaGVtYU5hbWUpOwog\nICAgICAgICAgICAgICAgcGsuc2V0VGFibGVOYW1lKHRhYmxlTmFtZSk7CiAg\nICAgICAgICAgICAgICBway5zZXRDb2x1bW5OYW1lKHBrcy5nZXRTdHJpbmco\nIkNPTFVNTl9OQU1FIikpOwogICAgICAgICAgICAgICAgcGtMaXN0LmFkZChw\nayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChQcmltYXJ5\nS2V5W10pIHBrTGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFBy\naW1hcnlLZXlbcGtMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChwa3MgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGtzLmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxl\nY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIGluZGV4ZXMgbWF0Y2hpbmcgdGhl\nIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBJbmRl\neFtdIGdldEluZGV4SW5mbyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmlu\nZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcg\ndGFibGVOYW1lLCBib29sZWFuIHVuaXF1ZSwKICAgICAgICBib29sZWFuIGFw\ncHJveCwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVsbCAmJiAhc3Vw\ncG9ydHNOdWxsVGFibGVGb3JHZXRJbmRleEluZm8pCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihj\nb25uKTsKICAgICAgICBSZXN1bHRTZXQgaW5kZXhlcyA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaW5kZXhlcyA9IG1ldGEuZ2V0SW5kZXhJ\nbmZvKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyksCiAgICAg\nICAgICAgICAgICBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFt\nZSksCiAgICAgICAgICAgICAgICBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0\nYWJsZU5hbWUpLCB1bmlxdWUsIGFwcHJveCk7CgogICAgICAgICAgICBMaXN0\nIGluZGV4TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hp\nbGUgKGluZGV4ZXMgIT0gbnVsbCAmJiBpbmRleGVzLm5leHQoKSkKICAgICAg\nICAgICAgICAgIGluZGV4TGlzdC5hZGQobmV3SW5kZXgoaW5kZXhlcykpOwog\nICAgICAgICAgICByZXR1cm4gKEluZGV4W10pIGluZGV4TGlzdC50b0FycmF5\nKG5ldyBJbmRleFtpbmRleExpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgaWYgKGluZGV4ZXMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXhlcy5j\nbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgaW5kZXggZnJvbSB0aGUgaW5mb3JtYXRp\nb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIEluZGV4IG5ld0luZGV4KFJlc3VsdFNldCBpZHhNZXRhKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEluZGV4IGlkeCA9IG5l\ndyBJbmRleCgpOwogICAgICAgIGlkeC5zZXRTY2hlbWFOYW1lKGlkeE1ldGEu\nZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIpKTsKICAgICAgICBpZHguc2V0VGFi\nbGVOYW1lKGlkeE1ldGEuZ2V0U3RyaW5nKCJUQUJMRV9OQU1FIikpOwogICAg\nICAgIGlkeC5zZXRDb2x1bW5OYW1lKGlkeE1ldGEuZ2V0U3RyaW5nKCJDT0xV\nTU5fTkFNRSIpKTsKICAgICAgICBpZHguc2V0TmFtZShpZHhNZXRhLmdldFN0\ncmluZygiSU5ERVhfTkFNRSIpKTsKICAgICAgICBpZHguc2V0VW5pcXVlKCFp\nZHhNZXRhLmdldEJvb2xlYW4oIk5PTl9VTklRVUUiKSk7CiAgICAgICAgcmV0\ndXJuIGlkeDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhl\nIHNjaGVtYSB0byByZXR1cm4gZm9yZWlnbiBrZXlzIGltcG9ydGVkIGJ5IHRo\nZSBnaXZlbgogICAgICogdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHVi\nbGljIEZvcmVpZ25LZXlbXSBnZXRJbXBvcnRlZEtleXMoRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2No\nZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghc3Vw\ncG9ydHNGb3JlaWduS2V5cykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBwb3J0c051bGxU\nYWJsZUZvckdldEltcG9ydGVkS2V5cykKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwog\nICAgICAgIFJlc3VsdFNldCBrZXlzID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBrZXlzID0gbWV0YS5nZXRJbXBvcnRlZEtleXMoZ2V0Q2F0\nYWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9nKSwKICAgICAgICAgICAgICAg\nIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShzY2hlbWFOYW1lKSwKICAgICAg\nICAgICAgICAgIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSkp\nOwoKICAgICAgICAgICAgTGlzdCBpbXBvcnRlZEtleUxpc3QgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChrZXlzICE9IG51bGwgJiYg\na2V5cy5uZXh0KCkpCiAgICAgICAgICAgICAgICBpbXBvcnRlZEtleUxpc3Qu\nYWRkKG5ld0ZvcmVpZ25LZXkoa2V5cykpOwogICAgICAgICAgICByZXR1cm4g\nKEZvcmVpZ25LZXlbXSkgaW1wb3J0ZWRLZXlMaXN0LnRvQXJyYXkKICAgICAg\nICAgICAgICAgIChuZXcgRm9yZWlnbktleVtpbXBvcnRlZEtleUxpc3Quc2l6\nZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGtl\neXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAga2V5cy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgZm9yZWlnbiBr\nZXkgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZvcmVpZ25LZXkgbmV3Rm9yZWln\nbktleShSZXN1bHRTZXQgZmtNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBuZXcgRm9yZWlnbktl\neSgpOwogICAgICAgIGZrLnNldFNjaGVtYU5hbWUoZmtNZXRhLmdldFN0cmlu\nZygiRktUQUJMRV9TQ0hFTSIpKTsKICAgICAgICBmay5zZXRUYWJsZU5hbWUo\nZmtNZXRhLmdldFN0cmluZygiRktUQUJMRV9OQU1FIikpOwogICAgICAgIGZr\nLnNldENvbHVtbk5hbWUoZmtNZXRhLmdldFN0cmluZygiRktDT0xVTU5fTkFN\nRSIpKTsKICAgICAgICBmay5zZXROYW1lKGZrTWV0YS5nZXRTdHJpbmcoIkZL\nX05BTUUiKSk7CiAgICAgICAgZmsuc2V0UHJpbWFyeUtleVNjaGVtYU5hbWUo\nZmtNZXRhLmdldFN0cmluZygiUEtUQUJMRV9TQ0hFTSIpKTsKICAgICAgICBm\nay5zZXRQcmltYXJ5S2V5VGFibGVOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBL\nVEFCTEVfTkFNRSIpKTsKICAgICAgICBmay5zZXRQcmltYXJ5S2V5Q29sdW1u\nTmFtZShma01ldGEuZ2V0U3RyaW5nKCJQS0NPTFVNTl9OQU1FIikpOwogICAg\nICAgIGZrLnNldEtleVNlcXVlbmNlKGZrTWV0YS5nZXRTaG9ydCgiS0VZX1NF\nUSIpKTsKICAgICAgICBmay5zZXREZWZlcnJlZChma01ldGEuZ2V0U2hvcnQo\nIkRFRkVSUkFCSUxJVFkiKQogICAgICAgICAgICA9PSBEYXRhYmFzZU1ldGFE\nYXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5RGVmZXJyZWQpOwoKICAgICAgICBp\nbnQgZGVsID0gZmtNZXRhLmdldFNob3J0KCJERUxFVEVfUlVMRSIpOwogICAg\nICAgIHN3aXRjaCAoZGVsKSB7CiAgICAgICAgICAgIGNhc2UgRGF0YWJhc2VN\nZXRhRGF0YS5pbXBvcnRlZEtleVNldE51bGw6CiAgICAgICAgICAgICAgICBm\nay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktleS5BQ1RJT05fTlVMTCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBEYXRhYmFz\nZU1ldGFEYXRhLmltcG9ydGVkS2V5U2V0RGVmYXVsdDoKICAgICAgICAgICAg\nICAgIGZrLnNldERlbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9ERUZB\nVUxUKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlDYXNjYWRlOgogICAgICAg\nICAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9O\nX0NBU0NBREUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24o\nRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1QpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmazsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIHRhYmxlIG5hbWUgdGhhdCB3aWxs\nIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJv\nbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBTdHJpbmcgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEoU3RyaW5nIHRh\nYmxlTmFtZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2FzZSh0\nYWJsZU5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\nc2NoZW1hIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBp\nbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0\nYX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2NoZW1hTmFt\nZUZvck1ldGFkYXRhKFN0cmluZyBzY2hlbWFOYW1lKSB7CiAgICAgICAgaWYg\nKHNjaGVtYU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgc2NoZW1hTmFtZSA9\nIGNvbmYuZ2V0U2NoZW1hKCk7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hl\nbWFDYXNlKHNjaGVtYU5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyB0aGUgY2F0YWxvZyBuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBv\nYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0BsaW5rIERhdGFi\nYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\ndENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoU3RyaW5nIGNhdGFsb2dOYW1lKSB7\nCiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKGNhdGFsb2dOYW1l\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNvbHVtbiBu\nYW1lIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRp\nb24KICAgICAqIGZyb20ge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldENvbHVtbk5hbWVGb3JNZXRh\nZGF0YShTdHJpbmcgY29sdW1uTmFtZSkgewogICAgICAgIHJldHVybiBjb252\nZXJ0U2NoZW1hQ2FzZShjb2x1bW5OYW1lKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBzY2hlbWEgbmFtZSB0byBhIG5h\nbWUgdGhhdCB0aGUgZGF0YWJhc2Ugd2lsbAogICAgICogYmUgYWJsZSB0byB1\nbmRlcnN0YW5kLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGNvbnZlcnRT\nY2hlbWFDYXNlKFN0cmluZyBvYmplY3ROYW1lKSB7CiAgICAgICAgaWYgKG9i\namVjdE5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIC8vIEhhbmRsZSBkZWxpbWl0ZWQgc3RyaW5nIGRpZmZlcmVudGx5\nLiBSZXR1cm4gdW5xdW90ZWQgbmFtZS4KICAgICAgICBpZiAoZGVsaW1pdElk\ncyB8fCBpc0RlbGltaXRlZChvYmplY3ROYW1lKSkgewogICAgICAgICAgICBT\ndHJpbmcgZGVsaW1DYXNlID0gZ2V0RGVsaW1pdGVkQ2FzZSgpOwogICAgICAg\nICAgICBpZiAoU0NIRU1BX0NBU0VfVVBQRVIuZXF1YWxzKGRlbGltQ2FzZSkp\nIHsKICAgICAgICAgICAgICAgIG9iamVjdE5hbWUudG9VcHBlckNhc2UoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChTQ0hFTUFfQ0FT\nRV9MT1dFUi5lcXVhbHMoZGVsaW1DYXNlKSkgewogICAgICAgICAgICAgICAg\nb2JqZWN0TmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIAogICAgICAgICAgICByZXR1cm4gc3RyaXBEZWxpbWl0ZXJzKG9i\namVjdE5hbWUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBTdHJpbmcg\nc2Nhc2UgPSBnZXRTY2hlbWFDYXNlKCk7CiAgICAgICAgaWYgKFNDSEVNQV9D\nQVNFX0xPV0VSLmVxdWFscyhzY2FzZSkpCiAgICAgICAgICAgIHJldHVybiBv\nYmplY3ROYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKFNDSEVNQV9D\nQVNFX1BSRVNFUlZFLmVxdWFscyhzY2FzZSkpCiAgICAgICAgICAgIHJldHVy\nbiBvYmplY3ROYW1lOwogICAgICAgIHJldHVybiBvYmplY3ROYW1lLnRvVXBw\nZXJDYXNlKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIERC\nIHNwZWNpZmljIHNjaGVtYUNhc2UgCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0U2NoZW1hQ2FzZSgpewogICAgICAgIHJldHVybiBzY2hlbWFDYXNl\nOwogICAgfQogICAgICAgIAogICAgLyoqCiAgICAgKiBQcmVwYXJlZCB0aGUg\nY29ubmVjdGlvbiBmb3IgbWV0YWRhdGEgb3BlcmF0aW9ucy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKENvbm5l\nY3Rpb24gYykgewogICAgICAgIGlmIChyZXF1aXJlc0F1dG9Db21taXRGb3JN\nZXRhRGF0YSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nYy5yb2xsYmFjaygpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc3FsZSkgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBpZiAoIWMuZ2V0QXV0b0NvbW1pdCgpKQogICAgICAg\nICAgICAgICAgICAgIGMuc2V0QXV0b0NvbW1pdCh0cnVlKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUpIHsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gU2VxdWVuY2VzIGFuZCBBdXRvLUFzc2lnbgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbGFzdCBnZW5lcmF0ZWQgdmFsdWUgZm9yIHRoZSBnaXZl\nbiBjb2x1bW4uCiAgICAgKiBUaHJvd3MgYW4gZXhjZXB0aW9uIGJ5IGRlZmF1\nbHQgaWYge0BsaW5rICNsYXN0R2VuZXJhdGVkS2V5UXVlcnl9IGlzIG51bGwu\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0R2VuZXJhdGVkS2V5KENv\nbHVtbiBjb2wsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAobGFzdEdlbmVyYXRlZEtleVF1ZXJ5\nID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tYXV0by1hc3NpZ24iKSk7CgogICAgICAgIC8vIHJl\ncGxhY2UgdGhpbmdzIGxpa2UgIlNFTEVDVCBNQVgoezB9KSBGUk9NIHsxfSIK\nICAgICAgICBTdHJpbmcgcXVlcnkgPSBsYXN0R2VuZXJhdGVkS2V5UXVlcnk7\nCiAgICAgICAgaWYgKHF1ZXJ5LmluZGV4T2YoJ3snKSAhPSAtMSkgLy8gb25s\neSBpZiB0aGUgdG9rZW4gaXMgaW4gdGhlIHN0cmluZwogICAgICAgIHsKICAg\nICAgICAgICAgcXVlcnkgPSBNZXNzYWdlRm9ybWF0LmZvcm1hdChxdWVyeSwg\nbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgY29sLmdldE5hbWUoKSwg\nZ2V0RnVsbE5hbWUoY29sLmdldFRhYmxlKCksIGZhbHNlKSwKICAgICAgICAg\nICAgICAgIGdldEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2wpLAogICAg\nICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBxdWVyeSk7CiAg\nICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBzZXRRdWVyeVRpbWVvdXQoc3RtbnQsIGNvbmYuZ2V0UXVlcnlU\naW1lb3V0KCkpOwogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25u\nLCBzdG1udCwgcXVlcnkpOwogICAgICAgICAgICByZXR1cm4gZ2V0S2V5KHJz\nLCBjb2wpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChy\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcnMuY2xvc2UoKTsg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAo\nc3RtbnQgIT0gbnVsbCkgICAgCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1u\ndC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9IAogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc2VxdWVu\nY2UgbmFtZSB1c2VkIGJ5IGRhdGFiYXNlcyBmb3IgdGhlIGdpdmVuIGF1dG9h\nc3NpZ25lZAogICAgICogY29sdW1uLiBUaGlzIGlzIG9ubHkgdXNlZCBieSBk\nYXRhYmFzZXMgdGhhdCByZXF1aXJlIGFuIGV4cGxpY2l0IG5hbWUKICAgICAq\nIHRvIGJlIHVzZWQgZm9yIGF1dG8tYXNzaWduIHN1cHBvcnQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0R2VuZXJhdGVkS2V5U2VxdWVuY2VO\nYW1lKENvbHVtbiBjb2wpIHsKICAgICAgICBTdHJpbmcgdG5hbWUgPSBjb2wu\nZ2V0VGFibGVOYW1lKCk7CiAgICAgICAgU3RyaW5nIGNuYW1lID0gY29sLmdl\ndE5hbWUoKTsKICAgICAgICBpbnQgbWF4ID0gbWF4QXV0b0Fzc2lnbk5hbWVM\nZW5ndGg7CiAgICAgICAgaW50IGV4dHJhQ2hhcnMgPSAtbWF4ICsgdG5hbWUu\nbGVuZ3RoKCkgKyAxIC8vIDx0bmFtZT4gKyAnXycKICAgICAgICAgICAgKyBj\nbmFtZS5sZW5ndGgoKSArIDQ7IC8vIDxjbmFtZT4gKyAnX1NFUScKICAgICAg\nICBpZiAoZXh0cmFDaGFycyA+IDApIHsKICAgICAgICAgICAgLy8gdGhpcyBh\nc3N1bWVzIHRoYXQgdG5hbWUgaXMgbG9uZ2VyIHRoYW4gZXh0cmFDaGFycwog\nICAgICAgICAgICB0bmFtZSA9IHRuYW1lLnN1YnN0cmluZygwLCB0bmFtZS5s\nZW5ndGgoKSAtIGV4dHJhQ2hhcnMpOwogICAgICAgIH0KICAgICAgICBTdHJp\nbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcihtYXgpOwogICAgICAg\nIGJ1Zi5hcHBlbmQodG5hbWUpLmFwcGVuZCgiXyIpLmFwcGVuZChjbmFtZSku\nYXBwZW5kKCJfU0VRIik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIENvbmZpZ3VyYWJsZSBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNl\ndENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\ndGhpcy5jb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBjb25mOwogICAgICAg\nIHRoaXMubG9nID0gdGhpcy5jb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlv\nbi5MT0dfSkRCQyk7CgogICAgICAgIC8vIHdhcm4gYWJvdXQgdW5zdXBwb3J0\nZWQgZGljdHMKICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSAmJiAh\naXNTdXBwb3J0ZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQo\nImRpY3Qtbm90LXN1cHBvcnRlZCIsIGdldENsYXNzKCkpKTsKICAgIH0KCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNTdXBwb3J0ZWQoKSB7CiAgICAgICAgLy8g\naWYgdGhpcyBpcyBhIGN1c3RvbSBkaWN0LCB0cmF2ZXJzZSB0byB3aGF0ZXZl\nciBvcGVuanBhIGRpY3QgaXQKICAgICAgICAvLyBleHRlbmRzCiAgICAgICAg\nQ2xhc3MgYyA9IGdldENsYXNzKCk7CiAgICAgICAgd2hpbGUgKCFjLmdldE5h\nbWUoKS5zdGFydHNXaXRoKCJvcmcuYXBhY2hlLm9wZW5qcGEuIikpCiAgICAg\nICAgICAgIGMgPSBjLmdldFN1cGVyY2xhc3MoKTsKCiAgICAgICAgLy8gdGhl\nIGdlbmVyaWMgZGJkaWN0aW9uYXJ5IGlzIG5vdCBjb25zaWRlcmVkIGEgc3Vw\ncG9ydGVkIGRpY3Q7IGFsbAogICAgICAgIC8vIG90aGVyIGNvbmNyZXRlIGRp\nY3Rpb25hcmllcyBhcmUKICAgICAgICBpZiAoYyA9PSBEQkRpY3Rpb25hcnku\nY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3Vy\nYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJh\ndGlvbigpIHsKICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBzZXQgb2YgcmVz\nZXJ2ZWQgU1FMOTIgd29yZHMgZnJvbSByZXNvdXJjZQogICAgICAgIElucHV0\nU3RyZWFtIGluID0gREJEaWN0aW9uYXJ5LmNsYXNzLmdldFJlc291cmNlQXNT\ndHJlYW0KICAgICAgICAgICAgKCJzcWwta2V5d29yZHMucnNyYyIpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFN0cmluZyBrZXl3b3JkcyA9IG5ldyBC\ndWZmZXJlZFJlYWRlcihuZXcgSW5wdXRTdHJlYW1SZWFkZXIoaW4pKS4KICAg\nICAgICAgICAgICAgIHJlYWRMaW5lKCk7CiAgICAgICAgICAgIGluLmNsb3Nl\nKCk7CiAgICAgICAgICAgIHJlc2VydmVkV29yZFNldC5hZGRBbGwoQXJyYXlz\nLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoa2V5d29y\nZHMsICIsIiwgMCkpKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBp\nb2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\naW9lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgeyBp\nbi5jbG9zZSgpOyB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7fQogICAgICAg\nIH0KCiAgICAgICAgLy8gYWRkIGFkZGl0aW9uYWwgcmVzZXJ2ZWQgd29yZHMg\nc2V0IGJ5IHVzZXIKICAgICAgICBpZiAocmVzZXJ2ZWRXb3JkcyAhPSBudWxs\nKQogICAgICAgICAgICByZXNlcnZlZFdvcmRTZXQuYWRkQWxsKEFycmF5cy5h\nc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAgICAgICAgKHJlc2VydmVk\nV29yZHMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkpOwoKICAgICAgICAvLyBh\nZGQgc3lzdGVtIHNjaGVtYXMgc2V0IGJ5IHVzZXIKICAgICAgICBpZiAoc3lz\ndGVtU2NoZW1hcyAhPSBudWxsKQogICAgICAgICAgICBzeXN0ZW1TY2hlbWFT\nZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAg\nICAgICAgICAgKHN5c3RlbVNjaGVtYXMudG9VcHBlckNhc2UoKSwgIiwiLCAw\nKSkpOwoKICAgICAgICAvLyBhZGQgc3lzdGVtIHRhYmxlcyBzZXQgYnkgdXNl\ncgogICAgICAgIGlmIChzeXN0ZW1UYWJsZXMgIT0gbnVsbCkKICAgICAgICAg\nICAgc3lzdGVtVGFibGVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5n\ncy5zcGxpdAogICAgICAgICAgICAgICAgKHN5c3RlbVRhYmxlcy50b1VwcGVy\nQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBmaXhlZCBzaXpl\nIHR5cGUgbmFtZXMgc2V0IGJ5IHRoZSB1c2VyCiAgICAgICAgaWYgKGZpeGVk\nU2l6ZVR5cGVOYW1lcyAhPSBudWxsKQogICAgICAgICAgICBmaXhlZFNpemVU\neXBlTmFtZVNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0\nCiAgICAgICAgICAgICAgICAoZml4ZWRTaXplVHlwZU5hbWVzLnRvVXBwZXJD\nYXNlKCksICIsIiwgMCkpKTsKICAgICAgICAKICAgICAgICAvLyBpZiB1c2Vy\nIGhhcyB1bnNldCBzZXF1ZW5jZSBzcWwsIG51bGwgaXQgb3V0IHNvIHdlIGtu\nb3cgc2VxdWVuY2VzCiAgICAgICAgLy8gYXJlbid0IHN1cHBvcnRlZAogICAg\nICAgIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gU3RyaW5nVXRpbHMudHJpbVRvTnVs\nbChuZXh0U2VxdWVuY2VRdWVyeSk7CiAgICAgICAgCiAgICAgICAgaWYgKHNl\nbGVjdFdvcmRzICE9IG51bGwpCiAgICAgICAgICAgIHNlbGVjdFdvcmRTZXQu\nYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdChzZWxlY3RXb3Jk\ncwogICAgICAgICAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpLCAiLCIsIDAp\nKSk7CiAgICAgICAgCiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgZXJyb3Ig\nY29kZXMKICAgICAgICBTUUxFcnJvckNvZGVSZWFkZXIgY29kZVJlYWRlciA9\nIG5ldyBTUUxFcnJvckNvZGVSZWFkZXIoKTsKICAgICAgICBTdHJpbmcgcnNy\nYyA9ICJzcWwtZXJyb3Itc3RhdGUtY29kZXMueG1sIjsKICAgICAgICBJbnB1\ndFN0cmVhbSBzdHJlYW0gPSBnZXRDbGFzcygpLmdldFJlc291cmNlQXNTdHJl\nYW0ocnNyYyk7CiAgICAgICAgU3RyaW5nIGRpY3Rpb25hcnlDbGFzc05hbWUg\nPSBnZXRDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICBpZiAoc3RyZWFtID09\nIG51bGwpIHsgLy8gVXNlciBzdXBwbGllZCBkaWN0aW9uYXJ5IGJ1dCBubyBl\ncnJvciBjb2RlcyB4bWwKICAgICAgICAgICAgLy8gdXNlIGRlZmF1bHQKICAg\nICAgICAgICAgc3RyZWFtID0gREJEaWN0aW9uYXJ5LmNsYXNzLmdldFJlc291\ncmNlQXNTdHJlYW0ocnNyYyk7CiAgICAgICAgICAgIGRpY3Rpb25hcnlDbGFz\nc05hbWUgPSBnZXRDbGFzcygpLmdldFN1cGVyY2xhc3MoKS5nZXROYW1lKCk7\nCiAgICAgICAgfQogICAgICAgIGNvZGVSZWFkZXIucGFyc2Uoc3RyZWFtLCBk\naWN0aW9uYXJ5Q2xhc3NOYW1lLCB0aGlzKTsKICAgIH0KICAgIAogICAgcHVi\nbGljIHZvaWQgYWRkRXJyb3JDb2RlKGludCBlcnJvclR5cGUsIFN0cmluZyBl\ncnJvckNvZGUpIHsKICAgICAgICBpZiAoZXJyb3JDb2RlID09IG51bGwgfHwg\nZXJyb3JDb2RlLnRyaW0oKS5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgU2V0PFN0cmluZz4gY29kZXMgPSBzcWxTdGF0ZUNv\nZGVzLmdldChlcnJvclR5cGUpOwogICAgICAgIGlmIChjb2RlcyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIGNvZGVzID0gbmV3IEhhc2hTZXQ8U3RyaW5nPigp\nOwogICAgICAgICAgICBjb2Rlcy5hZGQoZXJyb3JDb2RlLnRyaW0oKSk7CiAg\nICAgICAgICAgIHNxbFN0YXRlQ29kZXMucHV0KGVycm9yVHlwZSwgY29kZXMp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvZGVzLmFkZChlcnJv\nckNvZGUudHJpbSgpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogRklYTUUgLSBPUEVOSlBBLTk1NyAtIGxvY2tUaW1lb3V0IGlzIGEg\nc2VydmVyLXNpZGUgZnVuY3Rpb24gYW5kCiAgICAgKiBzaG91bGRuJ3QgYmUg\ndXNpbmcgY2xpZW50LXNpZGUgc2V0UXVlcnlUaW1lb3V0IGZvciBsb2NrIHRp\nbWVvdXRzLgogICAgICogCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92\naWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAg\nKiBpbXBsZW1lbnRhdGlvbiBvZiBzZXR0aW5nIHF1ZXJ5IGFuZCBsb2NrIHRp\nbWVvdXRzLgogICAgICogCiAgICAgKiBAcGFyYW0gc3RtbnQKICAgICAqIEBw\nYXJhbSBmZXRjaCAtIG9wdGlvbmFsIGxvY2sgYW5kIHF1ZXJ5IHRpbWVvdXRz\nIGluIG1pbGxpc2Vjb25kcwogICAgICogQHBhcmFtIGZvclVwZGF0ZSAtIHRy\ndWUgaWYgd2Ugc2hvdWxkIGFsc28gdHJ5IHNldHRpbmcgYSBsb2NrIHRpbWVv\ndXQKICAgICAqIEB0aHJvd3MgU1FMRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFRpbWVvdXRzKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCAKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29s\nZWFuIGZvclVwZGF0ZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKHN1cHBvcnRzUXVlcnlUaW1lb3V0KSB7CiAgICAgICAgICAgIGludCB0\naW1lb3V0ID0gZmV0Y2guZ2V0UXVlcnlUaW1lb3V0KCk7CiAgICAgICAgICAg\nIGlmIChmb3JVcGRhdGUpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMg\naXMgYSBsb2NraW5nIHNlbGVjdCBhbmQgdGhlIGxvY2sgdGltZW91dCBpcyBn\ncmVhdGVyIAogICAgICAgICAgICAgICAgLy8gdGhhbiB0aGUgY29uZmlndXJl\nZCBxdWVyeSB0aW1lb3V0LCB1c2UgdGhlIGxvY2sgdGltZW91dAogICAgICAg\nICAgICAgICAgdGltZW91dCA9IE1hdGgubWF4KGZldGNoLmdldFF1ZXJ5VGlt\nZW91dCgpLCAKICAgICAgICAgICAgICAgICAgICBmZXRjaC5nZXRMb2NrVGlt\nZW91dCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRRdWVyeVRp\nbWVvdXQoc3RtbnQsIHRpbWVvdXQpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEZJWE1FIC0gT1BFTkpQQS05NTcgLSBsb2NrVGltZW91dCBp\ncyBhIHNlcnZlci1zaWRlIGZ1bmN0aW9uIGFuZAogICAgICogc2hvdWxkbid0\nIGJlIHVzaW5nIGNsaWVudC1zaWRlIHNldFF1ZXJ5VGltZW91dCBmb3IgbG9j\nayB0aW1lb3V0cy4KICAgICAqIAogICAgICogVGhpcyBtZXRob2QgaXMgdG8g\ncHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAog\nICAgICogaW1wbGVtZW50YXRpb24gb2Ygc2V0dGluZyBxdWVyeSBhbmQgbG9j\nayB0aW1lb3V0cy4KICAgICAqIAogICAgICogQHBhcmFtIHN0bW50CiAgICAg\nKiBAcGFyYW0gY29uZiAtIG9wdGlvbmFsIGxvY2sgYW5kIHF1ZXJ5IHRpbWVv\ndXRzIGluIG1pbGxpc2Vjb25kcwogICAgICogQHBhcmFtIGZvclVwZGF0ZSAt\nIHRydWUgaWYgd2Ugc2hvdWxkIGFsc28gdHJ5IHNldHRpbmcgYSBsb2NrIHRp\nbWVvdXQKICAgICAqIEB0aHJvd3MgU1FMRXhjZXB0aW9uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldFRpbWVvdXRzKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBKREJDQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIGJvb2xlYW4g\nZm9yVXBkYXRlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nc3VwcG9ydHNRdWVyeVRpbWVvdXQpIHsKICAgICAgICAgICAgaW50IHRpbWVv\ndXQgPSBjb25mLmdldFF1ZXJ5VGltZW91dCgpOwogICAgICAgICAgICBpZiAo\nZm9yVXBkYXRlKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEg\nbG9ja2luZyBzZWxlY3QgYW5kIHRoZSBsb2NrIHRpbWVvdXQgaXMgZ3JlYXRl\ncgogICAgICAgICAgICAgICAgLy8gdGhhbiB0aGUgY29uZmlndXJlZCBxdWVy\neSB0aW1lb3V0LCB1c2UgdGhlIGxvY2sgdGltZW91dAogICAgICAgICAgICAg\nICAgdGltZW91dCA9IE1hdGgubWF4KGNvbmYuZ2V0UXVlcnlUaW1lb3V0KCks\nIAogICAgICAgICAgICAgICAgICAgIGNvbmYuZ2V0TG9ja1RpbWVvdXQoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0UXVlcnlUaW1lb3V0KHN0\nbW50LCB0aW1lb3V0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQcm92aWRlcyB0aGUgZGVmYXVsdCB2YWxpZGF0aW9uIGhhbmRsaW5nIG9m\nIHNldHRpbmcgYSBxdWVyeSB0aW1lb3V0LgogICAgICogQHBhcmFtIHN0bW50\nCiAgICAgKiBAcGFyYW0gdGltZW91dCBpbiBtaWxsaXNlY29uZHMKICAgICAq\nIEB0aHJvd3MgU1FMRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFF1ZXJ5VGltZW91dChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIHRpbWVvdXQpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKHN1cHBvcnRzUXVlcnlUaW1lb3V0KSB7CiAgICAgICAgICAgIGlm\nICh0aW1lb3V0ID09IC0xKSB7CiAgICAgICAgICAgICAgICAvLyBzcGVjaWFs\nIE9wZW5KUEEgYWxsb3dlZCBjYXNlIGRlbm90aW5nIG5vIHRpbWVvdXQKICAg\nICAgICAgICAgICAgIHRpbWVvdXQgPSAwOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKHRpbWVvdXQgPCAwKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2Fybihf\nbG9jLmdldCgiaW52YWxpZC10aW1lb3V0IiwgbmV3IEludGVnZXIodGltZW91\ndCkpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBl\nbHNlIGlmICh0aW1lb3V0ID4gMCAmJiB0aW1lb3V0IDwgMTAwMCkgewogICAg\nICAgICAgICAgICAgLy8gcm91bmQgdXAgdG8gMSBzZWMKICAgICAgICAgICAg\nICAgIHRpbWVvdXQgPSAxMDAwOyAKICAgICAgICAgICAgICAgIGlmIChsb2cu\naXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy53YXJu\nKF9sb2MuZ2V0KCJtaWxsaXMtcXVlcnktdGltZW91dCIpKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBzZXRTdGF0ZW1lbnRRdWVyeVRpbWVvdXQoc3Rt\nbnQsIHRpbWVvdXQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEFsbG93IHN1YmNsYXNzZXMgdG8gcHJvdmlkZSBEQiB1bmlxdWUgb3ZlcnJp\nZGUgaW1wbGVtZW50YXRpb25zIG9mCiAgICAgKiBzZXR0aW5nIHF1ZXJ5IHRp\nbWVvdXRzLCB3aGlsZSBwcmVzZXJ2aW5nIHRoZSBkZWZhdWx0IHRpbWVvdXQg\nbG9naWMKICAgICAqIGluIHRoZSBwdWJsaWMgc2V0UXVlcnlUaW1lb3V0IG1l\ndGhvZC4KICAgICAqIEBwYXJhbSBzdG1udAogICAgICogQHBhcmFtIHRpbWVv\ndXQgaW4gbWlsbGlzZWNvbmRzCiAgICAgKiBAdGhyb3dzIFNRTEV4Y2VwdGlv\nbgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRTdGF0ZW1lbnRRdWVy\neVRpbWVvdXQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgIGlu\ndCB0aW1lb3V0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBK\nREJDIHVzZXMgc2Vjb25kcywgc28gd2UnbGwgZG8gYSBzaW1wbGUgcm91bmQt\nZG93biBjb252ZXJzaW9uIGhlcmUKICAgICAgICBzdG1udC5zZXRRdWVyeVRp\nbWVvdXQodGltZW91dCAvIDEwMDApOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25uZWN0aW9u\nRGVjb3JhdG9yIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogRGVjb3Jh\ndGUgdGhlIGdpdmVuIGNvbm5lY3Rpb24gaWYgbmVlZGVkLiBTb21lIGRhdGFi\nYXNlcyByZXF1aXJlIHNwZWNpYWwKICAgICAqIGhhbmRsaW5nIGZvciBKREJD\nIGJ1Z3MuIFRoaXMgaW1wbGVtZW50YXRpb24gaXNzdWVzIGFueQogICAgICog\ne0BsaW5rICNpbml0aWFsaXphdGlvblNRTH0gdGhhdCBoYXMgYmVlbiBzZXQg\nZm9yIHRoZSBkaWN0aW9uYXJ5IGJ1dAogICAgICogZG9lcyBub3QgZGVjb3Jh\ndGUgdGhlIGNvbm5lY3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBDb25uZWN0\naW9uIGRlY29yYXRlKENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWNvbm5lY3RlZCkKICAgICAg\nICAgICAgY29ubmVjdGVkQ29uZmlndXJhdGlvbihjb25uKTsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoaW5pdGlhbGl6YXRpb25TUUwpKSB7\nCiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gbnVsbDsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50ID0gY29u\nbi5wcmVwYXJlU3RhdGVtZW50KGluaXRpYWxpemF0aW9uU1FMKTsKICAgICAg\nICAgICAgICAgIHN0bW50LmV4ZWN1dGUoKTsKICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nZS50b1N0cmluZygpLCBlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0bW50LmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBjb25uOwogICAgfQoKICAgIC8q\nKgogICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhlCiAgICAgKiB7QGxpbmsg\nTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FMV2FybmluZ0hhbmRsZXJ9\nIGludGVyZmFjZQogICAgICogdGhhdCBhbGxvd3MgY3VzdG9taXphdGlvbiBv\nZiB0aGUgYWN0aW9ucyB0byBwZXJmb3JtIHdoZW4gYQogICAgICoge0BsaW5r\nIFNRTFdhcm5pbmd9IG9jY3VycyBhdCBhbnkgcG9pbnQgb24gYSB7QGxpbmsg\nQ29ubmVjdGlvbn0sCiAgICAgKiB7QGxpbmsgU3RhdGVtZW50fSwgb3Ige0Bs\naW5rIFJlc3VsdFNldH0uIFRoaXMgbWV0aG9kIG1heQogICAgICogYmUgdXNl\nZCBkZXRlcm1pbmUgdGhvc2Ugd2FybmluZ3MgdGhlIGFwcGxpY2F0aW9uIHdh\nbnRzIHRvCiAgICAgKiBjb25zaWRlciBjcml0aWNhbCBmYWlsdXJlcywgYW5k\nIHRocm93IHRoZSB3YXJuaW5nIGluIHRob3NlCiAgICAgKiBjYXNlcy4gQnkg\nZGVmYXVsdCwgdGhpcyBtZXRob2QgZG9lcyBub3RoaW5nLgogICAgICoKICAg\nICAqIEBzZWUgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3Ijc2V0V2Fybmlu\nZ0FjdGlvbgogICAgICogQHNlZSBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRv\nciNzZXRXYXJuaW5nSGFuZGxlcgogICAgICovCiAgICBwdWJsaWMgdm9pZCBo\nYW5kbGVXYXJuaW5nKFNRTFdhcm5pbmcgd2FybmluZykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIG5ldyBleGNlcHRpb24gdGhhdCB3cmFwcyA8Y29kZT5jYXVzZXM8L2Nv\nZGU+LgogICAgICogSG93ZXZlciwgdGhlIGRldGFpbHMgb2YgZXhhY3RseSB3\naGF0IHR5cGUgb2YgZXhjZXB0aW9uIGlzIHJldHVybmVkIGNhbgogICAgICog\nYmUgZGV0ZXJtaW5lZCBieSB0aGUgaW1wbGVtZW50YXRpb24uIFRoaXMgbWF5\nIHRha2UgaW50byBhY2NvdW50CiAgICAgKiBEQi1zcGVjaWZpYyBleGNlcHRp\nb24gaW5mb3JtYXRpb24gaW4gPGNvZGU+Y2F1c2VzPC9jb2RlPi4KICAgICAq\nLwogICAgcHVibGljIE9wZW5KUEFFeGNlcHRpb24gbmV3U3RvcmVFeGNlcHRp\nb24oU3RyaW5nIG1zZywgU1FMRXhjZXB0aW9uW10gY2F1c2VzLAogICAgICAg\nIE9iamVjdCBmYWlsZWQpIHsKICAgICAgICBpZiAoY2F1c2VzICE9IG51bGwg\nJiYgY2F1c2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgT3BlbkpQQUV4\nY2VwdGlvbiByZXQgPSBuYXJyb3cobXNnLCBjYXVzZXNbMF0pOwogICAgICAg\nICAgICByZXQuc2V0RmFpbGVkT2JqZWN0KGZhaWxlZCkuc2V0TmVzdGVkVGhy\nb3dhYmxlcyhjYXVzZXMpOwogICAgICAgICAgICByZXR1cm4gcmV0OwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9uKG1zZyku\nc2V0RmFpbGVkT2JqZWN0KGZhaWxlZCkuCiAgICAgICAgICAgIHNldE5lc3Rl\nZFRocm93YWJsZXMoY2F1c2VzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBHZXRzIHRoZSBzdWJ0eXBlIG9mIFN0b3JlRXhjZXB0aW9uIGJ5IG1hdGNo\naW5nIHRoZSBnaXZlbiBTUUxFeGNlcHRpb24ncwogICAgICogZXJyb3Igc3Rh\ndGUgY29kZSB0byB0aGUgbGlzdCBvZiBlcnJvciBjb2RlcyBzdXBwbGllZCBi\neSB0aGUgZGljdGlvbmFyeS4KICAgICAqIFJldHVybnMgLTEgaWYgbm8gbWF0\nY2hpbmcgY29kZSBjYW4gYmUgZm91bmQuCiAgICAgKi8KICAgIE9wZW5KUEFF\neGNlcHRpb24gbmFycm93KFN0cmluZyBtc2csIFNRTEV4Y2VwdGlvbiBleCkg\newogICAgICAgIEJvb2xlYW4gcmVjb3ZlcmFibGUgPSBudWxsOwogICAgICAg\nIGludCBlcnJvclR5cGUgPSBTdG9yZUV4Y2VwdGlvbi5HRU5FUkFMOwogICAg\nICAgIGZvciAoSW50ZWdlciB0eXBlIDogc3FsU3RhdGVDb2Rlcy5rZXlTZXQo\nKSkgewogICAgICAgICAgICBTZXQ8U3RyaW5nPiBlcnJvclN0YXRlcyA9IHNx\nbFN0YXRlQ29kZXMuZ2V0KHR5cGUpOwogICAgICAgICAgICBpZiAoZXJyb3JT\ndGF0ZXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmVjb3ZlcmFibGUg\nPSBtYXRjaEVycm9yU3RhdGUodHlwZSwgZXJyb3JTdGF0ZXMsIGV4KTsKICAg\nICAgICAgICAgICAgIGlmIChyZWNvdmVyYWJsZSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgZXJyb3JUeXBlID0gdHlwZTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBTdG9yZUV4Y2VwdGlvbiBzdG9yZUV4Owog\nICAgICAgIHN3aXRjaCAoZXJyb3JUeXBlKSB7CiAgICAgICAgY2FzZSBTdG9y\nZUV4Y2VwdGlvbi5MT0NLOgogICAgICAgICAgICBzdG9yZUV4ID0gbmV3IExv\nY2tFeGNlcHRpb24obXNnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nY2FzZSBTdG9yZUV4Y2VwdGlvbi5PQkpFQ1RfRVhJU1RTOgogICAgICAgICAg\nICBzdG9yZUV4ID0gbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihtc2cpOwog\nICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFN0b3JlRXhjZXB0aW9u\nLk9CSkVDVF9OT1RfRk9VTkQ6CiAgICAgICAgICAgIHN0b3JlRXggPSBuZXcg\nT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24obXNnKTsKICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgY2FzZSBTdG9yZUV4Y2VwdGlvbi5PUFRJTUlTVElDOgog\nICAgICAgICAgICBzdG9yZUV4ID0gbmV3IE9wdGltaXN0aWNFeGNlcHRpb24o\nbXNnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBTdG9yZUV4\nY2VwdGlvbi5SRUZFUkVOVElBTF9JTlRFR1JJVFk6CiAgICAgICAgICAgIHN0\nb3JlRXggPSBuZXcgUmVmZXJlbnRpYWxJbnRlZ3JpdHlFeGNlcHRpb24obXNn\nKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBTdG9yZUV4Y2Vw\ndGlvbi5RVUVSWToKICAgICAgICAgICAgc3RvcmVFeCA9IG5ldyBRdWVyeUV4\nY2VwdGlvbihtc2cpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICBzdG9yZUV4ID0gbmV3IFN0b3JlRXhjZXB0aW9u\nKG1zZyk7CiAgICAgICAgfQogICAgICAgIGlmIChyZWNvdmVyYWJsZSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIHN0b3JlRXguc2V0RmF0YWwoIXJlY292ZXJh\nYmxlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0b3JlRXg7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIFNRTEV4Y2VwdGlv\nbiBhcmd1bWVudCBtYXRjaGVzIGFueSBlbGVtZW50IGluIHRoZQogICAgICog\nZXJyb3JTdGF0ZXMuIERpY3Rpb25hcnkgc3ViY2xhc3MgY2FuIG92ZXJyaWRl\nIHRoaXMgbWV0aG9kIGFuZCBleHRyYWN0CiAgICAgKiBTUUxFeGNlcHRpb24g\nZGF0YSB0byBmaWd1cmUgb3V0IGlmIHRoZSBleGNlcHRpb24gaXMgcmVjb3Zl\ncmFibGUuCiAgICAgKiAKICAgICAqIEByZXR1cm4gbnVsbCBpZiBubyBtYXRj\naCBpcyBmb3VuZCBvciBhIEJvb2xlYW4gdmFsdWUgaW5kaWNhdGVzIHRoZQog\nICAgICogZXhjZXB0aW9uIGlzIHJlY292ZXJhYmxlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgQm9vbGVhbiBtYXRjaEVycm9yU3RhdGUoaW50IHN1YnR5cGUs\nIFNldDxTdHJpbmc+IGVycm9yU3RhdGVzLAogICAgICAgIFNRTEV4Y2VwdGlv\nbiBleCkgewogICAgICAgIFN0cmluZyBlcnJvclN0YXRlID0gZXguZ2V0U1FM\nU3RhdGUoKTsKICAgICAgICByZXR1cm4gZXJyb3JTdGF0ZXMuY29udGFpbnMo\nZXJyb3JTdGF0ZSkgPyBCb29sZWFuLkZBTFNFIDogbnVsbDsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBDbG9zZXMgdGhlIHNwZWNpZmllZCB7QGxpbmsg\nRGF0YVNvdXJjZX0gYW5kIHJlbGVhc2VzIGFueQogICAgICogcmVzb3VyY2Vz\nIGFzc29jaWF0ZWQgd2l0aCBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0\nYVNvdXJjZSB0aGUgRGF0YVNvdXJjZSB0byBjbG9zZQogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBjbG9zZURhdGFTb3VyY2UoRGF0YVNvdXJjZSBkYXRhU291\ncmNlKSB7CiAgICAgICAgRGF0YVNvdXJjZUZhY3RvcnkuY2xvc2VEYXRhU291\ncmNlKGRhdGFTb3VyY2UpOwogICAgfQoKICAgIC8qKgogICAgICogVXNlZCBi\neSBzb21lIG1hcHBpbmdzIHRvIHJlcHJlc2VudCBkYXRhIHRoYXQgaGFzIGFs\ncmVhZHkgYmVlbgogICAgICogc2VyaWFsaXplZCBzbyB0aGF0IHdlIGRvbid0\nIGhhdmUgdG8gc2VyaWFsaXplIG11bHRpcGxlIHRpbWVzLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGNsYXNzIFNlcmlhbGl6ZWREYXRhIHsKCiAgICAg\nICAgcHVibGljIGZpbmFsIGJ5dGVbXSBieXRlczsKCiAgICAgICAgcHVibGlj\nIFNlcmlhbGl6ZWREYXRhKGJ5dGVbXSBieXRlcykgewogICAgICAgICAgICB0\naGlzLmJ5dGVzID0gYnl0ZXM7CiAgICAgICAgfQogICAgfQogICAgCiAgICAv\nKioKICAgICAqIFJldHVybiB2ZXJzaW9uIGNvbHVtbiBuYW1lCiAgICAgKiBA\ncGFyYW0gY29sdW1uCiAgICAgKiBAcGFyYW0gdGFibGVBbGlhcyA6IHRoaXMg\naXMgbmVlZGVkIGZvciBwbGF0Zm9ybSBzcGVjaWZpYyB2ZXJzaW9uIGNvbHVt\nbgogICAgICogQHJldHVybgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndFZlcnNpb25Db2x1bW4oQ29sdW1uIGNvbHVtbiwgU3RyaW5nIHRhYmxlQWxp\nYXMpIHsKICAgICAgICByZXR1cm4gY29sdW1uLnRvU3RyaW5nKCk7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyB2b2lkIGluc2VydEJsb2JGb3JTdHJlYW1pbmdM\nb2FkKFJvdyByb3csIENvbHVtbiBjb2wsIAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgT2JqZWN0IG9iLCBTZWxlY3Qgc2VsKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAob2IgIT0gbnVsbCkgewogICAgICAgICAgICBy\nb3cuc2V0QmluYXJ5U3RyZWFtKGNvbCwgCiAgICAgICAgICAgICAgICBuZXcg\nQnl0ZUFycmF5SW5wdXRTdHJlYW0obmV3IGJ5dGVbMF0pLCAwKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICByb3cuc2V0TnVsbChjb2wpOwogICAg\nICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgaW5zZXJ0Q2xvYkZv\nclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1uIGNvbCwgT2JqZWN0IG9i\nKQogICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9iICE9\nIG51bGwpIHsKICAgICAgICByb3cuc2V0Q2hhcmFjdGVyU3RyZWFtKGNvbCwK\nICAgICAgICAgICAgICAgIG5ldyBDaGFyQXJyYXlSZWFkZXIobmV3IGNoYXJb\nMF0pLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cuc2V0\nTnVsbChjb2wpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZv\naWQgdXBkYXRlQmxvYihTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUsIElu\ncHV0U3RyZWFtIGlzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBzZWwudG9TZWxlY3QodHJ1ZSwgc3Rv\ncmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkpOwogICAgICAgIFJlc3VsdFNl\ndCByZXMgPSBudWxsOwogICAgICAgIENvbm5lY3Rpb24gY29ubiA9IHN0b3Jl\nLmdldENvbm5lY3Rpb24oKTsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RtbnQg\nPSBzcWwucHJlcGFyZVN0YXRlbWVudChjb25uLCBzdG9yZS5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIFJlc3VsdFNldC5UWVBF\nX1NDUk9MTF9TRU5TSVRJVkUsCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQu\nQ09OQ1VSX1VQREFUQUJMRSk7CiAgICAgICAgICAgIHNldFRpbWVvdXRzKHN0\nbW50LCBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSwgdHJ1ZSk7CiAg\nICAgICAgICAgIHJlcyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAg\nICAgICBpZiAoIXJlcy5uZXh0KCkpIHsKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdldCgic3RyZWFtLWV4Y2Vw\ndGlvbiIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBCbG9iIGJsb2Ig\nPSByZXMuZ2V0QmxvYigxKTsKICAgICAgICAgICAgT3V0cHV0U3RyZWFtIG9z\nID0gYmxvYi5zZXRCaW5hcnlTdHJlYW0oMSk7CiAgICAgICAgICAgIGNvcHko\naXMsIG9zKTsKICAgICAgICAgICAgb3MuY2xvc2UoKTsKICAgICAgICAgICAg\ncmVzLnVwZGF0ZUJsb2IoMSwgYmxvYik7CiAgICAgICAgICAgIHJlcy51cGRh\ndGVSb3coKTsKCiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihpb2UpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJlcy5jbG9zZSAoKTsgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UgKCk7\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7fQogICAgICAgICAgICBpZiAo\nY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9z\nZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQog\nICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCB1cGRhdGVDbG9iKFNlbGVjdCBz\nZWwsIEpEQkNTdG9yZSBzdG9yZSwgUmVhZGVyIHJlYWRlcikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTUUxCdWZmZXIgc3FsID0g\nc2VsLnRvU2VsZWN0KHRydWUsIHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlv\nbigpKTsKICAgICAgICBSZXN1bHRTZXQgcmVzID0gbnVsbDsKICAgICAgICBD\nb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAg\nICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHN0bW50ID0gc3FsLnByZXBhcmVTdGF0ZW1lbnQo\nY29ubiwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCksCiAgICAgICAg\nICAgICAgICBSZXN1bHRTZXQuVFlQRV9TQ1JPTExfU0VOU0lUSVZFLAogICAg\nICAgICAgICAgICAgUmVzdWx0U2V0LkNPTkNVUl9VUERBVEFCTEUpOwogICAg\nICAgICAgICBzZXRUaW1lb3V0cyhzdG1udCwgc3RvcmUuZ2V0RmV0Y2hDb25m\naWd1cmF0aW9uKCksIHRydWUpOwogICAgICAgICAgICByZXMgPSBzdG1udC5l\neGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAgaWYgKCFyZXMubmV4dCgpKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24o\nX2xvYy5nZXQoInN0cmVhbS1leGNlcHRpb24iKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgQ2xvYiBjbG9iID0gcmVzLmdldENsb2IoMSk7CiAgICAg\nICAgICAgIFdyaXRlciB3cml0ZXIgPSBjbG9iLnNldENoYXJhY3RlclN0cmVh\nbSgxKTsKICAgICAgICAgICAgY29weShyZWFkZXIsIHdyaXRlcik7CiAgICAg\nICAgICAgIHdyaXRlci5jbG9zZSgpOwogICAgICAgICAgICByZXMudXBkYXRl\nQ2xvYigxLCBjbG9iKTsKICAgICAgICAgICAgcmVzLnVwZGF0ZVJvdygpOwoK\nICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKSAKICAgICAg\nICAgICAgICAgIHRyeSB7IHJlcy5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKSAK\nICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlICgpOyB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICAgICAgaWYgKGNvbm4gIT0g\nbnVsbCkgCiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlICgpOyB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICB9ICAgIAogICAg\nfQogICAgCiAgICBwcm90ZWN0ZWQgbG9uZyBjb3B5KElucHV0U3RyZWFtIGlu\nLCBPdXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIGJ5dGVbXSBjb3B5QnVmZmVyID0gbmV3IGJ5dGVbYmxvYkJ1ZmZlclNp\nemVdOwogICAgICAgIGxvbmcgYnl0ZXNDb3BpZWQgPSAwOwogICAgICAgIGlu\ndCByZWFkID0gLTE7CgogICAgICAgIHdoaWxlICgocmVhZCA9IGluLnJlYWQo\nY29weUJ1ZmZlciwgMCwgY29weUJ1ZmZlci5sZW5ndGgpKSAhPSAtMSkgewog\nICAgICAgICAgICBvdXQud3JpdGUoY29weUJ1ZmZlciwgMCwgcmVhZCk7CiAg\nICAgICAgICAgIGJ5dGVzQ29waWVkICs9IHJlYWQ7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBieXRlc0NvcGllZDsKICAgIH0KICAgIAogICAgcHJvdGVj\ndGVkIGxvbmcgY29weShSZWFkZXIgcmVhZGVyLCBXcml0ZXIgd3JpdGVyKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoYXJbXSBjb3B5QnVmZmVy\nID0gbmV3IGNoYXJbY2xvYkJ1ZmZlclNpemVdOwogICAgICAgIGxvbmcgYnl0\nZXNDb3BpZWQgPSAwOwogICAgICAgIGludCByZWFkID0gLTE7CgogICAgICAg\nIHdoaWxlICgocmVhZCA9IHJlYWRlci5yZWFkKGNvcHlCdWZmZXIsIDAsIGNv\ncHlCdWZmZXIubGVuZ3RoKSkgIT0gLTEpIHsKICAgICAgICAgICAgd3JpdGVy\nLndyaXRlKGNvcHlCdWZmZXIsIDAsIHJlYWQpOwogICAgICAgICAgICBieXRl\nc0NvcGllZCArPSByZWFkOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJ5\ndGVzQ29waWVkOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEF0dGFjaCBD\nQVNUIHRvIHRoZSBjdXJyZW50IGZ1bmN0aW9uIGlmIG5lY2Vzc2FyeQogICAg\nICogCiAgICAgKiBAcGFyYW0gdmFsIG9wZXJhbmQgdmFsdWUKICAgICAqIEBw\nYXJtYSBmdW5jIHRoZSBzcWwgZnVuY3Rpb24gc3RhdGVtZW50CiAgICAgKiBA\ncmV0dXJuIGEgU3RyaW5nIHdpdGggdGhlIGNvcnJlY3QgQ0FTVCBmdW5jdGlv\nbiBzeW50YXgKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDYXN0RnVu\nY3Rpb24oVmFsIHZhbCwgU3RyaW5nIGZ1bmMpIHsKICAgICAgICByZXR1cm4g\nZnVuYzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gaW5k\nZXggaWYgbmVjZXNzYXJ5IGZvciBzb21lIGRhdGFiYXNlIHRhYmxlcwogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjcmVhdGVJbmRleElmTmVjZXNzYXJ5KFNj\naGVtYSBzY2hlbWEsIFN0cmluZyB0YWJsZSwKICAgICAgICAgICAgQ29sdW1u\nIHBrQ29sdW1uKSB7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBiYXRjaExpbWl0CiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0QmF0\nY2hMaW1pdCgpewogICAgICAgIHJldHVybiBiYXRjaExpbWl0OwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIFNldCB0aGUgYmF0Y2hMaW1pdCB2YWx1ZQog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCYXRjaExpbWl0KGludCBsaW1p\ndCl7CiAgICAgICAgYmF0Y2hMaW1pdCA9IGxpbWl0OwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFZhbGlkYXRlIHRoZSBiYXRjaCBwcm9jZXNzLiBJbiBz\nb21lIGNhc2VzLCB3ZSBjYW4ndCBiYXRjaCB0aGUgc3RhdGVtZW50cwogICAg\nICogZHVlIHRvIHNvbWUgcmVzdHJpY3Rpb25zLiBGb3IgZXhhbXBsZSwgaWYg\ndGhlIEdlbmVyYXRlZFR5cGU9SURFTlRJVFksCiAgICAgKiB3ZSBoYXZlIHRv\nIGRpc2FibGUgdGhlIGJhdGNoIHByb2Nlc3MgYmVjYXVzZSB3ZSBuZWVkIHRv\nIGdldCB0aGUgSUQgdmFsdWUKICAgICAqIHJpZ2h0IGF3YXkgZm9yIHRoZSBp\nbi1tZW1vcnkgZW50aXR5IHRvIHVzZS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gdmFsaWRhdGVCYXRjaFByb2Nlc3MoUm93SW1wbCByb3csIENvbHVt\nbltdIGF1dG9Bc3NpZ24sCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgIHNtLCBDbGFzc01hcHBpbmcgY21kICkgewogICAgICAgIGJvb2xlYW4g\nZGlzYWJsZUJhdGNoID0gZmFsc2U7CiAgICAgICAgaWYgKGdldEJhdGNoTGlt\naXQoKT09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoYXV0b0Fzc2ln\nbiAhPSBudWxsICYmIHNtICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZCA9IGNtZC5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAg\nICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgd2hpbGUgKCFkaXNh\nYmxlQmF0Y2ggJiYgaSA8IGZtZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAg\nIGlmIChmbWRbaV0uZ2V0VmFsdWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRl\nZ2llcy5BVVRPQVNTSUdOKQogICAgICAgICAgICAgICAgICAgIGRpc2FibGVC\nYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgLy8gZ28gdG8gZWFjaCBEaWN0aW9uYXJ5\nIHRvIHZhbGlkYXRlIHRoZSBiYXRjaCBjYXBhYmlsaXR5CiAgICAgICAgaWYg\nKCFkaXNhYmxlQmF0Y2gpCiAgICAgICAgICAgIGRpc2FibGVCYXRjaCA9IHZh\nbGlkYXRlREJTcGVjaWZpY0JhdGNoUHJvY2VzcyhkaXNhYmxlQmF0Y2gsIHJv\ndywgCiAgICAgICAgICAgICAgICBhdXRvQXNzaWduLCBzbSwgY21kKTsKICAg\nICAgICByZXR1cm4gZGlzYWJsZUJhdGNoOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEFsbG93IGVhY2ggRGljdGlvbmFyeSB0byB2YWxpZGF0ZSBpdHMg\nb3duIGJhdGNoIHByb2Nlc3MuIAogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiB2YWxpZGF0ZURCU3BlY2lmaWNCYXRjaFByb2Nlc3MgKGJvb2xlYW4gZGlz\nYWJsZUJhdGNoLCAKICAgICAgICAgICAgUm93SW1wbCByb3csIENvbHVtbltd\nIGF1dG9Bc3NpZ24sIAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nICBzbSwgQ2xhc3NNYXBwaW5nIGNtZCApIHsKICAgICAgICByZXR1cm4gZGlz\nYWJsZUJhdGNoOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpE\nQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyBx\ndWVyeS4KICAgICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRl\nUXVlcnkoQ29ubmVjdGlvbiBjb25uLCBQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwKICAgICAgICAgICAgU3RyaW5nIHNxbCAKICAgICAgICApIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVl\ncnkoKTsKICAgIH0KICAgICAgICAgICAgCiAgICAvKioKICAgICAqIFRoaXMg\nbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9y\nIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHByZXBhcmlu\nZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0\nYXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubiwgU3Ry\naW5nIHNxbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gY29ubi5wcmVwYXJlU3RhdGVtZW50KHNxbCk7CiAgICB9ICAg\nIAogCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUg\nb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGlt\ncGxlbWVudGF0aW9uIG9mIGdldHRpbmcgc2VxdWVuY2UgZnJvbSB0aGUgcmVz\ndWx0IHNldC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNlcXVlbmNlW10gZ2V0\nU2VxdWVuY2UoUmVzdWx0U2V0IHJzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBMaXN0IHNlcUxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAg\nICAgd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAg\nICBzZXFMaXN0LmFkZChuZXdTZXF1ZW5jZShycykpOwogICAgICAgIHJldHVy\nbiAoU2VxdWVuY2VbXSkgc2VxTGlzdC50b0FycmF5KG5ldyBTZXF1ZW5jZVtz\nZXFMaXN0LnNpemUoKV0pOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRo\naXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJD\nIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRp\nbmcga2V5IGZyb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBPYmplY3QgZ2V0S2V5IChSZXN1bHRTZXQgcnMsIENvbHVtbiBjb2wp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghcnMubmV4dCgp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLWdlbmtleSIpKTsKICAgICAgICBPYmplY3Qga2V5ID0gcnMuZ2V0\nT2JqZWN0KDEpOwogICAgICAgIGlmIChrZXkgPT0gbnVsbCkKICAgICAgICAg\nICAgbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQtZ2Vua2V5IiwgY29sKSk7\nCiAgICAgICAgcmV0dXJuIGtleTsgICAgICAgIAogICAgfQogICAgCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUg\nZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0\naW9uIG9mIGNhbGN1bGF0aW5nIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBjYWxjdWxhdGVWYWx1ZShWYWwgdmFsLCBTZWxlY3Qgc2VsLCBF\neHBDb250ZXh0IGN0eCwgCiAgICAgICAgRXhwU3RhdGUgc3RhdGUsIFBhdGgg\ncGF0aCwgRXhwU3RhdGUgcGF0aFN0YXRlKSB7CiAgICAgICAgdmFsLmNhbGN1\nbGF0ZVZhbHVlKHNlbCwgY3R4LCBzdGF0ZSwgKFZhbCkgcGF0aCwgcGF0aFN0\nYXRlKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB3aGV0aGVy\nIHRoZSBwcm92aWRlZCA8Y29kZT5zcWw8L2NvZGU+IG1heSBiZSB0cmVhdGVk\nIGFzIGEgCiAgICAgKiBzZWxlY3Qgc3RhdGVtZW50IG9uIHRoaXMgZGF0YWJh\nc2UuCiAgICAgKiAgCiAgICAgKiBAcGFyYW0gc3FsICAgQSBzcWwgc3RhdGVt\nZW50LiAKICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIDxjb2RlPnNx\nbDwvY29kZT4gcmVwcmVzZW50cyBhIHNlbGVjdCBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzU2VsZWN0KFN0cmluZyBzcWwpIHsK\nICAgICAgICBJdGVyYXRvciBpID0gc2VsZWN0V29yZFNldC5pdGVyYXRvcigp\nOwogICAgICAgIFN0cmluZyBjdXI7CiAgICAgICAgd2hpbGUgKGkuaGFzTmV4\ndCgpKSB7CiAgICAgICAgICAgIGN1ciA9IChTdHJpbmcpIGkubmV4dCgpOwog\nICAgICAgICAgICBpZiAoc3FsLmxlbmd0aCgpID49IGN1ci5sZW5ndGgoKQog\nICAgICAgICAgICAgICAgICAgICYmIHNxbC5zdWJzdHJpbmcoMCwgY3VyLmxl\nbmd0aCgpKS5lcXVhbHNJZ25vcmVDYXNlKGN1cikpIHsKICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBu\nZWVkc1RvQ3JlYXRlSW5kZXgoSW5kZXggaWR4LCBUYWJsZSB0YWJsZSkgewog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGJhdGNoZWQgc3RhdGVtZW50cyB1cGRhdGUgc3VjY2VzIGNvdW50CiAg\nICAgKiBAcGFyYW0gcHMgQSBQcmVwYXJlZFN0YXRlbWVudAogICAgICogQHJl\ndHVybiByZXR1cm4gdXBkYXRlIGNvdW50CiAgICAgKi8KICAgIHB1YmxpYyBp\nbnQgZ2V0QmF0Y2hVcGRhdGVDb3VudChQcmVwYXJlZFN0YXRlbWVudCBwcykg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBib29sZWFuIGdldFRyaW1TY2hlbWFOYW1lKCkg\neyAKICAgICAgICByZXR1cm4gdHJpbVNjaGVtYU5hbWU7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyB2b2lkIHNldFRyaW1TY2hlbWFOYW1lKGJvb2xlYW4gdHJp\nbVNjaGVtYU5hbWUpIHsgCiAgICAgICAgdGhpcy50cmltU2NoZW1hTmFtZSA9\nIHRyaW1TY2hlbWFOYW1lOyAKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQg\nZGVsZXRlU3RyZWFtKEpEQkNTdG9yZSBzdG9yZSwgU2VsZWN0IHNlbCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gRG8gbm90aGluZwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIGdpdmVu\nIG5hbWUgaXMgbm8gbG9uZ2VyIHRoYW4gZ2l2ZW4gbWF4aW11bSBsZW5ndGgu\nCiAgICAgKiBJZiB0aGUgZ2l2ZW4gbmFtZSBpcyBpbmRlZWQgbG9uZ2VyIHRo\nZW4gcmFpc2VzIGFuIFVzZXJFeGNlcHRpb24gd2l0aCB0aGUgCiAgICAgKiBn\naXZlbiBtZXNzYWdlIGtleSBvdGhlcndpc2UgcmV0dXJucyB0aGUgc2FtZSBu\nYW1lLgogICAgICovCiAgICBmaW5hbCBTdHJpbmcgY2hlY2tOYW1lTGVuZ3Ro\nKFN0cmluZyBuYW1lLCBpbnQgbGVuZ3RoLCBTdHJpbmcgbXNnS2V5KSB7CiAg\nICAgICAgaWYgKG5hbWUubGVuZ3RoKCkgPiBsZW5ndGgpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KG1zZ0tleSwgbmFt\nZSwgbmFtZS5sZW5ndGgoKSwgCiAgICAgICAgICAgICAgICAgICAgbGVuZ3Ro\nKSk7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBTdHJpbmcgZGVsaW1pdFN0cmluZyhTdHJpbmcgbmFtZSwgREJJZGVudGlm\naWVycyB0eXBlKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\nbmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIGlmICghZ2V0U3VwcG9ydHNEZWxpbWl0ZWRJZHMo\nKSkgewogICAgICAgICAgICAvLyBUT0RPOiBsb2cgKG9yIG1heWJlIGxvZyBp\nbiB0aGUgbWV0aG9kIGl0c2VsZjsgc28gbWF5YmUKICAgICAgICAgICAgLy8g\nbWVyZ2Ugd2l0aCBuZXh0IGlmIHN0bXQKICAgICAgICAgICAgcmV0dXJuIG5h\nbWU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICghZGVsaW1pdElk\ncykgewogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICB9CiAgICAg\nICAgLy8gVE9ETzogbWVyZ2Ugd2l0aCBpZiBzdG10IGFib3ZlIChtYXliZSBu\nb3QsIG1heSB3YW50IHRvIGxvZyB0aGlzKQogICAgICAgIGlmICghc3VwcG9y\ndHNEZWxpbWl0ZWRJZCh0eXBlKSkgewogICAgICAgICAgICAvLyBUT0RPOiBs\nb2cKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICAgICAgfQogICAgICAg\nIFN0cmluZyBkZWxpbWl0ZWRTdHJpbmcgPSBkZWxpbWl0ZXIgKyBuYW1lICsg\nZGVsaW1pdGVyOwogICAgICAgIHJldHVybiBkZWxpbWl0ZWRTdHJpbmc7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSB1bnN1cHBvcnRlZERl\nbGltaXRlZElkcwogICAgICovCiAgICBwcm90ZWN0ZWQgRW51bVNldDxEQklk\nZW50aWZpZXJzPiBnZXRVbnN1cHBvcnRlZERlbGltaXRlZElkcygpIHsKICAg\nICAgICByZXR1cm4gdW5zdXBwb3J0ZWREZWxpbWl0ZWRJZHM7CiAgICB9CiAg\nICAKICAgIHByb3RlY3RlZCBib29sZWFuIHN1cHBvcnRzRGVsaW1pdGVkSWQo\nREJJZGVudGlmaWVycyB0eXBlKSB7CiAgICAgICAgaWYgKGdldFVuc3VwcG9y\ndGVkRGVsaW1pdGVkSWRzKCkuY29udGFpbnModHlwZSkpIHsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4gdGhlIGRlbGltaXRl\ncgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldERlbGltaXRlcigpIHsK\nICAgICAgICByZXR1cm4gZGVsaW1pdGVyOwogICAgfQogICAgCiAgICBwcm90\nZWN0ZWQgU3RyaW5nIGdldERlbGltaXRlZENhc2UoKSB7CiAgICAgICAgcmV0\ndXJuIGRlbGltaXRlZENhc2U7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQg\nc2V0RGVsaW1pdGVkQ2FzZShEYXRhYmFzZU1ldGFEYXRhIG1ldGFEYXRhKSB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKG1ldGFEYXRhLnN0b3Jl\nc01peGVkQ2FzZVF1b3RlZElkZW50aWZpZXJzKCkpIHsKICAgICAgICAgICAg\nICAgIGRlbGltaXRlZENhc2UgPSBTQ0hFTUFfQ0FTRV9QUkVTRVJWRTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChtZXRhRGF0YS5zdG9y\nZXNVcHBlckNhc2VRdW90ZWRJZGVudGlmaWVycygpKSB7CiAgICAgICAgICAg\nICAgICBkZWxpbWl0ZWRDYXNlID0gU0NIRU1BX0NBU0VfVVBQRVI7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobWV0YURhdGEuc3RvcmVz\nTG93ZXJDYXNlUXVvdGVkSWRlbnRpZmllcnMoKSkgewogICAgICAgICAgICAg\nICAgZGVsaW1pdGVkQ2FzZSA9IFNDSEVNQV9DQVNFX0xPV0VSOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgLy8gVE9ETyBsb2cgdGhpcwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBzdXBwb3J0c0RlbGltaXRl\nZElkcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTdXBwb3J0c0Rl\nbGltaXRlZElkcygpIHsKICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWxpbWl0\nZWRJZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0gc3VwcG9ydHNE\nZWxpbWl0ZWRJZHMgdGhlIHN1cHBvcnRzRGVsaW1pdGVkSWRzIHRvIHNldAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdXBwb3J0c0RlbGltaXRlZElk\ncyhEYXRhYmFzZU1ldGFEYXRhIG1ldGFEYXRhKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgc3VwcG9ydHNEZWxpbWl0ZWRJZHMgPSAKICAgICAgICAg\nICAgICAgIG1ldGFEYXRhLnN1cHBvcnRzTWl4ZWRDYXNlUXVvdGVkSWRlbnRp\nZmllcnMoKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAvLyBUT0RPIGxvZyB0aGlzLCBvciBzaG91bGQgd2UgdGhy\nb3cgYW4gZXhjZXB0aW9uPwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEByZXR1cm4gdGhlIGRlbGltaXRJZHMKICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gaXNEZWxpbWl0SWRzKCkgewogICAgICAgIHJldHVybiBkZWxp\nbWl0SWRzOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIGRlbGltaXRJ\nZHMgdGhlIGRlbGltaXRJZHMgdG8gc2V0CiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldERlbGltaXRJZHMoYm9vbGVhbiBkZWxpbWl0SWRzKSB7CiAgICAg\nICAgdGhpcy5kZWxpbWl0SWRzID0gZGVsaW1pdElkczsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBAcmV0dXJuIHN1cHBvcnRzWE1MQ29sdW1uCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN1cHBvcnRzWE1MQ29sdW1uKCkg\newogICAgICAgIHJldHVybiBzdXBwb3J0c1hNTENvbHVtbjsKICAgIH0KCiAg\nICAvKioKICAgICAqIEBwYXJhbSBiIGJvb2xlYW4gcmVwcmVzZW50aW5nIGlm\nIFhNTCBjb2x1bW5zIGFyZSBzdXBwb3J0ZWQKICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0U3VwcG9ydHNYTUxDb2x1bW4oYm9vbGVhbiBiKSB7CiAgICAg\nICAgc3VwcG9ydHNYTUxDb2x1bW4gPSBiOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEByZXR1cm4geG1sVHlwZUVuY29kaW5nCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0WE1MVHlwZUVuY29kaW5nKCkgewogICAgICAgIHJl\ndHVybiB4bWxUeXBlRW5jb2Rpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBA\ncGFyYW0gZW5jb2RpbmcgZGF0YWJhc2UgcmVxdWlyZWQgSkFYQiBlbmNvZGlu\nZyBmb3IgdGhlIFhNTCB2YWx1ZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRYTUxUeXBlRW5jb2RpbmcoU3RyaW5nIGVuY29kaW5nKSB7CiAgICAgICAg\neG1sVHlwZUVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICB9CiAgICAKICAgIC8v\nIFRPRE86IFNob3VsZCB3ZSBwYXNzIGluIGNvbWJpbmluZyBjaGFyLCBvciBq\ndXN0IGFzc3VtZSAnXyc/CiAgICBwdWJsaWMgU3RyaW5nIGNvbWJpbmVOYW1l\ncyhTdHJpbmcuLi4gbmFtZXMpIHsKICAgICAgICBib29sZWFuIGRlbGltaXRl\nZCA9IGZhbHNlOwogICAgICAgIFN0cmluZyBjb21iaW5lZCA9IG51bGw7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBTdHJpbmcgbmFtZSA9IG5hbWVzW2ldOwogICAgICAg\nICAgICBpZiAoaXNEZWxpbWl0ZWQobmFtZSkpIHsKICAgICAgICAgICAgICAg\nIGRlbGltaXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBuYW1lID0gc3Ry\naXBEZWxpbWl0ZXJzKG5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChpID09IDApIHsKICAgICAgICAgICAgICAgIGNvbWJpbmVkID0gbmFt\nZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIGNvbWJpbmVkID0gY29tYmluZWQgKyAiXyIgKyBuYW1lOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChkZWxp\nbWl0ZWQpIHsKICAgICAgICAgICAgY29tYmluZWQgPSBhZGREZWxpbWl0ZXJz\nKGNvbWJpbmVkKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJu\nIGNvbWJpbmVkOwogICAgfQogICAgCiAgICBwdWJsaWMgTG9nIGdldExvZygp\nIHsgCiAgICAgICAgcmV0dXJuIGxvZzsKICAgIH0KfQo=\n","encoding":"base64"}

