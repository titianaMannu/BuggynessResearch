{"sha":"e20cbf1447f068588781b5b4e1c27af24ea25f86","node_id":"MDQ6QmxvYjIwNjM2NDplMjBjYmYxNDQ3ZjA2ODU4ODc4MWI1YjRlMWMyN2FmMjRlYTI1Zjg2","size":47393,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e20cbf1447f068588781b5b4e1c27af24ea25f86","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc3FsLkJs\nb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRp\nbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9y\ndCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9y\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkZpbHRlclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5KYXZhU1FMVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TZXF1ZW5jZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nRGF0YWJhc2VNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxl\nZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKaW1wb3J0IHNlcnAu\ndXRpbC5OdW1iZXJzOwoKLyoqCiAqIERpY3Rpb25hcnkgZm9yIE9yYWNsZS4K\nICovCnB1YmxpYyBjbGFzcyBPcmFjbGVEaWN0aW9uYXJ5CiAgICBleHRlbmRz\nIERCRGljdGlvbmFyeSB7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU0VMRUNUX0hJTlQgPSAib3BlbmpwYS5oaW50Lk9yYWNsZVNlbGVjdEhp\nbnQiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVkVORE9SX09S\nQUNMRSA9ICJvcmFjbGUiOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlu\ndCBCRUhBVkVfT1RIRVIgPSAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEJFSEFWRV9PUkFDTEUgPSAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IEJFSEFWRV9EQVRBRElSRUNUMzEgPSAyOwoKICAgIHByaXZhdGUg\nc3RhdGljIEJsb2IgRU1QVFlfQkxPQiA9IG51bGw7CiAgICBwcml2YXRlIHN0\nYXRpYyBDbG9iIEVNUFRZX0NMT0IgPSBudWxsOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UKICAgICAgICAoT3JhY2xlRGljdGlvbmFyeS5jbGFzcyk7CgogICAgLyoq\nCiAgICAgKiBJZiB0cnVlLCB0aGVuIHNpbXVsYXRlIGF1dG8tYXNzaWduZWQg\ndmFsdWVzIGluIE9yYWNsZSBieQogICAgICogdXNpbmcgYSB0cmlnZ2VyIHRo\nYXQgaW5zZXJ0cyBhIHNlcXVlbmNlIHZhbHVlIGludG8gdGhlCiAgICAgKiBw\ncmltYXJ5IGtleSB2YWx1ZSB3aGVuIGEgcm93IGlzIGluc2VydGVkLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiB1c2VUcmlnZ2Vyc0ZvckF1dG9Bc3Np\nZ24gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRoZSBnbG9iYWwgc2VxdWVu\nY2UgbmFtZSB0byB1c2UgZm9yIGF1dG9hc3NpZ24gc2ltdWxhdGlvbi4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBhdXRvQXNzaWduU2VxdWVuY2VOYW1l\nID0gbnVsbDsKCiAgICAvKioKICAgICAqIEZsYWcgdG8gdXNlIE9wZW5KUEEg\nMC4zIHN0eWxlIG5hbWluZyBmb3IgYXV0byBhc3NpZ24gc2VxdWVuY2UgbmFt\nZSBhbmQKICAgICAqIHRyaWdnZXIgbmFtZSBmb3IgYmFja3dhcmRzIGNvbXBh\ndGliaWxpdHkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIG9wZW5qcGEz\nR2VuZXJhdGVkS2V5TmFtZXMgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIElm\nIHRydWUsIHRoZW4gT3BlbkpQQSB3aWxsIGF0dGVtcHQgdG8gdXNlIHRoZSBz\ncGVjaWFsCiAgICAgKiBPcmFjbGVQcmVwYXJlZFN0YXRlbWVudC5zZXRGb3Jt\nT2ZVc2UgbWV0aG9kIHRvCiAgICAgKiBjb25maWd1cmUgc3RhdGVtZW50cyB0\naGF0IGl0IGRldGVjdHMgYXJlIG9wZXJhdGluZyBvbiB1bmljb2RlIGZpZWxk\ncy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gdXNlU2V0Rm9ybU9mVXNl\nRm9yVW5pY29kZSA9IHRydWU7CgogICAgLy8gc29tZSBvcmFjbGUgZHJpdmVy\ncyBoYXZlIHByb2JsZW1zIHdpdGggc2VsZWN0IGZvciB1cGRhdGU7IHdhcm4g\ndGhlCiAgICAvLyBmaXJzdCB0aW1lIGxvY2tpbmcgaXMgYXR0ZW1wdGVkCiAg\nICBwcml2YXRlIGJvb2xlYW4gX2NoZWNrZWRVcGRhdGVCdWcgPSBmYWxzZTsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfd2FybmVkQ2hhckNvbHVtbiA9IGZhbHNl\nOwogICAgcHJpdmF0ZSBib29sZWFuIF93YXJuZWROY2hhckNvbHVtbiA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBpbnQgX2RyaXZlckJlaGF2aW9yID0gLTE7Cgog\nICAgLy8gY2FjaGUgbG9iIG1ldGhvZHMKICAgIHByaXZhdGUgTWV0aG9kIF9w\ndXRCeXRlcyA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCBfcHV0U3RyaW5n\nID0gbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIF9wdXRDaGFycyA9IG51bGw7\nCiAgICAKICAgIC8vIGJhdGNoIGxpbWl0CiAgICBwcml2YXRlIGludCBkZWZh\ndWx0QmF0Y2hMaW1pdCA9IDEwMDsKCiAgICBwdWJsaWMgT3JhY2xlRGljdGlv\nbmFyeSgpIHsKICAgICAgICBwbGF0Zm9ybSA9ICJPcmFjbGUiOwogICAgICAg\nIHZhbGlkYXRpb25TUUwgPSAiU0VMRUNUIFNZU0RBVEUgRlJPTSBEVUFMIjsK\nICAgICAgICBuZXh0U2VxdWVuY2VRdWVyeSA9ICJTRUxFQ1QgezB9Lk5FWFRW\nQUwgRlJPTSBEVUFMIjsKICAgICAgICBzdHJpbmdMZW5ndGhGdW5jdGlvbiA9\nICJMRU5HVEgoezB9KSI7CiAgICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9E\nQVRBQkFTRTsKICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGggPSAzMDsKICAg\nICAgICBtYXhDb2x1bW5OYW1lTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4SW5k\nZXhOYW1lTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4Q29uc3RyYWludE5hbWVM\nZW5ndGggPSAzMDsKICAgICAgICBtYXhFbWJlZGRlZEJsb2JTaXplID0gNDAw\nMDsKICAgICAgICBtYXhFbWJlZGRlZENsb2JTaXplID0gNDAwMDsKICAgICAg\nICBpbkNsYXVzZUxpbWl0ID0gMTAwMDsKCiAgICAgICAgc3VwcG9ydHNEZWZl\ncnJlZENvbnN0cmFpbnRzID0gdHJ1ZTsKICAgICAgICBzdXBwb3J0c0xvY2tp\nbmdXaXRoRGlzdGluY3RDbGF1c2UgPSBmYWxzZTsKICAgICAgICBzdXBwb3J0\nc1NlbGVjdFN0YXJ0SW5kZXggPSB0cnVlOwogICAgICAgIHN1cHBvcnRzU2Vs\nZWN0RW5kSW5kZXggPSB0cnVlOwoKICAgICAgICBzeXN0ZW1TY2hlbWFTZXQu\nYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAgICAg\nICAiQ1RYU1lTIiwgIk1EU1lTIiwgIlNZUyIsICJTWVNURU0iLCAiV0tTWVMi\nLCAiV01TWVMiLCAiWERCIiwKICAgICAgICB9KSk7CgogICAgICAgIHN1cHBv\ncnRzWE1MQ29sdW1uID0gdHJ1ZTsKICAgICAgICB4bWxUeXBlTmFtZSA9ICJY\nTUxUeXBlIjsKICAgICAgICBiaWdpbnRUeXBlTmFtZSA9ICJOVU1CRVJ7MH0i\nOwogICAgICAgIGJpdFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAg\nZGVjaW1hbFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgZG91Ymxl\nVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBpbnRlZ2VyVHlwZU5h\nbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBudW1lcmljVHlwZU5hbWUgPSAi\nTlVNQkVSezB9IjsKICAgICAgICBzbWFsbGludFR5cGVOYW1lID0gIk5VTUJF\nUnswfSI7CiAgICAgICAgdGlueWludFR5cGVOYW1lID0gIk5VTUJFUnswfSI7\nCiAgICAgICAgbG9uZ1ZhcmNoYXJUeXBlTmFtZSA9ICJMT05HIjsKICAgICAg\nICBiaW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICB2YXJiaW5hcnlU\neXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICBsb25nVmFyYmluYXJ5VHlwZU5h\nbWUgPSAiQkxPQiI7CiAgICAgICAgdGltZVR5cGVOYW1lID0gIkRBVEUiOwog\nICAgICAgIHZhcmNoYXJUeXBlTmFtZSA9ICJWQVJDSEFSMnswfSI7CiAgICAg\nICAgZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3Qo\nbmV3IFN0cmluZ1tdewogICAgICAgICAgICAiTE9ORyBSQVciLCAiUkFXIiwg\nIkxPTkciLCAiUkVGIiwKICAgICAgICB9KSk7CiAgICAgICAgcmVzZXJ2ZWRX\nb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXXsKICAg\nICAgICAgICAgIkFDQ0VTUyIsICJBVURJVCIsICJDTFVTVEVSIiwgIkNPTU1F\nTlQiLCAiQ09NUFJFU1MiLCAiRVhDTFVTSVZFIiwKICAgICAgICAgICAgIkZJ\nTEUiLCAiSURFTlRJRklFRCIsICJJTkNSRU1FTlQiLCAiSU5ERVgiLCAiSU5J\nVElBTCIsICJMT0NLIiwKICAgICAgICAgICAgIkxPTkciLCAiTUFYRVhURU5U\nUyIsICJNSU5VUyIsICJNT0RFIiwgIk5PQVVESVQiLCAiTk9DT01QUkVTUyIs\nCiAgICAgICAgICAgICJOT1dBSVQiLCAiT0ZGTElORSIsICJPTkxJTkUiLCAi\nUENURlJFRSIsICJST1ciLAogICAgICAgIH0pKTsKCiAgICAgICAgLy8gcmVz\nZXJ2ZWRXb3JkU2V0IHN1YnNldCB0aGF0IENBTk5PVCBiZSB1c2VkIGFzIHZh\nbGlkIGNvbHVtbiBuYW1lcwogICAgICAgIC8vIChpLmUuLCB3aXRob3V0IHN1\ncnJvdW5kaW5nIHRoZW0gd2l0aCBkb3VibGUtcXVvdGVzKQogICAgICAgIGlu\ndmFsaWRDb2x1bW5Xb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBT\ndHJpbmdbXXsKICAgICAgICAgICAgIkFDQ0VTUyIsICJBREQiLCAiQUxMIiwg\nIkFMVEVSIiwgIkFORCIsICJBTlkiLCAiQVMiLCAiQVNDIiwgIkFVRElUIiwK\nICAgICAgICAgICAgIkJFVFdFRU4iLCAiQlkiLCAiQ0hBUiIsICJDSEVDSyIs\nICJDTFVTVEVSIiwgIkNPTFVNTiIsICJDT01NRU5UIiwKICAgICAgICAgICAg\nIkNPTVBSRVNTIiwgIkNPTk5FQ1QiLCAiQ1JFQVRFIiwgIkNVUlJFTlQiLCAi\nREFURSIsICJERUNJTUFMIiwKICAgICAgICAgICAgIkRFRkFVTFQiLCAiREVM\nRVRFIiwgIkRFU0MiLCAiRElTVElOQ1QiLCAiRFJPUCIsICJFTFNFIiwgIkVO\nRC1FWEVDIiwKICAgICAgICAgICAgIkVYQ0xVU0lWRSIsICJFWElTVFMiLCAi\nRklMRSIsICJGTE9BVCIsICJGT1IiLCAiRlJPTSIsICJHUkFOVCIsCiAgICAg\nICAgICAgICJHUk9VUCIsICJIQVZJTkciLCAiSURFTlRJRklFRCIsICJJTU1F\nRElBVEUiLCAiSU4iLCAiSU5DUkVNRU5UIiwKICAgICAgICAgICAgIklOREVY\nIiwgIklOSVRJQUwiLCAiSU5TRVJUIiwgIklOVEVHRVIiLCAiSU5URVJTRUNU\nIiwgIklOVE8iLAogICAgICAgICAgICAiSVMiLCAiTEVWRUwiLCAiTElLRSIs\nICJMT0NLIiwgIkxPTkciLCAiTUFYRVhURU5UUyIsICJNSU5VUyIsCiAgICAg\nICAgICAgICJNT0RFIiwgIk5PQVVESVQiLCAiTk9DT01QUkVTUyIsICJOT1Qi\nLCAiTk9XQUlUIiwgIk5VTEwiLCAiTlVNQkVSIiwKICAgICAgICAgICAgIk9G\nIiwgIk9GRkxJTkUiLCAiT04iLCAiT05MSU5FIiwgIk9QVElPTiIsICJPUiIs\nICJPUkRFUiIsICJQQ1RGUkVFIiwKICAgICAgICAgICAgIlBSSU9SIiwgIlBS\nSVZJTEVHRVMiLCAiUFVCTElDIiwgIlJFVk9LRSIsICJST1ciLCAiUk9XUyIs\nICJTRUxFQ1QiLAogICAgICAgICAgICAiU0VTU0lPTiIsICJTRVQiLCAiU0la\nRSIsICJTTUFMTElOVCIsICJUQUJMRSIsICJUSEVOIiwgIlRPIiwKICAgICAg\nICAgICAgIlVOSU9OIiwgIlVOSVFVRSIsICJVUERBVEUiLCAiVVNFUiIsICJW\nQUxVRVMiLCAiVkFSQ0hBUiIsICJWSUVXIiwKICAgICAgICAgICAgIldIRU5F\nVkVSIiwgIldIRVJFIiwgIldJVEgiLAogICAgICAgIH0pKTsKCiAgICAgICAg\nc3Vic3RyaW5nRnVuY3Rpb25OYW1lID0gIlNVQlNUUiI7CiAgICAgICAgc3Vw\nZXIuc2V0QmF0Y2hMaW1pdChkZWZhdWx0QmF0Y2hMaW1pdCk7CiAgICAgICAg\nc2VsZWN0V29yZFNldC5hZGQoIldJVEgiKTsKICAgICAgICByZXBvcnRzU3Vj\nY2Vzc05vSW5mb09uQmF0Y2hVcGRhdGVzID0gdHJ1ZTsKICAgICAgICByZXF1\naXJlc1NlYXJjaFN0cmluZ0VzY2FwZUZvckxpa2UgPSBmYWxzZTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAg\nIHN1cGVyLmVuZENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBpZiAodXNlVHJp\nZ2dlcnNGb3JBdXRvQXNzaWduKQogICAgICAgICAgICBzdXBwb3J0c0F1dG9B\nc3NpZ24gPSB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbm5lY3Rl\nZENvbmZpZ3VyYXRpb24oQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHN1cGVyLmNvbm5lY3RlZENvbmZp\nZ3VyYXRpb24oY29ubik7CiAgICAgICAgaWYgKGRyaXZlclZlbmRvciA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIERhdGFiYXNlTWV0YURhdGEgbWV0YSA9IGNv\nbm4uZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgU3RyaW5nIHVybCA9ICht\nZXRhLmdldFVSTCgpID09IG51bGwpID8gIiIgOiBtZXRhLmdldFVSTCgpOwog\nICAgICAgICAgICBTdHJpbmcgZHJpdmVyTmFtZSA9IG1ldGEuZ2V0RHJpdmVy\nTmFtZSgpOwogICAgICAgICAgICBTdHJpbmcgbWV0YWRhdGFDbGFzc05hbWU7\nCiAgICAgICAgICAgIGlmIChtZXRhIGluc3RhbmNlb2YgRGVsZWdhdGluZ0Rh\ndGFiYXNlTWV0YURhdGEpCiAgICAgICAgICAgICAgICBtZXRhZGF0YUNsYXNz\nTmFtZSA9ICgoRGVsZWdhdGluZ0RhdGFiYXNlTWV0YURhdGEpIG1ldGEpLgog\nICAgICAgICAgICAgICAgICAgIGdldElubmVybW9zdERlbGVnYXRlKCkuZ2V0\nQ2xhc3MoKS5nZXROYW1lKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIG1ldGFkYXRhQ2xhc3NOYW1lID0gbWV0YS5nZXRDbGFzcygpLmdl\ndE5hbWUoKTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGJvdGggdGhlIGRyaXZl\nciBjbGFzcyBuYW1lIGFuZCB0aGUgVVJMIGZvciBrbm93biBwYXR0ZXJucwog\nICAgICAgICAgICBpZiAobWV0YWRhdGFDbGFzc05hbWUuc3RhcnRzV2l0aCgi\nb3JhY2xlLiIpCiAgICAgICAgICAgICAgICB8fCB1cmwuaW5kZXhPZigiamRi\nYzpvcmFjbGU6IikgIT0gLTEKICAgICAgICAgICAgICAgIHx8ICJPcmFjbGUg\nSkRCQyBkcml2ZXIiLmVxdWFscyhkcml2ZXJOYW1lKSkgewogICAgICAgICAg\nICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX09SQUNMRSArIG1ldGEuZ2V0\nRHJpdmVyTWFqb3JWZXJzaW9uKCkKICAgICAgICAgICAgICAgICAgICArIG1l\ndGEuZ2V0RHJpdmVyTWlub3JWZXJzaW9uKCk7CgogICAgICAgICAgICAgICAg\nU3RyaW5nIHByb2R1Y3RWZXJzaW9uID0gbWV0YS5nZXREYXRhYmFzZVByb2R1\nY3RWZXJzaW9uKCkKICAgICAgICAgICAgICAgICAgICAuc3BsaXQoIlJlbGVh\nc2UgIiwwKVsxXS5zcGxpdCgiXFwuIiwwKVswXTsKICAgICAgICAgICAgICAg\nIGludCByZWxlYXNlID0gSW50ZWdlci5wYXJzZUludChwcm9kdWN0VmVyc2lv\nbik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIHdhcm4g\nc3FsOTIKICAgICAgICAgICAgICAgIGlmIChyZWxlYXNlIDw9IDgpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoam9pblN5bnRheCA9PSBTWU5UQVhfU1FM\nOTIgJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nLndhcm4oX2xvYy5nZXQoIm9yYWNsZS1zeW50YXgiKSk7CiAg\nICAgICAgICAgICAgICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9EQVRBQkFT\nRTsKICAgICAgICAgICAgICAgICAgICBkYXRlVHlwZU5hbWUgPSAiREFURSI7\nIC8vIGFkZGVkIG9yYWNsZSA5CiAgICAgICAgICAgICAgICAgICAgdGltZXN0\nYW1wVHlwZU5hbWUgPSAiREFURSI7IC8vIGFkZGVkIG9yYWNsZSA5CiAgICAg\nICAgICAgICAgICAgICAgc3VwcG9ydHNYTUxDb2x1bW4gPSBmYWxzZTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBzZWxlY3Qg\nb2YgYW4geG1sIGNvbHVtbiByZXF1aXJlcyAiLmdldFN0cmluZ1ZhbCgpIgog\nICAgICAgICAgICAgICAgICAgIC8vIHN1ZmZpeC4gZWcuIHQwLnhtbGNvbC5n\nZXRTdHJpbmdWYWwoKQogICAgICAgICAgICAgICAgICAgIGdldFN0cmluZ1Zh\nbCA9ICIuZ2V0U3RyaW5nVmFsKCkiOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKG1ldGFkYXRhQ2xhc3NOYW1lLnN0YXJ0c1dpdGgoImNvbS5kZHRlay4iKQog\nICAgICAgICAgICAgICAgfHwgdXJsLmluZGV4T2YoImpkYmM6ZGF0YWRpcmVj\ndDpvcmFjbGU6IikgIT0gLTEKICAgICAgICAgICAgICAgIHx8ICJPcmFjbGUi\nLmVxdWFscyhkcml2ZXJOYW1lKSkgewogICAgICAgICAgICAgICAgZHJpdmVy\nVmVuZG9yID0gVkVORE9SX0RBVEFESVJFQ1QgKyBtZXRhLmdldERyaXZlck1h\nam9yVmVyc2lvbigpCiAgICAgICAgICAgICAgICAgICAgKyBtZXRhLmdldERy\naXZlck1pbm9yVmVyc2lvbigpOwogICAgICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgICAgIGRyaXZlclZlbmRvciA9IFZFTkRPUl9PVEhFUjsKICAgICAg\nICB9CiAgICAgICAgY2FjaGVEcml2ZXJCZWhhdmlvcihkcml2ZXJWZW5kb3Ip\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2FjaGUgY29uc3RhbnQgZm9yIGRy\naXZlcnMgd2l0aCBiZWhhdmlvcnMgd2UgaGF2ZSB0byBkZWFsIHdpdGguCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBjYWNoZURyaXZlckJlaGF2aW9yKFN0\ncmluZyBkcml2ZXJWZW5kb3IpIHsKICAgICAgICBpZiAoX2RyaXZlckJlaGF2\naW9yICE9IC0xKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGRyaXZl\nclZlbmRvciA9IGRyaXZlclZlbmRvci50b0xvd2VyQ2FzZSgpOwogICAgICAg\nIGlmIChkcml2ZXJWZW5kb3Iuc3RhcnRzV2l0aChWRU5ET1JfT1JBQ0xFKSkK\nICAgICAgICAgICAgX2RyaXZlckJlaGF2aW9yID0gQkVIQVZFX09SQUNMRTsK\nICAgICAgICBlbHNlIGlmIChkcml2ZXJWZW5kb3IuZXF1YWxzKFZFTkRPUl9E\nQVRBRElSRUNUICsgIjMwIikKICAgICAgICAgICAgfHwgZHJpdmVyVmVuZG9y\nLmVxdWFscyhWRU5ET1JfREFUQURJUkVDVCArICIzMSIpKQogICAgICAgICAg\nICBfZHJpdmVyQmVoYXZpb3IgPSBCRUhBVkVfREFUQURJUkVDVDMxOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgX2RyaXZlckJlaGF2aW9yID0gQkVIQVZF\nX09USEVSOwogICAgfQoKICAgIC8qKgogICAgICogRW5zdXJlIHRoYXQgdGhl\nIGRyaXZlciB2ZW5kb3IgaGFzIGJlZW4gc2V0LCBhbmQgaWYgbm90LCBzZXQg\naXQgbm93LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBlbnN1cmVEcml2ZXJW\nZW5kb3IoKSB7CiAgICAgICAgaWYgKGRyaXZlclZlbmRvciAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGNhY2hlRHJpdmVyQmVoYXZpb3IoZHJpdmVyVmVuZG9y\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJvcmFjbGUtY29ubmVjdGluZy1mb3ItZHJpdmVyIikpOwogICAg\nICAgIENvbm5lY3Rpb24gY29ubiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgY29ubiA9IGNvbmYuZ2V0RGF0YVNvdXJjZTIobnVsbCkuZ2V0\nQ29ubmVjdGlvbigpOwogICAgICAgICAgICBjb25uZWN0ZWRDb25maWd1cmF0\naW9uKGNvbm4pOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNl\nLCB0aGlzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBjb25uLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2Nr\naW5nKFNlbGVjdCBzZWwpIHsKICAgICAgICBpZiAoIXN1cGVyLnN1cHBvcnRz\nTG9ja2luZyhzZWwpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgcmV0dXJuICFyZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKHNlbC5nZXRT\ndGFydEluZGV4KCksCiAgICAgICAgICAgIHNlbC5nZXRFbmRJbmRleCgpLCBz\nZWwuaXNEaXN0aW5jdCgpLCBzZWwuZ2V0T3JkZXJpbmcoKSk7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRTZWxlY3RzKFNlbGVjdCBzZWws\nIGJvb2xlYW4gZGlzdGluY3RJZGVudGlmaWVycywKICAgICAgICBib29sZWFu\nIGZvclVwZGF0ZSkgewogICAgICAgIC8vIGlmIHJhbmdlIGRvZXNuJ3QgcmVx\ndWlyZSBhIHN1YnNlbGVjdCBjYW4gdXNlIHN1cGVyCiAgICAgICAgaWYgKCFy\nZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKHNlbC5nZXRTdGFydEluZGV4KCks\nCiAgICAgICAgICAgIHNlbC5nZXRFbmRJbmRleCgpLCBzZWwuaXNEaXN0aW5j\ndCgpLCBzZWwuZ2V0T3JkZXJpbmcoKSkpCiAgICAgICAgICAgIHJldHVybiBz\ndXBlci5nZXRTZWxlY3RzKHNlbCwgZGlzdGluY3RJZGVudGlmaWVycywgZm9y\nVXBkYXRlKTsKCiAgICAgICAgLy8gaWYgdGhlcmUgYXJlIG5vIGpvaW5zIGlu\ndm9sdmVkIG9yIHdlJ3JlIHVzaW5nIGEgZnJvbSBzZWxlY3Qgc28KICAgICAg\nICAvLyB0aGF0IGFsbCBjb2xzIGFscmVhZHkgaGF2ZSB1bmlxdWUgYWxpYXNl\ncywgY2FuIHVzZSBzdXBlcgogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVj\ndCgpICE9IG51bGwgfHwgc2VsLmdldFRhYmxlQWxpYXNlcygpLnNpemUoKSA8\nIDIpCiAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRTZWxlY3RzKHNlbCwg\nZGlzdGluY3RJZGVudGlmaWVycywgZm9yVXBkYXRlKTsKCiAgICAgICAgLy8g\nc2luY2Ugbm9uZSBvZiB0aGUgY29uZGl0aW9ucyBhYm92ZSB3ZXJlIG1ldCwg\nd2UncmUgZGVhbGluZyB3aXRoCiAgICAgICAgLy8gYSBzZWxlY3QgdGhhdCB1\nc2VzIGpvaW5zIGFuZCByZXF1aXJlcyBzdWJzZWxlY3RzIHRvIHNlbGVjdCB0\naGUKICAgICAgICAvLyBwcm9wZXIgcmFuZ2U7IGFsaWFzIGFsbCBjb2x1bW4g\ndmFsdWVzIHNvIHRoYXQgdGhleSBhcmUgdW5pcXVlIHdpdGhpbgogICAgICAg\nIC8vIHRoZSBzdWJzZWxlY3QKICAgICAgICBTUUxCdWZmZXIgc2VsZWN0U1FM\nID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBMaXN0IGFsaWFzZXM7\nCiAgICAgICAgaWYgKGRpc3RpbmN0SWRlbnRpZmllcnMpCiAgICAgICAgICAg\nIGFsaWFzZXMgPSBzZWwuZ2V0SWRlbnRpZmllckFsaWFzZXMoKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGFsaWFzZXMgPSBzZWwuZ2V0U2VsZWN0QWxp\nYXNlcygpOwoKICAgICAgICBPYmplY3QgYWxpYXM7CiAgICAgICAgaW50IGkg\nPSAwOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYWxpYXNlcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpKyspIHsKICAgICAgICAgICAgYWxp\nYXMgPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoYWxpYXMgaW5zdGFu\nY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBw\nZW5kKChTUUxCdWZmZXIpIGFsaWFzKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChhbGlhcy50b1N0cmluZygp\nKTsKICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiIEFTIGMiKS5hcHBl\nbmQoU3RyaW5nLnZhbHVlT2YoaSkpOwogICAgICAgICAgICBpZiAoaXRyLmhh\nc05leHQoKSkKICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiwg\nIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxlY3RTUUw7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gY2FuT3V0ZXJKb2luKGludCBzeW50YXgs\nIEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoIXN1cGVyLmNhbk91dGVy\nSm9pbihzeW50YXgsIGZrKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmIChmayAhPSBudWxsICYmIHN5bnRheCA9PSBTWU5UQVhfREFU\nQUJBU0UpIHsKICAgICAgICAgICAgaWYgKGZrLmdldENvbnN0YW50cygpLmxl\nbmd0aCA+IDApCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgIGlmIChmay5nZXRQcmltYXJ5S2V5Q29uc3RhbnRzKCkubGVuZ3Ro\nID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIFNRTEJ1\nZmZlciB0b05hdGl2ZUpvaW4oSm9pbiBqb2luKSB7CiAgICAgICAgaWYgKGpv\naW4uZ2V0VHlwZSgpICE9IEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAg\ncmV0dXJuIHRvVHJhZGl0aW9uYWxKb2luKGpvaW4pOwoKICAgICAgICBGb3Jl\naWduS2V5IGZrID0gam9pbi5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgaWYg\nKGZrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBib29sZWFuIGludmVyc2UgPSBqb2luLmlzRm9yZWlnbktleUludmVyc2Vk\nKCk7CiAgICAgICAgQ29sdW1uW10gZnJvbSA9IChpbnZlcnNlKSA/IGZrLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG8gPSAoaW52ZXJzZSkgPyBmay5n\nZXRDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5S2V5Q29s\ndW1ucygpOwoKICAgICAgICAvLyBkbyBjb2x1bW4gam9pbnMKICAgICAgICBT\nUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBp\nbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJv\nbS5sZW5ndGg7IGkrKywgY291bnQrKykgewogICAgICAgICAgICBpZiAoY291\nbnQgPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsK\nICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgpKS5hcHBl\nbmQoIi4iKS5hcHBlbmQoZnJvbVtpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiA9ICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxp\nYXMyKCkpLmFwcGVuZCgiLiIpLmFwcGVuZCh0b1tpXSk7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIigrKSIpOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hl\nY2sgY29uc3RhbnQgam9pbnMKICAgICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRD\nb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJvcmFjbGUtY29uc3RhbnQiLAogICAg\nICAgICAgICAgICAgam9pbi5nZXRUYWJsZTEoKSwgam9pbi5nZXRUYWJsZTIo\nKSkpLnNldEZhdGFsKHRydWUpOwoKICAgICAgICBpZiAoZmsuZ2V0Q29uc3Rh\nbnRQcmltYXJ5S2V5Q29sdW1ucygpLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdldCgib3JhY2xlLWNv\nbnN0YW50IiwKICAgICAgICAgICAgICAgIGpvaW4uZ2V0VGFibGUxKCksIGpv\naW4uZ2V0VGFibGUyKCkpKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICByZXR1\ncm4gYnVmOwogICAgfQoKICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgdG9TZWxl\nY3QoU1FMQnVmZmVyIHNlbGVjdCwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwKICAgICAgICBTUUxCdWZmZXIgdGFibGVzLCBTUUxCdWZmZXIgd2hl\ncmUsIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5n\nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwg\nYm9vbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAg\nICAgIGJvb2xlYW4gc3Vic2VsZWN0LCBTZWxlY3Qgc2VsKSB7CiAgICAgICAg\ncmV0dXJuIHRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hlcmUs\nIGdyb3VwLCBoYXZpbmcsIG9yZGVyLAogICAgICAgICAgICBkaXN0aW5jdCwg\nZm9yVXBkYXRlLCBzdGFydCwgZW5kLCBzZWwpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdCwgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIg\ndGFibGVzLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwKICAg\nICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAg\nICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JVcGRhdGUsIGxvbmcg\nc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFNlbGVjdCBzZWwpIHsKICAgICAg\nICBpZiAoIV9jaGVja2VkVXBkYXRlQnVnKSB7CiAgICAgICAgICAgIGVuc3Vy\nZURyaXZlclZlbmRvcigpOwogICAgICAgICAgICBpZiAoZm9yVXBkYXRlICYm\nIF9kcml2ZXJCZWhhdmlvciA9PSBCRUhBVkVfREFUQURJUkVDVDMxKQogICAg\nICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImRkLWxvY2stYnVnIikp\nOwogICAgICAgICAgICBfY2hlY2tlZFVwZGF0ZUJ1ZyA9IHRydWU7CiAgICAg\nICAgfQoKICAgICAgICAvLyBpZiBubyByYW5nZSwgdXNlIHN0YW5kYXJkIHNl\nbGVjdAogICAgICAgIGlmIChzdGFydCA9PSAwICYmIGVuZCA9PSBMb25nLk1B\nWF9WQUxVRSkKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnRvU2VsZWN0KHNl\nbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hlcmUsIGdyb3VwLCBoYXZpbmcsCiAg\nICAgICAgICAgICAgICBvcmRlciwgZGlzdGluY3QsIGZvclVwZGF0ZSwgMCwg\nTG9uZy5NQVhfVkFMVUUsIHNlbCk7CgogICAgICAgIC8vIGlmIG5vIHNraXAs\nIG9yZGVyaW5nLCBvciBkaXN0aW5jdCBjYW4gdXNlIHJvd251bSBkaXJlY3Rs\neQogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMp\nOwogICAgICAgIGlmICghcmVxdWlyZXNTdWJzZWxlY3RGb3JSYW5nZShzdGFy\ndCwgZW5kLCBkaXN0aW5jdCwgb3JkZXIpKSB7CiAgICAgICAgICAgIGlmICh3\naGVyZSAhPSBudWxsICYmICF3aGVyZS5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKHdoZXJlKS5hcHBlbmQoIiBBTkQgIik7CiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIlJPV05VTSA8PSAiKS5hcHBlbmRWYWx1ZShl\nbmQpOwogICAgICAgICAgICByZXR1cm4gc3VwZXIudG9TZWxlY3Qoc2VsZWN0\nLCBmZXRjaCwgdGFibGVzLCBidWYsIGdyb3VwLCBoYXZpbmcsCiAgICAgICAg\nICAgICAgICBvcmRlciwgZGlzdGluY3QsIGZvclVwZGF0ZSwgMCwgTG9uZy5N\nQVhfVkFMVUUsIHNlbCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGVy\nZSBpcyBvcmRlcmluZywgc2tpcCwgb3IgZGlzdGluY3Qgd2UgaGF2ZSB0byB1\nc2Ugc3Vic2VsZWN0cwogICAgICAgIFNRTEJ1ZmZlciBuZXdzZWwgPSBzdXBl\nci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJsZXMsIHdoZXJlLAogICAg\nICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGluY3QsIGZvclVw\nZGF0ZSwgMCwgTG9uZy5NQVhfVkFMVUUsCiAgICAgICAgICAgIHNlbCk7Cgog\nICAgICAgIC8vIGlmIG5vIHNraXAsIGNhbiB1c2Ugc2luZ2xlIG5lc3RlZCBz\ndWJzZWxlY3QKICAgICAgICBpZiAoc3RhcnQgPT0gMCkgewogICAgICAgICAg\nICBidWYuYXBwZW5kKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCkgKyAiICog\nRlJPTSAoIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQobmV3c2VsKTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiKSBXSEVSRSBST1dOVU0gPD0gIikuYXBw\nZW5kVmFsdWUoZW5kKTsKICAgICAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAg\nICB9CgogICAgICAgIC8vIHdpdGggYSBza2lwLCB3ZSBoYXZlIHRvIHVzZSBh\nIGRvdWJsZS1uZXN0ZWQgc3Vic2VsZWN0IHRvIHB1dAogICAgICAgIC8vIHdo\nZXJlIGNvbmRpdGlvbnMgb24gdGhlIHJvd251bQogICAgICAgIGJ1Zi5hcHBl\nbmQoZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKQogICAgICAgICAgICArICIg\nKiBGUk9NIChTRUxFQ1Qgci4qLCBST1dOVU0gUk5VTSBGUk9NICgiKTsKICAg\nICAgICBidWYuYXBwZW5kKG5ld3NlbCk7CiAgICAgICAgYnVmLmFwcGVuZCgi\nKSByIik7CiAgICAgICAgaWYgKGVuZCAhPSBMb25nLk1BWF9WQUxVRSkKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiIFdIRVJFIFJPV05VTSA8PSAiKS5hcHBl\nbmRWYWx1ZShlbmQpOwogICAgICAgIGJ1Zi5hcHBlbmQoIikgV0hFUkUgUk5V\nTSA+ICIpLmFwcGVuZFZhbHVlKHN0YXJ0KTsKICAgICAgICByZXR1cm4gYnVm\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHNl\nbGVjdCB3aXRoIHRoZSBnaXZlbiBwYXJhbWV0ZXJzIG5lZWRzIGEKICAgICAq\nIHN1YnNlbGVjdCB0byBhcHBseSBhIHJhbmdlLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gcmVxdWlyZXNTdWJzZWxlY3RGb3JSYW5nZShsb25nIHN0\nYXJ0LCBsb25nIGVuZCwKICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBTUUxC\ndWZmZXIgb3JkZXIpIHsKICAgICAgICBpZiAoc3RhcnQgPT0gMCAmJiBlbmQg\nPT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICByZXR1cm4gc3RhcnQgIT0gMCB8fCBkaXN0aW5jdCB8fCAob3Jk\nZXIgIT0gbnVsbCAmJiAhb3JkZXIuaXNFbXB0eSgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIHNldCB0aGUge0Bs\naW5rICNTRUxFQ1RfSElOVH0gaW4gdGhlCiAgICAgKiBmZXRjaCBjb25maWd1\ncmFpdG9uLCBhbmQgaWYgc28sIGFwcGVuZCB0aGUgT3JhY2hlIGhpbnQgYWZ0\nZXIgdGhlCiAgICAgKiAiU0VMRUNUIiBwYXJ0IG9mIHRoZSBxdWVyeS4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTZWxlY3RPcGVyYXRpb24oSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIE9iamVjdCBo\naW50ID0gZmV0Y2ggPT0gbnVsbCA/IG51bGwgOiBmZXRjaC5nZXRIaW50KFNF\nTEVDVF9ISU5UKTsKICAgICAgICBTdHJpbmcgc2VsZWN0ID0gIlNFTEVDVCI7\nCiAgICAgICAgaWYgKGhpbnQgIT0gbnVsbCkKICAgICAgICAgICAgc2VsZWN0\nICs9ICIgIiArIGhpbnQ7CiAgICAgICAgcmV0dXJuIHNlbGVjdDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJpbmcoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIFN0cmluZyB2YWwsCiAgICAgICAgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBv\ncmFjbGUgTkNIQVIvTlZBUkNIQVIvTkNMT0IgdW5pY29kZSBjb2x1bW5zIHJl\ncXVpcmUgc29tZQogICAgICAgIC8vIHNwZWNpYWwgaGFuZGxpbmcgdG8gY29u\nZmlndXJlIHRoZW0gY29ycmVjdGx5OyBzZWU6CiAgICAgICAgLy8gaHR0cDov\nL3d3dy5vcmFjbGUuY29tL3RlY2hub2xvZ3kvc2FtcGxlX2NvZGUvdGVjaC9q\nYXZhLwogICAgICAgIC8vIHNxbGpfamRiYy9maWxlcy85aV9qZGJjL05DSEFS\nc3VwcG9ydDRVbmljb2RlU2FtcGxlL1JlYWRtZS5odG1sCiAgICAgICAgU3Ry\naW5nIHR5cGVOYW1lID0gKGNvbCA9PSBudWxsKSA/IG51bGwgOiBjb2wuZ2V0\nVHlwZU5hbWUoKTsKICAgICAgICBpZiAodXNlU2V0Rm9ybU9mVXNlRm9yVW5p\nY29kZSAmJiB0eXBlTmFtZSAhPSBudWxsICYmCiAgICAgICAgICAgICh0eXBl\nTmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoIm52YXJjaGFyIikgfHwK\nICAgICAgICAgICAgICAgIHR5cGVOYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRz\nV2l0aCgibmNoYXIiKSB8fAogICAgICAgICAgICAgICAgdHlwZU5hbWUudG9M\nb3dlckNhc2UoKS5zdGFydHNXaXRoKCJuY2xvYiIpKSkgewogICAgICAgICAg\nICBTdGF0ZW1lbnQgaW5uZXIgPSBzdG1udDsKICAgICAgICAgICAgaWYgKGlu\nbmVyIGluc3RhbmNlb2YgRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KQog\nICAgICAgICAgICAgICAgaW5uZXIgPSAoKERlbGVnYXRpbmdQcmVwYXJlZFN0\nYXRlbWVudCkgaW5uZXIpLgogICAgICAgICAgICAgICAgICAgIGdldElubmVy\nbW9zdERlbGVnYXRlKCk7CiAgICAgICAgICAgIGlmIChpc09yYWNsZVByZXBh\ncmVkU3RhdGVtZW50KGlubmVyKSkgewogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBpbm5lci5nZXRDbGFzcygpLmdldE1ldGhv\nZCgic2V0Rm9ybU9mVXNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IGludC5jbGFzcywgc2hvcnQuY2xhc3MgfSkuCiAgICAgICAg\nICAgICAgICAgICAgICAgIGludm9rZShpbm5lciwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBuZXcgSW50ZWdlcihpZHgpLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKCJvcmFjbGUuamRiYy5PcmFjbGVQ\ncmVwYXJlZFN0YXRlbWVudCIpLgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBnZXRGaWVsZCgiRk9STV9OQ0hBUiIpLmdldChudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAg\nIGxvZy53YXJuKGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nIGVsc2UgaWYgKCFfd2FybmVkTmNoYXJDb2x1bW4gJiYgbG9nLmlzV2FybkVu\nYWJsZWQoKSkgewogICAgICAgICAgICAgICAgX3dhcm5lZE5jaGFyQ29sdW1u\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJ1\nbmNvbmZpZ3VyZWQtbmNoYXItY29scyIpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLy8gY2FsbCBzZXRGaXhlZENIQVIgZm9yIGZpeGVk\nIHdpZHRoIGNoYXJhY3RlciBjb2x1bW5zIHRvIGdldCBwYWRkaW5nCiAgICAg\nICAgLy8gc2VtYW50aWNzCiAgICAgICAgaWYgKGNvbCAhPSBudWxsICYmIGNv\nbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0hBUgogICAgICAgICAgICAmJiB2YWwg\nIT0gbnVsbCAmJiB2YWwubGVuZ3RoKCkgIT0gY29sLmdldFNpemUoKSkgewog\nICAgICAgICAgICBTdGF0ZW1lbnQgaW5uZXIgPSBzdG1udDsKICAgICAgICAg\nICAgaWYgKGlubmVyIGluc3RhbmNlb2YgRGVsZWdhdGluZ1ByZXBhcmVkU3Rh\ndGVtZW50KQogICAgICAgICAgICAgICAgaW5uZXIgPSAoKERlbGVnYXRpbmdQ\ncmVwYXJlZFN0YXRlbWVudCkgaW5uZXIpLgogICAgICAgICAgICAgICAgICAg\nIGdldElubmVybW9zdERlbGVnYXRlKCk7CiAgICAgICAgICAgIGlmIChpc09y\nYWNsZVByZXBhcmVkU3RhdGVtZW50KGlubmVyKSkgewogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpbm5lci5nZXRDbGFzcygp\nLmdldE1ldGhvZCgic2V0Rml4ZWRDSEFSIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcywgU3RyaW5nLmNsYXNzIH0p\nLgogICAgICAgICAgICAgICAgICAgICAgICBpbnZva2UoaW5uZXIsIG5ldyBP\nYmplY3RbXXsgbmV3IEludGVnZXIoaWR4KSwgdmFsIH0pOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmICghX3dhcm5lZENoYXJDb2x1bW4gJiYgbG9nLmlzV2FybkVuYWJsZWQo\nKSkgewogICAgICAgICAgICAgICAgX3dhcm5lZENoYXJDb2x1bW4gPSB0cnVl\nOwogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVucGFkZGVk\nLWNoYXItY29scyIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBzdXBlci5zZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLCBjb2wpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldE51bGwoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIGludCBjb2xUeXBlLAogICAgICAgIENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKChjb2xUeXBlID09IFR5cGVzLkNMT0IgfHwgY29sVHlwZSA9PSBUeXBlcy5C\nTE9CKSAmJiBjb2wuaXNOb3ROdWxsKCkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWJsb2ItaW4tbm90LW51\nbGxhYmxlIiwgY29sCiAgICAgICAgICAgICAgICAuZ2V0RnVsbE5hbWUoKSkp\nOwogICAgICAgIGlmIChjb2xUeXBlID09IFR5cGVzLkJMT0IgJiYgX2RyaXZl\nckJlaGF2aW9yID09IEJFSEFWRV9PUkFDTEUpCiAgICAgICAgICAgIHN0bW50\nLnNldEJsb2IoaWR4LCBnZXRFbXB0eUJsb2IoKSk7CiAgICAgICAgZWxzZSBp\nZiAoY29sVHlwZSA9PSBUeXBlcy5DTE9CICYmIF9kcml2ZXJCZWhhdmlvciA9\nPSBCRUhBVkVfT1JBQ0xFCiAgICAgICAgICAgICYmICFjb2wuaXNYTUwoKSkK\nICAgICAgICAgICAgc3RtbnQuc2V0Q2xvYihpZHgsIGdldEVtcHR5Q2xvYigp\nKTsKICAgICAgICBlbHNlIGlmICgoY29sVHlwZSA9PSBUeXBlcy5TVFJVQ1Qg\nfHwgY29sVHlwZSA9PSBUeXBlcy5PVEhFUikKICAgICAgICAgICAgJiYgY29s\nICE9IG51bGwgJiYgY29sLmdldFR5cGVOYW1lKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgc3RtbnQuc2V0TnVsbChpZHgsIFR5cGVzLlNUUlVDVCwgY29sLmdl\ndFR5cGVOYW1lKCkpOwogICAgICAgICAgICAvLyBzb21lIHZlcnNpb25zIG9m\nIHRoZSBPcmFjbGUgSkRCQyBkcml2ZXIgd2lsbCBmYWlsIGlmIGNhbGxpbmcK\nICAgICAgICAgICAgLy8gc2V0TnVsbCB3aXRoIERBVEU7IHNlZSBidWcgIzEx\nNzEKICAgICAgICBlbHNlIGlmIChjb2xUeXBlID09IFR5cGVzLkRBVEUpCiAg\nICAgICAgICAgIHN1cGVyLnNldE51bGwoc3RtbnQsIGlkeCwgVHlwZXMuVElN\nRVNUQU1QLCBjb2wpOwogICAgICAgIC8vIHRoZSBPcmFjbGUgZHJpdmVyIGRv\nZXMgbm90IHN1cHBvcnQgVHlwZXMuT1RIRVIgd2l0aCBzZXROdWxsCiAgICAg\nICAgZWxzZSBpZiAoY29sVHlwZSA9PSBUeXBlcy5PVEhFUiB8fCBjb2wuaXNY\nTUwoKSkKICAgICAgICAgICAgc3VwZXIuc2V0TnVsbChzdG1udCwgaWR4LCBU\neXBlcy5OVUxMLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Vw\nZXIuc2V0TnVsbChzdG1udCwgaWR4LCBjb2xUeXBlLCBjb2wpOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xvYlN0cmluZyhSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKF9kcml2ZXJCZWhhdmlvciAhPSBCRUhBVkVfT1JBQ0xFKQog\nICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q2xvYlN0cmluZyhycywgY29s\ndW1uKTsKCiAgICAgICAgQ2xvYiBjbG9iID0gZ2V0Q2xvYihycywgY29sdW1u\nKTsKICAgICAgICBpZiAoY2xvYiA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAoY2xvYi5nZXRDbGFzcygpLmdldE5hbWUo\nKS5lcXVhbHMoIm9yYWNsZS5zcWwuQ0xPQiIpKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBpZiAoKChCb29sZWFuKSBDbGFzcy5mb3JO\nYW1lKCJvcmFjbGUuc3FsLkNMT0IiKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRNZXRob2QoImlzRW1wdHlMb2IiLCBuZXcgQ2xhc3NbMF0pLgogICAgICAg\nICAgICAgICAgICAgIGludm9rZShjbG9iLCBuZXcgT2JqZWN0WzBdKSkuCiAg\nICAgICAgICAgICAgICAgICAgYm9vbGVhblZhbHVlKCkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBwb3NzaWJseSBkaWZm\nZXJlbnQgdmVyc2lvbiBvZiB0aGUgZHJpdmVyCiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgaWYgKGNsb2IubGVuZ3RoKCkgPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHVubGlrZWx5IHRoYXQg\nd2UnbGwgaGF2ZSBzdHJpbmdzIG92ZXIgNCBiaWxsaW9uIGNoYXJzCiAgICAg\nICAgcmV0dXJuIGNsb2IuZ2V0U3ViU3RyaW5nKDEsIChpbnQpIGNsb2IubGVu\nZ3RoKCkpOwogICAgfQoKICAgIHB1YmxpYyBUaW1lc3RhbXAgZ2V0VGltZXN0\nYW1wKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgQ2FsZW5kYXIgY2FsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjYWwg\nPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldFRpbWVzdGFtcChycywgY29sdW1uLCBjYWwpOwog\nICAgICAgICAgICB9IGNhdGNoIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNl\ncHRpb24gYWUpIHsKICAgICAgICAgICAgICAgIC8vIENSMjk1NjA0OiBpc3N1\nZSBhIHdhcm5pbmcgdGhpcyB0aGlzIGJ1ZyBjYW4gYmUgZ290dGVuCiAgICAg\nICAgICAgICAgICAvLyBhcm91bmQgd2l0aCBTdXBwb3J0c1RpbWVzdGFtcE5h\nbm9zPWZhbHNlCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgi\nb3JhY2xlLXRpbWVzdGFtcC1idWciKSwgYWUpOwogICAgICAgICAgICAgICAg\ndGhyb3cgYWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8v\nIGhhbmRsZSBPcmFjbGUgYnVnIHdoZXJlIG5hbm9zIG5vdCByZXR1cm5lZCBm\ncm9tIGNhbGwgd2l0aCBDYWxlbmRhcgogICAgICAgIC8vIHBhcmFtZXRlcgog\nICAgICAgIFRpbWVzdGFtcCB0cyA9IHJzLmdldFRpbWVzdGFtcChjb2x1bW4s\nIGNhbCk7CiAgICAgICAgaWYgKHRzICE9IG51bGwgJiYgdHMuZ2V0TmFub3Mo\nKSA9PSAwKQogICAgICAgICAgICB0cy5zZXROYW5vcyhycy5nZXRUaW1lc3Rh\nbXAoY29sdW1uKS5nZXROYW5vcygpKTsKICAgICAgICByZXR1cm4gdHM7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBnZXRPYmplY3QoUmVzdWx0U2V0IHJz\nLCBpbnQgY29sdW1uLCBNYXAgbWFwKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIC8vIHJlY2VudCBvcmFjbGUgZHJpdmVycyByZXR1\ncm4gb3JhY2xlLXNwZWNpZmljIHR5cGVzIGZvciB0aW1lc3RhbXBzCiAgICAg\nICAgLy8gYW5kIGRhdGVzCiAgICAgICAgT2JqZWN0IG9iaiA9IHN1cGVyLmdl\ndE9iamVjdChycywgY29sdW1uLCBtYXApOwogICAgICAgIGlmIChvYmogPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCJv\ncmFjbGUuc3FsLkRBVEUiLmVxdWFscyhvYmouZ2V0Q2xhc3MoKS5nZXROYW1l\nKCkpKQogICAgICAgICAgICBvYmogPSBjb252ZXJ0RnJvbU9yYWNsZVR5cGUo\nb2JqLCAiZGF0ZVZhbHVlIik7CiAgICAgICAgZWxzZSBpZiAoIm9yYWNsZS5z\ncWwuVElNRVNUQU1QIi5lcXVhbHMob2JqLmdldENsYXNzKCkuZ2V0TmFtZSgp\nKSkKICAgICAgICAgICAgb2JqID0gY29udmVydEZyb21PcmFjbGVUeXBlKG9i\naiwgInRpbWVzdGFtcFZhbHVlIik7CiAgICAgICAgcmV0dXJuIG9iajsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgYW4gb2JqZWN0IGZyb20gaXRz\nIHByb3ByaWV0YXJ5IE9yYWNsZSB0eXBlIHRvIHRoZSBzdGFuZGFyZAogICAg\nICogSmF2YSB0eXBlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmpl\nY3QgY29udmVydEZyb21PcmFjbGVUeXBlKE9iamVjdCBvYmosCiAgICAgICAg\nU3RyaW5nIGNvbnZlcnRNZXRob2QpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTWV0aG9kIG0gPSBv\nYmouZ2V0Q2xhc3MoKS5nZXRNZXRob2QoY29udmVydE1ldGhvZCwgKENsYXNz\nW10pIG51bGwpOwogICAgICAgICAgICByZXR1cm4gbS5pbnZva2Uob2JqLCAo\nT2JqZWN0W10pIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0\nKSB7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2YgSW52b2NhdGlvblRh\ncmdldEV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIHQgPSAoKEludm9jYXRp\nb25UYXJnZXRFeGNlcHRpb24pIHQpLmdldFRhcmdldEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikKICAg\nICAgICAgICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikgdDsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbih0LmdldE1lc3NhZ2UoKSk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5z\nKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAg\nICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIFN0cmlu\nZyBjb2x1bW5OYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IHN1cGVy\nLmdldENvbHVtbnMobWV0YSwgY2F0YWxvZywgc2NoZW1hTmFtZSwgdGFibGVO\nYW1lLAogICAgICAgICAgICBjb2x1bW5OYW1lLCBjb25uKTsKCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGNvbHMgIT0gbnVsbCAmJiBpIDwgY29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29sc1tpXS5nZXRUeXBlTmFt\nZSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgaWYgKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKS50b1VwcGVyQ2FzZSgp\nLnN0YXJ0c1dpdGgoIlRJTUVTVEFNUCIpKQogICAgICAgICAgICAgICAgY29s\nc1tpXS5zZXRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKCJCTE9CIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlw\nZU5hbWUoKSkpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlw\nZXMuQkxPQik7CiAgICAgICAgICAgIGVsc2UgaWYgKCJDTE9CIi5lcXVhbHNJ\nZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkKICAgICAgICAgICAg\nICAgIHx8ICJOQ0xPQiIuZXF1YWxzSWdub3JlQ2FzZShjb2xzW2ldLmdldFR5\ncGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5\ncGVzLkNMT0IpOwogICAgICAgICAgICBlbHNlIGlmICgiRkxPQVQiLmVxdWFs\nc0lnbm9yZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgpKSkKICAgICAgICAg\nICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5GTE9BVCk7CiAgICAgICAg\nICAgIGVsc2UgaWYgKCJOVkFSQ0hBUiIuZXF1YWxzSWdub3JlQ2FzZShjb2xz\nW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29sc1tpXS5z\nZXRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICBlbHNlIGlmICgi\nTkNIQVIiLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgp\nKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5DSEFS\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbHM7CiAgICB9CgogICAg\ncHVibGljIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5cyhEYXRhYmFzZU1l\ndGFEYXRhIG1ldGEsCiAgICAgICAgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBz\nY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5n\nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYu\nYXBwZW5kKCJTRUxFQ1QgdDAuT1dORVIgQVMgVEFCTEVfU0NIRU0sICIpLgog\nICAgICAgICAgICBhcHBlbmQoInQwLlRBQkxFX05BTUUgQVMgVEFCTEVfTkFN\nRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09MVU1OX05BTUUgQVMg\nQ09MVU1OX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLkNPTlNU\nUkFJTlRfTkFNRSBBUyBQS19OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQo\nIkZST00gQUxMX0NPTlNfQ09MVU1OUyB0MCwgQUxMX0NPTlNUUkFJTlRTIHQx\nICIpLgogICAgICAgICAgICBhcHBlbmQoIldIRVJFIHQwLk9XTkVSID0gdDEu\nT1dORVIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQwLkNPTlNUUkFJ\nTlRfTkFNRSA9IHQxLkNPTlNUUkFJTlRfTkFNRSAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJBTkQgdDEuQ09OU1RSQUlOVF9UWVBFID0gJ1AnIik7CiAgICAg\nICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIEFORCB0MC5PV05FUiA9ID8iKTsKICAgICAgICBpZiAodGFibGVO\nYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgdDAu\nVEFCTEVfTkFNRSA9ID8iKTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkp\nOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaW50IGlkeCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hl\nbWFOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3Rt\nbnQsIGlkeCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwog\nICAgICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9VcHBl\nckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIHNldFRpbWVvdXRzKHN0bW50\nLCBjb25mLCBmYWxzZSk7CiAgICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0\nZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3QgcGtMaXN0ID0gbmV3IEFycmF5\nTGlzdCgpOwogICAgICAgICAgICB3aGlsZSAocnMgIT0gbnVsbCAmJiBycy5u\nZXh0KCkpCiAgICAgICAgICAgICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlL\nZXkocnMpKTsKICAgICAgICAgICAgcmV0dXJuIChQcmltYXJ5S2V5W10pIHBr\nTGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFByaW1hcnlLZXlb\ncGtMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBycy5jbG9zZSgpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50LmNsb3NlKCk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEluZGV4W10gZ2V0\nSW5kZXhJbmZvKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFs\nb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5h\nbWUsIGJvb2xlYW4gdW5pcXVlLCBib29sZWFuIGFwcHJveCwKICAgICAgICBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIo\nKTsKICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgdDAuSU5ERVhfT1dORVIg\nQVMgVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLlRB\nQkxFX05BTUUgQVMgVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVu\nZCgiREVDT0RFKHQxLlVOSVFVRU5FU1MsICdVTklRVUUnLCAwLCAnTk9OVU5J\nUVVFJywgMSkgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQVMgTk9OX1VOSVFV\nRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuSU5ERVhfTkFNRSBBUyBJ\nTkRFWF9OQU1FLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5f\nTkFNRSBBUyBDT0xVTU5fTkFNRSAiKS4KICAgICAgICAgICAgYXBwZW5kKCJG\nUk9NIEFMTF9JTkRfQ09MVU1OUyB0MCwgQUxMX0lOREVYRVMgdDEgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgiV0hFUkUgdDAuSU5ERVhfT1dORVIgPSB0MS5P\nV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDAuSU5ERVhfTkFN\nRSA9IHQxLklOREVYX05BTUUiKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAh\nPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLlRBQkxF\nX09XTkVSID0gPyIpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0g\nPyIpOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4u\ncHJlcGFyZVN0YXRlbWVudChidWYudG9TdHJpbmcoKSk7CiAgICAgICAgUmVz\ndWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nbnQgaWR4ID0gMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHNj\naGVtYU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIGlm\nICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0cmlu\nZyhzdG1udCwgaWR4KyssIHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxs\nKTsKCiAgICAgICAgICAgIHNldFRpbWVvdXRzKHN0bW50LCBjb25mLCBmYWxz\nZSk7CiAgICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAg\nICAgICAgICAgIExpc3QgaWR4TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICAgICAgd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAg\nICAgICAgICAgICAgaWR4TGlzdC5hZGQobmV3SW5kZXgocnMpKTsKICAgICAg\nICAgICAgcmV0dXJuIChJbmRleFtdKSBpZHhMaXN0LnRvQXJyYXkobmV3IElu\nZGV4W2lkeExpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQuY2xv\nc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRm9yZWln\nbktleVtdIGdldEltcG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEs\nIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBT\ndHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGRlbEFj\ndGlvbiA9IG5ldyBTdHJpbmdCdWZmZXIoIkRFQ09ERSh0MS5ERUxFVEVfUlVM\nRSIpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ05PIEFDVElPTicsICIpLmFw\ncGVuZChtZXRhLmltcG9ydGVkS2V5Tm9BY3Rpb24pLgogICAgICAgICAgICBh\ncHBlbmQoIiwgJ1JFU1RSSUNUJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRL\nZXlSZXN0cmljdCkuCiAgICAgICAgICAgIGFwcGVuZCgiLCAnQ0FTQ0FERScs\nICIpLmFwcGVuZChtZXRhLmltcG9ydGVkS2V5Q2FzY2FkZSkuCiAgICAgICAg\nICAgIGFwcGVuZCgiLCAnU0VUIE5VTEwnLCAiKS5hcHBlbmQobWV0YS5pbXBv\ncnRlZEtleVNldE51bGwpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1NFVCBE\nRUZBVUxUJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0\nKS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CgogICAgICAgIFN0cmluZ0J1\nZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFw\ncGVuZCgiU0VMRUNUIHQyLk9XTkVSIEFTIFBLVEFCTEVfU0NIRU0sICIpLgog\nICAgICAgICAgICBhcHBlbmQoInQyLlRBQkxFX05BTUUgQVMgUEtUQUJMRV9O\nQU1FLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0Mi5DT0xVTU5fTkFNRSBB\nUyBQS0NPTFVNTl9OQU1FLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5P\nV05FUiBBUyBGS1RBQkxFX1NDSEVNLCAiKS4KICAgICAgICAgICAgYXBwZW5k\nKCJ0MC5UQUJMRV9OQU1FIEFTIEZLVEFCTEVfTkFNRSwgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgidDAuQ09MVU1OX05BTUUgQVMgRktDT0xVTU5fTkFNRSwg\nIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuUE9TSVRJT04gQVMgS0VZX1NF\nUSwgIikuCiAgICAgICAgICAgIGFwcGVuZChkZWxBY3Rpb24pLmFwcGVuZCgi\nIEFTIERFTEVURV9SVUxFLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5D\nT05TVFJBSU5UX05BTUUgQVMgRktfTkFNRSwgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgiREVDT0RFKHQxLkRFRkVSUkVELCAnREVGRVJSRUQnLCAiKS4KICAg\nICAgICAgICAgYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZl\ncnJlZCkuCiAgICAgICAgICAgIGFwcGVuZCgiLCAnSU1NRURJQVRFJywgIiku\nCiAgICAgICAgICAgIGFwcGVuZChtZXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5\nSW1tZWRpYXRlKS4KICAgICAgICAgICAgYXBwZW5kKCIpIEFTIERFRkVSUkFC\nSUxJVFkgIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19D\nT0xVTU5TIHQwLCBBTExfQ09OU1RSQUlOVFMgdDEsICIpLgogICAgICAgICAg\nICBhcHBlbmQoIkFMTF9DT05TX0NPTFVNTlMgdDIgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgiV0hFUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAg\nICAgICAgYXBwZW5kKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09O\nU1RSQUlOVF9OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5D\nT05TVFJBSU5UX1RZUEUgPSAnUicgIikuCiAgICAgICAgICAgIGFwcGVuZCgi\nQU5EIHQxLlJfT1dORVIgPSB0Mi5PV05FUiAiKS4KICAgICAgICAgICAgYXBw\nZW5kKCJBTkQgdDEuUl9DT05TVFJBSU5UX05BTUUgPSB0Mi5DT05TVFJBSU5U\nX05BTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQwLlBPU0lUSU9O\nID0gdDIuUE9TSVRJT04iKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBu\ndWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLk9XTkVSID0g\nPyIpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIiBPUkRFUiBCWSB0Mi5PV05FUiwgdDIuVEFCTEVf\nTkFNRSwgdDAuUE9TSVRJT04iKTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5n\nKCkpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaW50IGlkeCA9IDE7CiAgICAgICAgICAgIGlmIChz\nY2hlbWFOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmco\nc3RtbnQsIGlkeCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwp\nOwogICAgICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9V\ncHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIHNldFRpbWVvdXRzKHN0\nbW50LCBjb25mLCBmYWxzZSk7CiAgICAgICAgICAgIHJzID0gc3RtbnQuZXhl\nY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3QgZmtMaXN0ID0gbmV3IEFy\ncmF5TGlzdCgpOwogICAgICAgICAgICB3aGlsZSAocnMgIT0gbnVsbCAmJiBy\ncy5uZXh0KCkpCiAgICAgICAgICAgICAgICBma0xpc3QuYWRkKG5ld0ZvcmVp\nZ25LZXkocnMpKTsKICAgICAgICAgICAgcmV0dXJuIChGb3JlaWduS2V5W10p\nIGZrTGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IEZvcmVpZ25L\nZXlbZmtMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBycy5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50LmNsb3Nl\nKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZ1td\nIGdldENyZWF0ZVRhYmxlU1FMKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgLy8g\nb25seSBvdmVycmlkZSBpZiB3ZSBhcmUgc2ltdWxhdGluZyBhdXRvLWluY3Jl\nbWVuZXQgd2l0aCB0cmlnZ2VycwogICAgICAgIFN0cmluZ1tdIGNyZWF0ZSA9\nIHN1cGVyLmdldENyZWF0ZVRhYmxlU1FMKHRhYmxlKTsKICAgICAgICBpZiAo\nIXVzZVRyaWdnZXJzRm9yQXV0b0Fzc2lnbikKICAgICAgICAgICAgcmV0dXJu\nIGNyZWF0ZTsKCiAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdldENv\nbHVtbnMoKTsKICAgICAgICBMaXN0IHNlcXMgPSBudWxsOwogICAgICAgIFN0\ncmluZyBzZXEsIHRyaWc7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbHMg\nIT0gbnVsbCAmJiBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAoIWNvbHNbaV0uaXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoc2VxcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgc2VxcyA9IG5ldyBBcnJheUxpc3QoNCk7CgogICAg\nICAgICAgICBzZXEgPSBhdXRvQXNzaWduU2VxdWVuY2VOYW1lOwogICAgICAg\nICAgICBpZiAoc2VxID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChv\ncGVuanBhM0dlbmVyYXRlZEtleU5hbWVzKQogICAgICAgICAgICAgICAgICAg\nIHNlcSA9IGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNv\nbHNbaV0pOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNlcSA9IGdldEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2xzW2ld\nKTsKICAgICAgICAgICAgICAgIHNlcXMuYWRkKCJDUkVBVEUgU0VRVUVOQ0Ug\nIiArIHNlcSArICIgU1RBUlQgV0lUSCAxIik7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKG9wZW5qcGEzR2VuZXJhdGVkS2V5TmFtZXMpCiAgICAg\nICAgICAgICAgICB0cmlnID0gZ2V0T3BlbkpQQTNHZW5lcmF0ZWRLZXlUcmln\nZ2VyTmFtZShjb2xzW2ldKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgdHJpZyA9IGdldEdlbmVyYXRlZEtleVRyaWdnZXJOYW1lKGNvbHNb\naV0pOwoKICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSB0cmlnZ2VyIHRoYXQg\nd2lsbCBpbnNlcnQgbmV3IHZhbHVlcyBpbnRvCiAgICAgICAgICAgIC8vIHRo\nZSB0YWJsZSB3aGVuZXZlciBhIHJvdyBpcyBjcmVhdGVkCiAgICAgICAgICAg\nIHNlcXMuYWRkKCJDUkVBVEUgT1IgUkVQTEFDRSBUUklHR0VSICIgKyB0cmln\nCiAgICAgICAgICAgICAgICArICIgQkVGT1JFIElOU0VSVCBPTiAiICsgdGFi\nbGUuZ2V0TmFtZSgpCiAgICAgICAgICAgICAgICArICIgRk9SIEVBQ0ggUk9X\nIEJFR0lOIFNFTEVDVCAiICsgc2VxICsgIi5uZXh0dmFsIElOVE8gIgogICAg\nICAgICAgICAgICAgKyAiOm5ldy4iICsgY29sc1tpXS5nZXROYW1lKCkgKyAi\nIEZST00gRFVBTDsgIgogICAgICAgICAgICAgICAgKyAiRU5EICIgKyB0cmln\nICsgIjsiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZTsKCiAgICAgICAgLy8gY29tYmlu\nZSBjcmVhdGUgdGFibGUgc3FsIGFuZCBjcmVhdGUgc2VxZW5jZXMgc3FsCiAg\nICAgICAgU3RyaW5nW10gc3FsID0gbmV3IFN0cmluZ1tjcmVhdGUubGVuZ3Ro\nICsgc2Vxcy5zaXplKCldOwogICAgICAgIFN5c3RlbS5hcnJheWNvcHkoY3Jl\nYXRlLCAwLCBzcWwsIDAsIGNyZWF0ZS5sZW5ndGgpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc2Vxcy5zaXplKCk7IGkrKykKICAgICAgICAgICAg\nc3FsW2NyZWF0ZS5sZW5ndGggKyBpXSA9IChTdHJpbmcpIHNlcXMuZ2V0KGkp\nOwogICAgICAgIHJldHVybiBzcWw7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZ1tdIGdldENyZWF0ZVNlcXVlbmNlU1FMKFNlcXVlbmNlIHNlcSkgewogICAg\nICAgIFN0cmluZ1tdIHNxbCA9IHN1cGVyLmdldENyZWF0ZVNlcXVlbmNlU1FM\nKHNlcSk7CiAgICAgICAgaWYgKHNlcS5nZXRBbGxvY2F0ZSgpID4gMSkKICAg\nICAgICAgICAgc3FsWzBdICs9ICIgQ0FDSEUgIiArIHNlcS5nZXRBbGxvY2F0\nZSgpOwogICAgICAgIHJldHVybiBzcWw7CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVzfSBjb25z\ndGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5cGVzfSBv\nciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAqLwogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgaW50IGdldEpEQkNUeXBlKGludCBtZXRh\nVHlwZUNvZGUsIGJvb2xlYW4gbG9iLCBpbnQgcHJlY2lzLCAKICAgICAgICBp\nbnQgc2NhbGUsIGJvb2xlYW4geG1sKSB7ICAgICAgICAKICAgICAgICByZXR1\ncm4gZ2V0SkRCQ1R5cGUobWV0YVR5cGVDb2RlLCBsb2IgJiYgIXhtbCwgcHJl\nY2lzLCBzY2FsZSk7ICAgICAgICAKICAgIH0KCgogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXRTZXF1ZW5jZXNTUUwoU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmlu\nZyBzZXF1ZW5jZU5hbWUpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0g\nbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVD\nVCBTRVFVRU5DRV9PV05FUiBBUyBTRVFVRU5DRV9TQ0hFTUEsICIpLgogICAg\nICAgICAgICBhcHBlbmQoIlNFUVVFTkNFX05BTUUgRlJPTSBBTExfU0VRVUVO\nQ0VTIik7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCB8fCBzZXF1\nZW5jZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIFdI\nRVJFICIpOwogICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwpIHsKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiU0VRVUVOQ0VfT1dORVIgPSA/Iik7CiAg\nICAgICAgICAgIGlmIChzZXF1ZW5jZU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgfQogICAgICAg\nIGlmIChzZXF1ZW5jZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiU0VRVUVOQ0VfTkFNRSA9ID8iKTsKICAgICAgICByZXR1cm4gYnVm\nLnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0\nZW1TZXF1ZW5jZShTdHJpbmcgbmFtZSwgU3RyaW5nIHNjaGVtYSwKICAgICAg\nICBib29sZWFuIHRhcmdldFNjaGVtYSkgewogICAgICAgIGlmIChzdXBlci5p\nc1N5c3RlbVNlcXVlbmNlKG5hbWUsIHNjaGVtYSwgdGFyZ2V0U2NoZW1hKSkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIGZpbHRlciBv\ndXQgZ2VuZXJhdGVkIHNlcXVlbmNlcyB1c2VkIGZvciBhdXRvLWFzc2lnbgog\nICAgICAgIHJldHVybiAoYXV0b0Fzc2lnblNlcXVlbmNlTmFtZSAhPSBudWxs\nCiAgICAgICAgICAgICYmIG5hbWUuZXF1YWxzSWdub3JlQ2FzZShhdXRvQXNz\naWduU2VxdWVuY2VOYW1lKSkKICAgICAgICAgICAgfHwgKGF1dG9Bc3NpZ25T\nZXF1ZW5jZU5hbWUgPT0gbnVsbAogICAgICAgICAgICAmJiBuYW1lLnRvVXBw\nZXJDYXNlKCkuc3RhcnRzV2l0aCgiU1RfIikpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0R2VuZXJhdGVkS2V5KENvbHVtbiBjb2wsIENvbm5lY3Rp\nb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoIXVzZVRyaWdnZXJzRm9yQXV0b0Fzc2lnbikKICAgICAgICAgICAg\ncmV0dXJuIE51bWJlcnMudmFsdWVPZigwTCk7CgogICAgICAgIC8vIGlmIHdl\nIHNpbXVsYXRlIGF1dG8tYXNzaWduZWQgY29sdW1ucyB1c2luZyB0cmlnZ2Vy\ncyBhbmQKICAgICAgICAvLyBzZXF1ZW5jZXMsIHRoZW4gcmV0dXJuIHRoZSBj\ndXJyZW50IHZhbHVlIG9mIHRoZSBzZXF1ZW5jZQogICAgICAgIC8vIGZyb20g\nYXV0b0Fzc2lnblNlcXVlbmNlTmFtZQogICAgICAgIFN0cmluZyBzZXEgPSBh\ndXRvQXNzaWduU2VxdWVuY2VOYW1lOwogICAgICAgIGlmIChzZXEgPT0gbnVs\nbCAmJiBvcGVuanBhM0dlbmVyYXRlZEtleU5hbWVzKQogICAgICAgICAgICBz\nZXEgPSBnZXRPcGVuSlBBM0dlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHNlcSA9PSBudWxsKQogICAgICAgICAgICBz\nZXEgPSBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAg\nICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFyZVN0YXRl\nbWVudCgiU0VMRUNUICIgKyBzZXEKICAgICAgICAgICAgKyAiLmN1cnJ2YWwg\nRlJPTSBEVUFMIik7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBzZXRUaW1lb3V0cyhzdG1udCwgY29u\nZiwgZmFsc2UpOwogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVy\neSgpOwogICAgICAgICAgICBycy5uZXh0KCk7CiAgICAgICAgICAgIHJldHVy\nbiBOdW1iZXJzLnZhbHVlT2YocnMuZ2V0TG9uZygxKSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICB0cnkgeyBycy5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHt9CiAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUcmlnZ2VyIG5hbWUgZm9yIHNpbXVsYXRpbmcgYXV0\nby1hc3NpZ24gdmFsdWVzIG9uIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0R2VuZXJhdGVkS2V5VHJpZ2dlck5h\nbWUoQ29sdW1uIGNvbCkgewogICAgICAgIC8vIHJlcGxhY2UgdHJhaWxpbmcg\nX1NFUSB3aXRoIF9UUkcKICAgICAgICBTdHJpbmcgc2VxTmFtZSA9IGdldEdl\nbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2wpOwogICAgICAgIHJldHVybiBz\nZXFOYW1lLnN1YnN0cmluZygwLCBzZXFOYW1lLmxlbmd0aCgpIC0gMykgKyAi\nVFJHIjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSBPcGVuSlBB\nIDMtY29tcGF0aWJsZSBuYW1lIGZvciBhbiBhdXRvLWFzc2lnbiBzZXF1ZW5j\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRPcGVuSlBBM0dl\nbmVyYXRlZEtleVNlcXVlbmNlTmFtZShDb2x1bW4gY29sKSB7CiAgICAgICAg\nVGFibGUgdGFibGUgPSBjb2wuZ2V0VGFibGUoKTsKICAgICAgICByZXR1cm4g\nbWFrZU5hbWVWYWxpZCgiU0VRXyIgKyB0YWJsZS5nZXROYW1lKCksIHRhYmxl\nLmdldFNjaGVtYSgpLgogICAgICAgICAgICBnZXRTY2hlbWFHcm91cCgpLCBt\nYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgYSBPcGVuSlBBIDMtY29tcGF0aWJsZSBuYW1lIGZv\nciBhbiBhdXRvLWFzc2lnbiB0cmlnZ2VyLgogICAgICovCiAgICBwcm90ZWN0\nZWQgU3RyaW5nIGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5VHJpZ2dlck5hbWUo\nQ29sdW1uIGNvbCkgewogICAgICAgIFRhYmxlIHRhYmxlID0gY29sLmdldFRh\nYmxlKCk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlRSSUdfIiAr\nIHRhYmxlLmdldE5hbWUoKSwgdGFibGUuZ2V0U2NoZW1hKCkuCiAgICAgICAg\nICAgIGdldFNjaGVtYUdyb3VwKCksIG1heFRhYmxlTmFtZUxlbmd0aCwgTkFN\nRV9BTlkpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdz\nIDxjb2RlPnB1dEJ5dGVzPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIEJM\nT0Igb2JqZWN0LgogICAgICogVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhl\nIGJsb2IgaXMgd3JhcHBlZCBpbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3Bl\nY2lmaWMgY2xhc3M7IGZvciBleGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNs\nZSB0aGluIGRyaXZlcgogICAgICogbG9icyBpbiBpdHMgb3duIGludGVyZmFj\nZXMgd2l0aCB0aGUgc2FtZSBtZXRob2RzLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBwdXRCeXRlcyhCbG9iIGJsb2IsIGJ5dGVbXSBkYXRhKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChibG9iID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX3B1dEJ5dGVz\nID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIF9wdXRCeXRlcyA9IGJsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInB1dEJ5\ndGVzIiwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5j\nbGFzcywgYnl0ZVtdLmNsYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3Jl\nRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGludm9rZVB1dExvYk1ldGhvZChfcHV0Qnl0ZXMsIGJsb2IsIGRhdGEpOwog\nICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1\ndFN0cmluZzwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CIG9iamVj\ndC4KICAgICAqIFVzZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlz\nIHdyYXBwZWQgaW4gYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNs\nYXNzOyBmb3IgZXhhbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBk\ncml2ZXIKICAgICAqIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGgg\ndGhlIHNhbWUgbWV0aG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0\nU3RyaW5nKENsb2IgY2xvYiwgU3RyaW5nIGRhdGEpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9wdXRTdHJpbmcgPT0gbnVs\nbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3B1dFN0\ncmluZyA9IGNsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInB1dFN0cmluZyIs\nCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGxvbmcuY2xhc3Ms\nIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2Vw\ndGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpbnZv\na2VQdXRMb2JNZXRob2QoX3B1dFN0cmluZywgY2xvYiwgZGF0YSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJbnZva2UgT3JhY2xlJ3MgPGNvZGU+cHV0Q2hh\ncnM8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQ0xPQgogICAgICogb2Jq\nZWN0LiBVc2VzIHJlZmxlY3Rpb24gaW4gY2FzZSB0aGUgY2xvYiBpcyB3cmFw\ncGVkIGluIGFub3RoZXIKICAgICAqIHZlbmRvci1zcGVjaWZpYyBjbGFzczsg\nZm9yIGV4YW1wbGUgV2VibG9naWMgd3JhcHMgb3JhY2xlIHRoaW4gZHJpdmVy\nCiAgICAgKiBsb2JzIGluIGl0cyBvd24gaW50ZXJmYWNlcyB3aXRoIHRoZSBz\nYW1lIG1ldGhvZHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dENoYXJz\nKENsb2IgY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKF9wdXRDaGFycyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcHV0Q2hhcnMgPSBj\nbG9iLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJwdXRDaGFycyIsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IGxvbmcuY2xhc3MsIGNoYXJbXS5j\nbGFzcyB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpbnZva2VQdXRMb2JN\nZXRob2QoX3B1dENoYXJzLCBjbG9iLCBkYXRhKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludm9rZSB0aGUgZ2l2ZW4gTE9CIG1ldGhvZCBvbiB0aGUgZ2l2\nZW4gdGFyZ2V0IHdpdGggdGhlIGdpdmVuIGRhdGEuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIHZvaWQgaW52b2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBt\nZXRob2QsIE9iamVjdCB0YXJnZXQsCiAgICAgICAgT2JqZWN0IGRhdGEpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgbWV0aG9kLmludm9rZSh0YXJnZXQsIG5ldyBPYmplY3RbXXsg\nTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgICAgICB9IGNhdGNo\nIChJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uIGl0ZSkgewogICAgICAgICAg\nICBUaHJvd2FibGUgdCA9IGl0ZS5nZXRUYXJnZXRFeGNlcHRpb24oKTsKICAg\nICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBTUUxFeGNlcHRpb24pCiAgICAg\nICAgICAgICAgICB0aHJvdyhTUUxFeGNlcHRpb24pIHQ7CiAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbih0KTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVF\neGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgQ2xv\nYiBnZXRFbXB0eUNsb2IoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChFTVBUWV9DTE9CICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBFTVBUWV9DTE9COwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBFTVBUWV9DTE9CID0gKENsb2IpIENsYXNzLmZvck5hbWUoIm9y\nYWNsZS5zcWwuQ0xPQiIsdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb250ZXh0Q2xhc3NMb2Fk\nZXJBY3Rpb24oKSkpLgogICAgICAgICAgICAgICAgZ2V0TWV0aG9kKCJlbXB0\neV9sb2IiLCBuZXcgQ2xhc3NbMF0pLgogICAgICAgICAgICAgICAgaW52b2tl\nKG51bGwsIG5ldyBPYmplY3RbMF0pOwogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24o\nZS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIEJsb2IgZ2V0RW1wdHlCbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoRU1QVFlfQkxPQiAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gRU1QVFlfQkxPQjsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gRU1QVFlfQkxPQiA9IChCbG9iKSBDbGFzcy5mb3JOYW1l\nKCJvcmFjbGUuc3FsLkJMT0IiLHRydWUsIAogICAgICAgICAgICAgICAgICAg\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVy\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29udGV4dENsYXNz\nTG9hZGVyQWN0aW9uKCkpKS4KICAgICAgICAgICAgICAgIGdldE1ldGhvZCgi\nZW1wdHlfbG9iIiwgbmV3IENsYXNzWzBdKS4KICAgICAgICAgICAgICAgIGlu\ndm9rZShudWxsLCBuZXcgT2JqZWN0WzBdKTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0\naW9uKGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgYm9vbGVhbiBpc09yYWNsZVByZXBhcmVkU3RhdGVtZW50\nKFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBDbGFzcy5mb3JOYW1lKCJvcmFjbGUuamRiYy5PcmFjbGVQcmVw\nYXJlZFN0YXRlbWVudCIpLgogICAgICAgICAgICAgICAgaXNJbnN0YW5jZShz\ndG1udCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBJZiB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgWE1MIHR5\ncGUsCiAgICAgKiB1c2UgdGhpcyBtZXRob2QgdG8gYXBwZW5kIHhtbCBwcmVk\naWNhdGUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZm\nZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0\naGUgY29tcGFyaXNvbiBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBh\ncmFtIGxocyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24K\nICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUg\nY29tcGFyaXNvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRYbWxD\nb21wYXJpc29uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVyVmFs\ndWUgbGhzLAogICAgICAgIEZpbHRlclZhbHVlIHJocywgYm9vbGVhbiBsaHN4\nbWwsIGJvb2xlYW4gcmhzeG1sKSB7CiAgICAgICAgc3VwZXIuYXBwZW5kWG1s\nQ29tcGFyaXNvbihidWYsIG9wLCBsaHMsIHJocywgbGhzeG1sLCByaHN4bWwp\nOwogICAgICAgIGlmIChsaHN4bWwgJiYgcmhzeG1sKQogICAgICAgICAgICBh\ncHBlbmRYbWxDb21wYXJpc29uMihidWYsIG9wLCBsaHMsIHJocyk7CiAgICAg\nICAgZWxzZSBpZiAobGhzeG1sKQogICAgICAgICAgICBhcHBlbmRYbWxDb21w\nYXJpc29uMShidWYsIG9wLCBsaHMsIHJocyk7CiAgICAgICAgZWxzZSAKICAg\nICAgICAgICAgYXBwZW5kWG1sQ29tcGFyaXNvbjEoYnVmLCBvcCwgcmhzLCBs\naHMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFwcGVuZCBhbiB4bWwg\nY29tcGFyaXNvbiBwcmVkaWNhdGUKICAgICAqCiAgICAgKiBAcGFyYW0gYnVm\nIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAg\nKiBAcGFyYW0gb3AgdGhlIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZv\ncm0KICAgICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRo\nZSBjb21wYXJpc29uIChtYXBzIHRvIHhtbCBjb2x1bW4pCiAgICAgKiBAcGFy\nYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFwcGVuZFhtbENvbXBhcmlzb24x\nKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwKICAgICAgICBGaWx0ZXJWYWx1\nZSBsaHMsIEZpbHRlclZhbHVlIHJocykgewogICAgICAgIGFwcGVuZFhtbEV4\ndHJhY3RWYWx1ZShidWYsIGxocyk7CiAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZChvcCkuYXBwZW5kKCIgIik7CiAgICAgICAgcmhzLmFwcGVuZFRv\nKGJ1Zik7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQXBwZW5kIGFuIHht\nbCBjb21wYXJpc29uIHByZWRpY2F0ZSAoYm90aCBvcGVyYW5kcyBtYXAgdG8g\neG1sIGNvbHVtbikKICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwg\nYnVmZmVyIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFyYW0g\nb3AgdGhlIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAgICAq\nIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJp\nc29uIChtYXBzIHRvIHhtbCBjb2x1bW4pCiAgICAgKiBAcGFyYW0gcmhzIHRo\nZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8g\neG1sIGNvbHVtbikKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFwcGVuZFht\nbENvbXBhcmlzb24yKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgCiAgICAg\nICAgRmlsdGVyVmFsdWUgbGhzLCBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAg\nICBhcHBlbmRYbWxFeHRyYWN0VmFsdWUoYnVmLCBsaHMpOwogICAgICAgIGJ1\nZi5hcHBlbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwogICAgICAg\nIGFwcGVuZFhtbEV4dHJhY3RWYWx1ZShidWYsIHJocyk7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxFeHRyYWN0VmFsdWUoU1FMQnVm\nZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgdmFsKSB7CiAgICAgICAgYnVmLmFwcGVu\nZCgiZXh0cmFjdFZhbHVlKCIpLgogICAgICAgICAgICBhcHBlbmQodmFsLmdl\ndENvbHVtbkFsaWFzKAogICAgICAgICAgICB2YWwuZ2V0RmllbGRNYXBwaW5n\nKCkuZ2V0Q29sdW1ucygpWzBdKSkuCiAgICAgICAgICAgIGFwcGVuZCgiLCcv\nKi8iKTsKICAgICAgICB2YWwuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYu\nYXBwZW5kKCInKSIpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBpbnNl\ncnRDbG9iRm9yU3RyZWFtaW5nTG9hZChSb3cgcm93LCBDb2x1bW4gY29sLCBP\nYmplY3Qgb2IpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKG9iID09IG51bGwpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5\ncGVzLk9USEVSKTsKICAgICAgICByb3cuc2V0TnVsbChjb2wpOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZ2V0QmF0Y2hVcGRhdGVDb3VudChQcmVwYXJlZFN0\nYXRlbWVudCBwcykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaW50\nIHVwZGF0ZVN1Y2Nlc3NDbnQgPSAwOwogICAgICAgIGlmIChiYXRjaExpbWl0\nICE9IDAgJiYgcHMgIT0gbnVsbCkgewogICAgICAgICAgICB1cGRhdGVTdWNj\nZXNzQ250ID0gcHMuZ2V0VXBkYXRlQ291bnQoKTsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJiYXRjaC11cGRhdGUtc3VjY2Vzcy1jb3VudCIsCiAg\nICAgICAgICAgICAgICAgICAgdXBkYXRlU3VjY2Vzc0NudCkpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdXBkYXRlU3VjY2Vzc0NudDsKICAgIH0KICAg\nIAogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgQm9vbGVhbiBtYXRjaEVy\ncm9yU3RhdGUoaW50IHN1YnR5cGUsIFNldDxTdHJpbmc+IGVycm9yU3RhdGVz\nLAogICAgICAgIFNRTEV4Y2VwdGlvbiBleCkgewogICAgICAgIEJvb2xlYW4g\ncmVjb3ZlcmFibGUgPSBudWxsOwogICAgICAgIFN0cmluZyBlcnJvclN0YXRl\nID0gZXguZ2V0U1FMU3RhdGUoKTsKICAgICAgICBpbnQgZXJyb3JDb2RlID0g\nZXguZ2V0RXJyb3JDb2RlKCk7CiAgICAgICAgaWYgKGVycm9yU3RhdGVzLmNv\nbnRhaW5zKGVycm9yU3RhdGUpKSB7CiAgICAgICAgICAgIHJlY292ZXJhYmxl\nID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgaWYgKChzdWJ0eXBlID09\nIFN0b3JlRXhjZXB0aW9uLkxPQ0spCiAgICAgICAgICAgICAgICAmJiAoKGVy\ncm9yU3RhdGUuZXF1YWxzKCI2MTAwMCIpICYmIChlcnJvckNvZGUgPT0gNTQg\nfHwKICAgICAgICAgICAgICAgICAgICAgZXJyb3JDb2RlID09IDYwIHx8IGVy\ncm9yQ29kZSA9PSA0MDIwIHx8CiAgICAgICAgICAgICAgICAgICAgIGVycm9y\nQ29kZSA9PSA0MDIxIHx8IGVycm9yQ29kZSA9PSA0MDIyKSkKICAgICAgICAg\nICAgICAgICAgICB8fCAoZXJyb3JTdGF0ZS5lcXVhbHMoIjQyMDAwIikgJiYg\nZXJyb3JDb2RlID09IDIwNDkpKSkgewogICAgICAgICAgICAgICAgcmVjb3Zl\ncmFibGUgPSBCb29sZWFuLlRSVUU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\nc3VidHlwZSA9PSBTdG9yZUV4Y2VwdGlvbi5RVUVSWSAmJgogICAgICAgICAg\nICAgICAgZXJyb3JTdGF0ZS5lcXVhbHMoIjcyMDAwIikgJiYgZXJyb3JDb2Rl\nID09IDEwMTMpIHsKICAgICAgICAgICAgICAgIHJlY292ZXJhYmxlID0gQm9v\nbGVhbi5UUlVFOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiByZWNvdmVyYWJsZTsKICAgIH0KICAgIAogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgdm9pZCBpbnNlcnRCbG9iRm9yU3RyZWFtaW5nTG9hZChSb3cg\ncm93LCBDb2x1bW4gY29sLCAKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIE9i\namVjdCBvYiwgU2VsZWN0IHNlbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKG9iID09IG51bGwpCiAgICAgICAgICAgIGNvbC5zZXRUeXBl\nKFR5cGVzLk9USEVSKTsKICAgICAgICByb3cuc2V0TnVsbChjb2wpOwogICAg\nfSAgICAKfQo=\n","encoding":"base64"}

