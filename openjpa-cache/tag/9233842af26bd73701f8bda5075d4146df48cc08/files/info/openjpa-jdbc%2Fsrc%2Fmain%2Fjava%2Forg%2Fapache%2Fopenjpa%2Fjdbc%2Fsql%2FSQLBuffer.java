{"sha":"df3d458703ee049ee5168d9c337c0409ab6bced4","node_id":"MDQ6QmxvYjIwNjM2NDpkZjNkNDU4NzAzZWUwNDllZTUxNjhkOWMzMzdjMDQwOWFiNmJjZWQ0","size":22048,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/df3d458703ee049ee5168d9c337c0409ab6bced4","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5DYWxsYWJs\nZVN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9y\ndCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuVmFsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TZXF1ZW5jZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXJhbWV0ZXI7Cgpp\nbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogQnVmZmVyIGZvciBT\nUUwgc3RhdGVtZW50cyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNyZWF0ZQogKiBq\nYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudHMuCiAqIFRoaXMgYnVmZmVyIGhv\nbGRzIHRoZSBTUUwgc3RhdGVtZW50IHBhcmFtZXRlcnMgYW5kIHRoZWlyIGNv\ncnJlc3BvbmRpbmcgCiAqIGNvbHVtbnMuIFRoZSBwYXJhbWV0ZXJzIGludHJv\nZHVjZWQgYnkgdGhlIHJ1bnRpbWUgc3lzdGVtIGFyZSBkaXN0aW5ndWlzaGVk\nCiAqIGZyb20gdGhlIHBhcmFtZXRlcnMgc2V0IGJ5IHRoZSB1c2VyLiAgCiAq\nCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgQWJl\nIFdoaXRlCiAqIEBhdXRob3IgUGluYWtpIFBvZGRhcgogKiAKICogQHNpbmNl\nIDAuMi40CiAqLwpwdWJsaWMgZmluYWwgY2xhc3MgU1FMQnVmZmVyCiAgICBp\nbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSwgQ2xvbmVhYmxlIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgUEFSQU1FVEVSX1RPS0VOID0gIj8i\nOwoKICAgIHByaXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0OwogICAg\ncHJpdmF0ZSBmaW5hbCBTdHJpbmdCdWlsZGVyIF9zcWwgPSBuZXcgU3RyaW5n\nQnVpbGRlcigpOwogICAgcHJpdmF0ZSBMaXN0IF9zdWJzZWxzID0gbnVsbDsK\nICAgIHByaXZhdGUgTGlzdCBfcGFyYW1zID0gbnVsbDsKICAgIHByaXZhdGUg\nTGlzdCBfY29scyA9IG51bGw7CiAgICAKICAgIC8vIEV2ZW4gZWxlbWVudCBy\nZWZlcnMgdG8gYW4gaW5kZXggb2YgdGhlIF9wYXJhbXMgbGlzdAogICAgLy8g\nT2RkIGVsZW1lbnQgcmVmZXJzIHRvIHRoZSB1c2VyIHBhcmFtZXRlciBrZXkK\nICAgIHByaXZhdGUgTGlzdCBfdXNlckluZGV4ID0gbnVsbDsKICAgIAogICAg\nLyoqCiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLgogICAgICovCiAgICBw\ndWJsaWMgU1FMQnVmZmVyKERCRGljdGlvbmFyeSBkaWN0KSB7CiAgICAgICAg\nX2RpY3QgPSBkaWN0OwogICAgfQoKICAgIC8qKgogICAgICogQ29weSBjb25z\ndHJ1Y3Rvci4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlcihTUUxCdWZm\nZXIgYnVmKSB7CiAgICAgICAgX2RpY3QgPSBidWYuX2RpY3Q7CiAgICAgICAg\nYXBwZW5kKGJ1Zik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGEg\nc2hhbGxvdyBjbG9uZSBvZiB0aGlzIFNRTCBCdWZmZXIuCiAgICAgKi8KICAg\nIHB1YmxpYyBPYmplY3QgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\nUUxCdWZmZXIodGhpcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndHJ1ZSBpZiB0aGUgYnVmZmVyIGlzIGVtdHB5LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgIHJldHVybiBfc3FsLmxl\nbmd0aCgpID09IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYWxs\nIFNRTCBhbmQgcGFyYW1ldGVycyBvZiB0aGUgZ2l2ZW4gYnVmZmVyLgogICAg\nICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChTUUxCdWZmZXIgYnVm\nKSB7CiAgICAgICAgYXBwZW5kKGJ1ZiwgX3NxbC5sZW5ndGgoKSwgKF9wYXJh\nbXMgPT0gbnVsbCkgPyAwIDogX3BhcmFtcy5zaXplKCksCiAgICAgICAgICAg\nIHRydWUpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8qKgog\nICAgICogQXBwZW5kIGFsbCBTUUwgYW5kIHBhcmFtZXRlcnMgb2YgdGhlIGdp\ndmVuIGJ1ZmZlciBhdCB0aGUgZ2l2ZW4gcG9zaXRpb25zLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYXBwZW5kKFNRTEJ1ZmZlciBidWYsIGludCBzcWxJ\nbmRleCwgaW50IHBhcmFtSW5kZXgsCiAgICAgICAgYm9vbGVhbiBzdWJzZWxz\nKSB7CiAgICAgICAgaWYgKHN1YnNlbHMpIHsKICAgICAgICAgICAgLy8gb25s\neSBhbGxvdyBhcHBlbmRpbmcgb2YgYnVmZmVycyB3aXRoIHN1YnNlbGVjdHMs\nIG5vdCBpbnNlcnRpb24KICAgICAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51\nbGwgJiYgIV9zdWJzZWxzLmlzRW1wdHkoKQogICAgICAgICAgICAgICAgJiYg\nc3FsSW5kZXggIT0gX3NxbC5sZW5ndGgoKSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKTsKICAgICAgICAgICAg\naWYgKGJ1Zi5fc3Vic2VscyAhPSBudWxsICYmICFidWYuX3N1YnNlbHMuaXNF\nbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoc3FsSW5kZXggIT0gX3Nx\nbC5sZW5ndGgoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoX3N1\nYnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfc3Vic2VscyA9\nIG5ldyBBcnJheUxpc3QoYnVmLl9zdWJzZWxzLnNpemUoKSk7CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJ1Zi5fc3Vic2Vscy5zaXpl\nKCk7IGkrKykKICAgICAgICAgICAgICAgICAgICBfc3Vic2Vscy5hZGQoKChT\ndWJzZWxlY3QpIGJ1Zi5fc3Vic2Vscy5nZXQoaSkpLgogICAgICAgICAgICAg\nICAgICAgICAgICBjbG9uZShzcWxJbmRleCwgcGFyYW1JbmRleCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3FsSW5kZXggPT0g\nX3NxbC5sZW5ndGgoKSkKICAgICAgICAgICAgX3NxbC5hcHBlbmQoYnVmLl9z\ncWwudG9TdHJpbmcoKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfc3Fs\nLmluc2VydChzcWxJbmRleCwgYnVmLl9zcWwudG9TdHJpbmcoKSk7CgogICAg\nICAgIGlmIChidWYuX3BhcmFtcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlm\nIChfcGFyYW1zID09IG51bGwpCiAgICAgICAgICAgICAgICBfcGFyYW1zID0g\nbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICBpZiAoX2NvbHMgPT0gbnVs\nbCAmJiBidWYuX2NvbHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2Nv\nbHMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICB3aGlsZSAo\nX2NvbHMuc2l6ZSgpIDwgX3BhcmFtcy5zaXplKCkpCiAgICAgICAgICAgICAg\nICAgICAgX2NvbHMuYWRkKG51bGwpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBpZiAocGFyYW1JbmRleCA9PSBfcGFyYW1zLnNpemUoKSkgewogICAg\nICAgICAgICAgICAgX3BhcmFtcy5hZGRBbGwoYnVmLl9wYXJhbXMpOwogICAg\nICAgICAgICAgICAgaWYgKGJ1Zi5fY29scyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIF9jb2xzLmFkZEFsbChidWYuX2NvbHMpOwogICAgICAgICAg\nICAgICAgZWxzZSBpZiAoX2NvbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICB3aGlsZSAoX2NvbHMuc2l6ZSgpIDwgX3BhcmFtcy5zaXplKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9jb2xzLmFkZChudWxsKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9wYXJhbXMuYWRkQWxs\nKHBhcmFtSW5kZXgsIGJ1Zi5fcGFyYW1zKTsKICAgICAgICAgICAgICAgIGlm\nIChidWYuX2NvbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfY29s\ncy5hZGRBbGwocGFyYW1JbmRleCwgYnVmLl9jb2xzKTsKICAgICAgICAgICAg\nICAgIGVsc2UgaWYgKF9jb2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgd2hpbGUgKF9jb2xzLnNpemUoKSA8IF9wYXJhbXMuc2l6ZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBfY29scy5hZGQocGFyYW1JbmRleCwgbnVs\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGJ1Zi5f\ndXNlckluZGV4ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF91c2VySW5k\nZXggPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91c2VySW5kZXggPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nYnVmLl91c2VySW5kZXguc2l6ZSgpOyBpKz0yKSB7CiAgICAgICAgICAgICAg\nICBpbnQgbmV3SW5kZXggPSAoKEludGVnZXIpYnVmLl91c2VySW5kZXguZ2V0\nKGkpKS5pbnRWYWx1ZSgpIAogICAgICAgICAgICAgICAgICAgICsgcGFyYW1J\nbmRleDsKICAgICAgICAgICAgICAgIE9iamVjdCB1c2VyUGFyYW0gPSBidWYu\nX3VzZXJJbmRleC5nZXQoaSsxKTsKICAgICAgICAgICAgICAgIF91c2VySW5k\nZXguYWRkKG5ld0luZGV4KTsKICAgICAgICAgICAgICAgIF91c2VySW5kZXgu\nYWRkKHVzZXJQYXJhbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\neyAKICAgICAgICAgICAgaWYgKF91c2VySW5kZXggIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgTGlzdCB1c2VySW5kZXggPSBuZXcgQXJyYXlMaXN0KCk7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF91c2VySW5k\nZXguc2l6ZSgpOyBpKz0yKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IG9s\nZEluZGV4ID0gKChJbnRlZ2VyKV91c2VySW5kZXguZ2V0KGkpKS5pbnRWYWx1\nZSgpOwogICAgICAgICAgICAgICAgICAgIE9iamVjdCB1c2VyUGFyYW0gPSBf\ndXNlckluZGV4LmdldChpKzEpOwogICAgICAgICAgICAgICAgICAgIGlmIChv\nbGRJbmRleCA+PSBwYXJhbUluZGV4KSAKICAgICAgICAgICAgICAgICAgICAg\nICAgdXNlckluZGV4LmFkZChvbGRJbmRleCArIHBhcmFtSW5kZXgpOwogICAg\nICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICAgICAgICAg\nIHVzZXJJbmRleC5hZGQob2xkSW5kZXgpOwogICAgICAgICAgICAgICAgICAg\nIHVzZXJJbmRleC5hZGQodXNlclBhcmFtKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIF91c2VySW5kZXggPSB1c2VySW5kZXg7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciBhcHBlbmQoVGFibGUgdGFibGUpIHsKICAgICAgICBfc3FsLmFwcGVuZChf\nZGljdC5nZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChT\nZXF1ZW5jZSBzZXEpIHsKICAgICAgICBfc3FsLmFwcGVuZChfZGljdC5nZXRG\ndWxsTmFtZShzZXEpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChDb2x1bW4gY29sKSB7CiAgICAg\nICAgX3NxbC5hcHBlbmQoY29sLmdldE5hbWUoKSk7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmQoU3Ry\naW5nIHMpIHsKICAgICAgICBfc3FsLmFwcGVuZChzKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHN1YnNl\nbGVjdC4gVGhpcyBkZWxheXMgcmVzb2x1dGlvbiBvZiB0aGUgc2VsZWN0IFNR\nTC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmQoU2VsZWN0\nIHNlbCwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIHJldHVybiBhcHBlbmQoc2VsLCBmZXRjaCwgZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogQXBwZW5kIGEgc3Vic2VsZWN0IGNvdW50LiBUaGlzIGRl\nbGF5cyByZXNvbHV0aW9uIG9mIHRoZSBzZWxlY3QgU1FMLgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZENvdW50KFNlbGVjdCBzZWwsIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4g\nYXBwZW5kKHNlbCwgZmV0Y2gsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQXBwZW5kIGEgc3Vic2VsZWN0LiBUaGlzIGRlbGF5cyByZXNvbHV0aW9u\nIG9mIHRoZSBzZWxlY3QgU1FMLgogICAgICovCiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBhcHBlbmQoU2VsZWN0IHNlbCwgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwKICAgICAgICBib29sZWFuIGNvdW50KSB7CiAgICAgICAgX3Nx\nbC5hcHBlbmQoIigiKTsKICAgICAgICBTdWJzZWxlY3Qgc3ViID0gbmV3IFN1\nYnNlbGVjdCgpOwogICAgICAgIHN1Yi5zZWxlY3QgPSBzZWw7CiAgICAgICAg\nc3ViLmZldGNoID0gZmV0Y2g7CiAgICAgICAgc3ViLmNvdW50ID0gY291bnQ7\nCiAgICAgICAgc3ViLnNxbEluZGV4ID0gX3NxbC5sZW5ndGgoKTsKICAgICAg\nICBzdWIucGFyYW1JbmRleCA9IChfcGFyYW1zID09IG51bGwpID8gMCA6IF9w\nYXJhbXMuc2l6ZSgpOwogICAgICAgIF9zcWwuYXBwZW5kKCIpIik7CgogICAg\nICAgIGlmIChfc3Vic2VscyA9PSBudWxsKQogICAgICAgICAgICBfc3Vic2Vs\ncyA9IG5ldyBBcnJheUxpc3QoMik7CiAgICAgICAgX3N1YnNlbHMuYWRkKHN1\nYik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXBsYWNlIGEgc3Vic2VsZWN0LgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiByZXBsYWNlKFNlbGVjdCBvbGQsIFNlbGVjdCBzZWwpIHsKICAgICAg\nICBpZiAoX3N1YnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIFN1YnNlbGVjdCBzdWI7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBfc3Vic2Vscy5zaXplKCk7IGkrKykgewogICAgICAgICAg\nICBzdWIgPSAoU3Vic2VsZWN0KSBfc3Vic2Vscy5nZXQoaSk7CiAgICAgICAg\nICAgIGlmIChzdWIuc2VsZWN0ID09IG9sZCkgewogICAgICAgICAgICAgICAg\nc3ViLnNlbGVjdCA9IHNlbDsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2\nYWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1\nZShPYmplY3QgbykgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShvLCBu\ndWxsKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBzeXN0\nZW0gaW5zZXJ0ZWQgcGFyYW1ldGVyIHZhbHVlIGZvciBhIHNwZWNpZmljIGNv\nbHVtbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1\nZShPYmplY3QgbywgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBhcHBl\nbmRWYWx1ZShvLCBjb2wsIG51bGwpOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIEFwcGVuZCBhIHVzZXIgcGFyYW1ldGVyIHZhbHVlIGZvciBhIHNwZWNp\nZmljIGNvbHVtbi4gVXNlciBwYXJhbWV0ZXJzCiAgICAgKiBhcmUgbWFya2Vk\nIGFzIG9wcG9zZWQgdG8gdGhlIHBhcmFtZXRlcnMgaW5zZXJ0ZWQgYnkgdGhl\nIGludGVybmFsIHJ1bnRpbWUKICAgICAqIHN5c3RlbS4gVGhpcyBoZWxwcyB0\nbyByZXVzZSB0aGUgYnVmZmVyIGJ5IHJlcGFybWV0ZXJpemluZyBpdCB3aXRo\nIG5ldwogICAgICogc2V0IG9mIHVzZXIgcGFyYW1ldGVycyB3aGlsZSB0aGUg\nJ2ludGVybmFsJyBwYXJhbWV0ZXJzIHJlbWFpbiB1bmNoYW5nZWQuCiAgICAg\nKiAKICAgICAqIEBwYXJhbSB1c2VyUGFyYW0gaWYgbm9uLW51bGwsIGRlc2ln\nbmF0ZXMgYSAndXNlcicgcGFyYW1ldGVyLgogICAgICovCiAgICBwdWJsaWMg\nU1FMQnVmZmVyIGFwcGVuZFZhbHVlKE9iamVjdCBvLCBDb2x1bW4gY29sLCBQ\nYXJhbWV0ZXIgdXNlclBhcmFtKSB7CiAgICAgICAgaWYgKG8gPT0gbnVsbCkK\nICAgICAgICAgICAgX3NxbC5hcHBlbmQoIk5VTEwiKTsKICAgICAgICBlbHNl\nIGlmIChvIGluc3RhbmNlb2YgUmF3KQogICAgICAgICAgICBfc3FsLmFwcGVu\nZChvLnRvU3RyaW5nKCkpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBf\nc3FsLmFwcGVuZChQQVJBTUVURVJfVE9LRU4pOwoKICAgICAgICAgICAgLy8g\naW5pdGlhbGl6ZSBwYXJhbSBhbmQgY29sIGxpc3RzOyB3ZSBob2xkIG9mZiBv\nbiBjb2wgbGlzdCB1bnRpbAogICAgICAgICAgICAvLyB3ZSBnZXQgdGhlIGZp\ncnN0IG5vbi1udWxsIGNvbAogICAgICAgICAgICBpZiAoX3BhcmFtcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX3BhcmFtcyA9IG5ldyBBcnJheUxpc3Qo\nKTsKICAgICAgICAgICAgaWYgKGNvbCAhPSBudWxsICYmIF9jb2xzID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIF9jb2xzID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgICAgICAgICAgd2hpbGUgKF9jb2xzLnNpemUoKSA8IF9wYXJh\nbXMuc2l6ZSgpKQogICAgICAgICAgICAgICAgICAgIF9jb2xzLmFkZChudWxs\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3BhcmFtcy5hZGQobyk7\nCiAgICAgICAgICAgIGlmICh1c2VyUGFyYW0gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKF91c2VySW5kZXggPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBfdXNlckluZGV4ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nICAgICAgICAgaW50IGluZGV4ID0gX3BhcmFtcy5zaXplKCktMTsKICAgICAg\nICAgICAgICAgIF91c2VySW5kZXguYWRkKGluZGV4KTsKICAgICAgICAgICAg\nICAgIF91c2VySW5kZXguYWRkKHVzZXJQYXJhbS5nZXRQYXJhbWV0ZXJLZXko\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9jb2xzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfY29scy5hZGQoY29sKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBT\nUUxCdWZmZXIgYXBwZW5kVmFsdWUoYm9vbGVhbiBiKSB7CiAgICAgICAgcmV0\ndXJuIGFwcGVuZFZhbHVlKGIsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAg\nICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBwdWJs\naWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGJvb2xlYW4gYiwgQ29sdW1uIGNv\nbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZSgoYikgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFLCBjb2wpOwogICAgfQoKICAgIC8qKgog\nICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGJ5dGUgYikgewogICAgICAg\nIHJldHVybiBhcHBlbmRWYWx1ZShiLCBudWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAg\ncHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShieXRlIGIsIENvbHVtbiBj\nb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUobmV3IEJ5dGUoYiks\nIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0\nZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5k\nVmFsdWUoY2hhciBjKSB7CiAgICAgICAgcmV0dXJuIGFwcGVuZFZhbHVlKGMs\nIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1l\ndGVyIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVu\nZFZhbHVlKGNoYXIgYywgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBh\ncHBlbmRWYWx1ZShuZXcgQ2hhcmFjdGVyKGMpLCBjb2wpOwogICAgfQoKICAg\nIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICov\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGRvdWJsZSBkKSB7\nCiAgICAgICAgcmV0dXJuIGFwcGVuZFZhbHVlKGQsIG51bGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAg\nICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGRvdWJsZSBk\nLCBDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIGFwcGVuZFZhbHVlKG5l\ndyBEb3VibGUoZCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBl\nbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxC\ndWZmZXIgYXBwZW5kVmFsdWUoZmxvYXQgZikgewogICAgICAgIHJldHVybiBh\ncHBlbmRWYWx1ZShmLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFw\ncGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciBhcHBlbmRWYWx1ZShmbG9hdCBmLCBDb2x1bW4gY29sKSB7CiAg\nICAgICAgcmV0dXJuIGFwcGVuZFZhbHVlKG5ldyBGbG9hdChmKSwgY29sKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1\nZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShp\nbnQgaSkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShpLCBudWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1\nZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShp\nbnQgaSwgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1\nZShOdW1iZXJzLnZhbHVlT2YoaSksIGNvbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1\nYmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUobG9uZyBsKSB7CiAgICAgICAg\ncmV0dXJuIGFwcGVuZFZhbHVlKGwsIG51bGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGxvbmcgbCwgQ29sdW1uIGNv\nbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShOdW1iZXJzLnZhbHVl\nT2YobCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBw\nYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIg\nYXBwZW5kVmFsdWUoc2hvcnQgcykgewogICAgICAgIHJldHVybiBhcHBlbmRW\nYWx1ZShzLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBh\nIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZl\nciBhcHBlbmRWYWx1ZShzaG9ydCBzLCBDb2x1bW4gY29sKSB7CiAgICAgICAg\ncmV0dXJuIGFwcGVuZFZhbHVlKG5ldyBTaG9ydChzKSwgY29sKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbGlzdCBvZiBwYXJhbWV0ZXIg\ndmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgTGlzdCBnZXRQYXJhbWV0ZXJz\nKCkgewogICAgICAgIHJldHVybiAoX3BhcmFtcyA9PSBudWxsKSA/IENvbGxl\nY3Rpb25zLkVNUFRZX0xJU1QgOiBfcGFyYW1zOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEdldCB0aGUgdXNlciBwYXJhbWV0ZXIgcG9zaXRpb25zIGlu\nIHRoZSBsaXN0IG9mIHBhcmFtZXRlcnMuIFRoZSBvZGQgCiAgICAgKiBlbGVt\nZW50IG9mIHRoZSByZXR1cm5lZCBsaXN0IGNvbnRhaW5zIGFuIGludGVnZXIg\naW5kZXggdGhhdCByZWZlcnMKICAgICAqIHRvIHRoZSBwb3NpdGlvbiBpbiB0\naGUge0BsaW5rICNnZXRQYXJhbWV0ZXJzKCl9IGxpc3QuIFRoZSBldmVuIGVs\nZW1lbnQKICAgICAqIG9mIHRoZSByZXR1cm5lZCBsaXN0IHJlZmVycyB0byB0\naGUgdXNlciBwYXJhbWV0ZXIga2V5LiAKICAgICAqIFRoaXMgc3RydWN0dXJl\nIGlzIHByZWZlcnJlZCBvdmVyIGEgbm9ybWFsIG1hcCBiZWNhdXNlIGEgdXNl\nciBwYXJhbWV0ZXIgCiAgICAgKiBtYXkgb2NjdXIgbW9yZSB0aGFuIG9uZSBp\nbiB0aGUgcGFyYW1ldGVycy4gCiAgICAgKi8KICAgIHB1YmxpYyBMaXN0IGdl\ndFVzZXJQYXJhbWV0ZXJzKCkgewogICAgICAgIGlmIChfdXNlckluZGV4ID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9M\nSVNUOwogICAgICAgIHJldHVybiBfdXNlckluZGV4OwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBTUUwgZm9yIHRoaXMgYnVmZmVyLgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFNRTCgpIHsKICAgICAgICByZXR1\ncm4gZ2V0U1FMKGZhbHNlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRoZSBTUUwgZm9yIHRoaXMgYnVmZmVyLgogICAgICoKICAgICAq\nIEBwYXJhbSByZXBsYWNlUGFyYW1zIGlmIHRydWUsIHRoZW4gcmVwbGFjZSBw\nYXJhbWV0ZXJzIHdpdGggdGhlCiAgICAgKiBhY3R1YWwgcGFyYW1ldGVyIHZh\nbHVlcwogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFNRTChib29sZWFu\nIHJlcGxhY2VQYXJhbXMpIHsKICAgICAgICByZXNvbHZlU3Vic2VsZWN0cygp\nOwogICAgICAgIFN0cmluZyBzcWwgPSBfc3FsLnRvU3RyaW5nKCk7CiAgICAg\nICAgaWYgKCFyZXBsYWNlUGFyYW1zIHx8IF9wYXJhbXMgPT0gbnVsbCB8fCBf\ncGFyYW1zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIHNxbDsKCiAg\nICAgICAgU3RyaW5nQnVpbGRlciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigp\nOwogICAgICAgIEl0ZXJhdG9yIHBpID0gX3BhcmFtcy5pdGVyYXRvcigpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3FsLmxlbmd0aCgpOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKHNxbC5jaGFyQXQoaSkgIT0gJz8nKSB7CiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKHNxbC5jaGFyQXQoaSkpOwogICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIE9iamVjdCBwYXJhbSA9IHBpLmhhc05leHQoKSA/IHBpLm5leHQoKSA6\nIG51bGw7CiAgICAgICAgICAgIGlmIChwYXJhbSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiTlVMTCIpOwogICAgICAgICAgICBlbHNl\nIGlmIChwYXJhbSBpbnN0YW5jZW9mIE51bWJlciB8fCBwYXJhbSBpbnN0YW5j\nZW9mIEJvb2xlYW4pCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKHBhcmFt\nKTsKICAgICAgICAgICAgZWxzZSBpZiAocGFyYW0gaW5zdGFuY2VvZiBTdHJp\nbmcgfHwgcGFyYW0gaW5zdGFuY2VvZiBDaGFyYWN0ZXIpCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCInIikuYXBwZW5kKHBhcmFtKS5hcHBlbmQoIici\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiPyIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5n\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIG91ciBkZWxheWVk\nIHN1YnNlbGVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXNvbHZl\nU3Vic2VsZWN0cygpIHsKICAgICAgICBpZiAoX3N1YnNlbHMgPT0gbnVsbCB8\nfCBfc3Vic2Vscy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gYWRkIHN1YnNlbHMgYmFja3dhcmRzIHNvIHRoYXQgdGhlIHN0\nb3JlZCBpbnNlcnRpb24gcG9pbnRzIG9mCiAgICAgICAgLy8gbGF0ZXIgc3Vi\nc2VscyByZW1haW4gdmFsaWQKICAgICAgICBTdWJzZWxlY3Qgc3ViOwogICAg\nICAgIFNRTEJ1ZmZlciBidWY7CiAgICAgICAgZm9yIChpbnQgaSA9IF9zdWJz\nZWxzLnNpemUoKSAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIHN1\nYiA9IChTdWJzZWxlY3QpIF9zdWJzZWxzLmdldChpKTsKICAgICAgICAgICAg\naWYgKHN1Yi5jb3VudCkKICAgICAgICAgICAgICAgIGJ1ZiA9IHN1Yi5zZWxl\nY3QudG9TZWxlY3RDb3VudCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBidWYgPSBzdWIuc2VsZWN0LnRvU2VsZWN0KGZhbHNlLCBzdWIu\nZmV0Y2gpOwogICAgICAgICAgICBidWYucmVzb2x2ZVN1YnNlbGVjdHMoKTsK\nICAgICAgICAgICAgYXBwZW5kKGJ1Ziwgc3ViLnNxbEluZGV4LCBzdWIucGFy\nYW1JbmRleCwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICBfc3Vic2Vscy5j\nbGVhcigpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuZCBwb3B1\nbGF0ZSB0aGUgcGFyYW1ldGVycyBvZiBhIHByZXBhcmVkIHN0YXRlbWVudCB1\nc2luZwogICAgICogdGhlIFNRTCBpbiB0aGlzIGJ1ZmZlci4KICAgICAqLwog\nICAgcHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQo\nQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIFJlc3Vs\ndFNldC5UWVBFX0ZPUldBUkRfT05MWSwKICAgICAgICAgICAgUmVzdWx0U2V0\nLkNPTkNVUl9SRUFEX09OTFkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGFuZCBwb3B1bGF0ZSB0aGUgcGFyYW1ldGVycyBvZiBhIHByZXBhcmVk\nIHN0YXRlbWVudCB1c2luZwogICAgICogdGhlIFNRTCBpbiB0aGlzIGJ1ZmZl\nci4KICAgICAqLwogICAgcHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBh\ncmVTdGF0ZW1lbnQoQ29ubmVjdGlvbiBjb25uLCBpbnQgcnNUeXBlLAogICAg\nICAgIGludCByc0NvbmN1cikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChjb25uLCBudWxs\nLCByc1R5cGUsIHJzQ29uY3VyKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhbmQgcG9wdWxhdGUgdGhlIHBhcmFtZXRlcnMgb2YgYSBwcmVwcmVk\nIHN0YXRlbWVudCB1c2luZyB0aGUKICAgICAqIFNRTCBpbiB0aGlzIGJ1ZmZl\nciBhbmQgdGhlIGdpdmVuIGZldGNoIGNvbmZpZ3VyYXRpb24uCiAgICAgKi8K\nICAgIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50\nKENvbm5lY3Rpb24gY29ubiwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBpbnQgcnNUeXBlLCBpbnQgcnNDb25jdXIpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHJzVHlwZSA9PSAt\nMSAmJiBmZXRjaCA9PSBudWxsKQogICAgICAgICAgICByc1R5cGUgPSBSZXN1\nbHRTZXQuVFlQRV9GT1JXQVJEX09OTFk7CiAgICAgICAgZWxzZSBpZiAocnNU\neXBlID09IC0xKQogICAgICAgICAgICByc1R5cGUgPSBmZXRjaC5nZXRSZXN1\nbHRTZXRUeXBlKCk7CiAgICAgICAgaWYgKHJzQ29uY3VyID09IC0xKQogICAg\nICAgICAgICByc0NvbmN1ciA9IFJlc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZ\nOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udDsKICAgICAgICBp\nZiAocnNUeXBlID09IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWQogICAg\nICAgICAgICAmJiByc0NvbmN1ciA9PSBSZXN1bHRTZXQuQ09OQ1VSX1JFQURf\nT05MWSkKICAgICAgICAgICAgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1l\nbnQoZ2V0U1FMKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQg\nPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoZ2V0U1FMKCksIHJzVHlwZSwgcnND\nb25jdXIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNldFBhcmFtZXRl\ncnMoc3RtbnQpOwogICAgICAgICAgICBpZiAoZmV0Y2ggIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKGZldGNoLmdldEZldGNoQmF0Y2hTaXplKCkg\nPiAwKQogICAgICAgICAgICAgICAgICAgIHN0bW50LnNldEZldGNoU2l6ZSgK\nICAgICAgICAgICAgICAgICAgICAgICAgX2RpY3QuZ2V0QmF0Y2hGZXRjaFNp\nemUoZmV0Y2guZ2V0RmV0Y2hCYXRjaFNpemUoKSkpOwogICAgICAgICAgICAg\nICAgaWYgKHJzVHlwZSAhPSBSZXN1bHRTZXQuVFlQRV9GT1JXQVJEX09OTFkK\nICAgICAgICAgICAgICAgICAgICAmJiBmZXRjaC5nZXRGZXRjaERpcmVjdGlv\nbigpICE9IFJlc3VsdFNldC5GRVRDSF9GT1JXQVJEKQogICAgICAgICAgICAg\nICAgICAgIHN0bW50LnNldEZldGNoRGlyZWN0aW9uKGZldGNoLmdldEZldGNo\nRGlyZWN0aW9uKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiBzdG1udDsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50LmNsb3Nl\nKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHsK\nICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBzZTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVsYXRlIHRo\nZSBwYXJhbWV0ZXJzIG9mIGEgcHJlcGFyZWQgc3RhdGVtZW50IHVzaW5nCiAg\nICAgKiB0aGUgU1FMIGluIHRoaXMgYnVmZmVyLgogICAgICovCiAgICBwdWJs\naWMgQ2FsbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwoQ29ubmVjdGlvbiBj\nb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBwcmVwYXJlQ2FsbChjb25uLCBSZXN1bHRTZXQuVFlQRV9GT1JXQVJE\nX09OTFksCiAgICAgICAgICAgIFJlc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZ\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgcG9wdWxhdGUg\ndGhlIHBhcmFtZXRlcnMgb2YgYSBwcmVwYXJlZCBzdGF0ZW1lbnQgdXNpbmcK\nICAgICAqIHRoZSBTUUwgaW4gdGhpcyBidWZmZXIuCiAgICAgKi8KICAgIHB1\nYmxpYyBDYWxsYWJsZVN0YXRlbWVudCBwcmVwYXJlQ2FsbChDb25uZWN0aW9u\nIGNvbm4sIGludCByc1R5cGUsCiAgICAgICAgaW50IHJzQ29uY3VyKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBwcmVw\nYXJlQ2FsbChjb25uLCBudWxsLCByc1R5cGUsIHJzQ29uY3VyKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgcG9wdWxhdGUgdGhlIHBhcmFt\nZXRlcnMgb2YgYSBwcmVwcmVkIHN0YXRlbWVudCB1c2luZyB0aGUKICAgICAq\nIFNRTCBpbiB0aGlzIGJ1ZmZlciBhbmQgdGhlIGdpdmVuIGZldGNoIGNvbmZp\nZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBDYWxsYWJsZVN0YXRlbWVu\ndCBwcmVwYXJlQ2FsbChDb25uZWN0aW9uIGNvbm4sCiAgICAgICAgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgaW50IHJzQ29u\nY3VyKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChyc1R5cGUgPT0gLTEgJiYgZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAg\ncnNUeXBlID0gUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZOwogICAgICAg\nIGVsc2UgaWYgKHJzVHlwZSA9PSAtMSkKICAgICAgICAgICAgcnNUeXBlID0g\nZmV0Y2guZ2V0UmVzdWx0U2V0VHlwZSgpOwogICAgICAgIGlmIChyc0NvbmN1\nciA9PSAtMSkKICAgICAgICAgICAgcnNDb25jdXIgPSBSZXN1bHRTZXQuQ09O\nQ1VSX1JFQURfT05MWTsKCiAgICAgICAgQ2FsbGFibGVTdGF0ZW1lbnQgc3Rt\nbnQ7CiAgICAgICAgaWYgKHJzVHlwZSA9PSBSZXN1bHRTZXQuVFlQRV9GT1JX\nQVJEX09OTFkKICAgICAgICAgICAgJiYgcnNDb25jdXIgPT0gUmVzdWx0U2V0\nLkNPTkNVUl9SRUFEX09OTFkpCiAgICAgICAgICAgIHN0bW50ID0gY29ubi5w\ncmVwYXJlQ2FsbChnZXRTUUwoKSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBzdG1udCA9IGNvbm4ucHJlcGFyZUNhbGwoZ2V0U1FMKCksIHJzVHlwZSwg\ncnNDb25jdXIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNldFBhcmFt\nZXRlcnMoc3RtbnQpOwogICAgICAgICAgICBpZiAoZmV0Y2ggIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgaWYgKGZldGNoLmdldEZldGNoQmF0Y2hTaXpl\nKCkgPiAwKQogICAgICAgICAgICAgICAgICAgIHN0bW50LnNldEZldGNoU2l6\nZSgKICAgICAgICAgICAgICAgICAgICAgICAgX2RpY3QuZ2V0QmF0Y2hGZXRj\naFNpemUoZmV0Y2guZ2V0RmV0Y2hCYXRjaFNpemUoKSkpOwogICAgICAgICAg\nICAgICAgaWYgKHJzVHlwZSAhPSBSZXN1bHRTZXQuVFlQRV9GT1JXQVJEX09O\nTFkKICAgICAgICAgICAgICAgICAgICAmJiBmZXRjaC5nZXRGZXRjaERpcmVj\ndGlvbigpICE9IFJlc3VsdFNldC5GRVRDSF9GT1JXQVJEKQogICAgICAgICAg\nICAgICAgICAgIHN0bW50LnNldEZldGNoRGlyZWN0aW9uKGZldGNoLmdldEZl\ndGNoRGlyZWN0aW9uKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiBzdG1udDsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2Up\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50LmNs\nb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIp\nIHsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBzZTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQb3B1bGF0ZSB0aGUgcGFyYW1l\ndGVycyBvZiBhbiBleGlzdGluZyBQcmVwYXJlZFN0YXRlbWVudAogICAgICog\nd2l0aCB2YWx1ZXMgZnJvbSB0aGlzIGJ1ZmZlci4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0UGFyYW1ldGVycyhQcmVwYXJlZFN0YXRlbWVudCBwcykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3Bh\ncmFtcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIENv\nbHVtbiBjb2w7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfcGFyYW1z\nLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIGNvbCA9IChfY29scyA9PSBu\ndWxsKSA/IG51bGwgOiAoQ29sdW1uKSBfY29scy5nZXQoaSk7CiAgICAgICAg\nICAgIF9kaWN0LnNldFVua25vd24ocHMsIGkgKyAxLCBfcGFyYW1zLmdldChp\nKSwgY29sKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBoYXNo\nQ29kZSgpIHsKICAgICAgICBpbnQgaGFzaCA9IF9zcWwuaGFzaENvZGUoKTsK\nICAgICAgICByZXR1cm4gKF9wYXJhbXMgPT0gbnVsbCkgPyBoYXNoIDogaGFz\naCBeIF9wYXJhbXMuaGFzaENvZGUoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbXBhcmUgaW50ZXJuYWwgU1FMIHdpdGhvdXQgcmVzb2x2aW5nIHN1YnNl\nbGVjdHMgb3Igc3RyaW5naWZ5aW5nCiAgICAgKiBwYXJhbWV0ZXJzLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBzcWxFcXVhbHMoU3RyaW5nIHNxbCkg\newogICAgICAgIHJldHVybiBfc3FsLnRvU3RyaW5nKCkuZXF1YWxzKHNxbCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhl\ncikgewogICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFNR\nTEJ1ZmZlcikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\nU1FMQnVmZmVyIGJ1ZiA9IChTUUxCdWZmZXIpIG90aGVyOwogICAgICAgIHJl\ndHVybiBfc3FsLmVxdWFscyhidWYuX3NxbCkKICAgICAgICAgICAgJiYgT2Jq\nZWN0VXRpbHMuZXF1YWxzKF9wYXJhbXMsIGJ1Zi5fcGFyYW1zKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlcGxhY2UgU1FMICc/JyB3aXRoIENBU1Qgc3Ry\naW5nIGlmIHJlcXVpcmVkIGJ5IERCIHBsYXRmb3JtCiAgICAgKiBAcGFyYW0g\nb3BlcgogICAgICogQHBhcmFtIHZhbAogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBhZGRDYXN0Rm9yUGFyYW0oU3RyaW5nIG9wZXIsIFZhbCB2YWwpIHsKICAg\nICAgICBpZiAoX3NxbC5jaGFyQXQoX3NxbC5sZW5ndGgoKSAtIDEpID09ICc/\nJykgewogICAgICAgICAgICBTdHJpbmcgY2FzdFN0cmluZyA9IF9kaWN0LmFk\nZENhc3RBc1R5cGUob3BlciwgdmFsKTsKICAgICAgICAgICAgaWYgKGNhc3RT\ndHJpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zcWwucmVwbGFjZShf\nc3FsLmxlbmd0aCgpIC0gMSwgX3NxbC5sZW5ndGgoKSwgY2FzdFN0cmluZyk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSBjdXJy\nZW50IGJ1ZmZlciBzdHJpbmcgd2l0aCB0aGUgbmV3IHN0cmluZwogICAgICog\nCiAgICAgKiBAcGFyYW0gc3RhcnQgcmVwbGFjZSBzdGFydCBwb3NpdGlvbgog\nICAgICogQHBhcmFtIGVuZCByZXBsYWNlIGVuZCBwb3NpdGlvbgogICAgICog\nQHBhcmFtIG5ld1N0cmluZwogICAgICovCiAgICBwdWJsaWMgdm9pZCByZXBs\nYWNlU3FsU3RyaW5nKGludCBzdGFydCwgaW50IGVuZCwgU3RyaW5nIG5ld1N0\ncmluZykgewogICAgICAgIF9zcWwucmVwbGFjZShzdGFydCwgZW5kLCBuZXdT\ndHJpbmcpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMg\nYSBzdWJzZWxlY3QuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIFN1YnNlbGVjdCB7CgogICAgICAgIHB1YmxpYyBTZWxlY3Qgc2VsZWN0Owog\nICAgICAgIHB1YmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoOwog\nICAgICAgIHB1YmxpYyBib29sZWFuIGNvdW50OwogICAgICAgIHB1YmxpYyBp\nbnQgc3FsSW5kZXg7CiAgICAgICAgcHVibGljIGludCBwYXJhbUluZGV4OwoK\nICAgICAgICBwdWJsaWMgU3Vic2VsZWN0IGNsb25lKGludCBzcWxJbmRleCwg\naW50IHBhcmFtSW5kZXgpIHsKICAgICAgICAgICAgaWYgKHNxbEluZGV4ID09\nIDAgJiYgcGFyYW1JbmRleCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CgogICAgICAgICAgICBTdWJzZWxlY3Qgc3ViID0gbmV3IFN1YnNl\nbGVjdCgpOwogICAgICAgICAgICBzdWIuc2VsZWN0ID0gc2VsZWN0OwogICAg\nICAgICAgICBzdWIuZmV0Y2ggPSBmZXRjaDsKICAgICAgICAgICAgc3ViLmNv\ndW50ID0gY291bnQ7CiAgICAgICAgICAgIHN1Yi5zcWxJbmRleCA9IHRoaXMu\nc3FsSW5kZXggKyBzcWxJbmRleDsKICAgICAgICAgICAgc3ViLnBhcmFtSW5k\nZXggPSB0aGlzLnBhcmFtSW5kZXggKyBwYXJhbUluZGV4OwogICAgICAgICAg\nICByZXR1cm4gc3ViOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgc2V0UGFyYW1ldGVycyhMaXN0IHBhcmFtcykgewogICAgICAgIF9w\nYXJhbXMgPSBwYXJhbXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyBMaXN0IGdl\ndENvbHVtbnMoKSB7CiAgICAgICAgcmV0dXJuIF9jb2xzOwogICAgfQp9Cg==\n","encoding":"base64"}

