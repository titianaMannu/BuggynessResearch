{"sha":"bf250b3f9155737edfca2e8570beb6ea57596391","node_id":"MDQ6QmxvYjIwNjM2NDpiZjI1MGIzZjkxNTU3MzdlZGZjYTJlODU3MGJlYjZlYTU3NTk2Mzkx","size":103130,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/bf250b3f9155737edfca2e8570beb6ea57596391","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVk\nTWFwOwppbXBvcnQgamF2YS51dGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGls\nLlRyZWVNYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLml0ZXJhdG9ycy5FbXB0eUl0ZXJhdG9yOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkVhZ2VyRmV0Y2hNb2Rl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJD\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNMb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5Db250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoK\nLyoqCiAqIFN0YW5kYXJkIHtAbGluayBTZWxlY3R9IGltcGxlbWVudGF0aW9u\nLiBVc2FnZSBub3RlOiB0aG91Z2ggdGhpcyBjbGFzcwogKiBpbXBsZW1lbnRz\nIHtAbGluayBKb2luc30sIGl0IHNob3VsZCBub3QgYmUgdXNlZCBmb3Igam9p\nbmluZyBkaXJlY3RseS4KICogSW5zdGVhZCwgdXNlIHRoZSByZXR1cm4gdmFs\ndWUgb2Yge0BsaW5rICNuZXdKb2luc30uCiAqCiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBTZWxlY3RJbXBs\nCiAgICBpbXBsZW1lbnRzIFNlbGVjdCwgUGF0aEpvaW5zIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgTk9OQVVUT19ESVNUSU5DVCA9IDIgPDwg\nMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBESVNUSU5DVCA9IDIg\nPDwgMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBOT1RfRElTVElO\nQ1QgPSAyIDw8IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgSU1Q\nTElDSVRfRElTVElOQ1QgPSAyIDw8IDM7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgVE9fTUFOWSA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBBR0dSRUdBVEUgPSAyIDw8IDU7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgTE9CID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE9VVEVSID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IExSUyA9IDIgPDwgODsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBFQUdFUl9UT19PTkUgPSAyIDw8IDk7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRUFHRVJfVE9fTUFOWSA9IDIgPDwgMTA7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgUkVDT1JEX09SREVSRUQgPSAy\nIDw8IDExOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEdST1VQSU5H\nID0gMiA8PCAxMjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGT1JD\nRV9DT1VOVCA9IDIgPDwgMTM7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nU3RyaW5nW10gVEFCTEVfQUxJQVNFUyA9IG5ldyBTdHJpbmdbMTZdOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nW10gT1JERVJfQUxJQVNFUyA9\nIG5ldyBTdHJpbmdbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2Jq\nZWN0W10gTlVMTF9JRFMgPSBuZXcgT2JqZWN0WzE2XTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIE9iamVjdFtdIFBMQUNFSE9MREVSUyA9IG5ldyBPYmpl\nY3RbNTBdOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoU2VsZWN0LmNsYXNzKTsKCiAg\nICBzdGF0aWMgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgVEFCTEVf\nQUxJQVNFUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgVEFCTEVfQUxJQVNF\nU1tpXSA9ICJ0IiArIGk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBP\nUkRFUl9BTElBU0VTLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBPUkRFUl9B\nTElBU0VTW2ldID0gIm8iICsgaTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IE5VTExfSURTLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBOVUxMX0lE\nU1tpXSA9IG5ldyBOdWxsSWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IFBMQUNFSE9MREVSUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgUExB\nQ0VIT0xERVJTW2ldID0gbmV3IFBsYWNlaG9sZGVyKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBmaW5hbCBKREJDQ29uZmlndXJhdGlvbiBfY29uZjsKICAgIHBy\naXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0OwoKICAgIC8vIG1hcCBv\nZiB2YXJpYWJsZSArIHJlbGF0aW9uIHBhdGggKyB0YWJsZSBrZXlzIHRvIHRo\nZSBjb3JyZWN0IGFsaWFzIGluZGV4OgogICAgLy8gZWFjaCByZWxhdGlvbiBw\nYXRoL3RhYmxlIGNvbWJpbmF0aW9uIHNob3VsZCBoYXZlIGEgdW5pcXVlIGFs\naWFzIGJlY2F1c2UKICAgIC8vIGl0IHJlcHJlc2VudHMgYSBzZXBhcmF0ZSBv\nYmplY3Q7IGZvciBleGFtcGxlLCBpZiBhIFBlcnNvbiBjbGFzcyBoYXMgYQog\nICAgLy8gJ3BhcmVudCcgZmllbGQgcmVwcmVzZW50aW5nIGFub3RoZXIgUGVy\nc29uIGFuZCBhbHNvIGhhcyBhbiAnYWRkcmVzcycKICAgIC8vIGZpZWxkIG9m\nIHR5cGUgQWRkcmVzczoKICAgIC8vICdhZGRyZXNzLnN0cmVldCcgc2hvdWxk\nIG1hcCB0byBhIGRpZmZlcmVudCB0YWJsZSBhbGlhcyB0aGFuCiAgICAvLyAn\ncGFyZW50LmFkZHJlc3Muc3RyZWV0JyBmb3IgdGhlIHB1cnBvc2VzIG9mIGNv\nbXBhcmlzb25zCiAgICBwcml2YXRlIE1hcCBfYWxpYXNlcyA9IG51bGw7Cgog\nICAgLy8gbWFwIG9mIGluZGV4ZXMgdG8gdGFibGUgYWxpYXNlcyBsaWtlICdU\nQUJMRU5BTUUgdDAnCiAgICBwcml2YXRlIFNvcnRlZE1hcCBfdGFibGVzID0g\nbnVsbDsKCiAgICAvLyBjb21iaW5lZCBsaXN0IG9mIHNlbGVjdGVkIGlkcyBh\nbmQgbWFwIG9mIGVhY2ggaWQgdG8gaXRzIGFsaWFzCiAgICBwcm90ZWN0ZWQg\nZmluYWwgU2VsZWN0cyBfc2VsZWN0cyA9IG5ld1NlbGVjdHMoKTsKICAgIHBy\naXZhdGUgTGlzdCBfb3JkZXJlZCA9IG51bGw7CiAgICBwcml2YXRlIExpc3Qg\nX2dyb3VwZWQgPSBudWxsOwoKICAgIC8vIGZsYWdzCiAgICBwcml2YXRlIGlu\ndCBfZmxhZ3MgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2pvaW5TeW50YXggPSAw\nOwogICAgcHJpdmF0ZSBsb25nIF9zdGFydElkeCA9IDA7CiAgICBwcml2YXRl\nIGxvbmcgX2VuZElkeCA9IExvbmcuTUFYX1ZBTFVFOwogICAgcHJpdmF0ZSBp\nbnQgX251bGxJZHMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX29yZGVycyA9IDA7\nCiAgICBwcml2YXRlIGludCBfcGxhY2Vob2xkZXJzID0gMDsKICAgIHByaXZh\ndGUgaW50IF9leHBlY3RlZFJlc3VsdENvdW50ID0gMDsKCiAgICAvLyBxdWVy\neSBjbGF1c2VzCiAgICBwcml2YXRlIFNRTEJ1ZmZlciBfb3JkZXJpbmcgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX3doZXJlID0gbnVsbDsKICAg\nIHByaXZhdGUgU1FMQnVmZmVyIF9ncm91cGluZyA9IG51bGw7CiAgICBwcml2\nYXRlIFNRTEJ1ZmZlciBfaGF2aW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FM\nQnVmZmVyIF9mdWxsID0gbnVsbDsKCiAgICAvLyBqb2lucyB0byBhZGQgdG8g\ndGhlIGVuZCBvZiBvdXIgd2hlcmUgY2xhdXNlLCBhbmQgam9pbnMgdG8gcHJl\ncGVuZCB0bwogICAgLy8gYWxsIHNlbGVjdHMgKHNlZSBzZWxlY3QoY2xhc3Nt\nYXBwaW5nKSBtZXRob2QpCiAgICBwcml2YXRlIFNlbGVjdEpvaW5zIF9qb2lu\ncyA9IG51bGw7CiAgICBwcml2YXRlIFN0YWNrIF9wcmVKb2lucyA9IG51bGw7\nCgogICAgLy8gbWFwIG9mIGpvaW5zK2tleXMgdG8gZWFnZXIgc2VsZWN0cyBh\nbmQgZ2xvYmFsIHNldCBvZiBlYWdlciBrZXlzOyB0aGUKICAgIC8vIHNhbWUg\na2V5IGNhbid0IGJlIHVzZWQgbW9yZSB0aGFuIG9uY2UKICAgIHByaXZhdGUg\nTWFwIF9lYWdlciA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZWFnZXJLZXlz\nID0gbnVsbDsKCiAgICAvLyBzdWJzZWxlY3Qgc3VwcG9ydAogICAgcHJpdmF0\nZSBMaXN0IF9zdWJzZWxzID0gbnVsbDsKICAgIHByaXZhdGUgU2VsZWN0SW1w\nbCBfcGFyZW50ID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9zdWJQYXRo\nID0gbnVsbDsKCiAgICAvLyBmcm9tIHNlbGVjdCBpZiB0aGlzIHNlbGVjdCBz\nZWxlY3RzIGZyb20gYSB0bXAgdGFibGUgY3JlYXRlZCBieSBhbm90aGVyCiAg\nICBwcml2YXRlIFNlbGVjdEltcGwgX2Zyb20gPSBudWxsOwogICAgcHJvdGVj\ndGVkIFNlbGVjdEltcGwgX291dGVyID0gbnVsbDsKCiAgICAvLyBKUFFMIFF1\nZXJ5IGNvbnRleHQgdGhpcyBzZWxlY3QgaXMgYXNzb2NpYXRlZCB3aXRoCiAg\nICBwcml2YXRlIENvbnRleHQgX2N0eCA9IG51bGw7CgogICAgLy8gQSBwYXRo\nIG5hdmlnYXRpb24gaXMgYmVnaW4gd2l0aCB0aGlzIHNjaGVtYSBhbGlhcwog\nICAgcHJpdmF0ZSBTdHJpbmcgX3NjaGVtYUFsaWFzID0gbnVsbDsKICAgICAK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhlIHBy\nb3BlciB0YWJsZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGFsaWFzIGluZGV4Lgog\nICAgICovCiAgICBzdGF0aWMgU3RyaW5nIHRvQWxpYXMoaW50IGluZGV4KSB7\nCiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBUQUJMRV9BTElBU0VTLmxlbmd0\naCkKICAgICAgICAgICAgcmV0dXJuIFRBQkxFX0FMSUFTRVNbaW5kZXhdOwog\nICAgICAgIHJldHVybiAidCIgKyBpbmRleDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgb3JkZXIg\nYWxpYXMgZm9yIHRoZSBnaXZlbiBvcmRlcgogICAgICogY29sdW1uIGluZGV4\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b09yZGVyQWxp\nYXMoaW50IGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBPUkRF\nUl9BTElBU0VTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIE9SREVSX0FM\nSUFTRVNbaW5kZXhdOwogICAgICAgIHJldHVybiAibyIgKyBpbmRleDsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFNlbGVjdEltcGwoSkRCQ0Nv\nbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29uZjsKICAg\nICAgICBfZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7\nCiAgICAgICAgX2pvaW5TeW50YXggPSBfZGljdC5qb2luU3ludGF4OwogICAg\nICAgIF9zZWxlY3RzLl9kaWN0ID0gX2RpY3Q7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0Q29udGV4dChDb250ZXh0IGNvbnRleHQpIHsKICAgICAgICBp\nZiAoX2N0eCA9PSBudWxsKSB7CiAgICAgICAgICAgIF9jdHggPSBjb250ZXh0\nOwogICAgICAgICAgICBfY3R4LnNldFNlbGVjdCh0aGlzKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIENvbnRleHQgY3R4KCkgewogICAgICAgIHJl\ndHVybiBfY3R4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNjaGVtYUFs\naWFzKFN0cmluZyBzY2hlbWFBbGlhcykgewogICAgICAgIF9zY2hlbWFBbGlh\ncyA9IHNjaGVtYUFsaWFzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0RXhlY3V0b3IgaW1wbGVt\nZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0\naW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJs\naWMgU1FMQnVmZmVyIHRvU2VsZWN0KGJvb2xlYW4gZm9yVXBkYXRlLCBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgX2Z1bGwgPSBf\nZGljdC50b1NlbGVjdCh0aGlzLCBmb3JVcGRhdGUsIGZldGNoKTsKICAgICAg\nICByZXR1cm4gX2Z1bGw7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTUUxCdWZm\nZXIgZ2V0U1FMKCkgewogICAgICAgIHJldHVybiBfZnVsbDsKICAgIH0KCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0Q291bnQoKSB7CiAgICAgICAg\ncmV0dXJuIF9kaWN0LnRvU2VsZWN0Q291bnQodGhpcyk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZ2V0QXV0b0Rpc3RpbmN0KCkgewogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgTk9OQVVUT19ESVNUSU5DVCkgPT0gMDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvRGlzdGluY3QoYm9vbGVhbiB2YWwp\nIHsKICAgICAgICBpZiAodmFsKQogICAgICAgICAgICBfZmxhZ3MgJj0gfk5P\nTkFVVE9fRElTVElOQ1Q7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxh\nZ3MgfD0gTk9OQVVUT19ESVNUSU5DVDsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0Rpc3RpbmN0KCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYg\nTk9UX0RJU1RJTkNUKSA9PSAwICYmICgoX2ZsYWdzICYgRElTVElOQ1QpICE9\nIDAKICAgICAgICAgICAgfHwgKChfZmxhZ3MgJiBOT05BVVRPX0RJU1RJTkNU\nKSA9PSAwCiAgICAgICAgICAgICYmIChfZmxhZ3MgJiBJTVBMSUNJVF9ESVNU\nSU5DVCkgIT0gMCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldERpc3Rp\nbmN0KGJvb2xlYW4gZGlzdGluY3QpIHsKICAgICAgICAvLyBuZWVkIHR3byBm\nbGFncyBpbiBjYXNlIHNldCBub3RfZGlzdGluY3QsIHRoZW4gYSB0by1tYW55\nIGpvaW4gaGFwcGVucwogICAgICAgIC8vIGFuZCBkaXN0aW5jdCBmbGFnIGdl\ndHMgc2V0IGF1dG9tYXRpY2FsbHkKICAgICAgICBpZiAoZGlzdGluY3QpIHsK\nICAgICAgICAgICAgX2ZsYWdzIHw9IERJU1RJTkNUOwogICAgICAgICAgICBf\nZmxhZ3MgJj0gfk5PVF9ESVNUSU5DVDsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBfZmxhZ3MgfD0gTk9UX0RJU1RJTkNUOwogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkRJU1RJTkNUOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0xSUygpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAm\nIExSUykgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMUlMoYm9v\nbGVhbiBscnMpIHsKICAgICAgICBpZiAobHJzKQogICAgICAgICAgICBfZmxh\nZ3MgfD0gTFJTOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5MUlM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRFeHBlY3RlZFJlc3Vs\ndENvdW50KCkgewogICAgICAgIC8vIGlmIHRoZSBjb3VudCBpc24ndCBmb3Jj\nZWQgYW5kIHdlIGhhdmUgdG8tbWFueSBlYWdlciBqb2lucyB0aGF0IGNvdWxk\nCiAgICAgICAgLy8gdGhyb3cgdGhlIGNvdW50IG9mZiwgZG9uJ3QgcGF5IGF0\ndGVudGlvbiB0byBpdAogICAgICAgIGlmICgoX2ZsYWdzICYgRk9SQ0VfQ09V\nTlQpID09IDAgJiYgaGFzRWFnZXJKb2luKHRydWUpKQogICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICByZXR1cm4gX2V4cGVjdGVkUmVzdWx0Q291bnQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RXhwZWN0ZWRSZXN1bHRDb3Vu\ndChpbnQgZXhwZWN0ZWRSZXN1bHRDb3VudCwgYm9vbGVhbiBmb3JjZSkgewog\nICAgICAgIF9leHBlY3RlZFJlc3VsdENvdW50ID0gZXhwZWN0ZWRSZXN1bHRD\nb3VudDsKICAgICAgICBpZiAoZm9yY2UpCiAgICAgICAgICAgIF9mbGFncyB8\nPSBGT1JDRV9DT1VOVDsKICAgICAgICBlbHNlIAogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZPUkNFX0NPVU5UOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nSm9pblN5bnRheCgpIHsKICAgICAgICByZXR1cm4gX2pvaW5TeW50YXg7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0Sm9pblN5bnRheChpbnQgam9pblN5\nbnRheCkgewogICAgICAgIF9qb2luU3ludGF4ID0gam9pblN5bnRheDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2Vzcyhi\nb29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIHJldHVybiBfZGljdC5zdXBw\nb3J0c1JhbmRvbUFjY2Vzc1Jlc3VsdFNldCh0aGlzLCBmb3JVcGRhdGUpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZygpIHsK\nICAgICAgICByZXR1cm4gX2RpY3Quc3VwcG9ydHNMb2NraW5nKHRoaXMpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc011bHRpcGxlU2VsZWN0cygp\nIHsKICAgICAgICBpZiAoX2VhZ2VyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBfZWFnZXIuZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChN\nYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChlbnRyeS5n\nZXRWYWx1ZSgpICE9IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0Q291bnQoSkRCQ1N0b3JlIHN0b3JlKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENvbm5lY3Rpb24gY29u\nbiA9IG51bGw7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBu\ndWxsOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgU1FMQnVmZmVyIHNxbCA9IHRvU2VsZWN0Q291bnQo\nKTsKICAgICAgICAgICAgY29ubiA9IHN0b3JlLmdldE5ld0Nvbm5lY3Rpb24o\nKTsKICAgICAgICAgICAgc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4s\nIHNxbCwgbnVsbCwgCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQuVFlQRV9G\nT1JXQVJEX09OTFksIAogICAgICAgICAgICAgICAgUmVzdWx0U2V0LkNPTkNV\nUl9SRUFEX09OTFksIGZhbHNlKTsKICAgICAgICAgICAgX2RpY3Quc2V0UXVl\ncnlUaW1lb3V0KHN0bW50LAogICAgICAgICAgICAgICAgICAgIHN0b3JlLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpLmdldFF1ZXJ5VGltZW91dCgpKTsKICAg\nICAgICAgICAgcnMgPSBleGVjdXRlUXVlcnkoY29ubiwgc3RtbnQsIHNxbCwg\nZmFsc2UsIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuIGdldENvdW50KHJz\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgaWYgKHN0bW50\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgp\nOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIGlm\nIChjb25uICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNs\nb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIFJlc3VsdCBleGVjdXRlKEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVs\nbCkKICAgICAgICAgICAgZmV0Y2ggPSBzdG9yZS5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZS5nZXRDb250\nZXh0KCksIHN0b3JlLCBmZXRjaCwKICAgICAgICAgICAgZmV0Y2guZ2V0UmVh\nZExvY2tMZXZlbCgpKTsKICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0IGV4ZWN1\ndGUoSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIGludCBsb2NrTGV2ZWwpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIGZldGNoID0gc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgcmV0dXJuIGV4ZWN1dGUoc3RvcmUuZ2V0Q29udGV4dCgpLCBz\ndG9yZSwgZmV0Y2gsIGxvY2tMZXZlbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBFeGVjdXRlIHRoaXMgc2VsZWN0IGluIHRoZSBjb250ZXh0IG9mIHRoZSBn\naXZlbiBzdG9yZSBtYW5hZ2VyLiBUaGUKICAgICAqIGNvbnRleHQgaXMgcGFz\nc2VkIGluIHNlcGFyYXRlbHkgZm9yIHByb2ZpbGluZyBwdXJwb3Nlcy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdCBleGVjdXRlKFN0b3JlQ29udGV4\ndCBjdHgsIEpEQkNTdG9yZSBzdG9yZSwgCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSA9\nIGZhbHNlOwogICAgICAgIGlmICghaXNBZ2dyZWdhdGUoKSAmJiBfZ3JvdXBp\nbmcgPT0gbnVsbCkgewogICAgICAgICAgICBKREJDTG9ja01hbmFnZXIgbG0g\nPSBzdG9yZS5nZXRMb2NrTWFuYWdlcigpOwogICAgICAgICAgICBpZiAobG0g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZvclVwZGF0ZSA9IGxtLnNlbGVj\ndEZvclVwZGF0ZSh0aGlzLCBsb2NrTGV2ZWwpOwogICAgICAgIH0KCiAgICAg\nICAgU1FMQnVmZmVyIHNxbCA9IHRvU2VsZWN0KGZvclVwZGF0ZSwgZmV0Y2gp\nOwogICAgICAgIGJvb2xlYW4gaXNMUlMgPSBpc0xSUygpOwogICAgICAgIGlu\ndCByc1R5cGUgPSAoaXNMUlMgJiYgc3VwcG9ydHNSYW5kb21BY2Nlc3MoZm9y\nVXBkYXRlKSkKICAgICAgICAgICAgPyAtMSA6IFJlc3VsdFNldC5UWVBFX0ZP\nUldBUkRfT05MWTsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5n\nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQgPSBudWxsOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzTFJTKSAKICAgICAgICAgICAg\nICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBzcWwsIGZldGNo\nLCByc1R5cGUsIC0xLCB0cnVlKTsgCiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBzcWws\nIG51bGwsIHJzVHlwZSwgLTEsIGZhbHNlKTsKICAgICAgICAgICAgCiAgICAg\nICAgICAgIF9kaWN0LnNldFRpbWVvdXRzKHN0bW50LCBmZXRjaCwgZm9yVXBk\nYXRlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJzID0gZXhlY3V0ZVF1\nZXJ5KGNvbm4sIHN0bW50LCBzcWwsIGlzTFJTLCBzdG9yZSk7CiAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIC8vIGNs\nZWFuIHVwIHN0YXRlbWVudAogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAgICAgIHRyeSB7IGNv\nbm4uY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlMikge30KICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBn\nZXRFYWdlclJlc3VsdChjb25uLCBzdG1udCwgcnMsIHN0b3JlLCBmZXRjaCwg\nZm9yVXBkYXRlLCBzcWwpOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0\nZSBvdXIgZWFnZXIgc2VsZWN0cywgYWRkaW5nIHRoZSByZXN1bHRzIHVuZGVy\nIHRoZSBzYW1lIGtleXMKICAgICAqIHRvIHRoZSBnaXZlbiByZXN1bHQuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYWRkRWFnZXJSZXN1bHRz\nKFNlbGVjdFJlc3VsdCByZXMsIFNlbGVjdEltcGwgc2VsLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vs\nLl9lYWdlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIGV4ZWN1dGUgZWFnZXIgc2VsZWN0cwogICAgICAgIE1hcC5FbnRyeSBl\nbnRyeTsKICAgICAgICBSZXN1bHQgZXJlczsKICAgICAgICBNYXAgZWFnZXI7\nCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzZWwuX2VhZ2VyLmVudHJ5\nU2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwoKICAgICAgICAg\nICAgLy8gc2ltdWxhdGVkIGJhdGNoZWQgc2VsZWN0cyBmb3IgaW5uZXIvb3V0\nZXIgam9pbnM7IGZvciBzZXBhcmF0ZQogICAgICAgICAgICAvLyBzZWxlY3Rz\nLCBkb24ndCBwYXNzIG9uIGxvY2sgbGV2ZWwsIGJlY2F1c2UgdGhleSdyZSBw\ncm9iYWJseQogICAgICAgICAgICAvLyBmb3IgcmVsYXRpb25zIGFuZCB0aGVy\nZWZvcmUgc2hvdWxkIHVzZSBkZWZhdWx0IGxldmVsCiAgICAgICAgICAgIGlm\nIChlbnRyeS5nZXRWYWx1ZSgpID09IHNlbCkKICAgICAgICAgICAgICAgIGVy\nZXMgPSByZXM7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGVy\nZXMgPSAoKFNlbGVjdEV4ZWN1dG9yKSBlbnRyeS5nZXRWYWx1ZSgpKS5leGVj\ndXRlKHN0b3JlLAogICAgICAgICAgICAgICAgICAgIGZldGNoKTsKCiAgICAg\nICAgICAgIGVhZ2VyID0gcmVzLmdldEVhZ2VyTWFwKGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKGVhZ2VyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGVh\nZ2VyID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHJlcy5zZXRF\nYWdlck1hcChlYWdlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWFn\nZXIucHV0KGVudHJ5LmdldEtleSgpLCBlcmVzKTsKICAgICAgICB9CiAgICB9\nCgoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBv\ndmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1w\nbGVtZW50YXRpb24gb2YgcHJlcGFyaW5nIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1l\nbnQoQ29ubmVjdGlvbiBjb25uLCAKICAgICAgICBTUUxCdWZmZXIgc3FsLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgcnNUeXBlLCAKICAg\nICAgICBpbnQgcnNDb25jdXIsIGJvb2xlYW4gaXNMUlMpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwgcnNUeXBl\nLCByc0NvbmN1cik7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4g\nc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwgZmV0Y2gsIHJzVHlwZSwgLTEp\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRv\nIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAK\nICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJl\nU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubiwgCiAgICAgICAgU3RyaW5nIHNx\nbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGNvbm4u\ncHJlcGFyZVN0YXRlbWVudChzcWwpOwogICAgfSAgICAKICAgIAogICAgLyoq\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZv\nciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlv\nbiBvZiBleGVjdXRpbmcgcXVlcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBS\nZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KENvbm5lY3Rpb24gY29ubiwgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwsIGJv\nb2xlYW4gaXNMUlMsIEpEQkNTdG9yZSBzdG9yZSkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHN0bW50LmV4ZWN1dGVRdWVyeSgpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHBy\nb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAg\nICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyBxdWVyeS4KICAgICAq\nLwogICAgcHVibGljIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoQ29ubmVjdGlv\nbiBjb25uLCBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgCiAgICAgICAgU3Ry\naW5nIHNxbCwgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMsIENv\nbHVtbltdIGNvbHMpIAogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGdldHRpbmcgY291bnQgZnJvbSB0aGUgcmVzdWx0IHNldC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGludCBnZXRDb3VudChSZXN1bHRTZXQg\ncnMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJzLm5leHQoKTsK\nICAgICAgICByZXR1cm4gcnMuZ2V0SW50KDEpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUg\nZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0\naW9uIG9mIGV4ZWN1dGluZyBlYWdlciBzZWxlY3RzLgogICAgICovCiAgICBw\ndWJsaWMgUmVzdWx0IGdldEVhZ2VyUmVzdWx0KENvbm5lY3Rpb24gY29ubiwg\nCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIFJlc3VsdFNldCBy\ncywgSkRCQ1N0b3JlIHN0b3JlLCAKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBib29sZWFuIGZvclVwZGF0ZSwgU1FMQnVmZmVyIHNx\nbCkgCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2Vs\nZWN0UmVzdWx0IHJlcyA9IG5ldyBTZWxlY3RSZXN1bHQoY29ubiwgc3RtbnQs\nIHJzLCBfZGljdCk7CiAgICAgICAgcmVzLnNldFNlbGVjdCh0aGlzKTsKICAg\nICAgICByZXMuc2V0U3RvcmUoc3RvcmUpOwogICAgICAgIHJlcy5zZXRMb2Nr\naW5nKGZvclVwZGF0ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYWRk\nRWFnZXJSZXN1bHRzKHJlcywgdGhpcywgc3RvcmUsIGZldGNoKTsKICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFNlbGVjdCBpbXBsZW1lbnRhdGlvbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBpbnQgaW5kZXhP\nZigpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBwdWJsaWMgTGlz\ndCBnZXRTdWJzZWxlY3RzKCkgewogICAgICAgIHJldHVybiAoX3N1YnNlbHMg\nPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUIDogX3N1YnNlbHM7\nCiAgICB9CgogICAgcHVibGljIFNlbGVjdCBnZXRQYXJlbnQoKSB7CiAgICAg\nICAgcmV0dXJuIF9wYXJlbnQ7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBn\nZXRTdWJzZWxlY3RQYXRoKCkgewogICAgICAgIHJldHVybiBfc3ViUGF0aDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRQYXJlbnQoU2VsZWN0IHBhcmVu\ndCwgU3RyaW5nIHBhdGgpIHsKICAgICAgICBpZiAocGF0aCAhPSBudWxsKQog\nICAgICAgICAgICBfc3ViUGF0aCA9IHBhdGg7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBfc3ViUGF0aCA9IG51bGw7CgogICAgICAgIGlmIChwYXJlbnQg\nPT0gX3BhcmVudCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChf\ncGFyZW50ICE9IG51bGwpCiAgICAgICAgICAgIF9wYXJlbnQuX3N1YnNlbHMu\ncmVtb3ZlKHRoaXMpOwoKICAgICAgICAvLyMjIyByaWdodCBub3cgd2UgY2Fu\nJ3QgdXNlIHNxbDkyIGpvaW5zIHdpdGggc3Vic2VsZWN0cywgY2F1c2UKICAg\nICAgICAvLyMjIyBJIGNhbid0IGZpZ3VyZSBvdXQgd2hhdCB0byBkbyB3aGVu\nIHRoZSBzdWJzZWxlY3QgaGFzIGEgam9pbgogICAgICAgIC8vIyMjIHdpdGgg\nYW4gYWxpYXMgYWxzbyBwcmVzZW50IGluIHRoZSBvdXRlciBzZWxlY3QuLi4g\neW91IGRvbid0IHdhbnQKICAgICAgICAvLyMjIyB0aGUgam9pbiB0byBhcHBl\nYXIgaW4gdGhlIEZST00gY2xhdXNlIG9mIHRoZSBzdWJzZWxlY3QgY2F1c2UK\nICAgICAgICAvLyMjIyB0aGVuIGl0IHJlLWFsaWFzZXMgYm90aCB0YWJsZXMg\naW4gdGhlIHNjb3BlIG9mIHRoZSBzdWJzZWxlY3QKICAgICAgICAvLyMjIyBh\nbmQgdGhlIGNvcnJlbGF0aW9uIHdpdGggdGhlIG91dGVyIHNlbGVjdCBpcyBs\nb3N0CiAgICAgICAgX3BhcmVudCA9IChTZWxlY3RJbXBsKSBwYXJlbnQ7CiAg\nICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\nX3BhcmVudC5fc3Vic2VscyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3Bh\ncmVudC5fc3Vic2VscyA9IG5ldyBBcnJheUxpc3QoMik7CiAgICAgICAgICAg\nIF9wYXJlbnQuX3N1YnNlbHMuYWRkKHRoaXMpOwogICAgICAgICAgICBpZiAo\nX3BhcmVudC5fam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1NR\nTDkyKQogICAgICAgICAgICAgICAgX2pvaW5TeW50YXggPSBKb2luU3ludGF4\nZXMuU1lOVEFYX1RSQURJVElPTkFMOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBfam9pblN5bnRheCA9IF9wYXJlbnQuX2pvaW5TeW50YXg7\nCiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgTWFwIGdldEFsaWFz\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9hbGlhc2VzOwogICAgfQogICAgCiAg\nICBwdWJsaWMgdm9pZCByZW1vdmVBbGlhcyhPYmplY3Qga2V5KSB7CiAgICAg\nICAgX2FsaWFzZXMucmVtb3ZlKGtleSk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBNYXAgZ2V0VGFibGVzKCkgewogICAgICAgIHJldHVybiBfdGFibGVzOwog\nICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCByZW1vdmVUYWJsZShPYmplY3Qg\na2V5KSB7CiAgICAgICAgX3RhYmxlcy5yZW1vdmUoa2V5KTsKICAgIH0KCiAg\nICBwdWJsaWMgU2VsZWN0IGdldEZyb21TZWxlY3QoKSB7CiAgICAgICAgcmV0\ndXJuIF9mcm9tOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEZyb21TZWxl\nY3QoU2VsZWN0IHNlbCkgewogICAgICAgIF9mcm9tID0gKFNlbGVjdEltcGwp\nIHNlbDsKICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkKICAgICAgICAgICAg\nX2Zyb20uX291dGVyID0gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNFYWdlckpvaW4oYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICBpZiAo\ndG9NYW55KQogICAgICAgICAgICByZXR1cm4gKF9mbGFncyAmIEVBR0VSX1RP\nX01BTlkpICE9IDA7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBFQUdFUl9U\nT19PTkUpICE9IDA7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzSm9p\nbihib29sZWFuIHRvTWFueSkgewogICAgICAgIGlmICh0b01hbnkpCiAgICAg\nICAgICAgIHJldHVybiAoX2ZsYWdzICYgVE9fTUFOWSkgIT0gMDsKICAgICAg\nICByZXR1cm4gX3RhYmxlcyAhPSBudWxsICYmIF90YWJsZXMuc2l6ZSgpID4g\nMTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1NlbGVjdGVkKFRhYmxl\nIHRhYmxlKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMobnVs\nbCwgZmFsc2UpOwogICAgICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gX2Zyb20uZ2V0VGFibGVJbmRleCh0YWJsZSwgcGosIGZh\nbHNlKSAhPSAtMTsKICAgICAgICByZXR1cm4gZ2V0VGFibGVJbmRleCh0YWJs\nZSwgcGosIGZhbHNlKSAhPSAtMTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBnZXRUYWJsZUFsaWFzZXMoKSB7CiAgICAgICAgcmV0dXJuIChfdGFi\nbGVzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfU0VUIDogX3RhYmxl\ncy52YWx1ZXMoKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRTZWxlY3Rz\nKCkgewogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVM\naXN0KF9zZWxlY3RzKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRTZWxl\nY3RBbGlhc2VzKCkgewogICAgICAgIHJldHVybiBfc2VsZWN0cy5nZXRBbGlh\nc2VzKGZhbHNlLCBfb3V0ZXIgIT0gbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIExpc3QgZ2V0SWRlbnRpZmllckFsaWFzZXMoKSB7CiAgICAgICAgcmV0dXJu\nIF9zZWxlY3RzLmdldEFsaWFzZXModHJ1ZSwgX291dGVyICE9IG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0T3JkZXJpbmcoKSB7CiAg\nICAgICAgcmV0dXJuIF9vcmRlcmluZzsKICAgIH0KCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIGdldEdyb3VwaW5nKCkgewogICAgICAgIHJldHVybiBfZ3JvdXBp\nbmc7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRXaGVyZSgpIHsK\nICAgICAgICByZXR1cm4gX3doZXJlOwogICAgfQoKICAgIHB1YmxpYyBTUUxC\ndWZmZXIgZ2V0SGF2aW5nKCkgewogICAgICAgIHJldHVybiBfaGF2aW5nOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZEpvaW5DbGFzc0NvbmRpdGlvbnMo\nKSB7CiAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsIHx8IF9qb2lucy5qb2lu\ncygpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\nam9pbiBzZXQgaXRlcmF0b3IgYWxsb3dzIGNvbmN1cnJlbnQgbW9kaWZpY2F0\naW9uCiAgICAgICAgSm9pbiBqOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gX2pvaW5zLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgaiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICBpZiAoai5nZXRSZWxhdGlvblRhcmdldCgpICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGouZ2V0UmVsYXRpb25UYXJnZXQoKS5nZXREaXNjcmlt\naW5hdG9yKCkuYWRkQ2xhc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAg\nICAgKHRoaXMsIGouZ2V0U3ViY2xhc3NlcygpID09IFNVQlNfSk9JTkFCTEUs\nIAogICAgICAgICAgICAgICAgICAgIGouZ2V0UmVsYXRpb25Kb2lucygpKTsK\nICAgICAgICAgICAgICAgIGouc2V0UmVsYXRpb24obnVsbCwgMCwgbnVsbCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEpv\naW5zIGdldEpvaW5zKCkgewogICAgICAgIHJldHVybiBfam9pbnM7CiAgICB9\nCgogICAgcHVibGljIEl0ZXJhdG9yIGdldEpvaW5JdGVyYXRvcigpIHsKICAg\nICAgICBpZiAoX2pvaW5zID09IG51bGwgfHwgX2pvaW5zLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuIEVtcHR5SXRlcmF0b3IuSU5TVEFOQ0U7CiAg\nICAgICAgcmV0dXJuIF9qb2lucy5qb2lucygpLmpvaW5JdGVyYXRvcigpOwog\nICAgfQoKICAgIHB1YmxpYyBsb25nIGdldFN0YXJ0SW5kZXgoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGFydElkeDsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBn\nZXRFbmRJbmRleCgpIHsKICAgICAgICByZXR1cm4gX2VuZElkeDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRSYW5nZShsb25nIHN0YXJ0LCBsb25nIGVu\nZCkgewogICAgICAgIF9zdGFydElkeCA9IHN0YXJ0OwogICAgICAgIF9lbmRJ\nZHggPSBlbmQ7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5B\nbGlhcyhDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFs\naWFzKGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbCwgZ2V0Sm9pbnMo\nam9pbnMsIGZhbHNlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGFsaWFzIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBw\ncml2YXRlIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sLCBQYXRo\nSm9pbnMgcGopIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29s\nLmdldE5hbWUoKSwgY29sLmdldFRhYmxlKCksIHBqKTsKICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxl\nIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbCwg\ndGFibGUsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyBnZXRDb2x1bW5BbGlhcyhTdHJpbmcgY29sLCBUYWJsZSB0YWJsZSwgSm9p\nbnMgam9pbnMpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29s\nLCB0YWJsZSwgZ2V0Sm9pbnMoam9pbnMsIGZhbHNlKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIGZvciB0aGUgZ2l2ZSBjb2x1\nbW4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhD\nb2x1bW4gY29sLCBPYmplY3QgcGF0aCkgewogICAgICAgIFN0cmluZyBjb2x1\nbW5OYW1lID0gY29sLmdldE5hbWUoKTsKICAgICAgICBUYWJsZSB0YWJsZSA9\nIGNvbC5nZXRUYWJsZSgpOwogICAgICAgIFN0cmluZyB0YWJsZUFsaWFzID0g\nbnVsbDsKICAgICAgICBJdGVyYXRvciBpdHIgPSBnZXRKb2luSXRlcmF0b3Io\nKTsKICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewogICAgICAgICAg\nICBKb2luIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAg\naWYgKGpvaW4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGpvaW4u\nZ2V0VGFibGUxKCkgPT0gdGFibGUpCiAgICAgICAgICAgICAgICAgICAgdGFi\nbGVBbGlhcyA9IGpvaW4uZ2V0QWxpYXMxKCk7CiAgICAgICAgICAgICAgICBl\nbHNlIGlmIChqb2luLmdldFRhYmxlMigpID09IHRhYmxlKQogICAgICAgICAg\nICAgICAgICAgIHRhYmxlQWxpYXMgPSBqb2luLmdldEFsaWFzMigpOwogICAg\nICAgICAgICAgICAgaWYgKHRhYmxlQWxpYXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ0J1ZmZlcih0YWJsZUFsaWFz\nKS5hcHBlbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5k\nKGNvbHVtbk5hbWUpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCJDYW4g\nbm90IHJlc29sdmUgYWxpYXMgZm9yIGZpZWxkOiAiICsKICAgICAgICAgICAg\ncGF0aC50b1N0cmluZygpICsgIiBtYXBwZWQgdG8gY29sdW1uOiAiICsgY29s\ndW1uTmFtZSArCiAgICAgICAgICAgICIgdGFibGU6ICIrdGFibGUuZ2V0TmFt\nZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMg\nZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgU3Ry\naW5nIGdldENvbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBQ\nYXRoSm9pbnMgcGopIHsKICAgICAgICByZXR1cm4gZ2V0VGFibGVBbGlhcyh0\nYWJsZSwgcGopLmFwcGVuZChjb2wpLnRvU3RyaW5nKCk7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgU3RyaW5nQnVpbGRlciBnZXRUYWJsZUFsaWFzKFRhYmxl\nIHRhYmxlLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICBTdHJpbmdCdWlsZGVy\nIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgaWYgKF9mcm9t\nICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzID0gdG9BbGlh\ncyhfZnJvbS5nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpOwogICAg\nICAgICAgICBpZiAoX2RpY3QucmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkK\nICAgICAgICAgICAgICAgIHJldHVybiBidWYuYXBwZW5kKEZST01fU0VMRUNU\nX0FMSUFTKS5hcHBlbmQoIi4iKS5hcHBlbmQoYWxpYXMpLgogICAgICAgICAg\nICAgICAgICAgIGFwcGVuZCgiXyIpOwogICAgICAgICAgICByZXR1cm4gYnVm\nLmFwcGVuZChhbGlhcykuYXBwZW5kKCJfIik7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBidWYuYXBwZW5kKHRvQWxpYXMoZ2V0VGFibGVJbmRleCh0YWJs\nZSwgcGosIHRydWUpKSkuYXBwZW5kKCIuIik7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNBZ2dyZWdhdGUoKSB7CiAgICAgICAgcmV0dXJuIChfZmxh\nZ3MgJiBBR0dSRUdBVEUpICE9IDA7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0QWdncmVnYXRlKGJvb2xlYW4gYWdnKSB7CiAgICAgICAgaWYgKGFnZykK\nICAgICAgICAgICAgX2ZsYWdzIHw9IEFHR1JFR0FURTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9mbGFncyAmPSB+QUdHUkVHQVRFOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzTG9iKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgTE9CKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExv\nYihib29sZWFuIGxvYikgewogICAgICAgIGlmIChsb2IpCiAgICAgICAgICAg\nIF9mbGFncyB8PSBMT0I7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkxPQjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhclNlbGVj\ndHMoKSB7CiAgICAgICAgX3NlbGVjdHMuY2xlYXIoKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBzZWxlY3QoU1FMQnVmZmVyIHNxbCwgT2JqZWN0IGlk\nKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdChzcWwsIGlkLCBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU1FMQnVmZmVyIHNxbCwg\nT2JqZWN0IGlkLCBKb2lucyBqb2lucykgewogICAgICAgIGlmICghaXNHcm91\ncGluZygpKQogICAgICAgICAgICByZXR1cm4gc2VsZWN0KChPYmplY3QpIHNx\nbCwgaWQsIGpvaW5zKTsKICAgICAgICBncm91cEJ5KHNxbCwgam9pbnMpOwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nY29yZCB0aGUgc2VsZWN0IG9mIHRoZSBnaXZlbiBTUUwgYnVmZmVyIG9yIHN0\ncmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdChPYmpl\nY3Qgc3FsLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgZ2V0\nSm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGJvb2xlYW4gY29udGFpbnM7\nCiAgICAgICAgaWYgKGlkID09IG51bGwpIHsKICAgICAgICAgICAgaW50IGlk\neCA9IF9zZWxlY3RzLmluZGV4T2ZBbGlhcyhzcWwpOwogICAgICAgICAgICBj\nb250YWlucyA9IGlkeCAhPSAtMTsKICAgICAgICAgICAgaWYgKGNvbnRhaW5z\nKQogICAgICAgICAgICAgICAgaWQgPSBfc2VsZWN0cy5nZXQoaWR4KTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWQgPSBudWxsSWQoKTsK\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY29udGFpbnMgPSBfc2VsZWN0\ncy5jb250YWlucyhpZCk7CgogICAgICAgIGlmIChjb250YWlucykKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIF9zZWxlY3RzLnNldEFsaWFz\nKGlkLCBzcWwsIGZhbHNlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgYSB1bmlxdWUgaWQgZm9yIGEgU1FM\nIHN0cmluZyB3aG9zZSBnaXZlbiBpZCBpcyBudWxsLgogICAgICovCiAgICBw\ncml2YXRlIE9iamVjdCBudWxsSWQoKSB7CiAgICAgICAgaWYgKF9udWxsSWRz\nID49IE5VTExfSURTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBO\ndWxsSWQoKTsKICAgICAgICByZXR1cm4gTlVMTF9JRFNbX251bGxJZHMrK107\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFN0cmluZyBzcWws\nIE9iamVjdCBpZCkgewogICAgICAgIHJldHVybiBzZWxlY3Qoc3FsLCBpZCwg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFN0cmlu\nZyBzcWwsIE9iamVjdCBpZCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAo\nIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdCgoT2Jq\nZWN0KSBzcWwsIGlkLCBqb2lucyk7CiAgICAgICAgZ3JvdXBCeShzcWwsIGpv\naW5zKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZWxlY3RQbGFjZWhvbGRlcihTdHJpbmcgc3FsKSB7CiAgICAgICAg\nT2JqZWN0IGhvbGRlciA9IChfcGxhY2Vob2xkZXJzID49IFBMQUNFSE9MREVS\nUy5sZW5ndGgpCiAgICAgICAgICAgID8gbmV3IFBsYWNlaG9sZGVyKCkgOiBQ\nTEFDRUhPTERFUlNbX3BsYWNlaG9sZGVycysrXTsKICAgICAgICBzZWxlY3Qo\nc3FsLCBob2xkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0IGEg\ncGxhY2Vob2xkZXIgYXQgdGhlIGdpdmVuIGluZGV4OyB1c2UgYSBuZWdhdGl2\nZSBpbmRleAogICAgICogdG8gY291bnQgZnJvbSB0aGUgYmFjayBvZiB0aGUg\nc2VsZWN0IGxpc3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGluc2VydFBs\nYWNlaG9sZGVyKFN0cmluZyBzcWwsIGludCBwb3MpIHsKICAgICAgICBPYmpl\nY3QgaG9sZGVyID0gKF9wbGFjZWhvbGRlcnMgPj0gUExBQ0VIT0xERVJTLmxl\nbmd0aCkKICAgICAgICAgICAgPyBuZXcgUGxhY2Vob2xkZXIoKSA6IFBMQUNF\nSE9MREVSU1tfcGxhY2Vob2xkZXJzKytdOwogICAgICAgIF9zZWxlY3RzLmlu\nc2VydEFsaWFzKHBvcywgaG9sZGVyLCBzcWwpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ2xlYXIgc2VsZWN0ZWQgcGxhY2Vob2xkZXJzLCBhbmQgcmV0dXJu\nIHJlbW92ZWQgc2VsZWN0IGluZGV4ZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGNsZWFyUGxhY2Vob2xkZXJTZWxlY3RzKCkgewogICAgICAgIF9zZWxl\nY3RzLmNsZWFyUGxhY2Vob2xkZXJzKCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gc2VsZWN0KENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gc2Vs\nZWN0KGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBpZiAoIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVj\ndChjb2wsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgZmFsc2UpOwogICAgICAg\nIGdyb3VwQnkoY29sLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0KENvbHVtbltdIGNvbHMpIHsK\nICAgICAgICByZXR1cm4gc2VsZWN0KGNvbHMsIG51bGwpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgc2VsZWN0KENvbHVtbltdIGNvbHMsIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAoaXNHcm91\ncGluZygpKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywgam9pbnMpOwog\nICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgUGF0aEpv\naW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGludCBz\nZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChzZWxlY3QoY29sc1tpXSwgcGos\nIGZhbHNlKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwogICAg\nICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0\nIHRoZSBnaXZlbiBjb2x1bW4gYWZ0ZXIgbWFraW5nIHRoZSBnaXZlbiBqb2lu\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdChDb2x1bW4g\nY29sLCBQYXRoSm9pbnMgcGosIGJvb2xlYW4gaWRlbnQpIHsKICAgICAgICAv\nLyB3ZSBjYWNoZSBvbiBjb2x1bW4gb2JqZWN0IGlmIHRoZXJlIGFyZSBubyBq\nb2lucyBzbyB0aGF0IHdoZW4KICAgICAgICAvLyBsb29raW5nIHVwIGNvbHVt\nbnMgaW4gdGhlIHJlc3VsdCB3ZSBkb24ndCBoYXZlIHRvIGNyZWF0ZSBhIHN0\ncmluZwogICAgICAgIC8vIGJ1ZmZlciBmb3IgdGhlIHRhYmxlICsgY29sdW1u\nIGFsaWFzOyBpZiB0aGVyZSBhcmUgam9pbnMsIHRoZW4KICAgICAgICAvLyB3\nZSBrZXkgb24gdGhlIGFsaWFzCiAgICAgICAgU3RyaW5nIGFsaWFzID0gZ2V0\nQ29sdW1uQWxpYXMoY29sLCBwaik7CiAgICAgICAgT2JqZWN0IGlkOwogICAg\nICAgIGlmIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQogICAg\nICAgICAgICBpZCA9IGNvbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlk\nID0gYWxpYXM7CiAgICAgICAgaWYgKF9zZWxlY3RzLmNvbnRhaW5zKGlkKSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoY29sLmdl\ndFR5cGUoKSA9PSBUeXBlcy5CTE9CIHx8IGNvbC5nZXRUeXBlKCkgPT0gVHlw\nZXMuQ0xPQikKICAgICAgICAgICAgc2V0TG9iKHRydWUpOwogICAgICAgIF9z\nZWxlY3RzLnNldEFsaWFzKGlkLCBhbGlhcywgaWRlbnQpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdChDbGFz\nc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAgICAgICAgSkRC\nQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBp\nbnQgZWFnZXIpIHsKICAgICAgICBzZWxlY3QobWFwcGluZywgc3ViY2xhc3Nl\ncywgc3RvcmUsIGZldGNoLCBlYWdlciwgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2VsZWN0KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3Vi\nY2xhc3NlcywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwKICAgICAgICBKb2lucyBq\nb2lucykgewogICAgICAgIHNlbGVjdCh0aGlzLCBtYXBwaW5nLCBzdWJjbGFz\nc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBqb2lucywgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBnaXZlbiBtYXBwaW5nLgog\nICAgICovCiAgICB2b2lkIHNlbGVjdChTZWxlY3Qgd3JhcHBlciwgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNT\ndG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50\nIGVhZ2VyLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFuIGlkZW50KSB7\nCiAgICAgICAgLy8gbm90ZSB0aGF0IHRoaXMgaXMgb25lIGNhc2Ugd2hlcmUg\nd2UgZG9uJ3Qgd2FudCB0byB1c2UgdGhlIHJlc3VsdAogICAgICAgIC8vIG9m\nIGdldEpvaW5zKCk7IGp1c3QgdXNlIHRoZSBnaXZlbiBqb2lucywgd2hpY2gg\nd2lsbCBlaXRoZXIgYmUgY2xlYW4KICAgICAgICAvLyBvciB0aGUgcmVzdWx0\nIG9mIHByZXZpb3VzIHByZS1qb2lucy4gdGhpcyB3YXkgd2UgZG9uJ3QgcHVz\naCBleHRyYQogICAgICAgIC8vIHN0YWNrIHN0dWZmIHdoZW4gbm8gYWN0dWFs\nIG5ldyBqb2lucyBoYXZlIGJlZW4gbWFkZSwgYW5kIHdlIGRvbid0CiAgICAg\nICAgLy8gdGhpbmsgdGhlIHVzZXIgd2FudHMgb3V0ZXIgam9pbnMgd2hlbiBh\nY3R1YWxseSBvbmx5IHRoZSBwcmV2aW91cwogICAgICAgIC8vIGpvaW5zIHdl\ncmUgb3V0ZXIuICB3ZSBkbyBpbnZva2UgZ2V0Sm9pbnMoKSwgdGhvdWdoLCB0\nbyBhZGQgdGhlc2UKICAgICAgICAvLyBqb2lucyAoaWYgYW55KSB0byBvdXIg\ndG9wLWxldmVsIGpvaW5zOyBvdGhlcndpc2UgaXQnZCBiZSBwb3NzaWJsZQog\nICAgICAgIC8vIGZvciB0aGUgdXNlciB0byBpbW1lZGlhdGVseSBkbyBhbm90\naGVyIGpvaW4gYW5kIHNlbGVjdCBzb21ldGhpbmcsCiAgICAgICAgLy8gYW5k\nIGlmIHdlJ3JlIGluIG91dGVyIG1vZGUgYWxsIHRoZXNlIGpvaW5zIHdpbGwg\nZ2V0IHN3aXRjaGVkIHRvIG91dGVyCiAgICAgICAgLy8gam9pbnMuICBjYWNo\naW5nIHRoZW0gYXMgdGhlaXIgb3JpZ2luYWwgam9pbiB0eXBlIHByZXZlbnRz\nIHRoYXQKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CgogICAgICAg\nIFBhdGhKb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwogICAgICAgIGJv\nb2xlYW4gaGFzSm9pbnMgPSBwaiAhPSBudWxsICYmIHBqLmlzRGlydHkoKTsK\nICAgICAgICBpZiAoaGFzSm9pbnMpIHsKICAgICAgICAgICAgaWYgKF9wcmVK\nb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3ByZUpvaW5zID0gbmV3\nIFN0YWNrKCk7CiAgICAgICAgICAgIF9wcmVKb2lucy5wdXNoKHBqKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHRoZXkgYXJlIHNlbGVjdGluZyB0aGlz\nIG1hcHBpbmcgd2l0aCBvdXRlciBqb2lucywgdGhlbiBhbGwgam9pbnMKICAg\nICAgICAvLyBmcm9tIHRoaXMgbWFwcGluZyBzaG91bGQgYWxzbyBiZSBvdXRl\ncgogICAgICAgIGJvb2xlYW4gd2FzT3V0ZXIgPSAoX2ZsYWdzICYgT1VURVIp\nICE9IDA7CiAgICAgICAgaWYgKGhhc0pvaW5zICYmICF3YXNPdXRlciAmJiBw\nai5pc091dGVyKCkpCiAgICAgICAgICAgIF9mbGFncyB8PSBPVVRFUjsKCiAg\nICAgICAgLy8gZGVsZWdhdGUgdG8gc3RvcmUgbWFuYWdlciB0byBzZWxlY3Qg\naW4gc2FtZSBvcmRlciBpdCBsb2FkcyByZXN1bHQKICAgICAgICAoKEpEQkNT\ndG9yZU1hbmFnZXIpIHN0b3JlKS5zZWxlY3Qod3JhcHBlciwgbWFwcGluZywg\nc3ViY2xhc3NlcywgbnVsbCwKICAgICAgICAgICAgbnVsbCwgZmV0Y2gsIGVh\nZ2VyLCBpZGVudCwgKF9mbGFncyAmIE9VVEVSKSAhPSAwKTsKCiAgICAgICAg\nLy8gcmVzZXQKICAgICAgICBpZiAoaGFzSm9pbnMpCiAgICAgICAgICAgIF9w\ncmVKb2lucy5wb3AoKTsKICAgICAgICBpZiAoIXdhc091dGVyICYmIChfZmxh\nZ3MgJiBPVVRFUikgIT0gMCkKICAgICAgICAgICAgX2ZsYWdzICY9IH5PVVRF\nUjsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RJZGVudGlmaWVy\nKENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gc2VsZWN0SWRlbnRpZmll\ncihjb2wsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gc2VsZWN0SWRlbnRpZmllcihDb2x1bW4gY29sLCBKb2lucyBqb2lucykg\newogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAgICByZXR1\ncm4gc2VsZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCB0cnVlKTsK\nICAgICAgICBncm91cEJ5KGNvbCwgam9pbnMpOwogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdElkZW50aWZpZXIo\nQ29sdW1uW10gY29scykgewogICAgICAgIHJldHVybiBzZWxlY3RJZGVudGlm\naWVyKGNvbHMsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0\nSWRlbnRpZmllcihDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lucykgewogICAg\nICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKGlzR3JvdXBpbmcoKSkg\newogICAgICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsKICAgICAgICAg\nICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIFBhdGhKb2lucyBwaiA9\nIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICBpZiAoc2VsZWN0KGNvbHNbaV0sIHBqLCB0cnVlKSkK\nICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwogICAgICAgIHJldHVy\nbiBzZWxkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdElkZW50aWZp\nZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAg\nICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgaW50IGVhZ2VyKSB7CiAgICAgICAgc2VsZWN0SWRlbnRpZmllciht\nYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RJZGVudGlmaWVyKENs\nYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBK\nREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIGludCBlYWdlciwKICAgICAgICBKb2lucyBqb2lucykgewogICAgICAgIHNl\nbGVjdCh0aGlzLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gs\nIGVhZ2VyLCBqb2lucywgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIGludCBz\nZWxlY3RQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAg\nICAgcmV0dXJuIHNlbGVjdFByaW1hcnlLZXkobWFwcGluZywgbnVsbCk7CiAg\nICB9CgogICAgcHVibGljIGludCBzZWxlY3RQcmltYXJ5S2V5KENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBKb2lucyBqb2lucykgewogICAgICAgIHJldHVybiBw\ncmltYXJ5S2V5T3BlcmF0aW9uKG1hcHBpbmcsIHRydWUsIG51bGwsIGpvaW5z\nLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVyYXRlIG9uIHBy\naW1hcnkga2V5IGRhdGEuIFJldHVybiBhIGJpdCBtYXNrIG9mIHNlbGVjdGVk\nIGNvbHVtbnMuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHByaW1hcnlLZXlP\ncGVyYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gc2VsLAog\nICAgICAgIEJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBhbGlh\nc09yZGVyKSB7CiAgICAgICAgaWYgKCFzZWwgJiYgYXNjID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiAwOwoKICAgICAgICAvLyBpZiB0aGlzIG1hcHBp\nbmcgY2FuJ3Qgc2VsZWN0IHRoZSBmdWxsIHBrIHZhbHVlcywgdGhlbiBqb2lu\nIHRvCiAgICAgICAgLy8gc3VwZXIgYW5kIHJlY3Vyc2UKICAgICAgICBDbGFz\nc01hcHBpbmcgc3VwOwogICAgICAgIGlmICghbWFwcGluZy5pc1ByaW1hcnlL\nZXlPYmplY3RJZCh0cnVlKSkgewogICAgICAgICAgICBzdXAgPSBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAg\nICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpvaW5zID0g\nbmV3Sm9pbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5T\ndXBlcmNsYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIHJldHVybiBw\ncmltYXJ5S2V5T3BlcmF0aW9uKHN1cCwgc2VsLCBhc2MsIGpvaW5zLCBhbGlh\nc09yZGVyKTsKICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGNvbHMgPSBt\nYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgaWYgKGlz\nR3JvdXBpbmcoKSkgewogICAgICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5z\nKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBQ\nYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgZmFsc2UpOwogICAgICAg\nIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNv\nbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb2x1bW5PcGVyYXRp\nb24oY29sc1tpXSwgc2VsLCBhc2MsIHBqLCBhbGlhc09yZGVyKSkKICAgICAg\nICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwoKICAgICAgICAvLyBpZiB0aGlz\nIG1hcHBpbmcgaGFzIG5vdCBiZWVuIHVzZWQgaW4gdGhlIHNlbGVjdCB5ZXQg\nKGFuZCB0aGVyZWZvcmUKICAgICAgICAvLyBpcyBub3Qgam9pbmVkIHRvIGFu\neXRoaW5nKSwgYnV0IGhhcyBhbiBvdGhlci10YWJsZSBzdXBlcmNsYXNzIHRo\nYXQKICAgICAgICAvLyBoYXMgYmVlbiB1c2VkLCBtYWtlIHN1cmUgdG8gam9p\nbiB0byBpdAogICAgICAgIGJvb2xlYW4gam9pbmVkID0gZmFsc2U7CiAgICAg\nICAgZm9yIChzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpOyBzdXAgIT0gbnVsbDsKICAgICAgICAgICAgbWFwcGluZyA9\nIHN1cCwgc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKSkgewogICAgICAgICAgICBpZiAoc3VwLmdldFRhYmxlKCkgPT0g\nbWFwcGluZy5nZXRUYWJsZSgpKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICBpZiAobWFwcGluZy5nZXRUYWJsZSgpICE9IHN1cC5n\nZXRUYWJsZSgpCiAgICAgICAgICAgICAgICAmJiBnZXRUYWJsZUluZGV4KG1h\ncHBpbmcuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSA9PSAtMQogICAgICAgICAg\nICAgICAgJiYgZ2V0VGFibGVJbmRleChzdXAuZ2V0VGFibGUoKSwgcGosIGZh\nbHNlKSAhPSAtMSkgewogICAgICAgICAgICAgICAgaWYgKHBqID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBuZXdKb2lu\ncygpOwogICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBtYXBwaW5n\nLmpvaW5TdXBlcmNsYXNzKHBqLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBq\nb2luZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoam9pbmVkKQogICAg\nICAgICAgICB3aGVyZShwaik7CgogICAgICAgIHJldHVybiBzZWxkOwogICAg\nfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBhbiBvcGVyYXRpb24gb24gYSBj\nb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBjb2x1bW5PcGVy\nYXRpb24oQ29sdW1uIGNvbCwgYm9vbGVhbiBzZWwsIEJvb2xlYW4gYXNjLAog\nICAgICAgIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAg\nICAgICAgU3RyaW5nIGFzID0gbnVsbDsKICAgICAgICBpZiAoYXNjICE9IG51\nbGwgJiYgKGFsaWFzT3JkZXIgfHwgKF9mbGFncyAmIFJFQ09SRF9PUkRFUkVE\nKSAhPSAwKSkgewogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAg\nIGlmIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgaWQgPSBjb2w7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIGlkID0gZ2V0Q29sdW1uQWxpYXMoY29sLCBwaik7CiAgICAgICAg\nICAgIGlmICgoX2ZsYWdzICYgUkVDT1JEX09SREVSRUQpICE9IDApIHsKICAg\nICAgICAgICAgICAgIGlmIChfb3JkZXJlZCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIF9vcmRlcmVkID0gbmV3IEFycmF5TGlzdCg1KTsKICAgICAg\nICAgICAgICAgIF9vcmRlcmVkLmFkZChpZCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKGFsaWFzT3JkZXIpIHsKICAgICAgICAgICAgICAgIGFz\nID0gdG9PcmRlckFsaWFzKF9vcmRlcnMrKyk7CiAgICAgICAgICAgICAgICBf\nc2VsZWN0cy5zZXRTZWxlY3RBcyhpZCwgYXMpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBib29sZWFuIHNlbGQgPSBzZWwgJiYgc2VsZWN0\nKGNvbCwgcGosIGZhbHNlKTsKICAgICAgICBpZiAoYXNjICE9IG51bGwpIHsK\nICAgICAgICAgICAgU3RyaW5nIGFsaWFzID0gKGFzICE9IG51bGwpID8gYXMg\nOiBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAgICAgICAgYXBwZW5k\nT3JkZXJpbmcoYWxpYXMsIGFzYy5ib29sZWFuVmFsdWUoKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIC8qKgogICAgICog\nQXBwZW5kIG9yZGVyaW5nIGluZm9ybWF0aW9uIHRvIG91ciBpbnRlcm5hbCBi\ndWZmZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRPcmRlcmlu\nZyhPYmplY3Qgb3JkZXJCeSwgYm9vbGVhbiBhc2MpIHsKICAgICAgICBpZiAo\nX29yZGVyaW5nID09IG51bGwpCiAgICAgICAgICAgIF9vcmRlcmluZyA9IG5l\ndyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nX29yZGVyaW5nLmFwcGVuZCgiLCAiKTsKCiAgICAgICAgaWYgKG9yZGVyQnkg\naW5zdGFuY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgIF9vcmRlcmluZy5h\ncHBlbmQoKFNRTEJ1ZmZlcikgb3JkZXJCeSk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKChTdHJpbmcpIG9yZGVyQnkpOwog\nICAgICAgIGlmIChhc2MpCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQo\nIiBBU0MiKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmluZy5h\ncHBlbmQoIiBERVNDIik7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5\nUHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2Ms\nCiAgICAgICAgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJC\neVByaW1hcnlLZXkobWFwcGluZywgYXNjLCBudWxsLCBzZWwpOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgb3JkZXJCeVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGJvb2xlYW4gYXNjLAogICAgICAgIEpvaW5zIGpvaW5zLCBi\nb29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5UHJpbWFyeUtl\neShtYXBwaW5nLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBv\ncmRlciBjb2x1bW5zLgogICAgICovCiAgICBwdWJsaWMgaW50IG9yZGVyQnlQ\ncmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIGFzYywK\nICAgICAgICBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsIGJvb2xlYW4gYWxp\nYXNPcmRlcikgewogICAgICAgIHJldHVybiBwcmltYXJ5S2V5T3BlcmF0aW9u\nKG1hcHBpbmcsIHNlbCwKICAgICAgICAgICAgKGFzYykgPyBCb29sZWFuLlRS\nVUUgOiBCb29sZWFuLkZBTFNFLCBqb2lucywgYWxpYXNPcmRlcik7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJCeShDb2x1bW4gY29sLCBib29s\nZWFuIGFzYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJC\neShjb2wsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBvcmRlckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBq\nb2lucywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShj\nb2wsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNv\nbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4gb3JkZXJCeShDb2x1bW4gY29s\nLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAg\nICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVybiBjb2x1\nbW5PcGVyYXRpb24oY29sLCBzZWwsIChhc2MpID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRSwKICAgICAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRy\ndWUpLCBhbGlhc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IG9yZGVy\nQnkoQ29sdW1uW10gY29scywgYm9vbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7\nCiAgICAgICAgcmV0dXJuIG9yZGVyQnkoY29scywgYXNjLCBudWxsLCBzZWwp\nOwogICAgfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xz\nLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAg\nICAgICAgcmV0dXJuIG9yZGVyQnkoY29scywgYXNjLCBqb2lucywgc2VsLCBm\nYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8g\nc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgaW50\nIG9yZGVyQnkoQ29sdW1uW10gY29scywgYm9vbGVhbiBhc2MsIEpvaW5zIGpv\naW5zLCBib29sZWFuIHNlbCwKICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIp\nIHsKICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1\nZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNv\nbHVtbk9wZXJhdGlvbihjb2xzW2ldLCBzZWwsCiAgICAgICAgICAgICAgICAo\nYXNjKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsIHBqLCBhbGlh\nc09yZGVyKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwogICAg\nICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9y\nZGVyQnkoU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2MsIGJvb2xlYW4gc2Vs\nLCBWYWx1ZSBzZWxBcykKICAgIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShz\ncWwsIGFzYywgKEpvaW5zKSBudWxsLCBzZWwsIHNlbEFzKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFNRTEJ1ZmZlciBzcWwsIGJvb2xl\nYW4gYXNjLCBKb2lucyBqb2lucywKICAgICAgICBib29sZWFuIHNlbCwgVmFs\ndWUgc2VsQXMpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywg\nam9pbnMsIHNlbCwgZmFsc2UsIHNlbEFzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1\nbW5zLgogICAgICovCiAgICBib29sZWFuIG9yZGVyQnkoU1FMQnVmZmVyIHNx\nbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAg\nICAgICBib29sZWFuIGFsaWFzT3JkZXIsIFZhbHVlIHNlbEFzKSB7CiAgICAg\nICAgcmV0dXJuIG9yZGVyQnkoKE9iamVjdCkgc3FsLCBhc2MsIGpvaW5zLCBz\nZWwsIGFsaWFzT3JkZXIsIHNlbEFzKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE9yZGVyIG9uIGEgU1FMIGJ1ZmZlciBvciBzdHJpbmcuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiBvcmRlckJ5KE9iamVjdCBzcWwsIGJvb2xlYW4g\nYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVh\nbiBhbGlhc09yZGVyLCBWYWx1ZSBzZWxBcykgewogICAgICAgIE9iamVjdCBv\ncmRlciA9IHNxbDsKICAgICAgICBpZiAoYWxpYXNPcmRlcikgewogICAgICAg\nICAgICBvcmRlciA9IHRvT3JkZXJBbGlhcyhfb3JkZXJzKyspOwogICAgICAg\nICAgICBfc2VsZWN0cy5zZXRTZWxlY3RBcyhzcWwsIChTdHJpbmcpIG9yZGVy\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKChfZmxhZ3MgJiBSRUNPUkRfT1JE\nRVJFRCkgIT0gMCkgewogICAgICAgICAgICBpZiAoX29yZGVyZWQgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9vcmRlcmVkID0gbmV3IEFycmF5TGlzdCg1\nKTsKICAgICAgICAgICAgX29yZGVyZWQuYWRkKHNlbEFzID09IG51bGwgPyBz\ncWwgOiBzZWxBcyk7CiAgICAgICAgfQoKICAgICAgICBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSk7CiAgICAgICAgYXBwZW5kT3JkZXJpbmcoc2VsQXMgIT0gbnVs\nbCA/IHNlbEFzLmdldEFsaWFzKCkgOiBvcmRlciwgYXNjKTsKICAgICAgICBp\nZiAoc2VsKSB7CiAgICAgICAgICAgIGludCBpZHggPSBfc2VsZWN0cy5pbmRl\neE9mQWxpYXMoc3FsKTsKICAgICAgICAgICAgaWYgKGlkeCA9PSAtMSkgewog\nICAgICAgICAgICAgICAgX3NlbGVjdHMuc2V0QWxpYXMobnVsbElkKCksIHNx\nbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNxbCwgYm9v\nbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVy\nQnkoc3FsLCBhc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gb3JkZXJCeShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnko\nc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBj\nb2x1bW5zLgogICAgICovCiAgICBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNx\nbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAg\nICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4gb3Jk\nZXJCeSgoT2JqZWN0KSBzcWwsIGFzYywgam9pbnMsIHNlbCwgYWxpYXNPcmRl\nciwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXJPcmRlcmlu\nZygpIHsKICAgICAgICBfb3JkZXJpbmcgPSBudWxsOwogICAgICAgIF9vcmRl\ncnMgPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRv\nIHJlY29yZCB0aGUgc2VsZWN0IGxpc3QgaW5kZXhlcyBvZiBpdGVtcyB3ZSBv\ncmRlciBieS4KICAgICAqLwogICAgdm9pZCBzZXRSZWNvcmRPcmRlcmVkSW5k\nZXhlcyhib29sZWFuIHJlY29yZCkgewogICAgICAgIGlmIChyZWNvcmQpCiAg\nICAgICAgICAgIF9mbGFncyB8PSBSRUNPUkRfT1JERVJFRDsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgX29yZGVyZWQgPSBudWxsOwogICAgICAgICAg\nICBfZmxhZ3MgJj0gflJFQ09SRF9PUkRFUkVEOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgaW5kZXhlcyBpbiB0aGUgc2Vs\nZWN0IGxpc3Qgb2YgYWxsIGl0ZW1zIHdlJ3JlIG9yZGVyaW5nCiAgICAgKiBi\neSwgb3IgbnVsbCBpZiBub25lLiBGb3IgdXNlIHdpdGggdW5pb25zLgogICAg\nICovCiAgICBMaXN0IGdldE9yZGVyZWRJbmRleGVzKCkgewogICAgICAgIGlm\nIChfb3JkZXJlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBMaXN0IGlkeHMgPSBuZXcgQXJyYXlMaXN0KF9vcmRlcmVkLnNp\nemUoKSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfb3JkZXJlZC5z\naXplKCk7IGkrKykKICAgICAgICAgICAgaWR4cy5hZGQoTnVtYmVycy52YWx1\nZU9mKF9zZWxlY3RzLmluZGV4T2YoX29yZGVyZWQuZ2V0KGkpKSkpOwogICAg\nICAgIHJldHVybiBpZHhzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJl\nUHJpbWFyeUtleShPYmplY3Qgb2lkLCBDbGFzc01hcHBpbmcgbWFwcGluZywK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICB3aGVyZVByaW1h\ncnlLZXkob2lkLCBtYXBwaW5nLCBudWxsLCBzdG9yZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgd2hlcmUgY29uZGl0aW9ucyBzZXR0aW5nIHRoZSBt\nYXBwaW5nJ3MgcHJpbWFyeSBrZXkgdG8gdGhlIGdpdmVuCiAgICAgKiBvaWQg\ndmFsdWVzLiBJZiB0aGUgZ2l2ZW4gbWFwcGluZyBkb2VzIG5vdCB1c2Ugb2lk\nIHZhbHVlcyBmb3IgaXRzCiAgICAgKiBwcmltYXJ5IGtleSwgd2Ugd2lsbCBy\nZWN1cnNpdmVseSBqb2luIHRvIGl0cyBzdXBlcmNsYXNzIHVudGlsIHdlIGZp\nbmQKICAgICAqIGFuIGFuY2VzdG9yIHRoYXQgZG9lcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHdoZXJlUHJpbWFyeUtleShPYmplY3Qgb2lkLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywgSm9pbnMgam9pbnMsCiAgICAgICAgSkRCQ1N0\nb3JlIHN0b3JlKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nJ3MgaWRl\nbnRpZmllcnMgaW5jbHVkZSBzb21ldGhpbmcgb3RoZXIgdGhhbgogICAgICAg\nIC8vIHRoZSBwayB2YWx1ZXMsIGpvaW4gdG8gc3VwZXIgYW5kIHJlY3Vyc2UK\nICAgICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQoZmFs\nc2UpKSB7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAg\nICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpvaW5zID0g\nbmV3Sm9pbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5T\ndXBlcmNsYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIHdoZXJlUHJp\nbWFyeUtleShvaWQsIHN1cCwgam9pbnMsIHN0b3JlKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9IG1h\ncHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICB3aGVyZShv\naWQsIG1hcHBpbmcsIGNvbHMsIGNvbHMsIG51bGwsIG51bGwsIGdldEpvaW5z\nKGpvaW5zLCB0cnVlKSwKICAgICAgICAgICAgc3RvcmUpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBP\nYmplY3Qgb2lkLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJD\nU3RvcmUgc3RvcmUpIHsKICAgICAgICB3aGVyZUZvcmVpZ25LZXkoZmssIG9p\nZCwgbWFwcGluZywgbnVsbCwgc3RvcmUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHdoZXJlIGNvbmRpdGlvbnMgc2V0dGluZyB0aGUgZ2l2ZW4gZm9y\nZWlnbiBrZXkgdG8gdGhlIGdpdmVuCiAgICAgKiBvaWQgdmFsdWVzLgogICAg\nICoKICAgICAqIEBzZWUgI3doZXJlUHJpbWFyeUtleQogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9i\namVjdCBvaWQsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5z\nIGpvaW5zLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICAvLyBpZiB0aGlz\nIG1hcHBpbmcncyBpZGVudGlmaWVycyBpbmNsdWRlIHNvbWV0aGluZyBvdGhl\nciB0aGFuCiAgICAgICAgLy8gdGhlIHBrIHZhbHVlcywgb3IgaWYgdGhpcyBm\nb3JlaWduIGtleSBkb2Vzbid0IGxpbmsgdG8gb25seQogICAgICAgIC8vIGlk\nZW50aWZpZXJzLCBqb2luIHRvIHRhYmxlIGFuZCBkbyBhIGdldFByaW1hcnlL\nZXkKICAgICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQo\nZmFsc2UpIHx8ICFjb250YWluc0FsbAogICAgICAgICAgICAobWFwcGluZy5n\nZXRQcmltYXJ5S2V5Q29sdW1ucygpLCBmay5nZXRQcmltYXJ5S2V5Q29sdW1u\ncygpKSkgewogICAgICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGpvaW5zID0gbmV3Sm9pbnMoKTsKICAgICAgICAgICAgLy8g\ndHJhdmVyc2UgdG8gZm9yZWlnbiBrZXkgdGFyZ2V0IG1hcHBpbmcKICAgICAg\nICAgICAgd2hpbGUgKG1hcHBpbmcuZ2V0VGFibGUoKSAhPSBmay5nZXRQcmlt\nYXJ5S2V5VGFibGUoKSkgewogICAgICAgICAgICAgICAgaWYgKGpvaW5zID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgam9pbnMgPSBuZXdKb2lucygp\nOwogICAgICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNs\nYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBtYXBwaW5nID0g\nbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAg\nICAgICAgICAgICAgIGlmIChtYXBwaW5nID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgam9pbnMgPSBqb2lucy5qb2luKGZrLCBm\nYWxzZSwgZmFsc2UpOwogICAgICAgICAgICB3aGVyZVByaW1hcnlLZXkob2lk\nLCBtYXBwaW5nLCBqb2lucywgc3RvcmUpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBmcm9tQ29scyA9IGZrLmdl\ndENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSB0b0NvbHMgPSBmay5nZXRQ\ncmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIGNvbnN0Q29s\ncyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwogICAgICAgIE9iamVjdFtd\nIGNvbnN0cyA9IGZrLmdldENvbnN0YW50cygpOwogICAgICAgIHdoZXJlKG9p\nZCwgbWFwcGluZywgdG9Db2xzLCBmcm9tQ29scywgY29uc3RzLCBjb25zdENv\nbHMsCiAgICAgICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgc3RvcmUp\nOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGZs\ndXNoIHRoZSBvaWQgdmFsdWVzIGFzIHdoZXJlIGNvbmRpdGlvbnMgdG8gdGhl\nCiAgICAgKiBnaXZlbiBjb2x1bW5zLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgd2hlcmUoT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIENv\nbHVtbltdIHRvQ29scywKICAgICAgICBDb2x1bW5bXSBmcm9tQ29scywgT2Jq\nZWN0W10gdmFscywgQ29sdW1uW10gY29uc3RDb2xzLCBQYXRoSm9pbnMgcGos\nCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgVmFsdWVNYXBw\naW5nIGVtYmVkID0gbWFwcGluZy5nZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAg\nICAgICAgaWYgKGVtYmVkICE9IG51bGwpIHsKICAgICAgICAgICAgd2hlcmUo\nb2lkLCBlbWJlZC5nZXRGaWVsZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBp\nbmcoKSwKICAgICAgICAgICAgICAgIHRvQ29scywgZnJvbUNvbHMsIHZhbHMs\nIGNvbnN0Q29scywgcGosIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gb25seSBib3RoZXIgdG8gcGFjayBwayB2\nYWx1ZXMgaW50byBhcnJheSBpZiBhcHAgaWQKICAgICAgICBPYmplY3RbXSBw\na3MgPSBudWxsOwogICAgICAgIGlmIChtYXBwaW5nLmdldElkZW50aXR5VHlw\nZSgpID09IENsYXNzTWFwcGluZy5JRF9BUFBMSUNBVElPTikKICAgICAgICAg\nICAgcGtzID0gQXBwbGljYXRpb25JZHMudG9QS1ZhbHVlcyhvaWQsIG1hcHBp\nbmcpOwoKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcihf\nZGljdCk7CiAgICAgICAgSm9pbmFibGUgam9pbjsKICAgICAgICBPYmplY3Qg\ndmFsOwogICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCB0b0NvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAg\nICAgICAgICAgaWYgKHBrcyA9PSBudWxsKQogICAgICAgICAgICAgICAgdmFs\nID0gKG9pZCA9PSBudWxsKSA/IG51bGwgOgogICAgICAgICAgICAgICAgICAg\nICAgICBOdW1iZXJzLnZhbHVlT2YoKChJZCkgb2lkKS5nZXRJZCgpKTsKICAg\nICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBtdXN0IGJlIGFw\ncCBpZGVudGl0eTsgdXNlIHBrIGluZGV4IHRvIGdldCBjb3JyZWN0IHBrIHZh\nbHVlCiAgICAgICAgICAgICAgICBqb2luID0gbWFwcGluZy5hc3NlcnRKb2lu\nYWJsZSh0b0NvbHNbaV0pOwogICAgICAgICAgICAgICAgdmFsID0gcGtzW21h\ncHBpbmcuZ2V0RmllbGQoam9pbi5nZXRGaWVsZEluZGV4KCkpLgogICAgICAg\nICAgICAgICAgICAgIGdldFByaW1hcnlLZXlJbmRleCgpXTsKICAgICAgICAg\nICAgICAgIHZhbCA9IGpvaW4uZ2V0Sm9pblZhbHVlKHZhbCwgdG9Db2xzW2ld\nLCBzdG9yZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb3Vu\ndCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwog\nICAgICAgICAgICBidWYuYXBwZW5kKGdldENvbHVtbkFsaWFzKGZyb21Db2xz\nW2ldLCBwaikpOwogICAgICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAgICAg\nICAgICBidWYuYXBwZW5kVmFsdWUodmFsLCBmcm9tQ29sc1tpXSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoY29uc3RDb2xzICE9IG51bGwgJiYgY29uc3RD\nb2xzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb25zdENvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAgICAg\nICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoZ2V0Q29sdW1uQWxpYXMoY29uc3RDb2xzW2ldLCBwaikpOwoKICAgICAg\nICAgICAgICAgIGlmICh2YWxzW2ldID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIElTICIpOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKHZhbHNbaV0sIGNvbnN0Q29s\nc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHdoZXJl\nKGJ1ZiwgcGopOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0byBzZWUg\naWYgdGhlIGdpdmVuIHNldCBvZiBjb2x1bW5zIGNvbnRhaW5zIGFsbCB0aGUK\nICAgICAqIGNvbHVtbnMgaW4gdGhlIGdpdmVuIHBvdGVudGlhbCBzdWJzZXQu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gY29udGFpbnNB\nbGwoQ29sdW1uW10gc2V0LCBDb2x1bW5bXSBzdWIpIHsKICAgICAgICBpZiAo\nc3ViLmxlbmd0aCA+IHNldC5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgLy8gdGhpcyBpcyBvYnZpb3VzbHkgbl4yLCBidXQg\ndGhlIG51bWJlciBvZiBjb2x1bW5zIHNob3VsZCBiZSBpbgogICAgICAgIC8v\nIHRoZSAxLTIgcmFuZ2UsIHNvIG5vIGJpZ2dpZQogICAgICAgIGJvb2xlYW4g\nZm91bmQgPSB0cnVlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vi\nLmxlbmd0aCAmJiBmb3VuZDsgaSsrKSB7CiAgICAgICAgICAgIGZvdW5kID0g\nZmFsc2U7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgc2V0Lmxl\nbmd0aCAmJiAhZm91bmQ7IGorKykKICAgICAgICAgICAgICAgIGZvdW5kID0g\nc3ViW2ldID09IHNldFtqXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZv\ndW5kOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAgICAgICAgIHdo\nZXJlKChTdHJpbmcpIG51bGwsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgd2hlcmUoc3Fs\nLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJl\nKFNRTEJ1ZmZlciBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgd2hlcmUo\nc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhlIFdIRVJFIGNs\nYXVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlKFNRTEJ1ZmZl\nciBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8g\ndXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKHNxbCA9PSBudWxsIHx8IHNxbC5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF93\naGVyZSA9PSBudWxsKQogICAgICAgICAgICBfd2hlcmUgPSBuZXcgU1FMQnVm\nZmVyKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICghX3doZXJlLmlzRW1wdHko\nKSkKICAgICAgICAgICAgX3doZXJlLmFwcGVuZCgiIEFORCAiKTsKICAgICAg\nICBfd2hlcmUuYXBwZW5kKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nd2hlcmUoU3RyaW5nIHNxbCkgewogICAgICAgIHdoZXJlKHNxbCwgKEpvaW5z\nKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShTdHJpbmcg\nc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIHdoZXJlKHNxbCwgZ2V0Sm9p\nbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0\naGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBXSEVSRSBjbGF1c2UuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZShTdHJpbmcgc3FsLCBQYXRoSm9p\nbnMgcGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4uLgog\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNxbCkpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgaWYgKF93aGVyZSA9PSBudWxsKQogICAg\nICAgICAgICBfd2hlcmUgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAgICAg\nICBlbHNlIGlmICghX3doZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAgX3do\nZXJlLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBfd2hlcmUuYXBwZW5kKHNx\nbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBz\ncWwpIHsKICAgICAgICBoYXZpbmcoc3FsLCAoSm9pbnMpIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTUUxCdWZmZXIgc3FsLCBKb2lu\ncyBqb2lucykgewogICAgICAgIGhhdmluZyhzcWwsIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIGNvbmRpdGlvbiB0byB0aGUgSEFWSU5HIGNsYXVzZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGhhdmluZyhTUUxCdWZmZXIgc3FsLCBQYXRoSm9pbnMg\ncGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4uLgogICAg\nICAgIGlmIChzcWwgPT0gbnVsbCB8fCBzcWwuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGlmIChfaGF2aW5nID09IG51bGwpCiAg\nICAgICAgICAgIF9oYXZpbmcgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAg\nICAgICBlbHNlIGlmICghX2hhdmluZy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIF9oYXZpbmcuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF9oYXZpbmcuYXBw\nZW5kKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFN0cmlu\nZyBzcWwpIHsKICAgICAgICBoYXZpbmcoc3FsLCAoSm9pbnMpIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTdHJpbmcgc3FsLCBKb2lu\ncyBqb2lucykgewogICAgICAgIGhhdmluZyhzcWwsIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIGNvbmRpdGlvbiB0byB0aGUgSEFWSU5HIGNsYXVzZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGhhdmluZyhTdHJpbmcgc3FsLCBQYXRoSm9pbnMgcGop\nIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4uLgogICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNxbCkpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgaWYgKF9oYXZpbmcgPT0gbnVsbCkKICAgICAgICAg\nICAgX2hhdmluZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVs\nc2UgaWYgKCFfaGF2aW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAgX2hhdmlu\nZy5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgX2hhdmluZy5hcHBlbmQoc3Fs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFNRTEJ1ZmZlciBz\ncWwpIHsKICAgICAgICBncm91cEJ5KHNxbCwgKEpvaW5zKSBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFNRTEJ1ZmZlciBzcWwsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwog\nICAgICAgIGdyb3VwQnlBcHBlbmQoc3FsLmdldFNRTCgpKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBncm91cEJ5KFN0cmluZyBzcWwpIHsKICAgICAgICBn\ncm91cEJ5KHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBncm91cEJ5KFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGdyb3VwQnlBcHBl\nbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENvbHVt\nbiBjb2wpIHsKICAgICAgICBncm91cEJ5KGNvbCwgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW4gY29sLCBKb2lucyBqb2lu\ncykgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0\ncnVlKTsKICAgICAgICBncm91cEJ5QXBwZW5kKGdldENvbHVtbkFsaWFzKGNv\nbCwgcGopKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENvbHVt\nbltdIGNvbHMpIHsKICAgICAgICBncm91cEJ5KGNvbHMsIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uW10gY29scywgSm9p\nbnMgam9pbnMpIHsKICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhq\nb2lucywgdHJ1ZSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdyb3VwQnlBcHBlbmQoZ2V0\nQ29sdW1uQWxpYXMoY29sc1tpXSwgcGopKTsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgdm9pZCBncm91cEJ5QXBwZW5kKFN0cmluZyBzcWwp\nIHsKICAgICAgICBpZiAoX2dyb3VwZWQgPT0gbnVsbCB8fCAhX2dyb3VwZWQu\nY29udGFpbnMoc3FsKSkgewogICAgICAgICAgICBpZiAoX2dyb3VwaW5nID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIF9ncm91cGluZyA9IG5ldyBTUUxC\ndWZmZXIoX2RpY3QpOwogICAgICAgICAgICAgICAgX2dyb3VwZWQgPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAg\nICAgX2dyb3VwaW5nLmFwcGVuZCgiLCAiKTsKCiAgICAgICAgICAgIF9ncm91\ncGluZy5hcHBlbmQoc3FsKTsKICAgICAgICAgICAgX2dyb3VwZWQuYWRkKHNx\nbCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnko\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLCBKREJDU3Rv\ncmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIGdyb3VwQnkobWFwcGluZywgc3ViY2xhc3Nlcywgc3Rv\ncmUsIGZldGNoLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91\ncEJ5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywgSkRC\nQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgLy8gd2UgaW1wbGVtZW50\nIHRoaXMgYnkgcHV0dGluZyBvdXJzZWx2ZXMgaW50byBncm91cGluZyBtb2Rl\nLCB3aGVyZQogICAgICAgIC8vIGFsbCBzZWxlY3QgaW52b2NhdGlvbnMgYXJl\nIHJlLXJvdXRlZCB0byBncm91cC1ieSBpbnZvY2F0aW9ucyBpbnN0ZWFkLgog\nICAgICAgIC8vIHRoaXMgYWxsb3dzIHVzIHRvIHV0aWxpemUgdGhlIHNhbWUg\nc2VsZWN0IEFQSXMgb2YgdGhlIHN0b3JlIG1hbmFnZXIKICAgICAgICAvLyBh\nbmQgYWxsIHRoZSBtYXBwaW5nIHN0cmF0ZWdpZXMsIHJhdGhlciB0aGFuIGhh\ndmluZyB0byBjcmVhdGUgCiAgICAgICAgLy8gZXF1aXZhbGVudCBBUElzIGFu\nZCBkdXBsaWNhdGUgbG9naWMgZm9yIGdyb3VwaW5nCiAgICAgICAgYm9vbGVh\nbiB3YXNHcm91cGluZyA9IGlzR3JvdXBpbmcoKTsKICAgICAgICBfZmxhZ3Mg\nfD0gR1JPVVBJTkc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2VsZWN0\nKG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgCiAgICAgICAg\nICAgICAgICBFYWdlckZldGNoTW9kZXMuRUFHRVJfTk9ORSwgam9pbnMpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICghd2FzR3JvdXBp\nbmcpCiAgICAgICAgICAgICAgICBfZmxhZ3MgJj0gfkdST1VQSU5HOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgd2UncmUgaW4g\nZ3JvdXAgbW9kZSwgd2hlcmUgYW55IHNlbGVjdCBpcyBjaGFuZ2VkIHRvIGEg\nZ3JvdXAtYnkKICAgICAqIGNhbGwuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBpc0dyb3VwaW5nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYg\nR1JPVVBJTkcpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGpvaW5zIHRvIHVzZSBmb3IgY29sdW1uIGFsaWFzZXMsIGV0Yy4KICAg\nICAqCiAgICAgKiBAcGFyYW0gam9pbnMgam9pbnMgZ2l2ZW4gYnkgdGhlIHVz\nZXIKICAgICAqIEByZXR1cm4gdGhlIGpvaW5zIHRvIHVzZSBmb3IgYWxpYXNl\ncywgZXRjCiAgICAgKi8KICAgIHByaXZhdGUgUGF0aEpvaW5zIGdldEpvaW5z\nKEpvaW5zIGpvaW5zLCBib29sZWFuIHJlY29yZCkgewogICAgICAgIFBhdGhK\nb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwogICAgICAgIGJvb2xlYW4g\ncHJlID0gKHBqID09IG51bGwgfHwgIXBqLmlzRGlydHkoKSkKICAgICAgICAg\nICAgJiYgX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5\nKCk7CiAgICAgICAgaWYgKHByZSkKICAgICAgICAgICAgcGogPSAoUGF0aEpv\naW5zKSBfcHJlSm9pbnMucGVlaygpOwoKICAgICAgICBpZiAocGogPT0gbnVs\nbCB8fCAhcGouaXNEaXJ0eSgpKQogICAgICAgICAgICBwaiA9IF9qb2luczsK\nICAgICAgICBlbHNlIGlmICghcHJlKSB7CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgT1VURVIpICE9IDApCiAgICAgICAgICAgICAgICBwaiA9IChQYXRo\nSm9pbnMpIG91dGVyKHBqKTsKICAgICAgICAgICAgaWYgKHJlY29yZCkgewog\nICAgICAgICAgICAgICAgaWYgKCFwai5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIF9qb2lucyA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoX2pvaW5zLmpvaW5zKCkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zLnNldEpvaW5zKG5ldyBK\nb2luU2V0KHBqLmpvaW5zKCkpKTsKICAgICAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9qb2lucy5qb2lucygpLmFkZEFs\nbChwai5qb2lucygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGo7CiAgICB9CgogICAgcHVi\nbGljIFNlbGVjdEV4ZWN1dG9yIHdoZXJlQ2xvbmUoaW50IHNlbHMpIHsKICAg\nICAgICBpZiAoc2VscyA8IDEpCiAgICAgICAgICAgIHNlbHMgPSAxOwoKICAg\nICAgICBTZWxlY3RbXSBjbG9uZXMgPSBudWxsOwogICAgICAgIFNlbGVjdElt\ncGwgc2VsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VsczsgaSsr\nKSB7CiAgICAgICAgICAgIHNlbCA9IChTZWxlY3RJbXBsKSBfY29uZi5nZXRT\nUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdTZWxlY3QoKTsKICAgICAgICAgICAg\nc2VsLl9mbGFncyA9IF9mbGFnczsKICAgICAgICAgICAgc2VsLl9mbGFncyAm\nPSB+QUdHUkVHQVRFOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5PVVRF\nUjsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+TFJTOwogICAgICAgICAg\nICBzZWwuX2ZsYWdzICY9IH5FQUdFUl9UT19PTkU7CiAgICAgICAgICAgIHNl\nbC5fZmxhZ3MgJj0gfkVBR0VSX1RPX01BTlk7CiAgICAgICAgICAgIHNlbC5f\nZmxhZ3MgJj0gfkZPUkNFX0NPVU5UOwogICAgICAgICAgICBzZWwuX2pvaW5T\neW50YXggPSBfam9pblN5bnRheDsKICAgICAgICAgICAgc2VsLl9zY2hlbWFB\nbGlhcyA9IF9zY2hlbWFBbGlhczsKICAgICAgICAgICAgaWYgKF9hbGlhc2Vz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2FsaWFzZXMgPSBuZXcg\nSGFzaE1hcChfYWxpYXNlcyk7CiAgICAgICAgICAgIGlmIChfdGFibGVzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX3RhYmxlcyA9IG5ldyBUcmVl\nTWFwKF90YWJsZXMpOwogICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBzZWwuX2pvaW5zID0gX2pvaW5zLmNsb25lKHNl\nbCk7CiAgICAgICAgICAgIGlmIChfd2hlcmUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHNlbC5fd2hlcmUgPSBuZXcgU1FMQnVmZmVyKF93aGVyZSk7CiAg\nICAgICAgICAgIGlmIChfZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBzZWwuX2Zyb20gPSAoU2VsZWN0SW1wbCkgX2Zyb20ud2hlcmVDbG9uZSgx\nKTsKICAgICAgICAgICAgICAgIHNlbC5fZnJvbS5fb3V0ZXIgPSBzZWw7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIHNlbC5fc3Vic2VscyA9IG5ldyBBcnJheUxp\nc3QoX3N1YnNlbHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgIFNlbGVjdElt\ncGwgc3ViLCBzZWxTdWI7CiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0g\nMDsgaiA8IF9zdWJzZWxzLnNpemUoKTsgaisrKSB7CiAgICAgICAgICAgICAg\nICAgICAgc3ViID0gKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChqKTsKICAg\nICAgICAgICAgICAgICAgICBzZWxTdWIgPSAoU2VsZWN0SW1wbCkgc3ViLmZ1\nbGxDbG9uZSgxKTsKICAgICAgICAgICAgICAgICAgICBzZWxTdWIuX3BhcmVu\ndCA9IHNlbDsKICAgICAgICAgICAgICAgICAgICBzZWxTdWIuX3N1YlBhdGgg\nPSBzdWIuX3N1YlBhdGg7CiAgICAgICAgICAgICAgICAgICAgc2VsLl9zdWJz\nZWxzLmFkZChzZWxTdWIpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWwu\nX3doZXJlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbC5f\nd2hlcmUucmVwbGFjZShzdWIsIHNlbFN1Yik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWxzID09IDEpCiAg\nICAgICAgICAgICAgICByZXR1cm4gc2VsOwogICAgICAgICAgICBpZiAoY2xv\nbmVzID09IG51bGwpCiAgICAgICAgICAgICAgICBjbG9uZXMgPSBuZXcgU2Vs\nZWN0W3NlbHNdOwogICAgICAgICAgICBjbG9uZXNbaV0gPSBzZWw7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFu\nY2UoKS5uZXdVbmlvbihjbG9uZXMpOwogICAgfQoKICAgIHB1YmxpYyBTZWxl\nY3RFeGVjdXRvciBmdWxsQ2xvbmUoaW50IHNlbHMpIHsKICAgICAgICBpZiAo\nc2VscyA8IDEpCiAgICAgICAgICAgIHNlbHMgPSAxOwoKICAgICAgICBTZWxl\nY3RbXSBjbG9uZXMgPSBudWxsOwogICAgICAgIFNlbGVjdEltcGwgc2VsOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VsczsgaSsrKSB7CiAgICAg\nICAgICAgIHNlbCA9IChTZWxlY3RJbXBsKSB3aGVyZUNsb25lKDEpOwogICAg\nICAgICAgICBzZWwuX2ZsYWdzID0gX2ZsYWdzOwogICAgICAgICAgICBzZWwu\nX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBfZXhwZWN0ZWRSZXN1bHRDb3VudDsK\nICAgICAgICAgICAgc2VsLl9zZWxlY3RzLmFkZEFsbChfc2VsZWN0cyk7CiAg\nICAgICAgICAgIGlmIChfb3JkZXJpbmcgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHNlbC5fb3JkZXJpbmcgPSBuZXcgU1FMQnVmZmVyKF9vcmRlcmluZyk7\nCiAgICAgICAgICAgIHNlbC5fb3JkZXJzID0gX29yZGVyczsKICAgICAgICAg\nICAgaWYgKF9ncm91cGluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2Vs\nLl9ncm91cGluZyA9IG5ldyBTUUxCdWZmZXIoX2dyb3VwaW5nKTsKICAgICAg\nICAgICAgaWYgKF9oYXZpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNl\nbC5faGF2aW5nID0gbmV3IFNRTEJ1ZmZlcihfaGF2aW5nKTsKICAgICAgICAg\nICAgaWYgKF9mcm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbC5f\nZnJvbSA9IChTZWxlY3RJbXBsKSBfZnJvbS5mdWxsQ2xvbmUoMSk7CiAgICAg\nICAgICAgICAgICBzZWwuX2Zyb20uX291dGVyID0gc2VsOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBpZiAoc2VscyA9PSAxKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHNlbDsKICAgICAgICAgICAgaWYgKGNsb25lcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxzXTsK\nICAgICAgICAgICAgY2xvbmVzW2ldID0gc2VsOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3VW5p\nb24oY2xvbmVzKTsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3Ig\nZWFnZXJDbG9uZShGaWVsZE1hcHBpbmcga2V5LCBpbnQgZWFnZXJUeXBlLAog\nICAgICAgIGJvb2xlYW4gdG9NYW55LCBpbnQgc2VscykgewogICAgICAgIGlm\nIChlYWdlclR5cGUgPT0gRUFHRVJfT1VURVIKICAgICAgICAgICAgJiYgX2pv\naW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKF9lYWdlcktl\neXMgIT0gbnVsbCAmJiBfZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBnbG9iYWwgc2V0IG9m\nIGVhZ2VyIGtleXMKICAgICAgICBpZiAoX2VhZ2VyS2V5cyA9PSBudWxsKQog\nICAgICAgICAgICBfZWFnZXJLZXlzID0gbmV3IEhhc2hTZXQoKTsKICAgICAg\nICBfZWFnZXJLZXlzLmFkZChrZXkpOwoKICAgICAgICBTZWxlY3RFeGVjdXRv\nciBzZWw7CiAgICAgICAgaWYgKGVhZ2VyVHlwZSAhPSBFQUdFUl9QQVJBTExF\nTCkgewogICAgICAgICAgICBpZiAodG9NYW55KQogICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IEVBR0VSX1RPX01BTlk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIF9mbGFncyB8PSBFQUdFUl9UT19PTkU7CiAgICAgICAg\nICAgIHNlbCA9IHRoaXM7CiAgICAgICAgfSBlbHNlIGlmIChzZWxzIDwgMikK\nICAgICAgICAgICAgc2VsID0gcGFyYWxsZWxDbG9uZSgpOwogICAgICAgIGVs\nc2UgewogICAgICAgICAgICBTZWxlY3RbXSBjbG9uZXMgPSBuZXcgU2VsZWN0\nW3NlbHNdOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsb25l\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNsb25lc1tpXSA9IHBh\ncmFsbGVsQ2xvbmUoKTsKICAgICAgICAgICAgc2VsID0gX2NvbmYuZ2V0U1FM\nRmFjdG9yeUluc3RhbmNlKCkubmV3VW5pb24oY2xvbmVzKTsKICAgICAgICB9\nCgogICAgICAgIGlmIChfZWFnZXIgPT0gbnVsbCkKICAgICAgICAgICAgX2Vh\nZ2VyID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfZWFnZXIucHV0KHRvRWFn\nZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsLCBmYWxzZSkpLCBzZWwpOwogICAg\nICAgIHJldHVybiBzZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYSBjbG9uZSBvZiB0aGlzIHNlbGVjdCBmb3IgdXNlIGluIGVhZ2VyIHBhcmFs\nbGVsIHNlbGVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgU2VsZWN0SW1wbCBw\nYXJhbGxlbENsb25lKCkgewogICAgICAgIFNlbGVjdEltcGwgc2VsID0gKFNl\nbGVjdEltcGwpIHdoZXJlQ2xvbmUoMSk7CiAgICAgICAgc2VsLl9mbGFncyAm\nPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBzZWwuX2VhZ2VyS2V5cyA9\nIF9lYWdlcktleXM7CiAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxsICYm\nICFfcHJlSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHNlbC5fcHJl\nSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAgc2VsLl9wcmVKb2lu\ncy5wdXNoKCgoU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5wZWVrKCkpLgogICAg\nICAgICAgICAgICAgY2xvbmUoc2VsKSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBzZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdmlldyBv\nZiBlYWdlciBzZWxlY3RzLiBNYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHVi\nbGljIE1hcCBnZXRFYWdlck1hcCgpIHsKICAgICAgICByZXR1cm4gX2VhZ2Vy\nOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRvciBnZXRFYWdlcihG\naWVsZE1hcHBpbmcga2V5KSB7CiAgICAgICAgaWYgKF9lYWdlciA9PSBudWxs\nIHx8ICFfZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIHJldHVybiAoU2VsZWN0RXhlY3V0b3IpIF9l\nYWdlci5nZXQodG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwsCiAgICAg\nICAgICAgIGZhbHNlKSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBlYWdlciBrZXkgdG8gdXNlIGZvciB0aGUgdXNlci1naXZlbiBrZXku\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCB0b0VhZ2VyS2V5\nKEZpZWxkTWFwcGluZyBrZXksIFBhdGhKb2lucyBwaikgewogICAgICAgIGlm\nIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4ga2V5OwogICAgICAgIHJldHVybiBuZXcgS2V5KHBqLnBhdGgo\nKS50b1N0cmluZygpLCBrZXkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBu\nZXdKb2lucygpIHsKICAgICAgICBpZiAoX3ByZUpvaW5zICE9IG51bGwgJiYg\nIV9wcmVKb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgU2VsZWN0Sm9p\nbnMgc2ogPSAoU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7CiAgICAg\nICAgICAgIHJldHVybiBzai5jbG9uZSh0aGlzKTsKICAgICAgICB9CiAgICAg\nICAgLy8gcmV0dXJuIHRoaXMgZm9yIGVmZmljaWVuY3kgaW4gY2FzZSBubyBq\nb2lucyBlbmQgdXAgYmVpbmcgbWFkZQogICAgICAgIHJldHVybiB0aGlzOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBuZXdPdXRlckpvaW5zKCkgewogICAg\nICAgIHJldHVybiAoKFBhdGhKb2lucykgbmV3Sm9pbnMoKSkuc2V0T3V0ZXIo\ndHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kKFNRTEJ1ZmZl\nciBidWYsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGpvaW5zID09IG51\nbGwgfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgaWYgKF9qb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhf\nU1FMOTIpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKCFidWYu\naXNFbXB0eSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwog\nICAgICAgIEpvaW4gam9pbiA9IG51bGw7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSAoKFBhdGhKb2lucykgam9pbnMpLmpvaW5zKCkuam9pbkl0ZXJh\ndG9yKCk7CiAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgc3dp\ndGNoIChfam9pblN5bnRheCkgewogICAgICAgICAgICAgICAgY2FzZSBKb2lu\nU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMOgogICAgICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoX2RpY3QudG9UcmFkaXRpb25hbEpvaW4oam9pbikp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBKb2luU3ludGF4ZXMuU1lOVEFYX0RBVEFCQVNFOgogICAgICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoX2RpY3QudG9OYXRpdmVKb2luKGpvaW4p\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVy\nbmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlm\nIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIEFORCAiKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEpvaW5zIGFu\nZChKb2lucyBqb2luczEsIEpvaW5zIGpvaW5zMikgewogICAgICAgIHJldHVy\nbiBhbmQoKFBhdGhKb2lucykgam9pbnMxLCAoUGF0aEpvaW5zKSBqb2luczIs\nIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3QgZ2V0U2VsZWN0KCkg\newogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29tYmluZSB0aGUgZ2l2ZW4gam9pbnMuCiAgICAgKi8KICAgIHByaXZhdGUg\nU2VsZWN0Sm9pbnMgYW5kKFBhdGhKb2lucyBqMSwgUGF0aEpvaW5zIGoyLCBi\nb29sZWFuIG51bGxKb2lucykgewogICAgICAgIGlmICgoajEgPT0gbnVsbCB8\nfCBqMS5pc0VtcHR5KCkpCiAgICAgICAgICAgICYmIChqMiA9PSBudWxsIHx8\nIGoyLmlzRW1wdHkoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBTZWxlY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsK\nICAgICAgICBpZiAoajEgPT0gbnVsbCB8fCBqMS5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgaWYgKGoyLmdldFNlbGVjdCgpID09IHRoaXMpIHsKICAgICAg\nICAgICAgICAgIGlmIChudWxsSm9pbnMpCiAgICAgICAgICAgICAgICAgICAg\nc2ouc2V0Sm9pbnMoajIuam9pbnMoKSk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgc2ouc2V0Sm9pbnMobmV3IEpvaW5TZXQo\najIuam9pbnMoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgSm9pblNldCBzZXQgPSBudWxsOwogICAgICAgICAgICBp\nZiAoajEuZ2V0U2VsZWN0KCkgPT0gdGhpcykgewogICAgICAgICAgICAgICAg\naWYgKG51bGxKb2lucykKICAgICAgICAgICAgICAgICAgICBzZXQgPSBqMS5q\nb2lucygpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNldCA9IG5ldyBKb2luU2V0KGoxLmpvaW5zKCkpOwoKICAgICAgICAg\nICAgICAgIGlmIChqMiAhPSBudWxsICYmICFqMi5pc0VtcHR5KCkKICAgICAg\nICAgICAgICAgICAgICAmJiBqMi5nZXRTZWxlY3QoKSA9PSB0aGlzKQogICAg\nICAgICAgICAgICAgICAgIHNldC5hZGRBbGwoajIuam9pbnMoKSk7CiAgICAg\nICAgICAgICAgICBzai5zZXRKb2lucyhzZXQpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBudWxsIHByZXZpb3VzIGpvaW5zOyBhbGwg\nYXJlIGNvbWJpbmVkIGludG8gdGhpcyBvbmUKICAgICAgICBpZiAobnVsbEpv\naW5zICYmIGoxICE9IG51bGwpCiAgICAgICAgICAgIGoxLm51bGxKb2lucygp\nOwogICAgICAgIGlmIChudWxsSm9pbnMgJiYgajIgIT0gbnVsbCkKICAgICAg\nICAgICAgajIubnVsbEpvaW5zKCk7CgogICAgICAgIHJldHVybiBzajsKICAg\nIH0KCiAgICBwdWJsaWMgSm9pbnMgb3IoSm9pbnMgam9pbnMxLCBKb2lucyBq\nb2luczIpIHsKICAgICAgICBQYXRoSm9pbnMgajEgPSAoUGF0aEpvaW5zKSBq\nb2luczE7CiAgICAgICAgUGF0aEpvaW5zIGoyID0gKFBhdGhKb2lucykgam9p\nbnMyOwoKICAgICAgICAvLyBpZiBubyBjb21tb24gam9pbnMsIHJldHVybiBu\ndWxsOyBpZiBvbmUgc2lkZSBvZiB0aGUgb3IgY2xhdXNlIGhhcwogICAgICAg\nIC8vIGRpZmZlcmVudCBqb2lucyB0aGFuIHRoZSBvdGhlciwgdGhlbiB3ZSBu\nZWVkIHRvIHVzZSBkaXN0aW5jdAogICAgICAgIGJvb2xlYW4gajFFbXB0eSA9\nIGoxID09IG51bGwgfHwgajEuaXNFbXB0eSgpOwogICAgICAgIGJvb2xlYW4g\najJFbXB0eSA9IGoyID09IG51bGwgfHwgajIuaXNFbXB0eSgpOwogICAgICAg\nIGlmIChqMUVtcHR5IHx8IGoyRW1wdHkpIHsKICAgICAgICAgICAgaWYgKGox\nRW1wdHkgJiYgIWoyRW1wdHkpIHsKICAgICAgICAgICAgICAgIGNvbGxlY3RP\ndXRlckpvaW5zKGoyKTsKICAgICAgICAgICAgICAgIGlmICghajIuaXNFbXB0\neSgpKQogICAgICAgICAgICAgICAgICAgIF9mbGFncyB8PSBJTVBMSUNJVF9E\nSVNUSU5DVDsKICAgICAgICAgICAgfSBlbHNlIGlmIChqMkVtcHR5ICYmICFq\nMUVtcHR5KSB7CiAgICAgICAgICAgICAgICBjb2xsZWN0T3V0ZXJKb2lucyhq\nMSk7CiAgICAgICAgICAgICAgICBpZiAoIWoxLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgICAgICBfZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiBhbGwgY29tbW9uIGpvaW5zLCBtb3ZlIGFsbCBq\nb2lucyB0byByZXR1cm5lZCBpbnN0YW5jZQogICAgICAgIFNlbGVjdEpvaW5z\nIHNqID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwogICAgICAgIGlmIChqMS5q\nb2lucygpLmVxdWFscyhqMi5qb2lucygpKSkgewogICAgICAgICAgICBzai5z\nZXRKb2lucyhqMS5qb2lucygpKTsKICAgICAgICAgICAgajEubnVsbEpvaW5z\nKCk7CiAgICAgICAgICAgIGoyLm51bGxKb2lucygpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIEpvaW5TZXQgY29tbW9uSm9pbnMgPSBuZXcgSm9p\nblNldChqMS5qb2lucygpKTsKICAgICAgICAgICAgY29tbW9uSm9pbnMucmV0\nYWluQWxsKGoyLmpvaW5zKCkpOwogICAgICAgICAgICBpZiAoIWNvbW1vbkpv\naW5zLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgLy8gcHV0IGNvbW1v\nbiBqb2lucyBpbiByZXR1cm5lZCBpbnN0YW5jZTsgcmVtb3ZlIHRoZW0gZnJv\nbQogICAgICAgICAgICAgICAgLy8gZWFjaCBnaXZlbiBpbnN0YW5jZQogICAg\nICAgICAgICAgICAgc2ouc2V0Sm9pbnMoY29tbW9uSm9pbnMpOwogICAgICAg\nICAgICAgICAgajEuam9pbnMoKS5yZW1vdmVBbGwoY29tbW9uSm9pbnMpOwog\nICAgICAgICAgICAgICAgajIuam9pbnMoKS5yZW1vdmVBbGwoY29tbW9uSm9p\nbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbGxlY3RPdXRlckpv\naW5zKGoxKTsKICAgICAgICAgICAgY29sbGVjdE91dGVySm9pbnMoajIpOwoK\nICAgICAgICAgICAgLy8gaWYgb25lIHNpZGUgb2YgdGhlIG9yIGNsYXVzZSBo\nYXMgZGlmZmVyZW50IGpvaW5zIHRoYW4gdGhlIG90aGVyLAogICAgICAgICAg\nICAvLyB0aGVuIHdlIG5lZWQgdG8gdXNlIGRpc3RpbmN0CiAgICAgICAgICAg\nIGlmICghajEuaXNFbXB0eSgpIHx8ICFqMi5pc0VtcHR5KCkpCiAgICAgICAg\nICAgICAgICBfZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBzajsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMg\nb3V0ZXIoSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoX2pvaW5TeW50YXgg\nPT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTCB8fCBqb2lucyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gam9pbnM7CgogICAgICAgIC8v\nIHJlY29yZCB0aGF0IHRoaXMgaXMgYW4gb3V0ZXIgam9pbiBzZXQsIGV2ZW4g\naWYgaXQncyBlbXB0eQogICAgICAgIFBhdGhKb2lucyBwaiA9ICgoUGF0aEpv\naW5zKSBqb2lucykuc2V0T3V0ZXIodHJ1ZSk7CiAgICAgICAgaWYgKHBqLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIHBqOwoKICAgICAgICBKb2lu\nIGpvaW47CiAgICAgICAgSm9pbiByZWM7CiAgICAgICAgYm9vbGVhbiBoYXNK\nb2lucyA9IF9qb2lucyAhPSBudWxsICYmIF9qb2lucy5qb2lucygpICE9IG51\nbGw7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBwai5qb2lucygpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGpvaW4g\nPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGpvaW4uZ2V0\nVHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikgewogICAgICAgICAgICAgICAg\naWYgKCFoYXNKb2lucykKICAgICAgICAgICAgICAgICAgICBqb2luLnNldFR5\ncGUoSm9pbi5UWVBFX09VVEVSKTsKICAgICAgICAgICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIHJlYyA9IF9qb2lucy5qb2lucygpLmdldFJl\nY29yZGVkSm9pbihqb2luKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVj\nID09IG51bGwgfHwgcmVjLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW4uc2V0VHlwZShKb2luLlRZ\nUEVfT1VURVIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBqb2luczsKICAgIH0KCiAgICAvKioK\nICAgICAqIE1vdmVzIHRoZSBqb2lucyBmcm9tIHRoZSBnaXZlbiBpbnN0YW5j\nZSBpbnRvIG91ciBvdXRlciBqb2lucyBzZXQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBjb2xsZWN0T3V0ZXJKb2lucyhQYXRoSm9pbnMgcGopIHsKICAg\nICAgICBpZiAoX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9U\nUkFESVRJT05BTCB8fCBwaiA9PSBudWxsCiAgICAgICAgICAgIHx8IHBqLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2pv\naW5zID09IG51bGwpCiAgICAgICAgICAgIF9qb2lucyA9IG5ldyBTZWxlY3RK\nb2lucyh0aGlzKTsKCiAgICAgICAgYm9vbGVhbiBhZGQgPSB0cnVlOwogICAg\nICAgIGlmIChfam9pbnMuam9pbnMoKSA9PSBudWxsKSB7CiAgICAgICAgICAg\nIF9qb2lucy5zZXRKb2lucyhwai5qb2lucygpKTsKICAgICAgICAgICAgYWRk\nID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBKb2luIGpvaW47CiAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBwai5qb2lucygpLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGpvaW4gPSAoSm9pbikg\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGpvaW4uZ2V0VHlwZSgpID09\nIEpvaW4uVFlQRV9JTk5FUikgewogICAgICAgICAgICAgICAgaWYgKGpvaW4u\nZ2V0Rm9yZWlnbktleSgpICE9IG51bGwKICAgICAgICAgICAgICAgICAgICAm\nJiAhX2RpY3QuY2FuT3V0ZXJKb2luKF9qb2luU3ludGF4LCBqb2luLmdldEZv\ncmVpZ25LZXkoKSkpIHsKICAgICAgICAgICAgICAgICAgICBMb2cgbG9nID0g\nX2NvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImNhbnQt\nb3V0ZXItZmsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbi5n\nZXRGb3JlaWduS2V5KCkpKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgICAgIGpvaW4uc2V0VHlwZShKb2luLlRZUEVfT1VURVIp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhZGQpCiAgICAgICAg\nICAgICAgICBfam9pbnMuam9pbnMoKS5hZGQoam9pbik7CiAgICAgICAgfQog\nICAgICAgIHBqLm51bGxKb2lucygpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBhbGlhcyBmb3IgdGhlIGdpdmVuIHRhYmxlIHVuZGVyIHRo\nZSBnaXZlbiBqb2lucy4KICAgICAqIE5PVEU6IFdFIFJFTFkgT04gVEhFU0Ug\nSU5ERVhFUyBCRUlORyBNT05PVE9OSUNBTExZIElOQ1JFQVNJTkcgRlJPTSAw\nCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldFRhYmxlSW5kZXgoVGFibGUg\ndGFibGUsIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBjcmVhdGUpIHsKICAgICAg\nICAvLyBpZiB3ZSBoYXZlIGEgZnJvbSBzZWxlY3QsIHRoZW4gdGhlcmUgYXJl\nIG5vIHRhYmxlIGFsaWFzZXMKICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICBJbnRlZ2VyIGkgPSBu\ndWxsOwogICAgICAgIE9iamVjdCBrZXkgPSB0YWJsZS5nZXRGdWxsTmFtZSgp\nOwogICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxs\nKQogICAgICAgICAgICBrZXkgPSBuZXcgS2V5KHBqLnBhdGgoKS50b1N0cmlu\nZygpLCBrZXkpOwoKICAgICAgICBpZiAoX2N0eCAhPSBudWxsKQogICAgICAg\nICAgICBpID0gZmluZEFsaWFzRm9yUXVlcnkodGFibGUsIHBqLCBrZXksIGNy\nZWF0ZSk7CgogICAgICAgIGlmIChpICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBpLmludFZhbHVlKCk7CgogICAgICAgIC8vIGNoZWNrIG91dCBleGlz\ndGluZyBhbGlhc2VzCiAgICAgICAgaSA9IGZpbmRBbGlhcyh0YWJsZSwga2V5\nKTsKCiAgICAgICAgaWYgKGkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGkuaW50VmFsdWUoKTsKICAgICAgICBpZiAoIWNyZWF0ZSkKICAgICAgICAg\nICAgcmV0dXJuIC0xOwoKICAgICAgICAvLyBub3QgZm91bmQ7IGNyZWF0ZSBh\nbGlhcwogICAgICAgIGkgPSBOdW1iZXJzLnZhbHVlT2YoYWxpYXNTaXplKG51\nbGwpKTsKLy8gICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiR2V0VGFibGVJ\nbmRleFx0IisKLy8gICAgICAgICAgICAgICAgKChfcGFyZW50ICE9IG51bGwp\nID8gIlN1YiIgOiIiKSArCi8vICAgICAgICAgICAgICAgICIgY3JlYXRlZCBh\nbGlhczogIisKLy8gICAgICAgICAgICAgICAgaS5pbnRWYWx1ZSgpKyAiICIr\nIGtleSk7CiAgICAgICAgcmVjb3JkVGFibGVBbGlhcyh0YWJsZSwga2V5LCBp\nKTsKICAgICAgICByZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIHBy\naXZhdGUgSW50ZWdlciBmaW5kQWxpYXNGb3JRdWVyeShUYWJsZSB0YWJsZSwg\nUGF0aEpvaW5zIHBqLCBPYmplY3Qga2V5LAogICAgICAgIGJvb2xlYW4gY3Jl\nYXRlKSB7CiAgICAgICAgSW50ZWdlciBpID0gbnVsbDsKICAgICAgICBTZWxl\nY3RJbXBsIHNlbCA9IHRoaXM7CiAgICAgICAgU3RyaW5nIGFsaWFzID0gX3Nj\naGVtYUFsaWFzOwogICAgICAgIGlmIChpc1BhdGhJblRoaXNDb250ZXh0KHBq\nKSB8fCB0YWJsZS5pc0Fzc29jaWF0aW9uKCkpICAgICAgICAgIAogICAgICAg\nICAgICBhbGlhcyA9IG51bGw7CgogICAgICAgIC8vIGZpbmQgdGhlIGNvbnRl\neHQgd2hlcmUgdGhpcyBhbGlhcyBpcyBkZWZpbmVkCiAgICAgICAgQ29udGV4\ndCBjdHggPSAoYWxpYXMgIT0gbnVsbCkgPwogICAgICAgICAgICBfY3R4LmZp\nbmRDb250ZXh0KGFsaWFzKSA6IG51bGw7CiAgICAgICAgaWYgKGN0eCAhPSBu\ndWxsKQogICAgICAgICAgICBzZWwgPSAoU2VsZWN0SW1wbCkgY3R4LmdldFNl\nbGVjdCgpOwoKICAgICAgICBpZiAoIWNyZWF0ZSkgCiAgICAgICAgICAgIGkg\nPSBzZWwuZmluZEFsaWFzKHRhYmxlLCBrZXkpOyAgLy8gZmluZCBpbiBwYXJl\nbnQgYW5kIGluIG15c2VsZgogICAgICAgIGVsc2UKICAgICAgICAgICAgaSA9\nIHNlbC5nZXRBbGlhcyh0YWJsZSwga2V5KTsgLy8gZmluZCBpbiBteXNlbGYK\nICAgICAgICBpZiAoaSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gaTsK\nICAgICAgICAKICAgICAgICBpZiAoY3JlYXRlKSB7IC8vIGNyZWF0ZSBoZXJl\nCiAgICAgICAgICAgIGkgPSBzZWwuY3JlYXRlQWxpYXModGFibGUsIGtleSk7\nCiAgICAgICAgfSBlbHNlIGlmIChjdHggIT0gbnVsbCAmJiBjdHggIT0gY3R4\nKCkpIHsgLy8gY3JlYXRlIGluIG90aGVyIHNlbGVjdAogICAgICAgICAgICBp\nID0gKChTZWxlY3RJbXBsKWN0eC5nZXRTZWxlY3QoKSkuY3JlYXRlQWxpYXMo\ndGFibGUsIGtleSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaTsKICAg\nIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gaXNQYXRoSW5UaGlzQ29udGV4dChQ\nYXRoSm9pbnMgcGopIHsKICAgICAgICAvLyBjdXJyQ3R4IGlzIHNldCBmcm9t\nIEFjdGlvbiwgaXQgaXMgcmVzZXQgdG8gbnVsbCBhZnRlciB0aGUgUENQYXRo\nIGluaXRpYWxpemF0aW9uCiAgICAgICAgQ29udGV4dCBjdXJyQ3R4ID0gcGog\nPT0gbnVsbCA/IG51bGwgOiAoKFBhdGhKb2luc0ltcGwpcGopLmNvbnRleHQ7\nCiAgICAgICAgCiAgICAgICAgLy8gbGFzdEN0eCBpcyBzZXQgdG8gY3VyckN0\neCBhZnRlciB0aGUgU2VsZWN0Sm9pbnMuam9pbi4gcGoubGFzdEN0eCBhbmQg\ncGoucGF0aCBzdHJpbmcgYXJlIAogICAgICAgIC8vIHRoZSBsYXN0IHNuYXBz\naG90IG9mIHBqLiBUaGV5IHdpbGwgYmUgdXNlZCB0b2dldGhlciBmb3IgbGF0\nZXIgdGFibGUgYWxpYXMgcmVzb2x1dGlvbiBpbgogICAgICAgIC8vIHRoZSBn\nZXRDb2x1bW5BbGlhcygpLiAKICAgICAgICBDb250ZXh0IGxhc3RDdHggPSBw\naiA9PSBudWxsID8gbnVsbCA6ICgoUGF0aEpvaW5zSW1wbClwaikubGFzdENv\nbnRleHQ7CiAgICAgICAgQ29udGV4dCB0aGlzQ3R4ID0gY3VyckN0eCA9PSBu\ndWxsID8gbGFzdEN0eCA6IGN1cnJDdHg7CiAgICAgICAgU3RyaW5nIGNvcnJW\nYXIgPSBwaiA9PSBudWxsID8gbnVsbCA6IHBqLmdldENvcnJlbGF0ZWRWYXJp\nYWJsZSgpOwogICAgICAgIAogICAgICAgIHJldHVybiAocGogIT0gbnVsbCAm\nJiBwai5wYXRoKCkgIT0gbnVsbCAmJiAKICAgICAgICAgICAgKGNvcnJWYXIg\nPT0gbnVsbCB8fCAodGhpc0N0eCAhPSBudWxsICYmIGN0eCgpID09IHRoaXND\ndHgpKSk7CiAgICB9CiAKICAgIHByaXZhdGUgSW50ZWdlciBnZXRBbGlhcyhU\nYWJsZSB0YWJsZSwgT2JqZWN0IGtleSkgewogICAgICAgIEludGVnZXIgYWxp\nYXMgPSBudWxsOwogICAgICAgIGlmIChfYWxpYXNlcyAhPSBudWxsKQogICAg\nICAgICAgICBhbGlhcyA9IChJbnRlZ2VyKSBfYWxpYXNlcy5nZXQoa2V5KTsK\nICAgICAgICByZXR1cm4gYWxpYXM7CiAgICB9CgogICAgcHJpdmF0ZSBpbnQg\nY3JlYXRlQWxpYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXkpIHsKICAgICAg\nICBJbnRlZ2VyIGkgPSBOdW1iZXJzLnZhbHVlT2YoY3R4KCkubmV4dEFsaWFz\nKCkpOwovLyAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJcdCIrCi8vICAg\nICAgICAgICAgICAgICgoX3BhcmVudCAhPSBudWxsKSA/ICJTdWIiIDoiIikg\nKwovLyAgICAgICAgICAgICAgICAiUXVlcnkgY3JlYXRlZCBhbGlhczogIisg\nCi8vICAgICAgICAgICAgICAgIGkuaW50VmFsdWUoKSsgIiAiKyBrZXkpOwog\nICAgICAgIHJlY29yZFRhYmxlQWxpYXModGFibGUsIGtleSwgaSk7CiAgICAg\nICAgcmV0dXJuIGkuaW50VmFsdWUoKTsKICAgIH0KCiAgICBwcml2YXRlIElu\ndGVnZXIgZmluZEFsaWFzKFRhYmxlIHRhYmxlLCBPYmplY3Qga2V5KSB7CiAg\nICAgICAgSW50ZWdlciBhbGlhcyA9IG51bGw7CiAgICAgICAgaWYgKF9hbGlh\nc2VzICE9IG51bGwpIHsKICAgICAgICAgICAgYWxpYXMgPSAoSW50ZWdlcikg\nX2FsaWFzZXMuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmIChhbGlhcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCkg\newogICAgICAgICAgICBhbGlhcyA9IF9wYXJlbnQuZmluZEFsaWFzKHRhYmxl\nLCBrZXkpOwogICAgICAgICAgICBpZiAoYWxpYXMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBhbGlhczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlY29yZCB0aGUgbWFwcGluZyBvZiB0aGUgZ2l2ZW4ga2V5IHRvIHRo\nZSBnaXZlbiBhbGlhcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY29y\nZFRhYmxlQWxpYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXksIEludGVnZXIg\nYWxpYXMpIHsKICAgICAgICBpZiAoX2FsaWFzZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgX2FsaWFzZXMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9hbGlh\nc2VzLnB1dChrZXksIGFsaWFzKTsKCiAgICAgICAgU3RyaW5nIHRhYmxlU3Ry\naW5nID0gX2RpY3QuZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSArICIgIgog\nICAgICAgICAgICArIHRvQWxpYXMoYWxpYXMuaW50VmFsdWUoKSk7CiAgICAg\nICAgaWYgKF90YWJsZXMgPT0gbnVsbCkKICAgICAgICAgICAgX3RhYmxlcyA9\nIG5ldyBUcmVlTWFwKCk7CiAgICAgICAgX3RhYmxlcy5wdXQoYWxpYXMsIHRh\nYmxlU3RyaW5nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0\nb3RhbCBudW1iZXIgb2YgYWxpYXNlcy4KICAgICAqLwogICAgcHJpdmF0ZSBp\nbnQgYWxpYXNTaXplKFNlbGVjdEltcGwgZnJvbVN1YikgewogICAgICAgIGlu\ndCBhbGlhc2VzID0gKF9wYXJlbnQgPT0gbnVsbCkgPyAwCiAgICAgICAgICAg\nIDogX3BhcmVudC5hbGlhc1NpemUodGhpcyk7CiAgICAgICAgYWxpYXNlcyAr\nPSAoX2FsaWFzZXMgPT0gbnVsbCkgPyAwIDogX2FsaWFzZXMuc2l6ZSgpOwog\nICAgICAgIGlmIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAgICAgIFNl\nbGVjdEltcGwgc3ViOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIF9zdWJzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdWIg\nPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAgICAgICAg\nICAgaWYgKHN1YiAhPSBmcm9tU3ViKQogICAgICAgICAgICAgICAgICAgIGFs\naWFzZXMgKz0gc3ViLmFsaWFzU2l6ZShudWxsKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gYWxpYXNlczsKICAgIH0KICAgIAog\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4g\ndG9TZWxlY3QoZmFsc2UsIG51bGwpLmdldFNRTCgpOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFBhdGhKb2lucyBp\nbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0\nZXIoYm9vbGVhbiBvdXRlcikgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0\nSm9pbnModGhpcykuc2V0T3V0ZXIodHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNEaXJ0eSgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRoKCkgewogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBKb2luU2V0IGpvaW5z\nKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgam9pbkNvdW50KCkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxUYWJs\nZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\nZWxlY3RKb2lucyh0aGlzKS5jcm9zc0pvaW4obG9jYWxUYWJsZSwgZm9yZWln\nblRhYmxlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWdu\nS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5qb2luKGZrLCBp\nbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBvdXRl\nckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFu\nIHRvTWFueSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhp\ncykub3V0ZXJKb2luKGZrLCBpbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAg\nIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVp\nZ25LZXkgZmssIENsYXNzTWFwcGluZyB0YXJnZXQsCiAgICAgICAgaW50IHN1\nYnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAg\nICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmpvaW5SZWxhdGlvbihu\nYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAgaW52ZXJzZSwg\ndG9NYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVs\nYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAgIENs\nYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2Us\nIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RK\nb2lucyh0aGlzKS5vdXRlckpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0\nLCBzdWJzLCAKICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsKICAgIH0K\nCiAgICBwdWJsaWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewog\nICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5zZXRW\nYXJpYWJsZSh2YXIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBzZXRTdWJz\nZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgaWYgKGFsaWFzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIHJldHVybiBu\nZXcgU2VsZWN0Sm9pbnModGhpcykuc2V0U3Vic2VsZWN0KGFsaWFzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYSBTUUwgc3RyaW5nIHNl\nbGVjdGVkIHdpdGggbnVsbCBpZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgTnVsbElkIHsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJl\nc2VudHMgYSBwbGFjZWhvbGRlciBTUUwgc3RyaW5nLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBQbGFjZWhvbGRlciB7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBTZWxlY3RJbXBsIGNsb25lKENvbnRleHQgY3R4KSB7CiAg\nICAgICAgU2VsZWN0SW1wbCBzZWwgPSAoU2VsZWN0SW1wbCkgX2NvbmYuZ2V0\nU1FMRmFjdG9yeUluc3RhbmNlKCkubmV3U2VsZWN0KCk7CiAgICAgICAgc2Vs\nLl9jdHggPSBjdHg7CiAgICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCAmJiBf\ncGFyZW50LmN0eCgpICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5fcGFyZW50\nID0gKFNlbGVjdEltcGwpX3BhcmVudC5jdHgoKS5nZXRTZWxlY3QoKTsKICAg\nICAgICBzZWwuX3NjaGVtYUFsaWFzID0gX3NjaGVtYUFsaWFzOwogICAgICAg\nIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7CiAgICAgICAgcmV0dXJuIHNlbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEtleSB0eXBlIHVzZWQgZm9yIGFsaWFzZXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEtleSB7CgogICAg\nICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9wYXRoOwogICAgICAgIHByaXZh\ndGUgZmluYWwgT2JqZWN0IF9rZXk7CgogICAgICAgIHB1YmxpYyBLZXkoU3Ry\naW5nIHBhdGgsIE9iamVjdCBrZXkpIHsKICAgICAgICAgICAgX3BhdGggPSBw\nYXRoOwogICAgICAgICAgICBfa2V5ID0ga2V5OwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9wYXRoLmhhc2hDb2RlKCkgXiBfa2V5Lmhhc2hDb2RlKCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVy\nKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChvdGhlci5nZXRD\nbGFzcygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIEtleSBrID0gKEtleSkgb3RoZXI7CiAgICAg\nICAgICAgIHJldHVybiBrLl9wYXRoLmVxdWFscyhfcGF0aCkgJiYgay5fa2V5\nLmVxdWFscyhfa2V5KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBfcGF0aCArICJ8\nIiArIF9rZXk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIE9iamVjdCBn\nZXRLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBfa2V5OwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEEge0BsaW5rIFJlc3VsdH0gaW1wbGVt\nZW50YXRpb24gd3JhcHBlZCBhcm91bmQgdGhpcyBzZWxlY3QuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU2VsZWN0UmVzdWx0CiAgICAgICAg\nZXh0ZW5kcyBSZXN1bHRTZXRSZXN1bHQKICAgICAgICBpbXBsZW1lbnRzIFBh\ndGhKb2lucyB7CgogICAgICAgIHByaXZhdGUgU2VsZWN0SW1wbCBfc2VsID0g\nbnVsbDsKCiAgICAgICAgLy8gcG9zaXRpb24gaW4gc2VsZWN0ZWQgY29sdW1u\ncyBsaXN0IHdoZXJlIHdlIGV4cGVjdCB0aGUgbmV4dCBsb2FkCiAgICAgICAg\ncHJpdmF0ZSBpbnQgX3BvcyA9IDA7CiAgICAgICAgcHJpdmF0ZSBTdGFjayBf\ncHJlSm9pbnMgPSBudWxsOwoKICAgICAgICAvKioKICAgICAgICAgKiBDb25z\ndHJ1Y3Rvci4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgU2VsZWN0UmVz\ndWx0KENvbm5lY3Rpb24gY29ubiwgU3RhdGVtZW50IHN0bW50LCBSZXN1bHRT\nZXQgcnMsCiAgICAgICAgICAgIERCRGljdGlvbmFyeSBkaWN0KSB7CiAgICAg\nICAgICAgIHN1cGVyKGNvbm4sIHN0bW50LCBycywgZGljdCk7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9yIHRoaXMgcmVz\ndWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBTZWxlY3RJbXBsIGdl\ndFNlbGVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZWw7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9yIHRoaXMgcmVz\ndWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFNlbGVj\ndChTZWxlY3RJbXBsIHNlbCkgewogICAgICAgICAgICBfc2VsID0gc2VsOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRFYWdlcihGaWVs\nZE1hcHBpbmcga2V5KSB7CiAgICAgICAgICAgIC8vIGRvbid0IGJvdGhlciBj\ncmVhdGluZyBrZXkgaWYgd2Uga25vdyB3ZSBkb24ndCBoYXZlIGFueQogICAg\nICAgICAgICAvLyBlYWdlciByZXN1bHRzCiAgICAgICAgICAgIGlmIChfc2Vs\nLl9lYWdlciA9PSBudWxsIHx8ICFfc2VsLl9lYWdlcktleXMuY29udGFpbnMo\na2V5KSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICBNYXAgbWFwID0gU2VsZWN0UmVzdWx0LnRoaXMuZ2V0RWFnZXJNYXAodHJ1\nZSk7CiAgICAgICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gbWFwLmdldChf\nc2VsLnRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSkpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHV0RWFnZXIoRmllbGRNYXBwaW5n\nIGtleSwgT2JqZWN0IHJlcykgewogICAgICAgICAgICBNYXAgbWFwID0gU2Vs\nZWN0UmVzdWx0LnRoaXMuZ2V0RWFnZXJNYXAodHJ1ZSk7CiAgICAgICAgICAg\nIGlmIChtYXAgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbWFwID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHNldEVhZ2VyTWFwKG1hcCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFwLnB1dChfc2VsLnRvRWFn\nZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSksIHJlcyk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgT2JqZWN0IGxvYWQoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpCiAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBib29sZWFuIGhhc0pv\naW5zID0gam9pbnMgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgKChQYXRo\nSm9pbnMpIGpvaW5zKS5wYXRoKCkgIT0gbnVsbDsKICAgICAgICAgICAgaWYg\nKGhhc0pvaW5zKSB7CiAgICAgICAgICAgICAgICBpZiAoX3ByZUpvaW5zID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3ByZUpvaW5zID0gbmV3IFN0\nYWNrKCk7CiAgICAgICAgICAgICAgICBfcHJlSm9pbnMucHVzaChqb2lucyk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9iamVjdCBvYmogPSBzdXBl\nci5sb2FkKG1hcHBpbmcsIHN0b3JlLCBmZXRjaCwgam9pbnMpOwoKICAgICAg\nICAgICAgLy8gcmVzZXQKICAgICAgICAgICAgaWYgKGhhc0pvaW5zKQogICAg\nICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAgICAgICByZXR1\ncm4gb2JqOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG5ld0pv\naW5zKCkgewogICAgICAgICAgICBQYXRoSm9pbnMgcHJlID0gZ2V0UHJlSm9p\nbnMoKTsKICAgICAgICAgICAgaWYgKHByZSA9PSBudWxsIHx8IHByZS5wYXRo\nKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAg\nICAgICAgICAgUGF0aEpvaW5zSW1wbCBwaiA9IG5ldyBQYXRoSm9pbnNJbXBs\nKCk7CiAgICAgICAgICAgIHBqLnBhdGggPSBuZXcgU3RyaW5nQnVmZmVyKHBy\nZS5wYXRoKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIHJldHVybiBwajsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBib29sZWFuIGNvbnRhaW5z\nSW50ZXJuYWwoT2JqZWN0IG9iaiwgSm9pbnMgam9pbnMpIHsKICAgICAgICAg\nICAgLy8gd2Uga2V5IGRpcmVjdGx5IG9uIG9ianMgYW5kIGpvaW4tbGVzcyBj\nb2xzLCBvciBvbiB0aGUgYWxpYXMKICAgICAgICAgICAgLy8gZm9yIGNvbHMg\nd2l0aCBqb2lucwogICAgICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lu\ncyhqb2lucyk7CiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBh\ndGgoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgb2JqID0gZ2V0Q29sdW1u\nQWxpYXMoKENvbHVtbikgb2JqLCBwaik7CiAgICAgICAgICAgIHJldHVybiBv\nYmogIT0gbnVsbCAmJiBfc2VsLl9zZWxlY3RzLmNvbnRhaW5zKG9iaik7CiAg\nICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjb250YWluc0Fs\nbEludGVybmFsKE9iamVjdFtdIG9ianMsIEpvaW5zIGpvaW5zKQogICAgICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgUGF0aEpv\naW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBPYmplY3Qg\nb2JqOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9ianMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYm\nIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG9iaiA9\nIGdldENvbHVtbkFsaWFzKChDb2x1bW4pIG9ianNbaV0sIHBqKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBvYmogPSBvYmpz\nW2ldOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsIHx8ICFfc2Vs\nLl9zZWxlY3RzLmNvbnRhaW5zKG9iaikpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHVzaEJh\nY2soKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAgIHN1cGVyLnB1c2hCYWNrKCk7\nCiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBhYnNvbHV0\nZUludGVybmFsKGludCByb3cpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICBfcG9zID0gMDsKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmFic29sdXRlSW50ZXJuYWwocm93KTsKICAgICAgICB9Cgog\nICAgICAgIHByb3RlY3RlZCBib29sZWFuIG5leHRJbnRlcm5hbCgpCiAgICAg\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBfcG9z\nID0gMDsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm5leHRJbnRlcm5hbCgp\nOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGludCBmaW5kT2JqZWN0\nKE9iamVjdCBvYmosIEpvaW5zIGpvaW5zKQogICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF9wb3MgPT0gX3NlbC5f\nc2VsZWN0cy5zaXplKCkpCiAgICAgICAgICAgICAgICBfcG9zID0gMDsKCiAg\nICAgICAgICAgIC8vIHdlIGtleSBkaXJlY3RseSBvbiBvYmpzIGFuZCBqb2lu\nLWxlc3MgY29scywgb3Igb24gdGhlIGFsaWFzCiAgICAgICAgICAgIC8vIGZv\nciBjb2xzIHdpdGggam9pbnMKICAgICAgICAgICAgUGF0aEpvaW5zIHBqID0g\nZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBCb29sZWFuIHBrID0gbnVs\nbDsKICAgICAgICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIENvbHVtbiBjb2wgPSAoQ29sdW1u\nKSBvYmo7CiAgICAgICAgICAgICAgICBwayA9IChjb2wuaXNQcmltYXJ5S2V5\nKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAg\nICAgICAgIG9iaiA9IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAgICAg\nICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBTUUxFeGNlcHRpb24oY29sLmdldFRhYmxlKCkgKyAiOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICsgcGoucGF0aCgpICsgIiAoIiAr\nIF9zZWwuX2FsaWFzZXMgKyAiKSIpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyB3ZSBsb2FkIGluIHRoZSBzYW1lIG9yZGVyIHdlIHNlbGVjdCwg\nbW9yZSBvciBsZXNzLi4uCiAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3Rz\nLmdldChfcG9zKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiArK19wb3M7CgogICAgICAgICAgICAvLyBpZiB3ZSdyZSBsb29raW5nIGZv\nciBhIHByaW1hcnkga2V5LCB0cnkgYmFjayBhIGNvdXBsZSBwbGFjZXMsCiAg\nICAgICAgICAgIC8vIHNpbmNlIHBrcyBtaWdodCBiZSBzZWxlY3RlZCBpbiBh\nIHNsaWdodGx5IGRpZmZlcmVudCBvcmRlciB0aGFuCiAgICAgICAgICAgIC8v\nIHRoZXkgYXJlIGxvYWRlZCBiYWNrOyBkb24ndCBjaGFuZ2UgdGhlIG1hcmtl\nciBwb3NpdGlvbgogICAgICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHBrID0gKG9iaiBpbnN0YW5jZW9mIENvbHVtbiAmJiAoKENv\nbHVtbikgb2JqKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgICAg\nICA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAg\nIGlmIChway5ib29sZWFuVmFsdWUoKSkgewogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IF9wb3MgLSAxOyBpID49IDAgJiYgaSA+PSBfcG9zIC0gMzsg\naS0tKQogICAgICAgICAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3RzLmdl\ndChpKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGkgKyAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzZWFy\nY2ggZm9yd2FyZCBvbiB0aGUgYXNzdW1wdGlvbiB0aGF0IHdlIG1pZ2h0IGJl\nIHNraXBwaW5nCiAgICAgICAgICAgIC8vIHNlbGVjdHMgZm9yIHNpYmxpbmcg\nY2xhc3NlczsgYWR2YW5jZSB0aGUgcG9zaXRpb24gaWYgd2UgZmluZAogICAg\nICAgICAgICAvLyBzb21ldGhpbmcgZm9yd2FyZAogICAgICAgICAgICBmb3Ig\nKGludCBpID0gX3BvcyArIDE7IGkgPCBfc2VsLl9zZWxlY3RzLnNpemUoKTsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0cy5nZXQo\naSkuZXF1YWxzKG9iaikpIHsKICAgICAgICAgICAgICAgICAgICBfcG9zID0g\naTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKytfcG9zOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBtYXli\nZSB0aGUgY29sdW1uIHdhcyBzZWxlY3RlZCBieSAyIGRpZmZlcmVudCBtYXBw\naW5ncywgc28gaXQncwogICAgICAgICAgICAvLyBzb21ld2hlcmUgcHJpb3Ig\ndG8gdGhlIGN1cnJlbnQgcG9zaXRpb247IGluIHRoaXMgY2FzZSBsZWF2ZSB0\naGUKICAgICAgICAgICAgLy8gcG9zaXRpb24gbWFya2VyIGF0IGl0cyBjdXJy\nZW50IHBsYWNlIGNhdXNlIHN1YnNlcXVlbnQgbG9hZHMgd2lsbAogICAgICAg\nICAgICAvLyBzdGlsbCBwcm9iYWJseSBzdGFydCBmcm9tIHRoZXJlCiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3BvczsgaSsrKQogICAgICAg\nICAgICAgICAgaWYgKF9zZWwuX3NlbGVjdHMuZ2V0KGkpLmVxdWFscyhvYmop\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMTsKCiAgICAgICAg\nICAgIC8vIHNvbWV0aGluZ3MncyB3cm9uZy4uLgogICAgICAgICAgICB0aHJv\ndyBuZXcgU1FMRXhjZXB0aW9uKG9iai50b1N0cmluZygpKTsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgam9pbnMgdG8g\ndXNlIHRvIGZpbmQgY29sdW1uIGRhdGEuCiAgICAgICAgICovCiAgICAgICAg\ncHJpdmF0ZSBQYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMpIHsKICAg\nICAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9pbnM7CiAg\nICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIHBqOwogICAgICAgICAgICByZXR1\ncm4gZ2V0UHJlSm9pbnMoKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFJldHVybiB0aGUgcHJlIGpvaW5zIGZvciB0aGUgcmVzdWx0LCBv\nciBudWxsIGlmIG5vbmUuIE5vdGUgdGhhdAogICAgICAgICAqIHdlIGhhdmUg\ndG8gdGFrZSB0aGUgU2VsZWN0J3MgcHJlIGpvaW5zIGludG8gYWNjb3VudCB0\nb28sIHNpbmNlCiAgICAgICAgICogYmF0Y2hlZCBzZWxlY3RzIGNhbiBoYXZl\nIGFkZGl0aW9uYWwgcHJlIGpvaW5zIG9uIHRoZSBzdGFjayBldmVuCiAgICAg\nICAgICogb24gZXhlY3V0aW9uLgogICAgICAgICAqLwogICAgICAgIHByaXZh\ndGUgUGF0aEpvaW5zIGdldFByZUpvaW5zKCkgewogICAgICAgICAgICBpZiAo\nX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gKFBhdGhKb2lucykgX3ByZUpvaW5zLnBl\nZWsoKTsKICAgICAgICAgICAgaWYgKF9zZWwuX3ByZUpvaW5zICE9IG51bGwg\nJiYgIV9zZWwuX3ByZUpvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiAoUGF0aEpvaW5zKSBfc2VsLl9wcmVKb2lucy5wZWVrKCk7CiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogUmV0dXJuIHRoZSBhbGlhcyB1c2VkIHRvIGtleSBvbiB0\naGUgY29sdW1uIGRhdGEsIGNvbnNpZGVyaW5nIHRoZQogICAgICAgICAqIGdp\ndmVuIGpvaW5zLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgU3RyaW5n\nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaikgewog\nICAgICAgICAgICBTdHJpbmcgYWxpYXM7CiAgICAgICAgICAgIGlmIChfc2Vs\nLl9mcm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGFsaWFzID0gX3Nl\nbC50b0FsaWFzKF9zZWwuX2Zyb20uZ2V0VGFibGVJbmRleAogICAgICAgICAg\nICAgICAgICAgIChjb2wuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSk7CiAgICAg\nICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChfc2VsLl9k\naWN0LnJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIEZST01fU0VMRUNUX0FMSUFTICsgIi4iICsgYWxpYXMg\nKyAiXyIgKyBjb2w7CiAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXMgKyAi\nXyIgKyBjb2w7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxpYXMgPSBf\nc2VsLnRvQWxpYXMoX3NlbC5nZXRUYWJsZUluZGV4KGNvbC5nZXRUYWJsZSgp\nLCBwaiwgZmFsc2UpKTsKICAgICAgICAgICAgcmV0dXJuIChhbGlhcyA9PSBu\ndWxsKSA/IG51bGwgOiBhbGlhcyArICIuIiArIGNvbDsKICAgICAgICB9Cgog\nICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAv\nLyBQYXRoSm9pbnMgaW1wbGVtZW50YXRpb24KICAgICAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nT3V0ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBv\ndXRlcikgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmdCdWZmZXIgcGF0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pblNldCBqb2lucygpIHsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGpvaW5Db3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxUYWJsZSwgVGFibGUg\nZm9yZWlnblRhYmxlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW4oRm9yZWlnbktleSBm\naywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBK\nb2lucyBvdXRlckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNl\nLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24o\nU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAgICAgICBDbGFz\nc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBi\nb29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFBhdGhK\nb2luc0ltcGwoKS5qb2luUmVsYXRpb24obmFtZSwgZmssIHRhcmdldCwgc3Vi\ncywgCiAgICAgICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0\ncmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLAogICAgICAgICAgICBDbGFzc01h\ncHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29s\nZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFBhdGhKb2lu\nc0ltcGwoKS5vdXRlckpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0LCBz\ndWJzLAogICAgICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRWYXJpYWJsZShTdHJpbmcg\ndmFyKSB7CiAgICAgICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICByZXR1cm4gbmV3IFBh\ndGhKb2luc0ltcGwoKS5zZXRWYXJpYWJsZSh2YXIpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIEpvaW5zIHNldFN1YnNlbGVjdChTdHJpbmcgYWxpYXMp\nIHsKICAgICAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXRo\nSm9pbnNJbXBsKCkuc2V0U3Vic2VsZWN0KGFsaWFzKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBKb2lucyBzZXRDb3JyZWxhdGVkVmFyaWFibGUoU3Ry\naW5nIHZhcikgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRKb2luQ29udGV4dChDb250ZXh0\nIGN0eCkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ycmVsYXRlZFZhcmlhYmxlKCkg\newogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIG1vdmVKb2luc1RvUGFyZW50KCkgewogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEJhc2Ugam9pbnMgaW1wbGVtZW50YXRp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFBhdGhKb2lu\nc0ltcGwKICAgICAgICBpbXBsZW1lbnRzIFBhdGhKb2lucyB7CgogICAgICAg\nIHByb3RlY3RlZCBTdHJpbmdCdWZmZXIgcGF0aCA9IG51bGw7CiAgICAgICAg\ncHJvdGVjdGVkIFN0cmluZyB2YXIgPSBudWxsOwogICAgICAgIHByb3RlY3Rl\nZCBTdHJpbmcgY29ycmVsYXRlZFZhciA9IG51bGw7CiAgICAgICAgcHJvdGVj\ndGVkIENvbnRleHQgY29udGV4dCA9IG51bGw7CiAgICAgICAgcHJvdGVjdGVk\nIENvbnRleHQgbGFzdENvbnRleHQgPSBudWxsOwoKICAgICAgICBwdWJsaWMg\nU2VsZWN0IGdldFNlbGVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkg\newogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsK\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgICAgICByZXR1cm4g\ndmFyICE9IG51bGwgfHwgcGF0aCAhPSBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRoKCkgewogICAgICAgICAgICBy\nZXR1cm4gcGF0aDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0\nIGpvaW5zKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAg\nICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51\nbGxKb2lucygpIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBz\nZXRWYXJpYWJsZShTdHJpbmcgdmFyKSB7CiAgICAgICAgICAgIHRoaXMudmFy\nID0gdmFyOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFyaWFibGUoKSB7CiAgICAgICAg\nICAgIHJldHVybiB2YXI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1\nYmxpYyBKb2lucyBzZXRDb3JyZWxhdGVkVmFyaWFibGUoU3RyaW5nIHZhcikg\newogICAgICAgICAgICB0aGlzLmNvcnJlbGF0ZWRWYXIgPSB2YXI7CiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICAKICAgICAg\nICBwdWJsaWMgU3RyaW5nIGdldENvcnJlbGF0ZWRWYXJpYWJsZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIGNvcnJlbGF0ZWRWYXI7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSm9pbnMgc2V0Sm9pbkNvbnRleHQoQ29udGV4dCBjb250\nZXh0KSB7CiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAg\nICAgICAgIGFwcGVuZChhbGlhcyk7CiAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2FsVGFibGUsIFRh\nYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAgICBhcHBlbmQodmFyKTsK\nICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pbihGb3Jl\naWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBu\ndWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW4oRm9yZWlnbktleSBmaywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBh\ncHBlbmQodmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9p\nbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCAK\nICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJv\nb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAg\nYXBwZW5kKG5hbWUpOwogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAg\nICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVsYXRp\nb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAgICAgICAgICAgIENs\nYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2Us\nIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVuZChuYW1lKTsK\nICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51\nbGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kKFN0cmluZyBzdHIpIHsKICAgICAg\nICAgICAgaWYgKHN0ciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\ncGF0aCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHBhdGggPSBuZXcg\nU3RyaW5nQnVmZmVyKHN0cik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoJy4nKS5hcHBlbmQoc3RyKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuICJQYXRoSm9pbnNJ\nbXBsPCIgKyBoYXNoQ29kZSgpICsgIj46ICIKICAgICAgICAgICAgICAgICsg\nU3RyaW5nLnZhbHVlT2YocGF0aCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBtb3ZlSm9pbnNUb1BhcmVudCgpIHsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBKb2lucyBpbXBsZW1lbnRhdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU2VsZWN0Sm9pbnMKICAgICAg\nICBleHRlbmRzIFBhdGhKb2luc0ltcGwgCiAgICAgICAgaW1wbGVtZW50cyBD\nbG9uZWFibGUgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFNlbGVjdEltcGwg\nX3NlbDsKICAgICAgICBwcml2YXRlIEpvaW5TZXQgX2pvaW5zID0gbnVsbDsK\nICAgICAgICBwcml2YXRlIGJvb2xlYW4gX291dGVyID0gZmFsc2U7CiAgICAg\nICAgcHJpdmF0ZSBpbnQgX2NvdW50ID0gMDsKCiAgICAgICAgcHVibGljIFNl\nbGVjdEpvaW5zKFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAgICAgIF9zZWwg\nPSBzZWw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU2VsZWN0IGdldFNl\nbGVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZWw7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgICAg\nICByZXR1cm4gX291dGVyOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFBh\ndGhKb2lucyBzZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgICAg\nIF9vdXRlciA9IG91dGVyOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAg\nICAgICAgICAgIHJldHVybiBzdXBlci5pc0RpcnR5KCkgfHwgIWlzRW1wdHko\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkg\newogICAgICAgICAgICByZXR1cm4gX2pvaW5zOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgc2V0Sm9pbnMoSm9pblNldCBqb2lucykgewogICAg\nICAgICAgICBfam9pbnMgPSBqb2luczsKICAgICAgICAgICAgX291dGVyID0g\nam9pbnMgIT0gbnVsbCAmJiBqb2lucy5sYXN0KCkgIT0gbnVsbAogICAgICAg\nICAgICAgICAgJiYgam9pbnMubGFzdCgpLmdldFR5cGUoKSA9PSBKb2luLlRZ\nUEVfT1VURVI7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpvaW5D\nb3VudCgpIHsKICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIF9jb3VudDsKICAgICAgICAgICAgcmV0dXJu\nIE1hdGgubWF4KF9jb3VudCwgX2pvaW5zLnNpemUoKSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAgICAgICAgICAg\nIGlmIChfam9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9jb3VudCA9\nIE1hdGgubWF4KF9jb3VudCwgX2pvaW5zLnNpemUoKSk7CiAgICAgICAgICAg\nIF9qb2lucyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBpc0VtcHR5KCkgewogICAgICAgICAgICByZXR1cm4gX2pvaW5zID09\nIG51bGwgfHwgX2pvaW5zLmlzRW1wdHkoKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxUYWJsZSwgVGFi\nbGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgICAgIC8vIGNyb3NzIGpvaW5z\nIGFyZSBmb3IgdW5ib3VuZCB2YXJpYWJsZXM7IHVuZm9ydHVuYXRlbHkgd2Ug\naGF2ZQogICAgICAgICAgICAvLyB0byBhbHdheXMgZ28gRElTVElOQ1QgZm9y\nIHVuYm91bmQgdmFycyBiZWNhdXNlIHRoZXJlIGFyZSBjZXJ0YWluCiAgICAg\nICAgICAgIC8vIGNhc2VzIHRoYXQgcmVxdWlyZSBpdCwgYW5kIHdlIGNhbid0\nIGRpZmZlcmVudGlhdGUgdGhlbSBmcm9tIHRoZQogICAgICAgICAgICAvLyBj\nYXNlcyB0aGF0IGRvbid0CiAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9IElN\nUExJQ0lUX0RJU1RJTkNUOwoKICAgICAgICAgICAgaWYgKF9zZWwuZ2V0Sm9p\nblN5bnRheCgpICE9IEpvaW5TeW50YXhlcy5TWU5UQVhfU1FMOTIKICAgICAg\nICAgICAgICAgIHx8IF9zZWwuX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgLy8gZG9uJ3QgbWFrZSBhbnkgam9pbnMsIGJ1dCB1cGRhdGUgdGhl\nIHBhdGggaWYgYSB2YXJpYWJsZQogICAgICAgICAgICAgICAgLy8gaGFzIGJl\nZW4gc2V0CiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZCh0aGlzLnZhcik7\nCiAgICAgICAgICAgICAgICB0aGlzLnZhciA9IG51bGw7CiAgICAgICAgICAg\nICAgICBfb3V0ZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkb24ndCBsZXQg\ndGhlIGdldCBhbGlhcyBtZXRob2RzIHNlZSB0aGF0IGEgdmFyIGhhcyBiZWVu\nIHNldAogICAgICAgICAgICAvLyB1bnRpbCB3ZSBnZXQgcGFzdCB0aGUgbG9j\nYWwgdGFibGUKICAgICAgICAgICAgU3RyaW5nIHZhciA9IHRoaXMudmFyOwog\nICAgICAgICAgICB0aGlzLnZhciA9IG51bGw7CiAgICAgICAgICAgIENvbnRl\neHQgY3R4ID0gY29udGV4dDsgCiAgICAgICAgICAgIGNvbnRleHQgPSBudWxs\nOyAKCiAgICAgICAgICAgIGludCBhbGlhczEgPSBfc2VsLmdldFRhYmxlSW5k\nZXgobG9jYWxUYWJsZSwgdGhpcywgdHJ1ZSk7CiAgICAgICAgICAgIHRoaXMu\nYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kKGNvcnJlbGF0\nZWRWYXIpOwogICAgICAgICAgICBjb250ZXh0ID0gY3R4OyAKICAgICAgICAg\nICAgCiAgICAgICAgICAgIGludCBhbGlhczIgPSBfc2VsLmdldFRhYmxlSW5k\nZXgoZm9yZWlnblRhYmxlLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAgSm9p\nbiBqID0gbmV3IEpvaW4obG9jYWxUYWJsZSwgYWxpYXMxLCBmb3JlaWduVGFi\nbGUsIGFsaWFzMiwKICAgICAgICAgICAgICAgIG51bGwsIGZhbHNlKTsKICAg\nICAgICAgICAgai5zZXRUeXBlKEpvaW4uVFlQRV9DUk9TUyk7CgogICAgICAg\nICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBfam9p\nbnMgPSBuZXcgSm9pblNldCgpOwogICAgICAgICAgICBfam9pbnMuYWRkKGop\nOwogICAgICAgICAgICBzZXRDb3JyZWxhdGVkKGopOwogICAgICAgICAgICBf\nb3V0ZXIgPSBmYWxzZTsKICAgICAgICAgICAgbGFzdENvbnRleHQgPSAgY29u\ndGV4dDsKICAgICAgICAgICAgY29udGV4dCA9IG51bGw7CiAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5z\nIGpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFu\nIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4gam9pbihudWxsLCBmaywg\nbnVsbCwgLTEsIGludmVyc2UsIHRvTWFueSwgZmFsc2UpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZr\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAg\nICAgIHJldHVybiBqb2luKG51bGwsIGZrLCBudWxsLCAtMSwgaW52ZXJzZSwg\ndG9NYW55LCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\ncyBqb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAog\nICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBy\nZXR1cm4gam9pbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCBpbnZlcnNlLCB0\nb01hbnksIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\ncyBvdXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBm\naywKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMs\nIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAg\nICAgcmV0dXJuIGpvaW4obmFtZSwgZmssIHRhcmdldCwgc3VicywgaW52ZXJz\nZSwgdG9NYW55LCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\nSm9pbnMgam9pbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgQ2xhc3NN\nYXBwaW5nIHRhcmdldCwKICAgICAgICAgICAgaW50IHN1YnMsIGJvb2xlYW4g\naW52ZXJzZSwgYm9vbGVhbiB0b01hbnksIGJvb2xlYW4gb3V0ZXIpIHsKICAg\nICAgICAgICAgLy8gZG9uJ3QgbGV0IHRoZSBnZXQgYWxpYXMgbWV0aG9kcyBz\nZWUgdGhhdCBhIHZhciBoYXMgYmVlbiBzZXQKICAgICAgICAgICAgLy8gdW50\naWwgd2UgZ2V0IHBhc3QgdGhlIGxvY2FsIHRhYmxlCiAgICAgICAgICAgIFN0\ncmluZyB2YXIgPSB0aGlzLnZhcjsKICAgICAgICAgICAgdGhpcy52YXIgPSBu\ndWxsOwogICAgICAgICAgICBDb250ZXh0IGN0eCA9IGNvbnRleHQ7IAogICAg\nICAgICAgICBjb250ZXh0ID0gbnVsbDsgCgogICAgICAgICAgICAvLyBnZXQg\nZmlyc3QgdGFibGUgYWxpYXMgYmVmb3JlIHVwZGF0aW5nIHBhdGg7IGlmIHRo\nZXJlIGlzIGEgZnJvbQogICAgICAgICAgICAvLyBzZWxlY3QgdGhlbiB3ZSBz\naG91bGRuJ3QgYWN0dWFsbHkgY3JlYXRlIGEgam9pbiBvYmplY3QsIHNpbmNl\nCiAgICAgICAgICAgIC8vIHRoZSBqb2lucyB3aWxsIGFsbCBiZSBkb25lIGlu\nIHRoZSBmcm9tIHNlbGVjdAogICAgICAgICAgICBib29sZWFuIGNyZWF0ZUpv\naW4gPSBfc2VsLl9mcm9tID09IG51bGw7CiAgICAgICAgICAgIFRhYmxlIHRh\nYmxlMSA9IG51bGw7CiAgICAgICAgICAgIGludCBhbGlhczEgPSAtMTsKICAg\nICAgICAgICAgaWYgKGNyZWF0ZUpvaW4pIHsKICAgICAgICAgICAgICAgIGJv\nb2xlYW4gY3JlYXRlSW5kZXggPSB0cnVlOwogICAgICAgICAgICAgICAgdGFi\nbGUxID0gKGludmVyc2UpID8gZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCkgOiBm\nay5nZXRUYWJsZSgpOwogICAgICAgICAgICAgICAgaWYgKGNvcnJlbGF0ZWRW\nYXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjcmVhdGVJbmRleCA9\nIGZhbHNlOyAgLy8gbm90IHRvIGNyZWF0ZSBoZXJlCiAgICAgICAgICAgICAg\nICBhbGlhczEgPSBfc2VsLmdldFRhYmxlSW5kZXgodGFibGUxLCB0aGlzLCBj\ncmVhdGVJbmRleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHVw\nZGF0ZSB0aGUgcGF0aCB3aXRoIHRoZSByZWxhdGlvbiBuYW1lIGJlZm9yZSBn\nZXR0aW5nIHBrIGFsaWFzCiAgICAgICAgICAgIHRoaXMuYXBwZW5kKG5hbWUp\nOwogICAgICAgICAgICB0aGlzLmFwcGVuZCh2YXIpOwogICAgICAgICAgICBp\nZiAodmFyID09IG51bGwpCiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZChj\nb3JyZWxhdGVkVmFyKTsKICAgICAgICAgICAgY29udGV4dCA9IGN0eDsgCiAg\nICAgICAgICAgIAogICAgICAgICAgICBpZiAodG9NYW55KSB7CiAgICAgICAg\nICAgICAgICBfc2VsLl9mbGFncyB8PSBJTVBMSUNJVF9ESVNUSU5DVDsKICAg\nICAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9IFRPX01BTlk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgX291dGVyID0gb3V0ZXI7CgogICAgICAgICAg\nICBpZiAoY3JlYXRlSm9pbikgewogICAgICAgICAgICAgICAgYm9vbGVhbiBj\ncmVhdGVJbmRleCA9IHRydWU7CiAgICAgICAgICAgICAgICBUYWJsZSB0YWJs\nZTIgPSAoaW52ZXJzZSkgPyBmay5nZXRUYWJsZSgpIAogICAgICAgICAgICAg\nICAgICAgIDogZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCk7CiAgICAgICAgICAg\nICAgICBpZiAodGFibGUyLmlzQXNzb2NpYXRpb24oKSkKICAgICAgICAgICAg\nICAgICAgICBjcmVhdGVJbmRleCA9IHRydWU7CiAgICAgICAgICAgICAgICBl\nbHNlIGlmIChjb250ZXh0ID09IF9zZWwuY3R4KCkpIAogICAgICAgICAgICAg\nICAgICAgY3JlYXRlSW5kZXggPSB0cnVlOwogICAgICAgICAgICAgICAgZWxz\nZSBpZiAoY29ycmVsYXRlZFZhciAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIGNyZWF0ZUluZGV4ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpbnQg\nYWxpYXMyID0gX3NlbC5nZXRUYWJsZUluZGV4KHRhYmxlMiwgdGhpcywgY3Jl\nYXRlSW5kZXgpOwogICAgICAgICAgICAgICAgSm9pbiBqID0gbmV3IEpvaW4o\ndGFibGUxLCBhbGlhczEsIHRhYmxlMiwgYWxpYXMyLCBmaywgaW52ZXJzZSk7\nCiAgICAgICAgICAgICAgICBqLnNldFR5cGUoKG91dGVyKSA/IEpvaW4uVFlQ\nRV9PVVRFUiA6IEpvaW4uVFlQRV9JTk5FUik7CgogICAgICAgICAgICAgICAg\naWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9qb2lu\ncyA9IG5ldyBKb2luU2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoX2pvaW5z\nLmFkZChqKSAmJiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSAKICAg\nICAgICAgICAgICAgICAgICB8fCBzdWJzID09IFNlbGVjdC5TVUJTX05PTkUp\nKQogICAgICAgICAgICAgICAgICAgIGouc2V0UmVsYXRpb24odGFyZ2V0LCBz\ndWJzLCBjbG9uZShfc2VsKSk7CgogICAgICAgICAgICAgICAgc2V0Q29ycmVs\nYXRlZChqKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXN0Q29udGV4\ndCA9IGNvbnRleHQ7CiAgICAgICAgICAgIGNvbnRleHQgPSBudWxsOwogICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHByaXZh\ndGUgdm9pZCBzZXRDb3JyZWxhdGVkKEpvaW4gaikgewogICAgICAgICAgICBp\nZiAoX3NlbC5fcGFyZW50ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CgogICAgICAgICAgICBpZiAoX3NlbC5fYWxpYXNlcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBqLnNldElzTm90TXlKb2luKCk7CiAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgT2Jq\nZWN0IGFsaWFzZXNbXSA9IF9zZWwuX2FsaWFzZXMudmFsdWVzKCkudG9BcnJh\neSgpOwogICAgICAgICAgICBib29sZWFuIGZvdW5kMSA9IGZhbHNlOwogICAg\nICAgICAgICBib29sZWFuIGZvdW5kMiA9IGZhbHNlOwoKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpbnQgYWxpYXMgPSAoKEludGVnZXIpYWxpYXNlc1tp\nXSkuaW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChhbGlhcyA9PSBq\nLmdldEluZGV4MSgpKQogICAgICAgICAgICAgICAgICAgIGZvdW5kMSA9IHRy\ndWU7CiAgICAgICAgICAgICAgICBpZiAoYWxpYXMgPT0gai5nZXRJbmRleDIo\nKSkKICAgICAgICAgICAgICAgICAgICBmb3VuZDIgPSB0cnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGZvdW5k\nMSAmJiBmb3VuZDIpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIGVsc2UgaWYgKCFmb3VuZDEgJiYgIWZvdW5kMikgewogICAgICAgICAg\nICAgICAgai5zZXRJc05vdE15Sm9pbigpOwogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgai5zZXRDb3JyZWxhdGVkKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG1vdmVKb2luc1RvUGFyZW50\nKCkgewogICAgICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgSm9pbiBqID0gbnVsbDsKICAg\nICAgICAgICBMaXN0PEpvaW4+IHJlbW92ZWQgPSBuZXcgQXJyYXlMaXN0PEpv\naW4+KDUpOwogICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2pvaW5z\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nIGogPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgaWYgKGou\naXNOb3RNeUpvaW4oKSkgewogICAgICAgICAgICAgICAgICAgYWRkSm9pbnNU\nb1BhcmVudChfc2VsLl9wYXJlbnQsIGopOwogICAgICAgICAgICAgICAgICAg\ncmVtb3ZlZC5hZGQoaik7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICB9\nCiAgICAgICAgICAgZm9yIChKb2luIGpvaW4gOiByZW1vdmVkKSB7CiAgICAg\nICAgICAgICAgIF9qb2lucy5yZW1vdmUoam9pbik7CiAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGFkZEpvaW5zVG9QYXJl\nbnQoU2VsZWN0SW1wbCBwYXJlbnQsIEpvaW4gam9pbikgewogICAgICAgICAg\nICBpZiAocGFyZW50Ll9hbGlhc2VzID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIE9iamVjdCBhbGlhc2VzW10gPSBwYXJl\nbnQuX2FsaWFzZXMudmFsdWVzKCkudG9BcnJheSgpOwogICAgICAgICAgICBi\nb29sZWFuIGZvdW5kMSA9IGZhbHNlOwogICAgICAgICAgICBib29sZWFuIGZv\ndW5kMiA9IGZhbHNlOwoKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBhbGlhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpbnQg\nYWxpYXMgPSAoKEludGVnZXIpYWxpYXNlc1tpXSkuaW50VmFsdWUoKTsKICAg\nICAgICAgICAgICAgIGlmIChhbGlhcyA9PSBqb2luLmdldEluZGV4MSgpKQog\nICAgICAgICAgICAgICAgICAgIGZvdW5kMSA9IHRydWU7CiAgICAgICAgICAg\nICAgICBpZiAoYWxpYXMgPT0gam9pbi5nZXRJbmRleDIoKSkKICAgICAgICAg\nICAgICAgICAgICBmb3VuZDIgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGZvdW5kMSAmJiBmb3VuZDIp\nIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgbXkgam9pbiwgYWRkIGpv\naW4KICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuX2pvaW5zID09IG51bGwp\nIAogICAgICAgICAgICAgICAgICAgIHBhcmVudC5fam9pbnMgPSBuZXcgU2Vs\nZWN0Sm9pbnMocGFyZW50KTsKICAgICAgICAgICAgICAgIFNlbGVjdEpvaW5z\nIHAgPSBwYXJlbnQuX2pvaW5zOwogICAgICAgICAgICAgICAgaWYgKHAuam9p\nbnMoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHAuc2V0Sm9pbnMo\nbmV3IEpvaW5TZXQoKSk7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAg\nICAgcC5qb2lucygpLmFkZChqb2luKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBlbHNlIGlmIChwYXJlbnQuX3BhcmVudCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgYWRkSm9pbnNUb1BhcmVudChwYXJlbnQuX3BhcmVudCwgam9p\nbik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU2VsZWN0Sm9pbnMgY2xv\nbmUoU2VsZWN0SW1wbCBzZWwpIHsKICAgICAgICAgICAgU2VsZWN0Sm9pbnMg\nc2ogPSBuZXcgU2VsZWN0Sm9pbnMoc2VsKTsKICAgICAgICAgICAgc2oudmFy\nID0gdmFyOwogICAgICAgICAgICBpZiAocGF0aCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgc2oucGF0aCA9IG5ldyBTdHJpbmdCdWZmZXIocGF0aC50b1N0\ncmluZygpKTsKICAgICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxsICYmICFf\nam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgc2ouX2pvaW5zID0g\nbmV3IEpvaW5TZXQoX2pvaW5zKTsKICAgICAgICAgICAgc2ouX291dGVyID0g\nX291dGVyOwogICAgICAgICAgICByZXR1cm4gc2o7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICBy\nZXR1cm4gc3VwZXIudG9TdHJpbmcoKSArICIgKCIgKyBfb3V0ZXIgKyAiKTog\nIiArIF9qb2luczsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByb3RlY3Rl\nZCBTZWxlY3RzIG5ld1NlbGVjdHMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\nZWxlY3RzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgY2xhc3Mg\ndG8gdHJhY2sgc2VsZWN0ZWQgY29sdW1ucywgd2l0aCBmYXN0IGNvbnRhaW5z\nIG1ldGhvZC4KICAgICAqIEFjdHMgYXMgYSBsaXN0IG9mIHNlbGVjdCBpZHMs\nIHdpdGggYWRkaXRpb25hbCBtZXRob2RzIHRvIG1hbmlwdWxhdGUKICAgICAq\nIHRoZSBhbGlhcyBvZiBlYWNoIHNlbGVjdGVkIGlkLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGNsYXNzIFNlbGVjdHMKICAgICAgICBleHRlbmRz\nIEFic3RyYWN0TGlzdCB7CgogICAgICAgIHByb3RlY3RlZCBMaXN0IF9pZHMg\nPSBudWxsOwogICAgICAgIHByb3RlY3RlZCBMaXN0IF9pZGVudHMgPSBudWxs\nOwogICAgICAgIHByb3RlY3RlZCBNYXAgX2FsaWFzZXMgPSBudWxsOwogICAg\nICAgIHByb3RlY3RlZCBNYXAgX3NlbGVjdEFzID0gbnVsbDsKICAgICAgICBw\ncm90ZWN0ZWQgREJEaWN0aW9uYXJ5IF9kaWN0ID0gbnVsbDsKCiAgICAgICAg\nLyoqCiAgICAgICAgICogQWRkIGFsbCBhbGlhc2VzIGZyb20gYW5vdGhlciBp\nbnN0YW5jZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGRB\nbGwoU2VsZWN0cyBzZWxzKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51\nbGwgJiYgc2Vscy5faWRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfaWRz\nID0gbmV3IEFycmF5TGlzdChzZWxzLl9pZHMpOwogICAgICAgICAgICBlbHNl\nIGlmIChzZWxzLl9pZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9pZHMu\nYWRkQWxsKHNlbHMuX2lkcyk7CgogICAgICAgICAgICBpZiAoX2lkZW50cyA9\nPSBudWxsICYmIHNlbHMuX2lkZW50cyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX2lkZW50cyA9IG5ldyBBcnJheUxpc3Qoc2Vscy5faWRlbnRzKTsKICAg\nICAgICAgICAgZWxzZSBpZiAoc2Vscy5faWRlbnRzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfaWRlbnRzLmFkZEFsbChzZWxzLl9pZGVudHMpOwoKICAg\nICAgICAgICAgaWYgKF9hbGlhc2VzID09IG51bGwgJiYgc2Vscy5fYWxpYXNl\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcgSGFz\naE1hcChzZWxzLl9hbGlhc2VzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vs\ncy5fYWxpYXNlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2FsaWFzZXMu\ncHV0QWxsKHNlbHMuX2FsaWFzZXMpOwoKICAgICAgICAgICAgaWYgKF9zZWxl\nY3RBcyA9PSBudWxsICYmIHNlbHMuX3NlbGVjdEFzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfc2VsZWN0QXMgPSBuZXcgSGFzaE1hcChzZWxzLl9zZWxl\nY3RBcyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHNlbHMuX3NlbGVjdEFzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfc2VsZWN0QXMucHV0QWxsKHNlbHMu\nX3NlbGVjdEFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIFJldHVybnMgdGhlIGFsaWFzIG9mIGEgZ2l2ZW4gaWQuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRBbGlhcyhPYmplY3QgaWQpIHsK\nICAgICAgICAgICAgcmV0dXJuIChfYWxpYXNlcyA9PSBudWxsKSA/IG51bGwg\nOiBfYWxpYXNlcy5nZXQoaWQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogU2V0IGFuIGFsaWFzIGZvciBhIGdpdmVuIGlkLgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyBpbnQgc2V0QWxpYXMoT2JqZWN0IGlkLCBP\nYmplY3QgYWxpYXMsIGJvb2xlYW4gaWRlbnQpIHsKICAgICAgICAgICAgaWYg\nKF9pZHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2lkcyA9IG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50IGlkeDsK\nICAgICAgICAgICAgaWYgKF9hbGlhc2VzLnB1dChpZCwgYWxpYXMpICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBpZHggPSBfaWRzLmluZGV4T2YoaWQpOwog\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIF9pZHMuYWRkKGlk\nKTsKICAgICAgICAgICAgICAgIGlkeCA9IF9pZHMuc2l6ZSgpIC0gMTsKCiAg\nICAgICAgICAgICAgICBpZiAoaWRlbnQpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX2lkZW50cyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBfaWRlbnRzID0gbmV3IEFycmF5TGlzdCgzKTsKICAgICAgICAgICAgICAg\nICAgICBfaWRlbnRzLmFkZChpZCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGlkeDsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFNldCBhbiBhbGlhcyBmb3IgYSBnaXZl\nbiBpbmRleC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBzZXRB\nbGlhcyhpbnQgaWR4LCBPYmplY3QgYWxpYXMpIHsKICAgICAgICAgICAgT2Jq\nZWN0IGlkID0gX2lkcy5nZXQoaWR4KTsKICAgICAgICAgICAgX2FsaWFzZXMu\ncHV0KGlkLCBhbGlhcyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBJbnNlcnQgYW4gYWxpYXMgYmVmb3JlIHRoZSBnaXZlbiBpbmRleCwg\ndXNpbmcgbmVnYXRpdmUgaW5kZXhlcwogICAgICAgICAqIHRvIGNvdW50IGJh\nY2t3YXJkcy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBpbnNl\ncnRBbGlhcyhpbnQgaWR4LCBPYmplY3QgaWQsIE9iamVjdCBhbGlhcykgewog\nICAgICAgICAgICBfYWxpYXNlcy5wdXQoaWQsIGFsaWFzKTsKICAgICAgICAg\nICAgaWYgKGlkeCA+PSAwKQogICAgICAgICAgICAgICAgX2lkcy5hZGQoaWR4\nLCBpZCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9pZHMu\nYWRkKF9pZHMuc2l6ZSgpICsgaWR4LCBpZCk7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGluZGV4IG9mIHRoZSBnaXZl\nbiBhbGlhcy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgaW50IGluZGV4\nT2ZBbGlhcyhPYmplY3QgYWxpYXMpIHsKICAgICAgICAgICAgaWYgKF9hbGlh\nc2VzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2lkcy5zaXplKCk7IGkrKykK\nICAgICAgICAgICAgICAgIGlmIChhbGlhcy5lcXVhbHMoX2FsaWFzZXMuZ2V0\nKF9pZHMuZ2V0KGkpKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7\nCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIEEgbGlzdCByZXByZXNlbnRhdGlvbiBvZiB0aGUgYWxp\nYXNlcywgaW4gc2VsZWN0IG9yZGVyLCB3aXRoCiAgICAgICAgICogQVMgYWxp\nYXNlcyBwcmVzZW50LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBMaXN0\nIGdldEFsaWFzZXMoZmluYWwgYm9vbGVhbiBpZGVudCwgZmluYWwgYm9vbGVh\nbiBpbm5lcikgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7Cgog\nICAgICAgICAgICByZXR1cm4gbmV3IEFic3RyYWN0TGlzdCgpIHsKICAgICAg\nICAgICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKGlkZW50ICYmIF9pZGVudHMgIT0gbnVsbCkgPyBfaWRl\nbnRzLnNpemUoKQogICAgICAgICAgICAgICAgICAgICAgICA6IF9pZHMuc2l6\nZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0KGludCBpKSB7CiAgICAgICAgICAgICAgICAgICAgT2Jq\nZWN0IGlkID0gKGlkZW50ICYmIF9pZGVudHMgIT0gbnVsbCkgPyBfaWRlbnRz\nLmdldChpKQogICAgICAgICAgICAgICAgICAgICAgICA6IF9pZHMuZ2V0KGkp\nOwogICAgICAgICAgICAgICAgICAgIE9iamVjdCBhbGlhcyA9IF9hbGlhc2Vz\nLmdldChpZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkIGluc3RhbmNl\nb2YgQ29sdW1uICYmICgoQ29sdW1uKSBpZCkuaXNYTUwoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgYWxpYXMgPSBhbGlhcyArIF9kaWN0LmdldFN0cmlu\nZ1ZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nIGFzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBp\nZiAoaW5uZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGFzID0gKChTdHJp\nbmcpIGFsaWFzKS5yZXBsYWNlKCcuJywgJ18nKTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlIGlmIChfc2VsZWN0QXMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgYXMgPSAoU3RyaW5nKSBfc2VsZWN0QXMuZ2V0KGlkKTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpZCBpbnN0YW5jZW9mIFZh\nbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBhcyA9ICgoVmFsdWUpIGlk\nKS5nZXRBbGlhcygpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoYXMgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnQgJiYg\nX2lkZW50cyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGFzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxpYXMg\naW5zdGFuY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBhbGlhcyA9IG5ldyBTUUxCdWZmZXIoKFNRTEJ1ZmZlcikgYWxpYXMp\nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZCgiIEFT\nICIpLmFwcGVuZChhcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWFzID0gYWxpYXMgKyAi\nIEFTICIgKyBhczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nU2V0IHRoYXQgYSBnaXZlbiBpZCdzIGFsaWFzIGhhcyBhbiBBUyB2YWx1ZS4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBzZXRTZWxlY3RBcyhP\nYmplY3QgaWQsIFN0cmluZyBhcykgewogICAgICAgICAgICBpZiAoX3NlbGVj\ndEFzID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2VsZWN0QXMgPSBuZXcg\nSGFzaE1hcCgoaW50KSAoNSAqIDEuMzMgKyAxKSk7CiAgICAgICAgICAgIF9z\nZWxlY3RBcy5wdXQoaWQsIGFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIENsZWFyIGFsbCBwbGFjZWhvbGRlcnMgYW5kIHNlbGVjdCBB\nUyBjbGF1c2VzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGNs\nZWFyUGxhY2Vob2xkZXJzKCkgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgT2Jq\nZWN0IGlkOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9pZHMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIGlkID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChpZCBpbnN0\nYW5jZW9mIFBsYWNlaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgaXRy\nLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIF9hbGlhc2VzLnJlbW92\nZShpZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE9iamVjdCBp\nZCkgewogICAgICAgICAgICByZXR1cm4gX2FsaWFzZXMgIT0gbnVsbCAmJiBf\nYWxpYXNlcy5jb250YWluc0tleShpZCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgT2JqZWN0IGdldChpbnQgaSkgewogICAgICAgICAgICBpZiAoX2lk\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5k\nZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbigpOwogICAgICAgICAgICByZXR1cm4g\nX2lkcy5nZXQoaSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNp\nemUoKSB7CiAgICAgICAgICAgIHJldHVybiAoX2lkcyA9PSBudWxsKSA/IDAg\nOiBfaWRzLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIGNsZWFyKCkgewogICAgICAgICAgICBfaWRzID0gbnVsbDsKICAgICAgICAg\nICAgX2FsaWFzZXMgPSBudWxsOwogICAgICAgICAgICBfc2VsZWN0QXMgPSBu\ndWxsOwogICAgICAgICAgICBfaWRlbnRzID0gbnVsbDsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIEpvaW5zIHNldENvcnJlbGF0ZWRWYXJpYWJsZShT\ndHJpbmcgdmFyKSB7CiAgICAgICAgaWYgKHZhciA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpv\naW5zKHRoaXMpLnNldENvcnJlbGF0ZWRWYXJpYWJsZSh2YXIpOwogICAgfQog\nICAgCiAgICBwdWJsaWMgSm9pbnMgc2V0Sm9pbkNvbnRleHQoQ29udGV4dCBj\ndHgpIHsKICAgICAgICBpZiAoY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhp\ncykuc2V0Sm9pbkNvbnRleHQoY3R4KTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldENvcnJlbGF0ZWRWYXJpYWJsZSgpIHsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBtb3ZlSm9pbnNUb1BhcmVu\ndCgpIHsKICAgIH0KfQoKLyoqCiAqIENvbW1vbiBqb2lucyBpbnRlcmZhY2Ug\ndXNlZCBpbnRlcm5hbGx5LiBDYW5ub3QgYmUgbWFkZSBhbiBpbm5lciBjbGFz\ncwogKiBiZWNhdXNlIHRoZSBvdXRlciBjbGFzcyAoU2VsZWN0KSBoYXMgdG8g\naW1wbGVtZW50IGl0LgogKi8KaW50ZXJmYWNlIFBhdGhKb2lucwogICAgZXh0\nZW5kcyBKb2lucyB7CgogICAgLyoqCiAgICAgKiBNYXJrIHRoaXMgYXMgYW4g\nb3V0ZXIgam9pbnMgc2V0LgogICAgICovCiAgICBwdWJsaWMgUGF0aEpvaW5z\nIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpOwoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRydWUgaWYgdGhpcyBpbnN0YW5jZSBoYXMgYSBwYXRoLCBhbnkgam9p\nbnMsIG9yIGEgdmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzRGlydHkoKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVsYXRp\nb24gcGF0aCB0cmF2ZXJzZWQgYnkgdGhlc2Ugam9pbnMsIG9yIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRoKCk7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNldCBvZiB7QGxpbmsgSm9p\nbn0gZWxlbWVudHMsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVi\nbGljIEpvaW5TZXQgam9pbnMoKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbWF4aW11bSBudW1iZXIgb2Ygam9pbnMgY29udGFpbmVkIGluIHRoaXMg\naW5zdGFuY2UgYXQgYW55CiAgICAgKiB0aW1lLgogICAgICovCiAgICBwdWJs\naWMgaW50IGpvaW5Db3VudCgpOwoKICAgIC8qKgogICAgICogTnVsbCB0aGUg\nc2V0IG9mIHtAbGluayBKb2lufSBlbGVtZW50cy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgbnVsbEpvaW5zKCk7CgogICAgLyoqCiAgICAgKiBUaGUgc2Vs\nZWN0IG93bmVyIG9mIHRoaXMgam9pbgogICAgICogQHJldHVybgogICAgICov\nCiAgICBwdWJsaWMgU2VsZWN0IGdldFNlbGVjdCgpOwp9Cgo=\n","encoding":"base64"}

