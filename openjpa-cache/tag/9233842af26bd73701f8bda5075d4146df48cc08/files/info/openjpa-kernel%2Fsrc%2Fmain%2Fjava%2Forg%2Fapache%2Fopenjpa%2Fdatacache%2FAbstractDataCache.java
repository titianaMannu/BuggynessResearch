{"sha":"e91294c526dd7f84a2eb36d2885579b233790f93","node_id":"MDQ6QmxvYjIwNjM2NDplOTEyOTRjNTI2ZGQ3Zjg0YTJlYjM2ZDI4ODU1NzliMjMzNzkwZjkz","size":15362,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e91294c526dd7f84a2eb36d2885579b233790f93","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlz\nOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5D\nb2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5ldmVudC5SZW1vdGVDb21taXRFdmVudDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5ldmVudC5SZW1vdGVDb21taXRMaXN0ZW5lcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmFi\nbGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxv\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3Vy\ncmVudC5BYnN0cmFjdENvbmN1cnJlbnRFdmVudE1hbmFnZXI7CgppbXBvcnQg\nc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQWJzdHJhY3Qge0BsaW5rIERh\ndGFDYWNoZX0gaW1wbGVtZW50YXRpb24gdGhhdCBwcm92aWRlcyB2YXJpb3Vz\nCiAqIHN0YXRpc3RpY3MsIGxvZ2dpbmcsIGFuZCB0aW1lb3V0IGZ1bmN0aW9u\nYWxpdHkgY29tbW9uIGFjcm9zcyBjYWNoZQogKiBpbXBsZW1lbnRhdGlvbnMu\nCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBhdXRob3IgQWJl\nIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3REYXRh\nQ2FjaGUKICAgIGV4dGVuZHMgQWJzdHJhY3RDb25jdXJyZW50RXZlbnRNYW5h\nZ2VyCiAgICBpbXBsZW1lbnRzIERhdGFDYWNoZSwgQ29uZmlndXJhYmxlIHsK\nCQogICAgcHJvdGVjdGVkIENhY2hlU3RhdGlzdGljcy5EZWZhdWx0IHN0YXRz\nID0gbmV3IENhY2hlU3RhdGlzdGljcy5EZWZhdWx0KCk7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgQml0U2V0IEVNUFRZX0JJVFNFVCA9IG5ldyBCaXRT\nZXQoMCk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIHNf\nbG9jID0KICAgICAgICBMb2NhbGl6ZXIuZm9yUGFja2FnZShBYnN0cmFjdERh\ndGFDYWNoZS5jbGFzcyk7CiAgICAKCiAgICAvKioKICAgICAqIFRoZSBjb25m\naWd1cmF0aW9uIHNldCBieSB0aGUgc3lzdGVtLgogICAgICovCiAgICBwcm90\nZWN0ZWQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZjsKCiAgICAvKioKICAg\nICAqIFRoZSBsb2cgdG8gdXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgTG9n\nIGxvZzsKCiAgICBwcml2YXRlIFN0cmluZyBfbmFtZSA9IG51bGw7CiAgICBw\ncml2YXRlIGJvb2xlYW4gX2Nsb3NlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBT\ndHJpbmcgX3NjaGVkdWxlID0gbnVsbDsKICAgIAogICAgcHJvdGVjdGVkIFNl\ndDxTdHJpbmc+IF9pbmNsdWRlZFR5cGVzOwogICAgcHJvdGVjdGVkIFNldDxT\ndHJpbmc+IF9leGNsdWRlZFR5cGVzOwoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nTmFtZSgpIHsKICAgICAgICByZXR1cm4gX25hbWU7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0TmFtZShTdHJpbmcgbmFtZSkgewogICAgICAgIF9uYW1l\nID0gbmFtZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldEV2aWN0aW9u\nU2NoZWR1bGUoKSB7CiAgICAgICAgcmV0dXJuIF9zY2hlZHVsZTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRFdmljdGlvblNjaGVkdWxlKFN0cmluZyBz\nKSB7CiAgICAgICAgX3NjaGVkdWxlID0gczsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBpbml0aWFsaXplKERhdGFDYWNoZU1hbmFnZXIgbWFuYWdlcikgewog\nICAgICAgIGlmIChfc2NoZWR1bGUgIT0gbnVsbCAmJiAhIiIuZXF1YWxzKF9z\nY2hlZHVsZSkpIHsKICAgICAgICAgICAgRGF0YUNhY2hlU2NoZWR1bGVyIHNj\naGVkdWxlciA9IG1hbmFnZXIuZ2V0RGF0YUNhY2hlU2NoZWR1bGVyKCk7CiAg\nICAgICAgICAgIGlmIChzY2hlZHVsZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHNjaGVkdWxlci5zY2hlZHVsZUV2aWN0aW9uKHRoaXMsIF9zY2hlZHVs\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1pdChD\nb2xsZWN0aW9uIGFkZGl0aW9ucywgQ29sbGVjdGlvbiBuZXdVcGRhdGVzLAog\nICAgICAgIENvbGxlY3Rpb24gZXhpc3RpbmdVcGRhdGVzLCBDb2xsZWN0aW9u\nIGRlbGV0ZXMpIHsKICAgICAgICAvLyByZW1vdmUgYWxsIG9iamVjdHMgaW4g\nZGVsZXRlcyBsaXN0CiAgICAgICAgcmVtb3ZlQWxsSW50ZXJuYWwoZGVsZXRl\ncyk7CgogICAgICAgIC8vIG5leHQsIGFkZCBhbGwgdGhlIG5ldyBhZGRpdGlv\nbnMKICAgICAgICBwdXRBbGxJbnRlcm5hbChhZGRpdGlvbnMpOwogICAgICAg\nIHB1dEFsbEludGVybmFsKG5ld1VwZGF0ZXMpOwoKICAgICAgICAvLyBwb3Nz\naWJseSBhZGQgdGhlIGV4aXN0aW5nIHVwZGF0ZXMsIGRlcGVuZGluZyBvbiB0\naGUKICAgICAgICAvLyBzZW1hbnRpY3Mgb2YgdGhlIGNhY2hlLCBhcyBkaWN0\nYXRlZCBieSByZWNhY2hlVXBkYXRlcygpCiAgICAgICAgaWYgKHJlY2FjaGVV\ncGRhdGVzKCkpCiAgICAgICAgICAgIHB1dEFsbEludGVybmFsKGV4aXN0aW5n\nVXBkYXRlcyk7CgogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkg\newogICAgICAgICAgICBDb2xsZWN0aW9uPE9iamVjdD4gYWRkSWRzID0gbmV3\nIEFycmF5TGlzdDxPYmplY3Q+KGFkZGl0aW9ucy5zaXplKCkpOwogICAgICAg\nICAgICBDb2xsZWN0aW9uPE9iamVjdD4gdXBJZHMgPSBuZXcgQXJyYXlMaXN0\nPE9iamVjdD4obmV3VXBkYXRlcy5zaXplKCkpOwogICAgICAgICAgICBDb2xs\nZWN0aW9uPE9iamVjdD4gZXhJZHMgPSBuZXcgQXJyYXlMaXN0PE9iamVjdD4o\nZXhpc3RpbmdVcGRhdGVzLnNpemUoKSk7CgogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ZXIgPSBhZGRpdGlvbnMuaXRlcmF0b3IoKTsgaXRlci5oYXNO\nZXh0KCk7KQogICAgICAgICAgICAgICAgYWRkSWRzLmFkZCgoKERhdGFDYWNo\nZVBDRGF0YSkgaXRlci5uZXh0KCkpLmdldElkKCkpOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ZXIgPSBuZXdVcGRhdGVzLml0ZXJhdG9yKCk7IGl0\nZXIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgIHVwSWRzLmFkZCgoKERh\ndGFDYWNoZVBDRGF0YSkgaXRlci5uZXh0KCkpLmdldElkKCkpOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBleGlzdGluZ1VwZGF0ZXMuaXRl\ncmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgZXhJ\nZHMuYWRkKCgoRGF0YUNhY2hlUENEYXRhKSBpdGVyLm5leHQoKSkuZ2V0SWQo\nKSk7CgogICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1j\nb21taXQiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhZGRJZHMs\nIHVwSWRzLCBleElkcywgZGVsZXRlcyB9KSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE9iamVjdCBrZXkpIHsKICAg\nICAgICBEYXRhQ2FjaGVQQ0RhdGEgbyA9IGdldEludGVybmFsKGtleSk7CiAg\nICAgICAgc3RhdHMubmV3R2V0KG8gPT0gbnVsbCA/IG51bGwgOiBvLmdldFR5\ncGUoKSwgbyAhPSBudWxsKTsKICAgICAgICBpZiAobyAhPSBudWxsICYmIG8u\naXNUaW1lZE91dCgpKSB7CiAgICAgICAgICAgIG8gPSBudWxsOwogICAgICAg\nICAgICByZW1vdmVJbnRlcm5hbChrZXkpOwogICAgICAgICAgICBpZiAobG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nc19sb2MuZ2V0KCJjYWNoZS10aW1lb3V0Iiwga2V5KSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBvICE9IG51bGw7CiAgICB9CgogICAgcHVibGljIEJp\ndFNldCBjb250YWluc0FsbChDb2xsZWN0aW9uIGtleXMpIHsKICAgICAgICBp\nZiAoa2V5cy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9C\nSVRTRVQ7CgogICAgICAgIEJpdFNldCBzZXQgPSBuZXcgQml0U2V0KGtleXMu\nc2l6ZSgpKTsKICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVy\nYXRvciBpdGVyID0ga2V5cy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsg\naSsrKQogICAgICAgICAgICBpZiAoY29udGFpbnMoaXRlci5uZXh0KCkpKQog\nICAgICAgICAgICAgICAgc2V0LnNldChpKTsKICAgICAgICByZXR1cm4gc2V0\nOwogICAgfQoKICAgIHB1YmxpYyBEYXRhQ2FjaGVQQ0RhdGEgZ2V0KE9iamVj\ndCBrZXkpIHsKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgbyA9IGdldEludGVy\nbmFsKGtleSk7CiAgICAgICAgaWYgKG8gIT0gbnVsbCAmJiBvLmlzVGltZWRP\ndXQoKSkgewogICAgICAgICAgICBvID0gbnVsbDsKICAgICAgICAgICAgcmVt\nb3ZlSW50ZXJuYWwoa2V5KTsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdl\ndCgiY2FjaGUtdGltZW91dCIsIGtleSkpOwogICAgICAgIH0KICAgICAgICBp\nZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgaWYgKG8g\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQo\nImNhY2hlLW1pc3MiLCBrZXkpKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtaGl0Iiwga2V5\nKSk7CiAgICAgICAgfQogICAgICAgIHN0YXRzLm5ld0dldCgobyA9PSBudWxs\nKSA/IG51bGwgOiBvLmdldFR5cGUoKSwgbyAhPSBudWxsKTsKICAgICAgICBy\nZXR1cm4gbzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBv\nYmplY3RzIGZvciB0aGUgZ2l2ZW4ga2V5IExpc3QuCiAgICAgKi8KICAgIHB1\nYmxpYyBNYXAgZ2V0QWxsKExpc3Qga2V5cykgewogICAgICAgIE1hcCByZXN1\nbHRNYXAgPSBuZXcgSGFzaE1hcChrZXlzLnNpemUoKSk7CiAgICAgICAgZm9y\nKE9iamVjdCBrZXkgOiBrZXlzKQogICAgICAgICAgICByZXN1bHRNYXAucHV0\nKGtleSwgZ2V0KGtleSkpOwogICAgICAgIHJldHVybiByZXN1bHRNYXA7CiAg\nICB9CgogICAgcHVibGljIERhdGFDYWNoZVBDRGF0YSBwdXQoRGF0YUNhY2hl\nUENEYXRhIGRhdGEpIHsKICAgICAgICBzdGF0cy5uZXdQdXQoZGF0YS5nZXRU\neXBlKCkpOwogICAgICAgIERhdGFDYWNoZVBDRGF0YSBvID0gcHV0SW50ZXJu\nYWwoZGF0YS5nZXRJZCgpLCBkYXRhKTsKICAgICAgICBpZiAobG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQo\nImNhY2hlLXB1dCIsIGRhdGEuZ2V0SWQoKSkpOwogICAgICAgIHJldHVybiAo\nbyA9PSBudWxsIHx8IG8uaXNUaW1lZE91dCgpKSA/IG51bGwgOiBvOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZShEYXRhQ2FjaGVQQ0RhdGEgZGF0\nYSkgewogICAgICAgIGlmIChyZWNhY2hlVXBkYXRlcygpKSB7CiAgICAgICAg\nICAgIHN0YXRzLm5ld1B1dChkYXRhLmdldFR5cGUoKSk7CiAgICAgICAgICAg\nIHB1dEludGVybmFsKGRhdGEuZ2V0SWQoKSwgZGF0YSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBEYXRhQ2FjaGVQQ0RhdGEgcmVtb3ZlKE9iamVj\ndCBrZXkpIHsKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgbyA9IHJlbW92ZUlu\ndGVybmFsKGtleSk7CiAgICAgICAgaWYgKG8gIT0gbnVsbCAmJiBvLmlzVGlt\nZWRPdXQoKSkKICAgICAgICAgICAgbyA9IG51bGw7CiAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGlmIChvID09IG51\nbGwpCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNo\nZS1yZW1vdmUtbWlzcyIsIGtleSkpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1yZW1vdmUt\naGl0Iiwga2V5KSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvOwogICAg\nfQoKICAgIHB1YmxpYyBCaXRTZXQgcmVtb3ZlQWxsKENvbGxlY3Rpb24ga2V5\ncykgewogICAgICAgIGlmIChrZXlzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuIEVNUFRZX0JJVFNFVDsKCiAgICAgICAgQml0U2V0IHNldCA9IG5l\ndyBCaXRTZXQoa2V5cy5zaXplKCkpOwogICAgICAgIGludCBpID0gMDsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBrZXlzLml0ZXJhdG9yKCk7IGl0\nZXIuaGFzTmV4dCgpOyBpKyspCiAgICAgICAgICAgIGlmIChyZW1vdmUoaXRl\nci5uZXh0KCkpICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXQuc2V0KGkp\nOwogICAgICAgIHJldHVybiBzZXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgdGhlIG9iamVjdHMgb2YgdGhlIGdpdmVuIGNsYXNzIGZyb20gdGhl\nIGNhY2hlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZW1vdmVBbGwoQ2xh\nc3MgY2xzLCBib29sZWFuIHN1YkNsYXNzZXMpIHsKICAgICAgICByZW1vdmVB\nbGxJbnRlcm5hbChjbHMsIHN1YkNsYXNzZXMpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIHBpbihPYmplY3Qga2V5KSB7CiAgICAgICAgYm9vbGVhbiBi\nb29sID0gcGluSW50ZXJuYWwoa2V5KTsKICAgICAgICBpZiAobG9nLmlzVHJh\nY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgaWYgKGJvb2wpCiAgICAgICAg\nICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1waW4taGl0Iiwg\na2V5KSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShzX2xvYy5nZXQoImNhY2hlLXBpbi1taXNzIiwga2V5KSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBib29sOwogICAgfQoKICAgIHB1YmxpYyBC\naXRTZXQgcGluQWxsKENvbGxlY3Rpb24ga2V5cykgewogICAgICAgIGlmIChr\nZXlzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0JJVFNF\nVDsKCiAgICAgICAgQml0U2V0IHNldCA9IG5ldyBCaXRTZXQoa2V5cy5zaXpl\nKCkpOwogICAgICAgIGludCBpID0gMDsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ZXIgPSBrZXlzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyBpKysp\nCiAgICAgICAgICAgIGlmIChwaW4oaXRlci5uZXh0KCkpKQogICAgICAgICAg\nICAgICAgc2V0LnNldChpKTsKICAgICAgICByZXR1cm4gc2V0OwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHBpbkFsbChDbGFzczw/PiBjbHMsIGJvb2xlYW4g\nc3VicykgewogICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICBsb2cud2FybihzX2xvYy5nZXQoImNhY2hlLWNsYXNzLXBpbiIs\nIGdldE5hbWUoKSkpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHVucGlu\nKE9iamVjdCBrZXkpIHsKICAgICAgICBib29sZWFuIGJvb2wgPSB1bnBpbklu\ndGVybmFsKGtleSk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgIGlmIChib29sKQogICAgICAgICAgICAgICAgbG9n\nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtdW5waW4taGl0Iiwga2V5KSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xv\nYy5nZXQoImNhY2hlLXVucGluLW1pc3MiLCBrZXkpKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGJvb2w7CiAgICB9CgogICAgcHVibGljIEJpdFNldCB1\nbnBpbkFsbChDb2xsZWN0aW9uIGtleXMpIHsKICAgICAgICBpZiAoa2V5cy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9CSVRTRVQ7Cgog\nICAgICAgIEJpdFNldCBzZXQgPSBuZXcgQml0U2V0KGtleXMuc2l6ZSgpKTsK\nICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdGVy\nID0ga2V5cy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgaSsrKQogICAg\nICAgICAgICBpZiAodW5waW4oaXRlci5uZXh0KCkpKQogICAgICAgICAgICAg\nICAgc2V0LnNldChpKTsKICAgICAgICByZXR1cm4gc2V0OwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHVucGluQWxsKENsYXNzPD8+IGNscywgYm9vbGVhbiBz\ndWJzKSB7CiAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAg\nICAgICAgIGxvZy53YXJuKHNfbG9jLmdldCgiY2FjaGUtY2xhc3MtdW5waW4i\nLCBnZXROYW1lKCkpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhcigp\nIHsKICAgICAgICBjbGVhckludGVybmFsKCk7CiAgICAgICAgaWYgKGxvZy5p\nc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2Uoc19sb2Mu\nZ2V0KCJjYWNoZS1jbGVhciIsIGdldE5hbWUoKSkpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGNsb3NlKHRydWUpOwogICAg\nfQoKICAgIHByb3RlY3RlZCB2b2lkIGNsb3NlKGJvb2xlYW4gY2xlYXIpIHsK\nICAgICAgICBpZiAoIV9jbG9zZWQpIHsKICAgICAgICAgICAgaWYgKGNsZWFy\nKQogICAgICAgICAgICAgICAgY2xlYXJJbnRlcm5hbCgpOwogICAgICAgICAg\nICBfY2xvc2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIF9jbG9zZWQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgYWRkRXhwaXJhdGlvbkxpc3RlbmVy\nKEV4cGlyYXRpb25MaXN0ZW5lciBsaXN0ZW4pIHsKICAgICAgICBhZGRMaXN0\nZW5lcihsaXN0ZW4pOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlbW92\nZUV4cGlyYXRpb25MaXN0ZW5lcihFeHBpcmF0aW9uTGlzdGVuZXIgbGlzdGVu\nKSB7CiAgICAgICAgcmV0dXJuIHJlbW92ZUxpc3RlbmVyKGxpc3Rlbik7CiAg\nICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBy\nZXR1cm4gIlsiICsgc3VwZXIudG9TdHJpbmcoKSArICI6IiArIF9uYW1lICsg\nIl0iOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgcGFy\ndCBvZiB0aGUge0BsaW5rIFJlbW90ZUNvbW1pdExpc3RlbmVyfSBpbnRlcmZh\nY2UuIElmCiAgICAgKiB5b3VyIGNhY2hlIHN1YmNsYXNzIHJlbGllcyBvbiBP\ncGVuSlBBIGZvciBjbHVzdGVyaW5nIHN1cHBvcnQsIG1ha2UgaXQKICAgICAq\nIGltcGxlbWVudCA8Y29kZT5SZW1vdGVDb21taXRMaXN0ZW5lcjwvY29kZT4u\nIFRoaXMgbWV0aG9kIHdpbGwgdGFrZQogICAgICogY2FyZSBvZiBpbnZhbGlk\nYXRpbmcgZW50cmllcyBmcm9tIHJlbW90ZSBjb21taXRzLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBhZnRlckNvbW1pdChSZW1vdGVDb21taXRFdmVudCBl\ndmVudCkgewogICAgICAgIGlmIChfY2xvc2VkKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGlmIChldmVudC5nZXRQYXlsb2FkVHlwZSgpID09IFJl\nbW90ZUNvbW1pdEV2ZW50LlBBWUxPQURfRVhURU5UUykgewogICAgICAgICAg\nICByZW1vdmVBbGxUeXBlTmFtZXNJbnRlcm5hbChldmVudC5nZXRVcGRhdGVk\nVHlwZU5hbWVzKCkpOwogICAgICAgICAgICByZW1vdmVBbGxUeXBlTmFtZXNJ\nbnRlcm5hbChldmVudC5nZXREZWxldGVkVHlwZU5hbWVzKCkpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGRyb3AgYWxsIHRoZSBjb21taXR0\nZWQgT0lEcywgZXhjZXB0aW5nIGJyYW5kCiAgICAgICAgICAgIC8vIG5ldyBP\nSURzLiBicmFuZCBuZXcgT0lEcyBlaXRoZXIgd29uJ3QgYmUgaW4KICAgICAg\nICAgICAgLy8gdGhlIGNhY2hlLCBvciBpZiB0aGV5IGFyZSwgd2lsbCBiZSBt\nb3JlIHVwIHRvIGRhdGUKICAgICAgICAgICAgcmVtb3ZlQWxsSW50ZXJuYWwo\nZXZlbnQuZ2V0VXBkYXRlZE9iamVjdElkcygpKTsKICAgICAgICAgICAgcmVt\nb3ZlQWxsSW50ZXJuYWwoZXZlbnQuZ2V0RGVsZXRlZE9iamVjdElkcygpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2Ugd2hlbiBh\nIGtleSBpcyByZW1vdmVkIGZyb20gdGhpcyBjYWNoZS4gUHJvcGFnYXRlcyB0\naGUKICAgICAqIGV4cGlyYXRpb24gZXZlbnQgb24gdG8gYWxsIGV4cGlyYXRp\nb24gbGlzdGVuZXJzIHJlZ2lzdGVyZWQKICAgICAqIHdpdGggdGhpcyBjbGFz\ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQga2V5UmVtb3ZlZChPYmpl\nY3Qga2V5LCBib29sZWFuIGV4cGlyZWQpIHsKICAgICAgICAvLyBOb3RpZnkg\nYW55IGV4cGlyYXRpb24gbGlzdGVuZXJzIG9mIHRoZSBleHBpcmF0aW9uLgog\nICAgICAgIGlmIChoYXNMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgZmlyZUV2\nZW50KG5ldyBFeHBpcmF0aW9uRXZlbnQodGhpcywga2V5LCBleHBpcmVkKSk7\nCgogICAgICAgIGlmIChleHBpcmVkICYmIGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1leHBp\ncmVkIiwga2V5KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gPGNv\nZGU+dHJ1ZTwvY29kZT4gaWYgdXBkYXRlcyB0byBkYXRhIGFscmVhZHkgaW4g\ndGhlCiAgICAgKiBjYWNoZSAoZWl0aGVyIGluIHtAbGluayAjY29tbWl0fSBv\nciB0aGUge0BsaW5rICN1cGRhdGV9KQogICAgICogc2hvdWxkIGJlIHB1dCBi\nYWNrIGludG8gdGhlIGNhY2hlLiBSZXR1cm5zIGZhbHNlIGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHJlY2FjaGVVcGRhdGVz\nKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gb2lkLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRGF0YUNhY2hlUENEYXRhIGdl\ndEludGVybmFsKE9iamVjdCBvaWQpOwoKICAgIC8qKgogICAgICogQWRkIHRo\nZSBnaXZlbiBvYmplY3QgdG8gdGhlIGNhY2hlLCByZXR1cm5pbmcgdGhlIG9s\nZCBvYmplY3QgdW5kZXIgdGhlCiAgICAgKiBnaXZlbiBvaWQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBhYnN0cmFjdCBEYXRhQ2FjaGVQQ0RhdGEgcHV0SW50\nZXJuYWwoT2JqZWN0IG9pZCwKICAgICAgICAgICAgRGF0YUNhY2hlUENEYXRh\nIHBjKTsKICAgIAogICAgLyoqCiAgICAgKiBBZGQgYWxsIG9mIHRoZSBnaXZl\nbiBvYmplY3RzIHRvIHRoZSBjYWNoZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgcHV0QWxsSW50ZXJuYWwoQ29sbGVjdGlvbiBwY3MpIHsKICAgICAg\nICBEYXRhQ2FjaGVQQ0RhdGEgcGM7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndGVyID0gcGNzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBwYyA9IChEYXRhQ2FjaGVQQ0RhdGEpIGl0ZXIubmV4dCgpOwog\nICAgICAgICAgICBzdGF0cy5uZXdQdXQocGMuZ2V0VHlwZSgpKTsKICAgICAg\nICAgICAgcHV0SW50ZXJuYWwocGMuZ2V0SWQoKSwgcGMpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgb2JqZWN0IHVuZGVy\nIHRoZSBnaXZlbiBvaWQgZnJvbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBEYXRhQ2FjaGVQQ0RhdGEgcmVtb3ZlSW50ZXJu\nYWwoT2JqZWN0IG9pZCk7CgogICAgLyoqCiAgICAgKiBFdmljdCBvYmplY3Rz\nIGluIGNhY2hlIGJ5IGNsYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3Qgdm9pZCByZW1vdmVBbGxJbnRlcm5hbChDbGFzczw/PiBjbHMsIGJv\nb2xlYW4gc3ViY2xhc3Nlcyk7CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYWxs\nIG9iamVjdHMgdW5kZXIgdGhlIGdpdmVuIG9pZHMgZnJvbSB0aGUgY2FjaGUu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlbW92ZUFsbEludGVybmFs\nKENvbGxlY3Rpb24gb2lkcykgewogICAgICAgIGZvciAoSXRlcmF0b3IgaXRl\nciA9IG9pZHMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KQogICAgICAg\nICAgICByZW1vdmVJbnRlcm5hbChpdGVyLm5leHQoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZW1vdmUgYWxsIG9iamVjdHMgb2YgdGhlIGdpdmVuIGNs\nYXNzIG5hbWVzIGZyb20gdGhlIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCByZW1vdmVBbGxUeXBlTmFtZXNJbnRlcm5hbChDb2xsZWN0aW9u\nIGNsYXNzTmFtZXMpIHsKICAgICAgICBDb2xsZWN0aW9uIGNsYXNzZXMgPSBD\nYWNoZXMuYWRkVHlwZXNCeU5hbWUoY29uZiwgY2xhc3NOYW1lcywgbnVsbCk7\nCiAgICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdGVyID0gY2xhc3Nlcy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgY2xzID0gKENsYXNzKSBpdGVyLm5leHQoKTsKICAg\nICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcmVtb3ZlY2xhc3Mi\nLCBjbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHJlbW92ZUFsbEludGVy\nbmFsKGNscywgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENsZWFyIHRoZSBjYWNoZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFi\nc3RyYWN0IHZvaWQgY2xlYXJJbnRlcm5hbCgpOwoKICAgIC8qKgogICAgICog\nUGluIGFuIG9iamVjdCB0byB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBhYnN0cmFjdCBib29sZWFuIHBpbkludGVybmFsKE9iamVjdCBvaWQp\nOwoKICAgIC8qKgogICAgICogVW5waW4gYW4gb2JqZWN0IGZyb20gdGhlIGNh\nY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgYm9vbGVhbiB1\nbnBpbkludGVybmFsKE9iamVjdCBvaWQpOwogICAgCiAgICBwdWJsaWMgQ2Fj\naGVTdGF0aXN0aWNzIGdldFN0YXRpc3RpY3MoKSB7CiAgICAJcmV0dXJuIHN0\nYXRzOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0gQ29uZmlndXJhYmxlIGlt\ncGxlbWVudGF0aW9uIC0tLS0tLS0tLS0KCiAgICBwdWJsaWMgdm9pZCBzZXRD\nb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIHRo\naXMuY29uZiA9IChPcGVuSlBBQ29uZmlndXJhdGlvbikgY29uZjsKICAgICAg\nICB0aGlzLmxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9u\nLkxPR19EQVRBQ0FDSEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0\nQ29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgIGlmIChfbmFtZSA9PSBudWxsKQog\nICAgICAgICAgICBzZXROYW1lKE5BTUVfREVGQVVMVCk7CiAgICB9CgogICAg\nLy8gLS0tLS0tLS0tLSBBYnN0cmFjdEV2ZW50TWFuYWdlciBpbXBsZW1lbnRh\ndGlvbiAtLS0tLS0tLS0tCgogICAgcHJvdGVjdGVkIHZvaWQgZmlyZUV2ZW50\nKE9iamVjdCBldmVudCwgT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgRXhw\naXJhdGlvbkxpc3RlbmVyIGxpc3RlbiA9IChFeHBpcmF0aW9uTGlzdGVuZXIp\nIGxpc3RlbmVyOwogICAgICAgIEV4cGlyYXRpb25FdmVudCBldiA9IChFeHBp\ncmF0aW9uRXZlbnQpIGV2ZW50OwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGxpc3Rlbi5vbkV4cGlyZShldik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBsb2cud2FybihzX2xvYy5nZXQoImV4cC1saXN0\nZW5lci1leCIpLCBlKTsKCQl9Cgl9CiAgICAKICAgIHB1YmxpYyBTZXQ8U3Ry\naW5nPiBnZXRUeXBlcygpIHsKICAgICAgICByZXR1cm4gX2luY2x1ZGVkVHlw\nZXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTZXQ8U3RyaW5nPiBnZXRFeGNs\ndWRlZFR5cGVzKCkgewogICAgICAgIHJldHVybiBfZXhjbHVkZWRUeXBlczsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlcyhTZXQ8U3RyaW5nPiB0\neXBlcykgewogICAgICAgIF9pbmNsdWRlZFR5cGVzID0gdHlwZXM7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0VHlwZXMoU3RyaW5nIHR5cGVzKSB7CiAg\nICAgICAgX2luY2x1ZGVkVHlwZXMgPQogICAgICAgICAgICBTdHJpbmdVdGls\ncy5pc0VtcHR5KHR5cGVzKSA/IG51bGwgOiBuZXcgSGFzaFNldDxTdHJpbmc+\nKEFycmF5cwogICAgICAgICAgICAgICAgLmFzTGlzdChTdHJpbmdzLnNwbGl0\nKHR5cGVzLCAiOyIsIDApKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRXhjbHVkZWRUeXBlcyhTZXQ8U3RyaW5nPiB0eXBlcykgewogICAgICAgIF9l\neGNsdWRlZFR5cGVzID0gdHlwZXM7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0RXhjbHVkZWRUeXBlcyhTdHJpbmcgdHlwZXMpIHsKICAgICAgICBfZXhj\nbHVkZWRUeXBlcyA9CiAgICAgICAgICAgIFN0cmluZ1V0aWxzLmlzRW1wdHko\ndHlwZXMpID8gbnVsbCA6IG5ldyBIYXNoU2V0PFN0cmluZz4oQXJyYXlzCiAg\nICAgICAgICAgICAgICAuYXNMaXN0KFN0cmluZ3Muc3BsaXQodHlwZXMsICI7\nIiwgMCkpKTsKICAgIH0KfQo=\n","encoding":"base64"}

