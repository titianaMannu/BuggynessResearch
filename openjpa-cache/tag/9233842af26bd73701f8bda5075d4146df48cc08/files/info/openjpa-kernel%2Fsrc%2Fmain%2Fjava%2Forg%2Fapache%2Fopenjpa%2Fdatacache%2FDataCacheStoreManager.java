{"sha":"ed2711085301bfabb37535024db1bb244397ffe0","node_id":"MDQ6QmxvYjIwNjM2NDplZDI3MTEwODUzMDFiZmFiYjM3NTM1MDI0ZGIxYmIyNDQzOTdmZmUw","size":28094,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ed2711085301bfabb37535024db1bb244397ffe0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0RhdGFHZW5lcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRhdGFDYWNoZVJldHJpZXZl\nTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGF0YUNh\nY2hlU3RvcmVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5EZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tMZXZlbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVRdWVy\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJl\ncG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVu\nSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRpbWlz\ndGljRXhjZXB0aW9uOwoKLyoqCiAqIFN0b3JlTWFuYWdlciBwcm94eSB0aGF0\nIGRlbGVnYXRlcyB0byBhIGRhdGEgY2FjaGUgd2hlbiBwb3NzaWJsZS4KICoK\nICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIERhdGFDYWNoZVN0b3JlTWFuYWdlcgogICAgZXh0ZW5k\ncyBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIHsKCiAgICAvLyBhbGwgdGhlIHN0\nYXRlIG1hbmFnZXJzIGNoYW5nZWQgaW4gdGhpcyB0cmFuc2FjdGlvbgogICAg\ncHJpdmF0ZSBDb2xsZWN0aW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IF9pbnNl\ncnRzID0gbnVsbDsKICAgIHByaXZhdGUgTWFwPE9wZW5KUEFTdGF0ZU1hbmFn\nZXIsIEJpdFNldD4gX3VwZGF0ZXMgPSBudWxsOwogICAgcHJpdmF0ZSBDb2xs\nZWN0aW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IF9kZWxldGVzID0gbnVsbDsK\nCiAgICAvLyB0aGUgb3duaW5nIGNvbnRleHQKICAgIHByaXZhdGUgU3RvcmVD\nb250ZXh0IF9jdHggPSBudWxsOwoKICAgIC8vIHBjIGRhdGEgZ2VuZXJhdG9y\nCiAgICBwcml2YXRlIFBDRGF0YUdlbmVyYXRvciBfZ2VuID0gbnVsbDsKCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAgICoKICAgICAqIEBwYXJh\nbSBzbSB0aGUgc3RvcmUgbWFuYWdlciB0byBkZWxlZ2F0ZSB0bwogICAgICov\nCiAgICBwdWJsaWMgRGF0YUNhY2hlU3RvcmVNYW5hZ2VyKFN0b3JlTWFuYWdl\nciBzbSkgewogICAgICAgIHN1cGVyKHNtKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBf\nY3R4ID0gY3R4OwogICAgICAgIF9nZW4gPSBjdHguZ2V0Q29uZmlndXJhdGlv\nbigpLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLmdldFBDRGF0YUdl\nbmVyYXRvcigpOwogICAgICAgIHN1cGVyLnNldENvbnRleHQoY3R4KTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBzdXBlci5i\nZWdpbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBzdXBlci5jb21taXQoKTsKICAgICAg\nICAgICAgdXBkYXRlQ2FjaGVzKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgX2luc2VydHMgPSBudWxsOwogICAgICAgICAgICBfdXBkYXRl\ncyA9IG51bGw7CiAgICAgICAgICAgIF9kZWxldGVzID0gbnVsbDsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2soKSB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgc3VwZXIucm9sbGJhY2soKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaW5zZXJ0cyA9IG51bGw7CiAg\nICAgICAgICAgIF91cGRhdGVzID0gbnVsbDsKICAgICAgICAgICAgX2RlbGV0\nZXMgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEV2\naWN0IGFsbCBtZW1iZXJzIG9mIHRoZSBnaXZlbiBjbGFzc2VzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgZXZpY3RUeXBlcyhDb2xsZWN0aW9uPENsYXNz\nPD8+PiBjbGFzc2VzKSB7CiAgICAgICAgaWYgKGNsYXNzZXMuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1ldGFEYXRhUmVwb3Np\ndG9yeSBtZHIgPSBfY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAg\nICAgZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIgPSBfY3R4LmdldENsYXNzTG9hZGVyKCk7Cgog\nICAgICAgIERhdGFDYWNoZSBjYWNoZTsKICAgICAgICBmb3IgKENsYXNzPD8+\nIGNscyA6IGNsYXNzZXMpIHsKICAgICAgICAgICAgY2FjaGUgPSBtZHIuZ2V0\nTWV0YURhdGEoY2xzLCBsb2FkZXIsIGZhbHNlKS5nZXREYXRhQ2FjaGUoKTsK\nICAgICAgICAgICAgaWYgKGNhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBjYWNoZS5yZW1vdmVBbGwoY2xzLCBmYWxzZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVXBkYXRlIGFsbCBjYWNoZXMgd2l0aCB0aGUg\nY29tbWl0dGVkIGluc2VydHMsIHVwZGF0ZXMsIGFuZCBkZWxldGVzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdXBkYXRlQ2FjaGVzKCkgewogICAgICAg\nIGlmKF9jdHguZ2V0Q2FjaGVTdG9yZU1vZGUoKSAhPSBEYXRhQ2FjaGVTdG9y\nZU1vZGUuQllQQVNTICkgeyAKICAgICAgICAgICAgLy8gbWFwIGVhY2ggZGF0\nYSBjYWNoZSB0byB0aGUgbW9kaWZpY2F0aW9ucyB3ZSBuZWVkIHRvIHBlcmZv\ncm0KICAgICAgICAgICAgTWFwPERhdGFDYWNoZSxNb2RpZmljYXRpb25zPiBt\nb2RNYXAgPSBudWxsOwogICAgICAgICAgICBpZiAoKF9jdHguZ2V0UG9wdWxh\ndGVEYXRhQ2FjaGUoKSAmJiBfaW5zZXJ0cyAhPSBudWxsKSB8fCBfdXBkYXRl\ncyAhPSBudWxsIHx8IF9kZWxldGVzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBtb2RNYXAgPSBuZXcgSGFzaE1hcDxEYXRhQ2FjaGUsTW9kaWZpY2F0aW9u\ncz4oKTsKICAgICAgICAgICAgTW9kaWZpY2F0aW9ucyBtb2RzOwogICAgICAg\nICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YTsKICAgICAgICAgICAgRGF0YUNh\nY2hlIGNhY2hlOwoKICAgICAgICAgICAgLy8gY3JlYXRlIHBjIGRhdGFzIGZv\nciBpbnNlcnRzCiAgICAgICAgICAgIGlmIChfY3R4LmdldFBvcHVsYXRlRGF0\nYUNhY2hlKCkgJiYgX2luc2VydHMgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgZm9yIChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtIDogX2luc2VydHMpIHsK\nICAgICAgICAgICAgICAgICAgICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCku\nZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hl\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgICAgICBtb2RzID0gZ2V0TW9kaWZpY2F0aW9ucyht\nb2RNYXAsIGNhY2hlKTsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gbmV3\nUENEYXRhKHNtKTsKICAgICAgICAgICAgICAgICAgICBkYXRhLnN0b3JlKHNt\nKTsKICAgICAgICAgICAgICAgICAgICBtb2RzLmFkZGl0aW9ucy5hZGQobmV3\nIFBDRGF0YUhvbGRlcihkYXRhLCBzbSkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB1cGRhdGUgcGNkYXRhcyBm\nb3IgdXBkYXRlcwogICAgICAgICAgICBpZiAoX3VwZGF0ZXMgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgQml0U2V0IGZpZWxkczsKICAgICAgICAgICAg\nICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207CiAgICAgICAgICAgICAgICBm\nb3IgKE1hcC5FbnRyeTxPcGVuSlBBU3RhdGVNYW5hZ2VyLCBCaXRTZXQ+IGVu\ndHJ5IDogX3VwZGF0ZXMuZW50cnlTZXQoKSkgeyAKICAgICAgICAgICAgICAg\nICAgICBzbSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgICAg\nIGZpZWxkcyA9IGVudHJ5LmdldFZhbHVlKCk7CgogICAgICAgICAgICAgICAg\nICAgIGNhY2hlID0gc20uZ2V0TWV0YURhdGEoKS5nZXREYXRhQ2FjaGUoKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGl0J3Mgb2sgbm90IHRv\nIGNsb25lIHRoZSBvYmplY3QgdGhhdCB3ZSBnZXQgZnJvbSB0aGUgY2FjaGUs\nCiAgICAgICAgICAgICAgICAgICAgLy8gc2luY2Ugd2UncmUgaW5zaWRlIHRo\nZSBjb21taXQoKSBtZXRob2QsIHNvIGFueSBtb2RpZmljYXRpb25zCiAgICAg\nICAgICAgICAgICAgICAgLy8gdG8gdGhlIHVuZGVybHlpbmcgY2FjaGUgYXJl\nIHZhbGlkLiBJZiB0aGUgY29tbWl0IGhhZCBub3QKICAgICAgICAgICAgICAg\nICAgICAvLyBhbHJlYWR5IHN1Y2NlZWRlZCwgdGhlbiB3ZSdkIHdhbnQgdG8g\nY2xvbmUgdGhlIHJldHJpZXZlZAogICAgICAgICAgICAgICAgICAgIC8vIG9i\namVjdC4KICAgICAgICAgICAgICAgICAgICBkYXRhID0gY2FjaGUuZ2V0KHNt\nLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgICAgIG1vZHMgPSBn\nZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwoKICAgICAgICAgICAg\nICAgICAgICAvLyBkYXRhIHNob3VsZCBhbHdheXMgYmUgbm9uLW51bGwsIHNp\nbmNlIHRoZSBvYmplY3QgaXMKICAgICAgICAgICAgICAgICAgICAvLyBkaXJ0\neSwgYnV0IG1heWJlIGl0IGdvdCBkcm9wcGVkIGZyb20gdGhlIGNhY2hlIGlu\nIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGludGVyaW0KICAgICAgICAg\nICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGRhdGEgPSBuZXdQQ0RhdGEoc20pOwogICAgICAgICAgICAg\nICAgICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgbW9kcy5uZXdVcGRhdGVzLmFkZChuZXcgUENEYXRhSG9sZGVyKGRh\ndGEsIHNtKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgZGF0YS5zdG9yZShzbSwgZmllbGRzKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgbW9kcy5leGlzdGluZ1VwZGF0ZXMuYWRk\nKG5ldyBQQ0RhdGFIb2xkZXIoZGF0YSwgc20pKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHJlbW92ZSBwY2RhdGFzIGZvciBkZWxldGVzCiAgICAgICAg\nICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBm\nb3IgKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gOiBfZGVsZXRlcykgeyAKICAg\nICAgICAgICAgICAgICAgICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0\nRGF0YUNhY2hlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgICAgICBtb2RzID0gZ2V0TW9kaWZpY2F0aW9ucyhtb2RN\nYXAsIGNhY2hlKTsKICAgICAgICAgICAgICAgICAgICBtb2RzLmRlbGV0ZXMu\nYWRkKHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBub3RpZnkgdGhlIGNhY2hlcyBv\nZiB0aGUgY2hhbmdlcwogICAgICAgICAgICBpZiAobW9kTWFwICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGZvciAoTWFwLkVudHJ5PERhdGFDYWNoZSxN\nb2RpZmljYXRpb25zPiBlbnRyeSA6IG1vZE1hcC5lbnRyeVNldCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgY2FjaGUgPSBlbnRyeS5nZXRLZXkoKTsKICAg\nICAgICAgICAgICAgICAgICBtb2RzID0gZW50cnkuZ2V0VmFsdWUoKTsKCiAg\nICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHdlJ3JlIG5vdCBjYWNo\naW5nIG9sZCB2ZXJzaW9ucwogICAgICAgICAgICAgICAgICAgIGNhY2hlLndy\naXRlTG9jaygpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNhY2hlLmNvbW1pdCgKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25TYWZlUENEYXRh\ncyhjYWNoZSwgbW9kcy5hZGRpdGlvbnMpLCAKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25TYWZlUENEYXRhcyhj\nYWNoZSwgbW9kcy5uZXdVcGRhdGVzKSwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoY2Fj\naGUsIG1vZHMuZXhpc3RpbmdVcGRhdGVzKSwgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbW9kcy5kZWxldGVzKTsKICAgICAgICAgICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICBjYWNo\nZS53cml0ZVVubG9jaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYg\nd2Ugd2VyZSBpbiBsYXJnZVRyYW5zYWN0aW9uIG1vZGUsIHRoZW4gd2UgaGF2\nZSByZWNvcmRlZAogICAgICAgICAgICAvLyB0aGUgY2xhc3NlcyBvZiB1cGRh\ndGVkL2RlbGV0ZWQgb2JqZWN0cyBhbmQgdGhlc2Ugbm93IG5lZWQgdG8gYmUK\nICAgICAgICAgICAgLy8gZXZpY3RlZAogICAgICAgICAgICBpZiAoX2N0eC5p\nc1RyYWNrQ2hhbmdlc0J5VHlwZSgpKSB7CiAgICAgICAgICAgICAgICBldmlj\ndFR5cGVzKF9jdHguZ2V0RGVsZXRlZFR5cGVzKCkpOwogICAgICAgICAgICAg\nICAgZXZpY3RUeXBlcyhfY3R4LmdldFVwZGF0ZWRUeXBlcygpKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gYW5kIG5vdGlmeSB0aGUgcXVlcnkg\nY2FjaGUuICBub3RpZnkgaW4gb25lIGJhdGNoIHRvIHJlZHVjZSBzeW5jaAog\nICAgICAgICAgICBRdWVyeUNhY2hlIHF1ZXJ5Q2FjaGUgPSBfY3R4LmdldENv\nbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0RGF0YUNhY2hlTWFuYWdl\nckluc3RhbmNlKCkuZ2V0U3lzdGVtUXVlcnlDYWNoZSgpOwogICAgICAgICAg\nICBpZiAocXVlcnlDYWNoZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBD\nb2xsZWN0aW9uPENsYXNzPD8+PiBwZXJzID0gX2N0eC5nZXRQZXJzaXN0ZWRU\neXBlcygpOwogICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxDbGFzczw/Pj4g\nZGVsID0gX2N0eC5nZXREZWxldGVkVHlwZXMoKTsKICAgICAgICAgICAgICAg\nIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHVwID0gX2N0eC5nZXRVcGRhdGVkVHlw\nZXMoKTsKICAgICAgICAgICAgICAgIGludCBzaXplID0gcGVycy5zaXplKCkg\nKyBkZWwuc2l6ZSgpICsgdXAuc2l6ZSgpOwogICAgICAgICAgICAgICAgaWYg\nKHNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxD\nbGFzczw/Pj4gdHlwZXMgPSBuZXcgQXJyYXlMaXN0PENsYXNzPD8+PihzaXpl\nKTsKICAgICAgICAgICAgICAgICAgICB0eXBlcy5hZGRBbGwocGVycyk7CiAg\nICAgICAgICAgICAgICAgICAgdHlwZXMuYWRkQWxsKGRlbCk7CiAgICAgICAg\nICAgICAgICAgICAgdHlwZXMuYWRkQWxsKHVwKTsKICAgICAgICAgICAgICAg\nICAgICBxdWVyeUNhY2hlLm9uVHlwZXNDaGFuZ2VkKG5ldyBUeXBlc0NoYW5n\nZWRFdmVudCh0aGlzLCB0eXBlcykpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9IAogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRy\nYW5zZm9ybXMgYSBjb2xsZWN0aW9uIG9mIHtAbGluayBQQ0RhdGFIb2xkZXJ9\ncyB0aGF0IG1pZ2h0IGNvbnRhaW4KICAgICAqIHN0YWxlIGluc3RhbmNlcyBp\nbnRvIGEgY29sbGVjdGlvbiBvZiB1cC10by1kYXRlIHtAbGluayBEYXRhQ2Fj\naGVQQ0RhdGF9cy4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PERhdGFDYWNo\nZVBDRGF0YT4gdHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoRGF0YUNh\nY2hlIGNhY2hlLCBMaXN0PFBDRGF0YUhvbGRlcj4gaG9sZGVycykgewogICAg\nICAgIExpc3Q8RGF0YUNhY2hlUENEYXRhPiB0cmFuc2Zvcm1lZCA9IG5ldyBB\ncnJheUxpc3Q8RGF0YUNhY2hlUENEYXRhPihob2xkZXJzLnNpemUoKSk7CiAg\nICAgICAgTWFwPE9iamVjdCxJbnRlZ2VyPiBpZHMgPSBuZXcgSGFzaE1hcDxP\nYmplY3QsSW50ZWdlcj4oaG9sZGVycy5zaXplKCkpOwogICAgICAgIC8vIHRo\naXMgbGlzdCBjb3VsZCBiZSByZW1vdmVkIGlmIERhdGFDYWNoZS5nZXRBbGwo\nKSB0b29rIGEgQ29sbGVjdGlvbgogICAgICAgIExpc3Q8T2JqZWN0PiBpZExp\nc3QgPSBuZXcgQXJyYXlMaXN0PE9iamVjdD4oaG9sZGVycy5zaXplKCkpOwog\nICAgICAgIGludCBpID0gMDsKICAgICAgICBmb3IgKFBDRGF0YUhvbGRlciBo\nb2xkZXIgOiBob2xkZXJzKSB7CiAgICAgICAgICAgIGlkcy5wdXQoaG9sZGVy\nLnNtLmdldE9iamVjdElkKCksIGkrKyk7CiAgICAgICAgICAgIGlkTGlzdC5h\nZGQoaG9sZGVyLnNtLmdldE9iamVjdElkKCkpOwogICAgICAgIH0KCiAgICAg\nICAgTWFwPE9iamVjdCxEYXRhQ2FjaGVQQ0RhdGE+IHBjZGF0YXMgPSBjYWNo\nZS5nZXRBbGwoaWRMaXN0KTsKICAgICAgICBmb3IgKEVudHJ5PE9iamVjdCxE\nYXRhQ2FjaGVQQ0RhdGE+IGVudHJ5IDogcGNkYXRhcy5lbnRyeVNldCgpKSB7\nCiAgICAgICAgICAgIEludGVnZXIgaW5kZXggPSBpZHMuZ2V0KGVudHJ5Lmdl\ndEtleSgpKTsKICAgICAgICAgICAgRGF0YUNhY2hlUENEYXRhIG9sZHBjID0g\nZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgUENEYXRhSG9sZGVyIGhv\nbGRlciA9IGhvbGRlcnMuZ2V0KGluZGV4KTsKICAgICAgICAgICAgaWYgKG9s\nZHBjICE9IG51bGwgJiYgY29tcGFyZVZlcnNpb24oaG9sZGVyLnNtLAogICAg\nICAgICAgICAgICAgaG9sZGVyLnNtLmdldFZlcnNpb24oKSwgb2xkcGMuZ2V0\nVmVyc2lvbigpKSA9PSBWRVJTSU9OX0VBUkxJRVIpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\ndHJhbnNmb3JtZWQuYWRkKGhvbGRlci5wY2RhdGEpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSB7QGxpbmsgTW9kaWZpY2F0aW9uc30gaW5zdGFuY2UgdG8g\ndHJhY2sgbW9kaWZpY2F0aW9ucwogICAgICogdG8gdGhlIGdpdmVuIGNhY2hl\nLCBjcmVhdGluZyBhbmQgY2FjaGluZyB0aGUgaW5zdGFuY2UgaWYgaXQgZG9l\ncwogICAgICogbm90IGFscmVhZHkgZXhpc3QgaW4gdGhlIGdpdmVuIG1hcC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgTW9kaWZpY2F0aW9ucyBnZXRN\nb2RpZmljYXRpb25zKE1hcDxEYXRhQ2FjaGUsTW9kaWZpY2F0aW9ucz4gbW9k\nTWFwLCBEYXRhQ2FjaGUgY2FjaGUpIHsKICAgICAgICBNb2RpZmljYXRpb25z\nIG1vZHMgPSAoTW9kaWZpY2F0aW9ucykgbW9kTWFwLmdldChjYWNoZSk7CiAg\nICAgICAgaWYgKG1vZHMgPT0gbnVsbCkgewogICAgICAgICAgICBtb2RzID0g\nbmV3IE1vZGlmaWNhdGlvbnMoKTsKICAgICAgICAgICAgbW9kTWFwLnB1dChj\nYWNoZSwgbW9kcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtb2RzOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGV4aXN0cyhPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAgICAgICBEYXRhQ2FjaGUg\nY2FjaGUgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAg\nICAgIGlmIChjYWNoZSAhPSBudWxsICYmICFpc0xvY2tpbmcobnVsbCkKICAg\nICAgICAgICAgJiYgY2FjaGUuY29udGFpbnMoc20uZ2V0T2JqZWN0SWQoKSkp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBzdXBl\nci5leGlzdHMoc20sIGVkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBzeW5jVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3Qg\nZWRhdGEpIHsKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBzbS5nZXRNZXRh\nRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBu\ndWxsIHx8IHNtLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLnN5bmNWZXJzaW9uKHNtLCBlZGF0YSk7CgogICAgICAgIERhdGFDYWNo\nZVBDRGF0YSBkYXRhOwogICAgICAgIE9iamVjdCB2ZXJzaW9uID0gbnVsbDsK\nICAgICAgICBkYXRhID0gY2FjaGUuZ2V0KHNtLmdldE9iamVjdElkKCkpOwog\nICAgICAgIGlmICghaXNMb2NraW5nKG51bGwpICYmIGRhdGEgIT0gbnVsbCkK\nICAgICAgICAgICAgdmVyc2lvbiA9IGRhdGEuZ2V0VmVyc2lvbigpOwoKICAg\nICAgICAvLyBpZiB3ZSBoYXZlIGEgY2FjaGVkIHZlcnNpb24gdXBkYXRlIGZy\nb20gdGhlcmUKICAgICAgICBpZiAodmVyc2lvbiAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGlmICghdmVyc2lvbi5lcXVhbHMoc20uZ2V0VmVyc2lvbigpKSkg\newogICAgICAgICAgICAgICAgc20uc2V0VmVyc2lvbih2ZXJzaW9uKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIHVz\nZSBkYXRhIHN0b3JlIHZlcnNpb24KICAgICAgICByZXR1cm4gc3VwZXIuc3lu\nY1ZlcnNpb24oc20sIGVkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpbml0aWFsaXplKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3RhdGUg\nc3RhdGUsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGVkYXRh\nKSB7CiAgICAgICAgYm9vbGVhbiBmcm9tRGF0YWJhc2U7IAogICAgICAgIERh\ndGFDYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hl\nKCk7CiAgICAgICAgRGF0YUNhY2hlUENEYXRhIGRhdGEgPSBudWxsOwogICAg\nICAgIGJvb2xlYW4gdXBkYXRlQ2FjaGUgPSBfY3R4LmdldENhY2hlU3RvcmVN\nb2RlKCkgIT0gRGF0YUNhY2hlU3RvcmVNb2RlLkJZUEFTUyAmJiBfY3R4Lmdl\ndFBvcHVsYXRlRGF0YUNhY2hlKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51\nbGwgfHwgc20uaXNFbWJlZGRlZCgpIHx8IF9jdHguZ2V0Q2FjaGVSZXRyaWV2\nZU1vZGUoKSA9PSBEYXRhQ2FjaGVSZXRyaWV2ZU1vZGUuQllQQVNTCiAgICAg\nICAgICAgIHx8IF9jdHguZ2V0Q2FjaGVTdG9yZU1vZGUoKSA9PSBEYXRhQ2Fj\naGVTdG9yZU1vZGUuUkVGUkVTSCkgewogICAgICAgICAgICBmcm9tRGF0YWJh\nc2UgPSBzdXBlci5pbml0aWFsaXplKHNtLCBzdGF0ZSwgZmV0Y2gsIGVkYXRh\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhID0gY2FjaGUu\nZ2V0KHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICBpZiAoZGF0YSAh\nPSBudWxsICYmICFpc0xvY2tpbmcoZmV0Y2gpKSB7ICAgICAgICAgICAgICAg\nIAogICAgICAgICAgICAgICAgLy8jIyMgdGhlICdkYXRhLnR5cGUnIGFjY2Vz\ncyBoZXJlIHByb2JhYmx5IG5lZWRzIHRvIGJlCiAgICAgICAgICAgICAgICAv\nLyMjIyBhZGRyZXNzZWQgZm9yIGJ1ZyA1MTEKICAgICAgICAgICAgICAgIHNt\nLmluaXRpYWxpemUoZGF0YS5nZXRUeXBlKCksIHN0YXRlKTsKICAgICAgICAg\nICAgICAgIGRhdGEubG9hZChzbSwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICAg\nICAgICAgIC8vIG5vIG5lZWQgdG8gdXBkYXRlIHRoZSBjYWNoZS4gCiAgICAg\nICAgICAgICAgICB1cGRhdGVDYWNoZSA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgZnJvbURhdGFiYXNlID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemUgZnJvbSBzdG9yZSBtYW5h\nZ2VyCiAgICAgICAgICAgICAgICBmcm9tRGF0YWJhc2UgPSBzdXBlci5pbml0\naWFsaXplKHNtLCBzdGF0ZSwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKGNhY2hlICE9IG51bGwgJiYgKGZy\nb21EYXRhYmFzZSAmJiB1cGRhdGVDYWNoZSkpIHsKICAgICAgICAgICAgLy8g\ndXBkYXRlIGNhY2hlIGlmIHRoZSByZXN1bHQgY2FtZSBmcm9tIHRoZSBkYXRh\nYmFzZSBhbmQgY29uZmlndXJlZCB0byBzdG9yZSBvciByZWZyZXNoIHRoZSBj\nYWNoZS4KICAgICAgICAgICAgY2FjaGVTdGF0ZU1hbmFnZXIoY2FjaGUsIHNt\nLCBkYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZyb21EYXRhYmFz\nZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGNhY2hlU3RhdGVNYW5h\nZ2VyKERhdGFDYWNoZSBjYWNoZSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nRGF0YUNhY2hlUENEYXRhIGRhdGEpIHsKICAgICAgICBpZihzbS5pc0ZsdXNo\nZWQoKSkgeyAKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAg\nICAvLyBtYWtlIHN1cmUgdGhhdCB3ZSdyZSBub3QgdHJ5aW5nIHRvIGNhY2hl\nIGFuIG9sZCB2ZXJzaW9uCiAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCAmJiBj\nb21wYXJlVmVyc2lvbihzbSwgc20uZ2V0VmVyc2lvbigpLCBkYXRhLmdldFZl\ncnNpb24oKSkgPT0gVkVSU0lPTl9FQVJMSUVSKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNhY2hl\nIG5ld2x5IGxvYWRlZCBpbmZvLiBJdCBpcyBzYWZlIHRvIGNhY2hlIGRhdGEg\nZnJvcm0KICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSgpIGJlY2F1c2UgdGhp\ncyBtZXRob2QgaXMgb25seSBjYWxsZWQgdXBvbgogICAgICAgICAgICAvLyBp\nbml0aWFsIGxvYWQgb2YgdGhlIGRhdGEuCiAgICAgICAgICAgIGJvb2xlYW4g\naXNOZXcgPSBkYXRhID09IG51bGw7CiAgICAgICAgICAgIGlmIChpc05ldykg\newogICAgICAgICAgICAgICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgZGF0YS5zdG9yZShzbSk7CiAgICAgICAg\nICAgIGlmIChpc05ldykgeyAKICAgICAgICAgICAgICAgIGNhY2hlLnB1dChk\nYXRhKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNh\nY2hlLnVwZGF0ZShkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGxvYWQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywKICAgICAgICBGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2NrTGV2ZWwsIE9iamVjdCBlZGF0\nYSkgewogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFEYXRh\nKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51bGwg\nfHwgc20uaXNFbWJlZGRlZCgpIHx8IF9jdHguZ2V0Q2FjaGVSZXRyaWV2ZU1v\nZGUoKSA9PSBEYXRhQ2FjaGVSZXRyaWV2ZU1vZGUuQllQQVNTKQogICAgICAg\nICAgICByZXR1cm4gc3VwZXIubG9hZChzbSwgZmllbGRzLCBmZXRjaCwgbG9j\na0xldmVsLCBlZGF0YSk7CgogICAgICAgIERhdGFDYWNoZVBDRGF0YSBkYXRh\nID0gY2FjaGUuZ2V0KHNtLmdldE9iamVjdElkKCkpOwogICAgICAgIGlmIChs\nb2NrTGV2ZWwgPT0gTG9ja0xldmVscy5MT0NLX05PTkUgJiYgIWlzTG9ja2lu\nZyhmZXRjaCkgJiYgZGF0YSAhPSBudWxsKQogICAgICAgICAgICBkYXRhLmxv\nYWQoc20sIGZpZWxkcywgZmV0Y2gsIGVkYXRhKTsKICAgICAgICBpZiAoZmll\nbGRzLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoK\nICAgICAgICAvLyBsb2FkIGZyb20gc3RvcmUgbWFuYWdlcjsgY2xvbmUgdGhl\nIHNldCBvZiBzdGlsbC11bmxvYWRlZCBmaWVsZHMKICAgICAgICAvLyBzbyB0\naGF0IGlmIHRoZSBzdG9yZSBtYW5hZ2VyIGRlY2lkZXMgdG8gbW9kaWZ5IGl0\nIGl0IHdvbid0IGFmZmVjdCB1cwogICAgICAgIGlmICghc3VwZXIubG9hZChz\nbSwgKEJpdFNldCkgZmllbGRzLmNsb25lKCksIGZldGNoLCBsb2NrTGV2ZWws\nIGVkYXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChfY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCkpIHsKICAgICAgICAgICAg\nY2FjaGVTdGF0ZU1hbmFnZXIoY2FjaGUsIHNtLCBkYXRhKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgfQoKICAgIHB1YmxpYyBDb2xs\nZWN0aW9uPE9iamVjdD4gbG9hZEFsbChDb2xsZWN0aW9uPE9wZW5KUEFTdGF0\nZU1hbmFnZXI+IHNtcywgUENTdGF0ZSBzdGF0ZSwgaW50IGxvYWQsCiAgICAJ\nCUZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGVkYXRhKSB7CiAg\nICAJaWYgKGlzTG9ja2luZyhmZXRjaCkgfHwgCiAgICAJICAgKCFpc0xvY2tp\nbmcoZmV0Y2gpICYmCiAgICAJCShsb2FkID09IFN0b3JlTWFuYWdlci5GT1JD\nRV9MT0FEX1JFRlJFU0gpCiAgICAJCSYmICFfY3R4LmdldENvbmZpZ3VyYXRp\nb24oKS5nZXRSZWZyZXNoRnJvbURhdGFDYWNoZSgpKSkgewogICAgCSAgICAg\nICByZXR1cm4gc3VwZXIubG9hZEFsbChzbXMsIHN0YXRlLCBsb2FkLCBmZXRj\naCwgZWRhdGEpOwogICAgCX0KCiAgICAgICAgTWFwPE9wZW5KUEFTdGF0ZU1h\nbmFnZXIsIEJpdFNldD4gdW5sb2FkZWQgPSBudWxsOwogICAgICAgIExpc3Q8\nT3BlbkpQQVN0YXRlTWFuYWdlcj4gc21MaXN0ID0gbnVsbDsKICAgICAgICBN\nYXA8RGF0YUNhY2hlLExpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4+IGNhY2hl\ncyA9IG5ldyBIYXNoTWFwPERhdGFDYWNoZSxMaXN0PE9wZW5KUEFTdGF0ZU1h\nbmFnZXI+PigpOwogICAgICAgIERhdGFDYWNoZSBjYWNoZTsKICAgICAgICBE\nYXRhQ2FjaGVQQ0RhdGEgZGF0YTsKICAgICAgICBCaXRTZXQgZmllbGRzOwoK\nICAgICAgICBmb3IgKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gOiBzbXMpIHsK\nICAgICAgICAgICAgY2FjaGUgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERhdGFD\nYWNoZSgpOwogICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCB8fCBzbS5p\nc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgIHVubG9hZGVkID0gYWRk\nVW5sb2FkZWQoc20sIG51bGwsIHVubG9hZGVkKTsKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCkgPT0gbnVsbAogICAgICAgICAgICAgICAg\nfHwgbG9hZCAhPSBGT1JDRV9MT0FEX05PTkUKICAgICAgICAgICAgICAgIHx8\nIHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAg\nICAgICAgICAgc21MaXN0ID0gY2FjaGVzLmdldChjYWNoZSk7CiAgICAgICAg\nICAgICAgICBpZiAoc21MaXN0ID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBzbUxpc3QgPSBuZXcgQXJyYXlMaXN0PE9wZW5KUEFTdGF0ZU1hbmFn\nZXI+KCk7CiAgICAgICAgICAgICAgICAgICAgY2FjaGVzLnB1dChjYWNoZSwg\nc21MaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNt\nTGlzdC5hZGQoc20pOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFjYWNoZS5j\nb250YWlucyhzbS5nZXRPYmplY3RJZCgpKSkKICAgICAgICAgICAgICAgIHVu\nbG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51bGwsIHVubG9hZGVkKTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChJdGVyYXRvcjxEYXRhQ2Fj\naGU+IGl0ciA9IGNhY2hlcy5rZXlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICBjYWNoZSA9IGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgIHNtTGlzdCA9IGNhY2hlcy5nZXQoY2FjaGUpOwogICAgICAg\nICAgICBMaXN0PE9iamVjdD4gb2lkTGlzdCA9IG5ldyBBcnJheUxpc3Q8T2Jq\nZWN0PihzbUxpc3Quc2l6ZSgpKTsKCiAgICAgICAgICAgIGZvciAoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSA6IHNtTGlzdCkgewogICAgICAgICAgICAgICAg\nb2lkTGlzdC5hZGQoKE9wZW5KUEFJZCkgc20uZ2V0T2JqZWN0SWQoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIE1hcDxPYmpl\nY3QsRGF0YUNhY2hlUENEYXRhPiBkYXRhTWFwID0gY2FjaGUuZ2V0QWxsKG9p\nZExpc3QpOwoKICAgICAgICAgICAgZm9yIChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtIDogc21MaXN0KSB7CiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YU1h\ncC5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7CgogICAgICAgICAgICAgICAgaWYg\nKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIyMjIHRoZSAnZGF0YS50eXBlJyBhY2Nlc3MgaGVyZSBw\ncm9iYWJseSBuZWVkcwogICAgICAgICAgICAgICAgICAgICAgICAvLyMjIyB0\nbyBiZSBhZGRyZXNzZWQgZm9yIGJ1ZyA1MTEKICAgICAgICAgICAgICAgICAg\nICAgICAgc20uaW5pdGlhbGl6ZShkYXRhLmdldFR5cGUoKSwgc3RhdGUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmxvYWQoc20sIGZldGNoLCBl\nZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgdW5sb2FkZWQgPSBhZGRVbmxvYWRlZChzbSwgbnVs\nbCwgdW5sb2FkZWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAobG9hZCAhPSBGT1JDRV9MT0FEX05PTkUKICAg\nICAgICAgICAgICAgICAgICAgICAgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBD\nU3RhdGUuSE9MTE9XKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGNh\nY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGxvYWQgdW5sb2FkZWQgZmllbGRzCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZpZWxkcyA9IHNtLmdldFVubG9hZGVkKGZldGNoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZGF0YS5sb2FkKHNtLCBmaWVsZHMsIGZldGNoLCBl\nZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZHMubGVu\nZ3RoKCkgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2Fk\nZWQgPSBhZGRVbmxvYWRlZChzbSwgZmllbGRzLCB1bmxvYWRlZCk7CiAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAg\nIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51bGwsIHVubG9hZGVkKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYgKHVubG9hZGVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBDb2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsKCiAgICAgICAgLy8gbG9hZCB3\naXRoIGRlbGVnYXRlCiAgICAgICAgQ29sbGVjdGlvbjxPYmplY3Q+IGZhaWxl\nZCA9IHN1cGVyLmxvYWRBbGwodW5sb2FkZWQua2V5U2V0KCksIHN0YXRlLCBs\nb2FkLCBmZXRjaCwgZWRhdGEpOwogICAgICAgIGlmICghX2N0eC5nZXRQb3B1\nbGF0ZURhdGFDYWNoZSgpKQogICAgICAgICAgICByZXR1cm4gZmFpbGVkOwoK\nICAgICAgICAvLyBmb3IgZWFjaCBsb2FkZWQgaW5zdGFuY2UsIG1lcmdlIGxv\nYWRlZCBzdGF0ZSBpbnRvIGNhY2hlZCBkYXRhCgogICAgICAgIGJvb2xlYW4g\naXNOZXc7CgogICAgICAgIGZvcihNYXAuRW50cnk8T3BlbkpQQVN0YXRlTWFu\nYWdlciwgQml0U2V0PiBlbnRyeSA6IHVubG9hZGVkLmVudHJ5U2V0KCkpIHsg\nCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBlbnRyeS5n\nZXRLZXkoKTsKICAgICAgICAgICAgZmllbGRzID0gZW50cnkuZ2V0VmFsdWUo\nKTsKCiAgICAgICAgICAgIGNhY2hlID0gc20uZ2V0TWV0YURhdGEoKS5nZXRE\nYXRhQ2FjaGUoKTsKICAgICAgICAgICAgaWYgKGNhY2hlID09IG51bGwgfHwg\nc20uaXNFbWJlZGRlZCgpIHx8IChmYWlsZWQgIT0gbnVsbAogICAgICAgICAg\nICAgICAgJiYgZmFpbGVkLmNvbnRhaW5zKHNtLmdldElkKCkpKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIHRoYXQgd2UncmUgbm90IHRyeWluZyB0byBjYWNoZSBhbiBvbGQgdmVyc2lv\nbgogICAgICAgICAgICBjYWNoZS53cml0ZUxvY2soKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGRhdGEgPSBjYWNoZS5nZXQoc20uZ2V0\nT2JqZWN0SWQoKSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxs\nICYmIGNvbXBhcmVWZXJzaW9uKHNtLCBzbS5nZXRWZXJzaW9uKCksCiAgICAg\nICAgICAgICAgICAgICAgZGF0YS5nZXRWZXJzaW9uKCkpID09IFZFUlNJT05f\nRUFSTElFUikKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICBpc05ldyA9IGRhdGEgPT0gbnVsbDsKICAgICAgICAgICAg\nICAgIGlmIChpc05ldykKICAgICAgICAgICAgICAgICAgICBkYXRhID0gbmV3\nUENEYXRhKHNtKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBkYXRhLnN0b3Jl\nKHNtLCBmaWVsZHMpOwogICAgICAgICAgICAgICAgaWYgKGlzTmV3KQogICAg\nICAgICAgICAgICAgICAgIGNhY2hlLnB1dChkYXRhKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjYWNoZS51cGRhdGUoZGF0\nYSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBj\nYWNoZS53cml0ZVVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBmYWlsZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRvIGFkZCBhbiB1bmxvYWRlZCBpbnN0YW5jZSB0byB0\naGUgZ2l2ZW4gbWFwLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBNYXA8\nT3BlbkpQQVN0YXRlTWFuYWdlciwgQml0U2V0PiBhZGRVbmxvYWRlZChPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIE1h\ncDxPcGVuSlBBU3RhdGVNYW5hZ2VyLCBCaXRTZXQ+IHVubG9hZGVkKSB7CiAg\nICAgICAgaWYgKHVubG9hZGVkID09IG51bGwpCiAgICAgICAgICAgIHVubG9h\nZGVkID0gbmV3IEhhc2hNYXA8T3BlbkpQQVN0YXRlTWFuYWdlciwgQml0U2V0\nPigpOwogICAgICAgIHVubG9hZGVkLnB1dChzbSwgZmllbGRzKTsKICAgICAg\nICByZXR1cm4gdW5sb2FkZWQ7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rp\nb248RXhjZXB0aW9uPiBmbHVzaChDb2xsZWN0aW9uPE9wZW5KUEFTdGF0ZU1h\nbmFnZXI+IHN0YXRlcykgewogICAgICAgIENvbGxlY3Rpb248RXhjZXB0aW9u\nPiBleGNlcHMgPSBzdXBlci5mbHVzaChzdGF0ZXMpOwoKICAgICAgICAvLyBp\nZiB0aGVyZSB3ZXJlIGVycm9ycyBldmljdCBiYWQgaW5zdGFuY2VzIGFuZCBk\nb24ndCByZWNvcmQgY2hhbmdlcwogICAgICAgIGlmICghZXhjZXBzLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICBmb3IgKEV4Y2VwdGlvbiBlIDogZXhjZXBz\nKSB7CiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIE9wdGltaXN0\naWNFeGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAgbm90aWZ5T3B0aW1p\nc3RpY0xvY2tGYWlsdXJlKChPcHRpbWlzdGljRXhjZXB0aW9uKSBlKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZXhjZXBzOwogICAgICAg\nIH0KCiAgICAgICAgLy8gaWYgbGFyZ2UgdHJhbnNhY3Rpb24gbW9kZSBkb24n\ndCByZWNvcmQgaW5kaXZpZHVhbCBjaGFuZ2VzCiAgICAgICAgaWYgKF9jdHgu\naXNUcmFja0NoYW5nZXNCeVR5cGUoKSkKICAgICAgICAgICAgcmV0dXJuIGV4\nY2VwczsKCiAgICAgICAgZm9yIChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtIDog\nc3RhdGVzKSB7CiAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0g\nUENTdGF0ZS5QTkVXICYmICFzbS5pc0ZsdXNoZWQoKSkgewogICAgICAgICAg\nICAgICAgaWYgKF9pbnNlcnRzID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBfaW5zZXJ0cyA9IG5ldyBBcnJheUxpc3Q8T3BlbkpQQVN0YXRlTWFu\nYWdlcj4oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9p\nbnNlcnRzLmFkZChzbSk7CgogICAgICAgICAgICAgICAgLy8gbWF5IGhhdmUg\nYmVlbiByZS1wZXJzaXN0ZWQKICAgICAgICAgICAgICAgIGlmIChfZGVsZXRl\ncyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgX2RlbGV0ZXMucmVt\nb3ZlKHNtKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoX2luc2VydHMgIT0gbnVsbCAKICAgICAgICAgICAgICAgICYmIChz\nbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVXREVMRVRFRCAKICAgICAg\nICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVdG\nTFVTSEVEREVMRVRFRCkpIHsKICAgICAgICAgICAgICAgIF9pbnNlcnRzLnJl\nbW92ZShzbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAo\nc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUERJUlRZKSB7CiAgICAgICAg\nICAgICAgICBpZiAoX3VwZGF0ZXMgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIF91cGRhdGVzID0gbmV3IEhhc2hNYXA8T3BlbkpQQVN0YXRlTWFu\nYWdlciwgQml0U2V0PigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgX3VwZGF0ZXMucHV0KHNtLCBzbS5nZXREaXJ0eSgpKTsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5Q\nREVMRVRFRCkgewogICAgICAgICAgICAgICAgaWYgKF9kZWxldGVzID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBfZGVsZXRlcyA9IG5ldyBIYXNo\nU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+KCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBfZGVsZXRlcy5hZGQoc20pOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0\neUxpc3QoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgbG9jYWwgc3Rh\nbGVuZXNzIGRldGVjdGlvbiBldmVudHMgZnJvbSB0aGUgY2FjaGUgdGhlIE9J\nRCAoaWYKICAgICAqIGF2YWlsYWJsZSkgdGhhdCByZXN1bHRlZCBpbiBhbiBv\ncHRpbWlzdGljIGxvY2sgZXhjZXB0aW9uIGlmZiB0aGUKICAgICAqIHZlcnNp\nb24gaW5mb3JtYXRpb24gaW4gdGhlIGNhY2hlIG1hdGNoZXMgdGhlIHZlcnNp\nb24gaW5mb3JtYXRpb24KICAgICAqIGluIHRoZSBzdGF0ZSBtYW5hZ2VyIGZv\nciB0aGUgZmFpbGVkIGluc3RhbmNlLiBUaGlzIG1lYW5zIHRoYXQgd2UKICAg\nICAqIHdpbGwgZXZpY3QgZGF0YSBmcm9tIHRoZSBjYWNoZSBmb3IgcmVjb3Jk\ncyB0aGF0IHNob3VsZCBoYXZlCiAgICAgKiBzdWNjZXNzZnVsbHkgY29tbWl0\ndGVkIGFjY29yZGluZyB0byB0aGUgZGF0YSBjYWNoZSBidXQKICAgICAqIGRp\nZCBub3QuIFRoZSBvbmx5IHByZWRpY3RhYmxlIHJlYXNvbiB0aGF0IGNvdWxk\nIGNhdXNlIHRoaXMgYmVoYXZpb3IKICAgICAqIGlzIGEgY29uY3VycmVudCBv\ndXQtb2YtYmFuZCBtb2RpZmljYXRpb24gdG8gdGhlIGRhdGFiYXNlIHRoYXQg\nd2FzIG5vdCAKICAgICAqIGNvbW11bmljYXRlZCB0byB0aGUgY2FjaGUuIFRo\naXMgbG9naWMgbWFrZXMgT3BlbkpQQSdzIGRhdGEgY2FjaGUgCiAgICAgKiBz\nb21ld2hhdCB0b2xlcmFudCBvZiBzdWNoIGJlaGF2aW9yLCBpbiB0aGF0IHRo\nZSBjYWNoZSB3aWxsIGJlIGNsZWFuZWQgCiAgICAgKiB1cCBhcyBmYWlsdXJl\ncyBvY2N1ci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG5vdGlmeU9wdGlt\naXN0aWNMb2NrRmFpbHVyZShPcHRpbWlzdGljRXhjZXB0aW9uIGUpIHsKICAg\nICAgICBPYmplY3QgbyA9IGUuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IF9jdHguZ2V0U3RhdGVNYW5hZ2Vy\nKG8pOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgT2JqZWN0IG9pZCA9IHNtLmdldElkKCk7CiAgICAgICAg\nYm9vbGVhbiByZW1vdmU7CgogICAgICAgIC8vIHRoaXMgbG9naWMgY291bGQg\nYmUgbW9yZSBlZmZpY2llbnQgLS0gd2UgY291bGQgYWdncmVnYXRlCiAgICAg\nICAgLy8gYWxsIHRoZSBjYWNoZS0+b2lkIGNoYW5nZXMsIGFuZCB0aGVuIHVz\nZSBEYXRhQ2FjaGUucmVtb3ZlQWxsKCkgCiAgICAgICAgLy8gYW5kIGxlc3Mg\nd3JpdGUgbG9ja3MgdG8gZG8gdGhlIG11dGF0aW9uLgogICAgICAgIENsYXNz\nTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgRGF0\nYUNhY2hlIGNhY2hlID0gbWV0YS5nZXREYXRhQ2FjaGUoKTsKICAgICAgICBp\nZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBjYWNoZS53cml0ZUxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9IGNhY2hlLmdldChvaWQpOwogICAg\nICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAgICAgc3dpdGNoIChjb21wYXJlVmVyc2lvbihzbSwg\nc20uZ2V0VmVyc2lvbigpLCBkYXRhLmdldFZlcnNpb24oKSkpIHsKICAgICAg\nICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2VyLlZFUlNJT05fTEFURVI6CiAg\nICAgICAgICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX1NBTUU6\nCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB0eCdzIGN1cnJlbnQgdmVy\nc2lvbiBpcyBsYXRlciB0aGFuIG9yIHRoZSBzYW1lIGFzIAogICAgICAgICAg\nICAgICAgICAgIC8vIHRoZSBkYXRhIGNhY2hlIHZlcnNpb24uIEluIHRoaXMg\nY2FzZSwgdGhlIGNvbW1pdCBzaG91bGQgCiAgICAgICAgICAgICAgICAgICAg\nLy8gaGF2ZSBzdWNjZWVkZWQgZnJvbSB0aGUgc3RhbmRwb2ludCBvZiB0aGUg\nY2FjaGUuIFJlbW92ZSAKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5z\ndGFuY2UgZnJvbSBjYWNoZSBpbiB0aGUgaG9wZXMgdGhhdCB0aGUgY2FjaGUg\naXMgCiAgICAgICAgICAgICAgICAgICAgLy8gb3V0IG9mIHN5bmMuCiAgICAg\nICAgICAgICAgICAgICAgcmVtb3ZlID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2Vy\nLlZFUlNJT05fRUFSTElFUjoKICAgICAgICAgICAgICAgICAgICAvLyBUaGlz\nIHR4J3MgY3VycmVudCB2ZXJzaW9uIGlzIGVhcmxpZXIgdGhhbiB0aGUgZGF0\nYSAKICAgICAgICAgICAgICAgICAgICAvLyBjYWNoZSB2ZXJzaW9uLiBUaGlz\nIGlzIGEgbm9ybWFsIG9wdGltaXN0aWMgbG9jayBmYWlsdXJlLiAKICAgICAg\nICAgICAgICAgICAgICAvLyBEbyBub3QgY2xlYW4gdXAgdGhlIGNhY2hlOyBp\ndCBwcm9iYWJseSBhbHJlYWR5IGhhcyB0aGUgCiAgICAgICAgICAgICAgICAg\nICAgLy8gcmlnaHQgdmFsdWVzLCBhbmQgaWYgbm90LCBpdCdsbCBnZXQgY2xl\nYW5lZCB1cCBieSBhIHR4CiAgICAgICAgICAgICAgICAgICAgLy8gdGhhdCBm\nYWlscyBpbiBvbmUgb2YgdGhlIG90aGVyIGNhc2Ugc3RhdGVtZW50cy4KICAg\nICAgICAgICAgICAgICAgICByZW1vdmUgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5h\nZ2VyLlZFUlNJT05fRElGRkVSRU5UOgogICAgICAgICAgICAgICAgICAgIC8v\nIFRoZSB2ZXJzaW9uIHN0cmF0ZWd5IGZvciB0aGUgZmFpbGVkIG9iamVjdCBk\nb2VzIG5vdAogICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIGVub3VnaCBp\nbmZvcm1hdGlvbiB0byBvcHRpbWl6ZSBmb3IgZXhwZWN0ZWQKICAgICAgICAg\nICAgICAgICAgICAvLyBmYWlsdXJlcy4gQ2xlYW4gdXAgdGhlIGNhY2hlLgog\nICAgICAgICAgICAgICAgICAgIHJlbW92ZSA9IHRydWU7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgIC8vIFVuZXhwZWN0ZWQgcmV0dXJuIHZhbHVlLiBS\nZW1vdmUgdG8gYmUgZnV0dXJlLXByb29mLgogICAgICAgICAgICAgICAgICAg\nIHJlbW92ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlbW92ZSkKICAgICAgICAg\nICAgICAgIC8vIHJlbW92ZSBkaXJlY3RseSBpbnN0ZWFkIG9mIHZpYSB0aGUg\nUmVtb3RlQ29tbWl0TGlzdGVuZXIKICAgICAgICAgICAgICAgIC8vIHNpbmNl\nIHdlIGhhdmUgYSB3cml0ZSBsb2NrIGhlcmUgYWxyZWFkeSwgc28gdGhpcyBp\ncyBtb3JlCiAgICAgICAgICAgICAgICAvLyBlZmZpY2llbnQgdGhhbiByZWFk\nLWxvY2tpbmcgYW5kIHRoZW4gd3JpdGUtbG9ja2luZyBsYXRlci4KICAgICAg\nICAgICAgICAgIGNhY2hlLnJlbW92ZShzbS5nZXRJZCgpKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBjYWNoZS53cml0ZVVubG9jaygpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZmlyZSBvZmYgYSByZW1vdGUgY29tbWl0\nIHN0YWxlbmVzc3MgZGV0ZWN0aW9uIGV2ZW50LgogICAgICAgIF9jdHguZ2V0\nQ29uZmlndXJhdGlvbigpLmdldFJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlcigp\nCiAgICAgICAgICAgIC5maXJlTG9jYWxTdGFsZU5vdGlmaWNhdGlvbihvaWQp\nOwogICAgfQoKICAgIHB1YmxpYyBTdG9yZVF1ZXJ5IG5ld1F1ZXJ5KFN0cmlu\nZyBsYW5ndWFnZSkgewogICAgICAgIFN0b3JlUXVlcnkgcSA9IHN1cGVyLm5l\nd1F1ZXJ5KGxhbmd1YWdlKTsKCiAgICAgICAgLy8gaWYgdGhlIHF1ZXJ5IGNh\nbid0IGJlIHBhcnNlZCBvciBpdCdzIHVzaW5nIGEgbm9uLXBhcnNlZCBsYW5n\ndWFnZQogICAgICAgIC8vIChvbmUgZm9yIHdoaWNoIHRoZXJlIGlzIG5vIEV4\ncHJlc3Npb25QYXJzZXIpLCB3ZSBjYW4ndCBjYWNoZSBpdC4KICAgICAgICBp\nZiAocSA9PSBudWxsIHx8IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNlckZvckxhbmd1\nYWdlKGxhbmd1YWdlKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gcTsK\nCiAgICAgICAgUXVlcnlDYWNoZSBxdWVyeUNhY2hlID0gX2N0eC5nZXRDb25m\naWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERhdGFDYWNoZU1hbmFnZXJJ\nbnN0YW5jZSgpLmdldFN5c3RlbVF1ZXJ5Q2FjaGUoKTsKICAgICAgICBpZiAo\ncXVlcnlDYWNoZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gcTsKCiAg\nICAgICAgcmV0dXJuIG5ldyBRdWVyeUNhY2hlU3RvcmVRdWVyeShxLCBxdWVy\neUNhY2hlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBj\nYWNoZWFibGUgaW5zdGFuY2UgZm9yIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2Vy\nLgogICAgICovCiAgICBwcml2YXRlIERhdGFDYWNoZVBDRGF0YSBuZXdQQ0Rh\ndGEoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKF9n\nZW4gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChEYXRhQ2FjaGVQQ0Rh\ndGEpIF9nZW4uZ2VuZXJhdGVQQ0RhdGEoc20uZ2V0T2JqZWN0SWQoKSwgbWV0\nYSk7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRhQ2FjaGVQQ0RhdGFJbXBsKHNt\nLmZldGNoT2JqZWN0SWQoKSwgbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gd2hldGhlciB0aGUgY29udGV4dCBpcyBsb2NraW5nIGxvYWRl\nZCBkYXRhLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNMb2NraW5n\nKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmZXRj\naCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IF9jdHguZ2V0RmV0Y2hD\nb25maWd1cmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIGZldGNoLmdldFJlYWRM\nb2NrTGV2ZWwoKSA+IExvY2tMZXZlbHMuTE9DS19OT05FOwogICAgfQoKICAg\nIC8qKgogICAgICogU3RydWN0dXJlIHVzZWQgZHVyaW5nIHRoZSBjb21taXQg\ncHJvY2VzcyB0byB0cmFjayBjYWNoZSBtb2RpZmljYXRpb25zLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNb2RpZmljYXRpb25zIHsKCiAg\nICAgICAgcHVibGljIGZpbmFsIExpc3Q8UENEYXRhSG9sZGVyPiBhZGRpdGlv\nbnMgPSBuZXcgQXJyYXlMaXN0PFBDRGF0YUhvbGRlcj4oKTsKICAgICAgICBw\ndWJsaWMgZmluYWwgTGlzdDxQQ0RhdGFIb2xkZXI+IG5ld1VwZGF0ZXMgPSBu\nZXcgQXJyYXlMaXN0PFBDRGF0YUhvbGRlcj4oKTsKICAgICAgICBwdWJsaWMg\nZmluYWwgTGlzdDxQQ0RhdGFIb2xkZXI+IGV4aXN0aW5nVXBkYXRlcyA9IG5l\ndyBBcnJheUxpc3Q8UENEYXRhSG9sZGVyPigpOwogICAgICAgIHB1YmxpYyBm\naW5hbCBMaXN0PE9iamVjdD4gZGVsZXRlcyA9IG5ldyBBcnJheUxpc3Q8T2Jq\nZWN0PigpOwogICAgfQoKICAgIC8qKgogICAgICogVXRpbGl0eSBzdHJ1Y3R1\ncmUgaG9sZHMgdGhlIHR1cGxlIG9mIGNhY2hlYWJsZSBpbnN0YW5jZSBhbmQg\naXRzIGNvcnJlc3BvbmRpbmcgc3RhdGUgbWFuYWdlci4gCiAgICAgKgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQQ0RhdGFIb2xkZXIgewoK\nICAgICAgICBwdWJsaWMgZmluYWwgRGF0YUNhY2hlUENEYXRhIHBjZGF0YTsK\nICAgICAgICBwdWJsaWMgZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbTsK\nCiAgICAgICAgcHVibGljIFBDRGF0YUhvbGRlcihEYXRhQ2FjaGVQQ0RhdGEg\ncGNkYXRhLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgICAg\nIHRoaXMucGNkYXRhID0gcGNkYXRhOwogICAgICAgICAgICB0aGlzLnNtID0g\nc207CgkJfQoJfQp9Cgo=\n","encoding":"base64"}

