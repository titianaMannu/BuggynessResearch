{"sha":"7af4cca3e5ea6421fa3643efc03106a8e82e0964","node_id":"MDQ6QmxvYjIwNjM2NDo3YWY0Y2NhM2U1ZWE2NDIxZmEzNjQzZWZjMDMxMDZhOGU4MmUwOTY0","size":23924,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7af4cca3e5ea6421fa3643efc03106a8e82e0964","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5M\naW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkFic3RyYWN0UXVlcnlDYWNoZS5FdmljdFBvbGljeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2NrTGV2ZWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlJlc3Vs\ndFNoYXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9y\nZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0\nb3JlUXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4\ncHMuQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNzaW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLkxpc3RSZXN1bHRPYmpl\nY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9w\nLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwoKaW1wb3J0\nIHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEEge0BsaW5rIFN0b3JlUXVl\ncnl9IGltcGxlbWVudGF0aW9uIHRoYXQgY2FjaGVzIHRoZSBPSURzIGludm9s\ndmVkIGluCiAqIHRoZSBxdWVyeSwgYW5kIGNhbiBkZXRlcm1pbmUgd2hldGhl\nciBvciBub3QgdGhlIHF1ZXJ5IGhhcyBiZWVuIGRpcnRpZWQuCiAqCiAqIEBh\ndXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBzaW5jZSAwLjIuNS4wCiAqLwpw\ndWJsaWMgY2xhc3MgUXVlcnlDYWNoZVN0b3JlUXVlcnkKICAgIGltcGxlbWVu\ndHMgU3RvcmVRdWVyeSB7CgogICAgcHJpdmF0ZSBmaW5hbCBTdG9yZVF1ZXJ5\nIF9xdWVyeTsKICAgIHByaXZhdGUgZmluYWwgUXVlcnlDYWNoZSBfY2FjaGU7\nCiAgICBwcml2YXRlIFN0b3JlQ29udGV4dCBfc2N0eDsKICAgIHByaXZhdGUg\nTWV0YURhdGFSZXBvc2l0b3J5IF9yZXBvczsKCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyBpbnN0YW5jZSB0aGF0IGRlbGVnYXRlcyB0byA8Y29kZT5x\ndWVyeTwvY29kZT4gaWYgbm8KICAgICAqIGNhY2hlZCByZXN1bHRzIGFyZSBh\ndmFpbGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeUNhY2hlU3RvcmVR\ndWVyeShTdG9yZVF1ZXJ5IHF1ZXJ5LCBRdWVyeUNhY2hlIGNhY2hlKSB7CiAg\nICAgICAgX3F1ZXJ5ID0gcXVlcnk7CiAgICAgICAgX2NhY2hlID0gY2FjaGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHtAbGluayBRdWVy\neUNhY2hlfSB0aGF0IHRoaXMgb2JqZWN0IGlzIGFzc29jaWF0ZWQgd2l0aC4K\nICAgICAqLwogICAgcHVibGljIFF1ZXJ5Q2FjaGUgZ2V0Q2FjaGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9jYWNoZTsKICAgIH0KCiAgICAvKioKICAgICAqIERl\nbGVnYXRlLgogICAgICovCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBnZXREZWxl\nZ2F0ZSgpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5OwogICAgfQoKICAgIC8q\nKgogICAgICogTG9vayBpbiB0aGUgcXVlcnkgY2FjaGUgZm9yIGEgcmVzdWx0\nIGZvciB0aGUgZ2l2ZW4gcXVlcnkKICAgICAqIGtleS4gT25seSBsb29rIGlm\nIHRoaXMgcXVlcnkgaXMgYmVpbmcgZXhlY3V0ZWQgb3V0c2lkZSBhCiAgICAg\nKiB0cmFuc2FjdGlvbiBvciBpbiBhIHRyYW5zYWN0aW9uIHdpdGggSWdub3Jl\nQ2hhbmdlcyBzZXQgdG8gdHJ1ZQogICAgICogb3IgaW4gYSB0cmFuc2FjdGlv\nbiB3aXRoIElnbm9yZUNoYW5nZXMgc2V0IHRvIGZhbHNlIGJ1dCBpbiB3aGlj\naAogICAgICogbm9uZSBvZiB0aGUgY2xhc3NlcyBpbnZvbHZlZCBpbiB0aGlz\nIHF1ZXJ5IGhhdmUgYmVlbiB0b3VjaGVkLgogICAgICogIENhY2hpbmcgaXMg\nbm90IHVzZWQgd2hlbiB1c2luZyBvYmplY3QgbG9ja2luZy4KICAgICAqIFRo\naXMgaXMgYmVjYXVzZSB3ZSBtdXN0IG9idGFpbiBsb2NrcyBvbiB0aGUKICAg\nICAqIGRhdGEsIGFuZCBpdCBpcyBsaWtlbHkgdGhhdCBtYWtpbmcgbiB0cmlw\ncyB0byB0aGUgZGF0YWJhc2UgdG8KICAgICAqIG1ha2UgdGhlIGxvY2tzIHdp\nbGwgYmUgc2xvd2VyIHRoYW4gcnVubmluZyB0aGUgcXVlcnkgYWdhaW5zdAog\nICAgICogdGhlIGRhdGFiYXNlLgogICAgICogIElmIHRoZSBmZXRjaCBjb25m\naWd1cmF0aW9uIGhhcyBxdWVyeSBjYWNoaW5nIGRpc2FibGVkLAogICAgICog\ndGhlbiB0aGlzIG1ldGhvZCByZXR1cm5zIDxjb2RlPm51bGw8L2NvZGU+Lgog\nICAgICogIFJldHVybiB0aGUgbGlzdCBpZiB3ZSBtZWV0IHRoZSBhYm92ZSBj\ncml0ZXJpYSBhbmQgaWYgYSBsaXN0CiAgICAgKiBpcyBmb3VuZCBmb3IgPGNv\nZGU+cWs8L2NvZGU+LiBFbHNlLCByZXR1cm4KICAgICAqIDxjb2RlPm51bGw8\nL2NvZGU+LgogICAgICogIFRoaXMgaW1wbGVtZW50YXRpb24gbWVhbnMgdGhh\ndCBxdWVyaWVzIGFnYWluc3QgdGhlIGNhY2hlCiAgICAgKiBhcmUgb2YgUkVB\nRF9DT01NSVRURUQgaXNvbGF0aW9uIGxldmVsLiBJdCdkIGJlIG5pY2UgdG8g\nc3VwcG9ydAogICAgICogUkVBRF9TRVJJQUxJWkFCTEUgLS0gdG8gZG8gc28s\nIHdlJ2QganVzdCByZXR1cm4gZmFsc2Ugd2hlbiBpbgogICAgICogYSB0cmFu\nc2FjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PE9iamVjdD4gY2hl\nY2tDYWNoZShRdWVyeUtleSBxaykgewogICAgICAgIGlmIChxayA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2ggPSBnZXRDb250ZXh0KCkuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgaWYgKCFmZXRjaC5nZXRRdWVyeUNhY2hlRW5h\nYmxlZCgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\nZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpID4gTG9ja0xldmVscy5MT0NLX05P\nTkUpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBnZXQg\ndGhlIGNhY2hlZCBkYXRhCiAgICAgICAgUXVlcnlSZXN1bHQgcmVzID0gX2Nh\nY2hlLmdldChxayk7CiAgICAgICAgaWYgKHJlcyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsgICAgICAgIAogICAgICAgIGlmIChyZXMuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuZW1wdHlM\naXN0KCk7CgogICAgICAgIC8vIHRoaXMgaWYgYmxvY2sgaXMgaW52b2tlZCBp\nZiB0aGUgZXZpY3RPblRpbWVzdGFtcCBpcyBzZXQgdG8gdHJ1ZQogICAgICAg\nIGlmIChfY2FjaGUgaW5zdGFuY2VvZiBBYnN0cmFjdFF1ZXJ5Q2FjaGUpIHsK\nICAgICAgICAgICAgQWJzdHJhY3RRdWVyeUNhY2hlIHFjYWNoZSA9IChBYnN0\ncmFjdFF1ZXJ5Q2FjaGUpIF9jYWNoZTsKICAgICAgICAgICAgaWYgKHFjYWNo\nZS5nZXRFdmljdFBvbGljeSgpID09IEV2aWN0UG9saWN5LlRJTUVTVEFNUCkg\newogICAgICAgICAgICAgICAgU2V0PFN0cmluZz4gY2xhc3NOYW1lcyA9IHFr\nLmdldEFjZXNzUGF0aENsYXNzTmFtZXMoKTsKICAgICAgICAgICAgICAgIExp\nc3Q8U3RyaW5nPiBrZXlMaXN0ID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7\nICAgICAgCiAgICAgICAgICAgICAgICBrZXlMaXN0LmFkZEFsbChjbGFzc05h\nbWVzKTsKCiAgICAgICAgICAgICAgICBMaXN0PExvbmc+IHRpbWVzdGFtcHMg\nPSAKICAgICAgICAgICAgICAgICAgICBxY2FjaGUuZ2V0QWxsRW50aXR5VGlt\nZXN0YW1wKGtleUxpc3QpOwogICAgICAgICAgICAgICAgbG9uZyBxdWVyeVRT\nID0gcmVzLmdldFRpbWVzdGFtcCgpOwogICAgICAgICAgICAgICAgaWYgKHRp\nbWVzdGFtcHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGZvciAo\nTG9uZyB0czogdGltZXN0YW1wcykgewogICAgICAgICAgICAgICAgICAgICAg\nICAvLyBpZiB0aGlzIGlzIHRydWUgd2UgaGF2ZSB0byBldmljdCB0aGUgcXVl\ncnkgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZyb20gY2FjaGUKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXJ5VFMgPCB0cykgeyAKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHFjYWNoZS5yZW1vdmUocWspOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGludCBwcm9qcyA9IGdldENvbnRleHQoKS5nZXRQcm9qZWN0aW9uQWxp\nYXNlcygpLmxlbmd0aDsKICAgICAgICBpZiAocHJvanMgPT0gMCkgewogICAg\nICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGRhdGEgY2FjaGUgY29udGFpbnMg\ndGhlIG9pZHMgZm9yIHRoZSBxdWVyeSByZXN1bHQ7CiAgICAgICAgICAgIC8v\nIGlmIGl0IGRvZXNuJ3QsIHRoZW4gdXNpbmcgdGhlIHJlc3VsdCBjb3VsZCBi\nZSBzbG93ZXIgdGhhbiBub3QKICAgICAgICAgICAgLy8gdXNpbmcgaXQgYmVj\nYXVzZSBvZiB0aGUgaW5kaXZpZHVhbCBieS1vaWQgbG9va3VwcwogICAgICAg\nICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEo\nZ2V0Q29udGV4dCgpLgogICAgICAgICAgICAgICAgZ2V0Q2FuZGlkYXRlVHlw\nZSgpLCBfc2N0eC5nZXRDbGFzc0xvYWRlcigpLCB0cnVlKTsKICAgICAgICAg\nICAgaWYgKG1ldGEuZ2V0RGF0YUNhY2hlKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgQml0U2V0IGlkeHMg\nPSBtZXRhLmdldERhdGFDYWNoZSgpLmNvbnRhaW5zQWxsKHJlcyk7CgogICAg\nICAgICAgICAvLyBldmVudHVhbGx5IHdlIHNob3VsZCBvcHRpbWl6ZSB0aGlz\nIHRvIGZpZ3VyZSBvdXQgaG93IG1hbnkgb2JqZWN0cwogICAgICAgICAgICAv\nLyB0aGUgY2FjaGUgaXMgbWlzc2luZyBhbmQgaWYgb25seSBhIGZldyBkbyBh\nIGJ1bGsgZmV0Y2ggZm9yIHRoZW0KICAgICAgICAgICAgaW50IGxlbiA9IGlk\neHMubGVuZ3RoKCk7CiAgICAgICAgICAgIGlmIChsZW4gPCByZXMuc2l6ZSgp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgICAgICBp\nZiAoIWlkeHMuZ2V0KGkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IENhY2hlZExpc3Qo\ncmVzLCBwcm9qcyAhPSAwLCBfc2N0eCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXcmFwIHRoZSByZXN1bHQgb2JqZWN0IHByb3ZpZGVyIHJldHVybmVkIGJ5\nIG91ciBkZWxlZ2F0ZSBpbiBhCiAgICAgKiBjYWNoaW5nIHByb3ZpZGVyLgog\nICAgICovCiAgICBwcml2YXRlIFJlc3VsdE9iamVjdFByb3ZpZGVyIHdyYXBS\nZXN1bHQoUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wLAogICAgICAgIFF1ZXJ5\nS2V5IGtleSkgewogICAgICAgIGlmIChrZXkgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHJvcDsKICAgICAgICByZXR1cm4gbmV3IENhY2hpbmdSZXN1\nbHRPYmplY3RQcm92aWRlcihyb3AsIGdldENvbnRleHQoKS4KICAgICAgICAg\nICAgZ2V0UHJvamVjdGlvbkFsaWFzZXMoKS5sZW5ndGggPiAwLCBrZXkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29weSBhIHByb2plY3Rpb24gZWxlbWVu\ndCBmb3IgY2FjaGluZyAvIHJldHVybmluZy4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgT2JqZWN0IGNvcHlQcm9qZWN0aW9uKE9iamVjdCBvYmosIFN0\nb3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHN3aXRjaCAoSmF2YVR5\ncGVzLmdldFR5cGVDb2RlKG9iai5nZXRDbGFzcygpKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CWVRFX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9P\nQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVD\nSU1BTDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG9iajsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFU\nRToKICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIG9iaikuY2xvbmUo\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAgICAg\nICAgICAgICAgcmV0dXJuICgoTG9jYWxlKSBvYmopLmNsb25lKCk7CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAob2JqIGluc3Rh\nbmNlb2YgQ2FjaGVkT2JqZWN0SWQpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGZyb21PYmplY3RJZCgoKENhY2hlZE9iamVjdElkKSBvYmopLm9pZCwg\nY3R4KTsKICAgICAgICAgICAgICAgIE9iamVjdCBvaWQgPSBjdHguZ2V0T2Jq\nZWN0SWQob2JqKTsKICAgICAgICAgICAgICAgIGlmIChvaWQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENhY2hlZE9iamVjdElk\nKG9pZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9iamVj\ndCBiYXNlZCBvbiBpdHMgY2FjaGVkIG9pZC4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgT2JqZWN0IGZyb21PYmplY3RJZChPYmplY3Qgb2lkLCBTdG9y\nZUNvbnRleHQgc2N0eCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIE9iamVjdCBvYmogPSBz\nY3R4LmZpbmQob2lkLCBudWxsLCBudWxsLCBudWxsLCAwKTsKICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3RO\nb3RGb3VuZEV4Y2VwdGlvbihvaWQpOwogICAgICAgIHJldHVybiBvYmo7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAgICAg\nIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBfcXVlcnk7CiAgICB9CgogICAgcHVibGljIFF1ZXJ5Q29udGV4dCBnZXRD\nb250ZXh0KCkgewogICAgICAgIHJldHVybiBfcXVlcnkuZ2V0Q29udGV4dCgp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbnRleHQoUXVlcnlDb250\nZXh0IHFjdHgpIHsKICAgICAgICBfcXVlcnkuc2V0Q29udGV4dChxY3R4KTsK\nICAgICAgICBfc2N0eCA9IHFjdHguZ2V0U3RvcmVDb250ZXh0KCk7CiAgICAg\nICAgX3JlcG9zID0gX3NjdHguZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gc2V0UXVlcnkoT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgcmV0dXJu\nIF9xdWVyeS5zZXRRdWVyeShxdWVyeSk7CiAgICB9CgogICAgcHVibGljIEZp\nbHRlckxpc3RlbmVyIGdldEZpbHRlckxpc3RlbmVyKFN0cmluZyB0YWcpIHsK\nICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldEZpbHRlckxpc3RlbmVyKHRhZyk7\nCiAgICB9CgogICAgcHVibGljIEFnZ3JlZ2F0ZUxpc3RlbmVyIGdldEFnZ3Jl\nZ2F0ZUxpc3RlbmVyKFN0cmluZyB0YWcpIHsKICAgICAgICByZXR1cm4gX3F1\nZXJ5LmdldEFnZ3JlZ2F0ZUxpc3RlbmVyKHRhZyk7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBuZXdDb21waWxhdGlvbktleSgpIHsKICAgICAgICByZXR1\ncm4gX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9uS2V5KCk7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBuZXdDb21waWxhdGlvbigpIHsKICAgICAgICByZXR1cm4g\nX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9uKCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgcG9wdWxhdGVGcm9tQ29tcGlsYXRpb24oT2JqZWN0IGNvbXApIHsKICAg\nICAgICBfcXVlcnkucG9wdWxhdGVGcm9tQ29tcGlsYXRpb24oY29tcCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCkg\newogICAgICAgIF9xdWVyeS5pbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0RhdGFTdG9yZUV4ZWN1\ndGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzRGF0YVN0\nb3JlRXhlY3V0aW9uKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1\nZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKTsKICAgIH0KCiAgICBw\ndWJsaWMgRXhlY3V0b3IgbmV3SW5NZW1vcnlFeGVjdXRvcihDbGFzc01ldGFE\nYXRhIG1ldGEsIGJvb2xlYW4gc3VicykgewogICAgICAgIHJldHVybiBfcXVl\ncnkubmV3SW5NZW1vcnlFeGVjdXRvcihtZXRhLCBzdWJzKTsKICAgIH0KCiAg\nICBwdWJsaWMgRXhlY3V0b3IgbmV3RGF0YVN0b3JlRXhlY3V0b3IoQ2xhc3NN\nZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1YnMpIHsKICAgICAgICBFeGVjdXRv\nciBleCA9IF9xdWVyeS5uZXdEYXRhU3RvcmVFeGVjdXRvcihtZXRhLCBzdWJz\nKTsKICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5Q2FjaGVFeGVjdXRvcihleCwg\nbWV0YSwgc3VicywKICAgICAgICAgICAgICAgICAgICAgIGdldENvbnRleHQo\nKS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNBYnN0cmFjdEV4ZWN1dG9ycygpIHsKICAgICAg\nICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzQWJzdHJhY3RFeGVjdXRvcnMoKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0NhbmRpZGF0ZVR5\ncGUoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5yZXF1aXJlc0NhbmRpZGF0\nZVR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc1Bh\ncmFtZXRlckRlY2xhcmF0aW9ucygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5\nLnJlcXVpcmVzUGFyYW1ldGVyRGVjbGFyYXRpb25zKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMo\nKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zdXBwb3J0c1BhcmFtZXRlckRl\nY2xhcmF0aW9ucygpOwogICAgfQogCiAgICBwdWJsaWMgT2JqZWN0IGV2YWx1\nYXRlKE9iamVjdCB2YWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMs\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIHJl\ndHVybiBfcXVlcnkuZXZhbHVhdGUodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsg\nICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICAqIENhY2hpbmcgZXhlY3V0\nb3IuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFF1ZXJ5Q2Fj\naGVFeGVjdXRvcgogICAgICAgIGltcGxlbWVudHMgRXhlY3V0b3IgewoKICAg\nICAgICBwcml2YXRlIGZpbmFsIEV4ZWN1dG9yIF9leDsKICAgICAgICBwcml2\nYXRlIGZpbmFsIENsYXNzPD8+IF9jYW5kaWRhdGU7CiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBib29sZWFuIF9zdWJzOwogICAgICAgIHByaXZhdGUgZmluYWwg\nRmV0Y2hDb25maWd1cmF0aW9uIF9mYzsKCiAgICAgICAgcHVibGljIFF1ZXJ5\nQ2FjaGVFeGVjdXRvcihFeGVjdXRvciBleCwgQ2xhc3NNZXRhRGF0YSBtZXRh\nLAogICAgICAgICAgICBib29sZWFuIHN1YnMsIEZldGNoQ29uZmlndXJhdGlv\nbiBmYykgewogICAgICAgICAgICBfZXggPSBleDsKICAgICAgICAgICAgX2Nh\nbmRpZGF0ZSA9IChtZXRhID09IG51bGwpID8gbnVsbCA6IG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBfc3VicyA9IHN1YnM7CiAgICAg\nICAgICAgIF9mYyA9IGZjOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJl\nc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVRdWVyeShTdG9yZVF1ZXJ5IHEs\nIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgUmFuZ2UgcmFuZ2UpIHsK\nICAgICAgICAgICAgUXVlcnlDYWNoZVN0b3JlUXVlcnkgY3EgPSAoUXVlcnlD\nYWNoZVN0b3JlUXVlcnkpIHE7CiAgICAgICAgICAgIFF1ZXJ5S2V5IGtleSA9\nIFF1ZXJ5S2V5Lm5ld0luc3RhbmNlKGNxLmdldENvbnRleHQoKSwKICAgICAg\nICAgICAgICAgIF9leC5pc1BhY2tpbmcocSksIHBhcmFtcywgX2NhbmRpZGF0\nZSwgX3N1YnMsIHJhbmdlLnN0YXJ0LCAKICAgICAgICAgICAgICAgIHJhbmdl\nLmVuZCk7CiAgICAgICAgICAgIExpc3Q8T2JqZWN0PiBjYWNoZWQgPSBjcS5j\naGVja0NhY2hlKGtleSk7CiAgICAgICAgICAgIGlmIChjYWNoZWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdFJlc3VsdE9iamVj\ndFByb3ZpZGVyKGNhY2hlZCk7CgogICAgICAgICAgICBSZXN1bHRPYmplY3RQ\ncm92aWRlciByb3AgPSBfZXguZXhlY3V0ZVF1ZXJ5KGNxLmdldERlbGVnYXRl\nKCksCiAgICAgICAgICAgICAgICBwYXJhbXMsIHJhbmdlKTsKICAgICAgICAg\nICAgaWYgKF9mYy5nZXRRdWVyeUNhY2hlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGNxLndyYXBSZXN1bHQocm9wLCBrZXkpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gcm9wOwogICAgICAg\nIH0KICAgICAgICAKICAgICAgICBwdWJsaWMgUXVlcnlFeHByZXNzaW9uc1td\nIGdldFF1ZXJ5RXhwcmVzc2lvbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0UXVlcnlFeHByZXNzaW9ucygpOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogQ2xlYXIgdGhlIGNhY2hlZCBxdWVyaWVzIGFzc29j\naWF0ZWQgd2l0aCB0aGUgYWNjZXNzIHBhdGgKICAgICAgICAgKiBjbGFzc2Vz\nIGluIHRoZSBxdWVyeS4gVGhpcyBpcyBkb25lIHdoZW4gYnVsayBvcGVyYXRp\nb25zCiAgICAgICAgICogKHN1Y2ggYXMgZGVsZXRlcyBvciB1cGRhdGVzKSBh\ncmUgcGVyZm9ybWVkIHNvIHRoYXQgdGhlCiAgICAgICAgICogY2FjaGUgcmVt\nYWlucyB1cC10by1kYXRlLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUg\ndm9pZCBjbGVhckFjY2Vzc1BhdGgoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIGlmIChxID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgICAgICBDbGFzc01ldGFEYXRhW10gY21kID0gZ2V0QWNjZXNzUGF0\naE1ldGFEYXRhcyhxKTsKICAgICAgICAgICAgaWYgKGNtZCA9PSBudWxsIHx8\nIGNtZC5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGNsYXNzZXMgPSBuZXcgQXJyYXlM\naXN0PENsYXNzPD8+PihjbWQubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjbWQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBjbGFzc2VzLmFkZChjbWRbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpKTsKCiAg\nICAgICAgICAgIC8vIGV2aWN0IGZyb20gdGhlIHF1ZXJ5IGNhY2hlCiAgICAg\nICAgICAgIFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5IGNxID0gKFF1ZXJ5Q2FjaGVT\ndG9yZVF1ZXJ5KSBxOwogICAgICAgICAgICBjcS5nZXRDYWNoZSgpLm9uVHlw\nZXNDaGFuZ2VkKG5ldyBUeXBlc0NoYW5nZWRFdmVudAogICAgICAgICAgICAg\nICAgKHEuZ2V0Q29udGV4dCgpLCBjbGFzc2VzKSk7CgogICAgICAgICAgICAv\nLyBldmljdCBmcm9tIHRoZSBkYXRhIGNhY2hlCiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY21kLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBpZiAoY21kW2ldLmdldERhdGFDYWNoZSgpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgY21kW2ldLmdldERhdGFDYWNoZSgpLnJlbW92ZUFs\nbCgKICAgICAgICAgICAgICAgICAgICAgICAgY21kW2ldLmdldERlc2NyaWJl\nZFR5cGUoKSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBOdW1iZXIgZXhlY3V0ZURlbGV0ZShTdG9yZVF1ZXJ5IHEs\nIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIF9leC5leGVjdXRlRGVsZXRlKHVud3JhcChxKSwg\ncGFyYW1zKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nICAgIGNsZWFyQWNjZXNzUGF0aChxKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIE51bWJlciBleGVjdXRlVXBkYXRlKFN0b3Jl\nUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gX2V4LmV4ZWN1dGVVcGRhdGUodW53\ncmFwKHEpLCBwYXJhbXMpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgY2xlYXJBY2Nlc3NQYXRoKHEpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0\nb3JlQWN0aW9ucyhTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAg\nICAgICAgICAgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuIEVN\nUFRZX1NUUklOR1M7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCB2\nYWxpZGF0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgX2V4LnZhbGlk\nYXRlKHVud3JhcChxKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1\nYmxpYyB2b2lkIGdldFJhbmdlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFy\nYW1zLCBSYW5nZSByYW5nZSkgewogICAgICAgICAgICBfZXguZ2V0UmFuZ2Uo\ncSwgcGFyYW1zLCByYW5nZSk7IAogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIE9iamVjdCBnZXRPcmRlcmluZ1ZhbHVlKFN0b3JlUXVlcnkgcSwgT2JqZWN0\nW10gcGFyYW1zLAogICAgICAgICAgICBPYmplY3QgcmVzdWx0T2JqZWN0LCBp\nbnQgb3JkZXJJbmRleCkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldE9y\nZGVyaW5nVmFsdWUodW53cmFwKHEpLCBwYXJhbXMsIHJlc3VsdE9iamVjdCwK\nICAgICAgICAgICAgICAgIG9yZGVySW5kZXgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW5bXSBnZXRBc2NlbmRpbmcoU3RvcmVRdWVyeSBx\nKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0QXNjZW5kaW5nKHVud3Jh\ncChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1Bh\nY2tpbmcoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXgu\naXNQYWNraW5nKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgU3RyaW5nIGdldEFsaWFzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gX2V4LmdldEFsaWFzKHVud3JhcChxKSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0UmVzdWx0Q2xhc3MoU3RvcmVR\ndWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0UmVzdWx0Q2xh\nc3ModW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBSZXN1\nbHRTaGFwZTw/PiBnZXRSZXN1bHRTaGFwZShTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9leC5nZXRSZXN1bHRTaGFwZShxKTsKICAgICAg\nICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIFN0cmluZ1tdIGdldFByb2pl\nY3Rpb25BbGlhc2VzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1\ncm4gX2V4LmdldFByb2plY3Rpb25BbGlhc2VzKHVud3JhcChxKSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3M8Pz5bXSBnZXRQcm9qZWN0aW9u\nVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXgu\nZ2V0UHJvamVjdGlvblR5cGVzKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldEFjY2Vzc1BhdGhNZXRh\nRGF0YXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXgu\nZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyh1bndyYXAocSkpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBnZXRPcGVyYXRpb24oU3RvcmVRdWVyeSBx\nKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0T3BlcmF0aW9uKHVud3Jh\ncChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Fn\nZ3JlZ2F0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9l\neC5pc0FnZ3JlZ2F0ZSh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaGFzR3JvdXBpbmcoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBfZXguaGFzR3JvdXBpbmcodW53cmFwKHEpKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBMaW5rZWRNYXAgZ2V0UGFyYW1l\ndGVyVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0UGFyYW1ldGVyVHlwZXModW53cmFwKHEpKTsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgcHVibGljIE9iamVjdFtdIHRvUGFyYW1ldGVyQXJy\nYXkoU3RvcmVRdWVyeSBxLCBNYXAgdXNlclBhcmFtcykgewogICAgICAgICAg\nICByZXR1cm4gX2V4LnRvUGFyYW1ldGVyQXJyYXkocSwgdXNlclBhcmFtcyk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTWFwIGdldFVwZGF0ZXMoU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0VXBkYXRl\ncyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0\naWMgU3RvcmVRdWVyeSB1bndyYXAoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIHJldHVybiAoKFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KSBxKS5nZXREZWxl\nZ2F0ZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlc3Vs\ndCBsaXN0IGltcGxlbWVudGF0aW9uIGZvciBhIGNhY2hlZCBxdWVyeSByZXN1\nbHQuIFBhY2thZ2UtcHJvdGVjdGVkCiAgICAgKiBmb3IgdGVzdGluZy4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBDYWNoZWRMaXN0IGV4dGVu\nZHMgQWJzdHJhY3RMaXN0PE9iamVjdD4KICAgICAgICBpbXBsZW1lbnRzIFNl\ncmlhbGl6YWJsZSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlSZXN1\nbHQgX3JlczsKICAgICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX3Byb2o7\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdG9yZUNvbnRleHQgX3NjdHg7Cgog\nICAgICAgIHB1YmxpYyBDYWNoZWRMaXN0KFF1ZXJ5UmVzdWx0IHJlcywgYm9v\nbGVhbiBwcm9qLCBTdG9yZUNvbnRleHQgY3R4KSB7CiAgICAgICAgICAgIF9y\nZXMgPSByZXM7CiAgICAgICAgICAgIF9wcm9qID0gcHJvajsKICAgICAgICAg\nICAgX3NjdHggPSBjdHg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2Jq\nZWN0IGdldChpbnQgaWR4KSB7CiAgICAgICAgICAgIGlmICghX3Byb2opCiAg\nICAgICAgICAgICAgICByZXR1cm4gZnJvbU9iamVjdElkKF9yZXMuZ2V0KGlk\neCksIF9zY3R4KTsKCiAgICAgICAgICAgIE9iamVjdFtdIGNhY2hlZCA9IChP\nYmplY3RbXSkgX3Jlcy5nZXQoaWR4KTsKICAgICAgICAgICAgaWYgKGNhY2hl\nZCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgICAgIE9iamVjdFtdIHVuY2FjaGVkID0gbmV3IE9iamVjdFtjYWNoZWQu\nbGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjYWNo\nZWQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICB1bmNhY2hlZFtpXSA9\nIGNvcHlQcm9qZWN0aW9uKGNhY2hlZFtpXSwgX3NjdHgpOwogICAgICAgICAg\nICByZXR1cm4gdW5jYWNoZWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\naW50IHNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnNpemUoKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Qgd3JpdGVSZXBsYWNl\nKCkKICAgICAgICAgICAgdGhyb3dzIE9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXlMaXN0PE9iamVjdD4odGhp\ncyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQSB3cmFwcGVy\nIGFyb3VuZCBhIHtAbGluayBSZXN1bHRPYmplY3RQcm92aWRlcn0gdGhhdCBi\ndWlsZHMgdXAgYSBsaXN0IG9mCiAgICAgKiBhbGwgdGhlIE9JRHMgaW4gdGhp\ncyBsaXN0IGFuZCByZWdpc3RlcnMgdGhhdCBsaXN0IHdpdGggdGhlCiAgICAg\nKiBxdWVyeSBjYWNoZS4gQWJhbmRvbnMgbW9uaXRvcmluZyBhbmQgcmVnaXN0\nZXJpbmcgaWYgb25lIG9mIHRoZSBjbGFzc2VzCiAgICAgKiBpbiB0aGUgYWNj\nZXNzIHBhdGggaXMgbW9kaWZpZWQgd2hpbGUgdGhlIHF1ZXJ5IHJlc3VsdHMg\nYXJlIGJlaW5nIGxvYWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBD\nYWNoaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIKICAgICAgICBpbXBsZW1lbnRz\nIFJlc3VsdE9iamVjdFByb3ZpZGVyLCBUeXBlc0NoYW5nZWRMaXN0ZW5lciB7\nCgogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0T2JqZWN0UHJvdmlkZXIg\nX3JvcDsKICAgICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX3Byb2o7CiAg\nICAgICAgcHJpdmF0ZSBmaW5hbCBRdWVyeUtleSBfcWs7CiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBUcmVlTWFwPEludGVnZXIsT2JqZWN0PiBfZGF0YSA9IG5l\ndyBUcmVlTWFwPEludGVnZXIsT2JqZWN0PigpOwogICAgICAgIHByaXZhdGUg\nYm9vbGVhbiBfbWFpbnRhaW5DYWNoZSA9IHRydWU7CiAgICAgICAgcHJpdmF0\nZSBpbnQgX3BvcyA9IC0xOwoKICAgICAgICAvLyB1c2VkIHRvIGRldGVybWlu\nZSBsaXN0IHNpemUgd2l0aG91dCBuZWNlc3NhcmlseSBjYWxsaW5nIHNpemUo\nKSwKICAgICAgICAvLyB3aGljaCBtYXkgcmVxdWlyZSBhIERCIHRyaXAgb3Ig\ncmV0dXJuIEludGVnZXIuTUFYX1ZBTFVFCiAgICAgICAgcHJpdmF0ZSBpbnQg\nX21heCA9IC0xOwogICAgICAgIHByaXZhdGUgaW50IF9zaXplID0gSW50ZWdl\nci5NQVhfVkFMVUU7CgogICAgICAgIC8qKgogICAgICAgICAqIENvbnN0cnVj\ndG9yLiBTdXBwbHkgZGVsZWdhdGUgcmVzdWx0IHByb3ZpZGVyIGFuZCBvdXIg\ncXVlcnkga2V5LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBDYWNoaW5n\nUmVzdWx0T2JqZWN0UHJvdmlkZXIoUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9w\nLAogICAgICAgICAgICBib29sZWFuIHByb2osIFF1ZXJ5S2V5IGtleSkgewog\nICAgICAgICAgICBfcm9wID0gcm9wOwogICAgICAgICAgICBfcHJvaiA9IHBy\nb2o7CiAgICAgICAgICAgIF9xayA9IGtleTsKICAgICAgICAgICAgX2NhY2hl\nLmFkZFR5cGVzQ2hhbmdlZExpc3RlbmVyKHRoaXMpOwogICAgICAgIH0KCiAg\nICAgICAgLyoqCiAgICAgICAgICogU3RvcCBjYWNoaW5nLgogICAgICAgICAq\nLwogICAgICAgIHByaXZhdGUgdm9pZCBhYm9ydENhY2hpbmcoKSB7CiAgICAg\nICAgICAgIGlmICghX21haW50YWluQ2FjaGUpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICAvLyB0aGlzIGNhbiBiZSBjYWxsZWQgdmlh\nIGFuIGV2ZW50IGZyb20gYW5vdGhlciB0aHJlYWQKICAgICAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICAvLyBpdCdzIGlt\ncG9ydGFudCB0aGF0IHdlIHNldCB0aGlzIGZsYWcgZmlyc3Qgc28gdGhhdCBh\nbnkKICAgICAgICAgICAgICAgIC8vIHN1YnNlcXVlbnQgY2FsbHMgdG8gdGhp\ncyBvYmplY3QgYXJlIGJ5cGFzc2VkLgogICAgICAgICAgICAgICAgX21haW50\nYWluQ2FjaGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9jYWNoZS5yZW1v\ndmVUeXBlc0NoYW5nZWRMaXN0ZW5lcih0aGlzKTsKICAgICAgICAgICAgICAg\nIF9kYXRhLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIENoZWNrIHdoZXRoZXIgd2UndmUgYnVmZmVy\nZWQgYWxsIHJlc3VsdHMsIHdoaWxlIG9wdGlvbmFsbHkgYWRkaW5nCiAgICAg\nICAgICogdGhlIGdpdmVuIHJlc3VsdC4KICAgICAgICAgKi8KICAgICAgICBw\ncml2YXRlIHZvaWQgY2hlY2tGaW5pc2hlZChPYmplY3Qgb2JqLCBib29sZWFu\nIHJlc3VsdCkgewogICAgICAgICAgICAvLyB0aGlzIGNhbiBiZSBjYWxsZWQg\nYXQgdGhlIHNhbWUgdGltZSBhcyBhYm9ydENhY2hpbmcgdmlhCiAgICAgICAg\nICAgIC8vIGEgdHlwZXMgY2hhbmdlZCBldmVudAogICAgICAgICAgICBib29s\nZWFuIGZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICAgICAgaWYgKF9tYWludGFpbkNhY2hl\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBJbnRlZ2VyIGluZGV4ID0gTnVtYmVycy52YWx1\nZU9mKF9wb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV9kYXRh\nLmNvbnRhaW5zS2V5KGluZGV4KSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgT2JqZWN0IGNhY2hlZDsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjYWNoZWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZWxzZSBpZiAoIV9wcm9qKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNhY2hlZCA9IF9zY3R4LmdldE9iamVjdElkKG9iaik7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBPYmplY3RbXSBhcnIgPSAoT2JqZWN0W10p\nIG9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Rb\nXSBjcCA9IG5ldyBPYmplY3RbYXJyLmxlbmd0aF07CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcnIubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNwW2ldID0gY29weVByb2plY3Rpb24oYXJyW2ldLCBfc2N0eCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkID0gY3A7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoY2FjaGVkICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgX2RhdGEucHV0KGluZGV4LCBjYWNoZWQpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGZpbmlzaGVkID0gX3NpemUgPT0gX2RhdGEu\nc2l6ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoZmluaXNoZWQpIHsKICAgICAgICAgICAgICAgIC8vIGFu\nIGFib3J0Q2FjaGluZyBjYWxsIGNhbiBzbmVhayBpbiBoZXJlIHZpYSBvbkV4\ncGlyZTsgdGhlCiAgICAgICAgICAgICAgICAvLyBjYWNoZSBpcyBsb2NrZWQg\nZHVyaW5nIGV2ZW50IGZpcmluZ3MsIHNvIHRoZSBsb2NrIGhlcmUgd2lsbAog\nICAgICAgICAgICAgICAgLy8gd2FpdCBmb3IgaXQgKG9yIHdpbGwgZm9yY2Ug\ndGhlIG5leHQgZmlyaW5nIHRvIHdhaXQpCiAgICAgICAgICAgICAgICBfY2Fj\naGUud3JpdGVMb2NrKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBkaWRuJ3QgYWJvcnQKICAg\nICAgICAgICAgICAgICAgICBpZiAoX21haW50YWluQ2FjaGUpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgUXVlcnlSZXN1bHQgcmVzID0gbnVsbDsKICAg\nICAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBuZXcgUXVlcnlSZXN1\nbHQoX3FrLCBfZGF0YS52YWx1ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZXMuc2V0VGltZXN0YW1wKFN5c3RlbS5jdXJyZW50VGltZU1p\nbGxpcygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICBfY2FjaGUucHV0KF9xaywgcmVzKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLndyaXRlVW5sb2Nr\nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNjZXNz\nKCkgewogICAgICAgICAgICByZXR1cm4gX3JvcC5zdXBwb3J0c1JhbmRvbUFj\nY2VzcygpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3Blbigp\nCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBf\ncm9wLm9wZW4oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Qg\nZ2V0UmVzdWx0T2JqZWN0KCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIE9iamVjdCBvYmogPSBfcm9wLmdldFJlc3VsdE9i\namVjdCgpOwogICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG9iaiwgdHJ1ZSk7\nCiAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBuZXh0KCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIF9wb3MrKzsKICAgICAgICAgICAgYm9vbGVh\nbiBuZXh0ID0gX3JvcC5uZXh0KCk7CiAgICAgICAgICAgIGlmICghbmV4dCAm\nJiBfcG9zID09IF9tYXggKyAxKSB7CiAgICAgICAgICAgICAgICBfc2l6ZSA9\nIF9wb3M7CiAgICAgICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG51bGwsIGZh\nbHNlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuZXh0ICYmIF9wb3MgPiBf\nbWF4KQogICAgICAgICAgICAgICAgX21heCA9IF9wb3M7CiAgICAgICAgICAg\nIHJldHVybiBuZXh0OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gYWJzb2x1dGUoaW50IHBvcykKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIF9wb3MgPSBwb3M7CiAgICAgICAgICAgIGJv\nb2xlYW4gdmFsaWQgPSBfcm9wLmFic29sdXRlKHBvcyk7CiAgICAgICAgICAg\nIGlmICghdmFsaWQgJiYgX3BvcyA9PSBfbWF4ICsgMSkgewogICAgICAgICAg\nICAgICAgX3NpemUgPSBfcG9zOwogICAgICAgICAgICAgICAgY2hlY2tGaW5p\nc2hlZChudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFs\naWQgJiYgX3BvcyA+IF9tYXgpCiAgICAgICAgICAgICAgICBfbWF4ID0gX3Bv\nczsKICAgICAgICAgICAgcmV0dXJuIHZhbGlkOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBzaXplKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIGlmIChfc2l6ZSAhPSBJbnRlZ2VyLk1BWF9W\nQUxVRSkKICAgICAgICAgICAgICAgIHJldHVybiBfc2l6ZTsKICAgICAgICAg\nICAgaW50IHNpemUgPSBfcm9wLnNpemUoKTsKICAgICAgICAgICAgX3NpemUg\nPSBzaXplOwogICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG51bGwsIGZhbHNl\nKTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCByZXNldCgpCiAgICAgICAgICAgIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgICAgICBfcm9wLnJlc2V0KCk7CiAgICAgICAgICAg\nIF9wb3MgPSAtMTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNs\nb3NlKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIGFib3J0Q2FjaGluZygpOwogICAgICAgICAgICBfcm9wLmNsb3NlKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBoYW5kbGVDaGVja2Vk\nRXhjZXB0aW9uKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIF9yb3AuaGFu\nZGxlQ2hlY2tlZEV4Y2VwdGlvbihlKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIG9uVHlwZXNDaGFuZ2VkKFR5cGVzQ2hhbmdlZEV2ZW50IGV2\nKSB7CiAgICAgICAgICAgIGlmIChfcWsuY2hhbmdlSW52YWxpZGF0ZXNRdWVy\neShldi5nZXRUeXBlcygpKSkKICAgICAgICAgICAgICAgIGFib3J0Q2FjaGlu\nZygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0cnVjdCB0\nbyByZWNvZ25pemUgY2FjaGVkIG9pZHMuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIENhY2hlZE9iamVjdElkIHsKCiAgICAgICAgcHVibGlj\nIGZpbmFsIE9iamVjdCBvaWQ7CgogICAgICAgIHB1YmxpYyBDYWNoZWRPYmpl\nY3RJZCAoT2JqZWN0IG9pZCkKICAgICAgICB7CiAgICAgICAgICAgIHRoaXMu\nb2lkID0gb2lkOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

