{"sha":"719d09e77cfab525cf33ec614f4c1193c0b39302","node_id":"MDQ6QmxvYjIwNjM2NDo3MTlkMDllNzdjZmFiNTI1Y2YzM2VjNjE0ZjRjMTE5M2MwYjM5MzAy","size":14013,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/719d09e77cfab525cf33ec614f4c1193c0b39302","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEu\naW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBv\ncnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5CeXRlY29kZVdyaXRlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5KYXZhVmVyc2lvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkZpbGVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQWNjZXNzQ29kZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhdGVkQ2xhc3NlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFzczsKCi8qKgogKiBSZWRl\nZmluZXMgdGhlIG1ldGhvZCBib2RpZXMgb2YgZXhpc3RpbmcgdW5lbmhhbmNl\nZCBjbGFzc2VzIHRvIG1ha2UgdGhlbQogKiBub3RpZnkgc3RhdGUgbWFuYWdl\ncnMgb2YgbXV0YXRpb25zLgogKgogKiBAc2luY2UgMS4wLjAKICovCnB1Ymxp\nYyBjbGFzcyBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyIHsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UoCiAgICAgICAgTWFuYWdlZENsYXNzU3ViY2xhc3Nlci5jbGFzcyk7\nCgogICAgLyoqCiAgICAgKiBGb3IgZWFjaCBlbGVtZW50IGluIDxjb2RlPmNs\nYXNzZXM8L2NvZGU+LCBjcmVhdGVzIGFuZCByZWdpc3RlcnMgYQogICAgICog\nbmV3IHN1YmNsYXNzIHRoYXQgaW1wbGVtZW50cyB7QGxpbmsgUGVyc2lzdGVu\nY2VDYXBhYmxlfSwgYW5kIHByZXBhcmVzCiAgICAgKiBPcGVuSlBBIHRvIGhh\nbmRsZSBuZXcgaW5zdGFuY2VzIG9mIHRoZSB1bmVuaGFuY2VkIHR5cGUuIElm\nIHRoaXMgaXMKICAgICAqIGludm9rZWQgaW4gYSBKYXZhIDYgZW52aXJvbm1l\nbnQsIHRoaXMgbWV0aG9kIHdpbGwgcmVkZWZpbmUgdGhlIG1ldGhvZHMKICAg\nICAqIGZvciBlYWNoIGNsYXNzIGluIHRoZSBhcmd1bWVudCBsaXN0IHN1Y2gg\ndGhhdCBmaWVsZCBhY2Nlc3NlcyBhcmUKICAgICAqIGludGVyY2VwdGVkIGlu\nLWxpbmUuIElmIGludm9rZWQgaW4gYSBKYXZhIDUgZW52aXJvbm1lbnQsIHRo\naXMKICAgICAqIHJlZGVmaW5pdGlvbiBpcyBub3QgcG9zc2libGU7IGluIHRo\nZXNlIGNvbnRleHRzLCB3aGVuIHVzaW5nIGZpZWxkCiAgICAgKiBhY2Nlc3Ms\nIE9wZW5KUEEgd2lsbCBuZWVkIHRvIGRvIHN0YXRlIGNvbXBhcmlzb25zIHRv\nIGRldGVjdCBhbnkgY2hhbmdlCiAgICAgKiB0byBhbnkgaW5zdGFuY2UgYXQg\nYW55IHRpbWUsIGFuZCB3aGVuIHVzaW5nIHByb3BlcnR5IGFjY2VzcywgT3Bl\nbkpQQQogICAgICogd2lsbCBuZWVkIHRvIGRvIHN0YXRlIGNvbXBhcmlzb25z\nIHRvIGRldGVjdCBjaGFuZ2VzIHRvIG5ld2x5IGluc2VydGVkCiAgICAgKiBp\nbnN0YW5jZXMgYWZ0ZXIgYSBmbHVzaCBoYXMgYmVlbiBjYWxsZWQuCiAgICAg\nKgogICAgICogQHJldHVybiB0aGUgbmV3IHN1YmNsYXNzZXMsIG9yIDxjb2Rl\nPm51bGw8L2NvZGU+IGlmIDxjb2RlPmNsYXNzZXM8L2NvZGU+CiAgICAgKiBp\ncyA8Y29kZT5udWxsPC9jb2RlPi4KICAgICAqIEB0aHJvd3MgVXNlckV4Y2Vw\ndGlvbiBpZiA8Y29kZT5jb25mPC9jb2RlPiByZXF1aXJlcyBidWlsZC10aW1l\nCiAgICAgKiBlbmhhbmNlbWVudCBhbmQgPGNvZGU+Y2xhc3NlczwvY29kZT4g\naW5jbHVkZXMgdW5lbmhhbmNlZCB0eXBlcy4KICAgICAqCiAgICAgKiBAc2lu\nY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBMaXN0PENsYXNz\nPD8+PiBwcmVwYXJlVW5lbmhhbmNlZENsYXNzZXMoCiAgICAgICAgZmluYWwg\nT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBmaW5hbCBDb2xs\nZWN0aW9uPD8gZXh0ZW5kcyBDbGFzczw/Pj4gY2xhc3NlcywKICAgICAgICBm\naW5hbCBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAoY2xh\nc3NlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpZiAoY2xhc3Nlcy5zaXplKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwoKICAgICAgICBMb2cgbG9nID0g\nY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0Up\nOwogICAgICAgIGlmIChjb25mLmdldFJ1bnRpbWVVbmVuaGFuY2VkQ2xhc3Nl\nc0NvbnN0YW50KCkgIT0gUnVudGltZVVuZW5oYW5jZWRDbGFzc2VzTW9kZXMu\nU1VQUE9SVEVEKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+\nIHVuZW5oYW5jZWQgPSBuZXcgQXJyYXlMaXN0PENsYXNzPD8+PigpOwogICAg\nICAgICAgICBmb3IgKENsYXNzPD8+IGNscyA6IGNsYXNzZXMpCiAgICAgICAg\nICAgICAgICBpZiAoIVBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKGNscykpCiAgICAgICAgICAgICAgICAgICAgdW5lbmhhbmNl\nZC5hZGQoY2xzKTsKICAgICAgICAgICAgaWYgKHVuZW5oYW5jZWQuc2l6ZSgp\nID4gMCkgewogICAgICAgICAgICAgICAgaWYgKFBDRW5oYW5jZXJBZ2VudC5n\nZXRMb2FkU3VjY2Vzc2Z1bCgpID09IHRydWUpIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgdGhlIGVuaGFuY2VyIGhhcyBiZWVu\nIHJhbiBidXQgd2UKICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIHNvbWUg\ndW5lbmhhbmNlZCBjbGFzc2VzLiBUaGlzIGNhbiBoYXBwZW4gaWYgYW4KICAg\nICAgICAgICAgICAgICAgICAvLyBlbnRpdHkgaXMgbG9hZGVkIGJ5IHRoZSBK\nVk0gYmVmb3JlIHRoZSBFbnRpdHlNYW5nZXIKICAgICAgICAgICAgICAgICAg\nICAvLyB3YXMgY3JlYXRlZC4gV2FybiB0aGUgdXNlci4KICAgICAgICAgICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiZW50aXRpZXMtbG9h\nZGVkLWJlZm9yZS1lbSIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShNYW5hZ2VkQ2xhc3NT\ndWJjbGFzc2VyLmNsYXNzLmdldE5hbWUoKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiLnByZXBhcmVVbmVuaGFuY2VkQ2xhc3NlcygpIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiIC0gVGhlIGZvbGxvd2luZyBj\nbGFzc2VzIGFyZSB1bmVuaGFuY2VkICIKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgdW5lbmhhbmNlZC50b1N0cmluZygpKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBN\nZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJydW50aW1lLW9wdGltaXphdGlvbi1k\naXNhYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgdW5lbmhhbmNlZCk7CiAg\nICAgICAgICAgICAgICBpZiAoY29uZi5nZXRSdW50aW1lVW5lbmhhbmNlZENs\nYXNzZXNDb25zdGFudCgpCiAgICAgICAgICAgICAgICAgICAgPT0gUnVudGlt\nZVVuZW5oYW5jZWRDbGFzc2VzTW9kZXMuV0FSTikKICAgICAgICAgICAgICAg\nICAgICBsb2cud2Fybihtc2cpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKG1zZyk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgfQoKICAgICAgICBib29sZWFuIHJlZGVmaW5lID0gQ2xhc3NSZWRlZmlu\nZXIuY2FuUmVkZWZpbmVDbGFzc2VzKGxvZyk7CiAgICAgICAgaWYgKHJlZGVm\naW5lKQogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgiZW5oYW5jZS1h\nbmQtc3ViY2xhc3MtYW5kLXJlZGVmLXN0YXJ0IiwgY2xhc3NlcykpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoImVuaGFu\nY2UtYW5kLXN1YmNsYXNzLW5vLXJlZGVmLXN0YXJ0IiwgIGNsYXNzZXMpKTsK\nCiAgICAgICAgZmluYWwgTWFwPENsYXNzPD8+LCBieXRlW10+IG1hcCA9IG5l\ndyBIYXNoTWFwPENsYXNzPD8+LCBieXRlW10+KCk7CiAgICAgICAgZmluYWwg\nTGlzdDxDbGFzczw/Pj4gc3VicyA9IG5ldyBBcnJheUxpc3Q8Q2xhc3M8Pz4+\nKGNsYXNzZXMuc2l6ZSgpKTsKICAgICAgICBmaW5hbCBMaXN0PENsYXNzPD8+\nPiBpbnRzID0gbmV3IEFycmF5TGlzdDxDbGFzczw/Pj4oY2xhc3Nlcy5zaXpl\nKCkpOwogICAgICAgIFNldDxDbGFzczw/Pj4gdW5zcGVjaWZpZWQgPSBudWxs\nOwogICAgICAgIGZvciAoQ2xhc3M8Pz4gY2xzIDogY2xhc3NlcykgewogICAg\nICAgICAgICBmaW5hbCBDbGFzczw/PiBjID0gY2xzOwogICAgICAgICAgICBm\naW5hbCBQQ0VuaGFuY2VyIGVuaGFuY2VyID0gbmV3IFBDRW5oYW5jZXIoY29u\nZiwgY2xzKTsgCgogICAgICAgICAgICBlbmhhbmNlci5zZXRCeXRlY29kZVdy\naXRlcihuZXcgQnl0ZWNvZGVXcml0ZXIoKSB7CiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCB3cml0ZShCQ0NsYXNzIGJjKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgICAgIE1hbmFnZWRDbGFzc1N1YmNsYXNz\nZXIud3JpdGUoYmMsIGVuaGFuY2VyLCBtYXAsIGMsIHN1YnMsIGludHMpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAg\naWYgKHJlZGVmaW5lKSB7CiAgICAgICAgICAgICAgICBlbmhhbmNlci5zZXRS\nZWRlZmluZSh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbmhh\nbmNlci5zZXRDcmVhdGVTdWJjbGFzcyh0cnVlKTsKICAgICAgICAgICAgZW5o\nYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKHRydWUpOwoKICAgICAg\nICAgICAgLy8gc2V0IHRoaXMgYmVmb3JlIGVuaGFuY2VtZW50IGFzIHdlbGwg\nYXMgYWZ0ZXIgc2luY2UgZW5oYW5jZW1lbnQKICAgICAgICAgICAgLy8gdXNl\ncyBhIGRpZmZlcmVudCBtZXRhZGF0YSByZXBvc2l0b3J5LCBhbmQgdGhlIG1l\ndGFkYXRhIGNvbmZpZwogICAgICAgICAgICAvLyBtYXR0ZXJzIGluIHRoZSBl\nbmhhbmNlbWVudCBjb250cmFjdC4gSW4gb3JkZXIgdG8gYXZvaWQgYSAKICAg\nICAgICAgICAgLy8gTnVsbFBvaW50ZXJFeGNlcHRpb24sIGNoZWNrIGZvciBu\nbyBtZXRhZGF0YSBhbmQgdGhyb3cgYW4KICAgICAgICAgICAgLy8gZXhjZXB0\naW9uIGlmIG5vbmUgZXhpc3RzLiBPdGhlcndpc2UsIGRvbid0IGRvIGFueSB3\nYXJuaW5nIGhlcmUsCiAgICAgICAgICAgIC8vIHNpbmNlIHdlJ2xsIGlzc3Vl\nIHdhcm5pbmdzIHdoZW4gd2UgZG8gdGhlIGZpbmFsIG1ldGFkYXRhCiAgICAg\nICAgICAgIC8vIHJlY29uZmlndXJhdGlvbiBhdCB0aGUgZW5kIG9mIHRoaXMg\nbWV0aG9kLgogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBlbmhh\nbmNlci5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAobWV0YSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLW1ldGEiLCBjbHMpKS5zZXRGYXRhbCh0cnVl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25maWd1cmVNZXRhRGF0\nYShtZXRhLCBjb25mLCByZWRlZmluZSwgZmFsc2UpOwoKICAgICAgICAgICAg\ndW5zcGVjaWZpZWQgPSBjb2xsZWN0UmVsYXRlZFVuc3BlY2lmaWVkVHlwZXMo\nZW5oYW5jZXIuZ2V0TWV0YURhdGEoKSwgY2xhc3NlcywgdW5zcGVjaWZpZWQp\nOwoKICAgICAgICAgICAgaW50IHJ1blJlc3VsdCA9IGVuaGFuY2VyLnJ1bigp\nOwogICAgICAgICAgICBpZiAocnVuUmVzdWx0ID09IFBDRW5oYW5jZXIuRU5I\nQU5DRV9QQykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBlbmhhbmNlci5yZWNvcmQoKTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAv\nLyBvdXIgaW1wbCBvZiBCeXRlY29kZVdyaXRlciBkb2Vzbid0IHRocm93IElP\nRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVy\nbmFsRXhjZXB0aW9uKGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodW5zcGVjaWZpZWQgIT0gbnVs\nbCAmJiAhdW5zcGVjaWZpZWQuaXNFbXB0eSgpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgidW5zcGVjaWZpZWQtdW5l\nbmhhbmNlZC10eXBlcyIsIGNsYXNzZXMsIHVuc3BlY2lmaWVkKSk7CgogICAg\nICAgIENsYXNzUmVkZWZpbmVyLnJlZGVmaW5lQ2xhc3Nlcyhjb25mLCBtYXAp\nOwogICAgICAgIGZvciAoQ2xhc3M8Pz4gY2xzIDogbWFwLmtleVNldCgpKSB7\nCiAgICAgICAgICAgIHNldEludGVyY2VwdGluZyhjb25mLCBlbnZMb2FkZXIs\nIGNscyk7CiAgICAgICAgICAgIGNvbmZpZ3VyZU1ldGFEYXRhKGNvbmYsIGVu\ndkxvYWRlciwgY2xzLCByZWRlZmluZSk7CiAgICAgICAgfQogICAgICAgIGZv\nciAoQ2xhc3M8Pz4gY2xzIDogc3VicykKICAgICAgICAgICAgY29uZmlndXJl\nTWV0YURhdGEoY29uZiwgZW52TG9hZGVyLCBjbHMsIHJlZGVmaW5lKTsKICAg\nICAgICBmb3IgKENsYXNzPD8+IGNscyA6IGludHMpCiAgICAgICAgICAgIHNl\ndEludGVyY2VwdGluZyhjb25mLCBlbnZMb2FkZXIsIGNscyk7CgogICAgICAg\nIHJldHVybiBzdWJzOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIFNldDxD\nbGFzczw/Pj4gY29sbGVjdFJlbGF0ZWRVbnNwZWNpZmllZFR5cGVzKENsYXNz\nTWV0YURhdGEgbWV0YSwKICAgICAgICBDb2xsZWN0aW9uPD8gZXh0ZW5kcyBD\nbGFzczw/Pj4gY2xhc3NlcywgU2V0PENsYXNzPD8+PiB1bnNwZWNpZmllZCkg\newogICAgICAgIHVuc3BlY2lmaWVkID0gY29sbGVjdFVuc3BlY2lmaWVkVHlw\nZShtZXRhLmdldFBDU3VwZXJjbGFzcygpLCBjbGFzc2VzLAogICAgICAgICAg\nICB1bnNwZWNpZmllZCk7CgogICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBm\nbWQgOiBtZXRhLmdldEZpZWxkcygpKSB7CiAgICAgICAgICAgIGlmIChmbWQu\naXNUcmFuc2llbnQoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICBpZiAoZm1kLmlzVHlwZVBDKCkpCiAgICAgICAgICAgICAgICB1\nbnNwZWNpZmllZCA9IGNvbGxlY3RVbnNwZWNpZmllZFR5cGUoZm1kLmdldFR5\ncGUoKSwgY2xhc3NlcywKICAgICAgICAgICAgICAgICAgICB1bnNwZWNpZmll\nZCk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpICE9IG51bGwg\nJiYgZm1kLmdldEVsZW1lbnQoKS5pc1R5cGVQQygpKQogICAgICAgICAgICAg\nICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5zcGVjaWZpZWRUeXBlKGZtZC5n\nZXRFbGVtZW50KCkuZ2V0VHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGNs\nYXNzZXMsIHVuc3BlY2lmaWVkKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRL\nZXkoKSAhPSBudWxsICYmIGZtZC5nZXRLZXkoKS5pc1R5cGVQQygpKQogICAg\nICAgICAgICAgICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5zcGVjaWZpZWRU\neXBlKGZtZC5nZXRLZXkoKS5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICAg\nICAgY2xhc3NlcywgdW5zcGVjaWZpZWQpOwogICAgICAgICAgICBpZiAoZm1k\nLmdldFZhbHVlKCkgIT0gbnVsbCAmJiBmbWQuZ2V0VmFsdWUoKS5pc1R5cGVQ\nQygpKQogICAgICAgICAgICAgICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5z\ncGVjaWZpZWRUeXBlKGZtZC5nZXRWYWx1ZSgpLmdldFR5cGUoKSwKICAgICAg\nICAgICAgICAgICAgICBjbGFzc2VzLCB1bnNwZWNpZmllZCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB1bnNwZWNpZmllZDsKICAgIH0KCiAgICBwcml2\nYXRlIHN0YXRpYyBTZXQ8Q2xhc3M8Pz4+IGNvbGxlY3RVbnNwZWNpZmllZFR5\ncGUoQ2xhc3M8Pz4gY2xzLAogICAgICAgIENvbGxlY3Rpb248PyBleHRlbmRz\nIENsYXNzPD8+PiBjbGFzc2VzLCBTZXQ8Q2xhc3M8Pz4+IHVuc3BlY2lmaWVk\nKSB7CiAgICAgICAgaWYgKGNscyAhPSBudWxsICYmICFjbGFzc2VzLmNvbnRh\naW5zKGNscykKICAgICAgICAgICAgJiYgIUltcGxIZWxwZXIuaXNNYW5hZ2Vk\nVHlwZShudWxsLCBjbHMpCiAgICAgICAgICAgICYmICFjbHMuaXNJbnRlcmZh\nY2UoKSkgewogICAgICAgICAgICBpZiAodW5zcGVjaWZpZWQgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHVuc3BlY2lmaWVkID0gbmV3IEhhc2hTZXQ8Q2xh\nc3M8Pz4+KCk7CiAgICAgICAgICAgIHVuc3BlY2lmaWVkLmFkZChjbHMpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdW5zcGVjaWZpZWQ7CiAgICB9Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBjb25maWd1cmVNZXRhRGF0YShPcGVu\nSlBBQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIENsYXNzTG9hZGVyIGVu\ndkxvYWRlciwgQ2xhc3M8Pz4gY2xzLCBib29sZWFuIHJlZGVmaW5lQXZhaWxh\nYmxlKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gY29uZi5nZXRN\nZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpCiAgICAgICAgICAgIC5nZXRN\nZXRhRGF0YShjbHMsIGVudkxvYWRlciwgdHJ1ZSk7CiAgICAgICAgY29uZmln\ndXJlTWV0YURhdGEobWV0YSwgY29uZiwgcmVkZWZpbmVBdmFpbGFibGUsIHRy\ndWUpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgY29uZmlndXJl\nTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIE9wZW5KUEFD\nb25maWd1cmF0aW9uIGNvbmYsIGJvb2xlYW4gcmVkZWZpbmVBdmFpbGFibGUs\nIGJvb2xlYW4gd2FybikgewoKICAgICAgICBzZXREZXRhY2hlZFN0YXRlKG1l\ndGEpOwoKICAgICAgICAvLyBJZiB3YXJuICYgKGltcGxpY2l0IGZpZWxkIGFj\nY2VzcyB8IG1peGVkIGFjY2VzcykgJiBub3JlZGVmCiAgICAgICAgaWYgKHdh\ncm4gJiYgKChBY2Nlc3NDb2RlLmlzRmllbGQobWV0YS5nZXRBY2Nlc3NUeXBl\nKCkpCiAgICAgICAgICAgICYmICFtZXRhLmlzTWl4ZWRBY2Nlc3MoKSkgfHwg\nIG1ldGEuaXNNaXhlZEFjY2VzcygpKQogICAgICAgICAgICAmJiAhcmVkZWZp\nbmVBdmFpbGFibGUpIHsKICAgICAgICAgICAgLy8gb25seSB3YXJuIGFib3V0\nIGRlY2xhcmVkIGZpZWxkczsgc3VwZXJjbGFzcyBmaWVsZHMgd2lsbCBiZQog\nICAgICAgICAgICAvLyB3YXJuZWQgYWJvdXQgd2hlbiB0aGUgc3VwZXJjbGFz\ncyBpcyBoYW5kbGVkCiAgICAgICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBm\nbWQgOiBtZXRhLmdldERlY2xhcmVkRmllbGRzKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChBY2Nlc3NDb2RlLmlzUHJvcGVydHkoZm1kLmdldEFjY2Vzc1R5\ncGUoKSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgICAgICBzd2l0Y2ggKGZtZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIHdlIGNhbiBsYXppbHkgbG9hZCB0aGVzZSwgc2lu\nY2Ugd2Ugb3duIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyByZWxh\ndGlvbnNoaXAgY29udGFpbmVyCiAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmICghZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAhKGZtZC5pc1ZlcnNp\nb24oKSB8fCBmbWQuaXNQcmltYXJ5S2V5KCkpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2coCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24u\nTE9HX0VOSEFOQ0UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQoInN1YmNsYXNzZXItZmV0Y2gtZ3JvdXAtb3ZlcnJp\nZGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmbWQuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIHZvaWQgd3JpdGUoQkNDbGFzcyBiYywgUENFbmhhbmNlciBlbmhh\nbmNlciwKICAgICAgICBNYXA8Q2xhc3M8Pz4sIGJ5dGVbXT4gbWFwLCBDbGFz\nczw/PiBjbHMsIExpc3Q8Q2xhc3M8Pz4+IHN1YnMsIExpc3Q8Q2xhc3M8Pz4+\nIGludHMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKCiAgICAgICAg\naWYgKGJjID09IGVuaGFuY2VyLmdldE1hbmFnZWRUeXBlQnl0ZWNvZGUoKSkg\newogICAgICAgICAgICAvLyBpZiBpdCB3YXMgYWxyZWFkeSBkZWZpbmVkLCBk\nb24ndCBwdXQgaXQgaW4gdGhlIG1hcCwKICAgICAgICAgICAgLy8gYnV0IGRv\nIHNldCB0aGUgbWV0YWRhdGEgYWNjb3JkaW5nbHkuCiAgICAgICAgICAgIGlm\nIChlbmhhbmNlci5pc0FscmVhZHlSZWRlZmluZWQoKSkKICAgICAgICAgICAg\nICAgIGludHMuYWRkKGJjLmdldFR5cGUoKSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKEphdmFWZXJzaW9ucy5WRVJTSU9OID49IDUpIHsKICAgICAgICAgICAg\nICAgIG1hcC5wdXQoYmMuZ2V0VHlwZSgpLCBiYy50b0J5dGVBcnJheSgpKTsK\nICAgICAgICAgICAgICAgIGRlYnVnQnl0ZWNvZGVzKGJjKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghZW5oYW5j\nZXIuaXNBbHJlYWR5U3ViY2xhc3NlZCgpKSB7CiAgICAgICAgICAgICAgICBk\nZWJ1Z0J5dGVjb2RlcyhiYyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAg\nICAgICAgIC8vIHRoaXMgaXMgdGhlIG5ldyBzdWJjbGFzcwogICAgICAgICAg\nICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gR2VuZXJhdGVkQ2xhc3Nlcy5n\nZXRNb3N0RGVyaXZlZExvYWRlcigKICAgICAgICAgICAgICAgICAgICBjbHMs\nIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7CiAgICAgICAgICAgICAgICBz\ndWJzLmFkZChHZW5lcmF0ZWRDbGFzc2VzLmxvYWRCQ0NsYXNzKGJjLCBsb2Fk\nZXIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2\nYXRlIHN0YXRpYyB2b2lkIGRlYnVnQnl0ZWNvZGVzKEJDQ2xhc3MgYmMpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgLy8gV3JpdGUgdGhlIGJ5dGVj\nb2RlcyB0byBkaXNrIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMuCiAgICAgICAg\naWYgKCJ0cnVlIi5lcXVhbHMoU3lzdGVtLmdldFByb3BlcnR5KAogICAgICAg\nICAgICBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyLmNsYXNzLmdldE5hbWUoKSAr\nICIuZHVtcEJ5dGVjb2RlcyIpKSkKICAgICAgICB7CiAgICAgICAgICAgIEZp\nbGUgdG1wID0gbmV3IEZpbGUoU3lzdGVtLmdldFByb3BlcnR5KCJqYXZhLmlv\nLnRtcGRpciIpKTsKICAgICAgICAgICAgRmlsZSBkaXIgPSBuZXcgRmlsZSh0\nbXAsICJvcGVuanBhIik7CiAgICAgICAgICAgIGRpciA9IG5ldyBGaWxlKGRp\nciwgInBjc3ViY2xhc3NlcyIpOwogICAgICAgICAgICBkaXIubWtkaXJzKCk7\nCiAgICAgICAgICAgIGRpciA9IEZpbGVzLmdldFBhY2thZ2VGaWxlKGRpciwg\nYmMuZ2V0UGFja2FnZU5hbWUoKSwgdHJ1ZSk7CiAgICAgICAgICAgIEZpbGUg\nZiA9IG5ldyBGaWxlKGRpciwgYmMuZ2V0Q2xhc3NOYW1lKCkgKyAiLmNsYXNz\nIik7CiAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiV3JpdGluZyB0\nbyAiICsgZik7CiAgICAgICAgICAgIGJjLndyaXRlKGYpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldEludGVyY2VwdGlu\nZyhPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIENsYXNzTG9h\nZGVyIGVudkxvYWRlciwgQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpCiAgICAgICAgICAgIC5nZXRNZXRhRGF0YShjbHMsIGVudkxvYWRl\nciwgdHJ1ZSk7CiAgICAgICAgbWV0YS5zZXRJbnRlcmNlcHRpbmcodHJ1ZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUgbWV0YWRhdGEgaXMgY29u\nZmlndXJlZCB0byB1c2UgYSBzeW50aGV0aWMKICAgICAqIGRldGFjaGVkIHN0\nYXRlLCByZXNldCBpdCB0byBub3QgdXNlIGEgZGV0YWNoZWQKICAgICAqIHN0\nYXRlIGZpZWxkLCBzaW5jZSB3ZSBjYW4ndCBhZGQgZmllbGRzIHdoZW4gcmVk\nZWZpbmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBzZXRE\nZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlm\nIChDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMobWV0YS5nZXREZXRh\nY2hlZFN0YXRlKCkpKQogICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3Rh\ndGUobnVsbCk7CiAgICB9Cn0K\n","encoding":"base64"}

