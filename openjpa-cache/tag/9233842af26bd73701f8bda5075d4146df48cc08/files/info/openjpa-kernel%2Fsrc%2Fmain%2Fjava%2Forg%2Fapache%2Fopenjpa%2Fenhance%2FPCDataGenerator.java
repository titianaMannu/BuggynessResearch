{"sha":"b264860a689b728a64132d9d9dcae18a816012fd","node_id":"MDQ6QmxvYjIwNjM2NDpiMjY0ODYwYTY4OWI3MjhhNjQxMzJkOWQ5ZGNhZTE4YTgxNjAxMmZk","size":41853,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b264860a689b728a64132d9d9dcae18a816012fd","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuQWJzdHJhY3RQQ0RhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZldGNoQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3Bl\nbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUENEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3Vy\ncmVudEhhc2hNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5D\nbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklu\ndGVybmFsRXhjZXB0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5CQ0NsYXNz\nOwppbXBvcnQgc2VycC5ieXRlY29kZS5CQ0ZpZWxkOwppbXBvcnQgc2VycC5i\neXRlY29kZS5CQ01ldGhvZDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ29kZTsK\naW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ29uc3RhbnRzOwppbXBvcnQgc2VycC5i\neXRlY29kZS5FeGNlcHRpb25IYW5kbGVyOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5JbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSnVtcEluc3Ry\ndWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Mb29rdXBTd2l0Y2hJbnN0\ncnVjdGlvbjsKCi8qKgogKiBHZW5lcmF0ZXMge0BsaW5rIFBDRGF0YX0gaW5z\ndGFuY2VzIHdoaWNoIGF2b2lkIHByaW1pdGl2ZSB3cmFwcGVycwogKiB0byBv\ncHRpbWl6ZSBtZW1vcnkgdXNlIGFuZCBwZXJmb3JtYW5jZSBhdCB0aGUgY29z\ndCBvZiBzbGlnaHRseSBoaWdoZXIKICogc3RhcnR1cCB0aW1lLgogKgogKiBA\nYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqIEBzaW5jZSAwLjMu\nMgogKi8KcHVibGljIGNsYXNzIFBDRGF0YUdlbmVyYXRvcgogICAgZXh0ZW5k\ncyBEeW5hbWljU3RvcmFnZUdlbmVyYXRvciB7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChQQ0RhdGFHZW5lcmF0b3IuY2xhc3MpOwoKICAgIHByb3Rl\nY3RlZCBzdGF0aWMgZmluYWwgU3RyaW5nIFBPU1RGSVggPSAiJG9wZW5qcGFw\nY2RhdGEiOwoKICAgIHByaXZhdGUgZmluYWwgTWFwPENsYXNzPD8+LCBEeW5h\nbWljU3RvcmFnZT4gX2dlbmVyYXRlZCA9IG5ldyBDb25jdXJyZW50SGFzaE1h\ncDxDbGFzczw/PiwgRHluYW1pY1N0b3JhZ2U+KCk7CiAgICBwcml2YXRlIGZp\nbmFsIE9wZW5KUEFDb25maWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBm\naW5hbCBMb2cgX2xvZzsKCiAgICBwdWJsaWMgUENEYXRhR2VuZXJhdG9yKE9w\nZW5KUEFDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNv\nbmY7CiAgICAgICAgX2xvZyA9IF9jb25mLmdldExvZ0ZhY3RvcnkoKS5nZXRM\nb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25maWd1cmF0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmln\ndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSB7QGxpbmsgUENEYXRhfSBpbnN0YW5jZSBm\nb3IgdGhlIGdpdmVuIG9pZCBhbmQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1\nYmxpYyBQQ0RhdGEgZ2VuZXJhdGVQQ0RhdGEoT2JqZWN0IG9pZCwgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9\nIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgIER5bmFtaWNTdG9y\nYWdlIHN0b3JhZ2UgPSBfZ2VuZXJhdGVkLmdldCh0eXBlKTsKICAgICAgICBp\nZiAoc3RvcmFnZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHN0b3JhZ2UgPSBn\nZW5lcmF0ZVN0b3JhZ2UobWV0YSk7CiAgICAgICAgICAgIF9nZW5lcmF0ZWQu\ncHV0KHR5cGUsIHN0b3JhZ2UpOwogICAgICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9j\nLmdldCgicGNkYXRhLWNyZWF0ZWQiLCB0eXBlLmdldE5hbWUoKSwgbWV0YSkp\nOwogICAgICAgIH0KICAgICAgICBEeW5hbWljUENEYXRhIGRhdGEgPSAoRHlu\nYW1pY1BDRGF0YSkgc3RvcmFnZS5uZXdJbnN0YW5jZSgpOwogICAgICAgIGRh\ndGEuc2V0SWQob2lkKTsKICAgICAgICBkYXRhLnNldFN0b3JhZ2VHZW5lcmF0\nb3IodGhpcyk7CiAgICAgICAgZmluaXNoKGRhdGEsIG1ldGEpOwogICAgICAg\nIHJldHVybiBkYXRhOwogICAgfQoKICAgIC8qKgogICAgICogQWN0dWFsbHkg\nZ2VuZXJhdGUgdGhlIGZhY3RvcnkgaW5zdGFuY2UuCiAgICAgKi8KICAgIHBy\naXZhdGUgRHluYW1pY1N0b3JhZ2UgZ2VuZXJhdGVTdG9yYWdlKENsYXNzTWV0\nYURhdGEgbWV0YSkgewogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInBjZGF0YS1n\nZW5lcmF0ZSIsIG1ldGEpKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZp\nZWxkcyA9IG1ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgaW50W10gdHlwZXMg\nPSBuZXcgaW50W2ZpZWxkcy5sZW5ndGhdOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgdHlwZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHR5cGVz\nW2ldID0gcmVwbGFjZVR5cGUoZmllbGRzW2ldKTsKICAgICAgICByZXR1cm4g\nZ2VuZXJhdGVTdG9yYWdlKHR5cGVzLCBtZXRhKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBlcmZvcm0gYW55IGZpbmFsIGFjdGlvbnMgYmVmb3JlIHRoZSBw\nY2RhdGEgaXMgcmV0dXJuZWQgdG8gY2xpZW50IGNvZGUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIGZpbmlzaChEeW5hbWljUENEYXRhIGRhdGEsIENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgfQoKICAgIHByb3RlY3RlZCBpbnQg\nZ2V0Q3JlYXRlRmllbGRNZXRob2RzKGludCB0eXBlQ29kZSkgewogICAgICAg\nIGlmICh0eXBlQ29kZSA+PSBKYXZhVHlwZXMuT0JKRUNUKQogICAgICAgICAg\nICByZXR1cm4gUE9MSUNZX1NJTEVOVDsKICAgICAgICAvLyBkb24ndCBib3Ro\nZXIgY3JlYXRpbmcgc2V0L2dldDxQcmltaXRpdmU+IG1ldGhvZHMKICAgICAg\nICByZXR1cm4gUE9MSUNZX0VNUFRZOwogICAgfQoKICAgIHByb3RlY3RlZCB2\nb2lkIGRlY2xhcmVDbGFzc2VzKEJDQ2xhc3MgYmMpIHsKICAgICAgICBzdXBl\nci5kZWNsYXJlQ2xhc3NlcyhiYyk7CiAgICAgICAgYmMuZGVjbGFyZUludGVy\nZmFjZShEeW5hbWljUENEYXRhLmNsYXNzKTsKICAgICAgICBiYy5zZXRTdXBl\ncmNsYXNzKEFic3RyYWN0UENEYXRhLmNsYXNzKTsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgZmluYWwgU3RyaW5nIGdldENsYXNzTmFtZShPYmplY3Qgb2JqKSB7\nCiAgICAgICAgcmV0dXJuIGdldFVuaXF1ZU5hbWUoKChDbGFzc01ldGFEYXRh\nKSBvYmopLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGVzIGEgdW5pcXVlIG5hbWUgZm9yIHRoZSBnaXZlbiB0eXBl\nJ3MgcGNkYXRhIGltcGxlbWVudGF0aW9uLgogICAgICovCiAgICBwcm90ZWN0\nZWQgU3RyaW5nIGdldFVuaXF1ZU5hbWUoQ2xhc3M8Pz4gdHlwZSkgewogICAg\nICAgIHJldHVybiB0eXBlLmdldE5hbWUoKSArICIkIiArIFN5c3RlbS5pZGVu\ndGl0eUhhc2hDb2RlKHR5cGUpICsgUE9TVEZJWDsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgZmluYWwgdm9pZCBkZWNvcmF0ZShPYmplY3Qgb2JqLCBCQ0NsYXNz\nIGJjLCBpbnRbXSB0eXBlcykgewogICAgICAgIHN1cGVyLmRlY29yYXRlKG9i\naiwgYmMsIHR5cGVzKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSAo\nQ2xhc3NNZXRhRGF0YSkgb2JqOwoKICAgICAgICBlbmhhbmNlQ29uc3RydWN0\nb3IoYmMpOwogICAgICAgIGFkZEJhc2VGaWVsZHMoYmMpOwogICAgICAgIGFk\nZEltcGxEYXRhTWV0aG9kcyhiYywgbWV0YSk7CiAgICAgICAgYWRkRmllbGRJ\nbXBsRGF0YU1ldGhvZHMoYmMsIG1ldGEpOwogICAgICAgIGFkZFZlcnNpb25N\nZXRob2RzKGJjKTsKICAgICAgICBhZGRHZXRUeXBlKGJjLCBtZXRhKTsKICAg\nICAgICBhZGRMb2FkTWV0aG9kKGJjLCBtZXRhKTsKICAgICAgICBhZGRMb2Fk\nV2l0aEZpZWxkc01ldGhvZChiYywgbWV0YSk7CiAgICAgICAgYWRkU3RvcmVN\nZXRob2RzKGJjLCBtZXRhKTsKICAgICAgICBhZGROZXdFbWJlZGRlZChiYyk7\nCiAgICAgICAgYWRkR2V0RGF0YShiYyk7CiAgICAgICAgZGVjb3JhdGUoYmMs\nIG1ldGEpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwbHkgYWRkaXRpb25h\nbCBkZWNvcmF0aW9uIHRvIGdlbmVyYXRlZCBjbGFzcy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgZGVjb3JhdGUoQkNDbGFzcyBiYywgQ2xhc3NNZXRh\nRGF0YSBtZXRhKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmhhbmNlIGNv\nbnN0cnVjdG9yIHRvIGluaXRpYWxpemUgZmllbGRzCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBlbmhhbmNlQ29uc3RydWN0b3IoQkNDbGFzcyBiYykgewog\nICAgICAgIEJDTWV0aG9kIGNvbnMgPSBiYy5nZXREZWNsYXJlZE1ldGhvZCgi\nPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBjb25zLmdldENvZGUoZmFsc2UpOwogICAgICAgIGNvZGUuYWZ0ZXJMYXN0\nKCk7CiAgICAgICAgY29kZS5wcmV2aW91cygpOwoKICAgICAgICAvLyBwcml2\nYXRlIEJpdFNldCBsb2FkZWQgPSBuZXcgQml0U2V0KCk7CiAgICAgICAgQkNG\naWVsZCBsb2FkZWQgPSBhZGRCZWFuRmllbGQoYmMsICJsb2FkZWQiLCBCaXRT\nZXQuY2xhc3MpOwogICAgICAgIGxvYWRlZC5zZXRGaW5hbCh0cnVlKTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuYW5l\ndygpLnNldFR5cGUoQml0U2V0LmNsYXNzKTsKICAgICAgICBjb2RlLmR1cCgp\nOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShiYy5nZXRGaWVs\nZHMoKS5sZW5ndGgpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZChCaXRTZXQuY2xhc3MsICI8aW5pdD4iLCB2b2lkLmNsYXNzLAog\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAg\nIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChsb2FkZWQpOwoKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhhdmUgdG8g\nbG9hZCB0aGUgdHlwZSBzaW5jZSBpdCBtYXkgbm90IGJlIGF2YWlsYWJsZSB0\nbyB0aGUKICAgICAqIHNhbWUgY2xhc3Nsb2FkZXIgKGkuZS4gcmFyIHZzLiBl\nYXIpLiBUaGUgY29udGV4dCBjbGFzc2xvYWRlcgogICAgICogKGkuZS4gdGhl\nIHVzZXIgYXBwIGNsYXNzbG9hZGVyKSBzaG91bGQgYmUgZmluZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldFR5cGUoQkNDbGFzcyBiYywgQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgQkNGaWVsZCB0eXBlID0gYmMu\nZGVjbGFyZUZpZWxkKCJ0eXBlIiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIHR5\ncGUuc2V0U3RhdGljKHRydWUpOwogICAgICAgIHR5cGUubWFrZVByaXZhdGUo\nKTsKICAgICAgICAvLyBwdWJsaWMgQ2xhc3MgZ2V0VHlwZSgpIHsKICAgICAg\nICBCQ01ldGhvZCBnZXR0ZXIgPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRUeXBl\nIiwgQ2xhc3MuY2xhc3MsIG51bGwpOwogICAgICAgIGdldHRlci5tYWtlUHVi\nbGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gZ2V0dGVyLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgLy8gaWYgKHR5cGUgPT0gbnVsbCkgewogICAgICAgIC8v\nIAkJdHJ5IHsKICAgICAgICAvLyAJCQl0eXBlID0gQ2xhc3MuZm9yTmFtZQog\nICAgICAgIC8vIAkgICAgICAgICAgICAobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkuZ2V0TmFtZSgpLCB0cnVlLAogICAgICAgIC8vIAkgICAgICAgICAgICBU\naHJlYWQuY3VycmVudFRocmVhZCgpLmdldENvbnRleHRDbGFzc0xvYWRlcigp\nKTsKICAgICAgICAvLyAJCX0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRp\nb24gY25mZSkgewogICAgICAgIC8vIAkJCXRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbigpOwogICAgICAgIC8vIAkJfQogICAgICAgIC8vIH0KICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKHR5cGUpOwoKICAgICAgICBD\nb2xsZWN0aW9uPEluc3RydWN0aW9uPiBqdW1wcyA9IG5ldyBMaW5rZWRMaXN0\nPEluc3RydWN0aW9uPigpOwogICAgICAgIGp1bXBzLmFkZChjb2RlLmlmbm9u\nbnVsbCgpKTsKICAgICAgICBFeGNlcHRpb25IYW5kbGVyIGhhbmRsZXIgPSBj\nb2RlLmFkZEV4Y2VwdGlvbkhhbmRsZXIoKTsKCiAgICAgICAgaGFuZGxlci5z\nZXRUcnlTdGFydChjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUKICAgICAgICAg\nICAgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSkpOwogICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChUaHJlYWQuY2xhc3MsICJj\ndXJyZW50VGhyZWFkIiwKICAgICAgICAgICAgVGhyZWFkLmNsYXNzLCBudWxs\nKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoVGhy\nZWFkLmNsYXNzLCAiZ2V0Q29udGV4dENsYXNzTG9hZGVyIiwKICAgICAgICAg\nICAgQ2xhc3NMb2FkZXIuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUuaW52\nb2tlc3RhdGljKCkuc2V0TWV0aG9kKENsYXNzLmNsYXNzLCAiZm9yTmFtZSIs\nIENsYXNzLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgU3RyaW5n\nLmNsYXNzLCBib29sZWFuLmNsYXNzLCBDbGFzc0xvYWRlci5jbGFzcyB9KTsK\nICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKHR5cGUpOwogICAg\nICAgIEluc3RydWN0aW9uIGdvMiA9IGNvZGUuZ28yKCk7CiAgICAgICAganVt\ncHMuYWRkKGdvMik7CiAgICAgICAgaGFuZGxlci5zZXRUcnlFbmQoZ28yKTsK\nICAgICAgICBoYW5kbGVyLnNldENhdGNoKENsYXNzTm90Rm91bmRFeGNlcHRp\nb24uY2xhc3MpOwogICAgICAgIGhhbmRsZXIuc2V0SGFuZGxlclN0YXJ0KHRo\ncm93RXhjZXB0aW9uCiAgICAgICAgICAgIChjb2RlLCBJbnRlcm5hbEV4Y2Vw\ndGlvbi5jbGFzcykpOwogICAgICAgIHNldFRhcmdldChjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKHR5cGUpLCBqdW1wcyk7CiAgICAgICAgY29kZS5hcmV0\ndXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogRGVjbGFyZSBzdGFuZGFyZCBkeW5hbWljIHBjZGF0YSBmaWVs\nZHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRCYXNlRmllbGRzKEJD\nQ2xhc3MgYmMpIHsKICAgICAgICBhZGRCZWFuRmllbGQoYmMsICJpZCIsIE9i\namVjdC5jbGFzcyk7CiAgICAgICAgQkNGaWVsZCBmaWVsZCA9IGFkZEJlYW5G\naWVsZChiYywgInN0b3JhZ2VHZW5lcmF0b3IiLAogICAgICAgICAgICBQQ0Rh\ndGFHZW5lcmF0b3IuY2xhc3MpOwogICAgICAgIGZpZWxkLnNldEFjY2Vzc0Zs\nYWdzKGZpZWxkLmdldEFjY2Vzc0ZsYWdzKCkKICAgICAgICAgICAgfCBDb25z\ndGFudHMuQUNDRVNTX1RSQU5TSUVOVCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgbWV0aG9kcyBmb3IgbG9hZGluZyBhbmQgc3RvcmluZyBjbGFzcy1s\nZXZlbCBpbXBsIGRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRJ\nbXBsRGF0YU1ldGhvZHMoQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7CiAgICAgICAgLy8gdm9pZCBzdG9yZUltcGxEYXRhKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpOwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBiYy5kZWNsYXJl\nTWV0aG9kKCJzdG9yZUltcGxEYXRhIiwgdm9pZC5jbGFzcywKICAgICAgICAg\nICAgbmV3IENsYXNzW117IE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MgfSk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICBCQ0ZpZWxkIGltcGwgPSBudWxsOwogICAgICAgIGlmICghdXNlc0lt\ncGxEYXRhKG1ldGEpKQogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gaWYgKHNtLmlzSW1wbERhdGFD\nYWNoZWFibGUoKSkKICAgICAgICAgICAgLy8gCQlzZXRJbXBsRGF0YShzbS5n\nZXRJbXBsRGF0YSgpKTsKICAgICAgICAgICAgaW1wbCA9IGFkZEJlYW5GaWVs\nZChiYywgImltcGxEYXRhIiwgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nLmNsYXNzLAogICAgICAgICAgICAgICAgImlzSW1wbERhdGFDYWNoZWFibGUi\nLCBib29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgSnVtcEluc3Ry\ndWN0aW9uIGlmaW5zID0gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywKICAgICAg\nICAgICAgICAgICJnZXRJbXBsRGF0YSIsIE9iamVjdC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCgi\nc2V0SW1wbERhdGEiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgaWZpbnMu\nc2V0VGFyZ2V0KGNvZGUudnJldHVybigpKTsKICAgICAgICB9CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHZvaWQgbG9hZEltcGxEYXRh\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIpOwogICAgICAgIG1ldGggPSBiYy5kZWNs\nYXJlTWV0aG9kKCJsb2FkSW1wbERhdGEiLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcyB9\nKTsKICAgICAgICBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGlmICghdXNlc0ltcGxEYXRhKG1ldGEpKQogICAgICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gaWYgKHNt\nLmdldEltcGxEYXRhKCkgPT0gbnVsbCAmJiBpbXBsRGF0YSAhPSBudWxsKQog\nICAgICAgICAgICAvLyAJCXNtLnNldEltcGxEYXRhKGltcGwsIHRydWUpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAiZ2V0SW1wbERh\ndGEiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoaW1wbCk7CiAgICAgICAgICAgIEp1bXBJbnN0\ncnVjdGlvbiBpZmluczIgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChpbXBsKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLAogICAg\nICAgICAgICAgICAgInNldEltcGxEYXRhIiwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MsIGJvb2xlYW4u\nY2xhc3MgfSk7CiAgICAgICAgICAgIEluc3RydWN0aW9uIGlucyA9IGNvZGUu\ndnJldHVybigpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoaW5zKTsK\nICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdldChpbnMpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCBtZXRob2RzIGZvciBsb2FkaW5nIGFuZCBzdG9yaW5nIGNsYXNzLWxl\ndmVsIGltcGwgZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEZp\nZWxkSW1wbERhdGFNZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIC8vIHB1YmxpYyB2b2lkIGxvYWRJbXBsRGF0YShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBpbnQgaSkKICAgICAgICBCQ01ldGhv\nZCBtZXRoID0gYmMuZGVjbGFyZU1ldGhvZCgibG9hZEltcGxEYXRhIiwgdm9p\nZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IE9wZW5KUEFTdGF0\nZU1hbmFnZXIuY2xhc3MsIGludC5jbGFzcyB9KTsKICAgICAgICBtZXRoLm1h\na2VQcml2YXRlKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICBpbnQgY291bnQgPSBjb3VudEltcGxEYXRhRmll\nbGRzKG1ldGEpOwogICAgICAgIEJDRmllbGQgaW1wbCA9IG51bGw7CiAgICAg\nICAgaWYgKGNvdW50ID09IDApCiAgICAgICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBPYmplY3RbXSBmaWVs\nZEltcGwKICAgICAgICAgICAgaW1wbCA9IGJjLmRlY2xhcmVGaWVsZCgiZmll\nbGRJbXBsIiwgT2JqZWN0W10uY2xhc3MpOwogICAgICAgICAgICBpbXBsLm1h\na2VQcml2YXRlKCk7CgogICAgICAgICAgICAvLyBpZiAoZmllbGRJbXBsICE9\nIG51bGwpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChpbXBsKTsKICAg\nICAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51\nbGwoKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgICAg\nICAvLyBPYmplY3Qgb2JqID0gbnVsbDsKICAgICAgICAgICAgaW50IG9iaiA9\nIGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGlmaW5z\nLnNldFRhcmdldChjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpKTsKICAgICAg\nICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChvYmopOwoKICAgICAgICAg\nICAgLy8gZXN0YWJsaXNoIHN3aXRjaCB0YXJnZXQsIHRoZW4gbW92ZSBiZWZv\ncmUgaXQKICAgICAgICAgICAgSW5zdHJ1Y3Rpb24gdGFyZ2V0ID0gY29kZS5h\nbG9hZCgpLnNldExvY2FsKG9iaik7CiAgICAgICAgICAgIGNvZGUucHJldmlv\ndXMoKTsKCiAgICAgICAgICAgIC8vIHN3aXRjaChpKQogICAgICAgICAgICBj\nb2RlLmlsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAgICAgIExvb2t1cFN3\naXRjaEluc3RydWN0aW9uIGxzd2l0Y2ggPSBjb2RlLmxvb2t1cHN3aXRjaCgp\nOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gbWV0YS5n\nZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IGNhY2hlYWJsZSA9IDA7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIXVzZXNJbXBsRGF0YShmaWVs\nZHNbaV0pKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgLy8gY2FzZSB4OiBvYmogPSBmaWVsZEltcGxbeV07IGJyZWFr\nOwogICAgICAgICAgICAgICAgbHN3aXRjaC5hZGRDYXNlKGksIGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCkpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKGltcGwpOwogICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKGNhY2hlYWJsZSsrKTsKICAgICAgICAgICAgICAg\nIGNvZGUuYWFsb2FkKCk7CiAgICAgICAgICAgICAgICBjb2RlLmFzdG9yZSgp\nLnNldExvY2FsKG9iaik7CiAgICAgICAgICAgICAgICBjb2RlLmdvMigpLnNl\ndFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxz\nd2l0Y2guc2V0RGVmYXVsdFRhcmdldCh0YXJnZXQpOwoKICAgICAgICAgICAg\nLy8gaWYgKG9iaiAhPSBudWxsKQogICAgICAgICAgICBjb2RlLm5leHQoKTsg\nICAgLy8ganVtcCBiYWNrIG92ZXIgdGFyZ2V0CiAgICAgICAgICAgIGlmaW5z\nID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CgogICAgICAgICAgICAvLyBzbS5zZXRJbXBsRGF0YShpbmRleCwgaW1w\nbCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCkpOwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFy\nYW0oMSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvYmop\nOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChPcGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLAogICAgICAgICAgICAgICAg\nInNldEltcGxEYXRhIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5l\ndyBDbGFzc1tdeyBpbnQuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsKICAgICAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfQogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwoKICAgICAgICAvLyB2b2lkIHN0b3JlSW1wbERhdGEoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50IGluZGV4LCBib29sZWFuIGxvYWRl\nZCkKICAgICAgICBtZXRoID0gYmMuZGVjbGFyZU1ldGhvZCgic3RvcmVJbXBs\nRGF0YSIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBP\ncGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLCBpbnQuY2xhc3MsIGJvb2xlYW4u\nY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBpZiAoY291bnQgPT0gMCkKICAgICAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIGludCBhcnJJ\nZHggPSAtMTsKICAgICAgICAgICAgLy8gc3dpdGNoKGluZGV4KQogICAgICAg\nICAgICBpbnQgYXJySWR4ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKC0xKTsKICAg\nICAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChhcnJJZHgpOwogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAgICAg\nIExvb2t1cFN3aXRjaEluc3RydWN0aW9uIGxzd2l0Y2ggPSBjb2RlLmxvb2t1\ncHN3aXRjaCgpOwoKICAgICAgICAgICAgLy8gZXN0YWJsaXNoIHN3aXRjaCB0\nYXJnZXQsIHRoZW4gbW92ZSBiZWZvcmUgaXQKICAgICAgICAgICAgSW5zdHJ1\nY3Rpb24gc3dpdGNoVGFyZ2V0ID0gY29kZS5pbG9hZCgpLnNldExvY2FsKGFy\ncklkeCk7CiAgICAgICAgICAgIGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBtZXRhLmdldEZpZWxkcygp\nOwogICAgICAgICAgICBpbnQgY2FjaGVhYmxlID0gMDsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGlmICghdXNlc0ltcGxEYXRhKGZpZWxkc1tpXSkpCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAv\nLyBjYXNlIHg6IGFycklkeCA9IHk7IGJyZWFrOwogICAgICAgICAgICAgICAg\nbHN3aXRjaC5hZGRDYXNlKGksIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShj\nYWNoZWFibGUrKykpOwogICAgICAgICAgICAgICAgY29kZS5pc3RvcmUoKS5z\nZXRMb2NhbChhcnJJZHgpOwogICAgICAgICAgICAgICAgY29kZS5nbzIoKS5z\nZXRUYXJnZXQoc3dpdGNoVGFyZ2V0KTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBsc3dpdGNoLnNldERlZmF1bHRUYXJnZXQoc3dpdGNoVGFyZ2V0KTsK\nICAgICAgICAgICAgY29kZS5uZXh0KCk7ICAgIC8vIHN0ZXAgb3ZlciBzd2l0\nY2ggdGFyZ2V0CgogICAgICAgICAgICAvLyBpZiAoYXJySWR4ICE9IC0xKQog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoLTEpOwogICAg\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmaWNtcG5l\nKCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAg\nLy8gY3JlYXRlIG51bGwgdGFyZ2V0LCB0aGVuIG1vdmUgYmVmb3JlIGl0CiAg\nICAgICAgICAgIEluc3RydWN0aW9uIG51bGxUYXJnZXQgPSBjb2RlLmFsb2Fk\nKCkuc2V0VGhpcygpOwogICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7Cgog\nICAgICAgICAgICAvLyBpZiAobG9hZGVkKQogICAgICAgICAgICBpZmlucy5z\nZXRUYXJnZXQoY29kZS5pbG9hZCgpLnNldFBhcmFtKDIpKTsKICAgICAgICAg\nICAgY29kZS5pZmVxKCkuc2V0VGFyZ2V0KG51bGxUYXJnZXQpOwoKICAgICAg\nICAgICAgLy8gT2JqZWN0IG9iaiA9IHNtLmdldEltcGxEYXRhKGluZGV4KQog\nICAgICAgICAgICBpbnQgb2JqID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgo\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFTdGF0\nZU1hbmFnZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAiZ2V0SW1wbERhdGEi\nLCBPYmplY3QuY2xhc3MsIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAg\nICAgICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwob2JqKTsKCiAgICAg\nICAgICAgIC8vIGlmIChvYmogIT0gbnVsbCkKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKG9iaik7CiAgICAgICAgICAgIGNvZGUuaWZudWxs\nKCkuc2V0VGFyZ2V0KG51bGxUYXJnZXQpOwoKICAgICAgICAgICAgLy8gaWYg\nKGZpZWxkSW1wbCA9PSBudWxsKQogICAgICAgICAgICAvLyAJCWZpZWxkSW1w\nbCA9IG5ldyBPYmplY3RbZmllbGRzXTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKGltcGwpOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZub25u\ndWxsKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShjb3VudCk7CiAg\nICAgICAgICAgIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlwZShPYmplY3QuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoaW1w\nbCk7CgogICAgICAgICAgICAvLyBmaWVsZEltcGxbYXJySWR4XSA9IG9iajsK\nICAgICAgICAgICAgLy8gcmV0dXJuOwogICAgICAgICAgICBpZmlucy5zZXRU\nYXJnZXQoY29kZS5hbG9hZCgpLnNldFRoaXMoKSk7CiAgICAgICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChpbXBsKTsKICAgICAgICAgICAgY29k\nZS5pbG9hZCgpLnNldExvY2FsKGFycklkeCk7CiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvYmopOwogICAgICAgICAgICBjb2RlLmFhc3Rv\ncmUoKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgICAg\nICAvLyBpZiAoZmllbGRJbXBsICE9IG51bGwpCiAgICAgICAgICAgIC8vIAkJ\nZmllbGRJbXBsW2luZGV4XSA9IG51bGw7CiAgICAgICAgICAgIGNvZGUubmV4\ndCgpOyAvLyBzdGVwIG92ZXIgbnVsbFRhcmdldAogICAgICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoaW1wbCk7CiAgICAgICAgICAgIGlmaW5z\nID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmFsb2FkKCku\nc2V0VGhpcygpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKGltcGwpOwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwo\nYXJySWR4KTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwo\nKTsKICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAgICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIH0KICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBtZXRob2RzIGZvciBsb2Fk\naW5nIGFuZCBzdG9yaW5nIHZlcnNpb24gZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgYWRkVmVyc2lvbk1ldGhvZHMoQkNDbGFzcyBiYykgewog\nICAgICAgIC8vIHZvaWQgc3RvcmVWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20pOwogICAgICAgIGFkZEJlYW5GaWVsZChiYywgInZlcnNpb24iLCBP\nYmplY3QuY2xhc3MpOwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBiYy5kZWNs\nYXJlTWV0aG9kKCJzdG9yZVZlcnNpb24iLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcyB9\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIC8vIHZlcnNpb24gPSBzbS5nZXRWZXJzaW9uKCk7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKQog\nICAgICAgICAgICAuc2V0TWV0aG9kKE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xh\nc3MsICJnZXRWZXJzaW9uIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFz\ncywgbnVsbCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKCJ2\nZXJzaW9uIiwgT2JqZWN0LmNsYXNzKTsKICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gdm9pZCBs\nb2FkVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKQogICAgICAgIG1l\ndGggPSBiYy5kZWNsYXJlTWV0aG9kKCJsb2FkVmVyc2lvbiIsIHZvaWQuY2xh\nc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPcGVuSlBBU3RhdGVNYW5h\nZ2VyLmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIGlmIChzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkK\nICAgICAgICAvLyAJCXNtLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xh\nc3MsCiAgICAgICAgICAgICJnZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLCBu\ndWxsKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlm\nbm9ubnVsbCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZCgidmVyc2lvbiIsIE9iamVjdC5jbGFzcyk7\nCiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKQogICAgICAgICAgICAu\nc2V0TWV0aG9kKE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsICJzZXRWZXJz\naW9uIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNv\nZGUudnJldHVybigpKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgYWRkTG9hZE1ldGhvZChCQ0NsYXNzIGJjLCBD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBs\nb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwKICAgICAgICAvLyAJCU9iamVjdCBjb250ZXh0KQogICAgICAg\nIENvZGUgY29kZSA9IGFkZExvYWRNZXRob2QoYmMsIGZhbHNlKTsKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RmllbGRzKCk7CiAg\nICAgICAgQ29sbGVjdGlvbjxJbnN0cnVjdGlvbj4ganVtcHMgPSBuZXcgTGlu\na2VkTGlzdDxJbnN0cnVjdGlvbj4oKTsKICAgICAgICBDb2xsZWN0aW9uPElu\nc3RydWN0aW9uPiBqdW1wczI7CgkJCiAgICAgICAgaW50IGxvY2FsID0gY29k\nZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwo\nbG9jYWwpOwogICAgICAgIGludCBpbnRlciA9IGNvZGUuZ2V0TmV4dExvY2Fs\nc0luZGV4KCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsK\nICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGludGVyKTsKCiAgICAg\nICAgaW50IG9iamVjdENvdW50ID0gMDsKICAgICAgICBib29sZWFuIGludGVy\nbWVkaWF0ZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAganVtcHMyID0gbmV3IExpbmtlZExp\nc3Q8SW5zdHJ1Y3Rpb24+KCk7CiAgICAgICAgICAgIGludGVybWVkaWF0ZSA9\nIHVzZXNJbnRlcm1lZGlhdGUoZm1kc1tpXSk7CiAgICAgICAgICAgIHNldFRh\ncmdldChjb2RlLmFsb2FkKCkuc2V0VGhpcygpLCBqdW1wcyk7CiAgICAgICAg\nICAgIC8vIGlmIChsb2FkZWQuZ2V0KGkpKSBvciAoIWxvYWRlZC5nZXQoaSkp\nIGRlcGVuZGluZyBvbiBpbnRlciByZXNwCiAgICAgICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZCgibG9hZGVkIiwgQml0U2V0LmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAg\nICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQml0U2V0LmNs\nYXNzLCAiZ2V0IiwKICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG5l\ndyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAgIGp1bXBzLmFk\nZChjb2RlLmlmbmUoKSk7CgogICAgICAgICAgICBpZiAoaW50ZXJtZWRpYXRl\nKQogICAgICAgICAgICAgICAgYWRkTG9hZEludGVybWVkaWF0ZShjb2RlLCBp\nLCBvYmplY3RDb3VudCwganVtcHMyLCBpbnRlcik7CiAgICAgICAgICAgIGp1\nbXBzMi5hZGQoY29kZS5nbzIoKSk7CgogICAgICAgICAgICAvLyBpZiAoZmV0\nY2gucmVxdWlyZXNGZXRjaChmbWRzW2ldKSE9RmV0Y2hDb25maWd1cmF0aW9u\nLkZFVENIX05PTkUpCiAgICAgICAgICAgIHNldFRhcmdldChjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMSksIGp1bXBzKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVy\nZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLAog\nICAgICAgICAgICAgICAgImdldE1ldGFEYXRhIiwgQ2xhc3NNZXRhRGF0YS5j\nbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShmbWRzW2ldLmdldEluZGV4KCkpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQ2xhc3NNZXRhRGF0YS5jbGFzcywK\nICAgICAgICAgICAgICAgICJnZXRGaWVsZCIsIEZpZWxkTWV0YURhdGEuY2xh\nc3MsIG5ldyBDbGFzc1tde2ludC5jbGFzc30pOwogICAgICAgICAgICBjb2Rl\nLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZCAoRmV0Y2hDb25maWd1cmF0\naW9uLmNsYXNzLCAKICAgICAgICAgICAgICAgICJyZXF1aXJlc0ZldGNoIiwg\naW50LmNsYXNzLCBuZXcgQ2xhc3NbXXtGaWVsZE1ldGFEYXRhLmNsYXNzfSk7\nCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShGZXRjaENv\nbmZpZ3VyYXRpb24uRkVUQ0hfTk9ORSk7CiAgICAgICAgICAgIGp1bXBzMi5h\nZGQoY29kZS5pZmljbXBlcSgpKTsKICAgICAgICAgICAgYWRkTG9hZChiYywg\nY29kZSwgZm1kc1tpXSwgb2JqZWN0Q291bnQsIGxvY2FsLCBmYWxzZSk7Cgog\nICAgICAgICAgICBqdW1wcyA9IGp1bXBzMjsKICAgICAgICAgICAgaWYgKHJl\ncGxhY2VUeXBlKGZtZHNbaV0pID49IEphdmFUeXBlcy5PQkpFQ1QpCiAgICAg\nICAgICAgICAgICBvYmplY3RDb3VudCsrOwogICAgICAgIH0KICAgICAgICBz\nZXRUYXJnZXQoY29kZS52cmV0dXJuKCksIGp1bXBzKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkTG9hZFdp\ndGhGaWVsZHNNZXRob2QoQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7CiAgICAgICAgQ29kZSBjb2RlID0gYWRkTG9hZE1ldGhvZChiYywgdHJ1\nZSk7CiAgICAgICAgLy8gcHVibGljIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIC8vIAkJRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29ubikKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nQ29sbGVjdGlvbjxJbnN0cnVjdGlvbj4ganVtcHMgPSBuZXcgTGlua2VkTGlz\ndDxJbnN0cnVjdGlvbj4oKTsKICAgICAgICBDb2xsZWN0aW9uPEluc3RydWN0\naW9uPiBqdW1wczI7CiAgICAgICAgaW50IG9iamVjdENvdW50ID0gMDsKICAg\nICAgICBib29sZWFuIGludGVybWVkaWF0ZTsKICAgICAgICBpbnQgbG9jYWwg\nPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRM\nb2NhbChsb2NhbCk7CiAgICAgICAgaW50IGludGVyID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVs\nbCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaW50ZXIpOwoK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAganVtcHMyID0gbmV3IExpbmtlZExpc3Q8SW5zdHJ1\nY3Rpb24+KCk7CiAgICAgICAgICAgIGludGVybWVkaWF0ZSA9IHVzZXNJbnRl\ncm1lZGlhdGUoZm1kc1tpXSk7CiAgICAgICAgICAgIC8vIGlmIChmaWVsZHMu\nZ2V0KGkpKQogICAgICAgICAgICAvLyB7CiAgICAgICAgICAgIC8vIAkJaWYg\nKGxvYWRlZC5nZXQoaSkpCiAgICAgICAgICAgIHNldFRhcmdldChjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMSksIGp1bXBzKTsKICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoQml0U2V0LmNsYXNzLCAiZ2V0IiwKICAg\nICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG5ldyBDbGFzc1tdeyBpbnQu\nY2xhc3MgfSk7CiAgICAgICAgICAgIGp1bXBzMi5hZGQoY29kZS5pZmVxKCkp\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoImxvYWRlZCIsIEJpdFNl\ndC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZShpKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKEJpdFNldC5jbGFzcywgImdldCIsCiAgICAgICAgICAgICAgICBib29s\nZWFuLmNsYXNzLCBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAg\nICAgICBpZiAoaW50ZXJtZWRpYXRlKQogICAgICAgICAgICAgICAganVtcHMu\nYWRkKGNvZGUuaWZlcSgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAganVtcHMyLmFkZChjb2RlLmlmZXEoKSk7CgogICAgICAgICAgICBh\nZGRMb2FkKGJjLCBjb2RlLCBmbWRzW2ldLCBvYmplY3RDb3VudCwgbG9jYWws\nIHRydWUpOwogICAgICAgICAgICBpZiAodXNlc0ltcGxEYXRhKGZtZHNbaV0p\nKSB7CiAgICAgICAgICAgICAgICAvLyBsb2FkSW1wbERhdGEoc20sIGkpOwog\nICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCgibG9hZElt\ncGxEYXRhIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywgaW50LmNsYXNz\nIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBmaWVsZHMuY2xl\nYXIoaSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQml0U2V0\nLmNsYXNzLCAiY2xlYXIiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAg\nbmV3IENsYXNzW10geyBpbnQuY2xhc3MgfSk7CgogICAgICAgICAgICBqdW1w\nczIuYWRkKGNvZGUuZ28yKCkpOwoKICAgICAgICAgICAgaWYgKGludGVybWVk\naWF0ZSkKICAgICAgICAgICAgICAgIHNldFRhcmdldChhZGRMb2FkSW50ZXJt\nZWRpYXRlCiAgICAgICAgICAgICAgICAgICAgKGNvZGUsIGksIG9iamVjdENv\ndW50LCBqdW1wczIsIGludGVyKSwganVtcHMpOwoKICAgICAgICAgICAganVt\ncHMgPSBqdW1wczI7CiAgICAgICAgICAgIGlmIChyZXBsYWNlVHlwZShmbWRz\nW2ldKSA+PSBKYXZhVHlwZXMuT0JKRUNUKQogICAgICAgICAgICAgICAgb2Jq\nZWN0Q291bnQrKzsKICAgICAgICB9CiAgICAgICAgc2V0VGFyZ2V0KGNvZGUu\ndnJldHVybigpLCBqdW1wcyk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZWNsYXJlIGFuZCBzdGFydCB0aGUgYmFz\nZSBsb2FkIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSBDb2RlIGFkZExv\nYWRNZXRob2QoQkNDbGFzcyBiYywgYm9vbGVhbiBmaWVsZHMpIHsKICAgICAg\nICBDbGFzczw/PltdIGFyZ3MgPSBudWxsOwogICAgICAgIGlmIChmaWVsZHMp\nCiAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRl\nTWFuYWdlci5jbGFzcywgQml0U2V0LmNsYXNzLAogICAgICAgICAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uLmNsYXNzLCBPYmplY3QuY2xhc3MgfTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgT3Bl\nbkpQQVN0YXRlTWFuYWdlci5jbGFzcywKICAgICAgICAgICAgICAgIEZldGNo\nQ29uZmlndXJhdGlvbi5jbGFzcywgT2JqZWN0LmNsYXNzIH07CiAgICAgICAg\nQkNNZXRob2QgbG9hZCA9IGJjLmRlY2xhcmVNZXRob2QoImxvYWQiLCB2b2lk\nLmNsYXNzLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBsb2FkLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vbG9hZFZlcnNpb24oc20pOwogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZCgibG9hZFZlcnNpb24iLCB2b2lkLmNsYXNzLAogICAgICAgICAg\nICBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcyB9KTsK\nCiAgICAgICAgLy9sb2FkSW1wbERhdGEoc20pOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCgi\nbG9hZEltcGxEYXRhIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENs\nYXNzW117IE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MgfSk7CiAgICAgICAg\ncmV0dXJuIGNvZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGZp\nZWxkIGxvYWQuCiAgICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1Y3Rpb24gYWRk\nTG9hZChCQ0NsYXNzIGJjLCBDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1k\nLAogICAgICAgIGludCBvYmplY3RDb3VudCwgaW50IGxvY2FsLCBib29sZWFu\nIGZpZWxkcykgewogICAgICAgIGludCBpbmRleCA9IGZtZC5nZXRJbmRleCgp\nOwogICAgICAgIGludCB0eXBlQ29kZSA9IHJlcGxhY2VUeXBlKGZtZCk7CiAg\nICAgICAgSW5zdHJ1Y3Rpb24gZmlyc3Q7CiAgICAgICAgaWYgKHR5cGVDb2Rl\nIDwgSmF2YVR5cGVzLk9CSkVDVCkgewogICAgICAgICAgICAvLyBzbS5zdG9y\nZTx0eXBlPihpLCBmaWVsZDxpPikKICAgICAgICAgICAgQ2xhc3M8Pz4gdHlw\nZSA9IGZvclR5cGUoZm1kLmdldFR5cGVDb2RlKCkpOwogICAgICAgICAgICBm\naXJzdCA9IGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGluZGV4KTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgY29kZS5nZXRm\naWVsZCgpLnNldEZpZWxkKGdldEZpZWxkTmFtZShpbmRleCksIHR5cGUpOwog\nICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChP\ncGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLAogICAgICAgICAgICAgICAgInN0\nb3JlIiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUodHlwZS5nZXROYW1lKCkp\nLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IGlu\ndC5jbGFzcywgdHlwZSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAvLyBmbWQgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGkpOwogICAg\nICAgICAgICBpbnQgb2Zmc2V0ID0gZmllbGRzID8gMSA6IDA7CiAgICAgICAg\nICAgIGZpcnN0ID0gY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBB\nU3RhdGVNYW5hZ2VyLmNsYXNzLAogICAgICAgICAgICAgICAgImdldE1ldGFE\nYXRhIiwgQ2xhc3NNZXRhRGF0YS5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDbGFz\nc01ldGFEYXRhLmNsYXNzLCAiZ2V0RmllbGQiLAogICAgICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YS5jbGFzcywgbmV3IENsYXNzW117IGludC5jbGFzcyB9\nKTsKICAgICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChsb2NhbCk7\nCiAgICAgICAgICAgIC8vIHNtLnN0b3JlRmllbGQoaSwgdG9GaWVsZChzbSwg\nZm1kLCBvYmplY3RzW29iamVjdENvdW50XSwKICAgICAgICAgICAgLy8gCQlm\nZXRjaCwgY29udGV4dCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKGluZGV4KTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwobG9jYWwpOwogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoIm9iamVjdHMiLCBPYmplY3RbXS5jbGFzcyk7\nCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShvYmplY3RD\nb3VudCk7CiAgICAgICAgICAgIGNvZGUuYWFsb2FkKCk7CiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxICsgb2Zmc2V0KTsKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDIgKyBvZmZzZXQpOwogICAgICAg\nICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoYmMuZ2V0TmFt\nZSgpLCAidG9GaWVsZCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3Mu\nZ2V0TmFtZSgpLCB0b1N0cmluZ3MobmV3IENsYXNzW117IAogICAgICAgICAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywgRmllbGRNZXRhRGF0\nYS5jbGFzcywKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgRmV0Y2hD\nb25maWd1cmF0aW9uLmNsYXNzLCBPYmplY3QuY2xhc3MgfSkpOwogICAgICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBB\nU3RhdGVNYW5hZ2VyLmNsYXNzLAogICAgICAgICAgICAgICAgInN0b3JlRmll\nbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117\nIGludC5jbGFzcywgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmlyc3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIGlu\ndGVybWVkaWF0ZSBkYXRhIGlmIHBvc3NpYmxlLgogICAgICovCiAgICBwcml2\nYXRlIEluc3RydWN0aW9uIGFkZExvYWRJbnRlcm1lZGlhdGUoQ29kZSBjb2Rl\nLCBpbnQgaW5kZXgsCiAgICAgICAgaW50IG9iamVjdENvdW50LCBDb2xsZWN0\naW9uPEluc3RydWN0aW9uPiBqdW1wczIsIGludCBpbnRlcikgewogICAgICAg\nIC8vIHsKICAgICAgICAvLyAJCU9iamVjdCBpbnRlciA9IG9iamVjdHNbb2Jq\nZWN0Q291bnRdOwogICAgICAgIEluc3RydWN0aW9uIGZpcnN0ID0gY29kZS5h\nbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoIm9iamVjdHMiLCBPYmplY3RbXS5jbGFzcyk7CiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKG9iamVjdENvdW50KTsKICAgICAgICBj\nb2RlLmFhbG9hZCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwo\naW50ZXIpOwogICAgICAgIC8vIAkJaWYgKGludGVyICE9IG51bGwgJiYgIXNt\nLmdldExvYWRlZCgpLmdldChpbmRleCkpCiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKGludGVyKTsKICAgICAgICBqdW1wczIuYWRkKGNvZGUuaWZu\ndWxsKCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBB\nU3RhdGVNYW5hZ2VyLmNsYXNzLAogICAgICAgICAgICAiZ2V0TG9hZGVkIiwg\nQml0U2V0LmNsYXNzLCBudWxsKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoaW5kZXgpOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChCaXRTZXQuY2xhc3MsICJnZXQiLAogICAgICAgICAgICBi\nb29sZWFuLmNsYXNzLCBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAg\nICAgIGp1bXBzMi5hZGQoY29kZS5pZm5lKCkpOwogICAgICAgIC8vCQkJc20u\nc2V0SW50ZXJtZWRpYXRlKGluZGV4LCBpbnRlcik7CiAgICAgICAgLy8JfSAg\nLy8gZW5kIGVsc2UKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGluZGV4KTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW50ZXIpOwogICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIuY2xhc3MsCiAgICAgICAgICAgICJzZXRJbnRlcm1lZGlhdGUiLCB2\nb2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNz\nLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgcmV0dXJuIGZpcnN0OwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBhZGRTdG9yZU1ldGhvZHMoQkNDbGFzcyBi\nYywgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgLy8gaS5lLiB2b2lk\nIHN0b3JlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMp\nOwogICAgICAgIGFkZFN0b3JlTWV0aG9kKGJjLCBtZXRhLCB0cnVlKTsKICAg\nICAgICAvLyBpLmUuIHZvaWQgc3RvcmUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSk7CiAgICAgICAgYWRkU3RvcmVNZXRob2QoYmMsIG1ldGEsIGZhbHNlKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkU3RvcmVNZXRob2QoQkNDbGFz\ncyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIGJvb2xlYW4gZmll\nbGRzKSB7CiAgICAgICAgQkNNZXRob2Qgc3RvcmU7CiAgICAgICAgaWYgKGZp\nZWxkcykKICAgICAgICAgICAgc3RvcmUgPSBiYy5kZWNsYXJlTWV0aG9kKCJz\ndG9yZSIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywgQml0U2V0LmNsYXNzIH0p\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmUgPSBiYy5kZWNsYXJl\nTWV0aG9kKCJzdG9yZSIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcyB9KTsKICAg\nICAgICBDb2RlIGNvZGUgPSBzdG9yZS5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBpbml0aWFsaXplKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRo\naXMoKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nImluaXRpYWxpemUiLCB2b2lkLmNsYXNzLCBudWxsKTsKCiAgICAgICAgLy8g\nc3RvcmVWZXJzaW9uKHNtKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoInN0b3JlVmVyc2lv\nbiIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPcGVu\nSlBBU3RhdGVNYW5hZ2VyLmNsYXNzIH0pOwoKICAgICAgICAvLyBzdG9yZUlt\ncGxEYXRhKHNtKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoInN0b3JlSW1wbERhdGEiLCB2\nb2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0\nYXRlTWFuYWdlci5jbGFzcyB9KTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBtZXRhLmdldEZpZWxkcygpOwogICAgICAgIENvbGxlY3Rpb248\nSW5zdHJ1Y3Rpb24+IGp1bXBzID0gbmV3IExpbmtlZExpc3Q8SW5zdHJ1Y3Rp\nb24+KCk7CiAgICAgICAgaW50IG9iamVjdENvdW50ID0gMDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKGZpZWxkcykgewogICAgICAgICAgICAgICAgLy8gIGlmIChm\naWVsZHMgIT0gbnVsbCAmJiBmaWVsZHMuZ2V0KGluZGV4KSkKICAgICAgICAg\nICAgICAgIHNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSksIGp1\nbXBzKTsKICAgICAgICAgICAgICAgIGp1bXBzLmFkZChjb2RlLmlmbnVsbCgp\nKTsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsK\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsK\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChCaXRTZXQuY2xhc3MsICJnZXQiLAogICAgICAgICAgICAgICAgICAgIGJv\nb2xlYW4uY2xhc3MsIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAg\nICAgICAgICAgICBqdW1wcy5hZGQoY29kZS5pZmVxKCkpOwogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaWYgKHNtLmdldExvYWRl\nZCgpLmdldChpbmRleCkpKQogICAgICAgICAgICAgICAgc2V0VGFyZ2V0KGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKSwganVtcHMpOwogICAgICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT3BlbkpQQVN0\nYXRlTWFuYWdlci5jbGFzcywKICAgICAgICAgICAgICAgICAgICAiZ2V0TG9h\nZGVkIiwgQml0U2V0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaXRTZXQuY2xhc3MsICJn\nZXQiLAogICAgICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG5ldyBD\nbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICBqdW1wcy5h\nZGQoY29kZS5pZmVxKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFk\nZFN0b3JlKGJjLCBjb2RlLCBmbWRzW2ldLCBvYmplY3RDb3VudCk7CiAgICAg\nICAgICAgIGlmICh1c2VzSW50ZXJtZWRpYXRlKGZtZHNbaV0pKSB7CiAgICAg\nICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZWxzZUlucyA9IGNvZGUuZ28y\nKCk7CiAgICAgICAgICAgICAgICAvLyBlbHNlIGlmICghbG9hZGVkLmdldChp\nbmRleCkpCiAgICAgICAgICAgICAgICBzZXRUYXJnZXQoY29kZS5hbG9hZCgp\nLnNldFRoaXMoKSwganVtcHMpOwogICAgICAgICAgICAgICAganVtcHMuYWRk\nKGVsc2VJbnMpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKCJsb2FkZWQiLCBCaXRTZXQuY2xhc3MpOwogICAgICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEJpdFNldC5jbGFz\ncywgImdldCIsCiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywg\nbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGp1\nbXBzLmFkZChjb2RlLmlmbmUoKSk7CiAgICAgICAgICAgICAgICAvLyBPYmpl\nY3QgdmFsID0gc20uZ2V0SW50ZXJtZWRpYXRlKGluZGV4KTsKICAgICAgICAg\nICAgICAgIC8vIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgICAgIC8v\nIAkJb2JqZWN0c1tvYmplY3RDb3VudF0gPSB2YWw7CiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVN\nYW5hZ2VyLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICJnZXRJbnRlcm1l\nZGlhdGUiLCBPYmplY3QuY2xhc3MsIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3Mg\nfSk7CiAgICAgICAgICAgICAgICBpbnQgbG9jYWwgPSBjb2RlLmdldE5leHRM\nb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgY29kZS5hc3RvcmUoKS5z\nZXRMb2NhbChsb2NhbCk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwobG9jYWwpOwogICAgICAgICAgICAgICAganVtcHMuYWRkKGNv\nZGUuaWZudWxsKCkpOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFRoaXMoKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRG\naWVsZCgib2JqZWN0cyIsIE9iamVjdFtdLmNsYXNzKTsKICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShvYmplY3RDb3VudCk7CiAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwobG9jYWwpOwog\nICAgICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKHJlcGxhY2VUeXBlKGZtZHNbaV0pID49IEphdmFU\neXBlcy5PQkpFQ1QpCiAgICAgICAgICAgICAgICBvYmplY3RDb3VudCsrOwog\nICAgICAgIH0KICAgICAgICBzZXRUYXJnZXQoY29kZS52cmV0dXJuKCksIGp1\nbXBzKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgYWRkU3RvcmUoQkNDbGFzcyBiYywgQ29kZSBjb2RlLCBGaWVs\nZE1ldGFEYXRhIGZtZCwKICAgICAgICBpbnQgb2JqZWN0Q291bnQpIHsKICAg\nICAgICBpbnQgdHlwZUNvZGUgPSByZXBsYWNlVHlwZShmbWQpOwogICAgICAg\nIGludCBpbmRleCA9IGZtZC5nZXRJbmRleCgpOwogICAgICAgIGlmICh0eXBl\nQ29kZSA8IEphdmFUeXBlcy5PQkpFQ1QpIHsKICAgICAgICAgICAgQ2xhc3M8\nPz4gdHlwZSA9IGZvclR5cGUodHlwZUNvZGUpOwogICAgICAgICAgICAvLyBm\naWVsZDxpPiA9IHNtLmZldGNoPFR5cGU+KGluZGV4KQogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShpbmRleCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsCiAg\nICAgICAgICAgICAgICAiZmV0Y2giICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6\nZSh0eXBlLmdldE5hbWUoKSksIHR5cGUsCiAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLnB1dGZp\nZWxkKCkuc2V0RmllbGQoZ2V0RmllbGROYW1lKGluZGV4KSwgdHlwZSk7CiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZCgibG9hZGVkIiwgQml0U2V0LmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGlu\nZGV4KTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKEJpdFNldC5jbGFzcywgInNldCIsIHZvaWQuY2xhc3MsCiAgICAgICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIC8vIE9iamVjdCB2YWwgPSB0b0RhdGEoc20u\nZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChpbmRleCksCiAgICAgICAgICAgIC8v\nIAkJc20uZmV0Y2hGaWVsZChpbmRleCwgZmFsc2UpLCBzbS5nZXRDb250ZXh0\nKCkpOwogICAgICAgICAgICBpbnQgbG9jYWwgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygp\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAiZ2V0TWV0\nYURhdGEiLCBDbGFzc01ldGFEYXRhLmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgpKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKENs\nYXNzTWV0YURhdGEuY2xhc3MsCiAgICAgICAgICAgICAgICAiZ2V0RmllbGQi\nLCBGaWVsZE1ldGFEYXRhLmNsYXNzLCBuZXcgQ2xhc3NbXXsgaW50LmNsYXNz\nIH0pOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5k\nZXgoKSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0\nTWV0aG9kKE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsCiAgICAgICAgICAg\nICAgICAiZmV0Y2hGaWVsZCIsIE9iamVjdC5jbGFzcywgbmV3IENsYXNzW10K\nICAgICAgICAgICAgICAgIHsgaW50LmNsYXNzLCBib29sZWFuLmNsYXNzIH0p\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAiZ2V0Q29u\ndGV4dCIsIFN0b3JlQ29udGV4dC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChiYy5nZXROYW1lKCks\nICJ0b0RhdGEiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLmdldE5h\nbWUoKSwgdG9TdHJpbmdzKG5ldyBDbGFzcyBbXXsKICAgICAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGEuY2xhc3MsIE9iamVjdC5jbGFzcywgU3RvcmVDb250\nZXh0LmNsYXNzIH0pKTsKICAgICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRM\nb2NhbChsb2NhbCk7CgogICAgICAgICAgICAvLyBpZiAodmFsID09IE5VTEwp\nIHsKICAgICAgICAgICAgLy8gCQl2YWwgPSBudWxsOwogICAgICAgICAgICAv\nLyAJCWxvYWRlZC5jbGVhcihpbmRleCk7CiAgICAgICAgICAgIC8vIAl9IGVs\nc2UKICAgICAgICAgICAgLy8gCQlsb2FkZWQuc2V0KGluZGV4KTsKICAgICAg\nICAgICAgLy8gCW9iamVjdHNbb2JqZWN0Q291bnRdID0gdmFsOwogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwobG9jYWwpOwogICAgICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEFic3RyYWN0UENEYXRhLmNs\nYXNzLCAiTlVMTCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MpOwog\nICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmYWNt\ncG5lKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nCiAgICAgICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwobG9jYWwpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoImxvYWRlZCIsIEJpdFNldC5j\nbGFzcyk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShp\nbmRleCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChCaXRTZXQuY2xhc3MsICJjbGVhciIsIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAg\nICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gY29kZS5nbzIoKTsKICAgICAg\nICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuYWxvYWQoKS5zZXRUaGlzKCkp\nOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoImxvYWRl\nZCIsIEJpdFNldC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShpbmRleCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChCaXRTZXQuY2xhc3MsICJzZXQiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9\nKTsKICAgICAgICAgICAgZ28yLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKCJvYmplY3RzIiwgT2JqZWN0W10uY2xhc3MpOwogICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUob2JqZWN0Q291bnQpOwogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwobG9jYWwpOwogICAgICAgICAgICBj\nb2RlLmFhc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF1c2VzSW1w\nbERhdGEoZm1kKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBz\ndG9yZUltcGxEYXRhKHNtLCBpLCBsb2FkZWQuZ2V0KGkpOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShp\nbmRleCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoImxvYWRlZCIsIEJpdFNldC5j\nbGFzcyk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGluZGV4\nKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQml0\nU2V0LmNsYXNzLCAiZ2V0IiwgYm9vbGVhbi5jbGFzcywKICAgICAgICAgICAg\nbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoInN0b3JlSW1wbERhdGEiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFu\nYWdlci5jbGFzcywgaW50LmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBhZGROZXdFbWJlZGRlZChCQ0NsYXNzIGJj\nKSB7CiAgICAgICAgLy8gdm9pZCBuZXdFbWJlZGRlZFBDRGF0YShPcGVuSlBB\nU3RhdGVNYW5hZ2VyIGVtYmVkZGVkKQogICAgICAgIEJDTWV0aG9kIG1ldGgg\nPSBiYy5kZWNsYXJlTWV0aG9kKCJuZXdFbWJlZGRlZFBDRGF0YSIsIFBDRGF0\nYS5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IE9wZW5KUEFTdGF0\nZU1hbmFnZXIuY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5n\nZXRDb2RlKHRydWUpOwogICAgICAgIC8vIHJldHVybiBnZXRTdG9yYWdlR2Vu\nZXJhdG9yKCkuZ2VuZXJhdGVQQ0RhdGEKICAgICAgICAvLyAJCShzbS5nZXRJ\nZCgpLCBzbS5nZXRNZXRhRGF0YSgpKTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZCgi\nc3RvcmFnZUdlbmVyYXRvciIsIFBDRGF0YUdlbmVyYXRvci5jbGFzcyk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUu\naW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIuY2xhc3MsCiAgICAgICAgICAgICJnZXRJZCIsIE9iamVjdC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIuY2xhc3MsCiAgICAgICAgICAgICJnZXRNZXRhRGF0YSIs\nIENsYXNzTWV0YURhdGEuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChQQ0RhdGFHZW5lcmF0b3IuY2xhc3Ms\nCiAgICAgICAgICAgICJnZW5lcmF0ZVBDRGF0YSIsIFBDRGF0YS5jbGFzcywg\nbmV3IENsYXNzW10KICAgICAgICAgICAgeyBPYmplY3QuY2xhc3MsIENsYXNz\nTWV0YURhdGEuY2xhc3MgfSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGFkZEdldERhdGEoQkNDbGFzcyBiYykgewogICAgICAgIC8vIHJldHVybiBn\nZXRPYmplY3RGaWVsZChpKTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBi\nYy5kZWNsYXJlTWV0aG9kKCJnZXREYXRhIiwgT2JqZWN0LmNsYXNzLAogICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZCgiZ2V0T2JqZWN0IiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vLy8KICAgIC8vIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLwoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgdmFsaWQge0BsaW5rIEphdmFUeXBlc30g\nY29uc3RhbnQgZm9yIHRoZSBnaXZlbiBmaWVsZAogICAgICovCiAgICBwcm90\nZWN0ZWQgaW50IHJlcGxhY2VUeXBlKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICAgICAgaWYgKHVzZXNJbnRlcm1lZGlhdGUoZm1kKSkKICAgICAgICAgICAg\ncmV0dXJuIEphdmFUeXBlcy5PQkpFQ1Q7CiAgICAgICAgcmV0dXJuIGZtZC5n\nZXRUeXBlQ29kZSgpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0\naGUgZ2l2ZW4gZmllbGQgdXNlcyBhIGNhY2hlYWJsZSBpbnRlcm1lZGlhdGUg\ndmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHVzZXNJbnRl\ncm1lZGlhdGUoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4g\nZm1kLnVzZXNJbnRlcm1lZGlhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdGhlIGdpdmVuIHR5cGUgbWlnaHQgaGF2ZSBjYWNoZWFibGUg\nY2xhc3MtbGV2ZWwgaW1wbCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiB1c2VzSW1wbERhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHRoZSBnaXZlbiBmaWVsZCBtaWdodCBoYXZlIGNhY2hlYWJsZSBpbXBs\nIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHVzZXNJbXBs\nRGF0YShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHJldHVybiBmbWQu\ndXNlc0ltcGxEYXRhKCkgPT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBudW1iZXIgb2YgZmllbGRzIHdpdGggY2FjaGVhYmxlIGltcGwgZGF0\nYS4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgY291bnRJbXBsRGF0YUZpZWxk\ncyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IG1ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgaW50IGNvdW50\nID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIGlmICh1c2VzSW1wbERhdGEoZm1kc1tpXSkp\nCiAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgIHJldHVybiBjb3Vu\ndDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBtZXRob2Qgd2hpY2ggZGVm\nZXJzIHRvIEFic3RyYWN0UENEYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBjYWxsQWJzdHJhY3RQQ0RhdGEoQkNDbGFzcyBiYywgU3RyaW5nIG5h\nbWUsIENsYXNzPD8+IHJldFR5cGUsCiAgICAgICAgQ2xhc3M8Pz5bXSBhcmdz\nKSB7CiAgICAgICAgQkNNZXRob2QgbWV0aCA9IGJjLmRlY2xhcmVNZXRob2Qo\nbmFtZSwgcmV0VHlwZSwgYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSkuc2V0\nVHlwZShhcmdzW2ldKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoQWJzdHJhY3RQQ0RhdGEuY2xhc3MsIG5hbWUsIHJldFR5cGUs\nCiAgICAgICAgICAgIGFyZ3MpOwogICAgICAgIGlmICghdm9pZC5jbGFzcy5l\ncXVhbHMocmV0VHlwZSkpCiAgICAgICAgICAgIGNvZGUueHJldHVybigpLnNl\ndFR5cGUocmV0VHlwZSk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGNvbGxlY3Rpb24gb2Yge0BsaW5r\nIEp1bXBJbnN0cnVjdGlvbn1zIHRvIHRoZSBnaXZlbiBpbnN0cnVjdGlvbiwK\nICAgICAqIGNsZWFyaW5nIHRoZSBjb2xsZWN0aW9uIGluIHRoZSBwcm9jZXNz\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRUYXJnZXQoSW5zdHJ1\nY3Rpb24gaW5zLCBDb2xsZWN0aW9uPEluc3RydWN0aW9uPiBqdW1wcykgewog\nICAgICAgIGZvciAoSXRlcmF0b3I8SW5zdHJ1Y3Rpb24+IGl0ID0ganVtcHMu\naXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgpOykKICAgICAgICAgICAgKChKdW1w\nSW5zdHJ1Y3Rpb24pIGl0Lm5leHQoKSkuc2V0VGFyZ2V0KGlucyk7CiAgICAg\nICAganVtcHMuY2xlYXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5z\nZm9ybSB0aGUgZ2l2ZW4gYXJyYXkgb2YgY2xhc3NlcyB0byBzdHJpbmdzLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmdbXSB0b1N0cmluZ3Mo\nQ2xhc3M8Pz5bXSBjbHMpIHsKICAgICAgICBTdHJpbmdbXSBzdHJpbmdzID0g\nbmV3IFN0cmluZ1tjbHMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHN0cmluZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHN0cmlu\nZ3NbaV0gPSBjbHNbaV0uZ2V0TmFtZSgpOwogICAgICAgIHJldHVybiBzdHJp\nbmdzOwogICAgfQoKICAgIC8qKgogICAgICogRHluYW1pYyB7QGxpbmsgUENE\nYXRhfXMgZ2VuZXJhdGVkIHdpbGwgaW1wbGVtZW50IHRoaXMgaW50ZXJmYWNl\nCiAgICAgKiB0byBzaW1wbGlmeSBpbml0aWFsaXphdGlvbi4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBpbnRlcmZhY2UgRHluYW1pY1BDRGF0YSBleHRl\nbmRzIFBDRGF0YSB7CgogICAgICAgIHB1YmxpYyB2b2lkIHNldElkKE9iamVj\ndCBvaWQpOwoKICAgICAgICBwdWJsaWMgUENEYXRhR2VuZXJhdG9yIGdldFN0\nb3JhZ2VHZW5lcmF0b3IoKTsKCiAgICAgICAgcHVibGljIHZvaWQgc2V0U3Rv\ncmFnZUdlbmVyYXRvciAoUENEYXRhR2VuZXJhdG9yIGdlbmVyYXRvcik7Cgl9\nCn0K\n","encoding":"base64"}

