{"sha":"d761c7f54a1b195e76460ed600f0c4e72eaa1385","node_id":"MDQ6QmxvYjIwNjM2NDpkNzYxYzdmNTRhMWIxOTVlNzY0NjBlZDYwMGYwYzRlNzJlYWExMzg1","size":184139,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d761c7f54a1b195e76460ed600f0c4e72eaa1385","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5Mb2NhbGU7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNv\nbmZpZ3VyYXRpb25JbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5tZXRhLkNsYXNzQXJnUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLkJ5dGVjb2RlV3JpdGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkZpbGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLlNlcnZpY2VzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQWNjZXNzQ29kZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFs\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQmln\nRGVjaW1hbElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQmln\nSW50ZWdlcklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQnl0\nZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhcklkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRGF0ZUlkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRG91YmxlSWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkludElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuRmxvYXRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkxv\nbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElk\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU2hvcnRJZDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0cmluZ0lkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBv\ncnQgc2VycC5ieXRlY29kZS5CQ0NsYXNzOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5CQ0ZpZWxkOwppbXBvcnQgc2VycC5ieXRlY29kZS5CQ01ldGhvZDsKaW1w\nb3J0IHNlcnAuYnl0ZWNvZGUuQ29kZTsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nQ29uc3RhbnRzOwppbXBvcnQgc2VycC5ieXRlY29kZS5FeGNlcHRpb25zOwpp\nbXBvcnQgc2VycC5ieXRlY29kZS5GaWVsZEluc3RydWN0aW9uOwppbXBvcnQg\nc2VycC5ieXRlY29kZS5HZXRGaWVsZEluc3RydWN0aW9uOwppbXBvcnQgc2Vy\ncC5ieXRlY29kZS5JZkluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5JbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSnVtcEluc3Ry\ndWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Mb2FkSW5zdHJ1Y3Rpb247\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkxvb2t1cFN3aXRjaEluc3RydWN0aW9u\nOwppbXBvcnQgc2VycC5ieXRlY29kZS5NZXRob2RJbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAuYnl0ZWNvZGUuUHJvamVjdDsKaW1wb3J0IHNlcnAuYnl0ZWNv\nZGUuVGFibGVTd2l0Y2hJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNv\nZGUuQ2xhc3NJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJz\nOwppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQnl0ZWNvZGUg\nZW5oYW5jZXIgdXNlZCB0byBlbmhhbmNlIHBlcnNpc3RlbnQgY2xhc3NlcyBm\ncm9tIG1ldGFkYXRhLiBUaGUKICogZW5oYW5jZXIgbXVzdCBiZSBpbnZva2Vk\nIG9uIGFsbCBwZXJzaXN0ZW5jZS1jYXBhYmxlIGFuZCBwZXJzaXN0ZW5jZSBh\nd2FyZQogKiBjbGFzc2VzLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8K\ncHVibGljIGNsYXNzIFBDRW5oYW5jZXIgewogICAgLy8gRGVzaWduYXRlcyBh\nIHZlcnNpb24gZm9yIG1haW50YWluaW5nIGNvbXBhdGJpbGl0eSB3aGVuIFBD\nRW5oYW5jZXIKICAgIC8vIG1vZGlmaWVzIGVuaGFuY2VtZW50IHRoYXQgY2Fu\nIGJyZWFrIHNlcmlhbGl6YXRpb24gb3Igb3RoZXIgY29udHJhY3RzCiAgICAv\nLyBFYWNoIGVuaGFuY2VkIGNsYXNzIHdpbGwgcmV0dXJuIHRoZSB2YWx1ZSBv\nZiB0aGlzIGZpZWxkIHZpYQogICAgLy8gcHVibGljIGludCBnZXRFbmhhbmNl\nbWVudENvbnRyYWN0VmVyc2lvbigpCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBFTkhBTkNFUl9WRVJTSU9OID0gMjsKCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBFTkhBTkNFX05PTkUgPSAwOwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgRU5IQU5DRV9BV0FSRSA9IDIgPDwgMDsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VfSU5URVJGQUNFID0gMiA8PCAx\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9QQyA9IDIg\nPDwgMjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBQUkUgPSAi\ncGMiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgSVNERVRBQ0hF\nRFNUQVRFREVGSU5JVElWRSA9IFBSRSAKICAgICAgICArICJpc0RldGFjaGVk\nU3RhdGVEZWZpbml0aXZlIjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBD\nbGFzcyBQQ1RZUEUgPSBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3M7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgU00gPSBQUkUgKyAiU3RhdGVN\nYW5hZ2VyIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFNNVFlQ\nRSA9IFN0YXRlTWFuYWdlci5jbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIFN0cmluZyBJTkhFUklUID0gUFJFICsgIkluaGVyaXRlZEZpZWxkQ291\nbnQiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIENPTlRFWFRO\nQU1FID0gIkdlbmVyaWNDb250ZXh0IjsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIENsYXNzIFVTRVJFWENFUCA9IFVzZXJFeGNlcHRpb24uY2xhc3M7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBJTlRFUk5FWENFUCA9IElu\ndGVybmFsRXhjZXB0aW9uLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgQ2xhc3MgSEVMUEVSVFlQRSA9IFBDUmVnaXN0cnkuY2xhc3M7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgU1VQRVIgPSBQUkUgKyAiUENT\ndXBlcmNsYXNzIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIE9J\nREZTVFlQRSA9IEZpZWxkU3VwcGxpZXIuY2xhc3M7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBDbGFzcyBPSURGQ1RZUEUgPSBGaWVsZENvbnN1bWVyLmNs\nYXNzOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9j\nID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoUENFbmhhbmNlci5j\nbGFzcyk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgUkVERUZJ\nTkVEX0FUVFJJQlVURQogICAgICAgID0gUENFbmhhbmNlci5jbGFzcy5nZXRO\nYW1lKCkgKyAiI3JlZGVmaW5lZC10eXBlIjsKICAgIAogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQXV4aWxpYXJ5RW5oYW5jZXJbXSBfYXV4RW5oYW5jZXJz\nOwogICAgc3RhdGljIHsKICAgICAgICBDbGFzc1tdIGNsYXNzZXMgPSBTZXJ2\naWNlcy5nZXRJbXBsZW1lbnRvckNsYXNzZXMoCiAgICAgICAgICAgIEF1eGls\naWFyeUVuaGFuY2VyLmNsYXNzLAogICAgICAgICAgICBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKEF1eGlsaWFyeUVuaGFuY2VyLmNs\nYXNzKSkpOwogICAgICAgIExpc3QgYXV4RW5oYW5jZXJzID0gbmV3IEFycmF5\nTGlzdChjbGFzc2VzLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBhdXhFbmhhbmNlcnMuYWRkKEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKGNsYXNzZXNbaV0pKSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAg\nICAgICAvLyBhdXggZW5oYW5jZXIgbWF5IHJlbHkgb24gbm9uLWV4aXN0YW50\nIHNwZWMgY2xhc3NlcywgZXRjCiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgX2F1eEVuaGFuY2VycyA9IChBdXhpbGlhcnlFbmhhbmNlcltdKSBh\ndXhFbmhhbmNlcnMudG9BcnJheQogICAgICAgIChuZXcgQXV4aWxpYXJ5RW5o\nYW5jZXJbYXV4RW5oYW5jZXJzLnNpemUoKV0pOwogICAgfQoKICAgIHByaXZh\ndGUgQkNDbGFzcyBfcGM7CiAgICBwcml2YXRlIGZpbmFsIEJDQ2xhc3MgX21h\nbmFnZWRUeXBlOwogICAgcHJpdmF0ZSBmaW5hbCBNZXRhRGF0YVJlcG9zaXRv\ncnkgX3JlcG9zOwogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc01ldGFEYXRhIF9t\nZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cgX2xvZzsKICAgIHByaXZhdGUg\nQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX2RlZkNvbnMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9yZWRlZmlu\nZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9zdWJjbGFzcyA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9mYWlsID0gZmFsc2U7CiAgICBw\ncml2YXRlIFNldCBfdmlvbGF0aW9ucyA9IG51bGw7CiAgICBwcml2YXRlIEZp\nbGUgX2RpciA9IG51bGw7CiAgICBwcml2YXRlIEJ5dGVjb2RlV3JpdGVyIF93\ncml0ZXIgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2JhY2tpbmdGaWVsZHMg\nPSBudWxsOyAvLyBtYXAgb2Ygc2V0IC8gZ2V0IG5hbWVzID0+IGZpZWxkIG5h\nbWVzCiAgICBwcml2YXRlIE1hcCBfYXR0cnNUb0ZpZWxkcyA9IG51bGw7IC8v\nIG1hcCBvZiBhdHRyIG5hbWVzID0+IGZpZWxkIG5hbWVzCiAgICBwcml2YXRl\nIE1hcCBfZmllbGRzVG9BdHRycyA9IG51bGw7IC8vIG1hcCBvZiBmaWVsZCBu\nYW1lcyA9PiBhdHRyIG5hbWVzCiAgICBwcml2YXRlIGJvb2xlYW4gX2lzQWxy\nZWFkeVJlZGVmaW5lZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9p\nc0FscmVhZHlTdWJjbGFzc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX2Jjc0NvbmZpZ3VyZWQgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIENv\nbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbiBhbmQgdHlwZSB0byBl\nbmhhbmNlLiBUaGlzIHdpbGwgbG9vawogICAgICogdXAgdGhlIG1ldGFkYXRh\nIGZvciA8Y29kZT50eXBlPC9jb2RlPiBmcm9tIDxjb2RlPmNvbmY8L2NvZGU+\nJ3MKICAgICAqIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0Vu\naGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIENsYXNzIHR5cGUp\nIHsKICAgICAgICB0aGlzKGNvbmYsIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgIC5sb2FkUHJvamVj\ndENsYXNzQWN0aW9uKG5ldyBQcm9qZWN0KCksIHR5cGUpKSwKICAgICAgICAg\nICAgKE1ldGFEYXRhUmVwb3NpdG9yeSkgbnVsbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24gYW5k\nIHR5cGUgdG8gZW5oYW5jZS4gVGhpcyB3aWxsIGxvb2sKICAgICAqIHVwIHRo\nZSBtZXRhZGF0YSBmb3IgPGNvZGU+bWV0YTwvY29kZT4gYnkgY29udmVydGlu\nZyBiYWNrIHRvIGEgY2xhc3MKICAgICAqIGFuZCB0aGVuIGxvYWRpbmcgZnJv\nbSA8Y29kZT5jb25mPC9jb2RlPidzIHJlcG9zaXRvcnkuCiAgICAgKi8KICAg\nIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYs\nIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHRoaXMoY29uZiwgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAg\nICAgICAgICAgLmxvYWRQcm9qZWN0Q2xhc3NBY3Rpb24obmV3IFByb2plY3Qo\nKSwgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKSwKICAgICAgICAgICAgbWV0\nYS5nZXRSZXBvc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSB0eXBlIHRoZSBieXRlY29kZSByZXByZXNlbnRhdGlvbiBmbyB0\naGUgdHlwZSB0bwogICAgICogZW5oYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRl\nZCBmcm9tIGFueSBzdHJlYW0gb3IgZmlsZQogICAgICogQHBhcmFtIHJlcG9z\nIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFkYXRhIGFj\nY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJlcG9yaXRv\ncnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBmcm9tIHRoZSBnaXZlbiBjb25m\naWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVmYXVsdAogICAgICogYmVjYXVz\nZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBiZSBhbgogICAgICogaW1wbGVt\nZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRhdGEKICAg\nICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRhdGEgZmls\nZXMKICAgICAqIEBkZXByZWNhdGVkIHVzZSB7QGxpbmsgI1BDRW5oYW5jZXIo\nT3BlbkpQQUNvbmZpZ3VyYXRpb24sIEJDQ2xhc3MsCiAgICAgICAgTWV0YURh\ndGFSZXBvc2l0b3J5LCBDbGFzc0xvYWRlcil9IGluc3RlYWQuIAogICAgICov\nCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBj\nb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5\nIHJlcG9zKSB7CiAgICAgICAgdGhpcyhjb25mLCB0eXBlLCByZXBvcywgbnVs\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5\nIGNvbmZpZ3VyYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhl\nIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBlIHRvCiAgICAg\nKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20gYW55IHN0cmVh\nbSBvciBmaWxlCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBv\nc2l0b3J5IHRvIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAogICAgICogb3Ig\nbnVsbCB0byBjcmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRv\ncnkKICAgICAqIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3Qg\ndXNlZCBieSBkZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0\naW9uIG1pZ2h0IGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZp\nYyBzdWJjbGFzcyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVxdWlyZWQgbW9y\nZSB0aGFuIGp1c3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAgICogQHBhcmFt\nIGxvYWRlciB0aGUgZW52aXJvbm1lbnQgY2xhc3Nsb2FkZXIgdG8gdXNlIGZv\nciBsb2FkaW5nCiAgICAgKiBjbGFzc2VzIGFuZCByZXNvdXJjZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAgICBNZXRhRGF0YVJlcG9zaXRv\ncnkgcmVwb3MsIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIF9tYW5h\nZ2VkVHlwZSA9IHR5cGU7CiAgICAgICAgX3BjID0gdHlwZTsKCiAgICAgICAg\nX2xvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19F\nTkhBTkNFKTsKCiAgICAgICAgaWYgKHJlcG9zID09IG51bGwpIHsKICAgICAg\nICAgICAgX3JlcG9zID0gY29uZi5uZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpOwogICAgICAgICAgICBfcmVwb3Muc2V0U291cmNlTW9kZShNZXRh\nRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsKICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAgICAgX21ldGEgPSBfcmVw\nb3MuZ2V0TWV0YURhdGEodHlwZS5nZXRUeXBlKCksIGxvYWRlciwgZmFsc2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBy\nZXBvc2l0b3J5LiBUaGUgcmVwb3NpdG9yeSdzIGNvbmZpZ3VyYXRpb24gd2ls\nbAogICAgICogYmUgdXNlZCwgYW5kIHRoZSBtZXRhZGF0YSBwYXNzZWQgaW4g\nd2lsbCBiZSB1c2VkIGFzLWlzIHdpdGhvdXQgZG9pbmcKICAgICAqIGFueSBh\nZGRpdGlvbmFsIGxvb2t1cHMuIFRoaXMgaXMgdXNlZnVsIHdoZW4gcnVubmlu\nZyB0aGUgZW5oYW5jZXIKICAgICAqIGR1cmluZyBtZXRhZGF0YSBsb2FkLgog\nICAgICoKICAgICAqIEBwYXJhbSByZXBvcyBhIG1ldGFkYXRhIHJlcG9zaXRv\ncnkgdG8gdXNlIGZvciBtZXRhZGF0YSBhY2Nlc3MsCiAgICAgKiBvciBudWxs\nIHRvIGNyZWF0ZSBhIG5ldyByZXBvcml0b3J5OyB0aGUgcmVwb3NpdG9yeQog\nICAgICogZnJvbSB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbiBpc24ndCB1c2Vk\nIGJ5IGRlZmF1bHQKICAgICAqIGJlY2F1c2UgdGhlIGNvbmZpZ3VyYXRpb24g\nbWlnaHQgYmUgYW4KICAgICAqIGltcGxlbWVudGF0aW9uLXNwZWNpZmljIHN1\nYmNsYXNzIHdob3NlIG1ldGFkYXRhCiAgICAgKiByZXF1aXJlZCBtb3JlIHRo\nYW4ganVzdCBiYXNlIG1ldGFkYXRhIGZpbGVzCiAgICAgKiBAcGFyYW0gdHlw\nZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gZm8gdGhlIHR5cGUgdG8K\nICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJlIGNyZWF0ZWQgZnJvbSBhbnkg\nc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJhbSBtZXRhIHRoZSBtZXRhZGF0\nYSB0byB1c2UgZm9yIHByb2Nlc3NpbmcgdGhpcyB0eXBlLgogICAgICoKICAg\nICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNl\ncihNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsIEJDQ2xhc3MgdHlwZSwKICAg\nICAgICBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBfbWFuYWdlZFR5\ncGUgPSB0eXBlOwogICAgICAgIF9wYyA9IHR5cGU7CgogICAgICAgIF9sb2cg\nPSByZXBvcy5nZXRDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLmdldExv\nZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfRU5IQU5DRSk7CgogICAgICAg\nIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIF9tZXRhID0gbWV0YTsKICAgIH0K\nCiAgICBzdGF0aWMgU3RyaW5nIHRvUENTdWJjbGFzc05hbWUoQ2xhc3MgY2xz\nKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoUENF\nbmhhbmNlci5jbGFzcykgKyAiLiIKICAgICAgICAgICAgKyBjbHMuZ2V0TmFt\nZSgpLnJlcGxhY2UoJy4nLCAnJCcpICsgIiRwY3N1YmNsYXNzIjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90IDxjb2RlPmNsYXNzTmFt\nZTwvY29kZT4gaXMgdGhlIG5hbWUgZm9yIGEKICAgICAqIGR5bmFtaWNhbGx5\nLWNyZWF0ZWQgcGVyc2lzdGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBib29sZWFuIGlzUENTdWJjbGFzc05hbWUoU3RyaW5nIGNsYXNzTmFtZSkg\newogICAgICAgIHJldHVybiBjbGFzc05hbWUuc3RhcnRzV2l0aChTdHJpbmdz\nLmdldFBhY2thZ2VOYW1lKFBDRW5oYW5jZXIuY2xhc3MpKQogICAgICAgICAg\nICAmJiBjbGFzc05hbWUuZW5kc1dpdGgoIiRwY3N1YmNsYXNzIik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJZiA8Y29kZT5jbGFzc05hbWU8L2NvZGU+IGlz\nIGEgZHluYW1pY2FsbHktY3JlYXRlZCBwZXJzaXN0ZW5jZS1jYXBhYmxlCiAg\nICAgKiBzdWJjbGFzcyBuYW1lLCByZXR1cm5zIHRoZSBuYW1lIG9mIHRoZSBj\nbGFzcyB0aGF0IGl0IHN1YmNsYXNzZXMuCiAgICAgKiBPdGhlcndpc2UsIHJl\ndHVybnMgPGNvZGU+Y2xhc3NOYW1lPC9jb2RlPi4KICAgICAqCiAgICAgKiBA\nc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcg\ndG9NYW5hZ2VkVHlwZU5hbWUoU3RyaW5nIGNsYXNzTmFtZSkgewogICAgICAg\nIGlmIChpc1BDU3ViY2xhc3NOYW1lKGNsYXNzTmFtZSkpIHsKICAgICAgICAg\nICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnN1YnN0cmluZygKICAgICAgICAg\nICAgICAgIFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoUENFbmhhbmNlci5jbGFz\ncykubGVuZ3RoKCkgKyAxKTsKICAgICAgICAgICAgY2xhc3NOYW1lID0gY2xh\nc3NOYW1lLnN1YnN0cmluZygwLCBjbGFzc05hbWUubGFzdEluZGV4T2YoIiQi\nKSk7CiAgICAgICAgICAgIC8vIHRoaXMgaXMgbm90IGNvcnJlY3QgZm9yIG5l\nc3RlZCBQQ3MKICAgICAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnJl\ncGxhY2UoJyQnLCAnLicpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBy\nZXR1cm4gY2xhc3NOYW1lOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3Ry\ndWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uLCB0eXBlLCBhbmQgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25m\naWd1cmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICB0aGlzKGNvbmYsIHR5cGUsIG1ldGEu\nZ2V0UmVwb3NpdG9yeSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIHBlcnNpc3Rl\nbmNlLWNhcGFibGUgY2xhc3MKICAgICAqIGJlaW5nIG1hbmlwdWxhdGVkLgog\nICAgICovCiAgICBwdWJsaWMgQkNDbGFzcyBnZXRQQ0J5dGVjb2RlKCkgewog\nICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBtYW5hZ2Vk\nIGNsYXNzIGJlaW5nCiAgICAgKiBtYW5pcHVsYXRlZC4gVGhpcyBpcyB1c3Vh\nbGx5IHRoZSBzYW1lIGFzIHtAbGluayAjZ2V0UENCeXRlY29kZX0sCiAgICAg\nKiBleGNlcHQgd2hlbiBydW5uaW5nIHRoZSBlbmhhbmNlciB0byByZWRlZmlu\nZSBhbmQgc3ViY2xhc3MKICAgICAqIGV4aXN0aW5nIHBlcnNpc3RlbnQgdHlw\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBCQ0NsYXNzIGdldE1hbmFnZWRUeXBl\nQnl0ZWNvZGUoKSB7CiAgICAgICAgcmV0dXJuIF9tYW5hZ2VkVHlwZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRo\nZSBjbGFzcyBiZWluZyBtYW5pcHVsYXRlZCwgb3IgbnVsbCBpZiBub3QKICAg\nICAqIGEgcGVyc2lzdGVudCB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21l\ndGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGlu\nZyB3aGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwog\nICAgICogY29uc3RydWN0b3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNl\nbnQgaW4gdGhlIGNsYXNzLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0\nIGEgbm8tYXJnIGNvbnN0cnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhl\nIGNvbXBpbGVyCiAgICAgKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBp\nbiBhIFBDLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBZGREZWZh\ndWx0Q29uc3RydWN0b3IoKSB7CiAgICAgICAgcmV0dXJuIF9kZWZDb25zOwog\nICAgfQoKICAgIC8qKgogICAgICogQSBib29sZWFuIGluZGljYXRpbmcgd2hl\ndGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIGFkZCBhIG5vLWFyZ3MKICAgICAq\nIGNvbnN0cnVjdG9yIGlmIG9uZSBpcyBub3QgYWxyZWFkeSBwcmVzZW50IGlu\nIHRoZSBjbGFzcy4gT3BlbkpQQQogICAgICogcmVxdWlyZXMgdGhhdCBhIG5v\nLWFyZyBjb25zdHJ1Y3RvciAod2hldGhlciBjcmVhdGVkIGJ5IHRoZSBjb21w\naWxlcgogICAgICogb3IgYnkgdGhlIHVzZXIpIGJlIHByZXNlbnQgaW4gYSBQ\nQy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QWRkRGVmYXVsdENvbnN0\ncnVjdG9yKGJvb2xlYW4gYWRkRGVmYXVsdENvbnN0cnVjdG9yKSB7CiAgICAg\nICAgX2RlZkNvbnMgPSBhZGREZWZhdWx0Q29uc3RydWN0b3I7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0\nYXRlIGl0cyBhcmd1bWVudHMsIG9yIGp1c3QgcnVuIHZhbGlkYXRpb24KICAg\nICAqIGFuZCBvcHRpb25hbCBzdWJjbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBV\nc3VhbGx5IHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aAogICAgICogPGNvZGU+\nc2V0Q3JlYXRlU3ViY2xhc3ModHJ1ZSk8L2NvZGU+LgogICAgICoKICAgICAq\nIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRS\nZWRlZmluZSgpIHsKICAgICAgICByZXR1cm4gX3JlZGVmaW5lOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG11\ndGF0ZSBpdHMgYXJndW1lbnRzLCBvciBqdXN0IHJ1biB2YWxpZGF0aW9uCiAg\nICAgKiBhbmQgb3B0aW9uYWwgc3ViY2xhc3NpbmcgbG9naWMgb24gdGhlbS4g\nVXN1YWxseSB1c2VkIGluIGNvbmp1bmN0aW9uIHdpdGgKICAgICAqIDxjb2Rl\nPnNldENyZWF0ZVN1YmNsYXNzKHRydWUpPC9jb2RlPi4KICAgICAqCiAgICAg\nKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVk\nZWZpbmUoYm9vbGVhbiByZWRlZmluZSkgewogICAgICAgIF9yZWRlZmluZSA9\nIHJlZGVmaW5lOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUg\ndHlwZSB0aGF0IHRoaXMgaW5zdGFuY2UgaXMgZW5oYW5jaW5nIGhhcyBhbHJl\nYWR5IGJlZW4KICAgICAqIHJlZGVmaW5lZC4KICAgICAqCiAgICAgKiBAc2lu\nY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNBbHJlYWR5\nUmVkZWZpbmVkKCkgewogICAgICAgIHJldHVybiBfaXNBbHJlYWR5UmVkZWZp\nbmVkOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSB0\naGF0IHRoaXMgaW5zdGFuY2UgaXMgZW5oYW5jaW5nIGhhcyBhbHJlYWR5IGJl\nZW4KICAgICAqIHN1YmNsYXNzZWQgaW4gdGhpcyBpbnN0YW5jZSdzIGVudmly\nb25tZW50IGNsYXNzbG9hZGVyLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAu\nMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FscmVhZHlTdWJjbGFz\nc2VkKCkgewogICAgICAgIHJldHVybiBfaXNBbHJlYWR5U3ViY2xhc3NlZDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNo\nb3VsZCBtYWtlIGl0cyBhcmd1bWVudHMgcGVyc2lzdGVuY2UtY2FwYWJsZSwK\nICAgICAqIG9yIGdlbmVyYXRlIGEgcGVyc2lzdGVuY2UtY2FwYWJsZSBzdWJj\nbGFzcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gZ2V0Q3JlYXRlU3ViY2xhc3MoKSB7CiAgICAgICAg\ncmV0dXJuIF9zdWJjbGFzczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtYWtlIGl0cyBhcmd1bWVudHMgcGVy\nc2lzdGVuY2UtY2FwYWJsZSwKICAgICAqIG9yIGdlbmVyYXRlIGEgcGVyc2lz\ndGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4KICAgICAqCiAgICAgKiBAc2luY2Ug\nMS4wLjAKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q3JlYXRlU3ViY2xh\nc3MoYm9vbGVhbiBzdWJjbGFzcykgewogICAgICAgIF9zdWJjbGFzcyA9IHN1\nYmNsYXNzOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBmYWls\nIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUgdXNlcyBwcm9wZXJ0eSBhY2Nlc3Mg\nYW5kCiAgICAgKiBieXRlY29kZSBhbmFseXNpcyBzaG93cyB0aGF0IGl0IG1h\neSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdzIHByb3BlcnR5CiAgICAgKiBhY2Nl\nc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMoKSB7CiAgICAgICAgcmV0\ndXJuIF9mYWlsOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBm\nYWlsIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUgdXNlcyBwcm9wZXJ0eSBhY2Nl\nc3MgYW5kCiAgICAgKiBieXRlY29kZSBhbmFseXNpcyBzaG93cyB0aGF0IGl0\nIG1heSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdzIHByb3BlcnR5CiAgICAgKiBh\nY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMoYm9vbGVhbiBmYWlsKSB7\nCiAgICAgICAgX2ZhaWwgPSBmYWlsOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRvIGdlbmVyYXRlIGNvZGUgdG8u\nIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICogc3RydWN0dXJlIHdpbGwgYmUg\nY3JlYXRlZCBiZW5lYXRoIHRoaXMgZGlyZWN0b3J5LiBEZWZhdWx0cyB0bwog\nICAgICogb3ZlcndyaXRpbmcgdGhlIGV4aXN0aW5nIGNsYXNzIGZpbGUgaWYg\nbnVsbC4KICAgICAqLwogICAgcHVibGljIEZpbGUgZ2V0RGlyZWN0b3J5KCkg\newogICAgICAgIHJldHVybiBfZGlyOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRvIGdlbmVyYXRlIGNvZGUgdG8u\nIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICogc3RydWN0dXJlIHdpbGwgYmUg\nY3JlYWVkIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAg\nICAgKiBvdmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBu\ndWxsLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREaXJlY3RvcnkoRmls\nZSBkaXIpIHsKICAgICAgICBfZGlyID0gZGlyOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjdXJyZW50IHtAbGluayBCeXRlY29kZVdyaXRl\ncn0gdG8gd3JpdGUgdG8gb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBw\ndWJsaWMgQnl0ZWNvZGVXcml0ZXIgZ2V0Qnl0ZWNvZGVXcml0ZXIoKSB7CiAg\nICAgICAgcmV0dXJuIF93cml0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIHtAbGluayBCeXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdGhlIGJ5\ndGVjb2RlIHRvIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Qnl0ZWNvZGVXcml0ZXIoQnl0ZWNvZGVXcml0ZXIgd3JpdGVy\nKSB7CiAgICAgICAgX3dyaXRlciA9IHdyaXRlcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBlcmZvcm0gYnl0ZWNvZGUgZW5oYW5jZW1lbnRzLgogICAgICoK\nICAgICAqIEByZXR1cm4gPGNvZGU+RU5IQU5DRV8qPC9jb2RlPiBjb25zdGFu\ndAogICAgICovCiAgICBwdWJsaWMgaW50IHJ1bigpIHsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBpZiBtYW5hZ2VkIGludGVyZmFjZSwgc2tpcAog\nICAgICAgICAgICBpZiAoX3BjLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gRU5IQU5DRV9JTlRFUkZBQ0U7CgogICAgICAgICAgICAv\nLyBjaGVjayBpZiBhbHJlYWR5IGVuaGFuY2VkCiAgICAgICAgICAgIENsYXNz\nW10gaW50ZXJmYWNlcyA9IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZEludGVy\nZmFjZVR5cGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\naW50ZXJmYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKGludGVyZmFjZXNbaV0uZ2V0TmFtZSgpLmVxdWFscyhQQ1RZUEUuZ2V0TmFt\nZSgpKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzSW5mb0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy5pbmZvKF9s\nb2MuZ2V0KCJwYy10eXBlIiwgX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNFX05PTkU7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9s\nb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy5pbmZv\nKF9sb2MuZ2V0KCJlbmhhbmNlLXN0YXJ0IiwgX21hbmFnZWRUeXBlLmdldFR5\ncGUoKSkpOwoKCiAgICAgICAgICAgIGNvbmZpZ3VyZUJDcygpOwoKICAgICAg\nICAgICAgLy8gdmFsaWRhdGUgcHJvcGVydGllcyBiZWZvcmUgcmVwbGFjaW5n\nIGZpZWxkIGFjY2VzcyBzbyB0aGF0CiAgICAgICAgICAgIC8vIHdlIGJ1aWxk\nIHVwIGEgcmVjb3JkIG9mIGJhY2tpbmcgZmllbGRzLCBldGMKICAgICAgICAg\nICAgaWYgKGlzUHJvcGVydHlBY2Nlc3MoX21ldGEpKSB7CiAgICAgICAgICAg\nICAgICB2YWxpZGF0ZVByb3BlcnRpZXMoKTsKICAgICAgICAgICAgICAgIGlm\nIChnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAgICAgICAgIGFk\nZEF0dHJpYnV0ZVRyYW5zbGF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKTsKICAgICAg\nICAgICAgcHJvY2Vzc1Zpb2xhdGlvbnMoKTsKCiAgICAgICAgICAgIGlmIChf\nbWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBlbmhhbmNlQ2xhc3Mo\nKTsKICAgICAgICAgICAgICAgIGFkZEZpZWxkcygpOwogICAgICAgICAgICAg\nICAgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKTsKICAgICAgICAgICAgICAgIGFk\nZFBDTWV0aG9kcygpOwogICAgICAgICAgICAgICAgYWRkQWNjZXNzb3JzKCk7\nCiAgICAgICAgICAgICAgICBhZGRBdHRhY2hEZXRhY2hDb2RlKCk7CiAgICAg\nICAgICAgICAgICBhZGRTZXJpYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAg\nICAgICAgYWRkQ2xvbmluZ0NvZGUoKTsKICAgICAgICAgICAgICAgIHJ1bkF1\neGlsaWFyeUVuaGFuY2VycygpOwogICAgICAgICAgICAgICAgcmV0dXJuIEVO\nSEFOQ0VfUEM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfbG9n\nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgicGVycy1hd2FyZSIsIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkp\nKTsKICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfQVdBUkU7CiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihfbG9jLmdldCgi\nZW5oYW5jZS1lcnJvciIsCiAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUu\nZ2V0VHlwZSgpLmdldE5hbWUoKSwgZS5nZXRNZXNzYWdlKCkpLCBlKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNvbmZpZ3VyZUJDcygp\nIHsKICAgICAgICBpZiAoIV9iY3NDb25maWd1cmVkKSB7CiAgICAgICAgICAg\nIGlmIChnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX21h\nbmFnZWRUeXBlLmdldEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRFKSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5hZGRB\ndHRyaWJ1dGUoUkVERUZJTkVEX0FUVFJJQlVURSk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2lzQWxyZWFkeVJlZGVmaW5l\nZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICBQQ1N1YmNsYXNz\nVmFsaWRhdG9yIHZhbCA9IG5ldyBQQ1N1YmNsYXNzVmFsaWRhdG9yKAogICAg\nICAgICAgICAgICAgICAgIF9tZXRhLCBfbWFuYWdlZFR5cGUsIF9sb2csIF9m\nYWlsKTsKICAgICAgICAgICAgICAgIHZhbC5hc3NlcnRDYW5TdWJjbGFzcygp\nOwoKICAgICAgICAgICAgICAgIF9wYyA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9q\nZWN0KCkubG9hZENsYXNzKAogICAgICAgICAgICAgICAgICAgIHRvUENTdWJj\nbGFzc05hbWUoX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwogICAgICAgICAg\nICAgICAgaWYgKF9wYy5nZXRTdXBlcmNsYXNzQkMoKSAhPSBfbWFuYWdlZFR5\ncGUpIHsKICAgICAgICAgICAgICAgICAgICBfcGMuc2V0U3VwZXJjbGFzcyhf\nbWFuYWdlZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIF9wYy5zZXRBYnN0\ncmFjdChfbWFuYWdlZFR5cGUuaXNBYnN0cmFjdCgpKTsKICAgICAgICAgICAg\nICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFjZShEeW5hbWljUGVyc2lzdGVu\nY2VDYXBhYmxlLmNsYXNzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgX2lzQWxyZWFkeVN1YmNsYXNzZWQgPSB0cnVl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBfYmNzQ29uZmlndXJlZCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogV3JpdGUgdGhlIGdlbmVyYXRlZCBieXRlY29kZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgcmVjb3JkKCkKICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIGlmIChfbWFuYWdlZFR5cGUgIT0gX3Bj\nICYmIGdldFJlZGVmaW5lKCkpCiAgICAgICAgICAgIHJlY29yZChfbWFuYWdl\nZFR5cGUpOwogICAgICAgIHJlY29yZChfcGMpOwogICAgICAgIGlmIChfb2lk\ncyAhPSBudWxsKQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9v\naWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgcmVjb3JkKChCQ0NsYXNzKSBpdHIubmV4dCgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdyaXRlIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHJlY29yZChCQ0NsYXNzIGJjKQogICAgICAgIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF93cml0ZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgX3dyaXRlci53cml0ZShiYyk7CiAgICAgICAgZWxzZSBp\nZiAoX2RpciA9PSBudWxsKQogICAgICAgICAgICBiYy53cml0ZSgpOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICBGaWxlIGRpciA9IEZpbGVzLmdldFBh\nY2thZ2VGaWxlKF9kaXIsIGJjLmdldFBhY2thZ2VOYW1lKCksIHRydWUpOwog\nICAgICAgICAgICBiYy53cml0ZShuZXcgRmlsZShkaXIsIGJjLmdldENsYXNz\nTmFtZSgpICsgIi5jbGFzcyIpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRoZSBtZXRob2RzIHRoYXQgdXNlIGEg\ncHJvcGVydHktYWNjZXNzIGluc3RhbmNlIGFyZQogICAgICogd3JpdHRlbiBj\nb3JyZWN0bHkuIFRoaXMgbWV0aG9kIGFsc28gZ2F0aGVycyBpbmZvcm1hdGlv\nbiBvbiBlYWNoCiAgICAgKiBwcm9wZXJ0eSdzIGJhY2tpbmcgZmllbGQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZVByb3BlcnRpZXMoKSB7\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHM7CiAgICAgICAgaWYgKGdl\ndENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAgIGZtZHMgPSBfbWV0YS5n\nZXRGaWVsZHMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZtZHMgPSBf\nbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIE1ldGhvZCBtZXRo\nOwogICAgICAgIEJDTWV0aG9kIGdldHRlciwgc2V0dGVyOwogICAgICAgIEJD\nRmllbGQgcmV0dXJuZWQsIGFzc2lnbmVkID0gbnVsbDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKCiAgICAgICAg\nICAgIGlmICghKGZtZHNbaV0uZ2V0QmFja2luZ01lbWJlcigpIGluc3RhbmNl\nb2YgTWV0aG9kKSApIHsKICAgICAgICAgICAgICAgIC8vIElmIG5vdCBtaXhl\nZCBhY2Nlc3MgaXMgbm90IGRlZmluZWQsIGZsYWcgdGhlIGZpZWxkIG1lbWJl\ncnMsIAogICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGRvIG5vdCBwcm9j\nZXNzIHRoZW0gYmVjYXVzZSB0aGV5IGFyZSB2YWxpZAogICAgICAgICAgICAg\nICAgLy8gcGVyc2lzdGVudCBhdHRyaWJ1dGVzLgogICAgICAgICAgICAgICAg\naWYgKCFfbWV0YS5pc01peGVkQWNjZXNzKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LWJhZC1tZW1iZXIiLAogICAg\nICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGZtZHNbaV0sIGZt\nZHNbaV0uZ2V0QmFja2luZ01lbWJlcigpIH0sCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAg\nICAgICAgIG1ldGggPSAoTWV0aG9kKSBmbWRzW2ldLmdldEJhY2tpbmdNZW1i\nZXIoKTsKICAgICAgICAgICAgLy8gIyMjIyMgdGhpcyB3aWxsIGZhaWwgaWYg\nd2Ugb3ZlcnJpZGUgYW5kIGRvbid0IGNhbGwgc3VwZXIuCiAgICAgICAgICAg\nIEJDQ2xhc3MgZGVjbGFyaW5nVHlwZSA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9q\nZWN0KCkKICAgICAgICAgICAgICAgIC5sb2FkQ2xhc3MoZm1kc1tpXS5nZXRE\nZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICBnZXR0ZXIgPSBkZWNsYXJp\nbmdUeXBlLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFtZSgpLAogICAg\nICAgICAgICAgICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAg\nICAgICAgaWYgKGdldHRlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBh\nZGRWaW9sYXRpb24oInByb3BlcnR5LW5vLWdldHRlciIsIG5ldyBPYmplY3Rb\nXXsgZm1kc1tpXSB9LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuZWQgPSBnZXRSZXR1cm5lZEZpZWxkKGdldHRlcik7CiAgICAg\nICAgICAgIGlmIChyZXR1cm5lZCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmVnaXN0ZXJCYWNraW5nRmllbGRJbmZvKGZtZHNbaV0sIGdldHRlciwgcmV0\ndXJuZWQpOwoKICAgICAgICAgICAgc2V0dGVyID0gZGVjbGFyaW5nVHlwZS5n\nZXREZWNsYXJlZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNbaV0pLAogICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlKCkgfSk7CiAgICAgICAgICAgIGlmIChzZXR0ZXIgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKHJldHVybmVkID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LW5vLXNldHRl\nciIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1k\nc1tpXSB9LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdldFJlZGVmaW5lKCkpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgc3ludGhldGljIHNldHRl\ncgogICAgICAgICAgICAgICAgICAgIHNldHRlciA9IF9tYW5hZ2VkVHlwZS5k\nZWNsYXJlTWV0aG9kKGdldFNldHRlck5hbWUoZm1kc1tpXSksCiAgICAgICAg\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBmbWRz\nW2ldLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICAgICAgICAg\nIHNldHRlci5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICAgICAgICAgIENv\nZGUgY29kZSA9IHNldHRlci5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChyZXR1cm5lZCk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZXR0\nZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGFzc2lnbmVkID0gZ2V0QXNz\naWduZWRGaWVsZChzZXR0ZXIpOwoKICAgICAgICAgICAgaWYgKGFzc2lnbmVk\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZWdpc3RlckJhY2tpbmdGaWVsZElu\nZm8oZm1kc1tpXSwgc2V0dGVyLCBhc3NpZ25lZCk7CgogICAgICAgICAgICAg\nICAgaWYgKGFzc2lnbmVkICE9IHJldHVybmVkKQogICAgICAgICAgICAgICAg\nICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktc2V0dGVyLWdldHRlci1taXNt\nYXRjaCIsIG5ldyBPYmplY3RbXQogICAgICAgICAgICAgICAgICAgICAgICB7\nIGZtZHNbaV0sIGFzc2lnbmVkLmdldE5hbWUoKSwgKHJldHVybmVkID09IG51\nbGwpIAogICAgICAgICAgICAgICAgICAgICAgICA/IG51bGwgOiByZXR1cm5l\nZC5nZXROYW1lKCkgfSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCByZWdpc3RlckJhY2tpbmdGaWVs\nZEluZm8oRmllbGRNZXRhRGF0YSBmbWQsIEJDTWV0aG9kIG1ldGhvZCwKICAg\nICAgICBCQ0ZpZWxkIGZpZWxkKSB7CiAgICAgICAgaWYgKF9iYWNraW5nRmll\nbGRzID09IG51bGwpCiAgICAgICAgICAgIF9iYWNraW5nRmllbGRzID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBfYmFja2luZ0ZpZWxkcy5wdXQobWV0aG9k\nLmdldE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAgaWYgKF9h\ndHRyc1RvRmllbGRzID09IG51bGwpCiAgICAgICAgICAgIF9hdHRyc1RvRmll\nbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfYXR0cnNUb0ZpZWxkcy5w\ndXQoZm1kLmdldE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAg\naWYgKF9maWVsZHNUb0F0dHJzID09IG51bGwpCiAgICAgICAgICAgIF9maWVs\nZHNUb0F0dHJzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfZmllbGRzVG9B\ndHRycy5wdXQoZmllbGQuZ2V0TmFtZSgpLCBmbWQuZ2V0TmFtZSgpKTsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24o\nKSB7CgogICAgICAgIC8vIEdldCBhbGwgZmllbGQgbWV0YWRhdGEKICAgICAg\nICBBcnJheUxpc3Q8SW50ZWdlcj4gcHJvcEZtZHMgPSBuZXcgQXJyYXlMaXN0\nPEludGVnZXI+KCk7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBf\nbWV0YS5nZXRGaWVsZHMoKTsKCiAgICAgICAgaWYgKF9tZXRhLmlzTWl4ZWRB\nY2Nlc3MoKSkgewogICAgICAgICAgICAvLyBTdG9yZXMgaW5kZXhlcyBvZiBw\ncm9wZXJ0eSBhY2Nlc3MgZmllbGRzIHRvIGJlIHVzZWQgaW4KICAgICAgICAg\nICAgLy8gCiAgICAgICAgICAgIHByb3BGbWRzID0gbmV3IEFycmF5TGlzdDxJ\nbnRlZ2VyPigpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGV0ZXJt\naW5lIHdoaWNoIGZpZWxkcyBoYXZlIHByb3BlcnR5IGFjY2VzcyBhbmQgc2F2\nZSB0aGVpciAKICAgICAgICAgICAgLy8gaW5kZXhlcwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGlmIChpc1Byb3BlcnR5QWNjZXNzKGZtZHNbaV0pKQogICAg\nICAgICAgICAgICAgICAgIHByb3BGbWRzLmFkZChpKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaWYgbm8gZmllbGRzIGhhdmUgcHJvcGVydHkg\nYWNjZXNzIGRvIG5vdCBkbyBhdHRyaWJ1dGUgdHJhbnNsYXRpb24KICAgICAg\nICAgICAgaWYgKHByb3BGbWRzLnNpemUoKSA9PSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3BjLmRlY2xhcmVJbnRl\ncmZhY2UoQXR0cmlidXRlVHJhbnNsYXRvci5jbGFzcyk7CiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkF0dHJp\nYnV0ZUluZGV4VG9GaWVsZE5hbWUiLAogICAgICAgICAgICBTdHJpbmcuY2xh\nc3MsIG5ldyBDbGFzc1tdIHsgaW50LmNsYXNzIH0pOwogICAgICAgIG1ldGhv\nZC5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdl\ndENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBpZiAoIV9tZXRh\nLmlzTWl4ZWRBY2Nlc3MoKSkgewogICAgICAgICAgICAvLyBpZiBub3QgbWl4\nZWQgYWNjZXNzIHVzZSBhIHRhYmxlIHN3aXRjaCBvbiBhbGwgcHJvcGVydHkt\nYmFzZWQgZm1kLgogICAgICAgICAgICAvLyBhIHRhYmxlIHN3aXRjaCBpcyBt\nb3JlIGVmZmljaWVudCB3aXRoICsxIGluY3JlbWVudGFsIG9wZXJhdGlvbnMK\nICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBj\nb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0\nYWJpbnMuc2V0TG93KDApOwogICAgICAgICAgICB0YWJpbnMuc2V0SGlnaChm\nbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAgICAgLy8gY2FzZSBpOgogICAg\nICAgICAgICAvLyAgICAgcmV0dXJuIDxfYXR0cnNUb0ZpZWxkcy5nZXQoZm1k\nc1tpXS5nZXROYW1lKCkpPgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYmlu\ncy5hZGRUYXJnZXQoY29kZS5jb25zdGFudCgpLnNldFZhbHVlKAogICAgICAg\nICAgICAgICAgICAgIF9hdHRyc1RvRmllbGRzLmdldChmbWRzW2ldLmdldE5h\nbWUoKSkpKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAg\nICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAg\nICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24K\nICAgICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MpKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIEluIG1peGVkIGFjY2VzcyBtb2RlLCBwcm9wZXJ0eSBpbmRleGVz\nIGFyZSBub3QgKzEgaW5jcmVtZW50YWwgCiAgICAgICAgICAgIC8vIGEgbG9v\na3VwIHN3aXRjaCBtdXN0IGJlIHVzZWQgdG8gZG8gaW5kZXhlZCBsb29rdXAu\nCiAgICAgICAgICAgIExvb2t1cFN3aXRjaEluc3RydWN0aW9uIGxvb2t1cGlu\ncyA9IGNvZGUubG9va3Vwc3dpdGNoKCk7CiAgICAgICAgICAgIAogICAgICAg\nICAgICBmb3IgKEludGVnZXIgaSA6IHByb3BGbWRzKSB7CiAgICAgICAgICAg\nICAgICBsb29rdXBpbnMuYWRkQ2FzZShpLAogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgKICAgICAgICAgICAgICAgICAg\nICBfYXR0cnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5nZXROYW1lKCkpKSk7CiAg\nICAgICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgfSAg\nICAgICAgICAgIAogICAgICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgICAgIGxvb2t1\ncGlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAg\nICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNz\nKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBuYW1lIG9mIHRo\nZSBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyBnZXRTZXR0ZXJOYW1lKEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgcmV0dXJuICJzZXQiICsgU3RyaW5n\nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgcmV0dXJuZWQgYnkgdGhlIGdp\ndmVuIG1ldGhvZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2FnZS1w\ncm90ZWN0ZWQgYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAg\nc3RhdGljIEJDRmllbGQgZ2V0UmV0dXJuZWRGaWVsZChCQ01ldGhvZCBtZXRo\nKSB7CiAgICAgICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLm5ld0NvZGVBY3Rpb24oKSkpLnhyZXR1cm4oKQogICAgICAgICAgICAu\nc2V0VHlwZShtZXRoLmdldFJldHVyblR5cGUoKSksIGZhbHNlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgYXNzaWduZWQgaW4g\ndGhlIGdpdmVuIG1ldGhvZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFj\na2FnZS1wcm90ZWN0ZWQgYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAq\nLwogICAgc3RhdGljIEJDRmllbGQgZ2V0QXNzaWduZWRGaWVsZChCQ01ldGhv\nZCBtZXRoKSB7CiAgICAgICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSkpLnB1dGZpZWxkKCksIHRydWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCByZXR1\ncm5lZCAvIGFzc2lnbmVkIGJ5IDxjb2RlPm1ldGg8L2NvZGU+LiBSZXR1cm5z\nCiAgICAgKiBudWxsIGlmIG5vbi1maWVsZHMgKG1ldGhvZHMsIGxpdGVyYWxz\nLCBwYXJhbWV0ZXJzLCB2YXJpYWJsZXMpIGFyZQogICAgICogcmV0dXJuZWQs\nIG9yIGlmIG5vbi1wYXJhbWV0ZXJzIGFyZSBhc3NpZ25lZCB0byBmaWVsZHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEJDRmllbGQgZmluZEZpZWxk\nKEJDTWV0aG9kIG1ldGgsIEluc3RydWN0aW9uIHRlbXBsYXRlLAogICAgICAg\nIGJvb2xlYW4gZmluZEFjY2Vzc2VkKSB7CiAgICAgICAgLy8gaWdub3JlIGFu\neSBzdGF0aWMgbWV0aG9kcy4gT3BlbkpQQSBvbmx5IGN1cnJlbnRseSBzdXBw\nb3J0cwogICAgICAgIC8vIG5vbi1zdGF0aWMgc2V0dGVycyBhbmQgZ2V0dGVy\ncwogICAgICAgIGlmIChtZXRoLmlzU3RhdGljKCkpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUo\nZmFsc2UpOwogICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAg\nICAgICAgQkNGaWVsZCBmaWVsZCA9IG51bGwsIGN1cjsKICAgICAgICBJbnN0\ncnVjdGlvbiB0ZW1wbGF0ZUlucywgcHJldklucywgZWFybGllckluczsKICAg\nICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewog\nICAgICAgICAgICBpbnQgYmFja3VwQ291bnQgPSAzOwogICAgICAgICAgICB0\nZW1wbGF0ZUlucyA9IGNvZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgaWYg\nKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICAgICAgcHJldklucyA9IGNvZGUucHJldmlvdXMoKTsK\nCiAgICAgICAgICAgIGlmIChwcmV2SW5zIGluc3RhbmNlb2YgQ2xhc3NJbnN0\ncnVjdGlvbgogICAgICAgICAgICAgICAgJiYgY29kZS5oYXNQcmV2aW91cygp\nKSB7CiAgICAgICAgICAgICAgICBwcmV2SW5zID0gY29kZS5wcmV2aW91cygp\nOwogICAgICAgICAgICAgICAgYmFja3VwQ291bnQrKzsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZWFybGllcklu\ncyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBv\ncGNvZGUgdHdvIGJlZm9yZSB0aGUgdGVtcGxhdGUgd2FzIGFuIGFsb2FkXzAs\nIGNoZWNrCiAgICAgICAgICAgIC8vIGFnYWluc3QgdGhlIG1pZGRsZSBpbnN0\ncnVjdGlvbiBiYXNlZCBvbiB3aGF0IHR5cGUgb2YgZmluZAogICAgICAgICAg\nICAvLyB3ZSdyZSBkb2luZwogICAgICAgICAgICBpZiAoIShlYXJsaWVySW5z\nIGluc3RhbmNlb2YgTG9hZEluc3RydWN0aW9uKQogICAgICAgICAgICAgICAg\nfHwgISgoTG9hZEluc3RydWN0aW9uKSBlYXJsaWVySW5zKS5pc1RoaXMoKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8g\naWYgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiB3YXMgYSBnZXRmaWVsZCwgdGhl\nbiBpdCdzIHRoZQogICAgICAgICAgICAvLyBmaWVsZCB0aGF0J3MgYmVpbmcg\nYWNjZXNzZWQKICAgICAgICAgICAgaWYgKCFmaW5kQWNjZXNzZWQgJiYgcHJl\ndklucyBpbnN0YW5jZW9mIEdldEZpZWxkSW5zdHJ1Y3Rpb24pIHsKICAgICAg\nICAgICAgICAgIGZpbmFsIEZpZWxkSW5zdHJ1Y3Rpb24gZlByZXZJbnMgPSAo\nRmllbGRJbnN0cnVjdGlvbikgcHJldkluczsKICAgICAgICAgICAgICAgIGN1\nciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldEZpZWxkSW5zdHJ1Y3Rpb25G\naWVsZEFjdGlvbihmUHJldklucykpOwogICAgICAgICAgICAgICAgLy8gaWYg\ndGhlIG1pZGRsZSBpbnN0cnVjdGlvbiB3YXMgYW4geGxvYWRfMSwgdGhlbiB0\naGUKICAgICAgICAgICAgICAgIC8vIG1hdGNoZWQgaW5zdHJ1Y3Rpb24gaXMg\ndGhlIGZpZWxkIHRoYXQncyBiZWluZyBzZXQuCiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoZmluZEFjY2Vzc2VkICYmIHByZXZJbnMgaW5zdGFuY2VvZiBMb2Fk\nSW5zdHJ1Y3Rpb24KICAgICAgICAgICAgICAgICYmICgoTG9hZEluc3RydWN0\naW9uKSBwcmV2SW5zKS5nZXRQYXJhbSgpID09IDApIHsKICAgICAgICAgICAg\nICAgIGZpbmFsIEZpZWxkSW5zdHJ1Y3Rpb24gZlRlbXBsYXRlSW5zID0KICAg\nICAgICAgICAgICAgICAgICAoRmllbGRJbnN0cnVjdGlvbikgdGVtcGxhdGVJ\nbnM7CiAgICAgICAgICAgICAgICBjdXIgPSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgICAg\nIC5nZXRGaWVsZEluc3RydWN0aW9uRmllbGRBY3Rpb24oZlRlbXBsYXRlSW5z\nKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBjdXIg\nIT0gZmllbGQpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICAgICAgZmllbGQgPSBjdXI7CgogICAgICAgICAgICAvLyByZWFkeSBmb3Ig\nbmV4dCBzZWFyY2ggaXRlcmF0aW9uCiAgICAgICAgICAgIHdoaWxlIChiYWNr\ndXBDb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwog\nICAgICAgICAgICAgICAgYmFja3VwQ291bnQtLTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZmllbGQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWNvcmQgYSB2aW9sYXRpb24gb2YgdGhlIHByb3BlcnR5IGFj\nY2VzcyByZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRWaW9sYXRpb24oU3RyaW5nIGtleSwgT2JqZWN0W10gYXJncywgYm9vbGVh\nbiBmYXRhbCkgewogICAgICAgIGlmIChfdmlvbGF0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICBfdmlvbGF0aW9ucyA9IG5ldyBIYXNoU2V0KCk7CiAgICAg\nICAgX3Zpb2xhdGlvbnMuYWRkKF9sb2MuZ2V0KGtleSwgYXJncykpOwogICAg\nICAgIF9mYWlsIHw9IGZhdGFsOwogICAgfQoKICAgIC8qKgogICAgICogTG9n\nIC8gdGhyb3cgcmVjb3JkZWQgcHJvcGVydHkgYWNjZXNzIHZpb2xhdGlvbnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcm9jZXNzVmlvbGF0aW9ucygp\nIHsKICAgICAgICBpZiAoX3Zpb2xhdGlvbnMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBTdHJpbmcgc2VwID0gSjJEb1ByaXZIZWxw\nZXIuZ2V0TGluZVNlcGFyYXRvcigpOwogICAgICAgIFN0cmluZ0J1ZmZlciBi\ndWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBfdmlvbGF0aW9ucy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICBidWYuYXBwZW5kKGl0ci5uZXh0KCkpOwogICAg\nICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoc2VwKTsKICAgICAgICB9CiAgICAgICAgTWVzc2FnZSBtc2cg\nPSBfbG9jLmdldCgicHJvcGVydHktdmlvbGF0aW9ucyIsIGJ1Zik7CgogICAg\nICAgIGlmIChfZmFpbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24obXNnKTsKICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgIF9sb2cud2Fybihtc2cpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVwbGFjZWQgYWxsIGRpcmVjdCBhY2Nlc3MgdG8gbWFuYWdlZCBm\naWVsZHMgd2l0aCB0aGUgYXBwcm9wcmlhdGUKICAgICAqIHBjR2V0L3BjU2V0\nIG1ldGhvZC4gTm90ZSB0aGF0IHRoaXMgaW5jbHVkZXMgYWNjZXNzIHRvIGZp\nZWxkcwogICAgICogb3duZWQgYnkgUGVyc2lzdGVuY2VDYXBhYmxlIGNsYXNz\nZXMgb3RoZXIgdGhhbiB0aGlzIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKCkgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gY3JlYXRlIHRlbXBs\nYXRlIHB1dGZpZWxkL2dldGZpZWxkIGluc3RydWN0aW9ucyB0byBzZWFyY2gg\nZm9yCiAgICAgICAgQ29kZSB0ZW1wbGF0ZSA9IEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdD\nb2RlQWN0aW9uKCkpOwogICAgICAgIEluc3RydWN0aW9uIHB1dCA9IHRlbXBs\nYXRlLnB1dGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1Y3Rpb24gZ2V0ID0gdGVt\ncGxhdGUuZ2V0ZmllbGQoKTsKICAgICAgICBJbnN0cnVjdGlvbiBzdGF0ID0g\ndGVtcGxhdGUuaW52b2tlc3RhdGljKCk7CgogICAgICAgIC8vIGxvb2sgdGhy\nb3VnaCBhbGwgbWV0aG9kczsgdGhpcyBpcyBkb25lIGJlZm9yZSBhbnkgbWV0\naG9kcyBhcmUgYWRkZWQKICAgICAgICAvLyBzbyB3ZSBkb24ndCBuZWVkIHRv\nIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBzeW50aGV0aWMgbWV0aG9kcy4KICAg\nICAgICBCQ01ldGhvZFtdIG1ldGhvZHMgPSBfbWFuYWdlZFR5cGUuZ2V0RGVj\nbGFyZWRNZXRob2RzKCk7CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBjb2RlID0gbWV0aG9kc1tpXS5nZXRDb2RlKGZhbHNlKTsKCiAg\nICAgICAgICAgIC8vIGRvbid0IG1vZGlmeSB0aGUgbWV0aG9kcyBzcGVjaWZp\nZWQgYnkgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMKICAgICAgICAgICAgaWYg\nKGNvZGUgIT0gbnVsbCAmJiAhc2tpcEVuaGFuY2UobWV0aG9kc1tpXSkpIHsK\nICAgICAgICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNz\nKGNvZGUsIGdldCwgdHJ1ZSwgc3RhdCk7CiAgICAgICAgICAgICAgICByZXBs\nYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBwdXQsIGZhbHNlLCBz\ndGF0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJlcGxhY2VzIGFsbCBpbnN0cnVjdGlvbnMgbWF0Y2hpbmcgdGhl\nIGdpdmVuIHRlbXBsYXRlIGluIHRoZSBnaXZlbgogICAgICogY29kZSBibG9j\nayB3aXRoIGNhbGxzIHRvIHRoZSBhcHByb3ByaWF0ZSBnZW5lcmF0ZWQgZ2V0\ndGVyL3NldHRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gY29kZSB0aGUgY29k\nZSBibG9jayB0byBtb2RpZnk7IHRoZSBjb2RlIGl0ZXJhdG9yIHdpbGwKICAg\nICAqIGJlIHBsYWNlZCBiZWZvcmUgdGhlIGZpcnN0IGluc3RydWN0aW9uIG9u\nIG1ldGhvZCBzdGFydCwKICAgICAqIGFuZCB3aWxsIGJlIGFmdGVyIHRoZSBs\nYXN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBjb21wbGV0aW9uCiAgICAgKiBA\ncGFyYW0gaW5zIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlvbiB0byBzZWFyY2gg\nZm9yOyBlaXRoZXIgYQogICAgICogZ2V0ZmllbGQgb3IgcHV0ZmllbGQgaW5z\ndHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBnZXQgYm9vbGVhbiBpbmRpY2F0aW5n\nIGlmIHRoaXMgaXMgYSBnZXQgaW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBz\ndGF0IHRlbXBsYXRlIGludm9rZXN0YXRpYyBpbnN0cnVjdGlvbiB0byByZXBs\nYWNlIHdpdGgKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRW\nYWxpZGF0ZUZpZWxkQWNjZXNzKENvZGUgY29kZSwgSW5zdHJ1Y3Rpb24gaW5z\nLAogICAgICAgIGJvb2xlYW4gZ2V0LCBJbnN0cnVjdGlvbiBzdGF0KSB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBjb2RlLmJlZm9y\nZUZpcnN0KCk7CgogICAgICAgIEZpZWxkSW5zdHJ1Y3Rpb24gZmk7CiAgICAg\nICAgTWV0aG9kSW5zdHJ1Y3Rpb24gbWk7CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBvd25lcjsKICAgICAgICBTdHJpbmcgbmFtZSwgdHlwZU5hbWUsIG1ldGhv\nZE5hbWU7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2FyZChpbnMp\nKSB7CiAgICAgICAgICAgIC8vIGJhY2sgdXAgdG8gdGhlIG1hdGNoZWQgaW5z\ndHJ1Y3Rpb24KICAgICAgICAgICAgZmkgPSAoRmllbGRJbnN0cnVjdGlvbikg\nY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICBuYW1lID0gZmkuZ2V0Rmll\nbGROYW1lKCk7CiAgICAgICAgICAgIHR5cGVOYW1lID0gZmkuZ2V0RmllbGRU\neXBlTmFtZSgpOwogICAgICAgICAgICBvd25lciA9IGdldFBlcnNpc3RlbmNl\nQ2FwYWJsZU93bmVyKG5hbWUsIGZpLmdldEZpZWxkRGVjbGFyZXJUeXBlKCkp\nOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IG93bmVyID09IG51\nbGwgPyBudWxsIDogb3duZXIuZ2V0RmllbGQobmFtZSk7CiAgICAgICAgICAg\nIGlmIChpc1Byb3BlcnR5QWNjZXNzKGZtZCkpIHsKICAgICAgICAgICAgICAg\nIC8vIGlmIHdlJ3JlIGRpcmVjdGx5IGFjY2Vzc2luZyBhIGZpZWxkIGluIGFu\nb3RoZXIgY2xhc3MKICAgICAgICAgICAgICAgIC8vIGhpZXJhcmNoeSB0aGF0\nIHVzZXMgcHJvcGVydHkgYWNjZXNzLCBzb21ldGhpbmcgaXMgd3JvbmcKICAg\nICAgICAgICAgICAgIGlmIChvd25lciAhPSBfbWV0YSAmJiBvd25lci5nZXRE\nZWNsYXJlZEZpZWxkKG5hbWUpICE9IG51bGwgJiYKICAgICAgICAgICAgICAg\nICAgICBfbWV0YSAhPSBudWxsICYmICFvd25lci5nZXREZXNjcmliZWRUeXBl\nKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmlzQXNzaWduYWJsZUZyb20o\nX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicHJvcGVydHkt\nZmllbGQtYWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBfbWV0YSwgb3duZXIsIG5hbWUsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb2RlLmdldE1ldGhvZCgpLmdldE5hbWUoKSB9KSk7Cgog\nICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgZGlyZWN0bHkgYWNjZXNzaW5n\nIGEgcHJvcGVydHktYmFja2luZyBmaWVsZCBvdXRzaWRlCiAgICAgICAgICAg\nICAgICAvLyB0aGUgcHJvcGVydHkgaW4gb3VyIG93biBjbGFzcywgbm90aWZ5\nIHVzZXIKICAgICAgICAgICAgICAgIGlmIChpc0JhY2tpbmdGaWVsZE9mQW5v\ndGhlclByb3BlcnR5KG5hbWUsIGNvZGUpKQogICAgICAgICAgICAgICAgICAg\nIGFkZFZpb2xhdGlvbigicHJvcGVydHktZmllbGQtYWNjZXNzIiwgbmV3IE9i\namVjdFtdeyBfbWV0YSwKICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIs\nIG5hbWUsIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpIH0sIGZhbHNlKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG93bmVyID09IG51bGwg\nfHwKICAgICAgICAgICAgICAgIG93bmVyLmdldERlY2xhcmVkRmllbGQoZnJv\nbUJhY2tpbmdGaWVsZE5hbWUobmFtZSkpID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIC8vIG5vdCBwZXJzaXN0ZW50IGZpZWxkPwogICAgICAgICAgICAg\nICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgfSBlbHNlIGlmICghZ2V0UmVkZWZpbmUoKSAmJiAhZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKQogICAgICAgICAgICAgICAgJiYgaXNGaWVsZEFjY2Vz\ncyhmbWQpKSB7CiAgICAgICAgICAgICAgICAvLyByZXBsYWNlIHRoZSBpbnN0\ncnVjdGlvbiB3aXRoIGEgY2FsbCB0byB0aGUgZ2VuZXJhdGVkIGFjY2Vzcwog\nICAgICAgICAgICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAgICAgICBtaSA9\nIChNZXRob2RJbnN0cnVjdGlvbikgY29kZS5zZXQoc3RhdCk7CgogICAgICAg\nICAgICAgICAgLy8gaW52b2tlIHRoZSBwcm9wZXIgYWNjZXNzIG1ldGhvZCwg\nd2hldGhlciBnZXR0ZXIgb3Igc2V0dGVyCiAgICAgICAgICAgICAgICBTdHJp\nbmcgcHJlZml4ID0gKGdldCkgPyBQUkUgKyAiR2V0IiA6IFBSRSArICJTZXQi\nOwogICAgICAgICAgICAgICAgbWV0aG9kTmFtZSA9IHByZWZpeCArIG5hbWU7\nCiAgICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAgICAgICAgICAg\nICAgbWkuc2V0TWV0aG9kKGdldFR5cGUob3duZXIpLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZSwgdHlwZU5hbWUsIG5l\ndyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGdldFR5cGUo\nb3duZXIpLmdldE5hbWUoKSB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgbWkuc2V0TWV0aG9kKGdldFR5cGUob3du\nZXIpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9k\nTmFtZSwgInZvaWQiLCBuZXcgU3RyaW5nW10KICAgICAgICAgICAgICAgICAg\nICAgICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1lKCksIHR5cGVOYW1lIH0p\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29kZS5uZXh0\nKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2V0UmVkZWZpbmUoKSkgewog\nICAgICAgICAgICAgICAgbmFtZSA9IGZyb21CYWNraW5nRmllbGROYW1lKG5h\nbWUpOwogICAgICAgICAgICAgICAgaWYgKGdldCkgewogICAgICAgICAgICAg\nICAgICAgIGFkZE5vdGlmeUFjY2Vzcyhjb2RlLCBvd25lci5nZXRGaWVsZChu\nYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGlu\nc2VydCB0aGUgc2V0IG9wZXJhdGlvbnMgYWZ0ZXIgdGhlIGZpZWxkIG11dGF0\naW9uLCBidXQKICAgICAgICAgICAgICAgICAgICAvLyBmaXJzdCBsb2FkIHRo\nZSBvbGQgdmFsdWUgZm9yIHVzZSBpbiB0aGUKICAgICAgICAgICAgICAgICAg\nICAvLyBTdGF0ZU1hbmFnZXIuc2V0dGluZ1hYWCBtZXRob2QuCiAgICAgICAg\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0cnVjdGlvbiBm\nRmkgPSBmaTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoCiAgICAgICAgICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuZ2V0RmllbGRJbnN0cnVjdGlvbkZpZWxkQWN0\naW9uKGZGaSkpKTsKICAgICAgICAgICAgICAgICAgICBpbnQgdmFsID0gY29k\nZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLnhzdG9yZSgpLnNldExvY2FsKHZhbCkuc2V0VHlwZShmaS5nZXRGaWVs\nZFR5cGUoKSk7CgogICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgcGFzdCB0\naGUgcHV0ZmllbGQKICAgICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsK\nICAgICAgICAgICAgICAgICAgICBhZGROb3RpZnlNdXRhdGlvbihjb2RlLCBv\nd25lci5nZXRGaWVsZChuYW1lKSwgdmFsLCAtMSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBh\nZGROb3RpZnlBY2Nlc3MoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIC8vIFBDSGVscGVyLmFjY2Vzc2luZ0ZpZWxkKHRoaXMsIDxh\nYnNvbHV0ZS1pbmRleD4pOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJ\nbmRleCgpKTsKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICJhY2Nl\nc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MgfSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGlzIG11c3QgYmUgY2FsbGVkIGFmdGVyIHNldHRpbmcg\ndGhlIHZhbHVlIGluIHRoZSBvYmplY3QuCiAgICAgKiAKICAgICAqIEBwYXJh\nbSBjb2RlCiAgICAgKiBAcGFyYW0gdmFsIHRoZSBwb3NpdGlvbiBpbiB0aGUg\nbG9jYWwgdmFyaWFibGUgdGFibGUgd2hlcmUgdGhlCiAgICAgKiBvbGQgdmFs\ndWUgaXMgc3RvcmVkCiAgICAgKiBAcGFyYW0gcGFyYW0gdGhlIHBhcmFtZXRl\nciBwb3NpdGlvbiBjb250YWluaW5nIHRoZSBuZXcgdmFsdWUsIG9yCiAgICAg\nKiAtMSBpZiB0aGUgbmV3IHZhbHVlIGlzIHVuYXZhaWxhYmxlIGFuZCBzaG91\nbGQgdGhlcmVmb3JlIGJlIGxvb2tlZAogICAgICogdXAuCiAgICAgKiBAdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkTm90aWZ5TXV0YXRpb24oQ29kZSBjb2RlLCBGaWVsZE1ldGFE\nYXRhIGZtZCwgaW50IHZhbCwKICAgICAgICBpbnQgcGFyYW0pCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gUENI\nZWxwZXIuc2V0dGluZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0ZS1pbmRleD4sIG9s\nZCwgbmV3KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7\nCiAgICAgICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsK\nICAgICAgICAvLyB3ZSBvbmx5IGhhdmUgc3BlY2lhbCBzaWduYXR1cmVzIGZv\nciBwcmltaXRpdmVzIGFuZCBTdHJpbmdzCiAgICAgICAgaWYgKCF0eXBlLmlz\nUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBTdHJpbmcuY2xhc3MpCiAgICAgICAg\nICAgIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS54bG9hZCgp\nLnNldExvY2FsKHZhbCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAocGFy\nYW0gPT0gLTEpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBj\nb2RlLnhsb2FkKCkuc2V0UGFyYW0ocGFyYW0pLnNldFR5cGUodHlwZSk7CiAg\nICAgICAgfQogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKFJlZGVmaW5pdGlvbkhlbHBlci5jbGFzcywgInNldHRpbmdGaWVsZCIsCiAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgaW50LmNsYXNzLCB0eXBlLCB0eXBlCiAg\nICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBp\nZiB0aGUgZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNzZXMgYSBmaWVsZCB0aGF0\nIGlzIGEgYmFja2luZwogICAgICogZmllbGQgb2YgYW5vdGhlciBwcm9wZXJ0\neSBpbiB0aGlzIHByb3BlcnR5LWFjY2VzcyBjbGFzcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJvcGVy\ndHkoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewogICAgICAgIFN0cmluZyBt\nZXRoTmFtZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpOwogICAgICAg\nIHJldHVybiAhIjxpbml0PiIuZXF1YWxzKG1ldGhOYW1lKQogICAgICAgICAg\nICAmJiBfYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAgICAgICAgICAgICYmICFu\nYW1lLmVxdWFscyhfYmFja2luZ0ZpZWxkcy5nZXQobWV0aE5hbWUpKQogICAg\nICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcy5jb250YWluc1ZhbHVlKG5hbWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1\ncm4gdGhlIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3Mgb2YK\nICAgICAqIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZmllbGROYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFt\nIG93bmVyIHRoZSBub21pbmFsIG93bmVyIG9mIHRoZSBmaWVsZAogICAgICog\nQHJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQZXJzaXN0ZW5jZUNhcGFi\nbGUgdHlwZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0aGUgZmllbGQgKGFuZCB0\naGVyZWZvcmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9kKSwgb3IgbnVsbCBpZiBu\nb25lCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRQZXJz\naXN0ZW5jZUNhcGFibGVPd25lcihTdHJpbmcgZmllbGROYW1lLAogICAgICAg\nIENsYXNzIG93bmVyKSB7CiAgICAgICAgLy8gZmluZCB0aGUgYWN0dWFsIGFu\nY2VzdG9yIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhlIGZpZWxkLCB0aGVuCiAg\nICAgICAgLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlzIHBlcnNpc3RlbnQsIGFu\nZCBpZiB0aGUgZmllbGQgaXMgbWFuYWdlZAogICAgICAgIEZpZWxkIGYgPSBS\nZWZsZWN0aW9uLmZpbmRGaWVsZChvd25lciwgZmllbGROYW1lLCBmYWxzZSk7\nCiAgICAgICAgaWYgKGYgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNlCiAgICAgICAgaWYg\nKF9tZXRhICE9IG51bGwgJiYgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlz\nSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHJldHVybiBfbWV0YTsKCiAgICAg\nICAgcmV0dXJuIF9yZXBvcy5nZXRNZXRhRGF0YShmLmdldERlY2xhcmluZ0Ns\nYXNzKCksIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYWxsIHN5bnRoZXRpYyBtZXRob2RzIHRvIHRoZSBieXRlY29kZSBieSBk\nZWxlZ2F0aW5nIHRvCiAgICAgKiB0aGUgdmFyaW91cyBhZGRYWFhNZXRob2Rz\nICgpIGZ1bmN0aW9ucyBpbiB0aGlzIGNsYXNzLiBJbmNsdWRlcwogICAgICog\nYWxsIHN0YXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcy4KICAgICAqIE5vdGUg\ndGhhdCB0aGUgJ3N0b2NrJyBtZXRob2RzIGxpa2UgPGNvZGU+cGNJc1RyYW5z\nYWN0aW9uYWw8L2NvZGU+LAogICAgICogPGNvZGU+cGNGZXRjaE9iamVjdElk\nPC9jb2RlPiwgZXRjIGFyZSBkZWZpbmVkIG9ubHkgaW4gdGhlCiAgICAgKiBs\nZWFzdC1kZXJpdmVkIFBlcnNpc3RlbmNlQ2FwYWJsZSB0eXBlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkUENNZXRob2RzKCkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBhZGRDbGVhckZp\nZWxkc01ldGhvZCgpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKHRy\ndWUpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAg\nICAgICBhZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhvZCgpOwogICAgICAgIGFk\nZFJlcGxhY2VGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRkUHJvdmlkZUZp\nZWxkc01ldGhvZHMoKTsKICAgICAgICBhZGRDb3B5RmllbGRzTWV0aG9kKCk7\nCgogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxs\nIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgYWRkU3Rv\nY2tNZXRob2RzKCk7CiAgICAgICAgICAgIGFkZEdldFZlcnNpb25NZXRob2Qo\nKTsKICAgICAgICAgICAgYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1ldGhvZCgp\nOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpICE9\nIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAg\nICBhZGROb09wQXBwbGljYXRpb25JZGVudGl0eU1ldGhvZHMoKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGFkZCB0aGUgYXBwIGlkIG1ldGhvZHMgdG8gZWFj\naCBzdWJjbGFzcyByYXRoZXIKICAgICAgICAvLyB0aGFuIGp1c3QgdGhlIHN1\ncGVyY2xhc3MsIHNpbmNlIGl0IGlzIHBvc3NpYmxlIHRvIGhhdmUKICAgICAg\nICAvLyBhIHN1YmNsYXNzIHdpdGggYW4gYXBwIGlkIGhpZXJhcmNoeSB0aGF0\nIG1hdGNoZXMgdGhlCiAgICAgICAgLy8gcGVyc2lzdGVudCBjbGFzcyBpbmhl\ncml0YW5jZSBoaWVyYXJjaHkKICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTgogICAg\nICAgICAgICAmJiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8\nfCBnZXRDcmVhdGVTdWJjbGFzcygpIHx8CiAgICAgICAgICAgICAgICBfbWV0\nYS5nZXRPYmplY3RJZFR5cGUoKSAhPQogICAgICAgICAgICAgICAgICAgIF9t\nZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0T2JqZWN0SWRUeXBl\nKCkpKSB7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElk\nTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAgIGFkZENvcHlLZXlG\naWVsZHNGcm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7CiAgICAgICAgICAgIGFk\nZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAg\nICAgICAgICBpZiAoX21ldGEuaGFzQWJzdHJhY3RQS0ZpZWxkKCkgPT0gdHJ1\nZSkgeyAKICAgICAgICAgICAgICAgIGFkZEdldElET3duaW5nQ2xhc3MoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBhZGROZXdPYmplY3RJZEluc3Rh\nbmNlTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGROZXdPYmplY3RJZElu\nc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBp\nZiAoX21ldGEuaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFzcygpKXsgCiAg\nICAgICAgICAgIGFkZEdldElET3duaW5nQ2xhc3MoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBtZXRob2QgdG8gY2xlYXIgYWxs\nIHBlcnNpc3RlbnQgZmllbGRzOyB3ZSdsbCBjYWxsIHRoaXMgZnJvbQogICAg\nICogdGhlIG5ldyBpbnN0YW5jZSBtZXRob2QgdG8gZW5zdXJlIHRoYXQgdW5s\nb2FkZWQgZmllbGRzIGhhdmUKICAgICAqIGRlZmF1bHQgdmFsdWVzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xlYXJGaWVsZHNNZXRob2QoKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIC8vIHByb3RlY3RlZCB2b2lkIHBjQ2xlYXJGaWVsZHMgKCkKICAgICAgICBC\nQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ2xl\nYXJGaWVsZHMiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAg\nICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci5w\nY0NsZWFyRmllbGRzICgpCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJj\nbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEu\nCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKSwg\nUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nICAgIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRh\nRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJPT0xFQU46CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRF\nOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoMEQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9CgogICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNOZXdJbnN0YW5jZTwv\nY29kZT4gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqIFRoZXNlIG1l\ndGhvZHMgYXJlIHVzZWQgYnkgdGhlIGltcGwgaGVscGVyIHRvIGNyZWF0ZSBu\nZXcKICAgICAqIG1hbmFnZWQgaW5zdGFuY2VzIGVmZmljaWVudGx5IHdpdGhv\ndXQgcmVmbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gb2lkIHNldCB0\nbyB0cnVlIHRvIG1pbWljIHRoZSBtZXRob2QgdmVyc2lvbiB0aGF0IHRha2Vz\nCiAgICAgKiBhbiBvaWQgdmFsdWUgYXMgd2VsbCBhcyBhIHN0YXRlIG1hbmFn\nZXIKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5ld0luc3RhbmNlTWV0\naG9kKGJvb2xlYW4gb2lkKSB7CiAgICAgICAgLy8gcHVibGljIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwY05ld0luc3RhbmNlICguLi4pCiAgICAgICAgQ2xhc3Nb\nXSBhcmdzID0KICAgICAgICAgICAgKG9pZCkgPyBuZXcgQ2xhc3NbXXsgU01U\nWVBFLCBPYmplY3QuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfQogICAgICAgICAg\nICAgICAgOiBuZXcgQ2xhc3NbXXsgU01UWVBFLCBib29sZWFuLmNsYXNzIH07\nCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgIk5ld0luc3RhbmNlIiwgUENUWVBFLCBhcmdzKTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\naWYgdGhlIHR5cGUgaXMgYWJzdHJhY3QsIHRocm93IGEgVXNlckV4Y2VwdGlv\nbgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKSB7CiAgICAgICAgICAg\nIHRocm93RXhjZXB0aW9uKGNvZGUsIFVTRVJFWENFUCk7CiAgICAgICAgICAg\nIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAv\nLyBYWFggcGMgPSBuZXcgWFhYICgpOwogICAgICAgIGNvZGUuYW5ldygpLnNl\ndFR5cGUoX3BjKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFz\ncywgbnVsbCk7CiAgICAgICAgaW50IGluc3QgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaW5z\ndCk7CgogICAgICAgIC8vIGlmIChjbGVhcikKICAgICAgICAvLyAgIHBjLnBj\nQ2xlYXJGaWVsZHMgKCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFt\nKChvaWQpID8gMiA6IDEpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBub2Ns\nZWFyID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKGluc3QpOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLCBudWxsKTsK\nCiAgICAgICAgLy8gcGMucGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAgICBu\nb2NsZWFyLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCkp\nOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBj\nb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CgogICAgICAg\nIC8vIGNvcHkga2V5IGZpZWxkcyBmcm9tIG9pZAogICAgICAgIGlmIChvaWQp\nIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiQ29w\neUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgICAgICB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAg\nIH0KCiAgICAgICAgLy8gcmV0dXJuIHBjOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGRzIHRoZSA8Y29kZT5wcm90ZWN0ZWQgc3RhdGljIGludCBwY0dldE1hbmFn\nZWRGaWVsZENvdW50ICgpPC9jb2RlPgogICAgICogbWV0aG9kIHRvIHRoZSBi\neXRlY29kZSwgcmV0dXJuaW5nIHRoZSBpbmhlcml0ZWQgZmllbGQgY291bnQg\nYWRkZWQKICAgICAqIHRvIHRoZSBudW1iZXIgb2YgbWFuYWdlZCBmaWVsZHMg\naW4gdGhlIGN1cnJlbnQgUGVyc2lzdGVuY2VDYXBhYmxlIGNsYXNzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFuYWdlZEZpZWxkQ291bnRNZXRo\nb2QoKSB7CiAgICAgICAgLy8gcHJvdGVjdGVkIHN0YXRpYyBpbnQgcGNHZXRN\nYW5hZ2VkRmllbGRDb3VudCAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRNYW5hZ2VkRmllbGRDb3Vu\ndCIsCiAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0\naG9kLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBtZXRob2QubWFrZVByb3Rl\nY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwoKICAgICAgICAvLyByZXR1cm4gPGZpZWxkcz4gKyBwY0luaGVyaXRl\nZEZpZWxkQ291bnQKICAgICAgICAvLyBhd2hpdGU6IHRoZSBhYm92ZSBzaG91\nbGQgd29yaywgYnV0IEknbSBzZWVpbmcgYSBtZXNzZWQgdXAgc2l0dWF0aW9u\nCiAgICAgICAgLy8gYWxsIG9mIGEgc3VkZGVuIHdoZXJlIHdoZW4gYSBzdWJj\nbGFzcyBjYWxscyB0aGlzIG1ldGhvZCwgaXQgc29tZWhvdwogICAgICAgIC8v\nIGhhcHBlbnMgYmVmb3JlIDxjbGluaXQ+IGlzIGV2ZXIgaW52b2tlZCwgYW5k\nIHNvIG91cgogICAgICAgIC8vIHBjSW5oZXJpdGVkRmllbGRDb3VudCBmaWVs\nZCBpc24ndCBpbml0aWFsaXplZCEgIHNvIGluc3RlYWQsCiAgICAgICAgLy8g\ncmV0dXJuIDxmaWVsZHM+ICsgPHN1cGVyY2xhc3M+LnBjR2V0TWFuYWdlZEZp\nZWxkQ291bnQgKCkKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKS5sZW5ndGgpOwogICAgICAgIGlm\nIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIENsYXNzIHN1cGVyQ2xhc3MgPSBnZXRUeXBlKF9tZXRhLmdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkpOwogICAgICAgICAgICBTdHJpbmcgc3VwZXJO\nYW1lID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/CiAgICAgICAgICAgICAgICBQ\nQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoc3VwZXJDbGFzcykgOgogICAg\nICAgICAgICAgICAgc3VwZXJDbGFzcy5nZXROYW1lKCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKHN1cGVyTmFtZSwKICAg\nICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmllbGRDb3VudCIsIGlu\ndC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAgICAgICBjb2RlLmlh\nZGQoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pcmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1By\nb3ZpZGVGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsgUGVyc2lzdGVuY2VDYXBh\nYmxlI3BjUHJvdmlkZUZpZWxkc30gbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm92aWRlRmllbGRzTWV0\naG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNQcm92aWRlRmllbGQgKGludCBm\naWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxkIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAg\nICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQogICAg\nICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0aG9kKFBSRSArICJQ\ncm92aWRlRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8gaWYgbm8gZmllbGRz\nIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRpb24KICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBf\nbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERlY2xh\ncmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDApCiAg\nICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0\nTG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3aXRjaEluc3Ry\ndWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAg\nICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFiaW5zLnNldEhp\nZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIC8vIDxmaWVsZD4g\nPSBwY1N0YXRlTWFuYWdlci5wcm92aWRlZDx0eXBlPkZpZWxkCiAgICAgICAg\nICAgIC8vICAgICAodGhpcywgZmllbGROdW1iZXIpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAgICAgICAgICAgICAgICAo\nZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgInByb3ZpZGVkIiwgZmFsc2Us\nIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cgbmV3\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0YWJp\nbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAg\nICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykp\nOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAg\nIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNl\nQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsgUGVy\nc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkc30gbWV0aG9kcyB0byB0\naGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZXBs\nYWNlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNSZXBsYWNl\nRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVwbGFjZUZpZWxkIiwg\ndm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFz\ncyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3\naXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0\naG9kKFBSRSArICJSZXBsYWNlRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8g\naWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRp\nb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1\nYmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9t\nZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2Rl\nLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJs\nZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2go\nKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAg\ndGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAg\nIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNlPHR5cGU+Rmll\nbGQKICAgICAgICAgICAgLy8gICh0aGlzLCBmaWVsZE51bWJlcik7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBhZGRTZXRNYW5hZ2VkVmFs\ndWVDb2RlIGNhbGwgYmVsb3cuCiAgICAgICAgICAgICAgICB0YWJpbnMuYWRk\nVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UsIGZtZHNb\naV0pKTsKCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UsIGZtZHNbaV0pOwog\nICAgICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2Qo\nZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgICAgICAgICAgKGZt\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksICJyZXBsYWNlIiwgdHJ1ZSwgZmFs\nc2UpKTsKICAgICAgICAgICAgICAgIGlmICghZm1kc1tpXS5nZXREZWNsYXJl\nZFR5cGUoKS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZSgpKTsKCiAgICAgICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIGZtZHNbaV0pOwogICAgICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRo\ncm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAg\nICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAg\nICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24u\nY2xhc3MpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoK\nICAgICAgICBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9k\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJz\naXN0ZW5jZUNhcGFibGUjcGNDb3B5RmllbGRzfSBtZXRob2QgdG8gdGhlIGJ5\ndGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUZpZWxk\nc01ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5RmllbGQgKE9iamVj\ndCBwYywgaW50IGZpZWxkKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5RmllbGQiLAogICAgICAgICAg\nICB2b2lkLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgbmV3IFN0cmlu\nZ1tdeyBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBpbnQuY2xhc3MuZ2V0TmFt\nZSgpIH0pOwogICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAg\nIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAg\nICAgICBpbnQgcmVsTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAi\nQ29weUZpZWxkIiwgY29kZSk7CgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBp\nbiB0aGlzIGluc3QsIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21l\ndGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAg\nICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24uY2xhc3MpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAv\nLyBzd2l0Y2ggKHZhbCkKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExv\nY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVj\ndGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAg\nIHRhYmlucy5zZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdo\nKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIC8v\nIDxmaWVsZD4gPSBvdGhlci48ZmllbGQ+OwogICAgICAgICAgICAgICAgLy8g\nb3Igc2V0PGZpZWxkPiAob3RoZXIuZ2V0PGZpZWxkPik7CiAgICAgICAgICAg\nICAgICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UsIGZtZHNbaV0pKTsKICAgICAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsK\nCiAgICAgICAgICAgICAgICAvLyBicmVhazsKICAgICAgICAgICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBk\nZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgp\nCiAgICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhj\nZXB0aW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhM\nb2NhbHMoKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJz\naW9uKG1ldGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0\naG9kIHRvIGFkZCB0aGUgY29kZSBjb21tb24gdG8gdGhlIGJlZ2lubmluZyBv\nZiBib3RoIHRoZQogICAgICogcGNSZXBsYWNlRmllbGQgbWV0aG9kIGFuZCB0\naGUgcGNQcm92aWRlRmllbGQgbWV0aG9kLiBUaGlzIGluY2x1ZGVzCiAgICAg\nKiBjYWxjdWxhdGluZyB0aGUgcmVsYXRpdmUgZmllbGQgbnVtYmVyIG9mIHRo\nZSBkZXNpcmVkIGZpZWxkIGFuZCBjYWxsaW5nCiAgICAgKiB0aGUgc3VwZXJj\nbGFzcyBpZiBuZWNlc3NhcnkuCiAgICAgKgogICAgICogQHJldHVybiB0aGUg\naW5kZXggaW4gd2hpY2ggdGhlIGxvY2FsIHZhcmlhYmxlIGhvbGRpbmcgdGhl\nIHJlbGF0aXZlCiAgICAgKiBmaWVsZCBudW1iZXIgaXMgc3RvcmVkCiAgICAg\nKi8KICAgIHByaXZhdGUgaW50IGJlZ2luU3dpdGNoTWV0aG9kKFN0cmluZyBu\nYW1lLCBDb2RlIGNvZGUpIHsKICAgICAgICBib29sZWFuIGNvcHkgPSAoUFJF\nICsgIkNvcHlGaWVsZCIpLmVxdWFscyhuYW1lKTsKICAgICAgICBpbnQgZmll\nbGROdW1iZXIgPSAoY29weSkgPyAxIDogMDsKCiAgICAgICAgaW50IHJlbExv\nY2FsID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBpZiAo\nZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBjb2RlLmlsb2Fk\nKCkuc2V0UGFyYW0oZmllbGROdW1iZXIpOwogICAgICAgICAgICBjb2RlLmlz\ndG9yZSgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgcmV0dXJu\nIHJlbExvY2FsOwogICAgICAgIH0KCiAgICAgICAgLy8gaW50IHJlbCA9IGZp\nZWxkTnVtYmVyIC0gcGNJbmhlcml0ZWRGaWVsZENvdW50CiAgICAgICAgY29k\nZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsKICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAg\nICAgICAgY29kZS5pc3ViKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRM\nb2NhbChyZWxMb2NhbCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2Fs\nKHJlbExvY2FsKTsKCiAgICAgICAgLy8gc3VwZXI6IGlmIChyZWwgPCAwKSBz\ndXBlci5wY1JlcGxhY2VGaWVsZCAoZmllbGROdW1iZXIpOyByZXR1cm47CiAg\nICAgICAgLy8gbm8gc3VwZXI6IGlmIChyZWwgPCAwKSB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZnZSgpOwogICAgICAgIGlmIChfbWV0YS5n\nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBTdHJp\nbmdbXSBhcmdzOwogICAgICAgICAgICBpZiAoY29weSkgewogICAgICAgICAg\nICAgICAgYXJncyA9IG5ldyBTdHJpbmdbXXsgZ2V0VHlwZShfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAgICAgICBn\nZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0cmluZ1tdeyBpbnQu\nY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5z\nZXRQYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAg\nICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLCBu\nYW1lLCAKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBh\ncmdzKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CgogICAgICAgIGlmaW5zLnNldFRh\ncmdldChjb2RlLm5vcCgpKTsKICAgICAgICByZXR1cm4gcmVsTG9jYWw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGhlbHBlciBtZXRob2QsIGdpdmVu\nIHRoZSBwY1JlcGxhY2VGaWVsZCBvciBwY1Byb3ZpZGVGaWVsZAogICAgICog\nbWV0aG9kLCBhZGRzIHRoZSBieXRlY29kZSBmb3IgdGhlIGNvcnJlc3BvbmRp\nbmcgJ3BsdXJhbCcgdmVyc2lvbgogICAgICogb2YgdGhlIG1ldGhvZCAtLSB0\naGUgdmVyc2lvbiB0aGF0IHRha2VzIGFuIGludFtdIG9mIGZpZWxkcyB0bwog\nICAgICogdG8gYWNjZXNzIHJhdGhlciB0aGFuIGEgc2luZ2xlIGZpZWxkLiBU\naGUgbXVsdGlwbGUgZmllbGRzIHZlcnNpb24KICAgICAqIHNpbXBseSBsb29w\ncyB0aHJvdWdoIHRoZSBwcm92aWRlZCBpbmRleGVzIGFuZCBkZWxlZ2F0ZXMg\ndG8gdGhlCiAgICAgKiBzaW5ndWxhciB2ZXJzaW9uIGZvciBlYWNoIG9uZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE11bHRpcGxlRmllbGRzTWV0\naG9kVmVyc2lvbihCQ01ldGhvZCBzaW5nbGUpIHsKICAgICAgICBib29sZWFu\nIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhzaW5nbGUuZ2V0\nTmFtZSgpKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgPG1ldGhvZD5zIChp\nbnRbXSBmaWVsZHMpCiAgICAgICAgQ2xhc3NbXSBhcmdzID0gKGNvcHkpID8g\nbmV3IENsYXNzW117IE9iamVjdC5jbGFzcywgaW50W10uY2xhc3MgfQogICAg\nICAgICAgICA6IG5ldyBDbGFzc1tdeyBpbnRbXS5jbGFzcyB9OwogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKHNpbmdsZS5n\nZXROYW1lKCkgKyAicyIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIGFyZ3Mp\nOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoK\nICAgICAgICBpbnQgZmllbGROdW1iZXJzID0gMDsKICAgICAgICBpbnQgaW5z\ndCA9IDA7CiAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgZmllbGRO\ndW1iZXJzID0gMTsKCiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFz\ncygpKSB7CiAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIG1hbmFnZWQgaW5z\ndGFuY2UgaW50byB0aGUgbG9jYWwgdmFyaWFibGUgdGFibGUKICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKEltcGxIZWxwZXIu\nY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgImdldE1hbmFnZWRJbnN0YW5j\nZSIsIE9iamVjdC5jbGFzcywKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xh\nc3NbXSB7IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGNvZGUu\nY2hlY2tjYXN0KCkuc2V0VHlwZShfbWFuYWdlZFR5cGUpOwogICAgICAgICAg\nICAgICAgaW5zdCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAg\nICAgICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGluc3QpOwoKICAg\nICAgICAgICAgICAgIC8vIHRoZXJlIG1pZ2h0IGJlIGEgZGlmZmVyZW5jZSBi\nZXR3ZWVuIHRoZSBjbGFzc2VzIG9mICd0aGlzJwogICAgICAgICAgICAgICAg\nLy8gdnMgJ290aGVyJyBpbiB0aGlzIGNvbnRleHQ7IHVzZSB0aGUgUEMgbWV0\naG9kcyB0byBnZXQgdGhlIFNNCiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoSW1wbEhlbHBlci5jbGFzcywKICAgICAg\nICAgICAgICAgICAgICAidG9QZXJzaXN0ZW5jZUNhcGFibGUiLCBQZXJzaXN0\nZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgbmV3IENs\nYXNzW10geyBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsKICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBl\ncnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICAgICAi\ncGNHZXRTdGF0ZU1hbmFnZXIiLCBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gWFhY\nIG90aGVyID0gKFhYWCkgcGM7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoX3BjKTsKICAgICAgICAgICAgICAgIGluc3QgPSBjb2Rl\nLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgY29kZS5h\nc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAgICAgICAgICAvLyBh\nY2Nlc3MgdGhlIG90aGVyJ3Mgc20gZmllbGQgZGlyZWN0bHkKICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICAg\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgKG90aGVyLnBjU3Rh\ndGVNYW5hZ2VyICE9IHBjU3RhdGVNYW5hZ2VyKQogICAgICAgICAgICAvLwl0\naHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uCgogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmYWNtcGVx\nKCk7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGlmaW5zLnNl\ndFRhcmdldChjb2RlLm5vcCgpKTsKCiAgICAgICAgICAgIC8vIGlmIChwY1N0\nYXRlTWFuYWdlciA9PSBudWxsKQogICAgICAgICAgICAvLyAgdGhyb3cgbmV3\nIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbgogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRm\naWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBpZmlu\ncyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgICAgIHRocm93RXhjZXB0\naW9uKGNvZGUsIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGZvciAoaW50IGkgPSAwOwogICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICBpbnQgaWR4ID0gY29kZS5n\nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNl\ndExvY2FsKGlkeCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIHRlc3RpbnMg\nPSBjb2RlLmdvMigpOwoKICAgICAgICAvLyA8bWV0aG9kPiAoZmllbGRzW2ld\nKTsKICAgICAgICBJbnN0cnVjdGlvbiBib2R5aW5zID0gbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgaWYgKGNvcHkpCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXJzKTsKICAgICAgICBj\nb2RlLmlsb2FkKCkuc2V0TG9jYWwoaWR4KTsKICAgICAgICBjb2RlLmlhbG9h\nZCgpOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChz\naW5nbGUpOwoKICAgICAgICAvLyBpKys7CiAgICAgICAgY29kZS5paW5jKCku\nc2V0SW5jcmVtZW50KDEpLnNldExvY2FsKGlkeCk7CgogICAgICAgIC8vIGkg\nPCBmaWVsZHMubGVuZ3RoCiAgICAgICAgdGVzdGlucy5zZXRUYXJnZXQoY29k\nZS5pbG9hZCgpLnNldExvY2FsKGlkeCkpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbShmaWVsZE51bWJlcnMpOwogICAgICAgIGNvZGUuYXJyYXls\nZW5ndGgoKTsKICAgICAgICBjb2RlLmlmaWNtcGx0KCkuc2V0VGFyZ2V0KGJv\nZHlpbnMpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlICdz\ndG9jaycgbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGU7IHRoZXNlIGluY2x1ZGUg\nbWV0aG9kcwogICAgICogbGlrZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxl\nI3BjRmV0Y2hPYmplY3RJZH0KICAgICAqIGFuZCB7QGxpbmsgUGVyc2lzdGVu\nY2VDYXBhYmxlI3BjSXNUcmFuc2FjdGlvbmFsfS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZFN0b2NrTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gcGNHZXRHZW5lcmljQ29udGV4dAogICAgICAgICAgICB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImdldCIgKyBDT05URVhU\nTkFNRSwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAg\nICAgIC8vIHBjRmV0Y2hPYmplY3RJZAogICAgICAgICAgICB0cmFuc2xhdGVG\ncm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAg\nICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImZldGNoT2JqZWN0SWQiLCAo\nQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8g\ncGNJc0RlbGV0ZWQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFu\nYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICBTTVRZUEUsICJpc0RlbGV0ZWQiLCAoQ2xhc3NbXSkgbnVsbCkp\nLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RpcnR5CiAgICAg\nICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAg\nICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1l\ndGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAi\naXNEaXJ0eSIsIChDbGFzc1tdKSBudWxsKSksIHRydWUpOwogICAgCiAgICAg\nICAgICAgIC8vIHBjSXNOZXcKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0\nYXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAg\nICAgICAgICAgICAgICBTTVRZUEUsICJpc05ldyIsIChDbGFzc1tdKSBudWxs\nKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzUGVyc2lzdGVu\ndAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9k\nKAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVj\nbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNN\nVFlQRSwgImlzUGVyc2lzdGVudCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNl\nKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzVHJhbnNhY3Rpb25hbAogICAg\nICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAg\nICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRN\nZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwg\nImlzVHJhbnNhY3Rpb25hbCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsK\nICAgIAogICAgICAgICAgICAvLyBwY1NlcmlhbGl6aW5nCiAgICAgICAgICAg\nIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAg\nICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFj\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAic2VyaWFs\naXppbmciLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAg\nICAgICAgLy8gcGNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3Rh\ndGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAg\nICAgICAgICAgICAgIFNNVFlQRSwgImRpcnR5IiwgbmV3IENsYXNzW117IFN0\ncmluZy5jbGFzcyB9KSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBw\nY0dldFN0YXRlTWFuYWdlcgogICAgICAgICAgICBCQ01ldGhvZCBtZXRoID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFN0YXRlTWFuYWdlciIsCiAg\nICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CiAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFN0YXRlTWFu\nYWdlci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfSBjYXRjaCAo\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAg\nIHRocm93IChOb1N1Y2hNZXRob2RFeGNlcHRpb24pIHBhZS5nZXRFeGNlcHRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIGFkZCBhIHN0b2NrIG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUu\nIEVhY2gKICAgICAqIHN0b2NrIG1ldGhvZCBzaW1wbHkgZGVsZWdhdGVzIHRv\nIGEgY29ycmVzcG9uZGluZyBTdGF0ZU1hbmFnZXIgbWV0aG9kLgogICAgICog\nR2l2ZW4gdGhlIFN0YXRlTWFuYWdlciBtZXRob2QsIHRoZW4sIHRoaXMgZnVu\nY3Rpb24gdHJhbnNsYXRlcyBpdCBpbnRvCiAgICAgKiB0aGUgd3JhcHBlciBt\nZXRob2QgdGhhdCBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIGJ5dGVjb2RlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNsYXRlRnJvbVN0YXRlTWFu\nYWdlck1ldGhvZChNZXRob2QgbSwKICAgICAgICBib29sZWFuIGlzRGlydHlD\naGVja01ldGhvZCkgewogICAgICAgIC8vIGZvcm0gdGhlIG5hbWUgb2YgdGhl\nIG1ldGhvZCBieSBwcmVwZW5kaW5nICdwYycgdG8gdGhlIHNtIG1ldGhvZAog\nICAgICAgIFN0cmluZyBuYW1lID0gUFJFICsgU3RyaW5nVXRpbHMuY2FwaXRh\nbGl6ZShtLmdldE5hbWUoKSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSBt\nLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgQ2xhc3MgcmV0dXJuVHlw\nZSA9IG0uZ2V0UmV0dXJuVHlwZSgpOwoKICAgICAgICAvLyBhZGQgdGhlIG1l\ndGhvZCB0byB0aGUgcGMKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZGVjbGFyZU1ldGhvZChuYW1lLCByZXR1cm5UeXBlLCBwYXJhbXMpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0dXJuIDxkZWZh\ndWx0PjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5v\nbm51bGwoKTsKICAgICAgICBpZiAocmV0dXJuVHlwZS5lcXVhbHMoYm9vbGVh\nbi5jbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZShmYWxzZSk7CiAgICAgICAgZWxzZSBpZiAoIXJldHVyblR5cGUuZXF1YWxz\nKHZvaWQuY2xhc3MpKQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nTnVsbCgpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUocmV0dXJu\nVHlwZSk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGRpcnR5LWNoZWNr\nIG1ldGhvZCBhbmQgd2UncmUgc3ViY2xhc3NpbmcgYnV0IG5vdAogICAgICAg\nIC8vIHJlZGVmaW5pbmcsIGhvb2sgaW50byBQQ0hlbHBlciB0byBkbyB0aGUg\nZGlydHkgY2hlY2sKICAgICAgICBpZiAoaXNEaXJ0eUNoZWNrTWV0aG9kICYm\nICFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIFJlZGVmaW5pdGlv\nbkhlbHBlci5kaXJ0eUNoZWNrKHNtKTsKICAgICAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAg\nICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgdGhlIHJldHVybiBz\ndGF0ZW1lbnQgYmVsb3cKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMo\nKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNzLCAKICAgICAg\nICAgICAgICAgICJkaXJ0eUNoZWNrIiwgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW10geyBTTVRZUEUgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\naWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyByZXR1\ncm4gcGNTdGF0ZU1hbmFnZXIuPG1ldGhvZD4gKDxhcmdzPik7CiAgICAgICAg\nLy8gbWFuYWdlZCBpbnN0YW5jZSBsb2FkZWQgYWJvdmUgaW4gaWYtZWxzZSBi\nbG9jawogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSk7\nCiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QobSk7\nCiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBlKTsK\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjR2V0VmVy\nc2lvbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2QoKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRWZXJzaW9uIiwg\nT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYg\nKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgRmllbGRNZXRh\nRGF0YSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsK\nCiAgICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBudWxsKQogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAvLyByZXR1cm4gbnVsbDsK\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcmV0dXJuIDx2ZXJzaW9u\nRmllbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFwcGVyID0gdG9QcmltaXRp\ndmVXcmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3cmFw\ncGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkgewogICAg\nICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh3cmFwcGVyKTsKICAg\nICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbkZp\nZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZpZWxk\nLmdldERlY2xhcmVkVHlwZSgpKQogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VzcGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIsICI8aW5pdD4iLCB2b2lk\nLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyB2ZXJz\naW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfQogICAg\nICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyByZXR1cm4gcGNTdGF0\nZU1hbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAgICBpZmlucy5zZXRUYXJn\nZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJn\nZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZlcnNpb24g\nZmllbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFwcGVyLCBvciBudWxsIGlm\nCiAgICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBub3QgcHJpbWl0aXZlLgog\nICAgICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJpbWl0aXZlV3JhcHBlcihG\naWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uY2xh\nc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAg\nICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBDaGFyYWN0\nZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAg\nIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBTaG9ydC5jbGFzczsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJz\naXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlU3RhdGVNYW5hZ2VyfQogICAgICog\nbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRob2QoKSB7CiAgICAgICAg\nLy8gcHVibGljIHZvaWQgcGNSZXBsYWNlU3RhdGVNYW5hZ2VyIChTdGF0ZU1h\nbmFnZXIgc20pCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU01UWVBFIH0pOwogICAg\nICAgIG1ldGhvZC5zZXRTeW5jaHJvbml6ZWQodHJ1ZSk7CiAgICAgICAgbWV0\naG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKFNlY3VyaXR5\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2Vy\nICE9IG51bGwpCiAgICAgICAgLy8JcGNTdGF0ZU1hbmFnZXIgPSBwY1N0YXRl\nTWFuYWdlci5yZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcElu\nc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwoKTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKFNNVFlQRSwgInJlcGxhY2VTdGF0ZU1hbmFnZXIiLAog\nICAgICAgICAgICBTTVRZUEUsIG5ldyBDbGFzc1tdeyBTTVRZUEUgfSk7CiAg\nICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwog\nICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBTZWN1cml0eU1h\nbmFnZXIgc2VjID0gU3lzdGVtLmdldFNlY3VyaXR5TWFuYWdlciAoKTsKICAg\nICAgICAvLyBpZiAoc2VjICE9IG51bGwpCiAgICAgICAgLy8JCXNlYy5jaGVj\na1Blcm1pc3Npb24gKFBlcm1pc3Npb24uU0VUX1NUQVRFX01BTkFHRVIpOwog\nICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChTeXN0ZW0uY2xhc3MsCiAgICAgICAgICAgICJnZXRTZWN1cml0\neU1hbmFnZXIiLCBTZWN1cml0eU1hbmFnZXIuY2xhc3MsIG51bGwpKTsKCiAg\nICAgICAgLy8gcGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAgICBpZmlucy5z\nZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2Rl\nLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29k\nZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgUGVyc2lzdGVuY2VDYXBhYmxl\nIG1ldGhvZHMgZGVhbGluZyB3aXRoIGFwcGxpY2F0aW9uCiAgICAgKiBpZGVu\ndGl0eSBhbmQgZ2l2ZXMgdGhlbSBuby1vcCBpbXBsZW1lbnRhdGlvbnMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROb09wQXBwbGljYXRpb25JZGVu\ndGl0eU1ldGhvZHMoKSB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZz\nLAogICAgICAgIC8vIAlPYmplY3Qgb2lkKQogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRz\nVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdeyBPSURGU1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVj\ndElkIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3Mg\nfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAog\nICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQi\nLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lERkNU\nWVBFLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1Ymxp\nYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0IG9p\nZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7Cgog\nICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3RhbmNl\nICgpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAg\nICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAo\nT2JqZWN0IG9iaikKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9i\namVjdC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQ8\nL2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGlj\nYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRD\nb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxkTWFu\nYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVj\ndElkIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMsCiAgICAgICAgLy8JT2Jq\nZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZpZWxkTWFuYWdl\ncikgPwogICAgICAgICAgICBuZXcgU3RyaW5nW117IE9JREZTVFlQRS5nZXRO\nYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6\nIG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQu\nY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc2luZ2xlIGZpZWxk\nIGlkZW50aXR5IGFsd2F5cyB0aHJvd3MgZXhjZXB0aW9uCiAgICAgICAgaWYg\nKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgdGhy\nb3dFeGNlcHRpb24oY29kZSwgSU5URVJORVhDRVApOwogICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2FsbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3MubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oaSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAg\nUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwgdm9pZC5jbGFzcy5n\nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gT2JqZWN0\nIGlkID0gb2lkOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAgICAg\naWYgKF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAg\nICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgpOwogICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3Mp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgLy8gPG9pZCB0\neXBlPiBpZCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAgICAgICAgaW50IGlkID0g\nY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBDbGFzcyBvaWRU\neXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUuYXN0\nb3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAvLyBpbnQgaW5oZXJpdGVk\nID0gcGNJbmhlcml0ZWRGaWVsZENvdW50OwogICAgICAgIGludCBpbmhlcml0\nZWQgPSAwOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsKICAgICAgICAg\nICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xh\nc3MpOwogICAgICAgICAgICBpbmhlcml0ZWQgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2Fs\nKGluaGVyaXRlZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZC48ZmllbGQ+\nID0gZnMuZmV0Y2g8dHlwZT5GaWVsZCAoPGluZGV4Pik7IG9yLi4uCiAgICAg\nICAgLy8gaWQuPGZpZWxkPiA9IHBjLjxmaWVsZD47CiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEu\nZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZp\nZWxkcygpOwogICAgICAgIENsYXNzIHR5cGU7CiAgICAgICAgU3RyaW5nIG5h\nbWU7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgTWV0aG9kIHNldHRl\ncjsKICAgICAgICBib29sZWFuIHJlZmxlY3Q7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlm\nICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQp\nOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0TmFtZSgpOwogICAg\nICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgp\nOwogICAgICAgICAgICBpZiAoaXNGaWVsZEFjY2VzcyhmbWRzW2ldKSkgewog\nICAgICAgICAgICAgICAgc2V0dGVyID0gbnVsbDsKICAgICAgICAgICAgICAg\nIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgbmFtZSwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICByZWZsZWN0ID0gIU1vZGlmaWVyLmlz\nUHVibGljKGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAgICAgICAgICAgICAg\nIGlmIChyZWZsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFz\nc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5hbWUpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1l\ndGhvZChSZWZsZWN0aW9uLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IENs\nYXNzLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xh\nc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IG51bGw7\nCiAgICAgICAgICAgICAgICBzZXR0ZXIgPSBSZWZsZWN0aW9uLmZpbmRTZXR0\nZXIob2lkVHlwZSwgbmFtZSwgdHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgICAg\nICByZWZsZWN0ID0gIU1vZGlmaWVyLmlzUHVibGljKHNldHRlci5nZXRNb2Rp\nZmllcnMoKSk7CiAgICAgICAgICAgICAgICBpZiAocmVmbGVjdCkgewogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNz\nKG9pZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShuYW1lKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNs\nYXNzY29uc3RhbnQoKS5zZXRDbGFzcyh0eXBlKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVm\nbGVjdGlvbi5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgICAgICJmaW5k\nU2V0dGVyIiwgTWV0aG9kLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IENsYXNzLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xhc3MsIENs\nYXNzLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2Vy\nKSB7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoaW5oZXJp\ndGVkKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QKICAgICAg\nICAgICAgICAgICAgICAoZ2V0RmllbGRTdXBwbGllck1ldGhvZCh0eXBlKSk7\nCiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxk\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0JKRUNUICYmCiAgICAgICAgICAg\nICAgICAgICAgIWZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkuaXNFbnVtKCkp\nIHsKICAgICAgICAgICAgICAgIAljb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\nT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgCWNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElkIiwg\nCiAgICAgICAgICAgIAkJCU9iamVjdC5jbGFzcywgbnVsbCk7ICAgICAgICAg\nICAgICAgIAkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAv\nLyBpZiB0aGUgdHlwZSBvZiB0aGlzIGZpZWxkIG1ldGEgZGF0YSBpcwogICAg\nICAgICAgICAgICAgLy8gbm9uLXByaW1pdGl2ZSBhbmQgbm9uLXN0cmluZywg\nYmUgc3VyZSB0byBjYXN0CiAgICAgICAgICAgICAgICAvLyB0byB0aGUgYXBw\ncm9wcmlhdGUgdHlwZS4KICAgICAgICAgICAgICAgIGlmICghcmVmbGVjdCAm\nJiAhdHlwZS5pc1ByaW1pdGl2ZSgpCiAgICAgICAgICAgICAgICAgICAgJiYg\nIXR5cGUuZ2V0TmFtZSgpLmVxdWFscyhTdHJpbmcuY2xhc3MuZ2V0TmFtZSgp\nKSkKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUodHlwZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7\nCgogICAgICAgICAgICAgICAgLy8gZ2V0IGlkL3BrIGZyb20gcGMgaW5zdGFu\nY2UKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAg\nYWRkRXh0cmFjdE9iamVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwgZm1kc1tp\nXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZWZsZWN0ICYm\nIGZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsICJzZXQiLCAK\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nIE9iamVjdC5jbGFzcywgRmllbGQuY2xhc3MsCiAgICAgICAgICAgICAgICAg\nICAgKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBlIDogT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlZmxlY3QpIHsgCiAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZs\nZWN0aW9uLmNsYXNzLCAic2V0IiwgCiAgICAgICAgICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIE1ldGhvZC5j\nbGFzcywKICAgICAgICAgICAgICAgICAgICAodHlwZS5pc1ByaW1pdGl2ZSgp\nKSA/IHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvZGUucHV0\nZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChz\nZXR0ZXIpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgY29kZSB0byBleHRyYWN0IHRoZSBpZCBvZiB0aGUgZ2l2ZW4gcHJpbWFy\neSBrZXkgcmVsYXRpb24gZmllbGQgZm9yCiAgICAgKiBzZXR0aW5nIGludG8g\nYW4gb2JqZWN0aWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZhbHVlQ29kZShDb2RlIGNvZGUs\nIEZpZWxkTWV0YURhdGEgcGspIHsKICAgICAgICAvLyBpZiAodmFsICE9IG51\nbGwpIAogICAgICAgIC8vICB2YWwgPSAoKFBlcnNpc3RlbmNlQ2FwYWJsZSkg\ndmFsKS5wY0ZldGNoT2JqZWN0SWQoKTsKICAgICAgICBpbnQgcGMgPSBjb2Rl\nLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCku\nc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChw\nYyk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmbnVsbDEgPSBjb2RlLmlm\nbnVsbCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChwYyk7CiAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFBlcnNpc3RlbmNlQ2Fw\nYWJsZS5jbGFzcyk7IAogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAg\nICAgUFJFICsgIkZldGNoT2JqZWN0SWQiLCBPYmplY3QuY2xhc3MsIG51bGwp\nOwogICAgICAgIGludCBvaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgp\nOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwob2lkKTsKICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gaWZudWxsMiA9IGNvZGUuaWZudWxsKCk7IAoKICAgICAgICAv\nLyBmb3IgZGF0YXN0b3JlIC8gc2luZ2xlLWZpZWxkIGlkZW50aXR5OgogICAg\nICAgIC8vIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAvLyAgIHZhbCA9ICgo\nT3BlbkpQQUlkKSB2YWwpLmdldElkKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBwa21ldGEgPSBway5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAg\nICAgIGludCBwa2NvZGUgPSBway5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUo\nKTsKICAgICAgICBDbGFzcyBwa3R5cGUgPSBway5nZXRPYmplY3RJZEZpZWxk\nVHlwZSgpOwogICAgICAgIGlmIChwa21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUgCiAgICAgICAgICAgICYm\nIHBrY29kZSA9PSBKYXZhVHlwZXMuTE9ORykgewogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKElkLmNsYXNzLCAiZ2V0SWQiLCAK\nICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAgICAgIH0g\nZWxzZSBpZiAocGttZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0\nYURhdGEuSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmlz\nT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgc3dpdGNoIChwa2Nv\nZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JK\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoQnl0\nZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQnl0ZUlkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nQnl0ZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAg\nICBieXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\ncGtjb2RlID09IEphdmFUeXBlcy5CWVRFX09CSikKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEJ5dGUu\nY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2J5dGUuY2xhc3N9KTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5l\ndygpLnNldFR5cGUoQ2hhcmFjdGVyLmNsYXNzKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShD\naGFySWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChDaGFySWQuY2xhc3MsICJnZXRJZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNoYXIuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkNIQVJf\nT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoQ2hhcmFjdGVyLmNsYXNzLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7Y2hhci5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKERvdWJs\nZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEb3VibGVJZC5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKERvdWJsZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAg\nICAgICAgICBkb3VibGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkRPVUJMRV9PQkopCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZChEb3VibGUuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde2RvdWJsZS5j\nbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoRmxvYXQuY2xhc3MpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAg\nICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShGbG9hdElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRmxvYXRJZC5jbGFz\ncywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0g\nSmF2YVR5cGVzLkZMT0FUX09CSikKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEZsb2F0LmNsYXNzLCAi\nPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXXtmbG9hdC5jbGFzc30pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRU\neXBlKEludGVnZXIuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoSW50SWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChJbnRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5JTlRfT0JKKQogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nSW50ZWdlci5jbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7aW50LmNsYXNzfSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKExvbmcuY2xhc3MpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8g\nYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKExvbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKExvbmdJZC5jbGFzcywgImdldElkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbG9uZy5jbGFzcywgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuTE9O\nR19PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChMb25nLmNsYXNzLCAiPGluaXQ+IiwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\nIHtsb25nLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShTaG9ydC5jbGFz\ncyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAg\nICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKFNob3J0SWQuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChTaG9y\ndElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBz\naG9ydC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBr\nY29kZSA9PSBKYXZhVHlwZXMuU0hPUlRfT0JKKQogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoU2hvcnQu\nY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde3Nob3J0LmNsYXNzfSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShEYXRlSWQuY2xhc3MpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChEYXRlSWQu\nY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGUu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShTdHJpbmdJ\nZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFN0cmluZ0lkLmNsYXNzLCAiZ2V0SWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQmlnRGVjaW1hbElkLmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoQmlnRGVjaW1hbElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAg\nICAgICAgICAgICAgICBCaWdEZWNpbWFsSWQuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQmlnSW50ZWdlcklkLmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoQmlnSW50ZWdlcklkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAg\nICAgICAgICAgICAgICBCaWdJbnRlZ2VySWQuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\nb2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywg\nImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGtt\nZXRhLmdldE9iamVjdElkVHlwZSgpICE9IG51bGwpIHsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgIGlmIChw\na2NvZGUgPT0gSmF2YVR5cGVzLk9CSkVDVCkgewogICAgICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChP\nYmplY3RJZC5jbGFzcywgImdldElkIiwgCiAgICAgICAgICAgIAkJCU9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwa3R5cGUpOwogICAgICAgIH0gZWxz\nZQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gY29kZS5nbzIoKTsKCiAgICAg\nICAgLy8gaWYgKHZhbCA9PSBudWxsKQogICAgICAgIC8vICAgdmFsID0gPGRl\nZmF1bHQ+OwogICAgICAgIEluc3RydWN0aW9uIGRlZjsKICAgICAgICBzd2l0\nY2ggKHBrY29kZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09M\nRUFOOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGZhbHNlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgZGVm\nID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChieXRlKSAwKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nSEFSOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKChjaGFyKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAg\nICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBkZWYgPSBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoKHNob3J0KSAwKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZGVm\nID0gY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICB9CiAgICAg\nICAgaWZudWxsMS5zZXRUYXJnZXQoZGVmKTsKICAgICAgICBpZm51bGwyLnNl\ndFRhcmdldChkZWYpOwogICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5ub3Ao\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wY0Nv\ncHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMKICAgICAq\nIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHkuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVj\ndElkTWV0aG9kKGJvb2xlYW4gZmllbGRNYW5hZ2VyKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2\nb2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVs\nZENvbnN1bWVyIGZjLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAg\nU3RyaW5nW10gYXJncyA9IChmaWVsZE1hbmFnZXIpIAogICAgICAgICAgICA/\nICBuZXcgU3RyaW5nW117IE9JREZDVFlQRS5nZXROYW1lKCksIE9iamVjdC5j\nbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6IG5ldyBTdHJpbmdbXXsg\nT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRz\nRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFzcy5nZXROYW1l\nKCksIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kCiAg\nICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYg\nIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShpKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAg\nICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1l\nKCksCiAgICAgICAgICAgICAgICBQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21P\nYmplY3RJZCIsIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAg\nICB9CgogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAgICAgaWYgKCFf\nbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRU\neXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJ\nZCkgaWQpLmdldElkICgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJ\nZCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gPG9pZCB0eXBlPiBjYXN0ID0gKDxvaWQgdHlw\nZT4pIG9pZDsKICAgICAgICBpbnQgaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJ\nbmRleCgpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmpl\nY3RJZFR5cGUoKTsKICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\nb2lkVHlwZSk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpZCk7\nCgogICAgICAgIC8vIGZzLnN0b3JlPHR5cGU+RmllbGQgKDxpbmRleD4sIGlk\nLjxmaWVsZD4pOyBvci4uLgogICAgICAgIC8vIHRoaXMuPGZpZWxkPiA9IGlk\nLjxmaWVsZD4KICAgICAgICAvLyBvciBmb3Igc2luZ2xlIGZpZWxkIGlkZW50\naXR5OiBpZC5nZXRJZCAoKQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAg\nICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAg\nICBTdHJpbmcgbmFtZTsKICAgICAgICBDbGFzcyB0eXBlOwogICAgICAgIENs\nYXNzIHVud3JhcHBlZDsKICAgICAgICBGaWVsZCBmaWVsZDsKICAgICAgICBN\nZXRob2QgZ2V0dGVyOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQ\ncmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIG5hbWUgPSBmbWRzW2ldLmdldE5hbWUoKTsKICAgICAgICAgICAg\ndHlwZSA9IGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAg\nICAgICAgaWYgKCFmaWVsZE1hbmFnZXIgCiAgICAgICAgICAgICAgICAmJiBm\nbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMp\nIHsKICAgICAgICAgICAgICAgIC8vIGlmIChzbSA9PSBudWxsKSByZXR1cm47\nCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgICAgIC8vIHNtLmdldFBDUHJp\nbWFyeUtleShvaWQsIGkgKyBwY0luaGVyaXRlZEZpZWxkQ291bnQpOyAKICAg\nICAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLmR1cCgp\nOyAvLyBsZWF2ZSBvcmlnIG9uIHN0YWNrIHRvIHNldCB2YWx1ZSBpbnRvCiAg\nICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\naWQpOwogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKGkpOwogICAgICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVs\nZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5p\nYWRkKCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChTdGF0ZU1hbmFnZXIuY2xhc3MsIAogICAgICAgICAgICAg\nICAgICAgICJnZXRQQ1ByaW1hcnlLZXkiLCBPYmplY3QuY2xhc3MsIAogICAg\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBp\nbnQuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAg\nICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgdW53cmFwcGVkID0gKGZt\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykg\nCiAgICAgICAgICAgICAgICAgICAgPyB0eXBlIDogdW53cmFwU2luZ2xlRmll\nbGRJZGVudGl0eShmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChmaWVs\nZE1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwoKICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQg\nIT0gdHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNl\ndFR5cGUodHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChpZCk7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuaXNP\ncGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChv\naWRUeXBlID09IE9iamVjdElkLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBl\nLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0\nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFm\naWVsZE1hbmFnZXIgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\nZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIGlmIChvaWRUeXBlID09IERhdGVJZC5jbGFzcykgewogICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2Qob2lkVHlwZSwgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIERhdGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoIWZpZWxkTWFuYWdlciAmJiB0eXBlICE9IERhdGUuY2xhc3Mp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJ\nZCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwcGVkLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVud3JhcHBlZCAh\nPSB0eXBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdeyB1bndyYXBwZWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChpc0ZpZWxkQWNjZXNzKGZtZHNbaV0p\nKSB7CiAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBSZWZsZWN0aW9uLmZp\nbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoTW9kaWZpZXIuaXNQdWJsaWMoZmllbGQuZ2V0TW9kaWZpZXJz\nKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICAgICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWZsZWN0aW9uLmdldFhYWChv\naWQsIFJlZmxlY3Rpb24uZmluZEZpZWxkKC4uLikpOwogICAgICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRU\neXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rp\nb24uY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmluZEZp\nZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBi\nb29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXN0YXRpYygpLnNldE1ldGhvZAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwgRmll\nbGQuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0eXBl\nLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUodHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBnZXR0ZXIgPSBSZWZs\nZWN0aW9uLmZpbmRHZXR0ZXIob2lkVHlwZSwgbmFtZSwgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzUHVibGljKGdldHRlci5n\nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChnZXR0ZXIpOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBS\nZWZsZWN0aW9uLmdldFhYWChvaWQsIFJlZmxlY3Rpb24uZmluZEdldHRlcigu\nLi4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0\nYW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUp\nOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygp\nLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgImZpbmRHZXR0ZXIiLCBNZXRob2QuY2xhc3MsIG5ldyBD\nbGFzc1tdIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmNs\nYXNzLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlvbkdl\ndHRlck1ldGhvZCh0eXBlLCBNZXRob2QuY2xhc3MpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAh\nPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKQogICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0RmllbGRDb25zdW1l\nck1ldGhvZCh0eXBlKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAg\nICAgICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBpZiB0\naGUgY2xhc3MgdXNlcyB0aGUgQ2xhc3MvU3RyaW5nIGNvbnN0cnVjdG9yCiAg\nICAgKiBpbnN0ZWFkIG9mIGp1c3QgU3RyaW5nLgogICAgICovCiAgICBwcml2\nYXRlIEJvb2xlYW4gdXNlc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3RvcigpIHsK\nICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gQ2xhc3NN\nZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgcmV0dXJuIEJv\nb2xlYW4uRkFMU0U7CgogICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJZGVu\ndGl0eSgpKSB7CiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRPYmplY3RJZFR5\ncGUoKSA9PSBPYmplY3RJZC5jbGFzcykKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAg\nICAgIH0KCiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9iamVj\ndElkVHlwZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9pZFR5cGUu\nZ2V0Q29uc3RydWN0b3IobmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJp\nbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7\nCiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICB9CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3Rv\ncihuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAgICBy\nZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9IGNhdGNoIChUaHJvd2Fi\nbGUgdCkgewogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHRoZSBnaXZlbiBmaWVsZCBpcyBhIHdyYXBw\nZXItdHlwZSBzaW5nbGUgZmllbGQgaWRlbnRpdHkgcHJpbWFyeSBrZXksCiAg\nICAgKiByZXR1cm4gaXRzIGNvcnJlc3BvbmRpbmcgcHJpbWl0aXZlIGNsYXNz\nLiBFbHNlIHJldHVybiB0aGUgZmllbGQgdHlwZS4KICAgICAqLwogICAgcHJp\ndmF0ZSBDbGFzcyB1bndyYXBTaW5nbGVGaWVsZElkZW50aXR5KEZpZWxkTWV0\nYURhdGEgZm1kKSB7CiAgICAgICAgaWYgKCFmbWQuZ2V0RGVmaW5pbmdNZXRh\nRGF0YSgpLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CgogICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBieXRl\nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoK\nICAgICAgICAgICAgICAgIHJldHVybiBjaGFyLmNsYXNzOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGRvdWJsZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGZsb2F0LmNs\nYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGludC5jbGFzczsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJu\nIHNob3J0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05H\nX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBsb25nLmNsYXNzOwogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZtZC5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHByb3BlciBnZXR0ZXIgbWV0aG9kIG9mIHRoZSB7\nQGxpbmsgUmVmbGVjdGlvbn0gaGVscGVyIGZvcgogICAgICogYSBmaWVsZCBv\nciBnZXR0ZXIgbWV0aG9kIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAg\nICBwcml2YXRlIE1ldGhvZCBnZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKENs\nYXNzIHR5cGUsIENsYXNzIGFyZ1R5cGUpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSAiZ2V0\nIjsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAg\nICBuYW1lICs9IFN0cmluZ1V0aWxzLmNhcGl0YWxpemUodHlwZS5nZXROYW1l\nKCkpOwogICAgICAgIHJldHVybiBSZWZsZWN0aW9uLmNsYXNzLmdldE1ldGhv\nZChuYW1lLCBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgCiAgICAgICAg\nICAgIGFyZ1R5cGUgfSk7IAogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBwcm9wZXIgZmV0Y2ggbWV0aG9kIG9mIHRoZSBPYmplY3RJZEZpZWxk\nU3VwcGxpZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9mIHRoZSBnaXZlbiB0eXBl\nLgogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRGaWVsZFN1cHBsaWVy\nTWV0aG9kKENsYXNzIHR5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChPSURGU1RZ\nUEUsIHR5cGUsICJmZXRjaCIsIHRydWUsIGZhbHNlLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBmZXRjaCBtZXRo\nb2Qgb2YgdGhlIE9iamVjdElkRmllbGRDb25zdW1lciBmb3IKICAgICAqIGEg\nZmllbGQgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUg\nTWV0aG9kIGdldEZpZWxkQ29uc3VtZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAg\nICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gZ2V0TWV0aG9kKE9JREZDVFlQRSwgdHlwZSwgInN0b3JlIiwgZmFs\nc2UsIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHRoZSBwY05ld09iamVjdElkSW5zdGFuY2UgbWV0aG9kIHRvIGNsYXNzZXMg\ndXNpbmcKICAgICAqIGFwcGxpY2F0aW9uIGlkZW50aXR5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkTmV3T2JqZWN0SWRJbnN0YW5jZU1ldGhvZChi\nb29sZWFuIG9iaikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIHsKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJ\nbnN0YW5jZSAoKQogICAgICAgIENsYXNzW10gYXJncyA9IChvYmopID8gbmV3\nIENsYXNzW117IE9iamVjdC5jbGFzcyB9IDogbnVsbDsKICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiTmV3T2Jq\nZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9iamVjdC5jbGFzcywgYXJn\ncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7\nCgogICAgICAgIEJvb2xlYW4gdXNlc0Nsc1N0cmluZyA9IHVzZXNDbGFzc1N0\ncmluZ0lkQ29uc3RydWN0b3IoKTsKICAgICAgICBDbGFzcyBvaWRUeXBlID0g\nX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgaWYgKG9iaiAmJiB1\nc2VzQ2xzU3RyaW5nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoLi4uKTsKICAgICAgICAg\nICAgU3RyaW5nIG1zZyA9IF9sb2MuZ2V0KCJzdHItY29ucyIsIG9pZFR5cGUs\nCiAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpLmdl\ndE1lc3NhZ2UoKTsKICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUobXNnKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0\nTWV0aG9kKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcywKICAgICAg\nICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\nU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLmF0aHJvdygpOwog\nICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYmIF9t\nZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8g\nbmV3IE9iamVjdElkIChjbHMsIG9pZCkKICAgICAgICAgICAgY29kZS5hbmV3\nKCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgICAgIGlmKF9tZXRhLmlzRW1iZWRkZWRPbmx5KCkg\nfHwgX21ldGEuaGFzQWJzdHJhY3RQS0ZpZWxkKCkgPT0gdHJ1ZSkgewogICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nR2V0SURPd25pbmdDbGFzcyIsCiAgICAgICAgICAgICAgICAgICAgQ2xhc3Mu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShf\nbWV0YSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBu\nZXcgPG9pZCBjbGFzcz4gKCk7CiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZShvaWRUeXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGlmIChf\nbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpIHx8IChvYmogJiYgdXNlc0Nsc1N0\ncmluZyA9PQogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uVFJVRSkpIHsK\nICAgICAgICAgICAgaWYoX21ldGEuaXNFbWJlZGRlZE9ubHkoKSB8fCBfbWV0\nYS5oYXNBYnN0cmFjdFBLRmllbGQoKSA9PSB0cnVlICkgewogICAgICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0SURP\nd25pbmdDbGFzcyIsCiAgICAgICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBlKF9tZXRhKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG9iaikgewog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwog\nICAgICAgICAgICBpZiAodXNlc0Nsc1N0cmluZyA9PSBCb29sZWFuLlRSVUUp\nCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNs\nYXNzLCBTdHJpbmcuY2xhc3MgfTsKICAgICAgICAgICAgZWxzZSBpZiAodXNl\nc0Nsc1N0cmluZyA9PSBCb29sZWFuLkZBTFNFKQogICAgICAgICAgICAgICAg\nYXJncyA9IG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfTsKICAgICAgICB9\nIGVsc2UgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAg\nICAgICAgLy8gbmV3IDx0eXBlPklkZW50aXR5IChYWFguY2xhc3MsIDxwaz4p\nOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBwayA9IF9tZXRhLmdldFBy\naW1hcnlLZXlGaWVsZHMoKVswXTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdl\nZFZhbHVlQ29kZShjb2RlLCBwayk7CiAgICAgICAgICAgIGlmIChway5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAg\nICAgICAgYWRkRXh0cmFjdE9iamVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwg\ncGspOwogICAgICAgICAgICBpZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkg\nPT0gT2JqZWN0SWQuY2xhc3MpCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3\nIENsYXNzW117IENsYXNzLmNsYXNzLCBPYmplY3QuY2xhc3MgfTsKICAgICAg\nICAgICAgZWxzZSBpZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gRGF0\nZS5jbGFzcykKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsg\nQ2xhc3MuY2xhc3MsIERhdGUuY2xhc3MgfTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFz\ncywgcGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSB9OwogICAgICAgIH0KCiAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUs\nICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBhcmdzKTsKICAgICAgICBpZiAoIV9t\nZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5\ncGVTaGFyZWQoKSkKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywg\nT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZW4gY29tbXVuaWNhdGluZyB3aXRoIHRoZSBTdGF0ZU1hbmFnZXIsIG1hbnkg\nbWV0aG9kcyBhcmUgdXNlZAogICAgICogZGVwZW5kaW5nIG9uIHRoZSBjbGFz\ncyBvZiBzdGF0ZSBiZWluZyBwYXNzZWQuIFRoaXMgbWV0aG9kLAogICAgICog\nZ2l2ZW4gdGhlIHR5cGUgb2YgaW5mb3JtYXRpb24gYmVpbmcgcGFzc2VkIGFu\nZCB0aGUgcHJlZml4CiAgICAgKiAoJ3Byb3ZpZGVkJywgJ3JlcGxhY2UnLCBl\ndGMpIG9mIHRoZSBtZXRob2QgdG8KICAgICAqIGNhbGwsIHJldHVybnMgdGhl\nIFN0YXRlTWFuYWdlciBtZXRob2QgdGhhdCBzaG91bGQgYmUgdXNlZC4KICAg\nICAqCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWlu\nZyBwYXNzZWQKICAgICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0\naGUgbWV0aG9kIHRvIGNhbGw7IGFsbCBtZXRob2RzCiAgICAgKiBlbmQgaW4g\nJ1tzdGF0ZSB0eXBlXUZpZWxkJzsgb25seSB0aGUgcHJlZml4IHZhcmllcwog\nICAgICogQHBhcmFtIGdldCB0cnVlIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlv\nbiBmcm9tIHRoZQogICAgICogU3RhdGVNYW5hZ2VyLCBmYWxzZSBpZiBwYXNz\naW5nIGl0IHRvIHRoZSBTTQogICAgICogQHBhcmFtIGN1clZhbHVlIHRydWUg\naWYgdGhlIGN1cnJlbnQgc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRvCiAgICAg\nKiB0aGUgU3RhdGVNYW5hZ2VyIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAg\nKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldFN0YXRlTWFuYWdlck1ldGhvZChD\nbGFzcyB0eXBlLCBTdHJpbmcgcHJlZml4LAogICAgICAgIGJvb2xlYW4gZ2V0\nLCBib29sZWFuIGN1clZhbHVlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRNZXRob2QoU01UWVBF\nLCB0eXBlLCBwcmVmaXgsIGdldCwgdHJ1ZSwgY3VyVmFsdWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRob2Qgb2YgdGhlIGdpdmVu\nIG93bmVyIHR5cGUgbWF0Y2hpbmcgdGhlIGdpdmVuIGNyaXRlcmlhLgogICAg\nICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHN0YXRlIGJlaW5n\nIHBhc3NlZAogICAgICogQHBhcmFtIHByZWZpeCB0aGUgcHJlZml4IG9mIHRo\nZSBtZXRob2QgdG8gY2FsbDsgYWxsIG1ldGhvZHMKICAgICAqIGVuZCBpbiAn\nW3N0YXRlIHR5cGVdRmllbGQnOyBvbmx5IHRoZSBwcmVmaXggdmFyaWVzCiAg\nICAgKiBAcGFyYW0gZ2V0IHRydWUgaWYgcmVjZWl2aW5nIGluZm9ybWF0aW9u\nIGZyb20gdGhlCiAgICAgKiBvd25lciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0\nbyB0aGUgb3duZXIKICAgICAqIEBwYXJhbSBoYXNwYyB0cnVlIGlmIHRoZSBw\nYyBpcyBwYXNzZWQgYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAqIEBwYXJh\nbSBjdXJWYWx1ZSB0cnVlIGlmIHRoZSBjdXJyZW50IHN0YXRlIHZhbHVlIGlz\nIHBhc3NlZCB0bwogICAgICogdGhlIG93bmVyIGFzIGFuIGV4dHJhIGFyZ3Vt\nZW50CiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldE1ldGhvZChDbGFz\ncyBvd25lciwgQ2xhc3MgdHlwZSwgU3RyaW5nIHByZWZpeCwKICAgICAgICBi\nb29sZWFuIGdldCwgYm9vbGVhbiBoYXNwYywgYm9vbGVhbiBjdXJWYWx1ZSkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBhbGwgbWV0aG9kcyBlbmQgaW4gW2ZpZWxkIHR5cGVdRmllbGQsIHdo\nZXJlIHRoZSBmaWVsZCB0eXBlCiAgICAgICAgLy8gY2FuIGJlIGFueSBvZiB0\naGUgcHJpbWl0dmUgdHlwZXMgKGJ1dCBjYXBpdGFsaXplZCksICdTdHJpbmcn\nLAogICAgICAgIC8vIG9yICdPYmplY3QnOyBmaWd1cmUgb3V0IHdoYXQgdHlw\nZSB0byB1c2UKICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSB0eXBlLmdldE5h\nbWUoKTsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAg\nICAgICB0eXBlTmFtZSA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCAxKS50b1Vw\ncGVyQ2FzZShMb2NhbGUuRU5HTElTSCkKICAgICAgICAgICAgICAgICsgdHlw\nZU5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIGVsc2UgaWYgKHR5cGUuZXF1\nYWxzKFN0cmluZy5jbGFzcykpCiAgICAgICAgICAgIHR5cGVOYW1lID0gIlN0\ncmluZyI7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHR5cGVOYW1lID0g\nIk9iamVjdCI7CiAgICAgICAgICAgIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAg\nICAgICAgfQoKICAgICAgICAvLyB0aGUgZmllbGQgaW5kZXggaXMgYWx3YXlz\nIHBhc3NlZCBhcyBhbiBhcmc7IHRoZSBwYyBpbnN0YW5jZSBhbmQKICAgICAg\nICAvLyB0aGUgY3VycmVudCB2YWx1ZSBtYXkgYmUgcGFzc2VkOyBpZiBzZXR0\naW5nIHRoZSBuZXcgdmFsdWUgaXMKICAgICAgICAvLyBhbHNvIHBhc3NlZAog\nICAgICAgIExpc3QgcGxpc3QgPSBuZXcgQXJyYXlMaXN0KDQpOwogICAgICAg\nIGlmIChoYXNwYykKICAgICAgICAgICAgcGxpc3QuYWRkKFBDVFlQRSk7CiAg\nICAgICAgcGxpc3QuYWRkKGludC5jbGFzcyk7CiAgICAgICAgaWYgKCFnZXQg\nfHwgY3VyVmFsdWUpCiAgICAgICAgICAgIHBsaXN0LmFkZCh0eXBlKTsKICAg\nICAgICBpZiAoIWdldCAmJiBjdXJWYWx1ZSkgewogICAgICAgICAgICBwbGlz\ndC5hZGQodHlwZSk7CiAgICAgICAgICAgIHBsaXN0LmFkZChpbnQuY2xhc3Mp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gdXNlIHJlZmxlY3Rpb24gdG8gcmV0\ndXJuIHRoZSByaWdodCBtZXRob2QKICAgICAgICBTdHJpbmcgbmFtZSA9IHBy\nZWZpeCArIHR5cGVOYW1lICsgIkZpZWxkIjsKICAgICAgICBDbGFzc1tdIHBh\ncmFtcyA9IChDbGFzc1tdKSBwbGlzdC50b0FycmF5KG5ldyBDbGFzc1twbGlz\ndC5zaXplKCldKTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFj\ndGlvbihvd25lciwgbmFtZSwgcGFyYW1zKSk7CiAgICAgICAgfSBjYXRjaCAo\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAg\nIHRocm93IChOb1N1Y2hNZXRob2RFeGNlcHRpb24pIHBhZS5nZXRFeGNlcHRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIGFkZCB0aGUgY29kZSBuZWNlc3NhcnkgdG8gdGhyb3cgdGhl\nIGdpdmVuCiAgICAgKiBleGNlcHRpb24gdHlwZSwgc2FucyBtZXNzYWdlLgog\nICAgICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIHRocm93RXhjZXB0aW9u\nKENvZGUgY29kZSwgQ2xhc3MgdHlwZSkgewogICAgICAgIEluc3RydWN0aW9u\nIGlucyA9IGNvZGUuYW5ldygpLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QodHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAg\nIGNvZGUuYXRocm93KCk7CiAgICAgICAgcmV0dXJuIGluczsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRl\ncmZhY2UgdG8gdGhlIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCwgYW5k\nIGFkZHMgYSBkZWZhdWx0IGNvbnN0cnVjdG9yIGZvciB1c2UgYnkgT3BlbkpQ\nQQogICAgICogaWYgaXQgaXMgbm90IGFscmVhZHkgcHJlc2VudC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGVuaGFuY2VDbGFzcygpIHsKICAgICAgICAv\nLyBtYWtlIHRoZSBjbGFzcyBpbXBsZW1lbnQgUGVyc2lzdGVuY2VDYXBhYmxl\nCiAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoUENUWVBFKTsKCiAgICAg\nICAgLy8gYWRkIGEgdmVyc2lvbiBzdGFtcAogICAgICAgIGFkZEdldEVuaGFu\nY2VtZW50Q29udHJhY3RWZXJzaW9uTWV0aG9kKCk7CgogICAgICAgIC8vIGZp\nbmQgdGhlIGRlZmF1bHQgY29uc3RydWN0b3IKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIjxpbml0PiIsIChTdHJp\nbmdbXSkgbnVsbCk7CgogICAgICAgIC8vIGEgZGVmYXVsdCBjb25zdHJ1Y3Rv\nciBpcyByZXF1aXJlZAogICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCkgewog\nICAgICAgICAgICBTdHJpbmcgbmFtZSA9IF9wYy5nZXROYW1lKCk7CiAgICAg\nICAgICAgIGlmICghX2RlZkNvbnMpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZW5oYW5jZS1kZWZhdWx0Y29u\nc3QiLCBuYW1lKSk7CgogICAgICAgICAgICBtZXRob2QgPSBfcGMuYWRkRGVm\nYXVsdENvbnN0cnVjdG9yKCk7CiAgICAgICAgICAgIFN0cmluZyBhY2Nlc3M7\nCiAgICAgICAgICAgIGlmIChfbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAg\nICAgICAgICAgICAgLy8gZXh0ZXJuYWxpemFibGUgcmVxdWlyZXMgdGhhdCB0\naGUgY29uc3RydWN0b3IKICAgICAgICAgICAgICAgIC8vIGJlIHB1YmxpYywg\nc28gbWFrZSB0aGUgYWRkZWQgY29uc3RydWN0b3IgcHVibGljCiAgICAgICAg\nICAgICAgICBtZXRob2QubWFrZVB1YmxpYygpOwogICAgICAgICAgICAgICAg\nYWNjZXNzID0gInB1YmxpYyI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3Bj\nLmlzRmluYWwoKSkgewogICAgICAgICAgICAgICAgbWV0aG9kLm1ha2VQcml2\nYXRlKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3MgPSAicHJpdmF0ZSI7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZXRob2QubWFr\nZVByb3RlY3RlZCgpOwogICAgICAgICAgICAgICAgYWNjZXNzID0gInByb3Rl\nY3RlZCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCEoX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJmYWNlKCkgfHwgZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSkKICAgICAgICAgICAgICAgICYmIF9sb2cuaXNXYXJuRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJl\nbmhhbmNlLWFkZGRlZmF1bHRjb25zdCIsIG5hbWUsIGFjY2VzcykpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIGZvbGxvd2lu\nZyBmaWVsZHMgdG8gdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZToK\nICAgICAqIDx1bD4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBp\nbnQgcGNJbmhlcml0ZWRGaWVsZENvdW50PC9jb2RlPjwvbGk+CiAgICAgKiA8\nbGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgQ2xhc3MgcGNQQ1N1cGVyY2xhc3M8\nL2NvZGU+CiAgICAgKiA8L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUg\nc3RhdGljIFN0cmluZ1tdIHBjRmllbGROYW1lczwvY29kZT48L2xpPgogICAg\nICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIENsYXNzW10gcGNGaWVsZFR5\ncGVzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0\naWMgYnl0ZVtdIHBjRmllbGRGbGFnczwvY29kZT48L2xpPgogICAgICogPGxp\nPjxjb2RlPnByb3RlY3RlZCB0cmFuc2llbnQgU3RhdGVNYW5hZ2VyIHBjU3Rh\ndGVNYW5hZ2VyPC9jb2RlPgogICAgICogaWYgbm8gUGVyc2lzdGVuY2VDYXBh\nYmxlIHN1cGVyY2xhc3MgcHJlc2VudCk8L2xpPgogICAgICogPC91bD4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEZpZWxkcygpIHsKICAgICAgICBf\ncGMuZGVjbGFyZUZpZWxkKElOSEVSSVQsIGludC5jbGFzcykuc2V0U3RhdGlj\nKHRydWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxk\nTmFtZXMiLCBTdHJpbmdbXS5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAg\nICAgIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFz\nc1tdLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xh\ncmVGaWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcykuc2V0\nU3RhdGljKHRydWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoU1VQRVIs\nIENsYXNzLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CgogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsIHx8IGdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5k\nZWNsYXJlRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGZpZWxkLm1h\na2VQcm90ZWN0ZWQoKTsKICAgICAgICAgICAgZmllbGQuc2V0VHJhbnNpZW50\nKHRydWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1vZGlm\naWVzIHRoZSBjbGFzcyBpbml0aWFsaXphdGlvbiBtZXRob2QgKGNyZWF0aW5n\nIG9uZSBpZiBuZWNlc3NhcnkpCiAgICAgKiB0byBpbml0aWFsaXplIHRoZSBz\ndGF0aWMgZmllbGRzIG9mIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFu\nY2UgYW5kCiAgICAgKiB0byByZWdpc3RlciBpdCB3aXRoIHRoZSBpbXBsIGhl\nbHBlci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN0YXRpY0luaXRp\nYWxpemVyKCkgewogICAgICAgIENvZGUgY29kZSA9IGdldE9yQ3JlYXRlQ2xh\nc3NJbml0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBl\ncmNsYXNzKCkgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDApOwogICAgICAgICAgICAgICAgY29kZS5wdXRzdGF0aWMo\nKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgLy8gcGNJbmhlcml0ZWRGaWVsZENv\ndW50ID0gPHN1cGVyQ2xhc3M+LnBjR2V0TWFuYWdlZEZpZWxkQ291bnQoKQog\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2Qo\nZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgICAgICBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgUFJFICsgIkdldE1hbmFnZWRGaWVsZENvdW50IiwgaW50LmNsYXNzLmdl\ndE5hbWUoKSwgbnVsbCk7CiAgICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRp\nYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHBjUENTdXBlcmNsYXNzID0gPHN1cGVyQ2xh\nc3M+OwogICAgICAgICAgICAvLyB0aGlzIGludGVudGlvbmFsbHkgY2FsbHMg\nZ2V0RGVzY3JpYmVkVHlwZSgpIGRpcmVjdGx5CiAgICAgICAgICAgIC8vIGlu\nc3RlYWQgb2YgUENFbmhhbmNlci5nZXRUeXBlKCkKICAgICAgICAgICAgY29k\nZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoCiAgICAgICAgICAgICAgICBf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5\ncGUoKSk7CiAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQo\nU1VQRVIsIENsYXNzLmNsYXNzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBj\nRmllbGROYW1lcyA9IG5ldyBTdHJpbmdbXSB7ICI8bmFtZTE+IiwgIjxuYW1l\nMj4iLCAuLi4gfTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9t\nZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBjb2RlLmFuZXdh\ncnJheSgpLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZm1kc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBjb2RlLmFhc3RvcmUo\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVs\nZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsKCiAgICAg\nICAgLy8gcGNGaWVsZFR5cGVzID0gbmV3IENsYXNzW10geyA8dHlwZTE+LmNs\nYXNzLCA8dHlwZTI+LmNsYXNzLCAuLi4gfTsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUuYW5l\nd2FycmF5KCkuc2V0VHlwZShDbGFzcy5jbGFzcyk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0\nQ2xhc3MoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAg\nIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0\nYXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xhc3NbXS5j\nbGFzcyk7CgogICAgICAgIC8vIHBjRmllbGRGbGFncyA9IG5ldyBieXRlW10g\neyA8ZmxhZzE+LCA8ZmxhZzI+LCAuLi4gfTsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUubmV3\nYXJyYXkoKS5zZXRUeXBlKGJ5dGUuY2xhc3MpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShn\nZXRGaWVsZEZsYWcoZm1kc1tpXSkpOwogICAgICAgICAgICBjb2RlLmJhc3Rv\ncmUoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRG\naWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcyk7CgogICAg\nICAgIC8vIFBDUmVnaXN0cnkucmVnaXN0ZXIgKGNscywKICAgICAgICAvLwlw\nY0ZpZWxkTmFtZXMsIHBjRmllbGRUeXBlcywgcGNGaWVsZEZsYWdzLAogICAg\nICAgIC8vICBwY1BDU3VwZXJjbGFzcywgYWxpYXMsIG5ldyBYWFggKCkpOwog\nICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKF9tZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5z\nZXRGaWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsK\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVs\nZFR5cGVzIiwgQ2xhc3NbXS5jbGFzcyk7CiAgICAgICAgY29kZS5nZXRzdGF0\naWMoKS5zZXRGaWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFz\ncyk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChTVVBFUiwg\nQ2xhc3MuY2xhc3MpOwogICAgICAgIAogICAgICAgIGlmIChfbWV0YS5pc01h\ncHBlZCgpIHx8IF9tZXRhLmlzQWJzdHJhY3QoKSkKICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKF9tZXRhLmdldFR5cGVBbGlhcygpKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRO\ndWxsKCk7CgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKQogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGVsc2Ug\newogICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9wYyk7CiAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgfQoKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1l\ndGhvZChIRUxQRVJUWVBFLCAicmVnaXN0ZXIiLCB2b2lkLmNsYXNzLAogICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZ1tdLmNs\nYXNzLCBDbGFzc1tdLmNsYXNzLAogICAgICAgICAgICAgICAgYnl0ZVtdLmNs\nYXNzLCBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBQQ1RZUEUgfSk7Cgog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZmxhZyBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBieXRlIGdldEZpZWxkRmxhZyhGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxkTWV0\nYURhdGEuTUFOQUdFX05PTkUpCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAg\nICAgICAgYnl0ZSBmbGFncyA9IDA7CiAgICAgICAgaWYgKGZtZC5nZXREZWNs\nYXJlZFR5cGUoKS5pc1ByaW1pdGl2ZSgpCiAgICAgICAgICAgIHx8IFNlcmlh\nbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGZtZC5nZXREZWNsYXJl\nZFR5cGUoKSkpCiAgICAgICAgICAgIGZsYWdzID0gUGVyc2lzdGVuY2VDYXBh\nYmxlLlNFUklBTElaQUJMRTsKCiAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2Vt\nZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfVFJBTlNBQ1RJT05BTCkK\nICAgICAgICAgICAgZmxhZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNL\nX1dSSVRFOwogICAgICAgIGVsc2UgaWYgKCFmbWQuaXNQcmltYXJ5S2V5KCkg\nJiYgIWZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAg\nZmxhZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1dSSVRFCiAgICAg\nICAgICAgICAgICB8IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFEOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgZmxhZ3MgfD0gUGVyc2lzdGVuY2VD\nYXBhYmxlLk1FRElBVEVfV1JJVEUKICAgICAgICAgICAgICAgIHwgUGVyc2lz\ndGVuY2VDYXBhYmxlLk1FRElBVEVfUkVBRDsKICAgICAgICByZXR1cm4gZmxh\nZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBjb2RlIHRvIHBy\nb3Blcmx5IGhhbmRsZSBQZXJzaXN0ZW5jZUNhcGFibGUgc2VyaWFsaXphdGlv\nbgogICAgICogdG8gdGhlIGJ5dGVjb2RlLiBUaGlzIGluY2x1ZGVzIGNyZWF0\naW5nIGFuZCBpbml0aWFsaXppbmcgdGhlCiAgICAgKiBzdGF0aWMgPGNvZGU+\nc2VyaWFsVmVyc2lvblVJRDwvY29kZT4gY29uc3RhbnQgaWYgbm90IGFscmVh\nZHkgZGVmaW5lZCwKICAgICAqIGFzIHdlbGwgYXMgY3JlYXRpbmcgYSBjdXN0\nb20gPGNvZGU+d3JpdGVPYmplY3Q8L2NvZGU+IG1ldGhvZCBpZiB0aGUKICAg\nICAqIGNsYXNzIGlzIFNlcmlhbGl6YWJsZSBhbmQgZG9lcyBub3QgZGVmaW5l\nIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXJpYWxpemF0\naW9uQ29kZSgpIHsKICAgICAgICBpZiAoZXh0ZXJuYWxpemVEZXRhY2hlZCgp\nCiAgICAgICAgICAgIHx8ICFTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7\nCiAgICAgICAgICAgIC8vICMjIyMjIHdoYXQgc2hvdWxkIGhhcHBlbiBpZiBh\nIHR5cGUgaXMgRXh0ZXJuYWxpemFibGU/IEl0IGxvb2tzCiAgICAgICAgICAg\nIC8vICMjIyMjIGxpa2UgRXh0ZXJuYWxpemFibGUgY2xhc3NlcyB3aWxsIG5v\ndCBiZSBzZXJpYWxpemVkIGFzIFBDcwogICAgICAgICAgICAvLyAjIyMjIyBi\nYXNlZCBvbiB0aGlzIGxvZ2ljLgogICAgICAgICAgICBpZiAoIUV4dGVybmFs\naXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oCiAgICAgICAgICAgICAg\nICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAg\nYWRkU3ViY2xhc3NTZXJpYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBub3QgYWxyZWFkeSBw\ncmVzZW50LCBhZGQgYSBzZXJpYWxWZXJzaW9uVUlEIGZpZWxkOyBpZiB0aGUg\naW5zdGFuY2UKICAgICAgICAvLyBpcyBkZXRhY2hhYmxlIGFuZCB1c2VzIGRl\ndGFjaGVkIHN0YXRlIHdpdGhvdXQgYSBkZWNsYXJlZCBmaWVsZCwKICAgICAg\nICAvLyBjYW4ndCBhZGQgYSBzZXJpYWwgdmVyc2lvbiBVSUQgYmVjYXVzZSB3\nZSdsbCBiZSBhZGRpbmcgZXh0cmEgZmllbGRzCiAgICAgICAgLy8gdG8gdGhl\nIGVuaGFuY2VkIHZlcnNpb24KICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3Bj\nLmdldERlY2xhcmVkRmllbGQoInNlcmlhbFZlcnNpb25VSUQiKTsKICAgICAg\nICBpZiAoZmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBMb25nIHVpZCA9\nIG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB1aWQg\nPSBOdW1iZXJzLnZhbHVlT2YoT2JqZWN0U3RyZWFtQ2xhc3MubG9va3VwCiAg\nICAgICAgICAgICAgICAgICAgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSku\nZ2V0U2VyaWFsVmVyc2lvblVJRCgpKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGxhc3QtY2hhbmNl\nIGNhdGNoIGZvciBidWcgIzI4MyAod2hpY2ggY2FuIGhhcHBlbgogICAgICAg\nICAgICAgICAgLy8gaW4gYSB2YXJpZXR5IG9mIENsYXNzTG9hZGluZyBlbnZp\ncm9ubWVudHMpCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiZW5oYW5jZS11aWQtYWNjZXNzIiwgX21ldGEpLCB0KTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xv\nYy5nZXQoImVuaGFuY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHdlIGNvdWxkbid0IGFjY2VzcyB0\naGUgc2VyaWFsVmVyc2lvblVJRCwgd2Ugd2lsbCBoYXZlIHRvCiAgICAgICAg\nICAgIC8vIHNraXAgdGhlIG92ZXJyaWRlIG9mIHRoYXQgZmllbGQgYW5kIG5v\ndCBiZSBzZXJpYWxpemF0aW9uCiAgICAgICAgICAgIC8vIGNvbXBhdGlibGUg\nd2l0aCBub24tZW5oYW5jZWQgY2xhc3NlcwogICAgICAgICAgICBpZiAodWlk\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gX3BjLmRlY2xh\ncmVGaWVsZCgic2VyaWFsVmVyc2lvblVJRCIsIGxvbmcuY2xhc3MpOwogICAg\nICAgICAgICAgICAgZmllbGQubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAg\nICAgIGZpZWxkLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAgICAgIGZp\nZWxkLnNldEZpbmFsKHRydWUpOwoKICAgICAgICAgICAgICAgIENvZGUgY29k\nZSA9IGdldE9yQ3JlYXRlQ2xhc3NJbml0Q29kZShmYWxzZSk7CiAgICAgICAg\nICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodWlkLmxvbmdWYWx1ZSgpKTsKICAg\nICAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoZmllbGQp\nOwoKICAgICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHdyaXRl\nIG9iamVjdCBtZXRob2QKICAgICAgICBCQ01ldGhvZCB3cml0ZSA9IF9wYy5n\nZXREZWNsYXJlZE1ldGhvZCgid3JpdGVPYmplY3QiLAogICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH0pOwogICAg\nICAgIGJvb2xlYW4gZnVsbCA9IHdyaXRlID09IG51bGw7CiAgICAgICAgaWYg\nKGZ1bGwpIHsKICAgICAgICAgICAgLy8gcHJpdmF0ZSB2b2lkIHdyaXRlT2Jq\nZWN0IChPYmplY3RPdXRwdXRTdHJlYW0gb3V0KQogICAgICAgICAgICB3cml0\nZSA9IF9wYy5kZWNsYXJlTWV0aG9kKCJ3cml0ZU9iamVjdCIsIHZvaWQuY2xh\nc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0\nU3RyZWFtLmNsYXNzIH0pOwogICAgICAgICAgICB3cml0ZS5nZXRFeGNlcHRp\nb25zKHRydWUpLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgICAgIHdyaXRlLm1ha2VQcml2YXRlKCk7CiAgICAgICAgfQogICAg\nICAgIG1vZGlmeVdyaXRlT2JqZWN0TWV0aG9kKHdyaXRlLCBmdWxsKTsKCiAg\nICAgICAgLy8gYW5kIHJlYWQgb2JqZWN0CiAgICAgICAgQkNNZXRob2QgcmVh\nZCA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsCiAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9\nKTsKICAgICAgICBmdWxsID0gcmVhZCA9PSBudWxsOwogICAgICAgIGlmIChm\ndWxsKSB7CiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0\nIChPYmplY3RJbnB1dFN0cmVhbSBpbikKICAgICAgICAgICAgcmVhZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKCJyZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywKICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5j\nbGFzcyB9KTsKICAgICAgICAgICAgcmVhZC5nZXRFeGNlcHRpb25zKHRydWUp\nLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAg\nIHJlYWQuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24KICAgICAg\nICAgICAgICAgIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAg\nICAgICAgICAgcmVhZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAg\nICBtb2RpZnlSZWFkT2JqZWN0TWV0aG9kKHJlYWQsIGZ1bGwpOwogICAgfQoK\nICAgIHByaXZhdGUgdm9pZCBhZGRTdWJjbGFzc1NlcmlhbGl6YXRpb25Db2Rl\nKCkgewogICAgICAgIC8vIGZvciBnZW5lcmF0ZWQgc3ViY2xhc3Nlcywgc2Vy\naWFsaXphdGlvbiBtdXN0IHdyaXRlIGFuIGluc3RhbmNlIG9mCiAgICAgICAg\nLy8gdGhlIHN1cGVyY2xhc3MgaW5zdGVhZCBvZiB0aGUgc3ViY2xhc3MsIHNv\nIHRoYXQgdGhlIGNsaWVudCBWTSBjYW4KICAgICAgICAvLyBkZXNlcmlhbGl6\nZSBzdWNjZXNzZnVsbHkuCgogICAgICAgIC8vIHByaXZhdGUgT2JqZWN0IHdy\naXRlUmVwbGFjZSgpIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRpb24KICAg\nICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZCgid3Jp\ndGVSZXBsYWNlIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRo\nb2QuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oT2JqZWN0U3Ry\nZWFtRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gT2JqZWN0IG8gPSBuZXcg\nPG1hbmFnZWQtdHlwZT4oKQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\nX21hbmFnZWRUeXBlKTsgLy8gZm9yIHJldHVybgogICAgICAgIGNvZGUuZHVw\nKCk7IC8vIGZvciBwb3N0LTxpbml0PiB3b3JrCiAgICAgICAgY29kZS5kdXAo\nKTsgLy8gZm9yIDxpbml0PgogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLCAiPGluaXQ+IiwK\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbnVsbCk7CgogICAgICAgIC8vIGNv\ncHkgYWxsIHRoZSBmaWVsZHMuCiAgICAgICAgLy8gIyMjIyMgbGltaXRpbmcg\ndG8gSlBBIEBUcmFuc2llbnQgbGltaXRhdGlvbnMKICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIC8vIG8uPGZpZWxkPiA9IHRoaXMu\nPGZpZWxkPiAob3IgcmVmbGVjdGl2ZSBhbmFsb2cpCiAgICAgICAgICAgIGNv\nZGUuZHVwKCk7IC8vIGZvciBwdXRmaWVsZAogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOyAvLyBmb3IgZ2V0ZmllbGQKICAgICAgICAgICAg\nZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLCBmbWRzW2ldLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlwZSwg\nZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuYXJl\ndHVybigpLnNldFR5cGUoT2JqZWN0LmNsYXNzKTsKCiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBj\nbGFzcyBiZWluZyBlbmhhbmNlZCBzaG91bGQgZXh0ZXJuYWxpemUgdG8gYSBk\nZXRhY2hlZAogICAgICogaW5zdGFuY2UgcmF0aGVyIHRoYW4gc2VyaWFsaXpl\nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZXh0ZXJuYWxpemVEZXRh\nY2hlZCgpIHsKICAgICAgICByZXR1cm4gQ2xhc3NNZXRhRGF0YS5TWU5USEVU\nSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3RhdGUoKSkKICAgICAgICAg\nICAgJiYgU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpKQogICAgICAgICAgICAmJiAhX3JlcG9z\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCku\nCiAgICAgICAgICAgIGlzRGV0YWNoZWRTdGF0ZVRyYW5zaWVudCgpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyBhIGN1c3RvbSB3cml0ZU9iamVjdCBt\nZXRob2QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiB7QGxpbmsgT2Jq\nZWN0T3V0cHV0U3RyZWFtI2RlZmF1bHRXcml0ZU9iamVjdH0gbWV0aG9kLAog\nICAgICogYnV0IG9ubHkgYWZ0ZXIgY2FsbGluZyB0aGUgaW50ZXJuYWwgPGNv\nZGU+cGNTZXJpYWxpemluZzwvY29kZT4gbWV0aG9kLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgbW9kaWZ5V3JpdGVPYmplY3RNZXRob2QoQkNNZXRob2Qg\nbWV0aG9kLCBib29sZWFuIGZ1bGwpIHsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0\nKCk7CgogICAgICAgIC8vIGJvb2wgY2xlYXIgPSBwY1NlcmlhbGl6aW5nICgp\nOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nU2VyaWFsaXppbmciLAogICAgICAgICAgICBib29sZWFuLmNsYXNzLCBudWxs\nKTsKICAgICAgICBpbnQgY2xlYXIgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRl\neCgpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwoY2xlYXIpOwoK\nICAgICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBvdXQuZGVmYXVs\ndFdyaXRlT2JqZWN0ICgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MsCiAgICAgICAgICAg\nICAgICAiZGVmYXVsdFdyaXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIH0KCiAgICAg\nICAgSW5zdHJ1Y3Rpb24gdG1wbGF0ZSA9IChBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29k\nZUFjdGlvbigpKSkudnJldHVybigpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiB0b3JldDsKICAgICAgICBJbnN0cnVjdGlvbiByZXQ7CiAgICAgICAgY29k\nZS5iZWZvcmVGaXJzdCgpOwogICAgICAgIHdoaWxlIChjb2RlLnNlYXJjaEZv\ncndhcmQodG1wbGF0ZSkpIHsKICAgICAgICAgICAgcmV0ID0gY29kZS5wcmV2\naW91cygpOwogICAgICAgICAgICAvLyBpZiAoY2xlYXIpIHBjU2V0RGV0YWNo\nZWRTdGF0ZSAobnVsbCk7CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRM\nb2NhbChjbGVhcik7CiAgICAgICAgICAgIHRvcmV0ID0gY29kZS5pZmVxKCk7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsg\nIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAg\ndG9yZXQuc2V0VGFyZ2V0KHJldCk7CiAgICAgICAgICAgIGNvZGUubmV4dCgp\nOyAvLyBqdW1wIG92ZXIgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIGN1c3Rv\nbSByZWFkT2JqZWN0IG1ldGhvZCB0aGF0IGRlbGVnYXRlcyB0byB0aGUKICAg\nICAqIHtAbGluayBPYmplY3RJbnB1dFN0cmVhbSNyZWFkT2JqZWN0fSBtZXRo\nb2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtb2RpZnlSZWFkT2JqZWN0\nTWV0aG9kKEJDTWV0aG9kIG1ldGhvZCwgYm9vbGVhbiBmdWxsKSB7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICAvLyBpZiB0aGlzIGluc3Rh\nbmNlIHVzZXMgc3ludGhldGljIGRldGFjaGVkIHN0YXRlLCBub3RlIHRoYXQg\naXQgaGFzCiAgICAgICAgLy8gYmVlbiBkZXNlcmlhbGl6ZWQKICAgICAgICBp\nZiAoQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERl\ndGFjaGVkU3RhdGUoKSkpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLAogICAgICAg\nICAgICAgICAgIkRFU0VSSUFMSVpFRCIsIE9iamVjdC5jbGFzcyk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKGZ1bGwpIHsKICAgICAgICAgICAgLy8gaW4uZGVmYXVsdFJl\nYWRPYmplY3QgKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKE9iamVjdElucHV0U3RyZWFtLmNsYXNzLAogICAgICAgICAgICAgICAg\nImRlZmF1bHRSZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRo\nZSBwY0lzRGV0YWNoZWQoKSBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIGFuIGlu\nc3RhbmNlCiAgICAgKiBpcyBkZXRhY2hlZC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZElzRGV0YWNoZWRNZXRob2QoKQogICAgICAgIHRocm93cyBO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyBib29s\nZWFuIHBjSXNEZXRhY2hlZCgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIklzRGV0YWNoZWQiLAogICAgICAg\nICAgICBCb29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRob2QubWFr\nZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwogICAgICAgIGJvb2xlYW4gbmVlZHNEZWZpbml0aXZlTWV0aG9k\nID0gd3JpdGVJc0RldGFjaGVkTWV0aG9kKGNvZGUpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgICAgIGlmICghbmVlZHNEZWZpbml0aXZlTWV0aG9k\nKSAKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBwcml2YXRlIGJv\nb2xlYW4gcGNJc0RldGFjaGVkU3RhdGVEZWZpbml0aXZlKCkKICAgICAgICAv\nLyAgIHJldHVybiBmYWxzZTsKICAgICAgICAvLyBhdXhpbGxpYXJ5IGVuaGFu\nY2VycyBtYXkgY2hhbmdlIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhpcyBtZXRo\nb2QKICAgICAgICAvLyBpZiB0aGVpciBzcGVjcyBjb25zaWRlciBkZXRhY2hl\nZCBzdGF0ZSBkZWZpbml0aXZlCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoSVNERVRBQ0hFRFNUQVRFREVGSU5JVElWRSwgYm9vbGVhbi5j\nbGFzcywKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQ\ncml2YXRlKCk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmYWxzZSk7CiAg\nICAgICAgY29kZS5pcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBib2R5IG9mIHRo\nZSBwY0lzRGV0YWNoZWQoKSBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIGFuCiAg\nICAgKiBpbnN0YW5jZSBpcyBkZXRhY2hlZC4KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgd2UgbmVlZCBhIHBjSXNEZXRhY2hlZFN0YXRlRGVmaW5p\ndGl2ZSBtZXRob2QsIGZhbHNlCiAgICAgKiBvdGhlcndpc2UKICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIHdyaXRlSXNEZXRhY2hlZE1ldGhvZChDb2Rl\nIGNvZGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gbm90IGRldGFjaGFibGU6IHJldHVybiBCb29sZWFuLkZB\nTFNFCiAgICAgICAgaWYgKCFfbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAg\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xh\nc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KCiAgICAgICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgLy8gICAg\nIHJldHVybiAoc20uaXNEZXRhY2hlZCAoKSkgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmbnVsbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNl\ndE1ldGhvZChTTVRZUEUsICJpc0RldGFjaGVkIiwKICAgICAgICAgICAgYm9v\nbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlm\nZmFsc2UgPSBjb2RlLmlmZXEoKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygp\nLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFz\ncyk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgaWZmYWxzZS5z\nZXRUYXJnZXQoY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNs\nYXNzLCAiRkFMU0UiLAogICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgIC8vIGlmIHdlIHVzZSBk\nZXRhY2hlZCBzdGF0ZToKICAgICAgICAvLyBpZiAocGNHZXREZXRhY2hlZFN0\nYXRlICgpICE9IG51bGwKICAgICAgICAvLyAgICAgJiYgcGNHZXREZXRhY2hl\nZFN0YXRlICE9IERFU0VSSUFMSVpFRCkKICAgICAgICAvLyAgICAgcmV0dXJu\nIEJvb2xlYW4uVFJVRTsKICAgICAgICBCb29sZWFuIHN0YXRlID0gX21ldGEu\ndXNlc0RldGFjaGVkU3RhdGUoKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24g\nbm90ZGVzZXIgPSBudWxsOwogICAgICAgIEluc3RydWN0aW9uIHRhcmdldDsK\nICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5GQUxTRSkgewogICAgICAg\nICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSkpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWZpbnMg\nPSBjb2RlLmlmbnVsbCgpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAg\nICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzLAogICAgICAgICAgICAgICAgIkRFU0VSSUFMSVpFRCIsIE9iamVj\ndC5jbGFzcyk7CiAgICAgICAgICAgIG5vdGRlc2VyID0gY29kZS5pZmFjbXBl\ncSgpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJv\nb2xlYW4uY2xhc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAg\nICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAgICAgaWYgKHN0YXRlID09\nIEJvb2xlYW4uVFJVRSkgewogICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2\nZSB0byB1c2UgZGV0YWNoZWQgc3RhdGU6CiAgICAgICAgICAgICAgICAvLyBy\nZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgICAgIHRhcmdldCA9\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZB\nTFNFIiwKICAgICAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKTsKICAg\nICAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAg\nICAgICAgICAgbm90ZGVzZXIuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAg\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nY3JlYXRlIGFydGlmaWNpYWwgdGFyZ2V0IHRvIHNpbXBsaWZ5CiAgICAgICAg\ndGFyZ2V0ID0gY29kZS5ub3AoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQo\ndGFyZ2V0KTsKICAgICAgICBpZiAobm90ZGVzZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgbm90ZGVzZXIuc2V0VGFyZ2V0KHRhcmdldCk7CgogICAgICAgIC8v\nIGFsbG93IHVzZXJzIHdpdGggdmVyc2lvbiBvciBhdXRvLWFzc2lnbmVkIHBr\nIGZpZWxkcyB0byBtYW51YWxseSAKICAgICAgICAvLyBjb25zdHJ1Y3QgYSAi\nZGV0YWNoZWQiIGluc3RhbmNlLCBzbyBjaGVjayB0aGVzZSBiZWZvcmUgdGFr\naW5nIGludG8gCiAgICAgICAgLy8gYWNjb3VudCBub24tZXhpc3RlbnQgZGV0\nYWNoZWQgc3RhdGUKCiAgICAgICAgLy8gY29uc2lkZXIgZGV0YWNoZWQgaWYg\ndmVyc2lvbiBpcyBub24tZGVmYXVsdAogICAgICAgIEZpZWxkTWV0YURhdGEg\ndmVyc2lvbiA9IF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgIGlm\nIChzdGF0ZSAhPSBCb29sZWFuLlRSVUUgJiYgdmVyc2lvbiAhPSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIGlmICg8dmVyc2lvbj4gIT0gPGRlZmF1bHQ+KQog\nICAgICAgICAgICAvLwkJcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHZlcnNpb24pOwogICAgICAgICAg\nICBpZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNvZGUsIHZlcnNpb24pOwogICAg\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xh\nc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLAog\nICAgICAgICAgICAgICAgQm9vbGVhbi5jbGFzcykpOwogICAgICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KCiAgICAgICAgLy8gY29uc2lkZXIgZGV0YWNoZWQgaWYgYXV0by1n\nZW5uZWQgcHJpbWFyeSBrZXlzIGFyZSBub24tZGVmYXVsdAogICAgICAgIGlm\naW5zID0gbnVsbDsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMyID0g\nbnVsbDsKICAgICAgICBib29sZWFuIGhhc0F1dG9Bc3NpZ25lZFBLID0gZmFs\nc2U7CiAgICAgICAgaWYgKHN0YXRlICE9IEJvb2xlYW4uVFJVRQogICAgICAg\nICAgICAmJiBfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLklEX0FQUExJQ0FUSU9OKSB7CiAgICAgICAgICAgIC8vIGZvciBlYWNo\nIHBrIGZpZWxkOgogICAgICAgICAgICAvLyBpZiAoPHBrPiAhPSA8ZGVmYXVs\ndD4gWyYmICEiIi5lcXVhbHMgKDxwaz4pXSkKICAgICAgICAgICAgLy8JCXJl\ndHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBwa3MgPSBfbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldFZhbHVlU3RyYXRlZ3koKSA9\nPSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICB0YXJnZXQgPSBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmIChp\nZmlucyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGlmaW5zLnNldFRh\ncmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAgaWYgKGlmaW5zMiAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGlmaW5zMi5zZXRUYXJnZXQodGFy\nZ2V0KTsKICAgICAgICAgICAgICAgIGlmaW5zMiA9IG51bGw7CgogICAgICAg\nICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBwa3NbaV0p\nOwogICAgICAgICAgICAgICAgaWZpbnMgPSBpZkRlZmF1bHRWYWx1ZShjb2Rl\nLCBwa3NbaV0pOwogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlNUUklORykgewogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgiIik7CiAg\nICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBwa3NbaV0pOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChTdHJpbmcuY2xhc3MsICJlcXVh\nbHMiLAogICAgICAgICAgICAgICAgICAgICAgICBib29sZWFuLmNsYXNzLCBu\nZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICAgICAg\nICAgIGlmaW5zMiA9IGNvZGUuaWZuZSgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29s\nZWFuLmNsYXNzLCAiVFJVRSIsCiAgICAgICAgICAgICAgICAgICAgQm9vbGVh\nbi5jbGFzcyk7CiAgICAgICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIGFydGlm\naWNpYWwgdGFyZ2V0IHRvIHNpbXBsaWZ5CiAgICAgICAgdGFyZ2V0ID0gY29k\nZS5ub3AoKTsKICAgICAgICBpZiAoaWZpbnMgIT0gbnVsbCkKICAgICAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgaWYgKGlmaW5z\nMiAhPSBudWxsKQogICAgICAgICAgICBpZmluczIuc2V0VGFyZ2V0KHRhcmdl\ndCk7CgogICAgICAgIC8vIGlmIGhhcyBhdXRvLWFzc2lnbmVkIHBrIGFuZCB3\nZSBnZXQgdG8gdGhpcyBwb2ludCwgbXVzdCBoYXZlIGRlZmF1bHQKICAgICAg\nICAvLyB2YWx1ZSwgc28gbXVzdCBiZSBuZXcgaW5zdGFuY2UKICAgICAgICBp\nZiAoaGFzQXV0b0Fzc2lnbmVkUEspIHsKICAgICAgICAgICAgY29kZS5nZXRz\ndGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29s\nZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIGRldGFjaGVkIHN0YXRlIGlzIG5vdCBkZWZpbml0aXZlLCBqdXN0IGdpdmUg\ndXAgbm93IGFuZCByZXR1cm4KICAgICAgICAvLyBudWxsIHNvIHRoYXQgdGhl\nIHJ1bnRpbWUgd2lsbCBwZXJmb3JtIGEgREIgbG9va3VwIHRvIGRldGVybWlu\nZQogICAgICAgIC8vIHdoZXRoZXIgd2UncmUgZGV0YWNoZWQgb3IgbmV3CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoSVNERVRBQ0hFRFNUQVRFREVGSU5J\nVElWRSwgYm9vbGVhbi5jbGFzcywKICAgICAgICAgICAgbnVsbCk7CiAgICAg\nICAgaWZpbnMgPSBjb2RlLmlmbmUoKTsKICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKCiAgICAgICAgLy8gbm8g\nZGV0YWNoZWQgc3RhdGU6IGlmIGluc3RhbmNlIHVzZXMgZGV0YWNoZWQgc3Rh\ndGUgYW5kIGl0J3Mgbm90CiAgICAgICAgLy8gc3ludGhldGljIG9yIHRoZSBp\nbnN0YW5jZSBpcyBub3Qgc2VyaWFsaXphYmxlIG9yIHRoZSBzdGF0ZSBpc24n\ndAogICAgICAgIC8vIHRyYW5zaWVudCwgbXVzdCBub3QgYmUgZGV0YWNoZWQK\nICAgICAgICBpZiAoc3RhdGUgPT0gbnVsbAogICAgICAgICAgICAmJiAoIUNs\nYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hl\nZFN0YXRlKCkpCiAgICAgICAgICAgIHx8ICFTZXJpYWxpemFibGUuY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpCiAg\nICAgICAgICAgIHx8ICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLmdldERl\ndGFjaFN0YXRlSW5zdGFuY2UoKS4KICAgICAgICAgICAgaXNEZXRhY2hlZFN0\nYXRlVHJhbnNpZW50KCkpKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBCb29s\nZWFuLkZBTFNFCiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIG5vIGRldGFjaGVkIHN0YXRl\nOiBpZiBpbnN0YW5jZSB1c2VzIGRldGFjaGVkIHN0YXRlIChhbmQgbXVzdCBi\nZQogICAgICAgIC8vIHN5bnRoZXRpYyBhbmQgdHJhbnNpZW50IGluIHNlcmlh\nbGl6YWJsZSBpbnN0YW5jZSBhdCB0aGlzIHBvaW50KSwKICAgICAgICAvLyBu\nb3QgZGV0YWNoZWQgaWYgc3RhdGUgbm90IHNldCB0byBERVNFUklBTElaRUQK\nICAgICAgICBpZiAoc3RhdGUgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBp\nZiAocGNHZXREZXRhY2hlZFN0YXRlICgpID09IG51bGwpIC8vIGluc3RlYWQg\nb2YgREVTRVJJQUxJWkVECiAgICAgICAgICAgIC8vICAgICByZXR1cm4gQm9v\nbGVhbi5GQUxTRTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAg\nICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBpZmlu\ncyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3Rh\ndGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVh\nbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAg\nICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBnaXZlIHVwOyB3ZSBqdXN0IGRvbid0IGtub3cKICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29tcGFyZSB0aGUgZ2l2ZW4gZmllbGQgdG8gaXRzIEphdmEgZGVm\nYXVsdCwgcmV0dXJuaW5nIHRoZQogICAgICogY29tcGFyaXNvbiBpbnN0cnVj\ndGlvbi4gVGhlIGZpZWxkIHZhbHVlIHdpbGwgYWxyZWFkeSBiZSBvbiB0aGUg\nc3RhY2suCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEp1bXBJbnN0cnVj\ndGlvbiBpZkRlZmF1bHRWYWx1ZShDb2RlIGNvZGUsCiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVDoKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBEKTsKICAgICAgICAgICAgICAg\nIGNvZGUuZGNtcGwoKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlm\nZXEoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEYpOwogICAg\nICAgICAgICAgICAgY29kZS5mY21wbCgpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT05HOgogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKDBMKTsKICAgICAgICAgICAgICAgIGNvZGUubGNtcCgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZudWxsKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBn\nZXQgdGhlIGNvZGUgZm9yIHRoZSBjbGFzcyBpbml0aWFsaXplciBtZXRob2Qs\nCiAgICAgKiBjcmVhdGluZyB0aGUgbWV0aG9kIGlmIGl0IGRvZXMgbm90IGFs\ncmVhZHkgZXhpc3QuCiAgICAgKi8KICAgIHByaXZhdGUgQ29kZSBnZXRPckNy\nZWF0ZUNsYXNzSW5pdENvZGUoYm9vbGVhbiByZXBsYWNlTGFzdCkgewogICAg\nICAgIEJDTWV0aG9kIGNsaW5pdCA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgi\nPGNsaW5pdD4iKTsKICAgICAgICBDb2RlIGNvZGU7CiAgICAgICAgaWYgKGNs\naW5pdCAhPSBudWxsKSB7CiAgICAgICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICAgICAgaWYgKHJlcGxhY2VMYXN0KSB7CiAg\nICAgICAgICAgICAgICBDb2RlIHRlbXBsYXRlID0gQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAgICAgICAgICAgICAgIGNvZGUu\nc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZS52cmV0dXJuKCkpOwogICAgICAgICAg\nICAgICAgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICAgICAgY29kZS5z\nZXQodGVtcGxhdGUubm9wKCkpOwogICAgICAgICAgICAgICAgY29kZS5uZXh0\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvZGU7CiAg\nICAgICAgfQoKICAgICAgICAvLyBhZGQgc3RhdGljIGluaXRpYWxpemVyIG1l\ndGhvZCBpZiBub24gZXhpc3RzCiAgICAgICAgY2xpbml0ID0gX3BjLmRlY2xh\ncmVNZXRob2QoIjxjbGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgY2xpbml0Lm1ha2VQYWNrYWdlKCk7CiAgICAgICAgY2xpbml0LnNldFN0\nYXRpYyh0cnVlKTsKICAgICAgICBjbGluaXQuc2V0RmluYWwodHJ1ZSk7Cgog\nICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBp\nZiAoIXJlcGxhY2VMYXN0KSB7CiAgICAgICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBjb2RlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBi\neXRlY29kZSBtb2RpZnlpbmcgdGhlIGNsb25pbmcgYmVoYXZpb3Igb2YgdGhl\nIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCB0byBjb3JyZWN0bHkgcmVw\nbGFjZSB0aGUgPGNvZGU+cGNTdGF0ZU1hbmFnZXI8L2NvZGU+IAogICAgICog\naW5zdGFuY2UgZmllbGRzIG9mIGFueSBjbG9uZSBjcmVhdGVkIHdpdGggdGhl\naXIgZGVmYXVsdCB2YWx1ZXMuIAogICAgICogQWxzbywgaWYgdGhpcyBjbGFz\ncyBpcyB0aGUgYmFzZSBQQyB0eXBlIGFuZCBkb2VzIG5vdCBkZWNsYXJlZCAK\nICAgICAqIGEgY2xvbmUgbWV0aG9kLCBvbmUgd2lsbCBiZSBhZGRlZC4gQWxz\nbywgaWYgX3BjIGlzIGEgc3ludGhldGljCiAgICAgKiBzdWJjbGFzcywgY3Jl\nYXRlIHRoZSBjbG9uZSgpIG1ldGhvZCB0aGF0IGNsZWFycyB0aGUgc3RhdGUg\nbWFuYWdlcgogICAgICogdGhhdCBtYXkgaGF2ZSBiZWVuIGluaXRpYWxpemVk\nIGluIGEgc3VwZXIncyBjbG9uZSgpIG1ldGhvZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZENsb25pbmdDb2RlKCkgewogICAgICAgIGlmIChfbWV0\nYS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJj\nbGFzcygpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGFkZCB0\naGUgY2xvbmUgbWV0aG9kIGlmIG5lY2Vzc2FyeQogICAgICAgIEJDTWV0aG9k\nIGNsb25lID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCJjbG9uZSIsIAogICAg\nICAgICAgICAoU3RyaW5nW10pIG51bGwpOwogICAgICAgIFN0cmluZyBzdXBl\nck5hbWUgPSBfbWFuYWdlZFR5cGUuZ2V0U3VwZXJjbGFzc05hbWUoKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBudWxsOwogICAgICAgIGlmIChjbG9uZSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIC8vIGFkZCBjbG9uZSBzdXBwb3J0IGZvciBi\nYXNlIGNsYXNzZXMKICAgICAgICAgICAgLy8gd2hpY2ggYWxzbyBpbXBsZW1l\nbnQgY2xvbmVhYmxlCiAgICAgICAgICAgIGJvb2xlYW4gaXNDbG9uZWFibGUg\nPSBDbG9uZWFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgKICAgICAgICAg\nICAgICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpOwogICAgICAgICAgICBi\nb29sZWFuIGV4dGVuZHNPYmplY3QgPQogICAgICAgICAgICAgICAgc3VwZXJO\nYW1lLmVxdWFscyhPYmplY3QuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgaWYgKCFpc0Nsb25lYWJsZSB8fCAoIWV4dGVuZHNPYmplY3QgJiYgIWdl\ndENyZWF0ZVN1YmNsYXNzKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgaWYgKCFnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAg\nICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9nLnRyYWNlKAogICAgICAgICAgICAgICAgICAgICAg\nICBfbG9jLmdldCgiZW5oYW5jZS1jbG9uZWFibGUiLCBfbWFuYWdlZFR5cGUu\nZ2V0TmFtZSgpKSk7CgogICAgICAgICAgICAvLyBhZGQgY2xvbmUgbWV0aG9k\nCiAgICAgICAgICAgIC8vIHByb3RlY3RlZCBPYmplY3QgY2xvbmUgKCkgdGhy\nb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uCiAgICAgICAgICAgIGNs\nb25lID0gX3BjLmRlY2xhcmVNZXRob2QoImNsb25lIiwgT2JqZWN0LmNsYXNz\nLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFzZXRWaXNpYmlsaXR5VG9TdXBl\nck1ldGhvZChjbG9uZSkpCiAgICAgICAgICAgICAgICBjbG9uZS5tYWtlUHJv\ndGVjdGVkKCk7CiAgICAgICAgICAgIGNsb25lLmdldEV4Y2VwdGlvbnModHJ1\nZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoQ2xvbmVOb3RTdXBw\nb3J0ZWRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBjb2RlID0gY2xv\nbmUuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgICAgIC8vIHJldHVybiBzdXBl\nci5jbG9uZSAoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9uZSIsCiAgICAgICAgICAgICAg\nICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nLy8gZ2V0IHRoZSBjbG9uZSBtZXRob2QgY29kZQogICAgICAgICAgICBjb2Rl\nID0gY2xvbmUuZ2V0Q29kZShmYWxzZSk7CiAgICAgICAgICAgIGlmIChjb2Rl\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgc3VwZXIuY2xvbmUgKCkgaW5z\ndHJ1Y3Rpb24gdG8gbWF0Y2ggYWdhaW5zdAogICAgICAgIEluc3RydWN0aW9u\nIHRlbXBsYXRlID0gKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS5p\nbnZva2VzcGVjaWFsKCkKICAgICAgICAgICAgLnNldE1ldGhvZChzdXBlck5h\nbWUsICJjbG9uZSIsIE9iamVjdC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwoK\nICAgICAgICAvLyBmaW5kIGNhbGxzIHRvIHRoZSB0ZW1wbGF0ZSBpbnN0cnVj\ndGlvbjsgb24gbWF0Y2gKICAgICAgICAvLyBjbG9uZSB3aWxsIGJlIG9uIHN0\nYWNrCiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwogICAgICAgIGlmIChj\nb2RlLnNlYXJjaEZvcndhcmQodGVtcGxhdGUpKSB7CiAgICAgICAgICAgIC8v\nICgoPHR5cGU+KSBjbG9uZSkucGNTdGF0ZU1hbmFnZXIgPSBudWxsOwogICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoX3BjKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldE51bGwoKTsKICAgICAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwoKICAgICAgICAgICAgLy8gaWYgbW9kaWZpZWQs\nIGluY3JlYXNlIHN0YWNrCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBh\ndXhpbGlhcnkgZW5oYW5jZXJzIHJlZ2lzdGVyZWQgYXMge0BsaW5rIFNlcnZp\nY2VzIHNlcnZpY2VzfS4KICAgICAqLwogICAgcHVibGljIEF1eGlsaWFyeUVu\naGFuY2VyW10gZ2V0QXV4aWxpYXJ5RW5oYW5jZXJzKCkgewoJCXJldHVybiBf\nYXV4RW5oYW5jZXJzOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFsbG93\nIGFueSByZWdpc3RlcmVkIGF1eGlsaWFyeSBjb2RlIGdlbmVyYXRvcnMgdG8g\ncnVuLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcnVuQXV4aWxpYXJ5RW5o\nYW5jZXJzKCkgewogICAgCWZvciAoaW50IGkgPSAwOyBpIDwgX2F1eEVuaGFu\nY2Vycy5sZW5ndGg7IGkrKykKICAgIAkJX2F1eEVuaGFuY2Vyc1tpXS5ydW4o\nX3BjLCBfbWV0YSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJt\ncyBpZiB0aGUgZ2l2ZW4gbWV0aG9kIGJlIHNraXBwZWQuCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBtZXRob2QgbWV0aG9kIHRvIGJlIHNraXBwZWQgb3Igbm90\nCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYW55IG9mIHRoZSBhdXhpbGlhcnkg\nZW5oYW5jZXJzIHNraXBzIHRoZSBnaXZlbiBtZXRob2QsCiAgICAgKiBvciBp\nZiB0aGUgbWV0aG9kIGlzIGEgY29uc3RydWN0b3IKICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0aG9kIG1ldGhvZCkgewog\nICAgICAgIGlmICgiPGluaXQ+Ii5lcXVhbHMobWV0aG9kLmdldE5hbWUoKSkp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIAogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgX2F1eEVuaGFuY2Vycy5sZW5ndGg7IGkrKykK\nICAgIAkJaWYgKF9hdXhFbmhhbmNlcnNbaV0uc2tpcEVuaGFuY2UobWV0aG9k\nKSkKICAgIAkJCXJldHVybiB0cnVlOwogICAgICAgIAogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgc3ludGhldGlj\nIGZpZWxkIGFjY2VzcyBtZXRob2RzIHRoYXQgd2lsbCByZXBsYWNlIGFsbCBk\naXJlY3QKICAgICAqIGZpZWxkIGFjY2Vzc2VzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkQWNjZXNzb3JzKCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQog\nICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAg\nICAgICAgICBpZiAoIWdldFJlZGVmaW5lKCkgJiYgaXNQcm9wZXJ0eUFjY2Vz\ncyhmbWRzW2ldKSkgewogICAgICAgICAgICAgICAgICAgIGFkZFN1YmNsYXNz\nU2V0TWV0aG9kKGZtZHNbaV0pOwogICAgICAgICAgICAgICAgICAgIGFkZFN1\nYmNsYXNzR2V0TWV0aG9kKGZtZHNbaV0pOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWRkR2V0TWV0\naG9kKGksIGZtZHNbaV0pOwogICAgICAgICAgICAgICAgYWRkU2V0TWV0aG9k\nKGksIGZtZHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyBhIG5vbi1zdGF0aWMgc2V0dGVyIHRoYXQg\nZGVsZWdhdGVzIHRvIHRoZSBzdXBlciBtZXRob2RzLCBhbmQKICAgICAqIHBl\ncmZvcm1zIGFueSBuZWNlc3NhcnkgZmllbGQgdHJhY2tpbmcuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRTdWJjbGFzc1NldE1ldGhvZChGaWVsZE1l\ndGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIHsKICAgICAgICBDbGFzcyBwcm9wVHlwZSA9IGZtZC5nZXREZWNsYXJl\nZFR5cGUoKTsKICAgICAgICBTdHJpbmcgc2V0dGVyTmFtZSA9IGdldFNldHRl\nck5hbWUoZm1kKTsKICAgICAgICBCQ01ldGhvZCBzZXR0ZXIgPSBfcGMuZGVj\nbGFyZU1ldGhvZChzZXR0ZXJOYW1lLCB2b2lkLmNsYXNzLAogICAgICAgICAg\nICBuZXcgQ2xhc3NbXSB7IHByb3BUeXBlIH0pOwogICAgICAgIHNldFZpc2li\naWxpdHlUb1N1cGVyTWV0aG9kKHNldHRlcik7CiAgICAgICAgQ29kZSBjb2Rl\nID0gc2V0dGVyLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIG5vdCBuZWNl\nc3NhcnkgaWYgd2UncmUgYWxyZWFkeSB0cmFja2luZyBhY2Nlc3MgdmlhIHJl\nZGVmaW5pdGlvbgogICAgICAgIGlmICghZ2V0UmVkZWZpbmUoKSkgewogICAg\nICAgICAgICAvLyBnZXQgdGhlIG9yaWcgdmFsdWUgb250byBzdGFjawogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBh\nZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAg\nIGludCB2YWwgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAg\nICAgICBjb2RlLnhzdG9yZSgpLnNldExvY2FsKHZhbCkuc2V0VHlwZShmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBhZGROb3RpZnlNdXRh\ndGlvbihjb2RlLCBmbWQsIHZhbCwgMCk7CiAgICAgICAgfQoKICAgICAgICAv\nLyAjIyMjIyB0ZXN0IGNhc2U6IEIgZXh0ZW5kcyBBLiBNZXRob2RzIGRlZmlu\nZWQgaW4gQS4gV2hhdAogICAgICAgIC8vICMjIyMjIGhhcHBlbnM/CiAgICAg\nICAgLy8gc3VwZXIuc2V0WFhYKC4uLikKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbSgwKS5z\nZXRUeXBlKHByb3BUeXBlKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwKICAgICAgICAg\nICAgc2V0dGVyTmFtZSwgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBwcm9w\nVHlwZSB9KTsKCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIHNldFZp\nc2liaWxpdHlUb1N1cGVyTWV0aG9kKEJDTWV0aG9kIG1ldGhvZCkgewogICAg\nICAgIEJDTWV0aG9kW10gbWV0aG9kcyA9IF9tYW5hZ2VkVHlwZS5nZXRNZXRo\nb2RzKG1ldGhvZC5nZXROYW1lKCksCiAgICAgICAgICAgIG1ldGhvZC5nZXRQ\nYXJhbVR5cGVzKCkpOwogICAgICAgIGlmIChtZXRob2RzLmxlbmd0aCA9PSAw\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tYWNjZXNzb3IiLAogICAgICAgICAgICAgICAgX21hbmFnZWRUeXBl\nLmdldE5hbWUoKSwgbWV0aG9kLmdldE5hbWUoKSkpOwogICAgICAgIEJDTWV0\naG9kIHN1cGVyTWV0aCA9IG1ldGhvZHNbMF07CiAgICAgICAgaWYgKHN1cGVy\nTWV0aC5pc1ByaXZhdGUoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVBy\naXZhdGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBl\nbHNlIGlmIChzdXBlck1ldGguaXNQYWNrYWdlKCkpIHsKICAgICAgICAgICAg\nbWV0aG9kLm1ha2VQYWNrYWdlKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0gZWxzZSBpZiAoc3VwZXJNZXRoLmlzUHJvdGVjdGVkKCkp\nIHsKICAgICAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChzdXBlck1l\ndGguaXNQdWJsaWMoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVB1Ymxp\nYygpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBh\nIG5vbi1zdGF0aWMgZ2V0dGVyIHRoYXQgZGVsZWdhdGVzIHRvIHRoZSBzdXBl\nciBtZXRob2RzLCBhbmQKICAgICAqIHBlcmZvcm1zIGFueSBuZWNlc3Nhcnkg\nZmllbGQgdHJhY2tpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRT\ndWJjbGFzc0dldE1ldGhvZChGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAg\nIFN0cmluZyBtZXRoTmFtZSA9ICJnZXQiICsgU3RyaW5nVXRpbHMuY2FwaXRh\nbGl6ZShmbWQuZ2V0TmFtZSgpKTsKICAgICAgICBpZiAoX21hbmFnZWRUeXBl\nLmdldE1ldGhvZHMobWV0aE5hbWUsIG5ldyBDbGFzc1swXSkubGVuZ3RoID09\nIDApCiAgICAgICAgICAgIG1ldGhOYW1lID0gImlzIiArIFN0cmluZ1V0aWxz\nLmNhcGl0YWxpemUoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgQkNNZXRob2Qg\nZ2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QobWV0aE5hbWUsIGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgc2V0\nVmlzaWJpbGl0eVRvU3VwZXJNZXRob2QoZ2V0dGVyKTsKICAgICAgICBnZXR0\nZXIubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IGdldHRlci5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiB3ZSdyZSBub3QgYWxyZWFk\neSB0cmFja2luZyBmaWVsZCBhY2Nlc3MgdmlhIHJlZmxlY3Rpb24sIHRoZW4g\nd2UKICAgICAgICAvLyBtdXN0IG1ha2UgdGhlIGdldHRlciBob29rIGluIGxh\nenkgbG9hZGluZyBiZWZvcmUgYWNjZXNzaW5nIHRoZSBzdXBlcgogICAgICAg\nIC8vIG1ldGhvZC4KICAgICAgICBpZiAoIWdldFJlZGVmaW5lKCkpCiAgICAg\nICAgICAgIGFkZE5vdGlmeUFjY2Vzcyhjb2RlLCBmbWQpOwoKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLCBtZXRo\nTmFtZSwKICAgICAgICAgICAgZm1kLmdldERlY2xhcmVkVHlwZSgpLCBudWxs\nKTsKICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIGEgc3RhdGljIGdldHRlciBtZXRob2QgZm9y\nIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqIFRoZSBnZW5lcmF0ZWQgbWV0aG9k\nIGludGVyYWN0cyB3aXRoIHRoZSBpbnN0YW5jZSBzdGF0ZSBhbmQgdGhlCiAg\nICAgKiBTdGF0ZU1hbmFnZXIgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgZmll\nbGQuCiAgICAgKgogICAgICogQHBhcmFtIGluZGV4IHRoZSByZWxhdGl2ZSBu\ndW1iZXIgb2YgdGhlIGZpZWxkCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFkYXRh\nIGFib3V0IHRoZSBmaWVsZCB0byBnZXQKICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZEdldE1ldGhvZChpbnQgaW5kZXgsIEZpZWxkTWV0YURhdGEgZm1k\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IGNyZWF0ZUdldE1ldGhvZChmbWQpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBpZiByZWFkcyBhcmUgbm90IGNoZWNrZWQsIGp1c3QgcmV0dXJu\nIHRoZSB2YWx1ZQogICAgICAgIGJ5dGUgZmllbGRGbGFnID0gZ2V0RmllbGRG\nbGFnKGZtZCk7CiAgICAgICAgaWYgKChmaWVsZEZsYWcgJiBQZXJzaXN0ZW5j\nZUNhcGFibGUuQ0hFQ0tfUkVBRCkgPT0gMAogICAgICAgICAgICAmJiAoZmll\nbGRGbGFnICYgUGVyc2lzdGVuY2VDYXBhYmxlLk1FRElBVEVfUkVBRCkgPT0g\nMCkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRy\ndWUsIGZtZCk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgZm1kKTsKICAgICAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlw\nZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFuYWdlciA9PSBudWxsKSBy\nZXR1cm4gaW5zdC48ZmllbGQ+OwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgdHJ1ZSwgZm1kKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9u\nIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAgICAgICAgYWRkR2V0TWFu\nYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIGNvZGUueHJldHVy\nbigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAgICAg\nLy8gaW50IGZpZWxkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGZpZWxk\naW5kZXg+OwogICAgICAgIGludCBmaWVsZExvY2FsID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpKTsKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAgICAg\nIGNvZGUuaWFkZCgpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwo\nZmllbGRMb2NhbCk7CgogICAgICAgIC8vIGluc3QucGNTdGF0ZU1hbmFnZXIu\nYWNjZXNzaW5nRmllbGQgKGZpZWxkKTsKICAgICAgICAvLyByZXR1cm4gaW5z\ndC48ZmllbGQ+OwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\ndHJ1ZSwgZm1kKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGZp\nZWxkTG9jYWwpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0\nTWV0aG9kKFNNVFlQRSwgImFjY2Vzc2luZ0ZpZWxkIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAgICAg\nICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAg\nIGNvZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgp\nKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIGEgc3RhdGljIHNldHRlciBtZXRob2QgZm9yIHRoZSBnaXZl\nbiBmaWVsZC4KICAgICAqIFRoZSBnZW5lcmF0ZWQgbWV0aG9kIGludGVyYWN0\ncyB3aXRoIHRoZSBpbnN0YW5jZSBzdGF0ZSBhbmQgdGhlCiAgICAgKiBTdGF0\nZU1hbmFnZXIgdG8gc2V0IHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQuCiAgICAg\nKgogICAgICogQHBhcmFtIGluZGV4IHRoZSByZWxhdGl2ZSBudW1iZXIgb2Yg\ndGhlIGZpZWxkCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFkYXRhIGFib3V0IHRo\nZSBmaWVsZCB0byBzZXQKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNl\ndE1ldGhvZChpbnQgaW5kZXgsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IGNyZWF0ZVNldE1ldGhvZChmbWQpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBQ\nQ0VuaGFuY2VyIHVzZXMgc3RhdGljIG1ldGhvZHM7IFBDU3ViY2xhc3NlciBk\nb2VzIG5vdC4KICAgICAgICBpbnQgZmlyc3RQYXJhbU9mZnNldCA9IGdldEFj\nY2Vzc29yUGFyYW1ldGVyT2Zmc2V0KGZtZCk7CgogICAgICAgIC8vIGlmIChp\nbnN0LnBjU3RhdGVNYW5hZ2VyID09IG51bGwpIGluc3QuPGZpZWxkPiA9IHZh\nbHVlOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSwg\nZm1kKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5p\nZm5vbm51bGwoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIHRydWUsIGZtZCk7CiAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZp\ncnN0UGFyYW1PZmZzZXQpOwogICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAg\nICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5zZXR0aW5nPGZpZWxkVHlwZT5G\naWVsZCAoaW5zdCwKICAgICAgICAvLyAgICAgcGNJbmhlcml0ZWRGaWVsZENv\ndW50ICsgPGluZGV4PiwgaW5zdC48ZmllbGQ+LCB2YWx1ZSwgMCk7CiAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\ndHJ1ZSwgZm1kKSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgdHJ1ZSwgZm1kKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGluZGV4KTsKICAgICAgICBjb2RlLmlhZGQoKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAg\nICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAg\nICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0KTsK\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5h\nZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCks\nICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsKICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0dGFjaCAvIGRldGFjaCBtZXRo\nb2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dGFj\naERldGFjaENvZGUoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIHNlZSBpZiBhbnkgc3VwZXJjbGFzc2VzIGFy\nZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxl\nID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIHBhcmVudCA9\nIF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAg\nIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKSkgewogICAgICAgICAgICBpZiAocGFyZW50LmlzRGV0\nYWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBwYXJlbnREZXRhY2hhYmxl\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwYXJlbnQgbm90IGRldGFjaGFi\nbGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRhY2ggc3RhdGUgZmllbGRzIGFu\nZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhvZHMKICAgICAgICBpZiAoX21l\ndGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJj\nbGFzcygpCiAgICAgICAgICAgIHx8IHBhcmVudERldGFjaGFibGUgIT0gX21l\ndGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgYWRkSXNEZXRhY2hl\nZE1ldGhvZCgpOwogICAgICAgICAgICBhZGREZXRhY2hlZFN0YXRlTWV0aG9k\ncyhfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpCiAgICAgICAgICAgICAgICAh\nPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHdl\nIGRldGFjaCBvbiBzZXJpYWxpemUsIHdlIGFsc28gbmVlZCB0byBpbXBsZW1l\nbnQgdGhlCiAgICAgICAgLy8gZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNlIHRv\nIHdyaXRlIGp1c3QgdGhlIHN0YXRlIGZvciB0aGUgZmllbGRzCiAgICAgICAg\nLy8gYmVpbmcgZGV0YWNoZWQKICAgICAgICBpZiAoZXh0ZXJuYWxpemVEZXRh\nY2hlZCgpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBh\nZGREZXRhY2hFeHRlcm5hbGl6ZShwYXJlbnREZXRhY2hhYmxlLAogICAgICAg\nICAgICAgICAgICAgIF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkgIT0gQm9v\nbGVhbi5GQUxTRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihuc21lKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZmllbGRzIHRvIGhv\nbGQgZGV0YWNoZWQgc3RhdGUgYW5kIHRoZWlyIGFjY2Vzc29yIG1ldGhvZHMu\nCiAgICAgKgogICAgICogQHBhcmFtIGltcGwgd2hldGhlciB0byBmdWxseSBp\nbXBsZW1lbnQgZGV0YWNoIHN0YXRlIGZ1bmN0aW9uYWxpdHkKICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaGVkU3RhdGVNZXRob2RzKGJvb2xl\nYW4gaW1wbCkgewogICAgICAgIEZpZWxkIGRldGFjaEZpZWxkID0gX21ldGEu\nZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCk7CiAgICAgICAgU3RyaW5nIG5hbWUg\nPSBudWxsOwogICAgICAgIFN0cmluZyBkZWNsYXJlciA9IG51bGw7CiAgICAg\nICAgaWYgKGltcGwgJiYgZGV0YWNoRmllbGQgPT0gbnVsbCkgewogICAgICAg\nICAgICBuYW1lID0gUFJFICsgIkRldGFjaGVkU3RhdGUiOwogICAgICAgICAg\nICBkZWNsYXJlciA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIEJDRmll\nbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKG5hbWUsIE9iamVjdC5jbGFz\ncyk7CiAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAg\nICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9IGVsc2Ug\naWYgKGltcGwpIHsKICAgICAgICAgICAgbmFtZSA9IGRldGFjaEZpZWxkLmdl\ndE5hbWUoKTsKICAgICAgICAgICAgZGVjbGFyZXIgPSBkZXRhY2hGaWVsZC5n\nZXREZWNsYXJpbmdDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHB1YmxpYyBPYmplY3QgcGNHZXREZXRhY2hlZFN0YXRlICgpCiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0aWMoZmFsc2UpOwog\nICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgaW50IGFjY2Vz\ncyA9IG1ldGhvZC5nZXRBY2Nlc3NGbGFncygpOwoKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1wbCkg\newogICAgICAgICAgICAvLyByZXR1cm4gcGNEZXRhY2hlZFN0YXRlOwogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLmdldFByb2pl\nY3QoKS5sb2FkQ2xhc3MoZGVjbGFyZXIpLAogICAgICAgICAgICAgICAgbmFt\nZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjU2V0\nRGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0YXRlKQogICAgICAgIG1ldGhvZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwK\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzIFtdeyBPYmplY3Qu\nY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLnNldEFjY2Vzc0ZsYWdzKGFjY2Vz\ncyk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHBjRGV0YWNoZWRTdGF0\nZSA9IHN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUu\nZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciksCiAgICAgICAgICAg\nICAgICBuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgIH0KICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4gdGhl\nIGluc3RydWN0aW9ucyB0byBnZXQgZmllbGQKICAgICAqIDxjb2RlPmF0dHJO\nYW1lPC9jb2RlPiBkZWNsYXJlZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVyPC9j\nb2RlPgogICAgICogb250byB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAgICAq\nCiAgICAgKiBUaGUgaW5zdGFuY2UgdG8gYWNjZXNzIG11c3QgYWxyZWFkeSBi\nZSBvbiB0aGUgdG9wIG9mIHRoZQogICAgICogc3RhY2sgd2hlbiB0aGlzIGlz\nIGludm9rZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRmaWVsZChD\nb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFtZSkg\newogICAgICAgIGlmIChkZWNsYXJlciA9PSBudWxsKQogICAgICAgICAgICBk\nZWNsYXJlciA9IF9tYW5hZ2VkVHlwZTsKCiAgICAgICAgLy8gZmlyc3QsIHNl\nZSBpZiB3ZSBjYW4gY29udmVydCB0aGUgYXR0cmlidXRlIG5hbWUgdG8gYSBm\naWVsZCBuYW1lCiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IHRvQmFja2lu\nZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAgICAgIC8vIG5leHQsIGZpbmQg\ndGhlIGZpZWxkIGluIHRoZSBtYW5hZ2VkIHR5cGUgaGllcmFyY2h5CiAgICAg\nICAgQkNGaWVsZCBmaWVsZCA9IG51bGw7CiAgICAgICAgb3V0ZXI6IGZvciAo\nQkNDbGFzcyBiYyA9IF9wYzsgYmMgIT0gbnVsbDsgYmMgPSBiYy5nZXRTdXBl\ncmNsYXNzQkMoKSkgewogICAgICAgICAgICBCQ0ZpZWxkW10gZmllbGRzID0g\nQWNjZXNzQ29udHJvbGxlcgogICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdl\nZChKMkRvUHJpdkhlbHBlci5nZXRCQ0NsYXNzRmllbGRzQWN0aW9uKGJjLAog\nICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZSkpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgZmllbGQgPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAg\nICAvLyBpZiB3ZSByZWFjaCBhIGZpZWxkIGRlY2xhcmVkIGluIHRoaXMgdHlw\nZSwgdGhlbiB0aGlzIGlzIHRoZQogICAgICAgICAgICAgICAgLy8gbW9zdC1t\nYXNraW5nIGZpZWxkLCBhbmQgaXMgdGhlIG9uZSB0aGF0IHdlIHdhbnQuCiAg\nICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmdldERlY2xhcmVyKCkgPT0g\nZGVjbGFyZXIpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkgJiYgY29kZS5nZXRNZXRo\nb2QoKS5nZXREZWNsYXJlcigpID09IF9wYwogICAgICAgICAgICAmJiAoZmll\nbGQgPT0gbnVsbCB8fCAhZmllbGQuaXNQdWJsaWMoKSkpIHsKICAgICAgICAg\nICAgLy8gd2UncmUgY3JlYXRpbmcgdGhlIHN1YmNsYXNzLCBub3QgcmVkZWZp\nbmluZyB0aGUgdXNlciB0eXBlLgoKICAgICAgICAgICAgLy8gUmVmbGVjdGlv\nbi5nZXRYWFgodGhpcywgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7CiAg\nICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGRlY2xh\ncmVyKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZp\nZWxkTmFtZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSh0cnVlKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICJmaW5k\nRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAg\nICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IF9tZXRhLmdldEZpZWxk\nKGF0dHJOYW1lKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kKAogICAgICAgICAgICAgICAgICAgIGdldFJlZmxlY3Rpb25HZXR0ZXJN\nZXRob2QodHlwZSwgRmllbGQuY2xhc3MpKTsKICAgICAgICAgICAgfSBjYXRj\naCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIC8vIHNob3VsZCBuZXZlciBoYXBwZW4KICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9i\namVjdC5jbGFzcykKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFtZSgpLCBm\naWVsZE5hbWUsCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRUeXBlKCkuZ2V0\nTmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHRvIDxjb2RlPmNvZGU8L2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMgdG8gc2V0\nIGZpZWxkCiAgICAgKiA8Y29kZT5hdHRyTmFtZTwvY29kZT4gZGVjbGFyZWQg\naW4gdHlwZSA8Y29kZT5kZWNsYXJlcjwvY29kZT4KICAgICAqIHRvIHRoZSB2\nYWx1ZSBvZiB0eXBlIDxjb2RlPmZpZWxkVHlwZTwvY29kZT4gb24gdGhlIHRv\ncCBvZiB0aGUgc3RhY2suCiAgICAgKgogICAgICogV2hlbiB0aGlzIG1ldGhv\nZCBpcyBpbnZva2VkLCB0aGUgdmFsdWUgdG8gbG9hZCBtdXN0CiAgICAgKiBh\nbHJlYWR5IGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGluIDxjb2RlPmNv\nZGU8L2NvZGU+LAogICAgICogYW5kIHRoZSBpbnN0YW5jZSB0byBsb2FkIGlu\ndG8gbXVzdCBiZSBzZWNvbmQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\ndXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBh\ndHRyTmFtZSwKICAgICAgICBDbGFzcyBmaWVsZFR5cGUpIHsKICAgICAgICBp\nZiAoZGVjbGFyZXIgPT0gbnVsbCkKICAgICAgICAgICAgZGVjbGFyZXIgPSBf\nbWFuYWdlZFR5cGU7CgogICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSB0b0Jh\nY2tpbmdGaWVsZE5hbWUoYXR0ck5hbWUpOwoKICAgICAgICBpZiAoZ2V0UmVk\nZWZpbmUoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nIC8vIFJlZmxlY3Rpb24uc2V0KHRoaXMsIFJlZmxlY3Rpb24uZmluZEZpZWxk\nKC4uLiksIHZhbHVlKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50\nKCkuc2V0Q2xhc3MoZGVjbGFyZXIpOwogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZmllbGROYW1lKTsKICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAg\nICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7CiAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNs\nYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLAogICAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZS5pc1ByaW1pdGl2ZSgp\nID8gZmllbGRUeXBlIDogT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAg\nICAgICBGaWVsZC5jbGFzcyB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBjb2RlLnB1dGZpZWxkKCkKICAgICAgICAgICAgICAgIC5zZXRGaWVs\nZChkZWNsYXJlci5nZXROYW1lKCksIGZpZWxkTmFtZSwgZmllbGRUeXBlLmdl\ndE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYg\ndXNpbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMgYSBkaWZm\nZXJlbnQgYmFja2luZyBmaWVsZAogICAgICogbmFtZSBmb3IgdGhlIHBlcnNp\nc3RlbnQgYXR0cmlidXRlIDxjb2RlPm5hbWU8L2NvZGU+LgogICAgICovCiAg\nICBwcml2YXRlIFN0cmluZyB0b0JhY2tpbmdGaWVsZE5hbWUoU3RyaW5nIG5h\nbWUpIHsKICAgICAgICAvLyBtZXRhIGlzIG51bGwgd2hlbiBlbmhhbmNpbmcg\ncGVyc2lzdGVuY2UtYXdhcmUgCiAgICAJRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YSA9PSBudWxsID8gbnVsbCA6IF9tZXRhLmdldEZpZWxkKG5hbWUpOwog\nICAgICAgIGlmIChfbWV0YSAhPSBudWxsICYmIGlzUHJvcGVydHlBY2Nlc3Mo\nZm1kKQogICAgICAgICAgICAmJiBfYXR0cnNUb0ZpZWxkcyAhPSBudWxsICYm\nIF9hdHRyc1RvRmllbGRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAg\nICBuYW1lID0gKFN0cmluZylfYXR0cnNUb0ZpZWxkcy5nZXQobmFtZSk7CiAg\nICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB1\nc2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBpcyBhIGRpZmZl\ncmVudCBwZXJzaXN0ZW50CiAgICAgKiBhdHRyaWJ1dGUgbmFtZSBmb3IgdGhl\nIGJhY2tpbmcgZmllbGQgPGNvZGU+bmFtZTwvY29kZT4uCiAgICAgKi8KICAg\nIHByaXZhdGUgU3RyaW5nIGZyb21CYWNraW5nRmllbGROYW1lKFN0cmluZyBu\nYW1lKSB7CiAgICAgICAgLy8gbWV0YSBpcyBudWxsIHdoZW4gZW5oYW5jaW5n\nIHBlcnNpc3RlbmNlLWF3YXJlIAogICAgCUZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEgPT0gbnVsbCA/IG51bGwgOiBfbWV0YS5nZXRGaWVsZChuYW1lKTsK\nICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCAmJiBpc1Byb3BlcnR5QWNjZXNz\nKGZtZCkKICAgICAgICAgICAgJiYgX2ZpZWxkc1RvQXR0cnMgIT0gbnVsbCAm\nJiBfZmllbGRzVG9BdHRycy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAg\nICAgcmV0dXJuIChTdHJpbmcpX2ZpZWxkc1RvQXR0cnMuZ2V0KG5hbWUpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIGV4dGVybmFsaXphYmxlIGlu\ndGVyZmFjZSB0byBkZXRhY2ggb24gc2VyaWFsaXplLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkRGV0YWNoRXh0ZXJuYWxpemUoYm9vbGVhbiBwYXJl\nbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBlbnN1cmUgdGhhdCB0aGUgZGVjbGFyZWQgZGVmYXVsdCBjb25zdHJ1\nY3RvciBpcyBwdWJsaWMgCiAgICAgICAgLy8gZm9yIGV4dGVybmFsaXphdGlv\nbgogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZ2V0RGVjbGFyZWRNZXRo\nb2QoIjxpbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7CiAgICAgICAgaWYgKCFt\nZXRoLmlzUHVibGljKCkpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJlbmhhbmNlLWRlZmNvbnMtZXh0ZXJuIiwgCiAgICAgICAgICAgICAgICAg\nIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpOwogICAgICAgICAgICBtZXRo\nLm1ha2VQdWJsaWMoKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVjbGFyZSBl\neHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UKICAgICAgICBpZiAoIUV4dGVybmFs\naXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKSkKICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2Uo\nRXh0ZXJuYWxpemFibGUuY2xhc3MpOwoKICAgICAgICAvLyBtYWtlIHN1cmUg\ndGhlIHVzZXIgZG9lc24ndCBhbHJlYWR5IGhhdmUgY3VzdG9tIGV4dGVybmFs\naXphdGlvbiBvcgogICAgICAgIC8vIHNlcmlhbGl6YXRpb24gbWV0aG9kcwog\nICAgICAgIENsYXNzW10gaW5wdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5w\ndXRTdHJlYW0uY2xhc3MgfTsKICAgICAgICBDbGFzc1tdIG91dHB1dCA9IG5l\ndyBDbGFzc1tdeyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfTsKICAgICAg\nICBpZiAoX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkT2Jq\nZWN0IiwgaW5wdXQpICE9IG51bGwKICAgICAgICAgICAgfHwgX21hbmFnZWRU\neXBlLmdldERlY2xhcmVkTWV0aG9kKCJ3cml0ZU9iamVjdCIsIG91dHB1dCkg\nIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImRldGFjaC1jdXN0b20tc2VyIiwgX21ldGEpKTsKICAgICAg\nICBpbnB1dFswXSA9IE9iamVjdElucHV0LmNsYXNzOwogICAgICAgIG91dHB1\ndFswXSA9IE9iamVjdE91dHB1dC5jbGFzczsKICAgICAgICBpZiAoX21hbmFn\nZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkRXh0ZXJuYWwiLCBpbnB1\ndCkgIT0gbnVsbAogICAgICAgICAgICB8fCBfbWFuYWdlZFR5cGUuZ2V0RGVj\nbGFyZWRNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCBvdXRwdXQpICE9IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJkZXRhY2gtY3VzdG9tLWV4dGVybiIsIF9tZXRhKSk7CgogICAgICAgIC8v\nIGNyZWF0ZSBsaXN0IG9mIGFsbCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZp\nZWxkcwogICAgICAgIEJDRmllbGRbXSBmaWVsZHMgPSBfbWFuYWdlZFR5cGUu\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBDb2xsZWN0aW9uIHVubWdk\nID0gbmV3IEFycmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoIWZpZWxkc1tpXS5pc1RyYW5zaWVudCgpICYmICFmaWVsZHNb\naV0uaXNTdGF0aWMoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5p\nc0ZpbmFsKCkKICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uZ2V0TmFt\nZSgpLnN0YXJ0c1dpdGgoUFJFKQogICAgICAgICAgICAgICAgJiYgX21ldGEu\nZ2V0RGVjbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdW5tZ2QuYWRkKGZpZWxkc1tpXSk7CiAgICAg\nICAgfQoKICAgICAgICBhZGRSZWFkRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJs\nZSwgZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkUmVhZFVubWFuYWdlZCh1\nbm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7CiAgICAgICAgYWRkV3JpdGVFeHRl\ncm5hbChwYXJlbnREZXRhY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAg\nICBhZGRXcml0ZVVubWFuYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgY3VzdG9tIHJlYWRFeHRlcm5h\nbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZWFkRXh0\nZXJuYWwoYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xl\nYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFz\nc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1l\ndGggPSBfcGMuZGVjbGFyZU1ldGhvZCgicmVhZEV4dGVybmFsIiwgdm9pZC5j\nbGFzcywgaW5hcmdzKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1l\ndGguZ2V0RXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhj\nZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBleGNlcHMuYWRk\nRXhjZXB0aW9uKENsYXNzTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gc3VwZXIucmVhZEV4dGVybmFsIChpbik7CiAgICAgICAgQ2xhc3Mgc3Vw\nID0gX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsK\nICAgICAgICBpZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFi\nbGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXAsICJyZWFkRXh0ZXJuYWwi\nLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgaW5hcmdzKTsKICAgICAg\nICB9CgogICAgICAgIC8vIHJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEpLAogICAgICAgICAgICBQ\nUkUgKyAiUmVhZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIGluYXJncyk7Cgog\nICAgICAgIGlmIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIHBj\nU2V0RGV0YWNoZWRTdGF0ZSAoaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNs\nYXNzLCAicmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoUFJFICsgIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9\nKTsKCiAgICAgICAgICAgIC8vIHBjUmVwbGFjZVN0YXRlTWFuYWdlciAoKFN0\nYXRlTWFuYWdlcikgaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAi\ncmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3Rh\ndGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFBSRSArICJSZXBsYWNlU3RhdGVNYW5hZ2VyIiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdGF0\nZU1hbmFnZXIuY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFk\nIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tp\nXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgcmVhZEV4dGVybmFs\nKGNvZGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAg\nIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlYWQgdW5tYW5hZ2VkIGZpZWxkcyBmcm9t\nIHRoZSBzdHJlYW0gKHBjUmVhZFVubWFuYWdlZCkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRSZWFkVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2Qs\nIGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9\nIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVhZFVu\nbWFuYWdlZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIGluYXJncyk7CiAg\nICAgICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9u\ncyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAg\nZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5kRXhjZXB0aW9u\nLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIHN1cGVyLnJlYWRVbm1hbmFnZWQgKGluKTsKICAg\nICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAg\nICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiUmVh\nZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAgICAgaW5h\ncmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgZGVjbGFyZWQgdW5t\nYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZp\nZWxkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAo\nQkNGaWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgcmVhZEV4dGVybmFs\nKGNvZGUsIGZpZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgpLCBudWxs\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIHJlYWQgYSBmaWVsZCBmcm9tIGFuIGV4dGVybmFsaXphdGlv\nbiBpbnB1dCBzdHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFk\nRXh0ZXJuYWwoQ29kZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0\neXBlLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRo\nTmFtZTsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAg\nICAgICAgIG1ldGhOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAg\nIG1ldGhOYW1lID0gbWV0aE5hbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJD\nYXNlKExvY2FsZS5FTkdMSVNIKQogICAgICAgICAgICAgICAgKyBtZXRoTmFt\nZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gInJlYWQi\nICsgbWV0aE5hbWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIG1ldGhO\nYW1lID0gInJlYWRPYmplY3QiOwoKICAgICAgICAvLyA8ZmllbGQ+ID0gaW4u\ncmVhZDx0eXBlPiAoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgQ2xhc3MgcmV0ID0gKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0\neXBlIDogT2JqZWN0LmNsYXNzOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCBtZXRoTmFtZSwK\nICAgICAgICAgICAgcmV0LCBudWxsKTsKICAgICAgICBpZiAoIXR5cGUuaXNQ\ncmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcHV0ZmllbGQoY29kZSwgbnVs\nbCwgZmllbGROYW1lLCB0eXBlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxF\nTkRBUjoKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAvLyAgIHNtLnByb3h5RGV0YWNoZWREZXNl\ncmlhbGl6ZWQgKDxpbmRleD4pOwogICAgICAgICAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmaW5zID0gY29kZS5p\nZm51bGwoKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChTTVRZUEUsCiAgICAgICAgICAgICAgICAgICAgICAgICJw\ncm94eURldGFjaGVkRGVzZXJpYWxpemVkIiwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsK\nICAgICAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3Ao\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgY3VzdG9tIHdyaXRlRXh0ZXJuYWwgbWV0aG9kLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkV3JpdGVFeHRlcm5hbChib29sZWFuIHBh\ncmVudERldGFjaGFibGUsCiAgICAgICAgYm9vbGVhbiBkZXRhY2hlZFN0YXRl\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIENsYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRw\ndXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xh\ncmVNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCB2b2lkLmNsYXNzLCBvdXRhcmdz\nKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0\naW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhj\nZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLndyaXRlRXh0ZXJuYWwgKG91\ndCk7CiAgICAgICAgQ2xhc3Mgc3VwID0gZ2V0VHlwZShfbWV0YSkuZ2V0U3Vw\nZXJjbGFzcygpOwogICAgICAgIGlmICghcGFyZW50RGV0YWNoYWJsZSAmJiBF\neHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cCkpIHsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cCwgIndy\naXRlRXh0ZXJuYWwiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgb3V0\nYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyB3cml0ZVVubWFuYWdlZCAo\nb3V0KTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEp\nLAogICAgICAgICAgICBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNs\nYXNzLCBvdXRhcmdzKTsKCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGdvMiA9\nIG51bGw7CiAgICAgICAgaWYgKGRldGFjaGVkU3RhdGUpIHsKICAgICAgICAg\nICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgIC8vICAgaWYgKHNt\nLndyaXRlRGV0YWNoZWQgKG91dCkpCiAgICAgICAgICAgIC8vICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmbnVsbCA9\nIGNvZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoU01UWVBFLCAid3JpdGVEZXRhY2hlZCIsCiAgICAg\nICAgICAgICAgICBib29sZWFuLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICAg\nICAgZ28yID0gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOwoKICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAvLyAgIG91\ndC53cml0ZU9iamVjdCAocGNHZXREZXRhY2hlZFN0YXRlICgpKTsKICAgICAg\nICAgICAgQ2xhc3NbXSBvYmphcmdzID0gbmV3IENsYXNzW117IE9iamVjdC5j\nbGFzcyB9OwogICAgICAgICAgICBpZm51bGwuc2V0VGFyZ2V0KGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAog\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0\ncHV0LmNsYXNzLAogICAgICAgICAgICAgICAgIndyaXRlT2JqZWN0Iiwgdm9p\nZC5jbGFzcywgb2JqYXJncyk7CiAgICAgICAgICAgIC8vICAgIG91dC53cml0\nZU9iamVjdCAobnVsbCkgLy8gU3RhdGVNYW5hZ2VyCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKChPYmplY3QpIG51bGwpOwogICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQu\nY2xhc3MsCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNs\nYXNzLCBvYmphcmdzKTsKICAgICAgICB9CiAgICAgICAgaWYgKGdvMiAhPSBu\ndWxsKQogICAgICAgICAgICBnbzIuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoK\nICAgICAgICAvLyB3cml0ZSBtYW5hZ2VkIGZpZWxkcwogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoIWZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAg\nICAgIHdyaXRlRXh0ZXJuYWwoY29kZSwgZm1kc1tpXS5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwg\nZm1kc1tpXSk7CgogICAgICAgIC8vIHJldHVybgogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogV3JpdGUgdW5tYW5hZ2VkIGZpZWxkcyB0byB0aGUgc3RyZWFt\nIChwY1dyaXRlVW5tYW5hZ2VkKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFdyaXRlVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2QsIGJvb2xlYW4g\ncGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIG91dGFyZ3MgPSBuZXcgQ2xh\nc3NbXXsgT2JqZWN0T3V0cHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRob2Qg\nbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJXcml0ZVVubWFuYWdl\nZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG91dGFyZ3MpOwogICAgICAg\nIG1ldGgubWFrZVByb3RlY3RlZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhj\nZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vw\ncy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3Vw\nZXIud3JpdGVVbm1hbmFnZWQgKG91dCk7CiAgICAgICAgaWYgKHBhcmVudERl\ndGFjaGFibGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpKSwgUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9p\nZC5jbGFzcywgCiAgICAgICAgICAgICAgICBvdXRhcmdzKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHdyaXRlIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJpYWxp\nemFibGUgZmllbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIHdyaXRlRXh0ZXJuYWwoY29kZSwgZmllbGQu\nZ2V0TmFtZSgpLCBmaWVsZC5nZXRUeXBlKCksIG51bGwpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gd3Jp\ndGUgYSBmaWVsZCB0byBhbiBleHRlcm5hbGl6YXRpb24gb3V0cHV0IHN0cmVh\nbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlRXh0ZXJuYWwoQ29k\nZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0eXBlLAogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRoTmFtZTsKICAgICAg\nICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAgICAgICAgIG1ldGhO\nYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAgIG1ldGhOYW1lID0g\nbWV0aE5hbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKExvY2FsZS5F\nTkdMSVNIKQogICAgICAgICAgICAgICAgKyBtZXRoTmFtZS5zdWJzdHJpbmco\nMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gIndyaXRlIiArIG1ldGhOYW1l\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJ3cml0\nZU9iamVjdCI7CgogICAgICAgIC8vIG91dC53cml0ZTx0eXBlPiAoPGZpZWxk\nPik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVs\nbCwgZmllbGROYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBDbGFzc1td\nIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgdHlwZSB9OwogICAgICAgIGlmICh0eXBl\nID09IGJ5dGUuY2xhc3MgfHwgdHlwZSA9PSBjaGFyLmNsYXNzIHx8IHR5cGUg\nPT0gc2hvcnQuY2xhc3MpCiAgICAgICAgICAgIGFyZ3NbMF0gPSBpbnQuY2xh\nc3M7CiAgICAgICAgZWxzZSBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSkKICAg\nICAgICAgICAgYXJnc1swXSA9IE9iamVjdC5jbGFzczsKICAgICAgICBjb2Rl\nLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xh\nc3MsIG1ldGhOYW1lLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBhcmdzKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZhbHVlQ29k\nZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kLCB0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIExvYWQgdGhlIGZpZWxkIHZhbHVlIHNwZWNpZmllZCBieSA8Y29k\nZT5mbWQ8L2NvZGU+IG9udG8gdGhlIHN0YWNrLgogICAgICogQmVmb3JlIHRo\naXMgbWV0aG9kIGlzIGNhbGxlZCwgdGhlIG9iamVjdCB0aGF0IHRoZSBkYXRh\nIHNob3VsZCBiZSBsb2FkZWQKICAgICAqIGZyb20gd2lsbCBiZSBvbiB0aGUg\ndG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVNh\nbWVDbGFzcyBpZiA8Y29kZT50cnVlPC9jb2RlPiwgdGhlbiA8Y29kZT5mbWQ8\nL2NvZGU+IGlzCiAgICAgKiBiZWluZyBsb2FkZWQgZnJvbSBhbiBpbnN0YW5j\nZSBvZiB0aGUgc2FtZSBjbGFzcyBhcyB0aGUgY3VycmVudCBleGVjdXRpb24K\nICAgICAqIGNvbnRleHQuIElmIDxjb2RlPmZhbHNlPC9jb2RlPiwgdGhlbiB0\naGUgaW5zdGFuY2Ugb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sKICAgICAqIG1p\nZ2h0IGJlIGEgc3VwZXJjbGFzcyBvZiB0aGUgY3VycmVudCBleGVjdXRpb24g\nY29udGV4dCdzICd0aGlzJyBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVs\nZE1ldGFEYXRhIGZtZCwKICAgICAgICBib29sZWFuIGZyb21TYW1lQ2xhc3Mp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gaWYgcmVkZWZpbmluZywgdGhlbiB3ZSBtdXN0IGFsd2F5cyByZWZs\nZWN0IChvciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAgICAgLy8gZGlyZWN0bHkg\naWYgYWNjZXNzaWJsZSksIHNpbmNlIHRoZSByZWRlZmluZWQgbWV0aG9kcyB3\naWxsIGFsd2F5cwogICAgICAgIC8vIHRyaWdnZXIgbWV0aG9kIGNhbGxzIHRv\nIFN0YXRlTWFuYWdlciwgZXZlbiBmcm9tIGludGVybmFsIGRpcmVjdC0KICAg\nICAgICAvLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxkIHdvcmsgYXJvdW5kIHRo\naXMgYnkgbm90IHJlZGVmaW5pbmcsIGFuZAogICAgICAgIC8vIGp1c3QgZG8g\nYSBzdWJjbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBCdXQgdGhpcyBpcyBub3Qg\nYSBnb29kIG9wdGlvbiwKICAgICAgICAvLyBzaW5jZSBpdCB3b3VsZCBzYWNy\naWZpY2UgbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2llbnQgZGlydHkgdHJhY2tp\nbmcuCgogICAgICAgIGlmIChnZXRSZWRlZmluZSgpIHx8IGlzRmllbGRBY2Nl\nc3MoZm1kKSkgewogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBudWxsLCBm\nbWQuZ2V0TmFtZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKGdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzLCBh\nbmQgd2UncmUgbm90IHJlZGVmaW5pbmcuIElmIHdlJ3JlIG9wZXJhdGluZwog\nICAgICAgICAgICAvLyBvbiBhbiBpbnN0YW5jZSB0aGF0IGlzIGRlZmluaXRl\nbHkgdGhlIHNhbWUgdHlwZSBhcyAndGhpcycsIHRoZW4KICAgICAgICAgICAg\nLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZCB0byBieXBhc3MgdHJhY2tpbmcu\nIE90aGVyd2lzZSwgcmVmbGVjdAogICAgICAgICAgICAvLyB0byBib3RoIGJ5\ncGFzcyB0cmFja2luZyBhbmQgYXZvaWQgY2xhc3MgdmVyaWZpY2F0aW9uIGVy\ncm9ycy4KICAgICAgICAgICAgaWYgKGZyb21TYW1lQ2xhc3MpIHsKICAgICAg\nICAgICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tp\nbmdNZW1iZXIoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChtZXRoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1l\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgLy8gcmVndWxhciBlbmhhbmNlbWVudCArIHByb3BlcnR5IGFjY2Vzcwog\nICAgICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNr\naW5nTWVtYmVyKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5\ncGVzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3Jl\nIHRoZSB2YWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjayBpbnRvIHRoZSBm\naWVsZCB2YWx1ZSBzcGVjaWZpZWQKICAgICAqIGJ5IDxjb2RlPmZtZDwvY29k\nZT4uIEJlZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBkYXRhIHRv\nIGxvYWQgd2lsbAogICAgICogYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sg\nYW5kIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9hZGVk\nCiAgICAgKiBpbnRvIHdpbGwgYmUgc2Vjb25kIGluIHRoZSBzdGFjay4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUo\nQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiByZWRlZmlu\naW5nLCB0aGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0\naGUgZmllbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwg\nc2luY2UgdGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlzCiAgICAg\nICAgLy8gdHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBl\ndmVuIGZyb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFjY2VzcyB1\nc2FnZS4gV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3QgcmVkZWZp\nbmluZywgYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNzIGFwcHJv\nYWNoIGluc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAog\nICAgICAgIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5IGxvYWRp\nbmcgYW5kIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAgICAgaWYg\nKGdldFJlZGVmaW5lKCkgfHwgaXNGaWVsZEFjY2VzcyhmbWQpKSB7CiAgICAg\nICAgICAgIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCksIGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIHByb3BlcnR5IGFj\nY2VzcywgYW5kIHdlJ3JlIG5vdCByZWRlZmluaW5nLiBpbnZva2UgdGhlCiAg\nICAgICAgICAgIC8vIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFj\na2luZy4KICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBn\nZXRTZXR0ZXJOYW1lKGZtZCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2Vt\nZW50ICsgcHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyBnZXRTZXR0ZXJOYW1lKGZtZCks\nCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgdGhlIHtAbGluayBJbnN0cnVjdGlvbn1zIHRvIGxv\nYWQgdGhlIGluc3RhbmNlIHRvIG1vZGlmeSBvbnRvIHRoZQogICAgICogc3Rh\nY2ssIGFuZCByZXR1cm4gaXQuIElmIDxjb2RlPmZvclN0YXRpYzwvY29kZT4g\naXMgc2V0LCB0aGVuCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiBpcyBpbiBh\nbiBhY2Nlc3NvciBtZXRob2Qgb3IgYW5vdGhlciBzdGF0aWMgbWV0aG9kOwog\nICAgICogb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2YgdGhlIFBDLXNwZWNp\nZmllZCBtZXRob2RzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpcnN0\nIGluc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+LgogICAg\nICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYywKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoZm9yU3RhdGljICYm\nIGlzRmllbGRBY2Nlc3MoZm1kKSkKICAgICAgICAgICAgcmV0dXJuIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICByZXR1cm4gY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUg\ne0BsaW5rIEluc3RydWN0aW9ufXMgdG8gbG9hZCB0aGUgaW5zdGFuY2UgdG8g\nbW9kaWZ5IG9udG8gdGhlCiAgICAgKiBzdGFjaywgYW5kIHJldHVybiBpdC4g\nIFRoaXMgbWV0aG9kIHNob3VsZCBub3QgYmUgdXNlZCB0byBsb2FkIHN0YXRp\nYwogICAgICogZmllbGRzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZp\ncnN0IGluc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+Lgog\nICAgICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYykgewogICAgCXJl\ndHVybiBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZvclN0YXRpYywgbnVs\nbCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IGdldEFjY2Vzc29yUGFy\nYW1ldGVyT2Zmc2V0KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICByZXR1\ncm4gaXNGaWVsZEFjY2VzcyhmbWQpID8gMSA6IDA7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZmZpcm1zIGlmIHRoZSBnaXZlbiBjbGFzcyBpcyB1c2luZyBm\naWVsZC1iYXNlZCBhY2Nlc3MuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNQcm9w\nZXJ0eUFjY2VzcyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgIAlyZXR1cm4g\nbWV0YSAhPSBudWxsICYmIChtZXRhLmlzTWl4ZWRBY2Nlc3MoKSB8fCAKICAg\nIAkJQWNjZXNzQ29kZS5pc1Byb3BlcnR5KG1ldGEuZ2V0QWNjZXNzVHlwZSgp\nKSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUg\nZ2l2ZW4gZmllbGQgaXMgdXNpbmcgZmllbGQtYmFzZWQgYWNjZXNzLgogICAg\nICovCiAgICBib29sZWFuIGlzUHJvcGVydHlBY2Nlc3MoRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgIAlyZXR1cm4gZm1kICE9IG51bGwgJiYgQWNjZXNzQ29k\nZS5pc1Byb3BlcnR5KGZtZC5nZXRBY2Nlc3NUeXBlKCkpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIGZpZWxkIGlz\nIHVzaW5nIG1ldGhvZC1iYXNlZCBhY2Nlc3MuCiAgICAgKi8KICAgIGJvb2xl\nYW4gaXNGaWVsZEFjY2VzcyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgCXJl\ndHVybiBmbWQgIT0gbnVsbCAmJiBBY2Nlc3NDb2RlLmlzRmllbGQoZm1kLmdl\ndEFjY2Vzc1R5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\ndGhlIGdlbmVyYXRlZCBnZXR0ZXIge0BsaW5rIEJDTWV0aG9kfSBmb3IgPGNv\nZGU+Zm1kPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxsaW5nIGVudmlyb25tZW50\nIHdpbGwgdGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhvZCdzIGNvZGUgYmxvY2su\nCiAgICAgKi8KICAgIHByaXZhdGUgQkNNZXRob2QgY3JlYXRlR2V0TWV0aG9k\nKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQkNNZXRob2QgZ2V0dGVy\nOwogICAgICAgIGlmIChpc0ZpZWxkQWNjZXNzKGZtZCkpIHsKICAgICAgICAg\nICAgLy8gc3RhdGljIDxmaWVsZHR5cGU+IHBjR2V0PGZpZWxkPiAoWFhYIGlu\nc3QpCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0RGVjbGFy\nZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZ2V0dGVyID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldCIgKyBmbWQuZ2V0TmFtZSgp\nLCBmbWQuCiAgICAgICAgICAgICAgICBnZXREZWNsYXJlZFR5cGUoKS5nZXRO\nYW1lKCksIG5ldyBTdHJpbmdbXXsgX3BjLmdldE5hbWUoKSB9KTsKICAgICAg\nICAgICAgZ2V0dGVyLnNldEFjY2Vzc0ZsYWdzKGZpZWxkLmdldEFjY2Vzc0Zs\nYWdzKCkKICAgICAgICAgICAgICAgICYgfkNvbnN0YW50cy5BQ0NFU1NfVFJB\nTlNJRU5UICYgfkNvbnN0YW50cy5BQ0NFU1NfVk9MQVRJTEUpOwogICAgICAg\nICAgICBnZXR0ZXIuc2V0U3RhdGljKHRydWUpOwogICAgICAgICAgICBnZXR0\nZXIuc2V0RmluYWwodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBnZXR0ZXI7\nCiAgICAgICAgfQoKICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3M6CiAgICAg\nICAgLy8gY29weSB0aGUgdXNlcidzIGdldHRlciBtZXRob2QgdG8gYSBuZXcg\nbmFtZTsgd2UgY2FuJ3QganVzdCByZXNldAogICAgICAgIC8vIHRoZSBuYW1l\nLCBiZWNhdXNlIHRoYXQgd2lsbCBhbHNvIHJlc2V0IGFsbCBjYWxscyB0byB0\naGUgbWV0aG9kCiAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQu\nZ2V0QmFja2luZ01lbWJlcigpOwogICAgICAgIGdldHRlciA9IF9wYy5nZXRE\nZWNsYXJlZE1ldGhvZChtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgbWV0\naC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBCQ01ldGhvZCBuZXdn\nZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUo\nKSwKICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0\nUGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgbmV3Z2V0dGVyLnNldEFjY2Vz\nc0ZsYWdzKGdldHRlci5nZXRBY2Nlc3NGbGFncygpKTsKICAgICAgICBuZXdn\nZXR0ZXIubWFrZVByb3RlY3RlZCgpOyAKICAgICAgICB0cmFuc2ZlckNvZGVB\ndHRyaWJ1dGVzKGdldHRlciwgbmV3Z2V0dGVyKTsKICAgICAgICByZXR1cm4g\nZ2V0dGVyOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBnZW5l\ncmF0ZWQgc2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9yIDxjb2RlPmZtZDwv\nY29kZT4uIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9ubWVudCB3aWxsIHRo\nZW4gcG9wdWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJsb2NrLgogICAgICov\nCiAgICBwcml2YXRlIEJDTWV0aG9kIGNyZWF0ZVNldE1ldGhvZChGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgIEJDTWV0aG9kIHNldHRlcjsKICAgICAg\nICBpZiAoaXNGaWVsZEFjY2VzcyhmbWQpKSB7CiAgICAgICAgICAgIC8vIHN0\nYXRpYyB2b2lkIHBjU2V0PGZpZWxkPiAoWFhYIGluc3QsIDxmaWVsZHR5cGU+\nIHZhbHVlKQogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERl\nY2xhcmVkRmllbGQoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHNldHRl\nciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXQiICsgZm1kLmdldE5h\nbWUoKSwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1td\neyBnZXRUeXBlKF9tZXRhKSwgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwog\nICAgICAgICAgICBzZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZmllbGQuZ2V0QWNj\nZXNzRmxhZ3MoKQogICAgICAgICAgICAgICAgJiB+Q29uc3RhbnRzLkFDQ0VT\nU19UUkFOU0lFTlQgJiB+Q29uc3RhbnRzLkFDQ0VTU19WT0xBVElMRSk7CiAg\nICAgICAgICAgIHNldHRlci5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAg\nIHNldHRlci5zZXRGaW5hbCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHNl\ndHRlcjsKICAgICAgICB9CgogICAgICAgIC8vIHByb3BlcnR5IGFjY2VzczoK\nICAgICAgICAvLyBjb3B5IHRoZSB1c2VyJ3MgZ2V0dGVyIG1ldGhvZCB0byBh\nIG5ldyBuYW1lOyB3ZSBjYW4ndCBqdXN0IHJlc2V0CiAgICAgICAgLy8gdGhl\nIG5hbWUsIGJlY2F1c2UgdGhhdCB3aWxsIGFsc28gcmVzZXQgYWxsIGNhbGxz\nIHRvIHRoZSBtZXRob2QKICAgICAgICBzZXR0ZXIgPSBfcGMuZ2V0RGVjbGFy\nZWRNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWQpLAogICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIEJD\nTWV0aG9kIG5ld3NldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArIHNl\ndHRlci5nZXROYW1lKCksCiAgICAgICAgICAgIHNldHRlci5nZXRSZXR1cm5O\nYW1lKCksIHNldHRlci5nZXRQYXJhbU5hbWVzKCkpOwogICAgICAgIG5ld3Nl\ndHRlci5zZXRBY2Nlc3NGbGFncyhzZXR0ZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7\nCiAgICAgICAgbmV3c2V0dGVyLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICB0\ncmFuc2ZlckNvZGVBdHRyaWJ1dGVzKHNldHRlciwgbmV3c2V0dGVyKTsKICAg\nICAgICByZXR1cm4gc2V0dGVyOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBh\nZGRHZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbk1ldGhvZCgpIHsKICAg\nICAgICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJz\naW9uKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyAKICAgICAgICAgICAgICAgICJHZXRFbmhhbmNlbWVudENv\nbnRyYWN0VmVyc2lvbiIsIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0\naG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoRU5IQU5DRVJfVkVSU0lPTik7CiAgICAgICAgY29kZS5pcmV0dXJuKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGNvbmNyZXRlIHR5cGUgZm9yIHRoZSBnaXZlbiBjbGFz\ncywgaS5lLiBpbXBsIGZvciBtYW5hZ2VkCiAgICAgKiBpbnRlcmZhY2VzCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmIChtZXRhLmdldEludGVyZmFjZUltcGwoKSAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCk7CiAgICAgICAgcmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogTW92ZSBjb2RlLXJlbGF0ZWQgYXR0\ncmlidXRlcyBmcm9tIG9uZSBtZXRob2QgdG8gYW5vdGhlci4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCB0cmFuc2ZlckNvZGVBdHRyaWJ1dGVz\nKEJDTWV0aG9kIGZyb20sIEJDTWV0aG9kIHRvKSB7CiAgICAgICAgQ29kZSBj\nb2RlID0gZnJvbS5nZXRDb2RlKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIHRvLmFkZEF0dHJpYnV0ZShjb2RlKTsK\nICAgICAgICAgICAgZnJvbS5yZW1vdmVDb2RlKCk7CiAgICAgICAgfQoKICAg\nICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IGZyb20uZ2V0RXhjZXB0aW9ucyhm\nYWxzZSk7CiAgICAgICAgaWYgKGV4Y2VwcyAhPSBudWxsKQogICAgICAgICAg\nICB0by5hZGRBdHRyaWJ1dGUoZXhjZXBzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFVzYWdlOiBqYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBD\nRW5oYW5jZXIgW29wdGlvbl0qCiAgICAgKiAmbHQ7Y2xhc3MgbmFtZSB8IC5q\nYXZhIGZpbGUgfCAuY2xhc3MgZmlsZSB8IC5qZG8gZmlsZSZndDsrCiAgICAg\nKiAgV2hlcmUgdGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSByZWNvZ25pemVk\nLgogICAgICogPHVsPgogICAgICogPGxpPjxpPi1wcm9wZXJ0aWVzLy1wICZs\ndDtwcm9wZXJ0aWVzIGZpbGUmZ3Q7PC9pPjogVGhlIHBhdGggdG8gYSBPcGVu\nSlBBCiAgICAgKiBwcm9wZXJ0aWVzIGZpbGUgY29udGFpbmluZyBpbmZvcm1h\ndGlvbiBhcyBvdXRsaW5lZCBpbgogICAgICoge0BsaW5rIENvbmZpZ3VyYXRp\nb259OyBvcHRpb25hbC48L2xpPgogICAgICogPGxpPjxpPi0mbHQ7cHJvcGVy\ndHkgbmFtZSZndDsgJmx0O3Byb3BlcnR5IHZhbHVlJmd0OzwvaT46IEFsbCBi\nZWFuCiAgICAgKiBwcm9wZXJ0aWVzIG9mIHRoZSBzdGFuZGFyZCBPcGVuSlBB\nIHtAbGluayBPcGVuSlBBQ29uZmlndXJhdGlvbn0gY2FuIGJlCiAgICAgKiBz\nZXQgYnkgdXNpbmcgdGhlaXIgbmFtZXMgYW5kIHN1cHBseWluZyBhIHZhbHVl\nOyBmb3IgZXhhbXBsZToKICAgICAqIDxsaT48aT4tZGlyZWN0b3J5Ly1kICZs\ndDtidWlsZCBkaXJlY3RvcnkmZ3Q7PC9pPjogVGhlIHBhdGggdG8gdGhlIGJh\nc2UKICAgICAqIGRpcmVjdG9yeSB3aGVyZSBlbmhhbmNlZCBjbGFzc2VzIGFy\nZSBzdG9yZWQuIEJ5IGRlZmF1bHQsIHRoZQogICAgICogZW5oYW5jZXIgb3Zl\ncndyaXRlcyB0aGUgb3JpZ2luYWwgLmNsYXNzIGZpbGUgd2l0aCB0aGUgZW5o\nYW5jZWQKICAgICAqIHZlcnNpb24uIFVzZSB0aGlzIG9wdGlvbiB0byBzdG9y\nZSB0aGUgZ2VuZXJhdGVkIC5jbGFzcyBmaWxlIGluCiAgICAgKiBhbm90aGVy\nIGRpcmVjdG9yeS4gVGhlIHBhY2thZ2Ugc3RydWN0dXJlIHdpbGwgYmUgY3Jl\nYXRlZCBiZW5lYXRoCiAgICAgKiB0aGUgZ2l2ZW4gZGlyZWN0b3J5LjwvbGk+\nCiAgICAgKiA8bGk+PGk+LWFkZERlZmF1bHRDb25zdHJ1Y3Rvci8tYWRjIFt0\ncnVlL3QgfCBmYWxzZS9mXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGFkZCBh\nIGRlZmF1bHQgY29uc3RydWN0b3IgdG8gcGVyc2lzdGVudCBjbGFzc2VzIG1p\nc3Npbmcgb25lLCBhcwogICAgICogb3Bwb3NlZCB0byB0aHJvd2luZyBhbiBl\neGNlcHRpb24uIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48\naT4tdG1wQ2xhc3NMb2FkZXIvLXRjbCBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+\nOiBXaGV0aGVyIHRvCiAgICAgKiBsb2FkIHRoZSBwcmUtZW5oYW5jZWQgY2xh\nc3NlcyB1c2luZyBhIHRlbXBvcmFyeSBjbGFzcyBsb2FkZXIuCiAgICAgKiBE\nZWZhdWx0cyB0byB0cnVlLiBTZXQgdGhpcyB0byBmYWxzZSB3aGVuIGF0dGVt\ncHRpbmcgdG8gZGVidWcKICAgICAqIGNsYXNzIGxvYWRpbmcgZXJyb3JzLjwv\nbGk+CiAgICAgKiA8bGk+PGk+LWVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9u\ncy8tZXByIFt0cnVlL3QgfCBmYWxzZS9mXTwvaT46CiAgICAgKiBXaGV0aGVy\nIHRvIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBhIFBST1BFUlRZIGFjY2VzcyBl\nbnRpdHkgYXBwZWFycwogICAgICogdG8gYmUgdmlvbGF0aW5nIHN0YW5kYXJk\nIHByb3BlcnR5IHJlc3RyaWN0aW9ucy4gRGVmYXVsdHMgdG8gZmFsc2UuPC9s\naT4KICAgICAqIDwvdWw+CiAgICAgKiAgRWFjaCBhZGRpdGlvbmFsIGFyZ3Vt\nZW50IGNhbiBiZSBlaXRoZXIgdGhlIGZ1bGwgY2xhc3MgbmFtZSBvZiB0aGUK\nICAgICAqIHR5cGUgdG8gZW5oYW5jZSwgdGhlIHBhdGggdG8gdGhlIC5qYXZh\nIGZpbGUgZm9yIHRoZSB0eXBlLCB0aGUgcGF0aCB0bwogICAgICogdGhlIC5j\nbGFzcyBmaWxlIGZvciB0aGUgdHlwZSwgb3IgdGhlIHBhdGggdG8gYSAuamRv\nIGZpbGUgbGlzdGluZyBvbmUKICAgICAqIG9yIG1vcmUgdHlwZXMgdG8gZW5o\nYW5jZS4KICAgICAqIElmIHRoZSB0eXBlIGJlaW5nIGVuaGFuY2VkIGhhcyBt\nZXRhZGF0YSwgaXQgd2lsbCBiZSBlbmhhbmNlZCBhcyBhCiAgICAgKiBwZXJz\naXN0ZW5jZSBjYXBhYmxlIGNsYXNzLiBJZiBub3QsIGl0IHdpbGwgYmUgY29u\nc2lkZXJlZCBhIHBlcnNpc3RlbmNlCiAgICAgKiBhd2FyZSBjbGFzcywgYW5k\nIGFsbCBhY2Nlc3MgdG8gZmllbGRzIG9mIHBlcnNpc3RlbmNlIGNhcGFibGUg\nY2xhc3NlcwogICAgICogd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgYXBwcm9w\ncmlhdGUJZ2V0L3NldCBtZXRob2QuIElmIHRoZSB0eXBlCiAgICAgKiBleHBs\naWNpdGx5IGRlY2xhcmVzIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGludGVy\nZmFjZSwgaXQgd2lsbAogICAgICogbm90IGJlIGVuaGFuY2VkLiBUaHVzLCBp\ndCBpcyBzYWZlIHRvIGludm9rZSB0aGUgZW5oYW5jZXIgb24gY2xhc3Nlcwog\nICAgICogdGhhdCBhcmUgYWxyZWFkeSBlbmhhbmNlZC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAg\nICAgIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgYXJn\ncyA9IG9wdHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CiAgICAgICAgaWYgKCFy\ndW4oYXJncywgb3B0cykpCiAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRs\nbihfbG9jLmdldCgiZW5oYW5jZS11c2FnZSIpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlk\nIG9wdGlvbnMgZ2l2ZW4uIFJ1bnMgYWdhaW5zdCBhbGwKICAgICAqIHRoZSBw\nZXJzaXN0ZW5jZSB1bml0cyBkZWZpbmVkIGluIHRoZSByZXNvdXJjZSB0byBw\nYXJzZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihm\naW5hbCBTdHJpbmdbXSBhcmdzLCBPcHRpb25zIG9wdHMpIHsKICAgICAgICBy\nZXR1cm4gQ29uZmlndXJhdGlvbnMucnVuQWdhaW5zdEFsbEFuY2hvcnMob3B0\ncywKICAgICAgICAgICAgbmV3IENvbmZpZ3VyYXRpb25zLlJ1bm5hYmxlKCkg\newogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW4oT3B0aW9ucyBvcHRz\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICAgICAgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBPcGVuSlBBQ29uZmlndXJhdGlv\nbkltcGwoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIFBDRW5oYW5jZXIucnVuKGNvbmYsIGFyZ3MsIG9wdHMp\nOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nICAgICBjb25mLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0\naGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlkIG9wdGlvbnMgZ2l2\nZW4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAg\nICBPcHRpb25zIG9wdHMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBGbGFncyBmbGFncyA9IG5ldyBGbGFncygpOwogICAgICAgIGZs\nYWdzLmRpcmVjdG9yeSA9IEZpbGVzLmdldEZpbGUob3B0cy5yZW1vdmVQcm9w\nZXJ0eSgiZGlyZWN0b3J5IiwgImQiLAogICAgICAgICAgICBudWxsKSwgbnVs\nbCk7CiAgICAgICAgZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9yID0gb3B0\ncy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJhZGREZWZh\ndWx0Q29uc3RydWN0b3IiLCAiYWRjIiwgZmxhZ3MuYWRkRGVmYXVsdENvbnN0\ncnVjdG9yKTsKICAgICAgICBmbGFncy50bXBDbGFzc0xvYWRlciA9IG9wdHMu\ncmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgidG1wQ2xhc3NM\nb2FkZXIiLCAidGNsIiwgZmxhZ3MudG1wQ2xhc3NMb2FkZXIpOwogICAgICAg\nIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IG9wdHMucmVt\nb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiZW5mb3JjZVByb3Bl\ncnR5UmVzdHJpY3Rpb25zIiwgImVwciIsCiAgICAgICAgICAgICAgICBmbGFn\ncy5lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMpOwoKICAgICAgICAvLyBm\nb3IgdW5pdCB0ZXN0aW5nCiAgICAgICAgQnl0ZWNvZGVXcml0ZXIgd3JpdGVy\nID0gKEJ5dGVjb2RlV3JpdGVyKSBvcHRzLmdldCgKICAgICAgICAgICAgUENF\nbmhhbmNlci5jbGFzcy5nZXROYW1lKCkgKyAiI2J5dGVjb2RlV3JpdGVyIik7\nCgogICAgICAgIENvbmZpZ3VyYXRpb25zLnBvcHVsYXRlQ29uZmlndXJhdGlv\nbihjb25mLCBvcHRzKTsKICAgICAgICByZXR1cm4gcnVuKGNvbmYsIGFyZ3Ms\nIGZsYWdzLCBudWxsLCB3cml0ZXIsIG51bGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogRW5oYW5jZSB0aGUgZ2l2ZW4gY2xhc3Nlcy4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihPcGVuSlBBQ29uZmlndXJhdGlv\nbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAgICAgIEZsYWdzIGZsYWdzLCBN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsIEJ5dGVjb2RlV3JpdGVyIHdyaXRl\nciwKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobG9hZGVyID09IG51bGwpCiAg\nICAgICAgICAgIGxvYWRlciA9IGNvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3Rh\nbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihQQ0VuaGFu\nY2VyLmNsYXNzLCBudWxsKTsKICAgICAgICBpZiAoZmxhZ3MudG1wQ2xhc3NM\nb2FkZXIpCiAgICAgICAgICAgIGxvYWRlciA9IEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAu\nbmV3VGVtcG9yYXJ5Q2xhc3NMb2FkZXJBY3Rpb24obG9hZGVyKSk7CgogICAg\nICAgIGlmIChyZXBvcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJlcG9zID0g\nY29uZi5uZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAg\nICAgICByZXBvcy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5N\nT0RFX01FVEEpOwogICAgICAgIH0KCiAgICAgICAgTG9nIGxvZyA9IGNvbmYu\nZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19UT09MKTsKICAgICAg\nICBDb2xsZWN0aW9uIGNsYXNzZXM7CiAgICAgICAgaWYgKGFyZ3MgPT0gbnVs\nbCB8fCBhcmdzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGxvZy5pbmZv\nKF9sb2MuZ2V0KCJydW5uaW5nLWFsbC1jbGFzc2VzIikpOwogICAgICAgICAg\nICBjbGFzc2VzID0gcmVwb3MuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyh0cnVl\nLCBsb2FkZXIpOwogICAgICAgICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIAlsb2cud2FybihfbG9jLmdldCgibm8tY2xhc3MtdG8t\nZW5oYW5jZSIpKTsKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENsYXNzQXJn\nUGFyc2VyIGNhcCA9IGNvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFu\nY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLm5l\nd0NsYXNzQXJnUGFyc2VyKCk7CiAgICAgICAgICAgIGNhcC5zZXRDbGFzc0xv\nYWRlcihsb2FkZXIpOwogICAgICAgICAgICBjbGFzc2VzID0gbmV3IEhhc2hT\nZXQoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChjYXAucGFyc2VUeXBlcyhhcmdzW2ldKSkpOwogICAgICAg\nIH0KCiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsK\nICAgICAgICBCQ0NsYXNzIGJjOwogICAgICAgIFBDRW5oYW5jZXIgZW5oYW5j\nZXI7CiAgICAgICAgaW50IHN0YXR1czsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGNsYXNzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgT2JqZWN0IG8gPSBpdHIubmV4dCgpOwogICAgICAgICAg\nICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtcnVubmluZyIsIG8pKTsKCiAg\nICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAg\nICAgICAgYmMgPSBwcm9qZWN0LmxvYWRDbGFzcygoU3RyaW5nKSBvLCBsb2Fk\nZXIpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBiYyA9IHBy\nb2plY3QubG9hZENsYXNzKChDbGFzcykgbyk7CiAgICAgICAgICAgIGVuaGFu\nY2VyID0gbmV3IFBDRW5oYW5jZXIoY29uZiwgYmMsIHJlcG9zLCBsb2FkZXIp\nOwogICAgICAgICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBlbmhhbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAg\nICAgICAgICBlbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5\nKTsKICAgICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVj\ndG9yKGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAg\nIHN0YXR1cyA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAoc3Rh\ndHVzID09IEVOSEFOQ0VfTk9ORSkgewogICAgICAgICAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShfbG9jLmdldCgiZW5oYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAg\nICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50\nZXJmYWNlIikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBF\nTkhBTkNFX0FXQVJFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJlbmhhbmNlLWF3YXJlIikpOwogICAgICAgICAgICAgICAgZW5o\nYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIHByb2plY3Qu\nY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBk\naXJlY3RvcnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERl\nZmF1bHRDb25zdHJ1Y3RvciA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xl\nYW4gdG1wQ2xhc3NMb2FkZXIgPSB0cnVlOwogICAgICAgIHB1YmxpYyBib29s\nZWFuIGVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IGZhbHNlOwogICAg\nfQoKICAgIC8qKgogICAgICogUGx1Z2luIGludGVyZmFjZSBmb3IgYWRkaXRp\nb25hbCBlbmhhbmNlbWVudC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBp\nbnRlcmZhY2UgQXV4aWxpYXJ5RW5oYW5jZXIKICAgIHsKICAgICAgICBwdWJs\naWMgdm9pZCBydW4gKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEgbWV0YSk7\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gc2tpcEVuaGFuY2UoQkNNZXRob2Qg\nbSk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBhZGRHZXRJRE93bmlu\nZ0NsYXNzKCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIkdldElET3duaW5nQ2xhc3MiLCAKICAgICAgICAgICAgQ2xhc3MuY2xhc3Ms\nIG51bGwpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwogICAgICAgIAogICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNl\ndENsYXNzKGdldFR5cGUoX21ldGEpKTsKICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICAKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KfQo=\n","encoding":"base64"}

