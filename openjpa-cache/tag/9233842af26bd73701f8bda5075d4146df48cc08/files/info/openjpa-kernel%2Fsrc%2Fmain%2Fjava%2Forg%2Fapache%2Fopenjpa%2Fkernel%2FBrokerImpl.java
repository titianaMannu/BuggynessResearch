{"sha":"40ef4a00b155cc43d4cae1df841af12d92124d5b","node_id":"MDQ6QmxvYjIwNjM2NDo0MGVmNGEwMGIxNTVjYzQzZDRjYWUxZGY4NDFhZjEyZDkyMTI0ZDVi","size":167755,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/40ef4a00b155cc43d4cae1df841af12d92124d5b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07Cmlt\ncG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3ND\nb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0Q29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5sb2Nrcy5SZWVudHJhbnRMb2NrOwoKaW1w\nb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN0YXR1czsKaW1wb3J0IGphdmF4LnRy\nYW5zYWN0aW9uLlN5bmNocm9uaXphdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMuY29sbGVjdGlvbnMuaXRlcmF0b3JzLkl0ZXJhdG9yQ2hhaW47\nCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLklk\nZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLm1hcC5MaW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nY29sbGVjdGlvbnMuc2V0Lk1hcEJhY2tlZFNldDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmVlLk1hbmFnZWRSdW50aW1lOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2Fw\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZmxl\nY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5\nY2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlm\nZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmV2ZW50LlJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlvbkV2ZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5zYWN0aW9uRXZlbnRNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4\ncHJlc3Npb25QYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLlJlZmVyZW5jZUhhc2hNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNldDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VNYXA7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJh\ndGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGlj\nYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DYWxs\nYmFja0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5H\nZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuTm9UcmFuc2FjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdEV4aXN0c0V4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVu\nSlBBRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nT3B0aW1pc3RpY0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5XcmFwcGVkRXhjZXB0\naW9uOwoKLyoqCiAqIENvbmNyZXRlIHtAbGluayBCcm9rZXJ9LiBUaGUgYnJv\na2VyIGhhbmRsZXMgb2JqZWN0LWxldmVsIGJlaGF2aW9yLAogKiBidXQgbGVh\ndmVzIGFsbCBpbnRlcmFjdGlvbiB3aXRoIHRoZSBkYXRhIHN0b3JlIHRvIGEg\ne0BsaW5rIFN0b3JlTWFuYWdlcn0KICogdGhhdCBtdXN0IGJlIHN1cHBsaWVk\nIGF0IGluaXRpYWxpemF0aW9uLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQog\nKi8KQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIpCnB1YmxpYyBjbGFzcyBC\ncm9rZXJJbXBsCiAgICBpbXBsZW1lbnRzIEJyb2tlciwgRmluZENhbGxiYWNr\ncywgQ2xvbmVhYmxlLCBTZXJpYWxpemFibGUgewoKICAgIC8qKgogICAgICog\nSW5jcmVtZW50YWwgZmx1c2guCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0\naWMgZmluYWwgaW50IEZMVVNIX0lOQyA9IDA7CgogICAgLyoqCiAgICAgKiBG\nbHVzaCBpbiBwcmVwYXJhdGlvbiBvZiBjb21taXQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZMVVNIX0NPTU1JVCA9IDE7Cgog\nICAgLyoqCiAgICAgKiBGbHVzaCB0byBjaGVjayBjb25zaXN0ZW5jeSBvZiBj\nYWNoZSwgdGhlbiBpbW1lZGlhdGVseSByb2xsYmFjayBjaGFuZ2VzLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9ST0xM\nQkFDSyA9IDI7CgogICAgLyoqCiAgICAgKiBSdW4gcGVyc2lzdGVuY2UtYnkt\ncmVhY2hhYmlsaXR5IGFuZCBvdGhlciBmbHVzaC10aW1lIG9wZXJhdGlvbnMg\nd2l0aG91dAogICAgICogYWNjZXNzaW5nIHRoZSBkYXRhYmFzZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfTE9HSUNB\nTCA9IDM7CgogICAgc3RhdGljIGZpbmFsIGludCBTVEFUVVNfSU5JVCA9IDA7\nCiAgICBzdGF0aWMgZmluYWwgaW50IFNUQVRVU19UUkFOU0lFTlQgPSAxOwog\nICAgc3RhdGljIGZpbmFsIGludCBTVEFUVVNfT0lEX0FTU0lHTiA9IDI7CiAg\nICBzdGF0aWMgZmluYWwgaW50IFNUQVRVU19DT01NSVRfTkVXID0gMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19BQ1RJVkUgPSAyIDw8\nIDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9B\nQ1RJVkUgPSAyIDw8IDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQg\nRkxBR19DTE9TRV9JTlZPS0VEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEZMQUdfUFJFU1RPUklORyA9IDIgPDwgMzsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RFUkVGREVMRVRJTkcgPSAy\nIDw8IDQ7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVT\nSElORyA9IDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1NUT1JFX0ZMVVNISU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEZMQUdfRkxVU0hFRCA9IDIgPDwgNzsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVNT1RF\nX0xJU1RFTkVSID0gMiA8PCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEZMQUdfUkVUQUlORURfQ09OTiA9IDIgPDwgMTA7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDEx\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdFtdIEVNUFRZX09C\nSkVDVFMgPSBuZXcgT2JqZWN0WzBdOwoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIExvY2FsaXplciBfbG9jID0KICAgICAgICBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShCcm9rZXJJbXBsLmNsYXNzKTsKCiAgICAvLwl0aGUgc3RvcmUgbWFu\nYWdlciBpbiB1c2U7IHRoaXMgbWF5IGJlIGEgZGVjb3JhdG9yIHN1Y2ggYXMg\nYQogICAgLy8JZGF0YSBjYWNoZSBzdG9yZSBtYW5hZ2VyIGFyb3VuZCB0aGUg\nbmF0aXZlIHN0b3JlIG1hbmFnZXIKICAgIHByaXZhdGUgdHJhbnNpZW50IERl\nbGVnYXRpbmdTdG9yZU1hbmFnZXIgX3N0b3JlID0gbnVsbDsKCiAgICBwcml2\nYXRlIEZldGNoQ29uZmlndXJhdGlvbiBfZmMgPSBudWxsOwogICAgcHJpdmF0\nZSBTdHJpbmcgX3VzZXIgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3Bh\nc3MgPSBudWxsOwoKICAgIC8vIHRoZXNlIG11c3QgYmUgcmVidWlsdCBieSB0\naGUgZmFjYWRlIGxheWVyIGR1cmluZyBpdHMgZGVzZXJpYWxpemF0aW9uCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBMb2cgX2xvZyA9IG51bGw7CiAgICBwcml2\nYXRlIHRyYW5zaWVudCBDb21wYXRpYmlsaXR5IF9jb21wYXQgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgTWFuYWdlZFJ1bnRpbWUgX3J1bnRpbWUg\nPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9ja01hbmFnZXIgX2xt\nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IEludmVyc2VNYW5hZ2Vy\nIF9pbSA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBSZWVudHJhbnRM\nb2NrIF9sb2NrID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IE9wQ2Fs\nbGJhY2tzIF9jYWxsID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFJ1\nbnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yIF9leHRyYW5zID0gbnVsbDsKCiAg\nICAvLyByZWYgdG8gcHJvZHVjaW5nIGZhY3RvcnkgYW5kIGNvbmZpZ3VyYXRp\nb24KICAgIHByaXZhdGUgdHJhbnNpZW50IEFic3RyYWN0QnJva2VyRmFjdG9y\neSBfZmFjdG9yeSA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7CgogICAgLy8gY2FjaGUg\nY2xhc3MgbG9hZGVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgYnJva2VyCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsK\nCiAgICAvLyB1c2VyIHN0YXRlCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlv\nbiBfc3luYyA9IG51bGw7CiAgICBwcml2YXRlIE1hcCBfdXNlck9iamVjdHMg\nPSBudWxsOwoKICAgIC8vIG1hbmFnZWQgb2JqZWN0IGNhY2hlcwogICAgcHJp\ndmF0ZSBNYW5hZ2VkQ2FjaGUgX2NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUg\nVHJhbnNhY3Rpb25hbENhY2hlIF90cmFuc0NhY2hlID0gbnVsbDsKICAgIHBy\naXZhdGUgU2V0IF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldCBfZGVyZWZDYWNoZSA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVy\nZWZBZGRpdGlvbnMgPSBudWxsOwoKICAgIC8vIHRoZXNlIGFyZSB1c2VkIGZv\nciBtZXRob2QtaW50ZXJuYWwgc3RhdGUgb25seQogICAgcHJpdmF0ZSB0cmFu\nc2llbnQgTWFwIF9sb2FkaW5nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNp\nZW50IFNldCBfb3BlcmF0aW5nID0gbnVsbDsKCiAgICBwcml2YXRlIFNldCBf\ncGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfdXBkYXRl\nZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX2RlbGV0ZWRDbHNzID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9wZW5kaW5nID0gbnVsbDsKICAgIHBy\naXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7CgogICAgLy8gdHJhY2sgaW5z\ndGFuY2VzIHRoYXQgYmVjb21lIHRyYW5zYWN0aW9uYWwgYWZ0ZXIgdGhlIGZp\ncnN0IHNhdmVwb2ludAogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRoZSB0cmFu\nc2FjdGlvbmFsIGNhY2hlKQogICAgcHJpdmF0ZSBTZXQgX3NhdmVwb2ludENh\nY2hlID0gbnVsbDsKICAgIHByaXZhdGUgTGlua2VkTWFwIF9zYXZlcG9pbnRz\nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFNhdmVwb2ludE1hbmFn\nZXIgX3NwbSA9IG51bGw7CgogICAgLy8gdHJhY2sgb3BlbiBxdWVyaWVzIGFu\nZCBleHRlbnRzIHNvIHdlIGNhbiBmcmVlIHRoZWlyIHJlc291cmNlcyBvbiBj\nbG9zZQogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVmZXJlbmNlSGFzaFNldCBf\ncXVlcmllcyA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBSZWZlcmVu\nY2VIYXNoU2V0IF9leHRlbnRzID0gbnVsbDsKCiAgICAvLyB0cmFjayBvcGVy\nYXRpb24gc3RhY2sgZGVwdGguIFRyYW5zaWVudCBiZWNhdXNlIG9wZXJhdGlv\nbnMgY2Fubm90CiAgICAvLyBzcGFuIHNlcmlhbGl6YXRpb24uCiAgICBwcml2\nYXRlIHRyYW5zaWVudCBpbnQgX29wZXJhdGlvbkNvdW50ID0gMDsKCiAgICAv\nLyBvcHRpb25zCiAgICBwcml2YXRlIGJvb2xlYW4gX25vbnRyYW5zUmVhZCA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9ub250cmFuc1dyaXRlID0g\nZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3JldGFpblN0YXRlID0gZmFs\nc2U7CiAgICBwcml2YXRlIGludCBfYXV0b0NsZWFyID0gQ0xFQVJfREFUQVNU\nT1JFOwogICAgcHJpdmF0ZSBpbnQgX3Jlc3RvcmVTdGF0ZSA9IFJFU1RPUkVf\nSU1NVVRBQkxFOwogICAgcHJpdmF0ZSBib29sZWFuIF9vcHRpbWlzdGljID0g\nZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2lnbm9yZUNoYW5nZXMgPSBm\nYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbXVsdGl0aHJlYWRlZCA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9tYW5hZ2VkID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX3N5bmNNYW5hZ2VkID0gZmFsc2U7CiAgICBw\ncml2YXRlIGludCBfY29ublJldGFpbk1vZGUgPSBDT05OX1JFVEFJTl9ERU1B\nTkQ7CiAgICBwcml2YXRlIGJvb2xlYW4gX2V2aWN0RGF0YUNhY2hlID0gZmFs\nc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3BvcHVsYXRlRGF0YUNhY2hlID0g\ndHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbGFyZ2VUcmFuc2FjdGlvbiA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX2F1dG9EZXRhY2ggPSAwOwogICAg\ncHJpdmF0ZSBpbnQgX2RldGFjaFN0YXRlID0gREVUQUNIX0xPQURFRDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfZGV0YWNoZWROZXcgPSB0cnVlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9vcmRlckRpcnR5ID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2NhY2hlUHJlcGFyZWRRdWVyeSA9IHRydWU7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX2NhY2hlRmluZGVyUXVlcnkgPSB0cnVlOwogICAgCiAg\nICBwcml2YXRlIERhdGFDYWNoZVN0b3JlTW9kZSBfY2FjaGVTdG9yZU1vZGU7\nIAogICAgcHJpdmF0ZSBEYXRhQ2FjaGVSZXRyaWV2ZU1vZGUgX2NhY2hlUmV0\ncmlldmVNb2RlOwogICAgCiAgICAvLyBTdG9yZSBhbmQgUmV0cmlldmUgbW9k\nZSBtYXkgYmUgc3VzcGVuZGVkIGZvciBhIGdpdmVuIG9wZXJhdGlvbi4gU3Rh\nY2sgbWF5IGJlIG92ZXJraWxsIGhlcmUuCiAgICBwcml2YXRlIFN0YWNrPERh\ndGFDYWNoZVN0b3JlTW9kZT4gX2NhY2hlU3RvcmVNb2RlU3RhY2sgPSBuZXcg\nU3RhY2s8RGF0YUNhY2hlU3RvcmVNb2RlPigpOwogICAgcHJpdmF0ZSBTdGFj\nazxEYXRhQ2FjaGVSZXRyaWV2ZU1vZGU+IF9jYWNoZVJldHJpZXZlTW9kZVN0\nYWNrID0gbmV3IFN0YWNrPERhdGFDYWNoZVJldHJpZXZlTW9kZT4oKTsKCiAg\nICAvLyBNYXAgb2YgcHJvcGVydGllcyB3aG9zZSB2YWx1ZXMgaGF2ZSBiZWVu\nIGNoYW5nZWQKLy8gICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBTdHJpbmc+IF9j\naGFuZ2VkUHJvcGVydGllcyA9Ci8vICAgICAgICBuZXcgSGFzaE1hcDxTdHJp\nbmcsIFN0cmluZz4oKTsKCiAgICAvLyBzdGF0dXMKICAgIHByaXZhdGUgaW50\nIF9mbGFncyA9IDA7CgogICAgLy8gdGhpcyBpcyBub3QgaW4gc3RhdHVzIGJl\nY2F1c2UgaXQgc2hvdWxkIG5vdCBiZSBzZXJpYWxpemVkCiAgICBwcml2YXRl\nIHRyYW5zaWVudCBib29sZWFuIF9pc1NlcmlhbGl6aW5nID0gZmFsc2U7Cgog\nICAgLy8gdHJhbnNpZW50IGJlY2F1c2UgY2xvc2VkIGJyb2tlcnMgY2FuJ3Qg\nYmUgc2VyaWFsaXplZAogICAgcHJpdmF0ZSB0cmFuc2llbnQgYm9vbGVhbiBf\nY2xvc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIHRyYW5zaWVudCBSdW50aW1l\nRXhjZXB0aW9uIF9jbG9zZWRFeGNlcHRpb24gPSBudWxsOwoKICAgIC8vIGV2\nZW50IG1hbmFnZXJzCiAgICBwcml2YXRlIFRyYW5zYWN0aW9uRXZlbnRNYW5h\nZ2VyIF90cmFuc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGlu\ndCBfdHJhbnNDYWxsYmFja01vZGUgPSAwOwogICAgcHJpdmF0ZSBMaWZlY3lj\nbGVFdmVudE1hbmFnZXIgX2xpZmVFdmVudE1hbmFnZXIgPSBudWxsOwogICAg\ncHJpdmF0ZSBpbnQgX2xpZmVDYWxsYmFja01vZGUgPSAwOwoKICAgIHByaXZh\ndGUgdHJhbnNpZW50IGJvb2xlYW4gX2luaXRpYWxpemVXYXNJbnZva2VkID0g\nZmFsc2U7CiAgICBwcml2YXRlIExpbmtlZExpc3QgX2ZjczsKICAgIAogICAg\nLy8gU2V0IG9mIHN1cHBvcnRlZCBwcm9wZXJ0eSBrZXlzLiBUaGUga2V5cyBp\nbiB0aGlzIHNldCBjb3JyZXNwb25kIHRvIGJlYW4tc3R5bGUgc2V0dGVyIG1l\ndGhvZHMKICAgIC8vIHRoYXQgY2FuIGJlIHNldCBieSByZWZsZWN0aW9uLiBU\naGUga2V5cyBhcmUgbm90IHF1YWxpZmllZCBieSBhbnkgcHJlZml4LgogICAg\ncHJpdmF0ZSBzdGF0aWMgU2V0PFN0cmluZz4gX3N1cHBvcnRlZFByb3BlcnR5\nTmFtZXM7CiAgICBzdGF0aWMgewogICAgICAgIF9zdXBwb3J0ZWRQcm9wZXJ0\neU5hbWVzID0gbmV3IEhhc2hTZXQ8U3RyaW5nPigpOwogICAgICAgIF9zdXBw\nb3J0ZWRQcm9wZXJ0eU5hbWVzLmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBT\ndHJpbmdbXSB7CiAgICAgICAgICAgICAgICAiQXV0b0NsZWFyIiwgCiAgICAg\nICAgICAgICAgICAiQXV0b0RldGFjaCIsIAogICAgICAgICAgICAgICAgIkNh\nY2hlRmluZGVyUXVlcnkiLCAKICAgICAgICAgICAgICAgICJDYWNoZVByZXBh\ncmVkUXVlcnkiLCAKICAgICAgICAgICAgICAgICJEZXRhY2hlZE5ldyIsIAog\nICAgICAgICAgICAgICAgIkRldGFjaFN0YXRlIiwgCiAgICAgICAgICAgICAg\nICAiRXZpY3RGcm9tRGF0YUNhY2hlIiwgCiAgICAgICAgICAgICAgICAiSWdu\nb3JlQ2hhbmdlcyIsIAogICAgICAgICAgICAgICAgIkxpZmVjeWNsZUxpc3Rl\nbmVyQ2FsbGJhY2tNb2RlIiwgCiAgICAgICAgICAgICAgICAiTXVsdGl0aHJl\nYWRlZCIsIAogICAgICAgICAgICAgICAgIk5vbnRyYW5zYWN0aW9uYWxSZWFk\nIiwgCiAgICAgICAgICAgICAgICAiTm9udHJhbnNhY3Rpb25hbFdyaXRlIiwg\nCiAgICAgICAgICAgICAgICAiT3B0aW1pc3RpYyIsIAogICAgICAgICAgICAg\nICAgIlBvcHVsYXRlRGF0YUNhY2hlIiwKICAgICAgICAgICAgICAgICJSZXN0\nb3JlU3RhdGUiLCAKICAgICAgICAgICAgICAgICJSZXRhaW5TdGF0ZSIsCiAg\nICAgICAgICAgICAgICB9KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIncyBhdXRoZW50aWNhdGlvbi4gVGhp\ncyBpcyB0aGUgZmlyc3QKICAgICAqIG1ldGhvZCBjYWxsZWQgYWZ0ZXIgY29u\nc3RydWN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB1c2VyIHRoZSB1c2Vy\nbmFtZSB0aGlzIGJyb2tlciByZXByZXNlbnRzOyB1c2VkIHdoZW4gcG9vbGlu\nZwogICAgICogYnJva2VycyB0byBtYWtlIHN1cmUgdGhhdCBhIHJlcXVlc3Qg\ndG8gdGhlIGZhY3RvcnkgZm9yCiAgICAgKiBhIGNvbm5lY3Rpb24gd2l0aCBh\nbiBleHBsaWNpdCB1c2VyIGlzIGRlbGVnYXRlZCB0byBhIHN1aXRhYmxlIGJy\nb2tlcgogICAgICogQHBhcmFtIHBhc3MgdGhlIHBhc3N3b3JkIGZvciB0aGUg\nYWJvdmUgdXNlcgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRoZW50\naWNhdGlvbihTdHJpbmcgdXNlciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICBf\ndXNlciA9IHVzZXI7CiAgICAgICAgX3Bhc3MgPSBwYXNzOwogICAgfQoKICAg\nIC8qKgogICAgICogSW5pdGlhbGl6ZSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdl\nci4gVGhpcyBtZXRob2QgaXMgY2FsbGVkCiAgICAgKiBhdXRvbWF0aWNhbGx5\nIGJ5IHRoZSBmYWN0b3J5IGJlZm9yZSB1c2UuCiAgICAgKgogICAgICogQHBh\ncmFtIGZhY3RvcnkgdGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgdGhpcyBi\ncm9rZXIKICAgICAqIEBwYXJhbSBzbSBhIGNvbmNyZXRlIFN0b3JlTWFuYWdl\nciBpbXBsZW1lbnRhdGlvbiB0bwogICAgICogaGFuZGxlIGludGVyYWN0aW9u\nIHdpdGggdGhlIGRhdGEgc3RvcmUKICAgICAqIEBwYXJhbSBtYW5hZ2VkIHRo\nZSB0cmFuc2FjdGlvbiBtb2RlCiAgICAgKiBAcGFyYW0gY29ubk1vZGUgdGhl\nIGNvbm5lY3Rpb24gcmV0YWluIG1vZGUKICAgICAqIEBwYXJhbSBmcm9tRGVz\nZXJpYWxpemF0aW9uIHdoZXRoZXIgdGhpcyBjYWxsIGhhcHBlbmVkIGJlY2F1\nc2Ugb2YgYQogICAgICogZGVzZXJpYWxpemF0aW9uIG9yIGNyZWF0aW9uIG9m\nIGEgbmV3IEJyb2tlckltcGwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGlu\naXRpYWxpemUoQWJzdHJhY3RCcm9rZXJGYWN0b3J5IGZhY3RvcnksCiAgICAg\nICAgRGVsZWdhdGluZ1N0b3JlTWFuYWdlciBzbSwgYm9vbGVhbiBtYW5hZ2Vk\nLCBpbnQgY29ubk1vZGUsCiAgICAgICAgYm9vbGVhbiBmcm9tRGVzZXJpYWxp\nemF0aW9uKSB7CiAgICAgICAgX2luaXRpYWxpemVXYXNJbnZva2VkID0gdHJ1\nZTsKICAgICAgICBfbG9hZGVyID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENvbnRleHRD\nbGFzc0xvYWRlckFjdGlvbigpKTsKICAgICAgICBpZiAoIWZyb21EZXNlcmlh\nbGl6YXRpb24pCiAgICAgICAgICAgIF9jb25mID0gZmFjdG9yeS5nZXRDb25m\naWd1cmF0aW9uKCk7CiAgICAgICAgX2NvbXBhdCA9IF9jb25mLmdldENvbXBh\ndGliaWxpdHlJbnN0YW5jZSgpOwogICAgICAgIF9mYWN0b3J5ID0gZmFjdG9y\neTsKICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1\ncmF0aW9uLkxPR19SVU5USU1FKTsKICAgICAgICBpZiAoIWZyb21EZXNlcmlh\nbGl6YXRpb24pCiAgICAgICAgICAgIF9jYWNoZSA9IG5ldyBNYW5hZ2VkQ2Fj\naGUodGhpcyk7CiAgICAgICAgaW5pdGlhbGl6ZU9wZXJhdGluZ1NldCgpOwog\nICAgICAgIF9jb25uUmV0YWluTW9kZSA9IGNvbm5Nb2RlOwogICAgICAgIF9t\nYW5hZ2VkID0gbWFuYWdlZDsKICAgICAgICBpZiAobWFuYWdlZCkKICAgICAg\nICAgICAgX3J1bnRpbWUgPSBfY29uZi5nZXRNYW5hZ2VkUnVudGltZUluc3Rh\nbmNlKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfcnVudGltZSA9IG5l\ndyBMb2NhbE1hbmFnZWRSdW50aW1lKHRoaXMpOwoKICAgICAgICBpZiAoIWZy\nb21EZXNlcmlhbGl6YXRpb24pIHsKICAgICAgICAgICAgX2xpZmVFdmVudE1h\nbmFnZXIgPSBfY29uZi5nZXRMaWZlY3ljbGVFdmVudE1hbmFnZXJJbnN0YW5j\nZSgpOwogICAgICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIgPSBuZXcgVHJh\nbnNhY3Rpb25FdmVudE1hbmFnZXIoKTsKICAgICAgICAgICAgaW50IGNtb2Rl\nID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAg\nICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRz\nKCkuZ2V0Q2FsbGJhY2tNb2RlKCk7CiAgICAgICAgICAgIHNldExpZmVjeWNs\nZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNtb2RlKTsKICAgICAgICAgICAgc2V0\nVHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNrTW9kZShjbW9kZSk7CgogICAg\nICAgICAgICAvLyBzZXR1cCBkZWZhdWx0IG9wdGlvbnMKICAgICAgICAgICAg\nX2ZhY3RvcnkuY29uZmlndXJlQnJva2VyKHRoaXMpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gbWFrZSBzdXJlIHRvIGRvIHRoaXMgYWZ0ZXIgY29uZmlndXJp\nbmcgYnJva2VyIHNvIHRoYXQgc3RvcmUgbWFuYWdlcgogICAgICAgIC8vIGNh\nbiBsb29rIHRvIGJyb2tlciBjb25maWd1cmF0aW9uOyB3ZSBzZXQgYm90aCBz\ndG9yZSBhbmQgbG9jayBtYW5hZ2VycwogICAgICAgIC8vIGJlZm9yZSBpbml0\naWFsaXppbmcgdGhlbSBiZWNhdXNlIHRoZXkgbWF5IGVhY2ggdHJ5IHRvIGFj\nY2VzcyB0aGUKICAgICAgICAvLyBvdGhlciBpbiB0aGVpciBpbml0aWFsaXph\ndGlvbgogICAgICAgIF9zdG9yZSA9IHNtOwogICAgICAgIF9sbSA9IF9jb25m\nLm5ld0xvY2tNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfaW0gPSBfY29u\nZi5uZXdJbnZlcnNlTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX3NwbSA9\nIF9jb25mLmdldFNhdmVwb2ludE1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAg\nIF9zdG9yZS5zZXRDb250ZXh0KHRoaXMpOwogICAgICAgIF9sbS5zZXRDb250\nZXh0KHRoaXMpOwoKICAgICAgICBpZiAoX2Nvbm5SZXRhaW5Nb2RlID09IENP\nTk5fUkVUQUlOX0FMV0FZUykKICAgICAgICAgICAgcmV0YWluQ29ubmVjdGlv\nbigpOwogICAgICAgIGlmICghZnJvbURlc2VyaWFsaXphdGlvbikgewogICAg\nICAgICAgICBfZmMgPSBfc3RvcmUubmV3RmV0Y2hDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgICAgIF9mYy5zZXRDb250ZXh0KHRoaXMpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gc3luY2ggd2l0aCB0aGUgZ2xvYmFsIHRyYW5zYWN0aW9u\nIGluIHByb2dyZXNzLCBpZiBhbnkKICAgICAgICBpZiAoX2ZhY3Rvcnkuc3lu\nY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24odGhpcywgZmFsc2UpKQogICAgICAg\nICAgICBiZWdpbkludGVybmFsKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGluaXRpYWxpemVPcGVyYXRpbmdTZXQoKSB7CiAgICAgICAgX29wZXJhdGlu\nZyA9IE1hcEJhY2tlZFNldC5kZWNvcmF0ZShuZXcgSWRlbnRpdHlNYXAoKSk7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0aGUgdW5tb2RpZmlh\nYmxlIHNldCBvZiBpbnN0YW5jZXMgYmVpbmcgb3BlcmF0ZWQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTZXQgZ2V0T3BlcmF0aW5nU2V0KCkgewogICAgCXJl\ndHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVTZXQoX29wZXJhdGluZyk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBjbG9uZSgpCiAgICAgICAgdGhy\nb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nX2luaXRpYWxpemVXYXNJbnZva2VkKQogICAgICAgICAgICB0aHJvdyBuZXcg\nQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEge0BsaW5rIE1hcH0gdG8g\nYmUgdXNlZCBmb3IgdGhlIHByaW1hcnkgbWFuYWdlZCBvYmplY3QgY2FjaGUu\nCiAgICAgKiBNYXBzIG9pZHMgdG8gc3RhdGUgbWFuYWdlcnMuIEJ5IGRlZmF1\nbHQsIHRoaXMgY3JlYXRlcyBhCiAgICAgKiB7QGxpbmsgUmVmZXJlbmNlTWFw\nfSB3aXRoIHNvZnQgdmFsdWVzLgogICAgICovCiAgICBwcm90ZWN0ZWQgTWFw\nIG5ld01hbmFnZWRPYmplY3RDYWNoZSgpIHsKICAgICAgICByZXR1cm4gbmV3\nIFJlZmVyZW5jZUhhc2hNYXAoUmVmZXJlbmNlTWFwLkhBUkQsIFJlZmVyZW5j\nZU1hcC5TT0ZUKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBTdG9yZUNv\nbnRleHQKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwdWJsaWMgQnJva2VyIGdldEJyb2tlcigpIHsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLwogICAgLy8gUHJv\ncGVydGllcwogICAgLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBz\nZXRJbXBsaWNpdEJlaGF2aW9yKE9wQ2FsbGJhY2tzIGNhbGwsCiAgICAgICAg\nUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgZXgpIHsKICAgICAgICBpZiAo\nX2NhbGwgPT0gbnVsbCkKICAgICAgICAgICAgX2NhbGwgPSBjYWxsOwogICAg\nICAgIGlmIChfZXh0cmFucyA9PSBudWxsKQogICAgICAgICAgICBfZXh0cmFu\ncyA9IGV4OwogICAgfQoKICAgIFJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9y\nIGdldEluc3RhbmNlRXhjZXB0aW9uVHJhbnNsYXRvcigpIHsKICAgICAgICBy\nZXR1cm4gKF9vcGVyYXRpb25Db3VudCA9PSAwKSA/IF9leHRyYW5zIDogbnVs\nbDsKICAgIH0KCiAgICBwdWJsaWMgQnJva2VyRmFjdG9yeSBnZXRCcm9rZXJG\nYWN0b3J5KCkgewogICAgICAgIHJldHVybiBfZmFjdG9yeTsKICAgIH0KCiAg\nICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlv\nbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgcHVibGlj\nIEZldGNoQ29uZmlndXJhdGlvbiBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKSB7\nCiAgICAgICAgcmV0dXJuIF9mYzsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hD\nb25maWd1cmF0aW9uIHB1c2hGZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAgICAg\nICAgaWYgKF9mY3MgPT0gbnVsbCkKICAgICAgICAgICAgX2ZjcyA9IG5ldyBM\naW5rZWRMaXN0KCk7CiAgICAgICAgX2Zjcy5hZGQoX2ZjKTsKICAgICAgICBf\nZmMgPSAoRmV0Y2hDb25maWd1cmF0aW9uKSBfZmMuY2xvbmUoKTsKICAgICAg\nICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBvcEZldGNo\nQ29uZmlndXJhdGlvbigpIHsKICAgICAgICBpZiAoX2ZjcyA9PSBudWxsIHx8\nIF9mY3MuaXNFbXB0eSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbigKICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiZmV0Y2gt\nY29uZmlndXJhdGlvbi1zdGFjay1lbXB0eSIpKTsKICAgICAgICBfZmMgPSAo\nRmV0Y2hDb25maWd1cmF0aW9uKSBfZmNzLnJlbW92ZUxhc3QoKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGdldENvbm5lY3Rpb25SZXRhaW5Nb2RlKCkgewog\nICAgICAgIHJldHVybiBfY29ublJldGFpbk1vZGU7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNNYW5hZ2VkKCkgewogICAgICAgIHJldHVybiBfbWFu\nYWdlZDsKICAgIH0KCiAgICBwdWJsaWMgTWFuYWdlZFJ1bnRpbWUgZ2V0TWFu\nYWdlZFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIF9ydW50aW1lOwogICAg\nfQoKICAgIHB1YmxpYyBDbGFzc0xvYWRlciBnZXRDbGFzc0xvYWRlcigpIHsK\nICAgICAgICByZXR1cm4gX2xvYWRlcjsKICAgIH0KCiAgICBwdWJsaWMgRGVs\nZWdhdGluZ1N0b3JlTWFuYWdlciBnZXRTdG9yZU1hbmFnZXIoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdG9yZTsKICAgIH0KCiAgICBwdWJsaWMgTG9ja01hbmFn\nZXIgZ2V0TG9ja01hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sbTsKICAg\nIH0KCiAgICBwdWJsaWMgSW52ZXJzZU1hbmFnZXIgZ2V0SW52ZXJzZU1hbmFn\nZXIoKSB7CiAgICAgICAgcmV0dXJuIF9pbTsKICAgIH0KCiAgICBwdWJsaWMg\nU3RyaW5nIGdldENvbm5lY3Rpb25Vc2VyTmFtZSgpIHsKICAgICAgICByZXR1\ncm4gX3VzZXI7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0\naW9uUGFzc3dvcmQoKSB7CiAgICAgICAgcmV0dXJuIF9wYXNzOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGdldE11bHRpdGhyZWFkZWQoKSB7CiAgICAg\nICAgcmV0dXJuIF9tdWx0aXRocmVhZGVkOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldE11bHRpdGhyZWFkZWQoYm9vbGVhbiBtdWx0aXRocmVhZGVkKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9tdWx0aXRocmVhZGVk\nID0gbXVsdGl0aHJlYWRlZDsKICAgICAgICBpZiAobXVsdGl0aHJlYWRlZCAm\nJiBfbG9jayA9PSBudWxsKQogICAgICAgICAgICBfbG9jayA9IG5ldyBSZWVu\ndHJhbnRMb2NrKCk7CiAgICAgICAgZWxzZSBpZiAoIW11bHRpdGhyZWFkZWQp\nCiAgICAgICAgICAgIF9sb2NrID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRJZ25vcmVDaGFuZ2VzKCkgewogICAgICAgIHJldHVybiBf\naWdub3JlQ2hhbmdlczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25v\ncmVDaGFuZ2VzKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIF9pZ25vcmVDaGFuZ2VzID0gdmFsOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGdldE5vbnRyYW5zYWN0aW9uYWxSZWFkKCkgewogICAg\nICAgIHJldHVybiBfbm9udHJhbnNSZWFkOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldE5vbnRyYW5zYWN0aW9uYWxSZWFkKGJvb2xlYW4gdmFsKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19QUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIp\nKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRz\nIGl0CiAgICAgICAgaWYgKHZhbCAmJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9u\ncygpLmNvbnRhaW5zCiAgICAgICAgICAgIChfY29uZi5PUFRJT05fTk9OVFJB\nTlNfUkVBRCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJub250cmFucy1y\nZWFkLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgIF9ub250cmFuc1JlYWQg\nPSB2YWw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJhbnNh\nY3Rpb25hbFdyaXRlKCkgewogICAgICAgIHJldHVybiBfbm9udHJhbnNXcml0\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFs\nV3JpdGUoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJp\nbGxlZ2FsLW9wLWluLXByZXN0b3JlIikpOwoKICAgICAgICBfbm9udHJhbnNX\ncml0ZSA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcHRp\nbWlzdGljKCkgewogICAgICAgIHJldHVybiBfb3B0aW1pc3RpYzsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRPcHRpbWlzdGljKGJvb2xlYW4gdmFsKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2ZSIsCiAg\nICAgICAgICAgICAgICAiT3B0aW1pc3RpYyIpKTsKCiAgICAgICAgLy8gbWFr\nZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0CiAgICAgICAgaWYgKHZh\nbCAmJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25m\nLk9QVElPTl9PUFRJTUlTVElDKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAo\nIm9wdGltaXN0aWMtbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAgX29wdGlt\naXN0aWMgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRSZXN0b3Jl\nU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXN0b3JlU3RhdGU7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0UmVzdG9yZVN0YXRlKGludCB2YWwpIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidHJhbnMtYWN0aXZlIiwKICAg\nICAgICAgICAgICAgICJSZXN0b3JlIikpOwoKICAgICAgICBfcmVzdG9yZVN0\nYXRlID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFJldGFp\nblN0YXRlKCkgewogICAgICAgIHJldHVybiBfcmV0YWluU3RhdGU7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0UmV0YWluU3RhdGUoYm9vbGVhbiB2YWwp\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbGxlZ2FsLW9wLWluLXByZXN0\nb3JlIikpOwogICAgICAgIF9yZXRhaW5TdGF0ZSA9IHZhbDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldEF1dG9DbGVhcigpIHsKICAgICAgICByZXR1cm4g\nX2F1dG9DbGVhcjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQ2xl\nYXIoaW50IHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBf\nYXV0b0NsZWFyID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0QXV0\nb0RldGFjaCgpIHsKICAgICAgICByZXR1cm4gX2F1dG9EZXRhY2g7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFjaChpbnQgZGV0YWNoRmxh\nZ3MpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2F1dG9EZXRh\nY2ggPSBkZXRhY2hGbGFnczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRB\ndXRvRGV0YWNoKGludCBkZXRhY2hGbGFnLCBib29sZWFuIG9uKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChvbikKICAgICAgICAgICAg\nX2F1dG9EZXRhY2ggfD0gZGV0YWNoRmxhZzsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9hdXRvRGV0YWNoICY9IH5kZXRhY2hGbGFnOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0RGV0YWNoU3RhdGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9kZXRhY2hTdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREZXRh\nY2hTdGF0ZShpbnQgbW9kZSkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBfZGV0YWNoU3RhdGUgPSBtb2RlOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRGV0YWNoZWROZXcoKSB7CiAgICAgICAgcmV0dXJuIF9kZXRh\nY2hlZE5ldzsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hlZE5l\ndyhib29sZWFuIGlzTmV3KSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIF9kZXRhY2hlZE5ldyA9IGlzTmV3OwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldFN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9ucygpIHsKICAg\nICAgICByZXR1cm4gX3N5bmNNYW5hZ2VkOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9ucyhib29sZWFuIHN5\nbmMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX3N5bmNNYW5h\nZ2VkID0gc3luYzsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRFdmlj\ndEZyb21EYXRhQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9ldmljdERhdGFD\nYWNoZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFdmljdEZyb21EYXRh\nQ2FjaGUoYm9vbGVhbiBldmljdCkgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBfZXZpY3REYXRhQ2FjaGUgPSBldmljdDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXRQb3B1bGF0ZURhdGFDYWNoZSgpIHsKICAgICAg\nICByZXR1cm4gX3BvcHVsYXRlRGF0YUNhY2hlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFBvcHVsYXRlRGF0YUNhY2hlKGJvb2xlYW4gY2FjaGUpIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX3BvcHVsYXRlRGF0YUNh\nY2hlID0gY2FjaGU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFj\na0NoYW5nZXNCeVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9sYXJnZVRyYW5z\nYWN0aW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFRyYWNrQ2hhbmdl\nc0J5VHlwZShib29sZWFuIGxhcmdlVHJhbnNhY3Rpb24pIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgX2xhcmdlVHJhbnNhY3Rpb24gPSBsYXJn\nZVRyYW5zYWN0aW9uOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VXNl\nck9iamVjdChPYmplY3Qga2V5KSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoX3Vz\nZXJPYmplY3RzID09IG51bGwpID8gbnVsbCA6IF91c2VyT2JqZWN0cy5nZXQo\na2V5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBw\ndXRVc2VyT2JqZWN0KE9iamVjdCBrZXksIE9iamVjdCB2YWwpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIChfdXNlck9iamVjdHMgPT0gbnVsbCkgPyBudWxsIDogX3VzZXJPYmplY3Rz\nLnJlbW92ZShrZXkpOwoKICAgICAgICAgICAgaWYgKF91c2VyT2JqZWN0cyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX3VzZXJPYmplY3RzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICAgICAgcmV0dXJuIF91c2VyT2JqZWN0cy5wdXQo\na2V5LCB2YWwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEdldCBjdXJyZW50IGNvbmZpZ3VyYXRpb24gcHJvcGVydHkgdmFsdWVzIHVz\nZWQgYnkgdGhpcyBpbnN0YW5jZS4KICAgICAqIFRoaXMgdmFsdWVzIGFyZSBj\nb21iaW5hdGlvbiBvZiB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uIHZhbHVl\ncyAKICAgICAqIG92ZXJ3cml0dGVuIGJ5IHZhbHVlcyBtYWludGFpbmVkIGJ5\nIHRoaXMgaW5zdGFuY2Ugc3VjaCBhcwogICAgICogT3B0aW1pc3RpYyBmbGFn\nLiAKICAgICAqLwogICAgcHVibGljIE1hcDxTdHJpbmcsIE9iamVjdD4gZ2V0\nUHJvcGVydGllcygpIHsKICAgICAgICBNYXAgcHJvcHMgPSBfY29uZi50b1By\nb3BlcnRpZXModHJ1ZSk7CiAgICAgICAgZm9yIChTdHJpbmcgcyA6IF9zdXBw\nb3J0ZWRQcm9wZXJ0eU5hbWVzKSB7CiAgICAgICAgICAgIHByb3BzLnB1dCgi\nb3BlbmpwYS4iICsgcywgUmVmbGVjdGlvbi5nZXRWYWx1ZSh0aGlzLCBzLCB0\ncnVlKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcm9wczsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBwcm9wZXJ0eSBuYW1lcyB0\naGF0IGNhbiBiZSB1c2VkIHRvIGNvcnJlc3BvbmRpbmcgc2V0dGVyIG1ldGhv\nZHMgb2YgdGhpcyByZWNlaXZlcgogICAgICogdG8gc2V0IGl0cyB2YWx1ZS4K\nICAgICAqLyAgICAKICAgIHB1YmxpYyBTZXQ8U3RyaW5nPiBnZXRTdXBwb3J0\nZWRQcm9wZXJ0aWVzKCkgewogICAgICAgIFNldDxTdHJpbmc+IGtleXMgPSBf\nY29uZi5nZXRQcm9wZXJ0eUtleXMoKTsKICAgICAgICBmb3IgKFN0cmluZyBz\nIDogX3N1cHBvcnRlZFByb3BlcnR5TmFtZXMpCiAgICAgICAgICAgIGtleXMu\nYWRkKCJvcGVuanBhLiIgKyBzKTsKICAgICAgICByZXR1cm4ga2V5czsKICAg\nIH0KCiAgICAvLyAvLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLyAvLy8v\nLy8vLwoKICAgIHB1YmxpYyB2b2lkIGFkZExpZmVjeWNsZUxpc3RlbmVyKE9i\namVjdCBsaXN0ZW5lciwgQ2xhc3NbXSBjbGFzc2VzKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIF9saWZlRXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKGxpc3RlbmVyLCBjbGFz\nc2VzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVt\nb3ZlTGlmZWN5Y2xlTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKGxpc3Rl\nbmVyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBnZXRM\naWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZSgpIHsKICAgICAgICByZXR1\ncm4gX2xpZmVDYWxsYmFja01vZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgX2xpZmVDYWxsYmFja01vZGUgPSBtb2RlOwogICAgICAg\nICAgICBfbGlmZUV2ZW50TWFuYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENB\nTExCQUNLX0ZBSUxfRkFTVCkgIT0gMCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2l2ZSBzdGF0ZSBtYW5hZ2VycyBhY2Nlc3MgdG8g\ndGhlIGxpZmVjeWNsZSBldmVudCBtYW5hZ2VyLgogICAgICovCiAgICBwdWJs\naWMgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyIGdldExpZmVjeWNsZUV2ZW50TWFu\nYWdlcigpIHsKICAgICAgICByZXR1cm4gX2xpZmVFdmVudE1hbmFnZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGaXJlIGdpdmVuIGxpZmVjeWNsZSBldmVu\ndCwgaGFuZGxpbmcgYW55IGV4Y2VwdGlvbnMgYXBwcm9wcmlhdGVseS4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHdoZXRoZXIgZXZlbnRzIGFyZSBiZWluZyBw\ncm9jZXNzZWQgYXQgdGhpcyB0aW1lCiAgICAgKi8KICAgIGJvb2xlYW4gZmly\nZUxpZmVjeWNsZUV2ZW50KE9iamVjdCBzcmMsIE9iamVjdCByZWxhdGVkLCBD\nbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgaW50IGV2ZW50VHlwZSkgewog\nICAgICAgIGlmIChfbGlmZUV2ZW50TWFuYWdlciA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGxvY2soKTsKICAgICAgICBF\neGNlcHRpb25bXSBleHM7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZXhz\nID0gX2xpZmVFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHNyYywgcmVsYXRlZCwg\nbWV0YSwgZXZlbnRUeXBlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9IAogICAgICAgIGhhbmRsZUNhbGxi\nYWNrRXhjZXB0aW9ucyhleHMsIF9saWZlQ2FsbGJhY2tNb2RlKTsKICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRha2UgYWN0\naW9ucyBvbiBjYWxsYmFjayBleGNlcHRpb25zIGRlcGVuZGluZyBvbiBjYWxs\nYmFjayBtb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgaGFuZGxlQ2Fs\nbGJhY2tFeGNlcHRpb25zKEV4Y2VwdGlvbltdIGV4Y2VwcywgaW50IG1vZGUp\nIHsKICAgICAgICBpZiAoZXhjZXBzLmxlbmd0aCA9PSAwIHx8IChtb2RlICYg\nQ0FMTEJBQ0tfSUdOT1JFKSAhPSAwKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIE9wZW5KUEFFeGNlcHRpb24gY2U7CiAgICAgICAgaWYgKGV4Y2Vw\ncy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAvLyBJZiB0aGUgZXhjZXB0\naW9uIGlzIGFscmVhZHkgYSB3cmFwcGVkIGV4Y2VwdGlvbiB0aHJvdyB0aGUg\nCiAgICAgICAgICAgIC8vIGV4Y2VwdGlvbiBpbnN0ZWFkIG9mIHdyYXBwaW5n\nIGl0IHdpdGggYSBjYWxsYmFjayBleGNlcHRpb24KICAgICAgICAgICAgaWYg\nKGV4Y2Vwc1swXSBpbnN0YW5jZW9mIFdyYXBwZWRFeGNlcHRpb24pCiAgICAg\nICAgICAgICAgICB0aHJvdyAoV3JhcHBlZEV4Y2VwdGlvbilleGNlcHNbMF07\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNlID0gbmV3IENh\nbGxiYWNrRXhjZXB0aW9uKGV4Y2Vwc1swXSk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgY2UgPSBuZXcgQ2FsbGJhY2tFeGNlcHRpb24oX2xvYy5n\nZXQoImNhbGxiYWNrLWVyciIpKS4KICAgICAgICAgICAgICAgIHNldE5lc3Rl\nZFRocm93YWJsZXMoZXhjZXBzKTsKICAgICAgICB9CiAgICAgICAgaWYgKCht\nb2RlICYgQ0FMTEJBQ0tfUk9MTEJBQ0spICE9IDAgJiYgKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgIGNlLnNldEZhdGFsKHRy\ndWUpOwogICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChjZSk7\nCiAgICAgICAgfQogICAgICAgIGlmICgobW9kZSAmIENBTExCQUNLX0xPRykg\nIT0gMCAmJiBfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgX2xv\nZy53YXJuKGNlKTsKICAgICAgICBpZiAoKG1vZGUgJiBDQUxMQkFDS19SRVRI\nUk9XKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBjZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBhZGRUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVjdCB0bCkg\newogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIo\ndGwpOwogICAgICAgICAgICBpZiAodGwgaW5zdGFuY2VvZiBSZW1vdGVDb21t\naXRFdmVudE1hbmFnZXIpCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19SRU1PVEVfTElTVEVORVI7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHJlbW92ZVRyYW5zYWN0aW9uTGlzdGVuZXIoT2JqZWN0IHRs\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIucmVtb3Zl\nTGlzdGVuZXIodGwpCiAgICAgICAgICAgICAgICAmJiAodGwgaW5zdGFuY2Vv\nZiBSZW1vdGVDb21taXRFdmVudE1hbmFnZXIpKQogICAgICAgICAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX1JFTU9URV9MSVNURU5FUjsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGludCBnZXRUcmFuc2FjdGlvbkxpc3RlbmVy\nQ2FsbGJhY2tNb2RlKCkgewogICAgICAgIHJldHVybiBfdHJhbnNDYWxsYmFj\na01vZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHJhbnNhY3Rpb25M\naXN0ZW5lckNhbGxiYWNrTW9kZShpbnQgbW9kZSkgewogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBf\ndHJhbnNDYWxsYmFja01vZGUgPSBtb2RlOwogICAgICAgICAgICBfdHJhbnNF\ndmVudE1hbmFnZXIuc2V0RmFpbEZhc3QoKG1vZGUgJiBDQUxMQkFDS19GQUlM\nX0ZBU1QpICE9IDApOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEZpcmUgZ2l2ZW4gdHJhbnNhY3Rpb24gZXZlbnQsIGhhbmRsaW5nIGFu\neSBleGNlcHRpb25zIGFwcHJvcHJpYXRlbHkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBmaXJlVHJhbnNhY3Rpb25FdmVudChUcmFuc2FjdGlvbkV2ZW50\nIHRyYW5zKSB7CiAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlciAhPSBu\ndWxsKQogICAgICAgICAgICBoYW5kbGVDYWxsYmFja0V4Y2VwdGlvbnMoX3Ry\nYW5zRXZlbnRNYW5hZ2VyLmZpcmVFdmVudCh0cmFucyksCiAgICAgICAgICAg\nICAgICBfdHJhbnNDYWxsYmFja01vZGUpOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vCiAgICAvLyBMb29rdXBzCiAgICAvLy8vLy8vLy8vLwoKICAgIHB1Ymxp\nYyBPYmplY3QgZmluZChPYmplY3Qgb2lkLCBib29sZWFuIHZhbGlkYXRlLCBG\naW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpbnQgZmxhZ3MgPSBPSURf\nQ09QWSB8IE9JRF9BTExPV19ORVcgfCBPSURfTk9ERUxFVEVEOwogICAgICAg\nIGlmICghdmFsaWRhdGUpCiAgICAgICAgICAgIGZsYWdzIHw9IE9JRF9OT1ZB\nTElEQVRFOwogICAgICAgIHJldHVybiBmaW5kKG9pZCwgX2ZjLCBudWxsLCBu\ndWxsLCBmbGFncywgY2FsbCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBm\naW5kKE9iamVjdCBvaWQsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgQml0\nU2V0IGV4Y2x1ZGUsCiAgICAgICAgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3Mp\nIHsKICAgICAgICByZXR1cm4gZmluZChvaWQsIGZldGNoLCBleGNsdWRlLCBl\nZGF0YSwgZmxhZ3MsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogSW50\nZXJuYWwgZmluZGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGZp\nbmQoT2JqZWN0IG9pZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBCaXRT\nZXQgZXhjbHVkZSwKICAgICAgICBPYmplY3QgZWRhdGEsIGludCBmbGFncywg\nRmluZENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVs\nbCkKICAgICAgICAgICAgY2FsbCA9IHRoaXM7CiAgICAgICAgb2lkID0gY2Fs\nbC5wcm9jZXNzQXJndW1lbnQob2lkKTsKICAgICAgICBpZiAob2lkID09IG51\nbGwpIHsKICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSA9PSAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZv\ndW5kRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLW9pZCIpKTsKICAgICAgICAg\nICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwogICAg\nICAgIH0KICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAg\nZmV0Y2ggPSBfZmM7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9u\nYWxSZWFkKCk7CgogICAgICAgICAgICAvLyBjYWNoZWQgaW5zdGFuY2U/CiAg\nICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsQnlJZChvaWQsCiAgICAgICAgICAgICAgICAoZmxhZ3MgJiBPSURf\nQUxMT1dfTkVXKSAhPSAwIHx8IGhhc0ZsdXNoZWQoKSk7CiAgICAgICAgICAg\nIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoIXJlcXVp\ncmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRhLCBmbGFncykpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQs\nIHNtKTsKCiAgICAgICAgICAgICAgICBpZiAoIXNtLmlzTG9hZGluZygpKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCB0aGUgY29u\nZmlndXJlZCBmaWVsZHMgYXJlIGxvYWRlZDsgZG8gdGhpcwogICAgICAgICAg\nICAgICAgICAgIC8vIGFmdGVyIG1ha2luZyBpbnN0YW5jZSB0cmFuc2FjdGlv\nbmFsIGZvciBsb2NraW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKCFzbS5p\nc1RyYW5zYWN0aW9uYWwoKSAmJiB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0\nY2gpKQogICAgICAgICAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFs\nKCk7CiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBsb2FkZWQ7CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbG9hZGVkID0gc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2VySW1wbC5MT0FE\nX0ZHUywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlLCBl\nZGF0YSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT0RFTEVURUQpICE9IDAKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZB\nTElEQVRFKSAhPSAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgb25mZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwu\ncHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm8gZGF0YSBuZWVkZWQg\ndG8gYmUgbG9hZGVkIGFuZCB0aGUgdXNlciB3YW50cyB0bwogICAgICAgICAg\nICAgICAgICAgIC8vIHZhbGlkYXRlLCBqdXN0IG1ha2Ugc3VyZSB0aGUgb2Jq\nZWN0IGV4aXN0cwogICAgICAgICAgICAgICAgICAgIGlmICghbG9hZGVkICYm\nIChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAwCiAgICAgICAgICAgICAg\nICAgICAgICAgICYmIF9jb21wYXQuZ2V0VmFsaWRhdGVUcnVlQ2hlY2tzU3Rv\ncmUoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhc20uaXNUcmFuc2Fj\ndGlvbmFsKCkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgIV9zdG9yZS5l\neGlzdHMoc20sIGVkYXRhKSkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgPT0gMCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lk\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAoImRlbC1pbnN0YW5jZSIsIHNtLmdldE1hbmFnZWRJ\nbnN0YW5jZSgpLCBvaWQpKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIC8vIHNpbmNlIHRoZSBvYmplY3Qgd2FzIGNhY2hlZCwgd2Ug\nbWF5IG5lZWQgdG8gdXBncmFkZSBsb2NrCiAgICAgICAgICAgICAgICAvLyBp\nZiBjdXJyZW50IGxldmVsIGlzIGhpZ2hlciB0aGFuIGxldmVsIG9mIGluaXRp\nYWwgbG9hZAogICAgICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIGludCBsZXZlbCA9\nIGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAgICAgICAg\nICBfbG0ubG9jayhzbSwgbGV2ZWwsIGZldGNoLmdldExvY2tUaW1lb3V0KCks\nIGVkYXRhKTsKICAgICAgICAgICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxl\ndmVsLCBmZXRjaC5nZXRXcml0ZUxvY2tMZXZlbCgpKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1\ncm4ob2lkLCBzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlm\nIHRoZXJlJ3Mgbm8gY2FjaGVkIHNtIGZvciBhIG5ldy90cmFuc2llbnQgaWQg\ndHlwZSwgd2UKICAgICAgICAgICAgLy8gaXQgZGVmaW5pdGVseSBkb2Vzbid0\nIGV4aXN0CiAgICAgICAgICAgIGlmIChvaWQgaW5zdGFuY2VvZiBTdGF0ZU1h\nbmFnZXJJZCkKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NS\nZXR1cm4ob2lkLCBudWxsKTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUg\nYSBuZXcgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGRhdGFzdG9yZSBpbnN0YW5j\nZQogICAgICAgICAgICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCAo\nZmxhZ3MgJiBPSURfQ09QWSkgIT0gMCk7CiAgICAgICAgICAgIGJvb2xlYW4g\nbG9hZCA9IHJlcXVpcmVzTG9hZChzbSwgZmFsc2UsIGZldGNoLCBlZGF0YSwg\nZmxhZ3MpOwogICAgICAgICAgICBzbSA9IGluaXRpYWxpemUoc20sIGxvYWQs\nIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUp\nICE9IDApCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uKG9pZCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBhbGwgY29uZmlndXJlZCBmaWVs\nZHMgd2VyZSBsb2FkZWQKICAgICAgICAgICAgaWYgKGxvYWQpIHsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20ubG9hZChm\nZXRjaCwgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywgZXhjbHVkZSwKICAg\nICAgICAgICAgICAgICAgICAgICAgZWRhdGEsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVM\nRVRFRCkgIT0gMAogICAgICAgICAgICAgICAgICAgICAgICB8fCAoZmxhZ3Mg\nJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgb25mZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2Fs\nbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vz\nc1JldHVybihvaWQsIHNtKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgYSBuZXdseS1jb25zdHJ1\nY3RlZCBzdGF0ZSBtYW5hZ2VyLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Rh\ndGVNYW5hZ2VySW1wbCBpbml0aWFsaXplKFN0YXRlTWFuYWdlckltcGwgc20s\nIGJvb2xlYW4gbG9hZCwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIE9iamVjdCBlZGF0YSkgewogICAgICAgIGlmICghbG9hZCkgewogICAg\nICAgICAgICBzbS5pbml0aWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVz\nY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgUENTdGF0ZS5IT0xMT1cp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFBDU3RhdGUgc3RhdGUg\nPSAodXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKSkKICAgICAgICAgICAg\nICAgID8gUENTdGF0ZS5QQ0xFQU4gOiBQQ1N0YXRlLlBOT05UUkFOUzsKICAg\nICAgICAgICAgc20uc2V0TG9hZGluZyh0cnVlKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGlmICghX3N0b3JlLmluaXRpYWxpemUoc20s\nIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgc20uc2V0TG9hZGluZyhmYWxzZSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rpb24gb2lkcywgYm9vbGVhbiB2YWxp\nZGF0ZSwKICAgICAgICBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nbnQgZmxhZ3MgPSBPSURfQ09QWSB8IE9JRF9BTExPV19ORVcgfCBPSURfTk9E\nRUxFVEVEOwogICAgICAgIGlmICghdmFsaWRhdGUpCiAgICAgICAgICAgIGZs\nYWdzIHw9IE9JRF9OT1ZBTElEQVRFOwogICAgICAgIHJldHVybiBmaW5kQWxs\nKG9pZHMsIF9mYywgbnVsbCwgbnVsbCwgZmxhZ3MsIGNhbGwpOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rpb24gb2lkcywg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIEJpdFNldCBleGNs\ndWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFncykgewogICAgICAgIHJldHVy\nbiBmaW5kQWxsKG9pZHMsIGZldGNoLCBleGNsdWRlLCBlZGF0YSwgZmxhZ3Ms\nIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZmluZGVy\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0W10gZmluZEFsbChDb2xs\nZWN0aW9uIG9pZHMsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAg\nICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MsIEZp\nbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGZpbmRBbGxEZXB0aCArKzsK\nCiAgICAgICAgLy8gdGhyb3cgYW55IGV4Y2VwdGlvbnMgZm9yIG51bGwgb2lk\ncyB1cCBpbW1lZGlhdGVseQogICAgICAgIGlmIChvaWRzID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigib2lk\ncyA9PSBudWxsIik7CiAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElE\nQVRFKSAhPSAwICYmIG9pZHMuY29udGFpbnMobnVsbCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLW9pZHMi\nKSk7CgogICAgICAgIC8vIHdlIGhhdmUgdG8gdXNlIGEgbWFwIG9mIG9pZC0+\nc20gcmF0aGVyIHRoYW4gYSBzaW1wbGUKICAgICAgICAvLyBhcnJheSwgc28g\ndGhhdCB3ZSBtYWtlIHN1cmUgbm90IHRvIGNyZWF0ZSBtdWx0aXBsZSBzbXMg\nZm9yIGVxdWl2YWxlbnQKICAgICAgICAvLyBvaWRzIGlmIHRoZSB1c2VyIGhh\ncyBkdXBsaWNhdGVzIGluIHRoZSBnaXZlbiBhcnJheQogICAgICAgIGlmIChf\nbG9hZGluZyA9PSBudWxsKQogICAgICAgICAgICBfbG9hZGluZyA9IG5ldyBI\nYXNoTWFwKChpbnQpIChvaWRzLnNpemUoKSAqIDEuMzMgKyAxKSk7CgogICAg\nICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAgIGNhbGwgPSB0aGlz\nOwogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRj\naCA9IF9mYzsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJl\nYWQoKTsKCiAgICAgICAgICAgIC8vIGNvbGxlY3Rpb24gb2Ygc3RhdGUgbWFu\nYWdlcnMgdG8gcGFzcyB0byBzdG9yZSBtYW5hZ2VyCiAgICAgICAgICAgIExp\nc3QgbG9hZCA9IG51bGw7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207CiAgICAgICAgICAgIGJvb2xlYW4gaW5pdGlhbGl6ZWQ7CiAgICAgICAg\nICAgIGJvb2xlYW4gdHJhbnNTdGF0ZSA9IHVzZVRyYW5zYWN0aW9uYWxTdGF0\nZShmZXRjaCk7CiAgICAgICAgICAgIE9iamVjdCBvYmosIG9pZDsKICAgICAg\nICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykg\newogICAgICAgICAgICAgICAgLy8gaWYgd2UndmUgYWxyZWFkeSBzZWVuIHRo\naXMgb2lkLCBza2lwIHJlcGVhdHMKICAgICAgICAgICAgICAgIG9iaiA9IGl0\nci5uZXh0KCk7CiAgICAgICAgICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NB\ncmd1bWVudChvYmopOwogICAgICAgICAgICAgICAgaWYgKG9pZCA9PSBudWxs\nIHx8IF9sb2FkaW5nLmNvbnRhaW5zS2V5KG9iaikpCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgLy8gaWYgd2UgZG9u\nJ3QgaGF2ZSBhIGNhY2hlZCBpbnN0YW5jZSBvciBpdCBpcyBub3QgdHJhbnNh\nY3Rpb25hbAogICAgICAgICAgICAgICAgLy8gYW5kIGlzIGhvbGxvdyBvciB3\nZSBuZWVkIHRvIHZhbGlkYXRlLCBsb2FkIGl0CiAgICAgICAgICAgICAgICBz\nbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwgKGZsYWdzICYgT0lE\nX0FMTE9XX05FVykgIT0gMAogICAgICAgICAgICAgICAgICAgIHx8IGhhc0Zs\ndXNoZWQoKSk7CiAgICAgICAgICAgICAgICBpbml0aWFsaXplZCA9IHNtICE9\nIG51bGw7CiAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxpemVkKQogICAg\nICAgICAgICAgICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQs\nIChmbGFncyAmIE9JRF9DT1BZKSAhPSAwKTsKCiAgICAgICAgICAgICAgICBf\nbG9hZGluZy5wdXQob2JqLCBzbSk7CiAgICAgICAgICAgICAgICBpZiAocmVx\ndWlyZXNMb2FkKHNtLCBpbml0aWFsaXplZCwgZmV0Y2gsIGVkYXRhLCBmbGFn\ncykpIHsKICAgICAgICAgICAgICAgICAgICB0cmFuc1N0YXRlID0gdHJhbnNT\ndGF0ZSB8fCB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChpbml0aWFsaXplZCAmJiAhc20uaXNUcmFuc2Fj\ndGlvbmFsKCkgJiYgdHJhbnNTdGF0ZSkKICAgICAgICAgICAgICAgICAgICAg\nICAgc20udHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChsb2FkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQg\nPSBuZXcgQXJyYXlMaXN0KG9pZHMuc2l6ZSgpIC0gaWR4KTsKICAgICAgICAg\nICAgICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgaWYgKCFpbml0aWFsaXplZCkKICAgICAgICAgICAgICAgICAgICBzbS5p\nbml0aWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICBQQ1N0YXRlLkhPTExPVyk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBhc3MgYWxsIHN0YXRlIG1h\nbmFnZXJzIGluIG5lZWQgb2YgbG9hZGluZyBvciB2YWxpZGF0aW9uIHRvIHRo\nZQogICAgICAgICAgICAvLyBzdG9yZSBtYW5hZ2VyCiAgICAgICAgICAgIGlm\nIChsb2FkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIFBDU3RhdGUgc3Rh\ndGUgPSAodHJhbnNTdGF0ZSkgPyBQQ1N0YXRlLlBDTEVBTgogICAgICAgICAg\nICAgICAgICAgIDogUENTdGF0ZS5QTk9OVFJBTlM7CiAgICAgICAgICAgICAg\nICBDb2xsZWN0aW9uIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIHN0\nYXRlLAogICAgICAgICAgICAgICAgICAgIFN0b3JlTWFuYWdlci5GT1JDRV9M\nT0FEX05PTkUsIGZldGNoLCBlZGF0YSk7CgogICAgICAgICAgICAgICAgLy8g\nc2V0IGZhaWxlZCBpbnN0YW5jZXMgdG8gbnVsbAogICAgICAgICAgICAgICAg\naWYgKGZhaWxlZCAhPSBudWxsICYmICFmYWlsZWQuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSAhPSAwKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdPYmpl\nY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpOwogICAgICAgICAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZmFpbGVkLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgICAgICBfbG9hZGlu\nZy5wdXQoaXRyLm5leHQoKSwgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNyZWF0ZSByZXN1bHRzIGFy\ncmF5OyBtYWtlIHN1cmUgYWxsIGNvbmZpZ3VyZWQgZmllbGRzIGFyZQogICAg\nICAgICAgICAvLyBsb2FkZWQgaW4gZWFjaCBpbnN0YW5jZQogICAgICAgICAg\nICBPYmplY3RbXSByZXN1bHRzID0gbmV3IE9iamVjdFtvaWRzLnNpemUoKV07\nCiAgICAgICAgICAgIGJvb2xlYW4gYWN0aXZlID0gKF9mbGFncyAmIEZMQUdf\nQUNUSVZFKSAhPSAwOwogICAgICAgICAgICBpbnQgbGV2ZWwgPSBmZXRjaC5n\nZXRSZWFkTG9ja0xldmVsKCk7CiAgICAgICAgICAgIGlkeCA9IDA7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2lkcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOyBpZHgrKykgewogICAgICAgICAgICAgICAgb2lkID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdl\nckltcGwpIF9sb2FkaW5nLmdldChvaWQpOwogICAgICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwgJiYgcmVxdWlyZXNMb2FkKHNtLCB0cnVlLCBmZXRjaCwg\nZWRhdGEsIGZsYWdzKSkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoZmV0Y2gsIFN0YXRlTWFu\nYWdlckltcGwuTE9BRF9GR1MsCiAgICAgICAgICAgICAgICAgICAgICAgIAll\neGNsdWRlLCBlZGF0YSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBf\nbG0ubG9jayhzbSwgbGV2ZWwsIGZldGNoLmdldExvY2tUaW1lb3V0KCksIGVk\nYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnJlYWRMb2Nr\nZWQobGV2ZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIGNhdGNoIChPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbiBvbmZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3Mg\nJiBPSURfTk9ERUxFVEVEKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB8fCAoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG9uZmU7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHNtID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHRzW2lk\neF0gPSBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBmaW5kQWxsRGVwdGgtLTsK\nICAgICAgICAgICAgaWYgKGZpbmRBbGxEZXB0aCA9PSAwKQogICAgICAgICAg\nICAgICAgX2xvYWRpbmcgPSBudWxsOwogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGhh\nc0ZsdXNoZWQoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0ZM\nVVNIRUQpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGUgZ2l2ZW4gaW5zdGFuY2UgbmVlZHMgbG9hZGluZyBiZWZvcmUg\nYmVpbmcgcmV0dXJuZWQKICAgICAqIHRvIHRoZSB1c2VyLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gcmVxdWlyZXNMb2FkKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIGJvb2xlYW4gaW5pdGlhbGl6ZWQsCiAgICAgICAgRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgZWRhdGEsIGludCBmbGFncykg\newogICAgICAgIGlmICghZmV0Y2gucmVxdWlyZXNMb2FkKCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05P\nVkFMSURBVEUpID09IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIGlmIChlZGF0YSAhPSBudWxsKSAvLyB0YWtlIGFkdmFudGFnZSBvZiBl\neGlzdGluZyByZXN1bHQKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKGluaXRpYWxpemVkICYmIHNtLmdldFBDU3RhdGUoKSAhPSBQQ1N0\nYXRlLkhPTExPVykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmICghaW5pdGlhbGl6ZWQgJiYgc20uZ2V0TWV0YURhdGEoKS5nZXRQQ1N1\nYmNsYXNzZXMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICByZXR1cm4gIV9jb21wYXQuZ2V0VmFsaWRhdGVGYWxzZVJl\ndHVybnNIb2xsb3coKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3\naGV0aGVyIHRvIHVzZSBhIHRyYW5zYWN0aW9uYWwgc3RhdGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCAmJiAoIV9vcHRpbWlzdGljCiAgICAg\nICAgICAgIHx8IF9hdXRvQ2xlYXIgPT0gQ0xFQVJfQUxMCiAgICAgICAgICAg\nIHx8IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSAhPSBMT0NLX05PTkUpOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmluZENhY2hlZChPYmplY3Qgb2lk\nLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBu\ndWxsKQogICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBj\nYWxsLnByb2Nlc3NBcmd1bWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihv\naWQsIG51bGwpOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0g\nZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQob2lkLCB0cnVlKTsKICAgICAgICAg\nICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIENsYXNzIGdldE9iamVjdElkVHlw\nZShDbGFzcyBjbHMpIHsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2Uo\nKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgX2xvYWRlciwg\nZmFsc2UpOwogICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsCiAgICAgICAg\nICAgICAgICB8fCBtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0\nYURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBD\nbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICAgICAg\ncmV0dXJuIG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CgogICAgICAgICAgICBy\nZXR1cm4gX3N0b3JlLmdldERhdGFTdG9yZUlkVHlwZShtZXRhKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5l\nd09iamVjdElkKENsYXNzIGNscywgT2JqZWN0IHZhbCkgewogICAgICAgIGlm\nICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0\nYVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0\nYURhdGEoY2xzLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgc3dpdGNo\nIChtZXRhLmdldElkZW50aXR5VHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkU6CiAgICAgICAgICAgICAgICAv\nLyBkZWxlZ2F0ZSB0byBzdG9yZSBtYW5hZ2VyIGZvciBkYXRhc3RvcmUgaWRz\nCiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5nCiAg\nICAgICAgICAgICAgICAgICAgJiYgKChTdHJpbmcpIHZhbCkuc3RhcnRzV2l0\naChTdGF0ZU1hbmFnZXJJZC5TVFJJTkdfUFJFRklYKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IFN0YXRlTWFuYWdlcklkKChTdHJpbmcpIHZh\nbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlLm5ld0RhdGFTdG9y\nZUlkKHZhbCwgbWV0YSk7CiAgICAgICAgICAgIGNhc2UgQ2xhc3NNZXRhRGF0\nYS5JRF9BUFBMSUNBVElPTjoKICAgICAgICAgICAgICAgIGlmIChJbXBsSGVs\ncGVyLmlzQXNzaWduYWJsZShtZXRhLmdldE9iamVjdElkVHlwZSgpLCAKICAg\nICAgICAgICAgICAgICAgICB2YWwuZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoIW1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSAKICAg\nICAgICAgICAgICAgICAgICAgICAgJiYgbWV0YS5pc09iamVjdElkVHlwZVNo\nYXJlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9i\namVjdElkKGNscywgdmFsKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\ndmFsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHN0\ncmluZ2lmaWVkIGFwcCBpZD8KICAgICAgICAgICAgICAgIGlmICh2YWwgaW5z\ndGFuY2VvZiBTdHJpbmcgCiAgICAgICAgICAgICAgICAgICAgJiYgIV9jb25m\nLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAg\nICAgICAgICBnZXRTdHJpY3RJZGVudGl0eVZhbHVlcygpCiAgICAgICAgICAg\nICAgICAgICAgJiYgIU1vZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUENSZWdpc3Ry\neS5uZXdPYmplY3RJZChjbHMsIChTdHJpbmcpIHZhbCk7CgogICAgICAgICAg\nICAgICAgT2JqZWN0W10gYXJyID0gKHZhbCBpbnN0YW5jZW9mIE9iamVjdFtd\nKSA/IChPYmplY3RbXSkgdmFsCiAgICAgICAgICAgICAgICAgICAgOiBuZXcg\nT2JqZWN0W117IHZhbCB9OwogICAgICAgICAgICAgICAgcmV0dXJuIEFwcGxp\nY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhhcnIsIG1ldGEpOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgY2xzKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGNhdGNoIChJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24gaWFlKSB7CiAgICAgICAgCS8vIE9QRU5KUEEtMzY1CiAgICAgICAg\nCXRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtaWQtdmFs\ndWUiLCB2YWwsCiAgICAgICAgICAgICAgICB2YWwuZ2V0Q2xhc3MoKS5nZXRO\nYW1lKCksIGNscykpLnNldENhdXNlKGlhZSk7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChDbGFzc0Nhc3RFeGNlcHRpb24gY2NlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtaWQtdmFsdWUiLCB2YWwsCiAgICAgICAgICAgICAgICB2YWwuZ2V0Q2xh\nc3MoKS5nZXROYW1lKCksIGNscykpLnNldENhdXNlKGNjZSk7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHN0YXRlIG1hbmFn\nZXIgZm9yIHRoZSBnaXZlbiBvaWQuCiAgICAgKi8KICAgIHByaXZhdGUgU3Rh\ndGVNYW5hZ2VySW1wbCBuZXdTdGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvaWQs\nIGJvb2xlYW4gY29weSkgewogICAgICAgIC8vIHNlZSBpZiB3ZSdyZSBpbiB0\naGUgcHJvY2VzcyBvZiBsb2FkaW5nIHRoaXMgb2lkIGluIGEgbG9hZEFsbCBj\nYWxsCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBpZiAo\nX2xvYWRpbmcgIT0gbnVsbCkgewogICAgICAgICAgICBzbSA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBfbG9hZGluZy5nZXQob2lkKTsKICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwgJiYgc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGZpbmQgbWV0YWRhdGEgZm9yIHRoZSBvaWQKICAgICAgICBD\nbGFzcyBwY1R5cGUgPSBfc3RvcmUuZ2V0TWFuYWdlZFR5cGUob2lkKTsKICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29uZi5nZXRNZXRh\nRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgIENsYXNzTWV0YURh\ndGEgbWV0YTsKICAgICAgICBpZiAocGNUeXBlICE9IG51bGwpCiAgICAgICAg\nICAgIG1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShwY1R5cGUsIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbWV0YSA9IHJlcG9z\nLmdldE1ldGFEYXRhKG9pZCwgX2xvYWRlciwgdHJ1ZSk7CgogICAgICAgIC8v\nIGNvcHkgdGhlIG9pZCBpZiBuZWVkZWQKICAgICAgICBpZiAoY29weSAmJiBf\nY29tcGF0LmdldENvcHlPYmplY3RJZHMoKSkgewogICAgICAgICAgICBpZiAo\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQ\nUExJQ0FUSU9OKQogICAgICAgICAgICAgICAgb2lkID0gQXBwbGljYXRpb25J\nZHMuY29weShvaWQsIG1ldGEpOwogICAgICAgICAgICBlbHNlIGlmIChtZXRh\nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9X\nTikKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJtZXRhLXVua25vd25pZCIsIG1ldGEpKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgb2lkID0gX3N0b3JlLmNvcHlEYXRhU3Rv\ncmVJZChvaWQsIG1ldGEpOwogICAgICAgIH0KCiAgICAgICAgc20gPSBuZXdT\ndGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSk7CiAgICAgICAgc20uc2V0T2Jq\nZWN0SWQob2lkKTsKICAgICAgICByZXR1cm4gc207CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4g\nb2lkIGFuZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRl\nTWFuYWdlckltcGwgbmV3U3RhdGVNYW5hZ2VySW1wbChPYmplY3Qgb2lkLAog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBu\nZXcgU3RhdGVNYW5hZ2VySW1wbChvaWQsIG1ldGEsIHRoaXMpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8gVHJhbnNhY3Rpb24KICAgIC8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGJlZ2luKCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJhY3RpdmUiKSk7CiAgICAgICAgICAgIF9mYWN0b3J5LnN5bmNX\naXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIHRydWUpOwogICAgICAgICAg\nICBiZWdpbkludGVybmFsKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTm90aWZ5IHRoZSBzdG9yZSBtYW5hZ2VyIG9mIGEgdHJhbnNh\nY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWdpbkludGVybmFs\nKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJlZ2luU3RvcmVNYW5h\nZ2VyVHJhbnNhY3Rpb24oX29wdGltaXN0aWMpOwogICAgICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19BQ1RJVkU7CgogICAgICAgICAgICAvLyBzdGFydCBsb2Nr\naW5nCiAgICAgICAgICAgIGlmICghX29wdGltaXN0aWMpIHsKICAgICAgICAg\nICAgICAgIF9mYy5zZXRSZWFkTG9ja0xldmVsKF9jb25mLmdldFJlYWRMb2Nr\nTGV2ZWxDb25zdGFudCgpKTsKICAgICAgICAgICAgICAgIF9mYy5zZXRXcml0\nZUxvY2tMZXZlbChfY29uZi5nZXRXcml0ZUxvY2tMZXZlbENvbnN0YW50KCkp\nOwogICAgICAgICAgICAgICAgX2ZjLnNldExvY2tUaW1lb3V0KF9jb25mLmdl\ndExvY2tUaW1lb3V0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9s\nbS5iZWdpblRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBpZiAoX3RyYW5z\nRXZlbnRNYW5hZ2VyLmhhc0JlZ2luTGlzdGVuZXJzKCkpCiAgICAgICAgICAg\nICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVu\ndCh0aGlzLAogICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQu\nQUZURVJfQkVHSU4sIG51bGwsIG51bGwsIG51bGwsIG51bGwpKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIC8vIGlmIHdlIGFscmVhZHkgc3RhcnRlZCB0aGUgdHJhbnNhY3Rpb24sIGRv\nbid0IGxldCBpdCBjb21taXQKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAgIHNldFJvbGxiYWNr\nT25seUludGVybmFsKGtlKTsKICAgICAgICAgICAgdGhyb3cga2Uuc2V0RmF0\nYWwodHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAvLyBpZiB3ZSBhbHJlYWR5IHN0YXJ0ZWQgdGhl\nIHRyYW5zYWN0aW9uLCBkb24ndCBsZXQgaXQgY29tbWl0CiAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAg\nICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChyZSk7CiAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAoX3BlbmRpbmcgIT0gbnVsbCkgewog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ID0gX3BlbmRpbmcuaXRlcmF0b3IoKTsgaXQuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgaXQubmV4dCgpOwogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rp\nb25hbCgpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkKICAg\nICAgICAgICAgICAgICAgICBzZXREaXJ0eShzbSwgdHJ1ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgX3BlbmRpbmcgPSBudWxsOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpblN0b3JlKCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CiAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpID09IDApCiAgICAg\nICAgICAgICAgICBiZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGZhbHNl\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhj\nZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBCZWdpbiBhIHN0b3JlIG1hbmFnZXIgdHJhbnNhY3Rpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBiZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0aW9u\nKGJvb2xlYW4gb3B0aW1pc3RpYykgewogICAgICAgIGlmICghb3B0aW1pc3Rp\nYykgewogICAgICAgICAgICByZXRhaW5Db25uZWN0aW9uKCk7CiAgICAgICAg\nICAgIF9zdG9yZS5iZWdpbigpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19TVE9SRV9BQ1RJVkU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\naWYgKF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9UUkFOUykKICAg\nICAgICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAg\nX3N0b3JlLmJlZ2luT3B0aW1pc3RpYygpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEVuZCB0aGUgY3VycmVudCBzdG9yZSBtYW5hZ2VyIHRy\nYW5zYWN0aW9uLiBUaHJvd3MgYW4KICAgICAqIGV4Y2VwdGlvbiB0byBzaWdu\nYWwgYSBmb3JjZWQgcm9sbGJhY2sgYWZ0ZXIgZmFpbGVkIGNvbW1pdCwgb3Ro\nZXJ3aXNlCiAgICAgKiByZXR1cm5zIGFueSBleGNlcHRpb24gZW5jb3VudGVy\nZWQgZHVyaW5nIHRoZSBlbmQgcHJvY2Vzcy4KICAgICAqLwogICAgcHJpdmF0\nZSBSdW50aW1lRXhjZXB0aW9uIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9u\nKGJvb2xlYW4gcm9sbGJhY2spIHsKICAgICAgICBib29sZWFuIGZvcmNlZFJv\nbGxiYWNrID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiByZWxlYXNlQ29ubiA9\nIGZhbHNlOwogICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gZXJyID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nU1RPUkVfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZWxlYXNl\nQ29ubiA9IF9jb25uUmV0YWluTW9kZSAhPSBDT05OX1JFVEFJTl9BTFdBWVM7\nCiAgICAgICAgICAgICAgICBpZiAocm9sbGJhY2spCiAgICAgICAgICAgICAg\nICAgICAgX3N0b3JlLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgX3N0b3JlLmNvbW1pdCgpOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVsZWFzZUNvbm4gPSBf\nY29ublJldGFpbk1vZGUgPT0gQ09OTl9SRVRBSU5fVFJBTlM7CiAgICAgICAg\nICAgICAgICBfc3RvcmUucm9sbGJhY2tPcHRpbWlzdGljKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgaWYgKCFyb2xsYmFjaykgewogICAgICAg\nICAgICAgICAgZm9yY2VkUm9sbGJhY2sgPSB0cnVlOwogICAgICAgICAgICAg\nICAgdHJ5IHsgX3N0b3JlLnJvbGxiYWNrKCk7IH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUyKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVy\nciA9IHJlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFn\ncyAmPSB+RkxBR19TVE9SRV9BQ1RJVkU7CiAgICAgICAgfQoKICAgICAgICBp\nZiAocmVsZWFzZUNvbm4pIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHJlbGVhc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIGlm\nIChlcnIgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBlcnIgPSByZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGZvcmNlZFJv\nbGxiYWNrKQogICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgcmV0dXJu\nIGVycjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CgogICAgICAg\nICAgICBqYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAg\nICAgICAgICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIo\nKS5nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQoIm51bGwtdHJhbnMiKSk7CgogICAgICAgICAg\nICAvLyB0aGlzIGNvbW1pdCBvbiB0aGUgdHJhbnNhY3Rpb24gd2lsbCBjYXVz\nZSBvdXIKICAgICAgICAgICAgLy8gYmVmb3JlQ29tcGxldGlvbiBtZXRob2Qg\ndG8gYmUgaW52b2tlZAogICAgICAgICAgICB0cmFucy5jb21taXQoKTsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwga2Up\nOwogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5k\nLXRyYW5zLWVycm9yIiksIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgU3Rv\ncmVFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHJvbGxiYWNrKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZh\nbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2Fj\ndGlvbk9wZXJhdGlvbigpOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rp\nb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRp\nbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsK\nICAgICAgICAgICAgaWYgKHRyYW5zICE9IG51bGwpCiAgICAgICAgICAgICAg\nICB0cmFucy5yb2xsYmFjaygpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQo\nImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgZSk7CiAg\nICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3luY1dpdGhNYW5h\nZ2VkVHJhbnNhY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIGlmICghX21hbmFnZWQpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ0cmFucy1ub3QtbWFuYWdlZCIpKTsKICAgICAgICAgICAgaWYgKF9m\nYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIGZhbHNl\nKSkgewogICAgICAgICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBjb21taXRBbmRSZXN1bWUoKSB7CiAgICAgICAgZW5kQW5kUmVzdW1lKHRy\ndWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrQW5kUmVzdW1l\nKCkgewogICAgICAgIGVuZEFuZFJlc3VtZShmYWxzZSk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGVuZEFuZFJlc3VtZShib29sZWFuIGNvbW1pdCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoY29tbWl0KQogICAgICAgICAgICAgICAgY29tbWl0\nKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJvbGxiYWNr\nKCk7CiAgICAgICAgICAgIGJlZ2luKCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGdldFJvbGxiYWNrT25seSgpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgamF2YXgudHJh\nbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAgICAg\nX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rp\nb24oKTsKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cmFu\ncy5nZXRTdGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX01BUktFRF9ST0xMQkFD\nSzsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgVGhyb3dhYmxl\nIGdldFJvbGxiYWNrQ2F1c2UoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rp\nb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNh\nY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAg\naWYgKHRyYW5zID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgaWYgKHRyYW5zLmdldFN0YXR1cygpID09IFN0YXR1\ncy5TVEFUVVNfTUFSS0VEX1JPTExCQUNLKQogICAgICAgICAgICAgICAgcmV0\ndXJuIF9ydW50aW1lLmdldFJvbGxiYWNrQ2F1c2UoKTsKCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFJvbGxiYWNrT25seSgpIHsKICAgICAgICBzZXRSb2xsYmFj\na09ubHkobmV3IFVzZXJFeGNlcHRpb24oKSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0Um9sbGJhY2tPbmx5KFRocm93YWJsZSBjYXVzZSkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CiAgICAgICAg\nICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKGNhdXNlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoZSBjdXJyZW50IHRy\nYW5zYWN0aW9uIGFzIHJvbGxiYWNrLW9ubHkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChUaHJvd2FibGUgY2F1\nc2UpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBqYXZheC50cmFuc2Fj\ndGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVu\ndGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigp\nOwogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nIm51bGwtdHJhbnMiKSk7CiAgICAgICAgICAgIC8vIGVuc3VyZSB0cmFuIGlz\nIGluIGEgdmFsaWQgc3RhdGUgdG8gYWNjZXB0IHRoZSBzZXRSb2xsYmFja09u\nbHkKICAgICAgICAgICAgaW50IHRyYW5TdGF0dXMgPSB0cmFucy5nZXRTdGF0\ndXMoKTsKICAgICAgICAgICAgaWYgKCh0cmFuU3RhdHVzICE9IFN0YXR1cy5T\nVEFUVVNfTk9fVFJBTlNBQ1RJT04pCiAgICAgICAgICAgICAgICAgICAgJiYg\nKHRyYW5TdGF0dXMgIT0gU3RhdHVzLlNUQVRVU19ST0xMRURCQUNLKQogICAg\nICAgICAgICAgICAgICAgICYmICh0cmFuU3RhdHVzICE9IFN0YXR1cy5TVEFU\nVVNfQ09NTUlUVEVEKSkKICAgICAgICAgICAgICAgIF9ydW50aW1lLnNldFJv\nbGxiYWNrT25seShjYXVzZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKF9sb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2Uo\nX2xvYy5nZXQoImludmFsaWQtdHJhbi1zdGF0dXMiLCBuZXcgSW50ZWdlcigK\nICAgICAgICAgICAgICAgICAgICAgICAgdHJhblN0YXR1cyksICJzZXRSb2xs\nYmFja09ubHkiKSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0U2F2ZXBvaW50KFN0cmluZyBuYW1lKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNz\nZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKF9zYXZl\ncG9pbnRzICE9IG51bGwgJiYgX3NhdmVwb2ludHMuY29udGFpbnNLZXkobmFt\nZSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgic2F2ZXBvaW50LWV4aXN0cyIsIG5hbWUpKTsKCiAgICAgICAg\nICAgIGlmIChoYXNGbHVzaGVkKCkgJiYgIV9zcG0uc3VwcG9ydHNJbmNyZW1l\nbnRhbEZsdXNoKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBw\nb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAo\nInNhdmVwb2ludC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAg\nICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlID0gX3NwbS5uZXdTYXZlcG9pbnQo\nbmFtZSwgdGhpcyk7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBu\ndWxsIHx8IF9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAg\nICAgc2F2ZS5zYXZlKGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMoKSk7CiAgICAg\nICAgICAgICAgICBfc2F2ZXBvaW50cyA9IG5ldyBMaW5rZWRNYXAoKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChfc2F2ZXBv\naW50Q2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzYXZlLnNh\ndmUoQ29sbGVjdGlvbnMuRU1QVFlfU0VUKTsKICAgICAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIHNhdmUuc2F2ZShfc2F2ZXBvaW50\nQ2FjaGUpOwogICAgICAgICAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZS5j\nbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIF9zYXZlcG9pbnRzLnB1dChuYW1lLCBzYXZlKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0gbnVsbCB8fCBf\nc2F2ZXBvaW50cy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbGFzdHNhdmVwb2ludCIp\nKTsKICAgICAgICAgICAgcmVsZWFzZVNhdmVwb2ludCgoU3RyaW5nKSBfc2F2\nZXBvaW50cy5nZXQKICAgICAgICAgICAgICAgIChfc2F2ZXBvaW50cy5zaXpl\nKCkgLSAxKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlbGVhc2VTYXZlcG9pbnQoU3RyaW5nIHNhdmVwb2ludCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAg\naW50IGluZGV4ID0gKF9zYXZlcG9pbnRzID09IG51bGwpID8gLTEKICAgICAg\nICAgICAgICAgIDogX3NhdmVwb2ludHMuaW5kZXhPZihzYXZlcG9pbnQpOwog\nICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNhdmVwb2ludCIs\nIHNhdmVwb2ludCkpOwoKICAgICAgICAgICAgLy8gY2xlYXIgb2xkIGluIHJl\ndmVyc2UKICAgICAgICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOwogICAg\nICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMuc2l6ZSgpID4gaW5kZXggKyAx\nKSB7CiAgICAgICAgICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQp\nIF9zYXZlcG9pbnRzLnJlbW92ZQogICAgICAgICAgICAgICAgICAgIChfc2F2\nZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAgICAgICAgICAgIHNhdmUucmVs\nZWFzZShmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNhdmUg\nPSAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKGluZGV4\nKTsKICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKHRydWUpOwogICAgICAgICAg\nICBpZiAoX3NhdmVwb2ludENhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfc2F2ZXBvaW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFja1RvU2F2ZXBvaW50KCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0gbnVsbCB8fCBfc2F2ZXBv\naW50cy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbGFzdHNhdmVwb2ludCIpKTsKICAg\nICAgICAgICAgcm9sbGJhY2tUb1NhdmVwb2ludCgoU3RyaW5nKSBfc2F2ZXBv\naW50cy5nZXQKICAgICAgICAgICAgICAgIChfc2F2ZXBvaW50cy5zaXplKCkg\nLSAxKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJv\nbGxiYWNrVG9TYXZlcG9pbnQoU3RyaW5nIHNhdmVwb2ludCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAg\naW50IGluZGV4ID0gKF9zYXZlcG9pbnRzID09IG51bGwpID8gLTEKICAgICAg\nICAgICAgICAgIDogX3NhdmVwb2ludHMuaW5kZXhPZihzYXZlcG9pbnQpOwog\nICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNhdmVwb2ludCIs\nIHNhdmVwb2ludCkpOwoKICAgICAgICAgICAgLy8gY2xlYXIgb2xkIGluIHJl\ndmVyc2UKICAgICAgICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOwogICAg\nICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMuc2l6ZSgpID4gaW5kZXggKyAx\nKSB7CiAgICAgICAgICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQp\nIF9zYXZlcG9pbnRzLnJlbW92ZQogICAgICAgICAgICAgICAgICAgIChfc2F2\nZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAgICAgICAgICAgIHNhdmUucmVs\nZWFzZShmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNhdmUg\nPSAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKGluZGV4\nKTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBzYXZlZCA9IHNhdmUucm9sbGJh\nY2soX3NhdmVwb2ludHMudmFsdWVzKCkpOwogICAgICAgICAgICBpZiAoX3Nh\ndmVwb2ludENhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKGhhc1RyYW5zYWN0\naW9uYWxPYmplY3RzKCkpIHsKICAgICAgICAgICAgICAgIC8vIGJ1aWxkIHVw\nIGEgbmV3IGNvbGxlY3Rpb24gb2Ygc3RhdGVzCiAgICAgICAgICAgICAgICBU\ncmFuc2FjdGlvbmFsQ2FjaGUgb2xkVHJhbnNDYWNoZSA9IF90cmFuc0NhY2hl\nOwogICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25hbENhY2hlIG5ld1RyYW5z\nQ2FjaGUgPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlCiAgICAgICAgICAgICAg\nICAgICAgKF9vcmRlckRpcnR5KTsKICAgICAgICAgICAgICAgIF90cmFuc0Nh\nY2hlID0gbnVsbDsKCiAgICAgICAgICAgICAgICAvLyBjdXJyZW50bHkgdGhl\ncmUgaXMgdGhlIGFzc3VtcHRpb24gdGhhdCBpbmNyZW1lbnRhbAogICAgICAg\nICAgICAgICAgLy8gZmx1c2ggaXMgZWl0aGVyIGEpIG5vdCBhbGxvd2VkLCBv\nciBiKSByZXF1aXJlZAogICAgICAgICAgICAgICAgLy8gcHJlLXNhdmVwb2lu\ndC4gIHRoaXMgc29sdmVzIGEgbnVtYmVyIG9mIGlzc3VlcyBpbmNsdWRpbmcK\nICAgICAgICAgICAgICAgIC8vIHN0b3JpbmcgZmx1c2hlZCBzdGF0ZXMgYXMg\nd2VsbCBhcyBPSUQgaGFuZGxpbmcuCiAgICAgICAgICAgICAgICAvLyBpZiBm\ndXR1cmUgcGx1Z2lucyBkbyBub3QgZm9sbG93IHRoaXMsIHdlIG5lZWQgdG8g\nY2FjaGUKICAgICAgICAgICAgICAgIC8vIG1vcmUgaW5mbyBwZXIgc3RhdGUK\nICAgICAgICAgICAgICAgIFNhdmVwb2ludEZpZWxkTWFuYWdlciBmbTsKICAg\nICAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNhdmVkLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgZm0gPSAoU2F2\nZXBvaW50RmllbGRNYW5hZ2VyKSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgICAgIHNtID0gZm0uZ2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAg\nICAgICAgICAgc20ucm9sbGJhY2tUb1NhdmVwb2ludChmbSk7CiAgICAgICAg\nICAgICAgICAgICAgb2xkVHJhbnNDYWNoZS5yZW1vdmUoc20pOwogICAgICAg\nICAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIG5ld1RyYW5zQ2FjaGUuYWRkRGlydHkoc20pOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nVHJhbnNDYWNoZS5hZGRDbGVhbihzbSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9sZFRyYW5zQ2Fj\naGUuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrKCk7CiAgICAgICAgICAg\nICAgICAgICAgcmVtb3ZlRnJvbVRyYW5zYWN0aW9uKHNtKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlID0gbmV3VHJh\nbnNDYWNoZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZmx1c2goKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gcmV0dXJuIHNpbGVudGx5IGlmIG5vIHRyYW5zIGlzIGFjdGl2ZSwgb3Ig\naWYgdGhpcyBpcyBhIHJlZW50cmFudAogICAgICAgICAgICAvLyBjYWxsLCB3\naGljaCBjYW4gaGFwcGVuIGlmIHRoZSBzdG9yZSBtYW5hZ2VyIHRyaWVzIHRv\nIGdldCBhbgogICAgICAgICAgICAvLyBhdXRvLWluYyBvaWQgZHVyaW5nIGZs\ndXNoCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDAKICAgICAgICAgICAgICAgIHx8IChfZmxhZ3MgJiBGTEFHX1NUT1JFX0ZM\nVVNISU5HKSAhPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAgICAgLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0CiAg\nICAgICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRh\naW5zKF9jb25mLk9QVElPTl9JTkNfRkxVU0gpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAg\nICAgICAgICAgICAgICAgKCJpbmNyZW1lbnRhbC1mbHVzaC1ub3Qtc3VwcG9y\ndGVkIikpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgIT0gbnVsbCAm\nJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpCiAgICAgICAgICAgICAgICAmJiAh\nX3NwbS5zdXBwb3J0c0luY3JlbWVudGFsRmx1c2goKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICgic2F2ZXBvaW50LWZsdXNoLW5vdC1zdXBw\nb3J0ZWQiKSk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nZmx1c2hTYWZlKEZMVVNIX0lOQyk7CiAgICAgICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19GTFVTSEVEOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBv\nbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBtYXkgYmUgaW4gaW5jb25zaXN0ZW50\nIHN0YXRlCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHkoa2UpOwog\nICAgICAgICAgICAgICAgdGhyb3cga2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgICAgIC8vIHJvbGxiYWNrIG9uIGZsdXNoIGVycm9yOyBvYmplY3Rz\nIG1heSBiZSBpbiBpbmNvbnNpc3RlbnQgc3RhdGUKICAgICAgICAgICAgICAg\nIHNldFJvbGxiYWNrT25seShyZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24ocmUpLnNldEZhdGFsKHRydWUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcHJlRmx1c2goKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAgIGZsdXNoU2FmZShG\nTFVTSF9MT0dJQ0FMKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgdmFsaWRhdGVDaGFuZ2VzKCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIG5v\nIHRyYW5zLCBqdXN0IHJldHVybjsgaWYgYWN0aXZlIGRhdGFzdG9yZSB0cmFu\ncywgZmx1c2gKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElW\nRSkgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMCkgewogICAg\nICAgICAgICAgICAgZmx1c2goKTsKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBy\ndW50aW1lIHN1cHBvcnRzIGluYyBmbHVzaAogICAgICAgICAgICBpZiAoIV9j\nb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250YWlucyhfY29uZi5PUFRJT05f\nSU5DX0ZMVVNIKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICgi\naW5jcmVtZW50YWwtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmbHVzaFNhZmUoRkxVU0hfUk9M\nTEJBQ0spOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzQWN0aXZlKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpICE9IDA7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzU3RvcmVBY3RpdmUoKSB7CiAgICAgICAgLy8gd2Ug\nbmVlZCB0byBsb2NrIGhlcmUsIGJlY2F1c2Ugd2UgbWlnaHQgYmUgaW4gdGhl\nIG1pZGRsZSBvZiBhbgogICAgICAgIC8vIGF0b21pYyB0cmFuc2FjdGlvbiBw\ncm9jZXNzIChlLmcuLCBjb21taXRBbmRSZXN1bWUpCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMDsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0\naGUgY3VycmVudCB0cmFuc2FjdGlvbiBpcyBlbmRpbmcsIGkuZS4gaW4gdGhl\nIDJuZCBwaGFzZQogICAgICogb2YgYSBjb21taXQgb3Igcm9sbGJhY2sKICAg\nICAqLwogICAgYm9vbGVhbiBpc1RyYW5zYWN0aW9uRW5kaW5nKCkgewogICAg\nICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19UUkFOU19FTkRJTkcpICE9IDA7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYmVnaW5PcGVyYXRpb24oYm9v\nbGVhbiBzeW5jVHJhbnMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgaWYg\nKHN5bmNUcmFucyAmJiBfb3BlcmF0aW9uQ291bnQgPT0gMCAmJiBfc3luY01h\nbmFnZWQKICAgICAgICAgICAgICAgICYmIChfZmxhZ3MgJiBGTEFHX0FDVElW\nRSkgPT0gMCkKICAgICAgICAgICAgICAgIHN5bmNXaXRoTWFuYWdlZFRyYW5z\nYWN0aW9uKCk7CiAgICAgICAgICAgIHJldHVybiBfb3BlcmF0aW9uQ291bnQr\nKyA9PSAxOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYXJrIHRoZSBvcGVyYXRpb24gb3Zlci4gSWYgb3V0ZXJtb3N0IGNh\nbGxlciBvZiBzdGFjaywgcmV0dXJucyB0cnVlCiAgICAgKiBhbmQgd2lsbCBk\nZXRhY2ggbWFuYWdlZCBpbnN0YW5jZXMgaWYgbmVjZXNzYXJ5LgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBlbmRPcGVyYXRpb24oKSB7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA9PSAxICYm\nIChfYXV0b0RldGFjaCAmIERFVEFDSF9OT05UWFJFQUQpICE9IDAKICAgICAg\nICAgICAgICAgICYmIChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkgewog\nICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA8IDEp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24o\nX2xvYy5nZXQoIm11bHRpLXRocmVhZGVkLWFjY2VzcyIpKTsKICAgICAgICAg\nICAgcmV0dXJuIF9vcGVyYXRpb25Db3VudCA9PSAxOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX29wZXJhdGlvbkNvdW50\nLS07CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQgPT0gMCkKICAg\nICAgICAgICAgICAgIGluaXRpYWxpemVPcGVyYXRpbmdTZXQoKTsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBT\neW5jaHJvbml6YXRpb24gZ2V0U3luY2hyb25pemF0aW9uKCkgewogICAgICAg\nIHJldHVybiBfc3luYzsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTeW5j\naHJvbml6YXRpb24oU3luY2hyb25pemF0aW9uIHN5bmMpIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgX3N5bmMgPSBzeW5jOwogICAgfQoKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBTeW5jaHJvbml6YXRpb24g\naW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGJlZm9yZUNvbXBs\nZXRpb24oKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHVzZXItc3VwcGxpZWQgc3luY2hy\nb25pemF0aW9uCiAgICAgICAgICAgIGlmIChfc3luYyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX3N5bmMuYmVmb3JlQ29tcGxldGlvbigpOwoKICAgICAg\nICAgICAgZmx1c2hTYWZlKEZMVVNIX0NPTU1JVCk7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAgICAg\nICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNlcHRpb24o\na2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJv\nciIpLCByZSk7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRD\nb21wbGV0aW9uRXhjZXB0aW9uKG5ldyBTdG9yZUV4Y2VwdGlvbihyZSkpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZnRlckNvbXBs\nZXRpb24oaW50IHN0YXR1cykgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZh\nbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRBY3RpdmVU\ncmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfVFJB\nTlNfRU5ESU5HOwogICAgICAgICAgICBlbmRUcmFuc2FjdGlvbihzdGF0dXMp\nOwogICAgICAgICAgICBpZiAoX3N5bmMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9zeW5jLmFmdGVyQ29tcGxldGlvbihzdGF0dXMpOwoKICAgICAgICAg\nICAgaWYgKChfYXV0b0RldGFjaCAmIERFVEFDSF9DT01NSVQpICE9IDApCiAg\nICAgICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxsKTsKICAgICAg\nICAgICAgZWxzZSBpZiAoc3RhdHVzID09IFN0YXR1cy5TVEFUVVNfUk9MTEVE\nQkFDSyAKICAgICAgICAgICAgICAgICYmIChfYXV0b0RldGFjaCAmIERFVEFD\nSF9ST0xMQkFDSykgIT0gMCkgewogICAgICAgICAgICAgICAgZGV0YWNoQWxs\nSW50ZXJuYWwobnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGluIGFuIGVlIGNvbnRleHQsIGl0J3MgcG9zc2libGUgdGhhdCB0aGUgdXNl\nciB0cmllZCB0byBjbG9zZQogICAgICAgICAgICAvLyB1cyBidXQgd2UgZGlk\nbid0IGFjdHVhbGx5IGNsb3NlIGJlY2F1c2Ugd2Ugd2VyZSB3YWl0aW5nIG9u\nIHRoaXMKICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb247IGlmIHRoYXQncyB0\ncnVlLCB0aGVuIGNsb3NlIG5vdwogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQ0xPU0VfSU5WT0tFRCkgIT0gMAogICAgICAgICAgICAgICAgJiYg\nX2NvbXBhdC5nZXRDbG9zZU9uTWFuYWdlZENvbW1pdCgpKQogICAgICAgICAg\nICAgICAgZnJlZSgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10\ncmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKGtlKTsKICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlmIChf\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgcmUpOwogICAgICAg\nICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlv\nbihuZXcgU3RvcmVFeGNlcHRpb24ocmUpKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfQUNUSVZFOwogICAgICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgX2Zs\nYWdzICY9IH5GTEFHX1RSQU5TX0VORElORzsKCiAgICAgICAgICAgIC8vIGV2\nZW50IG1hbmFnZXIgbnVsbGVkIGlmIGZyZWVkIGJyb2tlcgogICAgICAgICAg\nICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyICE9IG51bGwgCiAgICAgICAgICAg\nICAgICAmJiBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkp\nIHsKICAgICAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBU\ncmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAgICAgICAgICAgICAgc3Rh\ndHVzID09IFN0YXR1cy5TVEFUVVNfQ09NTUlUVEVECiAgICAgICAgICAgICAg\nICAgICAgICAgID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9DT01NSVRfQ09N\nUExFVEUKICAgICAgICAgICAgICAgICAgICAgICAgOiBUcmFuc2FjdGlvbkV2\nZW50LkFGVEVSX1JPTExCQUNLX0NPTVBMRVRFLAogICAgICAgICAgICAgICAg\nICAgIG51bGwsIG51bGwsIG51bGwsIG51bGwpKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSWYgd2UncmUgaW4gYSBtYW5hZ2VkIHRyYW5zYWN0\naW9uLCB1c2Ugb3VyIGltcGxpY2l0IGJlaGF2aW9yIGV4Y2VwdGlvbgogICAg\nICogdHJhbnNsYXRvciB0byB0cmFuc2xhdGUgYmVmb3JlL2FmdGVyQ29tcGxl\ndGlvbiBjYWxsYmFjayBlcnJvcnMuCiAgICAgKi8KICAgIHByaXZhdGUgUnVu\ndGltZUV4Y2VwdGlvbiB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2Vw\ndGlvbgogICAgICAgIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\ncmV0dXJuICghX21hbmFnZWQgfHwgX2V4dHJhbnMgPT0gbnVsbCkgPyByZSA6\nIF9leHRyYW5zLnRyYW5zbGF0ZShyZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGbHVzaCBzYWZlbHksIGNhdGNoaW5nIHJlZW50cmFudCBjYWxscy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoU2FmZShpbnQgcmVhc29uKSB7\nCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0ZMVVNISU5HKSAhPSAwKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJyZWVudHJhbnQtZmx1c2giKSk7CgogICAgICAgIF9mbGFncyB8\nPSBGTEFHX0ZMVVNISU5HOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZs\ndXNoKHJlYXNvbik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX0ZMVVNISU5HOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEZsdXNoIHRoZSB0cmFuc2FjdGlvbmFsIHN0YXRlIHRv\nIHRoZSBkYXRhIHN0b3JlLiBTdWJjbGFzc2VzIHRoYXQKICAgICAqIGN1c3Rv\nbWl6ZSBjb21taXQgYmVoYXZpb3Igc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0\naG9kLiBUaGUgbWV0aG9kCiAgICAgKiBhc3N1bWVzIHRoYXQgdGhlIHBlcnNp\nc3RlbmNlIG1hbmFnZXIgaXMgbG9ja2VkLCBpcyBub3QgY2xvc2VkLAogICAg\nICogYW5kIGhhcyBhbiBhY3RpdmUgdHJhbnNhY3Rpb24uCiAgICAgKgogICAg\nICogQHBhcmFtIHJlYXNvbiBvbmUgb2Yge0BsaW5rICNGTFVTSF9JTkN9LCB7\nQGxpbmsgI0ZMVVNIX0NPTU1JVH0sCiAgICAgKiB7QGxpbmsgI0ZMVVNIX1JP\nTExCQUNLfSwgb3Ige0BsaW5rICNGTFVTSF9MT0dJQ0FMfQogICAgICogQHNp\nbmNlIDAuMi41CiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGZsdXNoKGlu\ndCByZWFzb24pIHsKICAgICAgICAvLyB0aGlzIHdpbGwgZW5saXN0IHByb3hp\nZWQgc3RhdGVzIGFzIG5lY2Vzc2FyeSBzbyB3ZSBrbm93IHdoZXRoZXIgd2UK\nICAgICAgICAvLyBoYXZlIGFueXRoaW5nIHRvIGZsdXNoCiAgICAgICAgQ29s\nbGVjdGlvbiB0cmFuc2FjdGlvbmFsID0gZ2V0VHJhbnNhY3Rpb25hbFN0YXRl\ncygpOwoKICAgICAgICAvLyBkbyB3ZSBhY3R1YWxseSBoYXZlIHRvIGZsdXNo\nPyAgb25seSBpZiBvdXIgZmxhZ3Mgc2F5IHNvLCBvciBpZgogICAgICAgIC8v\nIHdlIGhhdmUgdHJhbnNhY3Rpb24gbGlzdGVuZXJzIHRoYXQgbmVlZCB0byBi\nZSBpbnZva2VkIGZvciBjb21taXQKICAgICAgICAvLyAobm8gbmVlZCB0byBp\nbnZva2UgdGhlbSBvbiBpbmMgZmx1c2ggaWYgbm90aGluZyBpcyBkaXJ0eSku\nICB3ZQogICAgICAgIC8vIHNwZWNpYWwgY2FzZSB0aGUgcmVtb3RlIGNvbW1p\ndCBsaXN0ZW5lciB1c2VkIGJ5IHRoZSBkYXRhY2FjaGUgY2F1c2UKICAgICAg\nICAvLyB3ZSBrbm93IGl0IGRvZXNuJ3QgcmVxdWlyZSB0aGUgY29tbWl0IGV2\nZW50IHdoZW4gbm90aGluZyBjaGFuZ2VzCiAgICAgICAgYm9vbGVhbiBmbHVz\naCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVEKSAhPSAwOwogICAg\nICAgIGJvb2xlYW4gbGlzdGVuZXJzID0gKF90cmFuc0V2ZW50TWFuYWdlci5o\nYXNGbHVzaExpc3RlbmVycygpCiAgICAgICAgICAgIHx8IF90cmFuc0V2ZW50\nTWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgJiYgKChf\nZmxhZ3MgJiBGTEFHX1JFTU9URV9MSVNURU5FUikgPT0gMAogICAgICAgICAg\nICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuZ2V0TGlzdGVuZXJzKCkuc2l6ZSgp\nID4gMSk7CiAgICAgICAgaWYgKCFmbHVzaCAmJiAocmVhc29uICE9IEZMVVNI\nX0NPTU1JVCB8fCAhbGlzdGVuZXJzKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBDb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsKICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19QUkVTVE9SSU5HOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChmbHVzaCkgewogICAgICAgICAgICAgICAgLy8gY2FsbCBwcmUg\nc3RvcmUgb24gYWxsIGN1cnJlbnRseSB0cmFuc2FjdGlvbmFsIG9ianMKICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJhbnNhY3Rpb25h\nbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCkpLmJlZm9yZUZs\ndXNoKHJlYXNvbiwgX2NhbGwpOwogICAgICAgICAgICAgICAgZmx1c2hBZGRp\ndGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaG9wZWZ1bGx5IG5vdyBhbGwgZGVwZW5kZW50IGlu\nc3RhbmNlcyB0aGF0IGFyZSBnb2luZyB0byBlbmQKICAgICAgICAgICAgLy8g\ndXAgcmVmZXJlbmNlZCBoYXZlIGJlZW4gbWFya2VkIGFzIHN1Y2g7IGRlbGV0\nZSB1bnJlZmVkCiAgICAgICAgICAgIC8vIGRlcGVuZGVudHMKICAgICAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfREVSRUZERUxFVElORzsKICAgICAgICAgICAg\naWYgKGZsdXNoICYmIF9kZXJlZkNhY2hlICE9IG51bGwgJiYgIV9kZXJlZkNh\nY2hlLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBfZGVyZWZDYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgICAgICAgICBkZWxldGVEZXJlZigoU3RhdGVNYW5h\nZ2VySW1wbCkgaXRyLm5leHQoKSk7CiAgICAgICAgICAgICAgICBmbHVzaEFk\nZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBpZiAocmVhc29uICE9IEZMVVNIX0xPR0lDQUwpIHsK\nICAgICAgICAgICAgICAgIC8vIGlmIG5vIGRhdGFzdG9yZSB0cmFuc2FjdGlv\nbiwgc3RhcnQgb25lOyBldmVuIGlmIHdlIGRvbid0CiAgICAgICAgICAgICAg\nICAvLyB0aGluayB3ZSdsbCBuZWVkIHRvIGZsdXNoIGF0IHRoaXMgcG9pbnQs\nIG91ciB0cmFuc2FjdGlvbgogICAgICAgICAgICAgICAgLy8gbGlzdGVuZXJz\nIG1pZ2h0IGludHJvZHVjZSBzb21lIGRpcnR5IG9iamVjdHMgb3IgaW50ZXJh\nY3QKICAgICAgICAgICAgICAgIC8vIGRpcmVjdGx5IHdpdGggdGhlIGRhdGFi\nYXNlCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVf\nQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAgICAgICAgIGJlZ2luU3RvcmVN\nYW5hZ2VyVHJhbnNhY3Rpb24oZmFsc2UpOwoKICAgICAgICAgICAgICAgIGlm\nICgoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVuZXJzKCkKICAg\nICAgICAgICAgICAgICAgICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5k\nTGlzdGVuZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgJiYgKGZsdXNoIHx8\nIHJlYXNvbiA9PSBGTFVTSF9DT01NSVQpKSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gZmlyZSBldmVudHMKICAgICAgICAgICAgICAgICAgICBtb2JqcyA9\nIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbih0cmFuc2FjdGlvbmFsKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uID09IEZMVVNIX0NPTU1J\nVAogICAgICAgICAgICAgICAgICAgICAgICAmJiBfdHJhbnNFdmVudE1hbmFn\nZXIuaGFzRW5kTGlzdGVuZXJzKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQo\ndGhpcywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlv\nbkV2ZW50LkJFRk9SRV9DT01NSVQsIG1vYmpzLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xzcywgX2Rl\nbGV0ZWRDbHNzKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBmbHVzaEFk\nZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOwogICAgICAgICAgICAg\nICAgICAgICAgICBmbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJ\nUkVEKSAhPSAwOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgaWYgKGZsdXNoICYmIF90cmFuc0V2ZW50TWFuYWdlci5oYXNG\nbHVzaExpc3RlbmVycygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZp\ncmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMs\nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25FdmVu\ndC5CRUZPUkVfRkxVU0gsIG1vYmpzLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRD\nbHNzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoQWRkaXRpb25z\nKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nUFJFU1RPUklORzsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0RFUkVG\nREVMRVRJTkc7CiAgICAgICAgICAgIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7\nCiAgICAgICAgICAgIF9kZXJlZkFkZGl0aW9ucyA9IG51bGw7CgogICAgICAg\nICAgICAvLyBhbHNvIGNsZWFyIGRlcmVmZWQgc2V0OyB0aGUgZGVsZXRlcyBo\nYXZlIGJlZW4gcmVjb3JkZWQKICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hl\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZSA9IG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyBmbHVzaCB0byBzdG9yZSBtYW5hZ2Vy\nCiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChmbHVzaCAmJiByZWFzb24gIT0gRkxVU0hfTE9HSUNB\nTCkgewogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVfRkxV\nU0hJTkc7CiAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAog\nICAgICAgICAgICAgICAgICAgIG5ld0ZsdXNoRXhjZXB0aW9uKF9zdG9yZS5m\nbHVzaCh0cmFuc2FjdGlvbmFsKSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NUT1JF\nX0ZMVVNISU5HOwoKICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9S\nT0xMQkFDSykKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKHRydWUpKTsKICAgICAgICAg\nICAgZWxzZSBpZiAocmVhc29uICE9IEZMVVNIX0xPR0lDQUwpCiAgICAgICAg\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hfUkVRVUlSRUQ7CgogICAg\nICAgICAgICAvLyBtYXJrIHN0YXRlcyBhcyBmbHVzaGVkCiAgICAgICAgICAg\nIGlmIChmbHVzaCkgewogICAgICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbTsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJh\nbnNhY3Rpb25hbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gdGhlIHN0YXRlIG1heSBoYXZlIGJlY29tZSB0cmFu\nc2llbnQsIHN1Y2ggYXMgaWYKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\naXQgaXMgZW1iZWRkZWQgYW5kIHRoZSBvd25lciBoYXMgYmVlbiBkZWxldGVk\nIGR1cmluZwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGZsdXNo\nIHByb2Nlc3M7IGJ1ZyAjMTEwMAogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICAgICAgICAgICAgICBzbS5hZnRlckZsdXNoKHJlYXNvbik7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfSU5DKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBub3QgYWJvdXQgdG8g\nY2xlYXIgdHJhbnMgY2FjaGUgZm9yIGNvbW1pdCAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIGFueXdheSwgcmUtY2FjaGUgZGlydHkgb2JqZWN0\ncyB3aXRoIGRlZmF1bHQgc29mdAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gcmVmczsgd2UgZG9uJ3QgbmVlZCBoYXJkIHJlZnMgbm93IHRoYXQg\ndGhlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlcyBo\nYXZlIGJlZW4gZmx1c2hlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc20ucHJveHlGaWVsZHModHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX3RyYW5zQ2FjaGUuZmx1c2hlZChzbSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBleGNl\ncHMgPSBhZGQoZXhjZXBzLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIHRocm93IGFueSBleGNlcHRpb25zIHRvIHNob3J0Y3V0IGxpc3Rl\nbmVycyBvbiBmYWlsCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4\nY2VwcywgdHJ1ZSk7CgogICAgICAgIGlmIChmbHVzaCAmJiByZWFzb24gIT0g\nRkxVU0hfUk9MTEJBQ0sgJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwKICAg\nICAgICAgICAgJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVu\nZXJzKCkpIHsKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3\nIFRyYW5zYWN0aW9uRXZlbnQodGhpcywKICAgICAgICAgICAgICAgIFRyYW5z\nYWN0aW9uRXZlbnQuQUZURVJfRkxVU0gsIG1vYmpzLCBfcGVyc2lzdGVkQ2xz\ncywKICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRDbHNz\nKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggbmV3\nbHktdHJhbnNhY3Rpb25hbCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgZmx1c2hBZGRpdGlvbnMoQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFs\nLCBpbnQgcmVhc29uKSB7CiAgICAgICAgYm9vbGVhbiBsb29wOwogICAgICAg\nIGRvIHsKICAgICAgICAgICAgLy8gZmx1c2ggbmV3IHRyYW5zYWN0aW9uYWwg\naW5zdGFuY2VzOyBub3RlIGxvZ2ljYWwgb3IKICAgICAgICAgICAgbG9vcCA9\nIGZsdXNoVHJhbnNBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKQog\nICAgICAgICAgICAgICAgfCBkZWxldGVEZXJlZkFkZGl0aW9ucyhfZGVyZWZD\nYWNoZSk7CiAgICAgICAgfSB3aGlsZSAobG9vcCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBGbHVzaCB0cmFuc2FjdGlvbmFsIGFkZGl0aW9ucy4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGZsdXNoVHJhbnNBZGRpdGlvbnMoQ29s\nbGVjdGlvbiB0cmFuc2FjdGlvbmFsLCBpbnQgcmVhc29uKSB7CiAgICAgICAg\naWYgKF90cmFuc0FkZGl0aW9ucyA9PSBudWxsIHx8IF90cmFuc0FkZGl0aW9u\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgLy8ga2VlcCBsb2NhbCB0cmFuc2FjdGlvbmFsIGxpc3QgY29weSB1cCB0\nbyBkYXRlCiAgICAgICAgdHJhbnNhY3Rpb25hbC5hZGRBbGwoX3RyYW5zQWRk\naXRpb25zKTsKCiAgICAgICAgLy8gY29weSB0aGUgY2hhbmdlIHNldCwgdGhl\nbiBjbGVhciBpdCBmb3IgdGhlIG5leHQgaXRlcmF0aW9uCiAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbFtdIHN0YXRlcyA9IChTdGF0ZU1hbmFnZXJJbXBsW10p\nIF90cmFuc0FkZGl0aW9ucy4KICAgICAgICAgICAgdG9BcnJheShuZXcgU3Rh\ndGVNYW5hZ2VySW1wbFtfdHJhbnNBZGRpdGlvbnMuc2l6ZSgpXSk7CiAgICAg\nICAgX3RyYW5zQWRkaXRpb25zID0gbnVsbDsKCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBzdGF0ZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHN0\nYXRlc1tpXS5iZWZvcmVGbHVzaChyZWFzb24sIF9jYWxsKTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBuZXcg\nZGVyZWZlcmVuY2VkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBkZWxldGVEZXJlZkFkZGl0aW9ucyhDb2xsZWN0aW9uIGRlcmVmcykg\newogICAgICAgIGlmIChfZGVyZWZBZGRpdGlvbnMgPT0gbnVsbCB8fCBfZGVy\nZWZBZGRpdGlvbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIC8vIHJlbWVtYmVyIHRoZXNlIGFkZGl0aW9ucyBpbiBj\nYXNlIG9uZSBiZWNvbWVzIGRlcmVmZWQgYWdhaW4gbGF0ZXIKICAgICAgICBk\nZXJlZnMuYWRkQWxsKF9kZXJlZkFkZGl0aW9ucyk7CgogICAgICAgIFN0YXRl\nTWFuYWdlckltcGxbXSBzdGF0ZXMgPSAoU3RhdGVNYW5hZ2VySW1wbFtdKSBf\nZGVyZWZBZGRpdGlvbnMuCiAgICAgICAgICAgIHRvQXJyYXkobmV3IFN0YXRl\nTWFuYWdlckltcGxbX2RlcmVmQWRkaXRpb25zLnNpemUoKV0pOwogICAgICAg\nIF9kZXJlZkFkZGl0aW9ucyA9IG51bGw7CgogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBkZWxl\ndGVEZXJlZihzdGF0ZXNbaV0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIC8qKgogICAgICogRGVsZXRlIGEgZGVyZWZlcmVuY2VkIGRlcGVu\nZGVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRlbGV0ZURlcmVmKFN0\nYXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBpbnQgYWN0aW9uID0gcHJv\nY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0RFTEVURSwKICAgICAgICAg\nICAgc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIHNtLCBudWxsKTsKICAgICAg\nICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pICE9IDApCiAg\nICAgICAgICAgIHNtLmRlbGV0ZSgpOwogICAgICAgIGlmICgoYWN0aW9uICYg\nT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAgICAgICAgIHNt\nLmNhc2NhZGVEZWxldGUoX2NhbGwpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGV0ZXJtaW5lIHRoZSBhY3Rpb24gdG8gdGFrZSBiYXNlZCBvbiB0aGUgdXNl\ncidzIGdpdmVuIGNhbGxiYWNrcyBhbmQKICAgICAqIG91ciBpbXBsaWNpdCBi\nZWhhdmlvci4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgcHJvY2Vzc0FyZ3Vt\nZW50KGludCBvcCwgT2JqZWN0IG9iaiwgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKGNh\nbGwgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc0Fy\nZ3VtZW50KG9wLCBvYmosIHNtKTsKICAgICAgICBpZiAoX2NhbGwgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIF9jYWxsLnByb2Nlc3NBcmd1bWVudChv\ncCwgb2JqLCBzbSk7CiAgICAgICAgcmV0dXJuIE9wQ2FsbGJhY2tzLkFDVF9S\nVU4gfCBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRocm93IHRoZSBwcm9wZXIgZXhjZXB0aW9uIGJhc2VkIG9uIHRo\nZSBnaXZlbiBzZXQgb2YgZmx1c2ggZXJyb3JzLCBvcgogICAgICogZG8gbm90\naGluZyBpZiBubyBlcnJvcnMgb2NjdXJyZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgT3BlbkpQQUV4Y2VwdGlvbiBuZXdGbHVzaEV4Y2VwdGlvbihDb2xsZWN0\naW9uIGV4Y2VwcykgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCB8fCBl\neGNlcHMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgVGhyb3dhYmxlW10gdCA9IChUaHJvd2FibGVbXSkgZXhjZXBzLnRv\nQXJyYXkKICAgICAgICAgICAgKG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUo\nKV0pOwogICAgICAgIExpc3QgZmFpbGVkID0gbmV3IEFycmF5TGlzdCh0Lmxl\nbmd0aCk7CgogICAgICAgIC8vIGNyZWF0ZSBmYXRhbCBleGNlcHRpb24gd2l0\naCBuZXN0ZWQgZXhjZXB0aW9ucyBmb3IgYWxsIHRoZSBmYWlsZWQKICAgICAg\nICAvLyBvYmplY3RzOyBpZiBhbGwgT0wgZXhjZXB0aW9ucywgdGhyb3cgYSB0\nb3AtbGV2ZWwgT0wgZXhjZXB0aW9uCiAgICAgICAgYm9vbGVhbiBvcHQgPSB0\ncnVlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBvcHQgJiYgaSA8IHQubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgb3B0ID0gdFtpXSBpbnN0YW5jZW9m\nIE9wdGltaXN0aWNFeGNlcHRpb247CiAgICAgICAgICAgIGlmIChvcHQpIHsK\nICAgICAgICAgICAgICAgIE9iamVjdCBmID0gKChPcHRpbWlzdGljRXhjZXB0\naW9uKSB0W2ldKS5nZXRGYWlsZWRPYmplY3QoKTsKICAgICAgICAgICAgICAg\nIGlmIChmICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZmFpbGVkLmFk\nZChmKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAob3B0\nICYmICFmYWlsZWQuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbmV3\nIE9wdGltaXN0aWNFeGNlcHRpb24oZmFpbGVkLCB0KTsKICAgICAgICBpZiAo\nb3B0KQogICAgICAgICAgICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRp\nb24odCk7CiAgICAgICAgcmV0dXJuIG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9j\nLmdldCgicm9sbGVkLWJhY2siKSkuCiAgICAgICAgICAgIHNldE5lc3RlZFRo\ncm93YWJsZXModCkuc2V0RmF0YWwodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBFbmQgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24sIG1ha2luZyBhcHBy\nb3ByaWF0ZSBzdGF0ZSB0cmFuc2l0aW9ucy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgZW5kVHJhbnNhY3Rpb24oaW50IHN0YXR1cykgewogICAgICAg\nIC8vIGlmIGEgZGF0YSBzdG9yZSB0cmFuc2FjdGlvbiB3YXMgaW4gcHJvZ3Jl\nc3MsIGRvIHRoZQogICAgICAgIC8vIGFwcHJvcHJpYXRlIHRyYW5zYWN0aW9u\nIGNoYW5nZQogICAgICAgIGJvb2xlYW4gcm9sbGJhY2sgPSBzdGF0dXMgIT0g\nU3RhdHVzLlNUQVRVU19DT01NSVRURUQ7CiAgICAgICAgTGlzdCBleGNlcHMg\nPSBudWxsOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBleGNlcHMgPSBh\nZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihyb2xsYmFj\naykpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgcm9sbGJhY2sgPSB0cnVlOwogICAgICAgICAgICBleGNl\ncHMgPSBhZGQoZXhjZXBzLCByZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBn\nbyBiYWNrIHRvIGRlZmF1bHQgbm9uZSBsb2NrIGxldmVsCiAgICAgICAgX2Zj\nLnNldFJlYWRMb2NrTGV2ZWwoTE9DS19OT05FKTsKICAgICAgICBfZmMuc2V0\nV3JpdGVMb2NrTGV2ZWwoTE9DS19OT05FKTsKICAgICAgICBfZmMuc2V0TG9j\na1RpbWVvdXQoLTEpOwoKICAgICAgICBDb2xsZWN0aW9uIHRyYW5zU3RhdGVz\nOwogICAgICAgIGlmIChoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAg\nICAgICAgICB0cmFuc1N0YXRlcyA9IF90cmFuc0NhY2hlOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgdHJhbnNTdGF0ZXMgPSBDb2xsZWN0aW9ucy5FTVBU\nWV9TRVQ7CgogICAgICAgIC8vIGZpcmUgYWZ0ZXIgcm9sbGJhY2svY29tbWl0\nIGV2ZW50CiAgICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7CiAgICAg\nICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkg\newogICAgICAgICAgICBtb2JqcyA9IG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVj\ndGlvbih0cmFuc1N0YXRlcyk7CiAgICAgICAgICAgIGludCBldmVudFR5cGUg\nPSAocm9sbGJhY2spID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9ST0xMQkFD\nSwogICAgICAgICAgICAgICAgOiBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0NP\nTU1JVDsKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRy\nYW5zYWN0aW9uRXZlbnQodGhpcywgZXZlbnRUeXBlLCBtb2JqcywgCiAgICAg\nICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVs\nZXRlZENsc3MpKTsKICAgICAgICB9CgogICAgICAgIC8vIG51bGwgdHJhbnNh\nY3Rpb25hbCBjYWNoZXMgbm93IHNvIHRoYXQgYWxsIHRoZSByZW1vdmVGcm9t\nVHJhbnNhY3Rpb24KICAgICAgICAvLyBjYWxscyBhcyB3ZSB0cmFuc2l0aW9u\nIGVhY2ggb2JqZWN0IGRvbid0IGhhdmUgdG8gZG8gYW55IHdvcms7IGRvbid0\nCiAgICAgICAgLy8gY2xlYXIgdHJhbnMgY2FjaGUgb2JqZWN0IGJlY2F1c2Ug\nd2Ugc3RpbGwgbmVlZCB0aGUgdHJhbnNTdGF0ZXMKICAgICAgICAvLyByZWZl\ncmVuY2UgdG8gaXQgYmVsb3cKICAgICAgICBfdHJhbnNDYWNoZSA9IG51bGw7\nCiAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzICE9IG51bGwpCiAgICAgICAg\nICAgIF9wZXJzaXN0ZWRDbHNzID0gbnVsbDsKICAgICAgICBpZiAoX3VwZGF0\nZWRDbHNzICE9IG51bGwpCiAgICAgICAgICAgIF91cGRhdGVkQ2xzcyA9IG51\nbGw7CiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyAhPSBudWxsKQogICAgICAg\nICAgICBfZGVsZXRlZENsc3MgPSBudWxsOwoKICAgICAgICAvLyBuZXcgY2Fj\naGUgd291bGQgZ2V0IGNsZWFyZWQgYW55d2F5IGR1cmluZyB0cmFuc2l0aW9u\ncywgYnV0IGRvaW5nIHNvCiAgICAgICAgLy8gaW1tZWRpYXRlbHkgc2F2ZXMg\ndXMgc29tZSBsb29rdXBzCiAgICAgICAgX2NhY2hlLmNsZWFyTmV3KCk7Cgog\nICAgICAgIC8vIHRlbGwgYWxsIGRlcmVmZWQgaW5zdGFuY2VzIHRoZXkncmUg\nbm8gbG9uZ2VyIGRlcmVmZWQ7IHdlIGNhbid0CiAgICAgICAgLy8gcmVseSBv\nbiByb2xsYmFjayBhbmQgY29tbWl0IGNhbGxzIGJlbG93IGNhdXNlIHNvbWUg\naW5zdGFuY2VzIG1pZ2h0CiAgICAgICAgLy8gbm90IGJlIHRyYW5zYWN0aW9u\nYWwKICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhX2RlcmVm\nQ2FjaGUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX2RlcmVmQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nCiAgICAgICAgICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0\nKCkpLnNldERlcmVmZXJlbmNlZERlcGVuZGVudAogICAgICAgICAgICAgICAg\nICAgIChmYWxzZSwgZmFsc2UpOwogICAgICAgICAgICBfZGVyZWZDYWNoZSA9\nIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBwZWZvcm0gY29tbWl0IG9y\nIHJvbGxiYWNrIHN0YXRlIHRyYW5zaXRpb25zIG9uIGVhY2ggaW5zdGFuY2UK\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gdHJhbnNTdGF0ZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGlmIChyb2xsYmFjaykgewogICAgICAgICAgICAgICAgICAgIC8vIHRlbGwg\nb2JqZWN0cyB0aGF0IG1heSBoYXZlIGJlZW4gZGVyZWZlZCB0aGVuIGZsdXNo\nZWQKICAgICAgICAgICAgICAgICAgICAvLyAoYW5kIHRoZXJlZm9yZSBkZWxl\ndGVkKSB0byB1bi1kZXJlZgogICAgICAgICAgICAgICAgICAgIHNtLnNldERl\ncmVmZXJlbmNlZERlcGVuZGVudChmYWxzZSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgICAgIHNtLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICBzbS5jb21taXQoKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBub3RpZnkgdGhlIGxvY2sgbWFuYWdl\nciB0byBjbGVhbiB1cCBhbmQgcmVsZWFzZSByZW1haW5pbmcgbG9ja3MKICAg\nICAgICBfbG0uZW5kVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgLy8gY2xlYXIg\nb2xkIHNhdmVwb2ludHMgaW4gcmV2ZXJzZQogICAgICAgIE9wZW5KUEFTYXZl\ncG9pbnQgc2F2ZTsKICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMgIT0gbnVs\nbCAmJiBfc2F2ZXBvaW50cy5zaXplKCkgPiAwKSB7CiAgICAgICAgICAgIHNh\ndmUgPQogICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZl\ncG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAg\nICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAg\nX3NhdmVwb2ludHMgPSBudWxsOwogICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9\nIG51bGw7CgogICAgICAgIC8vIGZpcmUgYWZ0ZXIgc3RhdGUgY2hhbmdlIGV2\nZW50CiAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0\nZW5lcnMoKSkKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3\nIFRyYW5zYWN0aW9uRXZlbnQodGhpcywgVHJhbnNhY3Rpb25FdmVudC4KICAg\nICAgICAgICAgICAgIEFGVEVSX1NUQVRFX1RSQU5TSVRJT05TLCBtb2Jqcywg\nbnVsbCwgbnVsbCwgbnVsbCkpOwoKICAgICAgICAvLyBub3cgY2xlYXIgdHJh\nbnMgY2FjaGU7IGtlZXAgY2xlYXJlZCB2ZXJzaW9uIHJhdGhlciB0aGFuCiAg\nICAgICAgLy8gbnVsbCB0byBhdm9pZCBoYXZpbmcgdG8gcmUtY3JlYXRlIHRo\nZSBzZXQgbGF0ZXI7IG1vcmUgZWZmaWNpZW50CiAgICAgICAgaWYgKHRyYW5z\nU3RhdGVzICE9IENvbGxlY3Rpb25zLkVNUFRZX1NFVCkgewogICAgICAgICAg\nICBfdHJhbnNDYWNoZSA9IChUcmFuc2FjdGlvbmFsQ2FjaGUpIHRyYW5zU3Rh\ndGVzOwogICAgICAgICAgICBfdHJhbnNDYWNoZS5jbGVhcigpOwogICAgICAg\nIH0KCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgdHJ1\nZSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE9i\namVjdCBsaWZlY3ljbGUKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\ncHVibGljIHZvaWQgcGVyc2lzdChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgcGVyc2lzdChvYmosIG51bGwsIHRydWUsIGNhbGwp\nOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIHBlcnNp\nc3QoT2JqZWN0IG9iaiwgT2JqZWN0IGlkLAogICAgICAgIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICByZXR1cm4gcGVyc2lzdChvYmosIGlkLCB0cnVl\nLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0QWxsKENv\nbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHBl\ncnNpc3RBbGwob2JqcywgdHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmplY3RzLiAgSW5kaWNhdGUgd2hl\ndGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0CiAgICAgKiAoUE5F\nVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBORVdQUk9WSVNJT05BTCku\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3RBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBib29sZWFuIGV4cGxpY2l0LCAKICAgICAgICBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwoKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIHBlcnNpc3QoaXRyLm5leHQoKSwgZXhwbGljaXQsIGNhbGwpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewog\nICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUgZ2l2ZW4gZWxlbWVudCBp\ncyBub3QgbnVsbCwgYWRkIGl0IHRvIHRoZSBnaXZlbiBsaXN0LAogICAgICog\nY3JlYXRpbmcgdGhlIGxpc3QgaWYgbmVjZXNzYXJ5LgogICAgICovCiAgICBw\ncml2YXRlIExpc3QgYWRkKExpc3QgbCwgT2JqZWN0IG8pIHsKICAgICAgICBp\nZiAobyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbDsKICAgICAgICBp\nZiAobCA9PSBudWxsKQogICAgICAgICAgICBsID0gbmV3IExpbmtlZExpc3Qo\nKTsKICAgICAgICBsLmFkZChvKTsKICAgICAgICByZXR1cm4gbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlvbiB3cmFwcGluZyB0\naGUgZ2l2ZW4gbmVzdGVkIGV4Y2VwdGlvbnMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoTGlzdCBleGNlcHMsIGJv\nb2xlYW4gZGF0YXN0b3JlKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9PSBudWxs\nIHx8IGV4Y2Vwcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBpZiAoZGF0YXN0b3JlICYmIGV4Y2Vwcy5zaXplKCkgPT0gMSkKICAg\nICAgICAgICAgdGhyb3cgKFJ1bnRpbWVFeGNlcHRpb24pIGV4Y2Vwcy5nZXQo\nMCk7CgogICAgICAgIGJvb2xlYW4gZmF0YWwgPSBmYWxzZTsKICAgICAgICBU\naHJvd2FibGVbXSB0ID0gKFRocm93YWJsZVtdKSBleGNlcHMudG9BcnJheQog\nICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMuc2l6ZSgpXSk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0Lmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmICh0W2ldIGluc3RhbmNlb2YgT3BlbkpQQUV4Y2VwdGlv\nbgogICAgICAgICAgICAgICAgJiYgKChPcGVuSlBBRXhjZXB0aW9uKSB0W2ld\nKS5pc0ZhdGFsKCkpCiAgICAgICAgICAgICAgICBmYXRhbCA9IHRydWU7CiAg\nICAgICAgfQogICAgICAgIE9wZW5KUEFFeGNlcHRpb24gZXJyOwogICAgICAg\nIGlmIChkYXRhc3RvcmUpCiAgICAgICAgICAgIGVyciA9IG5ldyBTdG9yZUV4\nY2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIGVyciA9IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuZXN0ZWQtZXhjZXBzIikpOwogICAgICAgIHRocm93IGVyci5zZXRO\nZXN0ZWRUaHJvd2FibGVzKHQpLnNldEZhdGFsKGZhdGFsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdC4gIEluZGlj\nYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lzdAogICAg\nICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVXUFJPVklT\nSU9OQUwpCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoT2JqZWN0\nIG9iaiwgYm9vbGVhbiBleHBsaWNpdCwgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIHBlcnNpc3Qob2JqLCBudWxsLCBleHBsaWNpdCwgY2FsbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmplY3Qu\nICBJbmRpY2F0ZSB3aGV0aGVyIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBlcnNp\nc3QKICAgICAqIChQTkVXKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5F\nV1BST1ZJU0lPTkFMKS4KICAgICAqIFNlZSB7QGxpbmsgQnJva2VyfSBmb3Ig\nZGV0YWlscyBvbiB0aGlzIG1ldGhvZC4KICAgICAqLwogICAgcHVibGljIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgcGVyc2lzdChPYmplY3Qgb2JqLCBPYmplY3Qg\naWQsIGJvb2xlYW4gZXhwbGljaXQsCiAgICAgICAgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7\nCgogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVN\nYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoIV9vcGVy\nYXRpbmcuYWRkKG9iaikpCiAgICAgICAgICAgICAgICByZXR1cm4gc207Cgog\nICAgICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX1BFUlNJU1QsIG9iaiwgc20sIGNhbGwpOwogICAgICAgICAg\nICBpZiAoYWN0aW9uID09IE9wQ2FsbGJhY2tzLkFDVF9OT05FKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHNtOwoKICAgICAgICAgICAgLy8gQUNUX0NBU0NB\nREUKICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1Rf\nUlVOKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjYXNj\nYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tzLk9QX1BFUlNJU1QsIG9iaiwgY2Fs\nbCwKICAgICAgICAgICAgICAgICAgICAgICAgInBlcnNpc3QiKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gQUNUX1JVTgogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUg\ncGM7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24oX2xvYy5nZXQKICAg\nICAgICAgICAgICAgICAgICAgICAgKCJwZXJzaXN0LWRldGFjaGVkIiwgRXhj\nZXB0aW9ucy50b1N0cmluZyhvYmopKSkuCiAgICAgICAgICAgICAgICAgICAg\nICAgIHNldEZhaWxlZE9iamVjdChvYmopOwoKICAgICAgICAgICAgICAgIGlm\nICghc20uaXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgc20u\ncGVyc2lzdCgpOwogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5wZXJzaXN0\nKHNtKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2Fs\nbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQogICAgICAgICAgICAgICAgICAg\nICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gc207CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgLy8gYW4gZW1iZWRkZWQgZmllbGQ7IG5vdGlmeSB0aGUgb3duZXIg\ndGhhdCB0aGUgdmFsdWUgaGFzCiAgICAgICAgICAgICAgICAvLyBjaGFuZ2Vk\nIGJ5IGJlY29taW5nIGluZGVwZW5kZW50bHkgcGVyc2lzdGVudAogICAgICAg\nICAgICAgICAgc20uZ2V0T3duZXIoKS5kaXJ0eShzbS5nZXRPd25lckluZGV4\nKCkpOwogICAgICAgICAgICAgICAgX2NhY2hlLnBlcnNpc3Qoc20pOwogICAg\nICAgICAgICAgICAgcGMgPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBjID0gYXNz\nZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7CiAgICAgICAgICAgICAgICBp\nZiAocGMucGNJc0RldGFjaGVkKCkgPT0gQm9vbGVhbi5UUlVFKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24o\nX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJwZXJzaXN0LWRl\ndGFjaGVkIiwgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSkuCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChvYmopOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29u\nZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAg\nICAgICAgZ2V0TWV0YURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIsIHRy\ndWUpOwogICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQob2JqLCBudWxs\nLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5CRUZPUkVfUEVSU0lTVCk7CgogICAg\nICAgICAgICAvLyBjcmVhdGUgaWQgZm9yIGluc3RhbmNlCiAgICAgICAgICAg\nIGlmIChpZCA9PSBudWxsKSB7CiAgICAgICAgICAgIAlpbnQgaWRUeXBlID0g\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKTsKICAgICAgICAgICAgICAgIGlmIChp\nZFR5cGUgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAg\nICAgICAgICAgICAgICBpZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShwYywg\nbWV0YSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChpZFR5cGUgPT0gQ2xh\nc3NNZXRhRGF0YS5JRF9VTktOT1dOKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25p\nZCIsIG1ldGEpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBpZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2Ug\nZG9uJ3QgYWxyZWFkeSBoYXZlIHRoZSBpbnN0YW5jZSBjYWNoZWQKICAgICAg\nICAgICAgY2hlY2tGb3JEdXBsaWNhdGVJZChpZCwgb2JqKTsKCiAgICAgICAg\nICAgIC8vIGlmIGhhZCBlbWJlZGRlZCBzbSwgbnVsbCBpdAogICAgICAgICAg\nICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBjLnBjUmVwbGFj\nZVN0YXRlTWFuYWdlcihudWxsKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBu\nZXcgc20KICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChp\nZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChleHBsaWNp\ndCkKICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0\nYXRlLlBORVcpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIHNtLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5FV1BST1ZJU0lP\nTkFMKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBzbS5p\nbml0aWFsaXplKHBjLCBQQ1N0YXRlLlBOT05UUkFOU05FVyk7CiAgICAgICAg\nICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9\nIDApCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsK\nICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVtcG9yYXJpbHkgbWFuYWdlIHRo\nZSBnaXZlbiBpbnN0YW5jZSBpbiBvcmRlciB0byBjYXNjYWRlIHRoZSBnaXZl\nbgogICAgICogb3BlcmF0aW9uIHRocm91Z2ggaXQuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBjYXNjYWRlVHJhbnNpZW50KGludCBvcCwgT2JqZWN0IG9i\naiwgT3BDYWxsYmFja3MgY2FsbCwKICAgICAgICBTdHJpbmcgZXJyT3ApIHsK\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBhc3NlcnRQZXJzaXN0\nZW5jZUNhcGFibGUob2JqKTsKCiAgICAgICAgLy8gaWYgdXNpbmcgZGV0YWNo\nZWQgc3RhdGUgbWFuYWdlciwgZG9uJ3QgcmVwbGFjZQogICAgICAgIGlmIChw\nYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgZXJyT3ApOwoKICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9z\naXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YShvYmou\nZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKFN0YXRlTWFuYWdl\ncklkLgogICAgICAgICAgICBuZXdJbnN0YW5jZSh0aGlzKSwgbWV0YSwgdGhp\ncyk7CiAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5UTE9BREVE\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBzd2l0Y2ggKG9wKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX1BFUlNJU1Q6CiAg\nICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIE9wQ2FsbGJhY2tzLk9QX0RFTEVURToKICAgICAgICAgICAgICAgICAgICBz\nbS5jYXNjYWRlRGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPcENhbGxiYWNrcy5PUF9SRUZS\nRVNIOgogICAgICAgICAgICAgICAgICAgIHNtLmdhdGhlckNhc2NhZGVSZWZy\nZXNoKGNhbGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2Yob3ApKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAg\nICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgZGVsZXRlQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9u\nKCk7CgogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAg\nICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBvYmogPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0U3RhdGVN\nYW5hZ2VySW1wbChvYmosIHRydWUpLCBjYWxsKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAg\nICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3dOZXN0ZWRFeGNl\ncHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBkZWxldGUoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3Mg\nY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwog\nICAgICAgICAgICBkZWxldGUob2JqLCBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9i\naiwgdHJ1ZSksIGNhbGwpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZGVsZXRlLgogICAgICovCiAg\nICB2b2lkIGRlbGV0ZShPYmplY3Qgb2JqLCBTdGF0ZU1hbmFnZXJJbXBsIHNt\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKCFfb3BlcmF0aW5n\nLmFkZChvYmopKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGludCBh\nY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfREVMRVRF\nLCBvYmosIHNtLCBjYWxsKTsKICAgICAgICBpZiAoYWN0aW9uID09IE9wQ2Fs\nbGJhY2tzLkFDVF9OT05FKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIEFDVF9DQVNDQURFCiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxi\nYWNrcy5BQ1RfUlVOKSA9PSAwKSB7CiAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoIXNtLmlzRW1iZWRkZWQoKSB8\nfCAhc20uZ2V0RGVyZWZlcmVuY2VkRW1iZWREZXBlbmRlbnQoKSkgewogICAg\nICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNrcy5P\nUF9ERUxFVEUsIG9iaiwgY2FsbCwgImRlbGV0ZSIpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBBQ1RfUlVOCiAgICAgICAg\naWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNo\nZWQoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0\naW9uKG9iaiwgImRlbGV0ZSIpOwogICAgICAgICAgICBpZiAoKGFjdGlvbiAm\nIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKSB7CiAgICAgICAgICAg\nICAgICBpZiAoIXNtLmlzRW1iZWRkZWQoKSB8fCAhc20uZ2V0RGVyZWZlcmVu\nY2VkRW1iZWREZXBlbmRlbnQoKSkgewogICAgICAgICAgICAgICAgICAgIHNt\nLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgc20uZGVsZXRlKCk7CiAgICAgICAgfSBl\nbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0\nYWNoZWQoKSA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgIHRocm93IG5l\nd0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgImRlbGV0ZSIpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIGluZGljYXRpbmcgdGhh\ndCB0aGUgY3VycmVudCBhY3Rpb24gY2FuJ3QgYmUKICAgICAqIHBlcmZvcm1l\nZCBvbiBhIGRldGFjaGVkIG9iamVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBP\ncGVuSlBBRXhjZXB0aW9uIG5ld0RldGFjaGVkRXhjZXB0aW9uKE9iamVjdCBv\nYmosCiAgICAgICAgU3RyaW5nIG9wZXJhdGlvbikgewogICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGV0YWNoZWQtb3Ai\nLCBvcGVyYXRpb24sCiAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmco\nb2JqKSkpLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHJlbGVhc2VBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIHJlbGVhc2UoaXRyLm5leHQoKSwgY2FsbCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAg\nICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRo\ncm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVsZWFzZShPYmplY3Qgb2Jq\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFn\nZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwog\nICAgICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX1JFTEVBU0UsIG9iaiwgc20sIGNhbGwpOwoKICAgICAgICAg\nICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikg\nIT0gMCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAg\nYm9vbGVhbiBwZW5kaW5nID0gc20uaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgp\nOwogICAgICAgICAgICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICAg\nICAgICAgIGlmIChwZW5kaW5nKQogICAgICAgICAgICAgICAgICAgIHJlbW92\nZUZyb21QZW5kaW5nVHJhbnNhY3Rpb24oc20pOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgT3BlbkpQQVN0YXRlTWFuYWdlciBlbWJlZChPYmplY3Qgb2JqLCBPYmpl\nY3QgaWQsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwgVmFs\ndWVNZXRhRGF0YSBvd25lck1ldGEpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFn\nZXJJbXBsIG9yaWcgPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7\nCiAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIC8vIGlmIGFscmVhZHkgZW1iZWRkZWQsIG5vdGhpbmcgdG8gZG8KICAg\nICAgICAgICAgICAgIGlmIChvcmlnLmdldE93bmVyKCkgPT0gb3duZXIgJiYg\nb3JpZy5nZXRNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgICAgIGdldEVt\nYmVkZGluZ01ldGFEYXRhKCkgPT0gb3duZXJNZXRhKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBvcmlnOwoKICAgICAgICAgICAgICAgIC8vIG90aGVy\nd2lzZSBtYWtlIHN1cmUgcGMgaXMgZnVsbHkgbG9hZGVkIGZvciB3aGVuIHdl\nIGNvcHkgaXRzCiAgICAgICAgICAgICAgICAvLyBkYXRhIGJlbG93CiAgICAg\nICAgICAgICAgICBvcmlnLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxP\nQURfQUxMLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGVt\nYmVkZGVkIG1ldGFkYXRhCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYSA9IG93bmVyTWV0YS5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAg\nICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1lbWJlZCIsIG93\nbmVyTWV0YSkpOwoKICAgICAgICAgICAgaWYgKGlkID09IG51bGwpCiAgICAg\nICAgICAgICAgICBpZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRo\naXMpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG5ldyBT\ndGF0ZU1hbmFnZXJJbXBsKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAg\nc20uc2V0T3duZXIoKFN0YXRlTWFuYWdlckltcGwpIG93bmVyLCBvd25lck1l\ndGEpOwoKICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIGNvcHk7CiAg\nICAgICAgICAgIFBDU3RhdGUgc3RhdGU7CiAgICAgICAgICAgIENsYXNzIHR5\ncGUgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgaWYg\nKG9iaiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBnaXZlIGNvcHkg\nYW5kIHRoZSBvcmlnaW5hbCBpbnN0YW5jZSB0aGUgc2FtZSBzdGF0ZSBtYW5h\nZ2VyCiAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IHdlIGNhbiBjb3B5IGZp\nZWxkcyBmcm9tIG9uZSB0byB0aGUgb3RoZXIKICAgICAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgY29weVNNOwogICAgICAgICAgICAgICAgUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjOwogICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNvcHlTTSA9IHNtOwogICAg\nICAgICAgICAgICAgICAgIHBjID0gYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxl\nKG9iaik7CiAgICAgICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVN\nYW5hZ2VyKHNtKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgY29weVNNID0gb3JpZzsKICAgICAgICAgICAgICAgICAg\nICBwYyA9IG9yaWcuZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICAvLyBjb3B5IHRoZSBpbnN0YW5jZS4gIHdlIGRvIHRoaXMgZXZl\nbiBpZiBpdCBkb2Vzbid0IGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAv\nLyBoYXZlIGEgc3RhdGUgbWFuYWdlciBpbiBjYXNlIGl0IGlzIGxhdGVyIGFz\nc2lnbmVkIHRvIGEKICAgICAgICAgICAgICAgICAgICAvLyBQQyBmaWVsZDsg\nYXQgdGhhdCBwb2ludCBpdCdzIHRvbyBsYXRlIHRvIGNvcHkKICAgICAgICAg\nICAgICAgICAgICBjb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZSh0eXBl\nLCBjb3B5U00sIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpbnRbXSBm\naWVsZHMgPSBuZXcgaW50W21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoXTsKICAg\nICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzW2ld\nID0gaTsKICAgICAgICAgICAgICAgICAgICBjb3B5LnBjQ29weUZpZWxkcyhw\nYywgZmllbGRzKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBDU3Rh\ndGUuRUNPUFk7CiAgICAgICAgICAgICAgICAgICAgY29weS5wY1JlcGxhY2VT\ndGF0ZU1hbmFnZXIobnVsbCk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5jZSBkaWRu\nJ3QgaGF2ZSBhIHN0YXRlIG1hbmFnZXIgdG8gc3RhcnQsCiAgICAgICAgICAg\nICAgICAgICAgLy8gcmV2ZXJ0IGl0IHRvIGJlaW5nIHRyYW5zaWVudAogICAg\nICAgICAgICAgICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihudWxsKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUs\nIHNtLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSAhPSAwICYmICFfb3B0aW1pc3RpYykKICAgICAgICAgICAg\nICAgICAgICBzdGF0ZSA9IFBDU3RhdGUuRUNMRUFOOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5F\nTk9OVFJBTlM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNtLmluaXRp\nYWxpemUoY29weSwgc3RhdGUpOwogICAgICAgICAgICByZXR1cm4gc207CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nZiBub3QgYWxyZWFkeSBjYWNoZWQsIGNyZWF0ZSBhbiBlbXB0eSBjb3B5IG9m\nIHRoZSBnaXZlbiBzdGF0ZQogICAgICogbWFuYWdlciBpbiB0aGUgZ2l2ZW4g\nc3RhdGUuCiAgICAgKi8KICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgY29weShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIGNvcHksIFBDU3RhdGUgc3RhdGUpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIE9iamVjdCBvaWQg\nPSBjb3B5LmZldGNoT2JqZWN0SWQoKTsKICAgICAgICAgICAgQ2xhc3MgdHlw\nZSA9IGNvcHkuZ2V0TWFuYWdlZEluc3RhbmNlKCkuZ2V0Q2xhc3MoKTsKICAg\nICAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIC8vIGNh\nY2hlZCBpbnN0YW5jZT8KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IG51bGw7CiAgICAgICAgICAgIGlmICghY29weS5pc0VtYmVkZGVkKCkp\nCiAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlk\nKG9pZCwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29u\nZi4KICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJ\nbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nID0gcmVwb3MuZ2V0TWV0YURhdGEodHlwZSwgX2xvYWRlciwgdHJ1ZSk7CiAg\nICAgICAgICAgICAgICAvLyBjb25zdHJ1Y3QgYSBuZXcgc3RhdGUgbWFuYWdl\nciB3aXRoIGFsbCBpbmZvIGtub3duCiAgICAgICAgICAgICAgICBzbSA9IG5l\ndyBTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7CiAgICAgICAg\nICAgICAgICBzbS5zZXRPYmplY3RJZChvaWQpOwogICAgICAgICAgICAgICAg\nc20uaW5pdGlhbGl6ZShzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5\ncGUoKSwgc3RhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiBzbTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lk\nIHJlZnJlc2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKG9ianMgPT0gbnVsbCB8fCBvYmpzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250\ncmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSAKICAg\nICAgICAgICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKGl0ci5uZXh0KCks\nIGNhbGwpOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIAlyZXR1cm47CiAgICAgICAgICAgIGlmIChfb3BlcmF0\naW5nLnNpemUoKSA9PSAxKQogICAgICAgICAgICAJcmVmcmVzaEludGVybmFs\nKF9vcGVyYXRpbmcuaXRlcmF0b3IoKS5uZXh0KCksIGNhbGwpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwoX29wZXJh\ndGluZywgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHJlZnJlc2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAg\nICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2gob2JqLCBjYWxsKTsKICAg\nICAgICAgICAgaWYgKF9vcGVyYXRpbmcuaXNFbXB0eSgpKQogICAgICAgICAg\nICAJcmV0dXJuOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXplKCkg\nPT0gMSkKICAgICAgICAgICAgCXJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5n\nLml0ZXJhdG9yKCkubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcsIGNhbGwp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlcnMg\nYWxsIG9iamVjdHMgcmVhY2hhYmxlIHRocm91Z2ggY2FzY2FkZS1yZWZyZXNo\nIHJlbGF0aW9ucwogICAgICogaW50byB0aGUgb3BlcmF0aW5nIHNldC4KICAg\nICAqLwogICAgdm9pZCBnYXRoZXJDYXNjYWRlUmVmcmVzaChPYmplY3Qgb2Jq\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKCFfb3BlcmF0aW5n\nLmFkZChvYmopKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFs\nc2UpOwogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAg\naWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoc20gIT0gbnVsbCkK\nICAgICAgICAgICAgc20uZ2F0aGVyQ2FzY2FkZVJlZnJlc2goY2FsbCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBjYXNjYWRlVHJhbnNpZW50KE9wQ2Fs\nbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwgY2FsbCwgInJlZnJlc2giKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aXRo\nIHRoZSBmdWxsIHNldCBvZiBvYmplY3RzIHJlYWNoYWJsZSB2aWEKICAgICAq\nIGNhc2NhZGUtcmVmcmVzaCByZWxhdGlvbnMgZnJvbSB0aGUgdXNlci1naXZl\nbiBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJl\nc2hJbnRlcm5hbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgIAlpZiAob2JqcyA9PSBudWxsIHx8IG9ianMuaXNFbXB0eSgpKQog\nICAgCQlyZXR1cm47CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbGxlY3QgaW5zdGFuY2VzIHRo\nYXQgbmVlZCBhIHJlZnJlc2gKICAgICAgICAgICAgQ29sbGVjdGlvbiBsb2Fk\nID0gbnVsbDsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAg\nICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFj\na3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAg\nICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHNtLmlzRGV0YWNoZWQoKSkgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNo\nIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNtLmJlZm9y\nZVJlZnJlc2godHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgCWlm\nIChsb2FkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIAkJbG9h\nZCA9IG5ldyBBcnJheUxpc3Qob2Jqcy5zaXplKCkpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9hZC5hZGQoc20pOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGludCBsZXZlbCA9\nIF9mYy5nZXRSZWFkTG9ja0xldmVsKCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGludCB0aW1lb3V0ID0gX2ZjLmdldExvY2tUaW1lb3V0KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZlbCwgdGltZW91\ndCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBzbS5y\nZWFkTG9ja2VkKGxldmVsLCBsZXZlbCk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lz\nRGV0YWNoZWQoKQogICAgICAgICAgICAgICAgICAgICAgICA9PSBCb29sZWFu\nLlRSVUUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFj\naGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\nICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJlZnJlc2gg\nYWxsCiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gX3N0b3JlLmxvYWRBbGwobG9h\nZCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBTdG9yZU1hbmFnZXIuRk9S\nQ0VfTE9BRF9SRUZSRVNILCBfZmMsIG51bGwpOwogICAgICAgICAgICAgICAg\naWYgKGZhaWxlZCAhPSBudWxsICYmICFmYWlsZWQuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIG5ld09iamVj\ndE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCkpOwoKICAgICAgICAgICAgICAg\nIC8vIHBlcmZvcm0gcG9zdC1yZWZyZXNoIHRyYW5zaXRpb25zIGFuZCBtYWtl\nIHN1cmUgYWxsIGZldGNoCiAgICAgICAgICAgICAgICAvLyBncm91cCBmaWVs\nZHMgYXJlIGxvYWRlZAogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBsb2FkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwg\nJiYgZmFpbGVkLmNvbnRhaW5zKHNtLmdldElkKCkpKQogICAgICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJSZWZyZXNoKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIG5vdyBpbnZva2UgcG9zdFJlZnJlc2ggb24gYWxs\nIHRoZSBpbnN0YW5jZXMKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChpdHIubmV4dCgpLCB0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiAhc20uaXNEZXRhY2hlZCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBzbS5nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5B\nRlRFUl9SRUZSRVNIKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0KICAgICAgICB0aHJvd05lc3Rl\nZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBPcHRpbWl6YXRpb24gZm9yIHNpbmdsZS1vYmplY3QgcmVmcmVzaC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVmcmVzaEludGVybmFsKE9i\namVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NB\ncmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIHNtLCBjYWxs\nKQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAw\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHNt\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNl\ncHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAgICAgICAgICAgICAgZWxzZSBp\nZiAoc20uYmVmb3JlUmVmcmVzaChmYWxzZSkpIHsKICAgICAgICAgICAgICAg\nICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywg\nbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHNtLmFm\ndGVyUmVmcmVzaCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgaW50IGxldmVsID0gX2ZjLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAg\nICAgICAgICAgIGludCB0aW1lb3V0ID0gX2ZjLmdldExvY2tUaW1lb3V0KCk7\nCiAgICAgICAgICAgICAgICBfbG0ubG9jayhzbSwgbGV2ZWwsIHRpbWVvdXQs\nIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQo\nbGV2ZWwsIGxldmVsKTsKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVF\ndmVudChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVsbCwKICAgICAgICAg\nICAgICAgICAgICBzbS5nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5B\nRlRFUl9SRUZSRVNIKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQ\nZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQogICAgICAg\nICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAKICAgIHB1YmxpYyB2\nb2lkIHJldHJpZXZlQWxsKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiBkZmdP\nbmx5LAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqcyA9PSBudWxsIHx8IG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgaWYgKG9ianMuc2l6ZSgpID09IDEpIHsKICAgICAg\nICAgICAgcmV0cmlldmUob2Jqcy5pdGVyYXRvcigpLm5leHQoKSwgZGZnT25s\neSwgY2FsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7\nCgogICAgICAgICAgICAvLyBjb2xsZWN0IGFsbCBob2xsb3cgaW5zdGFuY2Vz\nIGZvciBsb2FkCiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAg\nIENvbGxlY3Rpb24gbG9hZCA9IG51bGw7CiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc207CiAgICAgICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3\nIEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX1JFVFJJRVZFLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0\ncmlldmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVy\nc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbXMu\nYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzbS5n\nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkID0gbmV3IEFycmF5\nTGlzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQu\nYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFj\naGVkKCkKICAgICAgICAgICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVF\nKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4\nY2VwdGlvbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbG9hZCBhbGwgaG9sbG93\nIGluc3RhbmNlcwogICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IG51\nbGw7CiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGludCBtb2RlID0gKGRmZ09ubHkpID8gX3N0b3JlLkZPUkNFX0xP\nQURfREZHCiAgICAgICAgICAgICAgICAgICAgOiBfc3RvcmUuRk9SQ0VfTE9B\nRF9BTEw7CiAgICAgICAgICAgICAgICBmYWlsZWQgPSBfc3RvcmUubG9hZEFs\nbChsb2FkLCBudWxsLCBtb2RlLCBfZmMsIG51bGwpOwogICAgICAgICAgICAg\nICAgaWYgKGZhaWxlZCAhPSBudWxsICYmICFmYWlsZWQuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIG5ld09i\namVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCkpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyByZXRyaWV2ZSBhbGwgbm9uLWZhaWxlZCBpbnN0\nYW5jZXMKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzbXMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNt\nID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRhaW5zKHNt\nLmdldElkKCkpKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgIGludCBtb2RlID0gKGRmZ09ubHkpID8gU3RhdGVNYW5h\nZ2VySW1wbC5MT0FEX0ZHUwogICAgICAgICAgICAgICAgICAgIDogU3RhdGVN\nYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgc20uYmVmb3JlUmVhZCgtMSk7CiAgICAgICAg\nICAgICAgICAgICAgc20ubG9hZChfZmMsIG1vZGUsIG51bGwsIG51bGwsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCBrZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgICAgICB0aHJvd05lc3RlZEV4Y2Vw\ndGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncmV0cmlldmUoT2JqZWN0IG9iaiwgYm9vbGVhbiBkZmdPbmx5LCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBs\nKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50\nKE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZFLCBvYmosIHNtLCBjYWxsKQogICAg\nICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHNtICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24o\nb2JqLCAicmV0cmlldmUiKTsKICAgICAgICAgICAgICAgIGlmIChzbS5pc1Bl\ncnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgICAgIGludCBtb2RlID0g\nKGRmZ09ubHkpID8gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUwogICAgICAg\nICAgICAgICAgICAgICAgICA6IFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7\nCiAgICAgICAgICAgICAgICAgICAgc20uYmVmb3JlUmVhZCgtMSk7CiAgICAg\nICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIG1vZGUsIG51bGwsIG51bGws\nIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNl\nIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNo\nZWQoKQogICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0\ncmlldmUiKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBldmljdEFsbChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIC8vIGV2aWN0IGFsbCBQQ2xlYW4gYW5kIFBOb25UcmFucyBvYmpl\nY3RzCiAgICAgICAgICAgIENvbGxlY3Rpb24gYyA9IGdldE1hbmFnZWRTdGF0\nZXMoKTsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFn\nZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlz\nUGVyc2lzdGVudCgpICYmICFzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgICAg\nICAgICAgZXZpY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIGNhbGwpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgZXZpY3RBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgZXZpY3QoaXRyLm5leHQoKSwgY2FsbCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAg\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdEFsbChFeHRlbnQgZXh0ZW50LCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKGV4dGVudCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBldmljdCBh\nbGwgUENsZWFuIGFuZCBQTm9uVHJhbnMgb2JqZWN0cyBpbiBleHRlbnQKICAg\nICAgICAgICAgQ29sbGVjdGlvbiBjID0gZ2V0TWFuYWdlZFN0YXRlcygpOwog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBD\nbGFzcyBjbHM7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGlmIChzbS5pc1BlcnNpc3RlbnQoKSAmJiAhc20uaXNEaXJ0eSgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgY2xzID0gc20uZ2V0TWV0YURhdGEo\nKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGNscyA9PSBleHRlbnQuZ2V0RWxlbWVudFR5cGUoKQogICAgICAgICAgICAg\nICAgICAgICAgICB8fCAoZXh0ZW50Lmhhc1N1YmNsYXNzZXMoKQogICAgICAg\nICAgICAgICAgICAgICAgICAmJiBleHRlbnQuZ2V0RWxlbWVudFR5cGUoKS5p\nc0Fzc2lnbmFibGVGcm9tKGNscykpKQogICAgICAgICAgICAgICAgICAgICAg\nICBldmljdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgY2FsbCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZXZpY3QoT2JqZWN0IG9iaiwgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAg\naWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfRVZJQ1QsIG9i\naiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFD\nVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgc20uZXZpY3QoKTsKICAgICAgICAgICAgaWYgKF9ldmlj\ndERhdGFDYWNoZSAmJiBzbS5nZXRPYmplY3RJZCgpICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFEYXRh\nKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAgICAgICBpZiAoY2FjaGUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjYWNoZS5yZW1vdmUoc20u\nZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihy\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZGV0\nYWNoKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2Fs\nbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMs\nIGZhbHNlLCBjYWxsKS5kZXRhY2gob2JqKTsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0YWNoQWxsKENv\nbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlm\nIChvYmpzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVN\nUFRZX09CSkVDVFM7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAg\nICAgICAgY2FsbCA9IF9jYWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbmV3IERl\ndGFjaE1hbmFnZXIodGhpcywgZmFsc2UsIGNhbGwpLmRldGFjaEFsbChvYmpz\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBkZXRhY2hBbGwoT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGRl\ndGFjaEFsbChjYWxsLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBk\nZXRhY2hBbGwoT3BDYWxsYmFja3MgY2FsbCwgYm9vbGVhbiBmbHVzaCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIElmIGEgZmx1c2ggaXMgZGVzaXJlZCAoYmFzZWQgb24g\naW5wdXQgcGFybSksIHRoZW4gY2hlY2sgaWYgdGhlCiAgICAgICAgICAgIC8v\nICJkaXJ0eSIgZmxhZyBpcyBzZXQgYmVmb3JlIGNhbGxpbmcgZmx1c2goKS4K\nICAgICAgICAgICAgaWYgKGZsdXNoICYmIChfZmxhZ3MgJiBGTEFHX0ZMVVNI\nX1JFUVVJUkVEKSAhPSAwKQogICAgICAgICAgICAgICAgZmx1c2goKTsKICAg\nICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwoY2FsbCk7CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFs\nbEludGVybmFsKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBDb2xsZWN0\naW9uIHN0YXRlcyA9IGdldE1hbmFnZWRTdGF0ZXMoKTsKICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nc3RhdGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgIGlmICghc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAg\nICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKCFzbS5nZXRN\nZXRhRGF0YSgpLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBz\nbS5yZWxlYXNlKHRydWUpOwogICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZXMu\naXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChj\nYWxsID09IG51bGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsKICAgICAg\nICAvLyBNYWtlIHN1cmUgQUxMIGVudGl0aWVzIGFyZSBkZXRhY2hlZCwgZXZl\nbiBuZXcgb25lcyB0aGF0IGFyZSBsb2FkZWQKICAgICAgICAvLyBkdXJpbmcg\ndGhlIGRldGFjaCBwcm9jZXNzaW5nCiAgICAgICAgYm9vbGVhbiBvcmlnQ2Fz\nY2FkZSA9IF9jb21wYXQuZ2V0Q2FzY2FkZVdpdGhEZXRhY2goKTsKICAgICAg\nICBfY29tcGF0LnNldENhc2NhZGVXaXRoRGV0YWNoKHRydWUpOyAgICAgICAg\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbmV3IERldGFjaE1hbmFnZXIo\ndGhpcywgdHJ1ZSwgY2FsbCkKICAgICAgICAgICAgICAgIC5kZXRhY2hBbGwo\nbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHN0YXRlcykpOwogICAgICAg\nIH0gCiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIF9jb21wYXQuc2V0\nQ2FzY2FkZVdpdGhEZXRhY2gob3JpZ0Nhc2NhZGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGF0dGFjaChPYmplY3Qgb2JqLCBib29s\nZWFuIGNvcHlOZXcsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBtYWtlIHN1cmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sg\nb25seSBpZiB0aGlzIGZhaWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3Bl\ncmF0aW9uKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IEF0dGFjaE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCku\nYXR0YWNoKG9iaik7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wdGltaXN0aWNF\neGNlcHRpb24gb2UpIHsKICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25s\neShvZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBvZS5zZXRGYXRhbCh0cnVl\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3Rb\nXSBhdHRhY2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIGNvcHlOZXcs\nCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpz\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX09C\nSkVDVFM7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBub3QgdG8gdHJ5IHRv\nIHNldCByb2xsYmFjayBvbmx5IGlmIHRoaXMgZmFpbHMKICAgICAgICAgICAg\nYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNoTWFuYWdlcih0aGlzLCBj\nb3B5TmV3LCBjYWxsKS5hdHRhY2hBbGwob2Jqcyk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE9wdGltaXN0aWNFeGNlcHRpb24gb2UpIHsKICAgICAgICAgICAg\nICAgIHNldFJvbGxiYWNrT25seShvZSk7CiAgICAgICAgICAgICAgICB0aHJv\ndyBvZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIG5vbnRyYW5zYWN0aW9uYWxBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTGlzdCBl\neGNlcHMgPSBudWxsOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbm9udHJhbnNhY3Rp\nb25hbChpdHIubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBl\neGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25z\nKGV4Y2VwcywgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBub250cmFuc2FjdGlvbmFsKE9iamVjdCBvYmosIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAg\naWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTk9OVFJBTlNB\nQ1RJT05BTCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BD\nYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzbS5ub250cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHRoZSBnaXZlbiBpbnN0\nYW5jZXMgdHJhbnNhY3Rpb25hbC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\ndHJhbnNhY3Rpb25hbEFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gdXBk\nYXRlVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgaWYgKG9ianMuc2l6ZSgpID09IDEpIHsKICAgICAgICAgICAgdHJh\nbnNhY3Rpb25hbChvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCB1cGRhdGVWZXJz\naW9uLCBjYWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gY29sbGVjdCBhbGwgaG9sbG93IGluc3RhbmNlcyBmb3Ig\nbG9hZCwgYW5kIG1ha2UgdW5tYW5hbmdlZAogICAgICAgICAgICAvLyBpbnN0\nYW5jZXMgdHJhbnNpZW50LXRyYW5zYWN0aW9uYWwKICAgICAgICAgICAgQ29s\nbGVjdGlvbiBsb2FkID0gbnVsbDsKICAgICAgICAgICAgT2JqZWN0IG9iajsK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgICAgICBDb2xsZWN0aW9uIHNt\ncyA9IG5ldyBMaW5rZWRIYXNoU2V0KG9ianMuc2l6ZSgpKTsKICAgICAgICAg\nICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxi\nYWNrcy5PUF9UUkFOU0FDVElPTkFMLCBvYmosIHNtLAogICAgICAgICAgICAg\nICAgICAgICAgICBjYWxsKSAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBtYW5hZ2UgdHJhbnNpZW50IGluc3RhbmNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9z\naXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZ2V0TWV0YURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIsIHRydWUpOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2Vy\nSW1wbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKFN0YXRlTWFuYWdl\ncklkLm5ld0luc3RhbmNlKHRoaXMpLCBtZXRhLCB0aGlzKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShhc3NlcnRQZXJzaXN0ZW5j\nZUNhcGFibGUob2JqKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBD\nU3RhdGUuVENMRUFOKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtcy5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuSE9MTE9XKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkLmFkZChz\nbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNtLnNldENoZWNrVmVyc2lvbih0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHVwZGF0ZVZlcnNpb24pCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBzbS5zZXRVcGRhdGVWZXJzaW9uKHRydWUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSF9S\nRVFVSVJFRDsgLy8gdmVyc2lvbiBjaGVjay91cAogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNo\nIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhj\nZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBsb2FkIGFsbCBob2xsb3cgaW5z\ndGFuY2VzCiAgICAgICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gbnVsbDsK\nICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgZmFpbGVkID0gX3N0b3JlLmxvYWRBbGwobG9hZCwgbnVsbCwgX3N0b3Jl\nLkZPUkNFX0xPQURfTk9ORSwKICAgICAgICAgICAgICAgICAgICBfZmMsIG51\nbGwpOwogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmICFm\nYWlsZWQuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZChleGNlcHMsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld09iamVj\ndE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCkpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICB0cmFuc2FjdGlvbmFsU3RhdGVzQWxsKHNtcywgZmFpbGVk\nLCBleGNlcHMpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gaW5zdGFuY2VzIHRyYW5zYWN0\naW9uYWwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRyYW5zYWN0aW9uYWwo\nT2JqZWN0IG9iaiwgYm9vbGVhbiB1cGRhdGVWZXJzaW9uLAogICAgICAgIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAg\nICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfVFJB\nTlNBQ1RJT05BTCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYg\nT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmlzUGVy\nc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFu\nc2FjdGlvbigpOwogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25hbCgp\nOwogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlcklt\ncGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIHNtLnNldENoZWNrVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAg\nIGlmICh1cGRhdGVWZXJzaW9uKQogICAgICAgICAgICAgICAgICAgIHNtLnNl\ndFVwZGF0ZVZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19GTFVTSF9SRVFVSVJFRDsgLy8gdmVyc2lvbiBjaGVjay91cAog\nICAgICAgICAgICB9IGVsc2UgaWYgKHNtID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIC8vIG1hbmFnZSB0cmFuc2llbnQgaW5zdGFuY2UKICAgICAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nTWV0YURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIsIHRydWUpOwogICAg\nICAgICAgICAgICAgT2JqZWN0IGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5z\ndGFuY2UodGhpcyk7CiAgICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1h\nbmFnZXJJbXBsKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgICAgIHNt\nLmluaXRpYWxpemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiksCiAg\nICAgICAgICAgICAgICAgICAgUENTdGF0ZS5UQ0xFQU4pOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2gg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRyYW5zaXRpb24gdGhlIGdpdmVuIHN0YXRlIG1hbmFn\nZXJzIHRvIHRyYW5zYWN0aW9uYWwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB0cmFuc2FjdGlvbmFsU3RhdGVzQWxsKENvbGxlY3Rpb24gc21zLCBDb2xs\nZWN0aW9uIGZhaWxlZCwKICAgICAgICBMaXN0IGV4Y2VwcykgewogICAgICAg\nIC8vIG1ha2UgaW5zdGFuY2VzIHRyYW5zYWN0aW9uYWwgYW5kIG1ha2Ugc3Vy\nZSB0aGV5IGFyZSBsb2FkZWQKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFu\nYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChmYWlsZWQg\nIT0gbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAg\nICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywgbnVs\nbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCBrZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ndGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFeHRlbnQsIFF1ZXJ5CiAg\nICAvLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBFeHRlbnQgbmV3RXh0\nZW50KENsYXNzIHR5cGUsIGJvb2xlYW4gc3ViY2xhc3NlcykgewogICAgICAg\nIHJldHVybiBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3NlcywgbnVsbCk7CiAg\nICB9CgogICAgcHJpdmF0ZSBFeHRlbnQgbmV3RXh0ZW50KENsYXNzIHR5cGUs\nIGJvb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBFeHRlbnRJbXBsIGV4dGVudCA9IG5l\ndyBFeHRlbnRJbXBsKHRoaXMsIHR5cGUsIHN1YmNsYXNzZXMsIGZldGNoKTsK\nICAgICAgICAgICAgaWYgKF9leHRlbnRzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfZXh0ZW50cyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5j\nZUhhc2hTZXQuV0VBSyk7CiAgICAgICAgICAgIF9leHRlbnRzLmFkZChleHRl\nbnQpOwoKICAgICAgICAgICAgcmV0dXJuIGV4dGVudDsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgSXRlcmF0b3IgZXh0ZW50\nSXRlcmF0b3IoQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFzc2VzLAogICAg\nICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBpZ25vcmVD\naGFuZ2VzKSB7CiAgICAgICAgRXh0ZW50IGV4dGVudCA9IG5ld0V4dGVudCh0\neXBlLCBzdWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgZXh0ZW50LnNldEln\nbm9yZUNoYW5nZXMoaWdub3JlQ2hhbmdlcyk7CiAgICAgICAgcmV0dXJuIGV4\ndGVudC5pdGVyYXRvcigpOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeSBuZXdR\ndWVyeShTdHJpbmcgbGFuZywgQ2xhc3MgY2xzLCBPYmplY3QgcXVlcnkpIHsK\nICAgICAgICBRdWVyeSBxID0gbmV3UXVlcnkobGFuZywgcXVlcnkpOwogICAg\nICAgIHEuc2V0Q2FuZGlkYXRlVHlwZShjbHMsIHRydWUpOwogICAgICAgIHJl\ndHVybiBxOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeSBuZXdRdWVyeShTdHJp\nbmcgbGFuZywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgLy8gY29tbW9uIG1p\nc3Rha2VzCiAgICAgICAgaWYgKHF1ZXJ5IGluc3RhbmNlb2YgRXh0ZW50IHx8\nIHF1ZXJ5IGluc3RhbmNlb2YgQ2xhc3MpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbmV3LXF1ZXJ5IikpOwoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgU3RvcmVRdWVyeSBzcSA9IF9zdG9yZS5uZXdRdWVyeShs\nYW5nKTsKICAgICAgICAgICAgaWYgKHNxID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIEV4cHJlc3Npb25QYXJzZXIgZXAgPSBRdWVyeUxhbmd1YWdlcy5w\nYXJzZXJGb3JMYW5ndWFnZShsYW5nKTsKICAgICAgICAgICAgICAgIGlmIChl\ncCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNxID0gbmV3IEV4cHJl\nc3Npb25TdG9yZVF1ZXJ5KGVwKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfTUVUSE9EUUwuZXF1YWxzKGxhbmcpKQog\nICAgICAgICAgICAgICAgICAgIHNxID0gbmV3IE1ldGhvZFN0b3JlUXVlcnko\nKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24obGFuZyk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIFF1ZXJ5IHEgPSBuZXdRdWVyeUltcGwobGFu\nZywgc3EpOwogICAgICAgICAgICBxLnNldElnbm9yZUNoYW5nZXMoX2lnbm9y\nZUNoYW5nZXMpOwogICAgICAgICAgICBpZiAocXVlcnkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHEuc2V0UXVlcnkocXVlcnkpOwoKICAgICAgICAgICAg\nLy8gdHJhY2sgcXVlcmllcwogICAgICAgICAgICBpZiAoX3F1ZXJpZXMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9xdWVyaWVzID0gbmV3IFJlZmVyZW5j\nZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNldC5XRUFLKTsKICAgICAgICAgICAg\nX3F1ZXJpZXMuYWRkKHEpOwogICAgICAgICAgICByZXR1cm4gcTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBxdWVyeS4KICAgICAqLwogICAgcHJvdGVjdGVkIFF1ZXJ5SW1w\nbCBuZXdRdWVyeUltcGwoU3RyaW5nIGxhbmcsIFN0b3JlUXVlcnkgc3EpIHsK\nICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5SW1wbCh0aGlzLCBsYW5nLCBzcSk7\nCiAgICB9CgogICAgcHVibGljIFNlcSBnZXRJZGVudGl0eVNlcXVlbmNlKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBnZXRT\nZXF1ZW5jZShtZXRhLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU2VxIGdl\ndFZhbHVlU2VxdWVuY2UoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBp\nZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIHJldHVybiBnZXRTZXF1ZW5jZShmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0\nYSgpLCBmbWQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2Vx\ndWVuY2UgZm9yIHRoZSBnaXZlbiBjbGFzcyBhbmQgb3B0aW9uYWwgZmllbGQu\nCiAgICAgKi8KICAgIHByaXZhdGUgU2VxIGdldFNlcXVlbmNlKENsYXNzTWV0\nYURhdGEgbWV0YSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBn\nZXQgc2VxdWVuY2Ugc3RyYXRlZ3kgZnJvbSBtZXRhZGF0YQogICAgICAgIGlu\ndCBzdHJhdGVneTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAg\nICAgIHN0cmF0ZWd5ID0gbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5KCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzdHJhdGVneSA9IGZtZC5nZXRWYWx1\nZVN0cmF0ZWd5KCk7CgogICAgICAgIC8vIHdlIGNhbiBoYW5kbGUgbm9uLW5h\ndGl2ZSBzdHJhdGVnaWVzIHdpdGhvdXQgdGhlIHN0b3JlIG1hbmFnZXIKICAg\nICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7CiAgICAgICAgICAgIGNhc2UgVmFs\ndWVTdHJhdGVnaWVzLlVVSURfSEVYOgogICAgICAgICAgICAgICAgcmV0dXJu\nIFVVSURIZXhTZXEuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBW\nYWx1ZVN0cmF0ZWdpZXMuVVVJRF9TVFJJTkc6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gVVVJRFN0cmluZ1NlcS5nZXRJbnN0YW5jZSgpOwogICAgICAgICAg\nICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX1RZUEU0X0hFWDoKICAgICAg\nICAgICAgICAgIHJldHVybiBVVUlEVHlwZTRIZXhTZXEuZ2V0SW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9UWVBF\nNF9TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJRFR5cGU0U3Ry\naW5nU2VxLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVT\ndHJhdGVnaWVzLlNFUVVFTkNFOgogICAgICAgICAgICAgICAgU2VxdWVuY2VN\nZXRhRGF0YSBzbWQgPSAoZm1kID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgPyBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VNZXRhRGF0YSgpCiAgICAg\nICAgICAgICAgICAgICAgOiBmbWQuZ2V0VmFsdWVTZXF1ZW5jZU1ldGFEYXRh\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gc21kLmdldEluc3RhbmNlKF9s\nb2FkZXIpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\nLy8gdXNlIHN0b3JlIG1hbmFnZXIgZm9yIG5hdGl2ZSBzZXF1ZW5jZQogICAg\nICAgICAgICAgICAgaWYgKGZtZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiBhIHNlcXVlbmNlIGV2ZW4gZm9y\nIGFwcCBpZCBjbGFzc2VzLAogICAgICAgICAgICAgICAgICAgIC8vIHdoaWNo\nIGlzIHdoYXQgd2Ugd2FudCBmb3IgYmFja3dhcmRzLWNvbXBhdGliaWxpdHku\nCiAgICAgICAgICAgICAgICAgICAgLy8gRXZlbiBpZiB1c2VyIHVzZXMgQXBw\nbGljYXRpb24gSWRlbnRpdHksCiAgICAgICAgICAgICAgICAgICAgLy8gdXNl\nciBtaWdodCB1c2UgY3VzdG9tIHNlcXVlbmNlIGluZm9ybWF0aW9uLgogICAg\nICAgICAgICAgICAgICAgIC8vIFNvLCBmaXJzdCwgdGhlIHNlcXVlbmNlIHNo\nb3VsZCBiZSBjaGVja2VkLgogICAgICAgICAgICAgICAgICAgIC8vIFRyeWlu\nZyB0byBnZXQgcHJpbWFyeSBrZXkgZmllbGQgaWYgaXQgaGFzCiAgICAgICAg\nICAgICAgICAgICAgLy8gc2VxdWVuY2UgbWV0YSBkYXRhLgogICAgICAgICAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBtZXRhLmdldFByaW1h\ncnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtzICE9\nIG51bGwgJiYgcGtzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtZCA9IHBrc1swXS5nZXRWYWx1ZVNlcXVlbmNlTWV0YURhdGEo\nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICBzbWQgPSBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VNZXRh\nRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAgICAgaWYgKHNtZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBzbWQuZ2V0SW5zdGFuY2UoX2xvYWRlcik7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIF9zdG9yZS5nZXREYXRhU3RvcmVJZFNlcXVlbmNlKG1ldGEpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0VmFsdWVTZXF1ZW5jZShmbWQp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gTG9j\na2luZwogICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9i\namVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jq\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7IC8vIGhhdmUgdG8gc3luYyBvciBsb2NrIGxldmVs\nIGFsd2F5cyBOT05FCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9jayhv\nYmosIF9mYy5nZXRXcml0ZUxvY2tMZXZlbCgpLCBfZmMuZ2V0TG9ja1RpbWVv\ndXQoKSwgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGxvY2soT2JqZWN0IG9iaiwgaW50IGxldmVsLCBpbnQgdGltZW91dCwg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRBY3RpdmVU\ncmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAg\nICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTE9DSywg\nb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3Mu\nQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgaWYgKHNtID09IG51bGwgfHwgIXNtLmlzUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgX2xtLmxvY2so\nc20sIGxldmVsLCB0aW1lb3V0LCBudWxsKTsKICAgICAgICAgICAgc20ucmVh\nZExvY2tlZChsZXZlbCwgbGV2ZWwpOyAvLyB1c2Ugc2FtZSBsZXZlbCBmb3Ig\nZnV0dXJlIHdyaXRlCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7IC8vIGhhdmUgdG8gc3luYyBvciBsb2NrIGxldmVsIGFsd2F5cyBOT05F\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9ja0FsbChvYmpzLCBfZmMu\nZ2V0V3JpdGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0KCksCiAg\nICAgICAgICAgICAgICBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIGludCBsZXZl\nbCwgaW50IHRpbWVvdXQsCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAg\nIGxvY2sob2Jqcy5pdGVyYXRvcigpLm5leHQoKSwgbGV2ZWwsIHRpbWVvdXQs\nIGNhbGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAg\nQ29sbGVjdGlvbiBzbXMgPSBuZXcgTGlua2VkSGFzaFNldChvYmpzLnNpemUo\nKSk7CiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlm\nIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2Jq\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50\nKE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAg\nICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwgJiYgc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAg\nICAgICAgICAgc21zLmFkZChzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIF9sbS5sb2NrQWxsKHNtcywgbGV2ZWwsIHRpbWVvdXQsIG51bGwpOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVNYW5h\nZ2VySW1wbCkgaXRyLm5leHQoKSkucmVhZExvY2tlZChsZXZlbCwgbGV2ZWwp\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBDb25uZWN0aW9uCiAgICAvLy8vLy8vLy8vLy8vLwoK\nICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbEFsbCgpIHsKICAgICAgICAvLyB0\naGlzIG1ldGhvZCBkb2VzIG5vdCBsb2NrLCBzaW5jZSB3ZSB3YW50IHRvIGFs\nbG93IGEgZGlmZmVyZW50CiAgICAgICAgLy8gdGhyZWFkIHRvIGJlIGFibGUg\ndG8gY2FuY2VsIG9uIGEgbG9ja2VkLXVwIHBlcnNpc3RlbmNlIG1hbmFnZXIK\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIGlmIHdlJ3JlIGZsdXNoaW5nLCBoYXZlIHRvIHNldCByb2xsYmFj\nayBvbmx5IC0tIGRvIHRoaXMgYmVmb3JlIHdlCiAgICAgICAgICAgIC8vIGF0\ndGVtcHQgdG8gY2FuY2VsLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgY2FuY2Vs\nIG1pZ2h0IGNhc2UgdGhlCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uIHRv\nIGNvbXBsZXRlIGJlZm9yZSB3ZSBoYXZlIGEgY2hhbmNlIHRvIHNldCB0aGUK\nICAgICAgICAgICAgLy8gcm9sbGJhY2sgb25seSBmbGFnCiAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkKICAg\nICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKG5ldyBVc2Vy\nRXhjZXB0aW9uKCkpOwogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmNhbmNl\nbEFsbCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3Rv\ncmVFeGNlcHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRh\naW5zCiAgICAgICAgICAgIChfY29uZi5PUFRJT05fREFUQVNUT1JFX0NPTk5F\nQ1RJT04pKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNl\ncHRpb24oX2xvYy5nZXQoImNvbm4tbm90LXN1cHBvcnRlZCIpKTsKCiAgICAg\nICAgcmV0dXJuIF9zdG9yZS5nZXRDbGllbnRDb25uZWN0aW9uKCk7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaGFzQ29ubmVjdGlvbigpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFH\nX1JFVEFJTkVEX0NPTk4pICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\nZWxsIHN0b3JlIHRvIHJldGFpbiBjb25uZWN0aW9uIGlmIHdlIGhhdmVuJ3Qg\nYWxyZWFkeS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJldGFpbkNvbm5l\nY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVE\nX0NPTk4pID09IDApIHsKICAgICAgICAgICAgX3N0b3JlLnJldGFpbkNvbm5l\nY3Rpb24oKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVUQUlORURf\nQ09OTjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZWxsIHN0\nb3JlIHRvIHJlbGVhc2UgY29ubmVjdGlvbiBpZiB3ZSBoYXZlIHJldGFpbmVk\nIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbGVhc2VDb25uZWN0\naW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19SRVRBSU5FRF9D\nT05OKSAhPSAwKSB7CiAgICAgICAgICAgIF9zdG9yZS5yZWxlYXNlQ29ubmVj\ndGlvbigpOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUkVUQUlORURf\nQ09OTjsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vCiAgICAvLyBD\nYWNoZQogICAgLy8vLy8vLy8vCgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nTWFuYWdlZE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFu\nYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0TWFuYWdlZFN0YXRlcygpKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VHJh\nbnNhY3Rpb25hbE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0VHJhbnNhY3Rpb25hbFN0YXRl\ncygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rp\nb24gZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAgICAg\nICAgICAgICAgICAoZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxTdGF0ZXMoKSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdl\ndERpcnR5T2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxz\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYW5h\nZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXREaXJ0eVN0YXRlcygpKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0T3JkZXJEaXJ0\neU9iamVjdHMoKSB7CiAgICAgICAgcmV0dXJuIF9vcmRlckRpcnR5OwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldE9yZGVyRGlydHlPYmplY3RzKGJvb2xl\nYW4gb3JkZXIpIHsKICAgICAgICBfb3JkZXJEaXJ0eSA9IG9yZGVyOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgbWFuYWdl\nZCBzdGF0ZSBtYW5hZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxl\nY3Rpb24gZ2V0TWFuYWdlZFN0YXRlcygpIHsKICAgICAgICByZXR1cm4gX2Nh\nY2hlLmNvcHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNv\ncHkgb2YgYWxsIHRyYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldFRyYW5zYWN0aW9uYWxT\ndGF0ZXMoKSB7CiAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0\ncygpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VU\nOwogICAgICAgIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0aGVyZSBhcmUgYW55IHRy\nYW5zYWN0aW9uYWwgb2JqZWN0cyBpbiB0aGUgY3VycmVudAogICAgICogcGVy\nc2lzdGVuY2UgY29udGV4dC4gSWYgdGhlcmUgYXJlIGFueSBpbnN0YW5jZXMg\nd2l0aCB1bnRyYWNrZWQgc3RhdGUsCiAgICAgKiB0aGlzIG1ldGhvZCB3aWxs\nIGNhdXNlIHRob3NlIGluc3RhbmNlcyB0byBiZSBzY2FubmVkLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMo\nKSB7CiAgICAgICAgX2NhY2hlLmRpcnR5Q2hlY2soKTsKICAgICAgICByZXR1\ncm4gX3RyYW5zQ2FjaGUgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGNvcHkgb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJzLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXREaXJ0eVN0YXRl\ncygpIHsKICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkp\nCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7Cgog\nICAgICAgIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5RGlydHkoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIHN0YXRlIG1h\nbmFnZXJzIHdoaWNoIHdpbGwgYmVjb21lCiAgICAgKiB0cmFuc2FjdGlvbmFs\nIHVwb24gdGhlIG5leHQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBDb2xsZWN0aW9uIGdldFBlbmRpbmdUcmFuc2FjdGlvbmFsU3RhdGVz\nKCkgewogICAgICAgIGlmIChfcGVuZGluZyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAgIHJldHVy\nbiBuZXcgTGlua2VkSGFzaFNldChfcGVuZGluZyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgdGhlIGNhY2hlZCBTdGF0ZU1hbmFnZXIgZm9yIHRoZSBp\nbnN0YW5jZSB0aGF0IGhhZCB0aGUgZ2l2ZW4gb2lkLgogICAgICogVGhpcyBt\nZXRob2QgbXVzdCBub3QgYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIGZvciBu\nZXcgaW5zdGFuY2VzLgogICAgICoKICAgICAqIEBwYXJhbSBpZCB0aGUgaWQg\ncHJldmlvdXNseSB1c2VkIGJ5IHRoZSBpbnN0YW5jZQogICAgICogQHBhcmFt\nIHNtIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgaW5zdGFuY2U7IGlmIHRo\nZSBzdGF0ZQogICAgICogbWFuYWdlciBpcyB0cmFuc2llbnQsIHdlJ2xsIHN0\nb3AgbWFuYWdpbmcgdGhlIGluc3RhbmNlOwogICAgICogaWYgaXQgaGFzIHVw\nZGF0ZWQgaXRzIG9pZCwgd2UnbGwgcmUtY2FjaGUgdW5kZXIgdGhlIG5ldyBv\naWQKICAgICAqIEBwYXJhbSBzdGF0dXMgb25lIG9mIG91ciBTVEFUVVMgY29u\nc3RhbnRzIGRlc2NyaWJpbmcgd2h5IHdlJ3JlCiAgICAgKiBzZXR0aW5nIHRo\nZSBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHZvaWQgc2V0U3RhdGVNYW5h\nZ2VyKE9iamVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSwgaW50IHN0YXR1\ncykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBzd2l0Y2ggKHN0YXR1cykgewogICAgICAgICAgICAgICAgY2FzZSBTVEFU\nVVNfSU5JVDoKICAgICAgICAgICAgICAgICAgICBfY2FjaGUuYWRkKHNtKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgU1RBVFVTX1RSQU5TSUVOVDoKICAgICAgICAgICAgICAgICAgICBfY2Fj\naGUucmVtb3ZlKGlkLCBzbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFNUQVRVU19PSURfQVNTSUdOOgogICAg\nICAgICAgICAgICAgICAgIGFzc2lnbk9iamVjdElkKF9jYWNoZSwgaWQsIHNt\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgU1RBVFVTX0NPTU1JVF9ORVc6CiAgICAgICAgICAgICAgICAgICAg\nX2NhY2hlLmNvbW1pdE5ldyhpZCwgc20pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nTm90aWZ5IHRoZSBicm9rZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdl\nciBzaG91bGQKICAgICAqIGJlIGFkZGVkIHRvIHRoZSBzZXQgb2YgaW5zdGFu\nY2VzIGludm9sdmVkIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uLgogICAg\nICovCiAgICB2b2lkIGFkZFRvVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgIC8vIHdlIG9ubHkgYWRkIGNsZWFuIGluc3RhbmNl\ncyBub3c7IGRpcnR5IGluc3RhbmNlcyBhcmUgYWRkZWQgaW4KICAgICAgICAv\nLyB0aGUgc2V0RGlydHkgY2FsbGJhY2sKICAgICAgICBpZiAoc20uaXNEaXJ0\neSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxP\nYmplY3RzKCkpCiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5ldyBU\ncmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkpOwogICAgICAgICAgICBf\ndHJhbnNDYWNoZS5hZGRDbGVhbihzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyIHRoYXQg\ndGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSByZW1v\ndmVkIGZyb20gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4gdGhl\nIGN1cnJlbnQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgcmVtb3Zl\nRnJvbVRyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF90cmFu\nc0NhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICAvLyBpbnRlbnRpb25h\nbCBkaXJlY3QgYWNjZXNzOyB3ZSBkb24ndCB3YW50IHRvIHJlY29tcHV0ZQog\nICAgICAgICAgICAgICAgLy8gZGlydGluZXNzIHdoaWxlIHJlbW92aW5nIGlu\nc3RhbmNlcyBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9kZXJl\nZkNhY2hlICE9IG51bGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAg\nICAgICAgICAgX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgZ2l2ZW4g\naW5zdGFuY2UgaGFzIGJlZW4gZGlydGllZC4gVGhpcwogICAgICogbm90aWZp\nY2F0aW9uIGlzIGdpdmVuIHdoZW4gYW4gb2JqZWN0IGZpcnN0IHRyYW5zaXRp\nb25zIHRvIGEgZGlydHkgc3RhdGUsCiAgICAgKiBhbmQgZXZlcnkgdGltZSB0\naGUgb2JqZWN0IGlzIG1vZGlmaWVkIGJ5IHRoZSB1c2VyIHRoZXJlYWZ0ZXIu\nCiAgICAgKi8KICAgIHZvaWQgc2V0RGlydHkoU3RhdGVNYW5hZ2VySW1wbCBz\nbSwgYm9vbGVhbiBmaXJzdERpcnR5KSB7CiAgICAgICAgaWYgKHNtLmlzUGVy\nc2lzdGVudCgpKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSF9S\nRVFVSVJFRDsKCiAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYg\nIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoX3Nh\ndmVwb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUuYWRkKHNtKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaXJz\ndERpcnR5ICYmIHNtLmlzVHJhbnNhY3Rpb25hbCgpKSB7CiAgICAgICAgICAg\nIGxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8v\nIGNhY2hlIGRpcnR5IGluc3RhbmNlCiAgICAgICAgICAgICAgICBpZiAoIWhh\nc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAgICAgICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUgPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlKF9vcmRlckRp\ncnR5KTsKICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLmFkZERpcnR5KHNt\nKTsKCiAgICAgICAgICAgICAgICAvLyBhbHNvIHJlY29yZCB0aGF0IHRoZSBj\nbGFzcyBpcyBkaXJ0eQogICAgICAgICAgICAgICAgaWYgKHNtLmlzTmV3KCkp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX3BlcnNpc3RlZENsc3MgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3Mg\nPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0\nZWRDbHNzLmFkZChzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNtLmlzRGVsZXRlZCgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENsc3MgPSBu\nZXcgSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIF9kZWxldGVkQ2xz\ncy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoX3VwZGF0ZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIF91cGRhdGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAg\nICAgICAgICAgX3VwZGF0ZWRDbHNzLmFkZChzbS5nZXRNZXRhRGF0YSgpLmdl\ndERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgLy8gaWYgdHJhY2tpbmcgY2hhbmdlcyBhbmQgdGhpcyBpbnN0\nYW5jZSB3YXNuJ3QgYWxyZWFkeSBkaXJ0eSwKICAgICAgICAgICAgICAgIC8v\nIGFkZCB0byBjaGFuZ2VkIHNldDsgd2UgdXNlIHRoaXMgZm9yIGRldGVjdGlu\nZyBpbnN0YW5jZXMgdGhhdAogICAgICAgICAgICAgICAgLy8gZW50ZXIgdGhl\nIHRyYW5zYWN0aW9uIGR1cmluZyBwcmUgc3RvcmUKICAgICAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5HKSAhPSAwKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKF90cmFuc0FkZGl0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMgPSBuZXcg\nSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIF90cmFuc0FkZGl0aW9u\ncy5hZGQoc20pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhl\nIGJyb2tlciB0aGF0IHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAog\nICAgICogYmUgYWRkZWQgdG8gdGhlIHNldCBvZiBpbnN0YW5jZXMgdGhhdCB3\naWxsIGJlY29tZSB0cmFuc2FjdGlvbmFsCiAgICAgKiBvbiB0aGUgbmV4dCB0\ncmFuc2FjdGlvbgogICAgICovCiAgICB2b2lkIGFkZFRvUGVuZGluZ1RyYW5z\nYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9wZW5kaW5nID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfcGVuZGluZyA9IG5ldyBIYXNoU2V0KCk7\nCiAgICAgICAgICAgIF9wZW5kaW5nLmFkZChzbSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2Vy\nIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBi\nZSByZW1vdmVkIGZyb20gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQg\naW4gdGhlIG5leHQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgcmVt\nb3ZlRnJvbVBlbmRpbmdUcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmIChfcGVuZGluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3BlbmRp\nbmcucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hlICE9\nIG51bGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAg\nX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgYSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50IG9iamVjdCB0\nbyB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlcidzIGNhY2hlLgogICAgICogT24g\nZmx1c2gsIHRoZXNlIG9iamVjdHMgd2lsbCBiZSBkZWxldGVkLgogICAgICov\nCiAgICB2b2lkIGFkZERlcmVmZXJlbmNlZERlcGVuZGVudChTdGF0ZU1hbmFn\nZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIGlmIHdlJ3JlIGluIHRoZSBtaWRkbGUgb2YgZmx1c2gg\nYW5kIGludHJvZHVjaW5nIG1vcmUgZGVyZWZzCiAgICAgICAgICAgIC8vIHZp\nYSBpbnN0YW5jZSBjYWxsYmFja3MsIGFkZCB0aGVtIHRvIHRoZSBzcGVjaWFs\nIGFkZGl0aW9ucyBzZXQKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX0RFUkVGREVMRVRJTkcpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChf\nZGVyZWZBZGRpdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\nZGVyZWZBZGRpdGlvbnMgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICAg\nICAgX2RlcmVmQWRkaXRpb25zLmFkZChzbSk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZSA9IG5ldyBIYXNoU2V0\nKCk7CiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5hZGQoc20pOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgdGhlIGdpdmVuIHByZXZpb3VzbHkgZGVyZWZlcmVuY2VkIGRl\ncGVuZGVudCBvYmplY3QgZnJvbSB0aGUKICAgICAqIGNhY2hlLiBJdCBpcyBu\nb3cgcmVmZXJlbmNlZC4KICAgICAqLwogICAgdm9pZCByZW1vdmVEZXJlZmVy\nZW5jZWREZXBlbmRlbnQoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIHJl\nbW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKF9kZXJlZkFkZGl0aW9u\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmVtb3ZlZCA9IF9kZXJlZkFk\nZGl0aW9ucy5yZW1vdmUoc20pOwogICAgICAgICAgICBpZiAoIXJlbW92ZWQg\nJiYgKF9kZXJlZkNhY2hlID09IG51bGwgfHwgIV9kZXJlZkNhY2hlLnJlbW92\nZShzbSkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWRlcmVmZWQiLAogICAgICAgICAg\nICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcoc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCkpKSkuCiAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2Jq\nZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKS4KICAgICAgICAgICAgICAg\nICAgICBzZXRGYXRhbCh0cnVlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgZGlydHlUeXBlKENsYXNzIGNscykgewogICAgICAgIGlmIChjbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9w\nZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKF91cGRhdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3VwZGF0\nZWRDbHNzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3VwZGF0ZWRD\nbHNzLmFkZChjbHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nQ29sbGVjdGlvbiBnZXRQZXJzaXN0ZWRUeXBlcygpIHsKICAgICAgICBpZiAo\nX3BlcnNpc3RlZENsc3MgPT0gbnVsbCB8fCBfcGVyc2lzdGVkQ2xzcy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9T\nRVQ7CiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNv\nbGxlY3Rpb24oX3BlcnNpc3RlZENsc3MpOwogICAgfQoKICAgIHB1YmxpYyBD\nb2xsZWN0aW9uIGdldFVwZGF0ZWRUeXBlcygpIHsKICAgICAgICBpZiAoX3Vw\nZGF0ZWRDbHNzID09IG51bGwgfHwgX3VwZGF0ZWRDbHNzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlv\nbihfdXBkYXRlZENsc3MpOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9u\nIGdldERlbGV0ZWRUeXBlcygpIHsKICAgICAgICBpZiAoX2RlbGV0ZWRDbHNz\nID09IG51bGwgfHwgX2RlbGV0ZWRDbHNzLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICByZXR1\ncm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfZGVsZXRl\nZENsc3MpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAgICAvLyBDbG9zaW5n\nCiAgICAvLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2Vk\nKCkgewogICAgICAgIHJldHVybiBfY2xvc2VkOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzQ2xvc2VJbnZva2VkKCkgewogICAgICAgIHJldHVybiBf\nY2xvc2VkIHx8IChfZmxhZ3MgJiBGTEFHX0NMT1NFX0lOVk9LRUQpICE9IDA7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBjbG9zaW5nIGluIGFuIGFjdGl2\nZSBsb2NhbCB0cmFucwogICAgICAgICAgICBpZiAoIV9tYW5hZ2VkICYmIChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImFjdGl2\nZSIpKTsKCiAgICAgICAgICAgIC8vIG9ubHkgY2xvc2UgaWYgbm90IGFjdGl2\nZTsgaWYgYWN0aXZlIG1hbmFnZWQgdHJhbnMgd2FpdAogICAgICAgICAgICAv\nLyBmb3IgY29tcGxldGlvbgogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19D\nTE9TRV9JTlZPS0VEOwoKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGcmVlIHRoZSByZXNvdXJj\nZXMgdXNlZCBieSB0aGlzIHBlcnNpc3RlbmNlIG1hbmFnZXIuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGZyZWUoKSB7CiAgICAgICAgUnVudGltZUV4\nY2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgIGlmICgoX2F1dG9EZXRhY2gg\nJiBERVRBQ0hfQ0xPU0UpICE9IDApIHsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKF9jYWxsKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIF9zeW5jID0gbnVsbDsKICAgICAgICBfdXNlck9iamVjdHMgPSBu\ndWxsOwogICAgICAgIF9jYWNoZS5jbGVhcigpOwogICAgICAgIF90cmFuc0Nh\nY2hlID0gbnVsbDsKICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAg\nICAgICAgX3VwZGF0ZWRDbHNzID0gbnVsbDsKICAgICAgICBfZGVsZXRlZENs\nc3MgPSBudWxsOwogICAgICAgIF9kZXJlZkNhY2hlID0gbnVsbDsKICAgICAg\nICBfcGVuZGluZyA9IG51bGw7CiAgICAgICAgX2xvYWRlciA9IG51bGw7CiAg\nICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbnVsbDsKICAgICAgICBfbGlm\nZUV2ZW50TWFuYWdlciA9IG51bGw7CgogICAgICAgIE9wZW5KUEFTYXZlcG9p\nbnQgc2F2ZTsKICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMgIT0gbnVsbCAm\nJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHNhdmUg\nPQogICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9p\nbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAgICAg\nICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgX3Nh\ndmVwb2ludHMgPSBudWxsOwogICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9IG51\nbGw7CgogICAgICAgIGlmIChfcXVlcmllcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3F1ZXJpZXMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgKChRdWVyeSkgaXRyLm5leHQoKSkuY2xvc2VSZXNv\ndXJjZXMoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICBfcXVlcmllcyA9IG51bGw7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoX2V4dGVudHMgIT0gbnVsbCkgewogICAgICAgICAgICBFeHRlbnQg\nZTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZXh0ZW50cy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nZSA9IChFeHRlbnQpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIGUuY2xvc2VBbGwoKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfZXh0ZW50\ncyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB0cnkgeyByZWxlYXNlQ29u\nbmVjdGlvbigpOyB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7fQoK\nICAgICAgICBfbG0uY2xvc2UoKTsKICAgICAgICBfc3RvcmUuY2xvc2UoKTsK\nICAgICAgICBfZmxhZ3MgPSAwOwogICAgICAgIF9jbG9zZWQgPSB0cnVlOwog\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nIF9jbG9zZWRFeGNlcHRpb24gPSBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9u\nKCk7CgogICAgICAgIF9mYWN0b3J5LnJlbGVhc2VCcm9rZXIodGhpcyk7Cgog\nICAgICAgIGlmIChlcnIgIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgZXJy\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFN5bmNo\ncm9uaXphdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1Ymxp\nYyB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9IG51bGwpIAog\nICAgICAgICAgICBfbG9jay5sb2NrKCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgdW5sb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQogICAg\nICAgICAgICBfbG9jay51bmxvY2soKTsKICAgIH0KICAgIAogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KICAgIC8vIFN0YXRlIG1hbmFnZW1lbnQKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBuZXdJbnN0\nYW5jZShDbGFzcyBjbHMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAg\nICAgIGlmICghY2xzLmlzSW50ZXJmYWNlKCkgJiYgTW9kaWZpZXIuaXNBYnN0\ncmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oX2xvYy5nZXQKICAg\nICAgICAgICAgICAgICgibmV3LWFic3RyYWN0IiwgY2xzKS5nZXRNZXNzYWdl\nKCkpOwoKICAgICAgICAvLyAxLjUgZG9lc24ndCBpbml0aWFsaXplIGNsYXNz\nZXMgd2l0aG91dCBhIHRydWUgQ2xhc3MuZm9yTmFtZQogICAgICAgIGlmICgh\nUENSZWdpc3RyeS5pc1JlZ2lzdGVyZWQoY2xzKSkgewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZShjbHMuZ2V0TmFt\nZSgpLCB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY2xzKSkpOwogICAg\nICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAoX2NvbmYuZ2V0TWV0YURhdGFSZXBv\nc2l0b3J5SW5zdGFuY2UoKS5nZXRNZXRhRGF0YShjbHMsCiAgICAgICAgICAg\nIGdldENsYXNzTG9hZGVyKCksIGZhbHNlKSA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKAogICAgICAg\nICAgICAgICAgX2xvYy5nZXQoIm5vLWludGVyZmFjZS1tZXRhZGF0YSIsIGNs\ncy5nZXROYW1lKCkpLmdldE1lc3NhZ2UoKSk7CgogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHJldHVybiBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKGNscywg\nbnVsbCwgZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxTdGF0ZUV4\nY2VwdGlvbiBpc2UpIHsKICAgICAgICAgICAgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uIGlhZSA9CiAgICAgICAgICAgICAgICBuZXcgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uKGlzZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBp\nYWUuc2V0U3RhY2tUcmFjZShpc2UuZ2V0U3RhY2tUcmFjZSgpKTsKICAgICAg\nICAgICAgdGhyb3cgaWFlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGdldE9iamVjdElkKE9iamVjdCBvYmopIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxl\nKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNp\nc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkKICAgICAgICAgICAgICAgIC5w\nY0ZldGNoT2JqZWN0SWQoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGdldExvY2tMZXZlbChPYmplY3QgbykgewogICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAobyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gTG9ja0xldmVscy5MT0NLX05PTkU7CgogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBnZXRTdGF0ZU1hbmFnZXIobyk7\nCiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBM\nb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKICAgICAgICByZXR1cm4gZ2V0TG9ja01h\nbmFnZXIoKS5nZXRMb2NrTGV2ZWwoc20pOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZ2V0VmVyc2lvbihPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\nYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0\nZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjR2V0VmVyc2lvbigpOwogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nRGlydHkoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkgewogICAg\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVscGVyLnRv\nUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOwogICAgICAgICAgICBy\nZXR1cm4gcGMucGNJc0RpcnR5KCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1RyYW5zYWN0\naW9uYWwoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAg\nICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxl\nKG9iaiwgX2NvbmYpKQogICAgICAgICAgICAgICAgLnBjSXNUcmFuc2FjdGlv\nbmFsKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzUGVyc2lzdGVudChPYmplY3Qgb2JqKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdl\nYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9Q\nZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLgogICAgICAgICAgICAg\nICAgICAgIHBjSXNQZXJzaXN0ZW50KCk7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTmV3KE9iamVjdCBvYmop\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxw\nZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1w\nbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNJ\nc05ldygpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0RlbGV0ZWQoT2JqZWN0IG9iaikgewogICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFi\nbGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVy\nc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0lzRGVsZXRlZCgpOwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0RldGFjaGVkKE9iamVjdCBvYmopIHsKICAgICAgICBpZiAoIShJbXBs\nSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBs\nSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOwogICAg\nICAgIEJvb2xlYW4gZGV0YWNoZWQgPSBwYy5wY0lzRGV0YWNoZWQoKTsKICAg\nICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGRldGFjaGVkLmJvb2xlYW5WYWx1ZSgpOwoKICAgICAgICAvLyBsYXN0IHJl\nc29ydDogaW5zdGFuY2UgaXMgZGV0YWNoZWQgaWYgaXQgaGFzIGEgc3RvcmUg\ncmVjb3JkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0\nTWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0\nTWV0YURhdGEoSW1wbEhlbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UocGMpLmdl\ndENsYXNzKCksCiAgICAgICAgICAgICAgICBfbG9hZGVyLCB0cnVlKTsKICAg\nICAgICBPYmplY3Qgb2lkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKHBjLCBt\nZXRhKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gZmluZChvaWQsIG51bGwsIEVY\nQ0xVREVfQUxMLCBudWxsLCAwKSAhPSBudWxsOwogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGdldFN0YXRlTWFuYWdlcihPYmplY3Qg\nb2JqKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2UpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2\nZW4gaW5zdGFuY2UsIG9yIG51bGwuCiAgICAgKgogICAgICogQHBhcmFtIGFz\nc2VydFRoaXNDb250ZXh0IGlmIHRydWUsIHRob3cgYW4gZXhjZXB0aW9uIGlm\nIHRoZSBnaXZlbgogICAgICogb2JqZWN0IGlzIG1hbmFnZWQgYnkgYW5vdGhl\nciBicm9rZXIKICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlcklt\ncGwgZ2V0U3RhdGVNYW5hZ2VySW1wbChPYmplY3Qgb2JqLAogICAgICAgIGJv\nb2xlYW4gYXNzZXJ0VGhpc0NvbnRleHQpIHsKICAgICAgICBpZiAoSW1wbEhl\nbHBlci5pc01hbmFnZWFibGUob2JqKSkgewogICAgICAgICAgICBQZXJzaXN0\nZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBh\nYmxlKG9iaiwgX2NvbmYpOwogICAgICAgICAgICBpZiAocGMucGNHZXRHZW5l\ncmljQ29udGV4dCgpID09IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4g\nKFN0YXRlTWFuYWdlckltcGwpIHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAg\nICAgICAgICAgIGlmIChhc3NlcnRUaGlzQ29udGV4dCAmJiBwYy5wY0dldEdl\nbmVyaWNDb250ZXh0KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtbWFuYWdlZCIsCiAg\nICAgICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSku\nc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGF0\nZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gb2lkLgogICAgICoKICAgICAqIEBw\nYXJhbSBhbGxvd05ldyBpZiB0cnVlLCBvYmplY3RzIG1hZGUgcGVyc2lzdGVu\ndCBpbiB0aGUgY3VycmVudAogICAgICogdHJhbnNhY3Rpb24gd2lsbCBiZSBp\nbmNsdWRlZCBpbiB0aGUgc2VhcmNoOyBpZgogICAgICogbXVsdGlwbGUgbmV3\nIG9iamVjdHMgbWF0Y2ggdGhlIGdpdmVuIG9pZCwgaXQgaXMKICAgICAqIHVu\nZGVmaW5lZCB3aGljaCB3aWxsIGJlIHJldHVybmVkCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGdldFN0YXRlTWFuYWdlckltcGxC\neUlkKE9iamVjdCBvaWQsCiAgICAgICAgYm9vbGVhbiBhbGxvd05ldykgewog\nICAgICAgIHJldHVybiBfY2FjaGUuZ2V0QnlJZChvaWQsIGFsbG93TmV3KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZ2l2ZW4gaW5zdGFu\nY2UgYXMgYSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlfS4KICAgICAqIElm\nIHRoZSBpbnN0YW5jZSBpcyBub3QgbWFuYWdlYWJsZSB0aHJvdyB0aGUgcHJv\ncGVyIGV4Y2VwdGlvbi4KICAgICAqLwogICAgcHJvdGVjdGVkIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUoT2JqZWN0IG9i\naikgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxl\nKG9iaikpCiAgICAgICAgICAgIHJldHVybiBJbXBsSGVscGVyLnRvUGVyc2lz\ndGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOwoKICAgICAgICAvLyBjaGVjayBm\nb3IgZGlmZmVyZW50IGluc3RhbmNlcyBvZiB0aGUgUGVyc2lzdGVuY2VDYXBh\nYmxlIGludGVyZmFjZQogICAgICAgIC8vIGFuZCB0aHJvdyBhIGJldHRlciBl\ncnJvciB0aGF0IG1lbnRpb25zIHRoZSBjbGFzcyBsb2FkZXJzCiAgICAgICAg\nQ2xhc3NbXSBpbnRmcyA9IG9iai5nZXRDbGFzcygpLmdldEludGVyZmFjZXMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW50ZnMgIT0gbnVsbCAmJiBp\nIDwgaW50ZnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGludGZz\nW2ldLmdldE5hbWUoKS5lcXVhbHMoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNz\nLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYy1sb2FkZXItZGlmZmVyZW50IiwKICAg\nICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaiksCiAg\nICAgICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdl\ndENsYXNzTG9hZGVyQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzKSksCiAgICAgICAgICAgICAg\nICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVy\nQWN0aW9uKGludGZzW2ldKSkpKQogICAgICAgICAgICAgICAgICAgIC5zZXRG\nYWlsZWRPYmplY3Qob2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gbm90IGVuaGFuY2VkCiAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoInBjLWNhc3QiLAogICAgICAgICAgICBFeGNl\ncHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8KICAgIC8vIFV0aWxzCiAgICAvLy8vLy8v\nLy8KICAgIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBj\nb250ZXh0IGlzIGNsb3NlZC4gIFRoZSBleGFjdCBtZXNzYWdlIGFuZAogICAg\nICogY29udGVudCBvZiB0aGUgZXhjZXB0aW9uIHZhcmllcyB3aGV0aGVyIFRS\nQUNFIGlzIGVuYWJsZWQgb3Igbm90LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBhc3NlcnRPcGVuKCkgewogICAgICAgIGlmIChfY2xvc2VkKSB7CiAgICAg\nICAgICAgIGlmIChfY2xvc2VkRXhjZXB0aW9uID09IG51bGwpICAvLyBUUkFD\nRSBub3QgZW5hYmxlZAogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiY2xvc2VkLW5vdHJhY2UiKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgLnNldEZhdGFsKHRydWUpOwogICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFFeGNlcHRp\nb24gZSA9IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAg\nICAgICAgICAgX2xvYy5nZXQoImNsb3NlZCIpLCBfY2xvc2VkRXhjZXB0aW9u\nKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgICAgIGUuc2V0Q2F1c2Uo\nX2Nsb3NlZEV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICB0aHJvdyBlOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCkgewogICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgIHRocm93IG5l\ndyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0aXZl\nIikpOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgZXhjZXB0aW9uIGlm\nIGEgdHJhbnNhY3Rpb24tcmVsYXRlZCBvcGVyYXRpb24gaXMgYXR0ZW1wdGVk\nIGFuZAogICAgICogbm8gdHJhbnNhY3Rpb24gaXMgYWN0aXZlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24o\nKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgibm90LWFjdGl2ZSIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwICYmICFfbm9udHJhbnNSZWFk\nKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBhc3NlcnRXcml0ZU9wZXJhdGlvbigpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwICYmICghX25vbnRyYW5zV3Jp\ndGUKICAgICAgICAgICAgfHwgKF9hdXRvRGV0YWNoICYgREVUQUNIX05PTlRY\nUkVBRCkgIT0gMCkpCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0\naW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJ3cml0ZS1vcGVyYXRpb24iKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gb2JqZWN0IG5vdCBmb3Vu\nZCBleGNlcHRpb24gY29udGFpbmluZyBuZXN0ZWQgZXhjZXB0aW9ucwogICAg\nICogZm9yIGFsbCBvZiB0aGUgZ2l2ZW4gZmFpbGVkIG9iamVjdHMuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdE5vdEZvdW5kRXhjZXB0aW9u\nIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0aW9uCiAgICAgICAgKENvbGxlY3Rp\nb24gZmFpbGVkKSB7CiAgICAgICAgVGhyb3dhYmxlW10gdCA9IG5ldyBUaHJv\nd2FibGVbZmFpbGVkLnNpemUoKV07CiAgICAgICAgaW50IGlkeCA9IDA7CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTsgaWR4KyspCiAgICAgICAgICAgIHRbaWR4XSA9IG5l\ndyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihpdHIubmV4dCgpKTsKICAgICAg\nICByZXR1cm4gbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCwg\ndCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIEZpbmRDYWxsYmFja3MgaW1wbGVtZW50YXRpb24KICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9i\namVjdCBwcm9jZXNzQXJndW1lbnQoT2JqZWN0IG9pZCkgewogICAgICAgIHJl\ndHVybiBvaWQ7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBwcm9jZXNzUmV0\ndXJuKE9iamVjdCBvaWQsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAg\nICAgICByZXR1cm4gKHNtID09IG51bGwpID8gbnVsbCA6IHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB3cml0ZU9i\namVjdChPYmplY3RPdXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzQWN0aXZlKCkpIHsKICAg\nICAgICAgICAgICAgIGlmICghZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJjYW50LXNlcmlhbGl6\nZS1wZXNzaW1pc3RpYy1icm9rZXIiKSk7CiAgICAgICAgICAgICAgICBpZiAo\naGFzRmx1c2hlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAg\nIF9sb2MuZ2V0KCJjYW50LXNlcmlhbGl6ZS1mbHVzaGVkLWJyb2tlciIpKTsK\nICAgICAgICAgICAgICAgIGlmIChoYXNDb25uZWN0aW9uKCkpCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoImNhbnQtc2VyaWFs\naXplLWNvbm5lY3RlZC1icm9rZXIiKSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfaXNTZXJpYWxpemluZyA9\nIHRydWU7CiAgICAgICAgICAgICAgICBvdXQud3JpdGVPYmplY3QoX2ZhY3Rv\ncnkuZ2V0UG9vbEtleSgpKTsKICAgICAgICAgICAgICAgIG91dC5kZWZhdWx0\nV3JpdGVPYmplY3QoKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIF9pc1NlcmlhbGl6aW5nID0gZmFsc2U7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlYWRPYmplY3Qo\nT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAgICAgdGhyb3dzIENsYXNzTm90\nRm91bmRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3Qg\nZmFjdG9yeUtleSA9IGluLnJlYWRPYmplY3QoKTsKICAgICAgICBBYnN0cmFj\ndEJyb2tlckZhY3RvcnkgZmFjdG9yeSA9CiAgICAgICAgICAgIEFic3RyYWN0\nQnJva2VyRmFjdG9yeS5nZXRQb29sZWRGYWN0b3J5Rm9yS2V5KGZhY3RvcnlL\nZXkpOwoKICAgICAgICAvLyB0aGlzIG5lZWRzIHRvIGhhcHBlbiBiZWZvcmUg\nZGVmYXVsdFJlYWRPYmplY3Qgc28gdGhhdCBpdCdzCiAgICAgICAgLy8gYXZh\naWxhYmxlIGZvciBjYWxscyB0byBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigp\nIGR1cmluZwogICAgICAgIC8vIFN0YXRlTWFuYWdlciBkZXNlcmlhbGl6YXRp\nb24KICAgICAgICBfY29uZiA9IGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigp\nOwogICAgICAgIAogICAgICAgIGluLmRlZmF1bHRSZWFkT2JqZWN0KCk7CiAg\nICAgICAgZmFjdG9yeS5pbml0aWFsaXplQnJva2VyKF9tYW5hZ2VkLCBfY29u\nblJldGFpbk1vZGUsIHRoaXMsIHRydWUpOwoKICAgICAgICAvLyByZS1pbml0\naWFsaXplIHRoZSBsb2NrIGlmIG5lZWRlZC4KICAgICAgICBzZXRNdWx0aXRo\ncmVhZGVkKF9tdWx0aXRocmVhZGVkKTsKCiAgICAgICAgaWYgKGlzQWN0aXZl\nKCkgJiYgX3J1bnRpbWUgaW5zdGFuY2VvZiBMb2NhbE1hbmFnZWRSdW50aW1l\nKQogICAgICAgICAgICAoKExvY2FsTWFuYWdlZFJ1bnRpbWUpIF9ydW50aW1l\nKS5iZWdpbigpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBvciBu\nb3QgdGhpcyBicm9rZXIgaXMgaW4gdGhlIG1pZHN0IG9mIGJlaW5nIHNlcmlh\nbGl6ZWQuCiAgICAgKgogICAgICogQHNpbmNlIDEuMS4wIAogICAgICovCiAg\nICBib29sZWFuIGlzU2VyaWFsaXppbmcoKSB7CiAgICAgICAgcmV0dXJuIF9p\nc1NlcmlhbGl6aW5nOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNhY3Rp\nb25hbCBjYWNoZSB0aGF0IGhvbGRzIHNvZnQgcmVmcyB0byBjbGVhbiBpbnN0\nYW5jZXMuCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBUcmFuc2FjdGlvbmFs\nQ2FjaGUKICAgICAgICBpbXBsZW1lbnRzIFNldCwgU2VyaWFsaXphYmxlIHsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9vcmRlckRpcnR5Owog\nICAgICAgIHByaXZhdGUgU2V0IF9kaXJ0eSA9IG51bGw7CiAgICAgICAgcHJp\ndmF0ZSBTZXQgX2NsZWFuID0gbnVsbDsKCiAgICAgICAgcHVibGljIFRyYW5z\nYWN0aW9uYWxDYWNoZShib29sZWFuIG9yZGVyRGlydHkpIHsKICAgICAgICAg\nICAgX29yZGVyRGlydHkgPSBvcmRlckRpcnR5OwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNh\nY3Rpb25hbCBzdGF0ZSBtYW5hZ2Vycy4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgQ29sbGVjdGlvbiBjb3B5KCkgewogICAgICAgICAgICBpZiAoaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVN\nUFRZX1NFVDsKCiAgICAgICAgICAgIC8vIHNpemUgbWF5IG5vdCBiZSBlbnRp\ncmVseSBhY2N1cmF0ZSBkdWUgdG8gcmVmcyBleHBpcmluZywgc28KICAgICAg\nICAgICAgLy8gbWFudWFsbHkgY29weSBlYWNoIG9iamVjdDsgZG9lc24ndCBt\nYXR0ZXIgdGhpcyB3YXkgaWYgc2l6ZSB0b28KICAgICAgICAgICAgLy8gYmln\nIGJ5IHNvbWUKICAgICAgICAgICAgU2V0IGNvcHkgPSBuZXcgTGlua2VkSGFz\naFNldChzaXplKCkpOwogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9kaXJ0eS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAg\nICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAgICAgICAgaWYgKF9jbGVh\nbiAhPSBudWxsKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBfY2xlYW4uaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAg\nICAgICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAg\nIHJldHVybiBjb3B5OwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmV0dXJuIGEgY29weSBvZiBhbGwgZGlydHkgc3RhdGUgbWFuYWdlcnMu\nCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24gY29weURp\ncnR5KCkgewogICAgICAgICAgICBpZiAoX2RpcnR5ID09IG51bGwgfHwgX2Rp\ncnR5LmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0\naW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGlua2Vk\nSGFzaFNldChfZGlydHkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogVHJhbnNmZXIgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gdGhlIGRp\ncnR5IGNhY2hlIHRvIHRoZSBjbGVhbiBjYWNoZS4KICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgdm9pZCBmbHVzaGVkKFN0YXRlTWFuYWdlckltcGwgc20p\nIHsKICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSAmJiBfZGlydHkgIT0g\nbnVsbCAmJiBfZGlydHkucmVtb3ZlKHNtKSkKICAgICAgICAgICAgICAgIGFk\nZENsZWFuSW50ZXJuYWwoc20pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogQWRkIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGUgY2xlYW4g\nY2FjaGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkQ2xl\nYW4oU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoYWRk\nQ2xlYW5JbnRlcm5hbChzbSkgJiYgX2RpcnR5ICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBfZGlydHkucmVtb3ZlKHNtKTsKICAgICAgICB9CgogICAgICAg\nIHByaXZhdGUgYm9vbGVhbiBhZGRDbGVhbkludGVybmFsKFN0YXRlTWFuYWdl\nckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKF9jbGVhbiA9PSBudWxsKQog\nICAgICAgICAgICAgICAgX2NsZWFuID0gbmV3IFJlZmVyZW5jZUhhc2hTZXQo\nUmVmZXJlbmNlSGFzaFNldC5TT0ZUKTsKICAgICAgICAgICAgcmV0dXJuIF9j\nbGVhbi5hZGQoc20pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogQWRkIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGUgZGlydHkgY2FjaGUu\nCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkRGlydHkoU3Rh\ndGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoX2RpcnR5ID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfb3JkZXJEaXJ0eSkKICAg\nICAgICAgICAgICAgICAgICBfZGlydHkgPSBNYXBCYWNrZWRTZXQuZGVjb3Jh\ndGUobmV3IExpbmtlZE1hcCgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICBfZGlydHkgPSBuZXcgSGFzaFNldCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChfZGlydHkuYWRkKHNtKSkKICAg\nICAgICAgICAgICAgIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20pOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVtb3ZlIHRoZSBnaXZlbiBp\nbnN0YW5jZSBmcm9tIHRoZSBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgYm9vbGVhbiByZW1vdmUoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewog\nICAgICAgICAgICByZXR1cm4gcmVtb3ZlQ2xlYW5JbnRlcm5hbChzbSkKICAg\nICAgICAgICAgICAgIHx8IChfZGlydHkgIT0gbnVsbCAmJiBfZGlydHkucmVt\nb3ZlKHNtKSk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGJvb2xlYW4g\ncmVtb3ZlQ2xlYW5JbnRlcm5hbChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAg\nICAgICAgICAgIHJldHVybiBfY2xlYW4gIT0gbnVsbCAmJiBfY2xlYW4ucmVt\nb3ZlKHNtKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBp\ndGVyYXRvcigpIHsKICAgICAgICAgICAgSXRlcmF0b3JDaGFpbiBjaGFpbiA9\nIG5ldyBJdGVyYXRvckNoYWluKCk7CiAgICAgICAgICAgIGlmIChfZGlydHkg\nIT0gbnVsbCAmJiAhX2RpcnR5LmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nIGNoYWluLmFkZEl0ZXJhdG9yKF9kaXJ0eS5pdGVyYXRvcigpKTsKICAgICAg\nICAgICAgaWYgKF9jbGVhbiAhPSBudWxsICYmICFfY2xlYW4uaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgY2hhaW4uYWRkSXRlcmF0b3IoX2NsZWFuLml0\nZXJhdG9yKCkpOwogICAgICAgICAgICByZXR1cm4gY2hhaW47CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3Qgb2Jq\nKSB7CiAgICAgICAgICAgIHJldHVybiAoX2RpcnR5ICE9IG51bGwgJiYgX2Rp\ncnR5LmNvbnRhaW5zKG9iaikpCiAgICAgICAgICAgICAgICB8fCAoX2NsZWFu\nICE9IG51bGwgJiYgX2NsZWFuLmNvbnRhaW5zKG9iaikpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNBbGwoQ29sbGVjdGlv\nbiBjb2xsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29s\nbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nIGlmICghY29udGFpbnMoaXRyLm5leHQoKSkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAg\nICAgICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGly\ndHkgPSBudWxsOwogICAgICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfY2xlYW4gPSBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgJiYgKF9jbGVhbiA9PSBudWxsIHx8IF9jbGVhbi5pc0Vt\ncHR5KCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkg\newogICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAgICAgICAgIGlmIChf\nZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0gX2RpcnR5\nLnNpemUoKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgc2l6ZSArPSBfY2xlYW4uc2l6ZSgpOwogICAgICAgICAg\nICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGFkZChPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKENvbGxlY3Rpb24gY29sbCkg\newogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25F\neGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIHJlbW92ZShPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlQWxsKENvbGxlY3Rpb24gY29s\nbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRp\nb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0\naW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9B\ncnJheShPYmplY3RbXSBhcnIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVW5pcXVlIGlkIGZvciBzdGF0ZSBtYW5hZ2Vy\ncyBvZiBuZXcgZGF0YXN0b3JlIGluc3RhbmNlcyB3aXRob3V0IGFzc2lnbmVk\nCiAgICAgKiBvYmplY3QgaWRzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBjbGFzcyBTdGF0ZU1hbmFnZXJJZAogICAgICAgIGltcGxlbWVudHMgU2Vy\naWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU1RSSU5HX1BSRUZJWCA9ICJvcGVuanBhc206IjsKCiAgICAgICAgcHJp\ndmF0ZSBzdGF0aWMgbG9uZyBfZ2VuZXJhdG9yID0gMDsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBpbnQgX2JoYXNoOwogICAgICAgIHByaXZhdGUgZmluYWwg\nbG9uZyBfaWQ7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgU3RhdGVNYW5hZ2Vy\nSWQgbmV3SW5zdGFuY2UoQnJva2VyIGIpIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTdGF0ZU1hbmFnZXJJZChTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZShi\nKSwgX2dlbmVyYXRvcisrKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\nU3RhdGVNYW5hZ2VySWQoaW50IGJoYXNoLCBsb25nIGlkKSB7CiAgICAgICAg\nICAgIF9iaGFzaCA9IGJoYXNoOwogICAgICAgICAgICBfaWQgPSBpZDsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdGF0ZU1hbmFnZXJJZChTdHJpbmcg\nc3RyKSB7CiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoU1RSSU5H\nX1BSRUZJWC5sZW5ndGgoKSk7CiAgICAgICAgICAgIGludCBpZHggPSBzdHIu\naW5kZXhPZignOicpOwogICAgICAgICAgICBfYmhhc2ggPSBJbnRlZ2VyLnBh\ncnNlSW50KHN0ci5zdWJzdHJpbmcoMCwgaWR4KSk7CiAgICAgICAgICAgIF9p\nZCA9IExvbmcucGFyc2VMb25nKHN0ci5zdWJzdHJpbmcoaWR4ICsgMSkpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVj\ndCBvdGhlcikgewogICAgICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAg\nICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIShv\ndGhlciBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcklkKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySWQg\nc2lkID0gKFN0YXRlTWFuYWdlcklkKSBvdGhlcjsKICAgICAgICAgICAgcmV0\ndXJuIF9iaGFzaCA9PSBzaWQuX2JoYXNoICYmIF9pZCA9PSBzaWQuX2lkOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIChpbnQpIChfaWQgXiAoX2lkID4+PiAzMikpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsK\nICAgICAgICAgICAgcmV0dXJuIFNUUklOR19QUkVGSVggKyBfYmhhc2ggKyAi\nOiIgKyBfaWQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29s\nbGVjdGlvbiB0eXBlIHRoYXQgaG9sZHMgc3RhdGUgbWFuYWdlcnMgYnV0IHdo\nb3NlIGludGVyZmFjZSBkZWFscwogICAgICogd2l0aCB0aGUgY29ycmVzcG9u\nZGluZyBtYW5hZ2VkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGNsYXNzIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAgICAgICAgZXh0\nZW5kcyBBYnN0cmFjdENvbGxlY3Rpb24gewoKICAgICAgICBwcml2YXRlIGZp\nbmFsIENvbGxlY3Rpb24gX3N0YXRlczsKCiAgICAgICAgcHVibGljIE1hbmFn\nZWRPYmplY3RDb2xsZWN0aW9uKENvbGxlY3Rpb24gc3RhdGVzKSB7CiAgICAg\nICAgICAgIF9zdGF0ZXMgPSBzdGF0ZXM7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgQ29sbGVjdGlvbiBnZXRTdGF0ZU1hbmFnZXJzKCkgewogICAgICAg\nICAgICByZXR1cm4gX3N0YXRlczsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZXMuc2l6\nZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9yIGl0ZXJh\ndG9yKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yKCkgewog\nICAgICAgICAgICAgICAgcHJpdmF0ZSBmaW5hbCBJdGVyYXRvciBfaXRyID0g\nX3N0YXRlcy5pdGVyYXRvcigpOwoKICAgICAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIF9pdHIuaGFzTmV4dCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIHB1YmxpYyBPYmplY3QgbmV4dCgpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBfaXRyLm5leHQo\nKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE1hbmFnZWRJbnN0YW5j\nZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHJlbW92ZSgpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NpZ24gdGhlIG9iamVjdCBpZCB0byB0aGUgY2FjaGUuIEV4Y2VwdGlv\nbiB3aWxsIGJlCiAgICAgKiB0aHJvd24gaWYgdGhlIGlkIGFscmVhZHkgZXhp\nc3RzIGluIHRoZSBjYWNoZS4gCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIGFzc2lnbk9iamVjdElkKE9iamVjdCBjYWNoZSwgT2JqZWN0IGlkLCAKICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgKChNYW5hZ2Vk\nQ2FjaGUpIGNhY2hlKS5hc3NpZ25PYmplY3RJZChpZCwgc20pOyAKICAgIH0K\nCiAgICAvKiogCiAgICAgKiBUaGlzIG1ldGhvZCBtYWtlcyBzdXJlIHdlIGRv\nbid0IGFscmVhZHkgaGF2ZSB0aGUgaW5zdGFuY2UgY2FjaGVkCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGNoZWNrRm9yRHVwbGljYXRlSWQoT2JqZWN0\nIGlkLCBPYmplY3Qgb2JqKSB7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBv\ndGhlciA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKGlkLCBmYWxzZSk7CiAg\nICAgICAgaWYgKG90aGVyICE9IG51bGwgJiYgIW90aGVyLmlzRGVsZXRlZCgp\nICYmICFvdGhlci5pc05ldygpKQogICAgICAgICAgICB0aHJvdyBuZXcgT2Jq\nZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWNoZS1leGlzdHMiLAog\nICAgICAgICAgICAgICAgb2JqLmdldENsYXNzKCkuZ2V0TmFtZSgpLCBpZCkp\nLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQogICAgCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRDYWNoZVByZXBhcmVkUXVlcnkoKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBfY2FjaGVQ\ncmVwYXJlZFF1ZXJ5IAogICAgICAgICAgICAgICAmJiBfY29uZi5nZXRRdWVy\neVNRTENhY2hlSW5zdGFuY2UoKSAhPSBudWxsOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVQcmVwYXJlZFF1ZXJ5KGJvb2xl\nYW4gZmxhZykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfY2FjaGVQcmVwYXJlZFF1ZXJ5ID0gZmxhZzsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBib29sZWFuIGdldENhY2hlRmluZGVyUXVl\ncnkoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiBfY2FjaGVGaW5kZXJRdWVyeSAKICAgICAgICAgICAgICAg\nJiYgX2NvbmYuZ2V0RmluZGVyQ2FjaGVJbnN0YW5jZSgpICE9IG51bGw7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRDYWNoZUZpbmRl\nclF1ZXJ5KGJvb2xlYW4gZmxhZykgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBfY2FjaGVQcmVwYXJlZFF1ZXJ5ID0gZmxh\nZzsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIERhdGFDYWNoZVJldHJpZXZl\nTW9kZSBnZXRDYWNoZVJldHJpZXZlTW9kZSgpIHsKICAgICAgICByZXR1cm4g\nX2NhY2hlUmV0cmlldmVNb2RlOwogICAgfQoKICAgIHB1YmxpYyBEYXRhQ2Fj\naGVTdG9yZU1vZGUgZ2V0Q2FjaGVTdG9yZU1vZGUoKSB7CiAgICAgICAgcmV0\ndXJuIF9jYWNoZVN0b3JlTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRDYWNoZVJldHJpZXZlTW9kZShEYXRhQ2FjaGVSZXRyaWV2ZU1vZGUgbW9k\nZSkgewogICAgICAgIF9jYWNoZVJldHJpZXZlTW9kZSA9IG1vZGU7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVTdG9yZU1vZGUoRGF0YUNhY2hl\nU3RvcmVNb2RlIG1vZGUpIHsKICAgICAgICBfY2FjaGVTdG9yZU1vZGUgPSBt\nb2RlOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBwb3BDYWNoZVJldHJp\nZXZlTW9kZSgpIHsgCiAgICAgICAgX2NhY2hlUmV0cmlldmVNb2RlID0gX2Nh\nY2hlUmV0cmlldmVNb2RlU3RhY2sucG9wKCk7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIHBvcENhY2hlU3RvcmVNb2RlKCkgeyAKICAgICAgICBfY2Fj\naGVTdG9yZU1vZGUgPSBfY2FjaGVTdG9yZU1vZGVTdGFjay5wb3AoKTsKICAg\nIH0KICAgIAogICAgcHVibGljIHZvaWQgcHVzaENhY2hlUmV0cmlldmVNb2Rl\nKCkgeyAKICAgICAgICBfY2FjaGVSZXRyaWV2ZU1vZGVTdGFjay5wdXNoKF9j\nYWNoZVJldHJpZXZlTW9kZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lk\nIHB1c2hDYWNoZVN0b3JlTW9kZSgpIHsgCiAgICAgICAgX2NhY2hlU3RvcmVN\nb2RlU3RhY2sucHVzaChfY2FjaGVTdG9yZU1vZGUpOwogICAgfQp9Cg==\n","encoding":"base64"}

