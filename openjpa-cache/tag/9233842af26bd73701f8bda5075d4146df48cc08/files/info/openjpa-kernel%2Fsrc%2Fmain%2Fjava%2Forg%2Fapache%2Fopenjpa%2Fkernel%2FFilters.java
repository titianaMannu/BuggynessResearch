{"sha":"502a2c28c21e7f24f960f550495fca322e58eeed","node_id":"MDQ6QmxvYjIwNjM2NDo1MDJhMmMyOGMyMWU3ZjI0Zjk2MGY1NTA0OTVmY2EzMjJlNThlZWVk","size":34645,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/502a2c28c21e7f24f960f550495fca322e58eeed","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdE\nZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBq\nYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnNl\nY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb247CmltcG9ydCBqYXZh\nLnNxbC5UaW1lOwppbXBvcnQgamF2YS5zcWwuVGltZXN0YW1wOwppbXBvcnQg\namF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRh\ncjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkFnZ3JlZ2F0ZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkZpbHRlckxpc3RlbmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNl\ncHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKaW1wb3J0IHNlcnAu\ndXRpbC5TdHJpbmdzOwoKLyoqCiAqIEhlbHBlciBtZXRob2RzIGZvciBkZWFs\naW5nIHdpdGggcXVlcnkgZmlsdGVycy4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEZpbHRlcnMgewoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEJpZ0RlY2ltYWwgWkVST19CSUdE\nRUNJTUFMID0gbmV3IEJpZ0RlY2ltYWwoMEQpOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgQmlnSW50ZWdlciBaRVJPX0JJR0lOVEVHRVIgPSBuZXcgQmln\nSW50ZWdlcigiMCIpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBP\nUF9BREQgPSAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE9QX1NV\nQlRSQUNUID0gMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBPUF9N\nVUxUSVBMWSA9IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1Bf\nRElWSURFID0gMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBPUF9N\nT0QgPSA0OwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoRmlsdGVycy5jbGFzcyk7Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvcnJlY3Qgd3JhcHBlciB0eXBl\nIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgQ2xhc3M8Pz4gd3JhcChDbGFzczw/PiBjKSB7CiAgICAgICAgaWYgKCFj\nLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIHJldHVybiBjOwogICAgICAg\nIGlmIChjID09IGludC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIEludGVn\nZXIuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gZmxvYXQuY2xhc3MpCiAgICAg\nICAgICAgIHJldHVybiBGbG9hdC5jbGFzczsKICAgICAgICBpZiAoYyA9PSBk\nb3VibGUuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7\nCiAgICAgICAgaWYgKGMgPT0gbG9uZy5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIExvbmcuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gYm9vbGVhbi5jbGFz\ncykKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uY2xhc3M7CiAgICAgICAg\naWYgKGMgPT0gc2hvcnQuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBTaG9y\ndC5jbGFzczsKICAgICAgICBpZiAoYyA9PSBieXRlLmNsYXNzKQogICAgICAg\nICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICBpZiAoYyA9PSBjaGFy\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gQ2hhcmFjdGVyLmNsYXNzOwog\nICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjb3JyZWN0IHByaW1pdGl2ZSB0eXBlIGZvciB0aGUgZ2l2ZW4gY2xh\nc3MsIGlmIGl0IGlzIGEKICAgICAqIHdyYXBwZXIuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgQ2xhc3M8Pz4gdW53cmFwKENsYXNzPD8+IGMpIHsKICAg\nICAgICBpZiAoYy5pc1ByaW1pdGl2ZSgpIHx8IGMgPT0gU3RyaW5nLmNsYXNz\nKQogICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICBpZiAoYyA9PSBJbnRl\nZ2VyLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gaW50LmNsYXNzOwogICAg\nICAgIGlmIChjID09IEZsb2F0LmNsYXNzKQogICAgICAgICAgICByZXR1cm4g\nZmxvYXQuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gRG91YmxlLmNsYXNzKQog\nICAgICAgICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgIGlmIChj\nID09IExvbmcuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBsb25nLmNsYXNz\nOwogICAgICAgIGlmIChjID09IEJvb2xlYW4uY2xhc3MpCiAgICAgICAgICAg\nIHJldHVybiBib29sZWFuLmNsYXNzOwogICAgICAgIGlmIChjID09IFNob3J0\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gc2hvcnQuY2xhc3M7CiAgICAg\nICAgaWYgKGMgPT0gQnl0ZS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGJ5\ndGUuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gQ2hhcmFjdGVyLmNsYXNzKQog\nICAgICAgICAgICByZXR1cm4gY2hhci5jbGFzczsKICAgICAgICByZXR1cm4g\nYzsKICAgIH0KCiAgICAvKioKICAgICAqIEdpdmVuIHR3byB0eXBlcywgcmV0\ndXJuIHR5cGUgdGhleSBzaG91bGQgYm90aCBiZSBjb252ZXJ0ZWQKICAgICAq\nIHRvIGJlZm9yZSBwZXJmb3JtaW5nIGFueSBvcGVyYXRpb25zIGJldHdlZW4g\ndGhlbS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBDbGFzczw/PiBwcm9t\nb3RlKENsYXNzPD8+IGMxLCBDbGFzczw/PiBjMikgewogICAgICAgIGlmIChj\nMSA9PSBjMikKICAgICAgICAgICAgcmV0dXJuIHVud3JhcChjMSk7CiAgICAg\nICAgQ2xhc3M8Pz4gdzEgPSB3cmFwKGMxKTsKICAgICAgICBDbGFzczw/PiB3\nMiA9IHdyYXAoYzIpOwogICAgICAgIGlmICh3MSA9PSB3MikKICAgICAgICAg\nICAgcmV0dXJuIHVud3JhcChjMSk7CgogICAgICAgIC8vIG5vdCBudW1iZXJz\nPwogICAgICAgIGJvb2xlYW4gdzFOdW1iZXIgPSBOdW1iZXIuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSh3MSk7CiAgICAgICAgYm9vbGVhbiB3Mk51bWJlciA9\nIE51bWJlci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHcyKTsKICAgICAgICBp\nZiAoIXcxTnVtYmVyIHx8ICF3Mk51bWJlcikgewogICAgICAgICAgICAvLyB0\naGUgb25seSBub24tbnVtZXJpYyBwcm9tb3Rpb24gd2UgZG8gaXMgc3RyaW5n\nIHRvIGNoYXIsCiAgICAgICAgICAgIC8vIG9yIGZyb20gY2hhci9zdHJpbmcg\ndG8gbnVtYmVyCiAgICAgICAgICAgIGlmICghdzFOdW1iZXIpIHsKICAgICAg\nICAgICAgICAgIGlmICh3Mk51bWJlciAmJiAodzEgPT0gQ2hhcmFjdGVyLmNs\nYXNzIHx8IHcxID09IFN0cmluZy5jbGFzcykpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuICh3MiA9PSBCeXRlLmNsYXNzIHx8IHcyID09IFNob3J0LmNs\nYXNzKQogICAgICAgICAgICAgICAgICAgICAgICA/IEludGVnZXIuY2xhc3Mg\nOiB1bndyYXAoYzIpOwogICAgICAgICAgICAgICAgaWYgKCF3Mk51bWJlciAm\nJiB3MSA9PSBDaGFyYWN0ZXIuY2xhc3MgJiYgdzIgPT0gU3RyaW5nLmNsYXNz\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuY2xhc3M7CiAg\nICAgICAgICAgICAgICBpZiAodzJOdW1iZXIpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHVud3JhcChjMik7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKCF3Mk51bWJlcikgewogICAgICAgICAgICAgICAgaWYgKHcxTnVt\nYmVyICYmICh3MiA9PSBDaGFyYWN0ZXIuY2xhc3MgfHwgdzIgPT0gU3RyaW5n\nLmNsYXNzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHcxID09IEJ5\ndGUuY2xhc3MgfHwgdzEgPT0gU2hvcnQuY2xhc3MpCiAgICAgICAgICAgICAg\nICAgICAgICAgID8gSW50ZWdlci5jbGFzcyA6IHVud3JhcChjMSk7CiAgICAg\nICAgICAgICAgICBpZiAoIXcxTnVtYmVyICYmIHcyID09IENoYXJhY3Rlci5j\nbGFzcyAmJiB3MSA9PSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIFN0cmluZy5jbGFzczsKICAgICAgICAgICAgICAgIGlmICh3\nMU51bWJlcikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMx\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbmVpdGhlciBh\ncmUgbnVtYmVycywgdXNlIGxlYXN0LWRlcml2ZWQgb2YgdGhlIHR3by4gIGlm\nIG5laXRoZXIKICAgICAgICAgICAgLy8gaXMgYXNzaWduYWJsZSBmcm9tIHRo\nZSBvdGhlciBidXQgb25lIGlzIGEgc3RhbmRhcmQgdHlwZSwgYXNzdW1lCiAg\nICAgICAgICAgIC8vIHRoZSBvdGhlciBjYW4gYmUgY29udmVydGVkIHRvIHRo\nYXQgc3RhbmRhcmQgdHlwZQogICAgICAgICAgICBpZiAoIXcxTnVtYmVyICYm\nICF3Mk51bWJlcikgewogICAgICAgICAgICAgICAgaWYgKHcxID09IE9iamVj\ndC5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMy\nKTsKICAgICAgICAgICAgICAgIGlmICh3MiA9PSBPYmplY3QuY2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcChjMSk7CiAgICAgICAg\nICAgICAgICBpZiAodzEuaXNBc3NpZ25hYmxlRnJvbSh3MikpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHVud3JhcChjMSk7CiAgICAgICAgICAgICAg\nICBpZiAodzIuaXNBc3NpZ25hYmxlRnJvbSh3MSkpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHVud3JhcChjMik7CiAgICAgICAgICAgICAgICBpZiAo\naXNOb25zdGFuZGFyZFR5cGUodzEpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiAoaXNOb25zdGFuZGFyZFR5cGUodzIpKSA/IE9iamVjdC5jbGFzcyA6\nIHVud3JhcChjMik7CiAgICAgICAgICAgICAgICBpZiAoaXNOb25zdGFuZGFy\nZFR5cGUodzIpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNOb25z\ndGFuZGFyZFR5cGUodzEpKSA/IE9iamVjdC5jbGFzcyA6IHVud3JhcChjMSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5jbGFz\nczsKICAgICAgICB9CgogICAgICAgIGlmICh3MSA9PSBCaWdEZWNpbWFsLmNs\nYXNzIHx8IHcyID09IEJpZ0RlY2ltYWwuY2xhc3MpCiAgICAgICAgICAgIHJl\ndHVybiBCaWdEZWNpbWFsLmNsYXNzOwogICAgICAgIGlmICh3MSA9PSBCaWdJ\nbnRlZ2VyLmNsYXNzKSB7CiAgICAgICAgICAgIGlmICh3MiA9PSBGbG9hdC5j\nbGFzcyB8fCB3MiA9PSBEb3VibGUuY2xhc3MpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gQmlnRGVjaW1hbC5jbGFzczsKICAgICAgICAgICAgcmV0dXJuIEJp\nZ0ludGVnZXIuY2xhc3M7CiAgICAgICAgfQogICAgICAgIGlmICh3MiA9PSBC\naWdJbnRlZ2VyLmNsYXNzKSB7CiAgICAgICAgICAgIGlmICh3MSA9PSBGbG9h\ndC5jbGFzcyB8fCB3MSA9PSBEb3VibGUuY2xhc3MpCiAgICAgICAgICAgICAg\nICByZXR1cm4gQmlnRGVjaW1hbC5jbGFzczsKICAgICAgICAgICAgcmV0dXJu\nIEJpZ0ludGVnZXIuY2xhc3M7CiAgICAgICAgfQogICAgICAgIGlmICh3MSA9\nPSBEb3VibGUuY2xhc3MgfHwgdzIgPT0gRG91YmxlLmNsYXNzKQogICAgICAg\nICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgIGlmICh3MSA9PSBG\nbG9hdC5jbGFzcyB8fCB3MiA9PSBGbG9hdC5jbGFzcykKICAgICAgICAgICAg\ncmV0dXJuIGZsb2F0LmNsYXNzOwogICAgICAgIGlmICh3MSA9PSBMb25nLmNs\nYXNzIHx8IHcyID09IExvbmcuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBs\nb25nLmNsYXNzOwogICAgICAgIHJldHVybiBpbnQuY2xhc3M7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gdHlwZSBp\ncyBub3QgYSBzdGFuZGFyZCBwZXJzaXN0ZW50IHR5cGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNOb25zdGFuZGFyZFR5cGUoQ2xh\nc3M8Pz4gYykgewogICAgICAgIHN3aXRjaCAoSmF2YVR5cGVzLmdldFR5cGVD\nb2RlKGMpKQogICAgICAgIHsKICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJB\nWToKICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICBjYXNlIEphdmFUeXBlcy5Q\nQzoKICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nQkpFQ1Q6CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciBhbiBpbnN0YW5jZSBv\nZiB0aGUgZmlyc3QgY2xhc3MgY2FuIGJlIGNvbnZlcnRlZCB0bwogICAgICog\nYW4gaW5zdGFuY2Ugb2YgdGhlIHNlY29uZC4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBib29sZWFuIGNhbkNvbnZlcnQoQ2xhc3M8Pz4gYzEsIENsYXNz\nPD8+IGMyLCBib29sZWFuIHN0cmljdCkgewogICAgICAgIGMxID0gd3JhcChj\nMSk7CiAgICAgICAgYzIgPSB3cmFwKGMyKTsKICAgICAgICBpZiAoYzIuaXNB\nc3NpZ25hYmxlRnJvbShjMSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoK\nICAgICAgICBib29sZWFuIGMxTnVtYmVyID0gTnVtYmVyLmNsYXNzLmlzQXNz\naWduYWJsZUZyb20oYzEpOwogICAgICAgIGJvb2xlYW4gYzJOdW1iZXIgPSBO\ndW1iZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjMik7CiAgICAgICAgaWYg\nKGMxTnVtYmVyICYmIGMyTnVtYmVyKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICBpZiAoKGMxTnVtYmVyICYmIChjMiA9PSBDaGFyYWN0ZXIu\nY2xhc3MKICAgICAgICAgICAgfHwgKCFzdHJpY3QgJiYgYzIgPT0gU3RyaW5n\nLmNsYXNzKSkpCiAgICAgICAgICAgIHx8IChjMk51bWJlciAmJiAoYzEgPT0g\nQ2hhcmFjdGVyLmNsYXNzCiAgICAgICAgICAgIHx8ICghc3RyaWN0ICYmIGMx\nID09IFN0cmluZy5jbGFzcykpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgaWYgKGMxID09IFN0cmluZy5jbGFzcyAmJiBjMiA9PSBDaGFy\nYWN0ZXIuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIGlmIChjMiA9PSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiAh\nc3RyaWN0OwogICAgICAgIGlmIChjMSA9PSBTdHJpbmcuY2xhc3MgJiYgaXNU\nZW1wb3JhbFR5cGUoYzIpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gdHlwZS4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgY29udmVydChPYmplY3Qgbywg\nQ2xhc3M8Pz4gdHlwZSkgewogICAgICAgIGlmIChvID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvLmdldENsYXNzKCkg\nPT0gdHlwZSkKICAgICAgICAgICAgcmV0dXJuIG87CgogICAgICAgIHR5cGUg\nPSB3cmFwKHR5cGUpOwogICAgICAgIGlmICh0eXBlLmlzQXNzaWduYWJsZUZy\nb20oby5nZXRDbGFzcygpKSkKICAgICAgICAgICAgcmV0dXJuIG87CgogICAg\nICAgIC8vIHRoZSBub24tbnVtZXJpYyBjb252ZXJzaW9ucyB3ZSBkbyBhcmUg\ndG8gc3RyaW5nLCBvciBmcm9tCiAgICAgICAgLy8gc3RyaW5nL2NoYXIgdG8g\nbnVtYmVyLCBvciBjYWxlbmRhci9kYXRlCiAgICAgICAgLy8gU3RyaW5nIHRv\nIEJvb2xlYW4KICAgICAgICAvLyBTdHJpbmcgdG8gSW50ZWdlcgogICAgICAg\nIGJvb2xlYW4gbnVtID0gbyBpbnN0YW5jZW9mIE51bWJlcjsKICAgICAgICBp\nZiAoIW51bSkgewogICAgICAgICAgICBpZiAodHlwZSA9PSBTdHJpbmcuY2xh\nc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gby50b1N0cmluZygpOwogICAg\nICAgICAgICBlbHNlIGlmICh0eXBlID09IEJvb2xlYW4uY2xhc3MgJiYgbyBp\nbnN0YW5jZW9mIFN0cmluZykgCiAgICAgICAgICAgICAgICByZXR1cm4gQm9v\nbGVhbi52YWx1ZU9mKG8udG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKHR5cGUgPT0gSW50ZWdlci5jbGFzcyAmJiBvIGluc3RhbmNlb2YgU3Ry\naW5nKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IEludGVnZXIoby50b1N0cmluZygpKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IENsYXNzQ2FzdEV4Y2VwdGlv\nbihfbG9jLmdldCgiY2FudC1jb252ZXJ0IiwgbywKICAgICAgICAgICAgICAg\nICAgICAgICAgby5nZXRDbGFzcygpLCB0eXBlKS5nZXRNZXNzYWdlKCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09\nIENoYXJhY3Rlci5jbGFzcykgewogICAgICAgICAgICAgICAgU3RyaW5nIHN0\nciA9IG8udG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIGlmIChzdHIgIT0g\nbnVsbCAmJiBzdHIubGVuZ3RoKCkgPT0gMSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IENoYXJhY3RlcihzdHIuY2hhckF0KDApKTsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChDYWxlbmRhci5jbGFzcy5pc0Fzc2lnbmFibGVG\ncm9tKHR5cGUpICYmCiAgICAgICAgICAgICAgICBvIGluc3RhbmNlb2YgRGF0\nZSkgewogICAgICAgICAgICAgICAgQ2FsZW5kYXIgY2FsID0gQ2FsZW5kYXIu\nZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIGNhbC5zZXRUaW1lKChE\nYXRlKSBvKTsKICAgICAgICAgICAgICAgIHJldHVybiBjYWw7CiAgICAgICAg\nICAgIH0gZWxzZSBpZiAoRGF0ZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5\ncGUpICYmCiAgICAgICAgICAgICAgICBvIGluc3RhbmNlb2YgQ2FsZW5kYXIp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiAoKENhbGVuZGFyKSBvKS5nZXRU\naW1lKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20odHlwZSkpIHsKICAgICAgICAgICAgICAgIEludGVn\nZXIgaSA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAobyBpbnN0YW5jZW9m\nIENoYXJhY3RlcikKICAgICAgICAgICAgICAgICAgICBpID0gTnVtYmVycy52\nYWx1ZU9mKCgoQ2hhcmFjdGVyKSBvKS5jaGFyVmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICBlbHNlIGlmIChvIGluc3RhbmNlb2YgU3RyaW5nICYmICgoU3Ry\naW5nKSBvKS5sZW5ndGgoKSA9PSAxKQogICAgICAgICAgICAgICAgICAgIGkg\nPSBOdW1iZXJzLnZhbHVlT2YoKChTdHJpbmcpIG8pLmNoYXJBdCgwKSk7Cgog\nICAgICAgICAgICAgICAgaWYgKGkgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIGlmICh0eXBlID09IEludGVnZXIuY2xhc3MpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgICAgIG51\nbSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAobyBpbnN0YW5jZW9mIFN0cmluZyAmJiBpc0pEQkNUZW1wb3JhbFN5\nbnRheChvLnRvU3RyaW5nKCkpKSB7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIE9iamVjdCB0ZW1wb3JhbCA9IHBhcnNlSkRC\nQ1RlbXBvcmFsU3ludGF4KG8udG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHRlbXBvcmFsICE9IG51bGwgJiYgdHlwZS5pc0Fzc2lnbmFi\nbGVGcm9tKHRlbXBvcmFsLmdldENsYXNzKCkpKQogICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gdGVtcG9yYWw7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGlmICghbnVtKQogICAgICAgICAgICB0aHJvdyBu\nZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKF9sb2MuZ2V0KCJjYW50LWNvbnZlcnQi\nLCBvLAogICAgICAgICAgICAgICAgby5nZXRDbGFzcygpLCB0eXBlKS5nZXRN\nZXNzYWdlKCkpOwoKICAgICAgICBpZiAodHlwZSA9PSBJbnRlZ2VyLmNsYXNz\nKSB7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoKChOdW1i\nZXIpIG8pLmludFZhbHVlKCkpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9\nPSBGbG9hdC5jbGFzcykgewogICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0\nKCgoTnVtYmVyKSBvKS5mbG9hdFZhbHVlKCkpOwogICAgICAgIH0gZWxzZSBp\nZiAodHlwZSA9PSBEb3VibGUuY2xhc3MpIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBEb3VibGUoKChOdW1iZXIpIG8pLmRvdWJsZVZhbHVlKCkpOwogICAg\nICAgIH0gZWxzZSBpZiAodHlwZSA9PSBMb25nLmNsYXNzKSB7CiAgICAgICAg\nICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoKChOdW1iZXIpIG8pLmxvbmdW\nYWx1ZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gQmlnRGVjaW1h\nbC5jbGFzcykgewogICAgICAgICAgICAvLyB0aGUgQmlnRGVjaW1hbCBjb25z\ndHJ1Y3RvciBkb2Vzbid0IGhhbmRsZSB0aGUKICAgICAgICAgICAgLy8gIk5h\nTiIgc3RyaW5nIHZlcnNpb24gb2YgRG91YmxlLk5hTiBhbmQgRmxvYXQuTmFO\nLCBub3IKICAgICAgICAgICAgLy8gZG9lcyBpdCBoYW5kbGUgaW5maW5pdHk7\nIHdlIG5lZWQgdG8gaW5zdGVhZCB1c2UgdGhlIERvdWJsZQogICAgICAgICAg\nICAvLyBhbmQgRmxvYXQgdmVyc2lvbnMsIGRlc3BpdGUgd2FudGluZyB0byBj\nYXN0IGl0IHRvIEJpZ0RlY2ltYWwKICAgICAgICAgICAgZG91YmxlIGR2YWwg\nPSAoKE51bWJlcikgbykuZG91YmxlVmFsdWUoKTsKICAgICAgICAgICAgaWYg\nKERvdWJsZS5pc05hTihkdmFsKSB8fCBEb3VibGUuaXNJbmZpbml0ZShkdmFs\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlKGR2YWwpOwoK\nICAgICAgICAgICAgZmxvYXQgZnZhbCA9ICgoTnVtYmVyKSBvKS5mbG9hdFZh\nbHVlKCk7CiAgICAgICAgICAgIGlmIChGbG9hdC5pc05hTihmdmFsKSB8fCBG\nbG9hdC5pc0luZmluaXRlKGZ2YWwpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBGbG9hdChmdmFsKTsKCiAgICAgICAgICAgIHJldHVybiBuZXcgQmln\nRGVjaW1hbChvLnRvU3RyaW5nKCkpOwogICAgICAgIH0gZWxzZSBpZiAodHlw\nZSA9PSBCaWdJbnRlZ2VyLmNsYXNzKSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgQmlnSW50ZWdlcihvLnRvU3RyaW5nKCkpOwogICAgICAgIH0gZWxzZSBp\nZiAodHlwZSA9PSBTaG9ydC5jbGFzcykgewogICAgICAgICAgICByZXR1cm4g\nbmV3IFNob3J0KCgoTnVtYmVyKSBvKS5zaG9ydFZhbHVlKCkpOwogICAgICAg\nIH0gZWxzZSBpZiAodHlwZSA9PSBCeXRlLmNsYXNzKSB7CiAgICAgICAgICAg\nIHJldHVybiBuZXcgQnl0ZSgoKE51bWJlcikgbykuYnl0ZVZhbHVlKCkpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZh\nbHVlT2YoKChOdW1iZXIpIG8pLmludFZhbHVlKCkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gdmFsdWVzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBhZGQoT2JqZWN0IG8xLCBD\nbGFzczw/PiBjMSwgT2JqZWN0IG8yLCBDbGFzczw/PiBjMikgewogICAgICAg\nIHJldHVybiBvcChvMSwgYzEsIG8yLCBjMiwgT1BfQUREKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFN1YnRyYWN0IHRoZSBnaXZlbiB2YWx1ZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IHN1YnRyYWN0KE9iamVjdCBv\nMSwgQ2xhc3M8Pz4gYzEsIE9iamVjdCBvMiwgQ2xhc3M8Pz4gYzIpIHsKICAg\nICAgICByZXR1cm4gb3AobzEsIGMxLCBvMiwgYzIsIE9QX1NVQlRSQUNUKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE11bHRpcGx5IHRoZSBnaXZlbiB2YWx1\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG11bHRpcGx5\nKE9iamVjdCBvMSwgQ2xhc3M8Pz4gYzEsIE9iamVjdCBvMiwgQ2xhc3M8Pz4g\nYzIpIHsKICAgICAgICByZXR1cm4gb3AobzEsIGMxLCBvMiwgYzIsIE9QX01V\nTFRJUExZKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpdmlkZSB0aGUgZ2l2\nZW4gdmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBk\naXZpZGUoT2JqZWN0IG8xLCBDbGFzczw/PiBjMSwgT2JqZWN0IG8yLCBDbGFz\nczw/PiBjMikgewogICAgICAgIHJldHVybiBvcChvMSwgYzEsIG8yLCBjMiwg\nT1BfRElWSURFKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1vZCB0aGUgZ2l2\nZW4gdmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBt\nb2QoT2JqZWN0IG8xLCBDbGFzczw/PiBjMSwgT2JqZWN0IG8yLCBDbGFzczw/\nPiBjMikgewogICAgICAgIHJldHVybiBvcChvMSwgYzEsIG8yLCBjMiwgT1Bf\nTU9EKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gdGhlIGdpdmVu\nIG9wZXJhdGlvbiBvbiB0d28gbnVtYmVycy4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgT2JqZWN0IG9wKE9iamVjdCBvMSwgQ2xhc3M8Pz4gYzEsIE9i\namVjdCBvMiwgQ2xhc3M8Pz4gYzIsIGludCBvcCkgewogICAgICAgIENsYXNz\nPD8+IHByb21vdGUgPSBwcm9tb3RlKGMxLCBjMik7CiAgICAgICAgaWYgKHBy\nb21vdGUgPT0gaW50LmNsYXNzKSB7CiAgICAgICAgICAgIGludCBuMSA9IChv\nMSA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikgbzEpLmludFZhbHVlKCk7CiAg\nICAgICAgICAgIGludCBuMiA9IChvMiA9PSBudWxsKSA/IDAgOiAoKE51bWJl\ncikgbzIpLmludFZhbHVlKCk7CiAgICAgICAgICAgIHJldHVybiBvcChuMSwg\nbjIsIG9wKTsKICAgICAgICB9CiAgICAgICAgaWYgKHByb21vdGUgPT0gZmxv\nYXQuY2xhc3MpIHsKICAgICAgICAgICAgZmxvYXQgbjEgPSAobzEgPT0gbnVs\nbCkgPyAwRiA6ICgoTnVtYmVyKSBvMSkuZmxvYXRWYWx1ZSgpOwogICAgICAg\nICAgICBmbG9hdCBuMiA9IChvMiA9PSBudWxsKSA/IDBGIDogKChOdW1iZXIp\nIG8yKS5mbG9hdFZhbHVlKCk7CiAgICAgICAgICAgIHJldHVybiBvcChuMSwg\nbjIsIG9wKTsKICAgICAgICB9CiAgICAgICAgaWYgKHByb21vdGUgPT0gZG91\nYmxlLmNsYXNzKSB7CiAgICAgICAgICAgIGRvdWJsZSBuMSA9IChvMSA9PSBu\ndWxsKSA/IDBEIDogKChOdW1iZXIpIG8xKS5kb3VibGVWYWx1ZSgpOwogICAg\nICAgICAgICBkb3VibGUgbjIgPSAobzIgPT0gbnVsbCkgPyAwRCA6ICgoTnVt\nYmVyKSBvMikuZG91YmxlVmFsdWUoKTsKICAgICAgICAgICAgcmV0dXJuIG9w\nKG4xLCBuMiwgb3ApOwogICAgICAgIH0KICAgICAgICBpZiAocHJvbW90ZSA9\nPSBsb25nLmNsYXNzKSB7CiAgICAgICAgICAgIGxvbmcgbjEgPSAobzEgPT0g\nbnVsbCkgPyAwTCA6ICgoTnVtYmVyKSBvMSkubG9uZ1ZhbHVlKCk7CiAgICAg\nICAgICAgIGxvbmcgbjIgPSAobzIgPT0gbnVsbCkgPyAwTCA6ICgoTnVtYmVy\nKSBvMikubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgIHJldHVybiBvcChuMSwg\nbjIsIG9wKTsKICAgICAgICB9CiAgICAgICAgaWYgKHByb21vdGUgPT0gQmln\nRGVjaW1hbC5jbGFzcykgewogICAgICAgICAgICBCaWdEZWNpbWFsIG4xID0g\nKG8xID09IG51bGwpID8gWkVST19CSUdERUNJTUFMCiAgICAgICAgICAgICAg\nICA6IChCaWdEZWNpbWFsKSBjb252ZXJ0KG8xLCBwcm9tb3RlKTsKICAgICAg\nICAgICAgQmlnRGVjaW1hbCBuMiA9IChvMiA9PSBudWxsKSA/IFpFUk9fQklH\nREVDSU1BTAogICAgICAgICAgICAgICAgOiAoQmlnRGVjaW1hbCkgY29udmVy\ndChvMiwgcHJvbW90ZSk7CiAgICAgICAgICAgIHJldHVybiBvcChuMSwgbjIs\nIG9wKTsKICAgICAgICB9CiAgICAgICAgaWYgKHByb21vdGUgPT0gQmlnSW50\nZWdlci5jbGFzcykgewogICAgICAgICAgICBCaWdJbnRlZ2VyIG4xID0gKG8x\nID09IG51bGwpID8gWkVST19CSUdJTlRFR0VSCiAgICAgICAgICAgICAgICA6\nIChCaWdJbnRlZ2VyKSBjb252ZXJ0KG8xLCBwcm9tb3RlKTsKICAgICAgICAg\nICAgQmlnSW50ZWdlciBuMiA9IChvMiA9PSBudWxsKSA/IFpFUk9fQklHSU5U\nRUdFUgogICAgICAgICAgICAgICAgOiAoQmlnSW50ZWdlcikgY29udmVydChv\nMiwgcHJvbW90ZSk7CiAgICAgICAgICAgIHJldHVybiBvcChuMSwgbjIsIG9w\nKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVmYXVsdCB0byBpbnQKICAgICAg\nICBpbnQgbjEgPSAobzEgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIG8xKS5p\nbnRWYWx1ZSgpOwogICAgICAgIGludCBuMiA9IChvMiA9PSBudWxsKSA/IDAg\nOiAoKE51bWJlcikgbzIpLmludFZhbHVlKCk7CiAgICAgICAgcmV0dXJuIG9w\nKG4xLCBuMiwgb3ApOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSByZXN1bHQgb2YgYSBtYXRoZW1hdGljYWwgb3BlcmF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3Qgb3AoaW50IG4xLCBpbnQgbjIs\nIGludCBvcCkgewogICAgICAgIGludCB0b3Q7CiAgICAgICAgc3dpdGNoIChv\ncCkgewogICAgICAgICAgICBjYXNlIE9QX0FERDoKICAgICAgICAgICAgICAg\nIHRvdCA9IG4xICsgbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBPUF9TVUJUUkFDVDoKICAgICAgICAgICAgICAgIHRvdCA9\nIG4xIC0gbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBPUF9NVUxUSVBMWToKICAgICAgICAgICAgICAgIHRvdCA9IG4xICog\nbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBP\nUF9ESVZJREU6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAvIG4yOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfTU9EOgog\nICAgICAgICAgICAgICAgdG90ID0gbjEgJSBuMjsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YodG90KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIGEgbWF0aGVtYXRpY2Fs\nIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0\nIG9wKGZsb2F0IG4xLCBmbG9hdCBuMiwgaW50IG9wKSB7CiAgICAgICAgZmxv\nYXQgdG90OwogICAgICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAgICAgY2Fz\nZSBPUF9BREQ6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSArIG4yOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfU1VCVFJB\nQ1Q6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAtIG4yOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfTVVMVElQTFk6CiAg\nICAgICAgICAgICAgICB0b3QgPSBuMSAqIG4yOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfRElWSURFOgogICAgICAgICAg\nICAgICAgdG90ID0gbjEgLyBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIE9QX01PRDoKICAgICAgICAgICAgICAgIHRvdCA9\nIG4xICUgbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEZsb2F0\nKHRvdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlc3Vs\ndCBvZiBhIG1hdGhlbWF0aWNhbCBvcGVyYXRpb24uCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIE9iamVjdCBvcChkb3VibGUgbjEsIGRvdWJsZSBuMiwg\naW50IG9wKSB7CiAgICAgICAgZG91YmxlIHRvdDsKICAgICAgICBzd2l0Y2gg\nKG9wKSB7CiAgICAgICAgICAgIGNhc2UgT1BfQUREOgogICAgICAgICAgICAg\nICAgdG90ID0gbjEgKyBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIE9QX1NVQlRSQUNUOgogICAgICAgICAgICAgICAgdG90\nID0gbjEgLSBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIE9QX01VTFRJUExZOgogICAgICAgICAgICAgICAgdG90ID0gbjEg\nKiBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIE9QX0RJVklERToKICAgICAgICAgICAgICAgIHRvdCA9IG4xIC8gbjI7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUF9NT0Q6\nCiAgICAgICAgICAgICAgICB0b3QgPSBuMSAlIG4yOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIG5ldyBEb3VibGUodG90KTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIGEgbWF0aGVtYXRpY2FsIG9w\nZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IG9w\nKGxvbmcgbjEsIGxvbmcgbjIsIGludCBvcCkgewogICAgICAgIGxvbmcgdG90\nOwogICAgICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAgICAgY2FzZSBPUF9B\nREQ6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSArIG4yOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfU1VCVFJBQ1Q6CiAg\nICAgICAgICAgICAgICB0b3QgPSBuMSAtIG4yOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfTVVMVElQTFk6CiAgICAgICAg\nICAgICAgICB0b3QgPSBuMSAqIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgT1BfRElWSURFOgogICAgICAgICAgICAgICAg\ndG90ID0gbjEgLyBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIE9QX01PRDoKICAgICAgICAgICAgICAgIHRvdCA9IG4xICUg\nbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKHRvdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlc3Vs\ndCBvZiBhIG1hdGhlbWF0aWNhbCBvcGVyYXRpb24uCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIE9iamVjdCBvcChCaWdEZWNpbWFsIG4xLCBCaWdEZWNp\nbWFsIG4yLCBpbnQgb3ApIHsKICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAg\nICAgICAgIGNhc2UgT1BfQUREOgogICAgICAgICAgICAgICAgcmV0dXJuIG4x\nLmFkZChuMik7CiAgICAgICAgICAgIGNhc2UgT1BfU1VCVFJBQ1Q6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbjEuc3VidHJhY3QobjIpOwogICAgICAgICAg\nICBjYXNlIE9QX01VTFRJUExZOgogICAgICAgICAgICAgICAgcmV0dXJuIG4x\nLm11bHRpcGx5KG4yKTsKICAgICAgICAgICAgY2FzZSBPUF9ESVZJREU6CiAg\nICAgICAgICAgICAgICBpbnQgc2NhbGUgPSBNYXRoLm1heChuMS5zY2FsZSgp\nLCBuMi5zY2FsZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBuMS5kaXZp\nZGUobjIsIHNjYWxlLCBCaWdEZWNpbWFsLlJPVU5EX0hBTEZfVVApOwogICAg\nICAgICAgICBjYXNlIE9QX01PRDoKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtb2QtYmlnZGVjaW1hbCIpKTsK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIGEgbWF0aGVtYXRpY2Fs\nIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0\nIG9wKEJpZ0ludGVnZXIgbjEsIEJpZ0ludGVnZXIgbjIsIGludCBvcCkgewog\nICAgICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAgICAgY2FzZSBPUF9BREQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbjEuYWRkKG4yKTsKICAgICAgICAg\nICAgY2FzZSBPUF9TVUJUUkFDVDoKICAgICAgICAgICAgICAgIHJldHVybiBu\nMS5zdWJ0cmFjdChuMik7CiAgICAgICAgICAgIGNhc2UgT1BfTVVMVElQTFk6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbjEubXVsdGlwbHkobjIpOwogICAg\nICAgICAgICBjYXNlIE9QX0RJVklERToKICAgICAgICAgICAgICAgIHJldHVy\nbiBuMS5kaXZpZGUobjIpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2VzIHRoZSBnaXZlbiBk\nZWNsYXJhdGlvbnMgaW50byBhIGxpc3Qgb2YgdHlwZSwgbmFtZSwgdHlwZSwg\nbmFtZS4uLgogICAgICogUmV0dXJucyBudWxsIGlmIG5vIGRlY2xhcmF0aW9u\ncy4gQXNzdW1lcyBkZWNsYXJhdGlvbiBpcyBub3QgYW4gZW1wdHkKICAgICAq\nIHN0cmluZyBhbmQgaXMgYWxyZWFkeSB0cmltbWVkICh2YWxpZCBhc3N1bXB0\naW9ucyBnaXZlbiB0aGUgY2hlY2tzIG1hZGUKICAgICAqIGluIG91ciBzZXR0\nZXJzKS4KICAgICAqCiAgICAgKiBAcGFyYW0gZGVjVHlwZSB0aGUgdHlwZSBv\nZiBkZWNsYXJhdGlvbiBiZWluZyBwYXJzZWQsIGZvciB1c2UgaW4KICAgICAq\nIGVycm9yIG1lc3NhZ2VzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgTGlz\ndDxTdHJpbmc+IHBhcnNlRGVjbGFyYXRpb24oU3RyaW5nIGRlYywgY2hhciBz\ncGxpdCwgU3RyaW5nIGRlY1R5cGUpIHsKICAgICAgICBpZiAoZGVjID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyB3YXRj\naCBmb3IgY29tbW9uIG1peHVwcyBiZXR3ZWVuIGNvbW1hcyBhbmQgc2VtaXMK\nICAgICAgICBjaGFyIGJhZCA9IChjaGFyKSAwOwogICAgICAgIGlmIChzcGxp\ndCA9PSAnLCcpCiAgICAgICAgICAgIGJhZCA9ICc7JzsKICAgICAgICBlbHNl\nIGlmIChzcGxpdCA9PSAnOycpCiAgICAgICAgICAgIGJhZCA9ICcsJzsKCiAg\nICAgICAgY2hhciBzZW50aW5hbCA9ICcgJzsKICAgICAgICBjaGFyIGN1cjsK\nICAgICAgICBpbnQgc3RhcnQgPSAwOwogICAgICAgIGJvb2xlYW4gc2tpcFNw\nYWNlID0gZmFsc2U7CiAgICAgICAgTGlzdDxTdHJpbmc+IHJlc3VsdHMgPSBu\nZXcgQXJyYXlMaXN0PFN0cmluZz4oNik7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBkZWMubGVuZ3RoKCk7IGkrKykgewogICAgICAgICAgICBjdXIg\nPSBkZWMuY2hhckF0KGkpOwogICAgICAgICAgICBpZiAoY3VyID09IGJhZCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtZGVjIiwgZGVjLCBkZWNUeXBlKSk7CiAgICAgICAgICAgIGlm\nIChjdXIgPT0gJyAnICYmIHNraXBTcGFjZSkgewogICAgICAgICAgICAgICAg\nc3RhcnQrKzsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBza2lwU3BhY2UgPSBmYWxzZTsKICAgICAgICAg\nICAgaWYgKGN1ciAhPSBzZW50aW5hbCkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgLy8gaWYgbG9va2luZyBmb3Igc3BhY2VzLCBs\nb29rIGZvciBzcGxpdCBjaGFyLCBvciB2aWNlIHZlcnNhCiAgICAgICAgICAg\nIHNlbnRpbmFsID0gKHNlbnRpbmFsID09ICcgJykgPyBzcGxpdCA6ICcgJzsK\nICAgICAgICAgICAgcmVzdWx0cy5hZGQoZGVjLnN1YnN0cmluZyhzdGFydCwg\naSkudHJpbSgpKTsKICAgICAgICAgICAgc3RhcnQgPSBpICsgMTsKICAgICAg\nICAgICAgc2tpcFNwYWNlID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8v\nIGFkZCBsYXN0IHRva2VuLCBpZiBhbnkKICAgICAgICBpZiAoc3RhcnQgPCBk\nZWMubGVuZ3RoKCkpCiAgICAgICAgICAgIHJlc3VsdHMuYWRkKGRlYy5zdWJz\ndHJpbmcoc3RhcnQpKTsKCiAgICAgICAgLy8gaWYgbm90IGFuIGV2ZW4gbnVt\nYmVyIG9mIGVsZW1lbnRzLCBzb21ldGhpbmcgaXMgd3JvbmcKICAgICAgICBp\nZiAocmVzdWx0cy5pc0VtcHR5KCkgfHwgcmVzdWx0cy5zaXplKCkgJSAyICE9\nIDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtZGVjIiwgZGVjLCBkZWNUeXBlKSk7CgogICAgICAgIHJldHVy\nbiByZXN1bHRzOwogICAgfQoKICAgIC8qKgogICAgICogU3BsaXQgdGhlIGdp\ndmVuIGV4cHJlc3Npb24gbGlzdCBpbnRvIGRpc3RpbmN0IGV4cHJlc3Npb25z\nLiBBc3N1bWVzIHRoZQogICAgICogZ2l2ZW4gc3RyaW5nIGlzIG5vdCBudWxs\nIG9yIG9mIHplcm8gbGVuZ3RoIGFuZCBpcyBhbHJlYWR5IHRyaW1tZWQKICAg\nICAqICh2YWxpZCBhc3N1bXB0aW9ucyBnaXZlbiB0aGUgY2hlY2tzIGluIG91\nciBzZXR0ZXJzIGFuZCBiZWZvcmUKICAgICAqIHRoaXMgbWV0aG9kIGNhbGwp\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIExpc3Q8U3RyaW5nPiBzcGxp\ndEV4cHJlc3Npb25zKFN0cmluZyBzdHIsIGNoYXIgc3BsaXQsIGludCBleHBl\nY3RlZCkgewogICAgICAgIGlmIChzdHIgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIExpc3Q8U3RyaW5nPiBleHBzID0gbnVs\nbDsKICAgICAgICBpbnQgcGFyZW5EZXB0aCA9IDA7CiAgICAgICAgaW50IGJl\nZ2luID0gMCwgcG9zID0gMDsKICAgICAgICBib29sZWFuIGVzY2FwZSA9IGZh\nbHNlOwogICAgICAgIGJvb2xlYW4gc3RyaW5nID0gZmFsc2U7CiAgICAgICAg\nYm9vbGVhbiBub25zcGFjZSA9IGZhbHNlOwogICAgICAgIGNoYXIgcXVvdGUg\nPSAwOwogICAgICAgIGZvciAoY2hhciBjOyBwb3MgPCBzdHIubGVuZ3RoKCk7\nIHBvcysrKSB7CiAgICAgICAgICAgIGMgPSBzdHIuY2hhckF0KHBvcyk7CiAg\nICAgICAgICAgIGlmIChjID09ICdcXCcpIHsKICAgICAgICAgICAgICAgIGVz\nY2FwZSA9ICFlc2NhcGU7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoZXNjYXBlKSB7CiAgICAgICAg\nICAgICAgICBlc2NhcGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKGMpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgJ1wnJzoKICAgICAgICAgICAgICAgIGNh\nc2UgJyInOgogICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmcgJiYgcXVv\ndGUgPT0gYykKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nID0gZmFs\nc2U7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXN0cmluZykgewog\nICAgICAgICAgICAgICAgICAgICAgICBxdW90ZSA9IGM7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHN0cmluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIG5vbnNwYWNlID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nJygnOgogICAgICAgICAgICAgICAgICAgIGlmICghc3RyaW5nKQogICAgICAg\nICAgICAgICAgICAgICAgICBwYXJlbkRlcHRoKys7CiAgICAgICAgICAgICAg\nICAgICAgbm9uc3BhY2UgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnKSc6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKCFzdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncmVuRGVwdGgtLTsKICAgICAgICAgICAgICAgICAgICBub25zcGFjZSA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlICcgJzoKICAgICAgICAgICAgICAgIGNhc2UgJ1x0JzoKICAgICAg\nICAgICAgICAgIGNhc2UgJ1xuJzoKICAgICAgICAgICAgICAgIGNhc2UgJ1xy\nJzoKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PSBzcGxpdCAmJiAhc3Ry\naW5nICYmIHBhcmVuRGVwdGggPT0gMCAmJiBub25zcGFjZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoZXhwcyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZXhwcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5n\nPihleHBlY3RlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHMuYWRk\nKHN0ci5zdWJzdHJpbmcoYmVnaW4sIHBvcykudHJpbSgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYmVnaW4gPSBwb3MgKyAxOwogICAgICAgICAgICAg\nICAgICAgICAgICBub25zcGFjZSA9IGZhbHNlOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT0gc3Bs\naXQgJiYgIXN0cmluZyAmJiBwYXJlbkRlcHRoID09IDApIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGV4cHMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGV4cHMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4o\nZXhwZWN0ZWQpOwogICAgICAgICAgICAgICAgICAgICAgICBleHBzLmFkZChz\ndHIuc3Vic3RyaW5nKGJlZ2luLCBwb3MpLnRyaW0oKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGJlZ2luID0gcG9zICsgMTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9uc3BhY2UgPSB0cnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGVzY2FwZSA9IGZhbHNlOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKGV4cHMgPT0gbnVsbCkgewogICAgICAgICAg\nICBleHBzID0gQ29sbGVjdGlvbnMuc2luZ2xldG9uTGlzdChzdHIpOwogICAg\nICAgICAgICByZXR1cm4gZXhwczsKICAgICAgICB9CgogICAgICAgIC8vIGFk\nZCBsYXN0IGV4cHJlc3Npb24gYW5kIHJldHVybiBhcnJheQogICAgICAgIFN0\ncmluZyBsYXN0ID0gc3RyLnN1YnN0cmluZyhiZWdpbikudHJpbSgpOwogICAg\nICAgIGlmIChsYXN0Lmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgZXhwcy5h\nZGQobGFzdCk7CiAgICAgICAgcmV0dXJuIGV4cHM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgdGhlIGdpdmVuIGFjY2VzcyBwYXRoIG1ldGFkYXRhcyB0\nbyB0aGUgZnVsbCBwYXRoIGxpc3QsIG1ha2luZyBzdXJlCiAgICAgKiB0byBt\nYWludGFpbiBvbmx5IGJhc2UgbWV0YWRhdGFzIGluIHRoZSBsaXN0LiBUaGUg\nZ2l2ZW4gbGlzdCBtYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBMaXN0PENsYXNzTWV0YURhdGE+IGFkZEFjY2Vzc1BhdGhNZXRhRGF0\nYXMoTGlzdDxDbGFzc01ldGFEYXRhPiBtZXRhcywgQ2xhc3NNZXRhRGF0YVtd\nIHBhdGgpIHsKICAgICAgICBpZiAocGF0aCA9PSBudWxsIHx8IHBhdGgubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBtZXRhczsKCiAgICAgICAg\nLy8gY3JlYXRlIHNldCBvZiBiYXNlIGNsYXNzIG1ldGFkYXRhcyBpbiBhY2Nl\nc3MgcGF0aAogICAgICAgIGlmIChtZXRhcyA9PSBudWxsKQogICAgICAgICAg\nICBtZXRhcyA9IG5ldyBBcnJheUxpc3Q8Q2xhc3NNZXRhRGF0YT4oKTsKICAg\nICAgICBpbnQgbGFzdCA9IG1ldGFzLnNpemUoKTsKCiAgICAgICAgLy8gZm9y\nIGV2ZXJ5IGVsZW1lbnQgaW4gdGhlIHBhdGggb2YgdGhpcyBleGVjdXRvciwg\nY29tcGFyZSBpdAogICAgICAgIC8vIHRvIGFscmVhZHktZ2F0aGVyZWQgZWxl\nbWVudHMgdG8gc2VlIGlmIGl0IHNob3VsZCByZXBsYWNlCiAgICAgICAgLy8g\nYSBzdWJjbGFzcyBpbiB0aGUgbGlzdCBvciBzaG91bGQgYmUgYWRkZWQgYXMg\nYSBuZXcgYmFzZTsKICAgICAgICAvLyBhdCBsZWFzdCBpdCdzIG5eMiBvZiBh\nIHNtYWxsIG4uLi4KICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAg\nICAgYm9vbGVhbiBhZGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBw\nYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFkZCA9IHRydWU7CiAg\nICAgICAgICAgIGZvciAoaW50IGogPSAwOyBhZGQgJiYgaiA8IGxhc3Q7IGor\nKykgewogICAgICAgICAgICAgICAgbWV0YSA9IG1ldGFzLmdldChqKTsKCiAg\nICAgICAgICAgICAgICBpZiAobWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNB\nc3NpZ25hYmxlRnJvbShwYXRoW2ldLmdldERlc2NyaWJlZFR5cGUoKSkpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBsaXN0IGFscmVhZHkgY29udGFpbnMg\nYmFzZSBjbGFzcwogICAgICAgICAgICAgICAgICAgIGFkZCA9IGZhbHNlOwog\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoW2ldLmdldERlc2NyaWJl\nZFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKG1ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgZWxlbWVudCBy\nZXBsYWNlcyBpdHMgc3ViY2xhc3MKICAgICAgICAgICAgICAgICAgICBhZGQg\nPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBtZXRhcy5zZXQoaiwgcGF0\naFtpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGlmIG5vIGJhc2UgY2xhc3Mgb2YgY3VycmVudCBwYXRoIGVs\nZW1lbnQgYWxyZWFkeSBpbgogICAgICAgICAgICAvLyBsaXN0IGFuZCBwYXRo\nIGVsZW1lbnQgZGlkbid0IHJlcGxhY2UgYSBzdWJjbGFzcyBpbiB0aGUKICAg\nICAgICAgICAgLy8gbGlzdCwgdGhlbiBhZGQgaXQgbm93IGFzIGEgbmV3IGJh\nc2UKICAgICAgICAgICAgaWYgKGFkZCkKICAgICAgICAgICAgICAgIG1ldGFz\nLmFkZChwYXRoW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1ldGFz\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgdXNlci1naXZl\nbiBoaW50IHZhbHVlIHRvIGFuIGFnZ3JlZ2F0ZSBsaXN0ZW5lci4KICAgICAq\nIFRoZSBoaW50IGNhbiBiZSBhbiBhZ2dyZWdhdGUgbGlzdGVuZXIgaW5zdGFu\nY2Ugb3IgY2xhc3MgbmFtZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBB\nZ2dyZWdhdGVMaXN0ZW5lciBoaW50VG9BZ2dyZWdhdGVMaXN0ZW5lcihPYmpl\nY3QgaGludCwgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgaWYgKGhp\nbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKGhpbnQgaW5zdGFuY2VvZiBBZ2dyZWdhdGVMaXN0ZW5lcikKICAgICAg\nICAgICAgcmV0dXJuIChBZ2dyZWdhdGVMaXN0ZW5lcikgaGludDsKCiAgICAg\nICAgRXhjZXB0aW9uIGNhdXNlID0gbnVsbDsKICAgICAgICBpZiAoaGludCBp\nbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIChBZ2dyZWdhdGVMaXN0ZW5lcikgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oQ2xhc3MuZm9yTmFtZSgo\nU3RyaW5nKSBoaW50LCB0cnVlLCBsb2FkZXIpKSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAoZSBp\nbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAgICAgICAg\nICAgICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikg\nZSkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICBjYXVzZSA9IGU7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1hZ2ctbGlzdGVuZXItaGludCIs\nIGhpbnQsCiAgICAgICAgICAgIGhpbnQuZ2V0Q2xhc3MoKSkpLnNldENhdXNl\nKGNhdXNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHVz\nZXItZ2l2ZW4gaGludCB2YWx1ZSB0byBhbiBhcnJheSBvZiBhZ2dyZWdhdGUg\nbGlzdGVuZXJzLgogICAgICogVGhlIGhpbnQgY2FuIGJlIGFuIGFnZ3JlZ2F0\nZSBsaXN0ZW5lciwgYWdncmVnYXRlIGxpc3RlbmVyIGFycmF5LAogICAgICog\nY29sbGVjdGlvbiwgb3IgY29tbWEtc2VwYXJhdGVkIGNsYXNzIG5hbWVzLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIEFnZ3JlZ2F0ZUxpc3RlbmVyW10g\naGludFRvQWdncmVnYXRlTGlzdGVuZXJzKE9iamVjdCBoaW50LCBDbGFzc0xv\nYWRlciBsb2FkZXIpIHsKICAgICAgICBpZiAoaGludCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaGludCBpbnN0YW5j\nZW9mIEFnZ3JlZ2F0ZUxpc3RlbmVyW10pCiAgICAgICAgICAgIHJldHVybiAo\nQWdncmVnYXRlTGlzdGVuZXJbXSkgaGludDsKICAgICAgICBpZiAoaGludCBp\nbnN0YW5jZW9mIEFnZ3JlZ2F0ZUxpc3RlbmVyKQogICAgICAgICAgICByZXR1\ncm4gbmV3IEFnZ3JlZ2F0ZUxpc3RlbmVyW117IChBZ2dyZWdhdGVMaXN0ZW5l\ncikgaGludCB9OwogICAgICAgIGlmIChoaW50IGluc3RhbmNlb2YgQ29sbGVj\ndGlvbikgewogICAgICAgICAgICBDb2xsZWN0aW9uPEFnZ3JlZ2F0ZUxpc3Rl\nbmVyPiBjID0gKENvbGxlY3Rpb248QWdncmVnYXRlTGlzdGVuZXI+KSBoaW50\nOwogICAgICAgICAgICByZXR1cm4gYy50b0FycmF5KG5ldyBBZ2dyZWdhdGVM\naXN0ZW5lcltjLnNpemUoKV0pOwogICAgICAgIH0KCiAgICAgICAgRXhjZXB0\naW9uIGNhdXNlID0gbnVsbDsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9m\nIFN0cmluZykgewogICAgICAgICAgICBTdHJpbmdbXSBjbHNzID0gU3RyaW5n\ncy5zcGxpdCgoU3RyaW5nKSBoaW50LCAiLCIsIDApOwogICAgICAgICAgICBB\nZ2dyZWdhdGVMaXN0ZW5lcltdIGFnZ3MgPSBuZXcgQWdncmVnYXRlTGlzdGVu\nZXJbY2xzcy5sZW5ndGhdOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbHNzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgICAgIGFnZ3NbaV0gPSAoQWdncmVnYXRlTGlzdGVu\nZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlv\nbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUo\nY2xzc1tpXSwgdHJ1ZSwgbG9hZGVyKSkpOyAKICAgICAgICAgICAgICAgIHJl\ndHVybiBhZ2dzOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2Vk\nQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgICAgIGUgPSAoKFBy\naXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICAgICAgY2F1c2UgPSBlOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtYWdnLWxpc3RlbmVyLWhpbnQiLCBoaW50LAogICAgICAgICAgICBo\naW50LmdldENsYXNzKCkpKS5zZXRDYXVzZShjYXVzZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSB1c2VyLWdpdmVuIGhpbnQgdmFsdWUg\ndG8gYSBmaWx0ZXIgbGlzdGVuZXIuCiAgICAgKiBUaGUgaGludCBjYW4gYmUg\nYSBmaWx0ZXIgbGlzdGVuZXIgaW5zdGFuY2Ugb3IgY2xhc3MgbmFtZS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBGaWx0ZXJMaXN0ZW5lciBoaW50VG9G\naWx0ZXJMaXN0ZW5lcihPYmplY3QgaGludCwgQ2xhc3NMb2FkZXIgbG9hZGVy\nKSB7CiAgICAgICAgaWYgKGhpbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBGaWx0ZXJM\naXN0ZW5lcikKICAgICAgICAgICAgcmV0dXJuIChGaWx0ZXJMaXN0ZW5lcikg\naGludDsKCiAgICAgICAgRXhjZXB0aW9uIGNhdXNlID0gbnVsbDsKICAgICAg\nICBpZiAoaGludCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgcmV0dXJuIChGaWx0ZXJMaXN0ZW5lcikg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oCiAgICAg\nICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoKFN0cmluZykgaGlu\ndCwgdHJ1ZSwgbG9hZGVyKSkpOyAKICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2Yg\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAgICAg\nICBlID0gKChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgICAgIGNhdXNlID0gZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLWZpbHRlci1saXN0ZW5lci1oaW50IiwgaGludCwK\nICAgICAgICAgICAgaGludC5nZXRDbGFzcygpKSkuc2V0Q2F1c2UoY2F1c2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgdXNlci1naXZl\nbiBoaW50IHZhbHVlIHRvIGFuIGFycmF5IG9mIGZpbHRlciBsaXN0ZW5lcnMu\nCiAgICAgKiBUaGUgaGludCBjYW4gYmUgYSBmaWx0ZXIgbGlzdGVuZXIsIGZp\nbHRlciBsaXN0ZW5lciBhcnJheSwKICAgICAqIGNvbGxlY3Rpb24sIG9yIGNv\nbW1hLXNlcGFyYXRlZCBjbGFzcyBuYW1lcy4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBGaWx0ZXJMaXN0ZW5lcltdIGhpbnRUb0ZpbHRlckxpc3RlbmVy\ncyhPYmplY3QgaGludCwgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAg\naWYgKGhpbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBGaWx0ZXJMaXN0ZW5lcltdKQog\nICAgICAgICAgICByZXR1cm4gKEZpbHRlckxpc3RlbmVyW10pIGhpbnQ7CiAg\nICAgICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBGaWx0ZXJMaXN0ZW5lcikKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBGaWx0ZXJMaXN0ZW5lcltdeyAoRmlsdGVy\nTGlzdGVuZXIpIGhpbnQgfTsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9m\nIENvbGxlY3Rpb24pIHsKICAgICAgICAgICAgQ29sbGVjdGlvbjxGaWx0ZXJM\naXN0ZW5lcj4gYyA9IChDb2xsZWN0aW9uPEZpbHRlckxpc3RlbmVyPikgaGlu\ndDsKICAgICAgICAgICAgcmV0dXJuIGMudG9BcnJheShuZXcgRmlsdGVyTGlz\ndGVuZXJbYy5zaXplKCldKTsKICAgICAgICB9CgogICAgICAgIEV4Y2VwdGlv\nbiBjYXVzZSA9IG51bGw7CiAgICAgICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBT\ndHJpbmcpIHsKICAgICAgICAgICAgU3RyaW5nW10gY2xzcyA9IFN0cmluZ3Mu\nc3BsaXQoKFN0cmluZykgaGludCwgIiwiLCAwKTsKICAgICAgICAgICAgRmls\ndGVyTGlzdGVuZXJbXSBmaWx0cyA9IG5ldyBGaWx0ZXJMaXN0ZW5lcltjbHNz\nLmxlbmd0aF07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNsc3MubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICAgICAgZmlsdHNbaV0gPSAoRmlsdGVyTGlzdGVuZXIpIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbigKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzc1tpXSwg\ndHJ1ZSwgbG9hZGVyKSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRz\nOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKQogICAgICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRB\nY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAg\nICAgICAgY2F1c2UgPSBlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmls\ndGVyLWxpc3RlbmVyLWhpbnQiLCBoaW50LAogICAgICAgICAgICBoaW50Lmdl\ndENsYXNzKCkpKS5zZXRDYXVzZShjYXVzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSBuYW1lZCBi\neSB0aGUgaGludCBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2Jq\nZWN0IGhpbnRUb0dldHRlcihPYmplY3QgdGFyZ2V0LCBTdHJpbmcgaGludEtl\neSkgewogICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBoaW50S2V5ID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBNZXRo\nb2QgZ2V0dGVyID0gUmVmbGVjdGlvbi5maW5kR2V0dGVyKHRhcmdldC5nZXRD\nbGFzcygpLCBoaW50S2V5LCB0cnVlKTsKICAgICAgICByZXR1cm4gUmVmbGVj\ndGlvbi5nZXQodGFyZ2V0LCBnZXR0ZXIpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSB2YWx1ZSBvZiB0aGUgcHJvcGVydHkgbmFtZWQgYnkgdGhl\nIGhpbnQga2V5LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgaGlu\ndFRvU2V0dGVyKE9iamVjdCB0YXJnZXQsIFN0cmluZyBoaW50S2V5LAogICAg\nICAgIE9iamVjdCB2YWx1ZSkgewogICAgICAgIGlmICh0YXJnZXQgPT0gbnVs\nbCB8fCBoaW50S2V5ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgTWV0aG9kIHNldHRlciA9IFJlZmxlY3Rpb24uZmluZFNldHRlcih0\nYXJnZXQuZ2V0Q2xhc3MoKSwgaGludEtleSwgdHJ1ZSk7CiAgICAgICAgaWYg\nKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgIGlmICgi\nbnVsbCIuZXF1YWxzKHZhbHVlKSkKICAgICAgICAgICAgICAgIHZhbHVlID0g\nbnVsbDsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gU3RyaW5ncy5wYXJzZSgo\nU3RyaW5nKSB2YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGVy\nLmdldFBhcmFtZXRlclR5cGVzKClbMF0pOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXNldHRlci1oaW50\nLWFyZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGhpbnRLZXksIHZhbHVl\nLCBzZXR0ZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKVswXSkpLgogICAgICAgICAg\nICAgICAgICAgICAgICBzZXRDYXVzZShlKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSZWZsZWN0aW9uLnNl\ndCh0YXJnZXQsIHNldHRlciwgdmFsdWUpOwoJfQogICAgCiAgICAvKioKICAg\nICAqIFBhcnNlcyB0aGUgZ2l2ZW4gc3RyaW5nIGFzc3VtaW5nIGl0IGlzIGEg\nSkRCQyBrZXkgZXhwcmVzc2lvbi4gRXh0cmFjdHMgdGhlIAogICAgICogZGF0\nYSBwb3J0aW9uIGFuZCBiYXNlZCBvbiB0aGUga2V5LCBjYWxscyBzdGF0aWMg\namF2YS5zcWwuRGF0ZS9UaW1lL1RpbWVzdGFtcC52YWx1ZU9mKFN0cmluZykK\nICAgICAqIG1ldGhvZCB0byBjb252ZXJ0IHRvIGEgamF2YS5zcWwuRGF0ZS9U\naW1lL1RpbWVzdGFtcCBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgcGFyc2VKREJDVGVtcG9yYWxTeW50YXgoU3RyaW5nIHMp\nIHsKICAgICAgICBzID0gY2xpcChzLnRyaW0oKSwgInsiLCAifSIsIHRydWUp\nOwogICAgICAgIGlmIChzLnN0YXJ0c1dpdGgoInRzIikpIHsKICAgICAgICAg\nICAgcmV0dXJuIGphdmEuc3FsLlRpbWVzdGFtcC52YWx1ZU9mKGNsaXAocy5z\ndWJzdHJpbmcoMikudHJpbSgpLCAiJyIsICInIiwgZmFsc2UpKTsKICAgICAg\nICB9IGVsc2UgaWYgKHMuc3RhcnRzV2l0aCgiZCIpKSB7CiAgICAgICAgICAg\nIHJldHVybiBqYXZhLnNxbC5EYXRlLnZhbHVlT2YoY2xpcChzLnN1YnN0cmlu\nZygxKS50cmltKCksICInIiwgIiciLCBmYWxzZSkpOwogICAgICAgIH0gZWxz\nZSBpZiAocy5zdGFydHNXaXRoKCJ0IikpIHsKICAgICAgICAgICAgcmV0dXJu\nIGphdmEuc3FsLlRpbWUudmFsdWVPZihjbGlwKHMuc3Vic3RyaW5nKDIpLnRy\naW0oKSwgIiciLCAiJyIsIGZhbHNlKSk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIFN0cmluZyBpcyBl\nbmNsb3NlZCBpbiB7fS4KICAgICAqIAogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGJvb2xlYW4gaXNKREJDVGVtcG9yYWxTeW50YXgoU3RyaW5nIHMpIHsK\nICAgICAgICBpZiAocyAhPSBudWxsKSB7CiAgICAgICAgICAgIHMgPSBzLnRy\naW0oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHMgIT0gbnVsbCAmJiBz\nLnN0YXJ0c1dpdGgoInsiKSAmJiBzLmVuZHNXaXRoKCJ9Iik7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogUmVtb3ZlcyB0aGUgZmlyc3QgYW5kIGxhc3Qg\nc3RyaW5nIGlmIHRoZXkgYXJlIHRoZSB0ZXJtaW5hbCBzZXF1ZW5jZSBpbiB0\naGUgZ2l2ZW4gc3RyaW5nLgogICAgICogCiAgICAgKiBAcGFyYW0gcyBhIHN0\ncmluZyB0byBiZSBleGFtaW5lZAogICAgICogQHBhcmFtIGZpcnN0IHRoZSBj\naGFyYWN0ZXJzIGluIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdpdmVuIHN0cmlu\nZwogICAgICogQHBhcmFtIGxhc3QgdGhlIGNoYXJhY3RlcnMgaW4gdGhlIGVu\nZCBvZiB0aGUgZ2l2ZW4gc3RyaW5nCiAgICAgKiBAcGFyYW0gZmFpbCBpZiB0\ncnVlIHRocm93cyBleGNlcHRpb24gaWYgdGhlIGdpdmVuIHN0cmluZyBkb2Vz\nIG5vdCBoYXZlIHRoZSBnaXZlbiB0ZXJtaW5hbCBzZXF1ZW5jZXMuCiAgICAg\nKiBAcmV0dXJuIHRoZSBzdHJpbmcgd2l0aCB0ZXJtaW5hbCBzZXF1ZW5jZXMg\ncmVtb3ZlZC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgY2xp\ncChTdHJpbmcgcywgU3RyaW5nIGZpcnN0LCBTdHJpbmcgbGFzdCwgYm9vbGVh\nbiBmYWlsKSB7CiAgICAgICAgaWYgKHMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHM7CiAgICAgICAgaWYgKHMuc3RhcnRzV2l0aChmaXJzdCkgJiYg\ncy5lbmRzV2l0aChsYXN0KSkgewogICAgICAgICAgICByZXR1cm4gcy5zdWJz\ndHJpbmcoZmlyc3QubGVuZ3RoKCksIHMubGVuZ3RoKCktbGFzdC5sZW5ndGgo\nKSkudHJpbSgpOwogICAgICAgIH0KICAgICAgICBpZiAoZmFpbCkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKHMg\nKyAiIGlzIG5vdCB2YWxpZCBlc2NhcGUgc3ludGF4IGZvciBKREJDIik7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBzOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIERhdGEsIFRp\nbWUgb3IgVGltZXN0YW1wLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJv\nb2xlYW4gaXNUZW1wb3JhbFR5cGUoQ2xhc3M8Pz4gYykgewogICAgICAgIHJl\ndHVybiBjICE9IG51bGwgCiAgICAgICAgICAgICYmIChEYXRlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oYykgCiAgICAgICAgICAgICB8fCBUaW1lLmNsYXNz\nLmlzQXNzaWduYWJsZUZyb20oYykgCiAgICAgICAgICAgICB8fCBUaW1lc3Rh\nbXAuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjKSk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

