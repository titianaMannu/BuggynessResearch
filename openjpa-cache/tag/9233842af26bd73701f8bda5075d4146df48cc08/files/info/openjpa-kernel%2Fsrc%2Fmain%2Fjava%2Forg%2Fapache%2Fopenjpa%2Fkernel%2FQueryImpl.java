{"sha":"4b75c997fa867243f606589b657268af40089997","node_id":"MDQ6QmxvYjIwNjM2NDo0Yjc1Yzk5N2ZhODY3MjQzZjYwNjU4OWI2NTcyNjhhZjQwMDg5OTk3","size":73793,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4b75c997fa867243f606589b657268af40089997","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdEl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLk9iamVjdFV0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNl\nQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5MaXRlcmFsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhcmFtZXRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXRoOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlF1ZXJ5RXhwcmVzc2lv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFs\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5qcHFsLkpQUUxF\neHByZXNzaW9uQnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9w\nLkVhZ2VyUmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIucm9wLk1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmFuZ2VSZXN1bHRPYmplY3RQcm92\naWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3Vs\ndExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1\nbHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNldDsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LmxvY2tzLlJlZW50cmFudExvY2s7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob25V\nbmlxdWVSZXN1bHRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5Ob1Jlc3VsdEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQg\nc2VycC51dGlsLk51bWJlcnM7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsK\nCi8qKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUge0BsaW5rIFF1ZXJ5fSBp\nbnRlcmZhY2UuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFk\nb2MKICovCnB1YmxpYyBjbGFzcyBRdWVyeUltcGwKICAgIGltcGxlbWVudHMg\nUXVlcnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoUXVlcnlJbXBsLmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBfbGFuZ3VhZ2U7CiAgICBwcml2\nYXRlIGZpbmFsIFN0b3JlUXVlcnkgX3N0b3JlUXVlcnk7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBmaW5hbCBCcm9rZXJJbXBsIF9icm9rZXI7CiAgICBwcml2\nYXRlIHRyYW5zaWVudCBmaW5hbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgdHJh\nbnNpZW50IENsYXNzTG9hZGVyIF9sb2FkZXIgPSBudWxsOwoKICAgIC8vIHF1\nZXJ5IGhhcyBpdHMgb3duIGludGVybmFsIGxvY2sKICAgIHByaXZhdGUgUmVl\nbnRyYW50TG9jayBfbG9jazsKCiAgICAvLyB1bnBhcnNlZCBzdGF0ZQogICAg\ncHJpdmF0ZSBDbGFzcyBfY2xhc3MgPSBudWxsOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9zdWJjbGFzc2VzID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBf\ncmVhZE9ubHkgPSBmYWxzZTsKICAgIHByaXZhdGUgU3RyaW5nIF9xdWVyeSA9\nIG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFyYW1zID0gbnVsbDsKCiAg\nICAvLyBwYXJzZWQgc3RhdGUKICAgIHByaXZhdGUgdHJhbnNpZW50IENvbXBp\nbGF0aW9uIF9jb21waWxlZCA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVu\ndCBib29sZWFuIF9jb21waWxpbmcgPSBmYWxzZTsKICAgIHByaXZhdGUgdHJh\nbnNpZW50IFJlc3VsdFBhY2tlciBfcGFja2VyID0gbnVsbDsKCiAgICAvLyBj\nYW5kaWRhdGVzCiAgICBwcml2YXRlIHRyYW5zaWVudCBDb2xsZWN0aW9uIF9j\nb2xsZWN0aW9uID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IEV4dGVu\ndCBfZXh0ZW50ID0gbnVsbDsKCiAgICAvLyBsaXN0ZW5lcnMKICAgIHByaXZh\ndGUgTWFwIF9maWx0TGlzdGVuZXJzID0gbnVsbDsKICAgIHByaXZhdGUgTWFw\nIF9hZ2dMaXN0ZW5lcnMgPSBudWxsOwoKICAgIC8vIGNvbmZpZ3VyYXRpb24g\nZm9yIGxvYWRpbmcgb2JqZWN0cwogICAgcHJpdmF0ZSBGZXRjaENvbmZpZ3Vy\nYXRpb24gX2ZjID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaWdub3Jl\nQ2hhbmdlcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBDbGFzcyBfcmVzdWx0TWFw\ncGluZ1Njb3BlID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9yZXN1bHRN\nYXBwaW5nTmFtZSA9IG51bGw7CgogICAgLy8gdGhlc2UgZmllbGRzIHNob3Vs\nZCBvbmx5IGJlIHVzZWQgZGlyZWN0bHkgYWZ0ZXIgd2UgaGF2ZSBhIGNvbXBp\nbGF0aW9uLAogICAgLy8gYmVjYXVzZSB0aGVpciB2YWx1ZXMgbWF5IGJlIGVu\nY29kZWQgaW4gdGhlIHF1ZXJ5IHN0cmluZwogICAgcHJpdmF0ZSBCb29sZWFu\nIF91bmlxdWUgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfcmVzdWx0Q2xh\nc3MgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgbG9uZyBfc3RhcnRJ\nZHggPSAwOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgbG9uZyBfZW5kSWR4ID0g\nTG9uZy5NQVhfVkFMVUU7CiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFu\nIF9yYW5nZVNldCA9IGZhbHNlOwoKICAgIC8vIHJlbWVtYmVyIHRoZSBsaXN0\nIG9mIGFsbCB0aGUgcmVzdWx0cyB3ZSBoYXZlIHJldHVybmVkIHNvIHdlCiAg\nICAvLyBjYW4gZnJlZSB0aGVpciByZXNvdXJjZXMgd2hlbiBjbG9zZSBvciBj\nbG9zZUFsbCBpcyBjYWxsZWQKICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFs\nIENvbGxlY3Rpb24gX3Jlc3VsdExpc3RzID0gbmV3IFJlZmVyZW5jZUhhc2hT\nZXQKICAgICAgICAoUmVmZXJlbmNlSGFzaFNldC5XRUFLKTsKCiAgICAvKioK\nICAgICAqIENvbnN0cnVjdCBhIHF1ZXJ5IG1hbmFnZWQgYnkgdGhlIGdpdmVu\nIGJyb2tlci4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5SW1wbChCcm9rZXIg\nYnJva2VyLCBTdHJpbmcgbGFuZ3VhZ2UsIFN0b3JlUXVlcnkgc3RvcmVRdWVy\neSkgewogICAgICAgIF9icm9rZXIgPSAoQnJva2VySW1wbCkgYnJva2VyOwog\nICAgICAgIF9sYW5ndWFnZSA9IGxhbmd1YWdlOwogICAgICAgIF9zdG9yZVF1\nZXJ5ID0gc3RvcmVRdWVyeTsKICAgICAgICBfZmMgPSAoRmV0Y2hDb25maWd1\ncmF0aW9uKSBicm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuY2xvbmUo\nKTsKICAgICAgICBfbG9nID0gYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5n\nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX1FVRVJZKTsKICAgICAg\nICBfc3RvcmVRdWVyeS5zZXRDb250ZXh0KHRoaXMpOwoKICAgICAgICBpZiAo\nX2Jyb2tlciAhPSBudWxsICYmIF9icm9rZXIuZ2V0TXVsdGl0aHJlYWRlZCgp\nKQogICAgICAgICAgICBfbG9jayA9IG5ldyBSZWVudHJhbnRMb2NrKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yZSBxdWVyeS4KICAg\nICAqLwogICAgcHVibGljIFN0b3JlUXVlcnkgZ2V0U3RvcmVRdWVyeSgpIHsK\nICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnk7CiAgICB9CgogICAgcHVibGlj\nIEJyb2tlciBnZXRCcm9rZXIoKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXI7\nCiAgICB9CgogICAgcHVibGljIFF1ZXJ5IGdldFF1ZXJ5KCkgewogICAgICAg\nIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQg\nZ2V0U3RvcmVDb250ZXh0KCkgewogICAgICAgIHJldHVybiBfYnJva2VyOwog\nICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0TGFuZ3VhZ2UoKSB7CiAgICAg\nICAgcmV0dXJuIF9sYW5ndWFnZTsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hD\nb25maWd1cmF0aW9uIGdldEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UXVl\ncnlTdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBnZXRJZ25vcmVDaGFuZ2VzKCkgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gX2lnbm9yZUNoYW5nZXM7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0SWdub3JlQ2hhbmdlcyhib29s\nZWFuIGZsYWcpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAvLyBhbGxvd2Vk\nIG1vZGlmaWNhdGlvbjogbm8gcmVhZC1vbmx5IGNoZWNrCiAgICAgICAgICAg\nIF9pZ25vcmVDaGFuZ2VzID0gZmxhZzsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNSZWFkT25seSgpIHsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgcmV0dXJuIF9yZWFkT25seTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRSZWFkT25seShib29sZWFuIGZsYWcpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgICAgICBfcmVhZE9ubHkgPSBmbGFnOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBhZGRGaWx0ZXJMaXN0ZW5lcihGaWx0ZXJMaXN0\nZW5lciBsaXN0ZW5lcikgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2Vy\ndE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAgIGlmIChfZmlsdExpc3RlbmVy\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZpbHRMaXN0ZW5lcnMgPSBu\nZXcgSGFzaE1hcCg1KTsKICAgICAgICAgICAgX2ZpbHRMaXN0ZW5lcnMucHV0\nKGxpc3RlbmVyLmdldFRhZygpLCBsaXN0ZW5lcik7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHJlbW92ZUZpbHRlckxpc3RlbmVyKEZpbHRlckxp\nc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNz\nZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgaWYgKF9maWx0TGlzdGVu\nZXJzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZmlsdExpc3RlbmVycy5y\nZW1vdmUobGlzdGVuZXIuZ2V0VGFnKCkpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgQ29sbGVjdGlvbiBnZXRGaWx0ZXJMaXN0ZW5lcnMoKSB7CiAgICAg\nICAgcmV0dXJuIChfZmlsdExpc3RlbmVycyA9PSBudWxsKSA/IENvbGxlY3Rp\nb25zLkVNUFRZX0xJU1QKICAgICAgICAgICAgOiBfZmlsdExpc3RlbmVycy52\nYWx1ZXMoKTsKICAgIH0KCiAgICBwdWJsaWMgRmlsdGVyTGlzdGVuZXIgZ2V0\nRmlsdGVyTGlzdGVuZXIoU3RyaW5nIHRhZykgewogICAgICAgIC8vIGZpcnN0\nIGNoZWNrIGxpc3RlbmVycyBmb3IgdGhpcyBxdWVyeQogICAgICAgIGlmIChf\nZmlsdExpc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgIEZpbHRlckxp\nc3RlbmVyIGxpc3RlbiA9IChGaWx0ZXJMaXN0ZW5lcikgX2ZpbHRMaXN0ZW5l\ncnMuZ2V0KHRhZyk7CiAgICAgICAgICAgIGlmIChsaXN0ZW4gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBsaXN0ZW47CiAgICAgICAgfQoKICAg\nICAgICAvLyBjaGVjayB1c2VyLWRlZmluZWQgbGlzdGVuZXJzIGZyb20gY29u\nZmlndXJhdGlvbgogICAgICAgIEZpbHRlckxpc3RlbmVyW10gY29uZkxpc3Rl\nbmVycyA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAg\nICBnZXRGaWx0ZXJMaXN0ZW5lckluc3RhbmNlcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY29uZkxpc3RlbmVycy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKGNvbmZMaXN0ZW5lcnNbaV0uZ2V0VGFnKCkuZXF1YWxz\nKHRhZykpCiAgICAgICAgICAgICAgICByZXR1cm4gY29uZkxpc3RlbmVyc1tp\nXTsKCiAgICAgICAgLy8gY2hlY2sgc3RvcmUgbGlzdGVuZXJzCiAgICAgICAg\ncmV0dXJuIF9zdG9yZVF1ZXJ5LmdldEZpbHRlckxpc3RlbmVyKHRhZyk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYWRkQWdncmVnYXRlTGlzdGVuZXIoQWdn\ncmVnYXRlTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nICAgICBhc3NlcnROb3RSZWFkT25seSgpOwogICAgICAgICAgICBpZiAoX2Fn\nZ0xpc3RlbmVycyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2FnZ0xpc3Rl\nbmVycyA9IG5ldyBIYXNoTWFwKDUpOwogICAgICAgICAgICBfYWdnTGlzdGVu\nZXJzLnB1dChsaXN0ZW5lci5nZXRUYWcoKSwgbGlzdGVuZXIpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVBZ2dyZWdhdGVMaXN0ZW5l\ncihBZ2dyZWdhdGVMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAgIGlm\nIChfYWdnTGlzdGVuZXJzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWdn\nTGlzdGVuZXJzLnJlbW92ZShsaXN0ZW5lci5nZXRUYWcoKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldEFnZ3JlZ2F0ZUxpc3Rl\nbmVycygpIHsKICAgICAgICByZXR1cm4gKF9hZ2dMaXN0ZW5lcnMgPT0gbnVs\nbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUCiAgICAgICAgICAgIDogX2Fn\nZ0xpc3RlbmVycy52YWx1ZXMoKTsKICAgIH0KCiAgICBwdWJsaWMgQWdncmVn\nYXRlTGlzdGVuZXIgZ2V0QWdncmVnYXRlTGlzdGVuZXIoU3RyaW5nIHRhZykg\newogICAgICAgIC8vIGZpcnN0IGNoZWNrIGxpc3RlbmVycyBmb3IgdGhpcyBx\ndWVyeQogICAgICAgIGlmIChfYWdnTGlzdGVuZXJzICE9IG51bGwpIHsKICAg\nICAgICAgICAgQWdncmVnYXRlTGlzdGVuZXIgbGlzdGVuID0gKEFnZ3JlZ2F0\nZUxpc3RlbmVyKSBfYWdnTGlzdGVuZXJzLgogICAgICAgICAgICAgICAgZ2V0\nKHRhZyk7CiAgICAgICAgICAgIGlmIChsaXN0ZW4gIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBsaXN0ZW47CiAgICAgICAgfQoKICAgICAgICAv\nLyBjaGVjayB1c2VyLWRlZmluZWQgbGlzdGVuZXJzIGZyb20gY29uZmlndXJh\ndGlvbgogICAgICAgIEFnZ3JlZ2F0ZUxpc3RlbmVyW10gY29uZkxpc3RlbmVy\ncyA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBn\nZXRBZ2dyZWdhdGVMaXN0ZW5lckluc3RhbmNlcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY29uZkxpc3RlbmVycy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKGNvbmZMaXN0ZW5lcnNbaV0uZ2V0VGFnKCkuZXF1YWxz\nKHRhZykpCiAgICAgICAgICAgICAgICByZXR1cm4gY29uZkxpc3RlbmVyc1tp\nXTsKCiAgICAgICAgLy8gY2hlY2sgc3RvcmUgbGlzdGVuZXJzCiAgICAgICAg\ncmV0dXJuIF9zdG9yZVF1ZXJ5LmdldEFnZ3JlZ2F0ZUxpc3RlbmVyKHRhZyk7\nCiAgICB9CgogICAgcHVibGljIEV4dGVudCBnZXRDYW5kaWRhdGVFeHRlbnQo\nKSB7CiAgICAgICAgLy8gaWYganVzdCB0aGUgY2xhc3MgaXMgc2V0LCBmZXRj\naCB0aGUgY29ycmVzcG9uZGluZyBleHRlbnQ7IGlmIHRoZQogICAgICAgIC8v\nIGV4dGVudCBpcyBhbHJlYWR5IHNldCBidXQgaXRzIGlnbm9yZSBjYWNoZSBz\nZXR0aW5nIGlzIHdyb25nLAogICAgICAgIC8vIGdldCBhIG5ldyBleHRlbnQg\nd2l0aCB0aGUgY29ycmVjdCBzZXR0aW5nIChkb24ndCBtb2RpZnkgb3JpZyBl\neHRlbnQKICAgICAgICAvLyBpbiBjYXNlIHRoZSB1c2VyIGhhcyBhIHJlZmVy\nZW5jZSB0byBpdCBhbmQgbWlnaHQgdXNlIGl0KQogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzcyBjbHMgPSBnZXRDYW5k\naWRhdGVUeXBlKCk7CiAgICAgICAgICAgIGlmIChfZXh0ZW50ID09IG51bGwg\nJiYgX2NvbGxlY3Rpb24gPT0gbnVsbCAmJiBfYnJva2VyICE9IG51bGwKICAg\nICAgICAgICAgICAgICYmIGNscyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBfZXh0ZW50ID0gX2Jyb2tlci5uZXdFeHRlbnQoY2xzLCBfc3ViY2xhc3Nl\ncyk7CiAgICAgICAgICAgICAgICBfZXh0ZW50LnNldElnbm9yZUNoYW5nZXMo\nX2lnbm9yZUNoYW5nZXMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9leHRl\nbnQgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgX2V4dGVudC5nZXRJZ25v\ncmVDaGFuZ2VzKCkgIT0gX2lnbm9yZUNoYW5nZXMgJiYgY2xzICE9IG51bGwp\newogICAgICAgICAgICAgICAgX2V4dGVudCA9IF9icm9rZXIubmV3RXh0ZW50\nKGNscywgX2V4dGVudC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAg\nICAgX2V4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX2V4dGVudDsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2FuZGlkYXRlRXh0ZW50\nKEV4dGVudCBjYW5kaWRhdGVFeHRlbnQpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nICAgICBhc3NlcnROb3RSZWFkT25seSgpOwoKICAgICAgICAgICAgaWYgKGNh\nbmRpZGF0ZUV4dGVudCA9PSBfZXh0ZW50KQogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBpZiAoY2FuZGlkYXRlRXh0ZW50ID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIF9leHRlbnQgPSBudWxsOwogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBp\nZiBleHRlbnQgdGhlbiBub3QgY29sbGVjdGlvbgogICAgICAgICAgICBfZXh0\nZW50ID0gY2FuZGlkYXRlRXh0ZW50OwogICAgICAgICAgICBfY29sbGVjdGlv\nbiA9IG51bGw7CgogICAgICAgICAgICBib29sZWFuIGludmFsaWRhdGUgPSBm\nYWxzZTsKICAgICAgICAgICAgaWYgKF9leHRlbnQuZ2V0RWxlbWVudFR5cGUo\nKSAhPSBfY2xhc3MpIHsKICAgICAgICAgICAgICAgIF9jbGFzcyA9IF9leHRl\nbnQuZ2V0RWxlbWVudFR5cGUoKTsKICAgICAgICAgICAgICAgIF9sb2FkZXIg\nPSBudWxsOwogICAgICAgICAgICAgICAgaW52YWxpZGF0ZSA9IHRydWU7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9leHRlbnQuaGFzU3ViY2xh\nc3NlcygpICE9IF9zdWJjbGFzc2VzKSB7CiAgICAgICAgICAgICAgICBfc3Vi\nY2xhc3NlcyA9IF9leHRlbnQuaGFzU3ViY2xhc3NlcygpOwogICAgICAgICAg\nICAgICAgaW52YWxpZGF0ZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKGludmFsaWRhdGUpCiAgICAgICAgICAgICAgICBpbnZhbGlk\nYXRlQ29tcGlsYXRpb24oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENv\nbGxlY3Rpb24gZ2V0Q2FuZGlkYXRlQ29sbGVjdGlvbigpIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9jb2xsZWN0aW9uOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldENhbmRpZGF0ZUNvbGxlY3Rpb24oQ29s\nbGVjdGlvbiBjYW5kaWRhdGVDb2xsZWN0aW9uKSB7CiAgICAgICAgaWYgKCFf\nc3RvcmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndCgicXVlcnktbm9zdXBwb3J0IiwKICAgICAgICAgICAgICAgIF9sYW5ndWFn\nZSkpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgLy8gaWYgY29sbGVjdGlv\nbiB0aGVuIG5vdCBleHRlbnQKICAgICAgICAgICAgX2NvbGxlY3Rpb24gPSBj\nYW5kaWRhdGVDb2xsZWN0aW9uOwogICAgICAgICAgICBpZiAoX2NvbGxlY3Rp\nb24gIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9leHRlbnQgPSBudWxsOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0Q2FuZGlkYXRlVHlw\nZSgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBpZiAoX2NsYXNzICE9IG51\nbGwgfHwgX2NvbXBpbGVkICE9IG51bGwgfHwgX3F1ZXJ5ID09IG51bGwKICAg\nICAgICAgICAgICAgIHx8IF9icm9rZXIgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBfY2xhc3M7CgogICAgICAgICAgICAvLyBjaGVjayBhZ2Fp\nbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcK\nICAgICAgICAgICAgY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAgICAgICAg\nICAgIHJldHVybiBfY2xhc3M7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldENhbmRpZGF0ZVR5cGUoQ2xhc3MgY2FuZGlkYXRlQ2xhc3MsIGJv\nb2xlYW4gc3VicykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5v\ndFJlYWRPbmx5KCk7CiAgICAgICAgICAgIF9jbGFzcyA9IGNhbmRpZGF0ZUNs\nYXNzOwogICAgICAgICAgICBfc3ViY2xhc3NlcyA9IHN1YnM7CiAgICAgICAg\nICAgIF9sb2FkZXIgPSBudWxsOwogICAgICAgICAgICBpbnZhbGlkYXRlQ29t\ncGlsYXRpb24oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naGFzU3ViY2xhc3NlcygpIHsKICAgICAgICByZXR1cm4gX3N1YmNsYXNzZXM7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRSZXN1bHRNYXBwaW5nTmFt\nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9y\nZXN1bHRNYXBwaW5nTmFtZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0\nUmVzdWx0TWFwcGluZ1Njb3BlKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICByZXR1cm4gX3Jlc3VsdE1hcHBpbmdTY29wZTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRSZXN1bHRNYXBwaW5nKENsYXNzIHNjb3BlLCBT\ndHJpbmcgbmFtZSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIF9yZXN1bHRN\nYXBwaW5nU2NvcGUgPSBzY29wZTsKICAgICAgICAgICAgX3Jlc3VsdE1hcHBp\nbmdOYW1lID0gbmFtZTsKICAgICAgICAgICAgX3BhY2tlciA9IG51bGw7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVW5pcXVlKCkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfdW5pcXVlICE9IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gX3VuaXF1ZS5ib29sZWFuVmFsdWUoKTsK\nICAgICAgICAgICAgaWYgKChfcXVlcnkgPT0gbnVsbCAmJiBfbGFuZ3VhZ2Uu\nZW5kc1dpdGgoIkpQUUwiKSkgfHwgX2NvbXBpbGluZyB8fCBfYnJva2VyID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nICAgICAvLyBjaGVjayBhZ2FpbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUg\nZW5jb2RlZCBpbiBzdHJpbmcKICAgICAgICAgICAgaWYgKF9jb21waWxlZCA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb21waWxlRm9yQ29tcGlsYXRp\nb24oKTsKICAgICAgICAgICAgICAgIGlmIChfdW5pcXVlICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIF91bmlxdWUuYm9vbGVhblZhbHVl\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vIGV4cGxpY2l0\nIHNldHRpbmc7IGRlZmF1bHQKICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVj\ndXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAgICAgICAgICBp\nZiAoIWV4LmlzQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KSkKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuICFleC5oYXNH\ncm91cGluZyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEFmZmlybXMgaWYgdGhpcyBxdWVyeSBoYXMgb3JpZ2luYXRl\nZCBieSBwYXJzaW5nIGEgc3RyaW5nLWJhc2VkIHF1ZXJ5LgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc1BhcnNlZFF1ZXJ5KCkgewogICAgICAgIHJl\ndHVybiBnZXRRdWVyeVN0cmluZygpICE9IG51bGw7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0VW5pcXVlKGJvb2xlYW4gdW5pcXVlKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAg\nICAgX3VuaXF1ZSA9ICh1bmlxdWUpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENsYXNzIGdldFJl\nc3VsdFR5cGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgaWYgKF9yZXN1\nbHRDbGFzcyAhPSBudWxsIHx8IF9jb21waWxlZCAhPSBudWxsIHx8IF9xdWVy\neSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCBfYnJva2VyID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gX3Jlc3VsdENsYXNzOwoKICAgICAg\nICAgICAgLy8gY2hlY2sgYWdhaW4gYWZ0ZXIgY29tcGlsYXRpb247IG1heWJl\nIGVuY29kZWQgaW4gc3RyaW5nCiAgICAgICAgICAgIGNvbXBpbGVGb3JDb21w\naWxhdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX3Jlc3VsdENsYXNzOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZXN1bHRUeXBlKENs\nYXNzIGNscykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIC8vIGFsbG93ZWQg\nbW9kaWZpY2F0aW9uOiBubyByZWFkLW9ubHkgY2hlY2sKICAgICAgICAgICAg\nX3Jlc3VsdENsYXNzID0gY2xzOwogICAgICAgICAgICBfcGFja2VyID0gbnVs\nbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0U3RhcnRSYW5n\nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9z\ndGFydElkeDsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBnZXRFbmRSYW5nZSgp\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9lbmRJ\nZHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmFuZ2UobG9uZyBzdGFy\ndCwgbG9uZyBlbmQpIHsKICAgICAgICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA8\nIDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJpbnZhbGlkLXJhbmdlIiwKICAgICAgICAgICAgICAgIFN0cmluZy52\nYWx1ZU9mKHN0YXJ0KSwgU3RyaW5nLnZhbHVlT2YoZW5kKSkpOwoKICAgICAg\nICBpZiAoZW5kIC0gc3RhcnQgPiBJbnRlZ2VyLk1BWF9WQUxVRSAmJiBlbmQg\nIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJyYW5nZS10b28tYmlnIiwKICAgICAgICAg\nICAgICAgIFN0cmluZy52YWx1ZU9mKHN0YXJ0KSwgU3RyaW5nLnZhbHVlT2Yo\nZW5kKSkpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAvLyBhbGxvd2VkIG1v\nZGlmaWNhdGlvbjogbm8gcmVhZC1vbmx5IGNoZWNrCiAgICAgICAgICAgIF9z\ndGFydElkeCA9IHN0YXJ0OwogICAgICAgICAgICBfZW5kSWR4ID0gZW5kOwog\nICAgICAgICAgICBfcmFuZ2VTZXQgPSB0cnVlOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFBhcmFtZXRlckRlY2xhcmF0aW9uKCkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfcGFyYW1zICE9IG51bGwgfHwg\nX2NvbXBpbGVkICE9IG51bGwgfHwgX2NvbXBpbGluZwogICAgICAgICAgICAg\nICAgfHwgX2Jyb2tlciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIF9wYXJhbXM7CgogICAgICAgICAgICAvLyBjaGVjayBhZ2FpbiBhZnRlciBj\nb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcKICAgICAgICAg\nICAgY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAgIHJldHVy\nbiBfcGFyYW1zOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZWNs\nYXJlUGFyYW1ldGVycyhTdHJpbmcgcGFyYW1zKSB7CiAgICAgICAgaWYgKCFf\nc3RvcmVRdWVyeS5zdXBwb3J0c1BhcmFtZXRlckRlY2xhcmF0aW9ucygpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xv\nYy5nZXQoInF1ZXJ5LW5vc3VwcG9ydCIsCiAgICAgICAgICAgICAgICBfbGFu\nZ3VhZ2UpKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVh\nZE9ubHkoKTsKICAgICAgICAgICAgX3BhcmFtcyA9IFN0cmluZ1V0aWxzLnRy\naW1Ub051bGwocGFyYW1zKTsKICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBp\nbGF0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbXBp\nbGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVj\ndXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAgICAgICAgICBn\nZXRSZXN1bHRQYWNrZXIoX3N0b3JlUXVlcnksIGV4KTsKICAgICAgICAgICAg\nZXgudmFsaWRhdGUoX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldENvbXBpbGF0aW9uKCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZv\nckNvbXBpbGF0aW9uKCkuc3RvcmVEYXRhOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENvbXBpbGUgcXVlcnkgcHJvcGVydGllcy4KICAgICAqLwog\nICAgcHJpdmF0ZSBDb21waWxhdGlvbiBjb21waWxlRm9yQ29tcGlsYXRpb24o\nKSB7CiAgICAgICAgaWYgKF9jb21waWxlZCAhPSBudWxsIHx8IF9jb21waWxp\nbmcpCiAgICAgICAgICAgIHJldHVybiBfY29tcGlsZWQ7CgogICAgICAgIGFz\nc2VydE5vdFNlcmlhbGl6ZWQoKTsKICAgICAgICBhc3NlcnRPcGVuKCk7Cgog\nICAgICAgIGJvb2xlYW4gcmVhZE9ubHkgPSBfcmVhZE9ubHk7CiAgICAgICAg\nX3JlYWRPbmx5ID0gZmFsc2U7CiAgICAgICAgX2NvbXBpbGluZyA9IHRydWU7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2NvbXBpbGVkID0gY29tcGls\nYXRpb25Gcm9tQ2FjaGUoKTsKICAgICAgICAgICAgcmV0dXJuIF9jb21waWxl\nZDsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9jb21waWxpbmcgPSBmYWxzZTsKICAgICAgICAgICAgX3JlYWRPbmx5ID0g\ncmVhZE9ubHk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmlu\nZCB0aGUgY2FjaGVkIGNvbXBpbGF0aW9uIGZvciB0aGUgY3VycmVudCBxdWVy\neSwgY3JlYXRpbmcgb25lIGlmIGl0CiAgICAgKiBkb2VzIG5vdCBleGlzdC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIENvbXBpbGF0aW9uIGNvbXBpbGF0aW9u\nRnJvbUNhY2hlKCkgewogICAgICAgIE1hcCBjb21wQ2FjaGUgPQogICAgICAg\nICAgICBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRRdWVyeUNvbXBp\nbGF0aW9uQ2FjaGVJbnN0YW5jZSgpOwogICAgICAgIGlmIChjb21wQ2FjaGUg\nPT0gbnVsbCB8fCAhaXNQYXJzZWRRdWVyeSgpKSB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXdDb21waWxhdGlvbigpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIENvbXBpbGF0aW9uS2V5IGtleSA9IG5ldyBDb21waWxhdGlvbktl\neSgpOwogICAgICAgICAgICBrZXkucXVlcnlUeXBlID0gX3N0b3JlUXVlcnku\nZ2V0Q2xhc3MoKTsKICAgICAgICAgICAga2V5LmNhbmRpZGF0ZVR5cGUgPSBn\nZXRDYW5kaWRhdGVUeXBlKCk7CiAgICAgICAgICAgIGtleS5zdWJjbGFzc2Vz\nID0gaGFzU3ViY2xhc3NlcygpOwogICAgICAgICAgICBrZXkucXVlcnkgPSBn\nZXRRdWVyeVN0cmluZygpOwogICAgICAgICAgICBrZXkubGFuZ3VhZ2UgPSBn\nZXRMYW5ndWFnZSgpOwogICAgICAgICAgICBrZXkuc3RvcmVLZXkgPSBfc3Rv\ncmVRdWVyeS5uZXdDb21waWxhdGlvbktleSgpOwogICAgICAgICAgICBDb21w\naWxhdGlvbiBjb21wID0gKENvbXBpbGF0aW9uKSBjb21wQ2FjaGUuZ2V0KGtl\neSk7CgogICAgICAgICAgICAvLyBwYXJzZSBkZWNsYXJhdGlvbnMgaWYgbmVl\nZGVkCiAgICAgICAgICAgIGJvb2xlYW4gY2FjaGUgPSBmYWxzZTsKICAgICAg\nICAgICAgaWYgKGNvbXAgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29t\ncCA9IG5ld0NvbXBpbGF0aW9uKCk7CiAgICAgICAgICAgICAgICAvLyBvbmx5\nIGNhY2hlIHRob3NlIHF1ZXJpZXMgdGhhdCBjYW4gYmUgY29tcGlsZWQKICAg\nICAgICAgICAgICAgIGNhY2hlID0gY29tcC5zdG9yZURhdGEgIT0gbnVsbDsK\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfc3RvcmVRdWVy\neS5wb3B1bGF0ZUZyb21Db21waWxhdGlvbihjb21wLnN0b3JlRGF0YSk7Cgog\nICAgICAgICAgICAvLyBjYWNoZSBwYXJzZWQgc3RhdGUgaWYgbmVlZGVkCiAg\nICAgICAgICAgIGlmIChjYWNoZSkKICAgICAgICAgICAgICAgIGNvbXBDYWNo\nZS5wdXQoa2V5LCBjb21wKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXA7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQg\ncG9wdWxhdGUgYSBuZXcgY29tcGlsYXRpb24uCiAgICAgKi8KICAgIHByaXZh\ndGUgQ29tcGlsYXRpb24gbmV3Q29tcGlsYXRpb24oKSB7CiAgICAgICAgQ29t\ncGlsYXRpb24gY29tcCA9IG5ldyBDb21waWxhdGlvbigpOwogICAgICAgIGNv\nbXAuc3RvcmVEYXRhID0gX3N0b3JlUXVlcnkubmV3Q29tcGlsYXRpb24oKTsK\nICAgICAgICBfc3RvcmVRdWVyeS5wb3B1bGF0ZUZyb21Db21waWxhdGlvbihj\nb21wLnN0b3JlRGF0YSk7CiAgICAgICAgcmV0dXJuIGNvbXA7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb21waWxlIGZvciBleGVjdXRpb24sIGNob29zaW5n\nIGJldHdlZW4gZGF0YXN0b3JlIGFuZCBpbi1tZW0KICAgICAqIGNvbXBpbGF0\naW9uIGJhc2VkIG9uIHdoYXQgd2Ugc3VwcG9ydCBhbmQgb3VyIHNldHRpbmdz\nLgogICAgICovCiAgICBwcml2YXRlIFN0b3JlUXVlcnkuRXhlY3V0b3IgY29t\ncGlsZUZvckV4ZWN1dG9yKCkgewogICAgICAgIENvbXBpbGF0aW9uIGNvbXAg\nPSBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsKICAgICAgICBpZiAoX2NvbGxl\nY3Rpb24gPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoY29tcC5kYXRhc3Rv\ncmUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBjb21wLmRhdGFz\ndG9yZTsKICAgICAgICAgICAgaWYgKGNvbXAubWVtb3J5ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gY29tcC5tZW1vcnk7CiAgICAgICAgICAg\nIGlmIChfc3RvcmVRdWVyeS5zdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JEYXRhU3RvcmUo\nY29tcCk7CiAgICAgICAgICAgIHJldHVybiBjb21waWxlRm9ySW5NZW1vcnko\nY29tcCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29tcC5tZW1vcnkgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNvbXAubWVtb3J5OwogICAgICAg\nIGlmIChjb21wLmRhdGFzdG9yZSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gY29tcC5kYXRhc3RvcmU7CiAgICAgICAgaWYgKF9zdG9yZVF1ZXJ5LnN1\ncHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkKICAgICAgICAgICAgcmV0dXJu\nIGNvbXBpbGVGb3JJbk1lbW9yeShjb21wKTsKICAgICAgICByZXR1cm4gY29t\ncGlsZUZvckRhdGFTdG9yZShjb21wKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhbiBleHByZXNzaW9uIHRyZWUgZm9yIGRhdGFzdG9yZSBleGVj\ndXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRv\nciBjb21waWxlRm9yRGF0YVN0b3JlKENvbXBpbGF0aW9uIGNvbXApIHsKICAg\nICAgICBpZiAoY29tcC5kYXRhc3RvcmUgPT0gbnVsbCkKICAgICAgICAgICAg\nY29tcC5kYXRhc3RvcmUgPSBjcmVhdGVFeGVjdXRvcihmYWxzZSk7CiAgICAg\nICAgcmV0dXJuIGNvbXAuZGF0YXN0b3JlOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGFuIGV4cHJlc3Npb24gdHJlZSBmb3IgaW4tbWVtb3J5IGV4\nZWN1dGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdG9yZVF1ZXJ5LkV4ZWN1\ndG9yIGNvbXBpbGVGb3JJbk1lbW9yeShDb21waWxhdGlvbiBjb21wKSB7CiAg\nICAgICAgaWYgKGNvbXAubWVtb3J5ID09IG51bGwpCiAgICAgICAgICAgIGNv\nbXAubWVtb3J5ID0gY3JlYXRlRXhlY3V0b3IodHJ1ZSk7CiAgICAgICAgcmV0\ndXJuIGNvbXAubWVtb3J5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgcXVlcnkgZXhlY3V0b3Igb2YgdGhlIHByb3BlciB0eXBlLgogICAgICov\nCiAgICBwcml2YXRlIFN0b3JlUXVlcnkuRXhlY3V0b3IgY3JlYXRlRXhlY3V0\nb3IoYm9vbGVhbiBpbk1lbSkgewogICAgICAgIGFzc2VydENhbmRpZGF0ZVR5\ncGUoKTsKCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2Jy\nb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEoX2NsYXNzLAogICAgICAgICAg\nICBfYnJva2VyLmdldENsYXNzTG9hZGVyKCksIGZhbHNlKTsKCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YVtdIG1ldGFzOwogICAgICAgIGlmIChfY2xhc3MgPT0g\nbnVsbCB8fCBfc3RvcmVRdWVyeS5zdXBwb3J0c0Fic3RyYWN0RXhlY3V0b3Jz\nKCkpCiAgICAgICAgICAgIG1ldGFzID0gbmV3IENsYXNzTWV0YURhdGFbXXsg\nbWV0YSB9OwogICAgICAgIGVsc2UgaWYgKF9zdWJjbGFzc2VzICYmIChtZXRh\nID09IG51bGwgfHwgbWV0YS5pc01hbmFnZWRJbnRlcmZhY2UoKSkpCiAgICAg\nICAgICAgIG1ldGFzID0gcmVwb3MuZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXMo\nX2NsYXNzLAogICAgICAgICAgICAgICAgX2Jyb2tlci5nZXRDbGFzc0xvYWRl\ncigpLCB0cnVlKTsKICAgICAgICBlbHNlIGlmIChtZXRhICE9IG51bGwgJiYg\nKF9zdWJjbGFzc2VzIHx8IG1ldGEuaXNNYXBwZWQoKSkpCiAgICAgICAgICAg\nIG1ldGFzID0gbmV3IENsYXNzTWV0YURhdGFbXXsgbWV0YSB9OwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgbWV0YXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX01F\nVEFTOwoKICAgICAgICBpZiAobWV0YXMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1pbXBs\ncyIsIF9jbGFzcykpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICht\nZXRhcy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgaWYgKGluTWVt\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmVRdWVyeS5uZXdJ\nbk1lbW9yeUV4ZWN1dG9yKG1ldGFzWzBdLAogICAgICAgICAgICAgICAgICAg\nICAgICBfc3ViY2xhc3Nlcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3N0\nb3JlUXVlcnkubmV3RGF0YVN0b3JlRXhlY3V0b3IobWV0YXNbMF0sIF9zdWJj\nbGFzc2VzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbXVsdGlw\nbGUgaW1wbGVtZW50b3JzCiAgICAgICAgICAgIFN0b3JlUXVlcnkuRXhlY3V0\nb3JbXSBlcyA9IG5ldyBTdG9yZVF1ZXJ5LkV4ZWN1dG9yW21ldGFzLmxlbmd0\naF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpbk1lbSkKICAgICAgICAg\nICAgICAgICAgICBlc1tpXSA9IF9zdG9yZVF1ZXJ5Lm5ld0luTWVtb3J5RXhl\nY3V0b3IobWV0YXNbaV0sIHRydWUpOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIGVzW2ldID0gX3N0b3JlUXVlcnkubmV3RGF0\nYVN0b3JlRXhlY3V0b3IobWV0YXNbaV0sIHRydWUpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBuZXcgTWVyZ2VkRXhlY3V0b3IoZXMpOwog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xl\nYXIgYW55IGNvbXBpbGF0aW9uLCBmb3JjaW5nIHRoaXMgcXVlcnkgdG8gYmUg\ncmVjb21waWxlZAogICAgICogbmV4dCB0aW1lIGl0J3MgZXhlY3V0ZWQuIFRo\naXMgc2hvdWxkIGJlIGludm9rZWQgd2hlbmV2ZXIgYW55CiAgICAgKiBzdGF0\nZSBjaGFuZ2VzIHRoYXQgd291bGQgY2F1c2UgdGhlIHVuZGVybHlpbmcgcXVl\ncnkKICAgICAqIHJlcHJlc2VudGF0aW9uIHRvIGNoYW5nZS4KICAgICAqCiAg\nICAgKiBAc2luY2UgMC4zLjAKICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIGludmFsaWRhdGVDb21waWxhdGlvbigpIHsKICAgICAgICBpZiAoX2NvbXBp\nbGluZykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIF9zdG9y\nZVF1ZXJ5LmludmFsaWRhdGVDb21waWxhdGlvbigpOwogICAgICAgIF9jb21w\naWxlZCA9IG51bGw7CiAgICAgICAgX3BhY2tlciA9IG51bGw7CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBleGVjdXRl\nKCkgewogICAgICAgIHJldHVybiBleGVjdXRlKChPYmplY3RbXSkgbnVsbCk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBleGVjdXRlKE9iamVjdFtdIHBh\ncmFtcykgewogICAgICAgIHJldHVybiBleGVjdXRlKE9QX1NFTEVDVCwgcGFy\nYW1zKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGV4ZWN1dGUoTWFwIHBh\ncmFtcykgewogICAgICAgIHJldHVybiBleGVjdXRlKE9QX1NFTEVDVCwgcGFy\nYW1zKTsKICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBleGVjdXRlKGludCBv\ncGVyYXRpb24sIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIGlmIChwYXJh\nbXMgPT0gbnVsbCkKICAgICAgICAgICAgcGFyYW1zID0gU3RvcmVRdWVyeS5F\nTVBUWV9PQkpFQ1RTOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0Tm90U2VyaWFsaXplZCgpOwogICAgICAgICAg\nICBfYnJva2VyLmJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAg\nICAgICAgX2Jyb2tlci5hc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoK\nICAgICAgICAgICAgICAgIC8vIGdldCBleGVjdXRvcgogICAgICAgICAgICAg\nICAgQ29tcGlsYXRpb24gY29tcCA9IGNvbXBpbGVGb3JDb21waWxhdGlvbigp\nOwogICAgICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IChp\nc0luTWVtb3J5KG9wZXJhdGlvbikpCiAgICAgICAgICAgICAgICAgICAgPyBj\nb21waWxlRm9ySW5NZW1vcnkoY29tcCkgOiBjb21waWxlRm9yRGF0YVN0b3Jl\nKGNvbXApOwoKICAgICAgICAgICAgICAgIGFzc2VydFBhcmFtZXRlcnMoX3N0\nb3JlUXVlcnksIGV4LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2dF\neGVjdXRpb24ob3BlcmF0aW9uLCBleC5nZXRQYXJhbWV0ZXJUeXBlcyhfc3Rv\ncmVRdWVyeSksCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyk7Cgog\nICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiA9PSBPUF9TRUxFQ1QpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGUoX3N0b3JlUXVlcnks\nIGV4LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiA9\nPSBPUF9ERUxFVEUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlbGV0\nZShfc3RvcmVRdWVyeSwgZXgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBp\nZiAob3BlcmF0aW9uID09IE9QX1VQREFURSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gdXBkYXRlKF9zdG9yZVF1ZXJ5LCBleCwgcGFyYW1zKTsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigp\nOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgX2Jyb2tlci5lbmRPcGVyYXRpb24oKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0\nIGV4ZWN1dGUoaW50IG9wZXJhdGlvbiwgTWFwIHBhcmFtcykgewogICAgICAg\nIGlmIChwYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgcGFyYW1zID0gQ29s\nbGVjdGlvbnMuRU1QVFlfTUFQOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgX2Jyb2tlci5iZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGFzc2VydE5v\ndFNlcmlhbGl6ZWQoKTsKICAgICAgICAgICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICAgICAgICAgIF9icm9rZXIuYXNzZXJ0Tm9udHJhbnNhY3Rpb25h\nbFJlYWQoKTsKCiAgICAgICAgICAgICAgICAvLyBnZXQgZXhlY3V0b3IKICAg\nICAgICAgICAgICAgIENvbXBpbGF0aW9uIGNvbXAgPSBjb21waWxlRm9yQ29t\ncGlsYXRpb24oKTsKICAgICAgICAgICAgICAgIFN0b3JlUXVlcnkuRXhlY3V0\nb3IgZXggPSAoaXNJbk1lbW9yeShvcGVyYXRpb24pKQogICAgICAgICAgICAg\nICAgICAgID8gY29tcGlsZUZvckluTWVtb3J5KGNvbXApIDogY29tcGlsZUZv\nckRhdGFTdG9yZShjb21wKTsKCiAgICAgICAgICAgICAgICBhc3NlcnRQYXJh\nbWV0ZXJzKF9zdG9yZVF1ZXJ5LCBleCwgcGFyYW1zKTsKICAgICAgICAgICAg\nICAgIE9iamVjdFtdIGFyciA9IChwYXJhbXMuaXNFbXB0eSgpKSA/IFN0b3Jl\nUXVlcnkuRU1QVFlfT0JKRUNUUyA6CiAgICAgICAgICAgICAgICAgICAgZXgu\ndG9QYXJhbWV0ZXJBcnJheShfc3RvcmVRdWVyeSwgcGFyYW1zKTsKICAgICAg\nICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgbG9nRXhlY3V0aW9uKG9wZXJhdGlvbiwgcGFyYW1zKTsK\nCiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09IE9QX1NFTEVDVCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhlY3V0ZShfc3RvcmVRdWVy\neSwgZXgsIGFycik7CiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09\nIE9QX0RFTEVURSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRl\nKF9zdG9yZVF1ZXJ5LCBleCwgYXJyKTsKICAgICAgICAgICAgICAgIGlmIChv\ncGVyYXRpb24gPT0gT1BfVVBEQVRFKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB1cGRhdGUoX3N0b3JlUXVlcnksIGV4LCBhcnIpOwogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoInF1ZXJ5LWV4ZWN1dGlvbi1lcnJvciIsIAogICAg\nICAgICAgICAgICAgCQlfcXVlcnkpLCBlKTsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIF9icm9rZXIuZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgbG9uZyBkZWxldGVBbGwoKSB7CiAgICAgICAgcmV0dXJuIGRlbGV0ZUFs\nbCgoT2JqZWN0W10pIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIGRl\nbGV0ZUFsbChPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gKChO\ndW1iZXIpIGV4ZWN1dGUoT1BfREVMRVRFLCBwYXJhbXMpKS5sb25nVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBkZWxldGVBbGwoTWFwIHBhcmFt\ncykgewogICAgICAgIHJldHVybiAoKE51bWJlcikgZXhlY3V0ZShPUF9ERUxF\nVEUsIHBhcmFtcykpLmxvbmdWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBs\nb25nIHVwZGF0ZUFsbCgpIHsKICAgICAgICByZXR1cm4gdXBkYXRlQWxsKChP\nYmplY3RbXSkgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGxvbmcgdXBkYXRl\nQWxsKE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHJldHVybiAoKE51bWJl\ncikgZXhlY3V0ZShPUF9VUERBVEUsIHBhcmFtcykpLmxvbmdWYWx1ZSgpOwog\nICAgfQoKICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbChNYXAgcGFyYW1zKSB7\nCiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBleGVjdXRlKE9QX1VQREFURSwg\ncGFyYW1zKSkubG9uZ1ZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZXJ0cyB0aGUgdmFsdWVzIG9mIGdpdmVuIDxjb2RlPnBhcmFtczwvY29k\nZT4gTWFwIGludG8gYW4gYXJyYXkgaW4KICAgICAqIGNvbnN1bHRhdGlvbiBv\nZiB0aGUgPGNvZGU+cGFyYW1UeXBlczwvY29kZT4gTWFwLgogICAgICogCiAg\nICAgKiBUaGUgaW5kZXhpbmcgb2YgdGhlIHJlc3VsdGFudCBhcnJheSBpcyBz\naWduaWZpY2FudCBmb3IgZm9sbG93aW5nIAogICAgICogaW50ZXJyZWxhdGVk\nIGJ1dCB0YWNpdCBhc3N1bXB0aW9uczoKICAgICAqIFRoZSB2YWx1ZXMgaW4g\ndGhlIHJldHVybmVkIE9iamVjdFtdIGlzIGNvbnN1bWVkIGJ5IHtAbGluayBQ\nYXJhbWV0ZXJ9CiAgICAgKiBleHByZXNzaW9ucy4gUXVlcnkgcGFyc2luZyBj\ncmVhdGVzIHRoZXNlIFBhcmFtZXRlcnMgYW5kIHNldHMgdGhlaXIKICAgICAq\nIGtleSBhbmQgaW5kZXguIFRoZSBpbmRleCBzZXQgb24gdGhlIFBhcmFtZXRl\nciBieSB0aGUgcGFyc2VyIGlzIHRoZQogICAgICogc2FtZSBpbmRleCB1c2Vk\nIHRvIGFjY2VzcyB0aGUgT2JqZWN0W10gZWxlbWVudHMgcmV0dXJuZWQgYnkg\ndGhpcyBtZXRob2QuCiAgICAgKiAKICAgICAqIHtAbGluayBKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXJ9IGNyZWF0ZXMgYW5kIHBvcHVsYXRlcyBwYXJhbWV0ZXJz\nIGFzCiAgICAgKiBmb2xsb3dzOiAKICAgICAqIFRoZSBwYXJhbWV0ZXIga2V5\nIGlzIG5vdCB0aGUgdG9rZW4gZW5jb3VudGVyZWQgYnkgdGhlIHBhcnNlciwg\nYnV0IAogICAgICogY29udmVydGVkIHRvIEludGVnZXIgb3IgU3RyaW5nIGJh\nc2VkIG9uIHRoZSBjb250ZXh0IGluIHdoaWNoIHRoZSB0b2tlbiAKICAgICAq\nIGFwcGVhcmVkLiAKICAgICAqIFRoZSBpbmRleCBmb3IgcG9zaXRpb25hbCAo\nSW50ZWdlcikgcGFyYW1ldGVyIGlzIHRoZSB2YWx1ZSBvZiB0aGUga2V5ICAg\nCiAgICAgKiBtaW51cyAxLiAKICAgICAqIFRoZSBpbmRleCBmb3IgbmFtZWQg\nKFN0cmluZykgcGFyYW1ldGVyIGlzIHRoZSBvcmRlciBpbiB3aGljaCB0aGUg\nIAogICAgICogdG9rZW4gYXBwZWFyZWQgdG8gcGFyc2VyIGR1cmluZyBzY2Fu\nbmluZy4gCiAgICAgKiAKICAgICAqIAogICAgICogVGhlIGZpcnN0IExpbmtl\nZE1hcCBhcmd1bWVudCB0byB0aGlzIG1ldGhvZCBpcyB0aGUgcmVzdWx0IG9m\nIHBhcnNpbmcuCiAgICAgKiBUaGlzIExpbmtlZE1hcCBjb250YWlucyB0aGUg\ncGFyYW1ldGVyIGtleSBhbmQgdGhlaXIgZXhwZWN0ZWQgCiAgICAgKiAoaWYg\nZGV0ZXJtaW5hYmxlKSB2YWx1ZSB0eXBlcy4gVGhhdCBpdCBpcyBhIExpbmtl\nZE1hcCBwb2ludHMgdG8gdGhlIAogICAgICogZmFjdCB0aGF0IGFuIG9yZGVy\naW5nIGlzIGltcGxpY2l0LiBUaGUgb3JkZXJpbmcgb2YgdGhlIGtleXMgaW4g\ndGhpcyBNYXAgCiAgICAgKiBpcyB0aGUgc2FtZSBhcyB0aGUgb3JkZXIgaW4g\nd2hpY2ggcGFyc2VyIGVuY291bnRlcmVkIHRoZSBwYXJhbWV0ZXIKICAgICAq\nIHRva2Vucy4KICAgICAqIAogICAgICogRm9yIGV4YW1wbGUsIHBhcnNpbmcg\ncmVzdWx0IG9mIHRoZSBmb2xsb3dpbmcgdHdvIEpQUUwgcXVlcmllcwogICAg\nICogICBhKSBVUERBVEUgQ29tcFVzZXIgZSBTRVQgZS5uYW1lPSA/MSwgZS5h\nZ2UgPSA/MiBXSEVSRSBlLnVzZXJpZCA9ID8zCiAgICAgKiAgIGIpIFVQREFU\nRSBDb21wVXNlciBlIFNFVCBlLm5hbWU9IDpuYW1lLCBlLmFnZSA9IDphZ2Ug\nV0hFUkUgZS51c2VyaWQgPQogICAgICogICAgICAgICAgOmlkCiAgICAgKiBU\naGUgcGFyYW1ldGVyIGtleXMgd2lsbCBhcHBlYXIgaW4gdGhlIG9yZGVyICgz\nLDIsMSkgb3IgKDppZCwgOm5hbWUsIDphZ2UpCiAgICAgKiBpbiB0aGUgZ2l2\nZW4gTGlua2VkTWFwIGJlY2F1c2UgV0hFUkUgY2xhdXNlIGlzIHBhcnNlZCBi\nZWZvcmUgU0VUIGNsYXVzZS4KICAgICAqIFRoZSBjb3JyZXNwb25kaW5nIFBh\ncmFtZXRlciBFeHByZXNzaW9ucyBjcmVhdGVkIGJ5IHRoZSBwYXJzZXIgd2ls\nbCBoYXZlCiAgICAgKiBmb2xsb3dpbmcga2V5IGFuZCBpbmRleDoKICAgICAq\nICAgIGEpIDE6MCwgMjoxLCAzOjIKICAgICAqICAgIGIpIG5hbWU6MSwgYWdl\nOjIsIGlkOjAKICAgICAqICAgIAogICAgICogVGhlIHB1cnBvc2Ugb2YgdGhp\ncyBtZXRob2QgaXMgdG8gcHJvZHVjZSBhbiBPYmplY3RbXSB3aXRoIGFuIGlu\nZGV4aW5nCiAgICAgKiBzY2hlbWUgdGhhdCBtYXRjaGVzIHRoZSBpbmRleGlu\nZyBvZiB0aGUgUGFyYW1ldGVyIEV4cHJlc3Npb24uCiAgICAgKiBUaGUgdXNl\nciBtYXAgKHRoZSBzZWNvbmQgYXJndW1lbnQpIHNob3VsZCBwcm9kdWNlIHRo\nZSBmb2xsb3dpbmcgT2JqZWN0W10KICAgICAqIGluIHR3byBhYm92ZS1tZW50\naW9uZWQgY2FzZXMKICAgICAqICAgYSkgezE6IlNoYW5ub24iLDI6MjksMzo1\nMDMyfSAtLT4gWyJTaGFubm9uIiwgMjksIDUwMzJdCiAgICAgKiAgIGIpIHsi\nbmFtZSI6IlNoYW5ub24iLCAiYWdlIjoyOSwgImlkIjo1MDMyfSAtLT4gWzUw\nMzIsICJTaGFubm9uIiwgMjldCiAgICAgKiAgIAogICAgICovCgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gd2hldGhlciB3ZSBzaG91bGQgZXhlY3V0ZSB0aGlz\nIHF1ZXJ5IGluIG1lbW9yeS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIGlzSW5NZW1vcnkoaW50IG9wZXJhdGlvbikgewogICAgICAgIC8vIGlmIHRo\nZXJlIGFyZSBhbnkgZGlydHkgaW5zdGFuY2VzIGluIHRoZSBjdXJyZW50IHRy\nYW5zIHRoYXQgYXJlCiAgICAgICAgLy8gaW52b2x2ZWQgaW4gdGhpcyBxdWVy\neSwgd2UgaGF2ZSB0byBleGVjdXRlIGluIG1lbW9yeSBvciBmbHVzaAogICAg\nICAgIGJvb2xlYW4gaW5NZW0gPSAhX3N0b3JlUXVlcnkuc3VwcG9ydHNEYXRh\nU3RvcmVFeGVjdXRpb24oKQogICAgICAgICAgICB8fCBfY29sbGVjdGlvbiAh\nPSBudWxsOwogICAgICAgIGlmICghaW5NZW0gJiYgKCFfaWdub3JlQ2hhbmdl\ncyB8fCBvcGVyYXRpb24gIT0gT1BfU0VMRUNUKQogICAgICAgICAgICAmJiBf\nYnJva2VyLmlzQWN0aXZlKCkgJiYgaXNBY2Nlc3NQYXRoRGlydHkoKSkgewog\nICAgICAgICAgICBpbnQgZmx1c2ggPSBfZmMuZ2V0Rmx1c2hCZWZvcmVRdWVy\naWVzKCk7CiAgICAgICAgICAgIGlmICgoZmx1c2ggPT0gRkxVU0hfVFJVRQog\nICAgICAgICAgICAgICAgfHwgKGZsdXNoID09IEZMVVNIX1dJVEhfQ09OTkVD\nVElPTiAmJiBfYnJva2VyLmhhc0Nvbm5lY3Rpb24oKSkKICAgICAgICAgICAg\nICAgIHx8IG9wZXJhdGlvbiAhPSBPUF9TRUxFQ1QKICAgICAgICAgICAgICAg\nIHx8ICFfc3RvcmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkp\nCiAgICAgICAgICAgICAgICAmJiBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24o\nKS5zdXBwb3J0ZWRPcHRpb25zKCkuCiAgICAgICAgICAgICAgICBjb250YWlu\ncyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fSU5DX0ZMVVNIKSkgewog\nICAgICAgICAgICAgICAgX2Jyb2tlci5mbHVzaCgpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNJbmZvRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgi\nZm9yY2UtaW4tbWVtIiwgX2NsYXNzKSk7CiAgICAgICAgICAgICAgICBpbk1l\nbSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nIChpbk1lbSAmJiAhX3N0b3JlUXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1\ndGlvbigpKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJjYW50LWV4ZWMtaW5tZW0iLAogICAgICAgICAg\nICAgICAgX2xhbmd1YWdlKSk7CiAgICAgICAgcmV0dXJuIGluTWVtOwogICAg\nfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0aGUgcXVlcnkgdXNpbmcgdGhl\nIGdpdmVuIGNvbXBpbGF0aW9uLCBleGVjdXRvciwgYW5kIHBhcmFtZXRlcgog\nICAgICogdmFsdWVzLiBBbGwgb3RoZXIgZXhlY3V0ZSBtZXRob2RzIGRlbGVn\nYXRlIHRvIHRoaXMgb25lIG9yIHRvCiAgICAgKiB7QGxpbmsgI2V4ZWN1dGUo\nU3RvcmVRdWVyeS5FeGVjdXRvcixNYXApfSBhZnRlciB2YWxpZGF0aW9uIGFu\nZCBsb2NraW5nLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBleGVjdXRl\nKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgCiAgICAg\nICAgT2JqZWN0W10gcGFyYW1zKQogICAgICAgIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIC8vIGlmIHRoaXMgaXMgYW4gaW1wb3NzaWJsZSByZXN1bHQg\ncmFuZ2UsIHJldHVybiBudWxsIC8gZW1wdHkgbGlzdAogICAgICAgIFN0b3Jl\nUXVlcnkuUmFuZ2UgcmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZShfc3Rh\ncnRJZHgsIF9lbmRJZHgpOwogICAgICAgIGlmICghX3JhbmdlU2V0KQogICAg\nICAgICAgICBleC5nZXRSYW5nZShxLCBwYXJhbXMsIHJhbmdlKTsKICAgICAg\nICBpZiAocmFuZ2Uuc3RhcnQgPj0gcmFuZ2UuZW5kKQogICAgICAgICAgICBy\nZXR1cm4gZW1wdHlSZXN1bHQocSwgZXgpOwoKICAgICAgICAvLyBleGVjdXRl\nOyBpZiB3ZSBoYXZlIGEgcmVzdWx0IGNsYXNzIG9yIHdlIGhhdmUgb25seSBv\nbmUgcmVzdWx0CiAgICAgICAgLy8gYW5kIHNvIG5lZWQgdG8gcmVtb3ZlIGl0\nIGZyb20gaXRzIGFycmF5LCB3cmFwIGluIGEgcGFja2luZyByb3AKICAgICAg\nICByYW5nZS5scnMgPSBpc0xSUyhyYW5nZS5zdGFydCwgcmFuZ2UuZW5kKTsK\nICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlciByb3AgPSBleC5leGVjdXRl\nUXVlcnkocSwgcGFyYW1zLCByYW5nZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIHRvUmVzdWx0KHEsIGV4LCByb3AsIHJhbmdlKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAo\ncm9wICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyByb3AuY2xvc2Uo\nKTsgfSBjYXRjaCAoRXhjZXB0aW9uIGUyKSB7fQogICAgICAgICAgICB0aHJv\ndyBlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSB0\naGUgcXVlcnkgdXNpbmcgdGhlIGdpdmVuIGV4ZWN1dG9yLCBhbmQgcGFyYW1l\ndGVyCiAgICAgKiB2YWx1ZXMuIEFsbCBvdGhlciBleGVjdXRlIG1ldGhvZHMg\nZGVsZWdhdGUgdG8gdGhpcyBvbmUgb3IgdG8KICAgICAqIHtAbGluayAjZGVs\nZXRlKFN0b3JlUXVlcnkuRXhlY3V0b3IsTWFwKX0gYWZ0ZXIgdmFsaWRhdGlv\nbiBhbmQgbG9ja2luZy4KICAgICAqIFRoZSByZXR1cm4gdmFsdWUgd2lsbCBi\nZSBhIE51bWJlciBpbmRpY2F0aW5nIHRoZSBudW1iZXIgb2YKICAgICAqIGlu\nc3RhbmNlcyBkZWxldGVkLgogICAgICovCiAgICBwcml2YXRlIE51bWJlciBk\nZWxldGUoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4LCBP\nYmplY3RbXSBwYXJhbXMpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgYXNzZXJ0QnVsa01vZGlmeShxLCBleCwgcGFyYW1zKTsKICAgICAg\nICByZXR1cm4gZXguZXhlY3V0ZURlbGV0ZShxLCBwYXJhbXMpOwogICAgfQoK\nICAgIHB1YmxpYyBOdW1iZXIgZGVsZXRlSW5NZW1vcnkoU3RvcmVRdWVyeSBx\nLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ZWN1dG9yLAogICAgICAgIE9iamVj\ndFtdIHBhcmFtcykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE9iamVj\ndCBvID0gZXhlY3V0ZShxLCBleGVjdXRvciwgcGFyYW1zKTsKICAgICAgICAg\nICAgaWYgKCEobyBpbnN0YW5jZW9mIENvbGxlY3Rpb24pKQogICAgICAgICAg\nICAgICAgbyA9IENvbGxlY3Rpb25zLnNpbmdsZXRvbihvKTsKCiAgICAgICAg\nICAgIGludCBzaXplID0gMDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\nID0gKChDb2xsZWN0aW9uKSBvKS5pdGVyYXRvcigpOyBpLmhhc05leHQoKTsg\nc2l6ZSsrKQogICAgICAgICAgICAgICAgX2Jyb2tlci5kZWxldGUoaS5uZXh0\nKCksIG51bGwpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKHNpemUpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRl\nIHRoZSBxdWVyeSB1c2luZyB0aGUgZ2l2ZW4gY29tcGlsYXRpb24sIGV4ZWN1\ndG9yLCBhbmQgcGFyYW1ldGVyCiAgICAgKiB2YWx1ZXMuIEFsbCBvdGhlciBl\neGVjdXRlIG1ldGhvZHMgZGVsZWdhdGUgdG8gdGhpcyBvbmUgb3IgdG8KICAg\nICAqIHtAbGluayAjdXBkYXRlKFN0b3JlUXVlcnkuRXhlY3V0b3IsTWFwKX0g\nYWZ0ZXIgdmFsaWRhdGlvbiBhbmQgbG9ja2luZy4KICAgICAqIFRoZSByZXR1\ncm4gdmFsdWUgd2lsbCBiZSBhIE51bWJlciBpbmRpY2F0aW5nIHRoZSBudW1i\nZXIgb2YKICAgICAqIGluc3RhbmNlcyB1cGRhdGVkLgogICAgICovCiAgICBw\ncml2YXRlIE51bWJlciB1cGRhdGUoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5\nLkV4ZWN1dG9yIGV4LCBPYmplY3RbXSBwYXJhbXMpCiAgICAgICAgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0QnVsa01vZGlmeShxLCBleCwg\ncGFyYW1zKTsKICAgICAgICByZXR1cm4gZXguZXhlY3V0ZVVwZGF0ZShxLCBw\nYXJhbXMpOwogICAgfQoKICAgIHB1YmxpYyBOdW1iZXIgdXBkYXRlSW5NZW1v\ncnkoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ZWN1dG9y\nLAogICAgICAgIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIE9iamVjdCBvID0gZXhlY3V0ZShxLCBleGVjdXRvciwgcGFy\nYW1zKTsKICAgICAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIENvbGxlY3Rp\nb24pKQogICAgICAgICAgICAgICAgbyA9IENvbGxlY3Rpb25zLnNpbmdsZXRv\nbihvKTsKCiAgICAgICAgICAgIGludCBzaXplID0gMDsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpID0gKChDb2xsZWN0aW9uKSBvKS5pdGVyYXRvcigp\nOyBpLmhhc05leHQoKTsgc2l6ZSsrKQogICAgICAgICAgICAgICAgdXBkYXRl\nSW5NZW1vcnkoaS5uZXh0KCksIHBhcmFtcywgcSk7CiAgICAgICAgICAgIHJl\ndHVybiBOdW1iZXJzLnZhbHVlT2Yoc2l6ZSk7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlcyBmb3IgdGhlIHVwZGF0ZXMg\naW4gbWVtb3J5LgogICAgICoKICAgICAqIEBwYXJhbSBvYiB0aGUgcGVyc2lz\ndGVudCBpbnN0YW5jZSB0byBjaGFuZ2UKICAgICAqIEBwYXJhbSBwYXJhbXMg\ndGhlIHBhcmFtZXRlcnMgcGFzc2VkIHRvIHRoZSBxdWVyeQogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgdXBkYXRlSW5NZW1vcnkoT2JqZWN0IG9iLCBPYmpl\nY3RbXSBwYXJhbXMsIFN0b3JlUXVlcnkgcSkgewogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXQgPSBnZXRVcGRhdGVzKCkuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOwogICAgICAgICAgICBpdC5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE1h\ncC5FbnRyeSBlID0gKE1hcC5FbnRyeSkgaXQubmV4dCgpOwogICAgICAgICAg\nICBQYXRoIHBhdGggPSAoUGF0aCkgZS5nZXRLZXkoKTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSAoRmllbGRNZXRhRGF0YSkgcGF0aC5sYXN0\nKCk7CiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBfYnJv\na2VyLmdldFN0YXRlTWFuYWdlcihvYik7CgogICAgICAgICAgICBPYmplY3Qg\ndmFsOwogICAgICAgICAgICBPYmplY3QgdmFsdWUgPSBlLmdldFZhbHVlKCk7\nCiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFZhbCkgewogICAg\nICAgICAgICAgICAgdmFsID0gKChWYWwpIHZhbHVlKS4KICAgICAgICAgICAg\nICAgICAgICBldmFsdWF0ZShvYiwgbnVsbCwgZ2V0U3RvcmVDb250ZXh0KCks\nIHBhcmFtcyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFu\nY2VvZiBMaXRlcmFsKSB7CiAgICAgICAgICAgICAgICB2YWwgPSAoKExpdGVy\nYWwpIHZhbHVlKS5nZXRWYWx1ZSgpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHZhbHVlIGluc3RhbmNlb2YgQ29uc3RhbnQpIHsKICAgICAgICAgICAgICAg\nIHZhbCA9ICgoQ29uc3RhbnQpIHZhbHVlKS5nZXRWYWx1ZShwYXJhbXMpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICB2YWwgPSBxLmV2YWx1YXRlKHZhbHVlLCBvYiwg\ncGFyYW1zLCBzbSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVbnN1cHBv\ncnRlZEV4Y2VwdGlvbiBlMSkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgX2xvYy5nZXQoImZhaWwtdG8tZ2V0LXVwZGF0ZS12YWx1ZSIpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50\nIGkgPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIGludG8gPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxl\nKG9iLAogICAgICAgICAgICAgICAgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9u\nKCkpOwoKICAgICAgICAgICAgLy8gc2V0IHRoZSBhY3R1YWwgZmllbGQgaW4g\ndGhlIGluc3RhbmNlCiAgICAgICAgICAgIGludCBzZXQgPSBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyLlNFVF9VU0VSOwogICAgICAgICAgICBzd2l0Y2ggKGZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICAgICAgc20uc2V0\ndGluZ0Jvb2xlYW5GaWVsZChpbnRvLCBpLCBzbS5mZXRjaEJvb2xlYW5GaWVs\nZChpKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyBm\nYWxzZSA6ICgoQm9vbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0KTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAg\nICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0J5dGVGaWVsZChpbnRvLCBp\nLCBzbS5mZXRjaEJ5dGVGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCkuYnl0ZVZhbHVl\nKCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAg\nICAgIHNtLnNldHRpbmdDaGFyRmllbGQoaW50bywgaSwgc20uZmV0Y2hDaGFy\nRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxs\nID8gMCA6IHZhbC50b1N0cmluZygpLmNoYXJBdCgwKSwgc2V0KTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5n\nRG91YmxlRmllbGQoaW50bywgaSwgc20uZmV0Y2hEb3VibGVGaWVsZChpKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChO\ndW1iZXIpIHZhbCkuZG91YmxlVmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdGbG9hdEZp\nZWxkKGludG8sIGksIHNtLmZldGNoRmxvYXRGaWVsZChpKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZh\nbCkuZmxvYXRWYWx1ZSgpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAg\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdJbnRGaWVsZChpbnRvLCBpLCBz\nbS5mZXRjaEludEZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2\nYWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpLCBz\nZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgICAgICBz\nbS5zZXR0aW5nTG9uZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoTG9uZ0ZpZWxk\nKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAg\nOiAoKE51bWJlcikgdmFsKS5sb25nVmFsdWUoKSwgc2V0KTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTaG9y\ndEZpZWxkKGludG8sIGksIHNtLmZldGNoU2hvcnRGaWVsZChpKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIp\nIHZhbCkuc2hvcnRWYWx1ZSgpLCBzZXQpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5H\nOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTdHJpbmdGaWVsZChp\nbnRvLCBpLCBzbS5mZXRjaFN0cmluZ0ZpZWxkKGkpLAogICAgICAgICAgICAg\nICAgICAgICAgICB2YWwgPT0gbnVsbCA/IG51bGwgOiB2YWwudG9TdHJpbmco\nKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nT1VCTEVfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVRfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09C\nSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGlu\nZ09iamVjdEZpZWxkKGludG8sIGksIHNtLmZldGNoT2JqZWN0RmllbGQoaSks\nIHZhbCwKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm9ubHktdXBkYXRlLXByaW1pdGl2ZXMiKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFjZSBsb2cg\ndGhhdCB0aGUgcXVlcnkgaXMgZXhlY3V0aW5nLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgbG9nRXhlY3V0aW9uKGludCBvcCwgTGlua2VkTWFwIHR5cGVz\nLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICBNYXAgcG1hcCA9IENvbGxl\nY3Rpb25zLkVNUFRZX01BUDsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA+\nIDApIHsKICAgICAgICAgICAgcG1hcCA9IG5ldyBIYXNoTWFwKChpbnQpIChw\nYXJhbXMubGVuZ3RoICogMS4zMyArIDEpKTsKICAgICAgICAgICAgaWYgKHR5\ncGVzICE9IG51bGwgJiYgdHlwZXMuc2l6ZSgpID09IHBhcmFtcy5sZW5ndGgp\nIHsKICAgICAgICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gdHlwZXMua2V5U2V0KCkuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgcG1hcC5w\ndXQoaXRyLm5leHQoKSwgcGFyYW1zW2krK10pOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJh\nbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgcG1hcC5wdXQo\nU3RyaW5nLnZhbHVlT2YoaSksIHBhcmFtc1tpXSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgbG9nRXhlY3V0aW9uKG9wLCBwbWFwKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRyYWNlIGxvZyB0aGF0IHRoZSBxdWVyeSBp\ncyBleGVjdXRpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBsb2dFeGVj\ndXRpb24oaW50IG9wLCBNYXAgcGFyYW1zKSB7CiAgICAgICAgU3RyaW5nIHMg\nPSBfcXVlcnk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocykp\nCiAgICAgICAgICAgIHMgPSB0b1N0cmluZygpOwoKICAgICAgICBTdHJpbmcg\nbXNnID0gImV4ZWN1dGluZy1xdWVyeSI7CiAgICAgICAgaWYgKCFwYXJhbXMu\naXNFbXB0eSgpKQogICAgICAgICAgICBtc2cgKz0gIi13aXRoLXBhcmFtcyI7\nCgogICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQobXNnLCBzLCBwYXJhbXMp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoaXMg\nc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBwb3RlbnRpYWwgbGFyZ2UgcmVzdWx0\nIHNldC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzTFJTKGxvbmcg\nc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgbG9uZyByYW5nZSA9IGVuZCAt\nIHN0YXJ0OwogICAgICAgIHJldHVybiBfZmMuZ2V0RmV0Y2hCYXRjaFNpemUo\nKSA+PSAwCiAgICAgICAgICAgICYmICEocmFuZ2UgPD0gX2ZjLmdldEZldGNo\nQmF0Y2hTaXplKCkKICAgICAgICAgICAgfHwgKF9mYy5nZXRGZXRjaEJhdGNo\nU2l6ZSgpID09IDAgJiYgcmFuZ2UgPD0gNTApKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgcXVlcnkgcmVzdWx0IGZvciB0aGUgZ2l2ZW4g\ncmVzdWx0IG9iamVjdCBwcm92aWRlci4KICAgICAqLwogICAgcHJvdGVjdGVk\nIE9iamVjdCB0b1Jlc3VsdChTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhl\nY3V0b3IgZXgsIAogICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyIHJvcCwg\nU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkKICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAvLyBwYWNrIHByb2plY3Rpb25zIGlmIG5lY2Vzc2Fy\neQogICAgICAgIFN0cmluZ1tdIGFsaWFzZXMgPSBleC5nZXRQcm9qZWN0aW9u\nQWxpYXNlcyhxKTsKICAgICAgICBpZiAoIWV4LmlzUGFja2luZyhxKSkgewog\nICAgICAgICAgICBSZXN1bHRQYWNrZXIgcGFja2VyID0gZ2V0UmVzdWx0UGFj\na2VyKHEsIGV4KTsKICAgICAgICAgICAgaWYgKHBhY2tlciAhPSBudWxsIHx8\nIGFsaWFzZXMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICByb3AgPSBu\nZXcgUGFja2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKHJvcCwgcGFja2VyLAog\nICAgICAgICAgICAgICAgICAgIGFsaWFzZXMubGVuZ3RoKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGlmIHNpbmdsZSByZXN1bHQsIGV4dHJhY3QgaXQKICAg\nICAgICBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUgfHwgKGFsaWFzZXMu\nbGVuZ3RoID4gMAogICAgICAgICAgICAmJiAhZXguaGFzR3JvdXBpbmcocSkg\nJiYgZXguaXNBZ2dyZWdhdGUocSkpKQogICAgICAgICAgICByZXR1cm4gc2lu\nZ2xlUmVzdWx0KHJvcCwgcmFuZ2UpOwoKICAgICAgICAvLyBub3cgdGhhdCB3\nZSd2ZSBleGVjdXRlZCB0aGUgcXVlcnksIHdlIGNhbiBjYWxsIGlzQWdncmVn\nYXRlIGFuZAogICAgICAgIC8vIGhhc0dyb3VwaW5nIGVmZmljaWVudGx5CiAg\nICAgICAgYm9vbGVhbiBkZXRhY2ggPSAoX2Jyb2tlci5nZXRBdXRvRGV0YWNo\nKCkgJgogICAgICAgICAgICBBdXRvRGV0YWNoLkRFVEFDSF9OT05UWFJFQUQp\nID4gMCAmJiAhX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAgICAgIGJvb2xlYW4g\nbHJzID0gcmFuZ2UubHJzICYmICFleC5pc0FnZ3JlZ2F0ZShxKSAmJiAhZXgu\naGFzR3JvdXBpbmcocSk7CiAgICAgICAgUmVzdWx0TGlzdCByZXMgPSAoIWRl\ndGFjaCAmJiBscnMpID8gX2ZjLm5ld1Jlc3VsdExpc3Qocm9wKQogICAgICAg\nICAgICA6IG5ldyBFYWdlclJlc3VsdExpc3Qocm9wKTsKICAgICAgICByZXMu\nc2V0VXNlck9iamVjdChuZXcgT2JqZWN0W117cm9wLGV4fSk7CiAgICAgICAg\nX3Jlc3VsdExpc3RzLmFkZChkZWNvcmF0ZVJlc3VsdExpc3QocmVzKSk7CiAg\nICAgICAgcmV0dXJuIHJlczsKICAgIH0KCiAgICAvKioKICAgICAqIE9wdGlv\nbmFsbHkgZGVjb3JhdGUgdGhlIG5hdGl2ZSByZXN1bHQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBSZXN1bHRMaXN0IGRlY29yYXRlUmVzdWx0TGlzdChSZXN1\nbHRMaXN0IHJlcykgewogICAgICAgIHJldHVybiBuZXcgUmVtb3ZlT25DbG9z\nZVJlc3VsdExpc3QocmVzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIHJlc3VsdCBwYWNrZXIgZm9yIHRoaXMgcHJvamVjdGlvbiwgb3IgbnVs\nbC4KICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHRQYWNrZXIgZ2V0UmVzdWx0\nUGFja2VyKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCkg\newogICAgICAgIGlmIChfcGFja2VyICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBfcGFja2VyOwoKICAgICAgICBDbGFzcyByZXN1bHRDbGFzcyA9IChf\ncmVzdWx0Q2xhc3MgIT0gbnVsbCkgPyBfcmVzdWx0Q2xhc3MKICAgICAgICAg\nICAgOiBleC5nZXRSZXN1bHRDbGFzcyhxKTsKICAgICAgICBpZiAocmVzdWx0\nQ2xhc3MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIFN0cmluZ1tdIGFsaWFzZXMgPSBleC5nZXRQcm9qZWN0aW9uQWxpYXNl\ncyhxKTsKICAgICAgICBSZXN1bHRTaGFwZTw/PiBzaGFwZSA9IGV4LmdldFJl\nc3VsdFNoYXBlKHEpOwogICAgICAgIGlmIChzaGFwZSAhPSBudWxsKSB7IC8v\nIHVzaW5nIEpQQTIuMCBzdHlsZSByZXN1bHQgc2hhcGUgZm9yIHBhY2tpbmcK\nICAgICAgICAgICAgaWYgKGFsaWFzZXMubGVuZ3RoID09IDApIHsKICAgICAg\nICAgICAgICAgIF9wYWNrZXIgPSBuZXcgUmVzdWx0U2hhcGVQYWNrZXIobmV3\nIENsYXNzW117X2NsYXNzfSwgbmV3IFN0cmluZ1tdeyIifSwgcmVzdWx0Q2xh\nc3MsIHNoYXBlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIF9wYWNrZXIgPSBuZXcgUmVzdWx0U2hhcGVQYWNrZXIoZXguZ2V0UHJv\namVjdGlvblR5cGVzKHEpLCBhbGlhc2VzLCByZXN1bHRDbGFzcywgc2hhcGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\naWYgKGFsaWFzZXMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIC8v\nIHJlc3VsdCBjbGFzcyBidXQgbm8gcmVzdWx0OyBtZWFucyBjYW5kaWRhdGUg\naXMgYmVpbmcgc2V0CiAgICAgICAgICAgICAgICAvLyBpbnRvIHNvbWUgcmVz\ndWx0IGNsYXNzCiAgICAgICAgICAgICAgICBfcGFja2VyID0gbmV3IFJlc3Vs\ndFBhY2tlcihfY2xhc3MsIGdldEFsaWFzKCksIHJlc3VsdENsYXNzKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHRDbGFzcyAhPSBudWxsKSB7IC8v\nIHByb2plY3Rpb24KICAgICAgICAgICAgICAgIENsYXNzW10gdHlwZXMgPSBl\neC5nZXRQcm9qZWN0aW9uVHlwZXMocSk7CiAgICAgICAgICAgICAgICBfcGFj\na2VyID0gbmV3IFJlc3VsdFBhY2tlcih0eXBlcywgYWxpYXNlcywgcmVzdWx0\nQ2xhc3MpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfcGFja2VyOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGVt\ncHR5IHJlc3VsdCBmb3IgdGhpcyBxdWVyeS4KICAgICAqLwogICAgcHJpdmF0\nZSBPYmplY3QgZW1wdHlSZXN1bHQoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5\nLkV4ZWN1dG9yIGV4KSB7CiAgICAgICAgaWYgKF91bmlxdWUgPT0gQm9vbGVh\nbi5UUlVFIHx8IChfdW5pcXVlID09IG51bGwKICAgICAgICAgICAgJiYgIWV4\nLmhhc0dyb3VwaW5nKHEpICYmIGV4LmlzQWdncmVnYXRlKHEpKSkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25z\nLkVNUFRZX0xJU1Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHRyYWN0IGFu\nIGV4cGVjdGVkIHNpbmdsZSByZXN1bHQgZnJvbSB0aGUgZ2l2ZW4gcHJvdmlk\nZXIuIFVzZWQgd2hlbgogICAgICogdGhlIHJlc3VsdCBpcyBhbiB1bmdyb3Vw\nZWQgYWdncmVnYXRlIG9yIHRoZSB1bmlxdWUgZmxhZyBpcyBzZXQgdG8gdHJ1\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3Qgc2luZ2xlUmVzdWx0KFJl\nc3VsdE9iamVjdFByb3ZpZGVyIHJvcCwgCiAgICAgICAgU3RvcmVRdWVyeS5S\nYW5nZSByYW5nZSkKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICByb3Aub3BlbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIG1v\ndmUgdG8gZXhwZWN0ZWQgcmVzdWx0CiAgICAgICAgICAgIGJvb2xlYW4gbmV4\ndCA9IHJvcC5uZXh0KCk7CgogICAgICAgICAgICAvLyBleHRyYWN0IHNpbmds\nZSByZXN1bHQ7IHRocm93IGFuIGV4Y2VwdGlvbiBpZiBtdWx0aXBsZSByZXN1\nbHRzCiAgICAgICAgICAgIC8vIG1hdGNoIGFuZCBub3QgY29uc3RyYWludGVk\nIGJ5IHJhbmdlLCBvciBpZiBhIHVuaXF1ZSBxdWVyeSB3aXRoCiAgICAgICAg\nICAgIC8vIG5vIHJlc3VsdHMKICAgICAgICAgICAgT2JqZWN0IHNpbmdsZSA9\nIG51bGw7CiAgICAgICAgICAgIGlmIChuZXh0KSB7CiAgICAgICAgICAgICAg\nICBzaW5nbGUgPSByb3AuZ2V0UmVzdWx0T2JqZWN0KCk7CiAgICAgICAgICAg\nICAgICBpZiAocmFuZ2UuZW5kICE9IHJhbmdlLnN0YXJ0ICsgMSAmJiByb3Au\nbmV4dCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBOb25Vbmlx\ndWVSZXN1bHRFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC11bmlxdWUiLAogICAg\nICAgICAgICAgICAgICAgICAgICBfY2xhc3MsIF9xdWVyeSkpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKF91bmlxdWUgPT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1yZXN1bHQiLCAKICAgICAgICAgICAgICAgICAgICBfY2xhc3Ms\nIF9xdWVyeSkpOwoKICAgICAgICAgICAgLy8gaWYgdW5pcXVlIHNldCB0byBm\nYWxzZSwgdXNlIGNvbGxlY3Rpb24KICAgICAgICAgICAgaWYgKF91bmlxdWUg\nPT0gQm9vbGVhbi5GQUxTRSkgewogICAgICAgICAgICAgICAgaWYgKCFuZXh0\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBU\nWV9MSVNUOwogICAgICAgICAgICAgICAgLy8gQ29sbGVjdGlvbnMuc2luZ2xl\ndG9uTGlzdCBpcyBKREsgMS4zLCBzby4uLgogICAgICAgICAgICAgICAgcmV0\ndXJuIEFycmF5cy5hc0xpc3QobmV3IE9iamVjdFtdeyBzaW5nbGUgfSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHJldHVy\nbiBzaW5nbGUgcmVzdWx0CiAgICAgICAgICAgIHJldHVybiBzaW5nbGU7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcm9wLmNsb3NlKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlcyB3aGV0\naGVyIHRoZSBhY2Nlc3MgcGF0aCBvZiB0aGlzIHF1ZXJ5IGludGVyc2VjdHMg\nd2l0aAogICAgICogYW55IGRpcnR5IG9iamVjdHMgaW4gdGhlIHRyYW5zYWN0\naW9uLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNBY2Nlc3NQYXRo\nRGlydHkoKSB7CiAgICAgICAgcmV0dXJuIGlzQWNjZXNzUGF0aERpcnR5KF9i\ncm9rZXIsIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoKSk7CiAgICB9CgogICAg\ncHVibGljIHN0YXRpYyBib29sZWFuIGlzQWNjZXNzUGF0aERpcnR5KEJyb2tl\nciBicm9rZXIsCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIGFjY2Vzc01ldGFz\nKSB7CiAgICAgICAgQ29sbGVjdGlvbiBwZXJzaXN0ZWQgPSBicm9rZXIuZ2V0\nUGVyc2lzdGVkVHlwZXMoKTsKICAgICAgICBDb2xsZWN0aW9uIHVwZGF0ZWQg\nPSBicm9rZXIuZ2V0VXBkYXRlZFR5cGVzKCk7CiAgICAgICAgQ29sbGVjdGlv\nbiBkZWxldGVkID0gYnJva2VyLmdldERlbGV0ZWRUeXBlcygpOwogICAgICAg\nIGlmIChwZXJzaXN0ZWQuaXNFbXB0eSgpICYmIHVwZGF0ZWQuaXNFbXB0eSgp\nICYmIGRlbGV0ZWQuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIC8vIGlmIG5vIGFjY2VzcyBtZXRhcywgYXNzdW1lIGV2\nZXJ5IGRpcnR5IG9iamVjdCBhZmZlY3RzIHBhdGgganVzdAogICAgICAgIC8v\nIHRvIGJlIHNhZmUKICAgICAgICBpZiAoYWNjZXNzTWV0YXMubGVuZ3RoID09\nIDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBjb21w\nYXJlIGRpcnR5IGNsYXNzZXMgdG8gdGhlIGFjY2VzcyBwYXRoIGNsYXNzZXMK\nICAgICAgICBDbGFzcyBhY2NDbGFzczsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGFjY2Vzc01ldGFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIC8vIHNob3J0Y3V0IGlmIGFjdHVhbCBjbGFzcyBpcyBkaXJ0eQogICAgICAg\nICAgICBhY2NDbGFzcyA9IGFjY2Vzc01ldGFzW2ldLmdldERlc2NyaWJlZFR5\ncGUoKTsKICAgICAgICAgICAgaWYgKHBlcnNpc3RlZC5jb250YWlucyhhY2ND\nbGFzcykgfHwgdXBkYXRlZC5jb250YWlucyhhY2NDbGFzcykKICAgICAgICAg\nICAgICAgIHx8IGRlbGV0ZWQuY29udGFpbnMoYWNjQ2xhc3MpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAvLyBjaGVjayBm\nb3IgZGlydHkgc3ViY2xhc3MKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBk\naXJ0eSA9IHBlcnNpc3RlZC5pdGVyYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgaWYgKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZy\nb20oKENsYXNzKSBkaXJ0eS5uZXh0KCkpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5\nID0gdXBkYXRlZC5pdGVyYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAg\nICAgICAgICAgICAgaWYgKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZyb20oKENs\nYXNzKSBkaXJ0eS5uZXh0KCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gZGVs\nZXRlZC5pdGVyYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgaWYgKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZyb20oKENsYXNzKSBk\naXJ0eS5uZXh0KCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gaW50ZXJzZWN0aW9uCiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3Nl\nQWxsKCkgewogICAgICAgIGNsb3NlUmVzdWx0cyh0cnVlKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBjbG9zZVJlc291cmNlcygpIHsKICAgICAgICBjbG9z\nZVJlc3VsdHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2Ug\nb3BlbiByZXN1bHRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2xvc2VS\nZXN1bHRzKGJvb2xlYW4gZm9yY2UpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAg\nICAgUmVtb3ZlT25DbG9zZVJlc3VsdExpc3QgcmVzOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IF9yZXN1bHRMaXN0cy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgcmVzID0gKFJlbW92\nZU9uQ2xvc2VSZXN1bHRMaXN0KSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgaWYgKGZvcmNlIHx8IHJlcy5pc1Byb3ZpZGVyT3BlbigpKQogICAgICAg\nICAgICAgICAgICAgIHJlcy5jbG9zZShmYWxzZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgX3Jlc3VsdExpc3RzLmNsZWFyKCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKE1h\ncCBwYXJhbXMpIHsKICAgICAgICBpZiAocGFyYW1zID09IG51bGwpCiAgICAg\nICAgICAgIHBhcmFtcyA9IENvbGxlY3Rpb25zLkVNUFRZX01BUDsKCiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5v\ndFNlcmlhbGl6ZWQoKTsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAg\nICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JF\neGVjdXRvcigpOwogICAgICAgICAgICBhc3NlcnRQYXJhbWV0ZXJzKF9zdG9y\nZVF1ZXJ5LCBleCwgcGFyYW1zKTsKICAgICAgICAgICAgT2JqZWN0W10gYXJy\nID0gZXgudG9QYXJhbWV0ZXJBcnJheShfc3RvcmVRdWVyeSwgcGFyYW1zKTsK\nICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSA9IG5ldyBTdG9y\nZVF1ZXJ5LlJhbmdlKF9zdGFydElkeCwgX2VuZElkeCk7CiAgICAgICAgICAg\nIGlmICghX3JhbmdlU2V0KQogICAgICAgICAgICAgICAgZXguZ2V0UmFuZ2Uo\nX3N0b3JlUXVlcnksIGFyciwgcmFuZ2UpOwogICAgICAgICAgICByZXR1cm4g\nZXguZ2V0RGF0YVN0b3JlQWN0aW9ucyhfc3RvcmVRdWVyeSwgYXJyLCByYW5n\nZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2V0UXVlcnko\nT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0\nTm90UmVhZE9ubHkoKTsKCiAgICAgICAgICAgIGlmIChxdWVyeSA9PSBudWxs\nIHx8IHF1ZXJ5IGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAg\nICBpbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAgICAgIF9x\ndWVyeSA9IChTdHJpbmcpIHF1ZXJ5OwogICAgICAgICAgICAgICAgaWYgKF9x\ndWVyeSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9xdWVyeSA9IF9x\ndWVyeS50cmltKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoIShxdWVyeSBpbnN0YW5jZW9m\nIFF1ZXJ5SW1wbCkpCiAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlUXVl\ncnkuc2V0UXVlcnkocXVlcnkpOwoKICAgICAgICAgICAgLy8gY29weSBhbGwg\nbm9uLXRyYW5zaWVudCBzdGF0ZSBmcm9tIHRoZSBnaXZlbiBxdWVyeQogICAg\nICAgICAgICBpbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAg\nUXVlcnlJbXBsIHEgPSAoUXVlcnlJbXBsKSBxdWVyeTsKICAgICAgICAgICAg\nX2NsYXNzID0gcS5fY2xhc3M7CiAgICAgICAgICAgIF9zdWJjbGFzc2VzID0g\ncS5fc3ViY2xhc3NlczsKICAgICAgICAgICAgX3F1ZXJ5ID0gcS5fcXVlcnk7\nCiAgICAgICAgICAgIF9pZ25vcmVDaGFuZ2VzID0gcS5faWdub3JlQ2hhbmdl\nczsKICAgICAgICAgICAgX3VuaXF1ZSA9IHEuX3VuaXF1ZTsKICAgICAgICAg\nICAgX3Jlc3VsdENsYXNzID0gcS5fcmVzdWx0Q2xhc3M7CiAgICAgICAgICAg\nIF9wYXJhbXMgPSBxLl9wYXJhbXM7CiAgICAgICAgICAgIF9yZXN1bHRNYXBw\naW5nU2NvcGUgPSBxLl9yZXN1bHRNYXBwaW5nU2NvcGU7CiAgICAgICAgICAg\nIF9yZXN1bHRNYXBwaW5nTmFtZSA9IHEuX3Jlc3VsdE1hcHBpbmdOYW1lOwog\nICAgICAgICAgICBfcmVhZE9ubHkgPSBxLl9yZWFkT25seTsKCiAgICAgICAg\nICAgIC8vIGRvbid0IHNoYXJlIG11dGFibGUgb2JqZWN0cwogICAgICAgICAg\nICBfZmMuY29weShxLl9mYyk7CiAgICAgICAgICAgIGlmIChxLl9maWx0TGlz\ndGVuZXJzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZmlsdExpc3RlbmVy\ncyA9IG5ldyBIYXNoTWFwKHEuX2ZpbHRMaXN0ZW5lcnMpOwogICAgICAgICAg\nICBpZiAocS5fYWdnTGlzdGVuZXJzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfYWdnTGlzdGVuZXJzID0gbmV3IEhhc2hNYXAocS5fYWdnTGlzdGVuZXJz\nKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0QWxpYXMoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0cmluZyBhbGlhcyA9IGNvbXBp\nbGVGb3JFeGVjdXRvcigpLmdldEFsaWFzKF9zdG9yZVF1ZXJ5KTsKICAgICAg\nICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAgICAgICAgICBhbGlh\ncyA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKF9jbGFzcyk7CiAgICAgICAgICAg\nIHJldHVybiBhbGlhczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZ1tdIGdldFByb2plY3Rpb25BbGlhc2VzKCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4\nZWN1dG9yKCkuZ2V0UHJvamVjdGlvbkFsaWFzZXMoX3N0b3JlUXVlcnkpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NbXSBnZXRQcm9qZWN0aW9u\nVHlwZXMoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRQcm9qZWN0\naW9uVHlwZXMoX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgaW50IGdldE9wZXJhdGlvbigpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRv\ncigpLmdldE9wZXJhdGlvbihfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzQWdncmVnYXRlKCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29tcGls\nZUZvckV4ZWN1dG9yKCkuaXNBZ2dyZWdhdGUoX3N0b3JlUXVlcnkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNHcm91cGluZygpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmhhc0dyb3VwaW5nKF9zdG9yZVF1\nZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENsYXNzTWV0YURhdGFb\nXSBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0\nYXMgPSBjb21waWxlRm9yRXhlY3V0b3IoKS4KICAgICAgICAgICAgICAgIGdl\ndEFjY2Vzc1BhdGhNZXRhRGF0YXMoX3N0b3JlUXVlcnkpOwogICAgICAgICAg\nICByZXR1cm4gKG1ldGFzID09IG51bGwpID8gU3RvcmVRdWVyeS5FTVBUWV9N\nRVRBUyA6IG1ldGFzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgTGlua2Vk\nTWFwIGdldFBhcmFtZXRlclR5cGVzKCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1\ndG9yKCkuZ2V0UGFyYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgTWFwIGdldFVwZGF0ZXMoKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBjb21w\naWxlRm9yRXhlY3V0b3IoKS5nZXRVcGRhdGVzKF9zdG9yZVF1ZXJ5KTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9jaygpIHsKICAgICAgICBp\nZiAoX2xvY2sgIT0gbnVsbCkKICAgICAgICAgICAgX2xvY2subG9jaygpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAo\nX2xvY2sgIT0gbnVsbCkKICAgICAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBzdGFydExv\nY2tpbmcoKSB7CiAgICAJaWYgKF9sb2NrID09IG51bGwpIHsKICAgIAkJX2xv\nY2sgPSBuZXcgUmVlbnRyYW50TG9jaygpOwogICAgCX0KICAgIH0KICAgIAog\nICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIHN0b3BMb2NraW5nKCkgewog\nICAgCWlmIChfbG9jayAhPSBudWxsICYmICFfYnJva2VyLmdldE11bHRpdGhy\nZWFkZWQoKSkKICAgIAkJX2xvY2sgPSBudWxsOwogICAgfQogICAgCiAgICAK\nCiAgICAvLy8vLy8vLy8KICAgIC8vIFV0aWxzCiAgICAvLy8vLy8vLy8KCiAg\nICBwdWJsaWMgQ2xhc3MgY2xhc3NGb3JOYW1lKFN0cmluZyBuYW1lLCBTdHJp\nbmdbXSBpbXBvcnRzKSB7CiAgICAgICAgLy8gZnVsbCBjbGFzcyBuYW1lIG9y\nIHByaW1pdGl2ZSB0eXBlPwogICAgICAgIENsYXNzIHR5cGUgPSB0b0NsYXNz\nKG5hbWUpOwogICAgICAgIGlmICh0eXBlICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiB0eXBlOwoKICAgICAgICAvLyBmaXJzdCBjaGVjayB0aGUgYWxp\nYXNlcyBtYXAgaW4gdGhlIE1ldGFEYXRhUmVwb3NpdG9yeQogICAgICAgIENs\nYXNzTG9hZGVyIGxvYWRlciA9IChfY2xhc3MgPT0gbnVsbCkgPyBfbG9hZGVy\nCiAgICAgICAgICAgIDogQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRl\nckFjdGlvbihfY2xhc3MpKTsgCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdl\ndE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0TWV0YURhdGEobmFt\nZSwgbG9hZGVyLCBmYWxzZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwoK\nICAgICAgICAvLyB0cnkgdGhlIG5hbWUgaW4gdGhlIHBhY2thZ2Ugb2YgdGhl\nIGNhbmRpZGF0ZSBjbGFzcwogICAgICAgIGlmIChfY2xhc3MgIT0gbnVsbCkg\newogICAgICAgICAgICBTdHJpbmcgZnVsbE5hbWUgPSBfY2xhc3MuZ2V0TmFt\nZSgpLnN1YnN0cmluZwogICAgICAgICAgICAgICAgKDAsIF9jbGFzcy5nZXRO\nYW1lKCkubGFzdEluZGV4T2YoJy4nKSArIDEpICsgbmFtZTsKICAgICAgICAg\nICAgdHlwZSA9IHRvQ2xhc3MoZnVsbE5hbWUpOwogICAgICAgICAgICBpZiAo\ndHlwZSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGU7CiAg\nICAgICAgfQoKICAgICAgICAvLyB0cnkgamF2YS5sYW5nCiAgICAgICAgdHlw\nZSA9IHRvQ2xhc3MoImphdmEubGFuZy4iICsgbmFtZSk7CiAgICAgICAgaWYg\nKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHR5cGU7CgogICAg\nICAgIC8vIHRyeSBlYWNoIGltcG9ydAogICAgICAgIGlmIChpbXBvcnRzICE9\nIG51bGwgJiYgaW1wb3J0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIFN0\ncmluZyBkb3ROYW1lID0gIi4iICsgbmFtZTsKICAgICAgICAgICAgU3RyaW5n\nIGltcG9ydE5hbWU7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\naW1wb3J0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaW1wb3J0\nTmFtZSA9IGltcG9ydHNbaV07CgogICAgICAgICAgICAgICAgLy8gZnVsbCBj\nbGFzcyBuYW1lIGltcG9ydAogICAgICAgICAgICAgICAgaWYgKGltcG9ydE5h\nbWUuZW5kc1dpdGgoZG90TmFtZSkpCiAgICAgICAgICAgICAgICAgICAgdHlw\nZSA9IHRvQ2xhc3MoaW1wb3J0TmFtZSk7CiAgICAgICAgICAgICAgICAgICAg\nLy8gd2lsZGNhcmQ7IHN0cmlwIHRvIHBhY2thZ2UKICAgICAgICAgICAgICAg\nIGVsc2UgaWYgKGltcG9ydE5hbWUuZW5kc1dpdGgoIi4qIikpIHsKICAgICAg\nICAgICAgICAgICAgICBpbXBvcnROYW1lID0gaW1wb3J0TmFtZS5zdWJzdHJp\nbmcKICAgICAgICAgICAgICAgICAgICAgICAgKDAsIGltcG9ydE5hbWUubGVu\nZ3RoKCkgLSAxKTsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gdG9DbGFz\ncyhpbXBvcnROYW1lICsgbmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBpZiAodHlwZSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB0eXBlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSB7QGxpbmsgQ2xhc3N9IGZvciB0aGUgZ2l2ZW4gbmFtZSwgb3IgbnVs\nbCBpZiBuYW1lIG5vdCB2YWxpZC4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFz\ncyB0b0NsYXNzKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2FkZXIg\nPT0gbnVsbCkKICAgICAgICAgICAgX2xvYWRlciA9IF9icm9rZXIuZ2V0Q29u\nZmlndXJhdGlvbigpLmdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAg\nICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoX2NsYXNzLCBfYnJva2VyLmdl\ndENsYXNzTG9hZGVyKCkpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBTdHJpbmdzLnRvQ2xhc3MobmFtZSwgX2xvYWRlcik7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgIH0gY2F0\nY2ggKE5vQ2xhc3NEZWZGb3VuZEVycm9yIG5jZGZlKSB7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFz\nc2VydE9wZW4oKSB7CiAgICAgICAgaWYgKF9icm9rZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgX2Jyb2tlci5hc3NlcnRPcGVuKCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYXNzZXJ0Tm90UmVhZE9ubHkoKSB7CiAgICAgICAgaWYgKF9y\nZWFkT25seSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgicmVhZC1vbmx5IikpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGFzc2VydE5vdFNlcmlhbGl6ZWQoKSB7CiAgICAgICAgaWYg\nKF9icm9rZXIgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgic2VyaWFsaXplZCIpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoYXQgYSBjYW5kaWRhdGUgY2xh\nc3MgaGFzIGJlZW4gc2V0IGZvciB0aGUgcXVlcnkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhc3NlcnRDYW5kaWRhdGVUeXBlKCkgewogICAgICAgIGlm\nIChfY2xhc3MgPT0gbnVsbCAmJiBfc3RvcmVRdWVyeS5yZXF1aXJlc0NhbmRp\nZGF0ZVR5cGUoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgibm8tY2xhc3MiKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDaGVjayB0aGF0IHdlIGFyZSBpbiBhIHN0YXRlIHRvIGJl\nIGFibGUgdG8gcGVyZm9ybSBhIGJ1bGsgb3BlcmF0aW9uOwogICAgICogYWxz\nbyBmbHVzaCB0aGUgY3VycmVudCBtb2RmaWNhdGlvbnMgaWYgYW55IGVsZW1l\nbnRzIGFyZSBjdXJyZW50bHkgZGlydHkuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhc3NlcnRCdWxrTW9kaWZ5KFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVy\neS5FeGVjdXRvciBleCwgCiAgICAgICAgT2JqZWN0W10gcGFyYW1zKSB7CiAg\nICAgICAgX2Jyb2tlci5hc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwogICAg\nICAgIGlmIChfc3RhcnRJZHggIT0gMCB8fCBfZW5kSWR4ICE9IExvbmcuTUFY\nX1ZBTFVFKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tbW9kaWZ5LXJhbmdlIikpOwogICAgICAgIGlmIChfcmVz\ndWx0Q2xhc3MgIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLW1vZGlmeS1yZXN1bHRjbGFzcyIpKTsK\nICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlID0gbmV3IFN0b3JlUXVl\ncnkuUmFuZ2UoKTsKICAgICAgICBleC5nZXRSYW5nZShxLCBwYXJhbXMsIHJh\nbmdlKTsKICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gMCB8fCByYW5nZS5l\nbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tb2RpZnktcmFuZ2UiKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgdGhhdCB0aGUgcGFzc2VkIHBh\ncmFtZXRlcnMgbWF0Y2ggdGhlIGRlY2xhcmF0aW9ucy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgYXNzZXJ0UGFyYW1ldGVycyhTdG9yZVF1ZXJ5IHEs\nIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIAogICAgICAgIE9iamVjdFtdIHBh\ncmFtcykgewogICAgICAgIGlmICghcS5yZXF1aXJlc1BhcmFtZXRlckRlY2xh\ncmF0aW9ucygpIHx8ICFpc1BhcnNlZFF1ZXJ5KCkpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgTGlua2VkTWFwIHBhcmFtVHlwZXMgPSBleC5nZXRQ\nYXJhbWV0ZXJUeXBlcyhxKTsKICAgICAgICBpbnQgdHlwZUNvdW50ID0gcGFy\nYW1UeXBlcy5zaXplKCk7CiAgICAgICAgaWYgKHR5cGVDb3VudCA+IHBhcmFt\ncy5sZW5ndGgpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJ1bmJvdW5kLXBhcmFtcyIsCiAgICAgICAgICAgICAgICBw\nYXJhbVR5cGVzLmtleVNldCgpKSk7CgogICAgICAgIEl0ZXJhdG9yIGl0ciA9\nIHBhcmFtVHlwZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIE1h\ncC5FbnRyeSBlbnRyeTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaXRyLmhh\nc05leHQoKTsgaSsrKSB7CiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRy\neSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKCgoQ2xhc3MpIGVudHJ5\nLmdldFZhbHVlKCkpLmlzUHJpbWl0aXZlKCkgJiYgcGFyYW1zW2ldID09IG51\nbGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibnVsbC1wcmltaXRpdmUtcGFyYW0iLAogICAgICAgICAgICAg\nICAgICAgIGVudHJ5LmdldEtleSgpKSk7CiAgICAgICAgfQogICAgfQogICAg\nCiAgICBwcm90ZWN0ZWQgdm9pZCBhc3NlcnRQYXJhbWV0ZXJzKFN0b3JlUXVl\ncnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgCiAgICAgICAgTWFwIHBh\ncmFtcykgewogICAgICAgIGlmICghcS5yZXF1aXJlc1BhcmFtZXRlckRlY2xh\ncmF0aW9ucygpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIExpbmtl\nZE1hcCBwYXJhbVR5cGVzID0gZXguZ2V0UGFyYW1ldGVyVHlwZXMocSk7CiAg\nICAgICAgZm9yIChPYmplY3QgYWN0dWFsIDogcGFyYW1zLmtleVNldCgpKSB7\nCiAgICAgICAgICAgIGlmICghcGFyYW1UeXBlcy5jb250YWluc0tleShhY3R1\nYWwpKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgidW5ib3VuZC1wYXJhbXMiLAogICAgICAgICAgICAgICAgYWN0dWFs\nLCBwYXJhbVR5cGVzLmtleVNldCgpKSk7CiAgICAgICAgfQogICAgICAgIGZv\nciAoT2JqZWN0IGV4cGVjdGVkIDogcGFyYW1UeXBlcy5rZXlTZXQoKSkgewog\nICAgICAgICAgICBpZiAoIXBhcmFtcy5jb250YWluc0tleShleHBlY3RlZCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ1bmJvdW5kLXBhcmFtcyIsCiAgICAgICAgICAgICAgICBwYXJhbXMua2V5\nU2V0KCkpKTsKICAgICAgICB9CgogICAgICAgIEl0ZXJhdG9yIGl0ciA9IHBh\ncmFtVHlwZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIE1hcC5F\nbnRyeSBlbnRyeTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaXRyLmhhc05l\neHQoKTsgaSsrKSB7CiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKCgoQ2xhc3MpIGVudHJ5Lmdl\ndFZhbHVlKCkpLmlzUHJpbWl0aXZlKCkgCiAgICAgICAgICAgICAgICAmJiBw\nYXJhbXMuZ2V0KGVudHJ5LmdldEtleSgpKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwt\ncHJpbWl0aXZlLXBhcmFtIiwKICAgICAgICAgICAgICAgICAgICBlbnRyeS5n\nZXRLZXkoKSkpOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3\nIFN0cmluZ0J1ZmZlcig2NCk7CiAgICAgICAgYnVmLmFwcGVuZCgiUXVlcnk6\nICIpLmFwcGVuZChzdXBlci50b1N0cmluZygpKTsKICAgICAgICBidWYuYXBw\nZW5kKCI7IGNhbmRpZGF0ZSBjbGFzczogIikuYXBwZW5kKF9jbGFzcyk7CiAg\nICAgICAgYnVmLmFwcGVuZCgiOyBxdWVyeTogIikuYXBwZW5kKF9xdWVyeSk7\nCiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8q\nKgogICAgICogU3RydWN0IG9mIGNvbXBpbGVkIHF1ZXJ5IHByb3BlcnRpZXMu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgQ29tcGlsYXRp\nb24KICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAg\nIHB1YmxpYyBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIG1lbW9yeSA9IG51bGw7CiAg\nICAgICAgcHVibGljIFN0b3JlUXVlcnkuRXhlY3V0b3IgZGF0YXN0b3JlID0g\nbnVsbDsKICAgICAgICBwdWJsaWMgT2JqZWN0IHN0b3JlRGF0YSA9IG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJ1Y3QgdG8gaG9sZCB0aGUgdW5w\nYXJzZWQgcHJvcGVydGllcyBhc3NvY2lhdGVkIHdpdGggYSBxdWVyeS4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ29tcGlsYXRpb25LZXkK\nICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1\nYmxpYyBDbGFzcyBxdWVyeVR5cGUgPSBudWxsOwogICAgICAgIHB1YmxpYyBD\nbGFzcyBjYW5kaWRhdGVUeXBlID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBzdWJjbGFzc2VzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgU3RyaW5n\nIHF1ZXJ5ID0gbnVsbDsKICAgICAgICBwdWJsaWMgU3RyaW5nIGxhbmd1YWdl\nID0gbnVsbDsKICAgICAgICBwdWJsaWMgT2JqZWN0IHN0b3JlS2V5ID0gbnVs\nbDsKCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAg\nICAgaW50IHJzID0gMTc7CiAgICAgICAgICAgIHJzID0gMzcgKiBycyArICgo\ncXVlcnlUeXBlID09IG51bGwpID8gMCA6IHF1ZXJ5VHlwZS5oYXNoQ29kZSgp\nKTsKICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChxdWVyeSA9PSBudWxs\nKSA/IDAgOiBxdWVyeS5oYXNoQ29kZSgpKTsKICAgICAgICAgICAgcnMgPSAz\nNyAqIHJzICsgKChsYW5ndWFnZSA9PSBudWxsKSA/IDAgOiBsYW5ndWFnZS5o\nYXNoQ29kZSgpKTsKICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChzdG9y\nZUtleSA9PSBudWxsKSA/IDAgOiBzdG9yZUtleS5oYXNoQ29kZSgpKTsKICAg\nICAgICAgICAgaWYgKHN1YmNsYXNzZXMpCiAgICAgICAgICAgICAgcnMrKzsK\nICAgICAgICAgICAgcmV0dXJuIHJzOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgICAg\nICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgICAgICBpZiAob3RoZXIgPT0gbnVsbCB8fCBvdGhlci5n\nZXRDbGFzcygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CgogICAgICAgICAgICBDb21waWxhdGlvbktleSBrZXkgPSAo\nQ29tcGlsYXRpb25LZXkpIG90aGVyOwogICAgICAgICAgICBpZiAoa2V5LnF1\nZXJ5VHlwZSAhPSBxdWVyeVR5cGUKICAgICAgICAgICAgICAgIHx8ICFTdHJp\nbmdVdGlscy5lcXVhbHMoa2V5LnF1ZXJ5LCBxdWVyeSkKICAgICAgICAgICAg\nICAgIHx8ICFTdHJpbmdVdGlscy5lcXVhbHMoa2V5Lmxhbmd1YWdlLCBsYW5n\ndWFnZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIGlmIChrZXkuc3ViY2xhc3NlcyAhPSBzdWJjbGFzc2VzKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoIU9iamVj\ndFV0aWxzLmVxdWFscyhrZXkuc3RvcmVLZXksIHN0b3JlS2V5KSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIGFsbG93\nIGVpdGhlciBjYW5kaWRhdGUgdHlwZSB0byBiZSBudWxsIGJlY2F1c2UgaXQg\nbWlnaHQgYmUKICAgICAgICAgICAgLy8gZW5jb2RlZCBpbiB0aGUgcXVlcnkg\nc3RyaW5nLCBidXQgaWYgYm90aCBhcmUgc2V0IHRoZW4gdGhleQogICAgICAg\nICAgICAvLyBtdXN0IGJlIGVxdWFsCiAgICAgICAgICAgIHJldHVybiBrZXku\nY2FuZGlkYXRlVHlwZSA9PSBudWxsIHx8IGNhbmRpZGF0ZVR5cGUgPT0gbnVs\nbAogICAgICAgICAgICAgICAgfHwga2V5LmNhbmRpZGF0ZVR5cGUgPT0gY2Fu\nZGlkYXRlVHlwZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nIG1lcmdlZCBleGVjdXRvciBleGVjdXRlcyBtdWx0aXBsZSBRdWVyaWVzIGFu\nZCByZXR1cm5zCiAgICAgKiBhIG1lcmdlZCByZXN1bHQgbGlzdCB3aXRoIHRo\nZSBhcHByb3ByaWF0ZSBvcmRlcmluZyAoaWYgbW9yZSB0aGFuCiAgICAgKiBv\nbmUgcXVlcnkgbmVlZHMgdG8gYmUgZXhlY3V0ZWQpLiBUaGlzIGV4ZWN1dG9y\nIGhhcyB0aGUgZm9sbG93aW5nCiAgICAgKiBsaW1pdGF0aW9uczoKICAgICAq\nIDx1bD4KICAgICAqIDxsaT5JdCBjYW5ub3QgY29tYmluZSBhZ2dyZWdhdGVz\nLgogICAgICogPGxpPkl0IGNhbm5vdCBjb2xsYXRlIHRoZSByZXN1bHQgbGlz\ndHMgaWYgb3JkZXJpbmcgaXMgc3BlY2lmaWVkIGFuZAogICAgICogYSByZXN1\nbHQgc3RyaW5nIGlzIGdpdmVuLCBidXQgZG9lcyBub3QgaW5jbHVkZSB0aGUg\nb3JkZXJpbmcKICAgICAqIGNyaXRlcmlhLjwvbGk+CiAgICAgKiA8bGk+SXQg\nY2Fubm90IGZpbHRlciBkdXBsaWNhdGUgcmVzdWx0cyBmcm9tIGRpZmZlcmVu\ndCByZXN1bHQgbGlzdHMgaWYKICAgICAqIHRoZSByZXN1bHQgaXMgbWFya2Vk\nIGRpc3RpbmN0LiBUaGlzIHdvdWxkIHJlcXVpcmUgdHJhY2tpbmcgYWxsCiAg\nICAgKiBwcmV2aW91cyByZXN1bHRzLCB3aGljaCB3b3VsZCBpbnRlcmZlcmUg\nd2l0aCBsYXJnZSByZXN1bHQgc2V0CiAgICAgKiBoYW5kbGluZy48L2xpPgog\nICAgICogPC91bD4KICAgICAqCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdo\nb21tZWF1eAogICAgICogQG5vamF2YWRvYwogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBNZXJnZWRFeGVjdXRvcgogICAgICAgIGltcGxlbWVu\ndHMgU3RvcmVRdWVyeS5FeGVjdXRvciB7CgogICAgICAgIHByaXZhdGUgZmlu\nYWwgU3RvcmVRdWVyeS5FeGVjdXRvcltdIF9leGVjdXRvcnM7CgogICAgICAg\nIHB1YmxpYyBNZXJnZWRFeGVjdXRvcihTdG9yZVF1ZXJ5LkV4ZWN1dG9yW10g\nZXhlY3V0b3JzKSB7CiAgICAgICAgICAgIF9leGVjdXRvcnMgPSBleGVjdXRv\ncnM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBRdWVyeUV4\ncHJlc3Npb25zW10gZ2V0UXVlcnlFeHByZXNzaW9ucygpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0UXVlcnlFeHByZXNzaW9ucygp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJlc3VsdE9iamVjdFByb3Zp\nZGVyIGV4ZWN1dGVRdWVyeShTdG9yZVF1ZXJ5IHEsCiAgICAgICAgICAgIE9i\namVjdFtdIHBhcmFtcywgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkgewogICAg\nICAgICAgICBpZiAoX2V4ZWN1dG9ycy5sZW5ndGggPT0gMSkKICAgICAgICAg\nICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmV4ZWN1dGVRdWVyeShxLCBw\nYXJhbXMsIHJhbmdlKTsKCiAgICAgICAgICAgIC8vIHVzZSBscnMgc2V0dGlu\nZ3MgaWYgd2UgY291bGRuJ3QgdGFrZSBhZHZhbnRhZ2Ugb2YgdGhlIHN0YXJ0\nIGluZGV4CiAgICAgICAgICAgIC8vIHNvIHRoYXQgaG9wZWZ1bGx5IHRoZSBz\na2lwIHRvIHRoZSBzdGFydCB3aWxsIGJlIGVmZmljaWVudAogICAgICAgICAg\nICBTdG9yZVF1ZXJ5LlJhbmdlIHJvcFJhbmdlID0gbmV3IFN0b3JlUXVlcnku\nUmFuZ2UoMCwgcmFuZ2UuZW5kKTsKICAgICAgICAgICAgcm9wUmFuZ2UubHJz\nID0gcmFuZ2UubHJzIHx8IChyYW5nZS5zdGFydCA+IDAgJiYgcS5nZXRDb250\nZXh0KCkuCiAgICAgICAgICAgICAgICBnZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKS5nZXRGZXRjaEJhdGNoU2l6ZSgpID49IDApOwoKICAgICAgICAgICAgLy8g\nZXhlY3V0ZSB0aGUgcXVlcnk7IHdlIGNhbm5vdCB1c2UgdGhlIGxvd2VyIGJv\ndW5kIG9mIHRoZSByZXN1bHQKICAgICAgICAgICAgLy8gcmFuZ2UsIGJ1dCB3\nZSBjYW4gdGFrZSBhZHZhbnRhZ2Ugb2YgdGhlIHVwcGVyIGJvdW5kCiAgICAg\nICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyW10gcm9wcyA9CiAgICAgICAg\nICAgICAgICBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbX2V4ZWN1dG9ycy5s\nZW5ndGhdOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9leGVj\ndXRvcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICByb3BzW2ldID0g\nX2V4ZWN1dG9yc1tpXS5leGVjdXRlUXVlcnkocSwgcGFyYW1zLCByb3BSYW5n\nZSk7CgogICAgICAgICAgICBib29sZWFuW10gYXNjID0gX2V4ZWN1dG9yc1sw\nXS5nZXRBc2NlbmRpbmcocSk7CiAgICAgICAgICAgIFJlc3VsdE9iamVjdFBy\nb3ZpZGVyIHJvcDsKICAgICAgICAgICAgaWYgKGFzYy5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgICAgIHJvcCA9IG5ldyBNZXJnZWRSZXN1bHRPYmplY3RQ\ncm92aWRlcihyb3BzKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgcm9wID0gbmV3IE9yZGVyaW5nTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlk\nZXIocm9wcywgYXNjLAogICAgICAgICAgICAgICAgICAgIF9leGVjdXRvcnMs\nIHEsIHBhcmFtcyk7CgogICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIGxv\nd2VyIGJvdW5kLCB3cmFwIGluIHJhbmdlIHJvcAogICAgICAgICAgICBpZiAo\ncmFuZ2Uuc3RhcnQgIT0gMCkKICAgICAgICAgICAgICAgIHJvcCA9IG5ldyBS\nYW5nZVJlc3VsdE9iamVjdFByb3ZpZGVyKHJvcCwgcmFuZ2Uuc3RhcnQsIAog\nICAgICAgICAgICAgICAgICAgIHJhbmdlLmVuZCk7CiAgICAgICAgICAgIHJl\ndHVybiByb3A7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTnVtYmVyIGV4\nZWN1dGVEZWxldGUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMpIHsK\nICAgICAgICAgICAgbG9uZyBudW0gPSAwOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBudW0gKz0gX2V4ZWN1dG9yc1tpXS5leGVjdXRlRGVsZXRlKHEs\nIHBhcmFtcykubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgIHJldHVybiBOdW1i\nZXJzLnZhbHVlT2YobnVtKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBO\ndW1iZXIgZXhlY3V0ZVVwZGF0ZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBh\ncmFtcykgewogICAgICAgICAgICBsb25nIG51bSA9IDA7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIG51bSArPSBfZXhlY3V0b3JzW2ldLmV4ZWN1dGVV\ncGRhdGUocSwgcGFyYW1zKS5sb25nVmFsdWUoKTsKICAgICAgICAgICAgcmV0\ndXJuIE51bWJlcnMudmFsdWVPZihudW0pOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIFN0cmluZ1tdIGdldERhdGFTdG9yZUFjdGlvbnMoU3RvcmVRdWVy\neSBxLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAgICAgIFN0b3JlUXVlcnku\nUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgaWYgKF9leGVjdXRvcnMubGVu\nZ3RoID09IDEpCiAgICAgICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1sw\nXS5nZXREYXRhU3RvcmVBY3Rpb25zKHEsIHBhcmFtcywgcmFuZ2UpOwoKICAg\nICAgICAgICAgTGlzdCByZXN1bHRzID0gbmV3IEFycmF5TGlzdChfZXhlY3V0\nb3JzLmxlbmd0aCk7CiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2Ugcm9w\nUmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZSgwTCwgcmFuZ2UuZW5kKTsK\nICAgICAgICAgICAgU3RyaW5nW10gYWN0aW9uczsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBhY3Rpb25zID0gX2V4ZWN1dG9yc1tpXS5nZXREYXRh\nU3RvcmVBY3Rpb25zKHEsIHBhcmFtcyxyb3BSYW5nZSk7CiAgICAgICAgICAg\nICAgICBpZiAoYWN0aW9ucyAhPSBudWxsICYmIGFjdGlvbnMubGVuZ3RoID4g\nMCkKICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFkZEFsbChBcnJheXMu\nYXNMaXN0KGFjdGlvbnMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gKFN0cmluZ1tdKSByZXN1bHRzLnRvQXJyYXkobmV3IFN0cmluZ1ty\nZXN1bHRzLnNpemUoKV0pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgdmFsaWRhdGUoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIF9leGVj\ndXRvcnNbMF0udmFsaWRhdGUocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBnZXRSYW5nZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFt\ncywgCiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UpIHsKICAg\nICAgICAgICAgX2V4ZWN1dG9yc1swXS5nZXRSYW5nZShxLCBwYXJhbXMsIHJh\nbmdlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0T3Jk\nZXJpbmdWYWx1ZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAg\nICAgICAgICAgT2JqZWN0IHJlc3VsdE9iamVjdCwgaW50IGlkeCkgewogICAg\nICAgICAgICAvLyB1bmZvcnR1bmF0ZWx5LCBhdCB0aGlzIHBvaW50IChtdXN0\nIGJlIGEgbWVyZ2VkIHJvcCBjb250YWluaW5nCiAgICAgICAgICAgIC8vIG90\naGVyIG1lcmdlZCByb3BzKSB3ZSBoYXZlIG5vIGlkZWEgd2hpY2ggZXhlY3V0\nb3IgdG8gZXh0cmFjdAogICAgICAgICAgICAvLyB0aGUgdmFsdWUgZnJvbQog\nICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRPcmRlcmluZ1Zh\nbHVlKHEsIHBhcmFtcywgcmVzdWx0T2JqZWN0LCBpZHgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW5bXSBnZXRBc2NlbmRpbmcoU3RvcmVR\ndWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdl\ndEFzY2VuZGluZyhxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0QWxpYXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfZXhlY3V0b3JzWzBdLmdldEFsaWFzKHEpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIFN0cmluZ1tdIGdldFByb2plY3Rpb25BbGlhc2VzKFN0b3Jl\nUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5n\nZXRQcm9qZWN0aW9uQWxpYXNlcyhxKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBDbGFzcyBnZXRSZXN1bHRDbGFzcyhTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0UmVzdWx0Q2xhc3Mo\ncSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUmVzdWx0U2hhcGU8Pz4g\nZ2V0UmVzdWx0U2hhcGUoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfZXhlY3V0b3JzWzBdLmdldFJlc3VsdFNoYXBlKHEpOwogICAgICAg\nIH0KICAgICAgICAKICAgICAgICBwdWJsaWMgQ2xhc3NbXSBnZXRQcm9qZWN0\naW9uVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXhlY3V0b3JzWzBdLmdldFByb2plY3Rpb25UeXBlcyhxKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzUGFja2luZyhTdG9yZVF1ZXJ5\nIHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uaXNQYWNr\naW5nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIENsYXNzTWV0YURh\ndGFbXSBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKFN0b3JlUXVlcnkgcSkgewog\nICAgICAgICAgICBpZiAoX2V4ZWN1dG9ycy5sZW5ndGggPT0gMSkKICAgICAg\nICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldEFjY2Vzc1BhdGhN\nZXRhRGF0YXMocSk7CgogICAgICAgICAgICAvLyBjcmVhdGUgc2V0IG9mIGJh\nc2UgY2xhc3MgbWV0YWRhdGFzIGluIGFjY2VzcyBwYXRoCiAgICAgICAgICAg\nIExpc3QgbWV0YXMgPSBudWxsOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBtZXRhcyA9IEZpbHRlcnMuYWRkQWNjZXNzUGF0aE1ldGFEYXRhcyhtZXRh\ncywgX2V4ZWN1dG9yc1tpXS4KICAgICAgICAgICAgICAgICAgICBnZXRBY2Nl\nc3NQYXRoTWV0YURhdGFzKHEpKTsKICAgICAgICAgICAgaWYgKG1ldGFzID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gU3RvcmVRdWVyeS5FTVBU\nWV9NRVRBUzsKICAgICAgICAgICAgcmV0dXJuIChDbGFzc01ldGFEYXRhW10p\nIG1ldGFzLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgQ2xhc3NNZXRh\nRGF0YVttZXRhcy5zaXplKCldKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGlzQWdncmVnYXRlKFN0b3JlUXVlcnkgcSkgewogICAgICAg\nICAgICBpZiAoIV9leGVjdXRvcnNbMF0uaXNBZ2dyZWdhdGUocSkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAvLyB3ZSBj\nYW4ndCBtZXJnZSBhZ2dyZWdhdGVzCiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgibWVyZ2VkLWFnZ3JlZ2F0\nZSIsCiAgICAgICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRDYW5kaWRh\ndGVUeXBlKCksCiAgICAgICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRR\ndWVyeVN0cmluZygpKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50\nIGdldE9wZXJhdGlvbihTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9leGVjdXRvcnNbMF0uZ2V0T3BlcmF0aW9uKHEpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzR3JvdXBpbmcoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmhhc0dy\nb3VwaW5nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIExpbmtlZE1h\ncCBnZXRQYXJhbWV0ZXJUeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0UGFyYW1ldGVyVHlwZXMocSk7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0\nb1BhcmFtZXRlckFycmF5KFN0b3JlUXVlcnkgcSwgTWFwIHVzZXJQYXJhbXMp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0udG9QYXJhbWV0\nZXJBcnJheShxLCB1c2VyUGFyYW1zKTsKICAgICAgICB9CgoKICAgICAgICBw\ndWJsaWMgTWFwIGdldFVwZGF0ZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFVwZGF0ZXMocSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVzdWx0IG9iamVjdCBwcm92\naWRlciB0aGF0IHBhY2tzIHJlc3VsdHMgYmVmb3JlIHJldHVybmluZyB0aGVt\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFBhY2tpbmdSZXN1\nbHRPYmplY3RQcm92aWRlcgogICAgICAgIGltcGxlbWVudHMgUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdE9i\namVjdFByb3ZpZGVyIF9kZWxlZ2F0ZTsKICAgICAgICBwcml2YXRlIGZpbmFs\nIFJlc3VsdFBhY2tlciBfcGFja2VyOwogICAgICAgIHByaXZhdGUgZmluYWwg\naW50IF9sZW47CgogICAgICAgIHB1YmxpYyBQYWNraW5nUmVzdWx0T2JqZWN0\nUHJvdmlkZXIoUmVzdWx0T2JqZWN0UHJvdmlkZXIgZGVsZWdhdGUsCiAgICAg\nICAgICAgIFJlc3VsdFBhY2tlciBwYWNrZXIsIGludCByZXN1bHRMZW5ndGgp\nIHsKICAgICAgICAgICAgX2RlbGVnYXRlID0gZGVsZWdhdGU7CiAgICAgICAg\nICAgIF9wYWNrZXIgPSBwYWNrZXI7CiAgICAgICAgICAgIF9sZW4gPSByZXN1\nbHRMZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c1JhbmRvbUFjY2VzcygpIHsKICAgICAgICAgICAgcmV0dXJuIF9k\nZWxlZ2F0ZS5zdXBwb3J0c1JhbmRvbUFjY2VzcygpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgb3BlbigpCiAgICAgICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgICAgICBfZGVsZWdhdGUub3BlbigpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRSZXN1bHRPYmplY3Qo\nKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nT2JqZWN0IG9iID0gX2RlbGVnYXRlLmdldFJlc3VsdE9iamVjdCgpOwogICAg\nICAgICAgICBpZiAoX3BhY2tlciA9PSBudWxsICYmIF9sZW4gPT0gMSkKICAg\nICAgICAgICAgICAgIHJldHVybiAoKE9iamVjdFtdKSBvYilbMF07CiAgICAg\nICAgICAgIGlmIChfcGFja2VyID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gb2I7CiAgICAgICAgICAgIGlmIChfbGVuID09IDApCiAgICAgICAg\nICAgICAgICByZXR1cm4gX3BhY2tlci5wYWNrKG9iKTsKICAgICAgICAgICAg\ncmV0dXJuIF9wYWNrZXIucGFjaygoT2JqZWN0W10pIG9iKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIG5leHQoKQogICAgICAgICAgICB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0\nZS5uZXh0KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBh\nYnNvbHV0ZShpbnQgcG9zKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5hYnNvbHV0ZShwb3Mp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkKICAgICAg\nICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBf\nZGVsZWdhdGUuc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgcmVzZXQoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgX2RlbGVnYXRlLnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBjbG9zZSgpCiAgICAgICAgICAgIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgICAgICBfZGVsZWdhdGUuY2xvc2UoKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGhhbmRsZUNoZWNrZWRFeGNlcHRp\nb24oRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgX2RlbGVnYXRlLmhhbmRs\nZUNoZWNrZWRFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgICAgIAogICAg\nICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBnZXREZWxlZ2F0ZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXN1bHQgbGlzdCB0aGF0IHJlbW92ZXMg\naXRzZWxmIGZyb20gdGhlIHF1ZXJ5J3Mgb3BlbiByZXN1bHQgbGlzdAogICAg\nICogd2hlbiBpdCBpcyBjbG9zZWQuIFB1YmxpYyBmb3IgdGVzdGluZy4KICAg\nICAqLwogICAgcHVibGljIGNsYXNzIFJlbW92ZU9uQ2xvc2VSZXN1bHRMaXN0\nCiAgICAgICAgaW1wbGVtZW50cyBSZXN1bHRMaXN0IHsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBSZXN1bHRMaXN0IF9yZXM7CgogICAgICAgIHB1YmxpYyBS\nZW1vdmVPbkNsb3NlUmVzdWx0TGlzdChSZXN1bHRMaXN0IHJlcykgewogICAg\nICAgICAgICBfcmVzID0gcmVzOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFJlc3VsdExpc3QgZ2V0RGVsZWdhdGUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcmVzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNQ\ncm92aWRlck9wZW4oKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmlzUHJv\ndmlkZXJPcGVuKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0VXNlck9iamVjdCgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9yZXMuZ2V0VXNlck9iamVjdCgpOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICBwdWJsaWMgdm9pZCBzZXRVc2VyT2JqZWN0KE9iamVjdCBvcGFxdWUp\nIHsKICAgICAgICAgICAgX3Jlcy5zZXRVc2VyT2JqZWN0KG9wYXF1ZSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9yZXMuaXNDbG9zZWQoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgICAgICBj\nbG9zZSh0cnVlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNs\nb3NlKGJvb2xlYW4gcmVtb3ZlKSB7CiAgICAgICAgICAgIGlmIChpc0Nsb3Nl\nZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgX3Jl\ncy5jbG9zZSgpOwogICAgICAgICAgICBpZiAoIXJlbW92ZSkKICAgICAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGxvY2soKTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGRvbid0IHVzZSBzdGFuZGFy\nZCBfcmVzdWx0TGlzdHMucmVtb3ZlIG1ldGhvZCBiL2MgcmVsaWVzIG9uCiAg\nICAgICAgICAgICAgICAvLyBjb2xsZWN0aW9uIGVxdWFsaXR5LCB3aGljaCBy\nZWxpZXMgb24gZWxlbWVudCBlcXVhbGl0eSwgd2hpY2gKICAgICAgICAgICAg\nICAgIC8vIG1lYW5zIHdlIGVuZCB1cCB0cmF2ZXJzaW5nIGVudGlyZSByZXN1\nbHQgbGlzdHMhCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIF9yZXN1bHRMaXN0cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgICAgIGlmIChpdHIubmV4dCgpID09IHRoaXMpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICBy\nZXR1cm4gX3Jlcy5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5p\nc0VtcHR5KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBj\nb250YWlucyhPYmplY3QgbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5j\nb250YWlucyhvKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRv\nciBpdGVyYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuaXRlcmF0\nb3IoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b0Fy\ncmF5KCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy50b0FycmF5KCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheShPYmpl\nY3RbXSBhKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnRvQXJyYXkoYSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2JqZWN0\nIG8pIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuYWRkKG8pOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBvKSB7\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLnJlbW92ZShvKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbGxlY3Rp\nb24gYykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5jb250YWluc0FsbChj\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChD\nb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuYWRkQWxs\nKGMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxs\nKGludCBpZHgsIENvbGxlY3Rpb24gYykgewogICAgICAgICAgICByZXR1cm4g\nX3Jlcy5hZGRBbGwoaWR4LCBjKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIHJlbW92ZUFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXMucmVtb3ZlQWxsKGMpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gcmV0YWluQWxsKENvbGxlY3Rpb24gYykgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5yZXRhaW5BbGwoYyk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICAgICAg\nX3Jlcy5jbGVhcigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVj\ndCBnZXQoaW50IGlkeCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5nZXQo\naWR4KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Qgc2V0KGlu\ndCBpZHgsIE9iamVjdCBvKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnNl\ndChpZHgsIG8pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgYWRk\nKGludCBpZHgsIE9iamVjdCBvKSB7CiAgICAgICAgICAgIF9yZXMuYWRkKGlk\neCwgbyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHJlbW92\nZShpbnQgaWR4KSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnJlbW92ZShp\nZHgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBpbmRleE9mKE9i\namVjdCBvKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmluZGV4T2Yobyk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGxhc3RJbmRleE9mKE9i\namVjdCBvKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmxhc3RJbmRleE9m\nKG8pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIExpc3RJdGVyYXRvciBs\naXN0SXRlcmF0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmxpc3RJ\ndGVyYXRvcigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIExpc3RJdGVy\nYXRvciBsaXN0SXRlcmF0b3IoaW50IGlkeCkgewogICAgICAgICAgICByZXR1\ncm4gX3Jlcy5saXN0SXRlcmF0b3IoaWR4KTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBMaXN0IHN1Ykxpc3QoaW50IHN0YXJ0LCBpbnQgZW5kKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcmVzLnN1Ykxpc3Qoc3RhcnQsIGVuZCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0\nIG8pIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuZXF1YWxzKG8pOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9yZXMuaGFzaENvZGUoKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVybiBf\ncmVzLnRvU3RyaW5nICgpOwoJCX0KCgkJcHVibGljIE9iamVjdCB3cml0ZVJl\ncGxhY2UgKCkKCQl7CgkJCXJldHVybiBfcmVzOwoJCX0KCX0KfQo=\n","encoding":"base64"}

