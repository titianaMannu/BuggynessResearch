{"sha":"8688d6fa571fd146ae1d71ebd4cafb9da9a44bec","node_id":"MDQ6QmxvYjIwNjM2NDo4Njg4ZDZmYTU3MWZkMTQ2YWUxZDcxZWJkNGNhZmI5ZGE5YTQ0YmVj","size":114959,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8688d6fa571fd146ae1d71ebd4cafb9da9a44bec","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk5vdFNlcmlhbGl6\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJl\nYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEu\naW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5TZXJpYWxp\nemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRp\nbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwppbXBvcnQgamF2YS51dGlsLlRpbWVab25lOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuRHluYW1pY1BlcnNp\nc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\nbmhhbmNlLk1hbmFnZWRJbnN0YW5jZVByb3ZpZGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZGVmaW5pdGlvbkhl\nbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlN0YXRl\nTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZl\nY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5M\naWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQWNjZXNzQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GZXRjaEdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLlVwZGF0ZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBSWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eU1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1lRXhjZXB0\naW9uVHJhbnNsYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKCi8q\nKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUge0BsaW5rIE9wZW5KUEFTdGF0\nZU1hbmFnZXJ9IGludGVyZmFjZSBmb3IgdXNlCiAqIHdpdGggdGhpcyBydW50\naW1lLiBFYWNoIHN0YXRlIG1hbmFnZXIgbWFuYWdlcyB0aGUgc3RhdGUgb2Yg\nYSBzaW5nbGUKICogcGVyc2lzdGVuY2UgY2FwYWJsZSBpbnN0YW5jZS4gVGhl\nIHN0YXRlIG1hbmFnZXIgaXMgYWxzbyByZXNwb25zaWJsZSBmb3IKICogYWxs\nIGNvbW11bmljYXRpb25zIGFib3V0IHRoZSBpbnN0YW5jZSB0byB0aGUge0Bs\naW5rIFN0b3JlTWFuYWdlcn0uCiAqICBUaGUgc3RhdGUgbWFuYWdlciB1c2Vz\nIHRoZSBTdGF0ZSBwYXR0ZXJuIGluIGJvdGggaXRzIGludGVyYWN0aW9uIHdp\ndGgKICogdGhlIGdvdmVybmVkIGluc3RhbmNlIGFuZCBpdHMgaW50ZXJhY3Rp\nb24gd2l0aCB0aGUgYnJva2VyLgogKiBJbiBpdHMgaW50ZXJhY3Rpb25zIHdp\ndGggdGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgaW5zdGFuY2UsIGl0IHVzZXMg\ndGhlCiAqIHtAbGluayBGaWVsZE1hbmFnZXJ9IGludGVyZmFjZS4gU2ltaWxh\ncmx5LCB3aGVuIGludGVyYWN0aW5nIHdpdGggdGhlCiAqIGJyb2tlciwgaXQg\ndXNlcyB0aGUge0BsaW5rIFBDU3RhdGV9IHNpbmdsZXRvbiB0aGF0IHJlcHJl\nc2VudHMKICogdGhlIGN1cnJlbnQgbGlmZWN5Y2xlIHN0YXRlIG9mIHRoZSBp\nbnN0YW5jZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBj\nbGFzcyBTdGF0ZU1hbmFnZXJJbXBsCiAgICBpbXBsZW1lbnRzIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIsIFNlcmlhbGl6YWJsZSB7CgogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgTE9BRF9GR1MgPSAwOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgTE9BRF9BTEwgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgTE9BRF9TRVJJQUxJWkUgPSAyOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBGTEFHX1NBVkUgPSAyIDw8IDA7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRkxBR19ERVJFRiA9IDIgPDwgMTsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0xPQURFRCA9IDIgPDwgMjsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1JFQURfTE9DS0VEID0g\nMiA8PCAzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfV1JJ\nVEVfTE9DS0VEID0gMiA8PCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEZMQUdfT0lEX0FTU0lHTkVEID0gMiA8PCA1OwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEZMQUdfTE9BRElORyA9IDIgPDwgNjsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1BSRV9ERUxFVElORyA9IDIg\nPDwgNzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0ZMVVNI\nRUQgPSAyIDw8IDg7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19QUkVfRkxVU0hFRCA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0ZMVVNIRURfRElSVFkgPSAyIDw8IDEwOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfSU1QTF9DQUNIRSA9IDIgPDwg\nMTE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19JTlZFUlNF\nUyA9IDIgPDwgMTI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19OT19VTlBST1hZID0gMiA8PCAxMzsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX1ZFUlNJT05fQ0hFQ0sgPSAyIDw8IDE0OwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfVkVSU0lPTl9VUERBVEUgPSAy\nIDw8IDE1OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfREVU\nQUNISU5HID0gMiA8PCAxNjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlu\ndCBGTEFHX0VNQkVEX0RFUkVGID0gMiA8PCAxNzsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlCiAgICAgICAgKFN0YXRlTWFuYWdlckltcGwuY2xhc3MpOwoKICAgIC8v\nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBpbnN0YW5jZQogICAgcHJpdmF0ZSB0\ncmFuc2llbnQgUGVyc2lzdGVuY2VDYXBhYmxlIF9wYyA9IG51bGw7CiAgICBw\ncml2YXRlIHRyYW5zaWVudCBDbGFzc01ldGFEYXRhIF9tZXRhID0gbnVsbDsK\nICAgIHByaXZhdGUgQml0U2V0IF9sb2FkZWQgPSBudWxsOwogICAgcHJpdmF0\nZSBCaXRTZXQgX2RpcnR5ID0gbnVsbDsKICAgIHByaXZhdGUgQml0U2V0IF9m\nbHVzaCA9IG51bGw7CiAgICBwcml2YXRlIGludCBfZmxhZ3MgPSAwOwoKICAg\nIC8vIGlkIGlzIHRoZSBzdGF0ZSBtYW5hZ2VyIGlkZW50aXR5OyBvaWQgaXMg\ndGhlIHBlcnNpc3RlbnQgaWRlbnRpdHkuICBvaWQKICAgIC8vIG1heSBiZSBu\ndWxsIGZvciBlbWJlZGRlZCBhbmQgdHJhbnNpZW50LXRyYW5zYWN0aW9uYWwg\nb2JqZWN0cyBvciBuZXcKICAgIC8vIGluc3RhbmNlcyB0aGF0IGhhdmVuJ3Qg\nYmVlbiBhc3NpZ25lZCBhbiBvaWQuICBpZCBpcyByZWFzc2lnbmVkIHRvIG9p\nZAogICAgLy8gb24gc3VjY2Vzc2Z1bCBvaWQgYXNzaWdubWVudCAob3IgZmx1\nc2ggY29tcGxldGlvbiBpZiBhc3NpZ25tZW50IGlzCiAgICAvLyBkdXJpbmcg\nZmx1c2gpCiAgICBwcml2YXRlIE9iamVjdCBfaWQgPSBudWxsOwogICAgcHJp\ndmF0ZSBPYmplY3QgX29pZCA9IG51bGw7CgogICAgLy8gdGhlIG1hbmFnaW5n\nIHBlcnNpc3RlbmNlIG1hbmFnZXIgYW5kIGxpZmVjeWNsZSBzdGF0ZQogICAg\ncHJpdmF0ZSB0cmFuc2llbnQgQnJva2VySW1wbCBfYnJva2VyOyAvLyB0aGlz\nIGlzIHNlcmlhbGl6ZWQgc3BlY2lhbGx5CiAgICBwcml2YXRlIFBDU3RhdGUg\nX3N0YXRlID0gUENTdGF0ZS5UUkFOU0lFTlQ7CgogICAgLy8gdGhlIGN1cnJl\nbnQgYW5kIGxhc3QgbG9hZGVkIHZlcnNpb24gaW5kaWNhdG9ycywgYW5kIHRo\nZSBsb2NrIG9iamVjdAogICAgcHJpdmF0ZSBPYmplY3QgX3ZlcnNpb24gPSBu\ndWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xvYWRWZXJzaW9uID0gbnVsbDsK\nICAgIHByaXZhdGUgT2JqZWN0IF9sb2NrID0gbnVsbDsKICAgIHByaXZhdGUg\naW50IF9yZWFkTG9ja0xldmVsID0gLTE7CiAgICBwcml2YXRlIGludCBfd3Jp\ndGVMb2NrTGV2ZWwgPSAtMTsKCiAgICAvLyBkZWxlZ2F0ZXMgd2hlbiBwcm92\naWRpbmcvcmVwbGFjaW5nIGluc3RhbmNlIGRhdGEKICAgIHByaXZhdGUgU2lu\nZ2xlRmllbGRNYW5hZ2VyIF9zaW5nbGUgPSBudWxsOwogICAgcHJpdmF0ZSBT\nYXZlRmllbGRNYW5hZ2VyIF9zYXZlZCA9IG51bGw7CiAgICBwcml2YXRlIEZp\nZWxkTWFuYWdlciBfZm0gPSBudWxsOwoKICAgIC8vIGltcGxkYXRhOyBmaWVs\nZCBpbXBsZGF0YSBhbmQgaW50ZXJtZWRpYXRlIGRhdGEgc2hhcmUgdGhlIHNh\nbWUgYXJyYXkKICAgIHByaXZhdGUgT2JqZWN0IF9pbXBsID0gbnVsbDsKICAg\nIHByaXZhdGUgT2JqZWN0W10gX2ZpZWxkSW1wbCA9IG51bGw7CgogICAgLy8g\naW5mb3JtYXRpb24gYWJvdXQgdGhlIG93bmVyIG9mIHRoaXMgaW5zdGFuY2Us\nIGlmIGl0IGlzIGVtYmVkZGVkCiAgICBwcml2YXRlIFN0YXRlTWFuYWdlcklt\ncGwgX293bmVyID0gbnVsbDsKICAgIC8vIGZvciBlbWJlZGRhYmxlIG9iamVj\ndCBmcm9tIHF1ZXJ5IHJlc3VsdAogICAgcHJpdmF0ZSBPYmplY3QgX293bmVy\nSWQgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX293bmVySW5kZXggPSAtMTsK\nICAgIHByaXZhdGUgTGlzdCBfbWFwcGVkQnlJZEZpZWxkcyA9IG51bGw7CiAg\nICAKICAgIHByaXZhdGUgdHJhbnNpZW50IFJlZW50cmFudExvY2sgX2luc3Rh\nbmNlTG9jayA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvcjsg\nc3VwcGx5IGlkLCB0eXBlIG1ldGFkYXRhLCBhbmQgb3duaW5nIHBlcnNpc3Rl\nbmNlIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFn\nZXJJbXBsKE9iamVjdCBpZCwgQ2xhc3NNZXRhRGF0YSBtZXRhLCAKICAgICAg\nICBCcm9rZXJJbXBsIGJyb2tlcikgewogICAgICAgIF9pZCA9IGlkOwogICAg\nICAgIF9tZXRhID0gbWV0YTsKICAgICAgICBfYnJva2VyID0gYnJva2VyOwog\nICAgICAgIF9zaW5nbGUgPSBuZXcgU2luZ2xlRmllbGRNYW5hZ2VyKHRoaXMs\nIGJyb2tlcik7CiAgICAgICAgaWYgKGJyb2tlci5nZXRNdWx0aXRocmVhZGVk\nKCkpCiAgICAgICAgCV9pbnN0YW5jZUxvY2sgPSBuZXcgUmVlbnRyYW50TG9j\naygpOwoKICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0g\nQ2xhc3NNZXRhRGF0YS5JRF9VTktOT1dOKQogICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBf\nbWV0YSkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IFN0\nYXRlTWFuYWdlciBpbnN0YW5jZSBiYXNlZCBvbiB0aGUgU3RhdGVNYW5hZ2Vy\nIHByb3ZpZGVkLiBBCiAgICAgKiBuZXcgUGVyc2lzdGVuY2VDYXBhYmxlIGlu\nc3RhbmNlIHdpbGwgYmUgY3JlYXRlZCBhbmQgYXNzb2NpYXRlZCB3aXRoIHRo\nZQogICAgICogbmV3IFN0YXRlTWFuYWdlci4gQWxsIGZpZWxkcyB3aWxsIGJl\nIGNvcGllZCBpbnRvIHRoZSBuZSBQQyBpbnN0YW5jZSBhcwogICAgICogd2Vs\nbCBhcyB0aGUgZGlydHksIGxvYWRlZCwgYW5kIGZsdXNoZWQgYml0c2V0cy4K\nICAgICAqIAogICAgICogQHBhcmFtIHNtIEEgc3RhdGVtYW5hZ2VyIGluc3Rh\nbmNlIHdoaWNoIHdpbGwgZWZmZWN0aXZlbHkgYmUgY2xvbmVkLgogICAgICov\nCiAgICBwdWJsaWMgU3RhdGVNYW5hZ2VySW1wbChTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgdGhpcyhzbSwgc20uZ2V0UENTdGF0ZSgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBTdGF0ZU1hbmFnZXIg\naW5zdGFuY2UsIG9wdGlvbmFsbHkgb3ZlcnJpZGluZyB0aGUgc3RhdGUKICAg\nICAqIChGTFVTSEVELCBERUxFVEVELCBldGMpIG9mIHRoZSB1bmRlcmx5aW5n\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZSkuCiAgICAgKiAKICAgICAq\nIEBwYXJhbSBzbQogICAgICogICAgICAgICAgICBBIHN0YXRlbWFuYWdlciBp\nbnN0YW5jZSB3aGljaCB3aWxsIGVmZmVjdGl2ZWx5IGJlIGNsb25lZC4KICAg\nICAqIEBwYXJhbSBuZXdTdGF0ZQogICAgICogICAgICAgICAgICBUaGUgbmV3\nIHN0YXRlIG9mIHRoZSB1bmRlcmx5aW5nIHBlcnNpc3RlbmNlIGNhcGFibGUg\nb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgU3RhdGVNYW5hZ2VySW1wbChT\ndGF0ZU1hbmFnZXJJbXBsIHNtLCBQQ1N0YXRlIG5ld1N0YXRlKSB7IAogICAg\nICAgIHRoaXMoc20uZ2V0SWQoKSwgc20uZ2V0TWV0YURhdGEoKSwgc20uZ2V0\nQnJva2VyKCkpOwoKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgb3JpZ1BD\nID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgX3BjID0g\nb3JpZ1BDLnBjTmV3SW5zdGFuY2Uoc20sIGZhbHNlKTsKICAgICAgICAKICAg\nICAgICBpbnRbXSBmaWVsZHMgPSBuZXcgaW50W3NtLmdldE1ldGFEYXRhKCku\nZ2V0RmllbGRzKCkubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBmaWVsZHNb\naV0gPSBpOwogICAgICAgIH0KICAgICAgICBfcGMucGNDb3B5RmllbGRzKG9y\naWdQQywgZmllbGRzKTsKICAgICAgICBfcGMucGNSZXBsYWNlU3RhdGVNYW5h\nZ2VyKHRoaXMpOwogICAgICAgIF9zdGF0ZSA9IG5ld1N0YXRlOwoKICAgICAg\nICAvLyBjbG9uZSB0aGUgZmllbGQgYml0c2V0cy4gCiAgICAgICAgX2RpcnR5\nPShCaXRTZXQpc20uZ2V0RGlydHkoKS5jbG9uZSgpOwogICAgICAgIF9sb2Fk\nZWQgPSAoQml0U2V0KXNtLmdldExvYWRlZCgpLmNsb25lKCk7CiAgICAgICAg\nX2ZsdXNoID0gKEJpdFNldCkgc20uZ2V0Rmx1c2hlZCgpLmNsb25lKCk7CiAg\nICAgICAgX3ZlcnNpb24gPSBzbS5nZXRWZXJzaW9uKCk7CiAgICAgICAgCiAg\nICAgICAgX29pZCA9IHNtLmdldE9iamVjdElkKCk7IAogICAgICAgIF9pZCA9\nIHNtLmdldElkKCk7CiAgICAgICAgCiAgICAgICAgLy8gbW9yZSBkYXRhIG1h\neSBuZWVkIHRvIGJlIGNvcGllZC4gCiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIG93bmluZyBzdGF0ZSBhbmQgZmllbGQgaWYgdGhpcyBpcyBhbiBl\nbWJlZGRlZCBpbnN0YW5jZS4KICAgICAqLwogICAgdm9pZCBzZXRPd25lcihT\ndGF0ZU1hbmFnZXJJbXBsIG93bmVyLCBWYWx1ZU1ldGFEYXRhIG93bmVyTWV0\nYSkgewogICAgICAgIF9vd25lciA9IG93bmVyOwogICAgICAgIF9vd25lcklu\nZGV4ID0gb3duZXJNZXRhLmdldEZpZWxkTWV0YURhdGEoKS5nZXRJbmRleCgp\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIHN0YXRlIG1h\nbmFnZXIgaXMgaW4gdGhlIG1pZGRsZSBvZiBhIGxvYWQuCiAgICAgKi8KICAg\nIGJvb2xlYW4gaXNMb2FkaW5nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdz\nICYgRkxBR19MT0FESU5HKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRoaXMgc3RhdGUgbWFuYWdlciBpcyBpbiB0aGUgbWlkZGxlIG9m\nIGEgbG9hZCBpbml0aWF0ZWQKICAgICAqIGJ5IG91dHNpZGUgY29kZTsgZm9y\nIGFueSBpbnRlcm5hbCBtZXRob2RzIHRoYXQgY2F1c2UgbG9hZGluZywgdGhl\nCiAgICAgKiBsb2FkaW5nIGZsYWcgaXMgc2V0IGF1dG9tYXRpY2FsbHkuCiAg\nICAgKi8KICAgIHZvaWQgc2V0TG9hZGluZyhib29sZWFuIGxvYWRpbmcpIHsK\nICAgICAgICBpZiAobG9hZGluZykKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfTE9BRElORzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19MT0FESU5HOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9y\nIHJlc2V0IHRoZSBsaWZlY3ljbGUgc3RhdGUgb2YgdGhlIG1hbmFnZWQgaW5z\ndGFuY2UuIElmIHRoZQogICAgICogdHJhbnNhY3Rpb25hbCBzdGF0ZSBvZiB0\naGUgaW5zdGFuY2UgY2hhbmdlcywgaXQgd2lsbCBiZSBlbmxpc3RlZC8KICAg\nICAqIGRlbGlzdGVkIGZyb20gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gYXMg\nbmVjZXNzYXJ5LiBUaGUgZ2l2ZW4KICAgICAqIHN0YXRlIHdpbGwgYmUgaW5p\ndGlhbGl6ZWQgYWZ0ZXIgYmVpbmcgc2V0LiBJZiB0aGUgZ2l2ZW4gc3RhdGUK\nICAgICAqIGlzIHRoZSBzYW1lIGFzIHRoZSBjdXJyZW50IHN0YXRlLCB0aGlz\nIG1ldGhvZCB3aWxsIGhhdmUgbm8gZWZmZWN0LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgc2V0UENTdGF0ZShQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAg\naWYgKF9zdGF0ZSA9PSBzdGF0ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbm90\naWZ5IHRoZSBzdG9yZSBtYW5hZ2VyIHRoYXQgd2UncmUgY2hhbmdpbmcgc3Rh\ndGVzOyBjYW4gdmV0bwogICAgICAgICAgICBfYnJva2VyLmdldFN0b3JlTWFu\nYWdlcigpLmJlZm9yZVN0YXRlQ2hhbmdlKHRoaXMsIF9zdGF0ZSwgc3RhdGUp\nOwoKICAgICAgICAgICAgLy8gcmVwbGFjZSBzdGF0ZQogICAgICAgICAgICBi\nb29sZWFuIHdhc0RlbGV0ZWQgPSBfc3RhdGUuaXNEZWxldGVkKCk7CiAgICAg\nICAgICAgIGJvb2xlYW4gd2FzRGlydHkgPSBfc3RhdGUuaXNEaXJ0eSgpOwog\nICAgICAgICAgICBib29sZWFuIHdhc1BlbmRpbmcgPSBfc3RhdGUuaXNQZW5k\naW5nVHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICBfc3RhdGUgPSBzdGF0\nZTsKCiAgICAgICAgICAgIC8vIGVubGlzdC9kZWxpc3QgZnJvbSB0cmFuc2Fj\ndGlvbgogICAgICAgICAgICBpZiAoX3N0YXRlLmlzVHJhbnNhY3Rpb25hbCgp\nKSB7CiAgICAgICAgICAgICAgICBfYnJva2VyLmFkZFRvVHJhbnNhY3Rpb24o\ndGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoX3N0YXRlLmlzRGVsZXRlZCgp\nICE9IHdhc0RlbGV0ZWQpCiAgICAgICAgICAgICAgICAgICAgX2Jyb2tlci5z\nZXREaXJ0eSh0aGlzLCAhd2FzRGlydHkgfHwgaXNGbHVzaGVkKCkpOwogICAg\nICAgICAgICAgICAgZWxzZSBpZiAoX3N0YXRlLmlzRGlydHkoKSAmJiAhd2Fz\nRGlydHkpCiAgICAgICAgICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0\naGlzLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmICghd2FzUGVuZGlu\nZyAmJiBfc3RhdGUuaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpKQogICAgICAg\nICAgICAgICAgX2Jyb2tlci5hZGRUb1BlbmRpbmdUcmFuc2FjdGlvbih0aGlz\nKTsKICAgICAgICAgICAgZWxzZSBpZiAod2FzUGVuZGluZyAmJiAhX3N0YXRl\nLmlzUGVuZGluZ1RyYW5zYWN0aW9uYWwoKSkKICAgICAgICAgICAgICAgIF9i\ncm9rZXIucmVtb3ZlRnJvbVBlbmRpbmdUcmFuc2FjdGlvbih0aGlzKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1vdmVG\ncm9tVHJhbnNhY3Rpb24odGhpcyk7CgogICAgICAgICAgICAvLyBpbml0aWFs\naXplCiAgICAgICAgICAgIF9zdGF0ZS5pbml0aWFsaXplKHRoaXMpOwogICAg\nICAgICAgICBpZiAoX3N0YXRlLmlzRGVsZXRlZCgpICYmICF3YXNEZWxldGVk\nKQogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNs\nZUV2ZW50LkFGVEVSX0RFTEVURSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lk\nIGluaXRpYWxpemUoQ2xhc3MgY2xzLCBQQ1N0YXRlIHN0YXRlKSB7CiAgICAg\nICAgLy8gY2hlY2sgdG8gc2VlIGlmIG91ciBjdXJyZW50IG9iamVjdCBpZCBp\nbnN0YW5jZSBpcyB0aGUKICAgICAgICAvLyBjb3JyZWN0IGlkIHR5cGUgZm9y\nIHRoZSBzcGVjaWZpZWQgY2xhc3M7IHRoaXMgaXMgZm9yIGNhc2VzCiAgICAg\nICAgLy8gd2hlbiB3ZSBoYXZlIGFuIGFwcGxpY2F0aW9uIGlkIGhpZXJhcmNo\neSBhbmQgd2UgaGFkIHNldCB0aGUKICAgICAgICAvLyBtZXRhZGF0YSB0byBh\nIHN1cGVyY2xhc3MgaWQgLS0gdGhlIHN1YmNsYXNzJyBpZCBtYXkgYmUgYQog\nICAgICAgIC8vIGRpZmZlcmVudCBjbGFzcywgc28gd2UgbmVlZCB0byByZXNl\ndCBpdAogICAgICAgIGlmIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkgIT0g\nY2xzKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3ViID0gX21ldGEu\nZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhCiAgICAgICAgICAgICAgICAo\nY2xzLCBfYnJva2VyLmdldENsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAg\nICAgICBpZiAoX29pZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9E\nQVRBU1RPUkUpCiAgICAgICAgICAgICAgICAgICAgX29pZCA9IF9icm9rZXIu\nZ2V0U3RvcmVNYW5hZ2VyKCkuY29weURhdGFTdG9yZUlkKF9vaWQsCiAgICAg\nICAgICAgICAgICAgICAgICAgIHN1Yik7CiAgICAgICAgICAgICAgICBlbHNl\nIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICAg\nICAgICAgIF9vaWQgPSBBcHBsaWNhdGlvbklkcy5jb3B5KF9vaWQsIHN1Yik7\nCiAgICAgICAgICAgICAgICBlbHNlIGlmIChzdWIuZ2V0T2JqZWN0SWRUeXBl\nKCkgIT0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBPYmplY3RbXSBwa0ZpZWxkcyA9IEFwcGxpY2F0aW9uSWRzLnRv\nUEtWYWx1ZXMoX29pZCwgX21ldGEpOwogICAgICAgICAgICAgICAgICAgIF9v\naWQgPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXMocGtGaWVsZHMsIHN1\nYik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgX21ldGEgPSBzdWI7CiAgICAgICAgfQoKICAgICAgICBQZXJzaXN0ZW5j\nZUNhcGFibGUgaW5zdCA9IFBDUmVnaXN0cnkubmV3SW5zdGFuY2UoY2xzLCB0\naGlzLCBfb2lkLCB0cnVlKTsKICAgICAgICBpZiAoaW5zdCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIHRoZSBpbnN0YW5jZSB3YXMgbnVsbDogY2hlY2sg\ndG8gc2VlIGlmIHRoZSBpbnN0YW5jZSBpcwogICAgICAgICAgICAvLyBhYnN0\ncmFjdCAoYXMgY2FuIHNvbWV0aW1lcyBiZSB0aGUgY2FzZSB3aGVuIHRoZQog\nICAgICAgICAgICAvLyBjbGFzcyBkaXNjcmltaW5hdG9yIHN0cmF0ZWd5IGlz\nIG5vdCBjb25maWd1cmVkIGNvcnJlY3RseSkKICAgICAgICAgICAgaWYgKE1v\nZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJp\nbnN0YW50aWF0ZS1hYnN0cmFjdCIsCiAgICAgICAgICAgICAgICAgICAgY2xz\nLmdldE5hbWUoKSwgX29pZCkpOwogICAgICAgICAgICB0aHJvdyBuZXcgSW50\nZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIGluaXRpYWxp\nemUoaW5zdCwgc3RhdGUpOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlh\nbGl6ZSB3aXRoIHRoZSBnaXZlbiBpbnN0YW5jZSBhbmQgc3RhdGUuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGluaXRpYWxpemUoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAgaWYgKHBjID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJpbml0LW51bGwtcGMiLCBfbWV0YSkpOwogICAgICAgIGlmIChw\nYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IG51bGwgJiYgcGMucGNHZXRTdGF0\nZU1hbmFnZXIoKSAhPSB0aGlzKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiaW5pdC1zbS1wYyIsCiAgICAgICAgICAg\nICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHBjKSkpLnNldEZhaWxlZE9iamVj\ndChwYyk7CiAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHRoaXMp\nOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZp\nZWxkcygpOwogICAgICAgIF9sb2FkZWQgPSBuZXcgQml0U2V0KGZtZHMubGVu\nZ3RoKTsKICAgICAgICBfZmx1c2ggPSBuZXcgQml0U2V0KGZtZHMubGVuZ3Ro\nKTsKICAgICAgICBfZGlydHkgPSBuZXcgQml0U2V0KGZtZHMubGVuZ3RoKTsK\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIC8vIG1hcmsgcHJpbWFyeSBrZXkgYW5kIG5vbi1w\nZXJzaXN0ZW50IGZpZWxkcyBhcyBsb2FkZWQKICAgICAgICAgICAgaWYgKGZt\nZHNbaV0uaXNQcmltYXJ5S2V5KCkKICAgICAgICAgICAgICAgIHx8IGZtZHNb\naV0uZ2V0TWFuYWdlbWVudCgpICE9IGZtZHNbaV0uTUFOQUdFX1BFUlNJU1RF\nTlQpCiAgICAgICAgICAgICAgICBfbG9hZGVkLnNldChpKTsKICAgICAgICAg\nICAgCiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9\nPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKSB7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgbWFwcGVkQnlJZFZhbHVlID0gZm1kc1tpXS5nZXRNYXBw\nZWRCeUlkVmFsdWUoKTsgCiAgICAgICAgICAgICAgICBpZiAobWFwcGVkQnlJ\nZFZhbHVlICE9IG51bGwpIHsgCiAgICAgICAgICAgICAgICAgICAgaWYgKCFB\ncHBsaWNhdGlvbklkcy5pc0lkU2V0KF9pZCwgX21ldGEsIG1hcHBlZEJ5SWRW\nYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9tYXBwZWRC\neUlkRmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBfbWFwcGVkQnlJZEZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgX21hcHBlZEJ5SWRGaWVsZHMuYWRkKGZtZHNb\naV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZWNvcmQgd2hldGhlciB0\naGVyZSBhcmUgYW55IG1hbmFnZWQgaW52ZXJzZSBmaWVsZHMKICAgICAgICAg\nICAgaWYgKF9icm9rZXIuZ2V0SW52ZXJzZU1hbmFnZXIoKSAhPSBudWxsCiAg\nICAgICAgICAgICAgICAmJiBmbWRzW2ldLmdldEludmVyc2VNZXRhRGF0YXMo\nKS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nSU5WRVJTRVM7CiAgICAgICAgfQoKICAgICAgICBwYy5wY1NldERldGFjaGVk\nU3RhdGUobnVsbCk7CiAgICAgICAgX3BjID0gcGM7CgogICAgICAgIGlmIChf\nb2lkIGluc3RhbmNlb2YgT3BlbkpQQUlkKQogICAgICAgICAgICAoKE9wZW5K\nUEFJZCkgX29pZCkuc2V0TWFuYWdlZEluc3RhbmNlVHlwZShfbWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCkpOwoKICAgICAgICAvLyBpbml0aWFsaXplIG91ciBz\ndGF0ZSBhbmQgYWRkIG91cnNlbHZlcyB0byB0aGUgYnJva2VyJ3MgY2FjaGUK\nICAgICAgICBzZXRQQ1N0YXRlKHN0YXRlKTsKICAgICAgICBpZiAoIF9vaWQg\nPT0gbnVsbCB8fCAgCiAgICAgICAgICAgIF9icm9rZXIuZ2V0U3RhdGVNYW5h\nZ2VySW1wbEJ5SWQoX29pZCwgZmFsc2UpID09IG51bGwpIHsKICAgICAgICAJ\nX2Jyb2tlci5zZXRTdGF0ZU1hbmFnZXIoX2lkLCB0aGlzLCBCcm9rZXJJbXBs\nLlNUQVRVU19JTklUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09\nIFBDU3RhdGUuUE5FVykKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50\nKExpZmVjeWNsZUV2ZW50LkFGVEVSX1BFUlNJU1QpOwoKICAgICAgICAvLyBp\nZiB0aGlzIGlzIGEgbm9uLXRyYWNraW5nIFBDLCBhZGQgYSBoYXJkIHJlZiB0\nbyB0aGUgYXBwcm9wcmlhdGUgZGF0YQogICAgICAgIC8vIHNldHMgYW5kIGdp\ndmUgaXQgYW4gb3Bwb3J0dW5pdHkgdG8gbWFrZSBhIHN0YXRlIHNuYXBzaG90\nLgogICAgICAgIGlmICghaXNJbnRlcmNlcHRpbmcoKSkgewogICAgICAgICAg\nICBzYXZlRmllbGRzKHRydWUpOwogICAgICAgICAgICBpZiAoIWlzTmV3KCkp\nCiAgICAgICAgICAgICAgICBSZWRlZmluaXRpb25IZWxwZXIuYXNzaWduTGF6\neUxvYWRQcm94aWVzKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgb3Igbm90IGRhdGEgYWNjZXNzIGluIHRoaXMgaW5z\ndGFuY2UgaXMgaW50ZXJjZXB0ZWQuIFRoaXMgZGlmZmVycwogICAgICogZnJv\nbSB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNpc0ludGVyY2VwdGluZygpfSBpbiB0\naGF0IGl0IGNoZWNrcyBmb3IKICAgICAqIHByb3BlcnR5IGFjY2VzcyArIHN1\nYmNsYXNzaW5nIGluIGFkZGl0aW9uIHRvIHRoZSByZWRlZmluaXRpb24gLwog\nICAgICogZW5oYW5jZW1lbnQgY2hlY2tzLgogICAgICoKICAgICAqIEBzaW5j\nZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ludGVyY2Vw\ndGluZygpIHsKICAgICAgICBpZiAoZ2V0TWV0YURhdGEoKS5pc0ludGVyY2Vw\ndGluZygpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAvLyBU\nT0RPOkpSQiBJbnRlcmNlcHRpbmcgCiAgICAgICAgaWYgKEFjY2Vzc0NvZGUu\naXNQcm9wZXJ0eShnZXRNZXRhRGF0YSgpLmdldEFjY2Vzc1R5cGUoKSkKICAg\nICAgICAgICAgJiYgX3BjIGluc3RhbmNlb2YgRHluYW1pY1BlcnNpc3RlbmNl\nQ2FwYWJsZSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSB0aGUgZ2l2\nZW4gbGlmZWN5Y2xlIGV2ZW50IHRvIGFsbCBsaXN0ZW5lcnMuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBmaXJlTGlmZWN5Y2xlRXZlbnQoaW50IHR5\ncGUpIHsKICAgICAgICBpZiAodHlwZSA9PSBMaWZlY3ljbGVFdmVudC5BRlRF\nUl9QRVJTSVNUCiAgICAgICAgICAgICAgICAmJiBfYnJva2VyLmdldENvbmZp\nZ3VyYXRpb24oKS5nZXRDYWxsYmFja09wdGlvbnNJbnN0YW5jZSgpLmdldFBv\nc3RQZXJzaXN0Q2FsbGJhY2tJbW1lZGlhdGUoKSkgewogICAgICAgICAgICBm\nZXRjaE9iamVjdElkKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYnJv\na2VyLmZpcmVMaWZlY3ljbGVFdmVudChnZXRNYW5hZ2VkSW5zdGFuY2UoKSwg\nbnVsbCwgX21ldGEsIHR5cGUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxv\nYWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgbG9hZChm\nZXRjaCwgTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIExvYWQgdGhlIHN0YXRlIG9mIHRoaXMgaW5zdGFuY2Ug\nYmFzZWQgb24gdGhlIGdpdmVuIGZldGNoIGNvbmZpZ3VyYXRpb24KICAgICAq\nIGFuZCBsb2FkIG1vZGUuIFJldHVybiB0cnVlIGlmIGFueSBkYXRhIHdhcyBs\nb2FkZWQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGJvb2xlYW4gbG9hZChGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBs\nb2FkTW9kZSwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0IHNkYXRh\nLCBib29sZWFuIGZvcldyaXRlKSB7CiAgICAgICAgaWYgKCFmb3JXcml0ZQog\nICAgICAgICAgICAmJiAoIWlzUGVyc2lzdGVudCgpIHx8IChpc05ldygpICYm\nICFpc0ZsdXNoZWQoKSkgfHwgaXNEZWxldGVkKCkpKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGlmIGFueSBmaWVsZHMgYmVpbmcg\nbG9hZGVkLCBkbyBzdGF0ZSB0cmFuc2l0aW9ucyBmb3IgcmVhZAogICAgICAg\nIEJpdFNldCBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBs\nb2FkTW9kZSwgZXhjbHVkZSk7CiAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSBf\nYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgaWYgKCFmb3JXcml0ZSAmJiBm\naWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgYmVmb3JlUmVhZCgtMSk7Cgog\nICAgICAgIC8vIGNhbGwgbG9hZCBldmVuIGlmIG5vIGZpZWxkcyBhcmUgYmVp\nbmcgbG9hZGVkLCBiZWNhdXNlIGl0IHRha2VzCiAgICAgICAgLy8gY2FyZSBv\nZiBjaGVja2luZyBpZiB0aGUgREZHIGlzIGxvYWRlZCwgbWFraW5nIHN1cmUg\ndmVyc2lvbiBpbmZvCiAgICAgICAgLy8gaXMgbG9hZGVkLCBldGMKICAgICAg\nICBpbnQgbG9ja0xldmVsID0gY2FsY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwg\nZm9yV3JpdGUsIGZldGNoKTsKICAgICAgICBib29sZWFuIHJldCA9IGxvYWRG\naWVsZHMoZmllbGRzLCBmZXRjaCwgbG9ja0xldmVsLCBzZGF0YSk7CiAgICAg\nICAgb2J0YWluTG9ja3MoYWN0aXZlLCBmb3JXcml0ZSwgbG9ja0xldmVsLCBm\nZXRjaCwgc2RhdGEpOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBnZXRNYW5hZ2VkSW5zdGFuY2UoKSB7CiAgICAgICAg\naWYgKF9wYyBpbnN0YW5jZW9mIE1hbmFnZWRJbnN0YW5jZVByb3ZpZGVyKQog\nICAgICAgICAgICByZXR1cm4gKChNYW5hZ2VkSW5zdGFuY2VQcm92aWRlcikg\nX3BjKS5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAgcHVibGljIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBnZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9wYzsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBn\nZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9Cgog\nICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0T3duZXIoKSB7CiAg\nICAgICAgcmV0dXJuIF9vd25lcjsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdl\ndE93bmVySW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lckluZGV4Owog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE93bmVyKE9iamVjdCBvaWQpIHsK\nICAgICAgICBfb3duZXJJZCA9IG9pZDsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0VtYmVkZGVkKCkgewogICAgICAgIC8vIF9vd25lciBtYXkgbm90\nIGJlIHNldCBpZiBlbWJlZCBvYmplY3QgaXMgZnJvbSBxdWVyeSByZXN1bHQK\nICAgICAgICByZXR1cm4gX293bmVyICE9IG51bGwgfHwgX3N0YXRlIGluc3Rh\nbmNlb2YgRU5vblRyYW5zU3RhdGU7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNGbHVzaGVkKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxB\nR19GTFVTSEVEKSA+IDA7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNG\nbHVzaGVkRGlydHkoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFH\nX0ZMVVNIRURfRElSVFkpID4gMDsKICAgIH0KCiAgICBwdWJsaWMgQml0U2V0\nIGdldExvYWRlZCgpIHsKICAgICAgICByZXR1cm4gX2xvYWRlZDsKICAgIH0K\nCiAgICBwdWJsaWMgQml0U2V0IGdldEZsdXNoZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9mbHVzaDsKICAgIH0KCiAgICBwdWJsaWMgQml0U2V0IGdldERpcnR5\nKCkgewogICAgICAgIHJldHVybiBfZGlydHk7CiAgICB9CgogICAgcHVibGlj\nIEJpdFNldCBnZXRVbmxvYWRlZChGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gp\nIHsKICAgICAgICAvLyBjb2xsZWN0IGZpZWxkcyB0byBsb2FkIGZyb20gZGF0\nYSBzdG9yZSBiYXNlZCBvbiBmZXRjaCBjb25maWd1cmF0aW9uCiAgICAgICAg\nQml0U2V0IGZpZWxkcyA9IGdldFVubG9hZGVkSW50ZXJuYWwoZmV0Y2gsIExP\nQURfRkdTLCBudWxsKTsKICAgICAgICByZXR1cm4gKGZpZWxkcyA9PSBudWxs\nKSA/IG5ldyBCaXRTZXQoMCkgOiBmaWVsZHM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbnRlcm5hbCB2ZXJzaW9uIG9mIHtAbGluayBPcGVuSlBBU3RhdGVN\nYW5hZ2VyI2dldFVubG9hZGVkfSB0aGF0IGF2b2lkcwogICAgICogY3JlYXRp\nbmcgYW4gZW1wdHkgYml0IHNldCBieSByZXR1cm5pbmcgbnVsbCB3aGVuIHRo\nZXJlIGFyZSBubyB1bmxvYWRlZAogICAgICogZmllbGRzLgogICAgICovCiAg\nICBwcml2YXRlIEJpdFNldCBnZXRVbmxvYWRlZEludGVybmFsKEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IG1vZGUsCiAgICAgICAgQml0U2V0IGV4\nY2x1ZGUpIHsKICAgICAgICBpZiAoZXhjbHVkZSA9PSBTdG9yZUNvbnRleHQu\nRVhDTFVERV9BTEwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBCaXRTZXQgZmllbGRzID0gbnVsbDsKICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGJvb2xlYW4g\nbG9hZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGkpIHx8IChl\neGNsdWRlICE9IG51bGwgJiYgZXhjbHVkZS5nZXQoaSkpKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgTE9BRF9TRVJJQUxJWkU6CiAgICAgICAg\nICAgICAgICAgICAgbG9hZCA9ICFmbWRzW2ldLmlzVHJhbnNpZW50KCk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIExPQURfRkdTOgogICAgICAgICAgICAgICAgICAgIGxvYWQgPSBmZXRjaCA9\nPSBudWxsIHx8IGZldGNoLnJlcXVpcmVzRmV0Y2goZm1kc1tpXSkgCiAgICAg\nICAgICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJhdGlvbi5GRVRD\nSF9OT05FOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDogLy8gTE9BRF9BTEwKICAgICAgICAgICAgICAgICAg\nICBsb2FkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKGxvYWQpIHsKICAgICAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBuZXcgQml0U2V0KGZtZHMu\nbGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZpZWxkcy5zZXQoaSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpZWxkczsKICAg\nIH0KCiAgICBwdWJsaWMgU3RvcmVDb250ZXh0IGdldENvbnRleHQoKSB7CiAg\nICAgICAgcmV0dXJuIF9icm9rZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYW5hZ2luZyBicm9rZXIuCiAgICAgKi8KICAgIEJyb2tlckltcGwgZ2V0QnJv\na2VyKCkgewogICAgICAgIHJldHVybiBfYnJva2VyOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZ2V0SWQoKSB7CiAgICAgICAgcmV0dXJuIF9pZDsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldE9iamVjdElkKCkgewogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSB0aGlzOwogICAgICAgIHdoaWxlIChz\nbS5nZXRPd25lcigpICE9IG51bGwpCiAgICAgICAgICAgIHNtID0gKFN0YXRl\nTWFuYWdlckltcGwpIHNtLmdldE93bmVyKCk7CiAgICAgICAgaWYgKHNtLmlz\nRW1iZWRkZWQoKSAmJiBzbS5nZXRPd25lcigpID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBzbS5fb3duZXJJZDsKICAgICAgICByZXR1cm4gc20uX29p\nZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3RJZChPYmplY3Qg\nb2lkKSB7CiAgICAgICAgX29pZCA9IG9pZDsKICAgICAgICBpZiAoX3BjICE9\nIG51bGwgJiYgb2lkIGluc3RhbmNlb2YgT3BlbkpQQUlkKQogICAgICAgICAg\nICAoKE9wZW5KUEFJZCkgb2lkKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKF9t\nZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICB9CgogICAgcHVibGljIFN0\nYXRlTWFuYWdlckltcGwgZ2V0T2JqZWN0SWRPd25lcigpIHsKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20u\nZ2V0T3duZXIoKSAhPSBudWxsKQogICAgICAgICAgICBzbSA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBzbS5nZXRPd25lcigpOwogICAgICAgIHJldHVybiBzbTsK\nICAgIH0KICAgIHB1YmxpYyBib29sZWFuIGFzc2lnbk9iamVjdElkKGJvb2xl\nYW4gZmx1c2gpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIGFzc2lnbk9iamVjdElkKGZsdXNoLCBmYWxzZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXNrIHN0b3JlIG1hbmFn\nZXIgdG8gYXNzaWduIG91ciBvaWQsIG9wdGlvbmFsbHkgZmx1c2hpbmcgYW5k\nCiAgICAgKiBvcHRpb25hbGx5IHJlY2FjaGluZyBvbiB0aGUgbmV3IG9pZC4K\nICAgICAqLwogICAgYm9vbGVhbiBhc3NpZ25PYmplY3RJZChib29sZWFuIGZs\ndXNoLCBib29sZWFuIHByZUZsdXNoaW5nKSB7CiAgICAgICAgaWYgKF9vaWQg\nIT0gbnVsbCB8fCBpc0VtYmVkZGVkKCkgfHwgIWlzUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgaWYgKF9icm9rZXIu\nZ2V0U3RvcmVNYW5hZ2VyKCkuYXNzaWduT2JqZWN0SWQodGhpcywgcHJlRmx1\nc2hpbmcpKSB7CiAgICAgICAgICAgIGlmICghcHJlRmx1c2hpbmcpCiAgICAg\nICAgICAgICAgICBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKHRydWUpOwogICAg\nICAgIH0gZWxzZSBpZiAoZmx1c2gpCiAgICAgICAgICAgIF9icm9rZXIuZmx1\nc2goKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2Ugc3VyZSB3ZSB3ZXJlIGFzc2lnbmVkIGFuIG9pZCwgYW5kIHBlcmZvcm0g\nYWN0aW9ucyB0byBtYWtlIGl0CiAgICAgKiBwZXJtYW5lbnQuCiAgICAgKgog\nICAgICogQHBhcmFtIHJlY2FjaGUgd2hldGhlciB0byByZWNhY2hlIG91cnNl\nbGYgb24gdGhlIG5ldyBvaWQKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFz\nc2VydE9iamVjdElkQXNzaWduZWQoYm9vbGVhbiByZWNhY2hlKSB7CiAgICAg\nICAgaWYgKCFpc05ldygpIHx8IGlzRGVsZXRlZCgpIHx8IGlzUHJvdmlzaW9u\nYWwoKSAKICAgICAgICAgICAgfHwgKF9mbGFncyAmIEZMQUdfT0lEX0FTU0lH\nTkVEKSAhPSAwKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKF9v\naWQgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oRXhjZXB0\naW9ucy50b1N0cmluZwogICAgICAgICAgICAgICAgICAgIChnZXRNYW5hZ2Vk\nSW5zdGFuY2UoKSkpOwogICAgICAgICAgICBfb2lkID0gQXBwbGljYXRpb25J\nZHMuY3JlYXRlKF9wYywgX21ldGEpOwogICAgICAgIH0KCiAgICAgICAgT2Jq\nZWN0IG9yaWcgPSBfaWQ7CiAgICAgICAgX2lkID0gX29pZDsKICAgICAgICBp\nZiAocmVjYWNoZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgX2Jyb2tlci5zZXRTdGF0ZU1hbmFnZXIob3JpZywgdGhpcywKICAgICAg\nICAgICAgICAgICAgICBCcm9rZXJJbXBsLlNUQVRVU19PSURfQVNTSUdOKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICAgICAgX2lkID0gb3JpZzsKICAgICAgICAgICAgICAgIF9v\naWQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfT0lEX0FT\nU0lHTkVEOwogICAgfQoKICAgIC8qKgogICAgICogQXNzaWduIHRoZSBwcm9w\nZXIgZ2VuZXJhdGVkIHZhbHVlIHRvIHRoZSBnaXZlbiBmaWVsZCBiYXNlZCBv\nbiBpdHMKICAgICAqIHZhbHVlLXN0cmF0ZWd5LgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gYXNzaWduRmllbGQoaW50IGZpZWxkLCBib29sZWFuIHBy\nZUZsdXNoaW5nKSB7CiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9\nIHRoaXM7CiAgICAgICAgd2hpbGUgKHNtICE9IG51bGwgJiYgc20uaXNFbWJl\nZGRlZCgpKQogICAgICAgICAgICBzbSA9IHNtLmdldE93bmVyKCk7CiAgICAg\nICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICBpZiAoIXNtLmlzTmV3KCkgfHwgc20uaXNGbHVzaGVkKCkgfHwg\nc20uaXNEZWxldGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgLy8gc3BlY2lhbC1jYXNlIG9pZCBmaWVsZHMsIHdoaWNoIHJlcXVp\ncmUgdXMgdG8gbG9vayBpbnNpZGUgdGhlIG9pZAogICAgICAgIC8vIG9iamVj\ndAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQo\nZmllbGQpOwogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5PSUQpIHsKICAgICAgICAgICAgLy8gdHJ5IHRvIHNo\nb3J0Y3V0IGlmIHBvc3NpYmxlCiAgICAgICAgICAgIGlmIChfb2lkICE9IG51\nbGwgfHwgaXNFbWJlZGRlZCgpIHx8ICFpc1BlcnNpc3RlbnQoKSkKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgLy8gY2hlY2sg\nZW1iZWRkZWQgZmllbGRzIG9mIG9pZCBmb3IgdmFsdWUgc3RyYXRlZ3kgKyBk\nZWZhdWx0IHZhbHVlCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3Mg\nPSBmbWQuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAg\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG9pZHNtID0gbnVsbDsKICAg\nICAgICAgICAgYm9vbGVhbiBhc3NpZ24gPSBmYWxzZTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7ICFhc3NpZ24gJiYgaSA8IHBrcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1ZVN0cmF0\nZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAob2lkc20gPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBvaWRzbSA9IG5ldyBPYmplY3RJ\nZFN0YXRlTWFuYWdlcihmZXRjaE9iamVjdEZpZWxkKGZpZWxkKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhpcywgZm1kKTsKICAgICAgICAgICAgICAg\nIGFzc2lnbiA9IG9pZHNtLmlzRGVmYXVsdFZhbHVlKGkpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBhc3NpZ24gJiYgYXNzaWduT2JqZWN0\nSWQoIXByZUZsdXNoaW5nLCBwcmVGbHVzaGluZyk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBKdXN0IHJldHVybiBpZiB0aGVyZSdzIG5vIHZhbHVlIGdlbmVy\nYXRpb24gc3RyYXRlZ3kKICAgICAgICBpZiAoZm1kLmdldFZhbHVlU3RyYXRl\nZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIAogICAgICAgIC8vIFRocm93IGV4Y2VwdGlv\nbiBpZiBmaWVsZCBhbHJlYWR5IGhhcyBhIHZhbHVlIGFzc2lnbmVkLgogICAg\nICAgIC8vIEBHZW5lcmF0ZWRWYWx1ZSBvdmVycmlkZXMgUE9KTyBpbml0aWFs\nIHZhbHVlcyBhbmQgc2V0dGVyIG1ldGhvZHMKICAgICAgICBpZiAoIWZtZC5p\nc1ZhbHVlR2VuZXJhdGVkKCkgJiYgIWlzRGVmYXVsdFZhbHVlKGZpZWxkKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgKICAgICAgICAgICAgICAgICJleGlzdGluZy12YWx1ZS1vdmVy\ncmlkZS1leGNlcCIsIGZtZC5nZXRGdWxsTmFtZShmYWxzZSkpKTsKCiAgICAg\nICAgLy8gZm9yIHByaW1hcnkga2V5IGZpZWxkcywgYXNzaWduIHRoZSBvYmpl\nY3QgaWQgYW5kIHJlY2FjaGUgc28gdGhhdAogICAgICAgIC8vIHRvIHRoZSB1\nc2VyLCBzbyBpdCBsb29rcyBsaWtlIHRoZSBvaWQgYWx3YXlzIG1hdGNoZXMg\ndGhlIHBrIGZpZWxkcwogICAgICAgIGlmIChmbWQuaXNQcmltYXJ5S2V5KCkg\nJiYgIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGFzc2lnbk9i\namVjdElkKCFwcmVGbHVzaGluZywgcHJlRmx1c2hpbmcpOwoKICAgICAgICAv\nLyBmb3Igb3RoZXIgZmllbGRzIGp1c3QgYXNzaWduIHRoZSBmaWVsZCBvciBm\nbHVzaCBpZiBuZWVkZWQKICAgICAgICBpZiAoX2Jyb2tlci5nZXRTdG9yZU1h\nbmFnZXIoKS5hc3NpZ25GaWVsZCh0aGlzLCBmaWVsZCwgcHJlRmx1c2hpbmcp\nKSB7CiAgICAgICAgICAgIGZtZC5zZXRWYWx1ZUdlbmVyYXRlZCh0cnVlKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlm\nICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgIF9icm9rZXIuZmx1c2goKTsK\nICAgICAgICByZXR1cm4gIXByZUZsdXNoaW5nOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0TG9jaygpIHsKICAgICAgICByZXR1cm4gX2xvY2s7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0TG9jayhPYmplY3QgbG9jaykgewog\nICAgICAgIF9sb2NrID0gbG9jazsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF92ZXJzaW9uOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFZlcnNpb24oT2JqZWN0IHZlcnNpb24p\nIHsKICAgICAgICBfbG9hZFZlcnNpb24gPSB2ZXJzaW9uOwogICAgICAgIGFz\nc2lnblZlcnNpb25GaWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAgICBPYmplY3Qg\nZ2V0TG9hZFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkVmVyc2lv\nbjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROZXh0VmVyc2lvbihPYmpl\nY3QgdmVyc2lvbikgewogICAgICAgIGFzc2lnblZlcnNpb25GaWVsZCh2ZXJz\naW9uKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYXNzaWduVmVyc2lvbkZp\nZWxkKE9iamVjdCB2ZXJzaW9uKSB7CiAgICAgICAgX3ZlcnNpb24gPSB2ZXJz\naW9uOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmZpZWxkID0gX21ldGEuZ2V0\nVmVyc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHZmaWVsZCAhPSBudWxsKQog\nICAgICAgICAgICBzdG9yZSh2ZmllbGQuZ2V0SW5kZXgoKSwgSmF2YVR5cGVz\nLmNvbnZlcnQodmVyc2lvbiwKICAgICAgICAgICAgICAgIHZmaWVsZC5nZXRU\neXBlQ29kZSgpKSk7CiAgICB9CgogICAgcHVibGljIFBDU3RhdGUgZ2V0UENT\ndGF0ZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlOwogICAgfQoKICAgIHB1\nYmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IGdldEltcGxEYXRhKCkgewogICAg\nICAgIHJldHVybiBfaW1wbDsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIE9iamVjdCBzZXRJbXBsRGF0YShPYmplY3QgZGF0YSwgYm9vbGVhbiBj\nYWNoZWFibGUpIHsKICAgICAgICBPYmplY3Qgb2xkID0gX2ltcGw7CiAgICAg\nICAgX2ltcGwgPSBkYXRhOwogICAgICAgIGlmIChjYWNoZWFibGUgJiYgZGF0\nYSAhPSBudWxsKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19JTVBMX0NB\nQ0hFOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFH\nX0lNUExfQ0FDSEU7CiAgICAgICAgcmV0dXJuIG9sZDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0ltcGxEYXRhQ2FjaGVhYmxlKCkgewogICAgICAg\nIHJldHVybiAoX2ZsYWdzICYgRkxBR19JTVBMX0NBQ0hFKSAhPSAwOwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SW1wbERhdGEoaW50IGZpZWxkKSB7\nCiAgICAgICAgcmV0dXJuIGdldEV4dHJhRmllbGREYXRhKGZpZWxkLCB0cnVl\nKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHNldEltcGxEYXRhKGludCBm\naWVsZCwgT2JqZWN0IGRhdGEpIHsKICAgICAgICByZXR1cm4gc2V0RXh0cmFG\naWVsZERhdGEoZmllbGQsIGRhdGEsIHRydWUpOwogICAgfQoKICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiBpc0ltcGxEYXRhQ2FjaGVhYmxlKGlu\ndCBmaWVsZCkgewogICAgICAgIGlmIChfZmllbGRJbXBsID09IG51bGwgfHwg\nIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIGlmIChfbWV0YS5nZXRGaWVsZChmaWVsZCkudXNlc0ltcGxE\nYXRhKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxkRGF0YUluZGV4KGZp\nZWxkKTsKICAgICAgICByZXR1cm4gaWR4ICE9IC0xICYmIF9maWVsZEltcGxb\naWR4XSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SW50\nZXJtZWRpYXRlKGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBnZXRFeHRy\nYUZpZWxkRGF0YShmaWVsZCwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEludGVybWVkaWF0ZShpbnQgZmllbGQsIE9iamVjdCBkYXRhKSB7\nCiAgICAgICAgc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRhdGEsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGF0YSBmcm9t\nIHRoZSBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZpZWxkIGRhdGEgYXJy\nYXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25pemVkIE9iamVjdCBn\nZXRFeHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIGJvb2xlYW4gaXNMb2FkZWQp\nIHsKICAgICAgICAvLyBvbmx5IHJldHVybiB0aGUgZmllbGQgZGF0YSBpZiB0\naGUgZmllbGQgaXMgaW4gdGhlIHJpZ2h0IGxvYWRlZAogICAgICAgIC8vIHN0\nYXRlOyBvdGhlcndpc2Ugd2UgbWlnaHQgcmV0dXJuIGludGVybWVkaWF0ZSBm\nb3IgaW1wbCBkYXRhIG9yCiAgICAgICAgLy8gdmljZSB2ZXJzYQogICAgICAg\nIGlmIChfZmllbGRJbXBsID09IG51bGwgfHwgX2xvYWRlZC5nZXQoZmllbGQp\nICE9IGlzTG9hZGVkKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVs\nZCk7CiAgICAgICAgcmV0dXJuIChpZHggPT0gLTEpID8gbnVsbCA6IF9maWVs\nZEltcGxbaWR4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZGF0\nYSBmcm9tIHRvIHByb3BlciBpbmRleCBvZiB0aGUgZXh0cmEgZmllbGQgZGF0\nYSBhcnJheS4KICAgICAqLwogICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgT2Jq\nZWN0IHNldEV4dHJhRmllbGREYXRhKGludCBmaWVsZCwgT2JqZWN0IGRhdGEs\nCiAgICAgICAgYm9vbGVhbiBsb2FkZWQpIHsKICAgICAgICBpbnQgaWR4ID0g\nX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7CiAgICAgICAg\naWYgKGlkeCA9PSAtMSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9mKF9tZXRhLmdldEZpZWxkKGZpZWxk\nKSkpOwoKICAgICAgICBPYmplY3Qgb2xkID0gKF9maWVsZEltcGwgPT0gbnVs\nbCkgPyBudWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgICAgIGlmIChkYXRh\nICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gY2Fubm90IHNldCBpZiBmaWVs\nZCBpbiB3cm9uZyBsb2FkZWQgc3RhdGUKICAgICAgICAgICAgaWYgKF9sb2Fk\nZWQuZ2V0KGZpZWxkKSAhPSBsb2FkZWQpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2YoX21ldGEu\nZ2V0RmllbGQKICAgICAgICAgICAgICAgICAgICAoZmllbGQpKSk7CgogICAg\nICAgICAgICAvLyBzZXQgZGF0YQogICAgICAgICAgICBpZiAoX2ZpZWxkSW1w\nbCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZpZWxkSW1wbCA9IG5ldyBP\nYmplY3RbX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgoKV07CiAgICAg\nICAgICAgIF9maWVsZEltcGxbaWR4XSA9IGRhdGE7CiAgICAgICAgfSBlbHNl\nIGlmIChfZmllbGRJbXBsICE9IG51bGwgJiYgX2xvYWRlZC5nZXQoZmllbGQp\nID09IGxvYWRlZCkKICAgICAgICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gbnVs\nbDsKICAgICAgICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgZmV0Y2goaW50IGZpZWxkKSB7CiAgICAgICAgT2JqZWN0IHZhbCA9IGZl\ndGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gX21ldGEu\nZ2V0RmllbGQoZmllbGQpLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2Vy\nKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoRmllbGQoaW50IGZp\nZWxkLCBib29sZWFuIHRyYW5zaXRpb25zKSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYg\nKGZtZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tZmllbGQiLAogICAgICAgICAgICAgICAgU3Ry\naW5nLnZhbHVlT2YoZmllbGQpLCBnZXRNYW5hZ2VkSW5zdGFuY2UoKS5nZXRD\nbGFzcygpKSkuCiAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0\nTWFuYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICAvLyBkbyBub3JtYWwgc3Rh\ndGUgdHJhbnNpdGlvbnMKICAgICAgICBpZiAoIWZtZC5pc1ByaW1hcnlLZXko\nKSAmJiB0cmFuc2l0aW9ucykKICAgICAgICAgICAgYWNjZXNzaW5nRmllbGQo\nZmllbGQpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoU3RyaW5nRmllbGQoZmllbGQp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAg\nICByZXR1cm4gKGZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKSkgPyBCb29sZWFu\nLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IEJ5dGUoZmV0Y2hCeXRlRmllbGQoZmllbGQpKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgQ2hhcmFjdGVyKGZldGNoQ2hhckZpZWxkKGZpZWxkKSk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgRG91YmxlKGZldGNoRG91YmxlRmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZldGNoRmxvYXRGaWVsZChm\naWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZldGNoSW50Rmll\nbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoK\nICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZmV0Y2hM\nb25nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0KGZldGNo\nU2hvcnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZShpbnQgZmll\nbGQsIE9iamVjdCB2YWwpIHsKICAgICAgICB2YWwgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCkuZ2V0RmllbGRWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgICAg\nIHN0b3JlRmllbGQoZmllbGQsIHZhbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwpIHsKICAgICAg\nICBzdG9yZUZpZWxkKGZpZWxkLCB2YWwsIHRoaXMpOwogICAgfQoKICAgIC8q\nKgogICAgICogPHA+Q2hlY2tzIHdoZXRoZXIgb3Igbm90IDxjb2RlPl9wYzwv\nY29kZT4gaXMgZGlydHkuIEluIHRoZSBjYXNlcyB3aGVyZQogICAgICogZmll\nbGQgdHJhY2tpbmcgaXMgbm90IGhhcHBlbmluZyAoc2VlIGJlbG93KSwgdGhp\ncyBtZXRob2Qgd2lsbCBkbyBhCiAgICAgKiBzdGF0ZSBjb21wYXJpc29uIHRv\nIGZpbmQgd2hldGhlciA8Y29kZT5fcGM8L2NvZGU+IGlzIGRpcnR5LCBhbmQg\nd2lsbAogICAgICogdXBkYXRlIHRoaXMgaW5zdGFuY2Ugd2l0aCB0aGlzIGlu\nZm9ybWF0aW9uLiBJbiB0aGUgY2FzZXMgd2hlcmUgZmllbGQKICAgICAqIHRy\nYWNraW5nIGlzIGhhcHBlbmluZywgdGhpcyBtZXRob2QgaXMgYSBuby1vcC48\nL3A+CiAgICAgKgogICAgICogPHA+RmllbGRzIGFyZSB0cmFja2VkIGZvciBh\nbGwgY2xhc3NlcyB0aGF0IGFyZSBydW4gdGhyb3VnaCB0aGUgT3BlbkpQQQog\nICAgICogZW5oYW5jZXIgcHJpb3IgdG8gb3IgZHVyaW5nIGRlcGxveW1lbnQs\nIGFuZCBhbGwgY2xhc3NlcyAoZW5oYW5jZWQgb3IKICAgICAqIHVuZW5oYW5j\nZWQpIGluIGEgSmF2YSA2IGVudmlyb25tZW50IG9yIG5ld2VyLjwvcD4KICAg\nICAqCiAgICAgKiA8cD5JbiBhIEphdmEgNSBWTSBvciBvbGRlcjoKICAgICAq\nIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2VkIGNsYXNzZXMgdGhhdCB1\nc2UKICAgICAqIHByb3BlcnR5IGFjY2VzcyBhbmQgb2JleSB0aGUgcHJvcGVy\ndHkgYWNjZXNzIGxpbWl0YXRpb25zIGFyZSB0cmFja2VkCiAgICAgKiB3aGVu\nIHRoZSBpbnN0YW5jZXMgYXJlIGxvYWRlZCBmcm9tIHRoZSBkYXRhYmFzZSBi\neSBPcGVuSlBBLCBhbmQgYXJlCiAgICAgKiBub3QgdHJhY2tlZCB3aGVuIHRo\nZSBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgYnkgYXBwbGljYXRpb24gY29kZS4K\nICAgICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2VkIGNsYXNzZXMg\ndGhhdCB1c2UgZmllbGQgYWNjZXNzIGFyZQogICAgICogbmV2ZXIgdHJhY2tl\nZC48L3A+CiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGRpcnR5Q2hlY2soKSB7CiAgICAgICAgaWYgKCFuZWVk\nc0RpcnR5Q2hlY2soKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBT\nYXZlRmllbGRNYW5hZ2VyIHNhdmVkID0gZ2V0U2F2ZUZpZWxkTWFuYWdlcigp\nOwogICAgICAgIGlmIChzYXZlZCA9PSBudWxsKQogICAgICAgICAgICB0aHJv\ndyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNhdmVkLWZp\nZWxkcyIsCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YSgpLmdldERlc2Ny\naWJlZFR5cGUoKS5nZXROYW1lKCkpKTsKCiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZHMgPSBnZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAvLyBwayBhbmQgdmVyc2lvbiBmaWVsZHMgY2Fubm90IGJlIG11\ndGF0ZWQ7IGRvbid0IG1hcmsgdGhlbQogICAgICAgICAgICAvLyBhcyBzdWNo\nLiAjIyMjIyB2YWxpZGF0ZT8KICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlz\nUHJpbWFyeUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lvbigpCiAgICAgICAg\nICAgICAgICAmJiBfbG9hZGVkLmdldChpKSkgewogICAgICAgICAgICAgICAg\naWYgKCFzYXZlZC5pc0ZpZWxkRXF1YWwoaSwgZmV0Y2goaSkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgZGlydHkoaSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29s\nZWFuIG5lZWRzRGlydHlDaGVjaygpIHsKICAgICAgICBpZiAoaXNJbnRlcmNl\ncHRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChpc0RlbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIGlmIChpc05ldygpICYmICFpc0ZsdXNoZWQoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgZmV0Y2hJbml0aWFsRmllbGQoaW50IGZpZWxkKSB7\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChm\naWVsZCk7CiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkg\nPT0gUmVzdG9yZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAgICAgICAmJiAo\nKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgfHwg\nZm1kLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0gMCkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoInJlc3RvcmUtdW5zZXQiKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRB\nUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nT0JKRUNUOgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgbm90IHNhdmlu\nZyBtdXRhYmxlIHR5cGVzLCB0aHJvdyBhbiBleGNlcHRpb24KICAgICAgICAg\nICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3Rv\ncmVTdGF0ZS5SRVNUT1JFX0FMTAogICAgICAgICAgICAgICAgICAgICYmICgo\nX2ZsYWdzICYgRkxBR19JTlZFUlNFUykgPT0gMAogICAgICAgICAgICAgICAg\nICAgIHx8IGZtZC5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDAp\nKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJt\ndXRhYmxlLXJlc3RvcmUtdW5zZXQiKSk7CiAgICAgICAgfQoKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlZCA9\nPSBudWxsIHx8ICFfbG9hZGVkLmdldChmaWVsZCkgfHwgIV9kaXJ0eS5nZXQo\nZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoRmllbGQoZmll\nbGQsIGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBpcyBk\naXJ0eSBidXQgd2UgbmV2ZXIgbG9hZGVkIGl0LCB3ZSBjYW4ndCByZXN0b3Jl\nIGl0CiAgICAgICAgICAgIGlmIChfc2F2ZWQuZ2V0VW5sb2FkZWQoKS5nZXQo\nZmllbGQpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgiaW5pdGlhbC11bmxvYWRlZCIsCiAgICAg\nICAgICAgICAgICAgICAgZm1kKSk7CgogICAgICAgICAgICBwcm92aWRlRmll\nbGQoX3NhdmVkLmdldFN0YXRlKCksIF9zaW5nbGUsIGZpZWxkKTsKICAgICAg\nICAgICAgcmV0dXJuIGZldGNoRmllbGQoX3NpbmdsZSwgZm1kKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaCB0aGUgc3BlY2lmaWVkIGZp\nZWxkIGZyb20gdGhlIHNwZWNpZmllZCBmaWVsZCBtYW5hZ2VyLCB3cmFwcGlu\nZyBpdAogICAgICogaW4gYW4gb2JqZWN0IGlmIGl0J3MgYSBwcmltaXRpdmUu\nIEEgZmllbGQgc2hvdWxkIGJlIHByb3ZpZGVkIHRvIHRoZQogICAgICogZmll\nbGQgbWFuYWdlciBiZWZvcmUgdGhpcyBjYWxsIGlzIG1hZGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBmZXRjaEZpZWxkKEZpZWxkTWFu\nYWdlciBmbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpbnQgZmll\nbGQgPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIHJldHVybiAoZm0uZmV0Y2hC\nb29sZWFuRmllbGQoZmllbGQpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAg\nICAgICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0\nZShmbS5mZXRjaEJ5dGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBD\naGFyYWN0ZXIoZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBEb3VibGUoZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVsZCkpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgRmxvYXQoZm0uZmV0Y2hGbG9hdEZpZWxkKGZpZWxk\nKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0Y2hJbnRGaWVs\nZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgog\nICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmbS5mZXRj\naExvbmdGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2hvcnQoZm0u\nZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBmbS5mZXRj\naFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHJldHVybiBmbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxk\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVtb3Rl\nKGludCBmaWVsZCwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5\nKGZpZWxkLCBCb29sZWFuLkZBTFNFLCBmYWxzZSk7CiAgICAgICAgICAgIHN0\nb3JlRmllbGQoZmllbGQsIHZhbHVlLCBfc2luZ2xlKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTGlmZWN5Y2xlIG9wZXJhdGlvbnMK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICog\nTm90aWZpY2F0aW9uIHRoYXQgdGhlIG9iamVjdCBpcyBhYm91dCB0byBiZSBh\nY2Nlc3NlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZpZWxk\nIG51bWJlciBiZWluZyByZWFkLCBvciAtMSBpZiBub3QgYSBzaW5nbGUKICAg\nICAqIGZpZWxkIHJlYWQKICAgICAqLwogICAgdm9pZCBiZWZvcmVSZWFkKGlu\ndCBmaWVsZCkgewogICAgICAgIC8vIGFsbG93IHVubWVkaWF0ZWQgcmVhZHMg\nb2YgcHJpbWFyeSBrZXkgZmllbGRzCiAgICAgICAgaWYgKGZpZWxkICE9IC0x\nICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2Jyb2tlci5pc0FjdGl2\nZSgpICYmICFfYnJva2VyLmlzVHJhbnNhY3Rpb25FbmRpbmcoKSkgewogICAg\nICAgICAgICBpZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAg\nICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVPcHRpbWlzdGljUmVh\nZCh0aGlzLCBmaWVsZCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVSZWFkKHRoaXMsIGZpZWxk\nKSk7CiAgICAgICAgfSBlbHNlIGlmIChfYnJva2VyLmdldE5vbnRyYW5zYWN0\naW9uYWxSZWFkKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJl\nZm9yZU5vbnRyYW5zYWN0aW9uYWxSZWFkKHRoaXMsIGZpZWxkKSk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKS4KICAgICAgICAg\nICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJl\nbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2JlZm9yZUZs\ndXNoCiAgICAgKi8KICAgIHZvaWQgYmVmb3JlRmx1c2goaW50IHJlYXNvbiwg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIF9zdGF0ZS5iZWZvcmVGbHVz\naCh0aGlzLCByZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMLCBj\nYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUg\nY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZmx1\nc2gKICAgICAqLwogICAgdm9pZCBhZnRlckZsdXNoKGludCByZWFzb24pIHsK\nICAgICAgICAvLyBub3RoaW5nIGhhcHBlbnMgd2hlbiB3ZSBmbHVzaCBub24t\ncGVyc2lzdGVudCBzdGF0ZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVudCgp\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChyZWFzb24gIT0g\nQnJva2VySW1wbC5GTFVTSF9ST0xMQkFDSwogICAgICAgICAgICAmJiByZWFz\nb24gIT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMKSB7CiAgICAgICAgICAg\nIC8vIGFuYWx5emUgcHJldmlvdXMgc3RhdGUgZm9yIGxhdGVyCiAgICAgICAg\nICAgIGJvb2xlYW4gd2FzTmV3ID0gaXNOZXcoKTsKICAgICAgICAgICAgYm9v\nbGVhbiB3YXNGbHVzaGVkID0gaXNGbHVzaGVkKCk7CiAgICAgICAgICAgIGJv\nb2xlYW4gd2FzRGVsZXRlZCA9IGlzRGVsZXRlZCgpOwogICAgICAgICAgICBi\nb29sZWFuIG5lZWRQb3N0VXBkYXRlID0gISh3YXNOZXcgJiYgIXdhc0ZsdXNo\nZWQpCiAgICAgICAgICAgICAgICAgICAgJiYgKEltcGxIZWxwZXIuZ2V0VXBk\nYXRlRmllbGRzKHRoaXMpICE9IG51bGwpOwoKICAgICAgICAgICAgLy8gYWxs\nIGRpcnR5IGZpZWxkcyB3ZXJlIGZsdXNoZWQKICAgICAgICAgICAgX2ZsdXNo\nLm9yKF9kaXJ0eSk7CgogICAgICAgICAgICAvLyBpbXBvcnRhbnQgdG8gc2V0\nIGZsdXNoZWQgYml0IGFmdGVyIGNhbGxpbmcgX3N0YXRlLmZsdXNoIHNvCiAg\nICAgICAgICAgIC8vIHRoYXQgdGhlIHN0YXRlIGNhbiB0ZWxsIHdoZXRoZXIg\ndGhpcyBpcyB0aGUgZmlyc3QgZmx1c2gKICAgICAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUuZmx1c2godGhpcykpOwogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxV\nU0hFRF9ESVJUWTsKCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19WRVJT\nSU9OX0NIRUNLOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lP\nTl9VUERBVEU7CgogICAgICAgICAgICAvLyBpZiB0aGlzIHdhcyBhbiBpbmMg\nZmx1c2ggZHVyaW5nIHdoaWNoIHdlIGhhZCBvdXIgaWRlbnRpdHkKICAgICAg\nICAgICAgLy8gYXNzaWduZWQsIHRlbGwgdGhlIGJyb2tlciB0byBjYWNoZSB1\ncyB1bmRlciBvdXIgZmluYWwgb2lkCiAgICAgICAgICAgIGlmIChyZWFzb24g\nPT0gQnJva2VySW1wbC5GTFVTSF9JTkMpCiAgICAgICAgICAgICAgICBhc3Nl\ncnRPYmplY3RJZEFzc2lnbmVkKHRydWUpOwoKICAgICAgICAgICAgLy8gaWYg\ndGhpcyBvYmplY3Qgd2FzIHN0b3JlZCB3aXRoIHByZUZsdXNoLCBkbyBwb3N0\nLXN0b3JlIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19QUkVfRkxVU0hFRCkgPiAwKQogICAgICAgICAgICAgICAgZmlyZUxpZmVj\neWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1NUT1JFKTsKCiAgICAg\nICAgICAgIC8vIGRvIHBvc3QtdXBkYXRlIGFzIG5lZWRlZAogICAgICAgICAg\nICBpZiAod2FzTmV3ICYmICF3YXNGbHVzaGVkKQogICAgICAgICAgICAgICAg\nZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1BFUlNJ\nU1RfUEVSRk9STUVEKTsKICAgICAgICAgICAgZWxzZSBpZiAod2FzRGVsZXRl\nZCkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3lj\nbGVFdmVudC5BRlRFUl9ERUxFVEVfUEVSRk9STUVEKTsKICAgICAgICAgICAg\nZWxzZSBpZiAobmVlZFBvc3RVcGRhdGUpCiAgICAgICAgICAgICAgICAvLyB1\ncGRhdGVzIGFuZCBuZXctZmx1c2hlZCB3aXRoIGNoYW5nZXMKICAgICAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRF\nUl9VUERBVEVfUEVSRk9STUVEKTsKICAgICAgICB9IGVsc2UgaWYgKHJlYXNv\nbiA9PSBCcm9rZXJJbXBsLkZMVVNIX1JPTExCQUNLKSB7CiAgICAgICAgICAg\nIC8vIHJldmVydCB0byBsYXN0IGxvYWRlZCB2ZXJzaW9uIGFuZCBvcmlnaW5h\nbCBvaWQKICAgICAgICAgICAgYXNzaWduVmVyc2lvbkZpZWxkKF9sb2FkVmVy\nc2lvbik7CiAgICAgICAgICAgIGlmIChpc05ldygpICYmIChfZmxhZ3MgJiBG\nTEFHX09JRF9BU1NJR05FRCkgPT0gMCkKICAgICAgICAgICAgICAgIF9vaWQg\nPSBudWxsOwogICAgICAgIH0KICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUFJF\nX0ZMVVNIRUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8g\ndGhlIGN1cnJlbnQgc3RhdGUgYWZ0ZXIgY2hlY2tpbmcgdGhlIHZhbHVlCiAg\nICAgKiBvZiB0aGUgUmV0YWluU3RhdGUgZmxhZy4KICAgICAqCiAgICAgKiBA\nc2VlIFBDU3RhdGUjY29tbWl0CiAgICAgKiBAc2VlIFBDU3RhdGUjY29tbWl0\nUmV0YWluCiAgICAgKi8KICAgIHZvaWQgY29tbWl0KCkgewogICAgICAgIC8v\nIHJlbGVhc2UgbG9ja3MgYmVmb3JlIG9pZCB1cGRhdGVkCiAgICAgICAgcmVs\nZWFzZUxvY2tzKCk7CgogICAgICAgIC8vIHVwZGF0ZSB2ZXJzaW9uIGFuZCBv\naWQgaW5mb3JtYXRpb24KICAgICAgICBzZXRWZXJzaW9uKF92ZXJzaW9uKTsK\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgT2JqZWN0IG9y\naWcgPSBfaWQ7CiAgICAgICAgYXNzZXJ0T2JqZWN0SWRBc3NpZ25lZChmYWxz\nZSk7CgogICAgICAgIGJvb2xlYW4gd2FzTmV3ID0gaXNOZXcoKSAmJiAhaXNE\nZWxldGVkKCkgJiYgIWlzUHJvdmlzaW9uYWwoKTsKICAgICAgICBpZiAoX2Jy\nb2tlci5nZXRSZXRhaW5TdGF0ZSgpKQogICAgICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5jb21taXRSZXRhaW4odGhpcykpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuY29tbWl0KHRoaXMpKTsKCiAg\nICAgICAgLy8gYXNrIHRoZSBicm9rZXIgdG8gcmUtY2FjaGUgdXMgaWYgd2Ug\nd2VyZSBuZXcgcHJldmlvdXNseQogICAgICAgIGlmICh3YXNOZXcpCiAgICAg\nICAgICAgIF9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKG9yaWcsIHRoaXMsIEJy\nb2tlckltcGwuU1RBVFVTX0NPTU1JVF9ORVcpOwogICAgfQoKICAgIC8qKgog\nICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlIGFmdGVyIGNo\nZWNraW5nIHRoZSB2YWx1ZQogICAgICogb2YgdGhlIFJldGFpblN0YXRlIGZs\nYWcuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3JvbGxiYWNrCiAgICAg\nKiBAc2VlIFBDU3RhdGUjcm9sbGJhY2tSZXN0b3JlCiAgICAgKi8KICAgIHZv\naWQgcm9sbGJhY2soKSB7CiAgICAgICAgLy8gcmVsZWFzZSBsb2NrcwogICAg\nICAgIHJlbGVhc2VMb2NrcygpOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19G\nTFVTSEVEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEX0RJUlRZ\nOwogICAgICAgIGFmdGVyRmx1c2goQnJva2VySW1wbC5GTFVTSF9ST0xMQkFD\nSyk7CgogICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9\nIFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUpCiAgICAgICAgICAgIHNldFBD\nU3RhdGUoX3N0YXRlLnJvbGxiYWNrUmVzdG9yZSh0aGlzKSk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5yb2xsYmFjayh0\naGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSb2xsYmFjayBzdGF0ZSBv\nZiB0aGUgbWFuYWdlZCBpbnN0YW5jZSB0byB0aGUgZ2l2ZW4gc2F2ZXBvaW50\nLgogICAgICovCiAgICB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoU2F2ZXBv\naW50RmllbGRNYW5hZ2VyIHNhdmVwb2ludCkgewogICAgICAgIF9zdGF0ZSA9\nIHNhdmVwb2ludC5nZXRQQ1N0YXRlKCk7CiAgICAgICAgQml0U2V0IGxvYWRl\nZCA9IHNhdmVwb2ludC5nZXRMb2FkZWQoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMCwgbGVuID0gbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGxvYWRlZC5nZXQoaSkgJiYgc2F2ZXBvaW50LnJl\nc3RvcmVGaWVsZChpKSkgewogICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxk\nKHNhdmVwb2ludC5nZXRDb3B5KCksIHNhdmVwb2ludCwgaSk7CiAgICAgICAg\nICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBzYXZlcG9pbnQsIGkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9sb2FkZWQgPSBsb2FkZWQ7\nCiAgICAgICAgX2RpcnR5ID0gc2F2ZXBvaW50LmdldERpcnR5KCk7CiAgICAg\nICAgX2ZsdXNoID0gc2F2ZXBvaW50LmdldEZsdXNoZWQoKTsKICAgICAgICBf\ndmVyc2lvbiA9IHNhdmVwb2ludC5nZXRWZXJzaW9uKCk7CiAgICAgICAgX2xv\nYWRWZXJzaW9uID0gc2F2ZXBvaW50LmdldExvYWRWZXJzaW9uKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3Rh\ndGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3BlcnNpc3QKICAgICAq\nIEBzZWUgQnJva2VyI3BlcnNpc3QKICAgICAqLwogICAgdm9pZCBwZXJzaXN0\nKCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnBlcnNpc3QodGhpcykp\nOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJy\nZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNkZWxldGUK\nICAgICAqIEBzZWUgQnJva2VyI2RlbGV0ZQogICAgICovCiAgICB2b2lkIGRl\nbGV0ZSgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5kZWxldGUodGhp\ncykpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBj\ndXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNub250\ncmFuc2FjdGlvbmFsCiAgICAgKiBAc2VlIEJyb2tlciNub250cmFuc2FjdGlv\nbmFsCiAgICAgKi8KICAgIHZvaWQgbm9udHJhbnNhY3Rpb25hbCgpIHsKICAg\nICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5ub250cmFuc2FjdGlvbmFsKHRoaXMp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3Vy\ncmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjdHJhbnNh\nY3Rpb25hbAogICAgICogQHNlZSBCcm9rZXIjdHJhbnNhY3Rpb25hbAogICAg\nICovCiAgICB2b2lkIHRyYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgc2V0UENT\ndGF0ZShfc3RhdGUudHJhbnNhY3Rpb25hbCh0aGlzKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAg\nICAgKgogICAgICogQHNlZSBQQ1N0YXRlI25vbnByb3Zpc2lvbmFsCiAgICAg\nKi8KICAgIHZvaWQgbm9ucHJvdmlzaW9uYWwoYm9vbGVhbiBsb2dpY2FsLCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUu\nbm9ucHJvdmlzaW9uYWwodGhpcywgbG9naWNhbCwgY2FsbCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRl\nLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNyZWxlYXNlCiAgICAgKiBA\nc2VlIEJyb2tlciNyZWxlYXNlCiAgICAgKi8KICAgIHZvaWQgcmVsZWFzZShi\nb29sZWFuIHVucHJveHkpIHsKICAgICAgICByZWxlYXNlKHVucHJveHksIGZh\nbHNlKTsKICAgIH0KCiAgICB2b2lkIHJlbGVhc2UoYm9vbGVhbiB1bnByb3h5\nLCBib29sZWFuIGZvcmNlKSB7CiAgICAgICAgLy8gb3B0aW1pemF0aW9uIGZv\nciBkZXRhY2gtaW4tcGxhY2Ugc3BlY2lhbCBjYXNlIHdoZW4gZmllbGRzIGFy\nZQogICAgICAgIC8vIGFscmVhZHkgKHVuKXByb3hpZWQgY29ycmVjdGx5CiAg\nICAgICAgaWYgKCF1bnByb3h5KQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19OT19VTlBST1hZOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChm\nb3JjZSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoUENTdGF0ZS5UUkFO\nU0lFTlQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXRQ\nQ1N0YXRlKF9zdGF0ZS5yZWxlYXNlKHRoaXMpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfTk9fVU5QUk9YWTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8g\ndGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRl\nI2V2aWN0CiAgICAgKiBAc2VlIEJyb2tlciNldmljdAogICAgICovCiAgICB2\nb2lkIGV2aWN0KCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmV2aWN0\nKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlciByZWxhdGlv\nbnMgcmVhY2hhYmxlIGZyb20gdmFsdWVzIHVzaW5nCiAgICAgKiB7QGxpbmsg\nVmFsdWVNZXRhRGF0YSNDQVNDQURFX0lNTUVESUFURX0uCiAgICAgKi8KICAg\nIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChmbWRz\nW2ldLmdldENhc2NhZGVSZWZyZXNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVND\nQURFX0lNTUVESUFURQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRL\nZXkoKS5nZXRDYXNjYWRlUmVmcmVzaCgpCiAgICAgICAgICAgICAgICA9PSBW\nYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAgICAg\nICB8fCBmbWRzW2ldLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRlUmVmcmVzaCgp\nCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1N\nRURJQVRFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0\nRmllbGQoaSwgZmV0Y2hGaWVsZChpLCBmYWxzZSkpOwogICAgICAgICAgICAg\nICAgX3NpbmdsZS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsKICAgICAg\nICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBiZWZvcmVSZWZyZXNo\nKGJvb2xlYW4gcmVmcmVzaEFsbCkgewogICAgICAgIC8vIG5vdGU6IGFsbCBs\nb2dpYyBwbGFjZWQgaGVyZSByYXRoZXIgdGhhbiBpbiB0aGUgc3RhdGVzIGZv\ncgogICAgICAgIC8vIG9wdGltaXphdGlvbjsgdGhpcyBtZXRob2QgcHVibGlj\nIGIvYyB1c2VkIGJ5IHJlbW90ZSBwYWNrYWdlCgogICAgICAgIC8vIG5vdGhp\nbmcgdG8gZG8gZm9yIG5vbiBwZXJzaXN0ZW50IG9yIG5ldyB1bmZsdXNoZWQg\naW5zdGFuY2VzCiAgICAgICAgaWYgKCFpc1BlcnNpc3RlbnQoKSB8fCAoaXNO\nZXcoKSAmJiAhaXNGbHVzaGVkKCkpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICAvLyBpZiBkaXJ0eSBuZWVkIHRvIGNsZWFyIGZpZWxkcwogICAgICAgICAg\nICBpZiAoaXNEaXJ0eSgpKSB7CiAgICAgICAgICAgICAgICBjbGVhckZpZWxk\ncygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGlmIHNvbWUgZmllbGRzIGhhdmUgYmVlbiBs\nb2FkZWQgYnV0IHRoZSBpbnN0YW5jZSBpcyBvdXQgb2YKICAgICAgICAgICAg\nLy8gZGF0ZSBvciB0aGlzIGlzIHBhcnQgb2YgYSByZWZyZXNoQWxsKCkgYW5k\nIHdlIGRvbid0IHdhbnQgdG8KICAgICAgICAgICAgLy8gdGFrZSB0aGUgZXh0\ncmEgaGl0IHRvIHNlZSBpZiB0aGUgaW5zdGFuY2UgaXMgb3V0IG9mIGRhdGUs\nIGNsZWFyCiAgICAgICAgICAgIGlmIChfbG9hZGVkLmxlbmd0aCgpID4gMCAm\nJiAocmVmcmVzaEFsbCB8fCBpc0VtYmVkZGVkKCkKICAgICAgICAgICAgICAg\nIHx8ICFzeW5jVmVyc2lvbihudWxsKSkpIHsKICAgICAgICAgICAgICAgIE9i\namVjdCB2ZXJzaW9uID0gX3ZlcnNpb247CiAgICAgICAgICAgICAgICBjbGVh\nckZpZWxkcygpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHN5bmNWZXJzaW9u\nIGp1c3QgcmVwbGFjZWQgdGhlIHZlcnNpb24sIHJlc2V0IGl0CiAgICAgICAg\nICAgICAgICBpZiAoIXJlZnJlc2hBbGwgJiYgIWlzRW1iZWRkZWQoKSkKICAg\nICAgICAgICAgICAgICAgICBzZXRWZXJzaW9uKHZlcnNpb24pOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFBlcmZvcm0gc3RhdGUgdHJhbnNpdGlvbnMgYWZ0ZXIgcmVmcmVzaC4gVGhp\ncyBtZXRob2QgaXMgb25seQogICAgICogY2FsbGVkIGlmIHtAbGluayAjYmVm\nb3JlUmVmcmVzaH0gcmV0dXJucyB0cnVlLgogICAgICovCiAgICB2b2lkIGFm\ndGVyUmVmcmVzaCgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gdHJhbnNpdGlvbiB0byBjbGVhbiBvciBub250cmFu\nc2FjdGlvbmFsIGRlcGVuZGluZyBvbiB0cmFucyBzdGF0dXMKICAgICAgICAg\nICAgaWYgKCFfYnJva2VyLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5hZnRlck5vbnRyYW5zYWN0aW9uYWxSZWZyZXNo\nKCkpOwogICAgICAgICAgICBlbHNlIGlmIChfYnJva2VyLmdldE9wdGltaXN0\naWMoKSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmFmdGVy\nT3B0aW1pc3RpY1JlZnJlc2goKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmFmdGVyUmVmcmVzaCgpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoaXMgb2JqZWN0\nIGFzIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmplY3QuCiAgICAgKi8K\nICAgIHZvaWQgc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50KGJvb2xlYW4gZGVy\nZWYsIGJvb2xlYW4gbm90aWZ5KSB7CiAgICAgICAgaWYgKCFkZXJlZiAmJiAo\nX2ZsYWdzICYgRkxBR19ERVJFRikgPiAwKSB7CiAgICAgICAgICAgIGlmIChu\nb3RpZnkpCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZURlcmVmZXJl\nbmNlZERlcGVuZGVudCh0aGlzKTsKICAgICAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX0RFUkVGOwogICAgICAgIH0gZWxzZSBpZiAoZGVyZWYgJiYgKF9mbGFn\ncyAmIEZMQUdfREVSRUYpID09IDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfREVSRUY7CiAgICAgICAgICAgIGlmIChub3RpZnkpCiAgICAgICAg\nICAgICAgICBfYnJva2VyLmFkZERlcmVmZXJlbmNlZERlcGVuZGVudCh0aGlz\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHZvaWQgc2V0RGVyZWZlcmVu\nY2VkRW1iZWREZXBlbmRlbnQoYm9vbGVhbiBkZXJlZikgewogICAgICAgIGlm\nICghZGVyZWYgJiYgKF9mbGFncyAmIEZMQUdfRU1CRURfREVSRUYpID4gMCkg\newogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRU1CRURfREVSRUY7CiAg\nICAgICAgfSBlbHNlIGlmIChkZXJlZiAmJiAoX2ZsYWdzICYgRkxBR19FTUJF\nRF9ERVJFRikgPT0gMCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19F\nTUJFRF9ERVJFRjsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBi\nb29sZWFuIGdldERlcmVmZXJlbmNlZEVtYmVkRGVwZW5kZW50KCkgewogICAg\nICAgIHJldHVybiAoKF9mbGFncyAmIEZMQUdfRU1CRURfREVSRUYpID09IDAg\nPyBmYWxzZSA6IHRydWUpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAgICAv\nLyBMb2NraW5nCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogTm90\naWZpY2F0aW9uIHRoYXQgd2UndmUgYmVlbiByZWFkLWxvY2tlZC4gUGFzcyBp\nbiB0aGUgbGV2ZWwgYXQgd2hpY2gKICAgICAqIHdlIHdlcmUgbG9ja2VkIGFu\nZCB0aGUgbGV2ZWwgYXQgd2hpY2ggd2Ugc2hvdWxkIHdyaXRlIGxvY2sgb3Vy\nc2VsdmVzCiAgICAgKiBvbiBkaXJ0eS4KICAgICAqLwogICAgdm9pZCByZWFk\nTG9ja2VkKGludCByZWFkTG9ja0xldmVsLCBpbnQgd3JpdGVMb2NrTGV2ZWwp\nIHsKICAgICAgICAvLyBtYWtlIHN1cmUgb2JqZWN0IGlzIGFkZGVkIHRvIHRy\nYW5zYWN0aW9uIHNvIGxvY2sgd2lsbCBnZXQKICAgICAgICAvLyBjbGVhcmVk\nIG9uIGNvbW1pdC9yb2xsYmFjawogICAgICAgIGlmIChyZWFkTG9ja0xldmVs\nICE9IExvY2tMZXZlbHMuTE9DS19OT05FKQogICAgICAgICAgICB0cmFuc2Fj\ndGlvbmFsKCk7CgogICAgICAgIF9yZWFkTG9ja0xldmVsID0gcmVhZExvY2tM\nZXZlbDsKICAgICAgICBfd3JpdGVMb2NrTGV2ZWwgPSB3cml0ZUxvY2tMZXZl\nbDsKICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRUFEX0xPQ0tFRDsKICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfV1JJVEVfTE9DS0VEOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBsb2NrIGxldmVsIHRvIHVzZSB3aGVuIGxv\nYWRpbmcgc3RhdGUuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGNhbGN1bGF0\nZUxvY2tMZXZlbChib29sZWFuIGFjdGl2ZSwgYm9vbGVhbiBmb3JXcml0ZSwK\nICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBp\nZiAoIWFjdGl2ZSkKICAgICAgICAgICAgcmV0dXJuIExvY2tMZXZlbHMuTE9D\nS19OT05FOwogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAg\nICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7Cgog\nICAgICAgIGlmIChfcmVhZExvY2tMZXZlbCA9PSAtMSkKICAgICAgICAgICAg\nX3JlYWRMb2NrTGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCk7CiAg\nICAgICAgaWYgKF93cml0ZUxvY2tMZXZlbCA9PSAtMSkKICAgICAgICAgICAg\nX3dyaXRlTG9ja0xldmVsID0gZmV0Y2guZ2V0V3JpdGVMb2NrTGV2ZWwoKTsK\nICAgICAgICByZXR1cm4gKGZvcldyaXRlKSA/IF93cml0ZUxvY2tMZXZlbCA6\nIF9yZWFkTG9ja0xldmVsOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBz\ndXJlIHdlJ3JlIGxvY2tlZCBhdCB0aGUgZ2l2ZW4gbGV2ZWwuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBvYnRhaW5Mb2Nrcyhib29sZWFuIGFjdGl2ZSwg\nYm9vbGVhbiBmb3JXcml0ZSwgaW50IGxvY2tMZXZlbCwKICAgICAgICBGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBzZGF0YSkgewogICAgICAg\nIGlmICghYWN0aXZlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8v\nIGlmIHdlIGhhdmVuJ3QgYmVlbiBsb2NrZWQgeWV0LCBsb2NrIG5vdyBhdCB0\naGUgZ2l2ZW4gbGV2ZWwKICAgICAgICBpbnQgZmxhZyA9IChmb3JXcml0ZSkg\nPyBGTEFHX1dSSVRFX0xPQ0tFRCA6IEZMQUdfUkVBRF9MT0NLRUQ7CiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBmbGFnKSA9PSAwKSB7CiAgICAgICAgICAgIC8v\nIG1ha2Ugc3VyZSBvYmplY3QgaXMgYWRkZWQgdG8gdHJhbnNhY3Rpb24gc28g\nbG9jayB3aWxsIGdldAogICAgICAgICAgICAvLyBjbGVhcmVkIG9uIGNvbW1p\ndC9yb2xsYmFjawogICAgICAgICAgICBpZiAobG9ja0xldmVsICE9IExvY2tM\nZXZlbHMuTE9DS19OT05FKQogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25h\nbCgpOwoKICAgICAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAg\nICAgICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9u\nKCk7CiAgICAgICAgICAgIF9icm9rZXIuZ2V0TG9ja01hbmFnZXIoKS5sb2Nr\nKHRoaXMsIGxvY2tMZXZlbCwKICAgICAgICAgICAgICAgIGZldGNoLmdldExv\nY2tUaW1lb3V0KCksIHNkYXRhKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgICAgIF9mbGFncyB8PSBmbGFnOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgbG9ja3Mu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWxlYXNlTG9ja3MoKSB7CiAg\nICAgICAgaWYgKF9sb2NrICE9IG51bGwpCiAgICAgICAgICAgIF9icm9rZXIu\nZ2V0TG9ja01hbmFnZXIoKS5yZWxlYXNlKHRoaXMpOwogICAgICAgIF9yZWFk\nTG9ja0xldmVsID0gLTE7CiAgICAgICAgX3dyaXRlTG9ja0xldmVsID0gLTE7\nCiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JFQURfTE9DS0VEOwogICAgICAg\nIF9mbGFncyAmPSB+RkxBR19XUklURV9MT0NLRUQ7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIEltcGxlbWVudGF0aW9uIG9mIFN0YXRlTWFuYWdlciBpbnRlcmZhY2UK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHdoZXRoZXIgb3Igbm90IHVu\nbG9hZGVkIGZpZWxkcyBzaG91bGQgYmUgY2xvc2VkLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBzZXJpYWxpemluZygpIHsKICAgICAgICAvLyBpZiB0\naGUgYnJva2VyIGlzIGluIHRoZSBtaWRzdCBvZiBhIHNlcmlhbGl6YXRpb24s\nIHRoZW4gbm8gc3BlY2lhbAogICAgICAgIC8vIGhhbmRsaW5nIHNob3VsZCBi\nZSBwZXJmb3JtZWQgb24gdGhlIGluc3RhbmNlLCBhbmQgbm8gc3Vic2VxdWVu\ndAogICAgICAgIC8vIGxvYWQgc2hvdWxkIGhhcHBlbgogICAgICAgIGlmIChf\nYnJva2VyLmlzU2VyaWFsaXppbmcoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX21ldGEuaXNE\nZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRGV0YWNoTWFu\nYWdlci5wcmVTZXJpYWxpemUodGhpcyk7CgogICAgICAgICAgICBsb2FkKF9i\ncm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCksIExPQURfU0VSSUFMSVpF\nLCBudWxsLCBudWxsLCAKICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJl\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gd3JpdGVE\nZXRhY2hlZChPYmplY3RPdXRwdXQgb3V0KQogICAgICAgIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgQml0U2V0IGlkeHMgPSBuZXcgQml0U2V0KF9t\nZXRhLmdldEZpZWxkcygpLmxlbmd0aCk7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gZGV0c20gPSBEZXRhY2hN\nYW5hZ2VyLndyaXRlRGV0YWNoZWRTdGF0ZSh0aGlzLCBvdXQsIGlkeHMpOwog\nICAgICAgICAgICBpZiAoZGV0c20pCiAgICAgICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19ERVRBQ0hJTkc7CgogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChmbWRzW2ldLmlzVHJhbnNpZW50KCkpCiAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBwcm92aWRlRmll\nbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUu\nc2VyaWFsaXplKG91dCwgIWlkeHMuZ2V0KGkpKTsKICAgICAgICAgICAgICAg\nIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0RF\nVEFDSElORzsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHByb3h5RGV0YWNoZWREZXNlcmlhbGl6ZWQo\naW50IGlkeCkgewogICAgICAgIC8vIHdlIGRvbid0IHNlcmlhbGl6ZSBzdGF0\nZSBtYW5hZ2VyIGltcGxzCiAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFuc2Fj\ndGlvbmFsKCkgewogICAgICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgVENMRUFO\nLCB3aGljaCB3ZSB3YW50IHRvIGFwcGVhciBub24tdHJhbnMgdG8KICAgICAg\nICAvLyBpbnRlcm5hbCBjb2RlLCBidXQgd2hpY2ggcHVibGljbHkgc2hvdWxk\nIGJlIHRyYW5zYWN0aW9uYWwKICAgICAgICByZXR1cm4gX3N0YXRlID09IFBD\nU3RhdGUuVENMRUFOIHx8IF9zdGF0ZS5pc1RyYW5zYWN0aW9uYWwoKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlbmRpbmdUcmFuc2FjdGlvbmFs\nKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNQZW5kaW5nVHJhbnNhY3Rp\nb25hbCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUHJvdmlzaW9u\nYWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1Byb3Zpc2lvbmFsKCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQZXJzaXN0ZW50KCkgewog\nICAgICAgIHJldHVybiBfc3RhdGUuaXNQZXJzaXN0ZW50KCk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNOZXcoKSB7CiAgICAgICAgcmV0dXJuIF9z\ndGF0ZS5pc05ldygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGVs\nZXRlZCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzRGVsZXRlZCgpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAg\ncmV0dXJuIF9zdGF0ZS5pc0RpcnR5KCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNEZXRhY2hlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAm\nIEZMQUdfREVUQUNISU5HKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0R2VuZXJpY0NvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9icm9r\nZXI7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaE9iamVjdElkKCkg\newogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChoYXNHZW5lcmF0ZWRL\nZXkoKSAmJiBfc3RhdGUgaW5zdGFuY2VvZiBQTmV3U3RhdGUgJiYgCiAgICAg\nICAgICAgICAgICBfb2lkID09IG51bGwpIAogICAgICAgICAgICAgICAgcmV0\ndXJuIF9vaWQ7CiAgICAgICAgICAgIGFzc2lnbk9iamVjdElkKHRydWUpOwog\nICAgICAgICAgICBpZiAoX29pZCA9PSBudWxsIHx8ICFfYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgIGdldENvbXBhdGliaWxp\ndHlJbnN0YW5jZSgpLmdldENvcHlPYmplY3RJZHMoKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBfb2lkOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElk\nZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKQog\nICAgICAgICAgICAgICAgcmV0dXJuIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2Vy\nKCkuY29weURhdGFTdG9yZUlkKF9vaWQsIF9tZXRhKTsKICAgICAgICAgICAg\ncmV0dXJuIEFwcGxpY2F0aW9uSWRzLmNvcHkoX29pZCwgX21ldGEpOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgYm9vbGVhbiBoYXNHZW5lcmF0ZWRLZXkoKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIHBrRmllbGRzID0gX21ldGEuZ2V0UHJpbWFy\neUtleUZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtG\naWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBrRmllbGRz\nW2ldLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuQVVU\nT0FTU0lHTikKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBnZXRQQ1ByaW1hcnlLZXkoT2JqZWN0IG9pZCwgaW50IGZpZWxkKSB7\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChm\naWVsZCk7CiAgICAgICAgT2JqZWN0IHBrID0gQXBwbGljYXRpb25JZHMuZ2V0\nKG9pZCwgZm1kKTsKICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgcmVsbWV0\nYSA9IGZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIHBr\nID0gQXBwbGljYXRpb25JZHMud3JhcChyZWxtZXRhLCBwayk7CiAgICAgICAg\naWYgKHJlbG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5JRF9EQVRBU1RPUkUKICAgICAgICAgICAgJiYgZm1kLmdldE9iamVjdElk\nRmllbGRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5MT05HKQogICAgICAgICAg\nICBwayA9IF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkubmV3RGF0YVN0b3Jl\nSWQocGssIHJlbG1ldGEpOwogICAgICAgIGVsc2UgaWYgKHJlbG1ldGEuZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElP\nTiAKICAgICAgICAgICAgJiYgZm1kLmdldE9iamVjdElkRmllbGRUeXBlKCkg\nIT0gcmVsbWV0YS5nZXRPYmplY3RJZFR5cGUoKSkKICAgICAgICAgICAgcGsg\nPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXMobmV3IE9iamVjdFtdIHsg\ncGsgfSwgcmVsbWV0YSk7CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZmluZChw\naywgZmFsc2UsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBieXRlIHJlcGxh\nY2VGbGFncygpIHsKICAgICAgICAvLyB3ZSBhbHdheXMgdXNlIGxvYWQgcmVx\ndWlyZWQgc28gdGhhdCB3ZSBjYW4gZGV0ZWN0IHdoZW4gb2JqZWN0cwogICAg\nICAgIC8vIGFyZSB0b3VjaGVkIGZvciBsb2NraW5nIG9yIG1ha2luZyB0cmFu\nc2FjdGlvbmFsCiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlQ2FwYWJsZS5M\nT0FEX1JFUVVJUkVEOwogICAgfQoKICAgIHB1YmxpYyBTdGF0ZU1hbmFnZXIg\ncmVwbGFjZVN0YXRlTWFuYWdlcihTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAg\nICByZXR1cm4gc207CiAgICB9CgogICAgcHVibGljIHZvaWQgYWNjZXNzaW5n\nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgLy8gcG9zc2libHkgY2hhbmdl\nIHN0YXRlCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmVmb3JlUmVhZChm\naWVsZCk7CiAgICAgICAgICAgIGJlZm9yZUFjY2Vzc0ZpZWxkKGZpZWxkKTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gZmllbGQgYmVmb3JlIGFj\nY2Vzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYmVmb3JlQWNjZXNz\nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGJvb2xlYW4gYWN0aXZlID0gX2Jyb2tlci5pc0Fj\ndGl2ZSgpOwogICAgICAgICAgICBpbnQgbG9ja0xldmVsID0gY2FsY3VsYXRl\nTG9ja0xldmVsKGFjdGl2ZSwgZmFsc2UsIG51bGwpOwogICAgICAgICAgICBp\nZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRG\naWVsZChmaWVsZCwgbG9ja0xldmVsLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGFzc2lnbkZpZWxkKGZpZWxkLCBm\nYWxzZSk7CiAgICAgICAgICAgIG9idGFpbkxvY2tzKGFjdGl2ZSwgZmFsc2Us\nIGxvY2tMZXZlbCwgbnVsbCwgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xh\ndGUocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkaXJ0eShT\ndHJpbmcgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoZm1kID09IG51bGwp\nCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tZmllbGQiLCBmaWVsZCwKICAgICAgICAgICAgICAg\nIEltcGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKF9wYykuZ2V0Q2xhc3Mo\nKSkpCiAgICAgICAgICAgICAgICAuc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFn\nZWRJbnN0YW5jZSgpKSk7CgogICAgICAgIGRpcnR5KGZtZC5nZXRJbmRleCgp\nLCBudWxsLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkaXJ0eShp\nbnQgZmllbGQpIHsKICAgICAgICBkaXJ0eShmaWVsZCwgbnVsbCwgdHJ1ZSk7\nCiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzRW1iZWRkZWROb3RVcGRh\ndGFibGUoKSB7CiAgICAgICAgLy8gZW1iZWRkYWJsZSBvYmplY3QgcmV0dXJu\nZWQgZnJvbSBxdWVyeSByZXN1bHQgaXMgbm90IHVwdGFibGUKICAgICAgICBy\nZXR1cm4gKF9vd25lciA9PSBudWxsICYmIF9vd25lcklkICE9IG51bGwpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gZmllbGQgZGly\ndHkuCiAgICAgKgogICAgICogQHBhcmFtIG11dGF0ZSBpZiBudWxsLCBtYXkg\nYmUgYW4gU0NPIG11dGF0aW9uOyBpZiB0cnVlLCBpcyBjZXJ0YWlubHkKICAg\nICAqIGEgbXV0YXRpb24gKG9yIGF0IGxlYXN0IHRyZWF0IGFzIG9uZSkKICAg\nICAqIEByZXR1cm4ge0BsaW5rIEJvb2xlYW4jRkFMU0V9IGlmIHRoaXMgaW5z\ndGFuY2Ugd2FzIGFscmVhZHkgZGlydHksCiAgICAgKiA8Y29kZT5udWxsPC9j\nb2RlPiBpZiBpdCB3YXMgZGlydHkgYnV0IG5vdCBzaW5jZSBmbHVzaCwgYW5k\nCiAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBpZiBpdCB3YXMgbm90IGRp\ncnR5CiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiBkaXJ0eShpbnQgZmll\nbGQsIEJvb2xlYW4gbXV0YXRlLCBib29sZWFuIGxvYWRGZXRjaEdyb3VwKSB7\nCiAgICAgICAgYm9vbGVhbiBsb2NrZWQgPSBmYWxzZTsKICAgICAgICBib29s\nZWFuIG5ld0ZsdXNoID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBjbGVhbiA9\nIGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICBp\nZiAoIWlzTmV3KCkgfHwgaXNGbHVzaGVkKCkpIHsKICAgICAgICAgICAgICAg\nIGlmIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3koKSA9PSBVcGRhdGVTdHJhdGVn\naWVzLlJFU1RSSUNUKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAg\nICAgICAgICAgKCJ1cGRhdGUtcmVzdHJpY3QiLCBmbWQpKTsKICAgICAgICAg\nICAgICAgIGlmIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3koKSA9PSBVcGRhdGVT\ndHJhdGVnaWVzLklHTk9SRSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKGlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAgICAgaWYgKGlzRW1iZWRk\nZWROb3RVcGRhdGFibGUoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAg\nICAgICAoImNhbnQtdXBkYXRlLWVtYmVkLWluLXF1ZXJ5LXJlc3VsdCIpKS5z\nZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgKGdldE1h\nbmFnZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICAvLyBub3RpZnkgb3duZXIgb2YgY2hhbmdlCiAgICAg\nICAgICAgICAgICAgICAgX293bmVyLmRpcnR5KF9vd25lckluZGV4LCBCb29s\nZWFuLlRSVUUsIGxvYWRGZXRjaEdyb3VwKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gaXMgdGhpcyBhIGRpcmVjdCBtdXRhdGlvbiBvZiBhbiBz\nY28gZmllbGQ/CiAgICAgICAgICAgIGlmIChtdXRhdGUgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09M\nTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5N\nQVA6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAg\nICAgICAgICAgICAgICAgICAgIG11dGF0ZSA9IEJvb2xlYW4uVFJVRTsKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgICAg\nIG11dGF0ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZm1kLmlz\nRW1iZWRkZWQoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUg\nPSBCb29sZWFuLkZBTFNFOyAvLyBub3Qgc2NvCiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBvc3NpYmx5IGNoYW5n\nZSBzdGF0ZQogICAgICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9rZXIu\naXNBY3RpdmUoKTsKICAgICAgICAgICAgY2xlYW4gPSAhX3N0YXRlLmlzRGly\ndHkoKTsgLy8gaW50ZW50aW9uYWwgZGlyZWN0IGFjY2VzcwoKICAgICAgICAg\nICAgLy8gZmlyZSBldmVudCBmYXN0IGJlZm9yZSBzdGF0ZSBjaGFuZ2UuCiAg\nICAgICAgICAgIGlmIChjbGVhbikKICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFkpOwogICAg\nICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgICBpZiAoX2Jy\nb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUuYmVmb3JlT3B0aW1pc3RpY1dyaXRlKHRoaXMsIGZp\nZWxkLAogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUuYm9vbGVhblZh\nbHVlKCkpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVXcml0ZSh0aGlzLCBmaWVs\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1\nZSgpKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm1kLmdldE1hbmFnZW1l\nbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKSB7CiAg\nICAgICAgICAgICAgICBpZiAoaXNQZXJzaXN0ZW50KCkgJiYgIV9icm9rZXIu\nZ2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRlKCkpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICAgICAoIm5vbi10cmFucy13cml0ZSIpKS5z\nZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgKGdldE1h\nbmFnZWRJbnN0YW5jZSgpKTsKCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5iZWZvcmVOb250cmFuc2FjdGlvbmFsV3JpdGUodGhpcywgZmll\nbGQsCiAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1ZSgp\nKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19GTFVTSEVEKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBuZXdGbHVz\naCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIRURfRElSVFkpID09IDA7CiAgICAg\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEX0RJUlRZOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBsb2NrKCk7CiAgICAgICAgICAgIGxv\nY2tlZCA9IHRydWU7CgogICAgICAgICAgICAvLyBub3RlIHRoYXQgdGhlIGZp\nZWxkIGlzIGluIG5lZWQgb2YgZmx1c2hpbmcgYWdhaW4sIGFuZCB0ZWxsIHRo\nZQogICAgICAgICAgICAvLyBicm9rZXIgdG9vCiAgICAgICAgICAgIF9mbHVz\naC5jbGVhcihmaWVsZCk7CiAgICAgICAgICAgIF9icm9rZXIuc2V0RGlydHko\ndGhpcywgbmV3Rmx1c2ggJiYgIWNsZWFuKTsKCiAgICAgICAgICAgIC8vIHNh\ndmUgdGhlIGZpZWxkIGZvciByb2xsYmFjayBpZiBuZWVkZWQKICAgICAgICAg\nICAgc2F2ZUZpZWxkKGZpZWxkKTsKCiAgICAgICAgICAgIC8vIGRpcnR5IHRo\nZSBmaWVsZCBhbmQgbWFyayBsb2FkZWQ7IGxvYWQgZmV0Y2ggZ3JvdXAgaWYg\nbmVlZGVkCiAgICAgICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVM\nb2NrTGV2ZWwoYWN0aXZlLCB0cnVlLCBudWxsKTsKICAgICAgICAgICAgaWYg\nKCFfZGlydHkuZ2V0KGZpZWxkKSkgewogICAgICAgICAgICAgICAgc2V0TG9h\nZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9kaXJ0eS5zZXQo\nZmllbGQpOwoKICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgZmll\nbGQncyBmZXRjaCBncm91cCBpcyBsb2FkZWQKICAgICAgICAgICAgICAgIGlm\nIChsb2FkRmV0Y2hHcm91cCAmJiBpc1BlcnNpc3RlbnQoKQogICAgICAgICAg\nICAgICAgICAgICYmIGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gZm1kLk1BTkFH\nRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgICAgIGxvYWRGaWVsZChm\naWVsZCwgbG9ja0xldmVsLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBvYnRhaW5Mb2NrcyhhY3RpdmUsIHRydWUsIGxvY2tMZXZl\nbCwgbnVsbCwgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChsb2NrZWQpCiAg\nICAgICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CgogICAgICAgIGlm\nIChjbGVhbikKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAg\nICAgICBpZiAobmV3Rmx1c2gpIHsKICAgICAgICAgICAgLy8gdGhpcyBldmVu\ndCBjYW4gYmUgZmlyZWQgbGF0ZXIgY2F1c2Ugd2UncmUgYWxyZWFkeSBkaXJ0\neS4KICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2\nZW50LkJFRk9SRV9ESVJUWV9GTFVTSEVEKTsKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNF\nOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSBwb3N0LWRpcnR5IGV2ZW50\ncyBhZnRlciBmaWVsZCB2YWx1ZSBjaGFuZ2VzLgogICAgICoKICAgICAqIEBw\nYXJhbSBzdGF0dXMgcmV0dXJuIHZhbHVlIGZyb20ge0BsaW5rICNkaXJ0eShp\nbnQsIEJvb2xlYW4sIGJvb2xlYW4pfQogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcG9zdERpcnR5KEJvb2xlYW4gc3RhdHVzKSB7CiAgICAgICAgaWYgKEJv\nb2xlYW4uVFJVRS5lcXVhbHMoc3RhdHVzKSkKICAgICAgICAgICAgZmlyZUxp\nZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RJUlRZKTsKICAg\nICAgICBlbHNlIGlmIChzdGF0dXMgPT0gbnVsbCkKICAgICAgICAgICAgZmly\nZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RJUlRZX0ZM\nVVNIRUQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZWQoaW50IGZp\nZWxkLCBPYmplY3QgcmVtb3ZlZCwgYm9vbGVhbiBrZXkpIHsKICAgICAgICBp\nZiAocmVtb3ZlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGRlcmVmZXJlbmNlIGRlcGVuZGVu\ndCBmaWVsZHMsIGRlbGV0ZSBlbWJlZGRlZAogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAg\nICAgVmFsdWVNZXRhRGF0YSB2bWQgPSAoa2V5KSA/IGZtZC5nZXRLZXkoKSA6\nIGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgICAgIGlmICh2bWQuaXNFbWJl\nZGRlZFBDKCkpCiAgICAgICAgICAgICAgICBfc2luZ2xlLmRlbGV0ZSh2bWQs\nIHJlbW92ZWQsIG51bGwpOwogICAgICAgICAgICBlbHNlIGlmICh2bWQuZ2V0\nQ2FzY2FkZURlbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRP\nKQogICAgICAgICAgICAgICAgX3NpbmdsZS5kZXJlZmVyZW5jZURlcGVuZGVu\ndChyZW1vdmVkKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3UHJveHkoaW50IGZp\nZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgcmV0dXJuIG5ld0ZpZWxkUHJveHkoZmllbGQpOwoK\nICAgICAgICBzd2l0Y2ggKGZtZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBpZiAo\nZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEuc3FsLkRhdGUuY2xhc3Mp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBqYXZhLnNxbC5EYXRl\nKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAgICAgICAgICAgICAg\nIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gamF2YS5zcWwuVGltZXN0\nYW1wLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgamF2\nYS5zcWwuVGltZXN0YW1wKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsK\nICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0g\namF2YS5zcWwuVGltZS5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IGphdmEuc3FsLlRpbWUoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAg\nICAgcmV0dXJuIENhbGVuZGFyLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBuZXdGaWVsZFByb3h5KGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIFByb3h5TWFuYWdlciBtZ3IgPSBfYnJva2VyLmdldENvbmZp\nZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0UHJveHlNYW5hZ2VySW5zdGFu\nY2UoKTsKICAgICAgICBPYmplY3QgaW5pdCA9IGZtZC5nZXRJbml0aWFsaXpl\ncigpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAg\nICAgICAgICAgIHJldHVybiBtZ3IubmV3RGF0ZVByb3h5KGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVO\nREFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG1nci5uZXdDYWxlbmRhclBy\nb3h5KGZtZC5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAg\nICBpbml0IGluc3RhbmNlb2YgVGltZVpvbmUgPyAoVGltZVpvbmUpIGluaXQg\nOiBudWxsKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3Q29sbGVjdGlvblBy\nb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBm\nbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAg\nICAgICAgICAgIGluaXQgaW5zdGFuY2VvZiBDb21wYXJhdG9yID8gKENvbXBh\ncmF0b3IpIGluaXQgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBf\nYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5SW5z\ndGFuY2UoKS5nZXRBdXRvT2ZmKCkpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld01hcFBy\nb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBm\nbWQuZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAg\nICAgICAgICAgICAgICAgICBpbml0IGluc3RhbmNlb2YgQ29tcGFyYXRvciA/\nIChDb21wYXJhdG9yKSBpbml0IDogbnVsbCwKICAgICAgICAgICAgICAgICAg\nICAgICAgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0aWJp\nbGl0eUluc3RhbmNlKCkuZ2V0QXV0b09mZigpKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNE\nZWZhdWx0VmFsdWUoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAg\nICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICBib29sZWFuIHJldCA9IF9zaW5nbGUuaXNEZWZhdWx0VmFsdWUo\nKTsKICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICBy\nZXR1cm4gcmV0OwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIFJlY29yZCB0aGF0IHRoZSBmaWVsZCBpcyBkaXJ0eSAod2hpY2ggbWln\naHQgbG9hZCBERkcpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9p\nZCBzZXR0aW5nQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\naW50IGZpZWxkLAogICAgICAgIGJvb2xlYW4gY3VyVmFsLCBib29sZWFuIG5l\nd1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9U\nRSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAg\nICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0Us\nIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVC\nb29sZWFuRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxh\nY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0\nRGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndHRpbmdCeXRlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQsCiAgICAgICAgYnl0ZSBjdXJWYWwsIGJ5dGUgbmV3VmFsLCBpbnQgc2V0\nKSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAg\nICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxk\nKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0\nTm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0\nYXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9V\nU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVsZChmaWVs\nZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2lu\nZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0NoYXJGaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBjaGFy\nIGN1clZhbCwgY2hhciBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAo\nc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9\nPSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFu\nZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxk\nLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAg\nICBfc2luZ2xlLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAg\nICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXR0aW5nRG91YmxlRmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZG91YmxlIGN1clZhbCwgZG91\nYmxlIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VU\nX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAm\nJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7\nCiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4u\nRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0dGluZ0Zsb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQsCiAgICAgICAgZmxvYXQgY3VyVmFsLCBmbG9hdCBuZXdWYWws\nIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsK\nICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5n\nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0K\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJv\nb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQg\nPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlRmxvYXRG\naWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxk\nKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShz\ndGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0lu\ndEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAg\nICAgIGludCBjdXJWYWwsIGludCBuZXdWYWwsIGludCBzZXQpIHsKICAgICAg\nICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5l\nd1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlL\nZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5\nKGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIG5ld1ZhbCk7\nCiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldHRpbmdMb25nRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgbG9uZyBjdXJWYWwsIGxv\nbmcgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRf\nUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYm\nIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5G\nQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZUxvbmdGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVw\nbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBv\nc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0dGluZ09iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwsIE9iamVjdCBuZXdWYWws\nIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkp\nIHsKICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAvLyBv\nbmx5IGNvbXBhcmUgbmV3IHRvIG9sZCB2YWx1ZXMgaWYgdGhlIGNvbXBhcmlz\nb24gaXMgZ29pbmcgdG8KICAgICAgICAgICAgICAgIC8vIGJlIGNoZWFwIC0t\nIGRvbid0IGNvbXBhcmUgY29sbGVjdGlvbnMsIG1hcHMsIFVEVHMKICAgICAg\nICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgIT0g\nbnVsbCAmJiBuZXdWYWwuZXF1YWxzKGN1clZhbCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlz\nIGEgZGVwZW5kZW50IHVubG9hZGVkIGZpZWxkLCBtYWtlIHN1cmUgdG8gbG9h\nZAogICAgICAgICAgICAgICAgLy8gaXQgbm93CiAgICAgICAgICAgICAgICBp\nZiAoZm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfQVVUTwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXRLZXko\nKS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAgICAgICA9PSBW\nYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTwogICAgICAgICAgICAgICAgICAg\nIHx8IGZtZC5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAg\nICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8p\nCiAgICAgICAgICAgICAgICAgICAgY3VyVmFsID0gZmV0Y2hPYmplY3RGaWVs\nZChmaWVsZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzc2VydE5v\nUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgICAgIGlmIChmbWQu\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAgICAg\nICAgICAgICAgICBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQobmV3VmFsKTsK\nICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5G\nQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgaWYgKHNldCAh\nPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nT2JqZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgICAgICBf\nc2luZ2xlLnVucHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVy\nZWZlcmVuY2VEZXBlbmRlbnQoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUu\nY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlT2JqZWN0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBw\nb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldHRpbmdTaG9ydEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkLAogICAgICAgIHNob3J0IGN1clZhbCwgc2hvcnQgbmV3VmFsLCBp\nbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAg\nICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0\nKGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29s\nZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09\nIFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVNob3J0Rmll\nbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChw\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3Rh\ndCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdTdHJp\nbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAg\nICAgICBTdHJpbmcgY3VyVmFsLCBTdHJpbmcgbmV3VmFsLCBpbnQgc2V0KSB7\nCiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAg\nIGlmIChTdHJpbmdVdGlscy5lcXVhbHMobmV3VmFsLCBjdXJWYWwpICYmIF9s\nb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAg\nICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxT\nRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9y\nZVN0cmluZ0ZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBs\nYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9z\ndERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERp\nc2FsbG93cyBjaGFuZ2luZyBwcmltYXJ5IGtleSBmaWVsZHMgZm9yIGluc3Rh\nbmNlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE5vUHJpbWFy\neUtleUNoYW5nZShpbnQgZmllbGQpIHsKICAgICAgICBpZiAoX29pZCAhPSBu\ndWxsICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkK\nICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgiY2hhbmdlLWlk\nZW50aXR5IikpLnNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGlzYWxsb3dzIHNldHRpbmcg\nYW4gb2JqZWN0IGlkIGZpZWxkIHRvIGEgbWFuYWdlZCBpbnN0YW5jZS4KICAg\nICAqLwogICAgdm9pZCBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQoT2JqZWN0\nIHZhbCkgewogICAgICAgIGlmICh2YWwgIT0gbnVsbAogICAgICAgICAgICAm\nJiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh2YWwsCiAgICAg\nICAgICAgICAgICAgZ2V0Q29udGV4dCgpLmdldENvbmZpZ3VyYXRpb24oKSkp\nLnBjR2V0R2VuZXJpY0NvbnRleHQoKSE9IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IHRyYW5zbGF0ZShuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0CiAgICAgICAgICAgICAgICAoIm1hbmFnZWQtb2lkIiwgRXhjZXB0aW9u\ncy50b1N0cmluZyh2YWwpLAogICAgICAgICAgICAgICAgICAgIEV4Y2VwdGlv\nbnMudG9TdHJpbmcoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAgICAgICAg\nICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkp\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBEZWxlZ2F0ZSB0byBGaWVsZE1hbmFnZXIKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEJv\nb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBib29sZWFuIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUJv\nb2xlYW5GaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBwcm92aWRlZEJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIGludCBmaWVsZCwKICAgICAgICBieXRlIGN1clZhbCkgewogICAgICAgIF9m\nbS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBwcm92aWRlZENoYXJGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBjaGFyIGN1clZhbCkgewogICAg\nICAgIF9mbS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZERvdWJsZUZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJsZSBjdXJW\nYWwpIHsKICAgICAgICBfZm0uc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEZsb2F0Rmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAg\nZmxvYXQgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlRmxvYXRGaWVsZChm\naWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRl\nZEludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIGludCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVJbnRGaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92\naWRlZExvbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVs\nZCwKICAgICAgICBsb25nIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUxv\nbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwcm92aWRlZE9iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\naW50IGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwpIHsKICAgICAgICBf\nZm0uc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBwcm92aWRlZFNob3J0RmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgc2hvcnQgY3VyVmFsKSB7\nCiAgICAgICAgX2ZtLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3VyVmFsKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZFN0cmluZ0ZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIFN0cmlu\nZyBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVTdHJpbmdGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXBsYWNl\nQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxk\nKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEJvb2xlYW5GaWVsZChmaWVs\nZCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgcmVwbGFjZUJ5dGVGaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJl\ndHVybiBfZm0uZmV0Y2hCeXRlRmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1\nYmxpYyBjaGFyIHJlcGxhY2VDaGFyRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoQ2hh\nckZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIHJlcGxh\nY2VEb3VibGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVs\nZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVs\nZCk7CiAgICB9CgogICAgcHVibGljIGZsb2F0IHJlcGxhY2VGbG9hdEZpZWxk\nKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAg\ncmV0dXJuIF9mbS5mZXRjaEZsb2F0RmllbGQoZmllbGQpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgcmVwbGFjZUludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaElu\ndEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyByZXBsYWNl\nTG9uZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7\nCiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaExvbmdGaWVsZChmaWVsZCk7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCByZXBsYWNlT2JqZWN0RmllbGQoUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1\ncm4gX2ZtLmZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1\nYmxpYyBzaG9ydCByZXBsYWNlU2hvcnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hT\naG9ydEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHJl\ncGxhY2VTdHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hTdHJpbmdGaWVsZChm\naWVsZCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgRmllbGRNYW5hZ2Vy\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\ncHVibGljIGJvb2xlYW4gZmV0Y2hCb29sZWFuKGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBmZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7CgogICAgICAg\nIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAg\nICAgcmV0dXJuICgoQm9vbGVhbikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFs\nLCBfYnJva2VyKSkuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gZmV0Y2hCb29sZWFuRmllbGQoaW50IGZpZWxkKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZp\nZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAg\nICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hCb29sZWFuRmllbGQo\nZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYnl0ZSBmZXRjaEJ5\ndGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoQnl0ZUZpZWxk\nKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmll\nbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRF\neHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmJ5dGVWYWx1ZSgpOwogICAg\nfQoKICAgIHB1YmxpYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBmaWVsZCkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRG\naWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxz\nZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoQnl0ZUZp\nZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGNoYXIgZmV0\nY2hDaGFyKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlz\nRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaENoYXJG\naWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxk\nKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoQ2hhcmFjdGVyKSBm\nbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5jaGFyVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgY2hhciBmZXRjaENoYXJGaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAg\nICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxz\nZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRj\naENoYXJGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBk\nb3VibGUgZmV0Y2hEb3VibGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\naWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZldGNoRG91YmxlRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFs\nID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAo\nKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSku\nZG91YmxlVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIGZldGNo\nRG91YmxlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxz\nLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0\ndXJuIF9zaW5nbGUuZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBmbG9hdCBmZXRjaEZsb2F0KGludCBmaWVsZCkg\newogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQo\nZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAg\nICAgICAgICAgIHJldHVybiBmZXRjaEZsb2F0RmllbGQoZmllbGQpOwoKICAg\nICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwog\nICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUo\ndmFsLCBfYnJva2VyKSkuZmxvYXRWYWx1ZSgpOwogICAgfQoKICAgIHB1Ymxp\nYyBmbG9hdCBmZXRjaEZsb2F0RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRl\nZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxk\nLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAg\nICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hGbG9hdEZpZWxkKGZpZWxk\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBmZXRjaEludChpbnQg\nZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXpl\nZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hJbnRGaWVsZChmaWVsZCk7\nCgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxz\nZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxW\nYWx1ZSh2YWwsIF9icm9rZXIpKS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVk\nLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQs\nIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAg\nICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEludEZpZWxkKGZpZWxkKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZmV0Y2hMb25nKGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaExvbmdGaWVsZChmaWVsZCk7\nCgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxz\nZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxW\nYWx1ZSh2YWwsIF9icm9rZXIpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBw\ndWJsaWMgbG9uZyBmZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmll\nbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAg\nICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaExvbmdGaWVsZChmaWVs\nZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmpl\nY3QoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0Rmll\nbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChm\naWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiBmbWQuZ2V0RXh0ZXJuYWxW\nYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nZmV0Y2hPYmplY3RGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tM\nZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAg\ncHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICByZXR1cm4gX3NpbmdsZS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHNob3J0IGZldGNoU2hvcnQoaW50IGZp\nZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoU2hvcnRGaWVsZChmaWVsZCk7\nCgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxz\nZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxW\nYWx1ZSh2YWwsIF9icm9rZXIpKS5zaG9ydFZhbHVlKCk7CiAgICB9CgogICAg\ncHVibGljIHNob3J0IGZldGNoU2hvcnRGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFf\nbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQo\nZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaFNob3J0RmllbGQo\nZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGZldGNo\nU3RyaW5nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlz\nRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaFN0cmlu\nZ0ZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKFN0cmluZykgZm1k\nLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxk\nKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsK\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTdHJpbmdGaWVs\nZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3Jl\nQm9vbGVhbihpbnQgZmllbGQsIGJvb2xlYW4gZXh0ZXJuYWxWYWwpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAg\nICAgICBzdG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBPYmplY3QgdmFsID0gKGV4dGVy\nbmFsVmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKHZh\nbCwgX2Jyb2tlcikpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdG9yZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gY3VyVmFs\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIF9zaW5nbGUuc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAg\nICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZUJ5dGUoaW50IGZpZWxkLCBieXRlIGV4dGVybmFs\nVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgc3RvcmVCeXRlRmllbGQoZmllbGQsIGV4dGVybmFs\nVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmll\nbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBCeXRlKGV4dGVybmFsVmFsKSwK\nICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9yZUJ5dGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFsKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAg\nICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9z\ndExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9yZUNoYXIoaW50IGZpZWxkLCBjaGFyIGV4dGVybmFsVmFsKSB7\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChm\naWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAg\nICAgICAgICAgc3RvcmVDaGFyRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZt\nZC5nZXRGaWVsZFZhbHVlKG5ldyBDaGFyYWN0ZXIoZXh0ZXJuYWxWYWwpLAog\nICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN0b3JlQ2hhckZpZWxkKGludCBmaWVsZCwgY2hhciBjdXJWYWwpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3Np\nbmdsZS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0\nTG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN0b3JlRG91YmxlKGludCBmaWVsZCwgZG91YmxlIGV4dGVybmFsVmFs\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZXh0ZXJuYWxW\nYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVs\nZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IERvdWJsZShleHRlcm5hbFZhbCks\nCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc3RvcmVEb3VibGVGaWVsZChpbnQgZmllbGQsIGRvdWJsZSBjdXJW\nYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgX3NpbmdsZS5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwog\nICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7\nCiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAg\nICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVGbG9hdChpbnQgZmllbGQsIGZsb2F0IGV4dGVy\nbmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBleHRl\ncm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxk\nKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgRmxvYXQoZXh0ZXJuYWxW\nYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0IGN1\nclZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBfc2luZ2xlLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3VyVmFsKTsK\nICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAg\nICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHN0b3JlSW50KGludCBmaWVsZCwgaW50IGV4dGVybmFs\nVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgc3RvcmVJbnRGaWVsZChmaWVsZCwgZXh0ZXJuYWxW\nYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVs\nZCwgZm1kLmdldEZpZWxkVmFsdWUoTnVtYmVycy52YWx1ZU9mKGV4dGVybmFs\nVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IGN1clZh\nbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBfc2luZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAg\nICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAg\ncG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdG9yZUxvbmcoaW50IGZpZWxkLCBsb25nIGV4dGVybmFsVmFs\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgc3RvcmVMb25nRmllbGQoZmllbGQsIGV4dGVybmFsVmFs\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQs\nIGZtZC5nZXRGaWVsZFZhbHVlKE51bWJlcnMudmFsdWVPZihleHRlcm5hbFZh\nbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RvcmVMb25nRmllbGQoaW50IGZpZWxkLCBsb25nIGN1clZh\nbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBfc2luZ2xlLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAg\nICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAg\nICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAg\nIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RvcmVPYmplY3QoaW50IGZpZWxkLCBPYmplY3QgZXh0ZXJu\nYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBleHRlcm5hbFZhbCA9IGZtZC5vcmRl\ncihleHRlcm5hbFZhbCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgZXh0\nZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVs\nZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxWYWwsIF9icm9r\nZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVjdEZpZWxk\nKGludCBmaWVsZCwgT2JqZWN0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0\nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIF9zaW5nbGUucHJv\neHkodHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3Bj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVs\nZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVTaG9ydChpbnQg\nZmllbGQsIHNob3J0IGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYg\nKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVTaG9y\ndEZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShu\nZXcgU2hvcnQoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tl\ncikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChp\nbnQgZmllbGQsIHNob3J0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3JlU2hvcnRGaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9w\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmll\nbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nKGlu\ndCBmaWVsZCwgU3RyaW5nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\naWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVT\ndHJpbmdGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFs\ndWUoZXh0ZXJuYWxWYWwsIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5nIGN1clZh\nbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBfc2luZ2xlLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAg\nICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFN0b3JlIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZSBpbnRvIHRo\nZSBnaXZlbiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwsIEZpZWxkTWFu\nYWdlciBmbSkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLWZpZWxkLWluZGV4IiwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9m\nKGZpZWxkKSwgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAgICAgICAg\nICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkp\nOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkp\nIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAg\nICAgICAgICAgIGJvb2xlYW4gYm9vbCA9IHZhbCAhPSBudWxsICYmICgoQm9v\nbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZt\nLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBib29sKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICAgICAgYnl0ZSBiID0gKHZhbCA9PSBudWxsKSA/IDAgOiAo\nKE51bWJlcikgdmFsKS5ieXRlVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZt\nLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBiKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAg\nICAgICAgICAgY2hhciBjID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKENoYXJh\nY3RlcikgdmFsKS5jaGFyVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0\nb3JlQ2hhckZpZWxkKGZpZWxkLCBjKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAg\nICAgICAgICBkb3VibGUgZCA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1i\nZXIpIHZhbCkuZG91YmxlVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0\nb3JlRG91YmxlRmllbGQoZmllbGQsIGQpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAg\nICAgICAgICAgZmxvYXQgZiA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1i\nZXIpIHZhbCkuZmxvYXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3Rv\ncmVGbG9hdEZpZWxkKGZpZWxkLCBmKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nICAgICBpbnQgaSA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZh\nbCkuaW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlSW50Rmll\nbGQoZmllbGQsIGkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBsb25n\nIGwgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmxvbmdW\nYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVMb25nRmllbGQoZmll\nbGQsIGwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgc2hvcnQgcyA9\nICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuc2hvcnRWYWx1\nZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVTaG9ydEZpZWxkKGZpZWxk\nLCBzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBmbS5zdG9yZVN0\ncmluZ0ZpZWxkKGZpZWxkLCAoU3RyaW5nKSB2YWwpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICBmbS5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCB2YWwpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRpZXMKICAg\nIC8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIEVyYXNlIHRoZSBmYWN0\nIHRoYXQgdGhpcyBpbnN0YW5jZSBoYXMgYmVlbiBmbHVzaGVkLgogICAgICov\nCiAgICB2b2lkIGVyYXNlRmx1c2goKSB7CiAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX0ZMVVNIRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURf\nRElSVFk7CgogICAgICAgIGludCBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCku\nbGVuZ3RoOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kczsgaSsr\nKQogICAgICAgICAgICBfZmx1c2guY2xlYXIoaSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWNvcmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxkcyBhcmUv\nYXJlIG5vdCBsb2FkZWQuCiAgICAgKiBQcmltYXJ5IGtleSBhbmQgbm9uLXBl\ncnNpc3RlbnQgZmllbGRzIGFyZSBub3QgYWZmZWN0ZWQuCiAgICAgKi8KICAg\nIHZvaWQgc2V0TG9hZGVkKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpCiAgICAgICAgICAg\nICAgICAmJiBmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRzW2ldLk1B\nTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgc2V0TG9hZGVkKGks\nIHZhbCk7CiAgICAgICAgfQogICAgICAgIGlmICghdmFsKSB7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RkxBR19MT0FERUQ7CiAgICAgICAgICAgIHNldERp\ncnR5KGZhbHNlKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgX2ZsYWdz\nIHw9IEZMQUdfTE9BREVEOwogICAgfQoKICAgIC8qKgogICAgICogUmVjb3Jk\ncyB0aGF0IGFsbCBpbnN0YW5jZSBmaWVsZHMgYXJlL2FyZSBub3QgZGlydHks\nCiAgICAgKiBhbmQgY2hhbmdlcyB0aGUgZmxhZ3Mgb2YgdGhlIGluc3RhbmNl\nIGFjY29yZGluZ2x5LgogICAgICovCiAgICB2b2lkIHNldERpcnR5KGJvb2xl\nYW4gdmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIHVwZGF0ZSA9ICFpc05l\ndygpIHx8IGlzRmx1c2hlZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodmFsICYm\nICghdXBkYXRlCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldFVwZGF0\nZVN0cmF0ZWd5KCkgIT0gVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUpKQogICAg\nICAgICAgICAgICAgX2RpcnR5LnNldChpKTsKICAgICAgICAgICAgZWxzZSBp\nZiAoIXZhbCkgewogICAgICAgICAgICAgICAgLy8gd2UgbmV2ZXIgY29uc2lk\nZXIgY2xlYW4gZmllbGRzIGZsdXNoZWQ7IHRoaXMgYWxzbyB0YWtlcwogICAg\nICAgICAgICAgICAgLy8gY2FyZSBvZiBjbGVhcmluZyB0aGUgZmx1c2hlZCBm\naWVsZHMgb24gY29tbWl0L3JvbGxiYWNrCiAgICAgICAgICAgICAgICBfZmx1\nc2guY2xlYXIoaSk7CiAgICAgICAgICAgICAgICBfZGlydHkuY2xlYXIoaSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh2YWwpCiAg\nICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0xPQURFRDsKICAgIH0KCiAgICAv\nKioKICAgICAqIEV4ZWN1dGVzIHByZS1jbGVhciBjYWxsYmFja3MsIGNsZWFy\ncyBhbGwgbWFuYWdlZCBmaWVsZHMsIGFuZCBjYWxscyB0aGUKICAgICAqIHtA\nbGluayAjc2V0TG9hZGVkfSBtZXRob2Qgd2l0aCBhIHZhbHVlIG9mIGZhbHNl\nLiBQcmltYXJ5IGtleSBmaWVsZHMKICAgICAqIGFyZSBub3QgY2xlYXJlZC4K\nICAgICAqLwogICAgdm9pZCBjbGVhckZpZWxkcygpIHsKICAgICAgICBpZiAo\nIWlzSW50ZXJjZXB0aW5nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9D\nTEVBUik7CgogICAgICAgIC8vIHVucHJveHkgYWxsIGZpZWxkcwogICAgICAg\nIHVucHJveHlGaWVsZHMoKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIGNsZWFyIG5vbi1wayBmaWVsZHMKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmlt\nYXJ5S2V5KCkgJiYgZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkKICAgICAgICAg\nICAgICAgICAgICA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5U\nKQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIENsZWFy\nRmllbGRNYW5hZ2VyLmdldEluc3RhbmNlKCksIGkpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBmb3JnZXQgdmVyc2lvbiBpbmZvIGFuZCBpbXBs\nIGRhdGEgc28gd2UgcmUtcmVhZCBuZXh0IHRpbWUKICAgICAgICAgICAgc2V0\nTG9hZGVkKGZhbHNlKTsKICAgICAgICAgICAgX3ZlcnNpb24gPSBudWxsOwog\nICAgICAgICAgICBfbG9hZFZlcnNpb24gPSBudWxsOwogICAgICAgICAgICBp\nZiAoX2ZpZWxkSW1wbCAhPSBudWxsKQogICAgICAgICAgICAgICAgQXJyYXlz\nLmZpbGwoX2ZpZWxkSW1wbCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoKICAgICAgICBmaXJl\nTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfQ0xFQVIpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkIHRoYXQgd2Ugc2hvdWxkIHNh\ndmUgYW55IGZpZWxkcyB0aGF0IGNoYW5nZSBmcm9tIHRoaXMgcG9pbnQKICAg\nICAqIGZvcndhcmQuCiAgICAgKi8KICAgIHZvaWQgc2F2ZUZpZWxkcyhib29s\nZWFuIGltbWVkaWF0ZSkgewogICAgICAgIGlmIChfYnJva2VyLmdldFJlc3Rv\ncmVTdGF0ZSgpID09IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUKICAgICAg\nICAgICAgJiYgKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDApCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU0FWRTsK\nICAgICAgICBpZiAoaW1tZWRpYXRlKSB7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKysp\nCiAgICAgICAgICAgICAgICBzYXZlRmllbGQoaSk7CiAgICAgICAgICAgIF9m\nbGFncyAmPSB+RkxBR19TQVZFOwogICAgICAgICAgICAvLyBPUEVOSlBBLTY1\nOQogICAgICAgICAgICAvLyByZWNvcmQgYSBzYXZlZCBmaWVsZCBtYW5hZ2Vy\nIGV2ZW4gaWYgbm8gZmllbGQgaXMgY3VycmVudGx5IGxvYWRlZAogICAgICAg\nICAgICAvLyBhcyBleGlzdGVuY2Ugb2YgYSBTYXZlRmllbGRNYW5hZ2VyIGlz\nIGNyaXRpY2FsIGZvciBhIGRpcnR5IGNoZWNrCiAgICAgICAgICAgIGlmIChf\nc2F2ZWQgPT0gbnVsbCkKICAgICAgICAgICAgCV9zYXZlZCA9IG5ldyBTYXZl\nRmllbGRNYW5hZ2VyKHRoaXMsIGdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpLCAK\nICAgICAgICAgICAgCQkJCV9kaXJ0eSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogSWYgdGhlIGZpZWxkIGlzbid0IGFscmVhZHkgc2F2ZWQs\nIHNhdmVzIHRoZSBjdXJyZW50bHkgbG9hZGVkIGZpZWxkCiAgICAgKiBzdGF0\nZSBvZiB0aGUgaW5zdGFuY2UuIFRoZSBzYXZlZCB2YWx1ZXMgY2FuIGFsbCBi\nZSByZXN0b3JlZCB2aWEKICAgICAqIHtAbGluayAjcmVzdG9yZUZpZWxkc30u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzYXZlRmllbGQoaW50IGZpZWxk\nKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NBVkUpID09IDApCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIG1h\nbmFnZWQgaW52ZXJzZSBmaWVsZCwgbG9hZCBpdCBzbyB3ZSdyZSBzdXJlIHRv\nIGhhdmUKICAgICAgICAvLyB0aGUgb3JpZ2luYWwgdmFsdWUKICAgICAgICBp\nZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSAmJiAoKF9mbGFncyAmIEZMQUdfSU5W\nRVJTRVMpICE9IDAKICAgICAgICAgICAgJiYgX21ldGEuZ2V0RmllbGQoZmll\nbGQpLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSkKICAgICAg\nICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwg\nZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgLy8gZG9uJ3QgYm90aGVyIGNyZWF0\naW5nIHRoZSBzYXZlIGZpZWxkIG1hbmFnZXIgaWYgd2UncmUgbm90IGdvaW5n\nIHRvCiAgICAgICAgLy8gc2F2ZSB0aGUgb2xkIGZpZWxkIHZhbHVlIGFueXdh\neQogICAgICAgIGlmIChfc2F2ZWQgPT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgX3NhdmVk\nID0gbmV3IFNhdmVGaWVsZE1hbmFnZXIodGhpcywgbnVsbCwgX2RpcnR5KTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgLy8gY29weSB0aGUgZmllbGQgdG8gc2F2ZSBmaWVs\nZCBtYW5hZ2VyOyBpZiB0aGUgZmllbGQgaXMgbm90IGRpcmVjdGx5CiAgICAg\nICAgLy8gY29weWFibGUsIGltbWVkaWF0ZWx5IHByb3ZpZGUgYW5kIHJlcGxh\nY2UgaXQgdmlhIHRoZSBzYXZlIGZpZWxkCiAgICAgICAgLy8gbWFuYWdlciwg\nd2hpY2ggd2lsbCBjb3B5IHRoZSBtdXRhYmxlIHZhbHVlIHRvIHByZXZlbnQg\nYnktcmVmIG1vZHMKICAgICAgICBpZiAoX3NhdmVkLnNhdmVGaWVsZChmaWVs\nZCkpIHsKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NhdmVkLCBm\naWVsZCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfc2F2ZWQuZ2V0U3Rh\ndGUoKSwgX3NhdmVkLCBmaWVsZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIHN0YXRlIHdpbGwgbm90\nIG5lZWQgdG8gYmUgcm9sbGVkIGJhY2sKICAgICAqIHRvIHRoYXQgb2YgdGhl\nIGxhc3QgY2FsbCB0byB7QGxpbmsgI3NhdmVGaWVsZHN9LgogICAgICovCiAg\nICB2b2lkIGNsZWFyU2F2ZWRGaWVsZHMoKSB7CiAgICAgICAgaWYgKGlzSW50\nZXJjZXB0aW5nKCkpIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NB\nVkU7CiAgICAgICAgICAgIF9zYXZlZCA9IG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBTYXZlRmllbGRNYW5hZ2VyIGdldFNhdmVGaWVsZE1h\nbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9zYXZlZDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJvbGxiYWNrIHRoZSBzdGF0ZSBvZiB0aGUgaW5zdGFuY2Ug\ndG8gdGhlIHNhdmVkIHN0YXRlIGZyb20gdGhlCiAgICAgKiBsYXN0IGNhbGwg\ndG8ge0BsaW5rICNzYXZlRmllbGRzfSwgb3IgdG8gZGVmYXVsdCB2YWx1ZXMg\naWYgbmV2ZXIgc2F2ZWQuCiAgICAgKi8KICAgIHZvaWQgcmVzdG9yZUZpZWxk\ncygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKF9zYXZlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfU0FWRSkgPT0gMCkKICAgICAgICAgICAgICAgICAg\nICBjbGVhckZpZWxkcygpOwogICAgICAgICAgICAgICAgZWxzZSAvLyBvbmx5\nIHVubG9hZGVkIGZpZWxkcyB3ZXJlIGRpcnRpZWQKICAgICAgICAgICAgICAg\nICAgICBfbG9hZGVkLmFuZE5vdChfbG9hZGVkKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAvLyB3ZSBkaXJlY3Qgc3RhdGUgdHJhbnNpdGlvbnMgYmFz\nZWQgb24gb3VyIG93biBnZXRSZXN0b3JlU3RhdGUKICAgICAgICAgICAgLy8g\nbWV0aG9kLCBidXQgdG8gZGVjaWRlIHdoZXRoZXIgdG8gYWN0dWFsbHkgcm9s\nbGJhY2sgZmllbGQKICAgICAgICAgICAgLy8gdmFsdWVzLCB3ZSBjb25zdWx0\nIHRoZSBicm9rZXIgZm9yIHRoZSB1c2VyJ3Mgc2V0dGluZwogICAgICAgICAg\nICBlbHNlIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3Rv\ncmVTdGF0ZS5SRVNUT1JFX05PTkUpIHsKICAgICAgICAgICAgICAgIC8vIHJv\nbGxiYWNrIGFsbCBjdXJyZW50bHktbG9hZGVkIGZpZWxkcwogICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7\nIGkgPCBsZW47IGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAoX2xvYWRl\nZC5nZXQoaSkgJiYgX3NhdmVkLnJlc3RvcmVGaWVsZChpKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NhdmVkLCBpKTsK\nCiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBsb2FkZWQgc2V0CiAgICAg\nICAgICAgICAgICBfbG9hZGVkLmFuZE5vdChfc2F2ZWQuZ2V0VW5sb2FkZWQo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlcGxhY2VzIGFsbCBzZWNvbmQgY2xhc3Mgb2JqZWN0IGZp\nZWxkcyB3aXRoIGZyZXNoIHByb3hpZWQgaW5zdGFuY2VzCiAgICAgKiBjb250\nYWluaW5nIHRoZSBzYW1lIGluZm9ybWF0aW9uIGFzIHRoZSBvcmlnaW5hbHMu\nCiAgICAgKi8KICAgIHZvaWQgcHJveHlGaWVsZHMoYm9vbGVhbiByZXNldCwg\nYm9vbGVhbiByZXBsYWNlTnVsbCkgewogICAgICAgIC8vIHdlIG9ubHkgcmVw\nbGFjZSBudWxscyBpZiB0aGUgcnVudGltZSBjYW4ndCBkaWZmZXJlbnRpYXRl\nIGJldHdlZW4KICAgICAgICAvLyBudWxsIGFuZCBlbXB0eSBjb250YWluZXJz\nLiAgd2UgcmVwbGFjZSBudWxscyBpbiB0aGlzIGNhc2UgdG8KICAgICAgICAv\nLyBtYWludGFpbiBjb25zaXN0ZW5jeSB3aGV0aGVyIHZhbHVlcyBhcmUgYmVp\nbmcgcmV0YWluZWQgb3Igbm90CiAgICAgICAgaWYgKHJlcGxhY2VOdWxsKQog\nICAgICAgICAgICByZXBsYWNlTnVsbCA9ICFfYnJva2VyLmdldENvbmZpZ3Vy\nYXRpb24oKS5zdXBwb3J0ZWRPcHRpb25zKCkuCiAgICAgICAgICAgICAgICBj\nb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fTlVMTF9DT05U\nQUlORVIpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7\nIGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9sb2FkZWQu\nZ2V0KGkpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9w\nYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9zaW5n\nbGUucHJveHkocmVzZXQsIHJlcGxhY2VOdWxsKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBf\nc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVbnByb3h5IGFsbCBm\naWVsZHMuCiAgICAgKi8KICAgIHZvaWQgdW5wcm94eUZpZWxkcygpIHsKICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfTk9fVU5QUk9YWSkgIT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQu\nbGVuZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgcHJv\ndmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICBf\nc2luZ2xlLnVucHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUucmVs\nZWFzZUVtYmVkZGVkKCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFy\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEdldCByZWFkeSBmb3IgYSBmbHVzaC4gUGVyc2lzdHMgYWxs\nIHBlcnNpc3RlbmNlLWNhcGFibGUgb2JqZWN0IGZpZWxkcywKICAgICAqIGFu\nZCBjaGVja3MgZm9yIGlsbGVnYWwgbnVsbCB2YWx1ZXMuIEFsc28gYXNzaWdu\ncyBvaWRzIGFuZCBmaWVsZCB2YWx1ZXMKICAgICAqIGZvciBhbGwgc3RyYXRl\nZ2llcyB0aGF0IGRvbid0IHJlcXVpcmUgZmx1c2hpbmcuCiAgICAgKi8KICAg\nIHZvaWQgcHJlRmx1c2goYm9vbGVhbiBsb2dpY2FsLCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRV9GTFVTSEVE\nKSAhPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChpc1Bl\ncnNpc3RlbnQoKSkgewogICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQo\nTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1NUT1JFKTsKICAgICAgICAgICAgLy8g\nQkVGT1JFX1BFUlNJU1QgaXMgaGFuZGxlZCBkdXJpbmcgQnJva2VyLnBlcnNp\nc3QgYW5kIEJyb2tlci5hdHRhY2gKICAgICAgICAgICAgaWYgKGlzRGVsZXRl\nZCgpKQogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVj\neWNsZUV2ZW50LkJFRk9SRV9ERUxFVEUpOwogICAgICAgICAgICBlbHNlIGlm\nICghKGlzTmV3KCkgJiYgIWlzRmx1c2hlZCgpKQoJCQkJJiYgKEltcGxIZWxw\nZXIuZ2V0VXBkYXRlRmllbGRzKHRoaXMpICE9IG51bGwpKQogICAgICAgICAg\nICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9S\nRV9VUERBVEUpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19QUkVfRkxV\nU0hFRDsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoIWxvZ2ljYWwpCiAgICAgICAgICAgICAgICBh\nc3NpZ25PYmplY3RJZChmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwLCBsZW4gPSBfbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGg7IGkg\nPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgaWYgKChsb2dpY2FsIHx8\nICFhc3NpZ25GaWVsZChpLCB0cnVlKSkgJiYgIV9mbHVzaC5nZXQoaSkKICAg\nICAgICAgICAgICAgICAgICAmJiBfZGlydHkuZ2V0KGkpKSB7CiAgICAgICAg\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKF9zaW5nbGUucHJlRmx1c2gobG9naWNh\nbCwgY2FsbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVs\nZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBkaXJ0\neUNoZWNrKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBj\nYWxsYmFja3MgZm9yIGRlbGV0aW9uLgogICAgICovCiAgICB2b2lkIHByZURl\nbGV0ZSgpIHsKICAgICAgICAvLyBzZXQgYSBmbGFnIHdoaWxlIGNhbGwgcHJl\nIGRlbGV0ZSBjYWxsYmFjayBzbyB0aGF0IHVzZXIgY2FuJ3QKICAgICAgICAv\nLyBnZXQgaW50byBpbmZpbml0ZSByZWN1cnNpb24gYnkgY2FsbGluZyBkZWxl\ndGUodGhpcykKICAgICAgICAvLyB3aXRoaW4gaGlzIGNhbGxiYWNrIG1ldGhv\nZAogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVfREVMRVRJTkcpID09\nIDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJFX0RFTEVUSU5H\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmlyZUxpZmVj\neWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ERUxFVEUpOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX1BSRV9ERUxFVElORzsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENhc2NhZGUgZGVsZXRlcyBhbmQgZGVy\nZWZlcmVuY2UgZGVwZW5kZW50IGZpZWxkcy4KICAgICAqLwogICAgdm9pZCBj\nYXNjYWRlRGVsZXRlKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoZm1kc1tpXS5nZXRDYXNjYWRlRGVsZXRlKCkgIT0gVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX05PTkUKICAgICAgICAgICAgICAgIHx8IGZt\nZHNbaV0uZ2V0S2V5KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAg\nICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORQogICAgICAgICAg\nICAgICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0\nZSgpCiAgICAgICAgICAgICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nTk9ORSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVjdEZp\nZWxkKGksIGZldGNoRmllbGQoaSwgZmFsc2UpKTsKICAgICAgICAgICAgICAg\nIF9zaW5nbGUuZGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgX3Npbmds\nZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQ2FsbGVkIGFmdGVyIGFuIGluc3RhbmNlIGlzIHBlcnNp\nc3RlZCBieSBhIHVzZXIgdGhyb3VnaCB0aGUgYnJva2VyLgogICAgICogQ2Fz\nY2FkZXMgdGhlIHBlcnNpc3Qgb3BlcmF0aW9uIHRvIGZpZWxkcyBtYXJrZWQK\nICAgICAqIHtAbGluayBWYWx1ZU1ldGFEYXRhI0NBU0NBREVfSU1NRURJQVRF\nfS4KICAgICAqLwogICAgdm9pZCBjYXNjYWRlUGVyc2lzdChPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdl\ndChpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\naWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZVBlcnNpc3QoKSA9PSBWYWx1ZU1ldGFE\nYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBmbWRz\nW2ldLmdldEtleSgpLmdldENhc2NhZGVQZXJzaXN0KCkKICAgICAgICAgICAg\nICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUKICAgICAg\nICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2NhZGVQ\nZXJzaXN0KCkKICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FT\nQ0FERV9JTU1FRElBVEUpIHsKICAgICAgICAgICAgICAgIF9zaW5nbGUuc3Rv\ncmVPYmplY3RGaWVsZChpLCBmZXRjaEZpZWxkKGksIGZhbHNlKSk7CiAgICAg\nICAgICAgICAgICBfc2luZ2xlLnBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAg\nICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBmaWVsZCBz\nZXQgZnJvbSB0aGUgZGF0YSBzdG9yZSBpbnRvIHRoZSBpbnN0YW5jZS4KICAg\nICAqIFJldHVybiB0cnVlIGlmIGFueSBkYXRhIGlzIGxvYWRlZCwgZmFsc2Ug\nb3RoZXJ3aXNlLgogICAgICovCiAgICBib29sZWFuIGxvYWRGaWVsZHMoQml0\nU2V0IGZpZWxkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgbG9j\na0xldmVsLAogICAgICAgIE9iamVjdCBzZGF0YSkgewogICAgICAgIC8vIGNh\nbid0IGxvYWQgdmVyc2lvbiBmaWVsZCBmcm9tIHN0b3JlCiAgICAgICAgaWYg\nKGZpZWxkcyAhPSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEg\ndmZpZWxkID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAgICAg\nIGlmICh2ZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZpZWxkcy5j\nbGVhcih2ZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAgfQoKICAgICAgICBi\nb29sZWFuIHJldCA9IGZhbHNlOwogICAgICAgIHNldExvYWRpbmcodHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgYW55IGZpZWxkcyBn\naXZlbiwgbG9hZCB0aGVtCiAgICAgICAgICAgIGludCBsZW4gPSAoZmllbGRz\nID09IG51bGwpID8gMCA6IGZpZWxkcy5sZW5ndGgoKTsKICAgICAgICAgICAg\naWYgKGxlbiA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChmZXRjaCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGZldGNoID0gX2Jyb2tlci5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgICAgIGlmICghX2Jy\nb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5sb2FkKHRoaXMsIGZpZWxkcywgZmV0\nY2gsCiAgICAgICAgICAgICAgICAgICAgbG9ja0xldmVsLCBzZGF0YSkpIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb24oX2xvYy5nZXQoImRlbC1pbnN0YW5jZSIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgX29pZCkp\nLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0\nTWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gbWFrZSBzdXJlIHZlcnNpb24gaW5mb3JtYXRpb24gaGFzIGJlZW4g\nc2V0OyB2ZXJzaW9uIGluZm8gbXVzdAogICAgICAgICAgICAvLyBhbHdheXMg\nYmUgc2V0IGFmdGVyIHRoZSBmaXJzdCBzdGF0ZSBsb2FkIG9yIHNldCAod2hp\nY2ggaXMgd2h5CiAgICAgICAgICAgIC8vIHdlIGRvIHRoaXMgZXZlbiBpZiBu\nbyBmaWVsZHMgd2VyZSBsb2FkZWQgLS0gY291bGQgYmUgdGhhdCB0aGlzCiAg\nICAgICAgICAgIC8vIG1ldGhvZCBpcyBiZWluZyBjYWxsZWQgYWZ0ZXIgYSBm\naWVsZCBpcyBzZXQpLi4uIHNvbWUgaW5zdGFuY2VzCiAgICAgICAgICAgIC8v\nIG1pZ2h0IG5vdCBoYXZlIHZlcnNpb24gaW5mbywgaW4gd2hpY2ggY2FzZSB0\naGlzIGdldHMgY2FsbGVkCiAgICAgICAgICAgIC8vIG11dGlwbGUgdGltZXM7\nIHRoYXQgc2hvdWxkIGJlIG9rIHRvbwogICAgICAgICAgICBpZiAoX2xvYWRW\nZXJzaW9uID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHN5bmNWZXJzaW9u\nKHNkYXRhKTsKICAgICAgICAgICAgICAgIHJldCA9IHJldCB8fCBfbG9hZFZl\ncnNpb24gIT0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBmaW5hbGx5IHsKICAgICAgICAgICAgc2V0TG9hZGluZyhmYWxzZSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBzZWUgaWYgdGhlIGRmZyBpcyBub3cgbG9h\nZGVkOyBkbyB0aGlzIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB3ZQogICAgICAg\nIC8vIGxvYWRlZCBhbnkgZmllbGRzLCBjYXVzZSBtYXkgYWxyZWFkeSBoYXZl\nIGJlZW4gbG9hZGVkIGJ5CiAgICAgICAgLy8gU3RvcmVNYW5hZ2VyIGR1cmlu\nZyBpbml0aWFsaXphdGlvbgogICAgICAgIHBvc3RMb2FkKC0xLCBmZXRjaCk7\nCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKioKICAgICAqIExv\nYWQgdGhlIGdpdmVuIGZpZWxkJ3MgZmV0Y2ggZ3JvdXA7IHRoZSBmaWVsZCBp\ndHNlbGYgbWF5IGFscmVhZHkgYmUKICAgICAqIGxvYWRlZCBpZiBpdCBpcyBi\nZWluZyBzZXQgYnkgdGhlIHVzZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGxvYWRGaWVsZChpbnQgZmllbGQsIGludCBsb2NrTGV2ZWwsIGJvb2xl\nYW4gZm9yV3JpdGUsCiAgICAgICAgYm9vbGVhbiBmZ3MpIHsKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29u\nZmlndXJhdGlvbigpOwogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21l\ndGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIEJpdFNldCBmaWVsZHMgPSBu\ndWxsOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgZGZnIGZpZWxkIG9yIHdl\nIG5lZWQgdG8gbG9hZCBvdXIgZGZnLCBkbyBzbwogICAgICAgIGlmIChmZ3Mg\nJiYgKF9mbGFncyAmIEZMQUdfTE9BREVEKSA9PSAwKQogICAgICAgICAgICBm\naWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywg\nbnVsbCk7CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgZm9yIGxvYWQgZmV0\nY2ggZ3JvdXAKICAgICAgICBTdHJpbmcgbGZnID0gZm1kLmdldExvYWRGZXRj\naEdyb3VwKCk7CiAgICAgICAgYm9vbGVhbiBsZmdBZGRlZCA9IGZhbHNlOwog\nICAgICAgIGlmIChsZmcgIT0gbnVsbCkgeyAgCiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChpKSAmJiAoaSA9PSBm\naWVsZAogICAgICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0uaXNJbkZldGNo\nR3JvdXAobGZnKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGRz\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5l\ndyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGZp\nZWxkcy5zZXQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIHJlbGF0aW9uIGZpZWxkIGlzIGxvYWRlZCB3aXRo\nIHRoZSBsb2FkLWZldGNoLWdyb3VwCiAgICAgICAgICAgIC8vIGJ1dCB0aGlz\nIGFkZGl0aW9uIG11c3QgYmUgcmV2ZXJ0ZWQgb25jZSB0aGUgbG9hZCBpcyBv\ndmVyCiAgICAgICAgICAgIGlmICghZmV0Y2guaGFzRmV0Y2hHcm91cChsZmcp\nKSB7CiAgICAgICAgICAgICAgICBmZXRjaC5hZGRGZXRjaEdyb3VwKGxmZyk7\nCiAgICAgICAgICAgICAgICBsZmdBZGRlZCA9IHRydWU7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgaWYgKGZtZC5pc0luRGVmYXVsdEZldGNoR3Jv\ndXAoKSAmJiBmaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBubyBs\nb2FkIGdyb3VwIGJ1dCBkZmc6IGFkZCBkZmcgZmllbGRzIGlmIHdlIGhhdmVu\nJ3QgYWxyZWFkeQogICAgICAgICAgICBmaWVsZHMgPSBnZXRVbmxvYWRlZElu\ndGVybmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7CiAgICAgICAgfSBlbHNl\nIGlmICghX2xvYWRlZC5nZXQoZm1kLmdldEluZGV4KCkpKSB7CiAgICAgICAg\nICAgIC8vIG5vIGxvYWQgZ3JvdXAgb3IgZGZnOiBsb2FkIGluZGl2aWR1YWwg\nZmllbGQKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgZmllbGRzID0gbmV3IEJpdFNldCgpOwogICAgICAgICAgICBm\naWVsZHMuc2V0KGZtZC5nZXRJbmRleCgpKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGNhbGwgdGhpcyBtZXRob2QgZXZlbiBpZiB0aGVyZSBhcmUgbm8gdW5s\nb2FkZWQgZmllbGRzOyBsb2FkRmllbGRzCiAgICAgICAgLy8gdGFrZXMgY2Fy\nZSBvZiB0aGluZ3MgbGlrZSBsb2FkaW5nIHZlcnNpb24gaW5mbyBhbmQgc2V0\ndGluZyBQQyBmbGFncwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvYWRG\naWVsZHMoZmllbGRzLCBmZXRjaCwgbG9ja0xldmVsLCBudWxsKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAobGZnQWRkZWQpCiAgICAg\nICAgICAgICAgICBmZXRjaC5yZW1vdmVGZXRjaEdyb3VwKGxmZyk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBw\ncm92aWRlIHRoZSBnaXZlbiBmaWVsZCBudW1iZXIgdG8gdGhlIGdpdmVuCiAg\nICAgKiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAgICB2b2lkIHByb3ZpZGVG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIEZpZWxkTWFuYWdlciBzdG9y\nZSwgaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNYW5hZ2VyIGJlZm9yZUZN\nID0gX2ZtOwogICAgICAgIF9mbSA9IHN0b3JlOwogICAgICAgIHBjLnBjUHJv\ndmlkZUZpZWxkKGZpZWxkKTsKICAgICAgICAvLyBSZXRhaW5pbmcgb3JpZ2lu\nYWwgRk0gYmVjYXVzZSBvZiB0aGUgcG9zc2liaWxpdHkgb2YgcmVlbnRyYW50\nIGNhbGxzCiAgICAgICAgaWYgKGJlZm9yZUZNICE9IG51bGwpIF9mbSA9IGJl\nZm9yZUZNOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0\nbyByZXBsYWNlIHRoZSBnaXZlbiBmaWVsZCBudW1iZXIgdG8gdGhlIGdpdmVu\nCiAgICAgKiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAgICB2b2lkIHJlcGxh\nY2VGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIEZpZWxkTWFuYWdlciBs\nb2FkLCBpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1hbmFnZXIgYmVmb3Jl\nRk0gPSBfZm07CiAgICAgICAgX2ZtID0gbG9hZDsKICAgICAgICBwYy5wY1Jl\ncGxhY2VGaWVsZChmaWVsZCk7CiAgICAgICAgLy8gUmV0YWluaW5nIG9yaWdp\nbmFsIEZNIGJlY2F1c2Ugb2YgdGhlIHBvc3NpYmlsaXR5IG9mIHJlZW50cmFu\ndCBjYWxscwogICAgICAgIGlmIChiZWZvcmVGTSAhPSBudWxsKSBfZm0gPSBi\nZWZvcmVGTTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhlIGZpZWxk\nIGFzIGxvYWRlZCBvciB1bmxvYWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHNldExvYWRlZChpbnQgZmllbGQsIGJvb2xlYW4gaXNMb2FkZWQpIHsK\nICAgICAgICAvLyBkb24ndCBjb250aW51ZSBpZiBsb2FkZWQgc3RhdGUgaXMg\nYWxyZWFkeSBjb3JyZWN0OyBvdGhlcndpc2Ugd2UKICAgICAgICAvLyBjYW4g\nZW5kIHVwIGNsZWFyaW5nIF9maWVsZEltcGwgd2hlbiB3ZSBzaG91bGRuJ3QK\nICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpID09IGlzTG9hZGVkKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIGxvYWRpbmcsIGNs\nZWFyIGludGVybWVkaWF0ZSBkYXRhOyBpZiB1bmxvYWRpbmcsIGNsZWFyIGlt\ncGwgZGF0YQogICAgICAgIGlmIChfZmllbGRJbXBsICE9IG51bGwpIHsKICAg\nICAgICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5k\nZXgoZmllbGQpOwogICAgICAgICAgICBpZiAoaWR4ICE9IC0xKQogICAgICAg\nICAgICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gbnVsbDsKICAgICAgICB9Cgog\nICAgICAgIGlmIChpc0xvYWRlZCkKICAgICAgICAgICAgX2xvYWRlZC5zZXQo\nZmllbGQpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2xvYWRlZC5jbGVh\ncihmaWVsZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHBvc3Qt\nbG9hZCBzdGVwcywgaW5jbHVkaW5nIHRoZSBwb3N0IGxvYWQgY2FsbGJhY2su\nCiAgICAgKiBXZSBoYXZlIHRvIGNoZWNrIHRoZSBkZmcgYWZ0ZXIgYWxsIGZp\nZWxkIGxvYWRzIGJlY2F1c2UgaXQgbWlnaHQgYmUKICAgICAqIGxvYWRlZCBp\nbiBtdWx0aXBsZSBzdGVwcyB3aGVuIHBhZ2luZyBpcyBpbnZvbHZlZDsgdGhl\nIGluaXRpYWwgbG9hZAogICAgICogbWlnaHQgZXhjbHVkZSBzb21lIGZpZWxk\ncyB3aGljaCBhcmUgdGhlbiBpbW1lZGlhdGVseSBsb2FkZWQgaW4gYQogICAg\nICogc2VwYXJhdGUgc3RlcCBiZWZvcmUgYmVpbmcgcmV0dXJuZWQgdG8gdGhl\nIHVzZXIuCiAgICAgKgogICAgICogQHBhcmFtIGZpZWxkIHRoZSBmaWVsZCBp\nbmRleCB0aGF0IHdhcyBsb2FkZWQsIG9yIC0xIHRvIGluZGljYXRlCiAgICAg\nKiB0aGF0IGEgZ3JvdXAgb2YgcG9zc2libHkgdW5rbm93biBmaWVsZHMgd2Fz\nIGxvYWRlZAogICAgICovCiAgICBwcml2YXRlIHZvaWQgcG9zdExvYWQoaW50\nIGZpZWxkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICAv\nLyBubyBuZWVkIGZvciBwb3N0TG9hZCBjYWxsYmFjaz8KICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfTE9BREVEKSAhPSAwKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGluIHRoZSBtaWRkbGUgb2YgYSBncm91cCBsb2Fk\nLCBhZnRlciB3aGljaCB0aGlzIG1ldGhvZCB3aWxsIGJlCiAgICAgICAgLy8g\nY2FsbGVkIGFnYWluPwogICAgICAgIGlmIChmaWVsZCAhPSAtMSAmJiBpc0xv\nYWRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBubyBs\naXN0ZW5lcnM/CiAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyIG1nciA9\nIF9icm9rZXIuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5hZ2VyKCk7CiAgICAgICAg\naWYgKG1nciA9PSBudWxsIHx8ICFtZ3IuaGFzTG9hZExpc3RlbmVycyhnZXRN\nYW5hZ2VkSW5zdGFuY2UoKSwgX21ldGEpKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRj\naCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAg\nLy8gaXMgdGhpcyBmaWVsZCBhIHBvc3QtbG9hZCBmaWVsZD8KICAgICAgICBp\nZiAoZmllbGQgIT0gLTEpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGlmIChm\nbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAgICAgICAm\nJiBmZXRjaC5oYXNGZXRjaEdyb3VwKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxU\nKQogICAgICAgICAgICAgICAgJiYgcG9zdExvYWQoRmV0Y2hHcm91cC5OQU1F\nX0RFRkFVTFQsIGZldGNoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgU3RyaW5nW10gZmdzID0gZm1kLmdldEN1c3RvbUZldGNoR3Jv\ndXBzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmdzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZldGNoLmhhc0ZldGNo\nR3JvdXAoZmdzW2ldKSAmJiBwb3N0TG9hZChmZ3NbaV0sIGZldGNoKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBmZXRjaC5nZXRGZXRjaEdy\nb3VwcygpLml0ZXJhdG9yKCk7IAogICAgICAgICAgICAgICAgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIGlmIChwb3N0TG9hZCgoU3RyaW5n\nKSBpdHIubmV4dCgpLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUGVyZm9ybSBwb3N0LWxvYWQgYWN0aW9ucyBpZiB0aGUgZ2l2ZW4g\nZmV0Y2ggZ3JvdXAgaXMgYSBwb3N0LWxvYWQgZ3JvdXAKICAgICAqIGFuZCBp\ncyBmdWxseSBsb2FkZWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBw\nb3N0TG9hZChTdHJpbmcgZmdOYW1lLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gX21ldGEuZ2V0RmV0Y2hH\ncm91cChmZ05hbWUpOwogICAgICAgIGlmIChmZyA9PSBudWxsIHx8ICFmZy5p\nc1Bvc3RMb2FkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkgJiYgZm1kc1tpXS5p\nc0luRmV0Y2hHcm91cChmZ05hbWUpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICAg\nICAgX2Jyb2tlci5maXJlTGlmZWN5Y2xlRXZlbnQoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCksIGZldGNoLCBfbWV0YSwgCiAgICAgICAgCUxpZmVjeWNsZUV2ZW50\nLkFGVEVSX0xPQUQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIC8qKgogICAgICogU3luY2hyb25pemUgb3VyIHZlcnNpb24gb2JqZWN0IHdp\ndGggdGhlIGRhdGFzdG9yZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHN5bmNWZXJzaW9uKE9iamVjdCBzZGF0YSkgewogICAgICAgIHJldHVybiBf\nYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLnN5bmNWZXJzaW9uKHRoaXMsIHNk\nYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0\naGlzIGluc3RhbmNlIG5lZWRzIGEgdmVyc2lvbiBjaGVjay4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uQ2hlY2tSZXF1aXJlZCgpIHsK\nICAgICAgICAvLyBleHBsaWNpdCBmbGFnIGZvciB2ZXJzaW9uIGNoZWNrCiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1ZFUlNJT05fQ0hFQ0spICE9IDAp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBpZiAoIV9icm9r\nZXIuZ2V0T3B0aW1pc3RpYygpICYmICFfYnJva2VyLmdldENvbmZpZ3VyYXRp\nb24oKS4KICAgICAgICAgICAgZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCku\nZ2V0Tm9uT3B0aW1pc3RpY1ZlcnNpb25DaGVjaygpKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1ZlcnNpb25D\naGVja1JlcXVpcmVkKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHdoZXRoZXIgdGhpcyBpbnN0YW5jZSByZXF1aXJlcyBhIHZlcnNpb24gY2hl\nY2sgb24gdGhlIG5leHQgZmx1c2guCiAgICAgKi8KICAgIHZvaWQgc2V0Q2hl\nY2tWZXJzaW9uKGJvb2xlYW4gdmVyc2lvbkNoZWNrKSB7CiAgICAgICAgaWYg\nKHZlcnNpb25DaGVjaykKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfVkVS\nU0lPTl9DSEVDSzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19WRVJTSU9OX0NIRUNLOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgbmVlZHMgYSB2ZXJzaW9u\nIHVwZGF0ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9u\nVXBkYXRlUmVxdWlyZWQoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBG\nTEFHX1ZFUlNJT05fVVBEQVRFKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgd2hldGhlciB0aGlzIGluc3RhbmNlIHJlcXVpcmVzIGEgdmVyc2lv\nbiB1cGRhdGUgb24gdGhlIG5leHQgZmx1c2guCiAgICAgKi8KICAgIHZvaWQg\nc2V0VXBkYXRlVmVyc2lvbihib29sZWFuIHZlcnNpb25VcGRhdGUpIHsKICAg\nICAgICBpZiAodmVyc2lvblVwZGF0ZSkKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfVkVSU0lPTl9VUERBVEU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9VUERBVEU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUcmFuc2xhdGUgdGhlIGdpdmVuIGV4Y2VwdGlvbiBiYXNl\nZCBvbiB0aGUgYnJva2VyJ3MgaW1wbGljaXQgYmVoYXZpb3IuCiAgICAgKiBU\ncmFuc2xhdGlvbiBvbmx5IG9jY3VycyBpZiB0aGUgZXhjZXB0aW9uIGlzIGlu\naXRpYXRlZCBieSBhIHVzZXIgYWN0aW9uCiAgICAgKiBvbiBhbiBpbnN0YW5j\nZSwgYW5kIHRoZXJlZm9yZSB3aWxsIG5vdCBiZSBjYXVnaHQgYW5kIHRyYW5z\nbGF0ZWQgYnkgdGhlCiAgICAgKiBicm9rZXIuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBSdW50aW1lRXhjZXB0aW9uIHRyYW5zbGF0ZShSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3Ig\ndHJhbnMgPSBfYnJva2VyLgogICAgICAgICAgICBnZXRJbnN0YW5jZUV4Y2Vw\ndGlvblRyYW5zbGF0b3IoKTsKICAgICAgICByZXR1cm4gKHRyYW5zID09IG51\nbGwpID8gcmUgOiB0cmFucy50cmFuc2xhdGUocmUpOwogICAgfQoKICAgIC8q\nKgogICAgICogTG9jayB0aGUgc3RhdGUgbWFuYWdlciBpZiB0aGUgbXVsdGl0\naHJlYWRlZCBvcHRpb24gaXMgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBsb2NrKCkgewogICAgICAgIGlmIChfaW5zdGFuY2VMb2NrICE9IG51\nbGwpCiAgICAgICAgCV9pbnN0YW5jZUxvY2subG9jaygpOwogICAgfQoKICAg\nIC8qKgogICAgICogVW5sb2NrIHRoZSBzdGF0ZSBtYW5hZ2VyLgogICAgICov\nCglwcm90ZWN0ZWQgdm9pZCB1bmxvY2sgKCkgewogICAgICAgIGlmIChfaW5z\ndGFuY2VMb2NrICE9IG51bGwpCiAgICAgICAgCV9pbnN0YW5jZUxvY2sudW5s\nb2NrKCk7Cgl9CgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0KE9iamVj\ndE91dHB1dFN0cmVhbSBvb3MpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgb29zLndyaXRlT2JqZWN0KF9icm9rZXIpOwogICAgICAgIG9vcy5kZWZh\ndWx0V3JpdGVPYmplY3QoKTsKICAgICAgICBvb3Mud3JpdGVPYmplY3QoX21l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICB3cml0ZVBDKG9vcywg\nX3BjKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIDxjb2RlPnBjPC9j\nb2RlPiB0byA8Y29kZT5vb3M8L2NvZGU+LCBoYW5kbGluZyBpbnRlcm5hbC1m\nb3JtCiAgICAgKiBzZXJpYWxpemF0aW9uLiA8Y29kZT5wYzwvY29kZT4gbXVz\ndCBiZSBvZiB0aGUgc2FtZSB0eXBlIHRoYXQgdGhpcwogICAgICogc3RhdGUg\nbWFuYWdlciBtYW5hZ2VzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAog\nICAgICovCiAgICB2b2lkIHdyaXRlUEMoT2JqZWN0T3V0cHV0U3RyZWFtIG9v\ncywgUGVyc2lzdGVuY2VDYXBhYmxlIHBjKQogICAgICAgIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKCFTZXJpYWxpemFibGUuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTm90U2VyaWFsaXphYmxlRXhjZXB0aW9uKAog\nICAgICAgICAgICAgICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5h\nbWUoKSk7CgogICAgICAgIG9vcy53cml0ZU9iamVjdChwYyk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIHJlYWRPYmplY3QoT2JqZWN0SW5wdXRTdHJlYW0g\naW4pCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uIHsKICAgICAgICBfYnJva2VyID0gKEJyb2tlckltcGwpIGlu\nLnJlYWRPYmplY3QoKTsKICAgICAgICBpbi5kZWZhdWx0UmVhZE9iamVjdCgp\nOwoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHN0b3JlIHRoZSBjbGFzcyBiZWZv\ncmUgdGhlIHBjIGluc3RhbmNlIHNvIHRoYXQgd2UgY2FuCiAgICAgICAgLy8g\nY3JlYXRlIF9tZXRhIGJlZm9yZSBjYWxsaW5nIHJlYWRQQygpLCB3aGljaCBy\nZWxpZXMgb24gX21ldGEgYmVpbmcKICAgICAgICAvLyBub24tbnVsbCB3aGVu\nIHJlY29uc3RpdHV0aW5nIFJlZmxlY3RpbmdQQyBpbnN0YW5jZXMuIFNhZGx5\nLCB0aGlzCiAgICAgICAgLy8gcGVuYWxpemVzIHRoZSBzZXJpYWxpemF0aW9u\nIGZvb3RwcmludCBvZiBub24tUmVmbGVjdGluZ1BDIFNNcyBhbHNvLgogICAg\nICAgIENsYXNzIG1hbmFnZWRUeXBlID0gKENsYXNzKSBpbi5yZWFkT2JqZWN0\nKCk7CiAgICAgICAgX21ldGEgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24o\nKS5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpCiAgICAgICAgICAg\nIC5nZXRNZXRhRGF0YShtYW5hZ2VkVHlwZSwgbnVsbCwgdHJ1ZSk7CgogICAg\nICAgIF9wYyA9IHJlYWRQQyhpbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZXJ0cyB0aGUgZGVzZXJpYWxpemVkIDxjb2RlPm88L2NvZGU+IHRvIGEg\ne0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZX0KICAgICAqIGluc3RhbmNlIGFw\ncHJvcHJpYXRlIGZvciBzdG9yaW5nIGluIDxjb2RlPl9wYzwvY29kZT4uCiAg\nICAgKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSByZWFkUEMoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAg\nICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIElPRXhjZXB0aW9u\nIHsKICAgICAgICBPYmplY3QgbyA9IGluLnJlYWRPYmplY3QoKTsKCiAgICAg\nICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYzsKICAgICAgICBpZiAoIShv\nIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKSkKICAgICAgICAgICAg\ncGMgPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG8sIHRoaXMp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcGMgPSAoUGVyc2lzdGVuY2VD\nYXBhYmxlKSBvOwoKICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIo\ndGhpcyk7CiAgICAgICAgcmV0dXJuIHBjOwogICAgfQogICAgCiAgICBwdWJs\naWMgTGlzdCBnZXRNYXBwZWRCeUlkRmllbGRzKCkgewogICAgICAgIHJldHVy\nbiBfbWFwcGVkQnlJZEZpZWxkczsKICAgIH0KfQo=\n","encoding":"base64"}

