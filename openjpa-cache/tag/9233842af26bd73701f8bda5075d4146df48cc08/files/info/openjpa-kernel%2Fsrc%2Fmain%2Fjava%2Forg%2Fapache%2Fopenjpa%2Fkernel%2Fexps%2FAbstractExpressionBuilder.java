{"sha":"f64bc7bea8a79dacefa7e9284ce62171a8515472","node_id":"MDQ6QmxvYjIwNjM2NDpmNjRiYzdiZWE4YTc5ZGFjZWZhN2U5Mjg0Y2U2MjE3MWE4NTE1NDcy","size":19250,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f64bc7bea8a79dacefa7e9284ce62171a8515472","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHM7CgppbXBv\ncnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZh\nLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nRmlsdGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlhNTE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQWJzdHJhY3QgYmFzZSBj\nbGFzcyB0byBoZWxwIGJ1aWxkIGV4cHJlc3Npb25zLiBQcm92aWRlcwogKiBn\nZW5lcmljIGxhbmd1YWdlLWluZGVwZW5kZW50IHN1cHBvcnQgZm9yIHZhcmlh\nYmxlIHJlc29sdXRpb24sCiAqIHBhdGggdHJhdmVyc2FsLCBhbmQgZXJyb3Ig\nbWVzc2FnZXMuCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAq\nIEBub2phdmFkb2MKICovCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFj\ndEV4cHJlc3Npb25CdWlsZGVyIHsKCiAgICAvLyB1c2VkIGZvciBlcnJvciBt\nZXNzYWdlcwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRVhfVVNF\nUiA9IDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBFWF9GQVRB\nTCA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBFWF9VTlNV\nUFBPUlRFRCA9IDI7CgogICAgLy8gY29tbW9uIGltcGxpY2l0IHR5cGUgc2V0\ndGluZ3MKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgQ2xhc3M8T2JqZWN0PiBU\nWVBFX09CSkVDVCA9IE9iamVjdC5jbGFzczsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgQ2xhc3M8U3RyaW5nPiBUWVBFX1NUUklORyA9IFN0cmluZy5jbGFz\nczsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgQ2xhc3M8Q2hhcmFjdGVyPiBU\nWVBFX0NIQVJfT0JKID0gQ2hhcmFjdGVyLmNsYXNzOwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBDbGFzczxOdW1iZXI+IFRZUEVfTlVNQkVSID0gTnVtYmVy\nLmNsYXNzOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBDbGFzczxDb2xsZWN0\naW9uPiBUWVBFX0NPTExFQ1RJT04gPSBDb2xsZWN0aW9uLmNsYXNzOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBDbGFzczxNYXA+IFRZUEVfTUFQID0gTWFw\nLmNsYXNzOwoKICAgIC8vIGNvbnRhaW5zIHR5cGVzIGZvciBzZXRJbXBsaWNp\ndFR5cGVzCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDT05UQUlOU19U\nWVBFX0VMRU1FTlQgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nQ09OVEFJTlNfVFlQRV9LRVkgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgQ09OVEFJTlNfVFlQRV9WQUxVRSA9IDM7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyLmNsYXNz\nKTsKCiAgICBwcm90ZWN0ZWQgZmluYWwgUmVzb2x2ZXIgcmVzb2x2ZXI7CiAg\nICBwcm90ZWN0ZWQgRXhwcmVzc2lvbkZhY3RvcnkgZmFjdG9yeTsKCiAgICBw\ncml2YXRlIGZpbmFsIFNldDxDbGFzc01ldGFEYXRhPiBfYWNjZXNzUGF0aCA9\nIG5ldyBIYXNoU2V0PENsYXNzTWV0YURhdGE+KCk7CiAgICBwcml2YXRlIE1h\ncDxTdHJpbmcsVmFsdWU+IF9zZWVuVmFycyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldDxWYWx1ZT4gX2JvdW5kVmFycyA9IG51bGw7CgogICAgLyoqCiAgICAg\nKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBAcGFyYW0gZmFjdG9yeSB0\naGUgZXhwcmVzc2lvbiBmYWN0b3J5IHRvIHVzZQogICAgICogQHBhcmFtIHJl\nc29sdmVyIHVzZWQgdG8gcmVzb2x2ZSB2YXJpYWJsZXMsIHBhcmFtZXRlcnMs\nIGFuZCBjbGFzcwogICAgICogbmFtZXMgdXNlZCBpbiB0aGUgcXVlcnkKICAg\nICAqLwogICAgcHVibGljIEFic3RyYWN0RXhwcmVzc2lvbkJ1aWxkZXIoRXhw\ncmVzc2lvbkZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBSZXNvbHZlciByZXNv\nbHZlcikgewogICAgICAgIHRoaXMuZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICAg\nICAgdGhpcy5yZXNvbHZlciA9IHJlc29sdmVyOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyB0aGUgY2xhc3MgbG9hZGVyIHRoYXQgc2hvdWxkIGJl\nIHVzZWQgZm9yIHJlc29sdmluZwogICAgICogY2xhc3MgbmFtZXMgKGluIGFk\nZGl0aW9uIHRvIHRoZSByZXNvbHZlciBpbiB0aGUgcXVlcnkpLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgQ2xhc3NMb2FkZXIgZ2V0Q2xhc3NM\nb2FkZXIoKTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIHByb3BlciBwYXJz\nZSBleGNlcHRpb24gZm9yIHRoZSBnaXZlbiByZWFzb24uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBPcGVuSlBBRXhjZXB0aW9uIHBhcnNlRXhjZXB0aW9uKGlu\ndCBlLCBTdHJpbmcgdG9rZW4sCiAgICAgICAgT2JqZWN0W10gYXJncywKICAg\nICAgICBFeGNlcHRpb24gbmVzdCkgewogICAgICAgIFN0cmluZyBhcmdTdHI7\nCiAgICAgICAgaWYgKGFyZ3MgPT0gbnVsbCkKICAgICAgICAgICAgYXJnU3Ry\nID0gZ2V0TG9jYWxpemVyKCkuZ2V0KHRva2VuKS5nZXRNZXNzYWdlKCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBhcmdTdHIgPSBnZXRMb2NhbGl6ZXIo\nKS5nZXQodG9rZW4sIGFyZ3MpLmdldE1lc3NhZ2UoKTsKCiAgICAgICAgTWVz\nc2FnZSBtc2cgPSBfbG9jLmdldCgicGFyc2UtZXJyb3IiLCBhcmdTdHIsIGN1\ncnJlbnRRdWVyeSgpKTsKCiAgICAgICAgc3dpdGNoIChlKSB7CiAgICAgICAg\nICAgIGNhc2UgRVhfRkFUQUw6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24obXNnLCBuZXN0KTsKICAgICAgICAgICAgY2Fz\nZSBFWF9VTlNVUFBPUlRFRDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihtc2csIG5lc3QpOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24obXNnLCBuZXN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWdpc3RlciB0aGUgc3BlY2lmaWVkIG1ldGFkYXRhIGFzIGJlaW5nIGlu\nIHRoZSBxdWVyeSdzIGFjY2VzcyBwYXRoLgogICAgICovCiAgICBwcm90ZWN0\nZWQgQ2xhc3NNZXRhRGF0YSBhZGRBY2Nlc3NQYXRoKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIF9hY2Nlc3NQYXRoLmFkZChtZXRhKTsKICAgICAg\nICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgcmVjb3JkZWQgcXVlcnkgYWNjZXNzIHBhdGguCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBDbGFzc01ldGFEYXRhW10gZ2V0QWNjZXNzUGF0aCgpIHsKICAg\nICAgICByZXR1cm4gKENsYXNzTWV0YURhdGFbXSkgX2FjY2Vzc1BhdGgudG9B\ncnJheQogICAgICAgICAgICAobmV3IENsYXNzTWV0YURhdGFbX2FjY2Vzc1Bh\ndGguc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1\nZSBpZiB0aGUgZ2l2ZW4gdmFyaWFibGUgaGFzIGJlZW4gYm91bmQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzQm91bmQoVmFsdWUgdmFyKSB7\nCiAgICAgICAgcmV0dXJuIF9ib3VuZFZhcnMgIT0gbnVsbCAmJiBfYm91bmRW\nYXJzLmNvbnRhaW5zKHZhcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNv\ncmQgdGhhdCB0aGUgZ2l2ZW4gdmFyaWFibGUgaXMgYm91bmQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGJpbmQoVmFsdWUgdmFyKSB7CiAgICAgICAg\naWYgKF9ib3VuZFZhcnMgPT0gbnVsbCkKICAgICAgICAgICAgX2JvdW5kVmFy\ncyA9IG5ldyBIYXNoU2V0PFZhbHVlPigpOwogICAgICAgIF9ib3VuZFZhcnMu\nYWRkKHZhcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgdmFs\ndWUgZm9yIHRoZSBnaXZlbiBpZC4KICAgICAqLwogICAgcHJvdGVjdGVkIFZh\nbHVlIGdldFZhcmlhYmxlKFN0cmluZyBpZCwgYm9vbGVhbiBiaW5kKSB7CiAg\nICAgICAgLy8gY2hlY2sgZm9yIGFscmVhZHkgY29uc3RydWN0ZWQgdmFyCiAg\nICAgICAgaWYgKGlzU2VlblZhcmlhYmxlKGlkKSkKICAgICAgICAgICAgcmV0\ndXJuIGdldFZhcmlhYmxlKGlkKTsKCiAgICAgICAgcmV0dXJuIGNyZWF0ZVZh\ncmlhYmxlKGlkLCBiaW5kKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgVmFsdWUg\nY3JlYXRlVmFyaWFibGUoU3RyaW5nIGlkLCBib29sZWFuIGJpbmQpIHsKICAg\nICAgICAvLyBjcmVhdGUgYW5kIGNhY2hlIHZhcgogICAgICAgIENsYXNzPD8+\nIHR5cGUgPSBnZXREZWNsYXJlZFZhcmlhYmxlVHlwZShpZCk7CgogICAgICAg\nIC8vIGFkZCB0aGlzIHR5cGUgdG8gdGhlIHNldCBvZiBjbGFzc2VzIGluIHRo\nZSBmaWx0ZXIncyBhY2Nlc3MgcGF0aAogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IG51bGw7CiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAgICAg\nICAgICAgdHlwZSA9IFRZUEVfT0JKRUNUOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgbWV0YSA9IGdldE1ldGFEYXRhKHR5cGUsIGZhbHNlKTsKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIGFkZEFjY2Vzc1Bh\ndGgobWV0YSk7CiAgICAgICAgICAgIGFkZFNjaGVtYVRvQ29udGV4dChpZCwg\nbWV0YSk7CiAgICAgICAgfQoKICAgICAgICBWYWx1ZSB2YXIgPSBudWxsOwog\nICAgICAgIGlmIChiaW5kKQogICAgICAgICAgICB2YXIgPSBmYWN0b3J5Lm5l\nd0JvdW5kVmFyaWFibGUoaWQsIHR5cGUpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgdmFyID0gZmFjdG9yeS5uZXdVbmJvdW5kVmFyaWFibGUoaWQsIHR5\ncGUpOwogICAgICAgIHZhci5zZXRNZXRhRGF0YShtZXRhKTsKCiAgICAgICAg\naWYgKF9zZWVuVmFycyA9PSBudWxsKQogICAgICAgICAgICBfc2VlblZhcnMg\nPSBuZXcgSGFzaE1hcDxTdHJpbmcsVmFsdWU+KCk7CiAgICAgICAgX3NlZW5W\nYXJzLnB1dChpZCwgdmFyKTsKCiAgICAgICAgYWRkVmFyaWFibGVUb0NvbnRl\neHQoaWQsIHZhcik7CiAgICAgICAgcmV0dXJuIHZhcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFZhbGlkYXRlIHRoYXQgYWxsIHVuYm91bmQgdmFyaWFibGVz\nIGFyZSBvZiBhIFBDIHR5cGUuIElmIG5vdCwgYXNzdW1lCiAgICAgKiB0aGF0\nIHRoZSB1c2VyIGFjdHVhbGx5IG1hZGUgYSB0eXBvIHRoYXQgd2UgdG9vayBm\nb3IgYW4gaW1wbGljaXQKICAgICAqIHVuYm91bmQgdmFyaWFibGUuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGFzc2VydFVuYm91bmRWYXJpYWJsZXNW\nYWxpZCgpIHsKICAgICAgICBpZiAoX3NlZW5WYXJzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWUgdmFyOwogICAgICAgIGZv\nciAoTWFwLkVudHJ5PFN0cmluZyxWYWx1ZT4gZW50cnkgOiBfc2VlblZhcnMu\nZW50cnlTZXQoKSkgewogICAgICAgICAgICB2YXIgPSBlbnRyeS5nZXRWYWx1\nZSgpOwogICAgICAgICAgICBpZiAodmFyLmdldE1ldGFEYXRhKCkgPT0gbnVs\nbCAmJiAhaXNCb3VuZCh2YXIpCiAgICAgICAgICAgICAgICAmJiAhaXNEZWNs\nYXJlZFZhcmlhYmxlKGVudHJ5LmdldEtleSgpKSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC11bmJvdW5k\nLXZhciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBlbnRy\neS5nZXRLZXkoKSB9LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgc3Bl\nY2lmaWVkIHZhcmlhYmxlIG5hbWUgaGFzIGJlZW4gZXhwbGljaXRseQogICAg\nICogZGVjbGFyZWQuIE5vdGUgYWxsIHF1ZXJ5IGxhbmd1YWdlcyBuZWNlc3Nh\ncmlseSBzdXBwb3J0IGRlY2xhcmluZwogICAgICogdmFyaWFibGVzLgogICAg\nICoKICAgICAqIEBwYXJhbSBpZCB0aGUgdmFyaWFibGUgdG8gY2hlY2sKICAg\nICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdmFyaWFiZSBoYXMgYmVlbiBleHBs\naWNpdGVseSBkZWNsYXJlZAogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJh\nY3QgYm9vbGVhbiBpc0RlY2xhcmVkVmFyaWFibGUoU3RyaW5nIGlkKTsKCiAg\nICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBpZCBoYXMg\nYmVlbiB1c2VkIGFzIGEgdmFyaWFibGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzU2VlblZhcmlhYmxlKFN0cmluZyBpZCkgewogICAgICAg\nIHJldHVybiBfc2VlblZhcnMgIT0gbnVsbCAmJiBfc2VlblZhcnMuY29udGFp\nbnNLZXkoaWQpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIGdldCBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRh\nKENsYXNzPD8+IGMsIGJvb2xlYW4gcmVxdWlyZWQpIHsKICAgICAgICByZXR1\ncm4gZ2V0TWV0YURhdGEoYywgcmVxdWlyZWQsIGdldENsYXNzTG9hZGVyKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRv\nIGdldCBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKENsYXNzPD8+\nIGMsIGJvb2xlYW4gcmVxdWlyZWQsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgcmV0dXJuIHJlc29sdmVyLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAg\nICAgICBnZXRNZXRhRGF0YShjLCBsb2FkZXIsIHJlcXVpcmVkKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRyYXZlcnNlIHRoZSBnaXZlbiBmaWVsZCBpbiB0\naGUgZ2l2ZW4gcGF0aC4KICAgICAqLwogICAgcHJvdGVjdGVkIFZhbHVlIHRy\nYXZlcnNlUGF0aChQYXRoIHBhdGgsIFN0cmluZyBmaWVsZCkgewogICAgICAg\nIHJldHVybiB0cmF2ZXJzZVBhdGgocGF0aCwgZmllbGQsIGZhbHNlLCBmYWxz\nZSk7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBWYWx1ZSB0cmF2ZXJzZVhQ\nYXRoKFBhdGggcGF0aCwgU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgWE1MTWV0\nYURhdGEgbWV0YSA9IHBhdGguZ2V0WG1sTWFwcGluZygpOwogICAgICAgIGlm\nIChtZXRhLmdldEZpZWxkTWFwcGluZyhmaWVsZCkgPT0gbnVsbCkgewogICAg\nICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8tZmll\nbGQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbWV0YS5n\nZXRUeXBlKCksIGZpZWxkIH0sIG51bGwpOwogICAgICAgIH0KICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgLy8gY29sbGVjdGlvbi12YWx1ZWQgeHBhdGgg\naXMgbm90IGFsbG93ZWQKICAgICAgICAgICAgaW50IHR5cGUgPSBtZXRhLmdl\ndEZpZWxkTWFwcGluZyhmaWVsZCkuZ2V0VHlwZUNvZGUoKTsKICAgICAgICAg\nICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNP\nTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImNvbGxlY3Rpb24tdmFsdWVkLXBhdGgiLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmllbGQpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBwYXRoLmdldChtZXRhLCBmaWVsZCk7CiAgICAgICAg\ncmV0dXJuIHBhdGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmF2ZXJzZSB0\naGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVuIHBhdGguCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBWYWx1ZSB0cmF2ZXJzZVBhdGgoUGF0aCBwYXRoLCBTdHJp\nbmcgZmllbGQsIGJvb2xlYW4gcGNPbmx5LAogICAgICAgIGJvb2xlYW4gYWxs\nb3dOdWxsKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcGF0aC5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJwYXRoLW5v\nLW1ldGEiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBmaWVsZCwg\ncGF0aC5nZXRUeXBlKCkgfSwgbnVsbCk7CgogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSB0cmF2ZXJz\nZVN0YXRpY0ZpZWxkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBmaWVsZCk7\nCiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAgICAgICAgICAJ\nU3RyaW5nW10gYWxsID0gbWV0YS5nZXRGaWVsZE5hbWVzKCk7CiAgICAgICAg\nICAgIAlDbGFzczw/PiBjbHMgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsK\nICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIs\nICJuby1maWVsZCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\nIHtmaWVsZCwgY2xzLmdldFNpbXBsZU5hbWUoKSwgCiAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0ZWluRGlz\ndGFuY2UoZmllbGQsIGFsbCksIAogICAgICAgICAgICAgICAgCWNscy5nZXRO\nYW1lKCksIEFycmF5cy50b1N0cmluZyhhbGwpfSwgbnVsbCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwo\ndmFsLCBMaXRlcmFsLlRZUEVfVU5LTk9XTik7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoZm1kLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgbWV0YSA9IGZt\nZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBtZXRhID0gZm1kLmdldERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7CiAg\nICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICBhZGRBY2Nl\nc3NQYXRoKG1ldGEpOwogICAgICAgICAgICBwYXRoLnNldE1ldGFEYXRhKG1l\ndGEpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8g\neG1sc3VwcG9ydCB4cGF0aAogICAgICAgICAgICBYTUxNZXRhRGF0YSB4bWxt\nZXRhID0gZm1kLmdldFJlcG9zaXRvcnkoKS5nZXRYTUxNZXRhRGF0YShmbWQp\nOwogICAgICAgICAgICBpZiAoeG1sbWV0YSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBwYXRoLmdldChmbWQsIHhtbG1ldGEpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHBhdGg7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGlmIChtZXRhICE9IG51bGwgfHwgIXBjT25seSkgCiAgICAgICAgICAg\nIHBhdGguZ2V0KGZtZCwgYWxsb3dOdWxsKTsKCiAgICAgICAgcmV0dXJuIHBh\ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBjb25zdGFudCBj\nb250YWluaW5nIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gc3RhdGljIGZpZWxk\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRyYXZlcnNlU3RhdGlj\nRmllbGQoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgZmllbGQpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gY2xzLmdldEZpZWxkKGZpZWxkKS5n\nZXQobnVsbCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgLy8gY291bnQgbm90IGxvY2F0ZSB0aGUgZmllbGQ6IHJldHVy\nbiBudWxsCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHR5cGUgb2YgdGhlIG5h\nbWVkIHZhcmlhYmxlIGlmIGl0IGhhcyBiZWVuIGRlY2xhcmVkLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgQ2xhc3M8Pz4gZ2V0RGVjbGFyZWRW\nYXJpYWJsZVR5cGUoU3RyaW5nIG5hbWUpOwoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBpbXBsaWNpdCB0eXBlcyBvZiB0aGUgZ2l2ZW4gdmFsdWVzIGJhc2Vk\nIG9uIHRoZSBmYWN0IHRoYXQKICAgICAqIHRoZXkncmUgdXNlZCB0b2dldGhl\nciwgYW5kIGJhc2VkIG9uIHRoZSBvcGVyYXRvciB0eXBlLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBzZXRJbXBsaWNpdFR5cGVzKFZhbHVlIHZhbDEs\nIFZhbHVlIHZhbDIsCiAgICAgICAgQ2xhc3M8Pz4gZXhwZWN0ZWQpIHsKICAg\nICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIGV4cGVjdGVkLCBy\nZXNvbHZlcik7CiAgICB9CiAgICBwcm90ZWN0ZWQgc3RhdGljIHZvaWQgc2V0\nSW1wbGljaXRUeXBlcyhWYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyLAogICAgICAg\nIENsYXNzPD8+IGV4cGVjdGVkLCBSZXNvbHZlciByZXNvbHZlcikgewogICAg\nICAgIENsYXNzPD8+IGMxID0gdmFsMS5nZXRUeXBlKCk7CiAgICAgICAgQ2xh\nc3M8Pz4gYzIgPSB2YWwyLmdldFR5cGUoKTsKICAgICAgICBib29sZWFuIG8x\nID0gYzEgPT0gVFlQRV9PQkpFQ1Q7CiAgICAgICAgYm9vbGVhbiBvMiA9IGMy\nID09IFRZUEVfT0JKRUNUOwoKICAgICAgICBpZiAobzEgJiYgIW8yKSB7CiAg\nICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKGMyKTsKICAgICAgICAg\nICAgaWYgKHZhbDEuZ2V0TWV0YURhdGEoKSA9PSBudWxsICYmICF2YWwxLmlz\nWFBhdGgoKSkKICAgICAgICAgICAgICAgIHZhbDEuc2V0TWV0YURhdGEodmFs\nMi5nZXRNZXRhRGF0YSgpKTsKICAgICAgICB9IGVsc2UgaWYgKCFvMSAmJiBv\nMikgewogICAgICAgICAgICB2YWwyLnNldEltcGxpY2l0VHlwZShjMSk7CiAg\nICAgICAgICAgIGlmICh2YWwyLmdldE1ldGFEYXRhKCkgPT0gbnVsbCAmJiAh\ndmFsMS5pc1hQYXRoKCkpCiAgICAgICAgICAgICAgICB2YWwyLnNldE1ldGFE\nYXRhKHZhbDEuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgfSBlbHNlIGlmIChv\nMSAmJiBvMiAmJiBleHBlY3RlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIC8v\nIHdlIG5ldmVyIGV4cGVjdCBhIHBjIHR5cGUsIHNvIGRvbid0IGJvdGhlciB3\naXRoIG1ldGFkYXRhCiAgICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBl\nKGV4cGVjdGVkKTsKICAgICAgICAgICAgdmFsMi5zZXRJbXBsaWNpdFR5cGUo\nZXhwZWN0ZWQpOwogICAgICAgIH0gZWxzZSBpZiAoaXNOdW1lcmljKHZhbDEu\nZ2V0VHlwZSgpKSAhPSBpc051bWVyaWModmFsMi5nZXRUeXBlKCkpKSB7CiAg\nICAgICAgICAgIGlmIChyZXNvbHZlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0\nQ29tcGF0aWJpbGl0eUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRR\ndW90ZWROdW1iZXJzSW5RdWVyaWVzKCkpCiAgICAgICAgICAgICAgICBjb252\nZXJ0VHlwZXNRdW90ZWROdW1iZXJzKHZhbDEsIHZhbDIpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBjb252ZXJ0VHlwZXModmFsMSwgdmFs\nMik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBj\nb252ZXJzaW9ucyB0byBtYWtlIHZhbHVlcyBjb21wYXRpYmxlLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY29udmVydFR5cGVzKFZhbHVlIHZh\nbDEsIFZhbHVlIHZhbDIpIHsKICAgICAgICBDbGFzczw/PiB0MSA9IHZhbDEu\nZ2V0VHlwZSgpOwogICAgICAgIENsYXNzPD8+IHQyID0gdmFsMi5nZXRUeXBl\nKCk7CgogICAgICAgIC8vIGFsbG93IHN0cmluZy10by1jaGFyIGNvbnZlcnNp\nb25zCiAgICAgICAgaWYgKHQxID09IFRZUEVfU1RSSU5HICYmIChGaWx0ZXJz\nLndyYXAodDIpID09IFRZUEVfQ0hBUl9PQkoKICAgICAgICAgICAgJiYgISh2\nYWwyIGluc3RhbmNlb2YgUGF0aCkpKSB7CiAgICAgICAgICAgIHZhbDIuc2V0\nSW1wbGljaXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CiAgICAgICAgaWYgKHQyID09IFRZUEVfU1RSSU5HICYm\nIChGaWx0ZXJzLndyYXAodDEpID09IFRZUEVfQ0hBUl9PQkopCiAgICAgICAg\nICAgICYmICEodmFsMSBpbnN0YW5jZW9mIFBhdGgpKSB7CiAgICAgICAgICAg\nIHZhbDEuc2V0SW1wbGljaXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoZSBub24t\nbnVtZXJpYyBzaWRlIGlzIGEgc3RyaW5nIG9mIGxlbmd0aCAxLCBjYXN0IGl0\nCiAgICAgICAgLy8gdG8gYSBjaGFyYWN0ZXIKICAgICAgICBpZiAodDEgPT0g\nVFlQRV9TVFJJTkcgJiYgdmFsMSBpbnN0YW5jZW9mIExpdGVyYWwKICAgICAg\nICAgICAgJiYgKChTdHJpbmcpICgoTGl0ZXJhbCkgdmFsMSkuZ2V0VmFsdWUo\nKSkubGVuZ3RoKCkgPT0gMSkgewogICAgICAgICAgICB2YWwxLnNldEltcGxp\nY2l0VHlwZShDaGFyYWN0ZXIuY2xhc3MpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQogICAgICAgIGlmICh0MiA9PSBUWVBFX1NUUklORyAmJiB2\nYWwyIGluc3RhbmNlb2YgTGl0ZXJhbAogICAgICAgICAgICAmJiAoKFN0cmlu\nZykgKChMaXRlcmFsKSB2YWwyKS5nZXRWYWx1ZSgpKS5sZW5ndGgoKSA9PSAx\nKSB7CiAgICAgICAgICAgIHZhbDIuc2V0SW1wbGljaXRUeXBlKENoYXJhY3Rl\nci5jbGFzcyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIC8vIGVycm9yCiAgICAgICAgU3RyaW5nIGxlZnQ7CiAgICAgICAgU3Ry\naW5nIHJpZ2h0OwogICAgICAgIGlmICh2YWwxIGluc3RhbmNlb2YgUGF0aCAm\nJiAoKFBhdGgpIHZhbDEpLmxhc3QoKSAhPSBudWxsKQogICAgICAgICAgICBs\nZWZ0ID0gX2xvYy5nZXQoIm5vbi1udW1lcmljLXBhdGgiLCAoKFBhdGgpIHZh\nbDEpLmxhc3QoKS4KICAgICAgICAgICAgICAgIGdldE5hbWUoKSwgdDEuZ2V0\nTmFtZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBsZWZ0ID0gX2xvYy5nZXQoIm5vbi1udW1lcmljLXZhbHVlIiwgdDEuZ2V0\nTmFtZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgaWYgKHZhbDIgaW5zdGFu\nY2VvZiBQYXRoICYmICgoUGF0aCkgdmFsMikubGFzdCgpICE9IG51bGwpCiAg\nICAgICAgICAgIHJpZ2h0ID0gX2xvYy5nZXQoIm5vbi1udW1lcmljLXBhdGgi\nLCAoKFBhdGgpIHZhbDIpLmxhc3QoKS4KICAgICAgICAgICAgICAgIGdldE5h\nbWUoKSwgdDIuZ2V0TmFtZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICByaWdodCA9IF9sb2MuZ2V0KCJub24tbnVtZXJpYy12\nYWx1ZSIsIHQyLmdldE5hbWUoKSkuZ2V0TWVzc2FnZSgpOwogICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub24tbnVtZXJpYy1j\nb21wYXJpc29uIiwKICAgICAgICAgICAgbGVmdCwgcmlnaHQpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBlcmZvcm0gY29udmVyc2lvbnMgdG8gbWFrZSB2\nYWx1ZXMgY29tcGF0aWJsZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2\nb2lkIGNvbnZlcnRUeXBlc1F1b3RlZE51bWJlcnMoVmFsdWUgdmFsMSwgVmFs\ndWUgdmFsMikgewogICAgICAgIENsYXNzPD8+IHQxID0gdmFsMS5nZXRUeXBl\nKCk7CiAgICAgICAgQ2xhc3M8Pz4gdDIgPSB2YWwyLmdldFR5cGUoKTsKCiAg\nICAgICAgLy8gaWYgd2UncmUgY29tcGFyaW5nIHRvIGEgc2luZ2xlLXF1b3Rl\nZCBzdHJpbmcsIGNvbnZlcnQKICAgICAgICAvLyB0aGUgdmFsdWUgYWNjb3Jk\naW5nIHRvIHRoZSAzLjEgcnVsZXMuCiAgICAgICAgaWYgKHQxID09IFRZUEVf\nU1RSSU5HICYmIHZhbDEgaW5zdGFuY2VvZiBMaXRlcmFsCiAgICAgICAgICAg\nICYmICgoTGl0ZXJhbCkgdmFsMSkuZ2V0UGFyc2VUeXBlKCkgPT0gTGl0ZXJh\nbC5UWVBFX1NRX1NUUklORykgewogICAgICAgICAgICBTdHJpbmcgcyA9IChT\ndHJpbmcpICgoTGl0ZXJhbCkgdmFsMSkuZ2V0VmFsdWUoKTsKICAgICAgICAg\nICAgaWYgKHMubGVuZ3RoKCkgPiAxKSB7CiAgICAgICAgICAgICAgICAoKExp\ndGVyYWwpIHZhbDEpLnNldFZhbHVlKHMuc3Vic3RyaW5nKDAsIDEpKTsKICAg\nICAgICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKENoYXJhY3Rlci5U\nWVBFKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodDIg\nPT0gVFlQRV9TVFJJTkcgJiYgdmFsMiBpbnN0YW5jZW9mIExpdGVyYWwKICAg\nICAgICAgICAgJiYgKChMaXRlcmFsKSB2YWwyKS5nZXRQYXJzZVR5cGUoKSA9\nPSBMaXRlcmFsLlRZUEVfU1FfU1RSSU5HKSB7CiAgICAgICAgICAgIFN0cmlu\nZyBzID0gKFN0cmluZykgKChMaXRlcmFsKSB2YWwyKS5nZXRWYWx1ZSgpOwog\nICAgICAgICAgICBpZiAocy5sZW5ndGgoKSA+IDEpIHsKICAgICAgICAgICAg\nICAgICgoTGl0ZXJhbCkgdmFsMikuc2V0VmFsdWUocy5zdWJzdHJpbmcoMCwg\nMSkpOwogICAgICAgICAgICAgICAgdmFsMi5zZXRJbXBsaWNpdFR5cGUoQ2hh\ncmFjdGVyLlRZUEUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyBpZiB3ZSdyZSBjb21wYXJpbmcgdG8gYSBkb3VibGUtcXVvdGVkIHN0\ncmluZywgY29udmVydCB0aGUKICAgICAgICAvLyB2YWx1ZSBkaXJlY3RseSB0\nbyBhIG51bWJlcgogICAgICAgIGlmICh0MSA9PSBUWVBFX1NUUklORyAmJiB2\nYWwxIGluc3RhbmNlb2YgTGl0ZXJhbAogICAgICAgICAgICAmJiAoKExpdGVy\nYWwpIHZhbDEpLmdldFBhcnNlVHlwZSgpID09IExpdGVyYWwuVFlQRV9TVFJJ\nTkcpIHsKICAgICAgICAgICAgU3RyaW5nIHMgPSAoU3RyaW5nKSAoKExpdGVy\nYWwpIHZhbDEpLmdldFZhbHVlKCk7CiAgICAgICAgICAgICgoTGl0ZXJhbCkg\ndmFsMSkuc2V0VmFsdWUoU3RyaW5ncy5wYXJzZShzLCBGaWx0ZXJzLndyYXAo\ndDIpKSk7CiAgICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKHQyKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKHQyID09IFRZUEVfU1RSSU5HICYmIHZh\nbDIgaW5zdGFuY2VvZiBMaXRlcmFsCiAgICAgICAgICAgICYmICgoTGl0ZXJh\nbCkgdmFsMikuZ2V0UGFyc2VUeXBlKCkgPT0gTGl0ZXJhbC5UWVBFX1NUUklO\nRykgewogICAgICAgICAgICBTdHJpbmcgcyA9IChTdHJpbmcpICgoTGl0ZXJh\nbCkgdmFsMikuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgKChMaXRlcmFsKSB2\nYWwyKS5zZXRWYWx1ZShTdHJpbmdzLnBhcnNlKHMsIEZpbHRlcnMud3JhcCh0\nMSkpKTsKICAgICAgICAgICAgdmFsMi5zZXRJbXBsaWNpdFR5cGUodDEpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlm\nIGdpdmVuIGNsYXNzIGNhbiBiZSB1c2VkIGFzIGEgbnVtYmVyLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gaXNOdW1lcmljKENsYXNzPD8+\nIHR5cGUpIHsKICAgICAgICB0eXBlID0gRmlsdGVycy53cmFwKHR5cGUpOwog\nICAgICAgIHJldHVybiBOdW1iZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0\neXBlKQogICAgICAgICAgICB8fCB0eXBlID09IENoYXJhY3Rlci5UWVBFIHx8\nIHR5cGUgPT0gVFlQRV9DSEFSX09CSjsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgaW1wbGljaXQgdHlwZXMgb2YgdGhlIGdpdmVuIHZhbHVlcyBi\nYXNlZCBvbiB0aGUgZmFjdCB0aGF0CiAgICAgKiB0aGUgZmlyc3QgaXMgc3Vw\ncG9zZWQgdG8gY29udGFpbiB0aGUgc2Vjb25kLgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBzZXRJbXBsaWNpdENvbnRhaW5zVHlwZXMoVmFsdWUgdmFs\nMSwgVmFsdWUgdmFsMiwgaW50IG9wKSB7CiAgICAgICAgaWYgKHZhbDEuZ2V0\nVHlwZSgpID09IFRZUEVfT0JKRUNUKSB7CiAgICAgICAgICAgIGlmIChvcCA9\nPSBDT05UQUlOU19UWVBFX0VMRU1FTlQpCiAgICAgICAgICAgICAgICB2YWwx\nLnNldEltcGxpY2l0VHlwZShDb2xsZWN0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgdmFsMS5zZXRJbXBsaWNpdFR5cGUo\nTWFwLmNsYXNzKTsKICAgICAgICB9CgogICAgICAgIGlmICh2YWwyLmdldFR5\ncGUoKSA9PSBUWVBFX09CSkVDVCAmJiB2YWwxIGluc3RhbmNlb2YgUGF0aCkg\newogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9ICgoUGF0aCkgdmFs\nMSkubGFzdCgpOwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAg\nICAgICAgICAgIGlmIChmbWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\naWYgKG9wID09IENPTlRBSU5TX1RZUEVfRUxFTUVOVCB8fCBvcCA9PSBDT05U\nQUlOU19UWVBFX1ZBTFVFKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsMi5z\nZXRJbXBsaWNpdFR5cGUoZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5\ncGUoKSk7CiAgICAgICAgICAgICAgICAgICAgbWV0YSA9IGZtZC5nZXRFbGVt\nZW50KCkuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAobWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHZhbDIuc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGFkZEFjY2Vzc1BhdGgobWV0YSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICB2YWwyLnNldEltcGxpY2l0VHlwZShmbWQuZ2V0S2V5KCkuZ2V0\nRGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIG1ldGEgPSBm\nbWQuZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAobWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHZhbDIuc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGFkZEFjY2Vzc1BhdGgobWV0YSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBpbXBs\naWNpdCB0eXBlIG9mIHRoZSBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gY2xh\nc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgdm9pZCBzZXRJbXBs\naWNpdFR5cGUoVmFsdWUgdmFsLCBDbGFzczw/PiBleHBlY3RlZCkgewogICAg\nICAgIC8vIHdlIG5ldmVyIGV4cGVjdCBhIHBjIHR5cGUsIHNvIG5vIG5lZWQg\ndG8gd29ycnkgYWJvdXQgbWV0YWRhdGEKICAgICAgICBpZiAodmFsLmdldFR5\ncGUoKSA9PSBUWVBFX09CSkVDVCkKICAgICAgICAgICAgdmFsLnNldEltcGxp\nY2l0VHlwZShleHBlY3RlZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2Vk\nIGZvciBvYnRhaW5pbmcgdGhlIHtAbGluayBMb2NhbGl6ZXJ9IHRvIHVzZSBm\nb3IgdHJhbnNsYXRpbmcKICAgICAqIGVycm9yIG1lc3NhZ2VzLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgTG9jYWxpemVyIGdldExvY2FsaXpl\ncigpOwoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY3VycmVudCBzdHJp\nbmcgYmVpbmcgcGFyc2VkOyB1c2VkIGZvciBlcnJvciBtZXNzYWdlcy4KCSAq\nLwoJcHJvdGVjdGVkIGFic3RyYWN0IFN0cmluZyBjdXJyZW50UXVlcnkgKCk7\nCgogICAgLyoqCiAgICAgKiBSZWdpc3RlciB0aGUgc2NoZW1hIGFsaWFzIHRv\nIHRoZSBjdXJyZW50IEpQUUwgcXVlcnkgY29udGV4dC4KICAgICAqIEBwYXJh\nbSBhbGlhcwogICAgICogQHBhcmFtIG1ldGEKICAgICAqLwogICAgcHJvdGVj\ndGVkIGFic3RyYWN0IHZvaWQgYWRkU2NoZW1hVG9Db250ZXh0KFN0cmluZyBh\nbGlhcywKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEpOwoKICAgIC8qKgog\nICAgICogUmVnaXN0ZXIgdGhlIHZhcmlhYmxlIGFzc29jaWF0ZWQgd2l0aCB0\naGUgc2NoZW1hIGFsaWFzIChpZCkgdG8KICAgICAqIHRoZSBjdXJyZW50IEpQ\nUUwgcXVlcnkgY29udGV4dC4KICAgICAqIEBwYXJhbSBpZAogICAgICogQHBh\ncmFtIHZhcgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCBh\nZGRWYXJpYWJsZVRvQ29udGV4dChTdHJpbmcgaWQsIFZhbHVlIHZhcik7Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2YXJpYWJsZSBhc3NvY2lhdGVk\nIHdpdGggdGhlIHNjaGVtYSBhbGlhcyAoaWQpLgogICAgICogQHBhcmFtIGlk\nCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCBWYWx1ZSBnZXRWYXJpYWJsZShTdHJpbmcgaWQpOwp9Cgo=\n","encoding":"base64"}

