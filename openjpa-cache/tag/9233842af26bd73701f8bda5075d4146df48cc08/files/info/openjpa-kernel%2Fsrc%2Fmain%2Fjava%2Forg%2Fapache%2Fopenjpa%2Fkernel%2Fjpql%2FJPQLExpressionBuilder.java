{"sha":"0a1284bbf8daafe28e3a00a98b99ab6951d9e3db","node_id":"MDQ6QmxvYjIwNjM2NDowYTEyODRiYmY4ZGFhZmUyOGUzYTAwYTk4Yjk5YWI2OTUxZDllM2Ri","size":86109,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0a1284bbf8daafe28e3a00a98b99ab6951d9e3db","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7Cmlt\ncG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuQ29tcGF0aWJpbGl0eTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9r\nZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5F\neHByZXNzaW9uU3RvcmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuRmlsbFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5RdWVyeUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLlF1ZXJ5T3BlcmF0aW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUmVzdWx0U2hhcGU7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BYnN0cmFjdEV4cHJlc3Npb25C\ndWlsZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBz\nLkNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4\ncHMuRXhwcmVzc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5FeHByZXNzaW9uRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuZXhwcy5MaXRlcmFsOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhcmFtZXRlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXRoOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlF1ZXJ5RXhwcmVzc2lvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUmVzb2x2ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuU3VicXVl\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFs\ndWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5N\nZXNzYWdlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxk\nTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZh\nVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0\nYVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJz\nOwoKLyoqCiAqIEJ1aWxkZXIgZm9yIEpQUUwgZXhwcmVzc2lvbnMuIFRoaXMg\nY2xhc3MgdGFrZXMgdGhlIHF1ZXJ5IHBhcnNlZAogKiBpbiB7QGxpbmsgSlBR\nTH0gYW5kIGNvbnZlcnRzIGl0IHRvIGFuIGV4cHJlc3Npb24gdHJlZSB1c2lu\nZwogKiBhbiB7QGxpbmsgRXhwcmVzc2lvbkZhY3Rvcnl9LiBQdWJsaWMgZm9y\nIHVuaXQgdGVzdGluZyBwdXJwb3Nlcy4KICoKICogQGF1dGhvciBNYXJjIFBy\ndWQnaG9tbWVhdXgKICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkKICogQG5v\namF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpQUUxFeHByZXNzaW9uQnVpbGRl\ncgogICAgZXh0ZW5kcyBBYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyCiAgICBp\nbXBsZW1lbnRzIEpQUUxUcmVlQ29uc3RhbnRzIHsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgVkFSX1BBVEggPSAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFZBUl9FUlJPUiA9IDI7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChKUFFMRXhwcmVzc2lvbkJ1aWxkZXIuY2xhc3MpOwoKICAg\nIHByaXZhdGUgZmluYWwgU3RhY2s8Q29udGV4dD4gY29udGV4dHMgPSBuZXcg\nU3RhY2s8Q29udGV4dD4oKTsKICAgIHByaXZhdGUgTGlua2VkTWFwIHBhcmFt\nZXRlclR5cGVzOwogICAgcHJpdmF0ZSBpbnQgYWxpYXNDb3VudCA9IDA7CiAg\nICBwcml2YXRlIGJvb2xlYW4gaW5Bc3NpZ25TdWJzZWxlY3RQcm9qZWN0aW9u\nID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZmFjdG9yeSB0aGUgZXhwcmVzc2lvbiBmYWN0b3J5\nIHRvIHVzZQogICAgICogQHBhcmFtIHF1ZXJ5IHVzZWQgdG8gcmVzb2x2ZSB2\nYXJpYWJsZXMsIHBhcmFtZXRlcnMsCiAgICAgKiBhbmQgY2xhc3MgbmFtZXMg\ndXNlZCBpbiB0aGUgcXVlcnkKICAgICAqIEBwYXJhbSBwYXJzZWRRdWVyeSB0\naGUgcGFyc2VkIHF1ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyBKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXIoRXhwcmVzc2lvbkZhY3RvcnkgZmFjdG9yeSwKICAgICAg\nICBFeHByZXNzaW9uU3RvcmVRdWVyeSBxdWVyeSwgT2JqZWN0IHBhcnNlZFF1\nZXJ5KSB7CiAgICAgICAgc3VwZXIoZmFjdG9yeSwgcXVlcnkuZ2V0UmVzb2x2\nZXIoKSk7CgogICAgICAgIGNvbnRleHRzLnB1c2gobmV3IENvbnRleHQocGFy\nc2VkUXVlcnkgaW5zdGFuY2VvZiBQYXJzZWRKUFFMCiAgICAgICAgICAgID8g\nKFBhcnNlZEpQUUwpIHBhcnNlZFF1ZXJ5CiAgICAgICAgICAgIDogcGFyc2Vk\nUXVlcnkgaW5zdGFuY2VvZiBTdHJpbmcKICAgICAgICAgICAgPyBnZXRQYXJz\nZWRRdWVyeSgoU3RyaW5nKSBwYXJzZWRRdWVyeSkKICAgICAgICAgICAgOiBu\ndWxsLCBudWxsLCBudWxsKSk7CgogICAgICAgIGlmIChjdHgoKS5wYXJzZWQg\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKHBhcnNlZFF1ZXJ5ICsgIiIpOwogICAgfQoKICAgIHByb3RlY3RlZCBM\nb2NhbGl6ZXIgZ2V0TG9jYWxpemVyKCkgewogICAgICAgIHJldHVybiBfbG9j\nOwogICAgfQoKICAgIHByb3RlY3RlZCBDbGFzc0xvYWRlciBnZXRDbGFzc0xv\nYWRlcigpIHsKICAgICAgICAvLyB3ZSBkb24ndCByZXNvbHZlIGluIHRoZSBj\nb250ZXh0IG9mIGFueXRoaW5nIGJ1dCBvdXJzZWx2ZXMKICAgICAgICByZXR1\ncm4gZ2V0Q2xhc3MoKS5nZXRDbGFzc0xvYWRlcigpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCBQYXJzZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KCkgewogICAgICAg\nIHJldHVybiBjdHgoKS5wYXJzZWQ7CiAgICB9CgogICAgcHJvdGVjdGVkIFBh\ncnNlZEpQUUwgZ2V0UGFyc2VkUXVlcnkoU3RyaW5nIGpwcWwpIHsKICAgICAg\nICByZXR1cm4gbmV3IFBhcnNlZEpQUUwoanBxbCk7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIHNldENhbmRpZGF0ZShDbGFzc01ldGFEYXRhIGNtZCwgU3Ry\naW5nIHNjaGVtYUFsaWFzKSB7CiAgICAgICAgYWRkQWNjZXNzUGF0aChjbWQp\nOwoKICAgICAgICBpZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgIGN0eCgp\nLm1ldGEgPSBjbWQ7CgogICAgICAgIGlmIChzY2hlbWFBbGlhcyAhPSBudWxs\nKQogICAgICAgICAgICBjdHgoKS5zY2hlbWFBbGlhcyA9IHNjaGVtYUFsaWFz\nOwogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIG5leHRBbGlhcygpIHsKICAg\nICAgICByZXR1cm4gImpwcWxhbGlhcyIgKyAoKythbGlhc0NvdW50KTsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YSByZXNvbHZlQ2xhc3NN\nZXRhRGF0YShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgLy8gaGFuZGxlIGxv\nb2tpbmcgdXAgYWxpYXMgbmFtZXMKICAgICAgICBTdHJpbmcgc2NoZW1hTmFt\nZSA9IGFzc2VydFNjaGVtYU5hbWUobm9kZSk7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBjbWQgPSBnZXRDbGFzc01ldGFEYXRhKHNjaGVtYU5hbWUsIGZhbHNl\nKTsKICAgICAgICBpZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBjbWQ7CgogICAgICAgIC8vIHdlIG1pZ2h0IGJlIHJlZmVyZW5jaW5nIGEg\nY29sbGVjdGlvbiBmaWVsZCBvZiBhIHN1YnF1ZXJ5J3MgcGFyZW50CiAgICAg\nICAgaWYgKGlzUGF0aChub2RlKSkgewogICAgICAgICAgICBQYXRoIHBhdGgg\nPSBnZXRQYXRoKG5vZGUpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IHBhdGgubGFzdCgpOwogICAgICAgICAgICBjbWQgPSBnZXRGaWVsZFR5\ncGUoZm1kKTsKICAgICAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGZtZC5p\nc0VsZW1lbnRDb2xsZWN0aW9uKCkpCiAgICAgICAgICAgICAgICBjbWQgPSBm\nbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpOwogICAgICAgICAgICByZXR1cm4g\nY21kOwogICAgICAgIH0KCiAgICAgICAgLy8gbm93IHJ1biBhZ2FpbiB0byB0\naHJvdyB0aGUgY29ycmVjdCBleGNlcHRpb24KICAgICAgICByZXR1cm4gZ2V0\nQ2xhc3NNZXRhRGF0YShzY2hlbWFOYW1lLCB0cnVlKTsKICAgIH0KCiAgICBw\ncml2YXRlIENsYXNzTWV0YURhdGEgZ2V0Q2xhc3NNZXRhRGF0YShTdHJpbmcg\nYWxpYXMsIGJvb2xlYW4gYXNzZXJ0VmFsaWQpIHsKICAgICAgICBDbGFzc0xv\nYWRlciBsb2FkZXIgPSBnZXRDbGFzc0xvYWRlcigpOwogICAgICAgIE1ldGFE\nYXRhUmVwb3NpdG9yeSByZXBvcyA9IHJlc29sdmVyLmdldENvbmZpZ3VyYXRp\nb24oKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFu\nY2UoKTsKCiAgICAgICAgLy8gZmlyc3QgY2hlY2sgZm9yIHRoZSBhbGlhcwog\nICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gcmVwb3MuZ2V0TWV0YURhdGEo\nYWxpYXMsIGxvYWRlciwgZmFsc2UpOwoKICAgICAgICBpZiAoY21kICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBjbWQ7CgogICAgICAgIC8vIG5vdyBj\naGVjayBmb3IgdGhlIGNsYXNzIG5hbWU7IHRoaXMgaXMgbm90IHRlY2huaWNh\nbGx5IHBlcm1pdHRlZAogICAgICAgIC8vIGJ5IHRoZSBKUEEgc3BlYywgYnV0\nIGlzIHJlcXVpcmVkIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gZXhlY3V0ZQog\nICAgICAgIC8vIEpQUUwgcXVlcmllcyBmcm9tIG90aGVyIGZhY2FkZXMgKGxp\na2UgSkRPKSB0aGF0IGRvIG5vdCBoYXZlCiAgICAgICAgLy8gdGhlIGNvbmNl\ncHQgb2YgZW50aXR5IG5hbWVzIG9yIGFsaWFzZXMKICAgICAgICBDbGFzczw/\nPiBjID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKGFsaWFzLCBudWxsKTsKICAg\nICAgICBpZiAoYyAhPSBudWxsKQogICAgICAgICAgICBjbWQgPSByZXBvcy5n\nZXRNZXRhRGF0YShjLCBsb2FkZXIsIGFzc2VydFZhbGlkKTsKICAgICAgICBl\nbHNlIGlmIChhc3NlcnRWYWxpZCkKICAgICAgICAgICAgY21kID0gcmVwb3Mu\nZ2V0TWV0YURhdGEoYWxpYXMsIGxvYWRlciwgZmFsc2UpOwoKICAgICAgICBp\nZiAoY21kID09IG51bGwgJiYgYXNzZXJ0VmFsaWQpIHsKICAgICAgICAgICAg\nU3RyaW5nIGNsb3NlID0gcmVwb3MuZ2V0Q2xvc2VzdEFsaWFzTmFtZShhbGlh\ncyk7CiAgICAgICAgICAgIGlmIChjbG9zZSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1zY2hl\nbWEtbmFtZS1oaW50IiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IGFsaWFzLCBjbG9zZSwgcmVwb3MuZ2V0QWxpYXNOYW1lcygpIH0sIG51\nbGwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBw\nYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAg\nICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGFsaWFzLCByZXBvcy5n\nZXRBbGlhc05hbWVzKCkgfSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICBy\nZXR1cm4gY21kOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3M8Pz4gZ2V0Q2Fu\nZGlkYXRlVHlwZSgpIHsKICAgICAgICByZXR1cm4gZ2V0Q2FuZGlkYXRlTWV0\nYURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICB9CgogICAgcHJpdmF0\nZSBDbGFzc01ldGFEYXRhIGdldENhbmRpZGF0ZU1ldGFEYXRhKCkgewogICAg\nICAgIGlmIChjdHgoKS5tZXRhICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBjdHgoKS5tZXRhOwoKICAgICAgICBDbGFzc01ldGFEYXRhIGNscyA9IGdl\ndENhbmRpZGF0ZU1ldGFEYXRhKHJvb3QoKSk7CiAgICAgICAgaWYgKGNscyA9\nPSBudWxsKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgcm9vdCgpIH0sIG51bGwpOwoKICAgICAgICBzZXRDYW5kaWRh\ndGUoY2xzLCBudWxsKTsKICAgICAgICByZXR1cm4gY2xzOwogICAgfQoKICAg\nIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIGdldENhbmRpZGF0ZU1ldGFEYXRh\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICAvLyBleGFtaW5nIHRoZSBub2Rl\nIHRvIGZpbmQgdGhlIGNhbmRpZGF0ZSBxdWVyeQogICAgICAgIC8vICMjIyB0\naGlzIHNob3VsZCBhY3R1YWxseSBiZSB0aGUgcHJpbWFyeSBTRUxFQ1QgaW5z\ndGFuY2UKICAgICAgICAvLyByZXNvbHZlZCBhZ2FpbnN0IHRoZSBmcm9tIHZh\ncmlhYmxlIGRlY2xhcmF0aW9ucwogICAgICAgIEpQUUxOb2RlIGZyb20gPSBu\nb2RlLmZpbmRDaGlsZEJ5SUQoSkpURlJPTUlURU0sIHRydWUpOwogICAgICAg\nIGlmIChmcm9tID09IG51bGwpIHsKICAgICAgICAgICAgLy8gT1BFTkpQQS0x\nNSBhbGxvdyBzdWJxdWVyeSB3aXRob3V0IGEgRlJPTUlURU0KICAgICAgICAg\nICAgaWYgKG5vZGUuaWQgPT0gSkpUU1VCU0VMRUNUKSB7IAogICAgICAgICAg\nICAgICAgZnJvbSA9IG5vZGUuZmluZENoaWxkQnlJRChKSlRGUk9NLCB0cnVl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJuby1mcm9t\nLWNsYXVzZSIsIG51bGwsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZyb20uY2hpbGRyZW4u\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgSlBRTE5vZGUgbiA9IGZyb20u\nY2hpbGRyZW5baV07CgogICAgICAgICAgICBpZiAobi5pZCA9PSBKSlRBQlNU\nUkFDVFNDSEVNQU5BTUUpIHsKICAgICAgICAgICAgICAgIC8vIHdlIHNpbXBs\neSByZXR1cm4gdGhlIGZpcnN0IGFic3RyYWN0IHNjaGVtYSBjaGlsZAogICAg\nICAgICAgICAgICAgLy8gYXMgcmVzb2x2ZWQgaW50byBhIGNsYXNzCiAgICAg\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlc29sdmVDbGFzc01l\ndGFEYXRhKG4pOwoKICAgICAgICAgICAgICAgIGlmIChjbWQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAgICAg\nICAgIC8vIG5vdCBhIHNjaGVtYTogdHJlYXQgaXQgYXMgYSBjbGFzcwogICAg\nICAgICAgICAgICAgU3RyaW5nIGNscyA9IGFzc2VydFNjaGVtYU5hbWUobik7\nCiAgICAgICAgICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1z\nY2hlbWEtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmpl\nY3RbXXsgcm9vdCgpIH0sIG51bGwpOwoKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRDbGFzc01ldGFEYXRhKGNscywgdHJ1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgLy8gT1BFTkpQQS0xNSBzdXBwb3J0IHN1YnF1ZXJ5J3Mg\nZnJvbSBjbGF1c2UgZG8gbm90IHN0YXJ0IHdpdGggCiAgICAgICAgICAgIC8v\nIGlkZW50aWZpY2F0aW9uX3ZhcmlhYmxlX2RlY2xhcmF0aW9uKCkKICAgICAg\nICAgICAgaWYgKG5vZGUuaWQgPT0gSkpUU1VCU0VMRUNUKSB7CiAgICAgICAg\nICAgICAgICBpZiAobi5pZCA9PSBKSlRJTk5FUkpPSU4pIHsKICAgICAgICAg\nICAgICAgICAgICBuID0gbi5nZXRDaGlsZCgwKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGlmIChuLmlkID09IEpKVFBBVEgpIHsKICAg\nICAgICAgICAgICAgICAgICBQYXRoIHBhdGggPSBnZXRQYXRoKG4pOwogICAg\nICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5sYXN0\nKCk7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBn\nZXRGaWVsZFR5cGUoZm1kKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY21k\nID09IG51bGwgJiYgZm1kLmlzRWxlbWVudENvbGxlY3Rpb24oKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgY21kID0gZm1kLmdldERlZmluaW5nTWV0YURh\ndGEoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY21kICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNtZDsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VT\nRVIsICJuby1hbGlhcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG5ldyBPYmplY3RbXXsgbiB9LCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gICAgICAg\nICAgIAogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIFN0cmluZyBjdXJyZW50UXVlcnkoKSB7CiAgICAgICAg\ncmV0dXJuIGN0eCgpLnBhcnNlZCA9PSBudWxsIHx8IHJvb3QoKS5wYXJzZXIg\nPT0gbnVsbCA/IG51bGwKICAgICAgICAgICAgOiByb290KCkucGFyc2VyLmpw\ncWw7CiAgICB9CgogICAgUXVlcnlFeHByZXNzaW9ucyBnZXRRdWVyeUV4cHJl\nc3Npb25zKCkgewogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcyA9IG5l\ndyBRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgZXhwcy5zZXRDb250ZXh0\ncyhjb250ZXh0cyk7CgogICAgICAgIGV2YWxRdWVyeU9wZXJhdGlvbihleHBz\nKTsKCiAgICAgICAgRXhwcmVzc2lvbiBmaWx0ZXIgPSBudWxsOwogICAgICAg\nIEV4cHJlc3Npb24gZnJvbSA9IGN0eCgpLmZyb207CiAgICAgICAgaWYgKGZy\nb20gPT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9IGV2YWxGcm9tQ2xhdXNl\nKHJvb3QoKS5pZCA9PSBKSlRTRUxFQ1QpOwogICAgICAgIGZpbHRlciA9IGFu\nZChmcm9tLCBmaWx0ZXIpOwogICAgICAgIGZpbHRlciA9IGFuZChldmFsV2hl\ncmVDbGF1c2UoKSwgZmlsdGVyKTsKICAgICAgICBmaWx0ZXIgPSBhbmQoZXZh\nbFNlbGVjdENsYXVzZShleHBzKSwgZmlsdGVyKTsKCiAgICAgICAgZXhwcy5m\naWx0ZXIgPSBmaWx0ZXIgPT0gbnVsbCA/IGZhY3RvcnkuZW1wdHlFeHByZXNz\naW9uKCkgOiBmaWx0ZXI7CgogICAgICAgIGV2YWxHcm91cGluZ0NsYXVzZShl\neHBzKTsKICAgICAgICBldmFsSGF2aW5nQ2xhdXNlKGV4cHMpOwogICAgICAg\nIGV2YWxGZXRjaEpvaW5zKGV4cHMpOwogICAgICAgIGV2YWxTZXRDbGF1c2Uo\nZXhwcyk7CiAgICAgICAgZXZhbE9yZGVyaW5nQ2xhdXNlcyhleHBzKTsKCiAg\nICAgICAgaWYgKHBhcmFtZXRlclR5cGVzICE9IG51bGwpCiAgICAgICAgICAg\nIGV4cHMucGFyYW1ldGVyVHlwZXMgPSBwYXJhbWV0ZXJUeXBlczsKCiAgICAg\nICAgZXhwcy5hY2Nlc3NQYXRoID0gZ2V0QWNjZXNzUGF0aCgpOwoKICAgICAg\nICByZXR1cm4gZXhwczsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24g\nYW5kKEV4cHJlc3Npb24gZTEsIEV4cHJlc3Npb24gZTIpIHsKICAgICAgICBy\nZXR1cm4gZTEgPT0gbnVsbCA/IGUyIDogZTIgPT0gbnVsbCA/IGUxIDogZmFj\ndG9yeS5hbmQoZTEsIGUyKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBT\ndHJpbmcgYXNzZW1ibGUoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVy\nbiBhc3NlbWJsZShub2RlLCAiLiIsIDApOwogICAgfQoKICAgIC8qKgogICAg\nICogQXNzZW1ibGUgdGhlIGNoaWxkcmVuIG9mIHRoZSBzcGVjaWZpYyBub2Rl\nIGJ5IGFwcGVuZGluZyBlYWNoCiAgICAgKiBjaGlsZCwgc2VwYXJhdGVkIGJ5\nIHRoZSBkZWxpbWl0ZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0\ncmluZyBhc3NlbWJsZShKUFFMTm9kZSBub2RlLCBTdHJpbmcgZGVsaW1pdGVy\nLCBpbnQgbGFzdCkgewogICAgICAgIFN0cmluZ0J1ZmZlciByZXN1bHQgPSBu\nZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgSlBRTE5vZGVbXSBwYXJ0cyA9\nIG5vZGUuY2hpbGRyZW47CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IHBhcnRz\nICE9IG51bGwgJiYgaSA8IHBhcnRzLmxlbmd0aCAtIGxhc3Q7IGkrKykKICAg\nICAgICAgICAgcmVzdWx0LmFwcGVuZChyZXN1bHQubGVuZ3RoKCkgPiAwID8g\nZGVsaW1pdGVyIDogIiIpLgogICAgICAgICAgICAgICAgYXBwZW5kKHBhcnRz\nW2ldLnRleHQpOwoKICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7\nCiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGFzc2lnblN1YnNlbGVj\ndFByb2plY3Rpb24oSlBRTE5vZGUgbm9kZSwKICAgICAgICBRdWVyeUV4cHJl\nc3Npb25zIGV4cHMpIHsKICAgICAgICBpbkFzc2lnblN1YnNlbGVjdFByb2pl\nY3Rpb24gPSB0cnVlOwogICAgICAgIGV4cHMucHJvamVjdGlvbnMgPSBuZXcg\nVmFsdWVbMV07CiAgICAgICAgZXhwcy5wcm9qZWN0aW9uQ2xhdXNlcyA9IG5l\ndyBTdHJpbmdbMV07CiAgICAgICAgZXhwcy5wcm9qZWN0aW9uQWxpYXNlcyA9\nIG5ldyBTdHJpbmdbMV07CgogICAgICAgIFZhbHVlIHZhbCA9IGdldFZhbHVl\nKG5vZGUpOwogICAgICAgIGV4cHMucHJvamVjdGlvbnNbMF0gPSB2YWw7CiAg\nICAgICAgZXhwcy5wcm9qZWN0aW9uQ2xhdXNlc1swXSA9IAogICAgICAgICAg\nICBwcm9qZWN0aW9uQ2xhdXNlKG5vZGUuaWQgPT0gSkpUU0NBTEFSRVhQUkVT\nU0lPTiA/CiAgICAgICAgICAgICAgICBmaXJzdENoaWxkKG5vZGUpIDogbm9k\nZSk7CiAgICAgICAgaW5Bc3NpZ25TdWJzZWxlY3RQcm9qZWN0aW9uID0gZmFs\nc2U7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NpZ24gcHJvamVjdGlvbnMgZm9yIE5FVyBjb250cnVjdG9yIGluIHNl\nbGVjdGlvbiBsaXN0LgogICAgICogICAgIEV4YW1wbGU6ICBTRUxFQ1QgTkVX\nIFBlcnNvbihwLm5hbWUpIEZST00gUGVyc29uIHAgV0hFUkUgLi4uCiAgICAg\nKi8KICAgIHByaXZhdGUgRXhwcmVzc2lvbiBhc3NpZ25Qcm9qZWN0aW9ucyhK\nUFFMTm9kZSBwYXJhbWV0ZXJzTm9kZSwKICAgICAgICBRdWVyeUV4cHJlc3Np\nb25zIGV4cHMsIExpc3Q8VmFsdWU+IHByb2plY3Rpb25zLAogICAgICAgIExp\nc3Q8U3RyaW5nPiBwcm9qZWN0aW9uQ2xhdXNlcywgTGlzdDxTdHJpbmc+IHBy\nb2plY3Rpb25BbGlhc2VzKSB7CiAgICAgICAgaW50IGNvdW50ID0gcGFyYW1l\ndGVyc05vZGUuZ2V0Q2hpbGRDb3VudCgpOwoKICAgICAgICBFeHByZXNzaW9u\nIGV4cCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3Vu\ndDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIHBhcmVudCA9IHBhcmFt\nZXRlcnNOb2RlLmdldENoaWxkKGkpOwogICAgICAgICAgICBKUFFMTm9kZSBu\nb2RlID0gZmlyc3RDaGlsZChwYXJlbnQpOwogICAgICAgICAgICBKUFFMTm9k\nZSBhbGlhc05vZGUgPSBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoID4gMSA/IHJp\nZ2h0KHBhcmVudCkKICAgICAgICAgICAgICAgIDogbnVsbDsgCiAgICAgICAg\nICAgIFZhbHVlIHByb2ogPSBnZXRWYWx1ZShub2RlKTsKICAgICAgICAgICAg\nU3RyaW5nIGFsaWFzID0gYWxpYXNOb2RlICE9IG51bGwgPyBhbGlhc05vZGUu\ndGV4dCA6CiAgICAgICAgICAgICAgICBwcm9qZWN0aW9uQ2xhdXNlKG5vZGUu\naWQgPT0gSkpUU0NBTEFSRVhQUkVTU0lPTiA/CiAgICAgICAgICAgICAgICAg\nICAgICAgIGZpcnN0Q2hpbGQobm9kZSkgOiBub2RlKTsKICAgICAgICAgICAg\naWYgKGFsaWFzTm9kZSAhPSBudWxsKQogICAgICAgICAgICAgICAgcHJvai5z\nZXRBbGlhcyhhbGlhcyk7CiAgICAgICAgICAgIHByb2plY3Rpb25zLmFkZChw\ncm9qKTsKICAgICAgICAgICAgcHJvamVjdGlvbkNsYXVzZXMuYWRkKGFsaWFz\nKTsKICAgICAgICAgICAgcHJvamVjdGlvbkFsaWFzZXMuYWRkKGFsaWFzKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgZXZhbFByb2plY3Rpb25zUmVzdWx0U2hhcGUoSlBRTE5vZGUg\nc2VsZWN0aW9uc05vZGUsCiAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBz\nLAogICAgICAgIExpc3Q8VmFsdWU+IHByb2plY3Rpb25zLAogICAgICAgIExp\nc3Q8U3RyaW5nPiBwcm9qZWN0aW9uQ2xhdXNlcywKICAgICAgICBMaXN0PFN0\ncmluZz4gcHJvamVjdGlvbkFsaWFzZXMpIHsKICAgICAgICBpbnQgY291bnQg\nPSBzZWxlY3Rpb25zTm9kZS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAgQ2xh\nc3M8Pz4gcmVzdWx0Q2xhc3MgPSBudWxsOwogICAgICAgIFJlc3VsdFNoYXBl\nPD8+IHJlc3VsdFNoYXBlID0gbnVsbDsKICAgICAgICBpZiAoY291bnQgPiAx\nKSB7CiAgICAgICAgICAgIC8vIG11dGktc2VsZWN0aW9uCiAgICAgICAgICAg\nIHJlc3VsdENsYXNzID0gT2JqZWN0W10uY2xhc3M7CiAgICAgICAgICAgIHJl\nc3VsdFNoYXBlID0gbmV3IFJlc3VsdFNoYXBlKHJlc3VsdENsYXNzLCBuZXcg\nRmlsbFN0cmF0ZWd5LkFycmF5PE9iamVjdFtdPihPYmplY3RbXS5jbGFzcykp\nOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3Vu\ndDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIHBhcmVudCA9IHNlbGVj\ndGlvbnNOb2RlLmdldENoaWxkKGkpOwogICAgICAgICAgICBKUFFMTm9kZSBu\nb2RlID0gZmlyc3RDaGlsZChwYXJlbnQpOwogICAgICAgICAgICBpZiAobm9k\nZS5pZCA9PSBKSlRDT05TVFJVQ1RPUikgewogICAgICAgICAgICAgICAgLy8g\nYnVpbGQgdXAgdGhlIGZ1bGx5LXF1YWxpZmllZCByZXN1bHQgY2xhc3MgbmFt\nZSBieQogICAgICAgICAgICAgICAgLy8gYXBwZW5kaW5nIHRvZ2V0aGVyIHRo\nZSBjb21wb25lbnRzIG9mIHRoZSBjaGlsZHJlbgogICAgICAgICAgICAgICAg\nU3RyaW5nIHJlc3VsdENsYXNzTmFtZSA9IGFzc2VtYmxlKGxlZnQobm9kZSkp\nOwogICAgICAgICAgICAgICAgQ2xhc3M8Pz4gY29uc3RydWN0b3IgPSByZXNv\nbHZlci5jbGFzc0Zvck5hbWUocmVzdWx0Q2xhc3NOYW1lLCBudWxsKTsKICAg\nICAgICAgICAgICAgIGlmIChjb25zdHJ1Y3RvciA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gdHJ5IHJlc29sdmUgaXQgYWdhaW4gdXNpbmcg\nc2ltcGxlIG5hbWUKICAgICAgICAgICAgICAgICAgICBpbnQgbiA9IGxlZnQo\nbm9kZSkuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICAgICAgICAgIFN0\ncmluZyBiYXNlTmFtZSA9IGxlZnQobm9kZSkuZ2V0Q2hpbGQobi0xKS50ZXh0\nOwogICAgICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yID0gcmVzb2x2ZXIu\nY2xhc3NGb3JOYW1lKGJhc2VOYW1lLCBudWxsKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGlmIChjb25zdHJ1Y3RvciA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VT\nRVIsICJuby1jb25zdHJ1Y3RvciIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IHJlc3VsdENsYXNzTmFtZSB9LCBudWxsKTsK\nCiAgICAgICAgICAgICAgICBMaXN0PFZhbHVlPiB0ZXJtcyA9IG5ldyBBcnJh\neUxpc3Q8VmFsdWU+KCk7CiAgICAgICAgICAgICAgICBMaXN0PFN0cmluZz4g\nYWxpYXNlcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgICAg\nICAgICAgTGlzdDxTdHJpbmc+IGNsYXVzZXMgPSBuZXcgQXJyYXlMaXN0PFN0\ncmluZz4oKTsKICAgICAgICAgICAgICAgIC8vIG5vdyBhc3NpZ24gdGhlIGFy\nZ3VtZW50cyB0byB0aGUgc2VsZWN0IGNsYXVzZSBhcyB0aGUgcHJvamVjdGlv\nbnMKICAgICAgICAgICAgICAgIGFzc2lnblByb2plY3Rpb25zKHJpZ2h0KG5v\nZGUpLCBleHBzLCB0ZXJtcywgYWxpYXNlcywgY2xhdXNlcyk7CiAgICAgICAg\nICAgICAgICBGaWxsU3RyYXRlZ3kgZmlsbCA9IG5ldyBGaWxsU3RyYXRlZ3ku\nTmV3SW5zdGFuY2UoY29uc3RydWN0b3IpOwogICAgICAgICAgICAgICAgUmVz\ndWx0U2hhcGU8Pz4gY29ucyA9IG5ldyBSZXN1bHRTaGFwZShjb25zdHJ1Y3Rv\nciwgZmlsbCk7CiAgICAgICAgICAgICAgICBmb3IgKFZhbHVlIHZhbCA6IHRl\ncm1zKSB7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IHZh\nbC5nZXRUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAgY29ucy5uZXN0KG5l\ndyBSZXN1bHRTaGFwZSh0eXBlLCBuZXcgRmlsbFN0cmF0ZWd5LkFzc2lnbigp\nLCB0eXBlLmlzUHJpbWl0aXZlKCkpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGlmIChjb3VudCA9PSAxKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmVzdWx0Q2xhc3MgPSBjb25zdHJ1Y3RvcjsKICAgICAgICAgICAg\nICAgICAgICByZXN1bHRTaGFwZSA9IGNvbnM7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmVz\ndWx0U2hhcGUubmVzdChjb25zKTsKICAgICAgICAgICAgICAgIHByb2plY3Rp\nb25zLmFkZEFsbCh0ZXJtcyk7CiAgICAgICAgICAgICAgICBwcm9qZWN0aW9u\nQWxpYXNlcy5hZGRBbGwoYWxpYXNlcyk7CiAgICAgICAgICAgICAgICBwcm9q\nZWN0aW9uQ2xhdXNlcy5hZGRBbGwoY2xhdXNlcyk7CgogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgSlBRTE5vZGUgYWxpYXNOb2RlID0g\ncGFyZW50LmNoaWxkcmVuLmxlbmd0aCA+IDEgPyByaWdodChwYXJlbnQpCiAg\nICAgICAgICAgICAgICAgICAgICAgIDogbnVsbDsgCiAgICAgICAgICAgICAg\nICBWYWx1ZSBwcm9qID0gZ2V0VmFsdWUobm9kZSk7CiAgICAgICAgICAgICAg\nICBTdHJpbmcgYWxpYXMgPSBhbGlhc05vZGUgIT0gbnVsbCA/IGFsaWFzTm9k\nZS50ZXh0IDoKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0aW9uQ2xhdXNl\nKG5vZGUuaWQgPT0gSkpUU0NBTEFSRVhQUkVTU0lPTiA/CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmaXJzdENoaWxkKG5vZGUpIDogbm9kZSk7CiAg\nICAgICAgICAgICAgICBpZiAoYWxpYXNOb2RlICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgcHJvai5zZXRBbGlhcyhhbGlhcyk7CiAgICAgICAgICAg\nICAgICBwcm9qZWN0aW9ucy5hZGQocHJvaik7CiAgICAgICAgICAgICAgICBw\ncm9qZWN0aW9uQ2xhdXNlcy5hZGQoYWxpYXMpOwogICAgICAgICAgICAgICAg\ncHJvamVjdGlvbkFsaWFzZXMuYWRkKGFsaWFzKTsKICAgICAgICAgICAgICAg\nIENsYXNzPD8+IHR5cGUgPSBwcm9qLmdldFR5cGUoKTsKICAgICAgICAgICAg\nICAgIFJlc3VsdFNoYXBlPD8+IHByb2pTaGFwZSA9IG5ldyBSZXN1bHRTaGFw\nZSh0eXBlLCBuZXcgRmlsbFN0cmF0ZWd5LkFzc2lnbigpLCB0eXBlLmlzUHJp\nbWl0aXZlKCkpOwoKICAgICAgICAgICAgICAgIGlmIChjb3VudCA9PSAxKQog\nICAgICAgICAgICAgICAgICAgIHJlc3VsdFNoYXBlID0gcHJvalNoYXBlOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJlc3Vs\ndFNoYXBlLm5lc3QocHJvalNoYXBlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBleHBzLnNoYXBlID0gcmVzdWx0U2hhcGU7CiAgICAgICAg\nZXhwcy5yZXN1bHRDbGFzcyA9IHJlc3VsdENsYXNzOwogICAgfQoKICAgIHBy\naXZhdGUgU3RyaW5nIHByb2plY3Rpb25DbGF1c2UoSlBRTE5vZGUgbm9kZSkg\newogICAgICAgIHN3aXRjaCAobm9kZS5pZCkgewogICAgICAgIGNhc2UgSkpU\nVFlQRToKICAgICAgICAgICAgcmV0dXJuIHByb2plY3Rpb25DbGF1c2UoZmly\nc3RDaGlsZChub2RlKSk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\ncmV0dXJuIGFzc2VtYmxlKG5vZGUpOwogICAgICAgIH0KICAgIH0KICAgIAog\nICAgcHJpdmF0ZSB2b2lkIGV2YWxRdWVyeU9wZXJhdGlvbihRdWVyeUV4cHJl\nc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3\nZSB3YW50IHRvIHNlbGVjdCwgZGVsZXRlLCBvciB1cGRhdGUKICAgICAgICBp\nZiAocm9vdCgpLmlkID09IEpKVFNFTEVDVCB8fCByb290KCkuaWQgPT0gSkpU\nU1VCU0VMRUNUKQogICAgICAgICAgICBleHBzLm9wZXJhdGlvbiA9IFF1ZXJ5\nT3BlcmF0aW9ucy5PUF9TRUxFQ1Q7CiAgICAgICAgZWxzZSBpZiAocm9vdCgp\nLmlkID09IEpKVERFTEVURSkKICAgICAgICAgICAgZXhwcy5vcGVyYXRpb24g\nPSBRdWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFOwogICAgICAgIGVsc2UgaWYg\nKHJvb3QoKS5pZCA9PSBKSlRVUERBVEUpCiAgICAgICAgICAgIGV4cHMub3Bl\ncmF0aW9uID0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFURTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VOU1VQ\nUE9SVEVELCAidW5yZWNvZ25pemVkLW9wZXJhdGlvbiIsCiAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxsKTsKICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgZXZhbEdyb3VwaW5nQ2xhdXNlKFF1ZXJ5RXhwcmVz\nc2lvbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBHUk9VUCBCWSBjbGF1\nc2VzCiAgICAgICAgSlBRTE5vZGUgZ3JvdXBCeU5vZGUgPSByb290KCkuZmlu\nZENoaWxkQnlJRChKSlRHUk9VUEJZLCBmYWxzZSk7CgogICAgICAgIGlmIChn\ncm91cEJ5Tm9kZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGludCBncm91cEJ5Q291bnQgPSBncm91cEJ5Tm9kZS5nZXRDaGlsZENv\ndW50KCk7CgogICAgICAgIGV4cHMuZ3JvdXBpbmcgPSBuZXcgVmFsdWVbZ3Jv\ndXBCeUNvdW50XTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBncm91\ncEJ5Q291bnQ7IGkrKykgewogICAgICAgICAgICBKUFFMTm9kZSBub2RlID0g\nZ3JvdXBCeU5vZGUuZ2V0Q2hpbGQoaSk7CiAgICAgICAgICAgIGV4cHMuZ3Jv\ndXBpbmdbaV0gPSBnZXRWYWx1ZShub2RlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIGV2YWxIYXZpbmdDbGF1c2UoUXVlcnlFeHByZXNz\naW9ucyBleHBzKSB7CiAgICAgICAgLy8gaGFuZGxlIEhBVklORyBjbGF1c2Vz\nCiAgICAgICAgSlBRTE5vZGUgaGF2aW5nTm9kZSA9IHJvb3QoKS5maW5kQ2hp\nbGRCeUlEKEpKVEhBVklORywgZmFsc2UpOwoKICAgICAgICBpZiAoaGF2aW5n\nTm9kZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGV4\ncHMuaGF2aW5nID0gZ2V0RXhwcmVzc2lvbihvbmx5Q2hpbGQoaGF2aW5nTm9k\nZSkpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBldmFsT3JkZXJpbmdDbGF1\nc2VzKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRs\nZSBPUkRFUiBCWSBjbGF1c2VzCiAgICAgICAgSlBRTE5vZGUgb3JkZXJieSA9\nIHJvb3QoKS5maW5kQ2hpbGRCeUlEKEpKVE9SREVSQlksIGZhbHNlKTsKICAg\nICAgICBpZiAob3JkZXJieSAhPSBudWxsKSB7CiAgICAgICAgICAgIGludCBv\ncmRlcmNvdW50ID0gb3JkZXJieS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAg\nICAgIGV4cHMub3JkZXJpbmcgPSBuZXcgVmFsdWVbb3JkZXJjb3VudF07CiAg\nICAgICAgICAgIGV4cHMub3JkZXJpbmdDbGF1c2VzID0gbmV3IFN0cmluZ1tv\ncmRlcmNvdW50XTsKICAgICAgICAgICAgZXhwcy5vcmRlcmluZ0FsaWFzZXMg\nPSBuZXcgU3RyaW5nW29yZGVyY291bnRdOwogICAgICAgICAgICBleHBzLmFz\nY2VuZGluZyA9IG5ldyBib29sZWFuW29yZGVyY291bnRdOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG9yZGVyY291bnQ7IGkrKykgewogICAg\nICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9yZGVyYnkuZ2V0Q2hpbGQo\naSk7CiAgICAgICAgICAgICAgICBKUFFMTm9kZSBmaXJzdENoaWxkID0gZmly\nc3RDaGlsZChub2RlKTsKICAgICAgICAgICAgICAgIGV4cHMub3JkZXJpbmdb\naV0gPSBnZXRWYWx1ZShmaXJzdENoaWxkKTsKICAgICAgICAgICAgICAgIGV4\ncHMub3JkZXJpbmdDbGF1c2VzW2ldID0gYXNzZW1ibGUoZmlyc3RDaGlsZCk7\nCiAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5nQWxpYXNlc1tpXSA9IGZp\ncnN0Q2hpbGQudGV4dDsKCiAgICAgICAgICAgICAgICAvLyBvbW1pc3Npb24g\nb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGllcyBhc2NlbmRpbmcKICAgICAgICAg\nICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldID0gbm9kZS5nZXRDaGlsZENvdW50\nKCkgPD0gMSB8fAogICAgICAgICAgICAgICAgICAgIGxhc3RDaGlsZChub2Rl\nKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0cnVlIDogZmFsc2U7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gY2hlY2sgaWYgb3JkZXIgYnkgc2VsZWN0\nIGl0ZW0gcmVzdWx0IGFsaWFzCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgb3JkZXJjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAo\nZXhwcy5vcmRlcmluZ0NsYXVzZXNbaV0gIT0gbnVsbCAmJiAKICAgICAgICAg\nICAgICAgICAgICAhZXhwcy5vcmRlcmluZ0NsYXVzZXNbaV0uZXF1YWxzKCIi\nKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGogPSAwOyBqIDwgZXhwcy5wcm9qZWN0aW9ucy5sZW5n\ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmIChleHBzLnByb2pl\nY3Rpb25BbGlhc2VzW2pdLmVxdWFsc0lnbm9yZUNhc2UoCiAgICAgICAgICAg\nICAgICAgICAgICAgIGV4cHMub3JkZXJpbmdBbGlhc2VzW2ldKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5nW2ldID0gZXhwcy5w\ncm9qZWN0aW9uc1tqXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgRXhwcmVz\nc2lvbiBldmFsU2VsZWN0Q2xhdXNlKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykg\newogICAgICAgIGlmIChleHBzLm9wZXJhdGlvbiAhPSBRdWVyeU9wZXJhdGlv\nbnMuT1BfU0VMRUNUKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgSlBRTE5vZGUgc2VsZWN0Tm9kZSA9IHJvb3QoKTsKCiAgICAgICAgSlBR\nTE5vZGUgc2VsZWN0Q2xhdXNlID0gc2VsZWN0Tm9kZS4KICAgICAgICAgICAg\nZmluZENoaWxkQnlJRChKSlRTRUxFQ1RDTEFVU0UsIGZhbHNlKTsKICAgICAg\nICBpZiAoc2VsZWN0Q2xhdXNlICE9IG51bGwgJiYgc2VsZWN0Q2xhdXNlLmhh\nc0NoaWxkSUQoSkpURElTVElOQ1QpKQogICAgICAgICAgICBleHBzLmRpc3Rp\nbmN0ID0gUXVlcnlFeHByZXNzaW9ucy5ESVNUSU5DVF9UUlVFIAogICAgICAg\nICAgICAgICAgICAgICAgICAgIHwgUXVlcnlFeHByZXNzaW9ucy5ESVNUSU5D\nVF9BVVRPOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IFF1ZXJ5RXhwcmVzc2lvbnMuRElTVElOQ1RfRkFMU0U7CgogICAgICAg\nIC8vIGhhbmRsZSBTRUxFQ1QgY2xhdXNlcwogICAgICAgIEpQUUxOb2RlIGV4\ncE5vZGUgPSBzZWxlY3ROb2RlLgogICAgICAgIGZpbmRDaGlsZEJ5SUQoSkpU\nU0VMRUNURVhQUkVTU0lPTlMsIHRydWUpOwogICAgICAgIGlmIChleHBOb2Rl\nID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQoKICAgICAgICBpbnQgc2VsZWN0Q291bnQgPSBleHBOb2RlLmdldENoaWxk\nQ291bnQoKTsKICAgICAgICBKUFFMTm9kZSBzZWxlY3RDaGlsZCA9IGZpcnN0\nQ2hpbGQoZXhwTm9kZSk7CgogICAgICAgIGlmIChzZWxlY3RDbGF1c2UucGFy\nZW50LmlkID09IEpKVFNVQlNFTEVDVCkgewogICAgICAgICAgICBleHBzLmRp\nc3RpbmN0ICY9IH5RdWVyeUV4cHJlc3Npb25zLkRJU1RJTkNUX0FVVE87CiAg\nICAgICAgICAgIHJldHVybiBhc3NpZ25TdWJzZWxlY3RQcm9qZWN0aW9uKG9u\nbHlDaGlsZChzZWxlY3RDaGlsZCksIGV4cHMpOwogICAgICAgIH0KICAgICAg\nICAvLyBpZiB3ZSBhcmUgc2VsZWN0aW5nIGp1c3Qgb25lIHRoaW5nIGFuZCB0\naGF0IHRoaW5nIGlzIHRoZQogICAgICAgIC8vIHNjaGVtYSdzIGFsaWFzLCB0\naGVuIGRvIG5vdCB0cmVhdCBpdCBhcyBhIHByb2plY3Rpb24KICAgICAgICBp\nZiAoc2VsZWN0Q291bnQgPT0gMSAmJiBzZWxlY3RDaGlsZCAhPSBudWxsICYm\nCiAgICAgICAgICAgIHNlbGVjdENoaWxkLmdldENoaWxkQ291bnQoKSA9PSAx\nICYmCiAgICAgICAgICAgIG9ubHlDaGlsZChzZWxlY3RDaGlsZCkgIT0gbnVs\nbCkgewogICAgICAgICAgICBKUFFMTm9kZSBjaGlsZCA9IG9ubHlDaGlsZChz\nZWxlY3RDaGlsZCk7CiAgICAgICAgICAgIGlmIChjaGlsZC5pZCA9PSBKSlRT\nQ0FMQVJFWFBSRVNTSU9OKQogICAgICAgICAgICAgICAgY2hpbGQgPSBvbmx5\nQ2hpbGQoY2hpbGQpOwogICAgICAgICAgICBpZiAoYXNzZXJ0U2NoZW1hQWxp\nYXMoKS5lcXVhbHNJZ25vcmVDYXNlKGNoaWxkLnRleHQpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0g\nCiAgICAgICAgLy8gSlBRTCBkb2VzIG5vdCBmaWx0ZXIgcmVsYXRpb25hbCBq\nb2lucyBmb3IgcHJvamVjdGlvbnMKICAgICAgICBleHBzLmRpc3RpbmN0ICY9\nIH5RdWVyeUV4cHJlc3Npb25zLkRJU1RJTkNUX0FVVE87CiAgICAgICAgZXhw\ncy5wcm9qZWN0aW9ucyA9IG5ldyBWYWx1ZVtzZWxlY3RDb3VudF07CiAgICAg\nICAgTGlzdDxWYWx1ZT4gcHJvamVjdGlvbnMgPSBuZXcgQXJyYXlMaXN0PFZh\nbHVlPigpOwogICAgICAgIExpc3Q8U3RyaW5nPiBhbGlhc2VzID0gbmV3IEFy\ncmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgTGlzdDxTdHJpbmc+IGNsYXVz\nZXMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBldmFsUHJv\namVjdGlvbnNSZXN1bHRTaGFwZShleHBOb2RlLCBleHBzLCBwcm9qZWN0aW9u\ncywgYWxpYXNlcywgY2xhdXNlcyk7CiAgICAgICAgZXhwcy5wcm9qZWN0aW9u\ncyA9IHByb2plY3Rpb25zLnRvQXJyYXkobmV3IFZhbHVlW3Byb2plY3Rpb25z\nLnNpemUoKV0pOwogICAgICAgIGV4cHMucHJvamVjdGlvbkFsaWFzZXMgPSBh\nbGlhc2VzLnRvQXJyYXkobmV3IFN0cmluZ1thbGlhc2VzLnNpemUoKV0pOwog\nICAgICAgIGV4cHMucHJvamVjdGlvbkNsYXVzZXMgPSBjbGF1c2VzLnRvQXJy\nYXkobmV3IFN0cmluZ1tjbGF1c2VzLnNpemUoKV0pOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIGFzc2VydFNjaGVt\nYUFsaWFzKCkgewogICAgICAgIFN0cmluZyBhbGlhcyA9IGN0eCgpLnNjaGVt\nYUFsaWFzOwoKICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImFsaWFzLXJlcXVp\ncmVkIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgY3R4KCkubWV0\nYSB9LCBudWxsKTsKCiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgfQoKICAg\nIHByb3RlY3RlZCBFeHByZXNzaW9uIGV2YWxGZXRjaEpvaW5zKFF1ZXJ5RXhw\ncmVzc2lvbnMgZXhwcykgewogICAgICAgIEV4cHJlc3Npb24gZmlsdGVyID0g\nbnVsbDsKCiAgICAgICAgLy8gaGFuZGxlIEpPSU4gRkVUQ0gKICAgICAgICBT\nZXQ8U3RyaW5nPiBqb2lucyA9IG51bGw7CiAgICAgICAgU2V0PFN0cmluZz4g\naW5uZXJKb2lucyA9IG51bGw7CgogICAgICAgIEpQUUxOb2RlW10gb3V0ZXJz\nID0gcm9vdCgpLmZpbmRDaGlsZHJlbkJ5SUQoSkpUT1VURVJGRVRDSEpPSU4p\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBvdXRlcnMgIT0gbnVsbCAmJiBp\nIDwgb3V0ZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAoam9pbnMgPT0g\nbnVsbCA/IGpvaW5zID0gbmV3IFRyZWVTZXQ8U3RyaW5nPigpIDogam9pbnMp\nLgogICAgICAgICAgICAgICAgYWRkKGdldFBhdGgob25seUNoaWxkKG91dGVy\nc1tpXSkpLmxhc3QoKS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAgICBK\nUFFMTm9kZVtdIGlubmVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpK\nVElOTkVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW5u\nZXJzICE9IG51bGwgJiYgaSA8IGlubmVycy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBTdHJpbmcgcGF0aCA9IGdldFBhdGgob25seUNoaWxkKGlubmVy\nc1tpXSkpLmxhc3QoKQogICAgICAgICAgICAgICAgLmdldEZ1bGxOYW1lKGZh\nbHNlKTsKICAgICAgICAgICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9IG5l\ndyBUcmVlU2V0PFN0cmluZz4oKSA6IGpvaW5zKS5hZGQocGF0aCk7CiAgICAg\nICAgICAgIChpbm5lckpvaW5zID09IG51bGwgCiAgICAgICAgICAgICAgICAg\nICAgPyBpbm5lckpvaW5zID0gbmV3IFRyZWVTZXQ8U3RyaW5nPigpIAogICAg\nICAgICAgICAgICAgICAgIDogaW5uZXJKb2lucykuYWRkKHBhdGgpOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAgICAgICAg\nIGV4cHMuZmV0Y2hQYXRocyA9IChTdHJpbmdbXSkgam9pbnMuCiAgICAgICAg\nICAgICAgICB0b0FycmF5KG5ldyBTdHJpbmdbam9pbnMuc2l6ZSgpXSk7CiAg\nICAgICAgaWYgKGlubmVySm9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgZXhw\ncy5mZXRjaElubmVyUGF0aHMgPSAoU3RyaW5nW10pIGlubmVySm9pbnMuCiAg\nICAgICAgICAgICAgICB0b0FycmF5KG5ldyBTdHJpbmdbaW5uZXJKb2lucy5z\naXplKCldKTsKCiAgICAgICAgcmV0dXJuIGZpbHRlcjsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBldmFsU2V0Q2xhdXNlKFF1ZXJ5RXhwcmVzc2lvbnMg\nZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBTRVQgZmllbGQgPSB2YWx1ZQog\nICAgICAgIEpQUUxOb2RlW10gbm9kZXMgPSByb290KCkuZmluZENoaWxkcmVu\nQnlJRChKSlRVUERBVEVJVEVNKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\nbm9kZXMgIT0gbnVsbCAmJiBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChmaXJzdENoaWxkKG5vZGVz\nW2ldKSk7CiAgICAgICAgICAgIGlmIChwYXRoLmxhc3QoKS5nZXRWYWx1ZSgp\nLmdldEVtYmVkZGVkTWV0YURhdGEoKSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImNhbnQtYnVsay11\ncGRhdGUtZW1iZWRkYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXthc3NlbWJsZShmaXJzdENoaWxkKG5vZGVzW2ldKSl9LCBu\ndWxsKTsKCiAgICAgICAgICAgIEpQUUxOb2RlIGxhc3RDaGlsZCA9IGxhc3RD\naGlsZChub2Rlc1tpXSk7CiAgICAgICAgICAgIFZhbHVlIHZhbCA9IChsYXN0\nQ2hpbGQuY2hpbGRyZW4gPT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAg\nICA/IG51bGwgOiBnZXRWYWx1ZShvbmx5Q2hpbGQobGFzdENoaWxkKSk7CiAg\nICAgICAgICAgIGV4cHMucHV0VXBkYXRlKHBhdGgsIHZhbCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBldmFsV2hlcmVDbGF1\nc2UoKSB7CiAgICAgICAgLy8gZXZhbHVhdGUgdGhlIFdIRVJFIGNsYXVzZQog\nICAgICAgIEpQUUxOb2RlIHdoZXJlTm9kZSA9IHJvb3QoKS5maW5kQ2hpbGRC\neUlEKEpKVFdIRVJFLCBmYWxzZSk7CiAgICAgICAgaWYgKHdoZXJlTm9kZSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gKEV4cHJlc3Npb24pIGV2YWwod2hlcmVOb2RlKTsKICAgIH0KCiAgICBw\ncml2YXRlIEV4cHJlc3Npb24gZXZhbEZyb21DbGF1c2UoYm9vbGVhbiBuZWVk\nc0FsaWFzKSB7CiAgICAgICAgLy8gYnVpbGQgdXAgdGhlIGFsaWFzIG1hcCBp\nbiB0aGUgRlJPTSBjbGF1c2UKICAgICAgICBKUFFMTm9kZSBmcm9tID0gcm9v\ndCgpLmZpbmRDaGlsZEJ5SUQoSkpURlJPTSwgZmFsc2UpOwogICAgICAgIGlm\nIChmcm9tID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0\naW9uKEVYX1VTRVIsICJuby1mcm9tLWNsYXVzZSIsIG51bGwsIG51bGwpOwog\nICAgICAgIHJldHVybiBldmFsRnJvbUNsYXVzZShmcm9tLCBuZWVkc0FsaWFz\nKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbEZyb21DbGF1\nc2UoSlBRTE5vZGUgZnJvbSwgYm9vbGVhbiBuZWVkc0FsaWFzKSB7CiAgICAg\nICAgRXhwcmVzc2lvbiBleHAgPSBudWxsOwoKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZyb20uY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgSlBRTE5vZGUgbm9kZSA9IGZyb20uY2hpbGRyZW5baV07CgogICAg\nICAgICAgICBpZiAobm9kZS5pZCA9PSBKSlRGUk9NSVRFTSkKICAgICAgICAg\nICAgICAgIGV4cCA9IGV2YWxGcm9tSXRlbShleHAsIG5vZGUsIG5lZWRzQWxp\nYXMpOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVE9VVEVS\nSk9JTikKICAgICAgICAgICAgICAgIGV4cCA9IGFkZEpvaW4obm9kZSwgZmFs\nc2UsIGV4cCk7CiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpU\nSU5ORVJKT0lOKQogICAgICAgICAgICAgICAgZXhwID0gYWRkSm9pbihub2Rl\nLCB0cnVlLCBleHApOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09\nIEpKVElOTkVSRkVUQ0hKT0lOKQogICAgICAgICAgICAgICAgOyAvLyB3ZSBo\nYW5kbGUgaW5uZXIgZmV0Y2ggam9pbnMgaW4gdGhlIGV2YWxGZXRjaEpvaW5z\nKCkgbWV0aG9kCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpU\nT1VURVJGRVRDSEpPSU4pCiAgICAgICAgICAgICAgICA7IC8vIHdlIGhhbmRs\nZSBvdXRlciBmZXRjaCBqb2lucyBpbiB0aGUgZXZhbEZldGNoSm9pbnMoKSBt\nZXRob2QKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1zY2hlbWEtbmFtZSIsCiAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICBw\ncml2YXRlIEV4cHJlc3Npb24gZ2V0U3VicXVlcnkoU3RyaW5nIGFsaWFzLCBQ\nYXRoIHBhdGgsIEV4cHJlc3Npb24gZXhwKSB7CiAgICAgICAgVmFsdWUgdmFy\nID0gZ2V0VmFyaWFibGUoYWxpYXMsIHRydWUpOwogICAgICAgIC8vIHRoaXMg\nYmluZCBpcyBmb3IgdmFsaWRhdGVNYXBQYXRoIHRvIHJlc29sdmUgYWxpYXMK\nICAgICAgICBFeHByZXNzaW9uIGJpbmRWYXIgPSBmYWN0b3J5LmJpbmRWYXJp\nYWJsZSh2YXIsIHBhdGgpOwogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\ncGF0aC5sYXN0KCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjYW5kaWRhdGUg\nPSBnZXRGaWVsZFR5cGUoZm1kKTsKICAgICAgICBpZiAoY2FuZGlkYXRlID09\nIG51bGwgJiYgZm1kLmlzRWxlbWVudENvbGxlY3Rpb24oKSkKICAgICAgICAg\nICAgY2FuZGlkYXRlID0gZm1kLmdldERlZmluaW5nTWV0YURhdGEoKTsKCiAg\nICAgICAgc2V0Q2FuZGlkYXRlKGNhbmRpZGF0ZSwgYWxpYXMpOwoKICAgICAg\nICBDb250ZXh0IHN1YkNvbnRleHQgPSBjdHgoKTsKICAgICAgICBTdWJxdWVy\neSBzdWJxdWVyeSA9IGN0eCgpLmdldFN1YnF1ZXJ5KCk7CiAgICAgICAgaWYg\nKHN1YnF1ZXJ5ID09IG51bGwpewogICAgICAgICAgICBzdWJxdWVyeSA9IGZh\nY3RvcnkubmV3U3VicXVlcnkoY2FuZGlkYXRlLCB0cnVlLCBhbGlhcyk7CiAg\nICAgICAgICAgIHN1YkNvbnRleHQuc2V0U3VicXVlcnkoc3VicXVlcnkpOwog\nICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3VicXVlcnku\nc2V0U3VicUFsaWFzKGFsaWFzKTsKICAgICAgICB9CgogICAgICAgIFBhdGgg\nc3VicGF0aCA9IGZhY3RvcnkubmV3UGF0aChzdWJxdWVyeSk7CiAgICAgICAg\nc3VicGF0aC5zZXRTY2hlbWFBbGlhcyhwYXRoLmdldENvcnJlbGF0aW9uVmFy\nKCkpOwogICAgICAgIHN1YnBhdGguc2V0TWV0YURhdGEoY2FuZGlkYXRlKTsK\nICAgICAgICBzdWJxdWVyeS5zZXRNZXRhRGF0YShjYW5kaWRhdGUpOwogICAg\nICAgIGlmIChmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpKQogICAgICAgICAg\nICBleHAgPSBhbmQoZXhwLCBiaW5kVmFyKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIGV4cCA9IGFuZChleHAsIGZhY3RvcnkuZXF1YWwocGF0aCwgc3Vi\ncGF0aCkpOwoKICAgICAgICByZXR1cm4gZXhwOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyBhIGpvaW4gY29uZGl0aW9uIHRvIHRoZSBnaXZlbiBleHBy\nZXNzaW9uLgogICAgICoKICAgICAqIEBwYXJhbSBub2RlIHRoZSBub2RlIHRv\nIGNoZWNrCiAgICAgKiBAcGFyYW0gaW5uZXIgd2hldGhlciBvciBub3QgdGhl\nIGpvaW4gc2hvdWxkIGJlIGFuIGlubmVyIGpvaW4KICAgICAqIEBwYXJhbSBl\neHAgYW4gZXhpc3RpbmcgZXhwcmVzc2lvbiB0byBBTkQsIG9yIG51bGwgaWYg\nbm9uZQogICAgICogQHJldHVybiB0aGUgRXhwcmVzc2lvbiB3aXRoIHRoZSBq\nb2luIGNvbmRpdGlvbiBhZGRlZAogICAgICovCiAgICBwcml2YXRlIEV4cHJl\nc3Npb24gYWRkSm9pbihKUFFMTm9kZSBub2RlLCBib29sZWFuIGlubmVyLCBF\neHByZXNzaW9uIGV4cCkgewogICAgICAgIC8vIHRoZSB0eXBlIHdpbGwgYmUg\ndGhlIGRlY2xhcmVkIHR5cGUgZm9yIHRoZSBmaWVsZAogICAgICAgIEpQUUxO\nb2RlIGZpcnN0Q2hpbGQgPSBmaXJzdENoaWxkKG5vZGUpOwogICAgICAgIFBh\ndGggcGF0aCA9IG51bGw7CiAgICAgICAgaWYgKGZpcnN0Q2hpbGQuaWQgPT0g\nSkpUUVVBTElGSUVEUEFUSCkKICAgICAgICAgICAgcGF0aCA9IChQYXRoKSBn\nZXRRdWFsaWZpZWRQYXRoKGZpcnN0Q2hpbGQpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgcGF0aCA9IGdldFBhdGgoZmlyc3RDaGlsZCwgZmFsc2UsIGlu\nbmVyKTsKCiAgICAgICAgSlBRTE5vZGUgYWxpYXMgPSBub2RlLmdldENoaWxk\nQ291bnQoKSA+PSAyID8gcmlnaHQobm9kZSkgOiBudWxsOwogICAgICAgIC8v\nIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJxdWVyeSdzIGZyb20gY2xhdXNlIGRv\nIG5vdCBzdGFydCB3aXRoIAogICAgICAgIC8vIGlkZW50aWZpY2F0aW9uX3Zh\ncmlhYmxlX2RlY2xhcmF0aW9uKCkKICAgICAgICBpZiAoaW5uZXIgJiYgY3R4\nKCkuZ2V0UGFyZW50KCkgIT0gbnVsbCAmJiBjdHgoKS5zY2hlbWFBbGlhcyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBnZXRTdWJxdWVyeShhbGlh\ncy50ZXh0LCBwYXRoLCBleHApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIGFkZEpvaW4ocGF0aCwgYWxpYXMsIGV4cCk7CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGFkZEpvaW4oUGF0aCBwYXRoLCBKUFFMTm9kZSBhbGlh\nc05vZGUsCiAgICAgICAgRXhwcmVzc2lvbiBleHApIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IHBhdGgubGFzdCgpOwoKICAgICAgICBpZiAoZm1k\nID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VTRVIsICJwYXRoLW5vLW1ldGEiLAogICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBwYXRoLCBudWxsIH0sIG51bGwpOwoKICAgICAgICBTdHJpbmcg\nYWxpYXMgPSBhbGlhc05vZGUgIT0gbnVsbCA/IGFsaWFzTm9kZS50ZXh0IDog\nbmV4dEFsaWFzKCk7CgogICAgICAgIFZhbHVlIHZhciA9IGdldFZhcmlhYmxl\nKGFsaWFzLCB0cnVlKTsKICAgICAgICB2YXIuc2V0TWV0YURhdGEoZ2V0Rmll\nbGRUeXBlKGZtZCkpOwoKICAgICAgICBFeHByZXNzaW9uIGpvaW4gPSBudWxs\nOwoKICAgICAgICAvLyBpZiB0aGUgdmFyaWFibGUgaXMgYWxyZWFkeSBib3Vu\nZCwgZ2V0IHRoZSB2YXIncyB2YWx1ZSBhbmQKICAgICAgICAvLyBkbyBhIHJl\nZ3VsYXIgY29udGFpbnMgd2l0aCB0aGF0CiAgICAgICAgYm9vbGVhbiBib3Vu\nZCA9IGlzQm91bmQodmFyKTsKICAgICAgICBpZiAoYm91bmQpIHsKICAgICAg\nICAgICAgdmFyID0gZ2V0VmFsdWUoYWxpYXNOb2RlLCBWQVJfUEFUSCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYmluZCh2YXIpOwogICAgICAg\nICAgICBqb2luID0gYW5kKGpvaW4sIGZhY3RvcnkuYmluZFZhcmlhYmxlKHZh\nciwgcGF0aCkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFmbWQuaXNUeXBl\nUEMoKSkgLy8gbXVsdGktdmFsdWVkIHJlbGF0aW9uCiAgICAgICAgewogICAg\nICAgICAgICBpZiAoYm91bmQpCiAgICAgICAgICAgICAgICBqb2luID0gYW5k\nKGpvaW4sIGZhY3RvcnkuY29udGFpbnMocGF0aCwgdmFyKSk7CgogICAgICAg\nICAgICBzZXRJbXBsaWNpdENvbnRhaW5zVHlwZXMocGF0aCwgdmFyLCBDT05U\nQUlOU19UWVBFX0VMRU1FTlQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIGFuZChleHAsIGpvaW4pOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lv\nbiBldmFsRnJvbUl0ZW0oRXhwcmVzc2lvbiBleHAsIEpQUUxOb2RlIG5vZGUs\nCiAgICAgICAgYm9vbGVhbiBuZWVkc0FsaWFzKSB7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBjbWQgPSByZXNvbHZlQ2xhc3NNZXRhRGF0YShmaXJzdENoaWxk\nKG5vZGUpKTsKCiAgICAgICAgU3RyaW5nIGFsaWFzID0gbnVsbDsKCiAgICAg\nICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpIDwgMikgewogICAgICAgICAg\nICBpZiAobmVlZHNBbGlhcykKICAgICAgICAgICAgICAgIHRocm93IHBhcnNl\nRXhjZXB0aW9uKEVYX1VTRVIsICJhbGlhcy1yZXF1aXJlZCIsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjbWQgfSwgbnVsbCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxpYXMgPSByaWdodChub2RlKS50\nZXh0OwogICAgICAgICAgICBKUFFMTm9kZSBsZWZ0ID0gbGVmdChub2RlKTsK\nICAgICAgICAgICAgYWRkU2NoZW1hVG9Db250ZXh0KGFsaWFzLCBjbWQpOwoK\nICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSB3ZSBhcmUgcmVm\nZXJyaW5nIHRvIGEgcGF0aCBpbiB0aGUgZnJvbQogICAgICAgICAgICAvLyBj\nbGF1c2UsIHNpbmNlIHdlIG1pZ2h0IGJlIGluIGEgc3VicXVlcnkgYWdhaW5z\ndCBhIGNvbGxlY3Rpb24KICAgICAgICAgICAgaWYgKGlzUGF0aChsZWZ0KSkg\newogICAgICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChsZWZ0KTsK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRTdWJxdWVyeShhbGlhcywgcGF0\naCwgZXhwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIC8vIHdlIGhhdmUgYW4gYWxpYXM6IGJpbmQgaXQgYXMgYSB2YXJpYWJsZQog\nICAgICAgICAgICAgICAgVmFsdWUgdmFyID0gZ2V0VmFyaWFibGUoYWxpYXMs\nIHRydWUpOwogICAgICAgICAgICAgICAgdmFyLnNldE1ldGFEYXRhKGNtZCk7\nCiAgICAgICAgICAgICAgICBiaW5kKHZhcik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vICMjIyB3ZSBhc3NpZ24gdGhlIGZpcnN0IEZS\nT01JVEVNIGluc3RhbmNlIHdlIHNlZSBhcwogICAgICAgIC8vIHRoZSBnbG9i\nYWwgY2FuZGlkYXRlLCB3aGljaCBpcyBpbmNvcnJlY3Q6IHdlIHNob3VsZAog\nICAgICAgIC8vIGluc3RlYWQgYmUgbWFwcGluZyB0aGlzIHRvIHRoZSBTRUxF\nQ1RJVEVNIHRvIHNlZQogICAgICAgIC8vIHdoaWNoIGlzIHRoZSBkZXNpcmVk\nIGNhbmRpZGF0ZQogICAgICAgIGlmIChjdHgoKS5zY2hlbWFBbGlhcyA9PSBu\ndWxsKQogICAgICAgICAgICBzZXRDYW5kaWRhdGUoY21kLCBhbGlhcyk7Cgog\nICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaXNEZWNsYXJlZFZhcmlhYmxlKFN0cmluZyBuYW1lKSB7CiAgICAgICAg\nLy8gSlBRTCBkb2Vzbid0IHN1cHBvcnQgZGVjbGFyaW5nIHZhcmlhYmxlcwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENo\nZWNrIHRvIHNlZSBpZiB0aGUgc3BlY2lmaWMgbm9kZSBpcyBhIHBhdGggKHZz\nLiBhIHNjaGVtYSBuYW1lKQogICAgICovCiAgICBib29sZWFuIGlzUGF0aChK\nUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3Vu\ndCgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBm\naW5hbCBTdHJpbmcgbmFtZSA9IGZpcnN0Q2hpbGQobm9kZSkudGV4dDsKICAg\nICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY2xh\nc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAvLyBmb3IgdGhlIGNhbmRp\nZGF0ZSAod2UgZG9uJ3QgdXNlIHZhcmlhYmxlcyBmb3IgdGhpcykKICAgICAg\nICBpZiAoZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1lKSAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgaWYgKCFpc1NlZW5WYXJp\nYWJsZShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICBmaW5hbCBWYWx1ZSB2YXIgPSBnZXRWYXJpYWJsZShuYW1lLCBmYWxzZSk7\nCgogICAgICAgIGlmICh2YXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGlzQm91bmQodmFyKTsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIHByaXZhdGUgc3RhdGljIENsYXNzTWV0YURhdGEgZ2V0RmllbGRUeXBl\nKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBjbWQgPSBudWxsOwogICAgICAgIFZhbHVlTWV0YURhdGEgdm1kOwoK\nICAgICAgICBpZiAoKHZtZCA9IGZtZC5nZXRFbGVtZW50KCkpICE9IG51bGwp\nCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0\nYSgpOwogICAgICAgIGVsc2UgaWYgKCh2bWQgPSBmbWQuZ2V0S2V5KCkpICE9\nIG51bGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVN\nZXRhRGF0YSgpOwogICAgICAgIGVsc2UgaWYgKCh2bWQgPSBmbWQuZ2V0VmFs\ndWUoKSkgIT0gbnVsbCkKICAgICAgICAgICAgY21kID0gdm1kLmdldERlY2xh\ncmVkVHlwZU1ldGFEYXRhKCk7CgogICAgICAgIGlmIChjbWQgPT0gbnVsbCB8\nfCBjbWQuZ2V0RGVzY3JpYmVkVHlwZSgpID09IE9iamVjdC5jbGFzcykKICAg\nICAgICAgICAgY21kID0gZm1kLmdldERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7\nCgogICAgICAgIHJldHVybiBjbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nZGVudGlmaWNhdGlvbiB2YXJpYWJsZXMgaW4gSlBRTCBhcmUgY2FzZSBpbnNl\nbnNpdGl2ZSwgc28gbG93ZXItY2FzZQogICAgICogYWxsIHZhcmlhYmxlcyB3\nZSBhcmUgZ29pbmcgdG8gYmluZC4KICAgICAqLwogICAgcHJvdGVjdGVkIFZh\nbHVlIGdldFZhcmlhYmxlKFN0cmluZyBpZCwgYm9vbGVhbiBiaW5kKSB7CiAg\nICAgICAgaWYgKGlkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBpZiAoYmluZCAmJiBnZXREZWZpbmVkVmFyaWFibGUoaWQp\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVWYXJpYWJsZShp\nZCwgYmluZCk7CgogICAgICAgIHJldHVybiBzdXBlci5nZXRWYXJpYWJsZShp\nZC50b0xvd2VyQ2FzZSgpLCBiaW5kKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nVmFsdWUgZ2V0RGVmaW5lZFZhcmlhYmxlKFN0cmluZyBpZCkgewogICAgICAg\nIHJldHVybiBjdHgoKS5nZXRWYXJpYWJsZShpZCk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaXNTZWVuVmFyaWFibGUoU3RyaW5nIHZhcikgewog\nICAgICAgIENvbnRleHQgYyA9IGN0eCgpLmZpbmRDb250ZXh0KHZhcik7CiAg\nICAgICAgaWYgKGMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyB0aGUgY2xhc3MgbmFtZSB1c2luZyB0aGUgY2hpbGRyZW4gb2Yg\ndGhlIEpQUUxOb2RlLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBhc3Nl\ncnRTY2hlbWFOYW1lKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9k\nZS5pZCAhPSBKSlRBQlNUUkFDVFNDSEVNQU5BTUUpCiAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3QtaWRlbnRpZmVyIiwK\nICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSB9LCBudWxsKTsK\nCiAgICAgICAgcmV0dXJuIGFzc2VtYmxlKG5vZGUpOwogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBjaGVja0VtYmVkZGFibGUoVmFsdWUgdmFsKSB7CiAgICAg\nICAgY2hlY2tFbWJlZGRhYmxlKHZhbCwgY3VycmVudFF1ZXJ5KCkpOwogICAg\nfQogICAgCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY2hlY2tFbWJlZGRhYmxl\nKFZhbHVlIHZhbCwgU3RyaW5nIGN1cnJlbnRRdWVyeSkgewogICAgICAgIFBh\ndGggcGF0aCA9IHZhbCBpbnN0YW5jZW9mIFBhdGggPyAoUGF0aCkgdmFsIDog\nbnVsbDsKICAgICAgICBpZiAocGF0aCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5sYXN0\nKCk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIFZhbHVlTWV0YURhdGEgdm0gPSBmbWQuaXNFbGVtZW50\nQ29sbGVjdGlvbigpID8gZm1kLmdldEVsZW1lbnQoKQogICAgICAgICAgICA6\nIGZtZC5nZXRWYWx1ZSgpOwogICAgICAgIGlmICh2bS5nZXRFbWJlZGRlZE1l\ndGFEYXRhKCkgIT0gbnVsbCkgewogICAgICAgICAgICAvL3Rocm93IHBhcnNl\nRXhjZXB0aW9uKEVYX1VTRVIsICJiYWQtcHJlZGljYXRlIiwKICAgICAgICAg\nICAgLy8gICAgbmV3IE9iamVjdFtdeyBjdXJyZW50UXVlcnkoKSB9LCBudWxs\nKTsKICAgICAgICAgICAgU3RyaW5nIGFyZ1N0ciA9IF9sb2MuZ2V0KCJiYWQt\ncHJlZGljYXRlIiwgCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W10ge2Zt\nZC5nZXROYW1lKCl9KS5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIE1lc3Nh\nZ2UgbXNnID0gX2xvYy5nZXQoInBhcnNlLWVycm9yIiwgYXJnU3RyLCBjdXJy\nZW50UXVlcnkpOwogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihtc2csIG51bGwpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJlY3Vyc2l2ZSBoZWxwZXIgbWV0aG9kIHRvIGV2YWx1YXRlIHRoZSBnaXZl\nbiBub2RlLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBldmFsKEpQUUxO\nb2RlIG5vZGUpIHsKICAgICAgICBWYWx1ZSB2YWwxID0gbnVsbDsKICAgICAg\nICBWYWx1ZSB2YWwyID0gbnVsbDsKICAgICAgICBWYWx1ZSB2YWwzID0gbnVs\nbDsKCiAgICAgICAgYm9vbGVhbiBub3QgPSBub2RlLm5vdDsKCiAgICAgICAg\nc3dpdGNoIChub2RlLmlkKSB7CiAgICAgICAgICAgIGNhc2UgSkpUU0NBTEFS\nRVhQUkVTU0lPTjoKICAgICAgICAgICAgICAgIHJldHVybiBldmFsKG9ubHlD\naGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVFRZUEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0VHlwZShvbmx5Q2hpbGQobm9kZSkpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRUWVBFTElURVJBTDoKICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRUeXBlTGl0ZXJhbChub2RlKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUQ0xBU1NOQU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFBhdGhPckNvbnN0YW50KG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRD\nQVNFOgogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwob25seUNoaWxkKG5v\nZGUpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU0lNUExFQ0FTRToKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRTaW1wbGVDYXNlRXhwcmVzc2lvbihub2Rl\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUR0VORVJBTENBU0U6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0R2VuZXJhbENhc2VFeHByZXNzaW9uKG5vZGUp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRXSEVOOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGdldFdoZW5Db25kaXRpb24obm9kZSk7CgogICAgICAgICAgICBj\nYXNlIEpKVFdIRU5TQ0FMQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nV2hlblNjYWxhcihub2RlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09BTEVT\nQ0U6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q29hbGVzY2VFeHByZXNz\naW9uKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlROVUxMSUY6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0TnVsbElmRXhwcmVzc2lvbihub2RlKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUV0hFUkU6IC8vIHRvcC1sZXZlbCBXSEVS\nRSBjbGF1c2UKICAgICAgICAgICAgICAgIHJldHVybiBnZXRFeHByZXNzaW9u\nKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVEJPT0xF\nQU5MSVRFUkFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3\nTGl0ZXJhbCgidHJ1ZSIuZXF1YWxzSWdub3JlQ2FzZQogICAgICAgICAgICAg\nICAgICAgIChub2RlLnRleHQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRSwKICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVfQk9PTEVB\nTik7CgogICAgICAgICAgICBjYXNlIEpKVElOVEVHRVJMSVRFUkFMOgogICAg\nICAgICAgICAgICAgLy8gdXNlIEJpZ0RlY2ltYWwgYmVjYXVzZSBpdCBjYW4g\naGFuZGxlIHBhcnNpbmcgZXhwb25lbnRzCiAgICAgICAgICAgICAgICBCaWdE\nZWNpbWFsIGludGxpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAg\nICAgICAgKG5vZGUudGV4dC5lbmRzV2l0aCgibCIpIHx8IG5vZGUudGV4dC5l\nbmRzV2l0aCgiTCIpCiAgICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50\nZXh0LnN1YnN0cmluZygwLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAg\nICAgICAgICAgICAgICAgICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAg\nICAgICAgICAgbXVsdGlwbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9k\nZSkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVy\nYWwobmV3IExvbmcoaW50bGl0LmxvbmdWYWx1ZSgpKSwKICAgICAgICAgICAg\nICAgICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUREVDSU1BTExJVEVSQUw6CiAgICAgICAgICAgICAgICBCaWdEZWNp\nbWFsIGRlY2xpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAgICAg\nICAgKG5vZGUudGV4dC5lbmRzV2l0aCgiZCIpIHx8IG5vZGUudGV4dC5lbmRz\nV2l0aCgiRCIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudGV4\ndC5lbmRzV2l0aCgiZiIpIHx8IG5vZGUudGV4dC5lbmRzV2l0aCgiRiIpCiAg\nICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50ZXh0LnN1YnN0cmluZygw\nLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAgICAgICAgICAgICAgICAg\nICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAgICAgICAgICAgbXVsdGlw\nbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9kZSkpKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwoZGVjbGl0LCBMaXRl\ncmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1RSSU5H\nTElURVJBTDoKICAgICAgICAgICAgY2FzZSBKSlRUUklNQ0hBUkFDVEVSOgog\nICAgICAgICAgICBjYXNlIEpKVEVTQ0FQRUNIQVJBQ1RFUjoKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwodHJpbVF1b3Rlcyhu\nb2RlLnRleHQpLAogICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9T\nUV9TVFJJTkcpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRURVJOVkFMVUU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChmaXJzdENoaWxkKG5vZGUp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTkFNRURJTlBVVFBBUkFNRVRFUjoK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0ZXIobm9kZS50ZXh0\nLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgY2FzZSBKSlRQT1NJVElP\nTkFMSU5QVVRQQVJBTUVURVI6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nUGFyYW1ldGVyKG5vZGUudGV4dCwgdHJ1ZSwgZmFsc2UpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRDT0xMRUNUSU9OUEFSQU1FVEVSOgogICAgICAgICAgICAg\nICAgSlBRTE5vZGUgY2hpbGQgPSBvbmx5Q2hpbGQobm9kZSk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UGFyYW1ldGVyKGNoaWxkLnRleHQsIAogICAg\nICAgICAgICAgICAgICAgIGNoaWxkLmlkID09IEpKVFBPU0lUSU9OQUxJTlBV\nVFBBUkFNRVRFUiwgdHJ1ZSk7CgogICAgICAgICAgICBjYXNlIEpKVE9SOiAv\nLyB4IE9SIHkKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm9yKGdl\ndEV4cHJlc3Npb24obGVmdChub2RlKSksCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RXhwcmVzc2lvbihyaWdodChub2RlKSkpOwoKICAgICAgICAgICAgY2Fz\nZSBKSlRBTkQ6IC8vIHggQU5EIHkKICAgICAgICAgICAgICAgIHJldHVybiBh\nbmQoZ2V0RXhwcmVzc2lvbihsZWZ0KG5vZGUpKSwKICAgICAgICAgICAgICAg\nICAgICBnZXRFeHByZXNzaW9uKHJpZ2h0KG5vZGUpKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVEVRVUFMUzogLy8geCA9IHkKICAgICAgICAgICAgICAgIHZh\nbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZh\nbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBz\nZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkuZXF1YWwodmFsMSwgdmFsMik7CgogICAg\nICAgICAgICBjYXNlIEpKVE5PVEVRVUFMUzogLy8geCA8PiB5CiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAg\nICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAg\nICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5vdEVxdWFsKHZhbDEs\nIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRMRVNTVEhBTjogLy8geCA8\nIHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUp\nKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2Rl\nKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZh\nbDIsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubGVz\nc1RoYW4odmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVExFU1NP\nUkVRVUFMOiAvLyB4IDw9IHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRW\nYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRW\nYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNp\ndFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhY3RvcnkubGVzc1RoYW5FcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUR1JFQVRFUlRIQU46IC8vIHggPiB5CiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAg\nICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAg\nICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdyZWF0ZXJUaGFuKHZh\nbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRHUkVBVEVST1JFUVVB\nTDogLy8geCA+PSB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nbGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUo\ncmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBl\ncyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwgdmFsMik7CgogICAgICAg\nICAgICBjYXNlIEpKVEFERDogLy8geCArIHkKICAgICAgICAgICAgICAgIHZh\nbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZh\nbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBz\nZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFkZCh2YWwxLCB2YWwyKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUU1VCVFJBQ1Q6IC8vIHggLSB5CiAgICAg\nICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAg\nICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAg\nICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBF\nX05VTUJFUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdWJ0\ncmFjdCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTVVMVElQ\nTFk6IC8vIHggKiB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nbGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUo\ncmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBl\ncyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5tdWx0aXBseSh2YWwxLCB2YWwyKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpURElWSURFOiAvLyB4IC8geQogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZGl2aWRlKHZhbDEsIHZh\nbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRCRVRXRUVOOiAvLyB4LmZpZWxk\nIFtOT1RdIEJFVFdFRU4gNSBBTkQgMTAKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShjaGlsZChub2RlLCAwLCAzKSk7CiAgICAgICAgICAgICAg\nICB2YWwyID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMSwgMykpOwogICAgICAg\nICAgICAgICAgdmFsMyA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDIsIDMpKTsK\nICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwg\nbnVsbCk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEs\nIHZhbDMsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWxOb3Qo\nbm90LCBhbmQoZmFjdG9yeS5ncmVhdGVyVGhhbkVxdWFsKHZhbDEsIHZhbDIp\nLAogICAgICAgICAgICAgICAgICAgIGZhY3RvcnkubGVzc1RoYW5FcXVhbCh2\nYWwxLCB2YWwzKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRJTjogLy8geC5m\naWVsZCBbTk9UXSBJTiAoJ2EnLCAnYicsICdjJykKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gVFlQRSh4Li4uKSBbTk9UXSBJTiAoZW50aXR5VHlwZUxp\ndGVyYWwxLC4uLikKICAgICAgICAgICAgICAgIEV4cHJlc3Npb24gaW5FeHAg\nPSBudWxsOwogICAgICAgICAgICAgICAgSXRlcmF0b3I8SlBRTE5vZGU+IGlu\nSXRlcmF0b3IgPSBub2RlLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAv\nLyB0aGUgZmlyc3QgY2hpbGQgaXMgdGhlIHBhdGgKICAgICAgICAgICAgICAg\nIEpQUUxOb2RlIGZpcnN0ID0gaW5JdGVyYXRvci5uZXh0KCk7CiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUoZmlyc3QpOwoKICAgICAgICAgICAg\nICAgIHdoaWxlIChpbkl0ZXJhdG9yLmhhc05leHQoKSkgewogICAgICAgICAg\nICAgICAgICAgIEpQUUxOb2RlIG5leHQgPSBpbkl0ZXJhdG9yLm5leHQoKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3QuaWQgPT0gSkpUVFlQRSAm\nJiBuZXh0LmlkID09IEpKVFRZUEVMSVRFUkFMKQogICAgICAgICAgICAgICAg\nICAgICAgICB2YWwyID0gZ2V0VHlwZUxpdGVyYWwobmV4dCk7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB2YWwy\nID0gZ2V0VmFsdWUobmV4dCk7CgogICAgICAgICAgICAgICAgICAgIC8vIHNw\nZWNpYWwgY2FzZSBmb3IgPHZhbHVlPiBJTiAoPHN1YnF1ZXJ5Pikgb3IKICAg\nICAgICAgICAgICAgICAgICAvLyA8dmFsdWU+IElOICg8c2luZ2xlIHZhbHVl\nPikKICAgICAgICAgICAgICAgICAgICBpZiAoISh2YWwyIGluc3RhbmNlb2Yg\nTGl0ZXJhbCkgJiYgbm9kZS5nZXRDaGlsZENvdW50KCkgPT0gMikKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2YWxOb3Qobm90LCBmYWN0b3J5\nLmNvbnRhaW5zKHZhbDIsIHZhbDEpKTsgCgogICAgICAgICAgICAgICAgICAg\nIC8vIHRoaXMgaXMgY3VycmVudGx5IGEgc2VxdWVuY2Ugb2YgT1IgZXhwcmVz\nc2lvbnMsIHNpbmNlIHdlCiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90\nIGhhdmUgc3VwcG9ydCBmb3IgSU4gZXhwcmVzc2lvbnMKICAgICAgICAgICAg\nICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChpbkV4cCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBpbkV4cCA9IGZhY3RvcnkuZXF1YWwodmFsMSwg\ndmFsMik7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICBpbkV4cCA9IGZhY3Rvcnkub3IoaW5FeHAsIGZhY3Rvcnku\nZXF1YWwodmFsMSwgdmFsMikpOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIC8vIHdlIGFkZGl0aW9uYWxseSBuZWVkIHRvIGFkZCBpbiBh\nICJOT1QgTlVMTCIgY2xhdXNlLCBzaW5jZQogICAgICAgICAgICAgICAgLy8g\ndGhlIElOIGJlaGF2aW9yIHRoYXQgaXMgZXhwZWN0ZWQgYnkgdGhlIENUUyBh\nbHNvIGV4cGVjdHMKICAgICAgICAgICAgICAgIC8vIHRvIGZpbHRlciBvdXIg\nTlVMTHMKICAgICAgICAgICAgICAgIHJldHVybiBhbmQoZXZhbE5vdChub3Qs\nIGluRXhwKSwKICAgICAgICAgICAgICAgICAgICBmYWN0b3J5Lm5vdEVxdWFs\nKHZhbDEsIGZhY3RvcnkuZ2V0TnVsbCgpKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVElTTlVMTDogLy8geC5maWVsZCBJUyBbTk9UXSBOVUxMCiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKTsKICAg\nICAgICAgICAgICAgIGNoZWNrRW1iZWRkYWJsZSh2YWwxKTsKICAgICAgICAg\nICAgICAgIGlmIChub3QpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3Rvcnkubm90RXF1YWwKICAgICAgICAgICAgICAgICAgICAgICAgKHZhbDEs\nIGZhY3RvcnkuZ2V0TnVsbCgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbAogICAgICAg\nICAgICAgICAgICAgICAgICAodmFsMSwgZmFjdG9yeS5nZXROdWxsKCkpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRQQVRIOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFBhdGhPckNvbnN0YW50KG5vZGUpOwoKICAgICAgICAgICAgY2Fz\nZSBKSlRJREVOVElGSUVSOgogICAgICAgICAgICBjYXNlIEpKVElERU5USUZJ\nQ0FUSU9OVkFSSUFCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0SWRl\nbnRpZmllcihub2RlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUUVVBTElGSUVE\nUEFUSDoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRRdWFsaWZpZWRQYXRo\nKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRRVUFMSUZJRURJREVOVElG\nSUVSOgogICAgICAgICAgICAgICAgLy8gS0VZKGUpLCBWQUxVRShlKSwgRU5U\nUlkoZSkKICAgICAgICAgICAgICAgIHJldHVybiBnZXRRdWFsaWZpZWRJZGVu\ndGlmaWVyKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRHRU5FUkFMSURF\nTlRJRklFUjoKICAgICAgICAgICAgICAgIC8vIEtFWShlKSwgVkFMVUUoZSkK\nICAgICAgICAgICAgICAgIGlmIChub2RlLnBhcmVudC5wYXJlbnQuaWQgPT0g\nSkpUV0hFUkUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEdlbmVy\nYWxJZGVudGlmaWVyKG9ubHlDaGlsZChub2RlKSwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UXVhbGlmaWVkSWRlbnRpZmllcihvbmx5Q2hp\nbGQobm9kZSkpOwoKICAgICAgICAgICAgY2FzZSBKSlROT1Q6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5ub3QoZ2V0RXhwcmVzc2lvbihvbmx5\nQ2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTElLRTogLy8g\nZmllbGQgTElLRSAnJXNvbWV2YWwlJwogICAgICAgICAgICAgICAgdmFsMSA9\nIGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9\nIGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKCiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIFRZUEVfU1RSSU5HKTsKCiAgICAg\nICAgICAgICAgICAvLyBsb29rIGZvciBhbiBlc2NhcGUgY2hhcmFjdGVyIGJl\nbmVhdGggdGhlIG5vZGUKICAgICAgICAgICAgICAgIFN0cmluZyBlc2NhcGUg\nPSBudWxsOwogICAgICAgICAgICAgICAgSlBRTE5vZGUgZXNjYXBlTm9kZSA9\nIHJpZ2h0KG5vZGUpLgogICAgICAgICAgICAgICAgICAgIGZpbmRDaGlsZEJ5\nSUQoSkpURVNDQVBFQ0hBUkFDVEVSLCB0cnVlKTsKICAgICAgICAgICAgICAg\nIGlmIChlc2NhcGVOb2RlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nZXNjYXBlID0gdHJpbVF1b3Rlcyhvbmx5Q2hpbGQoZXNjYXBlTm9kZSkudGV4\ndCk7CgogICAgICAgICAgICAgICAgaWYgKG5vdCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5ub3RNYXRjaGVzKHZhbDEsIHZhbDIsICJf\nIiwgIiUiLCBlc2NhcGUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm1hdGNoZXModmFsMSwgdmFs\nMiwgIl8iLCAiJSIsIGVzY2FwZSk7CgogICAgICAgICAgICBjYXNlIEpKVElT\nRU1QVFk6CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsCiAg\nICAgICAgICAgICAgICAgICAgZmFjdG9yeS5pc0VtcHR5KGdldFZhbHVlKG9u\nbHlDaGlsZChub2RlKSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU0laRToK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnNpemUoZ2V0VmFsdWUo\nb25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVElOREVY\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuaW5kZXgoZ2V0VmFs\ndWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFVQ\nUEVSOgogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKG9ubHlDaGls\nZChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFs\nMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkudG9VcHBlckNhc2UodmFsMSk7CgogICAgICAgICAgICBjYXNlIEpKVExP\nV0VSOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudG9Mb3dlckNh\nc2UoZ2V0U3RyaW5nVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAg\nICAgICBjYXNlIEpKVExFTkdUSDoKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LnN0cmluZ0xlbmd0aChnZXRTdHJpbmdWYWx1ZShvbmx5Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQUJTOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkuYWJzKGdldE51bWJlclZhbHVlKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTUVJUOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkuc3FydChnZXROdW1iZXJWYWx1\nZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTU9E\nOgogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkp\nOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUp\nKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFs\nMiwgVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkubW9kKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRUUklN\nOiAvLyBUUklNKFtbd2hlcmVdIFtjaGFyXSBGUk9NXSBmaWVsZCkKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsYXN0Q2hpbGQobm9kZSkpOwog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RS\nSU5HKTsKCiAgICAgICAgICAgICAgICBCb29sZWFuIHRyaW1XaGVyZSA9IG51\nbGw7CgogICAgICAgICAgICAgICAgSlBRTE5vZGUgZmlyc3RUcmltQ2hpbGQg\nPSBmaXJzdENoaWxkKG5vZGUpOwoKICAgICAgICAgICAgICAgIGlmIChub2Rl\nLmdldENoaWxkQ291bnQoKSA+IDEpIHsKICAgICAgICAgICAgICAgICAgICB0\ncmltV2hlcmUgPQogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdFRyaW1D\naGlsZC5pZCA9PSBKSlRUUklNTEVBRElORyA/IEJvb2xlYW4uVFJVRQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgOgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZmlyc3RUcmltQ2hpbGQuaWQgPT0gSkpUVFJJTVRSQUlMSU5H\nID8gQm9vbGVhbi5GQUxTRQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIDogbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICBWYWx1ZSB0cmltQ2hhcjsKCiAgICAgICAgICAgICAgICAvLyBpZiB0aGVy\nZSBhcmUgMyBjaGlsZHJlbiwgdGhlbiB3ZSBrbm93IHRoZSB0cmltCiAgICAg\nICAgICAgICAgICAvLyBjaGFyIGlzIHRoZSBzZWNvbmQgbm9kZQogICAgICAg\nICAgICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID09IDMpCiAgICAg\nICAgICAgICAgICAgICAgdHJpbUNoYXIgPSBnZXRWYWx1ZShzZWNvbmRDaGls\nZChub2RlKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJl\nIHR3byBjaGlsZHJlbiwgdGhlbiB3ZSBuZWVkIHRvIGNoZWNrIHRvIHNlZQog\nICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBmaXJzdCBjaGlsZCBpcyBh\nIGxlYWRpbmcvdHJhaWxpbmcvYm90aCBub2RlLAogICAgICAgICAgICAgICAg\nICAgIC8vIG9yIHRoZSB0cmltIGNoYXJhY3RlciBub2RlCiAgICAgICAgICAg\nICAgICBlbHNlIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA9PSAyCiAgICAg\nICAgICAgICAgICAgICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJ\nTUxFQURJTkcKICAgICAgICAgICAgICAgICAgICAmJiBmaXJzdFRyaW1DaGls\nZC5pZCAhPSBKSlRUUklNVFJBSUxJTkcKICAgICAgICAgICAgICAgICAgICAm\nJiBmaXJzdFRyaW1DaGlsZC5pZCAhPSBKSlRUUklNQk9USCkKICAgICAgICAg\nICAgICAgICAgICB0cmltQ2hhciA9IGdldFZhbHVlKGZpcnN0Q2hpbGQobm9k\nZSkpOwogICAgICAgICAgICAgICAgICAgIC8vIG90aHdlcndpc2UsIHdlIGRl\nZmF1bHQgdG8gdHJpbW1pbmcgdGhlIHNwYWNlIGNoYXJhY3RlcgogICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRyaW1DaGFyID0g\nZmFjdG9yeS5uZXdMaXRlcmFsKCIgIiwgTGl0ZXJhbC5UWVBFX1NUUklORyk7\nCgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudHJpbSh2YWwxLCB0\ncmltQ2hhciwgdHJpbVdoZXJlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09O\nQ0FUOgogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9k\nZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5v\nZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwxLCBU\nWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUo\ndmFsMiwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3RvcnkuY29uY2F0KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRTVUJTVFJJTkc6CiAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJl\nbi5sZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgICAgIHZhbDEgPSBn\nZXRWYWx1ZShjaGlsZChub2RlLCAwLCAzKSk7CiAgICAgICAgICAgICAgICAg\nICAgdmFsMiA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDEsIDMpKTsKICAgICAg\nICAgICAgICAgICAgICB2YWwzID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMiwg\nMykpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLmNoaWxkcmVu\nLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsMSA9IGdl\ndFZhbHVlKGNoaWxkKG5vZGUsIDAsIDIpKTsKICAgICAgICAgICAgICAgICAg\nICB2YWwyID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMSwgMikpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZh\nbDEsIFRZUEVfU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZSh2YWwyLCBJbnRlZ2VyLlRZUEUpOwogICAgICAgICAgICAgICAgaWYg\nKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09IDMpCiAgICAgICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDMsIEludGVnZXIuVFlQRSk7CgogICAg\nICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnRTdWJzdHJpbmdBcmd1bWVudHMo\nZmFjdG9yeSwgdmFsMSwgdmFsMiwgdmFsMyk7CgogICAgICAgICAgICBjYXNl\nIEpKVExPQ0FURToKICAgICAgICAgICAgICAgIC8vIGFzIHdpdGggU1VCU1RS\nSU5HIChhYm92ZSksIHRoZSBzZW1hbnRpY3MgZm9yIExPQ0FURSBkaWZmZXIK\nICAgICAgICAgICAgICAgIC8vIGZyb20gRXhwcmVzc2lvbkZhY3RvcnkuaW5k\nZXhPZiBpbiB0aGF0IExPQ0FURSB1c2VzIGEKICAgICAgICAgICAgICAgIC8v\nIDAtYmFzZWQgaW5kZXgsIGFuZCBpbmRleE9mIHVzZXMgYSAxLWJhc2VkIGlu\nZGV4CiAgICAgICAgICAgICAgICBWYWx1ZSBsb2NhdGVQYXRoID0gZ2V0VmFs\ndWUoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAgICAgICBWYWx1ZSBs\nb2NhdGVTZWFyY2ggPSBnZXRWYWx1ZShzZWNvbmRDaGlsZChub2RlKSk7CiAg\nICAgICAgICAgICAgICBWYWx1ZSBsb2NhdGVGcm9tSW5kZXggPSBudWxsOwog\nICAgICAgICAgICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID4gMikg\nLy8gb3B0aW9uYWwgc3RhcnQgaW5kZXggYXJnCiAgICAgICAgICAgICAgICAg\nICAgbG9jYXRlRnJvbUluZGV4ID0gZ2V0VmFsdWUodGhpcmRDaGlsZChub2Rl\nKSk7CgogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKGxvY2F0ZVBh\ndGgsIFRZUEVfU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZShsb2NhdGVTZWFyY2gsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAg\nICAgICBpZiAobG9jYXRlRnJvbUluZGV4ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgc2V0SW1wbGljaXRUeXBlKGxvY2F0ZUZyb21JbmRleCwgVFlQ\nRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFk\nZChmYWN0b3J5LmluZGV4T2YobG9jYXRlU2VhcmNoLAogICAgICAgICAgICAg\nICAgICAgIGxvY2F0ZUZyb21JbmRleCA9PSBudWxsID8gbG9jYXRlUGF0aAog\nICAgICAgICAgICAgICAgICAgICAgICA6IGZhY3RvcnkubmV3QXJndW1lbnRM\naXN0KGxvY2F0ZVBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rv\ncnkuc3VidHJhY3QobG9jYXRlRnJvbUluZGV4LAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZmFjdG9yeS5uZXdMaXRlcmFsKE51bWJlcnMudmFsdWVP\nZigxKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXRlcmFs\nLlRZUEVfTlVNQkVSKSkpKSwKICAgICAgICAgICAgICAgICAgICBmYWN0b3J5\nLm5ld0xpdGVyYWwoTnVtYmVycy52YWx1ZU9mKDEpLAogICAgICAgICAgICAg\nICAgICAgICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVEFHR1JFR0FURToKICAgICAgICAgICAgICAgIC8vIHNpbXBs\neSBwYXNzLXRocm91Z2ggd2hpbGUgYXNzZXJ0aW5nIGEgc2luZ2xlIGNoaWxk\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9kZSkp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRDT1VOVDoKICAgICAgICAgICAgICAg\nIEpQUUxOb2RlIGMgPSBsYXN0Q2hpbGQobm9kZSk7CiAgICAgICAgICAgICAg\nICBpZiAoYy5pZCA9PSBKSlRJREVOVElGSUVSKQogICAgICAgICAgICAgICAg\nICAgIC8vIGNvdW50KGUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3RvcnkuY291bnQoZ2V0UGF0aChub2RlLCBmYWxzZSwgdHJ1ZSkpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuY291bnQoZ2V0VmFsdWUoYykp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRNQVg6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5tYXgoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5v\nZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVE1JTjoKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWN0b3J5Lm1pbihnZXROdW1iZXJWYWx1ZShvbmx5Q2hp\nbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1VNOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3Rvcnkuc3VtKGdldE51bWJlclZhbHVlKG9u\nbHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBVkVSQUdF\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYXZnKGdldE51bWJl\nclZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRESVNUSU5DVFBBVEg6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5kaXN0aW5jdChnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpURVhJU1RTOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkuaXNOb3RFbXB0eSgoVmFsdWUpIGV2YWwob25seUNoaWxkKG5v\nZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFOWToKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWN0b3J5LmFueSgoVmFsdWUpIGV2YWwob25seUNoaWxk\nKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFMTDoKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5LmFsbCgoVmFsdWUpIGV2YWwob25seUNo\naWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFNVQlNFTEVDVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRTdWJxdWVyeShub2RlKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUTUVNQkVST0Y6CiAgICAgICAgICAgICAgICB2\nYWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSwgVkFSX1BBVEgpOwogICAgICAg\nICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpLCBWQVJfUEFU\nSCk7CiAgICAgICAgICAgICAgICBjaGVja0VtYmVkZGFibGUodmFsMik7CiAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdENvbnRhaW5zVHlwZXModmFsMiwg\ndmFsMSwgQ09OVEFJTlNfVFlQRV9FTEVNRU5UKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBldmFsTm90KG5vdCwgZmFjdG9yeS5jb250YWlucyh2YWwyLCB2\nYWwxKSk7CgogICAgICAgICAgICBjYXNlIEpKVENVUlJFTlREQVRFOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVudERhdGUoKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUQ1VSUkVOVFRJTUU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5nZXRDdXJyZW50VGltZSgpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRDVVJSRU5UVElNRVNUQU1QOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVudFRpbWVzdGFtcCgpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRTRUxFQ1RFWFRFTlNJT046CiAgICAgICAgICAg\nICAgICBhc3NlcnRRdWVyeUV4dGVuc2lvbnMoIlNFTEVDVCIpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGV2YWwob25seUNoaWxkKG5vZGUpKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUR1JPVVBCWUVYVEVOU0lPTjoKICAgICAgICAgICAg\nICAgIGFzc2VydFF1ZXJ5RXh0ZW5zaW9ucygiR1JPVVAgQlkiKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBldmFsKG9ubHlDaGlsZChub2RlKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVE9SREVSQllFWFRFTlNJT046CiAgICAgICAgICAg\nICAgICBhc3NlcnRRdWVyeUV4dGVuc2lvbnMoIk9SREVSIEJZIik7CiAgICAg\nICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9kZSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlREQVRFTElURVJBTDoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwobm9kZS50ZXh0LCBMaXRlcmFs\nLlRZUEVfREFURSk7CgogICAgICAgICAgICBjYXNlIEpKVFRJTUVMSVRFUkFM\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0ZXJhbChu\nb2RlLnRleHQsIExpdGVyYWwuVFlQRV9USU1FKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUVElNRVNUQU1QTElURVJBTDogICAgCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFsKG5vZGUudGV4dCwgTGl0ZXJhbC5U\nWVBFX1RJTUVTVEFNUCk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfRkFUQUwsICJiYWQt\ndHJlZSIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2Rl\nIH0sIG51bGwpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBDb252ZXJ0cyBKUFFMIHN1YnN0cmluZygpIGZ1bmN0aW9uIHRvIE9wZW5K\nUEEgRXhwcmVzc2lvbkZhY3RvcnkgCiAgICAgKiBzdWJzdHJpbmcoKSBhcmd1\nbWVudHMuCiAgICAgKiAKICAgICAqIFRoZSBzZW1hbnRpY3Mgb2YgdGhlIEpQ\nUUwgc3Vic3RyaW5nKCkgZnVuY3Rpb24gYXJlIHRoYXQgYXJnMiBpcyB0aGUg\nCiAgICAgKiAxLWJhc2VkIHN0YXJ0IGluZGV4LCBhbmQgYXJnMyBpcyB0aGUg\nbGVuZ3RoIG9mIHRoZSBzdHJpbmcgdG8gYmUgcmV0dXJuLgogICAgICogVGhp\ncyBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgc2VtYW50aWNzIG9mIHRoZSBFeHBy\nZXNzaW9uRmFjdG9yeSdzIAogICAgICogc3Vic3RyaW5nKCksIHdoaWNoIG1h\ndGNoZXMgdGhlIEphdmEgbGFuZ3VhZ2UgKDAtYmFzZWQgc3RhcnQgaW5kZXgs\nCiAgICAgKiBhcmcyIGlzIHRoZSBlbmQgaW5kZXgpOiB3ZSBwZXJmb3JtIHRo\nZSB0cmFuc2xhdGlvbiBieSBhZGRpbmcgb25lIHRvIHRoZSAKICAgICAqIGZp\ncnN0IGFyZ3VtZW50LCBhbmQgdGhlbiBhZGRpbmcgdGhlIGZpcnN0IGFyZ3Vt\nZW50IHRvIHRoZSBzZWNvbmQgIAogICAgICogYXJndW1lbnQgdG8gZ2V0IHRo\nZSBlbmRJbmRleC4KICAgICAqIAogICAgICogQHBhcmFtIHZhbDEgdGhlIG9y\naWdpbmFsIFN0cmluZwogICAgICogQHBhcmFtIHZhbDIgdGhlIDEtYmFzZWQg\nc3RhcnQgaW5kZXggYXMgcGVyIEpQUUwgc3Vic3RyaW5nKCkgc2VtYW50aWNz\nCiAgICAgKiBAcGFyYW0gdmFsMyB0aGUgbGVuZ3RoIG9mIHRoZSByZXR1cm5l\nZCBzdHJpbmcgYXMgcGVyIEpQUUwgc2VtYW50aWNzCiAgICAgKiAKICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBWYWx1ZSBjb252ZXJ0U3Vic3RyaW5nQXJn\ndW1lbnRzKEV4cHJlc3Npb25GYWN0b3J5IGZhY3RvcnksIAogICAgCQlWYWx1\nZSB2YWwxLCBWYWx1ZSB2YWwyLCBWYWx1ZSB2YWwzKSB7CiAgICAgICAgVmFs\ndWUgc3RhcnQgPSBudWxsOwogICAgICAgIFZhbHVlIGVuZCA9IG51bGw7CiAg\nICAgICAgaWYgKHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsICYmIAogICAgICAg\nICAgICAodmFsMyA9PSBudWxsIHx8IHZhbDMgaW5zdGFuY2VvZiBMaXRlcmFs\nKSkgewogICAgICAgICAgICAvLyBvcHRpbWl6ZSBTUUwgZm9yIHRoZSBjb21t\nb24gY2FzZSBvZiB0d28gbGl0ZXJhbHMKICAgICAgICAgICAgbG9uZyBqcHFs\nU3RhcnQgPSAoKE51bWJlcikgKChMaXRlcmFsKSB2YWwyKS5nZXRWYWx1ZSgp\nKQogICAgICAgICAgICAgICAgLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICBz\ndGFydCA9IGZhY3RvcnkubmV3TGl0ZXJhbChuZXcgTG9uZyhqcHFsU3RhcnQg\nLSAxKSwKICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpOwog\nICAgICAgICAgICBpZiAodmFsMyAhPSBudWxsKSB7CiAgICAgICAgICAgIAls\nb25nIGxlbmd0aCA9ICgoTnVtYmVyKSAoKExpdGVyYWwpIHZhbDMpLmdldFZh\nbHVlKCkpCiAgICAgICAgICAgICAgICAgICAgLmxvbmdWYWx1ZSgpOwogICAg\nICAgICAgICBsb25nIGVuZEluZGV4ID0gbGVuZ3RoICsgKGpwcWxTdGFydCAt\nIDEpOwogICAgICAgICAgICBlbmQgPSBmYWN0b3J5Lm5ld0xpdGVyYWwobmV3\nIExvbmcoZW5kSW5kZXgpLAogICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBF\nX05VTUJFUik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBzdGFydCA9IGZhY3Rvcnkuc3VidHJhY3QodmFsMiwgZmFjdG9y\neS5uZXdMaXRlcmFsCiAgICAgICAgICAgICAgICAoTnVtYmVycy52YWx1ZU9m\nKDEpLCBMaXRlcmFsLlRZUEVfTlVNQkVSKSk7CiAgICAgICAgICAgIGlmICh2\nYWwzICE9IG51bGwpCiAgICAgICAgICAgIGVuZCA9IGZhY3RvcnkuYWRkKHZh\nbDMsCiAgICAgICAgICAgICAgICAoZmFjdG9yeS5zdWJ0cmFjdCh2YWwyLCBm\nYWN0b3J5Lm5ld0xpdGVyYWwKICAgICAgICAgICAgICAgICAgICAoTnVtYmVy\ncy52YWx1ZU9mKDEpLCBMaXRlcmFsLlRZUEVfTlVNQkVSKSkpKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKHZhbDMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGZhY3Rvcnkuc3Vic3RyaW5nKHZhbDEsIGZhY3RvcnkubmV3QXJndW1l\nbnRMaXN0KHN0YXJ0LCBlbmQpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5LnN1YnN0cmluZyh2YWwxLCBzdGFydCk7CiAgICAJ\nCiAgICB9CiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0UXVlcnlFeHRlbnNpb25z\nKFN0cmluZyBjbGF1c2UpIHsKICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlv\nbiBjb25mID0gcmVzb2x2ZXIuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAg\nIHN3aXRjaChjb25mLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpLmdldEpQ\nUUwoKSkgewogICAgICAgICAgICBjYXNlIENvbXBhdGliaWxpdHkuSlBRTF9X\nQVJOOgogICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgd2UndmUgYWxyZWFk\neSB3YXJuZWQgZm9yIHRoaXMgcXVlcnktZmFjdG9yeSBjb21ibwogICAgICAg\nICAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHJlc29sdmVyLmdldFF1ZXJ5\nQ29udGV4dCgpLmdldFN0b3JlQ29udGV4dCgpOwogICAgICAgICAgICAgICAg\nU3RyaW5nIHF1ZXJ5ID0gY3VycmVudFF1ZXJ5KCk7CiAgICAgICAgICAgICAg\nICBpZiAoY3R4LmdldEJyb2tlcigpICE9IG51bGwgJiYgcXVlcnkgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBrZXkgPSBnZXRDbGFz\ncygpLmdldE5hbWUoKSArICI6IiArIHF1ZXJ5OwogICAgICAgICAgICAgICAg\nICAgIEJyb2tlckZhY3RvcnkgZmFjdG9yeSA9IGN0eC5nZXRCcm9rZXIoKS5n\nZXRCcm9rZXJGYWN0b3J5KCk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0\nIGhhc1dhcm5lZCA9IGZhY3RvcnkuZ2V0VXNlck9iamVjdChrZXkpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChoYXNXYXJuZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmYWN0b3J5LnB1dFVzZXJP\nYmplY3Qoa2V5LCBCb29sZWFuLlRSVUUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFD\nb25maWd1cmF0aW9uLkxPR19RVUVSWSk7CiAgICAgICAgICAgICAgICBpZiAo\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cu\nd2FybihfbG9jLmdldCgicXVlcnktZXh0ZW5zaW9ucy13YXJuaW5nIiwgY2xh\ndXNlLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UXVlcnkoKSkp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQ29t\ncGF0aWJpbGl0eS5KUFFMX1NUUklDVDoKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBQYXJzZUV4Y2VwdGlvbihfbG9jLmdldCgicXVlcnktZXh0ZW5zaW9u\ncy1lcnJvciIsCiAgICAgICAgICAgICAgICAgICAgY2xhdXNlLCBjdXJyZW50\nUXVlcnkoKSkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgY2FzZSBDb21w\nYXRpYmlsaXR5LkpQUUxfRVhURU5ERUQ6CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAg\nICAgIkNvbXBhdGliaWxpdHkuZ2V0SlBRTCgpID09ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgKyBjb25mLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgp\nLmdldEpQUUwoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldEltcGxpY2l0VHlwZXMoVmFsdWUgdmFsMSwgVmFsdWUgdmFsMiwgCiAg\nICAgICAgQ2xhc3M8Pz4gZXhwZWN0ZWQpIHsKICAgICAgICBTdHJpbmcgY3Vy\nclF1ZXJ5ID0gY3VycmVudFF1ZXJ5KCk7CiAgICAgICAgc2V0SW1wbGljaXRU\neXBlcyh2YWwxLCB2YWwyLCBleHBlY3RlZCwgcmVzb2x2ZXIsIHBhcmFtZXRl\nclR5cGVzLCAKICAgICAgICAgICAgY3VyclF1ZXJ5KTsKICAgIH0KICAgIAog\nICAgCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgc2V0SW1wbGljaXRUeXBlcyhW\nYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyLCAKICAgICAgICBDbGFzczw/PiBleHBl\nY3RlZCwgUmVzb2x2ZXIgcmVzb2x2ZXIsIExpbmtlZE1hcCBwYXJhbWV0ZXJU\neXBlcywKICAgICAgICBTdHJpbmcgY3VycmVudFF1ZXJ5KSB7CiAgICAgICAg\nQWJzdHJhY3RFeHByZXNzaW9uQnVpbGRlci5zZXRJbXBsaWNpdFR5cGVzKHZh\nbDEsIHZhbDIsIGV4cGVjdGVkLCAKICAgICAgICAgICAgcmVzb2x2ZXIpOwoK\nICAgICAgICAvLyBhcyB3ZWxsIGFzIHNldHRpbmcgdGhlIHR5cGVzIGZvciBj\nb252ZXJzaW9ucywgd2UgYWxzbyBuZWVkIHRvCiAgICAgICAgLy8gZW5zdXJl\nIHRoYXQgYW55IHBhcmFtZXRlcnMgYXJlIGRlY2xhcmVkIHdpdGggdGhlIGNv\ncnJlY3QgdHlwZSwKICAgICAgICAvLyBzaW5jZSB0aGUgSlBBIHNwZWMgZXhw\nZWN0cyB0aGF0IHRoZXNlIHdpbGwgYmUgdmFsaWRhdGVkCiAgICAgICAgUGFy\nYW1ldGVyIHBhcmFtID0gdmFsMSBpbnN0YW5jZW9mIFBhcmFtZXRlciA/IChQ\nYXJhbWV0ZXIpIHZhbDEKICAgICAgICAgICAgOiB2YWwyIGluc3RhbmNlb2Yg\nUGFyYW1ldGVyID8gKFBhcmFtZXRlcikgdmFsMiA6IG51bGw7CiAgICAgICAg\nUGF0aCBwYXRoID0gdmFsMSBpbnN0YW5jZW9mIFBhdGggPyAoUGF0aCkgdmFs\nMQogICAgICAgICAgICA6IHZhbDIgaW5zdGFuY2VvZiBQYXRoID8gKFBhdGgp\nIHZhbDIgOiBudWxsOwoKICAgICAgICAvLyB3ZSBvbmx5IGNoZWNrIGZvciBw\nYXJhbWV0ZXItdG8tcGF0aCBjb21wYXJpc29ucwogICAgICAgIGlmIChwYXJh\nbSA9PSBudWxsIHx8IHBhdGggPT0gbnVsbCB8fCBwYXJhbWV0ZXJUeXBlcyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gcGF0aC5sYXN0KCk7CiAgICAgICAgaWYgKGZtZCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChleHBlY3Rl\nZCA9PSBudWxsKQogICAgICAgICAgICBjaGVja0VtYmVkZGFibGUocGF0aCwg\nY3VycmVudFF1ZXJ5KTsKCiAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IHBhdGgu\nZ2V0VHlwZSgpOwogICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgT2JqZWN0IHBhcmFtS2V5ID0gcGFyYW0u\nZ2V0UGFyYW1ldGVyS2V5KCk7CiAgICAgICAgaWYgKHBhcmFtS2V5ID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gbWFrZSBzdXJl\nIHdlIGhhdmUgYWxyZWFkeSBkZWNsYXJlZCB0aGUgcGFyYW1ldGVyCiAgICAg\nICAgaWYgKHBhcmFtZXRlclR5cGVzLmNvbnRhaW5zS2V5KHBhcmFtS2V5KSkK\nICAgICAgICAgICAgcGFyYW1ldGVyVHlwZXMucHV0KHBhcmFtS2V5LCB0eXBl\nKTsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFN0cmluZ1ZhbHVlKEpQ\nUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gZ2V0VHlwZVZhbHVlKG5v\nZGUsIFRZUEVfU1RSSU5HKTsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdl\ndE51bWJlclZhbHVlKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4g\nZ2V0VHlwZVZhbHVlKG5vZGUsIFRZUEVfTlVNQkVSKTsKICAgIH0KCiAgICBw\ncml2YXRlIFZhbHVlIGdldFR5cGVWYWx1ZShKUFFMTm9kZSBub2RlLCBDbGFz\nczw/PiBpbXBsaWNpdFR5cGUpIHsKICAgICAgICBWYWx1ZSB2YWwgPSBnZXRW\nYWx1ZShub2RlKTsKICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsLCBpbXBs\naWNpdFR5cGUpOwogICAgICAgIHJldHVybiB2YWw7CiAgICB9CgogICAgcHJp\ndmF0ZSBWYWx1ZSBnZXRTdWJxdWVyeShKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgZmluYWwgYm9vbGVhbiBzdWJjbGFzc2VzID0gdHJ1ZTsKCiAgICAgICAg\nLy8gcGFyc2UgdGhlIHN1YnF1ZXJ5CiAgICAgICAgUGFyc2VkSlBRTCBwYXJz\nZWQgPSBuZXcgUGFyc2VkSlBRTChub2RlLnBhcnNlci5qcHFsLCBub2RlKTsK\nICAgICAgICBDb250ZXh0IHN1YkNvbnRleHQgPSBuZXcgQ29udGV4dChwYXJz\nZWQsIG51bGwsIGN0eCgpKTsKICAgICAgICBjb250ZXh0cy5wdXNoKHN1YkNv\nbnRleHQpOwoKICAgICAgICBDbGFzc01ldGFEYXRhIGNhbmRpZGF0ZSA9IGdl\ndENhbmRpZGF0ZU1ldGFEYXRhKG5vZGUpOwogICAgICAgIFN1YnF1ZXJ5IHN1\nYnEgPSBzdWJDb250ZXh0LmdldFN1YnF1ZXJ5KCk7CiAgICAgICAgaWYgKHN1\nYnEgPT0gbnVsbCkgewogICAgICAgICAgICBzdWJxID0gZmFjdG9yeS5uZXdT\ndWJxdWVyeShjYW5kaWRhdGUsIHN1YmNsYXNzZXMsIG5leHRBbGlhcygpKTsK\nICAgICAgICAgICAgc3ViQ29udGV4dC5zZXRTdWJxdWVyeShzdWJxKTsKICAg\nICAgICB9CiAgICAgICAgc3VicS5zZXRNZXRhRGF0YShjYW5kaWRhdGUpOwog\nICAgICAgIAogICAgICAgIC8vIGV2YWx1YXRlIGZyb20gY2xhdXNlIGZvciBy\nZXNvbHZpbmcgdmFyaWFibGVzIGRlZmluZWQgaW4gc3VicXVlcnkKICAgICAg\nICBKUFFMTm9kZSBmcm9tID0gbm9kZS5nZXRDaGlsZCgxKTsKICAgICAgICBz\ndWJDb250ZXh0LmZyb20gPSBldmFsRnJvbUNsYXVzZShmcm9tLCB0cnVlKTsK\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBz\ndWJleHAgPSBnZXRRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgICAgIHN1\nYnEuc2V0UXVlcnlFeHByZXNzaW9ucyhzdWJleHApOwogICAgICAgICAgICBp\nZiAoc3ViZXhwLnByb2plY3Rpb25zLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nICAgICBjaGVja0VtYmVkZGFibGUoc3ViZXhwLnByb2plY3Rpb25zWzBdKTsK\nICAgICAgICAgICAgcmV0dXJuIHN1YnE7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSBzdWJxdWVyeSBwYXJzZSBjb250\nZXh0CiAgICAgICAgICAgIGNvbnRleHRzLnBvcCgpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYW5kIHJlY29yZHMgdGhlIG5h\nbWVzIGFuZCBvcmRlciBvZiBwYXJhbWV0ZXJzLiBUaGUgcGFyYW1ldGVycyBh\ncmUKICAgICAqIGlkZW50aWZpZWQgYnkgYSBrZXkgd2l0aCBpdHMgdHlwZSBw\ncmVzZXJ2ZWQuIFRoZSBzZWNvbmQgYXJndW1lbnQKICAgICAqIGRldGVybWlu\nZXMgd2hldGhlciB0aGUgZmlyc3QgYXJndW1lbnQgaXMgdXNlZCBhcy1pcyBv\nciBjb252ZXJ0ZWQgdG8KICAgICAqIGFuIEludGVnZXIgYXMgcGFyYW1ldGVy\nIGtleS4gCiAgICAgKiAKICAgICAqIEBwYXJhbSB0aGUgdGV4dCBhcyBpdCBh\ncHBlYXJzIGluIHRoZSBwYXJzZWQgbm9kZQogICAgICogQHBhcmFtIHBvc2l0\naW9uYWwgaWYgdHJ1ZSB0aGUgZmlyc3QgYXJndW1lbnQgaXMgY29udmVydGVk\nIHRvIGFuIGludGVnZXIKICAgICAqIEBwYXJhbSBpc0NvbGxlY3Rpb25WYWx1\nZWQgdHJ1ZSBmb3IgY29sbGVjdGlvbi12YWx1ZWQgcGFyYW1ldGVycwogICAg\nICovCiAgICBwcml2YXRlIFBhcmFtZXRlciBnZXRQYXJhbWV0ZXIoU3RyaW5n\nIGlkLCBib29sZWFuIHBvc2l0aW9uYWwsIAogICAgICAgIGJvb2xlYW4gaXND\nb2xsZWN0aW9uVmFsdWVkKSB7CiAgICAgICAgaWYgKHBhcmFtZXRlclR5cGVz\nID09IG51bGwpCiAgICAgICAgICAgIHBhcmFtZXRlclR5cGVzID0gbmV3IExp\nbmtlZE1hcCg2KTsKICAgICAgICBPYmplY3QgcGFyYW1LZXkgPSBwb3NpdGlv\nbmFsID8gSW50ZWdlci5wYXJzZUludChpZCkgOiBpZDsKICAgICAgICBpZiAo\nIXBhcmFtZXRlclR5cGVzLmNvbnRhaW5zS2V5KHBhcmFtS2V5KSkKICAgICAg\nICAgICAgcGFyYW1ldGVyVHlwZXMucHV0KHBhcmFtS2V5LCBUWVBFX09CSkVD\nVCk7CgogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG51bGw7CiAgICAg\nICAgaW50IGluZGV4OwogICAgICAgIGlmIChwb3NpdGlvbmFsKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBpbmRleGVzIGluIEpQ\nUUwgYXJlIDEtYmFzZWQsIGFzIG9wcG9zZWQgdG8gMC1iYXNlZCBpbgogICAg\nICAgICAgICAgICAgLy8gdGhlIGNvcmUgRXhwcmVzc2lvbkZhY3RvcnkKICAg\nICAgICAgICAgICAgIGluZGV4ID0gSW50ZWdlci5wYXJzZUludChpZCkgLSAx\nOwogICAgICAgICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhf\nVVNFUiwgImJhZC1wb3NpdGlvbmFsLXBhcmFtZXRlciIsCiAgICAgICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyBpZCB9LCBlKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgICAg\nIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJiYWQtcG9zaXRpb25h\nbC1wYXJhbWV0ZXIiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgaWQgfSwgbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nLy8gb3RoZXJ3aXNlIHRoZSBpbmRleCBpcyBqdXN0IHRoZSBjdXJyZW50IHNp\nemUgb2YgdGhlIHBhcmFtcwogICAgICAgICAgICBpbmRleCA9IHBhcmFtZXRl\nclR5cGVzLmluZGV4T2YoaWQpOwogICAgICAgIH0KICAgICAgICBQYXJhbWV0\nZXIgcGFyYW0gPSBpc0NvbGxlY3Rpb25WYWx1ZWQgCiAgICAgICAgICAgID8g\nZmFjdG9yeS5uZXdDb2xsZWN0aW9uVmFsdWVkUGFyYW1ldGVyKHBhcmFtS2V5\nLCBUWVBFX09CSkVDVCkgCiAgICAgICAgICAgIDogZmFjdG9yeS5uZXdQYXJh\nbWV0ZXIocGFyYW1LZXksIFRZUEVfT0JKRUNUKTsKICAgICAgICBwYXJhbS5z\nZXRNZXRhRGF0YShtZXRhKTsKICAgICAgICBwYXJhbS5zZXRJbmRleChpbmRl\neCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHBhcmFtOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2hlY2tzIHRvIHNlZSBpZiB3ZSBzaG91bGQgZXZhbHVh\ndGUgZm9yIGEgTk9UIGV4cHJlc3Npb24uCiAgICAgKi8KICAgIHByaXZhdGUg\nRXhwcmVzc2lvbiBldmFsTm90KGJvb2xlYW4gbm90LCBFeHByZXNzaW9uIGV4\ncCkgewogICAgICAgIHJldHVybiBub3QgPyBmYWN0b3J5Lm5vdChleHApIDog\nZXhwOwogICAgfQoKICAgIC8qKgogICAgICogVHJpbSBvZmYgbGVhZGluZyBh\nbmQgdHJhaWxpbmcgc2luZ2xlLXF1b3RlcywgYW5kIHRoZW4KICAgICAqIHJl\ncGxhY2UgYW55IGludGVybmFsICcnIGluc3RhbmNlcyB3aXRoICcgKHNpbmNl\nIHJlcGVhdGluZyB0aGUKICAgICAqIHF1b3RlIGlzIHRoZSBKUFFMIG1lY2hh\nbmlzbSBvZiBlc2NhcGluZyBhIHNpbmdsZSBxdW90ZSkuCiAgICAgKi8KICAg\nIHByaXZhdGUgU3RyaW5nIHRyaW1RdW90ZXMoU3RyaW5nIHN0cikgewogICAg\nICAgIGlmIChzdHIgPT0gbnVsbCB8fCBzdHIubGVuZ3RoKCkgPD0gMSkKICAg\nICAgICAgICAgcmV0dXJuIHN0cjsKCiAgICAgICAgaWYgKHN0ci5zdGFydHNX\naXRoKCInIikgJiYgc3RyLmVuZHNXaXRoKCInIikpCiAgICAgICAgICAgIHN0\nciA9IHN0ci5zdWJzdHJpbmcoMSwgc3RyLmxlbmd0aCgpIC0gMSk7CgogICAg\nICAgIGludCBpbmRleCA9IC0xOwoKICAgICAgICB3aGlsZSAoKGluZGV4ID0g\nc3RyLmluZGV4T2YoIicnIiwgaW5kZXggKyAxKSkgIT0gLTEpCiAgICAgICAg\nICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgaW5kZXggKyAxKSArIHN0ci5z\ndWJzdHJpbmcoaW5kZXggKyAyKTsKCiAgICAgICAgcmV0dXJuIHN0cjsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFuIEludGVnZXJMaXRlcmFsIGFuZCBEZWNp\nbWFsTGl0ZXJhbCBub2RlIHdpbGwKICAgICAqIGhhdmUgYSBjaGlsZCBub2Rl\nIG9mIE5lZ2F0aXZlIGlmIGl0IGlzIG5lZ2F0aXZlOgogICAgICogaWYgc28s\nIHRoaXMgbWV0aG9kIHJldHVybnMgLTEsIGVsc2UgaXQgcmV0dXJucyAxLgog\nICAgICovCiAgICBwcml2YXRlIHNob3J0IG5lZ2F0aXZlKEpQUUxOb2RlIG5v\nZGUpIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAhPSBudWxsICYmIG5v\nZGUuY2hpbGRyZW4ubGVuZ3RoID09IDEKICAgICAgICAgICAgJiYgZmlyc3RD\naGlsZChub2RlKS5pZCA9PSBKSlRORUdBVElWRSkKICAgICAgICAgICAgcmV0\ndXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDE7CiAg\nICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRJZGVudGlmaWVyKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICBmaW5hbCBTdHJpbmcgbmFtZSA9IG5vZGUudGV4\ndDsKICAgICAgICBmaW5hbCBWYWx1ZSB2YWwgPSBnZXRWYXJpYWJsZShuYW1l\nLCBmYWxzZSk7CgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0TWV0\nYURhdGFGb3JBbGlhcyhuYW1lKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUg\nY2xhc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAgICAgLy8gZm9yIHRo\nZSBjYW5kaWRhdGUgKHdlIGRvbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRoaXMp\nCiAgICAgICAgICAgIFZhbHVlIHRoaXogPSBudWxsOwogICAgICAgICAgICBp\nZiAoY3R4KCkuc3VicXVlcnkgPT0gbnVsbCB8fCAKICAgICAgICAgICAgICAg\nIGN0eCgpLmdldFNjaGVtYShuYW1lLnRvTG93ZXJDYXNlKCkpID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGlmIChjdHgoKS5zdWJxdWVyeSAhPSBudWxs\nICYmIGluQXNzaWduU3Vic2VsZWN0UHJvamVjdGlvbikKICAgICAgICAgICAg\nICAgICAgICB0aGl6ID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5\nKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0\naGl6ID0gZmFjdG9yeS5nZXRUaGlzKCk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICB0aGl6ID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgp\nLnN1YnF1ZXJ5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAoKFBhdGgp\ndGhpeikuc2V0U2NoZW1hQWxpYXMobmFtZSk7CiAgICAgICAgICAgIHRoaXou\nc2V0TWV0YURhdGEoY21kKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXo7CiAg\nICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBQYXRoKSB7CiAgICAg\nICAgICAgIHJldHVybiAoUGF0aCkgdmFsOwogICAgICAgIH0gZWxzZSBpZiAo\ndmFsIGluc3RhbmNlb2YgVmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbC5p\nc1ZhcmlhYmxlKCkpIHsKICAgICAgICAgICAgICAgIC8vIGNhbiBiZSBhbiBl\nbnRpdHkgdHlwZSBsaXRlcmFsCiAgICAgICAgICAgICAgICBDbGFzczw/PiBj\nID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKG5hbWUsIG51bGwpOwogICAgICAg\nICAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIFZhbHVlIGxpdCA9IGZhY3RvcnkubmV3VHlwZUxpdGVyYWwoYywgTGl0ZXJh\nbC5UWVBFX0NMQVNTKTsKICAgICAgICAgICAgICAgICAgICBDbGFzczw/PiBj\nYW5kaWRhdGUgPSBnZXRDYW5kaWRhdGVUeXBlKCk7CiAgICAgICAgICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBjYW4gPSBnZXRDbGFzc01ldGFEYXRhKGNh\nbmRpZGF0ZS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gZ2V0Q2xhc3NNZXRhRGF0YShuYW1lLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZS5pc0Fzc2lnbmFibGVGcm9tKGMp\nKQogICAgICAgICAgICAgICAgICAgICAgICBsaXQuc2V0TWV0YURhdGEobWV0\nYSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICBsaXQuc2V0TWV0YURhdGEoY2FuKTsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbGl0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiAoVmFsdWUpIHZhbDsKICAgICAgICB9\nCgogICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmtu\nb3duLWlkZW50aWZpZXIiLAogICAgICAgICAgICBuZXcgT2JqZWN0W117IG5h\nbWUgfSwgbnVsbCk7CiAgICB9CgogICAgcHJpdmF0ZSBQYXRoIHZhbGlkYXRl\nTWFwUGF0aChKUFFMTm9kZSBub2RlLCBKUFFMTm9kZSBpZCkgewogICAgICAg\nIFBhdGggcGF0aCA9IChQYXRoKSBnZXRWYWx1ZShpZCk7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbGQgPSBwYXRoLmxhc3QoKTsKCiAgICAgICAgaWYgKGZs\nZCA9PSBudWxsICYmIGN0eCgpLnN1YnF1ZXJ5ICE9IG51bGwpIHsKICAgICAg\nICAgICAgVmFsdWUgdmFyID0gZ2V0VmFyaWFibGUoaWQudGV4dCwgZmFsc2Up\nOwogICAgICAgICAgICBpZiAodmFyICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIHBhdGggPSBmYWN0b3J5Lm5ld1BhdGgodmFyKTsKICAgICAgICAgICAg\nICAgIGZsZCA9IHBhdGgubGFzdCgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIGlmIChmbGQgIT0gbnVsbCkgeyAgICAgICAg\nICAgIAogICAgICAgICAgICAvLyB2YWxpZGF0ZSB0aGUgZmllbGQgaXMgb2Yg\ndHlwZSBqYXZhLnV0aWwuTWFwCiAgICAgICAgICAgIGlmIChmbGQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5NQVApIHsKICAgICAgICAg\nICAgICAgIFN0cmluZyBvcGVyID0gIlZBTFVFIjsKICAgICAgICAgICAgICAg\nIGlmIChub2RlLmlkID09IEpKVEVOVFJZKQogICAgICAgICAgICAgICAgICAg\nIG9wZXIgPSAiRU5UUlkiOyAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNl\nIGlmIChub2RlLmlkID09IEpKVEtFWSkKICAgICAgICAgICAgICAgICAgICBv\ncGVyID0gIktFWSI7CiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2Vw\ndGlvbihFWF9VU0VSLCAiYmFkLXF1YWxpZmllZC1pZGVudGlmaWVyIiwKICAg\nICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGlkLnRleHQsIG9wZXJ9\nLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1\nbmtub3duLXR5cGUiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBp\nZC50ZXh0fSwgbnVsbCk7CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBw\nYXRoOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0R2VuZXJhbElkZW50\naWZpZXIoSlBRTE5vZGUgbm9kZSwgYm9vbGVhbiBpbldoZXJlQ2xhdXNlKSB7\nCiAgICAgICAgSlBRTE5vZGUgaWQgPSBvbmx5Q2hpbGQobm9kZSk7CiAgICAg\nICAgUGF0aCBwYXRoID0gdmFsaWRhdGVNYXBQYXRoKG5vZGUsIGlkKTsKCiAg\nICAgICAgaWYgKG5vZGUuaWQgPT0gSkpUS0VZKQogICAgICAgICAgICBwYXRo\nID0gKFBhdGgpIGZhY3RvcnkuZ2V0S2V5KHBhdGgpOwogICAgICAgIEZpZWxk\nTWV0YURhdGEgZmxkID0gcGF0aC5sYXN0KCk7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhID0gbm9kZS5pZCA9PSBKSlRLRVkgPyBtZXRhID0gZmxkLmdl\ndEtleSgpLmdldFR5cGVNZXRhRGF0YSgpCiAgICAgICAgICAgICAgICA6IGZs\nZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGlmIChpbldo\nZXJlQ2xhdXNlICYmCiAgICAgICAgICAgIChtZXRhICE9IG51bGwgJiYgbWV0\nYS5pc0VtYmVkZGFibGUoKSkgfHwKICAgICAgICAgICAgICAgIChmbGQuaXNF\nbGVtZW50Q29sbGVjdGlvbigpICYmCiAgICAgICAgICAgICAgICAgZmxkLmdl\ndEVsZW1lbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgIT0gbnVsbCkpICAg\nCiAgICAgICAgICAgICAgICAgLy8gY2hlY2sgYmFzaWMgdHlwZQogICAgICAg\nICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1n\nZW5lcmFsLWlkZW50aWZpZXIiLAogICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgaWQudGV4dCwgbm9kZS5pZCA9PSBKSlRWQUxVRSA/ICJWQUxV\nRSIgOiAiS0VZIiB9LCBudWxsKTsKCiAgICAgICAgcmV0dXJuIHBhdGg7CiAg\nICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRRdWFsaWZpZWRJZGVudGlmaWVy\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBKUFFMTm9kZSBpZCA9IG9ubHlD\naGlsZChub2RlKTsgICAgICAgICAgICAgICAKICAgICAgICBQYXRoIHBhdGgg\nPSB2YWxpZGF0ZU1hcFBhdGgobm9kZSwgaWQpOwoKICAgICAgICBpZiAobm9k\nZS5pZCA9PSBKSlRWQUxVRSkKICAgICAgICAgICAgcmV0dXJuIHBhdGg7Cgog\nICAgICAgIFZhbHVlIHZhbHVlID0gZ2V0VmFsdWUoaWQpOwogICAgICAgIGlm\nIChub2RlLmlkID09IEpKVEtFWSkKICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkubWFwS2V5KHBhdGgsIHZhbHVlKTsKICAgICAgICBlbHNlICAgICAgICAg\nICAgCiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm1hcEVudHJ5KHBhdGgs\nIHZhbHVlKTsKICAgIH0KCiAgICBwcml2YXRlIFBhdGggZ2V0UXVhbGlmaWVk\nUGF0aChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGdldFF1YWxp\nZmllZFBhdGgobm9kZSwgZmFsc2UsIHRydWUpOwogICAgfQoKICAgIHByaXZh\ndGUgUGF0aCBnZXRRdWFsaWZpZWRQYXRoKEpQUUxOb2RlIG5vZGUsIGJvb2xl\nYW4gcGNPbmx5LCBib29sZWFuIGlubmVyKQogICAgewogICAgICAgIGludCBu\nQ2hpbGQgPSBub2RlLmdldENoaWxkQ291bnQoKTsKICAgICAgICBKUFFMTm9k\nZSBmaXJzdENoaWxkID0gZmlyc3RDaGlsZChub2RlKTsKICAgICAgICBKUFFM\nTm9kZSBpZCA9IGZpcnN0Q2hpbGQuaWQgPT0gSkpUS0VZID8gb25seUNoaWxk\nKGZpcnN0Q2hpbGQpIDoKICAgICAgICAgICAgICAgZmlyc3RDaGlsZDsgICAg\nICAgICAgICAgICAKICAgICAgICBQYXRoIHBhdGggPSB2YWxpZGF0ZU1hcFBh\ndGgoZmlyc3RDaGlsZCwgaWQpOwoKICAgICAgICBpZiAoZmlyc3RDaGlsZC5p\nZCA9PSBKSlRJREVOVElGSUVSKQogICAgICAgICAgICByZXR1cm4gZ2V0UGF0\naChub2RlKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbGQgPSBwYXRoLmxh\nc3QoKTsKICAgICAgICBwYXRoID0gKFBhdGgpIGZhY3RvcnkuZ2V0S2V5KHBh\ndGgpOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGZsZC5nZXRLZXko\nKS5nZXRUeXBlTWV0YURhdGEoKTsKCiAgICAgICAgaWYgKG1ldGEgPT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwg\nImJhZC1xdWFsaWZpZWQtcGF0aCIsCiAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IGlkLnRleHQgfSwgbnVsbCk7CiAgICAgICAgCiAgICAgICAgcGF0\naC5zZXRNZXRhRGF0YShtZXRhKTsKCiAgICAgICAgLy8gd2FsayB0aHJvdWdo\nIHRoZSBjaGlsZHJlbiBhbmQgYXNzZW1ibGUgdGhlIHBhdGgKICAgICAgICBi\nb29sZWFuIGFsbG93TnVsbCA9ICFpbm5lcjsKICAgICAgICBmb3IgKGludCBp\nID0gMTsgaSA8IG5DaGlsZDsgaSsrKSB7CiAgICAgICAgICAgIHBhdGggPSAo\nUGF0aCkgdHJhdmVyc2VQYXRoKHBhdGgsIG5vZGUuY2hpbGRyZW5baV0udGV4\ndCwgcGNPbmx5LAogICAgICAgICAgICAgICAgYWxsb3dOdWxsKTsKCiAgICAg\nICAgICAgIC8vIGFsbCB0cmF2ZXJzYWxzIGJ1dCB0aGUgZmlyc3Qgb25lIHdp\nbGwgYWx3YXlzIGJlIGlubmVyIGpvaW5zCiAgICAgICAgICAgIGFsbG93TnVs\nbCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcGF0aDsKICAg\nIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFR5cGVMaXRlcmFsKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICBKUFFMTm9kZSB0eXBlID0gb25seUNoaWxkKG5v\nZGUpOwogICAgICAgIGZpbmFsIFN0cmluZyBuYW1lID0gdHlwZS50ZXh0Owog\nICAgICAgIGZpbmFsIFZhbHVlIHZhbCA9IGdldFZhcmlhYmxlKG5hbWUsIGZh\nbHNlKTsKCiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFZhbHVlICYmIHZh\nbC5pc1ZhcmlhYmxlKCkpIHsKICAgICAgICAgICAgQ2xhc3M8Pz4gYyA9IHJl\nc29sdmVyLmNsYXNzRm9yTmFtZShuYW1lLCBudWxsKTsKICAgICAgICAgICAg\naWYgKGMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgVmFsdWUgdHlwZUxp\ndCA9IGZhY3RvcnkubmV3VHlwZUxpdGVyYWwoYywgTGl0ZXJhbC5UWVBFX0NM\nQVNTKTsKICAgICAgICAgICAgICAgIHR5cGVMaXQuc2V0TWV0YURhdGEoZ2V0\nQ2xhc3NNZXRhRGF0YShuYW1lLCBmYWxzZSkpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHR5cGVMaXQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3QtdHlwZS1s\naXRlcmFsIiwKICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBuYW1lIH0sIG51\nbGwpOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0UGF0aE9yQ29uc3Rh\nbnQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIC8vIGZpcnN0IGNoZWNrIHRv\nIHNlZSBpZiB0aGUgcGF0aCBpcyBhbiBlbnVtIG9yIHN0YXRpYyBmaWVsZCwg\nYW5kCiAgICAgICAgLy8gaWYgc28sIGxvYWQgaXQKICAgICAgICBTdHJpbmcg\nY2xhc3NOYW1lID0gYXNzZW1ibGUobm9kZSwgIi4iLCAxKTsKICAgICAgICBD\nbGFzczw/PiBjID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKGNsYXNzTmFtZSwg\nbnVsbCk7CiAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAgICAgICBT\ndHJpbmcgZmllbGROYW1lID0gbGFzdENoaWxkKG5vZGUpLnRleHQ7CiAgICAg\nICAgICAgIGludCB0eXBlID0gKGMuaXNFbnVtKCkgPyBMaXRlcmFsLlRZUEVf\nRU5VTSA6IExpdGVyYWwuVFlQRV9VTktOT1dOKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIEZpZWxkIGZpZWxkID0gYy5nZXRGaWVsZChm\naWVsZE5hbWUpOwogICAgICAgICAgICAgICAgT2JqZWN0IHZhbHVlID0gZmll\nbGQuZ2V0KG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nbmV3TGl0ZXJhbCh2YWx1ZSwgdHlwZSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKE5vU3VjaEZpZWxkRXhjZXB0aW9uIG5zZmUpIHsKICAgICAgICAgICAgICAg\nIGlmIChub2RlLmluRW51bVBhdGgpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZpZWxkIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjLmdldE5hbWUoKSwg\nZmllbGROYW1lIH0sIG5zZmUpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXRoKG5vZGUsIGZhbHNlLCB0\ncnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1\nbmFjY2Vzc2libGUtZmllbGQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgY2xhc3NOYW1lLCBmaWVsZE5hbWUgfSwgZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0\nUGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUHJvY2VzcyB0eXBlX2Rpc2NyaW1pbmF0b3IKICAgICAq\nICAgICB0eXBlX2Rpc2NyaW1pbmF0b3IgOjo9CiAgICAgKiAgICAgICAgIFRZ\nUEUoZ2VuZXJhbF9pZGVudGlmaWNhdGlvbl92YXJpYWJsZSB8CiAgICAgKiAg\nICAgICAgIHNpbmdsZV92YWx1ZWRfb2JqZWN0X3BhdGhfZXhwcmVzc2lvbiB8\nCiAgICAgKiAgICAgICAgIGlucHV0X3BhcmFtZXRlciApCiAgICAgKi8KICAg\nIHByaXZhdGUgVmFsdWUgZ2V0VHlwZShKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgc3dpdGNoIChub2RlLmlkKSB7CiAgICAgICAgY2FzZSBKSlRJREVOVElG\nSUVSOgogICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50eXBlKGdldFZhbHVl\nKG5vZGUpKTsKCiAgICAgICAgY2FzZSBKSlROQU1FRElOUFVUUEFSQU1FVEVS\nOgogICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50eXBlKGdldFBhcmFtZXRl\ncihub2RlLnRleHQsIGZhbHNlLCBmYWxzZSkpOwoKICAgICAgICBjYXNlIEpK\nVFBPU0lUSU9OQUxJTlBVVFBBUkFNRVRFUjoKICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkudHlwZShnZXRQYXJhbWV0ZXIobm9kZS50ZXh0LCB0cnVlLCBm\nYWxzZSkpOwoKICAgICAgICBjYXNlIEpKVEdFTkVSQUxJREVOVElGSUVSOgog\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50eXBlKGdldFF1YWxpZmllZElk\nZW50aWZpZXIob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgIC8vIFRPRE86IGVuZm9yY2UganBhMi4wIHNwZWMgcnVs\nZXMuCiAgICAgICAgICAgIC8vIEEgc2luZ2xlX3ZhbHVlZF9vYmplY3RfZmll\nbGQgaXMgZGVzaWduYXRlZCBieSB0aGUgbmFtZSBvZgogICAgICAgICAgICAv\nLyBhbiBhc3NvY2lhdGlvbiBmaWVsZCBpbiBhIG9uZS10by1vbmUgb3IgbWFu\neS10by1vbmUgcmVsYXRpb25zaGlwCiAgICAgICAgICAgIC8vIG9yIGEgZmll\nbGQgb2YgZW1iZWRkYWJsZSBjbGFzcyB0eXBlLgogICAgICAgICAgICAvLyBU\naGUgdHlwZSBvZiBhIHNpbmdsZV92YWx1ZWRfb2JqZWN0X2ZpZWxkIGlzIHRo\nZSBhYnN0cmFjdCBzY2hlbWEKICAgICAgICAgICAgLy8gdHlwZSBvZiB0aGUg\ncmVsYXRlZCBlbnRpdHkgb3IgZW1iZWRkYWJsZSBjbGFzcwogICAgICAgICAg\nICBWYWx1ZSBwYXRoID0gZ2V0UGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7CiAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LnR5cGUocGF0aCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgUGF0aCBnZXRQYXRoKEpQUUxOb2RlIG5v\nZGUpIHsKICAgICAgICByZXR1cm4gZ2V0UGF0aChub2RlLCBmYWxzZSwgdHJ1\nZSk7CiAgICB9CgogICAgcHJpdmF0ZSBQYXRoIGdldFBhdGgoSlBRTE5vZGUg\nbm9kZSwgYm9vbGVhbiBwY09ubHksIGJvb2xlYW4gaW5uZXIpIHsKICAgICAg\nICAvLyByZXNvbHZlIHRoZSBmaXJzdCBlbGVtZW50IGFnYWluc3QgdGhlIGFs\naWFzZXMgbWFwIC4uLgogICAgICAgIC8vIGkuZS4sIHRoZSBwYXRoICJTRUxF\nQ1QgeC5pZCBGUk9NIFNvbWVDbGFzcyB4IHdoZXJlIHguaWQgPiAxMCIKICAg\nICAgICAvLyB3aWxsIG5lZWQgdG8gaGF2ZSAieCIgaW4gdGhlIGFsaWFzIG1h\ncCBpbiBvcmRlciB0byByZXNvbHZlCiAgICAgICAgUGF0aCBwYXRoID0gbnVs\nbDsKCiAgICAgICAgZmluYWwgU3RyaW5nIG5hbWUgPSBmaXJzdENoaWxkKG5v\nZGUpLnRleHQ7CiAgICAgICAgZmluYWwgVmFsdWUgdmFsID0gZ2V0VmFyaWFi\nbGUobmFtZSwgZmFsc2UpOwoKICAgICAgICAvLyBoYW5kbGUgdGhlIGNhc2Ug\nd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMgdGhlIGFsaWFzCiAgICAgICAgLy8g\nZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRvbid0IHVzZSB2YXJpYWJsZXMgZm9y\nIHRoaXMpCiAgICAgICAgaWYgKG5hbWUuZXF1YWxzSWdub3JlQ2FzZShjdHgo\nKS5zY2hlbWFBbGlhcykpIHsKICAgICAgICAgICAgaWYgKGN0eCgpLnN1YnF1\nZXJ5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHBhdGggPSBmYWN0b3J5\nLm5ld1BhdGgoY3R4KCkuc3VicXVlcnkpOwogICAgICAgICAgICAgICAgcGF0\naC5zZXRNZXRhRGF0YShjdHgoKS5zdWJxdWVyeS5nZXRNZXRhRGF0YSgpKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhdGggPSBm\nYWN0b3J5Lm5ld1BhdGgoKTsKICAgICAgICAgICAgICAgIHBhdGguc2V0TWV0\nYURhdGEoY3R4KCkubWV0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgaWYgKGdldE1ldGFEYXRhRm9yQWxpYXMobmFtZSkgIT0gbnVsbCkKICAg\nICAgICAgICAgcGF0aCA9IG5ld1BhdGgobnVsbCwgZ2V0TWV0YURhdGFGb3JB\nbGlhcyhuYW1lKSk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2Yg\nUGF0aCkKICAgICAgICAgICAgcGF0aCA9IChQYXRoKSB2YWw7CiAgICAgICAg\nZWxzZSBpZiAodmFsLmdldE1ldGFEYXRhKCkgIT0gbnVsbCkKICAgICAgICAg\nICAgcGF0aCA9IG5ld1BhdGgodmFsLCB2YWwuZ2V0TWV0YURhdGEoKSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihF\nWF9VU0VSLCAicGF0aC1pbnZhbGlkIiwKICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgYXNzZW1ibGUobm9kZSksIG5hbWUgfSwgbnVsbCk7CgogICAg\nICAgIHBhdGguc2V0U2NoZW1hQWxpYXMobmFtZSk7CgogICAgICAgIC8vIHdh\nbGsgdGhyb3VnaCB0aGUgY2hpbGRyZW4gYW5kIGFzc2VtYmxlIHRoZSBwYXRo\nCiAgICAgICAgYm9vbGVhbiBhbGxvd051bGwgPSAhaW5uZXI7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDE7IGkgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmIChwYXRoLmlzWFBhdGgoKSkgewogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaiA9IGk7IGogPG5vZGUuY2hpbGRyZW4ubGVu\nZ3RoOyBqKyspCiAgICAgICAgICAgICAgICAgICAgcGF0aCA9IChQYXRoKSB0\ncmF2ZXJzZVhQYXRoKHBhdGgsIG5vZGUuY2hpbGRyZW5bal0udGV4dCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcGF0aDsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBwYXRoID0gKFBhdGgpIHRyYXZlcnNlUGF0aChwYXRoLCBub2Rl\nLmNoaWxkcmVuW2ldLnRleHQsIHBjT25seSwKICAgICAgICAgICAgICAgIGFs\nbG93TnVsbCk7CiAgICAgICAgICAgIGlmIChjdHgoKS5nZXRQYXJlbnQoKSAh\nPSBudWxsICYmIGN0eCgpLmdldFZhcmlhYmxlKHBhdGguZ2V0U2NoZW1hQWxp\nYXMoKSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcGF0aC5zZXRTdWJx\ndWVyeUNvbnRleHQoY3R4KCksIG5hbWUpOwogICAgICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgICAgIC8vIGFsbCB0cmF2ZXJzYWxzIGJ1dCB0aGUgZmly\nc3Qgb25lIHdpbGwgYWx3YXlzIGJlIGlubmVyIGpvaW5zCiAgICAgICAgICAg\nIGFsbG93TnVsbCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIHBhdGg7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzPD8+IGdldERlY2xh\ncmVkVmFyaWFibGVUeXBlKFN0cmluZyBuYW1lKSB7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBjbWQgPSBnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpOwogICAg\nICAgIGlmIChjbWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNtZC5n\nZXREZXNjcmliZWRUeXBlKCk7CgogICAgICAgIGlmIChuYW1lICE9IG51bGwg\nJiYgbmFtZS5lcXVhbHMoY3R4KCkuc2NoZW1hQWxpYXMpKQogICAgICAgICAg\nICByZXR1cm4gZ2V0Q2FuZGlkYXRlVHlwZSgpOwoKICAgICAgICAvLyBKUFFM\nIGhhcyBubyBkZWNsYXJlZCB2YXJpYWJsZXMKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gRXhwcmVzc2lv\nbiBmb3IgdGhlIGdpdmVuIG5vZGUgYnkgZXZhbCdpbmcgaXQuCiAgICAgKi8K\nICAgIHByaXZhdGUgRXhwcmVzc2lvbiBnZXRFeHByZXNzaW9uKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICBPYmplY3QgZXhwID0gZXZhbChub2RlKTsKCiAg\nICAgICAgLy8gY2hlY2sgZm9yIGJvb2xlYW4gdmFsdWVzIHVzZWQgYXMgZXhw\ncmVzc2lvbnMKICAgICAgICBpZiAoIShleHAgaW5zdGFuY2VvZiBFeHByZXNz\naW9uKSkKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYXNFeHByZXNzaW9u\nKChWYWx1ZSkgZXhwKTsKICAgICAgICByZXR1cm4gKEV4cHJlc3Npb24pIGV4\ncDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSBTaW1wbGUgQ2Fz\nZSBFeHByZXNzaW9uIGZvciB0aGUgZ2l2ZW4gbm9kZSBieSBldmFsJ2luZyBp\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBWYWx1ZSBnZXRTaW1wbGVDYXNlRXhw\ncmVzc2lvbihKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgT2JqZWN0IGNhc2VP\ncGVyYW5kID0gZXZhbChub2RlLmdldENoaWxkKDApKTsKICAgICAgICBpbnQg\nbkNoaWxkID0gbm9kZS5nZXRDaGlsZENvdW50KCk7CgogICAgICAgIE9iamVj\ndCB2YWwgPSBldmFsKGxhc3RDaGlsZChub2RlKSk7CiAgICAgICAgT2JqZWN0\nIGV4cFtdID0gbmV3IEV4cHJlc3Npb25bbkNoaWxkIC0gMl07CiAgICAgICAg\nZm9yIChpbnQgaSA9IDE7IGkgPCBuQ2hpbGQgLSAxOyBpKyspCiAgICAgICAg\nICAgIGV4cFtpLTFdID0gZXZhbChub2RlLmNoaWxkcmVuW2ldKTsKICAgICAg\nICAKICAgICAgICByZXR1cm4gZmFjdG9yeS5zaW1wbGVDYXNlRXhwcmVzc2lv\nbigoVmFsdWUpIGNhc2VPcGVyYW5kLAogICAgICAgICAgICAoRXhwcmVzc2lv\nbltdKSBleHAsIChWYWx1ZSkgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgYSBHZW5lcmFsIENhc2UgRXhwcmVzc2lvbiBmb3IgdGhlIGdp\ndmVuIG5vZGUgYnkgZXZhbCdpbmcgaXQuCiAgICAgKi8KICAgIHByaXZhdGUg\nVmFsdWUgZ2V0R2VuZXJhbENhc2VFeHByZXNzaW9uKEpQUUxOb2RlIG5vZGUp\nIHsKICAgICAgICBpbnQgbkNoaWxkID0gbm9kZS5nZXRDaGlsZENvdW50KCk7\nCgogICAgICAgIE9iamVjdCB2YWwgPSBldmFsKGxhc3RDaGlsZChub2RlKSk7\nCiAgICAgICAgT2JqZWN0IGV4cFtdID0gbmV3IEV4cHJlc3Npb25bbkNoaWxk\nIC0gMV07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBuQ2hpbGQgLSAx\nOyBpKyspCiAgICAgICAgICAgIGV4cFtpXSA9IChFeHByZXNzaW9uKSBldmFs\nKG5vZGUuY2hpbGRyZW5baV0pOwogICAgICAgIAogICAgICAgIHJldHVybiBm\nYWN0b3J5LmdlbmVyYWxDYXNlRXhwcmVzc2lvbigoRXhwcmVzc2lvbltdKSBl\neHAsIChWYWx1ZSkgdmFsKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Np\nb24gZ2V0V2hlbkNvbmRpdGlvbihKUFFMTm9kZSBub2RlKSB7CiAgICAgICAg\nT2JqZWN0IGV4cCA9IGV2YWwoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAg\nT2JqZWN0IHZhbCA9IGV2YWwoc2Vjb25kQ2hpbGQobm9kZSkpOwogICAgICAg\nIHJldHVybiBmYWN0b3J5LndoZW5Db25kaXRpb24oKEV4cHJlc3Npb24pIGV4\ncCwgKFZhbHVlKSB2YWwpOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lv\nbiBnZXRXaGVuU2NhbGFyKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBPYmpl\nY3QgdmFsMSA9IGV2YWwoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAgT2Jq\nZWN0IHZhbDIgPSBldmFsKHNlY29uZENoaWxkKG5vZGUpKTsKICAgICAgICBy\nZXR1cm4gZmFjdG9yeS53aGVuU2NhbGFyKChWYWx1ZSkgdmFsMSwgKFZhbHVl\nKSB2YWwyKTsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldENvYWxlc2Nl\nRXhwcmVzc2lvbihKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaW50IG5DaGls\nZCA9IG5vZGUuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgIAogICAgICAgIE9i\namVjdCB2YWxzW10gPSBuZXcgVmFsdWVbbkNoaWxkXTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG5DaGlsZDsgaSsrKQogICAgICAgICAgICB2YWxz\nW2ldID0gZXZhbChub2RlLmNoaWxkcmVuW2ldKTsKICAgICAgICAKICAgICAg\nICByZXR1cm4gZmFjdG9yeS5jb2FsZXNjZUV4cHJlc3Npb24oKFZhbHVlW10p\nIHZhbHMpOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0TnVsbElmRXhw\ncmVzc2lvbihKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgT2JqZWN0IHZhbDEg\nPSBldmFsKGZpcnN0Q2hpbGQobm9kZSkpOwogICAgICAgIE9iamVjdCB2YWwy\nID0gZXZhbChzZWNvbmRDaGlsZChub2RlKSk7CiAgICAgICAgCiAgICAgICAg\ncmV0dXJuIGZhY3RvcnkubnVsbElmRXhwcmVzc2lvbigoVmFsdWUpIHZhbDEs\nIChWYWx1ZSkgdmFsMik7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRW\nYWx1ZShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuaWQgPT0g\nSkpUUVVBTElGSUVESURFTlRJRklFUikKICAgICAgICAgICAgcmV0dXJuIGdl\ndFF1YWxpZmllZElkZW50aWZpZXIob25seUNoaWxkKG5vZGUpKTsKICAgICAg\nICByZXR1cm4gZ2V0VmFsdWUobm9kZSwgVkFSX1BBVEgpOwogICAgfQoKICAg\nIHByaXZhdGUgUGF0aCBuZXdQYXRoKFZhbHVlIHZhbCwgQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgUGF0aCBwYXRoID0gdmFsID09IG51bGwgPyBm\nYWN0b3J5Lm5ld1BhdGgoKSA6IGZhY3RvcnkubmV3UGF0aCh2YWwpOwogICAg\nICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgIHBhdGguc2V0TWV0\nYURhdGEobWV0YSk7CiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIGEgVmFsdWUgZm9yIHRoZSBnaXZlbiBub2Rl\nIGJ5IGV2YWwnaW5nIGl0LgogICAgICovCiAgICBwcml2YXRlIFZhbHVlIGdl\ndFZhbHVlKEpQUUxOb2RlIG5vZGUsIGludCBoYW5kbGVWYXIpIHsKICAgICAg\nICBWYWx1ZSB2YWwgPSAoVmFsdWUpIGV2YWwobm9kZSk7CgogICAgICAgIC8v\nIGRldGVybWluZWQgaG93IHRvIGV2YWx1YXRlIGEgdmFyaWFibGUKICAgICAg\nICBpZiAoIXZhbC5pc1ZhcmlhYmxlKCkpCiAgICAgICAgICAgIHJldHVybiB2\nYWw7CiAgICAgICAgZWxzZSBpZiAoaGFuZGxlVmFyID09IFZBUl9QQVRIICYm\nICEodmFsIGluc3RhbmNlb2YgUGF0aCkpCiAgICAgICAgICAgIHJldHVybiBu\nZXdQYXRoKHZhbCwgdmFsLmdldE1ldGFEYXRhKCkpOwogICAgICAgIGVsc2Ug\naWYgKGhhbmRsZVZhciA9PSBWQVJfRVJST1IpCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmV4cGVjdGVkLXZhciIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUudGV4dCB9LCBudWxs\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUGFy\nc2UgQ29udGV4dCBNYW5hZ2VtZW50CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgcHJpdmF0ZSBDb250ZXh0IGN0eCgpIHsKICAgICAg\nICByZXR1cm4gIGNvbnRleHRzLnBlZWsoKTsKICAgIH0KCiAgICBwcml2YXRl\nIEpQUUxOb2RlIHJvb3QoKSB7CiAgICAgICAgcmV0dXJuIGN0eCgpLnBhcnNl\nZC5yb290OwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRN\nZXRhRGF0YUZvckFsaWFzKFN0cmluZyBhbGlhcykgewogICAgICAgIGZvciAo\naW50IGkgPSBjb250ZXh0cy5zaXplKCkgLSAxOyBpID49IDA7IGktLSkgewog\nICAgICAgICAgICBDb250ZXh0IGNvbnRleHQgPSAgY29udGV4dHMuZ2V0KGkp\nOwogICAgICAgICAgICBpZiAoYWxpYXMuZXF1YWxzSWdub3JlQ2FzZShjb250\nZXh0LnNjaGVtYUFsaWFzKSkKICAgICAgICAgICAgICAgIHJldHVybiBjb250\nZXh0Lm1ldGE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRTY2hlbWFUb0NvbnRleHQoU3Ry\naW5nIGlkLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBjdHgoKS5h\nZGRTY2hlbWEoaWQudG9Mb3dlckNhc2UoKSwgbWV0YSk7ICAgIAogICAgfQoK\nICAgIHByb3RlY3RlZCB2b2lkIGFkZFZhcmlhYmxlVG9Db250ZXh0KFN0cmlu\nZyBpZCwgVmFsdWUgdmFyKSB7CiAgICAgICAgY3R4KCkuYWRkVmFyaWFibGUo\naWQsIHZhcik7CiAgICB9CgogICAgcHJvdGVjdGVkIFZhbHVlIGdldFZhcmlh\nYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICBDb250ZXh0IGMgPSBjdHgoKTsK\nICAgICAgICBWYWx1ZSB2ID0gYy5nZXRWYXJpYWJsZSh2YXIpOwogICAgICAg\nIGlmICh2ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB2OwogICAgICAg\nIGlmIChjLmdldFBhcmVudCgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBjLmdldFBhcmVudCgpLmZpbmRWYXJpYWJsZSh2YXIpOwoKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBOb2RlIHRyYXZlcnNhbCB1dGlsaXRpZXMKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwcml2YXRlIEpQUUxO\nb2RlIG9ubHlDaGlsZChKUFFMTm9kZSBub2RlKQogICAgICAgIHRocm93cyBV\nc2VyRXhjZXB0aW9uIHsKICAgICAgICBKUFFMTm9kZSBjaGlsZCA9IGZpcnN0\nQ2hpbGQobm9kZSk7CgogICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0\naCA+IDEpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VT\nRVIsICJtdWx0aS1jaGlsZHJlbiIsCiAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IG5vZGUsIEFycmF5cy5hc0xpc3Qobm9kZS5jaGlsZHJlbikgfSwg\nbnVsbCk7CgogICAgICAgIHJldHVybiBjaGlsZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIGxlZnQgbm9kZSAodGhlIGZpcnN0IG9mIHRo\nZSBjaGlsZHJlbiksIGFuZCBhc3NlcnRzCiAgICAgKiB0aGF0IHRoZXJlIGFy\nZSBleGFjdGx5IHR3byBjaGlsZHJlbi4KICAgICAqLwogICAgcHJpdmF0ZSBK\nUFFMTm9kZSBsZWZ0KEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4g\nY2hpbGQobm9kZSwgMCwgMik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRoZSByaWdodCBub2RlICh0aGUgc2Vjb25kIG9mIHRoZSBjaGlsZHJl\nbiksIGFuZCBhc3NlcnRzCiAgICAgKiB0aGF0IHRoZXJlIGFyZSBleGFjdGx5\nIHR3byBjaGlsZHJlbi4KICAgICAqLwogICAgcHJpdmF0ZSBKUFFMTm9kZSBy\naWdodChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGNoaWxkKG5v\nZGUsIDEsIDIpOwogICAgfQoKICAgIHByaXZhdGUgSlBRTE5vZGUgY2hpbGQo\nSlBRTE5vZGUgbm9kZSwgaW50IGNoaWxkTnVtLCBpbnQgYXNzZXJ0Q291bnQp\nIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggIT0gYXNzZXJ0\nQ291bnQpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VT\nRVIsICJ3cm9uZy1jaGlsZC1jb3VudCIsCiAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W117IG5ldyBJbnRlZ2VyKGFzc2VydENvdW50KSwgbm9kZSwKICAg\nICAgICAgICAgICAgICAgICBBcnJheXMuYXNMaXN0KG5vZGUuY2hpbGRyZW4p\nIH0sIG51bGwpOwoKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbltjaGls\nZE51bV07CiAgICB9CgogICAgcHJpdmF0ZSBKUFFMTm9kZSBmaXJzdENoaWxk\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiA9\nPSBudWxsIHx8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJuby1jaGlsZHJl\nbiIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUgfSwgbnVs\nbCk7CiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW5bMF07CiAgICB9Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5vZGUgc2Vjb25kQ2hpbGQoSlBRTE5v\nZGUgbm9kZSkgewogICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVuWzFdOwog\nICAgfQoKICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIHRoaXJkQ2hpbGQo\nSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVu\nWzJdOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIGxhc3RD\naGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGxhc3RDaGls\nZChub2RlLCAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBOdGggZnJv\nbSB0aGUgbGFzdCBjaGlsZC4gRS5nLiwKICAgICAqIGxhc3RDaGlsZCgxKSB3\naWxsIHJldHVybiB0aGUgc2Vjb25kLXRvLXRoZS1sYXN0IGNoaWxkLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9kZSBsYXN0Q2hpbGQoSlBR\nTE5vZGUgbm9kZSwgaW50IGZyb21MYXN0KSB7CiAgICAgICAgcmV0dXJuIG5v\nZGUuY2hpbGRyZW5bbm9kZS5jaGlsZHJlbi5sZW5ndGggLSAoMSArIGZyb21M\nYXN0KV07CiAgICB9CgogICAgLyoqCiAgICAgKiBCYXNlIG5vZGUgdGhhdCB3\naWxsIGJlIGdlbmVyYXRlZCBieSB0aGUgSlBRTEV4cHJlc3Npb25CdWlsZGVy\nOyBiYXNlCiAgICAgKiBjbGFzcyBvZiB0aGUge0BsaW5rIFNpbXBsZU5vZGV9\nIHRoYXQgaXMgdXNlZCBieSB7QGxpbmsgSlBRTH0uCiAgICAgKgogICAgICog\nQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICAgICAqIEBzZWUgTm9kZQog\nICAgICogQHNlZSBTaW1wbGVOb2RlCiAgICAgKi8KICAgIEBTdXBwcmVzc1dh\ncm5pbmdzKCJzZXJpYWwiKQogICAgcHJvdGVjdGVkIGFic3RyYWN0IHN0YXRp\nYyBjbGFzcyBKUFFMTm9kZQogICAgICAgIGltcGxlbWVudHMgTm9kZSwgU2Vy\naWFsaXphYmxlIHsKCiAgICAgICAgZmluYWwgaW50IGlkOwogICAgICAgIGZp\nbmFsIEpQUUwgcGFyc2VyOwogICAgICAgIEpQUUxOb2RlIHBhcmVudDsKICAg\nICAgICBKUFFMTm9kZVtdIGNoaWxkcmVuOwogICAgICAgIFN0cmluZyB0ZXh0\nOwogICAgICAgIGJvb2xlYW4gbm90ID0gZmFsc2U7CiAgICAgICAgYm9vbGVh\nbiBpbkVudW1QYXRoID0gZmFsc2U7CgogICAgICAgIHB1YmxpYyBKUFFMTm9k\nZShKUFFMIHBhcnNlciwgaW50IGlkKSB7CiAgICAgICAgICAgIHRoaXMuaWQg\nPSBpZDsKICAgICAgICAgICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7CiAgICAg\nICAgICAgIHRoaXMuaW5FbnVtUGF0aCA9IHBhcnNlci5pbkVudW1QYXRoOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgamp0T3BlbigpIHsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGpqdENsb3NlKCkgewogICAg\nICAgIH0KCiAgICAgICAgSlBRTE5vZGVbXSBmaW5kQ2hpbGRyZW5CeUlEKGlu\ndCBpZCkgewogICAgICAgICAgICBDb2xsZWN0aW9uPEpQUUxOb2RlPiBzZXQg\nPSBuZXcgTGlua2VkSGFzaFNldDxKUFFMTm9kZT4oKTsKICAgICAgICAgICAg\nZmluZENoaWxkcmVuQnlJRChpZCwgc2V0KTsKICAgICAgICAgICAgcmV0dXJu\nIHNldC50b0FycmF5KG5ldyBKUFFMTm9kZVtzZXQuc2l6ZSgpXSk7CiAgICAg\nICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgZmluZENoaWxkcmVuQnlJRChp\nbnQgaWQsIENvbGxlY3Rpb248SlBRTE5vZGU+IHNldCkgewogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgY2hpbGRyZW4gIT0gbnVsbCAmJiBpIDwgY2hp\nbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChjaGls\nZHJlbltpXS5pZCA9PSBpZCkKICAgICAgICAgICAgICAgICAgICBzZXQuYWRk\nKGNoaWxkcmVuW2ldKTsKCiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5m\naW5kQ2hpbGRyZW5CeUlEKGlkLCBzZXQpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBib29sZWFuIGhhc0NoaWxkSUQoaW50IGlkKSB7CiAg\nICAgICAgICAgIHJldHVybiBmaW5kQ2hpbGRCeUlEKGlkLCBmYWxzZSkgIT0g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIEpQUUxOb2RlIGZpbmRDaGlsZEJ5\nSUQoaW50IGlkLCBib29sZWFuIHJlY3Vyc2UpIHsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGNoaWxkcmVuICE9IG51bGwgJiYgaSA8IGNoaWxkcmVu\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBKUFFMTm9kZSBjaGls\nZCA9IGNoaWxkcmVuW2ldOwoKICAgICAgICAgICAgICAgIGlmIChjaGlsZC5p\nZCA9PSBpZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGRyZW5b\naV07CgogICAgICAgICAgICAgICAgaWYgKHJlY3Vyc2UpIHsKICAgICAgICAg\nICAgICAgICAgICBKUFFMTm9kZSBmb3VuZCA9IGNoaWxkLmZpbmRDaGlsZEJ5\nSUQoaWQsIHJlY3Vyc2UpOwogICAgICAgICAgICAgICAgICAgIGlmIChmb3Vu\nZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm91\nbmQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIG5vdCBmb3VuZAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGpqdFNldFBhcmVudChOb2Rl\nIHBhcmVudCkgewogICAgICAgICAgICB0aGlzLnBhcmVudCA9IChKUFFMTm9k\nZSkgcGFyZW50OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE5vZGUgamp0\nR2V0UGFyZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQ7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBqanRBZGRDaGlsZChO\nb2RlIG4sIGludCBpKSB7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbiA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IG5ldyBKUFFMTm9k\nZVtpICsgMV07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+PSBjaGlsZHJl\nbi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIEpQUUxOb2RlIGNbXSA9IG5l\ndyBKUFFMTm9kZVtpICsgMV07CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJy\nYXljb3B5KGNoaWxkcmVuLCAwLCBjLCAwLCBjaGlsZHJlbi5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgY2hpbGRyZW4gPSBjOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBjaGlsZHJlbltpXSA9IChKUFFMTm9kZSkgbjsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBOb2RlIGpqdEdldENoaWxkKGludCBpKSB7\nCiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbltpXTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgZ2V0Q2hpbGRDb3VudCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGpqdEdldE51bUNoaWxkcmVuKCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSlBRTE5vZGUgZ2V0Q2hpbGQoaW50IGluZGV4KSB7CiAg\nICAgICAgICAgIHJldHVybiAoSlBRTE5vZGUpIGpqdEdldENoaWxkKGluZGV4\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvcjxKUFFMTm9k\nZT4gaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNM\naXN0KGNoaWxkcmVuKS5pdGVyYXRvcigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludCBqanRHZXROdW1DaGlsZHJlbigpIHsKICAgICAgICAgICAg\ncmV0dXJuIChjaGlsZHJlbiA9PSBudWxsKSA/IDAgOiBjaGlsZHJlbi5sZW5n\ndGg7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHNldFRleHQoU3RyaW5nIHRl\neHQpIHsKICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgICAgICB9\nCgogICAgICAgIHZvaWQgc2V0VG9rZW4oVG9rZW4gdCkgewogICAgICAgICAg\nICBzZXRUZXh0KHQuaW1hZ2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIEpQUUxU\ncmVlQ29uc3RhbnRzLmpqdE5vZGVOYW1lW3RoaXMuaWRdOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZyhTdHJpbmcgcHJlZml4\nKSB7CiAgICAgICAgICAgIHJldHVybiBwcmVmaXggKyB0b1N0cmluZygpOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRGVidWdnaW5nIG1l\ndGhvZC4KICAgICAgICAgKgogICAgICAgICAqIEBzZWUgI2R1bXAoamF2YS5p\nby5QcmludFN0cmVhbSxTdHJpbmcpCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIHZvaWQgZHVtcChTdHJpbmcgcHJlZml4KSB7CiAgICAgICAgICAgIGR1\nbXAoU3lzdGVtLm91dCwgcHJlZml4KTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGR1bXAoKSB7CiAgICAgICAgICAgIGR1bXAoIiAiKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIERlYnVnZ2luZyBtZXRo\nb2QgdG8gb3V0cHV0IGEgcGFyc2UgdHJlZS4KICAgICAgICAgKgogICAgICAg\nICAqIEBwYXJhbSBvdXQgdGhlIHN0cmVhbSB0byB3aGljaCB0byB3cml0ZSB0\naGUgZGVidWdnaW5nIGluZm8KICAgICAgICAgKiBAcGFyYW0gcHJlZml4IHRo\nZSBwcmVmaXggdG8gd3JpdGUgb3V0IGJlZm9yZSBsaW5lcwogICAgICAgICAq\nLwogICAgICAgIHB1YmxpYyB2b2lkIGR1bXAoUHJpbnRTdHJlYW0gb3V0LCBT\ndHJpbmcgcHJlZml4KSB7CiAgICAgICAgICAgIGR1bXAob3V0LCBwcmVmaXgs\nIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGR1bXAo\nUHJpbnRTdHJlYW0gb3V0LCBTdHJpbmcgcHJlZml4LCBib29sZWFuIHRleHQp\nIHsKICAgICAgICAgICAgb3V0LnByaW50bG4odG9TdHJpbmcocHJlZml4KQog\nICAgICAgICAgICAgICAgKyAodGV4dCAmJiB0aGlzLnRleHQgIT0gbnVsbCA/\nICIgWyIgKyB0aGlzLnRleHQgKyAiXSIgOiAiIikpOwogICAgICAgICAgICBp\nZiAoY2hpbGRyZW4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7ICsraSkgewogICAgICAg\nICAgICAgICAgICAgIEpQUUxOb2RlIG4gPSAoSlBRTE5vZGUpIGNoaWxkcmVu\nW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChuICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgbi5kdW1wKG91dCwgcHJlZml4ICsgIiAi\nLCB0ZXh0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQdWJsaWMgZm9yIHVuaXQgdGVzdGluZyBwdXJwb3Nlcy4KICAgICAq\nIEBub2phdmFkb2MKICAgICAqLwogICAgQFN1cHByZXNzV2FybmluZ3MoInNl\ncmlhbCIpCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFBhcnNlZEpQUUwKICAg\nICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIC8vIFRo\naXMgaXMgb25seSBldmVyIHVzZWQgZHVyaW5nIHBhcnNlOyB3aGVuIFBhcnNl\nZEpQUUwgaW5zdGFuY2VzCiAgICAgICAgLy8gYXJlIHNlcmlhbGl6ZWQsIHRo\nZXkgd2lsbCBoYXZlIGFscmVhZHkgYmVlbiBwYXJzZWQuCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCB0cmFuc2llbnQgSlBRTE5vZGUgcm9vdDsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBTdHJpbmcgcXVlcnk7CiAgICAgICAgCiAgICAgICAg\nLy8gY2FjaGUgb2YgY2FuZGlkYXRlIHR5cGUgZGF0YS4gVGhpcyBpcyBzdG9y\nZWQgaGVyZSBpbiBjYXNlIHRoaXMgIAogICAgICAgIC8vIHBhcnNlIHRyZWUg\naXMgcmV1c2VkIGluIGEgY29udGV4dCB0aGF0IGRvZXMgbm90IGtub3cgd2hh\ndCB0aGUgCiAgICAgICAgLy8gY2FuZGlkYXRlIHR5cGUgaXMgYWxyZWFkeS4g\nCiAgICAgICAgcHJpdmF0ZSBDbGFzczw/PiBfY2FuZGlkYXRlVHlwZTsKCiAg\nICAgICAgUGFyc2VkSlBRTChTdHJpbmcganBxbCkgewogICAgICAgICAgICB0\naGlzKGpwcWwsIHBhcnNlKGpwcWwpKTsKICAgICAgICB9CgogICAgICAgIFBh\ncnNlZEpQUUwoU3RyaW5nIHF1ZXJ5LCBKUFFMTm9kZSByb290KSB7CiAgICAg\nICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICAgICAgICAgIHRoaXMucXVl\ncnkgPSBxdWVyeTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgc3RhdGlj\nIEpQUUxOb2RlIHBhcnNlKFN0cmluZyBqcHFsKSB7CiAgICAgICAgICAgIGlm\nIChqcHFsID09IG51bGwpCiAgICAgICAgICAgICAgICBqcHFsID0gIiI7Cgog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIChKUFFM\nTm9kZSkgbmV3IEpQUUwoanBxbCkucGFyc2VRdWVyeSgpOwogICAgICAgICAg\nICB9IGNhdGNoIChFcnJvciBlKSB7CiAgICAgICAgICAgICAgICAvLyBzcGVj\naWFsIGhhbmRsaW5nIGZvciBFcnJvciBzdWJjbGFzc2VzLCB3aGljaCB0aGUK\nICAgICAgICAgICAgICAgIC8vIHBhcnNlciBtYXkgc29tZXRpbWVzICh1bmZv\ncnR1bmF0ZWx5KSB0aHJvdwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoInBhcnNlLWVycm9yIiwKICAgICAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IGUudG9TdHJpbmcoKSwganBxbCB9\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZvaWQgcG9w\ndWxhdGUoRXhwcmVzc2lvblN0b3JlUXVlcnkgcXVlcnkpIHsKICAgICAgICAg\nICAgUXVlcnlDb250ZXh0IGN0eCA9IHF1ZXJ5LmdldENvbnRleHQoKTsKCiAg\nICAgICAgICAgIC8vIGlmIHRoZSBvd25pbmcgcXVlcnkncyBjb250ZXh0IGRv\nZXMgbm90IGhhdmUKICAgICAgICAgICAgLy8gYW55IGNhbmRpZGF0ZSBjbGFz\ncywgdGhlbiBzZXQgaXQgaGVyZQogICAgICAgICAgICBpZiAoY3R4LmdldENh\nbmRpZGF0ZVR5cGUoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2NhbmRpZGF0ZVR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\nY2FuZGlkYXRlVHlwZSA9IG5ldyBKUFFMRXhwcmVzc2lvbkJ1aWxkZXIKICAg\nICAgICAgICAgICAgICAgICAgICAgKG51bGwsIHF1ZXJ5LCB0aGlzKS5nZXRD\nYW5kaWRhdGVUeXBlKCk7CiAgICAgICAgICAgICAgICBjdHguc2V0Q2FuZGlk\nYXRlVHlwZShfY2FuZGlkYXRlVHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogUHVi\nbGljIGZvciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIENsYXNzPD8+IGdldENhbmRpZGF0ZVR5cGUoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfY2FuZGlkYXRlVHlwZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVy\nbiB0aGlzLnF1ZXJ5OwoJCX0KCX0KfQoK\n","encoding":"base64"}

