{"sha":"843e3c414f93f3b31db47b5f67e175fda6322c6e","node_id":"MDQ6QmxvYjIwNjM2NDo4NDNlM2M0MTRmOTNmM2IzMWRiNDdiNWY2N2UxNzVmZGE2MzIyYzZl","size":96053,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/843e3c414f93f3b31db47b5f67e175fda6322c6e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5J\ndGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51\ndGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0\naWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5T\ndHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9w\nZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmRhdGFjYWNoZS5BYnN0cmFjdERhdGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGVNb2RlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFi\nbGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmln\ndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYu\nVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuVmFs\ndWVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9n\nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5Tb3Vy\nY2VUcmFja2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi54bWwuQ29tbWVudGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5CaWdEZWNpbWFsSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5CaWdJbnRlZ2VySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5CeXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5D\naGFySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50SWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0SWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5TaG9ydElkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuU3RyaW5nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBzZXJwLnV0aWwu\nU3RyaW5nczsKCi8qKgogKiBDb250YWlucyBtZXRhZGF0YSBhYm91dCBhIHBl\ncnNpc3RlbnQgdHlwZS4KICogVGhpcyBtZXRhZGF0YSBpcyBhdmFpbGFibGUg\nYm90aCBhdCBlbmhhbmNlbWVudCB0aW1lIGFuZCBydW50aW1lLgogKiAgTm90\nZSB0aGF0IHRoaXMgY2xhc3MgZW1wbG95cyBhZ2dyZXNzaXZlIGNhY2hpbmcs\nIGFuZCB0aGVyZWZvcmUgaXQgaXMKICogaW1wb3J0YW50IHRvIGZpbmFsaXpl\nIHRoZSBjb25maWd1cmF0aW9uIG9mIGZpZWxkIG1ldGFkYXRhcyBiZWZvcmUg\naW52b2tpbmcKICogbWV0aG9kcyB0aGF0IGRlcGVuZCBvbiB0aGF0IGNvbmZp\nZ3VyYXRpb24sIHN1Y2ggYXMKICoge0BsaW5rICNnZXRQcmltYXJ5S2V5Rmll\nbGRzfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCkBTdXBwcmVzc1dh\ncm5pbmdzKCJzZXJpYWwiKQpwdWJsaWMgY2xhc3MgQ2xhc3NNZXRhRGF0YQog\nICAgZXh0ZW5kcyBFeHRlbnNpb25zCiAgICBpbXBsZW1lbnRzIENvbXBhcmFi\nbGU8Q2xhc3NNZXRhRGF0YT4sIFNvdXJjZVRyYWNrZXIsIE1ldGFEYXRhQ29u\ndGV4dCwgCiAgICBNZXRhRGF0YU1vZGVzLCBDb21tZW50YWJsZSwgVmFsdWVM\naXN0ZW5lciB7CgogICAgLyoqCiAgICAgKiBVbmtub3duIGlkZW50aXR5IHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElEX1VO\nS05PV04gPSAwOwoKICAgIC8qKgogICAgICogRGF0YXN0b3JlIGlkZW50aXR5\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElE\nX0RBVEFTVE9SRSA9IDE7CgogICAgLyoqCiAgICAgKiBBcHBsaWNhdGlvbiBp\nZGVudGl0eSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBJRF9BUFBMSUNBVElPTiA9IDI7CgogICAgLyoqCiAgICAgKiBVbmtu\nb3duIGFjY2VzcyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBBQ0NFU1NfVU5LTk9XTiA9IEFjY2Vzc0NvZGUuVU5LTk9XTjsK\nCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBhcmUgYWNj\nZXNzZWQgdmlhIGRpcmVjdCBmaWVsZCBhY2Nlc3MuIEJpdCBmbGFnLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1NfRklFTEQg\nPSBBY2Nlc3NDb2RlLkZJRUxEOwoKICAgIC8qKgogICAgICogUGVyc2lzdGVu\ndCBhdHRyaWJ1dGVzIGFyZSBhY2Nlc3NlZCB2aWEgc2V0dGVycyBhbmQgZ2V0\ndGVycy4gQml0IGZsYWcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IEFDQ0VTU19QUk9QRVJUWSA9IEFjY2Vzc0NvZGUuUFJPUEVSVFk7\nCgogICAgLyoqCiAgICAgKiBQZXJzaXN0ZW50IGNsYXNzIGhhcyBleHBsaWNp\ndGx5IGRlZmluZWQgYW4gYWNjZXNzIHR5cGUuIAogICAgICogVGhpcyB3aWxs\nIGFsbG93IHRoZSBhdHRyaWJ1dGVzIHRvIHVzZSBtaXhlZCBhY2Nlc3MgaS5l\nLiBzb21lIGZpZWxkIAogICAgICogbWF5IHVzZSBBQ0NFU1NfRklFTEQgd2hp\nbGUgb3RoZXJzIEFDQ0VTU19QUk9QRVJUWS4gCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEFDQ0VTU19FWFBMSUNJVCA9IEFjY2Vzc0Nv\nZGUuRVhQTElDSVQ7CiAgICAKICAgIC8qKgogICAgICogVmFsdWUgZm9yIHVz\naW5nIGEgc3ludGhldGljIGRldGFjaGVkIHN0YXRlIGZpZWxkLCB3aGljaCBp\ncyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgU1lOVEhFVElDID0gImBzeW4iOwoKICAgIHByb3RlY3RlZCBz\ndGF0aWMgZmluYWwgU3RyaW5nIERFRkFVTFRfU1RSSU5HID0gImAiOwoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxp\nemVyLmZvclBhY2thZ2UKICAgICAgICAoQ2xhc3NNZXRhRGF0YS5jbGFzcyk7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgRmV0Y2hHcm91cFtdIEVNUFRZ\nX0ZFVENIX0dST1VQX0FSUkFZCiAgICAgICAgPSBuZXcgRmV0Y2hHcm91cFsw\nXTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZ1tdIEVNUFRZX1NU\nUklOR19BUlJBWSA9IG5ldyBTdHJpbmdbMF07CgogICAgcHJpdmF0ZSBNZXRh\nRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nQ2xhc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7CgogICAgcHJpdmF0ZSBmaW5h\nbCBWYWx1ZU1ldGFEYXRhIF9vd25lcjsKICAgIHByaXZhdGUgZmluYWwgTGlm\nZWN5Y2xlTWV0YURhdGEgX2xpZmVNZXRhID0gbmV3IExpZmVjeWNsZU1ldGFE\nYXRhKHRoaXMpOwogICAgcHJpdmF0ZSBGaWxlIF9zcmNGaWxlID0gbnVsbDsK\nICAgIHByaXZhdGUgaW50IF9zcmNUeXBlID0gU1JDX09USEVSOwogICAgcHJp\ndmF0ZSBpbnQgX2xpbmVOdW0gPSAwOyAgCiAgICBwcml2YXRlIGludCBfY29s\nTnVtID0gMDsgIAogICAgcHJpdmF0ZSBTdHJpbmdbXSBfY29tbWVudHMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnQgX2xpc3RJbmRleCA9IC0xOwogICAgcHJp\ndmF0ZSBpbnQgX3NyY01vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkc7\nCiAgICBwcml2YXRlIGludCBfcmVzTW9kZSA9IE1PREVfTk9ORTsKCiAgICBw\ncml2YXRlIENsYXNzPD8+IF90eXBlID0gT2JqZWN0LmNsYXNzOwogICAgcHJp\ndmF0ZSBmaW5hbCBNYXA8U3RyaW5nLEZpZWxkTWV0YURhdGE+IF9maWVsZE1h\ncCA9IAogICAgCW5ldyBUcmVlTWFwPFN0cmluZyxGaWVsZE1ldGFEYXRhPigp\nOwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLEZpZWxkTWV0YURhdGE+IF9zdXBG\naWVsZE1hcCA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2RlZlN1cEZp\nZWxkcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uPFN0cmluZz4g\nX3N0YXRpY0ZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIGludFtdIF9maWVs\nZERhdGFUYWJsZSA9IG51bGw7CiAgICBwcml2YXRlIE1hcDxTdHJpbmcsRmV0\nY2hHcm91cD4gX2ZnTWFwID0gbnVsbDsKCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gTm90ZTogaWYgeW91IGFkZCBhZGRpdGlvbmFsIHN0\nYXRlLCBtYWtlIHN1cmUgdG8gYWRkIGl0IHRvIGNvcHkoKQogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwcml2YXRlIENsYXNzPD8+IF9vYmpl\nY3RJZCA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX29iamVjdElkU2hh\ncmVkID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfb3BlbmpwYUlkID0g\nbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfZXh0ZW50ID0gbnVsbDsKICAg\nIHByaXZhdGUgQm9vbGVhbiBfZW1iZWRkZWQgPSBudWxsOwogICAgcHJpdmF0\nZSBib29sZWFuIF9lbWJlZGRhYmxlID0gZmFsc2U7CiAgICBwcml2YXRlIEJv\nb2xlYW4gX2ludGVyZmFjZSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzPD8+\nIF9pbXBsID0gbnVsbDsKICAgIHByaXZhdGUgTGlzdDxDbGFzczw/Pj4gX2lu\ndGVyZmFjZXMgPSBudWxsOwogICAgcHJpdmF0ZSBmaW5hbCBNYXA8Q2xhc3M8\nPz4sTWFwPFN0cmluZyxTdHJpbmc+PiBfaWZhY2VNYXAgPSAKICAgIAluZXcg\nSGFzaE1hcDxDbGFzczw/PixNYXA8U3RyaW5nLFN0cmluZz4+KCk7CiAgICBw\ncml2YXRlIGludCBfaWRlbnRpdHkgPSBJRF9VTktOT1dOOwogICAgcHJpdmF0\nZSBpbnQgX2lkU3RyYXRlZ3kgPSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORTsKICAg\nIHByaXZhdGUgaW50IF9hY2Nlc3NUeXBlID0gQWNjZXNzQ29kZS5VTktOT1dO\nOwogICAgcHJpdmF0ZSBib29sZWFuIF9yZXBsaWNhdGVkID0gZmFsc2U7CiAg\nICAKICAgIHByaXZhdGUgU3RyaW5nIF9zZXFOYW1lID0gREVGQVVMVF9TVFJJ\nTkc7CiAgICBwcml2YXRlIFNlcXVlbmNlTWV0YURhdGEgX3NlcU1ldGEgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX2NhY2hlTmFtZSA9IERFRkFVTFRf\nU1RSSU5HOwogICAgcHJpdmF0ZSBCb29sZWFuIF9jYWNoZUVuYWJsZWQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnQgX2NhY2hlVGltZW91dCA9IEludGVnZXIu\nTUlOX1ZBTFVFOwogICAgcHJpdmF0ZSBCb29sZWFuIF9kZXRhY2hhYmxlID0g\nbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9kZXRhY2hTdGF0ZSA9IERFRkFV\nTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBTdHJpbmcgX2FsaWFzID0gbnVsbDsK\nICAgIHByaXZhdGUgaW50IF92ZXJzaW9uSWR4ID0gSW50ZWdlci5NSU5fVkFM\nVUU7CgogICAgcHJpdmF0ZSBDbGFzczw/PiBfc3VwZXIgPSBudWxsOwogICAg\ncHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9zdXBlck1ldGEgPSBudWxsOwogICAg\ncHJpdmF0ZSBDbGFzczw/PltdIF9zdWJzID0gbnVsbDsKICAgIHByaXZhdGUg\nQ2xhc3NNZXRhRGF0YVtdIF9zdWJNZXRhcyA9IG51bGw7CiAgICBwcml2YXRl\nIENsYXNzTWV0YURhdGFbXSBfbWFwU3ViTWV0YXMgPSBudWxsOwoKICAgIHBy\naXZhdGUgRmllbGRNZXRhRGF0YVtdIF9maWVsZHMgPSBudWxsOwogICAgcHJp\ndmF0ZSBGaWVsZE1ldGFEYXRhW10gX3VubWdkRmllbGRzID0gbnVsbDsKICAg\nIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxGaWVsZHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2FsbFBLRmllbGRzID0gbnVs\nbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxERkdGaWVsZHMg\nPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2RlZmluZWRG\naWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2xp\nc3RpbmdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRh\nW10gX2FsbExpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGZXRj\naEdyb3VwW10gX2ZncyA9IG51bGw7CiAgICBwcml2YXRlIEZldGNoR3JvdXBb\nXSBfY3VzdG9tRkdzID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaW50\nZXJjZXB0aW5nID0gZmFsc2U7CiAgICBwcml2YXRlIEJvb2xlYW4gX3VzZUlk\nQ2xhc3NGcm9tUGFyZW50ID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nYWJzdHJhY3QgPSBmYWxzZTsKICAgIHByaXZhdGUgQm9vbGVhbiBfaGFzQWJz\ndHJhY3RQS0ZpZWxkID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfaGFz\nUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFzcyA9IG51bGw7CiAgICBwcml2YXRl\nIEJvb2xlYW4gX2lzQ2FjaGVhYmxlID0gbnVsbDsKICAgIAogICAgLyoqCiAg\nICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCBy\nZXBvc2l0b3J5LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0\nYShDbGFzczw/PiB0eXBlLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsK\nICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfb3duZXIgPSBudWxs\nOwogICAgICAgIHNldERlc2NyaWJlZFR5cGUodHlwZSk7CiAgICAgICAgcmVn\naXN0ZXJGb3JWYWx1ZVVwZGF0ZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAg\nfQoKICAgIC8qKgogICAgICogRW1iZWRkZWQgY29uc3RydWN0b3IuIFN1cHBs\neSBlbWJlZGRpbmcgdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFz\nc01ldGFEYXRhKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICBfb3du\nZXIgPSBvd25lcjsKICAgICAgICBfcmVwb3MgPSBvd25lci5nZXRSZXBvc2l0\nb3J5KCk7CiAgICAgICAgc2V0RW52Q2xhc3NMb2FkZXIob3duZXIuZ2V0Rmll\nbGRNZXRhRGF0YSgpLmdldERlZmluaW5nTWV0YURhdGEoKS4KICAgICAgICAg\nICAgZ2V0RW52Q2xhc3NMb2FkZXIoKSk7CiAgICAgICAgcmVnaXN0ZXJGb3JW\nYWx1ZVVwZGF0ZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAq\nLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5\nKCkgewogICAgICAgIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB0aGlzIG1ldGFkYXRhIGlzIGZvciBhbiBlbWJlZGRlZCBvYmpl\nY3QsIHJldHVybmluZyB0aGUgb3duaW5nIHZhbHVlLgogICAgICovCiAgICBw\ndWJsaWMgVmFsdWVNZXRhRGF0YSBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpIHsK\nICAgICAgICByZXR1cm4gX293bmVyOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRo\naXMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzczw/PiBnZXRE\nZXNjcmliZWRUeXBlKCkgewogICAgICAgIHJldHVybiBfdHlwZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRo\naXMgbWV0YWRhdGEuIFRoZSB0eXBlIG1heSBiZSByZXNldCB3aGVuCiAgICAg\nKiBhbiBlbWJlZGRlZCB2YWx1ZSBjaGFuZ2VzIGl0cyBkZWNsYXJlZCB0eXBl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXREZXNjcmliZWRUeXBl\nKENsYXNzPD8+IHR5cGUpIHsKICAgICAgICBpZiAodHlwZS5nZXRTdXBlcmNs\nYXNzKCkgIT0gbnVsbCAmJiAiamF2YS5sYW5nLkVudW0iLmVxdWFscwogICAg\nICAgICAgICAodHlwZS5nZXRTdXBlcmNsYXNzKCkuZ2V0TmFtZSgpKSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJlbnVtIiwgdHlwZSkpOwogICAgICAgIF90eXBlID0gdHlwZTsKICAgICAg\nICBpZiAoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZy\nb20odHlwZSkpCiAgICAgICAgICAgIHNldEludGVyY2VwdGluZyh0cnVlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBlbnZpcm9ubWVudGFsIGxvYWRl\nciB1c2VkIHdoZW4gbG9hZGluZyB0aGlzIG1ldGFkYXRhLgogICAgICogVGhl\nIGNsYXNzIG1ldGFkYXRhIHNob3VsZCB1c2UgdGhpcyBsb2FkZXIgd2hlbiBs\nb2FkaW5nIG1ldGFkYXRhIGZvcgogICAgICogaXRzIHN1cGVyY2xhc3MgYW5k\nIGZpZWxkIHR5cGVzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIg\nZ2V0RW52Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgZW52aXJvbm1lbnRh\nbCBsb2FkZXIgdXNlZCB3aGVuIGxvYWRpbmcgdGhpcyBtZXRhZGF0YS4KICAg\nICAqIFRoZSBjbGFzcyBtZXRhZGF0YSBzaG91bGQgdXNlIHRoaXMgbG9hZGVy\nIHdoZW4gbG9hZGluZyBtZXRhZGF0YSBmb3IKICAgICAqIGl0cyBzdXBlcmNs\nYXNzIGFuZCBmaWVsZCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAg\nICAgX2xvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1cGVyY2xhc3Mgb2YgdGhlIGRlc2Ny\naWJlZCB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0UENT\ndXBlcmNsYXNzKCkgewogICAgICAgIHJldHVybiBfc3VwZXI7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBzdXBlcmNs\nYXNzIG9mIHRoZSBkZXNjcmliZWQgdHlwZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0UENTdXBlcmNsYXNzKENsYXNzPD8+IHBjKSB7CiAgICAgICAg\nY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX3N1cGVyID0gcGM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgZm9yIHRoaXMgY2xh\nc3MnIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkgewogICAgICAgIGlmIChf\nc3VwZXJNZXRhID09IG51bGwgJiYgX3N1cGVyICE9IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKF9vd25lciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBf\nc3VwZXJNZXRhID0gX3JlcG9zLm5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShf\nb3duZXIpOwogICAgICAgICAgICAgICAgX3N1cGVyTWV0YS5zZXREZXNjcmli\nZWRUeXBlKF9zdXBlcik7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgX3N1cGVyTWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YShfc3VwZXIs\nIF9sb2FkZXIsIHRydWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3N1\ncGVyTWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSBm\nb3IgdGhpcyBjbGFzcycgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0UENTdXBlcmNsYXNzTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBt\nZXRhKSB7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAg\nX3N1cGVyTWV0YSA9IG1ldGE7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkK\nICAgICAgICAgICAgc2V0UENTdXBlcmNsYXNzKG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBj\nbGFzcyBpcyBtYXBwZWQgdG8gdGhlIGRhdGFzdG9yZS4gQnkgZGVmYXVsdCwg\nb25seQogICAgICogcmV0dXJucyBmYWxzZSBpZiBjbGFzcyBpcyBlbWJlZGRl\nZC1vbmx5LCBidXQgc3ViY2xhc3NlcyBtaWdodCBvdmVycmlkZQogICAgICog\ndG8gYWxsb3cgdW5tYXBwZWQgb3RoZXIgdHlwZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzTWFwcGVkKCkgewogICAgICAgIHJldHVybiBfZW1i\nZWRkZWQgIT0gQm9vbGVhbi5UUlVFOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBjbG9zZXN0IG1hcHBlZCBzdXBlcmNsYXNzLgogICAgICov\nCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNYXBwZWRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCA9PSBu\ndWxsIHx8IHN1cC5pc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4gc3Vw\nOwogICAgICAgIHJldHVybiBzdXAuZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUga25v\nd24gcGVyc2lzdGVuY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9mIHRoZSBkZXNj\ncmliZWQgdHlwZSwKICAgICAqIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUgb3Ig\naWYgdGhpcyBpcyBlbWJlZGRlZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVi\nbGljIENsYXNzPD8+W10gZ2V0UENTdWJjbGFzc2VzKCkgewogICAgICAgIGlm\nIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ldGFEYXRh\nUmVwb3NpdG9yeS5FTVBUWV9DTEFTU0VTOwoKICAgICAgICBfcmVwb3MucHJv\nY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKF9sb2FkZXIpOwogICAgICAgIGlmIChf\nc3VicyA9PSBudWxsKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8\nPz4+IHN1YnMgPSBfcmVwb3MuZ2V0UENTdWJjbGFzc2VzKF90eXBlKTsKICAg\nICAgICAgICAgX3N1YnMgPSAoQ2xhc3NbXSkgc3Vicy50b0FycmF5KG5ldyBD\nbGFzc1tzdWJzLnNpemUoKV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX3N1YnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFk\nYXRhIGZvciB0aGUga25vd24gcGVyc2lzdGVuY2UgY2FwYWJsZSBzdWJjbGFz\nc2VzIG9mCiAgICAgKiB0aGUgZGVzY3JpYmVkIHR5cGUsIG9yIGVtcHR5IGFy\ncmF5IGlmIG5vbmUgb3IgaWYgdGhpcyBpcyBlbWJlZGRlZAogICAgICogbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0\nUENTdWJjbGFzc01ldGFEYXRhcygpIHsKICAgICAgICBpZiAoX293bmVyICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1QVFlfTUVUQVM7\nCgogICAgICAgIENsYXNzPD8+W10gc3VicyA9IGdldFBDU3ViY2xhc3Nlcygp\nOyAvLyBjaGVja3MgZm9yIG5ldwogICAgICAgIGlmIChfc3ViTWV0YXMgPT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgICAgIF9zdWJNZXRhcyA9IF9yZXBvcy5FTVBUWV9NRVRBUzsK\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFzc01ldGFE\nYXRhW10gbWV0YXMgPSBfcmVwb3MubmV3Q2xhc3NNZXRhRGF0YUFycmF5CiAg\nICAgICAgICAgICAgICAgICAgKHN1YnMubGVuZ3RoKTsKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgICAgICBtZXRhc1tpXSA9IF9yZXBvcy5nZXRNZXRhRGF0\nYShzdWJzW2ldLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9z\ndWJNZXRhcyA9IG1ldGFzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfc3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYWxsIG1hcHBlZCBzdWJjbGFzc2VzLgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3NNZXRhRGF0YVtdIGdldE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0\nYXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gX3JlcG9zLkVNUFRZX01FVEFTOwoKICAgICAgICBDbGFzc01l\ndGFEYXRhW10gc3VicyA9IGdldFBDU3ViY2xhc3NNZXRhRGF0YXMoKTsgLy8g\nY2hlY2tzIGZvciBuZXcKICAgICAgICBpZiAoX21hcFN1Yk1ldGFzID09IG51\nbGwpIHsKICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAgICAg\nICAgICAgICAgICBfbWFwU3ViTWV0YXMgPSBzdWJzOwogICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgIExpc3Q8Q2xhc3NNZXRhRGF0YT4gbWFw\ncGVkID0gCiAgICAgICAgICAgICAgICAJbmV3IEFycmF5TGlzdDxDbGFzc01l\ndGFEYXRhPihzdWJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICAgICAgaWYgKHN1YnNbaV0uaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbWFwcGVkLmFkZChzdWJzW2ldKTsKICAgICAgICAgICAgICAg\nIF9tYXBTdWJNZXRhcyA9IChDbGFzc01ldGFEYXRhW10pIG1hcHBlZC50b0Fy\ncmF5CiAgICAgICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdDbGFzc01ldGFE\nYXRhQXJyYXkobWFwcGVkLnNpemUoKSkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfbWFwU3ViTWV0YXM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgdHlwZSBvZiBpZGVudGl0eSBiZWluZyB1c2VkLiBU\naGlzIHdpbGwgYmUgb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxpPntA\nbGluayAjSURfVU5LTk9XTn06IHVua25vd24gaWRlbnRpdHkgdHlwZTwvbGk+\nCiAgICAgKiA8bGk+e0BsaW5rICNJRF9EQVRBU1RPUkV9OiBpZGVudGl0eSBt\nYW5hZ2VkIGJ5IHRoZSBkYXRhIHN0b3JlIGFuZAogICAgICogaW5kZXBlbmRl\nbnQJb2YgdGhlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICog\nPGxpPntAbGluayAjSURfQVBQTElDQVRJT059OiBpZGVudGl0eSBtYW5hZ2Vk\nIGJ5IHRoZSBhcHBsaWNhdGlvbiBhbmQKICAgICAqIGRlZmluZWQgYnkgb25l\nIG9yIG1vcmUgZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8\nL3VsPiBJZiB1bnNwZWNpZmllZCwgZGVmYXVsdHMgdG8ge0BsaW5rICNJRF9E\nQVRBU1RPUkV9IGlmIHRoZXJlIGFyZSBubwogICAgICogcHJpbWFyeSBrZXkg\nZmllbGRzLCBhbmQge0BsaW5rICNJRF9BUFBMSUNBVElPTn0gb3RoZXJ3aXNl\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldElkZW50aXR5VHlwZSgpIHsK\nICAgICAgICBpZiAoX2lkZW50aXR5ID09IElEX1VOS05PV04pIHsKICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdl\ndElkZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04pCiAgICAgICAgICAgICAg\nICBfaWRlbnRpdHkgPSBzdXAuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAg\nICAgIGVsc2UgaWYgKGdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGggPiAw\nKQogICAgICAgICAgICAgICAgX2lkZW50aXR5ID0gSURfQVBQTElDQVRJT047\nCiAgICAgICAgICAgIGVsc2UgaWYgKGlzTWFwcGVkKCkpCiAgICAgICAgICAg\nICAgICBfaWRlbnRpdHkgPSBJRF9EQVRBU1RPUkU7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IF9yZXBvcy5nZXRNZXRh\nRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICAgICAg\nICAgIGdldERlZmF1bHRJZGVudGl0eVR5cGUoKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9pZGVudGl0eTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSB0eXBlIG9mIGlkZW50aXR5IGJlaW5nIHVzZWQuIFRoaXMgd2lsbCBiZSBv\nbmUgb2Y6CiAgICAgKiA8dWw+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9VTktO\nT1dOfTogdW5rbm93biBpZGVudGl0eSB0eXBlPC9saT4KICAgICAqIDxsaT57\nQGxpbmsgI0lEX0RBVEFTVE9SRX06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhl\nIGRhdGEgc3RvcmUgYW5kCiAgICAgKiBpbmRlcGVuZGVudAlvZiB0aGUgZmll\nbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJ\nRF9BUFBMSUNBVElPTn06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGFwcGxp\nY2F0aW9uIGFuZAogICAgICogZGVmaW5lZCBieSBvbmUgb3IgbW9yZSBmaWVs\nZHMgb2YgdGhlIGluc3RhbmNlPC9saT4KICAgICAqIDwvdWw+IElmIHVuc3Bl\nY2lmaWVkLCBkZWZhdWx0cyB0byB7QGxpbmsgI0lEX0RBVEFTVE9SRX0gaWYg\ndGhlcmUgYXJlIG5vCiAgICAgKiBwcmltYXJ5IGtleSBmaWVsZHMsIGFuZCB7\nQGxpbmsgI0lEX0FQUExJQ0FUSU9OfSBvdGhlcndpc2UuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldElkZW50aXR5VHlwZShpbnQgdHlwZSkgewogICAg\nICAgIF9pZGVudGl0eSA9IHR5cGU7CiAgICAgICAgaWYgKHR5cGUgIT0gSURf\nQVBQTElDQVRJT04pIHsKICAgICAgICAgICAgX29iamVjdElkID0gbnVsbDsK\nICAgICAgICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhLXNwZWNpZmllZCBjbGFz\ncyB0byB1c2UgZm9yIHRoZSBvYmplY3QgSUQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzczw/PiBnZXRPYmplY3RJZFR5cGUoKSB7CiAgICAgICAgLy8gaWYg\ndGhpcyBlbnRpdHkgZG9lcyBub3QgdXNlIElkQ2xhc3MgZnJvbSB0aGUgcGFy\nZW50IGVudGl0eSwKICAgICAgICAvLyBqdXN0IHJldHVybiB0aGUgX29iamVj\ndElkIHNldCBkdXJpbmcgYW5ub3RhdGlvbiBwYXJzaW5nIHRpbWUuCiAgICAg\nICAgaWYgKCF1c2VJZENsYXNzRnJvbVBhcmVudCgpKSB7CiAgICAgICAgICAg\nIGlmIChfb2JqZWN0SWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBfb2JqZWN0SWQ7CiAgICAgICAgfSAKICAgICAgICAKICAgICAgICAvLyBp\nZiB0aGlzIGVudGl0eSB1c2VzIElkQ2xhc3MgZnJvbSB0aGUgcGFyZW50IGVu\ndGl0eSwKICAgICAgICAvLyB0aGUgX29iamVjdElkIHNldCBkdXJpbmcgdGhl\nIHBhcnNpbmcgdGltZSBzaG91bGQgYmUKICAgICAgICAvLyBpZ25vcmVkLCBh\nbmQgbGV0IHRoZSBzeXN0ZW0gZGV0ZXJtaW5lIHRoZSBvYmplY3RJZCB0eXBl\nCiAgICAgICAgLy8gb2YgdGhpcyBlbnRpdHkuCiAgICAgICAgaWYgKGdldElk\nZW50aXR5VHlwZSgpICE9IElEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxs\nICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOKSB7CiAg\nICAgICAgICAgIF9vYmplY3RJZCA9IHN1cC5nZXRPYmplY3RJZFR5cGUoKTsK\nICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RJZDsKICAgICAgICB9CgogICAg\nICAgIC8vIGZpZ3VyZSBvdXQgT3BlbkpQQSBpZGVudGl0eSB0eXBlIGJhc2Vk\nIG9uIHByaW1hcnkga2V5IGZpZWxkCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIHBrcyA9IGdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAocGtz\nLmxlbmd0aCAhPSAxKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBzd2l0Y2ggKHBrc1swXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIF9v\nYmplY3RJZCA9IEJ5dGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIF9v\nYmplY3RJZCA9IENoYXJJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAg\nICBfb2JqZWN0SWQgPSBEb3VibGVJZC5jbGFzczsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAg\nICAgICAgX29iamVjdElkID0gRmxvYXRJZC5jbGFzczsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAg\nICAgICBfb2JqZWN0SWQgPSBJbnRJZC5jbGFzczsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAg\nICAgIF9vYmplY3RJZCA9IExvbmdJZC5jbGFzczsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAg\nICAgICAgX29iamVjdElkID0gU2hvcnRJZC5jbGFzczsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6\nCiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBTdHJpbmdJZC5jbGFzczsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5EQVRFOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gRGF0ZUlk\nLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nT0JKRUNUOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gT2JqZWN0SWQu\nY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgICAgIF9vYmpl\nY3RJZCA9IEJpZ0RlY2ltYWxJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgog\nICAgICAgICAgICAgICAgX29iamVjdElkID0gQmlnSW50ZWdlcklkLmNsYXNz\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfb2JqZWN0SWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0\nYWRhdGEtc3BlY2lmaWVkIGNsYXNzIHRvIHVzZSBmb3IgdGhlIG9iamVjdCBJ\nRC4KICAgICAqIFdoZW4gdGhlcmUgaXMgSWRDbGFzcyBhbm5vdGF0aW9uLCBB\nbm5vdGF0aW9uTWV0YURhdGFQYXJzZXIKICAgICAqIHdpbGwgY2FsbCB0aGlz\nIG1ldGhvZCB0byBzZXQgT2JqZWN0SWQgdHlwZS4gSG93ZXZlciwgaWYgCiAg\nICAgKiB0aGlzIGlzIGEgZGVyaXZlZCBpZGVudGl0eSBpbiB0aGUgY2hpbGQg\nZW50aXR5IHdoZXJlIGEgCiAgICAgKiByZWxhdGlvbiBmaWVsZCAocGFyZW50\nIGVudGl0eSkgaXMgdXNlZCBhcyBhbiBpZCwgYW5kIHRoaXMgCiAgICAgKiBy\nZWxhdGlvbiBmaWVsZCBoYXMgYW4gSWRDbGFzcywgdGhlIElkQ2xhc3MgYW5u\nb3RhdGlvbiBpbiAKICAgICAqIHRoZSBjaGlsZCBlbnRpdHkgY2FuIGJlIGln\nbm9yZWQgYXMgT3BlbmpwYSB3aWxsIGF1dG9tYXRpY2FsbHkgICAKICAgICAq\nIHdyYXAgcGFyZW50J3MgSWRDbGFzcyBhcyBjaGlsZCdzIElkQ2xhc3MuIAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3RJZFR5cGUoQ2xhc3M8\nPz4gY2xzLCBib29sZWFuIHNoYXJlZCkgewogICAgICAgIF9vYmplY3RJZCA9\nIG51bGw7CiAgICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgX29i\namVjdElkU2hhcmVkID0gbnVsbDsKICAgICAgICBpZiAoY2xzICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbGV0IHBlb3BsZSBhc3NpZ24gT3Bl\nbkpQQUlkIHR5cGVzOyBzYWZlciB0byBjYWxjdWxhdGUgaXQKICAgICAgICAg\nICAgLy8gb3Vyc2VsdmVzCiAgICAgICAgICAgIHNldElkZW50aXR5VHlwZShJ\nRF9BUFBMSUNBVElPTik7CiAgICAgICAgICAgIGlmICghT3BlbkpQQUlkLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkgewogICAgICAgICAgICAgICAg\nX29iamVjdElkID0gY2xzOwogICAgICAgICAgICAgICAgX29iamVjdElkU2hh\ncmVkID0gKHNoYXJlZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGlzIHR5cGUgdXNlcyBhbiBhcHBsaWNhdGlvbiBpZGVu\ndGl0eSBjbGFzcyB0aGF0IGlzIHNoYXJlZAogICAgICogd2l0aCBvdGhlciBj\nbGFzc2VzLCBhbmQgaXMgdGhlcmVmb3JlIHdyYXBwZWQgaW4gYW4ge0BsaW5r\nIE9iamVjdElkfS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNPYmpl\nY3RJZFR5cGVTaGFyZWQoKSB7CiAgICAgICAgaWYgKF9vYmplY3RJZFNoYXJl\nZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX29iamVjdElkU2hhcmVk\nLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\naXNPYmplY3RJZFR5cGVTaGFyZWQoKTsKICAgICAgICByZXR1cm4gaXNPcGVu\nSlBBSWRlbnRpdHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhpcyB0eXBlIHVzZXMgT3BlbkpQQSBpZGVudGl0eS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNPcGVuSlBBSWRlbnRpdHkoKSB7CiAgICAgICAg\naWYgKF9vcGVuanBhSWQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzczw/\nPiBjbHMgPSBnZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAgaWYgKGNs\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICBfb3BlbmpwYUlkID0gKE9wZW5KUEFJZC5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKGNscykpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAg\nICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nb3BlbmpwYUlkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHN0cmF0ZWd5IHRvIHVzZSBmb3IgZGF0YXN0b3JlIGlkZW50aXR5\nIGdlbmVyYXRpb24uCiAgICAgKiBPbmUgb2YgdGhlIGNvbnN0YW50cyBmcm9t\nIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXN9LgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldElkZW50aXR5U3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKGdldElk\nZW50aXR5VHlwZSgpID09IElEX0RBVEFTVE9SRQogICAgICAgICAgICAmJiBf\naWRTdHJhdGVneSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkgewogICAgICAg\nICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0\nSWRlbnRpdHlUeXBlKCkgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgICAg\nIF9pZFN0cmF0ZWd5ID0gc3VwLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kgPSBW\nYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2lkU3RyYXRlZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3Ry\nYXRlZ3kgdG8gdXNlIGZvciBkYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJhdGlv\nbi4KICAgICAqIE9uZSBvZiB0aGUgY29uc3RhbnRzIGZyb20ge0BsaW5rIFZh\nbHVlU3RyYXRlZ2llc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElk\nZW50aXR5U3RyYXRlZ3koaW50IHN0cmF0ZWd5KSB7CiAgICAgICAgX2lkU3Ry\nYXRlZ3kgPSBzdHJhdGVneTsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gVmFs\ndWVTdHJhdGVnaWVzLlNFUVVFTkNFKQogICAgICAgICAgICBzZXRJZGVudGl0\neVNlcXVlbmNlTmFtZShudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBkYXRhc3RvcmUgaWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBm\nb3Igbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJZGVudGl0\neVNlcXVlbmNlTmFtZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcu\nZXF1YWxzKF9zZXFOYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfc2VxTmFtZSA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX3NlcU5hbWUgPSBudWxs\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3NlcU5hbWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNl\nIG5hbWUsIG9yIG51bGwgZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldElkZW50aXR5U2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1lKSB7\nCiAgICAgICAgX3NlcU5hbWUgPSBzZXFOYW1lOwogICAgICAgIF9zZXFNZXRh\nID0gbnVsbDsKICAgICAgICBpZiAoc2VxTmFtZSAhPSBudWxsKQogICAgICAg\nICAgICBzZXRJZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5TRVFV\nRU5DRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBmb3IgdGhl\nIGRhdGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5jZS4KICAgICAqLwogICAgcHVi\nbGljIFNlcXVlbmNlTWV0YURhdGEgZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFE\nYXRhKCkgewogICAgICAgIGlmIChfc2VxTWV0YSA9PSBudWxsICYmIGdldElk\nZW50aXR5U2VxdWVuY2VOYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAgX3Nl\ncU1ldGEgPSBfcmVwb3MuZ2V0U2VxdWVuY2VNZXRhRGF0YSh0aGlzLAogICAg\nICAgICAgICAgICAgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSwgdHJ1ZSk7\nCiAgICAgICAgcmV0dXJuIF9zZXFNZXRhOwogICAgfQoKICAgIC8qKgogICAg\nICogSW5mb3JtYXRpb24gYWJvdXQgbGlmZWN5Y2xlIGNhbGxiYWNrcyBmb3Ig\ndGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZU1ldGFE\nYXRhIGdldExpZmVjeWNsZU1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBf\nbGlmZU1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBh\nbGlhcyBmb3IgdGhlIGRlc2NyaWJlZCB0eXBlLCBvciA8Y29kZT5udWxsPC9j\nb2RlPiBpZiBub25lCiAgICAgKiBoYXMgYmVlbiBzZXQuCiAgICAgKiAKICAg\nICAqIEBzZWUgI3NldFR5cGVBbGlhcwogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFR5cGVBbGlhcygpIHsKICAgICAgICBpZiAoX2FsaWFzID09IG51\nbGwpCiAgICAgICAgICAgIF9hbGlhcyA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1l\nKF90eXBlKTsKICAgICAgICByZXR1cm4gX2FsaWFzOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0cyB0aGUgYWxpYXMgZm9yIHRoZSBkZXNjcmliZWQgdHlw\nZS4gVGhlIGFsaWFzIGNhbiBiZQogICAgICogYW55IGFyYml0cmFyeSBzdHJp\nbmcgdGhhdCB0aGUgaW1wbGVtZW50YXRpb24gY2FuIGxhdGVyIHVzZSB0bwog\nICAgICogcmVmZXIgdG8gdGhlIGNsYXNzLiBOb3RlIHRoYXQgYXQgcnVudGlt\nZSwgb25seSB0aGUgYWxpYXMKICAgICAqIGNvbXB1dGVkIHdoZW4gdGhlIHBl\ncnNpc3RlbnQgdHlwZSB3YXMgZW5oYW5jZWQgaXMgdXNlZC4KICAgICAqCiAg\nICAgKiBAcGFyYW0gYWxpYXMgdGhlIGFsaWFzIG5hbWUgdG8gYXBwbHkgdG8g\ndGhlIGRlc2NyaWJlZCB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFR5cGVBbGlhcyhTdHJpbmcgYWxpYXMpIHsKICAgICAgICBfYWxpYXMgPSBh\nbGlhczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1\nc2VkIGJ5IHRoaXMgY2xhc3MuIAogICAgICogCiAgICAgKi8KICAgIHB1Ymxp\nYyBpbnQgZ2V0QWNjZXNzVHlwZSgpIHsKICAgICAgICByZXR1cm4gX2FjY2Vz\nc1R5cGU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB0aGUgYWNj\nZXNzIHR5cGUuIAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBY2Nlc3NU\neXBlKGludCB0eXBlKSB7CiAgICAJaWYgKHR5cGUgPT0gX2FjY2Vzc1R5cGUg\nfHwgdHlwZSA9PSBBY2Nlc3NDb2RlLlVOS05PV04pCiAgICAJCXJldHVybjsK\nICAgIAlpZiAoIUFjY2Vzc0NvZGUuaXNWYWxpZENsYXNzQ29kZSh0eXBlKSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0\naW9uKF9sb2MuZ2V0KCJhY2Nlc3MtdHlwZS1pbnZhbGlkIiwgCiAgICAJCSAg\nICB0aGlzLCBBY2Nlc3NDb2RlLnRvQ2xhc3NTdHJpbmcodHlwZSkpLmdldE1l\nc3NhZ2UoKSk7CiAgICAJfQogICAgCWlmIChfYWNjZXNzVHlwZSAhPSBBY2Nl\nc3NDb2RlLlVOS05PV04pIHsgLy8gY2hhbmdpbmcgYWNjZXNzIHR5cGUKICAg\nIAkgICAgX3JlcG9zLmdldExvZygpLndhcm4oX2xvYy5nZXQoImFjY2Vzcy10\neXBlLWNoYW5nZSIsIAogICAgCQkgICAgdGhpcywgQWNjZXNzQ29kZS50b0Ns\nYXNzU3RyaW5nKHR5cGUpLCAKICAgIAkJICAgIEFjY2Vzc0NvZGUudG9DbGFz\nc1N0cmluZyhfYWNjZXNzVHlwZSkpLmdldE1lc3NhZ2UoKSk7CiAgICAJfQog\nICAgICAgIF9hY2Nlc3NUeXBlID0gdHlwZTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBBc3NlcnRzIHRoZSB0aGUgZ2l2ZW4gZmllbGQgKHdoaWNoIG11\nc3QgYmVsb25nIHRvIHRoaXMgcmVjZWl2ZXIpCiAgICAgKiBjYW4gYmUgc2V0\nIHRvIHRoZSBnaXZlbiBhY2Nlc3MgY29kZS4gSWYgdGhlIGZpZWxkIGNvZGUg\naXMgYWxsb3dlZCwKICAgICAqIGl0IG1heSBoYXZlIHRoZSBzaWRlLWVmZmVj\ndCBvZiBjaGFuZ2luZyB0aGUgYWNjZXNzIGNvZGUgb2YgdGhpcyByZWNlaXZl\nci4KICAgICAqLwogICAgdm9pZCBtZXJnZUZpZWxkQWNjZXNzKEZpZWxkTWV0\nYURhdGEgZm1kLCBpbnQgZkNvZGUpIHsKICAgIAlzZXRBY2Nlc3NUeXBlKEFj\nY2Vzc0NvZGUubWVyZ2VGaWVsZENvZGUodGhpcywgZm1kLCBmQ29kZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiBhY2Nlc3Mgc3R5bGUg\naXMgZXhwbGljaXRseSBkZWZpbmVkLgogICAgICovICAgIAogICAgcHVibGlj\nIGJvb2xlYW4gaXNFeHBsaWNpdEFjY2VzcygpIHsKICAgICAgICByZXR1cm4g\nQWNjZXNzQ29kZS5pc0V4cGxpY2l0KF9hY2Nlc3NUeXBlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFmZmlybXMgaWYgYXR0cmlidXRlcyBvZiB0aGlzIGNs\nYXNzIHVzZSBtaXhlZCBhY2Nlc3MgdHlwZXMuCiAgICAgKi8gICAgCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc01peGVkQWNjZXNzKCkgewogICAgCXJldHVybiBB\nY2Nlc3NDb2RlLmlzTWl4ZWQoX2FjY2Vzc1R5cGUpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgcmVxdWlyZXMgZXh0ZW50\nIG1hbmFnZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFJl\ncXVpcmVzRXh0ZW50KCkgewogICAgICAgIGlmIChfb3duZXIgIT0gbnVsbCB8\nfCBpc0VtYmVkZGVkT25seSgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIGlmIChfZXh0ZW50ID09IG51bGwpIHsKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfZXh0ZW50ID0gKHN1cC5nZXRSZXF1aXJlc0V4dGVudCgpKSA/IEJvb2xl\nYW4uVFJVRQogICAgICAgICAgICAgICAgICAgIDogQm9vbGVhbi5GQUxTRTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2V4dGVudCA9IEJv\nb2xlYW4uVFJVRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9leHRlbnQu\nYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRoZSB0eXBlIHJlcXVpcmVzIGV4dGVudCBtYW5hZ2VtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRSZXF1aXJlc0V4dGVudChib29sZWFuIHJl\ncSkgewogICAgICAgIF9leHRlbnQgPSAocmVxKSA/IEJvb2xlYW4uVFJVRSA6\nIEJvb2xlYW4uRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRoZSB0eXBlIGNhbiBvbmx5IGJlIHVzZWQgYXMgYW4gZW1iZWRkZWQgb2Jq\nZWN0LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0VtYmVkZGVkT25s\neSgpIHsKICAgICAgICBpZiAoX2VtYmVkZGVkID09IG51bGwpIHsKICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBfZW1iZWRkZWQgPSAoc3VwLmlzRW1iZWRkZWRPbmx5KCkpID8g\nQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICAgICAgOiBCb29sZWFuLkZB\nTFNFOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZW1iZWRk\nZWQgPSBCb29sZWFuLkZBTFNFOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2VtYmVkZGVkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGUgdHlwZSBjYW4gb25seSBiZSB1c2VkIGFzIGFuIGVt\nYmVkZGVkIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RW1i\nZWRkZWRPbmx5KGJvb2xlYW4gZW1iZWQpIHsKICAgICAgICBfZW1iZWRkZWQg\nPSAoZW1iZWQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAg\nIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gaXNFbWJlZGRhYmxlKCkgewog\nICAgICAgIHJldHVybiBfZW1iZWRkYWJsZTsKICAgIH0KICAgIAogICAgcHVi\nbGljIHZvaWQgc2V0RW1iZWRkYWJsZSgpIHsKICAgICAgICBfZW1iZWRkYWJs\nZSA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0\neXBlJ3MgZmllbGRzIGFyZSBhY3RpdmVseSBpbnRlcmNlcHRlZCwgZWl0aGVy\nIGJ5CiAgICAgKiByZWRlZmluaXRpb24gb3IgZW5oYW5jZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzSW50ZXJjZXB0aW5nKCkgewogICAg\nICAgIHJldHVybiBfaW50ZXJjZXB0aW5nOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGUgdHlwZSdzIGZpZWxkcyBhcmUgYWN0aXZlbHkgaW50\nZXJjZXB0ZWQsIGVpdGhlciBieQogICAgICogcmVkZWZpbml0aW9uIG9yIGVu\naGFuY2VtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmNl\ncHRpbmcoYm9vbGVhbiBpbnRlcmNlcHRpbmcpIHsKICAgICAgICBfaW50ZXJj\nZXB0aW5nID0gaW50ZXJjZXB0aW5nOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSBpcyBhIG1hbmFnZWQgaW50ZXJmYWNlLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWRJbnRlcmZhY2UoKSB7\nCiAgICAgICAgaWYgKCFfdHlwZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9pbnRlcmZhY2UgPT0g\nbnVsbCA/IGZhbHNlIDogX2ludGVyZmFjZS5ib29sZWFuVmFsdWUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgaXMgYSBtYW5h\nZ2VkIGludGVyZmFjZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNYW5h\nZ2VkSW50ZXJmYWNlKGJvb2xlYW4gbWFuYWdlZEludGVyZmFjZSkgewogICAg\nICAgIGlmICghX3R5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtaW50ZXJm\nYWNlIiwgX3R5cGUpKTsKICAgICAgICBfaW50ZXJmYWNlID0gbWFuYWdlZElu\ndGVyZmFjZSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CgogICAg\nICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNlcyBhbHdheXMgZG8gcHJvcGVyIGlu\ndGVyY2VwdGlvbjsgT3BlbkpQQSBnZW5lcmF0ZXMKICAgICAgICAvLyB0aGUg\naW1wbGVtZW50YXRpb25zLgogICAgICAgIGlmIChpc01hbmFnZWRJbnRlcmZh\nY2UoKSkKICAgICAgICAgICAgc2V0SW50ZXJjZXB0aW5nKHRydWUpOwoKICAg\nICAgICAvLyBtYW5hZ2VkIGludGVyZmFjZXMgYWx3YXlzIHVzZSBwcm9wZXJ0\neSBhY2Nlc3MuCiAgICAgICAgc2V0QWNjZXNzVHlwZShBY2Nlc3NDb2RlLlBS\nT1BFUlRZKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWFu\nYWdlZCBpbnRlcmZhY2UgaW1wbGVtZW50b3IgaWYgYW55LgogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0SW50ZXJmYWNlSW1wbCgpIHsKICAgICAg\nICByZXR1cm4gX2ltcGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIG1hbmFnZWQgaW50ZXJmYWNlIGltcGxlbWVudG9yIGNsYXNzLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmZhY2VJbXBsKENsYXNzPD8+IGlt\ncGwpIHsKICAgICAgICBfaW1wbCA9IGltcGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYWxsIGV4cGxpY2l0bHkgZGVjbGFyZWQgaW50ZXJmYWNl\ncyB0aGlzIGNsYXNzIGltcGxlbWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyBD\nbGFzczw/PltdIGdldERlY2xhcmVkSW50ZXJmYWNlcygpIHsKICAgICAgICBp\nZiAoX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1l\ndGFEYXRhUmVwb3NpdG9yeS5FTVBUWV9DTEFTU0VTOwogICAgICAgIHJldHVy\nbiAoQ2xhc3NbXSkgX2ludGVyZmFjZXMudG9BcnJheShuZXcgQ2xhc3NbX2lu\ndGVyZmFjZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHBs\naWNpdGx5IGRlY2xhcmUgdGhlIGdpdmVuIGludGVyZmFjZSBhbW9uZyB0aGUg\nb25lcyB0aGlzCiAgICAgKiBjbGFzcyBpbXBsZW1lbnRzLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZShDbGFzczw/PiBp\nZmFjZSkgewogICAgICAgIGlmIChpZmFjZSA9PSBudWxsIHx8ICFpZmFjZS5p\nc0ludGVyZmFjZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImRlY2xhcmUtbm9uLWludGVyZmFjZSIsCiAg\nICAgICAgICAgICAgICB0aGlzLCBpZmFjZSkpOwogICAgICAgIGlmIChfaW50\nZXJmYWNlcyA9PSBudWxsKQogICAgICAgICAgICBfaW50ZXJmYWNlcyA9IG5l\ndyBBcnJheUxpc3Q8Q2xhc3M8Pz4+KCk7CiAgICAgICAgX2ludGVyZmFjZXMu\nYWRkKGlmYWNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUg\nZ2l2ZW4gaW50ZXJmYWNlIGZyb20gdGhlIGRlY2xhcmVkIGxpc3QuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURlY2xhcmVkSW50ZXJmYWNl\nKENsYXNzPD8+IGlmYWNlKSB7CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1\ncm4gX2ludGVyZmFjZXMucmVtb3ZlKGlmYWNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsaWFzIHByb3BlcnRpZXMgZnJvbSB0aGUgZ2l2ZW4gaW50ZXJm\nYWNlIGR1cmluZyAgcXVlcmllcyB0bwogICAgICogdGhlIGxvY2FsIGZpZWxk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmZhY2VQcm9wZXJ0\neUFsaWFzKENsYXNzPD8+IGlmYWNlLCBTdHJpbmcgb3JpZywgCiAgICAgICAg\nU3RyaW5nIGxvY2FsKSB7CiAgICAgICAgc3luY2hyb25pemVkIChfaWZhY2VN\nYXApIHsKICAgICAgICAgICAgTWFwPFN0cmluZyxTdHJpbmc+IGZpZWxkcyA9\nIF9pZmFjZU1hcC5nZXQoaWZhY2UpOwogICAgICAgICAgICBpZiAoZmllbGRz\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5ldyBIYXNo\nTWFwPFN0cmluZyxTdHJpbmc+KCk7CiAgICAgICAgICAgICAgICBfaWZhY2VN\nYXAucHV0KGlmYWNlLCBmaWVsZHMpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChmaWVsZHMuY29udGFpbnNLZXkob3JpZykpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImR1\ncGxpY2F0ZS1pZmFjZS1hbGlhcyIsIAogICAgICAgICAgICAgICAgICAgIHRo\naXMsIG9yaWcsIGxvY2FsKSk7CiAgICAgICAgICAgIGZpZWxkcy5wdXQob3Jp\nZywgbG9jYWwpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBHZXQgbG9jYWwgZmllbGQgYWxpYXMgZm9yIHRoZSBnaXZlbiBpbnRlcmZh\nY2UgcHJvcGVydHkuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0SW50\nZXJmYWNlUHJvcGVydHlBbGlhcyhDbGFzczw/PiBpZmFjZSwgU3RyaW5nIG9y\naWcpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9pZmFjZU1hcCkgewogICAg\nICAgICAgICBNYXA8U3RyaW5nLFN0cmluZz4gZmllbGRzID0gX2lmYWNlTWFw\nLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1\ncm4gZmllbGRzLmdldChvcmlnKTsKICAgICAgICB9CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogUmV0dXJuIGFsbCBhbGlhc2VzIHByb3BlcnR5IG5hbWVk\nIGZvciB0aGUgZ2l2ZW4gaW50ZXJmYWNlLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nW10gZ2V0SW50ZXJmYWNlQWxpYXNlZFByb3BlcnRpZXMoQ2xhc3M8\nPz4gaWZhY2UpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9pZmFjZU1hcCkg\newogICAgICAgICAgICBNYXA8U3RyaW5nLFN0cmluZz4gZmllbGRzID0gX2lm\nYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBUWV9TVFJJTkdfQVJS\nQVk7CiAgICAgICAgICAgIHJldHVybiBmaWVsZHMua2V5U2V0KCkudG9BcnJh\neShuZXcgU3RyaW5nW2ZpZWxkcy5zaXplKCldKTsKICAgICAgICB9CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudW1iZXIgb2YgZmll\nbGRzIHRoYXQgdXNlIGltcGwgb3IgaW50ZXJtZWRpYXRlIGRhdGEsIGluCiAg\nICAgKiBvcmRlciB0byBjcmVhdGUgYSBjb21wYWN0ZWQgYXJyYXkgZm9yIHN0\nb3JhZ2Ugb2Ygc2FpZCBkYXRhLgogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndEV4dHJhRmllbGREYXRhTGVuZ3RoKCkgewogICAgICAgIGludFtdIHRhYmxl\nID0gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpOwogICAgICAgIGZvciAoaW50\nIGkgPSB0YWJsZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICAg\nICAgaWYgKHRhYmxlW2ldICE9IC0xKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRhYmxlW2ldICsgMTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgaW50ZXJtZWRpYXRlIGZpZWxkIGRhdGEg\naW5kZXggb2YgdGhlIGdpdmVuIGZpZWxkCiAgICAgKiBpbiB0aGUgY29tcGFj\ndGVkIGFycmF5LCBvciAtMSBpZiB0aGUgZmllbGQgZG9lcyBub3QgdXNlIGV4\ndHJhIGRhdGEuCiAgICAgKgogICAgICogQHNlZSAjZ2V0RXh0cmFGaWVsZERh\ndGFMZW5ndGgKICAgICAqLwogICAgcHVibGljIGludCBnZXRFeHRyYUZpZWxk\nRGF0YUluZGV4KGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBnZXRFeHRy\nYUZpZWxkRGF0YVRhYmxlKClbZmllbGRdOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlcyBhIHRhYmxlIG1hcHBpbmcgZWFjaCBmaWVsZCBpbmRleCB0\nbyBpdHMgZXh0cmEgZGF0YSBpbmRleC4KICAgICAqLwogICAgcHJpdmF0ZSBp\nbnRbXSBnZXRFeHRyYUZpZWxkRGF0YVRhYmxlKCkgewogICAgICAgIGlmIChf\nZmllbGREYXRhVGFibGUgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBpbnRb\nXSB0YWJsZSA9IG5ldyBpbnRbZm1kcy5sZW5ndGhdOwogICAgICAgICAgICBp\nbnQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1kc1tp\nXS51c2VzSW50ZXJtZWRpYXRlKCkKICAgICAgICAgICAgICAgICAgICB8fCBm\nbWRzW2ldLnVzZXNJbXBsRGF0YSgpICE9IEJvb2xlYW4uRkFMU0UpCiAgICAg\nICAgICAgICAgICAgICAgdGFibGVbaV0gPSBpZHgrKzsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0YWJsZVtpXSA9IC0xOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZERhdGFUYWJsZSA9IHRh\nYmxlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpZWxkRGF0YVRhYmxl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdp\ndmVuIG5hbWUgcmVwcmVzZW50cyBhIG1hbmFnZWQgb3Igc3RhdGljIGZpZWxk\nIG9mCiAgICAgKiB0aGlzIGNsYXNzLCBpbmNsdWRpbmcgc3VwZXJjbGFzcyBm\naWVsZHMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQWNjZXNzaWJs\nZUZpZWxkKFN0cmluZyBmaWVsZCkgewogICAgICAgIGlmIChnZXREZWNsYXJl\nZEZpZWxkKGZpZWxkKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICBpZiAoX3N0YXRpY0ZpZWxkcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIEZpZWxkW10gZmllbGRzID0gKEZpZWxkW10pIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0RGVjbGFyZWRGaWVsZHNBY3Rpb24oX3R5cGUpKTsgCiAgICAg\nICAgICAgIFNldDxTdHJpbmc+IG5hbWVzID0gbmV3IEhhc2hTZXQ8U3RyaW5n\nPigpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1N0\nYXRpYyhmaWVsZHNbaV0uZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAg\nICAgICAgIG5hbWVzLmFkZChmaWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgX3N0YXRpY0ZpZWxkcyA9IG5hbWVzOwogICAgICAgIH0KICAgICAg\nICBpZiAoX3N0YXRpY0ZpZWxkcy5jb250YWlucyhmaWVsZCkpCiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\naXNBY2Nlc3NpYmxlRmllbGQoZmllbGQpOwogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgZmllbGQgbWV0\nYWRhdGEsIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAqLwog\nICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRGaWVsZHMoKSB7CiAgICAg\nICAgaWYgKF9hbGxGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\nX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWxsRmllbGRzID0g\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBz\ndXBGaWVsZHMgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLgogICAgICAg\nICAgICAgICAgICAgIGdldEZpZWxkcygpOwoKICAgICAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBhbGxGaWVsZHMgPSBfcmVwb3MubmV3RmllbGRNZXRh\nRGF0YUFycmF5CiAgICAgICAgICAgICAgICAgICAgKGZpZWxkcy5sZW5ndGgg\nKyBzdXBGaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIFN5c3RlbS5h\ncnJheWNvcHkoc3VwRmllbGRzLCAwLCBhbGxGaWVsZHMsIDAsIHN1cEZpZWxk\ncy5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmVwbGFjZURlZmluZWRTdXBl\ncmNsYXNzRmllbGRzKGFsbEZpZWxkcywgc3VwRmllbGRzLmxlbmd0aCk7Cgog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0uc2V0\nSW5kZXgoc3VwRmllbGRzLmxlbmd0aCArIGkpOwogICAgICAgICAgICAgICAg\nICAgIGFsbEZpZWxkc1tzdXBGaWVsZHMubGVuZ3RoICsgaV0gPSBmaWVsZHNb\naV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfYWxsRmll\nbGRzID0gYWxsRmllbGRzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfYWxsRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVwbGFjZSBzdXBlcmNsYXNzIGZpZWxkcyB0aGF0IHdlIGRlZmluZSB3aXRo\nIG91ciB2ZXJzaW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVwbGFj\nZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKEZpZWxkTWV0YURhdGFbXSBmaWVs\nZHMsCiAgICAgICAgaW50IGxlbikgewogICAgICAgIGlmIChfc3VwRmllbGRN\nYXAgPT0gbnVsbCB8fCAhX2RlZlN1cEZpZWxkcykKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAvLyBkb24ndCBhc3N1bWUgZmllbGRzIGFyZSBpbiBv\ncmRlcjsgdGhpcyBtZXRob2QgaXMgdXNlZCBmb3IKICAgICAgICAvLyBsaXN0\naW5nIG9yZGVyIGFzIHdlbGwKICAgICAgICBGaWVsZE1ldGFEYXRhIHN1cEZp\nZWxkOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsK\nICAgICAgICAgICAgc3VwRmllbGQgPSAoRmllbGRNZXRhRGF0YSkgX3N1cEZp\nZWxkTWFwLmdldChmaWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\naWYgKHN1cEZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpZWxk\nc1tpXSA9IHN1cEZpZWxkOwogICAgICAgICAgICAgICAgc3VwRmllbGQuc2V0\nSW5kZXgoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN1cGVyY2xhc3MgY29weSBvZiB0aGUg\nZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZE1ldGFE\nYXRhIGdldFN1cGVyY2xhc3NGaWVsZChGaWVsZE1ldGFEYXRhIHN1cEZpZWxk\nKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzbSA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbSA9\nPSBudWxsID8gbnVsbCA6IHNtLmdldEZpZWxkKHN1cEZpZWxkLmdldE5hbWUo\nKSk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsIAogICAgICAgIHx8IGZtZC5n\nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJ1bm1hbmFnZWQtc3VwLWZpZWxkIiwKICAgICAgICAgICAg\nICAgIHN1cEZpZWxkLCB0aGlzKSk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBvbmx5IHRoZSBmaWVsZHMgZm9y\nIHRoaXMgY2xhc3MsIHdpdGhvdXQgc3VwZXJjbGFzcyBmaWVsZHMuCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVjbGFyZWRGaWVs\nZHMoKSB7CiAgICAgICAgaWYgKF9maWVsZHMgPT0gbnVsbCkgewogICAgICAg\nICAgICBMaXN0PEZpZWxkTWV0YURhdGE+IGZpZWxkcyA9IAogICAgICAgICAg\nICAJbmV3IEFycmF5TGlzdDxGaWVsZE1ldGFEYXRhPihfZmllbGRNYXAuc2l6\nZSgpKTsKICAgICAgICAgICAgOwogICAgICAgICAgICBmb3IgKEZpZWxkTWV0\nYURhdGEgZm1kIDogX2ZpZWxkTWFwLnZhbHVlcygpKSB7CiAgICAgICAgICAg\nICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRh\nLk1BTkFHRV9OT05FKSB7CiAgICAgICAgICAgICAgICAgICAgZm1kLnNldERl\nY2xhcmVkSW5kZXgoZmllbGRzLnNpemUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgZm1kLnNldEluZGV4KGZtZC5nZXREZWNsYXJlZEluZGV4KCkpOwogICAg\nICAgICAgICAgICAgICAgIGZpZWxkcy5hZGQoZm1kKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfZmllbGRzID0gZmll\nbGRzLnRvQXJyYXkKICAgICAgICAgICAgCShfcmVwb3MubmV3RmllbGRNZXRh\nRGF0YUFycmF5KGZpZWxkcy5zaXplKCkpKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9maWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ncHJpbWFyeSBrZXkgZmllbGRzLCBvciBlbXB0eSBhcnJheSBpZiBub25lLiBU\naGUgb3JkZXIKICAgICAqIGluIHdoaWNoIHRoZSBrZXlzIGFyZSByZXR1cm5l\nZCB3aWxsIGJlIHRoZSBvcmRlciBpbiB3aGljaAogICAgICogdGhlIGZpZWxk\ncyBhcmUgZGVjbGFyZWQsIHN0YXJ0aW5nIGF0IHRoZSBsZWFzdC1kZXJpdmVk\nIHN1cGVyY2xhc3MKICAgICAqIGFuZCBlbmRpbmcgd2l0aCB0aGUgcHJpbWFy\neSBrZXkgZmllbGRzIG9mIHRoZSBtb3N0LWRlcml2ZWQgc3ViY2xhc3MuCiAg\nICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0UHJpbWFyeUtl\neUZpZWxkcygpIHsKICAgICAgICAvLyBjaGVjayBmb3IgcHJpbWFyeSBrZXkg\nZmllbGRzIGV2ZW4gaWYgbm90IHNldCB0byBJRF9BUFBMSUNBVElPTiBzbyAK\nICAgICAgICAvLyB0aGF0IEFwcGxpY2F0aW9uIElkIHRvb2wgc2VlcyB0aGVt\nIGV2ZW4gd2hlbiB1c2VyIGRvZXNuJ3QgZGVjbGFyZSAKICAgIAkvLyBBcHBs\naWNhdGlvbiBpZGVudGl0eQogICAgICAgIGlmIChfYWxsUEtGaWVsZHMgPT0g\nbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0g\nZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGludCBudW0gPSAwOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNQcmltYXJ5S2V5KCkp\nCiAgICAgICAgICAgICAgICAgICAgbnVtKys7CgogICAgICAgICAgICBpZiAo\nbnVtID09IDApCiAgICAgICAgICAgICAgICBfYWxsUEtGaWVsZHMgPSBfcmVw\nb3MuRU1QVFlfRklFTERTOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBfcmVwb3MubmV3RmllbGRN\nZXRhRGF0YUFycmF5KG51bSk7CiAgICAgICAgICAgICAgICBudW0gPSAwOwog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ld\nLmlzUHJpbWFyeUtleSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZp\nZWxkc1tpXS5zZXRQcmltYXJ5S2V5SW5kZXgobnVtKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgcGtzW251bV0gPSBmaWVsZHNbaV07CiAgICAgICAgICAg\nICAgICAgICAgICAgIG51bSsrOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9hbGxQS0ZpZWxkcyA9\nIHBrczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2FsbFBLRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBsaXN0IG9mIGZpZWxkcyBpbiB0aGUgZGVmYXVsdCBmZXRjaCBncm91cCwK\nICAgICAqIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcywgb3IgYW4gZW1w\ndHkgYXJyYXkgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0\nYURhdGFbXSBnZXREZWZhdWx0RmV0Y2hHcm91cEZpZWxkcygpIHsKICAgICAg\nICBpZiAoX2FsbERGR0ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgaW50IG51bSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZp\nZWxkc1tpXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAg\nICAgICAgICBudW0rKzsKCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBk\nZmdzID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheShudW0pOwogICAg\nICAgICAgICBudW0gPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChm\naWVsZHNbaV0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAg\nICAgICAgICAgZGZnc1tudW0rK10gPSBmaWVsZHNbaV07CiAgICAgICAgICAg\nIF9hbGxERkdGaWVsZHMgPSBkZmdzOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2FsbERGR0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgdmVyc2lvbiBmaWVsZCBmb3IgdGhpcyBjbGFzcywgaWYgYW55Lgog\nICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRWZXJzaW9uRmll\nbGQoKSB7CiAgICAgICAgaWYgKF92ZXJzaW9uSWR4ID09IEludGVnZXIuTUlO\nX1ZBTFVFKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMg\nPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IGlkeCA9IC0xOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc1ZlcnNpb24o\nKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpZHggIT0gLTEpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJtdWx0\nLXZlcnMtZmllbGRzIiwgdGhpcywgZmllbGRzW2lkeF0sIGZpZWxkc1tpXSkp\nOwogICAgICAgICAgICAgICAgICAgIGlkeCA9IGk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3ZlcnNpb25JZHggPSBp\nZHg7CiAgICAgICAgfQogICAgICAgIGlmIChfdmVyc2lvbklkeCA9PSAtMSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGdldEZp\nZWxkcygpW192ZXJzaW9uSWR4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBwZXJzaXN0ZW50IG9yIHRyYW5z\nYWN0aW9uYWwgZmllbGQgd2l0aAogICAgICogdGhlIGdpdmVuIGFic29sdXRl\nIGluZGV4LgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0\nYWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAgKi8KICAgIHB1Ymxp\nYyBGaWVsZE1ldGFEYXRhIGdldEZpZWxkKGludCBpbmRleCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAg\nICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGZpZWxkcy5sZW5ndGgpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBmaWVsZHNb\naW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRh\nZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVs\nZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gcmVsYXRpdmUgaW5kZXguCiAgICAg\nKgogICAgICogQHJldHVybiB0aGUgZmllbGQncyBtZXRhZGF0YSwgb3IgbnVs\nbCBpZiBub3QgZm91bmQKICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURh\ndGEgZ2V0RGVjbGFyZWRGaWVsZChpbnQgaW5kZXgpIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAg\nICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGZpZWxkcy5sZW5ndGgp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBmaWVs\nZHNbaW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBt\nZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25hbCBm\naWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5v\ndCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRG\naWVsZChTdHJpbmcgbmFtZSkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gZ2V0RGVjbGFyZWRGaWVsZChuYW1lKTsKICAgICAgICBpZiAoZm1kICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBmbWQ7CiAgICAgICAgaWYgKF9z\ndXBGaWVsZE1hcCAhPSBudWxsICYmIF9kZWZTdXBGaWVsZHMpIHsKICAgICAg\nICAgICAgZm1kID0gKEZpZWxkTWV0YURhdGEpIF9zdXBGaWVsZE1hcC5nZXQo\nbmFtZSk7CiAgICAgICAgICAgIGlmIChmbWQgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBmbWQ7CiAgICAgICAgfQogICAgICAgIGlmIChfc3Vw\nZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuZ2V0RmllbGQobmFtZSk7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRh\nIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdp\ndGgKICAgICAqIHRoZSBnaXZlbiBuYW1lLCB3aXRob3V0IGluY2x1ZGluZyBz\ndXBlcmNsYXNzIGZpZWxkcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBm\naWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAgICov\nCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXREZWNsYXJlZEZpZWxkKFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZCA9IChG\naWVsZE1ldGFEYXRhKSBfZmllbGRNYXAuZ2V0KG5hbWUpOwogICAgICAgIGlm\nIChmaWVsZCA9PSBudWxsIHx8IGZpZWxkLmdldE1hbmFnZW1lbnQoKSA9PSBG\naWVsZE1ldGFEYXRhLk1BTkFHRV9OT05FKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICByZXR1cm4gZmllbGQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYW55IGZpZWxkcyB0aGF0IHdlcmUgYWRkZWQgYXMgbm9u\nLW1hbmFnZWQuCiAgICAgKiBBbGwgb3RoZXIgbWV0aG9kcyB0byBnZXQgZmll\nbGRzIHJldHVybiBvbmx5IHRob3NlIHRoYXQgYXJlIG1hbmFnZWQuCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVjbGFyZWRVbm1h\nbmFnZWRGaWVsZHMoKSB7CiAgICAgICAgaWYgKF91bm1nZEZpZWxkcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIExpc3Q8RmllbGRNZXRhRGF0YT4gdW5tYW5h\nZ2VkID0gbmV3IEFycmF5TGlzdDxGaWVsZE1ldGFEYXRhPigzKTsKICAgICAg\nICAgICAgOwogICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZmllbGQg\nOiBfZmllbGRNYXAudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAgIGlmIChm\naWVsZC5nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0Vf\nTk9ORSkKICAgICAgICAgICAgICAgICAgICB1bm1hbmFnZWQuYWRkKGZpZWxk\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfdW5tZ2RGaWVsZHMgPSB1\nbm1hbmFnZWQudG9BcnJheQogICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdG\naWVsZE1ldGFEYXRhQXJyYXkodW5tYW5hZ2VkLnNpemUoKSkpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gX3VubWdkRmllbGRzOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIGEgbmV3IGZpZWxkIG1ldGFkYXRhIHRvIHRoaXMgY2xh\nc3MuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGFkZERlY2xh\ncmVkRmllbGQoU3RyaW5nIG5hbWUsIENsYXNzPD8+IHR5cGUpIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRh\nKG5hbWUsIHR5cGUsIHRoaXMpOwogICAgICAgIGNsZWFyRmllbGRDYWNoZSgp\nOwogICAgICAgIF9maWVsZE1hcC5wdXQobmFtZSwgZm1kKTsKICAgICAgICBy\nZXR1cm4gZm1kOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBn\naXZlbiBmaWVsZCBmcm9tIG1hbmFnZW1lbnQuCiAgICAgKgogICAgICogQHJl\ndHVybiB0cnVlIGlmIHRoZSBmaWVsZCB3YXMgcmVtb3ZlZCwgZmFsc2Ugb3Ro\nZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURlY2xh\ncmVkRmllbGQoRmllbGRNZXRhRGF0YSBmaWVsZCkgewogICAgICAgIGlmIChm\naWVsZCAhPSBudWxsICYmIF9maWVsZE1hcC5yZW1vdmUoZmllbGQuZ2V0TmFt\nZSgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGNsZWFyRmllbGRDYWNoZSgp\nOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBkZWZpbmVkIHN1cGVyY2xhc3MgZmllbGQgd2l0aCB0aGUgZ2l2ZW4gbmFt\nZSwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YSBnZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKFN0cmluZyBuYW1l\nKSB7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKEZpZWxkTWV0YURh\ndGEpIF9zdXBGaWVsZE1hcC5nZXQobmFtZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgYSBuZXcgZGVmaW5lZCBzdXBlcmNsYXNzIGZpZWxkIG1ldGFk\nYXRhIHRvIHRoaXMgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1l\ndGFEYXRhIGFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3RyaW5nIG5hbWUs\nIENsYXNzPD8+IHR5cGUsCiAgICAgICAgQ2xhc3M8Pz4gc3VwKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0\nYShuYW1lLCB0eXBlLCB0aGlzKTsKICAgICAgICBmbWQuc2V0RGVjbGFyaW5n\nVHlwZShzdXApOwogICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAg\nICAgIF9kZWZTdXBGaWVsZHMgPSBmYWxzZTsKICAgICAgICBpZiAoX3N1cEZp\nZWxkTWFwID09IG51bGwpCiAgICAgICAgICAgIF9zdXBGaWVsZE1hcCA9IG5l\ndyBIYXNoTWFwPFN0cmluZyxGaWVsZE1ldGFEYXRhPigpOwogICAgICAgIF9z\ndXBGaWVsZE1hcC5wdXQobmFtZSwgZm1kKTsKICAgICAgICByZXR1cm4gZm1k\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBmaWVs\nZCBmcm9tIG1hbmFnZW1lbnQuCiAgICAgKgogICAgICogQHJldHVybiB0cnVl\nIGlmIHRoZSBmaWVsZCB3YXMgcmVtb3ZlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURlZmluZWRTdXBlcmNs\nYXNzRmllbGQoRmllbGRNZXRhRGF0YSBmaWVsZCkgewogICAgICAgIGlmIChm\naWVsZCAhPSBudWxsICYmIF9zdXBGaWVsZE1hcCAhPSBudWxsCiAgICAgICAg\nICAgICYmIF9zdXBGaWVsZE1hcC5yZW1vdmUoZmllbGQuZ2V0TmFtZSgpKSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwog\nICAgICAgICAgICBfZGVmU3VwRmllbGRzID0gZmFsc2U7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbmNvcnBvcmF0ZSBzdXBlcmNsYXNz\nIGZpZWxkcyByZWRlZmluZWQgaW4gdGhpcyBzdWJjbGFzcyBpbnRvIHRoaXMK\nICAgICAqIG1ldGFkYXRhLiBUaGlzIG1ldGhvZCBpcyBnZW5lcmFsbHkgY2Fs\nbGVkIGFmdGVyIG1ldGFkYXRhIGlzIHJlc29sdmVkCiAgICAgKiBhbmQgbWFw\ncGluZyBpbmZvcm1hdGlvbiBpcyBsb2FkZWQsIGJ1dCBiZWZvcmUgbWFwcGlu\nZyByZXNvbHZlLgogICAgICoKICAgICAqIEBwYXJhbSBmb3JjZSB3aGV0aGVy\nIHRvIGZvcmNlIHJlLW1hcHBpbmcgb2YgZXZlbiBtYXBwZWQgc3VwZXJjbGFz\ncyBmaWVsZHMKICAgICAqLwogICAgcHVibGljIHZvaWQgZGVmaW5lU3VwZXJj\nbGFzc0ZpZWxkcyhib29sZWFuIGZvcmNlKSB7CiAgICAgICAgaWYgKF9kZWZT\ndXBGaWVsZHMpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgIGlmIChpc01hcHBlZCgpICYmIHN1cCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIC8vIHJlZGVmaW5lIGFsbCB1bm1hcHBlZCBzdXBlcmNsYXNzIGZpZWxk\ncwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gc3VwcyA9IHN1cC5nZXRG\naWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdXBz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZvcmNlIHx8\nICFzdXBzW2ldLmdldERlZmluaW5nTWV0YURhdGEoKS5pc01hcHBlZCgpKQog\nICAgICAgICAgICAgICAgICAgICYmIGdldERlZmluZWRTdXBlcmNsYXNzRmll\nbGQoc3Vwc1tpXS5nZXROYW1lKCkpID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBhZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBzdXBzW2ldLmdldERl\nY2xhcmVkVHlwZSgpLCBzdXBzW2ldLmdldERlY2xhcmluZ1R5cGUoKSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmVzb2x2ZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKCk7CgogICAgICAg\nIC8vIHRoaXMgZW5zdXJlcyB0aGF0IGFsbCBmaWVsZCBpbmRleGVzIGdldCBz\nZXQgd2hlbiBmaWVsZHMgYXJlIGNhY2hlZC4KICAgICAgICAvLyBJIGRvbid0\nIGxpa2UgZG9pbmcgdGhpcyB0d2ljZSAoaXQncyBhbHNvIGRvbmUgaW4gcmVz\nb2x2ZU1ldGEpLCBidXQKICAgICAgICAvLyB3ZSBoYXZlIHRvIHJlLWNhY2hl\nIGluIGNhc2UgdGhpcyBjbGFzcyBvciBhbnkgc3VwZXJjbGFzcyByZXBsYWNl\nZAogICAgICAgIC8vIHNvbWUgZmllbGRzIHdpdGggcmVkZWZpbmVkIHZlcnNp\nb25zLCBhbmQgSSBkb24ndCB3YW50IG91dHNpZGUgY29kZQogICAgICAgIC8v\nIHRvIGhhdmUgdG8gY2FsbCB0aGlzIG1ldGhvZCBhZnRlciByZXNvbHZlIGp1\nc3QgdG8gZ2V0IGZpZWxkIGluZGV4ZXMsCiAgICAgICAgLy8gZXRjIHNldCBj\nb3JyZWN0bHkKICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAg\nICBjYWNoZUZpZWxkcygpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2\nZSBzdXBlcmNsYXNzIGZpZWxkcyB3ZSd2ZSByZWRlZmluZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NGaWVs\nZHMoKSB7CiAgICAgICAgX2RlZlN1cEZpZWxkcyA9IHRydWU7CiAgICAgICAg\naWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIEZpZWxkTWV0YURhdGEgc3VwOwogICAgICAgIGZvciAoRmll\nbGRNZXRhRGF0YSBmbWQgOiBfc3VwRmllbGRNYXAudmFsdWVzKCkpIHsKICAg\nICAgICAgICAgc3VwID0gZ2V0U3VwZXJjbGFzc0ZpZWxkKGZtZCk7CgogICAg\nICAgICAgICAvLyBKUEEgbWV0YWRhdGEgZG9lc24ndCBxdWFsaWZ5IHN1cGVy\nY2xhc3MgZmllbGQgbmFtZXMsIHNvIHdlCiAgICAgICAgICAgIC8vIG1pZ2h0\nIG5vdCBrbm93IHRoZSBkZWNsYXJpbmcgdHlwZSB1bnRpbCBub3cKICAgICAg\nICAgICAgaWYgKGZtZC5nZXREZWNsYXJpbmdUeXBlKCkgPT0gT2JqZWN0LmNs\nYXNzKSB7CiAgICAgICAgICAgICAgICBmbWQuc2V0RGVjbGFyaW5nVHlwZShz\ndXAuZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgICAgIGZtZC5i\nYWNraW5nTWVtYmVyKGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3Rv\ncnkoKS4KICAgICAgICAgICAgICAgICAgICBnZXREZWZhdWx0cygpLmdldEJh\nY2tpbmdNZW1iZXIoZm1kKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZm1kLmNvcHkoc3VwKTsKICAgICAgICAgICAgZm1kLnJlc29sdmUoTU9ERV9N\nRVRBKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIGFuIGFycmF5IG9mIGFsbCB0aGUgZmllbGRzIGRlZmluZWQgYnkgdGhpcyBj\nbGFzcy4KICAgICAqIFRoaXMgaW5jbHVkZXMgbWFwcGVkIGRlY2xhcmVkIGZp\nZWxkcyBhbmQgYW55IGNvbmNyZXRlIG1hcHBpbmcgb2YKICAgICAqIHVubWFw\ncGVkIHN1cGVyY2xhc3MgZmllbGRzIHBlcmZvcm1lZCBieSB0aGlzIGNsYXNz\nLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlZmlu\nZWRGaWVsZHMoKSB7CiAgICAgICAgaWYgKF9kZWZpbmVkRmllbGRzID09IG51\nbGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdl\ndEZpZWxkcygpOwogICAgICAgICAgICBMaXN0PEZpZWxkTWV0YURhdGE+IGRl\nZmluZWQgPSAKICAgICAgICAgICAgCW5ldyBBcnJheUxpc3Q8RmllbGRNZXRh\nRGF0YT4oZmllbGRzLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoRmllbGRN\nZXRhRGF0YSBmbWQgOiBmaWVsZHMpIHsKICAgICAgICAgICAgICAgIGlmIChm\nbWQuaXNNYXBwZWQoKQogICAgICAgICAgICAgICAgICAgICYmIGZtZC5nZXRE\nZWZpbmluZ01ldGFEYXRhKCkgPT0gdGhpcykKICAgICAgICAgICAgICAgICAg\nICBkZWZpbmVkLmFkZChmbWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIF9kZWZpbmVkRmllbGRzID0gKEZpZWxkTWV0YURhdGFbXSkgZGVmaW5lZC50\nb0FycmF5CiAgICAgICAgICAgICAgICAoX3JlcG9zLm5ld0ZpZWxkTWV0YURh\ndGFBcnJheShkZWZpbmVkLnNpemUoKSkpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX2RlZmluZWRGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIGFsbCBmaWVsZHMgaW4gdGhlIG9yZGVyIHRoZXkgYXJlIGxpc3Rl\nZCBpbiB0aGUgbWV0YWRhdGEKICAgICAqIGZpbGUuIFVubGlzdGVkIGZpZWxk\ncyBhcmUgcGxhY2VkIGFmdGVyIGxpc3RlZCBvbmVzLgogICAgICovCiAgICBw\ndWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldEZpZWxkc0luTGlzdGluZ09yZGVy\nKCkgewogICAgICAgIGlmIChfYWxsTGlzdGluZ0ZpZWxkcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIGNvbWJpbmUgZGVjbGFyZWQgYW5kIHVubWFuYWdl\nZCBmaWVsZHMgaW50byBsaXN0aW5nIG9yZGVyIGFycmF5CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBkZWMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gdW5tZ2QgPSBnZXREZWNsYXJl\nZFVubWFuYWdlZEZpZWxkcygpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZGVjTGlzdGluZyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkK\nICAgICAgICAgICAgICAgIChkZWMubGVuZ3RoICsgdW5tZ2QubGVuZ3RoKTsK\nICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShkZWMsIDAsIGRlY0xpc3Rp\nbmcsIDAsIGRlYy5sZW5ndGgpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXlj\nb3B5KHVubWdkLCAwLCBkZWNMaXN0aW5nLCBkZWMubGVuZ3RoLCB1bm1nZC5s\nZW5ndGgpOwogICAgICAgICAgICBBcnJheXMuc29ydChkZWNMaXN0aW5nLCBM\naXN0aW5nT3JkZXJDb21wYXJhdG9yLmdldEluc3RhbmNlKCkpOwoKICAgICAg\nICAgICAgaWYgKF9zdXBlciA9PSBudWxsKQogICAgICAgICAgICAgICAgX2Fs\nbExpc3RpbmdGaWVsZHMgPSBkZWNMaXN0aW5nOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIC8vIHBsYWNlIHN1cGVyY2xhc3MgZmllbGRz\nIGluIGxpc3Rpbmcgb3JkZXIgYmVmb3JlIG91cgogICAgICAgICAgICAgICAg\nLy8gbGlzdGluZy1vcmRlciBkZWNsYXJlZCBmaWVsZHMKICAgICAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpLgogICAgICAgICAgICAgICAgICAgIGdldEZpZWxkc0luTGlzdGlu\nZ09yZGVyKCk7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gbGlz\ndGluZyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkKICAgICAgICAg\nICAgICAgICAgICAoc3VwLmxlbmd0aCArIGRlY0xpc3RpbmcubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoc3VwLCAwLCBsaXN0\naW5nLCAwLCBzdXAubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHJlcGxhY2VE\nZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcyhsaXN0aW5nLCBzdXAubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoZGVjTGlzdGluZywg\nMCwgbGlzdGluZywgc3VwLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICBk\nZWNMaXN0aW5nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBfYWxsTGlzdGlu\nZ0ZpZWxkcyA9IGxpc3Rpbmc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9hbGxMaXN0aW5nRmllbGRzOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyBhbGwgZmllbGRzIGRlZmluZWQgYnkgdGhpcyBj\nbGFzcyBpbiB0aGUgb3JkZXIgdGhleSBhcmUgbGlzdGVkCiAgICAgKiBpbiB0\naGUgbWV0YWRhdGEgZmlsZS4gVW5saXN0ZWQgZmllbGRzIGFyZSBwbGFjZWQg\nYWZ0ZXIgbGlzdGVkIG9uZXMuCiAgICAgKiBUaGlzIGFycmF5IGluY2x1ZGVz\nIGRlY2xhcmVkIHRyYW5zYWN0aW9uYWwgYW5kIHVubWFuYWdlZCBmaWVsZHMu\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVmaW5l\nZEZpZWxkc0luTGlzdGluZ09yZGVyKCkgewogICAgICAgIGlmIChfbGlzdGlu\nZ0ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgTGlzdDxGaWVs\nZE1ldGFEYXRhPiBkZWZpbmVkID0gCiAgICAgICAgICAgIAluZXcgQXJyYXlM\naXN0PEZpZWxkTWV0YURhdGE+KGZpZWxkcy5sZW5ndGgpOwogICAgICAgICAg\nICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogZmllbGRzKQogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCkgPT0gdGhpcykK\nICAgICAgICAgICAgICAgICAgICBkZWZpbmVkLmFkZChmbWQpOwogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gdW5tZ2QgPSBnZXREZWNsYXJlZFVubWFu\nYWdlZEZpZWxkcygpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gbGlz\ndGluZyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkKICAgICAgICAg\nICAgICAgIChkZWZpbmVkLnNpemUoKSArIHVubWdkLmxlbmd0aCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGVmaW5lZC5zaXplKCk7IGkr\nKykKICAgICAgICAgICAgICAgIGxpc3RpbmdbaV0gPSAoRmllbGRNZXRhRGF0\nYSkgZGVmaW5lZC5nZXQoaSk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNv\ncHkodW5tZ2QsIDAsIGxpc3RpbmcsIGRlZmluZWQuc2l6ZSgpLCB1bm1nZC5s\nZW5ndGgpOwogICAgICAgICAgICBBcnJheXMuc29ydChsaXN0aW5nLCBMaXN0\naW5nT3JkZXJDb21wYXJhdG9yLmdldEluc3RhbmNlKCkpOwogICAgICAgICAg\nICBfbGlzdGluZ0ZpZWxkcyA9IGxpc3Rpbmc7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBfbGlzdGluZ0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBuYW1lIG9mIHRoZSBkYXRhY2FjaGUgdG8gdXNlIGZvciB0aGlzIGNs\nYXNzLiBJZiB0aGlzIGNsYXNzIGlzIG5vdAogICAgICogZWxpZ2libGUgZm9y\nIGNhY2hpbmcgYmFzZWQgaXRzIGFubm90YXRpb24gb3IgdGhlIGNhY2hlIGNv\nbmZpZ3VyYXRpb24KICAgICAqIG51bGwgd2lsbCBiZSByZXR1cm5lZC4KICAg\nICAqIAogICAgICogQHJldHVybiBUaGUgY2FjaGUgbmFtZSwgb3IgbnVsbCBp\nZiB0aGlzIHR5cGUgc2hvdWxkIG5vdCBiZSBjYWNoZWQuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0RGF0YUNhY2hlTmFtZSgpIHsKICAgICAgICBp\nZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9jYWNoZU5hbWUpKSB7CiAgICAg\nICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCAmJiBTdHJpbmdVdGlscy5pc05v\ndEVtcHR5KGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RGF0YUNhY2hl\nTmFtZSgpKSkgewogICAgICAgICAgICAgICAgX2NhY2hlTmFtZSA9IGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX2NhY2hlTmFtZSA9\nIERhdGFDYWNoZS5OQU1FX0RFRkFVTFQ7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKCFpc0NhY2hlYWJsZShfY2FjaGVOYW1lKSkgewogICAgICAg\nICAgICAgICAgX2NhY2hlTmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIF9jYWNoZU5hbWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGNhY2hlIG5hbWUgZm9yIHRoaXMgY2xhc3Mu\nIFNldCB0byBudWxsIHRvIGRpc2FibGUgY2FjaGluZy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0RGF0YUNhY2hlTmFtZShTdHJpbmcgbmFtZSkgewog\nICAgICAgIF9jYWNoZU5hbWUgPSBuYW1lOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIGNhY2hlIHRpbWVvdXQgZm9yIHRoaXMgY2xhc3MuIC0xIGluZGlj\nYXRlcyBubyB0aW1lb3V0LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldERh\ndGFDYWNoZVRpbWVvdXQoKSB7CiAgICAgICAgaWYgKF9jYWNoZVRpbWVvdXQg\nPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAgICAgICAgICAgaWYgKF9zdXBl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBfY2FjaGVUaW1lb3V0ID0gX3JlcG9zLmdldENvbmZpZ3Vy\nYXRpb24oKS4KICAgICAgICAgICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1l\nb3V0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY2FjaGVUaW1lb3V0\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGNhY2hlIHRpbWVvdXQgZm9y\nIHRoaXMgY2xhc3MuIC0xIGluZGljYXRlcyBubyB0aW1lb3V0LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVUaW1lb3V0KGludCB0aW1l\nb3V0KSB7CiAgICAgICAgX2NhY2hlVGltZW91dCA9IHRpbWVvdXQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGEgY2FjaGUgZm9yIHRo\naXMgY2xhc3MsIG9yIG51bGwgaWYgaXQgaXMgbm90IGNhY2hhYmxlLgogICAg\nICovCiAgICBwdWJsaWMgRGF0YUNhY2hlIGdldERhdGFDYWNoZSgpIHsKICAg\nICAgICBTdHJpbmcgbmFtZSA9IGdldERhdGFDYWNoZU5hbWUoKTsKICAgICAg\nICBpZiAobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3JlcG9zLmdldENvbmZpZ3Vy\nYXRpb24oKS5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS5nZXREYXRh\nQ2FjaGUobmFtZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIGluc3RhbmNlcyBhcmUgZGV0YWNoYWJsZS4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gaXNEZXRhY2hhYmxlKCkgewogICAgICAgIGlmIChfZGV0\nYWNoYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfc3VwZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hhYmxlID0gKGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAg\nICAgICAgICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZGV0YWNoYWJsZSA9IEJv\nb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZGV0YWNo\nYWJsZS5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgaW5zdGFuY2VzIGFyZSBkZXRhY2hhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXREZXRhY2hhYmxlKGJvb2xlYW4gZGV0YWNoYWJsZSkg\newogICAgICAgIF9kZXRhY2hhYmxlID0gKGRldGFjaGFibGUpID8gQm9vbGVh\nbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwg\naWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXREZXRhY2hl\nZFN0YXRlKCkgewogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMo\nX2RldGFjaFN0YXRlKSkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1\ncCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlm\nIChzdXAgIT0gbnVsbCAmJiBzdXAuaXNEZXRhY2hhYmxlKCkgPT0gaXNEZXRh\nY2hhYmxlKCkpCiAgICAgICAgICAgICAgICBfZGV0YWNoU3RhdGUgPSBzdXAu\nZ2V0RGV0YWNoZWRTdGF0ZSgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIEJvb2xlYW4gdXNlID0gdXNlc0RldGFjaGVkU3RhdGUoU1lO\nVEhFVElDLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9kZXRhY2hTdGF0ZSA9\nIChCb29sZWFuLkZBTFNFLmVxdWFscyh1c2UpKSA/IG51bGwgOiBTWU5USEVU\nSUM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9k\nZXRhY2hTdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9m\nIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwgaWYgbm9uZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoZWRTdGF0ZShTdHJpbmcg\nZmllbGQpIHsKICAgICAgICBfZGV0YWNoU3RhdGUgPSBmaWVsZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGV0YWNoIHN0YXRlIGZpZWxk\nLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZCBn\nZXREZXRhY2hlZFN0YXRlRmllbGQoKSB7CiAgICAgICAgLy8gbm8gY2FjaGlu\nZzsgb25seSB1c2VkIGF0IGVuaGFuY2VtZW50CiAgICAgICAgU3RyaW5nIGZp\nZWxkTmFtZSA9IGdldERldGFjaGVkU3RhdGUoKTsKICAgICAgICBpZiAoZmll\nbGROYW1lID09IG51bGwgfHwgU1lOVEhFVElDLmVxdWFscyhmaWVsZE5hbWUp\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRmllbGQgZiA9\nIFJlZmxlY3Rpb24uZmluZEZpZWxkKF90eXBlLCBmaWVsZE5hbWUsIGZhbHNl\nKTsKICAgICAgICBpZiAoZiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJuby1kZXRh\nY2gtc3RhdGUiLCBmaWVsZE5hbWUsIF90eXBlKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIGFuIGluc3RhbmNlIG9mIHRoaXMgdHlwZSBoYXMg\nZGV0YWNoZWQgc3RhdGUuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlm\nIGEgZGV0YWNoZWQgaW5zdGFuY2UgbXVzdCBoYXZlIGRldGFjaGVkIHN0YXRl\nLCBmYWxzZQogICAgICogaWYgaXQgZG9lcyBub3QsIGFuZCBudWxsIGlmIGl0\nIG1heSB1c2UgYQogICAgICogbWFudWFsbHktY29uc3RydWN0ZWQgaW5zdGFu\nY2Ugd2l0aG91dCBkZXRhY2hlZCBzdGF0ZQogICAgICovCiAgICBwdWJsaWMg\nQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZSgpIHsKICAgICAgICAvLyBubyBu\nZWVkIHRvIGxldCBjb25mIGRpc2FsbG93IGJlY2F1c2UgaXQncyB0YWtlbiBp\nbnRvIGFjY291bnQgaW4KICAgICAgICAvLyBnZXREZXRhY2hlZFN0YXRlKCkg\nY2FsbAogICAgICAgIHJldHVybiB1c2VzRGV0YWNoZWRTdGF0ZShnZXREZXRh\nY2hlZFN0YXRlKCksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgYW4gaW5zdGFuY2Ugb2YgdGhpcyB0eXBlIGhhcyBkZXRhY2hlZCBz\ndGF0ZSwgYXNzdW1pbmcgdGhlIGdpdmVuCiAgICAgKiBkZXRhY2hlZCBzdGF0\nZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYSBkZXRh\nY2hlZCBpbnN0YW5jZSBtdXN0IGhhdmUgZGV0YWNoZWQgc3RhdGUsIGZhbHNl\nCiAgICAgKiBpZiBpdCBkb2VzIG5vdCwgYW5kIG51bGwgaWYgaXQgbWF5IHVz\nZSBhCiAgICAgKiBtYW51YWxseS1jb25zdHJ1Y3RlZCBpbnN0YW5jZSB3aXRo\nb3V0IGRldGFjaGVkIHN0YXRlCiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVh\nbiB1c2VzRGV0YWNoZWRTdGF0ZShTdHJpbmcgZGV0YWNoZWRGaWVsZCwKICAg\nICAgICBib29sZWFuIGNvbmZEaXNhbGxvd3MpIHsKICAgICAgICBpZiAoIWlz\nRGV0YWNoYWJsZSgpKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxT\nRTsKCiAgICAgICAgLy8gaWYgd2UgZGVjbGFyZSBhIGRldGFjaGVkIHN0YXRl\nIGZpZWxkLCBoYXZlIHRvIHVzZSBpdAogICAgICAgIGlmIChkZXRhY2hlZEZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNF\nOwogICAgICAgIGlmICghU1lOVEhFVElDLmVxdWFscyhkZXRhY2hlZEZpZWxk\nKSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKCiAgICAgICAg\nLy8gYWxsb3cgY29uZiB0byBkaXNhbGxvdwogICAgICAgIGlmIChjb25mRGlz\nYWxsb3dzICYmICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAg\nICAgICBnZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuZ2V0RGV0YWNoZWRTdGF0\nZUZpZWxkKCkpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwoK\nICAgICAgICAvLyBoYXZlIHRvIHVzZSBkZXRhY2hlZCBzdGF0ZSB0byBzdG9y\nZSBkYXRhc3RvcmUgaWQKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBlKCkg\nPT0gSURfREFUQVNUT1JFKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5U\nUlVFOwoKICAgICAgICAvLyBhbGxvdyBkZXRhY2hlZCBzdGF0ZSB1c2UsIGJ1\ndCBkb24ndCByZXF1aXJlCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgZmllbGQgZGF0YS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJBbGxGaWVsZENhY2hlKCkgewog\nICAgICAgIF9hbGxGaWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxERkdGaWVs\nZHMgPSBudWxsOwogICAgICAgIF9hbGxQS0ZpZWxkcyA9IG51bGw7CiAgICAg\nICAgX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAgICAgIF9saXN0aW5nRmll\nbGRzID0gbnVsbDsKICAgICAgICBfYWxsTGlzdGluZ0ZpZWxkcyA9IG51bGw7\nCiAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0gbnVsbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIENsZWFyIGRlZmluZWQgZmllbGQgZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZWZpbmVkRmllbGRDYWNoZSgpIHsK\nICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IG51bGw7CiAgICAgICAgX2xpc3Rp\nbmdGaWVsZHMgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIg\nY2FjaGVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIGNsZWFyRmllbGRDYWNoZSgpIHsKICAgICAgICBjbGVhckFsbEZpZWxkQ2Fj\naGUoKTsKICAgICAgICBfZmllbGRzID0gbnVsbDsKICAgICAgICBfdW5tZ2RG\naWVsZHMgPSBudWxsOwogICAgICAgIF92ZXJzaW9uSWR4ID0gSW50ZWdlci5N\nSU5fVkFMVUU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQg\nc3ViY2xhc3MgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xl\nYXJTdWJjbGFzc0NhY2hlKCkgewogICAgICAgIF9zdWJzID0gbnVsbDsKICAg\nICAgICBfc3ViTWV0YXMgPSBudWxsOwogICAgICAgIF9tYXBTdWJNZXRhcyA9\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBpbXBsIGRhdGEg\nYW5kIGludGVybWVkaWF0ZSBkYXRhIHRhYmxlLgogICAgICovCiAgICB2b2lk\nIGNsZWFyRXh0cmFGaWVsZERhdGFUYWJsZSgpIHsKICAgICAgICBfZmllbGRE\nYXRhVGFibGUgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2FjaGUg\nZmllbGQgYXJyYXlzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2FjaGVG\naWVsZHMoKSB7CiAgICAgICAgZ2V0RmllbGRzKCk7CiAgICAgICAgZ2V0UHJp\nbWFyeUtleUZpZWxkcygpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgaGFzaENv\nZGUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUoKS5oYXNoQ29k\nZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qg\nb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2Vv\nZiBDbGFzc01ldGFEYXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIHJldHVybiBfdHlwZSA9PSAoKENsYXNzTWV0YURhdGEpIG90aGVy\nKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICB9CgogICAgcHVibGljIGludCBj\nb21wYXJlVG8oQ2xhc3NNZXRhRGF0YSBvdGhlcikgewogICAgICAgIGlmIChv\ndGhlciA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBy\nZXR1cm4gX3R5cGUuZ2V0TmFtZSgpLmNvbXBhcmVUbygoKENsYXNzTWV0YURh\ndGEpIG90aGVyKS4KICAgICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpLmdl\ndE5hbWUoKSk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygp\nIHsKICAgICAgICByZXR1cm4gZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8v\nIFJlc29sdmUgYW5kIHZhbGlkYXRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRo\naXMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UmVzb2x2\nZSgpIHsKICAgICAgICByZXR1cm4gX3Jlc01vZGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgcmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1ldGFkYXRhLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlKSB7\nCiAgICAgICAgX3Jlc01vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHJlc29sdmUgbW9kZSBmb3IgdGhpcyBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShpbnQgbW9kZSwgYm9vbGVh\nbiBvbikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAg\nICAgICAgX3Jlc01vZGUgPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9uKQog\nICAgICAgICAgICBfcmVzTW9kZSB8PSBtb2RlOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgX3Jlc01vZGUgJj0gfm1vZGU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXNvbHZlIGFuZCB2YWxpZGF0ZSBtZXRhZGF0YS4gUmV0dXJuIHRy\ndWUgaWYgYWxyZWFkeSByZXNvbHZlZC4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gcmVzb2x2ZShpbnQgbW9kZSkgewogICAgICAgIGlmICgoX3Jlc01v\nZGUgJiBtb2RlKSA9PSBtb2RlKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICBpbnQgY3VyID0gX3Jlc01vZGU7CiAgICAgICAgX3Jlc01vZGUg\nfD0gbW9kZTsKCiAgICAgICAgaW50IHZhbCA9IF9yZXBvcy5nZXRWYWxpZGF0\nZSgpOwogICAgICAgIGJvb2xlYW4gcnVudGltZSA9ICh2YWwgJiBNZXRhRGF0\nYVJlcG9zaXRvcnkuVkFMSURBVEVfUlVOVElNRSkgIT0gMDsKICAgICAgICBi\nb29sZWFuIHZhbGlkYXRlID0KICAgICAgICAgICAgIUltcGxIZWxwZXIuaXNN\nYW5hZ2VkVHlwZShnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigp\nLCBfdHlwZSkKICAgICAgICAgICAgfHwgKHZhbCAmIE1ldGFEYXRhUmVwb3Np\ndG9yeS5WQUxJREFURV9VTkVOSEFOQ0VEKSA9PSAwOwoKICAgICAgICAvLyB3\nZSBvbmx5IGRvIGFueSBhY3Rpb25zIGZvciBtZXRhZGF0YSBtb2RlCiAgICAg\nICAgaWYgKChtb2RlICYgTU9ERV9NRVRBKSAhPSAwICYmIChjdXIgJiBNT0RF\nX01FVEEpID09IDApIHsKICAgICAgICAgICAgcmVzb2x2ZU1ldGEocnVudGlt\nZSk7CiAgICAgICAgICAgIGlmICh2YWxpZGF0ZSAmJiAodmFsICYgTWV0YURh\ndGFSZXBvc2l0b3J5LlZBTElEQVRFX01FVEEpICE9IDApCiAgICAgICAgICAg\nICAgICB2YWxpZGF0ZU1ldGEocnVudGltZSk7CiAgICAgICAgfQogICAgICAg\nIGlmICgobW9kZSAmIE1PREVfTUFQUElORykgIT0gMCAmJiAoY3VyICYgTU9E\nRV9NQVBQSU5HKSA9PSAwKSB7CiAgICAgICAgICAgIHJlc29sdmVNYXBwaW5n\nKHJ1bnRpbWUpOwogICAgICAgICAgICBpZiAodmFsaWRhdGUgJiYgKHZhbCAm\nIE1ldGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9NQVBQSU5HKSAhPSAwKQog\nICAgICAgICAgICAgICAgdmFsaWRhdGVNYXBwaW5nKHJ1bnRpbWUpOwogICAg\nICAgIH0KICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkdfSU5JVCkg\nIT0gMCAmJiAoY3VyICYgTU9ERV9NQVBQSU5HX0lOSVQpID09IDApCiAgICAg\nICAgICAgIGluaXRpYWxpemVNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtZXRhZGF0YS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1ldGEoYm9vbGVh\nbiBydW50aW1lKSB7CiAgICAgICAgYm9vbGVhbiBlbWJlZCA9IF9vd25lciAh\nPSBudWxsICYmIF9vd25lci5nZXREZWNsYXJlZFR5cGUoKSA9PSBfdHlwZTsK\nICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlm\nIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNl\nKF9sb2MuZ2V0KChlbWJlZCkgPyAicmVzb2x2ZS1lbWJlZC1tZXRhIiA6ICJy\nZXNvbHZlLW1ldGEiLAogICAgICAgICAgICAgICAgdGhpcyArICJAIiArIFN5\nc3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CgogICAgICAgIGlmIChy\ndW50aW1lICYmICFfdHlwZS5pc0ludGVyZmFjZSgpICYmCiAgICAgICAgICAg\nICFJbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUoZ2V0UmVwb3NpdG9yeSgpLmdl\ndENvbmZpZ3VyYXRpb24oKSxfdHlwZSkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVuaGFuY2VkIiwg\nX3R5cGUpKTsKCiAgICAgICAgLy8gYXJlIHdlIHRoZSB0YXJnZXQgb2YgYW4g\nZW1iZWRkZWQgdmFsdWU/CiAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAg\nICAgIGlmIChyZWN1cnNpdmVFbWJlZChfb3duZXIpKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInJl\nY3Vyc2UtZW1iZWQiLCBfb3duZXIpKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gY29weSBpbmZvIGZyb20gdGhlICJyZWFsIiBtZXRhZGF0YSBm\nb3IgdGhpcyB0eXBlCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIF9yZXBvcy5nZXRNZXRhRGF0YShfdHlwZSwgX2xvYWRlciwgdHJ1ZSk7CiAg\nICAgICAgICAgIG1ldGEucmVzb2x2ZShNT0RFX01FVEEpOwogICAgICAgICAg\nICBjb3B5KHRoaXMsIG1ldGEpOwogICAgICAgICAgICBfZW1iZWRkZWQgPSBC\nb29sZWFuLkZBTFNFOyAvLyBlbWJlZGRlZCBpbnN0YW5jZSBpc24ndCBlbWJl\nZGRlZC1vbmx5CiAgICAgICAgfQoKICAgICAgICAvLyBtYWtlIHN1cmUgc3Vw\nZXJjbGFzcyBpcyByZXNvbHZlZAogICAgICAgIENsYXNzTWV0YURhdGEgc3Vw\nID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoc3Vw\nICE9IG51bGwpIHsKICAgICAgICAgICAgc3VwLnJlc29sdmUoTU9ERV9NRVRB\nKTsKICAgICAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAgICAgICAv\nLyBlbWJlZGRlZCBpbnN0YW5jZSBhbHdheXMgcmVkZWZpbmUgYWxsIHN1cGVy\nY2xhc3MgZmllbGRzCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nc3VwcyA9IHN1cC5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbAogICAgICAgICAg\nICAgICAgICAgICAgICB8fCAhX3N1cEZpZWxkTWFwLmNvbnRhaW5zS2V5KHN1\ncHNbaV0uZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBh\nZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJl\nZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cHNbaV0u\nZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIHJlc29sdmUgZmllbGRzIGFuZCByZW1vdmUgaW52YWxpZHMKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZDsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nPEZpZWxkTWV0YURhdGE+IGl0ciA9IF9maWVsZE1hcC52YWx1ZXMoKS5pdGVy\nYXRvcigpOyAKICAgICAgICAJaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgLy8gb25seSBwYXNzIG9uIG1ldGFkYXRhIHJlc29sdmUgbW9kZSBzbyB0\naGF0IG1ldGFkYXRhIGlzIGFsd2F5cwogICAgICAgICAgICAvLyByZXNvbHZl\nZCBiZWZvcmUgYW55IG90aGVyIHJlc29sdmUgbW9kZXMgb3VyIHN1YmNsYXNz\nZXMgcGFzcyBhbG9uZwogICAgICAgICAgICBmbWQgPSBpdHIubmV4dCgpOwog\nICAgICAgICAgICBmbWQucmVzb2x2ZShNT0RFX01FVEEpOwoKICAgICAgICAg\nICAgaWYgKCFmbWQuaXNFeHBsaWNpdCgpCiAgICAgICAgICAgICAgICAmJiAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0JKRUNU\nCiAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5QQ19VTlRZUEVECiAgICAgICAgICAgICAgICB8fCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkK\nICAgICAgICAgICAgICAgICYmIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpCiAgICAgICAgICAgICAgICA9PSBKYXZhVHlwZXMuT0JK\nRUNUKSkpIHsKICAgICAgICAgICAgICAgIF9yZXBvcy5nZXRMb2coKS53YXJu\nKF9sb2MuZ2V0KCJybS1maWVsZCIsIGZtZCkpOwogICAgICAgICAgICAgICAg\naWYgKGZtZC5nZXRMaXN0aW5nSW5kZXgoKSAhPSAtMSkKICAgICAgICAgICAg\nICAgICAgICBmbWQuc2V0TWFuYWdlbWVudChGaWVsZE1ldGFEYXRhLk1BTkFH\nRV9OT05FKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICBjbGVhckZpZWxk\nQ2FjaGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nZW1iZWRkZWQgaW5zdGFuY2VzIG11c3QgZW1iZWQgYWxsIHN1cGVyY2xhc3Mg\nZmllbGRzIHRvbwogICAgICAgIGlmIChlbWJlZCkgewogICAgICAgICAgICBj\nbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgcmVzb2x2ZURlZmlu\nZWRTdXBlcmNsYXNzRmllbGRzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyB0\naGlzIGVuc3VyZXMgdGhhdCBhbGwgZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdo\nZW4gZmllbGRzIGFyZSBjYWNoZWQKICAgICAgICBjYWNoZUZpZWxkcygpOwoK\nICAgICAgICAvLyByZXNvbHZlIGxpZmVjeWNsZSBtZXRhZGF0YSBub3cgdG8g\ncHJldmVudCBsYXp5IHRocmVhZGluZyBwcm9ibGVtcwogICAgICAgIF9saWZl\nTWV0YS5yZXNvbHZlKCk7CgogICAgICAgIC8vIHJlY29yZCBpbXBsZW1lbnRz\nIGluIHRoZSByZXBvc2l0b3J5CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzICE9\nIG51bGwpIHsKICAgICAgICAgICAgZm9yIChDbGFzczw/PiBpZmFjZSA6IF9p\nbnRlcmZhY2VzKQogICAgICAgICAgICAgICAgX3JlcG9zLmFkZERlY2xhcmVk\nSW50ZXJmYWNlSW1wbCh0aGlzLCBpZmFjZSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyByZXNvbHZlIGZldGNoIGdyb3VwcwogICAgICAgIGlmIChfZmdNYXAg\nIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChGZXRjaEdyb3VwIGZnIDogX2Zn\nTWFwLnZhbHVlcygpKQogICAgICAgICAgICAgICAgZmcucmVzb2x2ZSgpOwoK\nICAgICAgICBpZiAoIWVtYmVkICYmIF90eXBlLmlzSW50ZXJmYWNlKCkpIHsK\nICAgICAgICAgICAgaWYgKF9pbnRlcmZhY2UgIT0gQm9vbGVhbi5UUlVFKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJpbnRlcmZhY2UiLCBfdHlwZSkpOwoKICAgICAgICAgICAgaWYg\nKHJ1bnRpbWUpIHsKICAgICAgICAgICAgICAgIF9pbXBsID0gX3JlcG9zLmdl\ndEltcGxHZW5lcmF0b3IoKS5jcmVhdGVJbXBsKHRoaXMpOwogICAgICAgICAg\nICAgICAgX3JlcG9zLnNldEludGVyZmFjZUltcGwodGhpcywgX2ltcGwpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGlzIGlz\nIHJ1bnRpbWUsIGNyZWF0ZSBhIHBjIGluc3RhbmNlIGFuZCBzY2FuIGl0IGZv\nciBjb21wYXJhdG9ycwogICAgICAgIGlmIChydW50aW1lICYmICFNb2RpZmll\nci5pc0Fic3RyYWN0KF90eXBlLmdldE1vZGlmaWVycygpKSkgewogICAgICAg\nICAgICBQcm94eVNldHVwU3RhdGVNYW5hZ2VyIHNtID0gbmV3IFByb3h5U2V0\ndXBTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgc20uc2V0UHJveHlEYXRh\nKFBDUmVnaXN0cnkubmV3SW5zdGFuY2UoX3R5cGUsIHNtLCBmYWxzZSksIHRo\naXMpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gcmVj\ndXJzaXZlRW1iZWQoVmFsdWVNZXRhRGF0YSBvd25lcikgewogICAgICAgIENs\nYXNzTWV0YURhdGEgY20gPSBvd25lci5nZXRGaWVsZE1ldGFEYXRhKCkuZ2V0\nRGVmaW5pbmdNZXRhRGF0YSgpOyAKICAgICAgICBpZiAoY20uZ2V0RGVzY3Jp\nYmVkVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oX3R5cGUpKQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIG93bmVyMSA9\nIGNtLmdldEVtYmVkZGluZ01ldGFEYXRhKCk7CiAgICAgICAgaWYgKG93bmVy\nMSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nZWxzZSAKICAgICAgICAgICAgcmV0dXJuIHJlY3Vyc2l2ZUVtYmVkKG93bmVy\nMSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVmFsaWRhdGUgcmVzb2x2\nZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHZhbGlk\nYXRlTWV0YShib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICB2YWxpZGF0ZURh\ndGFDYWNoZSgpOwogICAgICAgIHZhbGlkYXRlRGV0YWNoYWJsZSgpOwogICAg\nICAgIHZhbGlkYXRlRXh0ZW5zaW9uS2V5cygpOwogICAgICAgIHZhbGlkYXRl\nSWRlbnRpdHkoKTsKICAgICAgICB2YWxpZGF0ZUFjY2Vzc1R5cGUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlc29sdmUgbWFwcGluZyBkYXRhLiBMb2dz\nIHJlc29sdmUgbWVzc2FnZSBhbmQgcmVzb2x2ZXMgc3VwZXIgYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1hcHBpbmco\nYm9vbGVhbiBydW50aW1lKSB7CiAgICAgICAgTG9nIGxvZyA9IF9yZXBvcy5n\nZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgicmVzb2x2ZS1tYXBwaW5n\nIiwgdGhpcyArICJAIgogICAgICAgICAgICAgICAgKyBTeXN0ZW0uaWRlbnRp\ndHlIYXNoQ29kZSh0aGlzKSkpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgc3Vw\nZXJjbGFzcyBpcyByZXNvbHZlZCBmaXJzdAogICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBp\nZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgIHN1cC5yZXNvbHZlKE1PREVf\nTUFQUElORyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBtYXBw\naW5nIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHZhbGlkYXRl\nTWFwcGluZyhib29sZWFuIHJ1bnRpbWUpIHsKICAgIH0KCiAgICAvKioKICAg\nICAqIEluaXRpYWxpemUgbWFwcGluZy4gTG9ncyBpbml0IG1lc3NhZ2UgYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgaW5pdGlhbGl6\nZU1hcHBpbmcoKSB7CiAgICAgICAgTG9nIGxvZyA9IF9yZXBvcy5nZXRMb2co\nKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgIGxvZy50cmFjZShfbG9jLmdldCgiaW5pdC1tYXBwaW5nIiwgdGhpcyAr\nICJAIgogICAgICAgICAgICAgICAgKyBTeXN0ZW0uaWRlbnRpdHlIYXNoQ29k\nZSh0aGlzKSkpOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgZGF0\nYSBjYWNoZSBzZXR0aW5ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZh\nbGlkYXRlRGF0YUNhY2hlKCkgewogICAgICAgIGludCB0aW1lb3V0ID0gZ2V0\nRGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgIGlmICh0aW1lb3V0IDwgLTEg\nfHwgdGltZW91dCA9PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImNhY2hlLXRpbWVvdXQtaW52YWxpZCIs\nCiAgICAgICAgICAgICAgICBfdHlwZSwgU3RyaW5nLnZhbHVlT2YodGltZW91\ndCkpKTsKCiAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgU3RyaW5nIGNhY2hlID0g\nZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBudWxs\nKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFN0\ncmluZyBzdXBlckNhY2hlID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5n\nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgCiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KHN1cGVyQ2FjaGUpKSB7ICAKICAgICAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5lcXVhbHMoY2FjaGUsIHN1cGVyQ2FjaGUpKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImNhY2hlLW5hbWVzIiwgbmV3IE9iamVjdFtdIHsgX3R5cGUs\nIGNhY2hlLCBfc3VwZXIsIHN1cGVyQ2FjaGUgfSkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQg\ndGhlIGlkZW50aXR5IGhhbmRsaW5nIGZvciB0aGlzIGNsYXNzIGlzIHZhbGlk\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVJZGVudGl0eSgp\nIHsKICAgICAgICAvLyBtYWtlIHN1cmUgaWRlbnRpdHkgdHlwZXMgYXJlIGNv\nbnNpc3RlbnQKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaW50IGlkID0gZ2V0SWRlbnRp\ndHlUeXBlKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRJ\nZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOCiAgICAgICAgICAgICYmIHN1\ncC5nZXRJZGVudGl0eVR5cGUoKSAhPSBpZCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpZC10eXBlcyIsIF90\neXBlKSk7CgogICAgICAgIC8vIGNoZWNrIGZvciB0aGluZ3MgdGhlIGRhdGEg\nc3RvcmUgZG9lc24ndCBzdXBwb3J0CiAgICAgICAgQ29sbGVjdGlvbjxTdHJp\nbmc+IG9wdHMgPSBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRl\nZE9wdGlvbnMoKTsKICAgICAgICBpZiAoaWQgPT0gSURfQVBQTElDQVRJT04K\nICAgICAgICAgICAgJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24uT1BUSU9OX0lEX0FQUExJQ0FUSU9OKSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImFwcGlk\nLW5vdC1zdXBwb3J0ZWQiLAogICAgICAgICAgICAgICAgX3R5cGUpKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKGlkID09IElEX0RBVEFTVE9SRQogICAgICAg\nICAgICAmJiAhb3B0cy5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5P\nUFRJT05fSURfREFUQVNUT1JFKSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAg\nICgiZGF0YXN0b3JlaWQtbm90LXN1cHBvcnRlZCIsIF90eXBlKSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoaWQgPT0gSURfQVBQTElDQVRJT04pIHsKICAg\nICAgICAgICAgaWYgKF9pZFN0cmF0ZWd5ICE9IFZhbHVlU3RyYXRlZ2llcy5O\nT05FKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJhcHBpZC1zdHJhdGVneSIsIF90eXBlKSk7CiAgICAg\nICAgICAgIHZhbGlkYXRlQXBwSWRDbGFzcygpOwogICAgICAgIH0gZWxzZSBp\nZiAoaWQgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgdmFsaWRhdGVOb1BL\nRmllbGRzKCk7CgogICAgICAgIGludCBzdHJhdGVneSA9IGdldElkZW50aXR5\nU3RyYXRlZ3koKTsKICAgICAgICBpZiAoc3RyYXRlZ3kgPT0gVmFsdWVTdHJh\ndGVnaWVzLlNFUVVFTkNFCiAgICAgICAgICAgICYmIGdldElkZW50aXR5U2Vx\ndWVuY2VOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zZXEtbmFtZSIsIF90eXBl\nKSk7CgogICAgICAgIFZhbHVlU3RyYXRlZ2llcy5hc3NlcnRTdXBwb3J0ZWQo\nc3RyYXRlZ3ksIHRoaXMsCiAgICAgICAgICAgICJkYXRhc3RvcmUgaWRlbnRp\ndHkgc3RyYXRlZ3kiKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3Vy\nZSB0aGUgYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3MgaXMgdmFsaWQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xhc3MoKSB7\nCiAgICAgICAgLy8gYmFzZSB0eXBlcyBtdXN0IGRlY2xhcmUgYW4gb2lkIGNs\nYXNzIGlmIG5vdCBzaW5nbGUtZmllbGQgaWRlbnRpdHkKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gcGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAg\nICAgIGlmIChnZXRPYmplY3RJZFR5cGUoKSA9PSBudWxsKSB7CiAgICAgICAg\nICAgIGlmIChwa3MubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVk\nLWlkLXR5cGUiLAogICAgICAgICAgICAgICAgICAgIF90eXBlLCBwa3NbMF0u\nZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIHBrc1swXS5nZXREZWNs\nYXJlZFR5cGUoKS5nZXROYW1lKCkpKTsKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1pZC1jbGFzcyIsIF90\neXBlLCAKICAgICAgICAgICAgCQlBcnJheXMuYXNMaXN0KHRvTmFtZXMocGtz\nKSkpKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9vYmplY3RJZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChpc09wZW5KUEFJ\nZGVudGl0eSgpKSB7CiAgICAgICAgICAgIGlmIChwa3NbMF0uZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpIHsKICAgICAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgZW1iZWQgPSBwa3NbMF0uZ2V0RW1iZWRkZWRN\nZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNz\nTWV0aG9kcyhlbWJlZC5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAg\nICAgICAgdmFsaWRhdGVBcHBJZENsYXNzUEtzKGVtYmVkLCBlbWJlZC5nZXRG\naWVsZHMoKSwKICAgICAgICAgICAgICAgICAgICBlbWJlZC5nZXREZXNjcmli\nZWRUeXBlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBjb25jcmV0ZSBzdXBlcmNsYXNzIG9pZCBtdXN0IG1hdGNo\nIG9yIGJlIHBhcmVudCBvZiBvdXJzCiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAg\nICAgQ2xhc3M8Pz4gb2JqZWN0SWRUeXBlID0gc3VwLmdldE9iamVjdElkVHlw\nZSgpOwogICAgICAgICAgICBpZiAob2JqZWN0SWRUeXBlICE9IG51bGwgJiYg\nCiAgICAgICAgICAgICAgICAhb2JqZWN0SWRUeXBlLmlzQXNzaWduYWJsZUZy\nb20oX29iamVjdElkKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaWQtY2xhc3NlcyIsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBfdHlwZSwgX29iamVjdElkLCBf\nc3VwZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cC5nZXRPYmplY3RJ\nZFR5cGUoKSB9KSk7CgogICAgICAgICAgICAvLyB2YWxpZGF0ZSB0aGF0IG5v\nIG90aGVyIHBrcyBhcmUgZGVjbGFyZWQgaWYgd2UgaGF2ZSBhCiAgICAgICAg\nICAgIC8vIGNvbmNyZXRlIFBDIHN1cGVyY2xhc3MKICAgICAgICAgICAgaWYg\nKGhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCkpCiAgICAgICAgICAgICAgICB2\nYWxpZGF0ZU5vUEtGaWVsZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHRoaXMgY2xhc3MgaGFzIGl0cyBvd24gb2lkIGNsYXNzLCBkbyBzb21lIG1v\ncmUgdmFsaWRhdGlvbgogICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbAogICAg\nICAgICAgICB8fCBfb2JqZWN0SWQgIT0gZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKS5nZXRPYmplY3RJZFR5cGUoKSkgewogICAgICAgICAgICAvLyBtYWtl\nIHN1cmUgbm9uLWFic3RyYWN0IG9pZCBjbGFzc2VzIG92ZXJyaWRlIHRoZSBw\ncm9wZXIgbWV0aG9kcwogICAgICAgICAgICBpZiAoIU1vZGlmaWVyLmlzQWJz\ndHJhY3QoX29iamVjdElkLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAg\nICAgIHZhbGlkYXRlQXBwSWRDbGFzc01ldGhvZHMoX29iamVjdElkKTsKCiAg\nICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgYXBwbGljYXRpb24gaWQgY2xh\nc3MgaGFzIGFsbCBwcmltYXJ5IGtleSBmaWVsZHMKICAgICAgICAgICAgdmFs\naWRhdGVBcHBJZENsYXNzUEtzKHRoaXMsIHBrcywgX29iamVjdElkKTsKICAg\nICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRo\naXMgY2xhc3MgdXNlcyBJZENsYXNzIGRlcml2ZWQgZnJvbSBpZENsYXNzIG9m\nIHRoZSAKICAgICAqIHBhcmVudCBlbnRpdHkgd2hpY2ggYW5ub3RhdGVkIGFz\nIGlkIGluIHRoZSBjaGlsZCBjbGFzcy4gCiAgICAgKiBJbiB0aGlzIGNhc2Us\nIHRoZXJlIGFyZSBubyBrZXkgZmllbGRzIGluIHRoZSBjaGlsZCBlbnRpdHkg\nY29ycmVzcG9uZGluZyAKICAgICAqIHRvIHRoZSBmaWVsZHMgaW4gdGhlIElk\nQ2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHVzZUlkQ2xhc3NG\ncm9tUGFyZW50KCkgewogICAgICAgIGlmIChfdXNlSWRDbGFzc0Zyb21QYXJl\nbnQgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX29iamVjdElkID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfdXNlSWRDbGFzc0Zyb21QYXJlbnQgPSBm\nYWxzZTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gcGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAg\nICAgICAgICAgICAgaWYgKHBrcy5sZW5ndGggIT0gMSkgCiAgICAgICAgICAg\nICAgICAgICAgX3VzZUlkQ2xhc3NGcm9tUGFyZW50ID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIHBrTWV0YSA9IHBrc1swXS5nZXRUeXBlTWV0YURhdGEoKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAocGtNZXRhID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIF91c2VJZENsYXNzRnJvbVBhcmVudCA9IGZhbHNl\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICBDbGFzczw/PiBwa1R5cGUgPSBwa01ldGEuZ2V0T2JqZWN0SWRU\neXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwa1R5cGUgPT0g\nT2JqZWN0SWQuY2xhc3MpIC8vcGFyZW50IGlkIGlzIEVtYmVkZGVkSWQKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHBrVHlwZSA9IHBrTWV0YS5nZXRQ\ncmltYXJ5S2V5RmllbGRzKClbMF0uZ2V0VHlwZSgpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAocGtUeXBlID09IF9vYmplY3RJZCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIF91c2VJZENsYXNzRnJvbVBhcmVudCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgRmllbGQgZiA9IFJlZmxlY3Rpb24uZmluZEZp\nZWxkKF9vYmplY3RJZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcGtzWzBdLmdldE5hbWUoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGYgIT0gbnVsbCkgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgX3VzZUlkQ2xhc3NGcm9tUGFyZW50ID0gZmFsc2U7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICJpbnZhbGlkLWlkIiwgX3R5cGUsIHBrc1swXS5nZXROYW1l\nKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX3VzZUlkQ2xhc3NGcm9tUGFyZW50LmJv\nb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRy\ndWUgaWYgdGhpcyBjbGFzcyBoYXMgYSBjb25jcmV0ZSBwZXJzaXN0ZW50IHN1\ncGVyY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNDb25j\ncmV0ZVBDU3VwZXJjbGFzcygpIHsKICAgICAgICBpZiAoX3N1cGVyID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIU1v\nZGlmaWVyLmlzQWJzdHJhY3QoX3N1cGVyLmdldE1vZGlmaWVycygpKSAmJiAK\nICAgICAgICAJCSghZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5pc0Fic3Ry\nYWN0KCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1\ncm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5oYXNDb25jcmV0ZVBDU3Vw\nZXJjbGFzcygpOwogICAgfQoKICAgIC8qKgogICAgICogRW5zdXJlIHRoYXQg\ndGhlIHVzZXIgaGFzIG92ZXJyaWRkZW4gdGhlIGVxdWFscyBhbmQgaGFzaENv\nZGUgbWV0aG9kcywKICAgICAqIGFuZCBoYXMgdGhlIHByb3BlciBjb25zdHJ1\nY3RvcnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElk\nQ2xhc3NNZXRob2RzKENsYXNzPD8+IG9pZCkgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIG9pZC5nZXRDb25zdHJ1Y3RvcigoQ2xhc3NbXSkgbnVsbCk7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWNv\nbnMiLCBvaWQsIF90eXBlKSkuCiAgICAgICAgICAgICAgICBzZXRDYXVzZShl\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGZvciBlcXVhbHMgYW5k\nIGhhc2hjb2RlIG92ZXJyaWRlczsgZG9uJ3QgZW5mb3JjZSBpdAogICAgICAg\nIC8vIGZvciBhYnN0cmFjdCBhcHBsaWNhdGlvbiBpZCBjbGFzc2VzLCBzaW5j\nZSB0aGV5IG1heSBub3QgbmVjZXNzYXJpbHkKICAgICAgICAvLyBkZWNsYXJl\nIHByaW1hcnkga2V5IGZpZWxkcwogICAgICAgIE1ldGhvZCBtZXRob2Q7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0aG9kID0gb2lkLmdldE1ldGhv\nZCgiZXF1YWxzIiwgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKS5zZXRGYXRhbCh0cnVlKTsKICAg\nICAgICB9CgogICAgICAgIGJvb2xlYW4gYWJzID0gTW9kaWZpZXIuaXNBYnN0\ncmFjdChfdHlwZS5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgaWYgKCFhYnMg\nJiYgbWV0aG9kLmdldERlY2xhcmluZ0NsYXNzKCkgPT0gT2JqZWN0LmNsYXNz\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImVxLW1ldGhvZCIsIF90eXBlKSk7CgogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIG1ldGhvZCA9IG9pZC5nZXRNZXRob2QoImhhc2hDb2RlIiwg\nKENsYXNzW10pIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUp\nLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoIWFicyAm\nJiBtZXRob2QuZ2V0RGVjbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xhc3Mp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiaGMtbWV0aG9kIiwgX3R5cGUpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFZhbGlkYXRlIHRoYXQgdGhlIHByaW1hcnkga2V5IGNsYXNzIGhhcyBh\nbGwgcGsgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRh\ndGVBcHBJZENsYXNzUEtzKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcywgQ2xhc3M8Pz4gb2lkKSB7CiAgICAgICAg\naWYgKGZtZHMubGVuZ3RoID09IDAgJiYgIU1vZGlmaWVyLmlzQWJzdHJhY3Qo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuCiAgICAgICAgICAgIGdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1wayIsIF90eXBlKSk7CgogICAgICAgIC8vIGNo\nZWNrIHRoYXQgdGhlIG9pZCB0eXBlIGNvbnRhaW5zIGFsbCBwayBmaWVsZHMK\nICAgICAgICBGaWVsZCBmOwogICAgICAgIE1ldGhvZCBtOwogICAgICAgIENs\nYXNzPD8+IGM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGMgPSBmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpLmdldENvbXBvbmVudFR5cGUoKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoYyA9PSBieXRlLmNsYXNzIHx8IGMgPT0gQnl0\nZS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBjID09IGNoYXIu\nY2xhc3MgfHwgYyA9PSBDaGFyYWN0ZXIuY2xhc3MpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJyZWFrCiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk9JRDogLy8gd2UncmUgdmFsaWRhdGluZyBlbWJl\nZGRlZCBmaWVsZHMKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1way10eXBlIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXSkpOwogICAgICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjID0gZm1kc1tpXS5nZXRP\nYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAoQWNjZXNzQ29kZS5pc0ZpZWxkKGZtZHNbaV0uZ2V0QWNjZXNzVHlw\nZSgpKSkgewogICAgICAgICAgICAgICAgZiA9IFJlZmxlY3Rpb24uZmluZEZp\nZWxkKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGlmIChmID09IG51bGwgfHwgIWYuZ2V0VHlwZSgpLmlzQXNzaWdu\nYWJsZUZyb20oYykpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpKSk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoQWNjZXNzQ29kZS5pc1Byb3BlcnR5\nKGZtZHNbaV0uZ2V0QWNjZXNzVHlwZSgpKSkgewogICAgICAgICAgICAgICAg\nbSA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWQsIGZtZHNbaV0uZ2V0TmFt\nZSgpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAobSA9PSBudWxsIHx8\nICFtLmdldFJldHVyblR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKGMpKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAg\nIF90eXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAgICAgICAgICAgICAg\nbSA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWQsIGZtZHNbaV0uZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0T2JqZWN0SWRG\naWVsZFR5cGUoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKG0gPT0g\nbnVsbCB8fCBtLmdldFJldHVyblR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAg\nIF90eXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0\naGlzIGNsYXNzIGRvZXNuJ3QgZGVjbGFyZSBhbnkgcHJpbWFyeSBrZXkgZmll\nbGRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVOb1BLRmll\nbGRzKCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRzW2ld\nLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGsiLCBmaWVsZHNbaV0p\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoaXMgY2xh\nc3MnIGFjY2VzcyB0eXBlIGlzIGFsbG93ZWQuCiAgICAgKiBJZiBubyBhY2Nl\nc3Mgc3R5bGUgaXMgc2V0IG9yIGFuIGV4cGxpY2l0IHN0eWxlIGlzIHNldCBy\nZXR1cm4uCiAgICAgKiBPdGhlcndpc2UsIGlmIHRoZSBzdXBlcmNsYXNzIGhh\ncyBwZXJzaXN0ZW50IGF0dHJpYnV0ZXMsICBjaGVjayB0aGF0IAogICAgICog\ndGhlIHN1cGVyY2xhc3MgYWNjZXNzIHN0eWxlLCBpZiBkZWZhdWx0ZWQsIGlz\nIHRoZSBzYW1lIGFzIHRoYXQgb2YgdGhpcyAKICAgICAqIHJlY2VpdmVyLiAK\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlQWNjZXNzVHlwZSgp\nIHsKICAgICAgICBpZiAoQWNjZXNzQ29kZS5pc0VtcHR5KF9hY2Nlc3NUeXBl\nKSAKICAgICAgICAgICB8fCBBY2Nlc3NDb2RlLmlzRXhwbGljaXQoX2FjY2Vz\nc1R5cGUpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAg\nIHdoaWxlIChzdXAgIT0gbnVsbCAmJiBzdXAuaXNFeHBsaWNpdEFjY2Vzcygp\nKQogICAgICAgIAlzdXAgPSBzdXAuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldERlY2xhcmVk\nRmllbGRzKCkubGVuZ3RoID4gMCkgewogICAgICAgIAlpbnQgc3VwQ29kZSA9\nIHN1cC5nZXRBY2Nlc3NUeXBlKCk7CiAgICAgICAgCWlmICghQWNjZXNzQ29k\nZS5pc0NvbXBhdGlibGVTdXBlcihfYWNjZXNzVHlwZSwgc3VwQ29kZSkpCiAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImFjY2Vzcy1pbmNvbnNpc3RlbnQtaW5oZXJpdCIsCiAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117dGhpcywgQWNjZXNzQ29kZS50b0NsYXNzU3RyaW5n\nKF9hY2Nlc3NUeXBlKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vw\nLCBBY2Nlc3NDb2RlLnRvQ2xhc3NTdHJpbmcoc3VwQ29kZSl9KS50b1N0cmlu\nZygpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQg\ndGhhdCBkZXRhY2htZW50IGNvbmZpZ3VyYXRpb24gaXMgdmFsaWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZURldGFjaGFibGUoKSB7CiAg\nICAgICAgYm9vbGVhbiBmaXJzdCA9IHRydWU7CiAgICAgICAgZm9yIChDbGFz\nc01ldGFEYXRhIHBhcmVudCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7\nCiAgICAgICAgICAgIGZpcnN0ICYmIHBhcmVudCAhPSBudWxsOyBwYXJlbnQg\nPSBwYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAgICAgICB7\nCiAgICAgICAgICAgIGlmIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkpCiAgICAg\nICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAg\nRmllbGQgZmllbGQgPSBnZXREZXRhY2hlZFN0YXRlRmllbGQoKTsKICAgICAg\nICBpZiAoZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIWZpcnN0\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJwYXJlbnQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAg\nICAgICAgICBfdHlwZSkpOwogICAgICAgICAgICBpZiAoZ2V0RmllbGQoZmll\nbGQuZ2V0TmFtZSgpKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJtYW5hZ2VkLWRldGFj\naC1zdGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgp\nLCBfdHlwZSkpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZSgpICE9\nIE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaC1zdGF0ZSIsCiAg\nICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlwZSkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZl\ndGNoIEdyb3VwCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZmV0Y2ggZ3JvdXBzIGRlY2xhcmVkIGV4cGxpY2l0bHkg\naW4gdGhpcyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtd\nIGdldERlY2xhcmVkRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYgKF9mZ3Mg\nPT0gbnVsbCkKICAgICAgICAgICAgX2ZncyA9IChfZmdNYXAgPT0gbnVsbCkg\nPyBFTVBUWV9GRVRDSF9HUk9VUF9BUlJBWSA6IChGZXRjaEdyb3VwW10pCiAg\nICAgICAgICAgICAgICBfZmdNYXAudmFsdWVzKCkudG9BcnJheShuZXcgRmV0\nY2hHcm91cFtfZmdNYXAuc2l6ZSgpXSk7IAogICAgICAgIHJldHVybiBfZmdz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmZXRjaCBncm91\ncHMgZm9yIHRoaXMgdHlwZSwgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZ3JvdXBz\nLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldEN1c3RvbUZl\ndGNoR3JvdXBzKCkgewogICAgICAgIGlmIChfY3VzdG9tRkdzID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gbWFwIGZldGNoIGdyb3VwcyB0byBuYW1lcywg\nYWxsb3dpbmcgb3VyIGdyb3VwcyB0byBvdmVycmlkZSBzdXBlcgogICAgICAg\nICAgICBNYXA8U3RyaW5nLEZldGNoR3JvdXA+IGZncyA9IG5ldyBIYXNoTWFw\nPFN0cmluZyxGZXRjaEdyb3VwPigpOwogICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAg\nICAgICAgRmV0Y2hHcm91cFtdIHN1cEZHcyA9IHN1cC5nZXRDdXN0b21GZXRj\naEdyb3VwcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzdXBGR3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZmdz\nLnB1dChzdXBGR3NbaV0uZ2V0TmFtZSgpLCBzdXBGR3NbaV0pOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIEZldGNoR3JvdXBbXSBkZWNzID0gZ2V0RGVj\nbGFyZWRGZXRjaEdyb3VwcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGRlY3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBmZ3Mu\ncHV0KGRlY3NbaV0uZ2V0TmFtZSgpLCBkZWNzW2ldKTsKICAgICAgICAgICAg\nCiAgICAgICAgICAgIC8vIHJlbW92ZSBzdGFuZGFyZCBncm91cHMKICAgICAg\nICAgICAgZmdzLnJlbW92ZShGZXRjaEdyb3VwLk5BTUVfREVGQVVMVCk7CiAg\nICAgICAgICAgIGZncy5yZW1vdmUoRmV0Y2hHcm91cC5OQU1FX0FMTCk7Cgog\nICAgICAgICAgICBfY3VzdG9tRkdzID0gKEZldGNoR3JvdXBbXSkgZmdzLnZh\nbHVlcygpLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgRmV0Y2hHcm91\ncFtmZ3Muc2l6ZSgpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY3Vz\ndG9tRkdzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyBhIG5hbWVkIGZl\ndGNoIGdyb3VwLiBJZiBub3QgYXZhaWxhYmxlIGluIHRoaXMgcmVjZWl2ZXIg\ndGhlbiBsb29rcwogICAgICogdXAgdGhlIGluaGVyaXRhbmNlIGhpZXJhcmNo\neS4gCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgbmFtZSBvZiBhIGZldGNo\nIGdyb3VwLgogICAgICogQHJldHVybiBhbiBleGlzdGluZyBmZXRjaCBncm91\ncCBvZiB0aGUgZ2l2ZW4gbmFtZSBpZiBrbm93biB0byB0aGlzIAogICAgICog\ncmVjZWl2ZXIgb3IgYW55IG9mIGl0cyBzdXBlcmNsYXNzZXMuIE90aGVyd2lz\nZSBudWxsLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBnZXRGZXRj\naEdyb3VwKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9\nIChfZmdNYXAgPT0gbnVsbCkgPyBudWxsIDogKEZldGNoR3JvdXApIF9mZ01h\ncC5nZXQobmFtZSk7CiAgICAgICAgaWYgKGZnICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmZzsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gc3VwLmdldEZldGNoR3JvdXAobmFt\nZSk7CiAgICAgICAgaWYgKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxULmVxdWFs\ncyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIEZldGNoR3JvdXAuREVGQVVM\nVDsKICAgICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0FMTC5lcXVhbHMobmFt\nZSkpCiAgICAgICAgICAgIHJldHVybiBGZXRjaEdyb3VwLkFMTDsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgZmV0\nY2ggZ3JvdXAgb2YgdGhlIGdpdmVuIG5hbWUsIG9yIHJldHVybnMgZXhpc3Rp\nbmcgaW5zdGFuY2UuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgYSBub24t\nbnVsbCwgbm9uLWVtcHR5IG5hbWUuIE11c3QgYmUgdW5pcXVlIHdpdGhpbiB0\naGlzCiAgICAgKiByZWNlaXZlcidzIHNjb3BlLiBUaGUgc3VwZXIgY2xhc3Mg\nPGVtPm1heTwvZW0+IGhhdmUgYSBncm91cCB3aXRoCiAgICAgKiB0aGUgc2Ft\nZSBuYW1lLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBhZGREZWNs\nYXJlZEZldGNoR3JvdXAoU3RyaW5nIG5hbWUpIHsKICAgIAlpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgIAkJdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbXB0eS1mZy1uYW1lIiwgdGhpcykpOwog\nICAgICAgIGlmIChfZmdNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX2ZnTWFw\nID0gbmV3IEhhc2hNYXA8U3RyaW5nLEZldGNoR3JvdXA+KCk7CiAgICAgICAg\nRmV0Y2hHcm91cCBmZyA9IChGZXRjaEdyb3VwKSBfZmdNYXAuZ2V0KG5hbWUp\nOwogICAgICAgIGlmIChmZyA9PSBudWxsKSB7CiAgICAgICAgCWZnID0gbmV3\nIEZldGNoR3JvdXAodGhpcywgbmFtZSk7CiAgICAgICAgCV9mZ01hcC5wdXQo\nbmFtZSwgZmcpOwogICAgICAgICAgICBfZmdzID0gbnVsbDsKICAgICAgICAg\nICAgX2N1c3RvbUZHcyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIGRlY2xhcmVk\nIGZldGNoIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1v\ndmVEZWNsYXJlZEZldGNoR3JvdXAoRmV0Y2hHcm91cCBmZykgewogICAgICAg\nIGlmIChmZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgaWYgKF9mZ01hcC5yZW1vdmUoZmcuZ2V0TmFtZSgpKSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIF9mZ3MgPSBudWxsOwogICAgICAgICAgICBfY3Vz\ndG9tRkdzID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gU291cmNlVHJhY2tlcgogICAgLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICBwdWJsaWMgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewog\nICAgICAgIHJldHVybiBfc3JjRmlsZTsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldFNvdXJjZVNjb3BlKCkgewogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0U291cmNlVHlwZSgpIHsKICAgICAg\nICByZXR1cm4gX3NyY1R5cGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nU291cmNlKEZpbGUgZmlsZSwgaW50IHNyY1R5cGUpIHsKICAgICAgICBfc3Jj\nRmlsZSA9IGZpbGU7CiAgICAgICAgX3NyY1R5cGUgPSBzcmNUeXBlOwogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVzb3VyY2VOYW1lKCkgewogICAg\nICAgIHJldHVybiBfdHlwZS5nZXROYW1lKCk7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyBpbnQgZ2V0TGluZU51bWJlcigpIHsKICAgICAgICByZXR1cm4gX2xp\nbmVOdW07CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TGluZU51bWJlcihp\nbnQgbGluZU51bSkgewogICAgICAgIF9saW5lTnVtID0gbGluZU51bTsKICAg\nIH0KCiAgICBwdWJsaWMgaW50IGdldENvbE51bWJlcigpIHsKICAgICAgICBy\nZXR1cm4gX2NvbE51bTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb2xO\ndW1iZXIoaW50IGNvbE51bSkgewogICAgICAgIF9jb2xOdW0gPSBjb2xOdW07\nCiAgICB9CiAgICAKCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0\naGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRTb3VyY2VNb2RlKCkgewogICAgICAgIHJldHVy\nbiBfc3JjTW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2Ug\nbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSkg\newogICAgICAgIF9zcmNNb2RlID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxv\nYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U291cmNl\nTW9kZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChtb2Rl\nID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX3NyY01vZGUgPSBtb2RlOwog\nICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfc3JjTW9kZSB8PSBt\nb2RlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3NyY01vZGUgJj0gfm1v\nZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2gg\ndGhpcyBjbGFzcyB3YXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVs\ndHMgdG8KICAgICAqIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdh\ncyBub3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVi\nbGljIGludCBnZXRMaXN0aW5nSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9s\naXN0SW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4g\nd2hpY2ggdGhpcyBmaWVsZCB3YXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4g\nRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNs\nYXNzIHdhcyBub3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TGlzdGluZ0luZGV4KGludCBpbmRleCkgewog\nICAgICAgIF9saXN0SW5kZXggPSBpbmRleDsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIENvbW1lbnRhYmxlCiAgICAvLy8vLy8vLy8vLy8v\nLy8KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q29tbWVudHMoKSB7CiAgICAg\nICAgcmV0dXJuIChfY29tbWVudHMgPT0gbnVsbCkgPyBFTVBUWV9DT01NRU5U\nUyA6IF9jb21tZW50czsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb21t\nZW50cyhTdHJpbmdbXSBjb21tZW50cykgewogICAgICAgIF9jb21tZW50cyA9\nIGNvbW1lbnRzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBT\ndGF0ZSBjb3B5CiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICog\nQ29weSB0aGUgbWV0YWRhdGEgZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8g\ndGhpcyBvbmUuIERvIG5vdAogICAgICogY29weSBtYXBwaW5nIGluZm9ybWF0\naW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjb3B5KENsYXNzTWV0YURh\ndGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSAhPSBfdHlwZSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKCk7CiAgICAgICAgc3VwZXIuY29weShtZXRhKTsKCiAgICAgICAg\nLy8gY29weSBjbGFzcy1sZXZlbCBpbmZvOyB1c2UgZ2V0IG1ldGhvZHMgdG8g\nZm9yY2UgcmVzb2x1dGlvbiBvZgogICAgICAgIC8vIGxhenkgZGF0YQogICAg\nICAgIF9zdXBlciA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzKCk7CiAgICAgICAg\nX29iamVjdElkID0gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBf\nZXh0ZW50ID0gKG1ldGEuZ2V0UmVxdWlyZXNFeHRlbnQoKSkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgIF9lbWJlZGRlZCA9ICht\nZXRhLmlzRW1iZWRkZWRPbmx5KCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRTsKICAgICAgICBfZW1iZWRkYWJsZSA9IG1ldGEuX2VtYmVkZGFi\nbGU7CiAgICAgICAgX2ludGVyZmFjZSA9IChtZXRhLmlzTWFuYWdlZEludGVy\nZmFjZSgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgc2V0SW50ZXJjZXB0aW5nKG1ldGEuaXNJbnRlcmNlcHRpbmcoKSk7CiAg\nICAgICAgX2ltcGwgPSBtZXRhLmdldEludGVyZmFjZUltcGwoKTsKICAgICAg\nICBfaWRlbnRpdHkgPSBtZXRhLmdldElkZW50aXR5VHlwZSgpOwogICAgICAg\nIF9pZFN0cmF0ZWd5ID0gbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5KCk7CiAg\nICAgICAgX3NlcU5hbWUgPSBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VOYW1l\nKCk7CiAgICAgICAgX3NlcU1ldGEgPSBudWxsOwogICAgICAgIF9hbGlhcyA9\nIG1ldGEuZ2V0VHlwZUFsaWFzKCk7CiAgICAgICAgX2FjY2Vzc1R5cGUgPSBt\nZXRhLmdldEFjY2Vzc1R5cGUoKTsKCiAgICAgICAgLy8gb25seSBjb3B5IHRo\naXMgaW5mb3JtYXRpb24gaWYgaXQgd2Fzbid0IHNldCBleHBsaWNpdGx5IGZv\nciB0aGlzCiAgICAgICAgLy8gaW5zdGFuY2UKICAgICAgICBpZiAoREVGQVVM\nVF9TVFJJTkcuZXF1YWxzKF9jYWNoZU5hbWUpKQogICAgICAgICAgICBfY2Fj\naGVOYW1lID0gbWV0YS5nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgaWYg\nKF9jYWNoZVRpbWVvdXQgPT0gSW50ZWdlci5NSU5fVkFMVUUpCiAgICAgICAg\nICAgIF9jYWNoZVRpbWVvdXQgPSBtZXRhLmdldERhdGFDYWNoZVRpbWVvdXQo\nKTsKICAgICAgICBpZiAoX2RldGFjaGFibGUgPT0gbnVsbCkKICAgICAgICAg\nICAgX2RldGFjaGFibGUgPSBtZXRhLl9kZXRhY2hhYmxlOwogICAgICAgIGlm\nIChERUZBVUxUX1NUUklORy5lcXVhbHMoX2RldGFjaFN0YXRlKSkKICAgICAg\nICAgICAgX2RldGFjaFN0YXRlID0gbWV0YS5nZXREZXRhY2hlZFN0YXRlKCk7\nCgogICAgICAgIC8vIHN5bmNoIGZpZWxkIGluZm9ybWF0aW9uOyBmaXJzdCBy\nZW1vdmUgZXh0cmEgZmllbGRzCiAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7\nCiAgICAgICAgX2ZpZWxkTWFwLmtleVNldCgpLnJldGFpbkFsbChtZXRhLl9m\naWVsZE1hcC5rZXlTZXQoKSk7CgogICAgICAgIC8vIGFkZCBjb3BpZXMgb2Yg\nZGVjbGFyZWQgZmllbGRzOyBvdGhlciBkZWZpbmVkIGZpZWxkcyBhbHJlYWR5\nIGNvcGllZAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBtZXRh\nLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\naWVsZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBmaWVsZCA9IGdldERlY2xhcmVkRmll\nbGQoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmIChmaWVs\nZCA9PSBudWxsKQogICAgICAgICAgICAgICAgZmllbGQgPSBhZGREZWNsYXJl\nZEZpZWxkKGZpZWxkc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgZmllbGRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAg\nZmllbGQuc2V0RGVjbGFyZWRJbmRleCgtMSk7CiAgICAgICAgICAgIGZpZWxk\nLnNldEluZGV4KC0xKTsKICAgICAgICAgICAgZmllbGQuY29weShmaWVsZHNb\naV0pOwogICAgICAgIH0KCiAgICAgICAgLy8gY29weSBmZXRjaCBncm91cHMK\nICAgICAgICBGZXRjaEdyb3VwW10gZmdzID0gbWV0YS5nZXREZWNsYXJlZEZl\ndGNoR3JvdXBzKCk7CiAgICAgICAgRmV0Y2hHcm91cCBmZzsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZncy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBmZyA9IGFkZERlY2xhcmVkRmV0Y2hHcm91cChmZ3NbaV0uZ2V0TmFt\nZSgpKTsKICAgICAgICAgICAgZmcuY29weShmZ3NbaV0pOyAKICAgICAgICB9\nCgogICAgICAgIC8vIGNvcHkgaW50ZXJmYWNlIHJlLW1hcHBpbmcKICAgICAg\nICBfaWZhY2VNYXAuY2xlYXIoKTsKICAgICAgICBfaWZhY2VNYXAucHV0QWxs\nKG1ldGEuX2lmYWNlTWFwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vy\nc2l2ZSBoZWxwZXIgdG8gY29weSBlbWJlZGRlZCBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBjb3B5KENsYXNzTWV0YURhdGEg\nZW1iZWQsIENsYXNzTWV0YURhdGEgZGVjKSB7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBzdXAgPSBkZWMuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICBpZiAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgZW1iZWQuc2V0\nUENTdXBlcmNsYXNzKHN1cC5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAg\nICAgICBjb3B5KGVtYmVkLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCksIHN1\ncCk7CiAgICAgICAgfQogICAgICAgIGVtYmVkLmNvcHkoZGVjKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRFeHRlbnNpb25LZXlzKENvbGxlY3Rp\nb24gZXh0cykgewogICAgICAgIF9yZXBvcy5nZXRNZXRhRGF0YUZhY3Rvcnko\nKS5hZGRDbGFzc0V4dGVuc2lvbktleXMoZXh0cyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb21wYXJhdG9yIHVzZWQgdG8gcHV0IGZpZWxkIG1ldGFkYXRh\nIGludG8gbGlzdGluZyBvcmRlci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgTGlzdGluZ09yZGVyQ29tcGFyYXRvcgogICAgICAgIGltcGxl\nbWVudHMgQ29tcGFyYXRvcjxGaWVsZE1ldGFEYXRhPiB7CgogICAgICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExpc3RpbmdPcmRlckNvbXBhcmF0b3IgX2lu\nc3RhbmNlCiAgICAgICAgICAgID0gbmV3IExpc3RpbmdPcmRlckNvbXBhcmF0\nb3IoKTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQWNjZXNzIHNpbmdsZXRv\nbiBpbnN0YW5jZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgc3RhdGlj\nIExpc3RpbmdPcmRlckNvbXBhcmF0b3IgZ2V0SW5zdGFuY2UoKSB7CiAgICAg\nICAgICAgIHJldHVybiBfaW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgaW50IGNvbXBhcmUoRmllbGRNZXRhRGF0YSBmMSwgRmllbGRNZXRh\nRGF0YSBmMikgewogICAgICAgICAgICBpZiAoZjEgPT0gZjIpCiAgICAgICAg\nICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKGYxID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKGYy\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAg\nICAgICBpZiAoZjEuZ2V0TGlzdGluZ0luZGV4KCkgPT0gZjIuZ2V0TGlzdGlu\nZ0luZGV4KCkpIHsKICAgICAgICAgICAgICAgIGlmIChmMS5nZXRJbmRleCgp\nID09IGYyLmdldEluZGV4KCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGYxLmdldEZ1bGxOYW1lKGZhbHNlKS5jb21wYXJlVG8KICAgICAgICAgICAg\nICAgICAgICAgICAgKGYyLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgkJCQlpZiAo\nZjEuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJuIDE7CgkJCQlpZiAo\nZjIuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJuIC0xOwoJCQkJcmV0\ndXJuIGYxLmdldEluZGV4ICgpIC0gZjIuZ2V0SW5kZXggKCk7CgkJCX0JCgkJ\nCWlmIChmMS5nZXRMaXN0aW5nSW5kZXggKCkgPT0gLTEpCgkJCQlyZXR1cm4g\nMTsKCQkJaWYgKGYyLmdldExpc3RpbmdJbmRleCAoKSA9PSAtMSkKCQkJCXJl\ndHVybiAtMTsKCQkJcmV0dXJuIGYxLmdldExpc3RpbmdJbmRleCAoKSAtIGYy\nLmdldExpc3RpbmdJbmRleCAoKTsKCQl9Cgl9CiAgICAKICAgIHB1YmxpYyB2\nb2lkIHJlZ2lzdGVyRm9yVmFsdWVVcGRhdGUoU3RyaW5nLi4udmFsdWVzKSB7\nCiAgICAJaWYgKHZhbHVlcyA9PSBudWxsKQogICAgCQlyZXR1cm47CiAgICAJ\nZm9yIChTdHJpbmcga2V5IDogdmFsdWVzKSB7CiAgICAJCVZhbHVlIHZhbHVl\nID0gZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZpZ3VyYXRpb24oKQogICAgCQkJ\nLmdldFZhbHVlKGtleSk7CiAgICAJCWlmICh2YWx1ZSAhPSBudWxsKQogICAg\nCQkJdmFsdWUuYWRkTGlzdGVuZXIodGhpcyk7CiAgICAJfQogICAgfQogICAg\nCiAgICBwdWJsaWMgdm9pZCB2YWx1ZUNoYW5nZWQoVmFsdWUgdmFsKSB7CiAg\nICAJaWYgKHZhbCAhPSBudWxsICYmIHZhbC5tYXRjaGVzKCJEYXRhQ2FjaGVU\naW1lb3V0IikpIHsKICAgIAkJX2NhY2hlVGltZW91dCA9IEludGVnZXIuTUlO\nX1ZBTFVFOwogICAgCX0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBVdGls\naXR5IG1ldGhvZCB0byBnZXQgbmFtZXMgb2YgYWxsIGZpZWxkcyBpbmNsdWRp\nbmcgdGhlIHN1cGVyY2xhc3NlcycKICAgICAqIHNvcnRlZCBpbiBsZXhpY2Fs\nIG9yZGVyLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RmllbGRO\nYW1lcygpIHsKICAgIAlyZXR1cm4gdG9OYW1lcyhnZXRGaWVsZHMoKSk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogVXRpbGl0eSBtZXRob2QgdG8gZ2V0\nIG5hbWVzIG9mIGFsbCBkZWNsYXJlZCBmaWVsZHMgZXhjbHVkaW5nIHRoZSAK\nICAgICAqIHN1cGVyY2xhc3Nlcycgc29ydGVkIGluIGxleGljYWwgb3JkZXIu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREZWNsYXJlZEZpZWxk\nTmFtZXMoKSB7CiAgICAJcmV0dXJuIHRvTmFtZXMoZ2V0RGVjbGFyZWRGaWVs\nZHMoKSk7CiAgICB9CiAgICAKICAgIFN0cmluZ1tdIHRvTmFtZXMoRmllbGRN\nZXRhRGF0YVtdIGZpZWxkcykgewogICAgCUxpc3Q8U3RyaW5nPiByZXN1bHQg\nPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgIAlmb3IgKEZpZWxkTWV0\nYURhdGEgZm1kIDogZmllbGRzKSB7CiAgICAJCXJlc3VsdC5hZGQoZm1kLmdl\ndE5hbWUoKSk7CiAgICAJfQogICAgCUNvbGxlY3Rpb25zLnNvcnQocmVzdWx0\nKTsKICAgIAlyZXR1cm4gcmVzdWx0LnRvQXJyYXkobmV3IFN0cmluZ1tyZXN1\nbHQuc2l6ZSgpXSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJt\ncyB0aGUgcGVyc2lzdGVuY2UgaW5zdGFuY2VzIG9mIHRoaXMgcmVjZWl2ZXIg\naXMgcmVwbGljYXRlZCBhY3Jvc3MKICAgICAqIG11bHRpcGxlIGRhdGFiYXNl\ncy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNSZXBsaWNhdGVkKCkg\newogICAgCXJldHVybiBfcmVwbGljYXRlZDsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBTZXRzIHRoZSBwZXJzaXN0ZW5jZSBpbnN0YW5jZXMgb2YgdGhp\ncyByZWNlaXZlciB0byBiZSByZXBsaWNhdGVkIGFjcm9zcwogICAgICogbXVs\ndGlwbGUgZGF0YWJhc2VzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRS\nZXBsaWNhdGVkKGJvb2xlYW4gZmxhZykgewogICAgCV9yZXBsaWNhdGVkID0g\nZmxhZzsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Fic3RyYWN0KCkg\newogICAgICAgIHJldHVybiBfYWJzdHJhY3Q7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0QWJzdHJhY3QoYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgX2Fi\nc3RyYWN0ID0gZmxhZzsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWlu\nZSB3aGV0aGVyIHRoaXMgVHlwZSBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhl\nIERhdGFDYWNoZSAoaWYgb25lCiAgICAgKiBpcyBwcm92aWRlZCkgYmFzZWQg\nb24gdGhlIERhdGFDYWNoZSdzIGNvbmZpZ3VyYXRpb24uCiAgICAgKiAKICAg\nICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgRGF0YUNhY2hlIHdpbGwgYWNjZXB0\nIHRoaXMgdHlwZSwgb3RoZXJ3aXNlIGZhbHNlLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gaXNDb25maWd1cmVkRm9yQ2FjaGluZygpIHsKICAgICAg\nICBpZiAoX2lzQ2FjaGVhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9pc0NhY2hlYWJsZS5ib29sZWFuVmFsdWUoKTsKICAgICAgICB9Cgog\nICAgICAgIHNldElzQ2FjaGVhYmxlKHRydWUsIGZhbHNlKTsKICAgICAgICBy\nZXR1cm4gX2lzQ2FjaGVhYmxlLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogPHA+CiAgICAgKiBTZXQgd2hldGhlciBvciBub3QgdGhl\nIGNsYXNzIHJlcHJlc2VudGVkIGJ5IHRoaXMgQ2xhc3NNZXRhRGF0YSBvYmpl\nY3Qgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBkYXRhY2FjaGUuIFRoZQog\nICAgICogYXJndW1lbnRzIHByb3ZpZGVkIGFyZSAqaGludHMqIGFzIHRvIHdo\nZXRoZXIgdGhlIGNsYXNzIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgZGF0\nYWNhY2hlLCBhbmQgY2FuIGJlIG92ZXJyaWRkZW4KICAgICAqIGJ5IHRoZSBj\nb25maWd1cmF0aW9uIHNldCBpbiBvcGVuanBhLkRhdGFjYWNoZS4KICAgICAq\nIDwvcD4KICAgICAqIAogICAgICogPHA+CiAgICAgKiBSdWxlcyBmb3IgdGhp\ncyBkZXRlcm1pbmF0aW9uIGFyZToKICAgICAqIDwvcD4KICAgICAqIDxvbD4K\nICAgICAqIDxsaT5JZiB0aGUgY2xhc3Mgc2hvd3MgdXAgaW4gdGhlIGxpc3Qg\nb2YgZXhjbHVkZWQgdHlwZXMsIGl0IGRvZXMgbm90IGdldCBjYWNoZWQsIHBl\ncmlvZC48L2xpPgogICAgICogPGxpPklmIHRoZSBjbGFzcyBkb2VzIG5vdCBz\naG93IHVwIGluIHRoZSBleGNsdWRlZCB0eXBlcywgYnV0IHRoZSBpbmNsdWRl\nZCB0eXBlcyBmaWVsZCBpcyBzZXQgKGllLCBoYXMgYXQgbGVhc3QKICAgICAq\nIG9uZSBjbGFzcyksIHRoZW46CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+SWYg\ndGhlIGNsYXNzIGlzIGxpc3RlZCBpbiB0aGUgaW5jbHVkZSBsaXN0LCB0aGVu\nIGl0IGdldHMgY2FjaGVkPC9saT4KICAgICAqIDxsaT5JZiB0aGUgY2xhc3Mg\naXMgc2V0IGFzIGNhY2hlYWJsZSBieSB0aGUgQERhdGFjYWNoZSBhbm5vdGF0\naW9uLCBpdCBnZXRzIGNhY2hlZDwvbGk+CiAgICAgKiA8bGk+SWYgbmVpdGhl\nciBhIG9yIGIgYXJlIHRydWUsIHRoZW4gdGhlIGNsYXNzIGRvZXMgbm90IGdl\ndCBjYWNoZWQ8L2xpPgogICAgICogPC9vbD4KICAgICAqIDwvbGk+CiAgICAg\nKiA8bGk+SWYgbmVpdGhlciB0aGUgaW5jbHVkZSBvciBleGNsdWRlIGxpc3Rz\nIGFyZSBkZWZpbmVkLCB0aGVuIGdvIGFsb25nIHdpdGggdGhlIHZhbHVlIHBh\nc3NlZCBpbnRvIHRoZSBhcmd1bWVudCwKICAgICAqIHdoaWNoIGlzIGVpdGhl\nciB0aGUgZGVmYXVsdCB2YWx1ZSAodHJ1ZSkgb3Igd2hhdGV2ZXIgd2FzIHNl\ndCB3aXRoIHRoZSBARGF0YWNhY2hlIGFubm90YXRpb248L2xpPgogICAgICog\nPC9vbD4KICAgICAqIAogICAgICogQHBhcmFtIGlzQ2FjaGVhYmxlCiAgICAg\nKiAgICAgICAgICAgIEhpbnQgd2hldGhlciB0aGlzIGNsYXNzIHNob3VsZCBi\nZSBpbmNsdWRlZCBpbiB0aGUgZGF0YWNhY2hlLiBEZWZhdWx0IGJlaGF2aW9y\nIGlzIHllcywgdGhvdWdoIHRoZSAKICAgICAqICAgICAgICAgICAgQERhdGFj\nYWNoZSBhbm5vdGF0aW9uIGNhbiBzcGVjaWZ5IGlmIGl0IHNob3VsZCBub3Qg\nYmUgY2FjaGVkLgogICAgICogQHBhcmFtIGFubm90YXRpb25PdmVycmlkZQog\nICAgICogICAgICAgICAgICBXaGV0aGVyIHRoaXMgaGludCBvcmlnaW5hdGVk\nIGZyb20gdGhlIEBEYXRhY2FjaGUgYW5ub3RhdGlvbiBvciB3aGV0aGVyIHRo\naXMgaXMgdGhlIGRlZmF1bHQgInllcyIgaGludC4KICAgICAqICAgICAgICAg\nICAgVGhlIG9yaWdpbmF0aW9uIG9mIHRoZSBoaW50IGluZmx1ZW5jZXMgdGhl\nIGRlY2lzaW9uIG1ha2luZyBwcm9jZXNzIGluIHJ1bGUgIzJiLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRJc0NhY2hlYWJsZShib29sZWFuIGlzQ2Fj\naGVhYmxlLCBib29sZWFuIGFubm90YXRpb25PdmVycmlkZSkgewogICAgICAg\nIE9wdGlvbnMgZGF0YUNhY2hlT3B0aW9ucyA9IGdldERhdGFDYWNoZU9wdGlv\nbnMoKTsKICAgICAgICBTZXQgZXhjbHVkZWRUeXBlcyA9IGV4dHJhY3REYXRh\nQ2FjaGVDbGFzc0xpc3RpbmcoZGF0YUNhY2hlT3B0aW9ucy5nZXRQcm9wZXJ0\neSgiRXhjbHVkZWRUeXBlcyIsIG51bGwpKTsKICAgICAgICBTZXQgdHlwZXMg\nPSBleHRyYWN0RGF0YUNhY2hlQ2xhc3NMaXN0aW5nKGRhdGFDYWNoZU9wdGlv\nbnMuZ2V0UHJvcGVydHkoIlR5cGVzIiwgbnVsbCkpOwoKICAgICAgICBTdHJp\nbmcgY2xhc3NOYW1lID0gZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKTsK\nICAgICAgICBpZiAoZXhjbHVkZWRUeXBlcyAhPSBudWxsICYmIGV4Y2x1ZGVk\nVHlwZXMuY29udGFpbnMoY2xhc3NOYW1lKSkgewogICAgICAgICAgICAvLyBS\ndWxlICMxCiAgICAgICAgICAgIF9pc0NhY2hlYWJsZSA9IEJvb2xlYW4uRkFM\nU0U7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIFJ1bGUgIzIKICAgICAgICAgICAgaWYgKChhbm5vdGF0aW9u\nT3ZlcnJpZGUgJiYgaXNDYWNoZWFibGUpIHx8ICh0eXBlcy5jb250YWlucyhj\nbGFzc05hbWUpKSkgewogICAgICAgICAgICAgICAgX2lzQ2FjaGVhYmxlID0g\nQm9vbGVhbi5UUlVFOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgX2lzQ2FjaGVhYmxlID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFJ1bGUgIzMK\nICAgICAgICAgICAgX2lzQ2FjaGVhYmxlID0gaXNDYWNoZWFibGUgPyBCb29s\nZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEV4dHJhY3QgYWxsIG9mIHRoZSBEYXRhQ2FjaGUgcGx1\nZ2luIG9wdGlvbnMgZnJvbSB0aGUgY29uZmlndXJhdGlvbgogICAgICovCiAg\nICBwcml2YXRlIE9wdGlvbnMgZ2V0RGF0YUNhY2hlT3B0aW9ucygpIHsKICAg\nICAgICBTdHJpbmcgZGF0YUNhY2hlQ29uZmlnID0gZ2V0UmVwb3NpdG9yeSgp\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXREYXRhQ2FjaGUoKTsKICAgICAgICBP\ncHRpb25zIGRhdGFDYWNoZU9wdGlvbnMgPSBDb25maWd1cmF0aW9ucy5wYXJz\nZVByb3BlcnRpZXMoQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhkYXRh\nQ2FjaGVDb25maWcpKTsKICAgICAgICByZXR1cm4gZGF0YUNhY2hlT3B0aW9u\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFRvb2wgdG8gZXh0cmFjdCBjbGFz\nc2VzIGRlZmluZWQgaW4gdGhlIGRhdGFjYWNoZSBpbmNsdWRlIGFuZCBleGNs\ndWRlIGxpc3QgaW50byBpbmRpdmlkdWFsIGVudHJpZXMgaW4gYSBTZXQuCiAg\nICAgKi8KICAgIHByaXZhdGUgZmluYWwgU2V0IGV4dHJhY3REYXRhQ2FjaGVD\nbGFzc0xpc3RpbmcoU3RyaW5nIGNsYXNzTGlzdCkgewogICAgICAgIGlmIChj\nbGFzc0xpc3QgPT0gbnVsbCB8fCBjbGFzc0xpc3QubGVuZ3RoKCkgPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEhhc2hTZXQgcmV0\ndXJuU2V0ID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICBTdHJpbmdbXSBlbnRy\naWVzID0gY2xhc3NMaXN0LnNwbGl0KCI7Iik7CiAgICAgICAgZm9yIChpbnQg\naW5kZXggPSAwOyBpbmRleCA8IGVudHJpZXMubGVuZ3RoOyBpbmRleCsrKSB7\nCiAgICAgICAgICAgIHJldHVyblNldC5hZGQoZW50cmllc1tpbmRleF0pOwog\nICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldHVyblNldDsKICAgIH0KCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNDYWNoZWFibGUoU3RyaW5nIGNhbmRpZGF0\nZUNhY2hlTmFtZSkgeyAKICAgICAgICBib29sZWFuIHJ2YWw7CiAgICAgICAg\nc3dpdGNoKERhdGFDYWNoZU1vZGUudmFsdWVPZihfcmVwb3MuZ2V0Q29uZmln\ndXJhdGlvbigpLmdldERhdGFDYWNoZU1vZGUoKSkpIHsKICAgICAgICAgIGNh\nc2UgQUxMOgogICAgICAgICAgICAgIC8vIGluY2x1ZGUgZXZlcnl0aGluZywg\ncmVnYXJkbGVzcyBvZiBhbm5vdGF0aW9uIG9yIHhtbCBjb25maWd1cmF0aW9u\nCiAgICAgICAgICAgICAgcnZhbCA9IHRydWU7CiAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICBjYXNlIE5PTkU6CiAgICAgICAgICAgICAgLy8gZXhj\nbHVkZWQgZXZlcnl0aGluZywgcmVnYXJkbGVzcyBvZiBhbm5vdGF0aW9uIG9m\nIHhtbCBjb25maWd1cmF0aW9uCiAgICAgICAgICAgICAgcnZhbCA9IGZhbHNl\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBFTkFCTEVf\nU0VMRUNUSVZFOgogICAgICAgICAgICAgIC8vIGNhY2hlIG9ubHkgdGhvc2Ug\nZW50aXRpZXMgd2hpY2ggd2VyZSBzcGVjaWZpY2FsbHkgZW5hYmxlZAogICAg\nICAgICAgICAgIGlmKGdldENhY2hlRW5hYmxlZCgpID09IG51bGwpIHsgCiAg\nICAgICAgICAgICAgICAgIHJ2YWwgPSBmYWxzZTsgCiAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgIGVsc2UgeyAKICAgICAgICAgICAgICAgICAgcnZh\nbCA9IGdldENhY2hlRW5hYmxlZCgpOwogICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgRElTQUJMRV9TRUxFQ1RJ\nVkU6CiAgICAgICAgICAgICAgLy8gZXhjbHVkZSAqb25seSogdGhlIGVudGl0\naWVzIHdoaWNoIGFyZSBleHBsaWNpdGx5IGV4Y2x1ZGVkLiAKICAgICAgICAg\nICAgICBpZihnZXRDYWNoZUVuYWJsZWQoKSA9PSBudWxsKSB7IAogICAgICAg\nICAgICAgICAgICBydmFsID0gdHJ1ZTsgCiAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgIGVsc2UgeyAKICAgICAgICAgICAgICAgICAgcnZhbCA9IGdl\ndENhY2hlRW5hYmxlZCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgIGNhc2UgVU5TUEVDSUZJRUQ6CiAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgIC8vIGJlaGF2aW9yIGZyb20gcHJl\ndmlvdXMgcmVsZWFzZXMuIAogICAgICAgICAgICAgIHJ2YWwgPSBpc0NvbmZp\nZ3VyZWRGb3JDYWNoaW5nKCk7IAogICAgICB9CiAgICAgIHJldHVybiBydmFs\nOwogICAgICAgIAogICAgfQogICAgCiAgICAvKioKICAgICAqIENvbnZlbmll\nbmNlIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgdGhlIHBjVHlwZSBtb2RlbGVk\nIGJ5CiAgICAgKiB0aGlzIENsYXNzTWV0YURhdGEgb2JqZWN0IGlzIGJvdGgg\nYWJzdHJhY3QgYW5kIGRlY2xhcmVzIFBLRmllbGRzLiBUaGlzCiAgICAgKiBt\nZXRob2QgaXMgdXNlZCBieSB0aGUgUENFbmhhbmNlciB0byBkZXRlcm1pbmUg\naWYgc3BlY2lhbCBoYW5kbGluZyBpcwogICAgICogcmVxdWlyZWQuCiAgICAg\nKgogICAgICogQHJldHVybgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNBYnN0cmFjdFBLRmllbGQoKSB7CiAgICAgICAgaWYgKF9oYXNBYnN0cmFj\ndFBLRmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gX2hhc0Fi\nc3RyYWN0UEtGaWVsZC5ib29sZWFuVmFsdWUoKTsKICAgICAgICB9CgogICAg\nICAgIC8vIERlZmF1bHQgdG8gZmFsc2UsIHNldCB0byB0cnVlIG9ubHkgaWYg\ndGhpcyB0eXBlIGlzIGFic3RyYWN0IGFuZAogICAgICAgIC8vIGRlY2xhcmVz\nIGEgUEtGaWVsZC4KICAgICAgICBfaGFzQWJzdHJhY3RQS0ZpZWxkID0gQm9v\nbGVhbi5GQUxTRTsKCiAgICAgICAgaWYgKGlzQWJzdHJhY3QoKSA9PSB0cnVl\nKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBkZWNsYXJlZEZpZWxk\ncyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgIGlmIChkZWNs\nYXJlZEZpZWxkcyAhPSBudWxsICYmIGRlY2xhcmVkRmllbGRzLmxlbmd0aCAh\nPSAwKSB7CiAgICAgICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1k\nIDogZGVjbGFyZWRGaWVsZHMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nZm1kLmlzUHJpbWFyeUtleSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIF9oYXNBYnN0cmFjdFBLRmllbGQgPSBCb29sZWFuLlRSVUU7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcmV0dXJuIF9oYXNBYnN0cmFjdFBLRmllbGQuYm9vbGVhblZhbHVl\nKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0\naG9kIHRvIGRldGVybWluZSBpZiB0aGlzIHR5cGUgaXMgYSBkaXJlY3QKICAg\nICAqIGRlY2VuZGVudCBvZiBhbiBhYnN0cmFjdCB0eXBlIGRlY2xhcmluZyBQ\nS0ZpZWxkcy4gUmV0dXJucyB0cnVlIGlmIHRoZXJlCiAgICAgKiBhcmUgbm8g\ncGNUeXBlcyBtYXBwZWQgdG8gYSB0YWJsZSBiZXR3ZWVuIHRoaXMgdHlwZSBh\nbmQgYW4gYWJzdHJhY3QgcGNUeXBlCiAgICAgKiBkZWNsYXJpbmcgUEtGaWVs\nZHMuIFJldHVybnMgZmFsc2UgaWYgdGhlcmUgbm8gc3VjaCBhYnN0cmFjdCBw\nY1R5cGVzIGluCiAgICAgKiB0aGUgaW5oZXJpdGFuY2UgaGllcmFyY2h5IG9y\nIGlmIHRoZXJlIGFyZSBhbnkgcGNUeXBlcyBtYXBwZWQgdG8gdGFibGVzIGlu\nCiAgICAgKiBiZXR3ZWVuIHRoZSB0eXBlIHJlcHJlc2VudGVkIGJ5IHRoaXMg\nQ2xhc3NNZXRhRGF0YSBvYmplY3QgYW5kIHRoZQogICAgICogYWJzdHJhY3Qg\ncGNUeXBlIGRlY2xhcmluZyBQS0ZpZWxkcy4KICAgICAqCiAgICAgKiBAcmV0\ndXJuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGhhc1BLRmllbGRzRnJv\nbUFic3RyYWN0Q2xhc3MoKSB7CiAgICAgICAgaWYgKF9oYXNQS0ZpZWxkc0Zy\nb21BYnN0cmFjdENsYXNzICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNzLmJvb2xlYW5WYWx1ZSgp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gRGVmYXVsdCB0byBGQUxTRSwgdW50\naWwgcHJvdmVuIHRydWUuCiAgICAgICAgX2hhc1BLRmllbGRzRnJvbUFic3Ry\nYWN0Q2xhc3MgPSBCb29sZWFuLkZBTFNFOwoKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gcGtGaWVsZHMgPSBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAg\nICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IHBrRmllbGRzKSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgZm1kRE1EQSA9IGZtZC5nZXREZWNsYXJp\nbmdNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoZm1kRE1EQS5pc0Fic3Ry\nYWN0KCkpIHsKICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgY21kID0g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHdo\naWxlIChjbWQgIT0gZm1kRE1EQSkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChmbWRETURBLmlzQWJzdHJhY3QoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBjbWQgPSBjbWQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY21kID09IGZtZERNREEpIHsK\nICAgICAgICAgICAgICAgICAgICBfaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RD\nbGFzcyA9IEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgcmV0dXJuIF9oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNz\nLmJvb2xlYW5WYWx1ZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBz\nZXRDYWNoZUVuYWJsZWQoQm9vbGVhbiBlbmFibGVkKSB7IAogICAgICAgIF9j\nYWNoZUVuYWJsZWQgPSBlbmFibGVkOwogICAgfQogICAgCiAgICBwdWJsaWMg\nQm9vbGVhbiBnZXRDYWNoZUVuYWJsZWQoKSB7IAogICAgICAgIHJldHVybiBf\nY2FjaGVFbmFibGVkOwogICAgfQp9Cgo=\n","encoding":"base64"}

