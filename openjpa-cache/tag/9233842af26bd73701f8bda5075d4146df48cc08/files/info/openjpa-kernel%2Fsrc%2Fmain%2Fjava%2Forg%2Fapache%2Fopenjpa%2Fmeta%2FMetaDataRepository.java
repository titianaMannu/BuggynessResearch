{"sha":"a0a25ea18a989ed2d83758e832e2cc5f98017d4e","node_id":"MDQ6QmxvYjIwNjM2NDphMGEyNWVhMThhOTg5ZWQyZDgzNzU4ZTgzMmUyY2M1Zjk4MDE3ZDRl","size":79565,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a0a25ea18a989ed2d83758e832e2cc5f98017d4e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLlRyZWVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5sb2Nr\ncy5SZWVudHJhbnRMb2NrOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5EeW5hbWljUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2Fw\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVn\naXN0cnkuUmVnaXN0ZXJDbGFzc0xpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50TWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmFibGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5DbG9zZWFibGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxw\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxp\nemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk11bHRp\nQ2xhc3NMb2FkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKCmltcG9ydCBzZXJwLnV0aWwuU3Ry\naW5nczsKCi8qKgogKiBSZXBvc2l0b3J5IG9mIGFuZCBmYWN0b3J5IGZvciBw\nZXJzaXN0ZW50IG1ldGFkYXRhLgogKiAKICogQHNpbmNlIDAuMy4wCiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RldmUgS2ltIChxdWVyeSBt\nZXRhZGF0YSkKICovCkBTdXBwcmVzc1dhcm5pbmdzKCJzZXJpYWwiKQpwdWJs\naWMgY2xhc3MgTWV0YURhdGFSZXBvc2l0b3J5IGltcGxlbWVudHMgUENSZWdp\nc3RyeS5SZWdpc3RlckNsYXNzTGlzdGVuZXIsIENvbmZpZ3VyYWJsZSwgQ2xv\nc2VhYmxlLCBNZXRhRGF0YU1vZGVzLAogICAgU2VyaWFsaXphYmxlIHsKCiAg\nICAvKioKICAgICAqIENvbnN0YW50IHRvIG5vdCB2YWxpZGF0ZSBhbnkgbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZB\nTElEQVRFX05PTkUgPSAwOwoKICAgIC8qKgogICAgICogQml0IGZsYWcgdG8g\ndmFsaWRhdGUgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IFZBTElEQVRFX01FVEEgPSAxOwoKICAgIC8qKgogICAgICog\nQml0IGZsYWcgdG8gdmFsaWRhdGUgbWFwcGluZ3MuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IFZBTElEQVRFX01BUFBJTkcgPSAyOwoK\nICAgIC8qKgogICAgICogQml0IGZsYWcgdG8gdmFsaWRhdGUgdW5lbmhhbmNl\nZCBtZXRhZGF0YSBvbmx5LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBWQUxJREFURV9VTkVOSEFOQ0VEID0gNDsKCiAgICAvKioKICAg\nICAqIEJpdCBmbGFnIGZvciBydW50aW1lIHZhbGlkYXRpb24uIFJlcXVpcmVz\nIHRoYXQgYWxsIGNsYXNzZXMgYXJlIGVuaGFuY2VkLCBhbmQgcGVyZm9ybXMg\nZXh0cmEKICAgICAqIGZpZWxkIHJlc29sdXRpb24gc3RlcHMuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZBTElEQVRFX1JVTlRJTUUg\nPSA4OwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgQ2xhc3M8Pz5bXSBF\nTVBUWV9DTEFTU0VTID0gbmV3IENsYXNzWzBdOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBOb25QZXJzaXN0ZW50TWV0YURhdGFbXSBFTVBUWV9OT05f\nUEVSU0lTVEVOVCA9IG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGFbMF07CiAg\nICBwcm90ZWN0ZWQgZmluYWwgQ2xhc3NNZXRhRGF0YVtdIEVNUFRZX01FVEFT\nOwogICAgcHJvdGVjdGVkIGZpbmFsIEZpZWxkTWV0YURhdGFbXSBFTVBUWV9G\nSUVMRFM7CiAgICBwcm90ZWN0ZWQgZmluYWwgT3JkZXJbXSBFTVBUWV9PUkRF\nUlM7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2Mg\nPSBMb2NhbGl6ZXIuZm9yUGFja2FnZShNZXRhRGF0YVJlcG9zaXRvcnkuY2xh\nc3MpOwoKICAgIC8vIHN5c3RlbSBzZXF1ZW5jZQogICAgcHJpdmF0ZSBTZXF1\nZW5jZU1ldGFEYXRhIF9zeXNTZXEgPSBudWxsOwogICAgLy8gY2FjaGUgb2Yg\ncGFyc2VkIG1ldGFkYXRhLCBvaWQgY2xhc3MgdG8gY2xhc3MsIGFuZCBpbnRl\ncmZhY2UgY2xhc3MKICAgIC8vIHRvIG1ldGFkYXRhcwogICAgcHJpdmF0ZSBN\nYXA8Q2xhc3M8Pz4sIENsYXNzTWV0YURhdGE+IF9tZXRhcyA9IG5ldyBIYXNo\nTWFwPENsYXNzPD8+LCBDbGFzc01ldGFEYXRhPigpOwogICAgcHJpdmF0ZSBN\nYXA8Q2xhc3M8Pz4sIENsYXNzPD8+PiBfb2lkcyA9IENvbGxlY3Rpb25zLnN5\nbmNocm9uaXplZE1hcChuZXcgSGFzaE1hcDxDbGFzczw/PiwgQ2xhc3M8Pz4+\nKCkpOwogICAgcHJpdmF0ZSBNYXA8Q2xhc3M8Pz4sIENvbGxlY3Rpb248Q2xh\nc3M8Pz4+PiBfaW1wbHMgPQogICAgICAgIENvbGxlY3Rpb25zLnN5bmNocm9u\naXplZE1hcChuZXcgSGFzaE1hcDxDbGFzczw/PiwgQ29sbGVjdGlvbjxDbGFz\nczw/Pj4+KCkpOwogICAgcHJpdmF0ZSBNYXA8Q2xhc3M8Pz4sIENsYXNzPD8+\nPiBfaWZhY2VzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBI\nYXNoTWFwPENsYXNzPD8+LCBDbGFzczw/Pj4oKSk7CiAgICBwcml2YXRlIE1h\ncDxPYmplY3QsIFF1ZXJ5TWV0YURhdGE+IF9xdWVyaWVzID0gbmV3IEhhc2hN\nYXA8T2JqZWN0LCBRdWVyeU1ldGFEYXRhPigpOwogICAgcHJpdmF0ZSBNYXA8\nU3RyaW5nLCBTZXF1ZW5jZU1ldGFEYXRhPiBfc2VxcyA9IG5ldyBIYXNoTWFw\nPFN0cmluZywgU2VxdWVuY2VNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFw\nPFN0cmluZywgTGlzdDxDbGFzczw/Pj4+IF9hbGlhc2VzID0gQ29sbGVjdGlv\nbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwPFN0cmluZywgTGlzdDxD\nbGFzczw/Pj4+KCkpOwogICAgcHJpdmF0ZSBNYXA8Q2xhc3M8Pz4sIE5vblBl\ncnNpc3RlbnRNZXRhRGF0YT4gX3Bhd2FyZXMgPQogICAgICAgIENvbGxlY3Rp\nb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcDxDbGFzczw/PiwgTm9u\nUGVyc2lzdGVudE1ldGFEYXRhPigpKTsKICAgIHByaXZhdGUgTWFwPENsYXNz\nPD8+LCBOb25QZXJzaXN0ZW50TWV0YURhdGE+IF9ub25NYXBwZWQgPQogICAg\nICAgIENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcDxD\nbGFzczw/PiwgTm9uUGVyc2lzdGVudE1ldGFEYXRhPigpKTsKICAgIHByaXZh\ndGUgTWFwPENsYXNzPD8+LCBDbGFzczw/Pj4gX21ldGFtb2RlbCA9IENvbGxl\nY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcDxDbGFzczw/Piwg\nQ2xhc3M8Pz4+KCkpOwoKICAgIC8vIG1hcCBvZiBjbGFzc2VzIHRvIGxpc3Rz\nIG9mIHRoZWlyIHN1YmNsYXNzZXMKICAgIHByaXZhdGUgTWFwPENsYXNzPD8+\nLCBMaXN0PENsYXNzPD8+Pj4gX3N1YnMgPSBDb2xsZWN0aW9ucy5zeW5jaHJv\nbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIExpc3Q8Q2xhc3M8Pz4+\nPigpKTsKCiAgICAvLyB4bWwgbWFwcGluZwogICAgcHJvdGVjdGVkIGZpbmFs\nIFhNTE1ldGFEYXRhW10gRU1QVFlfWE1MTUVUQVM7CiAgICBwcml2YXRlIGZp\nbmFsIE1hcDxDbGFzczw/PiwgWE1MTWV0YURhdGE+IF94bWxtZXRhcyA9IG5l\ndyBIYXNoTWFwPENsYXNzPD8+LCBYTUxNZXRhRGF0YT4oKTsKCiAgICBwcml2\nYXRlIHRyYW5zaWVudCBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9IG51\nbGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBMb2cgX2xvZyA9IG51bGw7CiAg\nICBwcml2YXRlIHRyYW5zaWVudCBJbnRlcmZhY2VJbXBsR2VuZXJhdG9yIF9p\nbXBsR2VuID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IE1ldGFEYXRh\nRmFjdG9yeSBfZmFjdG9yeSA9IG51bGw7CgogICAgcHJpdmF0ZSBpbnQgX3Jl\nc01vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkc7CiAgICBwcml2YXRl\nIGludCBfc291cmNlTW9kZSA9IE1PREVfTUVUQSB8IE1PREVfTUFQUElORyB8\nIE1PREVfUVVFUlk7CiAgICBwcml2YXRlIGludCBfdmFsaWRhdGUgPSBWQUxJ\nREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDsKCiAgICAvLyB3ZSBi\ndWZmZXIgdXAgYW55IGNsYXNzZXMgdGhhdCByZWdpc3RlciB0aGVtc2VsdmVz\nIHRvIHByZXZlbnQKICAgIC8vIHJlZW50cmFuY3kgZXJyb3JzIGlmIGNsYXNz\nZXMgcmVnaXN0ZXIgZHVyaW5nIGEgY3VycmVudCBwYXJzZSAoY29tbW9uKQog\nICAgcHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uPENsYXNzPD8+PiBfcmVnaXN0\nZXJlZCA9IG5ldyBIYXNoU2V0PENsYXNzPD8+PigpOwoKICAgIC8vIHNldCBv\nZiBtZXRhZGF0YXMgd2UncmUgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2aW5n\nCiAgICBwcml2YXRlIGZpbmFsIEluaGVyaXRhbmNlT3JkZXJlZE1ldGFEYXRh\nTGlzdCBfcmVzb2x2aW5nID0gbmV3IEluaGVyaXRhbmNlT3JkZXJlZE1ldGFE\nYXRhTGlzdCgpOwogICAgcHJpdmF0ZSBmaW5hbCBJbmhlcml0YW5jZU9yZGVy\nZWRNZXRhRGF0YUxpc3QgX21hcHBpbmcgPSBuZXcgSW5oZXJpdGFuY2VPcmRl\ncmVkTWV0YURhdGFMaXN0KCk7CiAgICBwcml2YXRlIGZpbmFsIExpc3Q8UnVu\ndGltZUV4Y2VwdGlvbj4gX2VycnMgPSBuZXcgTGlua2VkTGlzdDxSdW50aW1l\nRXhjZXB0aW9uPigpOwoKICAgIC8vIHN5c3RlbSBsaXN0ZW5lcnMKICAgIHBy\naXZhdGUgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBfbGlz\ndGVuZXJzID0gbmV3IExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxp\nc3QoMyk7CgogICAgcHJpdmF0ZSBSZWVudHJhbnRMb2NrIF9sb2NrID0gbnVs\nbDsKICAgIHByb3RlY3RlZCBib29sZWFuIF9wcmVsb2FkID0gZmFsc2U7CiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBfbm9Mb2NrID0gZmFsc2U7CgogICAgLyoq\nCiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLiBDb25maWd1cmUgdmlhIHtA\nbGluayBDb25maWd1cmFibGV9LgogICAgICovCiAgICBwdWJsaWMgTWV0YURh\ndGFSZXBvc2l0b3J5KCkgewogICAgICAgIEVNUFRZX01FVEFTID0gbmV3Q2xh\nc3NNZXRhRGF0YUFycmF5KDApOwogICAgICAgIEVNUFRZX0ZJRUxEUyA9IG5l\nd0ZpZWxkTWV0YURhdGFBcnJheSgwKTsKICAgICAgICBFTVBUWV9PUkRFUlMg\nPSBuZXdPcmRlckFycmF5KDApOwogICAgICAgIEVNUFRZX1hNTE1FVEFTID0g\nbmV3WE1MQ2xhc3NNZXRhRGF0YUFycmF5KDApOwogICAgICAgIAogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25maWd1cmF0aW9uIGZvciB0\naGUgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFDb25m\naWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJu\nIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRh\nZGF0YSBsb2cuCiAgICAgKi8KICAgIHB1YmxpYyBMb2cgZ2V0TG9nKCkgewog\nICAgICAgIHJldHVybiBfbG9nOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIEkvTyB1c2VkIHRvIGxvYWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1Ymxp\nYyBNZXRhRGF0YUZhY3RvcnkgZ2V0TWV0YURhdGFGYWN0b3J5KCkgewogICAg\nICAgIHJldHVybiBfZmFjdG9yeTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBJL08gdXNlZCB0byBsb2FkIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRNZXRhRGF0YUZhY3RvcnkoTWV0YURhdGFGYWN0b3J5IGZh\nY3RvcnkpIHsKICAgICAgICBmYWN0b3J5LnNldFJlcG9zaXRvcnkodGhpcyk7\nCiAgICAgICAgX2ZhY3RvcnkgPSBmYWN0b3J5OwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1bHRz\nIHRvIDxjb2RlPlZBTElEQVRFX01FVEEgfCBWQUxJREFURV9VTkVOSEFOQ0VE\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIGludCBnZXRWYWxpZGF0ZSgp\nIHsKICAgICAgICByZXR1cm4gX3ZhbGlkYXRlOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1bHRz\nIHRvIDxjb2RlPlZBTElEQVRFX01FVEEgfCBWQUxJREFURV9VTkVOSEFOQ0VE\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VmFsaWRhdGUo\naW50IHZhbGlkYXRlKSB7CiAgICAgICAgX3ZhbGlkYXRlID0gdmFsaWRhdGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgdmFsaWRhdGlv\nbiBsZXZlbC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPlZBTElEQVRFX01F\nVEEgfCBWQUxJREFURV9NQVBQSU5HIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwv\nY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFZhbGlkYXRlKGlu\ndCB2YWxpZGF0ZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmICh2YWxpZGF0\nZSA9PSBWQUxJREFURV9OT05FKQogICAgICAgICAgICBfdmFsaWRhdGUgPSB2\nYWxpZGF0ZTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX3Zh\nbGlkYXRlIHw9IHZhbGlkYXRlOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nX3ZhbGlkYXRlICY9IH52YWxpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBtZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERlZmF1bHRzIHRvIDxj\nb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQUElORzwvY29kZT4uCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0UmVzb2x2ZSgpIHsKICAgICAgICByZXR1cm4g\nX3Jlc01vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEg\ncmVzb2x1dGlvbiBtb2RlLiBEZWZhdWx0cyB0byA8Y29kZT5NT0RFX01FVEEg\nfCBNT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRSZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgX3Jlc01vZGUgPSBt\nb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHJlc29s\ndXRpb24gbW9kZS4gRGVmYXVsdHMgdG8gPGNvZGU+TU9ERV9NRVRBIHwgTU9E\nRV9NQVBQSU5HPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nUmVzb2x2ZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmICht\nb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX3Jlc01vZGUgPSBtb2Rl\nOwogICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfcmVzTW9kZSB8\nPSBtb2RlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3Jlc01vZGUgJj0g\nfm1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUg\nZGV0ZXJtaW5pbmcgd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0\nbwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9E\nRV9RVUVSWTwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0U291\ncmNlTW9kZSgpIHsKICAgICAgICByZXR1cm4gX3NvdXJjZU1vZGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZGV0ZXJtaW5pbmcg\nd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0bwogICAgICogPGNv\nZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVSWTwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZU1vZGUoaW50\nIG1vZGUpIHsKICAgICAgICBfc291cmNlTW9kZSA9IG1vZGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZGV0ZXJtaW5pbmcgd2hh\ndCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+\nTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVSWTwvY29kZT4u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZU1vZGUoaW50IG1v\nZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05P\nTkUpCiAgICAgICAgICAgIF9zb3VyY2VNb2RlID0gbW9kZTsKICAgICAgICBl\nbHNlIGlmIChvbikKICAgICAgICAgICAgX3NvdXJjZU1vZGUgfD0gbW9kZTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zb3VyY2VNb2RlICY9IH5tb2Rl\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB3aGV0aGVyIHRoaXMgcmVw\nb3NpdG9yeSB3aWxsIGxvYWQgYWxsIGtub3duIHBlcnNpc3RlbnQgY2xhc3Nl\ncyBhdCBpbml0aWFsaXphdGlvbi4KICAgICAqIERlZmF1bHRzIHRvIGZhbHNl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRQcmVsb2FkKCkgewog\nICAgICAgIHJldHVybiBfcHJlbG9hZDsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBTZXRzIHdoZXRoZXIgdGhpcyByZXBvc2l0b3J5IHdpbGwgbG9hZCBh\nbGwga25vd24gcGVyc2lzdGVudCBjbGFzc2VzIGF0IGluaXRpYWxpemF0aW9u\nLgogICAgICogRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFByZWxvYWQoYm9vbGVhbiBsKSB7CiAgICAgICAgX3ByZWxv\nYWQgPSBsOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB3aGV0aGVyIHRo\naXMgcmVwb3NpdG9yeSB3aWxsIHVzZSB1bmd1YXJkZWQgYWNjZXNzLiBVbmd1\nYXJkZWQgYWNjZXNzCiAgICAgKiBjYW4gYmUgc2FmZSBpZiBhbGwgbWV0YWRh\ndGEgaGFzIGJlZW4gbG9hZGVkIGF0IGluaXRpYWxpemF0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXROb0xvY2soYm9vbGVhbiBsKSB7CiAgICAg\nICAgX25vTG9jayA9IGw7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZm\naXJtcyB3aGV0aGVyIHRoaXMgcmVwb3NpdG9yeSB3aWxsIHVzZSB1bmd1YXJk\nZWQgYWNjZXNzLiBVbmd1YXJkZWQgYWNjZXNzCiAgICAgKiBjYW4gYmUgc2Fm\nZSBpZiBhbGwgbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVkIGF0IGluaXRpYWxp\nemF0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb0xvY2so\nKSB7CiAgICAgICAgcmV0dXJuIF9ub0xvY2s7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBMb2FkcyBhbGwgdGhlIGtub3duIHBlcnNpc3RlbnQgY2xhc3NlcyBp\nZiB7QGxpbmtwbGFpbiAjc2V0UHJlbG9hZChib29sZWFuKSBlYXJseSBsb2Fk\naW5nfSAKICAgICAqIGluaXRpYWxpemF0aW9uIGhhcyBiZWVuIHNldC4gVGhl\nIGNvbmZpZ3VyYXRpb24gbXVzdCBlbmxpc3QgYWxsIGNsYXNzZXMuCiAgICAg\nKiAKICAgICAqIDxicj4KICAgICAqIElmIHtAbGlua3BsYWluICNzZXROb0xv\nY2soYm9vbGVhbikgbm8gbG9ja30gaGFzIGJlZW4gc2V0IHRoZW4gdXNlcyB1\nbmd1YXJkZWQgYWNjZXNzIHRvCiAgICAgKiBhbGwgaW50ZXJuYWwgZGF0YSBj\nb250YWluZXIgc3RydWN0dXJlcy4KICAgICAqIElmIHRoZSBvcGVuanBhLk1l\ndGFEYXRhUmVwb3NpdG9yeSBwbHVnaW4gdmFsdWUgcHJlbG9hZD1mYWxzZSBp\ncyBzZXQsIHRoaXMgbWV0aG9kIHdpbGwgbm9vcC4KICAgICAqIDxwPgogICAg\nICogTk9URSA6IFRoaXMgbWV0aG9kIGlzIG5vdCB0aHJlYWQgc2FmZSBhbmQg\nc2hvdWxkIE9OTFkgYmUgY2FsbGVkIGJ5IFBlcnNpc3RlbmNlUHJvdmlkZXJJ\nbXBsLgogICAgICogCiAgICAgKiBAc2VlICNnZXRQZXJzaXN0ZW50VHlwZU5h\nbWVzKGJvb2xlYW4sIENsYXNzTG9hZGVyKQogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBwcmVsb2FkKCkgewogICAgICAgIGlmICghX3ByZWxvYWQpIHsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoX2xvZy5p\nc0luZm9FbmFibGVkKCkpIHsKICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2Mu\nZ2V0KF9ub0xvY2sgPyAicmVwb3MtcHJlbG9hZCIgOiAicmVwb3MtcHJlbG9h\nZC1ub2xvY2siKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBSZW1vdmUgbG9j\na2luZyBhbmQgdXNlIHVuc3luY2hyb25pemVkIG1hcHMuCiAgICAgICAgaWYg\nKF9ub0xvY2sgPT0gdHJ1ZSkgewogICAgICAgICAgICBfb2lkcyA9IG5ldyBI\nYXNoTWFwPENsYXNzPD8+LCBDbGFzczw/Pj4oKTsKICAgICAgICAgICAgX2lt\ncGxzID0gbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENvbGxlY3Rpb248Q2xhc3M8\nPz4+PigpOwogICAgICAgICAgICBfaWZhY2VzID0gbmV3IEhhc2hNYXA8Q2xh\nc3M8Pz4sIENsYXNzPD8+PigpOwogICAgICAgICAgICBfYWxpYXNlcyA9IG5l\ndyBIYXNoTWFwPFN0cmluZywgTGlzdDxDbGFzczw/Pj4+KCk7CiAgICAgICAg\nICAgIF9wYXdhcmVzID0gbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE5vblBlcnNp\nc3RlbnRNZXRhRGF0YT4oKTsKICAgICAgICAgICAgX25vbk1hcHBlZCA9IG5l\ndyBIYXNoTWFwPENsYXNzPD8+LCBOb25QZXJzaXN0ZW50TWV0YURhdGE+KCk7\nCiAgICAgICAgICAgIF9zdWJzID0gbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIExp\nc3Q8Q2xhc3M8Pz4+PigpOwogICAgICAgICAgICBfbWV0YW1vZGVsID0gbmV3\nIEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNzPD8+PigpOwoKICAgICAgICAgICAg\nX2xvY2sgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgTXVsdGlDbGFzc0xv\nYWRlciBtdWx0aSA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoy\nRG9Qcml2SGVscGVyLm5ld011bHRpQ2xhc3NMb2FkZXJBY3Rpb24oKSk7CiAg\nICAgICAgbXVsdGkuYWRkQ2xhc3NMb2FkZXIoQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIuZ2V0Q29udGV4dENsYXNzTG9h\nZGVyQWN0aW9uKCkpKTsKICAgICAgICBtdWx0aS5hZGRDbGFzc0xvYWRlcihB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgog\nICAgICAgICAgICAgLmdldENsYXNzTG9hZGVyQWN0aW9uKE1ldGFEYXRhUmVw\nb3NpdG9yeS5jbGFzcykpKTsKCiAgICAgICAgU2V0PFN0cmluZz4gY2xhc3Nl\ncyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIG11bHRpKTsKICAg\nICAgICBpZiAoY2xhc3NlcyA9PSBudWxsIHx8IGNsYXNzZXMuc2l6ZSgpID09\nIDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJyZXBvcy1wcmVsb2FkLW5vbmUiKSk7CiAgICAgICAgfQog\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgX2xvZy50cmFjZShfbG9jLmdldCgicmVwb3MtcHJlbG9hZGluZyIsIHRo\naXMuZ2V0Q2xhc3MoKS5nZXROYW1lKCksIGNsYXNzZXMudG9TdHJpbmcoKSkp\nOwogICAgICAgIH0KCiAgICAgICAgZm9yIChTdHJpbmcgYyA6IGNsYXNzZXMp\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIENsYXNzPD8+\nIGNscyA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKChKMkRvUHJp\ndkhlbHBlci5nZXRGb3JOYW1lQWN0aW9uKGMsIHRydWUsIG11bHRpKSkpOwog\nICAgICAgICAgICAgICAgX2ZhY3RvcnkubG9hZChjbHMsIE1PREVfQUxMLCBt\ndWx0aSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24gcGFlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInJlcG9zLXByZWxvYWQtZXJyb3Ii\nKSwgcGFlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBsb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgdW5sb2NrKCkgewogICAgICAgIGlm\nIChfbG9jayAhPSBudWxsKSB7CiAgICAgICAgICAgIF9sb2NrLnVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqIAogICAgICog\nQHBhcmFtIGNscwogICAgICogICAgICAgICAgICB0aGUgY2xhc3MgdG8gcmV0\ncmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyCiAg\nICAgKiAgICAgICAgICAgIHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRl\nciwgaWYgYW55CiAgICAgKiBAcGFyYW0gbXVzdEV4aXN0CiAgICAgKiAgICAg\nICAgICAgIGlmIHRydWUsIHRocm93cyBhIHtAbGluayBNZXRhRGF0YUV4Y2Vw\ndGlvbn0gaWYgbm8gbWV0YWRhdGEgaXMgZm91bmQKICAgICAqLwogICAgcHVi\nbGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoQ2xhc3MgY2xzLCBDbGFz\nc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjbHMg\nIT0gbnVsbCAmJiBEeW5hbWljUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAgICAgICAgIGNscyA9IGNs\ncy5nZXRTdXBlcmNsYXNzKCk7CgogICAgICAgICAgICAvLyBpZiBjbHMgaXMg\nYSBnZW5lcmF0ZWQgaW50ZXJmYWNlLCB1c2UgdGhlIHVzZXIgaW50ZXJmYWNl\nCiAgICAgICAgICAgIC8vIHRvIGxvY2F0ZSBtZXRhZGF0YQogICAgICAgICAg\nICBpZiAoY2xzICE9IG51bGwgJiYgX2ltcGxHZW4uaXNJbXBsVHlwZShjbHMp\nKQogICAgICAgICAgICAgICAgY2xzID0gX2ltcGxHZW4udG9NYW5hZ2VkSW50\nZXJmYWNlKGNscyk7CgogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEg\nPSBnZXRNZXRhRGF0YUludGVybmFsKGNscywgZW52TG9hZGVyKTsKICAgICAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhpc3QpIHsKICAgICAg\nICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiAhSW1wbEhlbHBlci5pc01h\nbmFnZWRUeXBlKF9jb25mLCBjbHMpKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YS1u\nb3RwYyIsIGNscykpLnNldEZhdGFsKGZhbHNlKTsKCiAgICAgICAgICAgICAg\nICBTZXQ8U3RyaW5nPiBwY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1l\ncyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICAgICAgICAgIGlmIChwY05h\nbWVzICE9IG51bGwgJiYgcGNOYW1lcy5zaXplKCkgPiAwKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tbWV0YS10eXBlcyIsIGNscywgcGNOYW1lcykpOwoKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tbWV0YSIsIGNscykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\nc29sdmUobWV0YSk7CiAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9y\nIHRoZSBnaXZlbiBhbGlhcyBuYW1lLgogICAgICogCiAgICAgKiBAcGFyYW0g\nYWxpYXMKICAgICAqICAgICAgICAgICAgdGhlIGFsaWFzIHRvIGNsYXNzIHRv\nIHJldHJpZXZlIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRl\ncgogICAgICogICAgICAgICAgICB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBs\nb2FkZXIsIGlmIGFueQogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICog\nICAgICAgICAgICBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFF\neGNlcHRpb259IGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKiBAc2Vl\nIENsYXNzTWV0YURhdGEjZ2V0VHlwZUFsaWFzCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKFN0cmluZyBhbGlhcywgQ2xh\nc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAg\nICAgIGlmIChhbGlhcyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1h\nbGlhcy1tZXRhIiwgYWxpYXMsIF9hbGlhc2VzKSk7CiAgICAgICAgaWYgKGFs\naWFzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAvLyBjaGVjayBjYWNoZQogICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xh\nc3NlcyhlbnZMb2FkZXIpOwogICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGNsYXNz\nTGlzdCA9IF9hbGlhc2VzLmdldChhbGlhcyk7CgogICAgICAgIC8vIG11bHRp\ncGxlIGNsYXNzZXMgbWF5IGhhdmUgYmVlbiBkZWZpbmVkIHdpdGggdGhlIHNh\nbWUgYWxpYXM6IHdlCiAgICAgICAgLy8gd2lsbCBmaWx0ZXIgYnkgY2hlY2tp\nbmcgYWdhaW5zdCB0aGUgY3VycmVudCBsaXN0IG9mIHRoZQogICAgICAgIC8v\nIHBlcnNpc3RlbnQgdHlwZXMgYW5kIGZpbHRlciBiYXNlZCBvbiB3aGljaCBj\nbGFzc2VzIGFyZSBsb2FkYWJsZQogICAgICAgIC8vIHZpYSB0aGUgY3VycmVu\ndCBlbnZpcm9ubWVudCdzIENsYXNzTG9hZGVyCiAgICAgICAgU2V0PFN0cmlu\nZz4gcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVu\ndkxvYWRlcik7CiAgICAgICAgQ2xhc3M8Pz4gY2xzID0gbnVsbDsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgY2xhc3NMaXN0ICE9IG51bGwgJiYgaSA8IGNs\nYXNzTGlzdC5zaXplKCk7IGkrKykgewogICAgICAgICAgICBDbGFzczw/PiBj\nID0gY2xhc3NMaXN0LmdldChpKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIC8vIHJlLWxvYWQgdGhlIGNsYXNzIGluIHRoZSBjdXJyZW50\nIGVudmlyb25tZW50IGxvYWRlciBzbwogICAgICAgICAgICAgICAgLy8gdGhh\ndCB3ZSBjYW4gaGFuZGxlIHJlZGVwbG95bWVudCBvZiB0aGUgc2FtZSBjbGFz\ncyBuYW1lCiAgICAgICAgICAgICAgICBDbGFzczw/PiBuYyA9IENsYXNzLmZv\nck5hbWUoYy5nZXROYW1lKCksIGZhbHNlLCBlbnZMb2FkZXIpOwoKICAgICAg\nICAgICAgICAgIC8vIGlmIHdlIGhhdmUgc3BlY2lmaWVkIGEgbGlzdCBvZiBw\nZXJzaXN0ZW50IGNsYXNlcywKICAgICAgICAgICAgICAgIC8vIGFsc28gY2hl\nY2sgdG8gZW5zdXJlIHRoYXQgdGhlIGNsYXNzIGlzIGluIHRoYXQgbGlzdAog\nICAgICAgICAgICAgICAgaWYgKHBjTmFtZXMgPT0gbnVsbCB8fCBwY05hbWVz\nLnNpemUoKSA9PSAwIHx8IHBjTmFtZXMuY29udGFpbnMobmMuZ2V0TmFtZSgp\nKSkgewogICAgICAgICAgICAgICAgICAgIGNscyA9IG5jOwogICAgICAgICAg\nICAgICAgICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNsYXNzTGlzdC5hZGQoY2xzKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAg\nIC8vIHRoaXMgaGFwcGVucyB3aGVuIHRoZSBjbGFzcyBpcyBub3QgbG9hZGFi\nbGUgYnkKICAgICAgICAgICAgICAgIC8vIHRoZSBlbnZpcm9ubWVudCBjbGFz\ncyBsb2FkZXIsIHNvIGl0IHdhcyBwcm9iYWJseQogICAgICAgICAgICAgICAg\nLy8gbGlzdGVkIGVsc2V3aGVyZTsgYWxzbyBpZ25vcmUgbGlua2FnZSBmYWls\ndXJlcyBhbmQKICAgICAgICAgICAgICAgIC8vIG90aGVyIGNsYXNzIGxvYWRp\nbmcgcHJvYmxlbXMKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBp\nZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0\nYShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKCiAgICAgICAgLy8gbWF5\nYmUgdGhpcyBpcyBzb21lIHR5cGUgd2UndmUgc2VlbiBidXQganVzdCBpc24n\ndCB2YWxpZAogICAgICAgIGlmIChfYWxpYXNlcy5jb250YWluc0tleShhbGlh\ncykpIHsKICAgICAgICAgICAgaWYgKG11c3RFeGlzdCkKICAgICAgICAgICAg\nICAgIHRocm93Tm9SZWdpc3RlcmVkQWxpYXMoYWxpYXMpOwogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFdlIG5lZWQg\ndG8gc3luY2hyb25pemUgb24gX2FsaWFzZXMgYmVjYXVzZSBhIENvbmN1cnJl\nbnRNb2RpZmljYXRpb25FeGNlcHRpb24gY2FuIGlmIHRoZXJlCiAgICAgICAg\nLy8gaXMgYSB0aHJlYWQgaW4gZ2V0QWxpYXNOYW1lcygpIEFORCB0aGlzIGNs\nYXNzIGlzbid0IHVzaW5nIGFueSBsb2NraW5nLgogICAgICAgIHN5bmNocm9u\naXplZCAoX2FsaWFzZXMpIHsKICAgICAgICAgICAgLy8gcmVjb3JkIHRoYXQg\ndGhpcyBpcyBhbiBpbnZhbGlkIHR5cGUKICAgICAgICAgICAgX2FsaWFzZXMu\ncHV0KGFsaWFzLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGlmICghbXVz\ndEV4aXN0KQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gdGhyb3dOb1JlZ2lzdGVyZWRBbGlhcyhhbGlhcyk7CiAgICB9CgogICAg\ncHJpdmF0ZSBDbGFzc01ldGFEYXRhIHRocm93Tm9SZWdpc3RlcmVkQWxpYXMo\nU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgU3RyaW5nIGNsb3NlID0gZ2V0Q2xv\nc2VzdEFsaWFzTmFtZShhbGlhcyk7CiAgICAgICAgaWYgKGNsb3NlICE9IG51\nbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tYWxpYXMtbWV0YS1oaW50IiwgYWxpYXMsIF9hbGlhc2Vz\nLCBjbG9zZSkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwg\nYWxpYXMsIF9hbGlhc2VzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0\ndXJuIHRoZSBuZWFyZXN0IG1hdGNoIHRvIHRoZSBzcGVjaWZpZWQgYWxpYXMg\nbmFtZQogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0Q2xvc2VzdEFsaWFzTmFtZShTdHJpbmcgYWxpYXMpIHsKICAg\nICAgICBDb2xsZWN0aW9uPFN0cmluZz4gYWxpYXNlcyA9IGdldEFsaWFzTmFt\nZXMoKTsKICAgICAgICByZXR1cm4gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2Vz\ndExldmVuc2h0ZWluRGlzdGFuY2UoYWxpYXMsIGFsaWFzZXMpOwogICAgfQoK\nICAgIC8qKgogICAgICogQHJldHVybiB0aGUgcmVnaXN0ZXJlZCBhbGlhcyBu\nYW1lcwogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBD\nb2xsZWN0aW9uPFN0cmluZz4gZ2V0QWxpYXNOYW1lcygpIHsKICAgICAgICBD\nb2xsZWN0aW9uPFN0cmluZz4gYWxpYXNlcyA9IG5ldyBIYXNoU2V0PFN0cmlu\nZz4oKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9hbGlhc2VzKSB7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3I8TWFwLkVudHJ5PFN0cmluZywgTGlzdDxD\nbGFzczw/Pj4+PiBpdGVyID0gX2FsaWFzZXMuZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIE1hcC5F\nbnRyeTxTdHJpbmcsIExpc3Q8Q2xhc3M8Pz4+PiBlID0gaXRlci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBpZiAoZS5nZXRWYWx1ZSgpICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgYWxpYXNlcy5hZGQoZS5nZXRLZXkoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsaWFzZXM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gZ2V0\nIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzLCB3aXRob3V0IHJl\nc29sdmluZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRh\nIGdldE1ldGFEYXRhSW50ZXJuYWwoQ2xhc3M8Pz4gY2xzLCBDbGFzc0xvYWRl\nciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVjayBjYWNoZSBm\nb3IgZXhpc3RpbmcgbWV0YWRhdGEsIG9yIGdpdmUgdXAgaWYgbm8gbWV0YWRh\ndGEgYW5kCiAgICAgICAgLy8gb3VyIGxpc3Qgb2YgY29uZmlndXJlZCBwZXJz\naXN0ZW50IHR5cGVzIGRvZXNuJ3QgaW5jbHVkZSB0aGUgY2xhc3MKICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgX21ldGFz\nLmdldChjbHMpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwgJiYgKChtZXRh\nLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0gMCB8fCAoX3NvdXJj\nZU1vZGUgJiBNT0RFX01FVEEpID09IDApKQogICAgICAgICAgICByZXR1cm4g\nbWV0YTsKCiAgICAgICAgLy8gaWYgcnVudGltZSwgY3V0IG9mZiBzZWFyY2gg\naWYgbm90IGluIHBjIGxpc3QuIHdlIGRvbid0IGRvIHRoaXMgYXQKICAgICAg\nICAvLyBkZXYgdGltZSBzbyB0aGF0IHVzZXIgY2FuIG1hbmlwdWxhdGUgcGVy\nc2lzdGVudCBjbGFzc2VzIGhlJ3Mgd3JpdGluZwogICAgICAgIC8vIGJlZm9y\nZSBhZGRpbmcgdGhlbSB0byB0aGUgbGlzdAogICAgICAgIGlmICgoX3ZhbGlk\nYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0gMCkgewogICAgICAgICAgICBT\nZXQ8U3RyaW5nPiBwY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhm\nYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICAgICAgaWYgKHBjTmFtZXMgIT0g\nbnVsbCAmJiAhcGNOYW1lcy5jb250YWlucyhjbHMuZ2V0TmFtZSgpKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAgICAgIH0KCiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBjaGVjayB0byBz\nZWUgaWYgbWF5YmUgd2Uga25vdyB0aGlzIGNsYXNzIGhhcyBubyBtZXRhZGF0\nYQogICAgICAgICAgICBpZiAoX21ldGFzLmNvbnRhaW5zS2V5KGNscykpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSB0aGlzIGlzbid0IGFuIG9idmlvdXNseSBiYWQgY2xhc3MKICAg\nICAgICAgICAgaWYgKGNscy5pc1ByaW1pdGl2ZSgpIHx8IGNscy5nZXROYW1l\nKCkuc3RhcnRzV2l0aCgiamF2YS4iKSB8fCBjbHMgPT0gUGVyc2lzdGVuY2VD\nYXBhYmxlLmNsYXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgICAgICAvLyBkZXNpZ25lZCB0byBnZXQgYXJvdW5kIGppa2VzIDEu\nMTcgLyBKREsxLjUgaXNzdWUgd2hlcmUgc3RhdGljCiAgICAgICAgICAgIC8v\nIGluaXRpYWxpemVycyBhcmUgbm90IGludm9rZWQgd2hlbiBhIGNsYXNzIGlz\nIHJlZmVyZW5jZWQsIHNvIHRoZQogICAgICAgICAgICAvLyBjbGFzcyBuZXZl\nciByZWdpc3RlcnMgaXRzZWxmIHdpdGggdGhlIHN5c3RlbQogICAgICAgICAg\nICBpZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgQ2xh\nc3MuZm9yTmFtZShjbHMuZ2V0TmFtZSgpLCB0cnVlLCBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAg\nICAgICAgICAgICAuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY2xzKSkpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nbm90IGluIGNhY2hlOiBsb2FkIG1ldGFkYXRhIG9yIG1hcHBpbmdzIGRlcGVu\nZGluZyBvbiBzb3VyY2UgbW9kZS4KICAgICAgICAvLyBsb2FkaW5nIG1ldGFk\nYXRhIG1pZ2h0IGFsc28gbG9hZCBtYXBwaW5ncywgYnV0IGRvZXNuJ3QgaGF2\nZSB0bwogICAgICAgIGludCBtb2RlID0gMDsKICAgICAgICBpZiAoKF9zb3Vy\nY2VNb2RlICYgTU9ERV9NRVRBKSAhPSAwKQogICAgICAgICAgICBtb2RlID0g\nX3NvdXJjZU1vZGUgJiB+TU9ERV9NQVBQSU5HOwogICAgICAgIGVsc2UgaWYg\nKChfc291cmNlTW9kZSAmIE1PREVfTUFQUElORykgPT0gMCkKICAgICAgICAg\nICAgbW9kZSA9IF9zb3VyY2VNb2RlOwogICAgICAgIGlmIChtb2RlICE9IE1P\nREVfTk9ORSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgibG9h\nZC1jbHMiLCBjbHMsIHRvTW9kZVN0cmluZyhtb2RlKSkpOwogICAgICAgICAg\nICBfZmFjdG9yeS5sb2FkKGNscywgbW9kZSwgZW52TG9hZGVyKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGNoZWNrIGNhY2hlIGFnYWluCiAgICAgICAgaWYg\nKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgbWV0YSA9IChDbGFzc01ldGFE\nYXRhKSBfbWV0YXMuZ2V0KGNscyk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVs\nbCAmJiAoKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9NRVRBKSAhPSAw\nIHx8IChfc291cmNlTW9kZSAmIE1PREVfTUVUQSkgPT0gMCkpCiAgICAgICAg\nICAgIHJldHVybiBtZXRhOwoKICAgICAgICAvLyByZWNvcmQgdGhhdCB0aGlz\nIGNsYXNzIGhhcyBubyBtZXRhZGF0YTsgY2hlY2tpbmcgZm9yIHRoaXMgbGF0\nZXIKICAgICAgICAvLyBzcGVlZHMgdGhpbmdzIHVwIGluIGVudmlyb25tZW50\ncyB3aXRoIHNsb3cgY2xhc3MgbG9hZGluZwogICAgICAgIC8vIGxpa2UgYXBw\nc2VydmVycwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAg\nIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgIF9tZXRhcy5wdXQoY2xz\nLCBudWxsKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUg\nZ2l2ZW4gbW9kZSBmbGFncy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nU3RyaW5nIHRvTW9kZVN0cmluZyhpbnQgbW9kZSkgewogICAgICAgIFN0cmlu\nZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKDMxKTsKICAgICAgICBp\nZiAoKG1vZGUgJiBNT0RFX01FVEEpICE9IDApCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIltNRVRBXSIpOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfUVVF\nUlkpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltRVUVSWV0iKTsK\nICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIltNQVBQSU5HXSIpOwogICAgICAgIGlmICgo\nbW9kZSAmIE1PREVfTUFQUElOR19JTklUKSAhPSAwKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCJbTUFQUElOR19JTklUXSIpOwogICAgICAgIHJldHVybiBi\ndWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUg\nbWV0YWRhdGEgZm9yIG1hcHBpbmcgcmVzb2x1dGlvbi4gVGhpcyBtZXRob2Qg\nbWlnaHQgbWFwIHBhcnRzIG9mIHRoZSBtZXRhZGF0YSB0aGF0CiAgICAgKiBk\nb24ndCByZWx5IG9uIG90aGVyIGNsYXNzZXMgYmVpbmcgbWFwcGVkLCBidXQg\ndGhhdCBvdGhlciBjbGFzc2VzIG1pZ2h0IHJlbHkgb24gZHVyaW5nIHRoZWly\nCiAgICAgKiBvd24gbWFwcGluZyAoZm9yIGV4YW1wbGUsIHByaW1hcnkga2V5\nIGZpZWxkcykuIEJ5IGRlZmF1bHQsIHRoaXMgbWV0aG9kIG9ubHkgY2FsbHMK\nICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2RlZmluZVN1cGVyY2xhc3NG\naWVsZHN9LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwcmVwYXJlTWFw\ncGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBtZXRhLmRlZmlu\nZVN1cGVyY2xhc3NGaWVsZHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVzb2x2ZSB0aGUgZ2l2ZW4gbWV0YWRhdGEgaWYgbmVlZGVkLiBUaGVy\nZSBhcmUgdGhyZWUgZ29hbHM6CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+TWFr\nZSBzdXJlIG5vIHVucmVzb2x2ZWQgbWV0YWRhdGEgZ2V0cyBiYWNrIHRvIHRo\nZSBjbGllbnQuPC9saT4KICAgICAqIDxsaT5Bdm9pZCBpbmZpbml0ZSByZWVu\ndHJhbnQgY2FsbHMgZm9yIG11dHVhbGx5LWRlcGVuZGVudCBtZXRhZGF0YXMg\nYnkgYWxsb3dpbmcgdW5yZXNvbHZlZAogICAgICogbWV0YWRhdGEgdG8gYmUg\ncmV0dXJuZWQgdG8gb3RoZXIgbWV0YWRhdGFzLjwvbGk+CiAgICAgKiA8bGk+\nQWx3YXlzIG1ha2Ugc3VyZSB0aGUgc3VwZXJjbGFzcyBtZXRhZGF0YSBpcyBy\nZXNvbHZlZCBiZWZvcmUgdGhlIHN1YmNsYXNzIG1ldGFkYXRhIHNvIHRoYXQK\nICAgICAqIHRoZSBzdWJjbGFzcyBjYW4gYWNjZXNzIHRoZSBzdXBlcidzIGxp\nc3Qgb2YgZmllbGRzLjwvbGk+CiAgICAgKiA8L29sPgogICAgICogTm90ZSB0\naGF0IHRoZSBjb2RlIGNhbGxpbmcgdGhpcyBtZXRob2QgaXMgc3luY2hyb25p\nemVkLCBzbyB0aGlzIG1ldGhvZCBkb2Vzbid0IGhhdmUgdG8gYmUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCByZXNvbHZlKENsYXNzTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIC8vIHJldHVybiBhbnl0aGluZyB0aGF0IGhhcyBpdHMg\nbWV0YWRhdGEgcmVzb2x2ZWQsIGJlY2F1c2UgdGhhdCBtZWFucwogICAgICAg\nIC8vIGl0IGlzIGVpdGhlciBmdWxseSByZXNvbHZlZCBvciBtdXN0IGF0IGxl\nYXN0IGJlIGluIHRoZSBwcm9jZXNzIG9mCiAgICAgICAgLy8gcmVzb2x2aW5n\nIG1hcHBpbmcsIGV0YyBzaW5jZSB3ZSBkbyB0aGF0IHJpZ2h0IGFmdGVyIG1l\ndGEgcmVzb2x2ZQogICAgICAgIGlmIChtZXRhID09IG51bGwgfHwgX3Jlc01v\nZGUgPT0gTU9ERV9OT05FIHx8IChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVf\nTUVUQSkgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBy\nZXNvbHZlIG1ldGFkYXRhCiAgICAgICAgTGlzdDxDbGFzc01ldGFEYXRhPiBy\nZXNvbHZlZCA9IHJlc29sdmVNZXRhKG1ldGEpOwogICAgICAgIGlmIChyZXNv\nbHZlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8v\nIGxvYWQgbWFwcGluZyBkYXRhCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCByZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAgICAgbG9hZE1hcHBp\nbmcocmVzb2x2ZWQuZ2V0KGkpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHJlc29sdmVkLnNpemUoKTsgaSsrKQogICAgICAgICAgICBwcmVNYXBw\naW5nKHJlc29sdmVkLmdldChpKSk7CgogICAgICAgIC8vIHJlc29sdmUgbWFw\ncGluZ3MKICAgICAgICBib29sZWFuIGVyciA9IHRydWU7CiAgICAgICAgaWYg\nKChfcmVzTW9kZSAmIE1PREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCByZXNvbHZlZC5zaXplKCk7IGkrKykKICAg\nICAgICAgICAgICAgIGVyciAmPSByZXNvbHZlTWFwcGluZyhyZXNvbHZlZC5n\nZXQoaSkpOwoKICAgICAgICAvLyB0aHJvdyBlcnJvcnMgZW5jb3VudGVyZWQK\nICAgICAgICBpZiAoZXJyICYmICFfZXJycy5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgUnVudGltZUV4Y2VwdGlvbiByZTsKICAgICAgICAgICAgaWYgKF9l\ncnJzLnNpemUoKSA9PSAxKQogICAgICAgICAgICAgICAgcmUgPSBfZXJycy5n\nZXQoMCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJlID0K\nICAgICAgICAgICAgICAgICAgICBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoInJlc29sdmUtZXJycyIpKS5zZXROZXN0ZWRUaHJvd2FibGVzKChU\naHJvd2FibGVbXSkgX2VycnMKICAgICAgICAgICAgICAgICAgICAgICAgLnRv\nQXJyYXkobmV3IEV4Y2VwdGlvbltfZXJycy5zaXplKCldKSk7CiAgICAgICAg\nICAgIF9lcnJzLmNsZWFyKCk7CiAgICAgICAgICAgIHRocm93IHJlOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlc29sdmUgbWV0YWRhdGEg\nbW9kZSwgcmV0dXJuaW5nIGxpc3Qgb2YgcHJvY2Vzc2VkIG1ldGFkYWRhdGFz\nLCBvciBudWxsIGlmIHdlJ3JlIHN0aWxsIGluIHRoZQogICAgICogcHJvY2Vz\ncyBvZiByZXNvbHZpbmcgb3RoZXIgbWV0YWRhdGFzLgogICAgICovCiAgICBw\ncml2YXRlIExpc3Q8Q2xhc3NNZXRhRGF0YT4gcmVzb2x2ZU1ldGEoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0UENTdXBlcmNs\nYXNzKCkgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBzZXQgc3VwZXJjbGFz\ncwogICAgICAgICAgICBDbGFzczw/PiBzdXAgPSBtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwTWV0YTsKICAgICAgICAgICAgd2hpbGUgKHN1cCAhPSBudWxs\nICYmIHN1cCAhPSBPYmplY3QuY2xhc3MpIHsKICAgICAgICAgICAgICAgIHN1\ncE1ldGEgPSBnZXRNZXRhRGF0YShzdXAsIG1ldGEuZ2V0RW52Q2xhc3NMb2Fk\nZXIoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKHN1cE1ldGEgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0UENTdXBlcmNs\nYXNzKHN1cCk7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YShzdXBNZXRhKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgIHN1cCA9IHN1cC5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50\nZXJmYWNlKCkpIHsKICAgICAgICAgICAgICAgIENsYXNzPD8+W10gc3VwcyA9\nIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldEludGVyZmFjZXMoKTsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgICAgIHN1cE1ldGEgPSBnZXRNZXRh\nRGF0YShzdXBzW2ldLCBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIGZhbHNl\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3VwTWV0YSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0UENTdXBlcmNsYXNz\nKHN1cCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoc3VwTWV0YSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9j\nLmdldCgiYXNzaWduZWQtc3VwIiwgbWV0YSwgbWV0YS5nZXRQQ1N1cGVyY2xh\nc3MoKSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzb2x2ZSByZWxhdGlv\nbiBwcmltYXJ5IGtleSBmaWVsZHMgZm9yIG1hcHBpbmcgZGVwZW5kZW5jaWVz\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRhLmdldERlY2xh\ncmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1ByaW1h\ncnlLZXkoKSkKICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCksIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSwg\nZmFsc2UpOwoKICAgICAgICAvLyByZXNvbHZlIG1ldGFkYXRhOyBpZiB3ZSdy\nZSBub3QgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2aW5nCiAgICAgICAgLy8g\nb3RoZXJzLCB0aGlzIHdpbGwgcmV0dXJuIHRoZSBzZXQgb2YgaW50ZXJyZWxh\ndGVkIG1ldGFzIHRoYXQKICAgICAgICAvLyByZXNvbHZlZAogICAgICAgIHJl\ndHVybiBwcm9jZXNzQnVmZmVyKG1ldGEsIF9yZXNvbHZpbmcsIE1PREVfTUVU\nQSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIG1hcHBpbmcgaW5mb3Jt\nYXRpb24gZm9yIHRoZSBnaXZlbiBtZXRhZGF0YS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGxvYWRNYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIGlmICgobWV0YS5nZXRSZXNvbHZlKCkgJiBNT0RFX01BUFBJTkcp\nICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gbG9hZCBt\nYXBwaW5nIGluZm9ybWF0aW9uCiAgICAgICAgaWYgKChtZXRhLmdldFNvdXJj\nZU1vZGUoKSAmIE1PREVfTUFQUElORykgPT0gMCAmJiAoX3NvdXJjZU1vZGUg\nJiBNT0RFX01BUFBJTkcpICE9IDApIHsKICAgICAgICAgICAgLy8gZW1iZWRk\nZWQtb25seSBtZXRhZGF0YSBkb2Vzbid0IGhhdmUgbWFwcGluZywgc28gYWx3\nYXlzIGxvYWRlZAogICAgICAgICAgICBpZiAobWV0YS5pc0VtYmVkZGVkT25s\neSgpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVf\nTUFQUElORywgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgLy8gbG9hZCBtYXBwaW5nIGRhdGEKICAgICAgICAgICAgICAgIGlu\ndCBtb2RlID0gX3NvdXJjZU1vZGUgJiB+TU9ERV9NRVRBOwogICAgICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJsb2FkLW1hcHBpbmciLCBt\nZXRhLCB0b01vZGVTdHJpbmcobW9kZSkpKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgX2ZhY3RvcnkubG9hZChtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKSwgbW9kZSwgbWV0YS5nZXRFbnZDbGFzc0xvYWRl\ncigpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVNZXRhRGF0YSht\nZXRhKTsKICAgICAgICAgICAgICAgICAgICBfZXJycy5hZGQocmUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUHJlLW1hcHBpbmcgcHJlcGFyYXRpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwcmVNYXBwaW5nKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmICgobWV0YS5nZXRSZXNvbHZlKCkgJiBNT0RF\nX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gcHJlcGFyZSBtYXBwaW5ncyBmb3IgcmVzb2x2ZTsgaWYgbm90IHJlc29s\ndmluZyBtYXBwaW5ncywgdGhlbgogICAgICAgIC8vIG1ha2Ugc3VyZSBhbnkg\nc3VwZXJjbGFzcyBmaWVsZHMgZGVmaW5lZCBpbiBtZXRhZGF0YSBhcmUgcmVz\nb2x2ZWQKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9yZXNNb2Rl\nICYgTU9ERV9NQVBQSU5HKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2cudHJhY2UoX2xvYy5nZXQoInByZXAtbWFwcGluZyIsIG1ldGEpKTsKICAg\nICAgICAgICAgICAgIHByZXBhcmVNYXBwaW5nKG1ldGEpOwogICAgICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgICAgIG1ldGEuZGVmaW5lU3VwZXJjbGFz\nc0ZpZWxkcyhmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsK\nICAgICAgICAgICAgX2VycnMuYWRkKHJlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXNvbHZlIGFuZCBpbml0aWFsaXplIG1hcHBpbmcu\nCiAgICAgKiAKICAgICAqIEByZXR1cm4gZmFsc2UgaWYgd2UncmUgc3RpbGwg\naW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2aW5nIG1hcHBpbmdzCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiByZXNvbHZlTWFwcGluZyhDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBMaXN0PENsYXNzTWV0YURhdGE+IG1hcHBl\nZCA9IHByb2Nlc3NCdWZmZXIobWV0YSwgX21hcHBpbmcsIE1PREVfTUFQUElO\nRyk7CiAgICAgICAgaWYgKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGluaXRpYWxpemUgbWFwcGluZyBm\nb3IgcnVudGltZSB1c2UKICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9ERV9N\nQVBQSU5HX0lOSVQpICE9IDApIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBtYXBwZWQuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAg\nIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgbWFwcGVkLmdldChpKTsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5yZXNv\nbHZlKE1PREVfTUFQUElOR19JTklUKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgICAg\nICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBf\nZXJycy5hZGQocmUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogUHJvY2VzcyB0aGUgZ2l2ZW4gbWV0YWRhdGEgYW5kIHRoZSBh\nc3NvY2lhdGVkIGJ1ZmZlci4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PENs\nYXNzTWV0YURhdGE+IHByb2Nlc3NCdWZmZXIoQ2xhc3NNZXRhRGF0YSBtZXRh\nLCBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxpc3QgYnVmZmVyLCBpbnQg\nbW9kZSkgewogICAgICAgIC8vIGlmIHdlJ3JlIGFscmVhZHkgcHJvY2Vzc2lu\nZyBhIG1ldGFkYXRhLCBqdXN0IGJ1ZmZlciB0aGlzIG9uZTsgd2hlbgogICAg\nICAgIC8vIHRoZSBpbml0aWFsIG1ldGFkYXRhIGZpbmlzaGVzIHByb2Nlc3Np\nbmcsIHdlIHRyYXZlcnNlIHRoZSBidWZmZXIKICAgICAgICAvLyBhbmQgcHJv\nY2VzcyBhbGwgdGhlIG90aGVycyB0aGF0IHdlcmUgaW50cm9kdWNlZCBkdXJp\nbmcgcmVlbnRyYW50CiAgICAgICAgLy8gY2FsbHMKICAgICAgICBpZiAoIWJ1\nZmZlci5hZGQobWV0YSkgfHwgYnVmZmVyLnNpemUoKSAhPSAxKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY29udGludWFsbHkgcG9w\nIGEgbWV0YWRhdGEgYW5kIHByb2Nlc3MgaXQgdW50aWwgd2UgcnVuIG91dDsg\nbm90ZQogICAgICAgIC8vIHRoYXQgZWFjaCBwcm9jZXNzaW5nIGNhbGwgbWln\naHQgcGxhY2UgbW9yZSBtZXRhcyBpbiB0aGUgYnVmZmVyIGFzCiAgICAgICAg\nLy8gb25lIGNsYXNzIHRyaWVzIHRvIGFjY2VzcyBtZXRhZGF0YSBmb3IgYW5v\ndGhlcjsgYWxzbyBub3RlIHRoYXQgdGhlCiAgICAgICAgLy8gYnVmZmVyIG9y\nZGVycyBpdHNlbGYgZnJvbSBsZWFzdCB0byBtb3N0IGRlcml2ZWQKICAgICAg\nICBDbGFzc01ldGFEYXRhIGJ1ZmZlcmVkOwogICAgICAgIExpc3Q8Q2xhc3NN\nZXRhRGF0YT4gcHJvY2Vzc2VkID0gbmV3IEFycmF5TGlzdDxDbGFzc01ldGFE\nYXRhPig1KTsKICAgICAgICB3aGlsZSAoIWJ1ZmZlci5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgYnVmZmVyZWQgPSBidWZmZXIucGVlaygpOwogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgYnVmZmVyZWQucmVzb2x2ZSht\nb2RlKTsKICAgICAgICAgICAgICAgIHByb2Nlc3NlZC5hZGQoYnVmZmVyZWQp\nOwogICAgICAgICAgICAgICAgYnVmZmVyLnJlbW92ZShidWZmZXJlZCk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7CgogICAgICAgICAgICAgICAg\nLy8gYW55IGV4Y2VwdGlvbiBkdXJpbmcgcmVzb2x1dGlvbiBvZiBvbmUgdHlw\nZSBtZWFucyB3ZSBjYW4ndAogICAgICAgICAgICAgICAgLy8gcmVzb2x2ZSBh\nbnkgb2YgdGhlIHJlbGF0ZWQgdHlwZXMsIHNvIGNsZWFyIGJ1ZmZlci4gdGhp\ncyBhbHNvCiAgICAgICAgICAgICAgICAvLyBlbnN1cmVzIHRoYXQgaWYgdHdv\nIHR5cGVzIHJlbGF0ZSB0byBlYWNoIG90aGVyIGFuZCBvbmUKICAgICAgICAg\nICAgICAgIC8vIGRpZXMsIHdlIGRvbid0IGdldCBpbnRvIGluZmluaXRlIGN5\nY2xlcwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxDbGFzc01ldGFE\nYXRhPiBpdHIgPSBidWZmZXIuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgICAgICBtZXRhID0gaXRyLm5leHQoKTsKICAg\nICAgICAgICAgICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAobWV0YSAhPSBidWZmZXJlZCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBfZXJycy5hZGQobmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJwcmV2LWVycnMiLCBtZXRhLCBidWZmZXJlZCkpKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBidWZmZXIuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gcHJvY2Vzc2VkOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGFsbCB0aGUgbWV0YWRhdGEgaW5zdGFuY2VzIGN1\ncnJlbnRseSBpbiB0aGUgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzTWV0YURhdGFbXSBnZXRNZXRhRGF0YXMoKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHByZXZlbnQgY29u\nY3VycmVudCBtb2QgZXJyb3JzIHdoZW4gcmVzb2x2aW5nIG9uZSBtZXRhZGF0\nYQogICAgICAgICAgICAvLyBpbnRyb2R1Y2VzIG90aGVycwogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhW10gbWV0YXMgPSAoQ2xhc3NNZXRhRGF0YVtdKSBf\nbWV0YXMudmFsdWVzKCkudG9BcnJheShuZXcgQ2xhc3NNZXRhRGF0YVtfbWV0\nYXMuc2l6ZSgpXSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbWV0YXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAobWV0YXNb\naV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YSht\nZXRhc1tpXS5nZXREZXNjcmliZWRUeXBlKCksIG1ldGFzW2ldLmdldEVudkNs\nYXNzTG9hZGVyKCksIHRydWUpOwoKICAgICAgICAgICAgTGlzdDxDbGFzc01l\ndGFEYXRhPiByZXNvbHZlZCA9IG5ldyBBcnJheUxpc3Q8Q2xhc3NNZXRhRGF0\nYT4oX21ldGFzLnNpemUoKSk7CiAgICAgICAgICAgIGZvciAoQ2xhc3NNZXRh\nRGF0YSBtZXRhIDogX21ldGFzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAg\nICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJlc29s\ndmVkLmFkZChtZXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtZXRh\ncyA9IHJlc29sdmVkLnRvQXJyYXkobmV3Q2xhc3NNZXRhRGF0YUFycmF5KHJl\nc29sdmVkLnNpemUoKSkpOwogICAgICAgICAgICBBcnJheXMuc29ydChtZXRh\ncyk7CiAgICAgICAgICAgIHJldHVybiBtZXRhczsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBtZXRhZGF0YSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzLCB3aXRob3V0IGFueSByZXNvbHV0aW9uLiBSZXR1\ncm4gbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRh\nRGF0YSBnZXRDYWNoZWRNZXRhRGF0YShDbGFzczw/PiBjbHMpIHsKICAgICAg\nICByZXR1cm4gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9w\ndWxhdGUgaXQgd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9uLCBhZGQgaXQgdG8g\ndGhlIHJlcG9zaXRvcnksIGFuZAogICAgICogcmV0dXJuIGl0LiBVc2UgdGhl\nIGRlZmF1bHQgYWNjZXNzIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzPD8+IGNscykgewogICAgICAg\nIHJldHVybiBhZGRNZXRhRGF0YShjbHMsIEFjY2Vzc0NvZGUuVU5LTk9XTik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEs\nIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0\nIHRvIHRoZSByZXBvc2l0b3J5LCBhbmQKICAgICAqIHJldHVybiBpdC4KICAg\nICAqIAogICAgICogQHBhcmFtIGFjY2VzcwogICAgICogICAgICAgICAgICB0\naGUgYWNjZXNzIHR5cGUgdG8gdXNlIGluIHBvcHVsYXRpbmcgbWV0YWRhdGEK\nICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgYWRkTWV0YURhdGEo\nQ2xhc3M8Pz4gY2xzLCBpbnQgYWNjZXNzKSB7CiAgICAgICAgaWYgKGNscyA9\nPSBudWxsIHx8IGNscy5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbmV3Q2xh\nc3NNZXRhRGF0YShjbHMpOwogICAgICAgIF9mYWN0b3J5LmdldERlZmF1bHRz\nKCkucG9wdWxhdGUobWV0YSwgYWNjZXNzKTsKCiAgICAgICAgLy8gc3luY2hy\nb25pemUgb24gdGhpcyByYXRoZXIgdGhhbiB0aGUgbWFwLCBiZWNhdXNlIGFs\nbCBvdGhlciBtZXRob2RzCiAgICAgICAgLy8gdGhhdCBhY2Nlc3MgX21ldGFz\nIGFyZSBzeW5jaHJvbml6ZWQgb24gdGhpcwogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3Bhd2FyZXMuY29udGFpbnNL\nZXkoY2xzKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgicGMtYW5kLWF3YXJlIiwgY2xzKSk7CiAgICAg\nICAgICAgIF9tZXRhcy5wdXQoY2xzLCBtZXRhKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBu\nZXcgY2xhc3MgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBDbGFzc01ldGFEYXRhIG5ld0NsYXNzTWV0YURhdGEoQ2xhc3M8Pz4g\ndHlwZSkgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YSh0eXBl\nLCB0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBh\ncnJheSBvZiB0aGUgcHJvcGVyIGNsYXNzIG1ldGFkYXRhIHN1YmNsYXNzLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YVtdIG5ld0NsYXNz\nTWV0YURhdGFBcnJheShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBDbGFzc01ldGFEYXRhW2xlbmd0aF07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgZmllbGQgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhIG5ld0ZpZWxkTWV0YURh\ndGEoU3RyaW5nIG5hbWUsIENsYXNzPD8+IHR5cGUsIENsYXNzTWV0YURhdGEg\nb3duZXIpIHsKICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWV0YURhdGEobmFt\nZSwgdHlwZSwgb3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IGFycmF5IG9mIHRoZSBwcm9wZXIgZmllbGQgbWV0YWRhdGEgc3Vi\nY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhW10g\nbmV3RmllbGRNZXRhRGF0YUFycmF5KGludCBsZW5ndGgpIHsKICAgICAgICBy\nZXR1cm4gbmV3IEZpZWxkTWV0YURhdGFbbGVuZ3RoXTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBhcnJheSBvZiB0aGUgcHJvcGVyIHht\nbCBjbGFzcyBtZXRhZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFhNTE1ldGFEYXRhW10gbmV3WE1MQ2xhc3NNZXRhRGF0YUFycmF5KGlu\ndCBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gbmV3IFhNTENsYXNzTWV0YURh\ndGFbbGVuZ3RoXTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5l\ndyBlbWJlZGRlZCBjbGFzcyBtZXRhZGF0YSBpbnN0YW5jZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgbmV3RW1iZWRkZWRDbGFzc01l\ndGFEYXRhKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICByZXR1cm4g\nbmV3IENsYXNzTWV0YURhdGEob3duZXIpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHZhbHVlIG1ldGFkYXRhIGluc3RhbmNlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgVmFsdWVNZXRhRGF0YSBuZXdWYWx1ZU1ldGFE\nYXRhKEZpZWxkTWV0YURhdGEgb3duZXIpIHsKICAgICAgICByZXR1cm4gbmV3\nIFZhbHVlTWV0YURhdGFJbXBsKG93bmVyKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZSBhbiB7QGxpbmsgT3JkZXJ9IGZvciB0aGUgZ2l2ZW4gZmll\nbGQgYW5kIGRlY2xhcmF0aW9uLiBUaGlzIG1ldGhvZCBkZWxlZ2F0ZXMgdG8K\nICAgICAqIHtAbGluayAjbmV3UmVsYXRlZEZpZWxkT3JkZXJ9IGFuZCB7QGxp\nbmsgI25ld1ZhbHVlRmllbGRPcmRlcn0gYnkgZGVmYXVsdC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIE9yZGVyIG5ld09yZGVyKEZpZWxkTWV0YURhdGEgb3du\nZXIsIFN0cmluZyBuYW1lLCBib29sZWFuIGFzYykgewogICAgICAgIC8vIHBh\ndGhzIGNhbiBzdGFydCB3aXRoIChvciBlcXVhbCkgJyNlbGVtZW50JwogICAg\nICAgIGlmIChuYW1lLnN0YXJ0c1dpdGgoT3JkZXIuRUxFTUVOVCkpCiAgICAg\nICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhPcmRlci5FTEVNRU5ULmxl\nbmd0aCgpKTsKICAgICAgICBpZiAobmFtZS5sZW5ndGgoKSA9PSAwKQogICAg\nICAgICAgICByZXR1cm4gbmV3VmFsdWVPcmRlcihvd25lciwgYXNjKTsKCiAg\nICAgICAgLy8gbmV4dCB0b2tlbiBzaG91bGQgYmUgJy4nCiAgICAgICAgaWYg\nKG5hbWUuY2hhckF0KDApID09ICcuJykKICAgICAgICAgICAgbmFtZSA9IG5h\nbWUuc3Vic3RyaW5nKDEpOwoKICAgICAgICAvLyByZWxhdGVkIGZpZWxkCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gb3duZXIuZ2V0RWxlbWVudCgp\nLmdldFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGlmIChtZXRhID09IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgibm9ucGMtZmllbGQtb3JkZXJhYmxlIiwgb3duZXIsIG5hbWUpKTsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIHJlbCA9IGdldE9yZGVyQnlGaWVsZCht\nZXRhLCBuYW1lKTsKICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLWZpZWxkLW9yZGVyYWJsZSIsIG93bmVyLCBuYW1lKSk7CiAgICAgICAgcmV0\ndXJuIG5ld1JlbGF0ZWRGaWVsZE9yZGVyKG93bmVyLCByZWwsIGFzYyk7CiAg\nICB9CgogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0T3JkZXJCeUZpZWxk\nKENsYXNzTWV0YURhdGEgbWV0YSwgU3RyaW5nIG9yZGVyQnkpIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gbWV0YS5nZXRGaWVsZChvcmRlckJ5\nKTsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGZpZWxkOwogICAgICAgIGludCBkb3RJZHggPSBvcmRlckJ5LmluZGV4\nT2YoIi4iKTsKICAgICAgICBpZiAoZG90SWR4ID09IC0xKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gb3Jk\nZXJCeS5zdWJzdHJpbmcoMCwgZG90SWR4KTsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZpZWxkMSA9IG1ldGEuZ2V0RmllbGQoZmllbGROYW1lKTsKICAgICAg\nICBpZiAoZmllbGQxID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTEgPSBmaWVsZDEuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpOwogICAgICAgIGlmIChtZXRhMSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBTdHJpbmcgbWFwcGVk\nQnkxID0gb3JkZXJCeS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7CiAgICAgICAg\ncmV0dXJuIGdldE9yZGVyQnlGaWVsZChtZXRhMSwgbWFwcGVkQnkxKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIE9yZGVyIGJ5IHRoZSBmaWVsZCB2YWx1ZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVyIG5ld1ZhbHVlT3JkZXIoRmll\nbGRNZXRhRGF0YSBvd25lciwgYm9vbGVhbiBhc2MpIHsKICAgICAgICByZXR1\ncm4gbmV3IEluTWVtb3J5VmFsdWVPcmRlcihhc2MsIGdldENvbmZpZ3VyYXRp\nb24oKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcmRlciBieSBhIGZpZWxk\nIG9mIHRoZSByZWxhdGVkIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBP\ncmRlciBuZXdSZWxhdGVkRmllbGRPcmRlcihGaWVsZE1ldGFEYXRhIG93bmVy\nLCBGaWVsZE1ldGFEYXRhIHJlbCwgYm9vbGVhbiBhc2MpIHsKICAgICAgICBy\nZXR1cm4gbmV3IEluTWVtb3J5UmVsYXRlZEZpZWxkT3JkZXIocmVsLCBhc2Ms\nIGdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\ncmVhdGUgYW4gYXJyYXkgb2Ygb3JkZXJzIG9mIHRoZSBnaXZlbiBzaXplLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgT3JkZXJbXSBuZXdPcmRlckFycmF5KGlu\ndCBzaXplKSB7CiAgICAgICAgcmV0dXJuIG5ldyBPcmRlcltzaXplXTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIG1ldGFkYXRhIGluc3RhbmNl\nIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAgKiAKICAgICAqIEByZXR1cm4g\ndHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gdGhpcyByZXBvc2l0\nb3J5CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZU1ldGFEYXRh\nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4g\ncmVtb3ZlTWV0YURhdGEobWV0YS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgbWV0YWRhdGEgaW5zdGFuY2Ug\nZnJvbSB0aGUgcmVwb3NpdG9yeS4KICAgICAqIAogICAgICogQHJldHVybiB0\ncnVlIGlmIHJlbW92ZWQsIGZhbHNlIGlmIG5vdCBpbiB0aGlzIHJlcG9zaXRv\ncnkKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlTWV0YURhdGEo\nQ2xhc3MgY2xzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKF9tZXRhcy5yZW1vdmUoY2xz\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDbGFzczw/PiBpbXBsID0g\nX2lmYWNlcy5yZW1vdmUoY2xzKTsKICAgICAgICAgICAgICAgIGlmIChpbXBs\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX21ldGFzLnJlbW92ZShp\nbXBsKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIG1ldGFkYXRhIGFzIGRlY2xh\ncmVkIGludGVyZmFjZSBpbXBsZW1lbnRhdGlvbi4KICAgICAqLwogICAgdm9p\nZCBhZGREZWNsYXJlZEludGVyZmFjZUltcGwoQ2xhc3NNZXRhRGF0YSBtZXRh\nLCBDbGFzczw/PiBpZmFjZSkgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lt\ncGxzKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHZhbHMg\nPSBfaW1wbHMuZ2V0KGlmYWNlKTsKCiAgICAgICAgICAgIC8vIGNoZWNrIHRv\nIHNlZSBpZiB0aGUgc3VwZXJjbGFzcyBhbHJlYWR5IGRlY2xhcmVzIHRvIGF2\nb2lkIGR1cHMKICAgICAgICAgICAgaWYgKHZhbHMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBtZXRhLmdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICBmb3IgKDsgc3Vw\nICE9IG51bGw7IHN1cCA9IHN1cC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nKQogICAgICAgICAgICAgICAgICAgIGlmICh2YWxzLmNvbnRhaW5zKHN1cC5n\nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkVG9Db2xsZWN0\naW9uKF9pbXBscywgaWZhY2UsIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBm\nYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBpbXBsZW1lbnRhdGlvbiBmb3IgdGhlIGdpdmVuIG1hbmFnZWQgaW50ZXJm\nYWNlLgogICAgICovCiAgICB2b2lkIHNldEludGVyZmFjZUltcGwoQ2xhc3NN\nZXRhRGF0YSBtZXRhLCBDbGFzczw/PiBpbXBsKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghbWV0YS5pc01hbmFn\nZWRJbnRlcmZhY2UoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1hbmFnZWQtaW50ZXJmYWNl\nIiwgbWV0YSwgaW1wbCkpOwogICAgICAgICAgICBfaWZhY2VzLnB1dChtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSwgaW1wbCk7CiAgICAgICAgICAgIGFkZERl\nY2xhcmVkSW50ZXJmYWNlSW1wbChtZXRhLCBtZXRhLmdldERlc2NyaWJlZFR5\ncGUoKSk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gbWV0YS5n\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICB3aGlsZSAo\nc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIHJlY29yZCBzdXBl\ncmNsYXNzIGludGVyZmFjZSBpbmZvIHdoaWxlIHdlIGNhbiBhcyB3ZWxsIGFz\nIHdlCiAgICAgICAgICAgICAgICAvLyB3aWxsIG9ubHkgcmVnaXN0ZXIgY29u\nY3JldGUgc3VwZXJjbGFzcyBpbiBQQ1JlZ2lzdHJ5CiAgICAgICAgICAgICAg\nICBzdXAuY2xlYXJTdWJjbGFzc0NhY2hlKCk7CiAgICAgICAgICAgICAgICBh\nZGRUb0NvbGxlY3Rpb24oX3N1YnMsIHN1cC5nZXREZXNjcmliZWRUeXBlKCks\nIGltcGwsIHRydWUpOwogICAgICAgICAgICAgICAgc3VwID0gKENsYXNzTWV0\nYURhdGEpIHN1cC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIEludGVyZmFjZUltcGxHZW5lcmF0\nb3IgZ2V0SW1wbEdlbmVyYXRvcigpIHsKICAgICAgICByZXR1cm4gX2ltcGxH\nZW47CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxlYXN0LWRl\ncml2ZWQgY2xhc3MgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlv\nbiBpZGVudGl0eSBvYmplY3QuCiAgICAgKiAKICAgICAqIEBwYXJhbSBvaWQK\nICAgICAqICAgICAgICAgICAgdGhlIG9pZCB0byBnZXQgdGhlIG1ldGFkYXRh\nIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICogICAgICAgICAg\nICB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlmIGFueQogICAg\nICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAgICAgICAgICBpZiB0cnVl\nLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259IGlmIG5vIG1l\ndGFkYXRhIGlzIGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGdldE1ldGFEYXRhKE9iamVjdCBvaWQsIENsYXNzTG9hZGVyIGVudkxv\nYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBpZiAob2lkID09\nIG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW9pZC1tZXRhIiwgb2lkLCAi\nPyIsIF9vaWRzLnRvU3RyaW5nKCkpKTsKICAgICAgICBpZiAob2lkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAob2lk\nIGluc3RhbmNlb2YgT3BlbkpQQUlkKSB7CiAgICAgICAgICAgIENsYXNzPD8+\nIGNscyA9ICgoT3BlbkpQQUlkKSBvaWQpLmdldFR5cGUoKTsKICAgICAgICAg\nICAgcmV0dXJuIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhp\nc3QpOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAg\nICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAg\nICBDbGFzczw/PiBjbHMgPSBfb2lkcy5nZXQob2lkLmdldENsYXNzKCkpOwog\nICAgICAgIGlmIChjbHMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdl\ndE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwoKICAgICAg\nICAvLyBtYXliZSB0aGlzIGlzIHNvbWUgdHlwZSB3ZSd2ZSBzZWVuIGJ1dCBq\ndXN0IGlzbid0IHZhbGlkCiAgICAgICAgaWYgKF9vaWRzLmNvbnRhaW5zS2V5\nKG9pZC5nZXRDbGFzcygpKSkgewogICAgICAgICAgICBpZiAobXVzdEV4aXN0\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9pZCwgb2lkLmdldENsYXNzKCks\nIF9vaWRzKSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgLy8gaWYgc3RpbGwgbm90IG1hdGNoLCByZWdpc3RlciBhbnkg\nY2xhc3NlcyB0aGF0IGxvb2sgc2ltaWxhciB0byB0aGUKICAgICAgICAvLyBv\naWQgY2xhc3MgYW5kIGNoZWNrIGFnYWluCiAgICAgICAgcmVzb2x2ZUlkZW50\naXR5Q2xhc3Mob2lkKTsKICAgICAgICBpZiAocHJvY2Vzc1JlZ2lzdGVyZWRD\nbGFzc2VzKGVudkxvYWRlcikubGVuZ3RoID4gMCkgewogICAgICAgICAgICBj\nbHMgPSBfb2lkcy5nZXQob2lkLmdldENsYXNzKCkpOwogICAgICAgICAgICBp\nZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TWV0\nYURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQoK\nICAgICAgICAvLyByZWNvcmQgdGhhdCB0aGlzIGlzIGFuIGludmFsaWQgdHlw\nZQogICAgICAgIF9vaWRzLnB1dChvaWQuZ2V0Q2xhc3MoKSwgbnVsbCk7Cgog\nICAgICAgIGlmICghbXVzdEV4aXN0KQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLW9pZC1tZXRhIiwgb2lkLCBvaWQuZ2V0Q2xhc3MoKSwgX29pZHMp\nKS5zZXRGYWlsZWRPYmplY3Qob2lkKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1ha2Ugc29tZSBndWVzc2VzIGFib3V0IHRoZSBuYW1lIG9mIGEgdGFyZ2V0\nIGNsYXNzIGZvciBhbiB1bmtub3duIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNs\nYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZUlkZW50aXR5\nQ2xhc3MoT2JqZWN0IG9pZCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFzczw/PiBvaWRDbGFz\ncyA9IG9pZC5nZXRDbGFzcygpOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInJl\nc29sdmUtaWRlbnRpdHkiLCBvaWRDbGFzcykpOwoKICAgICAgICBDbGFzc0xv\nYWRlciBjbCA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Q\ncml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKG9pZENsYXNzKSk7CiAg\nICAgICAgU3RyaW5nIGNsYXNzTmFtZTsKICAgICAgICB3aGlsZSAob2lkQ2xh\nc3MgIT0gbnVsbCAmJiBvaWRDbGFzcyAhPSBPYmplY3QuY2xhc3MpIHsKICAg\nICAgICAgICAgY2xhc3NOYW1lID0gb2lkQ2xhc3MuZ2V0TmFtZSgpOwoKICAg\nICAgICAgICAgLy8gd2UgdGFrZSBhIGJydXRlLWZvcmNlIGFwcHJvYWNoOiB0\ncnkgdG8gbG9hZCBhbGwgdGhlIGNsYXNzJwogICAgICAgICAgICAvLyBzdWJz\ndHJpbmdzLiB0aGlzIHdpbGwgaGFuZGxlIHRoZSBmb2xsb3dpbmcgY29tbW9u\nIG5hbWluZyBjYXNlczoKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8g\nY29tLmNvbXBhbnkuTXlDbGFzcyRJRCAtPiBjb20uY29tcGFueS5NeUNsYXNz\nCiAgICAgICAgICAgIC8vIGNvbS5jb21wYW55Lk15Q2xhc3NJZCAtPiBjb20u\nY29tcGFueS5NeUNsYXNzCiAgICAgICAgICAgIC8vIGNvbS5jb21wYW55Lk15\nQ2xhc3NPaWQgLT4gY29tLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAgICAv\nLyBjb20uY29tcGFueS5NeUNsYXNzUEsgLT4gY29tLmNvbXBhbnkuTXlDbGFz\ncwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyB0aGlzIGlzbid0IHRo\nZSBmYXN0ZXN0IHRoaW5nIHBvc3NpYmxlLCBidXQgdGhpcyBtZXRob2Qgd2ls\nbAogICAgICAgICAgICAvLyBvbmx5IGJlIGNhbGxlZCBvbmNlIHBlciBKVk0g\ncGVyIHVua25vd24gYXBwIGlkIGNsYXNzCiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSBjbGFzc05hbWUubGVuZ3RoKCk7IGkgPiAxOyBpLS0pIHsKICAgICAg\nICAgICAgICAgIGlmIChjbGFzc05hbWUuY2hhckF0KGkgLSAxKSA9PSAnLicp\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNsYXNz\nTmFtZS5zdWJzdHJpbmcoMCwgaSksIHRydWUsIGNsKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9\nIC8vIGNvbnN1bWUgYWxsIGV4Y2VwdGlvbnMKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gbW92ZSB1cCB0aGUgT0lEIGhpZXJhcmNoeQogICAgICAg\nICAgICBvaWRDbGFzcyA9IG9pZENsYXNzLmdldFN1cGVyY2xhc3MoKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGxlYXN0\nLWRlcml2ZWQgbWV0YWRhdGFzIHdpdGggc29tZSBtYXBwZWQgYXNzaWduYWJs\nZSB0eXBlIHRoYXQgaW1wbGVtZW50IHRoZSBnaXZlbgogICAgICogY2xhc3Mu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBjbHMKICAgICAqICAgICAgICAgICAg\ndGhlIGNsYXNzIG9yIGludGVyZmFjZSB0byByZXRyaWV2ZSBpbXBsZW1lbnRv\ncnMgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyCiAgICAgKiAgICAgICAg\nICAgIHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAg\nICAgKiBAcGFyYW0gbXVzdEV4aXN0CiAgICAgKiAgICAgICAgICAgIGlmIHRy\ndWUsIHRocm93cyBhIHtAbGluayBNZXRhRGF0YUV4Y2VwdGlvbn0gaWYgbm8g\nbWV0YWRhdGEgaXMgZm91bmQKICAgICAqLwogICAgcHVibGljIENsYXNzTWV0\nYURhdGFbXSBnZXRJbXBsZW1lbnRvck1ldGFEYXRhcyhDbGFzczw/PiBjbHMs\nIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsK\nICAgICAgICBpZiAoY2xzID09IG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLW1ldGEiLCBjbHMpKTsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBFTVBUWV9NRVRBUzsKCiAgICAgICAgLy8gZ2V0IGlt\ncGxzIG9mIGdpdmVuIGludGVyZmFjZSAvIGFic3RyYWN0IGNsYXNzCiAgICAg\nICAgbG9hZFJlZ2lzdGVyZWRDbGFzc01ldGFEYXRhKGVudkxvYWRlcik7CiAg\nICAgICAgQ29sbGVjdGlvbjxDbGFzczw/Pj4gdmFscyA9IF9pbXBscy5nZXQo\nY2xzKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgQ29s\nbGVjdGlvbjxDbGFzc01ldGFEYXRhPiBtYXBwZWQgPSBudWxsOwogICAgICAg\nIGlmICh2YWxzICE9IG51bGwpIHsKICAgICAgICAgICAgbG9jaygpOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxD\nbGFzczw/Pj4gaXRyID0gdmFscy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgICAgIG1ldGEgPSBnZXRNZXRhRGF0YShp\ndHIubmV4dCgpLCBlbnZMb2FkZXIsIHRydWUpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChtZXRhLmlzTWFwcGVkKCkgfHwgbWV0YS5nZXRNYXBwZWRQQ1N1\nYmNsYXNzTWV0YURhdGFzKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAobWFwcGVkID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBtYXBwZWQgPSBuZXcgQXJyYXlMaXN0PENsYXNzTWV0\nYURhdGE+KHZhbHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nbWFwcGVkLmFkZChtZXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYgKG1hcHBlZCA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1tZXRhIiwgY2xzKSk7CiAgICAgICAgaWYgKG1hcHBlZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gRU1QVFlfTUVUQVM7CiAgICAgICAgcmV0dXJu\nIG1hcHBlZC50b0FycmF5KG5ld0NsYXNzTWV0YURhdGFBcnJheShtYXBwZWQu\nc2l6ZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtZXRh\nZGF0YSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBwZXJzaXN0ZW5jZS1h\nd2FyZSBjbGFzcy4gUmV0dXJucyBudWxsLCBpZiB0aGUKICAgICAqIGdpdmVu\nIGNsYXNzIGlzIG5vdCByZWdpc3RlcmVkIGFzIHBlcnNpc3RlbmNlLWF3YXJl\nLgogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGdl\ndFBlcnNpc3RlbmNlQXdhcmUoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgcmV0\ndXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGEpIF9wYXdhcmVzLmdldChjbHMp\nOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyBhbGwgdGhlIG1ldGFkYXRh\ncyBmb3IgcGVyc2lzdGVuY2UtYXdhcmUgY2xhc3NlcwogICAgICogCiAgICAg\nKiBAcmV0dXJuIGVtcHR5IGFycmF5IGlmIG5vIGNsYXNzIGhhcyBiZWVuIHJl\nZ2lzdGVyZWQgYXMgcGVycy1hd2FyZQogICAgICovCiAgICBwdWJsaWMgTm9u\nUGVyc2lzdGVudE1ldGFEYXRhW10gZ2V0UGVyc2lzdGVuY2VBd2FyZXMoKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfcGF3YXJlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nRU1QVFlfTk9OX1BFUlNJU1RFTlQ7CiAgICAgICAgICAgIHJldHVybiAoTm9u\nUGVyc2lzdGVudE1ldGFEYXRhW10pIF9wYXdhcmVzLnZhbHVlcygpLnRvQXJy\nYXkobmV3IE5vblBlcnNpc3RlbnRNZXRhRGF0YVtfcGF3YXJlcy5zaXplKCld\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIGNsYXNzIGFzIHBlcnNpc3RlbmNlLWF3YXJlLgogICAgICogCiAgICAgKiBA\ncGFyYW0gY2xzCiAgICAgKiAgICAgICAgICAgIG5vbi1udWxsIGFuZCBtdXN0\nIG5vdCBhbHJlYWRkeSBiZSBhZGRlZCBhcyBwZXJzaXRlbmNlLWNhcGFibGUK\nICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBhZGRQ\nZXJzaXN0ZW5jZUF3YXJlKENsYXNzPD8+IGNscykgewogICAgICAgIGlmIChj\nbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfcGF3YXJl\ncy5jb250YWluc0tleShjbHMpKQogICAgICAgICAgICAgICAgcmV0dXJuIChO\nb25QZXJzaXN0ZW50TWV0YURhdGEpIF9wYXdhcmVzLmdldChjbHMpOwogICAg\nICAgICAgICBpZiAoZ2V0Q2FjaGVkTWV0YURhdGEoY2xzKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwYy1hbmQtYXdhcmUiLCBjbHMpKTsKICAgICAgICAgICAgTm9u\nUGVyc2lzdGVudE1ldGFEYXRhIG1ldGEgPQogICAgICAgICAgICAgICAgbmV3\nIE5vblBlcnNpc3RlbnRNZXRhRGF0YShjbHMsIHRoaXMsIE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YS5UWVBFX1BFUlNJU1RFTkNFX0FXQVJFKTsKICAgICAgICAg\nICAgX3Bhd2FyZXMucHV0KGNscywgbWV0YSk7CiAgICAgICAgICAgIHJldHVy\nbiBtZXRhOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBh\nIHBlcnNpdGVuY2UtYXdhcmUgY2xhc3MgZnJvbSB0aGUgcmVwb3NpdG9yeQog\nICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZAogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVQZXJzaXN0ZW5jZUF3YXJlKENs\nYXNzPD8+IGNscykgewogICAgICAgIHJldHVybiBfcGF3YXJlcy5yZW1vdmUo\nY2xzKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUg\nbWV0YWRhdGEgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gbm9uLW1hcHBl\nZCBpbnRlcmZhY2UuIFJldHVybnMgbnVsbCwgaWYgdGhlIGdpdmVuCiAgICAg\nKiBpbnRlcmZhY2UgaXMgbm90IHJlZ2lzdGVyZWQgYXMgcGVyc2lzdGVuY2Ut\nYXdhcmUuCiAgICAgKi8KICAgIHB1YmxpYyBOb25QZXJzaXN0ZW50TWV0YURh\ndGEgZ2V0Tm9uTWFwcGVkSW50ZXJmYWNlKENsYXNzPD8+IGlmYWNlKSB7CiAg\nICAgICAgcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGEpIF9ub25NYXBw\nZWQuZ2V0KGlmYWNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhl\nIGNvcnJlc3BvbmRpbmcgbWV0YWRhdGFzIGZvciBhbGwgcmVnaXN0ZXJlZCwg\nbm9uLW1hcHBlZCBpbnRlcmZhY2VzCiAgICAgKiAKICAgICAqIEByZXR1cm4g\nZW1wdHkgYXJyYXkgaWYgbm8gbm9uLW1hcHBlZCBpbnRlcmZhY2UgaGFzIGJl\nZW4gcmVnaXN0ZXJlZC4KICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YVtdIGdldE5vbk1hcHBlZEludGVyZmFjZXMoKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfbm9u\nTWFwcGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBU\nWV9OT05fUEVSU0lTVEVOVDsKICAgICAgICAgICAgcmV0dXJuIChOb25QZXJz\naXN0ZW50TWV0YURhdGFbXSkgX25vbk1hcHBlZC52YWx1ZXMoKS50b0FycmF5\nKG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGFbX25vbk1hcHBlZC5zaXplKCld\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIG5vbi1tYXBwZWQgaW50ZXJmYWNlIHRvIHRoZSByZXBvc2l0b3J5LgogICAg\nICogCiAgICAgKiBAcGFyYW0gaWZhY2UKICAgICAqICAgICAgICAgICAgdGhl\nIG5vbi1tYXBwZWQgaW50ZXJmYWNlCiAgICAgKi8KICAgIHB1YmxpYyBOb25Q\nZXJzaXN0ZW50TWV0YURhdGEgYWRkTm9uTWFwcGVkSW50ZXJmYWNlKENsYXNz\nPD8+IGlmYWNlKSB7CiAgICAgICAgaWYgKGlmYWNlID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICghaWZhY2UuaXNJbnRl\ncmZhY2UoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub3Qtbm9uLW1hcHBlZCIsIGlmYWNlKSk7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfbm9u\nTWFwcGVkLmNvbnRhaW5zS2V5KGlmYWNlKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKSBfbm9uTWFwcGVkLmdldChp\nZmFjZSk7CiAgICAgICAgICAgIGlmIChnZXRDYWNoZWRNZXRhRGF0YShpZmFj\nZSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm9uLW1hcHBlZC1wYyIsIGlmYWNlKSk7\nCiAgICAgICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBtZXRhID0KICAg\nICAgICAgICAgICAgIG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGEoaWZhY2Us\nIHRoaXMsIE5vblBlcnNpc3RlbnRNZXRhRGF0YS5UWVBFX05PTl9NQVBQRURf\nSU5URVJGQUNFKTsKICAgICAgICAgICAgX25vbk1hcHBlZC5wdXQoaWZhY2Us\nIG1ldGEpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBub24tbWFwcGVkIGludGVyZmFj\nZSBmcm9tIHRoZSByZXBvc2l0b3J5CiAgICAgKiAKICAgICAqIEByZXR1cm4g\ndHJ1ZSBpZiByZW1vdmVkCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZU5vbk1hcHBlZEludGVyZmFjZShDbGFzczw/PiBpZmFjZSkgewogICAg\nICAgIHJldHVybiBfbm9uTWFwcGVkLnJlbW92ZShpZmFjZSkgIT0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIHRoZSBjYWNoZSBvZiBwYXJz\nZWQgbWV0YWRhdGEuIFRoaXMgbWV0aG9kIGFsc28gY2xlYXJzIHRoZSBpbnRl\ncm5hbAogICAgICoge0BsaW5rIE1ldGFEYXRhRmFjdG9yeSBNZXRhRGF0YUZh\nY3Rvcnl9J3MgY2FjaGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFy\nKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nX2xvZy50cmFjZShfbG9jLmdldCgiY2xlYXItcmVwb3MiLCB0aGlzKSk7Cgog\nICAgICAgICAgICBfbWV0YXMuY2xlYXIoKTsKICAgICAgICAgICAgX29pZHMu\nY2xlYXIoKTsKICAgICAgICAgICAgX3N1YnMuY2xlYXIoKTsKICAgICAgICAg\nICAgX2ltcGxzLmNsZWFyKCk7CiAgICAgICAgICAgIF9xdWVyaWVzLmNsZWFy\nKCk7CiAgICAgICAgICAgIF9zZXFzLmNsZWFyKCk7CiAgICAgICAgICAgIF9y\nZWdpc3RlcmVkLmNsZWFyKCk7CiAgICAgICAgICAgIF9mYWN0b3J5LmNsZWFy\nKCk7CiAgICAgICAgICAgIF9hbGlhc2VzLmNsZWFyKCk7CiAgICAgICAgICAg\nIF9wYXdhcmVzLmNsZWFyKCk7CiAgICAgICAgICAgIF9ub25NYXBwZWQuY2xl\nYXIoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHNldCBvZiBjb25maWd1cmVkIHBlcnNpc3RlbnQgY2xhc3Nlcywgb3IgbnVs\nbCBpZiB0aGUgdXNlciBkaWQgbm90IGNvbmZpZ3VyZSBhbnkuCiAgICAgKiAK\nICAgICAqIEBwYXJhbSBkZXZwYXRoCiAgICAgKiAgICAgICAgICAgIGlmIHRy\ndWUsIHNlYXJjaCBmb3IgbWV0YWRhdGEgZmlsZXMgaW4gZGlyZWN0b3JpZXMg\naW4gdGhlIGNsYXNzcGF0aCBpZiBubyBjbGFzc2VzCiAgICAgKiAgICAgICAg\nICAgIGFyZSBjb25maWd1cmVkIGV4cGxpY2l0bHkKICAgICAqIEBwYXJhbSBl\nbnZMb2FkZXIKICAgICAqICAgICAgICAgICAgdGhlIGNsYXNzIGxvYWRlciB0\nbyB1c2UsIG9yIG51bGwgZm9yIGRlZmF1bHQKICAgICAqLwogICAgcHVibGlj\nIFNldDxTdHJpbmc+IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoYm9vbGVhbiBk\nZXZwYXRoLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIF9mYWN0b3J5\nLmdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZGV2cGF0aCwgZW52TG9hZGVyKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCBDb2xsZWN0\naW9uPENsYXNzPD8+PiBsb2FkUGVyc2lzdGVudFR5cGVzKGJvb2xlYW4gZGV2\ncGF0aCwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgcmV0dXJu\nIGxvYWRQZXJzaXN0ZW50VHlwZXMoZGV2cGF0aCwgZW52TG9hZGVyLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBwZXJzaXN0ZW50\nIGNsYXNzZXMgbmFtZWQgaW4gY29uZmlndXJhdGlvbi4gVGhpcyBlbnN1cmVz\nIHRoYXQgYWxsIHN1YmNsYXNzZXMgYW5kCiAgICAgKiBhcHBsaWNhdGlvbiBp\nZGVudGl0eSBjbGFzc2VzIG9mIGVhY2ggdHlwZSBhcmUga25vd24gaW4gYWR2\nYW5jZSwgd2l0aG91dCBoYXZpbmcgdG8gcmVseSBvbiB0aGUKICAgICAqIGFw\ncGxpY2F0aW9uIGxvYWRpbmcgdGhlIGNsYXNzZXMgYmVmb3JlIHBlcmZvcm1p\nbmcgb3BlcmF0aW9ucyB0aGF0IG1pZ2h0IGludm9sdmUgdGhlbS4KICAgICAq\nIAogICAgICogQHBhcmFtIGRldnBhdGgKICAgICAqICAgICAgICAgICAgaWYg\ndHJ1ZSwgc2VhcmNoIGZvciBtZXRhZGF0YSBmaWxlcyBpbiBkaXJlY3Rvcmll\ncyBpbiB0aGUgY2xhc3NwYXRoIGlmIHRoZSBubwogICAgICogICAgICAgICAg\nICBjbGFzc2VzIGFyZSBjb25maWd1cmVkIGV4cGxpY2l0bHkKICAgICAqIEBw\nYXJhbSBlbnZMb2FkZXIKICAgICAqICAgICAgICAgICAgdGhlIGNsYXNzIGxv\nYWRlciB0byB1c2UsIG9yIG51bGwgZm9yIGRlZmF1bHQKICAgICAqIEBwYXJh\nbSBtdXN0RXhpc3QKICAgICAqICAgICAgICAgICAgaWYgdHJ1ZSB0aGVuIGVt\ncHR5IGxpc3Qgb2YgY2xhc3NlcyBvciBhbnkgdW5sb2FkYWJsZSBidXQgc3Bl\nY2lmaWVkIGNsYXNzIHdpbGwKICAgICAqICAgICAgICAgICAgcmFpc2UgYW4g\nZXhjZXB0aW9uLgogICAgICogQHJldHVybiB0aGUgbG9hZGVkIGNsYXNzZXMs\nIG9yIGVtcHR5IGNvbGxlY3Rpb24gaWYgbm9uZQogICAgICovCiAgICBwdWJs\naWMgQ29sbGVjdGlvbjxDbGFzczw/Pj4gbG9hZFBlcnNpc3RlbnRUeXBlcyhi\nb29sZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVh\nbiBtdXN0RXhpc3QpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgU2V0PFN0cmluZz4gbmFtZXMgPSBnZXRQZXJzaXN0ZW50\nVHlwZU5hbWVzKGRldnBhdGgsIGVudkxvYWRlcik7CiAgICAgICAgICAgIGlm\nIChuYW1lcyA9PSBudWxsIHx8IG5hbWVzLmlzRW1wdHkoKSkgewogICAgICAg\nICAgICAgICAgaWYgKCFtdXN0RXhpc3QpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJlYWdlci1uby1jbGFzcy1mb3VuZCIpKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYXR0ZW1wdCB0byBsb2Fk\nIGNsYXNzZXMgc28gdGhhdCB0aGV5IGdldCBwcm9jZXNzZWQKICAgICAgICAg\nICAgQ2xhc3NMb2FkZXIgY2xzTG9hZGVyID0gX2NvbmYuZ2V0Q2xhc3NSZXNv\nbHZlckluc3RhbmNlKCkuZ2V0Q2xhc3NMb2FkZXIoZ2V0Q2xhc3MoKSwgZW52\nTG9hZGVyKTsKICAgICAgICAgICAgTGlzdDxDbGFzczw/Pj4gY2xhc3NlcyA9\nIG5ldyBBcnJheUxpc3Q8Q2xhc3M8Pz4+KG5hbWVzLnNpemUoKSk7CiAgICAg\nICAgICAgIENsYXNzPD8+IGNsczsKICAgICAgICAgICAgZm9yIChTdHJpbmcg\nY2xhc3NOYW1lIDogbmFtZXMpIHsKICAgICAgICAgICAgICAgIGNscyA9IGNs\nYXNzRm9yTmFtZShjbGFzc05hbWUsIGNsc0xvYWRlcik7CiAgICAgICAgICAg\nICAgICBpZiAoX2ZhY3RvcnkuaXNNZXRhQ2xhc3MoY2xzKSkgewogICAgICAg\nICAgICAgICAgICAgIHNldE1ldGFNb2RlbChjbHMpOwogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKGNscyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nY2xhc3Nlcy5hZGQoY2xzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gaWYg\ndGhlIGNsYXNzIGlzIGFuIGludGVyZmFjZSwgbG9hZCBpdHMgbWV0YWRhdGEg\ndG8ga2ljawogICAgICAgICAgICAgICAgICAgIC8vIG9mZiB0aGUgaW1wbCBn\nZW5lcmF0b3IKICAgICAgICAgICAgICAgICAgICBpZiAoY2xzLmlzSW50ZXJm\nYWNlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNs\ncywgY2xzTG9hZGVyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\naWYgKGNscyA9PSBudWxsICYmIG11c3RFeGlzdCkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nZWFnZXItY2xhc3Mtbm90LWZvdW5kIiwgY2xhc3NOYW1lKSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNs\nYXNzZXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBjbGFzcyBmb3IgdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbm90IGxv\nYWRhYmxlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzPD8+IGNsYXNzRm9y\nTmFtZShTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNzLmZvck5hbWUobmFt\nZSwgdHJ1ZSwgbG9hZGVyKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBpZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JV\nTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xv\nYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5hbWUpKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgiYmFkLWRpc2NvdmVyLWNsYXNz\nIiwgbmFtZSkpOwogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShlKTsKICAgICAgICB9\nIGNhdGNoIChOb1N1Y2hNZXRob2RFcnJvciBuc21lKSB7CiAgICAgICAgICAg\nIGlmIChuc21lLmdldE1lc3NhZ2UoKS5pbmRleE9mKCIucGMiKSA9PSAtMSkK\nICAgICAgICAgICAgICAgIHRocm93IG5zbWU7CgogICAgICAgICAgICAvLyBp\nZiB0aGUgZXJyb3IgaXMgYWJvdXQgYSBtZXRob2QgdGhhdCB1c2VzIHRoZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICAgICAgLy8gJ3BjJyBtZXRob2Qg\ncHJlZml4LCBwZXJmb3JtIHNvbWUgbG9nZ2luZyBhbmQgY29udGludWUuIFRo\naXMKICAgICAgICAgICAgLy8gcHJvYmFibHkganVzdCBtZWFucyB0aGF0IHRo\nZSBjbGFzcyBpcyBub3QgeWV0IGVuaGFuY2VkLgogICAgICAgICAgICBpZiAo\nKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsKICAgICAg\nICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1j\nbGFzcyIsIG5hbWUpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfbG9nLmlz\nSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9j\nLmdldCgiYmFkLWRpc2NvdmVyLWNsYXNzIiwgbmFtZSkpOwogICAgICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nX2xvZy50cmFjZShuc21lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGtub3duIHN1\nYmNsYXNzZXMgZm9yIHRoZSBnaXZlbiBjbGFzcyBtYXBwaW5nLiBOb3RlIHRo\nYXQgdGhpcyBtZXRob2Qgb25seSB3b3JrcwogICAgICogZHVyaW5nIHJ1bnRp\nbWUgd2hlbiB0aGUgcmVwb3NpdG9yeSBpcyByZWdpc3RlcmVkIGFzIGEge0Bs\naW5rIFJlZ2lzdGVyQ2xhc3NMaXN0ZW5lcn0uCiAgICAgKi8KICAgIENvbGxl\nY3Rpb248Q2xhc3M8Pz4+IGdldFBDU3ViY2xhc3NlcyhDbGFzczw/PiBjbHMp\nIHsKICAgICAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiBzdWJzID0gX3N1YnMu\nZ2V0KGNscyk7CiAgICAgICAgaWYgKHN1YnMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0\ndXJuIHN1YnM7CiAgICB9CgogICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlZ2lzdGVyQ2xhc3NMaXN0ZW5l\nciBpbXBsZW1lbnRhdGlvbgogICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCByZWdpc3RlcihD\nbGFzcyBjbHMpIHsKICAgICAgICAvLyBidWZmZXIgcmVnaXN0ZXJlZCBjbGFz\nc2VzIHVudGlsIGFuIG9pZCBtZXRhZGF0YSByZXF1ZXN0IGlzIG1hZGUsCiAg\nICAgICAgLy8gYXQgd2hpY2ggcG9pbnQgd2UnbGwgcGFyc2UgZXZlcnl0aGlu\nZyBpbiB0aGUgYnVmZmVyCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIF9yZWdpc3RlcmVkLmFkZChjbHMpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlcyB0aGUgbWV0YWRhdGEgZm9yIGFs\nbCByZWdpc3RlcmVkIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBsb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEoQ2xhc3NMb2FkZXIgZW52\nTG9hZGVyKSB7CiAgICAgICAgQ2xhc3M8Pz5bXSByZWcgPSBwcm9jZXNzUmVn\naXN0ZXJlZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHJlZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEocmVnW2ldLCBlbnZMb2Fk\nZXIsIGZhbHNlKTsKICAgICAgICAgICAgfSBjYXRjaCAoTWV0YURhdGFFeGNl\ncHRpb24gbWUpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4obWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVXBkYXRlcyBvdXIgZGF0YXN0cnVjdHVyZXMgd2l0aCB0aGUgbGF0ZXN0IHJl\nZ2lzdGVyZWQgY2xhc3Nlcy4KICAgICAqLwogICAgQ2xhc3M8Pz5bXSBwcm9j\nZXNzUmVnaXN0ZXJlZENsYXNzZXMoQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7\nCiAgICAgICAgaWYgKF9yZWdpc3RlcmVkLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuIEVNUFRZX0NMQVNTRVM7CgogICAgICAgIC8vIGNvcHkgaW50\nbyBuZXcgY29sbGVjdGlvbiB0byBhdm9pZCBjb25jdXJyZW50IG1vZCBlcnJv\ncnMgb24gcmVlbnRyYW50CiAgICAgICAgLy8gcmVnaXN0cmF0aW9ucwogICAg\nICAgIENsYXNzPD8+W10gcmVnOwogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZWcgPSBfcmVnaXN0ZXJlZC50b0FycmF5KG5l\ndyBDbGFzc1tfcmVnaXN0ZXJlZC5zaXplKCldKTsKICAgICAgICAgICAgX3Jl\nZ2lzdGVyZWQuY2xlYXIoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CgogICAgICAgIENvbGxlY3Rpb248\nU3RyaW5nPiBwY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxz\nZSwgZW52TG9hZGVyKTsKICAgICAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiBm\nYWlsZWQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVn\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIGRvbid0IHByb2Nlc3Mg\ndHlwZXMgdGhhdCBhcmVuJ3QgbGlzdGVkIGJ5IHRoZSB1c2VyOyBtYXkgYmVs\nb25nCiAgICAgICAgICAgIC8vIHRvIGEgZGlmZmVyZW50IHBlcnNpc3RlbmNl\nIHVuaXQKICAgICAgICAgICAgaWYgKHBjTmFtZXMgIT0gbnVsbCAmJiAhcGNO\nYW1lcy5pc0VtcHR5KCkgJiYgIXBjTmFtZXMuY29udGFpbnMocmVnW2ldLmdl\ndE5hbWUoKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBwcm9jZXNzUmVnaXN0ZXJlZENs\nYXNzKHJlZ1tpXSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0\nKSB7CiAgICAgICAgICAgICAgICBpZiAoIV9jb25mLmdldFJldHJ5Q2xhc3NS\nZWdpc3RyYXRpb24oKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVycm9yLXJlZ2lzdGVyZWQi\nLCByZWdbaV0pLCB0KTsKCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJmYWlsZWQtcmVnaXN0ZXJlZCIsIHJlZ1tpXSksIHQpOwogICAg\nICAgICAgICAgICAgaWYgKGZhaWxlZCA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIGZhaWxlZCA9IG5ldyBBcnJheUxpc3Q8Q2xhc3M8Pz4+KCk7CiAg\nICAgICAgICAgICAgICBmYWlsZWQuYWRkKHJlZ1tpXSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIF9yZWdpc3RlcmVkLmFkZEFsbChmYWlsZWQpOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlZzsKICAgIH0K\nCiAgICAvKioKICAgICAqIFVwZGF0ZXMgb3VyIGRhdGFzdHJ1Y3R1cmVzIHdp\ndGggdGhlIGdpdmVuIHJlZ2lzdGVyZWQgY2xhc3MuIFJlbGllcyBvbiB0aGUg\nZmFjdCB0aGF0IGEgY2hpbGQKICAgICAqIGNsYXNzIGNhbm5vdCByZWdpc3Rl\nciBpdHNlbGYgd2l0aG91dCBhbHNvIHJlZ2lzdGVyaW5nIGl0cyBwYXJlbnQg\nY2xhc3MgYnkgc3BlY2lmeWluZyBpdHMKICAgICAqIHBlcnNpc3RlbmNlIGNh\ncGFibGUgc3VwZXJjbGFzcyBpbiB0aGUgcmVnaXN0cmF0aW9uIGV2ZW50Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJvY2Vzc1JlZ2lzdGVyZWRDbGFz\ncyhDbGFzczw/PiBjbHMpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwcm9j\nZXNzLXJlZ2lzdGVyZWQiLCBjbHMpKTsKCiAgICAgICAgLy8gdXBkYXRlIHN1\nYmNsYXNzIGxpc3RzOyBzeW5jaHJvbml6ZSBvbiB0aGlzIGJlY2F1c2UgYWNj\nZXNzaW5nIF9tZXRhcwogICAgICAgIC8vIHJlcXVpcmVzIGl0CiAgICAgICAg\nQ2xhc3M8Pz4gbGVhc3REZXJpdmVkID0gY2xzOwogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7\nCiAgICAgICAgICAgIGZvciAoQ2xhc3M8Pz4gYW5jID0gY2xzOyAoYW5jID0g\nUENSZWdpc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhhbmMpKSAhPSBu\ndWxsOykgewogICAgICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uKF9zdWJz\nLCBhbmMsIGNscywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBtZXRhID0gKENs\nYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoYW5jKTsKICAgICAgICAgICAgICAg\nIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWV0YS5j\nbGVhclN1YmNsYXNzQ2FjaGUoKTsKICAgICAgICAgICAgICAgIGxlYXN0RGVy\naXZlZCA9IGFuYzsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KCiAgICAgICAgLy8g\ndXBkYXRlIG9pZCBtYXBwaW5ncyBpZiB0aGlzIGlzIGEgYmFzZSBjb25jcmV0\nZSBjbGFzcwogICAgICAgIE9iamVjdCBvaWQgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIG9pZCA9IFBDUmVnaXN0cnkubmV3T2JqZWN0SWQo\nY2xzKTsKICAgICAgICB9IGNhdGNoIChJbnRlcm5hbEV4Y2VwdGlvbiBpZSkg\newogICAgICAgICAgICAvLyB0aHJvd24gZm9yIHNpbmdsZSBmaWVsZCBpZGVu\ndGl0eSB3aXRoIG51bGwgcGsgZmllbGQgdmFsdWUKICAgICAgICB9CiAgICAg\nICAgaWYgKG9pZCAhPSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzPD8+IGV4\naXN0aW5nID0gX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAgICAg\nICAgaWYgKGV4aXN0aW5nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8v\nIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBjbGFzcyBmb3IgdGhpcyBPSUQsIHRo\nZW4gd2Uga25vdwogICAgICAgICAgICAgICAgLy8gdGhhdCBtdWx0aXBsZSBj\nbGFzc2VzIGFyZSB1c2luZyB0aGUgc2FtZSBPSUQ6IHRoZXJlZm9yZSwKICAg\nICAgICAgICAgICAgIC8vIHB1dCB0aGUgbGVhc3QgZGVyaXZlZCBQQyBzdXBl\ncmNsYXNzIGludG8gdGhlIG1hcC4gVGhpcwogICAgICAgICAgICAgICAgLy8g\nZ2V0cyBhcm91bmQgdGhlIHByb2JsZW0gb2YgYW4gYWJzdHJhY3QgUEMgc3Vw\nZXJjbGFzcwogICAgICAgICAgICAgICAgLy8gdXNpbmcgYXBwbGljYXRpb24g\naWRlbnRpdHkgKHNpbmNlIG5ld09iamVjdElkCiAgICAgICAgICAgICAgICAv\nLyB3aWxsIHJldHVybiBudWxsIGZvciBhYnN0cmFjdCBjbGFzc2VzKS4KICAg\nICAgICAgICAgICAgIENsYXNzPD8+IHN1cCA9IGNsczsKICAgICAgICAgICAg\nICAgIHdoaWxlIChQQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNz\nKHN1cCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzdXAgPSBQQ1Jl\nZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKHN1cCk7CgogICAgICAg\nICAgICAgICAgX29pZHMucHV0KG9pZC5nZXRDbGFzcygpLCBzdXApOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKGV4aXN0aW5nID09IG51bGwgfHwgY2xzLmlz\nQXNzaWduYWJsZUZyb20oZXhpc3RpbmcpKQogICAgICAgICAgICAgICAgX29p\nZHMucHV0KG9pZC5nZXRDbGFzcygpLCBjbHMpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gdXBkYXRlIG1hcHBpbmdzIGZyb20gaW50ZXJmYWNlcyBhbmQgbm9u\nLXBjIHN1cGVyY2xhc3NlcyB0bwogICAgICAgIC8vIHBjIGltcGxlbWVudGlu\nZyB0eXBlcwogICAgICAgIHN5bmNocm9uaXplZCAoX2ltcGxzKSB7CiAgICAg\nICAgICAgIHVwZGF0ZUltcGxzKGNscywgbGVhc3REZXJpdmVkLCBjbHMpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gc2V0IGFsaWFzIGZvciBjbGFzcwogICAg\nICAgIFN0cmluZyBhbGlhcyA9IFBDUmVnaXN0cnkuZ2V0VHlwZUFsaWFzKGNs\ncyk7CiAgICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsKICAgICAgICAgICAg\nbG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgTGlz\ndDxDbGFzczw/Pj4gY2xhc3NMaXN0ID0gX2FsaWFzZXMuZ2V0KGFsaWFzKTsK\nICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGNsYXNzTGlzdCA9IG5ldyBBcnJheUxpc3Q8Q2xh\nc3M8Pz4+KDMpOwogICAgICAgICAgICAgICAgICAgIF9hbGlhc2VzLnB1dChh\nbGlhcywgY2xhc3NMaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpCiAgICAgICAg\nICAgICAgICAgICAgY2xhc3NMaXN0LmFkZChjbHMpOwogICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUg\ndGhlIGxpc3Qgb2YgaW1wbGVtZW50YXRpb25zIG9mIGJhc2UgY2xhc3NlcyBh\nbmQgaW50ZXJmYWNlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0\nZUltcGxzKENsYXNzPD8+IGNscywgQ2xhc3M8Pz4gbGVhc3REZXJpdmVkLCBD\nbGFzczw/PiBjaGVjaykgewogICAgICAgIC8vIGFsbG93IHVzZXJzIHRvIHF1\nZXJ5IG9uIGNvbW1vbiBub24tcGMgc3VwZXJjbGFzc2VzCiAgICAgICAgQ2xh\nc3M8Pz4gc3VwID0gY2hlY2suZ2V0U3VwZXJjbGFzcygpOwogICAgICAgIGlm\nIChsZWFzdERlcml2ZWQgPT0gY2xzICYmIHN1cCAhPSBudWxsICYmIHN1cCAh\nPSBPYmplY3QuY2xhc3MpIHsKICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9u\nKF9pbXBscywgc3VwLCBjbHMsIGZhbHNlKTsKICAgICAgICAgICAgdXBkYXRl\nSW1wbHMoY2xzLCBsZWFzdERlcml2ZWQsIHN1cCk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBhbGxvdyB1c2VycyB0byBxdWVyeSBvbiBhbnkgaW1wbGVtZW50\nZWQgaW50ZXJmYWNlcyB1bmxlc3MgZGVmYXVsdHMKICAgICAgICAvLyBzYXkg\ndGhlIHVzZXIgbXVzdCBpbXBsZW1lbnQgcGVyc2lzdGVudCBpbnRlcmZhY2Vz\nIGV4cGxpY2l0bHkgaW4gbWV0YQogICAgICAgIGlmICghX2ZhY3RvcnkuZ2V0\nRGVmYXVsdHMoKS5pc0RlY2xhcmVkSW50ZXJmYWNlUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3M8Pz5bXSBpbnRzID0g\nY2hlY2suZ2V0SW50ZXJmYWNlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBkb24n\ndCBtYXAgamF2YS1zdGFuZGFyZCBpbnRlcmZhY2VzCiAgICAgICAgICAgIGlm\nIChpbnRzW2ldLmdldE5hbWUoKS5zdGFydHNXaXRoKCJqYXZhLiIpKQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBvbmx5IG1h\ncCBsZWFzdC1kZXJpdmVkIGludGVyZmFjZSBpbXBsZW1lbnRvcnMKICAgICAg\nICAgICAgaWYgKGxlYXN0RGVyaXZlZCA9PSBjbHMgfHwgaXNMZWFzdERlcml2\nZWRJbXBsKGludHNbaV0sIGNscykpIHsKICAgICAgICAgICAgICAgIGFkZFRv\nQ29sbGVjdGlvbihfaW1wbHMsIGludHNbaV0sIGNscywgZmFsc2UpOwogICAg\nICAgICAgICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFzdERlcml2ZWQsIGlu\ndHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIHRo\nZSBsZWFzdC1kZXJpdmVkIHBlcnNpc3RlbnQgaW1wbGVtZW50b3Igb2YgdGhl\nIGdpdmVuCiAgICAgKiBpbnRlcmZhY2UsIGZhbHNlIG90aGVyd2lzZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzTGVhc3REZXJpdmVkSW1wbChD\nbGFzczw/PiBpbnRlciwgQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgQ2xhc3M8\nPz4gcGFyZW50ID0gUENSZWdpc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFz\ncyhjbHMpOwogICAgICAgIHdoaWxlIChwYXJlbnQgIT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAoQXJyYXlzLmFzTGlzdChwYXJlbnQuZ2V0SW50ZXJmYWNl\ncygpKS5jb250YWlucyhpbnRlcikpCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIHBhcmVudCA9IFBDUmVnaXN0cnkuZ2V0UGVy\nc2lzdGVudFN1cGVyY2xhc3MocGFyZW50KTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdp\ndmVuIHZhbHVlIHRvIHRoZSBjb2xsZWN0aW9uIGNhY2hlZCBpbiB0aGUgZ2l2\nZW4gbWFwIHVuZGVyIHRoZSBnaXZlbiBrZXkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRUb0NvbGxlY3Rpb24oTWFwIG1hcCwgQ2xhc3M8Pz4ga2V5\nLCBDbGFzczw/PiB2YWx1ZSwgYm9vbGVhbiBpbmhlcml0YW5jZSkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDb2xsZWN0\naW9uIGNvbGwgPSAoQ29sbGVjdGlvbikgbWFwLmdldChrZXkpOwogICAgICAg\nICAgICBpZiAoY29sbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\naW5oZXJpdGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICBJbmhlcml0YW5j\nZUNvbXBhcmF0b3IgY29tcCA9IG5ldyBJbmhlcml0YW5jZUNvbXBhcmF0b3Io\nKTsKICAgICAgICAgICAgICAgICAgICBjb21wLnNldEJhc2Uoa2V5KTsKICAg\nICAgICAgICAgICAgICAgICBjb2xsID0gbmV3IFRyZWVTZXQ8Q2xhc3M8Pz4+\nKGNvbXApOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgY29sbCA9IG5ldyBMaW5rZWRMaXN0PENsYXNzPD8+PigpOwogICAg\nICAgICAgICAgICAgbWFwLnB1dChrZXksIGNvbGwpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGNvbGwuYWRkKHZhbHVlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQdXRzIHRoZSBtZXRhIGNsYXNzIGNvcnJlc3BvbmRp\nbmcgdG8gdGhlIGdpdmVuIGVudGl0eSBjbGFzcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0TWV0YU1vZGVsKENsYXNzPD8+IG0yKSB7CiAgICAgICAg\nQ2xhc3M8Pz4gY2xzID0gX2ZhY3RvcnkuZ2V0TWFuYWdlZENsYXNzKG0yKTsK\nICAgICAgICBpZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIF9tZXRhbW9k\nZWwucHV0KGNscywgbTIpOwogICAgfQoKICAgIC8qKgogICAgICogUHV0cyB0\naGUgbWV0YSBjbGFzcyBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBwZXJz\naXN0ZW50IGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNZXRh\nTW9kZWwoQ2xhc3NNZXRhRGF0YSBtZXRhLCBDbGFzczw/PiBtMikgewogICAg\nICAgIF9tZXRhbW9kZWwucHV0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBt\nMik7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtZXRhIGNsYXNz\nIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIHBlcnNpc3RlbnQgY2xhc3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzczw/PiBnZXRNZXRhTW9kZWwoQ2xh\nc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIGxvYWQpIHsKICAgICAgICByZXR1\ncm4gZ2V0TWV0YU1vZGVsKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBsb2Fk\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIG1ldGEgY2xhc3Mg\nY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gY2xhc3MuIElmIGxvYWQgaXMg\nZmFsc2UsIHJldHVybnMgdGhlIG1ldGEKICAgICAqIGNsYXNzIGlmIGhhcyBi\nZWVuIHNldCBmb3IgdGhlIGdpdmVuIHBlcnNpc3RlbnQgY2xhc3MgZWFybGll\nci4gSWYgdGhlIGxvYWQgaXMgdHJ1ZSB0aGVuIGFsc28KICAgICAqIGF0dGVt\ncHRzIHRvIGFwcGx5IHRoZSBjdXJyZW50IG5hbWluZyBwb2xpY3kgdG8gZGVy\naXZlIG1ldGEgY2xhc3MgbmFtZSBhbmQgYXR0ZW1wdHMgdG8gbG9hZAogICAg\nICogdGhlIG1ldGEgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzczw/\nPiBnZXRNZXRhTW9kZWwoQ2xhc3M8Pz4gZW50aXR5LCBib29sZWFuIGxvYWQp\nIHsKICAgICAgICBpZiAoX21ldGFtb2RlbC5jb250YWluc0tleShlbnRpdHkp\nKQogICAgICAgICAgICByZXR1cm4gX21ldGFtb2RlbC5nZXQoZW50aXR5KTsK\nICAgICAgICBTdHJpbmcgbTIgPSBfZmFjdG9yeS5nZXRNZXRhTW9kZWxDbGFz\nc05hbWUoZW50aXR5LmdldE5hbWUoKSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgQ2xhc3M8Pz4gbTJjbHMgPSBKMkRvUHJpdkhlbHBlci5nZXRGb3JO\nYW1lQWN0aW9uKG0yLCB0cnVlLCBlbnRpdHkuZ2V0Q2xhc3NMb2FkZXIoKSku\ncnVuKCk7CiAgICAgICAgICAgIF9tZXRhbW9kZWwucHV0KGVudGl0eSwgbTJj\nbHMpOwogICAgICAgICAgICByZXR1cm4gbTJjbHM7CiAgICAgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJtZXRhLW5vLW1vZGVsIiwgbTIsIGVudGl0eSwgdCkpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvLyAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uZmlndXJhYmxlIGltcGxl\nbWVudGF0aW9uCiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29uZmlndXJh\ndGlvbiBjb25mKSB7CiAgICAgICAgX2NvbmYgPSAoT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24pIGNvbmY7CiAgICAgICAgX2xvZyA9IF9jb25mLmdldExvZyhPcGVu\nSlBBQ29uZmlndXJhdGlvbi5MT0dfTUVUQURBVEEpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAgIF9sb2Nr\nID0gbmV3IFJlZW50cmFudExvY2soKTsKICAgICAgICAKICAgICAgICBpbml0\naWFsaXplTWV0YURhdGFGYWN0b3J5KCk7CiAgICAgICAgaWYgKF9pbXBsR2Vu\nID09IG51bGwpCiAgICAgICAgICAgIF9pbXBsR2VuID0gbmV3IEludGVyZmFj\nZUltcGxHZW5lcmF0b3IodGhpcyk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGluaXRpYWxpemVNZXRhRGF0YUZhY3RvcnkoKSB7CiAgICAgICAgaWYgKF9m\nYWN0b3J5ID09IG51bGwpIHsKICAgICAgICAgICAgTWV0YURhdGFGYWN0b3J5\nIG1kZiA9IF9jb25mLm5ld01ldGFEYXRhRmFjdG9yeUluc3RhbmNlKCk7CiAg\nICAgICAgICAgIGlmIChtZGYgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YWRh\ndGFmYWN0b3J5IikpOwogICAgICAgICAgICBzZXRNZXRhRGF0YUZhY3Rvcnko\nbWRmKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gUXVlcnkgbWV0YWRhdGEKICAgIC8vIC8vLy8vLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIFJldHVybiBxdWVyeSBtZXRhZGF0YSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzLCBuYW1lLCBhbmQgY2xhc3Nsb2FkZXIuCiAgICAg\nKi8KICAgIHB1YmxpYyBRdWVyeU1ldGFEYXRhIGdldFF1ZXJ5TWV0YURhdGEo\nQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9h\nZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGEgPSBn\nZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2FkZXIp\nOwogICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAvLyBsb2FkIGFsbCB0aGUgbWV0YWRhdGFzIGZvciBhbGwgdGhlIGtu\nb3duIGNsYXNzZXMgc28gdGhhdAogICAgICAgICAgICAgICAgLy8gcXVlcnkg\nbmFtZXMgYXJlIHNlZW4gYW5kIHJlZ2lzdGVyZWQKICAgICAgICAgICAgICAg\nIHJlc29sdmVBbGwoZW52TG9hZGVyKTsKICAgICAgICAgICAgICAgIG1ldGEg\nPSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2Fk\nZXIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobWV0YSA9PSBu\ndWxsICYmIG11c3RFeGlzdCkgewogICAgICAgICAgICAgICAgaWYgKGNscyA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYW1lZC1xdWVyeS1udWxsLWNs\nYXNzIiwgZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwKICAgICAgICAg\nICAgICAgICAgICAgICAgZW52TG9hZGVyKSwgbmFtZSkpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hbWVkLXF1ZXJ5Iiwg\nY2xzLCBuYW1lKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlc29sdmUgYWxsIGtub3duIG1ldGFkYXRhIGNsYXNzZXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXNvbHZlQWxsKENsYXNzTG9h\nZGVyIGVudkxvYWRlcikgewogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+\nIHR5cGVzID0gbG9hZFBlcnNpc3RlbnRUeXBlcyhmYWxzZSwgZW52TG9hZGVy\nKTsKICAgICAgICBmb3IgKENsYXNzPD8+IGMgOiB0eXBlcykgewogICAgICAg\nICAgICBnZXRNZXRhRGF0YShjLCBlbnZMb2FkZXIsIGZhbHNlKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gcXVlcnkgbWV0YWRh\ndGEgZm9yIHRoZSBnaXZlbiBjbGFzcywgbmFtZSwgYW5kIGNsYXNzbG9hZGVy\nLgogICAgICovCiAgICBwcml2YXRlIFF1ZXJ5TWV0YURhdGEgZ2V0UXVlcnlN\nZXRhRGF0YUludGVybmFsKENsYXNzPD8+IGNscywgU3RyaW5nIG5hbWUsIENs\nYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChuYW1lID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIFF1ZXJ5TWV0\nYURhdGEgcW0gPSBudWxsOwogICAgICAgIGlmIChjbHMgPT0gbnVsbCkgewog\nICAgICAgICAgICBxbSA9IHNlYXJjaFF1ZXJ5TWV0YURhdGFCeU5hbWUobmFt\nZSk7CiAgICAgICAgICAgIGlmIChxbSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHFtOwogICAgICAgIH0KICAgICAgICAvLyBjaGVjayBjYWNo\nZQogICAgICAgIE9iamVjdCBrZXkgPSBnZXRRdWVyeUtleShjbHMsIG5hbWUp\nOwogICAgICAgIHFtID0gKFF1ZXJ5TWV0YURhdGEpIF9xdWVyaWVzLmdldChr\nZXkpOwogICAgICAgIGlmIChxbSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gcW07CgogICAgICAgIC8vIGdldCBtZXRhZGF0YSBmb3IgY2xhc3MsIHdo\naWNoIHdpbGwgZmluZCBxdWVyaWVzIGluIG1ldGFkYXRhIGZpbGUKICAgICAg\nICBpZiAoY2xzICE9IG51bGwgJiYgZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2Fk\nZXIsIGZhbHNlKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHFtID0gX3F1ZXJp\nZXMuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmIChxbSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHFtOwogICAgICAgIH0KICAgICAgICBpZiAo\nKF9zb3VyY2VNb2RlICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIC8vIHNlZSBpZiBmYWN0b3J5IGNhbiBm\naWd1cmUgb3V0IGEgc2NvcGUgZm9yIHRoaXMgcXVlcnkKICAgICAgICBpZiAo\nY2xzID09IG51bGwpCiAgICAgICAgICAgIGNscyA9IF9mYWN0b3J5LmdldFF1\nZXJ5U2NvcGUobmFtZSwgZW52TG9hZGVyKTsKCiAgICAgICAgLy8gbm90IGlu\nIGNhY2hlOyBsb2FkCiAgICAgICAgX2ZhY3RvcnkubG9hZChjbHMsIE1PREVf\nUVVFUlksIGVudkxvYWRlcik7CiAgICAgICAgcmV0dXJuIF9xdWVyaWVzLmdl\ndChrZXkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNo\nZWQgcXVlcnkgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeU1l\ndGFEYXRhW10gZ2V0UXVlcnlNZXRhRGF0YXMoKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmllcy52\nYWx1ZXMoKS50b0FycmF5KG5ldyBRdWVyeU1ldGFEYXRhW19xdWVyaWVzLnNp\nemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZS4K\nICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURhdGEgZ2V0Q2FjaGVkUXVl\ncnlNZXRhRGF0YShDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBf\ncXVlcmllcy5nZXQoZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbmV3IHF1ZXJ5IG1ldGFkYXRh\nIHRvIHRoZSByZXBvc2l0b3J5IGFuZCByZXR1cm4gaXQuCiAgICAgKi8KICAg\nIHB1YmxpYyBRdWVyeU1ldGFEYXRhIGFkZFF1ZXJ5TWV0YURhdGEoQ2xhc3M8\nPz4gY2xzLCBTdHJpbmcgbmFtZSkgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnl7CiAgICAgICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IG5ld1F1\nZXJ5TWV0YURhdGEoY2xzLCBuYW1lKTsKICAgICAgICAgICAgX3F1ZXJpZXMu\ncHV0KGdldFF1ZXJ5S2V5KG1ldGEpLCBtZXRhKTsKICAgICAgICAgICAgcmV0\ndXJuIG1ldGE7CiAgICAgICAgfWZpbmFsbHl7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBh\nIG5ldyBxdWVyeSBtZXRhZGF0YSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFF1ZXJ5TWV0YURhdGEgbmV3UXVlcnlNZXRhRGF0YShDbGFzczw/\nPiBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IG5ldyBR\ndWVyeU1ldGFEYXRhKG5hbWUpOwogICAgICAgICAgICBtZXRhLnNldERlZmlu\naW5nVHlwZShjbHMpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIHF1ZXJ5\nIG1ldGFkYXRhIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURhdGEoUXVlcnlNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJu\nIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtleShtZXRhKSkgIT0gbnVsbDsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgcXVlcnkgbWV0\nYWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGlmIGluIHRoZSByZXBv\nc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVRdWVy\neU1ldGFEYXRhKENsYXNzPD8+IGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKG5hbWUg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtleShjbHMs\nIG5hbWUpKSAhPSBudWxsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFNlYXJjaGVzIGFsbCBjYWNoZWQgcXVlcnkgbWV0YWRhdGEgYnkgbmFtZS4K\nICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURhdGEgc2VhcmNoUXVlcnlN\nZXRhRGF0YUJ5TmFtZShTdHJpbmcgbmFtZSkgewogICAgICAgIGZvciAoT2Jq\nZWN0IGtleSA6IF9xdWVyaWVzLmtleVNldCgpKSB7CiAgICAgICAgICAgIGlm\nIChrZXkgaW5zdGFuY2VvZiBRdWVyeUtleSkKICAgICAgICAgICAgICAgIGlm\nIChTdHJpbmdVdGlscy5lcXVhbHMoKChRdWVyeUtleSkga2V5KS5uYW1lLCBu\nYW1lKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURh\ndGEpIF9xdWVyaWVzLmdldChrZXkpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1\nZSBrZXkgZm9yIGEgZ2l2ZW4gUXVlcnlNZXRhRGF0YS4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGdldFF1ZXJ5S2V5KFF1ZXJ5TWV0YURh\ndGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBnZXRRdWVyeUtleSht\nZXRhLmdldERlZmluaW5nVHlwZSgpLCBtZXRhLmdldE5hbWUoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciBhIGdp\ndmVuIGNsYXNzIC8gbmFtZS4gVGhlIGNsYXNzIGFyZ3VtZW50IGNhbiBiZSBu\ndWxsLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIE9iamVjdCBnZXRR\ndWVyeUtleShDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAg\naWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAg\nICAgICBRdWVyeUtleSBrZXkgPSBuZXcgUXVlcnlLZXkoKTsKICAgICAgICBr\nZXkuY2xzTmFtZSA9IGNscy5nZXROYW1lKCk7CiAgICAgICAga2V5Lm5hbWUg\nPSBuYW1lOwogICAgICAgIHJldHVybiBrZXk7CiAgICB9CgogICAgLy8gLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VxdWVuY2UgbWV0YWRhdGEKICAg\nIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVy\nbiBzZXF1ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5hbWUgYW5kIGNs\nYXNzbG9hZGVyLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0\nYSBnZXRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lLCBDbGFzc0xvYWRl\nciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNlcXVlbmNlTWV0YURh\ndGEgbWV0YSA9IGdldFNlcXVlbmNlTWV0YURhdGFJbnRlcm5hbChuYW1lLCBl\nbnZMb2FkZXIpOwogICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsICYmIFNl\ncXVlbmNlTWV0YURhdGEuTkFNRV9TWVNURU0uZXF1YWxzKG5hbWUpKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX3N5c1NlcSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIF9zeXNTZXEgPSBuZXdTZXF1ZW5jZU1ldGFEYXRhKG5hbWUp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIF9zeXNTZXE7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhpc3Qp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLW5hbWVkLXNlcXVlbmNlIiwgbmFtZSkpOwogICAgICAg\nICAgICByZXR1cm4gbWV0YTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBVc2VkIGludGVybmFsbHkgYnkgbWV0YWRhdGEgdG8gcmV0cmlldmUgc2Vx\ndWVuY2UgbWV0YWRhdGFzIGJhc2VkIG9uIHBvc3NpYmx5LXVucXVhbGlmaWVk\nCiAgICAgKiBzZXF1ZW5jZSBuYW1lLgogICAgICovCiAgICBTZXF1ZW5jZU1l\ndGFEYXRhIGdldFNlcXVlbmNlTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBjb250\nZXh0LCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAg\nICAvLyB0cnkgd2l0aCBnaXZlbiBuYW1lCiAgICAgICAgTWV0YURhdGFFeGNl\ncHRpb24gZSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU2Vx\ndWVuY2VNZXRhRGF0YSBzZXEgPSBnZXRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUs\nIGNvbnRleHQuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgbXVzdEV4aXN0KTsKICAg\nICAgICAgICAgaWYgKHNlcSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHNlcTsKICAgICAgICB9IGNhdGNoIChNZXRhRGF0YUV4Y2VwdGlvbiBt\nZGUpIHsKICAgICAgICAgICAgZSA9IG1kZTsKICAgICAgICB9CgogICAgICAg\nIC8vIGlmIGdpdmVuIG5hbWUgYWxyZWFkeSBmdWxseSBxdWFsaWZpZWQsIGdp\ndmUgdXAKICAgICAgICBpZiAobmFtZS5pbmRleE9mKCcuJykgIT0gLTEpIHsK\nICAgICAgICAgICAgaWYgKGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRo\ncm93IGU7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdHJ5IHdpdGggcXVhbGlmaWVkIG5hbWUKICAgICAgICBuYW1l\nID0gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShjb250ZXh0LmdldERlc2NyaWJl\nZFR5cGUoKSkgKyAiLiIgKyBuYW1lOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiBnZXRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUsIGNvbnRleHQu\nZ2V0RW52Q2xhc3NMb2FkZXIoKSwgbXVzdEV4aXN0KTsKICAgICAgICB9IGNh\ndGNoIChNZXRhRGF0YUV4Y2VwdGlvbiBtZGUpIHsKICAgICAgICAgICAgLy8g\ndGhyb3cgb3JpZ2luYWwgZXhjZXB0aW9uCiAgICAgICAgICAgIGlmIChlICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB0\naHJvdyBtZGU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHNlcXVlbmNlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZSBhbmQg\nY2xhc3Nsb2FkZXIuCiAgICAgKi8KICAgIHByaXZhdGUgU2VxdWVuY2VNZXRh\nRGF0YSBnZXRTZXF1ZW5jZU1ldGFEYXRhSW50ZXJuYWwoU3RyaW5nIG5hbWUs\nIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChuYW1lID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBj\naGVjayBjYWNoZQogICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IF9z\nZXFzLmdldChuYW1lKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIGxvYWQgbWV0YWRhdGEgZm9yIHJlZ2lzdGVyZWQgY2xh\nc3NlcyB0byBob3BlZnVsbHkgZmluZCBzZXF1ZW5jZQogICAgICAgICAgICAv\nLyBkZWZpbml0aW9uCiAgICAgICAgICAgIGxvYWRSZWdpc3RlcmVkQ2xhc3NN\nZXRhRGF0YShlbnZMb2FkZXIpOwogICAgICAgICAgICBtZXRhID0gX3NlcXMu\nZ2V0KG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHNlcXVlbmNl\nIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0\nYVtdIGdldFNlcXVlbmNlTWV0YURhdGFzKCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gX3NlcXMudmFsdWVz\nKCkudG9BcnJheShuZXcgU2VxdWVuY2VNZXRhRGF0YVtfc2Vxcy5zaXplKCld\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNh\nY2hlZCBhIHNlcXVlbmNlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZS4K\nICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlTWV0YURhdGEgZ2V0Q2FjaGVk\nU2VxdWVuY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gX3NlcXMuZ2V0\nKG5hbWUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG5l\ndyBzZXF1ZW5jZSBtZXRhZGF0YSB0byB0aGUgcmVwb3NpdG9yeSBhbmQgcmV0\ndXJuIGl0LgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBh\nZGRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNlcXVlbmNlTWV0YURh\ndGEgbWV0YSA9IG5ld1NlcXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAg\nICAgIF9zZXFzLnB1dChuYW1lLCBtZXRhKTsKICAgICAgICAgICAgcmV0dXJu\nIG1ldGE7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nbmV3IHNlcXVlbmNlIG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU2VxdWVuY2VNZXRhRGF0YSBuZXdTZXF1ZW5jZU1ldGFEYXRh\nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZXF1ZW5jZU1l\ndGFEYXRhKG5hbWUsIHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIHRoZSBnaXZlbiBzZXF1ZW5jZSBtZXRhZGF0YSBmcm9tIHRoZSByZXBv\nc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVTZXF1\nZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAobWV0YSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICByZXR1cm4gX3NlcXMucmVtb3ZlKG1ldGEuZ2V0TmFtZSgpKSAhPSBu\ndWxsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBzZXF1\nZW5jZSBtZXRhZGF0YSBmb3IgdGhlIG5hbWUgaWYgaW4gdGhlIHJlcG9zaXRv\ncnkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVNlcXVlbmNl\nTWV0YURhdGEoU3RyaW5nIG5hbWUpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIF9z\nZXFzLnJlbW92ZShuYW1lKSAhPSBudWxsOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gc3lzdGVtIGxpZmVjeWNsZSBsaXN0\nZW5lci4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkU3lzdGVtTGlzdGVu\nZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIGNvcHkgdG8gYXZvaWQgaXNzdWVzIHdp\ndGggTGlzdGVuZXJMaXN0IGFuZCBhdm9pZCB1bm5jZXNzYXJ5CiAgICAgICAg\nICAgIC8vIGxvY2tpbmcgb24gdGhlIGxpc3QgZHVyaW5nIHJ1bnRpbWUKICAg\nICAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBs\naXN0ZW5lcnMgPSBuZXcgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVy\nTGlzdChfbGlzdGVuZXJzKTsKICAgICAgICAgICAgbGlzdGVuZXJzLmFkZChs\naXN0ZW5lcik7CiAgICAgICAgICAgIF9saXN0ZW5lcnMgPSBsaXN0ZW5lcnM7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZl\nbiBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVyLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVTeXN0ZW1MaXN0ZW5lcihPYmplY3QgbGlzdGVu\nZXIpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKCFfbGlzdGVuZXJzLmNvbnRhaW5zKGxpc3RlbmVyKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIGNvcHkg\ndG8gYXZvaWQgaXNzdWVzIHdpdGggTGlzdGVuZXJMaXN0IGFuZCBhdm9pZCB1\nbm5jZXNzYXJ5CiAgICAgICAgICAgIC8vIGxvY2tpbmcgb24gdGhlIGxpc3Qg\nZHVyaW5nIHJ1bnRpbWUKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyLkxpc3RlbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcgTGlmZWN5Y2xlRXZl\nbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdChfbGlzdGVuZXJzKTsKICAgICAgICAg\nICAgbGlzdGVuZXJzLnJlbW92ZShsaXN0ZW5lcik7CiAgICAgICAgICAgIF9s\naXN0ZW5lcnMgPSBsaXN0ZW5lcnM7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc3lz\ndGVtIGxpZmVjeWNsZSBsaXN0ZW5lcnMKICAgICAqLwogICAgcHVibGljIExp\nZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QgZ2V0U3lzdGVtTGlz\ndGVuZXJzKCkgewogICAgICAgIHJldHVybiBfbGlzdGVuZXJzOwogICAgfQoK\nICAgIC8qKgogICAgICogRnJlZSB0aGUgcmVzb3VyY2VzIHVzZWQgYnkgdGhp\ncyByZXBvc2l0b3J5LiBDbG9zZXMgYWxsIHVzZXIgc2VxdWVuY2VzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0YVtd\nIHNtZHMgPSBnZXRTZXF1ZW5jZU1ldGFEYXRhcygpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHNtZHMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBzbWRzW2ldLmNsb3NlKCk7CiAgICAgICAgICAgIGNsZWFyKCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUXVlcnkga2V5IHN0cnVj\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUXVlcnlLZXkg\naW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBwdWJsaWMgU3Ry\naW5nIGNsc05hbWU7CiAgICAgICAgcHVibGljIFN0cmluZyBuYW1lOwoKICAg\nICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQg\nY2xzSGFzaCA9IChjbHNOYW1lID09IG51bGwpID8gMCA6IGNsc05hbWUuaGFz\naENvZGUoKTsKICAgICAgICAgICAgaW50IG5hbWVIYXNoID0gKG5hbWUgPT0g\nbnVsbCkgPyAwIDogbmFtZS5oYXNoQ29kZSgpOwogICAgICAgICAgICByZXR1\ncm4gY2xzSGFzaCArIG5hbWVIYXNoOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvYmopIHsKICAgICAgICAgICAg\naWYgKG9iaiA9PSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIFF1ZXJ5S2V5KSkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIFF1\nZXJ5S2V5IHFrID0gKFF1ZXJ5S2V5KSBvYmo7CiAgICAgICAgICAgIHJldHVy\nbiBTdHJpbmdVdGlscy5lcXVhbHMoY2xzTmFtZSwgcWsuY2xzTmFtZSkgJiYg\nU3RyaW5nVXRpbHMuZXF1YWxzKG5hbWUsIHFrLm5hbWUpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBYTUwgbWV0YWRhdGEgZm9y\nIGEgZ2l2ZW4gZmllbGQgbWV0YWRhdGEKICAgICAqIAogICAgICogQHBhcmFt\nIGZtZAogICAgICogQHJldHVybiBYTUwgbWV0YWRhdGEKICAgICAqLwogICAg\ncHVibGljIFhNTE1ldGFEYXRhIGdldFhNTE1ldGFEYXRhKEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIENsYXNzPD8+IGNscyA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsK\nICAgICAgICAgICAgLy8gY2hlY2sgaWYgY2FjaGVkIGJlZm9yZQogICAgICAg\nICAgICBYTUxNZXRhRGF0YSB4bWxtZXRhID0gX3htbG1ldGFzLmdldChjbHMp\nOwogICAgICAgICAgICBpZiAoeG1sbWV0YSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIHhtbG1ldGE7CgogICAgICAgICAgICAvLyBsb2FkIEpB\nWEIgWE1MIG1ldGFkYXRhCiAgICAgICAgICAgIF9mYWN0b3J5LmxvYWRYTUxN\nZXRhRGF0YShmbWQpOwoKICAgICAgICAgICAgeG1sbWV0YSA9IChYTUxDbGFz\nc01ldGFEYXRhKSBfeG1sbWV0YXMuZ2V0KGNscyk7CgogICAgICAgICAgICBy\nZXR1cm4geG1sbWV0YTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBD\ncmVhdGUgYSBuZXcgbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVs\ndCBpbmZvcm1hdGlvbiwgYWRkIGl0IHRvIHRoZSByZXBvc2l0b3J5LCBhbmQK\nICAgICAqIHJldHVybiBpdC4KICAgICAqIAogICAgICogQHBhcmFtIGFjY2Vz\ncwogICAgICogICAgICAgICAgICB0aGUgYWNjZXNzIHR5cGUgdG8gdXNlIGlu\nIHBvcHVsYXRpbmcgbWV0YWRhdGEKICAgICAqLwogICAgcHVibGljIFhNTENs\nYXNzTWV0YURhdGEgYWRkWE1MTWV0YURhdGEoQ2xhc3M8Pz4gdHlwZSwgU3Ry\naW5nIG5hbWUpIHsKICAgICAgICBYTUxDbGFzc01ldGFEYXRhIG1ldGEgPSBu\nZXdYTUxDbGFzc01ldGFEYXRhKHR5cGUsIG5hbWUpOwogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfeG1sbWV0YXMucHV0KHR5\ncGUsIG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIFhNTENsYXNzTWV0\nYURhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcyBSZXR1cm4gbnVsbCBpZiBub25l\nLgogICAgICovCiAgICBwdWJsaWMgWE1MTWV0YURhdGEgZ2V0Q2FjaGVkWE1M\nTWV0YURhdGEoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgcmV0dXJuIF94bWxt\nZXRhcy5nZXQoY2xzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBh\nIG5ldyB4bWwgY2xhc3MgbWV0YWRhdGEKICAgICAqIAogICAgICogQHBhcmFt\nIHR5cGUKICAgICAqIEBwYXJhbSBuYW1lCiAgICAgKiBAcmV0dXJuIGEgWE1M\nQ2xhc3NNZXRhRGF0YQogICAgICovCiAgICBwcm90ZWN0ZWQgWE1MQ2xhc3NN\nZXRhRGF0YSBuZXdYTUxDbGFzc01ldGFEYXRhKENsYXNzPD8+IHR5cGUsIFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBYTUxDbGFzc01ldGFE\nYXRhKHR5cGUsIG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IHhtbCBmaWVsZCBtZXRhLCBhZGQgaXQgdG8gdGhlIGZpZWxkTWFw\nIGluIHRoZSBnaXZlbiB4bWwgY2xhc3MgbWV0YWRhdGEKICAgICAqIAogICAg\nICogQHBhcmFtIHR5cGUKICAgICAqIEBwYXJhbSBuYW1lCiAgICAgKiBAcGFy\nYW0gbWV0YQogICAgICogQHJldHVybiBhIFhNTEZpZWxkTWV0YURhdGEKICAg\nICAqLwogICAgcHVibGljIFhNTEZpZWxkTWV0YURhdGEgbmV3WE1MRmllbGRN\nZXRhRGF0YShDbGFzczw/PiB0eXBlLCBTdHJpbmcgbmFtZSkgewogICAgICAg\nIHJldHVybiBuZXcgWE1MRmllbGRNZXRhRGF0YSh0eXBlLCBuYW1lKTsKICAg\nIH0KfQo=\n","encoding":"base64"}

