{"sha":"b3d6ea24f8344555e5cb980c3d70ed0c068a41ca","node_id":"MDQ6QmxvYjIwNjM2NDpiM2Q2ZWEyNGY4MzQ0NTU1ZTVjYjk4MGMzZDcwZWQwYzA2OGE0MWNh","size":28008,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b3d6ea24f8344555e5cb980c3d70ed0c068a41ca","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmY7CgppbXBvcnQg\namF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwppbXBvcnQgamF2YS51dGlsLk1pc3NpbmdSZXNvdXJjZUV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwppbXBvcnQgamF2YS51dGls\nLlRyZWVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJy\nZW50SGFzaE1hcDsKCmltcG9ydCBqYXZheC5uYW1pbmcuQ29udGV4dDsKaW1w\nb3J0IGphdmF4Lm5hbWluZy5Jbml0aWFsQ29udGV4dDsKaW1wb3J0IGphdmF4\nLm5hbWluZy5OYW1pbmdFeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5j\nb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5leGNlcHRpb24uTmVzdGFibGVSdW50aW1lRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5NdWx0aUNs\nYXNzTG9hZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nUGFyc2VFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50UmVmZXJlbmNlSGFz\naE1hcDsKCmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBVdGls\naXR5IG1ldGhvZHMgZGVhbGluZyB3aXRoIGNvbmZpZ3VyYXRpb24uCiAqCiAq\nIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBj\nbGFzcyBDb25maWd1cmF0aW9ucyB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAg\nICAgIChDb25maWd1cmF0aW9ucy5jbGFzcyk7CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwIF9sb2Fk\nZXJzID0gbmV3CiAgICAgICAgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAo\nQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAuV0VBSywgCiAgICAgICAgICAg\nICAgICBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1hcC5IQVJEKTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgTlVMTF9MT0FERVIgPSAibnVs\nbC1sb2FkZXIiOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjbGFzcyBu\nYW1lIGZyb20gdGhlIGdpdmVuIHBsdWdpbiBzdHJpbmcsIG9yIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0Q2xh\nc3NOYW1lKFN0cmluZyBwbHVnaW4pIHsKICAgICAgICByZXR1cm4gZ2V0UGx1\nZ2luQ29tcG9uZW50KHBsdWdpbiwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHByb3BlcnRpZXMgcGFydCBvZiB0aGUgZ2l2ZW4g\ncGx1Z2luIHN0cmluZywgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIFN0cmluZyBnZXRQcm9wZXJ0aWVzKFN0cmluZyBwbHVn\naW4pIHsKICAgICAgICByZXR1cm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdp\nbiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGVpdGhl\nciB0aGUgY2xhc3MgbmFtZSBvciBwcm9wZXJ0aWVzIHN0cmluZyBmcm9tIGEg\ncGx1Z2luIHN0cmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3Ry\naW5nIGdldFBsdWdpbkNvbXBvbmVudChTdHJpbmcgcGx1Z2luLCBib29sZWFu\nIGNsc05hbWUpIHsKICAgICAgICBpZiAocGx1Z2luICE9IG51bGwpCiAgICAg\nICAgICAgIHBsdWdpbiA9IHBsdWdpbi50cmltKCk7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkocGx1Z2luKSkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIGludCBvcGVuUGFyZW4gPSAtMTsKICAgICAgICBp\nZiAocGx1Z2luLmNoYXJBdChwbHVnaW4ubGVuZ3RoKCkgLSAxKSA9PSAnKScp\nCiAgICAgICAgICAgIG9wZW5QYXJlbiA9IHBsdWdpbi5pbmRleE9mKCcoJyk7\nCiAgICAgICAgaWYgKG9wZW5QYXJlbiA9PSAtMSkgewogICAgICAgICAgICBp\nbnQgZXEgPSBwbHVnaW4uaW5kZXhPZignPScpOwogICAgICAgICAgICBpZiAo\nZXEgPT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gKGNsc05hbWUpID8g\ncGx1Z2luIDogbnVsbDsKICAgICAgICAgICAgcmV0dXJuIChjbHNOYW1lKSA/\nIG51bGwgOiBwbHVnaW47CiAgICAgICAgfQoKICAgICAgICAvLyBjbHNOYW1l\nKHByb3BzKSBmb3JtCiAgICAgICAgaWYgKGNsc05hbWUpCiAgICAgICAgICAg\nIHJldHVybiBwbHVnaW4uc3Vic3RyaW5nKDAsIG9wZW5QYXJlbikudHJpbSgp\nOwogICAgICAgIFN0cmluZyBwcm9wID0gcGx1Z2luLnN1YnN0cmluZyhvcGVu\nUGFyZW4gKyAxLAogICAgICAgICAgICBwbHVnaW4ubGVuZ3RoKCkgLSAxKS50\ncmltKCk7CiAgICAgICAgcmV0dXJuIChwcm9wLmxlbmd0aCgpID09IDApID8g\nbnVsbCA6IHByb3A7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRo\nZSBnaXZlbiBjbGFzcyBuYW1lIGFuZCBwcm9wZXJ0aWVzIGludG8gYSBwbHVn\naW4gc3RyaW5nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBn\nZXRQbHVnaW4oU3RyaW5nIGNsc05hbWUsIFN0cmluZyBwcm9wcykgewogICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGNsc05hbWUpKQogICAgICAg\nICAgICByZXR1cm4gcHJvcHM7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkocHJvcHMpKQogICAgICAgICAgICByZXR1cm4gY2xzTmFtZTsKICAg\nICAgICByZXR1cm4gY2xzTmFtZSArICIoIiArIHByb3BzICsgIikiOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgcGx1Z2luIHN0cmluZyB0aGF0\nIGNvbWJpbmVzIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBnaXZlbiBwbHVnaW4K\nICAgICAqIHN0cmluZ3MsIHdoZXJlIHByb3BlcnRpZXMgb2YgPGNvZGU+b3Zl\ncnJpZGU8L2NvZGU+IHdpbGwgb3ZlcnJpZGUgdGhlCiAgICAgKiBzYW1lIHBy\nb3BlcnRpZXMgb2YgPGNvZGU+b3JpZzwvY29kZT4uCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgU3RyaW5nIGNvbWJpbmVQbHVnaW5zKFN0cmluZyBvcmln\nLCBTdHJpbmcgb3ZlcnJpZGUpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShvcmlnKSkKICAgICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOwog\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXJyaWRlKSkKICAg\nICAgICAgICAgcmV0dXJuIG9yaWc7CgogICAgICAgIFN0cmluZyBvcmlnQ2xz\nID0gZ2V0Q2xhc3NOYW1lKG9yaWcpOwogICAgICAgIFN0cmluZyBvdmVycmlk\nZUNscyA9IGdldENsYXNzTmFtZShvdmVycmlkZSk7CiAgICAgICAgU3RyaW5n\nIGNsczsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnQ2xz\nKSkKICAgICAgICAgICAgY2xzID0gb3ZlcnJpZGVDbHM7CiAgICAgICAgZWxz\nZSBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvdmVycmlkZUNscykpCiAgICAg\nICAgICAgIGNscyA9IG9yaWdDbHM7CiAgICAgICAgZWxzZSBpZiAoIW9yaWdD\nbHMuZXF1YWxzKG92ZXJyaWRlQ2xzKSkKICAgICAgICAgICAgcmV0dXJuIG92\nZXJyaWRlOyAvLyBjb21wbGV0ZWx5IGRpZmZlcmVudCBwbHVnaW4KICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGNscyA9IG9yaWdDbHM7CgogICAgICAgIFN0\ncmluZyBvcmlnUHJvcHMgPSBnZXRQcm9wZXJ0aWVzKG9yaWcpOwogICAgICAg\nIFN0cmluZyBvdmVycmlkZVByb3BzID0gZ2V0UHJvcGVydGllcyhvdmVycmlk\nZSk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkob3JpZ1Byb3Bz\nKSkKICAgICAgICAgICAgcmV0dXJuIGdldFBsdWdpbihjbHMsIG92ZXJyaWRl\nUHJvcHMpOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXJy\naWRlUHJvcHMpKQogICAgICAgICAgICByZXR1cm4gZ2V0UGx1Z2luKGNscywg\nb3JpZ1Byb3BzKTsKCiAgICAgICAgUHJvcGVydGllcyBwcm9wcyA9IHBhcnNl\nUHJvcGVydGllcyhvcmlnUHJvcHMpOwogICAgICAgIHByb3BzLnB1dEFsbChw\nYXJzZVByb3BlcnRpZXMob3ZlcnJpZGVQcm9wcykpOwogICAgICAgIHJldHVy\nbiBnZXRQbHVnaW4oY2xzLCBzZXJpYWxpemVQcm9wZXJ0aWVzKHByb3BzKSk7\nIAogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBpbnN0YW5jZSB3\naXRoIHRoZSBnaXZlbiBjbGFzcyBuYW1lLCB1c2luZyB0aGUgZ2l2ZW4KICAg\nICAqIGNsYXNzIGxvYWRlci4gTm8gY29uZmlndXJhdGlvbiBvZiB0aGUgaW5z\ndGFuY2UgaXMgcGVyZm9ybWVkIGJ5CiAgICAgKiB0aGlzIG1ldGhvZC4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgbmV3SW5zdGFuY2UoU3Ry\naW5nIGNsc05hbWUsIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIHJl\ndHVybiBuZXdJbnN0YW5jZShjbHNOYW1lLCBudWxsLCBudWxsLCBsb2FkZXIs\nIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuZCBjb25m\naWd1cmUgYW4gaW5zdGFuY2Ugd2l0aCB0aGUgZ2l2ZW4gY2xhc3MgbmFtZSBh\nbmQKICAgICAqIHByb3BlcnRpZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBjbHNOYW1lLCBDb25maWd1\ncmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3BzLCBDbGFzc0xvYWRl\nciBsb2FkZXIpIHsKICAgICAgICBPYmplY3Qgb2JqID0gbmV3SW5zdGFuY2Uo\nY2xzTmFtZSwgbnVsbCwgY29uZiwgbG9hZGVyLCB0cnVlKTsKICAgICAgICBj\nb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BzKTsKICAgICAgICBy\nZXR1cm4gb2JqOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhv\nZCB1c2VkIGJ5IG1lbWJlcnMgb2YgdGhpcyBwYWNrYWdlIHRvIGluc3RhbnRp\nYXRlIHBsdWdpbgogICAgICogdmFsdWVzLgogICAgICovCiAgICBzdGF0aWMg\nT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBjbHNOYW1lLCBWYWx1ZSB2YWws\nIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBDbGFzc0xvYWRlciBsb2Fk\nZXIsIGJvb2xlYW4gZmF0YWwpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShjbHNOYW1lKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIENsYXNzIGNscyA9IG51bGw7IAoKICAgICAgICB3aGlsZSAoY2xz\nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gY2FuJ3QgaGF2ZSBhIG51bGwg\ncmVmZXJlbmNlIGluIHRoZSBtYXAsIHNvIHVzZSBzeW1ib2xpYwogICAgICAg\nICAgICAvLyBjb25zdGFudCBhcyBrZXkKICAgICAgICAgICAgT2JqZWN0IGtl\neSA9IGxvYWRlciA9PSBudWxsID8gTlVMTF9MT0FERVIgOiBsb2FkZXI7CiAg\nICAgICAgICAgIE1hcCBsb2FkZXJDYWNoZSA9IChNYXApIF9sb2FkZXJzLmdl\ndChrZXkpOwogICAgICAgICAgICBpZiAobG9hZGVyQ2FjaGUgPT0gbnVsbCkg\neyAvLyBXZSBkb24ndCBoYXZlIGEgY2FjaGUgZm9yIHRoaXMgbG9hZGVyLgog\nICAgICAgICAgICAgICAgbG9hZGVyQ2FjaGUgPSBuZXcgQ29uY3VycmVudEhh\nc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9sb2FkZXJzLnB1dChrZXksIGxv\nYWRlckNhY2hlKTsKICAgICAgICAgICAgfSBlbHNlIHsgIC8vIFdlIGhhdmUg\nYSBjYWNoZSBmb3IgdGhpcyBsb2FkZXIuCiAgICAgICAgICAgICAgICBjbHMg\nPSAoQ2xhc3MpIGxvYWRlckNhY2hlLmdldChjbHNOYW1lKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKGNscyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNscyA9IFN0cmlu\nZ3MudG9DbGFzcyhjbHNOYW1lLCBmaW5kRGVyaXZlZExvYWRlcihjb25mLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyKSk7CiAgICAgICAg\nICAgICAgICAgICAgbG9hZGVyQ2FjaGUucHV0KGNsc05hbWUsIGNscyk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRlciAhPSBudWxsKSAgLy8g\nVHJ5IG9uZSBtb3JlIHRpbWUgd2l0aCBsb2FkZXI9bnVsbAogICAgICAgICAg\nICAgICAgICAgICAgICBsb2FkZXIgPSBudWxsOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZSA9IGdldENy\nZWF0ZUV4Y2VwdGlvbihjbHNOYW1lLCB2YWwsIHJlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGZhdGFsKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyBs\nb2cgPSAoY29uZiA9PSBudWxsKSA/IG51bGwgOiBjb25mCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLmdldENvbmZpZ3VyYXRpb25Mb2coKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZyAhPSBudWxsICYmIGxv\nZy5pc0Vycm9yRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbG9nLmVycm9yKF9sb2MKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLmdldCgicGx1Z2luLWNyZWF0aW9uLWV4Y2VwdGlvbiIsIHZh\nbCksIHJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihj\nbHMpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24pIHsKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOyAgIAogICAgICAgICAgICB9\nCiAgICAgICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gcmUgPSBuZXcgTmVzdGFi\nbGVSdW50aW1lRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAo\nIm9iai1jcmVhdGUiLCBjbHMpLmdldE1lc3NhZ2UoKSwgZSk7CiAgICAgICAg\nICAgIGlmIChmYXRhbCkKICAgICAgICAgICAgICAgIHRocm93IHJlOwogICAg\nICAgICAgICBMb2cgbG9nID0gKGNvbmYgPT0gbnVsbCkgPyBudWxsIDogY29u\nZi5nZXRDb25maWd1cmF0aW9uTG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cg\nIT0gbnVsbCAmJiBsb2cuaXNFcnJvckVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy5lcnJvcihfbG9jLmdldCgicGx1Z2luLWNyZWF0aW9uLWV4Y2Vw\ndGlvbiIsIHZhbCksIHJlKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXR0ZW1wdCB0byBmaW5k\nIGEgZGVyaXZlZCBsb2FkZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gb3VyIHRhcmdl\ndCBsb2FkZXIuCiAgICAgKiBUaGlzIGFsbG93cyBhcHBsaWNhdGlvbiBsb2Fk\nZXJzIHRoYXQgZGVsZWdhdGUgYXBwcm9wcmlhdGVseSBmb3Iga25vd24KICAg\nICAqIGNsYXNzZXMgZmlyc3QgY3JhY2sgYXQgY2xhc3MgbmFtZXMuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNzTG9hZGVyIGZpbmREZXJpdmVk\nTG9hZGVyKENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBDbGFzc0xvYWRl\nciBsb2FkZXIpIHsKICAgICAgICAvLyB3ZSBhbHdheXMgcHJlZmVyIHRoZSB0\naHJlYWQgbG9hZGVyLCBiZWNhdXNlIGl0J3MgdGhlIG9ubHkgdGhpbmcgd2UK\nICAgICAgICAvLyBjYW4gYWNjZXNzIHRoYXQgaXNuJ3QgYm91bmQgdG8gdGhl\nIE9wZW5KUEEgY2xhc3Nsb2FkZXIsIHVubGVzcwogICAgICAgIC8vIHRoZSBj\nb25mIG9iamVjdCBpcyBvZiBhIGN1c3RvbSBjbGFzcwogICAgICAgIENsYXNz\nTG9hZGVyIGN0eExvYWRlciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xh\nc3NMb2FkZXJBY3Rpb24oKSk7CiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChjdHhMb2FkZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBjdHhMb2FkZXI7CiAgICAgICAgICAgIGlmIChj\nb25mICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY29uZi5nZXRDbGFz\ncygpKSk7IAogICAgICAgICAgICByZXR1cm4gQ29uZmlndXJhdGlvbnMuY2xh\nc3MuZ2V0Q2xhc3NMb2FkZXIoKTsKICAgICAgICB9CgogICAgICAgIGZvciAo\nQ2xhc3NMb2FkZXIgcGFyZW50ID0gY3R4TG9hZGVyOyBwYXJlbnQgIT0gbnVs\nbDsgCiAgICAgICAgICAgIHBhcmVudCA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nUGFyZW50QWN0aW9uKHBhcmVudCkpKSB7CiAgICAgICAgICAgIGlmIChwYXJl\nbnQgPT0gbG9hZGVyKQogICAgICAgICAgICAgICAgcmV0dXJuIGN0eExvYWRl\ncjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbmYgIT0gbnVsbCkgewogICAg\nICAgICAgICBmb3IgKENsYXNzTG9hZGVyIHBhcmVudCA9IChDbGFzc0xvYWRl\ncikKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGNvbmYuZ2V0Q2xhc3MoKSkpOyAKICAgICAgICAg\nICAgICAgIHBhcmVudCAhPSBudWxsOyAKICAgICAgICAgICAgICAgIHBhcmVu\ndCA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldFBhcmVudEFjdGlvbihwYXJl\nbnQpKSkgewogICAgICAgICAgICAgICAgaWYgKHBhcmVudCA9PSBsb2FkZXIp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihjb25mLmdldENsYXNzKCkp\nKTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxv\nYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIExpc3Q8U3Ry\naW5nPiBvZiBhbGwgdGhlIGZ1bGx5LXF1YWxpZmllZCBhbmNob3JzIHNwZWNp\nZmllZCBpbiB0aGUKICAgICAqIHByb3BlcnRpZXMgbG9jYXRpb24gbGlzdGVk\nIGluIDxjb2RlPm9wdHM8L2NvZGU+LiBJZiBubyBwcm9wZXJ0aWVzCiAgICAg\nKiBsb2NhdGlvbiBpcyBsaXN0ZWQgaW4gPGNvZGU+b3B0czwvY29kZT4sIHRo\naXMgcmV0dXJucyB3aGF0ZXZlciB0aGUKICAgICAqIHByb2R1Y3QgZGVyaXZh\ndGlvbnMgY2FuIGZpbmQgaW4gdGhlaXIgZGVmYXVsdCBjb25maWd1cmF0aW9u\ncy4KICAgICAqIElmIHRoZSBwcm9wZXJ0aWVzIGxvY2F0aW9uIHNwZWNpZmll\nZCBpbiA8Y29kZT5vcHRzPC9jb2RlPiBhbHJlYWR5CiAgICAgKiBjb250YWlu\ncyBhbiBhbmNob3Igc3BlYywgdGhpcyByZXR1cm5zIHRoYXQgYW5jaG9yLiBO\nb3RlIHRoYXQgaW4gdGhpcwogICAgICogZnVsbHktcXVhbGlmaWVkLWlucHV0\nIGNhc2UsIHRoZSBsb2dpYyBpbnZvbHZpbmcgcHJvZHVjdCBkZXJpdmF0aW9u\ncwogICAgICogYW5kIHJlc291cmNlIHBhcnNpbmcgaXMgc2hvcnQtY2lyY3Vp\ndGVkLCBzbyB0aGlzIG1ldGhvZAogICAgICogc2hvdWxkIG5vdCBiZSB1c2Vk\nIGFzIGEgbWVhbnMgdG8gdGVzdCB0aGF0IGEgcGFydGljdWxhciBhbmNob3Ig\naXMKICAgICAqIGRlZmluZWQgaW4gYSBnaXZlbiBsb2NhdGlvbiBieSBpbnZv\na2luZyB3aXRoIGEgZnVsbHktcXVhbGlmaWVkIGFuY2hvci4KICAgICAqCiAg\nICAgKiBUaGlzIGRvZXMgbm90IG11dGF0ZSA8Y29kZT5vcHRzPC9jb2RlPi4K\nICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBMaXN0PFN0cmluZz4gZ2V0RnVsbHlRdWFsaWZpZWRBbmNob3Jz\nSW5Qcm9wZXJ0aWVzTG9jYXRpb24oCiAgICAgICAgT3B0aW9ucyBvcHRzKSB7\nCiAgICAgICAgU3RyaW5nIHByb3BzID0gb3B0cy5nZXRQcm9wZXJ0eSgicHJv\ncGVydGllcyIsICJwIiwgbnVsbCk7CiAgICAgICAgaWYgKHByb3BzICE9IG51\nbGwpIHsKICAgICAgICAgICAgaW50IGFuY2hvclBvc2l0aW9uID0gcHJvcHMu\naW5kZXhPZigiIyIpOwogICAgICAgICAgICBpZiAoYW5jaG9yUG9zaXRpb24g\nPiAtMSkKICAgICAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KG5l\ndyBTdHJpbmdbXSB7IHByb3BzIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0\ndXJuIFByb2R1Y3REZXJpdmF0aW9ucy5nZXRGdWxseVF1YWxpZmllZEFuY2hv\ncnNJblByb3BlcnRpZXNMb2NhdGlvbigKICAgICAgICAgICAgcHJvcHMpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB7QGxpbmsgQ29u\nZmlndXJhdGlvbn0gaW5zdGFuY2UgZnJvbSB0aGUgY29tbWFuZCBsaW5lCiAg\nICAgKiBvcHRpb25zIHByb3ZpZGVkLiBBbGwgcHJvcGVydHkgbmFtZXMgb2Yg\ndGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gYXJlCiAgICAgKiByZWNvZ25pemVk\nOyBhZGRpdGlvbmFsbHksIGlmIGEgPGNvZGU+cHJvcGVydGllczwvY29kZT4g\nb3IKICAgICAqIDxjb2RlPnA8L2NvZGU+IGFyZ3VtZW50IGV4aXN0cywgdGhl\nIHJlc291cmNlIGl0CiAgICAgKiBwb2ludHMgdG8gd2lsbCBiZSBsb2FkZWQg\nYW5kIHNldCBpbnRvIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGluc3RhbmNl\nLgogICAgICogSXQgY2FuIHBvaW50IHRvIGVpdGhlciBhIGZpbGUgb3IgYSBy\nZXNvdXJjZSBuYW1lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQg\ncG9wdWxhdGVDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZiwgT3B0\naW9ucyBvcHRzKSB7CiAgICAgICAgU3RyaW5nIHByb3BzID0gb3B0cy5yZW1v\ndmVQcm9wZXJ0eSgicHJvcGVydGllcyIsICJwIiwgbnVsbCk7CiAgICAgICAg\nQ29uZmlndXJhdGlvblByb3ZpZGVyIHByb3ZpZGVyOwogICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShwcm9wcykpIHsKICAgICAgICAgICAgU3Ry\naW5nIHBhdGggPSBwcm9wczsKICAgICAgICAgICAgU3RyaW5nIGFuY2hvciA9\nIG51bGw7CiAgICAgICAgICAgIGludCBpZHggPSBwYXRoLmxhc3RJbmRleE9m\nKCcjJyk7CiAgICAgICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAg\nICAgICAgIGlmIChpZHggPCBwYXRoLmxlbmd0aCgpIC0gMSkKICAgICAgICAg\nICAgICAgICAgICBhbmNob3IgPSBwYXRoLnN1YnN0cmluZyhpZHggKyAxKTsK\nICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygwLCBpZHgp\nOwogICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoKCkgPT0gMCkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ1Jlc291cmNlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJhbmNob3Itb25seSIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIHByb3BzKS5nZXRNZXNzYWdlKCksIENvbmZpZ3VyYXRpb25z\nLmNsYXNzLmdldE5hbWUoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHBy\nb3BzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRmlsZSBmaWxlID0g\nbmV3IEZpbGUocGF0aCk7CiAgICAgICAgICAgIGlmICgoQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAg\nICAgIC5pc0ZpbGVBY3Rpb24oZmlsZSkpKS5ib29sZWFuVmFsdWUoKSkKICAg\nICAgICAgICAgICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxv\nYWQoZmlsZSwgYW5jaG9yLCBudWxsKTsKICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICBmaWxlID0gbmV3IEZpbGUoIk1FVEEtSU5GIiArIEZp\nbGUuc2VwYXJhdG9yQ2hhciArIHBhdGgpOwogICAgICAgICAgICAgICAgaWYg\nKChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncgogICAgICAgICAgICAgICAgICAgIC5pc0ZpbGVBY3Rpb24oZmlsZSkpKS5i\nb29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICBwcm92aWRlciA9\nIFByb2R1Y3REZXJpdmF0aW9ucy5sb2FkKGZpbGUsIGFuY2hvciwgbnVsbCk7\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcHJv\ndmlkZXIgPSBQcm9kdWN0RGVyaXZhdGlvbnMubG9hZChwYXRoLCBhbmNob3Is\nIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwcm92aWRl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgcHJvdmlkZXIuc2V0SW50byhj\nb25mKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1pc3NpbmdSZXNvdXJjZUV4Y2VwdGlvbihfbG9jLmdldCgibm8tcHJv\ndmlkZXIiLAogICAgICAgICAgICAgICAgICAgIHByb3BzKS5nZXRNZXNzYWdl\nKCksIENvbmZpZ3VyYXRpb25zLmNsYXNzLmdldE5hbWUoKSwgCiAgICAgICAg\nICAgICAgICAgICAgcHJvcHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxvYWREZWZhdWx0\ncyhudWxsKTsKICAgICAgICAgICAgaWYgKHByb3ZpZGVyICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBwcm92aWRlci5zZXRJbnRvKGNvbmYpOwogICAgICAg\nIH0KICAgICAgICBvcHRzLnNldEludG8oY29uZik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHRocm93IGFuIGluZm9ybWF0aXZl\nIGRlc2NyaXB0aW9uIG9uIGluc3RhbnRpYXRpb24gZXJyb3IuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIFJ1bnRpbWVFeGNlcHRpb24gZ2V0Q3JlYXRl\nRXhjZXB0aW9uKFN0cmluZyBjbHNOYW1lLAogICAgICAgIFZhbHVlIHZhbCwg\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAvLyByZS10aHJvdyB0aGUgZXhjZXB0\naW9uIHdpdGggc29tZSBiZXR0ZXIgaW5mb3JtYXRpb24KICAgICAgICBmaW5h\nbCBTdHJpbmcgbXNnOwogICAgICAgIGZpbmFsIE9iamVjdFtdIHBhcmFtczsK\nCiAgICAgICAgU3RyaW5nIGFsaWFzID0gdmFsLmFsaWFzKGNsc05hbWUpOwog\nICAgICAgIFN0cmluZ1tdIGFsaWFzZXMgPSB2YWwuZ2V0QWxpYXNlcygpOwog\nICAgICAgIFN0cmluZ1tdIGtleXM7CiAgICAgICAgaWYgKGFsaWFzZXMubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIGtleXMgPSBhbGlhc2VzOwogICAgICAg\nIGVsc2UgewogICAgICAgICAgICBrZXlzID0gbmV3IFN0cmluZ1thbGlhc2Vz\nLmxlbmd0aCAvIDJdOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFsaWFzZXMubGVuZ3RoOyBpICs9IDIpCiAgICAgICAgICAgICAgICBrZXlz\nW2kgLyAyXSA9IGFsaWFzZXNbaV07CiAgICAgICAgfQoKICAgICAgICBTdHJp\nbmcgY2xvc2VzdDsKICAgICAgICBpZiAoa2V5cy5sZW5ndGggPT0gMCkgewog\nICAgICAgICAgICBtc2cgPSAiaW52YWxpZC1wbHVnaW4iOwogICAgICAgICAg\nICBwYXJhbXMgPSBuZXcgT2JqZWN0W117IHZhbC5nZXRQcm9wZXJ0eSgpLCBh\nbGlhcywgZS50b1N0cmluZygpLCB9OwogICAgICAgIH0gZWxzZSBpZiAoKGNs\nb3Nlc3QgPSBTdHJpbmdEaXN0YW5jZS5nZXRDbG9zZXN0TGV2ZW5zaHRlaW5E\naXN0YW5jZQogICAgICAgICAgICAoYWxpYXMsIGtleXMsIDAuNWYpKSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIG1zZyA9ICJpbnZhbGlkLXBsdWdpbi1hbGlh\nc2VzIjsKICAgICAgICAgICAgcGFyYW1zID0gbmV3IE9iamVjdFtdewogICAg\nICAgICAgICAgICAgdmFsLmdldFByb3BlcnR5KCksIGFsaWFzLCBlLnRvU3Ry\naW5nKCksCiAgICAgICAgICAgICAgICBuZXcgVHJlZVNldDxTdHJpbmc+KEFy\ncmF5cy5hc0xpc3Qoa2V5cykpLCB9OwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIG1zZyA9ICJpbnZhbGlkLXBsdWdpbi1hbGlhc2VzLWhpbnQiOwog\nICAgICAgICAgICBwYXJhbXMgPSBuZXcgT2JqZWN0W117CiAgICAgICAgICAg\nICAgICB2YWwuZ2V0UHJvcGVydHkoKSwgYWxpYXMsIGUudG9TdHJpbmcoKSwK\nICAgICAgICAgICAgICAgIG5ldyBUcmVlU2V0PFN0cmluZz4oQXJyYXlzLmFz\nTGlzdChrZXlzKSksIGNsb3Nlc3QsIH07CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBuZXcgUGFyc2VFeGNlcHRpb24oX2xvYy5nZXQobXNnLCBwYXJhbXMp\nLCBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdp\ndmVuIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAg\nKiBtYXRjaGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVj\ndCdzIHNldHRlcgogICAgICogbWV0aG9kcy4gVGhlIHByb3BlcnRpZXMgc3Ry\naW5nIHNob3VsZCBiZSBpbiB0aGUgZm9ybQogICAgICogInByb3AxPXZhbDEs\nIHByb3AyPXZhbDIgLi4uIi4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0\nZXIKICAgICAqIG1ldGhvZHMgZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgog\nICAgICoKICAgICAqIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25m\naWd1cmF0aW9uIGVycm9yCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBjb25maWd1cmVJbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9u\nIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3BlcnRpZXMpIHsKICAgICAgICBj\nb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51bGwp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4g\nb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1h\ndGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mg\nc2V0dGVyCiAgICAgKiBtZXRob2RzLiBUaGUgcHJvcGVydGllcyBzdHJpbmcg\nc2hvdWxkIGJlIGluIHRoZSBmb3JtCiAgICAgKiAicHJvcDE9dmFsMSwgcHJv\ncDI9dmFsMiAuLi4iLiBWYWxpZGF0ZXMgdGhhdCBzZXR0ZXIgbWV0aG9kcwog\nICAgICogZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAq\nIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVy\ncm9yCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJ\nbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAg\nICAgU3RyaW5nIHByb3BlcnRpZXMsIFN0cmluZyBjb25maWd1cmF0aW9uTmFt\nZSkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBQcm9wZXJ0aWVzIHByb3BzID0gbnVsbDsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcGVydGllcykpCiAgICAg\nICAgICAgIHByb3BzID0gcGFyc2VQcm9wZXJ0aWVzKHByb3BlcnRpZXMpOwog\nICAgICAgIGNvbmZpZ3VyZUluc3RhbmNlKG9iaiwgY29uZiwgcHJvcHMsIGNv\nbmZpZ3VyYXRpb25OYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbmZp\nZ3VyZXMgdGhlIGdpdmVuIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0\naWVzIGJ5CiAgICAgKiBtYXRjaGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcg\ndG8gdGhlIG9iamVjdCdzIHNldHRlcgogICAgICogbWV0aG9kcy4gRG9lcyBu\nb3QgdmFsaWRhdGUgdGhhdCBzZXR0ZXIgbWV0aG9kcyBleGlzdCBmb3IgdGhl\nIHByb3BlcnRpZXMuCiAgICAgKgogICAgICogQHRocm93cyBSdW50aW1lRXhj\nZXB0aW9uIG9uIGNvbmZpZ3VyYXRpb24gZXJyb3IKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyB2b2lkIGNvbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmos\nIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBQcm9wZXJ0aWVzIHByb3Bl\ncnRpZXMpIHsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYs\nIHByb3BlcnRpZXMsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3Bl\ncnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmlu\nZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBtZXRob2RzLiBJZiA8\nY29kZT5jb25maWd1cmF0aW9uTmFtZTwvY29kZT4gaXMKICAgICAqIG5vbi08\nY29kZT5udWxsPC9jb2RlPiwgdmFsaWRhdGVzIHRoYXQgc2V0dGVyIG1ldGhv\nZHMgZXhpc3QgZm9yCiAgICAgKiB0aGUgcHJvcGVydGllcy4KICAgICAqCiAg\nICAgKiBAdGhyb3dzIFJ1bnRpbWVFeGNlcHRpb24gb24gY29uZmlndXJhdGlv\nbiBlcnJvcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY29uZmln\ndXJlSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29uZmlndXJhdGlvbiBjb25mLAog\nICAgICAgIFByb3BlcnRpZXMgcHJvcGVydGllcywgU3RyaW5nIGNvbmZpZ3Vy\nYXRpb25OYW1lKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIE9wdGlvbnMgb3B0czsKICAgICAgICBp\nZiAocHJvcGVydGllcyBpbnN0YW5jZW9mIE9wdGlvbnMpCiAgICAgICAgICAg\nIG9wdHMgPSAoT3B0aW9ucykgcHJvcGVydGllczsKICAgICAgICBlbHNlIHsg\nCiAgICAgICAgICAgIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgICAg\nICBpZiAocHJvcGVydGllcyAhPSBudWxsKQogICAgICAgICAgICAgICAgb3B0\ncy5wdXRBbGwocHJvcGVydGllcyk7CiAgICAgICAgfQoKICAgICAgICBDb25m\naWd1cmFibGUgY29uZmlndXJhYmxlID0gbnVsbDsKICAgICAgICBpZiAoY29u\nZiAhPSBudWxsICYmIG9iaiBpbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkKICAg\nICAgICAgICAgY29uZmlndXJhYmxlID0gKENvbmZpZ3VyYWJsZSkgb2JqOwoK\nICAgICAgICBpZiAoY29uZmlndXJhYmxlICE9IG51bGwpIHsKICAgICAgICAg\nICAgY29uZmlndXJhYmxlLnNldENvbmZpZ3VyYXRpb24oY29uZik7CiAgICAg\nICAgICAgIGNvbmZpZ3VyYWJsZS5zdGFydENvbmZpZ3VyYXRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgT3B0aW9ucyBpbnZhbGlkRW50cmllcyA9IG9wdHMu\nc2V0SW50byhvYmopOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBHZW5l\ncmljQ29uZmlndXJhYmxlKQogICAgICAgICAgICAoKEdlbmVyaWNDb25maWd1\ncmFibGUpIG9iaikuc2V0SW50byhpbnZhbGlkRW50cmllcyk7CgoJCWlmICgh\naW52YWxpZEVudHJpZXMuaXNFbXB0eSgpICYmIGNvbmZpZ3VyYXRpb25OYW1l\nICE9IG51bGwpIHsKCQkJTG9jYWxpemVyLk1lc3NhZ2UgbXNnID0gbnVsbDsK\nICAgICAgICAgICAgU3RyaW5nIGZpcnN0ID0gKFN0cmluZykgaW52YWxpZEVu\ndHJpZXMua2V5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCk7CgkJCWlmIChpbnZh\nbGlkRW50cmllcy5rZXlTZXQoKS5zaXplKCkgPT0gMSAmJgoJCQkJZmlyc3Qu\naW5kZXhPZignLicpID09IC0xKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0\naGVyZSdzIGp1c3Qgb25lIG1pc3NwZWxsaW5nIGFuZCB0aGlzIGlzIG5vdCBh\nCgkJCQkvLyBwYXRoIHRyYXZlcnNhbCwgY2hlY2sgZm9yIG5lYXIgbWlzc2Vz\nLgogICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IG9wdGlvbnMg\nPSBmaW5kT3B0aW9uc0ZvcihvYmouZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgY2xvc2UgPSBTdHJpbmdEaXN0YW5jZS5nZXRDbG9zZXN0\nTGV2ZW5zaHRlaW5EaXN0YW5jZQoJCQkJCShmaXJzdCwgb3B0aW9ucywgMC43\nNWYpOwoJCQkJaWYgKGNsb3NlICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgbXNnID0gX2xvYy5nZXQoImludmFsaWQtY29uZmlnLXBhcmFtLWhpbnQi\nLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nb25maWd1cmF0aW9uTmFtZSwgb2JqLmdldENsYXNzKCksIGZpcnN0LCBjbG9z\nZSwKCQkJCQkJICAgIG9wdGlvbnMsIH0pOwoJCQl9CgogICAgICAgICAgICBp\nZiAobXNnID09IG51bGwpIHsKICAgICAgICAgICAgICAgIG1zZyA9IF9sb2Mu\nZ2V0KCJpbnZhbGlkLWNvbmZpZy1wYXJhbXMiLCBuZXcgU3RyaW5nW117CiAg\nICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbk5hbWUsIG9iai5nZXRD\nbGFzcygpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBpbnZhbGlk\nRW50cmllcy5rZXlTZXQoKS50b1N0cmluZygpLAogICAgICAgICAgICAgICAg\nICAgIGZpbmRPcHRpb25zRm9yKG9iai5nZXRDbGFzcygpKS50b1N0cmluZygp\nLCB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgUGFy\nc2VFeGNlcHRpb24obXNnKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbmZp\nZ3VyYWJsZSAhPSBudWxsKQogICAgICAgICAgICBjb25maWd1cmFibGUuZW5k\nQ29uZmlndXJhdGlvbigpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIENv\nbGxlY3Rpb248U3RyaW5nPiBmaW5kT3B0aW9uc0ZvcihDbGFzczw/PiBjbHMp\nIHsKICAgICAgICBDb2xsZWN0aW9uPFN0cmluZz4gYyA9IE9wdGlvbnMuZmlu\nZE9wdGlvbnNGb3IoY2xzKTsKICAgICAgICAKICAgICAgICAvLyByZW1vdmUg\nQ29uZmlndXJhYmxlLnNldENvbmZpZ3VyYXRpb24oKSBhbmQgCiAgICAgICAg\nLy8gR2VuZXJpY0NvbmZpZ3VyYWJsZS5zZXRJbnRvKCkgZnJvbSB0aGUgc2V0\nLCBpZiBhcHBsaWNhYmxlLgogICAgICAgIGlmIChDb25maWd1cmFibGUuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAgICBjLnJlbW92\nZSgiQ29uZmlndXJhdGlvbiIpOwogICAgICAgIGlmIChHZW5lcmljQ29uZmln\ndXJhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAg\nICAgYy5yZW1vdmUoIkludG8iKTsKICAgICAgICAKICAgICAgICByZXR1cm4g\nYzsKICAgIH0KCiAgICAvKioKICAgICAqIFR1cm4gYSBzZXQgb2YgcHJvcGVy\ndGllcyBpbnRvIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZy4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBTdHJpbmcgc2VyaWFsaXplUHJvcGVydGllcyhN\nYXAgbWFwKSB7CiAgICAgICAgaWYgKG1hcCA9PSBudWxsIHx8IG1hcC5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJp\nbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIE1h\ncC5FbnRyeSBlbnRyeTsKICAgICAgICBTdHJpbmcgdmFsOwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gbWFwLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVu\ndHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoYnVmLmxlbmd0aCgp\nID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoZW50cnkuZ2V0S2V5KCkpLmFwcGVuZCgnPScp\nOwogICAgICAgICAgICB2YWwgPSBTdHJpbmcudmFsdWVPZihlbnRyeS5nZXRW\nYWx1ZSgpKTsKICAgICAgICAgICAgaWYgKHZhbC5pbmRleE9mKCcsJykgIT0g\nLTEpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCciJykuYXBwZW5kKHZh\nbCkuYXBwZW5kKCciJyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQodmFsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nYSBzZXQgb2YgcHJvcGVydGllcyBmcm9tIGEgY29tbWEtc2VwYXJhdGVkIHN0\ncmluZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPcHRpb25zIHBhcnNl\nUHJvcGVydGllcyhTdHJpbmcgcHJvcGVydGllcykgewogICAgICAgIE9wdGlv\nbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgcHJvcGVydGllcyA9\nIFN0cmluZ1V0aWxzLnRyaW1Ub051bGwocHJvcGVydGllcyk7CiAgICAgICAg\naWYgKHByb3BlcnRpZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG9w\ndHM7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0cmluZ1tdIHByb3Bz\nID0gU3RyaW5ncy5zcGxpdChwcm9wZXJ0aWVzLCAiLCIsIDApOwogICAgICAg\nICAgICBpbnQgaWR4OwogICAgICAgICAgICBjaGFyIHF1b3RlOwogICAgICAg\nICAgICBTdHJpbmcgcHJvcDsKICAgICAgICAgICAgU3RyaW5nIHZhbDsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgaWR4ID0gcHJvcHNbaV0uaW5kZXhPZign\nPScpOwogICAgICAgICAgICAgICAgaWYgKGlkeCA9PSAtMSkgewogICAgICAg\nICAgICAgICAgICAgIC8vIGlmIHRoZSBrZXkgaXMgbm90IGFzc2lnbmVkIHRv\nIGFueSB2YWx1ZSwgc2V0IHRoZQogICAgICAgICAgICAgICAgICAgIC8vIHZh\nbHVlIHRvIHRoZSBzYW1lIHRoaW5nIGFzIHRoZSBrZXksIGFuZCBjb250aW51\nZS4KICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHBlcm1pdHMgR2VuZXJp\nY0NvbmZpZ3VyYWJsZSBpbnN0YW5jZXMgdG8KICAgICAgICAgICAgICAgICAg\nICAvLyBiZWhhdmUgbWVhbmluZ2Z1bGx5LiBXZSBtaWdodCBjb25zaWRlciBz\nZXR0aW5nIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIHRvIHNv\nbWUgd2VsbC1rbm93biAidmFsdWUgd2FzIG5vdCBzZXQsIGJ1dAogICAgICAg\nICAgICAgICAgICAgIC8vIGtleSBpcyBwcmVzZW50IiBzdHJpbmcgc28gdGhh\ndCBpbnN0YW5jZXMgZ2V0dGluZwogICAgICAgICAgICAgICAgICAgIC8vIHZh\nbHVlcyBpbmplY3RlZCBjYW4gZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGEgbWVu\ndGlvbmVkCiAgICAgICAgICAgICAgICAgICAgLy8gcHJvcGVydHkgYW5kIG9u\nZSBzZXQgdG8gYSBwYXJ0aWN1bGFyIHZhbHVlLgogICAgICAgICAgICAgICAg\nICAgIHByb3AgPSBwcm9wc1tpXTsKICAgICAgICAgICAgICAgICAgICB2YWwg\nPSBwcm9wOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBwcm9wID0gcHJvcHNbaV0uc3Vic3RyaW5nKDAsIGlkeCkudHJp\nbSgpOwogICAgICAgICAgICAgICAgICAgIHZhbCA9IHByb3BzW2ldLnN1YnN0\ncmluZyhpZHggKyAxKS50cmltKCk7CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgLy8gaWYgdGhlIHZhbHVlIGlzIHF1b3RlZCwgcmVhZCB1\nbnRpbCB0aGUgZW5kIHF1b3RlCiAgICAgICAgICAgICAgICBpZiAoKCh2YWwu\nc3RhcnRzV2l0aCgiXCIiKSAmJiB2YWwuZW5kc1dpdGgoIlwiIikpCiAgICAg\nICAgICAgICAgICAgICAgfHwgKHZhbC5zdGFydHNXaXRoKCInIikgJiYgdmFs\nLmVuZHNXaXRoKCInIikpKQogICAgICAgICAgICAgICAgICAgICYmIHZhbC5s\nZW5ndGgoKSA+IDEpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gdmFsLnN1\nYnN0cmluZygxLCB2YWwubGVuZ3RoKCkgLSAxKTsKICAgICAgICAgICAgICAg\nIGVsc2UgaWYgKHZhbC5zdGFydHNXaXRoKCJcIiIpIHx8IHZhbC5zdGFydHNX\naXRoKCInIikpIHsKICAgICAgICAgICAgICAgICAgICBxdW90ZSA9IHZhbC5j\naGFyQXQoMCk7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIodmFsLnN1YnN0cmluZygxKSk7CiAgICAg\nICAgICAgICAgICAgICAgaW50IHF1b3RJZHg7CiAgICAgICAgICAgICAgICAg\nICAgd2hpbGUgKCsraSA8IHByb3BzLmxlbmd0aCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCIsIik7CgogICAgICAgICAgICAgICAg\nICAgICAgICBxdW90SWR4ID0gcHJvcHNbaV0uaW5kZXhPZihxdW90ZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChxdW90SWR4ICE9IC0xKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKHByb3BzW2ld\nLnN1YnN0cmluZygwLCBxdW90SWR4KSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAocXVvdElkeCArIDEgPCBwcm9wc1tpXS5sZW5ndGgoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKHBy\nb3BzW2ldLnN1YnN0cmluZyhxdW90SWR4ICsgMSkpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZChwcm9wc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIHZhbCA9IGJ1Zi50b1N0cmluZygpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgb3B0cy5wdXQocHJvcCwgdmFsKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3B0czsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBQYXJzZUV4Y2VwdGlvbihfbG9jLmdldCgicHJvcC1wYXJzZSIs\nIHByb3BlcnRpZXMpLCByZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogTG9va3MgdXAgdGhlIGdpdmVuIG5hbWUgaW4gSk5ESS4gSWYgdGhl\nIG5hbWUgaXMgbnVsbCwgbnVsbCBpcyByZXR1cm5lZC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBPYmplY3QgbG9va3VwKFN0cmluZyBuYW1lLCBTdHJp\nbmcgdXNlcktleSwgTG9nIGxvZykgewogICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgQ29udGV4dCBjdHggPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGN0eCA9IG5ldyBJbml0aWFsQ29udGV4dCgpOwogICAgICAgICAg\nICBPYmplY3QgcmVzdWx0ID0gY3R4Lmxvb2t1cChuYW1lKTsKICAgICAgICAg\nICAgaWYgKHJlc3VsdCA9PSBudWxsICYmIGxvZyAhPSBudWxsICYmIGxvZy5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIAlsb2cud2FybihfbG9jLmdl\ndCgiam5kaS1sb29rdXAtZmFpbGVkIiwgdXNlcktleSwgbmFtZSkpOwogICAg\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0gY2F0Y2ggKE5hbWlu\nZ0V4Y2VwdGlvbiBuZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgTmVzdGFi\nbGVSdW50aW1lRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgX2xvYy5nZXQo\nIm5hbWluZy1lcnIiLCBuYW1lKS5nZXRNZXNzYWdlKCksIG5lKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoY3R4ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cnkgeyBjdHguY2xvc2UoKTsgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCB3aGV0aGVyIHRoZSBtYXAgY29udGFpbnMgdGhlIGdpdmVuIHBhcnRp\nYWwga2V5LCBwcmVmaXhlZCB3aXRoIGFueQogICAgICogcG9zc2libGUgY29u\nZmlndXJhdGlvbiBwcmVmaXguCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nYm9vbGVhbiBjb250YWluc1Byb3BlcnR5KFZhbHVlIHZhbHVlLCBNYXAgcHJv\ncHMpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCBwcm9wcyA9PSBu\ndWxsIHx8IHByb3BzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIExpc3Q8U3RyaW5nPiBwYXJ0aWFsS2V5cyA9IHZhbHVl\nLmdldFByb3BlcnR5S2V5cygpOwogICAgICAgIGZvciAoU3RyaW5nIHBhcnRp\nYWxLZXkgOiBwYXJ0aWFsS2V5cykgewogICAgICAgICAgICBpZiAocHJvcHMu\nY29udGFpbnNLZXkoCiAgICAgICAgICAgICAgICBQcm9kdWN0RGVyaXZhdGlv\nbnMuZ2V0Q29uZmlndXJhdGlvbktleShwYXJ0aWFsS2V5LCBwcm9wcykpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUZXN0\nIHdoZXRoZXIgdGhlIG1hcCBjb250YWlucyB0aGUgZ2l2ZW4gcGFydGlhbCBr\nZXksIHByZWZpeGVkIHdpdGggYW55CiAgICAgKiBwb3NzaWJsZSBjb25maWd1\ncmF0aW9uIHByZWZpeC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29s\nZWFuIGNvbnRhaW5zUHJvcGVydHkoU3RyaW5nIHBhcnRpYWxLZXksIE1hcCBw\ncm9wcykgewogICAgICAgIGlmIChwYXJ0aWFsS2V5ID09IG51bGwgfHwgcHJv\ncHMgPT0gbnVsbCB8fCBwcm9wcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBw\ncm9wcy5jb250YWluc0tleSgKICAgICAgICAgICAgICAgIFByb2R1Y3REZXJp\ndmF0aW9ucy5nZXRDb25maWd1cmF0aW9uS2V5KHBhcnRpYWxLZXksIHByb3Bz\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHByb3BlcnR5IHVu\nZGVyIHRoZSBnaXZlbiBwYXJ0aWFsIGtleSwgcHJlZml4ZWQgd2l0aCBhbnkg\ncG9zc2libGUKICAgICAqIGNvbmZpZ3VyYXRpb24gcHJlZml4LgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBnZXRQcm9wZXJ0eShTdHJpbmcg\ncGFydGlhbEtleSwgTWFwIG0pIHsKICAgICAgICBpZiAocGFydGlhbEtleSA9\nPSBudWxsIHx8IG0gPT0gbnVsbCB8fCBtLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgZWxzZSAKICAgICAgICAgICAgcmV0\ndXJuIG0uZ2V0KFByb2R1Y3REZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9u\nS2V5KHBhcnRpYWxLZXksIG0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbW92ZSB0aGUgcHJvcGVydHkgdW5kZXIgdGhlIGdpdmVuIHBhcnRpYWwga2V5\nLCBwcmVmaXhlZCB3aXRoIGFueQogICAgICogcG9zc2libGUgY29uZmlndXJh\ndGlvbiBwcmVmaXguCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0\nIHJlbW92ZVByb3BlcnR5KFN0cmluZyBwYXJ0aWFsS2V5LCBNYXAgcHJvcHMp\nIHsKICAgICAgICBpZiAocGFydGlhbEtleSA9PSBudWxsIHx8IHByb3BzID09\nIG51bGwgfHwgcHJvcHMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBTdHJpbmcgZnVsbEtleSA9IFByb2R1Y3REZXJpdmF0\naW9ucy5nZXRDb25maWd1cmF0aW9uS2V5KHBhcnRpYWxLZXksIHByb3BzKTsK\nICAgICAgICByZXR1cm4gcHJvcHMucmVtb3ZlKGZ1bGxLZXkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUnVucyA8Y29kZT5ydW5uYWJsZTwvY29kZT4gYWdh\naW5zdCBhbGwgdGhlIGFuY2hvcnMgaW4gdGhlIGNvbmZpZ3VyYXRpb24KICAg\nICAqIHBvaW50ZWQgdG8gYnkgPGNvZGU+b3B0czwvY29kZT4uIEVhY2ggaW52\nb2NhdGlvbiBnZXRzIGEgZnJlc2ggY2xvbmUgb2YgCiAgICAgKiA8Y29kZT5v\ncHRzPC9jb2RlPiB3aXRoIHRoZSA8Y29kZT5wcm9wZXJ0aWVzPC9jb2RlPiBv\ncHRpb24gc2V0CiAgICAgKiBhcHByb3ByaWF0ZWx5LgogICAgICoKICAgICAq\nIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xl\nYW4gcnVuQWdhaW5zdEFsbEFuY2hvcnMoT3B0aW9ucyBvcHRzLAogICAgICAg\nIENvbmZpZ3VyYXRpb25zLlJ1bm5hYmxlIHJ1bm5hYmxlKSB7CiAgICAgICAg\naWYgKG9wdHMuY29udGFpbnNLZXkoImhlbHAiKSB8fCBvcHRzLmNvbnRhaW5z\nS2V5KCItaGVscCIpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CiAgICAgICAgTGlzdDxTdHJpbmc+IGFuY2hvcnMgPQogICAgICAg\nICAgICBDb25maWd1cmF0aW9ucy5nZXRGdWxseVF1YWxpZmllZEFuY2hvcnNJ\nblByb3BlcnRpZXNMb2NhdGlvbihvcHRzKTsKCiAgICAgICAgLy8gV2UgdXNl\nICdwcm9wZXJ0aWVzJyBiZWxvdzsgZ2V0IHJpZCBvZiAncCcgdG8gYXZvaWQg\nY29uZmxpY3RzLiBUaGlzCiAgICAgICAgLy8gcmVsaWVzIG9uIGtub3dpbmcg\nd2hhdCBnZXRGdWxseVF1YWxpZmllZEFuY2hvcnNJblByb3BlcnRpZXNMb2Nh\ndGlvbgogICAgICAgIC8vIGxvb2tzIGZvci4KICAgICAgICBpZiAob3B0cy5j\nb250YWluc0tleSgicCIpKQogICAgICAgICAgICBvcHRzLnJlbW92ZSgicCIp\nOwoKICAgICAgICBib29sZWFuIHJldCA9IHRydWU7CiAgICAgICAgaWYgKGFu\nY2hvcnMuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgcmV0ID0gbGF1bmNo\nUnVubmFibGUob3B0cywgcnVubmFibGUpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGZvcihTdHJpbmcgcyA6IGFuY2hvcnMgKSB7IAogICAgICAg\nICAgICAgICAgT3B0aW9ucyBjbG9uZWRPcHRpb25zID0gKE9wdGlvbnMpIG9w\ndHMuY2xvbmUoKTsKICAgICAgICAgICAgICAgIGNsb25lZE9wdGlvbnMuc2V0\nUHJvcGVydHkoInByb3BlcnRpZXMiLCBzKTsKICAgICAgICAgICAgICAgIHJl\ndCAmPSBsYXVuY2hSdW5uYWJsZShjbG9uZWRPcHRpb25zLCBydW5uYWJsZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldDsK\nICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGxhdW5jaFJ1bm5h\nYmxlKE9wdGlvbnMgb3B0cywKICAgICAgICBDb25maWd1cmF0aW9ucy5SdW5u\nYWJsZSBydW5uYWJsZSkgewogICAgICAgIGJvb2xlYW4gcmV0ID0gdHJ1ZTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXQgPSBydW5uYWJsZS5ydW4o\nb3B0cyk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIFJ1bnRpbWVFeGNlcHRpb24pKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZSk7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IChSdW50\naW1lRXhjZXB0aW9uKSBlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0\nOwogICAgfQoKICAgIHB1YmxpYyBpbnRlcmZhY2UgUnVubmFibGUgewogICAg\nICAgIHB1YmxpYyBib29sZWFuIHJ1bihPcHRpb25zIG9wdHMpIHRocm93cyBF\neGNlcHRpb247CiAgICB9Cn0K\n","encoding":"base64"}

