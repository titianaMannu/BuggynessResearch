{"sha":"e8ca24bd4fd6de59670a9482f40493927f5cf4b5","node_id":"MDQ6QmxvYjIwNjM2NDplOGNhMjRiZDRmZDZkZTU5NjcwYTk0ODJmNDA0OTM5MjdmNWNmNGI1","size":21828,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e8ca24bd4fd6de59670a9482f40493927f5cf4b5","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmM7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZhLmxh\nbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLnNxbC5DYWxsYWJsZVN0\nYXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBq\nYXZhLnNxbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuUHJl\ncGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7Cmlt\ncG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5T\nUUxXYXJuaW5nOwppbXBvcnQgamF2YS5zcWwuU2F2ZXBvaW50OwppbXBvcnQg\namF2YS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0YWJsZVJ1bnRpbWVFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ2xvc2VhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNvbmNyZXRl\nQ2xhc3NHZW5lcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoK\nLyoqCiAqIFdyYXBwZXIgYXJvdW5kIGFuIGV4aXN0aW5nIGNvbm5lY3Rpb24u\nIFN1YmNsYXNzZXMgY2FuIG92ZXJyaWRlIHRoZQogKiBtZXRob2RzIHdob3Nl\nIGJlaGF2aW9yIHRoZXkgbWVhbiB0byBjaGFuZ2UuIFRoZSA8Y29kZT5lcXVh\nbHM8L2NvZGU+IGFuZAogKiA8Y29kZT5oYXNoQ29kZTwvY29kZT4gbWV0aG9k\ncyBwYXNzIHRocm91Z2ggdG8gdGhlIGJhc2UgdW5kZXJseWluZyBkYXRhCiAq\nIHN0b3JlIGNvbm5lY3Rpb24uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgRGVsZWdhdGluZ0Nvbm5lY3Rpb24g\naW1wbGVtZW50cyBDb25uZWN0aW9uLCBDbG9zZWFibGUgewoKICAgIHN0YXRp\nYyBmaW5hbCBDb25zdHJ1Y3RvcjxEZWxlZ2F0aW5nQ29ubmVjdGlvbj4gY29u\nY3JldGVJbXBsOwogICAgc3RhdGljIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBjb25jcmV0ZUltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdl\ndENvbmNyZXRlQ29uc3RydWN0b3IoRGVsZWdhdGluZ0Nvbm5lY3Rpb24uY2xh\nc3MsIENvbm5lY3Rpb24uY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25Jbklu\naXRpYWxpemVyRXJyb3IoZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGpk\nYmMgMyBtZXRob2Qga2V5cwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2Jq\nZWN0IFNFVF9IT0xEQUJJTElUWSA9IG5ldyBPYmplY3QoKTsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIE9iamVjdCBHRVRfSE9MREFCSUxJVFkgPSBuZXcg\nT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgU0VU\nX1NBVkVQT0lOVF9OT05BTUUgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBPYmplY3QgU0VUX1NBVkVQT0lOVCA9IG5ldyBPYmpl\nY3QoKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdCBST0xMQkFD\nS19TQVZFUE9JTlQgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBPYmplY3QgUkVMRUFTRV9TQVZFUE9JTlQgPSBuZXcgT2JqZWN0\nKCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgQ1JFQVRFX1NU\nQVRFTUVOVCA9IG5ldyBPYmplY3QoKTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIE9iamVjdCBQUkVQQVJFX1NUQVRFTUVOVCA9IG5ldyBPYmplY3QoKTsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdCBQUkVQQVJFX0NBTEwg\nPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmpl\nY3QgUFJFUEFSRV9XSVRIX0tFWVMgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgUFJFUEFSRV9XSVRIX0lOREVYID0g\nbmV3IE9iamVjdCgpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0\nIFBSRVBBUkVfV0lUSF9OQU1FUyA9IG5ldyBPYmplY3QoKTsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5m\nb3JQYWNrYWdlCiAgICAgICAgKERlbGVnYXRpbmdDb25uZWN0aW9uLmNsYXNz\nKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBNYXA8T2JqZWN0LCBNZXRo\nb2Q+IF9qZGJjMzsKCiAgICBzdGF0aWMgewogICAgICAgIGJvb2xlYW4gamRi\nYzMgPSBmYWxzZTsKICAgICAgICBNZXRob2QgbSA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgbSA9IENvbm5lY3Rpb24uY2xhc3MuZ2V0TWV0\naG9kKCJzZXRTYXZlcG9pbnQiLCBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNz\nIH0pOwogICAgICAgICAgICBqZGJjMyA9IHRydWU7CiAgICAgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICB9CgogICAgICAgIGlmIChqZGJj\nMykgewogICAgICAgICAgICBfamRiYzMgPSBuZXcgSGFzaE1hcDxPYmplY3Qs\nTWV0aG9kPigpOwogICAgICAgICAgICBfamRiYzMucHV0KFNFVF9TQVZFUE9J\nTlQsIG0pOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBfamRiYzMgPSBu\ndWxsOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgQ29ubmVjdGlvbiBfY29u\nbjsKICAgIHByaXZhdGUgZmluYWwgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gX2Rl\nbDsKCiAgICBwdWJsaWMgRGVsZWdhdGluZ0Nvbm5lY3Rpb24oQ29ubmVjdGlv\nbiBjb25uKSB7CiAgICAgICAgX2Nvbm4gPSBjb25uOwogICAgICAgIGlmIChj\nb25uIGluc3RhbmNlb2YgRGVsZWdhdGluZ0Nvbm5lY3Rpb24pCiAgICAgICAg\nICAgIF9kZWwgPSAoRGVsZWdhdGluZ0Nvbm5lY3Rpb24pIF9jb25uOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgX2RlbCA9IG51bGw7CiAgICB9CgogICAg\nLyoqIAogICAgICogIENvbnN0cnVjdG9yIGZvciB0aGUgY29uY3JldGUgaW1w\nbGVtZW50YXRpb24gb2YgdGhpcyBhYnN0cmFjdCBjbGFzcy4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBEZWxlZ2F0aW5nQ29ubmVjdGlvbiBuZXdJbnN0\nYW5jZShDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICByZXR1cm4gQ29uY3Jl\ndGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShjb25jcmV0ZUltcGwsIGNv\nbm4pOwogICAgfQoKICAgIC8qKiAKICAgICAqICBNYXJrZXIgdG8gZW5mb3Jj\nZSB0aGF0IHN1YmNsYXNzZXMgb2YgdGhpcyBjbGFzcyBhcmUgYWJzdHJhY3Qu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIGVuZm9yY2VB\nYnN0cmFjdCgpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB3cmFwcGVk\nIGNvbm5lY3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBDb25uZWN0aW9uIGdl\ndERlbGVnYXRlKCkgewogICAgICAgIHJldHVybiBfY29ubjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgYmFzZSB1bmRlcmx5aW5nIGRhdGEg\nc3RvcmUgY29ubmVjdGlvbi4KICAgICAqLwogICAgcHVibGljIENvbm5lY3Rp\nb24gZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKSB7CiAgICAgICAgcmV0dXJuIChf\nZGVsID09IG51bGwpID8gX2Nvbm4gOiBfZGVsLmdldElubmVybW9zdERlbGVn\nYXRlKCk7CiAgICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAg\nICAgICByZXR1cm4gZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKS5oYXNoQ29kZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3Ro\nZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgRGVs\nZWdhdGluZ0Nvbm5lY3Rpb24pCiAgICAgICAgICAgIG90aGVyID0gKChEZWxl\nZ2F0aW5nQ29ubmVjdGlvbikgb3RoZXIpLmdldElubmVybW9zdERlbGVnYXRl\nKCk7CiAgICAgICAgcmV0dXJuIGdldElubmVybW9zdERlbGVnYXRlKCkuZXF1\nYWxzKG90aGVyKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5n\nKCkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVm\nZmVyKCJjb25uICIpLmFwcGVuZChoYXNoQ29kZSgpKTsKICAgICAgICBhcHBl\nbmRJbmZvKGJ1Zik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZEluZm8oU3RyaW5nQnVm\nZmVyIGJ1ZikgewogICAgICAgIGlmIChfZGVsICE9IG51bGwpCiAgICAgICAg\nICAgIF9kZWwuYXBwZW5kSW5mbyhidWYpOwogICAgfQoKICAgIHB1YmxpYyBT\ndGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KCkgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZVN0YXRlbWVudCh0cnVlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIHN0YXRlbWVudCwgd2l0aCB0\naGUgb3B0aW9uIG9mIG5vdCB3cmFwcGluZyBpdCBpbiBhCiAgICAgKiB7QGxp\nbmsgRGVsZWdhdGluZ1N0YXRlbWVudH0sIHdoaWNoIGlzIHRoZSBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRl\nbWVudChib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIFN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAoX2RlbCAhPSBudWxs\nKQogICAgICAgICAgICBzdG1udCA9IF9kZWwuY3JlYXRlU3RhdGVtZW50KGZh\nbHNlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50ID0gX2Nvbm4u\nY3JlYXRlU3RhdGVtZW50KCk7CiAgICAgICAgaWYgKHdyYXApCiAgICAgICAg\nICAgIHN0bW50ID0gRGVsZWdhdGluZ1N0YXRlbWVudC5uZXdJbnN0YW5jZShz\ndG1udCwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHN0bW50OwogICAgfQoKICAg\nIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0\ncmluZyBzdHIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBwcmVwYXJlU3RhdGVtZW50KHN0ciwgdHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQcmVwYXJlIGEgc3RhdGVtZW50LCB3aXRoIHRoZSBvcHRpb24g\nb2Ygbm90IHdyYXBwaW5nIGl0IGluIGEKICAgICAqIHtAbGluayBEZWxlZ2F0\naW5nUHJlcGFyZWRTdGF0ZW1lbnR9LCB3aGljaCBpcyB0aGUgZGVmYXVsdC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBh\ncmVTdGF0ZW1lbnQoU3RyaW5nIHN0ciwgYm9vbGVhbiB3cmFwKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50OwogICAgICAgIGlmIChfZGVsICE9IG51bGwpCiAgICAgICAg\nICAgIHN0bW50ID0gX2RlbC5wcmVwYXJlU3RhdGVtZW50KHN0ciwgZmFsc2Up\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQgPSBfY29ubi5wcmVw\nYXJlU3RhdGVtZW50KHN0ciwgUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZ\nLCAKICAgICAgICAgICAgICAgIFJlc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZ\nKTsKICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAgc3RtbnQgPSBEZWxl\nZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRo\naXMpOwogICAgICAgIHJldHVybiBzdG1udDsKICAgIH0KCiAgICBwdWJsaWMg\nQ2FsbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwoU3RyaW5nIHN0cikgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHByZXBhcmVDYWxs\nKHN0ciwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlIGEg\nY2FsbCwgd2l0aCB0aGUgb3B0aW9uIG9mIG5vdCB3cmFwcGluZyBpdCBpbiBh\nCiAgICAgKiB7QGxpbmsgRGVsZWdhdGluZ0NhbGxhYmxlU3RhdGVtZW50fSwg\nd2hpY2ggaXMgdGhlIGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBD\nYWxsYWJsZVN0YXRlbWVudCBwcmVwYXJlQ2FsbChTdHJpbmcgc3RyLCBib29s\nZWFuIHdyYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgQ2FsbGFibGVTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9kZWwg\nIT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQgPSBfZGVsLnByZXBhcmVDYWxs\nKHN0ciwgZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQg\nPSBfY29ubi5wcmVwYXJlQ2FsbChzdHIpOwogICAgICAgIGlmICh3cmFwKQog\nICAgICAgICAgICBzdG1udCA9IERlbGVnYXRpbmdDYWxsYWJsZVN0YXRlbWVu\ndC5uZXdJbnN0YW5jZShzdG1udCwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHN0\nbW50OwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgbmF0aXZlU1FMKFN0cmlu\nZyBzdHIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBf\nY29ubi5uYXRpdmVTUUwoc3RyKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRBdXRvQ29tbWl0KGJvb2xlYW4gYm9vbCkgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgX2Nvbm4uc2V0QXV0b0NvbW1pdChib29sKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBdXRvQ29tbWl0KCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIF9jb25uLmdldEF1dG9Db21t\naXQoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBfY29ubi5jb21taXQoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIF9jb25uLnJvbGxiYWNrKCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBfY29ubi5jbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nQ2xvc2VkKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIF9jb25uLmlzQ2xvc2VkKCk7CiAgICB9CgogICAgcHVibGljIERhdGFiYXNl\nTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGEodHJ1ZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhLCB3aXRoIHRoZSBvcHRp\nb24gb2Ygbm90IHdyYXBwaW5nIGl0IGluIGEKICAgICAqIHtAbGluayBEZWxl\nZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YX0sIHdoaWNoIGlzIHRoZSBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgRGF0YWJhc2VNZXRhRGF0YSBnZXRN\nZXRhRGF0YShib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIERhdGFiYXNlTWV0YURhdGEgbWV0YTsKICAgICAgICBpZiAoX2Rl\nbCAhPSBudWxsKQogICAgICAgICAgICBtZXRhID0gX2RlbC5nZXRNZXRhRGF0\nYShmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtZXRhID0gX2Nv\nbm4uZ2V0TWV0YURhdGEoKTsKICAgICAgICBpZiAod3JhcCkKICAgICAgICAg\nICAgbWV0YSA9IERlbGVnYXRpbmdEYXRhYmFzZU1ldGFEYXRhLm5ld0luc3Rh\nbmNlKG1ldGEsIHRoaXMpOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldFJlYWRPbmx5KGJvb2xlYW4gYm9vbCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgX2Nvbm4uc2V0UmVhZE9ubHko\nYm9vbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNSZWFkT25seSgp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBfY29ubi5p\nc1JlYWRPbmx5KCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2F0YWxv\nZyhTdHJpbmcgc3RyKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBf\nY29ubi5zZXRDYXRhbG9nKHN0cik7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyBnZXRDYXRhbG9nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIF9jb25uLmdldENhdGFsb2coKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRUcmFuc2FjdGlvbklzb2xhdGlvbihpbnQgaSkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgX2Nvbm4uc2V0VHJhbnNhY3Rpb25Jc29s\nYXRpb24oaSk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRUcmFuc2FjdGlv\nbklzb2xhdGlvbigpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBfY29ubi5nZXRUcmFuc2FjdGlvbklzb2xhdGlvbigpOwogICAgfQoK\nICAgIHB1YmxpYyBTUUxXYXJuaW5nIGdldFdhcm5pbmdzKCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIF9jb25uLmdldFdhcm5pbmdz\nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXJXYXJuaW5ncygpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIF9jb25uLmNsZWFyV2Fybmlu\nZ3MoKTsKICAgIH0KCiAgICBwdWJsaWMgU3RhdGVtZW50IGNyZWF0ZVN0YXRl\nbWVudChpbnQgdHlwZSwgaW50IGNvbmN1cikgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZVN0YXRlbWVudCh0eXBlLCBjb25j\ndXIsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgc3Rh\ndGVtZW50LCB3aXRoIHRoZSBvcHRpb24gb2Ygbm90IHdyYXBwaW5nIGl0IGlu\nIGEKICAgICAqIHtAbGluayBEZWxlZ2F0aW5nU3RhdGVtZW50fSwgd2hpY2gg\naXMgdGhlIGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZW1l\nbnQgY3JlYXRlU3RhdGVtZW50KGludCB0eXBlLCBpbnQgY29uY3VyLCBib29s\nZWFuIHdyYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChfZGVsICE9IG51bGwp\nCiAgICAgICAgICAgIHN0bW50ID0gX2RlbC5jcmVhdGVTdGF0ZW1lbnQodHlw\nZSwgY29uY3VyLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\ndG1udCA9IF9jb25uLmNyZWF0ZVN0YXRlbWVudCh0eXBlLCBjb25jdXIpOwog\nICAgICAgIGlmICh3cmFwKQogICAgICAgICAgICBzdG1udCA9IERlbGVnYXRp\nbmdTdGF0ZW1lbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRoaXMpOwogICAgICAg\nIHJldHVybiBzdG1udDsKICAgIH0KCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0\nZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3RyLCBpbnQgdHlwZSwg\naW50IGNvbmN1cikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzdHIsIHR5cGUsIGNvbmN1\nciwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlIGEgc3Rh\ndGVtZW50LCB3aXRoIHRoZSBvcHRpb24gb2Ygbm90IHdyYXBwaW5nIGl0IGlu\nIGEKICAgICAqIHtAbGluayBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnR9\nLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHN0\nciwgaW50IHR5cGUsCiAgICAgICAgaW50IGNvbmN1ciwgYm9vbGVhbiB3cmFw\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udDsKICAgICAgICBpZiAoX2RlbCAhPSBudWxsKQogICAgICAg\nICAgICBzdG1udCA9IF9kZWwucHJlcGFyZVN0YXRlbWVudChzdHIsIHR5cGUs\nIGNvbmN1ciwgZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rt\nbnQgPSBfY29ubi5wcmVwYXJlU3RhdGVtZW50KHN0ciwgdHlwZSwgY29uY3Vy\nKTsKICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAgc3RtbnQgPSBEZWxl\nZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRo\naXMpOwogICAgICAgIHJldHVybiBzdG1udDsKICAgIH0KCiAgICBwdWJsaWMg\nQ2FsbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwoU3RyaW5nIHN0ciwgaW50\nIHR5cGUsIGludCBjb25jdXIpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIHByZXBhcmVDYWxsKHN0ciwgdHlwZSwgY29u\nY3VyLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUgYSBj\nYWxsLCB3aXRoIHRoZSBvcHRpb24gb2Ygbm90IHdyYXBwaW5nIGl0IGluIGEK\nICAgICAqIHtAbGluayBEZWxlZ2F0aW5nQ2FsbGFibGVTdGF0ZW1lbnR9LCB3\naGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIENh\nbGxhYmxlU3RhdGVtZW50IHByZXBhcmVDYWxsKFN0cmluZyBzdHIsIGludCB0\neXBlLCBpbnQgY29uY3VyLAogICAgICAgIGJvb2xlYW4gd3JhcCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2FsbGFibGVTdGF0ZW1lbnQgc3Rt\nbnQ7CiAgICAgICAgaWYgKF9kZWwgIT0gbnVsbCkKICAgICAgICAgICAgc3Rt\nbnQgPSBfZGVsLnByZXBhcmVDYWxsKHN0ciwgdHlwZSwgY29uY3VyLCBmYWxz\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udCA9IF9jb25uLnBy\nZXBhcmVDYWxsKHN0ciwgdHlwZSwgY29uY3VyKTsKICAgICAgICBpZiAod3Jh\ncCkKICAgICAgICAgICAgc3RtbnQgPSBEZWxlZ2F0aW5nQ2FsbGFibGVTdGF0\nZW1lbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRoaXMpOwogICAgICAgIHJldHVy\nbiBzdG1udDsKICAgIH0KCiAgICBwdWJsaWMgTWFwPFN0cmluZywgQ2xhc3M8\nPz4+IGdldFR5cGVNYXAoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gX2Nvbm4uZ2V0VHlwZU1hcCgpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFR5cGVNYXAoTWFwPFN0cmluZywgQ2xhc3M8Pz4+IG1hcCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgX2Nvbm4uc2V0VHlwZU1h\ncChtYXApOwogICAgfQoKICAgIC8vIEpEQkMgMy4wIG1ldGhvZHMgZm9sbG93\nOyB0aGVzZSBhcmUgcmVxdWlyZWQgdG8gYmUgYWJsZSB0bwogICAgLy8gY29t\ncGlsZSBhZ2FpbnN0IEpESyAxLjQ7IHRoZXNlIG1ldGhvZHMgd2lsbCBub3Qg\nd29yayBvbgogICAgLy8gcHJldmlvdXMgSlZNcwoKICAgIHB1YmxpYyB2b2lk\nIHNldEhvbGRhYmlsaXR5KGludCBob2xkYWJpbGl0eSkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRCQzMoKTsKICAgICAgICBNZXRo\nb2QgbSA9IChNZXRob2QpIF9qZGJjMy5nZXQoU0VUX0hPTERBQklMSVRZKTsK\nICAgICAgICBpZiAobSA9PSBudWxsKQogICAgICAgICAgICBtID0gY3JlYXRl\nSkRCQzNNZXRob2QoU0VUX0hPTERBQklMSVRZLCAic2V0SG9sZGFiaWxpdHki\nLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsK\nICAgICAgICBpbnZva2VKREJDMyhtLCBuZXcgT2JqZWN0W117IE51bWJlcnMu\ndmFsdWVPZihob2xkYWJpbGl0eSkgfSk7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRIb2xkYWJpbGl0eSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9k\nKSBfamRiYzMuZ2V0KEdFVF9IT0xEQUJJTElUWSk7CiAgICAgICAgaWYgKG0g\nPT0gbnVsbCkKICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKEdF\nVF9IT0xEQUJJTElUWSwgImdldEhvbGRhYmlsaXR5IiwgbnVsbCk7CiAgICAg\nICAgcmV0dXJuICgoTnVtYmVyKSBpbnZva2VKREJDMyhtLCBudWxsKSkuaW50\nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgU2F2ZXBvaW50IHNldFNhdmVw\nb2ludCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpE\nQkMzKCk7CiAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9kKSBfamRiYzMuZ2V0\nKFNFVF9TQVZFUE9JTlRfTk9OQU1FKTsKICAgICAgICBpZiAobSA9PSBudWxs\nKQogICAgICAgICAgICBtID0gY3JlYXRlSkRCQzNNZXRob2QoU0VUX1NBVkVQ\nT0lOVF9OT05BTUUsICJzZXRTYXZlcG9pbnQiLCBudWxsKTsKICAgICAgICBy\nZXR1cm4gKFNhdmVwb2ludCkgaW52b2tlSkRCQzMobSwgbnVsbCk7CiAgICB9\nCgogICAgcHVibGljIFNhdmVwb2ludCBzZXRTYXZlcG9pbnQoU3RyaW5nIHNh\ndmVwb2ludCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0\nSkRCQzMoKTsKICAgICAgICBNZXRob2QgbSA9IChNZXRob2QpIF9qZGJjMy5n\nZXQoU0VUX1NBVkVQT0lOVCk7CiAgICAgICAgaWYgKG0gPT0gbnVsbCkKICAg\nICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFNFVF9TQVZFUE9JTlQs\nICJzZXRTYXZlcG9pbnQiLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117\nIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICByZXR1cm4gKFNhdmVwb2ludCkg\naW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtdeyBzYXZlcG9pbnQgfSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2soU2F2ZXBvaW50IHNhdmVw\nb2ludCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRC\nQzMoKTsKICAgICAgICBNZXRob2QgbSA9IChNZXRob2QpIF9qZGJjMy5nZXQo\nUk9MTEJBQ0tfU0FWRVBPSU5UKTsKICAgICAgICBpZiAobSA9PSBudWxsKQog\nICAgICAgICAgICBtID0gY3JlYXRlSkRCQzNNZXRob2QoUk9MTEJBQ0tfU0FW\nRVBPSU5ULCAicm9sbGJhY2siLAogICAgICAgICAgICAgICAgbmV3IENsYXNz\nW117IFNhdmVwb2ludC5jbGFzcyB9KTsKICAgICAgICBpbnZva2VKREJDMyht\nLCBuZXcgT2JqZWN0W117IHNhdmVwb2ludCB9KTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50KFNhdmVwb2ludCBzYXZlcG9pbnQp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7\nCiAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9kKSBfamRiYzMuZ2V0KFJFTEVB\nU0VfU0FWRVBPSU5UKTsKICAgICAgICBpZiAobSA9PSBudWxsKQogICAgICAg\nICAgICBtID0gY3JlYXRlSkRCQzNNZXRob2QoUkVMRUFTRV9TQVZFUE9JTlQs\nICJyZWxlYXNlU2F2ZXBvaW50IiwKICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBTYXZlcG9pbnQuY2xhc3MgfSk7CiAgICAgICAgaW52b2tlSkRCQzMo\nbSwgbmV3IE9iamVjdFtdeyBzYXZlcG9pbnQgfSk7CiAgICB9CgogICAgcHVi\nbGljIFN0YXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoaW50IHJlc3VsdFNldFR5\ncGUsCiAgICAgICAgaW50IHJlc3VsdFNldENvbmN1cnJlbmN5LCBpbnQgcmVz\ndWx0U2V0SG9sZGFiaWxpdHkpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgYXNzZXJ0SkRCQzMoKTsKICAgICAgICByZXR1cm4gY3Jl\nYXRlU3RhdGVtZW50KHJlc3VsdFNldFR5cGUsIHJlc3VsdFNldENvbmN1cnJl\nbmN5LAogICAgICAgICAgICByZXN1bHRTZXRIb2xkYWJpbGl0eSwgdHJ1ZSk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIFN0YXRlbWVudCBjcmVhdGVTdGF0ZW1l\nbnQoaW50IHJlc3VsdFNldFR5cGUsCiAgICAgICAgaW50IHJlc3VsdFNldENv\nbmN1cnJlbmN5LCBpbnQgcmVzdWx0U2V0SG9sZGFiaWxpdHksIGJvb2xlYW4g\nd3JhcCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBT\ndGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9kZWwgIT0gbnVsbCkKICAg\nICAgICAgICAgc3RtbnQgPSBfZGVsLmNyZWF0ZVN0YXRlbWVudChyZXN1bHRT\nZXRUeXBlLCByZXN1bHRTZXRDb25jdXJyZW5jeSwKICAgICAgICAgICAgICAg\nIHJlc3VsdFNldEhvbGRhYmlsaXR5LCBmYWxzZSk7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdldChD\nUkVBVEVfU1RBVEVNRU5UKTsKICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIG0gPSBjcmVhdGVKREJDM01ldGhvZChDUkVBVEVf\nU1RBVEVNRU5ULCAiY3JlYXRlU3RhdGVtZW50IiwKICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzLCBpbnQuY2xhc3MsIGludC5j\nbGFzcyB9KTsKICAgICAgICAgICAgc3RtbnQgPSAoU3RhdGVtZW50KSBpbnZv\na2VKREJDMyhtLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICBOdW1i\nZXJzLnZhbHVlT2YocmVzdWx0U2V0VHlwZSksCiAgICAgICAgICAgICAgICBO\ndW1iZXJzLnZhbHVlT2YocmVzdWx0U2V0Q29uY3VycmVuY3kpLAogICAgICAg\nICAgICAgICAgTnVtYmVycy52YWx1ZU9mKHJlc3VsdFNldEhvbGRhYmlsaXR5\nKSB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHdyYXApCiAgICAgICAgICAg\nIHN0bW50ID0gRGVsZWdhdGluZ1N0YXRlbWVudC5uZXdJbnN0YW5jZShzdG1u\ndCwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHN0bW50OwogICAgfQoKICAgIHB1\nYmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmlu\nZyBzcWwsCiAgICAgICAgaW50IHJlc3VsdFNldFR5cGUsIGludCByZXN1bHRT\nZXRDb25jdXJyZW5jeSwgaW50IHJlc3VsdFNldEhvbGRhYmlsaXR5KQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpEQkMz\nKCk7CiAgICAgICAgcmV0dXJuIHByZXBhcmVTdGF0ZW1lbnQoc3FsLCByZXN1\nbHRTZXRUeXBlLCByZXN1bHRTZXRDb25jdXJyZW5jeSwKICAgICAgICAgICAg\ncmVzdWx0U2V0SG9sZGFiaWxpdHksIHRydWUpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmlu\nZyBzcWwsCiAgICAgICAgaW50IHJlc3VsdFNldFR5cGUsIGludCByZXN1bHRT\nZXRDb25jdXJyZW5jeSwgaW50IHJlc3VsdFNldEhvbGRhYmlsaXR5LAogICAg\nICAgIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9kZWwg\nIT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQgPSBfZGVsLnByZXBhcmVTdGF0\nZW1lbnQoc3FsLCByZXN1bHRTZXRUeXBlLAogICAgICAgICAgICAgICAgcmVz\ndWx0U2V0Q29uY3VycmVuY3ksIHJlc3VsdFNldEhvbGRhYmlsaXR5LCBmYWxz\nZSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIE1ldGhvZCBtID0gKE1l\ndGhvZCkgX2pkYmMzLmdldChQUkVQQVJFX1NUQVRFTUVOVCk7CiAgICAgICAg\nICAgIGlmIChtID09IG51bGwpCiAgICAgICAgICAgICAgICBtID0gY3JlYXRl\nSkRCQzNNZXRob2QoUFJFUEFSRV9TVEFURU1FTlQsICJwcmVwYXJlU3RhdGVt\nZW50IiwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgU3RyaW5n\nLmNsYXNzLCBpbnQuY2xhc3MsIGludC5jbGFzcywKICAgICAgICAgICAgICAg\nICAgICAgICAgaW50LmNsYXNzIH0pOwogICAgICAgICAgICBzdG1udCA9IChQ\ncmVwYXJlZFN0YXRlbWVudCkgaW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtd\neyBzcWwsCiAgICAgICAgICAgICAgICBOdW1iZXJzLnZhbHVlT2YocmVzdWx0\nU2V0VHlwZSksCiAgICAgICAgICAgICAgICBOdW1iZXJzLnZhbHVlT2YocmVz\ndWx0U2V0Q29uY3VycmVuY3kpLAogICAgICAgICAgICAgICAgTnVtYmVycy52\nYWx1ZU9mKHJlc3VsdFNldEhvbGRhYmlsaXR5KSB9KTsKICAgICAgICB9CiAg\nICAgICAgaWYgKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0gRGVsZWdhdGlu\nZ1ByZXBhcmVkU3RhdGVtZW50Lm5ld0luc3RhbmNlKHN0bW50LCB0aGlzKTsK\nICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHVibGljIENhbGxh\nYmxlU3RhdGVtZW50IHByZXBhcmVDYWxsKFN0cmluZyBzcWwsCiAgICAgICAg\naW50IHJlc3VsdFNldFR5cGUsIGludCByZXN1bHRTZXRDb25jdXJyZW5jeSwg\naW50IHJlc3VsdFNldEhvbGRhYmlsaXR5KQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAgcmV0\ndXJuIHByZXBhcmVDYWxsKHNxbCwgcmVzdWx0U2V0VHlwZSwgcmVzdWx0U2V0\nQ29uY3VycmVuY3ksCiAgICAgICAgICAgIHJlc3VsdFNldEhvbGRhYmlsaXR5\nLCB0cnVlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2FsbGFibGVTdGF0ZW1l\nbnQgcHJlcGFyZUNhbGwoU3RyaW5nIHNxbCwgaW50IHJlc3VsdFNldFR5cGUs\nCiAgICAgICAgaW50IHJlc3VsdFNldENvbmN1cnJlbmN5LCBpbnQgcmVzdWx0\nU2V0SG9sZGFiaWxpdHksIGJvb2xlYW4gd3JhcCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBDYWxsYWJsZVN0YXRlbWVudCBzdG1u\ndDsKICAgICAgICBpZiAoX2RlbCAhPSBudWxsKQogICAgICAgICAgICBzdG1u\ndCA9IF9kZWwucHJlcGFyZUNhbGwoc3FsLCByZXN1bHRTZXRUeXBlLAogICAg\nICAgICAgICAgICAgcmVzdWx0U2V0Q29uY3VycmVuY3ksIHJlc3VsdFNldEhv\nbGRhYmlsaXR5LCBmYWxzZSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdldChQUkVQQVJFX0NBTEwp\nOwogICAgICAgICAgICBpZiAobSA9PSBudWxsKQogICAgICAgICAgICAgICAg\nbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFBSRVBBUkVfQ0FMTCwgInByZXBhcmVD\nYWxsIiwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgU3RyaW5n\nLmNsYXNzLCBpbnQuY2xhc3MsIGludC5jbGFzcywKICAgICAgICAgICAgICAg\nICAgICAgICAgaW50LmNsYXNzIH0pOwogICAgICAgICAgICBzdG1udCA9IChD\nYWxsYWJsZVN0YXRlbWVudCkgaW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtd\neyBzcWwsCiAgICAgICAgICAgICAgICBOdW1iZXJzLnZhbHVlT2YocmVzdWx0\nU2V0VHlwZSksCiAgICAgICAgICAgICAgICBOdW1iZXJzLnZhbHVlT2YocmVz\ndWx0U2V0Q29uY3VycmVuY3kpLAogICAgICAgICAgICAgICAgTnVtYmVycy52\nYWx1ZU9mKHJlc3VsdFNldEhvbGRhYmlsaXR5KSB9KTsKICAgICAgICB9CiAg\nICAgICAgaWYgKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0gRGVsZWdhdGlu\nZ0NhbGxhYmxlU3RhdGVtZW50Lm5ld0luc3RhbmNlKHN0bW50LCB0aGlzKTsK\nICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHVibGljIFByZXBh\ncmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwgaW50\nIGF1dG9HZW5lcmF0ZWRLZXlzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAgcmV0dXJuIHBy\nZXBhcmVTdGF0ZW1lbnQoc3FsLCBhdXRvR2VuZXJhdGVkS2V5cywgdHJ1ZSk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBh\ncmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwKICAgICAgICBpbnQgYXV0b0dlbmVy\nYXRlZEtleXMsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYg\nKF9kZWwgIT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQgPSBfZGVsLnByZXBh\ncmVTdGF0ZW1lbnQoc3FsLCBhdXRvR2VuZXJhdGVkS2V5cyk7CiAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMz\nLmdldChQUkVQQVJFX1dJVEhfS0VZUyk7CiAgICAgICAgICAgIGlmIChtID09\nIG51bGwpCiAgICAgICAgICAgICAgICBtID0gY3JlYXRlSkRCQzNNZXRob2Qo\nUFJFUEFSRV9XSVRIX0tFWVMsICJwcmVwYXJlU3RhdGVtZW50IiwKICAgICAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzLCBpbnQu\nY2xhc3MgfSk7CiAgICAgICAgICAgIHN0bW50ID0gKFByZXBhcmVkU3RhdGVt\nZW50KSBpbnZva2VKREJDMyhtLCBuZXcgT2JqZWN0W117IHNxbCwKICAgICAg\nICAgICAgICAgIE51bWJlcnMudmFsdWVPZihhdXRvR2VuZXJhdGVkS2V5cykg\nfSk7CiAgICAgICAgfQogICAgICAgIGlmICh3cmFwKQogICAgICAgICAgICBz\ndG1udCA9IERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudC5uZXdJbnN0YW5j\nZShzdG1udCwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHN0bW50OwogICAgfQoK\nICAgIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50\nKFN0cmluZyBzcWwsIGludFtdIGNvbHVtbkluZGV4ZXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRCQzMoKTsKICAg\nICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzcWwsIGNvbHVtbkluZGV4\nZXMsIHRydWUpOwogICAgfQoKICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRl\nbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzcWwsCiAgICAgICAgaW50\nW10gY29sdW1uSW5kZXhlcywgYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udDsKICAg\nICAgICBpZiAoX2RlbCAhPSBudWxsKQogICAgICAgICAgICBzdG1udCA9IF9k\nZWwucHJlcGFyZVN0YXRlbWVudChzcWwsIGNvbHVtbkluZGV4ZXMsIHdyYXAp\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBNZXRob2QgbSA9IChNZXRo\nb2QpIF9qZGJjMy5nZXQoUFJFUEFSRV9XSVRIX0lOREVYKTsKICAgICAgICAg\nICAgaWYgKG0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIG0gPSBjcmVhdGVK\nREJDM01ldGhvZChQUkVQQVJFX1dJVEhfSU5ERVgsICJwcmVwYXJlU3RhdGVt\nZW50IiwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgU3RyaW5n\nLmNsYXNzLCBpbnRbXS5jbGFzcyB9KTsKICAgICAgICAgICAgc3RtbnQgPSAo\nUHJlcGFyZWRTdGF0ZW1lbnQpIGludm9rZUpEQkMzKG0sIG5ldyBPYmplY3Rb\nXXsgc3FsLAogICAgICAgICAgICAgICAgY29sdW1uSW5kZXhlcyB9KTsKICAg\nICAgICB9CiAgICAgICAgaWYgKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0g\nRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50Lm5ld0luc3RhbmNlKHN0bW50\nLCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHVi\nbGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5n\nIHNxbCwgU3RyaW5nW10gY29sdW1uTmFtZXMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRCQzMoKTsKICAgICAgICBy\nZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzcWwsIGNvbHVtbk5hbWVzLCB0cnVl\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJl\ncGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLAogICAgICAgIFN0cmluZ1tdIGNv\nbHVtbk5hbWVzLCBib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9kZWwgIT0gbnVsbCkKICAgICAg\nICAgICAgc3RtbnQgPSBfZGVsLnByZXBhcmVTdGF0ZW1lbnQoc3FsLCBjb2x1\nbW5OYW1lcywgd3JhcCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIE1l\ndGhvZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdldChQUkVQQVJFX1dJVEhfTkFN\nRVMpOwogICAgICAgICAgICBpZiAobSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFBSRVBBUkVfV0lUSF9OQU1FUywg\nInByZXBhcmVTdGF0ZW1lbnQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBD\nbGFzc1tdeyBTdHJpbmcuY2xhc3MsIFN0cmluZ1tdLmNsYXNzIH0pOwogICAg\nICAgICAgICBzdG1udCA9IChQcmVwYXJlZFN0YXRlbWVudCkgaW52b2tlSkRC\nQzMobSwgbmV3IE9iamVjdFtdeyBzcWwsCiAgICAgICAgICAgICAgICBjb2x1\nbW5OYW1lcyB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHdyYXApCiAgICAg\nICAgICAgIHN0bW50ID0gRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50Lm5l\nd0luc3RhbmNlKHN0bW50LCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBhc3NlcnRKREJDMygp\nIHsKICAgICAgICBpZiAoX2pkYmMzID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbihfbG9jLmdl\ndCgibm90LWpkYmMzIikKICAgICAgICAgICAgICAgIC5nZXRNZXNzYWdlKCkp\nOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGludm9rZUpEQkMzKE1ldGhv\nZCBtLCBPYmplY3RbXSBhcmdzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbS5pbnZva2UoX2Nvbm4s\nIGFyZ3MpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAg\nICAgICAgIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAg\nICAgICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0\naHJvdyBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKF9sb2MuZ2V0KCJp\nbnZva2UtamRiYzMiKQogICAgICAgICAgICAgICAgLmdldE1lc3NhZ2UoKSwg\ndCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIE1ldGhv\nZCBjcmVhdGVKREJDM01ldGhvZChPYmplY3Qga2V5LCBTdHJpbmcgbmFtZSwK\nICAgICAgICBDbGFzczw/PltdIGFyZ3MpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBNZXRob2QgbSA9IENvbm5lY3Rpb24uY2xhc3MuZ2V0TWV0aG9k\nKG5hbWUsIGFyZ3MpOwogICAgICAgICAgICBfamRiYzMucHV0KGtleSwgbSk7\nCiAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOZXN0YWJsZVJ1bnRp\nbWVFeGNlcHRpb24oX2xvYy5nZXQoImVycm9yLWpkYmMzIikKICAgICAgICAg\nICAgICAgIC5nZXRNZXNzYWdlKCksIHQpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvLyBqYXZhLnNxbC5XcmFwcGVyIGltcGxlbWVudGF0aW9uIChKREJDIDQp\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1dyYXBwZXJGb3IoQ2xhc3MgaWZhY2Up\nIHsKICAgICAgICByZXR1cm4gaWZhY2UuaXNBc3NpZ25hYmxlRnJvbShnZXRE\nZWxlZ2F0ZSgpLmdldENsYXNzKCkpOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgdW53cmFwKENsYXNzIGlmYWNlKSB7CiAgICAgICAgaWYgKGlzV3JhcHBl\nckZvcihpZmFjZSkpCiAgICAgICAgICAgIHJldHVybiBnZXREZWxlZ2F0ZSgp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCn0K\n","encoding":"base64"}

