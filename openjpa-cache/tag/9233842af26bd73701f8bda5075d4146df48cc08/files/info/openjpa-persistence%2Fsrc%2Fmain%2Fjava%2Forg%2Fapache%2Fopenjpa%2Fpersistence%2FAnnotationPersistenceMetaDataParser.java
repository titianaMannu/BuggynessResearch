{"sha":"40e74c452678538a9aed0a5ae4556207af5857aa","node_id":"MDQ6QmxvYjIwNjM2NDo0MGU3NGM0NTI2Nzg1MzhhOWFlZDBhNWFlNDU1NjIwN2FmNTg1N2Fh","size":71189,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/40e74c452678538a9aed0a5ae4556207af5857aa","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgc3RhdGljIGphdmF4LnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlLkFV\nVE87CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3Rl\nbmNlLk1ldGFEYXRhVGFnLio7CgppbXBvcnQgamF2YS5pby5GaWxlOwppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcuYW5u\nb3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZp\nZWxkOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWVtYmVyOwppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZhLm5ldC5VUklTeW50YXhFeGNl\ncHRpb247CmltcG9ydCBqYXZhLm5ldC5VUkw7CmltcG9ydCBqYXZhLnNlY3Vy\naXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlM\naXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRp\nbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Cmlt\ncG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nU2V0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5T\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuU3RhY2s7CmltcG9ydCBqYXZhLnV0aWwu\nVHJlZVNldDsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5BY2Nlc3M7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5BY2Nlc3NUeXBlOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuQmFzaWM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5DYWNoZWFibGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5DYXNjYWRl\nVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVsZW1lbnRDb2xsZWN0\naW9uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW1iZWRkYWJsZTsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGVkOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRW1iZWRkZWRJZDsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLkVudGl0eTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudGl0eUxp\nc3RlbmVyczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkV4Y2x1ZGVEZWZh\ndWx0TGlzdGVuZXJzOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRXhjbHVk\nZVN1cGVyY2xhc3NMaXN0ZW5lcnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5GZXRjaFR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5GbHVzaE1v\nZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuR2VuZXJhdGVkVmFs\ndWU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5HZW5lcmF0aW9uVHlwZTsK\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5BY2Nlc3M7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5BY2Nlc3NUeXBlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5JZENsYXNzOwpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTG9iOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTWFueVRvTWFueTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLk1hbnlUb09uZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleUNsYXNzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTWFwcGVkQnlJZDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xhc3M7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJpZXM7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuTmFtZWRRdWVyaWVzOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTmFtZWRRdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk9uZVRvTWFu\neTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk9uZVRvT25lOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuT3JkZXJCeTsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlBvc3RMb2FkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9z\ndFBlcnNpc3Q7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Qb3N0UmVtb3Zl\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdFVwZGF0ZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlByZVBlcnNpc3Q7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5QcmVSZW1vdmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5QcmVVcGRhdGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeUhp\nbnQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZXF1ZW5jZUdlbmVyYXRv\ncjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlZlcnNpb247CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5CZWFuTGlmZWN5Y2xl\nQ2FsbGJhY2tzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lkxp\nZmVjeWNsZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\ndmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5ldmVudC5NZXRob2RMaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5qcHFsLkpQUUxQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJhY2tl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJp\ndkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5BY2Nl\nc3NDb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkRlbGVn\nYXRpbmdNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1vZGVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuT3JkZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRl\nZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVz\nZXJFeGNlcHRpb247CgppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CmltcG9y\ndCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBQZXJzaXN0ZW5jZSBhbm5v\ndGF0aW9uIG1ldGFkYXRhIHBhcnNlci4gQ3VycmVudGx5IGRvZXMgbm90IHBh\ncnNlCiAqIGRlcGxveW1lbnQgZGVzY3JpcHRvcnMuCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RldmUgS2ltCiAqIEBub2phdmFkb2MK\nICovCnB1YmxpYyBjbGFzcyBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0\nYVBhcnNlcgogICAgaW1wbGVtZW50cyBNZXRhRGF0YU1vZGVzIHsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKEFubm90YXRpb25QZXJzaXN0ZW5jZU1l\ndGFEYXRhUGFyc2VyLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBNYXA8Q2xhc3M8Pz4sIE1ldGFEYXRhVGFnPiBfdGFncyA9CiAgICAgICAg\nbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE1ldGFEYXRhVGFnPigpOwoKICAgIHN0\nYXRpYyB7CiAgICAgICAgX3RhZ3MucHV0KEFjY2Vzcy5jbGFzcywgQUNDRVNT\nKTsKICAgICAgICBfdGFncy5wdXQoQ2FjaGVhYmxlLmNsYXNzLCBDQUNIRUFC\nTEUpOwogICAgICAgIF90YWdzLnB1dChFbWJlZGRlZElkLmNsYXNzLCBFTUJF\nRERFRF9JRCk7CiAgICAgICAgX3RhZ3MucHV0KEVudGl0eUxpc3RlbmVycy5j\nbGFzcywgRU5USVRZX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4\nY2x1ZGVEZWZhdWx0TGlzdGVuZXJzLmNsYXNzLCBFWENMVURFX0RFRkFVTFRf\nTElTVEVORVJTKTsKICAgICAgICBfdGFncy5wdXQoRXhjbHVkZVN1cGVyY2xh\nc3NMaXN0ZW5lcnMuY2xhc3MsCiAgICAgICAgICAgIEVYQ0xVREVfU1VQRVJD\nTEFTU19MSVNURU5FUlMpOwogICAgICAgIF90YWdzLnB1dChGbHVzaE1vZGVU\neXBlLmNsYXNzLCBGTFVTSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoR2Vu\nZXJhdGVkVmFsdWUuY2xhc3MsIEdFTkVSQVRFRF9WQUxVRSk7CiAgICAgICAg\nX3RhZ3MucHV0KElkLmNsYXNzLCBJRCk7CiAgICAgICAgX3RhZ3MucHV0KElk\nQ2xhc3MuY2xhc3MsIElEX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFw\nS2V5LmNsYXNzLCBNQVBfS0VZKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5\nQ2xhc3MuY2xhc3MsIE1BUF9LRVlfQ0xBU1MpOwogICAgICAgIF90YWdzLnB1\ndChNYXBwZWRCeUlkLmNsYXNzLCBNQVBQRURfQllfSUQpOwogICAgICAgIF90\nYWdzLnB1dChOYW1lZE5hdGl2ZVF1ZXJpZXMuY2xhc3MsIE5BVElWRV9RVUVS\nSUVTKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVyeS5jbGFz\ncywgTkFUSVZFX1FVRVJZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWRRdWVy\naWVzLmNsYXNzLCBRVUVSSUVTKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWRR\ndWVyeS5jbGFzcywgUVVFUlkpOwogICAgICAgIF90YWdzLnB1dChPcmRlckJ5\nLmNsYXNzLCBPUkRFUl9CWSk7CiAgICAgICAgX3RhZ3MucHV0KFBvc3RMb2Fk\nLmNsYXNzLCBQT1NUX0xPQUQpOwogICAgICAgIF90YWdzLnB1dChQb3N0UGVy\nc2lzdC5jbGFzcywgUE9TVF9QRVJTSVNUKTsKICAgICAgICBfdGFncy5wdXQo\nUG9zdFJlbW92ZS5jbGFzcywgUE9TVF9SRU1PVkUpOwogICAgICAgIF90YWdz\nLnB1dChQb3N0VXBkYXRlLmNsYXNzLCBQT1NUX1VQREFURSk7CiAgICAgICAg\nX3RhZ3MucHV0KFByZVBlcnNpc3QuY2xhc3MsIFBSRV9QRVJTSVNUKTsKICAg\nICAgICBfdGFncy5wdXQoUHJlUmVtb3ZlLmNsYXNzLCBQUkVfUkVNT1ZFKTsK\nICAgICAgICBfdGFncy5wdXQoUHJlVXBkYXRlLmNsYXNzLCBQUkVfVVBEQVRF\nKTsKICAgICAgICBfdGFncy5wdXQoU2VxdWVuY2VHZW5lcmF0b3IuY2xhc3Ms\nIFNFUV9HRU5FUkFUT1IpOwogICAgICAgIF90YWdzLnB1dChWZXJzaW9uLmNs\nYXNzLCBWRVJTSU9OKTsKICAgICAgICBfdGFncy5wdXQoRGF0YUNhY2hlLmNs\nYXNzLCBEQVRBX0NBQ0hFKTsKICAgICAgICBfdGFncy5wdXQoRGF0YVN0b3Jl\nSWQuY2xhc3MsIERBVEFTVE9SRV9JRCk7CiAgICAgICAgX3RhZ3MucHV0KERl\ncGVuZGVudC5jbGFzcywgREVQRU5ERU5UKTsKICAgICAgICBfdGFncy5wdXQo\nRGV0YWNoZWRTdGF0ZS5jbGFzcywgREVUQUNIRURfU1RBVEUpOwogICAgICAg\nIF90YWdzLnB1dChFbGVtZW50RGVwZW5kZW50LmNsYXNzLCBFTEVNX0RFUEVO\nREVOVCk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRUeXBlLmNsYXNzLCBF\nTEVNX1RZUEUpOwogICAgICAgIF90YWdzLnB1dChFeHRlcm5hbFZhbHVlcy5j\nbGFzcywgRVhURVJOQUxfVkFMUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4dGVy\nbmFsaXplci5jbGFzcywgRVhURVJOQUxJWkVSKTsKICAgICAgICBfdGFncy5w\ndXQoRmFjdG9yeS5jbGFzcywgRkFDVE9SWSk7CiAgICAgICAgX3RhZ3MucHV0\nKEZldGNoR3JvdXAuY2xhc3MsIEZFVENIX0dST1VQKTsKICAgICAgICBfdGFn\ncy5wdXQoRmV0Y2hHcm91cHMuY2xhc3MsIEZFVENIX0dST1VQUyk7CiAgICAg\nICAgX3RhZ3MucHV0KEludmVyc2VMb2dpY2FsLmNsYXNzLCBJTlZFUlNFX0xP\nR0lDQUwpOwogICAgICAgIF90YWdzLnB1dChLZXlEZXBlbmRlbnQuY2xhc3Ms\nIEtFWV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1dChLZXlUeXBlLmNs\nYXNzLCBLRVlfVFlQRSk7CiAgICAgICAgX3RhZ3MucHV0KExvYWRGZXRjaEdy\nb3VwLmNsYXNzLCBMT0FEX0ZFVENIX0dST1VQKTsKICAgICAgICBfdGFncy5w\ndXQoTFJTLmNsYXNzLCBMUlMpOwogICAgICAgIF90YWdzLnB1dChNYW5hZ2Vk\nSW50ZXJmYWNlLmNsYXNzLCBNQU5BR0VEX0lOVEVSRkFDRSk7CiAgICAgICAg\nX3RhZ3MucHV0KFJlYWRPbmx5LmNsYXNzLCBSRUFEX09OTFkpOwogICAgICAg\nIF90YWdzLnB1dChUeXBlLmNsYXNzLCBUWVBFKTsKICAgICAgICBfdGFncy5w\ndXQoUmVwbGljYXRlZC5jbGFzcywgUkVQTElDQVRFRCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBmaW5hbCBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZjsKICAg\nIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAgICBwcml2YXRlIE1ldGFEYXRh\nUmVwb3NpdG9yeSBfcmVwb3MgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc0xv\nYWRlciBfZW52TG9hZGVyID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nb3ZlcnJpZGUgPSBmYWxzZTsKICAgIHByaXZhdGUgaW50IF9tb2RlID0gTU9E\nRV9OT05FOwoKICAgIC8vIHBhY2thZ2VzIGFuZCB0aGVpciBwYXJzZSBtb2Rl\ncwogICAgcHJpdmF0ZSBmaW5hbCBNYXA8UGFja2FnZSwgSW50ZWdlcj4gX3Br\nZ3MgPSBuZXcgSGFzaE1hcDxQYWNrYWdlLCBJbnRlZ2VyPigpOwoKICAgIC8v\nIHRoZSBjbGFzcyB3ZSB3ZXJlIGludm9rZWQgdG8gcGFyc2UKICAgIHByb3Rl\nY3RlZCBDbGFzczw/PiBfY2xzID0gbnVsbDsKICAgIHByb3RlY3RlZCBTdGFj\nazxDbGFzczw/Pj4gX3N0YWNrID0gbmV3IFN0YWNrPENsYXNzPD8+PigpOwog\nICAgcHJpdmF0ZSBGaWxlIF9maWxlID0gbnVsbDsKCiAgICAvKioKICAgICAq\nIENvbnN0cnVjdG9yOyBzdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAqLwog\nICAgcHVibGljIEFubm90YXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2Vy\nKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9\nIGNvbmY7CiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25m\naWd1cmF0aW9uLkxPR19NRVRBREFUQSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb25maWd1cmF0aW9uIHN1cHBsaWVkIG9uIGNvbnN0cnVjdGlvbi4KICAg\nICAqLwogICAgcHVibGljIE9wZW5KUEFDb25maWd1cmF0aW9uIGdldENvbmZp\nZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAg\nIC8qKgogICAgICogTWV0YWRhdGEgbG9nLgogICAgICovCiAgICBwdWJsaWMg\nTG9nIGdldExvZygpIHsKICAgICAgICByZXR1cm4gX2xvZzsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIHJlcG9zaXRvcnkgZm9yIHRoaXMg\ncGFyc2VyLiBJZiBub25lIGhhcyBiZWVuIHNldCwKICAgICAqIGNyZWF0ZSBh\nIG5ldyByZXBvc2l0b3J5IGFuZCBzZXRzIGl0LgogICAgICovCiAgICBwdWJs\naWMgTWV0YURhdGFSZXBvc2l0b3J5IGdldFJlcG9zaXRvcnkoKSB7CiAgICAg\nICAgaWYgKF9yZXBvcyA9PSBudWxsKSB7CiAgICAgICAgICAgIE1ldGFEYXRh\nUmVwb3NpdG9yeSByZXBvcyA9IF9jb25mLm5ld01ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCk7CiAgICAgICAgICAgIE1ldGFEYXRhRmFjdG9yeSBtZGYg\nPSByZXBvcy5nZXRNZXRhRGF0YUZhY3RvcnkoKTsKICAgICAgICAgICAgaWYg\nKG1kZiBpbnN0YW5jZW9mIERlbGVnYXRpbmdNZXRhRGF0YUZhY3RvcnkpCiAg\nICAgICAgICAgICAgICBtZGYgPSAoKERlbGVnYXRpbmdNZXRhRGF0YUZhY3Rv\ncnkpIG1kZikuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICAgICAg\naWYgKG1kZiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5\nKQogICAgICAgICAgICAgICAgKChQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9y\neSkgbWRmKS5zZXRBbm5vdGF0aW9uUGFyc2VyKHRoaXMpOwogICAgICAgICAg\nICBfcmVwb3MgPSByZXBvczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9y\nZXBvczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgbWV0YWRhdGEg\ncmVwb3NpdG9yeSBmb3IgdGhpcyBwYXJzZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFJlcG9zaXRvcnkoTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nKSB7CiAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVyIHRv\nIHBhc3Mgb24gdG8gcGFyc2VkCiAgICAgKiBtZXRhZGF0YSBpbnN0YW5jZXMu\nCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc0xvYWRlciBnZXRFbnZDbGFzc0xv\nYWRlcigpIHsKICAgICAgICByZXR1cm4gX2VudkxvYWRlcjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2Fk\nZXIgdG8gcGFzcyBvbiB0byBwYXJzZWQKICAgICAqIG1ldGFkYXRhIGluc3Rh\nbmNlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RW52Q2xhc3NMb2Fk\nZXIoQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgX2VudkxvYWRlciA9\nIGxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gYWxs\nb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBpbmcgaW5mb3JtYXRpb24gdG8gb3Zl\ncnJpZGUKICAgICAqIGVhcmxpZXIgaW5mb3JtYXRpb24gZm9yIHRoZSBzYW1l\nIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxzZS4gVXNlZnVsCiAgICAgKiB3aGVu\nIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xhc3MsIHNvIHRoYXQgYW5ub3RhdGlv\nbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAqIGluZm9ybWF0aW9uIGNhbiBiZSB1\nc2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBhcmUgc3RvcmVkIGluIGFub3RoZXIK\nICAgICAqIGxvY2F0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRNYXBwaW5nT3ZlcnJpZGUoKSB7CiAgICAgICAgcmV0dXJuIF9vdmVycmlk\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0\nZXIgcGFyc2VzIG9mIG1hcHBpbmcgaW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUK\nICAgICAqIGVhcmxpZXIgaW5mb3JtYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNz\nLiBEZWZhdWx0cyB0byBmYWxzZS4gVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9v\nbCBpcyBtYXBwaW5nIGEgY2xhc3MsIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0\naWFsIG1hcHBpbmcKICAgICAqIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2\nZW4gd2hlbiBtYXBwaW5ncyBhcmUgc3RvcmVkIGluIGFub3RoZXIKICAgICAq\nIGxvY2F0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNYXBwaW5n\nT3ZlcnJpZGUoYm9vbGVhbiBvdmVycmlkZSkgewogICAgICAgIF9vdmVycmlk\nZSA9IG92ZXJyaWRlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBhcnNl\nIG1vZGUuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0TW9kZSgpIHsKICAg\nICAgICByZXR1cm4gX21vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\ncGFyc2UgbW9kZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TW9kZShp\nbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChtb2RlID09IE1P\nREVfTk9ORSkKICAgICAgICAgICAgX21vZGUgPSBNT0RFX05PTkU7CiAgICAg\nICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF9tb2RlIHw9IG1vZGU7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfbW9kZSAmPSB+bW9kZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBwYXJzZSBtb2RlLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRNb2RlKGludCBtb2RlKSB7CiAgICAgICAgX21vZGUg\nPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0\naG9kIGZvciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNZXRhRGF0YU1vZGUoKSB7CiAg\nICAgICAgcmV0dXJuIChfbW9kZSAmIE1PREVfTUVUQSkgIT0gMDsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJw\ncmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzUXVlcnlNb2RlKCkgewogICAgICAgIHJldHVybiAoX21v\nZGUgJiBNT0RFX1FVRVJZKSAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcge0BsaW5rICNn\nZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBw\naW5nTW9kZSgpIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTU9ERV9NQVBQ\nSU5HKSAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVl\nIGlmIHdlJ3JlIGluIG1hcHBpbmcgbW9kZSBvciBpbiBtZXRhZGF0YSBtb2Rl\nIHdpdGgKICAgICAqIG1hcHBpbmcgb3ZlcmlkZSBlbmFibGVkLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01hcHBpbmdPdmVycmlkZU1vZGUo\nKSB7CiAgICAgICAgcmV0dXJuIGlzTWFwcGluZ01vZGUoKSB8fCAoX292ZXJy\naWRlICYmIGlzTWV0YURhdGFNb2RlKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2xlYXIgY2FjaGVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVh\ncigpIHsKICAgIAlfc3RhY2suY2xlYXIoKTsKICAgICAgICBfY2xzID0gbnVs\nbDsKICAgICAgICBfZmlsZSA9IG51bGw7CiAgICAgICAgX3BrZ3MuY2xlYXIo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHBlcnNpc3RlbmNlIG1l\ndGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHBhcnNlKENsYXNzPD8+IGNscykgewogICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoInBhcnNlLWNsYXNzIiwgY2xzLmdldE5hbWUoKSkpOwoKICAgICAg\nICBfY2xzID0gY2xzOwogICAgICAgIF9zdGFjay5wdXNoKGNscyk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcGFyc2VQYWNrYWdlQW5ub3RhdGlvbnMo\nKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcGFyc2VDbGFz\nc0Fubm90YXRpb25zKCk7CiAgICAgICAgICAgIHVwZGF0ZVNvdXJjZU1vZGUo\nbWV0YSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAJX3N0YWNrLnBv\ncCgpOwogICAgICAgICAgICBfY2xzID0gX3N0YWNrLmlzRW1wdHkoKSA/IG51\nbGwgOiBfc3RhY2sucGVlaygpOwogICAgICAgICAgICBfZmlsZSA9IG51bGw7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBz\nb3VyY2UgbW9kZSB0byB0aGUgY2xhc3MgcGFja2FnZSBhbmQgY2xhc3MgdG8g\naW5kaWNhdGUgdGhhdAogICAgICogd2UndmUgZnVsbHkgcGFyc2VkIHRoZW0u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVTb3VyY2VNb2RlKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfY2xzLmdldFBhY2th\nZ2UoKSAhPSBudWxsKQogICAgICAgICAgICBhZGRTb3VyY2VNb2RlKF9jbHMu\nZ2V0UGFja2FnZSgpLCBfbW9kZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVs\nbCkKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKF9tb2RlLCB0cnVl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGluZm9ybWF0aW9uIGlu\nIHBhY2thZ2UtbGV2ZWwgY2xhc3MgYW5ub3RhdGlvbnMuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwYXJzZVBhY2thZ2VBbm5vdGF0aW9ucygpIHsKICAg\nICAgICBQYWNrYWdlIHBrZyA9IF9jbHMuZ2V0UGFja2FnZSgpOwogICAgICAg\nIGlmIChwa2cgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBpbnQgcGtnTW9kZSA9IGdldFNvdXJjZU1vZGUocGtnKTsKICAgICAgICBp\nZiAocGtnTW9kZSA9PSAwICYmIF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtcGFja2FnZSIs\nIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgaWYgKChwa2dNb2RlICYgX21v\nZGUpID09IF9tb2RlKSAvLyBhbHJlYWR5IHZpc2l0ZWQKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAgICAgZm9y\nIChBbm5vdGF0aW9uIGFubm8gOiBwa2cuZ2V0RGVjbGFyZWRBbm5vdGF0aW9u\ncygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5vLmFubm90\nYXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25QYWNrYWdlQW5ub3RhdGlv\nbihwa2csIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAg\nICAgICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9RVUVS\nWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZE5h\ndGl2ZVF1ZXJpZXMocGtnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKChOYW1lZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBOQVRJ\nVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2Rl\nKCkgJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhwa2csIChO\nYW1lZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUklFUzoKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1P\nREVfUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNl\nTmFtZWRRdWVyaWVzKHBrZywgKChOYW1lZFF1ZXJpZXMpIGFubm8pLnZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVy\neU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKHBrZywgKE5h\nbWVkUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJgogICAg\nICAgICAgICAgICAgICAgICAgICAocGtnTW9kZSAmIE1PREVfTUFQUElORykg\nPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1ZW5jZUdl\nbmVyYXRvcihwa2csIChTZXF1ZW5jZUdlbmVyYXRvcikgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBwa2csCiAgICAgICAg\nICAgICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhbHdheXMgcGFyc2UgbWFwcGlu\nZyBzdHVmZiBhZnRlciBtZXRhZGF0YSBzdHVmZiwgaW4gY2FzZSB0aGVyZSBh\ncmUKICAgICAgICAvLyBkZXBlbmRlbmNpZXMgb24gbWV0YWRhdGEKICAgICAg\nICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgKHBrZ01vZGUgJiBN\nT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIHBhcnNlUGFja2FnZU1h\ncHBpbmdBbm5vdGF0aW9ucyhwa2cpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgcGFja2FnZSBtYXBwaW5nIGFubm90YXRpb25zLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3RhdGlv\nbnMoUGFja2FnZSBwa2cpIHsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93\nIHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25QYWNr\nYWdlQW5ub3RhdGlvbihQYWNrYWdlIHBrZywKICAgICAgICBBbm5vdGF0aW9u\nIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZm9yIHRoZSBnaXZlbiBwYWNrYWdl\nLgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRTb3VyY2VNb2RlKFBhY2th\nZ2UgcGtnKSB7CiAgICAgICAgTnVtYmVyIG51bSA9IF9wa2dzLmdldChwa2cp\nOwogICAgICAgIHJldHVybiAobnVtID09IG51bGwpID8gMCA6IG51bS5pbnRW\nYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRvIHRoZSBzb3Vy\nY2UgbW9kZSBmb3IgdGhlIGdpdmVuIHBhY2thZ2UuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRTb3VyY2VNb2RlKFBhY2thZ2UgcGtnLCBpbnQgbW9k\nZSkgewogICAgICAgIEludGVnZXIgbnVtID0gX3BrZ3MuZ2V0KHBrZyk7CiAg\nICAgICAgaWYgKG51bSA9PSBudWxsKQogICAgICAgICAgICBudW0gPSBOdW1i\nZXJzLnZhbHVlT2YobW9kZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBu\ndW0gPSBOdW1iZXJzLnZhbHVlT2YobnVtLmludFZhbHVlKCkgfCBtb2RlKTsK\nICAgICAgICBfcGtncy5wdXQocGtnLCBudW0pOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVhZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGN1cnJlbnQgdHlwZS4K\nICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIHBhcnNlQ2xhc3NB\nbm5vdGF0aW9ucygpIHsKICAgICAgICAvLyBjaGVjayBpbW1lZGlhdGVseSB3\naGV0aGVyIHRoZSB1c2VyIGlzIHVzaW5nIGFueSBhbm5vdGF0aW9ucywKICAg\nICAgICAvLyByZWdhcmRsZXNzIG9mIG1vZGUuICB0aGlzIHByZXZlbnRzIGFk\nZGluZyBub24tZW50aXR5IGNsYXNzZXMgdG8KICAgICAgICAvLyByZXBvc2l0\nb3J5IGlmIHdlJ3JlIGlnbm9yaW5nIHRoZXNlIGFubm90YXRpb25zIGluIG1h\ncHBpbmcgbW9kZQogICAgICAgIGlmICghKEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgIC5pc0Fubm90\nYXRpb25QcmVzZW50QWN0aW9uKF9jbHMsIEVudGl0eS5jbGFzcykpKS5ib29s\nZWFuVmFsdWUoKQogICAgICAgICAgICAmJiAhKEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAu\naXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihfY2xzLCBFbWJlZGRhYmxlLmNs\nYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkKICAgICAg\nICAgICAgJiYgIShBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRv\nUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNl\nbnRBY3Rpb24oX2NscywgTWFwcGVkU3VwZXJjbGFzcy5jbGFzcykpKQogICAg\nICAgICAgICAgICAgLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgLy8gZmluZCAvIGNyZWF0ZSBtZXRhZGF0YQog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGdldE1ldGFEYXRhKCk7CiAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIEVudGl0eSBlbnRpdHkgPSBfY2xzLmdldEFubm90YXRp\nb24oRW50aXR5LmNsYXNzKTsKICAgICAgICBNYXBwZWRTdXBlcmNsYXNzIG1h\ncHBlZCA9IF9jbHMuZ2V0QW5ub3RhdGlvbihNYXBwZWRTdXBlcmNsYXNzLmNs\nYXNzKTsKICAgICAgICBFbWJlZGRhYmxlIGVtYmVkZGFibGUgPSBfY2xzLmdl\ndEFubm90YXRpb24oRW1iZWRkYWJsZS5jbGFzcyk7CiAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpIHsKICAgICAgICAgICAgbWV0YS5zZXRBYnN0cmFj\ndChtYXBwZWQgIT0gbnVsbCk7CiAgICAgICAgICAgIGlmIChlbWJlZGRhYmxl\nICE9IG51bGwpIG1ldGEuc2V0RW1iZWRkYWJsZSgpOwogICAgICAgICAgICAv\nLyB3aGlsZSB0aGUgc3BlYyBvbmx5IHByb3ZpZGVzIGZvciBlbWJlZGRlZCBl\neGNsdXNpdmUsIGl0IGRvZXNuJ3QKICAgICAgICAgICAgLy8gc2VlbSBoYXJk\nIHRvIHN1cHBvcnQgb3RoZXJ3aXNlCiAgICAgICAgICAgIGlmIChlbnRpdHkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RW1iZWRkZWRPbmx5\nKHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1l\ndGEuc2V0RW1iZWRkZWRPbmx5KGZhbHNlKTsKICAgICAgICAgICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShlbnRpdHkubmFtZSgpKSkKICAgICAg\nICAgICAgICAgICAgICBtZXRhLnNldFR5cGVBbGlhcyhlbnRpdHkubmFtZSgp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gdHJhY2sg\nZmV0Y2ggZ3JvdXBzIHRvIHBhcnNlIHRoZW0gYWZ0ZXIgZmllbGRzLCBzaW5j\nZSB0aGV5CiAgICAgICAgLy8gcmVseSBvbiBmaWVsZCBtZXRhZGF0YQogICAg\nICAgIEZldGNoR3JvdXBbXSBmZ3MgPSBudWxsOwogICAgICAgIERldGFjaGVk\nU3RhdGUgZGV0YWNoZWQgPSBudWxsOwoKICAgICAgICAvLyB0cmFjayBsaXN0\nZW5lcnMgc2luY2Ugd2UgbmVlZCB0byBtZXJnZSB0aGVtIHdpdGggZW50aXR5\nIGNhbGxiYWNrcwogICAgICAgIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJh\nY2tzPltdIGxpc3RlbmVycyA9IG51bGw7CiAgICAgICAgTWV0YURhdGFUYWcg\ndGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogX2Nscy5nZXRE\nZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFnID0gX3Rh\nZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgIGlm\nICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxlVW5rbm93\nbkNsYXNzQW5ub3RhdGlvbihtZXRhLCBhbm5vKTsKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2gg\nKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBFTlRJVFlfTElTVEVORVJT\nOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnMgPSBwYXJzZUVudGl0\neUxpc3RlbmVycyhtZXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKEVudGl0eUxpc3RlbmVycykgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYQ0xVREVfREVGQVVMVF9M\nSVNURU5FUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0TGlmZWN5\nY2xlTWV0YURhdGEoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNl\ndElnbm9yZVN5c3RlbUxpc3RlbmVycyh0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhDTFVERV9TVVBF\nUkNMQVNTX0xJU1RFTkVSUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5n\nZXRMaWZlY3ljbGVNZXRhRGF0YSgpLnNldElnbm9yZVN1cGVyY2xhc3NDYWxs\nYmFja3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChMaWZlY3ljbGVN\nZXRhRGF0YS5JR05PUkVfSElHSCk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUobWV0YSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElEX0NMQVNT\nOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBtZXRhLnNldE9iamVjdElkVHlwZSgo\nKElkQ2xhc3MpIGFubm8pLnZhbHVlKCksIHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBOQVRJVkVfUVVF\nUklFUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAm\nJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZKT09MCkKICAg\nICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJpZXMo\nX2NscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoTmFtZWROYXRp\ndmVRdWVyaWVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTkFUSVZFX1FVRVJZOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChtZXRh\nLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfUVVFUlkpPT0wKQogICAgICAgICAg\nICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhfY2xzLCAo\nTmFtZWROYXRpdmVRdWVyeSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFVRVJJRVM6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKG1ldGEuZ2V0U291\ncmNlTW9kZSgpICYgTU9ERV9RVUVSWSk9PTApCiAgICAgICAgICAgICAgICAg\nICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKF9jbHMsICgoTmFtZWRRdWVyaWVz\nKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgUVVFUlk6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgp\nICYgTU9ERV9RVUVSWSk9PTApCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlTmFtZWRRdWVyaWVzKF9jbHMsIChOYW1lZFF1ZXJ5KSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nU0VRX0dFTkVSQVRPUjoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBw\naW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlU2VxdWVuY2VHZW5lcmF0b3IoX2NscywgKFNlcXVlbmNlR2VuZXJhdG9y\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgREFUQV9DQUNIRToKICAgICAgICAgICAgICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFyc2VEYXRhQ2FjaGUobWV0YSwgKERhdGFDYWNoZSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERB\nVEFTVE9SRV9JRDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRhU3Rv\ncmVJZChtZXRhLCAoRGF0YVN0b3JlSWQpIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBERVRBQ0hFRF9T\nVEFURToKICAgICAgICAgICAgICAgICAgICBkZXRhY2hlZCA9IChEZXRhY2hl\nZFN0YXRlKSBhbm5vOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBGRVRDSF9HUk9VUDoKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgZmdzID0gbmV3IEZldGNoR3JvdXBbXXsgKEZldGNoR3JvdXApIGFu\nbm8gfTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgRkVUQ0hfR1JPVVBTOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBm\nZ3MgPSAoKEZldGNoR3JvdXBzKSBhbm5vKS52YWx1ZSgpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQU5BR0VE\nX0lOVEVSRkFDRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VNYW5hZ2Vk\nSW50ZXJmYWNlKG1ldGEsIChNYW5hZ2VkSW50ZXJmYWNlKSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nUkVQTElDQVRFRDoKICAgICAgICAgICAgICAgIAltZXRhLnNldFJlcGxpY2F0\nZWQodHJ1ZSk7CiAgICAgICAgICAgICAgICAJYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEFDQ0VTUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VB\nY2Nlc3MobWV0YSwgKEFjY2Vzcylhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ0FDSEVBQkxFOiAKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgeyAKICAg\nICAgICAgICAgICAgICAgICAgICAgcGFyc2VDYWNoZShtZXRhLCAoQ2FjaGVh\nYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBfY2xzLAogICAgICAgICAgICAg\nICAgICAgICAgICBhbm5vLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpIHsKICAg\nICAgICAgICAgcGFyc2VEZXRhY2hlZFN0YXRlKG1ldGEsIGRldGFjaGVkKTsK\nCiAgICAgICAgICAgIC8vIG1lcmdlIGNhbGxiYWNrIG1ldGhvZHMgd2l0aCBk\nZWNsYXJlZCBsaXN0ZW5lcnMKICAgICAgICAgICAgaW50W10gaGlnaHMgPSBu\ndWxsOwogICAgICAgICAgICBpZiAobGlzdGVuZXJzICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGhpZ2hzID0gbmV3IGludFtsaXN0ZW5lcnMubGVuZ3Ro\nXTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlzdGVu\nZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0\nZW5lcnNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgaGln\naHNbaV0gPSBsaXN0ZW5lcnNbaV0uc2l6ZSgpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJlY29yZENhbGxiYWNrcyhtZXRhLCBwYXJzZUNhbGxiYWNr\nTWV0aG9kcyhfY2xzLCBsaXN0ZW5lcnMsIGZhbHNlLAogICAgICAgICAgICAg\nICAgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIGhpZ2hzLCBmYWxzZSk7Cgog\nICAgICAgICAgICAvLyBzY2FuIHBvc3NpYmx5IG5vbi1QQyBoaWVyYXJjaHkg\nZm9yIGNhbGxiYWNrcy4KICAgICAgICAgICAgLy8gcmVkdW5kYW50IGZvciBQ\nQyBzdXBlcmNsYXNzIGJ1dCB3ZSBkb24ndCBrbm93IHRoYXQgeWV0CiAgICAg\nICAgICAgIC8vIHNvIGxldCBMaWZlY3ljbGVNZXRhRGF0YSBkZXRlcm1pbmUg\ndGhhdAogICAgICAgICAgICBpZiAoX2Nscy5nZXRTdXBlcmNsYXNzKCkgIT0g\nbnVsbCAmJgogICAgICAgICAgICAgICAgIU9iamVjdC5jbGFzcy5lcXVhbHMo\nX2Nscy5nZXRTdXBlcmNsYXNzKCkpKSB7CiAgICAgICAgICAgICAgICByZWNv\ncmRDYWxsYmFja3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2Nscy5n\nZXRTdXBlcmNsYXNzKCksCiAgICAgICAgICAgICAgICAgICAgbnVsbCwgdHJ1\nZSwgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIG51bGwsIHRydWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKEZpZWxkTWV0YURh\ndGEgZm1kIDogbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKQogICAgICAgICAg\nICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1B\nTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgcGFyc2VNZW1iZXJB\nbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIC8vIHBhcnNlIGZldGNoIGdyb3Vw\ncyBhZnRlciBmaWVsZHMKICAgICAgICBpZiAoZmdzICE9IG51bGwpCiAgICAg\nICAgICAgIHBhcnNlRmV0Y2hHcm91cHMobWV0YSwgZmdzKTsKCiAgICAgICAg\nLy8gYWx3YXlzIHBhcnNlIG1hcHBpbmcgYWZ0ZXIgbWV0YWRhdGEgaW4gY2Fz\nZSB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzCiAgICAgICAgaWYgKGlzTWFwcGlu\nZ092ZXJyaWRlTW9kZSgpKSB7CiAgICAgICAgICAgIHBhcnNlQ2xhc3NNYXBw\naW5nQW5ub3RhdGlvbnMobWV0YSk7CiAgICAgICAgICAgIGZvciAoRmllbGRN\nZXRhRGF0YSBmbWQgOiBtZXRhLmdldERlY2xhcmVkRmllbGRzKCkpCiAgICAg\nICAgICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1l\ndGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgICAg\nIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRpb25zKGZtZCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBleHBsaWNpdCBhY2Nlc3MgdHlwZSwgaWYgc3BlY2lmaWVkLgog\nICAgICovICAgIAogICAgcHJpdmF0ZSB2b2lkIHBhcnNlQWNjZXNzKENsYXNz\nTWV0YURhdGEgbWV0YSwgQWNjZXNzIGFjY2VzcykgewogICAgCWlmIChhY2Nl\nc3MgIT0gbnVsbCkgewogICAgCQltZXRhLnNldEFjY2Vzc1R5cGUoQWNjZXNz\nQ29kZS5FWFBMSUNJVCAKICAgICAgICAgICAgfCAoYWNjZXNzLnZhbHVlKCkg\nPT0gQWNjZXNzVHlwZS5GSUVMRCA/IAogICAgICAgICAgICAJQWNjZXNzQ29k\nZS5GSUVMRCA6IEFjY2Vzc0NvZGUuUFJPUEVSVFkpKTsKICAgIAl9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBjbGFzcyBtYXBwaW5nIGFubm90YXRp\nb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUNsYXNzTWFw\ncGluZ0Fubm90YXRpb25zKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgfQoK\nICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5r\nbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaGFuZGxlVW5rbm93bkNsYXNzQW5ub3RhdGlvbihDbGFzc01ldGFEYXRh\nIG1ldGEsCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCBvciBjcmVh\ndGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiB0eXBlLiBNYXkgcmV0dXJuIG51\nbGwgaWYKICAgICAqIHRoaXMgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBwYXJz\nZWQgZnVsbHkuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBn\nZXRNZXRhRGF0YSgpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBn\nZXRSZXBvc2l0b3J5KCkuZ2V0Q2FjaGVkTWV0YURhdGEoX2Nscyk7CiAgICAg\nICAgaWYgKG1ldGEgIT0gbnVsbCAmJgogICAgICAgICAgICAoKGlzTWV0YURh\ndGFNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9NRVRB\nKSAhPSAwKSB8fAogICAgICAgICAgICAgICAgKGlzTWFwcGluZ01vZGUoKSAm\nJgogICAgICAgICAgICAgICAgICAgIChtZXRhLmdldFNvdXJjZU1vZGUoKSAm\nIE1PREVfTUFQUElORykgIT0gMCkpKSB7CiAgICAgICAgICAgIGlmIChfbG9n\nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiZHVwLW1ldGFkYXRhIiwgX2Nscy5nZXROYW1lKCkpKTsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAo\nbWV0YSA9PSBudWxsKSB7CiAgICAgICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0\nb3J5KCkuYWRkTWV0YURhdGEoX2NscywgZ2V0QWNjZXNzQ29kZShfY2xzKSk7\nCiAgICAgICAgICAgIG1ldGEuc2V0RW52Q2xhc3NMb2FkZXIoX2VudkxvYWRl\ncik7CiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX05PTkUp\nOwogICAgICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCks\nIFNvdXJjZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRz\nIHRoZSBleHBsaWNpdCBhY2Nlc3MgZm9yIHRoZSBjbGFzcywgaWYgYW55Lgog\nICAgICogRXhwbGljaXQgYWNjZXNzIHR5cGUgc3BlY2lmaWNhdGlvbiBkb2Vz\nIG5vdCBhZmZlY3QgdGhlIGFjY2VzcyB0eXBlIG9mIAogICAgICogb3RoZXIg\nZW50aXR5IGNsYXNzZXMgb3IgbWFwcGVkIHN1cGVyIGNsYXNzZXMgaW4gdGhl\nIGVudGl0eSBoaWVyYXJjaHkuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdl\ndEFjY2Vzc0NvZGUoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgaW50IGFjY2Vz\nc0NvZGUgPSBBY2Nlc3NDb2RlLlVOS05PV047CiAgICAgICAgQWNjZXNzIGFj\nY2VzcyA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5nZXRBbm5vdGF0aW9uQWN0aW9uKGNscywg\nQWNjZXNzLmNsYXNzKSk7CiAgICAgICAgaWYgKGFjY2VzcyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGFjY2Vzc0NvZGUgfD0gIEFjY2Vzc0NvZGUuRVhQTElD\nSVQgfCAKICAgICAgICAgICAgICAgIChhY2Nlc3MudmFsdWUoKSA9PSBBY2Nl\nc3NUeXBlLkZJRUxEID8gCiAgICAgICAgICAgICAgICBBY2Nlc3NDb2RlLkZJ\nRUxEIDogQWNjZXNzQ29kZS5QUk9QRVJUWSk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBhY2Nlc3NDb2RlOwogICAgfQoKICAgIC8qKgogICAgICogRGV0\nZXJtaW5lIHRoZSBzb3VyY2UgZmlsZSB3ZSdyZSBwYXJzaW5nLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAgICAg\nIGlmIChfZmlsZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2ZpbGU7\nCgogICAgICAgIENsYXNzPD8+IGNscyA9IF9jbHM7CiAgICAgICAgd2hpbGUg\nKGNscy5nZXRFbmNsb3NpbmdDbGFzcygpICE9IG51bGwpCiAgICAgICAgICAg\nIGNscyA9IGNscy5nZXRFbmNsb3NpbmdDbGFzcygpOwoKICAgICAgICBTdHJp\nbmcgcnNyYyA9IFN0cmluZ1V0aWxzLnJlcGxhY2UoY2xzLmdldE5hbWUoKSwg\nIi4iLCAiLyIpOwogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihjbHMpKTsgCiAgICAgICAg\naWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAgICBsb2FkZXIgPSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldFN5c3RlbUNsYXNzTG9hZGVyQWN0aW9uKCkpOyAK\nICAgICAgICBpZiAobG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIFVSTCB1cmwgPSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0UmVz\nb3VyY2VBY3Rpb24obG9hZGVyLCByc3JjICsgIi5qYXZhIikpOyAKICAgICAg\nICBpZiAodXJsID09IG51bGwpIHsKICAgICAgICAgICAgdXJsID0gQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5nZXRSZXNvdXJjZUFjdGlvbihsb2FkZXIsIHJzcmMgKyAi\nLmNsYXNzIikpOyAKICAgICAgICAgICAgaWYgKHVybCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF9maWxlID0gbmV3IEZpbGUodXJsLnRvVVJJKCkp\nOwogICAgICAgIH0gY2F0Y2ggKFVSSVN5bnRheEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgfSBjYXRjaCAoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlhZSkg\newogICAgICAgICAgICAvLyB0aGlzIGlzIHRocm93biB3aGVuIHRoZSBVUkkg\naXMgbm9uLWhpZXJhcmNoaWNhbCAoYWthIEpCb3NzKQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gX2ZpbGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBARGF0YVN0b3JlSWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZURhdGFTdG9yZUlkKENsYXNzTWV0YURhdGEgbWV0YSwgRGF0YVN0b3JlSWQg\naWQpIHsKICAgICAgICBtZXRhLnNldElkZW50aXR5VHlwZShDbGFzc01ldGFE\nYXRhLklEX0RBVEFTVE9SRSk7CgogICAgICAgIGludCBzdHJhdCA9IGdldEdl\nbmVyYXRlZFZhbHVlU3RyYXRlZ3kobWV0YSwgaWQuc3RyYXRlZ3koKSwKICAg\nICAgICAgICAgaWQuZ2VuZXJhdG9yKCkpOwogICAgICAgIGlmIChzdHJhdCAh\nPSAtMSkKICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0cmF0ZWd5KHN0\ncmF0KTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3dpdGNoIChpZC5z\ndHJhdGVneSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAg\nICAgICAgICAgICAgY2FzZSBTRVFVRU5DRToKICAgICAgICAgICAgICAgICAg\nICAvLyB0ZWNobmljYWxseSB3ZSBzaG91bGQgaGF2ZSBzZXBhcmF0ZSBzeXN0\nZW0gdGFibGUgYW5kCiAgICAgICAgICAgICAgICAgICAgLy8gc2VxdWVuY2Ug\nZ2VuZXJhdG9ycywgYnV0IGl0J3MgZWFzaWVyIHRvIGp1c3QgcmVseSBvbgog\nICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzeXN0ZW0gb3JnLmFwYWNoZS5v\ncGVuanBhLlNlcXVlbmNlIHNldHRpbmcgZm9yIGJvdGgKICAgICAgICAgICAg\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShpZC5nZW5lcmF0b3Io\nKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0SWRlbnRpdHlT\nZXF1ZW5jZU5hbWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXF1\nZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVNKTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0SWRlbnRp\ndHlTZXF1ZW5jZU5hbWUoaWQuZ2VuZXJhdG9yKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBVVRPOgogICAg\nICAgICAgICAgICAgICAgIG1ldGEuc2V0SWRlbnRpdHlTdHJhdGVneShWYWx1\nZVN0cmF0ZWdpZXMuTkFUSVZFKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSURFTlRJVFk6CiAgICAgICAgICAg\nICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRl\nZ2llcy5BVVRPQVNTSUdOKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKGlkLnN0cmF0ZWd5KCku\ndG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXYXJuIHRoYXQgQEZsdXNoTW9kZSBpcyBub3Qgc3Vw\ncG9ydGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2FybkZsdXNoTW9k\nZShPYmplY3QgY29udGV4dCkgewogICAgICAgIGlmIChfbG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJ1bnN1\ncHBvcnRlZCIsICJGbHVzaE1vZGUiLCBjb250ZXh0KSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBARGF0YUNhY2hlLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VEYXRhQ2FjaGUoQ2xhc3NNZXRhRGF0YSBtZXRhLCBE\nYXRhQ2FjaGUgY2FjaGUpIHsKICAgICAgICBpZiAoY2FjaGUudGltZW91dCgp\nICE9IEludGVnZXIuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAgIG1ldGEuc2V0\nRGF0YUNhY2hlVGltZW91dChjYWNoZS50aW1lb3V0KCkpOwogICAgICAgIH0K\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoY2FjaGUubmFtZSgp\nKSkgewogICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZU5hbWUoY2FjaGUu\nbmFtZSgpKTsKICAgICAgICAgICAgaWYoY2FjaGUuZW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICBtZXRhLnNldENhY2hlRW5hYmxlZCh0cnVlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChjYWNoZS5l\nbmFibGVkKCkpIHsKICAgICAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVOYW1l\nKG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlLk5BTUVf\nREVGQVVMVCk7CiAgICAgICAgICAgIG1ldGEuc2V0Q2FjaGVFbmFibGVkKHRy\ndWUpOyAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtZXRhLnNldERh\ndGFDYWNoZU5hbWUobnVsbCk7CiAgICAgICAgICAgIG1ldGEuc2V0Q2FjaGVF\nbmFibGVkKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgbWV0YS5zZXRJc0Nh\nY2hlYWJsZShjYWNoZS5lbmFibGVkKCksIHRydWUpOwogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBwYXJzZU1hbmFnZWRJbnRlcmZhY2UoQ2xhc3NNZXRhRGF0\nYSBtZXRhLAogICAgICAgIE1hbmFnZWRJbnRlcmZhY2UgaWZhY2UpIHsKICAg\nICAgICBtZXRhLnNldE1hbmFnZWRJbnRlcmZhY2UodHJ1ZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBARGV0YWNoZWRTdGF0ZS4gVGhlIGFubm90\nYXRpb24gbWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZURldGFjaGVkU3RhdGUoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAg\nIERldGFjaGVkU3RhdGUgZGV0YWNoZWQpIHsKICAgICAgICBpZiAoZGV0YWNo\nZWQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIWRldGFjaGVkLmVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShu\ndWxsKTsKICAgICAgICAgICAgZWxzZSBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShkZXRhY2hlZC5maWVsZE5hbWUoKSkpCiAgICAgICAgICAgICAgICBtZXRh\nLnNldERldGFjaGVkU3RhdGUoQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtZXRhLnNldERldGFj\naGVkU3RhdGUoZGV0YWNoZWQuZmllbGROYW1lKCkpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIEZpZWxkW10gZmllbGRzID0gKEZpZWxkW10pIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRGaWVsZHNBY3Rpb24oCiAgICAg\nICAgICAgICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKTsgCiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgaWYgKChBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgICAg\nIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGZpZWxkc1tpXSwgRGV0YWNo\nZWRTdGF0ZS5jbGFzcykpKQogICAgICAgICAgICAgICAgICAgIC5ib29sZWFu\nVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldERldGFjaGVk\nU3RhdGUoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgQEVudGl0eUxpc3RlbmVycwogICAgICov\nCiAgICBwcml2YXRlIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltd\nIHBhcnNlRW50aXR5TGlzdGVuZXJzCiAgICAgICAgKENsYXNzTWV0YURhdGEg\nbWV0YSwgRW50aXR5TGlzdGVuZXJzIGxpc3RlbmVycykgewogICAgICAgIENs\nYXNzPD8+W10gY2xhc3NlcyA9IGxpc3RlbmVycy52YWx1ZSgpOwogICAgICAg\nIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIHBhcnNlZCA9IG51\nbGw7CiAgICAgICAgZm9yIChDbGFzczw/PiBjbHMgOiBjbGFzc2VzKQogICAg\nICAgICAgICBwYXJzZWQgPSBwYXJzZUNhbGxiYWNrTWV0aG9kcyhjbHMsIHBh\ncnNlZCwgdHJ1ZSwgdHJ1ZSwgCiAgICAgICAgICAgICAgICBnZXRSZXBvc2l0\nb3J5KCkpOwogICAgICAgIHJldHVybiBwYXJzZWQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBjYWxsYmFjayBtZXRob2RzIGludG8gdGhlIGdpdmVu\nIGFycmF5LCBhbmQgcmV0dXJuIHRoYXQgYXJyYXksCiAgICAgKiBjcmVhdGlu\nZyBvbmUgaWYgbnVsbC4gRWFjaCBpbmRleCBpbnRvIHRoZSBhcnJheSBpcyBh\nIGNvbGxlY3Rpb24gb2YKICAgICAqIGNhbGxiYWNrIGFkYXB0ZXJzIGZvciB0\naGF0IG51bWVyaWMgZXZlbnQgdHlwZS4KICAgICAqCiAgICAgKiBAcGFyYW0g\nc3VwcyB3aGV0aGVyIHRvIHNjYW4gc3VwZXJjbGFzc2VzCiAgICAgKiBAcGFy\nYW0gbGlzdGVuZXIgd2hldGhlciB0aGlzIGlzIGEgbGlzdGVuZXIgb3Igbm90\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQ29sbGVjdGlvbjxMaWZlY3lj\nbGVDYWxsYmFja3M+W10gcGFyc2VDYWxsYmFja01ldGhvZHMKICAgICAgICAo\nQ2xhc3M8Pz4gY2xzLCBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5b\nXSBjYWxsYmFja3MsIGJvb2xlYW4gc3VwcywKICAgICAgICBib29sZWFuIGxp\nc3RlbmVyLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKCiAgICAgICAg\naWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uKCJjbHMgY2Fubm90IGJlIG51bGwiKTsKCiAg\nICAgICAgLy8gZmlyc3Qgc29ydCAvIGZpbHRlciBiYXNlZCBvbiBpbmhlcml0\nYW5jZQogICAgICAgIFNldDxNZXRob2Q+IG1ldGhvZHMgPSBuZXcgVHJlZVNl\ndDxNZXRob2Q+KE1ldGhvZENvbXBhcmF0b3IuCiAgICAgICAgICAgIGdldElu\nc3RhbmNlKCkpOwoKICAgICAgICBpbnQgbW9kczsKICAgICAgICBDbGFzczw/\nPiBzdXAgPSBjbHM7CiAgICAgICAgTWV0aG9kS2V5IGtleTsKICAgICAgICBT\nZXQ8TWV0aG9kS2V5PiBzZWVuID0gbmV3IEhhc2hTZXQ8TWV0aG9kS2V5Pigp\nOwogICAgICAgIGRvIHsKICAgICAgICAgICAgZm9yIChNZXRob2QgbSA6IChN\nZXRob2RbXSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZHNB\nY3Rpb24oc3VwKSkpIHsKICAgICAgICAgICAgICAgIG1vZHMgPSBtLmdldE1v\nZGlmaWVycygpOwogICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzU3Rh\ndGljKG1vZHMpIHx8IE1vZGlmaWVyLmlzRmluYWwobW9kcykgfHwKICAgICAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MuZXF1YWxzKG0uZ2V0RGVjbGFy\naW5nQ2xhc3MoKSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICAgICAga2V5ID0gbmV3IE1ldGhvZEtleShtKTsKICAgICAg\nICAgICAgICAgIGlmICghc2Vlbi5jb250YWlucyhrZXkpKSB7CiAgICAgICAg\nICAgICAgICAgICAgbWV0aG9kcy5hZGQobSk7CiAgICAgICAgICAgICAgICAg\nICAgc2Vlbi5hZGQoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBzdXAgPSBzdXAuZ2V0U3VwZXJjbGFzcygpOwog\nICAgICAgIH0gd2hpbGUgKHN1cHMgJiYgIU9iamVjdC5jbGFzcy5lcXVhbHMo\nc3VwKSk7CgogICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBy\nZXBvcy5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgZm9yIChNZXRob2Qg\nbSA6IG1ldGhvZHMpIHsKICAgICAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFu\nbm8gOiAoQW5ub3RhdGlvbltdKSBBY2Nlc3NDb250cm9sbGVyCiAgICAgICAg\nICAgICAgICAuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAg\nICAgICAgICAgICAgLmdldERlY2xhcmVkQW5ub3RhdGlvbnNBY3Rpb24obSkp\nKSB7CiAgICAgICAgICAgICAgICBNZXRhRGF0YVRhZyB0YWcgPSBfdGFncy5n\nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgICAgIGlm\nICh0YWcgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgICAgIGludFtdIGV2ZW50cyA9IE1ldGFEYXRhUGFyc2Vy\ncy5nZXRFdmVudFR5cGVzKHRhZywgY29uZik7CiAgICAgICAgICAgICAgICBp\nZiAoZXZlbnRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CgogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcyA9IChDb2xsZWN0aW9uPExp\nZmVjeWNsZUNhbGxiYWNrcz5bXSkKICAgICAgICAgICAgICAgICAgICAgICAg\nbmV3IENvbGxlY3Rpb25bTGlmZWN5Y2xlRXZlbnQuQUxMX0VWRU5UUy5sZW5n\ndGhdOwoKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXZl\nbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IGUg\nPSBldmVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNr\nc1tlXSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFj\na3NbZV0gPSBuZXcgQXJyYXlMaXN0PExpZmVjeWNsZUNhbGxiYWNrcz4oMyk7\nCiAgICAgICAgICAgICAgICAgICAgTWV0YURhdGFQYXJzZXJzLnZhbGlkYXRl\nTWV0aG9kc0ZvclNhbWVDYWxsYmFjayhjbHMsIAogICAgICAgICAgICAgICAg\nICAgICAgICBjYWxsYmFja3NbZV0sIG0sIHRhZywgY29uZiwgcmVwb3MuZ2V0\nTG9nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewog\nICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbZV0uYWRkKG5ldyBC\nZWFuTGlmZWN5Y2xlQ2FsbGJhY2tzKGNscywgbSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdLmFk\nZChuZXcgTWV0aG9kTGlmZWN5Y2xlQ2FsbGJhY2tzKG0sCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmYWxzZSkpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gY2FsbGJhY2tzOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFN0b3JlIGxpZmVjeWNsZSBtZXRhZGF0YS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHJlY29yZENhbGxiYWNrcyhDbGFzc01ldGFEYXRhIGNs\ncywKICAgICAgICBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBj\nYWxsYmFja3MsIGludFtdIGhpZ2hzLAogICAgICAgIGJvb2xlYW4gc3VwZXJD\nbGFzcykgewogICAgICAgIGlmIChjYWxsYmFja3MgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIExpZmVjeWNsZU1ldGFEYXRhIG1ldGEg\nPSBjbHMuZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKTsKICAgICAgICBMaWZlY3lj\nbGVDYWxsYmFja3NbXSBhcnJheTsKICAgICAgICBmb3IgKGludCBldmVudCA6\nIExpZmVjeWNsZUV2ZW50LkFMTF9FVkVOVFMpIHsKICAgICAgICAgICAgaWYg\nKGNhbGxiYWNrc1tldmVudF0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICBhcnJheSA9IGNhbGxiYWNrc1tldmVudF0u\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBMaWZlY3ljbGVDYWxsYmFj\na3NbY2FsbGJhY2tzW2V2ZW50XS5zaXplKCldKTsKCiAgICAgICAgICAgIGlm\nIChzdXBlckNsYXNzKSB7CiAgICAgICAgICAgICAgICBtZXRhLnNldE5vblBD\nU3VwZXJjbGFzc0NhbGxiYWNrcyhldmVudCwgYXJyYXksCiAgICAgICAgICAg\nICAgICAgICAgKGhpZ2hzID09IG51bGwpID8gMCA6IGhpZ2hzW2V2ZW50XSk7\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZXRhLnNl\ndERlY2xhcmVkQ2FsbGJhY2tzKGV2ZW50LCBhcnJheSwKICAgICAgICAgICAg\nICAgICAgICAoaGlnaHMgPT0gbnVsbCkgPyAwIDogaGlnaHNbZXZlbnRdKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBmZXRjaCBncm91cHMuCiAgICAgKiBJZiBGZXRjaEdyb3VwIEEg\naW5jbHVkZXMgRmV0Y2hHcm91cCBCLCB0aGVuIGEgYmktbGluayBpcyBzZXQg\nYmV0d2VlbgogICAgICogQSBhbmQgQi4gQm90aCBBIGFuZCBCIG11c3QgYmUg\nZGVjbGFyZWQgaW4gdGhlIHNhbWUgQ2xhc3MuIAogICAgICogPGJyPgogICAg\nICogQ2FsbCB7QGxpbmsgI3BhcnNlRmV0Y2hBdHRyaWJ1dGUoQ2xhc3NNZXRh\nRGF0YSwgCiAgICAgKiBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdy\nb3VwLCBGZXRjaEF0dHJpYnV0ZSkgb25seSBhZnRlciB0aGUKICAgICAqIGJp\nLWxpbmtzIGhhdmUgYmVlbiBlc3RhYmxpc2hlZCwgYmVjYXVzZSBhIGZpZWxk\nIGYgd2lsbCBub3Qgb25seSBhZGQgdGhlCiAgICAgKiBmZXRjaCBncm91cCBB\nIHdoaWNoIGV4cGxpY3RseSBpbmNsdWRlcyBmIHRvIGl0cyBjdXN0b20gZmV0\nY2ggZ3JvdXBzIGJ1dCAKICAgICAqIGFsc28gd2lsbCBhbHNvIGFkZCBhbnkg\nZmV0Y2ggZ3JvdXAgQiB0aGF0IGluY2x1ZGVzIEEuICAKICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlRmV0Y2hHcm91cHMoQ2xhc3NNZXRhRGF0YSBt\nZXRhLCBGZXRjaEdyb3VwLi4uIGdyb3VwcykgewogICAgICAgIG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXAgZmc7CiAgICAgICAgZm9yIChG\nZXRjaEdyb3VwIGdyb3VwIDogZ3JvdXBzKSB7CiAgICAgICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KGdyb3VwLm5hbWUoKSkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVu\nbmFtZWQtZmciLCBtZXRhKSk7CgogICAgICAgICAgICBmZyA9IG1ldGEuYWRk\nRGVjbGFyZWRGZXRjaEdyb3VwKGdyb3VwLm5hbWUoKSk7CiAgICAgICAgICAg\nIGlmIChncm91cC5wb3N0TG9hZCgpKQogICAgICAgICAgICAgICAgZmcuc2V0\nUG9zdExvYWQodHJ1ZSk7IAogICAgICAgICAgICBmb3IgKFN0cmluZyBzIDog\nZ3JvdXAuZmV0Y2hHcm91cHMoKSkgewogICAgICAgICAgICAgICAgZmcuYWRk\nRGVjbGFyZWRJbmNsdWRlKHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIC8vIEFkZCB0aGUgcGFyZW50LWNoaWxkIHN0eWxlIGJpLWxpbmtz\nIGJldHdlZW4gZmV0Y2ggZ3JvdXBzIGluIGEgCiAgICAgICAgLy8gc2VwYXJh\ndGUgcGFzcy4gCiAgICAgICAgZm9yIChGZXRjaEdyb3VwIGdyb3VwOmdyb3Vw\ncykgewogICAgICAgIAlmZyA9IG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cC5u\nYW1lKCkpOwogICAgICAgIAlTdHJpbmdbXSBpbmNsdWRlZEZldGNoR3JvcE5h\nbWVzID0gZmcuZ2V0RGVjbGFyZWRJbmNsdWRlcygpOwogICAgICAgIAlmb3Ig\nKFN0cmluZyBpbmNsdWRlZEZlY3RjaEdyb3VwTmFtZTppbmNsdWRlZEZldGNo\nR3JvcE5hbWVzKSB7CiAgICAgICAgCQlvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5GZXRjaEdyb3VwIGNoaWxkID0KICAgICAgICAJICAgIG1ldGEuZ2V0RmV0\nY2hHcm91cChpbmNsdWRlZEZlY3RjaEdyb3VwTmFtZSk7CiAgICAgICAgCQlp\nZiAoY2hpbGQgPT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1pc3NpbmctaW5jbHVkZWQt\nZmciLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLmdldE5hbWUoKSwgZmcuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZWRGZWN0Y2hHcm91cE5hbWUp\nKTsKICAgICAgICAJCWNoaWxkLmFkZENvbnRhaW5lZEJ5KGZnKTsKICAgICAg\nICAJfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgKEZldGNoR3Jv\ndXAgZ3JvdXAgOiBncm91cHMpIHsKICAgICAgICAgICAgZmcgPSBtZXRhLmdl\ndEZldGNoR3JvdXAoZ3JvdXAubmFtZSgpKTsKICAgICAgICAgICAgZm9yIChG\nZXRjaEF0dHJpYnV0ZSBhdHRyIDogZ3JvdXAuYXR0cmlidXRlcygpKQogICAg\nICAgICAgICAgICAgcGFyc2VGZXRjaEF0dHJpYnV0ZShtZXRhLCBmZywgYXR0\ncik7CiAgICAgICAgfQogICAgfQogICAgCgogICAgLyoqCiAgICAgKiBTZXQg\nYSBmaWVsZCdzIGZldGNoIGdyb3VwLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VGZXRjaEF0dHJpYnV0ZShDbGFzc01ldGFEYXRhIG1ldGEsIAog\nICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXAgZmcs\nIEZldGNoQXR0cmlidXRlIGF0dHIpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZpZWxkID0gbWV0YS5nZXREZWNsYXJlZEZpZWxkKGF0dHIubmFtZSgpKTsK\nICAgICAgICBpZiAoZmllbGQgPT0gbnVsbAogICAgICAgICAgICB8fCBmaWVs\nZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVS\nU0lTVEVOVCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtZmctZmllbGQiLCBmZy5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICBtZXRhLCBhdHRyLm5hbWUoKSkpOwoKICAgICAgICBm\naWVsZC5zZXRJbkZldGNoR3JvdXAoZmcuZ2V0TmFtZSgpLCB0cnVlKTsKICAg\nICAgICBTZXQ8U3RyaW5nPiBwYXJlbnRGZXRjaEdyb3VwcyA9IGZnLmdldENv\nbnRhaW5lZEJ5KCk7CiAgICAgICAgZm9yIChPYmplY3QgcGFyZW50RmV0Y2hH\ncm91cCA6IHBhcmVudEZldGNoR3JvdXBzKQogICAgICAgIAlmaWVsZC5zZXRJ\nbkZldGNoR3JvdXAocGFyZW50RmV0Y2hHcm91cC50b1N0cmluZygpLCB0cnVl\nKTsKICAgICAgICBpZiAoYXR0ci5yZWN1cnNpb25EZXB0aCgpICE9IEludGVn\nZXIuTUlOX1ZBTFVFKQogICAgICAgICAgICBmZy5zZXRSZWN1cnNpb25EZXB0\naChmaWVsZCwgYXR0ci5yZWN1cnNpb25EZXB0aCgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlYWQgYW5ub3RhdGlvbnMgZm9yIHRoZSBnaXZlbiBtZW1i\nZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1lbWJlckFubm90\nYXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgLy8gbG9vayBm\nb3IgcGVyc2lzdGVuY2Ugc3RyYXRlZ3kgaW4gYW5ub3RhdGlvbiB0YWJsZQog\nICAgICAgIE1lbWJlciBtZW1iZXIgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0TWV0\nYURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS4KICAgICAgICAgICAgZ2V0\nQmFja2luZ01lbWJlcihmbWQpOwogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRl\nZ3kgcHN0cmF0ID0gUGVyc2lzdGVuY2VNZXRhRGF0YURlZmF1bHRzLgogICAg\nICAgICAgICBnZXRQZXJzaXN0ZW5jZVN0cmF0ZWd5KGZtZCwgbWVtYmVyKTsK\nICAgICAgICBpZiAocHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICBmbWQuc2V0RXhwbGljaXQodHJ1ZSk7CgogICAgICAgIEFu\nbm90YXRlZEVsZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxlbWVudCkgbWVtYmVy\nOwogICAgICAgIGJvb2xlYW4gbG9iID0gKEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgIC5pc0Fubm90\nYXRpb25QcmVzZW50QWN0aW9uKGVsLCBMb2IuY2xhc3MpKSkuYm9vbGVhblZh\nbHVlKCk7CiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpIHsKICAgICAg\nICAgICAgc3dpdGNoIChwc3RyYXQpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nQkFTSUM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VCYXNpYyhmbWQsIChC\nYXNpYykgZWwuZ2V0QW5ub3RhdGlvbihCYXNpYy5jbGFzcyksIGxvYik7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIE1BTllfT05FOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFueVRvT25l\nKGZtZCwgKE1hbnlUb09uZSkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAg\nICAgICAgICAgICAgICAoTWFueVRvT25lLmNsYXNzKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9ORV9PTkU6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VPbmVUb09uZShmbWQsIChPbmVU\nb09uZSkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAg\nICAoT25lVG9PbmUuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgRU1CRURERUQ6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VFbWJlZGRlZChmbWQsIChFbWJlZGRlZCkgZWwuZ2V0\nQW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAoRW1iZWRkZWQu\nY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgT05FX01BTlk6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VPbmVUb01hbnkoZm1kLCAoT25lVG9NYW55KSBlbC5nZXRBbm5vdGF0aW9u\nCiAgICAgICAgICAgICAgICAgICAgICAgIChPbmVUb01hbnkuY2xhc3MpKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFueVRv\nTWFueShmbWQsIChNYW55VG9NYW55KSBlbC5nZXRBbm5vdGF0aW9uCiAgICAg\nICAgICAgICAgICAgICAgICAgIChNYW55VG9NYW55LmNsYXNzKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBF\nUlM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJzaXN0ZW50KGZtZCwg\nKFBlcnNpc3RlbnQpIGVsLmdldEFubm90YXRpb24KICAgICAgICAgICAgICAg\nICAgICAgICAgKFBlcnNpc3RlbnQuY2xhc3MpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVSU19DT0xMOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlUGVyc2lzdGVudENvbGxlY3Rpb24o\nZm1kLCAoUGVyc2lzdGVudENvbGxlY3Rpb24pCiAgICAgICAgICAgICAgICAg\nICAgICAgIGVsLmdldEFubm90YXRpb24oUGVyc2lzdGVudENvbGxlY3Rpb24u\nY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgRUxFTV9DT0xMOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlRWxlbWVudENvbGxlY3Rpb24oZm1kLCAoRWxlbWVudENvbGxlY3Rpb24p\nCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRpb24oRWxl\nbWVudENvbGxlY3Rpb24uY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVSU19NQVA6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VQZXJzaXN0ZW50TWFwKGZtZCwgKFBlcnNpc3Rl\nbnRNYXApCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRp\nb24oUGVyc2lzdGVudE1hcC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUUkFOU0lFTlQ6CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\naXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgbG9iKQogICAgICAgICAgICBw\nYXJzZUxvYk1hcHBpbmcoZm1kKTsKCiAgICAgICAgLy8gZXh0ZW5zaW9ucwog\nICAgICAgIE1ldGFEYXRhVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90YXRp\nb24gYW5ubyA6IGVsLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAg\nICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgp\nKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBoYW5kbGVVbmtub3duTWVtYmVyQW5ub3RhdGlvbihmbWQsIGFubm8p\nOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICBjYXNl\nIEFDQ0VTUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUFjY2VzcyhmbWQs\nIChBY2Nlc3MpYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHdhcm5GbHVzaE1vZGUoZm1kKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgR0VORVJBVEVEX1ZBTFVF\nOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VHZW5lcmF0ZWRW\nYWx1ZShmbWQsIChHZW5lcmF0ZWRWYWx1ZSkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElEOgogICAg\nICAgICAgICAgICAgY2FzZSBFTUJFRERFRF9JRDoKICAgICAgICAgICAgICAg\nICAgICBmbWQuc2V0UHJpbWFyeUtleSh0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQUEVEX0JZX0lE\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwcGVkQnlJZChmbWQsIChN\nYXBwZWRCeUlkKWFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBNQVBfS0VZOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgcGFyc2VNYXBLZXkoZm1kLCAoTWFwS2V5KSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgTUFQX0tFWV9DTEFTUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBhcnNlTWFwS2V5Q2xhc3MoZm1kLCAoTWFwS2V5Q2xhc3MpIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBPUkRFUl9CWToKICAgICAgICAgICAgICAgICAgICBwYXJzZU9yZGVyQnko\nZm1kLAogICAgICAgICAgICAgICAgICAgICAgICAoT3JkZXJCeSkgZWwuZ2V0\nQW5ub3RhdGlvbihPcmRlckJ5LmNsYXNzKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNFUV9HRU5FUkFUT1I6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZVNlcXVlbmNlR2Vu\nZXJhdG9yKGVsLCAoU2VxdWVuY2VHZW5lcmF0b3IpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBWRVJT\nSU9OOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRWZXJzaW9uKHRydWUp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBERVBFTkRFTlQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkgJiYgKChEZXBlbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRDYXNjYWRlRGVsZXRlKFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9ERVBFTkRFTlQ6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkgJiYg\nKChFbGVtZW50RGVwZW5kZW50KSBhbm5vKS52YWx1ZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldENhc2NhZGVEZWxl\ndGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfQVVUTyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEVMRU1fVFlQRToKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRUeXBlT3ZlcnJpZGUodG9PdmVy\ncmlkZVR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoKEVsZW1l\nbnRUeXBlKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYVEVSTkFMX1ZBTFM6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZtZC5zZXRFeHRlcm5hbFZhbHVlcyhTdHJp\nbmdzLmpvaW4oKChFeHRlcm5hbFZhbHVlcykKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGFubm8pLnZhbHVlKCksICIsIikpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWFRFUk5BTEla\nRVI6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRFeHRlcm5hbGl6ZXIo\nKChFeHRlcm5hbGl6ZXIpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGQUNUT1JZOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RmFjdG9yeSgoKEZhY3Rvcnkp\nIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBJTlZFUlNFX0xPR0lDQUw6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZtZC5zZXRJbnZlcnNlKCgoSW52ZXJzZUxvZ2ljYWwp\nIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBLRVlfREVQRU5ERU5UOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpICYmICgoS2V5RGVwZW5k\nZW50KSBhbm5vKS52YWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBm\nbWQuZ2V0S2V5KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRD\nYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nS0VZX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5z\nZXRUeXBlT3ZlcnJpZGUodG9PdmVycmlkZVR5cGUoKChLZXlUeXBlKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgYW5ubykudmFsdWUoKSkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBM\nT0FEX0ZFVENIX0dST1VQOgogICAgICAgICAgICAgICAgCWlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0TG9h\nZEZldGNoR3JvdXAoKChMb2FkRmV0Y2hHcm91cCkgYW5ubykudmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAJYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIExSUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldExSUygoKExSUykg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFJFQURfT05MWToKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgcGFyc2VSZWFkT25seShmbWQsIChSZWFkT25seSkgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFRZUEU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2Rl\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRUeXBlT3ZlcnJp\nZGUodG9PdmVycmlkZVR5cGUoKChUeXBlKSBhbm5vKS4KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHZhbHVlKCkpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ1bnN1cHBvcnRlZCIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAg\nICAgYW5uby50b1N0cmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBtZW1iZXIgbWFwcGluZyBj\nb21wb25lbnRzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZU1l\nbWJlck1hcHBpbmdBbm5vdGF0aW9ucyhGaWVsZE1ldGFEYXRhIGZtZCkgewog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFBhcnNlIEBDYWNoZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlQ2FjaGUoQ2xhc3NNZXRhRGF0YSBt\nZXRhLCBDYWNoZWFibGUgY2FjaGVhYmxlKSB7CiAgICAgICAgbWV0YS5zZXRD\nYWNoZUVuYWJsZWQoY2FjaGVhYmxlLnZhbHVlKCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93biBh\nbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFu\nZGxlVW5rbm93bk1lbWJlckFubm90YXRpb24oRmllbGRNZXRhRGF0YSBmbWQs\nCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgZ2l2ZW4g\nY2xhc3MgdG8gaXRzIE9wZW5KUEEgdHlwZSBvdmVycmlkZSBlcXVpdmFsZW50\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzczw/PiB0b092ZXJy\naWRlVHlwZShDbGFzczw/PiBjbHMpIHsKICAgICAgICByZXR1cm4gKGNscyA9\nPSBFbnRpdHkuY2xhc3MpCiAgICAgICAgICAgID8gb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzIDogY2xzOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFJlYWRPbmx5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VSZWFkT25seShGaWVsZE1ldGFEYXRh\nIGZtZCwgUmVhZE9ubHkgcm8pIHsKICAgICAgICBpZiAocm8udmFsdWUoKSA9\nPSBVcGRhdGVBY3Rpb24uUkVTVFJJQ1QpCiAgICAgICAgICAgIGZtZC5zZXRV\ncGRhdGVTdHJhdGVneShVcGRhdGVTdHJhdGVnaWVzLlJFU1RSSUNUKTsKICAg\nICAgICBlbHNlIGlmIChyby52YWx1ZSgpID09IFVwZGF0ZUFjdGlvbi5JR05P\nUkUpCiAgICAgICAgICAgIGZtZC5zZXRVcGRhdGVTdHJhdGVneShVcGRhdGVT\ndHJhdGVnaWVzLklHTk9SRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3Ig\ndGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VHZW5lcmF0ZWRWYWx1ZShGaWVsZE1ldGFEYXRhIGZtZCwgR2VuZXJhdGVk\nVmFsdWUgZ2VuKSB7CiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3kg\nPSBnZW4uc3RyYXRlZ3koKTsKICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yID0g\nZ2VuLmdlbmVyYXRvcigpOwogICAgICAgIHBhcnNlR2VuZXJhdGVkVmFsdWUo\nZm1kLCBzdHJhdGVneSwgZ2VuZXJhdG9yKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhl\nIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBzdGF0aWMgdm9pZCBwYXJzZUdl\nbmVyYXRlZFZhbHVlKEZpZWxkTWV0YURhdGEgZm1kLCBHZW5lcmF0aW9uVHlw\nZSBzdHJhdGVneSwKICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yKSB7CiAgICAg\nICAgaW50IHN0cmF0ID0gZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShmbWQs\nIHN0cmF0ZWd5LCBnZW5lcmF0b3IpOwogICAgICAgIGlmIChzdHJhdCAhPSAt\nMSkKICAgICAgICAgICAgZm1kLnNldFZhbHVlU3RyYXRlZ3koc3RyYXQpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7\nCiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAg\nY2FzZSBTRVFVRU5DRToKICAgICAgICAgICAgICAgICAgICAvLyB0ZWNobmlj\nYWxseSB3ZSBzaG91bGQgaGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5k\nCiAgICAgICAgICAgICAgICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywg\nYnV0IGl0J3MgZWFzaWVyIHRvIGp1c3QgcmVseSBvbgogICAgICAgICAgICAg\nICAgICAgIC8vIHRoZSBzeXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVl\nbmNlIHNldHRpbmcgZm9yIGJvdGgKICAgICAgICAgICAgICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuaXNFbXB0eShnZW5lcmF0b3IpKQogICAgICAgICAgICAg\nICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VN\nZXRhRGF0YS5OQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5j\nZU5hbWUoZ2VuZXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgQVVUTzoKICAgICAgICAgICAgICAgICAg\nICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5O\nQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIElERU5USVRZOgogICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRWYWx1ZVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNT\nSUdOKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKHN0cmF0ZWd5LnRvU3RyaW5nKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSB2YWx1ZSBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGdlbmVyYXRv\nciwgb3IgLTEgaWYgdGhlCiAgICAgKiBzdHJhdGVneSBkZXBlbmRzIG9uIHRo\nZSA8Y29kZT5HZW5lcmF0aW9uVHlwZTwvY29kZT4gcmF0aGVyIHRoYW4gdGhl\nCiAgICAgKiBnZW5lcmF0b3IgbmFtZS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgaW50IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3koT2JqZWN0IGNv\nbnRleHQsCiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3ksIFN0cmlu\nZyBnZW5lcmF0b3IpIHsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gQVVUTyB8\nfCBTdHJpbmdVdGlscy5pc0VtcHR5KGdlbmVyYXRvcikpCiAgICAgICAgICAg\nIHJldHVybiAtMTsKCiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX0hFWC5l\ncXVhbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3Ry\nYXRlZ2llcy5VVUlEX0hFWDsKICAgICAgICBpZiAoR2VuZXJhdG9yLlVVSURf\nU1RSSU5HLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1cm4g\nVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RSSU5HOwogICAgICAgIGlmIChHZW5l\ncmF0b3IuVVVJRF9UWVBFNF9IRVguZXF1YWxzKGdlbmVyYXRvcikpCiAgICAg\nICAgICAgIHJldHVybiBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9UWVBFNF9IRVg7\nCiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX1RZUEU0X1NUUklORy5lcXVh\nbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3RyYXRl\nZ2llcy5VVUlEX1RZUEU0X1NUUklORzsKICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImdlbmVyYXRvci1iYWQtc3RyYXRl\nZ3kiLAogICAgICAgICAgICBjb250ZXh0LCBnZW5lcmF0b3IpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIEBCYXNpYy4gR2l2ZW4gYW5ub3RhdGlv\nbiBtYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nQmFzaWMoRmllbGRNZXRhRGF0YSBmbWQsIEJhc2ljIGFubm8sIGJvb2xlYW4g\nbG9iKSB7CiAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IGZtZC5nZXREZWNsYXJl\nZFR5cGUoKTsKICAgICAgICBpZiAobG9iICYmIHR5cGUgIT0gU3RyaW5nLmNs\nYXNzCiAgICAgICAgICAgICYmIHR5cGUgIT0gY2hhcltdLmNsYXNzICYmIHR5\ncGUgIT0gQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgJiYgdHlwZSAh\nPSBieXRlW10uY2xhc3MgJiYgdHlwZSAhPSBCeXRlW10uY2xhc3MpCiAgICAg\nICAgICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAgIGVsc2Ug\naWYgKCFsb2IpIHsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgaWYgKEVudW0uY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBubyBicmVh\nawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgICAgICBp\nZiAoU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRTZXJpYWxpemVkKHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZCwgIkJhc2ljIikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHR5cGUgPT0gY2hhcltdLmNsYXNzIHx8IHR5cGUg\nPT0gQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAg\nfHwgdHlwZSA9PSBieXRlW10uY2xhc3MgfHwgdHlwZSA9PSBCeXRlW10uY2xh\nc3MpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgIGlmIChTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxl\nRnJvbQogICAgICAgICAgICAgICAgICAgICAgICAodHlwZS5nZXRDb21wb25l\nbnRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0U2Vy\naWFsaXplZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmbWQsICJCYXNpYyIpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKGFubm8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZt\nZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRj\naFR5cGUuRUFHRVIpOwogICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQog\nICAgICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVM\nTF9FWENFUFRJT04pOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1h\nbnlUb09uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRv\nT25lKEZpZWxkTWV0YURhdGEgZm1kLCBNYW55VG9PbmUgYW5ubykgewogICAg\nICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiTWFu\neVRvT25lIikpOwoKICAgICAgICAvLyBkb24ndCBzcGVjaWZpY2FsbHkgZXhj\nbHVkZSByZWxhdGlvbiBmcm9tIERGRyBiL2MgdGhhdCB3aWxsIHByZXZlbnQK\nICAgICAgICAvLyB1cyBmcm9tIGV2ZW4gcmVhZGluZyB0aGUgZmsgd2hlbiBy\nZWFkaW5nIGZyb20gdGhlIHByaW1hcnkgdGFibGUsCiAgICAgICAgLy8gd2hp\nY2ggaXMgbm90IHdoYXQgbW9zdCB1c2VycyB3aWxsIHdhbnQKICAgICAgICBp\nZiAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUikKICAgICAgICAg\nICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAgICAg\naWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAgIGZtZC5zZXROdWxs\nVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7CiAgICAgICAg\naWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykKICAgICAg\nICAgICAgZm1kLnNldFR5cGVPdmVycmlkZShhbm5vLnRhcmdldEVudGl0eSgp\nKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2FkZSgpKTsK\nICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0YURhdGEu\nTUFOWV9UT19PTkUpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9u\nZVRvT25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPbmVUb09u\nZShGaWVsZE1ldGFEYXRhIGZtZCwgT25lVG9PbmUgYW5ubykgewogICAgICAg\nIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiT25lVG9P\nbmUiKSk7CgogICAgICAgIC8vIGRvbid0IHNwZWNpZmljYWxseSBleGNsdWRl\nIHJlbGF0aW9uIGZyb20gREZHIGIvYyB0aGF0IHdpbGwgcHJldmVudAogICAg\nICAgIC8vIHVzIGZyb20gZXZlbiByZWFkaW5nIHRoZSBmayB3aGVuIHJlYWRp\nbmcgZnJvbSB0aGUgcHJpbWFyeSB0YWJsZSwKICAgICAgICAvLyB3aGljaCBp\ncyBub3Qgd2hhdCBtb3N0IHVzZXJzIHdpbGwgd2FudAogICAgICAgIGlmIChh\nbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKQogICAgICAgICAgICBm\nbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAgICBpZiAo\nIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAgZm1kLnNldE51bGxWYWx1\nZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9OKTsKCiAgICAgICAgaWYg\nKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYmICFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBw\nZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGlmIChhbm5vLnRhcmdl\ndEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5zZXRU\neXBlT3ZlcnJpZGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0\nQ2FzY2FkZXMoZm1kLCBhbm5vLmNhc2NhZGUoKSk7CiAgICAgICAgc2V0T3Jw\naGFuUmVtb3ZhbChmbWQsIGFubm8ub3JwaGFuUmVtb3ZhbCgpKTsKICAgICAg\nICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0YURhdGEuT05FX1RP\nX09ORSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARW1iZWRkZWQu\nIEdpdmVuIGFubm90YXRpb24gbWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZUVtYmVkZGVkKEZpZWxkTWV0YURhdGEgZm1kLCBF\nbWJlZGRlZCBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwK\nICAgICAgICAgICAgICAgICJFbWJlZGRlZCIpKTsKCiAgICAgICAgZm1kLnNl\ndEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAgICAgZm1kLnNldEVt\nYmVkZGVkKHRydWUpOwogICAgICAgIAogICAgICAgIGlmIChmbWQuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgIGZtZC5hZGRF\nbWJlZGRlZE1ldGFEYXRhKGdldEFjY2Vzc0NvZGUoZm1kLmdldERlY2xhcmVk\nVHlwZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAT25lVG9N\nYW55LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPbmVUb01hbnko\nRmllbGRNZXRhRGF0YSBmbWQsIE9uZVRvTWFueSBhbm5vKSB7CiAgICAgICAg\nc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5NQVA6CiAgICAgICAgICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJlUEMo\nZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAg\nICAgICAgICAgICJPbmVUb01hbnkiKSk7CiAgICAgICAgfQoKICAgICAgICBm\nbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0\nY2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVN\nb2RlKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgp\nKSkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnko\nKSk7CiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5j\nbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNsYXJl\nZFR5cGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2FzY2Fk\nZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5jYXNjYWRlKCkpOwogICAgICAg\nIHNldE9ycGhhblJlbW92YWwoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5vcnBo\nYW5SZW1vdmFsKCkpOwogICAgICAgIGZtZC5zZXRBc3NvY2lhdGlvblR5cGUo\nRmllbGRNZXRhRGF0YS5PTkVfVE9fTUFOWSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQYXJzZSBATWFueVRvTWFueS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHBhcnNlTWFueVRvTWFueShGaWVsZE1ldGFEYXRhIGZtZCwgTWFueVRv\nTWFueSBhbm5vKSB7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZ\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBp\nZiAoSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1lbnQoKSkpCiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyBubyBi\ncmVhawogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1h\nbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJPbmVUb01hbnkiKSk7\nCiAgICAgICAgfQoKICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91\ncChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBp\nZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAgZm1kLnNldE1h\ncHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAgaWYgKGFubm8udGFy\nZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdl\ndEVsZW1lbnQoKS5zZXREZWNsYXJlZFR5cGUoYW5uby50YXJnZXRFbnRpdHko\nKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5u\nby5jYXNjYWRlKCkpOwogICAgICAgIGZtZC5zZXRBc3NvY2lhdGlvblR5cGUo\nRmllbGRNZXRhRGF0YS5NQU5ZX1RPX01BTlkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgQE1hcEtleS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlTWFwS2V5KEZpZWxkTWV0YURhdGEgZm1kLCBNYXBLZXkgYW5ubykg\newogICAgICAgIFN0cmluZyBuYW1lID0gYW5uby5uYW1lKCk7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGZt\nZC5nZXRLZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KFZhbHVlTWV0YURhdGEuTUFQ\nUEVEX0JZX1BLKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZtZC5nZXRL\nZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KG5hbWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgQE1hcEtleUNsYXNzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VNYXBLZXlDbGFzcyhGaWVsZE1ldGFEYXRhIGZtZCwgTWFw\nS2V5Q2xhc3MgYW5ubykgewogICAgICAgIGlmIChhbm5vLnZhbHVlKCkgIT0g\ndm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEtleSgpLnNldERlY2xh\ncmVkVHlwZShhbm5vLnZhbHVlKCkpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigKICAgICAg\nICAgICAgICAgICAiVGhlIHZhbHVlIG9mIHRoZSBNYXBDbGFzc0NsYXNzIGNh\nbm5vdCBiZSBudWxsIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBA\nTWFwcGVkQnlJZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFw\ncGVkQnlJZChGaWVsZE1ldGFEYXRhIGZtZCwgTWFwcGVkQnlJZCBhbm5vKSB7\nCiAgICAgICAgU3RyaW5nIHZhbHVlID0gYW5uby52YWx1ZSgpOwogICAgICAg\nIGlmICh2YWx1ZSAhPSBudWxsKQogICAgICAgICAgICBmbWQuc2V0TWFwcGVk\nQnlJZFZhbHVlKHZhbHVlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZt\nZC5zZXRNYXBwZWRCeUlkVmFsdWUoIiIpOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFNldHVwIHRoZSBmaWVsZCBhcyBhIExPQiBtYXBwaW5nLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUxvYk1hcHBpbmcoRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBP\ncmRlckJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPcmRlckJ5\nKEZpZWxkTWV0YURhdGEgZm1kLCBPcmRlckJ5IGFubm8pIHsKICAgICAgICBT\ndHJpbmcgZGVjID0gYW5uby52YWx1ZSgpOwogICAgICAgIGlmIChmbWQuaXNF\nbGVtZW50Q29sbGVjdGlvbigpICYmCiAgICAgICAgICAgIGZtZC5nZXRFbGVt\nZW50KCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGlmIChkZWMubGVuZ3RoKCkgPT0gMCB8fCBkZWMuZXF1YWxz\nKCJBU0MiKSB8fAogICAgICAgICAgICAgICAgICAgIGRlYy5lcXVhbHMoIkRF\nU0MiKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICJp\nbnZhbGlkLW9yZGVyQnkiLCBmbWQpKTsgCiAgICAgICAgfQogICAgICAgIGlm\nIChkZWMubGVuZ3RoKCkgPT0gMCB8fCBkZWMuZXF1YWxzKCJBU0MiKSkKICAg\nICAgICAgICAgZGVjID0gT3JkZXIuRUxFTUVOVCArICIgYXNjIjsKICAgICAg\nICBlbHNlIGlmIChkZWMuZXF1YWxzKCJERVNDIikpCiAgICAgICAgICAgIGRl\nYyA9IE9yZGVyLkVMRU1FTlQgKyAiIGRlc2MiOwogICAgICAgICAgICAKICAg\nICAgICBmbWQuc2V0T3JkZXJEZWNsYXJhdGlvbihkZWMpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgQFBlcnNpc3RlbnQuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZVBlcnNpc3RlbnQoRmllbGRNZXRhRGF0YSBmbWQs\nIFBlcnNpc3RlbnQgYW5ubykgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5BUlJBWToKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgfHwg\nZm1kLmdldERlY2xhcmVkVHlwZSgpID09IEJ5dGVbXS5jbGFzcwogICAgICAg\nICAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBjaGFy\nW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFy\nZWRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpCiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8i\nLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnQiKSk7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5u\nby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFu\nbm8ubWFwcGVkQnkoKSk7CiAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNo\nR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAg\nICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAgIGZtZC5zZXRO\ndWxsVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7CiAgICAg\nICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNhc2NhZGUoKSk7CiAgICAgICAg\naWYgKGFubm8uZW1iZWRkZWQoKSkgewogICAgICAgICAgICBpZiAoIUphdmFU\neXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1l\ndGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVu\ndChlbWJlZGRlZD10cnVlKSIpKTsKICAgICAgICAgICAgZm1kLnNldEVtYmVk\nZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1kLmdldEVtYmVkZGVkTWV0\nYURhdGEoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBmbWQuYWRkRW1i\nZWRkZWRNZXRhRGF0YShnZXRBY2Nlc3NDb2RlKGZtZC5nZXREZWNsYXJlZFR5\ncGUoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgQFBlcnNpc3RlbnRDb2xsZWN0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQZXJzaXN0ZW50Q29sbGVjdGlvbihG\naWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBQZXJzaXN0ZW50Q29sbGVjdGlv\nbiBhbm5vKSB7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLkFSUkFZCiAgICAgICAgICAgICYmIGZtZC5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLkNPTExFQ1RJT04pCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJQZXJz\naXN0ZW50Q29sbGVjdGlvbiIpKTsKCiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5z\nZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGZtZC5zZXRJ\nbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUu\nRUFHRVIpOwogICAgICAgIGlmIChhbm5vLmVsZW1lbnRUeXBlKCkgIT0gdm9p\nZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNs\nYXJlZFR5cGUoYW5uby5lbGVtZW50VHlwZSgpKTsKICAgICAgICBzZXRDYXNj\nYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5vLmVsZW1lbnRDYXNjYWRlKCkp\nOwogICAgICAgIGlmIChhbm5vLmVsZW1lbnRFbWJlZGRlZCgpKSB7CiAgICAg\nICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1lbnQo\nKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAg\nICAgICAgICAgIlBlcnNpc3RlbnRDb2xsZWN0aW9uKGVtYmVkZGVkRWxlbWVu\ndD10cnVlKSIpKTsKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRF\nbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50\nKCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGZtZC5nZXRFbGVtZW50KCkuYWRkRW1iZWRkZWRNZXRhRGF0YSgK\nICAgICAgICAgICAgICAgICAgICBnZXRBY2Nlc3NDb2RlKGZtZC5nZXRFbGVt\nZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBFbGVtZW50Q29s\nbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRWxlbWVu\ndENvbGxlY3Rpb24oRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgRWxlbWVu\ndENvbGxlY3Rpb24gYW5ubykgewogICAgICAgIC8vIFRPRE86IHRocm93IGV4\nY2VwdGlvbiBpZiB0aGUgcnVudGltZSBlbnYgaXMgT3BlbkpwYSAxLngKICAg\nICAgICAgICAgCiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLkNPTExFQ1RJT04gJiYKICAgICAgICAgICAgZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuTUFQKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiRWxlbWVu\ndENvbGxlY3Rpb24iKSk7CgogICAgICAgIGlmIChhbm5vLnRhcmdldENsYXNz\nKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXREZWNsYXJlZFR5cGUoYW5uby50YXJnZXRDbGFzcygpKTsKICAgICAg\nICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0g\nRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBmbWQuc2V0RWxlbWVudENvbGxl\nY3Rpb24odHJ1ZSk7CiAgICAgICAgVmFsdWVNZXRhRGF0YSBlbGVtID0gZm1k\nLmdldEVsZW1lbnQoKTsKICAgICAgICBib29sZWFuIGlzRW51bSA9IGVsZW0u\nZ2V0RGVjbGFyZWRUeXBlKCkuaXNFbnVtKCk7CiAgICAgICAgaWYgKCFpc0Vu\ndW0gJiYgSmF2YVR5cGVzLm1heWJlUEMoZWxlbSkpIHsKICAgICAgICAgICAg\nZWxlbS5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGVsZW0u\nZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgICAg\nICBlbGVtLmFkZEVtYmVkZGVkTWV0YURhdGEoZ2V0QWNjZXNzQ29kZShlbGVt\nLmdldERlY2xhcmVkVHlwZSgpKSk7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFBhcnNlIEBQZXJzaXN0ZW50TWFwLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VQZXJzaXN0ZW50TWFwKEZpZWxkTWV0YURh\ndGEgZm1kLCBQZXJzaXN0ZW50TWFwIGFubm8pIHsKICAgICAgICBpZiAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuTUFQKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiUGVyc2lz\ndGVudE1hcCIpKTsKCiAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3Jv\ndXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAg\naWYgKGFubm8ua2V5VHlwZSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAg\nIGZtZC5nZXRLZXkoKS5zZXREZWNsYXJlZFR5cGUoYW5uby5rZXlUeXBlKCkp\nOwogICAgICAgIGlmIChhbm5vLmVsZW1lbnRUeXBlKCkgIT0gdm9pZC5jbGFz\ncykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNsYXJlZFR5\ncGUoYW5uby5lbGVtZW50VHlwZSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhm\nbWQuZ2V0S2V5KCksIGFubm8ua2V5Q2FzY2FkZSgpKTsKICAgICAgICBzZXRD\nYXNjYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5vLmVsZW1lbnRDYXNjYWRl\nKCkpOwogICAgICAgIGlmIChhbm5vLmtleUVtYmVkZGVkKCkpIHsKICAgICAg\nICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0S2V5KCkpKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAg\nICAgICJQZXJzaXN0ZW50TWFwKGVtYmVkZGVkS2V5PXRydWUpIikpOwogICAg\nICAgICAgICBmbWQuZ2V0S2V5KCkuc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAg\nICAgICAgIGlmIChmbWQuZ2V0S2V5KCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgp\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5hZGRF\nbWJlZGRlZE1ldGFEYXRhKAogICAgICAgICAgICAgICAgICAgIGdldEFjY2Vz\nc0NvZGUoZm1kLmdldEtleSgpLmdldERlY2xhcmVkVHlwZSgpKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFubm8uZWxlbWVudEVt\nYmVkZGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0RWxlbWVudCgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIs\nIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVudE1hcChlbWJl\nZGRlZFZhbHVlPXRydWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0RWxlbWVu\ndCgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1kLmdl\ndEVsZW1lbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuYWRkRW1iZWRkZWRNZXRh\nRGF0YSgKICAgICAgICAgICAgICAgICAgICBnZXRBY2Nlc3NDb2RlKGZtZC5n\nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgY2FzY2FkZXMgb24gcmVsYXRpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRDYXNjYWRlcyhWYWx1ZU1l\ndGFEYXRhIHZtZCwgQ2FzY2FkZVR5cGVbXSBjYXNjYWRlcykgewogICAgICAg\nIGZvciAoQ2FzY2FkZVR5cGUgY2FzY2FkZSA6IGNhc2NhZGVzKSB7CiAgICAg\nICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBjYXNj\nYWRlID09IENhc2NhZGVUeXBlLlJFTU9WRSkKICAgICAgICAgICAgICAgIHZt\nZC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1F\nRElBVEUpOwogICAgICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlw\nZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5QRVJTSVNUKQogICAg\nICAgICAgICAgICAgdm1kLnNldENhc2NhZGVQZXJzaXN0KFZhbHVlTWV0YURh\ndGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgICAgICBpZiAoY2FzY2Fk\nZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlw\nZS5NRVJHRSkKICAgICAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlQXR0YWNo\nKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgICAg\nICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9\nPSBDYXNjYWRlVHlwZS5ERVRBQ0gpCiAgICAgICAgICAgICAgICB2bWQuc2V0\nQ2FzY2FkZURldGFjaChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRF\nKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxM\nIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuUkVGUkVTSCkKICAgICAgICAg\nICAgICAgIHZtZC5zZXRDYXNjYWRlUmVmcmVzaChWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfSU1NRURJQVRFKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgdm9pZCBzZXRPcnBoYW5SZW1vdmFsKFZhbHVlTWV0YURhdGEgdm1k\nLCBib29sZWFuIG9ycGhhblJlbW92YWwpIHsKICAgICAgICBpZiAob3JwaGFu\nUmVtb3ZhbCkgCiAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlRGVsZXRlKFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBTZXF1ZW5jZUdlbmVyYXRvci4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoQW5ub3RhdGVkRWxl\nbWVudCBlbCwKICAgICAgICBTZXF1ZW5jZUdlbmVyYXRvciBnZW4pIHsKICAg\nICAgICBTdHJpbmcgbmFtZSA9IGdlbi5uYW1lKCk7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5hbWUiLCBl\nbCkpOwoKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1zZXF1ZW5jZSIs\nIG5hbWUpKTsKCiAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gZ2V0\nUmVwb3NpdG9yeSgpLmdldENhY2hlZFNlcXVlbmNlTWV0YURhdGEKICAgICAg\nICAgICAgKG5hbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkdXAtc2VxdWVuY2UiLCBuYW1l\nLCBlbCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICAvLyBjcmVhdGUgbmV3IHNlcXVlbmNlCiAgICAgICAgbWV0YSA9IGdldFJl\ncG9zaXRvcnkoKS5hZGRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwogICAgICAg\nIFN0cmluZyBzZXEgPSBnZW4uc2VxdWVuY2VOYW1lKCk7CiAgICAgICAgaW50\nIGluaXRpYWwgPSBnZW4uaW5pdGlhbFZhbHVlKCk7CiAgICAgICAgaW50IGFs\nbG9jYXRlID0gZ2VuLmFsbG9jYXRpb25TaXplKCk7CiAgICAgICAgU3RyaW5n\nIHNjaGVtYSA9IGdlbi5zY2hlbWEoKTsKICAgICAgICBTdHJpbmcgY2F0YWxv\nZyA9IGdlbi5jYXRhbG9nKCk7CiAgICAgICAgLy8gZG9uJ3QgYWxsb3cgaW5p\ndGlhbCBvZiAwIGIvYyBsb29rcyBsaWtlIGRlZiB2YWx1ZQogICAgICAgIGlm\nIChpbml0aWFsID09IDApCiAgICAgICAgICAgIGluaXRpYWwgPSAxOwoKICAg\nICAgICAvLyBjcmVhdGUgcGx1Z2luIHN0cmluZyBmcm9tIGluZm8KICAgICAg\nICBTdHJpbmcgY2xzTmFtZSwgcHJvcHM7CiAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkoc2VxKSkgewogICAgICAgICAgICBjbHNOYW1lID0gU2Vx\ndWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJvcHMg\nPSBudWxsOwogICAgICAgIH0gZWxzZSBpZiAoc2VxLmluZGV4T2YoJygnKSAh\nPSAtMSkgLy8gcGx1Z2luCiAgICAgICAgewogICAgICAgICAgICBjbHNOYW1l\nID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKHNlcSk7CiAgICAgICAg\nICAgIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhzZXEp\nOwogICAgICAgICAgICBzZXEgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGNsc05hbWUgPSBTZXF1ZW5jZU1ldGFEYXRhLklNUExfTkFU\nSVZFOwogICAgICAgICAgICBwcm9wcyA9IG51bGw7CiAgICAgICAgfQoKICAg\nICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2luKENvbmZpZ3VyYXRpb25zLmdl\ndFBsdWdpbihjbHNOYW1lLCBwcm9wcykpOwogICAgICAgIG1ldGEuc2V0U2Vx\ndWVuY2Uoc2VxKTsKICAgICAgICBtZXRhLnNldEluaXRpYWxWYWx1ZShpbml0\naWFsKTsKICAgICAgICBtZXRhLnNldEFsbG9jYXRlKGFsbG9jYXRlKTsKICAg\nICAgICBtZXRhLnNldFNjaGVtYShzY2hlbWEpOwogICAgICAgIG1ldGEuc2V0\nQ2F0YWxvZyhjYXRhbG9nKTsKICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRT\nb3VyY2VGaWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVs\nbCwKICAgICAgICAgICAgU291cmNlVHJhY2tlci5TUkNfQU5OT1RBVElPTlMp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE5hbWVkUXVlcnkuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU5hbWVkUXVlcmllcyhBbm5v\ndGF0ZWRFbGVtZW50IGVsLCBOYW1lZFF1ZXJ5Li4uIHF1ZXJpZXMpIHsKICAg\nICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7CiAgICAgICAgZm9yIChOYW1lZFF1\nZXJ5IHF1ZXJ5IDogcXVlcmllcykgewogICAgICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShxdWVyeS5uYW1lKCkpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1xdWVy\neS1uYW1lIiwgZWwpKTsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkocXVlcnkucXVlcnkoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXF1ZXJ5LXN0cmlu\nZyIsCiAgICAgICAgICAgICAgICAgICAgcXVlcnkubmFtZSgpLCBlbCkpOwoK\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInBhcnNlLXF1ZXJ5Iiwg\ncXVlcnkubmFtZSgpKSk7CgogICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3Np\ndG9yeSgpLnNlYXJjaFF1ZXJ5TWV0YURhdGFCeU5hbWUocXVlcnkubmFtZSgp\nKTsKICAgICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAg\nICAJQ2xhc3M8Pz4gZGVmaW5pbmdUeXBlID0gbWV0YS5nZXREZWZpbmluZ1R5\ncGUoKTsKICAgICAgICAgICAgICAgIGlmICgoZGVmaW5pbmdUeXBlID09IG51\nbGwgfHwgZGVmaW5pbmdUeXBlICE9IF9jbHMpIAogICAgICAgICAgICAgICAg\nICAmJiBfbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgIF9sb2cud2FybihfbG9jLmdldCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFt\nZSgpLCBlbCwgCiAgICAgICAgICAgICAgICAgICAgCQlkZWZpbmluZ1R5cGUp\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0\nb3J5KCkuYWRkUXVlcnlNZXRhRGF0YShfY2xzLCBxdWVyeS5uYW1lKCkpOwog\nICAgICAgICAgICBtZXRhLnNldFF1ZXJ5U3RyaW5nKHF1ZXJ5LnF1ZXJ5KCkp\nOwogICAgICAgICAgICBtZXRhLnNldExhbmd1YWdlKEpQUUxQYXJzZXIuTEFO\nR19KUFFMKTsKICAgICAgICAgICAgZm9yIChRdWVyeUhpbnQgaGludCA6IHF1\nZXJ5LmhpbnRzKCkpCiAgICAgICAgICAgICAgICBtZXRhLmFkZEhpbnQoaGlu\ndC5uYW1lKCksIGhpbnQudmFsdWUoKSk7CgogICAgICAgICAgICBtZXRhLnNl\ndFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNz\nKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgICAgIFNvdXJjZVRyYWNrZXIu\nU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9E\nRV9NRVRBKTsKICAgICAgICAgICAgZWxzZSBpZiAoaXNNYXBwaW5nTW9kZSgp\nKQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUFQ\nUElORyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG1ldGEu\nc2V0U291cmNlTW9kZShNT0RFX1FVRVJZKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBATmFtZWROYXRpdmVRdWVyeS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVzKEFu\nbm90YXRlZEVsZW1lbnQgZWwsCiAgICAgICAgTmFtZWROYXRpdmVRdWVyeS4u\nLiBxdWVyaWVzKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRhOwogICAg\nICAgIGZvciAoTmFtZWROYXRpdmVRdWVyeSBxdWVyeSA6IHF1ZXJpZXMpIHsK\nICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkubmFt\nZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tbmF0aXZlLXF1ZXJ5LW5hbWUiLAogICAgICAg\nICAgICAgICAgICAgIGVsKSk7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYXRpdmUt\ncXVlcnktc3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICBxdWVyeS5uYW1l\nKCksIGVsKSk7CgogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFy\nc2UtbmF0aXZlLXF1ZXJ5IiwgcXVlcnkubmFtZSgpKSk7CgogICAgICAgICAg\nICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLnNlYXJjaFF1ZXJ5TWV0YURhdGFC\neU5hbWUocXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgaWYgKG1ldGEgIT0g\nbnVsbCkgewogICAgICAgICAgICAJQ2xhc3M8Pz4gZGVmVHlwZSA9IG1ldGEu\nZ2V0RGVmaW5pbmdUeXBlKCk7CiAgICAgICAgICAgICAgICBpZiAoKGRlZlR5\ncGUgIT0gX2NscykgJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpIHsKICAgICAg\nICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImR1cC1xdWVyeSIs\nIHF1ZXJ5Lm5hbWUoKSwgZWwsIGRlZlR5cGUpKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFkZFF1ZXJ5TWV0\nYURhdGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgbWV0YS5z\nZXRRdWVyeVN0cmluZyhxdWVyeS5xdWVyeSgpKTsKICAgICAgICAgICAgbWV0\nYS5zZXRMYW5ndWFnZShRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTCk7CiAgICAg\nICAgICAgIENsYXNzPD8+IHJlcyA9IHF1ZXJ5LnJlc3VsdENsYXNzKCk7CiAg\nICAgICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUoZ2V0Q29u\nZmlndXJhdGlvbigpLCByZXMpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRD\nYW5kaWRhdGVUeXBlKHJlcyk7CiAgICAgICAgICAgIGVsc2UgaWYgKCF2b2lk\nLmNsYXNzLmVxdWFscyhyZXMpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRS\nZXN1bHRUeXBlKHJlcyk7CgogICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkocXVlcnkucmVzdWx0U2V0TWFwcGluZygpKSkKICAgICAgICAg\nICAgICAgIG1ldGEuc2V0UmVzdWx0U2V0TWFwcGluZ05hbWUocXVlcnkucmVz\ndWx0U2V0TWFwcGluZygpKTsKICAgICAgICAgICAgZm9yIChRdWVyeUhpbnQg\naGludCA6IHF1ZXJ5LmhpbnRzKCkpCiAgICAgICAgICAgICAgICBtZXRhLmFk\nZEhpbnQoaGludC5uYW1lKCksIGhpbnQudmFsdWUoKSk7CgogICAgICAgICAg\nICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBpbnN0YW5j\nZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgICAgIFNvdXJj\nZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJj\nZU1vZGUoTU9ERV9NRVRBKTsKICAgICAgICAgICAgZWxzZSBpZiAoaXNNYXBw\naW5nTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2Rl\nKE1PREVfTUFQUElORyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX1FVRVJZKTsKICAgICAgICB9\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0IHRoZSBleHBsaWNpdCBh\nY2Nlc3MgdHlwZSwgaWYgc3BlY2lmaWVkLgogICAgICovICAgIAogICAgcHJp\ndmF0ZSB2b2lkIHBhcnNlQWNjZXNzKEZpZWxkTWV0YURhdGEgbWV0YSwgQWNj\nZXNzIGFjY2VzcykgewogICAgCWlmIChhY2Nlc3MgIT0gbnVsbCkgewogICAg\nCQltZXRhLnNldEFjY2Vzc1R5cGUoQWNjZXNzQ29kZS5FWFBMSUNJVCAKICAg\nICAgICAgICAgfCAoYWNjZXNzLnZhbHVlKCkgPT0gQWNjZXNzVHlwZS5GSUVM\nRCA/IAogICAgICAgICAgICAJCUFjY2Vzc0NvZGUuRklFTEQgOiBBY2Nlc3ND\nb2RlLlBST1BFUlRZKSk7CiAgICAJfQogICAgfQoKICAgIHByaXZhdGUgc3Rh\ndGljIGNsYXNzIE1ldGhvZEtleSB7CgogICAgICAgIHByaXZhdGUgZmluYWwg\nTWV0aG9kIF9tZXRob2Q7CgogICAgICAgIHB1YmxpYyBNZXRob2RLZXkoTWV0\naG9kIG0pIHsKICAgICAgICAgICAgX21ldGhvZCA9IG07CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBp\nbnQgY29kZSA9IDQ2ICogMTIgKyBfbWV0aG9kLmdldE5hbWUoKS5oYXNoQ29k\nZSgpOwogICAgICAgICAgICBmb3IgKENsYXNzPD8+IHBhcmFtIDogX21ldGhv\nZC5nZXRQYXJhbWV0ZXJUeXBlcygpKQogICAgICAgICAgICAgICAgY29kZSA9\nIDQ2ICogY29kZSArIHBhcmFtLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIHJl\ndHVybiBjb2RlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvKSB7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFu\nY2VvZiBNZXRob2RLZXkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICBNZXRob2Qgb3RoZXIgPSAoKE1ldGhvZEtleSkgbyku\nX21ldGhvZDsKICAgICAgICAgICAgaWYgKCFfbWV0aG9kLmdldE5hbWUoKS5l\ncXVhbHMob3RoZXIuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5lcXVhbHMoX21l\ndGhvZC5nZXRQYXJhbWV0ZXJUeXBlcygpLAogICAgICAgICAgICAgICAgb3Ro\nZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIE1ldGhvZENvbXBhcmF0b3IgaW1wbGVt\nZW50cyBDb21wYXJhdG9yPE1ldGhvZD4gewoKICAgICAgICBwcml2YXRlIHN0\nYXRpYyBNZXRob2RDb21wYXJhdG9yIElOU1RBTkNFID0gbnVsbDsKCiAgICAg\nICAgcHVibGljIHN0YXRpYyBNZXRob2RDb21wYXJhdG9yIGdldEluc3RhbmNl\nKCkgewogICAgICAgICAgICBpZiAoSU5TVEFOQ0UgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIElOU1RBTkNFID0gbmV3IE1ldGhvZENvbXBhcmF0b3IoKTsK\nICAgICAgICAgICAgcmV0dXJuIElOU1RBTkNFOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBjb21wYXJlKE1ldGhvZCBtMSwgTWV0aG9kIG0yKSB7\nCiAgICAgICAgICAgIENsYXNzPD8+IGMxID0gbTEuZ2V0RGVjbGFyaW5nQ2xh\nc3MoKTsKICAgICAgICAgICAgQ2xhc3M8Pz4gYzIgPSBtMi5nZXREZWNsYXJp\nbmdDbGFzcygpOwogICAgICAgICAgICBpZiAoIWMxLmVxdWFscyhjMikpIHsK\nICAgICAgICAgICAgICAgIGlmIChjMS5pc0Fzc2lnbmFibGVGcm9tKGMyKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgICAg\nICBlbHNlCgkJCQkJcmV0dXJuIDE7CgkJCX0KCQkJaW50IGNvbXBhcmUgPSBt\nMS5nZXROYW1lICgpLmNvbXBhcmVUbyAobTIuZ2V0TmFtZSAoKSk7CgkJCWlm\nIChjb21wYXJlID09IDApCgkJCQlyZXR1cm4gbTEuaGFzaENvZGUgKCkgLSBt\nMi5oYXNoQ29kZSAoKTsKCQkJcmV0dXJuIGNvbXBhcmU7CgkJfQoJfQp9Cgo=\n","encoding":"base64"}

