{"sha":"5cbfd5d2aaee30e99c0619f144a1dfb0f3bede3a","node_id":"MDQ6QmxvYjIwNjM2NDo1Y2JmZDVkMmFhZWUzMGU5OWMwNjE5ZjE0NGExZGZiMGYzYmVkZTNh","size":12803,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5cbfd5d2aaee30e99c0619f144a1dfb0f3bede3a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLnNwaS5Mb2FkU3Rh\ndGU7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lz\ndGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFu\nY2UuU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5BYnN0cmFjdEJyb2tlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLkJyb2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKCnB1YmxpYyBjbGFzcyBP\ncGVuSlBBUGVyc2lzdGVuY2VVdGlsIHsKCiAgICAvKioKICAgICAqIFJldHVy\nbnMgdGhlIGlkZW50aWZpZXIgb2YgdGhlIHBlcnNpc3RlbnQgZW50aXR5Lgog\nICAgICogQHBhcmFtIGVudGl0eQogICAgICogQHJldHVybiBUaGUgaWRlbnRp\nZmllciBvZiB0aGUgZW50aXR5IG9yIG51bGwgaWYgdGhlIGVudGl0eQogICAg\nICogaXMgbm90IHBlcnNpc3RlbnQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgT2JqZWN0IGdldElkZW50aWZpZXIoT2JqZWN0IGVudGl0eSkgewogICAg\nICAgIHJldHVybiBnZXRJZGVudGlmaWVyKG51bGwsIGVudGl0eSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG9iamVjdCBpZGVudGlmaWVyIGZv\nciBhIHBlcnNpc3RlbnQgZW50aXR5IG1hbmFnZWQgYnkgb25lCiAgICAgKiBv\nZiB0aGUgZW50aXR5IG1hbmFnZXJzIG9mIHRoZSBzcGVjaWZpZWQgZW50aXR5\nIG1hbmFnZXIgZmFjdG9yeS4KICAgICAqIEByZXR1cm4gVGhlIGlkZW50aWZp\nZXIgb2YgdGhlIGVudGl0eSBvciBudWxsIGlmIHRoZSBlbnRpdHkgZG9lcwog\nICAgICogbm90IGhhdmUgYW4gaWRlbnRpZmllciBhc3NpZ25lZCBvciBpcyBu\nb3QgbWFuYWdlZCBieSBhbnkgb2YgdGhlCiAgICAgKiBlbnRpdHkgbWFuYWdl\ncnMgb2YgdGhlIGVudGl0eSBtYW5hZ2VyIGZhY3RvcnkuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGdldElkZW50aWZpZXIoT3BlbkpQQUVu\ndGl0eU1hbmFnZXJGYWN0b3J5IGVtZiwgCiAgICAgICAgT2JqZWN0IGVudGl0\neSkgewoKICAgICAgICBpZiAoZW50aXR5IGluc3RhbmNlb2YgUGVyc2lzdGVu\nY2VDYXBhYmxlKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpZW50aXR5OwogICAgICAgICAgICAv\nLyBQZXIgY29udHJhY3QsIGlmIG5vdCBtYW5hZ2VkIGJ5IHRoZSBvd25pbmcg\nZW1mLCByZXR1cm4gbnVsbC4KICAgICAgICAgICAgaWYgKGVtZiAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoIWlzTWFuYWdlZEJ5KGVtZiwgcGMp\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VyIHNtID0gcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAg\nCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNtIGluc3RhbmNlb2Yg\nT3BlbkpQQVN0YXRlTWFuYWdlcikgewogICAgICAgICAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBvc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcilzbTsK\nICAgICAgICAgICAgICAgIHJldHVybiBvc20uZ2V0T2JqZWN0SWQoKTsgICAg\nICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmVz\nIHdoZXRoZXIgdGhlIHNwZWNpZmllZCBzdGF0ZSBtYW5hZ2VyIGlzIG1hbmFn\nZWQgYnkgYSBicm9rZXIKICAgICAqIHdpdGhpbiB0aGUgcGVyc2lzdGVuY2Ug\ndW5pdCBvZiB0aGlzIHV0aWxpdHkgaW5zdGFuY2UuCiAgICAgKiBAcGFyYW0g\nc20gU3RhdGVNYW5hZ2VyCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhpcyBz\ndGF0ZSBtYW5hZ2VyIGlzIG1hbmFnZWQgYnkgYSBicm9rZXIgd2l0aGluCiAg\nICAgKiB0aGlzIHBlcnNpc3RlbmNlIHVuaXQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgYm9vbGVhbiBpc01hbmFnZWRCeShPcGVuSlBBRW50aXR5TWFu\nYWdlckZhY3RvcnkgZW1mLCBPYmplY3QgZW50aXR5KSB7CiAgICAgICAgaWYg\nKGVtZiA9PSBudWxsIHx8ICFlbWYuaXNPcGVuKCkgfHwgIUltcGxIZWxwZXIu\naXNNYW5hZ2VhYmxlKGVudGl0eSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIH0KICAgICAgICBPYmplY3QgYWJmb2JqID0gSlBBRmFj\nYWRlSGVscGVyLnRvQnJva2VyRmFjdG9yeShlbWYpOwogICAgICAgIGlmIChh\nYmZvYmogPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgICAgIGlmIChhYmZvYmogaW5zdGFuY2VvZiBBYnN0cmFj\ndEJyb2tlckZhY3RvcnkpIHsKICAgICAgICAgICAgQWJzdHJhY3RCcm9rZXJG\nYWN0b3J5IGFiZiA9IChBYnN0cmFjdEJyb2tlckZhY3RvcnkpYWJmb2JqOwog\nICAgICAgICAgICBDb2xsZWN0aW9uPEJyb2tlcj4gYnJva2VycyA9IGFiZi5n\nZXRPcGVuQnJva2VycygpOwogICAgICAgICAgICBpZiAoYnJva2VycyA9PSBu\ndWxsIHx8IGJyb2tlcnMuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBD\neWNsZSB0aHJvdWdoIGFsbCBicm9rZXJzIG1hbmFnZWQgYnkgdGhpcyBmYWN0\nb3J5LiAgCiAgICAgICAgICAgIGZvciAoQnJva2VyIGJyb2tlciA6IGJyb2tl\ncnMpIHsKICAgICAgICAgICAgICAgIGlmIChicm9rZXIgIT0gbnVsbCAmJiAh\nYnJva2VyLmlzQ2xvc2VkKCkpIHsKICAgICAgICAgICAgICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKWVudGl0\neTsKICAgICAgICAgICAgICAgICAgICAvLyBWZXJpZnkgdGhpcyBicm9rZXIg\naXMgbWFuYWdpbmcgdGhlIGVudGl0eQogICAgICAgICAgICAgICAgICAgIGlm\nIChwYy5wY0dldEdlbmVyaWNDb250ZXh0KCkgPT0gYnJva2VyKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGF0dHJpYnV0ZSBvbiB0aGUg\nc3BlY2lmaWVkIG9iamVjdCBpcyBsb2FkZWQuCiAgICAgKiAKICAgICAqIEBy\nZXR1cm4gTG9hZFN0YXRlLkxPQURFRCAtIGlmIHRoZSBhdHRyaWJ1dGUgaXMg\nbG9hZGVkLgogICAgICogICAgICAgICBMb2FkU3RhdGUuTk9UX0xPQURFRCAt\nIGlmIHRoZSBhdHRyaWJ1dGUgaXMgbm90IGxvYWRlZCBvciBhbnkKICAgICAq\nICAgICAgICAgRUFHRVIgZmV0Y2ggYXR0cmlidXRlcyBvZiB0aGUgZW50aXR5\nIGFyZSBub3QgbG9hZGVkLgogICAgICogICAgICAgICBMb2FkU3RhdGUuVU5L\nTk9XTiAtIGlmIHRoZSBlbnRpdHkgaXMgbm90IG1hbmFnZWQgYnkgdGhpcwog\nICAgICogICAgICAgICBwcm92aWRlciBvciBpZiBpdCBkb2VzIG5vdCBjb250\nYWluIHRoZSBwZXJzaXN0ZW50CiAgICAgKiAgICAgICAgIGF0dHJpYnV0ZS4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBMb2FkU3RhdGUgaXNMb2FkZWQo\nT2JqZWN0IG9iaiwgU3RyaW5nIGF0dHIpIHsKICAgICAgICByZXR1cm4gaXNM\nb2FkZWQobnVsbCwgb2JqLCBhdHRyKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERldGVybWluZXMgd2hldGhlciB0aGUgYXR0cmlidXRlIG9uIHRoZSBzcGVj\naWZpZWQgb2JqZWN0IGlzIGxvYWRlZCBhbmQKICAgICAqIGlzIG1hbmFnZWQg\nYnkgb25lIG9mIHRoZSBlbnRpdHkgbWFuYWdlcnMgb2YgdGhlIHNwZWNpZmll\nZCBlbnRpdHkgbWFuYWdlcgogICAgICogZmFjdG9yeS4KICAgICAqIAogICAg\nICogQHJldHVybiBMb2FkU3RhdGUuTE9BREVEIC0gaWYgdGhlIGF0dHJpYnV0\nZSBpcyBsb2FkZWQuCiAgICAgKiAgICAgICAgIExvYWRTdGF0ZS5OT1RfTE9B\nREVEIC0gaWYgdGhlIGF0dHJpYnV0ZSBpcyBub3QgbG9hZGVkIG9yIGFueQog\nICAgICogICAgICAgICBFQUdFUiBmZXRjaCBhdHRyaWJ1dGVzIG9mIHRoZSBl\nbnRpdHkgYXJlIG5vdCBsb2FkZWQuCiAgICAgKiAgICAgICAgIExvYWRTdGF0\nZS5VTktOT1dOIC0gaWYgdGhlIGVudGl0eSBpcyBub3QgbWFuYWdlZCBieSB0\naGlzCiAgICAgKiAgICAgICAgIHByb3ZpZGVyIG9yIG9uZSBvZiB0aGUgZW50\naXR5IG1hbmFnZXJzIG9mIHRoZSBzcGVjaWZpZWQgCiAgICAgKiAgICAgICAg\nIGVudGl0eSBtYW5hZ2VyIGZhY3RvcnksIG9yIGlmIGl0IGRvZXMgbm90IGNv\nbnRhaW4gdGhlIHBlcnNpc3RlbnQKICAgICAqICAgICAgICAgYXR0cmlidXRl\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIExvYWRTdGF0ZSBpc0xvYWRl\nZChPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnkgZW1mLCBPYmplY3Qgb2Jq\nLCBTdHJpbmcgYXR0cikgewoKICAgICAgICBpZiAob2JqID09IG51bGwpIHsK\nICAgICAgICAgICAgcmV0dXJuIExvYWRTdGF0ZS5VTktOT1dOOwogICAgICAg\nIH0KICAgICAgICAKICAgICAgICAvLyBJZiB0aGUgb2JqZWN0IGhhcyBhIHN0\nYXRlIG1hbmFnZXIsIGNhbGwgaXQgZGlyZWN0bHkuCiAgICAgICAgaWYgKG9i\naiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJsZSkgewogICAgICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxl\nKW9iajsKICAgICAgICAgICAgaWYgKGVtZiAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBpZiAoIU9wZW5KUEFQZXJzaXN0ZW5jZVV0aWwuaXNNYW5hZ2Vk\nQnkoZW1mLCBwYykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIExvYWRT\ndGF0ZS5VTktOT1dOOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlciBzbSA9IHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAg\nICAgIGlmIChzbSAhPSBudWxsICYmIHNtIGluc3RhbmNlb2YgT3BlbkpQQVN0\nYXRlTWFuYWdlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIGlzTG9hZGVk\nKChPcGVuSlBBU3RhdGVNYW5hZ2VyKXNtLCBhdHRyLCBudWxsKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gICAgICAgIAogICAgICAgIHJldHVybiBMb2Fk\nU3RhdGUuVU5LTk9XTjsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBMb2Fk\nU3RhdGUgaXNMb2FkZWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgU3RyaW5n\nIGF0dHIsIAogICAgICAgIEhhc2hTZXQ8T3BlbkpQQVN0YXRlTWFuYWdlcj4g\ncGNzKSB7CiAgICAgICAgYm9vbGVhbiBpc0xvYWRlZCA9IHRydWU7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgQml0U2V0IGxvYWRTZXQgPSBzbS5nZXRM\nb2FkZWQoKTsKICAgICAgICAgICAgaWYgKGF0dHIgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbS5nZXRNZXRhRGF0\nYSgpLmdldEZpZWxkKGF0dHIpOwogICAgICAgICAgICAgICAgLy8gQ291bGQg\nbm90IGZpbmQgZmllbGQgbWV0YWRhdGEgZm9yIHRoZSBzcGVjaWZpZWQgYXR0\ncmlidXRlLgogICAgICAgICAgICAgICAgaWYgKGZtZCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIExvYWRTdGF0ZS5VTktOT1dOOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNl\nLCByZXR1cm4gdGhlIGxvYWQgc3RhdGUKICAgICAgICAgICAgICAgIGlmKCFs\nb2FkU2V0LmdldChmbWQuZ2V0SW5kZXgoKSkpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gTG9hZFN0YXRlLk5PVF9MT0FERUQ7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAg\nICAgICAgICAvLyBDaGVjayBsb2FkIHN0YXRlIG9mIGFsbCBwZXJzaXN0ZW50\nIGVhZ2VyIGZldGNoIGF0dHJpYnV0ZXMKICAgICAgICAgICAgaWYgKGZtZHMg\nIT0gbnVsbCAmJiBmbWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAg\nIHBjcyA9IGFkZFRvTG9hZFNldChwY3MsIHNtKTsKICAgICAgICAgICAgICAg\nIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBmbWRzKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTG9hZGVkRmllbGQoc20s\nIGZtZCwgcGNzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNM\nb2FkZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGNz\nLnJlbW92ZShzbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gdHJlYXQgYW55\nIGV4Y2VwdGlvbnMsIGxpa2UgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24KICAgICAgICAgICAgLy8gZm9yIGRldGFjaGVkIGVudGl0aWVzLCBhcyBM\nb2FkU3RhdGUuVU5LTk9XTgogICAgICAgICAgICByZXR1cm4gTG9hZFN0YXRl\nLlVOS05PV047CiAgICAgICAgfQogICAgICAgIHJldHVybiBpc0xvYWRlZCA/\nIExvYWRTdGF0ZS5MT0FERUQgOiBMb2FkU3RhdGUuTk9UX0xPQURFRDsgICAg\nICAgIAogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBIYXNoU2V0PE9w\nZW5KUEFTdGF0ZU1hbmFnZXI+IGFkZFRvTG9hZFNldCgKICAgICAgICBIYXNo\nU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+IHBjcywgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSkgewogICAgICAgIGlmIChwY3MgPT0gbnVsbCkgewogICAgICAg\nICAgICBwY3MgPSBuZXcgSGFzaFNldDxPcGVuSlBBU3RhdGVNYW5hZ2VyPigp\nOwogICAgICAgIH0KICAgICAgICBwY3MuYWRkKHNtKTsKICAgICAgICByZXR1\ncm4gcGNzOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNM\nb2FkZWRGaWVsZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kLCBIYXNoU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+\nIHBjcykgewogICAgICAgIEJpdFNldCBsb2FkU2V0ID0gc20uZ2V0TG9hZGVk\nKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAvLyBTaW1wbGUgbG9hZCBz\ndGF0ZSBjaGVjayBmb3IgdGhlIGZpZWxkCiAgICAgICAgaWYgKCFsb2FkU2V0\nLmdldChmbWQuZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgT2JqZWN0IGZpZWxkID0gc20uZmV0Y2hGaWVsZChmbWQu\nZ2V0SW5kZXgoKSwgZmFsc2UpOwoKICAgICAgICAvLyBHZXQgdGhlIHN0YXRl\nIG1hbmFnZXIgZm9yIHRoZSBmaWVsZCwgaWYgaXQgaXMgYSBQQwogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2ZzbSA9IGdldFN0YXRlTWFuYWdlcihm\naWVsZCk7CgogICAgICAgIC8vIFByZXZlbnQgY2lyY3VsYXIgbG9hZCBzdGF0\nZSBldmFsdWF0aW9uIGZvciB0aGlzIHNtLgogICAgICAgIGlmIChvZnNtICE9\nIG51bGwgJiYgcGNzLmNvbnRhaW5zKG9mc20pKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAKICAgICAgICAvLyBJZiBhIGNvbGxlY3Rpb24g\ndHlwZSwgZGV0ZXJtaW5lIGlmIGl0IGlzIGxvYWRlZAogICAgICAgIHN3aXRj\naCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOiAgIAogICAgICAgICAgICAgICAg\ncmV0dXJuIGlzTG9hZGVkQ29sbGVjdGlvbihzbSwgZm1kLmdldEVsZW1lbnQo\nKSwgCiAgICAgICAgICAgICAgICAgICAgKENvbGxlY3Rpb248Pz4pZmllbGQs\nIHBjcyk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAg\nICAgICAgICAgIHJldHVybiBpc0xvYWRlZE1hcChzbSwgZm1kLCAKICAgICAg\nICAgICAgICAgICAgICAoTWFwPD8sPz4pZmllbGQsIHBjcyk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGlzTG9hZGVkQXJyYXkoc20sIGZtZC5nZXRFbGVtZW50KCksIAogICAg\nICAgICAgICAgICAgICAgIChPYmplY3RbXSlmaWVsZCwgcGNzKTsKICAgICAg\nICB9CiAgICAgICAgLy8gSWYgb3RoZXIgUEMgdHlwZSwgZGV0ZXJtaW5lIGlm\nIGl0IGlzIGxvYWRlZAogICAgICAgIGlmIChvZnNtICE9IG51bGwgJiYgZm1k\nLmlzRGVjbGFyZWRUeXBlUEMoKSkgewogICAgICAgICAgICByZXR1cm4gaXNM\nb2FkZWQob2ZzbSwgbnVsbCwgcGNzKSA9PQogICAgICAgICAgICAgICAgTG9h\nZFN0YXRlLkxPQURFRDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfSAKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0xv\nYWRlZENvbGxlY3Rpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgCiAgICAg\nICAgVmFsdWVNZXRhRGF0YSB2bWQsIENvbGxlY3Rpb248Pz4gY29sbCwgSGFz\naFNldDxPcGVuSlBBU3RhdGVNYW5hZ2VyPiBwY3MpIHsKICAgICAgICAKICAg\nICAgICAvLyBUaGlzIGZpZWxkIHBhc3NlZCB0aGUgbG9hZCBzdGF0ZSBjaGVj\nayBpbiBpc0xvYWRlZEZpZWxkLCBzbwogICAgICAgIC8vIGlmIGFueSBvZiB0\naGVzZSBjb25kaXRpb25zIGFyZSB0cnVlIHRoZSBjb2xsZWN0aW9uIGlzIGxv\nYWRlZC4KICAgICAgICBpZiAoc20gPT0gbnVsbCB8fCBjb2xsID09IG51bGwg\nfHwgY29sbC5zaXplKCkgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQ29udmVydCB0byBh\ncnJheSB0byBwcmV2ZW50IGNvbmN1cnJlbmN5IGlzc3VlcwogICAgICAgIE9i\namVjdFtdIGFyciA9IGNvbGwudG9BcnJheSgpOwoKICAgICAgICByZXR1cm4g\naXNMb2FkZWRBcnJheShzbSwgdm1kLCBhcnIsIHBjcyk7CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0xvYWRlZEFycmF5KE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIAogICAgICAgIFZhbHVlTWV0YURhdGEgdm1kLCBP\nYmplY3RbXSBhcnIsIAogICAgICAgIEhhc2hTZXQ8T3BlbkpQQVN0YXRlTWFu\nYWdlcj4gcGNzKSB7CgogICAgICAgIC8vIFRoaXMgZmllbGQgcGFzc2VkIHRo\nZSBsb2FkIHN0YXRlIGNoZWNrIGluIGlzTG9hZGVkRmllbGQsIHNvCiAgICAg\nICAgLy8gaWYgYW55IG9mIHRoZXNlIGNvbmRpdGlvbnMgYXJlIHRydWUgdGhl\nIGFycmF5IGlzIGxvYWRlZC4KICAgICAgICBpZiAoc20gPT0gbnVsbCB8fCBh\ncnIgPT0gbnVsbCB8fCBhcnIubGVuZ3RoID09IDApIHsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBOb3QgYSBjb2xs\nZWN0aW9uIG9mIFBDJ3MgCiAgICAgICAgaWYgKCF2bWQuaXNEZWNsYXJlZFR5\ncGVQQygpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgZm9yIChPYmplY3QgcGMgOiBhcnIpIHsKICAgICAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBlc20gPSBnZXRTdGF0ZU1hbmFn\nZXIocGMpOwogICAgICAgICAgICBpZiAoZXNtID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmICghKGlzTG9hZGVkKGVzbSwgbnVsbCwgcGNzKSA9PSBMb2FkU3Rh\ndGUuTE9BREVEKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJpdmF0\nZSBzdGF0aWMgYm9vbGVhbiBpc0xvYWRlZE1hcChPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCAKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCwgTWFwPD8sPz4g\nbWFwLCBIYXNoU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+IHBjcykgewogICAg\nICAgICAgICAgICAgCiAgICAgICAgLy8gVGhpcyBmaWVsZCBwYXNzZWQgdGhl\nIGxvYWQgc3RhdGUgY2hlY2sgaW4gaXNMb2FkZWRGaWVsZCwgc28KICAgICAg\nICAvLyBpZiBhbnkgb2YgdGhlc2UgY29uZGl0aW9ucyBhcmUgdHJ1ZSB0aGUg\nbWFwIGlzIGxvYWRlZC4KICAgICAgICBpZiAoc20gPT0gbnVsbCB8fCBtYXAg\nPT0gbnVsbCB8fCBtYXAuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGtleUlzUEMg\nPSBmbWQuZ2V0S2V5KCkuaXNEZWNsYXJlZFR5cGVQQygpOwogICAgICAgIGJv\nb2xlYW4gdmFsSXNQQyA9IGZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5\ncGVQQygpOwoKICAgICAgICAvLyBNYXAgaXMgZG9lcyBub3QgY29udGFpbiBQ\nQ3MgaW4gZWl0aGVyIGtleXMgb3IgdmFsdWVzCiAgICAgICAgaWYgKCEoa2V5\nSXNQQyB8fCB2YWxJc1BDKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIE9iamVjdFtdIGFyciA9IG1hcC5r\nZXlTZXQoKS50b0FycmF5KCk7CgogICAgICAgIGZvciAoT2JqZWN0IGtleSA6\nIGFycikgewogICAgICAgICAgICBpZiAoa2V5SXNQQykgewogICAgICAgICAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBrc20gPSBnZXRTdGF0ZU1hbmFn\nZXIoa2V5KTsKICAgICAgICAgICAgICAgIGlmIChrc20gPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAg\nICAgfSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAg\naWYgKCEoaXNMb2FkZWQoa3NtLCBudWxsLCBwY3MpID09IExvYWRTdGF0ZS5M\nT0FERUQpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAodmFsSXNQQykgewogICAgICAg\nICAgICAgICAgT2JqZWN0IHZhbHVlID0gbWFwLmdldChrZXkpOwogICAgICAg\nICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciB2c20gPSBnZXRTdGF0ZU1h\nbmFnZXIodmFsdWUpOwogICAgICAgICAgICAgICAgaWYgKHZzbSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAg\nICAgICBpZiAoIShpc0xvYWRlZCh2c20sIG51bGwsIHBjcykgPT0gTG9hZFN0\nYXRlLkxPQURFRCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgT3BlbkpQQVN0YXRlTWFuYWdlciBnZXRTdGF0ZU1hbmFnZXIoT2JqZWN0\nIG9iaikgeyAgICAgICAgCiAgICAgICAgaWYgKG9iaiA9PSBudWxsIHx8ICEo\nb2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKSkgewogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\nUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gKFBlcnNpc3RlbmNlQ2FwYWJsZSlv\nYmo7CiAgICAgICAgU3RhdGVNYW5hZ2VyIHNtID0gcGMucGNHZXRTdGF0ZU1h\nbmFnZXIoKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCB8fCAhKHNtIGluc3Rh\nbmNlb2YgT3BlbkpQQVN0YXRlTWFuYWdlcikpIHsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoT3BlbkpQQVN0\nYXRlTWFuYWdlcilzbTsKICAgIH0KfQo=\n","encoding":"base64"}

