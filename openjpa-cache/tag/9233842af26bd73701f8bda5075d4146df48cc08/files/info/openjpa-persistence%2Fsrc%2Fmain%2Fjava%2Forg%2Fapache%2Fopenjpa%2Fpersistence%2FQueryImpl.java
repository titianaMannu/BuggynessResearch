{"sha":"1b0728ebf4c0b248a629491add635383010e31fc","node_id":"MDQ6QmxvYjIwNjM2NDoxYjA3MjhlYmY0YzBiMjQ4YTYyOTQ5MWFkZDYzNTM4MzAxMGUzMWZj","size":35860,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1b0728ebf4c0b248a629491add635383010e31fc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5n\ndWFnZXMuTEFOR19QUkVQQVJFRF9TUUw7CgppbXBvcnQgamF2YS5pby5TZXJp\nYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5z\ncWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5T\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKaW1wb3J0IGphdmEudXRp\nbC5jb25jdXJyZW50LmxvY2tzLlJlZW50cmFudExvY2s7CgppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuRmx1c2hNb2RlVHlwZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkxvY2tNb2RlVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLk5vUmVzdWx0RXhjZXB0aW9uOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuTm9uVW5pcXVlUmVzdWx0RXhjZXB0aW9uOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuUGFyYW1ldGVyOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UZW1wb3JhbFR5cGU7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UeXBlZFF1ZXJ5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuY3JpdGVyaWEuUGFyYW1ldGVyRXhwcmVzc2lv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFw\nLkxpbmtlZE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9w\nZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5Ccm9rZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkRlbGVnYXRpbmdRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuRGVsZWdhdGluZ1Jlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmlsdGVyczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUHJlcGFyZWRRdWVyeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUHJlcGFyZWRRdWVyeUNhY2hl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1\nYWdlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlP\ncGVyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5R\ndWVyeVN0YXRpc3RpY3M7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLmV4cHMuQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWwuSlBRTFBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdExpc3Q7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xh\ndG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2Vw\ndGlvbjsKCi8qKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUXVlcnl9\nIGludGVyZmFjZS4KICogCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCkBTdXBw\ncmVzc1dhcm5pbmdzKCJzZXJpYWwiKQpwdWJsaWMgY2xhc3MgUXVlcnlJbXBs\nPFg+IGltcGxlbWVudHMgT3BlbkpQQVF1ZXJ5U1BJPFg+LCBTZXJpYWxpemFi\nbGUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdFtdIEVNUFRZ\nX0FSUkFZID0gbmV3IE9iamVjdFswXTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoUXVl\ncnlJbXBsLmNsYXNzKTsKCglwcml2YXRlIERlbGVnYXRpbmdRdWVyeSBfcXVl\ncnk7Cglwcml2YXRlIHRyYW5zaWVudCBFbnRpdHlNYW5hZ2VySW1wbCBfZW07\nCglwcml2YXRlIHRyYW5zaWVudCBGZXRjaFBsYW4gX2ZldGNoOwoKICAgIHBy\naXZhdGUgTWFwPFBhcmFtZXRlcjw/PiwgT2JqZWN0PiBfYm91bmRQYXJhbXM7\nCiAgICBwcml2YXRlIE1hcDxPYmplY3QsIFBhcmFtZXRlcjw/Pj4gX2RlY2xh\ncmVkUGFyYW1zOwogICAgcHJpdmF0ZSBDbGFzczw/PiBfcGFyYW1LZXlUeXBl\nOwoJcHJpdmF0ZSBTdHJpbmcgX2lkOwogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nUmVlbnRyYW50TG9jayBfbG9jayA9IG51bGw7Cglwcml2YXRlIGZpbmFsIEhp\nbnRIYW5kbGVyIF9oaW50SGFuZGxlcjsKCgkvKioKCSAqIENvbnN0cnVjdG9y\nOyBzdXBwbHkgZmFjdG9yeSBleGNlcHRpb24gdHJhbnNsYXRvciBhbmQgZGVs\nZWdhdGUuCgkgKiAKCSAqIEBwYXJhbSBlbSAgVGhlIEVudGl0eU1hbmFnZXIg\nd2hpY2ggY3JlYXRlZCB0aGlzIHF1ZXJ5CgkgKiBAcGFyYW0gcmV0IEV4Y2Vw\ndGlvbiB0cmFuc2xhdG9yIGZvciB0aGlzIHF1ZXJ5CgkgKiBAcGFyYW0gcXVl\ncnkgVGhlIHVuZGVybHlpbmcgImtlcm5lbCIgcXVlcnkuCgkgKi8KCXB1Ymxp\nYyBRdWVyeUltcGwoRW50aXR5TWFuYWdlckltcGwgZW0sIFJ1bnRpbWVFeGNl\ncHRpb25UcmFuc2xhdG9yIHJldCwKCQkJb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5RdWVyeSBxdWVyeSkgewoJCV9lbSA9IGVtOwoJCV9xdWVyeSA9IG5l\ndyBEZWxlZ2F0aW5nUXVlcnkocXVlcnksIHJldCk7CgkJX2hpbnRIYW5kbGVy\nID0gbmV3IEhpbnRIYW5kbGVyKHRoaXMpOwoJCV9sb2NrID0gbmV3IFJlZW50\ncmFudExvY2soKTsKCX0KCgkvKioKCSAqIENvbnN0cnVjdG9yOyBzdXBwbHkg\nZmFjdG9yeSBhbmQgZGVsZWdhdGUuCgkgKiAKCSAqIEBkZXByZWNhdGVkCgkg\nKi8KCXB1YmxpYyBRdWVyeUltcGwoRW50aXR5TWFuYWdlckltcGwgZW0sCgkg\nICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcXVlcnkp\nIHsKCQl0aGlzKGVtLCBudWxsLCBxdWVyeSk7Cgl9CgoJLyoqCgkgKiBEZWxl\nZ2F0ZS4KCSAqLwoJcHVibGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnkgZ2V0RGVsZWdhdGUoKSB7CgkJcmV0dXJuIF9xdWVyeS5nZXREZWxl\nZ2F0ZSgpOwoJfQoKCXB1YmxpYyBPcGVuSlBBRW50aXR5TWFuYWdlciBnZXRF\nbnRpdHlNYW5hZ2VyKCkgewoJCXJldHVybiBfZW07Cgl9CgoJcHVibGljIFN0\ncmluZyBnZXRMYW5ndWFnZSgpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldExhbmd1\nYWdlKCk7Cgl9CgoJcHVibGljIFF1ZXJ5T3BlcmF0aW9uVHlwZSBnZXRPcGVy\nYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIFF1ZXJ5T3BlcmF0aW9uVHlwZS5m\ncm9tS2VybmVsQ29uc3RhbnQoX3F1ZXJ5LmdldE9wZXJhdGlvbigpKTsKCX0K\nCglwdWJsaWMgRmV0Y2hQbGFuIGdldEZldGNoUGxhbigpIHsKCQlfZW0uYXNz\nZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LmFzc2VydE5vdFNlcmlh\nbGl6ZWQoKTsKCQlfcXVlcnkubG9jaygpOwoJCXRyeSB7CgkJCWlmIChfZmV0\nY2ggPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9mZXRjaCA9ICgoRW50aXR5\nTWFuYWdlckZhY3RvcnlJbXBsKSBfZW0KICAgICAgICAgICAgICAgICAgICAg\nICAgLmdldEVudGl0eU1hbmFnZXJGYWN0b3J5KCkpLnRvRmV0Y2hQbGFuKF9x\ndWVyeQogICAgICAgICAgICAgICAgICAgICAgICAuZ2V0QnJva2VyKCksIF9x\ndWVyeS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CgkJCXJldHVybiBfZmV0\nY2g7CgkJfSBmaW5hbGx5IHsKCQkJX3F1ZXJ5LnVubG9jaygpOwoJCX0KCX0K\nCglwdWJsaWMgU3RyaW5nIGdldFF1ZXJ5U3RyaW5nKCkgewoJCXJldHVybiBf\ncXVlcnkuZ2V0UXVlcnlTdHJpbmcoKTsKCX0KCglwdWJsaWMgYm9vbGVhbiBn\nZXRJZ25vcmVDaGFuZ2VzKCkgewoJCXJldHVybiBfcXVlcnkuZ2V0SWdub3Jl\nQ2hhbmdlcygpOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0SWdu\nb3JlQ2hhbmdlcyhib29sZWFuIGlnbm9yZSkgewoJCV9lbS5hc3NlcnROb3RD\nbG9zZUludm9rZWQoKTsKCQlfcXVlcnkuc2V0SWdub3JlQ2hhbmdlcyhpZ25v\ncmUpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8\nWD4gYWRkRmlsdGVyTGlzdGVuZXIoRmlsdGVyTGlzdGVuZXIgbGlzdGVuZXIp\nIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LmFk\nZEZpbHRlckxpc3RlbmVyKGxpc3RlbmVyKTsKCQlyZXR1cm4gdGhpczsKCX0K\nCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHJlbW92ZUZpbHRlckxpc3RlbmVy\nKEZpbHRlckxpc3RlbmVyIGxpc3RlbmVyKSB7CgkJX2VtLmFzc2VydE5vdENs\nb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5yZW1vdmVGaWx0ZXJMaXN0ZW5lcihs\naXN0ZW5lcik7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJcHVibGljIE9wZW5KUEFR\ndWVyeTxYPiBhZGRBZ2dyZWdhdGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0ZW5l\nciBsaXN0ZW5lcikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsK\nCQlfcXVlcnkuYWRkQWdncmVnYXRlTGlzdGVuZXIobGlzdGVuZXIpOwoJCXJl\ndHVybiB0aGlzOwoJfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gcmVt\nb3ZlQWdncmVnYXRlTGlzdGVuZXIoQWdncmVnYXRlTGlzdGVuZXIgbGlzdGVu\nZXIpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1ZXJ5\nLnJlbW92ZUFnZ3JlZ2F0ZUxpc3RlbmVyKGxpc3RlbmVyKTsKCQlyZXR1cm4g\ndGhpczsKCX0KCglwdWJsaWMgQ29sbGVjdGlvbjw/PiBnZXRDYW5kaWRhdGVD\nb2xsZWN0aW9uKCkgewoJCXJldHVybiBfcXVlcnkuZ2V0Q2FuZGlkYXRlQ29s\nbGVjdGlvbigpOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0Q2Fu\nZGlkYXRlQ29sbGVjdGlvbihDb2xsZWN0aW9uIGNvbGwpIHsKCQlfZW0uYXNz\nZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LnNldENhbmRpZGF0ZUNv\nbGxlY3Rpb24oY29sbCk7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJcHVibGljIENs\nYXNzIGdldFJlc3VsdENsYXNzKCkgewoJCUNsYXNzIHJlcyA9IF9xdWVyeS5n\nZXRSZXN1bHRUeXBlKCk7CgkJaWYgKHJlcyAhPSBudWxsKQoJCQlyZXR1cm4g\ncmVzOwoJCXJldHVybiBfcXVlcnkuZ2V0Q2FuZGlkYXRlVHlwZSgpOwoJfQoK\nCXB1YmxpYyBPcGVuSlBBUXVlcnkgc2V0UmVzdWx0Q2xhc3MoQ2xhc3MgY2xz\nKSB7CgkJX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCWlmIChJbXBs\nSGVscGVyLmlzTWFuYWdlZFR5cGUoX2VtLmdldENvbmZpZ3VyYXRpb24oKSwg\nY2xzKSkKCQkJX3F1ZXJ5LnNldENhbmRpZGF0ZVR5cGUoY2xzLCB0cnVlKTsK\nCQllbHNlCgkJCV9xdWVyeS5zZXRSZXN1bHRUeXBlKGNscyk7CgkJcmV0dXJu\nIHRoaXM7Cgl9CgoJcHVibGljIGJvb2xlYW4gaGFzU3ViY2xhc3NlcygpIHsK\nCQlyZXR1cm4gX3F1ZXJ5Lmhhc1N1YmNsYXNzZXMoKTsKCX0KCglwdWJsaWMg\nT3BlbkpQQVF1ZXJ5PFg+IHNldFN1YmNsYXNzZXMoYm9vbGVhbiBzdWJzKSB7\nCgkJX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCUNsYXNzPD8+IGNs\ncyA9IF9xdWVyeS5nZXRDYW5kaWRhdGVUeXBlKCk7CiAgICAgICAgX3F1ZXJ5\nLnNldENhbmRpZGF0ZUV4dGVudChfcXVlcnkuZ2V0QnJva2VyKCkubmV3RXh0\nZW50KGNscywgc3VicykpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBp\nbnQgZ2V0Rmlyc3RSZXN1bHQoKSB7CgkJcmV0dXJuIGFzSW50KF9xdWVyeS5n\nZXRTdGFydFJhbmdlKCkpOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4g\nc2V0Rmlyc3RSZXN1bHQoaW50IHN0YXJ0UG9zaXRpb24pIHsKCQlfZW0uYXNz\nZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJbG9uZyBlbmQ7CgkJaWYgKF9xdWVy\neS5nZXRFbmRSYW5nZSgpID09IExvbmcuTUFYX1ZBTFVFKQoJCQllbmQgPSBM\nb25nLk1BWF9WQUxVRTsKCQllbHNlCgkJCWVuZCA9IHN0YXJ0UG9zaXRpb24K\nICAgICAgICAgICAgICAgICAgICArIChfcXVlcnkuZ2V0RW5kUmFuZ2UoKSAt\nIF9xdWVyeS5nZXRTdGFydFJhbmdlKCkpOwoJCV9xdWVyeS5zZXRSYW5nZShz\ndGFydFBvc2l0aW9uLCBlbmQpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1Ymxp\nYyBpbnQgZ2V0TWF4UmVzdWx0cygpIHsKCQlyZXR1cm4gYXNJbnQoX3F1ZXJ5\nLmdldEVuZFJhbmdlKCkgLSBfcXVlcnkuZ2V0U3RhcnRSYW5nZSgpKTsKCX0K\nCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldE1heFJlc3VsdHMoaW50IG1h\neCkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlsb25nIHN0\nYXJ0ID0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKTsKCQlpZiAobWF4ID09IElu\ndGVnZXIuTUFYX1ZBTFVFKQoJCQlfcXVlcnkuc2V0UmFuZ2Uoc3RhcnQsIExv\nbmcuTUFYX1ZBTFVFKTsKCQllbHNlCgkJCV9xdWVyeS5zZXRSYW5nZShzdGFy\ndCwgc3RhcnQgKyBtYXgpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBP\ncGVuSlBBUXVlcnk8WD4gY29tcGlsZSgpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xv\nc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LmNvbXBpbGUoKTsKCQlyZXR1cm4gdGhp\nczsKCX0KCQoJLyoqCgkgKiBHZXRzIGEgbWFwIG9mIHZhbHVlcyBvZiBlYWNo\nIHBhcmFtZXRlciBpbmRleGVkIGJ5IHRoZWlyIDxlbT5vcmlnaW5hbDwvZW0+\nIGtleS4KCSAqIAoJICogQHJldHVybiBhbiBlbXB0eSBtYXAgaWYgbm8gcGFy\nYW1ldGVyIGlzIGRlY2xhcmVkIGZvciB0aGlzIHF1ZXJ5LgogICAgICogVGhl\nIHVuYm91bmQgcGFyYW1ldGVycyBoYXMgYSB2YWx1ZSBvZiBudWxsIHdoaWNo\nIGlzIGluZGlzdGluZ3Vpc2hhYmxlCiAgICAgKiBmcm9tIHRoZSB2YWx1ZSBi\nZWluZyBib3VuZCB0byBudWxsLgoJICovCglNYXA8T2JqZWN0LE9iamVjdD4g\nZ2V0UGFyYW1ldGVyVmFsdWVzKCkgewoJICAgIE1hcDxPYmplY3QsT2JqZWN0\nPiByZXN1bHQgPSBuZXcgSGFzaE1hcDxPYmplY3QsT2JqZWN0PigpOwoJICAg\nIGlmIChfYm91bmRQYXJhbXMgPT0gbnVsbCkKCSAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKCSAgICBmb3IgKE1hcC5FbnRyeTxPYmplY3QsUGFyYW1ldGVyPD8+\nPiBlbnRyeSA6IGdldERlY2xhcmVkUGFyYW1ldGVycygpLmVudHJ5U2V0KCkp\nIHsKCSAgICAgICAgT2JqZWN0IHBhcmFtS2V5ID0gZW50cnkuZ2V0S2V5KCk7\nCgkgICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGVudHJ5LmdldFZhbHVl\nKCk7CgkgICAgICAgIHJlc3VsdC5wdXQocGFyYW1LZXksIF9ib3VuZFBhcmFt\ncy5nZXQocGFyYW0pKTsKCSAgICB9CgkgICAgcmV0dXJuIHJlc3VsdDsKCX0K\nCQoJcHJpdmF0ZSBPYmplY3QgZXhlY3V0ZSgpIHsKICAgICAgICBpZiAoIWlz\nTmF0aXZlKCkgJiYgX3F1ZXJ5LmdldE9wZXJhdGlvbigpICE9IFF1ZXJ5T3Bl\ncmF0aW9ucy5PUF9TRUxFQ1QpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1zZWxlY3QtcXVlcnki\nLCBnZXRRdWVyeVN0cmluZygpKSwgbnVsbCwgbnVsbCwgZmFsc2UpOwoJCXRy\neSB7CgkJICAgIGxvY2soKTsKICAgICAgICAgICAgTWFwIHBhcmFtcyA9IGdl\ndFBhcmFtZXRlclZhbHVlcygpOwogICAgICAgICAgICBib29sZWFuIHJlZ2lz\ndGVyZWQgPSBwcmVFeGVjdXRlKHBhcmFtcyk7CiAgICAgICAgICAgIE9iamVj\ndCByZXN1bHQgPSBfcXVlcnkuZXhlY3V0ZShwYXJhbXMpOwogICAgICAgICAg\nICBpZiAocmVnaXN0ZXJlZCkgewogICAgICAgICAgICAgICAgcG9zdEV4ZWN1\ndGUocmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\ncmVzdWx0OwoJCX0gZmluYWxseSB7CgkJICAgIHVubG9jaygpOwoJCX0KCX0K\nCQoJcHVibGljIExpc3QgZ2V0UmVzdWx0TGlzdCgpIHsKCQlfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CgkJT2JqZWN0IG9iID0gZXhlY3V0ZSgpOwoJ\nCWlmIChvYiBpbnN0YW5jZW9mIExpc3QpIHsKCQkJTGlzdCByZXQgPSAoTGlz\ndCkgb2I7CgkJCWlmIChyZXQgaW5zdGFuY2VvZiBSZXN1bHRMaXN0KQogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBEZWxlZ2F0aW5nUmVzdWx0TGlzdCgo\nUmVzdWx0TGlzdCkgcmV0LAogICAgICAgICAgICAgICAgICAgICAgICBQZXJz\naXN0ZW5jZUV4Y2VwdGlvbnMuZ2V0Um9sbGJhY2tUcmFuc2xhdG9yKF9lbSkp\nOwoJCQllbHNlCgkJCQlyZXR1cm4gcmV0OwoJCX0KCgkJcmV0dXJuIENvbGxl\nY3Rpb25zLnNpbmdsZXRvbkxpc3Qob2IpOwoJfQoKCS8qKgoJICogRXhlY3V0\nZSBhIHF1ZXJ5IHRoYXQgcmV0dXJucyBhIHNpbmdsZSByZXN1bHQuCgkgKi8K\nCXB1YmxpYyBYIGdldFNpbmdsZVJlc3VsdCgpIHsKCQlfZW0uYXNzZXJ0Tm90\nQ2xvc2VJbnZva2VkKCk7CiAgICAgICAgc2V0SGludCgib3BlbmpwYS5oaW50\nLk9wdGltaXplUmVzdWx0Q291bnQiLCAxKTsgLy8gZm9yIERCMiBvcHRpbWl6\nYXRpb24KCQlMaXN0IHJlc3VsdCA9IGdldFJlc3VsdExpc3QoKTsKCQlpZiAo\ncmVzdWx0ID09IG51bGwgfHwgcmVzdWx0LmlzRW1wdHkoKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1y\nZXN1bHQiLCBnZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAgICAg\nIC5nZXRNZXNzYWdlKCkpOwoJCWlmIChyZXN1bHQuc2l6ZSgpID4gMSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE5vblVuaXF1ZVJlc3VsdEV4Y2VwdGlvbihf\nbG9jLmdldCgibm9uLXVuaXF1ZS1yZXN1bHQiLAogICAgICAgICAgICAgICAg\nICAgIGdldFF1ZXJ5U3RyaW5nKCksIHJlc3VsdC5zaXplKCkpLmdldE1lc3Nh\nZ2UoKSk7CgkJdHJ5IHsKCQkgICAgcmV0dXJuIChYKXJlc3VsdC5nZXQoMCk7\nCgkJfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQiLCBn\nZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAgLmdldE1lc3NhZ2Uo\nKSk7CgkJfQoJfQoKCXB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHsKCQlf\nZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgTWFwPD8sPz4g\ncGFyYW1WYWx1ZXMgPSBnZXRQYXJhbWV0ZXJWYWx1ZXMoKTsKCQlpZiAoX3F1\nZXJ5LmdldE9wZXJhdGlvbigpID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9ERUxF\nVEUpIHsKCQkgICByZXR1cm4gYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0eSgp\nID8gX3F1ZXJ5LmRlbGV0ZUFsbCgpIDogX3F1ZXJ5LmRlbGV0ZUFsbChwYXJh\nbVZhbHVlcykpOwoJCX0KCQlpZiAoX3F1ZXJ5LmdldE9wZXJhdGlvbigpID09\nIFF1ZXJ5T3BlcmF0aW9ucy5PUF9VUERBVEUpIHsKCSAgICAgICByZXR1cm4g\nYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0eSgpID8gX3F1ZXJ5LnVwZGF0ZUFs\nbCgpIDogX3F1ZXJ5LnVwZGF0ZUFsbChwYXJhbVZhbHVlcykpOwoJCX0KICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtdXBkYXRlLWRlbGV0ZS1xdWVyeSIsIGdldFF1ZXJ5U3RyaW5nKCkp\nLCBudWxsLCBudWxsLCBmYWxzZSk7Cgl9CgoJLyoqCgkgKiBDYXN0IHRoZSBz\ncGVjaWZpZWQgbG9uZyBkb3duIHRvIGFuIGludCwgZmlyc3QgY2hlY2tpbmcg\nZm9yIG92ZXJmbG93LgoJICovCglwcml2YXRlIHN0YXRpYyBpbnQgYXNJbnQo\nbG9uZyBsKSB7CgkJaWYgKGwgPiBJbnRlZ2VyLk1BWF9WQUxVRSkKCQkJcmV0\ndXJuIEludGVnZXIuTUFYX1ZBTFVFOwogICAgICAgIGlmIChsIDwgSW50ZWdl\nci5NSU5fVkFMVUUpIC8vIHVubGlrZWx5LCBidXQgd2UgbWlnaHQgYXMgd2Vs\nbCBjaGVjawoJCQlyZXR1cm4gSW50ZWdlci5NSU5fVkFMVUU7CgkJcmV0dXJu\nIChpbnQpIGw7Cgl9CgoJcHVibGljIEZsdXNoTW9kZVR5cGUgZ2V0Rmx1c2hN\nb2RlKCkgewoJCXJldHVybiBFbnRpdHlNYW5hZ2VySW1wbC5mcm9tRmx1c2hC\nZWZvcmVRdWVyaWVzKF9xdWVyeQogICAgICAgICAgICAgICAgLmdldEZldGNo\nQ29uZmlndXJhdGlvbigpLmdldEZsdXNoQmVmb3JlUXVlcmllcygpKTsKCX0K\nCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldEZsdXNoTW9kZShGbHVzaE1v\nZGVUeXBlIGZsdXNoTW9kZSkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9r\nZWQoKTsKCQlfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuc2V0Rmx1\nc2hCZWZvcmVRdWVyaWVzKAogICAgICAgICAgICAgICAgRW50aXR5TWFuYWdl\nckltcGwudG9GbHVzaEJlZm9yZVF1ZXJpZXMoZmx1c2hNb2RlKSk7CgkJcmV0\ndXJuIHRoaXM7Cgl9CgoJcHVibGljIGJvb2xlYW4gaXNOYXRpdmUoKSB7CgkJ\ncmV0dXJuIFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhnZXRMYW5n\ndWFnZSgpKTsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IGNsb3NlQWxs\nKCkgewoJCV9xdWVyeS5jbG9zZUFsbCgpOwoJCXJldHVybiB0aGlzOwoJfQoK\nCXB1YmxpYyBTdHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKE1hcCBwYXJh\nbXMpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldERhdGFTdG9yZUFjdGlvbnMocGFy\nYW1zKTsKCX0KCiAgICBwdWJsaWMgTG9ja01vZGVUeXBlIGdldExvY2tNb2Rl\nKCkgewogICAgICAgIHJldHVybiBfZmV0Y2guZ2V0UmVhZExvY2tNb2RlKCk7\nCiAgICB9CgogICAgcHVibGljIFR5cGVkUXVlcnk8WD4gc2V0TG9ja01vZGUo\nTG9ja01vZGVUeXBlIGxvY2tNb2RlKSB7CiAgICAgICBfZmV0Y2guc2V0UmVh\nZExvY2tNb2RlKGxvY2tNb2RlKTsKICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKCXB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgcmV0dXJuIChf\ncXVlcnkgPT0gbnVsbCkgPyAwIDogX3F1ZXJ5Lmhhc2hDb2RlKCk7Cgl9CgoJ\ncHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewoJCWlmIChv\ndGhlciA9PSB0aGlzKQoJCQlyZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoKG90\naGVyID09IG51bGwpIHx8IChvdGhlci5nZXRDbGFzcygpICE9IHRoaXMuZ2V0\nQ2xhc3MoKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBp\nZiAoX3F1ZXJ5ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCQlyZXR1cm4gX3F1ZXJ5LmVxdWFscygoKFF1ZXJ5SW1wbCkgb3RoZXIpLl9x\ndWVyeSk7Cgl9CgoJLyoqCgkgKiBHZXQgYWxsIHRoZSBhY3RpdmUgaGludHMg\nYW5kIHRoZWlyIHZhbHVlcy4KCSAqIAoJICovCiAgICAvL1RPRE86IEpQQSAy\nLjAgSGludHMgdGhhdCBhcmUgbm90IHNldCB0byBGZXRjaENvbmZpZ3VyYXRp\nb24gCiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2JqZWN0PiBnZXRIaW50cygp\nIHsKICAgICAgICByZXR1cm4gX2hpbnRIYW5kbGVyLmdldEhpbnRzKCk7CiAg\nICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRIaW50KFN0cmlu\nZyBrZXksIE9iamVjdCB2YWx1ZSkgewogICAgICAgIF9lbS5hc3NlcnROb3RD\nbG9zZUludm9rZWQoKTsKICAgICAgICBfaGludEhhbmRsZXIuc2V0SGludChr\nZXksIHZhbHVlKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBw\ndWJsaWMgU2V0PFN0cmluZz4gZ2V0U3VwcG9ydGVkSGludHMoKSB7CiAgICAg\nICAgcmV0dXJuIF9oaW50SGFuZGxlci5nZXRTdXBwb3J0ZWRIaW50cygpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgaW5uZXJtb3N0IGlt\ncGxlbWVudGF0aW9uIHRoYXQgaXMgYW4gaW5zdGFuY2Ugb2YgdGhlIGdpdmVu\nIAogICAgICogY2xhc3MuIAogICAgICogCiAgICAgKiBAdGhyb3dzIFBlcnNp\nc3RlbmNlRXhjZXB0aW9uIGlmIG5vbmUgaW4gdGhlIGRlbGVnYXRlIGNoYWlu\nIGlzIGFuIAogICAgICogaW5zdGFuY2Ugb2YgdGhlIGdpdmVuIGNsYXNzLgog\nICAgICogCiAgICAgKiBAc2luY2UgMi4wLjAKICAgICAqLwogICAgcHVibGlj\nIDxUPiBUIHVud3JhcChDbGFzczxUPiBjbHMpIHsKICAgICAgICBPYmplY3Rb\nXSBkZWxlZ2F0ZXMgPSBuZXcgT2JqZWN0W117X3F1ZXJ5LmdldElubmVybW9z\ndERlbGVnYXRlKCksIAogICAgICAgICAgICBfcXVlcnkuZ2V0RGVsZWdhdGUo\nKSwgX3F1ZXJ5LCB0aGlzfTsKICAgICAgICBmb3IgKE9iamVjdCBvIDogZGVs\nZWdhdGVzKSB7CiAgICAgICAgICAgIGlmIChjbHMuaXNJbnN0YW5jZShvKSkK\nICAgICAgICAgICAgICAgIHJldHVybiAoVClvOwogICAgICAgIH0KICAgICAg\nICB0aHJvdyBuZXcgUGVyc2lzdGVuY2VFeGNlcHRpb24oX2xvYy5nZXQoInVu\nd3JhcC1xdWVyeS1pbnZhbGlkIiwgY2xzKQogICAgICAgICAgICAudG9TdHJp\nbmcoKSwgbnVsbCwgdGhpcywgZmFsc2UpOwogICAgfQogICAgCiAgICAvLyA9\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gUHJlcGFyZWQgUXVl\ncnkgQ2FjaGUgcmVsYXRlZCBtZXRob2RzCiAgICAvLyA9PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PQogICAgCiAgICAvKioKICAgICAqIEludm9rZWQgYmVm\nb3JlIGEgcXVlcnkgaXMgZXhlY3V0ZWQuCiAgICAgKiBJZiB0aGlzIHJlY2Vp\ndmVyIGlzIGNhY2hlZCBhcyBhIHtAbGlua3BsYWluIFByZXBhcmVkUXVlcnkg\ncHJlcGFyZWQgcXVlcnl9CiAgICAgKiB0aGVuIHJlLXBhcmFtZXRlcml6ZXMg\ndGhlIGdpdmVuIHVzZXIgcGFyYW1ldGVycy4gVGhlIGdpdmVuIG1hcCBpcyBj\nbGVhcmVkCiAgICAgKiBhbmQgcmUtcGFyYW1ldGVyaXplZCB2YWx1ZXMgYXJl\nIGZpbGxlZCBpbi4gCiAgICAgKiAKICAgICAqIEBwYXJhbSBwYXJhbXMgdXNl\nciBzdXBwbGllZCBwYXJhbWV0ZXIga2V5LXZhbHVlcy4gQWx3YXlzIHN1cHBs\neSBhIAogICAgICogbm9uLW51bGwgbWFwIGV2ZW4gaWYgdGhlIHVzZXIgaGFz\nIG5vdCBzcGVjaWZpZWQgYW55IHBhcmFtZXRlciwgYmVjYXVzZSAKICAgICAq\nIHRoZSBzYW1lIG1hcCB3aWxsIHRvIGJlIHBvcHVsYXRlZCBieSByZS1wYXJh\nbWV0ZXJpemF0aW9uLgogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYg\ndGhpcyBpbnZvY2F0aW9uIGNhdXNlZCB0aGUgcXVlcnkgYmVpbmcgcmVnaXN0\nZXJlZCBpbiB0aGUKICAgICAqIGNhY2hlLiAKICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHByZUV4ZWN1dGUoTWFwIHBhcmFtcykgewogICAgICAgIFBy\nZXBhcmVkUXVlcnlDYWNoZSBjYWNoZSA9IF9lbS5nZXRQcmVwYXJlZFF1ZXJ5\nQ2FjaGUoKTsKICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkgewogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCA9IF9xdWVyeS5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICBCb29sZWFuIHJlZ2lzdGVyZWQgPSBjYWNoZS5yZWdp\nc3RlcihfaWQsIF9xdWVyeSwgZmV0Y2gpOwogICAgICAgIGJvb2xlYW4gYWxy\nZWFkeUNhY2hlZCA9IChyZWdpc3RlcmVkID09IG51bGwpOwogICAgICAgIFN0\ncmluZyBsYW5nID0gX3F1ZXJ5LmdldExhbmd1YWdlKCk7CiAgICAgICAgUXVl\ncnlTdGF0aXN0aWNzPFN0cmluZz4gc3RhdHMgPSBjYWNoZS5nZXRTdGF0aXN0\naWNzKCk7CiAgICAgICAgaWYgKGFscmVhZHlDYWNoZWQgJiYgTEFOR19QUkVQ\nQVJFRF9TUUwuZXF1YWxzKGxhbmcpKSB7CiAgICAgICAgICAgIFByZXBhcmVk\nUXVlcnkgcHEgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeShfaWQpOwogICAgICAg\nICAgICBpZiAocHEuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIE1hcCByZXAgPSBwcS5yZXBh\ncmFtZXRyaXplKHBhcmFtcywgX2VtLmdldEJyb2tlcigpKTsKICAgICAgICAg\nICAgICAgICAgICBwYXJhbXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAg\nICBwYXJhbXMucHV0QWxsKHJlcCk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW52\nYWxpZGF0ZVByZXBhcmVkUXVlcnkoKTsKICAgICAgICAgICAgICAgICAgICBM\nb2cgbG9nID0gX2VtLmdldENvbmZpZ3VyYXRpb24oKS5nZXRMb2coT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24uTE9HX1JVTlRJTUUpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBsb2cud2Fybih1ZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBzdGF0cy5yZWNvcmRFeGVjdXRpb24o\ncHEuZ2V0T3JpZ2luYWxRdWVyeSgpKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBzdGF0cy5yZWNvcmRFeGVjdXRpb24oX3F1ZXJ5LmdldFF1ZXJ5\nU3RyaW5nKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVnaXN0ZXJl\nZCA9PSBCb29sZWFuLlRSVUU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nSW5pdGlhbGl6ZSB0aGUgcmVnaXN0ZXJlZCBQcmVwYXJlZCBRdWVyeSBmcm9t\nIHRoZSBnaXZlbiBvcGFxdWUgb2JqZWN0LgogICAgICogCiAgICAgKiBAcGFy\nYW0gcmVzdWx0IGFuIG9wYXF1ZSBvYmplY3QgcmVwcmVzZW50aW5nIGV4ZWN1\ndGlvbiByZXN1bHQgb2YgYSBxdWVyeQogICAgICogCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhlIHByZXBhcmVkIHF1ZXJ5IGNhbiBiZSBpbml0aWFsaXpl\nZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHBvc3RFeGVjdXRlKE9i\namVjdCByZXN1bHQpIHsKICAgICAgICBQcmVwYXJlZFF1ZXJ5Q2FjaGUgY2Fj\naGUgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeUNhY2hlKCk7CiAgICAgICAgaWYg\nKGNhY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gY2FjaGUuaW5pdGlhbGl6ZShfaWQs\nIHJlc3VsdCkgIT0gbnVsbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBS\nZW1vdmUgdGhpcyBxdWVyeSBmcm9tIFByZXBhcmVkUXVlcnlDYWNoZS4gCiAg\nICAgKi8KICAgIGJvb2xlYW4gaW52YWxpZGF0ZVByZXBhcmVkUXVlcnkoKSB7\nCiAgICAgICAgUHJlcGFyZWRRdWVyeUNhY2hlIGNhY2hlID0gX2VtLmdldFBy\nZXBhcmVkUXVlcnlDYWNoZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWdub3JlUHJl\ncGFyZWRRdWVyeSgpOwogICAgICAgIHJldHVybiBjYWNoZS5pbnZhbGlkYXRl\nKF9pZCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogSWdub3JlcyB0aGlz\nIHF1ZXJ5IGZyb20gUHJlcGFyZWRRdWVyeUNhY2hlIGJ5IHJlY3JlYXRpbmcg\ndGhlIG9yaWdpbmFsCiAgICAgKiBxdWVyeSBpZiBpdCBoYXMgYmVlbiBjYWNo\nZWQuIAogICAgICovCiAgICB2b2lkIGlnbm9yZVByZXBhcmVkUXVlcnkoKSB7\nCiAgICAgICAgUHJlcGFyZWRRdWVyeSBjYWNoZWQgPSBfZW0uZ2V0UHJlcGFy\nZWRRdWVyeShfaWQpOwogICAgICAgIGlmIChjYWNoZWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIEJyb2tlciBicm9rZXIgPSBfZW0u\nZ2V0QnJva2VyKCk7CiAgICAgICAgLy8gQ3JpdGljYWwgYXNzdW1wdGlvbjog\nT25seSBKUFFMIHF1ZXJpZXMgYXJlIGNhY2hlZCBhbmQgbW9yZSAKICAgICAg\nICAvLyBpbXBvcnRhbnRseSwgdGhlIGlkZW50aWZpZXIgb2YgdGhlIHByZXBh\ncmVkIHF1ZXJ5IGlzIHRoZSBvcmlnaW5hbAogICAgICAgIC8vIEpQUUwgU3Ry\naW5nCiAgICAgICAgU3RyaW5nIEpQUUwgPSBKUFFMUGFyc2VyLkxBTkdfSlBR\nTDsKICAgICAgICBTdHJpbmcganBxbCA9IF9pZDsKICAgICAgICAKICAgICAg\nICBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IG5ld1F1ZXJ5ID0g\nYnJva2VyLm5ld1F1ZXJ5KEpQUUwsIGpwcWwpOwogICAgICAgIG5ld1F1ZXJ5\nLmdldEZldGNoQ29uZmlndXJhdGlvbigpLmNvcHkoX3F1ZXJ5LmdldEZldGNo\nQ29uZmlndXJhdGlvbigpKTsKICAgICAgICBuZXdRdWVyeS5jb21waWxlKCk7\nCiAgICAgICAgX3F1ZXJ5ID0gbmV3IERlbGVnYXRpbmdRdWVyeShuZXdRdWVy\neSwgX2VtLmdldEV4Y2VwdGlvblRyYW5zbGF0b3IoKSk7CiAgICB9CiAgICAK\nICAgIC8vIHBhY2thZ2UgcHJvdGVjdGVkCiAgICBRdWVyeUltcGwgc2V0SWQo\nU3RyaW5nIGlkKSB7CiAgICAgICAgX2lkID0gaWQ7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CiAgICAvLyA9PT09PT09PT09PT09PT09IEVuZCBvZiBQ\ncmVwYXJlZCBRdWVyeSByZWxhdGVkIG1ldGhvZHMgPT09PT09PT09PT09PT09\nPT09PT09CiAgICAKICAgIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2xv\nY2sgIT0gbnVsbCkgCiAgICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAgIH0K\nCiAgICB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVs\nbCkKICAgICAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgCiAg\nICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAg\nIC8vICAgUGFyYW1ldGVyIHByb2Nlc3Npbmcgcm91dGluZXMKICAgIC8vID09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIC8qKgog\nICAgICogQmluZHMgdGhlIHBhcmFtZXRlciBpZGVudGlmaWVkIGJ5IHRoZSBn\naXZlbiBwb3NpdGlvbiB0byB0aGUgZ2l2ZW4gdmFsdWUuCiAgICAgKiBUaGUg\ncGFyYW1ldGVyIGFyZSBib3VuZCB0byBhIHZhbHVlIGluIHRoZSBjb250ZXh0\nIG9mIHRoaXMgcXVlcnkuIAogICAgICogVGhlIHNhbWUgcGFyYW1ldGVyIG1h\neSBiZSBib3VuZCB0byBhIGRpZmZlcmVudCB2YWx1ZSBpbiB0aGUgY29udGV4\ndCBvZiAKICAgICAqIGFub3RoZXIgcXVlcnkuCiAgICAgKiA8YnI+CiAgICAg\nKiBGb3Igbm9uLW5hdGl2ZSBxdWVyaWVzLCB0aGUgZ2l2ZW4gcG9zaXRpb24g\nbXVzdCBiZSBhIHZhbGlkIHBvc2l0aW9uIGluCiAgICAgKiB0aGUgZGVjbGFy\nZWQgcGFyYW1ldGVycy4KICAgICAqIDxicj4KICAgICAqIEFzIG5hdGl2ZSBx\ndWVyaWVzIG1heSBub3QgYmUgcGFyc2VkIGFuZCBoZW5jZSB0aGVpciBkZWNs\nYXJlZCBwYXJhbWV0ZXJzCiAgICAgKiBtYXkgbm90IGJlIGtub3duLCBzZXR0\naW5nIGFuIHBvc2l0aW9uYWwgcGFyYW1ldGVyIGhhcyB0aGUgc2lkZS1lZmZl\nY3QKICAgICAqIG9mIGEgcG9zaXRpb25hbCBwYXJhbWV0ZXIgYmVpbmcgZGVj\nbGFyZWQuCiAgICAgKiAgIAogICAgICogQHBhcmFtIHBvc2l0aW9uIHBvc2l0\naXZlLCBpbnRlZ2VyIHBvc2l0aW9uIG9mIHRoZSBwYXJhbWV0ZXIKICAgICAq\nIEBwYXJhbSB2YWx1ZSBhbiBhc3NpZ25tZW50IGNvbXBhdGlibGUgdmFsdWUK\nICAgICAqIEByZXR1cm4gdGhlIHNhbWUgcXVlcnkgaW5zdGFuY2UKICAgICAq\nIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHBvc2l0aW9u\nIGRvZXMgbm90IGNvcnJlc3BvbmQgdG8gYSBwb3NpdGlvbmFsIAogICAgICog\ncGFyYW1ldGVyIG9mIHRoZSBxdWVyeSBvciBpZiB0aGUgYXJndW1lbnQgaXMg\nb2YgaW5jb3JyZWN0IHR5cGUKICAgICAqLyAgICAKICAgIHB1YmxpYyBPcGVu\nSlBBUXVlcnk8WD4gc2V0UGFyYW1ldGVyKGludCBwb3MsIE9iamVjdCB2YWx1\nZSkgewogICAgICAgIF9xdWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2Vt\nLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHBvcyA8IDEpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24oX2xvYy5nZXQoImlsbGVnYWwtaW5kZXgiLCBwb3MpLmdldE1lc3Nh\nZ2UoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgUGFyYW1ldGVyPD8+\nIHBhcmFtID0gbnVsbDsKICAgICAgICAgICAgaWYgKGlzTmF0aXZlKCkpIHsK\nICAgICAgICAgICAgICAgIHBhcmFtID0gbmV3IFBhcmFtZXRlckltcGw8T2Jq\nZWN0Pihwb3MsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgICAgICBkZWNs\nYXJlUGFyYW1ldGVyKHBvcywgcGFyYW0pOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgcGFyYW0gPSBnZXRQYXJhbWV0ZXIocG9zKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBiaW5kVmFsdWUocGFyYW0sIHZh\nbHVlKTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB0aGUgdmFsdWUgb2Yg\ndGhlIGdpdmVuIHBvc2l0aW9uYWwgcGFyYW1ldGVyIGFmdGVyIGNvbnZlcnNp\nb24gb2YgdGhlCiAgICAgKiBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gVGVt\ncG9yYWwgVHlwZS4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxY\nPiBzZXRQYXJhbWV0ZXIoaW50IHBvc2l0aW9uLCBDYWxlbmRhciB2YWx1ZSwg\nVGVtcG9yYWxUeXBlIHQpIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVy\nKHBvc2l0aW9uLCBjb252ZXJ0VGVtcG9yYWxUeXBlKHZhbHVlLCB0KSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2\nZW4gbmFtZWQgcGFyYW1ldGVyIGFmdGVyIGNvbnZlcnNpb24gb2YgdGhlCiAg\nICAgKiBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gVGVtcG9yYWwgVHlwZS4K\nICAgICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0\nZXIoaW50IHBvc2l0aW9uLCBEYXRlIHZhbHVlLCBUZW1wb3JhbFR5cGUgdHlw\nZSkgewogICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIocG9zaXRpb24sIGNv\nbnZlcnRUZW1wb3JhbFR5cGUodmFsdWUsIHR5cGUpKTsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gRGF0ZSB0byBhIHZh\nbHVlIGNvcnJlc3BvbmRpbmcgdG8gZ2l2ZW4gdGVtcG9yYWwgdHlwZS4KICAg\nICAqLwogICAgT2JqZWN0IGNvbnZlcnRUZW1wb3JhbFR5cGUoRGF0ZSB2YWx1\nZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUp\nIHsKICAgICAgICBjYXNlIERBVEU6CiAgICAgICAgICAgIHJldHVybiB2YWx1\nZTsKICAgICAgICBjYXNlIFRJTUU6CiAgICAgICAgICAgIHJldHVybiBuZXcg\nVGltZSh2YWx1ZS5nZXRUaW1lKCkpOwogICAgICAgIGNhc2UgVElNRVNUQU1Q\nOgogICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcCh2YWx1ZS5nZXRU\naW1lKCkpOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KICAgIH0KCiAgICBPYmplY3QgY29udmVydFRlbXBv\ncmFsVHlwZShDYWxlbmRhciB2YWx1ZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsK\nICAgICAgICByZXR1cm4gY29udmVydFRlbXBvcmFsVHlwZSh2YWx1ZS5nZXRU\naW1lKCksIHR5cGUpOwogICAgfQoKICAgIC8qKgogICAgICogQWZmaXJtcyBp\nZiBkZWNsYXJlZCBwYXJhbWV0ZXJzIHVzZSBwb3NpdGlvbiBpZGVudGlmaWVy\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNQb3NpdGlvbmFsUGFy\nYW1ldGVycygpIHsKICAgICAgICByZXR1cm4gIWdldERlY2xhcmVkUGFyYW1l\ndGVyS2V5cyhJbnRlZ2VyLmNsYXNzKS5pc0VtcHR5KCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZXRzIHRoZSBhcnJheSBvZiBwb3NpdGlvbmFsIHBhcmFt\nZXRlciB2YWx1ZXMuCiAgICAgKiBUaGUgbi10aCBhcnJheSBlbGVtZW50IHJl\ncHJlc2VudHMgKG4rMSktdGggcG9zaXRpb25hbCBwYXJhbWV0ZXIuICAKICAg\nICAqIElmIGEgcGFyYW1ldGVyIGhhcyBiZWVuIGRlY2xhcmVkIGJ1dCBub3Qg\nYm91bmQgdG8gYSB2YWx1ZSB0aGVuCiAgICAgKiB0aGUgdmFsdWUgaXMgbnVs\nbCBhbmQgaGVuY2UgaXMgaW5kaXN0aW5ndWlzaGFibGUgZnJvbSB0aGUgdmFs\ndWUKICAgICAqIGJlaW5nIGFjdHVhbGx5IG51bGwuCiAgICAgKiBJZiB0aGUg\ncGFyYW1ldGVyIGluZGV4aW5nIGlzIG5vdCBjb250aWd1b3VzIHRoZW4gdGhl\nIHVuc3BlY2lmaWVkCiAgICAgKiBwYXJhbWV0ZXJzIGFyZSBjb25zaWRlcmVk\nIGFzIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3RbXSBnZXRQb3Np\ndGlvbmFsUGFyYW1ldGVycygpIHsKICAgICAgICBfcXVlcnkubG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNldDxJbnRlZ2VyPiBwb3NpdGlv\nbmFsS2V5cyA9IGdldERlY2xhcmVkUGFyYW1ldGVyS2V5cyhJbnRlZ2VyLmNs\nYXNzKTsKICAgICAgICAgICAgT2JqZWN0W10gcmVzdWx0ID0gbmV3IE9iamVj\ndFtjYWxjdWxhdGVNYXhLZXkocG9zaXRpb25hbEtleXMpXTsKICAgICAgICAg\nICAgZm9yIChJbnRlZ2VyIHBvcyA6IHBvc2l0aW9uYWxLZXlzKSB7CiAgICAg\nICAgICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQYXJhbWV0ZXIo\ncG9zKTsKICAgICAgICAgICAgICAgIHJlc3VsdFtwb3MuaW50VmFsdWUoKS0x\nXSA9IGlzQm91bmQocGFyYW0pID8gZ2V0UGFyYW1ldGVyVmFsdWUocG9zKSA6\nIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENh\nbGN1bGF0ZSB0aGUgbWF4aW11bSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gc2V0Lgog\nICAgICovCiAgICBpbnQgY2FsY3VsYXRlTWF4S2V5KFNldDxJbnRlZ2VyPiBw\nKSB7CiAgICAgICAgaWYgKHAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIDA7CiAgICAgICAgaW50IG1heCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAg\nICAgIGZvciAoSW50ZWdlciBpIDogcCkKICAgICAgICAgICAgbWF4ID0gTWF0\naC5tYXgobWF4LCBpKTsKICAgICAgICByZXR1cm4gbWF4OwogICAgfQoKICAg\nIC8qKgogICAgICogQmluZHMgdGhlIGdpdmVuIHZhbHVlcyBhcyBwb3NpdGlv\nbmFsIHBhcmFtZXRlcnMuIAogICAgICogVGhlIG4tdGggYXJyYXkgZWxlbWVu\ndCB2YWx1ZSBpcyBzZXQgdG8gYSBQYXJhbWV0ZXIgd2l0aCAobisxKS10aCBw\nb3NpdGlvbmFsIGlkZW50aWZpZXIuICAKICAgICAqLwogICAgcHVibGljIE9w\nZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXJzKE9iamVjdC4uLiBwYXJhbXMp\nIHsKICAgICAgICBfcXVlcnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9lbS5h\nc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNsZWFyQmluZGluZygpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgcGFyYW1zICE9IG51bGwgJiYg\naSA8IHBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgc2V0\nUGFyYW1ldGVyKGkgKyAxLCBwYXJhbXNbaV0pOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHZvaWQgY2xlYXJCaW5kaW5nKCkgewogICAgICAgIGlmIChfYm91\nbmRQYXJhbXMgIT0gbnVsbCkKICAgICAgICAgICAgX2JvdW5kUGFyYW1zLmNs\nZWFyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSB2YWx1ZSBv\nZiBhbGwgdGhlIG5hbWVkIHBhcmFtZXRlcnMuICAKICAgICAqIAogICAgICog\nSWYgYSBwYXJhbWV0ZXIgaGFzIGJlZW4gZGVjbGFyZWQgYnV0IG5vdCBib3Vu\nZCB0byBhIHZhbHVlIHRoZW4KICAgICAqIHRoZSB2YWx1ZSBpcyBudWxsIGFu\nZCBoZW5jZSBpcyBpbmRpc3Rpbmd1aXNoYWJsZSBmcm9tIHRoZSB2YWx1ZQog\nICAgICogYmVpbmcgYWN0dWFsbHkgbnVsbC4KICAgICAqLwogICAgcHVibGlj\nIE1hcDxTdHJpbmcsIE9iamVjdD4gZ2V0TmFtZWRQYXJhbWV0ZXJzKCkgewog\nICAgICAgIF9xdWVyeS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgTWFwPFN0cmluZywgT2JqZWN0PiByZXN1bHQgPSBuZXcgSGFzaE1hcDxT\ndHJpbmcsIE9iamVjdD4oKTsKICAgICAgICAgICAgU2V0PFN0cmluZz4gbmFt\nZWRLZXlzID0gZ2V0RGVjbGFyZWRQYXJhbWV0ZXJLZXlzKFN0cmluZy5jbGFz\ncyk7CiAgICAgICAgICAgIGZvciAoU3RyaW5nIG5hbWUgOiBuYW1lZEtleXMp\nIHsKICAgICAgICAgICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldFBh\ncmFtZXRlcihuYW1lKTsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQobmFt\nZSwgaXNCb3VuZChwYXJhbSkgPyBnZXRQYXJhbWV0ZXJWYWx1ZShuYW1lKSA6\nIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1\nbHQ7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldHMg\ndGhlIHZhbHVlcyBvZiB0aGUgcGFyYW1ldGVycyBmcm9tIHRoZSBnaXZlbiBN\nYXAuCiAgICAgKiBUaGUga2V5cyBvZiB0aGUgZ2l2ZW4gbWFwIGRlc2lnbmF0\nZSB0aGUgbmFtZSBvZiB0aGUgZGVjbGFyZWQgcGFyYW1ldGVyLgogICAgICAK\nICAgICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0\nZXJzKE1hcCBwYXJhbXMpIHsKICAgICAgICBfcXVlcnkuYXNzZXJ0T3Blbigp\nOwogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAg\nICBfcXVlcnkubG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNs\nZWFyQmluZGluZygpOwogICAgICAgICAgICBpZiAocGFyYW1zICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBmb3IgKE1hcC5FbnRyeSBlIDogKFNldDxNYXAu\nRW50cnk+KSBwYXJhbXMuZW50cnlTZXQoKSkKICAgICAgICAgICAgICAgICAg\nICBzZXRQYXJhbWV0ZXIoKFN0cmluZykgZS5nZXRLZXkoKSwgZS5nZXRWYWx1\nZSgpKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgcGFyYW1ldGVyIG9mIHRo\nZSBnaXZlbiBuYW1lIGFuZCB0eXBlLgogICAgICogCiAgICAgKiBAdGhyb3dz\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1ldGVyIG9m\nIHRoZQogICAgICogICAgICAgICBzcGVjaWZpZWQgbmFtZSBkb2VzIG5vdCBl\neGlzdCBvciBpcyBub3QgYXNzaWduYWJsZQogICAgICogICAgICAgICB0byB0\naGUgdHlwZQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24g\naWYgaW52b2tlZCBvbiBhIG5hdGl2ZSBxdWVyeSAKICAgICAqLwogICAgcHVi\nbGljIDxUPiBQYXJhbWV0ZXI8VD4gZ2V0UGFyYW1ldGVyKFN0cmluZyBuYW1l\nLCBDbGFzczxUPiB0eXBlKSB7CiAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFt\nID0gZ2V0UGFyYW1ldGVyKG5hbWUpOwogICAgICAgIGlmIChwYXJhbS5nZXRQ\nYXJhbWV0ZXJUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihwYXJh\nbSArICIgZG9lcyBub3QgbWF0Y2ggdGhlIHJlcXVlc3RlZCB0eXBlICIgKyB0\neXBlKTsKICAgICAgICByZXR1cm4gKFBhcmFtZXRlcjxUPilwYXJhbTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgcG9zaXRpb25hbCBwYXJhbWV0\nZXIgd2l0aCB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHR5cGUuCiAgICAgKiBA\ndGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1l\ndGVyIHdpdGggdGhlCiAgICAgKiAgICAgICAgIHNwZWNpZmllZCBwb3NpdGlv\nbiBkb2VzIG5vdCBleGlzdCBvciBpcyBub3QgYXNzaWduYWJsZQogICAgICog\nICAgICAgICB0byB0aGUgdHlwZQogICAgICogQHRocm93cyBJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24gaWYgaW52b2tlZCBvbiBhIG5hdGl2ZSBxdWVyeSB1bmxl\nc3MKICAgICAqIHRoZSBzYW1lIHBhcmFtZXRlciBwb3NpdGlvbiBpcyBib3Vu\nZCBhbHJlYWR5LgogICAgICovCiAgICBwdWJsaWMgPFQ+IFBhcmFtZXRlcjxU\nPiBnZXRQYXJhbWV0ZXIoaW50IHBvcywgQ2xhc3M8VD4gdHlwZSkgewogICAg\nICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldFBhcmFtZXRlcihwb3MpOwog\nICAgICAgIGlmIChwYXJhbS5nZXRQYXJhbWV0ZXJUeXBlKCkuaXNBc3NpZ25h\nYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbihwYXJhbSArICIgZG9lcyBub3QgbWF0Y2ggdGhl\nIHJlcXVlc3RlZCB0eXBlICIgKyB0eXBlKTsKICAgICAgICByZXR1cm4gKFBh\ncmFtZXRlcjxUPilwYXJhbTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgdmFsdWUgYm91bmQgdG8gdGhlIHBhcmFtZXRlci4KICAgICAqIEBw\nYXJhbSBwYXJhbSBwYXJhbWV0ZXIgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHBh\ncmFtZXRlciB2YWx1ZQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNl\ncHRpb24gaWYgdGhlIHBhcmFtZXRlciBoYXMgbm90IGJlZW4gYmVlbiBib3Vu\nZAogICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYg\ndGhlIHBhcmFtZXRlciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBxdWVyeQog\nICAgICovCiAgICBwdWJsaWMgPFQ+IFQgZ2V0UGFyYW1ldGVyVmFsdWUoUGFy\nYW1ldGVyPFQ+IHApIHsKICAgICAgICBpZiAoIWlzQm91bmQocCkpIHsKICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwYXJhbS1taXNzaW5nIiwgcCwgZ2V0UXVlcnlTdHJpbmcoKSwg\nCiAgICAgICAgICAgICAgIGdldEJvdW5kUGFyYW1ldGVyS2V5cygpKS5nZXRN\nZXNzYWdlKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKFQpX2JvdW5k\nUGFyYW1zLmdldChwKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhl\nIHBhcmFtZXRlcnMgZGVjbGFyZWQgaW4gdGhpcyBxdWVyeS4KICAgICAqLwog\nICAgcHVibGljIFNldDxQYXJhbWV0ZXI8Pz4+IGdldFBhcmFtZXRlcnMoKSB7\nCiAgICAgICAgU2V0PFBhcmFtZXRlcjw/Pj4gcmVzdWx0ID0gbmV3IEhhc2hT\nZXQ8UGFyYW1ldGVyPD8+PigpOwogICAgICAgIHJlc3VsdC5hZGRBbGwoZ2V0\nRGVjbGFyZWRQYXJhbWV0ZXJzKCkudmFsdWVzKCkpOwogICAgICAgIHJldHVy\nbiByZXN1bHQ7CiAgICB9CgogICAgcHVibGljIDxUPiBPcGVuSlBBUXVlcnk8\nWD4gc2V0UGFyYW1ldGVyKFBhcmFtZXRlcjxUPiBwLCBUIGFyZzEpIHsKICAg\nICAgICBiaW5kVmFsdWUoKFBhcmFtZXRlcjxUPilwLCBhcmcxKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5\nPFg+IHNldFBhcmFtZXRlcihQYXJhbWV0ZXI8RGF0ZT4gcCwgRGF0ZSBkYXRl\nLCBUZW1wb3JhbFR5cGUgdHlwZSkgewogICAgICAgIHJldHVybiBzZXRQYXJh\nbWV0ZXIocCwgKERhdGUpY29udmVydFRlbXBvcmFsVHlwZShkYXRlLCB0eXBl\nKSk7CiAgICB9CgogICAgcHVibGljIFR5cGVkUXVlcnk8WD4gc2V0UGFyYW1l\ndGVyKFBhcmFtZXRlcjxDYWxlbmRhcj4gcCwgQ2FsZW5kYXIgY2FsLCBUZW1w\nb3JhbFR5cGUgdHlwZSkgewogICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIo\ncCwgKENhbGVuZGFyKWNvbnZlcnRUZW1wb3JhbFR5cGUoY2FsLCB0eXBlKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHBhcmFtZXRlciBvYmpl\nY3QgY29ycmVzcG9uZGluZyB0byB0aGUgZGVjbGFyZWQgcGFyYW1ldGVyIG9m\nIHRoZSBnaXZlbiBuYW1lLgogICAgICogVGhpcyBtZXRob2QgaXMgbm90IHJl\ncXVpcmVkIHRvIGJlIHN1cHBvcnRlZCBmb3IgbmF0aXZlIHF1ZXJpZXMuCiAg\nICAgKiAKICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nIGlmIHRoZSBwYXJhbWV0ZXIgb2YgdGhlIHNwZWNpZmllZCBuYW1lIGRvZXMg\nbm90IGV4aXN0CiAgICAgKiBAdGhyb3dzIElsbGVnYWxTdGF0ZUV4Y2VwdGlv\nbiBpZiBpbnZva2VkIG9uIGEgbmF0aXZlIHF1ZXJ5CiAgICAgKi8KICAgIHB1\nYmxpYyBQYXJhbWV0ZXI8Pz4gZ2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgaWYgKGlzTmF0aXZlKCkpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgicGFyYW0tbmFt\nZWQtbm9uLW5hdGl2ZSIsIG5hbWUpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAg\nfQogICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldERlY2xhcmVkUGFy\nYW1ldGVycygpLmdldChuYW1lKTsKICAgICAgICBpZiAocGFyYW0gPT0gbnVs\nbCkgewogICAgICAgICAgICBTZXQ8UGFyYW1ldGVyRXhwcmVzc2lvbj4gZXhw\ncyA9IGdldERlY2xhcmVkUGFyYW1ldGVyS2V5cyhQYXJhbWV0ZXJFeHByZXNz\naW9uLmNsYXNzKTsKICAgICAgICAgICAgZm9yIChQYXJhbWV0ZXJFeHByZXNz\naW9uIGUgOiBleHBzKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZS5lcXVh\nbHMoZS5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBl\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoInBhcmFtLW1pc3NpbmctbmFt\nZSIsIAogICAgICAgICAgICAgICAgbmFtZSwgZ2V0UXVlcnlTdHJpbmcoKSwg\nZ2V0RGVjbGFyZWRQYXJhbWV0ZXJLZXlzKCkpLmdldE1lc3NhZ2UoKSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBwYXJhbTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEdldCB0aGUgcG9zaXRpb25hbCBwYXJhbWV0ZXIgd2l0aCB0aGUg\nZ2l2ZW4gcG9zaXRpb24uCiAgICAgKiBUaGUgcGFyYW1ldGVyIG1heSBqdXN0\nIGhhdmUgYmVlbiBkZWNsYXJlZCBhbmQgbm90IGJvdW5kIHRvIGEgdmFsdWUu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBwb3NpdGlvbiBzcGVjaWZpZWQgaW4g\ndGhlIHVzZXIgcXVlcnkuCiAgICAgKiBAcmV0dXJuIHBhcmFtZXRlciBvYmpl\nY3QKICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlm\nIHRoZSBwYXJhbWV0ZXIgd2l0aCB0aGUgZ2l2ZW4gcG9zaXRpb24gZG9lcyBu\nb3QgZXhpc3QKICAgICAqLwogICAgcHVibGljIFBhcmFtZXRlcjw/PiBnZXRQ\nYXJhbWV0ZXIoaW50IHBvcykgewogICAgICAgIFBhcmFtZXRlcjw/PiBwYXJh\nbSA9IGdldERlY2xhcmVkUGFyYW1ldGVycygpLmdldChwb3MpOwogICAgICAg\nIGlmIChwYXJhbSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1taXNzaW5n\nLXBvcyIsIAogICAgICAgICAgICAgICAgcG9zLCBnZXRRdWVyeVN0cmluZygp\nLCBnZXREZWNsYXJlZFBhcmFtZXRlcktleXMoKSkuZ2V0TWVzc2FnZSgpKTsK\nICAgICAgICByZXR1cm4gcGFyYW07CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHZhbHVlIGJvdW5kIHRvIHRoZSBwYXJhbWV0ZXIuCiAgICAg\nKiAKICAgICAqIEBwYXJhbSBuYW1lIG5hbWUgb2YgdGhlIHBhcmFtZXRlcgog\nICAgICogQHJldHVybiBwYXJhbWV0ZXIgdmFsdWUKICAgICAqIAogICAgICog\nQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgdGhpcyBwYXJhbWV0\nZXIgaGFzIG5vdCBiZWVuIGJvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0UGFyYW1ldGVyVmFsdWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBy\nZXR1cm4gX2JvdW5kUGFyYW1zLmdldChnZXRQYXJhbWV0ZXIobmFtZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBib3VuZCB0\nbyB0aGUgcGFyYW1ldGVyLgogICAgICogCiAgICAgKiBAcGFyYW0gcG9zIHBv\nc2l0aW9uIG9mIHRoZSBwYXJhbWV0ZXIKICAgICAqIEByZXR1cm4gcGFyYW1l\ndGVyIHZhbHVlCiAgICAgKiAKICAgICAqIEB0aHJvd3MgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uIGlmIHRoaXMgcGFyYW1ldGVyIGhhcyBub3QgYmVlbiBib3Vu\nZAogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldFBhcmFtZXRlclZhbHVl\nKGludCBwb3MpIHsKICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQ\nYXJhbWV0ZXIocG9zKTsKICAgICAgICBhc3NlcnRCb3VuZChwYXJhbSk7CiAg\nICAgICAgcmV0dXJuIF9ib3VuZFBhcmFtcy5nZXQocGFyYW0pOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIHBhcmFtZXRlciBrZXlzIGJv\ndW5kIHdpdGggdGhpcyBxdWVyeS4KICAgICAqIFBhcmFtZXRlciBrZXkgY2Fu\nIGJlIEludGVnZXIsIFN0cmluZyBvciBhIFBhcmFtZXRlckV4cHJlc3Npb24g\naXRzZWxmCiAgICAgKiBidXQgYWxsIHBhcmFtZXRlcnMga2V5cyBvZiBhIHBh\ncnRpY3VsYXIgcXVlcnkgYXJlIG9mIHRoZSBzYW1lIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTZXQ8Pz4gZ2V0Qm91bmRQYXJhbWV0ZXJLZXlzKCkgewog\nICAgICAgIGlmIChfYm91bmRQYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICBnZXREZWNs\nYXJlZFBhcmFtZXRlcnMoKTsKICAgICAgICBTZXQ8T2JqZWN0PiByZXN1bHQg\nPSBuZXcgSGFzaFNldDxPYmplY3Q+KCk7CiAgICAgICAgZm9yIChNYXAuRW50\ncnk8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+IGVudHJ5IDogX2RlY2xhcmVkUGFy\nYW1zLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgaWYgKGlzQm91bmQoZW50\ncnkuZ2V0VmFsdWUoKSkpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQo\nZW50cnkuZ2V0S2V5KCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nR2V0cyB0aGUgZGVjbGFyZWQgcGFyYW1ldGVyIGtleXMgaW4gdGhlIGdpdmVu\nIHF1ZXJ5LgogICAgICogVGhpcyBpbmZvcm1hdGlvbiBpcyBvbmx5IGF2YWls\nYWJsZSBhZnRlciB0aGUgcXVlcnkgaGFzIGJlZW4gcGFyc2VkLgogICAgICog\nQXMgbmF0aXZlIGxhbmd1YWdlIHF1ZXJpZXMgYXJlIG5vdCBwYXJzZWQsIHRo\naXMgaW5mb3JtYXRpb24gaXMgbm90IGF2YWlsYWJsZSBmb3IgdGhlbS4KICAg\nICAqICAgCiAgICAgKiBAcmV0dXJuIHNldCBvZiBwYXJhbWV0ZXIgaWRlbnRp\nZmllcnMgaW4gYSBwYXJzZWQgcXVlcnkKICAgICAqLwogICAgcHVibGljIFNl\ndDw/PiBnZXREZWNsYXJlZFBhcmFtZXRlcktleXMoKSB7CiAgICAgICAgcmV0\ndXJuIGdldERlY2xhcmVkUGFyYW1ldGVycygpLmtleVNldCgpOwogICAgfQog\nICAgCiAgICBwdWJsaWMgPFQ+IFNldDxUPiBnZXREZWNsYXJlZFBhcmFtZXRl\ncktleXMoQ2xhc3M8VD4ga2V5VHlwZSkgewogICAgICAgIFNldDxUPiByZXN1\nbHQgPSBuZXcgSGFzaFNldDxUPigpOwogICAgICAgIGZvciAoT2JqZWN0IGtl\neSA6IGdldERlY2xhcmVkUGFyYW1ldGVyS2V5cygpKSB7CiAgICAgICAgICAg\nIGlmIChrZXlUeXBlLmlzSW5zdGFuY2Uoa2V5KSkKICAgICAgICAgICAgICAg\nIHJlc3VsdC5hZGQoKFQpa2V5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHJlc3VsdDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBw\nYXJhbWV0ZXIgaW5zdGFuY2VzIGRlY2xhcmVkIGluIHRoaXMgcXVlcnkuCiAg\nICAgKiBBbGwgcGFyYW1ldGVyIGtleXMgYXJlIG9mIHRoZSBzYW1lIHR5cGUu\nIEl0IGlzIG5vdCBhbGxvd2VkIHRvIG1peCBrZXlzIG9mIGRpZmZlcmVudCB0\neXBlCiAgICAgKiBzdWNoIGFzIG5hbWVkIGFuZCBwb3NpdGlvbmFsIGtleXMu\nIAogICAgICogCiAgICAgKiBGb3Igc3RyaW5nLWJhc2VkIHF1ZXJpZXMsIHRo\nZSBwYXJzZXIgc3VwcGxpZXMgdGhlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBk\nZWNsYXJlZCBwYXJhbWV0ZXJzCiAgICAgKiBhcyBhIExpbmtlZE1hcCBvZiBl\neHBlY3RlZCBwYXJhbWV0ZXIgdmFsdWUgdHlwZSBpbmRleGVkIGJ5IHBhcmFt\nZXRlciBpZGVudGlmaWVyLgogICAgICogRm9yIG5vbiBzdHJpbmctYmFzZWQg\ncXVlcmllcyB0aGF0IGEgZmFjYWRlIGl0c2VsZiBtYXkgY29uc3RydWN0IChl\nLmcuIENyaXRlcmlhUXVlcnkpLAogICAgICogdGhlIHBhcmFtZXRlcnMgbXVz\ndCBiZSBkZWNsYXJlZCBieSB0aGUgY2FsbGVyLgogICAgICogVGhpcyByZWNl\naXZlciBjb25zdHJ1Y3RzIGNvbmNyZXRlIFBhcmFtZXRlciBpbnN0YW5jZXMg\nZnJvbSB0aGUgZ2l2ZW4gcGFyYW1ldGVyIGlkZW50aWZpZXJzLgogICAgICog\nCiAgICAgKiBAcmV0dXJuIGEgTWFwIHdoZXJlIHRoZSBrZXkgcmVwcmVzZW50\ncyB0aGUgb3JpZ2luYWwgaWRlbnRpZmllciBvZiB0aGUgcGFyYW1ldGVyIChj\nYW4gYmUgYSBTdHJpbmcsCiAgICAgKiBJbnRlZ2VyIG9yIGEgUGFyYW1ldGVy\nRXhwcmVzc2lvbiBpdHNlbGYpIGFuZCB0aGUgdmFsdWUgaXMgdGhlIGNvbmNy\nZXRlIFBhcmFtZXRlciBpbnN0YW5jZQogICAgICogZWl0aGVyIGNvbnN0cnVj\ndGVkIGFzIGEgcmVzdWx0IG9mIHRoaXMgY2FsbCBvciBzdXBwbGllZCBieSBk\nZWNsYXJpbmcgdGhlIHBhcmFtZXRlciBleHBsaWNpdGx5CiAgICAgKiB2aWEg\ne0BsaW5rcGxhaW4gI2RlY2xhcmVQYXJhbWV0ZXIoUGFyYW1ldGVyKX0uCiAg\nICAgKi8KICAgIHB1YmxpYyBNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+IGdl\ndERlY2xhcmVkUGFyYW1ldGVycygpIHsKICAgICAgICBpZiAoX2RlY2xhcmVk\nUGFyYW1zID09IG51bGwpIHsKICAgICAgICAgICAgX2RlY2xhcmVkUGFyYW1z\nID0gbmV3IEhhc2hNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+KCk7CiAgICAg\nICAgICAgIExpbmtlZE1hcCBwYXJhbVR5cGVzID0gX3F1ZXJ5LmdldFBhcmFt\nZXRlclR5cGVzKCk7CiAgICAgICAgICAgIGZvciAoT2JqZWN0IGtleSA6IHBh\ncmFtVHlwZXMua2V5U2V0KCkpIHsKICAgICAgICAgICAgICAgIFBhcmFtZXRl\ncjw/PiBwYXJhbSA9IG51bGw7CiAgICAgICAgICAgICAgICBDbGFzczw/PiBl\neHBlY3RlZFZhbHVlVHlwZSA9IChDbGFzczw/PilwYXJhbVR5cGVzLmdldChr\nZXkpOwogICAgICAgICAgICAgICAgaWYgKGtleSBpbnN0YW5jZW9mIEludGVn\nZXIpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbSA9IG5ldyBQYXJhbWV0\nZXJJbXBsKChJbnRlZ2VyKWtleSwgZXhwZWN0ZWRWYWx1ZVR5cGUpOwogICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgaW5zdGFuY2VvZiBTdHJpbmcp\nIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbSA9IG5ldyBQYXJhbWV0ZXJJ\nbXBsKChTdHJpbmcpa2V5LCBleHBlY3RlZFZhbHVlVHlwZSk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKGtleSBpbnN0YW5jZW9mIFBhcmFtZXRlcikg\newogICAgICAgICAgICAgICAgICAgIHBhcmFtID0gKFBhcmFtZXRlcjw/Pilr\nZXk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oInBhcmFt\nZXRlciBpZGVudGlmaWVyICIgKyBrZXkgKyAiIHVucmVjb2duaXplZCIpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVjbGFyZVBhcmFt\nZXRlcihrZXksIHBhcmFtKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gX2RlY2xhcmVkUGFyYW1zOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIERlY2xhcmVzIHRoZSBnaXZlbiBwYXJhbWV0ZXIgZm9yIHRo\naXMgcXVlcnkuIAogICAgICogVXNlZCBieSBub24tc3RyaW5nIGJhc2VkIHF1\nZXJpZXMgdGhhdCBhcmUgY29uc3RydWN0ZWQgYnkgdGhlIGZhY2FkZSBpdHNl\nbGYgcmF0aGVyIHRoYW4KICAgICAqIE9wZW5KUEEgcGFyc2luZyB0aGUgcXVl\ncnkgdG8gZGV0ZWN0IHRoZSBkZWNsYXJlZCBwYXJhbWV0ZXJzLgogICAgICog\nCiAgICAgKiBAcGFyYW0ga2V5IHRoaXMgaXMgdGhlIGtleSB0byBpZGVudGlm\neSB0aGUgcGFyYW1ldGVyIGxhdGVyIGluIHRoZSBjb250ZXh0IG9mIHRoaXMg\ncXVlcnkuCiAgICAgKiBWYWxpZCBrZXkgdHlwZXMgYXJlIEludGVnZXIsIFN0\ncmluZyBvciBQYXJhbWV0ZXJFeHByZXNzaW9uIGl0c2VsZi4KICAgICAqIEBw\nYXJhbSB0aGUgcGFyYW1ldGVyIGluc3RhbmNlIHRvIGJlIGRlY2xhcmVkCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGRlY2xhcmVQYXJhbWV0ZXIoT2JqZWN0\nIGtleSwgUGFyYW1ldGVyPD8+IHBhcmFtKSB7CiAgICAgICAgaWYgKF9kZWNs\nYXJlZFBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgICAgIF9kZWNsYXJlZFBh\ncmFtcyA9IG5ldyBIYXNoTWFwPE9iamVjdCwgUGFyYW1ldGVyPD8+PigpOwog\nICAgICAgIH0KICAgICAgICBfZGVjbGFyZWRQYXJhbXMucHV0KGtleSwgcGFy\nYW0pOwogICAgfQoKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUgZ2l2\nZW4gcGFyYW1ldGVyIGlzIGJvdW5kIHRvIGEgdmFsdWUgZm9yIHRoaXMgcXVl\ncnkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQm91bmQoUGFyYW1l\ndGVyPD8+IHBhcmFtKSB7CiAgICAgICAgcmV0dXJuIF9ib3VuZFBhcmFtcyAh\nPSBudWxsICYmIF9ib3VuZFBhcmFtcy5jb250YWluc0tleShwYXJhbSk7CiAg\nICB9CiAgICAKICAgIHZvaWQgYXNzZXJ0Qm91bmQoUGFyYW1ldGVyPD8+IHBh\ncmFtKSB7CiAgICAgICAgaWYgKCFpc0JvdW5kKHBhcmFtKSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJwYXJhbS1ub3QtYm91bmQiLCBwYXJhbSwgZ2V0UXVlcnlTdHJpbmcoKSwg\nCiAgICAgICAgICAgICAgICAgICAgZ2V0Qm91bmRQYXJhbWV0ZXJLZXlzKCkp\nLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAg\nKiBCaW5kcyB0aGUgZ2l2ZW4gdmFsdWUgdG8gdGhlIGdpdmVuIHBhcmFtZXRl\nci4KICAgICAqIFZhbGlkYXRlcyBpZiB0aGUgcGFyYW1ldGVyIGNhbiBhY2Nl\ncHQgdGhlIHZhbHVlIGJ5IGl0cyB0eXBlLgogICAgICovCiAgICB2b2lkIGJp\nbmRWYWx1ZShQYXJhbWV0ZXI8Pz4gcGFyYW0sIE9iamVjdCB2YWx1ZSkgewog\nICAgICAgIGFzc2VydFZhbHVlQXNzaWduYWJsZShwYXJhbSwgdmFsdWUpOwog\nICAgICAgIGlmIChfYm91bmRQYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAg\nX2JvdW5kUGFyYW1zID0gbmV3IEhhc2hNYXA8UGFyYW1ldGVyPD8+LCBPYmpl\nY3Q+KCk7CiAgICAgICAgX2JvdW5kUGFyYW1zLnB1dChwYXJhbSwgdmFsdWUp\nOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFyYW1l\ndGVyKFN0cmluZyBuYW1lLCBDYWxlbmRhciB2YWx1ZSwgVGVtcG9yYWxUeXBl\nIHR5cGUpIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVyKG5hbWUsIGNv\nbnZlcnRUZW1wb3JhbFR5cGUodmFsdWUsIHR5cGUpKTsKICAgIH0KCiAgICBw\ndWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFtZXRlcihTdHJpbmcgbmFt\nZSwgRGF0ZSB2YWx1ZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICBy\nZXR1cm4gc2V0UGFyYW1ldGVyKG5hbWUsIGNvbnZlcnRUZW1wb3JhbFR5cGUo\ndmFsdWUsIHR5cGUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgdGhl\nIHBhcmFtZXRlciBvZiB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4gdmFs\ndWUuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFy\nYW1ldGVyKFN0cmluZyBuYW1lLCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBf\ncXVlcnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9lbS5hc3NlcnROb3RDbG9z\nZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIG5hdGl2ZSBxdWVyaWVzIGNhbiBub3QgaGF2\nZSBuYW1lZCBwYXJhbWV0ZXJzCiAgICAgICAgICAgIGlmIChpc05hdGl2ZSgp\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYW1lZC1wYXJhbXMiLAogICAgICAg\nICAgICAgICAgICAgICAgICBuYW1lLCBnZXRRdWVyeVN0cmluZygpKS50b1N0\ncmluZygpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGJpbmRWYWx1ZShnZXRQYXJhbWV0ZXIobmFtZSksIHZhbHVlKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIGFzc2VydFZhbHVlQXNz\naWduYWJsZShQYXJhbWV0ZXI8Pz4gcGFyYW0sIE9iamVjdCB2KSB7CiAgICAg\nICAgaWYgKHYgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAocGFyYW0uZ2V0\nUGFyYW1ldGVyVHlwZSgpLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0\nKCJwYXJhbS1udWxsLXByaW1pdGl2ZSIsIHBhcmFtKS5nZXRNZXNzYWdlKCkp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICgh\nRmlsdGVycy5jYW5Db252ZXJ0KHYuZ2V0Q2xhc3MoKSwgcGFyYW0uZ2V0UGFy\nYW1ldGVyVHlwZSgpLCB0cnVlKSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS10eXBl\nLW1pc21hdGNoIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgcGFy\nYW0sIGdldFF1ZXJ5U3RyaW5nKCksIHYsIHYuZ2V0Q2xhc3MoKS5nZXROYW1l\nKCksIHBhcmFtLmdldFBhcmFtZXRlclR5cGUoKS5nZXROYW1lKCl9KS5nZXRN\nZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gPT09PT09\nPT09PT09PT09PT09IEVuZCBvZiBQYXJhbWV0ZXIgUHJvY2Vzc2luZyByb3V0\naW5lcyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQp9Cg==\n","encoding":"base64"}

