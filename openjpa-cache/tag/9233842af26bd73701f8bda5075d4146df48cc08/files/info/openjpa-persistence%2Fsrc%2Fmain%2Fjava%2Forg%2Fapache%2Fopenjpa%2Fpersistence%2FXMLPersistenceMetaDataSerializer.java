{"sha":"77b065085c837f4e16bc7ca44d0de04f5187b3ab","node_id":"MDQ6QmxvYjIwNjM2NDo3N2IwNjUwODVjODM3ZjRlMTZiYzdjYTQ0ZDBkZTA0ZjUxODdiM2Fi","size":50052,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/77b065085c837f4e16bc7ca44d0de04f5187b3ab","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmll\nbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZW1iZXI7CmltcG9ydCBq\nYXZhLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25z\nOwppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0\nIGphdmEudXRpbC5Qcm9wZXJ0aWVzOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLkNGTWV0YURhdGFTZXJpYWxpemVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlNvdXJjZVRy\nYWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSmF2\nYVZlcnNpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNs\nYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5G\naWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0\nYURhdGFJbmhlcml0YW5jZUNvbXBhcmF0b3I7CmltcG9ydCBzdGF0aWMgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFNb2Rlcy4qOwoKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFjY2Vzc0NvZGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5PcmRlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlF1ZXJ5TWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLnhtbC5zYXguU0FYRXhjZXB0aW9uOwppbXBvcnQgc2Vy\ncC51dGlsLlN0cmluZ3M7CgovKioKICogU2VyaWFsaXplcyBwZXJzaXN0ZW5j\nZSBtZXRhZGF0YSBiYWNrIHRvIFhNTC4KICogVGhpcyBjbGFzcyBwcm9jZXNz\nZXMgYWxsIG9iamVjdCBsZXZlbCB0YWdzIHRoYXQgYXJlIHN0b3JlLWFnbm9z\ndGljLgogKiBIb3dldmVyLCBpdCBwcm92aWRlcyBob29rcyBmb3IgdGhlIHN1\nYmNsYXNzZXMgdG8gaW5jbHVkZSBzdG9yZS1zcGVjaWZpYwogKiB0YWdzIHRv\nIGJlIHNlcmlhbGl6ZWQgYm90aCBhdCAmbHQ7ZW50aXR5LW1hcHBpbmdzJmd0\nOyBhbmQKICogJmx0O2VudGl0eSZndDsgbGV2ZWwuCiAqCiAqIEBzaW5jZSAw\nLjQuMAogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgWE1MUGVyc2lzdGVuY2VNZXRhRGF0YVNlcmlhbGl6ZXIK\nICAgIGV4dGVuZHMgQ0ZNZXRhRGF0YVNlcmlhbGl6ZXIKICAgIGltcGxlbWVu\ndHMgUGVyc2lzdGVuY2VNZXRhRGF0YUZhY3RvcnkuU2VyaWFsaXplciB7Cgog\nICAgLy8gTk9URTogb3JkZXIgaXMgaW1wb3J0YW50ISB0aGVzZSBjb25zdGFu\ndHMgbXVzdCBiZSBtYWludGFpbmVkIGluCiAgICAvLyBzZXJpYWxpemF0aW9u\nIG9yZGVyLiBjb25zdGFudHMgYXJlIHNwYWNlZCBzbyB0aGF0IHN1YmNsYXNz\nZXMgY2FuCiAgICAvLyBzbGlwIHRhZ3MgaW4tYmV0d2VlbgogICAgcHJvdGVj\ndGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9TRVEgPSAxMDsKICAgIHByb3Rl\nY3RlZCBzdGF0aWMgZmluYWwgaW50IFRZUEVfUVVFUlkgPSAyMDsKICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFRZUEVfTUVUQSA9IDMwOwogICAg\ncHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9DTEFTU19TRVFTID0g\nNDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUWVBFX0NMQVNT\nX1FVRVJJRVMgPSA1MDsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2Nh\nbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFhN\nTFBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyLmNsYXNzKTsKCiAgICBw\ncml2YXRlIGZpbmFsIE9wZW5KUEFDb25maWd1cmF0aW9uIF9jb25mOwogICAg\ncHJpdmF0ZSBNYXA8U3RyaW5nLCBDbGFzc01ldGFEYXRhPiBfbWV0YXMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBMaXN0PiBfcXVlcmllcyA9\nIG51bGw7CiAgICBwcml2YXRlIE1hcDxTdHJpbmcsIExpc3Q+IF9zZXFzID0g\nbnVsbDsKICAgIHByaXZhdGUgaW50IF9tb2RlID0gTU9ERV9OT05FOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9hbm5vcyA9IHRydWU7CiAgICBwcml2YXRlIFNl\ncmlhbGl6YXRpb25Db21wYXJhdG9yIF9jb21wID0gbnVsbDsKCiAgICAvKioK\nICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAg\nICAqLwogICAgcHVibGljIFhNTFBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxp\nemVyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICBfY29u\nZiA9IGNvbmY7CiAgICAgICAgc2V0TG9nKGNvbmYuZ2V0TG9nKE9wZW5KUEFD\nb25maWd1cmF0aW9uLkxPR19NRVRBREFUQSkpOwogICAgICAgIHNldE1vZGUo\nTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVSWSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigp\nIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRvIHNlcmlhbGl6ZSBjb250ZW50IG9yaWdpbmFsbHkgc3Bl\nY2lmaWVkIGluIGFubm90YXRpb25zLgogICAgICogRGVmYXVsdHMgdG8gdHJ1\nZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0U2VyaWFsaXplQW5u\nb3RhdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9hbm5vczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdG8gc2VyaWFsaXplIGNvbnRlbnQgb3Jp\nZ2luYWxseSBzcGVjaWZpZWQgaW4gYW5ub3RhdGlvbnMuCiAgICAgKiBEZWZh\ndWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTZXJp\nYWxpemVBbm5vdGF0aW9ucyhib29sZWFuIGFubm9zKSB7CiAgICAgICAgX2Fu\nbm9zID0gYW5ub3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc2VyaWFs\naXphdGlvbiBtb2RlIGFjY29yZGluZyB0byB0aGUgZXhwZWN0ZWQgZG9jdW1l\nbnQgdHlwZS4gVGhlCiAgICAgKiBtb2RlIGNvbnN0YW50cyBhY3QgYXMgYml0\nIGZsYWdzLCBhbmQgdGhlcmVmb3JlIGNhbiBiZSBjb21iaW5lZC4KICAgICAq\nLwogICAgcHVibGljIGludCBnZXRNb2RlKCkgewogICAgICAgIHJldHVybiBf\nbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzZXJpYWxpemF0aW9u\nIG1vZGUgYWNjb3JkaW5nIHRvIHRoZSBleHBlY3RlZCBkb2N1bWVudCB0eXBl\nLiBUaGUKICAgICAqIG1vZGUgY29uc3RhbnRzIGFjdCBhcyBiaXQgZmxhZ3Ms\nIGFuZCB0aGVyZWZvcmUgY2FuIGJlIGNvbWJpbmVkLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRNb2RlKGludCBtb2RlKSB7CiAgICAgICAgX21vZGUg\nPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNlcmlhbGl6YXRp\nb24gbW9kZSBhY2NvcmRpbmcgdG8gdGhlIGV4cGVjdGVkIGRvY3VtZW50IHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1vZGUoaW50IG1vZGUs\nIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05PTkUp\nCiAgICAgICAgICAgIHNldE1vZGUoTU9ERV9OT05FKTsKICAgICAgICBlbHNl\nIGlmIChvbikKICAgICAgICAgICAgc2V0TW9kZShfbW9kZSB8IG1vZGUpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0TW9kZShfbW9kZSAmIH5tb2Rl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIE92ZXJyaWRlIHRvIG5vdCBvdmVy\nd3JpdGUgYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAg\ncHJvdGVjdGVkIEZpbGUgZ2V0U291cmNlRmlsZShPYmplY3Qgb2JqKSB7CiAg\nICAgICAgRmlsZSBmaWxlID0gc3VwZXIuZ2V0U291cmNlRmlsZShvYmopOwog\nICAgICAgIGlmIChmaWxlID09IG51bGwgfHwgZmlsZS5nZXROYW1lKCkuZW5k\nc1dpdGgoIi5qYXZhIikKICAgICAgICAgICAgfHwgZmlsZS5nZXROYW1lKCku\nZW5kc1dpdGgoIi5jbGFzcyIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICByZXR1cm4gZmlsZTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0\nTW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzTWV0YURh\ndGFNb2RlKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX01FVEEp\nICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRo\nb2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1F1ZXJ5TW9kZSgpIHsKICAgICAg\nICByZXR1cm4gKF9tb2RlICYgTU9ERV9RVUVSWSkgIT0gMDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0\naW5nIHtAbGluayAjZ2V0TW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBi\nb29sZWFuIGlzTWFwcGluZ01vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9k\nZSAmIE1PREVfTUFQUElORykgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAj\nZ2V0TW9kZX0uIFRha2VzIGludG8KICAgICAqIGFjY291bnQgd2hldGhlciBt\nYXBwaW5nIGluZm9ybWF0aW9uIGlzIGxvYWRlZCBmb3IgdGhlIGdpdmVuIGlu\nc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01hcHBp\nbmdNb2RlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBp\nc01hcHBpbmdNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9E\nRV9NQVBQSU5HKSAhPSAwCiAgICAgICAgICAgICYmIChtZXRhLmdldEVtYmVk\nZGluZ01ldGFEYXRhKCkgIT0gbnVsbAogICAgICAgICAgICB8fCAhbWV0YS5p\nc0VtYmVkZGVkT25seSgpKQogICAgICAgICAgICAmJiAobWV0YS5nZXRFbWJl\nZGRpbmdNZXRhRGF0YSgpID09IG51bGwKICAgICAgICAgICAgfHwgaXNNYXBw\naW5nTW9kZShtZXRhLmdldEVtYmVkZGluZ01ldGFEYXRhKCkpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJw\ncmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uIFRha2VzIGludG8KICAgICAqIGFj\nY291bnQgd2hldGhlciBtYXBwaW5nIGluZm9ybWF0aW9uIGlzIGxvYWRlZCBm\nb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBpc01hcHBpbmdNb2RlKFZhbHVlTWV0YURhdGEgdm1kKSB7CiAg\nICAgICAgcmV0dXJuIGlzTWFwcGluZ01vZGUodm1kLmdldEZpZWxkTWV0YURh\ndGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIGEgY2xhc3MgbWV0YSBkYXRhIHRvIHRoZSBzZXQgdG8gYmUg\nc2VyaWFsaXplZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkTWV0YURh\ndGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX21ldGFz\nID09IG51bGwpCiAgICAgICAgICAgIF9tZXRhcyA9IG5ldyBIYXNoTWFwPFN0\ncmluZywgQ2xhc3NNZXRhRGF0YT4oKTsKICAgICAgICBfbWV0YXMucHV0KG1l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSwgbWV0YSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgYSBzZXF1ZW5jZSBtZXRhIGRhdGEgdG8g\ndGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhZGRTZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgTGlzdCBzZXFzID0gbnVsbDsKICAgICAgICBTdHJp\nbmcgZGVmTmFtZSA9IG51bGw7CiAgICAgICAgaWYgKG1ldGEuZ2V0U291cmNl\nU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQogICAgICAgICAgICBkZWZOYW1l\nID0gKChDbGFzcykgbWV0YS5nZXRTb3VyY2VTY29wZSgpKS5nZXROYW1lKCk7\nCiAgICAgICAgaWYgKF9zZXFzID09IG51bGwpCiAgICAgICAgICAgIF9zZXFz\nID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBMaXN0PigpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc2VxcyA9IF9zZXFzLmdldChkZWZOYW1lKTsKCiAgICAg\nICAgaWYgKHNlcXMgPT0gbnVsbCkgewogICAgICAgICAgICBzZXFzID0gbmV3\nIEFycmF5TGlzdCgzKTsgLy8gZG9uJ3QgZXhwZWN0IG1hbnkgc2VxcyAvIGNs\nYXNzCiAgICAgICAgICAgIHNlcXMuYWRkKG1ldGEpOwogICAgICAgICAgICBf\nc2Vxcy5wdXQoZGVmTmFtZSwgc2Vxcyk7CiAgICAgICAgfSBlbHNlIGlmICgh\nc2Vxcy5jb250YWlucyhtZXRhKSkKICAgICAgICAgICAgc2Vxcy5hZGQobWV0\nYSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBxdWVyeSBtZXRhIGRh\ndGEgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBhZGRRdWVyeU1ldGFEYXRhKFF1ZXJ5TWV0YURhdGEgbWV0\nYSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgTGlzdCBxdWVyaWVzID0gbnVsbDsKICAgICAgICBT\ndHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAgICAgaWYgKG1ldGEuZ2V0U291\ncmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQogICAgICAgICAgICBkZWZO\nYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3VyY2VTY29wZSgpKS5nZXROYW1l\nKCk7CiAgICAgICAgaWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAg\nIF9xdWVyaWVzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBMaXN0PigpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgcXVlcmllcyA9IF9xdWVyaWVzLmdldChk\nZWZOYW1lKTsKCiAgICAgICAgaWYgKHF1ZXJpZXMgPT0gbnVsbCkgewogICAg\nICAgICAgICBxdWVyaWVzID0gbmV3IEFycmF5TGlzdCgzKTsgLy8gZG9uJ3Qg\nZXhwZWN0IG1hbnkgcXVlcmllcyAvIGNsYXNzCiAgICAgICAgICAgIHF1ZXJp\nZXMuYWRkKG1ldGEpOwogICAgICAgICAgICBfcXVlcmllcy5wdXQoZGVmTmFt\nZSwgcXVlcmllcyk7CiAgICAgICAgfSBlbHNlIGlmICghcXVlcmllcy5jb250\nYWlucyhtZXRhKSkKICAgICAgICAgICAgcXVlcmllcy5hZGQobWV0YSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgYWxsIGNvbXBvbmVudHMgaW4gdGhl\nIGdpdmVuIHJlcG9zaXRvcnkgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxpemVk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRBbGwoTWV0YURhdGFSZXBv\nc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgaWYgKHJlcG9zID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRh\nIG1ldGEgOiByZXBvcy5nZXRNZXRhRGF0YXMoKSkKICAgICAgICAgICAgYWRk\nTWV0YURhdGEobWV0YSk7CiAgICAgICAgZm9yIChTZXF1ZW5jZU1ldGFEYXRh\nIHNlcSA6IHJlcG9zLmdldFNlcXVlbmNlTWV0YURhdGFzKCkpCiAgICAgICAg\nICAgIGFkZFNlcXVlbmNlTWV0YURhdGEoc2VxKTsKICAgICAgICBmb3IgKFF1\nZXJ5TWV0YURhdGEgcXVlcnkgOiByZXBvcy5nZXRRdWVyeU1ldGFEYXRhcygp\nKQogICAgICAgICAgICBhZGRRdWVyeU1ldGFEYXRhKHF1ZXJ5KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZSBhIG1ldGFkYXRhIGZyb20gdGhlIHNl\ndCB0byBiZSBzZXJpYWxpemVkLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gc2V0CiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZU1ldGFEYXRhKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIHJldHVybiBfbWV0YXMgIT0gbnVsbCAmJiBtZXRh\nICE9IG51bGwKICAgICAgICAgICAgJiYgX21ldGFzLnJlbW92ZShtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpICE9IG51bGw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzZXF1ZW5jZSBtZXRhZGF0YSBmcm9t\nIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHNldAogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVTZXF1ZW5jZU1ldGFEYXRh\nKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfc2VxcyA9\nPSBudWxsIHx8IG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIFN0cmluZyBkZWZOYW1lID0gbnVsbDsKICAgICAgICBp\nZiAobWV0YS5nZXRTb3VyY2VTY29wZSgpIGluc3RhbmNlb2YgQ2xhc3MpCiAg\nICAgICAgICAgIGRlZk5hbWUgPSAoKENsYXNzKSBtZXRhLmdldFNvdXJjZVNj\nb3BlKCkpLmdldE5hbWUoKTsKICAgICAgICBMaXN0IHNlcXMgPSBfc2Vxcy5n\nZXQoZGVmTmFtZSk7CiAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc2Vxcy5yZW1vdmUo\nbWV0YSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAo\nc2Vxcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIF9zZXFzLnJlbW92ZShkZWZO\nYW1lKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbW92ZSBhIHF1ZXJ5IG1ldGFkYXRhIGZyb20gdGhlIHNldCB0byBi\nZSBzZXJpYWxpemVkLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBy\nZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gc2V0CiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURhdGEoUXVlcnlNZXRhRGF0YSBt\nZXRhKSB7CiAgICAgICAgaWYgKF9xdWVyaWVzID09IG51bGwgfHwgbWV0YSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgU3Ry\naW5nIGRlZk5hbWUgPSBudWxsOwogICAgICAgIGlmIChtZXRhLmdldFNvdXJj\nZVNjb3BlKCkgaW5zdGFuY2VvZiBDbGFzcykKICAgICAgICAgICAgZGVmTmFt\nZSA9ICgoQ2xhc3MpIG1ldGEuZ2V0U291cmNlU2NvcGUoKSkuZ2V0TmFtZSgp\nOwogICAgICAgIExpc3QgcXVlcmllcyA9IF9xdWVyaWVzLmdldChkZWZOYW1l\nKTsKICAgICAgICBpZiAocXVlcmllcyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFxdWVyaWVzLnJlbW92ZShtZXRh\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChxdWVy\naWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgX3F1ZXJpZXMucmVtb3ZlKGRl\nZk5hbWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIGFsbCB0aGUgY29tcG9uZW50cyBpbiB0aGUgZ2l2ZW4g\ncmVwb3NpdG9yeSBmcm9tIHRoZSBzZXQgdG8gYmUKICAgICAqIHNlcmlhbGl6\nZWQuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIGFueSBjb21wb25l\nbnRzIHJlbW92ZWQsIGZhbHNlIGlmIG5vbmUgaW4gc2V0CiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZUFsbChNZXRhRGF0YVJlcG9zaXRvcnkg\ncmVwb3MpIHsKICAgICAgICBpZiAocmVwb3MgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBib29sZWFuIHJlbW92ZWQgPSBm\nYWxzZTsKICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMgPSByZXBvcy5n\nZXRNZXRhRGF0YXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1l\ndGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVkIHw9IHJlbW92\nZU1ldGFEYXRhKG1ldGFzW2ldKTsKICAgICAgICBTZXF1ZW5jZU1ldGFEYXRh\nW10gc2VxcyA9IHJlcG9zLmdldFNlcXVlbmNlTWV0YURhdGFzKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZXFzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICByZW1vdmVkIHw9IHJlbW92ZVNlcXVlbmNlTWV0YURhdGEoc2Vx\nc1tpXSk7CiAgICAgICAgUXVlcnlNZXRhRGF0YVtdIHF1ZXJpZXMgPSByZXBv\ncy5nZXRRdWVyeU1ldGFEYXRhcygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgcXVlcmllcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgcmVtb3Zl\nZCB8PSByZW1vdmVRdWVyeU1ldGFEYXRhKHF1ZXJpZXNbaV0pOwogICAgICAg\nIHJldHVybiByZW1vdmVkOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIg\ndGhlIHNldCBvZiBtZXRhZGF0YXMgdG8gYmUgc2VyaWFsaXplZC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgaWYgKF9tZXRh\ncyAhPSBudWxsKQogICAgICAgICAgICBfbWV0YXMuY2xlYXIoKTsKICAgICAg\nICBpZiAoX3NlcXMgIT0gbnVsbCkKICAgICAgICAgICAgX3NlcXMuY2xlYXIo\nKTsKICAgICAgICBpZiAoX3F1ZXJpZXMgIT0gbnVsbCkKICAgICAgICAgICAg\nX3F1ZXJpZXMuY2xlYXIoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCBDb2xsZWN0aW9uIGdldE9iamVjdHMoKSB7CiAgICAgICAgTGlz\ndCBhbGwgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgaWYgKGlzUXVlcnlN\nb2RlKCkpCiAgICAgICAgICAgIGFkZFF1ZXJ5TWV0YURhdGFzKGFsbCk7CiAg\nICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgYWRkU2Vx\ndWVuY2VNZXRhRGF0YXMoYWxsKTsKICAgICAgICBpZiAoKGlzTWV0YURhdGFN\nb2RlKCkgfHwgaXNNYXBwaW5nTW9kZSgpKSAmJiBfbWV0YXMgIT0gbnVsbCkK\nICAgICAgICAgICAgYWxsLmFkZEFsbChfbWV0YXMudmFsdWVzKCkpOwogICAg\nICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgIGFkZFN5c3Rl\nbU1hcHBpbmdFbGVtZW50cyhhbGwpOwogICAgICAgIHNlcmlhbGl6YXRpb25T\nb3J0KGFsbCk7CiAgICAgICAgcmV0dXJuIGFsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCBzeXN0ZW0tbGV2ZWwgbWFwcGluZyBlbGVtZW50cyB0byBi\nZSBzZXJpYWxpemVkLiBEb2VzIG5vdGhpbmcKICAgICAqIGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZFN5c3RlbU1hcHBpbmdF\nbGVtZW50cyhDb2xsZWN0aW9uIHRvU2VyaWFsaXplKSB7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTb3J0IHRoZSBnaXZlbiBjb2xsZWN0aW9uIG9mIG9iamVj\ndHMgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHNlcmlhbGl6YXRpb25Tb3J0KExpc3Qgb2JqcykgewogICAgICAgIGlmIChv\nYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBpZiAoX2NvbXAgPT0gbnVsbCkKICAgICAgICAgICAg\nX2NvbXAgPSBuZXdTZXJpYWxpemF0aW9uQ29tcGFyYXRvcigpOwogICAgICAg\nIENvbGxlY3Rpb25zLnNvcnQob2JqcywgX2NvbXApOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IGNvbXBhcmF0b3IgZm9yIG9yZGVyaW5n\nIG9iamVjdHMgdGhhdCBhcmUgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFNlcmlhbGl6YXRpb25Db21wYXJhdG9yIG5ld1Nlcmlh\nbGl6YXRpb25Db21wYXJhdG9yKCkgewogICAgICAgIHJldHVybiBfY29tcDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBzZXF1ZW5jZSBtZXRhZGF0YSB0\nbyB0aGUgZ2l2ZW4gbWV0YWRhdGFzIGNvbGxlY3Rpb24uCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRTZXF1ZW5jZU1ldGFEYXRhcyhDb2xsZWN0aW9u\nIGFsbCkgewogICAgICAgIGlmIChfc2VxcyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGZvciAoTWFwLkVudHJ5IGVudHJ5IDogX3Nl\ncXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBpZiAoZW50cnkuZ2V0S2V5\nKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGFsbC5hZGRBbGwoKExpc3Qp\nIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAgICBlbHNlIGlmIChfbWV0\nYXMgPT0gbnVsbCB8fCAhX21ldGFzLmNvbnRhaW5zS2V5KGVudHJ5LmdldEtl\neSgpKSkKICAgICAgICAgICAgICAgIGFsbC5hZGQobmV3IENsYXNzU2Vxcygo\nTGlzdDxTZXF1ZW5jZU1ldGFEYXRhPikKICAgICAgICAgICAgICAgICAgICBl\nbnRyeS5nZXRWYWx1ZSgpKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHF1ZXJ5IG1ldGFkYXRhIHRvIHRoZSBnaXZlbiBtZXRhZGF0\nYXMgY29sbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFF1\nZXJ5TWV0YURhdGFzKENvbGxlY3Rpb24gYWxsKSB7CiAgICAgICAgaWYgKF9x\ndWVyaWVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nZm9yIChNYXAuRW50cnkgZW50cnkgOiBfcXVlcmllcy5lbnRyeVNldCgpKSB7\nCiAgICAgICAgICAgIGlmIChlbnRyeS5nZXRLZXkoKSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgYWxsLmFkZEFsbCgoTGlzdCkgZW50cnkuZ2V0VmFsdWUo\nKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKF9tb2RlID09IE1PREVfUVVFUlkg\nfHwgX21ldGFzID09IG51bGwKICAgICAgICAgICAgICAgIHx8ICFfbWV0YXMu\nY29udGFpbnNLZXkoZW50cnkuZ2V0S2V5KCkpKQogICAgICAgICAgICAgICAg\nYWxsLmFkZChuZXcgQ2xhc3NRdWVyaWVzKChMaXN0PFF1ZXJ5TWV0YURhdGE+\nKQogICAgICAgICAgICAgICAgICAgIGVudHJ5LmdldFZhbHVlKCkpKTsKICAg\nICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9p\nZCBzZXJpYWxpemUoQ29sbGVjdGlvbiBvYmplY3RzKQogICAgICAgIHRocm93\ncyBTQVhFeGNlcHRpb24gewogICAgICAgIC8vIGNvcHkgY29sbGVjdGlvbiB0\nbyBhdm9pZCBtdXRhdGlvbgogICAgICAgIE9iamVjdCBtZXRhOwogICAgICAg\nIGJvb2xlYW4gdW5pcXVlID0gdHJ1ZTsKICAgICAgICBib29sZWFuIGZpZWxk\nQWNjZXNzID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBwcm9wZXJ0eUFjY2Vz\ncyA9IGZhbHNlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXQgPSBvYmplY3Rz\nLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspIHsKICAgICAgICAgICAgbWV0\nYSA9IGl0Lm5leHQoKTsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKG1ldGEp\nKSB7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfTUVUQToKICAgICAgICAg\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIGNscyA9IChDbGFzc01ldGFEYXRh\nKSBtZXRhOwogICAgICAgICAgICAgICAgICAgIGlmIChBY2Nlc3NDb2RlLmlz\nRmllbGQoY2xzLmdldEFjY2Vzc1R5cGUoKSkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZpZWxkQWNjZXNzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5QWNjZXNz\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAg\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBpZiAo\ndW5pcXVlICYmIGdldFBhY2thZ2UoKSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBzZXRQYWNrYWdlKGdldFBhY2thZ2UobWV0YSkpOwogICAg\nICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVuaXF1ZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICB1bmlxdWUgPSBnZXRQYWNrYWdlKCkuZXF1YWxzKGdl\ndFBhY2thZ2UobWV0YSkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nIXVuaXF1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFBhY2th\nZ2UobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBzZXJpYWxpemVOYW1lc3BhY2VBdHRyaWJ1\ndGVzKCk7CiAgICAgICAgc3RhcnRFbGVtZW50KCJlbnRpdHktbWFwcGluZ3Mi\nKTsKICAgICAgICBpZiAoZ2V0UGFja2FnZSgpICE9IG51bGwpIHsKICAgICAg\nICAgICAgc3RhcnRFbGVtZW50KCJwYWNrYWdlIik7CiAgICAgICAgICAgIGFk\nZFRleHQoZ2V0UGFja2FnZSgpKTsKICAgICAgICAgICAgZW5kRWxlbWVudCgi\ncGFja2FnZSIpOwogICAgICAgIH0KICAgICAgICBpZiAoZmllbGRBY2Nlc3Mg\nIT0gcHJvcGVydHlBY2Nlc3MpIC8vIGkuZS4gb25seSBvbmUKICAgICAgICB7\nCiAgICAgICAgICAgIGludCBkZWYgPSBnZXRDb25maWd1cmF0aW9uKCkuZ2V0\nTWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAg\nIGdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0RGVmYXVs\ndEFjY2Vzc1R5cGUoKTsKICAgICAgICAgICAgU3RyaW5nIGFjY2VzcyA9IG51\nbGw7CiAgICAgICAgICAgIGlmIChmaWVsZEFjY2VzcyAmJiBBY2Nlc3NDb2Rl\nLmlzUHJvcGVydHkoZGVmKSkKICAgICAgICAgICAgICAgIGFjY2VzcyA9ICJG\nSUVMRCI7CiAgICAgICAgICAgIGVsc2UgaWYgKHByb3BlcnR5QWNjZXNzICYm\nIEFjY2Vzc0NvZGUuaXNGaWVsZChkZWYpKQogICAgICAgICAgICAgICAgYWNj\nZXNzID0gIlBST1BFUlRZIjsKICAgICAgICAgICAgaWYgKGFjY2VzcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBzdGFydEVsZW1lbnQoImFjY2VzcyIp\nOwogICAgICAgICAgICAgICAgYWRkVGV4dChhY2Nlc3MpOwogICAgICAgICAg\nICAgICAgZW5kRWxlbWVudCgiYWNjZXNzIik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgZm9yIChPYmplY3Qgb2JqIDogb2JqZWN0cykgewog\nICAgICAgICAgICBpbnQgdHlwZSA9IHR5cGUob2JqKTsKICAgICAgICAgICAg\nc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfTUVU\nQToKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVDbGFzcygoQ2xhc3NN\nZXRhRGF0YSkgb2JqLCBmaWVsZEFjY2VzcwogICAgICAgICAgICAgICAgICAg\nICAgICAmJiBwcm9wZXJ0eUFjY2Vzcyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfU0VROgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHNlcmlhbGl6ZVNlcXVlbmNlKChTZXF1ZW5jZU1ldGFE\nYXRhKSBvYmopOwogICAgICAgICAgICAgICAgY2FzZSBUWVBFX1FVRVJZOgog\nICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZVF1ZXJ5KChRdWVyeU1ldGFE\nYXRhKSBvYmopOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBUWVBFX0NMQVNTX1FVRVJJRVM6CiAgICAgICAgICAg\nICAgICAgICAgZm9yIChRdWVyeU1ldGFEYXRhIHF1ZXJ5IDogKChDbGFzc1F1\nZXJpZXMpIG9iaikKICAgICAgICAgICAgICAgICAgICAgICAgLmdldFF1ZXJp\nZXMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplUXVlcnko\ncXVlcnkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBUWVBFX0NMQVNTX1NFUVM6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZm9yIChTZXF1ZW5jZU1ldGFEYXRhIHNlcSA6ICgoQ2xhc3NTZXFzKSBv\nYmopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2VxdWVuY2Vz\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVTZXF1\nZW5jZShzZXEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nYXBwaW5nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxp\nemVTeXN0ZW1NYXBwaW5nRWxlbWVudChvYmopOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVu\nZEVsZW1lbnQoImVudGl0eS1tYXBwaW5ncyIpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRQYWNrYWdlKE9iamVjdCBv\nYmopIHsKICAgICAgICBpbnQgdHlwZSA9IHR5cGUob2JqKTsKICAgICAgICBz\nd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBUWVBFX01FVEE6CiAg\nICAgICAgICAgICAgICByZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZSgo\nKENsYXNzTWV0YURhdGEpIG9iaikuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY2FzZSBUWVBFX1FVRVJZ\nOgogICAgICAgICAgICBjYXNlIFRZUEVfU0VROgogICAgICAgICAgICBjYXNl\nIFRZUEVfQ0xBU1NfUVVFUklFUzoKICAgICAgICAgICAgY2FzZSBUWVBFX0NM\nQVNTX1NFUVM6CiAgICAgICAgICAgICAgICBTb3VyY2VUcmFja2VyIHN0ID0g\nKFNvdXJjZVRyYWNrZXIpIG9iajsKICAgICAgICAgICAgICAgIGlmIChzdC5n\nZXRTb3VyY2VTY29wZSgpIGluc3RhbmNlb2YgQ2xhc3MpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoKENsYXNz\nKSBzdC5nZXRTb3VyY2VTY29wZSgpKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSB0eXBlIGNvbnN0YW50IGZvciB0aGUgZ2l2ZW4gb2JqZWN0\nIGJhc2VkIG9uIGl0cyBydW50aW1lCiAgICAgKiBjbGFzcy4gSWYgdGhlIHJ1\nbnRpbWUgY2xhc3MgZG9lcyBub3QgY29ycmVzcG9uZCB0byBhbnkgb2YgdGhl\nIGtub3duCiAgICAgKiB0eXBlcyB0aGVuIHJldHVybnMgLTEuIFRoaXMgY2Fu\nIGhhcHBlbiBmb3IgdGFncwogICAgICogdGhhdCBhcmUgbm90IGhhbmRsZWQg\nYXQgdGhpcyBzdG9yZS1hZ25vc3RpYyBsZXZlbC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGludCB0eXBlKE9iamVjdCBvKSB7CiAgICAgICAgaWYgKG8gaW5z\ndGFuY2VvZiBDbGFzc01ldGFEYXRhKQogICAgICAgICAgICByZXR1cm4gVFlQ\nRV9NRVRBOwogICAgICAgIGlmIChvIGluc3RhbmNlb2YgUXVlcnlNZXRhRGF0\nYSkKICAgICAgICAgICAgcmV0dXJuIFRZUEVfUVVFUlk7CiAgICAgICAgaWYg\nKG8gaW5zdGFuY2VvZiBTZXF1ZW5jZU1ldGFEYXRhKQogICAgICAgICAgICBy\nZXR1cm4gVFlQRV9TRVE7CiAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBDbGFz\nc1F1ZXJpZXMpCiAgICAgICAgICAgIHJldHVybiBUWVBFX0NMQVNTX1FVRVJJ\nRVM7CiAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBDbGFzc1NlcXMpCiAgICAg\nICAgICAgIHJldHVybiBUWVBFX0NMQVNTX1NFUVM7CiAgICAgICAgcmV0dXJu\nIC0xOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIG5hbWVzcGFj\nZSBhdHRyaWJ1dGVzCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxp\nemVOYW1lc3BhY2VBdHRyaWJ1dGVzKCkKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgICAgICBhZGRBdHRyaWJ1dGUoInhtbG5zIiwgImh0dHA6\nLy9qYXZhLnN1bi5jb20veG1sL25zL3BlcnNpc3RlbmNlL29ybSIpOwogICAg\nICAgIGFkZEF0dHJpYnV0ZSgieG1sbnM6eHNpIiwgImh0dHA6Ly93d3cudzMu\nb3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIik7CiAgICAgICAgYWRkQXR0\ncmlidXRlKCJ4c2k6c2NoZW1hTG9jYXRpb24iLAogICAgICAgICAgICAiaHR0\ncDovL2phdmEuc3VuLmNvbS94bWwvbnMvcGVyc2lzdGVuY2Uvb3JtIG9ybV8y\nXzAueHNkIik7CiAgICAgICAgYWRkQXR0cmlidXRlKCJ2ZXJzaW9uIiwgIjIu\nMCIpOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHVua25vd24g\nbWFwcGluZyBlbGVtZW50IGF0IHN5c3RlbSBsZXZlbC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplU3lzdGVtTWFwcGluZ0VsZW1lbnQo\nT2JqZWN0IG9iaikKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBxdWVyeSBtZXRhZGF0YS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1ZXJ5KFF1ZXJ5\nTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoIV9hbm5vcyAmJiBtZXRhLmdldFNvdXJjZVR5cGUoKSA9\nPSBtZXRhLlNSQ19BTk5PVEFUSU9OUykKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5p\nc0luZm9FbmFibGVkKCkpIHsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0U291\ncmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQogICAgICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoInNlci1jbHMtcXVlcnkiLAogICAgICAgICAg\nICAgICAgICAgIG1ldGEuZ2V0U291cmNlU2NvcGUoKSwgbWV0YS5nZXROYW1l\nKCkpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9nLmlu\nZm8oX2xvYy5nZXQoInNlci1xdWVyeSIsIG1ldGEuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgfQoKICAgICAgICBhZGRDb21tZW50cyhtZXRhKTsKICAgICAgICBh\nZGRBdHRyaWJ1dGUoIm5hbWUiLCBtZXRhLmdldE5hbWUoKSk7CiAgICAgICAg\nYWRkQXR0cmlidXRlKCJxdWVyeSIsIG1ldGEuZ2V0UXVlcnlTdHJpbmcoKSk7\nCiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyht\nZXRhLmdldExhbmd1YWdlKCkpKSB7CiAgICAgICAgICAgIGlmIChtZXRhLmdl\ndFJlc3VsdFR5cGUoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgYWRkQXR0\ncmlidXRlKCJyZXN1bHQtY2xhc3MiLCBtZXRhLmdldFJlc3VsdFR5cGUoKS5n\nZXROYW1lKCkpOwogICAgICAgICAgICBzdGFydEVsZW1lbnQoIm5hbWVkLW5h\ndGl2ZS1xdWVyeSIpOwogICAgICAgICAgICBzZXJpYWxpemVRdWVyeUhpbnRz\nKG1ldGEpOwogICAgICAgICAgICBlbmRFbGVtZW50KCJuYW1lZC1uYXRpdmUt\ncXVlcnkiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFydEVs\nZW1lbnQoIm5hbWVkLXF1ZXJ5Iik7CiAgICAgICAgICAgIHNlcmlhbGl6ZVF1\nZXJ5SGludHMobWV0YSk7CiAgICAgICAgICAgIGVuZEVsZW1lbnQoIm5hbWVk\nLXF1ZXJ5Iik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2Vy\naWFsaXplIHF1ZXJ5IGhpbnRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nc2VyaWFsaXplUXVlcnlIaW50cyhRdWVyeU1ldGFEYXRhIG1ldGEpCiAgICAg\nICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nW10gaGlu\ndHMgPSBtZXRhLmdldEhpbnRLZXlzKCk7CiAgICAgICAgT2JqZWN0W10gdmFs\ndWVzID0gbWV0YS5nZXRIaW50VmFsdWVzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBoaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoIm5hbWUiLCBoaW50c1tpXSk7CiAgICAgICAgICAgIGFk\nZEF0dHJpYnV0ZSgidmFsdWUiLCBTdHJpbmcudmFsdWVPZih2YWx1ZXNbaV0p\nKTsKICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJxdWVyeS1oaW50Iik7CiAg\nICAgICAgICAgIGVuZEVsZW1lbnQoInF1ZXJ5LWhpbnQiKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxpemUgc2VxdWVuY2UgbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZVNl\ncXVlbmNlKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIV9hbm5vcyAmJiBtZXRhLmdl\ndFNvdXJjZVR5cGUoKSA9PSBtZXRhLlNSQ19BTk5PVEFUSU9OUykKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAg\nICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgIGxv\nZy5pbmZvKF9sb2MuZ2V0KCJzZXItc2VxdWVuY2UiLCBtZXRhLmdldE5hbWUo\nKSkpOwoKICAgICAgICBhZGRDb21tZW50cyhtZXRhKTsKICAgICAgICBhZGRB\ndHRyaWJ1dGUoIm5hbWUiLCBtZXRhLmdldE5hbWUoKSk7CgogICAgICAgIC8v\nIHBhcnNlIG91dCB0aGUgZGF0YXN0b3JlIHNlcXVlbmNlIG5hbWUsIGlmIGFu\neQogICAgICAgIFN0cmluZyBwbHVnaW4gPSBtZXRhLmdldFNlcXVlbmNlUGx1\nZ2luKCk7CiAgICAgICAgU3RyaW5nIGNsc05hbWUgPSBDb25maWd1cmF0aW9u\ncy5nZXRDbGFzc05hbWUocGx1Z2luKTsKICAgICAgICBTdHJpbmcgcHJvcHMg\nPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKHBsdWdpbik7CiAgICAg\nICAgU3RyaW5nIGRzID0gbnVsbDsKICAgICAgICBpZiAocHJvcHMgIT0gbnVs\nbCkgewogICAgICAgICAgICBQcm9wZXJ0aWVzIG1hcCA9IENvbmZpZ3VyYXRp\nb25zLnBhcnNlUHJvcGVydGllcyhwcm9wcyk7CiAgICAgICAgICAgIGRzID0g\nKFN0cmluZykgbWFwLnJlbW92ZSgiU2VxdWVuY2UiKTsKICAgICAgICAgICAg\naWYgKGRzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHByb3BzID0gQ29u\nZmlndXJhdGlvbnMuc2VyaWFsaXplUHJvcGVydGllcyhtYXApOwogICAgICAg\nICAgICAgICAgcGx1Z2luID0gQ29uZmlndXJhdGlvbnMuZ2V0UGx1Z2luKGNs\nc05hbWUsIHByb3BzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgaWYgKGRzICE9IG51bGwpCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgi\nc2VxdWVuY2UtbmFtZSIsIGRzKTsKICAgICAgICBlbHNlIGlmIChwbHVnaW4g\nIT0gbnVsbCAmJiAhU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRS5lcXVh\nbHMKICAgICAgICAgICAgKHBsdWdpbikpCiAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgic2VxdWVuY2UtbmFtZSIsIHBsdWdpbik7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gMCAmJiBtZXRhLmdldEluaXRpYWxW\nYWx1ZSgpICE9IC0xKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImluaXRp\nYWwtdmFsdWUiLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YobWV0\nYS5nZXRJbml0aWFsVmFsdWUoKSkpOwogICAgICAgIGlmIChtZXRhLmdldEFs\nbG9jYXRlKCkgIT0gNTAgJiYgbWV0YS5nZXRBbGxvY2F0ZSgpICE9IC0xKQog\nICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImFsbG9jYXRpb24tc2l6ZSIsCiAg\nICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihtZXRhLmdldEFsbG9jYXRl\nKCkpKTsKCiAgICAgICAgc3RhcnRFbGVtZW50KCJzZXF1ZW5jZS1nZW5lcmF0\nb3IiKTsKICAgICAgICBlbmRFbGVtZW50KCJzZXF1ZW5jZS1nZW5lcmF0b3Ii\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBjbGFzcyBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplQ2xh\nc3MoQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIGFjY2VzcykKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIV9hbm5vcyAm\nJiBtZXRhLmdldFNvdXJjZVR5cGUoKSA9PSBtZXRhLlNSQ19BTk5PVEFUSU9O\nUykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBMb2cgbG9nID0gZ2V0\nTG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAg\nICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJzZXItY2xhc3MiLCBtZXRhKSk7\nCgogICAgICAgIGFkZENvbW1lbnRzKG1ldGEpOwogICAgICAgIGFkZEF0dHJp\nYnV0ZSgiY2xhc3MiLCBnZXRDbGFzc05hbWUobWV0YS5nZXREZXNjcmliZWRU\neXBlKCkuCiAgICAgICAgICAgIGdldE5hbWUoKSkpOwoKICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKQogICAgICAgICAgICAmJiAhbWV0YS5nZXRUeXBl\nQWxpYXMoKS5lcXVhbHMoU3RyaW5ncy5nZXRDbGFzc05hbWUobWV0YS4KICAg\nICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpKSkpCiAgICAgICAgICAgIGFk\nZEF0dHJpYnV0ZSgibmFtZSIsIG1ldGEuZ2V0VHlwZUFsaWFzKCkpOwoKICAg\nICAgICBTdHJpbmcgbmFtZSA9IGdldEVudGl0eUVsZW1lbnROYW1lKG1ldGEp\nOwogICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICBh\nZGRDbGFzc0F0dHJpYnV0ZXMobWV0YSwgYWNjZXNzKTsKICAgICAgICBpZiAo\naXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICBhZGRDbGFzc01hcHBpbmdB\ndHRyaWJ1dGVzKG1ldGEpOwoKICAgICAgICBzdGFydEVsZW1lbnQobmFtZSk7\nCiAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgc2Vy\naWFsaXplQ2xhc3NNYXBwaW5nQ29udGVudChtZXRhKTsKICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgc2VyaWFsaXplSWRDbGFz\ncyhtZXRhKTsKICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAg\nICAgICBzZXJpYWxpemVJbmhlcml0YW5jZUNvbnRlbnQobWV0YSk7CgogICAg\nICAgIGlmIChpc01hcHBpbmdNb2RlKCkpIHsKICAgICAgICAgICAgTGlzdCBz\nZXFzID0gKF9zZXFzID09IG51bGwpID8gbnVsbCA6IF9zZXFzLmdldAogICAg\nICAgICAgICAgICAgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGlmIChzZXFzICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHNlcmlhbGl6YXRpb25Tb3J0KHNlcXMpOwogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZXFzLnNpemUoKTsgaSsrKQogICAg\nICAgICAgICAgICAgICAgIHNlcmlhbGl6ZVNlcXVlbmNlKChTZXF1ZW5jZU1l\ndGFEYXRhKSBzZXFzLmdldChpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpKSB7CiAgICAgICAgICAgIExp\nc3QgcXVlcmllcyA9IChfcXVlcmllcyA9PSBudWxsKSA/IG51bGwgOiBfcXVl\ncmllcy5nZXQKICAgICAgICAgICAgICAgIChtZXRhLmdldERlc2NyaWJlZFR5\ncGUoKS5nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAocXVlcmllcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemF0aW9uU29ydChxdWVy\naWVzKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcXVl\ncmllcy5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgICAgICBzZXJpYWxp\nemVRdWVyeSgoUXVlcnlNZXRhRGF0YSkgcXVlcmllcy5nZXQoaSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAg\nICAgICAgICAgICAgICBzZXJpYWxpemVRdWVyeU1hcHBpbmdzKG1ldGEpOwog\nICAgICAgIH0KCiAgICAgICAgTGlzdDxGaWVsZE1ldGFEYXRhPiBmaWVsZHMg\nPSBuZXcgQXJyYXlMaXN0KEFycmF5cy5hc0xpc3QKICAgICAgICAgICAgKG1l\ndGEuZ2V0RGVmaW5lZEZpZWxkc0luTGlzdGluZ09yZGVyKCkpKTsKICAgICAg\nICBDb2xsZWN0aW9ucy5zb3J0KGZpZWxkcywgbmV3IEZpZWxkQ29tcGFyYXRv\ncigpKTsKCiAgICAgICAgLy8gc2VyaWFsaXplIGF0dHItb3ZlcnJpZGUKICAg\nICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpKSB7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIG9yaWc7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8RmllbGRNZXRhRGF0YT4gaXQg\nPSBmaWVsZHMuaXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgpOykKICAgICAgICAg\nICAgewogICAgICAgICAgICAgICAgZm1kID0gaXQubmV4dCgpOwogICAgICAg\nICAgICAgICAgaWYgKG1ldGEuZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChm\nbWQuZ2V0TmFtZSgpKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICAgICAgb3JpZyA9IG1ldGEuZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKS5nZXRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgICAgIGlmIChzZXJpYWxpemVBdHRyaWJ1dGVPdmVycmlkZShm\nbWQsIG9yaWcpKQogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUF0dHJp\nYnV0ZU92ZXJyaWRlQ29udGVudChmbWQsIG9yaWcpOwogICAgICAgICAgICAg\nICAgaXQucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGlmIChmaWVsZHMuc2l6ZSgpID4gMCAmJiAoaXNNZXRhRGF0YU1vZGUo\nKSB8fCBpc01hcHBpbmdNb2RlKCkpKSB7CiAgICAgICAgICAgIHN0YXJ0RWxl\nbWVudCgiYXR0cmlidXRlcyIpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIG9yaWc7CiAgICAgICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBm\naWVsZHMpIHsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyaW5n\nVHlwZSgpICE9IGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCkuCiAgICAgICAg\nICAgICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgb3JpZyA9IGZtZC5nZXREZWNsYXJpbmdNZXRhRGF0YSgpLmdl\ndERlY2xhcmVkRmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgKGZtZC5n\nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgb3JpZyA9IG51bGw7CiAgICAgICAgICAgICAgICBzZXJpYWxp\nemVGaWVsZChmbWQsIG9yaWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGVuZEVsZW1lbnQoImF0dHJpYnV0ZXMiKTsKICAgICAgICB9CiAgICAgICAg\nZW5kRWxlbWVudChuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgZW50aXR5IGVsZW1lbnQgbmFtZS4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgU3RyaW5nIGdldEVudGl0eUVsZW1lbnROYW1lKENsYXNzTWV0\nYURhdGEgbWV0YSkgewogICAgICAgIHN3aXRjaCAoZ2V0RW50aXR5VGFnKG1l\ndGEpKSB7CiAgICAgICAgICAgIGNhc2UgRU5USVRZOgogICAgICAgICAgICAg\nICAgcmV0dXJuICJlbnRpdHkiOwogICAgICAgICAgICBjYXNlIEVNQkVEREFC\nTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gImVtYmVkZGFibGUiOwogICAg\nICAgICAgICBjYXNlIE1BUFBFRF9TVVBFUkNMQVNTOgogICAgICAgICAgICAg\nICAgcmV0dXJuICJtYXBwZWQtc3VwZXJjbGFzcyI7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBNZXRhRGF0YVRhZyBmb3IgdGhlIGdpdmVuIGNsYXNzIG1l\ndGEgZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgTWV0YURhdGFU\nYWcgZ2V0RW50aXR5VGFnKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIC8vIEBFbWJlZGRhYmxlIGNsYXNzZXMgY2FuJ3QgZGVjbGFyZSBJZCBmaWVs\nZHMKICAgICAgICBpZiAobWV0YS5pc0VtYmVkZGVkT25seSgpICYmIG1ldGEu\nZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICByZXR1cm4gTWV0YURhdGFUYWcuRU1CRUREQUJMRTsKICAgICAgICBpZiAo\nbWV0YS5pc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4gTWV0YURhdGFU\nYWcuRU5USVRZOwogICAgICAgIHJldHVybiBNZXRhRGF0YVRhZy5NQVBQRURf\nU1VQRVJDTEFTUzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBjbGFzcyBh\ndHRyaWJ1dGVzLgogICAgICoKICAgICAqIEBwYXJhbSBhY2Nlc3Mgd2hldGhl\nciB0byB3cml0ZSBhY2Nlc3MKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZENsYXNzQXR0cmlidXRlcyhDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4g\nYWNjZXNzKSB7CiAgICAgICAgaWYgKCFhY2Nlc3MpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBpbnQgZGVmID0gZ2V0Q29uZmlndXJhdGlvbigpLmdl\ndE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdl\ndE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0RGVmYXVsdEFj\nY2Vzc1R5cGUoKTsKICAgICAgICBpZiAoQWNjZXNzQ29kZS5pc0ZpZWxkKG1l\ndGEuZ2V0QWNjZXNzVHlwZSgpKQogICAgICAgICAgICAmJiBBY2Nlc3NDb2Rl\nLmlzUHJvcGVydHkoZGVmKSkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJh\nY2Nlc3MiLCAiRklFTEQiKTsKICAgICAgICBlbHNlIGlmIChBY2Nlc3NDb2Rl\nLmlzUHJvcGVydHkobWV0YS5nZXRBY2Nlc3NUeXBlKCkpCiAgICAgICAgICAg\nICYmIEFjY2Vzc0NvZGUuaXNGaWVsZChkZWYpKQogICAgICAgICAgICBhZGRB\ndHRyaWJ1dGUoImFjY2VzcyIsICJQUk9QRVJUWSIpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIG1hcHBpbmcgYXR0cmlidXRlcyBmb3IgdGhlIGdpdmVu\nIGNsYXNzLiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdAogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBhZGRDbGFzc01hcHBpbmdBdHRyaWJ1dGVzKENsYXNz\nTWV0YURhdGEgbWFwcGluZykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9u\nIHsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBpZC1jbGFzcy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZUlkQ2xhc3MoQ2xh\nc3NNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24g\newogICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpICE9IENsYXNz\nTWV0YURhdGEuSURfQVBQTElDQVRJT04KICAgICAgICAgICAgfHwgbWV0YS5p\nc09wZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIENsYXNzTWV0YURhdGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpOwogICAgICAgIENsYXNzIG9pZCA9IG1ldGEuZ2V0T2JqZWN0\nSWRUeXBlKCk7CiAgICAgICAgaWYgKG9pZCAhPSBudWxsICYmIChzdXAgPT0g\nbnVsbCB8fCBvaWQgIT0gc3VwLmdldE9iamVjdElkVHlwZSgpKSkgewogICAg\nICAgICAgICBhZGRBdHRyaWJ1dGUoImNsYXNzIiwgZ2V0Q2xhc3NOYW1lKG9p\nZC5nZXROYW1lKCkpKTsKICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJpZC1j\nbGFzcyIpOwogICAgICAgICAgICBlbmRFbGVtZW50KCJpZC1jbGFzcyIpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBjbGFz\ncyBtYXBwaW5nIGNvbnRlbnQuIERvZXMgbm90aGluZyBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFzc01hcHBp\nbmdDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykKICAgICAgICB0aHJv\nd3MgU0FYRXhjZXB0aW9uIHsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlh\nbGl6ZSBpbmhlcml0YW5jZSBjb250ZW50LiBEb2VzIG5vdGhpbmcgYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplSW5o\nZXJpdGFuY2VDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlcmlhbGl6ZSBxdWVyeSBtYXBwaW5ncy4gRG9lcyBub3RoaW5nIGJ5IGRl\nZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZVF1\nZXJ5TWFwcGluZ3MoQ2xhc3NNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93\ncyBTQVhFeGNlcHRpb24gewogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFs\naXplIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHNlcmlhbGl6ZUZpZWxkKEZpZWxkTWV0YURhdGEgZm1kLCBGaWVsZE1ldGFE\nYXRhIG9yaWcpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5N\nQU5BR0VfUEVSU0lTVEVOVAogICAgICAgICAgICAmJiAhZm1kLmlzRXhwbGlj\naXQoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBhZGRDb21tZW50\ncyhmbWQpOwogICAgICAgIGFkZEF0dHJpYnV0ZSgibmFtZSIsIGZtZC5nZXRO\nYW1lKCkpOwoKICAgICAgICBTdHJpbmcgc3RyYXRlZ3kgPSBudWxsOwogICAg\nICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXQgPSBnZXRTdHJhdGVneShm\nbWQpOwogICAgICAgIFZhbHVlTWV0YURhdGEgY2FzY2FkZXMgPSBudWxsOwog\nICAgICAgIGlmIChmbWQuaXNQcmltYXJ5S2V5KCkgJiYgc3RyYXQgPT0gUGVy\nc2lzdGVuY2VTdHJhdGVneS5FTUJFRERFRCkKICAgICAgICAgICAgc3RyYXRl\nZ3kgPSAiZW1iZWRkZWQtaWQiOwogICAgICAgIGVsc2UgaWYgKGZtZC5pc1By\naW1hcnlLZXkoKSkKICAgICAgICAgICAgc3RyYXRlZ3kgPSAiaWQiOwogICAg\nICAgIGVsc2UgaWYgKGZtZC5pc1ZlcnNpb24oKSkKICAgICAgICAgICAgc3Ry\nYXRlZ3kgPSAidmVyc2lvbiI7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIHN3aXRjaCAoc3RyYXQpIHsKICAgICAgICAgICAgICAgIGNhc2UgVFJBTlNJ\nRU5UOgogICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gInRyYW5zaWVu\ndCI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEJBU0lDOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBhZGRCYXNpY0F0\ndHJpYnV0ZXMoZm1kKTsKICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9\nICJiYXNpYyI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEVNQkVEREVEOgogICAgICAgICAgICAgICAgICAgIHN0\ncmF0ZWd5ID0gImVtYmVkZGVkIjsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgTUFOWV9PTkU6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGFkZE1hbnlUb09uZUF0dHJpYnV0ZXMoZm1kKTsKICAgICAg\nICAgICAgICAgICAgICBzdHJhdGVneSA9ICJtYW55LXRvLW9uZSI7CiAgICAg\nICAgICAgICAgICAgICAgY2FzY2FkZXMgPSBmbWQ7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9ORV9PTkU6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGFkZE9uZVRvT25lQXR0cmlidXRlcyhmbWQp\nOwogICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gIm9uZS10by1vbmUi\nOwogICAgICAgICAgICAgICAgICAgIGNhc2NhZGVzID0gZm1kOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPTkVf\nTUFOWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWRkT25lVG9NYW55QXR0cmli\ndXRlcyhmbWQpOwogICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gIm9u\nZS10by1tYW55IjsKICAgICAgICAgICAgICAgICAgICBjYXNjYWRlcyA9IGZt\nZC5nZXRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE1BTllfTUFOWToKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgYWRkTWFueVRvTWFueUF0dHJpYnV0ZXMoZm1kKTsKICAgICAgICAg\nICAgICAgICAgICBzdHJhdGVneSA9ICJtYW55LXRvLW1hbnkiOwogICAgICAg\nICAgICAgICAgICAgIGNhc2NhZGVzID0gZm1kLmdldEVsZW1lbnQoKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRUxFTV9DT0xMOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBhZGRFbGVtZW50Q29s\nbGVjdGlvbkF0dHJpYnV0ZXMoZm1kKTsKICAgICAgICAgICAgICAgICAgICBz\ndHJhdGVneSA9ICJlbGVtZW50LWNvbGxlY3Rpb24iOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChp\nc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgICAgICBhZGRTdHJhdGVneU1h\ncHBpbmdBdHRyaWJ1dGVzKGZtZCk7CiAgICAgICAgfQogICAgICAgIGlmIChp\nc01hcHBpbmdNb2RlKGZtZCkpCiAgICAgICAgICAgIGFkZEZpZWxkTWFwcGlu\nZ0F0dHJpYnV0ZXMoZm1kLCBvcmlnKTsKCiAgICAgICAgc3RhcnRFbGVtZW50\nKHN0cmF0ZWd5KTsKICAgICAgICBpZiAoZm1kLmdldE9yZGVyRGVjbGFyYXRp\nb24oKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgib3Jk\nZXItYnkiKTsKICAgICAgICAgICAgaWYgKCEoT3JkZXIuRUxFTUVOVCArICIg\nYXNjIikuZXF1YWxzKGZtZC5nZXRPcmRlckRlY2xhcmF0aW9uKCkpKQogICAg\nICAgICAgICAgICAgYWRkVGV4dChmbWQuZ2V0T3JkZXJEZWNsYXJhdGlvbigp\nKTsKICAgICAgICAgICAgZW5kRWxlbWVudCgib3JkZXItYnkiKTsKICAgICAg\nICB9IGVsc2UgaWYgKGlzTWFwcGluZ01vZGUoZm1kKSkgewogICAgICAgICAg\nICBzZXJpYWxpemVPcmRlckNvbHVtbihmbWQpOwogICAgICAgIH0KICAgICAg\nICBpZiAoaXNNYXBwaW5nTW9kZSgpICYmIGZtZC5nZXRLZXkoKS5nZXRWYWx1\nZU1hcHBlZEJ5KCkgIT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhIG1hcEJ5ID0gZm1kLmdldEtleSgpLmdldFZhbHVlTWFwcGVkQnlNZXRh\nRGF0YSgpOwogICAgICAgICAgICBpZiAoIW1hcEJ5LmlzUHJpbWFyeUtleSgp\nIHx8CiAgICAgICAgICAgICAgICBtYXBCeS5nZXREZWZpbmluZ01ldGFEYXRh\nKCkuZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxlbmd0aCAhPSAxKSB7CiAgICAg\nICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUiLCBmbWQuZ2V0S2V5KCku\nZ2V0VmFsdWVNYXBwZWRCeSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBzdGFydEVsZW1lbnQoIm1hcC1rZXkiKTsKICAgICAgICAgICAgZW5kRWxl\nbWVudCgibWFwLWtleSIpOwogICAgICAgIH0KICAgICAgICBpZiAoaXNNYXBw\naW5nTW9kZShmbWQpKQogICAgICAgICAgICBzZXJpYWxpemVGaWVsZE1hcHBp\nbmdDb250ZW50KGZtZCwgc3RyYXQpOwogICAgICAgIGlmIChjYXNjYWRlcyAh\nPSBudWxsICYmIGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgIHNlcmlh\nbGl6ZUNhc2NhZGVzKGNhc2NhZGVzKTsKICAgICAgICBpZiAoaXNNYXBwaW5n\nTW9kZSgpICYmIHN0cmF0ID09IFBlcnNpc3RlbmNlU3RyYXRlZ3kuRU1CRURE\nRUQpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZm1kLmdl\ndEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBvd25lciA9IGdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAg\nIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0TWV0YURhdGEK\nICAgICAgICAgICAgICAgIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgbWV0\nYS5nZXRFbnZDbGFzc0xvYWRlcigpLCB0cnVlKTsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YSBlb3JpZzsKICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFE\nYXRhIGVmbWQgOiBtZXRhLmdldEZpZWxkcygpKSB7CiAgICAgICAgICAgICAg\nICBlb3JpZyA9IG93bmVyLmdldEZpZWxkKGVmbWQuZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgICAgIGlmIChzZXJpYWxpemVBdHRyaWJ1dGVPdmVycmlkZShl\nZm1kLCBlb3JpZykpCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQXR0\ncmlidXRlT3ZlcnJpZGVDb250ZW50KGVmbWQsIGVvcmlnKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBlbmRFbGVtZW50KHN0cmF0ZWd5KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBtYXBwaW5nIGF0dHJpYnV0ZXMg\nZm9yIHRoZSBnaXZlbiBmaWVsZC4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZEZpZWxkTWFwcGluZ0F0\ndHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgRmllbGRNZXRh\nRGF0YSBvcmlnKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nfQoKICAgIC8qKgogICAgICogQWx3YXlzIHJldHVybnMgZmFsc2UgYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc2VyaWFsaXpl\nQXR0cmlidXRlT3ZlcnJpZGUoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAg\nRmllbGRNZXRhRGF0YSBvcmlnKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGF0dHJpYnV0ZSBvdmVy\ncmlkZSBjb250ZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFs\naXplQXR0cmlidXRlT3ZlcnJpZGVDb250ZW50KEZpZWxkTWV0YURhdGEgZm1k\nLAogICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZykKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUiLCBm\nbWQuZ2V0TmFtZSgpKTsKICAgICAgICBzdGFydEVsZW1lbnQoImF0dHJpYnV0\nZS1vdmVycmlkZSIpOwogICAgICAgIHNlcmlhbGl6ZUF0dHJpYnV0ZU92ZXJy\naWRlTWFwcGluZ0NvbnRlbnQoZm1kLCBvcmlnKTsKICAgICAgICBlbmRFbGVt\nZW50KCJhdHRyaWJ1dGUtb3ZlcnJpZGUiKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNlcmlhbGl6ZSBhdHRyaWJ1dGUgb3ZlcnJpZGUgbWFwcGluZyBjb250\nZW50LiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdCwKICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVNYXBwaW5n\nQ29udGVudAogICAgICAgIChGaWVsZE1ldGFEYXRhIGZtZCwgRmllbGRNZXRh\nRGF0YSBvcmlnKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGNhc2NhZGVzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplQ2FzY2FkZXMoVmFsdWVNZXRh\nRGF0YSB2bWQpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAg\nICAgQ29sbGVjdGlvbjxTdHJpbmc+IGNhc2NhZGVzID0gbnVsbDsKICAgICAg\nICBpZiAodm1kLmdldENhc2NhZGVQZXJzaXN0KCkgPT0gVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAgICBpZiAoY2FzY2Fk\nZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNhc2NhZGVzID0gbmV3IEFy\ncmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgICAgIGNhc2NhZGVzLmFkZCgi\nY2FzY2FkZS1wZXJzaXN0Iik7CiAgICAgICAgfQogICAgICAgIGlmICh2bWQu\nZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9J\nTU1FRElBVEUpIHsKICAgICAgICAgICAgaWYgKGNhc2NhZGVzID09IG51bGwp\nCiAgICAgICAgICAgICAgICBjYXNjYWRlcyA9IG5ldyBBcnJheUxpc3Q8U3Ry\naW5nPigpOwogICAgICAgICAgICBjYXNjYWRlcy5hZGQoImNhc2NhZGUtbWVy\nZ2UiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZtZC5nZXRDYXNjYWRlRGVs\nZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewog\nICAgICAgICAgICBpZiAoY2FzY2FkZXMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGNhc2NhZGVzID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAg\nICAgICAgIGNhc2NhZGVzLmFkZCgiY2FzY2FkZS1yZW1vdmUiKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKHZtZC5nZXRDYXNjYWRlUmVmcmVzaCgpID09IFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpIHsKICAgICAgICAgICAg\naWYgKGNhc2NhZGVzID09IG51bGwpCiAgICAgICAgICAgICAgICBjYXNjYWRl\ncyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgICAgICBjYXNj\nYWRlcy5hZGQoImNhc2NhZGUtcmVmcmVzaCIpOwogICAgICAgIH0KICAgICAg\nICBpZiAodm1kLmdldENhc2NhZGVEZXRhY2goKSA9PSBWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAgIGlmIChjYXNjYWRl\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgY2FzY2FkZXMgPSBuZXcgQXJy\nYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICAgICAgY2FzY2FkZXMuYWRkKCJj\nYXNjYWRlLWRldGFjaCIpOwogICAgICAgIH0KICAgICAgICBpZiAoY2FzY2Fk\nZXMgIT0gbnVsbCAmJiBjYXNjYWRlcy5zaXplKCkgPT0gNSkgLy8gQUxMCiAg\nICAgICAgewogICAgICAgICAgICBjYXNjYWRlcy5jbGVhcigpOwogICAgICAg\nICAgICBjYXNjYWRlcy5hZGQoImNhc2NhZGUtYWxsIik7CiAgICAgICAgfQog\nICAgICAgIGlmIChjYXNjYWRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIHN0\nYXJ0RWxlbWVudCgiY2FzY2FkZSIpOwogICAgICAgICAgICBmb3IgKFN0cmlu\nZyBjYXNjYWRlIDogY2FzY2FkZXMpIHsKICAgICAgICAgICAgICAgIHN0YXJ0\nRWxlbWVudChjYXNjYWRlKTsKICAgICAgICAgICAgICAgIGVuZEVsZW1lbnQo\nY2FzY2FkZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZW5kRWxlbWVu\ndCgiY2FzY2FkZSIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgc2VyaWFsaXplZCBzdHJhdGVneSBuYW1lLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VTdHJhdGVneSBnZXRTdHJhdGVn\neShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChmbWQuZ2V0TWFu\nYWdlbWVudCgpID09IGZtZC5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0\ndXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuVFJBTlNJRU5UOwoKICAgICAgICBp\nZiAoZm1kLmlzU2VyaWFsaXplZCgpCiAgICAgICAgICAgIHx8IGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAgICAgICAgICAgfHwg\nZm1kLmdldERlY2xhcmVkVHlwZSgpID09IEJ5dGVbXS5jbGFzcwogICAgICAg\nICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNsYXNz\nCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFy\nYWN0ZXJbXS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNl\nU3RyYXRlZ3kuQkFTSUM7CgogICAgICAgIEZpZWxkTWV0YURhdGEgbWFwcGVk\nQnk7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAg\nICAgICAgaWYgKGZtZC5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuRU1CRURERUQ7CiAgICAg\nICAgICAgICAgICBpZiAoZm1kLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5P\nTkVfT05FOwogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGludmVy\nc2VzID0gZm1kLmdldEludmVyc2VNZXRhRGF0YXMoKTsKICAgICAgICAgICAg\nICAgIGlmIChpbnZlcnNlcy5sZW5ndGggPT0gMSAmJgogICAgICAgICAgICAg\nICAgICAgIGludmVyc2VzWzBdLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDICYmCiAgICAgICAgICAgICAgICAgICAgaW52ZXJzZXNbMF0uZ2V0TWFw\ncGVkQnlNZXRhRGF0YSgpID09IGZtZCkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5Lk9ORV9PTkU7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VT\ndHJhdGVneS5NQU5ZX09ORTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQVJSQVk6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgIGlmIChmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5LkVMRU1fQ09M\nTDsKICAgICAgICAgICAgICAgIG1hcHBlZEJ5ID0gZm1kLmdldE1hcHBlZEJ5\nTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIGlmIChtYXBwZWRCeSA9PSBu\ndWxsIHx8IG1hcHBlZEJ5LmdldFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlBD\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0\nZWd5Lk1BTllfTUFOWTsKICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0\nZW5jZVN0cmF0ZWd5Lk9ORV9NQU5ZOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5PSUQ6CiAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VT\ndHJhdGVneS5FTUJFRERFRDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5LkJBU0lDOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBiYXNpYyBhdHRy\naWJ1dGVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQmFzaWNBdHRy\naWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBTQVhF\neGNlcHRpb24gewogICAgICAgIGlmICghZm1kLmlzSW5EZWZhdWx0RmV0Y2hH\ncm91cCgpKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImZldGNoIiwgIkxB\nWlkiKTsKICAgICAgICBpZiAoZm1kLmdldE51bGxWYWx1ZSgpID09IEZpZWxk\nTWV0YURhdGEuTlVMTF9FWENFUFRJT04pCiAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgib3B0aW9uYWwiLCAiZmFsc2UiKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBtYW55LXRvLW9uZSBhdHRyaWJ1dGVzLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkTWFueVRvT25lQXR0cmlidXRlcyhGaWVsZE1ldGFE\nYXRhIGZtZCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoIWZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAg\nICAgYWRkQXR0cmlidXRlKCJmZXRjaCIsICJMQVpZIik7CiAgICAgICAgaWYg\nKGZtZC5nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1ldGFEYXRhLk5VTExfRVhD\nRVBUSU9OKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm9wdGlvbmFsIiwg\nImZhbHNlIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgb25lLXRvLW9u\nZSBhdHRyaWJ1dGVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkT25l\nVG9PbmVBdHRyaWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRo\ncm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmICghZm1kLmlzSW5EZWZh\ndWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImZl\ndGNoIiwgIkxBWlkiKTsKICAgICAgICBpZiAoZm1kLmdldE51bGxWYWx1ZSgp\nID09IEZpZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04pCiAgICAgICAgICAg\nIGFkZEF0dHJpYnV0ZSgib3B0aW9uYWwiLCAiZmFsc2UiKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBvbmUtdG8tbWFueSBhdHRyaWJ1dGVzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkT25lVG9NYW55QXR0cmlidXRlcyhG\naWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQog\nICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImZldGNoIiwgIkVBR0VSIik7CiAg\nICAgICAgYWRkVGFyZ2V0RW50aXR5QXR0cmlidXRlKGZtZCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgbWFueS10by1tYW55IGF0dHJpYnV0ZXMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRNYW55VG9NYW55QXR0cmlidXRl\ncyhGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgp\nKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImZldGNoIiwgIkVBR0VSIik7\nCiAgICAgICAgYWRkVGFyZ2V0RW50aXR5QXR0cmlidXRlKGZtZCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgZWxlbWVudC1jb2xsZWN0aW9uIGF0dHJp\nYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRFbGVtZW50Q29s\nbGVjdGlvbkF0dHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAg\ndGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZtZC5pc0luRGVm\nYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJm\nZXRjaCIsICJFQUdFUiIpOwogICAgICAgIGFkZFRhcmdldEVudGl0eUF0dHJp\nYnV0ZShmbWQpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgdGFyZ2V0\nLWVudGl0eSBhdHRyaWJ1dGUgdG8gY29sbGVjdGlvbiBhbmQgbWFwIGZpZWxk\ncyB0aGF0IGRvCiAgICAgKiBub3QgdXNlIGdlbmVyaWNzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkVGFyZ2V0RW50aXR5QXR0cmlidXRlKEZpZWxk\nTWV0YURhdGEgZm1kKSAKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsK\nICAgICAgICBNZW1iZXIgbWVtYmVyID0gZm1kLmdldEJhY2tpbmdNZW1iZXIo\nKTsKICAgICAgICBDbGFzc1tdIHR5cGVzOwogICAgICAgIGlmIChtZW1iZXIg\naW5zdGFuY2VvZiBGaWVsZCkKICAgICAgICAgICAgdHlwZXMgPSBKYXZhVmVy\nc2lvbnMuZ2V0UGFyYW1ldGVyaXplZFR5cGVzKChGaWVsZCkgbWVtYmVyKTsK\nICAgICAgICBlbHNlIGlmIChtZW1iZXIgaW5zdGFuY2VvZiBNZXRob2QpCiAg\nICAgICAgICAgIHR5cGVzID0gSmF2YVZlcnNpb25zLmdldFBhcmFtZXRlcml6\nZWRUeXBlcygoTWV0aG9kKSBtZW1iZXIpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgdHlwZXMgPSBuZXcgQ2xhc3NbMF07CgogICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgaWYgKHR5\ncGVzLmxlbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgidGFyZ2V0LWVudGl0eSIsIGZtZC5nZXRFbGVtZW50KCkuCiAgICAg\nICAgICAgICAgICAgICAgICAgIGdldERlY2xhcmVkVHlwZSgpLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgaWYgKHR5cGVzLmxlbmd0\naCAhPSAyKQogICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgidGFy\nZ2V0LWVudGl0eSIsIGZtZC5nZXRFbGVtZW50KCkuCiAgICAgICAgICAgICAg\nICAgICAgICAgIGdldERlY2xhcmVkVHlwZSgpLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXJpYWxpemUgZmllbGQgbWFwcGluZyBjb250ZW50OyB0aGlzIHdp\nbGwgYmUgY2FsbGVkIGJlZm9yZQogICAgICoge0BsaW5rICNzZXJpYWxpemVW\nYWx1ZU1hcHBpbmdDb250ZW50fS4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZUZpZWxkTWFw\ncGluZ0NvbnRlbnQoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgUGVyc2lz\ndGVuY2VTdHJhdGVneSBzdHJhdGVneSkKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBtYXBwaW5nIGF0\ndHJpYnV0ZXMgZm9yIHN0cmF0ZWd5LiBTZXRzIG1hcHBlZC1ieSBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRTdHJhdGVneU1h\ncHBpbmdBdHRyaWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRo\ncm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmIChmbWQuZ2V0TWFwcGVk\nQnkoKSAhPSBudWxsKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm1hcHBl\nZC1ieSIsIGZtZC5nZXRNYXBwZWRCeSgpKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBPcmRlciBjb2x1bW4gaXMgbm90IHByb2Nlc3NlZCBhcyBtZXRh\nIGRhdGEsIGluc3RlYWQgaXQKICAgICAqIGNhbiBiZSBwcm9jZXNzZWQgYXMg\nbWFwcGluZyBkYXRhIGlmIGluIG1hcHBpbmcgbW9kZS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplT3JkZXJDb2x1bW4oRmllbGRNZXRh\nRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIG9yZGVyZWQgc2V0IG9mIHtA\nbGluayBTZXF1ZW5jZU1ldGFEYXRhfXMgd2l0aCBhCiAgICAgKiBjb21tb24g\nY2xhc3Mgc2NvcGUuCiAgICAgKgogICAgICogQGF1dGhvciBTdGVwaGVuIEtp\nbQogICAgICogQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIENsYXNzU2VxcwogICAgICAgIGltcGxlbWVu\ndHMgU291cmNlVHJhY2tlciwgQ29tcGFyYWJsZTxDbGFzc1NlcXM+LAogICAg\nICAgIENvbXBhcmF0b3I8U2VxdWVuY2VNZXRhRGF0YT4gewoKICAgICAgICBw\ncml2YXRlIGZpbmFsIFNlcXVlbmNlTWV0YURhdGFbXSBfc2VxczsKCiAgICAg\nICAgcHVibGljIENsYXNzU2VxcyhMaXN0PFNlcXVlbmNlTWV0YURhdGE+IHNl\ncXMpIHsKICAgICAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCB8fCBzZXFzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbigpOwoKICAgICAgICAgICAgX3NlcXMgPSAoU2VxdWVuY2VNZXRh\nRGF0YVtdKSBzZXFzLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgU2Vx\ndWVuY2VNZXRhRGF0YVtzZXFzLnNpemUoKV0pOwogICAgICAgICAgICBBcnJh\neXMuc29ydChfc2VxcywgdGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgU2VxdWVuY2VNZXRhRGF0YVtdIGdldFNlcXVlbmNlcygpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9zZXFzOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogQ29tcGFyZSBzZXF1ZW5jZSBtZXRhZGF0YSBvbiBuYW1lLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShTZXF1ZW5j\nZU1ldGFEYXRhIG8xLCBTZXF1ZW5jZU1ldGFEYXRhIG8yKSB7CiAgICAgICAg\nICAgIHJldHVybiBvMS5nZXROYW1lKCkuY29tcGFyZVRvKG8yLmdldE5hbWUo\nKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgRmlsZSBnZXRTb3VyY2VG\naWxlKCkgewogICAgICAgICAgICByZXR1cm4gX3NlcXNbMF0uZ2V0U291cmNl\nRmlsZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRT\nb3VyY2VTY29wZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZXFzWzBdLmdl\ndFNvdXJjZVNjb3BlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50\nIGdldFNvdXJjZVR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfc2Vxc1sw\nXS5nZXRTb3VyY2VUeXBlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIGdldFJlc291cmNlTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9zZXFzWzBdLmdldFJlc291cmNlTmFtZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBnZXRMaW5lTnVtYmVyKCkgewogICAgICAgICAgICBy\nZXR1cm4gX3NlcXNbMF0uZ2V0TGluZU51bWJlcigpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBnZXRDb2xOdW1iZXIoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfc2Vxc1swXS5nZXRDb2xOdW1iZXIoKTsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgcHVibGljIGludCBjb21wYXJlVG8oQ2xhc3NTZXFz\nIG90aGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAg\nICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGlmIChvdGhlciA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAg\nICBDbGFzcyBzY29wZSA9IChDbGFzcykgZ2V0U291cmNlU2NvcGUoKTsKICAg\nICAgICAgICAgQ2xhc3Mgb3Njb3BlID0gKENsYXNzKSBvdGhlci5nZXRTb3Vy\nY2VTY29wZSgpOwogICAgICAgICAgICByZXR1cm4gc2NvcGUuZ2V0TmFtZSgp\nLmNvbXBhcmVUbyhvc2NvcGUuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIG9yZGVyZWQgc2V0IG9mIHtA\nbGluayBRdWVyeU1ldGFEYXRhfXMgd2l0aCBhCiAgICAgKiBjb21tb24gY2xh\nc3Mgc2NvcGUuCiAgICAgKgogICAgICogQGF1dGhvciBTdGVwaGVuIEtpbQog\nICAgICogQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIENsYXNzUXVlcmllcwogICAgICAgIGltcGxlbWVu\ndHMgU291cmNlVHJhY2tlciwgQ29tcGFyYWJsZTxDbGFzc1F1ZXJpZXM+LAog\nICAgICAgIENvbXBhcmF0b3I8UXVlcnlNZXRhRGF0YT4gewoKICAgICAgICBw\ncml2YXRlIGZpbmFsIFF1ZXJ5TWV0YURhdGFbXSBfcXVlcmllczsKCiAgICAg\nICAgcHVibGljIENsYXNzUXVlcmllcyhMaXN0PFF1ZXJ5TWV0YURhdGE+IHF1\nZXJpZXMpIHsKICAgICAgICAgICAgaWYgKHF1ZXJpZXMgPT0gbnVsbCB8fCBx\ndWVyaWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbigpOwoKICAgICAgICAgICAgX3F1ZXJpZXMgPSAo\nUXVlcnlNZXRhRGF0YVtdKSBxdWVyaWVzLnRvQXJyYXkKICAgICAgICAgICAg\nICAgIChuZXcgUXVlcnlNZXRhRGF0YVtxdWVyaWVzLnNpemUoKV0pOwogICAg\nICAgICAgICBBcnJheXMuc29ydChfcXVlcmllcywgdGhpcyk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgUXVlcnlNZXRhRGF0YVtdIGdldFF1ZXJpZXMo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmllczsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIENvbXBhcmUgcXVlcnkgbWV0YWRhdGEu\nIE5vcm1hbCBxdWVyaWVzIGFwcGVhciBiZWZvcmUgbmF0aXZlIHF1ZXJpZXMu\nCiAgICAgICAgICogSWYgdGhlIGdpdmVuIHF1ZXJpZXMgdXNlIHNhbWUgbGFu\nZ3VhZ2UsIHRoZW4gdGhlaXIgbmFtZXMgYXJlCiAgICAgICAgICogY29tcGFy\nZWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIGludCBjb21wYXJlKFF1\nZXJ5TWV0YURhdGEgbzEsIFF1ZXJ5TWV0YURhdGEgbzIpIHsKICAgICAgICAg\nICAgLy8gbm9ybWFsIHF1ZXJpZXMgYmVmb3JlIG5hdGl2ZQogICAgICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFscyhvMS5nZXRMYW5ndWFnZSgpLCBv\nMi5nZXRMYW5ndWFnZSgpKSkgewogICAgICAgICAgICAgICAgaWYgKFF1ZXJ5\nTGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhvMS5nZXRMYW5ndWFnZSgpKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIG8xLmdldE5hbWUoKS5jb21wYXJl\nVG8obzIuZ2V0TmFtZSgpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBG\naWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcXVl\ncmllc1swXS5nZXRTb3VyY2VGaWxlKCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgT2JqZWN0IGdldFNvdXJjZVNjb3BlKCkgewogICAgICAgICAgICBy\nZXR1cm4gX3F1ZXJpZXNbMF0uZ2V0U291cmNlU2NvcGUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBpbnQgZ2V0U291cmNlVHlwZSgpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9xdWVyaWVzWzBdLmdldFNvdXJjZVR5cGUoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVzb3VyY2VOYW1l\nKCkgewogICAgICAgICAgICByZXR1cm4gX3F1ZXJpZXNbMF0uZ2V0UmVzb3Vy\nY2VOYW1lKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldExp\nbmVOdW1iZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmllc1swXS5n\nZXRMaW5lTnVtYmVyKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50\nIGdldENvbE51bWJlcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9xdWVyaWVz\nWzBdLmdldENvbE51bWJlcigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBjb21wYXJlVG8oQ2xhc3NRdWVyaWVzIG90aGVyKSB7CiAgICAgICAg\nICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJu\nIDA7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBDbGFzcyBzY29wZSA9IChD\nbGFzcykgZ2V0U291cmNlU2NvcGUoKTsKICAgICAgICAgICAgQ2xhc3Mgb3Nj\nb3BlID0gKENsYXNzKSBvdGhlci5nZXRTb3VyY2VTY29wZSgpOwogICAgICAg\nICAgICByZXR1cm4gc2NvcGUuZ2V0TmFtZSgpLmNvbXBhcmVUbyhvc2NvcGUu\nZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb21wYXJlcyBjbGFzZXMsIHNlcXVlbmNlcywgYW5kIHF1ZXJpZXMgdG8gb3Jk\nZXIgdGhlbSBmb3Igc2VyaWFsaXphdGlvbi4KICAgICAqIFBsYWNlcyBzZXF1\nZW5jZXMgZmlyc3QsIHRoZW4gY2xhc3NlcywgdGhlbiBxdWVyaWVzLiBTZXF1\nZW5jZXMgYW5kCiAgICAgKiBxdWVyaWVzIGFyZSBvcmRlcmVkIGFscGhhYmV0\naWNhbGx5IGJ5IG5hbWUuIENsYXNzZXMgYXJlIHBsYWNlZCBpbgogICAgICog\nbGlzdGluZyBvcmRlciwgaW4gaW5oZXJpdGFuY2Ugb3JkZXIgd2l0aGluIHRo\nYXQsIGFuZCBpbiBhbHBoYWJldGljYWwKICAgICAqIG9yZGVyIHdpdGhpbiB0\naGF0LgogICAgICoKICAgICAqIEBhdXRob3IgU3RlcGhlbiBLaW0KICAgICAq\nLwogICAgcHJvdGVjdGVkIGNsYXNzIFNlcmlhbGl6YXRpb25Db21wYXJhdG9y\nCiAgICAgICAgZXh0ZW5kcyBNZXRhRGF0YUluaGVyaXRhbmNlQ29tcGFyYXRv\nciB7CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmplY3QgbzEsIE9i\namVjdCBvMikgewogICAgICAgICAgICBpZiAobzEgPT0gbzIpCiAgICAgICAg\nICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKG8xID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKG8y\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAg\nICAgICBpbnQgdDEgPSB0eXBlKG8xKTsKICAgICAgICAgICAgaW50IHQyID0g\ndHlwZShvMik7CiAgICAgICAgICAgIGlmICh0MSAhPSB0MikKICAgICAgICAg\nICAgICAgIHJldHVybiB0MSAtIHQyOwoKICAgICAgICAgICAgc3dpdGNoICh0\nMSkgewogICAgICAgICAgICAgICAgY2FzZSBUWVBFX01FVEE6CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoKENsYXNzTWV0YURhdGEpIG8x\nLCAoQ2xhc3NNZXRhRGF0YSkgbzIpOwogICAgICAgICAgICAgICAgY2FzZSBU\nWVBFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wYXJl\nKChRdWVyeU1ldGFEYXRhKSBvMSwgKFF1ZXJ5TWV0YURhdGEpIG8yKTsKICAg\nICAgICAgICAgICAgIGNhc2UgVFlQRV9TRVE6CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGNvbXBhcmUoKFNlcXVlbmNlTWV0YURhdGEpIG8xLAogICAg\nICAgICAgICAgICAgICAgICAgICAoU2VxdWVuY2VNZXRhRGF0YSkgbzIpOwog\nICAgICAgICAgICAgICAgY2FzZSBUWVBFX0NMQVNTX1FVRVJJRVM6CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuICgoQ29tcGFyYWJsZSkgbzEpLmNvbXBh\ncmVUbyhvMik7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfQ0xBU1NfU0VR\nUzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChDb21wYXJhYmxlKSBv\nMSkuY29tcGFyZVRvKG8yKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmVVbmtub3duKG8xLCBv\nMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIENvbXBhcmUgdHdvIHVucmVjb2duaXplZCBlbGVtZW50cyBvZiB0\naGUgc2FtZSB0eXBlLiBUaHJvd3MKICAgICAgICAgKiBleGNlcHRpb24gYnkg\nZGVmYXVsdC4KICAgICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQgaW50IGNv\nbXBhcmVVbmtub3duKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcGFyZSBiZXR3ZWVuIHR3byBj\nbGFzcyBtZXRhZGF0YS4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIGlu\ndCBjb21wYXJlKENsYXNzTWV0YURhdGEgbzEsIENsYXNzTWV0YURhdGEgbzIp\nIHsKICAgICAgICAgICAgaW50IGxpMSA9IG8xLmdldExpc3RpbmdJbmRleCgp\nOwogICAgICAgICAgICBpbnQgbGkyID0gbzIuZ2V0TGlzdGluZ0luZGV4KCk7\nCiAgICAgICAgICAgIGlmIChsaTEgPT0gLTEgJiYgbGkyID09IC0xKSB7CiAg\nICAgICAgICAgICAgICBNZXRhRGF0YVRhZyB0MSA9IGdldEVudGl0eVRhZyhv\nMSk7CiAgICAgICAgICAgICAgICBNZXRhRGF0YVRhZyB0MiA9IGdldEVudGl0\neVRhZyhvMik7CiAgICAgICAgICAgICAgICBpZiAodDEuY29tcGFyZVRvKHQy\nKSAhPSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0MS5jb21wYXJl\nVG8odDIpOwogICAgICAgICAgICAgICAgaW50IGluaGVyID0gc3VwZXIuY29t\ncGFyZShvMSwgbzIpOwogICAgICAgICAgICAgICAgaWYgKGluaGVyICE9IDAp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaGVyOwogICAgICAgICAg\nICAgICAgcmV0dXJuIG8xLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCku\nY29tcGFyZVRvCiAgICAgICAgICAgICAgICAgICAgKG8yLmdldERlc2NyaWJl\nZFR5cGUoKS5nZXROYW1lKCkpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAobGkxID09IC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAg\nICAgICAgICAgIGlmIChsaTIgPT0gLTEpCiAgICAgICAgICAgICAgICByZXR1\ncm4gLTE7CiAgICAgICAgICAgIHJldHVybiBsaTEgLSBsaTI7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBDb21wYXJlIHF1ZXJ5IG1ldGFk\nYXRhLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgaW50IGNvbXBhcmUo\nUXVlcnlNZXRhRGF0YSBvMSwgUXVlcnlNZXRhRGF0YSBvMikgewogICAgICAg\nICAgICAvLyBub3JtYWwgcXVlcmllcyBiZWZvcmUgbmF0aXZlCiAgICAgICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuZXF1YWxzKG8xLmdldExhbmd1YWdlKCks\nIG8yLmdldExhbmd1YWdlKCkpKSB7CiAgICAgICAgICAgICAgICBpZiAoUXVl\ncnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1YWxzKG8xLmdldExhbmd1YWdlKCkp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gbzEuZ2V0TmFtZSgpLmNvbXBh\ncmVUbyhvMi5nZXROYW1lKCkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogQ29tcGFyZSBzZXF1ZW5jZSBtZXRhZGF0YS4KICAgICAgICAg\nKi8KICAgICAgICBwcml2YXRlIGludCBjb21wYXJlKFNlcXVlbmNlTWV0YURh\ndGEgbzEsIFNlcXVlbmNlTWV0YURhdGEgbzIpIHsKICAgICAgICAgICAgcmV0\ndXJuIG8xLmdldE5hbWUoKS5jb21wYXJlVG8obzIuZ2V0TmFtZSgpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTb3J0cyBmaWVsZHMgYWNj\nb3JkaW5nIHRvIGxpc3Rpbmcgb3JkZXIsIHRoZW4gWFNEIHN0cmF0ZWd5IG9y\nZGVyLAogICAgICogdGhlbiBuYW1lIG9yZGVyLgogICAgICovCiAgICBwcml2\nYXRlIGNsYXNzIEZpZWxkQ29tcGFyYXRvcgogICAgICAgIGltcGxlbWVudHMg\nQ29tcGFyYXRvciB7CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmpl\nY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZDEgPSAoRmllbGRNZXRhRGF0YSkgbzE7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kMiA9IChGaWVsZE1ldGFEYXRhKSBvMjsKICAgICAgICAg\nICAgaWYgKGZtZDEuaXNQcmltYXJ5S2V5KCkpIHsKICAgICAgICAgICAgICAg\nIGlmIChmbWQyLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBmbWQxLmNvbXBhcmVUbyhmbWQyKTsKICAgICAgICAgICAgICAg\nIHJldHVybiAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm1k\nMi5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwoK\nICAgICAgICAgICAgaWYgKGZtZDEuaXNWZXJzaW9uKCkpIHsKICAgICAgICAg\nICAgICAgIGlmIChmbWQyLmlzVmVyc2lvbigpKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBjb21wYXJlTGlzdGluZ09yZGVyKGZtZDEsIGZtZDIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFN0cmF0ZWd5KGZtZDIpID09IFBl\ncnNpc3RlbmNlU3RyYXRlZ3kuQkFTSUMgPyAxIDogLTE7CgkJCX0KCQkJaWYg\nKGZtZDIuaXNWZXJzaW9uKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nU3RyYXRlZ3koZm1kMSkgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5CQVNJQyA/\nIC0xIDogMTsKCiAgICAgICAgICAgIGludCBzdGNtcCA9IGdldFN0cmF0ZWd5\nKGZtZDEpLmNvbXBhcmVUbyhnZXRTdHJhdGVneShmbWQyKSk7CiAgICAgICAg\nICAgIGlmIChzdGNtcCAhPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIHN0\nY21wOwogICAgICAgICAgICByZXR1cm4gY29tcGFyZUxpc3RpbmdPcmRlcihm\nbWQxLCBmbWQyKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgaW50IGNv\nbXBhcmVMaXN0aW5nT3JkZXIoRmllbGRNZXRhRGF0YSBmbWQxLCBGaWVsZE1l\ndGFEYXRhIGZtZDIpewogICAgICAgICAgICBpbnQgbGNtcCA9IGZtZDEuZ2V0\nTGlzdGluZ0luZGV4KCkgLSBmbWQyLmdldExpc3RpbmdJbmRleCgpOwogICAg\nICAgICAgICBpZiAobGNtcCAhPSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGxjbXA7CiAgICAgICAgICAgIHJldHVybiBmbWQxLmNvbXBhcmVUbyhmbWQy\nKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

