{"sha":"9b71dce749de1d5e7e47825b4c6d257a7a8013fe","node_id":"MDQ6QmxvYjIwNjM2NDo5YjcxZGNlNzQ5ZGUxZDVlN2U0NzgyNWI0YzZkMjU3YTdhODAxM2Zl","size":12275,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9b71dce749de1d5e7e47825b4c6d257a7a8013fe","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkJ1ZmZlcmVkSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkJ1\nZmZlcmVkT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5GaWxlOwppbXBv\ncnQgamF2YS5pby5GaWxlSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkZp\nbGVPdXRwdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5uZXQuVVJMOwppbXBvcnQgamF2YS5uZXQuVVJMQ2xhc3NM\nb2FkZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7\nCmltcG9ydCBqYXZhLnNlY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb247CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5qYXIuSmFyRW50cnk7CmltcG9ydCBqYXZh\nLnV0aWwuamFyLkphck91dHB1dFN0cmVhbTsKCmltcG9ydCBqdW5pdC5mcmFt\nZXdvcmsuVGVzdENhc2U7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvblByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5lbmNyeXB0aW9u\nLkVuY3J5cHRpb25Qcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKCnB1YmxpYyBjbGFzcyBUZXN0\nUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZhdGlvbiBleHRlbmRzIFRlc3RDYXNl\nIHsKICAgIHByaXZhdGUgRmlsZSBzb3VyY2VGaWxlOwogICAgcHJpdmF0ZSBG\naWxlIHRhcmdldEZpbGU7CiAgICAKICAgIENsYXNzTG9hZGVyIG9yaWdpbmFs\nTG9hZGVyID0gbnVsbDsKICAgIENsYXNzTG9hZGVyIHRlbXBMb2FkZXIgPSBu\ndWxsOwogICAgCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRVcCgpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgU3Ry\naW5nIGN1cnJlbnREaXIgPSBTeXN0ZW0uZ2V0UHJvcGVydHkoInVzZXIuZGly\nIik7CiAgICAgICAgCiAgICAgICAgLy8gb3BlbmpwYS1wZXJzaXN0ZW5jZS9z\ncmMvdGVzdC9yZXNvdXJjZXMvc2Vjb25kLXBlcnNpc3RlbmNlLwogICAgICAg\nIC8vICAgTUVUQS1JTkYvcGVyc2lzdGVuY2UueG1sCiAgICAgICAgc291cmNl\nRmlsZSA9IG5ldyBGaWxlKGN1cnJlbnREaXIgKyBGaWxlLnNlcGFyYXRvciAr\nICJzcmMiIAogICAgICAgICAgICArIEZpbGUuc2VwYXJhdG9yICArICJ0ZXN0\nIiArIEZpbGUuc2VwYXJhdG9yICsgInJlc291cmNlcyIKICAgICAgICAgICAg\nKyBGaWxlLnNlcGFyYXRvciAgKyAic2Vjb25kLXBlcnNpc3RlbmNlIiArIEZp\nbGUuc2VwYXJhdG9yIAogICAgICAgICAgICArICJNRVRBLUlORiIgKyBGaWxl\nLnNlcGFyYXRvciArICJwZXJzaXN0ZW5jZS54bWwiKTsKICAgICAgICAKICAg\nICAgICAvLyBvcGVuanBhLXBlcnNpc3RlbmNlL3RhcmdldC90ZXN0LWNsYXNz\nZXMvCiAgICAgICAgLy8gICBUZXN0UGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZh\ndGlvbl9nZW5lcmF0ZWRfKHRpbWVfc3RhbXApLmphciAgICAgICAgCiAgICAg\nICAgdGFyZ2V0RmlsZSA9IG5ldyBGaWxlKGN1cnJlbnREaXIgKyBGaWxlLnNl\ncGFyYXRvciArICJ0YXJnZXQiICsgCiAgICAgICAgICAgIEZpbGUuc2VwYXJh\ndG9yICsgInRlc3QtY2xhc3NlcyIgKyBGaWxlLnNlcGFyYXRvciArIAogICAg\nICAgICAgICAiVGVzdFBlcnNpc3RlbmNlUHJvZHVjdERlcml2YXRpb25fZ2Vu\nZXJhdGVkXyIgKwogICAgICAgICAgICBTeXN0ZW0uY3VycmVudFRpbWVNaWxs\naXMoKSArICIuamFyIik7CiAgICAgICAgCiAgICAgICAgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAg\nLmRlbGV0ZU9uRXhpdEFjdGlvbih0YXJnZXRGaWxlKSk7CiAgICAgICAgYnVp\nbGRKYXIoc291cmNlRmlsZSx0YXJnZXRGaWxlKTsKICAgICAgICAKICAgICAg\nICAvLyBIb2xkIGEgcmVmZXJlbmNlIHRvIHRoZSBjdXJyZW50IGNsYXNzbG9h\nZGVyIHNvIHdlIGNhbiBjbGVhbnVwCiAgICAgICAgLy8gd2hlbiB3ZSdyZSBk\nb25lLgogICAgICAgIG9yaWdpbmFsTG9hZGVyID0gVGhyZWFkLmN1cnJlbnRU\naHJlYWQoKS5nZXRDb250ZXh0Q2xhc3NMb2FkZXIoKTsKICAgICAgICB0ZW1w\nTG9hZGVyID0gbmV3IFRlbXBVcmxMb2FkZXIobmV3IFVSTFtde3RhcmdldEZp\nbGUudG9VUkkoKS50b1VSTCgpfQogICAgICAgICAgICAsb3JpZ2luYWxMb2Fk\nZXIpOyAgICAgICAgCiAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgLnNldENvbnRleHRD\nbGFzc0xvYWRlckFjdGlvbih0ZW1wTG9hZGVyKSk7CiAgICB9CiAgICAKICAg\nIHByb3RlY3RlZCB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgc3VwZXIudGVhckRvd24oKTsKICAgICAgICAvLyBSZXN0b3Jl\nIHRoZSBvcmlnaW5hbCBjbGFzc2xvYWRlci4KICAgICAgICBUaHJlYWQuY3Vy\ncmVudFRocmVhZCgpLnNldENvbnRleHRDbGFzc0xvYWRlcihvcmlnaW5hbExv\nYWRlcik7CiAgICAgICAgCiAgICAgICAgLy8gRm9yIHdoYXRldmVyIHJlYXNv\nbiwgdGhpcyBmaWxlIHdvbid0IGV2ZXIgZGVsZXRlLiBJIHNlYXJjaGVkIGFy\nb3VuZAogICAgICAgIC8vIGFuZCBmb3VuZCBudW1lcm91cyBkb2N1bWVudGVk\nIHByb2JsZW1zIHdpdGggZGVsZXRpbmcgZmlsZXMuIFBlcmhhcHMKICAgICAg\nICAvLyBzb21ldGltZSBpbiB0aGUgZnV0dXJlIHRoaXMgcHJvYmxlbSB3aWxs\nIGJlIGZpeGVkLiBGb3Igbm93IGl0IGRvZXNuJ3QKICAgICAgICAvLyByZWFs\nbHkgbWF0dGVyIHNpbmNlIHdlIGdlbmVyYXRlIGEgbmV3IGZpbGUgZXZlcnkg\ndGltZS4KICAgICAgICBib29sZWFuIGRlbGV0ZWQgPSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAu\nZGVsZXRlQWN0aW9uKHRhcmdldEZpbGUpKTsKICAgICAgICBpZihkZWxldGVk\nPT1mYWxzZSl7CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiVGhl\nIGZpbGUgIiArIHRhcmdldEZpbGUgKyAiIHdhc24ndCBkZWxldGVkLiIpOwog\nICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkZWQgZm9yIE9QRU5K\nUEEtOTMyLiBWZXJpZmllcyBhIFBlcnNpc3RlbmNlUHJvZHVjdERlcml2YXRp\nb24gcHJvcGVybHkgbG9hZHMgcHUncyBmcm9tIG11bHRpcGxlIAogICAgICog\nYXJjaGl2ZXMuCiAgICAgKiAKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RHZXRBbmNob3JzSW5SZXNvdXJj\nZSgpdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgCiAgICAgICAgTGlzdDxT\ndHJpbmc+IGV4cGVjdGVkUFVzID0gQXJyYXlzLmFzTGlzdCgKICAgICAgICAg\nICAgbmV3IFN0cmluZ1tdeyJwdV8xIiwicHVfMiIsInB1XzMifSk7CiAgICAg\nICAgCiAgICAgICAgUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZhdGlvbiBwcGQg\nPSBuZXcgUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZhdGlvbigpOwogICAgICAg\nIExpc3Q8U3RyaW5nPiBhY3R1YWwgPSBwcGQuZ2V0QW5jaG9yc0luUmVzb3Vy\nY2UoIk1FVEEtSU5GL3BlcnNpc3RlbmNlLnhtbCIpOwogICAgICAgIAogICAg\nICAgIGFzc2VydFRydWUoYWN0dWFsLmNvbnRhaW5zQWxsKGV4cGVjdGVkUFVz\nKSk7CiAgICB9CiAgICBwdWJsaWMgdm9pZCB0ZXN0RW5jcnlwdGlvblBsdWdp\nbkNvbmZpZ3VyYXRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKCQlQZXJzaXN0\nZW5jZVByb2R1Y3REZXJpdmF0aW9uIHBwZCA9IG5ldyBQZXJzaXN0ZW5jZVBy\nb2R1Y3REZXJpdmF0aW9uKCk7CgkJT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29u\nZiA9IG5ldyBPcGVuSlBBQ29uZmlndXJhdGlvbkltcGwoKTsKCQlTdHJpbmcg\nZW5jcnlwdGVkUGFzc3dvcmQgPSAiZW5jcnlwdGVkX3Bhc3N3b3JkIjsKCQlD\nbGFzc0xvYWRlciBsb2FkZXIgPSBudWxsOwoKCQlDb25maWd1cmF0aW9uUHJv\ndmlkZXIgcHJvdmlkZXIgPSBwcGQubG9hZCgKCQkJCVBlcnNpc3RlbmNlUHJv\nZHVjdERlcml2YXRpb24uUlNSQ19ERUZBVUxULAoJCQkJImVuY3J5cHRpb25f\ncGx1Z2luX3B1IiwgbG9hZGVyKTsKCQlwcm92aWRlci5zZXRJbnRvKGNvbmYp\nOwoJCUVuY3J5cHRpb25Qcm92aWRlciBlcCA9IGNvbmYuZ2V0RW5jcnlwdGlv\nblByb3ZpZGVyKCk7CgkJYXNzZXJ0Tm90TnVsbChlcCk7CgkJLy8gQ2FzdCB0\nbyB0ZXN0IGltcGwKCQlUZXN0RW5jcnlwdGlvblByb3ZpZGVyIHRlcCA9IChU\nZXN0RW5jcnlwdGlvblByb3ZpZGVyKSBlcDsKCgkJY29uZi5zZXRDb25uZWN0\naW9uUGFzc3dvcmQoZW5jcnlwdGVkUGFzc3dvcmQpOwoJCS8vIFZhbGlkYXRl\nIHRoYXQgd2hlbiB3ZSBnZXQgdGhlIENvbm5lY3Rpb25QYXNzd29yZCBmcm9t\nIGNvbmZpZ3VyYXRpb24KCQkvLyB0aGF0IGl0IGlzIGRlY3J5cHRlZAoJCWFz\nc2VydEVxdWFscyhUZXN0RW5jcnlwdGlvblByb3ZpZGVyLmRlY3J5cHRlZFBh\nc3N3b3JkLCBjb25mCgkJCQkuZ2V0Q29ubmVjdGlvblBhc3N3b3JkKCkpOwoJ\nCS8vIFZhbGlkYXRlIHRoYXQgdGhlIEVuY3J5cHRpb25Qcm92aWRlciBpcyBj\nYWxsZWQgd2l0aCB0aGUgJ2VuY3J5cHRlZCcKCQkvLyBwYXNzd29yZAoJCWFz\nc2VydEVxdWFscyhlbmNyeXB0ZWRQYXNzd29yZCwgdGVwLmdldEVuY3J5cHRl\nZFBhc3N3b3JkKCkpOwoJfQogICAgcHVibGljIHZvaWQgdGVzdEVuY3J5cHRp\nb25QbHVnaW5Db25maWd1cmF0aW9uRGVmYXVsdFZhbHVlKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CgkJUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZhdGlvbiBwcGQg\nPSBuZXcgUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZhdGlvbigpOwoJCU9wZW5K\nUEFDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgT3BlbkpQQUNvbmZpZ3VyYXRp\nb25JbXBsKCk7CgkJQ2xhc3NMb2FkZXIgbG9hZGVyID0gbnVsbDsKCgkJQ29u\nZmlndXJhdGlvblByb3ZpZGVyIHByb3ZpZGVyID0gcHBkLmxvYWQoCgkJCQlQ\nZXJzaXN0ZW5jZVByb2R1Y3REZXJpdmF0aW9uLlJTUkNfREVGQVVMVCwKCQkJ\nCSJlbmNyeXB0aW9uX3BsdWdpbl9kZWZhdWx0X3B1IiwgbG9hZGVyKTsKCQlw\ncm92aWRlci5zZXRJbnRvKGNvbmYpOwoKCQlhc3NlcnROdWxsKGNvbmYuZ2V0\nRW5jcnlwdGlvblByb3ZpZGVyKCkpOwoJfQogICAgCiAgICAvKgogICAgICog\nVmVyaWZpZXMgdmFsdWUgb2YgZXhjbHVkZS11bmxpc3RlZC1jbGFzc2VzIHdp\ndGggYSB2ZXJzaW9uIDEuMAogICAgICogcGVyc2lzdGVuY2UueG1sLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0SlBBMUV4Y2x1ZGVVbmxpc3RlZENs\nYXNzZXMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBQZXJzaXN0ZW5j\nZVByb2R1Y3REZXJpdmF0aW9uLkNvbmZpZ3VyYXRpb25QYXJzZXIgY3AgPSAK\nICAgICAgICAgICAgICAgIG5ldyBQZXJzaXN0ZW5jZVByb2R1Y3REZXJpdmF0\naW9uLkNvbmZpZ3VyYXRpb25QYXJzZXIobmV3IEhhc2hNYXAoKSk7CgogICAg\nICAgIExpc3Q8VVJMPiB1cmxzID0gZ2V0UmVzb3VyY2VVUkwoUGVyc2lzdGVu\nY2VQcm9kdWN0RGVyaXZhdGlvbi5SU1JDX0RFRkFVTFQpOwogICAgICAgIGFz\nc2VydE5vdE51bGwodXJscyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDEsIHVy\nbHMuc2l6ZSgpKTsKICAgICAgICBjcC5wYXJzZSh1cmxzLmdldCgwKSk7CiAg\nICAgICAgCiAgICAgICAgTGlzdDxQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbD4g\ndW5pdHMgPSBjcC5nZXRSZXN1bHRzKCk7CiAgICAgICAgICAgICAgICAKICAg\nICAgICBpbnQgdmZ5Q291bnQgPSAwOwogICAgICAgIGZvciAoUGVyc2lzdGVu\nY2VVbml0SW5mb0ltcGwgcHB1aSA6IHVuaXRzKSB7CiAgICAgICAgICAgIGlm\nICgiZXhjbHVkZV9ub3Rfc3BlY2lmaWVkIi5lcXVhbHMocHB1aS5nZXRQZXJz\naXN0ZW5jZVVuaXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICB2ZnlDb3Vu\ndCsrOwogICAgICAgICAgICAgICAgYXNzZXJ0RmFsc2UocHB1aS5leGNsdWRl\nVW5saXN0ZWRDbGFzc2VzKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIC8vIFZlcmlmeSBjYXNlIHdoZXJlIGV4Y2x1ZGUtdW5saXN0ZWQtY2xhc3Nl\ncyB3YXMgc3BlY2lmaWVkLCBidXQKICAgICAgICAgICAgLy8gaXMgdGhlIGRl\nZmF1bHQgaWUgPGV4Y2x1ZGUtdW5saXN0ZWQtY2xhc3Nlcy8+CiAgICAgICAg\nICAgIGlmICgiZXhjbHVkZV9kZWZhdWx0Ii5lcXVhbHMocHB1aS5nZXRQZXJz\naXN0ZW5jZVVuaXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICB2ZnlDb3Vu\ndCsrOwogICAgICAgICAgICAgICAgYXNzZXJ0RmFsc2UocHB1aS5leGNsdWRl\nVW5saXN0ZWRDbGFzc2VzKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIC8vIFZlcmlmeSBjYXNlIHdoZXJlIGV4Y2x1ZGUtdW5saXN0ZWQtY2xhc3Nl\ncyB3YXMgc3BlY2lmaWVkIGFzCiAgICAgICAgICAgIC8vIHRydWUgPGV4Y2x1\nZGUtdW5saXN0ZWQtY2xhc3Nlcz50cnVlPC9leGNsdWRlLXVubGlzdGVkLWNs\nYXNzZXM+CiAgICAgICAgICAgIGlmICgiZXhjbHVkZV90cnVlIi5lcXVhbHMo\ncHB1aS5nZXRQZXJzaXN0ZW5jZVVuaXROYW1lKCkpKSB7CiAgICAgICAgICAg\nICAgICB2ZnlDb3VudCsrOwogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZShw\ncHVpLmV4Y2x1ZGVVbmxpc3RlZENsYXNzZXMoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgLy8gVmVyaWZ5IGNhc2Ugd2hlcmUgZXhjbHVkZS11bmxp\nc3RlZC1jbGFzc2VzIHdhcyBzcGVjaWZpZWQgYXMKICAgICAgICAgICAgLy8g\nZmFsc2UgPGV4Y2x1ZGUtdW5saXN0ZWQtY2xhc3Nlcz5mYWxzZTwvZXhjbHVk\nZS11bmxpc3RlZC1jbGFzc2VzPgogICAgICAgICAgICBpZiAoImV4Y2x1ZGVf\nZmFsc2UiLmVxdWFscyhwcHVpLmdldFBlcnNpc3RlbmNlVW5pdE5hbWUoKSkp\nIHsKICAgICAgICAgICAgICAgIHZmeUNvdW50Kys7CiAgICAgICAgICAgICAg\nICBhc3NlcnRGYWxzZShwcHVpLmV4Y2x1ZGVVbmxpc3RlZENsYXNzZXMoKSk7\nCiAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAg\nLy8gTWFrZSBzdXJlIGFsbCBwdSdzIHdlcmUgdmFsaWRhdGVkCiAgICAgICAg\nYXNzZXJ0RXF1YWxzKDQsIHZmeUNvdW50KTsgICAgICAgICAgICAgICAgCiAg\nICB9CgogICAgLyoKICAgICAqIFZlcmlmaWVzIHZhbHVlIG9mIGV4Y2x1ZGUt\ndW5saXN0ZWQtY2xhc3NlcyB3aXRoIGEgdmVyc2lvbiAyLjAKICAgICAqIHBl\ncnNpc3RlbmNlLnhtbC4KICAgICAqLwogICAgcHVibGljIHZvaWQgdGVzdEV4\nY2x1ZGVVbmxpc3RlZENsYXNzZXMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBQZXJzaXN0ZW5jZVByb2R1Y3REZXJpdmF0aW9uLkNvbmZpZ3VyYXRp\nb25QYXJzZXIgY3AgPSAKICAgICAgICAgICAgbmV3IFBlcnNpc3RlbmNlUHJv\nZHVjdERlcml2YXRpb24uQ29uZmlndXJhdGlvblBhcnNlcihuZXcgSGFzaE1h\ncCgpKTsKCiAgICBMaXN0PFVSTD4gdXJscyA9IGdldFJlc291cmNlVVJMKCJN\nRVRBLUlORi9wZXJzaXN0ZW5jZS0yXzAueG1sIik7CiAgICBhc3NlcnROb3RO\ndWxsKHVybHMpOwogICAgYXNzZXJ0RXF1YWxzKDEsIHVybHMuc2l6ZSgpKTsK\nICAgIGNwLnBhcnNlKHVybHMuZ2V0KDApKTsKICAgIAogICAgTGlzdDxQZXJz\naXN0ZW5jZVVuaXRJbmZvSW1wbD4gdW5pdHMgPSBjcC5nZXRSZXN1bHRzKCk7\nCiAgICAgICAgICAgIAogICAgaW50IHZmeUNvdW50ID0gMDsKICAgIGZvciAo\nUGVyc2lzdGVuY2VVbml0SW5mb0ltcGwgcHB1aSA6IHVuaXRzKSB7CiAgICAg\nICAgLy8gVmVyaWZ5IGNhc2Ugd2hlcmUgZXhjbHVkZS11bmxpc3RlZC1jbGFz\nc2VzIHdhcyBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKCJleGNsdWRlX25v\ndF9zcGVjaWZpZWQiLmVxdWFscyhwcHVpLmdldFBlcnNpc3RlbmNlVW5pdE5h\nbWUoKSkpIHsKICAgICAgICAgICAgdmZ5Q291bnQrKzsKICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZShwcHVpLmV4Y2x1ZGVVbmxpc3RlZENsYXNzZXMoKSk7CiAg\nICAgICAgfQogICAgICAgIC8vIFZlcmlmeSBjYXNlIHdoZXJlIGV4Y2x1ZGUt\ndW5saXN0ZWQtY2xhc3NlcyB3YXMgc3BlY2lmaWVkLCBidXQKICAgICAgICAv\nLyBpcyB0aGUgZGVmYXVsdCBpZSA8ZXhjbHVkZS11bmxpc3RlZC1jbGFzc2Vz\nLz4KICAgICAgICBpZiAoImV4Y2x1ZGVfZGVmYXVsdCIuZXF1YWxzKHBwdWku\nZ2V0UGVyc2lzdGVuY2VVbml0TmFtZSgpKSkgewogICAgICAgICAgICB2ZnlD\nb3VudCsrOwogICAgICAgICAgICBhc3NlcnRUcnVlKHBwdWkuZXhjbHVkZVVu\nbGlzdGVkQ2xhc3NlcygpKTsKICAgICAgICB9CiAgICAgICAgLy8gVmVyaWZ5\nIGNhc2Ugd2hlcmUgZXhjbHVkZS11bmxpc3RlZC1jbGFzc2VzIHdhcyBzcGVj\naWZpZWQgYXMKICAgICAgICAvLyB0cnVlIDxleGNsdWRlLXVubGlzdGVkLWNs\nYXNzZXM+dHJ1ZTwvZXhjbHVkZS11bmxpc3RlZC1jbGFzc2VzPgogICAgICAg\nIGlmICgiZXhjbHVkZV90cnVlIi5lcXVhbHMocHB1aS5nZXRQZXJzaXN0ZW5j\nZVVuaXROYW1lKCkpKSB7CiAgICAgICAgICAgIHZmeUNvdW50Kys7CiAgICAg\nICAgICAgIGFzc2VydFRydWUocHB1aS5leGNsdWRlVW5saXN0ZWRDbGFzc2Vz\nKCkpOwogICAgICAgIH0KICAgICAgICAvLyBWZXJpZnkgY2FzZSB3aGVyZSBl\neGNsdWRlLXVubGlzdGVkLWNsYXNzZXMgd2FzIHNwZWNpZmllZCBhcwogICAg\nICAgIC8vIGZhbHNlIDxleGNsdWRlLXVubGlzdGVkLWNsYXNzZXM+ZmFsc2U8\nL2V4Y2x1ZGUtdW5saXN0ZWQtY2xhc3Nlcz4KICAgICAgICBpZiAoImV4Y2x1\nZGVfZmFsc2UiLmVxdWFscyhwcHVpLmdldFBlcnNpc3RlbmNlVW5pdE5hbWUo\nKSkpIHsKICAgICAgICAgICAgdmZ5Q291bnQrKzsKICAgICAgICAgICAgYXNz\nZXJ0RmFsc2UocHB1aS5leGNsdWRlVW5saXN0ZWRDbGFzc2VzKCkpOwogICAg\nICAgIH0gICAgICAgICAgICAKICAgIH0KICAgIC8vIE1ha2Ugc3VyZSBhbGwg\ncHUncyB3ZXJlIHZhbGlkYXRlZAogICAgYXNzZXJ0RXF1YWxzKDQsIHZmeUNv\ndW50KTsgICAgICAgICAgICAgICAgCiAgICAgICAgCiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgTGlzdDxVUkw+IGdldFJlc291cmNlVVJMKFN0cmluZyBy\nc3JjKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICBFbnVtZXJh\ndGlvbjxVUkw+IHVybHMgPSBudWxsOwogICAgdHJ5IHsKICAgICAgICBDbGFz\nc0xvYWRlciBjbCA9IFRlc3RQZXJzaXN0ZW5jZVByb2R1Y3REZXJpdmF0aW9u\nLmNsYXNzLmdldENsYXNzTG9hZGVyKCk7CiAgICAgICAgdXJscyA9IEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXRSZXNvdXJjZXNBY3Rpb24oY2wsIHJzcmMpKTsgCiAgICAg\nICAgaWYgKCF1cmxzLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAg\nIGlmICghcnNyYy5zdGFydHNXaXRoKCJNRVRBLUlORiIpKQogICAgICAgICAg\nICAgIHVybHMgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0UmVzb3VyY2VzQWN0\naW9uKGNsLCAiTUVUQS1JTkYvIiArIHJzcmMpKTsKICAgICAgICAgICAgaWYg\nKCF1cmxzLmhhc01vcmVFbGVtZW50cygpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQogICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICB0aHJvdyAoSU9FeGNlcHRp\nb24pIHBhZS5nZXRFeGNlcHRpb24oKTsKICAgIH0KCiAgICByZXR1cm4gQ29s\nbGVjdGlvbnMubGlzdCh1cmxzKTsKfQoKICAgIHByaXZhdGUgdm9pZCBidWls\nZEphcihGaWxlIHNvdXJjZUZpbGUsIEZpbGUgdGFyZ2V0RmlsZSkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgCiAgICAgICAgSmFyT3V0cHV0U3RyZWFt\nIG91dCA9IG5ldyBKYXJPdXRwdXRTdHJlYW0oCiAgICAgICAgICAgIG5ldyBC\ndWZmZXJlZE91dHB1dFN0cmVhbShuZXcgRmlsZU91dHB1dFN0cmVhbSh0YXJn\nZXRGaWxlKSkpOwogICAgICAgIAogICAgICAgIEJ1ZmZlcmVkSW5wdXRTdHJl\nYW0gaW4gPSAKICAgICAgICAgICAgbmV3IEJ1ZmZlcmVkSW5wdXRTdHJlYW0o\nbmV3IEZpbGVJbnB1dFN0cmVhbShzb3VyY2VGaWxlKSk7CgogICAgICAgIG91\ndC5wdXROZXh0RW50cnkobmV3IEphckVudHJ5KCJNRVRBLUlORi8iKSk7CiAg\nICAgICAgb3V0LnB1dE5leHRFbnRyeShuZXcgSmFyRW50cnkoIk1FVEEtSU5G\nL3BlcnNpc3RlbmNlLnhtbCIpKTsKICAgICAgICAvL3dyaXRlIHRoZSB4bWwg\ndG8gdGhlIGphcgogICAgICAgIGJ5dGVbXSBidWYgPSBuZXcgYnl0ZVsxMDI0\nXTsKICAgICAgICBpbnQgaTsKICAgICAgICB3aGlsZSAoKGkgPSBpbi5yZWFk\nKGJ1ZikpICE9IC0xKSB7CiAgICAgICAgICBvdXQud3JpdGUoYnVmLCAwLCBp\nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgb3V0LmNsb3NlKCk7CiAg\nICAgICAgaW4uY2xvc2UoKTsgICAgICAgIAogICAgfQoKICAgIGNsYXNzIFRl\nbXBVcmxMb2FkZXIgZXh0ZW5kcyBVUkxDbGFzc0xvYWRlciB7CiAgICAgICAg\ncHVibGljIFRlbXBVcmxMb2FkZXIoVVJMW10gdXJscywgQ2xhc3NMb2FkZXIg\ncGFyZW50KSB7CiAgICAgICAgICAgIHN1cGVyKHVybHMscGFyZW50KTsKICAg\nICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFRlc3RFbmNy\neXB0aW9uUHJvdmlkZXIgaW1wbGVtZW50cyBFbmNyeXB0aW9uUHJvdmlkZXIg\newoJCXB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIGRlY3J5cHRlZFBhc3N3\nb3JkID0gImRlY3lwdGVkX3Bhc3N3b3JkIjsKCQkvLyBTYXZlIHRoZSAnZW5j\ncnlwdGVkJyBwYXNzd29yZCBzbyBvdXIgVVQgY2FuIHBlcmZvcm0gdmFsaWRh\ndGlvbi4KCQlwcml2YXRlIFN0cmluZyBlbmNyeXB0ZWRQYXNzd29yZDsKCgkJ\ncHVibGljIFN0cmluZyBnZXRFbmNyeXB0ZWRQYXNzd29yZCgpIHsKCQkJcmV0\ndXJuIGVuY3J5cHRlZFBhc3N3b3JkOwoJCX0KCgkJLyoqCgkJICogVGhpcyBt\nZXRob2QgQUxXQVlTIHJldHVybnMgdGhlIFN0cmluZyAiZGVjeXB0ZWRfcGFz\nc3dvcmQiLgoJCSAqIAoJCSAqIEBzZWUgRW5jcnlwdGlvblByb3ZpZGVyI2Rl\nY3J5cHQoU3RyaW5nKQoJCSAqLwoJCXB1YmxpYyBTdHJpbmcgZGVjcnlwdChT\ndHJpbmcgcGFzc3dvcmQpIHsKCQkJZW5jcnlwdGVkUGFzc3dvcmQgPSBwYXNz\nd29yZDsKCgkJCXJldHVybiBkZWNyeXB0ZWRQYXNzd29yZDsKCQl9CgoJCS8q\nKgoJCSAqIEBzZWUgRW5jcnlwdGlvblByb3ZpZGVyI2VuY3J5cHQoU3RyaW5n\nKQoJCSAqLwoJCXB1YmxpYyBTdHJpbmcgZW5jcnlwdChTdHJpbmcgcGFzc3dv\ncmQpIHsKCQkJcmV0dXJuIHBhc3N3b3JkOwoJCX0KCX0KfQo=\n","encoding":"base64"}

