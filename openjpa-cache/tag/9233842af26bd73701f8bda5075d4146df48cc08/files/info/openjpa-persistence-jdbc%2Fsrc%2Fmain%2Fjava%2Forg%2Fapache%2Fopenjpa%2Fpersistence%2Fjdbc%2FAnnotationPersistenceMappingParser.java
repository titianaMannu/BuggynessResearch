{"sha":"63056ec7c6663169e736eaf7d90a2f27d57c03ba","node_id":"MDQ6QmxvYjIwNjM2NDo2MzA1NmVjN2M2NjYzMTY5ZTczNmVhZjdkOTBhMmYyN2Q1N2MwM2Jh","size":80601,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/63056ec7c6663169e736eaf7d90a2f27d57c03ba","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2\nYS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuQXNzb2NpYXRpb25PdmVycmlkZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkFzc29jaWF0aW9uT3ZlcnJpZGVzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQXR0cmlidXRlT3ZlcnJpZGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5BdHRyaWJ1dGVPdmVycmlkZXM7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5Db2xsZWN0aW9uVGFibGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRGlzY3JpbWluYXRvclZhbHVlOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRW50aXR5UmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnVtZXJh\ndGVkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRSZXN1bHQ7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5jZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkpvaW5Db2x1bW47CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5Kb2luQ29sdW1uczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLkpvaW5UYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleUNv\nbHVtbjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleUVudW1lcmF0\nZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBLZXlKb2luQ29sdW1u\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwS2V5Sm9pbkNvbHVtbnM7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBLZXlUZW1wb3JhbDsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByaW1hcnlLZXlKb2luQ29sdW1uOwpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJpbWFyeUtleUpvaW5Db2x1bW5z\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU2Vjb25kYXJ5VGFibGU7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZWNvbmRhcnlUYWJsZXM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5TcWxSZXN1bHRTZXRNYXBwaW5nOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuU3FsUmVzdWx0U2V0TWFwcGluZ3M7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UYWJsZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlRhYmxlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVGVtcG9yYWw7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Vbmlx\ndWVDb25zdHJhaW50OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5n\nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nSW5m\nbzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3Jp\nbWluYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5GaWVsZE1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5NYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuTWFwcGluZ1JlcG9zaXRvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlF1ZXJ5UmVzdWx0TWFwcGlu\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuU2VxdWVu\nY2VNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLlZhbHVlTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5FbnVtVmFsdWVIYW5kbGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRmxhdENs\nYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5GdWxsQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlZlcnRpY2FsQ2xhc3NTdHJh\ndGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5D\nb2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nU2NoZW1hczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5VbmlxdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5s\nb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoy\nRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nTWV0YURhdGFDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBl\ncnNpc3RlbmNlLkFubm90YXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2Vy\nOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5j\nZS5qZGJjLk1hcHBpbmdUYWcuKjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioK\nICogUGVyc2lzdGVuY2UgYW5ub3RhdGlvbiBtYXBwaW5nIHBhcnNlci4KICoK\nICogQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAqIEBhdXRob3IgU3RldmUgS2lt\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1Ymxp\nYyBjbGFzcyBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNYXBwaW5nUGFyc2VyCiAg\nICBleHRlbmRzIEFubm90YXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2Vy\nIHsKCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUUlVFID0gMTsK\nICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZBTFNFID0gMjsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKEFubm90YXRpb25QZXJzaXN0ZW5j\nZU1hcHBpbmdQYXJzZXIuY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIE1hcDxDbGFzcywgTWFwcGluZ1RhZz4gX3RhZ3MgPQogICAgICAgIG5l\ndyBIYXNoTWFwPENsYXNzLCBNYXBwaW5nVGFnPigpOwogICAgCiAgICBwcml2\nYXRlIERCRGljdGlvbmFyeSBfZGljdDsgCgogICAgc3RhdGljIHsKICAgICAg\nICBfdGFncy5wdXQoQXNzb2NpYXRpb25PdmVycmlkZS5jbGFzcywgQVNTT0Nf\nT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChBc3NvY2lhdGlvbk92ZXJy\naWRlcy5jbGFzcywgQVNTT0NfT1ZFUlJJREVTKTsKICAgICAgICBfdGFncy5w\ndXQoQXR0cmlidXRlT3ZlcnJpZGUuY2xhc3MsIEFUVFJfT1ZFUlJJREUpOwog\nICAgICAgIF90YWdzLnB1dChBdHRyaWJ1dGVPdmVycmlkZXMuY2xhc3MsIEFU\nVFJfT1ZFUlJJREVTKTsKICAgICAgICBfdGFncy5wdXQoamF2YXgucGVyc2lz\ndGVuY2UuQ29sdW1uLmNsYXNzLCBDT0wpOwogICAgICAgIF90YWdzLnB1dChD\nb2x1bW5SZXN1bHQuY2xhc3MsIENPTFVNTl9SRVNVTFQpOwogICAgICAgIF90\nYWdzLnB1dChEaXNjcmltaW5hdG9yQ29sdW1uLmNsYXNzLCBESVNDUklNX0NP\nTCk7CiAgICAgICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0b3JWYWx1ZS5jbGFz\ncywgRElTQ1JJTV9WQUwpOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50Q29s\ndW1uLmNsYXNzLCBFTEVNX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1l\nbnRDb2x1bW5zLmNsYXNzLCBFTEVNX0NPTFMpOwogICAgICAgIF90YWdzLnB1\ndChFbGVtZW50RW1iZWRkZWRNYXBwaW5nLmNsYXNzLCBFTEVNX0VNQkVEREVE\nX01BUFBJTkcpOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50U3RyYXRlZ3ku\nY2xhc3MsIEVMRU1fU1RSQVQpOwogICAgICAgIF90YWdzLnB1dChFbnRpdHlS\nZXN1bHQuY2xhc3MsIEVOVElUWV9SRVNVTFQpOwogICAgICAgIF90YWdzLnB1\ndChFbnVtZXJhdGVkLmNsYXNzLCBFTlVNRVJBVEVEKTsKICAgICAgICBfdGFn\ncy5wdXQoRmllbGRSZXN1bHQuY2xhc3MsIEZJRUxEX1JFU1VMVCk7CiAgICAg\nICAgX3RhZ3MucHV0KEluaGVyaXRhbmNlLmNsYXNzLCBJTkhFUklUQU5DRSk7\nCiAgICAgICAgX3RhZ3MucHV0KEpvaW5Db2x1bW4uY2xhc3MsIEpPSU5fQ09M\nKTsKICAgICAgICBfdGFncy5wdXQoSm9pbkNvbHVtbnMuY2xhc3MsIEpPSU5f\nQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KEpvaW5UYWJsZS5jbGFzcywgSk9J\nTl9UQUJMRSk7CiAgICAgICAgX3RhZ3MucHV0KEtleUNvbHVtbi5jbGFzcywg\nS0VZX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KEtleUNvbHVtbnMuY2xhc3Ms\nIEtFWV9DT0xTKTsKICAgICAgICBfdGFncy5wdXQoS2V5Q2xhc3NDcml0ZXJp\nYS5jbGFzcywgS0VZX0NMQVNTX0NSSVQpOwogICAgICAgIF90YWdzLnB1dChL\nZXlFbWJlZGRlZE1hcHBpbmcuY2xhc3MsIEtFWV9FTUJFRERFRF9NQVBQSU5H\nKTsKICAgICAgICBfdGFncy5wdXQoS2V5Rm9yZWlnbktleS5jbGFzcywgS0VZ\nX0ZLKTsKICAgICAgICBfdGFncy5wdXQoS2V5SW5kZXguY2xhc3MsIEtFWV9J\nTkRFWCk7CiAgICAgICAgX3RhZ3MucHV0KEtleUpvaW5Db2x1bW4uY2xhc3Ms\nIEtFWV9KT0lOX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KEtleUpvaW5Db2x1\nbW5zLmNsYXNzLCBLRVlfSk9JTl9DT0xTKTsKICAgICAgICBfdGFncy5wdXQo\nS2V5Tm9ucG9seW1vcnBoaWMuY2xhc3MsIEtFWV9OT05QT0xZKTsKICAgICAg\nICBfdGFncy5wdXQoS2V5U3RyYXRlZ3kuY2xhc3MsIEtFWV9TVFJBVCk7CiAg\nICAgICAgX3RhZ3MucHV0KE1hcEtleUNvbHVtbi5jbGFzcywgTUFQX0tFWV9D\nT0wpOwogICAgICAgIF90YWdzLnB1dChNYXBLZXlFbnVtZXJhdGVkLmNsYXNz\nLCBNQVBfS0VZX0VOVU1FUkFURUQpOwogICAgICAgIF90YWdzLnB1dChNYXBL\nZXlKb2luQ29sdW1uLmNsYXNzLCBNQVBfS0VZX0pPSU5fQ09MKTsKICAgICAg\nICBfdGFncy5wdXQoTWFwS2V5Sm9pbkNvbHVtbnMuY2xhc3MsIE1BUF9LRVlf\nSk9JTl9DT0xTKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5VGVtcG9yYWwu\nY2xhc3MsIE1BUF9LRVlfVEVNUE9SQUwpOwogICAgICAgIF90YWdzLnB1dChQ\ncmltYXJ5S2V5Sm9pbkNvbHVtbi5jbGFzcywgUEtfSk9JTl9DT0wpOwogICAg\nICAgIF90YWdzLnB1dChQcmltYXJ5S2V5Sm9pbkNvbHVtbnMuY2xhc3MsIFBL\nX0pPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KFNlY29uZGFyeVRhYmxl\nLmNsYXNzLCBTRUNPTkRBUllfVEFCTEUpOwogICAgICAgIF90YWdzLnB1dChT\nZWNvbmRhcnlUYWJsZXMuY2xhc3MsIFNFQ09OREFSWV9UQUJMRVMpOwogICAg\nICAgIF90YWdzLnB1dChTcWxSZXN1bHRTZXRNYXBwaW5nLmNsYXNzLCBTUUxf\nUkVTVUxUX1NFVF9NQVBQSU5HKTsKICAgICAgICBfdGFncy5wdXQoU3FsUmVz\ndWx0U2V0TWFwcGluZ3MuY2xhc3MsIFNRTF9SRVNVTFRfU0VUX01BUFBJTkdT\nKTsKICAgICAgICBfdGFncy5wdXQoVGFibGUuY2xhc3MsIFRBQkxFKTsKICAg\nICAgICBfdGFncy5wdXQoVGVtcG9yYWwuY2xhc3MsIFRFTVBPUkFMKTsKICAg\nICAgICBfdGFncy5wdXQoVGFibGVHZW5lcmF0b3IuY2xhc3MsIFRBQkxFX0dF\nTik7CiAgICAgICAgX3RhZ3MucHV0KENsYXNzQ3JpdGVyaWEuY2xhc3MsIENM\nQVNTX0NSSVQpOwogICAgICAgIF90YWdzLnB1dChDb2x1bW5zLmNsYXNzLCBD\nT0xTKTsKICAgICAgICBfdGFncy5wdXQoQ29udGFpbmVyVGFibGUuY2xhc3Ms\nIENPTlRBSU5FUl9UQUJMRSk7CiAgICAgICAgX3RhZ3MucHV0KENvbGxlY3Rp\nb25UYWJsZS5jbGFzcywgQ09MTEVDVElPTl9UQUJMRSk7CiAgICAgICAgX3Rh\nZ3MucHV0KERhdGFTdG9yZUlkQ29sdW1uLmNsYXNzLCBEQVRBU1RPUkVfSURf\nQ09MKTsKICAgICAgICBfdGFncy5wdXQoRGlzY3JpbWluYXRvclN0cmF0ZWd5\nLmNsYXNzLCBESVNDUklNX1NUUkFUKTsKICAgICAgICBfdGFncy5wdXQoRWFn\nZXJGZXRjaE1vZGUuY2xhc3MsIEVBR0VSX0ZFVENIX01PREUpOwogICAgICAg\nIF90YWdzLnB1dChFbGVtZW50Q2xhc3NDcml0ZXJpYS5jbGFzcywgRUxFTV9D\nTEFTU19DUklUKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEZvcmVpZ25L\nZXkuY2xhc3MsIEVMRU1fRkspOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50\nSW5kZXguY2xhc3MsIEVMRU1fSU5ERVgpOwogICAgICAgIF90YWdzLnB1dChF\nbGVtZW50Sm9pbkNvbHVtbi5jbGFzcywgRUxFTV9KT0lOX0NPTCk7CiAgICAg\nICAgX3RhZ3MucHV0KEVsZW1lbnRKb2luQ29sdW1ucy5jbGFzcywgRUxFTV9K\nT0lOX0NPTFMpOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50Tm9ucG9seW1v\ncnBoaWMuY2xhc3MsIEVMRU1fTk9OUE9MWSk7CiAgICAgICAgX3RhZ3MucHV0\nKEVtYmVkZGVkTWFwcGluZy5jbGFzcywgRU1CRURERURfTUFQUElORyk7CiAg\nICAgICAgX3RhZ3MucHV0KEZvcmVpZ25LZXkuY2xhc3MsIEZLKTsKICAgICAg\nICBfdGFncy5wdXQoSW5kZXguY2xhc3MsIElOREVYKTsKICAgICAgICBfdGFn\ncy5wdXQoTWFwcGluZ092ZXJyaWRlLmNsYXNzLCBNQVBQSU5HX09WRVJSSURF\nKTsKICAgICAgICBfdGFncy5wdXQoTWFwcGluZ092ZXJyaWRlcy5jbGFzcywg\nTUFQUElOR19PVkVSUklERVMpOwogICAgICAgIF90YWdzLnB1dChOb25wb2x5\nbW9ycGhpYy5jbGFzcywgTk9OUE9MWSk7CiAgICAgICAgX3RhZ3MucHV0KE9y\nZGVyQ29sdW1uLmNsYXNzLCBPUkRFUl9DT0wpOwogICAgICAgIF90YWdzLnB1\ndChqYXZheC5wZXJzaXN0ZW5jZS5PcmRlckNvbHVtbi5jbGFzcywgT1JERVJf\nQ09MVU1OKTsKICAgICAgICBfdGFncy5wdXQoU3RyYXRlZ3kuY2xhc3MsIFNU\nUkFUKTsKICAgICAgICBfdGFncy5wdXQoU3ViY2xhc3NGZXRjaE1vZGUuY2xh\nc3MsIFNVQkNMQVNTX0ZFVENIX01PREUpOwogICAgICAgIF90YWdzLnB1dChV\nbmlxdWUuY2xhc3MsIFVOSVFVRSk7CiAgICAgICAgX3RhZ3MucHV0KFZlcnNp\nb25Db2x1bW4uY2xhc3MsIFZFUlNJT05fQ09MKTsKICAgICAgICBfdGFncy5w\ndXQoVmVyc2lvbkNvbHVtbnMuY2xhc3MsIFZFUlNJT05fQ09MUyk7CiAgICAg\nICAgX3RhZ3MucHV0KFZlcnNpb25TdHJhdGVneS5jbGFzcywgVkVSU0lPTl9T\nVFJBVCk7CiAgICAgICAgX3RhZ3MucHV0KFhFbWJlZGRlZE1hcHBpbmcuY2xh\nc3MsIFhfRU1CRURERURfTUFQUElORyk7CiAgICAgICAgX3RhZ3MucHV0KFhK\nb2luQ29sdW1uLmNsYXNzLCBYX0pPSU5fQ09MKTsKICAgICAgICBfdGFncy5w\ndXQoWEpvaW5Db2x1bW5zLmNsYXNzLCBYX0pPSU5fQ09MUyk7CiAgICAgICAg\nX3RhZ3MucHV0KFhNYXBwaW5nT3ZlcnJpZGUuY2xhc3MsIFhfTUFQUElOR19P\nVkVSUklERSk7CiAgICAgICAgX3RhZ3MucHV0KFhNYXBwaW5nT3ZlcnJpZGVz\nLmNsYXNzLCBYX01BUFBJTkdfT1ZFUlJJREVTKTsKICAgICAgICBfdGFncy5w\ndXQoWFNlY29uZGFyeVRhYmxlLmNsYXNzLCBYX1NFQ09OREFSWV9UQUJMRSk7\nCiAgICAgICAgX3RhZ3MucHV0KFhTZWNvbmRhcnlUYWJsZXMuY2xhc3MsIFhf\nU0VDT05EQVJZX1RBQkxFUyk7CiAgICAgICAgX3RhZ3MucHV0KFhUYWJsZS5j\nbGFzcywgWF9UQUJMRSk7CiAgICB9CgogICAgcHVibGljIEFubm90YXRpb25Q\nZXJzaXN0ZW5jZU1hcHBpbmdQYXJzZXIoSkRCQ0NvbmZpZ3VyYXRpb24gY29u\nZikgewogICAgICAgIHN1cGVyKGNvbmYpOwogICAgICAgIF9kaWN0ID0gY29u\nZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VQYWNrYWdlTWFwcGluZ0Fu\nbm90YXRpb25zKFBhY2thZ2UgcGtnKSB7CiAgICAgICAgTWFwcGluZ1RhZyB0\nYWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBwa2cuZ2V0RGVj\nbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdz\nLmdldChhbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAo\ndGFnID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25Q\nYWNrYWdlTWFwcGluZ0Fubm90YXRpb24ocGtnLCBhbm5vKTsKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBz\nd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBUQUJMRV9HRU46\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VUYWJsZUdlbmVyYXRvcihwa2cs\nIChUYWJsZUdlbmVyYXRvcikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndCgidW5zdXBwb3J0ZWQiLCBwa2csCiAgICAgICAgICAgICAgICAgICAgICAg\nIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5k\nbGUgdW5rbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGJvb2xlYW4gaGFuZGxlVW5rbm93blBhY2thZ2VNYXBwaW5nQW5ub3RhdGlv\nbihQYWNrYWdlIHBrZywKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBAVGFibGVHZW5lcmF0b3IuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZVRhYmxlR2VuZXJhdG9yKEFubm90YXRlZEVsZW1lbnQgZWwsIFRhYmxl\nR2VuZXJhdG9yIGdlbikgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2VuLm5h\nbWUoKTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1nZW4tbmFtZSIsIGVsKSk7CgogICAgICAgIExvZyBsb2cgPSBn\nZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgicGFyc2UtZ2VuIiwgbmFt\nZSkpOwoKICAgICAgICBTZXF1ZW5jZU1hcHBpbmcgbWV0YSA9IChTZXF1ZW5j\nZU1hcHBpbmcpIGdldFJlcG9zaXRvcnkoKS4KICAgICAgICAgICAgZ2V0Q2Fj\naGVkU2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAgICBpZiAobWV0YSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImR1cC1nZW4i\nLCBuYW1lLCBlbCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBtZXRhID0gKFNlcXVlbmNlTWFwcGluZykgZ2V0UmVwb3NpdG9y\neSgpLmFkZFNlcXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAgbWV0YS5z\nZXRTZXF1ZW5jZVBsdWdpbihTZXF1ZW5jZU1hcHBpbmcuSU1QTF9WQUxVRV9U\nQUJMRSk7CiAgICAgICAgU3RyaW5nIHNjaGVtYSA9IF9kaWN0LmRlbGltaXRT\ndHJpbmcoZ2VuLnNjaGVtYSgpLCAKICAgICAgICAgICAgREJEaWN0aW9uYXJ5\nLkRCSWRlbnRpZmllcnMuVEFCTEVfR0VOX1NDSEVNQSk7CiAgICAgICAgU3Ry\naW5nIHRhYmxlID0gX2RpY3QuZGVsaW1pdFN0cmluZyhnZW4udGFibGUoKSwg\nCiAgICAgICAgICAgIERCRGljdGlvbmFyeS5EQklkZW50aWZpZXJzLlRBQkxF\nX0dFTl9UQUJMRSk7CiAgICAgICAgbWV0YS5zZXRUYWJsZSh0b1RhYmxlTmFt\nZShzY2hlbWEsdGFibGUpKTsKICAgICAgICBTdHJpbmcgcGtDb2x1bW5OYW1l\nID0gX2RpY3QuZGVsaW1pdFN0cmluZyhnZW4ucGtDb2x1bW5OYW1lKCksIAog\nICAgICAgICAgICBEQkRpY3Rpb25hcnkuREJJZGVudGlmaWVycy5UQUJMRV9H\nRU5fUEtfQ09MVU1OKTsKICAgICAgICBtZXRhLnNldFByaW1hcnlLZXlDb2x1\nbW4ocGtDb2x1bW5OYW1lKTsKICAgICAgICBTdHJpbmcgdmFsdWVDb2x1bW5O\nYW1lID0gX2RpY3QuZGVsaW1pdFN0cmluZyhnZW4udmFsdWVDb2x1bW5OYW1l\nKCksIAogICAgICAgICAgICBEQkRpY3Rpb25hcnkuREJJZGVudGlmaWVycy5U\nQUJMRV9HRU5fVkFMVUVfQ09MVU1OKTsKICAgICAgICBtZXRhLnNldFNlcXVl\nbmNlQ29sdW1uKHZhbHVlQ29sdW1uTmFtZSk7CiAgICAgICAgbWV0YS5zZXRQ\ncmltYXJ5S2V5VmFsdWUoZ2VuLnBrQ29sdW1uVmFsdWUoKSk7CiAgICAgICAg\nbWV0YS5zZXRJbml0aWFsVmFsdWUoZ2VuLmluaXRpYWxWYWx1ZSgpKTsKICAg\nICAgICBtZXRhLnNldEFsbG9jYXRlKGdlbi5hbGxvY2F0aW9uU2l6ZSgpKTsK\nICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBp\nbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgbWV0\nYS5TUkNfQU5OT1RBVElPTlMpOwogICAgICAgIAogICAgICAgIHN3aXRjaCAo\nZ2VuLnVuaXF1ZUNvbnN0cmFpbnRzKCkubGVuZ3RoKSB7CiAgICAgICAgY2Fz\nZSAwOiAKICAgICAgICAJYnJlYWs7IC8vIG5vdGhpbmcgdG8gZG8KICAgICAg\nICBjYXNlIDE6IAogICAgICAgIAltZXRhLnNldFVuaXF1ZUNvbHVtbnMoZ2Vu\nLnVuaXF1ZUNvbnN0cmFpbnRzKClbMF0uY29sdW1uTmFtZXMoKSk7CiAgICAg\nICAgCW1ldGEuc2V0VW5pcXVlQ29uc3RyYWludE5hbWUoZ2VuLnVuaXF1ZUNv\nbnN0cmFpbnRzKClbMF0ubmFtZSgpKTsKICAgICAgICAJYnJlYWs7CiAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAJbG9nLndhcm4oX2xvYy5nZXQoInVuaXF1\nZS1tYW55LW9uLXNlcS11bnN1cHBvcnRlZCIsIGVsLCBuYW1lKSk7CiAgICAg\nICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQg\ncGFyc2VDbGFzc01hcHBpbmdBbm5vdGF0aW9ucyhDbGFzc01ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBDbGFzc01hcHBpbmcgY20gPSAoQ2xhc3NNYXBwaW5n\nKSBtZXRhOwogICAgICAgIENsYXNzIGNscyA9IGNtLmdldERlc2NyaWJlZFR5\ncGUoKTsKCiAgICAgICAgTWFwcGluZ1RhZyB0YWc7CiAgICAgICAgZm9yIChB\nbm5vdGF0aW9uIGFubm8gOiBjbHMuZ2V0RGVjbGFyZWRBbm5vdGF0aW9ucygp\nKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5vLmFubm90YXRp\nb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGhhbmRsZVVua25vd25DbGFzc01hcHBpbmdBbm5vdGF0\naW9uKGNtLCBhbm5vKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAg\nICAgICAgICAgY2FzZSBBU1NPQ19PVkVSUklERToKICAgICAgICAgICAgICAg\nICAgICBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKGNtLCAoQXNzb2NpYXRp\nb25PdmVycmlkZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEFTU09DX09WRVJSSURFUzoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKGNtLCAo\nKEFzc29jaWF0aW9uT3ZlcnJpZGVzKSBhbm5vKS4KICAgICAgICAgICAgICAg\nICAgICAgICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEFUVFJfT1ZFUlJJREU6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoY20sIChBdHRy\naWJ1dGVPdmVycmlkZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFUVFJfT1ZFUlJJREVTOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKGNtLCAo\nKEF0dHJpYnV0ZU92ZXJyaWRlcykgYW5ubykuCiAgICAgICAgICAgICAgICAg\nICAgICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBESVNDUklNX0NPTDoKICAgICAgICAgICAg\nICAgICAgICBwYXJzZURpc2NyaW1pbmF0b3JDb2x1bW4oY20sIChEaXNjcmlt\naW5hdG9yQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgRElTQ1JJTV9WQUw6CiAgICAgICAg\nICAgICAgICAgICAgY20uZ2V0RGlzY3JpbWluYXRvcigpLmdldE1hcHBpbmdJ\nbmZvKCkuc2V0VmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgKCgoRGlz\nY3JpbWluYXRvclZhbHVlKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoTW9kaWZpZXIuaXNBYnN0cmFjdChjbS5nZXREZXNjcmli\nZWRUeXBlKCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRNb2Rp\nZmllcnMoKSkgJiYgZ2V0TG9nKCkuaXNJbmZvRW5hYmxlZCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGdldExvZygpLmluZm8oCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBfbG9jLmdldCgiZGlzY3JpbWluYXRvci1vbi1h\nYnN0cmFjdC1jbGFzcyIsIGNtCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIC5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBJTkhFUklUQU5DRToKICAgICAgICAg\nICAgICAgICAgICBwYXJzZUluaGVyaXRhbmNlKGNtLCAoSW5oZXJpdGFuY2Up\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBQS19KT0lOX0NPTDoKICAgICAgICAgICAgICAgICAgICBw\nYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhjbSwgKFByaW1hcnlLZXlKb2lu\nQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgUEtfSk9JTl9DT0xTOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5zKGNtLAogICAgICAg\nICAgICAgICAgICAgICAgICAoKFByaW1hcnlLZXlKb2luQ29sdW1ucykgYW5u\nbykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nU0VDT05EQVJZX1RBQkxFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlU2Vj\nb25kYXJ5VGFibGVzKGNtLCAoU2Vjb25kYXJ5VGFibGUpIGFubm8pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBT\nRUNPTkRBUllfVEFCTEVTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlU2Vj\nb25kYXJ5VGFibGVzKGNtLCAoKFNlY29uZGFyeVRhYmxlcykgYW5ubykudmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFNRTF9SRVNVTFRfU0VUX01BUFBJTkc6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VTUUxSZXN1bHRTZXRNYXBwaW5ncyhjbSwgKFNxbFJl\nc3VsdFNldE1hcHBpbmcpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTUUxfUkVTVUxUX1NFVF9NQVBQ\nSU5HUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZVNRTFJlc3VsdFNldE1h\ncHBpbmdzKGNtLCAoKFNxbFJlc3VsdFNldE1hcHBpbmdzKSBhbm5vKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlVGFibGUoY20sIChUYWJsZSkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAgICAgICBwYXJzZVRhYmxl\nR2VuZXJhdG9yKGNscywgKFRhYmxlR2VuZXJhdG9yKSBhbm5vKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgREFU\nQVNUT1JFX0lEX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZURhdGFT\ndG9yZUlkQ29sdW1uKGNtLCAoRGF0YVN0b3JlSWRDb2x1bW4pIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBESVNDUklNX1NUUkFUOgogICAgICAgICAgICAgICAgICAgIGNtLmdldERp\nc2NyaW1pbmF0b3IoKS5nZXRNYXBwaW5nSW5mbygpLnNldFN0cmF0ZWd5CiAg\nICAgICAgICAgICAgICAgICAgICAgICgoKERpc2NyaW1pbmF0b3JTdHJhdGVn\neSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEZLOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlRm9yZWlnbktleShjbS5nZXRNYXBwaW5nSW5mbygpLCAoRm9yZWln\nbktleSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIE1BUFBJTkdfT1ZFUlJJREU6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VNYXBwaW5nT3ZlcnJpZGVzKGNtLCAoTWFwcGluZ092\nZXJyaWRlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgTUFQUElOR19PVkVSUklERVM6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VNYXBwaW5nT3ZlcnJpZGVzKGNtLAogICAgICAg\nICAgICAgICAgICAgICAgICAoKE1hcHBpbmdPdmVycmlkZXMpIGFubm8pLnZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBTVFJBVDoKICAgICAgICAgICAgICAgICAgICBjbS5nZXRN\nYXBwaW5nSW5mbygpLnNldFN0cmF0ZWd5KCgoU3RyYXRlZ3kpIGFubm8pLnZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBTVUJDTEFTU19GRVRDSF9NT0RFOgogICAgICAgICAgICAg\nICAgICAgIGNtLnNldFN1YmNsYXNzRmV0Y2hNb2RlKHRvRWFnZXJGZXRjaE1v\nZGVDb25zdGFudAogICAgICAgICAgICAgICAgICAgICAgICAoKChTdWJjbGFz\nc0ZldGNoTW9kZSkgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBWRVJTSU9OX0NPTDoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZVZlcnNpb25Db2x1bW5zKGNtLCAo\nVmVyc2lvbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIFZFUlNJT05fQ09MUzoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZVZlcnNpb25Db2x1bW5zKGNtLCAoKFZlcnNp\nb25Db2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVkVSU0lPTl9TVFJBVDoK\nICAgICAgICAgICAgICAgICAgICBjbS5nZXRWZXJzaW9uKCkuZ2V0TWFwcGlu\nZ0luZm8oKS5zZXRTdHJhdGVneQogICAgICAgICAgICAgICAgICAgICAgICAo\nKChWZXJzaW9uU3RyYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBYX01BUFBJ\nTkdfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBwaW5n\nT3ZlcnJpZGVzKGNtLCAoWE1hcHBpbmdPdmVycmlkZSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFhf\nTUFQUElOR19PVkVSUklERVM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VN\nYXBwaW5nT3ZlcnJpZGVzKGNtLAogICAgICAgICAgICAgICAgICAgICAgICAo\nKFhNYXBwaW5nT3ZlcnJpZGVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgWF9UQUJM\nRToKICAgICAgICAgICAgICAgIGNhc2UgWF9TRUNPTkRBUllfVEFCTEU6CiAg\nICAgICAgICAgICAgICBjYXNlIFhfU0VDT05EQVJZX1RBQkxFUzoKICAgICAg\nICAgICAgICAgICAgICAvLyBubyBicmVhazsgbm90IHN1cHBvcnRlZCB5ZXQK\nICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1\ncHBvcnRlZCIsIGNtLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5vKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRp\nb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtu\nb3duQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbihDbGFzc01hcHBpbmcgY2xzLAog\nICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBBc3NvY2lhdGlvbk92\nZXJyaWRlKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VBc3Nv\nY2lhdGlvbk92ZXJyaWRlcyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgQXNz\nb2NpYXRpb25PdmVycmlkZS4uLiBhc3NvY3MpIHsKICAgICAgICBGaWVsZE1h\ncHBpbmcgc3VwOwogICAgICAgIEpvaW5Db2x1bW5bXSBzY29sczsKICAgICAg\nICBpbnQgdW5pcXVlOwogICAgICAgIExpc3Q8Q29sdW1uPiBqY29sczsKICAg\nICAgICBKb2luVGFibGUgam9pblRibDsKICAgICAgICBmb3IgKEFzc29jaWF0\naW9uT3ZlcnJpZGUgYXNzb2MgOiBhc3NvY3MpIHsKICAgICAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkoYXNzb2MubmFtZSgpKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tb3ZlcnJpZGUtbmFtZSIsIGNtKSk7CiAgICAgICAgICAgIHN1cCA9IChG\naWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoYXNz\nb2MubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20uYWRkRGVmaW5l\nZFN1cGVyY2xhc3NGaWVsZAogICAgICAgICAgICAgICAgICAgIChhc3NvYy5u\nYW1lKCksIE9iamVjdC5jbGFzcywgT2JqZWN0LmNsYXNzKTsKICAgICAgICAg\nICAgc2NvbHMgPSBhc3NvYy5qb2luQ29sdW1ucygpOwogICAgICAgICAgICBq\nb2luVGJsID0gYXNzb2Muam9pblRhYmxlKCk7CiAgICAgICAgICAgIGlmICgo\nc2NvbHMgPT0gbnVsbCB8fCBzY29scy5sZW5ndGggPT0gMCkgJiYgam9pblRi\nbCA9PSBudWxsKQogICAgICAgICAgICAgICAgLy9jb250aW51ZTsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAg\nICAgIHN1cCwgYXNzb2MubmFtZSgpKSk7CgogICAgICAgICAgICBpZiAoc2Nv\nbHMgIT0gbnVsbCAmJiBzY29scy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAg\nICAgICBqY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihzY29scy5sZW5n\ndGgpOwogICAgICAgICAgICAgICAgdW5pcXVlID0gMDsKICAgICAgICAgICAg\nICAgIGZvciAoSm9pbkNvbHVtbiBzY29sIDogc2NvbHMpIHsKICAgICAgICAg\nICAgICAgICAgICB1bmlxdWUgfD0gKHNjb2wudW5pcXVlKCkpID8gVFJVRSA6\nIEZBTFNFOwogICAgICAgICAgICAgICAgICAgIGpjb2xzLmFkZChuZXdDb2x1\nbW4oc2NvbCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nc2V0Q29sdW1ucyhzdXAsIHN1cC5nZXRWYWx1ZUluZm8oKSwgamNvbHMsIHVu\naXF1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoam9pblRibCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBwYXJzZUpvaW5UYWJsZShzdXAsIGpvaW5U\nYmwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgQEF0dHJpYnV0ZU92ZXJyaWRlKHMpLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoQ2xhc3NN\nYXBwaW5nIGNtLAogICAgICAgIEF0dHJpYnV0ZU92ZXJyaWRlLi4uIGF0dHJz\nKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIHN1cDsKICAgICAgICBmb3IgKEF0\ndHJpYnV0ZU92ZXJyaWRlIGF0dHIgOiBhdHRycykgewogICAgICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShhdHRyLm5hbWUoKSkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLW92ZXJyaWRlLW5hbWUiLCBjbSkpOwogICAgICAgICAgICBzdXAgPSAo\nRmllbGRNYXBwaW5nKSBjbS5nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKGF0\ndHIubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20uYWRkRGVmaW5l\nZFN1cGVyY2xhc3NGaWVsZChhdHRyLm5hbWUoKSwKICAgICAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAg\nIGlmIChhdHRyLmNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgICAgICBw\nYXJzZUNvbHVtbnMoc3VwLCBhdHRyLmNvbHVtbigpKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBpbmhlcml0YW5jZSBAUHJpbWFy\neUtleUpvaW5Db2x1bW4ocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhDbGFzc01hcHBpbmcgY20sCiAg\nICAgICAgUHJpbWFyeUtleUpvaW5Db2x1bW4uLi4gam9pbnMpIHsKICAgICAg\nICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihq\nb2lucy5sZW5ndGgpOwogICAgICAgIGZvciAoUHJpbWFyeUtleUpvaW5Db2x1\nbW4gam9pbiA6IGpvaW5zKQogICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1\nbW4oam9pbikpOwogICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29s\ndW1ucyhjb2xzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5l\ndyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2\nZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ29s\ndW1uIG5ld0NvbHVtbihQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2luKSB7CiAg\nICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBjb2wu\nc2V0RmxhZyhDb2x1bW4uRkxBR19QS19KT0lOLCB0cnVlKTsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5uYW1lKCkpKQogICAgICAg\nICAgICBjb2wuc2V0TmFtZShqb2luLm5hbWUoKSk7CiAgICAgICAgaWYgKCFT\ndHJpbmdVdGlscy5pc0VtcHR5KGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKSkK\nICAgICAgICAgICAgY29sLnNldFR5cGVOYW1lKGpvaW4uY29sdW1uRGVmaW5p\ndGlvbigpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9p\nbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNl\ndFRhcmdldChqb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpOwogICAgICAg\nIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAU2Vj\nb25kYXJ5VGFibGUocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZVNlY29uZGFyeVRhYmxlcyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgU2Vj\nb25kYXJ5VGFibGUuLi4gdGFibGVzKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nSW5mbyBpbmZvID0gY20uZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBMb2cg\nbG9nID0gZ2V0TG9nKCk7CgogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAg\nIFN0cmluZyBzY2hlbWE7CiAgICAgICAgTGlzdDxDb2x1bW4+IGpvaW5zID0g\nbnVsbDsKICAgICAgICBmb3IgKFNlY29uZGFyeVRhYmxlIHRhYmxlIDogdGFi\nbGVzKSB7CiAgICAgICAgICAgIG5hbWUgPSBfZGljdC5kZWxpbWl0U3RyaW5n\nKHRhYmxlLm5hbWUoKSwKICAgICAgICAgICAgICAgIERCRGljdGlvbmFyeS5E\nQklkZW50aWZpZXJzLlNFQ09OREFSWV9UQUJMRV9OQU1FKSA7CiAgICAgICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJz\nZWNvbmQtbmFtZSIsIGNtKSk7CiAgICAgICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eSh0YWJsZS5zY2hlbWEoKSkpIHsKICAgICAgICAgICAgICAg\nIHNjaGVtYSA9IF9kaWN0LmRlbGltaXRTdHJpbmcodGFibGUuc2NoZW1hKCks\nCiAgICAgICAgICAgICAgICAgICAgREJEaWN0aW9uYXJ5LkRCSWRlbnRpZmll\ncnMuU0VDT05EQVJZX1RBQkxFX1NDSEVNQSk7CiAgICAgICAgICAgICAgICBu\nYW1lID0gc2NoZW1hICsgIi4iICsgbmFtZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAodGFibGUucGtKb2luQ29sdW1ucygpLmxlbmd0aCA+IDAp\nIHsKICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3IEFycmF5TGlzdDxDb2x1\nbW4+KHRhYmxlLnBrSm9pbkNvbHVtbnMoKS5sZW5ndGgpOwogICAgICAgICAg\nICAgICAgZm9yIChQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2luIDogdGFibGUu\ncGtKb2luQ29sdW1ucygpKQogICAgICAgICAgICAgICAgICAgIGpvaW5zLmFk\nZChuZXdDb2x1bW4oam9pbikpOwogICAgICAgICAgICAgICAgaW5mby5zZXRT\nZWNvbmRhcnlUYWJsZUpvaW5Db2x1bW5zKG5hbWUsIGpvaW5zKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgCWluZm8uYWRkU2Vjb25kYXJ5\nVGFibGUobmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkVW5p\ncXVlQ29uc3RyYWludHMobmFtZSwgY20sIGluZm8sIHRhYmxlLnVuaXF1ZUNv\nbnN0cmFpbnRzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCBjbGFzcyB0YWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlVGFibGUoQ2xhc3NNYXBwaW5nIGNtLCBUYWJsZSB0YWJsZSkgewogICAg\nICAgIFN0cmluZyB0YWJsZU5hbWUgPSBfZGljdC5kZWxpbWl0U3RyaW5nKHRh\nYmxlLm5hbWUoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIERCRGljdGlv\nbmFyeS5EQklkZW50aWZpZXJzLlRBQkxFX05BTUUpOwogICAgICAgIFN0cmlu\nZyBzY2hlbWFOYW1lID0gX2RpY3QuZGVsaW1pdFN0cmluZyh0YWJsZS5zY2hl\nbWEoKSwKICAgICAgICAgICAgREJEaWN0aW9uYXJ5LkRCSWRlbnRpZmllcnMu\nVEFCTEVfU0NIRU1BKTsKICAgICAgICBTdHJpbmcgZnVsbFRhYmxlTmFtZSA9\nIHRvVGFibGVOYW1lKHNjaGVtYU5hbWUsIHRhYmxlTmFtZSk7CiAgICAgICAg\naWYgKGZ1bGxUYWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgY20uZ2V0\nTWFwcGluZ0luZm8oKS5zZXRUYWJsZU5hbWUoZnVsbFRhYmxlTmFtZSk7Cgog\nICAgICAgIGFkZFVuaXF1ZUNvbnN0cmFpbnRzKGZ1bGxUYWJsZU5hbWUsIGNt\nLCBjbS5nZXRNYXBwaW5nSW5mbygpLCAKICAgICAgICAJCXRhYmxlLnVuaXF1\nZUNvbnN0cmFpbnRzKCkpOwogICAgfQogICAgCiAgICBVbmlxdWUgY3JlYXRl\nVW5pcXVlQ29uc3RyYWludChNZXRhRGF0YUNvbnRleHQgY3R4LCBVbmlxdWVD\nb25zdHJhaW50IGFubm8pIHsKICAgICAgICBTdHJpbmdbXSBjb2x1bW5OYW1l\ncyA9IGFubm8uY29sdW1uTmFtZXMoKTsKICAgICAgICBpZiAoY29sdW1uTmFt\nZXMgPT0gbnVsbCB8fCBjb2x1bW5OYW1lcy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInVuaXF1\nZS1uby1jb2x1bW4iLCBjdHgpKTsKICAgICAgICBVbmlxdWUgdW5pcXVlQ29u\nc3RyYWludCA9IG5ldyBVbmlxdWUoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHVtbk5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGNvbHVtbk5hbWVzW2ldKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ1bmlxdWUtZW1wdHktY29sdW1uIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgQXJyYXlzLnRvU3RyaW5nKGNvbHVtbk5hbWVzKSwgY3R4KSk7CiAgICAg\nICAgICAgIENvbHVtbiBjb2x1bW4gPSBuZXcgQ29sdW1uKCk7CiAgICAgICAg\nICAgIGNvbHVtbi5zZXROYW1lKGNvbHVtbk5hbWVzW2ldKTsKICAgICAgICAg\nICAgdW5pcXVlQ29uc3RyYWludC5hZGRDb2x1bW4oY29sdW1uKTsKICAgICAg\nICB9CiAgICAgICAgU3RyaW5nIG5hbWUgPSBhbm5vLm5hbWUoKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpIHsKICAgICAgICAg\nICAgdW5pcXVlQ29uc3RyYWludC5zZXROYW1lKG5hbWUpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdW5pcXVlQ29uc3RyYWludDsKICAgIH0KICAgIAog\nICAgdm9pZCBhZGRVbmlxdWVDb25zdHJhaW50cyhTdHJpbmcgdGFibGUsIE1l\ndGFEYXRhQ29udGV4dCBjdHgsCiAgICAgICAgTWFwcGluZ0luZm8gaW5mbywg\nVW5pcXVlQ29uc3RyYWludC4uLiB1bmlxdWVDb25zdHJhaW50cykgewogICAg\nICAgIGZvciAoVW5pcXVlQ29uc3RyYWludCBhbm5vIDogdW5pcXVlQ29uc3Ry\nYWludHMpIHsKICAgICAgICAgICAgVW5pcXVlIHVuaXF1ZSA9IGNyZWF0ZVVu\naXF1ZUNvbnN0cmFpbnQoY3R4LCBhbm5vKTsKICAgICAgICAgICAgdW5pcXVl\nLnNldFRhYmxlTmFtZSh0YWJsZSk7CiAgICAgICAgICAgIGlmIChpbmZvIGlu\nc3RhbmNlb2YgQ2xhc3NNYXBwaW5nSW5mbykKICAgICAgICAgICAgICAgICgo\nQ2xhc3NNYXBwaW5nSW5mbykgaW5mbykuYWRkVW5pcXVlKHRhYmxlLCB1bmlx\ndWUpOwogICAgICAgICAgICBlbHNlIGlmIChpbmZvIGluc3RhbmNlb2YgRmll\nbGRNYXBwaW5nSW5mbykKICAgICAgICAgICAgICAgICgoRmllbGRNYXBwaW5n\nSW5mbykgaW5mbykuYWRkSm9pblRhYmxlVW5pcXVlKHVuaXF1ZSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5h\nbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEZvcm0gYSBxdWFsaWZpZWQgdGFibGUgbmFtZSBmcm9tIGEgc2NoZW1hIGFu\nZCB0YWJsZSBuYW1lLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJp\nbmcgdG9UYWJsZU5hbWUoU3RyaW5nIHNjaGVtYSwgU3RyaW5nIHRhYmxlKSB7\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkodGFibGUpKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShzY2hlbWEpKQogICAgICAgICAgICByZXR1cm4gdGFibGU7CiAg\nICAgICAgcmV0dXJuIHNjaGVtYSArICIuIiArIHRhYmxlOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2VzIHRoZSBnaXZlbiBhbm5vdGF0aW9uIHRvIGNy\nZWF0ZSBhbmQgY2FjaGUgYQogICAgICoge0BsaW5rIFNRTFJlc3VsdFNldE1h\ncHBpbmdNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZVNRTFJlc3VsdFNldE1hcHBpbmdzKENsYXNzTWFwcGluZyBjbSwKICAgICAg\nICBTcWxSZXN1bHRTZXRNYXBwaW5nLi4uIGFubm9zKSB7CiAgICAgICAgTWFw\ncGluZ1JlcG9zaXRvcnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9zaXRvcnkpIGdl\ndFJlcG9zaXRvcnkoKTsKICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAg\nICAgICAgZm9yIChTcWxSZXN1bHRTZXRNYXBwaW5nIGFubm8gOiBhbm5vcykg\newogICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoInBhcnNlLXNxbHJzbWFw\ncGluZyIsIGFubm8ubmFtZSgpKSk7CgogICAgICAgICAgICBRdWVyeVJlc3Vs\ndE1hcHBpbmcgcmVzdWx0ID0gcmVwb3MuZ2V0Q2FjaGVkUXVlcnlSZXN1bHRN\nYXBwaW5nCiAgICAgICAgICAgICAgICAobnVsbCwgYW5uby5uYW1lKCkpOwog\nICAgICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJkdXAtc3FscnNtYXBwaW5nIiwgYW5u\nby5uYW1lKCksIGNtKSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0ID0gcmVwb3MuYWRkUXVl\ncnlSZXN1bHRNYXBwaW5nKG51bGwsIGFubm8ubmFtZSgpKTsKICAgICAgICAg\nICAgcmVzdWx0LnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIGNtLmdldERl\nc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgIHJlc3VsdC5TUkNfQU5O\nT1RBVElPTlMpOwoKICAgICAgICAgICAgZm9yIChFbnRpdHlSZXN1bHQgZW50\naXR5IDogYW5uby5lbnRpdGllcygpKSB7CiAgICAgICAgICAgICAgICBRdWVy\neVJlc3VsdE1hcHBpbmcuUENSZXN1bHQgZW50aXR5UmVzdWx0ID0gcmVzdWx0\nLmFkZFBDUmVzdWx0CiAgICAgICAgICAgICAgICAgICAgKGVudGl0eS5lbnRp\ndHlDbGFzcygpKTsKICAgICAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShlbnRpdHkuZGlzY3JpbWluYXRvckNvbHVtbigpKSkKICAgICAg\nICAgICAgICAgICAgICBlbnRpdHlSZXN1bHQuYWRkTWFwcGluZyhlbnRpdHlS\nZXN1bHQuRElTQ1JJTUlOQVRPUiwKICAgICAgICAgICAgICAgICAgICAgICAg\nZW50aXR5LmRpc2NyaW1pbmF0b3JDb2x1bW4oKSk7CgogICAgICAgICAgICAg\nICAgZm9yIChGaWVsZFJlc3VsdCBmaWVsZCA6IGVudGl0eS5maWVsZHMoKSkK\nICAgICAgICAgICAgICAgICAgICBlbnRpdHlSZXN1bHQuYWRkTWFwcGluZyhm\naWVsZC5uYW1lKCksIGZpZWxkLmNvbHVtbigpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBmb3IgKENvbHVtblJlc3VsdCBjb2x1bW4gOiBhbm5vLmNv\nbHVtbnMoKSkKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGRDb2x1bW5SZXN1\nbHQoY29sdW1uLm5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgQERpc2NyaW1pbmF0b3JDb2x1bW4uCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwYXJzZURpc2NyaW1pbmF0b3JDb2x1bW4oQ2xhc3NN\nYXBwaW5nIGNtLAogICAgICAgIERpc2NyaW1pbmF0b3JDb2x1bW4gZGNvbCkg\newogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGRjb2wubmFtZSgpKSkKICAgICAg\nICAgICAgY29sLnNldE5hbWUoZGNvbC5uYW1lKCkpOwogICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShkY29sLmNvbHVtbkRlZmluaXRpb24oKSkp\nCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShkY29sLmNvbHVtbkRlZmlu\naXRpb24oKSk7CiAgICAgICAgRGlzY3JpbWluYXRvciBkaXNjcmltID0gY20u\nZ2V0RGlzY3JpbWluYXRvcigpOwogICAgICAgIHN3aXRjaCAoZGNvbC5kaXNj\ncmltaW5hdG9yVHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgQ0hBUjoKICAg\nICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShKYXZhVHlwZXMuQ0hBUik7\nCiAgICAgICAgICAgICAgICBkaXNjcmltLnNldEphdmFUeXBlKEphdmFUeXBl\ncy5DSEFSKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIElOVEVHRVI6CiAgICAgICAgICAgICAgICBjb2wuc2V0SmF2YVR5cGUo\nSmF2YVR5cGVzLklOVCk7CiAgICAgICAgICAgICAgICBpZiAoZGNvbC5sZW5n\ndGgoKSAhPSAzMSkKICAgICAgICAgICAgICAgICAgICBjb2wuc2V0U2l6ZShk\nY29sLmxlbmd0aCgpKTsKICAgICAgICAgICAgICAgIGRpc2NyaW0uc2V0SmF2\nYVR5cGUoSmF2YVR5cGVzLklOVCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbC5zZXRK\nYXZhVHlwZShKYXZhVHlwZXMuU1RSSU5HKTsKICAgICAgICAgICAgICAgIGNv\nbC5zZXRTaXplKGRjb2wubGVuZ3RoKCkpOwogICAgICAgICAgICAgICAgZGlz\nY3JpbS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuU1RSSU5HKTsKICAgICAgICB9\nCiAgICAgICAgY20uZ2V0RGlzY3JpbWluYXRvcigpLmdldE1hcHBpbmdJbmZv\nKCkuc2V0Q29sdW1ucwogICAgICAgICAgICAoQXJyYXlzLmFzTGlzdChuZXcg\nQ29sdW1uW117IGNvbCB9KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBASW5oZXJpdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZUluaGVyaXRhbmNlKENsYXNzTWFwcGluZyBjbSwgSW5oZXJpdGFuY2UgaW5o\nZXJpdCkgewogICAgICAgIENsYXNzTWFwcGluZ0luZm8gaW5mbyA9IGNtLmdl\ndE1hcHBpbmdJbmZvKCk7CiAgICAgICAgc3dpdGNoIChpbmhlcml0LnN0cmF0\nZWd5KCkpIHsKICAgICAgICAgICAgY2FzZSBTSU5HTEVfVEFCTEU6CiAgICAg\nICAgICAgICAgICBpbmZvLnNldEhpZXJhcmNoeVN0cmF0ZWd5KEZsYXRDbGFz\nc1N0cmF0ZWd5LkFMSUFTKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEpPSU5FRDoKICAgICAgICAgICAgICAgIGluZm8uc2V0\nSGllcmFyY2h5U3RyYXRlZ3koVmVydGljYWxDbGFzc1N0cmF0ZWd5LkFMSUFT\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFRB\nQkxFX1BFUl9DTEFTUzoKICAgICAgICAgICAgICAgIGluZm8uc2V0SGllcmFy\nY2h5U3RyYXRlZ3koRnVsbENsYXNzU3RyYXRlZ3kuQUxJQVMpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBjbGFzcy1sZXZlbCBA\nTWFwcGluZ092ZXJyaWRlKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VNYXBwaW5nT3ZlcnJpZGVzKENsYXNzTWFwcGluZyBjbSwKICAgICAg\nICBNYXBwaW5nT3ZlcnJpZGUuLi4gb3ZlcnMpIHsKICAgICAgICBGaWVsZE1h\ncHBpbmcgc3VwOwogICAgICAgIGZvciAoTWFwcGluZ092ZXJyaWRlIG92ZXIg\nOiBvdmVycykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShvdmVyLm5hbWUoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW92ZXJyaWRlLW5hbWUiLCBj\nbSkpOwogICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5nZXRE\nZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKG92ZXIubmFtZSgpKTsKICAgICAgICAg\nICAgaWYgKHN1cCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3VwID0gKEZp\nZWxkTWFwcGluZykgY20uYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChvdmVy\nLm5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIE9i\namVjdC5jbGFzcyk7CiAgICAgICAgICAgIHBvcHVsYXRlKHN1cCwgb3Zlcik7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUG9wdWxhdGUgdGhl\nIGdpdmVuIGZpZWxkIGZyb20gb3ZlcnJpZGUgZGF0YS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBvcHVsYXRlKEZpZWxkTWFwcGluZyBmbSwgTWFwcGlu\nZ092ZXJyaWRlIG92ZXIpIHsKICAgICAgICBpZiAob3Zlci5jb250YWluZXJU\nYWJsZSgpLnNwZWNpZmllZCgpKQogICAgICAgICAgICBwYXJzZUNvbnRhaW5l\nclRhYmxlKGZtLCBvdmVyLmNvbnRhaW5lclRhYmxlKCkpOwogICAgICAgIHBh\ncnNlQ29sdW1ucyhmbSwgb3Zlci5jb2x1bW5zKCkpOwogICAgICAgIHBhcnNl\nWEpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwgb3Zl\nci5qb2luQ29sdW1ucygpKTsKICAgICAgICBwYXJzZUVsZW1lbnRKb2luQ29s\ndW1ucyhmbSwgb3Zlci5lbGVtZW50Sm9pbkNvbHVtbnMoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBkYXRhc3RvcmUgaWRlbnRpdHkgaW5mb3Jt\nYXRpb24gaW4gQERhdGFTdG9yZUlkQ29sdW1uLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VEYXRhU3RvcmVJZENvbHVtbihDbGFzc01hcHBpbmcg\nY20sIERhdGFTdG9yZUlkQ29sdW1uIGlkKSB7CiAgICAgICAgQ29sdW1uIGNv\nbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoaWQubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoaWQu\nbmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoaWQu\nY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNldFR5cGVO\nYW1lKGlkLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKGlkLnBy\nZWNpc2lvbigpICE9IDApCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGlkLnBy\nZWNpc2lvbigpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19V\nTklOU0VSVEFCTEUsICFpZC5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5z\nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhaWQudXBkYXRhYmxl\nKCkpOwogICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucyhB\ncnJheXMuYXNMaXN0KG5ldyBDb2x1bW5bXXsgY29sIH0pKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIHRoZSBnaXZlbiBmb3JlaWduIGtleS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRm9yZWlnbktleShNYXBwaW5n\nSW5mbyBpbmZvLCBGb3JlaWduS2V5IGZrKSB7CiAgICAJaWYgKCFmay5pbXBs\naWNpdCgpKSB7CiAgICAJCXBhcnNlRm9yZWlnbktleShpbmZvLCBmay5uYW1l\nKCksIGZrLmVuYWJsZWQoKSwgZmsuZGVmZXJyZWQoKSwKICAgIAkJCQlmay5k\nZWxldGVBY3Rpb24oKSwgZmsudXBkYXRlQWN0aW9uKCkpOwogICAgCX0gZWxz\nZSB7CiAgICAgICAgICAgIGluZm8uc2V0SW1wbGljaXRSZWxhdGlvbih0cnVl\nKTsKICAgICAgICAgICAgYXNzZXJ0RGVmYXVsdChmayk7CiAgICAJfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IGZvcmVpZ24ga2V5IGRhdGEgb24gdGhl\nIGdpdmVuIG1hcHBpbmcgaW5mby4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgcGFyc2VGb3JlaWduS2V5KE1hcHBpbmdJbmZvIGluZm8sIFN0cmluZyBu\nYW1lLAogICAgICAgIGJvb2xlYW4gZW5hYmxlZCwgYm9vbGVhbiBkZWZlcnJl\nZCwgRm9yZWlnbktleUFjdGlvbiBkZWxldGVBY3Rpb24sCiAgICAgICAgRm9y\nZWlnbktleUFjdGlvbiB1cGRhdGVBY3Rpb24pIHsKICAgICAgICBpZiAoIWVu\nYWJsZWQpIHsKICAgICAgICAgICAgaW5mby5zZXRDYW5Gb3JlaWduS2V5KGZh\nbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkgZmsg\nPQogICAgICAgICAgICBuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGZrLnNldE5hbWUobmFtZSk7CiAg\nICAgICAgZmsuc2V0RGVmZXJyZWQoZGVmZXJyZWQpOwogICAgICAgIGZrLnNl\ndERlbGV0ZUFjdGlvbih0b0ZvcmVpZ25LZXlBY3Rpb24oZGVsZXRlQWN0aW9u\nKSk7CiAgICAgICAgZmsuc2V0VXBkYXRlQWN0aW9uKHRvRm9yZWlnbktleUFj\ndGlvbih1cGRhdGVBY3Rpb24pKTsKICAgICAgICBpbmZvLnNldEZvcmVpZ25L\nZXkoZmspOwogICAgfQogICAgCiAgICB2b2lkIGFzc2VydERlZmF1bHQoRm9y\nZWlnbktleSBmaykgewogICAgICAgIGJvb2xlYW4gaXNEZWZhdWx0ID0gU3Ry\naW5nVXRpbHMuaXNFbXB0eShmay5uYW1lKCkpIAogICAgICAgICAgICAmJiBm\nay5lbmFibGVkKCkgCiAgICAgICAgICAgICYmICFmay5kZWZlcnJlZCgpIAog\nICAgICAgICAgICAgICAgJiYgZmsuZGVsZXRlQWN0aW9uKCkgPT0gRm9yZWln\nbktleUFjdGlvbi5SRVNUUklDVAogICAgICAgICAgICAgICAgJiYgZmsudXBk\nYXRlQWN0aW9uKCkgPT0gRm9yZWlnbktleUFjdGlvbi5SRVNUUklDVAogICAg\nICAgICAgICAmJiBmay5jb2x1bW5OYW1lcygpLmxlbmd0aCA9PSAwCiAgICAg\nICAgICAgICYmIGZrLnNwZWNpZmllZCgpOwogICAgICAgIGlmICghaXNEZWZh\ndWx0KQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgiaW1wbGljaXQtbm9uLWRlZmF1bHQtZmsiLCBfY2xzLAogICAgICAg\nICAgICAgICAgZ2V0U291cmNlRmlsZSgpKS5nZXRNZXNzYWdlKCkpOwogICAg\nfQogICAgCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IG91ciBGSyBhY3Rpb24g\nZW51bSB0byBhbiBpbnRlcm5hbCBPcGVuSlBBIGFjdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBpbnQgdG9Gb3JlaWduS2V5QWN0aW9uKEZvcmVpZ25LZXlB\nY3Rpb24gYWN0aW9uKSB7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAg\nICAgICAgICAgY2FzZSBSRVNUUklDVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleS4K\nICAgICAgICAgICAgICAgICAgICAgICAgQUNUSU9OX1JFU1RSSUNUOwogICAg\nICAgICAgICBjYXNlIENBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkuQUNU\nSU9OX0NBU0NBREU7CiAgICAgICAgICAgIGNhc2UgTlVMTDoKICAgICAgICAg\nICAgICAgIHJldHVybiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nRm9yZWlnbktleS5BQ1RJT05fTlVMTDsKICAgICAgICAgICAgY2FzZSBERUZB\nVUxUOgogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOwogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgdGhlIGdpdmVuIGluZGV4LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VJbmRleChNYXBwaW5nSW5mbyBpbmZvLCBJbmRleCBp\nZHgpIHsKICAgICAgICBwYXJzZUluZGV4KGluZm8sIGlkeC5uYW1lKCksIGlk\neC5lbmFibGVkKCksIGlkeC51bmlxdWUoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgaW5kZXggZGF0YSBvbiB0aGUgZ2l2ZW4gbWFwcGluZyBpbmZv\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUluZGV4KE1hcHBp\nbmdJbmZvIGluZm8sIFN0cmluZyBuYW1lLAogICAgICAgIGJvb2xlYW4gZW5h\nYmxlZCwgYm9vbGVhbiB1bmlxdWUpIHsKICAgICAgICBpZiAoIWVuYWJsZWQp\nIHsKICAgICAgICAgICAgaW5mby5zZXRDYW5JbmRleChmYWxzZSk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleCBpZHggPQogICAgICAgICAgICBu\nZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkluZGV4KCk7CiAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAg\nICAgICBpZHguc2V0TmFtZShuYW1lKTsKICAgICAgICBpZHguc2V0VW5pcXVl\nKHVuaXF1ZSk7CiAgICAgICAgaW5mby5zZXRJbmRleChpZHgpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHVuaXF1ZSBkYXRhIG9uIHRoZSBnaXZlbiBt\nYXBwaW5nIGluZm8uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVVu\naXF1ZShGaWVsZE1hcHBpbmcgZm0sIAogICAgICAgIG9yZy5hcGFjaGUub3Bl\nbmpwYS5wZXJzaXN0ZW5jZS5qZGJjLlVuaXF1ZSBhbm5vKSB7CiAgICAgICAg\nVmFsdWVNYXBwaW5nSW5mbyBpbmZvID0gZm0uZ2V0VmFsdWVJbmZvKCk7CiAg\nICAgICAgaWYgKCFhbm5vLmVuYWJsZWQoKSkgewogICAgICAgICAgICBpbmZv\nLnNldENhblVuaXF1ZShmYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5VbmlxdWUgdW5xID0gCiAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlKCk7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGFubm8ubmFtZSgpKSkKICAgICAgICAgICAgdW5x\nLnNldE5hbWUoYW5uby5uYW1lKCkpOwogICAgICAgIHVucS5zZXREZWZlcnJl\nZChhbm5vLmRlZmVycmVkKCkpOwogICAgICAgIGluZm8uc2V0VW5pcXVlKHVu\ncSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAVmVyc2lvbkNvbHVt\nbihzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVmVyc2lvbkNv\nbHVtbnMoQ2xhc3NNYXBwaW5nIGNtLCBWZXJzaW9uQ29sdW1uLi4uIHZjb2xz\nKSB7CiAgICAgICAgaWYgKHZjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFy\ncmF5TGlzdDxDb2x1bW4+KHZjb2xzLmxlbmd0aCk7CiAgICAgICAgZm9yIChW\nZXJzaW9uQ29sdW1uIHZjb2wgOiB2Y29scykKICAgICAgICAgICAgY29scy5h\nZGQobmV3Q29sdW1uKHZjb2wpKTsKICAgICAgICBjbS5nZXRWZXJzaW9uKCku\nZ2V0TWFwcGluZ0luZm8oKS5zZXRDb2x1bW5zKGNvbHMpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBp\nbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKFZlcnNpb25D\nb2x1bW4gYW5ubykgewogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1u\nKCk7CiAgICAgICAgY29sLnNldFRhYmxlTmFtZShhbm5vLnRhYmxlKCkpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGFubm8ubmFtZSgpKTsKICAgICAg\nICBpZiAoYW5uby5wcmVjaXNpb24oKSAhPSAwKQogICAgICAgICAgICBjb2wu\nc2V0U2l6ZShhbm5vLnByZWNpc2lvbigpKTsKICAgICAgICBlbHNlIGlmIChh\nbm5vLmxlbmd0aCgpICE9IDI1NSkKICAgICAgICAgICAgY29sLnNldFNpemUo\nYW5uby5sZW5ndGgoKSk7CiAgICAgICAgY29sLnNldE5vdE51bGwoIWFubm8u\nbnVsbGFibGUoKSk7CiAgICAgICAgY29sLnNldERlY2ltYWxEaWdpdHMoYW5u\nby5zY2FsZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\nYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpKSB7CiAgICAgICAgICAgIGNvbC5z\nZXRUeXBlTmFtZShhbm5vLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAg\nICAgIGNvbC5zZXRUeXBlKFNjaGVtYXMuZ2V0SkRCQ1R5cGUoY29sLmdldFR5\ncGVOYW1lKCkpKTsKICAgICAgICAgICAgY29sLnNldEphdmFUeXBlKEphdmFU\neXBlcy5nZXRUeXBlQ29kZShTY2hlbWFzLmdldEphdmFUeXBlCiAgICAgICAg\nICAgIAkoY29sLmdldFR5cGUoKSwgY29sLmdldFNpemUoKSwgY29sLmdldERl\nY2ltYWxEaWdpdHMoKSkpKTsKICAgICAgICB9CiAgICAgICAgY29sLnNldEZs\nYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhYW5uby5pbnNlcnRhYmxl\nKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRB\nQkxFLCAhYW5uby51cGRhdGFibGUoKSk7CiAgICAgICAgcmV0dXJuIGNvbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNsYXNzLWxldmVsIEBYTWFw\ncGluZ092ZXJyaWRlKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VNYXBwaW5nT3ZlcnJpZGVzKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBY\nTWFwcGluZ092ZXJyaWRlLi4uIG92ZXJzKSB7CiAgICAgICAgRmllbGRNYXBw\naW5nIHN1cDsKICAgICAgICBmb3IgKFhNYXBwaW5nT3ZlcnJpZGUgb3ZlciA6\nIG92ZXJzKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5\nKG92ZXIubmFtZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tb3ZlcnJpZGUtbmFtZSIsIGNt\nKSk7CiAgICAgICAgICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNtLmdldERl\nZmluZWRTdXBlcmNsYXNzRmllbGQob3Zlci5uYW1lKCkpOwogICAgICAgICAg\nICBpZiAoc3VwID09IG51bGwpCiAgICAgICAgICAgICAgICBzdXAgPSAoRmll\nbGRNYXBwaW5nKSBjbS5hZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKG92ZXIu\nbmFtZSgpLAogICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgT2Jq\nZWN0LmNsYXNzKTsKICAgICAgICAgICAgcG9wdWxhdGUoc3VwLCBvdmVyKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQb3B1bGF0ZSB0aGUg\nZ2l2ZW4gZmllbGQgZnJvbSBvdmVycmlkZSBkYXRhLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcG9wdWxhdGUoRmllbGRNYXBwaW5nIGZtLCBYTWFwcGlu\nZ092ZXJyaWRlIG92ZXIpIHsKICAgICAgICBpZiAob3Zlci5jb250YWluZXJU\nYWJsZSgpLnNwZWNpZmllZCgpKQogICAgICAgICAgICBwYXJzZUNvbnRhaW5l\nclRhYmxlKGZtLCBvdmVyLmNvbnRhaW5lclRhYmxlKCkpOwogICAgICAgIHBh\ncnNlQ29sdW1ucyhmbSwgb3Zlci5jb2x1bW5zKCkpOwogICAgICAgIHBhcnNl\nWEpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwgb3Zl\nci5qb2luQ29sdW1ucygpKTsKICAgICAgICBwYXJzZUVsZW1lbnRDb2x1bW5z\nKGZtLCBvdmVyLmVsZW1lbnRDb2x1bW5zKCkpOwogICAgICAgIHBhcnNlRWxl\nbWVudEpvaW5Db2x1bW5zKGZtLCBvdmVyLmVsZW1lbnRKb2luQ29sdW1ucygp\nKTsKICAgICAgICBwYXJzZUtleUNvbHVtbnMoZm0sIG92ZXIua2V5Q29sdW1u\ncygpKTsKICAgICAgICBwYXJzZUtleUpvaW5Db2x1bW5zKGZtLCBvdmVyLmtl\neUpvaW5Db2x1bW5zKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQEVsZW1lbnRDb2x1bW4ocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZUVsZW1lbnRDb2x1bW5zKEZpZWxkTWFwcGluZyBmbSwgRWxlbWVudENv\nbHVtbi4uLiBwY29scykgewogICAgICAgIGlmIChwY29scy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4g\nY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihwY29scy5sZW5ndGgpOwog\nICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgcGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29scy5h\nZGQobmV3Q29sdW1uKHBjb2xzW2ldKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8\nPSAocGNvbHNbaV0udW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAg\nIH0KICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRFbGVtZW50TWFwcGlu\nZygpLmdldFZhbHVlSW5mbygpLCBjb2xzLCB1bmlxdWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBp\nbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKEVsZW1lbnRD\nb2x1bW4gYW5ubykgewogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1u\nKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubmFt\nZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoYW5uby5uYW1lKCkpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLmNvbHVtbkRl\nZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShhbm5v\nLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKGFubm8ucHJlY2lz\naW9uKCkgIT0gMCkKICAgICAgICAgICAgY29sLnNldFNpemUoYW5uby5wcmVj\naXNpb24oKSk7CiAgICAgICAgZWxzZSBpZiAoYW5uby5sZW5ndGgoKSAhPSAy\nNTUpCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8ubGVuZ3RoKCkpOwog\nICAgICAgIGNvbC5zZXROb3ROdWxsKCFhbm5vLm51bGxhYmxlKCkpOwogICAg\nICAgIGNvbC5zZXREZWNpbWFsRGlnaXRzKGFubm8uc2NhbGUoKSk7CiAgICAg\nICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhYW5u\nby5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5G\nTEFHX1VOVVBEQVRBQkxFLCAhYW5uby51cGRhdGFibGUoKSk7CiAgICAgICAg\ncmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBLZXlK\nb2luQ29sdW1uKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VL\nZXlKb2luQ29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sIEtleUpvaW5Db2x1bW4u\nLi4gam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMubGVuZ3RoID09IDApCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMg\nPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9pbnMubGVuZ3RoKTsKICAgICAg\nICBpbnQgdW5pcXVlID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbHMuYWRkKG5l\nd0NvbHVtbihqb2luc1tpXSkpOwogICAgICAgICAgICB1bmlxdWUgfD0gKGpv\naW5zW2ldLnVuaXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICB9CiAg\nICAgICAgc2V0Q29sdW1ucyhmbSwgZm0uZ2V0S2V5TWFwcGluZygpLmdldFZh\nbHVlSW5mbygpLCBjb2xzLCB1bmlxdWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogIENyZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRp\nb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgQ29sdW1uIG5ld0NvbHVtbihLZXlKb2luQ29sdW1uIGpv\naW4pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkpCiAg\nICAgICAgICAgIGNvbC5zZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0aW9u\nKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShqb2luLmNvbHVtbkRlZmlu\naXRpb24oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpv\naW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5z\nZXRUYXJnZXQoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQXR0\ncmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldEZpZWxk\nKGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSk7CiAgICAgICAgY29s\nLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUoKSk7CiAgICAgICAgY29sLnNl\ndEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAham9pbi5pbnNlcnRh\nYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBE\nQVRBQkxFLCAham9pbi51cGRhdGFibGUgKCkpOwogICAgICAgIHJldHVybiBj\nb2w7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVHJhbnNsYXRlIHRoZSBm\nZXRjaCBtb2RlIGVudW0gdmFsdWUgdG8gdGhlIGludGVybmFsIE9wZW5KUEEg\nY29uc3RhbnQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGludCB0b0Vh\nZ2VyRmV0Y2hNb2RlQ29uc3RhbnQoRmV0Y2hNb2RlIG1vZGUpIHsKICAgICAg\nICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICAgICAgY2FzZSBOT05FOgogICAg\nICAgICAgICAgICAgcmV0dXJuIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9OT05F\nOwogICAgICAgICAgICBjYXNlIEpPSU46CiAgICAgICAgICAgICAgICByZXR1\ncm4gRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU47CiAgICAgICAgICAgIGNh\nc2UgUEFSQUxMRUw6CiAgICAgICAgICAgICAgICByZXR1cm4gRWFnZXJGZXRj\naE1vZGVzLkVBR0VSX1BBUkFMTEVMOwogICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVk\nIHZvaWQgcGFyc2VMb2JNYXBwaW5nKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpbnQg\ndHlwZUNvZGUgPSBmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpID8gZm1kLmdl\ndEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgOgogICAgICAgICAg\nICBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpOwogICAgICAgIENsYXNzIHR5\ncGUgPSBmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpID8gZm1kLmdldEVsZW1l\nbnQoKS5nZXREZWNsYXJlZFR5cGUoKSA6CiAgICAgICAgICAgIGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKTsKICAgCiAgICAgICAgaWYgKHR5cGVDb2RlID09IEph\ndmFUeXBlcy5TVFJJTkcKICAgICAgICAgICAgICAgIHx8IHR5cGUgPT0gY2hh\ncltdLmNsYXNzCiAgICAgICAgICAgICAgICB8fCB0eXBlID09IENoYXJhY3Rl\ncltdLmNsYXNzKQogICAgICAgICAgICBjb2wuc2V0VHlwZShUeXBlcy5DTE9C\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVz\nLkJMT0IpOwogICAgICAgIGlmIChmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigp\nKQogICAgICAgICAgICAoKEZpZWxkTWFwcGluZykgZm1kKS5nZXRFbGVtZW50\nTWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoQXJyYXlzLmFz\nTGlzdChuZXcgQ29sdW1uW117IGNvbCB9KSk7CiAgICAgICAgZWxzZSAgICAK\nICAgICAgICAgICAgKChGaWVsZE1hcHBpbmcpIGZtZCkuZ2V0VmFsdWVJbmZv\nKCkuc2V0Q29sdW1ucyhBcnJheXMuYXNMaXN0KG5ldyBDb2x1bW5bXXsgY29s\nIH0pKTsKICAgICAgICAKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCB2b2lkIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRpb25zKEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZp\nZWxkTWFwcGluZykgZm1kOwogICAgICAgIEFubm90YXRlZEVsZW1lbnQgZWwg\nPSAoQW5ub3RhdGVkRWxlbWVudCkgZ2V0UmVwb3NpdG9yeSgpLgogICAgICAg\nICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpLmdldEJh\nY2tpbmdNZW1iZXIoZm1kKTsKCiAgICAgICAgTWFwcGluZ1RhZyB0YWc7CiAg\nICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBlbC5nZXREZWNsYXJlZEFu\nbm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFnID0gX3RhZ3MuZ2V0KGFu\nbm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgIGlmICh0YWcgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxlVW5rbm93bk1lbWJlck1h\ncHBpbmdBbm5vdGF0aW9uKGZtLCBhbm5vKTsKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHRh\nZykgewogICAgICAgICAgICAgICAgY2FzZSBBU1NPQ19PVkVSUklERToKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKGZt\nLCAoQXNzb2NpYXRpb25PdmVycmlkZSkgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFTU09DX09WRVJS\nSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0aW9uT3Zl\ncnJpZGVzKGZtLCAoKEFzc29jaWF0aW9uT3ZlcnJpZGVzKSBhbm5vKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFUVFJfT1ZFUlJJ\nREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBdHRyaWJ1dGVPdmVycmlk\nZXMoZm0sIChBdHRyaWJ1dGVPdmVycmlkZSkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFUVFJfT1ZF\nUlJJREVTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQXR0cmlidXRlT3Zl\ncnJpZGVzKGZtLCAoKEF0dHJpYnV0ZU92ZXJyaWRlcykgYW5ubykuCiAgICAg\nICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDT0w6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VDb2x1bW5zKGZtLCAoamF2YXgucGVyc2lzdGVu\nY2UuQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgQ09MUzoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZUNvbHVtbnMoZm0sICgoQ29sdW1ucykgYW5ubykudmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEVOVU1FUkFURUQ6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbnVt\nZXJhdGVkKGZtLCAoRW51bWVyYXRlZCkgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fQ09MOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlSm9pbkNvbHVtbnMoZm0sIGZtLmdl\ndFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAo\nSm9pbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fQ09MUzoKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8o\nKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgKChKb2luQ29sdW1u\ncykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fVEFCTEU6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VKb2luVGFibGUoZm0sIChKb2luVGFibGUpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBLRVlfQ0xBU1NfQ1JJVDoKICAgICAgICAgICAgICAgICAgICBmbS5n\nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0VXNlQ2xhc3NDcml0\nZXJpYQogICAgICAgICAgICAgICAgICAgICAgICAoKChLZXlDbGFzc0NyaXRl\ncmlhKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0NPTDoKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUtleUNvbHVtbnMoZm0sIChLZXlDb2x1bW4pIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBLRVlfQ09MUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUtleUNv\nbHVtbnMoZm0sICgoS2V5Q29sdW1ucykgYW5ubykudmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtF\nWV9FTUJFRERFRF9NQVBQSU5HOgogICAgICAgICAgICAgICAgICAgIEtleUVt\nYmVkZGVkTWFwcGluZyBrZW1iZWQgPSAoS2V5RW1iZWRkZWRNYXBwaW5nKSBh\nbm5vOwogICAgICAgICAgICAgICAgICAgIHBhcnNlRW1iZWRkZWRNYXBwaW5n\nKGZtLmdldEtleU1hcHBpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\na2VtYmVkLm51bGxJbmRpY2F0b3JDb2x1bW5OYW1lKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIGtlbWJlZC5udWxsSW5kaWNhdG9yQXR0cmlidXRlTmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBrZW1iZWQub3ZlcnJpZGVz\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBLRVlfRks6CiAgICAgICAgICAgICAgICAgICAgS2V5Rm9yZWln\nbktleSBrZmsgPSAoS2V5Rm9yZWlnbktleSkgYW5ubzsKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUZvcmVpZ25LZXkoZm0uZ2V0S2V5TWFwcGluZygpLmdl\ndFZhbHVlSW5mbygpLAogICAgICAgICAgICAgICAgICAgICAgICBrZmsubmFt\nZSgpLCBrZmsuZW5hYmxlZCgpLCBrZmsuZGVmZXJyZWQoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAga2ZrLmRlbGV0ZUFjdGlvbigpLCBrZmsudXBkYXRl\nQWN0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBLRVlfSU5ERVg6CiAgICAgICAgICAgICAgICAgICAg\nS2V5SW5kZXgga2lkeCA9IChLZXlJbmRleCkgYW5ubzsKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUluZGV4KGZtLmdldEtleU1hcHBpbmcoKS5nZXRWYWx1\nZUluZm8oKSwga2lkeC5uYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIGtpZHguZW5hYmxlZCgpLCBraWR4LnVuaXF1ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0pPSU5f\nQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlS2V5Sm9pbkNvbHVtbnMo\nZm0sIChLZXlKb2luQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0pPSU5fQ09MUzoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZUtleUpvaW5Db2x1bW5zKGZtLCAo\nKEtleUpvaW5Db2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX05PTlBP\nTFk6CiAgICAgICAgICAgICAgICAgICAgZm0uZ2V0S2V5TWFwcGluZygpLnNl\ndFBvbHltb3JwaGljKHRvUG9seW1vcnBoaWNDb25zdGFudAogICAgICAgICAg\nICAgICAgICAgICAgICAoKChLZXlOb25wb2x5bW9ycGhpYykgYW5ubykudmFs\ndWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBLRVlfU1RSQVQ6CiAgICAgICAgICAgICAgICAgICAgZm0u\nZ2V0S2V5TWFwcGluZygpLmdldFZhbHVlSW5mbygpCiAgICAgICAgICAgICAg\nICAgICAgICAgIC5zZXRTdHJhdGVneSgoKEtleVN0cmF0ZWd5KSBhbm5vKS52\nYWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgTUFQX0tFWV9DT0w6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VNYXBLZXlDb2x1bW4oZm0sIChNYXBLZXlDb2x1bW4pIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBNQVBfS0VZX0VOVU1FUkFURUQ6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VNYXBLZXlFbnVtZXJhdGVkKGZtLCAoTWFwS2V5RW51bWVyYXRlZCkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIE1BUF9LRVlfSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VNYXBLZXlKb2luQ29sdW1ucyhmbSwgKE1hcEtleUpvaW5Db2x1bW4p\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBNQVBfS0VZX0pPSU5fQ09MUzoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZU1hcEtleUpvaW5Db2x1bW5zKGZtLAogICAgICAgICAgICAg\nICAgICAgICAgICAoKE1hcEtleUpvaW5Db2x1bW5zKSBhbm5vKS52YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgUEtfSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQ\ncmltYXJ5S2V5Sm9pbkNvbHVtbnMoZm0sIChQcmltYXJ5S2V5Sm9pbkNvbHVt\nbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFBLX0pPSU5fQ09MUzoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhmbSwKICAgICAgICAgICAg\nICAgICAgICAgICAgKChQcmltYXJ5S2V5Sm9pbkNvbHVtbnMpIGFubm8pLgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRBQkxF\nX0dFTjoKICAgICAgICAgICAgICAgICAgICBwYXJzZVRhYmxlR2VuZXJhdG9y\nKGVsLCAoVGFibGVHZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBURU1QT1JBTDoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZVRlbXBvcmFsKGZtLCAoVGVtcG9yYWwp\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBNQVBfS0VZX1RFTVBPUkFMOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlTWFwS2V5VGVtcG9yYWwoZm0sIChNYXBLZXlUZW1wb3JhbCkg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIENMQVNTX0NSSVQ6CiAgICAgICAgICAgICAgICAgICAgZm0u\nZ2V0VmFsdWVJbmZvKCkuc2V0VXNlQ2xhc3NDcml0ZXJpYQogICAgICAgICAg\nICAgICAgICAgICAgICAoKChDbGFzc0NyaXRlcmlhKSBhbm5vKS52YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgQ09OVEFJTkVSX1RBQkxFOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlQ29udGFpbmVyVGFibGUoZm0sIChDb250YWluZXJUYWJsZSkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIENPTExFQ1RJT05fVEFCTEU6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VDb2xsZWN0aW9uVGFibGUoZm0sIChDb2xsZWN0aW9uVGFibGUpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBFQUdFUl9GRVRDSF9NT0RFOgogICAgICAgICAgICAgICAgICAgIGZt\nLnNldEVhZ2VyRmV0Y2hNb2RlKHRvRWFnZXJGZXRjaE1vZGVDb25zdGFudAog\nICAgICAgICAgICAgICAgICAgICAgICAoKChFYWdlckZldGNoTW9kZSkgYW5u\nbykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBFTEVNX0NMQVNTX0NSSVQ6CiAgICAgICAgICAg\nICAgICAgICAgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8o\nKS5zZXRVc2VDbGFzc0NyaXRlcmlhCiAgICAgICAgICAgICAgICAgICAgICAg\nICgoKEVsZW1lbnRDbGFzc0NyaXRlcmlhKSBhbm5vKS52YWx1ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRUxFTV9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbGVtZW50Q29s\ndW1ucyhmbSwgKEVsZW1lbnRDb2x1bW4pIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX0NPTFM6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbGVtZW50Q29sdW1ucyhmbSwg\nKChFbGVtZW50Q29sdW1ucykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fRU1C\nRURERURfTUFQUElORzoKICAgICAgICAgICAgICAgICAgICBFbGVtZW50RW1i\nZWRkZWRNYXBwaW5nIGVlID0gKEVsZW1lbnRFbWJlZGRlZE1hcHBpbmcpIGFu\nbm87CiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbWJlZGRlZE1hcHBpbmco\nZm0uZ2V0RWxlbWVudE1hcHBpbmcoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgZWUubnVsbEluZGljYXRvckF0dHJpYnV0ZU5hbWUoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgZWUubnVsbEluZGljYXRvckNvbHVtbk5hbWUoKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgZWUub3ZlcnJpZGVzKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBF\nTEVNX0ZLOgogICAgICAgICAgICAgICAgICAgIEVsZW1lbnRGb3JlaWduS2V5\nIGVmayA9IChFbGVtZW50Rm9yZWlnbktleSkgYW5ubzsKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUZvcmVpZ25LZXkoZm0uZ2V0RWxlbWVudE1hcHBpbmco\nKS5nZXRWYWx1ZUluZm8oKSwKICAgICAgICAgICAgICAgICAgICAgICAgZWZr\nLm5hbWUoKSwgZWZrLmVuYWJsZWQoKSwgZWZrLmRlZmVycmVkKCksCiAgICAg\nICAgICAgICAgICAgICAgICAgIGVmay5kZWxldGVBY3Rpb24oKSwgZWZrLnVw\nZGF0ZUFjdGlvbigpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRUxFTV9JTkRFWDoKICAgICAgICAgICAgICAg\nICAgICBFbGVtZW50SW5kZXggZWlkeCA9IChFbGVtZW50SW5kZXgpIGFubm87\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbmRleChmbS5nZXRFbGVtZW50\nTWFwcGluZygpLmdldFZhbHVlSW5mbygpLAogICAgICAgICAgICAgICAgICAg\nICAgICBlaWR4Lm5hbWUoKSwgZWlkeC5lbmFibGVkKCksIGVpZHgudW5pcXVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBFTEVNX0pPSU5fQ09MOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlRWxlbWVudEpvaW5Db2x1bW5zKGZtLCAoRWxlbWVudEpvaW5Db2x1bW4p\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBFTEVNX0pPSU5fQ09MUzoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZUVsZW1lbnRKb2luQ29sdW1ucyhmbSwgKChFbGVtZW50Sm9pbkNv\nbHVtbnMpIGFubm8pLgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgRUxFTV9OT05QT0xZOgogICAgICAgICAgICAgICAgICAgIGZtLmdl\ndEVsZW1lbnRNYXBwaW5nKCkuc2V0UG9seW1vcnBoaWModG9Qb2x5bW9ycGhp\nY0NvbnN0YW50CiAgICAgICAgICAgICAgICAgICAgICAgICgoKEVsZW1lbnRO\nb25wb2x5bW9ycGhpYykgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX1NUUkFU\nOgogICAgICAgICAgICAgICAgICAgIGZtLmdldEVsZW1lbnRNYXBwaW5nKCku\nZ2V0VmFsdWVJbmZvKCkKICAgICAgICAgICAgICAgICAgICAgICAgLnNldFN0\ncmF0ZWd5KCgoRWxlbWVudFN0cmF0ZWd5KSBhbm5vKS52YWx1ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRU1CRURERURfTUFQUElORzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUVt\nYmVkZGVkTWFwcGluZyhmbSwgKEVtYmVkZGVkTWFwcGluZykgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEZLOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRm9yZWlnbktleShmbS5n\nZXRWYWx1ZUluZm8oKSwgKEZvcmVpZ25LZXkpIGFubm8pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJTkRFWDoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZUluZGV4KGZtLmdldFZhbHVlSW5m\nbygpLCAoSW5kZXgpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBOT05QT0xZOgogICAgICAgICAgICAg\nICAgICAgIGZtLnNldFBvbHltb3JwaGljKHRvUG9seW1vcnBoaWNDb25zdGFu\ndAogICAgICAgICAgICAgICAgICAgICAgICAoKChOb25wb2x5bW9ycGhpYykg\nYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBPUkRFUl9DT0xVTU46CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VKYXZheE9yZGVyQ29sdW1uKGZtLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgKGphdmF4LnBlcnNpc3RlbmNlLk9yZGVyQ29sdW1u\nKWFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBPUkRFUl9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VPcmRlckNvbHVtbihmbSwgKE9yZGVyQ29sdW1uKSBhbm5vKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1RS\nQVQ6CiAgICAgICAgICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5z\nZXRTdHJhdGVneSgoKFN0cmF0ZWd5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVU5J\nUVVFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVW5pcXVlKGZtLAogICAg\nICAgICAgICAgICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLmpkYmMuVW5pcXVlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgWF9FTUJFRERFRF9NQVBQ\nSU5HOgogICAgICAgICAgICAgICAgICAgIFhFbWJlZGRlZE1hcHBpbmcgZW1i\nZWQgPSAoWEVtYmVkZGVkTWFwcGluZykgYW5ubzsKICAgICAgICAgICAgICAg\nICAgICBwYXJzZUVtYmVkZGVkTWFwcGluZyhmbSwgZW1iZWQubnVsbEluZGlj\nYXRvckNvbHVtbk5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgZW1i\nZWQubnVsbEluZGljYXRvckF0dHJpYnV0ZU5hbWUoKSwgZW1iZWQub3ZlcnJp\nZGVzKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBYX0pPSU5fQ09MOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlWEpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgKFhKb2luQ29sdW1uKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgWF9KT0lOX0NPTFM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VYSm9p\nbkNvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAg\nICAgICAgICAgICAgICAgICAoKFhKb2luQ29sdW1ucykgYW5ubykudmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBmbSwK\nICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25z\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3du\nTWVtYmVyTWFwcGluZ0Fubm90YXRpb24oRmllbGRNYXBwaW5nIGZtLAogICAg\nICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUge0BsaW5rIFZhbHVl\nTWFwcGluZ30gPGNvZGU+UE9MWV8qPC9jb2RlPiBjb25zdGFudCBmb3IKICAg\nICAqIHRoZSBnaXZlbiBlbnVtIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgc3RhdGljIGludCB0b1BvbHltb3JwaGljQ29uc3RhbnQoTm9ucG9seW1v\ncnBoaWNUeXBlIHZhbCkgewogICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAg\nICAgICAgIGNhc2UgRVhBQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gVmFs\ndWVNYXBwaW5nLlBPTFlfRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSk9JTkFC\nTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlf\nSk9JTkFCTEU7CiAgICAgICAgICAgIGNhc2UgRkFMU0U6CiAgICAgICAgICAg\nICAgICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlfVFJVRTsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5h\nbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGdpdmVuIEBBc3NvY2lhdGlvbk92ZXJyaWRlIGFubm90YXRpb25z\nIG9uIGFuIGVtYmVkZGVkIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKEZpZWxkTWFwcGluZyBm\nbSwKICAgICAgICBBc3NvY2lhdGlvbk92ZXJyaWRlLi4uIGFzc29jcykgewoK\nICAgICAgICBGaWVsZE1hcHBpbmcgZWZtOwogICAgICAgIEpvaW5Db2x1bW5b\nXSBlY29sczsKICAgICAgICBpbnQgdW5pcXVlOwogICAgICAgIExpc3Q8Q29s\ndW1uPiBqY29sczsKICAgICAgICBKb2luVGFibGUgam9pblRibDsKICAgICAg\nICBmb3IgKEFzc29jaWF0aW9uT3ZlcnJpZGUgYXNzb2MgOiBhc3NvY3MpIHsK\nICAgICAgICAgICAgZWZtID0gZ2V0RW1iZWRkZWRGaWVsZE1hcHBpbmcoZm0s\nIGFzc29jLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChlZm0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAg\nICAgICAgZm0sIGFzc29jLm5hbWUoKSkpOwogICAgICAgICAgICBlY29scyA9\nIGFzc29jLmpvaW5Db2x1bW5zKCk7CiAgICAgICAgICAgIGpvaW5UYmwgPSBh\nc3NvYy5qb2luVGFibGUoKTsKICAgICAgICAgICAgaWYgKChlY29scyA9PSBu\ndWxsIHx8IGVjb2xzLmxlbmd0aCA9PSAwKSAmJiBqb2luVGJsID09IG51bGwp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImVtYmVkLW92ZXJyaWRlLW5hbWUiLAogICAgICAgICAgICAg\nICAgICAgIGZtLCBhc3NvYy5uYW1lKCkpKTsKICAgICAgICAgICAgaWYgKGVj\nb2xzICE9IG51bGwgJiYgZWNvbHMubGVuZ3RoID4gMCkgewogICAgICAgICAg\nICAgICAgdW5pcXVlID0gMDsKICAgICAgICAgICAgICAgIGpjb2xzID0gbmV3\nIEFycmF5TGlzdDxDb2x1bW4+KGVjb2xzLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBmb3IgKEpvaW5Db2x1bW4gZWNvbCA6IGVjb2xzKSB7CiAgICAgICAg\nICAgICAgICAgICAgdW5pcXVlIHw9IChlY29sLnVuaXF1ZSgpKSA/IFRSVUUg\nOiBGQUxTRTsKICAgICAgICAgICAgICAgICAgICBqY29scy5hZGQobmV3Q29s\ndW1uKGVjb2wpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHNldENvbHVtbnMoZWZtLCBlZm0uZ2V0VmFsdWVJbmZvKCksIGpjb2xzLCB1\nbmlxdWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGpvaW5UYmwgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgcGFyc2VKb2luVGFibGUoZWZtLCBqb2lu\nVGJsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIGdpdmVuIEBBdHRyaWJ1dGVPdmVycmlkZSBhbm5vdGF0\naW9ucyBvbiBhbiBlbWJlZGRlZCBtYXBwaW5nLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoRmllbGRNYXBwaW5n\nIGZtLAogICAgICAgIEF0dHJpYnV0ZU92ZXJyaWRlLi4uIGF0dHJzKSB7CiAg\nICAgICAgZm9yIChBdHRyaWJ1dGVPdmVycmlkZSBhdHRyIDogYXR0cnMpIHsK\nICAgICAgICAgICAgU3RyaW5nIGF0dHJOYW1lID0gYXR0ci5uYW1lKCk7CiAg\nICAgICAgICAgIEZpZWxkTWFwcGluZyBlZm0gPSBnZXRFbWJlZGRlZEZpZWxk\nTWFwcGluZyhmbSwgYXR0ck5hbWUpOwogICAgICAgICAgICBpZiAoYXR0ci5j\nb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGFyc2VDb2x1bW5z\nKGVmbSwgYXR0ci5jb2x1bW4oKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBzdGF0aWMgRmllbGRNYXBwaW5nIGdldEVtYmVkZGVkRmllbGRNYXBw\naW5nKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBTdHJpbmcgYXR0ck5hbWUp\nIHsKICAgICAgICByZXR1cm4gZ2V0RW1iZWRkZWRGaWVsZE1hcHBpbmcoZm0s\nIGF0dHJOYW1lLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIEZp\nZWxkTWFwcGluZyBnZXRFbWJlZGRlZEZpZWxkTWFwcGluZyhGaWVsZE1hcHBp\nbmcgZm0sCiAgICAgICAgICAgIFN0cmluZyBhdHRyTmFtZSwgYm9vbGVhbiBt\ndXN0RXhpc3QpIHsKICAgICAgICBDbGFzc01hcHBpbmcgZW1iZWQgPSBudWxs\nOwogICAgICAgIGJvb2xlYW4gaXNLZXkgPSBmYWxzZTsKICAgICAgICBib29s\nZWFuIGlzVmFsdWUgPSBmYWxzZTsKICAgICAgICBpZiAoYXR0ck5hbWUgIT0g\nbnVsbCAmJiBhdHRyTmFtZS5zdGFydHNXaXRoKCJrZXkuIikpCiAgICAgICAg\nICAgIGlzS2V5ID0gdHJ1ZTsKICAgICAgICBlbHNlIGlmIChhdHRyTmFtZSAh\nPSBudWxsICYmIGF0dHJOYW1lLnN0YXJ0c1dpdGgoInZhbHVlLiIpKQogICAg\nICAgICAgICBpc1ZhbHVlID0gdHJ1ZTsKICAgICAgICBpZiAoaXNLZXkgfHwg\naXNWYWx1ZSkKICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyTmFtZS5zdWJz\ndHJpbmcoYXR0ck5hbWUuaW5kZXhPZigiLiIpKzEpOwogICAgICAgICAgICAK\nICAgICAgICBpbnQgdHlwZUNvZGUgPSBmbS5nZXRWYWx1ZSgpLmdldERlY2xh\ncmVkVHlwZUNvZGUoKTsKICAgICAgICBzd2l0Y2ggKHR5cGVDb2RlKSB7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT04gOiAvLyBhIGNv\nbGxlY3Rpb24gb2YgZW1iZWRkYWJsZXMKICAgICAgICAgICAgICAgIGlmIChp\nc0tleSB8fCBpc1ZhbHVlKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUt\nbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZtLCBhdHRyTmFtZSkp\nOwogICAgICAgICAgICAgICAgZW1iZWQgPSBmbS5nZXRFbGVtZW50TWFwcGlu\nZygpLmdldEVtYmVkZGVkTWFwcGluZygpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDogLy8gYSBtYXAK\nICAgICAgICAgICAgICAgIGlmICghaXNLZXkgJiYgIWlzVmFsdWUpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgZm0sIGF0dHJOYW1lKSk7CiAgICAgICAgICAgICAgICBpZiAo\naXNLZXkpIAogICAgICAgICAgICAgICAgICAgIGVtYmVkID0gZ2V0RW1iZWRk\nZWRNYXBwaW5nKGZtLmdldEtleU1hcHBpbmcoKSwgbXVzdEV4aXN0KTsKICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKGlzVmFsdWUpICAgICAKICAgICAgICAg\nICAgICAgICAgICBlbWJlZCA9IGdldEVtYmVkZGVkTWFwcGluZyhmbS5nZXRF\nbGVtZW50TWFwcGluZygpLCAKICAgICAgICAgICAgICAgICAgICAgICAgbXVz\ndEV4aXN0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBk\nZWZhdWx0OiAvLyBhbiBlbWJlZGRhYmxlCiAgICAgICAgICAgICAgICBpZiAo\naXNLZXkgfHwgaXNWYWx1ZSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVtYmVkLW92ZXJyaWRl\nLW5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICBmbSwgYXR0ck5hbWUp\nKTsKICAgICAgICAgICAgICAgIGVtYmVkID0gZ2V0RW1iZWRkZWRNYXBwaW5n\nKGZtLmdldFZhbHVlTWFwcGluZygpLCBtdXN0RXhpc3QpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChl\nbWJlZCA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChtdXN0RXhpc3QpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vdC1lbWJlZGRlZCIsIGZtKSk7CiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0QXR0cmlidXRl\nT3ZlcnJpZGVGaWVsZChhdHRyTmFtZSwgZm0sIGVtYmVkKTsKICAgIH0KCiAg\nICBwdWJsaWMgc3RhdGljIENsYXNzPD8+IGdldEVtYmVkZGVkQ2xhc3NUeXBl\nKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBTdHJpbmcgYXR0ck5hbWUpIHsK\nICAgICAgICBWYWx1ZU1hcHBpbmcgZW1iZWQgPSBudWxsOwogICAgICAgIGJv\nb2xlYW4gaXNLZXkgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGlzVmFsdWUg\nPSBmYWxzZTsKICAgICAgICBpZiAoYXR0ck5hbWUgIT0gbnVsbCAmJiBhdHRy\nTmFtZS5zdGFydHNXaXRoKCJrZXkuIikpCiAgICAgICAgICAgIGlzS2V5ID0g\ndHJ1ZTsKICAgICAgICBlbHNlIGlmIChhdHRyTmFtZSAhPSBudWxsICYmIGF0\ndHJOYW1lLnN0YXJ0c1dpdGgoInZhbHVlLiIpKQogICAgICAgICAgICBpc1Zh\nbHVlID0gdHJ1ZTsKICAgICAgICBpZiAoaXNLZXkgfHwgaXNWYWx1ZSkKICAg\nICAgICAgICAgYXR0ck5hbWUgPSBhdHRyTmFtZS5zdWJzdHJpbmcoYXR0ck5h\nbWUuaW5kZXhPZigiLiIpKzEpOwogICAgICAgICAgICAKICAgICAgICBpbnQg\ndHlwZUNvZGUgPSBmbS5nZXRWYWx1ZSgpLmdldERlY2xhcmVkVHlwZUNvZGUo\nKTsKICAgICAgICBzd2l0Y2ggKHR5cGVDb2RlKSB7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT04gOiAvLyBhIGNvbGxlY3Rpb24gb2Yg\nZW1iZWRkYWJsZXMKICAgICAgICAgICAgICAgIGlmIChpc0tleSB8fCBpc1Zh\nbHVlKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZtLCBhdHRyTmFtZSkpOwogICAgICAgICAg\nICAgICAgZW1iZWQgPSBmbS5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1B\nUDogLy8gYSBtYXAKICAgICAgICAgICAgICAgIGlmICghaXNLZXkgJiYgIWlz\nVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgZm0sIGF0dHJOYW1lKSk7CiAgICAgICAg\nICAgICAgICBpZiAoaXNLZXkpIAogICAgICAgICAgICAgICAgICAgIGVtYmVk\nID0gZm0uZ2V0S2V5TWFwcGluZygpOwogICAgICAgICAgICAgICAgZWxzZSBp\nZiAoaXNWYWx1ZSkgICAgIAogICAgICAgICAgICAgICAgICAgIGVtYmVkID0g\nZm0uZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBkZWZhdWx0OiAvLyBhbiBlbWJlZGRhYmxlCiAgICAg\nICAgICAgICAgICBpZiAoaXNLZXkgfHwgaXNWYWx1ZSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImVtYmVkLW92ZXJyaWRlLW5hbWUiLAogICAgICAgICAgICAgICAgICAgICAg\nICBmbSwgYXR0ck5hbWUpKTsKICAgICAgICAgICAgICAgIGVtYmVkID0gZm0u\nZ2V0VmFsdWVNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGVtYmVkID09IG51bGwpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtZW1iZWRkZWQiLCBmbSkpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZW1iZWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICB9CgogICAgcHVi\nbGljIHN0YXRpYyBDbGFzc01hcHBpbmcgZ2V0RW1iZWRkZWRNYXBwaW5nKFZh\nbHVlTWFwcGluZyB2YWwsIGJvb2xlYW4gCiAgICAgICAgY3JlYXRlTmV3KSB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGVtYmVkID0gdmFsLmdldEVtYmVkZGVk\nTWFwcGluZygpOwogICAgICAgIGlmIChlbWJlZCAhPSBudWxsIHx8ICFjcmVh\ndGVOZXcpIAogICAgICAgICAgICByZXR1cm4gZW1iZWQ7CgogICAgICAgIHZh\nbC5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIHZhbC5n\nZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAgIH0KCiAgICAKICAgIHB1YmxpYyBz\ndGF0aWMgQ2xhc3NNYXBwaW5nIGdldEVtYmVkZGVkTWFwcGluZyhWYWx1ZU1h\ncHBpbmcgdmFsKSB7CiAgICAgICAgcmV0dXJuIGdldEVtYmVkZGVkTWFwcGlu\nZyh2YWwsIHRydWUpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEZp\nZWxkTWFwcGluZyBnZXRBdHRyaWJ1dGVPdmVycmlkZUZpZWxkKFN0cmluZyBh\ndHRyTmFtZSwKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtLCBDbGFzc01h\ncHBpbmcgZW1iZWQpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgZWZtOwogICAg\nICAgIGludCBpZHhPZkRvdCA9IGF0dHJOYW1lLmluZGV4T2YoIi4iKTsgCiAg\nICAgICAgaWYgKGlkeE9mRG90ID09IC0xKSB7CiAgICAgICAgICAgIGVmbSA9\nIGVtYmVkLmdldEZpZWxkTWFwcGluZyhhdHRyTmFtZSk7CiAgICAgICAgICAg\nIGlmIChlZm0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFt\nZSIsCiAgICAgICAgICAgICAgICAgICAgZm0sIGF0dHJOYW1lKSk7CiAgICAg\nICAgICAgIHJldHVybiBlZm07CiAgICAgICAgfSAKICAgICAgICBTdHJpbmcg\nYXR0ck5hbWUxID0gYXR0ck5hbWUuc3Vic3RyaW5nKDAsIGlkeE9mRG90KTsK\nICAgICAgICBTdHJpbmcgYXR0ck5hbWUyID0gYXR0ck5hbWUuc3Vic3RyaW5n\nKGlkeE9mRG90KzEpOwogICAgICAgIGVmbSA9IGVtYmVkLmdldEZpZWxkTWFw\ncGluZyhhdHRyTmFtZTEpOwogICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAgICAgICAgICAgICAgIGZtLCBh\ndHRyTmFtZTEpKTsKICAgICAgICBDbGFzc01hcHBpbmcgZW1iZWQxID0gZ2V0\nRW1iZWRkZWRNYXBwaW5nKGVmbS5nZXRWYWx1ZU1hcHBpbmcoKSk7CiAgICAg\nICAgcmV0dXJuIGdldEF0dHJpYnV0ZU92ZXJyaWRlRmllbGQoYXR0ck5hbWUy\nLCBlZm0sIGVtYmVkMSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUGFy\nc2UgQEVudW1lcmF0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZUVudW1lcmF0ZWQoRmllbGRNYXBwaW5nIGZtLCBFbnVtZXJhdGVkIGFubm8p\nIHsKICAgICAgICBTdHJpbmcgc3RyYXQgPSBFbnVtVmFsdWVIYW5kbGVyLmNs\nYXNzLmdldE5hbWUoKSArICIoU3RvcmVPcmRpbmFsPSIKICAgICAgICAgICAg\nKyBTdHJpbmcudmFsdWVPZihhbm5vLnZhbHVlKCkgPT0gRW51bVR5cGUuT1JE\nSU5BTCkgKyAiKSI7CiAgICAgICAgaWYgKGZtLmlzRWxlbWVudENvbGxlY3Rp\nb24oKSkgCiAgICAgICAgICAgIGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0\nVmFsdWVJbmZvKCkuc2V0U3RyYXRlZ3koc3RyYXQpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0U3RyYXRlZ3koc3Ry\nYXQpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hcEtleUVudW1l\ncmF0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1hcEtleUVu\ndW1lcmF0ZWQoRmllbGRNYXBwaW5nIGZtLCBNYXBLZXlFbnVtZXJhdGVkIGFu\nbm8pIHsKICAgICAgICBTdHJpbmcgc3RyYXQgPSBFbnVtVmFsdWVIYW5kbGVy\nLmNsYXNzLmdldE5hbWUoKSArICIoU3RvcmVPcmRpbmFsPSIKICAgICAgICAg\nICAgKyBTdHJpbmcudmFsdWVPZihhbm5vLnZhbHVlKCkgPT0gRW51bVR5cGUu\nT1JESU5BTCkgKyAiKSI7CiAgICAgICAgZm0uZ2V0S2V5TWFwcGluZygpLmdl\ndFZhbHVlSW5mbygpLnNldFN0cmF0ZWd5KHN0cmF0KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBUZW1wb3JhbC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHBhcnNlVGVtcG9yYWwoRmllbGRNYXBwaW5nIGZtLCBUZW1wb3Jh\nbCBhbm5vKSB7CiAgICAgICAgTGlzdCBjb2xzID0gZm0uZ2V0VmFsdWVJbmZv\nKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmICghY29scy5pc0VtcHR5KCkg\nJiYgY29scy5zaXplKCkgIT0gMSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudW0tY29scy1taXNtYXRjaCIs\nIGZtLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY29scy5zaXpl\nKCkpLCAiMSIpKTsKICAgICAgICBpZiAoY29scy5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgY29scyA9IEFycmF5cy5hc0xpc3QobmV3IENvbHVtbltdeyBu\nZXcgQ29sdW1uKCkgfSk7CiAgICAgICAgICAgIGlmIChmbS5pc0VsZW1lbnRD\nb2xsZWN0aW9uKCkpCiAgICAgICAgICAgICAgICBmbS5nZXRFbGVtZW50TWFw\ncGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoY29scyk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZtLmdldFZhbHVlSW5mbygp\nLnNldENvbHVtbnMoY29scyk7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW4g\nY29sID0gKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAgICAgc3dpdGNoIChh\nbm5vLnZhbHVlKCkpIHsKICAgICAgICAgICAgY2FzZSBEQVRFOgogICAgICAg\nICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMuREFURSk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBUSU1FOgogICAgICAgICAg\nICAgICAgY29sLnNldFR5cGUoVHlwZXMuVElNRSk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBUSU1FU1RBTVA6CiAgICAgICAg\nICAgICAgICBjb2wuc2V0VHlwZShUeXBlcy5USU1FU1RBTVApOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQFRlbXBvcmFsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VNYXBLZXlUZW1wb3JhbChGaWVsZE1hcHBpbmcgZm0sIE1hcEtleVRl\nbXBvcmFsIGFubm8pIHsKICAgICAgICBMaXN0IGNvbHMgPSBmbS5nZXRLZXlN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpOwogICAgICAg\nIGlmICghY29scy5pc0VtcHR5KCkgJiYgY29scy5zaXplKCkgIT0gMSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJudW0tY29scy1taXNtYXRjaCIsIGZtLAogICAgICAgICAgICAgICAgU3Ry\naW5nLnZhbHVlT2YoY29scy5zaXplKCkpLCAiMSIpKTsKICAgICAgICBpZiAo\nY29scy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgY29scyA9IEFycmF5cy5h\nc0xpc3QobmV3IENvbHVtbltdeyBuZXcgQ29sdW1uKCkgfSk7CiAgICAgICAg\nICAgIGZtLmdldEtleU1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5zZXRDb2x1\nbW5zKGNvbHMpOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uIGNvbCA9IChD\nb2x1bW4pIGNvbHMuZ2V0KDApOwogICAgICAgIHN3aXRjaCAoYW5uby52YWx1\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgREFURToKICAgICAgICAgICAgICAg\nIGNvbC5zZXRUeXBlKFR5cGVzLkRBVEUpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgVElNRToKICAgICAgICAgICAgICAgIGNv\nbC5zZXRUeXBlKFR5cGVzLlRJTUUpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgVElNRVNUQU1QOgogICAgICAgICAgICAgICAg\nY29sLnNldFR5cGUoVHlwZXMuVElNRVNUQU1QKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBDb2x1bW4ocykuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNl\nQ29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgamF2YXgucGVyc2lz\ndGVuY2UuQ29sdW1uLi4uIHBjb2xzKSB7CiAgICAgICAgaWYgKHBjb2xzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG1p\nZ2h0IGFscmVhZHkgaGF2ZSBzb21lIGNvbHVtbiBpbmZvcm1hdGlvbiBmcm9t\nIG1hcHBpbmcgYW5ub3RhdGlvbgogICAgICAgIExpc3QgY29scyA9IGZtLmdl\ndFZhbHVlSW5mbygpLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoIWNvbHMu\naXNFbXB0eSgpICYmIGNvbHMuc2l6ZSgpICE9IHBjb2xzLmxlbmd0aCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJudW0tY29scy1taXNtYXRjaCIsIGZtLAogICAgICAgICAgICAgICAgU3Ry\naW5nLnZhbHVlT2YoY29scy5zaXplKCkpLCBTdHJpbmcudmFsdWVPZihwY29s\ncy5sZW5ndGgpKSk7CgogICAgICAgIC8vIGNhY2hlIHRoZSBKQVhCIFhtbFR5\ncGUgY2xhc3MgaWYgaXQgaXMgcHJlc2VudCBzbyB3ZSBkbyBub3QKICAgICAg\nICAvLyBoYXZlIGEgaGFyZC13aXJlZCBkZXBlbmRlbmN5IG9uIEpBWEIgaGVy\nZQogICAgICAgIENsYXNzIHhtbFR5cGVDbGFzcyA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgeG1sVHlwZUNsYXNzID0gQ2xhc3MuZm9yTmFt\nZSgiamF2YXgueG1sLmJpbmQuYW5ub3RhdGlvbi5YbWxUeXBlIik7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICB9CgogICAgICAg\nIGludCB1bmlxdWUgPSAwOwogICAgICAgIFN0cmluZyBzZWNvbmRhcnkgPSBu\ndWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGNvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbHMuc2l6ZSgpID4gaSkKICAg\nICAgICAgICAgICAgIHNldHVwQ29sdW1uKChDb2x1bW4pIGNvbHMuZ2V0KGkp\nLCBwY29sc1tpXSwgX2RpY3QpOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nICAgICBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KHBjb2xzLmxlbmd0\naCk7CiAgICAgICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4ocGNvbHNb\naV0sIF9kaWN0KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAg\nICAgICAgIGlmICh4bWxUeXBlQ2xhc3MgIT0gbnVsbAogICAgICAgICAgICAg\nICAgJiYgU3RyaW5nVXRpbHMuaXNFbXB0eShwY29sc1tpXS5jb2x1bW5EZWZp\nbml0aW9uKCkpCiAgICAgICAgICAgICAgICAmJiAoQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAg\nICAgICAuaXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihmbS5nZXREZWNsYXJl\nZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgeG1sVHlwZUNsYXNz\nKSkpLmJvb2xlYW5WYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICBEQkRpY3Rp\nb25hcnkgZGljdCA9ICgoTWFwcGluZ1JlcG9zaXRvcnkpIGdldFJlcG9zaXRv\ncnkoKSkKICAgICAgICAgICAgICAgICAgICAuZ2V0REJEaWN0aW9uYXJ5KCk7\nCiAgICAgICAgICAgICAgICBpZiAoZGljdC5zdXBwb3J0c1hNTENvbHVtbikK\nICAgICAgICAgICAgICAgICAgICAvLyBjb2x1bW4gbWFwcyB0byB4bWwgdHlw\nZQogICAgICAgICAgICAgICAgICAgICgoQ29sdW1uKSBjb2xzLmdldChpKSku\nc2V0VHlwZU5hbWUoZGljdC54bWxUeXBlTmFtZSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHVuaXF1ZSB8PSAocGNvbHNbaV0udW5pcXVlKCkpID8g\nVFJVRSA6IEZBTFNFOwogICAgICAgICAgICBTdHJpbmcgc2VjVGFibGUgPSBf\nZGljdC5kZWxpbWl0U3RyaW5nKHBjb2xzW2ldLnRhYmxlKCksCiAgICAgICAg\nICAgICAgICBEQkRpY3Rpb25hcnkuREJJZGVudGlmaWVycy5TRUNPTkRBUllf\nVEFCTEVfTkFNRSk7CiAgICAgICAgCXNlY29uZGFyeSA9IHRyYWNrU2Vjb25k\nYXJ5VGFibGUoZm0sIHNlY29uZGFyeSwJc2VjVGFibGUsIGkpOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKGZtLmlzRWxlbWVudENvbGxlY3Rpb24oKSkKICAg\nICAgICAgICAgc2V0Q29sdW1ucyhmbSwgZm0uZ2V0RWxlbWVudE1hcHBpbmco\nKS5nZXRWYWx1ZUluZm8oKSwgY29scywgdW5pcXVlKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHNldENvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygp\nLCBjb2xzLCB1bmlxdWUpOwogICAgICAgIGlmIChzZWNvbmRhcnkgIT0gbnVs\nbCkKICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJsZU5h\nbWUoc2Vjb25kYXJ5KTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBh\nIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0aGUg\nZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nQ29sdW1uIG5ld0NvbHVtbihqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4gYW5u\nbywKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCkgewogICAgICAgIENvbHVt\nbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgc2V0dXBDb2x1bW4oY29s\nLCBhbm5vLCBkaWN0KTsKICAgICAgICByZXR1cm4gY29sOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0dXAgdGhlIGdpdmVuIGNvbHVtbiB3aXRoIGluZm9y\nbWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIHZvaWQgc2V0dXBDb2x1bW4oQ29sdW1uIGNvbCwg\namF2YXgucGVyc2lzdGVuY2UuQ29sdW1uIGFubm8sCiAgICAgICAgREJEaWN0\naW9uYXJ5IGRpY3QpIHsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1w\ndHkoYW5uby5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShkaWN0\nLmRlbGltaXRTdHJpbmcoYW5uby5uYW1lKCksCiAgICAgICAgICAgICAgICBE\nQkRpY3Rpb25hcnkuREJJZGVudGlmaWVycy5DT0xVTU5fTkFNRSkpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLmNvbHVtbkRlZmlu\naXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShkaWN0LmRl\nbGltaXRTdHJpbmcoYW5uby5jb2x1bW5EZWZpbml0aW9uKCksCiAgICAgICAg\nICAgICAgICBEQkRpY3Rpb25hcnkuREJJZGVudGlmaWVycy5DT0xVTU5fQ09M\nVU1OX0RFRklOSVRJT04pKTsKICAgICAgICBpZiAoYW5uby5wcmVjaXNpb24o\nKSAhPSAwKQogICAgICAgICAgICBjb2wuc2V0U2l6ZShhbm5vLnByZWNpc2lv\nbigpKTsKICAgICAgICBlbHNlIGlmIChhbm5vLmxlbmd0aCgpICE9IDI1NSkK\nICAgICAgICAgICAgY29sLnNldFNpemUoYW5uby5sZW5ndGgoKSk7CiAgICAg\nICAgY29sLnNldE5vdE51bGwoIWFubm8ubnVsbGFibGUoKSk7CiAgICAgICAg\nY29sLnNldERlY2ltYWxEaWdpdHMoYW5uby5zY2FsZSgpKTsKICAgICAgICBj\nb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFhbm5vLmlu\nc2VydGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdf\nVU5VUERBVEFCTEUsICFhbm5vLnVwZGF0YWJsZSgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gY29sdW1ucyBhcyB0aGUgY29sdW1u\ncyBmb3IgPGNvZGU+Zm08L2NvZGU+LgogICAgICoKICAgICAqIEBwYXJhbSB1\nbmlxdWUgYml0d2lzZSBjb21iaW5hdGlvbiBvZiBUUlVFIGFuZCBGQUxTRSBm\nb3IgdGhlCiAgICAgKiB1bmlxdWUgYXR0cmlidXRlIG9mIGVhY2ggY29sdW1u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNldENvbHVtbnMoRmllbGRN\nYXBwaW5nIGZtLCBNYXBwaW5nSW5mbyBpbmZvLAogICAgICAgIExpc3Q8Q29s\ndW1uPiBjb2xzLCBpbnQgdW5pcXVlKSB7CiAgICAgICAgaW5mby5zZXRDb2x1\nbW5zKGNvbHMpOwogICAgICAgIGlmICh1bmlxdWUgPT0gVFJVRSkKICAgICAg\nICAgICAgaW5mby5zZXRVbmlxdWUobmV3IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5VbmlxdWUoKSk7CgogICAgICAgIC8vIyMjIEVKQjMKICAg\nICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc1dh\ncm5FbmFibGVkKCkgJiYgdW5pcXVlID09IChUUlVFIHwgRkFMU0UpKQogICAg\nICAgICAgICBsb2cud2FybihfbG9jLmdldCgiaW5jb25zaXN0LWNvbC1hdHRy\ncyIsIGZtKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgdG8gdHJh\nY2sgdGhlIHNlY29uZGFyeSB0YWJsZSBmb3IgYSBzZXQgb2YgY29sdW1ucy4K\nICAgICAqCiAgICAgKiBAcGFyYW0gc2Vjb25kYXJ5IHNlY29uZGFyeSB0YWJs\nZSBmb3IgbGFzdCBjb2x1bW4KICAgICAqIEBwYXJhbSBjb2xTZWNvbmRhcnkg\nc2Vjb25kYXJ5IHRhYmxlIGZvciBjdXJyZW50IGNvbHVtbgogICAgICogQHJl\ndHVybiBzZWNvbmRhcnkgdGFibGUgZm9yIGZpZWxkCiAgICAgKi8KICAgIHBy\naXZhdGUgU3RyaW5nIHRyYWNrU2Vjb25kYXJ5VGFibGUoRmllbGRNYXBwaW5n\nIGZtLCBTdHJpbmcgc2Vjb25kYXJ5LAogICAgICAgIFN0cmluZyBjb2xTZWNv\nbmRhcnksIGludCBjb2wpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShjb2xTZWNvbmRhcnkpKQogICAgICAgICAgICBjb2xTZWNvbmRhcnkg\nPSBudWxsOwogICAgICAgIGlmIChjb2wgPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuIGNvbFNlY29uZGFyeTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmVx\ndWFsc0lnbm9yZUNhc2Uoc2Vjb25kYXJ5LCBjb2xTZWNvbmRhcnkpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nInNlY29uZC1pbmNvbnNpc3QiLCBmbSkpOwogICAgICAgIHJldHVybiBzZWNv\nbmRhcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBASm9pblRhYmxl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VKb2luVGFibGUoRmll\nbGRNYXBwaW5nIGZtLCBKb2luVGFibGUgam9pbikgewogICAgCUZpZWxkTWFw\ncGluZ0luZm8gaW5mbyA9IGZtLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAg\naW5mby5zZXRUYWJsZU5hbWUodG9UYWJsZU5hbWUoam9pbi5zY2hlbWEoKSwg\nam9pbi5uYW1lKCkpKTsKICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBp\nbmZvLCBmYWxzZSwgam9pbi5qb2luQ29sdW1ucygpKTsKICAgICAgICBwYXJz\nZUpvaW5Db2x1bW5zKGZtLCBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZh\nbHVlSW5mbygpLCBmYWxzZSwKICAgICAgICAgICAgam9pbi5pbnZlcnNlSm9p\nbkNvbHVtbnMoKSk7CiAgICAgICAgYWRkVW5pcXVlQ29uc3RyYWludHMoaW5m\nby5nZXRUYWJsZU5hbWUoKSwgZm0sIGluZm8sICAKICAgICAgICAgICAgam9p\nbi51bmlxdWVDb25zdHJhaW50cygpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGdpdmVuIEBKb2luQ29sdW1uIGFubm90YXRpb25zLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VKb2luQ29sdW1ucyhGaWVsZE1hcHBp\nbmcgZm0sIE1hcHBpbmdJbmZvIGluZm8sCiAgICAgICAgYm9vbGVhbiBzZWNv\nbmRhcnlBbGxvd2VkLCBKb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAg\naWYgKGpvaW5zLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1\nbW4+KGpvaW5zLmxlbmd0aCk7CiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAg\nICAgICAgU3RyaW5nIHNlY29uZGFyeSA9IG51bGw7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbnNbaV0pKTsKICAgICAgICAgICAg\ndW5pcXVlIHw9IChqb2luc1tpXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7\nCiAgICAgICAgICAgIHNlY29uZGFyeSA9IHRyYWNrU2Vjb25kYXJ5VGFibGUo\nZm0sIHNlY29uZGFyeSwKICAgICAgICAgICAgICAgIGpvaW5zW2ldLnRhYmxl\nKCksIGkpOwogICAgICAgICAgICBpZiAoIXNlY29uZGFyeUFsbG93ZWQgJiYg\nc2Vjb25kYXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1zZWNvbmQiLCBmbSkp\nOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29sdW1ucyhmbSwgaW5mbywgY29s\ncywgdW5pcXVlKTsKICAgICAgICBpZiAoc2Vjb25kYXJ5ICE9IG51bGwpCiAg\nICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVOYW1lKHNl\nY29uZGFyeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nc2NoZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVu\nIGFubm90YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVt\nbiBuZXdDb2x1bW4oSm9pbkNvbHVtbiBqb2luKSB7CiAgICAgICAgQ29sdW1u\nIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoam9pbi5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFt\nZShqb2luLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29s\nLnNldFR5cGVOYW1lKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQ29s\ndW1uTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldChqb2luLnJl\nZmVyZW5jZWRDb2x1bW5OYW1lKCkpOwogICAgICAgIGNvbC5zZXROb3ROdWxs\nKCFqb2luLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVt\nbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWpvaW4uaW5zZXJ0YWJsZSgpKTsKICAg\nICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWpv\naW4udXBkYXRhYmxlKCkpOwogICAgICAgIHJldHVybiBjb2w7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBAS2V5Q29sdW1uKHMpLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VLZXlDb2x1bW5zKEZpZWxkTWFwcGluZyBm\nbSwgS2V5Q29sdW1uLi4uIHBjb2xzKSB7CiAgICAgICAgaWYgKHBjb2xzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIExpc3Q8\nQ29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KHBjb2xzLmxl\nbmd0aCk7CiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBwY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBjb2xzLmFkZChuZXdDb2x1bW4ocGNvbHNbaV0pKTsKICAgICAgICAgICAg\ndW5pcXVlIHw9IChwY29sc1tpXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7\nCiAgICAgICAgfQogICAgICAgIHNldENvbHVtbnMoZm0sIGZtLmdldEtleU1h\ncHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwgY29scywgdW5pcXVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdp\ndGggaW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ29sdW1uIG5ld0NvbHVtbihLZXlD\nb2x1bW4gYW5ubykgewogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1u\nKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubmFt\nZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoYW5uby5uYW1lKCkpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLmNvbHVtbkRl\nZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShhbm5v\nLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKGFubm8ucHJlY2lz\naW9uKCkgIT0gMCkKICAgICAgICAgICAgY29sLnNldFNpemUoYW5uby5wcmVj\naXNpb24oKSk7CiAgICAgICAgZWxzZSBpZiAoYW5uby5sZW5ndGgoKSAhPSAy\nNTUpCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8ubGVuZ3RoKCkpOwog\nICAgICAgIGNvbC5zZXROb3ROdWxsKCFhbm5vLm51bGxhYmxlKCkpOwogICAg\nICAgIGNvbC5zZXREZWNpbWFsRGlnaXRzKGFubm8uc2NhbGUoKSk7CiAgICAg\nICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhYW5u\nby5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5G\nTEFHX1VOVVBEQVRBQkxFLCAhYW5uby51cGRhdGFibGUoKSk7CiAgICAgICAg\ncmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdpdmVu\nIEBQcmltYXJ5S2V5Sm9pbkNvbHVtbiBhbm5vdGF0aW9ucy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5zKEZp\nZWxkTWFwcGluZyBmbSwKICAgICAgICBQcmltYXJ5S2V5Sm9pbkNvbHVtbi4u\nLiBqb2lucykgewogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFy\ncmF5TGlzdDxDb2x1bW4+KGpvaW5zLmxlbmd0aCk7CiAgICAgICAgZm9yIChQ\ncmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2luIDogam9pbnMpCiAgICAgICAgICAg\nIGNvbHMuYWRkKG5ld0NvbHVtbihqb2luKSk7CiAgICAgICAgc2V0Q29sdW1u\ncyhmbSwgZm0uZ2V0VmFsdWVJbmZvKCksIGNvbHMsIDApOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgZ2l2ZW4gQFhKb2luQ29sdW1uIGFubm90YXRp\nb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVhKb2luQ29s\ndW1ucyhGaWVsZE1hcHBpbmcgZm0sIE1hcHBpbmdJbmZvIGluZm8sCiAgICAg\nICAgYm9vbGVhbiBzZWNvbmRhcnlBbGxvd2VkLCBYSm9pbkNvbHVtbi4uLiBq\nb2lucykgewogICAgICAgIGlmIChqb2lucy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5l\ndyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAgIGlu\ndCB1bmlxdWUgPSAwOwogICAgICAgIFN0cmluZyBzZWNvbmRhcnkgPSBudWxs\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKGpvaW5zW2ld\nKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8PSAoam9pbnNbaV0udW5pcXVlKCkp\nID8gVFJVRSA6IEZBTFNFOwogICAgICAgICAgICBzZWNvbmRhcnkgPSB0cmFj\na1NlY29uZGFyeVRhYmxlKGZtLCBzZWNvbmRhcnksCiAgICAgICAgICAgICAg\nICBqb2luc1tpXS50YWJsZSgpLCBpKTsKICAgICAgICAgICAgaWYgKCFzZWNv\nbmRhcnlBbGxvd2VkICYmIHNlY29uZGFyeSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtc2Vjb25kIiwgZm0pKTsKICAgICAgICB9CgogICAgICAgIHNldENvbHVt\nbnMoZm0sIGluZm8sIGNvbHMsIHVuaXF1ZSk7CiAgICAgICAgaWYgKHNlY29u\nZGFyeSAhPSBudWxsKQogICAgICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygp\nLnNldFRhYmxlTmFtZShzZWNvbmRhcnkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlv\nbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKFhKb2luQ29sdW1uIGpvaW4p\nIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAg\nIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkpCiAgICAg\nICAgICAgIGNvbC5zZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkp\nKQogICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUoam9pbi5jb2x1bW5EZWZp\nbml0aW9uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShq\nb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpKQogICAgICAgICAgICBjb2wu\nc2V0VGFyZ2V0KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSk7CiAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVmZXJlbmNlZEF0\ndHJpYnV0ZU5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRUYXJnZXRGaWVs\nZChqb2luLnJlZmVyZW5jZWRBdHRyaWJ1dGVOYW1lKCkpOwogICAgICAgIGNv\nbC5zZXROb3ROdWxsKCFqb2luLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5z\nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWpvaW4uaW5zZXJ0\nYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQ\nREFUQUJMRSwgIWpvaW4udXBkYXRhYmxlKCkpOwogICAgICAgIHJldHVybiBj\nb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBlbWJlZGRlZCBpbmZv\nIGZvciB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHBhcnNlRW1iZWRkZWRNYXBwaW5nKEZpZWxkTWFwcGluZyBmbSwgRW1i\nZWRkZWRNYXBwaW5nIGFubm8pIHsKICAgICAgICBDbGFzc01hcHBpbmcgZW1i\nZWQgPSBmbS5nZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAgICAgICBpZiAoZW1i\nZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW1iZWRkZWQiLCBmbSkpOwoKICAgICAg\nICBGaWVsZE1hcHBpbmcgZWZtOwogICAgICAgIGZvciAoTWFwcGluZ092ZXJy\naWRlIG92ZXIgOiBhbm5vLm92ZXJyaWRlcygpKSB7CiAgICAgICAgICAgIGVm\nbSA9IGVtYmVkLmdldEZpZWxkTWFwcGluZyhvdmVyLm5hbWUoKSk7CiAgICAg\nICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJp\nZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZm0sIG92ZXIubmFtZSgp\nKSk7CiAgICAgICAgICAgIHBvcHVsYXRlKGVmbSwgb3Zlcik7CiAgICAgICAg\nfQoKICAgICAgICBTdHJpbmcgbnVsbEluZCA9IG51bGw7CiAgICAgICAgaWYg\nKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubnVsbEluZGljYXRvckF0dHJp\nYnV0ZU5hbWUoKSkpCiAgICAgICAgICAgIG51bGxJbmQgPSBhbm5vLm51bGxJ\nbmRpY2F0b3JBdHRyaWJ1dGVOYW1lKCk7CiAgICAgICAgZWxzZSBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5udWxsSW5kaWNhdG9yQ29sdW1uTmFt\nZSgpKSkKICAgICAgICAgICAgbnVsbEluZCA9IGFubm8ubnVsbEluZGljYXRv\nckNvbHVtbk5hbWUoKTsKICAgICAgICBpZiAobnVsbEluZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIFZhbHVlTWFwcGluZ0luZm8g\naW5mbyA9IGZtLmdldFZhbHVlSW5mbygpOwogICAgICAgIHBvcHVsYXRlTnVs\nbEluZGljYXRvcihudWxsSW5kLCBpbmZvKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIGVtYmVkZGVkIGluZm8gZm9yIHRoZSBnaXZlbiBtYXBwaW5n\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VFbWJlZGRlZE1hcHBp\nbmcoVmFsdWVNYXBwaW5nIHZtLCAKICAgICAgICBTdHJpbmcgbnVsbEluZGlj\nYXRvckF0dHJpYnV0ZSwgU3RyaW5nIG51bGxJbmRpY2F0b3JDb2x1bW4sCiAg\nICAgICAgWE1hcHBpbmdPdmVycmlkZVtdIG92ZXJyaWRlcykgewogICAgICAg\nIENsYXNzTWFwcGluZyBlbWJlZCA9IHZtLmdldEVtYmVkZGVkTWFwcGluZygp\nOwogICAgICAgIGlmIChlbWJlZCA9PSBudWxsKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbWJlZGRl\nZCIsIHZtKSk7CgogICAgICAgIEZpZWxkTWFwcGluZyBlZm07CiAgICAgICAg\nZm9yIChYTWFwcGluZ092ZXJyaWRlIG92ZXIgOiBvdmVycmlkZXMpIHsKICAg\nICAgICAgICAgZWZtID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5nKG92ZXIubmFt\nZSgpKTsKICAgICAgICAgICAgaWYgKGVmbSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJl\nbWJlZC1vdmVycmlkZS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2bSwg\nb3Zlci5uYW1lKCkpKTsKICAgICAgICAgICAgcG9wdWxhdGUoZWZtLCBvdmVy\nKTsKICAgICAgICB9CgogICAgICAgIFN0cmluZyBudWxsSW5kID0gbnVsbDsK\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkobnVsbEluZGljYXRv\nckF0dHJpYnV0ZSkpCiAgICAgICAgICAgIG51bGxJbmQgPSBudWxsSW5kaWNh\ndG9yQXR0cmlidXRlOwogICAgICAgIGVsc2UgaWYgKCFTdHJpbmdVdGlscy5p\nc0VtcHR5KG51bGxJbmRpY2F0b3JDb2x1bW4pKQogICAgICAgICAgICBudWxs\nSW5kID0gbnVsbEluZGljYXRvckNvbHVtbjsKICAgICAgICBpZiAobnVsbElu\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFZhbHVl\nTWFwcGluZ0luZm8gaW5mbyA9IHZtLmdldFZhbHVlSW5mbygpOwogICAgICAg\nIHBvcHVsYXRlTnVsbEluZGljYXRvcihudWxsSW5kLCBpbmZvKTsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgcG9wdWxhdGVOdWxsSW5kaWNhdG9yKFN0cmlu\nZyBudWxsSW5kLCBWYWx1ZU1hcHBpbmdJbmZvIGluZm8pIHsKICAgICAgICBp\nZiAoImZhbHNlIi5lcXVhbHMobnVsbEluZCkpCiAgICAgICAgICAgIGluZm8u\nc2V0Q2FuSW5kaWNhdGVOdWxsKGZhbHNlKTsKICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICAg\nICAgaWYgKCEidHJ1ZSIuZXF1YWxzKG51bGxJbmQpKQogICAgICAgICAgICAg\nICAgY29sLnNldE5hbWUobnVsbEluZCk7CiAgICAgICAgICAgIGluZm8uc2V0\nQ29sdW1ucyhBcnJheXMuYXNMaXN0KG5ldyBDb2x1bW5bXXsgY29sIH0pKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAQ29udGFp\nbmVyVGFibGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlQ29u\ndGFpbmVyVGFibGUoRmllbGRNYXBwaW5nIGZtLCBDb250YWluZXJUYWJsZSBj\ndGJsKSB7CiAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJsZU5h\nbWUodG9UYWJsZU5hbWUoY3RibC5zY2hlbWEoKSwKICAgICAgICAgICAgY3Ri\nbC5uYW1lKCkpKTsKICAgICAgICBwYXJzZVhKb2luQ29sdW1ucyhmbSwgZm0u\nZ2V0TWFwcGluZ0luZm8oKSwgZmFsc2UsIGN0Ymwuam9pbkNvbHVtbnMoKSk7\nCiAgICAgICAgaWYgKGN0Ymwuam9pbkZvcmVpZ25LZXkoKS5zcGVjaWZpZWQo\nKSkKICAgICAgICAgICAgcGFyc2VGb3JlaWduS2V5KGZtLmdldE1hcHBpbmdJ\nbmZvKCksIGN0Ymwuam9pbkZvcmVpZ25LZXkoKSk7CiAgICAgICAgaWYgKGN0\nYmwuam9pbkluZGV4KCkuc3BlY2lmaWVkKCkpCiAgICAgICAgICAgIHBhcnNl\nSW5kZXgoZm0uZ2V0TWFwcGluZ0luZm8oKSwgY3RibC5qb2luSW5kZXgoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAQ29sbGVjdGlvblRhYmxl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUNvbGxlY3Rpb25U\nYWJsZShGaWVsZE1hcHBpbmcgZm0sIENvbGxlY3Rpb25UYWJsZSBjdGJsKSB7\nCiAgICAgICAgRmllbGRNYXBwaW5nSW5mbyBpbmZvID0gZm0uZ2V0TWFwcGlu\nZ0luZm8oKTsgCiAgICAgICAgaW5mby5zZXRUYWJsZU5hbWUodG9UYWJsZU5h\nbWUoY3RibC5zY2hlbWEoKSwKICAgICAgICAgICAgY3RibC5uYW1lKCkpKTsK\nICAgICAgICAvL2N0YmwuY2F0YWxvZygpCiAgICAgICAgcGFyc2VKb2luQ29s\ndW1ucyhmbSwgZm0uZ2V0TWFwcGluZ0luZm8oKSwgZmFsc2UsIGN0Ymwuam9p\nbkNvbHVtbnMoKSk7CiAgICAgICAgYWRkVW5pcXVlQ29uc3RyYWludHMoaW5m\nby5nZXRUYWJsZU5hbWUoKSwgZm0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLCAK\nICAgICAgICAgICAgaW5mbywgY3RibC51bmlxdWVDb25zdHJhaW50cygpKTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBQYXJzZSBAb3JnLmFwYWNoZS5v\ncGVuanBhLnBlcnNpc3RlbmNlLmpkYmMuT3JkZXJDb2x1bW4uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZU9yZGVyQ29sdW1uKEZpZWxkTWFwcGlu\nZyBmbSwgT3JkZXJDb2x1bW4gb3JkZXIpIHsKICAgICAgICBpZiAoIW9yZGVy\nLmVuYWJsZWQoKSkgewogICAgICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygp\nLnNldENhbk9yZGVyQ29sdW1uKGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4o\nKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkob3JkZXIubmFt\nZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUob3JkZXIubmFtZSgpKTsK\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkob3JkZXIuY29sdW1u\nRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNldFR5cGVOYW1lKG9y\nZGVyLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKG9yZGVyLnBy\nZWNpc2lvbigpICE9IDApCiAgICAgICAgICAgIGNvbC5zZXRTaXplKG9yZGVy\nLnByZWNpc2lvbigpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxB\nR19VTklOU0VSVEFCTEUsICFvcmRlci5pbnNlcnRhYmxlKCkpOwogICAgICAg\nIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhb3JkZXIu\ndXBkYXRhYmxlKCkpOwogICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0\nT3JkZXJDb2x1bW4oY29sKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBQ\nYXJzZSBAamF2YXgucGVyc2lzdGVuY2UuT3JkZXJDb2x1bW4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlSmF2YXhPcmRlckNvbHVtbihGaWVsZE1h\ncHBpbmcgZm0sIAogICAgICAgIGphdmF4LnBlcnNpc3RlbmNlLk9yZGVyQ29s\ndW1uIG9yZGVyKSB7CiAgICAgICAgCiAgICAgICAgQ29sdW1uIGNvbCA9IG5l\ndyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\nb3JkZXIubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUob3JkZXIu\nbmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkob3Jk\nZXIuY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNldFR5\ncGVOYW1lKG9yZGVyLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgY29s\nLnNldE5vdE51bGwoIW9yZGVyLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5z\nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIW9yZGVyLmluc2Vy\ndGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5V\nUERBVEFCTEUsICFvcmRlci51cGRhdGFibGUoKSk7CiAgICAgICAgCiAgICAg\nICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRPcmRlckNvbHVtbihjb2wpOyAg\nICAgICAgCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARWxlbWVudEpv\naW5Db2x1bW4ocykuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNl\nRWxlbWVudEpvaW5Db2x1bW5zKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBF\nbGVtZW50Sm9pbkNvbHVtbi4uLiBqb2lucykgewogICAgICAgIGlmIChqb2lu\ncy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBM\naXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lu\ncy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgY29scy5hZGQobmV3Q29sdW1uKGpvaW5zW2ldKSk7CiAgICAgICAg\nICAgIHVuaXF1ZSB8PSAoam9pbnNbaV0udW5pcXVlKCkpID8gVFJVRSA6IEZB\nTFNFOwogICAgICAgIH0KICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRF\nbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLCBjb2xzLCB1bmlxdWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBj\nb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29s\ndW1uKEVsZW1lbnRKb2luQ29sdW1uIGpvaW4pIHsKICAgICAgICBDb2x1bW4g\nY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShqb2luLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1l\nKGpvaW4ubmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1w\ndHkoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wu\nc2V0VHlwZU5hbWUoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAg\nIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLnJlZmVyZW5jZWRDb2x1\nbW5OYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0VGFyZ2V0KGpvaW4ucmVm\nZXJlbmNlZENvbHVtbk5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSkpCiAg\nICAgICAgICAgIGNvbC5zZXRUYXJnZXRGaWVsZChqb2luLnJlZmVyZW5jZWRB\ndHRyaWJ1dGVOYW1lKCkpOwogICAgICAgIGNvbC5zZXROb3ROdWxsKCFqb2lu\nLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnIChDb2x1bW4uRkxB\nR19VTklOU0VSVEFCTEUsICFqb2luLmluc2VydGFibGUgKCkpOwoJCWNvbC5z\nZXRGbGFnIChDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWpvaW4udXBkYXRh\nYmxlICgpKTsKCQlyZXR1cm4gY29sOwoJfQogICAgCiAgICAvKioKICAgICAq\nIFBhcnNlIEBNYXBLZXlDb2x1bW4uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIHBhcnNlTWFwS2V5Q29sdW1uKEZpZWxkTWFwcGluZyBmbSwgTWFwS2V5\nQ29sdW1uIGFubm8pIHsKICAgICAgICBpbnQgdW5pcXVlID0gMDsKICAgICAg\nICBGaWVsZE1hcHBpbmdJbmZvIGluZm8gPSBmbS5nZXRNYXBwaW5nSW5mbygp\nOwogICAgICAgIGlmIChhbm5vLnRhYmxlKCkgIT0gbnVsbCAmJiBhbm5vLnRh\nYmxlKCkubGVuZ3RoKCkgPiAwKQogICAgICAgIGluZm8uc2V0VGFibGVOYW1l\nKGFubm8udGFibGUoKSk7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1\nbW4oKTsKICAgICAgICBzZXR1cE1hcEtleUNvbHVtbihmbSwgY29sLCBhbm5v\nKTsKICAgICAgICB1bmlxdWUgfD0gKGFubm8udW5pcXVlKCkpID8gVFJVRSA6\nIEZBTFNFOwogICAgICAgIHNldE1hcEtleUNvbHVtbihmbSwgZm0uZ2V0S2V5\nTWFwcGluZygpLmdldFZhbHVlSW5mbygpLCBjb2wsIHVuaXF1ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXR1cCB0aGUgZ2l2ZW4gY29sdW1uIHdpdGgg\naW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBzZXR1cE1hcEtleUNvbHVtbihG\naWVsZE1hcHBpbmcgZm0sIENvbHVtbiBjb2wsIAogICAgICAgIE1hcEtleUNv\nbHVtbiBhbm5vKSB7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGFubm8ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoYW5uby5u\nYW1lKCkpOwogICAgICAgIGVsc2UgCiAgICAgICAgICAgIGNvbC5zZXROYW1l\nKGZtLmdldE5hbWUoKSArICJfIiArICJLRVkiKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpKQog\nICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUoYW5uby5jb2x1bW5EZWZpbml0\naW9uKCkpOwogICAgICAgIGlmIChhbm5vLnByZWNpc2lvbigpICE9IDApCiAg\nICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8ucHJlY2lzaW9uKCkpOwogICAg\nICAgIGVsc2UgaWYgKGFubm8ubGVuZ3RoKCkgIT0gMjU1KQogICAgICAgICAg\nICBjb2wuc2V0U2l6ZShhbm5vLmxlbmd0aCgpKTsKICAgICAgICBjb2wuc2V0\nTm90TnVsbCghYW5uby5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RGVj\naW1hbERpZ2l0cyhhbm5vLnNjYWxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFn\nKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWFubm8uaW5zZXJ0YWJsZSgp\nKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJM\nRSwgIWFubm8udXBkYXRhYmxlKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBnaXZlbiBtYXAga2V5IGNvbHVtbiBhcyB0aGUgbWFwIGtleSBj\nb2x1bW4gZm9yIDxjb2RlPmZtPC9jb2RlPi4KICAgICAqCiAgICAgKiBAcGFy\nYW0gdW5pcXVlIGJpdHdpc2UgY29tYmluYXRpb24gb2YgVFJVRSBhbmQgRkFM\nU0UgZm9yIHRoZQogICAgICogdW5pcXVlIGF0dHJpYnV0ZSBvZiB0aGUgY29s\ndW1uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNldE1hcEtleUNvbHVt\nbihGaWVsZE1hcHBpbmcgZm0sIE1hcHBpbmdJbmZvIGluZm8sCiAgICAgICAg\nQ29sdW1uIGNvbCwgaW50IHVuaXF1ZSkgewogICAgICAgIExpc3Q8Q29sdW1u\nPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KCk7CiAgICAgICAgY29s\ncy5hZGQoY29sKTsKICAgICAgICBpbmZvLnNldENvbHVtbnMoY29scyk7CiAg\nICAgICAgaWYgKHVuaXF1ZSA9PSBUUlVFKQogICAgICAgICAgICBpbmZvLnNl\ndFVuaXF1ZShuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVu\naXF1ZSgpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBQYXJzZSBATWFw\nS2V5Sm9pbkNvbHVtbihzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlTWFwS2V5Sm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLAogICAgICAg\nICAgICBNYXBLZXlKb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAgaWYg\nKGpvaW5zLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+\nKGpvaW5zLmxlbmd0aCk7CiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbnNbaV0pKTsKICAg\nICAgICAgICAgdW5pcXVlIHw9IChqb2luc1tpXS51bmlxdWUoKSkgPyBUUlVF\nIDogRkFMU0U7CiAgICAgICAgfQogICAgICAgIHNldENvbHVtbnMoZm0sIGZt\nLmdldEtleU1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwgY29scywgdW5pcXVl\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiAgQ3JlYXRlIGEgbmV3IHNj\naGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBh\nbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4g\nbmV3Q29sdW1uKE1hcEtleUpvaW5Db2x1bW4gam9pbikgewogICAgICAgIENv\nbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNl\ndE5hbWUoam9pbi5uYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAg\nIGNvbC5zZXROYW1lKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQ29s\ndW1uTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldChqb2luLnJl\nZmVyZW5jZWRDb2x1bW5OYW1lKCkpOwogICAgICAgIGNvbC5zZXROb3ROdWxs\nKCFqb2luLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVt\nbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWpvaW4uaW5zZXJ0YWJsZSgpKTsKICAg\nICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWpv\naW4udXBkYXRhYmxlICgpKTsKICAgICAgICByZXR1cm4gY29sOwogICAgfQog\nICAgCn0K\n","encoding":"base64"}

