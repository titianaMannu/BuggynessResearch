{"sha":"11e6396d79ca8dfaa5392f4c4e53b3113e672137","node_id":"MDQ6QmxvYjIwNjM2NDoxMWU2Mzk2ZDc5Y2E4ZGZhYTUzOTJmNGM0ZTUzYjMxMTNlNjcyMTM3","size":28386,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/11e6396d79ca8dfaa5392f4c4e53b3113e672137","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5FbnVtTWFw\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW51bVR5cGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5UZW1wb3JhbFR5cGU7CgppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcueG1s\nLnNheC5TQVhFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZ0luZm87Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1pbmF0\nb3JNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5NYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuTWFwcGluZ1JlcG9zaXRvcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlF1ZXJ5UmVzdWx0TWFwcGluZzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuU2VxdWVuY2VN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5W\nYWx1ZU1hcHBpbmdJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5WYWx1ZU1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRW51bVZhbHVlSGFuZGxlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZsYXRD\nbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuRnVsbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5WZXJ0aWNhbENsYXNzU3Ry\nYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5E\nQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5D\nbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkphdmFUeXBlczsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5NZXRhRGF0YU1vZGVzLk1PREVfTUFQUElORzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuUGVyc2lzdGVu\nY2VTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0\nZW5jZS5YTUxQZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplcjsKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIFNlcmlhbGl6ZXMgcGVyc2lz\ndGVuY2UgbWFwcGluZyB0byBYTUwuCiAqCiAqIEBzaW5jZSAwLjQuMAogKiBA\nYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xh\nc3MgWE1MUGVyc2lzdGVuY2VNYXBwaW5nU2VyaWFsaXplcgogICAgZXh0ZW5k\ncyBYTUxQZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplciB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IFRZUEVfUkVTVUxUTUFQID0gVFlQRV9R\nVUVSWSArIDE7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENvbFR5\ncGUsIFN0cmluZz4gX25hbWVzOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX25h\nbWVzID0gbmV3IEVudW1NYXA8Q29sVHlwZSwgU3RyaW5nPihDb2xUeXBlLmNs\nYXNzKTsKICAgICAgICBfbmFtZXMucHV0KENvbFR5cGUuQ09MLCAiY29sdW1u\nIik7CiAgICAgICAgX25hbWVzLnB1dChDb2xUeXBlLkpPSU4sICJqb2luLWNv\nbHVtbiIpOwogICAgICAgIF9uYW1lcy5wdXQoQ29sVHlwZS5JTlZFUlNFLCAi\naW52ZXJzZS1qb2luLWNvbHVtbiIpOwogICAgICAgIF9uYW1lcy5wdXQoQ29s\nVHlwZS5QS19KT0lOLCAicHJpbWFyeS1rZXktam9pbi1jb2x1bW4iKTsKICAg\nICAgICBfbmFtZXMucHV0KENvbFR5cGUuRElTQywgImRpc2NyaW1pbmF0b3It\nY29sdW1uIik7CiAgICB9CgogICAgcHJpdmF0ZSBMaXN0PFF1ZXJ5UmVzdWx0\nTWFwcGluZz4gX3Jlc3VsdHMgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9zeW5jID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4g\nU3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBYTUxQ\nZXJzaXN0ZW5jZU1hcHBpbmdTZXJpYWxpemVyKEpEQkNDb25maWd1cmF0aW9u\nIGNvbmYpIHsKICAgICAgICBzdXBlcihjb25mKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gYXV0b21hdGljYWxseSBzeW5jaHJvbml6ZSBt\nYXBwaW5nIGluZm8gd2l0aCBkYXRhIGF2YWlsYWJsZQogICAgICogZnJvbSBt\nYXBwZWQgY29tcG9uZW50cyBiZWZvcmUgc2VyaWFsaXphdGlvbi4gRGVmYXVs\ndHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN5\nbmNNYXBwaW5nSW5mbygpIHsKICAgICAgICByZXR1cm4gX3N5bmM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGF1dG9tYXRpY2FsbHkgc3lu\nY2hyb25pemUgbWFwcGluZyBpbmZvIHdpdGggZGF0YSBhdmFpbGFibGUKICAg\nICAqIGZyb20gbWFwcGVkIGNvbXBvbmVudHMgYmVmb3JlIHNlcmlhbGl6YXRp\nb24uIERlZmF1bHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRTeW5jTWFwcGluZ0luZm8oYm9vbGVhbiBzeW5jKSB7CiAgICAgICAg\nX3N5bmMgPSBzeW5jOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUg\nZ2l2ZW4gcmVzdWx0IHNldCBtYXBwaW5nIHRvIGxvY2FsIGNhY2hlLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoUXVl\ncnlSZXN1bHRNYXBwaW5nIG1ldGEpIHsKICAgICAgICBpZiAoX3Jlc3VsdHMg\nPT0gbnVsbCkKICAgICAgICAgICAgX3Jlc3VsdHMgPSBuZXcgQXJyYXlMaXN0\nPFF1ZXJ5UmVzdWx0TWFwcGluZz4oKTsKICAgICAgICBfcmVzdWx0cy5hZGQo\nbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGdpdmVuIHJl\nc3VsdCBzZXQgbWFwcGluZyBmcm9tIHRoZSBsb2NhbCBjYWNoZS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlUXVlcnlSZXN1bHRNYXBwaW5n\nKFF1ZXJ5UmVzdWx0TWFwcGluZyBtZXRhKSB7CiAgICAgICAgcmV0dXJuIF9y\nZXN1bHRzICE9IG51bGwgJiYgX3Jlc3VsdHMucmVtb3ZlKG1ldGEpOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgYWRkQWxsKE1ldGFE\nYXRhUmVwb3NpdG9yeSByZXBvcykgewogICAgICAgIHN1cGVyLmFkZEFsbChy\nZXBvcyk7CiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDog\nKChNYXBwaW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRR\ndWVyeVJlc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIGFkZFF1ZXJ5UmVz\ndWx0TWFwcGluZyhyZXMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIGJvb2xlYW4gcmVtb3ZlQWxsKE1ldGFEYXRhUmVwb3NpdG9yeSByZXBv\ncykgewogICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9IHN1cGVyLnJlbW92ZUFs\nbChyZXBvcyk7CiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVz\nIDogKChNYXBwaW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5n\nZXRRdWVyeVJlc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIHJlbW92ZWQg\nfD0gcmVtb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKHJlcyk7CiAgICAgICAgcmV0\ndXJuIHJlbW92ZWQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCBjbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAg\nIGlmIChfcmVzdWx0cyAhPSBudWxsKQogICAgICAgICAgICBfcmVzdWx0cy5j\nbGVhcigpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZENvbW1tZW50\ncyhPYmplY3Qgb2JqKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewog\nICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkgJiYgIWlzTWV0YURhdGFNb2Rl\nKCkpIHsKICAgICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIENsYXNzTWFw\ncGluZykKICAgICAgICAgICAgICAgIG9iaiA9ICgoQ2xhc3NNYXBwaW5nKSBv\nYmopLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKG9i\naiBpbnN0YW5jZW9mIEZpZWxkTWFwcGluZykKICAgICAgICAgICAgICAgIG9i\naiA9ICgoRmllbGRNYXBwaW5nKSBvYmopLmdldE1hcHBpbmdJbmZvKCk7CiAg\nICAgICAgfQogICAgICAgIHN1cGVyLmFkZENvbW1lbnRzKG9iaik7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVD\nbGFzcyhDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gYWNjZXNzKQogICAg\nICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmIChfc3luYyAm\nJiBpc01hcHBpbmdNb2RlKCkgJiYgbWV0YSBpbnN0YW5jZW9mIENsYXNzTWFw\ncGluZykgewogICAgICAgICAgICAvLyBzeW5jIGlmIHJlc29sdmVkIGFuZCBt\nYXBwZWQKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IChDbGFzc01h\ncHBpbmcpIG1ldGE7CiAgICAgICAgICAgIGlmICgoY2xzLmdldFJlc29sdmUo\nKSAmIE1PREVfTUFQUElORykgIT0gMCAmJiBjbHMuaXNNYXBwZWQoKSkgewog\nICAgICAgICAgICAgICAgY2xzLnN5bmNNYXBwaW5nSW5mbygpOwogICAgICAg\nICAgICAgICAgY2xzLmdldERpc2NyaW1pbmF0b3IoKS5zeW5jTWFwcGluZ0lu\nZm8oKTsKICAgICAgICAgICAgICAgIGNscy5nZXRWZXJzaW9uKCkuc3luY01h\ncHBpbmdJbmZvKCk7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBm\naWVsZHM7CiAgICAgICAgICAgICAgICBpZiAoY2xzLmdldEVtYmVkZGluZ01l\ndGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmaWVsZHMg\nPSBjbHMuZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBjbHMuZ2V0\nRmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICAgICAgZm9yIChGaWVsZE1h\ncHBpbmcgZiA6IGZpZWxkcykKICAgICAgICAgICAgICAgICAgICBmLnN5bmNN\nYXBwaW5nSW5mbygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHN1cGVyLnNlcmlhbGl6ZUNsYXNzKG1ldGEsIGFjY2Vzcyk7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFz\nc01hcHBpbmdDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nY2xzID0gKENsYXNzTWFwcGluZykgbWFwcGluZzsKICAgICAgICBDbGFzc01h\ncHBpbmdJbmZvIGluZm8gPSBjbHMuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAg\nICBzZXJpYWxpemVUYWJsZShpbmZvLmdldFRhYmxlTmFtZSgpLCAidGFibGUi\nLCBTdHJpbmdzCiAgICAgICAgICAgIC5nZXRDbGFzc05hbWUobWFwcGluZy5n\nZXREZXNjcmliZWRUeXBlKCkpLCBudWxsLCAKICAgICAgICAgICAgaW5mby5n\nZXRVbmlxdWVzKGluZm8uZ2V0VGFibGVOYW1lKCkpKTsKICAgICAgICBmb3Ig\nKFN0cmluZyBzZWNvbmQgOiBpbmZvLmdldFNlY29uZGFyeVRhYmxlTmFtZXMo\nKSkKICAgICAgICAgICAgc2VyaWFsaXplVGFibGUoc2Vjb25kLCAic2Vjb25k\nYXJ5LXRhYmxlIiwgbnVsbCwgaW5mbywKICAgICAgICAgICAgICAgICAgICBp\nbmZvLmdldFVuaXF1ZXMoc2Vjb25kKSk7CiAgICAgICAgc2VyaWFsaXplQ29s\ndW1ucyhpbmZvLCBDb2xUeXBlLlBLX0pPSU4sIG51bGwpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplSW5oZXJp\ndGFuY2VDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykKICAgICAgICB0\naHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgY2xz\nID0gKENsYXNzTWFwcGluZykgbWFwcGluZzsKICAgICAgICBDbGFzc01hcHBp\nbmdJbmZvIGluZm8gPSBjbHMuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBE\naXNjcmltaW5hdG9yTWFwcGluZ0luZm8gZGluZm8gPSBjbHMuZ2V0RGlzY3Jp\nbWluYXRvcigpCiAgICAgICAgICAgIC5nZXRNYXBwaW5nSW5mbygpOwogICAg\nICAgIFN0cmluZyBzdHJhdCA9IGluZm8uZ2V0SGllcmFyY2h5U3RyYXRlZ3ko\nKTsKICAgICAgICBpZiAoRmxhdENsYXNzU3RyYXRlZ3kuQUxJQVMuZXF1YWxz\nKHN0cmF0KSkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJzdHJhdGVneSIs\nICJTSU5HTEVfVEFCTEUiKTsKICAgICAgICBlbHNlIGlmIChWZXJ0aWNhbENs\nYXNzU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKHN0cmF0KSkKICAgICAgICAgICAg\nYWRkQXR0cmlidXRlKCJzdHJhdGVneSIsICJKT0lORUQiKTsKICAgICAgICBl\nbHNlIGlmIChGdWxsQ2xhc3NTdHJhdGVneS5BTElBUy5lcXVhbHMoc3RyYXQp\nKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoInN0cmF0ZWd5IiwgIlRBQkxF\nX1BFUl9DTEFTUyIpOwogICAgICAgIGlmIChzdHJhdCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIHN0YXJ0RWxlbWVudCgiaW5oZXJpdGFuY2UiKTsKICAgICAg\nICAgICAgZW5kRWxlbWVudCgiaW5oZXJpdGFuY2UiKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKGRpbmZvLmdldFZhbHVlKCkgIT0gbnVsbCkgewogICAgICAg\nICAgICBzdGFydEVsZW1lbnQoImRpc2NyaW1pbmF0b3ItdmFsdWUiKTsKICAg\nICAgICAgICAgYWRkVGV4dChkaW5mby5nZXRWYWx1ZSgpKTsKICAgICAgICAg\nICAgZW5kRWxlbWVudCgiZGlzY3JpbWluYXRvci12YWx1ZSIpOwogICAgICAg\nIH0KICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGRpbmZvLCBDb2xUeXBlLkRJ\nU0MsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHRh\nYmxlIG9wdGlvbmFsbHkgbGlzdGluZyBwcmltYXJ5LWtleS1qb2lucyBzdG9y\nZWQKICAgICAqIGluIHRoZSBnaXZlbiB7QGxpbmsgQ2xhc3NNYXBwaW5nSW5m\nb30uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxpemVUYWJsZShT\ndHJpbmcgdGFibGUsIFN0cmluZyBlbGVtZW50TmFtZSwKICAgICAgICBTdHJp\nbmcgZGVmYXVsdE5hbWUsIENsYXNzTWFwcGluZ0luZm8gc2Vjb25kYXJ5SW5m\nbywgVW5pcXVlW10gdW5pcXVlcykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0\naW9uIHsKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG51bGw7CiAgICAg\nICAgaWYgKHNlY29uZGFyeUluZm8gIT0gbnVsbCkKICAgICAgICAgICAgY29s\ncyA9IChMaXN0PENvbHVtbj4pIHNlY29uZGFyeUluZm8uZ2V0U2Vjb25kYXJ5\nVGFibGVKb2luQ29sdW1ucwogICAgICAgICAgICAgICAgKHRhYmxlKTsKCiAg\nICAgICAgYm9vbGVhbiBwcmludCA9IChjb2xzICE9IG51bGwgJiYgY29scy5z\naXplKCkgPiAwKSB8fCAKICAgICAgICAgICAgKHVuaXF1ZXMgIT0gbnVsbCAm\nJiB1bmlxdWVzLmxlbmd0aCA+IDApOwogICAgICAgIGlmICh0YWJsZSAhPSBu\ndWxsCiAgICAgICAgICAgICYmIChkZWZhdWx0TmFtZSA9PSBudWxsIHx8ICFk\nZWZhdWx0TmFtZS5lcXVhbHModGFibGUpKSkgewogICAgICAgICAgICBwcmlu\ndCA9IHRydWU7CiAgICAgICAgICAgIGludCBpbmRleCA9IHRhYmxlLmluZGV4\nT2YoJy4nKTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAg\nICAgICAgIGFkZEF0dHJpYnV0ZSgibmFtZSIsIHRhYmxlKTsKICAgICAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoInNjaGVt\nYSIsIHRhYmxlLnN1YnN0cmluZygwLCBpbmRleCkpOwogICAgICAgICAgICAg\nICAgYWRkQXR0cmlidXRlKCJuYW1lIiwgdGFibGUuc3Vic3RyaW5nKGluZGV4\nICsgMSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChw\ncmludCkgewogICAgICAgICAgICBzdGFydEVsZW1lbnQoZWxlbWVudE5hbWUp\nOwogICAgICAgICAgICBpZiAoY29scyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBmb3IgKENvbHVtbiBjb2wgOiBjb2xzKQogICAgICAgICAgICAgICAg\nICAgIHNlcmlhbGl6ZUNvbHVtbihjb2wsIENvbFR5cGUuUEtfSk9JTiwgbnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh1bmlx\ndWVzICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3IgKFVuaXF1ZSB1bmlx\ndWU6IHVuaXF1ZXMpCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplVW5p\ncXVlQ29uc3RyYWludCh1bmlxdWUpOwogICAgICAgICAgICBlbmRFbGVtZW50\nKGVsZW1lbnROYW1lKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzZXJpYWxpemVBdHRyaWJ1dGVPdmVy\ncmlkZShGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBGaWVsZE1ldGFEYXRh\nIG9yaWcpIHsKICAgICAgICBpZiAob3JpZyA9PSBudWxsIHx8IGZtZCA9PSBv\ncmlnKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIEZpZWxk\nTWFwcGluZyBmaWVsZCA9IChGaWVsZE1hcHBpbmcpIGZtZDsKICAgICAgICBG\naWVsZE1hcHBpbmcgZmllbGQyID0gKEZpZWxkTWFwcGluZykgb3JpZzsKICAg\nICAgICBpZiAoZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5oYXNTY2hlbWFDb21w\nb25lbnRzKCkKICAgICAgICAgICAgfHwgZmllbGQyLmdldE1hcHBpbmdJbmZv\nKCkuaGFzU2NoZW1hQ29tcG9uZW50cygpKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKCiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyBpbmZvID0gZmllbGQu\nZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSAo\nTGlzdDxDb2x1bW4+KSBpbmZvLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAo\nY29scyA9PSBudWxsIHx8IGNvbHMuc2l6ZSgpID09IDApCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIGluZm8y\nID0gZmllbGQyLmdldFZhbHVlSW5mbygpOwogICAgICAgIExpc3Q8Q29sdW1u\nPiBjb2xzMiA9IChMaXN0PENvbHVtbj4pIGluZm8yLmdldENvbHVtbnMoKTsK\nICAgICAgICBpZiAoY29sczIgPT0gbnVsbCB8fCBjb2xzMi5zaXplKCkgIT0g\nY29scy5zaXplKCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIGlmIChjb2xzLnNpemUoKSAhPSAxKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKCiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBDb2x1bW4gY29sMjsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMuc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgY29sID0gY29scy5nZXQoaSk7CiAgICAgICAgICAg\nIGNvbDIgPSBjb2xzMi5nZXQoaSk7CiAgICAgICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuZXF1YWxzKGNvbC5nZXROYW1lKCksIGNvbDIuZ2V0TmFtZSgpKSkK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmVxdWFscyhjb2wuZ2V0VHlwZU5hbWUoKSwgY29sMi5n\nZXRUeXBlTmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICBpZiAoY29sLmdldFNpemUoKSAhPSBjb2wyLmdldFNpemUo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBp\nZiAoY29sLmdldERlY2ltYWxEaWdpdHMoKSAhPSBjb2wyLmdldERlY2ltYWxE\naWdpdHMoKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBpZiAoY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxF\nKQogICAgICAgICAgICAgICAgIT0gY29sMi5nZXRGbGFnKENvbHVtbi5GTEFH\nX1VOSU5TRVJUQUJMRSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKGNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBE\nQVRBQkxFKQogICAgICAgICAgICAgICAgIT0gY29sMi5nZXRGbGFnKENvbHVt\nbi5GTEFHX1VOVVBEQVRBQkxFKSkKICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVBdHRy\naWJ1dGVPdmVycmlkZU1hcHBpbmdDb250ZW50KEZpZWxkTWV0YURhdGEgZm1k\nLAogICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZykKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSAoRmll\nbGRNYXBwaW5nKSBmbWQ7CiAgICAgICAgc2VyaWFsaXplQ29sdW1ucyhmbS5n\nZXRWYWx1ZUluZm8oKSwgQ29sVHlwZS5DT0wsIGZtLmdldE1hcHBpbmdJbmZv\nKCkKICAgICAgICAgICAgLmdldFRhYmxlTmFtZSgpKTsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZVN0cmF0ZWd5IGdl\ndFN0cmF0ZWd5KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgUGVyc2lz\ndGVuY2VTdHJhdGVneSBzdHJhdCA9IHN1cGVyLmdldFN0cmF0ZWd5KGZtZCk7\nCiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkID0gKEZpZWxkTWFwcGluZykg\nZm1kOwogICAgICAgIHN3aXRjaCAoc3RyYXQpIHsKICAgICAgICAgICAgY2Fz\nZSBNQU5ZX01BTlk6CiAgICAgICAgICAgICAgICAvLyB3ZSBjYW4gZGlmZmVy\nZW50aWF0ZSBhIG9uZS1tYW55IGJ5IHRoZSBmYWN0IHRoYXQgdGhlcmUgaXMg\nbm8KICAgICAgICAgICAgICAgIC8vIHNlY29uZGFyeSB0YWJsZSBqb2luLCBv\nciB0aGUgZmsgaXMgdW5pcXVlCiAgICAgICAgICAgICAgICBpZiAoZmllbGQu\nZ2V0TWFwcGVkQnkoKSA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgJiYg\nKGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0Sm9pbkRpcmVjdGlvbigpCiAg\nICAgICAgICAgICAgICAgICAgPT0gTWFwcGluZ0luZm8uSk9JTl9OT05FCiAg\nICAgICAgICAgICAgICAgICAgfHwgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmco\nKS5nZXRWYWx1ZUluZm8oKS5nZXRVbmlxdWUoKQogICAgICAgICAgICAgICAg\nICAgICE9IG51bGwpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJz\naXN0ZW5jZVN0cmF0ZWd5Lk9ORV9NQU5ZOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgTUFOWV9PTkU6CiAgICAgICAgICAgICAg\nICAvLyBpbnZlcnNlIGpvaW4gY29scyBvciB1bmlxdWUgZms/CiAgICAgICAg\nICAgICAgICBpZiAoZmllbGQuZ2V0VmFsdWVJbmZvKCkuZ2V0Sm9pbkRpcmVj\ndGlvbigpCiAgICAgICAgICAgICAgICAgICAgPT0gTWFwcGluZ0luZm8uSk9J\nTl9JTlZFUlNFCiAgICAgICAgICAgICAgICAgICAgfHwgZmllbGQuZ2V0VmFs\ndWVJbmZvKCkuZ2V0VW5pcXVlKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5PTkVfT05FOwoKICAg\nICAgICAgICAgICAgIC8vIHNjYW4gZm9yIHByaW1hcnkta2V5LWpvaW4tY29s\ndW1uCiAgICAgICAgICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IGZpZWxk\nLmdldFZhbHVlSW5mbygpLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAg\nIGJvb2xlYW4gcGtKb2luID0gY29scyAhPSBudWxsICYmIGNvbHMuc2l6ZSgp\nID4gMDsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBwa0pvaW4g\nJiYgaSA8IGNvbHMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAgICAgICAg\ncGtKb2luID0gY29scy5nZXQoaSkuZ2V0RmxhZyhDb2x1bW4uRkxBR19QS19K\nT0lOKTsKICAgICAgICAgICAgICAgIGlmIChwa0pvaW4pCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuT05FX09ORTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gc3RyYXQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQg\ndm9pZCBzZXJpYWxpemVGaWVsZE1hcHBpbmdDb250ZW50KEZpZWxkTWV0YURh\ndGEgZm1kLAogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXRlZ3kp\nCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZt\nZC5nZXRNYXBwZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgLy8gd2hpbGUgSSdkIGxpa2UgdG8gZG8gYXV0byBkZXRlY3Rp\nb24gYmFzZWQgb24gam9pbiBkaXJlY3Rpb25zLCBldGMuCiAgICAgICAgLy8g\ndGhlIGRpc3Rpbmd1aXNoZWQgY29sdW1uIC8gdGFibGUgLyBldGMgbmFtZXMg\nZm9yY2VzIG91ciBoYW5kCiAgICAgICAgLy8gZXNwIGZvciBPcGVuSlBBIGN1\nc3RvbSBtYXBwaW5ncy4KICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQgPSAo\nRmllbGRNYXBwaW5nKSBmbWQ7CiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkg\newogICAgICAgICAgICBjYXNlIE9ORV9PTkU6CiAgICAgICAgICAgIGNhc2Ug\nTUFOWV9PTkU6CiAgICAgICAgICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGZp\nZWxkLmdldFZhbHVlSW5mbygpLCBDb2xUeXBlLkpPSU4sCiAgICAgICAgICAg\nICAgICAgICAgZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5nZXRUYWJsZU5hbWUo\nKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNhc2Ug\nT05FX01BTlk6CiAgICAgICAgICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGlu\nZ0luZm8oKS5nZXRKb2luRGlyZWN0aW9uKCkgPT0KICAgICAgICAgICAgICAg\nICAgICBNYXBwaW5nSW5mby5KT0lOX05PTkUpIHsKICAgICAgICAgICAgICAg\nICAgICBzZXJpYWxpemVDb2x1bW5zKGZpZWxkLmdldEVsZW1lbnRNYXBwaW5n\nKCkuZ2V0VmFsdWVJbmZvKCksCiAgICAgICAgICAgICAgICAgICAgICAgIENv\nbFR5cGUuSk9JTiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gZWxzZSBu\nbyBicmVhawogICAgICAgICAgICBjYXNlIE1BTllfTUFOWToKICAgICAgICAg\nICAgICAgIGlmIChmaWVsZC5nZXRNYXBwaW5nSW5mbygpLmhhc1NjaGVtYUNv\nbXBvbmVudHMoKQogICAgICAgICAgICAgICAgICAgIHx8IGZpZWxkLmdldEVs\nZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkKICAgICAgICAgICAgICAg\nICAgICAuaGFzU2NoZW1hQ29tcG9uZW50cygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nIHRhYmxlID0gZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5n\nZXRUYWJsZU5hbWUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGFibGUg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnQgaW5kZXgg\nPSB0YWJsZS5pbmRleE9mKCcuJyk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoIm5hbWUiLCB0YWJsZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRk\nQXR0cmlidXRlKCJzY2hlbWEiLCB0YWJsZS5zdWJzdHJpbmcoMCwgaW5kZXgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgi\nbmFtZSIsIHRhYmxlLnN1YnN0cmluZyhpbmRleCArIDEpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBzdGFydEVsZW1lbnQoImpvaW4tdGFibGUiKTsKICAg\nICAgICAgICAgICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGZpZWxkLmdldE1h\ncHBpbmdJbmZvKCksIENvbFR5cGUuSk9JTiwKICAgICAgICAgICAgICAgICAg\nICAgICAgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQ29s\ndW1ucyhmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygp\nLAogICAgICAgICAgICAgICAgICAgICAgICBDb2xUeXBlLklOVkVSU0UsIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgIGVuZEVsZW1lbnQoImpvaW4tdGFi\nbGUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgY2FzZSBFTEVNX0NPTEw6CiAgICAgICAgICAgICAg\nICBpZiAoZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5oYXNTY2hlbWFDb21wb25l\nbnRzKCkKICAgICAgICAgICAgICAgICAgICB8fCBmaWVsZC5nZXRFbGVtZW50\nTWFwcGluZygpLmdldFZhbHVlSW5mbygpCiAgICAgICAgICAgICAgICAgICAg\nLmhhc1NjaGVtYUNvbXBvbmVudHMoKSkgewogICAgICAgICAgICAgICAgICAg\nIFN0cmluZyB0YWJsZSA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0VGFi\nbGVOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW50IGluZGV4ID0gdGFi\nbGUuaW5kZXhPZignLicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\naW5kZXggPCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQXR0\ncmlidXRlKCJuYW1lIiwgdGFibGUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgic2NoZW1hIiwgdGFibGUuc3Vic3RyaW5nKDAsIGluZGV4KSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUi\nLCB0YWJsZS5zdWJzdHJpbmcoaW5kZXggKyAxKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgc3RhcnRFbGVtZW50KCJjb2xsZWN0aW9uLXRhYmxlIik7CiAg\nICAgICAgICAgICAgICAgICAgVmFsdWVNYXBwaW5nSW1wbCBlbGVtID0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIChWYWx1ZU1hcHBpbmdJbXBsKSBm\naWVsZC5nZXRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFs\naXplQ29sdW1ucyhlbGVtLmdldFZhbHVlSW5mbygpLCBDb2xUeXBlLkNPTCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIGVuZEVsZW1lbnQoImNvbGxlY3Rpb24tdGFibGUiKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIHNlcmlhbGl6ZUNvbHVtbnMoZmllbGQuZ2V0VmFsdWVJ\nbmZvKCksIENvbFR5cGUuQ09MLAogICAgICAgICAgICBmaWVsZC5nZXRNYXBw\naW5nSW5mbygpLmdldFRhYmxlTmFtZSgpKTsKICAgICAgICBpZiAoc3RyYXRl\nZ3kgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5CQVNJQyAmJiBpc0xvYihmaWVs\nZCkpIHsKICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJsb2IiKTsKICAgICAg\nICAgICAgZW5kRWxlbWVudCgibG9iIik7CiAgICAgICAgfQogICAgICAgIFRl\nbXBvcmFsVHlwZSB0ZW1wb3JhbCA9IGdldFRlbXBvcmFsKGZpZWxkKTsKICAg\nICAgICBpZiAodGVtcG9yYWwgIT0gbnVsbCkgewogICAgICAgICAgICBzdGFy\ndEVsZW1lbnQoInRlbXBvcmFsIik7CiAgICAgICAgICAgIGFkZFRleHQodGVt\ncG9yYWwudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGVuZEVsZW1lbnQoInRl\nbXBvcmFsIik7CiAgICAgICAgfQoKICAgICAgICBFbnVtVHlwZSBlbnVtVHlw\nZSA9IGdldEVudW1UeXBlKGZpZWxkKTsKICAgICAgICBpZiAoZW51bVR5cGUg\nIT0gbnVsbCAmJiBlbnVtVHlwZSAhPSBFbnVtVHlwZS5PUkRJTkFMKSB7CiAg\nICAgICAgICAgIHN0YXJ0RWxlbWVudCgiZW51bWVyYXRlZCIpOwogICAgICAg\nICAgICBhZGRUZXh0KGVudW1UeXBlLnRvU3RyaW5nKCkpOwogICAgICAgICAg\nICBlbmRFbGVtZW50KCJlbnVtZXJhdGVkIik7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU2VyaWFsaXplIG9yZGVyIGNvbHVtbi4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplT3JkZXJDb2x1bW4oRmll\nbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7\nCiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkID0gKEZpZWxkTWFwcGluZykg\nZm1kOwogICAgICAgIENvbHVtbiBvcmRlckNvbCA9IGZpZWxkLmdldE9yZGVy\nQ29sdW1uKCk7CiAgICAgICAgaWYgKG9yZGVyQ29sICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKG9yZGVyQ29sLmdldE5hbWUoKSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJuYW1lIiwgb3JkZXJDb2wuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgaWYgKG9yZGVyQ29sLmlzTm90TnVsbCgp\nKQogICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJudWxsYWJsZSIsICJm\nYWxzZSIpOwogICAgICAgICAgICBpZiAob3JkZXJDb2wuZ2V0RmxhZyhDb2x1\nbW4uRkxBR19VTklOU0VSVEFCTEUpKQogICAgICAgICAgICAgICAgYWRkQXR0\ncmlidXRlKCJpbnNlcnRhYmxlIiwgImZhbHNlIik7CiAgICAgICAgICAgIGlm\nIChvcmRlckNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFKSkK\nICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgidXBkYXRhYmxlIiwgImZh\nbHNlIik7CiAgICAgICAgICAgIGlmIChvcmRlckNvbC5nZXRUeXBlTmFtZSgp\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImNvbHVt\nbi1kZWZpbml0aW9uIiwgb3JkZXJDb2wuZ2V0VHlwZU5hbWUoKSk7CiAgICAg\nICAgICAgIHN0YXJ0RWxlbWVudCgib3JkZXItY29sdW1uIik7CiAgICAgICAg\nICAgIGVuZEVsZW1lbnQoIm9yZGVyLWNvbHVtbiIpOwogICAgICAgIH0gICAg\nICAgIAogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBm\naWVsZCBpcyBhIGxvYi4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlz\nTG9iKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAgIGZvciAoQ29sdW1u\nIGNvbCA6IChMaXN0PENvbHVtbj4pIGZpZWxkLmdldFZhbHVlSW5mbygpLmdl\ndENvbHVtbnMoKSkKICAgICAgICAgICAgaWYgKGNvbC5nZXRUeXBlKCkgPT0g\nVHlwZXMuQkxPQiB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkNMT0IpCiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gZmllbGQncyB0ZW1w\nb3JhbCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIFRlbXBvcmFsVHlwZSBn\nZXRUZW1wb3JhbChGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAgICAgICBpZiAo\nZmllbGQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5EQVRF\nCiAgICAgICAgICAgICYmIGZpZWxkLmdldERlY2xhcmVkVHlwZUNvZGUoKSAh\nPSBKYXZhVHlwZXMuQ0FMRU5EQVIpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9ICgoSkRCQ0NvbmZpZ3Vy\nYXRpb24pIGdldENvbmZpZ3VyYXRpb24oKSkKICAgICAgICAgICAgLmdldERC\nRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAgaW50IGRlZiA9IGRpY3Qu\nZ2V0SkRCQ1R5cGUoZmllbGQuZ2V0VHlwZUNvZGUoKSwgZmFsc2UpOwogICAg\nICAgIGZvciAoQ29sdW1uIGNvbCA6IChMaXN0PENvbHVtbj4pIGZpZWxkLmdl\ndFZhbHVlSW5mbygpLmdldENvbHVtbnMoKSkgewogICAgICAgICAgICBpZiAo\nY29sLmdldFR5cGUoKSA9PSBkZWYpCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgc3dpdGNoIChjb2wuZ2V0VHlwZSgpKSB7CiAgICAg\nICAgICAgICAgICBjYXNlIFR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIFRlbXBvcmFsVHlwZS5EQVRFOwogICAgICAgICAgICAgICAg\nY2FzZSBUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBU\nZW1wb3JhbFR5cGUuVElNRTsKICAgICAgICAgICAgICAgIGNhc2UgVHlwZXMu\nVElNRVNUQU1QOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUZW1wb3Jh\nbFR5cGUuVElNRVNUQU1QOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGVudW0gdHlwZSBmb3IgdGhlIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0\nZWQgRW51bVR5cGUgZ2V0RW51bVR5cGUoRmllbGRNYXBwaW5nIGZpZWxkKSB7\nCiAgICAgICAgaWYgKGZpZWxkLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBK\nYXZhVHlwZXMuT0JKRUNUKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAoIShmaWVsZC5nZXRIYW5kbGVyKCkgaW5zdGFuY2VvZiBFbnVt\nVmFsdWVIYW5kbGVyKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuICgoRW51bVZhbHVlSGFuZGxlcikgZmllbGQuZ2V0SGFuZGxl\ncigpKS5nZXRTdG9yZU9yZGluYWwoKQogICAgICAgICAgICA/IEVudW1UeXBl\nLk9SRElOQUwgOiBFbnVtVHlwZS5TVFJJTkc7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXJpYWxpemUgdGhlIGNvbHVtbnMgaW4gdGhlIGdpdmVuIG1hcHBp\nbmcgaW5mby4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZUNv\nbHVtbnMoTWFwcGluZ0luZm8gaW5mbywgQ29sVHlwZSB0eXBlLAogICAgICAg\nIFN0cmluZyBzZWNvbmRhcnkpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlv\nbiB7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSAoTGlzdDxDb2x1bW4+\nKSBpbmZvLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZm9yIChDb2x1bW4gY29s\nIDogY29scykKICAgICAgICAgICAgc2VyaWFsaXplQ29sdW1uKGNvbCwgdHlw\nZSwgc2Vjb25kYXJ5LCBpbmZvLmdldFVuaXF1ZSgpICE9IG51bGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGEgc2luZ2xlIGNvbHVtbi4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZUNvbHVtbihDb2x1\nbW4gY29sLCBDb2xUeXBlIHR5cGUsIFN0cmluZyBzZWNvbmRhcnksCiAgICAg\nICAgYm9vbGVhbiB1bmlxdWUpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGNvbC5nZXROYW1lKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgYWRkQXR0cmlidXRlKCJuYW1lIiwgY29sLmdldE5hbWUoKSk7CiAg\nICAgICAgaWYgKGNvbC5nZXRUeXBlTmFtZSgpICE9IG51bGwpCiAgICAgICAg\nICAgIGFkZEF0dHJpYnV0ZSgiY29sdW1uLWRlZmluaXRpb24iLCBjb2wuZ2V0\nVHlwZU5hbWUoKSk7CiAgICAgICAgaWYgKGNvbC5nZXRUYXJnZXQoKSAhPSBu\ndWxsCiAgICAgICAgICAgICYmICh0eXBlID09IENvbFR5cGUuSk9JTiB8fCB0\neXBlID09IENvbFR5cGUuSU5WRVJTRQogICAgICAgICAgICB8fCB0eXBlID09\nIENvbFR5cGUuUEtfSk9JTikpCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgi\ncmVmZXJlbmNlZC1jb2x1bW4tbmFtZSIsIGNvbC5nZXRUYXJnZXQoKSk7CiAg\nICAgICAgaWYgKHR5cGUgPT0gQ29sVHlwZS5DT0wgfHwgdHlwZSA9PSBDb2xU\neXBlLkpPSU4KICAgICAgICAgICAgfHwgdHlwZSA9PSBDb2xUeXBlLlBLX0pP\nSU4pIHsKICAgICAgICAgICAgaWYgKHVuaXF1ZSkKICAgICAgICAgICAgICAg\nIGFkZEF0dHJpYnV0ZSgidW5pcXVlIiwgInRydWUiKTsKICAgICAgICAgICAg\naWYgKGNvbC5pc05vdE51bGwoKSkKICAgICAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgibnVsbGFibGUiLCAiZmFsc2UiKTsKICAgICAgICAgICAgaWYgKGNv\nbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkpCiAgICAgICAg\nICAgICAgICBhZGRBdHRyaWJ1dGUoImluc2VydGFibGUiLCAiZmFsc2UiKTsK\nICAgICAgICAgICAgaWYgKGNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBE\nQVRBQkxFKSkKICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgidXBkYXRh\nYmxlIiwgImZhbHNlIik7CiAgICAgICAgICAgIGlmIChzZWNvbmRhcnkgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgidGFibGUiLCBz\nZWNvbmRhcnkpOwoKICAgICAgICAgICAgaWYgKHR5cGUgPT0gQ29sVHlwZS5D\nT0wpIHsKICAgICAgICAgICAgICAgIGlmIChjb2wuZ2V0U2l6ZSgpID4gMCAm\nJiBjb2wuZ2V0U2l6ZSgpICE9IDI1NSkKICAgICAgICAgICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoImxlbmd0aCIsIGNvbC5nZXRTaXplKCkgKyAiIik7CiAg\nICAgICAgICAgICAgICBpZiAoY29sLmdldERlY2ltYWxEaWdpdHMoKSAhPSAw\nKQogICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgic2NhbGUiLCBj\nb2wuZ2V0RGVjaW1hbERpZ2l0cygpICsgIiIpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGlmICh0eXBlICE9IENvbFR5cGUuQ09MIHx8IGdl\ndEF0dHJpYnV0ZXMoKS5nZXRMZW5ndGgoKSA+IDApIHsKICAgICAgICAgICAg\nU3RyaW5nIG5hbWUgPSBjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19QS19KT0lO\nKSA/IF9uYW1lcwogICAgICAgICAgICAgICAgLmdldChDb2xUeXBlLlBLX0pP\nSU4pIDogX25hbWVzLmdldCh0eXBlKTsKICAgICAgICAgICAgc3RhcnRFbGVt\nZW50KG5hbWUpOwogICAgICAgICAgICBlbmRFbGVtZW50KG5hbWUpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplVW5pcXVl\nQ29uc3RyYWludChVbmlxdWUgdW5pcXVlKSB0aHJvd3MgU0FYRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNOb3RFbXB0eSh1bmlxdWUu\nZ2V0TmFtZSgpKSkgewogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUi\nLCB1bmlxdWUuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICAgICAgc3RhcnRF\nbGVtZW50KCJ1bmlxdWUtY29uc3RyYWludCIpOwogICAgICAgIENvbHVtbltd\nIGNvbHVtbnMgPSB1bmlxdWUuZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAo\nQ29sdW1uIGNvbHVtbjpjb2x1bW5zKSB7CiAgICAgICAgICAgIHN0YXJ0RWxl\nbWVudCgiY29sdW1uLW5hbWUiKTsKICAgICAgICAgICAgYWRkVGV4dChjb2x1\nbW4uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZW5kRWxlbWVudCgiY29sdW1u\nLW5hbWUiKTsKICAgICAgICB9CiAgICAgICAgZW5kRWxlbWVudCgidW5pcXVl\nLWNvbnN0cmFpbnQiKTsKICAgIH0KICAgIAogICAgQE92ZXJyaWRlCiAgICBw\ncm90ZWN0ZWQgU2VyaWFsaXphdGlvbkNvbXBhcmF0b3IgbmV3U2VyaWFsaXph\ndGlvbkNvbXBhcmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNYXBwaW5n\nU2VyaWFsaXphdGlvbkNvbXBhcmF0b3IoKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCB2b2lkIGFkZFN5c3RlbU1hcHBpbmdFbGVtZW50\ncyhDb2xsZWN0aW9uIHRvU2VyaWFsaXplKSB7CiAgICAgICAgaWYgKGlzUXVl\ncnlNb2RlKCkpCiAgICAgICAgICAgIHRvU2VyaWFsaXplLmFkZEFsbChnZXRR\ndWVyeVJlc3VsdE1hcHBpbmdzKG51bGwpKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCBpbnQgdHlwZShPYmplY3QgbykgewogICAgICAg\nIGludCB0eXBlID0gc3VwZXIudHlwZShvKTsKICAgICAgICBpZiAodHlwZSA9\nPSAtMSAmJiBvIGluc3RhbmNlb2YgUXVlcnlSZXN1bHRNYXBwaW5nKQogICAg\nICAgICAgICByZXR1cm4gVFlQRV9SRVNVTFRNQVA7CiAgICAgICAgcmV0dXJu\nIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlc3Vs\ndCBzZXQgbWFwcGluZ3MgZm9yIHRoZSBnaXZlbiBzY29wZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4gZ2V0UXVlcnlS\nZXN1bHRNYXBwaW5ncyhDbGFzc01ldGFEYXRhIGNtKSB7CiAgICAgICAgaWYg\nKF9yZXN1bHRzID09IG51bGwgfHwgX3Jlc3VsdHMuaXNFbXB0eSgpKQogICAg\nICAgICAgICByZXR1cm4gKExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPikgQ29s\nbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAgICAgICAgTGlzdDxRdWVyeVJlc3Vs\ndE1hcHBpbmc+IHJlc3VsdCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBfcmVzdWx0cy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBR\ndWVyeVJlc3VsdE1hcHBpbmcgZWxlbWVudCA9IF9yZXN1bHRzLmdldChpKTsK\nICAgICAgICAgICAgaWYgKChjbSA9PSBudWxsICYmIGVsZW1lbnQuZ2V0U291\ncmNlU2NvcGUoKSAhPSBudWxsKSB8fCAoY20gIT0gbnVsbAogICAgICAgICAg\nICAgICAgJiYgZWxlbWVudC5nZXRTb3VyY2VTY29wZSgpICE9IGNtLmdldERl\nc2NyaWJlZFR5cGUoKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJlc3VsdCA9IG5ldyBBcnJheUxpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPihf\ncmVzdWx0cy5zaXplKCkgLSBpKTsKICAgICAgICAgICAgcmVzdWx0LmFkZChl\nbGVtZW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChyZXN1bHQgPT0g\nbnVsbCkKICAgICAgICAgICAgPyAoTGlzdDxRdWVyeVJlc3VsdE1hcHBpbmc+\nKSBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUIDogcmVzdWx0OwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplU3lzdGVt\nTWFwcGluZ0VsZW1lbnQoT2JqZWN0IG9iaikKICAgICAgICB0aHJvd3MgU0FY\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgUXVlcnlS\nZXN1bHRNYXBwaW5nKQogICAgICAgICAgICBzZXJpYWxpemVRdWVyeVJlc3Vs\ndE1hcHBpbmcoKFF1ZXJ5UmVzdWx0TWFwcGluZykgb2JqKTsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZVF1ZXJ5\nTWFwcGluZ3MoQ2xhc3NNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBT\nQVhFeGNlcHRpb24gewogICAgICAgIGZvciAoUXVlcnlSZXN1bHRNYXBwaW5n\nIHJlcyA6IGdldFF1ZXJ5UmVzdWx0TWFwcGluZ3MobWV0YSkpCiAgICAgICAg\nICAgIHNlcmlhbGl6ZVF1ZXJ5UmVzdWx0TWFwcGluZyhyZXMpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2VyaWFsaXplIGdpdmVuIHJlc3VsdCBzZXQgbWFw\ncGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1ZXJ5\nUmVzdWx0TWFwcGluZyhRdWVyeVJlc3VsdE1hcHBpbmcgbWV0YSkKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWdldFNlcmlh\nbGl6ZUFubm90YXRpb25zKCkKICAgICAgICAgICAgJiYgbWV0YS5nZXRTb3Vy\nY2VUeXBlKCkgPT0gbWV0YS5TUkNfQU5OT1RBVElPTlMpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgYWRkQXR0cmlidXRlKCJuYW1lIiwgbWV0YS5n\nZXROYW1lKCkpOwogICAgICAgIHN0YXJ0RWxlbWVudCgic3FsLXJlc3VsdC1z\nZXQtbWFwcGluZyIpOwogICAgICAgIGZvciAoUXVlcnlSZXN1bHRNYXBwaW5n\nLlBDUmVzdWx0IHBjIDogbWV0YS5nZXRQQ1Jlc3VsdHMoKSkgewogICAgICAg\nICAgICBhZGRBdHRyaWJ1dGUoImVudGl0eS1jbGFzcyIsIHBjLmdldENhbmRp\nZGF0ZVR5cGUoKS5nZXROYW1lKCkpOwogICAgICAgICAgICBPYmplY3QgZGlz\nY3JpbSA9IHBjLmdldE1hcHBpbmcocGMuRElTQ1JJTUlOQVRPUik7CiAgICAg\nICAgICAgIGlmIChkaXNjcmltICE9IG51bGwpCiAgICAgICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoImRpc2NyaW1pbmF0b3ItY29sdW1uIiwgZGlzY3JpbS50\nb1N0cmluZygpKTsKCiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgiZW50aXR5\nLXJlc3VsdCIpOwogICAgICAgICAgICBmb3IgKFN0cmluZyBwYXRoIDogcGMu\nZ2V0TWFwcGluZ1BhdGhzKCkpIHsKICAgICAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgibmFtZSIsIHBhdGgpOwogICAgICAgICAgICAgICAgYWRkQXR0cmli\ndXRlKCJjb2x1bW4iLCBwYy5nZXRNYXBwaW5nKHBhdGgpLnRvU3RyaW5nKCkp\nOwogICAgICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJmaWVsZC1yZXN1bHQi\nKTsKICAgICAgICAgICAgICAgIGVuZEVsZW1lbnQoImZpZWxkLXJlc3VsdCIp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVuZEVsZW1lbnQoImVudGl0\neS1yZXN1bHQiKTsKICAgICAgICB9CiAgICAgICAgZm9yIChPYmplY3QgY29s\nIDogbWV0YS5nZXRDb2x1bW5SZXN1bHRzKCkpIHsKICAgICAgICAgICAgYWRk\nQXR0cmlidXRlKCJuYW1lIiwgY29sLnRvU3RyaW5nKCkpOwogICAgICAgICAg\nICBzdGFydEVsZW1lbnQoImNvbHVtbi1yZXN1bHQiKTsKICAgICAgICAgICAg\nZW5kRWxlbWVudCgiY29sdW1uLXJlc3VsdCIpOwogICAgICAgIH0KICAgICAg\nICBlbmRFbGVtZW50KCJzcWwtcmVzdWx0LXNldC1tYXBwaW5nIik7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVT\nZXF1ZW5jZShTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFnZXRTZXJpYWxpemVBbm5v\ndGF0aW9ucygpCiAgICAgICAgICAgICYmIG1ldGEuZ2V0U291cmNlVHlwZSgp\nID09IG1ldGEuU1JDX0FOTk9UQVRJT05TKQogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgaWYgKFNlcXVlbmNlTWFwcGluZy5JTVBMX1ZBTFVFX1RBQkxF\nLmVxdWFscyhtZXRhLmdldFNlcXVlbmNlUGx1Z2luKCkpKSB7CiAgICAgICAg\nICAgIHN1cGVyLnNlcmlhbGl6ZVNlcXVlbmNlKG1ldGEpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBTZXF1ZW5jZU1hcHBpbmcg\nc2VxID0gKFNlcXVlbmNlTWFwcGluZykgbWV0YTsKICAgICAgICBhZGRBdHRy\naWJ1dGUoIm5hbWUiLCBzZXEuZ2V0TmFtZSgpKTsKICAgICAgICBTdHJpbmcg\ndGFibGUgPSBzZXEuZ2V0VGFibGUoKTsKICAgICAgICBpZiAodGFibGUgIT0g\nbnVsbCkgewogICAgICAgICAgICBpbnQgZG90SWR4ID0gdGFibGUuaW5kZXhP\nZignLicpOwogICAgICAgICAgICBpZiAoZG90SWR4ID09IC0xKQogICAgICAg\nICAgICAgICAgYWRkQXR0cmlidXRlKCJ0YWJsZSIsIHRhYmxlKTsKICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoInRh\nYmxlIiwgdGFibGUuc3Vic3RyaW5nKGRvdElkeCArIDEpKTsKICAgICAgICAg\nICAgICAgIGFkZEF0dHJpYnV0ZSgic2NoZW1hIiwgdGFibGUuc3Vic3RyaW5n\nKDAsIGRvdElkeCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShzZXEuZ2V0UHJpbWFyeUtleUNv\nbHVtbigpKSkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJway1jb2x1bW4t\nbmFtZSIsIHNlcS5nZXRQcmltYXJ5S2V5Q29sdW1uKCkpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShzZXEuZ2V0U2VxdWVuY2VDb2x1bW4o\nKSkpCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgidmFsdWUtY29sdW1uLW5h\nbWUiLCBzZXEuZ2V0U2VxdWVuY2VDb2x1bW4oKSk7CiAgICAgICAgaWYgKCFT\ndHJpbmdVdGlscy5pc0VtcHR5KHNlcS5nZXRQcmltYXJ5S2V5VmFsdWUoKSkp\nCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgicGstY29sdW1uLXZhbHVlIiwg\nc2VxLmdldFByaW1hcnlLZXlWYWx1ZSgpKTsKICAgICAgICBpZiAoc2VxLmdl\ndEFsbG9jYXRlKCkgIT0gNTAgJiYgc2VxLmdldEFsbG9jYXRlKCkgIT0gLTEp\nCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgiYWxsb2NhdGlvbi1zaXplIiwg\nc2VxLmdldEFsbG9jYXRlKCkgKyAiIik7CiAgICAgICAgaWYgKHNlcS5nZXRJ\nbml0aWFsVmFsdWUoKSAhPSAwICYmIHNlcS5nZXRJbml0aWFsVmFsdWUoKSAh\nPSAtMSkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJpbml0aWFsLXZhbHVl\nIiwgc2VxLmdldEluaXRpYWxWYWx1ZSgpICsgIiIpOwogICAgICAgIHN0YXJ0\nRWxlbWVudCgidGFibGUtZ2VuZXJhdG9yIik7CiAgICAgICAgZW5kRWxlbWVu\ndCgidGFibGUtZ2VuZXJhdG9yIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb2x1bW4gdHlwZXMgc2VyaWFsaXplZCB1bmRlciBkaWZmZXJlbnQgbmFtZXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGVudW0gQ29sVHlwZSB7Cgog\nICAgICAgIENPTCwKICAgICAgICBKT0lOLAogICAgICAgIElOVkVSU0UsCiAg\nICAgICAgUEtfSk9JTiwKICAgICAgICBESVNDCiAgICB9CgogICAgLyoqCiAg\nICAgKiBFeHRlbmRzIHtAbGluayBTZXJpYWxpemF0aW9uQ29tcGFyYXRvcn0g\nZm9yIHN0b3JlLXNwZWNpZmljIHRhZ3Mgc3VjaAogICAgICogYXMgJmx0O3Nx\nbC1yZXN1bHQtc2V0LW1hcHBpbmcmZ3Q7LgogICAgICoKICAgICAqIEBhdXRo\nb3IgUGluYWtpIFBvZGRhcgogICAgICovCiAgICBwcm90ZWN0ZWQgY2xhc3Mg\nTWFwcGluZ1NlcmlhbGl6YXRpb25Db21wYXJhdG9yCiAgICAgICAgZXh0ZW5k\ncyBTZXJpYWxpemF0aW9uQ29tcGFyYXRvciB7CgogICAgICAgIHByb3RlY3Rl\nZCBpbnQgY29tcGFyZVVua25vd24oT2JqZWN0IG8xLCBPYmplY3QgbzIpIHsK\nICAgICAgICAgICAgaWYgKCEobzEgaW5zdGFuY2VvZiBRdWVyeVJlc3VsdE1h\ncHBpbmcpKQogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmNvbXBhcmVV\nbmtub3duKG8xLCBvMik7CgogICAgICAgICAgICBRdWVyeVJlc3VsdE1hcHBp\nbmcgcmVzMSA9IChRdWVyeVJlc3VsdE1hcHBpbmcpIG8xOwogICAgICAgICAg\nICBRdWVyeVJlc3VsdE1hcHBpbmcgcmVzMiA9IChRdWVyeVJlc3VsdE1hcHBp\nbmcpIG8yOwoKICAgICAgICAgICAgLy8gc3lzdGVtIHNjb3BlIGJlZm9yZSBj\nbGFzcyBzY29wZQogICAgICAgICAgICBPYmplY3Qgc2NvcGUxID0gcmVzMS5n\nZXRTb3VyY2VTY29wZSgpOwogICAgICAgICAgICBPYmplY3Qgc2NvcGUyID0g\ncmVzMi5nZXRTb3VyY2VTY29wZSgpOwogICAgICAgICAgICBpZiAoc2NvcGUx\nID09IG51bGwgJiYgc2NvcGUyICE9IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gLTE7CiAgICAgICAgICAgIGlmIChzY29wZTEgIT0gbnVsbCAmJiBz\nY29wZTIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAxOwoKICAg\nICAgICAgICAgLy8gY29tcGFyZSBvbiBsaXN0aW5nIGluZGV4LCBvciBpZiBu\nb25lL3NhbWUsIHVzZSBuYW1lCiAgICAgICAgICAgIGludCBsaXN0aW5nSW5k\nZXgxID0gcmVzMS5nZXRMaXN0aW5nSW5kZXgoKTsKICAgICAgICAgICAgaW50\nIGxpc3RpbmdJbmRleDIgPSByZXMyLmdldExpc3RpbmdJbmRleCgpOwogICAg\nICAgICAgICBpZiAobGlzdGluZ0luZGV4MSAhPSBsaXN0aW5nSW5kZXgyKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGxpc3RpbmdJbmRleDEgLSBsaXN0aW5n\nSW5kZXgyOwogICAgICAgICAgICByZXR1cm4gcmVzMS5nZXROYW1lICgpLmNv\nbXBhcmVUbyAocmVzMi5nZXROYW1lICgpKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

