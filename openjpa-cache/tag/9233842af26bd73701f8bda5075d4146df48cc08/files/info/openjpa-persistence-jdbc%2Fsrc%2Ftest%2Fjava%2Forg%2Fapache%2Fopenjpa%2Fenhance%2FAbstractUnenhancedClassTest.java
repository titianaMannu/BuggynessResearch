{"sha":"a62569b9bb2fa9e8f17c8ffdaa1b1128e27c5e31","node_id":"MDQ6QmxvYjIwNjM2NDphNjI1NjliOWJiMmZhOWU4ZjE3YzhmZmRhYTFiMTEyOGUyN2M1ZTMx","size":22453,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a62569b9bb2fa9e8f17c8ffdaa1b1128e27c5e31","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEu\naW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLkJ5dGVBcnJheU91dHB1\ndFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0T3V0cHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RJbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEu\naW8uQnl0ZUFycmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEu\nbGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CgppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLnRlc3QuU2luZ2xlRU1GVGVzdENhc2U7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuT3BlbkpQ\nQUVudGl0eU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVy\nc2lzdGVuY2UuSlBBRmFjYWRlSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQWNjZXNzQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmV2ZW50LkFic3RyYWN0TGlmZWN5Y2xlTGlzdGVuZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7Cgpw\ndWJsaWMgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RVbmVuaGFuY2VkQ2xhc3NU\nZXN0CiAgICBleHRlbmRzIFNpbmdsZUVNRlRlc3RDYXNlIHsKCiAgICBMb2cg\nX2xvZzsKICAgIC8vICMjIyMjIFRvIGRvOgogICAgLy8gLSBjbGVhcmluZyBp\nbiBwbmV3IHByb3BlcnR5LWFjY2VzcyB3aXRob3V0IHJlZGVmaW5pdGlvbgog\nICAgLy8gLSBmaWd1cmUgb3V0IGhvdyB0byBhdXRvLXRlc3QgdGhlIHJlZGVm\naW5pdGlvbiBjb2RlLCBlaXRoZXIgaW4gSmF2YSA1CiAgICAvLyAgIG9yIGlu\nIEphdmEgNgogICAgLy8gLSBydW4gQ1RTIGluIHRoZSBmb2xsb3dpbmcgY29t\nYmluYXRpb25zOgogICAgLy8gICAqIEphdmEgNgogICAgLy8gICAqIEphdmEg\nNSB3aXRoIGphdmFhZ2VudAogICAgLy8gICAqIEphdmEgNSB3aXRob3V0IGph\ndmFhZ2VudAoKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgewogICAgICAgIHNl\ndFVwKGdldFVuZW5oYW5jZWRDbGFzcygpLCBnZXRVbmVuaGFuY2VkU3ViY2xh\nc3MoKSwgQ0xFQVJfVEFCTEVTKTsKICAgICAgICAvLyB0cmlnZ2VyIGNsYXNz\nIHJlZGVmaW5pdGlvbgogICAgICAgIGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2Vy\nKCkuY2xvc2UoKTsKICAgICAgICBfbG9nID0gZW1mLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0Up\nOwogICAgfQoKICAgIHByb3RlY3RlZCBhYnN0cmFjdCBDbGFzczw/IGV4dGVu\nZHMgVW5lbmhhbmNlZFR5cGU+IGdldFVuZW5oYW5jZWRDbGFzcygpOwoKICAg\nIHByb3RlY3RlZCBhYnN0cmFjdCBVbmVuaGFuY2VkVHlwZSBuZXdVbmVuaGFu\nY2VkSW5zdGFuY2UoKTsKCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgQ2xhc3M8\nPyBleHRlbmRzIFVuZW5oYW5jZWRTdWJ0eXBlPgogICAgICAgICAgICBnZXRV\nbmVuaGFuY2VkU3ViY2xhc3MoKTsKCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qg\nVW5lbmhhbmNlZFN1YnR5cGUgbmV3VW5lbmhhbmNlZFN1YmNsYXNzSW5zdGFu\nY2UoKTsKCiAgICBwcml2YXRlIFVuZW5oYW5jZWRUeXBlIG5ld0luc3RhbmNl\nKGJvb2xlYW4gc3ViKSB7CiAgICAgICAgcmV0dXJuIHN1YiA/IG5ld1VuZW5o\nYW5jZWRTdWJjbGFzc0luc3RhbmNlKCkKICAgICAgICAgICAgOiBuZXdVbmVu\naGFuY2VkSW5zdGFuY2UoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nTWV0YURhdGEoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gSlBB\nRmFjYWRlSGVscGVyLmdldE1ldGFEYXRhKGVtZiwKICAgICAgICAgICAgZ2V0\nVW5lbmhhbmNlZENsYXNzKCkpOwogICAgICAgIGFzc2VydEVxdWFscyhDbGFz\nc1JlZGVmaW5lci5jYW5SZWRlZmluZUNsYXNzZXMoX2xvZyksIG1ldGEKICAg\nICAgICAgICAgLmlzSW50ZXJjZXB0aW5nKCkpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RJbXBsSGVscGVyQ2FsbHMoKSB7CiAgICAgICAgYXNzZXJ0\nVHJ1ZShJbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUobnVsbCwgZ2V0VW5lbmhh\nbmNlZENsYXNzKCkpKTsKCiAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4gPSBu\nZXdVbmVuaGFuY2VkSW5zdGFuY2UoKTsKICAgICAgICBhc3NlcnRGYWxzZSh1\nbiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJsZSk7CiAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNl\nQ2FwYWJsZSh1biwKICAgICAgICAgICAgZW1mLmdldENvbmZpZ3VyYXRpb24o\nKSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChwYyk7CiAgICAgICAgYXNzZXJ0\nVHJ1ZShJbXBsSGVscGVyLmlzTWFuYWdlYWJsZSh1bikpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHRlc3RCYXNpY1BlcnNpc3RlbmNlQ2FwYWJsZUJlaGF2\naW9yKCkgewogICAgICAgIFVuZW5oYW5jZWRUeXBlIHVuID0gbmV3VW5lbmhh\nbmNlZEluc3RhbmNlKCk7CiAgICAgICAgdW4uc2V0U3RyaW5nRmllbGQoImJh\nciIpOwogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxw\nZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodW4sCiAgICAgICAgICAgIGVtZi5n\nZXRDb25maWd1cmF0aW9uKCkpOwogICAgICAgIGFzc2VydEZhbHNlKHBjLnBj\nSXNEZWxldGVkKCkpOwogICAgICAgIGFzc2VydEZhbHNlKHBjLnBjSXNEaXJ0\neSgpKTsKICAgICAgICBhc3NlcnRGYWxzZShwYy5wY0lzTmV3KCkpOwogICAg\nICAgIGFzc2VydEZhbHNlKHBjLnBjSXNQZXJzaXN0ZW50KCkpOwogICAgICAg\nIGFzc2VydEZhbHNlKHBjLnBjSXNUcmFuc2FjdGlvbmFsKCkpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHRlc3RQQ1JlZ2lzdHJ5KCkgewogICAgICAgIGFz\nc2VydFRydWUoUENSZWdpc3RyeS5pc1JlZ2lzdGVyZWQoZ2V0VW5lbmhhbmNl\nZENsYXNzKCkpKTsKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBQ\nQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKAogICAgICAgICAgICBnZXRVbmVuaGFu\nY2VkQ2xhc3MoKSwgbnVsbCwgZmFsc2UpOwogICAgICAgIGFzc2VydE5vdE51\nbGwocGMpOwogICAgICAgIGFzc2VydEVxdWFscyhwYy5nZXRDbGFzcygpLCBQ\nQ1JlZ2lzdHJ5LmdldFBDVHlwZShnZXRVbmVuaGFuY2VkQ2xhc3MoKSkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RDbGVhcmluZ09uU3VidHlwZUlu\nc3RhbmNlKCkgewogICAgICAgIC8vIHRoZSBib29sZWFuIGF0IHRoZSBlbmQg\nb2YgbmV3SW5zdGFuY2Ugd2lsbCBjYXVzZSBjbGVhciB0byBiZSBpbnZva2Vk\nCiAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4gPSAoVW5lbmhhbmNlZFR5cGUp\nCiAgICAgICAgICAgIFBDUmVnaXN0cnkubmV3SW5zdGFuY2UoZ2V0VW5lbmhh\nbmNlZENsYXNzKCksIG51bGwsIHRydWUpOwogICAgICAgIGFzc2VydEVxdWFs\ncyhudWxsLCB1bi5nZXRTdHJpbmdGaWVsZCgpKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB0ZXN0R2V0T2JqZWN0SWRPbk9wZW5KUEFUeXBlKCkgewogICAg\nICAgIGdldE9iamVjdElkSGVscGVyKHRydWUsIGZhbHNlKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0R2V0T2JqZWN0SWRPbk9wZW5KUEFUeXBlU3Vi\nY2xhc3MoKSB7CiAgICAgICAgZ2V0T2JqZWN0SWRIZWxwZXIoZmFsc2UsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0T2JqZWN0SWRP\nblVzZXJEZWZpbmVkKCkgewogICAgICAgIGdldE9iamVjdElkSGVscGVyKHRy\ndWUsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RHZXRPYmpl\nY3RJZE9uVXNlckRlZmluZWRTdWJjbGFzcygpIHsKICAgICAgICBnZXRPYmpl\nY3RJZEhlbHBlcihmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIGdldE9iamVjdElkSGVscGVyKGJvb2xlYW4gc3ViLCBib29sZWFuIHVz\nZXJEZWZpbmVkKSB7CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0g\nPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIGVtLmdldFRy\nYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBVbmVuaGFuY2VkVHlwZSB1\nbiA9IG5ld0luc3RhbmNlKHN1Yik7CiAgICAgICAgZW0ucGVyc2lzdCh1bik7\nCiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKCiAgICAg\nICAgaWYgKCF1c2VyRGVmaW5lZCkgewogICAgICAgICAgICBlbS5jbG9zZSgp\nOwogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nCiAgICAgICAgICAgIHVuID0gZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKSwgdW4uZ2V0SWQoKSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnROb3RO\ndWxsKGVtLmdldE9iamVjdElkKHVuKSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgdGVzdE9wZXJhdGlvbnNPblVzZXJEZWZpbmVkKCkgewogICAgICAgIG9w\nc0hlbHBlcihmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndGVzdFN1YmNsYXNzT3BlcmF0aW9uc09uVXNlckRlZmluZWQoKSB7CiAgICAg\nICAgb3BzSGVscGVyKHRydWUsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHRlc3RPcGVyYXRpb25zT25PcGVuSlBBRGVmaW5lZCgpIHsKICAgICAg\nICBvcHNIZWxwZXIoZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0U3ViY2xhc3NPcGVyYXRpb25zT25PcGVuSlBBRGVmaW5lZCgp\nIHsKICAgICAgICBvcHNIZWxwZXIodHJ1ZSwgZmFsc2UpOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBvcHNIZWxwZXIoYm9vbGVhbiBzdWIsIGJvb2xlYW4g\ndXNlckRlZmluZWQpIHsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBl\nbSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgVW5lbmhhbmNl\nZFR5cGUgdW4gPSBuZXdJbnN0YW5jZShzdWIpOwogICAgICAgICAgICBlbSA9\nIGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CgogICAgICAgICAgICBlbS5n\nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIGVtLnBlcnNp\nc3QodW4pOwogICAgICAgICAgICB1bi5zZXRTdHJpbmdGaWVsZCgiYmFyIik7\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiYmFyIiwgdW4uZ2V0U3RyaW5n\nRmllbGQoKSk7CiAgICAgICAgICAgIGFzc2VydFBlcnNpc3RlbmNlQ29udGV4\ndChlbSwgdW4sIHRydWUsIHRydWUsIHN1Yik7CiAgICAgICAgICAgIGVtLmZs\ndXNoKCk7CiAgICAgICAgICAgIGFzc2VydFBlcnNpc3RlbmNlQ29udGV4dChl\nbSwgdW4sIHRydWUsIHRydWUsIHN1Yik7CiAgICAgICAgICAgIGFzc2VydFRy\ndWUodW4uZ2V0SWQoKSAhPSAwKTsKICAgICAgICAgICAgVW5lbmhhbmNlZFR5\ncGUgdW4yID0gZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3MoKSwgdW4uZ2V0\nSWQoKSk7CiAgICAgICAgICAgIGFzc2VydFNhbWUodW4sIHVuMik7CiAgICAg\nICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAg\nICAgIGFzc2VydFBlcnNpc3RlbmNlQ29udGV4dChlbSwgdW4sIGZhbHNlLCBm\nYWxzZSwgc3ViKTsKICAgICAgICAgICAgdW4yID0gZW0uZmluZChnZXRVbmVu\naGFuY2VkQ2xhc3MoKSwgdW4uZ2V0SWQoKSk7CiAgICAgICAgICAgIGFzc2Vy\ndFNhbWUodW4sIHVuMik7CgogICAgICAgICAgICBpZiAoIXVzZXJEZWZpbmVk\nKSB7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhhbmNlZENs\nYXNzKCksIHVuLmdldElkKCkpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxs\nKHVuKTsKICAgICAgICAgICAgaWYgKCF1c2VyRGVmaW5lZCkKICAgICAgICAg\nICAgICAgIGFzc2VydFRydWUodW4gaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZUNh\ncGFibGUpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoImJhciIsIHVuLmdl\ndFN0cmluZ0ZpZWxkKCkpOwogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CiAgICAgICAgICAgIHVuLnNldFN0cmluZ0ZpZWxkKCJi\nYXoiKTsKICAgICAgICAgICAgYXNzZXJ0UGVyc2lzdGVuY2VDb250ZXh0KGVt\nLCB1biwgdHJ1ZSwgdHJ1ZSwgc3ViKTsKICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJiYXoiLCB1bi5nZXRTdHJpbmdGaWVsZCgpKTsKCiAgICAgICAgICAg\nIGlmIChzdWIpCiAgICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBl\nKSB1bikuc2V0SW50RmllbGQoMTcpOwoKICAgICAgICAgICAgYXNzZXJ0VHJ1\nZShlbS5pc0RpcnR5KHVuKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBl\nbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwoKICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIHRoYXQgdGhlIHZhbHVlcyBhcmUgc3RpbGwgdXAtdG8tZGF0\nZSBhZnRlcgogICAgICAgICAgICAvLyB0aGUgY29tbWl0IGhhcHBlbnMKICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKCJiYXoiLCB1bi5nZXRTdHJpbmdGaWVs\nZCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVtLmNsb3NlKCk7Cgog\nICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAg\nICAgICAgICAgIHVuID0gZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3MoKSwg\ndW4uZ2V0SWQoKSk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwodW4pOwog\nICAgICAgICAgICBhc3NlcnRUcnVlKHVuIGluc3RhbmNlb2YgUGVyc2lzdGVu\nY2VDYXBhYmxlKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJiYXoiLCB1\nbi5nZXRTdHJpbmdGaWVsZCgpKTsKICAgICAgICAgICAgaWYgKHN1YikKICAg\nICAgICAgICAgICAgIGFzc2VydEVxdWFscygxNywgKChVbmVuaGFuY2VkU3Vi\ndHlwZSkgdW4pLmdldEludEZpZWxkKCkpOwogICAgICAgICAgICBlbS5jbG9z\nZSgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChlbSAh\nPSBudWxsICYmIGVtLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAg\nICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsK\nICAgICAgICAgICAgaWYgKGVtICE9IG51bGwgJiYgZW0uaXNPcGVuKCkpCiAg\nICAgICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgYXNzZXJ0UGVyc2lzdGVuY2VDb250ZXh0KE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyIGVtLAogICAgICAgIFVuZW5oYW5jZWRUeXBlIHVu\nLCBib29sZWFuIHRyYW5zYWN0aW9uYWwsIGJvb2xlYW4gZGlydHksIGJvb2xl\nYW4gc3ViKSB7CiAgICAgICAgYXNzZXJ0RXF1YWxzKHRyYW5zYWN0aW9uYWws\nIGVtLmdldFRyYW5zYWN0aW9uYWxPYmplY3RzKCkuY29udGFpbnModW4pKTsK\nICAgICAgICBhc3NlcnRFcXVhbHMoZGlydHksIGVtLmdldERpcnR5T2JqZWN0\ncygpLmNvbnRhaW5zKHVuKSk7CiAgICAgICAgaWYgKGRpcnR5KSB7CiAgICAg\nICAgICAgIENsYXNzIGNscyA9IHN1YiA/IGdldFVuZW5oYW5jZWRTdWJjbGFz\ncygpIDogZ2V0VW5lbmhhbmNlZENsYXNzKCk7CiAgICAgICAgICAgIGFzc2Vy\ndFRydWUoZW0uZ2V0VXBkYXRlZENsYXNzZXMoKS5jb250YWlucyhjbHMpCiAg\nICAgICAgICAgICAgICB8fCBlbS5nZXRQZXJzaXN0ZWRDbGFzc2VzKCkuY29u\ndGFpbnMoY2xzKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHRlc3RSZWxhdGlvbnMoKSB7CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFn\nZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBVbmVuaGFuY2Vk\nU3VidHlwZSB1biA9IG5ld1VuZW5oYW5jZWRTdWJjbGFzc0luc3RhbmNlKCk7\nCiAgICAgICAgZW0ucGVyc2lzdCh1bik7CiAgICAgICAgdW4uc2V0U3RyaW5n\nRmllbGQoImFvZXUiKTsKICAgICAgICBVbmVuaGFuY2VkU3VidHlwZSByZWxh\ndGVkID0gbmV3VW5lbmhhbmNlZFN1YmNsYXNzSW5zdGFuY2UoKTsKICAgICAg\nICB1bi5zZXRSZWxhdGVkKHJlbGF0ZWQpOwogICAgICAgIHJlbGF0ZWQuc2V0\nU3RyaW5nRmllbGQoInNudGgiKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmNvbW1pdCgpOwogICAgICAgIGVtLmNsb3NlKCk7CgogICAgICAgIGVt\nID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICB1biA9IChV\nbmVuaGFuY2VkU3VidHlwZSkgZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKSwgdW4uZ2V0SWQoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJhb2V1Iiwg\ndW4uZ2V0U3RyaW5nRmllbGQoKSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbCh1\nbi5nZXRSZWxhdGVkKCkpOwogICAgICAgIGFzc2VydEVxdWFscygic250aCIs\nIHVuLmdldFJlbGF0ZWQoKS5nZXRTdHJpbmdGaWVsZCgpKTsKICAgICAgICBl\nbS5jbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RFbmhhbmNl\ncigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxDbGFzczw/\nPj4gc3VicyA9ICBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyLnByZXBhcmVVbmVu\naGFuY2VkQ2xhc3NlcygKICAgICAgICAgICAgZW1mLmdldENvbmZpZ3VyYXRp\nb24oKSwgQ29sbGVjdGlvbnMuc2luZ2xldG9uKGdldFVuZW5oYW5jZWRDbGFz\ncygpKSwgbnVsbCk7CiAgICAgICAgQ2xhc3Mgc3ViID0gc3Vicy5nZXQoMCk7\nCiAgICAgICAgYXNzZXJ0Tm90TnVsbChzdWIpOwogICAgICAgIGFzc2VydEVx\ndWFscygib3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuIgogICAgICAgICAg\nICArIGdldFVuZW5oYW5jZWRDbGFzcygpLmdldE5hbWUoKS5yZXBsYWNlKCcu\nJywgJyQnKSArICIkcGNzdWJjbGFzcyIsCiAgICAgICAgICAgIHN1Yi5nZXRO\nYW1lKCkpOwogICAgICAgIGFzc2VydFRydWUoUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oc3ViKSk7CiAgICAgICAgYXNzZXJ0\nVHJ1ZShnZXRVbmVuaGFuY2VkQ2xhc3MoKS5pc0Fzc2lnbmFibGVGcm9tKHN1\nYikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RQQ1N1YmNsYXNzTmFt\nZSgpIHsKICAgICAgICBhc3NlcnRFcXVhbHMoIm9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLiIKICAgICAgICAgICAgKyBnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKS5nZXROYW1lKCkucmVwbGFjZSgnLicsICckJykgKyAiJHBjc3ViY2xhc3Mi\nLAogICAgICAgICAgICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoZ2V0\nVW5lbmhhbmNlZENsYXNzKCkpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0\nZXN0RXZpY3Rpb25JblVzZXJDcmVhdGVkSW5zdGFuY2UoKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hGaWVsZEV4Y2VwdGlvbiwgSWxsZWdhbEFjY2Vzc0V4Y2Vw\ndGlvbiB7CiAgICAgICAgZXZpY3Rpb25IZWxwZXIodHJ1ZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgdGVzdEV2aWN0aW9uSW5PcGVuSlBBQ3JlYXRlZElu\nc3RhbmNlKCkKICAgICAgICB0aHJvd3MgTm9TdWNoRmllbGRFeGNlcHRpb24s\nIElsbGVnYWxBY2Nlc3NFeGNlcHRpb24gewogICAgICAgIGV2aWN0aW9uSGVs\ncGVyKGZhbHNlKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZpY3Rpb25I\nZWxwZXIoYm9vbGVhbiB1c2VyRGVmaW5lZCkKICAgICAgICB0aHJvd3MgTm9T\ndWNoRmllbGRFeGNlcHRpb24sIElsbGVnYWxBY2Nlc3NFeGNlcHRpb24gewog\nICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICBVbmVuaGFuY2VkVHlwZSB1biA9IG5l\nd1VuZW5oYW5jZWRJbnN0YW5jZSgpOwogICAgICAgIGVtLmdldFRyYW5zYWN0\naW9uKCkuYmVnaW4oKTsKICAgICAgICBlbS5wZXJzaXN0KHVuKTsKICAgICAg\nICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwoKICAgICAgICBpZiAo\nIXVzZXJEZWZpbmVkKSB7CiAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAg\nICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAg\nICAgICAgdW4gPSBlbS5maW5kKGdldFVuZW5oYW5jZWRDbGFzcygpLCB1bi5n\nZXRJZCgpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShnZXRVbmVuaGFuY2Vk\nQ2xhc3MoKSAhPSB1bi5nZXRDbGFzcygpKTsKICAgICAgICB9CgogICAgICAg\nIGVtLmV2aWN0KHVuKTsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpCiAgICAgICAgICAgIEltcGxIZWxw\nZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodW4sIG51bGwpLnBjR2V0U3RhdGVN\nYW5hZ2VyKCk7CgogICAgICAgIC8vIHdlIG9ubHkgZXhwZWN0IGxhenkgbG9h\nZGluZyB0byB3b3JrIHdoZW4gd2UgY2FuIHJlZGVmaW5lIGNsYXNzZXMKICAg\nICAgICAvLyBvciB3aGVuIGFjY2Vzc2luZyBhIHByb3BlcnR5LWFjY2VzcyBy\nZWNvcmQgdGhhdCBPcGVuSlBBIGNyZWF0ZWQuCiAgICAgICAgaWYgKENsYXNz\nUmVkZWZpbmVyLmNhblJlZGVmaW5lQ2xhc3NlcyhfbG9nKQogICAgICAgICAg\nICB8fCAoIXVzZXJEZWZpbmVkIAogICAgICAgICAgICAJJiYgQWNjZXNzQ29k\nZS5pc1Byb3BlcnR5KHNtLmdldE1ldGFEYXRhKCkuZ2V0QWNjZXNzVHlwZSgp\nKSkpIHsKCiAgICAgICAgICAgIGFzc2VydEZhbHNlKHNtLmdldExvYWRlZCgp\nCiAgICAgICAgICAgICAgICAuZ2V0KHNtLmdldE1ldGFEYXRhKCkuZ2V0Rmll\nbGQoInN0cmluZ0ZpZWxkIikuZ2V0SW5kZXgoKSkpOwoKICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHZhbHVlIHdhcyBjbGVhcmVkLi4uCiAg\nICAgICAgICAgIEZpZWxkIGZpZWxkID0gZ2V0VW5lbmhhbmNlZENsYXNzKCku\nZ2V0RGVjbGFyZWRGaWVsZCgKICAgICAgICAgICAgICAgIGlzRmllbGRBY2Nl\nc3NUZXN0KCkgPyAic3RyaW5nRmllbGQiIDogInNmIik7CiAgICAgICAgICAg\nIGZpZWxkLnNldEFjY2Vzc2libGUodHJ1ZSk7CiAgICAgICAgICAgIGFzc2Vy\ndEVxdWFscyhudWxsLCBmaWVsZC5nZXQodW4pKTsKCiAgICAgICAgICAgIC8v\nIC4uLiBhbmQgdGhhdCBpdCBnZXRzIHJlbG9hZGVkIHByb3Blcmx5CiAgICAg\nICAgICAgIGFzc2VydEVxdWFscygiZm9vIiwgdW4uZ2V0U3RyaW5nRmllbGQo\nKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoc20uZ2V0TG9hZGVkKCkKICAg\nICAgICAgICAgICAgIC5nZXQoc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZCgi\nc3RyaW5nRmllbGQiKS5nZXRJbmRleCgpKSk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgLy8gdW5yZWRlZmluZWQgcHJvcGVydGllcyB3aXRoIHVz\nZXItZGVmaW5lZCBpbnN0YW5jZSwgb3IgYW55CiAgICAgICAgICAgIC8vIHVu\ncmVkZWZpbmVkIGZpZWxkIGFjY2VzcwogICAgICAgICAgICBhc3NlcnRUcnVl\nKHNtLmdldExvYWRlZCgpCiAgICAgICAgICAgICAgICAuZ2V0KHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RmllbGQoInN0cmluZ0ZpZWxkIikuZ2V0SW5kZXgoKSkp\nOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHZhbHVlIHdh\ncyBub3QgY2xlYXJlZAogICAgICAgICAgICBGaWVsZCBmaWVsZCA9IGdldFVu\nZW5oYW5jZWRDbGFzcygpLmdldERlY2xhcmVkRmllbGQoCiAgICAgICAgICAg\nICAgICBpc0ZpZWxkQWNjZXNzVGVzdCgpID8gInN0cmluZ0ZpZWxkIiA6ICJz\nZiIpOwogICAgICAgICAgICBmaWVsZC5zZXRBY2Nlc3NpYmxlKHRydWUpOwog\nICAgICAgICAgICBhc3NlcnRFcXVhbHMoImZvbyIsIGZpZWxkLmdldCh1bikp\nOwogICAgICAgIH0KCiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgYWJzdHJhY3QgYm9vbGVhbiBpc0ZpZWxkQWNjZXNzVGVzdCgp\nOwoKICAgIHB1YmxpYyB2b2lkIHRlc3RMYXp5TG9hZGluZygpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaEZpZWxkRXhjZXB0aW9uLCBJbGxlZ2FsQWNjZXNzRXhj\nZXB0aW9uIHsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVt\nZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgVW5lbmhhbmNlZFR5\ncGUgdW4gPSBuZXdVbmVuaGFuY2VkSW5zdGFuY2UoKTsKICAgICAgICBlbS5n\nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgZW0ucGVyc2lzdCh1\nbik7CiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAg\nICAgICBlbS5jbG9zZSgpOwoKICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgdW4gPSBlbS5maW5kKGdldFVuZW5oYW5j\nZWRDbGFzcygpLCB1bi5nZXRJZCgpKTsKICAgICAgICBhc3NlcnRUcnVlKGdl\ndFVuZW5oYW5jZWRDbGFzcygpICE9IHVuLmdldENsYXNzKCkpOwogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdl\ncikKICAgICAgICAgICAgSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJs\nZSh1biwgbnVsbCkucGNHZXRTdGF0ZU1hbmFnZXIoKTsKCiAgICAgICAgLy8g\nd2Ugb25seSBleHBlY3QgbGF6eSBsb2FkaW5nIHRvIHdvcmsgd2hlbiB3ZSBj\nYW4gcmVkZWZpbmUgY2xhc3NlcwogICAgICAgIC8vIG9yIHdoZW4gYWNjZXNz\naW5nIGEgcHJvcGVydHktYWNjZXNzIHJlY29yZCB0aGF0IE9wZW5KUEEgY3Jl\nYXRlZC4KICAgICAgICBpZiAoQ2xhc3NSZWRlZmluZXIuY2FuUmVkZWZpbmVD\nbGFzc2VzKF9sb2cpCiAgICAgICAgICAgIHx8IEFjY2Vzc0NvZGUuaXNQcm9w\nZXJ0eShzbS5nZXRNZXRhRGF0YSgpLmdldEFjY2Vzc1R5cGUoKSkpIHsKICAg\nICAgICAgICAgYXNzZXJ0RmFsc2Uoc20uZ2V0TG9hZGVkKCkKICAgICAgICAg\nICAgICAgIC5nZXQoc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZCgibGF6eUZp\nZWxkIikuZ2V0SW5kZXgoKSkpOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIHRoYXQgdGhlIHZhbHVlIHdhcyBjbGVhcmVkCiAgICAgICAgICAgIEZpZWxk\nIGZpZWxkID0gZ2V0VW5lbmhhbmNlZENsYXNzKCkuZ2V0RGVjbGFyZWRGaWVs\nZCgibGF6eUZpZWxkIik7CiAgICAgICAgICAgIGZpZWxkLnNldEFjY2Vzc2li\nbGUodHJ1ZSk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyhudWxsLCBmaWVs\nZC5nZXQodW4pKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB1\nbnJlZGVmaW5lZCBmaWVsZCBhY2Nlc3MKICAgICAgICAgICAgYXNzZXJ0VHJ1\nZShzbS5nZXRMb2FkZWQoKQogICAgICAgICAgICAgICAgLmdldChzbS5nZXRN\nZXRhRGF0YSgpLmdldEZpZWxkKCJsYXp5RmllbGQiKS5nZXRJbmRleCgpKSk7\nCgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgdmFsdWUgd2Fz\nIGxvYWRlZCBhbHJlYWR5CiAgICAgICAgICAgIEZpZWxkIGZpZWxkID0gZ2V0\nVW5lbmhhbmNlZENsYXNzKCkuZ2V0RGVjbGFyZWRGaWVsZCgibGF6eUZpZWxk\nIik7CiAgICAgICAgICAgIGZpZWxkLnNldEFjY2Vzc2libGUodHJ1ZSk7CiAg\nICAgICAgICAgIGFzc2VydEVxdWFscygibGF6eSIsIGZpZWxkLmdldCh1bikp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHZh\nbHVlIGlzIGF2YWlsYWJsZSwgb25lIHdheSBvciBhbm90aGVyCiAgICAgICAg\nYXNzZXJ0RXF1YWxzKCJsYXp5IiwgdW4uZ2V0TGF6eUZpZWxkKCkpOwogICAg\nICAgIGFzc2VydFRydWUoc20uZ2V0TG9hZGVkKCkKICAgICAgICAgICAgLmdl\ndChzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKCJsYXp5RmllbGQiKS5nZXRJ\nbmRleCgpKSk7CgogICAgICAgIGVtLmNsb3NlKCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgdGVzdFNlcmlhbGl6YXRpb25PZlVzZXJEZWZpbmVkSW5zdGFu\nY2UoKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3Vu\nZEV4Y2VwdGlvbiB7CiAgICAgICAgc2VyaWFsaXphdGlvbkhlbHBlcih0cnVl\nLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFNlcmlhbGl6\nYXRpb25PZlVzZXJEZWZpbmVkU3ViY2xhc3NJbnN0YW5jZSgpCiAgICAgICAg\ndGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsK\nICAgICAgICBzZXJpYWxpemF0aW9uSGVscGVyKHRydWUsIHRydWUpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RTZXJpYWxpemF0aW9uT2ZPcGVuSlBB\nRGVmaW5lZEluc3RhbmNlKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24s\nIENsYXNzTm90Rm91bmRFeGNlcHRpb24gewogICAgICAgIHNlcmlhbGl6YXRp\nb25IZWxwZXIoZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0U2VyaWFsaXphdGlvbk9mT3BlbkpQQURlZmluZWRTdWJjbGFzc0lu\nc3RhbmNlKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90\nRm91bmRFeGNlcHRpb24gewogICAgICAgIHNlcmlhbGl6YXRpb25IZWxwZXIo\nZmFsc2UsIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXJpYWxp\nemF0aW9uSGVscGVyKGJvb2xlYW4gdXNlckRlZmluZWQsIGJvb2xlYW4gc3Vi\nKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4\nY2VwdGlvbiB7CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBl\nbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIFVuZW5oYW5jZWRU\neXBlIHVuID0gbmV3SW5zdGFuY2Uoc3ViKTsKICAgICAgICBlbS5nZXRUcmFu\nc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgZW0ucGVyc2lzdCh1bik7Cgog\nICAgICAgIGlmIChzdWIpIHsKICAgICAgICAgICAgVW5lbmhhbmNlZFR5cGUg\ncmVsYXRlZCA9IG5ld0luc3RhbmNlKGZhbHNlKTsKICAgICAgICAgICAgcmVs\nYXRlZC5zZXRTdHJpbmdGaWVsZCgicmVsYXRlZCIpOwogICAgICAgICAgICAo\nKFVuZW5oYW5jZWRTdWJ0eXBlKSB1bikuc2V0UmVsYXRlZChyZWxhdGVkKTsK\nICAgICAgICB9CgogICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0\nKCk7CgogICAgICAgIGlmICghdXNlckRlZmluZWQpIHsKICAgICAgICAgICAg\nZW0uY2xvc2UoKTsKICAgICAgICAgICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5\nTWFuYWdlcigpOwogICAgICAgIH0KCiAgICAgICAgdW4gPSBlbS5maW5kKGdl\ndFVuZW5oYW5jZWRDbGFzcygpLCB1bi5nZXRJZCgpKTsKICAgICAgICBCeXRl\nQXJyYXlPdXRwdXRTdHJlYW0gb3V0ID0gbmV3IEJ5dGVBcnJheU91dHB1dFN0\ncmVhbSgpOwogICAgICAgIE9iamVjdE91dHB1dFN0cmVhbSBvb3V0ID0gbmV3\nIE9iamVjdE91dHB1dFN0cmVhbShvdXQpOwogICAgICAgIG9vdXQud3JpdGVP\nYmplY3QodW4pOwogICAgICAgIG9vdXQuZmx1c2goKTsKICAgICAgICBieXRl\nW10gYnl0ZXMgPSBvdXQudG9CeXRlQXJyYXkoKTsKCiAgICAgICAgT2JqZWN0\nSW5wdXRTdHJlYW0gb2luID0gbmV3IE9iamVjdElucHV0U3RyZWFtKAogICAg\nICAgICAgICBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0oYnl0ZXMpKTsKICAg\nICAgICBVbmVuaGFuY2VkVHlwZSBkZXNlcmlhbGl6ZWQgPSAoVW5lbmhhbmNl\nZFR5cGUpIG9pbi5yZWFkT2JqZWN0KCk7CgogICAgICAgIGNvcGllZEluc3Rh\nbmNlSGVscGVyKHN1YiwgZW0sIHVuLCBkZXNlcmlhbGl6ZWQsIGZhbHNlKTsK\nICAgICAgICBlbS5jbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRl\nc3RDbG9uaW5nT2ZVc2VyRGVmaW5lZEluc3RhbmNlKCkKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIENsb25l\nTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAgICBjbG9uZUhlbHBlcih0\ncnVlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdENsb25p\nbmdPZlVzZXJEZWZpbmVkU3ViY2xhc3NJbnN0YW5jZSgpCiAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBDbG9u\nZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7CiAgICAgICAgY2xvbmVIZWxwZXIo\ndHJ1ZSwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdENsb25p\nbmdPZk9wZW5KUEFEZWZpbmVkSW5zdGFuY2UoKQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVOb3RT\ndXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGNsb25lSGVscGVyKGZhbHNl\nLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdENsb25pbmdP\nZk9wZW5KUEFEZWZpbmVkU3ViY2xhc3NJbnN0YW5jZSgpCiAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBDbG9u\nZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7CiAgICAgICAgY2xvbmVIZWxwZXIo\nZmFsc2UsIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBjbG9uZUhl\nbHBlcihib29sZWFuIHVzZXJEZWZpbmVkLCBib29sZWFuIHN1YikKICAgICAg\nICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24s\nIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAgICBPcGVuSlBB\nRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nCiAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4gPSBuZXdJbnN0YW5jZShzdWIp\nOwogICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAg\nICBlbS5wZXJzaXN0KHVuKTsKCiAgICAgICAgaWYgKHN1YikgewogICAgICAg\nICAgICBVbmVuaGFuY2VkVHlwZSByZWxhdGVkID0gbmV3SW5zdGFuY2UoZmFs\nc2UpOwogICAgICAgICAgICByZWxhdGVkLnNldFN0cmluZ0ZpZWxkKCJyZWxh\ndGVkIik7CiAgICAgICAgICAgICgoVW5lbmhhbmNlZFN1YnR5cGUpIHVuKS5z\nZXRSZWxhdGVkKHJlbGF0ZWQpOwogICAgICAgIH0KCiAgICAgICAgZW0uZ2V0\nVHJhbnNhY3Rpb24oKS5jb21taXQoKTsKCiAgICAgICAgaWYgKCF1c2VyRGVm\naW5lZCkgewogICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICBl\nbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgfQoKICAg\nICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhhbmNlZENsYXNzKCksIHVuLmdl\ndElkKCkpOwogICAgICAgIFVuZW5oYW5jZWRUeXBlIGNsb25lZCA9IChVbmVu\naGFuY2VkVHlwZSkgdW4uY2xvbmUoKTsKCiAgICAgICAgY29waWVkSW5zdGFu\nY2VIZWxwZXIoc3ViLCBlbSwgdW4sIGNsb25lZCwgdHJ1ZSk7CiAgICAgICAg\nZW0uY2xvc2UoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY29waWVkSW5z\ndGFuY2VIZWxwZXIoYm9vbGVhbiBzdWIsIE9wZW5KUEFFbnRpdHlNYW5hZ2Vy\nIGVtLAogICAgICAgIFVuZW5oYW5jZWRUeXBlIHVuLCBVbmVuaGFuY2VkVHlw\nZSBjb3B5LCBib29sZWFuIHZpYUNsb25lKSB7CiAgICAgICAgYXNzZXJ0Tm90\nU2FtZSh1biwgY29weSk7CiAgICAgICAgaWYgKCF2aWFDbG9uZSkKICAgICAg\nICAgICAgYXNzZXJ0RXF1YWxzKHN1YiA/IGdldFVuZW5oYW5jZWRTdWJjbGFz\ncygpIDogZ2V0VW5lbmhhbmNlZENsYXNzKCksCiAgICAgICAgICAgICAgICBj\nb3B5LmdldENsYXNzKCkpOwogICAgICAgIGFzc2VydEVxdWFscyh1bi5nZXRJ\nZCgpLCBjb3B5LmdldElkKCkpOwogICAgICAgIGFzc2VydEVxdWFscyh1bi5n\nZXRTdHJpbmdGaWVsZCgpLCBjb3B5LmdldFN0cmluZ0ZpZWxkKCkpOwogICAg\nICAgIGlmIChzdWIpIHsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKAogICAg\nICAgICAgICAgICAgKChVbmVuaGFuY2VkU3VidHlwZSkgdW4pLmdldEludEZp\nZWxkKCksCiAgICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBlKSBj\nb3B5KS5nZXRJbnRGaWVsZCgpKTsKICAgICAgICAgICAgYXNzZXJ0Tm90U2Ft\nZSgKICAgICAgICAgICAgICAgICgoVW5lbmhhbmNlZFN1YnR5cGUpIHVuKS5n\nZXRSZWxhdGVkKCksCiAgICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0\neXBlKSBjb3B5KS5nZXRSZWxhdGVkKCkpOwogICAgICAgICAgICBhc3NlcnRF\ncXVhbHMoCiAgICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBlKSB1\nbikuZ2V0UmVsYXRlZCgpLmdldElkKCksCiAgICAgICAgICAgICAgICAoKFVu\nZW5oYW5jZWRTdWJ0eXBlKSBjb3B5KS5nZXRSZWxhdGVkKCkuZ2V0SWQoKSk7\nCiAgICAgICAgfQoKICAgICAgICBhc3NlcnRGYWxzZShlbS5pc0RldGFjaGVk\nKHVuKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShlbS5pc0RldGFjaGVkKGNvcHkp\nKTsKCiAgICAgICAgLyoKICAgICAgICAjIyMjIyBuZWVkIHRvIG1ha2UgZGV0\nYWNobWVudCBhbGdvcml0aG0gaW4gUmVmbGVjdGluZ1BDIHNtYXJ0ZXIKICAg\nICAgICAvLyBlbnN1cmUgdGhhdCByZW1vdmUoKSBjYW5ub3QgYmUgaW52b2tl\nZCBvbiBhIGRldGFjaGVkIGluc3RhbmNlCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAg\nICBlbS5yZW1vdmUoY29weSk7CiAgICAgICAgICAgIGZhaWwoInJlbW92ZSgp\nIGNhbm5vdCBiZSBpbnZva2VkIG9uIGRldGFjaGVkIGluc3RhbmNlIik7CiAg\nICAgICAgfSBjYXRjaCAoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwog\nICAgICAgIH0KICAgICAgICAqLwoKICAgICAgICBjb3B5LnNldFN0cmluZ0Zp\nZWxkKCJvZmZsaW5lIHVwZGF0ZSIpOwoKICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLmJlZ2luKCk7CiAgICAgICAgYXNzZXJ0U2FtZSh1biwgZW0ubWVy\nZ2UoY29weSkpOwogICAgICAgIGFzc2VydFRydWUoZW0uaXNEaXJ0eSh1bikp\nOwogICAgICAgIGFzc2VydEVxdWFscygib2ZmbGluZSB1cGRhdGUiLCB1bi5n\nZXRTdHJpbmdGaWVsZCgpKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigp\nLmNvbW1pdCgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RMaXN0ZW5l\ncnNPblVzZXJEZWZpbmVkSW5zdGFuY2UoKQogICAgICAgIHRocm93cyBJT0V4\nY2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVOb3RTdXBw\nb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGxpc3RlbmVySGVscGVyKHRydWUs\nIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0TGlzdGVuZXJz\nT25Vc2VyRGVmaW5lZFN1YmNsYXNzSW5zdGFuY2UoKQogICAgICAgIHRocm93\ncyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVO\nb3RTdXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGxpc3RlbmVySGVscGVy\nKHRydWUsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RMaXN0\nZW5lcnNPbk9wZW5KUEFEZWZpbmVkSW5zdGFuY2UoKQogICAgICAgIHRocm93\ncyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVO\nb3RTdXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGxpc3RlbmVySGVscGVy\nKGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdExp\nc3RlbmVyc09uT3BlbkpQQURlZmluZWRTdWJjbGFzc0luc3RhbmNlKCkKICAg\nICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRp\nb24sIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAgICBsaXN0\nZW5lckhlbHBlcihmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIGxpc3RlbmVySGVscGVyKGJvb2xlYW4gdXNlckRlZmluZWQsIGJvb2xl\nYW4gc3ViKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RG\nb3VuZEV4Y2VwdGlvbiwgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gewog\nICAgICAgIExpc3RlbmVySW1wbCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcklt\ncGwoKTsKICAgICAgICBlbWYuYWRkTGlmZWN5Y2xlTGlzdGVuZXIobGlzdGVu\nZXIsIChDbGFzc1tdKSBudWxsKTsKICAgICAgICBPcGVuSlBBRW50aXR5TWFu\nYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAg\nVW5lbmhhbmNlZFR5cGUgdW4gPSBuZXdJbnN0YW5jZShzdWIpOwogICAgICAg\nIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBlbS5wZXJz\naXN0KHVuKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgp\nOwoKICAgICAgICBpZiAoIXVzZXJEZWZpbmVkKSB7CiAgICAgICAgICAgIGVt\nLmNsb3NlKCk7CiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1h\nbmFnZXIoKTsKICAgICAgICB9CgogICAgICAgIGxpc3RlbmVyLmludm9rZWQg\nPSBmYWxzZTsKCiAgICAgICAgdW4gPSBlbS5maW5kKGdldFVuZW5oYW5jZWRD\nbGFzcygpLCB1bi5nZXRJZCgpKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CiAgICAgICAgdW4uc2V0U3RyaW5nRmllbGQoInVwZGF0\nZWQiKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwog\nICAgICAgIGFzc2VydFRydWUobGlzdGVuZXIuaW52b2tlZCk7CiAgICAgICAg\nZW0uY2xvc2UoKTsKCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJ1cGRhdGVkIiwg\nbGlzdGVuZXIuc3RyaW5nRmllbGQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHRlc3RHZXRNZXRhRGF0YU9mU3VidHlwZSgpIHsKICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSBKUEFGYWNhZGVIZWxwZXIuZ2V0TWV0YURhdGEoZW1m\nLAogICAgICAgICAgICBnZXRVbmVuaGFuY2VkQ2xhc3MoKSk7CiAgICAgICAg\nTGlzdDxDbGFzczw/Pj4gc3VicyA9ICBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2Vy\nLnByZXBhcmVVbmVuaGFuY2VkQ2xhc3NlcygKICAgICAgICAgICAgZW1mLmdl\ndENvbmZpZ3VyYXRpb24oKSwgQ29sbGVjdGlvbnMuc2luZ2xldG9uKGdldFVu\nZW5oYW5jZWRDbGFzcygpKSwKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAg\nYXNzZXJ0U2FtZShtZXRhLCBKUEFGYWNhZGVIZWxwZXIuZ2V0TWV0YURhdGEo\nZW1mLCBzdWJzLmdldCgwKSkpOwoKICAgICAgICBtZXRhID0gSlBBRmFjYWRl\nSGVscGVyLmdldE1ldGFEYXRhKGVtZiwgZ2V0VW5lbmhhbmNlZFN1YmNsYXNz\nKCkpOwogICAgICAgIHN1YnMgPSAgTWFuYWdlZENsYXNzU3ViY2xhc3Nlci5w\ncmVwYXJlVW5lbmhhbmNlZENsYXNzZXMoCiAgICAgICAgICAgIGVtZi5nZXRD\nb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgIENvbGxlY3Rpb25zLnNpbmds\nZXRvbihnZXRVbmVuaGFuY2VkU3ViY2xhc3MoKSksIG51bGwpOwogICAgICAg\nIGFzc2VydFNhbWUobWV0YSwgSlBBRmFjYWRlSGVscGVyLmdldE1ldGFEYXRh\nKGVtZiwgc3Vicy5nZXQoMCkpKTsKICAgIH0KCiAgICBwcml2YXRlIGNsYXNz\nIExpc3RlbmVySW1wbAogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RMaWZlY3lj\nbGVMaXN0ZW5lciB7CgogICAgICAgIFN0cmluZyBzdHJpbmdGaWVsZDsKICAg\nICAgICBib29sZWFuIGludm9rZWQ7CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIGFmdGVyU3RvcmUoTGlmZWN5Y2xlRXZlbnQgZXZl\nbnQpIHsKICAgICAgICAgICAgaW52b2tlZCA9IHRydWU7CiAgICAgICAgICAg\nIHN0cmluZ0ZpZWxkID0gKChVbmVuaGFuY2VkVHlwZSkgZXZlbnQuZ2V0U291\ncmNlKCkpLmdldFN0cmluZ0ZpZWxkKCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

