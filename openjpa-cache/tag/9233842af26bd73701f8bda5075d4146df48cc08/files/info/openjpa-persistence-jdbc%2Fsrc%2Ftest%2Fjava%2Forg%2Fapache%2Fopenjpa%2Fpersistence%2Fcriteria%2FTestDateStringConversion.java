{"sha":"a2eacca173b9797c193887c94825f08fc8c2ed60","node_id":"MDQ6QmxvYjIwNjM2NDphMmVhY2NhMTczYjk3OTdjMTkzODg3Yzk0ODI1ZjA4ZmM4YzJlZDYw","size":7031,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a2eacca173b9797c193887c94825f08fc8c2ed60","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuY3JpdGVy\naWE7CgppbXBvcnQgamF2YS5zcWwuRGF0ZTsKaW1wb3J0IGphdmEuc3FsLlRp\nbWU7CmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5jcml0ZXJpYS5D\ncml0ZXJpYVF1ZXJ5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuY3JpdGVy\naWEuUm9vdDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZp\nbHRlcnM7CgovKioKICogVGVzdCBKREJDIEVzY2FwZSBTeW50YXggZGF0ZS90\naW1lIHN0cmluZ3MgaW4gcXVlcnkuCiAqIAogKiAKICogQGF1dGhvciBQaW5h\na2kgUG9kZGFyCiAqCiAqLwpwdWJsaWMgY2xhc3MgVGVzdERhdGVTdHJpbmdD\nb252ZXJzaW9uIGV4dGVuZHMgQ3JpdGVyaWFUZXN0IHsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIFN0cmluZyBPUEVOX0JSQUNLRVQgID0gInsiOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIENMT1NFX0JSQUNLRVQgPSAi\nfSI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0lOR0xFX1FV\nT1RFICA9ICInIjsKICAgIAogICAgdm9pZCBjcmVhdGVEYXRhKFN0cmluZyBu\nYW1lKSB7CiAgICAgICAgbG9uZyBub3cgPSBTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKTsKICAgICAgICBsb25nIHRvbW9ycm93ID0gbm93ICsgMjQqNjAq\nNjAqMTAwMCsxOwogICAgICAgIAogICAgICAgIERhdGUgZGF0ZSA9IG5ldyBE\nYXRlKHRvbW9ycm93KTsKICAgICAgICBEZXBlbmRlbnRJZCBpZCA9IG5ldyBE\nZXBlbmRlbnRJZCgpOwogICAgICAgIGlkLnNldEVmZkRhdGUoZGF0ZSk7CiAg\nICAgICAgaWQuc2V0TmFtZShuYW1lKTsKICAgICAgICBEZXBlbmRlbnQgcGMg\nPSBuZXcgRGVwZW5kZW50KCk7CiAgICAgICAgcGMuc2V0SWQoaWQpOwogICAg\nICAgIHBjLnNldEVuZERhdGUoZGF0ZSk7CiAgICAgICAgZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5iZWdpbigpOwogICAgICAgIGVtLnBlcnNpc3QocGMpOwogICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogVGhlIHBlcnNpc3RlbnQgcHJvcGVydHkgRGVwZW5k\nZW50LmVuZERhdGUgYmVpbmcgdGVzdGVkIGlzIGRlY2xhcmVkIGFzIERhdGUg\nYnV0IG1hcHBlZCB3aXRoCiAgICAgKiBAVGVtcG9yYWwoVGVtcG9yYWxUeXBl\nLlRJTUVTVEFNUCkuIAogICAgICogCiAgICAgKiBXaGVuIGV4ZWN1dGluZyBK\nUFFMLCB0aGUgcXVlcnkgc3RyaW5nIGRpcmVjdGx5IHVzZXMgYSBKREJDIEVz\nY2FwZSBTeW50YXggdGhhdCBpcyBwYXNzZWQKICAgICAqIHRvIEpEQkMgRHJp\ndmVyIGFuZCBoZW5jZSB0aGF0IHN0cmluZyBzaG91bGQgZW5jb2RlIGEgVGlt\nZXN0YW1wLgogICAgICogCiAgICAgKiBDcml0ZXJpYSBRdWVyeSwgb24gdGhl\nIG90aGVyIGhhbmQsIG11c3QgY29uZm9ybSB0byB0aGUgQVBJIHNpZ25hdHVy\nZSBhbmQgaGVuY2UgdGhlIGV4cHJlc3Npb24KICAgICAqIHRoYXQgdGFrZXMg\ndGhlIEpEQkMgRXNjYXBlIFN5bnRheCBtdXN0IGJlIGNhc3QgdG8gRGF0ZS5j\nbGFzcyB0byBtYXRjaCB0aGUgZGVjbGFyZWQgdHlwZSBvZgogICAgICogRGVw\nZW5kZW50LmVuZERhdGUuCiAgICAgKiAKICAgICAqLwogICAgcHVibGljIHZv\naWQgdGVzdERhdGVTdHJpbmcoKSB7CiAgICAgICAgY3JlYXRlRGF0YSgidGVz\ndERhdGVTdHJpbmciKTsKICAgICAgICBsb25nIG5vdyA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpOwogICAgICAgIAogICAgICAgIFN0cmluZyBkYXRl\nU3RyaW5nID0gY3JlYXRlSkRCQ0VzY2FwZVN0cmluZyhuZXcgRGF0ZShub3cp\nKTsKICAgICAgICBTdHJpbmcgdHNTdHJpbmcgPSBjcmVhdGVKREJDRXNjYXBl\nU3RyaW5nKG5ldyBUaW1lc3RhbXAobm93KSk7CiAgICAgICAgCiAgICAgICAg\nLy8gYWRkIFRpbWVzdGFtcCBzdHJpbmcgYmVjYXVzZSBEZXBlbmRlbnQuZW5k\nRGF0ZSBpcyBtYXBwZWQgdG8gVGVtcG9yYWxUeXBlLlRpbWVTdGFtcAogICAg\nICAgIFN0cmluZyBqcHFsID0gInNlbGVjdCBkIGZyb20gRGVwZW5kZW50IGQg\nd2hlcmUgZC5lbmREYXRlID49ICIgKyB0c1N0cmluZyArICIgT1JERVIgQlkg\nZC5lbmREYXRlIjsKICAgICAgICAKICAgICAgICAKICAgICAgICBDcml0ZXJp\nYVF1ZXJ5PERlcGVuZGVudD4gYyA9IGNiLmNyZWF0ZVF1ZXJ5KERlcGVuZGVu\ndC5jbGFzcyk7CiAgICAgICAgUm9vdDxEZXBlbmRlbnQ+IGQgPSBjLmZyb20o\nRGVwZW5kZW50LmNsYXNzKTsKICAgICAgICAvLyB0aGUgbGl0ZXJhbCBpcyBj\nYXN0IHRvIERhdGUuY2xhc3MgYmVjYXVzZSBEZXBlbmRlbnQuZW5kRGF0ZSBp\ncyBkZWNsYXJlZCBhcyBEYXRlCiAgICAgICAgYy53aGVyZShjYi5ncmVhdGVy\nVGhhbk9yRXF1YWxUbyhkLmdldChEZXBlbmRlbnRfLmVuZERhdGUpLCBjYi5s\naXRlcmFsKGRhdGVTdHJpbmcpLmFzKERhdGUuY2xhc3MpKSk7CiAgICAgICAg\nYy5vcmRlckJ5KGNiLmFzYyhkLmdldChEZXBlbmRlbnRfLmVuZERhdGUpKSk7\nCiAgICAgICAgCiAgICAgICAgLy8gY2FuIG5vdCBjb21wYXJlIFNRTCBiZWNh\ndXNlIEpQUUwgYW5kIENyaXRlcmlhIGhhbmRsZXMgSkRCQyBlc2NhcGUgc3lu\ndGF4IGluIAogICAgICAgIC8vIGEgZGlmZmVyZW50IHdheS4KICAgICAgICBh\nc3NlcnRTYW1lUmVzdWx0KGMsIGpwcWwpOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEEgc2ltaWxhciBxdWVyeSBidXQgdGhlIEpEQkMgRXNjYXBlIFN0\ncmluZyBpcyBwYXNzZWQgYXMgYW4gcGFyYW1ldGVyLgogICAgICogUGFyYW1l\ndGVyIHZhbHVlIGJpbmRpbmcgaXMgcmVsYXhlZCB0byBhY2NlcHQgdGhlIHN0\ncmluZyBhcyBhIHZhbHVlCiAgICAgKiBvZiB0ZW1wb3JhbCB0eXBlIGluc3Rh\nbmNlLgogICAgICogSGVuY2UgZG9lcyBub3QgcmVxdWlyZSwgYXMgaW4gdGhl\nIHRoZSBlYXJsaWVyIGNhc2UsIHRvIHVzZSBkaWZmZXJlbnQgCiAgICAgKiBl\nc2NhcGUgc3RyaW5nLiAKICAgICAqLwogICAgcHVibGljIHZvaWQgdGVzdERh\ndGVTdHJpbmdBc1BhcmFtZXRlcigpIHsKICAgICAgICBjcmVhdGVEYXRhKCJ0\nZXN0RGF0ZVN0cmluZ0FzUGFyYW1ldGVyIik7CiAgICAgICAgbG9uZyBub3cg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAKICAgICAg\nICBEYXRlIGVhcmxpZXIgPSBuZXcgRGF0ZShub3cgLSAxMDAwKTsKICAgICAg\nICAKICAgICAgICBTdHJpbmcgZGF0ZVN0cmluZyA9IGNyZWF0ZUpEQkNFc2Nh\ncGVTdHJpbmcoZWFybGllcik7CiAgICAgICAgU3RyaW5nIGpwcWwgPSAic2Vs\nZWN0IGQgZnJvbSBEZXBlbmRlbnQgZCB3aGVyZSBkLmVuZERhdGUgPj0gOmRh\ndGVTdHJpbmcgT1JERVIgQlkgZC5lbmREYXRlIjsKICAgICAgICBDcml0ZXJp\nYVF1ZXJ5PERlcGVuZGVudD4gYyA9IGNiLmNyZWF0ZVF1ZXJ5KERlcGVuZGVu\ndC5jbGFzcyk7CiAgICAgICAgUm9vdDxEZXBlbmRlbnQ+IGQgPSBjLmZyb20o\nRGVwZW5kZW50LmNsYXNzKTsKICAgICAgICAKICAgICAgICBjLndoZXJlKGNi\nLmdyZWF0ZXJUaGFuT3JFcXVhbFRvKGQuZ2V0KERlcGVuZGVudF8uZW5kRGF0\nZSksIGNiLnBhcmFtZXRlcihTdHJpbmcuY2xhc3MsICJkYXRlU3RyaW5nIikK\nICAgICAgICAgICAgICAgIC5hcyhEYXRlLmNsYXNzKSkpOwogICAgICAgIGMu\nb3JkZXJCeShjYi5hc2MoZC5nZXQoRGVwZW5kZW50Xy5lbmREYXRlKSkpOwog\nICAgICAgIAogICAgICAgIGFzc2VydEVxdWl2YWxlbmNlKGMsIGpwcWwsIG5l\ndyBTdHJpbmdbXXsiZGF0ZVN0cmluZyJ9LCBuZXcgT2JqZWN0W117ZGF0ZVN0\ncmluZ30pOwogICAgfQogICAgCiAgICBTdHJpbmcgY3JlYXRlSkRCQ0VzY2Fw\nZVN0cmluZyhPYmplY3QgdGltZSkgewogICAgICAgIFN0cmluZyBrZXkgPSAi\nIjsKICAgICAgICBpZiAodGltZSBpbnN0YW5jZW9mIERhdGUpCiAgICAgICAg\nICAgIGtleSA9ICJkICI7CiAgICAgICAgZWxzZSBpZiAodGltZSBpbnN0YW5j\nZW9mIFRpbWUpCiAgICAgICAgICAgIGtleSA9ICJ0ICI7CiAgICAgICAgZWxz\nZSBpZiAodGltZSBpbnN0YW5jZW9mIFRpbWVzdGFtcCkKICAgICAgICAgICAg\na2V5ID0gInRzICI7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZhaWwo\nIldyb25nIG9iamVjdCAiICsgdGltZSArICIgb2YgIiArIHRpbWUuZ2V0Q2xh\nc3MoKSArICIgZm9yIEpEQkMgY29udmVyc2lvbiIpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gT1BFTl9CUkFDS0VUICsga2V5ICsgU0lOR0xFX1FVT1RF\nICsgdGltZS50b1N0cmluZygpICsgU0lOR0xFX1FVT1RFICsgQ0xPU0VfQlJB\nQ0tFVDsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgdGVzdEpEQkNFc2Nh\ncGVTeW50YXhUaW1lc3RhbXAoKSB7CiAgICAgICAgVGltZXN0YW1wIHRzID0g\nbmV3IFRpbWVzdGFtcChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAg\nICAgICAgU3RyaW5nIHMgPSAie3RzICciICsgdHMudG9TdHJpbmcoKSArICIn\nfSI7CiAgICAgICAgYXNzZXJ0VHJ1ZShGaWx0ZXJzLmlzSkRCQ1RlbXBvcmFs\nU3ludGF4KHMpKTsKICAgICAgICBhc3NlcnROb3ROdWxsKEZpbHRlcnMucGFy\nc2VKREJDVGVtcG9yYWxTeW50YXgocykpOwogICAgICAgIE9iamVjdCBjb252\nZXJ0ZWQgPSBGaWx0ZXJzLmNvbnZlcnQocywgVGltZXN0YW1wLmNsYXNzKTsK\nICAgICAgICBhc3NlcnRUcnVlKGNvbnZlcnRlZCBpbnN0YW5jZW9mIFRpbWVz\ndGFtcCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJPcmlnaW5hbD0iICsgcyAr\nICIgQ29udmVydGVkICIgKyBjb252ZXJ0ZWQsIHRzLnRvU3RyaW5nKCksIGNv\nbnZlcnRlZC50b1N0cmluZygpKTsKICAgIH0KICAgIAogICAgcHVibGljIHZv\naWQgdGVzdEpEQkNFc2NhcGVTeW50YXhUaW1lKCkgewogICAgICAgIFRpbWUg\ndCA9IG5ldyBUaW1lKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAg\nICAgICBTdHJpbmcgcyA9ICJ7dCAnIiArIHQudG9TdHJpbmcoKSArICInfSI7\nCiAgICAgICAgYXNzZXJ0VHJ1ZShGaWx0ZXJzLmlzSkRCQ1RlbXBvcmFsU3lu\ndGF4KHMpKTsKICAgICAgICBhc3NlcnROb3ROdWxsKEZpbHRlcnMucGFyc2VK\nREJDVGVtcG9yYWxTeW50YXgocykpOwogICAgICAgIE9iamVjdCBjb252ZXJ0\nZWQgPSBGaWx0ZXJzLmNvbnZlcnQocywgVGltZS5jbGFzcyk7CiAgICAgICAg\nYXNzZXJ0VHJ1ZShjb252ZXJ0ZWQgaW5zdGFuY2VvZiBUaW1lKTsKICAgICAg\nICBhc3NlcnRFcXVhbHMoIk9yaWdpbmFsPSIgKyBzICsgIiBDb252ZXJ0ZWQg\nIiArIGNvbnZlcnRlZCwgdC50b1N0cmluZygpLCBjb252ZXJ0ZWQudG9TdHJp\nbmcoKSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHRlc3RKREJDRXNj\nYXBlU3ludGF4RGF0ZSgpIHsKICAgICAgICBEYXRlIGQgPSBuZXcgRGF0ZShT\neXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAgICAgU3RyaW5nIHMg\nPSAie2QgJyIgKyBkLnRvU3RyaW5nKCkgKyAiJ30iOwogICAgICAgIGFzc2Vy\ndFRydWUoRmlsdGVycy5pc0pEQkNUZW1wb3JhbFN5bnRheChzKSk7CiAgICAg\nICAgYXNzZXJ0Tm90TnVsbChGaWx0ZXJzLnBhcnNlSkRCQ1RlbXBvcmFsU3lu\ndGF4KHMpKTsKICAgICAgICBPYmplY3QgY29udmVydGVkID0gRmlsdGVycy5j\nb252ZXJ0KHMsIERhdGUuY2xhc3MpOwogICAgICAgIGFzc2VydFRydWUoY29u\ndmVydGVkIGluc3RhbmNlb2YgRGF0ZSk7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKCJPcmlnaW5hbD0iICsgcyArICIgQ29udmVydGVkICIgKyBjb252ZXJ0ZWQs\nIGQudG9TdHJpbmcoKSwgY29udmVydGVkLnRvU3RyaW5nKCkpOwogICAgfQog\nICAgCiAgICB2b2lkIGFzc2VydFNhbWVSZXN1bHQoQ3JpdGVyaWFRdWVyeTxE\nZXBlbmRlbnQ+IGMsIFN0cmluZyBqcHFsKSB7CiAgICAgICAgTGlzdDxEZXBl\nbmRlbnQ+IGpSZXN1bHQgPSBlbS5jcmVhdGVRdWVyeShqcHFsKS5nZXRSZXN1\nbHRMaXN0KCk7CiAgICAgICAgTGlzdDxEZXBlbmRlbnQ+IGNSZXN1bHQgPSBl\nbS5jcmVhdGVRdWVyeShjKS5nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgYXNz\nZXJ0RmFsc2UoalJlc3VsdC5pc0VtcHR5KCkpOwogICAgICAgIGFzc2VydEVx\ndWFscyhjUmVzdWx0LnNpemUoKSwgalJlc3VsdC5zaXplKCkpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgalJlc3VsdC5zaXplKCk7IGkrKykgewog\nICAgICAgICAgICBhc3NlcnRFcXVhbHMoalJlc3VsdC5nZXQoaSkuZ2V0RW5k\nRGF0ZSgpLCBjUmVzdWx0LmdldChpKS5nZXRFbmREYXRlKCkpOwogICAgICAg\nIH0KICAgIH0KfQo=\n","encoding":"base64"}

