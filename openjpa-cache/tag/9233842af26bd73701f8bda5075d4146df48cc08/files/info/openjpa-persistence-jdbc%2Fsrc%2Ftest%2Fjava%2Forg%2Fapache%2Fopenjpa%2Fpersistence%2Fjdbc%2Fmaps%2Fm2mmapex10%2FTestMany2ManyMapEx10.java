{"sha":"63641ff1a731cbcf852664d39e052a935b77f864","node_id":"MDQ6QmxvYjIwNjM2NDo2MzY0MWZmMWE3MzFjYmNmODUyNjY0ZDM5ZTA1MmE5MzViNzdmODY0","size":11317,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/63641ff1a731cbcf852664d39e052a935b77f864","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYy5t\nYXBzLm0ybW1hcGV4MTA7CgppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGls\nLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5FbnRpdHlNYW5hZ2VyOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRW50aXR5VHJhbnNhY3Rpb247CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5RdWVyeTsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuQXNzZXJ0\nOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlJbXBs\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLkFyZ3Vt\nZW50RXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLnRlc3QuQWxsb3dGYWlsdXJlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnBlcnNpc3RlbmNlLnRlc3QuU1FMTGlzdGVuZXJUZXN0Q2FzZTsK\nCnB1YmxpYyBjbGFzcyBUZXN0TWFueTJNYW55TWFwRXgxMCBleHRlbmRzIFNR\nTExpc3RlbmVyVGVzdENhc2UgewoKICAgIHB1YmxpYyBpbnQgbnVtRW1wbG95\nZWVzID0gMjsKICAgIHB1YmxpYyBpbnQgbnVtUGhvbmVOdW1iZXJzID0gbnVt\nRW1wbG95ZWVzICsgMTsKICAgIHB1YmxpYyBpbnQgbnVtRW1wbG95ZWVzUGVy\nUGhvbmVOdW1iZXIgPSAyOwogICAgcHVibGljIGludCBudW1QaG9uZU51bWJl\ncnNQZXJFbXBsb3llZSA9IDI7CiAgICBwdWJsaWMgTGlzdDxTdHJpbmc+IG5h\nbWVkUXVlcmllcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgcHVi\nbGljIExpc3Q8RW1wbG95ZWVQSz4gZW1wUEtzID0gbmV3IEFycmF5TGlzdDxF\nbXBsb3llZVBLPigpOwogICAgcHVibGljIExpc3Q8UGhvbmVQSz4gcGhvbmVQ\nS3MgPSBuZXcgQXJyYXlMaXN0PFBob25lUEs+KCk7CgogICAgcHVibGljIE1h\ncDxTdHJpbmcsIEVtcGxveWVlPiBlbXBNYXAgPSAKICAgICAgICBuZXcgSGFz\naE1hcDxTdHJpbmcsIEVtcGxveWVlPigpOwogICAgcHVibGljIE1hcDxQaG9u\nZVBLLCBQaG9uZU51bWJlcj4gcGhvbmVNYXAgPSAKICAgICAgICBuZXcgSGFz\naE1hcDxQaG9uZVBLLCBQaG9uZU51bWJlcj4oKTsKCiAgICBwdWJsaWMgaW50\nIGVtcElkID0gMTsKICAgIHB1YmxpYyBpbnQgcGhvbmVJZCA9IDE7CiAgICBw\ndWJsaWMgaW50IGRpdklkID0gMTsKICAgIHB1YmxpYyBMaXN0IHJzQWxsUGhv\nbmVzID0gbnVsbDsKICAgIHB1YmxpYyBMaXN0IHJzQWxsRW1wcyA9IG51bGw7\nCgogICAgcHVibGljIHZvaWQgc2V0VXAoKSB7CiAgICAgICAgc3VwZXIuc2V0\nVXAoRFJPUF9UQUJMRVMsRW1wbG95ZWVQSy5jbGFzcywgUGhvbmVQSy5jbGFz\ncywKICAgICAgICAgICAgRW1wbG95ZWUuY2xhc3MsIFBob25lTnVtYmVyLmNs\nYXNzKTsKICAgICAgICBjcmVhdGVPYmooKTsKICAgICAgICByc0FsbFBob25l\ncyA9IGdldEFsbChQaG9uZU51bWJlci5jbGFzcyk7CiAgICAgICAgcnNBbGxF\nbXBzID0gZ2V0QWxsKEVtcGxveWVlLmNsYXNzKTsKICAgIH0KICAgIAogICAg\nQEFsbG93RmFpbHVyZQogICAgcHVibGljIHZvaWQgdGVzdFF1ZXJ5SW5NZW1v\ncnlRdWFsaWZpZWRJZCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHF1\nZXJ5UXVhbGlmaWVkSWQodHJ1ZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2\nb2lkIHRlc3RRdWVyeVF1YWxpZmllZElkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgcXVlcnlRdWFsaWZpZWRJZChmYWxzZSk7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyB2b2lkIHNldENhbmRpZGF0ZShRdWVyeSBxLCBDbGFzcyBj\nbHopIAogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIG9yZy5h\ncGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5RdWVyeUltcGwgcTEgPSAKICAg\nICAgICAgICAgKG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5RdWVy\neUltcGwpIHE7CiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5R\ndWVyeSBxMiA9IHExLmdldERlbGVnYXRlKCk7CiAgICAgICAgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5RdWVyeUltcGwgcWkgPSAoUXVlcnlJbXBsKSBx\nMjsKICAgICAgICBpZiAoY2x6ID09IFBob25lTnVtYmVyLmNsYXNzKQogICAg\nICAgICAgICBxaS5zZXRDYW5kaWRhdGVDb2xsZWN0aW9uKHJzQWxsUGhvbmVz\nKTsKICAgICAgICBlbHNlIGlmIChjbHogPT0gRW1wbG95ZWUuY2xhc3MpCiAg\nICAgICAgICAgIHFpLnNldENhbmRpZGF0ZUNvbGxlY3Rpb24ocnNBbGxFbXBz\nKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgcXVlcnlRdWFsaWZpZWRJ\nZChib29sZWFuIGluTWVtb3J5KSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIo\nKTsKICAgICAgICBFbXBsb3llZVBLIGVrZXkgPSBlbXBQS3MuZ2V0KDApOwog\nICAgICAgIFN0cmluZyBxdWVyeSA9ICJzZWxlY3QgS0VZKGUpIGZyb20gUGhv\nbmVOdW1iZXIgcCwgIiArCiAgICAgICAgICAgICIgaW4gKHAuZW1wcykgZSB3\naGVyZSBlLmVtcFBLLm5hbWUgPSA/MSBhbmQgZS5lbXBQSy5iRGF5ID0gPzIi\nOwogICAgICAgIFF1ZXJ5IHEgPSBlbS5jcmVhdGVRdWVyeShxdWVyeSkuc2V0\nUGFyYW1ldGVyKDEsIGVrZXkuZ2V0TmFtZSgpKS4KICAgICAgICAgICAgc2V0\nUGFyYW1ldGVyKDIsIGVrZXkuZ2V0QkRheSgpKTsKICAgICAgICBpZiAoaW5N\nZW1vcnkpIAogICAgICAgICAgICBzZXRDYW5kaWRhdGUocSwgUGhvbmVOdW1i\nZXIuY2xhc3MpOwogICAgICAgIExpc3QgcnMgPSBxLmdldFJlc3VsdExpc3Qo\nKTsKICAgICAgICBFbXBsb3llZVBLIGQgPSAoRW1wbG95ZWVQSykgcnMuZ2V0\nKDApOwoKICAgICAgICBxdWVyeSA9ICJzZWxlY3QgS0VZKGUpIGZyb20gUGhv\nbmVOdW1iZXIgcCwgIiArCiAgICAgICAgICAgICIgaW4gKHAuZW1wcykgZSB3\naGVyZSBlLmVtcFBLID0gPzEiOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJzID0gZW0uY3JlYXRlUXVlcnkocXVlcnkpLnNldFBhcmFtZXRlcigxLCBl\na2V5KS5nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgLy8gYXMgZXhjZXB0ZWQ6IGNvbmRpdGlv\nbmFsIGV4cHJlc3Npb25hbCBleHByZXNzaW9uIG92ZXIgZW1iZWRkYWJsZQog\nICAgICAgICAgICBhc3NlcnRFeGNlcHRpb24oZSwgQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MpOwogICAgICAgIH0gICAgICAgIAogICAgICAgIAogICAgICAg\nIHF1ZXJ5ID0gInNlbGVjdCBLRVkocCkgZnJvbSBFbXBsb3llZSBlLCAiICsK\nICAgICAgICAgICAgIiBpbiAoZS5waG9uZXMpIHAiOwogICAgICAgIHEgPSBl\nbS5jcmVhdGVRdWVyeShxdWVyeSk7CiAgICAgICAgaWYgKGluTWVtb3J5KSAK\nICAgICAgICAgICAgc2V0Q2FuZGlkYXRlKHEsIEVtcGxveWVlLmNsYXNzKTsK\nICAgICAgICBycyA9IHEuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAgIFBob25l\nUEsgayA9IChQaG9uZVBLKSBycy5nZXQoMCk7CgogICAgICAgIGVtLmNsZWFy\nKCk7CiAgICAgICAgcXVlcnkgPSAic2VsZWN0IEVOVFJZKGUpIGZyb20gUGhv\nbmVOdW1iZXIgcCwgIiArCiAgICAgICAgICAgICIgaW4gKHAuZW1wcykgZSAg\nd2hlcmUgZS5lbXBQSy5uYW1lID0gPzEgYW5kIGUuZW1wUEsuYkRheSA9ID8y\nIjsKICAgICAgICBxID0gZW0uY3JlYXRlUXVlcnkocXVlcnkpLnNldFBhcmFt\nZXRlcigxLCBla2V5LmdldE5hbWUoKSkuCiAgICAgICAgICAgIHNldFBhcmFt\nZXRlcigyLCBla2V5LmdldEJEYXkoKSk7CiAgICAgICAgaWYgKGluTWVtb3J5\nKSAKICAgICAgICAgICAgc2V0Q2FuZGlkYXRlKHEsIFBob25lTnVtYmVyLmNs\nYXNzKTsKICAgICAgICBycyA9IHEuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAg\nIE1hcC5FbnRyeSBtZSA9IChNYXAuRW50cnkpIHJzLmdldCgwKTsKCiAgICAg\nICAgYXNzZXJ0VHJ1ZShkLmVxdWFscyhtZS5nZXRLZXkoKSkpOwoKICAgICAg\nICAvLyB0ZXN0IG5hdmlnYXRpb24gdGhydSBLRVkKICAgICAgICBlbS5jbGVh\ncigpOwogICAgICAgIHF1ZXJ5ID0gInNlbGVjdCBLRVkoZSksIEtFWShlKS5u\nYW1lIGZyb20gUGhvbmVOdW1iZXIgcCwgIiArCiAgICAgICAgICAgICIgaW4g\nKHAuZW1wcykgZSI7CiAgICAgICAgcSA9IGVtLmNyZWF0ZVF1ZXJ5KHF1ZXJ5\nKTsKICAgICAgICBpZiAoaW5NZW1vcnkpIAogICAgICAgICAgICBzZXRDYW5k\naWRhdGUocSwgUGhvbmVOdW1iZXIuY2xhc3MpOwogICAgICAgIHJzID0gcS5n\nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgRW1wbG95ZWVQSyBkMCA9IChFbXBs\nb3llZVBLKSAoKE9iamVjdFtdKSBycy5nZXQoMCkpWzBdOwogICAgICAgIFN0\ncmluZyBuYW1lID0gKFN0cmluZykoKE9iamVjdFtdKSBycy5nZXQoMCkpWzFd\nOwogICAgICAgIGFzc2VydEVxdWFscyhkMC5nZXROYW1lKCksIG5hbWUpOwoK\nICAgICAgICBlbS5jbGVhcigpOwogICAgICAgIHF1ZXJ5ID0gInNlbGVjdCBL\nRVkocCksIEtFWShwKS5waG9uZU51bSBmcm9tIEVtcGxveWVlIGUsICIgKwog\nICAgICAgICAgICAiIGluIChlLnBob25lcykgcCI7CiAgICAgICAgcSA9IGVt\nLmNyZWF0ZVF1ZXJ5KHF1ZXJ5KTsKICAgICAgICBpZiAoaW5NZW1vcnkpIAog\nICAgICAgICAgICBzZXRDYW5kaWRhdGUocSwgRW1wbG95ZWUuY2xhc3MpOwog\nICAgICAgIHJzID0gcS5nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgayA9IChQ\naG9uZVBLKSAoKE9iamVjdFtdKSBycy5nZXQoMCkpWzBdOwogICAgICAgIFN0\ncmluZyBwaG9uZU51bSA9IChTdHJpbmcpICgoT2JqZWN0W10pIHJzLmdldCgw\nKSlbMV07CiAgICAgICAgYXNzZXJ0RXF1YWxzKGsuZ2V0UGhvbmVOdW0oKSwg\ncGhvbmVOdW0pOwoKICAgICAgICAvLyB0ZXN0IE9SREVSIEJZIHF1YWxpZmll\nZCBwYXRoCiAgICAgICAgcXVlcnkgPSAic2VsZWN0IEtFWShwKSwgS0VZKHAp\nLnBob25lTnVtIGFzIHBubyBmcm9tIEVtcGxveWVlIGUgIiArCiAgICAgICAg\nICAgICIgbGVmdCBqb2luIGUucGhvbmVzIHAgT1JERVIgQlkgcG5vICI7CiAg\nICAgICAgcSA9IGVtLmNyZWF0ZVF1ZXJ5KHF1ZXJ5KTsKICAgICAgICBpZiAo\naW5NZW1vcnkpIAogICAgICAgICAgICBzZXRDYW5kaWRhdGUocSwgRW1wbG95\nZWUuY2xhc3MpOwogICAgICAgIHJzID0gcS5nZXRSZXN1bHRMaXN0KCk7Cgog\nICAgICAgIC8vIHRlc3QgR1JPVVAgQlkgcXVhbGlmaWVkIHBhdGgKICAgICAg\nICBzcWwuY2xlYXIoKTsKICAgICAgICBxdWVyeSA9ICJzZWxlY3QgQ09VTlQo\nS0VZKHApLnBob25lTnVtKSBmcm9tIEVtcGxveWVlIGUgIiArCiAgICAgICAg\nICAgICIgbGVmdCBqb2luIGUucGhvbmVzIHAgR1JPVVAgQlkgS0VZKHApLnBo\nb25lTnVtIjsKICAgICAgICBxID0gZW0uY3JlYXRlUXVlcnkocXVlcnkpOwog\nICAgICAgIGlmIChpbk1lbW9yeSkgCiAgICAgICAgICAgIHNldENhbmRpZGF0\nZShxLCBFbXBsb3llZS5jbGFzcyk7CiAgICAgICAgcnMgPSBxLmdldFJlc3Vs\ndExpc3QoKTsKICAgICAgICBpZiAoIWluTWVtb3J5KQogICAgICAgIGFzc2Vy\ndFRydWUoc3FsLmdldCgwKS50b1VwcGVyQ2FzZSgpLmluZGV4T2YoIiBHUk9V\nUCBCWSAiKSAhPSAtMSk7CiAgICAgICAgCiAgICAgICAgcXVlcnkgPSAic2Vs\nZWN0IExFTkdUSChLRVkoZSkubmFtZSkgZnJvbSBQaG9uZU51bWJlciBwLCAi\nICsKICAgICAgICAgICAgIiBpbiAocC5lbXBzKSBlIHdoZXJlIEtFWShlKS5i\nRGF5ID0gQ1VSUkVOVF9USU1FU1RBTVAiOwogICAgICAgIHEgPSBlbS5jcmVh\ndGVRdWVyeShxdWVyeSk7CiAgICAgICAgaWYgKGluTWVtb3J5KSAKICAgICAg\nICAgICAgc2V0Q2FuZGlkYXRlKHEsIEVtcGxveWVlLmNsYXNzKTsKICAgICAg\nICBycyA9IHEuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAgIGFzc2VydEVxdWFs\ncyhycy5zaXplKCksIDApOwoKICAgICAgICBlbS5jbG9zZSgpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHRlc3RRdWVyeU9iamVjdCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIHF1ZXJ5T2JqKCk7CiAgICAgICAgZmluZE9iaigp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNyZWF0ZU9iaigpIHsKICAgICAg\nICBFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIo\nKTsKICAgICAgICBFbnRpdHlUcmFuc2FjdGlvbiB0cmFuID0gZW0uZ2V0VHJh\nbnNhY3Rpb24oKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVt\ncGxveWVlczsgaSsrKSB7CiAgICAgICAgICAgIEVtcGxveWVlIGUgPSBjcmVh\ndGVFbXBsb3llZShlbSwgZW1wSWQrKyk7CiAgICAgICAgICAgIGVtcE1hcC5w\ndXQoZS5nZXRFbXBQSygpLmdldE5hbWUoKSwgZSk7CiAgICAgICAgfQogICAg\nICAgIHRyYW4uYmVnaW4oKTsKICAgICAgICBlbS5mbHVzaCgpOwogICAgICAg\nIHRyYW4uY29tbWl0KCk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0KCiAg\nICBwdWJsaWMgRW1wbG95ZWUgY3JlYXRlRW1wbG95ZWUoRW50aXR5TWFuYWdl\nciBlbSwgaW50IGlkKSB7CiAgICAgICAgRW1wbG95ZWUgZSA9IG5ldyBFbXBs\nb3llZSgpOwogICAgICAgIERhdGUgYkRheSA9IG5ldyBEYXRlKFN5c3RlbS5j\ndXJyZW50VGltZU1pbGxpcygpIC0gMTAwMDAwMCk7CiAgICAgICAgRW1wbG95\nZWVQSyBlbXBQSyA9IG5ldyBFbXBsb3llZVBLKCJlIiArIGlkLCBiRGF5KTsK\nICAgICAgICBlbXBQS3MuYWRkKGVtcFBLKTsKICAgICAgICBlLnNldEVtcFBL\nKGVtcFBLKTsKICAgICAgICBlLnNldFNhbGFyeSgxMDAwKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IG51bVBob25lTnVtYmVyc1BlckVtcGxveWVl\nOyBpKyspIHsgCiAgICAgICAgICAgIFBob25lTnVtYmVyIHBob25lTnVtYmVy\nID0gbmV3IFBob25lTnVtYmVyKCk7CiAgICAgICAgICAgIFBob25lUEsgcGhv\nbmVQSyA9IG5ldyBQaG9uZVBLKCJhcmVhQ29kZSIgKyBwaG9uZUlkLCAicGhv\nbmVOdW0iICsKICAgICAgICAgICAgICAgICAgICBwaG9uZUlkKTsKICAgICAg\nICAgICAgcGhvbmVOdW1iZXIuc2V0Um9vbShwaG9uZUlkKTsKICAgICAgICAg\nICAgcGhvbmVJZCsrOwogICAgICAgICAgICBwaG9uZVBLcy5hZGQocGhvbmVQ\nSyk7CiAgICAgICAgICAgIHBob25lTnVtYmVyLnNldFBob25lUEsocGhvbmVQ\nSyk7CiAgICAgICAgICAgIHBob25lTnVtYmVyLmFkZEVtcGxveWVlcyhlbXBQ\nSywgZSk7CiAgICAgICAgICAgIGUuYWRkUGhvbmVOdW1iZXIocGhvbmVQSywg\ncGhvbmVOdW1iZXIpOwogICAgICAgICAgICBlbS5wZXJzaXN0KHBob25lTnVt\nYmVyKTsKICAgICAgICAgICAgcGhvbmVNYXAucHV0KHBob25lTnVtYmVyLmdl\ndFBob25lUEsoKSwgcGhvbmVOdW1iZXIpOwogICAgICAgIH0KICAgICAgICBl\nbS5wZXJzaXN0KGUpOwogICAgICAgIHJldHVybiBlOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGZpbmRPYmooKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIo\nKTsKICAgICAgICBFbXBsb3llZSBlID0gZW0uZmluZChFbXBsb3llZS5jbGFz\ncywgZW1wUEtzLmdldCgxKSk7CiAgICAgICAgYXNzZXJ0RW1wbG95ZWUoZSk7\nCgogICAgICAgIFBob25lTnVtYmVyIHAgPSBlbS5maW5kKFBob25lTnVtYmVy\nLmNsYXNzLCBwaG9uZVBLcy5nZXQoMSkpOwogICAgICAgIGFzc2VydFBob25l\nTnVtYmVyKHApOwogICAgICAgIGVtLmNsb3NlKCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcXVlcnlPYmooKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBxdWVyeUVtcGxveWVlKCk7CiAgICAgICAgcXVlcnlQaG9uZU51bWJlcigp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHF1ZXJ5UGhvbmVOdW1iZXIoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtID0g\nZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBFbnRpdHlUcmFu\nc2FjdGlvbiB0cmFuID0gZW0uZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICB0\ncmFuLmJlZ2luKCk7CiAgICAgICAgUXVlcnkgcSA9IGVtLmNyZWF0ZVF1ZXJ5\nKCJzZWxlY3QgcCBmcm9tIFBob25lTnVtYmVyIHAiKTsKICAgICAgICBMaXN0\nPFBob25lTnVtYmVyPiBwcyA9IHEuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAg\nIGZvciAoUGhvbmVOdW1iZXIgcCA6IHBzKSB7CiAgICAgICAgICAgIGFzc2Vy\ndFBob25lTnVtYmVyKHApOwogICAgICAgIH0KICAgICAgICB0cmFuLmNvbW1p\ndCgpOwogICAgICAgIGVtLmNsb3NlKCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgcXVlcnlFbXBsb3llZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIEVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOwogICAgICAgIEVudGl0eVRyYW5zYWN0aW9uIHRyYW4gPSBlbS5nZXRUcmFu\nc2FjdGlvbigpOwogICAgICAgIHRyYW4uYmVnaW4oKTsKICAgICAgICBRdWVy\neSBxID0gZW0uY3JlYXRlUXVlcnkoInNlbGVjdCBlIGZyb20gRW1wbG95ZWUg\nZSIpOwogICAgICAgIExpc3Q8RW1wbG95ZWU+IGVzID0gcS5nZXRSZXN1bHRM\naXN0KCk7CiAgICAgICAgZm9yIChFbXBsb3llZSBlIDogZXMpIHsKICAgICAg\nICAgICAgYXNzZXJ0RW1wbG95ZWUoZSk7CiAgICAgICAgfQogICAgICAgIHRy\nYW4uY29tbWl0KCk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBhc3NlcnRFbXBsb3llZShFbXBsb3llZSBlKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBFbXBsb3llZVBLIGVtcFBLID0gZS5nZXRF\nbXBQSygpOwogICAgICAgIEVtcGxveWVlIGUwID0gZW1wTWFwLmdldChlbXBQ\nSy5nZXROYW1lKCkpOwogICAgICAgIE1hcDxQaG9uZVBLLCBQaG9uZU51bWJl\ncj4gcGhvbmVzID0gZS5nZXRQaG9uZU51bWJlcnMoKTsKICAgICAgICBNYXA8\nUGhvbmVQSywgUGhvbmVOdW1iZXI+IHBob25lczAgPSBlMC5nZXRQaG9uZU51\nbWJlcnMoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKHBob25lczAu\nc2l6ZSgpLCBwaG9uZXMuc2l6ZSgpKTsKICAgICAgICBjaGVja1Bob25lTWFw\nKHBob25lczAsIHBob25lcyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXNz\nZXJ0UGhvbmVOdW1iZXIoUGhvbmVOdW1iZXIgcCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgUGhvbmVQSyBwaG9uZVBLID0gcC5nZXRQaG9uZVBLKCk7\nCiAgICAgICAgUGhvbmVOdW1iZXIgcDAgPSBwaG9uZU1hcC5nZXQocGhvbmVQ\nSyk7CgogICAgICAgIE1hcDxFbXBsb3llZVBLLCBFbXBsb3llZT4gZXMgPSBw\nLmdldEVtcGxveWVlcygpOwogICAgICAgIE1hcDxFbXBsb3llZVBLLCBFbXBs\nb3llZT4gZXMwID0gcDAuZ2V0RW1wbG95ZWVzKCk7CiAgICAgICAgQXNzZXJ0\nLmFzc2VydEVxdWFscyhlczAuc2l6ZSgpLCBlcy5zaXplKCkpOwogICAgICAg\nIGNoZWNrRW1wTWFwKGVzMCwgZXMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGNoZWNrUGhvbmVNYXAoTWFwPFBob25lUEssIFBob25lTnVtYmVyPiBlczAs\nIAogICAgICAgIE1hcDxQaG9uZVBLLCBQaG9uZU51bWJlcj4gZXMpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIENvbGxlY3Rpb248TWFwLkVudHJ5PFBo\nb25lUEssIFBob25lTnVtYmVyPj4gZW50cnlTZXRzMCA9IGVzMC5lbnRyeVNl\ndCgpOwogICAgICAgIGZvciAoTWFwLkVudHJ5PFBob25lUEssIFBob25lTnVt\nYmVyPiBlbnRyeTAgOiBlbnRyeVNldHMwKSB7CiAgICAgICAgICAgIFBob25l\nUEsgZDAgPSBlbnRyeTAuZ2V0S2V5KCk7CiAgICAgICAgICAgIFBob25lTnVt\nYmVyIHAwID0gZW50cnkwLmdldFZhbHVlKCk7CiAgICAgICAgICAgIFBob25l\nTnVtYmVyIHAgPSBlcy5nZXQoZDApOwogICAgICAgICAgICBpZiAoIXAwLmVx\ndWFscyhwKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24o\nIkFzc2VydGlvbiBmYWlsdXJlIik7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGNoZWNrRW1wTWFwKE1hcDxFbXBsb3llZVBLLCBFbXBsb3ll\nZT4gZXMwLAogICAgICAgIE1hcDxFbXBsb3llZVBLLCBFbXBsb3llZT4gZXMp\nCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sbGVjdGlv\nbjxNYXAuRW50cnk8RW1wbG95ZWVQSywgRW1wbG95ZWU+PiBlbnRyeVNldHMw\nID0gZXMwLmVudHJ5U2V0KCk7CiAgICAgICAgZm9yIChNYXAuRW50cnk8RW1w\nbG95ZWVQSywgRW1wbG95ZWU+IGVudHJ5MCA6IGVudHJ5U2V0czApIHsKICAg\nICAgICAgICAgRW1wbG95ZWVQSyBrZXkwID0gZW50cnkwLmdldEtleSgpOwog\nICAgICAgICAgICBFbXBsb3llZSBlMCA9IGVudHJ5MC5nZXRWYWx1ZSgpOwog\nICAgICAgICAgICAvL0VtcGxveWVlIGUgPSBlcy5nZXQoa2V5MCk7CiAgICAg\nICAgICAgIEVtcGxveWVlIGUgPSBFbXBsb3llZS5maW5kRW1wbChlcywga2V5\nMCk7CiAgICAgICAgICAgIGlmICghZTAuZXF1YWxzKGUpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiQXNzZXJ0aW9uIGZhaWx1cmUi\nKTsKICAgICAgICB9CiAgICB9IAp9Cg==\n","encoding":"base64"}

