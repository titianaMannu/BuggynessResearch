{"sha":"9ecf476c6a2c7b3d7b72316bc3c6dded9866e698","node_id":"MDQ6QmxvYjIwNjM2NDo5ZWNmNDc2YzZhMmM3YjNkN2I3MjMxNmJjM2M2ZGRlZDk4NjZlNjk4","size":50347,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9ecf476c6a2c7b3d7b72316bc3c6dded9866e698","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZSBvciBtb3JlCiAqIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UgZmlsZSBkaXN0cmli\ndXRlZCB3aXRoIHRoaXMKICogd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1h\ndGlvbiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gVGhlIEFTRgog\nKiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdp\ndGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0\naGUgTGljZW5zZSBhdAogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5z\nZXMvTElDRU5TRS0yLjAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUg\nbGF3CiAqIG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0\ncmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcwogKiBkaXN0cmlidXRlZCBv\nbiBhbiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09O\nRElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1w\nbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3Vh\nZ2UKICogZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1\nbmRlciB0aGUgTGljZW5zZS4KICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLnF1ZXJ5OwoKaW1wb3J0IGphdmEuc3FsLkNvbm5l\nY3Rpb247CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBq\nYXZhLnNxbC5TdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnRleHQuTnVtYmVyRm9y\nbWF0OwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRW50aXR5TWFuYWdlcjsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlF1ZXJ5OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQjJEaWN0aW9uYXJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EZXJieURpY3Rpb25h\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSW5mb3Jt\naXhEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLk9yYWNsZURpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU1FMU2VydmVyRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuQnJva2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLkpQQUZhY2FkZUhlbHBlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5PcGVuSlBBRW50aXR5TWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5PcGVu\nSlBBRW50aXR5TWFuYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEucGVyc2lzdGVuY2UuT3BlbkpQQVBlcnNpc3RlbmNlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFRdWVyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5QZXJzaXN0\nZW5jZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJz\naXN0ZW5jZS5RdWVyeVRpbWVvdXRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UucXVlcnkuY29tbW9uLmFwcHMuUVRp\nbWVvdXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2Uu\ndGVzdC5TUUxMaXN0ZW5lclRlc3RDYXNlOwoKLyoqCiAqIFRlc3RzIHRoZSBu\nZXcgcXVlcnkgdGltZW91dCBoaW50IHN1cHBvcnQgaW4gdGhlIEpQQSAyLjAg\nc3BlYy4KICogUXVlcnkgdGltZW91dCBzY2VuYXJpb3MgYmVpbmcgdGVzdGVk\nOgogKiAgIDEpIEJ5IGRlZmF1bHQsIHRoZXJlIGlzIG5vIHRpbWVvdXQKICog\nICAyKSBTZXR0aW5nIHRpbWVvdXQgdG8gMCBpcyBzYW1lIGFzIG5vIHRpbWVv\ndXQgKEpEQkMgZGVmaW5lZCkKICogICAgIDIuMSkgdXNpbmcgTWFwIHByb3Bl\ncnRpZXMgb24gY3JlYXRlRU1GIChvciBQVSBwcm9wZXJ0aWVzKQogKiAgICAg\nMi4yKSB1c2luZyB0aGUgUXVlcnlIaW50IGFubm90YXRpb24KICogICAgIDIu\nMykgdXNpbmcgc2V0SGludCgpCiAqICAgMykgU2V0dGluZyB0aW1lb3V0IHRv\nIG1zZWNzIDwgREVMQVkgdmFsdWUgY2F1c2VzIG5ldyAKICogICAgICBqYXZh\neC5wZXJzaXN0ZW5jZS5RdWVyeVRpbWVvdXRFeGNlcHRpb24gZm9yIGRhdGFi\nYXNlcyB0aGF0IGRvIG5vdAogKiAgICAgIGNhdXNlIGEgcm9sbGJhY2sgb3Ig\nYSBQZXJzaXN0ZW5jZUV4Y2VwdGlvbiBpZiB0aGV5IGRvLCB3aGVuIHNldCBi\neToKICogICAgIDMuMSkgdXNpbmcgcGVyc2lzdGVuY2UueG1sIFBVIHByb3Bl\ncnRpZXMgKG9yIGNyZWF0ZUVNRiBNYXAgcHJvcGVydGllcykKICogICAgIDMu\nMikgdXNpbmcgdGhlIFF1ZXJ5SGludCBhbm5vdGF0aW9uCiAqICAgICAzLjMp\nIGNhbGxpbmcgc2V0SGludCgpCiAqIFF1ZXJ5IG9wZXJhdGlvbnMgdG8gdmFs\naWRhdGUgdGhyb3VnaCBjcm9zcyBjb3ZlcmFnZSBvZiBpdGVtcyAjMS0jMzoK\nICogICBhKSBnZXRSZXN1bHRMaXN0KCkKICogICBiKSBnZXRTaW5nbGVSZXN1\nbHQoKQogKiAgIGMpIGV4ZWN1dGVVcGRhdGUoKSAtIFJlcXVpcmVzIHRoZSBk\nYiBVUERBVEUgdHJpZ2dlcgogKiBPdGhlciBiZWhhdmlvcnMgdG8gdGVzdCBm\nb3I6CiAqICAgNCkgU2V0dGluZyB0aW1lb3V0IHRvIC0xIHNob3VsZCBiZSB0\ncmVhdGVkIGFzIG5vIHRpbWVvdXQgc3VwcGxpZWQKICogICA1KSBTZXR0aW5n\nIHRpbWVvdXQgdG8gPCAtMSBzaG91bGQgdGhyb3cgYW4gSWxsZWdhbEFyZ3Vt\nZW50RXhwZWN0aW9uCiAqICAgNikgVXBkYXRlcyBhZnRlciBFTS5maW5kKCkv\nZmluZEFsbCgpIGFyZSBub3QgYWZmZWN0ZWQgYnkgcXVlcnkgdGltZW91dAog\nKiBFeGNlcHRpb24gZ2VuZXJhdGlvbiB0byB0ZXN0LCBjb3ZlcmVkIGJ5IDMx\nYyBhbmQgMzNjOgogKiAgIElmIHRoZSBEQiBxdWVyeSB0aW1lb3V0IGRvZXMg\nbm90IGNhdXNlIGEgdHJhbnNhY3Rpb24gcm9sbGJhY2ssIHRoZW4gYSAKICog\nICAgICBRdWVyeVRpbWVvdXRFeGNlcHRpb24gc2hvdWxkIGJlIHRocm93bi4K\nICogICBFbHNlIGlmIHRoZSBEQiBxdWVyeSB0aW1lb3V0IGNhdXNlcyBhIHRy\nYW5zYWN0aW9uIHJvbGxiYWNrLCB0aGVuIGEgCiAqICAgICAgUGVyc2lzdGVu\nY2VFeGNlcHRpb24gc2hvdWxkIGJlIHRocm93biBpbnN0ZWFkIG9mIGEgUVRF\nLgogKiAKICogQHZlcnNpb24gJFJldiQgJERhdGUkCiAqLwpwdWJsaWMgY2xh\nc3MgVGVzdFF1ZXJ5VGltZW91dCBleHRlbmRzIFNRTExpc3RlbmVyVGVzdENh\nc2UgewoKICAgIHByaXZhdGUgREJEaWN0aW9uYXJ5IGRpY3QgPSBudWxsOwog\nICAgLy8gc2tpcCB0ZXN0IGR1ZSB0byB1bnN1cHBvcnRlZC91bnRlc3RlZCBk\nYgogICAgcHJpdmF0ZSBib29sZWFuIHNraXBUZXN0cyA9IGZhbHNlOwogICAg\nLy8gc2tpcCBzb21lIHRlc3RzIGR1ZSB0byBubyBEQiB0cmlnZ2VycyB0byBj\nYXVzZSBkZWxheSB0aW1lb3V0IGV4Y2VwdGlvbnMKICAgIHByaXZhdGUgYm9v\nbGVhbiBza2lwRXhjZXB0aW9uVGVzdHMgPSBmYWxzZTsKICAgIC8vIHNraXAg\nc29tZSB0ZXN0cyBkdWUgdG8gbm8gU0VMRUNUIHF1ZXJ5IHRpbWVvdXRzIGJl\naW5nIGdlbmVyYXRlZCBieSB0aGUgREIKICAgIHByaXZhdGUgYm9vbGVhbiBu\nb1NlbGVjdFRpbWVvdXRzID0gZmFsc2U7CiAgICAvLyBkZWZhdWx0IG5hdGl2\nZSBxdWVyeSBzdHJpbmcgdG8gdXNlIGZvciB1cGRhdGUgdGVzdGluZyAKICAg\nIHByaXZhdGUgU3RyaW5nIG5hdGl2ZVVwZGF0ZVN0ciA9IG5ldyBTdHJpbmco\nIlVQREFURSBRVGltZW91dCBTRVQgIiArCiAgICAgICAgInN0cmluZ0ZpZWxk\nID0gPyBXSEVSRSBtb2QoREVMQVkoMixpZCksMik9MCIpOwogICAgCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgewogICAgICAgIHN1\ncGVyLnNldFVwKENMRUFSX1RBQkxFUywgUVRpbWVvdXQuY2xhc3MpOwogICAg\nICAgIGdldExvZygpLnRyYWNlKCJzZXRVcCgpIik7CiAgICAgICAgZGljdCA9\nICgoSkRCQ0NvbmZpZ3VyYXRpb24pIGVtZi5nZXRDb25maWd1cmF0aW9uKCkp\nCiAgICAgICAgICAgIC5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAg\nICAgIGFzc2VydE5vdE51bGwoZGljdCk7CiAgICAgICAgLy8gZGV0ZXJtaW5l\nIGlmIHdlIHNob3VsZCBydW4gb3VyIHRlc3RzIG9uIHRoaXMgREIgcGxhdGZv\ncm0gYW5kIHdoYXQgCiAgICAgICAgLy8gZXhjZXB0aW9uIHR5cGUgdG8gY2F0\nY2gKICAgICAgICBpZiAoZGljdC5zdXBwb3J0c1F1ZXJ5VGltZW91dCkgewog\nICAgICAgICAgICBpZiAoZGljdCBpbnN0YW5jZW9mIERlcmJ5RGljdGlvbmFy\neSkgewogICAgICAgICAgICAgICAgLy8gY3JlYXRlIHNvbWUgaW5pdGlhbCBl\nbnRpdGllcwogICAgICAgICAgICAgICAgc2V0dXBDcmVhdGVFbnRpdGllcygp\nOwogICAgICAgICAgICAgICAgLy8gY3JlYXRlIGRlbGF5IGZ1bmN0aW9uIG9u\nbHkgb24gRGVyYnksIG90aGVyIERCcyBtYW51YWwgc2V0dXAKICAgICAgICAg\nICAgICAgIHNldHVwQ3JlYXRlREJGdW5jdGlvbigpOwogICAgICAgICAgICAg\nICAgLy8gY3JlYXRlIHRyaWdnZXJzIG9uIGFsbCBEQnMKICAgICAgICAgICAg\nICAgIC8vIElmIHRoaXMgZmFpbHMsIHNraXAgcnVubmluZyB0aGUgdGltZW91\ndCB0ZXN0cyBvbiB0aGlzIERCCiAgICAgICAgICAgICAgICBza2lwRXhjZXB0\naW9uVGVzdHMgPSAhc2V0dXBDcmVhdGVEQlRyaWdnZXJzKCk7CiAgICAgICAg\nICAgIH0gZWxzZSBpZiAoZGljdCBpbnN0YW5jZW9mIERCMkRpY3Rpb25hcnkp\nIHsKICAgICAgICAgICAgICAgIHNldHVwQ3JlYXRlRW50aXRpZXMoKTsKICAg\nICAgICAgICAgICAgIC8vIGJhc2ljIHRpbWVvdXQgdGVzdHMgZmFpbCB0byBw\nb3Agdy9vIG11bHRpcGxlIGNvbm5lY3Rpb25zCiAgICAgICAgICAgICAgICBz\na2lwVGVzdHMgPSB0cnVlOwogICAgICAgICAgICAgICAgc2tpcEV4Y2VwdGlv\nblRlc3RzID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICgoZGljdCBp\nbnN0YW5jZW9mIFNRTFNlcnZlckRpY3Rpb25hcnkpIHx8CiAgICAgICAgICAg\nICAgICAoZGljdCBpbnN0YW5jZW9mIE9yYWNsZURpY3Rpb25hcnkpKSB7CiAg\nICAgICAgICAgICAgICAvLyBjcmVhdGUgc29tZSBpbml0aWFsIGVudGl0aWVz\nCiAgICAgICAgICAgICAgICBzZXR1cENyZWF0ZUVudGl0aWVzKCk7CiAgICAg\nICAgICAgICAgICAvLyBza2lwIHJ1bm5pbmcgdGhlIFNFTEVDVCB0aW1lb3V0\nIHRlc3RzIGR1ZSB0bzoKICAgICAgICAgICAgICAgIC8vIEMjIERlbGF5LmRs\nbCBjb2RlIG9uIFNRTFNlcnZlcgogICAgICAgICAgICAgICAgLy8gRW1iZWRk\nZWQgSmF2YSBjb2RlIG9uIE9yYWNsZQogICAgICAgICAgICAgICAgc2tpcFRl\nc3RzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG5vU2VsZWN0VGltZW91dHMg\nPSB0cnVlOwogICAgICAgICAgICAgICAgLy8gY3JlYXRlIHRyaWdnZXJzIG9u\nIGFsbCBEQnMKICAgICAgICAgICAgICAgIHNraXBFeGNlcHRpb25UZXN0cyA9\nICFzZXR1cENyZWF0ZURCVHJpZ2dlcnMoKTsKICAgICAgICAgICAgICAgIC8v\nIHNwZWNpYWwgY2FzZSBmb3IgTVMgU1FMIFNlcnZlciBhbmQgT3JhY2xlLCBh\ncyBvdXIKICAgICAgICAgICAgICAgIC8vIEZ1bmN0aW9uIGNvZGUgZG9lc24n\ndCBzdXBwb3J0IHJldHVybmluZyB0aGUgaWQgZm9yIG5vdwogICAgICAgICAg\nICAgICAgbmF0aXZlVXBkYXRlU3RyID0gIlVQREFURSBRVGltZW91dCBTRVQg\nc3RyaW5nRmllbGQgPSA/ICIgKwogICAgICAgICAgICAgICAgICAgICJXSEVS\nRSBpZCA9IDEiOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRpY3QgaW5zdGFu\nY2VvZiBJbmZvcm1peERpY3Rpb25hcnkpIHsKICAgICAgICAgICAgICAgIC8v\nIGNyZWF0ZSBzb21lIGluaXRpYWwgZW50aXRpZXMKICAgICAgICAgICAgICAg\nIHNldHVwQ3JlYXRlRW50aXRpZXMoKTsKICAgICAgICAgICAgICAgIC8vIGNy\nZWF0ZSB0cmlnZ2VycyBvbiBhbGwgREJzCiAgICAgICAgICAgICAgICBza2lw\nRXhjZXB0aW9uVGVzdHMgPSAhc2V0dXBDcmVhdGVEQlRyaWdnZXJzKCk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB1bmtub3du\nIGRiLCBzbyBza2lwIGFsbCB0aW1lb3V0IHRlc3RzCiAgICAgICAgICAgICAg\nICBza2lwVGVzdHMgPSBza2lwRXhjZXB0aW9uVGVzdHMgPSBub1NlbGVjdFRp\nbWVvdXRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHNldFRlc3RzRGlzYWJs\nZWQodHJ1ZSk7CiAgICAgICAgICAgICAgICBnZXRMb2coKS5pbmZvKCJUZXN0\nUXVlcnlUaW1lb3V0IHRlc3RzIGFyZSBiZWluZyBza2lwcGVkLCBkdWUgIiAr\nCiAgICAgICAgICAgICAgICAgICAgInRvICIgKyBkaWN0LnBsYXRmb3JtICsg\nIiBub3Qgc3VwcG9ydGluZyBRdWVyeSBUaW1lb3V0cy4iKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdldExvZygpLmlu\nZm8oIlRlc3RRdWVyeVRpbWVvdXQgdGVzdHMgYXJlIGJlaW5nIHNraXBwZWQs\nICIgKwogICAgICAgICAgICAgICAgImR1ZSB0byAiICsgZGljdC5wbGF0Zm9y\nbSArICIgbm90IHN1cHBvcnRpbmcgUXVlcnkgVGltZW91dHMuIik7CiAgICAg\nICAgICAgIHNraXBUZXN0cyA9IHNraXBFeGNlcHRpb25UZXN0cyA9IHRydWU7\nCiAgICAgICAgICAgIHNldFRlc3RzRGlzYWJsZWQodHJ1ZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVk\nOiAxYSkgQnkgZGVmYXVsdCwgdGhlcmUgaXMgbm8gdGltZW91dCBmb3IgcXVl\ncmllcy4KICAgICAqIEV4cGVjdGVkIFJlc3VsdHM6IFRoZSBERUxBWSBmdW5j\ndGlvbiBpcyBiZWluZyBjYWxsZWQgYW5kIHRoZSBxdWVyeSB0YWtlcwogICAg\nICogNjAwMCsgbXNlY3MgdG8gY29tcGxldGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHRlc3RRdWVyeVRpbWVvdXQxYSgpIHsKICAgICAgICBpZiAoc2tp\ncFRlc3RzKSB7CiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVl\ncnlUaW1lb3V0MWEgLSB0ZXN0IGlzICIgKwogICAgICAgICAgICAgICAgImJl\naW5nIHNraXBwZWQgZm9yICIgKyBkaWN0LnBsYXRmb3JtKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBnZXRMb2coKS50cmFjZSgi\ndGVzdFF1ZXJ5VGltZW91dDFhKCkgLSBObyBRdWVyeSB0aW1lb3V0Iik7CiAg\nICAgICAgRW50aXR5TWFuYWdlciBlbSA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwog\nICAgICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICAgICAgUXVl\ncnkgcSA9IGVtLmNyZWF0ZU5hbWVkUXVlcnkoIk5vSGludExpc3QiKTsKICAg\nICAgICAgICAgLy8gdmVyaWZ5IG5vIGRlZmF1bHQgamF2YXgucGVyc2lzdGVu\nY2UucXVlcnkudGltZW91dCBpcyBzdXBwbGllZAogICAgICAgICAgICBNYXA8\nU3RyaW5nLCBPYmplY3Q+IGhpbnRzID0gcS5nZXRIaW50cygpOwogICAgICAg\nICAgICBhc3NlcnRGYWxzZShoaW50cy5jb250YWluc0tleSgiamF2YXgucGVy\nc2lzdGVuY2UucXVlcnkudGltZW91dCIpKTsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGxvbmcgc3RhcnRUaW1lID0gU3lzdGVtLmN1cnJl\nbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBAU3VwcHJlc3NXYXJu\naW5ncygidW5jaGVja2VkIikKICAgICAgICAgICAgICAgIExpc3QgcmVzdWx0\ncyA9IHEuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAgICAgICAgICAgbG9uZyBl\nbmRUaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAg\nICAgICAgICBsb25nIHJ1blRpbWUgPSBlbmRUaW1lIC0gc3RhcnRUaW1lOwog\nICAgICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVyeVRpbWVv\ndXQxYSgpIC0gTm9IaW50TGlzdCBydW5UaW1lIiArIAogICAgICAgICAgICAg\nICAgICAgICIgbXNlY3M9IiArIHJ1blRpbWUpOwogICAgICAgICAgICAgICAg\nLy8gSGFjayAtIFdpbmRvd3Mgc29tZXRpbWVzIHJldHVybnMgNTk5OSBpbnN0\nZWFkIG9mIDYwMDArCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJTaG91\nbGQgaGF2ZSB0YWtlbiA2KyBzZWNzLCBidXQgd2FzIG1zZWNzPSIgKwogICAg\nICAgICAgICAgICAgICAgIHJ1blRpbWUsIHJ1blRpbWUgPiA1OTAwKTsKICAg\nICAgICAgICAgICAgIGFzc2VydEVxdWFscygiVmVyaWZ5IHdlIGZvdW5kIDIg\ncmVzdWx0cy4iLCAyLCByZXN1bHRzLnNpemUoKSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBmYWlsKCJV\nbmV4cGVjdGVkIHRlc3RRdWVyeVRpbWVvdXQxYSgpIGV4Y2VwdGlvbiA9ICIg\nKyBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAg\nICAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTY2VuYXJpbyBiZWluZyB0ZXN0\nZWQ6IDFjKSBCeSBkZWZhdWx0LCB0aGVyZSBpcyBubyB0aW1lb3V0IGZvciB1\ncGRhdGVzLgogICAgICogRXhwZWN0ZWQgUmVzdWx0czogVGhlIERFTEFZIGZ1\nbmN0aW9uIGlzIGJlaW5nIGNhbGxlZCBhbmQgdGhlIHF1ZXJ5IHRha2VzCiAg\nICAgKiAyMDAwKyBtc2VjcyB0byBjb21wbGV0ZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgdGVzdFF1ZXJ5VGltZW91dDFjKCkgewogICAgICAgIGlmIChz\na2lwVGVzdHMpIHsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RR\ndWVyeVRpbWVvdXQxYyAtIHRlc3QgaXMgIiArCiAgICAgICAgICAgICAgICAi\nYmVpbmcgc2tpcHBlZCBmb3IgIiArIGRpY3QucGxhdGZvcm0pOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGdldExvZygpLnRyYWNl\nKCJ0ZXN0UXVlcnlUaW1lb3V0MWMoKSAtIE5vIGV4ZWN1dGVVcGRhdGUgdGlt\nZW91dCIpOwogICAgICAgIEVudGl0eU1hbmFnZXIgZW0gPSBudWxsOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1h\nbmFnZXIoKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAg\nICAgICAgIFF1ZXJ5IHEgPSBlbS5jcmVhdGVRdWVyeSgiVVBEQVRFIFFUaW1l\nb3V0IHEgU0VUIHEuc3RyaW5nRmllbGQgPSAiICsKICAgICAgICAgICAgICAg\nICI6c3RyVmFsIFdIRVJFIHEuaWQgPSAxIik7CiAgICAgICAgICAgIHEuc2V0\nUGFyYW1ldGVyKCJzdHJWYWwiLCBuZXcgU3RyaW5nKCJ1cGRhdGVkIikpOwog\nICAgICAgICAgICAvLyB2ZXJpZnkgbm8gZGVmYXVsdCBqYXZheC5wZXJzaXN0\nZW5jZS5xdWVyeS50aW1lb3V0IGlzIHN1cHBsaWVkCiAgICAgICAgICAgIE1h\ncDxTdHJpbmcsIE9iamVjdD4gaGludHMgPSBxLmdldEhpbnRzKCk7CiAgICAg\nICAgICAgIGFzc2VydEZhbHNlKGhpbnRzLmNvbnRhaW5zS2V5KCJqYXZheC5w\nZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0IikpOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgbG9uZyBzdGFydFRpbWUgPSBTeXN0ZW0uY3Vy\ncmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIGVtLmdldFRyYW5z\nYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgICAgIGludCBjb3VudCA9\nIHEuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAgICAgICAgZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICAgICAgICAgIGxvbmcgZW5k\nVGltZSA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAg\nICAgICAgbG9uZyBydW5UaW1lID0gZW5kVGltZSAtIHN0YXJ0VGltZTsKICAg\nICAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1lb3V0\nMWMoKSAtIGV4ZWN1dGVVcGRhdGUgcnVuVGltZSAiICsKICAgICAgICAgICAg\nICAgICAgICAibXNlY3M9IiArIHJ1blRpbWUpOwogICAgICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZSgiVmVyaWZ5IHdlIHJlY2VpdmVkIG9uZSByZXN1bHQuIiwg\nKGNvdW50ID09IDEpKTsKICAgICAgICAgICAgICAgIC8vIEhhY2sgLSBXaW5k\nb3dzIHNvbWV0aW1lcyByZXR1cm5zIDE5OTkgaW5zdGVhZCBvZiAyMDAwKwog\nICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiU2hvdWxkIGhhdmUgdGFrZW4g\nMisgc2VjcywgYnV0IHdhcyBtc2Vjcz0iICsKICAgICAgICAgICAgICAgICAg\nICBydW5UaW1lLCBydW5UaW1lID4gMTkwMCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBmYWlsKCJVbmV4\ncGVjdGVkIHRlc3RRdWVyeVRpbWVvdXQxYygpIGV4Y2VwdGlvbiA9ICIgKyBl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAg\nICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTY2VuYXJpbyBiZWluZyB0ZXN0ZWQ6\nIDIuMS5iKSBFeHBsaWNpdCBNYXAgb2YgcHJvcGVydGllcyB0byBjcmVhdGVF\nTUYKICAgICAqIHdpdGggdGltZW91dD0wIGlzIHRyZWF0ZWQgdGhlIHNhbWUg\nYXMgdGhlIGRlZmF1bHQgbm8gcXVlcnkgdGltZW91dC4KICAgICAqIEV4cGVj\ndGVkIFJlc3VsdHM6IFRoZSBERUxBWSBmdW5jdGlvbiBpcyBiZWluZyBjYWxs\nZWQgYW5kIHRoZSBxdWVyeQogICAgICogdGFrZXMgMjAwMCsgbXNlY3MgdG8g\nY29tcGxldGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RRdWVyeVRp\nbWVvdXQyMWIoKSB7CiAgICAgICAgaWYgKHNraXBUZXN0cykgewogICAgICAg\nICAgICBnZXRMb2coKS50cmFjZSgidGVzdFF1ZXJ5VGltZW91dDIxYiAtIHRl\nc3QgaXMgIiArCiAgICAgICAgICAgICAgICAiYmVpbmcgc2tpcHBlZCBmb3Ig\nIiArIGRpY3QucGxhdGZvcm0pOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQogICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1lb3V0\nMjFiKCkgLSBNYXAodGltZW91dD0wKSIpOwogICAgICAgIE9wZW5KUEFFbnRp\ndHlNYW5hZ2VyRmFjdG9yeSBlbWYgPSBudWxsOwogICAgICAgIE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsKICAgICAgICBJbnRlZ2VyIHNldFRp\nbWUgPSBuZXcgSW50ZWdlcigwKTsKICAgICAgICAvLyBjcmVhdGUgdGhlIE1h\ncCB0byB0ZXN0IG92ZXJyaWRlcwogICAgICAgIE1hcDxTdHJpbmcsU3RyaW5n\nID5wcm9wcyA9IG5ldyBIYXNoTWFwPFN0cmluZyxTdHJpbmc+KCk7CiAgICAg\nICAgcHJvcHMucHV0KCJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0\nIiwgIjAiKTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyBjcmVhdGUgb3VyIEVNRiB3aXRoIG91ciB0aW1lb3V0IHByb3BlcnR5CiAg\nICAgICAgICAgIGVtZiA9IE9wZW5KUEFQZXJzaXN0ZW5jZS5jcmVhdGVFbnRp\ndHlNYW5hZ2VyRmFjdG9yeSgKICAgICAgICAgICAgICAgICJxdGltZW91dC1u\nby1wcm9wZXJ0aWVzIiwgInBlcnNpc3RlbmNlMy54bWwiLCBwcm9wcyk7CiAg\nICAgICAgICAgIGFzc2VydE5vdE51bGwoZW1mKTsKICAgICAgICAgICAgLy8g\ndmVyaWZ5IE1hcCBwcm9wZXJ0aWVzIHVwZGF0ZWQgdGhlIGNvbmZpZwogICAg\nICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0gZW1mLmdldENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChjb25m\nKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJNYXAgcHJvdmlkZWQgcXVl\ncnkgdGltZW91dCIsIHNldFRpbWUuaW50VmFsdWUoKSwKICAgICAgICAgICAg\nICAgIGNvbmYuZ2V0UXVlcnlUaW1lb3V0KCkpOwogICAgICAgICAgICAvLyB2\nZXJpZnkgbm8gZGVmYXVsdCBqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1l\nb3V0IGlzIHN1cHBsaWVkCiAgICAgICAgICAgIC8vIGFzIHRoZSBNYXAgcHJv\ncGVydGllcyBhcmUgbm90IHBhc3NlZCB0aHJvdWdoIGFzIGhpbnRzCiAgICAg\nICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAgICAgICAgIE9wZW5KUEFR\ndWVyeSBxID0gZW0uY3JlYXRlTmFtZWRRdWVyeSgiTm9IaW50U2luZ2xlIik7\nCiAgICAgICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gaGludHMgPSBxLmdl\ndEhpbnRzKCk7CiAgICAgICAgICAgIGFzc2VydEZhbHNlKGhpbnRzLmNvbnRh\naW5zS2V5KCJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0IikpOwog\nICAgICAgICAgICAvLyB2ZXJpZnkgaW50ZXJuYWwgY29uZmlnIHZhbHVlcyB3\nZXJlIHVwZGF0ZWQKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJNYXAgcHJv\ndmlkZWQgcXVlcnkgdGltZW91dCIsIHNldFRpbWUuaW50VmFsdWUoKSwKICAg\nICAgICAgICAgICAgIHEuZ2V0RmV0Y2hQbGFuKCkuZ2V0UXVlcnlUaW1lb3V0\nKCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGxvbmcgc3RhcnRUaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCk7CiAgICAgICAgICAgICAgICBPYmplY3QgcmVzdWx0ID0gcS5nZXRT\naW5nbGVSZXN1bHQoKTsKICAgICAgICAgICAgICAgIGxvbmcgZW5kVGltZSA9\nIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAg\nbG9uZyBydW5UaW1lID0gZW5kVGltZSAtIHN0YXJ0VGltZTsKICAgICAgICAg\nICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1lb3V0MjFiKCkg\nLSBOb0hpbnRTaW5nbGUgcnVuVGltZSAiICsKICAgICAgICAgICAgICAgICAg\nICAibXNlY3M9IiArIHJ1blRpbWUpOwogICAgICAgICAgICAgICAgLy8gSGFj\nayAtIFdpbmRvd3Mgc29tZXRpbWVzIHJldHVybnMgMTk5OSBpbnN0ZWFkIG9m\nIDIwMDArCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgaGF2\nZSB0YWtlbiAyKyBzZWNzLCBidXQgd2FzIG1zZWNzPSIgKwogICAgICAgICAg\nICAgICAgICAgIHJ1blRpbWUsIHJ1blRpbWUgPiAxOTAwKTsKICAgICAgICAg\nICAgICAgIGFzc2VydE5vdE51bGwoIlZlcmlmeSB3ZSByZWNlaXZlZCBhIHJl\nc3VsdC4iLCByZXN1bHQpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgZmFpbCgiVW5leHBlY3RlZCB0ZXN0\nUXVlcnlUaW1lb3V0MjFiKCkgZXhjZXB0aW9uID0gIiArIGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChl\nbSAhPSBudWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAg\nZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDogMi4yLmEpIEV4\ncGxpY2l0IGFubm90YXRlZCBRdWVyeUhpbnQgb2YgdGltZW91dD0wCiAgICAg\nKiBpcyB0cmVhdGVkIHRoZSBzYW1lIGFzIHRoZSBkZWZhdWx0IG5vIHRpbWVv\ndXQgZm9yIHF1ZXJpZXMuCiAgICAgKiBFeHBlY3RlZCBSZXN1bHRzOiBUaGUg\nREVMQVkgZnVuY3Rpb24gaXMgYmVpbmcgY2FsbGVkIGFuZCB0aGUgcXVlcnkK\nICAgICAqIHRha2VzIDYwMDArIG1zZWNzIHRvIGNvbXBsZXRlLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0UXVlcnlUaW1lb3V0MjJhKCkgewogICAg\nICAgIGlmIChza2lwVGVzdHMpIHsKICAgICAgICAgICAgZ2V0TG9nKCkudHJh\nY2UoInRlc3RRdWVyeVRpbWVvdXQyMmEgLSB0ZXN0IGlzICIgKwogICAgICAg\nICAgICAgICAgImJlaW5nIHNraXBwZWQgZm9yICIgKyBkaWN0LnBsYXRmb3Jt\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBnZXRM\nb2coKS50cmFjZSgidGVzdFF1ZXJ5VGltZW91dDIyYSgpIC0gUXVlcnlIaW50\nPTAiKTsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5h\nZ2VyKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAgICAg\nICAgICBRdWVyeSBxID0gZW0uY3JlYXRlTmFtZWRRdWVyeSgiSGludDBtc2Vj\nIik7CiAgICAgICAgICAgIC8vIHZlcmlmeSBqYXZheC5wZXJzaXN0ZW5jZS5x\ndWVyeS50aW1lb3V0IGlzIHN1cHBsaWVkCiAgICAgICAgICAgIE1hcDxTdHJp\nbmcsIE9iamVjdD4gaGludHMgPSBxLmdldEhpbnRzKCk7CiAgICAgICAgICAg\nIGFzc2VydFRydWUoaGludHMuY29udGFpbnNLZXkoImphdmF4LnBlcnNpc3Rl\nbmNlLnF1ZXJ5LnRpbWVvdXQiKSk7CiAgICAgICAgICAgIEludGVnZXIgdGlt\nZW91dCA9IG5ldyBJbnRlZ2VyKAogICAgICAgICAgICAgICAgKFN0cmluZykg\naGludHMuZ2V0KCJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0Iikp\nOwogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdFF1ZXJ5VGltZW91\ndDIyYSgpIC0gUmV0cmlldmVkIGhpbnQgIiArIAogICAgICAgICAgICAgICAg\nImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQ9IiArIHRpbWVvdXQp\nOwogICAgICAgICAgICBhc3NlcnRFcXVhbHModGltZW91dCwgbmV3IEludGVn\nZXIoMCkpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxv\nbmcgc3RhcnRUaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAg\nICAgICAgICAgICAgICBAU3VwcHJlc3NXYXJuaW5ncygidW5jaGVja2VkIikK\nICAgICAgICAgICAgICAgIExpc3QgcmVzdWx0cyA9IHEuZ2V0UmVzdWx0TGlz\ndCgpOwogICAgICAgICAgICAgICAgbG9uZyBlbmRUaW1lID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBsb25nIHJ1blRp\nbWUgPSBlbmRUaW1lIC0gc3RhcnRUaW1lOwogICAgICAgICAgICAgICAgZ2V0\nTG9nKCkudHJhY2UoInRlc3RRdWVyeVRpbWVvdXQyMmEoKSAtIEhpbnQwbXNl\nYyBydW5UaW1lICIgKwogICAgICAgICAgICAgICAgICAgICJtc2Vjcz0iICsg\ncnVuVGltZSk7CiAgICAgICAgICAgICAgICAvLyBIYWNrIC0gV2luZG93cyBz\nb21ldGltZXMgcmV0dXJucyA1OTk5IGluc3RlYWQgb2YgNjAwMCsKICAgICAg\nICAgICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBoYXZlIHRha2VuIDYrIHNl\nY3MsIGJ1dCB3YXMgbXNlY3M9IiArCiAgICAgICAgICAgICAgICAgICAgcnVu\nVGltZSwgcnVuVGltZSA+IDU5MDApOwogICAgICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKCJWZXJpZnkgd2UgZm91bmQgMiByZXN1bHRzLiIsIDIsIHJlc3Vs\ndHMuc2l6ZSgpKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIGZhaWwoIlVuZXhwZWN0ZWQgdGVzdFF1ZXJ5\nVGltZW91dDIyYSgpIGV4Y2VwdGlvbiA9ICIgKyBlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICgoZW0gIT0g\nbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAgICAgIGVtLmNs\nb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTY2VuYXJpbyBiZWluZyB0ZXN0ZWQ6IDIuMy5iKSBFeHBsaWNp\ndCBzZXRIaW50IG9mIHRpbWVvdXQ9MCBpcyB0cmVhdGVkCiAgICAgKiB0aGUg\nc2FtZSBhcyB0aGUgZGVmYXVsdCBubyB0aW1lb3V0IGZvciBxdWVyaWVzLgog\nICAgICogRXhwZWN0ZWQgUmVzdWx0czogVGhlIERFTEFZIGZ1bmN0aW9uIGlz\nIGJlaW5nIGNhbGxlZCBhbmQgdGhlIHF1ZXJ5CiAgICAgKiB0YWtlcyAyMDAw\nKyBtc2VjcyB0byBjb21wbGV0ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQg\ndGVzdFF1ZXJ5VGltZW91dDIzYigpIHsKICAgICAgICBpZiAoc2tpcFRlc3Rz\nKSB7CiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1l\nb3V0MjNiIC0gdGVzdCBpcyAiICsKICAgICAgICAgICAgICAgICJiZWluZyBz\na2lwcGVkIGZvciAiICsgZGljdC5wbGF0Zm9ybSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgSW50ZWdlciBzZXRUaW1lID0gbmV3\nIEludGVnZXIoMCk7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVy\neVRpbWVvdXQyM2IoKSAtIHNldEhpbnQoIiArIHNldFRpbWUgKyAiKSIpOwog\nICAgICAgIEVudGl0eU1hbmFnZXIgZW0gPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsK\nICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAgICAgICAgIFF1\nZXJ5IHEgPSBlbS5jcmVhdGVOYW1lZFF1ZXJ5KCJOb0hpbnRTaW5nbGUiKTsK\nCiAgICAgICAgICAgIC8vIHZlcmlmeSBubyBkZWZhdWx0IGphdmF4LnBlcnNp\nc3RlbmNlLnF1ZXJ5LnRpbWVvdXQgaXMgc3VwcGxpZWQKICAgICAgICAgICAg\nTWFwPFN0cmluZywgT2JqZWN0PiBoaW50cyA9IHEuZ2V0SGludHMoKTsKICAg\nICAgICAgICAgYXNzZXJ0RmFsc2UoaGludHMuY29udGFpbnNLZXkoImphdmF4\nLnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiKSk7CgogICAgICAgICAgICAv\nLyB1cGRhdGUgdGhlIHRpbWVvdXQgdmFsdWUgdG8gMCBhbmQgdmVyaWZ5IGl0\nIHdhcyBzZXQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVy\neVRpbWVvdXQyM2IoKSAtIFNldHRpbmcgaGludCAiICsgCiAgICAgICAgICAg\nICAgICAiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dD0iICsgc2V0\nVGltZSk7CiAgICAgICAgICAgIHEuc2V0SGludCgiamF2YXgucGVyc2lzdGVu\nY2UucXVlcnkudGltZW91dCIsIHNldFRpbWUpOwogICAgICAgICAgICBoaW50\ncyA9IHEuZ2V0SGludHMoKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShoaW50\ncy5jb250YWluc0tleSgiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91\ndCIpKTsKICAgICAgICAgICAgSW50ZWdlciB0aW1lb3V0ID0gKEludGVnZXIp\nIGhpbnRzLmdldCgKICAgICAgICAgICAgICAgICJqYXZheC5wZXJzaXN0ZW5j\nZS5xdWVyeS50aW1lb3V0Iik7CiAgICAgICAgICAgIGdldExvZygpLnRyYWNl\nKCJ0ZXN0UXVlcnlUaW1lb3V0MjNiKCkgLSBSZXRyaWV2ZWQgaGludCAiICsK\nICAgICAgICAgICAgICAgICJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1l\nb3V0PSIgKyB0aW1lb3V0KTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKHRp\nbWVvdXQsIHNldFRpbWUpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGxvbmcgc3RhcnRUaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCk7CiAgICAgICAgICAgICAgICBPYmplY3QgcmVzdWx0ID0gcS5nZXRT\naW5nbGVSZXN1bHQoKTsKICAgICAgICAgICAgICAgIGxvbmcgZW5kVGltZSA9\nIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAg\nbG9uZyBydW5UaW1lID0gZW5kVGltZSAtIHN0YXJ0VGltZTsKICAgICAgICAg\nICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1lb3V0MjNiKCkg\nLSBOb0hpbnRTaW5nbGUgcnVuVGltZSAiICsKICAgICAgICAgICAgICAgICAg\nICAibXNlY3M9IiArIHJ1blRpbWUpOwogICAgICAgICAgICAgICAgLy8gSGFj\nayAtIFdpbmRvd3Mgc29tZXRpbWVzIHJldHVybnMgMTk5OSBpbnN0ZWFkIG9m\nIDIwMDArCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgaGF2\nZSB0YWtlbiAyKyBzZWNzLCBidXQgd2FzIG1zZWNzPSIgKwogICAgICAgICAg\nICAgICAgICAgIHJ1blRpbWUsIHJ1blRpbWUgPiAxOTAwKTsKICAgICAgICAg\nICAgICAgIGFzc2VydE5vdE51bGwoIlZlcmlmeSB3ZSByZWNlaXZlZCBhIHJl\nc3VsdC4iLCByZXN1bHQpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgZmFpbCgiVW5leHBlY3RlZCB0ZXN0\nUXVlcnlUaW1lb3V0MjNiKCkgZXhjZXB0aW9uID0gIiArIGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChl\nbSAhPSBudWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAg\nZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDogMy4xLmMpIEV4\ncGxpY2l0IHBlcnNpc3RlbmNlLnhtbCBwcm92aWRlZCBQVQogICAgICogcHJv\ncGVydHkgb2YgdGltZW91dD0xMDAwIG1zZWNzIHdpbGwgY2F1c2UgdGhlIHF1\nZXJ5IHRvIHRpbWVvdXQuCiAgICAgKiBFeHBlY3RlZCBSZXN1bHRzOiBUaGUg\nREVMQVkgZnVuY3Rpb24gaXMgYmVpbmcgY2FsbGVkIGFuZCB0aGUgcXVlcnkK\nICAgICAqIHRha2VzIDIwMDArIG1zZWNzIHRvIGNvbXBsZXRlLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0UXVlcnlUaW1lb3V0MzFjKCkgewogICAg\nICAgIGlmIChza2lwRXhjZXB0aW9uVGVzdHMpIHsKICAgICAgICAgICAgZ2V0\nTG9nKCkudHJhY2UoInRlc3RRdWVyeVRpbWVvdXQzMWMgLSB0ZXN0IGlzICIg\nKwogICAgICAgICAgICAgICAgImJlaW5nIHNraXBwZWQgZm9yICIgKyBkaWN0\nLnBsYXRmb3JtKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAg\nICAgICBnZXRMb2coKS50cmFjZSgidGVzdFF1ZXJ5VGltZW91dDMxYygpIC0g\nUFUodGltZW91dD0xMDAwKSwgIiArCiAgICAgICAgICAgICJleGVjdXRlVXBk\nYXRlIHRpbWVvdXQiKTsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlckZh\nY3RvcnkgZW1mID0gbnVsbDsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdl\nciBlbSA9IG51bGw7CiAgICAgICAgSW50ZWdlciBzZXRUaW1lID0gbmV3IElu\ndGVnZXIoMTAwMCk7CiAgICAgICAgYm9vbGVhbiBiUmV0cnkgPSB0cnVlOwoK\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBjcmVhdGUgb3VyIEVNRiB3\naXRoIG91ciBQVSBzZXQgdGltZW91dCBwcm9wZXJ0eQogICAgICAgICAgICBl\nbWYgPSBPcGVuSlBBUGVyc2lzdGVuY2UuY3JlYXRlRW50aXR5TWFuYWdlckZh\nY3RvcnkoCiAgICAgICAgICAgICAgICAicXRpbWVvdXQtMTAwMG1zZWNzIiwg\nInBlcnNpc3RlbmNlMy54bWwiKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVs\nbChlbWYpOwogICAgICAgICAgICAvLyB2ZXJpZnkgUFUgcHJvcGVydGllcyB1\ncGRhdGVkIHRoZSBjb25maWcKICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24gY29uZiA9IGVtZi5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAg\nICAgIGFzc2VydE5vdE51bGwoY29uZik7CiAgICAgICAgICAgIGFzc2VydEVx\ndWFscygiUFUgcHJvdmlkZWQgcXVlcnkgdGltZW91dCIsIHNldFRpbWUuaW50\nVmFsdWUoKSwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0UXVlcnlUaW1lb3V0\nKCkpOwogICAgICAgICAgICAvLyBjcmVhdGUgRU0gYW5kIFF1ZXJ5CiAgICAg\nICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7CiAgICAgICAgICAgIE9wZW5KUEFR\ndWVyeSBxID0gZW0uY3JlYXRlTmF0aXZlUXVlcnkobmF0aXZlVXBkYXRlU3Ry\nKTsKICAgICAgICAgICAgcS5zZXRQYXJhbWV0ZXIoMSwgbmV3IFN0cmluZygi\ndXBkYXRlZCIpKTsKICAgICAgICAgICAgLy8gdmVyaWZ5IG5vIGRlZmF1bHQg\namF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dCBpcyBzdXBwbGllZAog\nICAgICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGhpbnRzID0gcS5nZXRI\naW50cygpOwogICAgICAgICAgICBhc3NlcnRGYWxzZShoaW50cy5jb250YWlu\nc0tleSgiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIpKTsKICAg\nICAgICAgICAgLy8gdmVyaWZ5IGludGVybmFsIGNvbmZpZyB2YWx1ZXMgd2Vy\nZSB1cGRhdGVkCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiUFUgcHJvdmlk\nZWQgcXVlcnkgdGltZW91dCIsIHNldFRpbWUuaW50VmFsdWUoKSwKICAgICAg\nICAgICAgICAgIHEuZ2V0RmV0Y2hQbGFuKCkuZ2V0UXVlcnlUaW1lb3V0KCkp\nOwoKICAgICAgICAgICAgLy8gdmVyaWZ5IHF1ZXJ5VGltZW91dCBvbiBFTSBm\naW5kIG9wZXJhdGlvbnMKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24o\nKS5iZWdpbigpOwogICAgICAgICAgICAvLyBpZiB3ZSBnZXQgYSBRVEUsIHRo\nZW4gcmV0cnkgdGhpcyBvbmNlIHRvIHByb3ZlIG5vIGRiIHJvbGxiYWNrCiAg\nICAgICAgICAgIGZvciAoaW50IGk9MDsgaTw9MSAmJiBiUmV0cnk7IGkrKykK\nICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBsb25nIHN0YXJ0VGltZSA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICAgICAgICAgIEBTdXBwcmVzc1dhcm5p\nbmdzKCJ1bnVzZWQiKQogICAgICAgICAgICAgICAgICAgIGludCBjb3VudCA9\nIHEuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIC8vIGV4\nY2VwdGlvbiBzaG91bGQgb2NjdXIgYmVmb3JlIGNvbW1pdAogICAgICAgICAg\nICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAg\nICAgICAgICAgICAgICAgbG9uZyBlbmRUaW1lID0gU3lzdGVtLmN1cnJlbnRU\naW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICAgICAgbG9uZyBydW5UaW1l\nID0gZW5kVGltZSAtIHN0YXJ0VGltZTsKICAgICAgICAgICAgICAgICAgICBn\nZXRMb2coKS50cmFjZSgidGVzdFF1ZXJ5VGltZW91dDMxYygpIC0gZXhlY3V0\nZVVwZGF0ZSAiICsgCiAgICAgICAgICAgICAgICAgICAgICAgICJydW5UaW1l\nIG1zZWNzPSIgKyBydW5UaW1lKTsKICAgICAgICAgICAgICAgICAgICBmYWls\nKCJRdWVyeVRpbWVvdXQgZm9yIGV4ZWN1dGVVcGRhdGUgZmFpbGVkIHRvIGNh\ndXNlIGFuICIgKyAKICAgICAgICAgICAgICAgICAgICAgICAgIkV4Y2VwdGlv\nbiBpbiB0ZXN0UXVlcnlUaW1lb3V0MzFjKCIgKyBzZXRUaW1lICsKICAgICAg\nICAgICAgICAgICAgICAgICAgIiBtc2NzKSwgcnVuVGltZSBtc2Vjcz0iICsg\ncnVuVGltZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgICAgIC8vIGV4cGVjdGVkIC0gU2hvdWxk\nIGNhdXNlIGEgUXVlcnlUaW1lb3V0RXhjZXB0aW9uIGZvcjoKICAgICAgICAg\nICAgICAgICAgICAvLyAgICAgIERlcmJ5LCBNUyBTUUwKICAgICAgICAgICAg\nICAgICAgICAvLyBzaG91bGQgb25seSByZXRyeSB0aGUgc3RhdGVtZW50IGlm\nIGRiIGRpZCBub3Qgcm9sbGJhY2sKICAgICAgICAgICAgICAgICAgICAvLyB3\naGljaCBzaG91bGQgYmUgYSBRdWVyeVRpbWVvdXRFeGNlcHRpb24KICAgICAg\nICAgICAgICAgICAgICBiUmV0cnkgPSBjaGVja0V4Y2VwdGlvbigidGVzdFF1\nZXJ5VGltZW91dDMxYygpIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgLy8g\nd2UncmUgb25seSByZXRyeWluZyB0byBwcm92ZSB0aGUgcmlnaHQgZXhjZXB0\naW9uIHR5cGUKICAgICAgICAgICAgICAgICAgICAvLyB3YXMgdGhyb3duIGFu\nZCB0aGUgdHJhbnNhY3Rpb24gd2Fzbid0IHJvbGxlZCBiYWNrCiAgICAgICAg\nICAgICAgICAgICAgaWYgKGJSZXRyeSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVyeVRpbWVvdXQzMWMoKSAtIHJl\ndHJ5aW5nLi4uICIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChlbSAhPSBu\ndWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAgaWYgKGVt\nLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAg\nICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOiAz\nLjIuYSkgRXhwbGljaXQgYW5ub3RhdGVkIFF1ZXJ5SGludCBvZgogICAgICog\ndGltZW91dD0xMDAwIG1zZWNzIHdpbGwgb3ZlcnJpZGUgdGhlIFBVIGFuZCBN\nYXAgcHJvdmlkZWQgdGltZW91dHMKICAgICAqIGFuZCBjYXVzZSB0aGUgcXVl\ncnkgdG8gdGltZW91dC4KICAgICAqIEV4cGVjdGVkIFJlc3VsdHM6IFF1ZXJ5\nVGltZW91dEV4Y2VwdGlvbiBvciBQZXJzaXN0ZW5jZUV4Y2VwdGlvbgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0UXVlcnlUaW1lb3V0MzJhKCkgewog\nICAgICAgIGlmIChza2lwRXhjZXB0aW9uVGVzdHMgfHwgbm9TZWxlY3RUaW1l\nb3V0cykgewogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidGVzdFF1ZXJ5\nVGltZW91dDMyYSAtIHRlc3QgaXMgIiArCiAgICAgICAgICAgICAgICAiYmVp\nbmcgc2tpcHBlZCBmb3IgIiArIGRpY3QucGxhdGZvcm0pOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGdldExvZygpLnRyYWNlKCJ0\nZXN0UXVlcnlUaW1lb3V0MzJhKCkgLSBQVSgxMDAwKSwgTWFwKDApLCAiICsK\nICAgICAgICAgICAgIlF1ZXJ5SGludCgxMDAwKSIpOwogICAgICAgIE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeSBlbWYgPSBudWxsOwogICAgICAgIE9w\nZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsKICAgICAgICBJbnRlZ2Vy\nIHNldFRpbWUgPSBuZXcgSW50ZWdlcigwKTsKCiAgICAgICAgLy8gY3JlYXRl\nIHRoZSBNYXAgdG8gdGVzdCBvdmVycmlkZXMKICAgICAgICBNYXA8U3RyaW5n\nLFN0cmluZz4gcHJvcHMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsU3RyaW5nPigp\nOwogICAgICAgIHByb3BzLnB1dCgiamF2YXgucGVyc2lzdGVuY2UucXVlcnku\ndGltZW91dCIsICIwIik7CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gY3JlYXRlIG91ciBFTUYgd2l0aCBvdXIgUFUgc2V0IHRpbWVv\ndXQgcHJvcGVydHkKICAgICAgICAgICAgZW1mID0gT3BlbkpQQVBlcnNpc3Rl\nbmNlLmNyZWF0ZUVudGl0eU1hbmFnZXJGYWN0b3J5KAogICAgICAgICAgICAg\nICAgInF0aW1lb3V0LTEwMDBtc2VjcyIsICJwZXJzaXN0ZW5jZTMueG1sIiwg\ncHJvcHMpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGVtZik7CiAgICAg\nICAgICAgIC8vIHZlcmlmeSBNYXAgcHJvcGVydGllcyBvdmVycm9kZSB0aGUg\nUFUgcHJvcGVydGllcyBpbiBjb25maWcKICAgICAgICAgICAgT3BlbkpQQUNv\nbmZpZ3VyYXRpb24gY29uZiA9IGVtZi5nZXRDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgICAgIGFzc2VydE5vdE51bGwoY29uZik7CiAgICAgICAgICAgIGFz\nc2VydEVxdWFscygiTWFwIHByb3ZpZGVkIHF1ZXJ5IHRpbWVvdXQiLCBzZXRU\naW1lLmludFZhbHVlKCksCiAgICAgICAgICAgICAgICBjb25mLmdldFF1ZXJ5\nVGltZW91dCgpKTsKICAgICAgICAgICAgLy8gY3JlYXRlIEVNIGFuZCBuYW1l\nZCBxdWVyeQogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5h\nZ2VyKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAgICAg\nICAgICBPcGVuSlBBUXVlcnkgcSA9IGVtLmNyZWF0ZU5hbWVkUXVlcnkoIkhp\nbnQxMDAwbXNlYyIpOwogICAgICAgICAgICBzZXRUaW1lID0gMTAwMDsKICAg\nICAgICAgICAgLy8gdmVyaWZ5IGphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRp\nbWVvdXQgaGludCB2aWEgYW5ub3RhdGlvbiBzZXQKICAgICAgICAgICAgTWFw\nPFN0cmluZywgT2JqZWN0PiBoaW50cyA9IHEuZ2V0SGludHMoKTsKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZShoaW50cy5jb250YWluc0tleSgiamF2YXgucGVy\nc2lzdGVuY2UucXVlcnkudGltZW91dCIpKTsKICAgICAgICAgICAgSW50ZWdl\nciB0aW1lb3V0ID0gbmV3IEludGVnZXIoKFN0cmluZykgaGludHMuZ2V0KAog\nICAgICAgICAgICAgICAgImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVv\ndXQiKSk7CiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKAogICAgICAgICAg\nICAgICAgInRlc3RRdWVyeVRpbWVvdXQzMmEoKSAtIEZvdW5kIGphdmF4LnBl\ncnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQ9IgogICAgICAgICAgICAgICAgKyB0\naW1lb3V0KTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRXhwZWN0ZWQgdG8g\nZmluZCBhIGphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQ9IgogICAg\nICAgICAgICAgICAgKyBzZXRUaW1lLCAodGltZW91dC5pbnRWYWx1ZSgpID09\nIHNldFRpbWUuaW50VmFsdWUoKSkpOwogICAgICAgICAgICAvLyB2ZXJpZnkg\naW50ZXJuYWwgY29uZmlnIHZhbHVlcyB3ZXJlIHVwZGF0ZWQKICAgICAgICAg\nICAgYXNzZXJ0RXF1YWxzKCJRdWVyeUhpbnQgcHJvdmlkZWQgcXVlcnkgdGlt\nZW91dCIsIHNldFRpbWUuaW50VmFsdWUoKSwKICAgICAgICAgICAgICAgIHEu\nZ2V0RmV0Y2hQbGFuKCkuZ2V0UXVlcnlUaW1lb3V0KCkpOwoKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnRUaW1lID0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBAU3Vw\ncHJlc3NXYXJuaW5ncyggeyAidW5jaGVja2VkIiwgInVudXNlZCIgfSkKICAg\nICAgICAgICAgICAgIExpc3QgcmVzdWx0cyA9IHEuZ2V0UmVzdWx0TGlzdCgp\nOwogICAgICAgICAgICAgICAgbG9uZyBlbmRUaW1lID0gU3lzdGVtLmN1cnJl\nbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBsb25nIHJ1blRpbWUg\nPSBlbmRUaW1lIC0gc3RhcnRUaW1lOwogICAgICAgICAgICAgICAgZ2V0TG9n\nKCkudHJhY2UoCiAgICAgICAgICAgICAgICAgICAgInRlc3RRdWVyeVRpbWVv\ndXQzMmEoKSAtIEhpbnQxMDAwbXNlYyBydW5UaW1lIG1zZWNzPSIKICAgICAg\nICAgICAgICAgICAgICArIHJ1blRpbWUpOwogICAgICAgICAgICAgICAgLy9h\nc3NlcnRFcXVhbHMoIlNob3VsZCBuZXZlciBnZXQgdmFsaWQgcmVzdWx0cyBk\ndWUgdG8gdGhlICIgKyAKICAgICAgICAgICAgICAgIC8vICJ0aW1lb3V0LiIs\nIDIsIHJlc3VsdHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgIGZhaWwoIlF1\nZXJ5VGltZW91dCBhbm5vdGF0aW9uIGZhaWxlZCB0byBjYXVzZSBhbiBFeGNl\ncHRpb24gIiArCiAgICAgICAgICAgICAgICAgICAgImluIHRlc3RRdWVyeVRp\nbWVvdXQzMmEoIiArIHNldFRpbWUgKwogICAgICAgICAgICAgICAgICAgICIg\nbXNlY3MpLCBydW5UaW1lIG1zZWNzPSIgKyBydW5UaW1lKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8v\nIGV4cGVjdGVkCiAgICAgICAgICAgICAgICBjaGVja0V4Y2VwdGlvbigidGVz\ndFF1ZXJ5VGltZW91dDMyYSgpIiwgZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoKGVtICE9IG51bGwpICYm\nIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nU2NlbmFyaW8gYmVpbmcgdGVzdGVkOiAzLjMuYikgRXhwbGljaXQgc2V0SGlu\ndCBvZiB0aW1lb3V0IHRvIDEwMDAgbXNlY3MKICAgICAqIHdpbGwgY2F1c2Ug\ndGhlIHF1ZXJ5IHRvIHRpbWVvdXQuCiAgICAgKiBFeHBlY3RlZCBSZXN1bHRz\nOiBRdWVyeVRpbWVvdXRFeGNlcHRpb24gb3IgUGVyc2lzdGVuY2VFeGNlcHRp\nb24KICAgICAqLwogICAgcHVibGljIHZvaWQgdGVzdFF1ZXJ5VGltZW91dDMz\nYigpIHsKICAgICAgICBpZiAoc2tpcEV4Y2VwdGlvblRlc3RzIHx8IG5vU2Vs\nZWN0VGltZW91dHMpIHsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRl\nc3RRdWVyeVRpbWVvdXQzM2IgLSB0ZXN0IGlzICIgKwogICAgICAgICAgICAg\nICAgImJlaW5nIHNraXBwZWQgZm9yICIgKyBkaWN0LnBsYXRmb3JtKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBJbnRlZ2VyIHNl\ndFRpbWUgPSBuZXcgSW50ZWdlcigxMDAwKTsKICAgICAgICBnZXRMb2coKS50\ncmFjZSgidGVzdFF1ZXJ5VGltZW91dDMzYigpIC0gc2V0SGludCgiICsgc2V0\nVGltZSArICIpIik7CiAgICAgICAgRW50aXR5TWFuYWdlciBlbSA9IG51bGw7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7\nCiAgICAgICAgICAgIFF1ZXJ5IHEgPSBlbS5jcmVhdGVOYW1lZFF1ZXJ5KCJO\nb0hpbnRTaW5nbGUiKTsKCiAgICAgICAgICAgIC8vIHZlcmlmeSBubyBkZWZh\ndWx0IGphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQgaXMgc3VwcGxp\nZWQKICAgICAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBoaW50cyA9IHEu\nZ2V0SGludHMoKTsKICAgICAgICAgICAgYXNzZXJ0RmFsc2UoaGludHMuY29u\ndGFpbnNLZXkoImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiKSk7\nCgogICAgICAgICAgICAvLyB1cGRhdGUgdGhlIHRpbWVvdXQgdmFsdWUgYW5k\nIHZlcmlmeSBpdCB3YXMgc2V0CiAgICAgICAgICAgIGdldExvZygpLnRyYWNl\nKCJ0ZXN0UXVlcnlUaW1lb3V0MzNiKCkgLSBTZXR0aW5nIGhpbnQgIiArCiAg\nICAgICAgICAgICAgICAiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91\ndD0iICsgc2V0VGltZSk7CiAgICAgICAgICAgIHEuc2V0SGludCgiamF2YXgu\ncGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIsIHNldFRpbWUpOwogICAgICAg\nICAgICBoaW50cyA9IHEuZ2V0SGludHMoKTsKICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZShoaW50cy5jb250YWluc0tleSgiamF2YXgucGVyc2lzdGVuY2UucXVl\ncnkudGltZW91dCIpKTsKICAgICAgICAgICAgSW50ZWdlciB0aW1lb3V0ID0g\nKEludGVnZXIpIGhpbnRzLmdldCgKICAgICAgICAgICAgICAgICJqYXZheC5w\nZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0Iik7CiAgICAgICAgICAgIGFzc2Vy\ndEVxdWFscyh0aW1lb3V0LCBzZXRUaW1lKTsKCiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0VGltZSA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAgQFN1cHByZXNzV2Fy\nbmluZ3MoInVudXNlZCIpCiAgICAgICAgICAgICAgICBPYmplY3QgcmVzdWx0\nID0gcS5nZXRTaW5nbGVSZXN1bHQoKTsKICAgICAgICAgICAgICAgIGxvbmcg\nZW5kVGltZSA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAg\nICAgICAgICAgbG9uZyBydW5UaW1lID0gZW5kVGltZSAtIHN0YXJ0VGltZTsK\nICAgICAgICAgICAgICAgIGdldExvZygpLnRyYWNlKAogICAgICAgICAgICAg\nICAgICAgICJ0ZXN0UXVlcnlUaW1lb3V0MzNiKCkgLSBOb0hpbnRTaW5nbGUg\ncnVuVGltZSBtc2Vjcz0iCiAgICAgICAgICAgICAgICAgICAgKyBydW5UaW1l\nKTsKICAgICAgICAgICAgICAgIC8vYXNzZXJ0TnVsbCgiU2hvdWxkIG5ldmVy\nIGdldCB2YWxpZCByZXN1bHQgZHVlIHRvIHRoZSB0aW1lb3V0LiIKICAgICAg\nICAgICAgICAgIC8vICAgICwgcmVzdWx0KTsKICAgICAgICAgICAgICAgIGZh\naWwoIlF1ZXJ5VGltZW91dCBhbm5vdGF0aW9uIGZhaWxlZCB0byBjYXVzZSBh\nbiBFeGNlcHRpb24gIiArIAogICAgICAgICAgICAgICAgICAgICJpbiB0ZXN0\nUXVlcnlUaW1lb3V0MzNiKCIgKyBzZXRUaW1lICsKICAgICAgICAgICAgICAg\nICAgICAiIG1zY3MpLCBydW5UaW1lIG1zZWNzPSIgKyBydW5UaW1lKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIC8vIGV4cGVjdGVkCiAgICAgICAgICAgICAgICBjaGVja0V4Y2VwdGlv\nbigidGVzdFF1ZXJ5VGltZW91dDMzYigpIiwgZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoKGVtICE9IG51\nbGwpICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAgICBlbS5jbG9z\nZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOiAzLjMuYykgRXhwbGljaXQg\nc2V0SGludCBvZiB0aW1lb3V0IHRvIDEwMDAgbXNlY3MKICAgICAqIHdpbGwg\nY2F1c2UgdGhlIFBVIHByb3ZpZGVkIHRpbWVvdXQ9MCB2YWx1ZSB0byBiZSBv\ndmVycmlkZGVuIGFuZCB0aGUKICAgICAqIGV4ZWN1dGVVcGRhdGUgdG8gdGlt\nZW91dC4KICAgICAqIEV4cGVjdGVkIFJlc3VsdHM6IFF1ZXJ5VGltZW91dEV4\nY2VwdGlvbiAoRGVyYnkpIG9yIFBlcnNpc3RlbmNlRXhjZXB0aW9uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RRdWVyeVRpbWVvdXQzM2MoKSB7CiAg\nICAgICAgaWYgKHNraXBFeGNlcHRpb25UZXN0cykgewogICAgICAgICAgICBn\nZXRMb2coKS50cmFjZSgidGVzdFF1ZXJ5VGltZW91dDMzYyAtIHRlc3QgaXMg\nIiArCiAgICAgICAgICAgICAgICAiYmVpbmcgc2tpcHBlZCBmb3IgIiArIGRp\nY3QucGxhdGZvcm0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQog\nICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1lb3V0MzNjKCkg\nLSBQVSh0aW1lb3V0PTApLCBzZXRIaW50KDEwMDApLCIgKwogICAgICAgICAg\nICAiIGV4ZWN1dGVVcGRhdGUgdGltZW91dCIpOwogICAgICAgIE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyRmFjdG9yeSBlbWYgPSBudWxsOwogICAgICAgIE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsKICAgICAgICBJbnRlZ2VyIHNl\ndFRpbWUgPSBuZXcgSW50ZWdlcigwKTsgICAgICAgIAogICAgICAgIGJvb2xl\nYW4gYlJldHJ5ID0gdHJ1ZTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gY3JlYXRlIG91ciBFTUYgd2l0aCBvdXIgUFUgc2V0IHRpbWVvdXQgcHJv\ncGVydHkKICAgICAgICAgICAgZW1mID0gT3BlbkpQQVBlcnNpc3RlbmNlLmNy\nZWF0ZUVudGl0eU1hbmFnZXJGYWN0b3J5KAogICAgICAgICAgICAgICAgInF0\naW1lb3V0LTBtc2VjcyIsICJwZXJzaXN0ZW5jZTMueG1sIik7CiAgICAgICAg\nICAgIGFzc2VydE5vdE51bGwoZW1mKTsKICAgICAgICAgICAgLy8gdmVyaWZ5\nIFBVIHByb3BlcnRpZXMgdXBkYXRlZCB0aGUgY29uZmlnCiAgICAgICAgICAg\nIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBlbWYuZ2V0Q29uZmlndXJh\ndGlvbigpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGNvbmYpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoIlBVIHByb3ZpZGVkIG5vIHF1ZXJ5IHRp\nbWVvdXQiLCBzZXRUaW1lLmludFZhbHVlKCksCiAgICAgICAgICAgICAgICBj\nb25mLmdldFF1ZXJ5VGltZW91dCgpKTsKICAgICAgICAgICAgLy8gY3JlYXRl\nIEVNIGFuZCBRdWVyeQogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwog\nICAgICAgICAgICAvLyBGb2xsb3dpbmcgZmFpbHMgdG8gY2F1c2UgYSBTUUxF\neGNlcHRpb24sIGJ1dCB0YWtlcyAyKyBzZWNzCiAgICAgICAgICAgIC8vIFF1\nZXJ5IHEgPSBlbS5jcmVhdGVRdWVyeSgiVVBEQVRFIFFUaW1lb3V0IHEgU0VU\nIHEuc3RyaW5nRmllbGQgPSAKICAgICAgICAgICAgLy8gICAgICsgIjpzdHJW\nYWwgV0hFUkUgcS5pZCA+IDAiKTsKICAgICAgICAgICAgLy8gcS5zZXRQYXJh\nbWV0ZXIoInN0clZhbCIsIG5ldyBTdHJpbmcoInVwZGF0ZWQiKSk7CiAgICAg\nICAgICAgIC8vIEZvbGxvd2luZyBmYWlscyB0byBjYXVzZSBhIFNRTEV4Y2Vw\ndGlvbiwgYnV0IHRha2VzIDIrIHNlY3MKICAgICAgICAgICAgLy8gUXVlcnkg\ncSA9IGVtLmNyZWF0ZU5hdGl2ZVF1ZXJ5KCJJTlNFUlQgSU5UTyBRVGltZW91\ndCAoaWQsICIgKwogICAgICAgICAgICAvLyAgICAic3RyaW5nRmllbGQpIFZB\nTFVFUyAoPyw/KSIpOwogICAgICAgICAgICAvLyBxLnNldFBhcmFtZXRlcigx\nLCA5OSk7CiAgICAgICAgICAgIC8vIHEuc2V0UGFyYW1ldGVyKDIsIG5ldyBT\ndHJpbmcoImluc2VydGVkIikpOwogICAgICAgICAgICBPcGVuSlBBUXVlcnkg\ncSA9IGVtLmNyZWF0ZU5hdGl2ZVF1ZXJ5KG5hdGl2ZVVwZGF0ZVN0cik7CiAg\nICAgICAgICAgIHEuc2V0UGFyYW1ldGVyKDEsIG5ldyBTdHJpbmcoInVwZGF0\nZWQiKSk7CiAgICAgICAgICAgIC8vIHZlcmlmeSBubyBkZWZhdWx0IGphdmF4\nLnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQgaXMgc3VwcGxpZWQKICAgICAg\nICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBoaW50cyA9IHEuZ2V0SGludHMo\nKTsKICAgICAgICAgICAgYXNzZXJ0RmFsc2UoaGludHMuY29udGFpbnNLZXko\nImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiKSk7CiAgICAgICAg\nICAgIC8vIHVwZGF0ZSB0aGUgcXVlcnkgdGltZW91dCB2YWx1ZSBhbmQgdmVy\naWZ5IGl0IHdhcyBzZXQKICAgICAgICAgICAgc2V0VGltZSA9IDEwMDA7CiAg\nICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1lb3V0MzNj\nKCkgLSBTZXR0aW5nIGhpbnQgIiArCiAgICAgICAgICAgICAgICAiamF2YXgu\ncGVyc2lzdGVuY2UucXVlcnkudGltZW91dD0iICsgc2V0VGltZSk7CiAgICAg\nICAgICAgIHEuc2V0SGludCgiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGlt\nZW91dCIsIHNldFRpbWUpOwogICAgICAgICAgICBoaW50cyA9IHEuZ2V0SGlu\ndHMoKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShoaW50cy5jb250YWluc0tl\neSgiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIpKTsKICAgICAg\nICAgICAgSW50ZWdlciB0aW1lb3V0ID0gKEludGVnZXIpIGhpbnRzLmdldCgK\nICAgICAgICAgICAgICAgICJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1l\nb3V0Iik7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyh0aW1lb3V0LCBzZXRU\naW1lKTsKICAgICAgICAgICAgLy8gdmVyaWZ5IGludGVybmFsIGNvbmZpZyB2\nYWx1ZXMgd2VyZSB1cGRhdGVkCiAgICAgICAgICAgIGFzc2VydEVxdWFscygi\nUFUgcHJvdmlkZWQgcXVlcnkgdGltZW91dCIsIHNldFRpbWUuaW50VmFsdWUo\nKSwKICAgICAgICAgICAgICAgIHEuZ2V0RmV0Y2hQbGFuKCkuZ2V0UXVlcnlU\naW1lb3V0KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBmb3IgKGludCBpPTA7\nIGk8PTEgJiYgYlJldHJ5OyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbG9uZyBzdGFydFRp\nbWUgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAg\nICAgICAgICBAU3VwcHJlc3NXYXJuaW5ncygidW51c2VkIikKICAgICAgICAg\nICAgICAgICAgICBpbnQgY291bnQgPSBxLmV4ZWN1dGVVcGRhdGUoKTsKICAg\nICAgICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgp\nOwogICAgICAgICAgICAgICAgICAgIGxvbmcgZW5kVGltZSA9IFN5c3RlbS5j\ndXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAgICAgIGxvbmcg\ncnVuVGltZSA9IGVuZFRpbWUgLSBzdGFydFRpbWU7CiAgICAgICAgICAgICAg\nICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVyeVRpbWVvdXQzM2MoKSAt\nIGV4ZWN1dGVVcGRhdGUgIiArIAogICAgICAgICAgICAgICAgICAgICAgICAi\ncnVuVGltZSBtc2Vjcz0iICsgcnVuVGltZSk7CiAgICAgICAgICAgICAgICAg\nICAgZmFpbCgiUXVlcnlUaW1lb3V0IGZvciBleGVjdXRlVXBkYXRlIGZhaWxl\nZCB0byBjYXVzZSBhbiAiICsgCiAgICAgICAgICAgICAgICAgICAgICAgICJF\neGNlcHRpb24gaW4gdGVzdFF1ZXJ5VGltZW91dDMzYygiICsgc2V0VGltZSAr\nCiAgICAgICAgICAgICAgICAgICAgICAgICIgbXNjcyksIHJ1blRpbWUgbXNl\nY3M9IiArIHJ1blRpbWUpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBleHBlY3RlZCAt\nIFNob3VsZCBjYXVzZSBhIFF1ZXJ5VGltZW91dEV4Y2VwdGlvbiBmb3I6CiAg\nICAgICAgICAgICAgICAgICAgLy8gICAgICBEZXJieSwgTVMgU1FMCiAgICAg\nICAgICAgICAgICAgICAgLy8gc2hvdWxkIG9ubHkgcmV0cnkgdGhlIHN0YXRl\nbWVudCBpZiBkYiBkaWQgbm90IHJvbGxiYWNrCiAgICAgICAgICAgICAgICAg\nICAgLy8gd2hpY2ggc2hvdWxkIGJlIGEgUXVlcnlUaW1lb3V0RXhjZXB0aW9u\nCiAgICAgICAgICAgICAgICAgICAgYlJldHJ5ID0gY2hlY2tFeGNlcHRpb24o\nInRlc3RRdWVyeVRpbWVvdXQzM2MoKSIsIGUpOwogICAgICAgICAgICAgICAg\nICAgIC8vIHdlJ3JlIG9ubHkgcmV0cnlpbmcgdG8gcHJvdmUgdGhlIHJpZ2h0\nIGV4Y2VwdGlvbiB0eXBlCiAgICAgICAgICAgICAgICAgICAgLy8gd2FzIHRo\ncm93biBhbmQgdGhlIHRyYW5zYWN0aW9uIHdhc24ndCByb2xsZWQgYmFjawog\nICAgICAgICAgICAgICAgICAgIGlmIChiUmV0cnkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVlcnlUaW1lb3V0MzNj\nKCkgLSByZXRyeWluZy4uLiAiKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICgo\nZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAgICAg\nIGlmIChlbS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAgICAg\nICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwog\nICAgICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRl\nc3RlZDogNCkgVGltZW91dCBvZiAtMSBzaG91bGQgYmUgdHJlYXRlZCB0aGUg\nc2FtZQogICAgICogYXMgdGhlIGRlZmF1bHQgbm8gdGltZW91dCBzY2VuYXJp\nby4KICAgICAqIEV4cGVjdGVkIFJlc3VsdHM6IFRoZSBERUxBWSBmdW5jdGlv\nbiBpcyBiZWluZyBjYWxsZWQgYW5kIHRoZSBxdWVyeQogICAgICogdGFrZXMg\nMjAwMCsgbXNlY3MgdG8gY29tcGxldGUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHRlc3RRdWVyeVRpbWVvdXQ0KCkgewogICAgICAgIGlmIChza2lwVGVz\ndHMpIHsKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVyeVRp\nbWVvdXQ0IC0gdGVzdCBpcyAiICsKICAgICAgICAgICAgICAgICJiZWluZyBz\na2lwcGVkIGZvciAiICsgZGljdC5wbGF0Zm9ybSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgSW50ZWdlciBzZXRUaW1lID0gbmV3\nIEludGVnZXIoLTEpOwogICAgICAgIGdldExvZygpLnRyYWNlKCJ0ZXN0UXVl\ncnlUaW1lb3V0NCgpIC0gc2V0SGludCgiICsgc2V0VGltZSArICIpIik7CiAg\nICAgICAgRW50aXR5TWFuYWdlciBlbSA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwog\nICAgICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAgICAgICAgUXVl\ncnkgcSA9IGVtLmNyZWF0ZU5hbWVkUXVlcnkoIk5vSGludFNpbmdsZSIpOwoK\nICAgICAgICAgICAgLy8gdmVyaWZ5IG5vIGRlZmF1bHQgamF2YXgucGVyc2lz\ndGVuY2UucXVlcnkudGltZW91dCBpcyBzdXBwbGllZAogICAgICAgICAgICBN\nYXA8U3RyaW5nLCBPYmplY3Q+IGhpbnRzID0gcS5nZXRIaW50cygpOwogICAg\nICAgICAgICBhc3NlcnRGYWxzZShoaW50cy5jb250YWluc0tleSgiamF2YXgu\ncGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIpKTsKCiAgICAgICAgICAgIC8v\nIHVwZGF0ZSB0aGUgdGltZW91dCB2YWx1ZSB0byAtMSBhbmQgdmVyaWZ5IGl0\nIHdhcyBzZXQKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVy\neVRpbWVvdXQ0KCkgLSBTZXR0aW5nIGhpbnQgIiArCiAgICAgICAgICAgICAg\nICAiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dD0iCiAgICAgICAg\nICAgICAgICArIHNldFRpbWUpOwogICAgICAgICAgICBxLnNldEhpbnQoImph\ndmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiLCBzZXRUaW1lKTsKICAg\nICAgICAgICAgaGludHMgPSBxLmdldEhpbnRzKCk7CiAgICAgICAgICAgIGFz\nc2VydFRydWUoaGludHMuY29udGFpbnNLZXkoImphdmF4LnBlcnNpc3RlbmNl\nLnF1ZXJ5LnRpbWVvdXQiKSk7CiAgICAgICAgICAgIEludGVnZXIgdGltZW91\ndCA9IChJbnRlZ2VyKSBoaW50cy5nZXQoCiAgICAgICAgICAgICAgICAiamF2\nYXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIpOwogICAgICAgICAgICBn\nZXRMb2coKS50cmFjZSgidGVzdFF1ZXJ5VGltZW91dDQoKSAtIFJldHJpZXZl\nZCBoaW50ICIgKwogICAgICAgICAgICAgICAgImphdmF4LnBlcnNpc3RlbmNl\nLnF1ZXJ5LnRpbWVvdXQ9IgogICAgICAgICAgICAgICAgKyB0aW1lb3V0KTsK\nICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKHRpbWVvdXQsIHNldFRpbWUpOwoK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnRU\naW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAg\nICAgICBPYmplY3QgcmVzdWx0ID0gcS5nZXRTaW5nbGVSZXN1bHQoKTsKICAg\nICAgICAgICAgICAgIGxvbmcgZW5kVGltZSA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICAgICAgbG9uZyBydW5UaW1lID0gZW5k\nVGltZSAtIHN0YXJ0VGltZTsKICAgICAgICAgICAgICAgIGdldExvZygpLnRy\nYWNlKAogICAgICAgICAgICAgICAgICAgICJ0ZXN0UXVlcnlUaW1lb3V0NCgp\nIC0gTm9IaW50U2luZ2xlIHJ1blRpbWUgbXNlY3M9IgogICAgICAgICAgICAg\nICAgICAgICsgcnVuVGltZSk7CiAgICAgICAgICAgICAgICAvLyBIYWNrIC0g\nV2luZG93cyBzb21ldGltZXMgcmV0dXJucyAxOTk5IGluc3RlYWQgb2YgMjAw\nMCsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBoYXZlIHRh\na2VuIDIrIHNlY3MsIGJ1dCB3YXMgbXNlY3M9IiArCiAgICAgICAgICAgICAg\nICAgICAgcnVuVGltZSwgcnVuVGltZSA+IDE5MDApOwogICAgICAgICAgICAg\nICAgYXNzZXJ0Tm90TnVsbCgiVmVyaWZ5IHdlIHJlY2VpdmVkIGEgcmVzdWx0\nLiIsIHJlc3VsdCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICBmYWlsKCJVbmV4cGVjdGVkIHRlc3RRdWVy\neVRpbWVvdXQ0KCkgZXhjZXB0aW9uID0gIiArIGUpOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKChlbSAhPSBu\ndWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAgICAgZW0uY2xv\nc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDogNSkgU2V0dGluZyB0aW1l\nb3V0IHRvIDwgLTEgc2hvdWxkIHRocm93IGFuCiAgICAgKiBJbGxlZ2FsQXJn\ndW1lbnRFeHBlY3Rpb24KICAgICAqIEV4cGVjdGVkIFJlc3VsdHM6IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0\nZXN0UXVlcnlUaW1lb3V0NSgpIHsKICAgICAgICBJbnRlZ2VyIHNldFRpbWUg\nPSBuZXcgSW50ZWdlcigtMjAwMCk7CiAgICAgICAgZ2V0TG9nKCkudHJhY2Uo\nInRlc3RRdWVyeVRpbWVvdXQ1KCkgLSBzZXRIaW50KCIgKyBzZXRUaW1lICsg\nIikiKTsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5h\nZ2VyKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwogICAgICAg\nICAgICBRdWVyeSBxID0gZW0uY3JlYXRlTmFtZWRRdWVyeSgiTm9IaW50U2lu\nZ2xlIik7CgogICAgICAgICAgICAvLyB2ZXJpZnkgbm8gZGVmYXVsdCBqYXZh\neC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0IGlzIHN1cHBsaWVkCiAgICAg\nICAgICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gaGludHMgPSBxLmdldEhpbnRz\nKCk7CiAgICAgICAgICAgIGFzc2VydEZhbHNlKGhpbnRzLmNvbnRhaW5zS2V5\nKCJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0IikpOwoKICAgICAg\nICAgICAgLy8gdXBkYXRlIHRoZSB0aW1lb3V0IHZhbHVlIHRvIC0yMDAwIGFu\nZCB2ZXJpZnkgaXQgd2FzIHNldAogICAgICAgICAgICBnZXRMb2coKS50cmFj\nZSgidGVzdFF1ZXJ5VGltZW91dDUoKSAtIFNldHRpbmcgaGludCAiICsKICAg\nICAgICAgICAgICAgICJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0\nPSIKICAgICAgICAgICAgICAgICsgc2V0VGltZSk7CiAgICAgICAgICAgIHEu\nc2V0SGludCgiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIsIHNl\ndFRpbWUpOwogICAgICAgICAgICBmYWlsKCJFeHBlY3RlZCB0ZXN0UXVlcnlU\naW1lb3V0NSgpIHRvIHRocm93IGEgIiArIAogICAgICAgICAgICAgICAgIkls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGV4cGVjdGVkIC0gc2V0SGlu\ndCgtMjAwMCkgc2hvdWxkIGNhdXNlIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbgogICAgICAgICAgICBjaGVja0V4Y2VwdGlvbigidGVzdFF1ZXJ5VGltZW91\ndDUoKSIsIGUsIAogICAgICAgICAgICAgICAgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uLmNsYXNzLCAiaW52YWxpZCB0aW1lb3V0IG9mICIKICAgICAgICAg\nICAgICAgICsgTnVtYmVyRm9ybWF0LmdldEludGVnZXJJbnN0YW5jZSgpLmZv\ncm1hdChzZXRUaW1lKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgaWYgKChlbSAhPSBudWxsKSAmJiBlbS5pc09wZW4oKSkgewogICAgICAg\nICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFNjZW5hcmlvIGJlaW5nIHRlc3RlZDog\nNikgUFUgUXVlcnkgdGltZW91dCBoaW50cyBkbyBub3QgYWZmZWN0IEVNCiAg\nICAgKiBvcGVyYXRpb25zIGxpa2UgdXBkYXRpbmcgRW50aXRpZXMgcmV0dXJu\nZWQgYnkgRU0uZmluZCgpL2ZpbmRBbGwoKQogICAgICogRXhwZWN0ZWQgUmVz\ndWx0czogVGhlIERFTEFZIGZ1bmN0aW9uIGlzIGJlaW5nIGNhbGxlZCBhbmQg\ndGhlIHVwZGF0ZQogICAgICogdGFrZXMgMjAwMCsgbXNlY3MgdG8gY29tcGxl\ndGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RRdWVyeVRpbWVvdXQ2\nKCkgewogICAgICAgIGlmIChza2lwVGVzdHMpIHsKICAgICAgICAgICAgZ2V0\nTG9nKCkudHJhY2UoInRlc3RRdWVyeVRpbWVvdXQ2IC0gdGVzdCBpcyAiICsK\nICAgICAgICAgICAgICAgICJiZWluZyBza2lwcGVkIGZvciAiICsgZGljdC5w\nbGF0Zm9ybSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAg\nICAgZ2V0TG9nKCkudHJhY2UoInRlc3RRdWVyeVRpbWVvdXQ2KCkgLSBObyBF\nTS5maW5kKCkgdXBkYXRlIHRpbWVvdXQiKTsKICAgICAgICBPcGVuSlBBRW50\naXR5TWFuYWdlckZhY3RvcnkgZW1mID0gbnVsbDsKICAgICAgICBPcGVuSlBB\nRW50aXR5TWFuYWdlciBlbSA9IG51bGw7CiAgICAgICAgSW50ZWdlciBzZXRU\naW1lID0gbmV3IEludGVnZXIoMTAwMCk7CiAgICAgICAgCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gY3JlYXRlIG91ciBFTUYgd2l0aCBvdXIgUFUg\nc2V0IHRpbWVvdXQgcHJvcGVydHkKICAgICAgICAgICAgZW1mID0gT3BlbkpQ\nQVBlcnNpc3RlbmNlLmNyZWF0ZUVudGl0eU1hbmFnZXJGYWN0b3J5KAogICAg\nICAgICAgICAgICAgInF0aW1lb3V0LTEwMDBtc2VjcyIsICJwZXJzaXN0ZW5j\nZTMueG1sIik7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoZW1mKTsKICAg\nICAgICAgICAgLy8gdmVyaWZ5IFBVIHByb3BlcnRpZXMgdXBkYXRlZCB0aGUg\nY29uZmlnCiAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYg\nPSBlbWYuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBhc3NlcnRO\nb3ROdWxsKGNvbmYpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoIlBVIHBy\nb3ZpZGVkIHRpbWVvdXQiLCBzZXRUaW1lLmludFZhbHVlKCksCiAgICAgICAg\nICAgICAgICBjb25mLmdldFF1ZXJ5VGltZW91dCgpKTsKICAgICAgICAgICAg\nLy8gY3JlYXRlIEVNCiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChlbSk7Cgog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbG9uZyBzdGFydFRp\nbWUgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAg\nICAgIFFUaW1lb3V0IHF0ID0gZW0uZmluZChRVGltZW91dC5jbGFzcywgbmV3\nIEludGVnZXIoMSkpOwogICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rp\nb24oKS5iZWdpbigpOwogICAgICAgICAgICAgICAgcXQuc2V0U3RyaW5nRmll\nbGQoInVwZGF0ZWQiKTsKICAgICAgICAgICAgICAgIGVtLmZsdXNoKCk7CiAg\nICAgICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwog\nICAgICAgICAgICAgICAgbG9uZyBlbmRUaW1lID0gU3lzdGVtLmN1cnJlbnRU\naW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBsb25nIHJ1blRpbWUgPSBl\nbmRUaW1lIC0gc3RhcnRUaW1lOwogICAgICAgICAgICAgICAgZ2V0TG9nKCku\ndHJhY2UoInRlc3RRdWVyeVRpbWVvdXQ2KCkgLSBFTSBmaW5kL3VwZGF0ZSBy\ndW5UaW1lIiArCiAgICAgICAgICAgICAgICAgICAgIiBtc2Vjcz0iICsgcnVu\nVGltZSk7CiAgICAgICAgICAgICAgICAvLyBIYWNrIC0gV2luZG93cyBzb21l\ndGltZXMgcmV0dXJucyAxOTk5IGluc3RlYWQgb2YgMjAwMCsKICAgICAgICAg\nICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBoYXZlIHRha2VuIDIrIHNlY3Ms\nIGJ1dCB3YXMgbXNlY3M9IiArCiAgICAgICAgICAgICAgICAgICAgcnVuVGlt\nZSwgcnVuVGltZSA+IDE5MDApOwogICAgICAgICAgICAgICAgZW0uY2xlYXIo\nKTsKICAgICAgICAgICAgICAgIHF0ID0gZW0uZmluZChRVGltZW91dC5jbGFz\ncywgbmV3IEludGVnZXIoMSkpOwogICAgICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJWZXJpZnkgdGhlIGVudGl0eSB3YXMgdXBkYXRlZC4iLAogICAgICAg\nICAgICAgICAgICAgIHF0LmdldFN0cmluZ0ZpZWxkKCksICJ1cGRhdGVkIik7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICAvLyBzZXR0aW5nIGEgdGltZW91dCBwcm9wZXJ0eSB2aWEgUFUg\nb3IgTWFwIHNob3VsZG4ndCBjYXVzZSBhCiAgICAgICAgICAgICAgICAvLyB0\naW1lb3V0IGV4Y2VwdGlvbgogICAgICAgICAgICAgICAgZmFpbCgiVW5leHBl\nY3RlZCB0ZXN0UXVlcnlUaW1lb3V0NigpIGV4Y2VwdGlvbiA9ICIgKyBlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmICgoZW0gIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAg\nICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgCiAgICAvKioKICAgICAqIEludGVybmFsIHNldHVwIGNvbnZl\nbmllbmNlIG1ldGhvZCB0byBjcmVhdGUgc29tZSBlbnRpdGllcyBmb3IgdGVz\ndGluZwogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0dXBDcmVhdGVFbnRp\ndGllcygpIHsKICAgICAgICBnZXRMb2coKS50cmFjZSgic2V0dXBDcmVhdGVF\nbnRpdGllcygpIik7CiAgICAgICAgU3RyaW5nW10gX3N0cmluZ3MgPSBuZXcg\nU3RyaW5nW10geyAiYSIsICJiIiwgImMiIH07CiAgICAgICAgUVRpbWVvdXQg\ncXQgPSBudWxsOwogICAgICAgIEVudGl0eU1hbmFnZXIgZW0gPSBudWxsOwoK\nICAgICAgICAvLyBjcmVhdGUgc29tZSBpbml0aWFsIGVudGl0aWVzCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKGVtKTsKICAgICAg\nICAgICAgZ2V0TG9nKCkudHJhY2UoInNldHVwQ3JlYXRlRW50aXRpZXMoKSAt\nIGNyZWF0aW5nIDMgUXRpbWVvdXQiKTsKICAgICAgICAgICAgZW0uZ2V0VHJh\nbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9zdHJpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBxdCA9IG5ldyBRVGltZW91dChpLCBfc3RyaW5nc1tpXSk7CiAgICAgICAg\nICAgICAgICBlbS5wZXJzaXN0KHF0KTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGZhaWwoInNldHVw\nQ3JlYXRlRW50aXRpZXMoKSAtIFVuZXhwZWN0ZWQgRXhjZXB0aW9uIC0gIiAr\nIGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICgoZW0g\nIT0gbnVsbCkgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAgICAgICAgIGVt\nLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogQ3JlYXRlIGRlbGF5IGZ1bmN0aW9uIG9ubHkgb24g\nRGVyYnksIG90aGVyIERCcyByZXF1aXJlIG1hbnVhbCBzZXR1cAogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgc2V0dXBDcmVhdGVEQkZ1bmN0aW9uKCkgewog\nICAgICAgIGlmIChkaWN0IGluc3RhbmNlb2YgRGVyYnlEaWN0aW9uYXJ5KSB7\nCiAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJzZXR1cENyZWF0ZURCRnVu\nY3Rpb24oKSIpOwogICAgICAgICAgICAvLyByZW1vdmUgZXhpc3RpbmcgZnVu\nY3Rpb24gaWYgaXQgZXhpc3RzIGFuZCByZWNyZWF0ZQogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgZXhlYyh0cnVlLCAwLCAiRFJPUCBGVU5D\nVElPTiBERUxBWSIpOwogICAgICAgICAgICAgICAgZXhlYyhmYWxzZSwgMCwg\nIkNSRUFURSBGVU5DVElPTiBERUxBWShTRUNPTkRTIElOVEVHRVIsICIgKyAK\nICAgICAgICAgICAgICAgICAgICAiVkFMVUUgSU5URUdFUikgUkVUVVJOUyBJ\nTlRFR0VSIFBBUkFNRVRFUiBTVFlMRSBKQVZBICIgKwogICAgICAgICAgICAg\nICAgICAgICJOTyBTUUwgTEFOR1VBR0UgSkFWQSBFWFRFUk5BTCBOQU1FICIg\nKwogICAgICAgICAgICAgICAgICAgICInb3JnLmFwYWNoZS5vcGVuanBhLnBl\ncnNpc3RlbmNlLiIgKwogICAgICAgICAgICAgICAgICAgICJxdWVyeS5UZXN0\nUXVlcnlUaW1lb3V0LmRlbGF5JyIpOwogICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc3FlKSB7CiAgICAgICAgICAgICAgICBmYWlsKHNxZS50\nb1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGdldExvZygpLnRyYWNlKCJzZXR1cENyZWF0ZURCRnVuY3Rp\nb24oKSAtIHNraXBwaW5nIGFzIERCICE9IERlcmJ5Iik7CiAgICAgICAgfQog\nICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSB0cmlnZ2VycyBvbiBh\nbGwgREJzCiAgICAgKiBAcGFyYW0gZGljdAogICAgICogQHJldHVybiBib29s\nZWFuIC0gdHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNldHVwQ3JlYXRlREJUcmlnZ2Vy\ncygpIHsKICAgICAgICBib29sZWFuIGJyYyA9IGZhbHNlOwogICAgICAgIGdl\ndExvZygpLnRyYWNlKCJzZXR1cENyZWF0ZURCVHJpZ2dlcnMoKSIpOwogICAg\nICAgIC8vIGNyZWF0ZSB0cmlnZ2VycyBvbiBhbGwgREJzCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKChkaWN0IGluc3RhbmNlb2YgRGVyYnlEaWN0\naW9uYXJ5KSB8fAogICAgICAgICAgICAgICAgKGRpY3QgaW5zdGFuY2VvZiBE\nQjJEaWN0aW9uYXJ5KSkgewogICAgICAgICAgICAgICAgZ2V0TG9nKCkudHJh\nY2UoInNldHVwQ3JlYXRlREJUcmlnZ2VycygpIC0gY3JlYXRpbmcgQkVGT1JF\nICIgKwogICAgICAgICAgICAgICAgICAgICJUUklHR0VSIGZvciBEZXJieSBh\nbmQgREIyIik7CiAgICAgICAgICAgICAgICBleGVjKHRydWUsIDAsICJEUk9Q\nIFRSSUdHRVIgdDEiKTsKICAgICAgICAgICAgICAgIC8vIERCMiBuZWVkcyBt\ndWx0aXBsZSBjb25uZWN0aW9ucyBhbmQgbG9uZ2VyIGRlbGF5cyB0byB0aW1l\nb3V0CiAgICAgICAgICAgICAgICBleGVjKGZhbHNlLCAwLCAiQ1JFQVRFIFRS\nSUdHRVIgdDEgTk8gQ0FTQ0FERSBCRUZPUkUgVVBEQVRFICIgKwogICAgICAg\nICAgICAgICAgICAgICJPTiBxdGltZW91dCBGT1IgRUFDSCBST1cgTU9ERSBE\nQjJTUUwgdmFsdWVzIERFTEFZKDIsLTEpIik7CiAgICAgICAgICAgICAgICAv\nLyBleGVjKHRydWUsIDAsICJEUk9QIFRSSUdHRVIgdDIiKTsKICAgICAgICAg\nICAgICAgIC8vIGV4ZWMoZmFsc2UsIDAsICJDUkVBVEUgVFJJR0dFUiB0MiBO\nTyBDQVNDQURFIEJFRk9SRSAiICsKICAgICAgICAgICAgICAgIC8vICAgICAi\nSU5TRVJUIE9OIHF0aW1lb3V0IEZPUiBFQUNIIFJPVyBNT0RFIERCMlNRTCAi\nICsKICAgICAgICAgICAgICAgIC8vICAgICAidmFsdWVzIERFTEFZKDIsLTIp\nIik7CiAgICAgICAgICAgICAgICAvLyBEb24ndCBpbmNsdWRlIGEgREVMRVRF\nIHRyaWdnZXIgLSBzbG93cyBkb3duIHRoZSBEUk9QX1RBQkxFUwogICAgICAg\nICAgICAgICAgLy8gY2xlYW51cCBiZXR3ZWVuIHRlc3RzCiAgICAgICAgICAg\nICAgICAvLyBleGVjKGZhbHNlLCAwLCAiQ1JFQVRFIFRSSUdHRVIgdDMgTk8g\nQ0FTQ0FERSBCRUZPUkUgREVMRVRFICIrCiAgICAgICAgICAgICAgICAvLyAg\nICJPTiBxdGltZW91dCBGT1IgRUFDSCBST1cgTU9ERSBEQjJTUUwgdmFsdWVz\nIERFTEFZKDIsLTMpIik7CiAgICAgICAgICAgICAgICBicmMgPSB0cnVlOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKGRpY3QgaW5zdGFuY2VvZiBTUUxTZXJ2\nZXJEaWN0aW9uYXJ5KSB7CiAgICAgICAgICAgICAgICAvLyBUaGVzZSBtYXkg\naGF2ZSBhbHJlYWR5IGJlZW4gY3JlYXRlZCBieSB0aGUgRERMCiAgICAgICAg\nICAgICAgICBnZXRMb2coKS50cmFjZSgic2V0dXBDcmVhdGVEQlRyaWdnZXJz\nKCkgLSBjcmVhdGluZyBCRUZPUkUgIiArCiAgICAgICAgICAgICAgICAgICAg\nIlVQREFURSBUUklHR0VSIGZvciBNUyBTUUwgU2VydmVyIik7CiAgICAgICAg\nICAgICAgICBleGVjKHRydWUsIDAsICJEUk9QIFRSSUdHRVIgdDEiKTsKICAg\nICAgICAgICAgICAgIGV4ZWMoZmFsc2UsIDAsICJDUkVBVEUgVFJJR0dFUiB0\nMSBPTiBRVGltZW91dCBGT1IgVVBEQVRFICIgKwogICAgICAgICAgICAgICAg\nICAgICJBUyBFWFRFUk5BTCBOQU1FIERlbGF5LkRlbGF5LmRlbGF5Iik7CiAg\nICAgICAgICAgICAgICAvLyBleGVjKHRydWUsIDAsICJEUk9QIFRSSUdHRVIg\ndDIiKTsKICAgICAgICAgICAgICAgIC8vIGV4ZWMoZmFsc2UsIDAsICJDUkVB\nVEUgT1IgUkVQTEFDRSBUUklHR0VSIHQyIE9OIFFUaW1lb3V0ICIgKwogICAg\nICAgICAgICAgICAgLy8gICAgICJGT1IgSU5TRVJUIEFTIEVYVEVSTkFMIE5B\nTUUgRGVsYXkuRGVsYXkuZGVsYXkiKTsKICAgICAgICAgICAgICAgIGJyYyA9\nIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGljdCBpbnN0YW5jZW9m\nIE9yYWNsZURpY3Rpb25hcnkpIHsKICAgICAgICAgICAgICAgIC8vIFRoZXNl\nIG1heSBoYXZlIGFscmVhZHkgYmVlbiBjcmVhdGVkIGJ5IHRoZSBEREwKICAg\nICAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJzZXR1cENyZWF0ZURCVHJp\nZ2dlcnMoKSAtIGNyZWF0aW5nIEJFRk9SRSAiICsKICAgICAgICAgICAgICAg\nICAgICAiVVBEQVRFIFRSSUdHRVIgZm9yIE9yYWNsZSIpOwogICAgICAgICAg\nICAgICAgZXhlYyhmYWxzZSwgMCwgIkNSRUFURSBPUiBSRVBMQUNFIFRSSUdH\nRVIgXCJPUEVOSlBBXCIuVDEgIiArCiAgICAgICAgICAgICAgICAgICAgIkJF\nRk9SRSBVUERBVEUgT0YgXCJJRFwiLCBcIlNUUklOR0ZJRUxEXCIsICIgKwog\nICAgICAgICAgICAgICAgICAgICJcIlZFUlNJT05GSUVMRFwiIE9OIFwiT1BF\nTkpQQVwiLlwiUVRJTUVPVVRcIiBDQUxMIERFTEFZIik7CiAgICAgICAgICAg\nICAgICAvLyBleGVjKGZhbHNlLCAwLCAiQ1JFQVRFIE9SIFJFUExBQ0UgVFJJ\nR0dFUiBcIk9QRU5KUEFcIi5UMiAiICsKICAgICAgICAgICAgICAgIC8vICAg\nICAiQkVGT1JFIElOU0VSVCBPTiBcIk9QRU5KUEFcIi5cIlFUSU1FT1VUXCIg\nQ0FMTCBERUxBWSIpOwogICAgICAgICAgICAgICAgYnJjID0gdHJ1ZTsKICAg\nICAgICAgICAgfSBlbHNlIGlmIChkaWN0IGluc3RhbmNlb2YgSW5mb3JtaXhE\naWN0aW9uYXJ5KSB7CiAgICAgICAgICAgICAgICAvLyBUaGVzZSBtYXkgaGF2\nZSBhbHJlYWR5IGJlZW4gY3JlYXRlZCBieSB0aGUgRERMCiAgICAgICAgICAg\nICAgICBnZXRMb2coKS50cmFjZSgic2V0dXBDcmVhdGVEQlRyaWdnZXJzKCkg\nLSBjcmVhdGluZyBCRUZPUkUgIiArCiAgICAgICAgICAgICAgICAgICAgIlVQ\nREFURSBUUklHR0VSIGZvciBJbmZvcm1peCIpOwogICAgICAgICAgICAgICAg\nZXhlYyh0cnVlLCAwLCAiRFJPUCBUUklHR0VSIHQxIik7CiAgICAgICAgICAg\nICAgICAvLyBleGVjKGZhbHNlLCAwLCAiQ1JFQVRFIFRSSUdHRVIgdDEgVVBE\nQVRFICIgKwogICAgICAgICAgICAgICAgLy8gICAgICJvZiBJZCwgc3RyaW5n\nRmllbGQsIHZlcnNpb25GaWVsZCBPTiBRVGltZW91dCAiICsKICAgICAgICAg\nICAgICAgIC8vICAgICAiQkVGT1JFKEVYRUNVVEUgRlVOQ1RJT04gZGVsYXko\nNSwtMSkpIik7CiAgICAgICAgICAgICAgICBleGVjKGZhbHNlLCAwLCAiQ1JF\nQVRFIFRSSUdHRVIgdDEgVVBEQVRFICIgKwogICAgICAgICAgICAgICAgICAg\nICJvZiBJZCwgc3RyaW5nRmllbGQsIHZlcnNpb25GaWVsZCBPTiBRVGltZW91\ndCAiICsKICAgICAgICAgICAgICAgICAgICAiQkVGT1JFKEVYRUNVVEUgUFJP\nQ0VEVVJFIGRlbGF5NSgpKSIpOwogICAgICAgICAgICAgICAgYnJjID0gdHJ1\nZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdldExv\nZygpLmluZm8oIlRlc3RRdWVyeVRpbWVvdXQgdGVzdHMgYXJlIGJlaW5nIHNr\naXBwZWQgYXMgIiArCiAgICAgICAgICAgICAgICAgICAgInRyaWdnZXJzIHdl\ncmUgbm90IGNyZWF0ZWQgZm9yICIgKyBkaWN0LnBsYXRmb3JtKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzcWUpIHsK\nICAgICAgICAgICAgaWYgKGRpY3QgaW5zdGFuY2VvZiBEZXJieURpY3Rpb25h\ncnkpIHsKICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBmYWlsIGlmIHdlIGNv\ndWxkbid0IGNyZWF0ZSB0cmlnZ2VycyBpbiBEZXJieQogICAgICAgICAgICAg\nICAgZmFpbChzcWUudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAvLyBqdXN0IGRpc2FibGUgdGVzdHMgZm9yIG90\naGVyIERCcwogICAgICAgICAgICAgICAgZ2V0TG9nKCkuaW5mbygiVGVzdFF1\nZXJ5VGltZW91dCB0ZXN0cyBhcmUgYmVpbmcgc2tpcHBlZCwgIiArCiAgICAg\nICAgICAgICAgICAgICAgImR1ZSB0byBEQiBkZWxheSgpIGZ1bmN0aW9uIG1p\nc3NpbmcgYW5kL29yIHByb2JsZW1zICIgKwogICAgICAgICAgICAgICAgICAg\nICJjcmVhdGluZyB0aGUgcmVxdWlyZWQgdHJpZ2dlcnMuICAiICsgZGljdC5w\nbGF0Zm9ybSArCiAgICAgICAgICAgICAgICAgICAgIiByZXF1aXJlcyBtYW51\nYWwgc2V0dXAgc3RlcHMgZm9yIHRoZXNlIHRlc3RzLiIpOwogICAgICAgICAg\nICAgICAgZ2V0TG9nKCkudHJhY2UoInNldHVwQ3JlYXRlREJUcmlnZ2Vycygp\nIGZhaWxlZCB3aXRoICIgKwogICAgICAgICAgICAgICAgICAgICJTUUxFeGNl\ncHRpb24gPSAiLCBzcWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBicmM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogSW50\nZXJuYWwgY29udmVuaWVuY2UgbWV0aG9kIHRvIGV4ZWN1dGUgU1FMIHN0YXRl\nbWVudHMKICAgICAqIAogICAgICogQHBhcmFtIGVtCiAgICAgKiBAcGFyYW0g\nc3FsCiAgICAgKiBAcGFyYW0gdGltZW91dFNlY3MKICAgICAqIEBwYXJhbSBm\nYWlsCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBleGVjKGJvb2xlYW4gaWdu\nb3JlRXhjZXB0aW9ucywgaW50IHRpbWVvdXRTZWNzLCBTdHJpbmcgc3FsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEVudGl0eU1h\nbmFnZXIgZW0gPSBudWxsOwogICAgICAgIFN0YXRlbWVudCBzID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoZW0pOwog\nICAgICAgICAgICBCcm9rZXIgYnJva2VyID0gSlBBRmFjYWRlSGVscGVyLnRv\nQnJva2VyKGVtKTsKICAgICAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gKENv\nbm5lY3Rpb24pIGJyb2tlci5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAg\nIHMgPSBjb25uLmNyZWF0ZVN0YXRlbWVudCgpOwogICAgICAgICAgICBpZiAo\ndGltZW91dFNlY3MgPiAwKSB7CiAgICAgICAgICAgICAgICBzLnNldFF1ZXJ5\nVGltZW91dCh0aW1lb3V0U2Vjcyk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZ2V0TG9nKCkudHJhY2UoImV4ZWN1dGUoIiArIHNxbCArICIpIik7CiAg\nICAgICAgICAgIHMuZXhlY3V0ZShzcWwpOwogICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzcWUpIHsKICAgICAgICAgICAgaWYgKCFpZ25vcmVFeGNl\ncHRpb25zKSB7CiAgICAgICAgICAgICAgICAvLyBmYWlsKHNxZS50b1N0cmlu\nZygpKTsKICAgICAgICAgICAgICAgIHRocm93IHNxZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChzICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGVt\nICE9IG51bGwpICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAgICBl\nbS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogSW50ZXJuYWwgY29udmVuaWVuY2UgbWV0aG9kIGZvciBj\naGVja2luZyB0aGF0IHRoZSBnaXZlbiBFeGNlcHRpb24gbWF0Y2hlcwogICAg\nICogdGhlIGV4cGVjdGVkIHR5cGUgZm9yIGEgZ2l2ZW4gREIgcGxhdGZvcm0u\nCiAgICAgKiAKICAgICAqIEBwYXJhbSB0ZXN0CiAgICAgKiBAcGFyYW0gZQog\nICAgICogQHJldHVybiBib29sZWFuIGluZGljYXRpbmcgaWYgb3BlcmF0aW9u\nIGNhbiBiZSByZXRyaWVkCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBj\naGVja0V4Y2VwdGlvbihTdHJpbmcgdGVzdCwgRXhjZXB0aW9uIGUpIHsKICAg\nICAgICBTdHJpbmcgZVN0ciA9IG5ldyBTdHJpbmcoInF1ZXJ5IHN0YXRlbWVu\ndCB0aW1lb3V0Iik7CiAgICAgICAgYm9vbGVhbiBiUmV0cnkgPSBtYXRjaGVz\nRXhwZWN0ZWRFeGNlcHRpb24oUXVlcnlUaW1lb3V0RXhjZXB0aW9uLmNsYXNz\nLAogICAgICAgICAgICBlLCBlU3RyKTsKICAgICAgICBib29sZWFuIGJSb2xs\nYmFjayA9IG1hdGNoZXNFeHBlY3RlZEV4Y2VwdGlvbihQZXJzaXN0ZW5jZUV4\nY2VwdGlvbi5jbGFzcywKICAgICAgICAgICAgZSwgZVN0cik7CiAgICAgICAg\nLy8gbm8gZWFzeSB3YXkgdG8gZGV0ZXJtaW5lIGV4YWN0IEV4Y2VwdGlvbiB0\neXBlIGZvciBhbGwgREJzCiAgICAgICAgYXNzZXJ0VHJ1ZSh0ZXN0ICsgIiAt\nIFVORVhQRUNURUQgRXhjZXB0aW9uID0gIiArIGUsCiAgICAgICAgICAgIChi\nUmV0cnkgfHwgYlJvbGxiYWNrKSk7CiAgICAgICAgZ2V0TG9nKCkudHJhY2Uo\ndGVzdCArICIgLSBDYXVnaHQgZXhwZWN0ZWQgRXhjZXB0aW9uID0gIiwgZSk7\nCiAgICAgICAgcmV0dXJuIGJSZXRyeTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEludGVybmFsIGNvbnZlbmllbmNlIG1ldGhvZCBmb3IgY2hlY2tpbmcgdGhh\ndCB0aGUgZ2l2ZW4gRXhjZXB0aW9uIG1hdGNoZXMKICAgICAqIHRoZSBleHBl\nY3RlZCB0eXBlLgogICAgICogCiAgICAgKiBAcGFyYW0gdGVzdCBjYXNlIG5h\nbWUKICAgICAqIEBwYXJhbSB0ZXN0ZWQgZXhjZXB0aW9uIHR5cGUKICAgICAq\nIEBwYXJhbSBleHBlY3RlZCBleGNlcHRpb24gdHlwZQogICAgICogQHBhcmFt\nIGVTdHIgYW4gb3B0aW9uYWwgc3Vic3RyaW5nIHRvIG1hdGNoIGluIHRoZSBl\neGNlcHRpb24gdGV4dAogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2hlY2tF\neGNlcHRpb24oU3RyaW5nIHRlc3QsIEV4Y2VwdGlvbiB0ZXN0ZWQsCiAgICAg\nICAgQ2xhc3M8Pz4gZXhwZWN0ZWQsIFN0cmluZyBlU3RyKSB7CiAgICAgICAg\nYXNzZXJ0VHJ1ZSh0ZXN0ICsgIiAtIFVORVhQRUNURUQgRXhjZXB0aW9uID0g\nIiArIHRlc3RlZCwKICAgICAgICAgICAgbWF0Y2hlc0V4cGVjdGVkRXhjZXB0\naW9uKGV4cGVjdGVkLCB0ZXN0ZWQsIGVTdHIpKTsKICAgICAgICBnZXRMb2co\nKS50cmFjZSh0ZXN0ICsgIiAtIENhdWdodCBleHBlY3RlZCBFeGNlcHRpb24g\nPSAiLCB0ZXN0ZWQpOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwg\nY29udmVuaWVuY2UgbWV0aG9kIGZvciBjaGVja2luZyB0aGF0IHRoZSBnaXZl\nbiBFeGNlcHRpb24gbWF0Y2hlcwogICAgICogdGhlIGV4cGVjdGVkIHR5cGUu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBleHBlY3RlZAogICAgICogQHBhcmFt\nIHRlc3RlZAogICAgICogQHBhcmFtIGVTdHIgYW4gb3B0aW9uYWwgc3Vic3Ry\naW5nIHRvIG1hdGNoIGluIHRoZSBleGNlcHRpb24gdGV4dAogICAgICogQHJl\ndHVybiB0cnVlIGlmIHRoZSBleGNlcHRpb24gbWF0Y2hlZCwgZmFsc2Ugb3Ro\nZXJ3aXNlCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBtYXRjaGVzRXhw\nZWN0ZWRFeGNlcHRpb24oQ2xhc3M8Pz4gZXhwZWN0ZWQsIAogICAgICAgIEV4\nY2VwdGlvbiB0ZXN0ZWQsIFN0cmluZyBlU3RyKSB7CiAgICAgICAgYXNzZXJ0\nTm90TnVsbChleHBlY3RlZCk7CiAgICAgICAgYm9vbGVhbiBleE1hdGNoZWQg\nPSBmYWxzZTsKICAgICAgICBpZiAodGVzdGVkICE9IG51bGwpIHsKICAgICAg\nICAgICAgQ2xhc3M8Pz4gdGVzdEV4Q2xhc3MgPSB0ZXN0ZWQuZ2V0Q2xhc3Mo\nKTsKICAgICAgICAgICAgZXhNYXRjaGVkID0gZXhwZWN0ZWQuaXNBc3NpZ25h\nYmxlRnJvbSh0ZXN0RXhDbGFzcyk7CiAgICAgICAgICAgIGlmIChleE1hdGNo\nZWQgJiYgZVN0ciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtYWtl\nIHN1cmUgaXQgaXMgb3VyIGV4cGVjdGVkIGV4Y2VwdGlvbiB0ZXh0IGZyb20K\nICAgICAgICAgICAgICAgIC8vIGxvY2FsaXplci5wcm9wZXJ0aWVzCiAgICAg\nICAgICAgICAgICBleE1hdGNoZWQgPSAodGVzdGVkLmdldE1lc3NhZ2UoKS5p\nbmRleE9mKGVTdHIpICE9IC0xKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZXhNYXRjaGVkOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhpcyBpcyB0aGUgdXNlci1kZWZpbmVkIERCIEZVTkNUSU9OIHdoaWNo\nIGlzIGNhbGxlZCBmcm9tIG91ciBxdWVyaWVzIHRvCiAgICAgKiBzbGVlcCBh\nbmQgY2F1c2UgdGltZW91dHMsIGJhc2VkIG9uIHNlY29uZHMuCiAgICAgKiAK\nICAgICAqIEBwYXJhbSBzZWNzCiAgICAgKiBAcGFyYW0gdmFsdWUKICAgICAq\nIEByZXR1cm4gdmFsdWUKICAgICAqIEB0aHJvd3MgU1FMRXhjZXB0aW9uCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgaW50IGRlbGF5KGludCBzZWNzLCBp\nbnQgdmFsdWUpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSAwKSB7\nCiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIiAgTmF0aXZl\nIFNRTCBjYWxsZWQgZGVsYXkoc2Vjcz0iICsgc2VjcyArIAogICAgICAgICAg\nICAgICAgIix2YWx1ZT0iICsgdmFsdWUgKyAiKSIpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCIg\nICBUcmlnZ2VyIGNhbGxlZCBkZWxheShzZWNzPSIgKyBzZWNzICsgCiAgICAg\nICAgICAgICAgICAiLHZhbHVlPSIgKyB2YWx1ZSArICIpIik7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgKi8KICAgICAgICAgICAgVGhyZWFkLnNsZWVw\nKHNlY3MgKiAxMDAwKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIElnbm9yZQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CgogICAgcHVibGljIHN0YXRp\nYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAgfQp9Cg==\n","encoding":"base64"}

