{"sha":"59cfbae55dbc1cafc44afb26afd1b816194baa2d","node_id":"MDQ6QmxvYjIwNjM2NDo1OWNmYmFlNTVkYmMxY2FmYzQ0YWZiMjZhZmQxYjgxNjE5NGJhYTJk","size":20117,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/59cfbae55dbc1cafc44afb26afd1b816194baa2d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuc2xpY2UuamRiYzsKCmltcG9y\ndCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuU1FMRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5MaXN0Owpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0\naWVzOwoKaW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwppbXBvcnQgamF2\nYXguc3FsLlhBRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0\naW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5EYXRhU291cmNlRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Cb29sZWFuVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvblByb3ZpZGVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLlBsdWdpblZhbHVlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLlN0cmluZ0xpc3RWYWx1\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5TdHJpbmdW\nYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWNv\ncmF0aW5nRGF0YVNvdXJjZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuamRiYy5EZWxlZ2F0aW5nRGF0YVNvdXJjZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIubG9nLkxvZ0ZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2dGYWN0b3J5SW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuc2xpY2UuRGlzdHJpYnV0ZWRCcm9rZXJJbXBsOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnNsaWNlLkRpc3RyaWJ1dGlvblBvbGlj\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5zbGljZS5Qcm9kdWN0RGVy\naXZhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5zbGljZS5SZXBs\naWNhdGlvblBvbGljeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5zbGlj\nZS5TbGljZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJF\neGNlcHRpb247CgovKioKICogSW1wbGVtZW50cyBhIGRpc3RyaWJ1dGVkIGNv\nbmZpZ3VyYXRpb24gb2YgSkRCQ1N0b3JlTWFuYWdlcnMuCiAqIFRoZSBvcmln\naW5hbCBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMgYXJlIGFuYWx5emVkIHRv\nIGNyZWF0ZSBhIHNldCBvZgogKiBTbGljZSBzcGVjaWZpYyBwcm9wZXJ0aWVz\nIHdpdGggZGVmYXVsdGluZyBydWxlcy4gCiAqIAogKiBAYXV0aG9yIFBpbmFr\naSBQb2RkYXIKICogCiAqLwpwdWJsaWMgY2xhc3MgRGlzdHJpYnV0ZWRKREJD\nQ29uZmlndXJhdGlvbkltcGwgZXh0ZW5kcyBKREJDQ29uZmlndXJhdGlvbklt\ncGwKICAgICAgICBpbXBsZW1lbnRzIERpc3RyaWJ1dGVkSkRCQ0NvbmZpZ3Vy\nYXRpb24gewoKICAgIHByaXZhdGUgZmluYWwgTGlzdDxTbGljZT4gX3NsaWNl\ncyA9IG5ldyBBcnJheUxpc3Q8U2xpY2U+KCk7CiAgICBwcml2YXRlIFNsaWNl\nIF9tYXN0ZXI7CiAgICAKICAgIHByaXZhdGUgRGlzdHJpYnV0ZWREYXRhU291\ncmNlIHZpcnR1YWxEYXRhU291cmNlOwogICAgCiAgICBwcm90ZWN0ZWQgQm9v\nbGVhblZhbHVlIGxlbmllbnRQbHVnaW47CiAgICBwcm90ZWN0ZWQgU3RyaW5n\nVmFsdWUgbWFzdGVyUGx1Z2luOwogICAgcHJvdGVjdGVkIFN0cmluZ0xpc3RW\nYWx1ZSBuYW1lc1BsdWdpbjsKICAgIHB1YmxpYyBQbHVnaW5WYWx1ZSBkaXN0\ncmlidXRpb25Qb2xpY3lQbHVnaW47CiAgICBwdWJsaWMgUGx1Z2luVmFsdWUg\ncmVwbGljYXRpb25Qb2xpY3lQbHVnaW47CiAgICAKICAgIHByb3RlY3RlZCBM\nb2cgbG9nOwogICAgcHJvdGVjdGVkIFN0cmluZyB1bml0OwogICAgCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBET1QgPSAiLiI7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIFN0cmluZyBSRUdFWF9ET1QgPSAiXFwuIjsKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFBSRUZJWF9TTElDRSA9IFBy\nb2R1Y3REZXJpdmF0aW9uLlBSRUZJWF9TTElDRSArIAogICAgCURPVDsKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFBSRUZJWF9PUEVOSlBBID0g\nIm9wZW5qcGEuIjsKICAgIHByaXZhdGUgc3RhdGljIExvY2FsaXplciBfbG9j\nID0KICAgICAgICAgICAgTG9jYWxpemVyLmZvclBhY2thZ2UoRGlzdHJpYnV0\nZWRKREJDQ29uZmlndXJhdGlvbkltcGwuY2xhc3MpOwoKICAgIC8qKgogICAg\nICogQ29uZmlndXJlIGl0c2VsZiBhcyB3ZWxsIGFzIHVuZGVybHlpbmcgc2xp\nY2VzLgogICAgICogCiAgICAgKi8KICAgIHB1YmxpYyBEaXN0cmlidXRlZEpE\nQkNDb25maWd1cmF0aW9uSW1wbChDb25maWd1cmF0aW9uUHJvdmlkZXIgY3Ap\nIHsKICAgICAgICBzdXBlcih0cnVlLCBmYWxzZSk7CiAgICAgICAgTWFwIHAg\nPSBjcC5nZXRQcm9wZXJ0aWVzKCk7CiAgICAgICAgbG9nID0gZ2V0Q29uZmln\ndXJhdGlvbkxvZygpOwogICAgICAgIHVuaXQgPSBnZXRQZXJzaXN0ZW5jZVVu\naXROYW1lKHApOwogICAgICAgIHNldERpYWdub3N0aWNDb250ZXh0KHRoaXMs\nIHVuaXQpOwogICAgICAgIAogICAgICAgIGJyb2tlclBsdWdpbi5zZXRTdHJp\nbmcoRGlzdHJpYnV0ZWRCcm9rZXJJbXBsLmNsYXNzLmdldE5hbWUoKSk7CiAg\nICAgICAgCiAgICAgICAgZGlzdHJpYnV0aW9uUG9saWN5UGx1Z2luID0gYWRk\nUGx1Z2luKAogICAgICAgICAgICBQUkVGSVhfU0xJQ0UgKyAiRGlzdHJpYnV0\naW9uUG9saWN5IiwgdHJ1ZSk7CiAgICAgICAgZGlzdHJpYnV0aW9uUG9saWN5\nUGx1Z2luLnNldEFsaWFzKCJyYW5kb20iLCAKICAgICAgICAJRGlzdHJpYnV0\naW9uUG9saWN5LkRlZmF1bHQuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICBk\naXN0cmlidXRpb25Qb2xpY3lQbHVnaW4uc2V0RGVmYXVsdCgicmFuZG9tIik7\nCiAgICAgICAgZGlzdHJpYnV0aW9uUG9saWN5UGx1Z2luLnNldER5bmFtaWMo\ndHJ1ZSk7CiAgICAgICAgCiAgICAgICAgcmVwbGljYXRpb25Qb2xpY3lQbHVn\naW4gPSBhZGRQbHVnaW4oCiAgICAgICAgICAgIFBSRUZJWF9TTElDRSArICJS\nZXBsaWNhdGlvblBvbGljeSIsIHRydWUpOwogICAgICAgIHJlcGxpY2F0aW9u\nUG9saWN5UGx1Z2luLnNldEFsaWFzKCJhbGwiLCAKICAgICAgICAgICAgUmVw\nbGljYXRpb25Qb2xpY3kuRGVmYXVsdC5jbGFzcy5nZXROYW1lKCkpOwogICAg\nICAgIHJlcGxpY2F0aW9uUG9saWN5UGx1Z2luLnNldERlZmF1bHQoImFsbCIp\nOwogICAgICAgIHJlcGxpY2F0aW9uUG9saWN5UGx1Z2luLnNldER5bmFtaWMo\ndHJ1ZSk7CiAgICAgICAgCiAgICAgICAgbGVuaWVudFBsdWdpbiA9IGFkZEJv\nb2xlYW4oUFJFRklYX1NMSUNFICsgIkxlbmllbnQiKTsKICAgICAgICAKICAg\nICAgICBtYXN0ZXJQbHVnaW4gPSBhZGRTdHJpbmcoUFJFRklYX1NMSUNFICsg\nIk1hc3RlciIpOwogICAgICAgIAogICAgICAgIG5hbWVzUGx1Z2luID0gYWRk\nU3RyaW5nTGlzdChQUkVGSVhfU0xJQ0UgKyAiTmFtZXMiKTsKICAgICAgICAK\nICAgICAgICBzZXRTbGljZXMocCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\nU3RyaW5nIGdldFBlcnNpc3RlbmNlVW5pdE5hbWUoTWFwIHApIHsKICAgICAg\nICBPYmplY3QgdW5pdCA9IHAuZ2V0KFBSRUZJWF9PUEVOSlBBICsgaWQuZ2V0\nUHJvcGVydHkoKSk7CiAgICAgICAgcmV0dXJuICh1bml0ID09IG51bGwpID8g\nIj8iIDogdW5pdC50b1N0cmluZygpOwogICAgfQogICAgCiAgICBwcml2YXRl\nIHZvaWQgc2V0RGlhZ25vc3RpY0NvbnRleHQoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgU3RyaW5nIHVuaXQpIHsKICAgICAgICBMb2dGYWN0b3J5IGxv\nZ0ZhY3RvcnkgPSBjb25mLmdldExvZ0ZhY3RvcnkoKTsKICAgICAgICBpZiAo\nbG9nRmFjdG9yeSBpbnN0YW5jZW9mIExvZ0ZhY3RvcnlJbXBsKSB7CiAgICAg\nICAgICAgICgoTG9nRmFjdG9yeUltcGwpbG9nRmFjdG9yeSkuc2V0RGlhZ25v\nc3RpY0NvbnRleHQodW5pdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogR2V0cyB0aGUgbmFtZSBvZiB0aGUgYWN0aXZlIHNsaWNlcy4KICAg\nICAqLwogICAgcHVibGljIExpc3Q8U3RyaW5nPiBnZXRBY3RpdmVTbGljZU5h\nbWVzKCkgewogICAgICAgIExpc3Q8U3RyaW5nPiByZXN1bHQgPSBuZXcgQXJy\nYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBmb3IgKFNsaWNlIHNsaWNlIDog\nX3NsaWNlcykgewogICAgICAgICAgIGlmIChzbGljZS5pc0FjdGl2ZSgpICYm\nICFyZXN1bHQuY29udGFpbnMoc2xpY2UuZ2V0TmFtZSgpKSkKICAgICAgICAg\nICAgICByZXN1bHQuYWRkKHNsaWNlLmdldE5hbWUoKSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogR2V0cyB0aGUgbmFtZSBvZiB0aGUgYXZhaWxhYmxlIHNsaWNlcy4KICAg\nICAqLwogICAgcHVibGljIExpc3Q8U3RyaW5nPiBnZXRBdmFpbGFibGVTbGlj\nZU5hbWVzKCkgewogICAgICAgIExpc3Q8U3RyaW5nPiByZXN1bHQgPSBuZXcg\nQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBmb3IgKFNsaWNlIHNsaWNl\nOl9zbGljZXMpCiAgICAgICAgICAgIHJlc3VsdC5hZGQoc2xpY2UuZ2V0TmFt\nZSgpKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEdldHMgdGhlIHNsaWNlcyBvZiBnaXZlbiBzdGF0dXMuIE51\nbGwgcmV0dXJucyBhbGwgaXJyZXNwZWN0aXZlIG9mIHN0YXR1cy4KICAgICAq\nLwogICAgcHVibGljIExpc3Q8U2xpY2U+IGdldFNsaWNlcyhTbGljZS5TdGF0\ndXMuLi5zdGF0dXNlcykgewogICAgICAgIGlmIChzdGF0dXNlcyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxl\nTGlzdChfc2xpY2VzKTsKICAgICAgICBMaXN0PFNsaWNlPiByZXN1bHQgPSBu\nZXcgQXJyYXlMaXN0PFNsaWNlPigpOwogICAgICAgIGZvciAoU2xpY2Ugc2xp\nY2U6X3NsaWNlcykgewogICAgICAgICAgICBmb3IgKFNsaWNlLlN0YXR1cyBz\ndGF0dXM6c3RhdHVzZXMpCiAgICAgICAgICAgICAgICBpZiAoc2xpY2UuZ2V0\nU3RhdHVzKCkuZXF1YWxzKHN0YXR1cykpCiAgICAgICAgICAgICAgICAgICAg\ncmVzdWx0LmFkZChzbGljZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\nZXN1bHQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0aGUgbWFz\ndGVyIHNsaWNlLiAKICAgICAqLwogICAgcHVibGljIFNsaWNlIGdldE1hc3Rl\ncigpIHsKICAgICAgICByZXR1cm4gX21hc3RlcjsKICAgIH0KCiAgICBwdWJs\naWMgU2xpY2UgZ2V0U2xpY2UoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1\ncm4gZ2V0U2xpY2UobmFtZSwgZmFsc2UpOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEdldCB0aGUgY29uZmlndXJhdGlvbiBmb3IgZ2l2ZW4gc2xpY2Uu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBtdXN0RXhpc3QgaWYgdHJ1ZSBhbiBl\neGNlcHRpb24gaWYgcmFpc2VkIGlmIHRoZSBnaXZlbiBzbGljZSBuYW1lCiAg\nICAgKiBpcyBub3QgYW4gYWN0aXZlIHNsaWNlLgogICAgICovCiAgICBwdWJs\naWMgU2xpY2UgZ2V0U2xpY2UoU3RyaW5nIG5hbWUsIGJvb2xlYW4gbXVzdEV4\naXN0KSB7CiAgICAgICAgZm9yIChTbGljZSBzbGljZTpfc2xpY2VzKQogICAg\nICAgICAgICBpZiAoc2xpY2UuZ2V0TmFtZSgpLmVxdWFscyhuYW1lKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBzbGljZTsKICAgICAgICBpZiAobXVzdEV4\naXN0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJzbGljZS1ub3QtZm91bmQiLCBuYW1lLAogICAgICAgICAgICAg\nICAgICAgIGdldEFjdGl2ZVNsaWNlTmFtZXMoKSkpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgRGlzdHJpYnV0\naW9uUG9saWN5IGdldERpc3RyaWJ1dGlvblBvbGljeUluc3RhbmNlKCkgewog\nICAgICAgIGlmIChkaXN0cmlidXRpb25Qb2xpY3lQbHVnaW4uZ2V0KCkgPT0g\nbnVsbCkgewogICAgICAgICAgICBkaXN0cmlidXRpb25Qb2xpY3lQbHVnaW4u\naW5zdGFudGlhdGUoRGlzdHJpYnV0aW9uUG9saWN5LmNsYXNzLAogICAgICAg\nICAgICAgICAgICAgIHRoaXMsIHRydWUpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gKERpc3RyaWJ1dGlvblBvbGljeSkgZGlzdHJpYnV0aW9uUG9saWN5\nUGx1Z2luLmdldCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndERpc3RyaWJ1dGlvblBvbGljeSgpIHsKICAgICAgICBpZiAoZGlzdHJpYnV0\naW9uUG9saWN5UGx1Z2luLmdldCgpID09IG51bGwpIHsKICAgICAgICAgICAg\nZGlzdHJpYnV0aW9uUG9saWN5UGx1Z2luLmluc3RhbnRpYXRlKERpc3RyaWJ1\ndGlvblBvbGljeS5jbGFzcywKICAgICAgICAgICAgICAgICAgICB0aGlzLCB0\ncnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRpc3RyaWJ1dGlvblBv\nbGljeVBsdWdpbi5nZXRTdHJpbmcoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXREaXN0cmlidXRpb25Qb2xpY3lJbnN0YW5jZShEaXN0cmlidXRpb25Q\nb2xpY3kgcG9saWN5KSB7CiAgICAgICAgZGlzdHJpYnV0aW9uUG9saWN5UGx1\nZ2luLnNldChwb2xpY3kpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBz\nZXREaXN0cmlidXRpb25Qb2xpY3koU3RyaW5nIHBvbGljeSkgewogICAgICAg\nIGRpc3RyaWJ1dGlvblBvbGljeVBsdWdpbi5zZXRTdHJpbmcocG9saWN5KTsK\nICAgIH0KCiAgICBwdWJsaWMgUmVwbGljYXRpb25Qb2xpY3kgZ2V0UmVwbGlj\nYXRpb25Qb2xpY3lJbnN0YW5jZSgpIHsKICAgICAgICBpZiAocmVwbGljYXRp\nb25Qb2xpY3lQbHVnaW4uZ2V0KCkgPT0gbnVsbCkgewogICAgICAgICAgICBy\nZXBsaWNhdGlvblBvbGljeVBsdWdpbi5pbnN0YW50aWF0ZShSZXBsaWNhdGlv\nblBvbGljeS5jbGFzcywKICAgICAgICAgICAgICAgICAgICB0aGlzLCB0cnVl\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChSZXBsaWNhdGlvblBvbGlj\neSkgcmVwbGljYXRpb25Qb2xpY3lQbHVnaW4uZ2V0KCk7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVwbGljYXRpb25Qb2xpY3koKSB7CiAg\nICAgICAgaWYgKHJlcGxpY2F0aW9uUG9saWN5UGx1Z2luLmdldCgpID09IG51\nbGwpIHsKICAgICAgICAgICAgcmVwbGljYXRpb25Qb2xpY3lQbHVnaW4uaW5z\ndGFudGlhdGUoUmVwbGljYXRpb25Qb2xpY3kuY2xhc3MsCiAgICAgICAgICAg\nICAgICAgICAgdGhpcywgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiByZXBsaWNhdGlvblBvbGljeVBsdWdpbi5nZXRTdHJpbmcoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRSZXBsaWNhdGlvblBvbGljeUluc3RhbmNl\nKFJlcGxpY2F0aW9uUG9saWN5IHBvbGljeSkgewogICAgICAgIHJlcGxpY2F0\naW9uUG9saWN5UGx1Z2luLnNldChwb2xpY3kpOwogICAgfQogICAgCiAgICBw\ndWJsaWMgdm9pZCBzZXRSZXBsaWNhdGlvblBvbGljeShTdHJpbmcgcG9saWN5\nKSB7CiAgICAgICAgcmVwbGljYXRpb25Qb2xpY3lQbHVnaW4uc2V0U3RyaW5n\nKHBvbGljeSk7CiAgICB9CgogICAgcHVibGljIERpc3RyaWJ1dGVkRGF0YVNv\ndXJjZSBnZXRDb25uZWN0aW9uRmFjdG9yeSgpIHsKICAgICAgICBpZiAodmly\ndHVhbERhdGFTb3VyY2UgPT0gbnVsbCkgewogICAgICAgICAgICB2aXJ0dWFs\nRGF0YVNvdXJjZSA9IGNyZWF0ZURpc3RyaWJ1dGVkRGF0YVN0b3JlKCk7CiAg\nICAgICAgICAgIERhdGFTb3VyY2VGYWN0b3J5Lmluc3RhbGxEQkRpY3Rpb25h\ncnkoCiAgICAgICAgICAgICAgICBnZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgp\nLCB2aXJ0dWFsRGF0YVNvdXJjZSwgdGhpcywgZmFsc2UpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdmlydHVhbERhdGFTb3VyY2U7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBib29sZWFuIGlzTGVuaWVudCgpIHsKICAgICAgICByZXR1\ncm4gbGVuaWVudFBsdWdpbi5nZXQoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIHZpcnR1YWwgRGlzdHJpYnV0ZWREYXRhU291cmNlIGFzIGEg\nY29tcG9zaXRlIG9mIGluZGl2aWR1YWwKICAgICAqIHNsaWNlcyBhcyBwZXIg\nY29uZmlndXJhdGlvbiwgb3B0aW9uYWxseSBpZ25vcmluZyBzbGljZXMgdGhh\ndCBjYW4gbm90IGJlCiAgICAgKiBjb25uZWN0ZWQuCiAgICAgKi8KICAgIHBy\naXZhdGUgRGlzdHJpYnV0ZWREYXRhU291cmNlIGNyZWF0ZURpc3RyaWJ1dGVk\nRGF0YVN0b3JlKCkgewogICAgICAgIExpc3Q8RGF0YVNvdXJjZT4gZGF0YVNv\ndXJjZXMgPSBuZXcgQXJyYXlMaXN0PERhdGFTb3VyY2U+KCk7CiAgICAgICAg\nYm9vbGVhbiBpc1hBID0gdHJ1ZTsKICAgICAgICBmb3IgKFNsaWNlIHNsaWNl\nIDogX3NsaWNlcykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgRGF0YVNvdXJjZSBkcyA9IGNyZWF0ZURhdGFTb3VyY2Uoc2xpY2UpOwog\nICAgICAgICAgICAgICAgZGF0YVNvdXJjZXMuYWRkKGRzKTsKICAgICAgICAg\nICAgICAgIGlzWEEgJj0gaXNYQUNvbXBsaWFudChkcyk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFRocm93YWJsZSBleCkgewogICAgICAgICAgICAgICAgaGFu\nZGxlQmFkQ29ubmVjdGlvbihpc0xlbmllbnQoKSwgc2xpY2UsIGV4KTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZGF0YVNvdXJjZXMu\naXNFbXB0eSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tc2xpY2UiKSk7CiAgICAgICAgRGlzdHJpYnV0ZWRE\nYXRhU291cmNlIHJlc3VsdCA9IG5ldyBEaXN0cmlidXRlZERhdGFTb3VyY2Uo\nZGF0YVNvdXJjZXMpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAg\nICAKICAgIERhdGFTb3VyY2UgY3JlYXRlRGF0YVNvdXJjZShTbGljZSBzbGlj\nZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgSkRCQ0NvbmZpZ3VyYXRp\nb24gY29uZiA9IChKREJDQ29uZmlndXJhdGlvbilzbGljZS5nZXRDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0Q29uZmlndXJh\ndGlvbkxvZygpOwogICAgICAgIFN0cmluZyB1cmwgPSBnZXRDb25uZWN0aW9u\nSW5mbyhjb25mKTsKICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkK\nICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInNsaWNlLWNvbm5lY3Qi\nLCBzbGljZSwgdXJsKSk7CiAgICAgICAgRGF0YVNvdXJjZSBkcyA9IERhdGFT\nb3VyY2VGYWN0b3J5Lm5ld0RhdGFTb3VyY2UoY29uZiwgZmFsc2UpOwogICAg\nICAgIERlY29yYXRpbmdEYXRhU291cmNlIGRkcyA9IERlY29yYXRpbmdEYXRh\nU291cmNlLgogICAgICAgICAgICAgICAgbmV3RGVjb3JhdGluZ0RhdGFTb3Vy\nY2UoZHMpOwogICAgICAgIGRzID0gRGF0YVNvdXJjZUZhY3RvcnkuaW5zdGFs\nbERCRGljdGlvbmFyeSgKICAgICAgICAgICAgICAgIGNvbmYuZ2V0REJEaWN0\naW9uYXJ5SW5zdGFuY2UoKSwgZGRzLCBjb25mLCBmYWxzZSk7CiAgICAgICAg\ndmVyaWZ5RGF0YVNvdXJjZShzbGljZSwgZHMsIGNvbmYpOwogICAgICAgIAog\nICAgICAgIHJldHVybiBkczsKICAgIH0KCiAgICBTdHJpbmcgZ2V0Q29ubmVj\ndGlvbkluZm8oT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAg\nIFN0cmluZyByZXN1bHQgPSBjb25mLmdldENvbm5lY3Rpb25VUkwoKTsKICAg\nICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgICAgcmVzdWx0\nID0gY29uZi5nZXRDb25uZWN0aW9uRHJpdmVyTmFtZSgpOwogICAgICAgICAg\nICBTdHJpbmcgcHJvcHMgPSBjb25mLmdldENvbm5lY3Rpb25Qcm9wZXJ0aWVz\nKCk7CiAgICAgICAgICAgIGlmIChwcm9wcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmVzdWx0ICs9ICIoIiArIHByb3BzICsgIikiOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGJvb2xlYW4gaXNY\nQUNvbXBsaWFudChEYXRhU291cmNlIGRzKSB7CiAgICAgICAgaWYgKGRzIGlu\nc3RhbmNlb2YgRGVsZWdhdGluZ0RhdGFTb3VyY2UpCiAgICAgICAgICAgIHJl\ndHVybiAoKERlbGVnYXRpbmdEYXRhU291cmNlKSBkcykuZ2V0SW5uZXJtb3N0\nRGVsZWdhdGUoKSAKICAgICAgICAgICAgICAgaW5zdGFuY2VvZiBYQURhdGFT\nb3VyY2U7CiAgICAgICAgcmV0dXJuIGRzIGluc3RhbmNlb2YgWEFEYXRhU291\ncmNlOwogICAgfQoKICAgIC8qKgogICAgICogVmVyaWZ5IHRoYXQgYSBjb25u\nZWN0aW9uIGNhbiBiZSBlc3RhYmxpc2hlZCB0byB0aGUgZ2l2ZW4gc2xpY2Uu\nIElmCiAgICAgKiBjb25uZWN0aW9uIGNhbiBub3QgYmUgZXN0YWJsaXNoZWQg\ndGhlbiBzbGljZSBpcyBzZXQgdG8gSU5BQ1RJVkUgc3RhdGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiB2ZXJpZnlEYXRhU291cmNlKFNsaWNlIHNs\naWNlLCBEYXRhU291cmNlIGRzLCAKICAgIAkJSkRCQ0NvbmZpZ3VyYXRpb24g\nY29uZikgewogICAgICAgIENvbm5lY3Rpb24gY29uID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBjb24gPSBkcy5nZXRDb25uZWN0aW9uKGNv\nbmYuZ2V0Q29ubmVjdGlvblVzZXJOYW1lKCksIAogICAgICAgICAgICAJCWNv\nbmYuZ2V0Q29ubmVjdGlvblBhc3N3b3JkKCkpOwogICAgICAgICAgICBzbGlj\nZS5zZXRTdGF0dXMoU2xpY2UuU3RhdHVzLkFDVElWRSk7CiAgICAgICAgICAg\nIGlmIChjb24gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2xpY2Uuc2V0\nU3RhdHVzKFNsaWNlLlN0YXR1cy5JTkFDVElWRSk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGV4KSB7\nCiAgICAgICAgICAgIHNsaWNlLnNldFN0YXR1cyhTbGljZS5TdGF0dXMuSU5B\nQ1RJVkUpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKGNvbiAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb24uY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBleCkg\newogICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZQogICAgICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVpdGhlciB0\naHJvdyBhIHVzZXIgZXhjZXB0aW9uIG9yIGFkZCB0aGUgY29uZmlndXJhdGlv\nbiB0byB0aGUgZ2l2ZW4gbGlzdCwKICAgICAqIGJhc2VkIG9uIDxjb2RlPmlz\nTGVuaWVudDwvY29kZT4uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYW5k\nbGVCYWRDb25uZWN0aW9uKGJvb2xlYW4gaXNMZW5pZW50LCBTbGljZSBzbGlj\nZSwKICAgICAgICAgICAgVGhyb3dhYmxlIGV4KSB7CiAgICAgICAgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiA9IHNsaWNlLmdldENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICBTdHJpbmcgdXJsID0gY29uZi5nZXRDb25uZWN0aW9uVVJM\nKCk7CiAgICAgICAgTG9nIGxvZyA9IGdldExvZyhMT0dfUlVOVElNRSk7CiAg\nICAgICAgaWYgKGlzTGVuaWVudCkgewogICAgICAgICAgICBpZiAoZXggIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInNs\naWNlLWNvbm5lY3Qta25vd24td2FybiIsIHNsaWNlLCB1cmwsIGV4CiAgICAg\nICAgICAgICAgICAgICAgICAgIC5nZXRDYXVzZSgpKSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgi\nc2xpY2UtY29ubmVjdC13YXJuIiwgc2xpY2UsIHVybCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBlbHNlIGlmIChleCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJzbGljZS1j\nb25uZWN0LWtub3duLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBzbGlj\nZSwgdXJsLCBleCksIGV4LmdldENhdXNlKCkpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJzbGljZS1jb25uZWN0LWVycm9yIiwgc2xpY2UsCiAgICAgICAgICAgICAg\nICAgICAgdXJsKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGluZGl2aWR1YWwgc2xpY2VzIHdpdGggY29uZmlndXJhdGlvbnMg\nZnJvbSB0aGUgZ2l2ZW4gcHJvcGVydGllcy4KICAgICAqLwogICAgdm9pZCBz\nZXRTbGljZXMoTWFwIG9yaWdpbmFsKSB7CiAgICAgICAgTGlzdDxTdHJpbmc+\nIHNsaWNlTmFtZXMgPSBmaW5kU2xpY2VzKG9yaWdpbmFsKTsKICAgICAgICBp\nZiAoc2xpY2VOYW1lcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInNsaWNlLW5vbmUtY29uZmln\ndXJlZCIpKTsKICAgICAgICB9IAogICAgICAgIGZvciAoU3RyaW5nIGtleSA6\nIHNsaWNlTmFtZXMpIHsKICAgICAgICAgICAgU2xpY2Ugc2xpY2UgPSBuZXdT\nbGljZShrZXksIG9yaWdpbmFsKTsKICAgICAgICAgICAgX3NsaWNlcy5hZGQo\nc2xpY2UpOwogICAgICAgIH0KICAgICAgICBzZXRNYXN0ZXIob3JpZ2luYWwp\nOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgU2xpY2UgbmV3U2xpY2UoU3Ry\naW5nIGtleSwgTWFwIG9yaWdpbmFsKSB7CiAgICAgICAgSkRCQ0NvbmZpZ3Vy\nYXRpb24gY2hpbGQgPSBuZXcgSkRCQ0NvbmZpZ3VyYXRpb25JbXBsKCk7CiAg\nICAgICAgY2hpbGQuZnJvbVByb3BlcnRpZXMoY3JlYXRlU2xpY2VQcm9wZXJ0\naWVzKG9yaWdpbmFsLCBrZXkpKTsKICAgICAgICBjaGlsZC5zZXRJZCh1bml0\nK0RPVCtrZXkpOwogICAgICAgIHNldERpYWdub3N0aWNDb250ZXh0KGNoaWxk\nLCB1bml0K0RPVCtrZXkpOwogICAgICAgIFNsaWNlIHNsaWNlID0gbmV3IFNs\naWNlKGtleSwgY2hpbGQpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJs\nZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzbGljZS1j\nb25maWd1cmF0aW9uIiwga2V5LCBjaGlsZAogICAgICAgICAgICAgICAgICAg\nIC50b1Byb3BlcnRpZXMoZmFsc2UpKSk7CiAgICAgICAgcmV0dXJuIHNsaWNl\nOwogICAgfQoKICAgIC8qKgogICAgICogRmluZHMgdGhlIHNsaWNlcy4gSWYg\nPGNvZGU+b3BlbmpwYS5zbGljZS5OYW1lczwvY29kZT4gcHJvcGVydHkgaXMg\nCiAgICAgKiBzcGVjaWZpZWQgdGhlbiB0aGUgc2xpY2VzIGFyZSBvcmRlcmVk\nIGluIHRoZSB3YXkgdGhleSBhcmUgbGlzdGVkLiAKICAgICAqIE90aGVyd2lz\nZSBzY2FucyBhbGwgYXZhaWxhYmxlIHNsaWNlcyBieSBsb29raW5nIGZvciBw\ncm9wZXJ0eSBvZiB0aGUgZm9ybQogICAgICogPGNvZGU+b3BlbmpwYS5zbGlj\nZS5YWVouYWJjPC9jb2RlPiB3aGVyZSA8Y29kZT5YWVo8L2NvZGU+IGlzIHRo\nZSBzbGljZQogICAgICogaWRlbnRpZmllciBhbmQgPGNvZGU+YWJjPC9jb2Rl\nPiBpcyBhbnkgb3BlbmpwYSBwcm9wZXJ0eSBuYW1lLiBUaGUgc2xpY2VzCiAg\nICAgKiBhcmUgdGhlbiBvcmRlcmVkIGFscGhhYmV0aWNhbGx5IGJ5IHRoZWly\nIGlkZW50aWZpZXIuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxTdHJpbmc+\nIGZpbmRTbGljZXMoTWFwIHApIHsKICAgICAgICBMaXN0PFN0cmluZz4gc2xp\nY2VOYW1lcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgIAog\nICAgICAgIExvZyBsb2cgPSBnZXRDb25maWd1cmF0aW9uTG9nKCk7CiAgICAg\nICAgU3RyaW5nIGtleSA9IG5hbWVzUGx1Z2luLmdldFByb3BlcnR5KCk7CiAg\nICAgICAgYm9vbGVhbiBleHBsaWNpdCA9IHAuY29udGFpbnNLZXkoa2V5KTsK\nICAgICAgICBpZiAoZXhwbGljaXQpIHsKICAgICAgICAgICAgU3RyaW5nW10g\ndmFsdWVzID0gcC5nZXQoa2V5KS50b1N0cmluZygpLnNwbGl0KCJcXCwiKTsK\nICAgICAgICAgICAgZm9yIChTdHJpbmcgbmFtZTp2YWx1ZXMpCiAgICAgICAg\nICAgICAgICBpZiAoIXNsaWNlTmFtZXMuY29udGFpbnMobmFtZS50cmltKCkp\nKQogICAgICAgICAgICAgICAgICAgIHNsaWNlTmFtZXMuYWRkKG5hbWUudHJp\nbSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2Mu\nZ2V0KCJuby1zbGljZS1uYW1lcyIsIGtleSkpOwogICAgICAgICAgICBzbGlj\nZU5hbWVzID0gc2NhbkZvclNsaWNlTmFtZXMocCk7CiAgICAgICAgICAgIENv\nbGxlY3Rpb25zLnNvcnQoc2xpY2VOYW1lcyk7CiAgICAgICAgfQogICAgICAg\nIGlmIChsb2cuaXNJbmZvRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZy5p\nbmZvKF9sb2MuZ2V0KCJzbGljZS1hdmFpbGFibGUiLCBzbGljZU5hbWVzKSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBzbGljZU5hbWVzOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIFNjYW4gdGhlIGdpdmVuIG1hcCBmb3Igc2xp\nY2Utc3BlY2lmaWMgcHJvcGVydHkgb2YgdGhlIGZvcm0gCiAgICAgKiA8Y29k\nZT5vcGVuanBhLnNsaWNlLlhZWi5hYmM8L2NvZGU+ICh3aGlsZSBpZ25vcmlu\nZyAKICAgICAqIDxjb2RlPm9wZW5qcGEuc2xpY2UuWFlaPC9jb2RlPiBhcyB0\naGV5IHJlZmVyIHRvIHNsaWNlLXdpZGUgcHJvcGVydHkpCiAgICAgKiB0byBk\nZXRlcm1pbmUgdGhlIG5hbWVzIG9mIGFsbCBhdmFpbGFibGUgc2xpY2VzLgog\nICAgICovCiAgICBwcml2YXRlIExpc3Q8U3RyaW5nPiBzY2FuRm9yU2xpY2VO\nYW1lcyhNYXAgcCkgewogICAgICAgIExpc3Q8U3RyaW5nPiBzbGljZU5hbWVz\nID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgZm9yIChPYmpl\nY3QgbyA6IHAua2V5U2V0KCkpIHsKICAgICAgICAgICAgU3RyaW5nIGtleSA9\nIG8udG9TdHJpbmcoKTsKICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRo\nKFBSRUZJWF9TTElDRSkgJiYgZ2V0UGFydENvdW50KGtleSkgPiAzKSB7CiAg\nICAgICAgICAgICAgICBTdHJpbmcgc2xpY2VOYW1lID0KICAgICAgICAgICAg\nICAgICAgICBjaG9wVGFpbChjaG9wSGVhZChvLnRvU3RyaW5nKCksIFBSRUZJ\nWF9TTElDRSksIERPVCk7CiAgICAgICAgICAgICAgICBpZiAoIXNsaWNlTmFt\nZXMuY29udGFpbnMoc2xpY2VOYW1lKSkKICAgICAgICAgICAgICAgICAgICBz\nbGljZU5hbWVzLmFkZChzbGljZU5hbWUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBzbGljZU5hbWVzOwogICAgfQoKICAgIHBy\naXZhdGUgc3RhdGljIGludCBnZXRQYXJ0Q291bnQoU3RyaW5nIHMpIHsKICAg\nICAgICByZXR1cm4gKHMgPT0gbnVsbCkgPyAwIDogcy5zcGxpdChSRUdFWF9E\nT1QpLmxlbmd0aDsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgU3Ry\naW5nIGNob3BIZWFkKFN0cmluZyBzLCBTdHJpbmcgaGVhZCkgewogICAgICAg\nIGlmIChzLnN0YXJ0c1dpdGgoaGVhZCkpCiAgICAgICAgICAgIHJldHVybiBz\nLnN1YnN0cmluZyhoZWFkLmxlbmd0aCgpKTsKICAgICAgICByZXR1cm4gczsK\nICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgY2hvcFRhaWwoU3Ry\naW5nIHMsIFN0cmluZyB0YWlsKSB7CiAgICAgICAgaW50IGkgPSBzLmxhc3RJ\nbmRleE9mKHRhaWwpOwogICAgICAgIGlmIChpID09IC0xKQogICAgICAgICAg\nICByZXR1cm4gczsKICAgICAgICByZXR1cm4gcy5zdWJzdHJpbmcoMCwgaSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGdpdmVuIDxjb2RlPnNs\naWNlPC9jb2RlPiBzcGVjaWZpYyBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMg\nZnJvbQogICAgICogZ2l2ZW4gPGNvZGU+b3JpZ2luYWw8L2NvZGU+IGtleS12\nYWx1ZSBtYXAuIFRoZSBydWxlcyBhcmUKICAgICAqIDxMST4gaWYga2V5IGJl\nZ2lucyB3aXRoIDxjb2RlPiJzbGljZS5YWFguIjwvY29kZT4gd2hlcmUKICAg\nICAqIDxjb2RlPlhYWDwvY29kZT4gaXMgdGhlIGdpdmVuIHNsaWNlIG5hbWUs\nIHRoZW4gcmVwbGFjZQogICAgICogPGNvZGU+InNsaWNlLlhYWC48L2NvZGU+\nIHdpdGggPGNvZGU+b3BlbmpwYS48L2NvZGU+LgogICAgICogPExJPmlmIGtl\neSBiZWdpbnMgd2l0aCA8Y29kZT4ic2xpY2UuIjwvY29kZT4gYnV0IG5vdCB3\naXRoCiAgICAgKiA8Y29kZT4ic2xpY2UuWFhYLiI8L2NvZGU+LCB0aGUgaWdu\nb3JlIGkuZS4gYW55IHByb3BlcnR5IG9mIG90aGVyCiAgICAgKiBzbGljZXMg\nb3IgZ2xvYmFsIHNsaWNlIHByb3BlcnR5IGUuZy4KICAgICAqIDxjb2RlPnNs\naWNlLkRpc3RyaWJ1dGlvblBvbGljeTwvY29kZT4KICAgICAqIDxjb2RlPmlm\nIGtleSBzdGFydHMgd2l0aCA8Y29kZT4ib3BlbmpwYS4iPC9jb2RlPiBhbmQg\nYSBjb3JyZXNwb25kaW5nCiAgICAgKiA8Y29kZT4ic2xpY2UuWFhYLiI8L2Nv\nZGU+IHByb3BlcnR5IGRvZXMgbm90IGV4aXN0LCB0aGVuIHVzZSB0aGlzIGFz\nCiAgICAgKiBkZWZhdWx0IHByb3BlcnR5CiAgICAgKiA8Y29kZT5wcm9wZXJ0\neSB3aXRoIGFueSBvdGhlciBwcmVmaXggaXMgc2ltcGx5IGNvcGllZAogICAg\nICoKICAgICAqLwogICAgTWFwIGNyZWF0ZVNsaWNlUHJvcGVydGllcyhNYXAg\nb3JpZ2luYWwsIFN0cmluZyBzbGljZSkgewogICAgICAgIE1hcCByZXN1bHQg\nPSBuZXcgUHJvcGVydGllcygpOwogICAgICAgIFN0cmluZyBwcmVmaXggPSBQ\nUkVGSVhfU0xJQ0UgKyBzbGljZSArIERPVDsKICAgICAgICBmb3IgKE9iamVj\ndCBvIDogb3JpZ2luYWwua2V5U2V0KCkpIHsKICAgICAgICAgICAgU3RyaW5n\nIGtleSA9IG8udG9TdHJpbmcoKTsKICAgICAgICAgICAgT2JqZWN0IHZhbHVl\nID0gb3JpZ2luYWwuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmICh2YWx1ZSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAg\nIGlmIChrZXkuc3RhcnRzV2l0aChwcmVmaXgpKSB7CiAgICAgICAgICAgICAg\nICBTdHJpbmcgbmV3S2V5ID0gUFJFRklYX09QRU5KUEEgKyBrZXkuc3Vic3Ry\naW5nKHByZWZpeC5sZW5ndGgoKSk7CiAgICAgICAgICAgICAgICByZXN1bHQu\ncHV0KG5ld0tleSwgdmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGtl\neS5zdGFydHNXaXRoKFBSRUZJWF9TTElDRSkpIHsKICAgICAgICAgICAgICAg\nIC8vIGlnbm9yZSBrZXlzIHRoYXQgYXJlIGluICdzbGljZS4nIG5hbWVzcGFj\nZSBidXQgbm90IHRoaXMgc2xpY2UKICAgICAgICAgICAgfSBlbHNlIGlmIChr\nZXkuc3RhcnRzV2l0aChQUkVGSVhfT1BFTkpQQSkpIHsKICAgICAgICAgICAg\nICAgIFN0cmluZyBuZXdLZXkgPSBwcmVmaXggKyBrZXkuc3Vic3RyaW5nKFBS\nRUZJWF9PUEVOSlBBLmxlbmd0aCgpKTsKICAgICAgICAgICAgICAgIGlmICgh\nb3JpZ2luYWwuY29udGFpbnNLZXkobmV3S2V5KSkKICAgICAgICAgICAgICAg\nICAgICByZXN1bHQucHV0KGtleSwgdmFsdWUpOwogICAgICAgICAgICB9IGVs\nc2UgeyAvLyBrZXlzIHRoYXQgYXJlIG5laXRoZXIgIm9wZW5qcGEiIG5vciAi\nc2xpY2UiIG5hbWVzcGFjZQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dChr\nZXksIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5l\nIHRoZSBtYXN0ZXIgc2xpY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBz\nZXRNYXN0ZXIoTWFwIG9yaWdpbmFsKSB7CiAgICAgICAgU3RyaW5nIGtleSA9\nIG1hc3RlclBsdWdpbi5nZXRQcm9wZXJ0eSgpOwogICAgICAgIE9iamVjdCBt\nYXN0ZXJTbGljZSA9IG9yaWdpbmFsLmdldChrZXkpOwogICAgICAgIExvZyBs\nb2cgPSBnZXRDb25maWd1cmF0aW9uTG9nKCk7CiAgICAgICAgTGlzdDxTbGlj\nZT4gYWN0aXZlU2xpY2VzID0gZ2V0U2xpY2VzKG51bGwpOwogICAgICAgIGlm\nIChtYXN0ZXJTbGljZSA9PSBudWxsKSB7CiAgICAgICAgICAgIF9tYXN0ZXIg\nPSBhY3RpdmVTbGljZXMuZ2V0KDApOwogICAgICAgICAgICBpZiAobG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2Mu\nZ2V0KCJuby1tYXN0ZXItc2xpY2UiLCBrZXksIF9tYXN0ZXIpKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBmb3IgKFNsaWNlIHNs\naWNlOmFjdGl2ZVNsaWNlcykKICAgICAgICAgICAgaWYgKHNsaWNlLmdldE5h\nbWUoKS5lcXVhbHMobWFzdGVyU2xpY2UpKQogICAgICAgICAgICAgICAgX21h\nc3RlciA9IHNsaWNlOwogICAgICAgIGlmIChfbWFzdGVyID09IG51bGwpIHsK\nICAgICAgICAgICAgX21hc3RlciA9IGFjdGl2ZVNsaWNlcy5nZXQoMCk7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgU2xpY2UgYWRkU2xpY2Uo\nU3RyaW5nIG5hbWUsIE1hcCBuZXdQcm9wcykgewogICAgICAgIFN0cmluZyBw\ncmVmaXggPSBQUkVGSVhfU0xJQ0UgKyBET1QgKyBuYW1lICsgRE9UOwogICAg\nICAgIGZvciAoT2JqZWN0IGtleSA6IG5ld1Byb3BzLmtleVNldCgpKSB7CiAg\nICAgICAgICAgIGlmICghU3RyaW5nLmNsYXNzLmlzSW5zdGFuY2Uoa2V5KSAK\nICAgICAgICAgICAgICYmIGtleS50b1N0cmluZygpLnN0YXJ0c1dpdGgocHJl\nZml4KSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJzbGljZS1hZGQtd3Jvbmcta2V5Iiwga2V5KSk7CiAgICAg\nICAgfQogICAgICAgIFNsaWNlIHNsaWNlID0gZ2V0U2xpY2UobmFtZSk7CiAg\nICAgICAgaWYgKHNsaWNlICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJzbGljZS1leGlzdHMiLCBuYW1l\nKSk7CiAgICAgICAgTWFwPFN0cmluZyxTdHJpbmc+IG9yaWdpbmFsID0gc3Vw\nZXIudG9Qcm9wZXJ0aWVzKHRydWUpOwogICAgICAgIG9yaWdpbmFsLnB1dEFs\nbChuZXdQcm9wcyk7CiAgICAgICAgIHNsaWNlID0gbmV3U2xpY2UobmFtZSwg\nb3JpZ2luYWwpOwogICAgICAgIF9zbGljZXMuYWRkKHNsaWNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICB2aXJ0dWFsRGF0YVNvdXJjZS5hZGREYXRh\nU291cmNlKGNyZWF0ZURhdGFTb3VyY2Uoc2xpY2UpKTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgaGFuZGxlQmFkQ29u\nbmVjdGlvbihmYWxzZSwgc2xpY2UsIGV4KTsKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzbGljZTsKICAgIH0K\nfQo=\n","encoding":"base64"}

