{"sha":"634b893994f5f5f6ad04e67be878cb537f7c039f","node_id":"MDQ6QmxvYjIwNjM2NDo2MzRiODkzOTk0ZjVmNWY2YWQwNGU2N2JlODc4Y2I1MzdmN2MwMzlm","size":20470,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/634b893994f5f5f6ad04e67be878cb537f7c039f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuc2xpY2UuamRiYzsKCmltcG9y\ndCBqYXZhLmxhbmcucmVmbGVjdC5Db25zdHJ1Y3RvcjsKaW1wb3J0IGphdmEu\nc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5DYWxsYWJsZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLkV4ZWN1dGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LkV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LkZ1dHVyZTsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkNvbm5lY3Rpb25JbmZvOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3Rv\ncmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlJlc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5S\nZXN1bHRTZXRSZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9i\namVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5y\nb3AuUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVyYXRvcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5zbGljZS5EaXN0cmlidXRlZFN0b3Jl\nTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5zbGljZS5Qcm9k\ndWN0RGVyaXZhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5zbGlj\nZS5TbGljZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5zbGljZS5TbGlj\nZUltcGxIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuc2xpY2Uu\nU2xpY2VJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnNsaWNlLlNs\naWNlVGhyZWFkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5TdG9yZUV4Y2VwdGlvbjsKCi8qKgogKiBBIFN0b3JlIG1hbmFnZXIgZm9y\nIG11bHRpcGxlIHBoeXNpY2FsIGRhdGFiYXNlcyByZWZlcnJlZCBhcyA8ZW0+\nc2xpY2U8L2VtPi4KICogVGhpcyByZWNlaXZlciBiZWhhdmVzIGxpa2UgYSBU\ncmFuc2FjdGlvbiBNYW5hZ2VyIGFzIGl0IGltcGxlbWVudHMgdHdvLXBoYXNl\nCiAqIGNvbW1pdCBwcm90b2NvbCBpZiBhbGwgdGhlIGNvbXBvbmVudCBzbGlj\nZXMgaXMgWEEtY29tcGxhaW50LiBUaGUgYWN0aW9ucyBhcmUKICogZGVsZWdh\ndGVkIHRvIHRoZSB1bmRlcmx5aW5nIHNsaWNlcy4gVGhlIGFjdGlvbnMgYXJl\nIGV4ZWN1dGVkIGluIHBhcmFsbGVsCiAqIHRocmVhZHMgd2hlbmV2ZXIgcG9z\nc2libGUgc3VjaCBhcyBmbHVzaGluZyBvciBxdWVyeS4gPGJyPgogKiAKICog\nQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAqIAogKi8KY2xhc3MgRGlzdHJpYnV0\nZWRKREJDU3RvcmVNYW5hZ2VyIGV4dGVuZHMgSkRCQ1N0b3JlTWFuYWdlciAK\nICAgIGltcGxlbWVudHMgRGlzdHJpYnV0ZWRTdG9yZU1hbmFnZXIgewogICAg\ncHJpdmF0ZSBmaW5hbCBMaXN0PFNsaWNlU3RvcmVNYW5hZ2VyPiBfc2xpY2Vz\nOwogICAgcHJpdmF0ZSBKREJDU3RvcmVNYW5hZ2VyIF9tYXN0ZXI7CiAgICBw\ncml2YXRlIGZpbmFsIERpc3RyaWJ1dGVkSkRCQ0NvbmZpZ3VyYXRpb24gX2Nv\nbmY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nCiAgICAgICAgICAgIExvY2FsaXplci5mb3JQYWNrYWdlKERpc3RyaWJ1dGVk\nSkRCQ1N0b3JlTWFuYWdlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgQ29uc3RydWN0b3I8Q2xpZW50Q29ubmVjdGlvbj4gY2xpZW50Q29u\nbmVjdGlvbkltcGw7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDb25zdHJ1\nY3RvcjxSZWZDb3VudENvbm5lY3Rpb24+IHJlZkNvdW50Q29ubmVjdGlvbklt\ncGw7CiAgICBzdGF0aWMgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNs\naWVudENvbm5lY3Rpb25JbXBsID0gQ29uY3JldGVDbGFzc0dlbmVyYXRvci4K\nICAgICAgICAgICAgICAgIGdldENvbmNyZXRlQ29uc3RydWN0b3IoQ2xpZW50\nQ29ubmVjdGlvbi5jbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIHJlZkNvdW50Q29ubmVjdGlvbkltcGwgPSBDb25jcmV0ZUNsYXNzR2Vu\nZXJhdG9yLgogICAgICAgICAgICAgICAgZ2V0Q29uY3JldGVDb25zdHJ1Y3Rv\ncihSZWZDb3VudENvbm5lY3Rpb24uY2xhc3MsIEpEQkNTdG9yZU1hbmFnZXIu\nY2xhc3MsIENvbm5lY3Rpb24uY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25J\nbkluaXRpYWxpemVyRXJyb3IoZSk7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdHMgYSBzZXQgb2YgY2hpbGQgU3RvcmVN\nYW5hZ2VycyBlYWNoIGNvbm5lY3RlZCB0byBhIHBoeXNpY2FsCiAgICAgKiBE\nYXRhU291cmNlLgogICAgICogCiAgICAgKiBUaGUgc3VwcGxpZWQgY29uZmln\ndXJhdGlvbiBjYXJyaWVzIG11bHRpcGxlIFVSTCBmb3IgdW5kZXJseWluZyBw\naHlzaWNhbAogICAgICogc2xpY2VzLiBUaGUgZmlyc3Qgc2xpY2UgaXMgcmVm\nZXJyZWQgYXMgPGVtPm1hc3RlcjwvZW0+IGFuZCBpcyB1c2VkIHRvCiAgICAg\nKiBnZXQgU2VxdWVuY2UgYmFzZWQgZW50aXR5IGlkZW50aWZpZXJzLgogICAg\nICovCiAgICBwdWJsaWMgRGlzdHJpYnV0ZWRKREJDU3RvcmVNYW5hZ2VyKERp\nc3RyaWJ1dGVkSkRCQ0NvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIHN1\ncGVyKCk7CiAgICAgICAgX2NvbmYgPSBjb25mOwogICAgICAgIF9zbGljZXMg\nPSBuZXcgQXJyYXlMaXN0PFNsaWNlU3RvcmVNYW5hZ2VyPigpOwogICAgICAg\nIExpc3Q8U3RyaW5nPiBzbGljZU5hbWVzID0gY29uZi5nZXRBY3RpdmVTbGlj\nZU5hbWVzKCk7CiAgICAgICAgZm9yIChTdHJpbmcgbmFtZSA6IHNsaWNlTmFt\nZXMpIHsKICAgICAgICAgICAgU2xpY2VTdG9yZU1hbmFnZXIgc2xpY2UgPQog\nICAgICAgICAgICAgICAgICAgIG5ldyBTbGljZVN0b3JlTWFuYWdlcihjb25m\nLmdldFNsaWNlKG5hbWUpKTsKICAgICAgICAgICAgX3NsaWNlcy5hZGQoc2xp\nY2UpOwogICAgICAgICAgICBpZiAoc2xpY2UuZ2V0TmFtZSgpLmVxdWFscyhf\nY29uZi5nZXRNYXN0ZXIoKS5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAg\nX21hc3RlciA9IHNsaWNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nRGlzdHJpYnV0ZWRKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9u\nKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KICAgIAogICAgcHVi\nbGljIFNsaWNlU3RvcmVNYW5hZ2VyIGdldFNsaWNlKGludCBpKSB7CiAgICAJ\ncmV0dXJuIF9zbGljZXMuZ2V0KGkpOwogICAgfQogICAgCiAgICBwdWJsaWMg\nU2xpY2VTdG9yZU1hbmFnZXIgYWRkU2xpY2UoU2xpY2Ugc2xpY2UpIHsKICAg\nICAgICBTbGljZVN0b3JlTWFuYWdlciByZXN1bHQgPSBuZXcgU2xpY2VTdG9y\nZU1hbmFnZXIoc2xpY2UpOwogICAgICAgIHJlc3VsdC5zZXRDb250ZXh0KGdl\ndENvbnRleHQoKSwKICAgICAgICAgICAgICAgIChKREJDQ29uZmlndXJhdGlv\nbilzbGljZS5nZXRDb25maWd1cmF0aW9uKCkpOwogICAgICAgIF9zbGljZXMu\nYWRkKHJlc3VsdCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAg\nICAvKioKICAgICAqIERlY2lkZXMgdGhlIGluZGV4IG9mIHRoZSBTdG9yZU1h\nbmFnZXIgYnkgZmlyc3QgbG9va2luZyBhdCB0aGUKICAgICAqIGltcGxlbWVu\ndGF0aW9uIGRhdGEuIElmIG5vIGltcGxlbWVudGF0aW9uIGRhdGEgaXMgZm91\nbmQsIHRoZW4gZXN0aW1hdGVzIAogICAgICogdGFyZ2V0cyBzbGljZXMgYnkg\ndXNpbmcgYWRkaXRpb25hbCBjb25uZWN0aW9uIGluZm8uIElmIG5vIGFkZGl0\naW9uYWwKICAgICAqIGNvbm5lY3Rpb24gaW5mbyB0aGVuIGNhbGxzIGJhY2sg\ndG8gdXNlci1kZWZpbmVkIHBvbGljeS4gCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBTbGljZUluZm8gZmluZFNsaWNlTmFtZXMoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgaWYgKFNsaWNlSW1wbEhl\nbHBlci5pc1NsaWNlQXNzaWduZWQoc20pKQogICAgICAgICAgICByZXR1cm4g\nU2xpY2VJbXBsSGVscGVyLmdldFNsaWNlSW5mbyhzbSk7CiAgICAgICAgU2xp\nY2VJbmZvIHJlc3VsdCA9IG51bGw7CiAgICAgICAgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAg\nT2JqZWN0IGN0eCA9IGdldENvbnRleHQoKTsKICAgICAgICBpZiAoU2xpY2VJ\nbXBsSGVscGVyLmlzUmVwbGljYXRlZChzbSkpIHsKICAgICAgICAgICAgcmVz\ndWx0ID0gU2xpY2VJbXBsSGVscGVyLmdldFNsaWNlc0J5UG9saWN5KHBjLCBf\nY29uZiwgY3R4KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTdHJp\nbmcgb3JpZ2luID0gZXN0aW1hdGVTbGljZShzbSwgZWRhdGEpOwogICAgICAg\nICAgICBpZiAob3JpZ2luID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJl\nc3VsdCA9IFNsaWNlSW1wbEhlbHBlci5nZXRTbGljZXNCeVBvbGljeShwYywg\nX2NvbmYsIGN0eCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICByZXN1bHQgPSBuZXcgU2xpY2VJbmZvKG9yaWdpbik7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0K\nICAgIAogICAgcHJpdmF0ZSB2b2lkIGFzc2lnblNsaWNlKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIFN0cmluZyBoaW50KSB7CiAgICAgICAgaWYgKFNsaWNl\nSW1wbEhlbHBlci5pc1JlcGxpY2F0ZWQoc20pKSB7CiAgICAgICAgICAgIFNs\naWNlSW1wbEhlbHBlci5nZXRTbGljZXNCeVBvbGljeShzbSwgX2NvbmYsIGdl\ndENvbnRleHQoKSkKICAgICAgICAgICAgICAgIC5zZXRJbnRvKHNtKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBuZXcgU2xpY2VJ\nbmZvKGhpbnQpLnNldEludG8oc20pOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFRoZSBhZGRpdGlvbmFsIGVkYXRhIGlzIHVzZWQsIGlmIHBvc3NpYmxl\nLCB0byBmaW5kIHRoZSBTdG9yZU1hbmFnZXIKICAgICAqIG1hbmFnaW5nIHRo\nZSBnaXZlbiBTdGF0ZU1hbmFnZXIuIElmIHRoZSBhZGRpdGlvbmFsIGRhdGEg\naXMgdW5hdmFpbGFibGUKICAgICAqIHRoZW4gcmV0dXJuIG51bGwuCiAgICAg\nKiAKICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZXN0aW1hdGVTbGljZShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAgICAg\nICBpZiAoZWRhdGEgPT0gbnVsbCB8fCAhKGVkYXRhIGluc3RhbmNlb2YgQ29u\nbmVjdGlvbkluZm8pKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgUmVzdWx0IHJlc3VsdCA9ICgoQ29ubmVjdGlvbkluZm8pIGVkYXRhKS5y\nZXN1bHQ7CiAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIFJlc3VsdFNl\ndFJlc3VsdCkgewogICAgICAgICAgICBKREJDU3RvcmUgc3RvcmUgPSAoKFJl\nc3VsdFNldFJlc3VsdCkgcmVzdWx0KS5nZXRTdG9yZSgpOwogICAgICAgICAg\nICBmb3IgKFNsaWNlU3RvcmVNYW5hZ2VyIHNsaWNlIDogX3NsaWNlcykgewog\nICAgICAgICAgICAgICAgaWYgKHNsaWNlID09IHN0b3JlKSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHNsaWNlLmdldE5hbWUoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsgCiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3RzIGNoaWxk\nIFN0b3JlTWFuYWdlcihzKSB3aGVyZSB0aGUgZ2l2ZW4gaW5zdGFuY2UgcmVz\naWRlcy4KICAgICAqLwogICAgcHJpdmF0ZSBTdG9yZU1hbmFnZXIgc2VsZWN0\nU3RvcmUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgT2JqZWN0IGVkYXRhKSB7\nCiAgICAgICAgU3RyaW5nW10gdGFyZ2V0cyA9IGZpbmRTbGljZU5hbWVzKHNt\nLCBlZGF0YSkuZ2V0U2xpY2VzKCk7CiAgICAgICAgZm9yIChTdHJpbmcgdGFy\nZ2V0IDogdGFyZ2V0cykgewogICAgICAgIAlTbGljZVN0b3JlTWFuYWdlciBz\nbGljZSA9IGxvb2t1cCh0YXJnZXQpOwogICAgICAgIAlpZiAoc2xpY2UgPT0g\nbnVsbCkKICAgICAgICAJICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbihfbG9jLmdldCgid3Jvbmctc2xpY2UiLCB0YXJnZXQsCiAgICAgICAgCSAg\nICAgICAgICAgIHNtKSk7CiAgICAgICAgCXJldHVybiBzbGljZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gYXNzaWduRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50\nIGZpZWxkLAogICAgICAgICAgICBib29sZWFuIHByZUZsdXNoKSB7CiAgICAg\nICAgcmV0dXJuIHNlbGVjdFN0b3JlKHNtLCBudWxsKS5hc3NpZ25GaWVsZChz\nbSwgZmllbGQsIHByZUZsdXNoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBhc3NpZ25PYmplY3RJZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29s\nZWFuIHByZUZsdXNoKSB7CiAgICAgICAgcmV0dXJuIF9tYXN0ZXIuYXNzaWdu\nT2JqZWN0SWQoc20sIHByZUZsdXNoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBiZWZvcmVTdGF0ZUNoYW5nZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQ\nQ1N0YXRlIGZyb21TdGF0ZSwKICAgICAgICAgICAgUENTdGF0ZSB0b1N0YXRl\nKSB7CiAgICAgICAgX21hc3Rlci5iZWZvcmVTdGF0ZUNoYW5nZShzbSwgZnJv\nbVN0YXRlLCB0b1N0YXRlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdp\nbk9wdGltaXN0aWMoKSB7CiAgICAgICAgZm9yIChTbGljZVN0b3JlTWFuYWdl\nciBzbGljZSA6IF9zbGljZXMpCiAgICAgICAgICAgIHNsaWNlLmJlZ2luT3B0\naW1pc3RpYygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbEFs\nbCgpIHsKICAgICAgICBib29sZWFuIHJldCA9IHRydWU7CiAgICAgICAgZm9y\nIChTbGljZVN0b3JlTWFuYWdlciBzbGljZSA6IF9zbGljZXMpCiAgICAgICAg\nICAgIHJldCA9IHNsaWNlLmNhbmNlbEFsbCgpICYgcmV0OwogICAgICAgIHJl\ndHVybiByZXQ7CiAgICB9CgogICAgcHVibGljIGludCBjb21wYXJlVmVyc2lv\nbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgdjEsIE9iamVjdCB2\nMikgewogICAgICAgIHJldHVybiBzZWxlY3RTdG9yZShzbSwgbnVsbCkuY29t\ncGFyZVZlcnNpb24oc20sIHYxLCB2Mik7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBjb3B5RGF0YVN0b3JlSWQoT2JqZWN0IG9pZCwgQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIF9tYXN0ZXIuY29weURhdGFTdG9y\nZUlkKG9pZCwgbWV0YSk7CiAgICB9CgogICAgcHVibGljIFJlc3VsdE9iamVj\ndFByb3ZpZGVyIGV4ZWN1dGVFeHRlbnQoQ2xhc3NNZXRhRGF0YSBtZXRhLAog\nICAgICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMsIEZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkgewogICAgICAgIGludCBpID0gMDsKICAgICAgICBMaXN0\nPFNsaWNlU3RvcmVNYW5hZ2VyPiB0YXJnZXRzID0gZ2V0VGFyZ2V0cyhmZXRj\naCk7CiAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSB0bXAgPSBuZXcg\nUmVzdWx0T2JqZWN0UHJvdmlkZXJbdGFyZ2V0cy5zaXplKCldOwogICAgICAg\nIGZvciAoU2xpY2VTdG9yZU1hbmFnZXIgc2xpY2UgOiB0YXJnZXRzKSB7CiAg\nICAgICAgICAgIHRtcFtpKytdID0gc2xpY2UuZXhlY3V0ZUV4dGVudChtZXRh\nLCBzdWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBuZXcgTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlkZXIodG1wKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgT2JqZWN0IGVkYXRhKSB7CiAgICAJU3RyaW5nIG9yaWdpbiA9IG51\nbGw7CiAgICAgICAgZm9yIChTbGljZVN0b3JlTWFuYWdlciBzbGljZSA6IF9z\nbGljZXMpIHsKICAgICAgICAgICAgaWYgKHNsaWNlLmV4aXN0cyhzbSwgZWRh\ndGEpKSB7CiAgICAgICAgICAgIAlvcmlnaW4gPSBzbGljZS5nZXROYW1lKCk7\nCiAgICAgICAgICAgIAlicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBpZiAob3JpZ2luICE9IG51bGwpCiAgICAgICAgICAgIGFzc2ln\nblNsaWNlKHNtLCBvcmlnaW4pOwogICAgICAgIHJldHVybiBvcmlnaW4gIT0g\nbnVsbDsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogRmx1c2ggdGhlIGdp\ndmVuIFN0YXRlTWFuYWdlcnMgYWZ0ZXIgYmlubmluZyB0aGVtIHRvIHJlc3Bl\nY3RpdmUgcGh5c2ljYWwKICAgICAqIHNsaWNlcy4KICAgICAqLwogICAgcHVi\nbGljIENvbGxlY3Rpb24gZmx1c2goQ29sbGVjdGlvbiBzbXMpIHsKICAgICAg\nICBDb2xsZWN0aW9uIGV4Y2VwdGlvbnMgPSBuZXcgQXJyYXlMaXN0KCk7CiAg\nICAgICAgTGlzdDxGdXR1cmU8Q29sbGVjdGlvbj4+IGZ1dHVyZXMgPSBuZXcg\nQXJyYXlMaXN0PEZ1dHVyZTxDb2xsZWN0aW9uPj4oKTsKICAgICAgICBNYXA8\nU3RyaW5nLCBTdGF0ZU1hbmFnZXJTZXQ+IHN1YnNldHMgPSBiaW4oc21zLCBu\ndWxsKTsKICAgICAgICBDb2xsZWN0aW9uPFN0YXRlTWFuYWdlclNldD4gcmVt\nYWluaW5nID0gCiAgICAgICAgICAgIG5ldyBBcnJheUxpc3Q8U3RhdGVNYW5h\nZ2VyU2V0PihzdWJzZXRzLnZhbHVlcygpKTsKICAgICAgICBFeGVjdXRvclNl\ncnZpY2UgdGhyZWFkUG9vbCA9IFNsaWNlVGhyZWFkLm5ld1Bvb2woX3NsaWNl\ncy5zaXplKCkpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3NsaWNl\ncy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBTbGljZVN0b3JlTWFuYWdl\nciBzbGljZSA9IF9zbGljZXMuZ2V0KGkpOwogICAgICAgICAgICBTdGF0ZU1h\nbmFnZXJTZXQgc3Vic2V0ID0gc3Vic2V0cy5nZXQoc2xpY2UuZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgaWYgKHN1YnNldC5pc0VtcHR5KCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKHN1YnNldC5jb250\nYWluc1JlcGxpY2F0ZWQoKSkgewogICAgICAgICAgICAgICAgTWFwPE9wZW5K\nUEFTdGF0ZU1hbmFnZXIsIE9iamVjdD4gb2xkVmVyc2lvbnMgPSBjYWNoZVZl\ncnNpb24oCiAgICAgICAgICAgICAgICAgICAgc3Vic2V0LmdldFJlcGxpY2F0\nZWQoKSk7CiAgICAgICAgICAgIAljb2xsZWN0RXhjZXB0aW9uKHNsaWNlLmZs\ndXNoKHN1YnNldCksIGV4Y2VwdGlvbnMpOwogICAgICAgICAgICAgICAgcmVt\nYWluaW5nLnJlbW92ZShzdWJzZXQpOwogICAgICAgICAgICAJcm9sbGJhY2tW\nZXJzaW9uKHN1YnNldC5nZXRSZXBsaWNhdGVkKCksIG9sZFZlcnNpb25zLCBy\nZW1haW5pbmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAJ\nZnV0dXJlcy5hZGQodGhyZWFkUG9vbC5zdWJtaXQobmV3IEZsdXNoZXIoc2xp\nY2UsIHN1YnNldCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBmb3IgKEZ1dHVyZTxDb2xsZWN0aW9uPiBmdXR1cmUgOiBmdXR1cmVzKSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIAljb2xsZWN0RXhjZXB0\naW9uKGZ1dHVyZS5nZXQoKSwgZXhjZXB0aW9ucyk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoRXhlY3V0aW9uRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlLmdldENhdXNlKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAoJICAgIHJldHVybiBl\neGNlcHRpb25zOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgY29sbGVj\ndEV4Y2VwdGlvbihDb2xsZWN0aW9uIGVycm9yLCAgQ29sbGVjdGlvbiBob2xk\nZXIpIHsKICAgICAgICBpZiAoIShlcnJvciA9PSBudWxsIHx8IGVycm9yLmlz\nRW1wdHkoKSkpIHsKICAgICAgICAJaG9sZGVyLmFkZEFsbChlcnJvcik7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENvbGxlY3QgdGhl\nIGN1cnJlbnQgdmVyc2lvbnMgb2YgdGhlIGdpdmVuIFN0YXRlTWFuYWdlcnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgTWFwPE9wZW5KUEFTdGF0ZU1hbmFnZXIs\nIE9iamVjdD4gY2FjaGVWZXJzaW9uKAogICAgICAgIExpc3Q8T3BlbkpQQVN0\nYXRlTWFuYWdlcj4gc21zKSB7CiAgICAgICAgTWFwPE9wZW5KUEFTdGF0ZU1h\nbmFnZXIsIE9iamVjdD4gcmVzdWx0ID0gCiAgICAgICAgICAgIG5ldyBIYXNo\nTWFwPE9wZW5KUEFTdGF0ZU1hbmFnZXIsIE9iamVjdD4oKTsKICAgICAgICBm\nb3IgKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gOiBzbXMpCiAgICAgICAgICAg\nIHJlc3VsdC5wdXQoc20sIHNtLmdldFZlcnNpb24oKSk7CiAgICAgICAgcmV0\ndXJuIHJlc3VsdDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTZXRzIHRo\nZSB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBTdGF0ZU1hbmFnZXJzIGZyb20gdGhl\nIGNhY2hlZCB2ZXJzaW9ucy4KICAgICAqIFByb3ZpZGVkIHRoYXQgdGhlIFN0\nYXRlTWFuYWdlciBkb2VzIG5vdCBhcHBlYXIgaW4gdGhlIEZsdXNTZXRzIG9m\nIHRoZQogICAgICogcmVtYWluaW5nLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcm9sbGJhY2tWZXJzaW9uKExpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4g\nc21zLCAKICAgICAgICBNYXA8T3BlbkpQQVN0YXRlTWFuYWdlciwgT2JqZWN0\nPiBvbGRWZXJzaW9ucywgCiAgICAgICAgQ29sbGVjdGlvbjxTdGF0ZU1hbmFn\nZXJTZXQ+IHJlbWluZGVyKSB7CiAgICAgICAgaWYgKHJlbWluZGVyLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZvciAoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSA6IHNtcykgewogICAgICAgICAgICBpZiAob2Nj\ndXJzKHNtLCByZW1pbmRlcikpCiAgICAgICAgICAgICAgc20uc2V0VmVyc2lv\nbihvbGRWZXJzaW9ucy5nZXQoc20pKTsKICAgICAgICB9CiAgICB9CiAgICAK\nICAgIGJvb2xlYW4gb2NjdXJzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIAog\nICAgICAgIENvbGxlY3Rpb248U3RhdGVNYW5hZ2VyU2V0PiByZW1pbmRlcikg\newogICAgICAgIGZvciAoU3RhdGVNYW5hZ2VyU2V0IHNldCA6IHJlbWluZGVy\nKQogICAgICAgICAgICBpZiAoc2V0LmNvbnRhaW5zKHNtKSkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBTZXBhcmF0ZSB0aGUgZ2l2ZW4gbGlz\ndCBvZiBTdGF0ZU1hbmFnZXJzIGluIHNlcGFyYXRlIGxpc3RzIGZvciBlYWNo\nIHNsaWNlCiAgICAgKiBieSB0aGUgYXNzb2NpYXRlZCBzbGljZSBpZGVudGlm\naWVyIG9mIGVhY2ggU3RhdGVNYW5hZ2VyLgogICAgICovCiAgICBwcml2YXRl\nIE1hcDxTdHJpbmcsIFN0YXRlTWFuYWdlclNldD4gYmluKENvbGxlY3Rpb24g\nc21zLCBPYmplY3QgZWRhdGEpIHsKICAgICAgICBNYXA8U3RyaW5nLCBTdGF0\nZU1hbmFnZXJTZXQ+IHN1YnNldHMgPSAgCiAgICAgICAgICAgIG5ldyBIYXNo\nTWFwPFN0cmluZywgU3RhdGVNYW5hZ2VyU2V0PigpOwogICAgICAgIGZvciAo\nU2xpY2VTdG9yZU1hbmFnZXIgc2xpY2UgOiBfc2xpY2VzKQogICAgICAgICAg\nICBzdWJzZXRzLnB1dChzbGljZS5nZXROYW1lKCksIG5ldyBTdGF0ZU1hbmFn\nZXJTZXQoKSk7CiAgICAgICAgZm9yIChPYmplY3QgeCA6IHNtcykgewogICAg\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIHg7CiAgICAgICAgICAgIFN0cmluZ1tdIHRhcmdldHMgPSBm\naW5kU2xpY2VOYW1lcyhzbSwgZWRhdGEpLmdldFNsaWNlcygpOwogICAgICAg\nICAgIAlmb3IgKFN0cmluZyBzbGljZSA6IHRhcmdldHMpIHsKICAgICAgICAg\nICAgCXN1YnNldHMuZ2V0KHNsaWNlKS5hZGQoc20pOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBzdWJzZXRzOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgZ2V0Q2xpZW50Q29ubmVjdGlvbigpIHsKICAgICAg\nICByZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShj\nbGllbnRDb25uZWN0aW9uSW1wbCwgZ2V0Q29ubmVjdGlvbigpKTsKICAgIH0K\nCiAgICBwdWJsaWMgU2VxIGdldERhdGFTdG9yZUlkU2VxdWVuY2UoQ2xhc3NN\nZXRhRGF0YSBmb3JDbGFzcykgewogICAgICAgIHJldHVybiBfbWFzdGVyLmdl\ndERhdGFTdG9yZUlkU2VxdWVuY2UoZm9yQ2xhc3MpOwogICAgfQoKICAgIHB1\nYmxpYyBDbGFzczw/PiBnZXREYXRhU3RvcmVJZFR5cGUoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIF9tYXN0ZXIuZ2V0RGF0YVN0b3Jl\nSWRUeXBlKG1ldGEpOwogICAgfQoKICAgIHB1YmxpYyBDbGFzczw/PiBnZXRN\nYW5hZ2VkVHlwZShPYmplY3Qgb2lkKSB7CiAgICAgICAgcmV0dXJuIF9tYXN0\nZXIuZ2V0TWFuYWdlZFR5cGUob2lkKTsKICAgIH0KCiAgICBwdWJsaWMgU2Vx\nIGdldFZhbHVlU2VxdWVuY2UoRmllbGRNZXRhRGF0YSBmb3JGaWVsZCkgewog\nICAgICAgIHJldHVybiBfbWFzdGVyLmdldFZhbHVlU2VxdWVuY2UoZm9yRmll\nbGQpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGluaXRpYWxpemUoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBzdGF0ZSwKICAgICAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgZWRhdGEpIHsK\nICAgICAgICBpZiAoZWRhdGEgaW5zdGFuY2VvZiBDb25uZWN0aW9uSW5mbykg\newogICAgICAgICAgICBTdHJpbmcgb3JpZ2luID0gZXN0aW1hdGVTbGljZShz\nbSwgZWRhdGEpOwogICAgICAgICAgICBpZiAob3JpZ2luICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChsb29rdXAob3JpZ2luKS5pbml0aWFsaXpl\nKHNtLCBzdGF0ZSwgZmV0Y2gsIGVkYXRhKSkgewogICAgICAgICAgICAgICAg\nICAgIGFzc2lnblNsaWNlKHNtLCBvcmlnaW4pOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIC8vIG5vdCBhIHBhcnQgb2YgUXVlcnkg\ncmVzdWx0IGxvYWQuIExvb2sgaW50byB0aGUgc2xpY2VzIHRpbGwgZm91bmQK\nICAgICAgICBMaXN0PFNsaWNlU3RvcmVNYW5hZ2VyPiB0YXJnZXRzID0gZ2V0\nVGFyZ2V0cyhmZXRjaCk7CiAgICAgICAgZm9yIChTbGljZVN0b3JlTWFuYWdl\nciBzbGljZSA6IHRhcmdldHMpIHsKICAgICAgICAgICAgaWYgKHNsaWNlLmlu\naXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKSB7CiAgICAgICAg\nICAgICAgICBhc3NpZ25TbGljZShzbSwgc2xpY2UuZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBm\naWVsZHMsCiAgICAgICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\naW50IGxvY2tMZXZlbCwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgcmV0dXJu\nIHNlbGVjdFN0b3JlKHNtLCBlZGF0YSkubG9hZChzbSwgZmllbGRzLCBmZXRj\naCwgbG9ja0xldmVsLCBlZGF0YSk7CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gbG9hZEFsbChDb2xsZWN0aW9uIHNtcywgUENTdGF0ZSBzdGF0ZSwg\naW50IGxvYWQsCiAgICAgICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgTWFwPFN0cmluZywgU3RhdGVN\nYW5hZ2VyU2V0PiBzdWJzZXRzID0gYmluKHNtcywgZWRhdGEpOwogICAgICAg\nIENvbGxlY3Rpb24gcmVzdWx0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nIGZvciAoU2xpY2VTdG9yZU1hbmFnZXIgc2xpY2UgOiBfc2xpY2VzKSB7CiAg\nICAgICAgICAgIFN0YXRlTWFuYWdlclNldCBzdWJzZXQgPSBzdWJzZXRzLmdl\ndChzbGljZS5nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAoc3Vic2V0Lmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICBDb2xsZWN0aW9uIHRtcCA9IHNsaWNlLmxvYWRBbGwoc3Vic2V0LCBzdGF0\nZSwgbG9hZCwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICAgICAgaWYgKHRtcCAh\nPSBudWxsICYmICF0bXAuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmVz\ndWx0LmFkZEFsbCh0bXApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVz\ndWx0OwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RGF0YVN0b3JlSWQo\nT2JqZWN0IG9pZFZhbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAg\ncmV0dXJuIF9tYXN0ZXIubmV3RGF0YVN0b3JlSWQob2lkVmFsLCBtZXRhKTsK\nICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIG5ld0ZldGNo\nQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX21hc3Rlci5uZXdG\nZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnN0cnVjdCBhIGRpc3RyaWJ1dGVkIHF1ZXJ5IHRvIGJlIGV4ZWN1dGVkIGFn\nYWluc3QgYWxsIHRoZSBzbGljZXMuCiAgICAgKi8KICAgIHB1YmxpYyBTdG9y\nZVF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5ndWFnZSkgewogICAgICAgIEV4\ncHJlc3Npb25QYXJzZXIgcGFyc2VyID0gUXVlcnlMYW5ndWFnZXMucGFyc2Vy\nRm9yTGFuZ3VhZ2UobGFuZ3VhZ2UpOwogICAgICAgIERpc3RyaWJ1dGVkU3Rv\ncmVRdWVyeSByZXQgPSBuZXcgRGlzdHJpYnV0ZWRTdG9yZVF1ZXJ5KHRoaXMs\nIHBhcnNlcik7CiAgICAgICAgZm9yIChTbGljZVN0b3JlTWFuYWdlciBzbGlj\nZSA6IF9zbGljZXMpIHsKICAgICAgICAgICAgcmV0LmFkZChzbGljZS5uZXdR\ndWVyeShsYW5ndWFnZSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB0aGUgY29udGV4dCBmb3Ig\ndGhpcyByZWNlaXZlciBhbmQgYWxsIGl0cyB1bmRlcmx5aW5nIHNsaWNlcy4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRl\neHQgY3R4KSB7CiAgICAgICAgc3VwZXIuc2V0Q29udGV4dChjdHgpOwogICAg\nICAgIGZvciAoU2xpY2VTdG9yZU1hbmFnZXIgc3RvcmUgOiBfc2xpY2VzKSB7\nCiAgICAgICAgICAgIHN0b3JlLnNldENvbnRleHQoY3R4LCAKICAgICAgICAg\nICAgICAgICAgICAoSkRCQ0NvbmZpZ3VyYXRpb24pc3RvcmUuZ2V0U2xpY2Uo\nKS5nZXRDb25maWd1cmF0aW9uKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIFNsaWNlU3RvcmVNYW5hZ2VyIGxvb2t1cChTdHJpbmcgbmFtZSkg\newogICAgICAgIGZvciAoU2xpY2VTdG9yZU1hbmFnZXIgc2xpY2UgOiBfc2xp\nY2VzKQogICAgICAgICAgICBpZiAoc2xpY2UuZ2V0TmFtZSgpLmVxdWFscyhu\nYW1lKSkKICAgICAgICAgICAgICAgIHJldHVybiBzbGljZTsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVy\nc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsK\nICAgIAlTdHJpbmdbXSB0YXJnZXRzID0gZmluZFNsaWNlTmFtZXMoc20sIGVk\nYXRhKS5nZXRTbGljZXMoKTsKICAgIAlib29sZWFuIHN5bmMgPSB0cnVlOwog\nICAgCWZvciAoU3RyaW5nIHJlcGxpY2EgOiB0YXJnZXRzKSB7CiAgICAJCVNs\naWNlU3RvcmVNYW5hZ2VyIHNsaWNlID0gbG9va3VwKHJlcGxpY2EpOwogICAg\nCQlzeW5jICY9IHNsaWNlLnN5bmNWZXJzaW9uKHNtLCBlZGF0YSk7CiAgICAJ\nfQogICAgCXJldHVybiBzeW5jOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHJvdGVjdGVkIFJlZkNvdW50Q29ubmVjdGlvbiBjb25uZWN0SW50ZXJuYWwo\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBMaXN0PENvbm5lY3Rp\nb24+IGxpc3QgPSBuZXcgQXJyYXlMaXN0PENvbm5lY3Rpb24+KCk7CiAgICAg\nICAgZm9yIChTbGljZVN0b3JlTWFuYWdlciBzbGljZSA6IF9zbGljZXMpCiAg\nICAgICAgICAgIGxpc3QuYWRkKHNsaWNlLmdldENvbm5lY3Rpb24oKSk7CiAg\nICAgICAgRGlzdHJpYnV0ZWRDb25uZWN0aW9uIGNvbiA9IERpc3RyaWJ1dGVk\nQ29ubmVjdGlvbi5uZXdJbnN0YW5jZShsaXN0KTsKICAgICAgICByZXR1cm4g\nQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShyZWZDb3VudENv\nbm5lY3Rpb25JbXBsLCBEaXN0cmlidXRlZEpEQkNTdG9yZU1hbmFnZXIudGhp\ncywgY29uKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBs\naXN0IG9mIHNsaWNlcyBtZW50aW9uZWQgYXMgIAogICAgICoge0BsaW5rIFBy\nb2R1Y3REZXJpdmF0aW9uI0hJTlRfVEFSR0VUIGhpbnR9IG9mIHRoZSBnaXZl\nbgogICAgICoge0BsaW5rIEZldGNoQ29uZmlndXJhdGlvbiNnZXRIaW50KFN0\ncmluZykgZmV0Y2ggY29uZmlndXJhdGlvbn0uIAogICAgICogCiAgICAgKiBA\ncmV0dXJuIGFsbCBhY3RpdmUgc2xpY2VzIGlmIGEpIHRoZSBoaW50IGlzIG5v\ndCBzcGVjaWZpZWQgb3IgYikgYSBudWxsIAogICAgICogdmFsdWUgb3IgYykg\nYSBub24tU3RyaW5nIG9yIGQpIG1hdGNoZXMgbm8gYWN0aXZlIHNsaWNlLgog\nICAgICovCiAgICBMaXN0PFNsaWNlU3RvcmVNYW5hZ2VyPiBnZXRUYXJnZXRz\nKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmZXRj\naCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3NsaWNlczsKICAgICAg\nICBPYmplY3QgaGludCA9IGZldGNoLmdldEhpbnQoUHJvZHVjdERlcml2YXRp\nb24uSElOVF9UQVJHRVQpOwogICAgICAgIGlmIChoaW50ID09IG51bGwgfHwg\nIShoaW50IGluc3RhbmNlb2YgU3RyaW5nKSkgCiAgICAgICAgICAgIHJldHVy\nbiBfc2xpY2VzOwogICAgICAgIExpc3Q8U3RyaW5nPiB0YXJnZXROYW1lcyA9\nIEFycmF5cy5hc0xpc3QoaGludC50b1N0cmluZygpLnNwbGl0KCJcXCwiKSk7\nCiAgICAgICAgTGlzdDxTbGljZVN0b3JlTWFuYWdlcj4gdGFyZ2V0cyA9IG5l\ndyBBcnJheUxpc3Q8U2xpY2VTdG9yZU1hbmFnZXI+KCk7CiAgICAgICAgZm9y\nIChTbGljZVN0b3JlTWFuYWdlciBzbGljZSA6IF9zbGljZXMpIHsKICAgICAg\nICAgICBpZiAodGFyZ2V0TmFtZXMuY29udGFpbnMoc2xpY2UuZ2V0TmFtZSgp\nKSkKICAgICAgICAgICAgICB0YXJnZXRzLmFkZChzbGljZSk7CiAgICAgICAg\nICAgfQogICAgICAgICAgaWYgKHRhcmdldHMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gX3NsaWNlczsKICAgICAgICByZXR1cm4gdGFyZ2V0czsK\nICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRmx1c2hlciBp\nbXBsZW1lbnRzIENhbGxhYmxlPENvbGxlY3Rpb24+IHsKICAgICAgICBmaW5h\nbCBTbGljZVN0b3JlTWFuYWdlciBzdG9yZTsKICAgICAgICBmaW5hbCBTdGF0\nZU1hbmFnZXJTZXQgdG9GbHVzaDsKCiAgICAgICAgRmx1c2hlcihTbGljZVN0\nb3JlTWFuYWdlciBzdG9yZSwgU3RhdGVNYW5hZ2VyU2V0IHRvRmx1c2gpIHsK\nICAgICAgICAgICAgdGhpcy5zdG9yZSA9IHN0b3JlOwogICAgICAgICAgICB0\naGlzLnRvRmx1c2ggPSB0b0ZsdXNoOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIENvbGxlY3Rpb24gY2FsbCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIAlyZXR1cm4gc3RvcmUuZmx1c2godG9GbHVzaCk7CiAgICAgICAgfQog\nICAgfQogICAgCiAgICAvKioKICAgICAqIEEgc3BlY2lhbGl6ZWQsIGluc2Vy\ndC1vbmx5IGNvbGxlY3Rpb24gb2YgU3RhdGVNYW5hZ2VycyB0aGF0IG5vdGVz\nIAogICAgICogaWYgYW55IG9mIGl0cyBtZW1iZXIgaXMgcmVwbGljYXRlZC4K\nICAgICAqICAKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU3Rh\ndGVNYW5hZ2VyU2V0IGV4dGVuZHMgSGFzaFNldDxPcGVuSlBBU3RhdGVNYW5h\nZ2VyPiB7CiAgICAgICAgTGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2VyPiByZXBs\naWNhdGVkOwogICAgICAgIAogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyBib29sZWFuIGFkZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAg\nICAgICAgICAgIGJvb2xlYW4gaXNSZXBsaWNhdGVkID0gc20uZ2V0TWV0YURh\ndGEoKS5pc1JlcGxpY2F0ZWQoKTsKICAgICAgICAgICAgaWYgKGlzUmVwbGlj\nYXRlZCkgewogICAgICAgICAgICAgICAgaWYgKHJlcGxpY2F0ZWQgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXBsaWNhdGVkID0gbmV3IEFycmF5\nTGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2VyPigpOwogICAgICAgICAgICAgICAg\ncmVwbGljYXRlZC5hZGQoc20pOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBzdXBlci5hZGQoc20pOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUo\nT2JqZWN0IHNtKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICBib29sZWFuIGNvbnRhaW5zUmVwbGljYXRlZCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIHJlcGxpY2F0ZWQgIT0gbnVsbCAmJiAhcmVwbGljYXRlZC5p\nc0VtcHR5KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIExpc3Q8T3Bl\nbkpQQVN0YXRlTWFuYWdlcj4gZ2V0UmVwbGljYXRlZCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIHJlcGxpY2F0ZWQ7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

