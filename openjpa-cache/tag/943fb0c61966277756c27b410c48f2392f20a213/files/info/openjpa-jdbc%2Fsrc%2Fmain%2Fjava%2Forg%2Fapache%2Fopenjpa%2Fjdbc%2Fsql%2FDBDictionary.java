{"sha":"e4f01bb5beea775692033adb02c203fa11426c1a","node_id":"MDQ6QmxvYjIwNjM2NDplNGYwMWJiNWJlZWE3NzU2OTIwMzNhZGIwMmMyMDNmYTExNDI2YzFh","size":145432,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e4f01bb5beea775692033adb02c203fa11426c1a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSW5w\ndXRTdHJlYW1SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlJlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uU3RyaW5nUmVhZGVyOwppbXBvcnQgamF2YS5pby5Xcml0ZXI7\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5JbnZvY2F0aW9uVGFyZ2V0RXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBv\ncnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLm1hdGguQmln\nSW50ZWdlcjsKaW1wb3J0IGphdmEuc3FsLkFycmF5OwppbXBvcnQgamF2YS5z\ncWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7CmltcG9ydCBqYXZhLnNx\nbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0\nYTsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQg\namF2YS5zcWwuUmVmOwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU1FM\nV2FybmluZzsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGph\ndmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7CmltcG9y\ndCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudGV4dC5NZXNzYWdlRm9y\nbWF0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xs\nZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRp\nbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YXguc3Fs\nLkRhdGFTb3VyY2U7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5j\nb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhw\nQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5leHBzLkV4cFN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMua2VybmVsLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWw7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5KYXZhU1FMVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFT\nb3VyY2VGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuTmFtZVNldDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TZXF1ZW5jZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuQ29ubmVjdGlvbkRl\nY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5M\nb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlJlZmVyZW50aWFsSW50ZWdyaXR5RXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU2VyaWFs\naXphdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3Jl\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5z\ndXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGls\nLk51bWJlcnM7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBD\nbGFzcyB3aGljaCBhbGxvd3MgdGhlIGNyZWF0aW9uIG9mIFNRTCBkeW5hbWlj\nYWxseSwgaW4gYQogKiBkYXRhYmFzZSBhZ25vc3RpYyBmYXNoaW9uLiBTdWJj\nbGFzcyBmb3IgdGhlIG51YW5jZXMgb2YgZGlmZmVyZW50IGRhdGEgc3RvcmVz\nLgogKi8KcHVibGljIGNsYXNzIERCRGljdGlvbmFyeQogICAgaW1wbGVtZW50\ncyBDb25maWd1cmFibGUsIENvbm5lY3Rpb25EZWNvcmF0b3IsIEpvaW5TeW50\nYXhlcywKICAgIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yLlNRTFdhcm5p\nbmdIYW5kbGVyIHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBW\nRU5ET1JfT1RIRVIgPSAib3RoZXIiOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgVkVORE9SX0RBVEFESVJFQ1QgPSAiZGF0YWRpcmVjdCI7Cgog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0NIRU1BX0NBU0VfVVBQ\nRVIgPSAidXBwZXIiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nU0NIRU1BX0NBU0VfTE9XRVIgPSAibG93ZXIiOwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgU0NIRU1BX0NBU0VfUFJFU0VSVkUgPSAicHJlc2Vy\ndmUiOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENPTlNfTkFN\nRV9CRUZPUkUgPSAiYmVmb3JlIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIENPTlNfTkFNRV9NSUQgPSAibWlkIjsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgU3RyaW5nIENPTlNfTkFNRV9BRlRFUiA9ICJhZnRlciI7Cgog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgUkFOR0VfUE9TVF9TRUxF\nQ1QgPSAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgUkFOR0Vf\nUFJFX0RJU1RJTkNUID0gMTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFJBTkdFX1BPU1RfRElTVElOQ1QgPSAyOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgUkFOR0VfUE9TVF9MT0NLID0gMzsKCiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIGludCBOQU5PID0gMTsKICAgIHByb3RlY3Rl\nZCBzdGF0aWMgZmluYWwgaW50IE1JQ1JPID0gTkFOTyAqIDEwMDA7CiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBNSUxMSSA9IE1JQ1JPICogMTAw\nMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IENFTlRJID0gTUlM\nTEkgKiAxMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IERFQ0kg\nPSBNSUxMSSAqIDEwMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50\nIFNFQyA9IE1JTExJICogMTAwMDsKCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBOQU1FX0FOWSA9IDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBOQU1FX1RBQkxFID0gMTsKICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgaW50IE5BTUVfU0VRVUVOQ0UgPSAyOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIFN0cmluZyBaRVJPX0RBVEVfU1RSID0KICAgICAgICAiJyIg\nKyBuZXcgamF2YS5zcWwuRGF0ZSgwKSArICInIjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIFN0cmluZyBaRVJPX1RJTUVfU1RSID0gIiciICsgbmV3IFRp\nbWUoMCkgKyAiJyI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nWkVST19USU1FU1RBTVBfU1RSID0KICAgICAgICAiJyIgKyBuZXcgVGltZXN0\nYW1wKDApICsgIiciOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoREJE\naWN0aW9uYXJ5LmNsYXNzKTsKCiAgICAvLyBzY2hlbWEgZGF0YQogICAgcHVi\nbGljIFN0cmluZyBwbGF0Zm9ybSA9ICJHZW5lcmljIjsKICAgIHB1YmxpYyBT\ndHJpbmcgZHJpdmVyVmVuZG9yID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcg\nY2F0YWxvZ1NlcGFyYXRvciA9ICIuIjsKICAgIHB1YmxpYyBib29sZWFuIGNy\nZWF0ZVByaW1hcnlLZXlzID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcgY29u\nc3RyYWludE5hbWVNb2RlID0gQ09OU19OQU1FX0JFRk9SRTsKICAgIHB1Ymxp\nYyBpbnQgbWF4VGFibGVOYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGlu\ndCBtYXhDb2x1bW5OYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBt\nYXhDb25zdHJhaW50TmFtZUxlbmd0aCA9IDEyODsKICAgIHB1YmxpYyBpbnQg\nbWF4SW5kZXhOYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJ\nbmRleGVzUGVyVGFibGUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgIHB1Ymxp\nYyBib29sZWFuIHN1cHBvcnRzRm9yZWlnbktleXMgPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNUaW1lc3RhbXBOYW5vcyA9IHRydWU7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRDb25z\ndHJhaW50cyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jl\nc3RyaWN0RGVsZXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzQ2FzY2FkZURlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb24gPSB0cnVlOwog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9u\nID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3RV\ncGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNDYXNjYWRlVXBkYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzTnVsbFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb24gPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFk\nZENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0Fs\ndGVyVGFibGVXaXRoRHJvcENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgU3Ry\naW5nIHJlc2VydmVkV29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBz\neXN0ZW1TY2hlbWFzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVt\nVGFibGVzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VsZWN0V29yZHMg\nPSBudWxsOwogICAgcHVibGljIFN0cmluZyBmaXhlZFNpemVUeXBlTmFtZXMg\nPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzY2hlbWFDYXNlID0gU0NIRU1B\nX0NBU0VfVVBQRVI7CgogICAgLy8gc3FsCiAgICBwdWJsaWMgU3RyaW5nIHZh\nbGlkYXRpb25TUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjbG9zZVBv\nb2xTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBpbml0aWFsaXphdGlv\nblNRTCA9IG51bGw7CiAgICBwdWJsaWMgaW50IGpvaW5TeW50YXggPSBTWU5U\nQVhfU1FMOTI7CiAgICBwdWJsaWMgU3RyaW5nIG91dGVySm9pbkNsYXVzZSA9\nICJMRUZUIE9VVEVSIEpPSU4iOwogICAgcHVibGljIFN0cmluZyBpbm5lckpv\naW5DbGF1c2UgPSAiSU5ORVIgSk9JTiI7CiAgICBwdWJsaWMgU3RyaW5nIGNy\nb3NzSm9pbkNsYXVzZSA9ICJDUk9TUyBKT0lOIjsKICAgIHB1YmxpYyBib29s\nZWFuIHJlcXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luID0gZmFsc2U7CiAg\nICBwdWJsaWMgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSA9ICJGT1IgVVBEQVRF\nIjsKICAgIHB1YmxpYyBTdHJpbmcgdGFibGVGb3JVcGRhdGVDbGF1c2UgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBkaXN0aW5jdENvdW50Q29sdW1uU2Vw\nYXJhdG9yID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2Vs\nZWN0Rm9yVXBkYXRlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTG9ja2luZ1dpdGhEaXN0aW5jdENsYXVzZSA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMg\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0\naE9yZGVyQ2xhdXNlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbiA9IHRydWU7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFu\nZ2UgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNRdWVyeVRp\nbWVvdXQgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc2ltdWxhdGVMb2Nr\naW5nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1N1YnNl\nbGVjdCA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0NvcnJl\nbGF0ZWRTdWJzZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNIYXZpbmcgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNTZWxlY3RTdGFydEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMg\naW50IHJhbmdlUG9zaXRpb24gPSBSQU5HRV9QT1NUX1NFTEVDVDsKICAgIHB1\nYmxpYyBib29sZWFuIHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QgPSBmYWxz\nZTsKICAgIHB1YmxpYyBib29sZWFuIGFsbG93c0FsaWFzSW5CdWxrQ2xhdXNl\nID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTXVsdGlwbGVO\nb250cmFuc2FjdGlvbmFsUmVzdWx0U2V0cyA9IHRydWU7CiAgICBwdWJsaWMg\nU3RyaW5nIHNlYXJjaFN0cmluZ0VzY2FwZSA9ICJcXCI7CiAgICBwdWJsaWMg\nYm9vbGVhbiByZXF1aXJlc0Nhc3RGb3JNYXRoRnVuY3Rpb25zID0gZmFsc2U7\nCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0Nhc3RGb3JDb21wYXJpc29u\ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNNb2RPcGVy\nYXRvciA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNYTUxD\nb2x1bW4gPSBmYWxzZTsKCiAgICAvLyBmdW5jdGlvbnMKICAgIHB1YmxpYyBT\ndHJpbmcgY2FzdEZ1bmN0aW9uID0gIkNBU1QoezB9IEFTIHsxfSkiOwogICAg\ncHVibGljIFN0cmluZyB0b0xvd2VyQ2FzZUZ1bmN0aW9uID0gIkxPV0VSKHsw\nfSkiOwogICAgcHVibGljIFN0cmluZyB0b1VwcGVyQ2FzZUZ1bmN0aW9uID0g\nIlVQUEVSKHswfSkiOwogICAgcHVibGljIFN0cmluZyBzdHJpbmdMZW5ndGhG\ndW5jdGlvbiA9ICJDSEFSX0xFTkdUSCh7MH0pIjsKICAgIHB1YmxpYyBTdHJp\nbmcgYml0TGVuZ3RoRnVuY3Rpb24gPSAiKE9DVEVUX0xFTkdUSCh7MH0pICog\nOCkiOwogICAgcHVibGljIFN0cmluZyB0cmltTGVhZGluZ0Z1bmN0aW9uID0g\nIlRSSU0oTEVBRElORyB7MX0gRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJp\nbmcgdHJpbVRyYWlsaW5nRnVuY3Rpb24gPSAiVFJJTShUUkFJTElORyB7MX0g\nRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgdHJpbUJvdGhGdW5jdGlv\nbiA9ICJUUklNKEJPVEggezF9IEZST00gezB9KSI7CiAgICBwdWJsaWMgU3Ry\naW5nIGNvbmNhdGVuYXRlRnVuY3Rpb24gPSAiKHswfXx8ezF9KSI7CiAgICBw\ndWJsaWMgU3RyaW5nIGNvbmNhdGVuYXRlRGVsaW1pdGVyID0gIidPUEVOSlBB\nVE9LRU4nIjsKICAgIHB1YmxpYyBTdHJpbmcgc3Vic3RyaW5nRnVuY3Rpb25O\nYW1lID0gIlNVQlNUUklORyI7CiAgICBwdWJsaWMgU3RyaW5nIGN1cnJlbnRE\nYXRlRnVuY3Rpb24gPSAiQ1VSUkVOVF9EQVRFIjsKICAgIHB1YmxpYyBTdHJp\nbmcgY3VycmVudFRpbWVGdW5jdGlvbiA9ICJDVVJSRU5UX1RJTUUiOwogICAg\ncHVibGljIFN0cmluZyBjdXJyZW50VGltZXN0YW1wRnVuY3Rpb24gPSAiQ1VS\nUkVOVF9USU1FU1RBTVAiOwogICAgcHVibGljIFN0cmluZyBkcm9wVGFibGVT\nUUwgPSAiRFJPUCBUQUJMRSB7MH0iOwoKICAgIC8vIHR5cGVzCiAgICBwdWJs\naWMgYm9vbGVhbiBzdG9yYWdlTGltaXRhdGlvbnNGYXRhbCA9IGZhbHNlOwog\nICAgcHVibGljIGJvb2xlYW4gc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3Mg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN0b3JlQ2hhcnNBc051bWJl\ncnMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0Qnl0ZXNGb3JC\nbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlU2V0Qnl0ZXNG\nb3JCbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0T2Jq\nZWN0Rm9yQmxvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZUdl\ndFN0cmluZ0ZvckNsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1\nc2VTZXRTdHJpbmdGb3JDbG9icyA9IGZhbHNlOwogICAgcHVibGljIGludCBt\nYXhFbWJlZGRlZEJsb2JTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IG1heEVt\nYmVkZGVkQ2xvYlNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgaW5DbGF1c2VM\naW1pdCA9IC0xOwogICAgcHVibGljIGludCBkYXRlUHJlY2lzaW9uID0gTUlM\nTEk7CiAgICBwdWJsaWMgaW50IGNoYXJhY3RlckNvbHVtblNpemUgPSAyNTU7\nCiAgICBwdWJsaWMgU3RyaW5nIGFycmF5VHlwZU5hbWUgPSAiQVJSQVkiOwog\nICAgcHVibGljIFN0cmluZyBiaWdpbnRUeXBlTmFtZSA9ICJCSUdJTlQiOwog\nICAgcHVibGljIFN0cmluZyBiaW5hcnlUeXBlTmFtZSA9ICJCSU5BUlkiOwog\nICAgcHVibGljIFN0cmluZyBiaXRUeXBlTmFtZSA9ICJCSVQiOwogICAgcHVi\nbGljIFN0cmluZyBibG9iVHlwZU5hbWUgPSAiQkxPQiI7CiAgICBwdWJsaWMg\nU3RyaW5nIGJvb2xlYW5UeXBlTmFtZSA9ICJCT09MRUFOIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgY2hhclR5cGVOYW1lID0gIkNIQVIiOwogICAgcHVibGljIFN0\ncmluZyBjbG9iVHlwZU5hbWUgPSAiQ0xPQiI7CiAgICBwdWJsaWMgU3RyaW5n\nIGRhdGVUeXBlTmFtZSA9ICJEQVRFIjsKICAgIHB1YmxpYyBTdHJpbmcgZGVj\naW1hbFR5cGVOYW1lID0gIkRFQ0lNQUwiOwogICAgcHVibGljIFN0cmluZyBk\naXN0aW5jdFR5cGVOYW1lID0gIkRJU1RJTkNUIjsKICAgIHB1YmxpYyBTdHJp\nbmcgZG91YmxlVHlwZU5hbWUgPSAiRE9VQkxFIjsKICAgIHB1YmxpYyBTdHJp\nbmcgZmxvYXRUeXBlTmFtZSA9ICJGTE9BVCI7CiAgICBwdWJsaWMgU3RyaW5n\nIGludGVnZXJUeXBlTmFtZSA9ICJJTlRFR0VSIjsKICAgIHB1YmxpYyBTdHJp\nbmcgamF2YU9iamVjdFR5cGVOYW1lID0gIkpBVkFfT0JKRUNUIjsKICAgIHB1\nYmxpYyBTdHJpbmcgbG9uZ1ZhcmJpbmFyeVR5cGVOYW1lID0gIkxPTkdWQVJC\nSU5BUlkiOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyY2hhclR5cGVOYW1l\nID0gIkxPTkdWQVJDSEFSIjsKICAgIHB1YmxpYyBTdHJpbmcgbnVsbFR5cGVO\nYW1lID0gIk5VTEwiOwogICAgcHVibGljIFN0cmluZyBudW1lcmljVHlwZU5h\nbWUgPSAiTlVNRVJJQyI7CiAgICBwdWJsaWMgU3RyaW5nIG90aGVyVHlwZU5h\nbWUgPSAiT1RIRVIiOwogICAgcHVibGljIFN0cmluZyByZWFsVHlwZU5hbWUg\nPSAiUkVBTCI7CiAgICBwdWJsaWMgU3RyaW5nIHJlZlR5cGVOYW1lID0gIlJF\nRiI7CiAgICBwdWJsaWMgU3RyaW5nIHNtYWxsaW50VHlwZU5hbWUgPSAiU01B\nTExJTlQiOwogICAgcHVibGljIFN0cmluZyBzdHJ1Y3RUeXBlTmFtZSA9ICJT\nVFJVQ1QiOwogICAgcHVibGljIFN0cmluZyB0aW1lVHlwZU5hbWUgPSAiVElN\nRSI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbWVzdGFtcFR5cGVOYW1lID0gIlRJ\nTUVTVEFNUCI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbnlpbnRUeXBlTmFtZSA9\nICJUSU5ZSU5UIjsKICAgIHB1YmxpYyBTdHJpbmcgdmFyYmluYXJ5VHlwZU5h\nbWUgPSAiVkFSQklOQVJZIjsKICAgIHB1YmxpYyBTdHJpbmcgdmFyY2hhclR5\ncGVOYW1lID0gIlZBUkNIQVIiOwogICAgcHVibGljIFN0cmluZyB4bWxUeXBl\nTmFtZSA9ICJYTUwiOwogICAgcHVibGljIFN0cmluZyBnZXRTdHJpbmdWYWwg\nPSAiIjsKCiAgICAvLyBzY2hlbWEgbWV0YWRhdGEKICAgIHB1YmxpYyBib29s\nZWFuIHVzZVNjaGVtYU5hbWUgPSB0cnVlOwogICAgcHVibGljIFN0cmluZyB0\nYWJsZVR5cGVzID0gIlRBQkxFIjsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzU2NoZW1hRm9yR2V0VGFibGVzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzU2NoZW1hRm9yR2V0Q29sdW1ucyA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldENvbHVtbnMg\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNOdWxsVGFibGVG\nb3JHZXRQcmltYXJ5S2V5cyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbmRleEluZm8gPSBmYWxzZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0SW1wb3J0\nZWRLZXlzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VHZXRCZXN0\nUm93SWRlbnRpZmllckZvclByaW1hcnlLZXlzID0gZmFsc2U7CiAgICBwdWJs\naWMgYm9vbGVhbiByZXF1aXJlc0F1dG9Db21taXRGb3JNZXRhRGF0YSA9IGZh\nbHNlOwoKICAgIC8vIGF1dG8taW5jcmVtZW50CiAgICBwdWJsaWMgaW50IG1h\neEF1dG9Bc3NpZ25OYW1lTGVuZ3RoID0gMzE7CiAgICBwdWJsaWMgU3RyaW5n\nIGF1dG9Bc3NpZ25DbGF1c2UgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBh\ndXRvQXNzaWduVHlwZU5hbWUgPSBudWxsOwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNBdXRvQXNzaWduID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5n\nIGxhc3RHZW5lcmF0ZWRLZXlRdWVyeSA9IG51bGw7CiAgICBwdWJsaWMgU3Ry\naW5nIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gbnVsbDsKICAgIHB1YmxpYyBTdHJp\nbmcgc2VxdWVuY2VTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzZXF1\nZW5jZVNjaGVtYVNRTCA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHNlcXVl\nbmNlTmFtZVNRTCA9IG51bGw7CgogICAgcHJvdGVjdGVkIEpEQkNDb25maWd1\ncmF0aW9uIGNvbmYgPSBudWxsOwogICAgcHJvdGVjdGVkIExvZyBsb2cgPSBu\ndWxsOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gY29ubmVjdGVkID0gZmFsc2U7\nCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHJlc2VydmVkV29yZFNldCA9IG5l\ndyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHN5c3RlbVNj\naGVtYVNldCA9IG5ldyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0ZWQgZmluYWwg\nU2V0IHN5c3RlbVRhYmxlU2V0ID0gbmV3IEhhc2hTZXQoKTsKICAgIHByb3Rl\nY3RlZCBmaW5hbCBTZXQgZml4ZWRTaXplVHlwZU5hbWVTZXQgPSBuZXcgSGFz\naFNldCgpOwoKICAgIC8qKgogICAgICogSWYgYSBuYXRpdmUgcXVlcnkgYmVn\naW5zIHdpdGggYW55IG9mIHRoZSB2YWx1ZXMgZm91bmQgaGVyZSB0aGVuIGl0\nIHdpbGwKICAgICAqIGJlIHRyZWF0ZWQgYXMgYSBzZWxlY3Qgc3RhdGVtZW50\nLiAgCiAgICAgKi8KICAgIHByb3RlY3RlZCBmaW5hbCBTZXQgc2VsZWN0V29y\nZFNldCA9IG5ldyBIYXNoU2V0KCk7CgogICAgLy8gd2hlbiB3ZSBzdG9yZSB2\nYWx1ZXMgdGhhdCBsb3NlIHByZWNpb24sIHRyYWNrIHRoZSB0eXBlcyBzbyB0\naGF0IHRoZQogICAgLy8gZmlyc3QgdGltZSBpdCBoYXBwZW5zIHdlIGNhbiB3\nYXJuIHRoZSB1c2VyCiAgICBwcml2YXRlIFNldCBfcHJlY2lzaW9uV2FybmVk\nVHlwZXMgPSBudWxsOwoKICAgIC8vIGNhY2hlIGxvYiBtZXRob2RzCiAgICBw\ncml2YXRlIE1ldGhvZCBfc2V0Qnl0ZXMgPSBudWxsOwogICAgcHJpdmF0ZSBN\nZXRob2QgX3NldFN0cmluZyA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCBf\nc2V0Q2hhclN0cmVhbSA9IG51bGw7CgogICAgcHVibGljIERCRGljdGlvbmFy\neSgpIHsKICAgICAgICBmaXhlZFNpemVUeXBlTmFtZVNldC5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAgICJCSUdJTlQi\nLCAiQklUIiwgIkJMT0IiLCAiQ0xPQiIsICJEQVRFIiwgIkRFQ0lNQUwiLCAi\nRElTVElOQ1QiLAogICAgICAgICAgICAiRE9VQkxFIiwgIkZMT0FUIiwgIklO\nVEVHRVIiLCAiSkFWQV9PQkpFQ1QiLCAiTlVMTCIsICJOVU1FUklDIiwKICAg\nICAgICAgICAgIk9USEVSIiwgIlJFQUwiLCAiUkVGIiwgIlNNQUxMSU5UIiwg\nIlNUUlVDVCIsICJUSU1FIiwgIlRJTUVTVEFNUCIsCiAgICAgICAgICAgICJU\nSU5ZSU5UIiwKICAgICAgICB9KSk7CiAgICAgICAgCiAgICAgICAgc2VsZWN0\nV29yZFNldC5hZGQoIlNFTEVDVCIpOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW4gdGhlIGRpY3Rpb25hcnkgZmly\nc3Qgc2VlcyBhbnkgY29ubmVjdGlvbi4KICAgICAqIEl0IGlzIHVzZWQgdG8g\naW5pdGlhbGl6ZSBkaWN0aW9uYXJ5IG1ldGFkYXRhIGlmIG5lZWRlZC4gSWYg\neW91CiAgICAgKiBvdmVycmlkZSB0aGlzIG1ldGhvZCwgYmUgc3VyZSB0byBj\nYWxsCiAgICAgKiA8Y29kZT5zdXBlci5jb25uZWN0ZWRDb25maWd1cmF0aW9u\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgY29ubmVjdGVkQ29u\nZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFjb25uZWN0ZWQpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoREJEaWN0\naW9uYXJ5RmFjdG9yeS50b1N0cmluZwogICAgICAgICAgICAgICAgICAgICAg\nICAoY29ubi5nZXRNZXRhRGF0YSgpKSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBsb2cudHJhY2UoZS50\nb1N0cmluZygpLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBjb25uZWN0ZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFJlc3VsdFNldCB3cmFwcGVycwogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUg\nc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUg\ncHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBB\ncnJheSBnZXRBcnJheShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdl\ndEFycmF5KGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRv\nIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIElucHV0U3RyZWFtIGdldEFzY2lpU3RyZWFtKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gcnMuZ2V0QXNjaWlTdHJlYW0oY29sdW1uKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4g\nb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2\nYSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQmlnRGVjaW1hbCBnZXRCaWdE\nZWNpbWFsKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3RvcmVMYXJnZU51bWJl\ncnNBc1N0cmluZ3MpIHsKICAgICAgICAgICAgU3RyaW5nIHN0ciA9IGdldFN0\ncmluZyhycywgY29sdW1uKTsKICAgICAgICAgICAgcmV0dXJuIChzdHIgPT0g\nbnVsbCkgPyBudWxsIDogbmV3IEJpZ0RlY2ltYWwoc3RyKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHJzLmdldEJpZ0RlY2ltYWwoY29sdW1uKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gdmFsdWUgYXMgYW4gdW5rbm93biBudW1lcmljIHR5cGU7CiAgICAgKiB3\nZSB0cnkgZnJvbSB0aGUgbW9zdCBnZW5lcmljIHRvIHRoZSBsZWFzdCBnZW5l\ncmljLgogICAgICovCiAgICBwdWJsaWMgTnVtYmVyIGdldE51bWJlcihSZXN1\nbHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gdHJ5IGZyb20gdGhlIG1vc3QgZ2VuZXJpYywg\nYW5kIGlmIGVycm9ycyBvY2N1ciwgdHJ5CiAgICAgICAgLy8gbGVzcyBnZW5l\ncmljIHR5cGVzOyB0aGlzIGVuYWJsZXMgdXMgdG8gaGFuZGxlIHZhbHVlcwog\nICAgICAgIC8vIGxpa2UgRG91YmxlLk5hTiB3aXRob3V0IGhhdmluZyB0byBp\nbnRyb3NwZWN0IG9uIHRoZQogICAgICAgIC8vIFJlc3VsdFNldE1ldGFEYXRh\nIChidWcgIzEwNTMpLiBub3RlIHRoYXQgd2UgaGFuZGxlCiAgICAgICAgLy8g\nZ2VuZXJpYyBleGNlcHRpb25zLCBzaW5jZSBzb21lIGRyaXZlcnMgbWF5IHRo\ncm93CiAgICAgICAgLy8gTnVtYmVyRm9ybWF0RXhjZXB0aW9ucywgd2hlcmVh\ncyBvdGhlcnMgbWF5IHRocm93IFNRTEV4Y2VwdGlvbnMKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gZ2V0QmlnRGVjaW1hbChycywgY29sdW1u\nKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTEpIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlKGdl\ndERvdWJsZShycywgY29sdW1uKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlMikgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGdldEZsb2F0KHJzLCBjb2x1\nbW4pKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMykg\newogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZ2V0TG9uZyhycywgY29s\ndW1uKSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGU0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGdl\ndEludChycywgY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlNSkgewogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZTEgaW5zdGFuY2VvZiBS\ndW50aW1lRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdGhyb3coUnVudGlt\nZUV4Y2VwdGlvbikgZTE7CiAgICAgICAgICAgIGlmIChlMSBpbnN0YW5jZW9m\nIFNRTEV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93KFNRTEV4Y2Vw\ndGlvbikgZTE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQmlnSW50ZWdlciBnZXRC\naWdJbnRlZ2VyKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3RvcmVMYXJnZU51\nbWJlcnNBc1N0cmluZ3MpIHsKICAgICAgICAgICAgU3RyaW5nIHN0ciA9IGdl\ndFN0cmluZyhycywgY29sdW1uKTsKICAgICAgICAgICAgcmV0dXJuIChzdHIg\nPT0gbnVsbCkgPyBudWxsIDogbmV3IEJpZ0RlY2ltYWwoc3RyKS50b0JpZ0lu\ndGVnZXIoKTsKICAgICAgICB9CiAgICAgICAgQmlnRGVjaW1hbCBiZCA9IGdl\ndEJpZ0RlY2ltYWwocnMsIGNvbHVtbik7CiAgICAgICAgcmV0dXJuIChiZCA9\nPSBudWxsKSA/IG51bGwgOiBiZC50b0JpZ0ludGVnZXIoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgSW5wdXRTdHJlYW0gZ2V0QmluYXJ5\nU3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QmluYXJ5\nU3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRv\nIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIEJsb2IgZ2V0QmxvYihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJz\nLmdldEJsb2IoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\ncnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQg\ndG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgT2JqZWN0IGdldEJsb2JPYmplY3QoUmVzdWx0U2V0IHJzLCBpbnQg\nY29sdW1uLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgSW5wdXRTdHJlYW0gaW4gPSBudWxsOwogICAg\nICAgIGlmICh1c2VHZXRCeXRlc0ZvckJsb2JzIHx8IHVzZUdldE9iamVjdEZv\nckJsb2JzKSB7CiAgICAgICAgICAgIGJ5dGVbXSBieXRlcyA9IGdldEJ5dGVz\nKHJzLCBjb2x1bW4pOwogICAgICAgICAgICBpZiAoYnl0ZXMgIT0gbnVsbCAm\nJiBieXRlcy5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgaW4gPSBuZXcg\nQnl0ZUFycmF5SW5wdXRTdHJlYW0oYnl0ZXMpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIEJsb2IgYmxvYiA9IGdldEJsb2IocnMsIGNvbHVtbik7\nCiAgICAgICAgICAgIGlmIChibG9iICE9IG51bGwgJiYgYmxvYi5sZW5ndGgo\nKSA+IDApCiAgICAgICAgICAgICAgICBpbiA9IGJsb2IuZ2V0QmluYXJ5U3Ry\nZWFtKCk7CiAgICAgICAgfQogICAgICAgIGlmIChpbiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKHN0b3JlID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4g\nU2VyaWFsaXphdGlvbi5kZXNlcmlhbGl6ZShpbiwgbnVsbCk7CiAgICAgICAg\nICAgIHJldHVybiBTZXJpYWxpemF0aW9uLmRlc2VyaWFsaXplKGluLCBzdG9y\nZS5nZXRDb250ZXh0KCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpbi5jbG9zZSgpOwogICAgICAg\nICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRCb29sZWFuKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\ncnMuZ2V0Qm9vbGVhbihjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBieXRlIGdldEJ5dGUoUmVzdWx0U2V0IHJzLCBpbnQgY29s\ndW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBycy5nZXRCeXRlKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVz\ndWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIGJ5dGVbXSBnZXRCeXRlcyhSZXN1bHRTZXQgcnMsIGlu\ndCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKHVzZUdldEJ5dGVzRm9yQmxvYnMpCiAgICAgICAgICAgIHJldHVy\nbiBycy5nZXRCeXRlcyhjb2x1bW4pOwogICAgICAgIGlmICh1c2VHZXRPYmpl\nY3RGb3JCbG9icykKICAgICAgICAgICAgcmV0dXJuIChieXRlW10pIHJzLmdl\ndE9iamVjdChjb2x1bW4pOwoKICAgICAgICBCbG9iIGJsb2IgPSBnZXRCbG9i\nKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChibG9iID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGludCBsZW5ndGggPSAoaW50\nKSBibG9iLmxlbmd0aCgpOwogICAgICAgIGlmIChsZW5ndGggPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGJsb2IuZ2V0\nQnl0ZXMoMSwgbGVuZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\ncnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQg\ndG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLiBDb252ZXJ0cyB0aGUg\nZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFtcH0gYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIENhbGVuZGFyIGdldENhbGVuZGFyKFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBEYXRlIGQgPSBnZXREYXRlKHJzLCBjb2x1bW4pOwogICAg\nICAgIGlmIChkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBDYWxlbmRhciBjYWwgPSBDYWxlbmRhci5nZXRJbnN0YW5jZSgp\nOwogICAgICAgIGNhbC5zZXRUaW1lKGQpOwogICAgICAgIHJldHVybiBjYWw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGNoYXIgZ2V0Q2hh\ncihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHN0b3JlQ2hhcnNBc051bWJlcnMp\nCiAgICAgICAgICAgIHJldHVybiAoY2hhcikgZ2V0SW50KHJzLCBjb2x1bW4p\nOwoKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJzLCBjb2x1bW4p\nOwogICAgICAgIHJldHVybiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzdHIpKSA/\nIDAgOiBzdHIuY2hhckF0KDApOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBSZWFkZXIgZ2V0Q2hhcmFjdGVyU3RyZWFtKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gcnMuZ2V0Q2hhcmFjdGVyU3RyZWFtKGNvbHVtbik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIENsb2IgZ2V0Q2xv\nYihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldENsb2IoY29sdW1u\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndENsb2JTdHJpbmcoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh1c2VHZXRTdHJp\nbmdGb3JDbG9icykKICAgICAgICAgICAgcmV0dXJuIHJzLmdldFN0cmluZyhj\nb2x1bW4pOwoKICAgICAgICBDbG9iIGNsb2IgPSBnZXRDbG9iKHJzLCBjb2x1\nbW4pOwogICAgICAgIGlmIChjbG9iID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIGlmIChjbG9iLmxlbmd0aCgpID09IDApCiAg\nICAgICAgICAgIHJldHVybiAiIjsKCiAgICAgICAgLy8gdW5saWtlbHkgdGhh\ndCB3ZSdsbCBoYXZlIHN0cmluZ3Mgb3ZlciBJbnRlZ2VyLk1BWF9WQUxVRSBj\naGFycwogICAgICAgIHJldHVybiBjbG9iLmdldFN1YlN0cmluZygxLCAoaW50\nKSBjbG9iLmxlbmd0aCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\ncnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQg\ndG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLiBDb252ZXJ0cyB0aGUg\nZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFtcH0gYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIERhdGUgZ2V0RGF0ZShSZXN1bHRTZXQgcnMsIGlu\ndCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgVGltZXN0YW1wIHRzdGFtcCA9IGdldFRpbWVzdGFtcChycywgY29sdW1u\nLCBudWxsKTsKICAgICAgICBpZiAodHN0YW1wID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBnZXQgdGhlIGZyYWN0aW9u\nYWwgc2Vjb25kcyBjb21wb25lbnQsIHJvdW5kaW5nIGF3YXkgYW55dGhpbmcg\nYmV5b25kCiAgICAgICAgLy8gbWlsbGlzZWNvbmRzCiAgICAgICAgaW50IGZy\nYWN0aW9uYWwgPSAoaW50KSBNYXRoLnJvdW5kKHRzdGFtcC5nZXROYW5vcygp\nIC8gKGRvdWJsZSkgTUlMTEkpOwoKICAgICAgICAvLyBnZXQgdGhlIG1pbGxp\ncyBjb21wb25lbnQ7IHNvbWUgSkRCQyBkcml2ZXJzIHJvdW5kIHRoaXMgdG8g\ndGhlCiAgICAgICAgLy8gbmVhcmVzdCBzZWNvbmQsIHdoaWxlIG90aGVycyBk\nbyBub3QKICAgICAgICBsb25nIG1pbGxpcyA9ICh0c3RhbXAuZ2V0VGltZSgp\nIC8gMTAwMEwpICogMTAwMEw7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKG1p\nbGxpcyArIGZyYWN0aW9uYWwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBqYXZhLnNxbC5EYXRlIGdldERhdGUoUmVzdWx0U2V0IHJzLCBp\nbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gcnMuZ2V0RGF0ZShjb2x1bW4pOwogICAgICAgIHJldHVybiBy\ncy5nZXREYXRlKGNvbHVtbiwgY2FsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1\nbHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICov\nCiAgICBwdWJsaWMgZG91YmxlIGdldERvdWJsZShSZXN1bHRTZXQgcnMsIGlu\ndCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgcmV0dXJuIHJzLmdldERvdWJsZShjb2x1bW4pOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUg\nU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBmbG9hdCBnZXRGbG9hdChSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEZsb2F0KGNvbHVtbik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9m\nIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEg\ndHlwZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRJbnQoUmVzdWx0U2V0\nIHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBycy5nZXRJbnQoY29sdW1uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgTG9jYWxlIGdldExvY2FsZShSZXN1\nbHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgU3RyaW5nIHN0ciA9IGdldFN0cmluZyhycywgY29s\ndW1uKTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzdHIpKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nW10gcGFy\nYW1zID0gU3RyaW5ncy5zcGxpdChzdHIsICJfIiwgMyk7CiAgICAgICAgaWYg\nKHBhcmFtcy5sZW5ndGggPCAzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICByZXR1cm4gbmV3IExvY2FsZShwYXJhbXNbMF0sIHBhcmFtc1sx\nXSwgcGFyYW1zWzJdKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8g\ndGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgbG9uZyBnZXRMb25nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMu\nZ2V0TG9uZyhjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVy\ndCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0\nbyB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBPYmplY3QgZ2V0T2JqZWN0KFJlc3VsdFNldCBycywgaW50IGNvbHVt\nbiwgTWFwIG1hcCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAobWFwID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5n\nZXRPYmplY3QoY29sdW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0T2JqZWN0\nKGNvbHVtbiwgbWFwKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8g\ndGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgUmVmIGdldFJlZihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIE1hcCBt\nYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHJzLmdldFJlZihjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBzaG9ydCBnZXRTaG9ydChSZXN1bHRTZXQgcnMsIGludCBj\nb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIHJzLmdldFNob3J0KGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwg\nUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTdHJpbmcoUmVzdWx0U2V0IHJz\nLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBycy5nZXRTdHJpbmcoY29sdW1uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgVGltZSBnZXRUaW1lKFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbiwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIHJzLmdldFRpbWUoY29sdW1uKTsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0VGltZShjb2x1bW4sIGNhbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBT\nUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIFRpbWVzdGFtcCBnZXRUaW1lc3RhbXAoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0VGltZXN0YW1wKGNvbHVtbik7\nCiAgICAgICAgcmV0dXJuIHJzLmdldFRpbWVzdGFtcChjb2x1bW4sIGNhbCk7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBQcmVwYXJlZFN0YXRlbWVudCB3cmFwcGVycwogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEFycmF5KFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBBcnJheSB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBzdG1udC5zZXRBcnJheShpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEFzY2lp\nU3RyZWFtKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LAogICAg\nICAgIElucHV0U3RyZWFtIHZhbCwgaW50IGxlbmd0aCwgQ29sdW1uIGNvbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5z\nZXRBc2NpaVN0cmVhbShpZHgsIHZhbCwgbGVuZ3RoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIg\ndG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQmlnRGVjaW1hbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\nQmlnRGVjaW1hbCB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoKGNvbCAhPSBudWxs\nICYmIGNvbC5pc0NvbXBhdGlibGUoVHlwZXMuVkFSQ0hBUiwgbnVsbCwgMCwg\nMCkpCiAgICAgICAgICAgIHx8IChjb2wgPT0gbnVsbCAmJiBzdG9yZUxhcmdl\nTnVtYmVyc0FzU3RyaW5ncykpCiAgICAgICAgICAgIHNldFN0cmluZyhzdG1u\ndCwgaWR4LCB2YWwudG9TdHJpbmcoKSwgY29sKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHN0bW50LnNldEJpZ0RlY2ltYWwoaWR4LCB2YWwpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBh\ncmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRCaWdJbnRlZ2VyKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBCaWdJbnRlZ2VyIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICgoY29s\nICE9IG51bGwgJiYgY29sLmlzQ29tcGF0aWJsZShUeXBlcy5WQVJDSEFSLCBu\ndWxsLCAwLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9PSBudWxsICYmIHN0\nb3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSkKICAgICAgICAgICAgc2V0U3Ry\naW5nKHN0bW50LCBpZHgsIHZhbC50b1N0cmluZygpLCBjb2wpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCBu\nZXcgQmlnRGVjaW1hbCh2YWwpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUg\nc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCaW5hcnlT\ndHJlYW0oUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAg\nICAgSW5wdXRTdHJlYW0gdmFsLCBpbnQgbGVuZ3RoLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNl\ndEJpbmFyeVN0cmVhbShpZHgsIHZhbCwgbGVuZ3RoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIg\ndG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQmxvYihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQmxvYiB2\nYWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgc3RtbnQuc2V0QmxvYihpZHgsIHZhbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuIFVzZXMgdGhlCiAgICAgKiB7QGxpbmsgI3Nl\ncmlhbGl6ZX0gbWV0aG9kIHRvIHNlcmlhbGl6ZSB0aGUgdmFsdWUuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEJsb2JPYmplY3QoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVjdCB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIHNlcmlh\nbGl6ZSh2YWwsIHN0b3JlKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qm9vbGVhbihQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgYm9vbGVhbiB2YWws\nCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXRJbnQoaWR4LCAodmFsKSA/IDEgOiAw\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Qnl0ZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgYnl0ZSB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0Qnl0ZShpZHgsIHZh\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVl\nIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldEJ5dGVzKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBieXRlW10gdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZVNl\ndEJ5dGVzRm9yQmxvYnMpCiAgICAgICAgICAgIHN0bW50LnNldEJ5dGVzKGlk\neCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldEJpbmFyeVN0\ncmVhbShzdG1udCwgaWR4LCBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0odmFs\nKSwKICAgICAgICAgICAgICAgIHZhbC5sZW5ndGgsIGNvbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1l\ndGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldENoYXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGNo\nYXIgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0\naWJsZShUeXBlcy5JTlRFR0VSLCBudWxsLCAwLCAwKSkKICAgICAgICAgICAg\nfHwgKGNvbCA9PSBudWxsICYmIHN0b3JlQ2hhcnNBc051bWJlcnMpKQogICAg\nICAgICAgICBzZXRJbnQoc3RtbnQsIGlkeCwgKGludCkgdmFsLCBjb2wpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgs\nIFN0cmluZy52YWx1ZU9mKHZhbCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENoYXJh\nY3RlclN0cmVhbShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwK\nICAgICAgICBSZWFkZXIgdmFsLCBpbnQgbGVuZ3RoLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNl\ndENoYXJhY3RlclN0cmVhbShpZHgsIHZhbCwgbGVuZ3RoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0Q2xvYihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQ2xv\nYiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0Q2xvYihpZHgsIHZhbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1l\ndGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldENsb2JTdHJpbmcoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBp\nZHgsIFN0cmluZyB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNlU2V0U3RyaW5n\nRm9yQ2xvYnMpCiAgICAgICAgICAgIHN0bW50LnNldFN0cmluZyhpZHgsIHZh\nbCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHNldCByZWFkZXIg\nZnJvbSBzdHJpbmcKICAgICAgICAgICAgU3RyaW5nUmVhZGVyIGluID0gbmV3\nIFN0cmluZ1JlYWRlcih2YWwpOwogICAgICAgICAgICBzZXRDaGFyYWN0ZXJT\ndHJlYW0oc3RtbnQsIGlkeCwgaW4sIHZhbC5sZW5ndGgoKSwgY29sKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldERhdGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsIERhdGUgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjb2wgIT0gbnVsbCAm\nJiBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkRBVEUpCiAgICAgICAgICAgIHNl\ndERhdGUoc3RtbnQsIGlkeCwgbmV3IGphdmEuc3FsLkRhdGUodmFsLmdldFRp\nbWUoKSksIG51bGwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAoY29sICE9IG51\nbGwgJiYgY29sLmdldFR5cGUoKSA9PSBUeXBlcy5USU1FKQogICAgICAgICAg\nICBzZXRUaW1lKHN0bW50LCBpZHgsIG5ldyBUaW1lKHZhbC5nZXRUaW1lKCkp\nLCBudWxsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIFRpbWVzdGFtcCkKICAgICAgICAgICAgc2V0VGltZXN0YW1wKHN0bW50LCBp\nZHgsKFRpbWVzdGFtcCkgdmFsLCBudWxsLCBjb2wpOyAgIAogICAgICAgIGVs\nc2UKICAgICAgICAgICAgc2V0VGltZXN0YW1wKHN0bW50LCBpZHgsIG5ldyBU\naW1lc3RhbXAodmFsLmdldFRpbWUoKSksIG51bGwsIGNvbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1l\ndGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldERhdGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGph\ndmEuc3FsLkRhdGUgdmFsLAogICAgICAgIENhbGVuZGFyIGNhbCwgQ29sdW1u\nIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0bW50LnNldERhdGUoaWR4\nLCB2YWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQuc2V0RGF0\nZShpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FsZW5kYXIoUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIENhbGVuZGFyIHZhbCwKICAg\nICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIC8vIGJ5IGRlZmF1bHQgd2UgbWVyZWx5IGRlbGVnYXRlIHRo\nZSB0aGUgRGF0ZSBwYXJhbWV0ZXIKICAgICAgICBzZXREYXRlKHN0bW50LCBp\nZHgsIHZhbC5nZXRUaW1lKCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBz\ndGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERvdWJsZShQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgZG91YmxlIHZhbCwK\nICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHN0bW50LnNldERvdWJsZShpZHgsIHZhbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFy\nYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldEZsb2F0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4\nLCBmbG9hdCB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRGbG9hdChpZHgs\nIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldEludChQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgaW50IGlkeCwgaW50IHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRJbnQoaWR4LCB2\nYWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRMb25nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBsb25nIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRMb25nKGlkeCwg\ndmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TG9jYWxlKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LCBMb2NhbGUgdmFsLAogICAgICAgIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0U3Ry\naW5nKHN0bW50LCBpZHgsIHZhbC5nZXRMYW5ndWFnZSgpICsgIl8iICsgdmFs\nLmdldENvdW50cnkoKQogICAgICAgICAgICArICJfIiArIHZhbC5nZXRWYXJp\nYW50KCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVycyB0byB0aGUgc3RhdGVtZW50LiBU\naGUgY29sdW1uCiAgICAgKiB0eXBlIHdpbGwgY29tZSBmcm9tIHtAbGluayBU\neXBlc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE51bGwoUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGludCBjb2xUeXBlLAogICAg\nICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgc3RtbnQuc2V0TnVsbChpZHgsIGNvbFR5cGUpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXROdW1iZXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgs\nIE51bWJlciBudW0sCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBjaGVjayBmb3Iga25vd24g\nZmxvYXRpbmcgcG9pbnQgdHlwZXMgdG8gZ2l2ZSBkcml2ZXIgYSBjaGFuY2Ug\ndG8KICAgICAgICAvLyBoYW5kbGUgc3BlY2lhbCBudW1iZXJzIGxpa2UgTmFO\nIGFuZCBpbmZpbml0eTsgYnVnICMxMDUzCiAgICAgICAgaWYgKG51bSBpbnN0\nYW5jZW9mIERvdWJsZSkKICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBp\nZHgsICgoRG91YmxlKSBudW0pLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAg\nICAgZWxzZSBpZiAobnVtIGluc3RhbmNlb2YgRmxvYXQpCiAgICAgICAgICAg\nIHNldEZsb2F0KHN0bW50LCBpZHgsICgoRmxvYXQpIG51bSkuZmxvYXRWYWx1\nZSgpLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0QmlnRGVj\naW1hbChzdG1udCwgaWR4LCBuZXcgQmlnRGVjaW1hbChudW0udG9TdHJpbmco\nKSksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVycyB0byB0aGUgc3RhdGVtZW50LiBUaGUg\nY29sdW1uCiAgICAgKiB0eXBlIHdpbGwgY29tZSBmcm9tIHtAbGluayBUeXBl\nc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9iamVjdChQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAg\nICBpbnQgY29sVHlwZSwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29sVHlwZSA9PSAtMSB8fCBjb2xU\neXBlID09IFR5cGVzLk9USEVSKQogICAgICAgICAgICBzdG1udC5zZXRPYmpl\nY3QoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQu\nc2V0T2JqZWN0KGlkeCwgdmFsLCBjb2xUeXBlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8g\ndGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVm\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBSZWYgdmFsLCBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHN0bW50LnNldFJlZihpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNob3J0\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBzaG9ydCB2YWws\nCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXRTaG9ydChpZHgsIHZhbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFy\nYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldFN0cmluZyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgU3RyaW5nIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldFN0cmluZyhp\nZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFRpbWUoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIFRpbWUgdmFsLAogICAgICAgIENhbGVuZGFyIGNh\nbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0bW50LnNl\ndFRpbWUoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rt\nbnQuc2V0VGltZShpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhl\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VGltZXN0\nYW1wKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LAogICAgICAg\nIFRpbWVzdGFtcCB2YWwsIENhbGVuZGFyIGNhbCwgQ29sdW1uIGNvbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBlbnN1cmUg\ndGhhdCB3ZSBkbyBub3QgaW5zZXJ0IGRhdGVzIGF0IGEgZ3JlYXRlciBwcmVj\naXNpb24gdGhhbgogICAgICAgIC8vIHRoYXQgYXQgd2hpY2ggdGhleSB3aWxs\nIGJlIHJldHVybmVkIGJ5IGEgU0VMRUNUCiAgICAgICAgaW50IHJvdW5kZWQg\nPSAoaW50KSBNYXRoLnJvdW5kKHZhbC5nZXROYW5vcygpIC8KICAgICAgICAg\nICAgKGRvdWJsZSkgZGF0ZVByZWNpc2lvbik7CiAgICAgICAgaW50IG5hbm9z\nID0gcm91bmRlZCAqIGRhdGVQcmVjaXNpb247CiAgICAgICAgaWYgKG5hbm9z\nID4gOTk5OTk5OTk5KSB7CiAgICAgICAgICAgIC8vIHJvbGxvdmVyIHRvIG5l\neHQgc2Vjb25kCiAgICAgICAgICAgIHZhbC5zZXRUaW1lKHZhbC5nZXRUaW1l\nKCkgKyAxMDAwKTsKICAgICAgICAgICAgbmFub3MgPSAwOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKHN1cHBvcnRzVGltZXN0YW1wTmFub3MpCiAgICAgICAg\nICAgIHZhbC5zZXROYW5vcyhuYW5vcyk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICB2YWwuc2V0TmFub3MoMCk7CgogICAgICAgIGlmIChjYWwgPT0gbnVs\nbCkKICAgICAgICAgICAgc3RtbnQuc2V0VGltZXN0YW1wKGlkeCwgdmFsKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNldFRpbWVzdGFtcChp\nZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGNv\nbHVtbiB2YWx1ZSBpbnRvIGEgcHJlcGFyZWQgc3RhdGVtZW50LgogICAgICoK\nICAgICAqIEBwYXJhbSBzdG1udCB0aGUgcHJlcGFyZWQgc3RhdGVtZW50IHRv\nIHBhcmFtZXRlcml6ZQogICAgICogQHBhcmFtIGlkeCB0aGUgaW5kZXggb2Yg\ndGhlIHBhcmFtZXRlciBpbiB0aGUgcHJlcGFyZWQgc3RhdGVtZW50CiAgICAg\nKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSBvZiB0aGUgY29sdW1uCiAgICAgKiBA\ncGFyYW0gY29sIHRoZSBjb2x1bW4gYmVpbmcgc2V0CiAgICAgKiBAcGFyYW0g\ndHlwZSB0aGUgZmllbGQgbWFwcGluZyB0eXBlIGNvZGUgZm9yIHRoZSB2YWx1\nZQogICAgICogQHBhcmFtIHN0b3JlIHRoZSBzdG9yZSBtYW5hZ2VyIGZvciB0\naGUgY3VycmVudCBjb250ZXh0CiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFR5cGVkKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBPYmpl\nY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wsIGludCB0eXBlLCBKREJDU3Rv\ncmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgIHNldE51bGwoc3Rt\nbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVzLk9USEVSIDogY29sLmdl\ndFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIFNpemVkIHM7CiAgICAgICAgQ2Fs\nZW5kYXJkIGM7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICAgICAgc2V0Qm9vbGVh\nbihzdG1udCwgaWR4LCAoKEJvb2xlYW4pIHZhbCkuYm9vbGVhblZhbHVlKCks\nIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURV9PQko6CiAgICAgICAgICAgICAgICBzZXRCeXRlKHN0bW50LCBpZHgs\nICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpLCBjb2wpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAg\nICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAoKENoYXJhY3RlcikgdmFs\nKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICBz\nZXREb3VibGUoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuZG91YmxlVmFs\ndWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgc2V0RmxvYXQoc3Rt\nbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1ZSgpLCBjb2wpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoK\nICAgICAgICAgICAgICAgIHNldEludChzdG1udCwgaWR4LCAoKE51bWJlcikg\ndmFsKS5pbnRWYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgc2V0\nTG9uZyhzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5sb25nVmFsdWUoKSwg\nY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgc2V0U2hvcnQoc3RtbnQsIGlk\neCwgKChOdW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgpLCBjb2wpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNU\nUklORzoKICAgICAgICAgICAgICAgIGlmIChjb2wgIT0gbnVsbCAmJiAoY29s\nLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9CCiAgICAgICAgICAgICAgICAgICAg\nfHwgY29sLmdldFR5cGUoKSA9PSBUeXBlcy5MT05HVkFSQ0hBUikpCiAgICAg\nICAgICAgICAgICAgICAgc2V0Q2xvYlN0cmluZyhzdG1udCwgaWR4LCAoU3Ry\naW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIChTdHJpbmcpIHZh\nbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBzZXRCbG9i\nT2JqZWN0KHN0bW50LCBpZHgsIHZhbCwgY29sLCBzdG9yZSk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFU\nRToKICAgICAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKERhdGUp\nIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIHNl\ndENhbGVuZGFyKHN0bW50LCBpZHgsIChDYWxlbmRhcikgdmFsLCBjb2wpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICBzZXRCaWdEZWNpbWFs\nKHN0bW50LCBpZHgsIChCaWdEZWNpbWFsKSB2YWwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklH\nSU5URUdFUjoKICAgICAgICAgICAgICAgIHNldEJpZ0ludGVnZXIoc3RtbnQs\nIGlkeCwgKEJpZ0ludGVnZXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5OVU1CRVI6CiAg\nICAgICAgICAgICAgICBzZXROdW1iZXIoc3RtbnQsIGlkeCwgKE51bWJlcikg\ndmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAgICAgICAgIHNldExv\nY2FsZShzdG1udCwgaWR4LCAoTG9jYWxlKSB2YWwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMu\nU1FMX0FSUkFZOgogICAgICAgICAgICAgICAgc2V0QXJyYXkoc3RtbnQsIGlk\neCwgKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQVNDSUlfU1RSRUFNOgog\nICAgICAgICAgICAgICAgcyA9IChTaXplZCkgdmFsOwogICAgICAgICAgICAg\nICAgc2V0QXNjaWlTdHJlYW0oc3RtbnQsIGlkeCwgKElucHV0U3RyZWFtKSBz\nLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQklOQVJZX1NUUkVBTToK\nICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAg\nICAgIHNldEJpbmFyeVN0cmVhbShzdG1udCwgaWR4LCAoSW5wdXRTdHJlYW0p\nIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CTE9COgogICAgICAg\nICAgICAgICAgc2V0QmxvYihzdG1udCwgaWR4LCAoQmxvYikgdmFsLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVNRTFR5cGVzLkJZVEVTOgogICAgICAgICAgICAgICAgc2V0Qnl0ZXMoc3Rt\nbnQsIGlkeCwgKGJ5dGVbXSkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNIQVJfU1RS\nRUFNOgogICAgICAgICAgICAgICAgcyA9IChTaXplZCkgdmFsOwogICAgICAg\nICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50LCBpZHgsIChSZWFk\nZXIpIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5DTE9COgogICAg\nICAgICAgICAgICAgc2V0Q2xvYihzdG1udCwgaWR4LCAoQ2xvYikgdmFsLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVNRTFR5cGVzLlNRTF9EQVRFOgogICAgICAgICAgICAgICAgaWYgKHZh\nbCBpbnN0YW5jZW9mIENhbGVuZGFyZCkgewogICAgICAgICAgICAgICAgICAg\nIGMgPSAoQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAgICAgICAgICAgICAgc2V0\nRGF0ZShzdG1udCwgaWR4LCAoamF2YS5zcWwuRGF0ZSkgYy52YWx1ZSwgYy5j\nYWxlbmRhciwKICAgICAgICAgICAgICAgICAgICAgICAgY29sKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNldERhdGUo\nc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZhbCwgbnVsbCwgY29sKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFT\nUUxUeXBlcy5SRUY6CiAgICAgICAgICAgICAgICBzZXRSZWYoc3RtbnQsIGlk\neCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUU6CiAgICAgICAgICAg\nICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAg\nICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQpIHZhbDsKICAgICAgICAgICAg\nICAgICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIChUaW1lKSBjLnZhbHVlLCBj\nLmNhbGVuZGFyLCBjb2wpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4LCAoVGltZSkgdmFs\nLCBudWxsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAg\nICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcmQpIHsKICAgICAgICAg\nICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFsOwogICAgICAgICAgICAg\nICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAoVGltZXN0YW1wKSBj\nLnZhbHVlLCBjLmNhbGVuZGFyLAogICAgICAgICAgICAgICAgICAgICAgICBj\nb2wpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgc2V0VGltZXN0YW1wKHN0bW50LCBpZHgsIChUaW1lc3RhbXApIHZhbCwg\nbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaWYgKGNvbCAhPSBudWxsICYm\nIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IKICAgICAgICAgICAgICAg\nICAgICB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLlZBUkJJTkFSWSkpCiAg\nICAgICAgICAgICAgICAgICAgc2V0QmxvYk9iamVjdChzdG1udCwgaWR4LCB2\nYWwsIGNvbCwgc3RvcmUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHNldE9iamVjdChzdG1udCwgaWR4LCB2YWwsIGNvbC5n\nZXRUeXBlKCksIGNvbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IGEgY29tcGxldGVseSB1bmtub3duIHBhcmFtZXRlciBpbnRvIGEg\ncHJlcGFyZWQgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRVbmtub3duKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBP\nYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2l6ZWQgc2l6ZWQgPSBudWxsOwog\nICAgICAgIENhbGVuZGFyZCBjYWxkID0gbnVsbDsKICAgICAgICBpZiAodmFs\nIGluc3RhbmNlb2YgU2l6ZWQpIHsKICAgICAgICAgICAgc2l6ZWQgPSAoU2l6\nZWQpIHZhbDsKICAgICAgICAgICAgdmFsID0gc2l6ZWQudmFsdWU7CiAgICAg\nICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcmQpIHsKICAg\nICAgICAgICAgY2FsZCA9IChDYWxlbmRhcmQpIHZhbDsKICAgICAgICAgICAg\ndmFsID0gY2FsZC52YWx1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh2YWwg\nPT0gbnVsbCkKICAgICAgICAgICAgc2V0TnVsbChzdG1udCwgaWR4LCAoY29s\nID09IG51bGwpID8gVHlwZXMuT1RIRVIgOiBjb2wuZ2V0VHlwZSgpLAogICAg\nICAgICAgICAgICAgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFu\nY2VvZiBTdHJpbmcpCiAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4\nLCB2YWwudG9TdHJpbmcoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwg\naW5zdGFuY2VvZiBJbnRlZ2VyKQogICAgICAgICAgICBzZXRJbnQoc3RtbnQs\nIGlkeCwgKChJbnRlZ2VyKSB2YWwpLmludFZhbHVlKCksIGNvbCk7CiAgICAg\nICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQm9vbGVhbikKICAgICAgICAg\nICAgc2V0Qm9vbGVhbihzdG1udCwgaWR4LCAoKEJvb2xlYW4pIHZhbCkuYm9v\nbGVhblZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3Rh\nbmNlb2YgTG9uZykKICAgICAgICAgICAgc2V0TG9uZyhzdG1udCwgaWR4LCAo\nKExvbmcpIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgRmxvYXQpCiAgICAgICAgICAgIHNldEZsb2F0\nKHN0bW50LCBpZHgsICgoRmxvYXQpIHZhbCkuZmxvYXRWYWx1ZSgpLCBjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERvdWJsZSkKICAg\nICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgsICgoRG91YmxlKSB2YWwp\nLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGlu\nc3RhbmNlb2YgQnl0ZSkKICAgICAgICAgICAgc2V0Qnl0ZShzdG1udCwgaWR4\nLCAoKEJ5dGUpIHZhbCkuYnl0ZVZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgQ2hhcmFjdGVyKQogICAgICAgICAgICBz\nZXRDaGFyKHN0bW50LCBpZHgsICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1\nZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFNo\nb3J0KQogICAgICAgICAgICBzZXRTaG9ydChzdG1udCwgaWR4LCAoKFNob3J0\nKSB2YWwpLnNob3J0VmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBMb2NhbGUpCiAgICAgICAgICAgIHNldExvY2FsZShz\ndG1udCwgaWR4LCAoTG9jYWxlKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgQmlnRGVjaW1hbCkKICAgICAgICAgICAgc2V0\nQmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVjaW1hbCkgdmFsLCBjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJpZ0ludGVnZXIp\nCiAgICAgICAgICAgIHNldEJpZ0ludGVnZXIoc3RtbnQsIGlkeCwgKEJpZ0lu\ndGVnZXIpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFu\nY2VvZiBBcnJheSkKICAgICAgICAgICAgc2V0QXJyYXkoc3RtbnQsIGlkeCwg\nKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3Rh\nbmNlb2YgQmxvYikKICAgICAgICAgICAgc2V0QmxvYihzdG1udCwgaWR4LCAo\nQmxvYikgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIGJ5dGVbXSkKICAgICAgICAgICAgc2V0Qnl0ZXMoc3RtbnQsIGlkeCwg\nKGJ5dGVbXSkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0\nYW5jZW9mIENsb2IpCiAgICAgICAgICAgIHNldENsb2Ioc3RtbnQsIGlkeCwg\nKENsb2IpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFu\nY2VvZiBSZWYpCiAgICAgICAgICAgIHNldFJlZihzdG1udCwgaWR4LCAoUmVm\nKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2Yg\namF2YS5zcWwuRGF0ZSkKICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4\nLCAoamF2YS5zcWwuRGF0ZSkgdmFsLAogICAgICAgICAgICAgICAgKGNhbGQg\nPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lc3RhbXApCiAgICAgICAg\nICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAoVGltZXN0YW1wKSB2YWws\nCiAgICAgICAgICAgICAgICAoY2FsZCA9PSBudWxsKSA/IG51bGwgOiBjYWxk\nLmNhbGVuZGFyLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIFRpbWUpCiAgICAgICAgICAgIHNldFRpbWUoc3RtbnQsIGlkeCwgKFRp\nbWUpIHZhbCwKICAgICAgICAgICAgICAgIChjYWxkID09IG51bGwpID8gbnVs\nbCA6IGNhbGQuY2FsZW5kYXIsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFs\nIGluc3RhbmNlb2YgRGF0ZSkKICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwg\naWR4LCAoRGF0ZSkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIENhbGVuZGFyKQogICAgICAgICAgICBzZXREYXRlKHN0bW50\nLCBpZHgsICgoQ2FsZW5kYXIpIHZhbCkuZ2V0VGltZSgpLCBjb2wpOwogICAg\nICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJlYWRlcikKICAgICAgICAg\nICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50LCBpZHgsIChSZWFkZXIpIHZh\nbCwKICAgICAgICAgICAgICAgIChzaXplZCA9PSBudWxsKSA/IDAgOiBzaXpl\nZC5zaXplLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1wYXJhbSIsIHZhbC5n\nZXRDbGFzcygpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHNlcmlhbGl6ZWQgYnl0ZXMgZm9yIHRoZSBnaXZlbiBvYmplY3QuCiAgICAg\nKi8KICAgIHB1YmxpYyBieXRlW10gc2VyaWFsaXplKE9iamVjdCB2YWwsIEpE\nQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTZXJpYWxpemVkRGF0\nYSkKICAgICAgICAgICAgcmV0dXJuICgoU2VyaWFsaXplZERhdGEpIHZhbCku\nYnl0ZXM7CiAgICAgICAgcmV0dXJuIFNlcmlhbGl6YXRpb24uc2VyaWFsaXpl\nKHZhbCwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRCeXRlczwvY29kZT4g\nbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVjdC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgcHV0Qnl0ZXMoT2JqZWN0IGJsb2IsIGJ5dGVbXSBkYXRh\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChf\nc2V0Qnl0ZXMgPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgX3NldEJ5dGVzID0gYmxvYi5nZXRDbGFzcygpLmdldE1ldGhv\nZCgic2V0Qnl0ZXMiLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1td\neyBsb25nLmNsYXNzLCBieXRlW10uY2xhc3MgfSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9zZXRCeXRlcywgYmxvYiwK\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBOdW1iZXJzLnZhbHVlT2YoMUwp\nLCBkYXRhIH0pOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBK\nREsgMS40IDxjb2RlPnNldFN0cmluZzwvY29kZT4gbWV0aG9kIG9uIHRoZSBn\naXZlbiBDTE9CCiAgICAgKiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHB1dFN0cmluZyhPYmplY3QgY2xvYiwgU3RyaW5nIGRhdGEpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9zZXRTdHJp\nbmcgPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgX3NldFN0cmluZyA9IGNsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInNl\ndFN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGxv\nbmcuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpbnZva2VQdXRMb2JNZXRob2QoX3NldFN0cmluZywgY2xvYiwKICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyBOdW1iZXJzLnZhbHVlT2YoMUwpLCBk\nYXRhIH0pOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBKREsg\nMS40IDxjb2RlPnNldENoYXJhY3RlclN0cmVhbTwvY29kZT4gbWV0aG9kIG9u\nIHRoZSBnaXZlbgogICAgICogQ0xPQiBvYmplY3QuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHB1dENoYXJzKE9iamVjdCBjbG9iLCBjaGFyW10gZGF0YSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3Nl\ndENoYXJTdHJlYW0gPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgX3NldENoYXJTdHJlYW0gPSBjbG9iLmdldENsYXNzKCku\nZ2V0TWV0aG9kCiAgICAgICAgICAgICAgICAgICAgKCJzZXRDaGFyYWN0ZXJT\ndHJlYW0iLCBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcyB9KTsKICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgV3JpdGVyIHdyaXRlciA9IChXcml0ZXIpIGludm9r\nZVB1dExvYk1ldGhvZChfc2V0Q2hhclN0cmVhbSwgY2xvYiwKICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBOdW1iZXJzLnZhbHVlT2YoMUwpIH0pOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHdyaXRlci53cml0ZShkYXRhKTsKICAg\nICAgICAgICAgd3JpdGVyLmZsdXNoKCk7CiAgICAgICAgfSBjYXRjaCAoSU9F\neGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNl\ncHRpb24oaW9lLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEludm9rZSB0aGUgZ2l2ZW4gTE9CIG1ldGhvZCBvbiB0aGUg\nZ2l2ZW4gdGFyZ2V0IHdpdGggdGhlIGdpdmVuIGRhdGEuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIE9iamVjdCBpbnZva2VQdXRMb2JNZXRob2QoTWV0\naG9kIG1ldGhvZCwgT2JqZWN0IHRhcmdldCwKICAgICAgICBPYmplY3RbXSBh\ncmdzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBtZXRob2QuaW52b2tlKHRhcmdldCwg\nYXJncyk7CiAgICAgICAgfSBjYXRjaCAoSW52b2NhdGlvblRhcmdldEV4Y2Vw\ndGlvbiBpdGUpIHsKICAgICAgICAgICAgVGhyb3dhYmxlIHQgPSBpdGUuZ2V0\nVGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNl\nb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdGhyb3coU1FMRXhj\nZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRp\nb24odCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhhdCBhIHBhcnRpY3VsYXIg\ndmFsdWUgY291bGQgbm90IGJlIHN0b3JlZCBwcmVjaXNlbHkuCiAgICAgKiBB\nZnRlciB0aGUgZmlyc3Qgd2FybmluZyBmb3IgYSBwYXJ0aWN1bGFyIHR5cGUs\nIG1lc3NhZ2VzCiAgICAgKiB3aWxsIGJlIHR1cm5lZCBpbnRvIHRyYWNlIG1l\nc3NhZ2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9yYWdlV2Fy\nbmluZyhPYmplY3Qgb3JpZywgT2JqZWN0IGNvbnZlcnRlZCkgewogICAgICAg\nIGJvb2xlYW4gd2FybjsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgaWYgKF9wcmVjaXNpb25XYXJuZWRUeXBlcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgX3ByZWNpc2lvbldhcm5lZFR5cGVzID0gbmV3\nIEhhc2hTZXQoKTsKICAgICAgICAgICAgd2FybiA9IF9wcmVjaXNpb25XYXJu\nZWRUeXBlcy5hZGQob3JpZy5nZXRDbGFzcygpKTsKICAgICAgICB9CgogICAg\nICAgIGlmIChzdG9yYWdlTGltaXRhdGlvbnNGYXRhbCB8fCAod2FybiAmJiBs\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICB8fCAoIXdhcm4gJiYg\nbG9nLmlzVHJhY2VFbmFibGVkKCkpKSB7CiAgICAgICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQoInN0b3JhZ2UtcmVzdHJpY3Rpb24iLCBuZXcgT2Jq\nZWN0W117CiAgICAgICAgICAgICAgICBwbGF0Zm9ybSwKICAgICAgICAgICAg\nICAgIG9yaWcsCiAgICAgICAgICAgICAgICBvcmlnLmdldENsYXNzKCkuZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgY29udmVydGVkLAogICAgICAgICAg\nICB9KTsKCiAgICAgICAgICAgIGlmIChzdG9yYWdlTGltaXRhdGlvbnNGYXRh\nbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbiht\nc2cpOwoKICAgICAgICAgICAgaWYgKHdhcm4pCiAgICAgICAgICAgICAgICBs\nb2cud2Fybihtc2cpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBsb2cudHJhY2UobXNnKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8v\nLy8vCiAgICAvLyBUeXBlcwogICAgLy8vLy8vLy8vCgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsgVHlwZXN9IGNvbnN0YW50\nIGZvciB0aGUgZ2l2ZW4KICAgICAqIHtAbGluayBKYXZhVHlwZXN9IG9yIHtA\nbGluayBKYXZhU1FMVHlwZXN9IGNvbnN0YW50LgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldEpEQkNUeXBlKGludCBtZXRhVHlwZUNvZGUsIGJvb2xlYW4g\nbG9iKSB7CiAgICAgICAgaWYgKGxvYikgewogICAgICAgICAgICBzd2l0Y2gg\nKG1ldGFUeXBlQ29kZSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMu\nQVNDSUlfU1RSRUFNOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlw\nZXMuQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBzd2l0Y2ggKG1ldGFUeXBlQ29kZSkgewogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLkJJVCk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVf\nT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUo\nVHlwZXMuVElOWUlOVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAg\nICAgICAgICAgICAgaWYgKHN0b3JlQ2hhcnNBc051bWJlcnMpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuSU5U\nRUdFUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlw\nZShUeXBlcy5DSEFSKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9V\nQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMu\nRE9VQkxFKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlJFQUwpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5JTlRFR0VSKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVy\ncmVkVHlwZShUeXBlcy5CSUdJTlQpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRf\nT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUo\nVHlwZXMuU01BTExJTlQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nVFJJTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAg\nICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQVNDSUlfU1RSRUFNOgogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5DSEFSX1NUUkVBTToKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlZBUkNI\nQVIpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgog\nICAgICAgICAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdz\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBl\nKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFBy\nZWZlcnJlZFR5cGUoVHlwZXMuQklHSU5UKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgICAgIGlmIChzdG9y\nZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkRPVUJM\nRSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAgICAg\nICAgICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5WQVJDSEFSKTsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFU\nRToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5\ncGVzLlRJTUVTVEFNUCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVz\nLlNRTF9BUlJBWToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLkFSUkFZKTsKICAgICAgICAgICAgY2FzZSBKYXZhU1FM\nVHlwZXMuQklOQVJZX1NUUkVBTToKICAgICAgICAgICAgY2FzZSBKYXZhU1FM\nVHlwZXMuQkxPQjoKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQllU\nRVM6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5CTE9CKTsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQ0xP\nQjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5\ncGVzLkNMT0IpOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxf\nREFURToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBl\nKFR5cGVzLkRBVEUpOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5U\nSU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUo\nVHlwZXMuVElNRSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJ\nTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5C\nTE9CKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHByZWZlcnJlZCB7QGxpbmsgVHlwZXN9IHR5cGUgZm9yIHRoZSBnaXZl\nbiBvbmUuIFJldHVybnMKICAgICAqIHRoZSBnaXZlbiB0eXBlIGJ5IGRlZmF1\nbHQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UHJlZmVycmVkVHlwZShp\nbnQgdHlwZSkgewogICAgICAgIHJldHVybiB0eXBlOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQgZGF0YWJhc2UgdHlwZSBu\nYW1lIGZvciB0aGUgZ2l2ZW4gY29sdW1uJ3MgdHlwZQogICAgICogZnJvbSB7\nQGxpbmsgVHlwZXN9LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5\ncGVOYW1lKENvbHVtbiBjb2wpIHsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoY29sLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICByZXR1\ncm4gYXBwZW5kU2l6ZShjb2wsIGNvbC5nZXRUeXBlTmFtZSgpKTsKCiAgICAg\nICAgaWYgKGNvbC5pc0F1dG9Bc3NpZ25lZCgpICYmIGF1dG9Bc3NpZ25UeXBl\nTmFtZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gYXBwZW5kU2l6ZShj\nb2wsIGF1dG9Bc3NpZ25UeXBlTmFtZSk7CgogICAgICAgIHJldHVybiBhcHBl\nbmRTaXplKGNvbCwgZ2V0VHlwZU5hbWUoY29sLmdldFR5cGUoKSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdHlwZSBuYW1lIGZvciB0\naGUgc3BlY2lmaWMgY29uc3RhbnQgYXMgZGVmaW5lZAogICAgICogYnkge0Bs\naW5rIGphdmEuc3FsLlR5cGVzfS4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlw\nZSB0aGUgdHlwZQogICAgICogQHJldHVybiB0aGUgbmFtZSBmb3IgdGhlIHR5\ncGUKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRUeXBlTmFtZShpbnQg\ndHlwZSkgewogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBj\nYXNlIFR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5\nVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklHSU5UOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGJpZ2ludFR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkJJTkFSWToKICAgICAgICAgICAgICAgIHJldHVybiBi\naW5hcnlUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSVQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gYml0VHlwZU5hbWU7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuQkxPQjoKICAgICAgICAgICAgICAgIHJldHVybiBibG9i\nVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgMTY6IC8vIEpESyAxLjQgaW50\ncm9kdWNlcyBUeXBlcy5CT09MRUFOLCB3aG9zZSB2YWx1ZSBpcyAxNgogICAg\nICAgICAgICAgICAgcmV0dXJuIGJvb2xlYW5UeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIGNo\nYXJUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DTE9COgogICAg\nICAgICAgICAgICAgcmV0dXJuIGNsb2JUeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ERUNJTUFMOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGRlY2ltYWxUeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5ESVNUSU5DVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBkaXN0aW5jdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRP\nVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBkb3VibGVUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAg\nIHJldHVybiBmbG9hdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLklOVEVHRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50ZWdlclR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkpBVkFfT0JKRUNUOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGphdmFPYmplY3RUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQklOQVJZOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGxvbmdWYXJiaW5hcnlUeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBsb25nVmFyY2hhclR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLk5VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbFR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6CiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVtZXJpY1R5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLk9USEVSOgogICAgICAgICAgICAgICAgcmV0dXJuIG90aGVyVHlwZU5h\nbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVBTDoKICAgICAgICAgICAg\nICAgIHJldHVybiByZWFsVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuUkVGOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlZlR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5UOgogICAgICAgICAgICAg\nICAgcmV0dXJuIHNtYWxsaW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuU1RSVUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN0cnVjdFR5\ncGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUU6CiAgICAgICAg\nICAgICAgICByZXR1cm4gdGltZVR5cGVOYW1lOwogICAgICAgICAgICBjYXNl\nIFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJldHVybiB0aW1l\nc3RhbXBUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5USU5ZSU5U\nOgogICAgICAgICAgICAgICAgcmV0dXJuIHRpbnlpbnRUeXBlTmFtZTsKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5WQVJCSU5BUlk6CiAgICAgICAgICAgICAg\nICByZXR1cm4gdmFyYmluYXJ5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiB2YXJjaGFy\nVHlwZU5hbWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gb3RoZXJUeXBlTmFtZTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBzaXplIHByb3BlcnRp\nZXMgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICogSWYgcHJlc2VudCwg\ndGhlIHN0cmluZyAiezB9IiB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIHNp\nemUgZGVmaW5pdGlvbjsKICAgICAqIG90aGVyd2lzZSB0aGUgc2l6ZSBkZWZp\nbml0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIHR5cGUgbmFtZS4KICAg\nICAqIElmIHlvdXIgZGF0YWJhc2UgaGFzIGNvbHVtbiB0eXBlcyB0aGF0IGRv\nbid0IGFsbG93IHNpemUgZGVmaW5pdGlvbnMsCiAgICAgKiBvdmVycmlkZSB0\naGlzIG1ldGhvZCB0byByZXR1cm4gdGhlIHVuYWx0ZXJlZCB0eXBlIG5hbWUg\nZm9yIGNvbHVtbnMgb2YKICAgICAqIHRob3NlIHR5cGVzIChvciBhZGQgdGhl\nIHR5cGUgbmFtZXMgdG8gdGhlCiAgICAgKiA8Y29kZT5maXhlZFNpemVUeXBl\nTmFtZVNldDwvY29kZT4pLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5n\nIGFwcGVuZFNpemUoQ29sdW1uIGNvbCwgU3RyaW5nIHR5cGVOYW1lKSB7CiAg\nICAgICAgaWYgKGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmNvbnRhaW5zKHR5cGVO\nYW1lLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICByZXR1cm4gdHlwZU5h\nbWU7CiAgICAgICAgaWYgKHR5cGVOYW1lLmluZGV4T2YoJygnKSAhPSAtMSkK\nICAgICAgICAgICAgcmV0dXJuIHR5cGVOYW1lOwoKICAgICAgICBTdHJpbmcg\nc2l6ZSA9IG51bGw7CiAgICAgICAgaWYgKGNvbC5nZXRTaXplKCkgPiAwKSB7\nCiAgICAgICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVm\nZmVyKDEwKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChj\nb2wuZ2V0U2l6ZSgpKTsKICAgICAgICAgICAgaWYgKGNvbC5nZXREZWNpbWFs\nRGlnaXRzKCkgPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAi\nKS5hcHBlbmQoY29sLmdldERlY2ltYWxEaWdpdHMoKSk7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAgICAgICAgc2l6ZSA9IGJ1Zi50b1N0\ncmluZygpOwogICAgICAgIH0KCiAgICAgICAgaW50IGlkeCA9IHR5cGVOYW1l\nLmluZGV4T2YoInswfSIpOwogICAgICAgIGlmIChpZHggPT0gLTEgJiYgc2l6\nZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWUgKyBzaXpl\nOwogICAgICAgIGlmIChpZHggPT0gLTEpCiAgICAgICAgICAgIHJldHVybiB0\neXBlTmFtZTsKCiAgICAgICAgLy8gcmVwbGFjZSAnezB9JyB3aXRoIHNpemUK\nICAgICAgICBTdHJpbmcgcmV0ID0gdHlwZU5hbWUuc3Vic3RyaW5nKDAsIGlk\neCk7CiAgICAgICAgaWYgKHNpemUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\nID0gcmV0ICsgc2l6ZTsKICAgICAgICBpZiAodHlwZU5hbWUubGVuZ3RoKCkg\nPiBpZHggKyAzKQogICAgICAgICAgICByZXQgPSByZXQgKyB0eXBlTmFtZS5z\ndWJzdHJpbmcoaWR4ICsgMyk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0cwogICAgLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIFNldCB0aGUgbmFtZSBvZiB0aGUgam9pbiBz\neW50YXggdG8gdXNlOiBzcWw5MiwgdHJhZGl0aW9uYWwsIGRhdGFiYXNlCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEpvaW5TeW50YXgoU3RyaW5nIHN5\nbnRheCkgewogICAgICAgIGlmICgic3FsOTIiLmVxdWFscyhzeW50YXgpKQog\nICAgICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFYX1NRTDkyOwogICAgICAg\nIGVsc2UgaWYgKCJ0cmFkaXRpb25hbCIuZXF1YWxzKHN5bnRheCkpCiAgICAg\nICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfVFJBRElUSU9OQUw7CiAgICAg\nICAgZWxzZSBpZiAoImRhdGFiYXNlIi5lcXVhbHMoc3ludGF4KSkKICAgICAg\nICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9EQVRBQkFTRTsKICAgICAgICBl\nbHNlIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShzeW50YXgpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKHN5bnRh\neCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBTUUwgc3RyaW5n\nIHRvIGFjdCBhcyBhIHBsYWNlaG9sZGVyIGZvciB0aGUgZ2l2ZW4gY29sdW1u\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFBsYWNlaG9sZGVyVmFs\ndWVTdHJpbmcoQ29sdW1uIGNvbCkgewogICAgICAgIHN3aXRjaCAoY29sLmdl\ndFR5cGUoKSkgewogICAgICAgICAgICBjYXNlIFR5cGVzLkJJR0lOVDoKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5CSVQ6CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuSU5URUdFUjoKICAgICAgICAgICAgY2FzZSBUeXBlcy5OVU1FUklDOgog\nICAgICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5UOgogICAgICAgICAgICBj\nYXNlIFR5cGVzLlRJTllJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIjAi\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkNIQVI6CiAgICAgICAgICAgICAg\nICByZXR1cm4gKHN0b3JlQ2hhcnNBc051bWJlcnMpID8gIjAiIDogIicgJyI7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0xPQjoKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAgICAgICAgY2FzZSBUeXBlcy5W\nQVJDSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuICInJyI7CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBa\nRVJPX0RBVEVfU1RSOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRFQ0lNQUw6\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBj\nYXNlIFR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIFR5cGVzLlJFQUw6\nCiAgICAgICAgICAgICAgICByZXR1cm4gIjAuMCI7CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuVElNRToKICAgICAgICAgICAgICAgIHJldHVybiBaRVJPX1RJ\nTUVfU1RSOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUVTVEFNUDoKICAg\nICAgICAgICAgICAgIHJldHVybiBaRVJPX1RJTUVTVEFNUF9TVFI7CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIk5VTEwi\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIFNF\nTEVDVCBDT1VOVCBzdGF0ZW1lbnQgaW4gdGhlIHByb3BlciBqb2luIHN5bnRh\neCBmb3IgdGhlCiAgICAgKiBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAg\ncHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdENvdW50KFNlbGVjdCBzZWwpIHsK\nICAgICAgICBTUUxCdWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0\naGlzKTsKICAgICAgICBTUUxCdWZmZXIgZnJvbTsKICAgICAgICBzZWwuYWRk\nSm9pbkNsYXNzQ29uZGl0aW9ucygpOwogICAgICAgIGlmIChzZWwuZ2V0RnJv\nbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgIGZyb20gPSBnZXRGcm9t\nU2VsZWN0KHNlbCwgZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nZnJvbSA9IGdldEZyb20oc2VsLCBmYWxzZSk7CiAgICAgICAgU1FMQnVmZmVy\nIHdoZXJlID0gZ2V0V2hlcmUoc2VsLCBmYWxzZSk7CgogICAgICAgIC8vIGlm\nIG5vIGdyb3VwaW5nIGFuZCBubyByYW5nZSwgd2UgbWlnaHQgYmUgYWJsZSB0\nbyBnZXQgYnkgd2l0aG91dAogICAgICAgIC8vIGEgc3Vic2VsZWN0CiAgICAg\nICAgaWYgKHNlbC5nZXRHcm91cGluZygpID09IG51bGwgJiYgc2VsLmdldFN0\nYXJ0SW5kZXgoKSA9PSAwCiAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRl\neCgpID09IExvbmcuTUFYX1ZBTFVFKSB7CiAgICAgICAgICAgIC8vIGlmIHRo\nZSBzZWxlY3QgaGFzIG5vIGlkZW50aWZpZXIgY29scywgdXNlIENPVU5UKCop\nCiAgICAgICAgICAgIExpc3QgYWxpYXNlcyA9ICghc2VsLmlzRGlzdGluY3Qo\nKSkgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUCiAgICAgICAgICAgICAgICA6\nIHNlbC5nZXRJZGVudGlmaWVyQWxpYXNlcygpOwogICAgICAgICAgICBpZiAo\nYWxpYXNlcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIHNlbGVjdFNR\nTC5hcHBlbmQoIkNPVU5UKCopIik7CiAgICAgICAgICAgICAgICByZXR1cm4g\ndG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9tLCB3aGVyZSwgbnVsbCwg\nbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2Us\nIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gaWYgdGhlcmUgaXMgYSBzaW5nbGUgZGlzdGluY3QgY29sLCB1c2Ug\nQ09VTlQoRElTVElOQ1QgY29sKQogICAgICAgICAgICBpZiAoYWxpYXNlcy5z\naXplKCkgPT0gMSkgewogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVu\nZCgiQ09VTlQoRElTVElOQ1QgIikuCiAgICAgICAgICAgICAgICAgICAgYXBw\nZW5kKGFsaWFzZXMuZ2V0KDApLnRvU3RyaW5nKCkpLmFwcGVuZCgiKSIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0KHNlbGVjdFNRTCwgbnVs\nbCwgZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAgICAg\nICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxVRSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNhbiB3ZSBjb21iaW5lIGRp\nc3RpbmN0IGNvbHM/CiAgICAgICAgICAgIGlmIChkaXN0aW5jdENvdW50Q29s\ndW1uU2VwYXJhdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbGVj\ndFNRTC5hcHBlbmQoIkNPVU5UKERJU1RJTkNUICIpOwogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLnNpemUoKTsgaSsrKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiAiKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChkaXN0aW5jdENvdW50\nQ29sdW1uU2VwYXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2Vs\nZWN0U1FMLmFwcGVuZCgiICIpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGFsaWFzZXMuZ2V0\nKGkpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiKSIpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHRvU2VsZWN0KHNlbGVjdFNRTCwgbnVsbCwgZnJvbSwgd2hlcmUs\nIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAgICAgICAgICAgICAgZmFsc2Us\nIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIHNpbmNlIHdlIGNhbid0IGNvbWJpbmUgZGlz\ndGluY3QgY29scywgd2UgaGF2ZSB0byBwZXJmb3JtIGFuIG91dGVyCiAgICAg\nICAgLy8gQ09VTlQoKikgc2VsZWN0IHVzaW5nIHRoZSBvcmlnaW5hbCBzZWxl\nY3QgYXMgYSBzdWJzZWxlY3QgaW4gdGhlCiAgICAgICAgLy8gRlJPTSBjbGF1\nc2UKICAgICAgICBhc3NlcnRTdXBwb3J0KHN1cHBvcnRzU3Vic2VsZWN0LCAi\nU3VwcG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAgU1FMQnVmZmVyIHN1YlNl\nbGVjdCA9IGdldFNlbGVjdHMoc2VsLCB0cnVlLCBmYWxzZSk7CiAgICAgICAg\nU1FMQnVmZmVyIHN1YkZyb20gPSBmcm9tOwogICAgICAgIGZyb20gPSBuZXcg\nU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGZyb20uYXBwZW5kKCIoIik7CiAg\nICAgICAgZnJvbS5hcHBlbmQodG9TZWxlY3Qoc3ViU2VsZWN0LCBudWxsLCBz\ndWJGcm9tLCB3aGVyZSwKICAgICAgICAgICAgc2VsLmdldEdyb3VwaW5nKCks\nIHNlbC5nZXRIYXZpbmcoKSwgbnVsbCwgc2VsLmlzRGlzdGluY3QoKSwKICAg\nICAgICAgICAgZmFsc2UsIHNlbC5nZXRTdGFydEluZGV4KCksIHNlbC5nZXRF\nbmRJbmRleCgpLCB0cnVlKSk7CiAgICAgICAgZnJvbS5hcHBlbmQoIikiKTsK\nICAgICAgICBpZiAocmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAg\nICAgICAgZnJvbS5hcHBlbmQoIiAiKS5hcHBlbmQoU2VsZWN0LkZST01fU0VM\nRUNUX0FMSUFTKTsKCiAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQo\nKikiKTsKICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxs\nLCBmcm9tLCBudWxsLCBudWxsLCBudWxsLCBudWxsLAogICAgICAgICAgICBm\nYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIERFTEVURSBzdGF0ZW1lbnQgZm9yIHRoZSBz\ncGVjaWZpZWQgU2VsZWN0LiBJZiB0aGUKICAgICAqIGRhdGFiYXNlIGRvZXMg\nbm90IHN1cHBvcnQgdGhlIGJ1bGsgZGVsZXRlIHN0YXRlbWVudCAoc3VjaCBh\ncwogICAgICogY2FzZXMgd2hlcmUgYSBzdWJzZWxlY3QgaXMgcmVxdWlyZWQg\nYW5kIHRoZSBkYXRhYmFzZSBkb2Vzbid0IHN1cHBvcnQKICAgICAqIHN1YnNl\nbGVjdHMpLCB0aGlzIG1ldGhvZCBzaG91bGQgcmV0dXJuIG51bGwuCiAgICAg\nKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9EZWxldGUoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIFNlbGVjdCBzZWwsIAogICAgICAgIE9iamVjdFtdIHBhcmFt\ncykgewogICAgICAgIHJldHVybiB0b0J1bGtPcGVyYXRpb24obWFwcGluZywg\nc2VsLCBudWxsLCBwYXJhbXMsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBT\nUUxCdWZmZXIgdG9VcGRhdGUoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFNlbGVj\ndCBzZWwsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3RbXSBwYXJh\nbXMsIE1hcCB1cGRhdGVzKSB7CiAgICAgICAgcmV0dXJuIHRvQnVsa09wZXJh\ndGlvbihtYXBwaW5nLCBzZWwsIHN0b3JlLCBwYXJhbXMsIHVwZGF0ZXMpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgU1FMIGZvciBhIGJ1\nbGsgb3BlcmF0aW9uLCBlaXRoZXIgYSBERUxFVEUgb3IgYW4gVVBEQVRFLgog\nICAgICoKICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtYXBwbmcgYWdhaW5z\ndCB3aGljaCB3ZSBhcmUgb3BlcmF0aW5nCiAgICAgKiBAcGFyYW0gc2VsIHRo\nZSBTZWxlY3QgdGhhdCB3aWxsIGNvbnN0aXR1dGUgdGhlIFdIRVJFIGNsYXVz\nZQogICAgICogQHBhcmFtIHN0b3JlIHRoZSBjdXJyZW50IHN0b3JlCiAgICAg\nKiBAcGFyYW0gdXBkYXRlUGFyYW1zIHRoZSBNYXAgdGhhdCBob2xkcyB0aGUg\ndXBkYXRlIHBhcmFtZXRlcnM7IGEgbnVsbAogICAgICogdmFsdWUgaW5kaWNh\ndGVzIHRoYXQgdGhpcyBpcyBhIGRlbGV0ZSBvcGVyYXRpb24KICAgICAqIEBy\nZXR1cm4gdGhlIFNRTEJ1ZmZlciBmb3IgdGhlIHVwZGF0ZSwgb3IgPGVtPm51\nbGw8L2VtPiBpZiBpdCBpcyBub3QKICAgICAqIHBvc3NpYmxlIHRvIHBlcmZv\ncm0gdGhlIGJ1bGsgdXBkYXRlCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxC\ndWZmZXIgdG9CdWxrT3BlcmF0aW9uKENsYXNzTWFwcGluZyBtYXBwaW5nLCBT\nZWxlY3Qgc2VsLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgT2JqZWN0W10g\ncGFyYW1zLCBNYXAgdXBkYXRlUGFyYW1zKSB7CiAgICAgICAgU1FMQnVmZmVy\nIHNxbCA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKHVwZGF0\nZVBhcmFtcyA9PSBudWxsKQogICAgICAgICAgICBzcWwuYXBwZW5kKCJERUxF\nVEUgRlJPTSAiKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoIlVQREFURSAiKTsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0\naW9ucygpOwoKICAgICAgICAvLyBpZiB0aGVyZSBpcyBvbmx5IGEgc2luZ2xl\nIHRhYmxlIGluIHRoZSBzZWxlY3QsIHRoZW4gd2UgY2FuCiAgICAgICAgLy8g\nanVzdCBpc3N1ZSBhIHNpbmdsZSBERUxFVEUgRlJPTSBUQUJMRSBXSEVSRSA8\nY29uZGl0aW9ucz4KICAgICAgICAvLyBzdGF0ZW1lbnQ7IG90aGVyd2lzZSwg\nc2luY2UgU1FMIGRvZXNuJ3QgYWxsb3cgZGVsZXRpbmcKICAgICAgICAvLyBm\ncm9tIG9uZSBvZiBhIG11bHRpLXRhYmxlIHNlbGVjdCwgd2UgbmVlZCB0byBp\nc3N1ZSBhIHN1YnNlbGVjdAogICAgICAgIC8vIGxpa2UgREVMRVRFIEZST00g\nVEFCTEUgV0hFUkUgRVhJU1RTCiAgICAgICAgLy8gKFNFTEVDVCAxIEZST00g\nVEFCTEUgdDAgV0hFUkUgdDAuSUQgPSBUQUJMRS5JRCk7IGFsc28sIHNvbWUK\nICAgICAgICAvLyBkYXRhYmFzZXMgZG8gbm90IGFsbG93IGFsaWFzZXMgaW4g\nZGVsZXRlIHN0YXRlbWVudHMsIHdoaWNoCiAgICAgICAgLy8gYWxzbyBjYXVz\nZXMgdXMgdG8gdXNlIGEgc3Vic2VsZWN0CiAgICAgICAgaWYgKHNlbC5nZXRU\nYWJsZUFsaWFzZXMoKS5zaXplKCkgPT0gMSAmJiBzdXBwb3J0c1N1YnNlbGVj\ndAogICAgICAgICAgICAmJiBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSkgewog\nICAgICAgICAgICBTUUxCdWZmZXIgZnJvbTsKICAgICAgICAgICAgaWYgKHNl\nbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZy\nb20gPSBnZXRGcm9tU2VsZWN0KHNlbCwgZmFsc2UpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBmcm9tID0gZ2V0RnJvbShzZWwsIGZhbHNl\nKTsKCiAgICAgICAgICAgIHNxbC5hcHBlbmQoZnJvbSk7CiAgICAgICAgICAg\nIGFwcGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0\nZVBhcmFtcywKICAgICAgICAgICAgICAgIGFsbG93c0FsaWFzSW5CdWxrQ2xh\ndXNlKTsKCiAgICAgICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IHNlbC5nZXRX\naGVyZSgpOwogICAgICAgICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hl\ncmUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIg\nV0hFUkUgIik7CiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKHdoZXJlKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3FsOwogICAgICAg\nIH0KCiAgICAgICAgVGFibGUgdGFibGUgPSBtYXBwaW5nLmdldFRhYmxlKCk7\nCiAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSA9IGdldEZ1bGxOYW1lKHRhYmxl\nLCBmYWxzZSk7CgogICAgICAgIC8vIG9ubHkgdXNlIGEgIHN1YnNlbGVjdCBp\nZiB0aGUgd2hlcmUgaXMgbm90IGVtcHR5OyBvdGhlcndpc2UKICAgICAgICAv\nLyBhbiB1bnF1YWxpZmllZCBkZWxldGUgb3IgdXBkYXRlIHdpbGwgd29yawog\nICAgICAgIGlmIChzZWwuZ2V0V2hlcmUoKSA9PSBudWxsIHx8IHNlbC5nZXRX\naGVyZSgpLmlzRW1wdHkoKSkgewogICAgICAgICAgICBzcWwuYXBwZW5kKHRh\nYmxlTmFtZSk7CiAgICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2VsLCBzdG9y\nZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywgZmFsc2UpOwogICAgICAg\nICAgICByZXR1cm4gc3FsOwogICAgICAgIH0KCiAgICAgICAgLy8gd2UgbmVl\nZCB0byB1c2UgYSBzdWJzZWxlY3QgaWYgd2UgYXJlIHRvIGJ1bGsgZGVsZXRl\nIHdoZXJlCiAgICAgICAgLy8gdGhlIHNlbGVjdCBpbmNsdWRlcyBtdWx0aXBs\nZSB0YWJsZXM7IGlmIHRoZSBkYXRhYmFzZQogICAgICAgIC8vIGRvZXNuJ3Qg\nc3VwcG9ydCBpdCwgdGhlbiB3ZSBuZWVkIHRvIHNpZ2FsIHRoaXMgYnkgcmV0\ndXJuaW5nIG51bGwKICAgICAgICBpZiAoIXN1cHBvcnRzU3Vic2VsZWN0IHx8\nICFzdXBwb3J0c0NvcnJlbGF0ZWRTdWJzZWxlY3QpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBDb2x1bW5bXSBwa3MgPSBtYXBwaW5nLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgc2VsLmNsZWFyU2VsZWN0\ncygpOwogICAgICAgIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKCiAgICAgICAg\nLy8gaWYgd2UgaGF2ZSBvbmx5IGEgc2luZ2xlIFBLLCB3ZSBjYW4gdXNlIGEg\nbm9uLWNvcnJlbGF0ZWQKICAgICAgICAvLyBzdWJxdWVyeSAodXNpbmcgYW4g\nSU4gc3RhdGVtZW50KSwgd2hpY2ggaXMgbXVjaCBmYXN0ZXIgdGhhbgogICAg\nICAgIC8vIGEgY29ycmVsYXRlZCBzdWJxdWVyeSAoc2luY2UgYSBjb3JyZWxh\ndGVkIHN1YnF1ZXJ5IG5lZWRzCiAgICAgICAgLy8gdG8gYmUgZXhlY3V0ZWQg\nb25jZSBmb3IgZWFjaCByb3cgaW4gdGhlIHRhYmxlKQogICAgICAgIGlmIChw\na3MubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgc2VsLnNlbGVjdChwa3Nb\nMF0pOwogICAgICAgICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAg\nICAgICAgIGFwcGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMs\nIHVwZGF0ZVBhcmFtcywgZmFsc2UpOwogICAgICAgICAgICBzcWwuYXBwZW5k\nKCIgV0hFUkUgIikuCiAgICAgICAgICAgICAgICBhcHBlbmQocGtzWzBdKS5h\ncHBlbmQoIiBJTiAoIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoc2VsLnRv\nU2VsZWN0KGZhbHNlLCBudWxsKSkuYXBwZW5kKCIpIik7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgc2VsLmNsZWFyU2VsZWN0cygpOwogICAgICAg\nICAgICBzZWwuc2V0RGlzdGluY3QoZmFsc2UpOwoKICAgICAgICAgICAgLy8g\nc2luY2UgdGhlIHNlbGVjdCBpcyB1c2luZyBhIGNvcnJlbGF0ZWQgc3VicXVl\ncnksIHdlCiAgICAgICAgICAgIC8vIG9ubHkgbmVlZCB0byBzZWxlY3QgYSBi\nb2d1cyB2aXJ0dWFsIGNvbHVtbgogICAgICAgICAgICBzZWwuc2VsZWN0KCIx\nIiwgbnVsbCk7CgogICAgICAgICAgICAvLyBhZGQgaW4gdGhlIGpvaW5zIHRv\nIHRoZSB0YWJsZQogICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gdGFibGUu\nZ2V0UHJpbWFyeUtleSgpLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgU1FM\nQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIigiKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAo\naSA+IDApCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAi\nKTsKCiAgICAgICAgICAgICAgICAvLyBhZGQgaW4gInQwLlBLID0gTVlUQUJM\nRS5QSyIKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VsLmdldENvbHVt\nbkFsaWFzKGNvbHNbaV0sIG51bGwpKS5hcHBlbmQoIiA9ICIpLgogICAgICAg\nICAgICAgICAgICAgIGFwcGVuZCh0YWJsZSkuYXBwZW5kKGNhdGFsb2dTZXBh\ncmF0b3IpLmFwcGVuZChjb2xzW2ldKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAgICAgIHNlbC53aGVyZShi\ndWYsIG51bGwpOwoKICAgICAgICAgICAgc3FsLmFwcGVuZCh0YWJsZU5hbWUp\nOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwg\ncGFyYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNlKTsKICAgICAgICAgICAgc3Fs\nLmFwcGVuZCgiIFdIRVJFIEVYSVNUUyAoIikuCiAgICAgICAgICAgICAgICBh\ncHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBudWxsKSkuYXBwZW5kKCIpIik7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBzcWw7CiAgICB9CgogICAgcHJv\ndGVjdGVkIHZvaWQgYXBwZW5kVXBkYXRlcyhTZWxlY3Qgc2VsLCBKREJDU3Rv\ncmUgc3RvcmUsIFNRTEJ1ZmZlciBzcWwsCiAgICAgICAgT2JqZWN0W10gcGFy\nYW1zLCBNYXAgdXBkYXRlUGFyYW1zLCBib29sZWFuIGFsbG93QWxpYXMpIHsK\nICAgICAgICBpZiAodXBkYXRlUGFyYW1zID09IG51bGwgfHwgdXBkYXRlUGFy\nYW1zLnNpemUoKSA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIG1hbnVhbGx5IGJ1aWxkIHVwIHRoZSBTRVQgY2xhdXNlIGZvciB0aGUg\nVVBEQVRFIHN0YXRlbWVudAogICAgICAgIHNxbC5hcHBlbmQoIiBTRVQgIik7\nCiAgICAgICAgRXhwQ29udGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChzdG9y\nZSwgcGFyYW1zLCAKICAgICAgICAgICAgc3RvcmUuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCkpOwoKICAgICAgICAvLyBJZiB0aGUgdXBkYXRlcyBtYXAgY29u\ndGFpbnMgYW55IHZlcnNpb24gZmllbGRzLCBhc3N1bWUgdGhhdCB0aGUKICAg\nICAgICAvLyBvcHRpbWlzdGljIGxvY2sgdmVyc2lvbiBkYXRhIGlzIGJlaW5n\nIGhhbmRsZWQgcHJvcGVybHkgYnkgdGhlCiAgICAgICAgLy8gY2FsbGVyLiBP\ndGhlcndpc2UsIGdpdmUgdGhlIHZlcnNpb24gaW5kaWNhdG9yIGFuIG9wcG9y\ndHVuaXR5IHRvCiAgICAgICAgLy8gYWRkIG1vcmUgdXBkYXRlIGNsYXVzZXMg\nYXMgbmVlZGVkLgogICAgICAgIGJvb2xlYW4gYXVnbWVudFVwZGF0ZXMgPSB0\ncnVlOwoKICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSB1cGRhdGVQYXJhbXMu\nZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgTWFwLkVudHJ5IG5leHQgPSAoTWFwLkVudHJ5KSBpLm5leHQoKTsK\nICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtZCA9IChGaWVsZE1hcHBpbmcp\nIG5leHQuZ2V0S2V5KCk7CgogICAgICAgICAgICBpZiAoZm1kLmlzVmVyc2lv\nbigpKQogICAgICAgICAgICAgICAgYXVnbWVudFVwZGF0ZXMgPSBmYWxzZTsK\nCiAgICAgICAgICAgIFZhbCB2YWwgPSAoVmFsKSBuZXh0LmdldFZhbHVlKCk7\nCgogICAgICAgICAgICBDb2x1bW4gY29sID0gZm1kLmdldENvbHVtbnMoKVsw\nXTsKICAgICAgICAgICAgc3FsLmFwcGVuZChjb2wuZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgc3FsLmFwcGVuZCgiID0gIik7CgogICAgICAgICAgICBFeHBT\ndGF0ZSBzdGF0ZSA9IHZhbC5pbml0aWFsaXplKHNlbCwgY3R4LCAwKTsKICAg\nICAgICAgICAgdmFsLmNhbGN1bGF0ZVZhbHVlKHNlbCwgY3R4LCBzdGF0ZSwg\nbnVsbCwgbnVsbCk7CgogICAgICAgICAgICAvLyBhcHBlbmQgdGhlIHZhbHVl\nIHdpdGggYSBudWxsIGZvciB0aGUgU2VsZWN0OyBpCiAgICAgICAgICAgIC8v\nIGluZGljYXRlcyB0aGF0IHRoZQogICAgICAgICAgICBpbnQgbGVuZ3RoID0g\ndmFsLmxlbmd0aChzZWwsIGN0eCwgc3RhdGUpOwogICAgICAgICAgICBmb3Ig\nKGludCBqID0gMDsgaiA8IGxlbmd0aDsgaisrKQogICAgICAgICAgICAgICAg\ndmFsLmFwcGVuZFRvKChhbGxvd0FsaWFzKSA/IHNlbCA6IG51bGwsIGN0eCwg\nc3RhdGUsIHNxbCwgaik7CgogICAgICAgICAgICBpZiAoaS5oYXNOZXh0KCkp\nCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIsICIpOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKGF1Z21lbnRVcGRhdGVzKSB7CiAgICAgICAgICAgIENs\nYXNzTWFwcGluZyBtZXRhID0KICAgICAgICAgICAgICAgICgoRmllbGRNYXBw\naW5nKSB1cGRhdGVQYXJhbXMua2V5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCkp\nCiAgICAgICAgICAgICAgICAgICAgLmdldERlY2xhcmluZ01hcHBpbmcoKTsK\nICAgICAgICAgICAgTWFwIHVwZGF0ZXMgPSBtZXRhLmdldFZlcnNpb24oKS5n\nZXRCdWxrVXBkYXRlVmFsdWVzKCk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRlciA9IHVwZGF0ZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAg\nICAgICAgICAgICAgaXRlci5oYXNOZXh0KCk7ICkgewogICAgICAgICAgICAg\nICAgTWFwLkVudHJ5IGUgPSAoTWFwLkVudHJ5KSBpdGVyLm5leHQoKTsKICAg\nICAgICAgICAgICAgIENvbHVtbiBjb2wgPSAoQ29sdW1uKSBlLmdldEtleSgp\nOwogICAgICAgICAgICAgICAgU3RyaW5nIHZhbCA9IChTdHJpbmcpIGUuZ2V0\nVmFsdWUoKTsKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiwgIikuYXBw\nZW5kKGNvbC5nZXROYW1lKCkpCiAgICAgICAgICAgICAgICAgICAgLmFwcGVu\nZCgiID0gIikuYXBwZW5kKHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlIFNRTCB0byBkZWxl\ndGUgdGhlIGNvbnRlbnRzIG9mIHRoZSBzcGVjaWZpZWQgdGFibGVzLiAKICAg\nICAqIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGRyb3BzIGFsbCBub24t\nZGVmZXJyZWQgUkVTVFJJQ1QgZm9yZWlnbiBrZXkgCiAgICAgKiBjb25zdHJh\naW50cyBpbnZvbHZpbmcgdGhlIHNwZWNpZmllZCB0YWJsZXMsIGlzc3VlcyBE\nRUxFVEUgc3RhdGVtZW50cyAKICAgICAqIGFnYWluc3QgdGhlIHRhYmxlcywg\nYW5kIHRoZW4gYWRkcyB0aGUgZHJvcHBlZCBjb25zdHJhaW50cyBiYWNrIGlu\nLiAKICAgICAqIERhdGFiYXNlcyB3aXRoIG1vcmUgb3B0aW1hbCB3YXlzIG9m\nIGRlbGV0aW5nIHRoZSBjb250ZW50cyBvZiBzZXZlcmFsIAogICAgICogdGFi\nbGVzIHNob3VsZCBvdmVycmlkZSB0aGlzIG1ldGhvZC4KICAgICAqLwogICAg\ncHVibGljIFN0cmluZ1tdIGdldERlbGV0ZVRhYmxlQ29udGVudHNTUUwoVGFi\nbGVbXSB0YWJsZXMpIHsKICAgICAgICBDb2xsZWN0aW9uIHNxbCA9IG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICAKICAgICAgICAvLyBjb2xsZWN0IGFuZCBk\ncm9wIG5vbi1kZWZlcnJlZCBwaHlzaWNhbCByZXN0cmljdCBjb25zdHJhaW50\ncywgYW5kCiAgICAgICAgLy8gY29sbGVjdCB0aGUgREVMRVRFIEZST00gc3Rh\ndGVtZW50cwogICAgICAgIENvbGxlY3Rpb24gZGVsZXRlU1FMID0gbmV3IEFy\ncmF5TGlzdCh0YWJsZXMubGVuZ3RoKTsKICAgICAgICBDb2xsZWN0aW9uIHJl\nc3RyaWN0Q29uc3RyYWludHMgPSBuZXcgTGlua2VkSGFzaFNldCgpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGFibGVzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSB0YWJsZXNbaV0uZ2V0\nRm9yZWlnbktleXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCBma3MubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIGlmICghZmtz\nW2pdLmlzTG9naWNhbCgpICYmICFma3Nbal0uaXNEZWZlcnJlZCgpIAogICAg\nICAgICAgICAgICAgICAgICYmIGZrc1tqXS5nZXREZWxldGVBY3Rpb24oKSA9\nPSBGb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVCkKICAgICAgICAgICAgICAg\nIHJlc3RyaWN0Q29uc3RyYWludHMuYWRkKGZrc1tqXSk7CiAgICAgICAgICAg\nICAgICBTdHJpbmdbXSBjb25zdHJhaW50U1FMID0gZ2V0RHJvcEZvcmVpZ25L\nZXlTUUwoZmtzW2pdKTsKICAgICAgICAgICAgICAgIHNxbC5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChjb25zdHJhaW50U1FMKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgCiAgICAgICAgICAgIGRlbGV0ZVNRTC5hZGQoIkRFTEVURSBG\nUk9NICIgKyB0YWJsZXNbaV0uZ2V0RnVsbE5hbWUoKSk7CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIC8vIGFkZCB0aGUgZGVsZXRlIHN0YXRlbWVudHMg\nYWZ0ZXIgYWxsIHRoZSBjb25zdHJhaW50IG11dGF0aW9ucwogICAgICAgIHNx\nbC5hZGRBbGwoZGVsZXRlU1FMKTsKICAgICAgICAKICAgICAgICAvLyBhZGQg\ndGhlIGRlbGV0ZWQgY29uc3RyYWludHMgYmFjayB0byB0aGUgc2NoZW1hCiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0gcmVzdHJpY3RDb25zdHJhaW50\ncy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgKSB7CiAgICAgICAgICAg\nIFN0cmluZ1tdIGNvbnN0cmFpbnRTUUwgPSAKICAgICAgICAgICAgICAgIGdl\ndEFkZEZvcmVpZ25LZXlTUUwoKEZvcmVpZ25LZXkpIGl0ZXIubmV4dCgpKTsK\nICAgICAgICAgICAgc3FsLmFkZEFsbChBcnJheXMuYXNMaXN0KGNvbnN0cmFp\nbnRTUUwpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChT\ndHJpbmdbXSkgc3FsLnRvQXJyYXkobmV3IFN0cmluZ1tzcWwuc2l6ZSgpXSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBTRUxFQ1Qgc3RhdGVt\nZW50IGluIHRoZSBwcm9wZXIgam9pbiBzeW50YXggZm9yIHRoZSBnaXZlbgog\nICAgICogaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIg\ndG9TZWxlY3QoU2VsZWN0IHNlbCwgYm9vbGVhbiBmb3JVcGRhdGUsCiAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHNl\nbC5hZGRKb2luQ2xhc3NDb25kaXRpb25zKCk7CiAgICAgICAgYm9vbGVhbiB1\ncGRhdGUgPSBmb3JVcGRhdGUgJiYgc2VsLmdldEZyb21TZWxlY3QoKSA9PSBu\ndWxsOwogICAgICAgIFNRTEJ1ZmZlciBzZWxlY3QgPSBnZXRTZWxlY3RzKHNl\nbCwgZmFsc2UsIHVwZGF0ZSk7CiAgICAgICAgU1FMQnVmZmVyIG9yZGVyaW5n\nID0gbnVsbDsKICAgICAgICBpZiAoIXNlbC5pc0FnZ3JlZ2F0ZSgpIHx8IHNl\nbC5nZXRHcm91cGluZygpICE9IG51bGwpCiAgICAgICAgICAgIG9yZGVyaW5n\nID0gc2VsLmdldE9yZGVyaW5nKCk7CiAgICAgICAgU1FMQnVmZmVyIGZyb207\nCiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkKICAg\nICAgICAgICAgZnJvbSA9IGdldEZyb21TZWxlY3Qoc2VsLCBmb3JVcGRhdGUp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZnJvbSA9IGdldEZyb20oc2Vs\nLCB1cGRhdGUpOwogICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IGdldFdoZXJl\nKHNlbCwgdXBkYXRlKTsKICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0\nLCBmZXRjaCwgZnJvbSwgd2hlcmUsIHNlbC5nZXRHcm91cGluZygpLAogICAg\nICAgICAgICBzZWwuZ2V0SGF2aW5nKCksIG9yZGVyaW5nLCBzZWwuaXNEaXN0\naW5jdCgpLCBmb3JVcGRhdGUsCiAgICAgICAgICAgIHNlbC5nZXRTdGFydElu\nZGV4KCksIHNlbC5nZXRFbmRJbmRleCgpLCBzZWwpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBwb3J0aW9uIG9mIHRoZSBzZWxlY3Qgc3Rh\ndGVtZW50IGJldHdlZW4gdGhlIEZST00ga2V5d29yZAogICAgICogYW5kIHRo\nZSBXSEVSRSBrZXl3b3JkLgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVm\nZmVyIGdldEZyb20oU2VsZWN0IHNlbCwgYm9vbGVhbiBmb3JVcGRhdGUpIHsK\nICAgICAgICBTUUxCdWZmZXIgZnJvbVNRTCA9IG5ldyBTUUxCdWZmZXIodGhp\ncyk7CiAgICAgICAgQ29sbGVjdGlvbiBhbGlhc2VzID0gc2VsLmdldFRhYmxl\nQWxpYXNlcygpOwogICAgICAgIGlmIChhbGlhc2VzLnNpemUoKSA8IDIgfHwg\nc2VsLmdldEpvaW5TeW50YXgoKSAhPSBTWU5UQVhfU1FMOTIpIHsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhbGlhc2VzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBmcm9tU1FMLmFw\ncGVuZChpdHIubmV4dCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAg\naWYgKGZvclVwZGF0ZSAmJiB0YWJsZUZvclVwZGF0ZUNsYXVzZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGZyb21TUUwuYXBwZW5kKCIgIikuYXBw\nZW5kKHRhYmxlRm9yVXBkYXRlQ2xhdXNlKTsKICAgICAgICAgICAgICAgIGlm\nIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgICAgIGZyb21TUUwu\nYXBwZW5kKCIsICIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgSXRlcmF0b3IgaXRyID0gc2VsLmdldEpvaW5JdGVyYXRv\ncigpOwogICAgICAgICAgICBib29sZWFuIGZpcnN0ID0gdHJ1ZTsKICAgICAg\nICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAg\nIGZyb21TUUwuYXBwZW5kKHRvU1FMOTJKb2luKChKb2luKSBpdHIubmV4dCgp\nLCBmb3JVcGRhdGUsCiAgICAgICAgICAgICAgICAgICAgZmlyc3QpKTsKICAg\nICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGZyb21TUUw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIEZST00gY2xhdXNlIGZvciBhIHNlbGVjdCB0\naGF0IHNlbGVjdHMgZnJvbSBhIHRtcCB0YWJsZQogICAgICogY3JlYXRlZCBi\neSBhbiBpbm5lciBzZWxlY3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxC\ndWZmZXIgZ2V0RnJvbVNlbGVjdChTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVw\nZGF0ZSkgewogICAgICAgIFNRTEJ1ZmZlciBmcm9tU1FMID0gbmV3IFNRTEJ1\nZmZlcih0aGlzKTsKICAgICAgICBmcm9tU1FMLmFwcGVuZCgiKCIpOwogICAg\nICAgIGZyb21TUUwuYXBwZW5kKHRvU2VsZWN0KHNlbC5nZXRGcm9tU2VsZWN0\nKCksIGZvclVwZGF0ZSwgbnVsbCkpOwogICAgICAgIGZyb21TUUwuYXBwZW5k\nKCIpIik7CiAgICAgICAgaWYgKHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3Qp\nCiAgICAgICAgICAgIGZyb21TUUwuYXBwZW5kKCIgIikuYXBwZW5kKFNlbGVj\ndC5GUk9NX1NFTEVDVF9BTElBUyk7CiAgICAgICAgcmV0dXJuIGZyb21TUUw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFdIRVJFIHBvcnRp\nb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1lbnQsIG9yIG51bGwgaWYgbm8gd2hl\ncmUKICAgICAqIGNvbmRpdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\nUUxCdWZmZXIgZ2V0V2hlcmUoU2VsZWN0IHNlbCwgYm9vbGVhbiBmb3JVcGRh\ndGUpIHsKICAgICAgICBKb2lucyBqb2lucyA9IHNlbC5nZXRKb2lucygpOwog\nICAgICAgIGlmIChzZWwuZ2V0Sm9pblN5bnRheCgpID09IFNZTlRBWF9TUUw5\nMgogICAgICAgICAgICB8fCBqb2lucyA9PSBudWxsIHx8IGpvaW5zLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbC5nZXRXaGVyZSgpOwoKICAg\nICAgICBTUUxCdWZmZXIgd2hlcmUgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwog\nICAgICAgIGlmIChzZWwuZ2V0V2hlcmUoKSAhPSBudWxsKQogICAgICAgICAg\nICB3aGVyZS5hcHBlbmQoc2VsLmdldFdoZXJlKCkpOwogICAgICAgIGlmIChq\nb2lucyAhPSBudWxsKQogICAgICAgICAgICBzZWwuYXBwZW5kKHdoZXJlLCBq\nb2lucyk7CiAgICAgICAgcmV0dXJuIHdoZXJlOwogICAgfQoKICAgIC8qKgog\nICAgICogVXNlIHRoZSBnaXZlbiBqb2luIGluc3RhbmNlIHRvIGNyZWF0ZSBT\nUUwgam9pbmluZyBpdHMgdGFibGVzIGluCiAgICAgKiB0aGUgdHJhZGl0aW9u\nYWwgc3R5bGUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9UcmFk\naXRpb25hbEpvaW4oSm9pbiBqb2luKSB7CiAgICAgICAgRm9yZWlnbktleSBm\nayA9IGpvaW4uZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIGlmIChmayA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYm9vbGVh\nbiBpbnZlcnNlID0gam9pbi5pc0ZvcmVpZ25LZXlJbnZlcnNlZCgpOwogICAg\nICAgIENvbHVtbltdIGZyb20gPSAoaW52ZXJzZSkgPyBmay5nZXRQcmltYXJ5\nS2V5Q29sdW1ucygpCiAgICAgICAgICAgIDogZmsuZ2V0Q29sdW1ucygpOwog\nICAgICAgIENvbHVtbltdIHRvID0gKGludmVyc2UpID8gZmsuZ2V0Q29sdW1u\ncygpCiAgICAgICAgICAgIDogZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsK\nCiAgICAgICAgLy8gZG8gY29sdW1uIGpvaW5zCiAgICAgICAgU1FMQnVmZmVy\nIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaW50IGNvdW50\nID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZyb20ubGVuZ3Ro\nOyBpKyssIGNvdW50KyspIHsKICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIiku\nYXBwZW5kKGZyb21baV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAi\nKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMigpKS5h\ncHBlbmQoIi4iKS5hcHBlbmQodG9baV0pOwogICAgICAgIH0KCiAgICAgICAg\nLy8gZG8gY29uc3RhbnQgam9pbnMKICAgICAgICBDb2x1bW5bXSBjb25zdENv\nbHMgPSBmay5nZXRDb25zdGFudENvbHVtbnMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGNvbnN0Q29scy5sZW5ndGg7IGkrKywgY291bnQrKykg\newogICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgaWYgKGludmVyc2Up\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUoZmsuZ2V0Q29uc3Rh\nbnQoY29uc3RDb2xzW2ldKSwgY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFz\nMSgpKS5hcHBlbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQo\nY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7\nCgogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoam9pbi5nZXRBbGlhczIoKSkuYXBwZW5kKCIuIikuCiAgICAg\nICAgICAgICAgICAgICAgYXBwZW5kKGNvbnN0Q29sc1tpXSk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1ZShmay5n\nZXRDb25zdGFudChjb25zdENvbHNbaV0pLCBjb25zdENvbHNbaV0pOwogICAg\nICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29uc3RDb2xzUEsgPSBmay5nZXRD\nb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjb25zdENvbHNQSy5sZW5ndGg7IGkrKywgY291bnQrKykg\newogICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgaWYgKGludmVyc2Up\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkp\nLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25z\ndENvbHNQS1tpXSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmRWYWx1ZShmay5nZXRQcmltYXJ5S2V5Q29uc3RhbnQoY29u\nc3RDb2xzUEtbaV0pLAogICAgICAgICAgICAgICAgICAgIGNvbnN0Q29sc1BL\nW2ldKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7CgogICAgICAg\nICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmRW\nYWx1ZShmay5nZXRQcmltYXJ5S2V5Q29uc3RhbnQoY29uc3RDb2xzUEtbaV0p\nLAogICAgICAgICAgICAgICAgICAgIGNvbnN0Q29sc1BLW2ldKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdl\ndEFsaWFzMigpKS5hcHBlbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBh\ncHBlbmQoY29uc3RDb2xzUEtbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gYnVmOwogICAgfQoKICAgIC8qKgogICAgICogVXNlIHRoZSBnaXZlbiBq\nb2luIGluc3RhbmNlIHRvIGNyZWF0ZSBTUUwgam9pbmluZyBpdHMgdGFibGVz\nIGluCiAgICAgKiB0aGUgU1FMOTIgc3R5bGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTUUxCdWZmZXIgdG9TUUw5MkpvaW4oSm9pbiBqb2luLCBib29sZWFuIGZv\nclVwZGF0ZSwgYm9vbGVhbiBmaXJzdCkgewogICAgICAgIFNRTEJ1ZmZlciBi\ndWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGlmIChmaXJzdCkg\newogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0VGFibGUxKCkpLmFw\ncGVuZCgiICIpLgogICAgICAgICAgICAgICAgYXBwZW5kKGpvaW4uZ2V0QWxp\nYXMxKCkpOwogICAgICAgICAgICBpZiAoZm9yVXBkYXRlICYmIHRhYmxlRm9y\nVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCIgIikuYXBwZW5kKHRhYmxlRm9yVXBkYXRlQ2xhdXNlKTsKICAgICAg\nICB9CgogICAgICAgIGJ1Zi5hcHBlbmQoIiAiKTsKICAgICAgICBpZiAoam9p\nbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKG91dGVySm9pbkNsYXVzZSk7CiAgICAgICAgZWxzZSBpZiAo\nam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lOTkVSKQogICAgICAgICAg\nICBidWYuYXBwZW5kKGlubmVySm9pbkNsYXVzZSk7CiAgICAgICAgZWxzZSAv\nLyBjcm9zcwogICAgICAgICAgICBidWYuYXBwZW5kKGNyb3NzSm9pbkNsYXVz\nZSk7CiAgICAgICAgYnVmLmFwcGVuZCgiICIpOwoKICAgICAgICBidWYuYXBw\nZW5kKGpvaW4uZ2V0VGFibGUyKCkpLmFwcGVuZCgiICIpLmFwcGVuZChqb2lu\nLmdldEFsaWFzMigpKTsKICAgICAgICBpZiAoZm9yVXBkYXRlICYmIHRhYmxl\nRm9yVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwoKICAgICAg\nICBpZiAoam9pbi5nZXRGb3JlaWduS2V5KCkgIT0gbnVsbCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIE9OICIpLmFwcGVuZCh0b1RyYWRpdGlvbmFsSm9p\nbihqb2luKSk7CiAgICAgICAgZWxzZSBpZiAocmVxdWlyZXNDb25kaXRpb25G\nb3JDcm9zc0pvaW4gJiYKICAgICAgICAgICAgam9pbi5nZXRUeXBlKCkgPT0g\nSm9pbi5UWVBFX0NST1NTKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgT04g\nKDEgPSAxKSIpOwoKICAgICAgICByZXR1cm4gYnVmOwogICAgfQoKICAgIC8q\nKgogICAgICogVXNlIHRoZSBnaXZlbiBqb2luIGluc3RhbmNlIHRvIGNyZWF0\nZSBTUUwgam9pbmluZyBpdHMgdGFibGVzIGluCiAgICAgKiB0aGUgZGF0YWJh\nc2UncyBuYXRpdmUgc3ludGF4LiBUaHJvd3MgYW4gZXhjZXB0aW9uIGJ5IGRl\nZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9OYXRpdmVK\nb2luKEpvaW4gam9pbikgewogICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBp\nZiB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgY2FuIGJlIGVhZ2VybHkgbG9hZGVk\nIHVzaW5nIG90aGVyIGpvaW5zLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBjYW5PdXRlckpvaW4oaW50IHN5bnRheCwgRm9yZWlnbktleSBmaykgewog\nICAgICAgIHJldHVybiBzeW50YXggIT0gU1lOVEFYX1RSQURJVElPTkFMOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29tYmluZSB0aGUgZ2l2ZW4gY29tcG9u\nZW50cyBpbnRvIGEgU0VMRUNUIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0cywgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIg\nZnJvbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAg\nICAgU1FMQnVmZmVyIGhhdmluZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAg\nIGJvb2xlYW4gZGlzdGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0\nYXJ0LCBsb25nIGVuZCkgewogICAgICAgIHJldHVybiB0b09wZXJhdGlvbihn\nZXRTZWxlY3RPcGVyYXRpb24oZmV0Y2gpLCBzZWxlY3RzLCBmcm9tLCB3aGVy\nZSwKICAgICAgICAgICAgZ3JvdXAsIGhhdmluZywgb3JkZXIsIGRpc3RpbmN0\nLCBzdGFydCwgZW5kLAogICAgICAgICAgICBnZXRGb3JVcGRhdGVDbGF1c2Uo\nZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29tYmluZSB0aGUgZ2l2ZW4gY29tcG9uZW50cyBpbnRvIGEgU0VMRUNU\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1Nl\nbGVjdChTUUxCdWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdo\nZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVmZmVyIGhhdmlu\nZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3Qs\nIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAg\nICAgICBib29sZWFuIHN1YnNlbGVjdCkgewogICAgICAgIHJldHVybiB0b09w\nZXJhdGlvbihnZXRTZWxlY3RPcGVyYXRpb24oZmV0Y2gpLCBzZWxlY3RzLCBm\ncm9tLCB3aGVyZSwKICAgICAgICAgICAgZ3JvdXAsIGhhdmluZywgb3JkZXIs\nIGRpc3RpbmN0LCBzdGFydCwgZW5kLAogICAgICAgICAgICBnZXRGb3JVcGRh\ndGVDbGF1c2UoZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCksIHN1YnNlbGVjdCk7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU1FM\nQnVmZmVyIHNlbGVjdHMsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nCiAgICAgICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUs\nIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICAgICAgU1FMQnVmZmVyIGhhdmlu\nZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAgICAgICBib29sZWFuIGRpc3Rp\nbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBlbmQs\nCiAgICAgICAgICAgIGJvb2xlYW4gc3Vic2VsZWN0LCBib29sZWFuIGNoZWNr\nVGFibGVGb3JVcGRhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRvT3BlcmF0\naW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20s\nIHdoZXJlLAogICAgICAgICAgICAgICAgZ3JvdXAsIGhhdmluZywgb3JkZXIs\nIGRpc3RpbmN0LCBzdGFydCwgZW5kLAogICAgICAgICAgICAgICAgZ2V0Rm9y\nVXBkYXRlQ2xhdXNlKGZldGNoLCBmb3JVcGRhdGUsIG51bGwpLCBzdWJzZWxl\nY3QsIGNoZWNrVGFibGVGb3JVcGRhdGUpOwogICAgICAgIH0KCiAgICAvKioK\nICAgICAqIENvbWJpbmUgdGhlIGdpdmVuIGNvbXBvbmVudHMgaW50byBhIFNF\nTEVDVCBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIg\ndG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdHMsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsCiAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZl\nciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNRTEJ1ZmZlciBo\nYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29sZWFuIGRpc3Rp\nbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBlbmQK\nICAgICAgICAsIFNlbGVjdCBzZWwpIHsKICAgICAgICByZXR1cm4gdG9PcGVy\nYXRpb24oZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJv\nbSwgd2hlcmUsCiAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBk\naXN0aW5jdCwgc3RhcnQsIGVuZCwKICAgICAgICAgICAgZ2V0Rm9yVXBkYXRl\nQ2xhdXNlKGZldGNoLCBmb3JVcGRhdGUsIHNlbCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogR2V0IHRoZSB1cGRhdGUgY2xhdXNlIGZvciB0aGUgcXVlcnkg\nYmFzZWQgb24gdGhlCiAgICAgKiB1cGRhdGVDbGF1c2UgYW5kIGlzb2xhdGlv\nbkxldmVsIGhpbnRzCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nRm9yVXBkYXRlQ2xhdXNlKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nCiAgICAgICAgYm9vbGVhbiBpc0ZvclVwZGF0ZSwgU2VsZWN0IHNlbCkgewog\nICAgICAgIGlmIChmZXRjaCAhPSBudWxsICYmIGZldGNoLmdldElzb2xhdGlv\nbigpICE9IC0xKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQoCiAgICAgICAgICAgICAgICAiaXNvbGF0\naW9uLWxldmVsLWNvbmZpZy1ub3Qtc3VwcG9ydGVkIiwgZ2V0Q2xhc3MoKS5n\nZXROYW1lKCkpKTsKICAgICAgICB9IGVsc2UgaWYgKGlzRm9yVXBkYXRlICYm\nICFzaW11bGF0ZUxvY2tpbmcpIHsKICAgICAgICAgICAgYXNzZXJ0U3VwcG9y\ndChzdXBwb3J0c1NlbGVjdEZvclVwZGF0ZSwgIlN1cHBvcnRzU2VsZWN0Rm9y\nVXBkYXRlIik7CiAgICAgICAgICAgIHJldHVybiBmb3JVcGRhdGVDbGF1c2U7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSAiU0VM\nRUNUIiBvcGVyYXRpb24gY2xhdXNlLCBhZGRpbmcgYW55IGF2YWlsYWJsZSBo\naW50cywgZXRjLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFNlbGVj\ndE9wZXJhdGlvbihKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgcmV0dXJuICJTRUxFQ1QiOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBTUUwgZm9yIHRoZSBnaXZlbiBzZWxlY3Rpbmcgb3BlcmF0\naW9uLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvT3BlcmF0aW9u\nKFN0cmluZyBvcCwgU1FMQnVmZmVyIHNlbGVjdHMsCiAgICAgICAgU1FMQnVm\nZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLCBT\nUUxCdWZmZXIgaGF2aW5nLAogICAgICAgIFNRTEJ1ZmZlciBvcmRlciwgYm9v\nbGVhbiBkaXN0aW5jdCwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAg\nU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSkgewogICAgICAgIHJldHVybiB0b09w\nZXJhdGlvbihvcCwgc2VsZWN0cywgZnJvbSwgd2hlcmUsIGdyb3VwLCBoYXZp\nbmcsIG9yZGVyLAogICAgICAgICAgICBkaXN0aW5jdCwgc3RhcnQsIGVuZCwg\nZm9yVXBkYXRlQ2xhdXNlLCBmYWxzZSk7CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBTUUwgZm9yIHRoZSBnaXZlbiBzZWxlY3Rpbmcg\nb3BlcmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvT3Bl\ncmF0aW9uKFN0cmluZyBvcCwgU1FMQnVmZmVyIHNlbGVjdHMsCiAgICAgICAg\nU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdy\nb3VwLCBTUUxCdWZmZXIgaGF2aW5nLAogICAgICAgIFNRTEJ1ZmZlciBvcmRl\nciwgYm9vbGVhbiBkaXN0aW5jdCwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAg\nICAgICAgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSwgYm9vbGVhbiBzdWJzZWxl\nY3QpIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24ob3AsIHNlbGVjdHMs\nIGZyb20sIHdoZXJlLCBncm91cCwgaGF2aW5nLCBvcmRlciwKICAgICAgICAg\nICAgICAgIGRpc3RpbmN0LCBzdGFydCwgZW5kLCBmb3JVcGRhdGVDbGF1c2Us\nIHN1YnNlbGVjdCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBTUUwgZm9yIHRoZSBnaXZlbiBzZWxlY3Rpbmcgb3BlcmF0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihT\ndHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZl\nciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FM\nQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xl\nYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0\ncmluZyBmb3JVcGRhdGVDbGF1c2UsIGJvb2xlYW4gc3Vic2VsZWN0LCBib29s\nZWFuIGNoZWNrVGFibGVGb3JVcGRhdGUpIHsKICAgICAgICBTUUxCdWZmZXIg\nYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBidWYuYXBwZW5k\nKG9wKTsKCiAgICAgICAgYm9vbGVhbiByYW5nZSA9IHN0YXJ0ICE9IDAgfHwg\nZW5kICE9IExvbmcuTUFYX1ZBTFVFOwogICAgICAgIGlmIChyYW5nZSAmJiBy\nYW5nZVBvc2l0aW9uID09IFJBTkdFX1BSRV9ESVNUSU5DVCkKICAgICAgICAg\nICAgYXBwZW5kU2VsZWN0UmFuZ2UoYnVmLCBzdGFydCwgZW5kLCBzdWJzZWxl\nY3QpOwogICAgICAgIGlmIChkaXN0aW5jdCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIERJU1RJTkNUIik7CiAgICAgICAgaWYgKHJhbmdlICYmIHJhbmdl\nUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9ESVNUSU5DVCkKICAgICAgICAgICAg\nYXBwZW5kU2VsZWN0UmFuZ2UoYnVmLCBzdGFydCwgZW5kLCBzdWJzZWxlY3Qp\nOwoKICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKHNlbGVjdHMpLmFw\ncGVuZCgiIEZST00gIikuYXBwZW5kKGZyb20pOwoKICAgICAgICBpZiAoY2hl\nY2tUYWJsZUZvclVwZGF0ZQogICAgICAgICAgICAgICAgJiYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkoZm9yVXBkYXRlQ2xhdXNlKSAmJiAhU3RyaW5nVXRpbHMK\nICAgICAgICAgICAgICAgICAgICAgICAgLmlzRW1wdHkodGFibGVGb3JVcGRh\ndGVDbGF1c2UpKSkgewogICAgICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBw\nZW5kKHRhYmxlRm9yVXBkYXRlQ2xhdXNlKTsKICAgICAgICB9CgogICAgICAg\nIGlmICh3aGVyZSAhPSBudWxsICYmICF3aGVyZS5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAiKS5hcHBlbmQod2hlcmUpOwog\nICAgICAgIGlmIChncm91cCAhPSBudWxsICYmICFncm91cC5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBHUk9VUCBCWSAiKS5hcHBlbmQo\nZ3JvdXApOwogICAgICAgIGlmIChoYXZpbmcgIT0gbnVsbCAmJiAhaGF2aW5n\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBhc3NlcnRTdXBwb3J0KHN1cHBv\ncnRzSGF2aW5nLCAiU3VwcG9ydHNIYXZpbmciKTsKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIEhBVklORyAiKS5hcHBlbmQoaGF2aW5nKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKG9yZGVyICE9IG51bGwgJiYgIW9yZGVyLmlzRW1wdHko\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9SREVSIEJZICIpLmFwcGVu\nZChvcmRlcik7CiAgICAgICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRpb24g\nPT0gUkFOR0VfUE9TVF9TRUxFQ1QpCiAgICAgICAgICAgIGFwcGVuZFNlbGVj\ndFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsKICAgICAgICBp\nZiAoZm9yVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiAiKS5hcHBlbmQoZm9yVXBkYXRlQ2xhdXNlKTsKICAgICAgICBp\nZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlvbiA9PSBSQU5HRV9QT1NUX0xPQ0sp\nCiAgICAgICAgICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVu\nZCwgc3Vic2VsZWN0KTsKICAgICAgICByZXR1cm4gYnVmOwogICAgfQoKICAg\nIC8qKgogICAgICogSWYgdGhpcyBkaWN0aW9uYXJ5IGNhbiBzZWxlY3QgcmFu\nZ2VzLAogICAgICogdXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB0aGUgcmFu\nZ2UgU1FMLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRTZWxl\nY3RSYW5nZShTUUxCdWZmZXIgYnVmLCBsb25nIHN0YXJ0LCBsb25nIGVuZAog\nICAgICAgICwgYm9vbGVhbiBzdWJzZWxlY3QpIHsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0YXRl\nbWVudCBiZXR3ZWVuIHRoZSBTRUxFQ1Qga2V5d29yZAogICAgICogYW5kIHRo\nZSBGUk9NIGtleXdvcmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZm\nZXIgZ2V0U2VsZWN0cyhTZWxlY3Qgc2VsLCBib29sZWFuIGRpc3RpbmN0SWRl\nbnRpZmllcnMsCiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAgICAg\nICAvLyBhcHBlbmQgdGhlIGFsaWFzZXMgZm9yIGFsbCB0aGUgY29sdW1ucwog\nICAgICAgIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRo\naXMpOwogICAgICAgIExpc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlzdGlu\nY3RJZGVudGlmaWVycykKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJ\nZGVudGlmaWVyQWxpYXNlcygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nYWxpYXNlcyA9IHNlbC5nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAgIE9i\namVjdCBhbGlhczsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFsaWFz\nZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nYWxpYXMgPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoYWxpYXMgaW5z\ndGFuY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwu\nYXBwZW5kKChTUUxCdWZmZXIpIGFsaWFzKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChhbGlhcy50b1N0cmlu\nZygpKTsKICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAg\nICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIsICIpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gc2VsZWN0U1FMOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyB0cnVlIGlmIGEgIkZPUiBVUERBVEUiIGNsYXVzZSBjYW4gYmUg\ndXNlZCBmb3IgdGhlIHNwZWNpZmllZAogICAgICogU2VsZWN0IG9iamVjdC4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nKFNl\nbGVjdCBzZWwpIHsKICAgICAgICBpZiAoc2VsLmlzQWdncmVnYXRlKCkpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1cHBvcnRz\nU2VsZWN0Rm9yVXBkYXRlKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2UgJiYg\nKHNlbC5nZXRTdGFydEluZGV4KCkgIT0gMAogICAgICAgICAgICB8fCBzZWwu\nZ2V0RW5kSW5kZXgoKSAhPSBMb25nLk1BWF9WQUxVRSkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gb25seSBpbm5lciBzZWxlY3Qg\naXMgbG9ja2VkCiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0g\nbnVsbCkKICAgICAgICAgICAgc2VsID0gc2VsLmdldEZyb21TZWxlY3QoKTsK\nCiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoRGlzdGluY3RDbGF1\nc2UgJiYgc2VsLmlzRGlzdGluY3QoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE11bHRpcGxl\nVGFibGVzCiAgICAgICAgICAgICYmIHNlbC5nZXRUYWJsZUFsaWFzZXMoKS5z\naXplKCkgPiAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\naWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoT3JkZXJDbGF1c2UgJiYgc2VsLmdl\ndE9yZGVyaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE91dGVySm9pbiB8\nfCAhc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbikgewogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIEpvaW4gam9pbiA9\nIChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKCFzdXBw\nb3J0c0xvY2tpbmdXaXRoT3V0ZXJKb2luCiAgICAgICAgICAgICAgICAgICAg\nJiYgam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlm\nICghc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbgogICAgICAgICAgICAg\nICAgICAgICYmIGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gZmFsc2UgaWYgdGhlIGdpdmVuIHNlbGVjdCBy\nZXF1aXJlcyBhIGZvcndhcmQtb25seSByZXN1bHQgc2V0LgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2Vzc1Jlc3VsdFNl\ndChTZWxlY3Qgc2VsLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAg\nICAgICAgcmV0dXJuICFzZWwuaXNBZ2dyZWdhdGUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSBnaXZlbiBkaWN0aW9uYXJ5IGZs\nYWcgaXMgdHJ1ZS4gSWYgaXQgaXMgbm90IHRydWUsCiAgICAgKiB0aHJvdyBh\nbiBlcnJvciBzYXlpbmcgdGhhdCB0aGUgZ2l2ZW4gc2V0dGluZyBuZWVkcyB0\nbyByZXR1cm4gdHJ1ZSBmb3IKICAgICAqIHRoZSBjdXJyZW50IG9wZXJhdGlv\nbiB0byB3b3JrLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRTdXBw\nb3J0KGJvb2xlYW4gZmVhdHVyZSwgU3RyaW5nIHByb3BlcnR5KSB7CiAgICAg\nICAgaWYgKCFmZWF0dXJlKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBw\nb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImZlYXR1cmUtbm90LXN1cHBvcnRl\nZCIsCiAgICAgICAgICAgICAgICBnZXRDbGFzcygpLCBwcm9wZXJ0eSkpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVyeSBm\ndW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAg\nICAgKiBJbnZva2UgdGhpcyBkYXRhYmFzZSdzIHN1YnN0cmluZyBmdW5jdGlv\nbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRv\nIHdyaXRlIHRoZSBzdWJzdHJpbmcgaW52b2NhdGlvbiB0bwogICAgICogQHBh\ncmFtIHN0ciBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0\nIHN0cmluZwogICAgICogQHBhcmFtIHN0YXJ0IGEgcXVlcnkgdmFsdWUgcmVw\ncmVzZW50aW5nIHRoZSBzdGFydCBpbmRleAogICAgICogQHBhcmFtIGVuZCBh\nIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgZW5kIGluZGV4LCBvciBu\ndWxsIGZvciBub25lCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN1YnN0cmlu\nZyhTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVl\nIHN0YXJ0LAogICAgICAgIEZpbHRlclZhbHVlIGVuZCkgewogICAgICAgIGJ1\nZi5hcHBlbmQoc3Vic3RyaW5nRnVuY3Rpb25OYW1lKS5hcHBlbmQoIigoIik7\nCiAgICAgICAgc3RyLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiKSwgKCIpOwogICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAg\nICAgYnVmLmFwcGVuZCgiICsgMSkiKTsKICAgICAgICBpZiAoZW5kICE9IG51\nbGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAoIik7CiAgICAgICAg\nICAgIGVuZC5hcHBlbmRUbyhidWYpOwogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgLSAoIik7CiAgICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIikpIik7CiAgICAgICAgfQogICAgICAg\nIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9r\nZSB0aGlzIGRhdGFiYXNlJ3MgaW5kZXhPZiBmdW5jdGlvbi4KICAgICAqCiAg\nICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBp\nbmRleE9mIGludm9jYXRpb24gdG8KICAgICAqIEBwYXJhbSBzdHIgYSBxdWVy\neSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHRhcmdldCBzdHJpbmcKICAgICAq\nIEBwYXJhbSBmaW5kIGEgcXVlcnkgdmFsdWUgcmVwcmVzZW50aW5nIHRoZSBz\nZWFyY2ggc3RyaW5nCiAgICAgKiBAcGFyYW0gc3RhcnQgYSBxdWVyeSB2YWx1\nZSByZXByZXNlbnRpbmcgdGhlIHN0YXJ0IGluZGV4LCBvciBudWxsCiAgICAg\nKiB0byBzdGFydCBhdCB0aGUgYmVnaW5uaW5nCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGluZGV4T2YoU1FMQnVmZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgc3Ry\nLCBGaWx0ZXJWYWx1ZSBmaW5kLAogICAgICAgIEZpbHRlclZhbHVlIHN0YXJ0\nKSB7CiAgICAgICAgYnVmLmFwcGVuZCgiKElOU1RSKCgiKTsKICAgICAgICBp\nZiAoc3RhcnQgIT0gbnVsbCkKICAgICAgICAgICAgc3Vic3RyaW5nKGJ1Ziwg\nc3RyLCBzdGFydCwgbnVsbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\ndHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKCIpLCAoIik7\nCiAgICAgICAgZmluZC5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIikpIC0gMSIpOwogICAgICAgIGlmIChzdGFydCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiArICIpOwogICAgICAgICAgICBzdGFy\ndC5hcHBlbmRUbyhidWYpOwogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5k\nKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgdGhlIG51bWVy\naWMgcGFydHMgb2YgYSBtYXRoZW1hdGljYWwgZnVuY3Rpb24uCiAgICAgKgog\nICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUg\nbWF0aCBmdW5jdGlvbgogICAgICogQHBhcmFtIG9wIHRoZSBtYXRoZW1hdGlj\nYWwgb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAgICAqIEBwYXJhbSBsaHMgdGhl\nIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBtYXRoIGZ1bmN0aW9uCiAgICAgKiBA\ncGFyYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIG1hdGggZnVu\nY3Rpb24KICAgICAqLwogICAgcHVibGljIHZvaWQgbWF0aEZ1bmN0aW9uKFNR\nTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhzLAogICAg\nICAgIEZpbHRlclZhbHVlIHJocykgewogICAgICAgIGJvb2xlYW4gY2FzdGxo\ncyA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gY2FzdHJocyA9IGZhbHNlOwog\nICAgICAgIENsYXNzIGxjID0gRmlsdGVycy53cmFwKGxocy5nZXRUeXBlKCkp\nOwogICAgICAgIENsYXNzIHJjID0gRmlsdGVycy53cmFwKHJocy5nZXRUeXBl\nKCkpOwogICAgICAgIGludCB0eXBlID0gMDsKICAgICAgICBpZiAocmVxdWly\nZXNDYXN0Rm9yTWF0aEZ1bmN0aW9ucyAmJiAobGMgIT0gcmMKICAgICAgICAg\nICAgfHwgKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkp\nKSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBGaWx0ZXJzLnByb21vdGUobGMs\nIHJjKTsKICAgICAgICAgICAgdHlwZSA9IGdldEpEQkNUeXBlKEphdmFUeXBl\ncy5nZXRUeXBlQ29kZShjKSwgZmFsc2UpOwogICAgICAgICAgICBpZiAodHlw\nZSAhPSBUeXBlcy5WQVJCSU5BUlkgJiYgdHlwZSAhPSBUeXBlcy5CTE9CKSB7\nCiAgICAgICAgICAgICAgICBjYXN0bGhzID0gKGxocy5pc0NvbnN0YW50KCkg\nJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwgbGMgIT0gYzsKICAgICAgICAgICAg\nICAgIGNhc3RyaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25z\ndGFudCgpKSB8fCByYyAhPSBjOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBib29sZWFuIG1vZCA9ICJNT0QiLmVxdWFscyhvcCk7CiAgICAg\nICAgaWYgKG1vZCkgewogICAgICAgICAgICBpZiAoc3VwcG9ydHNNb2RPcGVy\nYXRvcikKICAgICAgICAgICAgICAgIG9wID0gIiUiOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKG9wKTsKICAgICAgICB9\nCiAgICAgICAgYnVmLmFwcGVuZCgiKCIpOwoKICAgICAgICBpZiAoY2FzdGxo\ncykKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIGxocywgdHlwZSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBsaHMuYXBwZW5kVG8oYnVmKTsKCiAg\nICAgICAgaWYgKG1vZCAmJiAhc3VwcG9ydHNNb2RPcGVyYXRvcikKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwoK\nICAgICAgICBpZiAoY2FzdHJocykKICAgICAgICAgICAgYXBwZW5kQ2FzdChi\ndWYsIHJocywgdHlwZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByaHMu\nYXBwZW5kVG8oYnVmKTsKCiAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAg\nfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgY29tcGFyaXNvbi4KICAgICAq\nCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRo\nZSBjb21wYXJpc29uCiAgICAgKiBAcGFyYW0gb3AgdGhlIGNvbXBhcmlzb24g\nb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAgICAqIEBwYXJhbSBsaHMgdGhlIGxl\nZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFyYW0g\ncmhzIHRoZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24KICAg\nICAqLwogICAgcHVibGljIHZvaWQgY29tcGFyaXNvbihTUUxCdWZmZXIgYnVm\nLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVlIGxocywKICAgICAgICBGaWx0ZXJW\nYWx1ZSByaHMpIHsKICAgICAgICBib29sZWFuIGxoc3htbCA9IGxocy5nZXRY\nUGF0aCgpICE9IG51bGw7CiAgICAgICAgYm9vbGVhbiByaHN4bWwgPSByaHMu\nZ2V0WFBhdGgoKSAhPSBudWxsOwogICAgICAgIGlmIChsaHN4bWwgfHwgcmhz\neG1sKSB7CiAgICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24oYnVmLCBv\ncCwgbGhzLCByaHMsIGxoc3htbCwgcmhzeG1sKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KICAgICAgICBib29sZWFuIGNhc3RsaHMgPSBmYWxz\nZTsKICAgICAgICBib29sZWFuIGNhc3RyaHMgPSBmYWxzZTsKICAgICAgICBD\nbGFzcyBsYyA9IEZpbHRlcnMud3JhcChsaHMuZ2V0VHlwZSgpKTsKICAgICAg\nICBDbGFzcyByYyA9IEZpbHRlcnMud3JhcChyaHMuZ2V0VHlwZSgpKTsKICAg\nICAgICBpbnQgdHlwZSA9IDA7CiAgICAgICAgaWYgKHJlcXVpcmVzQ2FzdEZv\nckNvbXBhcmlzb25zICYmIChsYyAhPSByYwogICAgICAgICAgICB8fCAobGhz\nLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSkpIHsKICAgICAg\nICAgICAgQ2xhc3MgYyA9IEZpbHRlcnMucHJvbW90ZShsYywgcmMpOwogICAg\nICAgICAgICB0eXBlID0gZ2V0SkRCQ1R5cGUoSmF2YVR5cGVzLmdldFR5cGVD\nb2RlKGMpLCBmYWxzZSk7CiAgICAgICAgICAgIGlmICh0eXBlICE9IFR5cGVz\nLlZBUkJJTkFSWSAmJiB0eXBlICE9IFR5cGVzLkJMT0IpIHsKICAgICAgICAg\nICAgICAgIGNhc3RsaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXND\nb25zdGFudCgpKSB8fCBsYyAhPSBjOwogICAgICAgICAgICAgICAgY2FzdHJo\ncyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8\nIHJjICE9IGM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nIChjYXN0bGhzKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgbGhzLCB0\neXBlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxocy5hcHBlbmRUbyhi\ndWYpOwoKICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBl\nbmQoIiAiKTsKCiAgICAgICAgaWYgKGNhc3RyaHMpCiAgICAgICAgICAgIGFw\ncGVuZENhc3QoYnVmLCByaHMsIHR5cGUpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgcmhzLmFwcGVuZFRvKGJ1Zik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJZiB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgWE1MIHR5cGUsCiAgICAg\nKiB1c2UgdGhpcyBtZXRob2QgdG8gYXBwZW5kIHhtbCBwcmVkaWNhdGUuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGFwcGVuZFhtbENvbXBhcmlzb24oU1FM\nQnVmZmVyIGJ1ZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAg\nICAgRmlsdGVyVmFsdWUgcmhzLCBib29sZWFuIGxoc3htbCwgYm9vbGVhbiBy\naHN4bWwpIHsKICAgICAgICBhc3NlcnRTdXBwb3J0KHN1cHBvcnRzWE1MQ29s\ndW1uLCAiU3VwcG9ydHNYTUxDb2x1bW4iKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFwcGVuZCBTUUwgZm9yIHRoZSBnaXZlbiBudW1lcmljIHZhbHVlIHRv\nIHRoZSBidWZmZXIsIGNhc3RpbmcgYXMgbmVlZGVkLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBhcHBlbmROdW1lcmljQ2FzdChTUUxCdWZmZXIgYnVm\nLCBGaWx0ZXJWYWx1ZSB2YWwpIHsKICAgICAgICBpZiAodmFsLmlzQ29uc3Rh\nbnQoKSkKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIHZhbCwgVHlwZXMu\nTlVNRVJJQyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB2YWwuYXBwZW5k\nVG8oYnVmKTsKICAgIH0KCiAgICAvKioKICAgICAqIENhc3QgdGhlIHNwZWNp\nZmllZCB2YWx1ZSB0byB0aGUgc3BlY2lmaWVkIHR5cGUuCiAgICAgKgogICAg\nICogQHBhcmFtIGJ1ZiB0aGUgYnVmZmVyIHRvIGFwcGVuZCB0aGUgY2FzdCB0\nbwogICAgICogQHBhcmFtIHZhbCB0aGUgdmFsdWUgdG8gY2FzdAogICAgICog\nQHBhcmFtIHR5cGUgdGhlIHR5cGUgb2YgdGhlIGNhc2UsIGUuZy4ge0BsaW5r\nIFR5cGVzI05VTUVSSUN9CiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFwcGVu\nZENhc3QoU1FMQnVmZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgdmFsLCBpbnQgdHlw\nZSkgewogICAgICAgIC8vIENvbnZlcnQgdGhlIGNhc3QgZnVuY3Rpb246ICJD\nQVNUKHswfSBBUyB7MX0pIgogICAgICAgIGludCBmaXJzdFBhcmFtID0gY2Fz\ndEZ1bmN0aW9uLmluZGV4T2YoInswfSIpOwogICAgICAgIFN0cmluZyBwcmUg\nPSBjYXN0RnVuY3Rpb24uc3Vic3RyaW5nKDAsIGZpcnN0UGFyYW0pOyAvLyAi\nQ0FTVCgiCiAgICAgICAgU3RyaW5nIG1pZCA9IGNhc3RGdW5jdGlvbi5zdWJz\ndHJpbmcoZmlyc3RQYXJhbSArIDMpOwogICAgICAgIGludCBzZWNvbmRQYXJh\nbSA9IG1pZC5pbmRleE9mKCJ7MX0iKTsKICAgICAgICBTdHJpbmcgcG9zdDsK\nICAgICAgICBpZiAoc2Vjb25kUGFyYW0gPiAtMSkgewogICAgICAgICAgICBw\nb3N0ID0gbWlkLnN1YnN0cmluZyhzZWNvbmRQYXJhbSArIDMpOyAvLyAiKSIK\nICAgICAgICAgICAgbWlkID0gbWlkLnN1YnN0cmluZygwLCBzZWNvbmRQYXJh\nbSk7IC8vICIgQVMgIgogICAgICAgIH0gZWxzZQogICAgICAgICAgICBwb3N0\nID0gIiI7CgogICAgICAgIGJ1Zi5hcHBlbmQocHJlKTsKICAgICAgICB2YWwu\nYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKG1pZCk7CiAgICAg\nICAgYnVmLmFwcGVuZChnZXRUeXBlTmFtZSh0eXBlKSk7CiAgICAgICAgYXBw\nZW5kTGVuZ3RoKGJ1ZiwgdHlwZSk7CiAgICAgICAgYnVmLmFwcGVuZChwb3N0\nKTsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kTGVuZ3Ro\nKFNRTEJ1ZmZlciBidWYsIGludCB0eXBlKSB7ICAgICAgICAKICAgIH0KCiAg\nICAKICAgIC8qKgogICAgICogYWRkIENBU1QgZm9yIGEgZnVuY3Rpb24gb3Bl\ncmF0b3Igd2hlcmUgb3BlcmFuZCBpcyBhIHBhcmFtCiAgICAgKiBAcGFyYW0g\nZnVuYyAgZnVuY3Rpb24gbmFtZQogICAgICogQHBhcmFtIHZhbCAKICAgICAq\nIEByZXR1cm4gdXBkYXRlZCBmdW5jCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmcgYWRkQ2FzdEFzVHlwZShTdHJpbmcgZnVuYywgVmFsIHZhbCkgewogICAg\nICAgIHJldHVybiBudWxsOwogICAgfSAgICAKCgogICAgLy8vLy8vLy8vLy8K\nICAgIC8vIERETCBTUUwKICAgIC8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAg\nKiBJbmNyZW1lbnQgdGhlIHJlZmVyZW5jZSBjb3VudCBvZiBhbnkgdGFibGUg\nY29tcG9uZW50cyB0aGF0IHRoaXMKICAgICAqIGRpY3Rpb25hcnkgYWRkcyB0\naGF0IGFyZSBub3QgdXNlZCBieSBtYXBwaW5ncy4gRG9lcyBub3RoaW5nIGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlZlNjaGVtYUNv\nbXBvbmVudHMoVGFibGUgdGFibGUpIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgdGhlIGZ1bGwgbmFtZSBvZiB0aGUgdGFibGUsIGluY2x1ZGlu\nZyB0aGUgc2NoZW1hIChkZWxpbWl0ZWQKICAgICAqIGJ5IHtAbGluayAjY2F0\nYWxvZ1NlcGFyYXRvcn0pLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndEZ1bGxOYW1lKFRhYmxlIHRhYmxlLCBib29sZWFuIGxvZ2ljYWwpIHsKICAg\nICAgICBpZiAoIXVzZVNjaGVtYU5hbWUgfHwgdGFibGUuZ2V0U2NoZW1hTmFt\nZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0YWJsZS5nZXROYW1l\nKCk7CiAgICAgICAgaWYgKGxvZ2ljYWwgfHwgIi4iLmVxdWFscyhjYXRhbG9n\nU2VwYXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIHRhYmxlLmdldEZ1bGxO\nYW1lKCk7CiAgICAgICAgcmV0dXJuIHRhYmxlLmdldFNjaGVtYU5hbWUoKSAr\nIGNhdGFsb2dTZXBhcmF0b3IgKyB0YWJsZS5nZXROYW1lKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIGlu\nZGV4LCBpbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBi\neSB0aGUgcmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRvcn0pLgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1lKEluZGV4IGlu\nZGV4KSB7CiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IGluZGV4Lmdl\ndFNjaGVtYU5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gaW5k\nZXguZ2V0TmFtZSgpOwogICAgICAgIGlmICgiLiIuZXF1YWxzKGNhdGFsb2dT\nZXBhcmF0b3IpKQogICAgICAgICAgICByZXR1cm4gaW5kZXguZ2V0RnVsbE5h\nbWUoKTsKICAgICAgICByZXR1cm4gaW5kZXguZ2V0U2NoZW1hTmFtZSgpICsg\nY2F0YWxvZ1NlcGFyYXRvciArIGluZGV4LmdldE5hbWUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIGZ1bGwgbmFtZSBvZiB0aGUgc2Vx\ndWVuY2UsIGluY2x1ZGluZyB0aGUgc2NoZW1hIChkZWxpbWl0ZWQKICAgICAq\nIGJ5IHRoZSByZXN1bHQgb2Yge0BsaW5rICNjYXRhbG9nU2VwYXJhdG9yfSku\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0RnVsbE5hbWUoU2VxdWVu\nY2Ugc2VxKSB7CiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IHNlcS5n\nZXRTY2hlbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHNl\ncS5nZXROYW1lKCk7CiAgICAgICAgaWYgKCIuIi5lcXVhbHMoY2F0YWxvZ1Nl\ncGFyYXRvcikpCiAgICAgICAgICAgIHJldHVybiBzZXEuZ2V0RnVsbE5hbWUo\nKTsKICAgICAgICByZXR1cm4gc2VxLmdldFNjaGVtYU5hbWUoKSArIGNhdGFs\nb2dTZXBhcmF0b3IgKyBzZXEuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVu\nIHRhYmxlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9yIHRoZSBj\ndXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlk\nVGFibGVOYW1lKFN0cmluZyBuYW1lLCBTY2hlbWEgc2NoZW1hKSB7CiAgICAg\nICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBu\nYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgcmV0dXJuIG1ha2VO\nYW1lVmFsaWQobmFtZSwgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCksCiAgICAg\nICAgICAgIG1heFRhYmxlTmFtZUxlbmd0aCwgTkFNRV9UQUJMRSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0\nbyB0aGUgZ2l2ZW4gc2VxdWVuY2UgbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAg\nICAgKiBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0VmFsaWRTZXF1ZW5jZU5hbWUoU3RyaW5nIG5hbWUsIFNjaGVt\nYSBzY2hlbWEpIHsKICAgICAgICB3aGlsZSAobmFtZS5zdGFydHNXaXRoKCJf\nIikpCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKICAg\nICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZCgiU18iICsgbmFtZSwgc2NoZW1h\nLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heFRhYmxlTmFtZUxl\nbmd0aCwgTkFNRV9TRVFVRU5DRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gY29sdW1u\nIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJyZW50\nIERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkQ29sdW1u\nTmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICB3aGls\nZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5hbWUgPSBu\nYW1lLnN1YnN0cmluZygxKTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxp\nZChuYW1lLCB0YWJsZSwgbWF4Q29sdW1uTmFtZUxlbmd0aCwgTkFNRV9BTlkp\nOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNo\nYW5nZXMgdG8gdGhlIGdpdmVuIHByaW1hcnkga2V5IG5hbWUgdG8gbWFrZSBp\ndAogICAgICogdmFsaWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkUHJpbWFyeUtleU5hbWUoU3RyaW5n\nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3Rh\ncnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJp\nbmcoMSk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlBfIiArIG5h\nbWUsIHRhYmxlLmdldFNjaGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAgICAg\nICAgICAgIG1heENvbnN0cmFpbnROYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdl\ncyB0byB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgbmFtZSB0byBtYWtlIGl0CiAg\nICAgKiB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0VmFsaWRGb3JlaWduS2V5TmFtZShTdHJpbmcgbmFt\nZSwgVGFibGUgdGFibGUsCiAgICAgICAgVGFibGUgdG9UYWJsZSkgewogICAg\nICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAg\nbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIFN0cmluZyB0YWJs\nZU5hbWUgPSB0YWJsZS5nZXROYW1lKCk7CiAgICAgICAgaW50IGxlbiA9IE1h\ndGgubWluKHRhYmxlTmFtZS5sZW5ndGgoKSwgNyk7CiAgICAgICAgbmFtZSA9\nICJGXyIgKyBzaG9ydGVuKHRhYmxlTmFtZSwgbGVuKSArICJfIiArIG5hbWU7\nCiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQobmFtZSwgdGFibGUuZ2V0\nU2NoZW1hKCkuZ2V0U2NoZW1hR3JvdXAoKSwKICAgICAgICAgICAgbWF4Q29u\nc3RyYWludE5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZl\nbiBpbmRleCBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUg\nY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxp\nZEluZGV4TmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAg\nICB3aGlsZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5h\nbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBTdHJpbmcgdGFibGVO\nYW1lID0gdGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBsZW4gPSBNYXRo\nLm1pbih0YWJsZU5hbWUubGVuZ3RoKCksIDcpOwogICAgICAgIG5hbWUgPSAi\nSV8iICsgc2hvcnRlbih0YWJsZU5hbWUsIGxlbikgKyAiXyIgKyBuYW1lOwog\nICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLmdldFNj\naGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heEluZGV4\nTmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAgIC8qKgogICAgICog\nTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIHVuaXF1\nZSBjb25zdHJhaW50IG5hbWUgdG8gbWFrZQogICAgICogaXQgdmFsaWQgZm9y\nIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndFZhbGlkVW5pcXVlTmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsK\nICAgICAgICB3aGlsZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAg\nICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBTdHJpbmcg\ndGFibGVOYW1lID0gdGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBsZW4g\nPSBNYXRoLm1pbih0YWJsZU5hbWUubGVuZ3RoKCksIDcpOwogICAgICAgIG5h\nbWUgPSAiVV8iICsgc2hvcnRlbih0YWJsZU5hbWUsIGxlbikgKyAiXyIgKyBu\nYW1lOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxl\nLmdldFNjaGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1h\neENvbnN0cmFpbnROYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTaG9ydGVuIHRoZSBzcGVjaWZpZWQgbmFtZSB0byB0aGUg\nc3BlY2lmaWVkIHRhcmdldCBuYW1lLiBUaGlzIHdpbGwKICAgICAqIGJlIGRv\nbmUgYnkgZmlyc3Qgc3RyaXBwaW5nIG91dCB0aGUgdm93ZWxzLCBhbmQgdGhl\nbiByZW1vdmluZwogICAgICogY2hhcmFjdGVycyBmcm9tIHRoZSBtaWRkbGUg\nb2YgdGhlIHdvcmQgdW50aWwgaXQgcmVhY2hlcyB0aGUgdGFyZ2V0CiAgICAg\nKiBsZW5ndGguCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgU3RyaW5n\nIHNob3J0ZW4oU3RyaW5nIG5hbWUsIGludCB0YXJnZXRMZW5ndGgpIHsKICAg\nICAgICBpZiAobmFtZSA9PSBudWxsIHx8IG5hbWUubGVuZ3RoKCkgPD0gdGFy\nZ2V0TGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gbmFtZTsKCiAgICAgICAg\nU3RyaW5nQnVmZmVyIG5tID0gbmV3IFN0cmluZ0J1ZmZlcihuYW1lKTsKICAg\nICAgICB3aGlsZSAobm0ubGVuZ3RoKCkgPiB0YXJnZXRMZW5ndGgpIHsKICAg\nICAgICAgICAgaWYgKCFzdHJpcFZvd2VsKG5tKSkgewogICAgICAgICAgICAg\nICAgLy8gY3V0IG91dCB0aGUgbWlkZGxlIGNoYXIKICAgICAgICAgICAgICAg\nIG5tLnJlcGxhY2Uobm0ubGVuZ3RoKCkgLyAyLCAobm0ubGVuZ3RoKCkgLyAy\nKSArIDEsICIiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbm0udG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbW92ZSB2b3dlbHMgZnJvbSB0aGUgc3BlY2lmaWVkIFN0cmluZ0J1ZmZlci4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYW55IHZvd2VscyBoYXZl\nIGJlZW4gcmVtb3ZlZAogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29s\nZWFuIHN0cmlwVm93ZWwoU3RyaW5nQnVmZmVyIG5hbWUpIHsKICAgICAgICBp\nZiAobmFtZSA9PSBudWxsIHx8IG5hbWUubGVuZ3RoKCkgPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBjaGFyW10gdm93ZWxzID0g\neyAnQScsICdFJywgJ0knLCAnTycsICdVJywgfTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHZvd2Vscy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpbnQgaW5kZXggPSBuYW1lLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKS5p\nbmRleE9mKHZvd2Vsc1tpXSk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPSAt\nMSkgewogICAgICAgICAgICAgICAgbmFtZS5yZXBsYWNlKGluZGV4LCBpbmRl\neCArIDEsICIiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNob3J0ZW5zIHRoZSBnaXZlbiBuYW1lIHRv\nIHRoZSBnaXZlbiBtYXhpbXVtIGxlbmd0aCwgdGhlbiBjaGVja3MgdGhhdAog\nICAgICogaXQgaXMgbm90IGEgcmVzZXJ2ZWQgd29yZC4gSWYgaXQgaXMgcmVz\nZXJ2ZWQsIGFwcGVuZHMgYSAiMCIuIElmCiAgICAgKiB0aGUgbmFtZSBjb25m\nbGljdHMgd2l0aCBhbiBleGlzdGluZyBzY2hlbWEgY29tcG9uZW50LCB0aGUg\nbGFzdAogICAgICogY2hhcmFjdGVyIGlzIHJlcGxhY2Ugd2l0aCAnMCcsIHRo\nZW4gJzEnLCBldGMuCiAgICAgKiBOb3RlIHRoYXQgdGhlIGdpdmVuIG1heCBs\nZW4gbWF5IGJlIDAgaWYgdGhlIGRhdGFiYXNlIG1ldGFkYXRhIGlzCiAgICAg\nKiBpbmNvbXBsZXRlLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG1h\na2VOYW1lVmFsaWQoU3RyaW5nIG5hbWUsIE5hbWVTZXQgc2V0LCBpbnQgbWF4\nTGVuLAogICAgICAgIGludCBuYW1lVHlwZSkgewogICAgICAgIGlmIChtYXhM\nZW4gPCAxKQogICAgICAgICAgICBtYXhMZW4gPSAyNTU7CiAgICAgICAgaWYg\nKG5hbWUubGVuZ3RoKCkgPiBtYXhMZW4pCiAgICAgICAgICAgIG5hbWUgPSBu\nYW1lLnN1YnN0cmluZygwLCBtYXhMZW4pOwogICAgICAgIGlmIChyZXNlcnZl\nZFdvcmRTZXQuY29udGFpbnMobmFtZS50b1VwcGVyQ2FzZSgpKSkgewogICAg\nICAgICAgICBpZiAobmFtZS5sZW5ndGgoKSA9PSBtYXhMZW4pCiAgICAgICAg\nICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGgo\nKSAtIDEpOwogICAgICAgICAgICBuYW1lICs9ICIwIjsKICAgICAgICB9Cgog\nICAgICAgIC8vIG5vdyBtYWtlIHN1cmUgdGhlIG5hbWUgaXMgdW5pcXVlCiAg\nICAgICAgaWYgKHNldCAhPSBudWxsKSB7CiAgICAgICAgICAgIG91dGVyOgog\nICAgICAgICAgICBmb3IgKGludCB2ZXJzaW9uID0gMSwgY2hhcnMgPSAxOyB0\ncnVlOyB2ZXJzaW9uKyspIHsKICAgICAgICAgICAgICAgIC8vIGZvciB0YWJs\nZSBuYW1lcywgd2UgY2hlY2sgZm9yIHRoZSB0YWJsZSBpdHNlbGYgaW4gY2Fz\nZSB0aGUKICAgICAgICAgICAgICAgIC8vIG5hbWUgc2V0IGlzIGxhenkgYWJv\ndXQgc2NoZW1hIHJlZmxlY3Rpb24KICAgICAgICAgICAgICAgIHN3aXRjaCAo\nbmFtZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIE5BTUVfVEFC\nTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKChTY2hlbWFHcm91\ncCkgc2V0KS5pc0tub3duVGFibGUobmFtZSkpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBicmVhayBvdXRlcjsKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBOQU1FX1NFUVVF\nTkNFOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgoU2NoZW1hR3Jv\ndXApIHNldCkuaXNLbm93blNlcXVlbmNlKG5hbWUpKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICghc2V0LmlzTmFtZVRha2VuKG5h\nbWUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gYSBzaW5n\nbGUgY2hhciBmb3IgdGhlIHZlcnNpb24gaXMgcHJvYmFibHkgZW5vdWdoLCBi\ndXQgbWlnaHQKICAgICAgICAgICAgICAgIC8vIGFzIHdlbGwgYmUgZ2VuZXJh\nbCBhYm91dCBpdC4uLgogICAgICAgICAgICAgICAgaWYgKHZlcnNpb24gPiAx\nKQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygw\nLCBuYW1lLmxlbmd0aCgpIC0gY2hhcnMpOwogICAgICAgICAgICAgICAgaWYg\nKHZlcnNpb24gPj0gTWF0aC5wb3coMTAsIGNoYXJzKSkKICAgICAgICAgICAg\nICAgICAgICBjaGFycysrOwogICAgICAgICAgICAgICAgaWYgKG5hbWUubGVu\nZ3RoKCkgKyBjaGFycyA+IG1heExlbikKICAgICAgICAgICAgICAgICAgICBu\nYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgbWF4TGVuIC0gY2hhcnMpOwogICAg\nICAgICAgICAgICAgbmFtZSA9IG5hbWUgKyB2ZXJzaW9uOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBuYW1lLnRvVXBwZXJDYXNl\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2Yg\nU1FMIHN0YXRlbWVudHMgdG8gY3JlYXRlIHRoZSBnaXZlbiB0YWJsZSwgY29t\ncGxldGUKICAgICAqIHdpdGggY29sdW1ucy4gSW5kZXhlcyBhbmQgY29uc3Ry\nYWludHMgd2lsbCBiZSBjcmVhdGVkIHNlcGFyYXRlbHkuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVUYWJsZVNRTChUYWJsZSB0YWJs\nZSkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVm\nZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFIFRBQkxFICIpLmFw\ncGVuZChnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpKS4KICAgICAgICAgICAg\nYXBwZW5kKCIgKCIpOwoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gdGFibGUu\nZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29s\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaSA+IDApCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAgICBidWYu\nYXBwZW5kKGdldERlY2xhcmVDb2x1bW5TUUwoY29sc1tpXSwgZmFsc2UpKTsK\nICAgICAgICB9CgogICAgICAgIFByaW1hcnlLZXkgcGsgPSB0YWJsZS5nZXRQ\ncmltYXJ5S2V5KCk7CiAgICAgICAgU3RyaW5nIHBrU3RyOwogICAgICAgIGlm\nIChwayAhPSBudWxsKSB7CiAgICAgICAgICAgIHBrU3RyID0gZ2V0UHJpbWFy\neUtleUNvbnN0cmFpbnRTUUwocGspOwogICAgICAgICAgICBpZiAocGtTdHIg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIikuYXBw\nZW5kKHBrU3RyKTsKICAgICAgICB9CgogICAgICAgIFVuaXF1ZVtdIHVucXMg\nPSB0YWJsZS5nZXRVbmlxdWVzKCk7CiAgICAgICAgU3RyaW5nIHVucVN0cjsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHVucXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgdW5xU3RyID0gZ2V0VW5pcXVlQ29uc3RyYWludFNR\nTCh1bnFzW2ldKTsKICAgICAgICAgICAgaWYgKHVucVN0ciAhPSBudWxsKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKS5hcHBlbmQodW5xU3Ry\nKTsKICAgICAgICB9CgogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1tdeyBidWYudG9TdHJpbmcoKSB9OwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0\nZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHRhYmxlLiBJbmRleGVzCiAgICAg\nKiB3aWxsIGJlIGRyb3BwZWQgc2VwYXJhdGVseS4gUmV0dXJucwogICAgICog\nPGNvZGU+RFJPUCBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDs8L2NvZGU+IGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9w\nVGFibGVTUUwoVGFibGUgdGFibGUpIHsKICAgICAgICBTdHJpbmcgZHJvcCA9\nIE1lc3NhZ2VGb3JtYXQuZm9ybWF0KGRyb3BUYWJsZVNRTCwgbmV3IE9iamVj\ndFtdewogICAgICAgICAgICBnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpIH0p\nOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117IGRyb3AgfTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVt\nZW50cyB0byBjcmVhdGUgdGhlIGdpdmVuIHNlcXVlbmNlLiBSZXR1cm5zCiAg\nICAgKiA8Y29kZT5DUkVBVEUgU0VRVUVOQ0UgJmx0O3NlcXVlbmNlIG5hbWUm\nZ3Q7WyBTVEFSVCBXSVRIICZsdDtzdGFydCZndDtdCiAgICAgKiBbIElOQ1JF\nTUVOVCBCWSAmbHQ7aW5jcmVtZW50Jmd0O108L2NvZGU+IGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVTZXF1ZW5j\nZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBpZiAobmV4dFNlcXVlbmNl\nUXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFIFNFUVVFTkNFICIpOwogICAgICAg\nIGJ1Zi5hcHBlbmQoZ2V0RnVsbE5hbWUoc2VxKSk7CiAgICAgICAgaWYgKHNl\ncS5nZXRJbml0aWFsVmFsdWUoKSAhPSAwKQogICAgICAgICAgICBidWYuYXBw\nZW5kKCIgU1RBUlQgV0lUSCAiKS5hcHBlbmQoc2VxLmdldEluaXRpYWxWYWx1\nZSgpKTsKICAgICAgICBpZiAoc2VxLmdldEluY3JlbWVudCgpID4gMSkKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiIElOQ1JFTUVOVCBCWSAiKS5hcHBlbmQo\nc2VxLmdldEluY3JlbWVudCgpKTsKICAgICAgICByZXR1cm4gbmV3IFN0cmlu\nZ1tdeyBidWYudG9TdHJpbmcoKSB9OwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhl\nIGdpdmVuIHNlcXVlbmNlLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5EUk9QIFNF\nUVVFTkNFICZsdDtzZXF1ZW5jZSBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BTZXF1ZW5j\nZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICByZXR1cm4gbmV3IFN0cmlu\nZ1tdeyAiRFJPUCBTRVFVRU5DRSAiICsgZ2V0RnVsbE5hbWUoc2VxKSB9Owog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBz\ndGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMK\nICAgICAqIDxjb2RlPkNSRUFURSBbVU5JUVVFXSBJTkRFWCAmbHQ7aW5kZXgg\nbmFtZSZndDsgT04gJmx0O3RhYmxlIG5hbWUmZ3Q7CiAgICAgKiAoJmx0O2Nv\nbCBsaXN0Jmd0Oyk8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVJbmRleFNRTChJbmRleCBpbmRleCkg\newogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVy\nKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFICIpOwogICAgICAgIGlm\nIChpbmRleC5pc1VuaXF1ZSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJV\nTklRVUUgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiSU5ERVggIikuYXBwZW5k\nKGluZGV4LmdldE5hbWUoKSk7CgogICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiAi\nKS5hcHBlbmQoZ2V0RnVsbE5hbWUoaW5kZXguZ2V0VGFibGUoKSwgZmFsc2Up\nKTsKICAgICAgICBidWYuYXBwZW5kKCIgKCIpLmFwcGVuZChTdHJpbmdzLmpv\naW4oaW5kZXguZ2V0Q29sdW1ucygpLCAiLCAiKSkuCiAgICAgICAgICAgIGFw\ncGVuZCgiKSIpOwoKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBidWYu\ndG9TdHJpbmcoKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGlu\nZGV4LiBSZXR1cm5zCiAgICAgKiA8Y29kZT5EUk9QIElOREVYICZsdDtpbmRl\neCBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZ1tdIGdldERyb3BJbmRleFNRTChJbmRleCBpbmRleCkgewog\nICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJEUk9QIElOREVYICIgKyBn\nZXRGdWxsTmFtZShpbmRleCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBhZGQgdGhlIGdp\ndmVuIGNvbHVtbiB0bwogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1w\ndHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuIFJldHVybnMK\nICAgICAqIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBB\nREQgKCZsdDtjb2wgZGVjJmd0Oyk8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkQ29sdW1uU1FM\nKENvbHVtbiBjb2x1bW4pIHsKICAgICAgICBpZiAoIXN1cHBvcnRzQWx0ZXJU\nYWJsZVdpdGhBZGRDb2x1bW4pCiAgICAgICAgICAgIHJldHVybiBuZXcgU3Ry\naW5nWzBdOwoKICAgICAgICBTdHJpbmcgZGVjID0gZ2V0RGVjbGFyZUNvbHVt\nblNRTChjb2x1bW4sIHRydWUpOwogICAgICAgIGlmIChkZWMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0\ndXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAg\nKyBnZXRGdWxsTmFtZShjb2x1bW4uZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBB\nREQgIiArIGRlYyB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGNv\nbHVtbiBmcm9tCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBh\ncnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4gUmV0dXJucwogICAg\nICogPGNvZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IERST1Ag\nQ09MVU1OICZsdDtjb2wgbmFtZSZndDs8L2NvZGU+CiAgICAgKiBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcENvbHVt\nblNRTChDb2x1bW4gY29sdW1uKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0Fs\ndGVyVGFibGVXaXRoRHJvcENvbHVtbikKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFM\nVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShjb2x1bW4u\nZ2V0VGFibGUoKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENPTFVN\nTiAiICsgY29sdW1uIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gYWRkIHRoZSBnaXZlbiBw\ncmltYXJ5IGtleSB0bwogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1w\ndHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBS\nZXR1cm5zIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBB\nREQKICAgICAqICZsdDtwayBjb25zIHNxbCAmZ3Q7PC9jb2RlPiBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkUHJpbWFy\neUtleVNRTChQcmltYXJ5S2V5IHBrKSB7CiAgICAgICAgU3RyaW5nIHBrc3Fs\nID0gZ2V0UHJpbWFyeUtleUNvbnN0cmFpbnRTUUwocGspOwogICAgICAgIGlm\nIChwa3NxbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmlu\nZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFC\nTEUgIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKHBrLmdldFRhYmxlKCks\nIGZhbHNlKSArICIgQUREICIgKyBwa3NxbCB9OwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRy\nb3AgdGhlIGdpdmVuIHByaW1hcnkga2V5IGZyb20KICAgICAqIGl0cyB0YWJs\nZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3Vw\ncG9ydGVkLgogICAgICogUmV0dXJucyA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7\ndGFibGUgbmFtZSZndDsgRFJPUCBDT05TVFJBSU5UCiAgICAgKiAmbHQ7cGsg\nbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXREcm9wUHJpbWFyeUtleVNRTChQcmltYXJ5S2V5IHBr\nKSB7CiAgICAgICAgaWYgKHBrLmdldE5hbWUoKSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3\nIFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1\nbGxOYW1lKHBrLmdldFRhYmxlKCksIGZhbHNlKQogICAgICAgICAgICArICIg\nRFJPUCBDT05TVFJBSU5UICIgKyBway5nZXROYW1lKCkgfTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50\ncyB0byBhZGQgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IHRvCiAgICAgKiBpdHMg\ndGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90\nIHN1cHBvcnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUg\nJmx0O3RhYmxlIG5hbWUmZ3Q7IEFERAogICAgICogJmx0O2ZrIGNvbnMgc3Fs\nICZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXRBZGRGb3JlaWduS2V5U1FMKEZvcmVpZ25LZXkgZmspIHsK\nICAgICAgICBTdHJpbmcgZmtTUUwgPSBnZXRGb3JlaWduS2V5Q29uc3RyYWlu\ndFNRTChmayk7CiAgICAgICAgaWYgKGZrU1FMID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVs\nbE5hbWUoZmsuZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiArIGZrU1FM\nIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2Yg\nU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkg\nZnJvbQogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkg\naWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxj\nb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENPTlNU\nUkFJTlQKICAgICAqICZsdDtmayBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BGb3JlaWdu\nS2V5U1FMKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoZmsuZ2V0TmFt\nZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBd\nOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAi\nCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoZmsuZ2V0VGFibGUoKSwgZmFs\nc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENPTlNUUkFJTlQgIiArIGZrLmdl\ndE5hbWUoKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBk\nZWNsYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZlbiBjb2x1bW4uIFRoaXMgbWV0\naG9kIGlzIHVzZWQKICAgICAqIGZvciBlYWNoIGNvbHVtbiBmcm9tIHdpdGhp\nbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQKICAgICAqIHtAbGlu\nayAjZ2V0QWRkQ29sdW1uU1FMfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXREZWNsYXJlQ29sdW1uU1FMKENvbHVtbiBjb2wsIGJvb2xlYW4g\nYWx0ZXIpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoY29sKS5hcHBlbmQoIiAi\nKTsKICAgICAgICBidWYuYXBwZW5kKGdldFR5cGVOYW1lKGNvbCkpOwoKICAg\nICAgICAvLyBjYW4ndCBhZGQgY29uc3RyYWludHMgdG8gYSBjb2x1bW4gd2Un\ncmUgYWRkaW5nIGFmdGVyIHRhYmxlCiAgICAgICAgLy8gY3JlYXRpb24sIGNh\ndXNlIHNvbWUgZGF0YSBtaWdodCBhbHJlYWR5IGJlIGluc2VydGVkCiAgICAg\nICAgaWYgKCFhbHRlcikgewogICAgICAgICAgICBpZiAoY29sLmdldERlZmF1\nbHRTdHJpbmcoKSAhPSBudWxsICYmICFjb2wuaXNBdXRvQXNzaWduZWQoKSkK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBERUZBVUxUICIpLmFwcGVu\nZChjb2wuZ2V0RGVmYXVsdFN0cmluZygpKTsKICAgICAgICAgICAgaWYgKGNv\nbC5pc05vdE51bGwoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBO\nT1QgTlVMTCIpOwogICAgICAgIH0KICAgICAgICBpZiAoY29sLmlzQXV0b0Fz\nc2lnbmVkKCkpIHsKICAgICAgICAgICAgaWYgKCFzdXBwb3J0c0F1dG9Bc3Np\nZ24pCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiaW52YWxp\nZC1hdXRvYXNzaWduIiwgcGxhdGZvcm0sIGNvbCkpOwogICAgICAgICAgICBl\nbHNlIGlmIChhdXRvQXNzaWduQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKGF1dG9Bc3NpZ25DbGF1c2Up\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNR\nTCBmb3IgdGhlIGdpdmVuIHByaW1hcnkga2V5LiBUaGlzIG1ldGhvZCBpcwog\nICAgICogdXNlZCBmcm9tIHdpdGhpbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxl\nU1FMfSBhbmQKICAgICAqIHtAbGluayAjZ2V0QWRkUHJpbWFyeUtleVNRTH0u\nIFJldHVybnMKICAgICAqIDxjb2RlPkNPTlNUUkFJTlQgJmx0O3BrIG5hbWUm\nZ3Q7IFBSSU1BUlkgS0VZICgmbHQ7Y29sIGxpc3QmZ3Q7KTwvY29kZT4KICAg\nICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcg\nZ2V0UHJpbWFyeUtleUNvbnN0cmFpbnRTUUwoUHJpbWFyeUtleSBwaykgewog\nICAgICAgIC8vIGlmIHdlIGhhdmUgZGlzYWJsZWQgdGhlIGNyZWF0aW9uIG9m\nIHByaW1hcnkga2V5cywgYWJvcnQgaGVyZQogICAgICAgIGlmICghY3JlYXRl\nUHJpbWFyeUtleXMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBTdHJpbmcgbmFtZSA9IHBrLmdldE5hbWUoKTsKICAgICAgICBpZiAobmFt\nZSAhPSBudWxsICYmIHJlc2VydmVkV29yZFNldC5jb250YWlucyhuYW1lLnRv\nVXBwZXJDYXNlKCkpKQogICAgICAgICAgICBuYW1lID0gbnVsbDsKCiAgICAg\nICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAg\nICAgICBpZiAobmFtZSAhPSBudWxsICYmIENPTlNfTkFNRV9CRUZPUkUuZXF1\nYWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5kKG5hbWUpLmFwcGVuZCgiICIpOwog\nICAgICAgIGJ1Zi5hcHBlbmQoIlBSSU1BUlkgS0VZICIpOwogICAgICAgIGlm\nIChuYW1lICE9IG51bGwgJiYgQ09OU19OQU1FX01JRC5lcXVhbHMoY29uc3Ry\nYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZChuYW1lKS5h\ncHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKFN0\ncmluZ3Muam9pbihway5nZXRDb2x1bW5zKCksICIsICIpKS4KICAgICAgICAg\nICAgYXBwZW5kKCIpIik7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBD\nT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5UICIpLmFwcGVuZChu\nYW1lKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3Ig\ndGhlIGdpdmVuIGZvcmVpZ24ga2V5LCBvciBudWxsIGlmIGl0IGlzCiAgICAg\nKiBub3Qgc3VwcG9ydGVkLiBUaGlzIG1ldGhvZCBpcyB1c2VkIGZyb20gd2l0\naGluCiAgICAgKiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQge0Bs\naW5rICNnZXRBZGRGb3JlaWduS2V5U1FMfS4gUmV0dXJucwogICAgICogPGNv\nZGU+Q09OU1RSQUlOVCAmbHQ7Y29ucyBuYW1lJmd0OyBGT1JFSUdOIEtFWSAo\nJmx0O2NvbCBsaXN0Jmd0OykKICAgICAqIFJFRkVSRU5DRVMgJmx0O2ZvcmVp\nZ24gdGFibGUmZ3Q7ICgmbHQ7Y29sIGxpc3QmZ3Q7KQogICAgICogW09OIERF\nTEVURSAmbHQ7YWN0aW9uJmd0O10gW09OIFVQREFURSAmbHQ7YWN0aW9uJmd0\nO108L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\ndHJpbmcgZ2V0Rm9yZWlnbktleUNvbnN0cmFpbnRTUUwoRm9yZWlnbktleSBm\naykgewogICAgICAgIGlmICghc3VwcG9ydHNGb3JlaWduS2V5cykKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGZrLmdldERlbGV0ZUFj\ndGlvbigpID09IEZvcmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChmay5pc0RlZmVycmVkKCkgJiYg\nIXN1cHBvcnRzRGVmZXJyZWRGb3JlaWduS2V5Q29uc3RyYWludHMoKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCFzdXBwb3J0c0Rl\nbGV0ZUFjdGlvbihmay5nZXREZWxldGVBY3Rpb24oKSkKICAgICAgICAgICAg\nfHwgIXN1cHBvcnRzVXBkYXRlQWN0aW9uKGZrLmdldFVwZGF0ZUFjdGlvbigp\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbHVtbltd\nIGxvY2FscyA9IGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBm\nb3JlaWducyA9IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CgogICAgICAg\nIGludCBkZWxBY3Rpb25JZCA9IGZrLmdldERlbGV0ZUFjdGlvbigpOwogICAg\nICAgIGlmIChkZWxBY3Rpb25JZCA9PSBGb3JlaWduS2V5LkFDVElPTl9OVUxM\nKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbG9jYWxzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAobG9jYWxzW2ldLmlz\nTm90TnVsbCgpKQogICAgICAgICAgICAgICAgICAgIGRlbEFjdGlvbklkID0g\nRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgU3RyaW5nIGRlbEFjdGlvbiA9IGdldEFjdGlvbk5hbWUo\nZGVsQWN0aW9uSWQpOwogICAgICAgIFN0cmluZyB1cEFjdGlvbiA9IGdldEFj\ndGlvbk5hbWUoZmsuZ2V0VXBkYXRlQWN0aW9uKCkpOwoKICAgICAgICBTdHJp\nbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGlm\nIChmay5nZXROYW1lKCkgIT0gbnVsbAogICAgICAgICAgICAmJiBDT05TX05B\nTUVfQkVGT1JFLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCJDT05TVFJBSU5UICIpLmFwcGVuZChmay5nZXRO\nYW1lKCkpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkZPUkVJ\nR04gS0VZICIpOwogICAgICAgIGlmIChmay5nZXROYW1lKCkgIT0gbnVsbCAm\nJiBDT05TX05BTUVfTUlELmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQog\nICAgICAgICAgICBidWYuYXBwZW5kKGZrLmdldE5hbWUoKSkuYXBwZW5kKCIg\nIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChTdHJpbmdzLmpv\naW4obG9jYWxzLCAiLCAiKSkuYXBwZW5kKCIpIik7CiAgICAgICAgYnVmLmFw\ncGVuZCgiIFJFRkVSRU5DRVMgIik7CiAgICAgICAgYnVmLmFwcGVuZChnZXRG\ndWxsTmFtZShmb3JlaWduc1swXS5nZXRUYWJsZSgpLCBmYWxzZSkpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIiAoIikuYXBwZW5kKFN0cmluZ3Muam9pbihmb3Jl\naWducywgIiwgIikpLmFwcGVuZCgiKSIpOwogICAgICAgIGlmIChkZWxBY3Rp\nb24gIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9OIERFTEVU\nRSAiKS5hcHBlbmQoZGVsQWN0aW9uKTsKICAgICAgICBpZiAodXBBY3Rpb24g\nIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9OIFVQREFURSAi\nKS5hcHBlbmQodXBBY3Rpb24pOwogICAgICAgIGlmIChmay5pc0RlZmVycmVk\nKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJTklUSUFMTFkgREVGRVJS\nRUQiKTsKICAgICAgICBpZiAoc3VwcG9ydHNEZWZlcnJlZEZvcmVpZ25LZXlD\nb25zdHJhaW50cygpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgREVGRVJS\nQUJMRSIpOwogICAgICAgIGlmIChmay5nZXROYW1lKCkgIT0gbnVsbAogICAg\nICAgICAgICAmJiBDT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0cmFpbnRO\nYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5U\nICIpLmFwcGVuZChmay5nZXROYW1lKCkpOwogICAgICAgIHJldHVybiBidWYu\ndG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3Ig\nbm90IHRoaXMgZGljdGlvbmFyeSBzdXBwb3J0cyBkZWZlcnJlZCBmb3JlaWdu\nIGtleSBjb25zdHJhaW50cy4KICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24g\ncmV0dXJucyB7QGxpbmsgI3N1cHBvcnRzVW5pcXVlQ29uc3RyYWludHN9Lgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwcm90ZWN0\nZWQgYm9vbGVhbiBzdXBwb3J0c0RlZmVycmVkRm9yZWlnbktleUNvbnN0cmFp\nbnRzKCkgewogICAgICAgIHJldHVybiBzdXBwb3J0c0RlZmVycmVkQ29uc3Ry\nYWludHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUg\nb2YgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGFjdGlvbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdHJpbmcgZ2V0QWN0aW9uTmFtZShpbnQgYWN0aW9uKSB7CiAg\nICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAgICAgY2FzZSBGb3Jl\naWduS2V5LkFDVElPTl9DQVNDQURFOgogICAgICAgICAgICAgICAgcmV0dXJu\nICJDQVNDQURFIjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElP\nTl9OVUxMOgogICAgICAgICAgICAgICAgcmV0dXJuICJTRVQgTlVMTCI7CiAg\nICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDoKICAg\nICAgICAgICAgICAgIHJldHVybiAiU0VUIERFRkFVTFQiOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIGRhdGFi\nYXNlIHN1cHBvcnRzIHRoZSBnaXZlbiBmb3JlaWduIGtleSBkZWxldGUgYWN0\naW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0RlbGV0\nZUFjdGlvbihpbnQgYWN0aW9uKSB7CiAgICAgICAgaWYgKGFjdGlvbiA9PSBG\nb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBzd2l0Y2ggKGFjdGlvbikgewog\nICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzUmVzdHJpY3REZWxldGVB\nY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fQ0FT\nQ0FERToKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c0Nhc2NhZGVE\nZWxldGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJ\nT05fTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c051bGxE\nZWxldGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJ\nT05fREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c0Rl\nZmF1bHREZWxldGVBY3Rpb247CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB0aGlzIGRhdGFiYXNlIHN1cHBvcnRzIHRo\nZSBnaXZlbiBmb3JlaWduIGtleSB1cGRhdGUgYWN0aW9uLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1VwZGF0ZUFjdGlvbihpbnQgYWN0\naW9uKSB7CiAgICAgICAgaWYgKGFjdGlvbiA9PSBGb3JlaWduS2V5LkFDVElP\nTl9OT05FKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nIXN1cHBvcnRzRm9yZWlnbktleXMpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNl\nIEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUOgogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cHBvcnRzUmVzdHJpY3RVcGRhdGVBY3Rpb247CiAgICAgICAg\nICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBwb3J0c0Nhc2NhZGVVcGRhdGVBY3Rpb247CiAg\nICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fTlVMTDoKICAgICAg\nICAgICAgICAgIHJldHVybiBzdXBwb3J0c051bGxVcGRhdGVBY3Rpb247CiAg\nICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDoKICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rp\nb247CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZlbiB1bmlxdWUg\nY29uc3RyYWludC4gVGhpcwogICAgICogbWV0aG9kIGlzIHVzZWQgZnJvbSB3\naXRoaW4ge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNRTH0uCiAgICAgKiBSZXR1\ncm5zCTxjb2RlPkNPTlNUUkFJTlQgJmx0O25hbWUmZ3Q7IFVOSVFVRSAoJmx0\nO2NvbCBsaXN0Jmd0Oyk8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFVuaXF1ZUNvbnN0cmFpbnRT\nUUwoVW5pcXVlIHVucSkgewogICAgICAgIGlmICghc3VwcG9ydHNVbmlxdWVD\nb25zdHJhaW50cwogICAgICAgICAgICB8fCAodW5xLmlzRGVmZXJyZWQoKSAm\nJiAhc3VwcG9ydHNEZWZlcnJlZFVuaXF1ZUNvbnN0cmFpbnRzKCkpKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAodW5xLmdldE5h\nbWUoKSAhPSBudWxsCiAgICAgICAgICAgICYmIENPTlNfTkFNRV9CRUZPUkUu\nZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5kKHVucS5nZXROYW1lKCkpLmFw\ncGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlVOSVFVRSAiKTsKICAg\nICAgICBpZiAodW5xLmdldE5hbWUoKSAhPSBudWxsICYmIENPTlNfTkFNRV9N\nSUQuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQodW5xLmdldE5hbWUoKSkuYXBwZW5kKCIgIik7CiAgICAgICAg\nYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChTdHJpbmdzLmpvaW4odW5xLmdldENv\nbHVtbnMoKSwgIiwgIikpLgogICAgICAgICAgICBhcHBlbmQoIikiKTsKICAg\nICAgICBpZiAodW5xLmlzRGVmZXJyZWQoKSkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIElOSVRJQUxMWSBERUZFUlJFRCIpOwogICAgICAgIGlmIChzdXBw\nb3J0c0RlZmVycmVkVW5pcXVlQ29uc3RyYWludHMoKSkKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIERFRkVSUkFCTEUiKTsKICAgICAgICBpZiAodW5xLmdl\ndE5hbWUoKSAhPSBudWxsCiAgICAgICAgICAgICYmIENPTlNfTkFNRV9BRlRF\nUi5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIENPTlNUUkFJTlQgIikuYXBwZW5kKHVucS5nZXROYW1lKCkp\nOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgb3Igbm90IHRoaXMgZGljdGlvbmFyeSBzdXBw\nb3J0cyBkZWZlcnJlZCB1bmlxdWUgY29uc3RyYWludHMuCiAgICAgKiBUaGlz\nIGltcGxlbWVudGF0aW9uIHJldHVybnMge0BsaW5rICNzdXBwb3J0c1VuaXF1\nZUNvbnN0cmFpbnRzfS4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAg\nICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3VwcG9ydHNEZWZlcnJlZFVu\naXF1ZUNvbnN0cmFpbnRzKCkgewogICAgICAgIHJldHVybiBzdXBwb3J0c0Rl\nZmVycmVkQ29uc3RyYWludHM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBEYXRhYmFzZSBtZXRhZGF0YQogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1\nc2VkIHRvIGZpbHRlciBzeXN0ZW0gdGFibGVzIGZyb20gZGF0YWJhc2UgbWV0\nYWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdGFibGUg\nbmFtZSByZXByZXNlbnRzIGEgc3lzdGVtIHRhYmxlIHRoYXQKICAgICAqIHNo\nb3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gQnkg\nZGVmYXVsdCwgcmV0dXJucwogICAgICogdHJ1ZSBvbmx5IGlmIHRoZSBnaXZl\nbiB0YWJsZSBpcyBpbiB0aGUgaW50ZXJuYWwgbGlzdCBvZiBzeXN0ZW0gdGFi\nbGVzLAogICAgICogb3IgaWYgdGhlIGdpdmVuIHNjaGVtYSBpcyBpbiB0aGUg\nbGlzdCBvZiBzeXN0ZW0gc2NoZW1hcyBhbmQgaXMgbm90CiAgICAgKiB0aGUg\ndGFyZ2V0IHNjaGVtYS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUg\ndGFibGUgbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2No\nZW1hOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBp\nZiB0cnVlLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQog\nICAgICogdGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtVGFibGUoU3RyaW5nIG5hbWUs\nIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEp\nIHsKICAgICAgICBpZiAoc3lzdGVtVGFibGVTZXQuY29udGFpbnMobmFtZS50\nb1VwcGVyQ2FzZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgcmV0dXJuICF0YXJnZXRTY2hlbWEgJiYgc2NoZW1hICE9IG51bGwKICAg\nICAgICAgICAgJiYgc3lzdGVtU2NoZW1hU2V0LmNvbnRhaW5zKHNjaGVtYS50\nb1VwcGVyQ2FzZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSBpbmRleGVzIGZyb20gZGF0\nYWJhc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2\nZW4gaW5kZXggbmFtZSByZXByZXNlbnRzIGEgc3lzdGVtIGluZGV4IHRoYXQK\nICAgICAqIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5p\ndGlvbi4gUmV0dXJucyBmYWxzZSBieSBkZWZhdWx0LgogICAgICoKICAgICAq\nIEBwYXJhbSBuYW1lIHRoZSBpbmRleCBuYW1lCiAgICAgKiBAcGFyYW0gdGFi\nbGUgdGhlIGluZGV4IHRhYmxlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzU3lzdGVtSW5kZXgoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogVGhp\ncyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIHNlcXVlbmNlcyBm\ncm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJuIHRydWUgaWYg\ndGhlIGdpdmVuIHNlcXVlbmNlIHJlcHJlc2VudHMgYSBzeXN0ZW0gc2VxdWVu\nY2UgdGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVt\nYSBkZWZpbml0aW9uLiBSZXR1cm5zIHRydWUgaWYgc3lzdGVtCiAgICAgKiBz\nY2hlbWEgYnkgZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0\naGUgdGFibGUgbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUg\nc2NoZW1hOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVt\nYSBpZiB0cnVlLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBi\neQogICAgICogdGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoU3RyaW5n\nIG5hbWUsIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRT\nY2hlbWEpIHsKICAgICAgICByZXR1cm4gIXRhcmdldFNjaGVtYSAmJiBzY2hl\nbWEgIT0gbnVsbAogICAgICAgICAgICAmJiBzeXN0ZW1TY2hlbWFTZXQuY29u\ndGFpbnMoc2NoZW1hLnRvVXBwZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgdGFibGVzIG1h\ndGNoaW5nIHRoZSBnaXZlbiBuYW1lIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1\nYmxpYyBUYWJsZVtdIGdldFRhYmxlcyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEs\nIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBT\ndHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzdXBwb3J0c1NjaGVt\nYUZvckdldFRhYmxlcykKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IG51bGw7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzY2hlbWFOYW1lID0gZ2V0U2No\nZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpOwoKICAgICAgICBTdHJp\nbmdbXSB0eXBlcyA9IFN0cmluZ3Muc3BsaXQodGFibGVUeXBlcywgIiwiLCAw\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICB0eXBlc1tpXSA9IHR5cGVzW2ldLnRyaW0oKTsK\nCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAg\nICAgUmVzdWx0U2V0IHRhYmxlcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgdGFibGVzID0gbWV0YS5nZXRUYWJsZXMoZ2V0Q2F0YWxvZ05h\nbWVGb3JNZXRhZGF0YShjYXRhbG9nKSwKICAgICAgICAgICAgICAgIHNjaGVt\nYU5hbWUsIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSksIHR5\ncGVzKTsKICAgICAgICAgICAgTGlzdCB0YWJsZUxpc3QgPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICAgICAgICAgIHdoaWxlICh0YWJsZXMgIT0gbnVsbCAmJiB0\nYWJsZXMubmV4dCgpKQogICAgICAgICAgICAgICAgdGFibGVMaXN0LmFkZChu\nZXdUYWJsZSh0YWJsZXMpKTsKICAgICAgICAgICAgcmV0dXJuIChUYWJsZVtd\nKSB0YWJsZUxpc3QudG9BcnJheShuZXcgVGFibGVbdGFibGVMaXN0LnNpemUo\nKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICh0YWJs\nZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgdGFibGVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB0YWJsZSBm\ncm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgVGFibGUgbmV3VGFibGUoUmVzdWx0U2V0\nIHRhYmxlTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBUYWJsZSB0ID0gbmV3IFRhYmxlKCk7CiAgICAgICAgdC5zZXROYW1l\nKHRhYmxlTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAgICAg\ncmV0dXJuIHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRo\nZSBzY2hlbWEgdG8gZmluZCBzZXF1ZW5jZXMgbWF0Y2hpbmcgdGhlIGdpdmVu\nIG5hbWUgcGF0dGVybi4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgYXJyYXkg\nYnkgZGVmYXVsdCwgYXMgdGhlcmUgaXMgbm8gc3RhbmRhcmQgd2F5IHRvCiAg\nICAgKiByZXRyaWV2ZSBhIGxpc3Qgb2Ygc2VxdWVuY2VzLgogICAgICovCiAg\nICBwdWJsaWMgU2VxdWVuY2VbXSBnZXRTZXF1ZW5jZXMoRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2No\nZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSwgQ29ubmVjdGlvbiBjb25u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmlu\nZyBzdHIgPSBnZXRTZXF1ZW5jZXNTUUwoc2NoZW1hTmFtZSwgc2VxdWVuY2VO\nYW1lKTsKICAgICAgICBpZiAoc3RyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgU2VxdWVuY2VbMF07CgogICAgICAgIFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KHN0cik7CiAgICAg\nICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpbnQgaWR4ID0gMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0bW50LnNldFN0cmluZyhpZHgr\nKywgc2NoZW1hTmFtZS50b1VwcGVyQ2FzZSgpKTsKICAgICAgICAgICAgaWYg\nKHNlcXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAgICAgICAgc3RtbnQu\nc2V0U3RyaW5nKGlkeCsrLCBzZXF1ZW5jZU5hbWUpOwoKICAgICAgICAgICAg\ncnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAgTGlzdCBz\nZXFMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGlsZSAo\ncnMubmV4dCgpKQogICAgICAgICAgICAgICAgc2VxTGlzdC5hZGQobmV3U2Vx\ndWVuY2UocnMpKTsKICAgICAgICAgICAgcmV0dXJuIChTZXF1ZW5jZVtdKSBz\nZXFMaXN0LnRvQXJyYXkobmV3IFNlcXVlbmNlW3NlcUxpc3Quc2l6ZSgpXSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNl\ncXVlbmNlIGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZXF1ZW5jZSBuZXdTZXF1\nZW5jZShSZXN1bHRTZXQgc2VxdWVuY2VNZXRhKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIFNlcXVlbmNlIHNlcSA9IG5ldyBTZXF1\nZW5jZSgpOwogICAgICAgIHNlcS5zZXRTY2hlbWFOYW1lKHNlcXVlbmNlTWV0\nYS5nZXRTdHJpbmcoIlNFUVVFTkNFX1NDSEVNQSIpKTsKICAgICAgICBzZXEu\nc2V0TmFtZShzZXF1ZW5jZU1ldGEuZ2V0U3RyaW5nKCJTRVFVRU5DRV9OQU1F\nIikpOwogICAgICAgIHJldHVybiBzZXE7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIFNRTCBuZWVkZWQgdG8gc2VsZWN0IHRoZSBsaXN0IG9m\nIHNlcXVlbmNlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRT\nZXF1ZW5jZXNTUUwoU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyBzZXF1ZW5j\nZU5hbWUpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIGNvbHVtbnMg\nbWF0Y2hpbmcgdGhlIGdpdmVuIHRhYmxlIGFuZAogICAgICogY29sdW1uIHBh\ndHRlcm5zLgogICAgICovCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29sdW1u\ncyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAg\nICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBTdHJp\nbmcgY29sdW1uTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVs\nbCAmJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRDb2x1bW5zKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKCFzdXBwb3J0c1NjaGVt\nYUZvckdldENvbHVtbnMpCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBudWxs\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IGdldFNj\naGVtYU5hbWVGb3JNZXRhZGF0YShzY2hlbWFOYW1lKTsKCiAgICAgICAgYmVm\nb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0U2V0\nIGNvbHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbHMg\nPSBtZXRhLmdldENvbHVtbnMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShj\nYXRhbG9nKSwKICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUsIGdldFRhYmxl\nTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSksCiAgICAgICAgICAgICAgICBn\nZXRDb2x1bW5OYW1lRm9yTWV0YWRhdGEoY29sdW1uTmFtZSkpOwoKICAgICAg\nICAgICAgTGlzdCBjb2x1bW5MaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAg\nICAgICAgICB3aGlsZSAoY29scyAhPSBudWxsICYmIGNvbHMubmV4dCgpKQog\nICAgICAgICAgICAgICAgY29sdW1uTGlzdC5hZGQobmV3Q29sdW1uKGNvbHMp\nKTsKICAgICAgICAgICAgcmV0dXJuIChDb2x1bW5bXSkgY29sdW1uTGlzdC50\nb0FycmF5CiAgICAgICAgICAgICAgICAobmV3IENvbHVtbltjb2x1bW5MaXN0\nLnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlm\nIChjb2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIGNvbHMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNvbHVt\nbiBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRh\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sdW1uIG5ld0NvbHVtbihSZXN1\nbHRTZXQgY29sTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBDb2x1bW4gYyA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBjLnNl\ndFNjaGVtYU5hbWUoY29sTWV0YS5nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIikp\nOwogICAgICAgIGMuc2V0VGFibGVOYW1lKGNvbE1ldGEuZ2V0U3RyaW5nKCJU\nQUJMRV9OQU1FIikpOwogICAgICAgIGMuc2V0TmFtZShjb2xNZXRhLmdldFN0\ncmluZygiQ09MVU1OX05BTUUiKSk7CiAgICAgICAgYy5zZXRUeXBlKGNvbE1l\ndGEuZ2V0SW50KCJEQVRBX1RZUEUiKSk7CiAgICAgICAgYy5zZXRUeXBlTmFt\nZShjb2xNZXRhLmdldFN0cmluZygiVFlQRV9OQU1FIikpOwogICAgICAgIGMu\nc2V0U2l6ZShjb2xNZXRhLmdldEludCgiQ09MVU1OX1NJWkUiKSk7CiAgICAg\nICAgYy5zZXREZWNpbWFsRGlnaXRzKGNvbE1ldGEuZ2V0SW50KCJERUNJTUFM\nX0RJR0lUUyIpKTsKICAgICAgICBjLnNldE5vdE51bGwoY29sTWV0YS5nZXRJ\nbnQoIk5VTExBQkxFIikKICAgICAgICAgICAgPT0gRGF0YWJhc2VNZXRhRGF0\nYS5jb2x1bW5Ob051bGxzKTsKCiAgICAgICAgU3RyaW5nIGRlZiA9IGNvbE1l\ndGEuZ2V0U3RyaW5nKCJDT0xVTU5fREVGIik7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGRlZikgJiYgISJudWxsIi5lcXVhbHNJZ25vcmVD\nYXNlKGRlZikpCiAgICAgICAgICAgIGMuc2V0RGVmYXVsdFN0cmluZyhkZWYp\nOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgICogUmVm\nbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBrZXlzIGZvciB0\naGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHVibGljIFBy\naW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1l\ndGEsCiAgICAgICAgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBzY2hlbWFOYW1l\nLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZUdldEJlc3RS\nb3dJZGVudGlmaWVyRm9yUHJpbWFyeUtleXMpCiAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmltYXJ5S2V5c0Zyb21CZXN0Um93SWRlbnRpZmllcihtZXRhLCBj\nYXRhbG9nLAogICAgICAgICAgICAgICAgc2NoZW1hTmFtZSwgdGFibGVOYW1l\nLCBjb25uKTsKICAgICAgICByZXR1cm4gZ2V0UHJpbWFyeUtleXNGcm9tR2V0\nUHJpbWFyeUtleXMobWV0YSwgY2F0YWxvZywKICAgICAgICAgICAgc2NoZW1h\nTmFtZSwgdGFibGVOYW1lLCBjb25uKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBm\nb3IgdGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBQcmltYXJ5S2V5W10gZ2V0UHJpbWFyeUtleXNGcm9tR2V0UHJpbWFy\neUtleXMKICAgICAgICAoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcg\nY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUsCiAgICAgICAgICAgIFN0cmlu\nZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwg\nJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0UHJpbWFyeUtleXMpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9w\nZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQgcGtzID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBwa3MgPSBtZXRhLmdldFByaW1h\ncnlLZXlzKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyksCiAg\nICAgICAgICAgICAgICBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1h\nTmFtZSksCiAgICAgICAgICAgICAgICBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0\nYSh0YWJsZU5hbWUpKTsKCiAgICAgICAgICAgIExpc3QgcGtMaXN0ID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGlsZSAocGtzICE9IG51bGwg\nJiYgcGtzLm5leHQoKSkKICAgICAgICAgICAgICAgIHBrTGlzdC5hZGQobmV3\nUHJpbWFyeUtleShwa3MpKTsKICAgICAgICAgICAgcmV0dXJuIChQcmltYXJ5\nS2V5W10pIHBrTGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFBy\naW1hcnlLZXlbcGtMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChwa3MgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGtzLmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBwcmltYXJ5IGtleSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0\naGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJp\nbWFyeUtleSBuZXdQcmltYXJ5S2V5KFJlc3VsdFNldCBwa01ldGEpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUHJpbWFyeUtleSBw\nayA9IG5ldyBQcmltYXJ5S2V5KCk7CiAgICAgICAgcGsuc2V0U2NoZW1hTmFt\nZShwa01ldGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIpKTsKICAgICAgICBw\nay5zZXRUYWJsZU5hbWUocGtNZXRhLmdldFN0cmluZygiVEFCTEVfTkFNRSIp\nKTsKICAgICAgICBway5zZXRDb2x1bW5OYW1lKHBrTWV0YS5nZXRTdHJpbmco\nIkNPTFVNTl9OQU1FIikpOwogICAgICAgIHBrLnNldE5hbWUocGtNZXRhLmdl\ndFN0cmluZygiUEtfTkFNRSIpKTsKICAgICAgICByZXR1cm4gcGs7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmlu\nZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgUHJpbWFyeUtleVtdIGdldFByaW1hcnlL\nZXlzRnJvbUJlc3RSb3dJZGVudGlmaWVyCiAgICAgICAgKERhdGFiYXNlTWV0\nYURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBzY2hlbWFOYW1l\nLAogICAgICAgICAgICBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNv\nbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKHRhYmxlTmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAg\nICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcGtzID0gbWV0YS5nZXRCZXN0Um93SWRlbnRpZmllcihjYXRhbG9n\nLCBzY2hlbWFOYW1lLAogICAgICAgICAgICAgICAgdGFibGVOYW1lLCAwLCBm\nYWxzZSk7CgogICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxsICYmIHBrcy5u\nZXh0KCkpIHsKICAgICAgICAgICAgICAgIFByaW1hcnlLZXkgcGsgPSBuZXcg\nUHJpbWFyeUtleSgpOwogICAgICAgICAgICAgICAgcGsuc2V0U2NoZW1hTmFt\nZShzY2hlbWFOYW1lKTsKICAgICAgICAgICAgICAgIHBrLnNldFRhYmxlTmFt\nZSh0YWJsZU5hbWUpOwogICAgICAgICAgICAgICAgcGsuc2V0Q29sdW1uTmFt\nZShwa3MuZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpKTsKICAgICAgICAgICAg\nICAgIHBrTGlzdC5hZGQocGspOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiAoUHJpbWFyeUtleVtdKSBwa0xpc3QudG9BcnJheQogICAgICAg\nICAgICAgICAgKG5ldyBQcmltYXJ5S2V5W3BrTGlzdC5zaXplKCldKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocGtzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHBr\ncy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBpbmRl\neGVzIG1hdGNoaW5nIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgogICAgICov\nCiAgICBwdWJsaWMgSW5kZXhbXSBnZXRJbmRleEluZm8oRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2No\nZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgYm9vbGVhbiB1bmlxdWUsCiAg\nICAgICAgYm9vbGVhbiBhcHByb3gsIENvbm5lY3Rpb24gY29ubikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFibGVOYW1l\nID09IG51bGwgJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0SW5kZXhJbmZv\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0\nYWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0U2V0IGluZGV4\nZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGluZGV4ZXMg\nPSBtZXRhLmdldEluZGV4SW5mbyhnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRh\nKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgZ2V0U2NoZW1hTmFtZUZvck1l\ndGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0VGFibGVO\nYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSwgdW5pcXVlLCBhcHByb3gpOwoK\nICAgICAgICAgICAgTGlzdCBpbmRleExpc3QgPSBuZXcgQXJyYXlMaXN0KCk7\nCiAgICAgICAgICAgIHdoaWxlIChpbmRleGVzICE9IG51bGwgJiYgaW5kZXhl\ncy5uZXh0KCkpCiAgICAgICAgICAgICAgICBpbmRleExpc3QuYWRkKG5ld0lu\nZGV4KGluZGV4ZXMpKTsKICAgICAgICAgICAgcmV0dXJuIChJbmRleFtdKSBp\nbmRleExpc3QudG9BcnJheShuZXcgSW5kZXhbaW5kZXhMaXN0LnNpemUoKV0p\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChpbmRleGVz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIGluZGV4ZXMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGluZGV4IGZy\nb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBJbmRleCBuZXdJbmRleChSZXN1bHRTZXQg\naWR4TWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBJbmRleCBpZHggPSBuZXcgSW5kZXgoKTsKICAgICAgICBpZHguc2V0U2No\nZW1hTmFtZShpZHhNZXRhLmdldFN0cmluZygiVEFCTEVfU0NIRU0iKSk7CiAg\nICAgICAgaWR4LnNldFRhYmxlTmFtZShpZHhNZXRhLmdldFN0cmluZygiVEFC\nTEVfTkFNRSIpKTsKICAgICAgICBpZHguc2V0Q29sdW1uTmFtZShpZHhNZXRh\nLmdldFN0cmluZygiQ09MVU1OX05BTUUiKSk7CiAgICAgICAgaWR4LnNldE5h\nbWUoaWR4TWV0YS5nZXRTdHJpbmcoIklOREVYX05BTUUiKSk7CiAgICAgICAg\naWR4LnNldFVuaXF1ZSghaWR4TWV0YS5nZXRCb29sZWFuKCJOT05fVU5JUVVF\nIikpOwogICAgICAgIHJldHVybiBpZHg7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gcmV0dXJuIGZvcmVpZ24ga2V5\ncyBpbXBvcnRlZCBieSB0aGUgZ2l2ZW4KICAgICAqIHRhYmxlIHBhdHRlcm4u\nCiAgICAgKi8KICAgIHB1YmxpYyBGb3JlaWduS2V5W10gZ2V0SW1wb3J0ZWRL\nZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAg\nICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIENv\nbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVsbCAm\nJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbXBvcnRlZEtleXMpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9w\nZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQga2V5cyA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAga2V5cyA9IG1ldGEuZ2V0SW1w\nb3J0ZWRLZXlzKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyks\nCiAgICAgICAgICAgICAgICBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2No\nZW1hTmFtZSksCiAgICAgICAgICAgICAgICBnZXRUYWJsZU5hbWVGb3JNZXRh\nZGF0YSh0YWJsZU5hbWUpKTsKCiAgICAgICAgICAgIExpc3QgaW1wb3J0ZWRL\nZXlMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGlsZSAo\na2V5cyAhPSBudWxsICYmIGtleXMubmV4dCgpKQogICAgICAgICAgICAgICAg\naW1wb3J0ZWRLZXlMaXN0LmFkZChuZXdGb3JlaWduS2V5KGtleXMpKTsKICAg\nICAgICAgICAgcmV0dXJuIChGb3JlaWduS2V5W10pIGltcG9ydGVkS2V5TGlz\ndC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IEZvcmVpZ25LZXlbaW1w\nb3J0ZWRLZXlMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGlmIChrZXlzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGtleXMuY2xvc2UoKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IGZvcmVpZ24ga2V5IGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRo\nZSBzY2hlbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGb3Jl\naWduS2V5IG5ld0ZvcmVpZ25LZXkoUmVzdWx0U2V0IGZrTWV0YSkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBGb3JlaWduS2V5IGZr\nID0gbmV3IEZvcmVpZ25LZXkoKTsKICAgICAgICBmay5zZXRTY2hlbWFOYW1l\nKGZrTWV0YS5nZXRTdHJpbmcoIkZLVEFCTEVfU0NIRU0iKSk7CiAgICAgICAg\nZmsuc2V0VGFibGVOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIkZLVEFCTEVfTkFN\nRSIpKTsKICAgICAgICBmay5zZXRDb2x1bW5OYW1lKGZrTWV0YS5nZXRTdHJp\nbmcoIkZLQ09MVU1OX05BTUUiKSk7CiAgICAgICAgZmsuc2V0TmFtZShma01l\ndGEuZ2V0U3RyaW5nKCJGS19OQU1FIikpOwogICAgICAgIGZrLnNldFByaW1h\ncnlLZXlTY2hlbWFOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBLVEFCTEVfU0NI\nRU0iKSk7CiAgICAgICAgZmsuc2V0UHJpbWFyeUtleVRhYmxlTmFtZShma01l\ndGEuZ2V0U3RyaW5nKCJQS1RBQkxFX05BTUUiKSk7CiAgICAgICAgZmsuc2V0\nUHJpbWFyeUtleUNvbHVtbk5hbWUoZmtNZXRhLmdldFN0cmluZygiUEtDT0xV\nTU5fTkFNRSIpKTsKICAgICAgICBmay5zZXRLZXlTZXF1ZW5jZShma01ldGEu\nZ2V0U2hvcnQoIktFWV9TRVEiKSk7CiAgICAgICAgZmsuc2V0RGVmZXJyZWQo\nZmtNZXRhLmdldFNob3J0KCJERUZFUlJBQklMSVRZIikKICAgICAgICAgICAg\nPT0gRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleUluaXRpYWxseURlZmVy\ncmVkKTsKCiAgICAgICAgaW50IGRlbCA9IGZrTWV0YS5nZXRTaG9ydCgiREVM\nRVRFX1JVTEUiKTsKICAgICAgICBzd2l0Y2ggKGRlbCkgewogICAgICAgICAg\nICBjYXNlIERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlTZXROdWxsOgog\nICAgICAgICAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXku\nQUNUSU9OX05VTEwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleVNldERlZmF1\nbHQ6CiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWln\nbktleS5BQ1RJT05fREVGQVVMVCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBEYXRhYmFzZU1ldGFEYXRhLmltcG9ydGVkS2V5\nQ2FzY2FkZToKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihG\nb3JlaWduS2V5LkFDVElPTl9DQVNDQURFKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZmsu\nc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gZms7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB0YWJs\nZSBuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBvYnRhaW5pbmcgaW5mb3Jt\nYXRpb24KICAgICAqIGZyb20ge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFRhYmxlTmFtZUZvck1l\ndGFkYXRhKFN0cmluZyB0YWJsZU5hbWUpIHsKICAgICAgICByZXR1cm4gY29u\ndmVydFNjaGVtYUNhc2UodGFibGVOYW1lKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybnMgdGhlIHNjaGVtYSBuYW1lIHRoYXQgd2lsbCBiZSB1c2Vk\nIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0BsaW5r\nIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShTdHJpbmcgc2NoZW1hTmFt\nZSkgewogICAgICAgIGlmIChzY2hlbWFOYW1lID09IG51bGwpCiAgICAgICAg\nICAgIHNjaGVtYU5hbWUgPSBjb25mLmdldFNjaGVtYSgpOwogICAgICAgIHJl\ndHVybiBjb252ZXJ0U2NoZW1hQ2FzZShzY2hlbWFOYW1lKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIGNhdGFsb2cgbmFtZSB0aGF0IHdp\nbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBm\ncm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFN0cmluZyBnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKFN0cmlu\nZyBjYXRhbG9nTmFtZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1h\nQ2FzZShjYXRhbG9nTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRoZSBjb2x1bW4gbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0\nYWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFz\nZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRD\nb2x1bW5OYW1lRm9yTWV0YWRhdGEoU3RyaW5nIGNvbHVtbk5hbWUpIHsKICAg\nICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoY29sdW1uTmFtZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgc2No\nZW1hIG5hbWUgdG8gYSBuYW1lIHRoYXQgdGhlIGRhdGFiYXNlIHdpbGwKICAg\nICAqIGJlIGFibGUgdG8gdW5kZXJzdGFuZC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFN0cmluZyBjb252ZXJ0U2NoZW1hQ2FzZShTdHJpbmcgb2JqZWN0TmFt\nZSkgewogICAgICAgIGlmIChvYmplY3ROYW1lID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgc2Nhc2UgPSBnZXRT\nY2hlbWFDYXNlKCk7CiAgICAgICAgaWYgKFNDSEVNQV9DQVNFX0xPV0VSLmVx\ndWFscyhzY2FzZSkpCiAgICAgICAgICAgIHJldHVybiBvYmplY3ROYW1lLnRv\nTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKFNDSEVNQV9DQVNFX1BSRVNFUlZF\nLmVxdWFscyhzY2FzZSkpCiAgICAgICAgICAgIHJldHVybiBvYmplY3ROYW1l\nOwogICAgICAgIHJldHVybiBvYmplY3ROYW1lLnRvVXBwZXJDYXNlKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gREIgc3BlY2lmaWMgc2NoZW1h\nQ2FzZSAKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTY2hlbWFDYXNl\nKCl7CiAgICAgICAgcmV0dXJuIHNjaGVtYUNhc2U7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogUHJlcGFyZWQgdGhlIGNvbm5lY3Rpb24gZm9yIG1ldGFk\nYXRhIG9wZXJhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZv\ncmVNZXRhZGF0YU9wZXJhdGlvbihDb25uZWN0aW9uIGMpIHsKICAgICAgICBp\nZiAocmVxdWlyZXNBdXRvQ29tbWl0Rm9yTWV0YURhdGEpIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGMucm9sbGJhY2soKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUpIHsKICAgICAgICAg\nICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFj\nLmdldEF1dG9Db21taXQoKSkKICAgICAgICAgICAgICAgICAgICBjLnNldEF1\ndG9Db21taXQodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzcWxlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFNlcXVl\nbmNlcyBhbmQgQXV0by1Bc3NpZ24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxhc3QgZ2Vu\nZXJhdGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICogVGhy\nb3dzIGFuIGV4Y2VwdGlvbiBieSBkZWZhdWx0IGlmIHtAbGluayAjbGFzdEdl\nbmVyYXRlZEtleVF1ZXJ5fSBpcyBudWxsLgogICAgICovCiAgICBwdWJsaWMg\nT2JqZWN0IGdldEdlbmVyYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9u\nIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGxhc3RHZW5lcmF0ZWRLZXlRdWVyeSA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWF1dG8t\nYXNzaWduIikpOwoKICAgICAgICAvLyByZXBsYWNlIHRoaW5ncyBsaWtlICJT\nRUxFQ1QgTUFYKHswfSkgRlJPTSB7MX0iCiAgICAgICAgU3RyaW5nIHF1ZXJ5\nID0gbGFzdEdlbmVyYXRlZEtleVF1ZXJ5OwogICAgICAgIGlmIChxdWVyeS5p\nbmRleE9mKCd7JykgIT0gLTEpIC8vIG9ubHkgaWYgdGhlIHRva2VuIGlzIGlu\nIHRoZSBzdHJpbmcKICAgICAgICB7CiAgICAgICAgICAgIHF1ZXJ5ID0gTWVz\nc2FnZUZvcm1hdC5mb3JtYXQocXVlcnksIG5ldyBPYmplY3RbXXsKICAgICAg\nICAgICAgICAgIGNvbC5nZXROYW1lKCksIGdldEZ1bGxOYW1lKGNvbC5nZXRU\nYWJsZSgpLCBmYWxzZSksCiAgICAgICAgICAgICAgICBnZXRHZW5lcmF0ZWRL\nZXlTZXF1ZW5jZU5hbWUoY29sKSwKICAgICAgICAgICAgfSk7CiAgICAgICAg\nfQoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJl\ncGFyZVN0YXRlbWVudChxdWVyeSk7CiAgICAgICAgUmVzdWx0U2V0IHJzID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBycyA9IHN0bW50LmV4\nZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBpZiAoIXJzLm5leHQoKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tZ2Vua2V5IikpOwogICAgICAgICAgICBPYmplY3Qga2V5ID0gcnMu\nZ2V0T2JqZWN0KDEpOwogICAgICAgICAgICBpZiAoa2V5ID09IG51bGwpCiAg\nICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiaW52YWxpZC1nZW5r\nZXkiLCBjb2wpKTsKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkge30KICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fSAKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNlcXVlbmNlIG5hbWUgdXNl\nZCBieSBkYXRhYmFzZXMgZm9yIHRoZSBnaXZlbiBhdXRvYXNzaWduZWQKICAg\nICAqIGNvbHVtbi4gVGhpcyBpcyBvbmx5IHVzZWQgYnkgZGF0YWJhc2VzIHRo\nYXQgcmVxdWlyZSBhbiBleHBsaWNpdCBuYW1lCiAgICAgKiB0byBiZSB1c2Vk\nIGZvciBhdXRvLWFzc2lnbiBzdXBwb3J0LgogICAgICovCiAgICBwcm90ZWN0\nZWQgU3RyaW5nIGdldEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShDb2x1bW4g\nY29sKSB7CiAgICAgICAgU3RyaW5nIHRuYW1lID0gY29sLmdldFRhYmxlTmFt\nZSgpOwogICAgICAgIFN0cmluZyBjbmFtZSA9IGNvbC5nZXROYW1lKCk7CiAg\nICAgICAgaW50IG1heCA9IG1heEF1dG9Bc3NpZ25OYW1lTGVuZ3RoOwogICAg\nICAgIGludCBleHRyYUNoYXJzID0gLW1heCArIHRuYW1lLmxlbmd0aCgpICsg\nMSAvLyA8dG5hbWU+ICsgJ18nCiAgICAgICAgICAgICsgY25hbWUubGVuZ3Ro\nKCkgKyA0OyAvLyA8Y25hbWU+ICsgJ19TRVEnCiAgICAgICAgaWYgKGV4dHJh\nQ2hhcnMgPiAwKSB7CiAgICAgICAgICAgIC8vIHRoaXMgYXNzdW1lcyB0aGF0\nIHRuYW1lIGlzIGxvbmdlciB0aGFuIGV4dHJhQ2hhcnMKICAgICAgICAgICAg\ndG5hbWUgPSB0bmFtZS5zdWJzdHJpbmcoMCwgdG5hbWUubGVuZ3RoKCkgLSBl\neHRyYUNoYXJzKTsKICAgICAgICB9CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIobWF4KTsKICAgICAgICBidWYuYXBwZW5k\nKHRuYW1lKS5hcHBlbmQoIl8iKS5hcHBlbmQoY25hbWUpLmFwcGVuZCgiX1NF\nUSIpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25m\naWd1cmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBzZXRDb25maWd1cmF0\naW9uKENvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIHRoaXMuY29uZiA9\nIChKREJDQ29uZmlndXJhdGlvbikgY29uZjsKICAgICAgICB0aGlzLmxvZyA9\nIHRoaXMuY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMp\nOwoKICAgICAgICAvLyB3YXJuIGFib3V0IHVuc3VwcG9ydGVkIGRpY3RzCiAg\nICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkgJiYgIWlzU3VwcG9ydGVk\nKCkpCiAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJkaWN0LW5vdC1z\ndXBwb3J0ZWQiLCBnZXRDbGFzcygpKSk7CiAgICB9CgogICAgcHJpdmF0ZSBi\nb29sZWFuIGlzU3VwcG9ydGVkKCkgewogICAgICAgIC8vIGlmIHRoaXMgaXMg\nYSBjdXN0b20gZGljdCwgdHJhdmVyc2UgdG8gd2hhdGV2ZXIgb3BlbmpwYSBk\naWN0IGl0IGV4dGVuZHMKICAgICAgICBDbGFzcyBjID0gZ2V0Q2xhc3MoKTsK\nICAgICAgICB3aGlsZSAoIWMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoIm9yZy5h\ncGFjaGUub3BlbmpwYS4iKSkKICAgICAgICAgICAgYyA9IGMuZ2V0U3VwZXJj\nbGFzcygpOwoKICAgICAgICAvLyB0aGUgZ2VuZXJpYyBkYmRpY3Rpb25hcnkg\naXMgbm90IGNvbnNpZGVyZWQgYSBzdXBwb3J0ZWQgZGljdDsgYWxsCiAgICAg\nICAgLy8gb3RoZXIgY29uY3JldGUgZGljdGlvbmFyaWVzIGFyZQogICAgICAg\nIGlmIChjID09IERCRGljdGlvbmFyeS5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAgIC8vIGlu\naXRpYWxpemUgdGhlIHNldCBvZiByZXNlcnZlZCBTUUw5MiB3b3JkcyBmcm9t\nIHJlc291cmNlCiAgICAgICAgSW5wdXRTdHJlYW0gaW4gPSBEQkRpY3Rpb25h\ncnkuY2xhc3MuZ2V0UmVzb3VyY2VBc1N0cmVhbQogICAgICAgICAgICAoInNx\nbC1rZXl3b3Jkcy5yc3JjIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nU3RyaW5nIGtleXdvcmRzID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5ldyBJbnB1\ndFN0cmVhbVJlYWRlcihpbikpLgogICAgICAgICAgICAgICAgcmVhZExpbmUo\nKTsKICAgICAgICAgICAgaW4uY2xvc2UoKTsKICAgICAgICAgICAgcmVzZXJ2\nZWRXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQK\nICAgICAgICAgICAgICAgIChrZXl3b3JkcywgIiwiLCAwKSkpOwogICAgICAg\nIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihpb2UpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHRyeSB7IGluLmNsb3NlKCk7IH0gY2F0Y2ggKElP\nRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgYWRk\naXRpb25hbCByZXNlcnZlZCB3b3JkcyBzZXQgYnkgdXNlcgogICAgICAgIGlm\nIChyZXNlcnZlZFdvcmRzICE9IG51bGwpCiAgICAgICAgICAgIHJlc2VydmVk\nV29yZFNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAg\nICAgICAgICAgICAgICAocmVzZXJ2ZWRXb3Jkcy50b1VwcGVyQ2FzZSgpLCAi\nLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBzeXN0ZW0gc2NoZW1hcyBzZXQg\nYnkgdXNlcgogICAgICAgIGlmIChzeXN0ZW1TY2hlbWFzICE9IG51bGwpCiAg\nICAgICAgICAgIHN5c3RlbVNjaGVtYVNldC5hZGRBbGwoQXJyYXlzLmFzTGlz\ndChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoc3lzdGVtU2NoZW1h\ncy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBz\neXN0ZW0gdGFibGVzIHNldCBieSB1c2VyCiAgICAgICAgaWYgKHN5c3RlbVRh\nYmxlcyAhPSBudWxsKQogICAgICAgICAgICBzeXN0ZW1UYWJsZVNldC5hZGRB\nbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAg\nICAoc3lzdGVtVGFibGVzLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKCiAg\nICAgICAgLy8gYWRkIGZpeGVkIHNpemUgdHlwZSBuYW1lcyBzZXQgYnkgdGhl\nIHVzZXIKICAgICAgICBpZiAoZml4ZWRTaXplVHlwZU5hbWVzICE9IG51bGwp\nCiAgICAgICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmFkZEFsbChBcnJh\neXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAgICAgICAgIChmaXhl\nZFNpemVUeXBlTmFtZXMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkpOwogICAg\nICAgIAogICAgICAgIC8vIGlmIHVzZXIgaGFzIHVuc2V0IHNlcXVlbmNlIHNx\nbCwgbnVsbCBpdCBvdXQgc28gd2Uga25vdyBzZXF1ZW5jZXMKICAgICAgICAv\nLyBhcmVuJ3Qgc3VwcG9ydGVkCiAgICAgICAgbmV4dFNlcXVlbmNlUXVlcnkg\nPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKG5leHRTZXF1ZW5jZVF1ZXJ5KTsK\nICAgICAgICAKICAgICAgICBpZiAoc2VsZWN0V29yZHMgIT0gbnVsbCkKICAg\nICAgICAgICAgc2VsZWN0V29yZFNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChT\ndHJpbmdzLnNwbGl0KHNlbGVjdFdvcmRzCiAgICAgICAgICAgICAgICAgICAg\nLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29ubmVj\ndGlvbkRlY29yYXRvciBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIERl\nY29yYXRlIHRoZSBnaXZlbiBjb25uZWN0aW9uIGlmIG5lZWRlZC4gU29tZSBk\nYXRhYmFzZXMgcmVxdWlyZSBzcGVjaWFsCiAgICAgKiBoYW5kbGluZyBmb3Ig\nSkRCQyBidWdzLiBUaGlzIGltcGxlbWVudGF0aW9uIGlzc3VlcyBhbnkKICAg\nICAqIHtAbGluayAjaW5pdGlhbGl6YXRpb25TUUx9IHRoYXQgaGFzIGJlZW4g\nc2V0IGZvciB0aGUgZGljdGlvbmFyeSBidXQKICAgICAqIGRvZXMgbm90IGRl\nY29yZWF0ZSB0aGUgY29ubmVjdGlvbi4KICAgICAqLwogICAgcHVibGljIENv\nbm5lY3Rpb24gZGVjb3JhdGUoQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghY29ubmVjdGVkKQog\nICAgICAgICAgICBjb25uZWN0ZWRDb25maWd1cmF0aW9uKGNvbm4pOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShpbml0aWFsaXphdGlvblNR\nTCkpIHsKICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBu\ndWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQg\nPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoaW5pdGlhbGl6YXRpb25TUUwpOwog\nICAgICAgICAgICAgICAgc3RtbnQuZXhlY3V0ZSgpOwogICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShlLnRvU3RyaW5nKCksIGUpOwogICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3Rt\nbnQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbm47CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUKICAgICAqIHtA\nbGluayBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvci5TUUxXYXJuaW5nSGFu\nZGxlcn0gaW50ZXJmYWNlCiAgICAgKiB0aGF0IGFsbG93cyBjdXN0b21pemF0\naW9uIG9mIHRoZSBhY3Rpb25zIHRvIHBlcmZvcm0gd2hlbiBhCiAgICAgKiB7\nQGxpbmsgU1FMV2FybmluZ30gb2NjdXJzIGF0IGFueSBwb2ludCBvbiBhIHtA\nbGluayBDb25uZWN0aW9ufSwKICAgICAqIHtAbGluayBTdGF0ZW1lbnR9LCBv\nciB7QGxpbmsgUmVzdWx0U2V0fS4gVGhpcyBtZXRob2QgbWF5CiAgICAgKiBi\nZSB1c2VkIGRldGVybWluZSB0aG9zZSB3YXJuaW5ncyB0aGUgYXBwbGljYXRp\nb24gd2FudHMgdG8KICAgICAqIGNvbnNpZGVyIGNyaXRpY2FsIGZhaWx1cmVz\nLCBhbmQgdGhyb3cgdGhlIHdhcm5pbmcgaW4gdGhvc2UKICAgICAqIGNhc2Vz\nLiBCeSBkZWZhdWx0LCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuCiAgICAg\nKgogICAgICogQHNlZSBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvciNzZXRX\nYXJuaW5nQWN0aW9uCiAgICAgKiBAc2VlIExvZ2dpbmdDb25uZWN0aW9uRGVj\nb3JhdG9yI3NldFdhcm5pbmdIYW5kbGVyCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGhhbmRsZVdhcm5pbmcoU1FMV2FybmluZyB3YXJuaW5nKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEgbmV3IGV4Y2VwdGlvbiB0aGF0IHdyYXBzIDxjb2RlPmNhdXNl\nczwvY29kZT4uCiAgICAgKiBIb3dldmVyLCB0aGUgZGV0YWlscyBvZiBleGFj\ndGx5IHdoYXQgdHlwZSBvZiBleGNlcHRpb24gaXMgcmV0dXJuZWQgY2FuCiAg\nICAgKiBiZSBkZXRlcm1pbmVkIGJ5IHRoZSBpbXBsZW1lbnRhdGlvbi4gVGhp\ncyBtYXkgdGFrZSBpbnRvIGFjY291bnQKICAgICAqIERCLXNwZWNpZmljIGV4\nY2VwdGlvbiBpbmZvcm1hdGlvbiBpbiA8Y29kZT5jYXVzZXM8L2NvZGU+Lgog\nICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUV4Y2VwdGlvbiBuZXdTdG9yZUV4\nY2VwdGlvbihTdHJpbmcgbXNnLCBTUUxFeGNlcHRpb25bXSBjYXVzZXMsCiAg\nICAgICAgT2JqZWN0IGZhaWxlZCkgewogICAgICAgIGlmIChjYXVzZXMubGVu\nZ3RoID4gMCAmJiAiMjMwMDAiLmVxdWFscyhjYXVzZXNbMF0uZ2V0U1FMU3Rh\ndGUoKSkpCiAgICAgICAgICAgIHJldHVybiBuZXcgUmVmZXJlbnRpYWxJbnRl\nZ3JpdHlFeGNlcHRpb24obXNnKS4KICAgICAgICAgICAgICAgIHNldEZhaWxl\nZE9iamVjdChmYWlsZWQpLnNldE5lc3RlZFRocm93YWJsZXMoY2F1c2VzKTsK\nICAgICAgICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9uKG1zZykuc2V0RmFp\nbGVkT2JqZWN0KGZhaWxlZCkuCiAgICAgICAgICAgIHNldE5lc3RlZFRocm93\nYWJsZXMoY2F1c2VzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlcyB0\naGUgc3BlY2lmaWVkIHtAbGluayBEYXRhU291cmNlfSBhbmQgcmVsZWFzZXMg\nYW55CiAgICAgKiByZXNvdXJjZXMgYXNzb2NpYXRlZCB3aXRoIGl0LgogICAg\nICoKICAgICAqIEBwYXJhbSBkYXRhU291cmNlIHRoZSBEYXRhU291cmNlIHRv\nIGNsb3NlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3NlRGF0YVNvdXJj\nZShEYXRhU291cmNlIGRhdGFTb3VyY2UpIHsKICAgICAgICBEYXRhU291cmNl\nRmFjdG9yeS5jbG9zZURhdGFTb3VyY2UoZGF0YVNvdXJjZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBVc2VkIGJ5IHNvbWUgbWFwcGluZ3MgdG8gcmVwcmVz\nZW50IGRhdGEgdGhhdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAgKiBzZXJpYWxp\nemVkIHNvIHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byBzZXJpYWxpemUgbXVsdGlw\nbGUgdGltZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU2Vy\naWFsaXplZERhdGEgewoKICAgICAgICBwdWJsaWMgZmluYWwgYnl0ZVtdIGJ5\ndGVzOwoKICAgICAgICBwdWJsaWMgU2VyaWFsaXplZERhdGEoYnl0ZVtdIGJ5\ndGVzKSB7CiAgICAgICAgICAgIHRoaXMuYnl0ZXMgPSBieXRlczsKICAgICAg\nICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHZlcnNpb24g\nY29sdW1uIG5hbWUKICAgICAqIEBwYXJhbSBjb2x1bW4KICAgICAqIEBwYXJh\nbSB0YWJsZUFsaWFzIDogdGhpcyBpcyBuZWVkZWQgZm9yIHBsYXRmb3JtIHNw\nZWNpZmljIHZlcnNpb24gY29sdW1uCiAgICAgKiBAcmV0dXJuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmVyc2lvbkNvbHVtbihDb2x1bW4gY29s\ndW1uLCBTdHJpbmcgdGFibGVBbGlhcykgewogICAgICAgIHJldHVybiBjb2x1\nbW4udG9TdHJpbmcoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBdHRh\nY2ggQ0FTVCB0byB0aGUgY3VycmVudCBmdW5jdGlvbiBpZiBuZWNlc3NhcnkK\nICAgICAqIAogICAgICogQHBhcmFtIHZhbCBvcGVyYW5kIHZhbHVlCiAgICAg\nKiBAcGFybWEgZnVuYyB0aGUgc3FsIGZ1bmN0aW9uIHN0YXRlbWVudAogICAg\nICogQHJldHVybiBhIFN0cmluZyB3aXRoIHRoZSBjb3JyZWN0IENBU1QgZnVu\nY3Rpb24gc3ludGF4CiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2Fz\ndEZ1bmN0aW9uKFZhbCB2YWwsIFN0cmluZyBmdW5jKSB7CiAgICAgICAgcmV0\ndXJuIGZ1bmM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlIGFu\nIGluZGV4IGlmIG5lY2Vzc2FyeSBmb3Igc29tZSBkYXRhYmFzZSB0YWJsZXMK\nICAgICAqLwogICAgcHVibGljIHZvaWQgY3JlYXRlSW5kZXhJZk5lY2Vzc2Fy\neShTY2hlbWEgc2NoZW1hLCBTdHJpbmcgdGFibGUsCiAgICAgICAgICAgIENv\nbHVtbiBwa0NvbHVtbikgewogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJt\naW5lIHdoZXRoZXIgdGhlIHByb3ZpZGVkIDxjb2RlPnNxbDwvY29kZT4gbWF5\nIGJlIHRyZWF0ZWQgYXMgYSAKICAgICAqIHNlbGVjdCBzdGF0ZW1lbnQgb24g\ndGhpcyBkYXRhYmFzZS4KICAgICAqICAKICAgICAqIEBwYXJhbSBzcWwgICBB\nIHNxbCBzdGF0ZW1lbnQuIAogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUg\naWYgPGNvZGU+c3FsPC9jb2RlPiByZXByZXNlbnRzIGEgc2VsZWN0IHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNTZWxlY3QoU3Ry\naW5nIHNxbCkgewogICAgICAgIEl0ZXJhdG9yIGkgPSBzZWxlY3RXb3JkU2V0\nLml0ZXJhdG9yKCk7CiAgICAgICAgU3RyaW5nIGN1cjsKICAgICAgICB3aGls\nZSAoaS5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgY3VyID0gKFN0cmluZykg\naS5uZXh0KCk7CiAgICAgICAgICAgIGlmIChzcWwubGVuZ3RoKCkgPj0gY3Vy\nLmxlbmd0aCgpCiAgICAgICAgICAgICAgICAgICAgJiYgc3FsLnN1YnN0cmlu\nZygwLCBjdXIubGVuZ3RoKCkpLmVxdWFsc0lnbm9yZUNhc2UoY3VyKSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9Cg==\n","encoding":"base64"}

