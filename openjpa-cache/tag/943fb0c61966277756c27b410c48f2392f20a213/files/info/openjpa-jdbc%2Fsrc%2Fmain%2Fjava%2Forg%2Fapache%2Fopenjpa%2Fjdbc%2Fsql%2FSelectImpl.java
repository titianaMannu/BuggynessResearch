{"sha":"984f291f4a1f5845d0d73b800daefde6d91912fb","node_id":"MDQ6QmxvYjIwNjM2NDo5ODRmMjkxZjRhMWY1ODQ1ZDBkNzNiODAwZGFlZmRlNmQ5MTkxMmZi","size":96445,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/984f291f4a1f5845d0d73b800daefde6d91912fb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5pdGVyYXRvcnMuRW1wdHlJ\ndGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDTG9j\na01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLkpEQkNTdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2luYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogU3RhbmRhcmQge0BsaW5r\nIFNlbGVjdH0gaW1wbGVtZW50YXRpb24uIFVzYWdlIG5vdGU6IHRob3VnaCB0\naGlzIGNsYXNzCiAqIGltcGxlbWVudHMge0BsaW5rIEpvaW5zfSwgaXQgc2hv\ndWxkIG5vdCBiZSB1c2VkIGZvciBqb2luaW5nIGRpcmVjdGx5LgogKiBJbnN0\nZWFkLCB1c2UgdGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgI25ld0pvaW5z\nfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFNlbGVjdEltcGwKICAgIGltcGxlbWVudHMgU2VsZWN0\nLCBQYXRoSm9pbnMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBO\nT05BVVRPX0RJU1RJTkNUID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IERJU1RJTkNUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE5PVF9ESVNUSU5DVCA9IDIgPDwgMjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBJTVBMSUNJVF9ESVNUSU5DVCA9IDIgPDwg\nMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT19NQU5ZID0gMiA8\nPCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFHR1JFR0FURSA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMT0IgPSAy\nIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1VURVIgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTFJTID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX09O\nRSA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBFQUdF\nUl9UT19NQU5ZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBSRUNPUkRfT1JERVJFRCA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgR1JPVVBJTkcgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZPUkNFX0NPVU5UID0gMiA8PCAxMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBUQUJMRV9BTElBU0VT\nID0gbmV3IFN0cmluZ1sxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndHJpbmdbXSBPUkRFUl9BTElBU0VTID0gbmV3IFN0cmluZ1sxNl07CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBOVUxMX0lEUyA9IG5ldyBP\nYmplY3RbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nUExBQ0VIT0xERVJTID0gbmV3IE9iamVjdFs1MF07CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShTZWxlY3QuY2xhc3MpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBUQUJMRV9BTElBU0VTLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBUQUJMRV9BTElBU0VTW2ldID0gInQiICsgaTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IE9SREVSX0FMSUFTRVMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE9SREVSX0FMSUFTRVNbaV0gPSAibyIgKyBpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTlVMTF9JRFMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE5VTExfSURTW2ldID0gbmV3IE51bGxJZCgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUExBQ0VIT0xERVJTLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBQTEFDRUhPTERFUlNbaV0gPSBuZXcgUGxh\nY2Vob2xkZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEpEQkNDb25m\naWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25h\ncnkgX2RpY3Q7CgogICAgLy8gbWFwIG9mIHZhcmlhYmxlICsgcmVsYXRpb24g\ncGF0aCArIHRhYmxlIGtleXMgdG8gdGhlIGNvcnJlY3QgYWxpYXMgaW5kZXg6\nCiAgICAvLyBlYWNoIHJlbGF0aW9uIHBhdGgvdGFibGUgY29tYmluYXRpb24g\nc2hvdWxkIGhhdmUgYSB1bmlxdWUgYWxpYXMgYmVjYXVzZQogICAgLy8gaXQg\ncmVwcmVzZW50cyBhIHNlcGFyYXRlIG9iamVjdDsgZm9yIGV4YW1wbGUsIGlm\nIGEgUGVyc29uIGNsYXNzIGhhcyBhCiAgICAvLyAncGFyZW50JyBmaWVsZCBy\nZXByZXNlbnRpbmcgYW5vdGhlciBQZXJzb24gYW5kIGFsc28gaGFzIGFuICdh\nZGRyZXNzJwogICAgLy8gZmllbGQgb2YgdHlwZSBBZGRyZXNzOgogICAgLy8g\nJ2FkZHJlc3Muc3RyZWV0JyBzaG91bGQgbWFwIHRvIGEgZGlmZmVyZW50IHRh\nYmxlIGFsaWFzIHRoYW4KICAgIC8vICdwYXJlbnQuYWRkcmVzcy5zdHJlZXQn\nIGZvciB0aGUgcHVycG9zZXMgb2YgY29tcGFyaXNvbnMKICAgIHByaXZhdGUg\nTWFwIF9hbGlhc2VzID0gbnVsbDsKCiAgICAvLyB0byBjYWNoZSB0YWJsZSBh\nbGlhcyB1c2luZyBUYWJsZSBhcyB0aGUga2V5CiAgICBwcml2YXRlIE1hcCBf\ndGFibGVBbGlhc2VzID0gbnVsbDsKCiAgICAvLyBtYXAgb2YgaW5kZXhlcyB0\nbyB0YWJsZSBhbGlhc2VzIGxpa2UgJ1RBQkxFTkFNRSB0MCcKICAgIHByaXZh\ndGUgU29ydGVkTWFwIF90YWJsZXMgPSBudWxsOwoKICAgIC8vIGNvbWJpbmVk\nIGxpc3Qgb2Ygc2VsZWN0ZWQgaWRzIGFuZCBtYXAgb2YgZWFjaCBpZCB0byBp\ndHMgYWxpYXMKICAgIHByb3RlY3RlZCBmaW5hbCBTZWxlY3RzIF9zZWxlY3Rz\nID0gbmV3U2VsZWN0cygpOwogICAgcHJpdmF0ZSBMaXN0IF9vcmRlcmVkID0g\nbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfZ3JvdXBlZCA9IG51bGw7CgogICAg\nLy8gZmxhZ3MKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2\nYXRlIGludCBfam9pblN5bnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5N\nQVhfVkFMVUU7CiAgICBwcml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBw\ncml2YXRlIGludCBfb3JkZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFj\nZWhvbGRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0\nQ291bnQgPSAwOwoKICAgIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vcmRlcmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBfd2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dy\nb3VwaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcg\nPSBudWxsOwoKICAgIC8vIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91\nciB3aGVyZSBjbGF1c2UsIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAv\nLyBhbGwgc2VsZWN0cyAoc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhv\nZCkKICAgIHByaXZhdGUgU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAg\nb2Ygam9pbnMra2V5cyB0byBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0\nIG9mIGVhZ2VyIGtleXM7IHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUg\ndXNlZCBtb3JlIHRoYW4gb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAg\nIC8vIHN1YnNlbGVjdCBzdXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAg\nIC8vIGZyb20gc2VsZWN0IGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBh\nIHRtcCB0YWJsZSBjcmVhdGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2Vs\nZWN0SW1wbCBfZnJvbSA9IG51bGw7CiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1w\nbCBfb3V0ZXIgPSBudWxsOwogICAgCiAgICAvLyBiaXRTZXQgaW5kaWNhdGlu\nZyBpZiBhbiBhbGlhcyBpcyByZW1vdmVkIGZyb20gcGFyZW50IHNlbGVjdAog\nICAgLy8gYml0IDAgOiBjb3JyZXNwb25kIHRvIGFsaWFzIDAKICAgIC8vIGJp\ndCAxIDogY29ycmVzcG9uZCB0byBhbGlhcyAxLCBldGMuCiAgICAvLyBpZiB0\naGUgYml0IGlzIHNldCwgdGhlIGNvcnJlc3BvbmRpbmcgYWxpYXMgaGFzIGJl\nZW4gcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgLy8gYW5kIHJlY29yZGVkIHVu\nZGVyIHN1YnNlbGVjdC4KICAgIHByaXZhdGUgQml0U2V0IF9yZW1vdmVkQWxp\nYXNGcm9tUGFyZW50ID0gbmV3IEJpdFNldCgxNik7CiAgICAgCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgdGFi\nbGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBhbGlhcyBpbmRleC4KICAgICAqLwog\nICAgc3RhdGljIFN0cmluZyB0b0FsaWFzKGludCBpbmRleCkgewogICAgICAg\nIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKGluZGV4IDwgVEFCTEVfQUxJQVNFUy5sZW5ndGgpCiAgICAg\nICAgICAgIHJldHVybiBUQUJMRV9BTElBU0VTW2luZGV4XTsKICAgICAgICBy\nZXR1cm4gInQiICsgaW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHJldHVybiB0aGUgcHJvcGVyIG9yZGVyIGFsaWFzIGZv\nciB0aGUgZ2l2ZW4gb3JkZXIKICAgICAqIGNvbHVtbiBpbmRleC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgdG9PcmRlckFsaWFzKGludCBp\nbmRleCkgewogICAgICAgIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGluZGV4IDwgT1JERVJfQUxJQVNF\nUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBPUkRFUl9BTElBU0VTW2lu\nZGV4XTsKICAgICAgICByZXR1cm4gIm8iICsgaW5kZXg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyBTZWxlY3RJbXBsKEpEQkNDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2Rp\nY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAg\nIF9qb2luU3ludGF4ID0gX2RpY3Quam9pblN5bnRheDsKICAgICAgICBfc2Vs\nZWN0cy5fZGljdCA9IF9kaWN0OwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0RXhlY3V0b3IgaW1w\nbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KGJvb2xlYW4gZm9yVXBkYXRlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJu\nIF9kaWN0LnRvU2VsZWN0KHRoaXMsIGZvclVwZGF0ZSwgZmV0Y2gpOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3RDb3VudCgpIHsKICAg\nICAgICByZXR1cm4gX2RpY3QudG9TZWxlY3RDb3VudCh0aGlzKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBdXRvRGlzdGluY3QoKSB7CiAgICAg\nICAgcmV0dXJuIChfZmxhZ3MgJiBOT05BVVRPX0RJU1RJTkNUKSA9PSAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EaXN0aW5jdChib29sZWFu\nIHZhbCkgewogICAgICAgIGlmICh2YWwpCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9mbGFncyB8PSBOT05BVVRPX0RJU1RJTkNUOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzRGlzdGluY3QoKSB7CiAgICAgICAgcmV0dXJuIChfZmxh\nZ3MgJiBOT1RfRElTVElOQ1QpID09IDAgJiYgKChfZmxhZ3MgJiBESVNUSU5D\nVCkgIT0gMAogICAgICAgICAgICB8fCAoKF9mbGFncyAmIE5PTkFVVE9fRElT\nVElOQ1QpID09IDAKICAgICAgICAgICAgJiYgKF9mbGFncyAmIElNUExJQ0lU\nX0RJU1RJTkNUKSAhPSAwKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRGlzdGluY3QoYm9vbGVhbiBkaXN0aW5jdCkgewogICAgICAgIC8vIG5lZWQg\ndHdvIGZsYWdzIGluIGNhc2Ugc2V0IG5vdF9kaXN0aW5jdCwgdGhlbiBhIHRv\nLW1hbnkgam9pbiBoYXBwZW5zCiAgICAgICAgLy8gYW5kIGRpc3RpbmN0IGZs\nYWcgZ2V0cyBzZXQgYXV0b21hdGljYWxseQogICAgICAgIGlmIChkaXN0aW5j\ndCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+Tk9UX0RJU1RJTkNUOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIF9mbGFncyB8PSBOT1RfRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RElTVElOQ1Q7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzTFJTKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgTFJTKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExS\nUyhib29sZWFuIGxycykgewogICAgICAgIGlmIChscnMpCiAgICAgICAgICAg\nIF9mbGFncyB8PSBMUlM7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkxSUzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEV4cGVjdGVk\nUmVzdWx0Q291bnQoKSB7CiAgICAgICAgLy8gaWYgdGhlIGNvdW50IGlzbid0\nIGZvcmNlZCBhbmQgd2UgaGF2ZSB0by1tYW55IGVhZ2VyIGpvaW5zIHRoYXQg\nY291bGQKICAgICAgICAvLyB0aHJvdyB0aGUgY291bnQgb2ZmLCBkb24ndCBw\nYXkgYXR0ZW50aW9uIHRvIGl0CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGT1JD\nRV9DT1VOVCkgPT0gMCAmJiBoYXNFYWdlckpvaW4odHJ1ZSkpCiAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiBfZXhwZWN0ZWRSZXN1bHRD\nb3VudDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFeHBlY3RlZFJlc3Vs\ndENvdW50KGludCBleHBlY3RlZFJlc3VsdENvdW50LCBib29sZWFuIGZvcmNl\nKSB7CiAgICAgICAgX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBleHBlY3RlZFJl\nc3VsdENvdW50OwogICAgICAgIGlmIChmb3JjZSkKICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZPUkNFX0NPVU5UOwogICAgICAgIGVsc2UgCiAgICAgICAgICAg\nIF9mbGFncyAmPSB+Rk9SQ0VfQ09VTlQ7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRKb2luU3ludGF4KCkgewogICAgICAgIHJldHVybiBfam9pblN5bnRh\neDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luU3ludGF4KGludCBq\nb2luU3ludGF4KSB7CiAgICAgICAgX2pvaW5TeW50YXggPSBqb2luU3ludGF4\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNj\nZXNzKGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0\nLnN1cHBvcnRzUmFuZG9tQWNjZXNzUmVzdWx0U2V0KHRoaXMsIGZvclVwZGF0\nZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5n\nKCkgewogICAgICAgIHJldHVybiBfZGljdC5zdXBwb3J0c0xvY2tpbmcodGhp\ncyk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb3VudChKREJDU3RvcmUg\nc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCA9IG51bGw7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBTUUxCdWZmZXIgc3FsID0g\ndG9TZWxlY3RDb3VudCgpOwogICAgICAgICAgICBjb25uID0gc3RvcmUuZ2V0\nQ29ubmVjdGlvbigpOwogICAgICAgICAgICBzdG1udCA9IHNxbC5wcmVwYXJl\nU3RhdGVtZW50KGNvbm4pOwogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1\ndGVRdWVyeSgpOwogICAgICAgICAgICBycy5uZXh0KCk7CiAgICAgICAgICAg\nIHJldHVybiBycy5nZXRJbnQoMSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\neyBycy5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAg\nICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7fQogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsgY29ubi5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQg\nZXhlY3V0ZShKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0gc3Rv\ncmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIGV4\nZWN1dGUoc3RvcmUuZ2V0Q29udGV4dCgpLCBzdG9yZSwgZmV0Y2gsCiAgICAg\nICAgICAgIGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSk7CiAgICB9CgogICAg\ncHVibGljIFJlc3VsdCBleGVjdXRlKEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgbG9ja0xldmVs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0\nb3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZldGNoLCBsb2NrTGV2ZWwpOwog\nICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0aGlzIHNlbGVjdCBpbiB0\naGUgY29udGV4dCBvZiB0aGUgZ2l2ZW4gc3RvcmUgbWFuYWdlci4gVGhlCiAg\nICAgKiBjb250ZXh0IGlzIHBhc3NlZCBpbiBzZXBhcmF0ZWx5IGZvciBwcm9m\naWxpbmcgcHVycG9zZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHQg\nZXhlY3V0ZShTdG9yZUNvbnRleHQgY3R4LCBKREJDU3RvcmUgc3RvcmUsIAog\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2Nr\nTGV2ZWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nYm9vbGVhbiBmb3JVcGRhdGUgPSBmYWxzZTsKICAgICAgICBpZiAoIWlzQWdn\ncmVnYXRlKCkgJiYgX2dyb3VwaW5nID09IG51bGwpIHsKICAgICAgICAgICAg\nSkRCQ0xvY2tNYW5hZ2VyIGxtID0gc3RvcmUuZ2V0TG9ja01hbmFnZXIoKTsK\nICAgICAgICAgICAgaWYgKGxtICE9IG51bGwpCiAgICAgICAgICAgICAgICBm\nb3JVcGRhdGUgPSBsbS5zZWxlY3RGb3JVcGRhdGUodGhpcywgbG9ja0xldmVs\nKTsKICAgICAgICB9CgogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSB0b1NlbGVj\ndChmb3JVcGRhdGUsIGZldGNoKTsKICAgICAgICBpbnQgcnNUeXBlID0gKGlz\nTFJTKCkgJiYgc3VwcG9ydHNSYW5kb21BY2Nlc3MoZm9yVXBkYXRlKSkKICAg\nICAgICAgICAgPyAtMSA6IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsK\nICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9u\nKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwog\nICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKGlzTFJTKCkpCiAgICAgICAgICAgICAgICBzdG1udCA9\nIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIGZldGNoLCByc1R5cGUsIC0x\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3RtbnQgPSBz\ncWwucHJlcGFyZVN0YXRlbWVudChjb25uLCByc1R5cGUsIC0xKTsKCiAgICAg\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBsb2NraW5nIHNlbGVjdCBhbmQgdGhl\nIGxvY2sgdGltZW91dCBpcyBncmVhdGVyIHRoYW4KICAgICAgICAgICAgLy8g\ndGhlIGNvbmZpZ3VyZWQgcXVlcnkgdGltZW91dCwgdXNlIHRoZSBsb2NrIHRp\nbWVvdXQKICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiBfZGljdC5zdXBw\nb3J0c1F1ZXJ5VGltZW91dCAmJiBmZXRjaCAhPSBudWxsIAogICAgICAgICAg\nICAgICAgJiYgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSA+IHN0bW50LmdldFF1\nZXJ5VGltZW91dCgpICogMTAwMCkgewogICAgICAgICAgICAgICAgaW50IHRp\nbWVvdXQgPSBmZXRjaC5nZXRMb2NrVGltZW91dCgpOwogICAgICAgICAgICAg\nICAgaWYgKHRpbWVvdXQgPCAxMDAwKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGltZW91dCA9IDEwMDA7IAogICAgICAgICAgICAgICAgICAgIExvZyBsb2cg\nPSBfY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgibWls\nbGlzLXF1ZXJ5LXRpbWVvdXQiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBzdG1udC5zZXRRdWVyeVRpbWVvdXQoZmV0Y2guZ2V0TG9j\na1RpbWVvdXQoKSAvIDEwMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIC8vIGNsZWFuIHVwIHN0\nYXRlbWVudAogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZTIpIHt9CiAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2Uo\nKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlMikge30KICAgICAgICAgICAg\ndGhyb3cgc2U7CiAgICAgICAgfQoKICAgICAgICBTZWxlY3RSZXN1bHQgcmVz\nID0gbmV3IFNlbGVjdFJlc3VsdChjb25uLCBzdG1udCwgcnMsIF9kaWN0KTsK\nICAgICAgICByZXMuc2V0U2VsZWN0KHRoaXMpOwogICAgICAgIHJlcy5zZXRT\ndG9yZShzdG9yZSk7CiAgICAgICAgcmVzLnNldExvY2tpbmcoZm9yVXBkYXRl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhZGRFYWdlclJlc3VsdHMo\ncmVzLCB0aGlzLCBzdG9yZSwgZmV0Y2gpOwogICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICByZXMuY2xvc2UoKTsKICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\nZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIG91ciBlYWdlciBz\nZWxlY3RzLCBhZGRpbmcgdGhlIHJlc3VsdHMgdW5kZXIgdGhlIHNhbWUga2V5\ncwogICAgICogdG8gdGhlIGdpdmVuIHJlc3VsdC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgdm9pZCBhZGRFYWdlclJlc3VsdHMoU2VsZWN0UmVzdWx0\nIHJlcywgU2VsZWN0SW1wbCBzZWwsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3Jl\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChzZWwuX2VhZ2VyID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZXhlY3V0ZSBl\nYWdlciBzZWxlY3RzCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAg\nIFJlc3VsdCBlcmVzOwogICAgICAgIE1hcCBlYWdlcjsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IHNlbC5fZWFnZXIuZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChN\nYXAuRW50cnkpIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAvLyBzaW11bGF0\nZWQgYmF0Y2hlZCBzZWxlY3RzIGZvciBpbm5lci9vdXRlciBqb2luczsgZm9y\nIHNlcGFyYXRlCiAgICAgICAgICAgIC8vIHNlbGVjdHMsIGRvbid0IHBhc3Mg\nb24gbG9jayBsZXZlbCwgYmVjYXVzZSB0aGV5J3JlIHByb2JhYmx5CiAgICAg\nICAgICAgIC8vIGZvciByZWxhdGlvbnMgYW5kIHRoZXJlZm9yZSBzaG91bGQg\ndXNlIGRlZmF1bHQgbGV2ZWwKICAgICAgICAgICAgaWYgKGVudHJ5LmdldFZh\nbHVlKCkgPT0gc2VsKQogICAgICAgICAgICAgICAgZXJlcyA9IHJlczsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZXJlcyA9ICgoU2VsZWN0\nRXhlY3V0b3IpIGVudHJ5LmdldFZhbHVlKCkpLmV4ZWN1dGUoc3RvcmUsCiAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gpOwoKICAgICAgICAgICAgZWFnZXIg\nPSByZXMuZ2V0RWFnZXJNYXAoZmFsc2UpOwogICAgICAgICAgICBpZiAoZWFn\nZXIgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZWFnZXIgPSBuZXcgSGFz\naE1hcCgpOwogICAgICAgICAgICAgICAgcmVzLnNldEVhZ2VyTWFwKGVhZ2Vy\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlYWdlci5wdXQoZW50cnku\nZ2V0S2V5KCksIGVyZXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3QgaW1wbGVtZW50YXRp\nb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMg\naW50IGluZGV4T2YoKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAg\ncHVibGljIExpc3QgZ2V0U3Vic2VsZWN0cygpIHsKICAgICAgICByZXR1cm4g\nKF9zdWJzZWxzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6\nIF9zdWJzZWxzOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3QgZ2V0UGFyZW50\nKCkgewogICAgICAgIHJldHVybiBfcGFyZW50OwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0U3Vic2VsZWN0UGF0aCgpIHsKICAgICAgICByZXR1cm4g\nX3N1YlBhdGg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UGFyZW50KFNl\nbGVjdCBwYXJlbnQsIFN0cmluZyBwYXRoKSB7CiAgICAgICAgaWYgKHBhdGgg\nIT0gbnVsbCkKICAgICAgICAgICAgX3N1YlBhdGggPSBwYXRoICsgJzonOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgX3N1YlBhdGggPSBudWxsOwoKICAg\nICAgICBpZiAocGFyZW50ID09IF9wYXJlbnQpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxsKQogICAgICAgICAgICBf\ncGFyZW50Ll9zdWJzZWxzLnJlbW92ZSh0aGlzKTsKCiAgICAgICAgLy8jIyMg\ncmlnaHQgbm93IHdlIGNhbid0IHVzZSBzcWw5MiBqb2lucyB3aXRoIHN1YnNl\nbGVjdHMsIGNhdXNlCiAgICAgICAgLy8jIyMgSSBjYW4ndCBmaWd1cmUgb3V0\nIHdoYXQgdG8gZG8gd2hlbiB0aGUgc3Vic2VsZWN0IGhhcyBhIGpvaW4KICAg\nICAgICAvLyMjIyB3aXRoIGFuIGFsaWFzIGFsc28gcHJlc2VudCBpbiB0aGUg\nb3V0ZXIgc2VsZWN0Li4uIHlvdSBkb24ndCB3YW50CiAgICAgICAgLy8jIyMg\ndGhlIGpvaW4gdG8gYXBwZWFyIGluIHRoZSBGUk9NIGNsYXVzZSBvZiB0aGUg\nc3Vic2VsZWN0IGNhdXNlCiAgICAgICAgLy8jIyMgdGhlbiBpdCByZS1hbGlh\nc2VzIGJvdGggdGFibGVzIGluIHRoZSBzY29wZSBvZiB0aGUgc3Vic2VsZWN0\nCiAgICAgICAgLy8jIyMgYW5kIHRoZSBjb3JyZWxhdGlvbiB3aXRoIHRoZSBv\ndXRlciBzZWxlY3QgaXMgbG9zdAogICAgICAgIF9wYXJlbnQgPSAoU2VsZWN0\nSW1wbCkgcGFyZW50OwogICAgICAgIGlmIChfcGFyZW50ICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKF9wYXJlbnQuX3N1YnNlbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9wYXJlbnQuX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0\nKDIpOwogICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzLmFkZCh0aGlzKTsK\nICAgICAgICAgICAgaWYgKF9wYXJlbnQuX2pvaW5TeW50YXggPT0gSm9pblN5\nbnRheGVzLlNZTlRBWF9TUUw5MikKICAgICAgICAgICAgICAgIF9qb2luU3lu\ndGF4ID0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTDsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2pvaW5TeW50YXggPSBfcGFy\nZW50Ll9qb2luU3ludGF4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBp\nZiAoX3BhcmVudC5nZXRBbGlhc2VzKCkgPT0gbnVsbCB8fCBfc3ViUGF0aCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgCiAgICAgICAg\nLy8gcmVzb2x2ZSBhbGlhc2VzIGZvciBzdWJzZWxlY3QgZnJvbSBwYXJlbnQK\nICAgICAgICBTZXQgZW50cmllcyA9IF9wYXJlbnQuZ2V0QWxpYXNlcygpLmVu\ndHJ5U2V0KCk7CiAgICAgICAgSXRlcmF0b3IgaXQgPSBlbnRyaWVzLml0ZXJh\ndG9yKCk7CiAgICAgICAgd2hpbGUgKGl0Lmhhc05leHQoKSkgewogICAgICAg\nIAlNYXAuRW50cnkgZW50cnkgPSAoTWFwLkVudHJ5KSBpdC5uZXh0KCk7CiAg\nICAgICAgICAgIE9iamVjdCBrZXkgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAg\nICAgICAgSW50ZWdlciBhbGlhcyA9IChJbnRlZ2VyKSBlbnRyeS5nZXRWYWx1\nZSgpOwogICAgICAgICAgICBpZiAoa2V5LnRvU3RyaW5nKCkuaW5kZXhPZihf\nc3ViUGF0aCkgIT0gLTEgfHwKICAgICAgICAgICAgICAgIF9wYXJlbnQuZmlu\nZFRhYmxlQWxpYXMoYWxpYXMpID09IGZhbHNlKSB7CiAgICAgICAgICAgICAg\nICBpZiAoX2FsaWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\nYWxpYXNlcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAgICBfYWxp\nYXNlcy5wdXQoa2V5LCBhbGlhcyk7CgogICAgICAgICAgICAgICAgT2JqZWN0\nIHRhYmxlU3RyaW5nID0gX3BhcmVudC5nZXRUYWJsZXMoKS5nZXQoYWxpYXMp\nOwogICAgICAgICAgICAgICAgaWYgKF90YWJsZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBfdGFibGVzID0gbmV3IFRyZWVNYXAoKTsKICAgICAg\nICAgICAgICAgIF90YWJsZXMucHV0KGFsaWFzLCB0YWJsZVN0cmluZyk7CiAg\nICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9yZW1vdmVkQWxpYXNG\ncm9tUGFyZW50LnNldChhbGlhcy5pbnRWYWx1ZSgpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoX2FsaWFzZXMgIT0g\nbnVsbCkgewogICAgICAgICAgICAvLyBhbGlhc2VzIG1vdmVkIGludG8gc3Vi\nc2VsZWN0IHNob3VsZCBiZSByZW1vdmVkIGZyb20gcGFyZW50CiAgICAgICAg\nICAgIGVudHJpZXMgPSBfYWxpYXNlcy5lbnRyeVNldCgpOwogICAgICAgICAg\nICBpdCA9IGVudHJpZXMuaXRlcmF0b3IoKTsKICAgICAgICAgICAgd2hpbGUg\nKGl0Lmhhc05leHQoKSkgewogICAgICAgICAgICAJTWFwLkVudHJ5IGVudHJ5\nID0gKE1hcC5FbnRyeSkgaXQubmV4dCgpOwogICAgICAgICAgICAgICAgT2Jq\nZWN0IGtleSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgSW50\nZWdlciBhbGlhcyA9IChJbnRlZ2VyKSBlbnRyeS5nZXRWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgaWYgKGtleS50b1N0cmluZygpLmluZGV4T2YoX3N1YlBh\ndGgpICE9IC0xIHx8CiAgICAgICAgICAgICAgICAgICAgX3BhcmVudC5maW5k\nVGFibGVBbGlhcyhhbGlhcykgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAg\nICAgICBfcGFyZW50LnJlbW92ZUFsaWFzKGtleSk7CgogICAgICAgICAgICAg\nICAgICAgIE9iamVjdCB0YWJsZVN0cmluZyA9IF9wYXJlbnQuZ2V0VGFibGVz\nKCkuZ2V0KGFsaWFzKTsKICAgICAgICAgICAgICAgICAgICBfcGFyZW50LnJl\nbW92ZVRhYmxlKGFsaWFzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSBib29sZWFu\nIGZpbmRUYWJsZUFsaWFzKEludGVnZXIgYWxpYXMpIHsKICAgICAgICAvLyBp\nZiBhbGlhcyBpcyBkZWZpbmVkIGFuZCByZWZlcmVuY2VkLCByZXR1cm4gdHJ1\nZS4KICAgICAgICBTdHJpbmcgdmFsdWUgPSAidCIgKyBhbGlhcy50b1N0cmlu\nZygpICsgIi4iOwogICAgICAgIGlmIChfdGFibGVBbGlhc2VzICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBfdGFibGVBbGlhc2VzLmNvbnRhaW5zVmFs\ndWUodmFsdWUpICYmCiAgICAgICAgICAgICAgIF90YWJsZXMuY29udGFpbnNL\nZXkoYWxpYXMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CiAgICAKICAgIHB1YmxpYyBNYXAgZ2V0QWxpYXNlcygpIHsK\nICAgICAgICByZXR1cm4gX2FsaWFzZXM7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIHJlbW92ZUFsaWFzKE9iamVjdCBrZXkpIHsKICAgICAgICBfYWxp\nYXNlcy5yZW1vdmUoa2V5KTsKICAgIH0KICAgIAogICAgcHVibGljIE1hcCBn\nZXRUYWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIF90YWJsZXM7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIHJlbW92ZVRhYmxlKE9iamVjdCBrZXkpIHsK\nICAgICAgICBfdGFibGVzLnJlbW92ZShrZXkpOwogICAgfQoKICAgIHB1Ymxp\nYyBTZWxlY3QgZ2V0RnJvbVNlbGVjdCgpIHsKICAgICAgICByZXR1cm4gX2Zy\nb207CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RnJvbVNlbGVjdChTZWxl\nY3Qgc2VsKSB7CiAgICAgICAgX2Zyb20gPSAoU2VsZWN0SW1wbCkgc2VsOwog\nICAgICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAgICAgICBfZnJvbS5f\nb3V0ZXIgPSB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0Vh\nZ2VySm9pbihib29sZWFuIHRvTWFueSkgewogICAgICAgIGlmICh0b01hbnkp\nCiAgICAgICAgICAgIHJldHVybiAoX2ZsYWdzICYgRUFHRVJfVE9fTUFOWSkg\nIT0gMDsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEVBR0VSX1RPX09ORSkg\nIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNKb2luKGJvb2xl\nYW4gdG9NYW55KSB7CiAgICAgICAgaWYgKHRvTWFueSkKICAgICAgICAgICAg\ncmV0dXJuIChfZmxhZ3MgJiBUT19NQU5ZKSAhPSAwOwogICAgICAgIHJldHVy\nbiBfdGFibGVzICE9IG51bGwgJiYgX3RhYmxlcy5zaXplKCkgPiAxOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU2VsZWN0ZWQoVGFibGUgdGFibGUp\nIHsKICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhudWxsLCBmYWxz\nZSk7CiAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBfZnJvbS5nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgZmFsc2UpICE9\nIC0xOwogICAgICAgIHJldHVybiBnZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwg\nZmFsc2UpICE9IC0xOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdl\ndFRhYmxlQWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gKF90YWJsZXMgPT0g\nbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgOiBfdGFibGVzLnZhbHVl\ncygpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFNlbGVjdEFsaWFzZXMo\nKSB7CiAgICAgICAgcmV0dXJuIF9zZWxlY3RzLmdldEFsaWFzZXMoZmFsc2Us\nIF9vdXRlciAhPSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRJ\nZGVudGlmaWVyQWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gX3NlbGVjdHMu\nZ2V0QWxpYXNlcyh0cnVlLCBfb3V0ZXIgIT0gbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIFNRTEJ1ZmZlciBnZXRPcmRlcmluZygpIHsKICAgICAgICByZXR1\ncm4gX29yZGVyaW5nOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0\nR3JvdXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9ncm91cGluZzsKICAgIH0K\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldFdoZXJlKCkgewogICAgICAgIHJl\ndHVybiBfd2hlcmU7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRI\nYXZpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9oYXZpbmc7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygpIHsKICAgICAg\nICBpZiAoX2pvaW5zID09IG51bGwgfHwgX2pvaW5zLmpvaW5zKCkgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBqb2luIHNldCBp\ndGVyYXRvciBhbGxvd3MgY29uY3VycmVudCBtb2RpZmljYXRpb24KICAgICAg\nICBKb2luIGo7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfam9pbnMu\nam9pbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBqID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChq\nLmdldFJlbGF0aW9uVGFyZ2V0KCkgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgai5nZXRSZWxhdGlvblRhcmdldCgpLmdldERpc2NyaW1pbmF0b3IoKS5h\nZGRDbGFzc0NvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgICAodGhpcywg\nai5nZXRTdWJjbGFzc2VzKCkgPT0gU1VCU19KT0lOQUJMRSwgCiAgICAgICAg\nICAgICAgICAgICAgai5nZXRSZWxhdGlvbkpvaW5zKCkpOwogICAgICAgICAg\nICAgICAgai5zZXRSZWxhdGlvbihudWxsLCAwLCBudWxsKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgZ2V0Sm9p\nbnMoKSB7CiAgICAgICAgcmV0dXJuIF9qb2luczsKICAgIH0KCiAgICBwdWJs\naWMgSXRlcmF0b3IgZ2V0Sm9pbkl0ZXJhdG9yKCkgewogICAgICAgIGlmIChf\nam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm4gRW1wdHlJdGVyYXRvci5JTlNUQU5DRTsKICAgICAgICByZXR1\ncm4gX2pvaW5zLmpvaW5zKCkuam9pbkl0ZXJhdG9yKCk7CiAgICB9CgogICAg\ncHVibGljIGxvbmcgZ2V0U3RhcnRJbmRleCgpIHsKICAgICAgICByZXR1cm4g\nX3N0YXJ0SWR4OwogICAgfQoKICAgIHB1YmxpYyBsb25nIGdldEVuZEluZGV4\nKCkgewogICAgICAgIHJldHVybiBfZW5kSWR4OwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFJhbmdlKGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAg\nICAgX3N0YXJ0SWR4ID0gc3RhcnQ7CiAgICAgICAgX2VuZElkeCA9IGVuZDsK\nICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCAo\nSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29s\ndW1uQWxpYXMoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBy\nZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCBnZXRKb2lucyhqb2lucywgZmFs\nc2UpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMg\nZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgU3Ry\naW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaikg\newogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wuZ2V0TmFtZSgp\nLCBjb2wuZ2V0VGFibGUoKSwgcGopOwogICAgfQoKICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFibGUgdGFibGUpIHsK\nICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCB0YWJsZSwgKEpv\naW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVt\nbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBKb2lucyBqb2lucykg\newogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIHRhYmxlLCBn\nZXRKb2lucyhqb2lucywgZmFsc2UpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAg\nKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENvbHVtbkFsaWFzKFN0cmluZyBj\nb2wsIFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICBTdHJp\nbmcgdGFibGVBbGlhcyA9IG51bGw7CiAgICAgICAgaWYgKHBqID09IG51bGwg\nfHwgcGoucGF0aCgpID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF90YWJs\nZUFsaWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF90YWJsZUFsaWFz\nZXMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICB0YWJsZUFsaWFzID0g\nKFN0cmluZykgX3RhYmxlQWxpYXNlcy5nZXQodGFibGUpOwogICAgICAgICAg\nICBpZiAodGFibGVBbGlhcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0\nYWJsZUFsaWFzID0gZ2V0VGFibGVBbGlhcyh0YWJsZSwgcGopLnRvU3RyaW5n\nKCk7CiAgICAgICAgICAgICAgICBfdGFibGVBbGlhc2VzLnB1dCh0YWJsZSwg\ndGFibGVBbGlhcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTdHJpbmdCdWZmZXIodGFibGVBbGlhcykuYXBwZW5kKGNvbCkudG9T\ndHJpbmcoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGdldFRhYmxlQWxp\nYXModGFibGUsIHBqKS5hcHBlbmQoY29sKS50b1N0cmluZygpOwogICAgfQog\nICAgCiAgICBwcml2YXRlIFN0cmluZ0J1ZmZlciBnZXRUYWJsZUFsaWFzKFRh\nYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICBTdHJpbmdCdWZm\nZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGlmIChfZnJv\nbSAhPSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBhbGlhcyA9IHRvQWxp\nYXMoX2Zyb20uZ2V0VGFibGVJbmRleCh0YWJsZSwgcGosIHRydWUpKTsKICAg\nICAgICAgICAgaWYgKF9kaWN0LnJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3Qp\nCiAgICAgICAgICAgICAgICByZXR1cm4gYnVmLmFwcGVuZChGUk9NX1NFTEVD\nVF9BTElBUykuYXBwZW5kKCIuIikuYXBwZW5kKGFsaWFzKS4KICAgICAgICAg\nICAgICAgICAgICBhcHBlbmQoIl8iKTsKICAgICAgICAgICAgcmV0dXJuIGJ1\nZi5hcHBlbmQoYWxpYXMpLmFwcGVuZCgiXyIpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gYnVmLmFwcGVuZCh0b0FsaWFzKGdldFRhYmxlSW5kZXgodGFi\nbGUsIHBqLCB0cnVlKSkpLmFwcGVuZCgiLiIpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzQWdncmVnYXRlKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgQUdHUkVHQVRFKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldEFnZ3JlZ2F0ZShib29sZWFuIGFnZykgewogICAgICAgIGlmIChhZ2cp\nCiAgICAgICAgICAgIF9mbGFncyB8PSBBR0dSRUdBVEU7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfZmxhZ3MgJj0gfkFHR1JFR0FURTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0xvYigpIHsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIExPQikgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRM\nb2IoYm9vbGVhbiBsb2IpIHsKICAgICAgICBpZiAobG9iKQogICAgICAgICAg\nICBfZmxhZ3MgfD0gTE9COwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2Zs\nYWdzICY9IH5MT0I7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXJTZWxl\nY3RzKCkgewogICAgICAgIF9zZWxlY3RzLmNsZWFyKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gc2VsZWN0KFNRTEJ1ZmZlciBzcWwsIE9iamVjdCBp\nZCkgewogICAgICAgIHJldHVybiBzZWxlY3Qoc3FsLCBpZCwgbnVsbCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFNRTEJ1ZmZlciBzcWws\nIE9iamVjdCBpZCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoIWlzR3Jv\ndXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdCgoT2JqZWN0KSBz\ncWwsIGlkLCBqb2lucyk7CiAgICAgICAgZ3JvdXBCeShzcWwsIGpvaW5zKTsK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWNvcmQgdGhlIHNlbGVjdCBvZiB0aGUgZ2l2ZW4gU1FMIGJ1ZmZlciBvciBz\ndHJpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3QoT2Jq\nZWN0IHNxbCwgT2JqZWN0IGlkLCBKb2lucyBqb2lucykgewogICAgICAgIGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBib29sZWFuIGNvbnRhaW5z\nOwogICAgICAgIGlmIChpZCA9PSBudWxsKSB7CiAgICAgICAgICAgIGludCBp\nZHggPSBfc2VsZWN0cy5pbmRleE9mQWxpYXMoc3FsKTsKICAgICAgICAgICAg\nY29udGFpbnMgPSBpZHggIT0gLTE7CiAgICAgICAgICAgIGlmIChjb250YWlu\ncykKICAgICAgICAgICAgICAgIGlkID0gX3NlbGVjdHMuZ2V0KGlkeCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlkID0gbnVsbElkKCk7\nCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvbnRhaW5zID0gX3NlbGVj\ndHMuY29udGFpbnMoaWQpOwoKICAgICAgICBpZiAoY29udGFpbnMpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBfc2VsZWN0cy5zZXRBbGlh\ncyhpZCwgc3FsLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgdW5pcXVlIGlkIGZvciBhIFNR\nTCBzdHJpbmcgd2hvc2UgZ2l2ZW4gaWQgaXMgbnVsbC4KICAgICAqLwogICAg\ncHJpdmF0ZSBPYmplY3QgbnVsbElkKCkgewogICAgICAgIGlmIChfbnVsbElk\ncyA+PSBOVUxMX0lEUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBuZXcg\nTnVsbElkKCk7CiAgICAgICAgcmV0dXJuIE5VTExfSURTW19udWxsSWRzKytd\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTdHJpbmcgc3Fs\nLCBPYmplY3QgaWQpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KHNxbCwgaWQs\nIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTdHJp\nbmcgc3FsLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYg\nKCFpc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoKE9i\namVjdCkgc3FsLCBpZCwgam9pbnMpOwogICAgICAgIGdyb3VwQnkoc3FsLCBq\nb2lucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2VsZWN0UGxhY2Vob2xkZXIoU3RyaW5nIHNxbCkgewogICAgICAg\nIE9iamVjdCBob2xkZXIgPSAoX3BsYWNlaG9sZGVycyA+PSBQTEFDRUhPTERF\nUlMubGVuZ3RoKQogICAgICAgICAgICA/IG5ldyBQbGFjZWhvbGRlcigpIDog\nUExBQ0VIT0xERVJTW19wbGFjZWhvbGRlcnMrK107CiAgICAgICAgc2VsZWN0\nKHNxbCwgaG9sZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc2VydCBh\nIHBsYWNlaG9sZGVyIGF0IHRoZSBnaXZlbiBpbmRleDsgdXNlIGEgbmVnYXRp\ndmUgaW5kZXgKICAgICAqIHRvIGNvdW50IGZyb20gdGhlIGJhY2sgb2YgdGhl\nIHNlbGVjdCBsaXN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBpbnNlcnRQ\nbGFjZWhvbGRlcihTdHJpbmcgc3FsLCBpbnQgcG9zKSB7CiAgICAgICAgT2Jq\nZWN0IGhvbGRlciA9IChfcGxhY2Vob2xkZXJzID49IFBMQUNFSE9MREVSUy5s\nZW5ndGgpCiAgICAgICAgICAgID8gbmV3IFBsYWNlaG9sZGVyKCkgOiBQTEFD\nRUhPTERFUlNbX3BsYWNlaG9sZGVycysrXTsKICAgICAgICBfc2VsZWN0cy5p\nbnNlcnRBbGlhcyhwb3MsIGhvbGRlciwgc3FsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENsZWFyIHNlbGVjdGVkIHBsYWNlaG9sZGVycywgYW5kIHJldHVy\nbiByZW1vdmVkIHNlbGVjdCBpbmRleGVzLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBjbGVhclBsYWNlaG9sZGVyU2VsZWN0cygpIHsKICAgICAgICBfc2Vs\nZWN0cy5jbGVhclBsYWNlaG9sZGVycygpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIHNlbGVjdChDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIHNl\nbGVjdChjb2wsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gc2VsZWN0KENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgaWYgKCFpc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxl\nY3QoY29sLCBnZXRKb2lucyhqb2lucywgdHJ1ZSksIGZhbHNlKTsKICAgICAg\nICBncm91cEJ5KGNvbCwgam9pbnMpOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdChDb2x1bW5bXSBjb2xzKSB7\nCiAgICAgICAgcmV0dXJuIHNlbGVjdChjb2xzLCBudWxsKTsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IHNlbGVjdChDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lu\ncykgewogICAgICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGgg\nPT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKGlzR3Jv\ndXBpbmcoKSkgewogICAgICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsK\nICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIFBhdGhK\nb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQg\nc2VsZCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoc2VsZWN0KGNvbHNbaV0sIHBq\nLCBmYWxzZSkpCiAgICAgICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAg\nICAgICByZXR1cm4gc2VsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVj\ndCB0aGUgZ2l2ZW4gY29sdW1uIGFmdGVyIG1ha2luZyB0aGUgZ2l2ZW4gam9p\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3QoQ29sdW1u\nIGNvbCwgUGF0aEpvaW5zIHBqLCBib29sZWFuIGlkZW50KSB7CiAgICAgICAg\nLy8gd2UgY2FjaGUgb24gY29sdW1uIG9iamVjdCBpZiB0aGVyZSBhcmUgbm8g\nam9pbnMgc28gdGhhdCB3aGVuCiAgICAgICAgLy8gbG9va2luZyB1cCBjb2x1\nbW5zIGluIHRoZSByZXN1bHQgd2UgZG9uJ3QgaGF2ZSB0byBjcmVhdGUgYSBz\ndHJpbmcKICAgICAgICAvLyBidWZmZXIgZm9yIHRoZSB0YWJsZSArIGNvbHVt\nbiBhbGlhczsgaWYgdGhlcmUgYXJlIGpvaW5zLCB0aGVuCiAgICAgICAgLy8g\nd2Uga2V5IG9uIHRoZSBhbGlhcwogICAgICAgIFN0cmluZyBhbGlhcyA9IGdl\ndENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAgICAgIE9iamVjdCBpZDsKICAg\nICAgICBpZiAocGogPT0gbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAg\nICAgICAgICAgaWQgPSBjb2w7CiAgICAgICAgZWxzZQogICAgICAgICAgICBp\nZCA9IGFsaWFzOwogICAgICAgIGlmIChfc2VsZWN0cy5jb250YWlucyhpZCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKGNvbC5n\nZXRUeXBlKCkgPT0gVHlwZXMuQkxPQiB8fCBjb2wuZ2V0VHlwZSgpID09IFR5\ncGVzLkNMT0IpCiAgICAgICAgICAgIHNldExvYih0cnVlKTsKICAgICAgICBf\nc2VsZWN0cy5zZXRBbGlhcyhpZCwgYWxpYXMsIGlkZW50KTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\naW50IGVhZ2VyKSB7CiAgICAgICAgc2VsZWN0KG1hcHBpbmcsIHN1YmNsYXNz\nZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNlbGVjdChDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1\nYmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMg\nam9pbnMpIHsKICAgICAgICBzZWxlY3QodGhpcywgbWFwcGluZywgc3ViY2xh\nc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdlciwgam9pbnMsIGZhbHNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZ2l2ZW4gbWFwcGluZy4K\nICAgICAqLwogICAgdm9pZCBzZWxlY3QoU2VsZWN0IHdyYXBwZXIsIENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGlu\ndCBlYWdlciwKICAgICAgICBKb2lucyBqb2lucywgYm9vbGVhbiBpZGVudCkg\newogICAgICAgIC8vIG5vdGUgdGhhdCB0aGlzIGlzIG9uZSBjYXNlIHdoZXJl\nIHdlIGRvbid0IHdhbnQgdG8gdXNlIHRoZSByZXN1bHQKICAgICAgICAvLyBv\nZiBnZXRKb2lucygpOyBqdXN0IHVzZSB0aGUgZ2l2ZW4gam9pbnMsIHdoaWNo\nIHdpbGwgZWl0aGVyIGJlIGNsZWFuCiAgICAgICAgLy8gb3IgdGhlIHJlc3Vs\ndCBvZiBwcmV2aW91cyBwcmUtam9pbnMuIHRoaXMgd2F5IHdlIGRvbid0IHB1\nc2ggZXh0cmEKICAgICAgICAvLyBzdGFjayBzdHVmZiB3aGVuIG5vIGFjdHVh\nbCBuZXcgam9pbnMgaGF2ZSBiZWVuIG1hZGUsIGFuZCB3ZSBkb24ndAogICAg\nICAgIC8vIHRoaW5rIHRoZSB1c2VyIHdhbnRzIG91dGVyIGpvaW5zIHdoZW4g\nYWN0dWFsbHkgb25seSB0aGUgcHJldmlvdXMKICAgICAgICAvLyBqb2lucyB3\nZXJlIG91dGVyLiAgd2UgZG8gaW52b2tlIGdldEpvaW5zKCksIHRob3VnaCwg\ndG8gYWRkIHRoZXNlCiAgICAgICAgLy8gam9pbnMgKGlmIGFueSkgdG8gb3Vy\nIHRvcC1sZXZlbCBqb2luczsgb3RoZXJ3aXNlIGl0J2QgYmUgcG9zc2libGUK\nICAgICAgICAvLyBmb3IgdGhlIHVzZXIgdG8gaW1tZWRpYXRlbHkgZG8gYW5v\ndGhlciBqb2luIGFuZCBzZWxlY3Qgc29tZXRoaW5nLAogICAgICAgIC8vIGFu\nZCBpZiB3ZSdyZSBpbiBvdXRlciBtb2RlIGFsbCB0aGVzZSBqb2lucyB3aWxs\nIGdldCBzd2l0Y2hlZCB0byBvdXRlcgogICAgICAgIC8vIGpvaW5zLiAgY2Fj\naGluZyB0aGVtIGFzIHRoZWlyIG9yaWdpbmFsIGpvaW4gdHlwZSBwcmV2ZW50\ncyB0aGF0CiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwoKICAgICAg\nICBQYXRoSm9pbnMgcGogPSAoUGF0aEpvaW5zKSBqb2luczsKICAgICAgICBi\nb29sZWFuIGhhc0pvaW5zID0gcGogIT0gbnVsbCAmJiBwai5pc0RpcnR5KCk7\nCiAgICAgICAgaWYgKGhhc0pvaW5zKSB7CiAgICAgICAgICAgIGlmIChfcHJl\nSm9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wcmVKb2lucyA9IG5l\ndyBTdGFjaygpOwogICAgICAgICAgICBfcHJlSm9pbnMucHVzaChwaik7CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZiB0aGV5IGFyZSBzZWxlY3RpbmcgdGhp\ncyBtYXBwaW5nIHdpdGggb3V0ZXIgam9pbnMsIHRoZW4gYWxsIGpvaW5zCiAg\nICAgICAgLy8gZnJvbSB0aGlzIG1hcHBpbmcgc2hvdWxkIGFsc28gYmUgb3V0\nZXIKICAgICAgICBib29sZWFuIHdhc091dGVyID0gKF9mbGFncyAmIE9VVEVS\nKSAhPSAwOwogICAgICAgIGlmIChoYXNKb2lucyAmJiAhd2FzT3V0ZXIgJiYg\ncGouaXNPdXRlcigpKQogICAgICAgICAgICBfZmxhZ3MgfD0gT1VURVI7Cgog\nICAgICAgIC8vIGRlbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIgdG8gc2VsZWN0\nIGluIHNhbWUgb3JkZXIgaXQgbG9hZHMgcmVzdWx0CiAgICAgICAgKChKREJD\nU3RvcmVNYW5hZ2VyKSBzdG9yZSkuc2VsZWN0KHdyYXBwZXIsIG1hcHBpbmcs\nIHN1YmNsYXNzZXMsIG51bGwsCiAgICAgICAgICAgIG51bGwsIGZldGNoLCBl\nYWdlciwgaWRlbnQsIChfZmxhZ3MgJiBPVVRFUikgIT0gMCk7CgogICAgICAg\nIC8vIHJlc2V0CiAgICAgICAgaWYgKGhhc0pvaW5zKQogICAgICAgICAgICBf\ncHJlSm9pbnMucG9wKCk7CiAgICAgICAgaWYgKCF3YXNPdXRlciAmJiAoX2Zs\nYWdzICYgT1VURVIpICE9IDApCiAgICAgICAgICAgIF9mbGFncyAmPSB+T1VU\nRVI7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0SWRlbnRpZmll\ncihDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdElkZW50aWZp\nZXIoY29sLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIHNlbGVjdElkZW50aWZpZXIoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICBpZiAoIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0\ndXJuIHNlbGVjdChjb2wsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgdHJ1ZSk7\nCiAgICAgICAgZ3JvdXBCeShjb2wsIGpvaW5zKTsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3RJZGVudGlmaWVy\nKENvbHVtbltdIGNvbHMpIHsKICAgICAgICByZXR1cm4gc2VsZWN0SWRlbnRp\nZmllcihjb2xzLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVj\ndElkZW50aWZpZXIoQ29sdW1uW10gY29scywgSm9pbnMgam9pbnMpIHsKICAg\nICAgICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApCiAg\nICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmIChpc0dyb3VwaW5nKCkp\nIHsKICAgICAgICAgICAgZ3JvdXBCeShjb2xzLCBqb2lucyk7CiAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBQYXRoSm9pbnMgcGog\nPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgaW50IHNlbGQgPSAw\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgaWYgKHNlbGVjdChjb2xzW2ldLCBwaiwgdHJ1ZSkp\nCiAgICAgICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAgICAgICByZXR1\ncm4gc2VsZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RJZGVudGlm\naWVyKENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGludCBlYWdlcikgewogICAgICAgIHNlbGVjdElkZW50aWZpZXIo\nbWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdlciwgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0SWRlbnRpZmllcihD\nbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMgam9pbnMpIHsKICAgICAgICBz\nZWxlY3QodGhpcywgbWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNo\nLCBlYWdlciwgam9pbnMsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nc2VsZWN0UHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGluZykgewogICAg\nICAgIHJldHVybiBzZWxlY3RQcmltYXJ5S2V5KG1hcHBpbmcsIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0UHJpbWFyeUtleShDbGFzc01h\ncHBpbmcgbWFwcGluZywgSm9pbnMgam9pbnMpIHsKICAgICAgICByZXR1cm4g\ncHJpbWFyeUtleU9wZXJhdGlvbihtYXBwaW5nLCB0cnVlLCBudWxsLCBqb2lu\ncywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogT3BlcmF0ZSBvbiBw\ncmltYXJ5IGtleSBkYXRhLiBSZXR1cm4gYSBiaXQgbWFzayBvZiBzZWxlY3Rl\nZCBjb2x1bW5zLgogICAgICovCiAgICBwcml2YXRlIGludCBwcmltYXJ5S2V5\nT3BlcmF0aW9uKENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIHNlbCwK\nICAgICAgICBCb29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gYWxp\nYXNPcmRlcikgewogICAgICAgIGlmICghc2VsICYmIGFzYyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gMDsKCiAgICAgICAgLy8gaWYgdGhpcyBtYXBw\naW5nIGNhbid0IHNlbGVjdCB0aGUgZnVsbCBwayB2YWx1ZXMsIHRoZW4gam9p\nbiB0bwogICAgICAgIC8vIHN1cGVyIGFuZCByZWN1cnNlCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIHN1cDsKICAgICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5\nS2V5T2JqZWN0SWQodHJ1ZSkpIHsKICAgICAgICAgICAgc3VwID0gbWFwcGlu\nZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAg\nICAgaWYgKGpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBqb2lucyA9\nIG5ld0pvaW5zKCk7CiAgICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5qb2lu\nU3VwZXJjbGFzcyhqb2lucywgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4g\ncHJpbWFyeUtleU9wZXJhdGlvbihzdXAsIHNlbCwgYXNjLCBqb2lucywgYWxp\nYXNPcmRlcik7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xzID0g\nbWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGlmIChp\nc0dyb3VwaW5nKCkpIHsKICAgICAgICAgICAgZ3JvdXBCeShjb2xzLCBqb2lu\ncyk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAg\nUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIGZhbHNlKTsKICAgICAg\nICBpbnQgc2VsZCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoY29sdW1uT3BlcmF0\naW9uKGNvbHNbaV0sIHNlbCwgYXNjLCBwaiwgYWxpYXNPcmRlcikpCiAgICAg\nICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKCiAgICAgICAgLy8gaWYgdGhp\ncyBtYXBwaW5nIGhhcyBub3QgYmVlbiB1c2VkIGluIHRoZSBzZWxlY3QgeWV0\nIChhbmQgdGhlcmVmb3JlCiAgICAgICAgLy8gaXMgbm90IGpvaW5lZCB0byBh\nbnl0aGluZyksIGJ1dCBoYXMgYW4gb3RoZXItdGFibGUgc3VwZXJjbGFzcyB0\naGF0CiAgICAgICAgLy8gaGFzIGJlZW4gdXNlZCwgbWFrZSBzdXJlIHRvIGpv\naW4gdG8gaXQKICAgICAgICBib29sZWFuIGpvaW5lZCA9IGZhbHNlOwogICAg\nICAgIGZvciAoc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFz\nc01hcHBpbmcoKTsgc3VwICE9IG51bGw7CiAgICAgICAgICAgIG1hcHBpbmcg\nPSBzdXAsIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCkpIHsKICAgICAgICAgICAgaWYgKHN1cC5nZXRUYWJsZSgpID09\nIG1hcHBpbmcuZ2V0VGFibGUoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgaWYgKG1hcHBpbmcuZ2V0VGFibGUoKSAhPSBzdXAu\nZ2V0VGFibGUoKQogICAgICAgICAgICAgICAgJiYgZ2V0VGFibGVJbmRleCht\nYXBwaW5nLmdldFRhYmxlKCksIHBqLCBmYWxzZSkgPT0gLTEKICAgICAgICAg\nICAgICAgICYmIGdldFRhYmxlSW5kZXgoc3VwLmdldFRhYmxlKCksIHBqLCBm\nYWxzZSkgIT0gLTEpIHsKICAgICAgICAgICAgICAgIGlmIChwaiA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgbmV3Sm9p\nbnMoKTsKICAgICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgbWFwcGlu\nZy5qb2luU3VwZXJjbGFzcyhwaiwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nam9pbmVkID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGpvaW5lZCkKICAg\nICAgICAgICAgd2hlcmUocGopOwoKICAgICAgICByZXR1cm4gc2VsZDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gYW4gb3BlcmF0aW9uIG9uIGEg\nY29sdW1uLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gY29sdW1uT3Bl\ncmF0aW9uKENvbHVtbiBjb2wsIGJvb2xlYW4gc2VsLCBCb29sZWFuIGFzYywK\nICAgICAgICBQYXRoSm9pbnMgcGosIGJvb2xlYW4gYWxpYXNPcmRlcikgewog\nICAgICAgIFN0cmluZyBhcyA9IG51bGw7CiAgICAgICAgaWYgKGFzYyAhPSBu\ndWxsICYmIChhbGlhc09yZGVyIHx8IChfZmxhZ3MgJiBSRUNPUkRfT1JERVJF\nRCkgIT0gMCkpIHsKICAgICAgICAgICAgT2JqZWN0IGlkOwogICAgICAgICAg\nICBpZiAocGogPT0gbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGlkID0gY29sOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBpZCA9IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAwKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX29yZGVyZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBfb3JkZXJlZCA9IG5ldyBBcnJheUxpc3QoNSk7CiAgICAg\nICAgICAgICAgICBfb3JkZXJlZC5hZGQoaWQpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChhbGlhc09yZGVyKSB7CiAgICAgICAgICAgICAgICBh\ncyA9IHRvT3JkZXJBbGlhcyhfb3JkZXJzKyspOwogICAgICAgICAgICAgICAg\nX3NlbGVjdHMuc2V0U2VsZWN0QXMoaWQsIGFzKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBzZWxkID0gc2VsICYmIHNlbGVj\ndChjb2wsIHBqLCBmYWxzZSk7CiAgICAgICAgaWYgKGFzYyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIFN0cmluZyBhbGlhcyA9IChhcyAhPSBudWxsKSA/IGFz\nIDogZ2V0Q29sdW1uQWxpYXMoY29sLCBwaik7CiAgICAgICAgICAgIGFwcGVu\nZE9yZGVyaW5nKGFsaWFzLCBhc2MuYm9vbGVhblZhbHVlKCkpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gc2VsZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFwcGVuZCBvcmRlcmluZyBpbmZvcm1hdGlvbiB0byBvdXIgaW50ZXJuYWwg\nYnVmZmVyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXBwZW5kT3JkZXJp\nbmcoT2JqZWN0IG9yZGVyQnksIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgaWYg\nKF9vcmRlcmluZyA9PSBudWxsKQogICAgICAgICAgICBfb3JkZXJpbmcgPSBu\nZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9vcmRlcmluZy5hcHBlbmQoIiwgIik7CgogICAgICAgIGlmIChvcmRlckJ5\nIGluc3RhbmNlb2YgU1FMQnVmZmVyKQogICAgICAgICAgICBfb3JkZXJpbmcu\nYXBwZW5kKChTUUxCdWZmZXIpIG9yZGVyQnkpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgX29yZGVyaW5nLmFwcGVuZCgoU3RyaW5nKSBvcmRlckJ5KTsK\nICAgICAgICBpZiAoYXNjKQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5k\nKCIgQVNDIik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfb3JkZXJpbmcu\nYXBwZW5kKCIgREVTQyIpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJC\neVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gYXNj\nLAogICAgICAgIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVy\nQnlQcmltYXJ5S2V5KG1hcHBpbmcsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBib29sZWFuIGFzYywKICAgICAgICBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeVByaW1hcnlL\nZXkobWFwcGluZywgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24g\nb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgcHVibGljIGludCBvcmRlckJ5\nUHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2Ms\nCiAgICAgICAgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLCBib29sZWFuIGFs\naWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4gcHJpbWFyeUtleU9wZXJhdGlv\nbihtYXBwaW5nLCBzZWwsCiAgICAgICAgICAgIChhc2MpID8gQm9vbGVhbi5U\nUlVFIDogQm9vbGVhbi5GQUxTRSwgam9pbnMsIGFsaWFzT3JkZXIpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9v\nbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVy\nQnkoY29sLCBhc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gb3JkZXJCeShDb2x1bW4gY29sLCBib29sZWFuIGFzYywgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnko\nY29sLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBj\nb2x1bW5zLgogICAgICovCiAgICBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNv\nbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAg\nICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4gY29s\ndW1uT3BlcmF0aW9uKGNvbCwgc2VsLCAoYXNjKSA/IEJvb2xlYW4uVFJVRSA6\nIEJvb2xlYW4uRkFMU0UsCiAgICAgICAgICAgIGdldEpvaW5zKGpvaW5zLCB0\ncnVlKSwgYWxpYXNPcmRlcik7CiAgICB9CgogICAgcHVibGljIGludCBvcmRl\nckJ5KENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkg\newogICAgICAgIHJldHVybiBvcmRlckJ5KGNvbHMsIGFzYywgbnVsbCwgc2Vs\nKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IG9yZGVyQnkoQ29sdW1uW10gY29s\ncywgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewog\nICAgICAgIHJldHVybiBvcmRlckJ5KGNvbHMsIGFzYywgam9pbnMsIHNlbCwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRv\nIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGlu\ndCBvcmRlckJ5KENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBq\nb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVy\nKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRy\ndWUpOwogICAgICAgIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChj\nb2x1bW5PcGVyYXRpb24oY29sc1tpXSwgc2VsLAogICAgICAgICAgICAgICAg\nKGFzYykgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLCBwaiwgYWxp\nYXNPcmRlcikpCiAgICAgICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAg\nICAgICByZXR1cm4gc2VsZDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBv\ncmRlckJ5KFNRTEJ1ZmZlciBzcWwsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNl\nbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCAoSm9pbnMp\nIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJC\neShTUUxCdWZmZXIgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsCiAg\nICAgICAgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShz\ncWwsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNv\nbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIg\nc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAog\nICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVybiBv\ncmRlckJ5KChPYmplY3QpIHNxbCwgYXNjLCBqb2lucywgc2VsLCBhbGlhc09y\nZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9yZGVyIG9uIGEgU1FMIGJ1\nZmZlciBvciBzdHJpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBv\ncmRlckJ5KE9iamVjdCBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAg\nICAgICAgT2JqZWN0IG9yZGVyID0gc3FsOwogICAgICAgIGlmIChhbGlhc09y\nZGVyKSB7CiAgICAgICAgICAgIG9yZGVyID0gdG9PcmRlckFsaWFzKF9vcmRl\ncnMrKyk7CiAgICAgICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKHNxbCwg\nKFN0cmluZykgb3JkZXIpOwogICAgICAgIH0KICAgICAgICBpZiAoKF9mbGFn\ncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAwKSB7CiAgICAgICAgICAgIGlmIChf\nb3JkZXJlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgX29yZGVyZWQgPSBu\nZXcgQXJyYXlMaXN0KDUpOwogICAgICAgICAgICBfb3JkZXJlZC5hZGQoc3Fs\nKTsKICAgICAgICB9CgogICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsK\nICAgICAgICBhcHBlbmRPcmRlcmluZyhvcmRlciwgYXNjKTsKICAgICAgICBp\nZiAoc2VsKSB7CiAgICAgICAgICAgIGludCBpZHggPSBfc2VsZWN0cy5pbmRl\neE9mQWxpYXMoc3FsKTsKICAgICAgICAgICAgaWYgKGlkeCA9PSAtMSkgewog\nICAgICAgICAgICAgICAgX3NlbGVjdHMuc2V0QWxpYXMobnVsbElkKCksIHNx\nbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNxbCwgYm9v\nbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVy\nQnkoc3FsLCBhc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gb3JkZXJCeShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnko\nc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBj\nb2x1bW5zLgogICAgICovCiAgICBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNx\nbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAg\nICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4gb3Jk\nZXJCeSgoT2JqZWN0KSBzcWwsIGFzYywgam9pbnMsIHNlbCwgYWxpYXNPcmRl\ncik7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXJPcmRlcmluZygpIHsK\nICAgICAgICBfb3JkZXJpbmcgPSBudWxsOwogICAgICAgIF9vcmRlcnMgPSAw\nOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHJlY29y\nZCB0aGUgc2VsZWN0IGxpc3QgaW5kZXhlcyBvZiBpdGVtcyB3ZSBvcmRlciBi\neS4KICAgICAqLwogICAgdm9pZCBzZXRSZWNvcmRPcmRlcmVkSW5kZXhlcyhi\nb29sZWFuIHJlY29yZCkgewogICAgICAgIGlmIChyZWNvcmQpCiAgICAgICAg\nICAgIF9mbGFncyB8PSBSRUNPUkRfT1JERVJFRDsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgX29yZGVyZWQgPSBudWxsOwogICAgICAgICAgICBfZmxh\nZ3MgJj0gflJFQ09SRF9PUkRFUkVEOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgaW5kZXhlcyBpbiB0aGUgc2VsZWN0IGxp\nc3Qgb2YgYWxsIGl0ZW1zIHdlJ3JlIG9yZGVyaW5nCiAgICAgKiBieSwgb3Ig\nbnVsbCBpZiBub25lLiBGb3IgdXNlIHdpdGggdW5pb25zLgogICAgICovCiAg\nICBMaXN0IGdldE9yZGVyZWRJbmRleGVzKCkgewogICAgICAgIGlmIChfb3Jk\nZXJlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBMaXN0IGlkeHMgPSBuZXcgQXJyYXlMaXN0KF9vcmRlcmVkLnNpemUoKSk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfb3JkZXJlZC5zaXplKCk7\nIGkrKykKICAgICAgICAgICAgaWR4cy5hZGQoTnVtYmVycy52YWx1ZU9mKF9z\nZWxlY3RzLmluZGV4T2YoX29yZGVyZWQuZ2V0KGkpKSkpOwogICAgICAgIHJl\ndHVybiBpZHhzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlUHJpbWFy\neUtleShPYmplY3Qgb2lkLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAg\nICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICB3aGVyZVByaW1hcnlLZXko\nb2lkLCBtYXBwaW5nLCBudWxsLCBzdG9yZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgd2hlcmUgY29uZGl0aW9ucyBzZXR0aW5nIHRoZSBtYXBwaW5n\nJ3MgcHJpbWFyeSBrZXkgdG8gdGhlIGdpdmVuCiAgICAgKiBvaWQgdmFsdWVz\nLiBJZiB0aGUgZ2l2ZW4gbWFwcGluZyBkb2VzIG5vdCB1c2Ugb2lkIHZhbHVl\ncyBmb3IgaXRzCiAgICAgKiBwcmltYXJ5IGtleSwgd2Ugd2lsbCByZWN1cnNp\ndmVseSBqb2luIHRvIGl0cyBzdXBlcmNsYXNzIHVudGlsIHdlIGZpbmQKICAg\nICAqIGFuIGFuY2VzdG9yIHRoYXQgZG9lcy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHdoZXJlUHJpbWFyeUtleShPYmplY3Qgb2lkLCBDbGFzc01hcHBp\nbmcgbWFwcGluZywgSm9pbnMgam9pbnMsCiAgICAgICAgSkRCQ1N0b3JlIHN0\nb3JlKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nJ3MgaWRlbnRpZmll\ncnMgaW5jbHVkZSBzb21ldGhpbmcgb3RoZXIgdGhhbgogICAgICAgIC8vIHRo\nZSBwayB2YWx1ZXMsIGpvaW4gdG8gc3VwZXIgYW5kIHJlY3Vyc2UKICAgICAg\nICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQoZmFsc2UpKSB7\nCiAgICAgICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBtYXBwaW5nLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAgICBpZiAo\nam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3Sm9p\nbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNs\nYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIHdoZXJlUHJpbWFyeUtl\neShvaWQsIHN1cCwgam9pbnMsIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9IG1hcHBpbmcu\nZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICB3aGVyZShvaWQsIG1h\ncHBpbmcsIGNvbHMsIGNvbHMsIG51bGwsIG51bGwsIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKSwKICAgICAgICAgICAgc3RvcmUpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPYmplY3Qg\nb2lkLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDU3RvcmUg\nc3RvcmUpIHsKICAgICAgICB3aGVyZUZvcmVpZ25LZXkoZmssIG9pZCwgbWFw\ncGluZywgbnVsbCwgc3RvcmUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIHdoZXJlIGNvbmRpdGlvbnMgc2V0dGluZyB0aGUgZ2l2ZW4gZm9yZWlnbiBr\nZXkgdG8gdGhlIGdpdmVuCiAgICAgKiBvaWQgdmFsdWVzLgogICAgICoKICAg\nICAqIEBzZWUgI3doZXJlUHJpbWFyeUtleQogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9iamVjdCBv\naWQsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5z\nLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICAvLyBpZiB0aGlzIG1hcHBp\nbmcncyBpZGVudGlmaWVycyBpbmNsdWRlIHNvbWV0aGluZyBvdGhlciB0aGFu\nCiAgICAgICAgLy8gdGhlIHBrIHZhbHVlcywgb3IgaWYgdGhpcyBmb3JlaWdu\nIGtleSBkb2Vzbid0IGxpbmsgdG8gb25seQogICAgICAgIC8vIGlkZW50aWZp\nZXJzLCBqb2luIHRvIHRhYmxlIGFuZCBkbyBhIGdldFByaW1hcnlLZXkKICAg\nICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQoZmFsc2Up\nIHx8ICFjb250YWluc0FsbAogICAgICAgICAgICAobWFwcGluZy5nZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpLCBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKSkg\newogICAgICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGpvaW5zID0gbmV3Sm9pbnMoKTsKICAgICAgICAgICAgLy8gdHJhdmVy\nc2UgdG8gZm9yZWlnbiBrZXkgdGFyZ2V0IG1hcHBpbmcKICAgICAgICAgICAg\nd2hpbGUgKG1hcHBpbmcuZ2V0VGFibGUoKSAhPSBmay5nZXRQcmltYXJ5S2V5\nVGFibGUoKSkgewogICAgICAgICAgICAgICAgaWYgKGpvaW5zID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAg\nICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNsYXNzKGpv\naW5zLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBtYXBwaW5nID0gbWFwcGlu\nZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAg\nICAgICAgIGlmIChtYXBwaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgam9pbnMgPSBqb2lucy5qb2luKGZrLCBmYWxzZSwg\nZmFsc2UpOwogICAgICAgICAgICB3aGVyZVByaW1hcnlLZXkob2lkLCBtYXBw\naW5nLCBqb2lucywgc3RvcmUpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICBDb2x1bW5bXSBmcm9tQ29scyA9IGZrLmdldENvbHVt\nbnMoKTsKICAgICAgICBDb2x1bW5bXSB0b0NvbHMgPSBmay5nZXRQcmltYXJ5\nS2V5Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIGNvbnN0Q29scyA9IGZr\nLmdldENvbnN0YW50Q29sdW1ucygpOwogICAgICAgIE9iamVjdFtdIGNvbnN0\ncyA9IGZrLmdldENvbnN0YW50cygpOwogICAgICAgIHdoZXJlKG9pZCwgbWFw\ncGluZywgdG9Db2xzLCBmcm9tQ29scywgY29uc3RzLCBjb25zdENvbHMsCiAg\nICAgICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgc3RvcmUpOwogICAg\nfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGZsdXNoIHRo\nZSBvaWQgdmFsdWVzIGFzIHdoZXJlIGNvbmRpdGlvbnMgdG8gdGhlCiAgICAg\nKiBnaXZlbiBjb2x1bW5zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hl\ncmUoT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIENvbHVtbltd\nIHRvQ29scywKICAgICAgICBDb2x1bW5bXSBmcm9tQ29scywgT2JqZWN0W10g\ndmFscywgQ29sdW1uW10gY29uc3RDb2xzLCBQYXRoSm9pbnMgcGosCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVt\nYmVkID0gbWFwcGluZy5nZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAgICAgICAg\naWYgKGVtYmVkICE9IG51bGwpIHsKICAgICAgICAgICAgd2hlcmUob2lkLCBl\nbWJlZC5nZXRGaWVsZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBpbmcoKSwK\nICAgICAgICAgICAgICAgIHRvQ29scywgZnJvbUNvbHMsIHZhbHMsIGNvbnN0\nQ29scywgcGosIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgLy8gb25seSBib3RoZXIgdG8gcGFjayBwayB2YWx1ZXMg\naW50byBhcnJheSBpZiBhcHAgaWQKICAgICAgICBPYmplY3RbXSBwa3MgPSBu\ndWxsOwogICAgICAgIGlmIChtYXBwaW5nLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWFwcGluZy5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgcGtz\nID0gQXBwbGljYXRpb25JZHMudG9QS1ZhbHVlcyhvaWQsIG1hcHBpbmcpOwoK\nICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7\nCiAgICAgICAgSm9pbmFibGUgam9pbjsKICAgICAgICBPYmplY3QgdmFsOwog\nICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCB0b0NvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAgICAgICAg\nICAgaWYgKHBrcyA9PSBudWxsKQogICAgICAgICAgICAgICAgdmFsID0gKG9p\nZCA9PSBudWxsKSA/IG51bGwgOiBOdW1iZXJzLnZhbHVlT2YoKChJZCkgb2lk\nKS5nZXRJZCgpKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAvLyBtdXN0IGJlIGFwcCBpZGVudGl0eTsgdXNlIHBrIGluZGV4IHRvIGdl\ndCBjb3JyZWN0IHBrIHZhbHVlCiAgICAgICAgICAgICAgICBqb2luID0gbWFw\ncGluZy5hc3NlcnRKb2luYWJsZSh0b0NvbHNbaV0pOwogICAgICAgICAgICAg\nICAgdmFsID0gcGtzW21hcHBpbmcuZ2V0RmllbGQoam9pbi5nZXRGaWVsZElu\nZGV4KCkpLgogICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlJbmRl\neCgpXTsKICAgICAgICAgICAgICAgIHZhbCA9IGpvaW4uZ2V0Sm9pblZhbHVl\nKHZhbCwgdG9Db2xzW2ldLCBzdG9yZSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGdldENvbHVt\nbkFsaWFzKGZyb21Db2xzW2ldLCBwaikpOwogICAgICAgICAgICBpZiAodmFs\nID09IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiA9ICIpOwogICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUodmFsLCBmcm9t\nQ29sc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29uc3RDb2xzICE9\nIG51bGwgJiYgY29uc3RDb2xzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjb25zdENvbHMubGVuZ3RoOyBpKyssIGNv\ndW50KyspIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAg\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29uc3RDb2xzW2ld\nLCBwaikpOwoKICAgICAgICAgICAgICAgIGlmICh2YWxzW2ldID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElTICIpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiA9ICIpOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKHZh\nbHNbaV0sIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHdoZXJlKGJ1ZiwgcGopOwogICAgfQoKICAgIC8qKgogICAg\nICogVGVzdCB0byBzZWUgaWYgdGhlIGdpdmVuIHNldCBvZiBjb2x1bW5zIGNv\nbnRhaW5zIGFsbCB0aGUKICAgICAqIGNvbHVtbnMgaW4gdGhlIGdpdmVuIHBv\ndGVudGlhbCBzdWJzZXQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJv\nb2xlYW4gY29udGFpbnNBbGwoQ29sdW1uW10gc2V0LCBDb2x1bW5bXSBzdWIp\nIHsKICAgICAgICBpZiAoc3ViLmxlbmd0aCA+IHNldC5sZW5ndGgpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gdGhpcyBpcyBvYnZp\nb3VzbHkgbl4yLCBidXQgdGhlIG51bWJlciBvZiBjb2x1bW5zIHNob3VsZCBi\nZSBpbgogICAgICAgIC8vIHRoZSAxLTIgcmFuZ2UsIHNvIG5vIGJpZ2dpZQog\nICAgICAgIGJvb2xlYW4gZm91bmQgPSB0cnVlOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgc3ViLmxlbmd0aCAmJiBmb3VuZDsgaSsrKSB7CiAgICAg\nICAgICAgIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgc2V0Lmxlbmd0aCAmJiAhZm91bmQ7IGorKykKICAgICAgICAg\nICAgICAgIGZvdW5kID0gc3ViW2ldID09IHNldFtqXTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGZvdW5kOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdo\nZXJlKEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwp\nCiAgICAgICAgICAgIHdoZXJlKChTdHJpbmcpIG51bGwsIGpvaW5zKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsKSB7CiAg\nICAgICAgd2hlcmUoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHdoZXJlKFNRTEJ1ZmZlciBzcWwsIEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgd2hlcmUoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24g\ndG8gdGhlIFdIRVJFIGNsYXVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHdoZXJlKFNRTEJ1ZmZlciBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAg\nIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKHNxbCA9\nPSBudWxsIHx8IHNxbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgaWYgKF93aGVyZSA9PSBudWxsKQogICAgICAgICAgICBfd2hl\ncmUgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICgh\nX3doZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAgX3doZXJlLmFwcGVuZCgi\nIEFORCAiKTsKICAgICAgICBfd2hlcmUuYXBwZW5kKHNxbCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgd2hlcmUoU3RyaW5nIHNxbCkgewogICAgICAgIHdo\nZXJlKHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB3aGVyZShTdHJpbmcgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIHdo\nZXJlKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBXSEVS\nRSBjbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZShTdHJp\nbmcgc3FsLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICAvLyBubyBuZWVkIHRv\nIHVzZSBqb2lucy4uLgogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5\nKHNxbCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF93aGVy\nZSA9PSBudWxsKQogICAgICAgICAgICBfd2hlcmUgPSBuZXcgU1FMQnVmZmVy\nKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICghX3doZXJlLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgX3doZXJlLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBf\nd2hlcmUuYXBwZW5kKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2\naW5nKFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICBoYXZpbmcoc3FsLCAoSm9p\nbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTUUxC\ndWZmZXIgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIGhhdmluZyhzcWws\nIGdldEpvaW5zKGpvaW5zLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgdGhlIGdpdmVuIGNvbmRpdGlvbiB0byB0aGUgSEFWSU5HIGNsYXVz\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGhhdmluZyhTUUxCdWZmZXIg\nc3FsLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVz\nZSBqb2lucy4uLgogICAgICAgIGlmIChzcWwgPT0gbnVsbCB8fCBzcWwuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChfaGF2\naW5nID09IG51bGwpCiAgICAgICAgICAgIF9oYXZpbmcgPSBuZXcgU1FMQnVm\nZmVyKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICghX2hhdmluZy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIF9oYXZpbmcuYXBwZW5kKCIgQU5EICIpOwogICAg\nICAgIF9oYXZpbmcuYXBwZW5kKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgaGF2aW5nKFN0cmluZyBzcWwpIHsKICAgICAgICBoYXZpbmcoc3FsLCAo\nSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhT\ndHJpbmcgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIGhhdmluZyhzcWws\nIGdldEpvaW5zKGpvaW5zLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgdGhlIGdpdmVuIGNvbmRpdGlvbiB0byB0aGUgSEFWSU5HIGNsYXVz\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGhhdmluZyhTdHJpbmcgc3Fs\nLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBq\nb2lucy4uLgogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNxbCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9oYXZpbmcgPT0g\nbnVsbCkKICAgICAgICAgICAgX2hhdmluZyA9IG5ldyBTUUxCdWZmZXIoX2Rp\nY3QpOwogICAgICAgIGVsc2UgaWYgKCFfaGF2aW5nLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgX2hhdmluZy5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgX2hh\ndmluZy5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91\ncEJ5KFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICBncm91cEJ5KHNxbCwgKEpv\naW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFNR\nTEJ1ZmZlciBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgZ2V0Sm9pbnMo\nam9pbnMsIHRydWUpOwogICAgICAgIGdyb3VwQnlBcHBlbmQoc3FsLmdldFNR\nTCgpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFN0cmluZyBz\ncWwpIHsKICAgICAgICBncm91cEJ5KHNxbCwgKEpvaW5zKSBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFN0cmluZyBzcWwsIEpvaW5z\nIGpvaW5zKSB7CiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAg\nICAgIGdyb3VwQnlBcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBncm91cEJ5KENvbHVtbiBjb2wpIHsKICAgICAgICBncm91cEJ5KGNvbCwg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW4g\nY29sLCBKb2lucyBqb2lucykgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBncm91cEJ5QXBwZW5kKGdl\ndENvbHVtbkFsaWFzKGNvbCwgcGopKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBncm91cEJ5KENvbHVtbltdIGNvbHMpIHsKICAgICAgICBncm91cEJ5KGNv\nbHMsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29s\ndW1uW10gY29scywgSm9pbnMgam9pbnMpIHsKICAgICAgICBQYXRoSm9pbnMg\ncGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdy\nb3VwQnlBcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29sc1tpXSwgcGopKTsKICAg\nICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBncm91cEJ5QXBw\nZW5kKFN0cmluZyBzcWwpIHsKICAgICAgICBpZiAoX2dyb3VwZWQgPT0gbnVs\nbCB8fCAhX2dyb3VwZWQuY29udGFpbnMoc3FsKSkgewogICAgICAgICAgICBp\nZiAoX2dyb3VwaW5nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIF9ncm91\ncGluZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgICAgICAgICAg\nX2dyb3VwZWQgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgX2dyb3VwaW5nLmFwcGVuZCgiLCAiKTsKCiAg\nICAgICAgICAgIF9ncm91cGluZy5hcHBlbmQoc3FsKTsKICAgICAgICAgICAg\nX2dyb3VwZWQuYWRkKHNxbCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJj\nbGFzc2VzLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGdyb3VwQnkobWFwcGluZywg\nc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBudWxsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBncm91cEJ5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQg\nc3ViY2xhc3NlcywgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\nLy8gd2UgaW1wbGVtZW50IHRoaXMgYnkgcHV0dGluZyBvdXJzZWx2ZXMgaW50\nbyBncm91cGluZyBtb2RlLCB3aGVyZQogICAgICAgIC8vIGFsbCBzZWxlY3Qg\naW52b2NhdGlvbnMgYXJlIHJlLXJvdXRlZCB0byBncm91cC1ieSBpbnZvY2F0\naW9ucyBpbnN0ZWFkLgogICAgICAgIC8vIHRoaXMgYWxsb3dzIHVzIHRvIHV0\naWxpemUgdGhlIHNhbWUgc2VsZWN0IEFQSXMgb2YgdGhlIHN0b3JlIG1hbmFn\nZXIKICAgICAgICAvLyBhbmQgYWxsIHRoZSBtYXBwaW5nIHN0cmF0ZWdpZXMs\nIHJhdGhlciB0aGFuIGhhdmluZyB0byBjcmVhdGUgCiAgICAgICAgLy8gZXF1\naXZhbGVudCBBUElzIGFuZCBkdXBsaWNhdGUgbG9naWMgZm9yIGdyb3VwaW5n\nCiAgICAgICAgYm9vbGVhbiB3YXNHcm91cGluZyA9IGlzR3JvdXBpbmcoKTsK\nICAgICAgICBfZmxhZ3MgfD0gR1JPVVBJTkc7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgc2VsZWN0KG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBm\nZXRjaCwgCiAgICAgICAgICAgICAgICBFYWdlckZldGNoTW9kZXMuRUFHRVJf\nTk9ORSwgam9pbnMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmICghd2FzR3JvdXBpbmcpCiAgICAgICAgICAgICAgICBfZmxhZ3MgJj0g\nfkdST1VQSU5HOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgd2UncmUgaW4gZ3JvdXAgbW9kZSwgd2hlcmUgYW55IHNlbGVjdCBp\ncyBjaGFuZ2VkIHRvIGEgZ3JvdXAtYnkKICAgICAqIGNhbGwuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBpc0dyb3VwaW5nKCkgewogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgR1JPVVBJTkcpICE9IDA7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGpvaW5zIHRvIHVzZSBmb3IgY29sdW1uIGFs\naWFzZXMsIGV0Yy4KICAgICAqCiAgICAgKiBAcGFyYW0gam9pbnMgam9pbnMg\nZ2l2ZW4gYnkgdGhlIHVzZXIKICAgICAqIEByZXR1cm4gdGhlIGpvaW5zIHRv\nIHVzZSBmb3IgYWxpYXNlcywgZXRjCiAgICAgKi8KICAgIHByaXZhdGUgUGF0\naEpvaW5zIGdldEpvaW5zKEpvaW5zIGpvaW5zLCBib29sZWFuIHJlY29yZCkg\newogICAgICAgIFBhdGhKb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwog\nICAgICAgIGJvb2xlYW4gcHJlID0gKHBqID09IG51bGwgfHwgIXBqLmlzRGly\ndHkoKSkKICAgICAgICAgICAgJiYgX3ByZUpvaW5zICE9IG51bGwgJiYgIV9w\ncmVKb2lucy5pc0VtcHR5KCk7CiAgICAgICAgaWYgKHByZSkKICAgICAgICAg\nICAgcGogPSAoUGF0aEpvaW5zKSBfcHJlSm9pbnMucGVlaygpOwoKICAgICAg\nICBpZiAocGogPT0gbnVsbCB8fCAhcGouaXNEaXJ0eSgpKQogICAgICAgICAg\nICBwaiA9IF9qb2luczsKICAgICAgICBlbHNlIGlmICghcHJlKSB7CiAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgT1VURVIpICE9IDApCiAgICAgICAgICAg\nICAgICBwaiA9IChQYXRoSm9pbnMpIG91dGVyKHBqKTsKICAgICAgICAgICAg\naWYgKHJlY29yZCkgewogICAgICAgICAgICAgICAgaWYgKCFwai5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlUGFyZW50Sm9pbnMocGop\nOwogICAgICAgICAgICAgICAgaWYgKCFwai5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgICAgICAgICByZW1vdmVKb2luc0Zyb21TdWJzZWxlY3RzKHBqKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIF9qb2lucyA9IG5ldyBTZWxlY3RKb2lucyh0\naGlzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2pvaW5zLmpvaW5zKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zLnNldEpv\naW5zKG5ldyBKb2luU2V0KHBqLmpvaW5zKCkpKTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF9qb2lucy5qb2lu\ncygpLmFkZEFsbChwai5qb2lucygpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGo7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYW55IGpvaW5zIGFscmVhZHkgaW4g\nb3VyIHBhcmVudCBzZWxlY3QgZnJvbSB0aGUgZ2l2ZW4gbm9uLWVtcHR5CiAg\nICAgKiBqb2luIHNldC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92\nZVBhcmVudEpvaW5zKFBhdGhKb2lucyBwaikgewogICAgICAgIGlmIChfcGFy\nZW50ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAo\nX3BhcmVudC5fam9pbnMgIT0gbnVsbCAmJiAhX3BhcmVudC5fam9pbnMuaXNF\nbXB0eSgpKSB7CiAgICAgICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9IGZhbHNl\nOwogICAgICAgICAgICBpZiAoIV9yZW1vdmVkQWxpYXNGcm9tUGFyZW50Lmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBwai5qb2lucygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICAgICBKb2luIGpuID0gKEpvaW4pIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICAgICBpZiAoX2FsaWFzZXMuY29udGFpbnNWYWx1\nZShuZXcgSW50ZWdlcihqbi5nZXRJbmRleDEoKSkpKQogICAgICAgICAgICAg\nICAgICAgICAgIHJlbW92ZWQgPSBfcGFyZW50Ll9qb2lucy5qb2lucygpLnJl\nbW92ZShqbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKCFyZW1vdmVkKQogICAgICAgICAgICAgICAgcGouam9p\nbnMoKS5yZW1vdmVBbGwoX3BhcmVudC5fam9pbnMuam9pbnMoKSk7CiAgICAg\nICAgfQogICAgICAgIGlmICghcGouaXNFbXB0eSgpKQogICAgICAgICAgICBf\ncGFyZW50LnJlbW92ZVBhcmVudEpvaW5zKHBqKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gbm9uLWVtcHR5IGpvaW5zIGZyb20g\ndGhlIGpvaW5zIG9mIG91ciBzdWJzZWxlY3RzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVtb3ZlSm9pbnNGcm9tU3Vic2VsZWN0cyhQYXRoSm9pbnMg\ncGopIHsKICAgICAgICBpZiAoX3N1YnNlbHMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIFNlbGVjdEltcGwgc3ViOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAg\nICAgICAgICAgc3ViID0gKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChpKTsK\nICAgICAgICAgICAgaWYgKHN1Yi5fam9pbnMgIT0gbnVsbCAmJiAhc3ViLl9q\nb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBzdWIuX2pvaW5zLmpv\naW5zKCkucmVtb3ZlQWxsKHBqLmpvaW5zKCkpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3Igd2hlcmVDbG9uZShpbnQgc2Vs\ncykgewogICAgICAgIGlmIChzZWxzIDwgMSkKICAgICAgICAgICAgc2VscyA9\nIDE7CgogICAgICAgIFNlbGVjdFtdIGNsb25lcyA9IG51bGw7CiAgICAgICAg\nU2VsZWN0SW1wbCBzZWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\nZWxzOyBpKyspIHsKICAgICAgICAgICAgc2VsID0gKFNlbGVjdEltcGwpIF9j\nb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1NlbGVjdCgpOwogICAg\nICAgICAgICBzZWwuX2ZsYWdzID0gX2ZsYWdzOwogICAgICAgICAgICBzZWwu\nX2ZsYWdzICY9IH5BR0dSRUdBVEU7CiAgICAgICAgICAgIHNlbC5fZmxhZ3Mg\nJj0gfk9VVEVSOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5MUlM7CiAg\nICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfkVBR0VSX1RPX09ORTsKICAgICAg\nICAgICAgc2VsLl9mbGFncyAmPSB+RUFHRVJfVE9fTUFOWTsKICAgICAgICAg\nICAgc2VsLl9mbGFncyAmPSB+Rk9SQ0VfQ09VTlQ7CiAgICAgICAgICAgIHNl\nbC5fam9pblN5bnRheCA9IF9qb2luU3ludGF4OwogICAgICAgICAgICBpZiAo\nX2FsaWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fYWxpYXNl\ncyA9IG5ldyBIYXNoTWFwKF9hbGlhc2VzKTsKICAgICAgICAgICAgaWYgKF90\nYWJsZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fdGFibGVzID0g\nbmV3IFRyZWVNYXAoX3RhYmxlcyk7CiAgICAgICAgICAgIGlmIChfam9pbnMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fam9pbnMgPSBfam9pbnMu\nY2xvbmUoc2VsKTsKICAgICAgICAgICAgaWYgKF93aGVyZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgc2VsLl93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX3do\nZXJlKTsKICAgICAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIHNlbC5fZnJvbSA9IChTZWxlY3RJbXBsKSBfZnJvbS53aGVy\nZUNsb25lKDEpOwogICAgICAgICAgICAgICAgc2VsLl9mcm9tLl9vdXRlciA9\nIHNlbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX3N1YnNlbHMg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsLl9zdWJzZWxzID0gbmV3\nIEFycmF5TGlzdChfc3Vic2Vscy5zaXplKCkpOwogICAgICAgICAgICAgICAg\nU2VsZWN0SW1wbCBzdWIsIHNlbFN1YjsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGogPSAwOyBqIDwgX3N1YnNlbHMuc2l6ZSgpOyBqKyspIHsKICAgICAg\nICAgICAgICAgICAgICBzdWIgPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0\nKGopOwogICAgICAgICAgICAgICAgICAgIHNlbFN1YiA9IChTZWxlY3RJbXBs\nKSBzdWIuZnVsbENsb25lKDEpOwogICAgICAgICAgICAgICAgICAgIHNlbFN1\nYi5fcGFyZW50ID0gc2VsOwogICAgICAgICAgICAgICAgICAgIHNlbFN1Yi5f\nc3ViUGF0aCA9IHN1Yi5fc3ViUGF0aDsKICAgICAgICAgICAgICAgICAgICBz\nZWwuX3N1YnNlbHMuYWRkKHNlbFN1Yik7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHNlbC5fd2hlcmUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgc2VsLl93aGVyZS5yZXBsYWNlKHN1Yiwgc2VsU3ViKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlbHMg\nPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiBzZWw7CiAgICAgICAgICAg\nIGlmIChjbG9uZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNsb25lcyA9\nIG5ldyBTZWxlY3Rbc2Vsc107CiAgICAgICAgICAgIGNsb25lc1tpXSA9IHNl\nbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jb25mLmdldFNRTEZhY3Rv\ncnlJbnN0YW5jZSgpLm5ld1VuaW9uKGNsb25lcyk7CiAgICB9CgogICAgcHVi\nbGljIFNlbGVjdEV4ZWN1dG9yIGZ1bGxDbG9uZShpbnQgc2VscykgewogICAg\nICAgIGlmIChzZWxzIDwgMSkKICAgICAgICAgICAgc2VscyA9IDE7CgogICAg\nICAgIFNlbGVjdFtdIGNsb25lcyA9IG51bGw7CiAgICAgICAgU2VsZWN0SW1w\nbCBzZWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZWxzOyBpKysp\nIHsKICAgICAgICAgICAgc2VsID0gKFNlbGVjdEltcGwpIHdoZXJlQ2xvbmUo\nMSk7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7CiAgICAgICAg\nICAgIHNlbC5fZXhwZWN0ZWRSZXN1bHRDb3VudCA9IF9leHBlY3RlZFJlc3Vs\ndENvdW50OwogICAgICAgICAgICBzZWwuX3NlbGVjdHMuYWRkQWxsKF9zZWxl\nY3RzKTsKICAgICAgICAgICAgaWYgKF9vcmRlcmluZyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgc2VsLl9vcmRlcmluZyA9IG5ldyBTUUxCdWZmZXIoX29y\nZGVyaW5nKTsKICAgICAgICAgICAgc2VsLl9vcmRlcnMgPSBfb3JkZXJzOwog\nICAgICAgICAgICBpZiAoX2dyb3VwaW5nICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBzZWwuX2dyb3VwaW5nID0gbmV3IFNRTEJ1ZmZlcihfZ3JvdXBpbmcp\nOwogICAgICAgICAgICBpZiAoX2hhdmluZyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgc2VsLl9oYXZpbmcgPSBuZXcgU1FMQnVmZmVyKF9oYXZpbmcpOwog\nICAgICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgc2VsLl9mcm9tID0gKFNlbGVjdEltcGwpIF9mcm9tLmZ1bGxDbG9uZSgx\nKTsKICAgICAgICAgICAgICAgIHNlbC5fZnJvbS5fb3V0ZXIgPSBzZWw7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWxzID09IDEpCiAgICAg\nICAgICAgICAgICByZXR1cm4gc2VsOwogICAgICAgICAgICBpZiAoY2xvbmVz\nID09IG51bGwpCiAgICAgICAgICAgICAgICBjbG9uZXMgPSBuZXcgU2VsZWN0\nW3NlbHNdOwogICAgICAgICAgICBjbG9uZXNbaV0gPSBzZWw7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2Uo\nKS5uZXdVbmlvbihjbG9uZXMpOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RF\neGVjdXRvciBlYWdlckNsb25lKEZpZWxkTWFwcGluZyBrZXksIGludCBlYWdl\nclR5cGUsCiAgICAgICAgYm9vbGVhbiB0b01hbnksIGludCBzZWxzKSB7CiAg\nICAgICAgaWYgKGVhZ2VyVHlwZSA9PSBFQUdFUl9PVVRFUgogICAgICAgICAg\nICAmJiBfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJ\nVElPTkFMKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\nX2VhZ2VyS2V5cyAhPSBudWxsICYmIF9lYWdlcktleXMuY29udGFpbnMoa2V5\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGdsb2Jh\nbCBzZXQgb2YgZWFnZXIga2V5cwogICAgICAgIGlmIChfZWFnZXJLZXlzID09\nIG51bGwpCiAgICAgICAgICAgIF9lYWdlcktleXMgPSBuZXcgSGFzaFNldCgp\nOwogICAgICAgIF9lYWdlcktleXMuYWRkKGtleSk7CgogICAgICAgIFNlbGVj\ndEV4ZWN1dG9yIHNlbDsKICAgICAgICBpZiAoZWFnZXJUeXBlICE9IEVBR0VS\nX1BBUkFMTEVMKSB7CiAgICAgICAgICAgIGlmICh0b01hbnkpCiAgICAgICAg\nICAgICAgICBfZmxhZ3MgfD0gRUFHRVJfVE9fTUFOWTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEVBR0VSX1RPX09ORTsK\nICAgICAgICAgICAgc2VsID0gdGhpczsKICAgICAgICB9IGVsc2UgaWYgKHNl\nbHMgPCAyKQogICAgICAgICAgICBzZWwgPSBwYXJhbGxlbENsb25lKCk7CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIFNlbGVjdFtdIGNsb25lcyA9IG5l\ndyBTZWxlY3Rbc2Vsc107CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY2xvbmVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgY2xvbmVz\nW2ldID0gcGFyYWxsZWxDbG9uZSgpOwogICAgICAgICAgICBzZWwgPSBfY29u\nZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdVbmlvbihjbG9uZXMpOwog\nICAgICAgIH0KCiAgICAgICAgaWYgKF9lYWdlciA9PSBudWxsKQogICAgICAg\nICAgICBfZWFnZXIgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9lYWdlci5w\ndXQodG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwsIGZhbHNlKSksIHNl\nbCk7CiAgICAgICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGNsb25lIG9mIHRoaXMgc2VsZWN0IGZvciB1c2UgaW4gZWFn\nZXIgcGFyYWxsZWwgc2VsZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBTZWxl\nY3RJbXBsIHBhcmFsbGVsQ2xvbmUoKSB7CiAgICAgICAgU2VsZWN0SW1wbCBz\nZWwgPSAoU2VsZWN0SW1wbCkgd2hlcmVDbG9uZSgxKTsKICAgICAgICBzZWwu\nX2ZsYWdzICY9IH5OT05BVVRPX0RJU1RJTkNUOwogICAgICAgIHNlbC5fZWFn\nZXJLZXlzID0gX2VhZ2VyS2V5czsKICAgICAgICBpZiAoX3ByZUpvaW5zICE9\nIG51bGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nc2VsLl9wcmVKb2lucyA9IG5ldyBTdGFjaygpOwogICAgICAgICAgICBzZWwu\nX3ByZUpvaW5zLnB1c2goKChTZWxlY3RKb2lucykgX3ByZUpvaW5zLnBlZWso\nKSkuCiAgICAgICAgICAgICAgICBjbG9uZShzZWwpKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB2aWV3IG9mIGVhZ2VyIHNlbGVjdHMuIE1heSBiZSBudWxsLgogICAgICov\nCiAgICBwdWJsaWMgTWFwIGdldEVhZ2VyTWFwKCkgewogICAgICAgIHJldHVy\nbiBfZWFnZXI7CiAgICB9CgogICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIGdl\ndEVhZ2VyKEZpZWxkTWFwcGluZyBrZXkpIHsKICAgICAgICBpZiAoX2VhZ2Vy\nID09IG51bGwgfHwgIV9lYWdlcktleXMuY29udGFpbnMoa2V5KSkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIChTZWxlY3RFeGVj\ndXRvcikgX2VhZ2VyLmdldCh0b0VhZ2VyS2V5KGtleSwgZ2V0Sm9pbnMobnVs\nbCwKICAgICAgICAgICAgZmFsc2UpKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGVhZ2VyIGtleSB0byB1c2UgZm9yIHRoZSB1c2VyLWdp\ndmVuIGtleS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IHRv\nRWFnZXJLZXkoRmllbGRNYXBwaW5nIGtleSwgUGF0aEpvaW5zIHBqKSB7CiAg\nICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgpID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgcmV0dXJuIG5ldyBLZXko\ncGoucGF0aCgpLnRvU3RyaW5nKCksIGtleSk7CiAgICB9CgogICAgcHVibGlj\nIEpvaW5zIG5ld0pvaW5zKCkgewogICAgICAgIGlmIChfcHJlSm9pbnMgIT0g\nbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHkoKSkgewogICAgICAgICAgICBT\nZWxlY3RKb2lucyBzaiA9IChTZWxlY3RKb2lucykgX3ByZUpvaW5zLnBlZWso\nKTsKICAgICAgICAgICAgcmV0dXJuIHNqLmNsb25lKHRoaXMpOwogICAgICAg\nIH0KICAgICAgICAvLyByZXR1cm4gdGhpcyBmb3IgZWZmaWNpZW5jeSBpbiBj\nYXNlIG5vIGpvaW5zIGVuZCB1cCBiZWluZyBtYWRlCiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG5ld091dGVySm9pbnMo\nKSB7CiAgICAgICAgcmV0dXJuICgoUGF0aEpvaW5zKSBuZXdKb2lucygpKS5z\nZXRPdXRlcih0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmQo\nU1FMQnVmZmVyIGJ1ZiwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoam9p\nbnMgPT0gbnVsbCB8fCBqb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgaWYgKCFidWYuaXNFbXB0eSgpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIEpvaW4gam9pbiA9IG51\nbGw7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSAoKFBhdGhKb2lucykg\nam9pbnMpLmpvaW5zKCkuam9pbkl0ZXJhdG9yKCk7CiAgICAgICAgICAgIGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGpvaW4gPSAoSm9pbikgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgc3dpdGNoIChfam9pblN5bnRheCkgewog\nICAgICAgICAgICAgICAgY2FzZSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJ\nVElPTkFMOgogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2RpY3Qu\ndG9UcmFkaXRpb25hbEpvaW4oam9pbikpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKb2luU3ludGF4ZXMuU1lO\nVEFYX0RBVEFCQVNFOgogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nX2RpY3QudG9OYXRpdmVKb2luKGpvaW4pKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIEpvaW5zIGFuZChKb2lucyBqb2luczEsIEpvaW5z\nIGpvaW5zMikgewogICAgICAgIHJldHVybiBhbmQoKFBhdGhKb2lucykgam9p\nbnMxLCAoUGF0aEpvaW5zKSBqb2luczIsIHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29tYmluZSB0aGUgZ2l2ZW4gam9pbnMuCiAgICAgKi8KICAg\nIHByaXZhdGUgU2VsZWN0Sm9pbnMgYW5kKFBhdGhKb2lucyBqMSwgUGF0aEpv\naW5zIGoyLCBib29sZWFuIG51bGxKb2lucykgewogICAgICAgIGlmICgoajEg\nPT0gbnVsbCB8fCBqMS5pc0VtcHR5KCkpCiAgICAgICAgICAgICYmIChqMiA9\nPSBudWxsIHx8IGoyLmlzRW1wdHkoKSkpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBTZWxlY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lu\ncyh0aGlzKTsKICAgICAgICBpZiAoajEgPT0gbnVsbCB8fCBqMS5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgaWYgKG51bGxKb2lucykKICAgICAgICAgICAg\nICAgIHNqLnNldEpvaW5zKGoyLmpvaW5zKCkpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBzai5zZXRKb2lucyhuZXcgSm9pblNldChqMi5q\nb2lucygpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSm9pblNl\ndCBzZXQ7CiAgICAgICAgICAgIGlmIChudWxsSm9pbnMpCiAgICAgICAgICAg\nICAgICBzZXQgPSBqMS5qb2lucygpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBzZXQgPSBuZXcgSm9pblNldChqMS5qb2lucygpKTsKCiAg\nICAgICAgICAgIGlmIChqMiAhPSBudWxsICYmICFqMi5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICBzZXQuYWRkQWxsKGoyLmpvaW5zKCkpOwogICAgICAg\nICAgICBzai5zZXRKb2lucyhzZXQpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nbnVsbCBwcmV2aW91cyBqb2luczsgYWxsIGFyZSBjb21iaW5lZCBpbnRvIHRo\naXMgb25lCiAgICAgICAgaWYgKG51bGxKb2lucyAmJiBqMSAhPSBudWxsKQog\nICAgICAgICAgICBqMS5udWxsSm9pbnMoKTsKICAgICAgICBpZiAobnVsbEpv\naW5zICYmIGoyICE9IG51bGwpCiAgICAgICAgICAgIGoyLm51bGxKb2lucygp\nOwoKICAgICAgICByZXR1cm4gc2o7CiAgICB9CgogICAgcHVibGljIEpvaW5z\nIG9yKEpvaW5zIGpvaW5zMSwgSm9pbnMgam9pbnMyKSB7CiAgICAgICAgUGF0\naEpvaW5zIGoxID0gKFBhdGhKb2lucykgam9pbnMxOwogICAgICAgIFBhdGhK\nb2lucyBqMiA9IChQYXRoSm9pbnMpIGpvaW5zMjsKCiAgICAgICAgLy8gaWYg\nbm8gY29tbW9uIGpvaW5zLCByZXR1cm4gbnVsbDsgaWYgb25lIHNpZGUgb2Yg\ndGhlIG9yIGNsYXVzZSBoYXMKICAgICAgICAvLyBkaWZmZXJlbnQgam9pbnMg\ndGhhbiB0aGUgb3RoZXIsIHRoZW4gd2UgbmVlZCB0byB1c2UgZGlzdGluY3QK\nICAgICAgICBib29sZWFuIGoxRW1wdHkgPSBqMSA9PSBudWxsIHx8IGoxLmlz\nRW1wdHkoKTsKICAgICAgICBib29sZWFuIGoyRW1wdHkgPSBqMiA9PSBudWxs\nIHx8IGoyLmlzRW1wdHkoKTsKICAgICAgICBpZiAoajFFbXB0eSB8fCBqMkVt\ncHR5KSB7CiAgICAgICAgICAgIGlmIChqMUVtcHR5ICYmICFqMkVtcHR5KSB7\nCiAgICAgICAgICAgICAgICBjb2xsZWN0T3V0ZXJKb2lucyhqMik7CiAgICAg\nICAgICAgICAgICBpZiAoIWoyLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nICAgICBfZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoajJFbXB0eSAmJiAhajFFbXB0eSkgewogICAgICAgICAg\nICAgICAgY29sbGVjdE91dGVySm9pbnMoajEpOwogICAgICAgICAgICAgICAg\naWYgKCFqMS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgX2ZsYWdz\nIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgYWxs\nIGNvbW1vbiBqb2lucywgbW92ZSBhbGwgam9pbnMgdG8gcmV0dXJuZWQgaW5z\ndGFuY2UKICAgICAgICBTZWxlY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lu\ncyh0aGlzKTsKICAgICAgICBpZiAoajEuam9pbnMoKS5lcXVhbHMoajIuam9p\nbnMoKSkpIHsKICAgICAgICAgICAgc2ouc2V0Sm9pbnMoajEuam9pbnMoKSk7\nCiAgICAgICAgICAgIGoxLm51bGxKb2lucygpOwogICAgICAgICAgICBqMi5u\ndWxsSm9pbnMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBKb2lu\nU2V0IGNvbW1vbkpvaW5zID0gbmV3IEpvaW5TZXQoajEuam9pbnMoKSk7CiAg\nICAgICAgICAgIGNvbW1vbkpvaW5zLnJldGFpbkFsbChqMi5qb2lucygpKTsK\nICAgICAgICAgICAgaWYgKCFjb21tb25Kb2lucy5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgICAgIC8vIHB1dCBjb21tb24gam9pbnMgaW4gcmV0dXJuZWQg\naW5zdGFuY2U7IHJlbW92ZSB0aGVtIGZyb20KICAgICAgICAgICAgICAgIC8v\nIGVhY2ggZ2l2ZW4gaW5zdGFuY2UKICAgICAgICAgICAgICAgIHNqLnNldEpv\naW5zKGNvbW1vbkpvaW5zKTsKICAgICAgICAgICAgICAgIGoxLmpvaW5zKCku\ncmVtb3ZlQWxsKGNvbW1vbkpvaW5zKTsKICAgICAgICAgICAgICAgIGoyLmpv\naW5zKCkucmVtb3ZlQWxsKGNvbW1vbkpvaW5zKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBjb2xsZWN0T3V0ZXJKb2lucyhqMSk7CiAgICAgICAgICAg\nIGNvbGxlY3RPdXRlckpvaW5zKGoyKTsKCiAgICAgICAgICAgIC8vIGlmIG9u\nZSBzaWRlIG9mIHRoZSBvciBjbGF1c2UgaGFzIGRpZmZlcmVudCBqb2lucyB0\naGFuIHRoZSBvdGhlciwKICAgICAgICAgICAgLy8gdGhlbiB3ZSBuZWVkIHRv\nIHVzZSBkaXN0aW5jdAogICAgICAgICAgICBpZiAoIWoxLmlzRW1wdHkoKSB8\nfCAhajIuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IElN\nUExJQ0lUX0RJU1RJTkNUOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2o7\nCiAgICB9CgogICAgcHVibGljIEpvaW5zIG91dGVyKEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgaWYgKF9qb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5U\nQVhfVFJBRElUSU9OQUwgfHwgam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGpvaW5zOwoKICAgICAgICAvLyByZWNvcmQgdGhhdCB0aGlzIGlz\nIGFuIG91dGVyIGpvaW4gc2V0LCBldmVuIGlmIGl0J3MgZW1wdHkKICAgICAg\nICBQYXRoSm9pbnMgcGogPSAoKFBhdGhKb2lucykgam9pbnMpLnNldE91dGVy\nKHRydWUpOwogICAgICAgIGlmIChwai5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybiBwajsKCiAgICAgICAgSm9pbiBqb2luOwogICAgICAgIEpvaW4g\ncmVjOwogICAgICAgIGJvb2xlYW4gaGFzSm9pbnMgPSBfam9pbnMgIT0gbnVs\nbCAmJiBfam9pbnMuam9pbnMoKSAhPSBudWxsOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gcGouam9pbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVf\nSU5ORVIpIHsKICAgICAgICAgICAgICAgIGlmICghaGFzSm9pbnMpCiAgICAg\nICAgICAgICAgICAgICAgam9pbi5zZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7\nCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBy\nZWMgPSBfam9pbnMuam9pbnMoKS5nZXRSZWNvcmRlZEpvaW4oam9pbik7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHJlYyA9PSBudWxsIHx8IHJlYy5nZXRU\neXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAgICAgICAgICAgICAg\nICAgICBqb2luLnNldFR5cGUoSm9pbi5UWVBFX09VVEVSKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gam9pbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBNb3ZlcyB0aGUgam9p\nbnMgZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UgaW50byBvdXIgb3V0ZXIgam9p\nbnMgc2V0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29sbGVjdE91dGVy\nSm9pbnMoUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYgKF9qb2luU3ludGF4\nID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwgfHwgcGogPT0g\nbnVsbAogICAgICAgICAgICB8fCBwai5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAg\nICAgICBfam9pbnMgPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7CgogICAgICAg\nIGJvb2xlYW4gYWRkID0gdHJ1ZTsKICAgICAgICBpZiAoX2pvaW5zLmpvaW5z\nKCkgPT0gbnVsbCkgewogICAgICAgICAgICBfam9pbnMuc2V0Sm9pbnMocGou\nam9pbnMoKSk7CiAgICAgICAgICAgIGFkZCA9IGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgSm9pbiBqb2luOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gcGouam9pbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpIHsK\nICAgICAgICAgICAgICAgIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBu\ndWxsCiAgICAgICAgICAgICAgICAgICAgJiYgIV9kaWN0LmNhbk91dGVySm9p\nbihfam9pblN5bnRheCwgam9pbi5nZXRGb3JlaWduS2V5KCkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgTG9nIGxvZyA9IF9jb25mLmdldExvZyhKREJDQ29u\nZmlndXJhdGlvbi5MT0dfSkRCQyk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZy53YXJuKF9sb2MuZ2V0KCJjYW50LW91dGVyLWZrIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGpvaW4uZ2V0Rm9yZWlnbktleSgpKSk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBqb2lu\nLnNldFR5cGUoSm9pbi5UWVBFX09VVEVSKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoYWRkKQogICAgICAgICAgICAgICAgX2pvaW5zLmpvaW5z\nKCkuYWRkKGpvaW4pOwogICAgICAgIH0KICAgICAgICBwai5udWxsSm9pbnMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9y\nIHRoZSBnaXZlbiB0YWJsZSB1bmRlciB0aGUgZ2l2ZW4gam9pbnMuCiAgICAg\nKiBOT1RFOiBXRSBSRUxZIE9OIFRIRVNFIElOREVYRVMgQkVJTkcgTU9OT1RP\nTklDQUxMWSBJTkNSRUFTSU5HIEZST00gMAogICAgICovCiAgICBwcml2YXRl\nIGludCBnZXRUYWJsZUluZGV4KFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGos\nIGJvb2xlYW4gY3JlYXRlKSB7CiAgICAgICAgLy8gaWYgd2UgaGF2ZSBhIGZy\nb20gc2VsZWN0LCB0aGVuIHRoZXJlIGFyZSBubyB0YWJsZSBhbGlhc2VzCiAg\nICAgICAgaWYgKF9mcm9tICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiAt\nMTsKCiAgICAgICAgT2JqZWN0IGtleSA9IHRhYmxlLmdldEZ1bGxOYW1lKCk7\nCiAgICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwp\nCiAgICAgICAgICAgIGtleSA9IG5ldyBLZXkocGoucGF0aCgpLnRvU3RyaW5n\nKCksIGtleSk7CgogICAgICAgIC8vIGNoZWNrIG91dCBleGlzdGluZyBhbGlh\nc2VzCiAgICAgICAgSW50ZWdlciBpID0gZmluZEFsaWFzKHRhYmxlLCBrZXks\nIGZhbHNlLCBudWxsKTsKICAgICAgICBpZiAoaSAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgICAgIGlmICghY3JlYXRl\nKQogICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAgIC8vIG5vdCBmb3Vu\nZDsgY3JlYXRlIGFsaWFzCiAgICAgICAgaSA9IE51bWJlcnMudmFsdWVPZihh\nbGlhc1NpemUoKSk7CiAgICAgICAgcmVjb3JkVGFibGVBbGlhcyh0YWJsZSwg\na2V5LCBpKTsKICAgICAgICByZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogQXR0ZW1wdCB0byBmaW5kIHRoZSBhbGlhcyBmb3Ig\ndGhlIGdpdmVuIGtleS4KICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVBhcmVu\ndCB3aGV0aGVyIGEgcGFyZW50IGlzIGNoZWNraW5nIGl0cyBzdWJzZWxlY3Rz\nCiAgICAgKiBAcGFyYW0gZnJvbVN1YiB0aGUgc3Vic2VsZWN0IGNoZWNraW5n\nIGl0cyBwYXJlbnQKICAgICAqLwogICAgcHJpdmF0ZSBJbnRlZ2VyIGZpbmRB\nbGlhcyhUYWJsZSB0YWJsZSwgT2JqZWN0IGtleSwgYm9vbGVhbiBmcm9tUGFy\nZW50LAogICAgICAgIFNlbGVjdEltcGwgZnJvbVN1YikgewogICAgICAgIElu\ndGVnZXIgYWxpYXMgPSBudWxsOwogICAgICAgIGlmIChfYWxpYXNlcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGFsaWFzID0gKEludGVnZXIpICgoZnJvbVBh\ncmVudCkgPyBfYWxpYXNlcy5yZW1vdmUoa2V5KQogICAgICAgICAgICAgICAg\nOiBfYWxpYXNlcy5nZXQoa2V5KSk7CiAgICAgICAgICAgIGlmIChhbGlhcyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZnJvbVBhcmVudCkKICAg\nICAgICAgICAgICAgICAgICBfdGFibGVzLnJlbW92ZShhbGlhcyk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgaWYgKCFmcm9tUGFyZW50ICYmIF9wYXJlbnQgIT0gbnVs\nbCkgewogICAgICAgICAgICBib29sZWFuIHJlbW92ZUFsaWFzRnJvbVBhcmVu\ndCA9IGtleS50b1N0cmluZygpLmluZGV4T2YoIjoiKSAhPSAtMTsKICAgICAg\nICAgICAgYWxpYXMgPSBfcGFyZW50LmZpbmRBbGlhcyh0YWJsZSwga2V5LCBy\nZW1vdmVBbGlhc0Zyb21QYXJlbnQsIHRoaXMpOwogICAgICAgICAgICBpZiAo\nYWxpYXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHJlbW92ZUFs\naWFzRnJvbVBhcmVudCkgewogICAgICAgICAgICAgICAgICAgIHJlY29yZFRh\nYmxlQWxpYXModGFibGUsIGtleSwgYWxpYXMpOwogICAgICAgICAgICAgICAg\nICAgIF9yZW1vdmVkQWxpYXNGcm9tUGFyZW50LnNldChhbGlhcy5pbnRWYWx1\nZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVy\nbiBhbGlhczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAo\nX3N1YnNlbHMgIT0gbnVsbCkgewogICAgICAgICAgICBTZWxlY3RJbXBsIHN1\nYjsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfc3Vic2Vscy5z\naXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgc3ViID0gKFNlbGVjdElt\ncGwpIF9zdWJzZWxzLmdldChpKTsKICAgICAgICAgICAgICAgIGlmIChzdWIg\nPT0gZnJvbVN1YikKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgICAgIGlmIChhbGlhcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHN1Yi5fYWxpYXNlcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICBzdWIuX2FsaWFzZXMucmVtb3ZlKGtleSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHN1Yi5fdGFibGVzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHN1Yi5fdGFibGVzLnJlbW92ZShhbGlhcyk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIGlmIChrZXkgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgYWxpYXMgPSBzdWIuZmluZEFsaWFzKHRhYmxlLCBrZXksIHRy\ndWUsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZyb21Q\nYXJlbnQgJiYgYWxpYXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHJlY29yZFRhYmxlQWxpYXModGFibGUsIGtleSwgYWxpYXMpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYWxpYXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIG1hcHBpbmcgb2YgdGhlIGdp\ndmVuIGtleSB0byB0aGUgZ2l2ZW4gYWxpYXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCByZWNvcmRUYWJsZUFsaWFzKFRhYmxlIHRhYmxlLCBPYmplY3Qg\na2V5LCBJbnRlZ2VyIGFsaWFzKSB7CiAgICAgICAgaWYgKF9hbGlhc2VzID09\nIG51bGwpCiAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhhc2hNYXAoKTsK\nICAgICAgICBfYWxpYXNlcy5wdXQoa2V5LCBhbGlhcyk7CgogICAgICAgIFN0\ncmluZyB0YWJsZVN0cmluZyA9IF9kaWN0LmdldEZ1bGxOYW1lKHRhYmxlLCBm\nYWxzZSkgKyAiICIKICAgICAgICAgICAgKyB0b0FsaWFzKGFsaWFzLmludFZh\nbHVlKCkpOwogICAgICAgIGlmIChfdGFibGVzID09IG51bGwpCiAgICAgICAg\nICAgIF90YWJsZXMgPSBuZXcgVHJlZU1hcCgpOwogICAgICAgIF90YWJsZXMu\ncHV0KGFsaWFzLCB0YWJsZVN0cmluZyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDYWxjdWxhdGUgdG90YWwgbnVtYmVyIG9mIGFsaWFzZXMuCiAgICAgKi8K\nICAgIHByaXZhdGUgaW50IGFsaWFzU2l6ZSgpIHsKICAgICAgICByZXR1cm4g\nYWxpYXNTaXplKGZhbHNlLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENhbGN1bGF0ZSB0b3RhbCBudW1iZXIgb2YgYWxpYXNlcy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gZnJvbVBhcmVudCB3aGV0aGVyIGEgcGFyZW50IGlzIGNo\nZWNraW5nIGl0cyBzdWJzZWxlY3RzCiAgICAgKiBAcGFyYW0gZnJvbVN1YiB0\naGUgc3Vic2VsZWN0IGNoZWNraW5nIGl0cyBwYXJlbnQKICAgICAqLwogICAg\ncHJpdmF0ZSBpbnQgYWxpYXNTaXplKGJvb2xlYW4gZnJvbVBhcmVudCwgU2Vs\nZWN0SW1wbCBmcm9tU3ViKSB7CiAgICAgICAgaW50IGFsaWFzZXMgPSAoZnJv\nbVBhcmVudCB8fCBfcGFyZW50ID09IG51bGwpID8gMAogICAgICAgICAgICA6\nIF9wYXJlbnQuYWxpYXNTaXplKGZhbHNlLCB0aGlzKTsKICAgICAgICBhbGlh\nc2VzICs9IChfYWxpYXNlcyA9PSBudWxsKSA/IDAgOiBfYWxpYXNlcy5zaXpl\nKCk7CiAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwpIHsKICAgICAgICAg\nICAgU2VsZWN0SW1wbCBzdWI7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAg\nIHN1YiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaSk7CiAgICAgICAg\nICAgICAgICBpZiAoc3ViICE9IGZyb21TdWIpCiAgICAgICAgICAgICAgICAg\nICAgYWxpYXNlcyArPSBzdWIuYWxpYXNTaXplKHRydWUsIG51bGwpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbGlhc2VzOwog\nICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAg\ncmV0dXJuIHRvU2VsZWN0KGZhbHNlLCBudWxsKS5nZXRTUUwoKTsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQYXRo\nSm9pbnMgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgUGF0aEpvaW5z\nIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICByZXR1cm4gbmV3\nIFNlbGVjdEpvaW5zKHRoaXMpLnNldE91dGVyKHRydWUpOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdCdWZmZXIgcGF0aCgpIHsK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgSm9pblNl\ndCBqb2lucygpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IGpvaW5Db3VudCgpIHsKICAgICAgICByZXR1cm4gMDsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxv\nY2FsVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgIHJldHVy\nbiBuZXcgU2VsZWN0Sm9pbnModGhpcykuY3Jvc3NKb2luKGxvY2FsVGFibGUs\nIGZvcmVpZ25UYWJsZSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW4o\nRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFu\neSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuam9p\nbihmaywgaW52ZXJzZSwgdG9NYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9p\nbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwg\nYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpv\naW5zKHRoaXMpLm91dGVySm9pbihmaywgaW52ZXJzZSwgdG9NYW55KTsKICAg\nIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1l\nLCBGb3JlaWduS2V5IGZrLCBDbGFzc01hcHBpbmcgdGFyZ2V0LAogICAgICAg\nIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5qb2luUmVs\nYXRpb24obmFtZSwgZmssIHRhcmdldCwgc3VicywgCiAgICAgICAgICAgIGlu\ndmVyc2UsIHRvTWFueSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG91dGVy\nSm9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCAKICAg\nICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBp\nbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgIHJldHVybiBuZXcg\nU2VsZWN0Sm9pbnModGhpcykub3V0ZXJKb2luUmVsYXRpb24obmFtZSwgZmss\nIHRhcmdldCwgc3VicywgCiAgICAgICAgICAgIGludmVyc2UsIHRvTWFueSk7\nCiAgICB9CgogICAgcHVibGljIEpvaW5zIHNldFZhcmlhYmxlKFN0cmluZyB2\nYXIpIHsKICAgICAgICBpZiAodmFyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhp\ncykuc2V0VmFyaWFibGUodmFyKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMg\nc2V0U3Vic2VsZWN0KFN0cmluZyBhbGlhcykgewogICAgICAgIGlmIChhbGlh\ncyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICBy\nZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLnNldFN1YnNlbGVjdChhbGlh\ncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIGEgU1FMIHN0\ncmluZyBzZWxlY3RlZCB3aXRoIG51bGwgaWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIE51bGxJZCB7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXByZXNlbnRzIGEgcGxhY2Vob2xkZXIgU1FMIHN0cmluZy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUGxhY2Vob2xkZXIgewogICAg\nfQoKICAgIC8qKgogICAgICogS2V5IHR5cGUgdXNlZCBmb3IgYWxpYXNlcy4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgS2V5IHsKCiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX3BhdGg7CiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBPYmplY3QgX2tleTsKCiAgICAgICAgcHVibGljIEtleShTdHJp\nbmcgcGF0aCwgT2JqZWN0IGtleSkgewogICAgICAgICAgICBfcGF0aCA9IHBh\ndGg7CiAgICAgICAgICAgIF9rZXkgPSBrZXk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICByZXR1cm4g\nX3BhdGguaGFzaENvZGUoKSBeIF9rZXkuaGFzaENvZGUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIp\nIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKG90aGVyLmdldENs\nYXNzKCkgIT0gZ2V0Q2xhc3MoKSkKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgS2V5IGsgPSAoS2V5KSBvdGhlcjsKICAgICAg\nICAgICAgcmV0dXJuIGsuX3BhdGguZXF1YWxzKF9wYXRoKSAmJiBrLl9rZXku\nZXF1YWxzKF9rZXkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIF9wYXRoICsgInwi\nICsgX2tleTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBIHtA\nbGluayBSZXN1bHR9IGltcGxlbWVudGF0aW9uIHdyYXBwZWQgYXJvdW5kIHRo\naXMgc2VsZWN0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFNl\nbGVjdFJlc3VsdAogICAgICAgIGV4dGVuZHMgUmVzdWx0U2V0UmVzdWx0CiAg\nICAgICAgaW1wbGVtZW50cyBQYXRoSm9pbnMgewoKICAgICAgICBwcml2YXRl\nIFNlbGVjdEltcGwgX3NlbCA9IG51bGw7CgogICAgICAgIC8vIHBvc2l0aW9u\nIGluIHNlbGVjdGVkIGNvbHVtbnMgbGlzdCB3aGVyZSB3ZSBleHBlY3QgdGhl\nIG5leHQgbG9hZAogICAgICAgIHByaXZhdGUgaW50IF9wb3MgPSAwOwogICAg\nICAgIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAgICAg\nLyoqCiAgICAgICAgICogQ29uc3RydWN0b3IuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIFNlbGVjdFJlc3VsdChDb25uZWN0aW9uIGNvbm4sIFN0YXRl\nbWVudCBzdG1udCwgUmVzdWx0U2V0IHJzLAogICAgICAgICAgICBEQkRpY3Rp\nb25hcnkgZGljdCkgewogICAgICAgICAgICBzdXBlcihjb25uLCBzdG1udCwg\ncnMsIGRpY3QpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nU2VsZWN0IGZvciB0aGlzIHJlc3VsdC4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgU2VsZWN0SW1wbCBnZXRTZWxlY3QoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfc2VsOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nU2VsZWN0IGZvciB0aGlzIHJlc3VsdC4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgdm9pZCBzZXRTZWxlY3QoU2VsZWN0SW1wbCBzZWwpIHsKICAgICAg\nICAgICAgX3NlbCA9IHNlbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBP\nYmplY3QgZ2V0RWFnZXIoRmllbGRNYXBwaW5nIGtleSkgewogICAgICAgICAg\nICAvLyBkb24ndCBib3RoZXIgY3JlYXRpbmcga2V5IGlmIHdlIGtub3cgd2Ug\nZG9uJ3QgaGF2ZSBhbnkKICAgICAgICAgICAgLy8gZWFnZXIgcmVzdWx0cwog\nICAgICAgICAgICBpZiAoX3NlbC5fZWFnZXIgPT0gbnVsbCB8fCAhX3NlbC5f\nZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICAgICAgTWFwIG1hcCA9IFNlbGVjdFJlc3VsdC50\naGlzLmdldEVhZ2VyTWFwKHRydWUpOwogICAgICAgICAgICBpZiAobWFwID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAg\nICAgcmV0dXJuIG1hcC5nZXQoX3NlbC50b0VhZ2VyS2V5KGtleSwgZ2V0Sm9p\nbnMobnVsbCkpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHB1\ndEVhZ2VyKEZpZWxkTWFwcGluZyBrZXksIE9iamVjdCByZXMpIHsKICAgICAg\nICAgICAgTWFwIG1hcCA9IFNlbGVjdFJlc3VsdC50aGlzLmdldEVhZ2VyTWFw\nKHRydWUpOwogICAgICAgICAgICBpZiAobWFwID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIG1hcCA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAg\nICBzZXRFYWdlck1hcChtYXApOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIG1hcC5wdXQoX3NlbC50b0VhZ2VyS2V5KGtleSwgZ2V0Sm9pbnMobnVsbCkp\nLCByZXMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBsb2Fk\nKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDU3RvcmUgc3RvcmUsCiAgICAg\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEpvaW5zIGpv\naW5zKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgYm9vbGVhbiBoYXNKb2lucyA9IGpvaW5zICE9IG51bGwKICAgICAg\nICAgICAgICAgICYmICgoUGF0aEpvaW5zKSBqb2lucykucGF0aCgpICE9IG51\nbGw7CiAgICAgICAgICAgIGlmIChoYXNKb2lucykgewogICAgICAgICAgICAg\nICAgaWYgKF9wcmVKb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF9wcmVKb2lucyA9IG5ldyBTdGFjaygpOwogICAgICAgICAgICAgICAgX3By\nZUpvaW5zLnB1c2goam9pbnMpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBPYmplY3Qgb2JqID0gc3VwZXIubG9hZChtYXBwaW5nLCBzdG9yZSwgZmV0\nY2gsIGpvaW5zKTsKCiAgICAgICAgICAgIC8vIHJlc2V0CiAgICAgICAgICAg\nIGlmIChoYXNKb2lucykKICAgICAgICAgICAgICAgIF9wcmVKb2lucy5wb3Ao\nKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBKb2lucyBuZXdKb2lucygpIHsKICAgICAgICAgICAgUGF0aEpv\naW5zIHByZSA9IGdldFByZUpvaW5zKCk7CiAgICAgICAgICAgIGlmIChwcmUg\nPT0gbnVsbCB8fCBwcmUucGF0aCgpID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKCiAgICAgICAgICAgIFBhdGhKb2luc0ltcGwgcGog\nPSBuZXcgUGF0aEpvaW5zSW1wbCgpOwogICAgICAgICAgICBwai5wYXRoID0g\nbmV3IFN0cmluZ0J1ZmZlcihwcmUucGF0aCgpLnRvU3RyaW5nKCkpOwogICAg\nICAgICAgICByZXR1cm4gcGo7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0\nZWQgYm9vbGVhbiBjb250YWluc0ludGVybmFsKE9iamVjdCBvYmosIEpvaW5z\nIGpvaW5zKSB7CiAgICAgICAgICAgIC8vIHdlIGtleSBkaXJlY3RseSBvbiBv\nYmpzIGFuZCBqb2luLWxlc3MgY29scywgb3Igb24gdGhlIGFsaWFzCiAgICAg\nICAgICAgIC8vIGZvciBjb2xzIHdpdGggam9pbnMKICAgICAgICAgICAgUGF0\naEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBpZiAo\ncGogIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIG9iaiA9IGdldENvbHVtbkFsaWFzKChDb2x1bW4pIG9iaiwgcGopOwog\nICAgICAgICAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgX3NlbC5fc2VsZWN0\ncy5jb250YWlucyhvYmopOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVk\nIGJvb2xlYW4gY29udGFpbnNBbGxJbnRlcm5hbChPYmplY3RbXSBvYmpzLCBK\nb2lucyBqb2lucykKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsK\nICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBvYmpzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBvYmogPSBnZXRDb2x1bW5BbGlhcygoQ29sdW1uKSBv\nYmpzW2ldLCBwaik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgb2JqID0gb2Jqc1tpXTsKICAgICAgICAgICAgICAgIGlmIChv\nYmogPT0gbnVsbCB8fCAhX3NlbC5fc2VsZWN0cy5jb250YWlucyhvYmopKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHB1c2hCYWNrKCkKICAgICAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9wb3MgPSAwOwogICAgICAgICAg\nICBzdXBlci5wdXNoQmFjaygpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIGJvb2xlYW4gYWJzb2x1dGVJbnRlcm5hbChpbnQgcm93KQogICAgICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9\nIDA7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5hYnNvbHV0ZUludGVybmFs\nKHJvdyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBu\nZXh0SW50ZXJuYWwoKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAgIHJldHVybiBz\ndXBlci5uZXh0SW50ZXJuYWwoKTsKICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBpbnQgZmluZE9iamVjdChPYmplY3Qgb2JqLCBKb2lucyBqb2lucykK\nICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIGlmIChfcG9zID09IF9zZWwuX3NlbGVjdHMuc2l6ZSgpKQogICAgICAgICAg\nICAgICAgX3BvcyA9IDA7CgogICAgICAgICAgICAvLyB3ZSBrZXkgZGlyZWN0\nbHkgb24gb2JqcyBhbmQgam9pbi1sZXNzIGNvbHMsIG9yIG9uIHRoZSBhbGlh\ncwogICAgICAgICAgICAvLyBmb3IgY29scyB3aXRoIGpvaW5zCiAgICAgICAg\nICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAg\nICAgQm9vbGVhbiBwayA9IG51bGw7CiAgICAgICAgICAgIGlmIChwaiAhPSBu\ndWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBD\nb2x1bW4gY29sID0gKENvbHVtbikgb2JqOwogICAgICAgICAgICAgICAgcGsg\nPSAoY29sLmlzUHJpbWFyeUtleSgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgICAgICAgICBvYmogPSBnZXRDb2x1bW5BbGlh\ncyhjb2wsIHBqKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGNv\nbC5nZXRUYWJsZSgpICsgIjogIgogICAgICAgICAgICAgICAgICAgICAgICAr\nIHBqLnBhdGgoKSArICIgKCIgKyBfc2VsLl9hbGlhc2VzICsgIikiKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gd2UgbG9hZCBpbiB0aGUgc2Ft\nZSBvcmRlciB3ZSBzZWxlY3QsIG1vcmUgb3IgbGVzcy4uLgogICAgICAgICAg\nICBpZiAoX3NlbC5fc2VsZWN0cy5nZXQoX3BvcykuZXF1YWxzKG9iaikpCiAg\nICAgICAgICAgICAgICByZXR1cm4gKytfcG9zOwoKICAgICAgICAgICAgLy8g\naWYgd2UncmUgbG9va2luZyBmb3IgYSBwcmltYXJ5IGtleSwgdHJ5IGJhY2sg\nYSBjb3VwbGUgcGxhY2VzLAogICAgICAgICAgICAvLyBzaW5jZSBwa3MgbWln\naHQgYmUgc2VsZWN0ZWQgaW4gYSBzbGlnaHRseSBkaWZmZXJlbnQgb3JkZXIg\ndGhhbgogICAgICAgICAgICAvLyB0aGV5IGFyZSBsb2FkZWQgYmFjazsgZG9u\nJ3QgY2hhbmdlIHRoZSBtYXJrZXIgcG9zaXRpb24KICAgICAgICAgICAgaWYg\nKHBrID09IG51bGwpCiAgICAgICAgICAgICAgICBwayA9IChvYmogaW5zdGFu\nY2VvZiBDb2x1bW4gJiYgKChDb2x1bW4pIG9iaikuaXNQcmltYXJ5S2V5KCkp\nCiAgICAgICAgICAgICAgICAgICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgICAgICAgICBpZiAocGsuYm9vbGVhblZhbHVlKCkpIHsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSBfcG9zIC0gMTsgaSA+PSAw\nICYmIGkgPj0gX3BvcyAtIDM7IGktLSkKICAgICAgICAgICAgICAgICAgICBp\nZiAoX3NlbC5fc2VsZWN0cy5nZXQoaSkuZXF1YWxzKG9iaikpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBpICsgMTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gc2VhcmNoIGZvcndhcmQgb24gdGhlIGFzc3VtcHRp\nb24gdGhhdCB3ZSBtaWdodCBiZSBza2lwcGluZwogICAgICAgICAgICAvLyBz\nZWxlY3RzIGZvciBzaWJsaW5nIGNsYXNzZXM7IGFkdmFuY2UgdGhlIHBvc2l0\naW9uIGlmIHdlIGZpbmQKICAgICAgICAgICAgLy8gc29tZXRoaW5nIGZvcndh\ncmQKICAgICAgICAgICAgZm9yIChpbnQgaSA9IF9wb3MgKyAxOyBpIDwgX3Nl\nbC5fc2VsZWN0cy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKF9zZWwuX3NlbGVjdHMuZ2V0KGkpLmVxdWFscyhvYmopKSB7CiAgICAgICAg\nICAgICAgICAgICAgX3BvcyA9IGk7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuICsrX3BvczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gbWF5YmUgdGhlIGNvbHVtbiB3YXMgc2VsZWN0ZWQg\nYnkgMiBkaWZmZXJlbnQgbWFwcGluZ3MsIHNvIGl0J3MKICAgICAgICAgICAg\nLy8gc29tZXdoZXJlIHByaW9yIHRvIHRoZSBjdXJyZW50IHBvc2l0aW9uOyBp\nbiB0aGlzIGNhc2UgbGVhdmUgdGhlCiAgICAgICAgICAgIC8vIHBvc2l0aW9u\nIG1hcmtlciBhdCBpdHMgY3VycmVudCBwbGFjZSBjYXVzZSBzdWJzZXF1ZW50\nIGxvYWRzIHdpbGwKICAgICAgICAgICAgLy8gc3RpbGwgcHJvYmFibHkgc3Rh\ncnQgZnJvbSB0aGVyZQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIF9wb3M7IGkrKykKICAgICAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3Rz\nLmdldChpKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gaSArIDE7CgogICAgICAgICAgICAvLyBzb21ldGhpbmdzJ3Mgd3Jvbmcu\nLi4KICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihvYmoudG9T\ndHJpbmcoKSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBS\nZXR1cm4gdGhlIGpvaW5zIHRvIHVzZSB0byBmaW5kIGNvbHVtbiBkYXRhLgog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgUGF0aEpvaW5zIGdldEpvaW5z\nKEpvaW5zIGpvaW5zKSB7CiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9IChQ\nYXRoSm9pbnMpIGpvaW5zOwogICAgICAgICAgICBpZiAocGogIT0gbnVsbCAm\nJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBw\najsKICAgICAgICAgICAgcmV0dXJuIGdldFByZUpvaW5zKCk7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIHByZSBqb2lu\ncyBmb3IgdGhlIHJlc3VsdCwgb3IgbnVsbCBpZiBub25lLiBOb3RlIHRoYXQK\nICAgICAgICAgKiB3ZSBoYXZlIHRvIHRha2UgdGhlIFNlbGVjdCdzIHByZSBq\nb2lucyBpbnRvIGFjY291bnQgdG9vLCBzaW5jZQogICAgICAgICAqIGJhdGNo\nZWQgc2VsZWN0cyBjYW4gaGF2ZSBhZGRpdGlvbmFsIHByZSBqb2lucyBvbiB0\naGUgc3RhY2sgZXZlbgogICAgICAgICAqIG9uIGV4ZWN1dGlvbi4KICAgICAg\nICAgKi8KICAgICAgICBwcml2YXRlIFBhdGhKb2lucyBnZXRQcmVKb2lucygp\nIHsKICAgICAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxsICYmICFfcHJl\nSm9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIChQYXRo\nSm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7CiAgICAgICAgICAgIGlmIChfc2Vs\nLl9wcmVKb2lucyAhPSBudWxsICYmICFfc2VsLl9wcmVKb2lucy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gKFBhdGhKb2lucykgX3NlbC5f\ncHJlSm9pbnMucGVlaygpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgYWxp\nYXMgdXNlZCB0byBrZXkgb24gdGhlIGNvbHVtbiBkYXRhLCBjb25zaWRlcmlu\nZyB0aGUKICAgICAgICAgKiBnaXZlbiBqb2lucy4KICAgICAgICAgKi8KICAg\nICAgICBwcml2YXRlIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29s\nLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzOwog\nICAgICAgICAgICBpZiAoX3NlbC5fZnJvbSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBhbGlhcyA9IF9zZWwudG9BbGlhcyhfc2VsLl9mcm9tLmdldFRh\nYmxlSW5kZXgKICAgICAgICAgICAgICAgICAgICAoY29sLmdldFRhYmxlKCks\nIHBqLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgaWYgKGFsaWFzID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nICAgICAgICBpZiAoX3NlbC5fZGljdC5yZXF1aXJlc0FsaWFzRm9yU3Vic2Vs\nZWN0KQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGUk9NX1NFTEVDVF9B\nTElBUyArICIuIiArIGFsaWFzICsgIl8iICsgY29sOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGFsaWFzICsgIl8iICsgY29sOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGFsaWFzID0gX3NlbC50b0FsaWFzKF9zZWwuZ2V0VGFibGVJ\nbmRleChjb2wuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSk7CiAgICAgICAgICAg\nIHJldHVybiAoYWxpYXMgPT0gbnVsbCkgPyBudWxsIDogYWxpYXMgKyAiLiIg\nKyBjb2w7CiAgICAgICAgfQoKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCiAgICAgICAgLy8gUGF0aEpvaW5zIGltcGxlbWVudGF0aW9u\nCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUGF0aEpvaW5z\nIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Rp\ncnR5KCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgoKSB7CiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpv\naW5TZXQgam9pbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBqb2luQ291bnQoKSB7CiAgICAg\nICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgbnVsbEpvaW5zKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxl\nIGxvY2FsVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\ncyBqb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVh\nbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkg\nZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZr\nLCAKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMs\nIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBQYXRoSm9pbnNJbXBsKCkuam9pblJlbGF0aW9uKG5h\nbWUsIGZrLCB0YXJnZXQsIHN1YnMsIAogICAgICAgICAgICAgICAgaW52ZXJz\nZSwgdG9NYW55KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBv\ndXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywK\nICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJv\nb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBQYXRoSm9pbnNJbXBsKCkub3V0ZXJKb2luUmVsYXRpb24o\nbmFtZSwgZmssIHRhcmdldCwgc3VicywKICAgICAgICAgICAgICAgIGludmVy\nc2UsIHRvTWFueSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMg\nc2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewogICAgICAgICAgICBpZiAodmFy\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBQYXRoSm9pbnNJbXBsKCkuc2V0VmFyaWFibGUo\ndmFyKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRTdWJz\nZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgICAgIGlmIChhbGlhcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLnNldFN1YnNlbGVjdChh\nbGlhcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQmFzZSBq\nb2lucyBpbXBsZW1lbnRhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgUGF0aEpvaW5zSW1wbAogICAgICAgIGltcGxlbWVudHMgUGF0\naEpvaW5zIHsKCiAgICAgICAgcHJvdGVjdGVkIFN0cmluZ0J1ZmZlciBwYXRo\nID0gbnVsbDsKICAgICAgICBwcm90ZWN0ZWQgU3RyaW5nIHZhciA9IG51bGw7\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBQ\nYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcikgewogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzRGlydHkoKSB7CiAgICAgICAgICAgIHJldHVybiB2YXIgIT0gbnVs\nbCB8fCBwYXRoICE9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nQnVmZmVyIHBhdGgoKSB7CiAgICAgICAgICAgIHJldHVybiBwYXRo\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5TZXQgam9pbnMoKSB7\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiAw\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkg\newogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldFZhcmlhYmxl\nKFN0cmluZyB2YXIpIHsKICAgICAgICAgICAgdGhpcy52YXIgPSB2YXI7CiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIHNldFN1YnNlbGVjdChTdHJpbmcgYWxpYXMpIHsKICAgICAg\nICAgICAgaWYgKCFhbGlhcy5lbmRzV2l0aCgiOiIpKQogICAgICAgICAgICAg\nICAgYWxpYXMgKz0gJzonOwogICAgICAgICAgICBhcHBlbmQoYWxpYXMpOwog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9p\nbihUYWJsZSBsb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAg\nICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7\nCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIEpvaW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZl\ncnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBhcHBlbmQodmFy\nKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJK\nb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0\nb01hbnkpIHsKICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAg\nIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcg\nbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAgICAgICAgIENsYXNzTWFwcGlu\nZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4g\ndG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVuZChuYW1lKTsKICAgICAgICAg\nICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWdu\nS2V5IGZrLAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQg\nc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAg\nICAgICAgICBhcHBlbmQobmFtZSk7CiAgICAgICAgICAgIGFwcGVuZCh2YXIp\nOwogICAgICAgICAgICB2YXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIGFwcGVu\nZChTdHJpbmcgc3RyKSB7CiAgICAgICAgICAgIGlmIChzdHIgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgaWYgKHBhdGggPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBwYXRoID0gbmV3IFN0cmluZ0J1ZmZlcihzdHIpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHBhdGguYXBw\nZW5kKCcuJykuYXBwZW5kKHN0cik7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAg\nICAgIHJldHVybiAiUGF0aEpvaW5zSW1wbDwiICsgaGFzaENvZGUoKSArICI+\nOiAiCiAgICAgICAgICAgICAgICArIFN0cmluZy52YWx1ZU9mKHBhdGgpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEpvaW5zIGltcGxlbWVu\ndGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTZWxl\nY3RKb2lucwogICAgICAgIGV4dGVuZHMgUGF0aEpvaW5zSW1wbCAKICAgICAg\nICBpbXBsZW1lbnRzIENsb25lYWJsZSB7CgogICAgICAgIHByaXZhdGUgZmlu\nYWwgU2VsZWN0SW1wbCBfc2VsOwogICAgICAgIHByaXZhdGUgSm9pblNldCBf\nam9pbnMgPSBudWxsOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfb3V0ZXIg\nPSBmYWxzZTsKICAgICAgICBwcml2YXRlIGludCBfY291bnQgPSAwOwoKICAg\nICAgICBwdWJsaWMgU2VsZWN0Sm9pbnMoU2VsZWN0SW1wbCBzZWwpIHsKICAg\nICAgICAgICAgX3NlbCA9IHNlbDsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBfb3V0\nZXI7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91\ndGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAgICAgX291dGVyID0gb3V0\nZXI7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmlzRGlydHkoKSB8fCAhaXNFbXB0eSgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5TZXQgam9pbnMoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfam9pbnM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBzZXRKb2lucyhKb2luU2V0IGpvaW5zKSB7CiAgICAgICAgICAgIF9qb2lu\ncyA9IGpvaW5zOwogICAgICAgICAgICBfb3V0ZXIgPSBqb2lucyAhPSBudWxs\nICYmIGpvaW5zLmxhc3QoKSAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBq\nb2lucy5sYXN0KCkuZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9PVVRFUjsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAg\nICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gX2NvdW50OwogICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoX2Nv\ndW50LCBfam9pbnMuc2l6ZSgpKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIG51bGxKb2lucygpIHsKICAgICAgICAgICAgaWYgKF9qb2lucyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2NvdW50ID0gTWF0aC5tYXgoX2Nv\ndW50LCBfam9pbnMuc2l6ZSgpKTsKICAgICAgICAgICAgX2pvaW5zID0gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHko\nKSB7CiAgICAgICAgICAgIHJldHVybiBfam9pbnMgPT0gbnVsbCB8fCBfam9p\nbnMuaXNFbXB0eSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5z\nIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFi\nbGUpIHsKICAgICAgICAgICAgLy8gY3Jvc3Mgam9pbnMgYXJlIGZvciB1bmJv\ndW5kIHZhcmlhYmxlczsgdW5mb3J0dW5hdGVseSB3ZSBoYXZlCiAgICAgICAg\nICAgIC8vIHRvIGFsd2F5cyBnbyBESVNUSU5DVCBmb3IgdW5ib3VuZCB2YXJz\nIGJlY2F1c2UgdGhlcmUgYXJlIGNlcnRhaW4KICAgICAgICAgICAgLy8gY2Fz\nZXMgdGhhdCByZXF1aXJlIGl0LCBhbmQgd2UgY2FuJ3QgZGlmZmVyZW50aWF0\nZSB0aGVtIGZyb20gdGhlCiAgICAgICAgICAgIC8vIGNhc2VzIHRoYXQgZG9u\nJ3QKICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0gSU1QTElDSVRfRElTVElO\nQ1Q7CgogICAgICAgICAgICBpZiAoX3NlbC5nZXRKb2luU3ludGF4KCkgIT0g\nSm9pblN5bnRheGVzLlNZTlRBWF9TUUw5MgogICAgICAgICAgICAgICAgfHwg\nX3NlbC5fZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBkb24n\ndCBtYWtlIGFueSBqb2lucywgYnV0IHVwZGF0ZSB0aGUgcGF0aCBpZiBhIHZh\ncmlhYmxlCiAgICAgICAgICAgICAgICAvLyBoYXMgYmVlbiBzZXQKICAgICAg\nICAgICAgICAgIHRoaXMuYXBwZW5kKHRoaXMudmFyKTsKICAgICAgICAgICAg\nICAgIHRoaXMudmFyID0gbnVsbDsKICAgICAgICAgICAgICAgIF9vdXRlciA9\nIGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGRvbid0IGxldCB0aGUgZ2V0IGFsaWFz\nIG1ldGhvZHMgc2VlIHRoYXQgYSB2YXIgaGFzIGJlZW4gc2V0CiAgICAgICAg\nICAgIC8vIHVudGlsIHdlIGdldCBwYXN0IHRoZSBsb2NhbCB0YWJsZQogICAg\nICAgICAgICBTdHJpbmcgdmFyID0gdGhpcy52YXI7CiAgICAgICAgICAgIHRo\naXMudmFyID0gbnVsbDsKCiAgICAgICAgICAgIGludCBhbGlhczEgPSBfc2Vs\nLmdldFRhYmxlSW5kZXgobG9jYWxUYWJsZSwgdGhpcywgdHJ1ZSk7CiAgICAg\nICAgICAgIHRoaXMuYXBwZW5kKHZhcik7CiAgICAgICAgICAgIGludCBhbGlh\nczIgPSBfc2VsLmdldFRhYmxlSW5kZXgoZm9yZWlnblRhYmxlLCB0aGlzLCB0\ncnVlKTsKICAgICAgICAgICAgSm9pbiBqID0gbmV3IEpvaW4obG9jYWxUYWJs\nZSwgYWxpYXMxLCBmb3JlaWduVGFibGUsIGFsaWFzMiwKICAgICAgICAgICAg\nICAgIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgai5zZXRUeXBlKEpvaW4u\nVFlQRV9DUk9TUyk7CgogICAgICAgICAgICBpZiAoX2pvaW5zID09IG51bGwp\nCiAgICAgICAgICAgICAgICBfam9pbnMgPSBuZXcgSm9pblNldCgpOwogICAg\nICAgICAgICBfam9pbnMuYWRkKGopOwogICAgICAgICAgICBfb3V0ZXIgPSBm\nYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFu\nIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVy\nbiBqb2luKG51bGwsIGZrLCBudWxsLCAtMSwgaW52ZXJzZSwgdG9NYW55LCBm\nYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJK\nb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0\nb01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4obnVsbCwgZmssIG51\nbGwsIC0xLCBpbnZlcnNlLCB0b01hbnksIHRydWUpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwg\nRm9yZWlnbktleSBmaywgCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJn\nZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55\nKSB7CiAgICAgICAgICAgIHJldHVybiBqb2luKG5hbWUsIGZrLCB0YXJnZXQs\nIHN1YnMsIGludmVyc2UsIHRvTWFueSwgZmFsc2UpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBu\nYW1lLCBGb3JlaWduS2V5IGZrLAogICAgICAgICAgICBDbGFzc01hcHBpbmcg\ndGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRv\nTWFueSkgewogICAgICAgICAgICByZXR1cm4gam9pbihuYW1lLCBmaywgdGFy\nZ2V0LCBzdWJzLCBpbnZlcnNlLCB0b01hbnksIHRydWUpOwogICAgICAgIH0K\nCiAgICAgICAgcHJpdmF0ZSBKb2lucyBqb2luKFN0cmluZyBuYW1lLCBGb3Jl\naWduS2V5IGZrLCBDbGFzc01hcHBpbmcgdGFyZ2V0LAogICAgICAgICAgICBp\nbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSwgYm9v\nbGVhbiBvdXRlcikgewogICAgICAgICAgICAvLyBkb24ndCBsZXQgdGhlIGdl\ndCBhbGlhcyBtZXRob2RzIHNlZSB0aGF0IGEgdmFyIGhhcyBiZWVuIHNldAog\nICAgICAgICAgICAvLyB1bnRpbCB3ZSBnZXQgcGFzdCB0aGUgbG9jYWwgdGFi\nbGUKICAgICAgICAgICAgU3RyaW5nIHZhciA9IHRoaXMudmFyOwogICAgICAg\nICAgICB0aGlzLnZhciA9IG51bGw7CgogICAgICAgICAgICAvLyBnZXQgZmly\nc3QgdGFibGUgYWxpYXMgYmVmb3JlIHVwZGF0aW5nIHBhdGg7IGlmIHRoZXJl\nIGlzIGEgZnJvbQogICAgICAgICAgICAvLyBzZWxlY3QgdGhlbiB3ZSBzaG91\nbGRuJ3QgYWN0dWFsbHkgY3JlYXRlIGEgam9pbiBvYmplY3QsIHNpbmNlCiAg\nICAgICAgICAgIC8vIHRoZSBqb2lucyB3aWxsIGFsbCBiZSBkb25lIGluIHRo\nZSBmcm9tIHNlbGVjdAogICAgICAgICAgICBib29sZWFuIGNyZWF0ZUpvaW4g\nPSBfc2VsLl9mcm9tID09IG51bGw7CiAgICAgICAgICAgIFRhYmxlIHRhYmxl\nMSA9IG51bGw7CiAgICAgICAgICAgIGludCBhbGlhczEgPSAtMTsKICAgICAg\nICAgICAgaWYgKGNyZWF0ZUpvaW4pIHsKICAgICAgICAgICAgICAgIHRhYmxl\nMSA9IChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlUYWJsZSgpIDogZmsu\nZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAgIGFsaWFzMSA9IF9zZWwuZ2V0\nVGFibGVJbmRleCh0YWJsZTEsIHRoaXMsIHRydWUpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyB1cGRhdGUgdGhlIHBhdGggd2l0aCB0aGUgcmVs\nYXRpb24gbmFtZSBiZWZvcmUgZ2V0dGluZyBwayBhbGlhcwogICAgICAgICAg\nICB0aGlzLmFwcGVuZChuYW1lKTsKICAgICAgICAgICAgdGhpcy5hcHBlbmQo\ndmFyKTsKICAgICAgICAgICAgaWYgKHRvTWFueSkgewogICAgICAgICAgICAg\nICAgX3NlbC5fZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CiAgICAgICAg\nICAgICAgICBfc2VsLl9mbGFncyB8PSBUT19NQU5ZOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIF9vdXRlciA9IG91dGVyOwoKICAgICAgICAgICAgaWYg\nKGNyZWF0ZUpvaW4pIHsKICAgICAgICAgICAgICAgIFRhYmxlIHRhYmxlMiA9\nIChpbnZlcnNlKSA/IGZrLmdldFRhYmxlKCkgCiAgICAgICAgICAgICAgICAg\nICAgOiBmay5nZXRQcmltYXJ5S2V5VGFibGUoKTsKICAgICAgICAgICAgICAg\nIGludCBhbGlhczIgPSBfc2VsLmdldFRhYmxlSW5kZXgodGFibGUyLCB0aGlz\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIEpvaW4gaiA9IG5ldyBKb2luKHRh\nYmxlMSwgYWxpYXMxLCB0YWJsZTIsIGFsaWFzMiwgZmssIGludmVyc2UpOwog\nICAgICAgICAgICAgICAgai5zZXRUeXBlKChvdXRlcikgPyBKb2luLlRZUEVf\nT1VURVIgOiBKb2luLlRZUEVfSU5ORVIpOwoKICAgICAgICAgICAgICAgIGlm\nIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfam9pbnMg\nPSBuZXcgSm9pblNldCgpOwogICAgICAgICAgICAgICAgaWYgKF9qb2lucy5h\nZGQoaikgJiYgKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgCiAgICAg\nICAgICAgICAgICAgICAgfHwgc3VicyA9PSBTZWxlY3QuU1VCU19OT05FKSkK\nICAgICAgICAgICAgICAgICAgICBqLnNldFJlbGF0aW9uKHRhcmdldCwgc3Vi\ncywgY2xvbmUoX3NlbCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFNlbGVjdEpv\naW5zIGNsb25lKFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAgICAgIFNlbGVj\ndEpvaW5zIHNqID0gbmV3IFNlbGVjdEpvaW5zKHNlbCk7CiAgICAgICAgICAg\nIHNqLnZhciA9IHZhcjsKICAgICAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHNqLnBhdGggPSBuZXcgU3RyaW5nQnVmZmVyKHBh\ndGgudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGlmIChfam9pbnMgIT0gbnVs\nbCAmJiAhX2pvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHNqLl9q\nb2lucyA9IG5ldyBKb2luU2V0KF9qb2lucyk7CiAgICAgICAgICAgIHNqLl9v\ndXRlciA9IF9vdXRlcjsKICAgICAgICAgICAgcmV0dXJuIHNqOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLnRvU3RyaW5nKCkgKyAiICgiICsgX291dGVy\nICsgIik6ICIgKyBfam9pbnM7CiAgICAgICAgfQogICAgfQogICAgCiAgICBw\ncm90ZWN0ZWQgU2VsZWN0cyBuZXdTZWxlY3RzKCkgewogICAgICAgIHJldHVy\nbiBuZXcgU2VsZWN0cygpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVy\nIGNsYXNzIHRvIHRyYWNrIHNlbGVjdGVkIGNvbHVtbnMsIHdpdGggZmFzdCBj\nb250YWlucyBtZXRob2QuCiAgICAgKiBBY3RzIGFzIGEgbGlzdCBvZiBzZWxl\nY3QgaWRzLCB3aXRoIGFkZGl0aW9uYWwgbWV0aG9kcyB0byBtYW5pcHVsYXRl\nCiAgICAgKiB0aGUgYWxpYXMgb2YgZWFjaCBzZWxlY3RlZCBpZC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBTZWxlY3RzCiAgICAgICAg\nZXh0ZW5kcyBBYnN0cmFjdExpc3QgewoKICAgICAgICBwcm90ZWN0ZWQgTGlz\ndCBfaWRzID0gbnVsbDsKICAgICAgICBwcm90ZWN0ZWQgTGlzdCBfaWRlbnRz\nID0gbnVsbDsKICAgICAgICBwcm90ZWN0ZWQgTWFwIF9hbGlhc2VzID0gbnVs\nbDsKICAgICAgICBwcm90ZWN0ZWQgTWFwIF9zZWxlY3RBcyA9IG51bGw7CiAg\nICAgICAgcHJvdGVjdGVkIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7Cgog\nICAgICAgIC8qKgogICAgICAgICAqIEFkZCBhbGwgYWxpYXNlcyBmcm9tIGFu\nb3RoZXIgaW5zdGFuY2UuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZv\naWQgYWRkQWxsKFNlbGVjdHMgc2VscykgewogICAgICAgICAgICBpZiAoX2lk\ncyA9PSBudWxsICYmIHNlbHMuX2lkcyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX2lkcyA9IG5ldyBBcnJheUxpc3Qoc2Vscy5faWRzKTsKICAgICAgICAg\nICAgZWxzZSBpZiAoc2Vscy5faWRzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfaWRzLmFkZEFsbChzZWxzLl9pZHMpOwoKICAgICAgICAgICAgaWYgKF9p\nZGVudHMgPT0gbnVsbCAmJiBzZWxzLl9pZGVudHMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9pZGVudHMgPSBuZXcgQXJyYXlMaXN0KHNlbHMuX2lkZW50\ncyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHNlbHMuX2lkZW50cyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgX2lkZW50cy5hZGRBbGwoc2Vscy5faWRlbnRz\nKTsKCiAgICAgICAgICAgIGlmIChfYWxpYXNlcyA9PSBudWxsICYmIHNlbHMu\nX2FsaWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hbGlhc2VzID0g\nbmV3IEhhc2hNYXAoc2Vscy5fYWxpYXNlcyk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKHNlbHMuX2FsaWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9h\nbGlhc2VzLnB1dEFsbChzZWxzLl9hbGlhc2VzKTsKCiAgICAgICAgICAgIGlm\nIChfc2VsZWN0QXMgPT0gbnVsbCAmJiBzZWxzLl9zZWxlY3RBcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgX3NlbGVjdEFzID0gbmV3IEhhc2hNYXAoc2Vs\ncy5fc2VsZWN0QXMpOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9zZWxl\nY3RBcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3NlbGVjdEFzLnB1dEFs\nbChzZWxzLl9zZWxlY3RBcyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBSZXR1cm5zIHRoZSBhbGlhcyBvZiBhIGdpdmVuIGlkLgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0QWxpYXMoT2JqZWN0\nIGlkKSB7CiAgICAgICAgICAgIHJldHVybiAoX2FsaWFzZXMgPT0gbnVsbCkg\nPyBudWxsIDogX2FsaWFzZXMuZ2V0KGlkKTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIFNldCBhbiBhbGlhcyBmb3IgYSBnaXZlbiBpZC4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgaW50IHNldEFsaWFzKE9iamVj\ndCBpZCwgT2JqZWN0IGFsaWFzLCBib29sZWFuIGlkZW50KSB7CiAgICAgICAg\nICAgIGlmIChfaWRzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pZHMg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICBfYWxpYXNlcyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlu\ndCBpZHg7CiAgICAgICAgICAgIGlmIChfYWxpYXNlcy5wdXQoaWQsIGFsaWFz\nKSAhPSBudWxsKQogICAgICAgICAgICAgICAgaWR4ID0gX2lkcy5pbmRleE9m\nKGlkKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBfaWRz\nLmFkZChpZCk7CiAgICAgICAgICAgICAgICBpZHggPSBfaWRzLnNpemUoKSAt\nIDE7CgogICAgICAgICAgICAgICAgaWYgKGlkZW50KSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKF9pZGVudHMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgX2lkZW50cyA9IG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAg\nICAgICAgICAgICAgX2lkZW50cy5hZGQoaWQpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpZHg7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgYW4gYWxpYXMgZm9y\nIGEgZ2l2ZW4gaW5kZXguCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZv\naWQgc2V0QWxpYXMoaW50IGlkeCwgT2JqZWN0IGFsaWFzKSB7CiAgICAgICAg\nICAgIE9iamVjdCBpZCA9IF9pZHMuZ2V0KGlkeCk7CiAgICAgICAgICAgIF9h\nbGlhc2VzLnB1dChpZCwgYWxpYXMpOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogSW5zZXJ0IGFuIGFsaWFzIGJlZm9yZSB0aGUgZ2l2ZW4g\naW5kZXgsIHVzaW5nIG5lZ2F0aXZlIGluZGV4ZXMKICAgICAgICAgKiB0byBj\nb3VudCBiYWNrd2FyZHMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZv\naWQgaW5zZXJ0QWxpYXMoaW50IGlkeCwgT2JqZWN0IGlkLCBPYmplY3QgYWxp\nYXMpIHsKICAgICAgICAgICAgX2FsaWFzZXMucHV0KGlkLCBhbGlhcyk7CiAg\nICAgICAgICAgIGlmIChpZHggPj0gMCkKICAgICAgICAgICAgICAgIF9pZHMu\nYWRkKGlkeCwgaWQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfaWRzLmFkZChfaWRzLnNpemUoKSArIGlkeCwgaWQpOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBpbmRleCBvZiB0\naGUgZ2l2ZW4gYWxpYXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIGlu\ndCBpbmRleE9mQWxpYXMoT2JqZWN0IGFsaWFzKSB7CiAgICAgICAgICAgIGlm\nIChfYWxpYXNlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIC0x\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9pZHMuc2l6ZSgp\nOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoYWxpYXMuZXF1YWxzKF9hbGlh\nc2VzLmdldChfaWRzLmdldChpKSkpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBpOwogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBBIGxpc3QgcmVwcmVzZW50YXRpb24gb2Yg\ndGhlIGFsaWFzZXMsIGluIHNlbGVjdCBvcmRlciwgd2l0aAogICAgICAgICAq\nIEFTIGFsaWFzZXMgcHJlc2VudC4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgTGlzdCBnZXRBbGlhc2VzKGZpbmFsIGJvb2xlYW4gaWRlbnQsIGZpbmFs\nIGJvb2xlYW4gaW5uZXIpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9M\nSVNUOwoKICAgICAgICAgICAgcmV0dXJuIG5ldyBBYnN0cmFjdExpc3QoKSB7\nCiAgICAgICAgICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIChpZGVudCAmJiBfaWRlbnRzICE9IG51bGwp\nID8gX2lkZW50cy5zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgOiBf\naWRzLnNpemUoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaSkgewogICAgICAgICAgICAgICAg\nICAgIE9iamVjdCBpZCA9IChpZGVudCAmJiBfaWRlbnRzICE9IG51bGwpID8g\nX2lkZW50cy5nZXQoaSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBfaWRz\nLmdldChpKTsKICAgICAgICAgICAgICAgICAgICBPYmplY3QgYWxpYXMgPSBf\nYWxpYXNlcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChpZCBp\nbnN0YW5jZW9mIENvbHVtbiAmJiAoKENvbHVtbikgaWQpLmlzWE1MKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGFsaWFzID0gYWxpYXMgKyBfZGljdC5n\nZXRTdHJpbmdWYWw7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAg\nICAgICAgICAgICAgIFN0cmluZyBhcyA9IG51bGw7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGlubmVyKQogICAgICAgICAgICAgICAgICAgICAgICBhcyA9\nICgoU3RyaW5nKSBhbGlhcykucmVwbGFjZSgnLicsICdfJyk7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZSBpZiAoX3NlbGVjdEFzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGFzID0gKFN0cmluZykgX3NlbGVjdEFzLmdl\ndChpZCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChhcyAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZGVudCAmJiBfaWRlbnRz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nYXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGlhcyBpbnN0YW5j\nZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFs\naWFzID0gbmV3IFNRTEJ1ZmZlcigoU1FMQnVmZmVyKSBhbGlhcykuCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCIgQVMgIikuYXBw\nZW5kKGFzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgYWxpYXMgPSBhbGlhcyArICIgQVMgIiAr\nIGFzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gYWxpYXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH07CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhh\ndCBhIGdpdmVuIGlkJ3MgYWxpYXMgaGFzIGFuIEFTIHZhbHVlLgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFNlbGVjdEFzKE9iamVjdCBp\nZCwgU3RyaW5nIGFzKSB7CiAgICAgICAgICAgIGlmIChfc2VsZWN0QXMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9zZWxlY3RBcyA9IG5ldyBIYXNoTWFw\nKChpbnQpICg1ICogMS4zMyArIDEpKTsKICAgICAgICAgICAgX3NlbGVjdEFz\nLnB1dChpZCwgYXMpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogQ2xlYXIgYWxsIHBsYWNlaG9sZGVycyBhbmQgc2VsZWN0IEFTIGNsYXVz\nZXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgY2xlYXJQbGFj\nZWhvbGRlcnMoKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBPYmplY3QgaWQ7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2lkcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWQgPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGlkIGluc3RhbmNlb2Yg\nUGxhY2Vob2xkZXIpIHsKICAgICAgICAgICAgICAgICAgICBpdHIucmVtb3Zl\nKCk7CiAgICAgICAgICAgICAgICAgICAgX2FsaWFzZXMucmVtb3ZlKGlkKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0IGlkKSB7CiAg\nICAgICAgICAgIHJldHVybiBfYWxpYXNlcyAhPSBudWxsICYmIF9hbGlhc2Vz\nLmNvbnRhaW5zS2V5KGlkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBP\nYmplY3QgZ2V0KGludCBpKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51\nbGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJyYXlJbmRleE91dE9m\nQm91bmRzRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHJldHVybiBfaWRzLmdl\ndChpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIChfaWRzID09IG51bGwpID8gMCA6IF9pZHMu\nc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xlYXIo\nKSB7CiAgICAgICAgICAgIF9pZHMgPSBudWxsOwogICAgICAgICAgICBfYWxp\nYXNlcyA9IG51bGw7CiAgICAgICAgICAgIF9zZWxlY3RBcyA9IG51bGw7CiAg\nICAgICAgICAgIF9pZGVudHMgPSBudWxsOwogICAgICAgIH0KICAgIH0KfQoK\nLyoqCiAqIENvbW1vbiBqb2lucyBpbnRlcmZhY2UgdXNlZCBpbnRlcm5hbGx5\nLiBDYW5ub3QgYmUgbWFkZSBhbiBpbm5lciBjbGFzcwogKiBiZWNhdXNlIHRo\nZSBvdXRlciBjbGFzcyAoU2VsZWN0KSBoYXMgdG8gaW1wbGVtZW50IGl0Lgog\nKi8KaW50ZXJmYWNlIFBhdGhKb2lucwogICAgZXh0ZW5kcyBKb2lucyB7Cgog\nICAgLyoqCiAgICAgKiBNYXJrIHRoaXMgYXMgYW4gb3V0ZXIgam9pbnMgc2V0\nLgogICAgICovCiAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xl\nYW4gb3V0ZXIpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhp\ncyBpbnN0YW5jZSBoYXMgYSBwYXRoLCBhbnkgam9pbnMsIG9yIGEgdmFyaWFi\nbGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKTsKCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgcmVsYXRpb24gcGF0aCB0cmF2ZXJz\nZWQgYnkgdGhlc2Ugam9pbnMsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwog\nICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRoKCk7CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHNldCBvZiB7QGxpbmsgSm9pbn0gZWxlbWVudHMsIG9y\nIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIEpvaW5TZXQgam9p\nbnMoKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWF4aW11bSBudW1i\nZXIgb2Ygam9pbnMgY29udGFpbmVkIGluIHRoaXMgaW5zdGFuY2UgYXQgYW55\nCiAgICAgKiB0aW1lLgogICAgICovCiAgICBwdWJsaWMgaW50IGpvaW5Db3Vu\ndCgpOwoKICAgIC8qKgogICAgICogTnVsbCB0aGUgc2V0IG9mIHtAbGluayBK\nb2lufSBlbGVtZW50cy4KICAgICAqLwogICAgcHVibGljIHZvaWQgbnVsbEpv\naW5zKCk7Cn0KCg==\n","encoding":"base64"}

