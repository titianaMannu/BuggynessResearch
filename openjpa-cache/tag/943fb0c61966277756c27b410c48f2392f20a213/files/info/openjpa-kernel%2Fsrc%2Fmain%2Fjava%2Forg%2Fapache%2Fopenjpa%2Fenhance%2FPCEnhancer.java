{"sha":"1191dd992295893de3df374aef042966613346eb","node_id":"MDQ6QmxvYjIwNjM2NDoxMTkxZGQ5OTIyOTU4OTNkZTNkZjM3NGFlZjA0Mjk2NjYxMzM0NmVi","size":176053,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1191dd992295893de3df374aef042966613346eb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xhc3NBcmdQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQnl0ZWNvZGVXcml0\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZI\nZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9w\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuU2Vy\ndmljZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkRhdGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkRvdWJsZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFz\nczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmll\nbGRJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJ\nbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0\nZWNvZGUuTG9hZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5N\nZXRob2RJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuUHJvamVj\ndDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuVGFibGVTd2l0Y2hJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ2xhc3NJbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51dGlsLlN0cmlu\nZ3M7CgovKioKICogQnl0ZWNvZGUgZW5oYW5jZXIgdXNlZCB0byBlbmhhbmNl\nIHBlcnNpc3RlbnQgY2xhc3NlcyBmcm9tIG1ldGFkYXRhLiBUaGUKICogZW5o\nYW5jZXIgbXVzdCBiZSBpbnZva2VkIG9uIGFsbCBwZXJzaXN0ZW5jZS1jYXBh\nYmxlIGFuZCBwZXJzaXN0ZW5jZSBhd2FyZQogKiBjbGFzc2VzLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFBDRW5oYW5jZXIg\newogICAgLy8gRGVzaWduYXRlcyBhIHZlcnNpb24gZm9yIG1haW50YWluaW5n\nIGNvbXBhdGJpbGl0eSB3aGVuIFBDRW5oYW5jZXIKICAgIC8vIG1vZGlmaWVz\nIGVuaGFuY2VtZW50IHRoYXQgY2FuIGJyZWFrIHNlcmlhbGl6YXRpb24gb3Ig\nb3RoZXIgY29udHJhY3RzCiAgICAvLyBFYWNoIGVuaGFuY2VkIGNsYXNzIHdp\nbGwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIHZpYQogICAgLy8g\ncHVibGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFUl9WRVJTSU9OID0g\nMjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX05PTkUg\nPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9BV0FS\nRSA9IDIgPDwgMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFO\nQ0VfSU5URVJGQUNFID0gMiA8PCAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRV9QQyA9IDIgPDwgMjsKCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBQUkUgPSAicGMiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgSVNERVRBQ0hFRFNUQVRFREVGSU5JVElWRSA9IFBSRSAK\nICAgICAgICArICJpc0RldGFjaGVkU3RhdGVEZWZpbml0aXZlIjsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBQQ1RZUEUgPSBQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU00gPSBQUkUgKyAiU3RhdGVNYW5hZ2VyIjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENsYXNzIFNNVFlQRSA9IFN0YXRlTWFuYWdlci5jbGFzczsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBJTkhFUklUID0gUFJF\nICsgIkluaGVyaXRlZEZpZWxkQ291bnQiOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIENPTlRFWFROQU1FID0gIkdlbmVyaWNDb250ZXh0IjsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFVTRVJFWENFUCA9IFVz\nZXJFeGNlcHRpb24uY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBD\nbGFzcyBJTlRFUk5FWENFUCA9IEludGVybmFsRXhjZXB0aW9uLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSEVMUEVSVFlQRSA9IFBD\nUmVnaXN0cnkuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU1VQRVIgPSBQUkUgKyAiUENTdXBlcmNsYXNzIjsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIENsYXNzIE9JREZTVFlQRSA9IEZpZWxkU3VwcGxpZXIu\nY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBPSURGQ1RZ\nUEUgPSBGaWVsZENvbnN1bWVyLmNsYXNzOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoUENFbmhhbmNlci5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgUkVERUZJTkVEX0FUVFJJQlVURQogICAgICAgID0g\nUENFbmhhbmNlci5jbGFzcy5nZXROYW1lKCkgKyAiI3JlZGVmaW5lZC10eXBl\nIjsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQXV4aWxpYXJ5RW5o\nYW5jZXJbXSBfYXV4RW5oYW5jZXJzOwogICAgc3RhdGljIHsKICAgICAgICBD\nbGFzc1tdIGNsYXNzZXMgPSBTZXJ2aWNlcy5nZXRJbXBsZW1lbnRvckNsYXNz\nZXMoCiAgICAgICAgICAgIEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzLAogICAg\nICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xh\nc3NMb2FkZXJBY3Rpb24oQXV4aWxpYXJ5RW5oYW5jZXIuY2xhc3MpKSk7CiAg\nICAgICAgTGlzdCBhdXhFbmhhbmNlcnMgPSBuZXcgQXJyYXlMaXN0KGNsYXNz\nZXMubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsYXNz\nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGF1eEVuaGFuY2Vycy5hZGQoQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nbmV3SW5zdGFuY2VBY3Rpb24oY2xhc3Nlc1tpXSkpKTsKCQkgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGF1eCBlbmhh\nbmNlciBtYXkgcmVseSBvbiBub24tZXhpc3RhbnQgc3BlYyBjbGFzc2VzLCBl\ndGMKCQkgICAgfQoJCX0KICAgIAlfYXV4RW5oYW5jZXJzID0gKEF1eGlsaWFy\neUVuaGFuY2VyW10pIGF1eEVuaGFuY2Vycy50b0FycmF5CiAgICAgICAgICAg\nIChuZXcgQXV4aWxpYXJ5RW5oYW5jZXJbYXV4RW5oYW5jZXJzLnNpemUoKV0p\nOwogICAgfQoKICAgIHByaXZhdGUgQkNDbGFzcyBfcGM7CiAgICBwcml2YXRl\nIGZpbmFsIEJDQ2xhc3MgX21hbmFnZWRUeXBlOwogICAgcHJpdmF0ZSBmaW5h\nbCBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSBmaW5h\nbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cg\nX2xvZzsKICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2RlZkNvbnMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9yZWRlZmluZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9zdWJjbGFzcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9m\nYWlsID0gZmFsc2U7CiAgICBwcml2YXRlIFNldCBfdmlvbGF0aW9ucyA9IG51\nbGw7CiAgICBwcml2YXRlIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2YXRl\nIEJ5dGVjb2RlV3JpdGVyIF93cml0ZXIgPSBudWxsOwogICAgcHJpdmF0ZSBN\nYXAgX2JhY2tpbmdGaWVsZHMgPSBudWxsOyAvLyBtYXAgb2Ygc2V0IC8gZ2V0\nIG5hbWVzID0+IGZpZWxkIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfYXR0cnNU\nb0ZpZWxkcyA9IG51bGw7IC8vIG1hcCBvZiBhdHRyIG5hbWVzID0+IGZpZWxk\nIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfZmllbGRzVG9BdHRycyA9IG51bGw7\nIC8vIG1hcCBvZiBmaWVsZCBuYW1lcyA9PiBhdHRyIG5hbWVzCiAgICBwcml2\nYXRlIGJvb2xlYW4gX2lzQWxyZWFkeVJlZGVmaW5lZCA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9pc0FscmVhZHlTdWJjbGFzc2VkID0gZmFsc2U7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2Jjc0NvbmZpZ3VyZWQgPSBmYWxzZTsK\nCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJh\ndGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLgogICAgICovCiAgICBwdWJsaWMg\nUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFzcyB0\neXBlKSB7CiAgICAgICAgdGhpcyhjb25mLCAoQkNDbGFzcykgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAg\nICAgLmxvYWRQcm9qZWN0Q2xhc3NBY3Rpb24obmV3IFByb2plY3QoKSwgdHlw\nZSkpLAogICAgICAgICAgICAoTWV0YURhdGFSZXBvc2l0b3J5KSBudWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29u\nZmlndXJhdGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLgogICAgICovCiAgICBw\ndWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBD\nbGFzc01ldGFEYXRhIHR5cGUpIHsKICAgICAgICB0aGlzKGNvbmYsIChCQ0Ns\nYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihuZXcg\nUHJvamVjdCgpLCB0eXBlLmdldERlc2NyaWJlZFR5cGUoKSkpLAogICAgICAg\nICAgICB0eXBlLmdldFJlcG9zaXRvcnkoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAgICAg\nKgogICAgICogQHBhcmFtIHR5cGUgdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0\naW9uIGZvIHRoZSB0eXBlIHRvCiAgICAgKiBlbmhhbmNlOyB0aGlzIGNhbiBi\nZSBjcmVhdGVkIGZyb20gYW55IHN0cmVhbSBvciBmaWxlCiAgICAgKiBAcGFy\nYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBvc2l0b3J5IHRvIHVzZSBmb3IgbWV0\nYWRhdGEgYWNjZXNzLAogICAgICogb3IgbnVsbCB0byBjcmVhdGUgYSBuZXcg\ncmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRvcnkKICAgICAqIGZyb20gdGhlIGdp\ndmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3QgdXNlZCBieSBkZWZhdWx0CiAgICAg\nKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0aW9uIG1pZ2h0IGJlIGFuCiAgICAg\nKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZpYyBzdWJjbGFzcyB3aG9zZSBtZXRh\nZGF0YQogICAgICogcmVxdWlyZWQgbW9yZSB0aGFuIGp1c3QgYmFzZSBtZXRh\nZGF0YSBmaWxlcwogICAgICogQGRlcHJlY2F0ZWQgdXNlIHtAbGluayAjUENF\nbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiwgQkNDbGFzcywKICAgICAg\nICBNZXRhRGF0YVJlcG9zaXRvcnksIENsYXNzTG9hZGVyKX0gaW5zdGVhZC4g\nCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAgICBNZXRhRGF0YVJl\ncG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICB0aGlzKGNvbmYsIHR5cGUsIHJl\ncG9zLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9y\nLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0g\ndHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gZm8gdGhlIHR5cGUg\ndG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJlIGNyZWF0ZWQgZnJvbSBh\nbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJhbSByZXBvcyBhIG1ldGFk\nYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRhZGF0YSBhY2Nlc3MsCiAg\nICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyByZXBvcml0b3J5OyB0aGUg\ncmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2ZW4gY29uZmlndXJhdGlv\nbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAqIGJlY2F1c2UgdGhlIGNv\nbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAqIGltcGxlbWVudGF0aW9u\nLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFkYXRhCiAgICAgKiByZXF1\naXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFkYXRhIGZpbGVzCiAgICAg\nKiBAcGFyYW0gbG9hZGVyIHRoZSBlbnZpcm9ubWVudCBjbGFzc2xvYWRlciB0\nbyB1c2UgZm9yIGxvYWRpbmcKICAgICAqIGNsYXNzZXMgYW5kIHJlc291cmNl\ncy4KICAgICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZp\nZ3VyYXRpb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIE1ldGFEYXRh\nUmVwb3NpdG9yeSByZXBvcywgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAg\nICAgX21hbmFnZWRUeXBlID0gdHlwZTsKICAgICAgICBfcGMgPSB0eXBlOwoK\nICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRp\nb24uTE9HX0VOSEFOQ0UpOwoKICAgICAgICBpZiAocmVwb3MgPT0gbnVsbCkg\newogICAgICAgICAgICBfcmVwb3MgPSBjb25mLm5ld01ldGFEYXRhUmVwb3Np\ndG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIF9yZXBvcy5zZXRTb3VyY2VN\nb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01FVEEpOwogICAgICAgIH0g\nZWxzZQogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfbWV0\nYSA9IF9yZXBvcy5nZXRNZXRhRGF0YSh0eXBlLmdldFR5cGUoKSwgbG9hZGVy\nLCBmYWxzZSk7CiAgICB9CgogICAgc3RhdGljIFN0cmluZyB0b1BDU3ViY2xh\nc3NOYW1lKENsYXNzIGNscykgewogICAgICAgIHJldHVybiBTdHJpbmdzLmdl\ndFBhY2thZ2VOYW1lKFBDRW5oYW5jZXIuY2xhc3MpICsgIi4iCiAgICAgICAg\nICAgICsgY2xzLmdldE5hbWUoKS5yZXBsYWNlKCcuJywgJyQnKSArICIkcGNz\ndWJjbGFzcyI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4g\nU3VwcGx5IGNvbmZpZ3VyYXRpb24sIHR5cGUsIGFuZCBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIHRoaXMoY29uZiwgdHlwZSwgbWV0YS5nZXRSZXBv\nc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBi\neXRlY29kZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgcGVyc2lzdGVuY2UtY2Fw\nYWJsZSBjbGFzcwogICAgICogYmVpbmcgbWFuaXB1bGF0ZWQuCiAgICAgKi8K\nICAgIHB1YmxpYyBCQ0NsYXNzIGdldFBDQnl0ZWNvZGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9wYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hbmFnZWQgY2xhc3Mg\nYmVpbmcKICAgICAqIG1hbmlwdWxhdGVkLiBUaGlzIGlzIHVzdWFsbHkgdGhl\nIHNhbWUgYXMge0BsaW5rICNnZXRQQ0J5dGVjb2RlfSwKICAgICAqIGV4Y2Vw\ndCB3aGVuIHJ1bm5pbmcgdGhlIGVuaGFuY2VyIHRvIHJlZGVmaW5lIGFuZCBz\ndWJjbGFzcwogICAgICogZXhpc3RpbmcgcGVyc2lzdGVudCB0eXBlcy4KICAg\nICAqLwogICAgcHVibGljIEJDQ2xhc3MgZ2V0TWFuYWdlZFR5cGVCeXRlY29k\nZSgpIHsKICAgICAgICByZXR1cm4gX21hbmFnZWRUeXBlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGNsYXNz\nIGJlaW5nIG1hbmlwdWxhdGVkLCBvciBudWxsIGlmIG5vdAogICAgICogYSBw\nZXJzaXN0ZW50IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRo\nZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBj\nb25zdHJ1Y3RvciBpZiBvbmUgaXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0\naGUgY2xhc3MuIE9wZW5KUEEKICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1h\ncmcgY29uc3RydWN0b3IgKHdoZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGls\nZXIKICAgICAqIG9yIGJ5IHRoZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEFkZERlZmF1bHRDb25z\ndHJ1Y3RvcigpIHsKICAgICAgICByZXR1cm4gX2RlZkNvbnM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRo\nZSBlbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3Ry\ndWN0b3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNs\nYXNzLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNv\nbnN0cnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAg\nICAgKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRBZGREZWZhdWx0Q29uc3RydWN0b3Io\nYm9vbGVhbiBhZGREZWZhdWx0Q29uc3RydWN0b3IpIHsKICAgICAgICBfZGVm\nQ29ucyA9IGFkZERlZmF1bHRDb25zdHJ1Y3RvcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtdXRhdGUgaXRz\nIGFyZ3VtZW50cywgb3IganVzdCBydW4gdmFsaWRhdGlvbgogICAgICogYW5k\nIG9wdGlvbmFsIHN1YmNsYXNzaW5nIGxvZ2ljIG9uIHRoZW0uIFVzdWFsbHkg\ndXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoCiAgICAgKiA8Y29kZT5zZXRDcmVh\ndGVTdWJjbGFzcyh0cnVlKTwvY29kZT4uCiAgICAgKgogICAgICogQHNpbmNl\nIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFJlZGVmaW5l\nKCkgewogICAgICAgIHJldHVybiBfcmVkZWZpbmU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0\ncyBhcmd1bWVudHMsIG9yIGp1c3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFu\nZCBvcHRpb25hbCBzdWJjbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5\nIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3Jl\nYXRlU3ViY2xhc3ModHJ1ZSk8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5j\nZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZWRlZmluZShi\nb29sZWFuIHJlZGVmaW5lKSB7CiAgICAgICAgX3JlZGVmaW5lID0gcmVkZWZp\nbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRo\nYXQgdGhpcyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVl\nbgogICAgICogcmVkZWZpbmVkLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAu\nMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FscmVhZHlSZWRlZmlu\nZWQoKSB7CiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlSZWRlZmluZWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhp\ncyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAg\nICogc3ViY2xhc3NlZCBpbiB0aGlzIGluc3RhbmNlJ3MgZW52aXJvbm1lbnQg\nY2xhc3Nsb2FkZXIuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQWxyZWFkeVN1YmNsYXNzZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlTdWJjbGFzc2VkOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG1h\na2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAgICog\nb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRDcmVhdGVTdWJjbGFzcygpIHsKICAgICAgICByZXR1cm4g\nX3N1YmNsYXNzOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUg\nZW5oYW5jZXIgc2hvdWxkIG1ha2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5j\nZS1jYXBhYmxlLAogICAgICogb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1j\nYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDcmVhdGVTdWJjbGFzcyhib29s\nZWFuIHN1YmNsYXNzKSB7CiAgICAgICAgX3N1YmNsYXNzID0gc3ViY2xhc3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYgdGhl\nIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQKICAg\nICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJlIHZp\nb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyByZXN0\ncmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucygpIHsKICAgICAgICByZXR1cm4gX2Zh\naWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYg\ndGhlIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQK\nICAgICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJl\nIHZpb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyBy\nZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyhib29sZWFuIGZhaWwpIHsKICAgICAg\nICBfZmFpbCA9IGZhaWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhdGVk\nIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAgICAgKiBv\ndmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBudWxsLgog\nICAgICovCiAgICBwdWJsaWMgRmlsZSBnZXREaXJlY3RvcnkoKSB7CiAgICAg\nICAgcmV0dXJuIF9kaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhZWQg\nYmVuZWF0aCB0aGlzIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8KICAgICAqIG92\nZXJ3cml0aW5nIHRoZSBleGlzdGluZyBjbGFzcyBmaWxlIGlmIG51bGwuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERpcmVjdG9yeShGaWxlIGRpcikg\newogICAgICAgIF9kaXIgPSBkaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGN1cnJlbnQge0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3\ncml0ZSB0byBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBC\neXRlY29kZVdyaXRlciBnZXRCeXRlY29kZVdyaXRlcigpIHsKICAgICAgICBy\nZXR1cm4gX3dyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\ne0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3cml0ZSB0aGUgYnl0ZWNvZGUg\ndG8gb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCeXRlY29kZVdyaXRlcihCeXRlY29kZVdyaXRlciB3cml0ZXIpIHsKICAg\nICAgICBfd3JpdGVyID0gd3JpdGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nUGVyZm9ybSBieXRlY29kZSBlbmhhbmNlbWVudHMuCiAgICAgKgogICAgICog\nQHJldHVybiA8Y29kZT5FTkhBTkNFXyo8L2NvZGU+IGNvbnN0YW50CiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgcnVuKCkgewogICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoImVuaGFuY2Utc3RhcnQiLCBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIG1hbmFnZWQgaW50\nZXJmYWNlLCBza2lwCiAgICAgICAgICAgIGlmIChfbWFuYWdlZFR5cGUuaXNJ\nbnRlcmZhY2UoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNFX0lO\nVEVSRkFDRTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGFscmVhZHkgZW5o\nYW5jZWQKICAgICAgICAgICAgQ2xhc3NbXSBpbnRlcmZhY2VzID0gX21hbmFn\nZWRUeXBlLmdldERlY2xhcmVkSW50ZXJmYWNlVHlwZXMoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpbnRlcmZhY2VzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaW50ZXJmYWNlc1tpXS5nZXROYW1l\nKCkuZXF1YWxzKFBDVFlQRS5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGMtdHlwZSIsIF9t\nYW5hZ2VkVHlwZS5nZXRUeXBlKCkpKTsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gRU5IQU5DRV9OT05FOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBjb25maWd1cmVCQ3MoKTsKCiAgICAgICAg\nICAgIC8vIHZhbGlkYXRlIHByb3BlcnRpZXMgYmVmb3JlIHJlcGxhY2luZyBm\naWVsZCBhY2Nlc3Mgc28gdGhhdAogICAgICAgICAgICAvLyB3ZSBidWlsZCB1\ncCBhIHJlY29yZCBvZiBiYWNraW5nIGZpZWxkcywgZXRjCiAgICAgICAgICAg\nIGlmIChfbWV0YSAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBfbWV0YS5n\nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVS\nVFkpIHsKICAgICAgICAgICAgICAgIHZhbGlkYXRlUHJvcGVydGllcygpOwog\nICAgICAgICAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAg\nICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24oKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVs\nZEFjY2VzcygpOwogICAgICAgICAgICBwcm9jZXNzVmlvbGF0aW9ucygpOwoK\nICAgICAgICAgICAgaWYgKF9tZXRhICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGVuaGFuY2VDbGFzcygpOwogICAgICAgICAgICAgICAgYWRkRmllbGRz\nKCk7CiAgICAgICAgICAgICAgICBhZGRTdGF0aWNJbml0aWFsaXplcigpOwog\nICAgICAgICAgICAgICAgYWRkUENNZXRob2RzKCk7CiAgICAgICAgICAgICAg\nICBhZGRBY2Nlc3NvcnMoKTsKICAgICAgICAgICAgICAgIGFkZEF0dGFjaERl\ndGFjaENvZGUoKTsKICAgICAgICAgICAgICAgIGFkZFNlcmlhbGl6YXRpb25D\nb2RlKCk7CiAgICAgICAgICAgICAgICBhZGRDbG9uaW5nQ29kZSgpOwogICAg\nICAgICAgICAgICAgcnVuQXV4aWxpYXJ5RW5oYW5jZXJzKCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gRU5IQU5DRV9QQzsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJwZXJzLWF3YXJlIiwgX21hbmFn\nZWRUeXBlLmdldFR5cGUoKSkpOwogICAgICAgICAgICByZXR1cm4gRU5IQU5D\nRV9BV0FSRTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJlbmhhbmNlLWVycm9yIiwKICAgICAgICAgICAg\nICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkuZ2V0TmFtZSgpLCBlLmdldE1l\nc3NhZ2UoKSksIGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgY29uZmlndXJlQkNzKCkgewogICAgICAgIGlmICghX2Jjc0NvbmZpZ3Vy\nZWQpIHsKICAgICAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0QXR0cmlidXRlKFJFREVG\nSU5FRF9BVFRSSUJVVEUpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nX21hbmFnZWRUeXBlLmFkZEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRF\nKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBf\naXNBbHJlYWR5UmVkZWZpbmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAg\nICAgICAgIFBDU3ViY2xhc3NWYWxpZGF0b3IgdmFsID0gbmV3IFBDU3ViY2xh\nc3NWYWxpZGF0b3IoCiAgICAgICAgICAgICAgICAgICAgX21ldGEsIF9tYW5h\nZ2VkVHlwZSwgX2xvZywgX2ZhaWwpOwogICAgICAgICAgICAgICAgdmFsLmFz\nc2VydENhblN1YmNsYXNzKCk7CgogICAgICAgICAgICAgICAgX3BjID0gX21h\nbmFnZWRUeXBlLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoCiAgICAgICAgICAg\nICAgICAgICAgdG9QQ1N1YmNsYXNzTmFtZShfbWFuYWdlZFR5cGUuZ2V0VHlw\nZSgpKSk7CiAgICAgICAgICAgICAgICBpZiAoX3BjLmdldFN1cGVyY2xhc3NC\nQygpICE9IF9tYW5hZ2VkVHlwZSkgewogICAgICAgICAgICAgICAgICAgIF9w\nYy5zZXRTdXBlcmNsYXNzKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgICAgICAg\nICAgICAgX3BjLnNldEFic3RyYWN0KF9tYW5hZ2VkVHlwZS5pc0Fic3RyYWN0\nKCkpOwogICAgICAgICAgICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNl\nKER5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfaXNBbHJlYWR5\nU3ViY2xhc3NlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfcGMgPSBfbWFuYWdlZFR5\ncGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9iY3NDb25maWd1cmVk\nID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0\nZSB0aGUgZ2VuZXJhdGVkIGJ5dGVjb2RlLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCByZWNvcmQoKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKF9tYW5hZ2VkVHlwZSAhPSBfcGMgJiYgZ2V0UmVkZWZpbmUo\nKSkKICAgICAgICAgICAgcmVjb3JkKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAg\ncmVjb3JkKF9wYyk7CiAgICAgICAgaWYgKF9vaWRzICE9IG51bGwpCiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX29pZHMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICByZWNvcmQoKEJDQ2xh\nc3MpIGl0ci5uZXh0KCkpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUg\ndGhlIGdpdmVuIGNsYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVj\nb3JkKEJDQ2xhc3MgYmMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoX3dyaXRlciAhPSBudWxsKQogICAgICAgICAgICBfd3Jp\ndGVyLndyaXRlKGJjKTsKICAgICAgICBlbHNlIGlmIChfZGlyID09IG51bGwp\nCiAgICAgICAgICAgIGJjLndyaXRlKCk7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIEZpbGUgZGlyID0gRmlsZXMuZ2V0UGFja2FnZUZpbGUoX2Rpciwg\nYmMuZ2V0UGFja2FnZU5hbWUoKSwgdHJ1ZSk7CiAgICAgICAgICAgIGJjLndy\naXRlKG5ldyBGaWxlKGRpciwgYmMuZ2V0Q2xhc3NOYW1lKCkgKyAiLmNsYXNz\nIikpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRl\nIHRoYXQgdGhlIG1ldGhvZHMgaW4gdGhpcyBwcm9wZXJ0eS1hY2Nlc3MgaW5z\ndGFuY2UgYXJlCiAgICAgKiB3cml0dGVuIGNvcnJlY3RseS4gVGhpcyBtZXRo\nb2QgYWxzbyBnYXRoZXJzIGluZm9ybWF0aW9uIG9uIGVhY2gKICAgICAqIHBy\nb3BlcnR5J3MgYmFja2luZyBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHZhbGlkYXRlUHJvcGVydGllcygpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kczsKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkK\nICAgICAgICAgICAgZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgZm1kcyA9IF9tZXRhLmdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgTWV0aG9kIG1ldGg7CiAgICAgICAgQkNNZXRob2Qg\nZ2V0dGVyLCBzZXR0ZXI7CiAgICAgICAgQkNGaWVsZCByZXR1cm5lZCwgYXNz\naWduZWQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIShmbWRzW2ldLmdl\ndEJhY2tpbmdNZW1iZXIoKSBpbnN0YW5jZW9mIE1ldGhvZCkpIHsKICAgICAg\nICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktYmFkLW1lbWJlciIs\nCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBmbWRzW2ldLCBm\nbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKSB9LAogICAgICAgICAgICAgICAg\nICAgIHRydWUpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIG1ldGggPSAoTWV0aG9kKSBmbWRzW2ldLmdl\ndEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICAgICAgLy8gIyMjIyMgdGhpcyB3\naWxsIGZhaWwgaWYgd2Ugb3ZlcnJpZGUgYW5kIGRvbid0IGNhbGwgc3VwZXIu\nCiAgICAgICAgICAgIEJDQ2xhc3MgZGVjbGFyaW5nVHlwZSA9IF9tYW5hZ2Vk\nVHlwZS5nZXRQcm9qZWN0KCkKICAgICAgICAgICAgICAgIC5sb2FkQ2xhc3Mo\nZm1kc1tpXS5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICBnZXR0\nZXIgPSBkZWNsYXJpbmdUeXBlLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBl\ncygpKTsKICAgICAgICAgICAgaWYgKGdldHRlciA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LW5vLWdldHRlciIs\nIG5ldyBPYmplY3RbXXsgZm1kc1tpXSB9LAogICAgICAgICAgICAgICAgICAg\nIHRydWUpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuZWQgPSBnZXRSZXR1cm5lZEZpZWxkKGdl\ndHRlcik7CiAgICAgICAgICAgIGlmIChyZXR1cm5lZCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmVnaXN0ZXJCYWNraW5nRmllbGRJbmZvKGZtZHNbaV0s\nIGdldHRlciwgcmV0dXJuZWQpOwoKICAgICAgICAgICAgc2V0dGVyID0gZGVj\nbGFyaW5nVHlwZS5nZXREZWNsYXJlZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZt\nZHNbaV0pLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgICAgIGlmIChzZXR0ZXIg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHJldHVybmVkID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3Bl\ncnR5LW5vLXNldHRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgZm1kc1tpXSB9LCB0cnVlKTsKICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdldFJl\nZGVmaW5lKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgc3lu\ndGhldGljIHNldHRlcgogICAgICAgICAgICAgICAgICAgIHNldHRlciA9IF9t\nYW5hZ2VkVHlwZS5kZWNsYXJlTWV0aG9kKGdldFNldHRlck5hbWUoZm1kc1tp\nXSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdeyBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAg\nICAgICAgICAgICAgIHNldHRlci5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAg\nICAgICAgICAgIENvZGUgY29kZSA9IHNldHRlci5nZXRDb2RlKHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChy\nZXR1cm5lZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChzZXR0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGFzc2ln\nbmVkID0gZ2V0QXNzaWduZWRGaWVsZChzZXR0ZXIpOwoKICAgICAgICAgICAg\naWYgKGFzc2lnbmVkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChz\nZXR0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZWdpc3RlckJh\nY2tpbmdGaWVsZEluZm8oZm1kc1tpXSwgc2V0dGVyLCBhc3NpZ25lZCk7Cgog\nICAgICAgICAgICAgICAgaWYgKGFzc2lnbmVkICE9IHJldHVybmVkKQogICAg\nICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktc2V0dGVy\nLWdldHRlci1taXNtYXRjaCIsIG5ldyBPYmplY3RbXQogICAgICAgICAgICAg\nICAgICAgICAgICB7IGZtZHNbaV0sIGFzc2lnbmVkLmdldE5hbWUoKSwgKHJl\ndHVybmVkID09IG51bGwpIAogICAgICAgICAgICAgICAgICAgICAgICA/IG51\nbGwgOiByZXR1cm5lZC5nZXROYW1lKCkgfSwgZmFsc2UpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCByZWdpc3Rl\nckJhY2tpbmdGaWVsZEluZm8oRmllbGRNZXRhRGF0YSBmbWQsIEJDTWV0aG9k\nIG1ldGhvZCwKICAgICAgICBCQ0ZpZWxkIGZpZWxkKSB7CiAgICAgICAgaWYg\nKF9iYWNraW5nRmllbGRzID09IG51bGwpCiAgICAgICAgICAgIF9iYWNraW5n\nRmllbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfYmFja2luZ0ZpZWxk\ncy5wdXQobWV0aG9kLmdldE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAg\nICAgICAgaWYgKF9hdHRyc1RvRmllbGRzID09IG51bGwpCiAgICAgICAgICAg\nIF9hdHRyc1RvRmllbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfYXR0\ncnNUb0ZpZWxkcy5wdXQoZm1kLmdldE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgp\nKTsKCiAgICAgICAgaWYgKF9maWVsZHNUb0F0dHJzID09IG51bGwpCiAgICAg\nICAgICAgIF9maWVsZHNUb0F0dHJzID0gbmV3IEhhc2hNYXAoKTsKICAgICAg\nICBfZmllbGRzVG9BdHRycy5wdXQoZmllbGQuZ2V0TmFtZSgpLCBmbWQuZ2V0\nTmFtZSgpKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkQXR0cmlidXRl\nVHJhbnNsYXRpb24oKSB7CiAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2Uo\nQXR0cmlidXRlVHJhbnNsYXRvci5jbGFzcyk7CiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkF0dHJpYnV0ZUlu\nZGV4VG9GaWVsZE5hbWUiLAogICAgICAgICAgICBTdHJpbmcuY2xhc3MsIG5l\ndyBDbGFzc1tdIHsgaW50LmNsYXNzIH0pOwogICAgICAgIG1ldGhvZC5tYWtl\nUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEu\nZ2V0RmllbGRzKCk7CgogICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBUYWJsZVN3aXRj\naEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAg\nICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAgIHRhYmlucy5zZXRIaWdo\nKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgIC8vIGNhc2UgaToKICAgICAg\nICAvLyAgICAgcmV0dXJuIDxfYXR0cnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5n\nZXROYW1lKCkpPgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJpbnMuYWRkVGFyZ2V0KGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgKICAgICAgICAgICAgICAgIF9hdHRy\nc1RvRmllbGRzLmdldChmbWRzW2ldLmdldE5hbWUoKSkpKTsKICAgICAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWZh\ndWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAg\nICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24K\nICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5j\nbGFzcykpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgbmFtZSBvZiB0aGUgc2V0dGVyIG1ldGhv\nZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBTdHJpbmcgZ2V0U2V0dGVyTmFtZShGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIHJldHVybiAic2V0IiArIFN0cmluZ1V0aWxzLmNhcGl0YWxp\nemUoZm1kLmdldE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGZpZWxkIHJldHVybmVkIGJ5IHRoZSBnaXZlbiBtZXRob2QsIG9y\nIG51bGwgaWYgbm9uZS4KICAgICAqIFBhY2thZ2UtcHJvdGVjdGVkIGFuZCBz\ndGF0aWMgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHN0YXRpYyBCQ0ZpZWxk\nIGdldFJldHVybmVkRmllbGQoQkNNZXRob2QgbWV0aCkgewogICAgICAgIHJl\ndHVybiBmaW5kRmllbGQobWV0aCwgKChDb2RlKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3\nQ29kZUFjdGlvbigpKSkueHJldHVybigpCiAgICAgICAgICAgIC5zZXRUeXBl\nKG1ldGguZ2V0UmV0dXJuVHlwZSgpKSwgZmFsc2UpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCBhc3NpZ25lZCBpbiB0aGUgZ2l2\nZW4gbWV0aG9kLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKiBQYWNrYWdlLXBy\nb3RlY3RlZCBhbmQgc3RhdGljIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBz\ndGF0aWMgQkNGaWVsZCBnZXRBc3NpZ25lZEZpZWxkKEJDTWV0aG9kIG1ldGgp\nIHsKICAgICAgICByZXR1cm4gZmluZEZpZWxkKG1ldGgsICgoQ29kZSkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSkpLnB1dGZpZWxkKCksIHRydWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCByZXR1\ncm5lZCAvIGFzc2lnbmVkIGJ5IDxjb2RlPm1ldGg8L2NvZGU+LiBSZXR1cm5z\nCiAgICAgKiBudWxsIGlmIG5vbi1maWVsZHMgKG1ldGhvZHMsIGxpdGVyYWxz\nLCBwYXJhbWV0ZXJzLCB2YXJpYWJsZXMpIGFyZQogICAgICogcmV0dXJuZWQs\nIG9yIGlmIG5vbi1wYXJhbWV0ZXJzIGFyZSBhc3NpZ25lZCB0byBmaWVsZHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEJDRmllbGQgZmluZEZpZWxk\nKEJDTWV0aG9kIG1ldGgsIEluc3RydWN0aW9uIHRlbXBsYXRlLAogICAgICAg\nIGJvb2xlYW4gZmluZEFjY2Vzc2VkKSB7CiAgICAgICAgLy8gaWdub3JlIGFu\neSBzdGF0aWMgbWV0aG9kcy4gT3BlbkpQQSBvbmx5IGN1cnJlbnRseSBzdXBw\nb3J0cwogICAgICAgIC8vIG5vbi1zdGF0aWMgc2V0dGVycyBhbmQgZ2V0dGVy\ncwogICAgICAgIGlmIChtZXRoLmlzU3RhdGljKCkpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUo\nZmFsc2UpOwogICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAg\nICAgICAgQkNGaWVsZCBmaWVsZCA9IG51bGwsIGN1cjsKICAgICAgICBJbnN0\ncnVjdGlvbiB0ZW1wbGF0ZUlucywgcHJldklucywgZWFybGllckluczsKICAg\nICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewog\nICAgICAgICAgICBpbnQgYmFja3VwQ291bnQgPSAzOwogICAgICAgICAgICB0\nZW1wbGF0ZUlucyA9IGNvZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgaWYg\nKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICAgICAgcHJldklucyA9IGNvZGUucHJldmlvdXMoKTsK\nCiAgICAgICAgICAgIGlmIChwcmV2SW5zIGluc3RhbmNlb2YgQ2xhc3NJbnN0\ncnVjdGlvbgogICAgICAgICAgICAgICAgJiYgY29kZS5oYXNQcmV2aW91cygp\nKSB7CiAgICAgICAgICAgICAgICBwcmV2SW5zID0gY29kZS5wcmV2aW91cygp\nOwogICAgICAgICAgICAgICAgYmFja3VwQ291bnQrKzsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZWFybGllcklu\ncyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBv\ncGNvZGUgdHdvIGJlZm9yZSB0aGUgdGVtcGxhdGUgd2FzIGFuIGFsb2FkXzAs\nIGNoZWNrCiAgICAgICAgICAgIC8vIGFnYWluc3QgdGhlIG1pZGRsZSBpbnN0\ncnVjdGlvbiBiYXNlZCBvbiB3aGF0IHR5cGUgb2YgZmluZAogICAgICAgICAg\nICAvLyB3ZSdyZSBkb2luZwogICAgICAgICAgICBpZiAoIShlYXJsaWVySW5z\nIGluc3RhbmNlb2YgTG9hZEluc3RydWN0aW9uKQogICAgICAgICAgICAgICAg\nfHwgISgoTG9hZEluc3RydWN0aW9uKSBlYXJsaWVySW5zKS5pc1RoaXMoKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8g\naWYgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiB3YXMgYSBnZXRmaWVsZCwgdGhl\nbiBpdCdzIHRoZQogICAgICAgICAgICAvLyBmaWVsZCB0aGF0J3MgYmVpbmcg\nYWNjZXNzZWQKICAgICAgICAgICAgaWYgKCFmaW5kQWNjZXNzZWQgJiYgcHJl\ndklucyBpbnN0YW5jZW9mIEdldEZpZWxkSW5zdHJ1Y3Rpb24pIHsKICAgICAg\nICAgICAgICAgIGZpbmFsIEZpZWxkSW5zdHJ1Y3Rpb24gZlByZXZJbnMgPSAo\nRmllbGRJbnN0cnVjdGlvbikgcHJldkluczsKICAgICAgICAgICAgICAgIGN1\nciA9IChCQ0ZpZWxkKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRGaWVsZElu\nc3RydWN0aW9uRmllbGRBY3Rpb24oZlByZXZJbnMpKTsKICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGFuIHhsb2Fk\nXzEsIHRoZW4gdGhlCiAgICAgICAgICAgICAgICAvLyBtYXRjaGVkIGluc3Ry\ndWN0aW9uIGlzIHRoZSBmaWVsZCB0aGF0J3MgYmVpbmcgc2V0LgogICAgICAg\nICAgICB9IGVsc2UgaWYgKGZpbmRBY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3Rh\nbmNlb2YgTG9hZEluc3RydWN0aW9uCiAgICAgICAgICAgICAgICAmJiAoKExv\nYWRJbnN0cnVjdGlvbikgcHJldklucykuZ2V0UGFyYW0oKSA9PSAwKSB7CiAg\nICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZUZW1wbGF0\nZUlucyA9CiAgICAgICAgICAgICAgICAgICAgKEZpZWxkSW5zdHJ1Y3Rpb24p\nIHRlbXBsYXRlSW5zOwogICAgICAgICAgICAgICAgY3VyID0gKEJDRmllbGQp\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVy\nCiAgICAgICAgICAgICAgICAgICAgLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVs\nZEFjdGlvbihmVGVtcGxhdGVJbnMpKTsKICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGlmIChm\naWVsZCAhPSBudWxsICYmIGN1ciAhPSBmaWVsZCkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgICAgICBmaWVsZCA9IGN1cjsKCiAgICAg\nICAgICAgIC8vIHJlYWR5IGZvciBuZXh0IHNlYXJjaCBpdGVyYXRpb24KICAg\nICAgICAgICAgd2hpbGUgKGJhY2t1cENvdW50ID4gMCkgewogICAgICAgICAg\nICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICBiYWNrdXBDb3Vu\ndC0tOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBm\naWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZCBhIHZpb2xhdGlv\nbiBvZiB0aGUgcHJvcGVydHkgYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZFZpb2xhdGlvbihTdHJpbmcga2V5LCBP\nYmplY3RbXSBhcmdzLCBib29sZWFuIGZhdGFsKSB7CiAgICAgICAgaWYgKF92\naW9sYXRpb25zID09IG51bGwpCiAgICAgICAgICAgIF92aW9sYXRpb25zID0g\nbmV3IEhhc2hTZXQoKTsKICAgICAgICBfdmlvbGF0aW9ucy5hZGQoX2xvYy5n\nZXQoa2V5LCBhcmdzKSk7CiAgICAgICAgX2ZhaWwgfD0gZmF0YWw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBMb2cgLyB0aHJvdyByZWNvcmRlZCBwcm9wZXJ0\neSBhY2Nlc3MgdmlvbGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHByb2Nlc3NWaW9sYXRpb25zKCkgewogICAgICAgIGlmIChfdmlvbGF0aW9u\ncyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFN0cmlu\nZyBzZXAgPSBKMkRvUHJpdkhlbHBlci5nZXRMaW5lU2VwYXJhdG9yKCk7CiAg\nICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF92aW9sYXRpb25zLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgp\nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChzZXApOwogICAgICAgIH0K\nICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJwcm9wZXJ0eS12aW9s\nYXRpb25zIiwgYnVmKTsKCiAgICAgICAgaWYgKF9mYWlsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihtc2cpOwogICAgICAgIGlmIChf\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy53YXJuKG1z\nZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlZCBhbGwgZGlyZWN0\nIGFjY2VzcyB0byBtYW5hZ2VkIGZpZWxkcyB3aXRoIHRoZSBhcHByb3ByaWF0\nZQogICAgICogcGNHZXQvcGNTZXQgbWV0aG9kLiBOb3RlIHRoYXQgdGhpcyBp\nbmNsdWRlcyBhY2Nlc3MgdG8gZmllbGRzCiAgICAgKiBvd25lZCBieSBQZXJz\naXN0ZW5jZUNhcGFibGUgY2xhc3NlcyBvdGhlciB0aGFuIHRoaXMgb25lLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVwbGFjZUFuZFZhbGlkYXRlRmll\nbGRBY2Nlc3MoKSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgcHV0ZmllbGQvZ2V0ZmllbGQgaW5z\ndHJ1Y3Rpb25zIHRvIHNlYXJjaCBmb3IKICAgICAgICBDb2RlIHRlbXBsYXRl\nID0gKENvZGUpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpOwogICAg\nICAgIEluc3RydWN0aW9uIHB1dCA9IHRlbXBsYXRlLnB1dGZpZWxkKCk7CiAg\nICAgICAgSW5zdHJ1Y3Rpb24gZ2V0ID0gdGVtcGxhdGUuZ2V0ZmllbGQoKTsK\nICAgICAgICBJbnN0cnVjdGlvbiBzdGF0ID0gdGVtcGxhdGUuaW52b2tlc3Rh\ndGljKCk7CgogICAgICAgIC8vIGxvb2sgdGhyb3VnaCBhbGwgbWV0aG9kczsg\ndGhpcyBpcyBkb25lIGJlZm9yZSBhbnkgbWV0aG9kcyBhcmUgYWRkZWQKICAg\nICAgICAvLyBzbyB3ZSBkb24ndCBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1\nZGluZyBzeW50aGV0aWMgbWV0aG9kcy4KICAgICAgICBCQ01ldGhvZFtdIG1l\ndGhvZHMgPSBfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2RzKCk7CiAg\nICAgICAgQ29kZSBjb2RlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbWV0aG9kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlID0gbWV0\naG9kc1tpXS5nZXRDb2RlKGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGRvbid0\nIG1vZGlmeSB0aGUgbWV0aG9kcyBzcGVjaWZpZWQgYnkgdGhlIGF1eGlsaWFy\neSBlbmhhbmNlcnMKICAgICAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCAmJiAh\nc2tpcEVuaGFuY2UobWV0aG9kc1tpXSkpIHsKICAgICAgICAgICAgICAgIHJl\ncGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKGNvZGUsIGdldCwgdHJ1ZSwg\nc3RhdCk7CiAgICAgICAgICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVs\nZEFjY2Vzcyhjb2RlLCBwdXQsIGZhbHNlLCBzdGF0KTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2VzIGFs\nbCBpbnN0cnVjdGlvbnMgbWF0Y2hpbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGlu\nIHRoZSBnaXZlbgogICAgICogY29kZSBibG9jayB3aXRoIGNhbGxzIHRvIHRo\nZSBhcHByb3ByaWF0ZSBnZW5lcmF0ZWQgZ2V0dGVyL3NldHRlci4KICAgICAq\nCiAgICAgKiBAcGFyYW0gY29kZSB0aGUgY29kZSBibG9jayB0byBtb2RpZnk7\nIHRoZSBjb2RlIGl0ZXJhdG9yIHdpbGwKICAgICAqIGJlIHBsYWNlZCBiZWZv\ncmUgdGhlIGZpcnN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBzdGFydCwKICAg\nICAqIGFuZCB3aWxsIGJlIGFmdGVyIHRoZSBsYXN0IGluc3RydWN0aW9uIG9u\nIG1ldGhvZCBjb21wbGV0aW9uCiAgICAgKiBAcGFyYW0gaW5zIHRoZSB0ZW1w\nbGF0ZSBpbnN0cnVjdGlvbiB0byBzZWFyY2ggZm9yOyBlaXRoZXIgYQogICAg\nICogZ2V0ZmllbGQgb3IgcHV0ZmllbGQgaW5zdHJ1Y3Rpb24KICAgICAqIEBw\nYXJhbSBnZXQgYm9vbGVhbiBpbmRpY2F0aW5nIGlmIHRoaXMgaXMgYSBnZXQg\naW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBzdGF0IHRlbXBsYXRlIGludm9r\nZXN0YXRpYyBpbnN0cnVjdGlvbiB0byByZXBsYWNlIHdpdGgKICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNz\nKENvZGUgY29kZSwgSW5zdHJ1Y3Rpb24gaW5zLAogICAgICAgIGJvb2xlYW4g\nZ2V0LCBJbnN0cnVjdGlvbiBzdGF0KSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAg\nIEZpZWxkSW5zdHJ1Y3Rpb24gZmk7CiAgICAgICAgTWV0aG9kSW5zdHJ1Y3Rp\nb24gbWk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBvd25lcjsKICAgICAgICBT\ndHJpbmcgbmFtZSwgdHlwZU5hbWUsIG1ldGhvZE5hbWU7CiAgICAgICAgd2hp\nbGUgKGNvZGUuc2VhcmNoRm9yd2FyZChpbnMpKSB7CiAgICAgICAgICAgIC8v\nIGJhY2sgdXAgdG8gdGhlIG1hdGNoZWQgaW5zdHJ1Y3Rpb24KICAgICAgICAg\nICAgZmkgPSAoRmllbGRJbnN0cnVjdGlvbikgY29kZS5wcmV2aW91cygpOwog\nICAgICAgICAgICBuYW1lID0gZmkuZ2V0RmllbGROYW1lKCk7CiAgICAgICAg\nICAgIHR5cGVOYW1lID0gZmkuZ2V0RmllbGRUeXBlTmFtZSgpOwogICAgICAg\nICAgICBvd25lciA9IGdldFBlcnNpc3RlbmNlQ2FwYWJsZU93bmVyKG5hbWUs\nIGZpLmdldEZpZWxkRGVjbGFyZXJUeXBlKCkpOwoKICAgICAgICAgICAgaWYg\nKG93bmVyICE9IG51bGwKICAgICAgICAgICAgICAgICYmIG93bmVyLmdldEFj\nY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkg\newogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgZGlyZWN0bHkgYWNjZXNz\naW5nIGEgZmllbGQgaW4gYW5vdGhlciBjbGFzcwogICAgICAgICAgICAgICAg\nLy8gaGllcmFyY2h5IHRoYXQgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MsIHNvbWV0\naGluZyBpcyB3cm9uZwogICAgICAgICAgICAgICAgaWYgKG93bmVyICE9IF9t\nZXRhICYmIG93bmVyLmdldERlY2xhcmVkRmllbGQobmFtZSkgIT0gbnVsbCAm\nJgogICAgICAgICAgICAgICAgICAgIF9tZXRhICE9IG51bGwgJiYgIW93bmVy\nLmdldERlc2NyaWJlZFR5cGUoKQogICAgICAgICAgICAgICAgICAgICAgICAu\naXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwcm9wZXJ0eS1maWVsZC1hY2Nlc3MiLAogICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IF9tZXRhLCBvd25lciwgbmFtZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0TWV0aG9kKCku\nZ2V0TmFtZSgpIH0pKTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSBk\naXJlY3RseSBhY2Nlc3NpbmcgYSBwcm9wZXJ0eS1iYWNraW5nIGZpZWxkIG91\ndHNpZGUKICAgICAgICAgICAgICAgIC8vIHRoZSBwcm9wZXJ0eSBpbiBvdXIg\nb3duIGNsYXNzLCBub3RpZnkgdXNlcgogICAgICAgICAgICAgICAgaWYgKGlz\nQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJvcGVydHkobmFtZSwgY29kZSkpCiAg\nICAgICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1maWVs\nZC1hY2Nlc3MiLCBuZXcgT2JqZWN0W117IF9tZXRhLAogICAgICAgICAgICAg\nICAgICAgICAgICBvd25lciwgbmFtZSwgY29kZS5nZXRNZXRob2QoKS5nZXRO\nYW1lKCkgfSwgZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAob3duZXIgPT0gbnVsbCB8fAogICAgICAgICAgICAgICAgb3duZXIuZ2V0\nRGVjbGFyZWRGaWVsZChmcm9tQmFja2luZ0ZpZWxkTmFtZShuYW1lKSkgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgLy8gbm90IHBlcnNpc3RlbnQgZmll\nbGQ/CiAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFnZXRSZWRl\nZmluZSgpICYmICFnZXRDcmVhdGVTdWJjbGFzcygpCiAgICAgICAgICAgICAg\nICAmJiBvd25lci5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5B\nQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAgICAgIC8vIHJlcGxhY2UgdGhl\nIGluc3RydWN0aW9uIHdpdGggYSBjYWxsIHRvIHRoZSBnZW5lcmF0ZWQgYWNj\nZXNzCiAgICAgICAgICAgICAgICAvLyBtZXRob2QKICAgICAgICAgICAgICAg\nIG1pID0gKE1ldGhvZEluc3RydWN0aW9uKSBjb2RlLnNldChzdGF0KTsKCiAg\nICAgICAgICAgICAgICAvLyBpbnZva2UgdGhlIHByb3BlciBhY2Nlc3MgbWV0\naG9kLCB3aGV0aGVyIGdldHRlciBvciBzZXR0ZXIKICAgICAgICAgICAgICAg\nIFN0cmluZyBwcmVmaXggPSAoZ2V0KSA/IFBSRSArICJHZXQiIDogUFJFICsg\nIlNldCI7CiAgICAgICAgICAgICAgICBtZXRob2ROYW1lID0gcHJlZml4ICsg\nbmFtZTsKICAgICAgICAgICAgICAgIGlmIChnZXQpIHsKICAgICAgICAgICAg\nICAgICAgICBtaS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lLCB0eXBlTmFt\nZSwgbmV3IFN0cmluZ1tdCiAgICAgICAgICAgICAgICAgICAgICAgIHsgZ2V0\nVHlwZShvd25lcikuZ2V0TmFtZSgpIH0pOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBtaS5zZXRNZXRob2QoZ2V0VHlw\nZShvd25lcikuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBt\nZXRob2ROYW1lLCAidm9pZCIsIG5ldyBTdHJpbmdbXQogICAgICAgICAgICAg\nICAgICAgICAgICB7IGdldFR5cGUob3duZXIpLmdldE5hbWUoKSwgdHlwZU5h\nbWUgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChnZXRSZWRlZmluZSgp\nKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gZnJvbUJhY2tpbmdGaWVsZE5h\nbWUobmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAg\nICAgICAgICAgICAgYWRkTm90aWZ5QWNjZXNzKGNvZGUsIG93bmVyLmdldEZp\nZWxkKG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8gaW5zZXJ0IHRoZSBzZXQgb3BlcmF0aW9ucyBhZnRlciB0aGUgZmllbGQg\nbXV0YXRpb24sIGJ1dAogICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IGxv\nYWQgdGhlIG9sZCB2YWx1ZSBmb3IgdXNlIGluIHRoZQogICAgICAgICAgICAg\nICAgICAgIC8vIFN0YXRlTWFuYWdlci5zZXR0aW5nWFhYIG1ldGhvZC4KICAg\nICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0\naW9uIGZGaSA9IGZpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZCgKICAgICAgICAgICAgICAgICAgICAgICAgKEJDRmll\nbGQpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVs\ncGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0RmllbGRJbnN0\ncnVjdGlvbkZpZWxkQWN0aW9uKGZGaSkpKTsKICAgICAgICAgICAgICAgICAg\nICBpbnQgdmFsID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLnhzdG9yZSgpLnNldExvY2FsKHZhbCkuc2V0\nVHlwZShmaS5nZXRGaWVsZFR5cGUoKSk7CgogICAgICAgICAgICAgICAgICAg\nIC8vIG1vdmUgcGFzdCB0aGUgcHV0ZmllbGQKICAgICAgICAgICAgICAgICAg\nICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBhZGROb3RpZnlN\ndXRhdGlvbihjb2RlLCBvd25lci5nZXRGaWVsZChuYW1lKSwgdmFsLCAtMSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBhZGROb3RpZnlBY2Nlc3MoQ29kZSBjb2RlLCBGaWVs\nZE1ldGFEYXRhIGZtZCkgewogICAgICAgIC8vIFBDSGVscGVyLmFjY2Vzc2lu\nZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0ZS1pbmRleD4pOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGZtZC5nZXRJbmRleCgpKTsKICAgICAgICBjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsCiAg\nICAgICAgICAgICJhY2Nlc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3Mg\nfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG11c3QgYmUgY2FsbGVk\nIGFmdGVyIHNldHRpbmcgdGhlIHZhbHVlIGluIHRoZSBvYmplY3QuCiAgICAg\nKiAKICAgICAqIEBwYXJhbSBjb2RlCiAgICAgKiBAcGFyYW0gdmFsIHRoZSBw\nb3NpdGlvbiBpbiB0aGUgbG9jYWwgdmFyaWFibGUgdGFibGUgd2hlcmUgdGhl\nCiAgICAgKiBvbGQgdmFsdWUgaXMgc3RvcmVkCiAgICAgKiBAcGFyYW0gcGFy\nYW0gdGhlIHBhcmFtZXRlciBwb3NpdGlvbiBjb250YWluaW5nIHRoZSBuZXcg\ndmFsdWUsIG9yCiAgICAgKiAtMSBpZiB0aGUgbmV3IHZhbHVlIGlzIHVuYXZh\naWxhYmxlIGFuZCBzaG91bGQgdGhlcmVmb3JlIGJlIGxvb2tlZAogICAgICog\ndXAuCiAgICAgKiBAdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkTm90aWZ5TXV0YXRpb24oQ29kZSBj\nb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCwgaW50IHZhbCwKICAgICAgICBpbnQg\ncGFyYW0pCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gUENIZWxwZXIuc2V0dGluZ0ZpZWxkKHRoaXMsIDxhYnNv\nbHV0ZS1pbmRleD4sIG9sZCwgbmV3KTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKTsKICAgICAgICAvLyB3ZSBvbmx5IGhhdmUgc3BlY2lh\nbCBzaWduYXR1cmVzIGZvciBwcmltaXRpdmVzIGFuZCBTdHJpbmdzCiAgICAg\nICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBTdHJpbmcu\nY2xhc3MpCiAgICAgICAgICAgIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAg\nICAgY29kZS54bG9hZCgpLnNldExvY2FsKHZhbCkuc2V0VHlwZSh0eXBlKTsK\nICAgICAgICBpZiAocGFyYW0gPT0gLTEpIHsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0ocGFyYW0pLnNl\ndFR5cGUodHlwZSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKFJlZGVmaW5pdGlvbkhlbHBlci5jbGFzcywgInNl\ndHRpbmdGaWVsZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdIHsKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgaW50LmNsYXNz\nLCB0eXBlLCB0eXBlCiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNz\nZXMgYSBmaWVsZCB0aGF0IGlzIGEgYmFja2luZwogICAgICogZmllbGQgb2Yg\nYW5vdGhlciBwcm9wZXJ0eSBpbiB0aGlzIHByb3BlcnR5LWFjY2VzcyBjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzQmFja2luZ0ZpZWxk\nT2ZBbm90aGVyUHJvcGVydHkoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewog\nICAgICAgIFN0cmluZyBtZXRoTmFtZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0\nTmFtZSgpOwogICAgICAgIHJldHVybiAhIjxpbml0PiIuZXF1YWxzKG1ldGhO\nYW1lKQogICAgICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAg\nICAgICAgICAgICYmICFuYW1lLmVxdWFscyhfYmFja2luZ0ZpZWxkcy5nZXQo\nbWV0aE5hbWUpKQogICAgICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcy5jb250\nYWluc1ZhbHVlKG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVy\nIG1ldGhvZCB0byByZXR1cm4gdGhlIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNh\ncGFibGUgY2xhc3Mgb2YKICAgICAqIHRoZSBnaXZlbiBmaWVsZC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZmllbGROYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVs\nZAogICAgICogQHBhcmFtIG93bmVyIHRoZSBub21pbmFsIG93bmVyIG9mIHRo\nZSBmaWVsZAogICAgICogQHJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUgdHlwZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0\naGUgZmllbGQgKGFuZCB0aGVyZWZvcmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9k\nKSwgb3IgbnVsbCBpZiBub25lCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NN\nZXRhRGF0YSBnZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihTdHJpbmcgZmll\nbGROYW1lLAogICAgICAgIENsYXNzIG93bmVyKSB7CiAgICAgICAgLy8gZmlu\nZCB0aGUgYWN0dWFsIGFuY2VzdG9yIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhl\nIGZpZWxkLCB0aGVuCiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlz\nIHBlcnNpc3RlbnQsIGFuZCBpZiB0aGUgZmllbGQgaXMgbWFuYWdlZAogICAg\nICAgIEZpZWxkIGYgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvd25lciwgZmll\nbGROYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGYgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIG1hbmFnZWQgaW50ZXJm\nYWNlCiAgICAgICAgaWYgKF9tZXRhICE9IG51bGwgJiYgX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHJldHVy\nbiBfbWV0YTsKCiAgICAgICAgcmV0dXJuIF9yZXBvcy5nZXRNZXRhRGF0YShm\nLmdldERlY2xhcmluZ0NsYXNzKCksIG51bGwsIGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgYWxsIHN5bnRoZXRpYyBtZXRob2RzIHRvIHRo\nZSBieXRlY29kZSBieSBkZWxlZ2F0aW5nIHRvCiAgICAgKiB0aGUgdmFyaW91\ncyBhZGRYWFhNZXRob2RzICgpIGZ1bmN0aW9ucyBpbiB0aGlzIGNsYXNzLiBJ\nbmNsdWRlcwogICAgICogYWxsIHN0YXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9k\ncy4KICAgICAqIE5vdGUgdGhhdCB0aGUgJ3N0b2NrJyBtZXRob2RzIGxpa2Ug\nPGNvZGU+cGNJc1RyYW5zYWN0aW9uYWw8L2NvZGU+LAogICAgICogPGNvZGU+\ncGNGZXRjaE9iamVjdElkPC9jb2RlPiwgZXRjIGFyZSBkZWZpbmVkIG9ubHkg\naW4gdGhlCiAgICAgKiBsZWFzdC1kZXJpdmVkIFBlcnNpc3RlbmNlQ2FwYWJs\nZSB0eXBlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUENNZXRob2Rz\nKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICBhZGRDbGVhckZpZWxkc01ldGhvZCgpOwogICAgICAgIGFkZE5ld0lu\nc3RhbmNlTWV0aG9kKHRydWUpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0\naG9kKGZhbHNlKTsKICAgICAgICBhZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhv\nZCgpOwogICAgICAgIGFkZFJlcGxhY2VGaWVsZHNNZXRob2RzKCk7CiAgICAg\nICAgYWRkUHJvdmlkZUZpZWxkc01ldGhvZHMoKTsKICAgICAgICBhZGRDb3B5\nRmllbGRzTWV0aG9kKCk7CgogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVy\nY2xhc3MoKSA9PSBudWxsIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAg\nICAgICAgICAgYWRkU3RvY2tNZXRob2RzKCk7CiAgICAgICAgICAgIGFkZEdl\ndFZlcnNpb25NZXRob2QoKTsKICAgICAgICAgICAgYWRkUmVwbGFjZVN0YXRl\nTWFuYWdlck1ldGhvZCgpOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElk\nZW50aXR5VHlwZSgpICE9IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04p\nCiAgICAgICAgICAgICAgICBhZGROb09wQXBwbGljYXRpb25JZGVudGl0eU1l\ndGhvZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCB0aGUgYXBwIGlk\nIG1ldGhvZHMgdG8gZWFjaCBzdWJjbGFzcyByYXRoZXIKICAgICAgICAvLyB0\naGFuIGp1c3QgdGhlIHN1cGVyY2xhc3MsIHNpbmNlIGl0IGlzIHBvc3NpYmxl\nIHRvIGhhdmUKICAgICAgICAvLyBhIHN1YmNsYXNzIHdpdGggYW4gYXBwIGlk\nIGhpZXJhcmNoeSB0aGF0IG1hdGNoZXMgdGhlCiAgICAgICAgLy8gcGVyc2lz\ndGVudCBjbGFzcyBpbmhlcml0YW5jZSBoaWVyYXJjaHkKICAgICAgICBpZiAo\nX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9B\nUFBMSUNBVElPTgogICAgICAgICAgICAmJiAoX21ldGEuZ2V0UENTdXBlcmNs\nYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpIHx8CiAgICAg\nICAgICAgICAgICBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSAhPQogICAgICAg\nICAgICAgICAgICAgIF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\nZ2V0T2JqZWN0SWRUeXBlKCkpKSB7CiAgICAgICAgICAgIGFkZENvcHlLZXlG\naWVsZHNUb09iamVjdElkTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGRD\nb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAg\nICAgIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7\nCiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRo\nb2QoZmFsc2UpOwogICAgICAgICAgICBhZGROZXdPYmplY3RJZEluc3RhbmNl\nTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGROZXdPYmplY3RJZEluc3Rh\nbmNlTWV0aG9kKGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgYSBtZXRob2QgdG8gY2xlYXIgYWxsIHBlcnNpc3RlbnQgZmll\nbGRzOyB3ZSdsbCBjYWxsIHRoaXMgZnJvbQogICAgICogdGhlIG5ldyBpbnN0\nYW5jZSBtZXRob2QgdG8gZW5zdXJlIHRoYXQgdW5sb2FkZWQgZmllbGRzIGhh\ndmUKICAgICAqIGRlZmF1bHQgdmFsdWVzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkQ2xlYXJGaWVsZHNNZXRob2QoKQogICAgICAgIHRocm93cyBO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHByb3RlY3RlZCB2\nb2lkIHBjQ2xlYXJGaWVsZHMgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lk\nLmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBtZXRob2QubWFr\nZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci5wY0NsZWFyRmllbGRzICgp\nCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwg\nJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAg\nICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKSwgUFJFICsgIkNsZWFyRmll\nbGRzIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG51bGwpOwogICAg\nICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5n\nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1kc1tp\nXS5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVS\nU0lTVEVOVCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSgwKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBMKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51\nbGwoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBm\nbWRzW2ldKTsKICAgICAgICB9CgogICAgICAgIGNvZGUudnJldHVybigpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkcyB0aGUgPGNvZGU+cGNOZXdJbnN0YW5jZTwvY29kZT4gbWV0aG9kIHRv\nIHRoZSBieXRlY29kZS4KICAgICAqIFRoZXNlIG1ldGhvZHMgYXJlIHVzZWQg\nYnkgdGhlIGltcGwgaGVscGVyIHRvIGNyZWF0ZSBuZXcKICAgICAqIG1hbmFn\nZWQgaW5zdGFuY2VzIGVmZmljaWVudGx5IHdpdGhvdXQgcmVmbGVjdGlvbi4K\nICAgICAqCiAgICAgKiBAcGFyYW0gb2lkIHNldCB0byB0cnVlIHRvIG1pbWlj\nIHRoZSBtZXRob2QgdmVyc2lvbiB0aGF0IHRha2VzCiAgICAgKiBhbiBvaWQg\ndmFsdWUgYXMgd2VsbCBhcyBhIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZE5ld0luc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2lk\nKSB7CiAgICAgICAgLy8gcHVibGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBwY05l\nd0luc3RhbmNlICguLi4pCiAgICAgICAgQ2xhc3NbXSBhcmdzID0KICAgICAg\nICAgICAgKG9pZCkgPyBuZXcgQ2xhc3NbXXsgU01UWVBFLCBPYmplY3QuY2xh\nc3MsIGJvb2xlYW4uY2xhc3MgfQogICAgICAgICAgICAgICAgOiBuZXcgQ2xh\nc3NbXXsgU01UWVBFLCBib29sZWFuLmNsYXNzIH07CiAgICAgICAgQkNNZXRo\nb2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5ld0luc3Rh\nbmNlIiwgUENUWVBFLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgdGhlIHR5cGUgaXMg\nYWJzdHJhY3QsIHRocm93IGEgVXNlckV4Y2VwdGlvbgogICAgICAgIGlmIChf\ncGMuaXNBYnN0cmFjdCgpKSB7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9u\nKGNvZGUsIFVTRVJFWENFUCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigp\nOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBYWFggcGMgPSBuZXcg\nWFhYICgpOwogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX3BjKTsKICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgaW50IGluc3QgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaW5zdCk7CgogICAgICAgIC8v\nIGlmIChjbGVhcikKICAgICAgICAvLyAgIHBjLnBjQ2xlYXJGaWVsZHMgKCk7\nCiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKChvaWQpID8gMiA6IDEp\nOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBub2NsZWFyID0gY29kZS5pZmVx\nKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiQ2xl\nYXJGaWVsZHMiLCB2b2lkLmNsYXNzLCBudWxsKTsKCiAgICAgICAgLy8gcGMu\ncGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAgICBub2NsZWFyLnNldFRhcmdl\ndChjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCkpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CgogICAgICAgIC8vIGNvcHkga2V5IGZp\nZWxkcyBmcm9tIG9pZAogICAgICAgIGlmIChvaWQpIHsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21P\nYmplY3RJZCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8g\ncmV0dXJuIHBjOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0\nKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5w\ncm90ZWN0ZWQgc3RhdGljIGludCBwY0dldE1hbmFnZWRGaWVsZENvdW50ICgp\nPC9jb2RlPgogICAgICogbWV0aG9kIHRvIHRoZSBieXRlY29kZSwgcmV0dXJu\naW5nIHRoZSBpbmhlcml0ZWQgZmllbGQgY291bnQgYWRkZWQKICAgICAqIHRv\nIHRoZSBudW1iZXIgb2YgbWFuYWdlZCBmaWVsZHMgaW4gdGhlIGN1cnJlbnQg\nUGVyc2lzdGVuY2VDYXBhYmxlIGNsYXNzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkTWFuYWdlZEZpZWxkQ291bnRNZXRob2QoKSB7CiAgICAgICAg\nLy8gcHJvdGVjdGVkIHN0YXRpYyBpbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3Vu\ndCAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJHZXRNYW5hZ2VkRmllbGRDb3VudCIsCiAgICAgICAgICAg\nIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLnNldFN0YXRpYyh0\ncnVlKTsKICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAv\nLyByZXR1cm4gPGZpZWxkcz4gKyBwY0luaGVyaXRlZEZpZWxkQ291bnQKICAg\nICAgICAvLyBhd2hpdGU6IHRoZSBhYm92ZSBzaG91bGQgd29yaywgYnV0IEkn\nbSBzZWVpbmcgYSBtZXNzZWQgdXAgc2l0dWF0aW9uCiAgICAgICAgLy8gYWxs\nIG9mIGEgc3VkZGVuIHdoZXJlIHdoZW4gYSBzdWJjbGFzcyBjYWxscyB0aGlz\nIG1ldGhvZCwgaXQgc29tZWhvdwogICAgICAgIC8vIGhhcHBlbnMgYmVmb3Jl\nIDxjbGluaXQ+IGlzIGV2ZXIgaW52b2tlZCwgYW5kIHNvIG91cgogICAgICAg\nIC8vIHBjSW5oZXJpdGVkRmllbGRDb3VudCBmaWVsZCBpc24ndCBpbml0aWFs\naXplZCEgIHNvIGluc3RlYWQsCiAgICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+\nICsgPHN1cGVyY2xhc3M+LnBjR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoX21ldGEuZ2V0RGVjbGFy\nZWRGaWVsZHMoKS5sZW5ndGgpOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1\ncGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzIHN1cGVy\nQ2xhc3MgPSBnZXRUeXBlKF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCkpOwogICAgICAgICAgICBTdHJpbmcgc3VwZXJOYW1lID0gZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSA/CiAgICAgICAgICAgICAgICBQQ0VuaGFuY2VyLnRvUENT\ndWJjbGFzc05hbWUoc3VwZXJDbGFzcykgOgogICAgICAgICAgICAgICAgc3Vw\nZXJDbGFzcy5nZXROYW1lKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKHN1cGVyTmFtZSwKICAgICAgICAgICAgICAgIFBS\nRSArICJHZXRNYW5hZ2VkRmllbGRDb3VudCIsIGludC5jbGFzcy5nZXROYW1l\nKCksIG51bGwpOwogICAgICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICB9\nCiAgICAgICAgY29kZS5pcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUg\ne0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1Byb3ZpZGVGaWVsZH0gYW5k\nCiAgICAgKiB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZp\nZWxkc30gbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRQcm92aWRlRmllbGRzTWV0aG9kcygpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVi\nbGljIHZvaWQgcGNQcm92aWRlRmllbGQgKGludCBmaWVsZE51bWJlcikKICAg\nICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUg\nKyAiUHJvdmlkZUZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3\nIENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRo\naW5nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2Nh\nbCA9IGJlZ2luU3dpdGNoTWV0aG9kKFBSRSArICJQcm92aWRlRmllbGQiLCBj\nb2RlKTsKCiAgICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwg\nanVzdCB0aHJvdyBleGNlcHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMo\nKQogICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93\nRXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFz\ncyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFs\nKQogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwp\nOwogICAgICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9\nIGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExv\ndygwKTsKICAgICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGgg\nLSAxKTsKCiAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdl\nci5wcm92aWRlZDx0eXBlPkZpZWxkCiAgICAgICAgICAgIC8vICAgICAodGhp\ncywgZmllbGROdW1iZXIpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYmlu\ncy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmlsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChnZXRTdGF0ZU1hbmFn\nZXJNZXRob2QKICAgICAgICAgICAgICAgICAgICAoZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGUoKSwgInByb3ZpZGVkIiwgZmFsc2UsIGZhbHNlKSk7CiAgICAg\nICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0YWJpbnMuc2V0RGVmYXVsdFRh\ncmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAgICAgICAgKGNvZGUsIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwogICAgICAgIH0KCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIGFkZE11bHRpcGxlRmll\nbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxh\nY2VGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxl\nI3BjUmVwbGFjZUZpZWxkc30gbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGUuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZXBsYWNlRmllbGRzTWV0aG9k\ncygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gcHVibGljIHZvaWQgcGNSZXBsYWNlRmllbGQgKGludCBmaWVs\nZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFy\nZU1ldGhvZChQUkUgKyAiUmVwbGFjZUZpZWxkIiwgdm9pZC5jbGFzcywKICAg\nICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\nYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQogICAgICAg\nIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0aG9kKFBSRSArICJSZXBs\nYWNlRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8gaWYgbm8gZmllbGRzIGlu\nIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRpb24KICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0\nYS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVk\nRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDApCiAgICAg\nICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8v\nIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9j\nYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0\naW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAgICAg\ndGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFiaW5zLnNldEhpZ2go\nZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBw\nY1N0YXRlTWFuYWdlci5yZXBsYWNlPHR5cGU+RmllbGQKICAgICAgICAgICAg\nLy8gICh0aGlzLCBmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgLy8gZm9yIHRoZSBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlIGNhbGwgYmVs\nb3cuCiAgICAgICAgICAgICAgICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKCiAgICAgICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRo\nb2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgICAgICAgICAg\nKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksICJyZXBsYWNlIiwgdHJ1ZSwg\nZmFsc2UpKTsKICAgICAgICAgICAgICAgIGlmICghZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGUoKS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xhcmVk\nVHlwZSgpKTsKCiAgICAgICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVD\nb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgICAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAg\nICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24K\nICAgICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwoKICAgICAgICBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24obWV0\naG9kKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQ\nZXJzaXN0ZW5jZUNhcGFibGUjcGNDb3B5RmllbGRzfSBtZXRob2QgdG8gdGhl\nIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUZp\nZWxkc01ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5RmllbGQgKE9i\namVjdCBwYywgaW50IGZpZWxkKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5RmllbGQiLAogICAgICAg\nICAgICB2b2lkLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgbmV3IFN0\ncmluZ1tdeyBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBpbnQuY2xhc3MuZ2V0\nTmFtZSgpIH0pOwogICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkK\nICAgICAgICBpbnQgcmVsTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQUkUg\nKyAiQ29weUZpZWxkIiwgY29kZSk7CgogICAgICAgIC8vIGlmIG5vIGZpZWxk\ncyBpbiB0aGlzIGluc3QsIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8g\nX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNs\nYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGVsc2UgewogICAgICAgICAg\nICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNl\ndExvY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0\ncnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAg\nICAgIHRhYmlucy5zZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRI\naWdoKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nIC8vIDxmaWVsZD4gPSBvdGhlci48ZmllbGQ+OwogICAgICAgICAgICAgICAg\nLy8gb3Igc2V0PGZpZWxkPiAob3RoZXIuZ2V0PGZpZWxkPik7CiAgICAgICAg\nICAgICAgICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgZm1kc1tpXSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKCiAgICAg\nICAgICAgICAgICAvLyBicmVhazsKICAgICAgICAgICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWZhdWx0\nOiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAg\nICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9u\nCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0\naW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9uKG1l\ndGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRv\nIGFkZCB0aGUgY29kZSBjb21tb24gdG8gdGhlIGJlZ2lubmluZyBvZiBib3Ro\nIHRoZQogICAgICogcGNSZXBsYWNlRmllbGQgbWV0aG9kIGFuZCB0aGUgcGNQ\ncm92aWRlRmllbGQgbWV0aG9kLiBUaGlzIGluY2x1ZGVzCiAgICAgKiBjYWxj\ndWxhdGluZyB0aGUgcmVsYXRpdmUgZmllbGQgbnVtYmVyIG9mIHRoZSBkZXNp\ncmVkIGZpZWxkIGFuZCBjYWxsaW5nCiAgICAgKiB0aGUgc3VwZXJjbGFzcyBp\nZiBuZWNlc3NhcnkuCiAgICAgKgogICAgICogQHJldHVybiB0aGUgaW5kZXgg\naW4gd2hpY2ggdGhlIGxvY2FsIHZhcmlhYmxlIGhvbGRpbmcgdGhlIHJlbGF0\naXZlCiAgICAgKiBmaWVsZCBudW1iZXIgaXMgc3RvcmVkCiAgICAgKi8KICAg\nIHByaXZhdGUgaW50IGJlZ2luU3dpdGNoTWV0aG9kKFN0cmluZyBuYW1lLCBD\nb2RlIGNvZGUpIHsKICAgICAgICBib29sZWFuIGNvcHkgPSAoUFJFICsgIkNv\ncHlGaWVsZCIpLmVxdWFscyhuYW1lKTsKICAgICAgICBpbnQgZmllbGROdW1i\nZXIgPSAoY29weSkgPyAxIDogMDsKCiAgICAgICAgaW50IHJlbExvY2FsID0g\nY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBpZiAoZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0\nUGFyYW0oZmllbGROdW1iZXIpOwogICAgICAgICAgICBjb2RlLmlzdG9yZSgp\nLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgcmV0dXJuIHJlbExv\nY2FsOwogICAgICAgIH0KCiAgICAgICAgLy8gaW50IHJlbCA9IGZpZWxkTnVt\nYmVyIC0gcGNJbmhlcml0ZWRGaWVsZENvdW50CiAgICAgICAgY29kZS5pbG9h\nZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsKICAgICAgICBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAg\nY29kZS5pc3ViKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChy\nZWxMb2NhbCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExv\nY2FsKTsKCiAgICAgICAgLy8gc3VwZXI6IGlmIChyZWwgPCAwKSBzdXBlci5w\nY1JlcGxhY2VGaWVsZCAoZmllbGROdW1iZXIpOyByZXR1cm47CiAgICAgICAg\nLy8gbm8gc3VwZXI6IGlmIChyZWwgPCAwKSB0aHJvdyBuZXcgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uICgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBp\nZmlucyA9IGNvZGUuaWZnZSgpOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1\ncGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBTdHJpbmdbXSBh\ncmdzOwogICAgICAgICAgICBpZiAoY29weSkgewogICAgICAgICAgICAgICAg\nYXJncyA9IG5ldyBTdHJpbmdbXXsgZ2V0VHlwZShfbWV0YS5nZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAgICAgICBnZXROYW1l\nKCksIGludC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0cmluZ1tdeyBpbnQuY2xhc3Mu\nZ2V0TmFtZSgpIH07CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJh\nbShmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAg\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLCBuYW1lLCAK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsK\nICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbi5jbGFzcyk7CgogICAgICAgIGlmaW5zLnNldFRhcmdldChj\nb2RlLm5vcCgpKTsKICAgICAgICByZXR1cm4gcmVsTG9jYWw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGlzIGhlbHBlciBtZXRob2QsIGdpdmVuIHRoZSBw\nY1JlcGxhY2VGaWVsZCBvciBwY1Byb3ZpZGVGaWVsZAogICAgICogbWV0aG9k\nLCBhZGRzIHRoZSBieXRlY29kZSBmb3IgdGhlIGNvcnJlc3BvbmRpbmcgJ3Bs\ndXJhbCcgdmVyc2lvbgogICAgICogb2YgdGhlIG1ldGhvZCAtLSB0aGUgdmVy\nc2lvbiB0aGF0IHRha2VzIGFuIGludFtdIG9mIGZpZWxkcyB0bwogICAgICog\ndG8gYWNjZXNzIHJhdGhlciB0aGFuIGEgc2luZ2xlIGZpZWxkLiBUaGUgbXVs\ndGlwbGUgZmllbGRzIHZlcnNpb24KICAgICAqIHNpbXBseSBsb29wcyB0aHJv\ndWdoIHRoZSBwcm92aWRlZCBpbmRleGVzIGFuZCBkZWxlZ2F0ZXMgdG8gdGhl\nCiAgICAgKiBzaW5ndWxhciB2ZXJzaW9uIGZvciBlYWNoIG9uZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVy\nc2lvbihCQ01ldGhvZCBzaW5nbGUpIHsKICAgICAgICBib29sZWFuIGNvcHkg\nPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhzaW5nbGUuZ2V0TmFtZSgp\nKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgPG1ldGhvZD5zIChpbnRbXSBm\naWVsZHMpCiAgICAgICAgQ2xhc3NbXSBhcmdzID0gKGNvcHkpID8gbmV3IENs\nYXNzW117IE9iamVjdC5jbGFzcywgaW50W10uY2xhc3MgfQogICAgICAgICAg\nICA6IG5ldyBDbGFzc1tdeyBpbnRbXS5jbGFzcyB9OwogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKHNpbmdsZS5nZXROYW1l\nKCkgKyAicyIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIGFyZ3MpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICBpbnQgZmllbGROdW1iZXJzID0gMDsKICAgICAgICBpbnQgaW5zdCA9IDA7\nCiAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgZmllbGROdW1iZXJz\nID0gMTsKCiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7\nCiAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIG1hbmFnZWQgaW5zdGFuY2Ug\naW50byB0aGUgbG9jYWwgdmFyaWFibGUgdGFibGUKICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKEltcGxIZWxwZXIuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAgICAgImdldE1hbmFnZWRJbnN0YW5jZSIsIE9i\namVjdC5jbGFzcywKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7\nIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShfbWFuYWdlZFR5cGUpOwogICAgICAgICAgICAgICAg\naW5zdCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGluc3QpOwoKICAgICAgICAg\nICAgICAgIC8vIHRoZXJlIG1pZ2h0IGJlIGEgZGlmZmVyZW5jZSBiZXR3ZWVu\nIHRoZSBjbGFzc2VzIG9mICd0aGlzJwogICAgICAgICAgICAgICAgLy8gdnMg\nJ290aGVyJyBpbiB0aGlzIGNvbnRleHQ7IHVzZSB0aGUgUEMgbWV0aG9kcyB0\nbyBnZXQgdGhlIFNNCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoSW1wbEhlbHBlci5jbGFzcywKICAgICAgICAgICAg\nICAgICAgICAidG9QZXJzaXN0ZW5jZUNhcGFibGUiLCBQZXJzaXN0ZW5jZUNh\ncGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW10g\neyBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICAgICAicGNHZXRT\ndGF0ZU1hbmFnZXIiLCBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gWFhYIG90aGVy\nID0gKFhYWCkgcGM7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoX3BjKTsKICAgICAgICAgICAgICAgIGluc3QgPSBjb2RlLmdldE5l\neHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgY29kZS5hc3RvcmUo\nKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAgICAgICAgICAvLyBhY2Nlc3Mg\ndGhlIG90aGVyJ3Mgc20gZmllbGQgZGlyZWN0bHkKICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICAgICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgKG90aGVyLnBjU3RhdGVNYW5h\nZ2VyICE9IHBjU3RhdGVNYW5hZ2VyKQogICAgICAgICAgICAvLwl0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uCgogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmYWNtcGVxKCk7CiAg\nICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdl\ndChjb2RlLm5vcCgpKTsKCiAgICAgICAgICAgIC8vIGlmIChwY1N0YXRlTWFu\nYWdlciA9PSBudWxsKQogICAgICAgICAgICAvLyAgdGhyb3cgbmV3IElsbGVn\nYWxTdGF0ZUV4Y2VwdGlvbgogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBpZmlucyA9IGNv\nZGUuaWZub25udWxsKCk7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNv\nZGUsIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGZvciAoaW50IGkgPSAwOwogICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgwKTsKICAgICAgICBpbnQgaWR4ID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2Fs\nKGlkeCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIHRlc3RpbnMgPSBjb2Rl\nLmdvMigpOwoKICAgICAgICAvLyA8bWV0aG9kPiAoZmllbGRzW2ldKTsKICAg\nICAgICBJbnN0cnVjdGlvbiBib2R5aW5zID0gbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgaWYgKGNvcHkpCiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXJzKTsKICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0TG9jYWwoaWR4KTsKICAgICAgICBjb2RlLmlhbG9hZCgpOwog\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChzaW5nbGUp\nOwoKICAgICAgICAvLyBpKys7CiAgICAgICAgY29kZS5paW5jKCkuc2V0SW5j\ncmVtZW50KDEpLnNldExvY2FsKGlkeCk7CgogICAgICAgIC8vIGkgPCBmaWVs\nZHMubGVuZ3RoCiAgICAgICAgdGVzdGlucy5zZXRUYXJnZXQoY29kZS5pbG9h\nZCgpLnNldExvY2FsKGlkeCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbShmaWVsZE51bWJlcnMpOwogICAgICAgIGNvZGUuYXJyYXlsZW5ndGgo\nKTsKICAgICAgICBjb2RlLmlmaWNtcGx0KCkuc2V0VGFyZ2V0KGJvZHlpbnMp\nOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlICdzdG9jaycg\nbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGU7IHRoZXNlIGluY2x1ZGUgbWV0aG9k\ncwogICAgICogbGlrZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjRmV0\nY2hPYmplY3RJZH0KICAgICAqIGFuZCB7QGxpbmsgUGVyc2lzdGVuY2VDYXBh\nYmxlI3BjSXNUcmFuc2FjdGlvbmFsfS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFN0b2NrTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g\ncGNHZXRHZW5lcmljQ29udGV4dAogICAgICAgICAgICB0cmFuc2xhdGVGcm9t\nU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24o\nCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImdldCIgKyBDT05U\nRVhUTkFNRSwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAg\nICAgICAgIC8vIHBjRmV0Y2hPYmplY3RJZAogICAgICAgICAgICB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1l\ndGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RB\nY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImZldGNo\nT2JqZWN0SWQiLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAg\nICAgICAgICAgLy8gcGNJc0RlbGV0ZWQKICAgICAgICAgICAgdHJhbnNsYXRl\nRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChNZXRo\nb2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0\naW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJpc0RlbGV0\nZWQiLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAg\nICAgLy8gcGNJc0RpcnR5CiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0\nZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNEaXJ0eSIsIChDbGFz\nc1tdKSBudWxsKSksIHRydWUpOwogICAgCiAgICAgICAgICAgIC8vIHBjSXNO\nZXcKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhv\nZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICBTTVRZUEUsICJpc05ldyIsIChDbGFzc1tdKSBudWxsKSksIGZh\nbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzUGVyc2lzdGVudAogICAg\nICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAg\nICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nRGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAg\nIFNNVFlQRSwgImlzUGVyc2lzdGVudCIsIChDbGFzc1tdKSBudWxsKSksIGZh\nbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzVHJhbnNhY3Rpb25hbAog\nICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAog\nICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAg\nICAgIFNNVFlQRSwgImlzVHJhbnNhY3Rpb25hbCIsIChDbGFzc1tdKSBudWxs\nKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY1NlcmlhbGl6aW5n\nCiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2Qo\nCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAg\nICAgICAgU01UWVBFLCAic2VyaWFsaXppbmciLCAoQ2xhc3NbXSkgbnVsbCkp\nLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNEaXJ0eQogICAgICAg\nICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAg\nICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVj\nbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNN\nVFlQRSwgImRpcnR5IiwgbmV3IENsYXNzW117IFN0cmluZy5jbGFzcyB9KSks\nIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0dldFN0YXRlTWFuYWdl\ncgogICAgICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIkdldFN0YXRlTWFuYWdlciIsCiAgICAgICAgICAgICAgICBT\ndGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFN0YXRlTWFuYWdlci5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlv\nbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgIHRocm93IChOb1N1Y2hN\nZXRob2RFeGNlcHRpb24pIHBhZS5nZXRFeGNlcHRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBh\nIHN0b2NrIG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuIEVhY2gKICAgICAqIHN0\nb2NrIG1ldGhvZCBzaW1wbHkgZGVsZWdhdGVzIHRvIGEgY29ycmVzcG9uZGlu\nZyBTdGF0ZU1hbmFnZXIgbWV0aG9kLgogICAgICogR2l2ZW4gdGhlIFN0YXRl\nTWFuYWdlciBtZXRob2QsIHRoZW4sIHRoaXMgZnVuY3Rpb24gdHJhbnNsYXRl\ncyBpdCBpbnRvCiAgICAgKiB0aGUgd3JhcHBlciBtZXRob2QgdGhhdCBzaG91\nbGQgYmUgYWRkZWQgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChNZXRo\nb2QgbSwKICAgICAgICBib29sZWFuIGlzRGlydHlDaGVja01ldGhvZCkgewog\nICAgICAgIC8vIGZvcm0gdGhlIG5hbWUgb2YgdGhlIG1ldGhvZCBieSBwcmVw\nZW5kaW5nICdwYycgdG8gdGhlIHNtIG1ldGhvZAogICAgICAgIFN0cmluZyBu\nYW1lID0gUFJFICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShtLmdldE5hbWUo\nKSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSBtLmdldFBhcmFtZXRlclR5\ncGVzKCk7CiAgICAgICAgQ2xhc3MgcmV0dXJuVHlwZSA9IG0uZ2V0UmV0dXJu\nVHlwZSgpOwoKICAgICAgICAvLyBhZGQgdGhlIG1ldGhvZCB0byB0aGUgcGMK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChu\nYW1lLCByZXR1cm5UeXBlLCBwYXJhbXMpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiAocGNTdGF0\nZU1hbmFnZXIgPT0gbnVsbCkgcmV0dXJuIDxkZWZhdWx0PjsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVt\ncEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAg\nICBpZiAocmV0dXJuVHlwZS5lcXVhbHMoYm9vbGVhbi5jbGFzcykpCiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAg\nICAgZWxzZSBpZiAoIXJldHVyblR5cGUuZXF1YWxzKHZvaWQuY2xhc3MpKQog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAg\nIGNvZGUueHJldHVybigpLnNldFR5cGUocmV0dXJuVHlwZSk7CgogICAgICAg\nIC8vIGlmIHRoaXMgaXMgdGhlIGRpcnR5LWNoZWNrIG1ldGhvZCBhbmQgd2Un\ncmUgc3ViY2xhc3NpbmcgYnV0IG5vdAogICAgICAgIC8vIHJlZGVmaW5pbmcs\nIGhvb2sgaW50byBQQ0hlbHBlciB0byBkbyB0aGUgZGlydHkgY2hlY2sKICAg\nICAgICBpZiAoaXNEaXJ0eUNoZWNrTWV0aG9kICYmICFnZXRSZWRlZmluZSgp\nKSB7CiAgICAgICAgICAgIC8vIFJlZGVmaW5pdGlvbkhlbHBlci5kaXJ0eUNo\nZWNrKHNtKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBj\nb2RlLmR1cCgpOyAvLyBmb3IgdGhlIHJldHVybiBzdGF0ZW1lbnQgYmVsb3cK\nICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVk\nZWZpbml0aW9uSGVscGVyLmNsYXNzLCAKICAgICAgICAgICAgICAgICJkaXJ0\neUNoZWNrIiwgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBTTVRZUEUgfSk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0\nKGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICAvLyByZXR1cm4gcGNTdGF0ZU1hbmFn\nZXIuPG1ldGhvZD4gKDxhcmdzPik7CiAgICAgICAgLy8gbWFuYWdlZCBpbnN0\nYW5jZSBsb2FkZWQgYWJvdmUgaW4gaWYtZWxzZSBibG9jawogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QobSk7CiAgICAgICAgY29kZS54\ncmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBlKTsKCiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxp\nbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjR2V0VmVyc2lvbn0gbWV0aG9kIHRv\nIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdl\ndFZlcnNpb25NZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJHZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAog\nICAgICAgICAgICBudWxsKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2Vy\nID09IG51bGwpCiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUu\naWZub25udWxsKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSB2ZXJzaW9uRmll\nbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKCiAgICAgICAgaWYgKHZl\ncnNpb25GaWVsZCA9PSBudWxsKQogICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0TnVsbCgpOyAvLyByZXR1cm4gbnVsbDsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgLy8gcmV0dXJuIDx2ZXJzaW9uRmllbGQ+OwogICAgICAg\nICAgICBDbGFzcyB3cmFwcGVyID0gdG9QcmltaXRpdmVXcmFwcGVyKHZlcnNp\nb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3cmFwcGVyICE9IHZlcnNpb25G\naWVsZC5nZXREZWNsYXJlZFR5cGUoKSkgewogICAgICAgICAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZSh3cmFwcGVyKTsKICAgICAgICAgICAgICAgIGNv\nZGUuZHVwKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbkZpZWxkKTsKICAgICAgICAg\nICAgaWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZpZWxkLmdldERlY2xhcmVkVHlw\nZSgpKQogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0\nTWV0aG9kKHdyYXBwZXIsICI8aW5pdD4iLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyB2ZXJzaW9uRmllbGQuZ2V0RGVj\nbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuYXJldHVy\nbigpOwoKICAgICAgICAvLyByZXR1cm4gcGNTdGF0ZU1hbmFnZXIuZ2V0VmVy\nc2lvbiAoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJnZXRWZXJzaW9uIiwgT2Jq\nZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZlcnNpb24gZmllbGQgdHlwZSBhcyBh\nIHByaW1pdGl2ZSB3cmFwcGVyLCBvciBudWxsIGlmCiAgICAgKiB0aGUgdmVy\nc2lvbiBmaWVsZCBpcyBub3QgcHJpbWl0aXZlLgogICAgICovCiAgICBwcml2\nYXRlIENsYXNzIHRvUHJpbWl0aXZlV3JhcHBlcihGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAg\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uY2xhc3M7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nQnl0ZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoK\nICAgICAgICAgICAgICAgIHJldHVybiBDaGFyYWN0ZXIuY2xhc3M7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAg\nIHJldHVybiBEb3VibGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkZMT0FUOgogICAgICAgICAgICAgICAgcmV0dXJuIEZsb2F0LmNsYXNz\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIHJldHVybiBMb25nLmNs\nYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAg\nICAgICAgICAgIHJldHVybiBTaG9ydC5jbGFzczsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUj\ncGNSZXBsYWNlU3RhdGVNYW5hZ2VyfQogICAgICogbWV0aG9kIHRvIHRoZSBi\neXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFJlcGxhY2VT\ndGF0ZU1hbmFnZXJNZXRob2QoKSB7CiAgICAgICAgLy8gcHVibGljIHZvaWQg\ncGNSZXBsYWNlU3RhdGVNYW5hZ2VyIChTdGF0ZU1hbmFnZXIgc20pCiAgICAg\nICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIlJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXXsgU01UWVBFIH0pOwogICAgICAgIG1ldGhvZC5zZXRT\neW5jaHJvbml6ZWQodHJ1ZSk7CiAgICAgICAgbWV0aG9kLmdldEV4Y2VwdGlv\nbnModHJ1ZSkuYWRkRXhjZXB0aW9uKFNlY3VyaXR5RXhjZXB0aW9uLmNsYXNz\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2VyICE9IG51bGwpCiAgICAg\nICAgLy8JcGNTdGF0ZU1hbmFnZXIgPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNl\nU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5z\nID0gY29kZS5pZm51bGwoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNN\nVFlQRSwgInJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAgICAgICAgICBTTVRZ\nUEUsIG5ldyBDbGFzc1tdeyBTTVRZUEUgfSk7CiAgICAgICAgY29kZS5wdXRm\naWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUudnJl\ndHVybigpOwoKICAgICAgICAvLyBTZWN1cml0eU1hbmFnZXIgc2VjID0gU3lz\ndGVtLmdldFNlY3VyaXR5TWFuYWdlciAoKTsKICAgICAgICAvLyBpZiAoc2Vj\nICE9IG51bGwpCiAgICAgICAgLy8JCXNlYy5jaGVja1Blcm1pc3Npb24gKFBl\ncm1pc3Npb24uU0VUX1NUQVRFX01BTkFHRVIpOwogICAgICAgIGlmaW5zLnNl\ndFRhcmdldChjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChTeXN0ZW0u\nY2xhc3MsCiAgICAgICAgICAgICJnZXRTZWN1cml0eU1hbmFnZXIiLCBTZWN1\ncml0eU1hbmFnZXIuY2xhc3MsIG51bGwpKTsKCiAgICAgICAgLy8gcGNTdGF0\nZU1hbmFnZXIgPSBzbTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7Cgog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlcyB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIG1ldGhvZHMgZGVhbGlu\nZyB3aXRoIGFwcGxpY2F0aW9uCiAgICAgKiBpZGVudGl0eSBhbmQgZ2l2ZXMg\ndGhlbSBuby1vcCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGROb09wQXBwbGljYXRpb25JZGVudGl0eU1ldGhvZHMoKSB7\nCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzVG9PYmpl\nY3RJZCAoT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZzLAogICAgICAgIC8vIAlP\nYmplY3Qgb2lkKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPSURGU1RZUEUs\nIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBwdWJs\naWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVjdElkIChPYmplY3Qgb2lk\nKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJD\nb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVy\nbigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJ\nZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAogICAgICAgIC8vCU9iamVj\ndCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lERkNUWVBFLCBPYmplY3QuY2xh\nc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtl\neUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0IG9pZCkKICAgICAgICBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zy\nb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1Ymxp\nYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3RhbmNlICgpCiAgICAgICAgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5ld09iamVjdElkSW5z\ndGFuY2UiLAogICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMg\nT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoT2JqZWN0IG9iaikKICAg\nICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiTmV3T2Jq\nZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbmV3\nIENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIDxj\nb2RlPnBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMK\nICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHku\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxkTWFuYWdlcikKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJs\naWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVjdElkIChPYmplY3RJZEZp\nZWxkU3VwcGxpZXIgZnMsCiAgICAgICAgLy8JT2JqZWN0IG9pZCkKICAgICAg\nICBTdHJpbmdbXSBhcmdzID0gKGZpZWxkTWFuYWdlcikgPwogICAgICAgICAg\nICBuZXcgU3RyaW5nW117IE9JREZTVFlQRS5nZXROYW1lKCksIE9iamVjdC5j\nbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6IG5ldyBTdHJpbmdbXXsg\nT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRz\nVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgp\nLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgLy8gc2luZ2xlIGZpZWxkIGlkZW50aXR5IGFsd2F5\ncyB0aHJvd3MgZXhjZXB0aW9uCiAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQ\nQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29k\nZSwgSU5URVJORVhDRVApOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gY2FsbCBzdXBlcmNsYXNz\nIG1ldGhvZAogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAh\nPSBudWxsICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oaSk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9t\nZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgUFJFICsgIkNvcHlLZXlG\naWVsZHNUb09iamVjdElkIiwgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3Mp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gT2JqZWN0IGlkID0gb2lkOwogICAg\nICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgxKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAgICAgaWYgKF9tZXRhLmlzT2Jq\nZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8gb2lkID0gKChP\nYmplY3RJZCkgaWQpLmdldElkICgpOwogICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3Ms\nICJnZXRJZCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gPG9pZCB0eXBlPiBpZCA9ICg8b2lk\nIHR5cGU+KSBvaWQ7CiAgICAgICAgaW50IGlkID0gY29kZS5nZXROZXh0TG9j\nYWxzSW5kZXgoKTsKICAgICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0\nT2JqZWN0SWRUeXBlKCk7CiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwo\naWQpOwoKICAgICAgICAvLyBpbnQgaW5oZXJpdGVkID0gcGNJbmhlcml0ZWRG\naWVsZENvdW50OwogICAgICAgIGludCBpbmhlcml0ZWQgPSAwOwogICAgICAg\nIGlmIChmaWVsZE1hbmFnZXIpIHsKICAgICAgICAgICAgY29kZS5nZXRzdGF0\naWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAg\nICBpbmhlcml0ZWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGluaGVyaXRlZCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZC48ZmllbGQ+ID0gZnMuZmV0Y2g8dHlw\nZT5GaWVsZCAoPGluZGV4Pik7IG9yLi4uCiAgICAgICAgLy8gaWQuPGZpZWxk\nPiA9IHBjLjxmaWVsZD47CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAg\nICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAg\nIENsYXNzIHR5cGU7CiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgRmll\nbGQgZmllbGQ7CiAgICAgICAgTWV0aG9kIHNldHRlcjsKICAgICAgICBib29s\nZWFuIHJlZmxlY3Q7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1By\naW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAgICAg\nbmFtZSA9IGZtZHNbaV0uZ2V0TmFtZSgpOwogICAgICAgICAgICB0eXBlID0g\nZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICBp\nZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUND\nRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgICAgICBzZXR0ZXIgPSBudWxsOwog\nICAgICAgICAgICAgICAgZmllbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChv\naWRUeXBlLCBuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlZmxlY3Qg\nPSAhTW9kaWZpZXIuaXNQdWJsaWMoZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwog\nICAgICAgICAgICAgICAgaWYgKHJlZmxlY3QpIHsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsIAogICAgICAg\nICAgICAgICAgICAgICAgICAiZmluZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5l\ndyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nICAgIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGZpZWxkID0gbnVsbDsKICAgICAgICAgICAgICAgIHNldHRlciA9IFJlZmxl\nY3Rpb24uZmluZFNldHRlcihvaWRUeXBlLCBuYW1lLCB0eXBlLCB0cnVlKTsK\nICAgICAgICAgICAgICAgIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMo\nc2V0dGVyLmdldE1vZGlmaWVycygpKTsKICAgICAgICAgICAgICAgIGlmIChy\nZWZsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0\nYW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5hbWUpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKHR5cGUpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygp\nLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgImZpbmRTZXR0ZXIiLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFz\nc1tdIHsgQ2xhc3MuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0\ncmluZy5jbGFzcywgQ2xhc3MuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlm\nIChmaWVsZE1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5z\nZXRMb2NhbChpbmhlcml0ZWQpOwogICAgICAgICAgICAgICAgY29kZS5pYWRk\nKCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNl\ndE1ldGhvZAogICAgICAgICAgICAgICAgICAgIChnZXRGaWVsZFN1cHBsaWVy\nTWV0aG9kKHR5cGUpKTsKCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgdHlw\nZSBvZiB0aGlzIGZpZWxkIG1ldGEgZGF0YSBpcwogICAgICAgICAgICAgICAg\nLy8gbm9uLXByaW1pdGl2ZSBhbmQgbm9uLXN0cmluZywgYmUgc3VyZSB0byBj\nYXN0CiAgICAgICAgICAgICAgICAvLyB0byB0aGUgYXBwcm9wcmlhdGUgdHlw\nZS4KICAgICAgICAgICAgICAgIGlmICghcmVmbGVjdCAmJiAhdHlwZS5pc1By\naW1pdGl2ZSgpCiAgICAgICAgICAgICAgICAgICAgJiYgIXR5cGUuZ2V0TmFt\nZSgpLmVxdWFscyhTdHJpbmcuY2xhc3MuZ2V0TmFtZSgpKSkKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAg\nICAgICAgLy8gZ2V0IGlkL3BrIGZyb20gcGMgaW5zdGFuY2UKICAgICAgICAg\nICAgICAgIGlmIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBK\nYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAgYWRkRXh0cmFjdE9i\namVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmIChyZWZsZWN0ICYmIGZpZWxkICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0\nTWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsICJzZXQiLCAKICAgICAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFz\ncywgRmllbGQuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgKHR5cGUuaXNQ\ncmltaXRpdmUoKSkgPyB0eXBlIDogT2JqZWN0LmNsYXNzIH0pOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHJlZmxlY3QpIHsgCiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNz\nLCAic2V0IiwgCiAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3\nIENsYXNzW10geyBPYmplY3QuY2xhc3MsIE1ldGhvZC5jbGFzcywKICAgICAg\nICAgICAgICAgICAgICAodHlwZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBP\nYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmllbGQg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChzZXR0ZXIpOwogICAg\nICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgY29kZSB0byBl\neHRyYWN0IHRoZSBpZCBvZiB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgcmVsYXRp\nb24gZmllbGQgZm9yCiAgICAgKiBzZXR0aW5nIGludG8gYW4gb2JqZWN0aWQg\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRFeHRyYWN0\nT2JqZWN0SWRGaWVsZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURh\ndGEgcGspIHsKICAgICAgICAvLyBpZiAodmFsICE9IG51bGwpIAogICAgICAg\nIC8vICB2YWwgPSAoKFBlcnNpc3RlbmNlQ2FwYWJsZSkgdmFsKS5wY0ZldGNo\nT2JqZWN0SWQoKTsKICAgICAgICBpbnQgcGMgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwocGMp\nOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChwYyk7CiAgICAgICAg\nSnVtcEluc3RydWN0aW9uIGlmbnVsbDEgPSBjb2RlLmlmbnVsbCgpOwogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChwYyk7CiAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7\nIAogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBl\ncnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgUFJFICsgIkZl\ndGNoT2JqZWN0SWQiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGlu\ndCBvaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNv\nZGUuYXN0b3JlKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZu\ndWxsMiA9IGNvZGUuaWZudWxsKCk7IAoKICAgICAgICAvLyBmb3IgZGF0YXN0\nb3JlIC8gc2luZ2xlLWZpZWxkIGlkZW50aXR5OgogICAgICAgIC8vIGlmICh2\nYWwgIT0gbnVsbCkKICAgICAgICAvLyAgIHZhbCA9ICgoT3BlbkpQQUlkKSB2\nYWwpLmdldElkKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBwa21ldGEgPSBw\nay5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGludCBwa2Nv\nZGUgPSBway5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKTsKICAgICAgICBD\nbGFzcyBwa3R5cGUgPSBway5nZXRPYmplY3RJZEZpZWxkVHlwZSgpOwogICAg\nICAgIGlmIChwa21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5JRF9EQVRBU1RPUkUgCiAgICAgICAgICAgICYmIHBrY29kZSA9PSBK\nYXZhVHlwZXMuTE9ORykgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKElkLmNsYXNzLCAiZ2V0SWQiLCAKICAgICAgICAgICAg\nICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAgICAgIH0gZWxzZSBpZiAocGtt\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFU\nQVNUT1JFKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChv\naWQpOwogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmlzT3BlbkpQQUlkZW50\naXR5KCkpIHsKICAgICAgICAgICAgc3dpdGNoIChwa2NvZGUpIHsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAg\nICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoQnl0ZS5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAg\nICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoQnl0ZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQnl0ZUlkLmNsYXNz\nLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBieXRlLmNsYXNz\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEph\ndmFUeXBlcy5CWVRFX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEJ5dGUuY2xhc3MsICI8aW5p\ndD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW10ge2J5dGUuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJf\nT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\nQ2hhcmFjdGVyLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDaGFySWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChDaGFySWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNoYXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkNIQVJfT0JKKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoQ2hhcmFjdGVyLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7Y2hhci5j\nbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKERvdWJsZS5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAg\nICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShEb3VibGVJZC5jbGFzcyk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKERvdWJsZUlk\nLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBkb3Vi\nbGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2Nv\nZGUgPT0gSmF2YVR5cGVzLkRPVUJMRV9PQkopCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChEb3VibGUu\nY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde2RvdWJsZS5jbGFzc30pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUoRmxvYXQuY2xhc3MpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJl\nYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShG\nbG9hdElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoRmxvYXRJZC5jbGFzcywgImdldElkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkZM\nT0FUX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKEZsb2F0LmNsYXNzLCAiPGluaXQ+IiwgCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXtmbG9hdC5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKEludGVnZXIu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUoSW50SWQuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChJbnRJ\nZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW50\nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2Rl\nID09IEphdmFUeXBlcy5JTlRfT0JKKQogICAgICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoSW50ZWdlci5jbGFz\ncywgIjxpbml0PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7aW50LmNsYXNzfSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5MT05HX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5z\nZXRUeXBlKExvbmcuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKExvbmdJZC5jbGFz\ncyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKExvbmdJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgbG9uZy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuTE9OR19PQkopCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZChMb25nLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHtsb25nLmNsYXNz\nfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbmV3KCkuc2V0VHlwZShTaG9ydC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAv\nLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKFNob3J0SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChTaG9ydElkLmNsYXNzLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBzaG9ydC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZh\nVHlwZXMuU0hPUlRfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoU2hvcnQuY2xhc3MsICI8aW5p\ndD4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tde3Nob3J0LmNsYXNzfSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRF\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChv\naWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZShEYXRlSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChEYXRlSWQuY2xhc3MsICJnZXRJ\nZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGUuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShTdHJpbmdJZC5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKFN0cmluZ0lkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAg\nICAgICAgICBTdHJpbmcuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklH\nREVDSU1BTDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoQmlnRGVjaW1hbElkLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQmlnRGVj\naW1hbElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAg\nICBCaWdEZWNpbWFsSWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklH\nSU5URUdFUjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoQmlnSW50ZWdlcklkLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQmlnSW50\nZWdlcklkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAg\nICBCaWdJbnRlZ2VySWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0\nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElkIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmdldE9iamVj\ndElkVHlwZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShwa3R5cGUpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gZ28yID0gY29kZS5nbzIoKTsKCiAgICAgICAgLy8gaWYgKHZhbCA9\nPSBudWxsKQogICAgICAgIC8vICAgdmFsID0gPGRlZmF1bHQ+OwogICAgICAg\nIEluc3RydWN0aW9uIGRlZjsKICAgICAgICBzd2l0Y2ggKHBrY29kZSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKChieXRlKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChjaGFyKSAw\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlQ6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIGRlZiA9\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAg\nICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nKHNob3J0KSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFu\ndCgpLnNldE51bGwoKTsKICAgICAgICB9CiAgICAgICAgaWZudWxsMS5zZXRU\nYXJnZXQoZGVmKTsKICAgICAgICBpZm51bGwyLnNldFRhcmdldChkZWYpOwog\nICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wY0NvcHlLZXlGaWVsZHNGcm9t\nT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNp\nbmcgYXBwbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKGJvb2xl\nYW4gZmllbGRNYW5hZ2VyKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAog\nICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgU3RyaW5nW10gYXJncyA9\nIChmaWVsZE1hbmFnZXIpIAogICAgICAgICAgICA/ICBuZXcgU3RyaW5nW117\nIE9JREZDVFlQRS5nZXROYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkg\nfQogICAgICAgICAgICA6IG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdl\ndE5hbWUoKSB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwK\nICAgICAgICAgICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kCiAgICAgICAgaWYgKF9tZXRh\nLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNs\nYXNzKCkpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJn\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbShpKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAgICAg\nICAgICBQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsIHZvaWQu\nY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICB9CgogICAgICAgIGlm\nIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgxKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKCiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJ\nZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsK\nICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0\nSWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gPG9pZCB0eXBlPiBjYXN0ID0gKDxvaWQgdHlwZT4pIG9pZDsKICAgICAg\nICBpbnQgaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAg\nIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7CiAgICAg\nICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpZCk7CgogICAgICAgIC8vIGZz\nLnN0b3JlPHR5cGU+RmllbGQgKDxpbmRleD4sIGlkLjxmaWVsZD4pOyBvci4u\nLgogICAgICAgIC8vIHRoaXMuPGZpZWxkPiA9IGlkLjxmaWVsZD4KICAgICAg\nICAvLyBvciBmb3Igc2luZ2xlIGZpZWxkIGlkZW50aXR5OiBpZC5nZXRJZCAo\nKQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3Vi\nY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAgIDogX21l\ndGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBTdHJpbmcgbmFtZTsK\nICAgICAgICBDbGFzcyB0eXBlOwogICAgICAgIENsYXNzIHVud3JhcHBlZDsK\nICAgICAgICBGaWVsZCBmaWVsZDsKICAgICAgICBNZXRob2QgZ2V0dGVyOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIG5hbWUgPSBm\nbWRzW2ldLmdldE5hbWUoKTsKICAgICAgICAgICAgdHlwZSA9IGZtZHNbaV0u\nZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgaWYgKCFmaWVs\nZE1hbmFnZXIgCiAgICAgICAgICAgICAgICAmJiBmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIHsKICAgICAgICAgICAg\nICAgIC8vIHNtLmdldFBDUHJpbWFyeUtleShvaWQsIGkgKyBwY0luaGVyaXRl\nZEZpZWxkQ291bnQpOyAKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5kdXAo\nKTsgLy8gbGVhdmUgb3JpZyBvbiBzdGFjayB0byBzZXQgdmFsdWUgaW50bwog\nICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKGlkKTsKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZShpKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUu\naWFkZCgpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoU3RhdGVNYW5hZ2VyLmNsYXNzLCAKICAgICAgICAgICAg\nICAgICAgICAiZ2V0UENQcmltYXJ5S2V5IiwgT2JqZWN0LmNsYXNzLCAKICAg\nICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywg\naW50LmNsYXNzIH0pOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAg\nICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgICAgIHVud3JhcHBlZCA9IChm\nbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMp\nIAogICAgICAgICAgICAgICAgICAgID8gdHlwZSA6IHVud3JhcFNpbmdsZUZp\nZWxkSWRlbnRpdHkoZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAoZmll\nbGRNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdl\ndHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBpZiAodW53cmFwcGVk\nICE9IHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5z\nZXRUeXBlKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwoaWQpOwogICAgICAgICAgICAgICAgaWYgKF9tZXRhLmlz\nT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nb2lkVHlwZSA9PSBPYmplY3RJZC5jbGFzcykgewogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlw\nZSwgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgh\nZmllbGRNYW5hZ2VyICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAob2lkVHlwZSA9PSBEYXRlSWQuY2xhc3MpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBEYXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKCFmaWVsZE1hbmFnZXIgJiYgdHlwZSAhPSBEYXRlLmNsYXNz\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0\nSWQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcHBlZCwg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQg\nIT0gdHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+IiwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgdW53cmFwcGVkIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgp\nID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKXsKICAgICAgICAgICAg\nICAgICAgICBmaWVsZCA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUs\nIG5hbWUsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChNb2RpZmll\nci5pc1B1YmxpYyhmaWVsZC5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5m\naW5kRmllbGQoLi4uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\nY2xhc3Njb25zdGFudCgpLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFz\ncywgbmV3IENsYXNzW10geyAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCku\nc2V0TWV0aG9kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2V0UmVm\nbGVjdGlvbkdldHRlck1ldGhvZCh0eXBlLCBGaWVsZC5jbGFzcykpOwogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAm\nJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIGdldHRlciA9IFJlZmxlY3Rpb24uZmluZEdldHRl\ncihvaWRUeXBlLCBuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoTW9kaWZpZXIuaXNQdWJsaWMoZ2V0dGVyLmdldE1vZGlmaWVycygpKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKGdldHRlcik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhY\nKG9pZCwgUmVmbGVjdGlvbi5maW5kR2V0dGVyKC4uLikpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhv\naWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxl\nY3Rpb24uY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmlu\nZEdldHRlciIsIE1ldGhvZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFz\ncywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIChnZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUs\nIE1ldGhvZC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVs\nZE1hbmFnZXIpCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChnZXRGaWVsZENvbnN1bWVyTWV0aG9kKHR5cGUpKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdl\nZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9CiAgICAgICAg\nY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGlmIHRoZSBjbGFzcyB1c2VzIHRo\nZSBDbGFzcy9TdHJpbmcgY29uc3RydWN0b3IKICAgICAqIGluc3RlYWQgb2Yg\nanVzdCBTdHJpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiB1c2Vz\nQ2xhc3NTdHJpbmdJZENvbnN0cnVjdG9yKCkgewogICAgICAgIGlmIChfbWV0\nYS5nZXRJZGVudGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJ\nQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAg\nICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAg\nICAgICAgaWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElk\nLmNsYXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgfQoKICAgICAgICBD\nbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3Rvcihu\nZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAg\nICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9IGNhdGNo\nIChUaHJvd2FibGUgdCkgewogICAgICAgIH0KICAgICAgICB0cnkgewogICAg\nICAgICAgICBvaWRUeXBlLmdldENvbnN0cnVjdG9yKG5ldyBDbGFzc1tdeyBT\ndHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdGhlIGdpdmVuIGZpZWxkIGlzIGEgd3JhcHBlci10eXBlIHNpbmdsZSBm\naWVsZCBpZGVudGl0eSBwcmltYXJ5IGtleSwKICAgICAqIHJldHVybiBpdHMg\nY29ycmVzcG9uZGluZyBwcmltaXRpdmUgY2xhc3MuIEVsc2UgcmV0dXJuIHRo\nZSBmaWVsZCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHVud3Jh\ncFNpbmdsZUZpZWxkSWRlbnRpdHkoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBpZiAoIWZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCkuaXNPcGVuSlBB\nSWRlbnRpdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJl\nZFR5cGUoKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JK\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGJ5dGUuY2xhc3M7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGNoYXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZG91YmxlLmNs\nYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmxvYXQuY2xhc3M7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICByZXR1\ncm4gaW50LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gc2hvcnQuY2xhc3M7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGxvbmcuY2xhc3M7CiAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZm1kLmdldERlY2xhcmVkVHlwZSgp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\ncHJvcGVyIGdldHRlciBtZXRob2Qgb2YgdGhlIHtAbGluayBSZWZsZWN0aW9u\nfSBoZWxwZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9yIGdldHRlciBtZXRob2Qg\nb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9k\nIGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QoQ2xhc3MgdHlwZSwgQ2xhc3Mg\nYXJnVHlwZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICBTdHJpbmcgbmFtZSA9ICJnZXQiOwogICAgICAgIGlmICh0\neXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIG5hbWUgKz0gU3RyaW5n\nVXRpbHMuY2FwaXRhbGl6ZSh0eXBlLmdldE5hbWUoKSk7CiAgICAgICAgcmV0\ndXJuIFJlZmxlY3Rpb24uY2xhc3MuZ2V0TWV0aG9kKG5hbWUsIG5ldyBDbGFz\nc1tdIHsgT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgYXJnVHlwZSB9KTsg\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBmZXRj\naCBtZXRob2Qgb2YgdGhlIE9iamVjdElkRmllbGRTdXBwbGllciBmb3IKICAg\nICAqIGEgZmllbGQgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgTWV0aG9kIGdldEZpZWxkU3VwcGxpZXJNZXRob2QoQ2xhc3MgdHlw\nZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gZ2V0TWV0aG9kKE9JREZTVFlQRSwgdHlwZSwgImZldGNo\nIiwgdHJ1ZSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgcHJvcGVyIGZldGNoIG1ldGhvZCBvZiB0aGUgT2JqZWN0\nSWRGaWVsZENvbnN1bWVyIGZvcgogICAgICogYSBmaWVsZCBvZiB0aGUgZ2l2\nZW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0RmllbGRD\nb25zdW1lck1ldGhvZChDbGFzcyB0eXBlKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRNZXRob2Qo\nT0lERkNUWVBFLCB0eXBlLCAic3RvcmUiLCBmYWxzZSwgZmFsc2UsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHBjTmV3T2JqZWN0\nSWRJbnN0YW5jZSBtZXRob2QgdG8gY2xhc3NlcyB1c2luZwogICAgICogYXBw\nbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2JqKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8v\nIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3RhbmNlICgpCiAgICAg\nICAgQ2xhc3NbXSBhcmdzID0gKG9iaikgPyBuZXcgQ2xhc3NbXXsgT2JqZWN0\nLmNsYXNzIH0gOiBudWxsOwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwK\nICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBhcmdzKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgQm9vbGVh\nbiB1c2VzQ2xzU3RyaW5nID0gdXNlc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3Rv\ncigpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJ\nZFR5cGUoKTsKICAgICAgICBpZiAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0g\nbnVsbCkgewogICAgICAgICAgICAvLyB0aHJvdyBuZXcgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uICguLi4pOwogICAgICAgICAgICBTdHJpbmcgbXNnID0g\nX2xvYy5nZXQoInN0ci1jb25zIiwgb2lkVHlwZSwKICAgICAgICAgICAgICAg\nIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkuZ2V0TWVzc2FnZSgpOwogICAg\nICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShtc2cpOwogICAgICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgIjxpbml0\nPiIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7\nCiAgICAgICAgICAgIGNvZGUuYXRocm93KCk7CiAgICAgICAgICAgIGNvZGUu\ndnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIV9t\nZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5\ncGVTaGFyZWQoKSkgewogICAgICAgICAgICAvLyBuZXcgT2JqZWN0SWQgKGNs\ncywgb2lkKQogICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKE9iamVj\ndElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAg\nICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0\nYSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gbmV3IDxvaWQgY2xhc3M+ICgp\nOwogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUob2lkVHlwZSk7CiAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRl\nbnRpdHkoKSB8fCAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5U\nUlVFKSkKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xh\nc3MoZ2V0VHlwZShfbWV0YSkpOwogICAgICAgIGlmIChvYmopIHsKICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAg\nICAgICAgaWYgKHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywg\nU3RyaW5nLmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UgaWYgKHVzZXNDbHNT\ndHJpbmcgPT0gQm9vbGVhbi5GQUxTRSkKICAgICAgICAgICAgICAgIGFyZ3Mg\nPSBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH07CiAgICAgICAgfSBlbHNl\nIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAg\nIC8vIG5ldyA8dHlwZT5JZGVudGl0eSAoWFhYLmNsYXNzLCA8cGs+KTsKICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGEgcGsgPSBfbWV0YS5nZXRQcmltYXJ5\nS2V5RmllbGRzKClbMF07CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgcGspOwogICAgICAgICAgICBpZiAocGsuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAg\nIGFkZEV4dHJhY3RPYmplY3RJZEZpZWxkVmFsdWVDb2RlKGNvZGUsIHBrKTsK\nICAgICAgICAgICAgaWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IE9i\namVjdElkLmNsYXNzKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFz\nc1tdeyBDbGFzcy5jbGFzcywgT2JqZWN0LmNsYXNzIH07CiAgICAgICAgICAg\nIGVsc2UgaWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IERhdGUuY2xh\nc3MpCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNz\nLmNsYXNzLCBEYXRlLmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIHBr\nLmdldE9iamVjdElkRmllbGRUeXBlKCkgfTsKICAgICAgICB9CgogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiPGlu\naXQ+Iiwgdm9pZC5jbGFzcywgYXJncyk7CiAgICAgICAgaWYgKCFfbWV0YS5p\nc09wZW5KUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hh\ncmVkKCkpCiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZChPYmplY3RJZC5jbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAg\nICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVuIGNv\nbW11bmljYXRpbmcgd2l0aCB0aGUgU3RhdGVNYW5hZ2VyLCBtYW55IG1ldGhv\nZHMgYXJlIHVzZWQKICAgICAqIGRlcGVuZGluZyBvbiB0aGUgY2xhc3Mgb2Yg\nc3RhdGUgYmVpbmcgcGFzc2VkLiBUaGlzIG1ldGhvZCwKICAgICAqIGdpdmVu\nIHRoZSB0eXBlIG9mIGluZm9ybWF0aW9uIGJlaW5nIHBhc3NlZCBhbmQgdGhl\nIHByZWZpeAogICAgICogKCdwcm92aWRlZCcsICdyZXBsYWNlJywgZXRjKSBv\nZiB0aGUgbWV0aG9kIHRvCiAgICAgKiBjYWxsLCByZXR1cm5zIHRoZSBTdGF0\nZU1hbmFnZXIgbWV0aG9kIHRoYXQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKgog\nICAgICogQHBhcmFtIHR5cGUgdGhlIHR5cGUgb2Ygc3RhdGUgYmVpbmcgcGFz\nc2VkCiAgICAgKiBAcGFyYW0gcHJlZml4IHRoZSBwcmVmaXggb2YgdGhlIG1l\ndGhvZCB0byBjYWxsOyBhbGwgbWV0aG9kcwogICAgICogZW5kIGluICdbc3Rh\ndGUgdHlwZV1GaWVsZCc7IG9ubHkgdGhlIHByZWZpeCB2YXJpZXMKICAgICAq\nIEBwYXJhbSBnZXQgdHJ1ZSBpZiByZWNlaXZpbmcgaW5mb3JtYXRpb24gZnJv\nbSB0aGUKICAgICAqIFN0YXRlTWFuYWdlciwgZmFsc2UgaWYgcGFzc2luZyBp\ndCB0byB0aGUgU00KICAgICAqIEBwYXJhbSBjdXJWYWx1ZSB0cnVlIGlmIHRo\nZSBjdXJyZW50IHN0YXRlIHZhbHVlIGlzIHBhc3NlZCB0bwogICAgICogdGhl\nIFN0YXRlTWFuYWdlciBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICovCiAg\nICBwcml2YXRlIE1ldGhvZCBnZXRTdGF0ZU1hbmFnZXJNZXRob2QoQ2xhc3Mg\ndHlwZSwgU3RyaW5nIHByZWZpeCwKICAgICAgICBib29sZWFuIGdldCwgYm9v\nbGVhbiBjdXJWYWx1ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0TWV0aG9kKFNNVFlQRSwgdHlw\nZSwgcHJlZml4LCBnZXQsIHRydWUsIGN1clZhbHVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgbWV0aG9kIG9mIHRoZSBnaXZlbiBvd25l\nciB0eXBlIG1hdGNoaW5nIHRoZSBnaXZlbiBjcml0ZXJpYS4KICAgICAqCiAg\nICAgKiBAcGFyYW0gdHlwZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNz\nZWQKICAgICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUgbWV0\naG9kIHRvIGNhbGw7IGFsbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0\nZSB0eXBlXUZpZWxkJzsgb25seSB0aGUgcHJlZml4IHZhcmllcwogICAgICog\nQHBhcmFtIGdldCB0cnVlIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9t\nIHRoZQogICAgICogb3duZXIsIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhl\nIG93bmVyCiAgICAgKiBAcGFyYW0gaGFzcGMgdHJ1ZSBpZiB0aGUgcGMgaXMg\ncGFzc2VkIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKiBAcGFyYW0gY3Vy\nVmFsdWUgdHJ1ZSBpZiB0aGUgY3VycmVudCBzdGF0ZSB2YWx1ZSBpcyBwYXNz\nZWQgdG8KICAgICAqIHRoZSBvd25lciBhcyBhbiBleHRyYSBhcmd1bWVudAog\nICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRNZXRob2QoQ2xhc3Mgb3du\nZXIsIENsYXNzIHR5cGUsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgYm9vbGVh\nbiBnZXQsIGJvb2xlYW4gaGFzcGMsIGJvb2xlYW4gY3VyVmFsdWUpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nYWxsIG1ldGhvZHMgZW5kIGluIFtmaWVsZCB0eXBlXUZpZWxkLCB3aGVyZSB0\naGUgZmllbGQgdHlwZQogICAgICAgIC8vIGNhbiBiZSBhbnkgb2YgdGhlIHBy\naW1pdHZlIHR5cGVzIChidXQgY2FwaXRhbGl6ZWQpLCAnU3RyaW5nJywKICAg\nICAgICAvLyBvciAnT2JqZWN0JzsgZmlndXJlIG91dCB3aGF0IHR5cGUgdG8g\ndXNlCiAgICAgICAgU3RyaW5nIHR5cGVOYW1lID0gdHlwZS5nZXROYW1lKCk7\nCiAgICAgICAgaWYgKHR5cGUuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAg\ndHlwZU5hbWUgPSB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNh\nc2UoKQogICAgICAgICAgICAgICAgKyB0eXBlTmFtZS5zdWJzdHJpbmcoMSk7\nCiAgICAgICAgZWxzZSBpZiAodHlwZS5lcXVhbHMoU3RyaW5nLmNsYXNzKSkK\nICAgICAgICAgICAgdHlwZU5hbWUgPSAiU3RyaW5nIjsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgdHlwZU5hbWUgPSAiT2JqZWN0IjsKICAgICAgICAg\nICAgdHlwZSA9IE9iamVjdC5jbGFzczsKICAgICAgICB9CgogICAgICAgIC8v\nIHRoZSBmaWVsZCBpbmRleCBpcyBhbHdheXMgcGFzc2VkIGFzIGFuIGFyZzsg\ndGhlIHBjIGluc3RhbmNlIGFuZAogICAgICAgIC8vIHRoZSBjdXJyZW50IHZh\nbHVlIG1heSBiZSBwYXNzZWQ7IGlmIHNldHRpbmcgdGhlIG5ldyB2YWx1ZSBp\ncwogICAgICAgIC8vIGFsc28gcGFzc2VkCiAgICAgICAgTGlzdCBwbGlzdCA9\nIG5ldyBBcnJheUxpc3QoNCk7CiAgICAgICAgaWYgKGhhc3BjKQogICAgICAg\nICAgICBwbGlzdC5hZGQoUENUWVBFKTsKICAgICAgICBwbGlzdC5hZGQoaW50\nLmNsYXNzKTsKICAgICAgICBpZiAoIWdldCB8fCBjdXJWYWx1ZSkKICAgICAg\nICAgICAgcGxpc3QuYWRkKHR5cGUpOwogICAgICAgIGlmICghZ2V0ICYmIGN1\nclZhbHVlKSB7CiAgICAgICAgICAgIHBsaXN0LmFkZCh0eXBlKTsKICAgICAg\nICAgICAgcGxpc3QuYWRkKGludC5jbGFzcyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyB1c2UgcmVmbGVjdGlvbiB0byByZXR1cm4gdGhlIHJpZ2h0IG1ldGhv\nZAogICAgICAgIFN0cmluZyBuYW1lID0gcHJlZml4ICsgdHlwZU5hbWUgKyAi\nRmllbGQiOwogICAgICAgIENsYXNzW10gcGFyYW1zID0gKENsYXNzW10pIHBs\naXN0LnRvQXJyYXkobmV3IENsYXNzW3BsaXN0LnNpemUoKV0pOwogICAgICAg\nIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoTWV0aG9kKSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAg\nIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKG93bmVy\nLCBuYW1lLCBwYXJhbXMpKTsKICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2Vk\nQWN0aW9uRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICAgdGhyb3cgKE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8g\nYWRkIHRoZSBjb2RlIG5lY2Vzc2FyeSB0byB0aHJvdyB0aGUgZ2l2ZW4KICAg\nICAqIGV4Y2VwdGlvbiB0eXBlLCBzYW5zIG1lc3NhZ2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgSW5zdHJ1Y3Rpb24gdGhyb3dFeGNlcHRpb24oQ29kZSBjb2Rl\nLCBDbGFzcyB0eXBlKSB7CiAgICAgICAgSW5zdHJ1Y3Rpb24gaW5zID0gY29k\nZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwog\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAi\nPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS5hdGhy\nb3coKTsKICAgICAgICByZXR1cm4gaW5zOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZSB0byB0\naGUgY2xhc3MgYmVpbmcKICAgICAqIGVuaGFuY2VkLCBhbmQgYWRkcyBhIGRl\nZmF1bHQgY29uc3RydWN0b3IgZm9yIHVzZSBieSBPcGVuSlBBCiAgICAgKiBp\nZiBpdCBpcyBub3QgYWxyZWFkeSBwcmVzZW50LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZW5oYW5jZUNsYXNzKCkgewogICAgICAgIC8vIG1ha2UgdGhl\nIGNsYXNzIGltcGxlbWVudCBQZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICBf\ncGMuZGVjbGFyZUludGVyZmFjZShQQ1RZUEUpOwoKICAgICAgICAvLyBhZGQg\nYSB2ZXJzaW9uIHN0YW1wCiAgICAgICAgYWRkR2V0RW5oYW5jZW1lbnRDb250\ncmFjdFZlcnNpb25NZXRob2QoKTsKCiAgICAgICAgLy8gZmluZCB0aGUgZGVm\nYXVsdCBjb25zdHJ1Y3RvcgogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9w\nYy5nZXREZWNsYXJlZE1ldGhvZCgiPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxs\nKTsKCiAgICAgICAgLy8gYSBkZWZhdWx0IGNvbnN0cnVjdG9yIGlzIHJlcXVp\ncmVkCiAgICAgICAgaWYgKG1ldGhvZCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIFN0cmluZyBuYW1lID0gX3BjLmdldE5hbWUoKTsKICAgICAgICAgICAgaWYg\nKCFfZGVmQ29ucykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJlbmhhbmNlLWRlZmF1bHRjb25zdCIsIG5hbWUp\nKTsKCiAgICAgICAgICAgIG1ldGhvZCA9IF9wYy5hZGREZWZhdWx0Q29uc3Ry\ndWN0b3IoKTsKICAgICAgICAgICAgU3RyaW5nIGFjY2VzczsKICAgICAgICAg\nICAgaWYgKF9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAg\nICAvLyBleHRlcm5hbGl6YWJsZSByZXF1aXJlcyB0aGF0IHRoZSBjb25zdHJ1\nY3RvcgogICAgICAgICAgICAgICAgLy8gYmUgcHVibGljLCBzbyBtYWtlIHRo\nZSBhZGRlZCBjb25zdHJ1Y3RvciBwdWJsaWMKICAgICAgICAgICAgICAgIG1l\ndGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3MgPSAi\ncHVibGljIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChfcGMuaXNGaW5hbCgp\nKSB7CiAgICAgICAgICAgICAgICBtZXRob2QubWFrZVByaXZhdGUoKTsKICAg\nICAgICAgICAgICAgIGFjY2VzcyA9ICJwcml2YXRlIjsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVk\nKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3MgPSAicHJvdGVjdGVkIjsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoIShfbWV0YS5nZXREZXNjcmli\nZWRUeXBlKCkuaXNJbnRlcmZhY2UoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygp\nKQogICAgICAgICAgICAgICAgJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2UtYWRk\nZGVmYXVsdGNvbnN0IiwgbmFtZSwgYWNjZXNzKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgZm9sbG93aW5nIGZpZWxkcyB0\nbyB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIGluc3RhbmNlOgogICAgICogPHVs\nPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIGludCBwY0luaGVy\naXRlZEZpZWxkQ291bnQ8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29kZT5w\ncml2YXRlIHN0YXRpYyBDbGFzcyBwY1BDU3VwZXJjbGFzczwvY29kZT4KICAg\nICAqIDwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgU3Ry\naW5nW10gcGNGaWVsZE5hbWVzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNv\nZGU+cHJpdmF0ZSBzdGF0aWMgQ2xhc3NbXSBwY0ZpZWxkVHlwZXM8L2NvZGU+\nPC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBieXRlW10g\ncGNGaWVsZEZsYWdzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJv\ndGVjdGVkIHRyYW5zaWVudCBTdGF0ZU1hbmFnZXIgcGNTdGF0ZU1hbmFnZXI8\nL2NvZGU+CiAgICAgKiBpZiBubyBQZXJzaXN0ZW5jZUNhcGFibGUgc3VwZXJj\nbGFzcyBwcmVzZW50KTwvbGk+CiAgICAgKiA8L3VsPgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkRmllbGRzKCkgewogICAgICAgIF9wYy5kZWNsYXJl\nRmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAg\nICAgICAgX3BjLmRlY2xhcmVGaWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0\ncmluZ1tdLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRl\nY2xhcmVGaWVsZChQUkUgKyAiRmllbGRUeXBlcyIsIENsYXNzW10uY2xhc3Mp\nLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFBS\nRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKS5zZXRTdGF0aWModHJ1\nZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChTVVBFUiwgQ2xhc3MuY2xh\nc3MpLnNldFN0YXRpYyh0cnVlKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldFBD\nU3VwZXJjbGFzcygpID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkg\newogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgZmllbGQubWFrZVByb3RlY3Rl\nZCgpOwogICAgICAgICAgICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTW9kaWZpZXMgdGhlIGNs\nYXNzIGluaXRpYWxpemF0aW9uIG1ldGhvZCAoY3JlYXRpbmcgb25lIGlmIG5l\nY2Vzc2FyeSkKICAgICAqIHRvIGluaXRpYWxpemUgdGhlIHN0YXRpYyBmaWVs\nZHMgb2YgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZSBhbmQKICAg\nICAqIHRvIHJlZ2lzdGVyIGl0IHdpdGggdGhlIGltcGwgaGVscGVyLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKSB7\nCiAgICAgICAgQ29kZSBjb2RlID0gZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2Rl\nKHRydWUpOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nMCk7CiAgICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxk\nKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAvLyBwY0luaGVyaXRlZEZpZWxkQ291bnQgPSA8c3Vw\nZXJDbGFzcz4ucGNHZXRNYW5hZ2VkRmllbGRDb3VudCgpCiAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChnZXRUeXBlKF9t\nZXRhLgogICAgICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBQUkUgKyAi\nR2V0TWFuYWdlZEZpZWxkQ291bnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBu\ndWxsKTsKICAgICAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0Rmll\nbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gcGNQQ1N1cGVyY2xhc3MgPSA8c3VwZXJDbGFzcz47CiAgICAg\nICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5cGUo\nX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpKSk7CiAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQo\nU1VQRVIsIENsYXNzLmNsYXNzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBj\nRmllbGROYW1lcyA9IG5ldyBTdHJpbmdbXSB7ICI8bmFtZTE+IiwgIjxuYW1l\nMj4iLCAuLi4gfTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9t\nZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBjb2RlLmFuZXdh\ncnJheSgpLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZm1kc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBjb2RlLmFhc3RvcmUo\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVs\nZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsKCiAgICAg\nICAgLy8gcGNGaWVsZFR5cGVzID0gbmV3IENsYXNzW10geyA8dHlwZTE+LmNs\nYXNzLCA8dHlwZTI+LmNsYXNzLCAuLi4gfTsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUuYW5l\nd2FycmF5KCkuc2V0VHlwZShDbGFzcy5jbGFzcyk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0\nQ2xhc3MoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAg\nIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0\nYXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xhc3NbXS5j\nbGFzcyk7CgogICAgICAgIC8vIHBjRmllbGRGbGFncyA9IG5ldyBieXRlW10g\neyA8ZmxhZzE+LCA8ZmxhZzI+LCAuLi4gfTsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUubmV3\nYXJyYXkoKS5zZXRUeXBlKGJ5dGUuY2xhc3MpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShn\nZXRGaWVsZEZsYWcoZm1kc1tpXSkpOwogICAgICAgICAgICBjb2RlLmJhc3Rv\ncmUoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRG\naWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcyk7CgogICAg\nICAgIC8vIFBDUmVnaXN0cnkucmVnaXN0ZXIgKGNscywKICAgICAgICAvLwlw\nY0ZpZWxkTmFtZXMsIHBjRmllbGRUeXBlcywgcGNGaWVsZEZsYWdzLAogICAg\nICAgIC8vICBwY1BDU3VwZXJjbGFzcywgYWxpYXMsIG5ldyBYWFggKCkpOwog\nICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKF9tYW5hZ2Vk\nVHlwZSk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQUkUg\nKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsKICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xh\nc3NbXS5jbGFzcyk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVs\nZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcyk7CiAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3Mp\nOwogICAgICAgIAogICAgICAgIGlmIChfbWV0YS5pc01hcHBlZCgpKQogICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoX21ldGEuZ2V0VHlw\nZUFsaWFzKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldE51bGwoKTsKCiAgICAgICAgaWYgKF9wYy5pc0Fic3RyYWN0\nKCkpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\nX3BjKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNs\nYXNzLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKEhFTFBFUlRZUEUsICJyZWdpc3RlciIsIHZvaWQu\nY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywg\nU3RyaW5nW10uY2xhc3MsIENsYXNzW10uY2xhc3MsCiAgICAgICAgICAgICAg\nICBieXRlW10uY2xhc3MsIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MsIFBD\nVFlQRSB9KTsKCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBmbGFnIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGJ5dGUgZ2V0RmllbGRGbGFnKEZpZWxkTWV0\nYURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkg\nPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0\ndXJuIC0xOwoKICAgICAgICBieXRlIGZsYWdzID0gMDsKICAgICAgICBpZiAo\nZm1kLmdldERlY2xhcmVkVHlwZSgpLmlzUHJpbWl0aXZlKCkKICAgICAgICAg\nICAgfHwgU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oZm1k\nLmdldERlY2xhcmVkVHlwZSgpKSkKICAgICAgICAgICAgZmxhZ3MgPSBQZXJz\naXN0ZW5jZUNhcGFibGUuU0VSSUFMSVpBQkxFOwoKICAgICAgICBpZiAoZm1k\nLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9UUkFO\nU0FDVElPTkFMKQogICAgICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNh\ncGFibGUuQ0hFQ0tfV1JJVEU7CiAgICAgICAgZWxzZSBpZiAoIWZtZC5pc1By\naW1hcnlLZXkoKSAmJiAhZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQog\nICAgICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tf\nV1JJVEUKICAgICAgICAgICAgICAgIHwgUGVyc2lzdGVuY2VDYXBhYmxlLkNI\nRUNLX1JFQUQ7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmbGFncyB8PSBQ\nZXJzaXN0ZW5jZUNhcGFibGUuTUVESUFURV9XUklURQogICAgICAgICAgICAg\nICAgfCBQZXJzaXN0ZW5jZUNhcGFibGUuTUVESUFURV9SRUFEOwogICAgICAg\nIHJldHVybiBmbGFnczsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhl\nIGNvZGUgdG8gcHJvcGVybHkgaGFuZGxlIFBlcnNpc3RlbmNlQ2FwYWJsZSBz\nZXJpYWxpemF0aW9uCiAgICAgKiB0byB0aGUgYnl0ZWNvZGUuIFRoaXMgaW5j\nbHVkZXMgY3JlYXRpbmcgYW5kIGluaXRpYWxpemluZyB0aGUKICAgICAqIHN0\nYXRpYyA8Y29kZT5zZXJpYWxWZXJzaW9uVUlEPC9jb2RlPiBjb25zdGFudCBp\nZiBub3QgYWxyZWFkeSBkZWZpbmVkLAogICAgICogYXMgd2VsbCBhcyBjcmVh\ndGluZyBhIGN1c3RvbSA8Y29kZT53cml0ZU9iamVjdDwvY29kZT4gbWV0aG9k\nIGlmIHRoZQogICAgICogY2xhc3MgaXMgU2VyaWFsaXphYmxlIGFuZCBkb2Vz\nIG5vdCBkZWZpbmUgdGhlbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZFNlcmlhbGl6YXRpb25Db2RlKCkgewogICAgICAgIGlmIChleHRlcm5hbGl6\nZURldGFjaGVkKCkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFz\ncy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKAogICAgICAgICAgICAgICAgX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgICAgIGFkZFN1YmNs\nYXNzU2VyaWFsaXphdGlvbkNvZGUoKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm90IGFscmVhZHkgcHJlc2VudCwg\nYWRkIGEgc2VyaWFsVmVyc2lvblVJRCBmaWVsZDsgaWYgdGhlIGluc3RhbmNl\nCiAgICAgICAgLy8gaXMgZGV0YWNoYWJsZSBhbmQgdXNlcyBkZXRhY2hlZCBz\ndGF0ZSB3aXRob3V0IGEgZGVjbGFyZWQgZmllbGQsCiAgICAgICAgLy8gY2Fu\nJ3QgYWRkIGEgc2VyaWFsIHZlcnNpb24gVUlEIGJlY2F1c2Ugd2UnbGwgYmUg\nYWRkaW5nIGV4dHJhIGZpZWxkcwogICAgICAgIC8vIHRvIHRoZSBlbmhhbmNl\nZCB2ZXJzaW9uCiAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXREZWNs\nYXJlZEZpZWxkKCJzZXJpYWxWZXJzaW9uVUlEIik7CiAgICAgICAgaWYgKGZp\nZWxkID09IG51bGwpIHsKICAgICAgICAgICAgTG9uZyB1aWQgPSBudWxsOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdWlkID0gTnVtYmVy\ncy52YWx1ZU9mKE9iamVjdFN0cmVhbUNsYXNzLmxvb2t1cAogICAgICAgICAg\nICAgICAgICAgIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpLmdldFNlcmlh\nbFZlcnNpb25VSUQoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBsYXN0LWNoYW5jZSBjYXRjaCBm\nb3IgYnVnICMyODMgKHdoaWNoIGNhbiBoYXBwZW4KICAgICAgICAgICAgICAg\nIC8vIGluIGEgdmFyaWV0eSBvZiBDbGFzc0xvYWRpbmcgZW52aXJvbm1lbnRz\nKQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFu\nY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSwgdCk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJl\nbmhhbmNlLXVpZC1hY2Nlc3MiLCBfbWV0YSkpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBpZiB3ZSBjb3VsZG4ndCBhY2Nlc3MgdGhlIHNlcmlh\nbFZlcnNpb25VSUQsIHdlIHdpbGwgaGF2ZSB0bwogICAgICAgICAgICAvLyBz\na2lwIHRoZSBvdmVycmlkZSBvZiB0aGF0IGZpZWxkIGFuZCBub3QgYmUgc2Vy\naWFsaXphdGlvbgogICAgICAgICAgICAvLyBjb21wYXRpYmxlIHdpdGggbm9u\nLWVuaGFuY2VkIGNsYXNzZXMKICAgICAgICAgICAgaWYgKHVpZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQo\nInNlcmlhbFZlcnNpb25VSUQiLCBsb25nLmNsYXNzKTsKICAgICAgICAgICAg\nICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgICAgICBmaWVs\nZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRG\naW5hbCh0cnVlKTsKCiAgICAgICAgICAgICAgICBDb2RlIGNvZGUgPSBnZXRP\nckNyZWF0ZUNsYXNzSW5pdENvZGUoZmFsc2UpOwogICAgICAgICAgICAgICAg\nY29kZS5iZWZvcmVGaXJzdCgpOwogICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKHVpZC5sb25nVmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKGZpZWxkKTsKCiAgICAg\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFkZCB3cml0ZSBvYmplY3Qg\nbWV0aG9kCiAgICAgICAgQkNNZXRob2Qgd3JpdGUgPSBfcGMuZ2V0RGVjbGFy\nZWRNZXRob2QoIndyaXRlT2JqZWN0IiwKICAgICAgICAgICAgbmV3IENsYXNz\nW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICBib29s\nZWFuIGZ1bGwgPSB3cml0ZSA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7\nCiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdCAoT2Jq\nZWN0T3V0cHV0U3RyZWFtIG91dCkKICAgICAgICAgICAgd3JpdGUgPSBfcGMu\nZGVjbGFyZU1ldGhvZCgid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLAogICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5j\nbGFzcyB9KTsKICAgICAgICAgICAgd3JpdGUuZ2V0RXhjZXB0aW9ucyh0cnVl\nKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAg\nICB3cml0ZS5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2Rp\nZnlXcml0ZU9iamVjdE1ldGhvZCh3cml0ZSwgZnVsbCk7CgogICAgICAgIC8v\nIGFuZCByZWFkIG9iamVjdAogICAgICAgIEJDTWV0aG9kIHJlYWQgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRPYmplY3QiLAogICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAg\nICAgZnVsbCA9IHJlYWQgPT0gbnVsbDsKICAgICAgICBpZiAoZnVsbCkgewog\nICAgICAgICAgICAvLyBwcml2YXRlIHZvaWQgcmVhZE9iamVjdCAoT2JqZWN0\nSW5wdXRTdHJlYW0gaW4pCiAgICAgICAgICAgIHJlYWQgPSBfcGMuZGVjbGFy\nZU1ldGhvZCgicmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7\nCiAgICAgICAgICAgIHJlYWQuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNl\ncHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICByZWFkLmdl\ndEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAg\nICAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAg\nIHJlYWQubWFrZVByaXZhdGUoKTsKICAgICAgICB9CiAgICAgICAgbW9kaWZ5\nUmVhZE9iamVjdE1ldGhvZChyZWFkLCBmdWxsKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgYWRkU3ViY2xhc3NTZXJpYWxpemF0aW9uQ29kZSgpIHsKICAg\nICAgICAvLyBmb3IgZ2VuZXJhdGVkIHN1YmNsYXNzZXMsIHNlcmlhbGl6YXRp\nb24gbXVzdCB3cml0ZSBhbiBpbnN0YW5jZSBvZgogICAgICAgIC8vIHRoZSBz\ndXBlcmNsYXNzIGluc3RlYWQgb2YgdGhlIHN1YmNsYXNzLCBzbyB0aGF0IHRo\nZSBjbGllbnQgVk0gY2FuCiAgICAgICAgLy8gZGVzZXJpYWxpemUgc3VjY2Vz\nc2Z1bGx5LgoKICAgICAgICAvLyBwcml2YXRlIE9iamVjdCB3cml0ZVJlcGxh\nY2UoKSB0aHJvd3MgT2JqZWN0U3RyZWFtRXhjZXB0aW9uCiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoIndyaXRlUmVwbGFj\nZSIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLmdldEV4\nY2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKE9iamVjdFN0cmVhbUV4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIE9iamVjdCBvID0gbmV3IDxtYW5hZ2Vk\nLXR5cGU+KCkKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9tYW5hZ2Vk\nVHlwZSk7IC8vIGZvciByZXR1cm4KICAgICAgICBjb2RlLmR1cCgpOyAvLyBm\nb3IgcG9zdC08aW5pdD4gd29yawogICAgICAgIGNvZGUuZHVwKCk7IC8vIGZv\nciA8aW5pdD4KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwgIjxpbml0PiIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG51bGwpOwoKICAgICAgICAvLyBjb3B5IGFsbCB0\naGUgZmllbGRzLgogICAgICAgIC8vICMjIyMjIGxpbWl0aW5nIHRvIEpQQSBA\nVHJhbnNpZW50IGxpbWl0YXRpb25zCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKGZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICAvLyBvLjxmaWVsZD4gPSB0aGlzLjxmaWVsZD4g\nKG9yIHJlZmxlY3RpdmUgYW5hbG9nKQogICAgICAgICAgICBjb2RlLmR1cCgp\nOyAvLyBmb3IgcHV0ZmllbGQKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFRoaXMoKTsgLy8gZm9yIGdldGZpZWxkCiAgICAgICAgICAgIGdldGZpZWxk\nKGNvZGUsIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5nZXROYW1lKCkpOwogICAg\nICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUsIGZtZHNbaV0u\nZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJl\nZFR5cGUoKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmFyZXR1cm4oKS5z\nZXRUeXBlKE9iamVjdC5jbGFzcyk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgY2xhc3MgYmVp\nbmcgZW5oYW5jZWQgc2hvdWxkIGV4dGVybmFsaXplIHRvIGEgZGV0YWNoZWQK\nICAgICAqIGluc3RhbmNlIHJhdGhlciB0aGFuIHNlcmlhbGl6ZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGV4dGVybmFsaXplRGV0YWNoZWQoKSB7\nCiAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFs\ncyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkpCiAgICAgICAgICAgICYmIFNl\ncmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERl\nc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgJiYgIV9yZXBvcy5nZXRDb25m\naWd1cmF0aW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAg\nICAgICBpc0RldGFjaGVkU3RhdGVUcmFuc2llbnQoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgYSBjdXN0b20gd3JpdGVPYmplY3QgbWV0aG9kIHRo\nYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICoge0BsaW5rIE9iamVjdE91dHB1\ndFN0cmVhbSNkZWZhdWx0V3JpdGVPYmplY3R9IG1ldGhvZCwKICAgICAqIGJ1\ndCBvbmx5IGFmdGVyIGNhbGxpbmcgdGhlIGludGVybmFsIDxjb2RlPnBjU2Vy\naWFsaXppbmc8L2NvZGU+IG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIG1vZGlmeVdyaXRlT2JqZWN0TWV0aG9kKEJDTWV0aG9kIG1ldGhvZCwg\nYm9vbGVhbiBmdWxsKSB7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdl\ndENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAg\nICAgICAvLyBib29sIGNsZWFyID0gcGNTZXJpYWxpemluZyAoKTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNlcmlhbGl6\naW5nIiwKICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgbnVsbCk7CiAgICAg\nICAgaW50IGNsZWFyID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGNsZWFyKTsKCiAgICAgICAg\naWYgKGZ1bGwpIHsKICAgICAgICAgICAgLy8gb3V0LmRlZmF1bHRXcml0ZU9i\namVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzLAogICAgICAgICAgICAgICAgImRl\nZmF1bHRXcml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICB9CgogICAgICAgIEluc3Ry\ndWN0aW9uIHRtcGxhdGUgPSAoKENvZGUpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2Rl\nQWN0aW9uKCkpKS52cmV0dXJuKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9u\nIHRvcmV0OwogICAgICAgIEluc3RydWN0aW9uIHJldDsKICAgICAgICBjb2Rl\nLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9y\nd2FyZCh0bXBsYXRlKSkgewogICAgICAgICAgICByZXQgPSBjb2RlLnByZXZp\nb3VzKCk7CiAgICAgICAgICAgIC8vIGlmIChjbGVhcikgcGNTZXREZXRhY2hl\nZFN0YXRlIChudWxsKTsKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExv\nY2FsKGNsZWFyKTsKICAgICAgICAgICAgdG9yZXQgPSBjb2RlLmlmZXEoKTsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB0\nb3JldC5zZXRUYXJnZXQocmV0KTsKICAgICAgICAgICAgY29kZS5uZXh0KCk7\nIC8vIGp1bXAgb3ZlciByZXR1cm4KICAgICAgICB9CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgY3VzdG9t\nIHJlYWRPYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAg\nICoge0BsaW5rIE9iamVjdElucHV0U3RyZWFtI3JlYWRPYmplY3R9IG1ldGhv\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1vZGlmeVJlYWRPYmplY3RN\nZXRob2QoQkNNZXRob2QgbWV0aG9kLCBib29sZWFuIGZ1bGwpIHsKICAgICAg\nICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBj\nb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIC8vIGlmIHRoaXMgaW5zdGFu\nY2UgdXNlcyBzeW50aGV0aWMgZGV0YWNoZWQgc3RhdGUsIG5vdGUgdGhhdCBp\ndCBoYXMKICAgICAgICAvLyBiZWVuIGRlc2VyaWFsaXplZAogICAgICAgIGlm\nIChDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0\nYWNoZWRTdGF0ZSgpKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAg\nICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJT\nZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBpbi5kZWZhdWx0UmVh\nZE9iamVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAi\nZGVmYXVsdFJlYWRPYmplY3QiLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfQoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhl\nIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYW4gaW5z\ndGFuY2UKICAgICAqIGlzIGRldGFjaGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkSXNEZXRhY2hlZE1ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIGJvb2xl\nYW4gcGNJc0RldGFjaGVkKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiSXNEZXRhY2hlZCIsCiAgICAgICAg\nICAgIEJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtl\nUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgYm9vbGVhbiBuZWVkc0RlZmluaXRpdmVNZXRob2Qg\nPSB3cml0ZUlzRGV0YWNoZWRNZXRob2QoY29kZSk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICAgICAgaWYgKCFuZWVkc0RlZmluaXRpdmVNZXRob2Qp\nIAogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHByaXZhdGUgYm9v\nbGVhbiBwY0lzRGV0YWNoZWRTdGF0ZURlZmluaXRpdmUoKQogICAgICAgIC8v\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vIGF1eGlsbGlhcnkgZW5oYW5j\nZXJzIG1heSBjaGFuZ2UgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGlzIG1ldGhv\nZAogICAgICAgIC8vIGlmIHRoZWlyIHNwZWNzIGNvbnNpZGVyIGRldGFjaGVk\nIHN0YXRlIGRlZmluaXRpdmUKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFy\nZU1ldGhvZChJU0RFVEFDSEVEU1RBVEVERUZJTklUSVZFLCBib29sZWFuLmNs\nYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVBy\naXZhdGUoKTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAg\nICAgICBjb2RlLmlyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhlIGJvZHkgb2YgdGhl\nIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYW4KICAg\nICAqIGluc3RhbmNlIGlzIGRldGFjaGVkLgogICAgICoKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiB3ZSBuZWVkIGEgcGNJc0RldGFjaGVkU3RhdGVEZWZpbml0\naXZlIG1ldGhvZCwgZmFsc2UKICAgICAqIG90aGVyd2lzZQogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gd3JpdGVJc0RldGFjaGVkTWV0aG9kKENvZGUg\nY29kZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBub3QgZGV0YWNoYWJsZTogcmV0dXJuIEJvb2xlYW4uRkFM\nU0UKICAgICAgICBpZiAoIV9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAg\nICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFz\ncywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAvLwkJcmV0\ndXJuIChzbS5pc0RldGFjaGVkICgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUu\naWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0\naG9kKFNNVFlQRSwgImlzRGV0YWNoZWQiLAogICAgICAgICAgICBib29sZWFu\nLmNsYXNzLCBudWxsKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZmYWxz\nZSA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBpZmZhbHNlLnNldFRh\ncmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3Ms\nICJGQUxTRSIsCiAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpKTsKICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgLy8gaWYgd2UgdXNlIGRldGFj\naGVkIHN0YXRlOgogICAgICAgIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUg\nKCkgIT0gbnVsbAogICAgICAgIC8vICAgICAmJiBwY0dldERldGFjaGVkU3Rh\ndGUgIT0gREVTRVJJQUxJWkVEKQogICAgICAgIC8vICAgICByZXR1cm4gQm9v\nbGVhbi5UUlVFOwogICAgICAgIEJvb2xlYW4gc3RhdGUgPSBfbWV0YS51c2Vz\nRGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBub3Rk\nZXNlciA9IG51bGw7CiAgICAgICAgSW5zdHJ1Y3Rpb24gdGFyZ2V0OwogICAg\nICAgIGlmIChzdGF0ZSAhPSBCb29sZWFuLkZBTFNFKSB7CiAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAg\nICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBpZmlucyA9IGNv\nZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xh\nc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNs\nYXNzKTsKICAgICAgICAgICAgbm90ZGVzZXIgPSBjb2RlLmlmYWNtcGVxKCk7\nCiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CgogICAgICAgICAgICBpZiAoc3RhdGUgPT0gQm9v\nbGVhbi5UUlVFKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHRv\nIHVzZSBkZXRhY2hlZCBzdGF0ZToKICAgICAgICAgICAgICAgIC8vIHJldHVy\nbiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICAgICAgdGFyZ2V0ID0gY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0Ui\nLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpOwogICAgICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAg\nICAgICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVh\ndGUgYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJn\nZXQgPSBjb2RlLm5vcCgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJn\nZXQpOwogICAgICAgIGlmIChub3RkZXNlciAhPSBudWxsKQogICAgICAgICAg\nICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKCiAgICAgICAgLy8gYWxs\nb3cgdXNlcnMgd2l0aCB2ZXJzaW9uIG9yIGF1dG8tYXNzaWduZWQgcGsgZmll\nbGRzIHRvIG1hbnVhbGx5IAogICAgICAgIC8vIGNvbnN0cnVjdCBhICJkZXRh\nY2hlZCIgaW5zdGFuY2UsIHNvIGNoZWNrIHRoZXNlIGJlZm9yZSB0YWtpbmcg\naW50byAKICAgICAgICAvLyBhY2NvdW50IG5vbi1leGlzdGVudCBkZXRhY2hl\nZCBzdGF0ZQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hlZCBpZiB2ZXJz\naW9uIGlzIG5vbi1kZWZhdWx0CiAgICAgICAgRmllbGRNZXRhRGF0YSB2ZXJz\naW9uID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHN0\nYXRlICE9IEJvb2xlYW4uVFJVRSAmJiB2ZXJzaW9uICE9IG51bGwpIHsKICAg\nICAgICAgICAgLy8gaWYgKDx2ZXJzaW9uPiAhPSA8ZGVmYXVsdD4pCiAgICAg\nICAgICAgIC8vCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbik7CiAgICAgICAgICAgIGlm\naW5zID0gaWZEZWZhdWx0VmFsdWUoY29kZSwgdmVyc2lvbik7CiAgICAgICAg\nICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywg\nIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0\ndXJuKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAgICAg\nICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hlZCBpZiBhdXRvLWdlbm5l\nZCBwcmltYXJ5IGtleXMgYXJlIG5vbi1kZWZhdWx0CiAgICAgICAgaWZpbnMg\nPSBudWxsOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmluczIgPSBudWxs\nOwogICAgICAgIGJvb2xlYW4gaGFzQXV0b0Fzc2lnbmVkUEsgPSBmYWxzZTsK\nICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5UUlVFCiAgICAgICAgICAg\nICYmIF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEu\nSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAgLy8gZm9yIGVhY2ggcGsg\nZmllbGQ6CiAgICAgICAgICAgIC8vIGlmICg8cGs+ICE9IDxkZWZhdWx0PiBb\nJiYgISIiLmVxdWFscyAoPHBrPildKQogICAgICAgICAgICAvLwkJcmV0dXJu\nIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBr\ncyA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFsdWVTdHJhdGVneSgpID09IFZh\nbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgIHRhcmdldCA9IGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKGlmaW5z\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0\nKHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZiAoaWZpbnMyICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdldCh0YXJnZXQp\nOwogICAgICAgICAgICAgICAgaWZpbnMyID0gbnVsbDsKCiAgICAgICAgICAg\nICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAg\nICAgICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNvZGUsIHBr\nc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuU1RSSU5HKSB7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKCIiKTsKICAgICAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZy5jbGFzcywgImVxdWFscyIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG5ldyBD\nbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAg\naWZpbnMyID0gY29kZS5pZm5lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4u\nY2xhc3MsICJUUlVFIiwKICAgICAgICAgICAgICAgICAgICBCb29sZWFuLmNs\nYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYXJ0aWZpY2lh\nbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJnZXQgPSBjb2RlLm5v\ncCgpOwogICAgICAgIGlmIChpZmlucyAhPSBudWxsKQogICAgICAgICAgICBp\nZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICBpZiAoaWZpbnMyICE9\nIG51bGwpCiAgICAgICAgICAgIGlmaW5zMi5zZXRUYXJnZXQodGFyZ2V0KTsK\nCiAgICAgICAgLy8gaWYgaGFzIGF1dG8tYXNzaWduZWQgcGsgYW5kIHdlIGdl\ndCB0byB0aGlzIHBvaW50LCBtdXN0IGhhdmUgZGVmYXVsdAogICAgICAgIC8v\nIHZhbHVlLCBzbyBtdXN0IGJlIG5ldyBpbnN0YW5jZQogICAgICAgIGlmICho\nYXNBdXRvQXNzaWduZWRQSykgewogICAgICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4u\nY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgZGV0\nYWNoZWQgc3RhdGUgaXMgbm90IGRlZmluaXRpdmUsIGp1c3QgZ2l2ZSB1cCBu\nb3cgYW5kIHJldHVybgogICAgICAgIC8vIG51bGwgc28gdGhhdCB0aGUgcnVu\ndGltZSB3aWxsIHBlcmZvcm0gYSBEQiBsb29rdXAgdG8gZGV0ZXJtaW5lCiAg\nICAgICAgLy8gd2hldGhlciB3ZSdyZSBkZXRhY2hlZCBvciBuZXcKICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChJU0RFVEFDSEVEU1RBVEVERUZJTklUSVZF\nLCBib29sZWFuLmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBp\nZmlucyA9IGNvZGUuaWZuZSgpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoKICAgICAgICAvLyBubyBkZXRh\nY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0ZSBh\nbmQgaXQncyBub3QKICAgICAgICAvLyBzeW50aGV0aWMgb3IgdGhlIGluc3Rh\nbmNlIGlzIG5vdCBzZXJpYWxpemFibGUgb3IgdGhlIHN0YXRlIGlzbid0CiAg\nICAgICAgLy8gdHJhbnNpZW50LCBtdXN0IG5vdCBiZSBkZXRhY2hlZAogICAg\nICAgIGlmIChzdGF0ZSA9PSBudWxsCiAgICAgICAgICAgICYmICghQ2xhc3NN\nZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3Rh\ndGUoKSkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAg\nICAgICAgfHwgIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0YWNo\nU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBpc0RldGFjaGVkU3RhdGVU\ncmFuc2llbnQoKSkpIHsKICAgICAgICAgICAgLy8gcmV0dXJuIEJvb2xlYW4u\nRkFMU0UKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChC\nb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gZGV0YWNoZWQgc3RhdGU6IGlm\nIGluc3RhbmNlIHVzZXMgZGV0YWNoZWQgc3RhdGUgKGFuZCBtdXN0IGJlCiAg\nICAgICAgLy8gc3ludGhldGljIGFuZCB0cmFuc2llbnQgaW4gc2VyaWFsaXph\nYmxlIGluc3RhbmNlIGF0IHRoaXMgcG9pbnQpLAogICAgICAgIC8vIG5vdCBk\nZXRhY2hlZCBpZiBzdGF0ZSBub3Qgc2V0IHRvIERFU0VSSUFMSVpFRAogICAg\nICAgIGlmIChzdGF0ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIChw\nY0dldERldGFjaGVkU3RhdGUgKCkgPT0gbnVsbCkgLy8gaW5zdGVhZCBvZiBE\nRVNFUklBTElaRUQKICAgICAgICAgICAgLy8gICAgIHJldHVybiBCb29sZWFu\nLkZBTFNFOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlmaW5zID0g\nY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGdpdmUgdXA7IHdlIGp1c3QgZG9uJ3Qga25vdwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb21wYXJlIHRoZSBnaXZlbiBmaWVsZCB0byBpdHMgSmF2YSBkZWZhdWx0\nLCByZXR1cm5pbmcgdGhlCiAgICAgKiBjb21wYXJpc29uIGluc3RydWN0aW9u\nLiBUaGUgZmllbGQgdmFsdWUgd2lsbCBhbHJlYWR5IGJlIG9uIHRoZSBzdGFj\nay4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSnVtcEluc3RydWN0aW9u\nIGlmRGVmYXVsdFZhbHVlKENvZGUgY29kZSwKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFO\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgY29k\nZS5kY21wbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAg\nICAgICAgICBjb2RlLmZjbXBsKCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6\nCiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEwp\nOwogICAgICAgICAgICAgICAgY29kZS5sY21wKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZm51bGwoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGdldCB0\naGUgY29kZSBmb3IgdGhlIGNsYXNzIGluaXRpYWxpemVyIG1ldGhvZCwKICAg\nICAqIGNyZWF0aW5nIHRoZSBtZXRob2QgaWYgaXQgZG9lcyBub3QgYWxyZWFk\neSBleGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBDb2RlIGdldE9yQ3JlYXRl\nQ2xhc3NJbml0Q29kZShib29sZWFuIHJlcGxhY2VMYXN0KSB7CiAgICAgICAg\nQkNNZXRob2QgY2xpbml0ID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8Y2xp\nbml0PiIpOwogICAgICAgIENvZGUgY29kZTsKICAgICAgICBpZiAoY2xpbml0\nICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZSA9IGNsaW5pdC5nZXRDb2Rl\nKHRydWUpOwogICAgICAgICAgICBpZiAocmVwbGFjZUxhc3QpIHsKICAgICAg\nICAgICAgICAgIENvZGUgdGVtcGxhdGUgPSAoQ29kZSkgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAgICAgICAgICAgICAgIGNv\nZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZS52cmV0dXJuKCkpOwogICAgICAg\nICAgICAgICAgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICAgICAgY29k\nZS5zZXQodGVtcGxhdGUubm9wKCkpOwogICAgICAgICAgICAgICAgY29kZS5u\nZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvZGU7\nCiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgc3RhdGljIGluaXRpYWxpemVy\nIG1ldGhvZCBpZiBub24gZXhpc3RzCiAgICAgICAgY2xpbml0ID0gX3BjLmRl\nY2xhcmVNZXRob2QoIjxjbGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgY2xpbml0Lm1ha2VQYWNrYWdlKCk7CiAgICAgICAgY2xpbml0LnNl\ndFN0YXRpYyh0cnVlKTsKICAgICAgICBjbGluaXQuc2V0RmluYWwodHJ1ZSk7\nCgogICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICBpZiAoIXJlcGxhY2VMYXN0KSB7CiAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOwogICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBjb2RlOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyBieXRlY29kZSBtb2RpZnlpbmcgdGhlIGNsb25pbmcgYmVoYXZpb3Igb2Yg\ndGhlIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCB0byBjb3JyZWN0bHkg\ncmVwbGFjZSB0aGUgPGNvZGU+cGNTdGF0ZU1hbmFnZXI8L2NvZGU+IAogICAg\nICogaW5zdGFuY2UgZmllbGRzIG9mIGFueSBjbG9uZSBjcmVhdGVkIHdpdGgg\ndGhlaXIgZGVmYXVsdCB2YWx1ZXMuIAogICAgICogQWxzbywgaWYgdGhpcyBj\nbGFzcyBpcyB0aGUgYmFzZSBQQyB0eXBlIGFuZCBkb2VzIG5vdCBkZWNsYXJl\nZCAKICAgICAqIGEgY2xvbmUgbWV0aG9kLCBvbmUgd2lsbCBiZSBhZGRlZC4g\nQWxzbywgaWYgX3BjIGlzIGEgc3ludGhldGljCiAgICAgKiBzdWJjbGFzcywg\nY3JlYXRlIHRoZSBjbG9uZSgpIG1ldGhvZCB0aGF0IGNsZWFycyB0aGUgc3Rh\ndGUgbWFuYWdlcgogICAgICogdGhhdCBtYXkgaGF2ZSBiZWVuIGluaXRpYWxp\nemVkIGluIGEgc3VwZXIncyBjbG9uZSgpIG1ldGhvZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZENsb25pbmdDb2RlKCkgewogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVT\ndWJjbGFzcygpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGFk\nZCB0aGUgY2xvbmUgbWV0aG9kIGlmIG5lY2Vzc2FyeQogICAgICAgIEJDTWV0\naG9kIGNsb25lID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCJjbG9uZSIsIAog\nICAgICAgICAgICAoU3RyaW5nW10pIG51bGwpOwogICAgICAgIFN0cmluZyBz\ndXBlck5hbWUgPSBfbWFuYWdlZFR5cGUuZ2V0U3VwZXJjbGFzc05hbWUoKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBudWxsOwogICAgICAgIGlmIChjbG9uZSA9\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGFkZCBjbG9uZSBzdXBwb3J0IGZv\nciBiYXNlIGNsYXNzZXMKICAgICAgICAgICAgLy8gd2hpY2ggYWxzbyBpbXBs\nZW1lbnQgY2xvbmVhYmxlCiAgICAgICAgICAgIGJvb2xlYW4gaXNDbG9uZWFi\nbGUgPSBDbG9uZWFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgKICAgICAg\nICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpOwogICAgICAgICAg\nICBib29sZWFuIGV4dGVuZHNPYmplY3QgPQogICAgICAgICAgICAgICAgc3Vw\nZXJOYW1lLmVxdWFscyhPYmplY3QuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgaWYgKCFpc0Nsb25lYWJsZSB8fCAoIWV4dGVuZHNPYmplY3QgJiYg\nIWdldENyZWF0ZVN1YmNsYXNzKCkpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgaWYgKCFnZXRDcmVhdGVTdWJjbGFzcygpKQogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKAogICAgICAgICAgICAgICAgICAg\nICAgICBfbG9jLmdldCgiZW5oYW5jZS1jbG9uZWFibGUiLCBfbWFuYWdlZFR5\ncGUuZ2V0TmFtZSgpKSk7CgogICAgICAgICAgICAvLyBhZGQgY2xvbmUgbWV0\naG9kCiAgICAgICAgICAgIC8vIHByb3RlY3RlZCBPYmplY3QgY2xvbmUgKCkg\ndGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uCiAgICAgICAgICAg\nIGNsb25lID0gX3BjLmRlY2xhcmVNZXRob2QoImNsb25lIiwgT2JqZWN0LmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFzZXRWaXNpYmlsaXR5VG9T\ndXBlck1ldGhvZChjbG9uZSkpCiAgICAgICAgICAgICAgICBjbG9uZS5tYWtl\nUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGNsb25lLmdldEV4Y2VwdGlvbnMo\ndHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoQ2xvbmVOb3RT\ndXBwb3J0ZWRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBjb2RlID0g\nY2xvbmUuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgICAgIC8vIHJldHVybiBz\ndXBlci5jbG9uZSAoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9uZSIsCiAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgLy8gZ2V0IHRoZSBjbG9uZSBtZXRob2QgY29kZQogICAgICAgICAgICBj\nb2RlID0gY2xvbmUuZ2V0Q29kZShmYWxzZSk7CiAgICAgICAgICAgIGlmIChj\nb2RlID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgc3VwZXIuY2xvbmUgKCkg\naW5zdHJ1Y3Rpb24gdG8gbWF0Y2ggYWdhaW5zdAogICAgICAgIEluc3RydWN0\naW9uIHRlbXBsYXRlID0gKChDb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFj\ndGlvbigpKSkuaW52b2tlc3BlY2lhbCgpCiAgICAgICAgICAgIC5zZXRNZXRo\nb2Qoc3VwZXJOYW1lLCAiY2xvbmUiLCBPYmplY3QuY2xhc3MuZ2V0TmFtZSgp\nLCBudWxsKTsKCiAgICAgICAgLy8gZmluZCBjYWxscyB0byB0aGUgdGVtcGxh\ndGUgaW5zdHJ1Y3Rpb247IG9uIG1hdGNoCiAgICAgICAgLy8gY2xvbmUgd2ls\nbCBiZSBvbiBzdGFjawogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKICAg\nICAgICBpZiAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewogICAg\nICAgICAgICAvLyAoKDx0eXBlPikgY2xvbmUpLnBjU3RhdGVNYW5hZ2VyID0g\nbnVsbDsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgIGNvZGUucHV0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAgICAgICAgICAgIC8vIGlm\nIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nR2V0cyB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyByZWdpc3RlcmVkIGFzIHtA\nbGluayBTZXJ2aWNlcyBzZXJ2aWNlc30uCiAgICAgKi8KICAgIHB1YmxpYyBB\ndXhpbGlhcnlFbmhhbmNlcltdIGdldEF1eGlsaWFyeUVuaGFuY2VycygpIHsK\nCQlyZXR1cm4gX2F1eEVuaGFuY2VyczsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBBbGxvdyBhbnkgcmVnaXN0ZXJlZCBhdXhpbGlhcnkgY29kZSBnZW5l\ncmF0b3JzIHRvIHJ1bi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJ1bkF1\neGlsaWFyeUVuaGFuY2VycygpIHsKICAgIAlmb3IgKGludCBpID0gMDsgaSA8\nIF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCV9hdXhFbmhhbmNl\ncnNbaV0ucnVuKF9wYywgX21ldGEpOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIG1ldGhvZCBiZSBza2lwcGVkLgog\nICAgICogCiAgICAgKiBAcGFyYW0gbWV0aG9kIG1ldGhvZCB0byBiZSBza2lw\ncGVkIG9yIG5vdAogICAgICogQHJldHVybiB0cnVlIGlmIGFueSBvZiB0aGUg\nYXV4aWxpYXJ5IGVuaGFuY2VycyBza2lwcyB0aGUgZ2l2ZW4gbWV0aG9kLAog\nICAgICogb3IgaWYgdGhlIG1ldGhvZCBpcyBhIGNvbnN0cnVjdG9yCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBza2lwRW5oYW5jZShCQ01ldGhvZCBt\nZXRob2QpIHsKICAgICAgICBpZiAoIjxpbml0PiIuZXF1YWxzKG1ldGhvZC5n\nZXROYW1lKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVu\nZ3RoOyBpKyspCiAgICAJCWlmIChfYXV4RW5oYW5jZXJzW2ldLnNraXBFbmhh\nbmNlKG1ldGhvZCkpCiAgICAJCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHN5bnRoZXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcyB0aGF0IHdpbGwgcmVw\nbGFjZSBhbGwgZGlyZWN0CiAgICAgKiBmaWVsZCBhY2Nlc3Nlcy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEFjY2Vzc29ycygpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0\nRmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxk\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkg\newogICAgICAgICAgICAgICAgaWYgKCFnZXRSZWRlZmluZSgpCiAgICAgICAg\nICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNzVHlwZSgpICE9IENsYXNz\nTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgICAgICAgICAg\nYWRkU3ViY2xhc3NTZXRNZXRob2QoZm1kc1tpXSk7CiAgICAgICAgICAgICAg\nICAgICAgYWRkU3ViY2xhc3NHZXRNZXRob2QoZm1kc1tpXSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBhZGRHZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBh\nZGRTZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBz\nZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFu\nZAogICAgICogcGVyZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVsZCB0cmFja2lu\nZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzU2V0TWV0\naG9kKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hN\nZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNzIHByb3BUeXBlID0gZm1k\nLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIFN0cmluZyBzZXR0ZXJOYW1l\nID0gZ2V0U2V0dGVyTmFtZShmbWQpOwogICAgICAgIEJDTWV0aG9kIHNldHRl\nciA9IF9wYy5kZWNsYXJlTWV0aG9kKHNldHRlck5hbWUsIHZvaWQuY2xhc3Ms\nCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgcHJvcFR5cGUgfSk7CiAgICAg\nICAgc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2Qoc2V0dGVyKTsKICAgICAg\nICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gbm90IG5lY2Vzc2FyeSBpZiB3ZSdyZSBhbHJlYWR5IHRyYWNraW5nIGFj\nY2VzcyB2aWEgcmVkZWZpbml0aW9uCiAgICAgICAgaWYgKCFnZXRSZWRlZmlu\nZSgpKSB7CiAgICAgICAgICAgIC8vIGdldCB0aGUgb3JpZyB2YWx1ZSBvbnRv\nIHN0YWNrCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsK\nICAgICAgICAgICAgaW50IHZhbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgICAgIGNvZGUueHN0b3JlKCkuc2V0TG9jYWwodmFsKS5z\nZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGFk\nZE5vdGlmeU11dGF0aW9uKGNvZGUsIGZtZCwgdmFsLCAwKTsKICAgICAgICB9\nCgogICAgICAgIC8vICMjIyMjIHRlc3QgY2FzZTogQiBleHRlbmRzIEEuIE1l\ndGhvZHMgZGVmaW5lZCBpbiBBLiBXaGF0CiAgICAgICAgLy8gIyMjIyMgaGFw\ncGVucz8KICAgICAgICAvLyBzdXBlci5zZXRYWFgoLi4uKQogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS54bG9hZCgpLnNl\ndFBhcmFtKDApLnNldFR5cGUocHJvcFR5cGUpOwogICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgp\nLAogICAgICAgICAgICBzZXR0ZXJOYW1lLCB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7IHByb3BUeXBlIH0pOwoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICBwcml2YXRlIGJv\nb2xlYW4gc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2QoQkNNZXRob2QgbWV0\naG9kKSB7CiAgICAgICAgQkNNZXRob2RbXSBtZXRob2RzID0gX21hbmFnZWRU\neXBlLmdldE1ldGhvZHMobWV0aG9kLmdldE5hbWUoKSwKICAgICAgICAgICAg\nbWV0aG9kLmdldFBhcmFtVHlwZXMoKSk7CiAgICAgICAgaWYgKG1ldGhvZHMu\nbGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1hY2Nlc3NvciIsCiAgICAgICAgICAgICAgICBf\nbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBtZXRob2QuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgQkNNZXRob2Qgc3VwZXJNZXRoID0gbWV0aG9kc1swXTsKICAgICAg\nICBpZiAoc3VwZXJNZXRoLmlzUHJpdmF0ZSgpKSB7CiAgICAgICAgICAgIG1l\ndGhvZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1BhY2thZ2UoKSkgewog\nICAgICAgICAgICBtZXRob2QubWFrZVBhY2thZ2UoKTsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChzdXBlck1ldGguaXNQ\ncm90ZWN0ZWQoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVByb3RlY3Rl\nZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2Ug\naWYgKHN1cGVyTWV0aC5pc1B1YmxpYygpKSB7CiAgICAgICAgICAgIG1ldGhv\nZC5tYWtlUHVibGljKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBnZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMg\ndG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFuZAogICAgICogcGVyZm9ybXMgYW55\nIG5lY2Vzc2FyeSBmaWVsZCB0cmFja2luZy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZFN1YmNsYXNzR2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lID0gImdldCIgKyBTdHJpbmdV\ndGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkpOwogICAgICAgIGlmIChf\nbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRoTmFtZSwgbmV3IENsYXNzWzBd\nKS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgbWV0aE5hbWUgPSAiaXMiICsg\nU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0TmFtZSgpKTsKICAgICAg\nICBCQ01ldGhvZCBnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChtZXRoTmFt\nZSwgZm1kLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICBudWxsKTsK\nICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChnZXR0ZXIpOwog\nICAgICAgIGdldHRlci5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gZ2V0dGVyLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHdlJ3Jl\nIG5vdCBhbHJlYWR5IHRyYWNraW5nIGZpZWxkIGFjY2VzcyB2aWEgcmVmbGVj\ndGlvbiwgdGhlbiB3ZQogICAgICAgIC8vIG11c3QgbWFrZSB0aGUgZ2V0dGVy\nIGhvb2sgaW4gbGF6eSBsb2FkaW5nIGJlZm9yZSBhY2Nlc3NpbmcgdGhlIHN1\ncGVyCiAgICAgICAgLy8gbWV0aG9kLgogICAgICAgIGlmICghZ2V0UmVkZWZp\nbmUoKSkKICAgICAgICAgICAgYWRkTm90aWZ5QWNjZXNzKGNvZGUsIGZtZCk7\nCgogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5hZ2VkVHlwZS5nZXRU\neXBlKCksIG1ldGhOYW1lLAogICAgICAgICAgICBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCksIG51bGwpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUo\nZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBzdGF0aWMgZ2V0dGVy\nIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICogVGhlIGdlbmVy\nYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGggdGhlIGluc3RhbmNlIHN0YXRl\nIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdlciB0byBnZXQgdGhlIHZhbHVl\nIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0gaW5kZXggdGhl\nIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmllbGQKICAgICAqIEBwYXJhbSBm\nbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxkIHRvIGdldAogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkR2V0TWV0aG9kKGludCBpbmRleCwgRmllbGRN\nZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gY3JlYXRlR2V0TWV0\naG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIC8vIGlmIHJlYWRzIGFyZSBub3QgY2hlY2tlZCwg\nanVzdCByZXR1cm4gdGhlIHZhbHVlCiAgICAgICAgYnl0ZSBmaWVsZEZsYWcg\nPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAgICAgICBpZiAoKGZpZWxkRmxhZyAm\nIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFEKSA9PSAwCiAgICAgICAg\nICAgICYmIChmaWVsZEZsYWcgJiBQZXJzaXN0ZW5jZUNhcGFibGUuTUVESUFU\nRV9SRUFEKSA9PSAwKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgY29kZS54cmV0dXJuKCku\nc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFuYWdlciA9PSBu\ndWxsKSByZXR1cm4gaW5zdC48ZmllbGQ+OwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54cmV0dXJuKCku\nc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAvLyBp\nbnQgZmllbGQgPSBwY0luaGVyaXRlZEZpZWxkQ291bnQgKyA8ZmllbGRpbmRl\neD47CiAgICAgICAgaW50IGZpZWxkTG9jYWwgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcykpOwogICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7CiAgICAgICAgY29k\nZS5pYWRkKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChmaWVs\nZExvY2FsKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5hY2Nl\nc3NpbmdGaWVsZCAoZmllbGQpOwogICAgICAgIC8vIHJldHVybiBpbnN0Ljxm\naWVsZD47CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVl\nKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGZpZWxkTG9jYWwp\nOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNN\nVFlQRSwgImFjY2Vzc2luZ0ZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAg\nICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnhyZXR1cm4o\nKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIHN0\nYXRpYyBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAg\nKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMgd2l0aCB0aGUgaW5z\ndGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3RhdGVNYW5hZ2VyIHRvIHNl\ndCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJh\nbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRoZSBmaWVsZAogICAg\nICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUgZmllbGQgdG8gc2V0\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXRNZXRob2QoaW50IGlu\nZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBj\ncmVhdGVTZXRNZXRob2QoZm1kKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gUENFbmhhbmNlciB1c2Vz\nIHN0YXRpYyBtZXRob2RzOyBQQ1N1YmNsYXNzZXIgZG9lcyBub3QuCiAgICAg\nICAgaW50IGZpcnN0UGFyYW1PZmZzZXQgPSBnZXRBY2Nlc3NvclBhcmFtZXRl\nck9mZnNldCgpOwoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFuYWdl\nciA9PSBudWxsKSBpbnN0LjxmaWVsZD4gPSB2YWx1ZTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgY29kZS54\nbG9hZCgpLnNldFBhcmFtKGZpcnN0UGFyYW1PZmZzZXQpOwogICAgICAgIGFk\nZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5z\nZXR0aW5nPGZpZWxkVHlwZT5GaWVsZCAoaW5zdCwKICAgICAgICAvLyAgICAg\ncGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGluZGV4PiwgaW5zdC48ZmllbGQ+\nLCB2YWx1ZSwgMCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSkpOwogICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAgICAgIGNvZGUuaWFk\nZCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwog\nICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVN\nYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCksICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0dGFjaCAvIGRldGFjaCBt\nZXRob2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEF0\ndGFjaERldGFjaENvZGUoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIC8vIHNlZSBpZiBhbnkgc3VwZXJjbGFzc2Vz\nIGFyZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVhbiBwYXJlbnREZXRhY2hh\nYmxlID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIHBhcmVu\ndCA9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nICAgIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKSkgewogICAgICAgICAgICBpZiAocGFyZW50Lmlz\nRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBwYXJlbnREZXRhY2hh\nYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwYXJlbnQgbm90IGRldGFj\naGFibGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRhY2ggc3RhdGUgZmllbGRz\nIGFuZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhvZHMKICAgICAgICBpZiAo\nX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVT\ndWJjbGFzcygpCiAgICAgICAgICAgIHx8IHBhcmVudERldGFjaGFibGUgIT0g\nX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgYWRkSXNEZXRh\nY2hlZE1ldGhvZCgpOwogICAgICAgICAgICBhZGREZXRhY2hlZFN0YXRlTWV0\naG9kcyhfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpCiAgICAgICAgICAgICAg\nICAhPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHdlIGRldGFjaCBvbiBzZXJpYWxpemUsIHdlIGFsc28gbmVlZCB0byBpbXBs\nZW1lbnQgdGhlCiAgICAgICAgLy8gZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNl\nIHRvIHdyaXRlIGp1c3QgdGhlIHN0YXRlIGZvciB0aGUgZmllbGRzCiAgICAg\nICAgLy8gYmVpbmcgZGV0YWNoZWQKICAgICAgICBpZiAoZXh0ZXJuYWxpemVE\nZXRhY2hlZCgpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBhZGREZXRhY2hFeHRlcm5hbGl6ZShwYXJlbnREZXRhY2hhYmxlLAogICAg\nICAgICAgICAgICAgICAgIF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkgIT0g\nQm9vbGVhbi5GQUxTRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihuc21lKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZmllbGRzIHRv\nIGhvbGQgZGV0YWNoZWQgc3RhdGUgYW5kIHRoZWlyIGFjY2Vzc29yIG1ldGhv\nZHMuCiAgICAgKgogICAgICogQHBhcmFtIGltcGwgd2hldGhlciB0byBmdWxs\neSBpbXBsZW1lbnQgZGV0YWNoIHN0YXRlIGZ1bmN0aW9uYWxpdHkKICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaGVkU3RhdGVNZXRob2RzKGJv\nb2xlYW4gaW1wbCkgewogICAgICAgIEZpZWxkIGRldGFjaEZpZWxkID0gX21l\ndGEuZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCk7CiAgICAgICAgU3RyaW5nIG5h\nbWUgPSBudWxsOwogICAgICAgIFN0cmluZyBkZWNsYXJlciA9IG51bGw7CiAg\nICAgICAgaWYgKGltcGwgJiYgZGV0YWNoRmllbGQgPT0gbnVsbCkgewogICAg\nICAgICAgICBuYW1lID0gUFJFICsgIkRldGFjaGVkU3RhdGUiOwogICAgICAg\nICAgICBkZWNsYXJlciA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIEJD\nRmllbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKG5hbWUsIE9iamVjdC5j\nbGFzcyk7CiAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAg\nICAgICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9IGVs\nc2UgaWYgKGltcGwpIHsKICAgICAgICAgICAgbmFtZSA9IGRldGFjaEZpZWxk\nLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVjbGFyZXIgPSBkZXRhY2hGaWVs\nZC5nZXREZWNsYXJpbmdDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNHZXREZXRhY2hlZFN0YXRlICgp\nCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICBPYmplY3Qu\nY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0aWMoZmFsc2Up\nOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgaW50IGFj\nY2VzcyA9IG1ldGhvZC5nZXRBY2Nlc3NGbGFncygpOwoKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1w\nbCkgewogICAgICAgICAgICAvLyByZXR1cm4gcGNEZXRhY2hlZFN0YXRlOwog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLmdldFBy\nb2plY3QoKS5sb2FkQ2xhc3MoZGVjbGFyZXIpLAogICAgICAgICAgICAgICAg\nbmFtZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBj\nU2V0RGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0YXRlKQogICAgICAgIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRl\nIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzIFtdeyBPYmpl\nY3QuY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLnNldEFjY2Vzc0ZsYWdzKGFj\nY2Vzcyk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHBjRGV0YWNoZWRT\ndGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5\ncGUuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciksCiAgICAgICAg\nICAgICAgICBuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgIH0KICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4g\ndGhlIGluc3RydWN0aW9ucyB0byBnZXQgZmllbGQKICAgICAqIDxjb2RlPmF0\ndHJOYW1lPC9jb2RlPiBkZWNsYXJlZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVy\nPC9jb2RlPgogICAgICogb250byB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAg\nICAqCiAgICAgKiBUaGUgaW5zdGFuY2UgdG8gYWNjZXNzIG11c3QgYWxyZWFk\neSBiZSBvbiB0aGUgdG9wIG9mIHRoZQogICAgICogc3RhY2sgd2hlbiB0aGlz\nIGlzIGludm9rZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRmaWVs\nZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFt\nZSkgewogICAgICAgIGlmIChkZWNsYXJlciA9PSBudWxsKQogICAgICAgICAg\nICBkZWNsYXJlciA9IF9tYW5hZ2VkVHlwZTsKCiAgICAgICAgLy8gZmlyc3Qs\nIHNlZSBpZiB3ZSBjYW4gY29udmVydCB0aGUgYXR0cmlidXRlIG5hbWUgdG8g\nYSBmaWVsZCBuYW1lCiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IHRvQmFj\na2luZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAgICAgIC8vIG5leHQsIGZp\nbmQgdGhlIGZpZWxkIGluIHRoZSBtYW5hZ2VkIHR5cGUuCiAgICAgICAgQkNG\naWVsZFtdIGZpZWxkcyA9IChCQ0ZpZWxkW10pIEFjY2Vzc0NvbnRyb2xsZXIK\nICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRC\nQ0NsYXNzRmllbGRzQWN0aW9uKF9tYW5hZ2VkVHlwZSwKICAgICAgICAgICAg\nICAgIGZpZWxkTmFtZSkpOyAKICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gbnVs\nbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBmaWVsZCA9IGZpZWxkc1tpXTsKICAgICAg\nICAgICAgLy8gaWYgd2UgcmVhY2ggYSBmaWVsZCBkZWNsYXJlZCBpbiB0aGlz\nIHR5cGUsIHRoZW4gdGhpcyBpcyB0aGUKICAgICAgICAgICAgLy8gbW9zdC1t\nYXNraW5nIGZpZWxkLCBhbmQgaXMgdGhlIG9uZSB0aGF0IHdlIHdhbnQuCiAg\nICAgICAgICAgIC8vICMjIyMjIHByb2JhYmx5IHNob3VsZCB3YWxrIHVwIHRo\nZSBoaWVyYXJjaHksIG9yIGNoZWNrIHRoYXQKICAgICAgICAgICAgLy8gIyMj\nIyMgc2VycCBkb2VzIHRoYXQuCiAgICAgICAgICAgIGlmIChmaWVsZHNbaV0u\nZ2V0RGVjbGFyZXIoKSA9PSBkZWNsYXJlcikgewogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChn\nZXRDcmVhdGVTdWJjbGFzcygpICYmIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0RGVj\nbGFyZXIoKSA9PSBfcGMKICAgICAgICAgICAgJiYgKGZpZWxkID09IG51bGwg\nfHwgIWZpZWxkLmlzUHVibGljKCkpKSB7CiAgICAgICAgICAgIC8vIHdlJ3Jl\nIGNyZWF0aW5nIHRoZSBzdWJjbGFzcywgbm90IHJlZGVmaW5pbmcgdGhlIHVz\nZXIgdHlwZS4KCiAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKHRo\naXMsIFJlZmxlY3Rpb24uZmluZEZpZWxkKC4uLikpOwogICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhkZWNsYXJlcik7CiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmaWVsZE5hbWUpOwog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxl\nY3Rpb24uY2xhc3MsCiAgICAgICAgICAgICAgICAiZmluZEZpZWxkIiwgRmll\nbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAgIENsYXNz\nLmNsYXNzLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAg\nICAgICAgIENsYXNzIHR5cGUgPSBfbWV0YS5nZXRGaWVsZChhdHRyTmFtZSku\nZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZCgKICAgICAg\nICAgICAgICAgICAgICBnZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUs\nIEZpZWxkLmNsYXNzKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBzaG91bGQg\nbmV2ZXIgaGFwcGVuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJu\nYWxFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3Mp\nCiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlw\nZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKGRlY2xhcmVyLmdldE5hbWUoKSwgZmllbGROYW1lLAog\nICAgICAgICAgICAgICAgZmllbGQuZ2V0VHlwZSgpLmdldE5hbWUoKSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0byA8Y29kZT5j\nb2RlPC9jb2RlPiB0aGUgaW5zdHJ1Y3Rpb25zIHRvIHNldCBmaWVsZAogICAg\nICogPGNvZGU+YXR0ck5hbWU8L2NvZGU+IGRlY2xhcmVkIGluIHR5cGUgPGNv\nZGU+ZGVjbGFyZXI8L2NvZGU+CiAgICAgKiB0byB0aGUgdmFsdWUgb2YgdHlw\nZSA8Y29kZT5maWVsZFR5cGU8L2NvZGU+IG9uIHRoZSB0b3Agb2YgdGhlIHN0\nYWNrLgogICAgICoKICAgICAqIFdoZW4gdGhpcyBtZXRob2QgaXMgaW52b2tl\nZCwgdGhlIHZhbHVlIHRvIGxvYWQgbXVzdAogICAgICogYWxyZWFkeSBiZSBv\nbiB0aGUgdG9wIG9mIHRoZSBzdGFjayBpbiA8Y29kZT5jb2RlPC9jb2RlPiwK\nICAgICAqIGFuZCB0aGUgaW5zdGFuY2UgdG8gbG9hZCBpbnRvIG11c3QgYmUg\nc2Vjb25kLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHV0ZmllbGQoQ29k\nZSBjb2RlLCBCQ0NsYXNzIGRlY2xhcmVyLCBTdHJpbmcgYXR0ck5hbWUsCiAg\nICAgICAgQ2xhc3MgZmllbGRUeXBlKSB7CiAgICAgICAgaWYgKGRlY2xhcmVy\nID09IG51bGwpCiAgICAgICAgICAgIGRlY2xhcmVyID0gX21hbmFnZWRUeXBl\nOwoKICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gdG9CYWNraW5nRmllbGRO\nYW1lKGF0dHJOYW1lKTsKCiAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkgfHwg\nZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAvLyBSZWZsZWN0\naW9uLnNldCh0aGlzLCBSZWZsZWN0aW9uLmZpbmRGaWVsZCguLi4pLCB2YWx1\nZSk7CiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNz\nKGRlY2xhcmVyKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKGZpZWxkTmFtZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMo\nKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAg\nICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10gewogICAg\nICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVh\nbi5jbGFzcyB9KTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5z\nZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywgInNldCIsCiAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10g\newogICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywKICAgICAgICAg\nICAgICAgICAgICBmaWVsZFR5cGUuaXNQcmltaXRpdmUoKSA/IGZpZWxkVHlw\nZSA6IE9iamVjdC5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgRmllbGQu\nY2xhc3MgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29kZS5w\ndXRmaWVsZCgpCiAgICAgICAgICAgICAgICAuc2V0RmllbGQoZGVjbGFyZXIu\nZ2V0TmFtZSgpLCBmaWVsZE5hbWUsIGZpZWxkVHlwZS5nZXROYW1lKCkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElmIHVzaW5nIHByb3Bl\ncnR5IGFjY2Vzcywgc2VlIGlmIHRoZXJlIGlzIGEgZGlmZmVyZW50IGJhY2tp\nbmcgZmllbGQKICAgICAqIG5hbWUgZm9yIHRoZSBwZXJzaXN0ZW50IGF0dHJp\nYnV0ZSA8Y29kZT5uYW1lPC9jb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBT\ndHJpbmcgdG9CYWNraW5nRmllbGROYW1lKFN0cmluZyBuYW1lKSB7CiAgICAg\nICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRh\nLkFDQ0VTU19QUk9QRVJUWQogICAgICAgICAgICAmJiBfYXR0cnNUb0ZpZWxk\ncy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAgICAgbmFtZSA9IChTdHJp\nbmcpIF9hdHRyc1RvRmllbGRzLmdldChuYW1lKTsKICAgICAgICByZXR1cm4g\nbmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHVzaW5nIHByb3BlcnR5\nIGFjY2Vzcywgc2VlIGlmIHRoZXJlIGlzIGEgZGlmZmVyZW50IHBlcnNpc3Rl\nbnQKICAgICAqIGF0dHJpYnV0ZSBuYW1lIGZvciB0aGUgYmFja2luZyBmaWVs\nZCA8Y29kZT5uYW1lPC9jb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJp\nbmcgZnJvbUJhY2tpbmdGaWVsZE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICAvLyBtZXRhIGlzIG51bGwgd2hlbiBkb2luZyBwZXJzaXN0ZW5jZS1hd2Fy\nZSBlbmhhbmNlbWVudAogICAgICAgIGlmIChfbWV0YSAhPSBudWxsCiAgICAg\nICAgICAgICYmIF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLkFDQ0VTU19QUk9QRVJUWQogICAgICAgICAgICAmJiBfZmllbGRzVG9B\ndHRycy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIChT\ndHJpbmcpIF9maWVsZHNUb0F0dHJzLmdldChuYW1lKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIC8qKgogICAg\nICogSW1wbGVtZW50IHRoZSBleHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UgdG8g\nZGV0YWNoIG9uIHNlcmlhbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZERldGFjaEV4dGVybmFsaXplKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJs\nZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZW5zdXJl\nIHRoYXQgdGhlIGRlY2xhcmVkIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcHVi\nbGljIAogICAgICAgIC8vIGZvciBleHRlcm5hbGl6YXRpb24KICAgICAgICBC\nQ01ldGhvZCBtZXRoID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8aW5pdD4i\nLCAoU3RyaW5nW10pIG51bGwpOwogICAgICAgIGlmICghbWV0aC5pc1B1Ymxp\nYygpKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS1k\nZWZjb25zLWV4dGVybiIsIAogICAgICAgICAgICAgICAgICBfbWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCkpKTsKICAgICAgICAgICAgbWV0aC5tYWtlUHVibGlj\nKCk7CiAgICAgICAgfQogICAgICAgIC8vIGRlY2xhcmUgZXh0ZXJuYWxpemFi\nbGUgaW50ZXJmYWNlCiAgICAgICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5jbGFz\ncy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkp\nCiAgICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKEV4dGVybmFsaXph\nYmxlLmNsYXNzKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSB1c2VyIGRv\nZXNuJ3QgYWxyZWFkeSBoYXZlIGN1c3RvbSBleHRlcm5hbGl6YXRpb24gb3IK\nICAgICAgICAvLyBzZXJpYWxpemF0aW9uIG1ldGhvZHMKICAgICAgICBDbGFz\nc1tdIGlucHV0ID0gbmV3IENsYXNzW117IE9iamVjdElucHV0U3RyZWFtLmNs\nYXNzIH07CiAgICAgICAgQ2xhc3NbXSBvdXRwdXQgPSBuZXcgQ2xhc3NbXXsg\nT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH07CiAgICAgICAgaWYgKF9tYW5h\nZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsIGlucHV0\nKSAhPSBudWxsCiAgICAgICAgICAgIHx8IF9tYW5hZ2VkVHlwZS5nZXREZWNs\nYXJlZE1ldGhvZCgid3JpdGVPYmplY3QiLCBvdXRwdXQpICE9IG51bGwpCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJk\nZXRhY2gtY3VzdG9tLXNlciIsIF9tZXRhKSk7CiAgICAgICAgaW5wdXRbMF0g\nPSBPYmplY3RJbnB1dC5jbGFzczsKICAgICAgICBvdXRwdXRbMF0gPSBPYmpl\nY3RPdXRwdXQuY2xhc3M7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXRE\nZWNsYXJlZE1ldGhvZCgicmVhZEV4dGVybmFsIiwgaW5wdXQpICE9IG51bGwK\nICAgICAgICAgICAgfHwgX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9k\nKCJ3cml0ZUV4dGVybmFsIiwgb3V0cHV0KSAhPSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZGV0YWNoLWN1\nc3RvbS1leHRlcm4iLCBfbWV0YSkpOwoKICAgICAgICAvLyBjcmVhdGUgbGlz\ndCBvZiBhbGwgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAg\nICBCQ0ZpZWxkW10gZmllbGRzID0gX21hbmFnZWRUeXBlLmdldERlY2xhcmVk\nRmllbGRzKCk7CiAgICAgICAgQ29sbGVjdGlvbiB1bm1nZCA9IG5ldyBBcnJh\neUxpc3QoZmllbGRzLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFm\naWVsZHNbaV0uaXNUcmFuc2llbnQoKSAmJiAhZmllbGRzW2ldLmlzU3RhdGlj\nKCkKICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uaXNGaW5hbCgpCiAg\nICAgICAgICAgICAgICAmJiAhZmllbGRzW2ldLmdldE5hbWUoKS5zdGFydHNX\naXRoKFBSRSkKICAgICAgICAgICAgICAgICYmIF9tZXRhLmdldERlY2xhcmVk\nRmllbGQoZmllbGRzW2ldLmdldE5hbWUoKSkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHVubWdkLmFkZChmaWVsZHNbaV0pOwogICAgICAgIH0KCiAgICAg\nICAgYWRkUmVhZEV4dGVybmFsKHBhcmVudERldGFjaGFibGUsIGRldGFjaGVk\nU3RhdGUpOwogICAgICAgIGFkZFJlYWRVbm1hbmFnZWQodW5tZ2QsIHBhcmVu\ndERldGFjaGFibGUpOwogICAgICAgIGFkZFdyaXRlRXh0ZXJuYWwocGFyZW50\nRGV0YWNoYWJsZSwgZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkV3JpdGVV\nbm1hbmFnZWQodW5tZ2QsIHBhcmVudERldGFjaGFibGUpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIGN1c3RvbSByZWFkRXh0ZXJuYWwgbWV0aG9kLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUmVhZEV4dGVybmFsKGJvb2xl\nYW4gcGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVk\nU3RhdGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0\nSW5wdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRl\nY2xhcmVNZXRob2QoInJlYWRFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIGluYXJn\ncyk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2Vw\ndGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4\nY2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihD\nbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLnJl\nYWRFeHRlcm5hbCAoaW4pOwogICAgICAgIENsYXNzIHN1cCA9IF9tZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYg\nKCFwYXJlbnREZXRhY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oc3VwKSkgewogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2Qoc3VwLCAicmVhZEV4dGVybmFsIiwKICAgICAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIGluYXJncyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyByZWFkVW5tYW5hZ2VkIChpbik7CiAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChnZXRUeXBlKF9tZXRhKSwKICAgICAgICAgICAgUFJFICsgIlJlYWRV\nbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCBpbmFyZ3MpOwoKICAgICAgICBpZiAo\nZGV0YWNoZWRTdGF0ZSkgewogICAgICAgICAgICAvLyBwY1NldERldGFjaGVk\nU3RhdGUgKGluLnJlYWRPYmplY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRP\nYmplY3QiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBS\nRSArICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CgogICAgICAg\nICAgICAvLyBwY1JlcGxhY2VTdGF0ZU1hbmFnZXIgKChTdGF0ZU1hbmFnZXIp\nIGluLnJlYWRPYmplY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRPYmplY3Qi\nLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFN0YXRlTWFuYWdlci5j\nbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyAiUmVwbGFjZVN0YXRlTWFuYWdlciIsCiAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU3RhdGVNYW5hZ2VyLmNs\nYXNzIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVhZCBtYW5hZ2VkIGZp\nZWxkcwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNUcmFuc2ll\nbnQoKSkKICAgICAgICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmbWRz\nW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpLCBmbWRzW2ldKTsKCiAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWFkIHVubWFuYWdlZCBmaWVsZHMgZnJvbSB0aGUgc3RyZWFt\nIChwY1JlYWRVbm1hbmFnZWQpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkUmVhZFVubWFuYWdlZChDb2xsZWN0aW9uIHVubWdkLCBib29sZWFuIHBh\ncmVudERldGFjaGFibGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3Nb\nXXsgT2JqZWN0SW5wdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRo\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2\nb2lkLmNsYXNzLAogICAgICAgICAgICBpbmFyZ3MpOwogICAgICAgIG1ldGgu\nbWFrZVByb3RlY3RlZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0g\nbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRF\neGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGV4Y2Vwcy5h\nZGRFeGNlcHRpb24oQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBzdXBlci5yZWFkVW5tYW5hZ2VkIChpbik7CiAgICAgICAgaWYgKHBh\ncmVudERldGFjaGFibGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKSwgUFJFICsgIlJlYWRVbm1hbmFnZWQi\nLCB2b2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIGluYXJncyk7CiAgICAg\nICAgfQoKICAgICAgICAvLyByZWFkIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJp\nYWxpemFibGUgZmllbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0\nci5uZXh0KCk7CiAgICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmaWVs\nZC5nZXROYW1lKCksIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAg\nfQogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBy\nZWFkIGEgZmllbGQgZnJvbSBhbiBleHRlcm5hbGl6YXRpb24gaW5wdXQgc3Ry\nZWFtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVhZEV4dGVybmFsKENv\nZGUgY29kZSwgU3RyaW5nIGZpZWxkTmFtZSwgQ2xhc3MgdHlwZSwKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWU7CiAgICAg\nICAgaWYgKHR5cGUuaXNQcmltaXRpdmUoKSkgewogICAgICAgICAgICBtZXRo\nTmFtZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAgICAgICAgICBtZXRoTmFtZSA9\nIENoYXJhY3Rlci50b1VwcGVyQ2FzZShtZXRoTmFtZS5jaGFyQXQoMCkpCiAg\nICAgICAgICAgICAgICArIG1ldGhOYW1lLnN1YnN0cmluZygxKTsKICAgICAg\nICAgICAgbWV0aE5hbWUgPSAicmVhZCIgKyBtZXRoTmFtZTsKICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgbWV0aE5hbWUgPSAicmVhZE9iamVjdCI7Cgog\nICAgICAgIC8vIDxmaWVsZD4gPSBpbi5yZWFkPHR5cGU+ICgpOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBDbGFzcyByZXQgPSAo\ndHlwZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3M7CiAg\nICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0\nSW5wdXQuY2xhc3MsIG1ldGhOYW1lLAogICAgICAgICAgICByZXQsIG51bGwp\nOwogICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0g\nT2JqZWN0LmNsYXNzKQogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUodHlwZSk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAg\nICAgICBwdXRmaWVsZChjb2RlLCBudWxsLCBmaWVsZE5hbWUsIHR5cGUpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVD\nb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFS\nUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIC8v\nICAgc20ucHJveHlEZXRhY2hlZERlc2VyaWFsaXplZCAoPGluZGV4Pik7CiAg\nICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgICAgIElmSW5z\ndHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgICAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU01UWVBFKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoZm1kLmdldEluZGV4KCkpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwKICAg\nICAgICAgICAgICAgICAgICAgICAgInByb3h5RGV0YWNoZWREZXNlcmlhbGl6\nZWQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgICAgICAgICAgICAgIGlm\naW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBjdXN0b20gd3JpdGVF\neHRlcm5hbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRX\ncml0ZUV4dGVybmFsKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwKICAgICAg\nICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NbXSBvdXRhcmdzID0g\nbmV3IENsYXNzW117IE9iamVjdE91dHB1dC5jbGFzcyB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVFeHRlcm5h\nbCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwogICAgICAgIEV4Y2VwdGlvbnMg\nZXhjZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4\nY2Vwcy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\nc3VwZXIud3JpdGVFeHRlcm5hbCAob3V0KTsKICAgICAgICBDbGFzcyBzdXAg\nPSBnZXRUeXBlKF9tZXRhKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYg\nKCFwYXJlbnREZXRhY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oc3VwKSkgewogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2Qoc3VwLCAid3JpdGVFeHRlcm5hbCIsCiAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHdyaXRlVW5tYW5hZ2VkIChvdXQpOwogICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoZ2V0VHlwZShfbWV0YSksCiAgICAgICAgICAgIFBSRSArICJX\ncml0ZVVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwoKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gbnVsbDsKICAgICAgICBpZiAoZGV0\nYWNoZWRTdGF0ZSkgewogICAgICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkK\nICAgICAgICAgICAgLy8gICBpZiAoc20ud3JpdGVEZXRhY2hlZCAob3V0KSkK\nICAgICAgICAgICAgLy8gICAgICByZXR1cm47CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAg\nIElmSW5zdHJ1Y3Rpb24gaWZudWxsID0gY29kZS5pZm51bGwoKTsKICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUs\nICJ3cml0ZURldGFjaGVkIiwKICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xh\nc3MsIG91dGFyZ3MpOwogICAgICAgICAgICBnbzIgPSBjb2RlLmlmZXEoKTsK\nICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgICAgICAvLyBl\nbHNlCiAgICAgICAgICAgIC8vICAgb3V0LndyaXRlT2JqZWN0IChwY0dldERl\ndGFjaGVkU3RhdGUgKCkpOwogICAgICAgICAgICBDbGFzc1tdIG9iamFyZ3Mg\nPSBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH07CiAgICAgICAgICAgIGlm\nbnVsbC5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldFBhcmFtKDApKTsKICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUg\nKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBPYmplY3Qu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xhc3MsCiAgICAgICAgICAg\nICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLCBvYmphcmdzKTsKICAg\nICAgICAgICAgLy8gICAgb3V0LndyaXRlT2JqZWN0IChudWxsKSAvLyBTdGF0\nZU1hbmFnZXIKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKE9iamVj\ndCkgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywKICAgICAgICAgICAgICAg\nICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG9iamFyZ3MpOwogICAgICAg\nIH0KICAgICAgICBpZiAoZ28yICE9IG51bGwpCiAgICAgICAgICAgIGdvMi5z\nZXRUYXJnZXQoY29kZS5ub3AoKSk7CgogICAgICAgIC8vIHdyaXRlIG1hbmFn\nZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1Ry\nYW5zaWVudCgpKQogICAgICAgICAgICAgICAgd3JpdGVFeHRlcm5hbChjb2Rl\nLCBmbWRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmbWRz\nW2ldLmdldERlY2xhcmVkVHlwZSgpLCBmbWRzW2ldKTsKCiAgICAgICAgLy8g\ncmV0dXJuCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB1bm1hbmFn\nZWQgZmllbGRzIHRvIHRoZSBzdHJlYW0gKHBjV3JpdGVVbm1hbmFnZWQpLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkV3JpdGVVbm1hbmFnZWQoQ29s\nbGVjdGlvbiB1bm1nZCwgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENs\nYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRwdXQuY2xh\nc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgb3V0YXJncyk7CiAgICAgICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7\nCiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlv\nbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICAvLyBzdXBlci53cml0ZVVubWFuYWdlZCAob3V0\nKTsKICAgICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAg\nICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUg\nKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCAKICAgICAgICAgICAg\nICAgIG91dGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gd3JpdGUgZGVj\nbGFyZWQgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBC\nQ0ZpZWxkIGZpZWxkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5t\nZ2QuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nZmllbGQgPSAoQkNGaWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgd3Jp\ndGVFeHRlcm5hbChjb2RlLCBmaWVsZC5nZXROYW1lKCksIGZpZWxkLmdldFR5\ncGUoKSwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogSGVscGVyIG1ldGhvZCB0byB3cml0ZSBhIGZpZWxkIHRvIGFuIGV4dGVy\nbmFsaXphdGlvbiBvdXRwdXQgc3RyZWFtLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgd3JpdGVFeHRlcm5hbChDb2RlIGNvZGUsIFN0cmluZyBmaWVsZE5h\nbWUsIENsYXNzIHR5cGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\nU3RyaW5nIG1ldGhOYW1lOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZl\nKCkpIHsKICAgICAgICAgICAgbWV0aE5hbWUgPSB0eXBlLmdldE5hbWUoKTsK\nICAgICAgICAgICAgbWV0aE5hbWUgPSBDaGFyYWN0ZXIudG9VcHBlckNhc2Uo\nbWV0aE5hbWUuY2hhckF0KDApKQogICAgICAgICAgICAgICAgKyBtZXRoTmFt\nZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gIndyaXRl\nIiArIG1ldGhOYW1lOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBtZXRo\nTmFtZSA9ICJ3cml0ZU9iamVjdCI7CgogICAgICAgIC8vIG91dC53cml0ZTx0\neXBlPiAoPGZpZWxkPik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgZ2V0Zmll\nbGQoY29kZSwgbnVsbCwgZmllbGROYW1lKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAg\nICAgICBDbGFzc1tdIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgdHlwZSB9OwogICAg\nICAgIGlmICh0eXBlID09IGJ5dGUuY2xhc3MgfHwgdHlwZSA9PSBjaGFyLmNs\nYXNzIHx8IHR5cGUgPT0gc2hvcnQuY2xhc3MpCiAgICAgICAgICAgIGFyZ3Nb\nMF0gPSBpbnQuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoIXR5cGUuaXNQcmlt\naXRpdmUoKSkKICAgICAgICAgICAgYXJnc1swXSA9IE9iamVjdC5jbGFzczsK\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmpl\nY3RPdXRwdXQuY2xhc3MsIG1ldGhOYW1lLAogICAgICAgICAgICB2b2lkLmNs\nYXNzLCBhcmdzKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWFu\nYWdlZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kLCB0cnVlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGZpZWxkIHZhbHVlIHNwZWNp\nZmllZCBieSA8Y29kZT5mbWQ8L2NvZGU+IG9udG8gdGhlIHN0YWNrLgogICAg\nICogQmVmb3JlIHRoaXMgbWV0aG9kIGlzIGNhbGxlZCwgdGhlIG9iamVjdCB0\naGF0IHRoZSBkYXRhIHNob3VsZCBiZSBsb2FkZWQKICAgICAqIGZyb20gd2ls\nbCBiZSBvbiB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZnJvbVNhbWVDbGFzcyBpZiA8Y29kZT50cnVlPC9jb2RlPiwgdGhl\nbiA8Y29kZT5mbWQ8L2NvZGU+IGlzCiAgICAgKiBiZWluZyBsb2FkZWQgZnJv\nbSBhbiBpbnN0YW5jZSBvZiB0aGUgc2FtZSBjbGFzcyBhcyB0aGUgY3VycmVu\ndCBleGVjdXRpb24KICAgICAqIGNvbnRleHQuIElmIDxjb2RlPmZhbHNlPC9j\nb2RlPiwgdGhlbiB0aGUgaW5zdGFuY2Ugb24gdGhlIHRvcCBvZiB0aGUgc3Rh\nY2sKICAgICAqIG1pZ2h0IGJlIGEgc3VwZXJjbGFzcyBvZiB0aGUgY3VycmVu\ndCBleGVjdXRpb24gY29udGV4dCdzICd0aGlzJyBpbnN0YW5jZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29k\nZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBib29sZWFuIGZy\nb21TYW1lQ2xhc3MpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gaWYgcmVkZWZpbmluZywgdGhlbiB3ZSBtdXN0\nIGFsd2F5cyByZWZsZWN0IChvciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAgICAg\nLy8gZGlyZWN0bHkgaWYgYWNjZXNzaWJsZSksIHNpbmNlIHRoZSByZWRlZmlu\nZWQgbWV0aG9kcyB3aWxsIGFsd2F5cwogICAgICAgIC8vIHRyaWdnZXIgbWV0\naG9kIGNhbGxzIHRvIFN0YXRlTWFuYWdlciwgZXZlbiBmcm9tIGludGVybmFs\nIGRpcmVjdC0KICAgICAgICAvLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxkIHdv\ncmsgYXJvdW5kIHRoaXMgYnkgbm90IHJlZGVmaW5pbmcsIGFuZAogICAgICAg\nIC8vIGp1c3QgZG8gYSBzdWJjbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBCdXQg\ndGhpcyBpcyBub3QgYSBnb29kIG9wdGlvbiwKICAgICAgICAvLyBzaW5jZSBp\ndCB3b3VsZCBzYWNyaWZpY2UgbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2llbnQg\nZGlydHkgdHJhY2tpbmcuCgogICAgICAgIGlmIChnZXRSZWRlZmluZSgpCiAg\nICAgICAgICAgIHx8IF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICBnZXRmaWVsZChj\nb2RlLCBudWxsLCBmbWQuZ2V0TmFtZSgpKTsKICAgICAgICB9IGVsc2UgaWYg\nKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8gcHJvcGVy\ndHkgYWNjZXNzLCBhbmQgd2UncmUgbm90IHJlZGVmaW5pbmcuIElmIHdlJ3Jl\nIG9wZXJhdGluZwogICAgICAgICAgICAvLyBvbiBhbiBpbnN0YW5jZSB0aGF0\nIGlzIGRlZmluaXRlbHkgdGhlIHNhbWUgdHlwZSBhcyAndGhpcycsIHRoZW4K\nICAgICAgICAgICAgLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZCB0byBieXBh\nc3MgdHJhY2tpbmcuIE90aGVyd2lzZSwgcmVmbGVjdAogICAgICAgICAgICAv\nLyB0byBib3RoIGJ5cGFzcyB0cmFja2luZyBhbmQgYXZvaWQgY2xhc3MgdmVy\naWZpY2F0aW9uIGVycm9ycy4KICAgICAgICAgICAgaWYgKGZyb21TYW1lQ2xh\nc3MpIHsKICAgICAgICAgICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkg\nZm1kLmdldEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChtZXRoKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGws\nIGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgLy8gcmVndWxhciBlbmhhbmNlbWVudCArIHByb3Bl\ncnR5IGFjY2VzcwogICAgICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRob2Qp\nIGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwK\nICAgICAgICAgICAgICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdl\ndFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFN0b3JlIHRoZSB2YWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFj\nayBpbnRvIHRoZSBmaWVsZCB2YWx1ZSBzcGVjaWZpZWQKICAgICAqIGJ5IDxj\nb2RlPmZtZDwvY29kZT4uIEJlZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQs\nIHRoZSBkYXRhIHRvIGxvYWQgd2lsbAogICAgICogYmUgb24gdGhlIHRvcCBv\nZiB0aGUgc3RhY2sgYW5kIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91\nbGQgYmUgbG9hZGVkCiAgICAgKiBpbnRvIHdpbGwgYmUgc2Vjb25kIGluIHRo\nZSBzdGFjay4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1hbmFn\nZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAg\nICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAv\nLyBpZiByZWRlZmluaW5nLCB0aGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3Qg\nKG9yIGFjY2VzcyB0aGUgZmllbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBh\nY2Nlc3NpYmxlKSwgc2luY2UgdGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwg\nYWx3YXlzCiAgICAgICAgLy8gdHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3Rh\ndGVNYW5hZ2VyLCBldmVuIGZyb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAg\nIC8vIGFjY2VzcyB1c2FnZS4gV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBi\neSBub3QgcmVkZWZpbmluZywgYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1\nYmNsYXNzIGFwcHJvYWNoIGluc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdv\nb2Qgb3B0aW9uLAogICAgICAgIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmlj\nZSBsYXp5IGxvYWRpbmcgYW5kIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4K\nCiAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkKICAgICAgICAgICAgfHwgX21l\ndGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJ\nRUxEKSB7CiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZtZC5n\nZXROYW1lKCksIGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfSBl\nbHNlIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8v\nIHByb3BlcnR5IGFjY2VzcywgYW5kIHdlJ3JlIG5vdCByZWRlZmluaW5nLiBp\nbnZva2UgdGhlCiAgICAgICAgICAgIC8vIHN1cGVyY2xhc3MgbWV0aG9kIHRv\nIGJ5cGFzcyB0cmFja2luZy4KICAgICAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAg\nICAgICAgICAgICBnZXRTZXR0ZXJOYW1lKGZtZCksIHZvaWQuY2xhc3MsCiAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5\ncGUoKSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWd1\nbGFyIGVuaGFuY2VtZW50ICsgcHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyBnZXRTZXR0\nZXJOYW1lKGZtZCksCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG9mZnNldCB0aGF0\nIHRoZSBmaXJzdCBtZWFuaW5nZnVsIGFjY2Vzc29yIHBhcmFtZXRlciBpcyBh\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0QWNjZXNzb3JQYXJhbWV0\nZXJPZmZzZXQoKSB7CiAgICAgICAgcmV0dXJuIChfbWV0YS5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpID8gMSA6IDA7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIHtAbGluayBJbnN0cnVj\ndGlvbn1zIHRvIGxvYWQgdGhlIGluc3RhbmNlIHRvIG1vZGlmeSBvbnRvIHRo\nZQogICAgICogc3RhY2ssIGFuZCByZXR1cm4gaXQuIElmIDxjb2RlPmZvclN0\nYXRpYzwvY29kZT4gaXMgc2V0LCB0aGVuCiAgICAgKiA8Y29kZT5jb2RlPC9j\nb2RlPiBpcyBpbiBhbiBhY2Nlc3NvciBtZXRob2Qgb3IgYW5vdGhlciBzdGF0\naWMgbWV0aG9kOwogICAgICogb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2Yg\ndGhlIFBDLXNwZWNpZmllZCBtZXRob2RzLgogICAgICoKICAgICAqIEByZXR1\ncm4gdGhlIGZpcnN0IGluc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8\nL2NvZGU+LgogICAgICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYykg\newogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NN\nZXRhRGF0YS5BQ0NFU1NfRklFTEQgJiYgZm9yU3RhdGljKQogICAgICAgICAg\nICByZXR1cm4gY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIHJl\ndHVybiBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIHRoZSBnZW5lcmF0ZWQgZ2V0dGVyIHtAbGluayBCQ01l\ndGhvZH0gZm9yIDxjb2RlPmZtZDwvY29kZT4uIFRoZQogICAgICogY2FsbGlu\nZyBlbnZpcm9ubWVudCB3aWxsIHRoZW4gcG9wdWxhdGUgdGhpcyBtZXRob2Qn\ncyBjb2RlIGJsb2NrLgogICAgICovCiAgICBwcml2YXRlIEJDTWV0aG9kIGNy\nZWF0ZUdldE1ldGhvZChGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIEJD\nTWV0aG9kIGdldHRlcjsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlw\nZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAg\nICAgIC8vIHN0YXRpYyA8ZmllbGR0eXBlPiBwY0dldDxmaWVsZD4gKFhYWCBp\nbnN0KQogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERlY2xh\ncmVkRmllbGQoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGdldHRlciA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXQiICsgZm1kLmdldE5hbWUo\nKSwgZm1kLgogICAgICAgICAgICAgICAgZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0\nTmFtZSgpLCBuZXcgU3RyaW5nW117IF9wYy5nZXROYW1lKCkgfSk7CiAgICAg\nICAgICAgIGdldHRlci5zZXRBY2Nlc3NGbGFncyhmaWVsZC5nZXRBY2Nlc3NG\nbGFncygpCiAgICAgICAgICAgICAgICAmIH5Db25zdGFudHMuQUNDRVNTX1RS\nQU5TSUVOVCAmIH5Db25zdGFudHMuQUNDRVNTX1ZPTEFUSUxFKTsKICAgICAg\nICAgICAgZ2V0dGVyLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAgZ2V0\ndGVyLnNldEZpbmFsKHRydWUpOwogICAgICAgICAgICByZXR1cm4gZ2V0dGVy\nOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzOgogICAg\nICAgIC8vIGNvcHkgdGhlIHVzZXIncyBnZXR0ZXIgbWV0aG9kIHRvIGEgbmV3\nIG5hbWU7IHdlIGNhbid0IGp1c3QgcmVzZXQKICAgICAgICAvLyB0aGUgbmFt\nZSwgYmVjYXVzZSB0aGF0IHdpbGwgYWxzbyByZXNldCBhbGwgY2FsbHMgdG8g\ndGhlIG1ldGhvZAogICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1k\nLmdldEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICBnZXR0ZXIgPSBfcGMuZ2V0\nRGVjbGFyZWRNZXRob2QobWV0aC5nZXROYW1lKCksCiAgICAgICAgICAgIG1l\ndGguZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgQkNNZXRob2QgbmV3\nZ2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgbWV0aC5nZXROYW1l\nKCksCiAgICAgICAgICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdl\ndFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAgIG5ld2dldHRlci5zZXRBY2Nl\nc3NGbGFncyhnZXR0ZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7CiAgICAgICAgbmV3\nZ2V0dGVyLm1ha2VQcm90ZWN0ZWQoKTsgCiAgICAgICAgdHJhbnNmZXJDb2Rl\nQXR0cmlidXRlcyhnZXR0ZXIsIG5ld2dldHRlcik7CiAgICAgICAgcmV0dXJu\nIGdldHRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgZ2Vu\nZXJhdGVkIHNldHRlciB7QGxpbmsgQkNNZXRob2R9IGZvciA8Y29kZT5mbWQ8\nL2NvZGU+LiBUaGUKICAgICAqIGNhbGxpbmcgZW52aXJvbm1lbnQgd2lsbCB0\naGVuIHBvcHVsYXRlIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9jay4KICAgICAq\nLwogICAgcHJpdmF0ZSBCQ01ldGhvZCBjcmVhdGVTZXRNZXRob2QoRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICBCQ01ldGhvZCBzZXR0ZXI7CiAgICAg\nICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRh\nLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICAvLyBzdGF0aWMgdm9pZCBw\nY1NldDxmaWVsZD4gKFhYWCBpbnN0LCA8ZmllbGR0eXBlPiB2YWx1ZSkKICAg\nICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxk\nKGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICBzZXR0ZXIgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiU2V0IiArIGZtZC5nZXROYW1lKCksIHZvaWQu\nY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZ2V0VHlwZShf\nbWV0YSksIGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAgICAg\nc2V0dGVyLnNldEFjY2Vzc0ZsYWdzKGZpZWxkLmdldEFjY2Vzc0ZsYWdzKCkK\nICAgICAgICAgICAgICAgICYgfkNvbnN0YW50cy5BQ0NFU1NfVFJBTlNJRU5U\nICYgfkNvbnN0YW50cy5BQ0NFU1NfVk9MQVRJTEUpOwogICAgICAgICAgICBz\nZXR0ZXIuc2V0U3RhdGljKHRydWUpOwogICAgICAgICAgICBzZXR0ZXIuc2V0\nRmluYWwodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBzZXR0ZXI7CiAgICAg\nICAgfQoKICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3M6CiAgICAgICAgLy8g\nY29weSB0aGUgdXNlcidzIGdldHRlciBtZXRob2QgdG8gYSBuZXcgbmFtZTsg\nd2UgY2FuJ3QganVzdCByZXNldAogICAgICAgIC8vIHRoZSBuYW1lLCBiZWNh\ndXNlIHRoYXQgd2lsbCBhbHNvIHJlc2V0IGFsbCBjYWxscyB0byB0aGUgbWV0\naG9kCiAgICAgICAgc2V0dGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKGdl\ndFNldHRlck5hbWUoZm1kKSwKICAgICAgICAgICAgbmV3IENsYXNzW117IGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICBCQ01ldGhvZCBuZXdz\nZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyBzZXR0ZXIuZ2V0TmFt\nZSgpLAogICAgICAgICAgICBzZXR0ZXIuZ2V0UmV0dXJuTmFtZSgpLCBzZXR0\nZXIuZ2V0UGFyYW1OYW1lcygpKTsKICAgICAgICBuZXdzZXR0ZXIuc2V0QWNj\nZXNzRmxhZ3Moc2V0dGVyLmdldEFjY2Vzc0ZsYWdzKCkpOwogICAgICAgIG5l\nd3NldHRlci5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgdHJhbnNmZXJDb2Rl\nQXR0cmlidXRlcyhzZXR0ZXIsIG5ld3NldHRlcik7CiAgICAgICAgcmV0dXJu\nIHNldHRlcjsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0RW5oYW5j\nZW1lbnRDb250cmFjdFZlcnNpb25NZXRob2QoKSB7CiAgICAgICAgLy8gcHVi\nbGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAgICAg\nICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nCiAgICAgICAgICAgICAgICAiR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNp\nb24iLCBpbnQuY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHVi\nbGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKEVOSEFOQ0VS\nX1ZFUlNJT04pOwogICAgICAgIGNvZGUuaXJldHVybigpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBjb25jcmV0ZSB0eXBlIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIGkuZS4gaW1w\nbCBmb3IgbWFuYWdlZAogICAgICogaW50ZXJmYWNlcwogICAgICovCiAgICBw\ndWJsaWMgQ2xhc3MgZ2V0VHlwZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAobWV0YS5nZXRJbnRlcmZhY2VJbXBsKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAg\nICAgIHJldHVybiBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIE1vdmUgY29kZS1yZWxhdGVkIGF0dHJpYnV0ZXMgZnJv\nbSBvbmUgbWV0aG9kIHRvIGFub3RoZXIuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIHZvaWQgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhCQ01ldGhvZCBm\ncm9tLCBCQ01ldGhvZCB0bykgewogICAgICAgIENvZGUgY29kZSA9IGZyb20u\nZ2V0Q29kZShmYWxzZSk7CiAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCkgewog\nICAgICAgICAgICB0by5hZGRBdHRyaWJ1dGUoY29kZSk7CiAgICAgICAgICAg\nIGZyb20ucmVtb3ZlQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgRXhjZXB0\naW9ucyBleGNlcHMgPSBmcm9tLmdldEV4Y2VwdGlvbnMoZmFsc2UpOwogICAg\nICAgIGlmIChleGNlcHMgIT0gbnVsbCkKICAgICAgICAgICAgdG8uYWRkQXR0\ncmlidXRlKGV4Y2Vwcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2FnZTog\namF2YSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0VuaGFuY2VyIFtv\ncHRpb25dKgogICAgICogJmx0O2NsYXNzIG5hbWUgfCAuamF2YSBmaWxlIHwg\nLmNsYXNzIGZpbGUgfCAuamRvIGZpbGUmZ3Q7KwogICAgICogIFdoZXJlIHRo\nZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgcmVjb2duaXplZC4KICAgICAqIDx1\nbD4KICAgICAqIDxsaT48aT4tcHJvcGVydGllcy8tcCAmbHQ7cHJvcGVydGll\ncyBmaWxlJmd0OzwvaT46IFRoZSBwYXRoIHRvIGEgT3BlbkpQQQogICAgICog\ncHJvcGVydGllcyBmaWxlIGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYXMgb3V0\nbGluZWQgaW4KICAgICAqIHtAbGluayBDb25maWd1cmF0aW9ufTsgb3B0aW9u\nYWwuPC9saT4KICAgICAqIDxsaT48aT4tJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7\nICZsdDtwcm9wZXJ0eSB2YWx1ZSZndDs8L2k+OiBBbGwgYmVhbgogICAgICog\ncHJvcGVydGllcyBvZiB0aGUgc3RhbmRhcmQgT3BlbkpQQSB7QGxpbmsgT3Bl\nbkpQQUNvbmZpZ3VyYXRpb259IGNhbiBiZQogICAgICogc2V0IGJ5IHVzaW5n\nIHRoZWlyIG5hbWVzIGFuZCBzdXBwbHlpbmcgYSB2YWx1ZTsgZm9yIGV4YW1w\nbGU6CiAgICAgKiA8bGk+PGk+LWRpcmVjdG9yeS8tZCAmbHQ7YnVpbGQgZGly\nZWN0b3J5Jmd0OzwvaT46IFRoZSBwYXRoIHRvIHRoZSBiYXNlCiAgICAgKiBk\naXJlY3Rvcnkgd2hlcmUgZW5oYW5jZWQgY2xhc3NlcyBhcmUgc3RvcmVkLiBC\neSBkZWZhdWx0LCB0aGUKICAgICAqIGVuaGFuY2VyIG92ZXJ3cml0ZXMgdGhl\nIG9yaWdpbmFsIC5jbGFzcyBmaWxlIHdpdGggdGhlIGVuaGFuY2VkCiAgICAg\nKiB2ZXJzaW9uLiBVc2UgdGhpcyBvcHRpb24gdG8gc3RvcmUgdGhlIGdlbmVy\nYXRlZCAuY2xhc3MgZmlsZSBpbgogICAgICogYW5vdGhlciBkaXJlY3Rvcnku\nIFRoZSBwYWNrYWdlIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0\naAogICAgICogdGhlIGdpdmVuIGRpcmVjdG9yeS48L2xpPgogICAgICogPGxp\nPjxpPi1hZGREZWZhdWx0Q29uc3RydWN0b3IvLWFkYyBbdHJ1ZS90IHwgZmFs\nc2UvZl08L2k+OiBXaGV0aGVyIHRvCiAgICAgKiBhZGQgYSBkZWZhdWx0IGNv\nbnN0cnVjdG9yIHRvIHBlcnNpc3RlbnQgY2xhc3NlcyBtaXNzaW5nIG9uZSwg\nYXMKICAgICAqIG9wcG9zZWQgdG8gdGhyb3dpbmcgYW4gZXhjZXB0aW9uLiBE\nZWZhdWx0cyB0byB0cnVlLjwvbGk+CiAgICAgKiA8bGk+PGk+LXRtcENsYXNz\nTG9hZGVyLy10Y2wgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjogV2hldGhlciB0\nbwogICAgICogbG9hZCB0aGUgcHJlLWVuaGFuY2VkIGNsYXNzZXMgdXNpbmcg\nYSB0ZW1wb3JhcnkgY2xhc3MgbG9hZGVyLgogICAgICogRGVmYXVsdHMgdG8g\ndHJ1ZS4gU2V0IHRoaXMgdG8gZmFsc2Ugd2hlbiBhdHRlbXB0aW5nIHRvIGRl\nYnVnCiAgICAgKiBjbGFzcyBsb2FkaW5nIGVycm9ycy48L2xpPgogICAgICog\nPGxpPjxpPi1lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMvLWVwciBbdHJ1\nZS90IHwgZmFsc2UvZl08L2k+OgogICAgICogV2hldGhlciB0byB0aHJvdyBh\nbiBleGNlcHRpb24gaWYgYSBQUk9QRVJUWSBhY2Nlc3MgZW50aXR5IGFwcGVh\ncnMKICAgICAqIHRvIGJlIHZpb2xhdGluZyBzdGFuZGFyZCBwcm9wZXJ0eSBy\nZXN0cmljdGlvbnMuIERlZmF1bHRzIHRvIGZhbHNlLjwvbGk+CiAgICAgKiA8\nL3VsPgogICAgICogIEVhY2ggYWRkaXRpb25hbCBhcmd1bWVudCBjYW4gYmUg\nZWl0aGVyIHRoZSBmdWxsIGNsYXNzIG5hbWUgb2YgdGhlCiAgICAgKiB0eXBl\nIHRvIGVuaGFuY2UsIHRoZSBwYXRoIHRvIHRoZSAuamF2YSBmaWxlIGZvciB0\naGUgdHlwZSwgdGhlIHBhdGggdG8KICAgICAqIHRoZSAuY2xhc3MgZmlsZSBm\nb3IgdGhlIHR5cGUsIG9yIHRoZSBwYXRoIHRvIGEgLmpkbyBmaWxlIGxpc3Rp\nbmcgb25lCiAgICAgKiBvciBtb3JlIHR5cGVzIHRvIGVuaGFuY2UuCiAgICAg\nKiBJZiB0aGUgdHlwZSBiZWluZyBlbmhhbmNlZCBoYXMgbWV0YWRhdGEsIGl0\nIHdpbGwgYmUgZW5oYW5jZWQgYXMgYQogICAgICogcGVyc2lzdGVuY2UgY2Fw\nYWJsZSBjbGFzcy4gSWYgbm90LCBpdCB3aWxsIGJlIGNvbnNpZGVyZWQgYSBw\nZXJzaXN0ZW5jZQogICAgICogYXdhcmUgY2xhc3MsIGFuZCBhbGwgYWNjZXNz\nIHRvIGZpZWxkcyBvZiBwZXJzaXN0ZW5jZSBjYXBhYmxlIGNsYXNzZXMKICAg\nICAqIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIGFwcHJvcHJpYXRlCWdldC9z\nZXQgbWV0aG9kLiBJZiB0aGUgdHlwZQogICAgICogZXhwbGljaXRseSBkZWNs\nYXJlcyB0aGUgcGVyc2lzdGVuY2UtY2FwYWJsZSBpbnRlcmZhY2UsIGl0IHdp\nbGwKICAgICAqIG5vdCBiZSBlbmhhbmNlZC4gVGh1cywgaXQgaXMgc2FmZSB0\nbyBpbnZva2UgdGhlIGVuaGFuY2VyIG9uIGNsYXNzZXMKICAgICAqIHRoYXQg\nYXJlIGFscmVhZHkgZW5oYW5jZWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpCiAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9u\ncygpOwogICAgICAgIGFyZ3MgPSBvcHRzLnNldEZyb21DbWRMaW5lKGFyZ3Mp\nOwogICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgT3Bl\nbkpQQUNvbmZpZ3VyYXRpb25JbXBsKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKCFydW4oY29uZiwgYXJncywgb3B0cykpCiAgICAgICAgICAg\nICAgICBTeXN0ZW0uZXJyLnByaW50bG4oX2xvYy5nZXQoImVuaGFuY2UtdXNh\nZ2UiKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgY29uZi5j\nbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0\naGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlkIG9wdGlvbnMgZ2l2\nZW4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAg\nICBPcHRpb25zIG9wdHMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAob3B0cy5jb250YWluc0tleSgiaGVscCIpIHx8IG9wdHMu\nY29udGFpbnNLZXkoIi1oZWxwIikpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgRmxhZ3MgZmxhZ3MgPSBuZXcgRmxhZ3MoKTsKICAgICAg\nICBmbGFncy5kaXJlY3RvcnkgPSBGaWxlcy5nZXRGaWxlKG9wdHMucmVtb3Zl\nUHJvcGVydHkoImRpcmVjdG9yeSIsICJkIiwKICAgICAgICAgICAgbnVsbCks\nIG51bGwpOwogICAgICAgIGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3RvciA9\nIG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiYWRk\nRGVmYXVsdENvbnN0cnVjdG9yIiwgImFkYyIsIGZsYWdzLmFkZERlZmF1bHRD\nb25zdHJ1Y3Rvcik7CiAgICAgICAgZmxhZ3MudG1wQ2xhc3NMb2FkZXIgPSBv\ncHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInRtcENs\nYXNzTG9hZGVyIiwgInRjbCIsIGZsYWdzLnRtcENsYXNzTG9hZGVyKTsKICAg\nICAgICBmbGFncy5lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMgPSBvcHRz\nLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImVuZm9yY2VQ\ncm9wZXJ0eVJlc3RyaWN0aW9ucyIsICJlcHIiLAogICAgICAgICAgICAgICAg\nZmxhZ3MuZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zKTsKCiAgICAgICAg\nQ29uZmlndXJhdGlvbnMucG9wdWxhdGVDb25maWd1cmF0aW9uKGNvbmYsIG9w\ndHMpOwogICAgICAgIHJldHVybiBydW4oY29uZiwgYXJncywgZmxhZ3MsIG51\nbGwsIG51bGwsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogRW5oYW5j\nZSB0aGUgZ2l2ZW4gY2xhc3Nlcy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBib29sZWFuIHJ1bihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBTdHJp\nbmdbXSBhcmdzLAogICAgICAgIEZsYWdzIGZsYWdzLCBNZXRhRGF0YVJlcG9z\naXRvcnkgcmVwb3MsIEJ5dGVjb2RlV3JpdGVyIHdyaXRlciwKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAobG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIGxv\nYWRlciA9IGNvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNlKCkuCiAgICAg\nICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihQQ0VuaGFuY2VyLmNsYXNzLCBu\ndWxsKTsKICAgICAgICBpZiAoZmxhZ3MudG1wQ2xhc3NMb2FkZXIpCiAgICAg\nICAgICAgIGxvYWRlciA9IChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAg\nIC5uZXdUZW1wb3JhcnlDbGFzc0xvYWRlckFjdGlvbihsb2FkZXIpKTsKCiAg\nICAgICAgaWYgKHJlcG9zID09IG51bGwpIHsKICAgICAgICAgICAgcmVwb3Mg\nPSBjb25mLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAg\nICAgICAgIHJlcG9zLnNldFNvdXJjZU1vZGUoTWV0YURhdGFSZXBvc2l0b3J5\nLk1PREVfTUVUQSk7CiAgICAgICAgfQoKICAgICAgICBMb2cgbG9nID0gY29u\nZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX1RPT0wpOwogICAg\nICAgIENvbGxlY3Rpb24gY2xhc3NlczsKICAgICAgICBpZiAoYXJncy5sZW5n\ndGggPT0gMCkgewogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgicnVu\nbmluZy1hbGwtY2xhc3NlcyIpKTsKICAgICAgICAgICAgY2xhc3NlcyA9IHJl\ncG9zLmdldFBlcnNpc3RlbnRUeXBlTmFtZXModHJ1ZSwgbG9hZGVyKTsKICAg\nICAgICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCkgewogICAgICAgICAgICAJ\nbG9nLndhcm4oX2xvYy5nZXQoIm5vLWNsYXNzLXRvLWVuaGFuY2UiKSk7CiAg\nICAgICAgICAgIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBDbGFzc0FyZ1BhcnNlciBjYXAgPSBj\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5uZXdDbGFzc0FyZ1BhcnNl\ncigpOwogICAgICAgICAgICBjYXAuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsK\nICAgICAgICAgICAgY2xhc3NlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgIGNsYXNzZXMuYWRkQWxsKEFycmF5cy5hc0xpc3QoY2Fw\nLnBhcnNlVHlwZXMoYXJnc1tpXSkpKTsKICAgICAgICB9CiAgICAgICAgCiAg\nICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsKICAgICAg\nICBCQ0NsYXNzIGJjOwogICAgICAgIFBDRW5oYW5jZXIgZW5oYW5jZXI7CiAg\nICAgICAgaW50IHN0YXR1czsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGNsYXNzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgT2JqZWN0IG8gPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJh\nY2UoX2xvYy5nZXQoImVuaGFuY2UtcnVubmluZyIsIG8pKTsKCiAgICAgICAg\nICAgIGlmIChvIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICAgICAg\nYmMgPSBwcm9qZWN0LmxvYWRDbGFzcygoU3RyaW5nKSBvLCBsb2FkZXIpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBiYyA9IHByb2plY3Qu\nbG9hZENsYXNzKChDbGFzcykgbyk7CiAgICAgICAgICAgIGVuaGFuY2VyID0g\nbmV3IFBDRW5oYW5jZXIoY29uZiwgYmMsIHJlcG9zLCBsb2FkZXIpOwogICAg\nICAgICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBl\nbmhhbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAgICAgICAg\nICBlbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsKICAg\nICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGZs\nYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIHN0YXR1\ncyA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAoc3RhdHVzID09\nIEVOSEFOQ0VfTk9ORSkgewogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShf\nbG9jLmdldCgiZW5oYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAgICAgICAg\nICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50ZXJmYWNl\nIikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNF\nX0FXQVJFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJlbmhhbmNlLWF3YXJlIikpOwogICAgICAgICAgICAgICAgZW5oYW5jZXIu\ncmVjb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIHByb2plY3QuY2xlYXIo\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3Rv\ncnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERlZmF1bHRD\nb25zdHJ1Y3RvciA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdG1w\nQ2xhc3NMb2FkZXIgPSB0cnVlOwoJCXB1YmxpYyBib29sZWFuIGVuZm9yY2VQ\ncm9wZXJ0eVJlc3RyaWN0aW9ucyA9IGZhbHNlOwoJfQoKCS8qKgogCSAqIFBs\ndWdpbiBpbnRlcmZhY2UgZm9yIGFkZGl0aW9uYWwgZW5oYW5jZW1lbnQuCgkg\nKi8KCXB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIEF1eGlsaWFyeUVuaGFuY2Vy\nCgl7CgkJcHVibGljIHZvaWQgcnVuIChCQ0NsYXNzIGJjLCBDbGFzc01ldGFE\nYXRhIG1ldGEpOwoJCXB1YmxpYyBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0\naG9kIG0pOwoJfQp9Cg==\n","encoding":"base64"}

