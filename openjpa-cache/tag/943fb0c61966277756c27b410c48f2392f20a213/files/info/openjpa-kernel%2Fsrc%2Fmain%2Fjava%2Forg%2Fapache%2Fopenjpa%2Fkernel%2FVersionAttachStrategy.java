{"sha":"c01dcb2fa9ea5ff0238e5b5b8d2f733fb27dba47","node_id":"MDQ6QmxvYjIwNjM2NDpjMDFkY2IyZmE5ZWE1ZmYwMjM4ZTViNWI4ZDJmNzMzZmIyN2RiYTQ3","size":14694,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c01dcb2fa9ea5ff0238e5b5b8d2f733fb27dba47","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0\naWNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lkxp\nZmVjeWNsZUV2ZW50OwoKLyoqCiAqIEhhbmRsZXMgYXR0YWNoaW5nIGluc3Rh\nbmNlcyB1c2luZyB2ZXJzaW9uIGFuZCBwcmltYXJ5IGtleSBmaWVsZHMuCiAq\nCiAqIEBub2phdmFkb2MKICogQGF1dGhvciBTdGV2ZSBLaW0KICovCmNsYXNz\nIFZlcnNpb25BdHRhY2hTdHJhdGVneQogICAgZXh0ZW5kcyBBdHRhY2hTdHJh\ndGVneQogICAgaW1wbGVtZW50cyBEZXRhY2hTdGF0ZSB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChWZXJzaW9uQXR0YWNoU3RyYXRlZ3kuY2xhc3Mp\nOwoKICAgIHByb3RlY3RlZCBPYmplY3QgZ2V0RGV0YWNoZWRPYmplY3RJZChB\ndHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgT2JqZWN0IHRvQXR0YWNo\nKSB7CiAgICAgICAgQnJva2VyIGJyb2tlciA9IG1hbmFnZXIuZ2V0QnJva2Vy\nKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKS5nZXRNZXRhRGF0YSgKICAgICAgICAgICAgICAgIElt\ncGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKHRvQXR0YWNoKS5nZXRDbGFz\ncygpLAogICAgICAgICAgICAgICAgYnJva2VyLmdldENsYXNzTG9hZGVyKCks\nIHRydWUpOwogICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5jcmVhdGUo\nSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh0b0F0dGFjaCwKICAg\nICAgICAgICAgYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKSksCiAgICAgICAg\nICAgIG1ldGEpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHByb3ZpZGVG\naWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdlckltcGwgc20sCiAg\nICAgICAgaW50IGZpZWxkKSB7CiAgICAgICAgc20ucHJvdmlkZUZpZWxkKElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodG9BdHRhY2gsCiAgICAg\nICAgICAgIHNtLmdldENvbnRleHQoKS5nZXRDb25maWd1cmF0aW9uKCkpLCB0\naGlzLCBmaWVsZCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBhdHRhY2go\nQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBPYmplY3QgdG9BdHRhY2gsCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFibGUgaW50\nbywgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwKICAgICAgICBWYWx1ZU1l\ndGFEYXRhIG93bmVyTWV0YSwgYm9vbGVhbiBleHBsaWNpdCkgewogICAgICAg\nIEJyb2tlckltcGwgYnJva2VyID0gbWFuYWdlci5nZXRCcm9rZXIoKTsKICAg\nICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVscGVyLnRvUGVy\nc2lzdGVuY2VDYXBhYmxlKHRvQXR0YWNoLAogICAgICAgICAgICBtZXRhLmdl\ndFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkpOwoKICAgICAgICBi\nb29sZWFuIGVtYmVkZGVkID0gb3duZXJNZXRhICE9IG51bGwgJiYgb3duZXJN\nZXRhLmlzRW1iZWRkZWRQQygpOwogICAgICAgIGJvb2xlYW4gaXNOZXcgPSAh\nYnJva2VyLmlzRGV0YWNoZWQocGMpOwogICAgICAgIE9iamVjdCB2ZXJzaW9u\nID0gbnVsbDsKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwoKICAgICAg\nICAvLyBpZiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGVtYmVkZGVkIGlu\nc3RhbmNlIGlzIG51bGwsIHRoZW4KICAgICAgICAvLyBpdCBzaG91bGQgYmUg\ndHJlYXRlZCBhcyBhIG5ldyBpbnN0YW5jZSAoc2luY2UgdGhlCiAgICAgICAg\nLy8gbmV3bHkgcGVyc2lzdGVkIG93bmVyIG1heSBjcmVhdGUgYSBuZXcgZW1i\nZWRkZWQgaW5zdGFuY2UKICAgICAgICAvLyBpbiB0aGUgY29uc3RydWN0b3Ip\nOyBmaXhlZCBidWcgIzEwNzUuCiAgICAgICAgLy8gYWxzbywgaWYgdGhlIHVz\nZXIgaGFzIGF0dGFjaGVkIGEgZGV0YWNoZWQgb2JqIGZyb20gc29tZXdoZXJl\nCiAgICAgICAgLy8gZWxzZSBpbiB0aGUgZ3JhcGggdG8gYW4gZW1iZWRkZWQg\nZmllbGQgdGhhdCB3YXMgcHJldmlvdXNseSBudWxsLAogICAgICAgIC8vIGNv\ncHkgaW50byBhIG5ldyBlbWJlZGRlZCBpbnN0YW5jZQogICAgICAgIGlmIChl\nbWJlZGRlZCAmJiAoaXNOZXcgfHwgaW50byA9PSBudWxsCiAgICAgICAgICAg\nIHx8IGJyb2tlci5nZXRTdGF0ZU1hbmFnZXIoaW50bykgPT0gbnVsbCkpIHsK\nICAgICAgICAgICAgaWYgKGludG8gPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGludG8gPSBwYy5wY05ld0luc3RhbmNlKG51bGwsIGZhbHNlKTsKICAgICAg\nICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgYnJva2VyLmVtYmVkKGlu\ndG8sIG51bGwsIG93bmVyLCBvd25lck1ldGEpOwogICAgICAgICAgICBpbnRv\nID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgfSBlbHNl\nIGlmIChpc05ldykgewogICAgICAgICAgICBzbSA9IHBlcnNpc3QobWFuYWdl\nciwgcGMsIG1ldGEsIEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShwYywgbWV0YSks\nCiAgICAgICAgICAgICAgICBleHBsaWNpdCk7CiAgICAgICAgICAgIGludG8g\nPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICB9IGVsc2Ug\naWYgKCFlbWJlZGRlZCAmJiBpbnRvID09IG51bGwpIHsKICAgICAgICAgICAg\nT2JqZWN0IGlkID0gZ2V0RGV0YWNoZWRPYmplY3RJZChtYW5hZ2VyLCB0b0F0\ndGFjaCk7CiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgaW50byA9CiAgICAgICAgICAgICAgICAgICAgSW1wbEhlbHBlci50\nb1BlcnNpc3RlbmNlQ2FwYWJsZShicm9rZXIuZmluZChpZCwgdHJ1ZSwgbnVs\nbCksCiAgICAgICAgICAgICAgICAgICAgICAgIGJyb2tlci5nZXRDb25maWd1\ncmF0aW9uKCkpOwogICAgICAgICAgICBpZiAoaW50byA9PSBudWxsKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE9wdGltaXN0aWNFeGNlcHRpb24oX2xv\nYy5nZXQoImF0dGFjaC12ZXJzaW9uLWRlbCIsCiAgICAgICAgICAgICAgICAg\nICAgSW1wbEhlbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UocGMpLmdldENsYXNz\nKCksIGlkLCB2ZXJzaW9uKSkKICAgICAgICAgICAgICAgICAgICAuc2V0RmFp\nbGVkT2JqZWN0KHRvQXR0YWNoKTsKCiAgICAgICAgICAgIHNtID0gbWFuYWdl\nci5hc3NlcnRNYW5hZ2VkKGludG8pOwogICAgICAgICAgICBpZiAobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkKICAgICAgICAgICAgICAgICE9IHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQK\nICAgICAgICAgICAgICAgICAgICAoImF0dGFjaC13cm9uZ2NsYXNzIiwgaWQs\nIHRvQXR0YWNoLmdldENsYXNzKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAgICAg\nICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHRvQXR0YWNoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZQogICAgICAgICAgICBzbSA9IG1h\nbmFnZXIuYXNzZXJ0TWFuYWdlZChpbnRvKTsKCiAgICAgICAgLy8gbWFyayB0\naGF0IHdlIGF0dGFjaGVkIHRoZSBpbnN0YW5jZSAqYmVmb3JlKiB3ZQogICAg\nICAgIC8vIGZpbGwgaW4gdmFsdWVzIHRvIGF2b2lkIGVuZGxlc3MgcmVjdXJz\naW9uCiAgICAgICAgbWFuYWdlci5zZXRBdHRhY2hlZENvcHkodG9BdHRhY2gs\nIGludG8pOwoKICAgICAgICAvLyBpZiBwZXJzaXN0aW5nIGluIHBsYWNlLCBq\ndXN0IGF0dGFjaCBmaWVsZCB2YWx1ZXMKICAgICAgICBpZiAocGMgPT0gaW50\nbykgewogICAgICAgICAgICBhdHRhY2hGaWVsZHNJblBsYWNlKG1hbmFnZXIs\nIHNtKTsKICAgICAgICAgICAgcmV0dXJuIGludG87CiAgICAgICAgfQoKICAg\nICAgICBpZiAoaXNOZXcpIHsKICAgICAgICAgICAgYnJva2VyLmZpcmVMaWZl\nY3ljbGVFdmVudCh0b0F0dGFjaCwgbnVsbCwgbWV0YSwKICAgICAgICAgICAg\nICAgIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9QRVJTSVNUKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAvLyBpbnZva2UgYW55IHByZUF0dGFjaCBv\nbiB0aGUgZGV0YWNoZWQgaW5zdGFuY2UKICAgICAgICAgICAgbWFuYWdlci5m\naXJlQmVmb3JlQXR0YWNoKHRvQXR0YWNoLCBtZXRhKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGFzc2lnbiB0aGUgZGV0YWNoZWQgcGMgdGhlIHNhbWUgc3Rh\ndGUgbWFuYWdlciBhcyB0aGUgb2JqZWN0IHdlJ3JlCiAgICAgICAgLy8gY29w\neWluZyBpbnRvIGR1cmluZyB0aGUgYXR0YWNoIHByb2Nlc3MKICAgICAgICBT\ndGF0ZU1hbmFnZXIgc21CZWZvcmUgPSBwYy5wY0dldFN0YXRlTWFuYWdlcigp\nOwogICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihzbSk7CiAgICAg\nICAgaW50IGRldGFjaCA9IChpc05ldykgPyBERVRBQ0hfQUxMIDogYnJva2Vy\nLmdldERldGFjaFN0YXRlKCk7CiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoID0gYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzd2l0\nY2ggKGRldGFjaCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgREVUQUNI\nX0FMTDoKICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNoRmllbGQobWFu\nYWdlciwgdG9BdHRhY2gsIHNtLCBmbWRzW2ldLCB0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2Fz\nZSBERVRBQ0hfRkVUQ0hfR1JPVVBTOgogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoZmV0Y2gucmVxdWlyZXNGZXRjaChmbWRzW2ldKSAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJhdGlvbi5GRVRD\nSF9OT05FKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNoRmll\nbGQobWFuYWdlciwgdG9BdHRhY2gsIHNtLCBmbWRzW2ldLCB0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgY2FzZSBERVRBQ0hfTE9BREVEOgogICAgICAgICAgICAgICAgICAgICAg\nICBhdHRhY2hGaWVsZChtYW5hZ2VyLCB0b0F0dGFjaCwgc20sIGZtZHNbaV0s\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIoc21CZWZv\ncmUpOwogICAgICAgIH0KICAgICAgICBpZiAoIWVtYmVkZGVkICYmICFpc05l\ndykKICAgICAgICAgICAgY29tcGFyZVZlcnNpb24oc20sIHBjKTsKICAgICAg\nICByZXR1cm4gSW1wbEhlbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UoaW50byk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgdGhlIHZlcnNpb24g\naW5mb3JtYXRpb24gaXMgY29ycmVjdCBpbiB0aGUgZGV0YWNoZWQgb2JqZWN0\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29tcGFyZVZlcnNpb24oU3Rh\ndGVNYW5hZ2VySW1wbCBzbSwgUGVyc2lzdGVuY2VDYXBhYmxlIHBjKSB7CiAg\nICAgICAgT2JqZWN0IHZlcnNpb24gPSBwYy5wY0dldFZlcnNpb24oKTsKICAg\nICAgICBpZiAodmVyc2lvbiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIC8vIGRvbid0IG5lZWQgdG8gbG9hZCB1bmxvYWRlZCBmaWVs\nZHMgc2luY2UgaXRzIGltcGxpY2l0bHkKICAgICAgICAvLyBhIHNpbmdsZSBm\naWVsZCB2YWx1ZQogICAgICAgIFN0b3JlTWFuYWdlciBzdG9yZSA9IHNtLmdl\ndEJyb2tlcigpLmdldFN0b3JlTWFuYWdlcigpOwogICAgICAgIHN3aXRjaCAo\nc3RvcmUuY29tcGFyZVZlcnNpb24oc20sIHZlcnNpb24sIHNtLmdldFZlcnNp\nb24oKSkpIHsKICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIuVkVSU0lP\nTl9MQVRFUjoKICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgYSBsYXRlciB2\nZXJzaW9uOiBzZXQgaXQgaW50byB0aGUgb2JqZWN0LgogICAgICAgICAgICAg\nICAgLy8gbG9jayB2YWxpZGF0aW9uIHdpbGwgb2NjdXIgYXQgY29tbWl0IHRp\nbWUKICAgICAgICAgICAgICAgIHNtLnNldFZlcnNpb24odmVyc2lvbik7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTdG9yZU1h\nbmFnZXIuVkVSU0lPTl9FQVJMSUVSOgogICAgICAgICAgICBjYXNlIFN0b3Jl\nTWFuYWdlci5WRVJTSU9OX0RJRkZFUkVOVDoKICAgICAgICAgICAgICAgIHNt\nLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihzbS5nZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSk7CiAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2VyLlZFUlNJT05fU0FN\nRToKICAgICAgICAgICAgICAgIC8vIG5vIGFjdGlvbiByZXF1aXJlZAogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQXR0YWNoIHRoZSBmaWVsZHMgb2YgYW4gaW4tcGxhY2UgcGVyc2lz\ndGVkIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXR0YWNo\nRmllbGRzSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxk\nTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIE9iamVjdCBjdXIsIGF0dGFjaGVkOwog\nICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAg\nICAgICAgICAgICAgICAgY3VyID0gc20uZmV0Y2hPYmplY3RGaWVsZChpKTsK\nICAgICAgICAgICAgICAgICAgICBhdHRhY2hlZCA9IGF0dGFjaEluUGxhY2Uo\nbWFuYWdlciwgc20sIGZtZHNbaV0sIGN1cik7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJB\nWToKICAgICAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uZ2V0RWxlbWVu\ndCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY3VyID0gc20uZmV0\nY2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgICAgICBhdHRhY2hl\nZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaEluUGxhY2UobWFu\nYWdlciwgc20sIGZtZHNbaV0sIChPYmplY3RbXSkgY3VyKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbWRz\nW2ldLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAg\nIGN1ciA9IHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAg\nICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBm\nbWRzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAoQ29sbGVjdGlvbikg\nY3VyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgICAgICBp\nZiAoIWZtZHNbaV0uZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKQog\nICAgICAgICAgICAgICAgICAgICAgICAmJiAhZm1kc1tpXS5nZXRLZXkoKS5p\nc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGN1ciA9IHNtLmZldGNoT2Jq\nZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICAgICAgYXR0YWNoZWQgPSBh\ndHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWRzW2ldLCAoTWFwKSBjdXIp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1ciAhPSBhdHRhY2hlZCkKICAg\nICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChzbS5nZXRQZXJz\naXN0ZW5jZUNhcGFibGUoKSwgaSwKICAgICAgICAgICAgICAgICAgICBjdXIs\nIGF0dGFjaGVkLCBTdGF0ZU1hbmFnZXIuU0VUX1JFTU9URSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBwYy4K\nICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgYXR0YWNoSW5QbGFjZShBdHRh\nY2hNYW5hZ2VyIG1hbmFnZXIsIFN0YXRlTWFuYWdlckltcGwgc20sCiAgICAg\nICAgVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBwYykgewogICAgICAgIGlm\nIChwYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBPYmplY3QgYXR0YWNoZWQgPSBtYW5hZ2VyLmdldEF0dGFjaGVkQ29weShw\nYyk7CiAgICAgICAgaWYgKGF0dGFjaGVkICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBhdHRhY2hlZDsKCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBpbnRvID0gbWFuYWdlci5nZXRCcm9rZXIoKS5nZXRTdGF0ZU1hbmFnZXIo\ncGMpOwogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvUEMgPSAoaW50\nbyA9PSBudWxsKSA/IG51bGwKICAgICAgICAgICAgOiBpbnRvLmdldFBlcnNp\nc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIGlmICh2bWQuaXNFbWJlZGRlZCgp\nKQogICAgICAgICAgICByZXR1cm4gbWFuYWdlci5hdHRhY2gocGMsIGludG9Q\nQywgc20sIHZtZCwgZmFsc2UpOwogICAgICAgIHJldHVybiBtYW5hZ2VyLmF0\ndGFjaChwYywgaW50b1BDLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBdHRhY2ggdGhlIGdpdmVuIGFycmF5LgogICAgICov\nCiAgICBwcml2YXRlIE9iamVjdFtdIGF0dGFjaEluUGxhY2UoQXR0YWNoTWFu\nYWdlciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kLCBPYmplY3RbXSBhcnIpIHsKICAgICAgICBpZiAo\nYXJyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgYXJyW2ldID0gYXR0YWNoSW5QbGFjZShtYW5hZ2VyLCBzbSwgZm1k\nLmdldEVsZW1lbnQoKSwgYXJyW2ldKTsKICAgICAgICByZXR1cm4gYXJyOwog\nICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBjb2xsZWN0\naW9uLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rpb24gYXR0YWNoSW5Q\nbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSwgRmllbGRNZXRhRGF0YSBmbWQsIENvbGxlY3Rpb24gY29s\nbCkgewogICAgICAgIGlmIChjb2xsID09IG51bGwgfHwgY29sbC5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybiBjb2xsOwoKICAgICAgICAvLyBjb3B5\nIGlmIGVsZW1lbnRzIGVtYmVkZGVkIG9yIGNvbnRhaW5zIGRldGFjaGVkLCB3\naGljaCB3aWxsIG1lYW4KICAgICAgICAvLyB3ZSdsbCBoYXZlIHRvIGNvcHkg\ndGhlIGV4aXN0aW5nIGVsZW1lbnRzCiAgICAgICAgQ29sbGVjdGlvbiBjb3B5\nID0gbnVsbDsKICAgICAgICBpZiAoZm1kLmdldEVsZW1lbnQoKS5pc0VtYmVk\nZGVkKCkpCiAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVjdGlvbikgc20ubmV3\nRmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYgKG1hbmFn\nZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hlZChpdHIubmV4dCgpKSkgewogICAg\nICAgICAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVjdGlvbikgc20ubmV3Rmll\nbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIE9iamVjdCBhdHRhY2hlZDsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNlKG1hbmFn\nZXIsIHNtLCBmbWQuZ2V0RWxlbWVudCgpLAogICAgICAgICAgICAgICAgaXRy\nLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBjb3B5LmFkZChhdHRhY2hlZCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiAoY29weSA9PSBudWxsKSA/IGNvbGwgOiBjb3B5OwogICAg\nfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBtYXAuCiAgICAg\nKi8KICAgIHByaXZhdGUgTWFwIGF0dGFjaEluUGxhY2UoQXR0YWNoTWFuYWdl\nciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kLCBNYXAgbWFwKSB7CiAgICAgICAgaWYgKG1hcCA9PSBu\ndWxsIHx8IG1hcC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBtYXA7\nCgogICAgICAgIE1hcCBjb3B5ID0gbnVsbDsKICAgICAgICBNYXAuRW50cnkg\nZW50cnk7CiAgICAgICAgYm9vbGVhbiBrZXlQQyA9IGZtZC5nZXRLZXkoKS5p\nc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgYm9vbGVhbiB2YWxQQyA9IGZt\nZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpOwoKICAgICAgICAv\nLyBjb3B5IGlmIGVtYmVkZGVkIHBjcyBvciBkZXRhY2hlZCBwY3MsIHdoaWNo\nIHdpbGwgcmVxdWlyZSB1cyB0bwogICAgICAgIC8vIGNvcHkgZWxlbWVudHMK\nICAgICAgICBpZiAoZm1kLmdldEtleSgpLmlzRW1iZWRkZWRQQygpIHx8IGZt\nZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIGNv\ncHkgPSAoTWFwKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5nZXRJbmRleCgpKTsK\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAgaWYgKChrZXlQQyAmJiBtYW5hZ2VyLmdl\ndEJyb2tlcigpLmlzRGV0YWNoZWQoZW50cnkuZ2V0S2V5KCkpKQogICAgICAg\nICAgICAgICAgICAgIHx8ICh2YWxQQyAmJiBtYW5hZ2VyLmdldEJyb2tlcigp\nLmlzRGV0YWNoZWQKICAgICAgICAgICAgICAgICAgICAoZW50cnkuZ2V0VmFs\ndWUoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29weSA9IChNYXApIHNt\nLm5ld0ZpZWxkUHJveHkoZm1kLmdldEluZGV4KCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAu\nRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGtleSA9IGVudHJ5Lmdl\ndEtleSgpOwogICAgICAgICAgICBpZiAoa2V5UEMpCiAgICAgICAgICAgICAg\nICBrZXkgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWQuZ2V0S2V5\nKCksIGtleSk7CiAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZhbHVlKCk7\nCiAgICAgICAgICAgIGlmICh2YWxQQykKICAgICAgICAgICAgICAgIHZhbCA9\nIGF0dGFjaEluUGxhY2UobWFuYWdlciwgc20sIGZtZC5nZXRFbGVtZW50KCks\nIHZhbCk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBjb3B5LnB1dChrZXksIHZhbCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiAoY29weSA9PSBudWxsKSA/IG1hcCA6IGNvcHk7Cgl9CgogICAg\nLyoqCiAgICAgKiBGaW5kIGEgUGVyc2lzdGVuY2VDYXBhYmxlIGluc3RhbmNl\nIG9mIGFuIE9iamVjdCBpZiBpdCBleGlzdHMgaW4gdGhlCiAgICAgKiBkYXRh\nYmFzZS4gSWYgdGhlIG9iamVjdCBpcyBudWxsIG9yIGNhbid0IGJlIGZvdW5k\nIGluIHRoZSBkYXRhYmFzZS4KICAgICAqCiAgICAgKiBAcGFyYW0gcGMgQW4g\nb2JqZWN0IHdoaWNoIHdpbGwgYmUgYXR0YWNoZWQgaW50byB0aGUgY3VycmVu\ndCBjb250ZXh0LiBUaGUKICAgICAqIG9iamVjdCBtYXkgb3IgbWF5IG5vdCBj\nb3JyZXNwb25kIHRvIGEgcm93IGluIHRoZSBkYXRhYmFzZS4KICAgICAqCiAg\nICAgKiBAcmV0dXJuIElmIHRoZSBvYmplY3QgaXMgbnVsbCBvciBjYW4ndCBi\nZSBmb3VuZCBpbiB0aGUgZGF0YWJhc2UgdGhpcwogICAgICogbWV0aG9kIHJl\ndHVybnMgbnVsbC4gT3RoZXJ3aXNlIGEgUGVyc2lzdGVuY2VDYXBhYmxlIHJl\ncHJlc2VudGF0aW9uIG9mIHRoZQogICAgICogb2JqZWN0IGlzIHJldHVybmVk\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VDYXBhYmxlIGZp\nbmRGcm9tRGF0YWJhc2UoQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAg\nIE9iamVjdCBwYykgewogICAgICAgIE9iamVjdCBvaWQgPSBtYW5hZ2VyLmdl\ndEJyb2tlcigpLm5ld09iamVjdElkKHBjLmdldENsYXNzKCksCiAgICAgICAg\nICAgIG1hbmFnZXIuZ2V0RGV0YWNoZWRPYmplY3RJZChwYykpOwoKICAgICAg\nICBpZiAob2lkICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIEltcGxI\nZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUoCiAgICAgICAgICAgICAgICBt\nYW5hZ2VyLmdldEJyb2tlcigpLmZpbmQob2lkLCB0cnVlLCBudWxsKSwKICAg\nICAgICAgICAgICAgIG1hbmFnZXIuZ2V0QnJva2VyKCkuZ2V0Q29uZmlndXJh\ndGlvbigpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

