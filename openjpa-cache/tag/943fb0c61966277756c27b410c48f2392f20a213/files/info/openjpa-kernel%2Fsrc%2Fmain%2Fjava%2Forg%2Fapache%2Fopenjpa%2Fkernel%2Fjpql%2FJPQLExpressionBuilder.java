{"sha":"1b10331646e3659958ee8c9247749e7859c2b0e1","node_id":"MDQ6QmxvYjIwNjM2NDoxYjEwMzMxNjQ2ZTM2NTk5NThlZThjOTI0Nzc0OWU3ODU5YzJiMGUx","size":59586,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1b10331646e3659958ee8c9247749e7859c2b0e1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGph\ndmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlDb250ZXh0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQWJzdHJhY3RF\neHByZXNzaW9uQnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuZXhwcy5FeHByZXNzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25GYWN0b3J5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkxpdGVyYWw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUGFyYW1ldGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNz\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5T\ndWJxdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5K\nMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBCdWlsZGVyIGZvciBKUFFMIGV4cHJlc3Np\nb25zLiBUaGlzIGNsYXNzIHRha2VzIHRoZSBxdWVyeSBwYXJzZWQKICogaW4g\ne0BsaW5rIEpQUUx9IGFuZCBjb252ZXJ0cyBpdCB0byBhbiBleHByZXNzaW9u\nIHRyZWUgdXNpbmcKICogYW4ge0BsaW5rIEV4cHJlc3Npb25GYWN0b3J5fS4g\nUHVibGljIGZvciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAqCiAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgUGF0cmljayBMaW5z\na2V5CiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXIKICAgIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNzaW9uQnVp\nbGRlcgogICAgaW1wbGVtZW50cyBKUFFMVHJlZUNvbnN0YW50cyB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFZBUl9QQVRIID0gMTsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBWQVJfRVJST1IgPSAyOwoKICAgIHBy\naXZhdGUgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoSlBRTEV4cHJlc3Npb25CdWlsZGVyLmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFN0YWNrIGNvbnRleHRzID0gbmV3IFN0YWNr\nKCk7CiAgICBwcml2YXRlIExpbmtlZE1hcCBwYXJhbWV0ZXJUeXBlczsKICAg\nIHByaXZhdGUgaW50IGFsaWFzQ291bnQgPSAwOwoKICAgIC8qKgogICAgICog\nQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhl\nIGV4cHJlc3Npb24gZmFjdG9yeSB0byB1c2UKICAgICAqIEBwYXJhbSBxdWVy\neSB1c2VkIHRvIHJlc29sdmUgdmFyaWFibGVzLCBwYXJhbWV0ZXJzLAogICAg\nICogYW5kIGNsYXNzIG5hbWVzIHVzZWQgaW4gdGhlIHF1ZXJ5CiAgICAgKiBA\ncGFyYW0gcGFyc2VkUXVlcnkgdGhlIHBhcnNlZCBxdWVyeQogICAgICovCiAg\nICBwdWJsaWMgSlBRTEV4cHJlc3Npb25CdWlsZGVyKEV4cHJlc3Npb25GYWN0\nb3J5IGZhY3RvcnksCiAgICAgICAgRXhwcmVzc2lvblN0b3JlUXVlcnkgcXVl\ncnksIE9iamVjdCBwYXJzZWRRdWVyeSkgewogICAgICAgIHN1cGVyKGZhY3Rv\ncnksIHF1ZXJ5LmdldFJlc29sdmVyKCkpOwoKICAgICAgICBjb250ZXh0cy5w\ndXNoKG5ldyBDb250ZXh0KHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgUGFyc2Vk\nSlBRTAogICAgICAgICAgICA/IChQYXJzZWRKUFFMKSBwYXJzZWRRdWVyeQog\nICAgICAgICAgICA6IHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgU3RyaW5nCiAg\nICAgICAgICAgID8gZ2V0UGFyc2VkUXVlcnkoKFN0cmluZykgcGFyc2VkUXVl\ncnkpCiAgICAgICAgICAgIDogbnVsbCwgbnVsbCkpOwoKICAgICAgICBpZiAo\nY3R4KCkucGFyc2VkID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbihwYXJzZWRRdWVyeSArICIiKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgTG9jYWxpemVyIGdldExvY2FsaXplcigpIHsKICAgICAg\nICByZXR1cm4gX2xvYzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NMb2Fk\nZXIgZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgLy8gd2UgZG9uJ3QgcmVz\nb2x2ZSBpbiB0aGUgY29udGV4dCBvZiBhbnl0aGluZyBidXQgb3Vyc2VsdmVz\nCiAgICAgICAgcmV0dXJuIGdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgUGFyc2VkSlBRTCBnZXRQYXJzZWRRdWVy\neSgpIHsKICAgICAgICByZXR1cm4gY3R4KCkucGFyc2VkOwogICAgfQoKICAg\nIHByb3RlY3RlZCBQYXJzZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KFN0cmluZyBq\ncHFsKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQYXJzZWRKUFFMKGpwcWwpOwog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXRDYW5kaWRhdGUoQ2xhc3NNZXRh\nRGF0YSBjbWQsIFN0cmluZyBzY2hlbWFBbGlhcykgewogICAgICAgIGFkZEFj\nY2Vzc1BhdGgoY21kKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICBjdHgoKS5tZXRhID0gY21kOwoKICAgICAgICBpZiAoc2NoZW1h\nQWxpYXMgIT0gbnVsbCkKICAgICAgICAgICAgY3R4KCkuc2NoZW1hQWxpYXMg\nPSBzY2hlbWFBbGlhczsKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBuZXh0\nQWxpYXMoKSB7CiAgICAgICAgcmV0dXJuICJqcHFsYWxpYXMiICsgKCsrYWxp\nYXNDb3VudCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEg\ncmVzb2x2ZUNsYXNzTWV0YURhdGEoSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIC8vIGhhbmRsZSBsb29raW5nIHVwIGFsaWFzIG5hbWVzCiAgICAgICAgU3Ry\naW5nIHNjaGVtYU5hbWUgPSBhc3NlcnRTY2hlbWFOYW1lKG5vZGUpOwogICAg\nICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0Q2xhc3NNZXRhRGF0YShzY2hl\nbWFOYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAvLyB3ZSBtaWdodCBiZSBy\nZWZlcmVuY2luZyBhIGNvbGxlY3Rpb24gZmllbGQgb2YgYSBzdWJxdWVyeSdz\nIHBhcmVudAogICAgICAgIGlmIChpc1BhdGgobm9kZSkpIHsKICAgICAgICAg\nICAgUGF0aCBwYXRoID0gZ2V0UGF0aChub2RlKTsKICAgICAgICAgICAgcmV0\ndXJuIGdldEZpZWxkVHlwZShwYXRoLmxhc3QoKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBub3cgcnVuIGFnYWluIHRvIHRocm93IHRoZSBjb3JyZWN0IGV4\nY2VwdGlvbgogICAgICAgIHJldHVybiBnZXRDbGFzc01ldGFEYXRhKHNjaGVt\nYU5hbWUsIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0\nYSBnZXRDbGFzc01ldGFEYXRhKFN0cmluZyBhbGlhcywgYm9vbGVhbiBhc3Nl\ncnRWYWxpZCkgewogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IGdldENs\nYXNzTG9hZGVyKCk7CiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nID0gcmVzb2x2ZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBn\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwoKICAgICAgICAvLyBm\naXJzdCBjaGVjayBmb3IgdGhlIGFsaWFzCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9hZGVyLCBmYWxz\nZSk7CgogICAgICAgIGlmIChjbWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGNtZDsKCiAgICAgICAgLy8gbm93IGNoZWNrIGZvciB0aGUgY2xhc3Mg\nbmFtZTsgdGhpcyBpcyBub3QgdGVjaG5pY2FsbHkgcGVybWl0dGVkCiAgICAg\nICAgLy8gYnkgdGhlIEpQQSBzcGVjLCBidXQgaXMgcmVxdWlyZWQgaW4gb3Jk\nZXIgdG8gYmUgYWJsZSB0byBleGVjdXRlCiAgICAgICAgLy8gSlBRTCBxdWVy\naWVzIGZyb20gb3RoZXIgZmFjYWRlcyAobGlrZSBKRE8pIHRoYXQgZG8gbm90\nIGhhdmUKICAgICAgICAvLyB0aGUgY29uY2VwdCBvZiBlbnRpdHkgbmFtZXMg\nb3IgYWxpYXNlcwogICAgICAgIENsYXNzIGMgPSByZXNvbHZlci5jbGFzc0Zv\nck5hbWUoYWxpYXMsIG51bGwpOwogICAgICAgIGlmIChjICE9IG51bGwpCiAg\nICAgICAgICAgIGNtZCA9IHJlcG9zLmdldE1ldGFEYXRhKGMsIGxvYWRlciwg\nYXNzZXJ0VmFsaWQpOwogICAgICAgIGVsc2UgaWYgKGFzc2VydFZhbGlkKQog\nICAgICAgICAgICBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9h\nZGVyLCB0cnVlKTsKCiAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGFzc2Vy\ndFZhbGlkKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgYWxpYXMgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBjbWQ7\nCiAgICB9CgogICAgcHJpdmF0ZSBDbGFzcyBnZXRDYW5kaWRhdGVUeXBlKCkg\newogICAgICAgIHJldHVybiBnZXRDYW5kaWRhdGVNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURh\ndGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKGN0eCgp\nLm1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGN0eCgpLm1ldGE7\nCgogICAgICAgIENsYXNzTWV0YURhdGEgY2xzID0gZ2V0Q2FuZGlkYXRlTWV0\nYURhdGEocm9vdCgpKTsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2No\nZW1hLW5hbWUiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290\nKCkgfSwgbnVsbCk7CgogICAgICAgIHNldENhbmRpZGF0ZShjbHMsIG51bGwp\nOwogICAgICAgIHJldHVybiBjbHM7CiAgICB9CgogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIC8vIGV4YW1pbmcgdGhlIG5vZGUgdG8gZmluZCB0aGUg\nY2FuZGlkYXRlIHF1ZXJ5CiAgICAgICAgLy8gIyMjIHRoaXMgc2hvdWxkIGFj\ndHVhbGx5IGJlIHRoZSBwcmltYXJ5IFNFTEVDVCBpbnN0YW5jZQogICAgICAg\nIC8vIHJlc29sdmVkIGFnYWluc3QgdGhlIGZyb20gdmFyaWFibGUgZGVjbGFy\nYXRpb25zCiAgICAgICAgSlBRTE5vZGUgZnJvbSA9IG5vZGUuZmluZENoaWxk\nQnlJRChKSlRGUk9NSVRFTSwgdHJ1ZSk7CiAgICAgICAgaWYgKGZyb20gPT0g\nbnVsbCkgewogICAgICAgICAgICAvLyBPUEVOSlBBLTE1IGFsbG93IHN1YnF1\nZXJ5IHdpdGhvdXQgYSBGUk9NSVRFTQogICAgICAgICAgICBpZiAobm9kZS5p\nZCA9PSBKSlRTVUJTRUxFQ1QpIHsgCiAgICAgICAgICAgICAgICBmcm9tID0g\nbm9kZS5maW5kQ2hpbGRCeUlEKEpKVEZST00sIHRydWUpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZyb20tY2xhdXNlIiwgbnVs\nbCwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZnJvbS5jaGlsZHJlbi5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBKUFFMTm9kZSBuID0gZnJvbS5jaGlsZHJlbltpXTsK\nCiAgICAgICAgICAgIGlmIChuLmlkID09IEpKVEFCU1RSQUNUU0NIRU1BTkFN\nRSkgewogICAgICAgICAgICAgICAgLy8gd2Ugc2ltcGx5IHJldHVybiB0aGUg\nZmlyc3QgYWJzdHJhY3Qgc2NoZW1hIGNoaWxkCiAgICAgICAgICAgICAgICAv\nLyBhcyByZXNvbHZlZCBpbnRvIGEgY2xhc3MKICAgICAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgY21kID0gcmVzb2x2ZUNsYXNzTWV0YURhdGEobik7Cgog\nICAgICAgICAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBjbWQ7CgogICAgICAgICAgICAgICAgLy8gbm90IGEg\nc2NoZW1hOiB0cmVhdCBpdCBhcyBhIGNsYXNzCiAgICAgICAgICAgICAgICBT\ndHJpbmcgY2xzID0gYXNzZXJ0U2NoZW1hTmFtZShuKTsKICAgICAgICAgICAg\nICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290KCkg\nfSwgbnVsbCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGdldENsYXNzTWV0\nYURhdGEoY2xzLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBPUEVOSlBBLTE1IHN1cHBvcnQgc3VicXVlcnkncyBmcm9tIGNsYXVzZSBk\nbyBub3Qgc3RhcnQgd2l0aCAKICAgICAgICAgICAgLy8gaWRlbnRpZmljYXRp\nb25fdmFyaWFibGVfZGVjbGFyYXRpb24oKQogICAgICAgICAgICBpZiAobm9k\nZS5pZCA9PSBKSlRTVUJTRUxFQ1QpIHsKICAgICAgICAgICAgICAgIGlmIChu\nLmlkID09IEpKVElOTkVSSk9JTikgewogICAgICAgICAgICAgICAgICAgIG4g\nPSBuLmdldENoaWxkKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKG4uaWQgPT0gSkpUUEFUSCkgewogICAgICAgICAgICAgICAg\nICAgIFBhdGggcGF0aCA9IGdldFBhdGgobik7CiAgICAgICAgICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRGaWVsZFR5cGUocGF0aC5sYXN0\nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChjbWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21kOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNF\nUiwgIm5vLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBuIH0sIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAgICAg\nICAgCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgU3RyaW5nIGN1cnJlbnRRdWVyeSgpIHsKICAgICAgICBy\nZXR1cm4gY3R4KCkucGFyc2VkID09IG51bGwgfHwgcm9vdCgpLnBhcnNlciA9\nPSBudWxsID8gbnVsbAogICAgICAgICAgICA6IHJvb3QoKS5wYXJzZXIuanBx\nbDsKICAgIH0KCiAgICBRdWVyeUV4cHJlc3Npb25zIGdldFF1ZXJ5RXhwcmVz\nc2lvbnMoKSB7CiAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBzID0gbmV3\nIFF1ZXJ5RXhwcmVzc2lvbnMoKTsKCiAgICAgICAgZXZhbFF1ZXJ5T3BlcmF0\naW9uKGV4cHMpOwoKICAgICAgICBFeHByZXNzaW9uIGZpbHRlciA9IG51bGw7\nCiAgICAgICAgZmlsdGVyID0gYW5kKGV2YWxGcm9tQ2xhdXNlKHJvb3QoKS5p\nZCA9PSBKSlRTRUxFQ1QpLCBmaWx0ZXIpOwogICAgICAgIGZpbHRlciA9IGFu\nZChldmFsV2hlcmVDbGF1c2UoZXhwcyksIGZpbHRlcik7CiAgICAgICAgZmls\ndGVyID0gYW5kKGV2YWxTZWxlY3RDbGF1c2UoZXhwcyksIGZpbHRlcik7Cgog\nICAgICAgIGV4cHMuZmlsdGVyID0gZmlsdGVyID09IG51bGwgPyBmYWN0b3J5\nLmVtcHR5RXhwcmVzc2lvbigpIDogZmlsdGVyOwoKICAgICAgICBldmFsR3Jv\ndXBpbmdDbGF1c2UoZXhwcyk7CiAgICAgICAgZXZhbEhhdmluZ0NsYXVzZShl\neHBzKTsKICAgICAgICBldmFsRmV0Y2hKb2lucyhleHBzKTsKICAgICAgICBl\ndmFsU2V0Q2xhdXNlKGV4cHMpOwogICAgICAgIGV2YWxPcmRlcmluZ0NsYXVz\nZXMoZXhwcyk7CgogICAgICAgIGlmIChwYXJhbWV0ZXJUeXBlcyAhPSBudWxs\nKQogICAgICAgICAgICBleHBzLnBhcmFtZXRlclR5cGVzID0gcGFyYW1ldGVy\nVHlwZXM7CgogICAgICAgIGV4cHMuYWNjZXNzUGF0aCA9IGdldEFjY2Vzc1Bh\ndGgoKTsKCiAgICAgICAgcmV0dXJuIGV4cHM7CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGFuZChFeHByZXNzaW9uIGUxLCBFeHByZXNzaW9uIGUy\nKSB7CiAgICAgICAgcmV0dXJuIGUxID09IG51bGwgPyBlMiA6IGUyID09IG51\nbGwgPyBlMSA6IGZhY3RvcnkuYW5kKGUxLCBlMik7CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgU3RyaW5nIGFzc2VtYmxlKEpQUUxOb2RlIG5vZGUpIHsK\nICAgICAgICByZXR1cm4gYXNzZW1ibGUobm9kZSwgIi4iLCAwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBjaGlsZHJlbiBvZiB0aGUg\nc3BlY2lmaWMgbm9kZSBieSBhcHBlbmRpbmcgZWFjaAogICAgICogY2hpbGQs\nIHNlcGFyYXRlZCBieSB0aGUgZGVsaW1pdGVyLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBTdHJpbmcgYXNzZW1ibGUoSlBRTE5vZGUgbm9kZSwgU3Ry\naW5nIGRlbGltaXRlciwgaW50IGxhc3QpIHsKICAgICAgICBTdHJpbmdCdWZm\nZXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIEpQUUxO\nb2RlW10gcGFydHMgPSBub2RlLmNoaWxkcmVuOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBwYXJ0cyAhPSBudWxsICYmIGkgPCBwYXJ0cy5sZW5ndGggLSBs\nYXN0OyBpKyspCiAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQocmVzdWx0Lmxl\nbmd0aCgpID4gMCA/IGRlbGltaXRlciA6ICIiKS4KICAgICAgICAgICAgICAg\nIGFwcGVuZChwYXJ0c1tpXS50ZXh0KTsKCiAgICAgICAgcmV0dXJuIHJlc3Vs\ndC50b1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBh\nc3NpZ25Qcm9qZWN0aW9ucyhKUFFMTm9kZSBwYXJhbWV0ZXJzTm9kZSwKICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICBpbnQgY291\nbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9ucyA9IG5ldyBWYWx1ZVtjb3VudF07CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9uQ2xhdXNlcyA9IG5ldyBTdHJpbmdbY291bnRdOwog\nICAgICAgIGV4cHMucHJvamVjdGlvbkFsaWFzZXMgPSBuZXcgU3RyaW5nW2Nv\ndW50XTsKCiAgICAgICAgRXhwcmVzc2lvbiBleHAgPSBudWxsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAg\nICBKUFFMTm9kZSBwYXJlbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZChp\nKTsKICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9ubHlDaGlsZChwYXJl\nbnQpOwogICAgICAgICAgICBWYWx1ZSBwcm9qID0gZ2V0VmFsdWUobm9kZSk7\nCiAgICAgICAgICAgIGV4cHMucHJvamVjdGlvbnNbaV0gPSBwcm9qOwogICAg\nICAgICAgICBleHBzLnByb2plY3Rpb25BbGlhc2VzW2ldID0gbmV4dEFsaWFz\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGV2YWxRdWVyeU9wZXJhdGlvbihRdWVyeUV4cHJlc3Np\nb25zIGV4cHMpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSB3\nYW50IHRvIHNlbGVjdCwgZGVsZXRlLCBvciB1cGRhdGUKICAgICAgICBpZiAo\ncm9vdCgpLmlkID09IEpKVFNFTEVDVCB8fCByb290KCkuaWQgPT0gSkpUU1VC\nU0VMRUNUKQogICAgICAgICAgICBleHBzLm9wZXJhdGlvbiA9IFF1ZXJ5T3Bl\ncmF0aW9ucy5PUF9TRUxFQ1Q7CiAgICAgICAgZWxzZSBpZiAocm9vdCgpLmlk\nID09IEpKVERFTEVURSkKICAgICAgICAgICAgZXhwcy5vcGVyYXRpb24gPSBR\ndWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFOwogICAgICAgIGVsc2UgaWYgKHJv\nb3QoKS5pZCA9PSBKSlRVUERBVEUpCiAgICAgICAgICAgIGV4cHMub3BlcmF0\naW9uID0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFURTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VOU1VQUE9S\nVEVELCAidW5yZWNvZ25pemVkLW9wZXJhdGlvbiIsCiAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxsKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEdyb3VwaW5nQ2xhdXNlKFF1ZXJ5RXhwcmVzc2lv\nbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBHUk9VUCBCWSBjbGF1c2Vz\nCiAgICAgICAgSlBRTE5vZGUgZ3JvdXBCeU5vZGUgPSByb290KCkuZmluZENo\naWxkQnlJRChKSlRHUk9VUEJZLCB0cnVlKTsKCiAgICAgICAgaWYgKGdyb3Vw\nQnlOb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naW50IGdyb3VwQnlDb3VudCA9IGdyb3VwQnlOb2RlLmdldENoaWxkQ291bnQo\nKTsKCiAgICAgICAgZXhwcy5ncm91cGluZyA9IG5ldyBWYWx1ZVtncm91cEJ5\nQ291bnRdOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdyb3VwQnlD\nb3VudDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBncm91\ncEJ5Tm9kZS5nZXRDaGlsZChpKTsKICAgICAgICAgICAgZXhwcy5ncm91cGlu\nZ1tpXSA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEhhdmluZ0NsYXVzZShRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgSEFWSU5HIGNsYXVzZXMKICAg\nICAgICBKUFFMTm9kZSBoYXZpbmdOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5\nSUQoSkpUSEFWSU5HLCB0cnVlKTsKCiAgICAgICAgaWYgKGhhdmluZ05vZGUg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBleHBzLmhh\ndmluZyA9IGdldEV4cHJlc3Npb24ob25seUNoaWxkKGhhdmluZ05vZGUpKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbE9yZGVyaW5nQ2xhdXNlcyhR\ndWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgT1JE\nRVIgQlkgY2xhdXNlcwogICAgICAgIEpQUUxOb2RlIG9yZGVyYnkgPSByb290\nKCkuZmluZENoaWxkQnlJRChKSlRPUkRFUkJZLCBmYWxzZSk7CiAgICAgICAg\naWYgKG9yZGVyYnkgIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgb3JkZXJj\nb3VudCA9IG9yZGVyYnkuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICBl\neHBzLm9yZGVyaW5nID0gbmV3IFZhbHVlW29yZGVyY291bnRdOwogICAgICAg\nICAgICBleHBzLmFzY2VuZGluZyA9IG5ldyBib29sZWFuW29yZGVyY291bnRd\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9yZGVyY291bnQ7\nIGkrKykgewogICAgICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9yZGVy\nYnkuZ2V0Q2hpbGQoaSk7CiAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5n\nW2ldID0gZ2V0VmFsdWUoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAg\nICAgICAvLyBvbW1pc3Npb24gb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGllcyBh\nc2NlbmRpbmcKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldID0g\nbm9kZS5nZXRDaGlsZENvdW50KCkgPD0gMSB8fAogICAgICAgICAgICAgICAg\nICAgIGxhc3RDaGlsZChub2RlKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0cnVl\nIDogZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxTZWxlY3RDbGF1c2UoUXVlcnlFeHBy\nZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaWYgKGV4cHMub3BlcmF0aW9uICE9\nIFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1QpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3ROb2RlID0gcm9vdCgp\nOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3RDbGF1c2UgPSBzZWxlY3ROb2Rl\nLgogICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVFNFTEVDVENMQVVTRSwg\nZmFsc2UpOwogICAgICAgIGlmIChzZWxlY3RDbGF1c2UgIT0gbnVsbCAmJiBz\nZWxlY3RDbGF1c2UuaGFzQ2hpbGRJRChKSlRESVNUSU5DVCkpCiAgICAgICAg\nICAgIGV4cHMuZGlzdGluY3QgPSBleHBzLkRJU1RJTkNUX1RSVUUgfCBleHBz\nLkRJU1RJTkNUX0FVVE87CiAgICAgICAgZWxzZQogICAgICAgICAgICBleHBz\nLmRpc3RpbmN0ID0gZXhwcy5ESVNUSU5DVF9GQUxTRTsKCiAgICAgICAgSlBR\nTE5vZGUgY29uc3RydWN0b3IgPSBzZWxlY3ROb2RlLmZpbmRDaGlsZEJ5SUQo\nSkpUQ09OU1RSVUNUT1IsIHRydWUpOwogICAgICAgIGlmIChjb25zdHJ1Y3Rv\nciAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGJ1aWxkIHVwIHRoZSBmdWxs\neS1xdWFsaWZpZWQgcmVzdWx0IGNsYXNzIG5hbWUgYnkKICAgICAgICAgICAg\nLy8gYXBwZW5kaW5nIHRvZ2V0aGVyIHRoZSBjb21wb25lbnRzIG9mIHRoZSBj\naGlsZHJlbgogICAgICAgICAgICBTdHJpbmcgcmVzdWx0Q2xhc3NOYW1lID0g\nYXNzZW1ibGUobGVmdChjb25zdHJ1Y3RvcikpOwogICAgICAgICAgICBleHBz\nLnJlc3VsdENsYXNzID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKHJlc3VsdENs\nYXNzTmFtZSwgbnVsbCk7CgogICAgICAgICAgICAvLyBub3cgYXNzaWduIHRo\nZSBhcmd1bWVudHMgdG8gdGhlIHNlbGVjdCBjbGF1c2UgYXMgdGhlIHByb2pl\nY3Rpb25zCiAgICAgICAgICAgIHJldHVybiBhc3NpZ25Qcm9qZWN0aW9ucyhy\naWdodChjb25zdHJ1Y3RvciksIGV4cHMpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIC8vIGhhbmRsZSBTRUxFQ1QgY2xhdXNlcwogICAgICAgICAg\nICBKUFFMTm9kZSBleHBOb2RlID0gc2VsZWN0Tm9kZS4KICAgICAgICAgICAg\nICAgIGZpbmRDaGlsZEJ5SUQoSkpUU0VMRUNURVhQUkVTU0lPTlMsIHRydWUp\nOwogICAgICAgICAgICBpZiAoZXhwTm9kZSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBpbnQgc2VsZWN0Q291\nbnQgPSBleHBOb2RlLmdldENoaWxkQ291bnQoKTsKICAgICAgICAgICAgSlBR\nTE5vZGUgc2VsZWN0Q2hpbGQgPSBmaXJzdENoaWxkKGV4cE5vZGUpOwoKICAg\nICAgICAgICAgLy8gaWYgd2UgYXJlIHNlbGVjdGluZyBqdXN0IG9uZSB0aGlu\nZyBhbmQgdGhhdCB0aGluZyBpcyB0aGUKICAgICAgICAgICAgLy8gc2NoZW1h\nJ3MgYWxpYXMsIHRoZW4gZG8gbm90IHRyZWF0IGl0IGFzIGEgcHJvamVjdGlv\nbgogICAgICAgICAgICBpZiAoc2VsZWN0Q291bnQgPT0gMSAmJiBzZWxlY3RD\naGlsZCAhPSBudWxsICYmCiAgICAgICAgICAgICAgICBzZWxlY3RDaGlsZC5n\nZXRDaGlsZENvdW50KCkgPT0gMSAmJgogICAgICAgICAgICAgICAgb25seUNo\naWxkKHNlbGVjdENoaWxkKSAhPSBudWxsICYmCiAgICAgICAgICAgICAgICBh\nc3NlcnRTY2hlbWFBbGlhcygpLgogICAgICAgICAgICAgICAgICAgIGVxdWFs\nc0lnbm9yZUNhc2Uob25seUNoaWxkKHNlbGVjdENoaWxkKS50ZXh0KSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAvLyBKUFFMIGRvZXMgbm90IGZpbHRlciBy\nZWxhdGlvbmFsIGpvaW5zIGZvciBwcm9qZWN0aW9ucwogICAgICAgICAgICAg\nICAgZXhwcy5kaXN0aW5jdCAmPSB+ZXhwcy5ESVNUSU5DVF9BVVRPOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGFzc2lnblByb2plY3Rpb25zKGV4cE5vZGUs\nIGV4cHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHBy\naXZhdGUgU3RyaW5nIGFzc2VydFNjaGVtYUFsaWFzKCkgewogICAgICAgIFN0\ncmluZyBhbGlhcyA9IGN0eCgpLnNjaGVtYUFsaWFzOwoKICAgICAgICBpZiAo\nYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRp\nb24oRVhfVVNFUiwgImFsaWFzLXJlcXVpcmVkIiwKICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXXsgY3R4KCkubWV0YSB9LCBudWxsKTsKCiAgICAgICAg\ncmV0dXJuIGFsaWFzOwogICAgfQoKICAgIHByb3RlY3RlZCBFeHByZXNzaW9u\nIGV2YWxGZXRjaEpvaW5zKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAg\nICAgIEV4cHJlc3Npb24gZmlsdGVyID0gbnVsbDsKCiAgICAgICAgLy8gaGFu\nZGxlIEpPSU4gRkVUQ0gKICAgICAgICBTZXQgam9pbnMgPSBudWxsOwogICAg\nICAgIFNldCBpbm5lckpvaW5zID0gbnVsbDsKCiAgICAgICAgSlBRTE5vZGVb\nXSBvdXRlcnMgPSByb290KCkuZmluZENoaWxkcmVuQnlJRChKSlRPVVRFUkZF\nVENISk9JTik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IG91dGVycyAhPSBu\ndWxsICYmIGkgPCBvdXRlcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIChq\nb2lucyA9PSBudWxsID8gam9pbnMgPSBuZXcgVHJlZVNldCgpIDogam9pbnMp\nLgogICAgICAgICAgICAgICAgYWRkKGdldFBhdGgob25seUNoaWxkKG91dGVy\nc1tpXSkpLmxhc3QoKS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAgICBK\nUFFMTm9kZVtdIGlubmVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpK\nVElOTkVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW5u\nZXJzICE9IG51bGwgJiYgaSA8IGlubmVycy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBTdHJpbmcgcGF0aCA9IGdldFBhdGgob25seUNoaWxkKGlubmVy\nc1tpXSkpLmxhc3QoKQogICAgICAgICAgICAgICAgLmdldEZ1bGxOYW1lKGZh\nbHNlKTsKICAgICAgICAgICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9IG5l\ndyBUcmVlU2V0KCkgOiBqb2lucykuYWRkKHBhdGgpOwogICAgICAgICAgICAo\naW5uZXJKb2lucyA9PSBudWxsID8gaW5uZXJKb2lucyA9IG5ldyBUcmVlU2V0\nKCkgOiBpbm5lckpvaW5zKS4KICAgICAgICAgICAgICAgIGFkZChwYXRoKTsK\nICAgICAgICB9CgogICAgICAgIGlmIChqb2lucyAhPSBudWxsKQogICAgICAg\nICAgICBleHBzLmZldGNoUGF0aHMgPSAoU3RyaW5nW10pIGpvaW5zLgogICAg\nICAgICAgICAgICAgdG9BcnJheShuZXcgU3RyaW5nW2pvaW5zLnNpemUoKV0p\nOwogICAgICAgIGlmIChpbm5lckpvaW5zICE9IG51bGwpCiAgICAgICAgICAg\nIGV4cHMuZmV0Y2hJbm5lclBhdGhzID0gKFN0cmluZ1tdKSBpbm5lckpvaW5z\nLgogICAgICAgICAgICAgICAgdG9BcnJheShuZXcgU3RyaW5nW2lubmVySm9p\nbnMuc2l6ZSgpXSk7CgogICAgICAgIHJldHVybiBmaWx0ZXI7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIHZvaWQgZXZhbFNldENsYXVzZShRdWVyeUV4cHJlc3Np\nb25zIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgU0VUIGZpZWxkID0gdmFs\ndWUKICAgICAgICBKUFFMTm9kZVtdIG5vZGVzID0gcm9vdCgpLmZpbmRDaGls\nZHJlbkJ5SUQoSkpUVVBEQVRFSVRFTSk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IG5vZGVzICE9IG51bGwgJiYgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQgPSBnZXRQYXRoKGZp\ncnN0Q2hpbGQobm9kZXNbaV0pKS5sYXN0KCk7CiAgICAgICAgICAgIFZhbHVl\nIHZhbCA9IGdldFZhbHVlKG9ubHlDaGlsZChsYXN0Q2hpbGQobm9kZXNbaV0p\nKSk7CiAgICAgICAgICAgIGV4cHMucHV0VXBkYXRlKGZpZWxkLCB2YWwpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbFdo\nZXJlQ2xhdXNlKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8v\nIGV2YWx1YXRlIHRoZSBXSEVSRSBjbGF1c2UKICAgICAgICBKUFFMTm9kZSB3\naGVyZU5vZGUgPSByb290KCkuZmluZENoaWxkQnlJRChKSlRXSEVSRSwgZmFs\nc2UpOwogICAgICAgIGlmICh3aGVyZU5vZGUgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIChFeHByZXNzaW9uKSBl\ndmFsKHdoZXJlTm9kZSk7CiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9u\nIGV2YWxGcm9tQ2xhdXNlKGJvb2xlYW4gbmVlZHNBbGlhcykgewogICAgICAg\nIEV4cHJlc3Npb24gZXhwID0gbnVsbDsKCiAgICAgICAgLy8gYnVpbGQgdXAg\ndGhlIGFsaWFzIG1hcCBpbiB0aGUgRlJPTSBjbGF1c2UKICAgICAgICBKUFFM\nTm9kZSBmcm9tID0gcm9vdCgpLmZpbmRDaGlsZEJ5SUQoSkpURlJPTSwgZmFs\nc2UpOwogICAgICAgIGlmIChmcm9tID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJuby1mcm9tLWNsYXVzZSIs\nIG51bGwsIG51bGwpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZy\nb20uY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgSlBRTE5v\nZGUgbm9kZSA9IGZyb20uY2hpbGRyZW5baV07CgogICAgICAgICAgICBpZiAo\nbm9kZS5pZCA9PSBKSlRGUk9NSVRFTSkKICAgICAgICAgICAgICAgIGV4cCA9\nIGV2YWxGcm9tSXRlbShleHAsIG5vZGUsIG5lZWRzQWxpYXMpOwogICAgICAg\nICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVE9VVEVSSk9JTikKICAgICAg\nICAgICAgICAgIGV4cCA9IGFkZEpvaW4obm9kZSwgZmFsc2UsIGV4cCk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpUSU5ORVJKT0lOKQog\nICAgICAgICAgICAgICAgZXhwID0gYWRkSm9pbihub2RlLCB0cnVlLCBleHAp\nOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVElOTkVSRkVU\nQ0hKT0lOKQogICAgICAgICAgICAgICAgOyAvLyB3ZSBoYW5kbGUgaW5uZXIg\nZmV0Y2ggam9pbnMgaW4gdGhlIGV2YWxGZXRjaEpvaW5zKCkgbWV0aG9kCiAg\nICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpUT1VURVJGRVRDSEpP\nSU4pCiAgICAgICAgICAgICAgICA7IC8vIHdlIGhhbmRsZSBvdXRlciBmZXRj\naCBqb2lucyBpbiB0aGUgZXZhbEZldGNoSm9pbnMoKSBtZXRob2QKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRp\nb24oRVhfVVNFUiwgIm5vdC1zY2hlbWEtbmFtZSIsCiAgICAgICAgICAgICAg\nICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwpOwogICAgICAgIH0K\nCiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYSBqb2luIGNvbmRpdGlvbiB0byB0aGUgZ2l2ZW4gZXhwcmVzc2lvbi4K\nICAgICAqCiAgICAgKiBAcGFyYW0gbm9kZSB0aGUgbm9kZSB0byBjaGVjawog\nICAgICogQHBhcmFtIGlubmVyIHdoZXRoZXIgb3Igbm90IHRoZSBqb2luIHNo\nb3VsZCBiZSBhbiBpbm5lciBqb2luCiAgICAgKiBAcGFyYW0gZXhwIGFuIGV4\naXN0aW5nIGV4cHJlc3Npb24gdG8gQU5ELCBvciBudWxsIGlmIG5vbmUKICAg\nICAqIEByZXR1cm4gdGhlIEV4cHJlc3Npb24gd2l0aCB0aGUgam9pbiBjb25k\naXRpb24gYWRkZWQKICAgICAqLwogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGFk\nZEpvaW4oSlBRTE5vZGUgbm9kZSwgYm9vbGVhbiBpbm5lciwgRXhwcmVzc2lv\nbiBleHApIHsKICAgICAgICAvLyB0aGUgdHlwZSB3aWxsIGJlIHRoZSBkZWNs\nYXJlZCB0eXBlIGZvciB0aGUgZmllbGQKICAgICAgICBQYXRoIHBhdGggPSBn\nZXRQYXRoKGZpcnN0Q2hpbGQobm9kZSksIGZhbHNlLCBpbm5lcik7CgogICAg\nICAgIEpQUUxOb2RlIGFsaWFzID0gbm9kZS5nZXRDaGlsZENvdW50KCkgPj0g\nMiA/IHJpZ2h0KG5vZGUpIDogbnVsbDsKICAgICAgICAvLyBPUEVOSlBBLTE1\nIHN1cHBvcnQgc3VicXVlcnkncyBmcm9tIGNsYXVzZSBkbyBub3Qgc3RhcnQg\nd2l0aCAKICAgICAgICAvLyBpZGVudGlmaWNhdGlvbl92YXJpYWJsZV9kZWNs\nYXJhdGlvbigpCiAgICAgICAgaWYgKGlubmVyICYmIGN0eCgpLnN1YnF1ZXJ5\nICE9IG51bGwgJiYgY3R4KCkuc2NoZW1hQWxpYXMgPT0gbnVsbCkgewogICAg\nICAgICAgICBzZXRDYW5kaWRhdGUoZ2V0RmllbGRUeXBlKHBhdGgubGFzdCgp\nKSwgYWxpYXMudGV4dCk7CgogICAgICAgICAgICBQYXRoIHN1YnBhdGggPSBm\nYWN0b3J5Lm5ld1BhdGgoY3R4KCkuc3VicXVlcnkpOwogICAgICAgICAgICBz\ndWJwYXRoLnNldE1ldGFEYXRhKGN0eCgpLnN1YnF1ZXJ5LmdldE1ldGFEYXRh\nKCkpOwogICAgICAgICAgICBleHAgPSAgYW5kKGV4cCwgZmFjdG9yeS5lcXVh\nbChwYXRoLCBzdWJwYXRoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4g\nYWRkSm9pbihwYXRoLCBhbGlhcywgaW5uZXIsIGV4cCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBFeHByZXNzaW9uIGFkZEpvaW4oUGF0aCBwYXRoLCBKUFFMTm9k\nZSBhbGlhc05vZGUsIGJvb2xlYW4gaW5uZXIsCiAgICAgICAgRXhwcmVzc2lv\nbiBleHApIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHBhdGgubGFz\ndCgpOwoKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJwYXRoLW5vLW1ldGEiLAog\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBwYXRoLCBudWxsIH0sIG51\nbGwpOwoKICAgICAgICBTdHJpbmcgYWxpYXMgPSBhbGlhc05vZGUgIT0gbnVs\nbCA/IGFsaWFzTm9kZS50ZXh0IDogbmV4dEFsaWFzKCk7CgogICAgICAgIFZh\nbHVlIHZhciA9IGdldFZhcmlhYmxlKGFsaWFzLCB0cnVlKTsKICAgICAgICB2\nYXIuc2V0TWV0YURhdGEoZ2V0RmllbGRUeXBlKGZtZCkpOwoKICAgICAgICBF\neHByZXNzaW9uIGpvaW4gPSBudWxsOwoKICAgICAgICAvLyBpZiB0aGUgdmFy\naWFibGUgaXMgYWxyZWFkeSBib3VuZCwgZ2V0IHRoZSB2YXIncyB2YWx1ZSBh\nbmQKICAgICAgICAvLyBkbyBhIHJlZ3VsYXIgY29udGFpbnMgd2l0aCB0aGF0\nCiAgICAgICAgYm9vbGVhbiBib3VuZCA9IGlzQm91bmQodmFyKTsKICAgICAg\nICBpZiAoYm91bmQpIHsKICAgICAgICAgICAgdmFyID0gZ2V0VmFsdWUoYWxp\nYXNOb2RlLCBWQVJfUEFUSCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgYmluZCh2YXIpOwogICAgICAgICAgICBqb2luID0gYW5kKGpvaW4sIGZh\nY3RvcnkuYmluZFZhcmlhYmxlKHZhciwgcGF0aCkpOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKCFmbWQuaXNUeXBlUEMoKSkgLy8gbXVsdGktdmFsdWVkIHJl\nbGF0aW9uCiAgICAgICAgewogICAgICAgICAgICBpZiAoYm91bmQpCiAgICAg\nICAgICAgICAgICBqb2luID0gYW5kKGpvaW4sIGZhY3RvcnkuY29udGFpbnMo\ncGF0aCwgdmFyKSk7CgogICAgICAgICAgICBzZXRJbXBsaWNpdENvbnRhaW5z\nVHlwZXMocGF0aCwgdmFyLCBDT05UQUlOU19UWVBFX0VMRU1FTlQpOwogICAg\nICAgIH0KCiAgICAgICAgcmV0dXJuIGFuZChleHAsIGpvaW4pOwogICAgfQoK\nICAgIHByaXZhdGUgRXhwcmVzc2lvbiBldmFsRnJvbUl0ZW0oRXhwcmVzc2lv\nbiBleHAsIEpQUUxOb2RlIG5vZGUsCiAgICAgICAgYm9vbGVhbiBuZWVkc0Fs\naWFzKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSByZXNvbHZlQ2xh\nc3NNZXRhRGF0YShmaXJzdENoaWxkKG5vZGUpKTsKCiAgICAgICAgU3RyaW5n\nIGFsaWFzID0gbnVsbDsKCiAgICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3Vu\ndCgpIDwgMikgewogICAgICAgICAgICBpZiAobmVlZHNBbGlhcykKICAgICAg\nICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJhbGlh\ncy1yZXF1aXJlZCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\neyBjbWQgfSwgbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nYWxpYXMgPSByaWdodChub2RlKS50ZXh0OwogICAgICAgICAgICBKUFFMTm9k\nZSBsZWZ0ID0gbGVmdChub2RlKTsKCiAgICAgICAgICAgIC8vIGNoZWNrIHRv\nIHNlZSBpZiB0aGUgd2UgYXJlIHJlZmVycmluZyB0byBhIHBhdGggaW4gdGhl\nIGZyb20KICAgICAgICAgICAgLy8gY2xhdXNlLCBzaW5jZSB3ZSBtaWdodCBi\nZSBpbiBhIHN1YnF1ZXJ5IGFnYWluc3QgYSBjb2xsZWN0aW9uCiAgICAgICAg\nICAgIGlmIChpc1BhdGgobGVmdCkpIHsKICAgICAgICAgICAgICAgIFBhdGgg\ncGF0aCA9IGdldFBhdGgobGVmdCk7CiAgICAgICAgICAgICAgICBzZXRDYW5k\naWRhdGUoZ2V0RmllbGRUeXBlKHBhdGgubGFzdCgpKSwgYWxpYXMpOwoKICAg\nICAgICAgICAgICAgIFBhdGggc3VicGF0aCA9IGZhY3RvcnkubmV3UGF0aChj\ndHgoKS5zdWJxdWVyeSk7CiAgICAgICAgICAgICAgICBzdWJwYXRoLnNldE1l\ndGFEYXRhKGN0eCgpLnN1YnF1ZXJ5LmdldE1ldGFEYXRhKCkpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGFuZChleHAsIGZhY3RvcnkuZXF1YWwocGF0aCwg\nc3VicGF0aCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgLy8gd2UgaGF2ZSBhbiBhbGlhczogYmluZCBpdCBhcyBhIHZhcmlhYmxl\nCiAgICAgICAgICAgICAgICBWYWx1ZSB2YXIgPSBnZXRWYXJpYWJsZShhbGlh\ncywgdHJ1ZSk7CiAgICAgICAgICAgICAgICB2YXIuc2V0TWV0YURhdGEoY21k\nKTsKICAgICAgICAgICAgICAgIGJpbmQodmFyKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gIyMjIHdlIGFzc2lnbiB0aGUgZmlyc3Qg\nRlJPTUlURU0gaW5zdGFuY2Ugd2Ugc2VlIGFzCiAgICAgICAgLy8gdGhlIGds\nb2JhbCBjYW5kaWRhdGUsIHdoaWNoIGlzIGluY29ycmVjdDogd2Ugc2hvdWxk\nCiAgICAgICAgLy8gaW5zdGVhZCBiZSBtYXBwaW5nIHRoaXMgdG8gdGhlIFNF\nTEVDVElURU0gdG8gc2VlCiAgICAgICAgLy8gd2hpY2ggaXMgdGhlIGRlc2ly\nZWQgY2FuZGlkYXRlCiAgICAgICAgaWYgKGN0eCgpLnNjaGVtYUFsaWFzID09\nIG51bGwpCiAgICAgICAgICAgIHNldENhbmRpZGF0ZShjbWQsIGFsaWFzKTsK\nCiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBpc0RlY2xhcmVkVmFyaWFibGUoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICAvLyBKUFFMIGRvZXNuJ3Qgc3VwcG9ydCBkZWNsYXJpbmcgdmFyaWFibGVz\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nQ2hlY2sgdG8gc2VlIGlmIHRoZSBzcGVjaWZpYyBub2RlIGlzIGEgcGF0aCAo\ndnMuIGEgc2NoZW1hIG5hbWUpCiAgICAgKi8KICAgIGJvb2xlYW4gaXNQYXRo\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENv\ndW50KCkgPCAyKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nIGZpbmFsIFN0cmluZyBuYW1lID0gZmlyc3RDaGlsZChub2RlKS50ZXh0Owog\nICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBj\nbGFzcyBuYW1lIGlzIHRoZSBhbGlhcwogICAgICAgIC8vIGZvciB0aGUgY2Fu\nZGlkYXRlICh3ZSBkb24ndCB1c2UgdmFyaWFibGVzIGZvciB0aGlzKQogICAg\nICAgIGlmIChnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBpZiAoIWlzU2VlblZh\ncmlhYmxlKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIGZpbmFsIFZhbHVlIHZhciA9IGdldFZhcmlhYmxlKG5hbWUsIGZhbHNl\nKTsKCiAgICAgICAgaWYgKHZhciAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gaXNCb3VuZCh2YXIpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCgogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3NNZXRhRGF0YSBnZXRGaWVsZFR5\ncGUoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoZm1kID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDbGFzc01l\ndGFEYXRhIGNtZCA9IG51bGw7CiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQ7\nCgogICAgICAgIGlmICgodm1kID0gZm1kLmdldEVsZW1lbnQoKSkgIT0gbnVs\nbCkKICAgICAgICAgICAgY21kID0gdm1kLmdldERlY2xhcmVkVHlwZU1ldGFE\nYXRhKCk7CiAgICAgICAgZWxzZSBpZiAoKHZtZCA9IGZtZC5nZXRLZXkoKSkg\nIT0gbnVsbCkKICAgICAgICAgICAgY21kID0gdm1kLmdldERlY2xhcmVkVHlw\nZU1ldGFEYXRhKCk7CiAgICAgICAgZWxzZSBpZiAoKHZtZCA9IGZtZC5nZXRW\nYWx1ZSgpKSAhPSBudWxsKQogICAgICAgICAgICBjbWQgPSB2bWQuZ2V0RGVj\nbGFyZWRUeXBlTWV0YURhdGEoKTsKCiAgICAgICAgaWYgKGNtZCA9PSBudWxs\nIHx8IGNtZC5nZXREZXNjcmliZWRUeXBlKCkgPT0gT2JqZWN0LmNsYXNzKQog\nICAgICAgICAgICBjbWQgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEo\nKTsKCiAgICAgICAgcmV0dXJuIGNtZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIElkZW50aWZpY2F0aW9uIHZhcmlhYmxlcyBpbiBKUFFMIGFyZSBjYXNlIGlu\nc2Vuc2l0aXZlLCBzbyBsb3dlci1jYXNlCiAgICAgKiBhbGwgdmFyaWFibGVz\nIHdlIGFyZSBnb2luZyB0byBiaW5kLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nVmFsdWUgZ2V0VmFyaWFibGUoU3RyaW5nIGlkLCBib29sZWFuIGJpbmQpIHsK\nICAgICAgICBpZiAoaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIHJldHVybiBzdXBlci5nZXRWYXJpYWJsZShpZC50b0xv\nd2VyQ2FzZSgpLCBiaW5kKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBpc1NlZW5kVmFyaWFibGUoU3RyaW5nIGlkKSB7CiAgICAgICAgcmV0dXJu\nIGlkICE9IG51bGwgJiYgc3VwZXIuaXNTZWVuVmFyaWFibGUoaWQudG9Mb3dl\nckNhc2UoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBj\nbGFzcyBuYW1lIHVzaW5nIHRoZSBjaGlsZHJlbiBvZiB0aGUgSlBRTE5vZGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGFzc2VydFNjaGVtYU5hbWUo\nSlBRTE5vZGUgbm9kZSkgewogICAgICAgIGlmIChub2RlLmlkICE9IEpKVEFC\nU1RSQUNUU0NIRU1BTkFNRSkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgIm5vdC1pZGVudGlmZXIiLAogICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwpOwoKICAgICAgICByZXR1\ncm4gYXNzZW1ibGUobm9kZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1\ncnNpdmUgaGVscGVyIG1ldGhvZCB0byBldmFsdWF0ZSB0aGUgZ2l2ZW4gbm9k\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZXZhbChKUFFMTm9kZSBu\nb2RlKSB7CiAgICAgICAgVmFsdWUgdmFsMSA9IG51bGw7CiAgICAgICAgVmFs\ndWUgdmFsMiA9IG51bGw7CiAgICAgICAgVmFsdWUgdmFsMyA9IG51bGw7Cgog\nICAgICAgIGJvb2xlYW4gbm90ID0gbm9kZS5ub3Q7CgogICAgICAgIHN3aXRj\naCAobm9kZS5pZCkgewogICAgICAgICAgICBjYXNlIEpKVFdIRVJFOiAvLyB0\nb3AtbGV2ZWwgV0hFUkUgY2xhdXNlCiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0RXhwcmVzc2lvbihvbmx5Q2hpbGQobm9kZSkpOwoKICAgICAgICAgICAg\nY2FzZSBKSlRCT09MRUFOTElURVJBTDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5Lm5ld0xpdGVyYWwoInRydWUiLmVxdWFsc0lnbm9yZUNhc2UK\nICAgICAgICAgICAgICAgICAgICAobm9kZS50ZXh0KSA/IEJvb2xlYW4uVFJV\nRSA6IEJvb2xlYW4uRkFMU0UsCiAgICAgICAgICAgICAgICAgICAgTGl0ZXJh\nbC5UWVBFX0JPT0xFQU4pOwoKICAgICAgICAgICAgY2FzZSBKSlRJTlRFR0VS\nTElURVJBTDoKICAgICAgICAgICAgICAgIC8vIHVzZSBCaWdEZWNpbWFsIGJl\nY2F1c2UgaXQgY2FuIGhhbmRsZSBwYXJzaW5nIGV4cG9uZW50cwogICAgICAg\nICAgICAgICAgQmlnRGVjaW1hbCBpbnRsaXQgPSBuZXcgQmlnRGVjaW1hbAog\nICAgICAgICAgICAgICAgICAgIChub2RlLnRleHQuZW5kc1dpdGgoImwiKSB8\nfCBub2RlLnRleHQuZW5kc1dpdGgoIkwiKQogICAgICAgICAgICAgICAgICAg\nICAgICA/IG5vZGUudGV4dC5zdWJzdHJpbmcoMCwgbm9kZS50ZXh0Lmxlbmd0\naCgpIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBub2RlLnRleHQp\nLgogICAgICAgICAgICAgICAgICAgIG11bHRpcGx5KG5ldyBCaWdEZWNpbWFs\nKG5lZ2F0aXZlKG5vZGUpKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5uZXdMaXRlcmFsKG5ldyBMb25nKGludGxpdC5sb25nVmFsdWUoKSks\nCiAgICAgICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBFX05VTUJFUik7Cgog\nICAgICAgICAgICBjYXNlIEpKVERFQ0lNQUxMSVRFUkFMOgogICAgICAgICAg\nICAgICAgQmlnRGVjaW1hbCBkZWNsaXQgPSBuZXcgQmlnRGVjaW1hbAogICAg\nICAgICAgICAgICAgICAgIChub2RlLnRleHQuZW5kc1dpdGgoImQiKSB8fCBu\nb2RlLnRleHQuZW5kc1dpdGgoIkQiKSB8fAogICAgICAgICAgICAgICAgICAg\nICAgICBub2RlLnRleHQuZW5kc1dpdGgoImYiKSB8fCBub2RlLnRleHQuZW5k\nc1dpdGgoIkYiKQogICAgICAgICAgICAgICAgICAgICAgICA/IG5vZGUudGV4\ndC5zdWJzdHJpbmcoMCwgbm9kZS50ZXh0Lmxlbmd0aCgpIC0gMSkKICAgICAg\nICAgICAgICAgICAgICAgICAgOiBub2RlLnRleHQpLgogICAgICAgICAgICAg\nICAgICAgIG11bHRpcGx5KG5ldyBCaWdEZWNpbWFsKG5lZ2F0aXZlKG5vZGUp\nKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFs\nKGRlY2xpdCwgTGl0ZXJhbC5UWVBFX05VTUJFUik7CgogICAgICAgICAgICBj\nYXNlIEpKVFNUUklOR0xJVEVSQUw6CiAgICAgICAgICAgIGNhc2UgSkpUVFJJ\nTUNIQVJBQ1RFUjoKICAgICAgICAgICAgY2FzZSBKSlRFU0NBUEVDSEFSQUNU\nRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFs\nKHRyaW1RdW90ZXMobm9kZS50ZXh0KSwKICAgICAgICAgICAgICAgICAgICBM\naXRlcmFsLlRZUEVfU1FfU1RSSU5HKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nUEFUVEVSTlZBTFVFOgogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwoZmly\nc3RDaGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVE5BTUVESU5Q\nVVRQQVJBTUVURVI6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGFyYW1l\ndGVyKG5vZGUudGV4dCwgZmFsc2UpOwoKICAgICAgICAgICAgY2FzZSBKSlRQ\nT1NJVElPTkFMSU5QVVRQQVJBTUVURVI6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0UGFyYW1ldGVyKG5vZGUudGV4dCwgdHJ1ZSk7CgogICAgICAgICAg\nICBjYXNlIEpKVE9SOiAvLyB4IE9SIHkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5Lm9yKGdldEV4cHJlc3Npb24obGVmdChub2RlKSksCiAgICAg\nICAgICAgICAgICAgICAgZ2V0RXhwcmVzc2lvbihyaWdodChub2RlKSkpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRBTkQ6IC8vIHggQU5EIHkKICAgICAgICAg\nICAgICAgIHJldHVybiBhbmQoZ2V0RXhwcmVzc2lvbihsZWZ0KG5vZGUpKSwK\nICAgICAgICAgICAgICAgICAgICBnZXRFeHByZXNzaW9uKHJpZ2h0KG5vZGUp\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVEVRVUFMUzogLy8geCA9IHkKICAg\nICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51\nbGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZXF1YWwodmFs\nMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVE5PVEVRVUFMUzogLy8g\neCA8PiB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChu\nb2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQo\nbm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwx\nLCB2YWwyLCBudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLm5vdEVxdWFsKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRM\nRVNTVEhBTjogLy8geCA8IHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRW\nYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRW\nYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNp\ndFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhY3RvcnkubGVzc1RoYW4odmFsMSwgdmFsMik7CgogICAgICAgICAg\nICBjYXNlIEpKVExFU1NPUkVRVUFMOiAvLyB4IDw9IHkKICAgICAgICAgICAg\nICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAg\nICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAg\nICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubGVzc1RoYW5FcXVhbCh2YWwx\nLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUR1JFQVRFUlRIQU46IC8v\nIHggPiB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChu\nb2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQo\nbm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwx\nLCB2YWwyLCBudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLmdyZWF0ZXJUaGFuKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRHUkVBVEVST1JFUVVBTDogLy8geCA+PSB5CiAgICAgICAgICAgICAgICB2\nYWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2\nYWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwg\ndmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEFERDogLy8geCArIHkKICAg\nICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZ\nUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFk\nZCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1VCVFJBQ1Q6\nIC8vIHggLSB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVm\ndChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmln\naHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2\nYWwxLCB2YWwyLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFjdG9yeS5zdWJ0cmFjdCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUTVVMVElQTFk6IC8vIHggKiB5CiAgICAgICAgICAgICAgICB2\nYWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2\nYWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5tdWx0aXBseSh2YWwxLCB2\nYWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpURElWSURFOiAvLyB4IC8geQog\nICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwog\nICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwg\nVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nZGl2aWRlKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRCRVRX\nRUVOOiAvLyB4LmZpZWxkIFtOT1RdIEJFVFdFRU4gNSBBTkQgMTAKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAwLCAzKSk7\nCiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwg\nMSwgMykpOwogICAgICAgICAgICAgICAgdmFsMyA9IGdldFZhbHVlKGNoaWxk\nKG5vZGUsIDIsIDMpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICBzZXRJbXBs\naWNpdFR5cGVzKHZhbDEsIHZhbDMsIG51bGwpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIGV2YWxOb3Qobm90LCBhbmQoZmFjdG9yeS5ncmVhdGVyVGhhbkVx\ndWFsKHZhbDEsIHZhbDIpLAogICAgICAgICAgICAgICAgICAgIGZhY3Rvcnku\nbGVzc1RoYW5FcXVhbCh2YWwxLCB2YWwzKSkpOwoKICAgICAgICAgICAgY2Fz\nZSBKSlRJTjogLy8geC5maWVsZCBbTk9UXSBJTiAoJ2EnLCAnYicsICdjJykK\nCiAgICAgICAgICAgICAgICBFeHByZXNzaW9uIGluRXhwID0gbnVsbDsKICAg\nICAgICAgICAgICAgIEl0ZXJhdG9yIGluSXRlcmF0b3IgPSBub2RlLml0ZXJh\ndG9yKCk7CiAgICAgICAgICAgICAgICAvLyB0aGUgZmlyc3QgY2hpbGQgaXMg\ndGhlIHBhdGgKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZSgoSlBR\nTE5vZGUpIGluSXRlcmF0b3IubmV4dCgpKTsKCiAgICAgICAgICAgICAgICB3\naGlsZSAoaW5JdGVyYXRvci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAg\nICAgICB2YWwyID0gZ2V0VmFsdWUoKEpQUUxOb2RlKSBpbkl0ZXJhdG9yLm5l\neHQoKSk7CgogICAgICAgICAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZSBm\nb3IgPHZhbHVlPiBJTiAoPHN1YnF1ZXJ5Pikgb3IKICAgICAgICAgICAgICAg\nICAgICAvLyA8dmFsdWU+IElOICg8c2luZ2xlIHZhbHVlPikKICAgICAgICAg\nICAgICAgICAgICBpZiAoISh2YWwyIGluc3RhbmNlb2YgTGl0ZXJhbCkgJiYg\nbm9kZS5nZXRDaGlsZENvdW50KCkgPT0gMikKICAgICAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGV2YWxOb3Qobm90LCBmYWN0b3J5LmNvbnRhaW5zKHZh\nbDIsIHZhbDEpKTsgCgogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMg\nY3VycmVudGx5IGEgc2VxdWVuY2Ugb2YgT1IgZXhwcmVzc2lvbnMsIHNpbmNl\nIHdlCiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90IGhhdmUgc3VwcG9y\ndCBmb3IgSU4gZXhwcmVzc2lvbnMKICAgICAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChpbkV4cCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBpbkV4cCA9IGZhY3RvcnkuZXF1YWwodmFsMSwgdmFsMik7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBp\nbkV4cCA9IGZhY3Rvcnkub3IoaW5FeHAsIGZhY3RvcnkuZXF1YWwodmFsMSwg\ndmFsMikpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8v\nIHdlIGFkZGl0aW9uYWxseSBuZWVkIHRvIGFkZCBpbiBhICJOT1QgTlVMTCIg\nY2xhdXNlLCBzaW5jZQogICAgICAgICAgICAgICAgLy8gdGhlIElOIGJlaGF2\naW9yIHRoYXQgaXMgZXhwZWN0ZWQgYnkgdGhlIENUUyBhbHNvIGV4cGVjdHMK\nICAgICAgICAgICAgICAgIC8vIHRvIGZpbHRlciBvdXIgTlVMTHMKICAgICAg\nICAgICAgICAgIHJldHVybiBhbmQoZXZhbE5vdChub3QsIGluRXhwKSwKICAg\nICAgICAgICAgICAgICAgICBmYWN0b3J5Lm5vdEVxdWFsKHZhbDEsIGZhY3Rv\ncnkuZ2V0TnVsbCgpKSk7CgogICAgICAgICAgICBjYXNlIEpKVElTTlVMTDog\nLy8geC5maWVsZCBJUyBbTk9UXSBOVUxMCiAgICAgICAgICAgICAgICBpZiAo\nbm90KQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5vdEVx\ndWFsCiAgICAgICAgICAgICAgICAgICAgICAgIChnZXRWYWx1ZShvbmx5Q2hp\nbGQobm9kZSkpLCBmYWN0b3J5LmdldE51bGwoKSk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZXF1\nYWwKICAgICAgICAgICAgICAgICAgICAgICAgKGdldFZhbHVlKG9ubHlDaGls\nZChub2RlKSksIGZhY3RvcnkuZ2V0TnVsbCgpKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUUEFUSDoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXRoT3JD\nb25zdGFudChub2RlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSURFTlRJRklF\nUjoKICAgICAgICAgICAgY2FzZSBKSlRJREVOVElGSUNBVElPTlZBUklBQkxF\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldElkZW50aWZpZXIobm9kZSk7\nCgogICAgICAgICAgICBjYXNlIEpKVE5PVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWN0b3J5Lm5vdChnZXRFeHByZXNzaW9uKG9ubHlDaGlsZChub2Rl\nKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRMSUtFOiAvLyBmaWVsZCBMSUtF\nICclc29tZXZhbCUnCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nbGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUo\ncmlnaHQobm9kZSkpOwoKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZSh2YWwxLCBUWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICBzZXRJbXBs\naWNpdFR5cGUodmFsMiwgVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAg\nIC8vIGxvb2sgZm9yIGFuIGVzY2FwZSBjaGFyYWN0ZXIgYmVuZWF0aCB0aGUg\nbm9kZQogICAgICAgICAgICAgICAgU3RyaW5nIGVzY2FwZSA9IG51bGw7CiAg\nICAgICAgICAgICAgICBKUFFMTm9kZSBlc2NhcGVOb2RlID0gcmlnaHQobm9k\nZSkuCiAgICAgICAgICAgICAgICAgICAgZmluZENoaWxkQnlJRChKSlRFU0NB\nUEVDSEFSQUNURVIsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGVzY2Fw\nZU5vZGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBlc2NhcGUgPSB0\ncmltUXVvdGVzKG9ubHlDaGlsZChlc2NhcGVOb2RlKS50ZXh0KTsKCiAgICAg\nICAgICAgICAgICBpZiAobm90KQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5Lm5vdE1hdGNoZXModmFsMSwgdmFsMiwgIl8iLCAiJSIsIGVz\nY2FwZSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3RvcnkubWF0Y2hlcyh2YWwxLCB2YWwyLCAiXyIsICIl\nIiwgZXNjYXBlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSVNFTVBUWToKICAg\nICAgICAgICAgICAgIHJldHVybiBldmFsTm90KG5vdCwKICAgICAgICAgICAg\nICAgICAgICBmYWN0b3J5LmlzRW1wdHkoZ2V0VmFsdWUob25seUNoaWxkKG5v\nZGUpKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTSVpFOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3Rvcnkuc2l6ZShnZXRWYWx1ZShvbmx5Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUVVBQRVI6CiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwxLCBUWVBFX1NUUklO\nRyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50b1VwcGVyQ2Fz\nZSh2YWwxKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTE9XRVI6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS50b0xvd2VyQ2FzZShnZXRTdHJpbmdW\nYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nTEVOR1RIOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkuc3RyaW5n\nTGVuZ3RoKGdldFN0cmluZ1ZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRBQlM6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5hYnMoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVFNRUlQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5zcXJ0KGdldE51bWJlclZhbHVlKG9ubHlDaGlsZChu\nb2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRNT0Q6CiAgICAgICAgICAg\nICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAg\nICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAg\nICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJF\nUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5tb2QodmFsMSwg\ndmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVFRSSU06IC8vIFRSSU0oW1t3\naGVyZV0gW2NoYXJdIEZST01dIGZpZWxkKQogICAgICAgICAgICAgICAgdmFs\nMSA9IGdldFZhbHVlKGxhc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAgICAg\nICBzZXRJbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwoKICAgICAg\nICAgICAgICAgIEJvb2xlYW4gdHJpbVdoZXJlID0gbnVsbDsKCiAgICAgICAg\nICAgICAgICBKUFFMTm9kZSBmaXJzdFRyaW1DaGlsZCA9IGZpcnN0Q2hpbGQo\nbm9kZSk7CgogICAgICAgICAgICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3Vu\ndCgpID4gMSkgewogICAgICAgICAgICAgICAgICAgIHRyaW1XaGVyZSA9CiAg\nICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VHJpbUNoaWxkLmlkID09IEpK\nVFRSSU1MRUFESU5HID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJz\ndFRyaW1DaGlsZC5pZCA9PSBKSlRUUklNVFJBSUxJTkcgPyBCb29sZWFuLkZB\nTFNFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFZhbHVlIHRyaW1D\naGFyOwoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGFyZSAzIGNoaWxk\ncmVuLCB0aGVuIHdlIGtub3cgdGhlIHRyaW0KICAgICAgICAgICAgICAgIC8v\nIGNoYXIgaXMgdGhlIHNlY29uZCBub2RlCiAgICAgICAgICAgICAgICBpZiAo\nbm9kZS5nZXRDaGlsZENvdW50KCkgPT0gMykKICAgICAgICAgICAgICAgICAg\nICB0cmltQ2hhciA9IGdldFZhbHVlKHNlY29uZENoaWxkKG5vZGUpKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgdHdvIGNoaWxkcmVu\nLCB0aGVuIHdlIG5lZWQgdG8gY2hlY2sgdG8gc2VlCiAgICAgICAgICAgICAg\nICAgICAgLy8gaWYgdGhlIGZpcnN0IGNoaWxkIGlzIGEgbGVhZGluZy90cmFp\nbGluZy9ib3RoIG5vZGUsCiAgICAgICAgICAgICAgICAgICAgLy8gb3IgdGhl\nIHRyaW0gY2hhcmFjdGVyIG5vZGUKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID09IDIKICAgICAgICAgICAgICAgICAg\nICAmJiBmaXJzdFRyaW1DaGlsZC5pZCAhPSBKSlRUUklNTEVBRElORwogICAg\nICAgICAgICAgICAgICAgICYmIGZpcnN0VHJpbUNoaWxkLmlkICE9IEpKVFRS\nSU1UUkFJTElORwogICAgICAgICAgICAgICAgICAgICYmIGZpcnN0VHJpbUNo\naWxkLmlkICE9IEpKVFRSSU1CT1RIKQogICAgICAgICAgICAgICAgICAgIHRy\naW1DaGFyID0gZ2V0VmFsdWUoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAg\nICAgICAgICAgICAgLy8gb3Rod2Vyd2lzZSwgd2UgZGVmYXVsdCB0byB0cmlt\nbWluZyB0aGUgc3BhY2UgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgdHJpbUNoYXIgPSBmYWN0b3J5Lm5ld0xp\ndGVyYWwoIiAiLCBMaXRlcmFsLlRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS50cmltKHZhbDEsIHRyaW1DaGFyLCB0cmlt\nV2hlcmUpOwoKICAgICAgICAgICAgY2FzZSBKSlRDT05DQVQ6CiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAg\nICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAg\nICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5HKTsK\nICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwyLCBUWVBFX1NU\nUklORyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5jb25jYXQo\ndmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVFNVQlNUUklORzoK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAw\nLCAzKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUoY2hpbGQo\nbm9kZSwgMSwgMykpOwogICAgICAgICAgICAgICAgdmFsMyA9IGdldFZhbHVl\nKGNoaWxkKG5vZGUsIDIsIDMpKTsKICAgICAgICAgICAgICAgIHNldEltcGxp\nY2l0VHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICBz\nZXRJbXBsaWNpdFR5cGUodmFsMiwgSW50ZWdlci5UWVBFKTsKICAgICAgICAg\nICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwzLCBJbnRlZ2VyLlRZUEUpOwoK\nICAgICAgICAgICAgICAgIC8vIHRoZSBzZW1hbnRpY3Mgb2YgdGhlIEpQUUwg\nc3Vic3RyaW5nKCkgZnVuY3Rpb24KICAgICAgICAgICAgICAgIC8vIGFyZSB0\naGF0IGFyZzIgaXMgdGhlIDEtYmFzZWQgc3RhcnQgaW5kZXgsIGFuZCBhcmcz\nIGlzCiAgICAgICAgICAgICAgICAvLyB0aGUgbGVuZ3RoIG9mIHRoZSBzdHJp\nbmcgdG8gYmUgcmV0dXJuOyB0aGlzIGlzIGRpZmZlcmVudAogICAgICAgICAg\nICAgICAgLy8gdGhhbiB0aGUgc2VtYW50aWNzIG9mIHRoZSBFeHByZXNzaW9u\nRmFjdG9yeSdzIHN1YnN0cmluZywKICAgICAgICAgICAgICAgIC8vIHdoaWNo\nIG1hdGNoZXMgdGhlIEphdmEgbGFuZ3VhZ2UgKDAtYmFzZWQgc3RhcnQgaW5k\nZXgsCiAgICAgICAgICAgICAgICAvLyBhcmcyIGlzIHRoZSBlbmQgaW5kZXgp\nOiB3ZSBwZXJmb3JtIHRoZSB0cmFuc2xhdGlvbiBieQogICAgICAgICAgICAg\nICAgLy8gYWRkaW5nIG9uZSB0byB0aGUgZmlyc3QgYXJndW1lbnQsIGFuZCB0\naGVuIGFkZGluZyB0aGUKICAgICAgICAgICAgICAgIC8vIGZpcnN0IGFyZ3Vt\nZW50IHRvIHRoZSBzZWNvbmQgYXJndW1lbnQgdG8gZ2V0IHRoZSBlbmRJbmRl\neAogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vICMjIyB3\nZSBjb3VsZCBnZXQgcmlkIG9mIHNvbWUgbWVzc3kgZXhwcmVzc2lvbnMgYnkg\nY2hlY2tpbmcgZm9yCiAgICAgICAgICAgICAgICAvLyB0aGUgY29tbW9uIGNh\nc2Ugd2hlcmUgdGhlIGFyZ3VtZW50cyBhcmUgc3BlY2lmaWVkIGFzCiAgICAg\nICAgICAgICAgICAvLyBhIGxpdGVyYWwsIGluIHdoaWNoIGNhc2Ugd2UgY291\nbGQganVzdCBkbyB0aGUgY2FsY3VsYXRpb25zCiAgICAgICAgICAgICAgICAv\nLyBpbiBtZW1vcnk7IG90aGVyd2lzZSB3ZSB3aW5kIHVwIHdpdGggdWdseSBs\nb29raW5nIFNRTCBsaWtlOgogICAgICAgICAgICAgICAgLy8gU0VMRUNUIC4u\nLiBGUk9NIC4uLiB0MQogICAgICAgICAgICAgICAgLy8gKFNVQlNUUklORyh0\nMS5BU1RSLCAoPyAtID8pICsgMSwgKD8gKyAoPyAtID8pKSAtICgoPyAtID8p\nKSkgPSA/KQogICAgICAgICAgICAgICAgLy8gW3BhcmFtcz0obG9uZykgMiwg\nKGludCkgMSwgKGxvbmcpIDIsIChsb25nKSAyLCAoaW50KSAxLAogICAgICAg\nICAgICAgICAgLy8gKGxvbmcpIDIsIChpbnQpIDEsIChTdHJpbmcpIG9vCiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdWJzdHJpbmcodmFsMSwg\nZmFjdG9yeS5uZXdBcmd1bWVudExpc3QKICAgICAgICAgICAgICAgICAgICAo\nZmFjdG9yeS5zdWJ0cmFjdCh2YWwyLCBmYWN0b3J5Lm5ld0xpdGVyYWwKICAg\nICAgICAgICAgICAgICAgICAgICAgKE51bWJlcnMudmFsdWVPZigxKSwgTGl0\nZXJhbC5UWVBFX05VTUJFUikpLAogICAgICAgICAgICAgICAgICAgICAgICAo\nZmFjdG9yeS5hZGQodmFsMywKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIChmYWN0b3J5LnN1YnRyYWN0KHZhbDIsIGZhY3RvcnkubmV3TGl0ZXJhbAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChOdW1iZXJzLnZhbHVl\nT2YoMSksIExpdGVyYWwuVFlQRV9OVU1CRVIpKSkpKSkpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRMT0NBVEU6CiAgICAgICAgICAgICAgICAvLyBhcyB3aXRo\nIFNVQlNUUklORyAoYWJvdmUpLCB0aGUgc2VtYW50aWNzIGZvciBMT0NBVEUg\nZGlmZmVyCiAgICAgICAgICAgICAgICAvLyBmcm9tIEV4cHJlc3Npb25GYWN0\nb3J5LmluZGV4T2YgaW4gdGhhdCBMT0NBVEUgdXNlcyBhCiAgICAgICAgICAg\nICAgICAvLyAwLWJhc2VkIGluZGV4LCBhbmQgaW5kZXhPZiB1c2VzIGEgMS1i\nYXNlZCBpbmRleAogICAgICAgICAgICAgICAgVmFsdWUgbG9jYXRlUGF0aCA9\nIGdldFZhbHVlKGZpcnN0Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nVmFsdWUgbG9jYXRlU2VhcmNoID0gZ2V0VmFsdWUoc2Vjb25kQ2hpbGQobm9k\nZSkpOwogICAgICAgICAgICAgICAgVmFsdWUgbG9jYXRlRnJvbUluZGV4ID0g\nbnVsbDsKICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxkQ291bnQo\nKSA+IDIpIC8vIG9wdGlvbmFsIHN0YXJ0IGluZGV4IGFyZwogICAgICAgICAg\nICAgICAgICAgIGxvY2F0ZUZyb21JbmRleCA9IGdldFZhbHVlKHRoaXJkQ2hp\nbGQobm9kZSkpOwoKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZShs\nb2NhdGVQYXRoLCBUWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUobG9jYXRlU2VhcmNoLCBUWVBFX1NUUklORyk7CgogICAg\nICAgICAgICAgICAgaWYgKGxvY2F0ZUZyb21JbmRleCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZShsb2NhdGVGcm9tSW5k\nZXgsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5hZGQoZmFjdG9yeS5pbmRleE9mKGxvY2F0ZVNlYXJjaCwKICAgICAg\nICAgICAgICAgICAgICBsb2NhdGVGcm9tSW5kZXggPT0gbnVsbCA/IGxvY2F0\nZVBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgOiBmYWN0b3J5Lm5ld0Fy\nZ3VtZW50TGlzdChsb2NhdGVQYXRoLAogICAgICAgICAgICAgICAgICAgICAg\nICBmYWN0b3J5LnN1YnRyYWN0KGxvY2F0ZUZyb21JbmRleCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGZhY3RvcnkubmV3TGl0ZXJhbChOdW1iZXJz\nLnZhbHVlT2YoMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nTGl0ZXJhbC5UWVBFX05VTUJFUikpKSksCiAgICAgICAgICAgICAgICAgICAg\nZmFjdG9yeS5uZXdMaXRlcmFsKE51bWJlcnMudmFsdWVPZigxKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBFX05VTUJFUikpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRBR0dSRUdBVEU6CiAgICAgICAgICAgICAgICAv\nLyBzaW1wbHkgcGFzcy10aHJvdWdoIHdoaWxlIGFzc2VydGluZyBhIHNpbmds\nZSBjaGlsZAogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwob25seUNoaWxk\nKG5vZGUpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09VTlQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5jb3VudChnZXRWYWx1ZShsYXN0Q2hp\nbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTUFYOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3RvcnkubWF4KGdldE51bWJlclZhbHVlKG9u\nbHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRNSU46CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5taW4oZ2V0TnVtYmVyVmFs\ndWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFNV\nTToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1bShnZXROdW1i\nZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUQVZFUkFHRToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmF2\nZyhnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpURElTVElOQ1RQQVRIOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhY3RvcnkuZGlzdGluY3QoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUp\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVEVYSVNUUzoKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWN0b3J5LmlzTm90RW1wdHkoKFZhbHVlKSBldmFsKG9u\nbHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBTlk6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hbnkoKFZhbHVlKSBldmFs\nKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBTEw6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hbGwoKFZhbHVlKSBl\ndmFsKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRT\nVUJTRUxFQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3VicXVlcnko\nbm9kZSk7CgogICAgICAgICAgICBjYXNlIEpKVE1FTUJFUk9GOgogICAgICAg\nICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSksIFZBUl9QQVRI\nKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2Rl\nKSwgVkFSX1BBVEgpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRDb250\nYWluc1R5cGVzKHZhbDIsIHZhbDEsIENPTlRBSU5TX1RZUEVfRUxFTUVOVCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsIGZhY3Rvcnku\nY29udGFpbnModmFsMiwgdmFsMSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRD\nVVJSRU5UREFURToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lmdl\ndEN1cnJlbnREYXRlKCk7CgogICAgICAgICAgICBjYXNlIEpKVENVUlJFTlRU\nSU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVu\ndFRpbWUoKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ1VSUkVOVFRJTUVTVEFN\nUDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEN1cnJlbnRU\naW1lc3RhbXAoKTsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9GQVRBTCwgImJhZC10cmVl\nIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUgfSwg\nbnVsbCk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHNl\ndEltcGxpY2l0VHlwZXMoVmFsdWUgdmFsMSwgVmFsdWUgdmFsMiwgQ2xhc3Mg\nZXhwZWN0ZWQpIHsKICAgICAgICBzdXBlci5zZXRJbXBsaWNpdFR5cGVzKHZh\nbDEsIHZhbDIsIGV4cGVjdGVkKTsKCiAgICAgICAgLy8gYXMgd2VsbCBhcyBz\nZXR0aW5nIHRoZSB0eXBlcyBmb3IgY29udmVyc2lvbnMsIHdlIGFsc28gbmVl\nZCB0bwogICAgICAgIC8vIGVuc3VyZSB0aGF0IGFueSBwYXJhbWV0ZXJzIGFy\nZSBkZWNsYXJlZCB3aXRoIHRoZSBjb3JyZWN0IHR5cGUsCiAgICAgICAgLy8g\nc2luY2UgdGhlIEpQQSBzcGVjIGV4cGVjdHMgdGhhdCB0aGVzZSB3aWxsIGJl\nIHZhbGlkYXRlZAogICAgICAgIFBhcmFtZXRlciBwYXJhbSA9IHZhbDEgaW5z\ndGFuY2VvZiBQYXJhbWV0ZXIgPyAoUGFyYW1ldGVyKSB2YWwxCiAgICAgICAg\nICAgIDogdmFsMiBpbnN0YW5jZW9mIFBhcmFtZXRlciA/IChQYXJhbWV0ZXIp\nIHZhbDIgOiBudWxsOwogICAgICAgIFBhdGggcGF0aCA9IHZhbDEgaW5zdGFu\nY2VvZiBQYXRoID8gKFBhdGgpIHZhbDEKICAgICAgICAgICAgOiB2YWwyIGlu\nc3RhbmNlb2YgUGF0aCA/IChQYXRoKSB2YWwyIDogbnVsbDsKCiAgICAgICAg\nLy8gd2Ugb25seSBjaGVjayBmb3IgcGFyYW1ldGVyLXRvLXBhdGggY29tcGFy\naXNvbnMKICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCB8fCBwYXRoID09IG51\nbGwgfHwgcGFyYW1ldGVyVHlwZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHBhdGgubGFzdCgp\nOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBDbGFzcyB0eXBlID0gcGF0aC5pc1hQYXRoKCkgPyBwYXRo\nLmdldFR5cGUoKSA6IGZtZC5nZXRUeXBlKCk7CiAgICAgICAgaWYgKHR5cGUg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJpbmcg\ncGFyYW1OYW1lID0gcGFyYW0uZ2V0UGFyYW1ldGVyTmFtZSgpOwogICAgICAg\nIGlmIChwYXJhbU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAvLyBtYWtlIHN1cmUgd2UgaGF2ZSBhbHJlYWR5IGRlY2xhcmVk\nIHRoZSBwYXJhbWV0ZXIKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMuY29u\ndGFpbnNLZXkocGFyYW1OYW1lKSkKICAgICAgICAgICAgcGFyYW1ldGVyVHlw\nZXMucHV0KHBhcmFtTmFtZSwgdHlwZSk7CiAgICB9CgogICAgcHJpdmF0ZSBW\nYWx1ZSBnZXRTdHJpbmdWYWx1ZShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAg\ncmV0dXJuIGdldFR5cGVWYWx1ZShub2RlLCBUWVBFX1NUUklORyk7CiAgICB9\nCgogICAgcHJpdmF0ZSBWYWx1ZSBnZXROdW1iZXJWYWx1ZShKUFFMTm9kZSBu\nb2RlKSB7CiAgICAgICAgcmV0dXJuIGdldFR5cGVWYWx1ZShub2RlLCBUWVBF\nX05VTUJFUik7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRUeXBlVmFs\ndWUoSlBRTE5vZGUgbm9kZSwgQ2xhc3MgaW1wbGljaXRUeXBlKSB7CiAgICAg\nICAgVmFsdWUgdmFsID0gZ2V0VmFsdWUobm9kZSk7CiAgICAgICAgc2V0SW1w\nbGljaXRUeXBlKHZhbCwgaW1wbGljaXRUeXBlKTsKICAgICAgICByZXR1cm4g\ndmFsOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0U3VicXVlcnkoSlBR\nTE5vZGUgbm9kZSkgewogICAgICAgIGZpbmFsIGJvb2xlYW4gc3ViY2xhc3Nl\ncyA9IHRydWU7CiAgICAgICAgU3RyaW5nIGFsaWFzID0gbmV4dEFsaWFzKCk7\nCgogICAgICAgIC8vIHBhcnNlIHRoZSBzdWJxdWVyeQogICAgICAgIFBhcnNl\nZEpQUUwgcGFyc2VkID0gbmV3IFBhcnNlZEpQUUwobm9kZS5wYXJzZXIuanBx\nbCwgbm9kZSk7CgogICAgICAgIENsYXNzTWV0YURhdGEgY2FuZGlkYXRlID0g\nZ2V0Q2FuZGlkYXRlTWV0YURhdGEobm9kZSk7CiAgICAgICAgU3VicXVlcnkg\nc3VicSA9IGZhY3RvcnkubmV3U3VicXVlcnkoY2FuZGlkYXRlLCBzdWJjbGFz\nc2VzLCBhbGlhcyk7CiAgICAgICAgc3VicS5zZXRNZXRhRGF0YShjYW5kaWRh\ndGUpOwoKICAgICAgICBjb250ZXh0cy5wdXNoKG5ldyBDb250ZXh0KHBhcnNl\nZCwgc3VicSkpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBRdWVyeUV4\ncHJlc3Npb25zIHN1YmV4cCA9IGdldFF1ZXJ5RXhwcmVzc2lvbnMoKTsKICAg\nICAgICAgICAgc3VicS5zZXRRdWVyeUV4cHJlc3Npb25zKHN1YmV4cCk7CiAg\nICAgICAgICAgIHJldHVybiBzdWJxOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIC8vIHJlbW92ZSB0aGUgc3VicXVlcnkgcGFyc2UgY29udGV4\ndAogICAgICAgICAgICBjb250ZXh0cy5wb3AoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIG5hbWVzIGFuZCBvcmRlciBv\nZiBpbXBsaWNpdCBwYXJhbWV0ZXJzLgogICAgICovCiAgICBwcml2YXRlIFBh\ncmFtZXRlciBnZXRQYXJhbWV0ZXIoU3RyaW5nIGlkLCBib29sZWFuIHBvc2l0\naW9uYWwpIHsKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMgPT0gbnVsbCkK\nICAgICAgICAgICAgcGFyYW1ldGVyVHlwZXMgPSBuZXcgTGlua2VkTWFwKDYp\nOwogICAgICAgIGlmICghcGFyYW1ldGVyVHlwZXMuY29udGFpbnNLZXkoaWQp\nKQogICAgICAgICAgICBwYXJhbWV0ZXJUeXBlcy5wdXQoaWQsIFRZUEVfT0JK\nRUNUKTsKCiAgICAgICAgQ2xhc3MgdHlwZSA9IE9iamVjdC5jbGFzczsKICAg\nICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBudWxsOwogICAgICAgIGludCBp\nbmRleDsKCiAgICAgICAgaWYgKHBvc2l0aW9uYWwpIHsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIC8vIGluZGV4ZXMgaW4gSlBRTCBhcmUg\nMS1iYXNlZCwgYXMgb3Bwb3NlZCB0byAwLWJhc2VkIGluCiAgICAgICAgICAg\nICAgICAvLyB0aGUgY29yZSBFeHByZXNzaW9uRmFjdG9yeQogICAgICAgICAg\nICAgICAgaW5kZXggPSBJbnRlZ2VyLnBhcnNlSW50KGlkKSAtIDE7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nYmFkLXBvc2l0aW9uYWwtcGFyYW1ldGVyIiwKICAgICAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IGlkIH0sIGUpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1wb3NpdGlvbmFsLXBhcmFt\nZXRlciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBpZCB9\nLCBudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBvdGhl\ncndpc2UgdGhlIGluZGV4IGlzIGp1c3QgdGhlIGN1cnJlbnQgc2l6ZSBvZiB0\naGUgcGFyYW1zCiAgICAgICAgICAgIGluZGV4ID0gcGFyYW1ldGVyVHlwZXMu\naW5kZXhPZihpZCk7CiAgICAgICAgfQoKICAgICAgICBQYXJhbWV0ZXIgcGFy\nYW0gPSBmYWN0b3J5Lm5ld1BhcmFtZXRlcihpZCwgdHlwZSk7CiAgICAgICAg\ncGFyYW0uc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgcGFyYW0uc2V0SW5k\nZXgoaW5kZXgpOwoKICAgICAgICByZXR1cm4gcGFyYW07CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDaGVja3MgdG8gc2VlIGlmIHdlIHNob3VsZCBldmFsdWF0\nZSBmb3IgYSBOT1QgZXhwcmVzc2lvbi4KICAgICAqLwogICAgcHJpdmF0ZSBF\neHByZXNzaW9uIGV2YWxOb3QoYm9vbGVhbiBub3QsIEV4cHJlc3Npb24gZXhw\nKSB7CiAgICAgICAgcmV0dXJuIG5vdCA/IGZhY3Rvcnkubm90KGV4cCkgOiBl\neHA7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmltIG9mZiBsZWFkaW5nIGFu\nZCB0cmFpbGluZyBzaW5nbGUtcXVvdGVzLCBhbmQgdGhlbgogICAgICogcmVw\nbGFjZSBhbnkgaW50ZXJuYWwgJycgaW5zdGFuY2VzIHdpdGggJyAoc2luY2Ug\ncmVwZWF0aW5nIHRoZQogICAgICogcXVvdGUgaXMgdGhlIEpQUUwgbWVjaGFu\naXNtIG9mIGVzY2FwaW5nIGEgc2luZ2xlIHF1b3RlKS4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdHJpbmcgdHJpbVF1b3RlcyhTdHJpbmcgc3RyKSB7CiAgICAg\nICAgaWYgKHN0ciA9PSBudWxsIHx8IHN0ci5sZW5ndGgoKSA8PSAxKQogICAg\nICAgICAgICByZXR1cm4gc3RyOwoKICAgICAgICBpZiAoc3RyLnN0YXJ0c1dp\ndGgoIiciKSAmJiBzdHIuZW5kc1dpdGgoIiciKSkKICAgICAgICAgICAgc3Ry\nID0gc3RyLnN1YnN0cmluZygxLCBzdHIubGVuZ3RoKCkgLSAxKTsKCiAgICAg\nICAgaW50IGluZGV4ID0gLTE7CgogICAgICAgIHdoaWxlICgoaW5kZXggPSBz\ndHIuaW5kZXhPZigiJyciLCBpbmRleCArIDEpKSAhPSAtMSkKICAgICAgICAg\nICAgc3RyID0gc3RyLnN1YnN0cmluZygwLCBpbmRleCArIDEpICsgc3RyLnN1\nYnN0cmluZyhpbmRleCArIDIpOwoKICAgICAgICByZXR1cm4gc3RyOwogICAg\nfQoKICAgIC8qKgogICAgICogQW4gSW50ZWdlckxpdGVyYWwgYW5kIERlY2lt\nYWxMaXRlcmFsIG5vZGUgd2lsbAogICAgICogaGF2ZSBhIGNoaWxkIG5vZGUg\nb2YgTmVnYXRpdmUgaWYgaXQgaXMgbmVnYXRpdmU6CiAgICAgKiBpZiBzbywg\ndGhpcyBtZXRob2QgcmV0dXJucyAtMSwgZWxzZSBpdCByZXR1cm5zIDEuCiAg\nICAgKi8KICAgIHByaXZhdGUgc2hvcnQgbmVnYXRpdmUoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIGlmIChub2RlLmNoaWxkcmVuICE9IG51bGwgJiYgbm9k\nZS5jaGlsZHJlbi5sZW5ndGggPT0gMQogICAgICAgICAgICAmJiBmaXJzdENo\naWxkKG5vZGUpLmlkID09IEpKVE5FR0FUSVZFKQogICAgICAgICAgICByZXR1\ncm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMTsKICAg\nIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldElkZW50aWZpZXIoSlBRTE5vZGUg\nbm9kZSkgewogICAgICAgIGZpbmFsIFN0cmluZyBuYW1lID0gbm9kZS50ZXh0\nOwogICAgICAgIGZpbmFsIFZhbHVlIHZhbCA9IGdldFZhcmlhYmxlKG5hbWUs\nIGZhbHNlKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRNZXRh\nRGF0YUZvckFsaWFzKG5hbWUpOwoKICAgICAgICBpZiAoY21kICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBj\nbGFzcyBuYW1lIGlzIHRoZSBhbGlhcwogICAgICAgICAgICAvLyBmb3IgdGhl\nIGNhbmRpZGF0ZSAod2UgZG9uJ3QgdXNlIHZhcmlhYmxlcyBmb3IgdGhpcykK\nICAgICAgICAgICAgVmFsdWUgdGhpeiA9IGZhY3RvcnkuZ2V0VGhpcygpOwog\nICAgICAgICAgICB0aGl6LnNldE1ldGFEYXRhKGNtZCk7CiAgICAgICAgICAg\nIHJldHVybiB0aGl6OwogICAgICAgIH0gZWxzZSBpZiAodmFsIGluc3RhbmNl\nb2YgUGF0aCkgewogICAgICAgICAgICByZXR1cm4gKFBhdGgpIHZhbDsKICAg\nICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFZhbHVlKSB7CiAgICAg\nICAgICAgIHJldHVybiAoVmFsdWUpIHZhbDsKICAgICAgICB9CgogICAgICAg\nIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmtub3duLWlkZW50\naWZpZXIiLAogICAgICAgICAgICBuZXcgT2JqZWN0W117IG5hbWUgfSwgbnVs\nbCk7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRQYXRoT3JDb25zdGFu\ndChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgLy8gZmlyc3QgY2hlY2sgdG8g\nc2VlIGlmIHRoZSBwYXRoIGlzIGFuIGVudW0gb3Igc3RhdGljIGZpZWxkLCBh\nbmQKICAgICAgICAvLyBpZiBzbywgbG9hZCBpdAogICAgICAgIFN0cmluZyBj\nbGFzc05hbWUgPSBhc3NlbWJsZShub2RlLCAiLiIsIDEpOwogICAgICAgIENs\nYXNzIGMgPSByZXNvbHZlci5jbGFzc0Zvck5hbWUoY2xhc3NOYW1lLCBudWxs\nKTsKICAgICAgICBpZiAoYyAhPSBudWxsKSB7CiAgICAgICAgICAgIFN0cmlu\nZyBmaWVsZE5hbWUgPSBsYXN0Q2hpbGQobm9kZSkudGV4dDsKCiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBGaWVsZCBmaWVsZCA9IGMuZ2V0\nRmllbGQoZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIE9iamVjdCB2YWx1\nZSA9IGZpZWxkLmdldChudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5Lm5ld0xpdGVyYWwodmFsdWUsIExpdGVyYWwuVFlQRV9VTktOT1dO\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoTm9TdWNoRmllbGRFeGNlcHRpb24g\nbnNmZSkgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24o\nRVhfVVNFUiwgIm5vLWZpZWxkIiwKICAgICAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W117IGNsYXNzTmFtZSwgZmllbGROYW1lIH0sIG5zZmUpOwogICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgInVuYWNjZXNzaWJs\nZS1maWVsZCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBj\nbGFzc05hbWUsIGZpZWxkTmFtZSB9LCBlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRQYXRoKG5vZGUs\nIGZhbHNlLCB0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBQ\nYXRoIGdldFBhdGgoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBn\nZXRQYXRoKG5vZGUsIGZhbHNlLCB0cnVlKTsKICAgIH0KCiAgICBwcml2YXRl\nIFBhdGggZ2V0UGF0aChKUFFMTm9kZSBub2RlLCBib29sZWFuIHBjT25seSwg\nYm9vbGVhbiBpbm5lcikgewogICAgICAgIC8vIHJlc29sdmUgdGhlIGZpcnN0\nIGVsZW1lbnQgYWdhaW5zdCB0aGUgYWxpYXNlcyBtYXAgLi4uCiAgICAgICAg\nLy8gaS5lLiwgdGhlIHBhdGggIlNFTEVDVCB4LmlkIEZST00gU29tZUNsYXNz\nIHggd2hlcmUgeC5pZCA+IDEwIgogICAgICAgIC8vIHdpbGwgbmVlZCB0byBo\nYXZlICJ4IiBpbiB0aGUgYWxpYXMgbWFwIGluIG9yZGVyIHRvIHJlc29sdmUK\nICAgICAgICBQYXRoIHBhdGg7CgogICAgICAgIGZpbmFsIFN0cmluZyBuYW1l\nID0gZmlyc3RDaGlsZChub2RlKS50ZXh0OwogICAgICAgIGZpbmFsIFZhbHVl\nIHZhbCA9IGdldFZhcmlhYmxlKG5hbWUsIGZhbHNlKTsKCiAgICAgICAgLy8g\naGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBjbGFzcyBuYW1lIGlzIHRoZSBh\nbGlhcwogICAgICAgIC8vIGZvciB0aGUgY2FuZGlkYXRlICh3ZSBkb24ndCB1\nc2UgdmFyaWFibGVzIGZvciB0aGlzKQogICAgICAgIGlmIChuYW1lLmVxdWFs\nc0lnbm9yZUNhc2UoY3R4KCkuc2NoZW1hQWxpYXMpKSB7CiAgICAgICAgICAg\nIGlmIChjdHgoKS5zdWJxdWVyeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBwYXRoID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5KTsKICAg\nICAgICAgICAgICAgIHBhdGguc2V0TWV0YURhdGEoY3R4KCkuc3VicXVlcnku\nZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBwYXRoID0gZmFjdG9yeS5uZXdQYXRoKCk7CiAgICAgICAgICAg\nICAgICBwYXRoLnNldE1ldGFEYXRhKGN0eCgpLm1ldGEpOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBlbHNlIGlmIChnZXRNZXRhRGF0YUZvckFsaWFzKG5h\nbWUpICE9IG51bGwpCiAgICAgICAgICAgIHBhdGggPSBuZXdQYXRoKG51bGws\nIGdldE1ldGFEYXRhRm9yQWxpYXMobmFtZSkpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIFBhdGgpCiAgICAgICAgICAgIHBhdGggPSAoUGF0\naCkgdmFsOwogICAgICAgIGVsc2UgaWYgKHZhbC5nZXRNZXRhRGF0YSgpICE9\nIG51bGwpCiAgICAgICAgICAgIHBhdGggPSBuZXdQYXRoKHZhbCwgdmFsLmdl\ndE1ldGFEYXRhKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgInBhdGgtbm8tbWV0YSIsCiAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IGFzc2VtYmxlKG5vZGUpLCBudWxs\nIH0sIG51bGwpOwoKICAgICAgICAvLyB3YWxrIHRocm91Z2ggdGhlIGNoaWxk\ncmVuIGFuZCBhc3NlbWJsZSB0aGUgcGF0aAogICAgICAgIGJvb2xlYW4gYWxs\nb3dOdWxsID0gIWlubmVyOwogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDwg\nbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\ncGF0aC5pc1hQYXRoKCkpIHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGog\nPSBpOyBqIDxub2RlLmNoaWxkcmVuLmxlbmd0aDsgaisrKQogICAgICAgICAg\nICAgICAgICAgIHBhdGggPSAoUGF0aCkgdHJhdmVyc2VYUGF0aChwYXRoLCBu\nb2RlLmNoaWxkcmVuW2pdLnRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHBhdGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGF0aCA9IChQYXRo\nKSB0cmF2ZXJzZVBhdGgocGF0aCwgbm9kZS5jaGlsZHJlbltpXS50ZXh0LCBw\nY09ubHksCiAgICAgICAgICAgICAgICBhbGxvd051bGwpOwoKICAgICAgICAg\nICAgLy8gYWxsIHRyYXZlcnNhbHMgYnV0IHRoZSBmaXJzdCBvbmUgd2lsbCBh\nbHdheXMgYmUgaW5uZXIgam9pbnMKICAgICAgICAgICAgYWxsb3dOdWxsID0g\nZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgQ2xhc3MgZ2V0RGVjbGFyZWRWYXJpYWJsZVR5cGUo\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IGdl\ndE1ldGFEYXRhRm9yQWxpYXMobmFtZSk7CiAgICAgICAgaWYgKGNtZCAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gY21kLmdldERlc2NyaWJlZFR5cGUo\nKTsKCiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBuYW1lLmVxdWFscyhj\ndHgoKS5zY2hlbWFBbGlhcykpCiAgICAgICAgICAgIHJldHVybiBnZXRDYW5k\naWRhdGVUeXBlKCk7CgogICAgICAgIC8vIEpQUUwgaGFzIG5vIGRlY2xhcmVk\nIHZhcmlhYmxlcwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyBhbiBFeHByZXNzaW9uIGZvciB0aGUgZ2l2ZW4g\nbm9kZSBieSBldmFsJ2luZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBFeHBy\nZXNzaW9uIGdldEV4cHJlc3Npb24oSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIE9iamVjdCBleHAgPSBldmFsKG5vZGUpOwoKICAgICAgICAvLyBjaGVjayBm\nb3IgYm9vbGVhbiB2YWx1ZXMgdXNlZCBhcyBleHByZXNzaW9ucwogICAgICAg\nIGlmICghKGV4cCBpbnN0YW5jZW9mIEV4cHJlc3Npb24pKQogICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5hc0V4cHJlc3Npb24oKFZhbHVlKSBleHApOwog\nICAgICAgIHJldHVybiAoRXhwcmVzc2lvbikgZXhwOwogICAgfQoKICAgIHBy\naXZhdGUgVmFsdWUgZ2V0VmFsdWUoSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIHJldHVybiBnZXRWYWx1ZShub2RlLCBWQVJfUEFUSCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBQYXRoIG5ld1BhdGgoVmFsdWUgdmFsLCBDbGFzc01ldGFEYXRh\nIG1ldGEpIHsKICAgICAgICBQYXRoIHBhdGggPSB2YWwgPT0gbnVsbCA/IGZh\nY3RvcnkubmV3UGF0aCgpIDogZmFjdG9yeS5uZXdQYXRoKHZhbCk7CiAgICAg\nICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcGF0aC5zZXRNZXRh\nRGF0YShtZXRhKTsKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgYSBWYWx1ZSBmb3IgdGhlIGdpdmVuIG5vZGUg\nYnkgZXZhbCdpbmcgaXQuCiAgICAgKi8KICAgIHByaXZhdGUgVmFsdWUgZ2V0\nVmFsdWUoSlBRTE5vZGUgbm9kZSwgaW50IGhhbmRsZVZhcikgewogICAgICAg\nIFZhbHVlIHZhbCA9IChWYWx1ZSkgZXZhbChub2RlKTsKCiAgICAgICAgLy8g\nZGV0ZXJtaW5kIGhvdyB0byBldmF1YXRlIGEgdmFyaWFiZQogICAgICAgIGlm\nICghdmFsLmlzVmFyaWFibGUoKSkKICAgICAgICAgICAgcmV0dXJuIHZhbDsK\nICAgICAgICBlbHNlIGlmIChoYW5kbGVWYXIgPT0gVkFSX1BBVEggJiYgISh2\nYWwgaW5zdGFuY2VvZiBQYXRoKSkKICAgICAgICAgICAgcmV0dXJuIG5ld1Bh\ndGgodmFsLCB2YWwuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgZWxzZSBpZiAo\naGFuZGxlVmFyID09IFZBUl9FUlJPUikKICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgInVuZXhwZWN0ZWQtdmFyIiwKICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZS50ZXh0IH0sIG51bGwpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQYXJzZSBD\nb250ZXh0IE1hbmFnZW1lbnQKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwcml2YXRlIENvbnRleHQgY3R4KCkgewogICAgICAgIHJl\ndHVybiAoQ29udGV4dCkgY29udGV4dHMucGVlaygpOwogICAgfQoKICAgIHBy\naXZhdGUgSlBRTE5vZGUgcm9vdCgpIHsKICAgICAgICByZXR1cm4gY3R4KCku\ncGFyc2VkLnJvb3Q7CiAgICB9CgogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRh\nIGdldE1ldGFEYXRhRm9yQWxpYXMoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAg\nZm9yIChpbnQgaSA9IGNvbnRleHRzLnNpemUoKSAtIDE7IGkgPj0gMDsgaS0t\nKSB7CiAgICAgICAgICAgIENvbnRleHQgY29udGV4dCA9IChDb250ZXh0KSBj\nb250ZXh0cy5nZXQoaSk7CiAgICAgICAgICAgIGlmIChhbGlhcy5lcXVhbHNJ\nZ25vcmVDYXNlKGNvbnRleHQuc2NoZW1hQWxpYXMpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGNvbnRleHQubWV0YTsKICAgICAgICB9CgogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQ29udGV4dCB7\nCgogICAgICAgIHByaXZhdGUgZmluYWwgUGFyc2VkSlBRTCBwYXJzZWQ7CiAg\nICAgICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgcHJp\ndmF0ZSBTdHJpbmcgc2NoZW1hQWxpYXM7CiAgICAgICAgcHJpdmF0ZSBTdWJx\ndWVyeSBzdWJxdWVyeTsKCiAgICAgICAgQ29udGV4dChQYXJzZWRKUFFMIHBh\ncnNlZCwgU3VicXVlcnkgc3VicXVlcnkpIHsKICAgICAgICAgICAgdGhpcy5w\nYXJzZWQgPSBwYXJzZWQ7CiAgICAgICAgICAgIHRoaXMuc3VicXVlcnkgPSBz\ndWJxdWVyeTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gTm9kZSB0cmF2ZXJzYWwgdXRpbGl0aWVz\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHJpdmF0\nZSBKUFFMTm9kZSBvbmx5Q2hpbGQoSlBRTE5vZGUgbm9kZSkKICAgICAgICB0\naHJvd3MgVXNlckV4Y2VwdGlvbiB7CiAgICAgICAgSlBRTE5vZGUgY2hpbGQg\nPSBmaXJzdENoaWxkKG5vZGUpOwoKICAgICAgICBpZiAobm9kZS5jaGlsZHJl\nbi5sZW5ndGggPiAxKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAibXVsdGktY2hpbGRyZW4iLAogICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdeyBub2RlLCBBcnJheXMuYXNMaXN0KG5vZGUuY2hpbGRy\nZW4pIH0sIG51bGwpOwoKICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBsZWZ0IG5vZGUgKHRoZSBmaXJz\ndCBvZiB0aGUgY2hpbGRyZW4pLCBhbmQgYXNzZXJ0cwogICAgICogdGhhdCB0\naGVyZSBhcmUgZXhhY3RseSB0d28gY2hpbGRyZW4uCiAgICAgKi8KICAgIHBy\naXZhdGUgSlBRTE5vZGUgbGVmdChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAg\ncmV0dXJuIGNoaWxkKG5vZGUsIDAsIDIpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJucyB0aGUgcmlnaHQgbm9kZSAodGhlIHNlY29uZCBvZiB0aGUg\nY2hpbGRyZW4pLCBhbmQgYXNzZXJ0cwogICAgICogdGhhdCB0aGVyZSBhcmUg\nZXhhY3RseSB0d28gY2hpbGRyZW4uCiAgICAgKi8KICAgIHByaXZhdGUgSlBR\nTE5vZGUgcmlnaHQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBj\naGlsZChub2RlLCAxLCAyKTsKICAgIH0KCiAgICBwcml2YXRlIEpQUUxOb2Rl\nIGNoaWxkKEpQUUxOb2RlIG5vZGUsIGludCBjaGlsZE51bSwgaW50IGFzc2Vy\ndENvdW50KSB7CiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoICE9\nIGFzc2VydENvdW50KQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAid3JvbmctY2hpbGQtY291bnQiLAogICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBuZXcgSW50ZWdlcihhc3NlcnRDb3VudCksIG5v\nZGUsCiAgICAgICAgICAgICAgICAgICAgQXJyYXlzLmFzTGlzdChub2RlLmNo\naWxkcmVuKSB9LCBudWxsKTsKCiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGRy\nZW5bY2hpbGROdW1dOwogICAgfQoKICAgIHByaXZhdGUgSlBRTE5vZGUgZmly\nc3RDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuY2hp\nbGRyZW4gPT0gbnVsbCB8fCBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8t\nY2hpbGRyZW4iLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2Rl\nIH0sIG51bGwpOwogICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVuWzBdOwog\nICAgfQoKICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIHNlY29uZENoaWxk\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJl\nblsxXTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9kZSB0aGly\nZENoaWxkKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZS5j\naGlsZHJlblsyXTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9k\nZSBsYXN0Q2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBs\nYXN0Q2hpbGQobm9kZSwgMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nTnRoIGZyb20gdGhlIGxhc3QgY2hpbGQuIEUuZy4sCiAgICAgKiBsYXN0Q2hp\nbGQoMSkgd2lsbCByZXR1cm4gdGhlIHNlY29uZC10by10aGUtbGFzdCBjaGls\nZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5vZGUgbGFzdENo\naWxkKEpQUUxOb2RlIG5vZGUsIGludCBmcm9tTGFzdCkgewogICAgICAgIHJl\ndHVybiBub2RlLmNoaWxkcmVuW25vZGUuY2hpbGRyZW4ubGVuZ3RoIC0gKDEg\nKyBmcm9tTGFzdCldOwogICAgfQoKICAgIC8qKgogICAgICogQmFzZSBub2Rl\nIHRoYXQgd2lsbCBiZSBnZW5lcmF0ZWQgYnkgdGhlIEpQUUxFeHByZXNzaW9u\nQnVpbGRlcjsgYmFzZQogICAgICogY2xhc3Mgb2YgdGhlIHtAbGluayBTaW1w\nbGVOb2RlfSB0aGF0IGlzIHVzZWQgYnkge0BsaW5rIEpQUUx9LgogICAgICoK\nICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKiBAc2Vl\nIE5vZGUKICAgICAqIEBzZWUgU2ltcGxlTm9kZQogICAgICovCiAgICBwcm90\nZWN0ZWQgYWJzdHJhY3Qgc3RhdGljIGNsYXNzIEpQUUxOb2RlCiAgICAgICAg\naW1wbGVtZW50cyBOb2RlLCBTZXJpYWxpemFibGUgewoKICAgICAgICBmaW5h\nbCBpbnQgaWQ7CiAgICAgICAgZmluYWwgSlBRTCBwYXJzZXI7CiAgICAgICAg\nSlBRTE5vZGUgcGFyZW50OwogICAgICAgIEpQUUxOb2RlW10gY2hpbGRyZW47\nCiAgICAgICAgU3RyaW5nIHRleHQ7CiAgICAgICAgYm9vbGVhbiBub3QgPSBm\nYWxzZTsKCiAgICAgICAgcHVibGljIEpQUUxOb2RlKEpQUUwgcGFyc2VyLCBp\nbnQgaWQpIHsKICAgICAgICAgICAgdGhpcy5pZCA9IGlkOwogICAgICAgICAg\nICB0aGlzLnBhcnNlciA9IHBhcnNlcjsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGpqdE9wZW4oKSB7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBqanRDbG9zZSgpIHsKICAgICAgICB9CgogICAgICAgIEpQUUxO\nb2RlW10gZmluZENoaWxkcmVuQnlJRChpbnQgaWQpIHsKICAgICAgICAgICAg\nQ29sbGVjdGlvbiBzZXQgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBm\naW5kQ2hpbGRyZW5CeUlEKGlkLCBzZXQpOwogICAgICAgICAgICByZXR1cm4g\nKEpQUUxOb2RlW10pIHNldC50b0FycmF5KG5ldyBKUFFMTm9kZVtzZXQuc2l6\nZSgpXSk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgZmluZENo\naWxkcmVuQnlJRChpbnQgaWQsIENvbGxlY3Rpb24gc2V0KSB7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBjaGlsZHJlbiAhPSBudWxsICYmIGkgPCBj\naGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGNo\naWxkcmVuW2ldLmlkID09IGlkKQogICAgICAgICAgICAgICAgICAgIHNldC5h\nZGQoY2hpbGRyZW5baV0pOwoKICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ld\nLmZpbmRDaGlsZHJlbkJ5SUQoaWQsIHNldCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGJvb2xlYW4gaGFzQ2hpbGRJRChpbnQgaWQpIHsK\nICAgICAgICAgICAgcmV0dXJuIGZpbmRDaGlsZEJ5SUQoaWQsIGZhbHNlKSAh\nPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgSlBRTE5vZGUgZmluZENoaWxk\nQnlJRChpbnQgaWQsIGJvb2xlYW4gcmVjdXJzZSkgewogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgY2hpbGRyZW4gIT0gbnVsbCAmJiBpIDwgY2hpbGRy\nZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIEpQUUxOb2RlIGNo\naWxkID0gY2hpbGRyZW5baV07CgogICAgICAgICAgICAgICAgaWYgKGNoaWxk\nLmlkID09IGlkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZHJl\nbltpXTsKCiAgICAgICAgICAgICAgICBpZiAocmVjdXJzZSkgewogICAgICAg\nICAgICAgICAgICAgIEpQUUxOb2RlIGZvdW5kID0gY2hpbGQuZmluZENoaWxk\nQnlJRChpZCwgcmVjdXJzZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZv\ndW5kICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBm\nb3VuZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gbm90IGZvdW5kCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgamp0U2V0UGFyZW50KE5v\nZGUgcGFyZW50KSB7CiAgICAgICAgICAgIHRoaXMucGFyZW50ID0gKEpQUUxO\nb2RlKSBwYXJlbnQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTm9kZSBq\nanRHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVu\ndDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGpqdEFkZENoaWxk\nKE5vZGUgbiwgaW50IGkpIHsKICAgICAgICAgICAgaWYgKGNoaWxkcmVuID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gbmV3IEpQUUxO\nb2RlW2kgKyAxXTsKICAgICAgICAgICAgfSBlbHNlIGlmIChpID49IGNoaWxk\ncmVuLmxlbmd0aCkgewogICAgICAgICAgICAgICAgSlBRTE5vZGUgY1tdID0g\nbmV3IEpQUUxOb2RlW2kgKyAxXTsKICAgICAgICAgICAgICAgIFN5c3RlbS5h\ncnJheWNvcHkoY2hpbGRyZW4sIDAsIGMsIDAsIGNoaWxkcmVuLmxlbmd0aCk7\nCiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGM7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGNoaWxkcmVuW2ldID0gKEpQUUxOb2RlKSBuOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE5vZGUgamp0R2V0Q2hpbGQoaW50IGkp\nIHsKICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuW2ldOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBnZXRDaGlsZENvdW50KCkgewogICAgICAg\nICAgICByZXR1cm4gamp0R2V0TnVtQ2hpbGRyZW4oKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBKUFFMTm9kZSBnZXRDaGlsZChpbnQgaW5kZXgpIHsK\nICAgICAgICAgICAgcmV0dXJuIChKUFFMTm9kZSkgamp0R2V0Q2hpbGQoaW5k\nZXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9yIGl0ZXJh\ndG9yKCkgewogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdChjaGls\nZHJlbikuaXRlcmF0b3IoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgamp0R2V0TnVtQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgIHJldHVybiAo\nY2hpbGRyZW4gPT0gbnVsbCkgPyAwIDogY2hpbGRyZW4ubGVuZ3RoOwogICAg\nICAgIH0KCiAgICAgICAgdm9pZCBzZXRUZXh0KFN0cmluZyB0ZXh0KSB7CiAg\nICAgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CiAgICAgICAgfQoKICAgICAg\nICB2b2lkIHNldFRva2VuKFRva2VuIHQpIHsKICAgICAgICAgICAgc2V0VGV4\ndCh0LmltYWdlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcg\ndG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBKUFFMVHJlZUNvbnN0\nYW50cy5qanROb2RlTmFtZVt0aGlzLmlkXTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoU3RyaW5nIHByZWZpeCkgewogICAg\nICAgICAgICByZXR1cm4gcHJlZml4ICsgdG9TdHJpbmcoKTsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIERlYnVnZ2luZyBtZXRob2QuCiAg\nICAgICAgICoKICAgICAgICAgKiBAc2VlICNkdW1wKGphdmEuaW8uUHJpbnRT\ndHJlYW0sU3RyaW5nKQogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIGR1bXAoU3RyaW5nIHByZWZpeCkgewogICAgICAgICAgICBkdW1wKFN5c3Rl\nbS5vdXQsIHByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBkdW1wKCkgewogICAgICAgICAgICBkdW1wKCIgIik7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBEZWJ1Z2dpbmcgbWV0aG9kIHRvIG91\ndHB1dCBhIHBhcnNlIHRyZWUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFy\nYW0gb3V0IHRoZSBzdHJlYW0gdG8gd2hpY2ggdG8gd3JpdGUgdGhlIGRlYnVn\nZ2luZyBpbmZvCiAgICAgICAgICogQHBhcmFtIHByZWZpeCB0aGUgcHJlZml4\nIHRvIHdyaXRlIG91dCBiZWZvcmUgbGluZXMKICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgdm9pZCBkdW1wKFByaW50U3RyZWFtIG91dCwgU3RyaW5nIHBy\nZWZpeCkgewogICAgICAgICAgICBkdW1wKG91dCwgcHJlZml4LCBmYWxzZSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBkdW1wKFByaW50U3Ry\nZWFtIG91dCwgU3RyaW5nIHByZWZpeCwgYm9vbGVhbiB0ZXh0KSB7CiAgICAg\nICAgICAgIG91dC5wcmludGxuKHRvU3RyaW5nKHByZWZpeCkKICAgICAgICAg\nICAgICAgICsgKHRleHQgJiYgdGhpcy50ZXh0ICE9IG51bGwgPyAiIFsiICsg\ndGhpcy50ZXh0ICsgIl0iIDogIiIpKTsKICAgICAgICAgICAgaWYgKGNoaWxk\ncmVuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAg\nICAgICBKUFFMTm9kZSBuID0gKEpQUUxOb2RlKSBjaGlsZHJlbltpXTsKICAg\nICAgICAgICAgICAgICAgICBpZiAobiAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIG4uZHVtcChvdXQsIHByZWZpeCArICIgIiwgdGV4dCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUHVi\nbGljIGZvciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAgICAgKiBAbm9qYXZh\nZG9jCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgUGFyc2VkSlBR\nTAogICAgICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAg\ncHJvdGVjdGVkIGZpbmFsIEpQUUxOb2RlIHJvb3Q7CiAgICAgICAgcHJvdGVj\ndGVkIGZpbmFsIFN0cmluZyBxdWVyeTsKICAgICAgICAKICAgICAgICAvLyBj\nYWNoZSBvZiBjYW5kaWRhdGUgdHlwZSBkYXRhLiBUaGlzIGlzIHN0b3JlZCBo\nZXJlIGluIGNhc2UgdGhpcyAgCiAgICAgICAgLy8gcGFyc2UgdHJlZSBpcyBy\nZXVzZWQgaW4gYSBjb250ZXh0IHRoYXQgZG9lcyBub3Qga25vdyB3aGF0IHRo\nZSAKICAgICAgICAvLyBjYW5kaWRhdGUgdHlwZSBpcyBhbHJlYWR5LiAKICAg\nICAgICBwcml2YXRlIENsYXNzIF9jYW5kaWRhdGVUeXBlOwoKICAgICAgICBQ\nYXJzZWRKUFFMKFN0cmluZyBqcHFsKSB7CiAgICAgICAgICAgIHRoaXMoanBx\nbCwgcGFyc2UoanBxbCkpOwogICAgICAgIH0KCiAgICAgICAgUGFyc2VkSlBR\nTChTdHJpbmcgcXVlcnksIEpQUUxOb2RlIHJvb3QpIHsKICAgICAgICAgICAg\ndGhpcy5yb290ID0gcm9vdDsKICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1\nZXJ5OwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nSlBRTE5vZGUgcGFyc2UoU3RyaW5nIGpwcWwpIHsKICAgICAgICAgICAgaWYg\nKGpwcWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpwcWwgPSAiIjsKCiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKEpQUUxO\nb2RlKSBuZXcgSlBRTChqcHFsKS5wYXJzZVF1ZXJ5KCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEVycm9yIGUpIHsKICAgICAgICAgICAgICAgIC8vIHNwZWNp\nYWwgaGFuZGxpbmcgZm9yIEVycm9yIHN1YmNsYXNzZXMsIHdoaWNoIHRoZQog\nICAgICAgICAgICAgICAgLy8gcGFyc2VyIG1heSBzb21ldGltZXMgKHVuZm9y\ndHVuYXRlbHkpIHRocm93CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgicGFyc2UtZXJyb3IiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgZS50b1N0cmluZygpLCBqcHFsIH0p\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoUGFyc2VFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoInBhcnNlLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IGUudG9TdHJpbmcoKSwganBxbCB9KSwgZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHZvaWQgcG9wdWxhdGUoRXhwcmVzc2lv\nblN0b3JlUXVlcnkgcXVlcnkpIHsKICAgICAgICAgICAgUXVlcnlDb250ZXh0\nIGN0eCA9IHF1ZXJ5LmdldENvbnRleHQoKTsKCiAgICAgICAgICAgIC8vIGlm\nIHRoZSBvd25pbmcgcXVlcnkncyBjb250ZXh0IGRvZXMgbm90IGhhdmUKICAg\nICAgICAgICAgLy8gYW55IGNhbmRpZGF0ZSBjbGFzcywgdGhlbiBzZXQgaXQg\naGVyZQogICAgICAgICAgICBpZiAoY3R4LmdldENhbmRpZGF0ZVR5cGUoKSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX2NhbmRpZGF0ZVR5cGUg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfY2FuZGlkYXRlVHlwZSA9\nIG5ldyBKUFFMRXhwcmVzc2lvbkJ1aWxkZXIKICAgICAgICAgICAgICAgICAg\nICAgICAgKG51bGwsIHF1ZXJ5LCB0aGlzKS5nZXRDYW5kaWRhdGVUeXBlKCk7\nCiAgICAgICAgICAgICAgICBjdHguc2V0Q2FuZGlkYXRlVHlwZShfY2FuZGlk\nYXRlVHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgLyoqCiAgICAgICAgICogUHVibGljIGZvciB1bml0IHRl\nc3RpbmcgcHVycG9zZXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENs\nYXNzIGdldENhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBf\nY2FuZGlkYXRlVHlwZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVybiB0aGlzLnF1ZXJ5OwoJCX0K\nCX0KfQoK\n","encoding":"base64"}

