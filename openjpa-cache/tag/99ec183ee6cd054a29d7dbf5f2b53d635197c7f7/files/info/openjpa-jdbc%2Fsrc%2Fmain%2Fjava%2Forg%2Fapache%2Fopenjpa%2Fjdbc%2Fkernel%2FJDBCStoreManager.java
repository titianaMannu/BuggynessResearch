{"sha":"e16f899d4ff4e3e3250ff3877483e26bce94a3fe","node_id":"MDQ6QmxvYjIwNjM2NDplMTZmODk5ZDRmZjRlM2UzMjUwZmYzODc3NDgzZTI2YmNlOTRhM2Zl","size":63723,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e16f899d4ff4e3e3250ff3877483e26bce94a3fe","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZh\nLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5z\ncWwuRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5o\nYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1p\nbmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZp\nZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuVmFsdWVNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuU3VwZXJjbGFzc0Rpc2NyaW1pbmF0b3JTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rp\nb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9p\nblN5bnRheGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJl\nc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxF\neGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNRTEZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNlbGVjdEV4ZWN1dG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlVuaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5Ccm9rZXJJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLkZpbmRlckNhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5Mb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nQ29u\nbmVjdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5E\nZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmpkYmMuRGVsZWdhdGluZ1N0YXRlbWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVj\ndFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVyYXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAq\nIFN0b3JlTWFuYWdlciBwbHVnaW4gdGhhdCB1c2VzIEpEQkMgdG8gc3RvcmUg\ncGVyc2lzdGVudCBkYXRhIGluIGEKICogcmVsYXRpb25hbCBkYXRhIHN0b3Jl\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgSkRCQ1N0b3JlTWFuYWdlciAKICAgIGltcGxlbWVudHMg\nU3RvcmVNYW5hZ2VyLCBKREJDU3RvcmUgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoSkRCQ1N0b3JlTWFuYWdlci5jbGFzcyk7CgogICAgcHJpdmF0\nZSBTdG9yZUNvbnRleHQgX2N0eCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkND\nb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgREJEaWN0\naW9uYXJ5IF9kaWN0ID0gbnVsbDsKICAgIHByaXZhdGUgU1FMRmFjdG9yeSBf\nc3FsID0gbnVsbDsKICAgIHByaXZhdGUgSkRCQ0xvY2tNYW5hZ2VyIF9sbSA9\nIG51bGw7CiAgICBwcml2YXRlIERhdGFTb3VyY2UgX2RzID0gbnVsbDsKICAg\nIHByaXZhdGUgUmVmQ291bnRDb25uZWN0aW9uIF9jb25uID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfYWN0aXZlID0gZmFsc2U7CgogICAgLy8gdHJh\nY2sgdGhlIHBlbmRpbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRo\nZW0KICAgIHByaXZhdGUgU2V0PFN0YXRlbWVudD4gX3N0bW50cyA9IENvbGxl\nY3Rpb25zLnN5bmNocm9uaXplZFNldChuZXcgSGFzaFNldDxTdGF0ZW1lbnQ+\nKCkpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENvbnN0cnVjdG9yPENs\naWVudENvbm5lY3Rpb24+IGNsaWVudENvbm5lY3Rpb25JbXBsOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8UmVmQ291bnRDb25uZWN0\naW9uPiByZWZDb3VudENvbm5lY3Rpb25JbXBsOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgQ29uc3RydWN0b3I8Q2FuY2VsU3RhdGVtZW50PiBjYW5jZWxT\ndGF0ZW1lbnRJbXBsOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ29uc3Ry\ndWN0b3I8Q2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQ+IGNhbmNlbFByZXBhcmVk\nU3RhdGVtZW50SW1wbDsKCiAgICBzdGF0aWMgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGNsaWVudENvbm5lY3Rpb25JbXBsID0gQ29uY3JldGVDbGFz\nc0dlbmVyYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENsaWVudENvbm5l\nY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgQ29ubmVjdGlvbi5jbGFz\ncyk7CiAgICAgICAgICAgIHJlZkNvdW50Q29ubmVjdGlvbkltcGwgPSBDb25j\ncmV0ZUNsYXNzR2VuZXJhdG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoUmVm\nQ291bnRDb25uZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0\nb3JlTWFuYWdlci5jbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIGNhbmNlbFN0YXRlbWVudEltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJh\ndG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoQ2FuY2VsU3RhdGVtZW50LmNs\nYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci5jbGFzcywg\nU3RhdGVtZW50LmNsYXNzLCBDb25uZWN0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgY2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBsID0gQ29uY3JldGVDbGFz\nc0dlbmVyYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENhbmNlbFByZXBh\ncmVkU3RhdGVtZW50LmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3Jl\nTWFuYWdlci5jbGFzcywgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIENvbm5l\nY3Rpb24uY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25JbkluaXRpYWxpemVy\nRXJyb3IoZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdG9yZUNv\nbnRleHQgZ2V0Q29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2N0eDsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBj\ndHgpIHsKICAgICAgICBzZXRDb250ZXh0KGN0eCwgKEpEQkNDb25maWd1cmF0\naW9uKSBjdHguZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQgY3R4LCBKREJD\nQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAg\nICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2RpY3QgPSBfY29uZi5nZXRE\nQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAgIF9zcWwgPSBfY29uZi5n\nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKTsKCiAgICAgICAgTG9ja01hbmFnZXIg\nbG0gPSBjdHguZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICBpZiAobG0gaW5z\ndGFuY2VvZiBKREJDTG9ja01hbmFnZXIpCiAgICAgICAgICAgIF9sbSA9IChK\nREJDTG9ja01hbmFnZXIpIGxtOwoKICAgICAgICBpZiAoIWN0eC5pc01hbmFn\nZWQoKSAmJiBfY29uZi5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQo\nKSkKICAgICAgICAgICAgX2RzID0gX2NvbmYuZ2V0RGF0YVNvdXJjZTIoY3R4\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9kcyA9IF9jb25mLmdldERh\ndGFTb3VyY2UoY3R4KTsKCiAgICAgICAgaWYgKF9jb25mLmdldFVwZGF0ZU1h\nbmFnZXJJbnN0YW5jZSgpLm9yZGVyRGlydHkoKSkKICAgICAgICAgICAgY3R4\nLnNldE9yZGVyRGlydHlPYmplY3RzKHRydWUpOwogICAgfQoKICAgIHB1Ymxp\nYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAg\nICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgREJEaWN0aW9u\nYXJ5IGdldERCRGljdGlvbmFyeSgpIHsKICAgICAgICByZXR1cm4gX2RpY3Q7\nCiAgICB9CgogICAgcHVibGljIFNRTEZhY3RvcnkgZ2V0U1FMRmFjdG9yeSgp\nIHsKICAgICAgICByZXR1cm4gX3NxbDsKICAgIH0KCiAgICBwdWJsaWMgSkRC\nQ0xvY2tNYW5hZ2VyIGdldExvY2tNYW5hZ2VyKCkgewogICAgICAgIHJldHVy\nbiBfbG07CiAgICB9CgogICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiAo\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgX2N0eC5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbk9wdGltaXN0\naWMoKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2tPcHRpbWlz\ndGljKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2luKCkgewogICAg\nICAgIF9hY3RpdmUgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICgoIV9jdHguaXNNYW5hZ2VkKCkgfHwgIV9jb25mLmlzQ29ubmVjdGlv\nbkZhY3RvcnlNb2RlTWFuYWdlZCgpKQogICAgICAgICAgICAgICAgJiYgX2Nv\nbm4uZ2V0QXV0b0NvbW1pdCgpKQogICAgICAgICAgICAgICAgX2Nvbm4uc2V0\nQXV0b0NvbW1pdChmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBmYWxzZTsKICAgICAg\nICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3Qp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfY3R4LmlzTWFuYWdl\nZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQo\nKSkKICAgICAgICAgICAgICAgIF9jb25uLmNvbW1pdCgpOwogICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgX2Nvbm4ucm9sbGJhY2soKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlMikgewogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9k\naWN0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfYWN0aXZl\nID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJv\nbGxiYWNrKCkgewogICAgICAgIC8vIGFscmVhZHkgcm9sbGVkIGJhY2sgb3Vy\nc2VsdmVzPwogICAgICAgIGlmICghX2FjdGl2ZSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX2Nvbm4gIT0g\nbnVsbAogICAgICAgICAgICAgICAgJiYgKCFfY3R4LmlzTWFuYWdlZCgpIHx8\nICFfY29uZgogICAgICAgICAgICAgICAgICAgIC5pc0Nvbm5lY3Rpb25GYWN0\nb3J5TW9kZU1hbmFnZWQoKSkpCiAgICAgICAgICAgICAgICBfY29ubi5yb2xs\nYmFjaygpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBf\nZGljdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2FjdGl2\nZSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBy\nZXRhaW5Db25uZWN0aW9uKCkgewogICAgICAgIGNvbm5lY3QoZmFsc2UpOwog\nICAgICAgIF9jb25uLnNldFJldGFpbih0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByZWxlYXNlQ29ubmVjdGlvbigpIHsKICAgICAgICBpZiAoX2Nv\nbm4gIT0gbnVsbCkKICAgICAgICAgICAgX2Nvbm4uc2V0UmV0YWluKGZhbHNl\nKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldENsaWVudENvbm5lY3Rp\nb24oKSB7CiAgICAgICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3Iu\nbmV3SW5zdGFuY2UoY2xpZW50Q29ubmVjdGlvbkltcGwsIGdldENvbm5lY3Rp\nb24oKSk7CiAgICB9CgogICAgcHVibGljIENvbm5lY3Rpb24gZ2V0Q29ubmVj\ndGlvbigpIHsKICAgICAgICBjb25uZWN0KHRydWUpOwogICAgICAgIHJldHVy\nbiBfY29ubjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIERhdGFTb3VyY2Ug\nZ2V0RGF0YVNvdXJjZSgpIHsKICAgIAlyZXR1cm4gX2RzOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGV4aXN0cyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIGFkZCB3aGVyZSBjb25k\naXRpb25zIG9uIGJhc2UgY2xhc3MgdG8gYXZvaWQgam9pbnMgaWYgc3ViY2xh\nc3MKICAgICAgICAvLyBkb2Vzbid0IHVzZSBvaWQgYXMgaWRlbnRpZmllcgog\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykg\nc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICByZXR1cm4gZXhpc3RzKG1hcHBp\nbmcsIHNtLmdldE9iamVjdElkKCksIGNvbnRleHQpOwogICAgfQoKICAgIHBy\naXZhdGUgYm9vbGVhbiBleGlzdHMoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9i\namVjdCBvaWQsIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgLy8gYWRkIHdo\nZXJlIGNvbmRpdGlvbnMgb24gYmFzZSBjbGFzcyB0byBhdm9pZCBqb2lucyBp\nZiBzdWJjbGFzcwogICAgICAgIC8vIGRvZXNuJ3QgdXNlIG9pZCBhcyBpZGVu\ndGlmaWVyCiAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7\nCiAgICAgICAgd2hpbGUgKG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgbWFwcGluZyA9IG1h\ncHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CgogICAg\nICAgIHNlbC53aGVyZVByaW1hcnlLZXkob2lkLCBtYXBwaW5nLCB0aGlzKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gc2VsLmdldENvdW50\nKHRoaXMpICE9IDA7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUo\nc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gc3luY1ZlcnNpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgT2JqZWN0\nIGNvbnRleHQpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChD\nbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmNoZWNr\nVmVyc2lvbihzbSwgdGhpcywgdHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGludCBjb21wYXJlVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHN0YXRlLCBPYmplY3QgdjEsIE9iamVjdCB2MikgewogICAgICAgIENsYXNz\nTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc3RhdGUuZ2V0TWV0\nYURhdGEoKTsKICAgICAgICByZXR1cm4gbWFwcGluZy5nZXRWZXJzaW9uKCku\nY29tcGFyZVZlcnNpb24odjEsIHYyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpbml0aWFsaXplKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3Rh\ndGUgc3RhdGUsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBP\nYmplY3QgY29udGV4dCkgewogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8g\nPSAoQ29ubmVjdGlvbkluZm8pIGNvbnRleHQ7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIGluaXRpYWxpemVTdGF0ZShzbSwgc3RhdGUsIChK\nREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRjaCwgCiAgICAgICAgICAgICAg\nICBpbmZvKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0\naW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2Us\nIF9kaWN0LCBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgYSBuZXdseS1sb2Fk\nZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlu\naXRpYWxpemVTdGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRl\nIHN0YXRlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIENvbm5lY3Rpb25JbmZvIGluZm8pCiAgICAgICAgdGhyb3dzIENsYXNzTm90\nRm91bmRFeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0\nIG9pZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwog\nICAgICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChpbmZvICE9IG51bGwgJiYgaW5mby5yZXN1bHQgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgcmVzID0gaW5mby5yZXN1bHQ7CiAgICAg\nICAgICAgICAgICBpbmZvLnNtID0gc207CiAgICAgICAgICAgICAgICBpZiAo\naW5mby5tYXBwaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaW5m\nby5tYXBwaW5nID0gbWFwcGluZzsKICAgICAgICAgICAgICAgIG1hcHBpbmcg\nPSBpbmZvLm1hcHBpbmc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob2lkIGlu\nc3RhbmNlb2YgT3BlbkpQQUlkCiAgICAgICAgICAgICAgICAmJiAhKChPcGVu\nSlBBSWQpIG9pZCkuaGFzU3ViY2xhc3NlcygpKSB7CiAgICAgICAgICAgICAg\nICBCb29sZWFuIGN1c3RvbSA9IGN1c3RvbUxvYWQoc20sIG1hcHBpbmcsIHN0\nYXRlLCBmZXRjaCk7CiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1c3RvbS5ib29sZWFu\nVmFsdWUoKTsKICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxpemVT\ndGF0ZVJlc3VsdChzbSwgbWFwcGluZywgZmV0Y2gsCiAgICAgICAgICAgICAg\nICAgICAgU2VsZWN0LlNVQlNfRVhBQ1QpOwogICAgICAgICAgICAgICAgaWYg\nKHJlcyA9PSBudWxsICYmICFzZWxlY3RQcmltYXJ5S2V5KHNtLCBtYXBwaW5n\nLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICAgICAgaWYgKGlzRW1wdHlSZXN1bHQocmVzKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9\nIG1hcHBpbmcuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5kZXBlbmRlbnRB\nc3NpZ25hYmxlTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGlmIChtYXBw\naW5ncy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgICAgIG1hcHBp\nbmcgPSBtYXBwaW5nc1swXTsKICAgICAgICAgICAgICAgICAgICBCb29sZWFu\nIGN1c3RvbSA9IGN1c3RvbUxvYWQoc20sIG1hcHBpbmcsIHN0YXRlLCBmZXRj\naCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1c3RvbSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VzdG9tLmJvb2xlYW5W\nYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxp\nemVTdGF0ZVJlc3VsdChzbSwgbWFwcGluZywgZmV0Y2gsCiAgICAgICAgICAg\nICAgICAgICAgICAgIFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHJlcyA9PSBudWxsICYmICFzZWxlY3RQcmlt\nYXJ5S2V5KHNtLCBtYXBwaW5nLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxpemVTdGF0ZVVu\naW9uUmVzdWx0KHNtLCBtYXBwaW5nLCBtYXBwaW5ncywKICAgICAgICAgICAg\nICAgICAgICAgICAgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYgKGlzRW1w\ndHlSZXN1bHQocmVzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZpZ3VyZSBvdXQg\nd2hhdCB0eXBlIG9mIG9iamVjdCB0aGlzIGlzOyB0aGUgc3RhdGUgbWFuYWdl\ncgogICAgICAgICAgICAvLyBvbmx5IGd1YXJhbnRlZXMgdG8gcHJvdmlkZSBh\nIGJhc2UgY2xhc3MKICAgICAgICAgICAgQ2xhc3M8Pz4gdHlwZTsKICAgICAg\nICAgICAgaWYgKCh0eXBlID0gZ2V0VHlwZShyZXMsIG1hcHBpbmcpKSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzLmdldEJhc2VNYXBwaW5n\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBtYXBwaW5nID0gcmVz\nLmdldEJhc2VNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICByZXMuc3RhcnRE\nYXRhUmVxdWVzdChtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKSk7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBt\nYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5nZXRDbGFzcyh0aGlzLCBtYXBw\naW5nLAogICAgICAgICAgICAgICAgICAgICAgICByZXMpOwogICAgICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICByZXMuZW5k\nRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgc3RhdGUgbWFuYWdl\ncjsgdGhpcyBtYXkgY2hhbmdlIHRoZSBtYXBwaW5nCiAgICAgICAgICAgIC8v\nIGFuZCB0aGUgb2JqZWN0IGlkIGluc3RhbmNlIGlmIHRoZSB0eXBlIGFzIGRl\ndGVybWluZWQKICAgICAgICAgICAgLy8gZnJvbSB0aGUgaW5kaWNhdG9yIGlz\nIGEgc3ViY2xhc3Mgb2YgZXhwZWN0ZWQgdHlwZQogICAgICAgICAgICBzbS5p\nbml0aWFsaXplKHR5cGUsIHN0YXRlKTsKCiAgICAgICAgICAgIGlmIChpbmZv\nICE9IG51bGwgJiYgaW5mby5yZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZEJ5RmllbGRNYXBwaW5nID0gaW5m\nby5yZXN1bHQuCiAgICAgICAgICAgICAgICAgICAgZ2V0TWFwcGVkQnlGaWVs\nZE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIE9iamVjdCBtYXBwZWRCeU9i\namVjdCA9IGluZm8ucmVzdWx0LmdldE1hcHBlZEJ5VmFsdWUoKTsKICAgICAg\nICAgICAgICAgIGlmIChtYXBwZWRCeUZpZWxkTWFwcGluZyAhPSBudWxsICYm\nIG1hcHBlZEJ5T2JqZWN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\naWYgKG1hcHBlZEJ5T2JqZWN0IGluc3RhbmNlb2YgT3BlbkpQQUlkICYmCiAg\nICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmcuZ2V0RXh0cmFGaWVsZERh\ndGFJbmRleChtYXBwZWRCeUZpZWxkTWFwcGluZy5nZXRJbmRleCgpKSAhPSAt\nMSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgaW52ZXJzZSBy\nZWxhdGlvbiBjYW4gbm90IGJlIHNldCBzaW5jZQogICAgICAgICAgICAgICAg\nICAgICAgICAvLyB3ZSBhcmUgZWFnZXJseSBsb2FkaW5nIHRoaXMgc20gZm9y\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGEgc20gb3duZXIgdGhhdCBp\ncyBzdGlsbCBpbiB0aGUgcHJvY2VzcyBvZiAKICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gaW5pdGlhbGl6aW5nIGl0c2VsZi4KICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gUmVtZW1iZXIgb3duZXIgb2lkIGJ5IHNldEludGVybWVk\naWF0ZSgpLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgaW52ZXJz\nZSByZWxhdGlvbiBpcyBzZXQgbGF0ZXIgYnkKICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gc2V0SW52ZXJzZVJlbGF0aW9uKCkgd2hlbiB0aGUgc20gb3du\nZXIgaXMgZnVsbHkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5pdGlh\nbGl6ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgIGludCBpbmRleCA9IG1h\ncHBlZEJ5RmllbGRNYXBwaW5nLmdldEluZGV4KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChzbS5nZXRMb2FkZWQoKS5nZXQoaW5kZXgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRJbXBsRGF0YShpbmRl\neCwgbWFwcGVkQnlPYmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0SW50\nZXJtZWRpYXRlKGluZGV4LCBtYXBwZWRCeU9iamVjdCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgICAgICBzZXRNYXBwZWRCeShzbSwgbWFwcGVk\nQnlGaWVsZE1hcHBpbmcsIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbG9hZCB0\naGUgc2VsZWN0ZWQgbWFwcGluZ3MgaW50byB0aGUgZ2l2ZW4gc3RhdGUgbWFu\nYWdlcgogICAgICAgICAgICBpZiAocmVzICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIC8vIHJlLWdldCB0aGUgbWFwcGluZyBpbiBjYXNlIHRoZSBpbnN0\nYW5jZSB3YXMgYSBzdWJjbGFzcwogICAgICAgICAgICAgICAgbWFwcGluZyA9\nIChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAg\nICAgICBsb2FkKG1hcHBpbmcsIHNtLCBmZXRjaCwgcmVzKTsKICAgICAgICAg\nICAgICAgIGdldFZlcnNpb24obWFwcGluZywgc20sIHJlcyk7CiAgICAgICAg\nICAgICAgICBzZXRJbnZlcnNlUmVsYXRpb24oc20sIG1hcHBpbmcsIHJlcyk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsICYm\nIChpbmZvID09IG51bGwgfHwgcmVzICE9IGluZm8ucmVzdWx0KSkKICAgICAg\nICAgICAgICAgIHJlcy5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgc2V0SW52ZXJzZVJlbGF0aW9uKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgb3duZXIsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFJl\nc3VsdCByZXMpIHsKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBw\naW5nLmdldEZpZWxkTWFwcGluZ3MoKTsKCiAgICAgICAgLy8gQXQgdGhpcyBw\nb2ludCwgdGhlIG93bmVyIGlzIGZ1bGx5IGluaXRpYWxpemVkLgogICAgICAg\nIC8vIENoZWNrIGlmIHRoZSBvd25lciBoYXMgZWFnZXJseSBsb2FkZWQgVG9N\nYW55IHJlbGF0aW9ucy4KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAocmVzLmdldEVhZ2Vy\nKGZtc1tpXSkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCFmbXNb\naV0uZ2V0RWxlbWVudCgpLmlzVHlwZVBDKCkpCiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICBPYmplY3QgY29sbCA9ICBv\nd25lci5mZXRjaE9iamVjdChmbXNbaV0uZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgICAgICBpZiAoY29sbCBpbnN0YW5jZW9mIE1hcCkKICAgICAgICAgICAg\nICAgICAgICBjb2xsID0gKChNYXApY29sbCkudmFsdWVzKCk7CiAgICAgICAg\nICAgICAgICBpZiAoY29sbCBpbnN0YW5jZW9mIENvbGxlY3Rpb248Pz4gJiYg\nCiAgICAgICAgICAgICAgICAgICAgKChDb2xsZWN0aW9uPD8+KSBjb2xsKS5z\naXplKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRm91bmQgZWFn\nZXJseSBsb2FkZWQgY29sbGVjdGlvbi4KICAgICAgICAgICAgICAgICAgICAv\nLyBQdWJsaXNoZXIgKDEpIDw9PT4gIChNKSBNYWdhemluZQogICAgICAgICAg\nICAgICAgICAgIC8vICAgIHB1Ymxpc2hlciBoYXMgYSBFQUdFUiBPbmVUb01h\nbnkgcmVsYXRpb24KICAgICAgICAgICAgICAgICAgICAvLyAgICBtYWdhemlu\nZSBoYXMgYSBFQUdFUiBvciBMQVpZIE1hbnlUb09uZSBwdWJsaXNoZXIKICAg\nICAgICAgICAgICAgICAgICAvLyBGb3IgZWFjaCBtZW1iZXIgKE1hZ2F6aW5l\nKSBpbiB0aGUgY29sbGVjdGlvbiwgCiAgICAgICAgICAgICAgICAgICAgLy8g\nc2V0IGl0cyBpbnZlcnNlIHJlbGF0aW9uIChQdWJsaXNoZXIpLgogICAgICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gKChDb2xsZWN0\naW9uPD8+KSBjb2xsKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxl\nKSBpdHIubmV4dCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBj\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgcGMuCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBwY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAg\nICAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbWQgPSAoKENsYXNz\nTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKSkuCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBnZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZm1kLmxlbmd0aDsgaisr\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qgb2lkID0g\nc20uZ2V0SW50ZXJtZWRpYXRlKGZtZFtqXS5nZXRJbmRleCgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG9pZCB3YXMgc2V0SW50ZXJt\nZWRpYXRlKCkgcHJldmlvdXNseQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gYW5kIGl0IGlzIHRoZSBzYW1lIGFzIHRoZSBvd25lciwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gc2V0IHRoZSBpbnZlcnNl\nIHJlbGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2lk\nICE9IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBv\naWQuZXF1YWxzKG93bmVyLmdldE9iamVjdElkKCkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZm1kW2pdLmdl\ndEluZGV4KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG93bmVyLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRNYXBw\nZWRCeShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEZpZWxkTWFw\ncGluZyBtYXBwZWRCeUZpZWxkTWFwcGluZywgT2JqZWN0IG1hcHBlZEJ5T2Jq\nZWN0KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NN\nYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIEZpZWxkTWFwcGlu\nZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChmbXNbaV0gPT0gbWFwcGVkQnlGaWVsZE1hcHBpbmcpIHsK\nICAgICAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZtc1tpXS5nZXRJbmRl\neCgpLCBtYXBwZWRCeU9iamVjdCk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24t\nSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBn\nZXR0aW5nIHZlcnNpb24gZnJvbSB0aGUgcmVzdWx0IHNldC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgZ2V0VmVyc2lvbihDbGFzc01hcHBpbmcgbWFw\ncGluZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBSZXN1bHQg\ncmVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBtYXBwaW5nLmdl\ndFZlcnNpb24oKS5hZnRlckxvYWQoc20sIHRoaXMpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGNoZWNraW5nIHdoZXRoZXIgdGhlIHJlc3VsdCBzZXQgaXMg\nZW1wdHkgb3Igbm90LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBp\nc0VtcHR5UmVzdWx0KFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiAhcmVzLm5leHQoKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHBy\nb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAg\nICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRpbmcgdHlwZSBmcm9tIHRoZSBy\nZXN1bHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3M8Pz4gZ2V0\nVHlwZShSZXN1bHQgcmVzLCBDbGFzc01hcHBpbmcgbWFwcGluZyl7CiAgICAg\nICAgaWYgKHJlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWFwcGlu\nZy5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB0aGUgbWFwcGluZyB0byBjdXN0\nb20gbG9hZCBkYXRhLiBSZXR1cm4gbnVsbCBpZiB0aGUgbWFwcGluZwogICAg\nICogZG9lcyBub3QgdXNlIGN1c3RvbSBsb2FkaW5nLgogICAgICovCiAgICBw\ncml2YXRlIEJvb2xlYW4gY3VzdG9tTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBQQ1N0YXRlIHN0\nYXRlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRo\ncm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgbWFwcGluZyB0YWtlcyBj\nYXJlIG9mIGluaXRpYWxpemF0aW9uCiAgICAgICAgaWYgKCFtYXBwaW5nLmN1\nc3RvbUxvYWQoc20sIHRoaXMsIHN0YXRlLCBmZXRjaCkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuZ2V0VmVyc2lv\nbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICAgICAgICAgIHJldHVybiBC\nb29sZWFuLlRSVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFu\nLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBkYXRh\nIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UgYW5kIHJldHVybiB0aGUgcmVzdWx0\nLiBSZXR1cm4KICAgICAqIG51bGwgaWYgdGhlcmUgaXMgbm8gZGF0YSBpbiB0\naGUgY3VycmVudCBmZXRjaCBncm91cHMgdG8gc2VsZWN0LgogICAgICovCiAg\nICBwcml2YXRlIFJlc3VsdCBnZXRJbml0aWFsaXplU3RhdGVSZXN1bHQoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFw\ncGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHN1YnMp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRmluZGVy\nUXVlcnlJbXBsIGZxID0gZ2V0RmluZGVyKG1hcHBpbmcsIGZldGNoKTsKICAg\nICAgICBpZiAoZnEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZxLmV4\nZWN1dGUoc20sIHRoaXMsIGZldGNoKTsKICAgICAgICBTZWxlY3Qgc2VsID0g\nX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICBpZiAoIXNlbGVjdChzZWwsIG1h\ncHBpbmcsIHN1YnMsIHNtLCBudWxsLCBmZXRjaCwKICAgICAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOLCB0cnVlLCBmYWxzZSkp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZywgdGhpcyk7CiAg\nICAgICAgc2VsLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwog\nICAgICAgIFJlc3VsdCByZXN1bHQgPSBzZWwuZXhlY3V0ZSh0aGlzLCBmZXRj\naCk7CiAgICAgICAgY2FjaGVGaW5kZXIobWFwcGluZywgc2VsLCBmZXRjaCk7\nCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlbGVjdCBhIHVuaW9uIG9mIHRoZSBkYXRhIGZvciB0aGUgZ2l2ZW4gaW5z\ndGFuY2UgZnJvbSBwb3NzaWJsZSBjb25jcmV0ZQogICAgICogbWFwcGluZ3Mg\nYW5kIHJldHVybiB0aGUgcmVzdWx0LgogICAgICovCiAgICBwcml2YXRlIFJl\nc3VsdCBnZXRJbml0aWFsaXplU3RhdGVVbmlvblJlc3VsdChmaW5hbCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBw\naW5nLCBmaW5hbCBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncywKICAgICAgICBm\naW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBGaW5kZXJRdWVyeUltcGwgZnEgPSBnZXRG\naW5kZXIobWFwcGluZywgZmV0Y2gpOwogICAgICAgIGlmIChmcSAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZnEuZXhlY3V0ZShzbSwgdGhpcywgZmV0\nY2gpOwogICAgICAgIGZpbmFsIEpEQkNTdG9yZU1hbmFnZXIgc3RvcmUgPSB0\naGlzOwogICAgICAgIGZpbmFsIGludCBlYWdlciA9IE1hdGgubWluKGZldGNo\nLmdldEVhZ2VyRmV0Y2hNb2RlKCksCiAgICAgICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7CgogICAgICAgIFVuaW9uIHVuaW9u\nID0gX3NxbC5uZXdVbmlvbihtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgIHVu\naW9uLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwogICAgICAg\nIGlmIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBm\nZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAgICB1bmlvbi5hYm9ydFVuaW9u\nKCk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3Rvcigp\nIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWws\nIGludCBpKSB7CiAgICAgICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmdz\nW2ldLCBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEUsIHN0b3JlLCBmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICBlYWdlcik7CiAgICAgICAgICAgICAgICBz\nZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmdz\nW2ldLCBzdG9yZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAg\nICBSZXN1bHQgcmVzdWx0ID0gdW5pb24uZXhlY3V0ZSh0aGlzLCBmZXRjaCk7\nCiAgICAgICAgY2FjaGVGaW5kZXIobWFwcGluZywgdW5pb24sIGZldGNoKTsK\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICog\nU2VsZWN0IHByaW1hcnkga2V5IGRhdGEgdG8gbWFrZSBzdXJlIHRoZSBnaXZl\nbiBpbnN0YW5jZSBleGlzdHMsIGxvY2tpbmcKICAgICAqIGlmIG5lZWRlZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdFByaW1hcnlLZXko\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBzZWxlY3QgcGtz\nIGZyb20gYmFzZSBjbGFzcyByZWNvcmQgdG8gZW5zdXJlIGl0IGV4aXN0cyBh\nbmQgbG9jawogICAgICAgIC8vIGl0IGlmIG5lZWRlZAogICAgICAgIENsYXNz\nTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAoYmFzZS5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAg\nICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKTsKCiAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0\nKCk7CiAgICAgICAgc2VsLnNlbGVjdChiYXNlLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCkpOwogICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkoc20uZ2V0T2Jq\nZWN0SWQoKSwgYmFzZSwgdGhpcyk7CiAgICAgICAgUmVzdWx0IGV4aXN0cyA9\nIHNlbC5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChleGlzdHMpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgLy8gcmVjb3JkIGxv\nY2tlZD8KICAgICAgICAgICAgaWYgKF9hY3RpdmUgJiYgX2xtICE9IG51bGwg\nJiYgZXhpc3RzLmlzTG9ja2luZygpKQogICAgICAgICAgICAgICAgX2xtLmxv\nYWRlZEZvclVwZGF0ZShzbSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGV4aXN0cy5jbG9zZSgp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBsb2FkKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgbG9ja0xldmVsLCBPYmpl\nY3QgY29udGV4dCkgewogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\namZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGZldGNoOwoKICAg\nICAgICAvLyBnZXQgYSBjb25uZWN0aW9uLCBvciByZXVzZSBjdXJyZW50IG9u\nZQogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSAoQ29ubmVjdGlvbklu\nZm8pIGNvbnRleHQ7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAgICAg\nICAgaWYgKGluZm8gIT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiBpbml0\naWFsaXplKCkgZmFpbHMgdG8gbG9hZCByZXF1aXJlZCBmaWVsZHMsIHRoZW4g\ndGhpcyBtZXRob2QKICAgICAgICAgICAgLy8gaXMgY2FsbGVkOyBtYWtlIHN1\ncmUgbm90IHRvIHRyeSB0byB1c2UgdGhlIGdpdmVuIHJlc3VsdCBpZiBpdCdz\nCiAgICAgICAgICAgIC8vIHRoZSBzYW1lIG9uZSB3ZSBqdXN0IGZhaWxlZCB0\nbyBjb21wbGV0ZWx5IGluaXRpYWxpemUoKSB3aXRoCiAgICAgICAgICAgIGlm\nIChpbmZvLnNtICE9IHNtKQogICAgICAgICAgICAgICAgcmVzID0gaW5mby5y\nZXN1bHQ7CiAgICAgICAgICAgIGluZm8uc20gPSBudWxsOwogICAgICAgIH0K\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGFuIGV4\naXN0aW5nIHJlc3VsdCwgbG9hZCBhbGwgd2UgY2FuIGZyb20gaXQKICAgICAg\nICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBz\nbS5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAocmVzICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGpmZXRjaCwg\ncmVzKTsKICAgICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZpZWxkcyhzbSwg\nZmllbGRzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgdGhl\nIGluc3RhbmNlIGlzIGhvbGxvdyBhbmQgdGhlcmUncyBhIGN1c3RvbWl6ZWQK\nICAgICAgICAgICAgLy8gZ2V0IGJ5IGlkIG1ldGhvZCwgdXNlIGl0CiAgICAg\nICAgICAgIGlmIChzbS5nZXRMb2FkZWQoKS5sZW5ndGgoKSA9PSAwIAogICAg\nICAgICAgICAgICAgJiYgbWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBu\ndWxsLCBqZmV0Y2gpKQogICAgICAgICAgICAgICAgcmVtb3ZlTG9hZGVkRmll\nbGRzKHNtLCBmaWVsZHMpOwoKICAgICAgICAgICAgLy8jIyMgc2VsZWN0IGlz\nIGtpbmQgb2YgYSBiaWcgb2JqZWN0LCBhbmQgaW4gc29tZSBjYXNlcyB3ZSBk\nb24ndAogICAgICAgICAgICAvLyMjIyB1c2UgaXQuLi4gd291bGQgaXQgYmUg\nd29ydGggaXQgdG8gaGF2ZSBhIHNtYWxsIHNoZWxsIHNlbGVjdAogICAgICAg\nICAgICAvLyMjIyBvYmplY3QgdGhhdCBvbmx5IGNyZWF0ZXMgYSByZWFsIHNl\nbGVjdCB3aGVuIGFjdHVhbGx5IHVzZWQ/CgogICAgICAgICAgICBTZWxlY3Qg\nc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICAgICAgaWYgKHNlbGVj\ndChzZWwsIG1hcHBpbmcsIFNlbGVjdC5TVUJTX0VYQUNULCBzbSwgZmllbGRz\nLCBqZmV0Y2gsCiAgICAgICAgICAgICAgICBFYWdlckZldGNoTW9kZXMuRUFH\nRVJfSk9JTiwgdHJ1ZSwgZmFsc2UpKSB7CiAgICAgICAgICAgICAgICBzZWwu\nd2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmcsIHRo\naXMpOwogICAgICAgICAgICAgICAgcmVzID0gc2VsLmV4ZWN1dGUodGhpcywg\namZldGNoLCBsb2NrTGV2ZWwpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAJaWYgKGlzRW1wdHlSZXN1bHQocmVzKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAg\nICAgICAgIGxvYWQobWFwcGluZywgc20sIGpmZXRjaCwgcmVzKTsKICAgICAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIG5vdyBhbGxvdyB0aGUgZmllbGRzIHRvIGxvYWQgdGhl\nbXNlbHZlcyBpbmRpdmlkdWFsbHkgdG9vCiAgICAgICAgICAgIEZpZWxkTWFw\ncGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5ncygpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIGlmIChmaWVsZHMuZ2V0KGkpICYmICFzbS5nZXRM\nb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLmxv\nYWQoc20sIHRoaXMsIGpmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSk7CiAg\nICAgICAgICAgIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwg\ndGhpcyk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0\nY2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNR\nTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0LCBsb2NrTGV2ZWwpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGxpc3Qg\nZm9ybWVkIGJ5IHJlbW92aW5nIGFsbCBsb2FkZWQgZmllbGRzIGZyb20gdGhl\nIGdpdmVuIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUxv\nYWRlZEZpZWxkcyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmll\nbGRzKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IGZpZWxkcy5s\nZW5ndGgoKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRz\nLmdldChpKSAmJiBzbS5nZXRMb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAg\nICAgICBmaWVsZHMuY2xlYXIoaSk7CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gbG9hZEFsbChDb2xsZWN0aW9uIHNtcywgUENTdGF0ZSBzdGF0ZSwg\naW50IGxvYWQsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBP\nYmplY3QgY29udGV4dCkgewogICAgICAgIHJldHVybiBJbXBsSGVscGVyLmxv\nYWRBbGwoc21zLCB0aGlzLCBzdGF0ZSwgbG9hZCwgZmV0Y2gsIGNvbnRleHQp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZm9yZVN0YXRlQ2hhbmdlKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3RhdGUgZnJvbVN0YXRlLAogICAg\nICAgIFBDU3RhdGUgdG9TdGF0ZSkgewogICAgfQoKICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIGZsdXNoKENvbGxlY3Rpb24gc21zKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9jb25uICE9IG51bGwgJiYgX2Nvbm4uZ2V0SW5u\nZXJtb3N0RGVsZWdhdGUoKS5pc1JlYWRPbmx5KCkpCiAgICAgICAgICAgICAg\nICBfY29ubi5zZXRSZWFkT25seShmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIGUpIHsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9j\nb25mLmdldFVwZGF0ZU1hbmFnZXJJbnN0YW5jZSgpLmZsdXNoKHNtcywgdGhp\ncyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gY2FuY2VsQWxsKCkgewog\nICAgICAgIC8vIG5vdGUgdGhhdCB0aGlzIG1ldGhvZCBkb2VzIG5vdCBsb2Nr\nIHRoZSBjb250ZXh0LCBzaW5jZQogICAgICAgIC8vIHdlIHdhbnQgdG8gYWxs\nb3cgYSBkaWZmZXJlbnQgdGhyZWFkIHRvIGJlIGFibGUgdG8gY2FuY2VsIHRo\nZQogICAgICAgIC8vIG91dHN0YW5kaW5nIHN0YXRlbWVudCBvbiBhIGRpZmZl\ncmVudCBjb250ZXh0CgogICAgICAgIENvbGxlY3Rpb248U3RhdGVtZW50PiBz\ndG1udHM7CiAgICAgICAgc3luY2hyb25pemVkIChfc3RtbnRzKSB7CiAgICAg\nICAgICAgIGlmIChfc3RtbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3RtbnRzID0gbmV3IEFycmF5\nTGlzdDxTdGF0ZW1lbnQ+KF9zdG1udHMpOwogICAgICAgIH0KCiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxTdGF0ZW1lbnQ+IGl0\nciA9IHN0bW50cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgICgoU3RhdGVtZW50KSBpdHIubmV4dCgpKS5jYW5jZWwoKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gYXNzaWduT2JqZWN0SWQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBM\nSUNBVElPTikKICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmFz\nc2lnbihzbSwgdGhpcywgcHJlRmx1c2gpOwoKICAgICAgICAvLyBkYXRhc3Rv\ncmUgaWRlbnRpdHkKICAgICAgICBPYmplY3QgdmFsID0gSW1wbEhlbHBlci5n\nZW5lcmF0ZUlkZW50aXR5VmFsdWUoX2N0eCwgbWV0YSwKICAgICAgICAgICAg\nSmF2YVR5cGVzLkxPTkcpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCAmJiBt\nZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSAhPSBWYWx1ZVN0cmF0ZWdpZXMu\nTkFUSVZFKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICB2YWwgPSBnZXREYXRhU3RvcmVJ\nZFNlcXVlbmNlKG1ldGEpLm5leHQoX2N0eCwgbWV0YSk7CiAgICAgICAgc20u\nc2V0T2JqZWN0SWQobmV3RGF0YVN0b3JlSWQodmFsLCBtZXRhKSk7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYXNz\naWduRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50IGZpZWxkLAog\nICAgICAgIGJvb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIE9iamVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVyYXRlRmllbGRW\nYWx1ZShfY3R4LCBmbWQpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHNtLnN0b3JlKGZpZWxk\nLCB2YWwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzczw/PiBnZXRNYW5hZ2VkVHlwZShPYmplY3Qgb2lkKSB7CiAgICAg\nICAgaWYgKG9pZCBpbnN0YW5jZW9mIElkKQogICAgICAgICAgICByZXR1cm4g\nKChJZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHVibGljIENsYXNzPD8+IGdldERhdGFTdG9yZUlkVHlwZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gSWQuY2xhc3M7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBjb3B5RGF0YVN0b3JlSWQoT2Jq\nZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgSWQgaWQg\nPSAoSWQpIG9pZDsKICAgICAgICByZXR1cm4gbmV3IElkKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCBpZC5nZXRJZCgpLCBpZC5oYXNTdWJjbGFzc2VzKCkp\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RGF0YVN0b3JlSWQoT2Jq\nZWN0IHZhbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJu\nIElkLm5ld0luc3RhbmNlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB2YWwp\nOwogICAgfQoKICAgIHB1YmxpYyBJZCBuZXdEYXRhU3RvcmVJZChsb25nIGlk\nLCBDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBzdWJzKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBJZChtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSwg\naWQsIHN1YnMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92\naWRlciBleGVjdXRlRXh0ZW50KENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAg\nICBmaW5hbCBib29sZWFuIHN1YmNsYXNzZXMsIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENs\nYXNzTWFwcGluZykgbWV0YTsKICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdb\nXSBtYXBwaW5nczsKICAgICAgICBpZiAoc3ViY2xhc3NlcykKICAgICAgICAg\nICAgbWFwcGluZ3MgPSBtYXBwaW5nLmdldEluZGVwZW5kZW50QXNzaWduYWJs\nZU1hcHBpbmdzKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtYXBwaW5n\ncyA9IG5ldyBDbGFzc01hcHBpbmdbXSB7IG1hcHBpbmcgfTsKCiAgICAgICAg\nUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0gbnVsbDsKICAgICAgICBm\naW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGpmZXRjaCA9IChKREJDRmV0\nY2hDb25maWd1cmF0aW9uKSBmZXRjaDsKICAgICAgICBpZiAoamZldGNoLmdl\ndFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGpmZXRjaC5FQUdFUl9K\nT0lOKQogICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3Zp\nZGVyW21hcHBpbmdzLmxlbmd0aF07CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIGNoZWNrIGZvciBjdXN0b20gbG9hZHMKICAgICAgICAgICAgUmVz\ndWx0T2JqZWN0UHJvdmlkZXIgcm9wOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICByb3AgPSBtYXBwaW5nc1tpXS5jdXN0b21Mb2FkKHRoaXMsIHN1YmNs\nYXNzZXMsIGpmZXRjaCwgMCwKICAgICAgICAgICAgICAgICAgICBMb25nLk1B\nWF9WQUxVRSk7CiAgICAgICAgICAgICAgICBpZiAocm9wICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAocm9wcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3Zp\nZGVyW21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAgICAgICAgICAgICAgcm9w\nc1tpXSA9IHJvcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaWYgd2UncmUgc2VsZWN0aW5nIGluZGVwZW5kZW50\nIG1hcHBpbmdzIHNlcGFyYXRlbHkgb3IgaGF2ZQogICAgICAgICAgICAvLyBj\ndXN0b20gbG9hZHMsIGRvIGluZGl2aWR1YWwgc2VsZWN0cyBmb3IgZWFjaCBj\nbGFzcwogICAgICAgICAgICByb3AgPSBudWxsOwogICAgICAgICAgICBpZiAo\ncm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHJvcHNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIFNlbGVjdCBz\nZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgICAgICAgICAgICAgIHNl\nbC5zZXRMUlModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgQml0U2V0IHBh\nZ2VkID0gc2VsZWN0RXh0ZW50KHNlbCwgbWFwcGluZ3NbaV0sIGpmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3Nlcyk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJvcHNbaV0gPSBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQ\ncm92aWRlcihzZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBw\naW5nc1tpXSwgdGhpcywgamZldGNoKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJvcHNbaV0gPSBuZXcgUGFn\naW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbWFwcGluZ3NbaV0sIHRoaXMsIGpmZXRjaCwgcGFnZWQs\nIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGlmIChyb3BzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiByb3BzWzBdOwogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcihyb3BzKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gcGVyZm9ybSBhIHVuaW9uIG9uIGFsbCBp\nbmRlcGVuZGVudCBjbGFzc2VzCiAgICAgICAgICAgIFVuaW9uIHVuaW9uID0g\nX3NxbC5uZXdVbmlvbihtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgICAgICB1\nbmlvbi5zZXRMUlModHJ1ZSk7CiAgICAgICAgICAgIGZpbmFsIEJpdFNldFtd\nIHBhZ2VkID0gbmV3IEJpdFNldFttYXBwaW5ncy5sZW5ndGhdOwogICAgICAg\nICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGlu\ndCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICBwYWdlZFtpZHhdID0gc2Vs\nZWN0RXh0ZW50KHNlbCwgbWFwcGluZ3NbaWR4XSwgamZldGNoLAogICAgICAg\nICAgICAgICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyB1c2luZyBwYWdp\nbmcgcm9wIGlmIGFueSB1bmlvbiBlbGVtZW50IGhhcyBwYWdlZCBmaWVsZHMK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYWdlZC5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBhZ2VkW2ldICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlcih1bmlvbiwgbWFwcGluZ3MsCiAgICAgICAgICAgICAg\nICAgICAgICAgIEpEQkNTdG9yZU1hbmFnZXIudGhpcywgamZldGNoLCBwYWdl\nZCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcih1bmlv\nbiwgbWFwcGluZ3NbMF0sIHRoaXMsCiAgICAgICAgICAgICAgICBqZmV0Y2gp\nOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBn\naXZlbiBtYXBwaW5nIGZvciB1c2UgaW4gYW4gZXh0ZW50LCByZXR1cm5pbmcg\ncGFnZWQgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIEJpdFNldCBzZWxl\nY3RFeHRlbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBz\ndWJjbGFzc2VzKSB7CiAgICAgICAgaW50IHN1YnMgPSAoc3ViY2xhc3Nlcykg\nPyBTZWxlY3QuU1VCU19KT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05PTkU7CiAg\nICAgICAgLy8gZGVjaWRlIGJldHdlZW4gcGFnaW5nIGFuZCBzdGFuZGFyZCBp\ndGVyYXRpb24KICAgICAgICBCaXRTZXQgcGFnZWQgPSBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlci5nZXRQYWdlZEZpZWxkcyhzZWwsIG1hcHBpbmcsCiAg\nICAgICAgICAgIHRoaXMsIGZldGNoLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nLkVBR0VSX1BBUkFMTEVMLAogICAgICAgICAgICBMb25nLk1BWF9WQUxVRSk7\nCiAgICAgICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgIHNlbC5z\nZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAog\nICAgICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9Q\nQVJBTExFTCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWwuc2VsZWN0\nSWRlbnRpZmllcihtYXBwaW5nLCBzdWJzLCB0aGlzLCBmZXRjaCwKICAgICAg\nICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7\nCiAgICAgICAgcmV0dXJuIHBhZ2VkOwogICAgfQoKICAgIHB1YmxpYyBTdG9y\nZVF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5ndWFnZSkgewogICAgICAgIEV4\ncHJlc3Npb25QYXJzZXIgZXAgPSBRdWVyeUxhbmd1YWdlcy5wYXJzZXJGb3JM\nYW5ndWFnZShsYW5ndWFnZSk7CiAgICAgICAgaWYgKGVwICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgSkRCQ1N0b3JlUXVlcnkodGhpcywgZXAp\nOwogICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMo\nbGFuZ3VhZ2UpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNRTFN0b3JlUXVl\ncnkodGhpcyk7CiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJF\nUEFSRURfU1FMLmVxdWFscyhsYW5ndWFnZSkpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgUHJlcGFyZWRTUUxTdG9yZVF1ZXJ5KHRoaXMpOwogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRp\nb24gbmV3RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBu\nZXcgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwoKTsKICAgIH0KCiAgICBw\ndWJsaWMgU2VxIGdldERhdGFTdG9yZUlkU2VxdWVuY2UoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVn\neSgpID09IFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUKICAgICAgICAgICAgfHwg\nbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVz\nLk5PTkUpCiAgICAgICAgICAgIHJldHVybiBfY29uZi5nZXRTZXF1ZW5jZUlu\nc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVi\nbGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nY2xvc2UoKSB7CiAgICAgICAgaWYgKF9jb25uICE9IG51bGwpCiAgICAgICAg\nICAgIF9jb25uLmZyZWUoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAg\nICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAg\nICAqIENvbm5lY3QgdG8gdGhlIGRiLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgY29ubmVjdChib29sZWFuIHJlZikgewogICAgICAgIF9jdHgubG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbm5lY3QgaWYgdGhl\nIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IG51bGwsIG9yIGlmCiAgICAgICAg\nICAgIC8vIHRoZSBjb25uZWN0aW9uIGhhcyBiZWVuIGNsb3NlZCBvdXQgZnJv\nbSB1bmRlciB1cwogICAgICAgICAgICBpZiAoX2Nvbm4gPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9jb25uID0gY29ubmVjdEludGVybmFsKCk7CiAgICAg\nICAgICAgIGlmIChyZWYpCiAgICAgICAgICAgICAgICBfY29ubi5yZWYoKTsK\nICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAg\nICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdCB0byB0\naGUgZGF0YWJhc2UuIFRoaXMgbWV0aG9kIGlzIHNlcGFyYXRlZCBvdXQgc28g\ndGhhdCBpdAogICAgICogY2FuIGJlIG92ZXJyaWRkZW4uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBSZWZDb3VudENvbm5lY3Rpb24gY29ubmVjdEludGVybmFs\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIENvbmNy\nZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UocmVmQ291bnRDb25uZWN0\naW9uSW1wbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBfZHMuZ2V0Q29ubmVj\ndGlvbigpKTsKICAgIH0KICAgIAogICAgcHVibGljIENvbm5lY3Rpb24gZ2V0\nTmV3Q29ubmVjdGlvbigpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gY29ubmVjdEludGVybmFsKCk7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9u\ncy5nZXRTdG9yZShlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogRmluZCB0aGUgb2JqZWN0IHdpdGggdGhlIGdpdmVuIG9pZC4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIFZh\nbHVlTWFwcGluZyB2bSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgT2JqZWN0IHBjID0gX2N0eC5maW5k\nKG9pZCwgZmV0Y2gsIG51bGwsIG51bGwsIDApOwogICAgICAgIGlmIChwYyA9\nPSBudWxsICYmIHZtICE9IG51bGwpIHsKICAgICAgICAgICAgT3JwaGFuZWRL\nZXlBY3Rpb24gYWN0aW9uID0gX2NvbmYuZ2V0T3JwaGFuZWRLZXlBY3Rpb25J\nbnN0YW5jZSgpOwogICAgICAgICAgICBwYyA9IGFjdGlvbi5vcnBoYW4ob2lk\nLCBudWxsLCB2bSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYzsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIG9iamVjdCBpbiB0aGUgY3Vy\ncmVudCByb3cgb2YgdGhlIGdpdmVuIHJlc3VsdC4KICAgICAqLwogICAgcHVi\nbGljIE9iamVjdCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIEJpdFNldCBleGNsdWRl\nLCBSZXN1bHQgcmVzdWx0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoIW1hcHBpbmcuaXNNYXBwZWQoKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidmlydHVhbC1t\nYXBwaW5nIiwgCiAgICAgICAgICAgICAgICBtYXBwaW5nKSk7CgogICAgICAg\nIC8vIGdldCB0aGUgb2JqZWN0IGlkIGZvciB0aGUgcm93OyBiYXNlIGNsYXNz\nIHNlbGVjdHMgcGsgY29sdW1ucwogICAgICAgIENsYXNzTWFwcGluZyBiYXNl\nID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAoYmFzZS5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBiYXNl\nID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAg\nICAgICBPYmplY3Qgb2lkID0gYmFzZS5nZXRPYmplY3RJZCh0aGlzLCByZXN1\nbHQsIG51bGwsIHRydWUsIG51bGwpOwogICAgICAgIGlmIChvaWQgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbm5lY3Rp\nb25JbmZvIGluZm8gPSBuZXcgQ29ubmVjdGlvbkluZm8oKTsKICAgICAgICBp\nbmZvLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICBpbmZvLm1hcHBpbmcgPSBt\nYXBwaW5nOwoKICAgICAgICAvLyBpZiBpbnZlcnNlIHJlbGF0aW9uIGlzIGtu\nb3duLCBleGNsdWRlIGxvYWRpbmcgZHVyaW5nIGZpbmQKICAgICAgICBleGNs\ndWRlID0gZXhjbHVkZUludmVyc2VSZWxhdGlvbihtYXBwaW5nLCBpbmZvLCBl\neGNsdWRlKTsKICAgICAgICByZXR1cm4gX2N0eC5maW5kKG9pZCwgZmV0Y2gs\nIGV4Y2x1ZGUsIGluZm8sIDApOwogICAgfQoKICAgIHByaXZhdGUgQml0U2V0\nIGV4Y2x1ZGVJbnZlcnNlUmVsYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nCiAgICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbywgQml0U2V0IGV4Y2x1ZGUp\nIHsKICAgICAgICBGaWVsZE1hcHBpbmcgaW52ZXJzZSA9IGluZm8ucmVzdWx0\nLmdldE1hcHBlZEJ5RmllbGRNYXBwaW5nKCk7CiAgICAgICAgaWYgKGludmVy\nc2UgIT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMg\nPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAg\nICAgIGlmIChleGNsdWRlID09IG51bGwpCiAgICAgICAgICAgICAgICBleGNs\ndWRlID0gbmV3IEJpdFNldChmbXMubGVuZ3RoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChmbXNbaV0gPT0gaW52ZXJzZSkgewogICAgICAgICAgICAg\nICAgICAgIGV4Y2x1ZGUuc2V0KGZtc1tpXS5nZXRJbmRleCgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhjbHVkZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIHN0YXRlIG1hbmFn\nZXIgd2l0aCBkYXRhIGZyb20gdGhlIHJlc3VsdCBzZXQuIE9ubHkKICAgICAq\nIG1hcHBpbmdzIG9yaWdpbmFsbHkgc2VsZWN0ZWQgd2lsbCBiZSBsb2FkZWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBsb2FkKENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFu\neSA9IGxvYWQobWFwcGluZywgc20sIGZldGNoLCByZXMsIG51bGwpOwogICAg\nICAgIGlmIChlYWdlclRvTWFueSAhPSBudWxsKQogICAgICAgICAgICBlYWdl\nclRvTWFueS5sb2FkRWFnZXJKb2luKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJz\nZUpEQkMoZWFnZXJUb01hbnkpLAogICAgICAgICAgICAgICAgcmVzKTsKICAg\nICAgICBpZiAoX2FjdGl2ZSAmJiBfbG0gIT0gbnVsbCAmJiByZXMuaXNMb2Nr\naW5nKCkpCiAgICAgICAgICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwog\nICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZmllbGRzIG9mIHRoZSBn\naXZlbiBtYXBwaW5nLiBSZXR1cm4gYW55IHRvLW1hbnkgZWFnZXIgZmllbGQK\nICAgICAqIHdpdGhvdXQgbG9hZGluZyBpdC4KICAgICAqLwogICAgcHJpdmF0\nZSBGaWVsZE1hcHBpbmcgbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzLCBGaWVsZE1hcHBpbmcgZWFnZXJU\nb01hbnkpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKG1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgZmV0Y2gsIHJlcykp\nCiAgICAgICAgICAgIHJldHVybiBlYWdlclRvTWFueTsKCiAgICAgICAgLy8g\nbG9hZCBzdXBlcmNsYXNzIGRhdGE7IGJhc2UgY2xhc3MgbG9hZHMgdmVyc2lv\nbgogICAgICAgIENsYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChwYXJl\nbnQgIT0gbnVsbCkKICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBsb2FkKHBh\ncmVudCwgc20sIGZldGNoLCByZXMsIGVhZ2VyVG9NYW55KTsKICAgICAgICBl\nbHNlIGlmIChzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAg\nbWFwcGluZy5nZXRWZXJzaW9uKCkubG9hZChzbSwgdGhpcywgcmVzKTsKCiAg\nICAgICAgLy8gbG9hZCB1bmxvYWRlZCBmaWVsZHMKICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgT2JqZWN0IGVyZXMsIHByb2Nlc3NlZDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoZm1zW2ldLmlzUHJpbWFyeUtleSgpIHx8IHNtLmdldExvYWRl\nZCgpLmdldChmbXNbaV0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGZv\nciBlYWdlciByZXN1bHQsIGFuZCBpZiBub3QgcHJlc2VudCBkbyBzdGFuZGFy\nZCBsb2FkCiAgICAgICAgICAgIGVyZXMgPSByZXMuZ2V0RWFnZXIoZm1zW2ld\nKTsKICAgICAgICAgICAgcmVzLnN0YXJ0RGF0YVJlcXVlc3QoZm1zW2ldKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgaWYgKGVyZXMgPT0g\ncmVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVhZ2VyVG9NYW55ID09\nIG51bGwgJiYgZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBm\nbXNbaV0ubG9hZEVhZ2VySm9pbihzbSwgdGhpcywgCiAgICAgICAgICAgICAg\nICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJlcyAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkID0gZm1zW2ldLmxvYWRFYWdl\nclBhcmFsbGVsKHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0\nY2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGVyZXMpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChwcm9jZXNzZWQgIT0gZXJlcykKICAgICAgICAgICAgICAg\nICAgICAgICAgcmVzLnB1dEVhZ2VyKGZtc1tpXSwgcHJvY2Vzc2VkKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYm9v\nbGVhbiBsYXp5RW1iZWRkYWJsZSA9IGZtc1tpXS5nZXRWYWx1ZU1hcHBpbmco\nKS5pc0VtYmVkZGVkKCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgZm1z\nW2ldLmdldEVtYmVkZGVkTWV0YURhdGEoKSAhPSBudWxsICYmIAogICAgICAg\nICAgICAgICAgICAgICAgICBmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tpXSkg\nPT0gRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX05PTkU7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKCFsYXp5RW1iZWRkYWJsZSkgICAgCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZtc1tpXS5sb2FkKHNtLCB0aGlzLCBmZXRjaC50cmF2\nZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHJlcy5lbmRE\nYXRhUmVxdWVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAvKioKICAgICAqIEZv\nciBpbXBsZW1lbnRhdGlvbiB1c2Ugb25seS4KICAgICAqIFJldHVybiBhIHNl\nbGVjdCBmb3IgdGhlIHByb3BlciBtYXBwaW5ncy4gUmV0dXJuIG51bGwgaWYg\nbm8gc2VsZWN0IGlzCiAgICAgKiBuZWVkZWQuIFRoZSBtZXRob2QgaXMgZGVz\naWduZWQgdG8gYmUgY29tcGxlbWVudGFyeSB0byB0aGUgbG9hZCBtZXRob2Rz\nLgogICAgICoKICAgICAqIEBwYXJhbSBzZWwgc2VsZWN0IHRvIGJ1aWxkIG9u\nCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbWFwcGluZyBmb3IgdGhlIGJh\nc2UgdHlwZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gc3VicyB3aGV0\naGVyIHRoZSBzZWxlY3QgbWlnaHQgaW5jbHVkZSBzdWJjbGFzc2VzIG9mIHRo\nZQogICAgICogZ2l2ZW4gbWFwcGluZwogICAgICogQHBhcmFtIHNtIHN0YXRl\nIG1hbmFnZXIgaWYgYW4gaW5zdGFuY2UgaXMgYmVpbmcgbG9hZGVkIG9yCiAg\nICAgKiBpbml0aWFsaXplZCwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0gZmll\nbGRzIGlmIGEgc3RhdGUgbWFuYWdlciBpcyBiZWluZyBsb2FkZWQsIHRoZSBz\nZXQgb2YKICAgICAqIGZpZWxkcyB0aGF0IG11c3QgYmUgbG9hZGVkIGluIG9y\nZGVyLCBlbHNlIG51bGwKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0Y2gg\nY29uZmlndXJhdGlvbjsgdXNlZCBpZiBubyBzcGVjaWZpYyBmaWVsZHMKICAg\nICAqIG11c3QgYmUgbG9hZGVkLCBhbmQgdXNlZCB3aGVuIHNlbGVjdGluZyBy\nZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciBlYWdlciBmZXRjaCBtb2Rl\nIHRvIHVzZQogICAgICogQHBhcmFtIGlkZW50IHdoZXRoZXIgdG8gc2VsZWN0\nIHByaW1hcnkga2V5IGNvbHVtbnMgYXMgZGlzdGluY3QKICAgICAqIGlkZW50\naWZpZXJzCiAgICAgKiBAcGFyYW0gb3V0ZXIgd2hldGhlciB3ZSdyZSBvdXRl\nci1qb2luaW5nIHRvIHRoaXMgdHlwZQogICAgICogQHJldHVybiB0cnVlIGlm\nIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIGZhbHNlIG90aGVyd2lzZQogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU2VsZWN0IHNlbCwgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLAogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyLCBib29sZWFuIGlk\nZW50LCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gYWRkIGNsYXNzIGNv\nbmRpdGlvbnMgc28gdGhhdCB0aGV5J3JlIGNsb25lZCBmb3IgYW55IGJhdGNo\nZWQgc2VsZWN0cwogICAgICAgIGJvb2xlYW4gam9pbmVkU3VwZXJzID0gZmFs\nc2U7ICAgIAogICAgICAgIGlmKG5lZWRDbGFzc0NvbmRpdGlvbihtYXBwaW5n\nLCBzdWJzLCBzbSkpIHsKICAgICAgICAgICAgam9pbmVkU3VwZXJzID0gZ2V0\nSm9pbmVkU3VwZXJzKHNlbCwgbWFwcGluZywgc3Vicywgb3V0ZXIpOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICAvLyBjcmVhdGUgYWxsIG91ciBlYWdl\nciBzZWxlY3RzIHNvIHRoYXQgdGhvc2UgZmllbGRzIGFyZSByZXNlcnZlZAog\nICAgICAgIC8vIGFuZCBjYW5ub3QgYmUgcmV1c2VkIGR1cmluZyB0aGUgYWN0\ndWFsIGVhZ2VyIHNlbGVjdCBwcm9jZXNzLAogICAgICAgIC8vIHByZXZlbnRp\nbmcgaW5maW5pdGUgcmVjdXJzaW9uCiAgICAgICAgZWFnZXIgPSBNYXRoLm1p\nbihlYWdlciwgZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUoKSk7CiAgICAgICAg\nRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxlY3Rz\nKHNlbCwgbWFwcGluZywgc20sIGZpZWxkcywKICAgICAgICAgICAgZmV0Y2gs\nIGVhZ2VyKTsKCiAgICAgICAgLy8gc2VsZWN0IGFsbCBiYXNlIGNsYXNzIG1h\ncHBpbmdzOyBkbyB0aGlzIGFmdGVyIGJhdGNoaW5nIHNvIHRoYXQKICAgICAg\nICAvLyB0aGUgam9pbnMgbmVlZGVkIGJ5IHRoZXNlIHNlbGVjdHMgZG9uJ3Qg\nZ2V0IGluIHRoZSBXSEVSRSBjbGF1c2UKICAgICAgICAvLyBvZiB0aGUgYmF0\nY2hlZCBzZWxlY3RzCiAgICAgICAgaW50IHNlbGQgPSBzZWxlY3RCYXNlTWFw\ncGluZ3Moc2VsLCBtYXBwaW5nLCBtYXBwaW5nLCBzbSwgZmllbGRzLAogICAg\nICAgICAgICBmZXRjaCwgZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9p\nbmVkU3VwZXJzKTsKCiAgICAgICAgLy8gc2VsZWN0IGVhZ2VyIHRvLW1hbnkg\ncmVsYXRpb25zIGxhc3QgYmVjYXVzZSBkdXJpbmcgbG9hZCB0aGV5CiAgICAg\nICAgLy8gYWR2YW5jZSB0aGUgcmVzdWx0IHNldCBhbmQgY291bGQgZXhoYXVz\ndCBpdCwgc28gbm8gb3RoZXIgbWFwcGluZ3MKICAgICAgICAvLyBjYW4gbG9h\nZCBhZnRlcndvcmRzCiAgICAgICAgaWYgKGVhZ2VyVG9NYW55ICE9IG51bGwp\nCiAgICAgICAgICAgIGVhZ2VyVG9NYW55LnNlbGVjdEVhZ2VySm9pbihzZWws\nIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIGZldGNoLnRyYXZlcnNlSkRC\nQyhlYWdlclRvTWFueSksIGVhZ2VyKTsKCiAgICAgICAgLy8gb3B0aW9uYWxs\neSBzZWxlY3Qgc3ViY2xhc3MgbWFwcGluZ3MKICAgICAgICBpZiAoc3VicyA9\nPSBTZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJzID09IFNlbGVjdC5TVUJT\nX0FOWV9KT0lOQUJMRSkKICAgICAgICAgICAgc2VsZWN0U3ViY2xhc3NNYXBw\naW5ncyhzZWwsIG1hcHBpbmcsIHNtLCBmZXRjaCk7CiAgICAgICAgaWYgKHNt\nICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5zZXREaXN0aW5jdChmYWxzZSk7\nCiAgICAgICAgcmV0dXJuIHNlbGQgPiAwOwogICAgfQoKICAgIHByaXZhdGUg\nYm9vbGVhbiBnZXRKb2luZWRTdXBlcnMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIGludCBzdWJzLCBib29sZWFuIG91dGVyKSB7CiAgICAg\nICAgbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7IAogICAgICAgIEpvaW5zIGpv\naW5zID0gKG91dGVyKSA/IHNlbC5uZXdPdXRlckpvaW5zKCkgOiBudWxsOwog\nICAgICAgIHJldHVybiBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5hZGRD\nbGFzc0NvbmRpdGlvbnMoc2VsLCBzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5B\nQkxFLCBqb2lucyk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgYm9vbGVhbiBu\nZWVkQ2xhc3NDb25kaXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBz\ndWJzLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAg\nICBib29sZWFuIHJldFZhbCA9IGZhbHNlOwogICAgICAgIGlmKHNtID09IG51\nbGwgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKSB7\nCiAgICAgICAgICAgIGlmKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUg\nfHwgc3VicyA9PSBTZWxlY3QuU1VCU19OT05FKSB7CiAgICAgICAgICAgICAg\nICByZXRWYWwgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmcuZ2V0RGlzY3JpbWlu\nYXRvcigpICE9IG51bGwKICAgICAgICAgICAgICAgICAgICAmJiBTdXBlcmNs\nYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzLmlzSW5zdGFuY2UobWFw\ncGluZy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0U3RyYXRlZ3koKSkKICAgICAg\nICAgICAgICAgICAgICAmJiBtYXBwaW5nLmdldE1hcHBpbmdSZXBvc2l0b3J5\nKCkuZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5j\nZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTdXBlcmNsYXNzRGlz\nY3JpbWluYXRvclN0cmF0ZWd5QnlEZWZhdWx0KCkpIHsKICAgICAgICAgICAg\nICAgICAgICByZXRWYWwgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXRWYWw7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogTWFyayB0aGUgZmllbGRzIG9mIHRo\naXMgbWFwcGluZyBhcyByZXNlcnZlZCBzbyB0aGF0IGVhZ2VyIGZldGNoZXMg\nY2FuJ3QKICAgICAqIGdldCBpbnRvIGluZmluaXRlIHJlY3Vyc2l2ZSBzaXR1\nYXRpb25zLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFwcGluZyBjcmVh\ndGVFYWdlclNlbGVjdHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZp\nZWxkcywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBp\nbnQgZWFnZXIpIHsKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8IGVh\nZ2VyID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxkTWFwcGluZyBl\nYWdlclRvTWFueSA9IGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWwsIAogICAgICAg\nICAgICBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nLCBzbSwgZmllbGRzLCBmZXRjaCwgZWFnZXIpOwoKICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNlbC5oYXNFYWdl\nckpvaW4oZmFsc2UpOwogICAgICAgIGludCBzZWxzOwogICAgICAgIGludCBq\ndHlwZTsKICAgICAgICBpbnQgbW9kZTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtb2RlID0g\nZm1zW2ldLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIGlmICht\nb2RlID09IGZldGNoLkVBR0VSX05PTkUpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgaWYgKCFyZXF1aXJlc1NlbGVjdChmbXNbaV0s\nIHNtLCBmaWVsZHMsIGZldGNoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRoIGpvaW4gZmly\nc3QKICAgICAgICAgICAganR5cGUgPSAoZm1zW2ldLmdldE51bGxWYWx1ZSgp\nID09IGZtc1tpXS5OVUxMX0VYQ0VQVElPTikgCiAgICAgICAgICAgICAgICA/\nIHNlbC5FQUdFUl9JTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsKICAgICAgICAg\nICAgaWYgKG1vZGUgIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwgJiYgIWZtc1tp\nXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYmIGZt\nc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0\nY2gpID4gMAogICAgICAgICAgICAgICAgJiYgc2VsLmVhZ2VyQ2xvbmUoZm1z\nW2ldLCBqdHlwZSwgZmFsc2UsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIGJvb2xlYW4gaGFzSm9pbiA9IGZl\ndGNoLmhhc0pvaW4oZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgogICAg\nICAgICAgICAvLyBpZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBwcmVmZXJyZWQg\nc2VsZWN0IG1vZGUgb2Ygam9pbiBvciBkb2VzIG5vdAogICAgICAgICAgICAv\nLyBoYXZlIGEgcHJlZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRvaW5nIGEgYnkt\naWQgbG9va3VwLCB0cnkKICAgICAgICAgICAgLy8gdG8gdXNlIGEgdG8tbWFu\neSBqb2luIGFsc28uICBjdXJyZW50bHkgd2UgbGltaXQgZWFnZXIKICAgICAg\nICAgICAgLy8gb3V0ZXIgam9pbnMgdG8gbm9uLUxSUywgbm9uLXJhbmdlZCBz\nZWxlY3RzIHRoYXQgZG9uJ3QgYWxyZWFkeQogICAgICAgICAgICAvLyBoYXZl\nIGFuIGVhZ2VyIHRvLW1hbnkgam9pbgogICAgICAgICAgICBpZiAoKGhhc0pv\naW4gfHwgbW9kZSA9PSBmZXRjaC5FQUdFUl9KT0lOIAogICAgICAgICAgICAg\nICAgfHwgKG1vZGUgPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAhPSBudWxsKSkK\nICAgICAgICAgICAgICAgICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55\nKCkKICAgICAgICAgICAgICAgICYmICFpbkVhZ2VySm9pbgogICAgICAgICAg\nICAgICAgJiYgIXNlbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAgICAgICAgICAg\nICAgICYmICghc2VsLmdldEF1dG9EaXN0aW5jdCgpIHx8ICghc2VsLmlzTFJT\nKCkKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRTdGFydEluZGV4KCkgPT0g\nMCAKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09IExv\nbmcuTUFYX1ZBTFVFKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5zdXBw\nb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4gMCkg\newogICAgICAgICAgICAgICAgaWYgKHNlbC5lYWdlckNsb25lKGZtc1tpXSwg\nanR5cGUsIHRydWUsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIGZpbmFsbHksIHRyeSBwYXJhbGxlbAogICAgICAgICAg\nICBpZiAoZWFnZXIgPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwKICAgICAgICAg\nICAgICAgICYmIChzZWxzID0gZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwg\nc2VsLkVBR0VSX1BBUkFMTEVMLCBzbSwKICAgICAgICAgICAgICAgIHRoaXMs\nIGZldGNoKSkgIT0gMCkKICAgICAgICAgICAgICAgIHNlbC5lYWdlckNsb25l\nKGZtc1tpXSwgU2VsZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAgICAgICAgICAg\nICAgICAgICBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpLCBzZWxzKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoK\nICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZlbiBmaWVsZCBu\nZWVkcyB0byBiZSBzZWxlY3RlZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgYm9vbGVhbiByZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBpbmcgZm0sCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChm\naWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5nZXQo\nZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20u\nZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAgICAgICAgICAg\nICYmIHNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBmZXRjaC5yZXF1\naXJlc0ZldGNoKGZtKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTE9B\nRDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZmllbGQgbWFw\ncGluZ3Mgb2YgdGhlIGdpdmVuIGNsYXNzIGFuZCBhbGwgaXRzIHN1cGVyY2xh\nc3Nlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3QgdG8g\ndXNlCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbW9zdC1kZXJpdmVkIHR5\ncGUgdG8gc2VsZWN0IGZvcgogICAgICogQHBhcmFtIG9yaWcgdGhlIG9yaWdp\nbmFsIG1hcHBpbmcgdHlwZSBzZWxlY3RlZAogICAgICogQHBhcmFtIHNtIHRo\nZSBpbnN0YW5jZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYgbm9u\nZQogICAgICogQHBhcmFtIGZpZWxkcyB0aGUgZmllbGRzIHRvIGxvYWQKICAg\nICAqIEBwYXJhbSBmZXRjaCBmZXRjaCBjb25maWd1cmF0aW9uIHRvIHVzZSBm\nb3IgbG9hZGluZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciB0aGUg\nZWFnZXIgZmV0Y2ggbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBqb2luZWQg\nd2hldGhlciB0aGUgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBqb2luZWQgZG93\nbiB0bwogICAgICogaXRzIGJhc2UgY2xhc3MKICAgICAqIEByZXR1cm4gJmd0\nOyAwIGlmIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIDAgaWYgZGF0YSB3YXMK\nICAgICAqIHNlbGVjdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQsIGFuZCAmbHQ7\nIDAgaWYgbm90aGluZyB3YXMgc2VsZWN0ZWQKICAgICAqLwogICAgcHJpdmF0\nZSBpbnQgc2VsZWN0QmFzZU1hcHBpbmdzKFNlbGVjdCBzZWwsIENsYXNzTWFw\ncGluZyBtYXBwaW5nLAogICAgICAgIENsYXNzTWFwcGluZyBvcmlnLCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwgRmllbGRN\nYXBwaW5nIGVhZ2VyVG9NYW55LAogICAgICAgIGJvb2xlYW4gaWRlbnQsIGJv\nb2xlYW4gam9pbmVkKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVudCA9\nIG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAg\nICAgICAgaWYgKHBhcmVudCA9PSBudWxsICYmICFtYXBwaW5nLmlzTWFwcGVk\nKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoInZpcnR1YWwtbWFwcGluZyIsIG1hcHBpbmcuCiAgICAg\nICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkpKTsKCiAgICAgICAgaW50\nIHNlbGQgPSAtMTsKICAgICAgICBpbnQgcHNlbGQgPSAtMTsKCiAgICAgICAg\nLy8gYmFzZSBjbGFzcyBzZWxlY3RzIHBrcywgZXRjCiAgICAgICAgaWYgKHBh\ncmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNl\nLCBzZWxlY3QgcGtzCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZiAoaWRlbnQpCiAgICAgICAgICAgICAgICAgICAg\nc2VsLnNlbGVjdElkZW50aWZpZXIobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29s\ndW1ucygpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBzZWwuc2VsZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMo\nKSk7CiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaWYgbm8gaW5zdGFuY2Ugb3Igbm90IGluaXRpYWxp\nemVkIGFuZCBub3QgZXhhY3Qgb2lkLCBzZWxlY3QgdHlwZQogICAgICAgICAg\nICBpZiAoKHNtID09IG51bGwgfHwgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0\nYXRlLlRSQU5TSUVOVCAKICAgICAgICAgICAgICAgICYmICghKHNtLmdldE9i\namVjdElkKCkgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIAogICAgICAgICAgICAg\nICAgfHwgKChPcGVuSlBBSWQpIHNtLmdldE9iamVjdElkKCkpLmhhc1N1YmNs\nYXNzZXMoKSkpKQogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXREaXNj\ncmltaW5hdG9yKCkuc2VsZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAgICAg\nICBzZWxkID0gMTsKCiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNlIG9y\nIG5vIHZlcnNpb24sIHNlbGVjdCB2ZXJzaW9uCiAgICAgICAgICAgIGlmICgo\nc20gPT0gbnVsbCB8fCBzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICYmIG1hcHBpbmcuZ2V0VmVyc2lvbigpLnNlbGVjdChzZWws\nIG9yaWcpKQogICAgICAgICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgLy8gcmVjdXJzZSBvbiBwYXJlbnQKICAgICAg\nICAgICAgcHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBwYXJlbnQs\nIG9yaWcsIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBmZXRjaCwgZWFn\nZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZ3MgaW4gdGhlIGdpdmVuIGZp\nZWxkcyBzZXQsIG9yIGJhc2VkIG9uIGZldGNoCiAgICAgICAgLy8gY29uZmln\ndXJhdGlvbiBpZiBubyBmaWVsZHMgZ2l2ZW4KICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgU2VsZWN0RXhlY3V0b3IgZXNlbDsKICAgICAgICBpbnQgZnNl\nbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgLy8gc2tpcCBlYWdlciB0by1tYW55IHNlbGVj\ndDsgd2UgZG8gdGhhdCBzZXBhcmF0ZWx5IGluIGNhbGxpbmcKICAgICAgICAg\nICAgLy8gbWV0aG9kCiAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gZWFnZXJU\nb01hbnkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nIC8vIGNoZWNrIGZvciBlYWdlciBzZWxlY3QKICAgICAgICAgICAgZXNlbCA9\nIHNlbC5nZXRFYWdlcihmbXNbaV0pOwogICAgICAgICAgICBpZiAoZXNlbCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZXNlbCA9PSBzZWwpCiAg\nICAgICAgICAgICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VySm9pbihzZWws\nIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVy\nc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJQYXJhbGxl\nbChlc2VsLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZldGNo\nLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAg\nICBzZWxkID0gTWF0aC5tYXgoMCwgc2VsZCk7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAocmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmllbGRzLCBmZXRj\naCkpIHsKICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChz\nZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJz\nZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2VsZCA9\nIE1hdGgubWF4KGZzZWxkLCBzZWxkKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChvcHRTZWxlY3QoZm1zW2ldLCBzZWwsIHNtLCBmZXRjaCkpIHsKICAgICAg\nICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0aGlz\nLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ld\nKSwgZmV0Y2guRUFHRVJfTk9ORSk7CgogICAgICAgICAgICAgICAgLy8gZG9u\nJ3QgdXBncmFkZSBzZWxkIHRvID4gMCBiYXNlZCBvbiB0aGVzZSBmaWVsZHMs\nIHNpbmNlCiAgICAgICAgICAgICAgICAvLyB0aGV5J3JlIG5vdCBpbiB0aGUg\nY2FsY3VsYXRlZCBmaWVsZCBzZXQKICAgICAgICAgICAgICAgIGlmIChmc2Vs\nZCA+PSAwICYmIHNlbGQgPCAwKQogICAgICAgICAgICAgICAgICAgIHNlbGQg\nPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpbiBj\nZXJ0YWluIGNpcmN1bXN0YW5jZXMgZm9yY2Ugam9pbiB0byBzdXBlcmNsYXNz\nIHRhYmxlIHRvIGF2b2lkCiAgICAgICAgLy8gU1FMIGdlbmVyYXRpb24gZXJy\nb3IuCiAgICAgICAgaWYgKCBlYWdlclRvTWFueSAhPSBudWxsICYmIHBzZWxk\nIDwgMCAmJiBzZWxkID4gMCAmJiAham9pbmVkCiAgICAgICAgICAgICAgICAm\nJiBwYXJlbnQgIT0gbnVsbCApIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5n\nW10gcGZtcyA9IHBhcmVudC5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBmbXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGlmIChwZm1zW2ldID09IGVhZ2VyVG9N\nYW55ICkgewogICAgICAgICAgICAgICAgICAgIHBzZWxkID0gMDsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBqb2luIHRv\nIHBhcmVudCB0YWJsZSBpZiB0aGUgcGFyZW50IC8gYW55IGFuY2VzdG9ycyBo\nYXZlIHNlbGVjdGVkCiAgICAgICAgLy8gYW55dGhpbmcKICAgICAgICBpZiAo\nIWpvaW5lZCAmJiBwc2VsZCA+PSAwICYmIHBhcmVudC5nZXRUYWJsZSgpICE9\nIG1hcHBpbmcuZ2V0VGFibGUoKSkKICAgICAgICAgICAgc2VsLndoZXJlKG1h\ncHBpbmcuam9pblN1cGVyY2xhc3Moc2VsLm5ld0pvaW5zKCksIGZhbHNlKSk7\nCgogICAgICAgIC8vIHJldHVybiB0aGUgaGlnaGVzdCB2YWx1ZQogICAgICAg\nIHJldHVybiBNYXRoLm1heChwc2VsZCwgc2VsZCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGVuIHNlbGVjdGluZyBmaWVsZGVzLCBhIHNwZWNpYWwgY2Fz\nZSBpcyBtYWRlIGZvciBtYXBwaW5ncyB0aGF0IHVzZQogICAgICogMi1wYXJ0\nIHNlbGVjdHMgdGhhdCBhcmVuJ3QgZXhwbGljaXRseSAqbm90KiBpbiB0aGUg\nZGZnIHNvIHRoYXQgdGhleQogICAgICogY2FuIGdldCB0aGVpciBwcmltYXJ5\nIHRhYmxlIGRhdGEuIFRoaXMgbWV0aG9kIHRlc3RzIGZvciB0aGF0IHNwZWNp\nYWwKICAgICAqIGNhc2UgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gb3B0U2VsZWN0KEZpZWxkTWFwcGluZyBmbSwg\nU2VsZWN0IHNlbCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJu\nICFmbS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAgICAgJiYg\nIWZtLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdCgpCiAgICAgICAgICAg\nICYmIChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRl\nLlRSQU5TSUVOVCAKICAgICAgICAgICAgfHwgIXNtLmdldExvYWRlZCgpLmdl\ndChmbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgJiYgZm0uc3VwcG9ydHNT\nZWxlY3Qoc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMsIGZldGNo\nKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZmllbGQgbWFw\ncGluZ3MgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlv\nbiBmb3IKICAgICAqIHN1YmNsYXNzZXMgb2YgdGhlIGdpdmVuIHR5cGUuCiAg\nICAgKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVzZQogICAg\nICogQHBhcmFtIG1hcHBpbmcgdGhlIHR5cGUgd2hvc2Ugc3ViY2xhc3NlcyB0\nbyBzZWxlY3QKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFuY2UgYmVpbmcg\nc2VsZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAgICAqIEBwYXJhbSBm\nZXRjaCB0aGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhTZWxlY3Qgc2VsLCBD\nbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7CiAgICAgICAgQ2xhc3NNYXBw\naW5nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdWJj\nbGFzc01hcHBpbmdzKCk7CiAgICAgICAgaWYgKHN1Yk1hcHBpbmdzLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHNlbGVj\ndCBhbGwgc3ViY2xhc3MgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZmV0Y2gg\nY29uZmlndXJhdGlvbgogICAgICAgIC8vIGFuZCB3aG9zZSB0YWJsZSBpcyBp\nbiB0aGUgbGlzdCBvZiB0aG9zZSBzZWxlY3RlZCBzbyBmYXI7IHRoaXMKICAg\nICAgICAvLyB3YXkgd2Ugc2VsZWN0IHRoZSBtYXggcG9zc2libGUgd2l0aG91\ndCBzZWxlY3RpbmcgYW55IHRhYmxlcyB0aGF0CiAgICAgICAgLy8gYXJlbid0\nIHByZXNlbnQgaW4gYWxsIHBvc3NpYmxlIHF1ZXJ5IG1hdGNoZXM7IGEgc3Bl\nY2lhbCBjYXNlCiAgICAgICAgLy8gaXMgbWFkZSBmb3IgbWFwcGluZ3MgdGhh\ndCB1c2UgMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QKICAgICAgICAvLyBl\neHBsaWNpdGx5ICpub3QqIGluIHRoZSBkZWZhdWx0IHNvIHRoYXQgdGhleSBj\nYW4gZ2V0IHRoZWlyCiAgICAgICAgLy8gcHJpbWFyeSB0YWJsZSBkYXRhCiAg\nICAgICAgRmllbGRNYXBwaW5nW10gZm1zOwogICAgICAgIGJvb2xlYW4gam9p\nbmVkOwogICAgICAgIGJvb2xlYW4gY2FuSm9pbiA9IF9kaWN0LmpvaW5TeW50\nYXggIT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTAogICAgICAg\nICAgICAmJiBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAh\nPSBmZXRjaC5FQUdFUl9OT05FOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgc3ViTWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKCFzdWJNYXBwaW5nc1tpXS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20s\nIHRoaXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICBmZXRjaCkpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxp\nemUgc28gdGhhdCBpZiB3ZSBjYW4ndCBqb2luLCB3ZSBwcmV0ZW5kIHdlIGFs\ncmVhZHkgaGF2ZQogICAgICAgICAgICBqb2luZWQgPSAhY2FuSm9pbjsKICAg\nICAgICAgICAgZm1zID0gc3ViTWFwcGluZ3NbaV0uZ2V0RGVmaW5lZEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBm\nbXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3Vy\nZSBpbiBvbmUgb2YgY29uZmlndXJlZCBmZXRjaCBncm91cHMKICAgICAgICAg\nICAgCWlmIChmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tqXSkgIT0gRmV0Y2hD\nb25maWd1cmF0aW9uLkZFVENIX0xPQUQKICAgICAgICAgICAgICAgICAgICAm\nJiAoKCFmbXNbal0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAg\nICAgICAgICAgICAgJiYgZm1zW2pdLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBs\naWNpdCgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZtc1tqXS5zdXBwb3J0\nc1NlbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhpcywgCiAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gpIDw9IDApKSAKICAgICAgICAgICAg\nCQljb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBjYW4gam9p\nbiB0byB0aGUgc3ViY2xhc3MsIGRvIHNvOyBtdWNoIGJldHRlciBjaGFuY2UK\nICAgICAgICAgICAgICAgIC8vIHRoYXQgdGhlIGZpZWxkIHdpbGwgYmUgYWJs\nZSB0byBzZWxlY3QgaXRzZWxmIHdpdGhvdXQgam9pbnMKICAgICAgICAgICAg\nICAgIGlmICgham9pbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFy\nayBqb2luZWQgd2hldGhlciBvciBub3Qgd2Ugam9pbiwgc28gd2UgZG9uJ3Qg\naGF2ZSB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgY29uZGl0aW9u\ncyBhZ2FpbiBmb3IgdGhpcyBzdWJjbGFzcwogICAgICAgICAgICAgICAgICAg\nIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsLndoZXJl\nKGpvaW5TdWJjbGFzcyhzZWwsIG1hcHBpbmcsIHN1Yk1hcHBpbmdzW2ldLCBu\ndWxsKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g\naWYgY2FuIHNlbGVjdCB3aXRoIHRhYmxlcyBhbHJlYWR5IHNlbGVjdGVkLCBk\nbyBpdAogICAgICAgICAgICAgICAgaWYgKGZtc1tqXS5zdXBwb3J0c1NlbGVj\ndChzZWwsIHNlbC5UWVBFX0pPSU5MRVNTLCBzbSwgdGhpcywKICAgICAgICAg\nICAgICAgICAgICBmZXRjaCkgPiAwKQogICAgICAgICAgICAgICAgICAgIGZt\nc1tqXS5zZWxlY3Qoc2VsLCBudWxsLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpE\nQkMoZm1zW2pdKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2guRUFH\nRVJfTk9ORSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGpvaW4gZnJvbSBjbGFzcyB0\nbyBpdHMgc3ViY2xhc3MuIFJlY3Vyc2l2ZSB0byBhbGxvdwogICAgICogZm9y\nIG11bHRpcGxlIGhvcHMsIHN0YXJ0aW5nIGZyb20gdGhlIGJhc2UgY2xhc3Mu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpvaW5zIGpvaW5TdWJjbGFz\ncyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgYmFzZSwKICAgICAgICBDbGFz\nc01hcHBpbmcgc3ViLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChzdWIg\nPT0gYmFzZSB8fCBzdWIuZ2V0VGFibGUoKSA9PSBiYXNlLmdldFRhYmxlKCkK\nICAgICAgICAgICAgfHwgc2VsLmlzU2VsZWN0ZWQoc3ViLmdldFRhYmxlKCkp\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gcmVjdXJz\nZSBmaXJzdCBzbyB3ZSBnbyBsZWFzdC0+bW9zdCBkZXJpdmVkCiAgICAgICAg\nQ2xhc3NNYXBwaW5nIHN1cCA9IHN1Yi5nZXRKb2luYWJsZVBDU3VwZXJjbGFz\nc01hcHBpbmcoKTsKICAgICAgICBqb2lucyA9IGpvaW5TdWJjbGFzcyhzZWws\nIGJhc2UsIHN1cCwgam9pbnMpOwogICAgICAgIGlmIChqb2lucyA9PSBudWxs\nKQogICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygpOwogICAgICAg\nIHJldHVybiBzdWIuam9pblN1cGVyY2xhc3Moam9pbnMsIHRydWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogTWFrZXMgc3VyZSBhbGwgc3ViY2xhc3NlcyBv\nZiB0aGUgZ2l2ZW4gdHlwZSBhcmUgbG9hZGVkIGluIHRoZSBKVk0uCiAgICAg\nKiBUaGlzIGlzIHVzdWFsbHkgZG9uZSBhdXRvbWF0aWNhbGx5LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBsb2FkU3ViY2xhc3NlcyhDbGFzc01hcHBpbmcg\nbWFwcGluZykgewogICAgICAgIERpc2NyaW1pbmF0b3IgZHNjID0gbWFwcGlu\nZy5nZXREaXNjcmltaW5hdG9yKCk7CiAgICAgICAgaWYgKGRzYy5nZXRTdWJj\nbGFzc2VzTG9hZGVkKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gaWYgdGhlIHN1YmNsYXNzIGxpc3QgaXMgc2V0LCBubyBuZWVkIHRvIGxv\nYWQgc3VicwogICAgICAgIGlmIChtYXBwaW5nLmdldFJlcG9zaXRvcnkoKS5n\nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAgICAgICAgICBfY3R4\nLmdldENsYXNzTG9hZGVyKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgZHNj\nLnNldFN1YmNsYXNzZXNMb2FkZWQodHJ1ZSk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRzYy5s\nb2FkU3ViY2xhc3Nlcyh0aGlzKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05v\ndEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFN0b3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25z\nLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSB0aGUgc3RhdGVtZW50IGEgY2FuZGlkYXRlIGZvciBj\nYW5jZWxsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZvcmVF\neGVjdXRlU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIF9z\ndG1udHMuYWRkKHN0bW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZSB0aGUgc3RhdGVtZW50IGZyb20gdGhlIGNhbmNlbGxhYmxlIHNldC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFmdGVyRXhlY3V0ZVN0YXRlbWVudChT\ndGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3RtbnRzLnJlbW92ZShzdG1u\ndCk7CiAgICB9CiAgICAKICAgIEZpbmRlclF1ZXJ5SW1wbCBnZXRGaW5kZXIo\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIEZpbmRlckNhY2hlIGNhY2hlID0gZ2V0RmluZGVyQ2Fj\naGUoKTsKICAgICAgICByZXR1cm4gY2FjaGUgPT0gbnVsbCAKICAgICAgICAg\nICAgID8gbnVsbCA6IChGaW5kZXJRdWVyeUltcGwpY2FjaGUuZ2V0KG1hcHBp\nbmcsIGZldGNoKTsKICAgIH0KICAgIAogICAgYm9vbGVhbiBjYWNoZUZpbmRl\ncihDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0RXhlY3V0b3Igc2VsZWN0\nLCAKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAg\nICBGaW5kZXJDYWNoZSBjYWNoZSA9IGdldEZpbmRlckNhY2hlKCk7CiAgICAg\nICAgcmV0dXJuIGNhY2hlICE9IG51bGwgJiYgY2FjaGUuY2FjaGUobWFwcGlu\nZywgc2VsZWN0LCBmZXRjaCkgIT0gbnVsbDsKICAgIH0KICAgIAogICAgRmlu\nZGVyQ2FjaGUgZ2V0RmluZGVyQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuICgo\nKEJyb2tlckltcGwpZ2V0Q29udGV4dCgpKS5nZXRDYWNoZUZpbmRlclF1ZXJ5\nKCkpCiAgICAgICAgICAgICA/IGdldENvbmZpZ3VyYXRpb24oKS5nZXRGaW5k\nZXJDYWNoZUluc3RhbmNlKCkgOiBudWxsOwogICAgfQoKCiAgICAvKioKICAg\nICAqIENvbm5lY3Rpb24gcmV0dXJuZWQgdG8gY2xpZW50IGNvZGUuIE1ha2Vz\nIHN1cmUgaXRzIHdyYXBwZWQgY29ubmVjdGlvbgogICAgICogcmVmIGNvdW50\nIGlzIGRlY3JlbWVudGVkIG9uIGZpbmFsaXplLgogICAgICovCiAgICBwdWJs\naWMgYWJzdHJhY3Qgc3RhdGljIGNsYXNzIENsaWVudENvbm5lY3Rpb24gZXh0\nZW5kcwogICAgICAgICAgICBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAg\nICAgIHByaXZhdGUgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CgogICAgICAg\nIHB1YmxpYyBDbGllbnRDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikgewog\nICAgICAgICAgICBzdXBlcihjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIF9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBzdXBlci5jbG9z\nZSgpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZmluYWxp\nemUoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKCFf\nY2xvc2VkKQogICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHdyYXBwZXIgdGhhdCBr\nZWVwcyBhbiBpbnRlcm5hbCByZWYgY291bnQgc28gdGhhdCBpdCBrbm93cwog\nICAgICogd2hlbiB0byByZWFsbHkgY2xvc2UuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBhYnN0cmFjdCBjbGFzcyBSZWZDb3VudENvbm5lY3Rpb24gZXh0ZW5k\ncyBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAgICAgIHByaXZhdGUgYm9v\nbGVhbiBfcmV0YWluID0gZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX3Jl\nZnMgPSAwOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfZnJlZWQgPSBmYWxz\nZTsKCiAgICAgICAgcHVibGljIFJlZkNvdW50Q29ubmVjdGlvbihDb25uZWN0\naW9uIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXRhaW4oKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcmV0YWluOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgc2V0UmV0YWluKGJvb2xlYW4gcmV0YWluKSB7CiAgICAgICAg\nICAgIGlmIChfcmV0YWluICYmICFyZXRhaW4gJiYgX3JlZnMgPD0gMCkKICAg\nICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAgX3JldGFpbiA9IHJl\ndGFpbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlZigpIHsK\nICAgICAgICAgICAgLy8gZG9uJ3QgaGF2ZSB0byBsb2NrOyBjYWxsZWQgZnJv\nbSBjb25uZWN0KCksIHdoaWNoIGlzIGxvY2tlZAogICAgICAgICAgICBfcmVm\ncysrOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8gbG9jayBhdCBi\ncm9rZXIgbGV2ZWwgdG8gYXZvaWQgZGVhZGxvY2tzCiAgICAgICAgICAgIF9j\ndHgubG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nX3JlZnMtLTsKICAgICAgICAgICAgICAgIGlmIChfcmVmcyA8PSAwICYmICFf\ncmV0YWluKQogICAgICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAg\nICogTm9uLXRocmVhZC1zYWZlIG1ldGhvZC4gIEVuc3VyZSBwcm90ZWN0aW9u\nIGluIHRoZSBjYWxsIHBhdGguLi4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgdm9pZCBmcmVlKCkgewogICAgICAgICAgICAvLyBlbnN1cmUgdGhhdCB3\nZSBkbyBub3QgY2xvc2UgdGhlIHVuZGVybHlpbmcgY29ubmVjdGlvbgogICAg\nICAgICAgICAvLyBtdWx0aXBsZSB0aW1lczsgdGhpcyBjb3VsZCBoYXBwZW4g\naWYgc29tZW9uZSAoZS5nLiwgYW4KICAgICAgICAgICAgLy8gRXh0ZW50KSBo\nb2xkcyBhIFJlZkNvbm5lY3Rpb24sIGFuZCB0aGVuIGNsb3NlcyBpdCAoZS5n\nLiwgaW4KICAgICAgICAgICAgLy8gdGhlIGZpbmFsaXplcikgYWZ0ZXIgdGhl\nIFN0b3JlTWFuYWdlciBoYXMgYWxyZWFkeSBiZWVuIGNsb3NlZC4KICAgICAg\nICAgICAgaWYgKF9mcmVlZCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnZXREZWxlZ2F0ZSgp\nLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkgewogICAgICAgICAgICB9CiAgICAgICAgICAgIF9mcmVlZCA9IHRydWU7\nCiAgICAgICAgICAgIF9jb25uID0gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGJvb2xlYW4g\nd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVy\nbiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFN0\nYXRlbWVudEltcGwsIEpEQkNTdG9yZU1hbmFnZXIudGhpcywKICAgICAgICAg\nICAgICAgICAgICBzdXBlci5jcmVhdGVTdGF0ZW1lbnQoZmFsc2UpLCBSZWZD\nb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90\nZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudChpbnQgcnNUeXBlLCBp\nbnQgcnNDb25jdXIsCiAgICAgICAgICAgIGJvb2xlYW4gd3JhcCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNs\nYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFN0YXRlbWVudEltcGws\nIEpEQkNTdG9yZU1hbmFnZXIudGhpcywKICAgICAgICAgICAgICAgICAgICBz\ndXBlci5jcmVhdGVTdGF0ZW1lbnQocnNUeXBlLCByc0NvbmN1ciwgZmFsc2Up\nLCBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAg\nICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVu\ndChTdHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gQ29uY3JldGVD\nbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShjYW5jZWxQcmVwYXJlZFN0YXRl\nbWVudEltcGwsCiAgICAgICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdl\nci50aGlzLCBzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgZmFsc2UpLCBS\nZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChT\ndHJpbmcgc3FsLCBpbnQgcnNUeXBlLAogICAgICAgICAgICBpbnQgcnNDb25j\ndXIsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3Rh\nbmNlCiAgICAgICAgICAgICAgICAoY2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnRJ\nbXBsLAogICAgICAgICAgICAgICAgICAgIEpEQkNTdG9yZU1hbmFnZXIudGhp\ncywgc3VwZXIucHJlcGFyZVN0YXRlbWVudChzcWwsIHJzVHlwZSwgcnNDb25j\ndXIsIGZhbHNlKSwKICAgICAgICAgICAgICAgICAgICBSZWZDb3VudENvbm5l\nY3Rpb24udGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCByZW1vdmVzIGl0c2VsZiBm\ncm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1lbnRzIHNvIHRo\nYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYWJzdHJhY3QgY2xhc3MgQ2FuY2VsU3RhdGVtZW50IGV4dGVuZHMgRGVsZWdh\ndGluZ1N0YXRlbWVudCB7CgogICAgICAgIHB1YmxpYyBDYW5jZWxTdGF0ZW1l\nbnQoU3RhdGVtZW50IHN0bW50LCBDb25uZWN0aW9uIGNvbm4pIHsKICAgICAg\nICAgICAgc3VwZXIoc3RtbnQsIGNvbm4pOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBzcWwpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVt\nZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoc3FsKTsKICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRl\nbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\ncHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoU3RyaW5nIHNxbCwg\nYm9vbGVhbiB3cmFwKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBl\nci5leGVjdXRlUXVlcnkoc3FsLCB3cmFwKTsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0\naGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFN0YXRlbWVudCB0eXBlIHRoYXQgYWRkcyBhbmQgcmVtb3ZlcyBp\ndHNlbGYgZnJvbSB0aGUgc2V0IG9mIGFjdGl2ZQogICAgICogc3RhdGVtZW50\ncyBzbyB0aGF0IGl0IGNhbiBiZSBjYW5jZWxlZC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGFic3RyYWN0IGNsYXNzIENhbmNlbFByZXBhcmVkU3RhdGVtZW50\nIGV4dGVuZHMKICAgICAgICAgICAgRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVt\nZW50IHsKCiAgICAgICAgcHVibGljIENhbmNlbFByZXBhcmVkU3RhdGVtZW50\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCAKICAgICAgICAgICAgQ29ubmVj\ndGlvbiBjb25uKSB7CiAgICAgICAgICAgIHN1cGVyKHN0bW50LCBjb25uKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVj\ndXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0\nZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoYm9vbGVh\nbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVm\nb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlUXVlcnkod3Jh\ncCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBh\nZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBpbnRbXSBleGVjdXRlQmF0Y2goKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0\nZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlQmF0Y2goKTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0\nYXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nfQoK\n","encoding":"base64"}

