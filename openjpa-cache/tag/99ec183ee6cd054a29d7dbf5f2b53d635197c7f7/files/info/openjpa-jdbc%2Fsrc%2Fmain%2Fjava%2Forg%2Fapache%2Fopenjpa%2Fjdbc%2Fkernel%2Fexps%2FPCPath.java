{"sha":"ea59e783621cec4da6c9386c60277bb94c871dc7","node_id":"MDQ6QmxvYjIwNjM2NDplYTU5ZTc4MzYyMWNlYzRkYTZjOTM4NmM2MDI3N2JiOTRjODcxZGM3","size":42162,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ea59e783621cec4da6c9386c60277bb94c871dc7","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc3Fs\nLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3RJdGVyYXRvcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5P\nYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZVF1ZXJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1pbmF0\nb3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxk\nTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLkhhbmRsZXJDb2xsZWN0aW9uVGFibGVGaWVsZFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuSGFuZGxlckhhbmRsZXJNYXBUYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5MUlNNYXBG\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlNjaGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkJyb2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nRmlsdGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3Bl\nbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkNhbmRpZGF0ZVBhdGg7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLlhNTE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioKICogQSBwYXRoIHJl\ncHJlc2VudHMgYSB0cmF2ZXJzYWwgaW50byBmaWVsZHMgb2YgYSBjYW5kaWRh\ndGUgb2JqZWN0LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGlj\nIGNsYXNzIFBDUGF0aAogICAgZXh0ZW5kcyBDYW5kaWRhdGVQYXRoCiAgICBp\nbXBsZW1lbnRzIEpEQkNQYXRoIHsKCQogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBTdHJpbmcgVFJVRSA9ICIxID0gMSI7CiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIFN0cmluZyBGQUxTRSA9ICIxIDw+IDEiOwoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBQQVRIID0gMDsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBCT1VORF9WQVIgPSAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFVOQk9VTkRfVkFSID0gMjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBVTkFDQ0VTU0VEX1ZBUiA9IDM7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgWFBBVEggPSA0OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE9CSkVDVF9QQVRIID0gNTsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlKFBDUGF0aC5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc01h\ncHBpbmcgX2NhbmRpZGF0ZTsKICAgIHByaXZhdGUgQ2xhc3NNYXBwaW5nIF9j\nbGFzcyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2tleSA9IGZhbHNl\nOwogICAgcHJpdmF0ZSBpbnQgX3R5cGUgPSBQQVRIOwogICAgcHJpdmF0ZSBT\ndHJpbmcgX3Zhck5hbWUgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfY2Fz\ndCA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NpZCA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhIF94bWxmaWVsZCA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2tleVBhdGggPSBmYWxzZTsKICAgIHByaXZh\ndGUgU3RyaW5nIF9zY2hlbWFBbGlhcyA9IG51bGw7CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBwYXRoIHN0YXJ0aW5nIHdpdGggdGhlICd0aGlzJyBwdHIu\nCiAgICAgKi8KICAgIHB1YmxpYyBQQ1BhdGgoQ2xhc3NNYXBwaW5nIHR5cGUp\nIHsKICAgICAgICBfY2FuZGlkYXRlID0gdHlwZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHBhdGggc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4g\ndmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBQQ1BhdGgoQ2xhc3NNYXBw\naW5nIGNhbmRpZGF0ZSwgVmFyaWFibGUgdmFyKSB7CiAgICAgICAgX2NhbmRp\nZGF0ZSA9IGNhbmRpZGF0ZTsKICAgICAgICBfYWN0aW9ucyA9IG5ldyBMaW5r\nZWRMaXN0KCk7CgogICAgICAgIFBDUGF0aCBvdGhlciA9IHZhci5nZXRQQ1Bh\ndGgoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwog\nICAgICAgIGFjdGlvbi52YXIgPSB2YXIuZ2V0TmFtZSgpOwogICAgICAgIGlm\nIChvdGhlciA9PSBudWxsKSB7CiAgICAgICAgICAgIF90eXBlID0gVU5CT1VO\nRF9WQVI7CiAgICAgICAgICAgIGFjdGlvbi5vcCA9IEFjdGlvbi5VTkJPVU5E\nX1ZBUjsKICAgICAgICAgICAgYWN0aW9uLmRhdGEgPSB2YXI7CiAgICAgICAg\nICAgIF9zY2hlbWFBbGlhcyA9IHZhci5nZXROYW1lKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgLy8gYm91bmQgdmFyaWFibGU7IGNvcHkgcGF0\naAogICAgICAgICAgICBfdHlwZSA9IFVOQUNDRVNTRURfVkFSOwogICAgICAg\nICAgICBfYWN0aW9ucy5hZGRBbGwob3RoZXIuX2FjdGlvbnMpOwogICAgICAg\nICAgICBfa2V5ID0gb3RoZXIuX2tleTsKCiAgICAgICAgICAgIGFjdGlvbi5v\ncCA9IEFjdGlvbi5WQVI7CiAgICAgICAgICAgIGFjdGlvbi5kYXRhID0gdmFy\nLmdldE5hbWUoKTsKICAgICAgICAgICAgX3NjaGVtYUFsaWFzID0gb3RoZXIu\nX3NjaGVtYUFsaWFzOwogICAgICAgICAgICBfY29ycmVsYXRpb25WYXIgPSBv\ndGhlci5fY29ycmVsYXRpb25WYXI7CiAgICAgICAgfQogICAgICAgIF9hY3Rp\nb25zLmFkZChhY3Rpb24pOwogICAgICAgIF9jYXN0ID0gdmFyLmdldFR5cGUo\nKTsgLy8gaW5pdGlhbCB0eXBlIGlzIHZhciB0eXBlCiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSBwYXRoIHN0YXJ0aW5nIGZyb20gdGhlIGdpdmVu\nIHN1YnF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMgUENQYXRoKFN1YlEgc3Vi\nKSB7CiAgICAgICAgX2NhbmRpZGF0ZSA9IHN1Yi5nZXRDYW5kaWRhdGUoKTsK\nICAgICAgICBfYWN0aW9ucyA9IG5ldyBMaW5rZWRMaXN0KCk7CgogICAgICAg\nIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7CiAgICAgICAgYWN0aW9u\nLm9wID0gQWN0aW9uLlNVQlFVRVJZOwogICAgICAgIGFjdGlvbi5kYXRhID0g\nc3ViLmdldENhbmRpZGF0ZUFsaWFzKCk7CiAgICAgICAgX2FjdGlvbnMuYWRk\nKGFjdGlvbik7CiAgICAgICAgX2Nhc3QgPSBzdWIuZ2V0VHlwZSgpOyAvLyBp\nbml0aWFsIHR5cGUgaXMgc3VicXVlcnkgdHlwZQogICAgICAgIF92YXJOYW1l\nID0gc3ViLmdldENhbmRpZGF0ZUFsaWFzKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0U2NoZW1hQWxpYXMoU3RyaW5nIHNjaGVtYUFsaWFzKSB7CiAg\nICAgICAgaWYgKF9zY2hlbWFBbGlhcyA9PSBudWxsKSAKICAgICAgICAgICAg\nX3NjaGVtYUFsaWFzID0gc2NoZW1hQWxpYXM7CiAgICB9CgogICAgcHVibGlj\nIFN0cmluZyBnZXRTY2hlbWFBbGlhcygpIHsKICAgICAgICByZXR1cm4gX3Nj\naGVtYUFsaWFzOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRTdWJx\ndWVyeUNvbnRleHQoQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgY29ycmVsYXRp\nb25WYXIpIHsKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbGFzdEZpZWxkQWN0\naW9uKCk7CiAgICAgICAgaWYgKGFjdGlvbiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgYWN0aW9uLmNvbnRleHQgPSBjb250ZXh0Owog\nICAgICAgIF9jb3JyZWxhdGlvblZhciA9IGNvcnJlbGF0aW9uVmFyOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFNldCB0aGUgcGF0aCBhcyBhIGJpbmRp\nbmcgb2YgdGhlIGdpdmVuIHZhcmlhYmxlLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhZGRWYXJpYWJsZUFjdGlvbihWYXJpYWJsZSB2YXIpIHsKICAgICAg\nICBfdmFyTmFtZSA9IHZhci5nZXROYW1lKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGlzIGEgYm91bmQgdmFyaWFibGUg\ndGhhdCBoYXMgbm90IGJlZW4gYWNjZXNzZWQKICAgICAqIGFmdGVyIGJpbmRp\nbmcuIFVzZWZ1bCBmb3IgZmlsdGVycyBsaWtlCiAgICAgKiAiY29sbC5jb250\nYWlucyAodmFyKSAmYW1wOyZhbXA7IHZhciA9PSBudWxsIiwgd2hpY2ggc2hv\ndWxkIHJlYWxseQogICAgICoganVzdCBhY3QgbGlrZSAiY29sbC5jb250YWlu\ncyAobnVsbCkiLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1VuYWNj\nZXNzZWRWYXJpYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3R5cGUgPT0gVU5B\nQ0NFU1NFRF9WQVI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGlzIGlzIGEgcGF0aCBpbnZvbHZpbmcgYSB2YXJpYWJsZS4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNWYXJpYWJsZVBhdGgoKSB7CiAg\nICAgICAgcmV0dXJuIF90eXBlICE9IFBBVEg7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB0aGlzIHBhdGggaXMgcGFydCBvZiBhIGNvbnRhaW5zIGNsYXVz\nZSwgdGhlbiBhbGlhcyBpdCB0byB0aGUKICAgICAqIHByb3BlciBjb250YWlu\ncyBpZCBiZWZvcmUgaW5pdGlhbGl6YXRpb24uCiAgICAgKi8KICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgdm9pZCBzZXRDb250YWluc0lkKFN0cmluZyBpZCkg\newogICAgICAgIGlmIChfY2lkKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIC8vIHRyZWF0IGl0IGp1c3QgbGlrZSBhIHVuaXF1ZSB2YXJpYWJsZQog\nICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7CiAgICAgICAg\nYWN0aW9uLm9wID0gQWN0aW9uLlZBUjsKICAgICAgICBhY3Rpb24uZGF0YSA9\nIGlkOwogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQogICAgICAgICAg\nICBfYWN0aW9ucyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgX2FjdGlv\nbnMuYWRkKGFjdGlvbik7CiAgICAgICAgX2NpZCA9IHRydWU7CiAgICB9Cgog\nICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB7CiAgICAg\nICAgcmV0dXJuIF9jbGFzczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRN\nZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBfY2xhc3Mg\nPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzS2V5KCkgewogICAgICAgIHJldHVybiBfa2V5OwogICAgfQogICAg\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1hQYXRoKCkgewogICAgICAgIHJldHVy\nbiBfdHlwZSA9PSBYUEFUSDsKICAgIH0KICAgIAogICAgcHVibGljIFN0cmlu\nZyBnZXRYUGF0aCgpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIHhwYXRoID0g\nbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uOwog\nICAgICAgIEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7CiAg\nICAgICAgCiAgICAgICAgLy8gU2tpcCB2YXJpYWJsZSBhY3Rpb25zIHNpbmNl\nIHRoZXkgYXJlIG5vdCBwYXJ0IG9mIHRoZSB4cGF0aAogICAgICAgIC8vIHVu\ndGlsIHdlIHJlYWNoIHRoZSBmaXJzdCB4cGF0aCBhY3Rpb24uCiAgICAgICAg\nLy8gVGhlIGZpcnN0IHhwYXRoIGFjdGlvbiBtYXBzIHRvIHRoZSByb290IG9m\nIGFuIHhtbCBkb2N1bWVudC4KICAgICAgICBkbyAKICAgICAgICAgICAgYWN0\naW9uID0gKEFjdGlvbikgaXRyLm5leHQoKTsgCiAgICAgICAgd2hpbGUgKGFj\ndGlvbi5vcCAhPSBBY3Rpb24uR0VUX1hQQVRIKTsKICAgICAgICAKICAgICAg\nICAvLyBTa2lwIFhtbFJvb3RFbGVtZW50OgogICAgICAgIC8vIFdlIGNhbid0\nIHJlbHkgb24gdGhlIGFjY3VyYWN5IG9mIHRoZSBuYW1lIG9mIHRoZSByb290\nIGVsZW1lbnQsCiAgICAgICAgLy8gYmVjYXVzZSBpdCBjb3VsZCBiZSBzZXQg\ndG8gc29tZSBkZWZhdWx0IGJ5IEpBWEIgWE1MIEJpbmRpbmcuCiAgICAgICAg\nLy8gVGhlIGNhbGxlcihEQkRpY3Rpb25hcnkpIHNob3VsZCBzdGFydCB3aXRo\nICIvKiIgb3IgIi8qLyIsCiAgICAgICAgLy8gd2UgYnVpbGQgdGhlIHJlbWFp\nbmluZyB4cGF0aCB0aGF0IGZvbGxvd3MgdGhlIHJvb3QgZWxlbWVudC4KICAg\nICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewogICAgICAgICAgICBhY3Rp\nb24gPSAoQWN0aW9uKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoKChY\nTUxNZXRhRGF0YSkgYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgeHBhdGguYXBwZW5kKCgoWE1MTWV0YURhdGEp\nIGFjdGlvbi5kYXRhKS5nZXRYbWxuYW1lKCkpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICB4cGF0aC5hcHBlbmQoIioiKTsKICAgICAgICAg\nICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICB4cGF0aC5h\ncHBlbmQoIi8iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHhwYXRoLnRv\nU3RyaW5nKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UENQ\nYXRoU3RyaW5nKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gKF92YXJOYW1lID09IG51bGwpID8gIiIgOiBf\ndmFyTmFtZSArICIuIjsKCiAgICAgICAgU3RyaW5nQnVpbGRlciBwYXRoID0g\nbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uOwog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2FjdGlvbnMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgYWN0aW9uID0gKEFj\ndGlvbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGFjdGlvbi5vcCA9\nPSBBY3Rpb24uVkFSIHx8IGFjdGlvbi5vcCA9PSBBY3Rpb24uU1VCUVVFUlkp\nCiAgICAgICAgICAgICAgICBwYXRoLmFwcGVuZChhY3Rpb24uZGF0YSk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKGFjdGlvbi5vcCA9PSBBY3Rpb24uVU5CT1VO\nRF9WQVIpCiAgICAgICAgICAgICAgICBwYXRoLmFwcGVuZCgoKFZhcmlhYmxl\nKSBhY3Rpb24uZGF0YSkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZWxzZSAK\nICAgICAgICAgICAgICAgIHBhdGguYXBwZW5kKCgoRmllbGRNYXBwaW5nKSBh\nY3Rpb24uZGF0YSkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgcGF0aC5hcHBl\nbmQoJy4nKTsKICAgICAgICB9CiAgICAgICAgaWYgKF92YXJOYW1lICE9IG51\nbGwpCiAgICAgICAgICAgIHBhdGguYXBwZW5kKF92YXJOYW1lKS5hcHBlbmQo\nJy4nKTsKICAgICAgICByZXR1cm4gcGF0aC50b1N0cmluZygpOwogICAgfQoK\nICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0Q2xhc3NNYXBwaW5nKEV4cFN0\nYXRlIHN0YXRlKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQ\nYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChwc3RhdGUuZmllbGQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9jbGFzczsKICAgICAgICBp\nZiAoX2tleSkgewogICAgICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEtl\neSgpLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAg\nICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0\nVHlwZU1hcHBpbmcoKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgfQogICAgICAgIGlmIChwc3RhdGUuZmllbGQuZ2V0RWxlbWVudCgpLmdl\ndFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKSB7CiAgICAgICAgICAgIGlm\nIChwc3RhdGUuZmllbGQuaXNFbGVtZW50Q29sbGVjdGlvbigpICYmCiAgICAg\nICAgICAgICAgICBwc3RhdGUuZmllbGQuZ2V0RWxlbWVudCgpLmlzRW1iZWRk\nZWQoKSkKICAgICAgICAgICAgICAgIHBzdGF0ZS5pc0VtYmVkRWxlbWVudENv\nbGwgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRUeXBlQ29kZSgpID09IEph\ndmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5n\nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RmllbGRNYXBwaW5nKEV4cFN0\nYXRlIHN0YXRlKSB7CiAgICAgICAgcmV0dXJuICgoUGF0aEV4cFN0YXRlKSBz\ndGF0ZSkuZmllbGQ7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENv\nbHVtbnMoRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICBQYXRoRXhwU3RhdGUg\ncHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAgaWYgKHBz\ndGF0ZS5jb2xzID09IG51bGwpCiAgICAgICAgICAgIHBzdGF0ZS5jb2xzID0g\nY2FsY3VsYXRlQ29sdW1ucyhwc3RhdGUpOwogICAgICAgIHJldHVybiBwc3Rh\ndGUuY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBjb2x1bW5zIHVz\nZWQgYnkgdGhpcyBwYXRoLgogICAgICovCiAgICBwcml2YXRlIENvbHVtbltd\nIGNhbGN1bGF0ZUNvbHVtbnMoUGF0aEV4cFN0YXRlIHBzdGF0ZSkgewogICAg\nICAgIGlmIChfa2V5IHx8CiAgICAgICAgICAgIChfa2V5UGF0aCAmJiBwc3Rh\ndGUuZmllbGQuZ2V0S2V5KCkgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAg\nIXBzdGF0ZS5maWVsZC5nZXRLZXkoKS5pc0VtYmVkZGVkKCkpKSB7CiAgICAg\nICAgICAgIGlmICghcHN0YXRlLmpvaW5lZFJlbCAKICAgICAgICAgICAgICAg\nICYmIHBzdGF0ZS5maWVsZC5nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGpvaW5SZWxhdGlvbihwc3RhdGUs\nIF9rZXksIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHBz\ndGF0ZS5qb2luZWRSZWwgCiAgICAgICAgICAgICAgICAmJiBwc3RhdGUuZmll\nbGQuZ2V0S2V5KCkuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAg\nICAgICAgICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdldEtleU1hcHBp\nbmcoKS5nZXRUeXBlTWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdl\ndFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgICAgIHJldHVybiBwc3Rh\ndGUuZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldENvbHVtbnMoKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCAhPSBudWxsKSB7CiAgICAg\nICAgICAgIHN3aXRjaCAocHN0YXRlLmZpZWxkLmdldFR5cGVDb2RlKCkpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgICAg\nICBWYWx1ZU1hcHBpbmcgZWxlbSA9IHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50\nTWFwcGluZygpOwogICAgICAgICAgICAgICAgICAgIGlmIChwc3RhdGUuZmll\nbGQuaXNFbGVtZW50Q29sbGVjdGlvbigpICYmIHBzdGF0ZS5maWVsZC5nZXRF\nbGVtZW50KCkuaXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIFN0cmF0ZWd5IHN0cmF0ZWd5ID0gcHN0YXRlLmZpZWxkLmdldFN0cmF0\nZWd5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJhdGVneSBp\nbnN0YW5jZW9mIEhhbmRsZXJDb2xsZWN0aW9uVGFibGVGaWVsZFN0cmF0ZWd5\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChIYW5k\nbGVyQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneSkgc3RyYXRlZ3kpLgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEVsZW1lbnRDb2x1\nbW5zKGVsZW0uZ2V0VHlwZU1hcHBpbmcoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoc3RyYXRlZ3kgaW5zdGFuY2VvZiBIYW5kbGVy\nSGFuZGxlck1hcFRhYmxlRmllbGRTdHJhdGVneSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuICgoSGFuZGxlckhhbmRsZXJNYXBUYWJs\nZUZpZWxkU3RyYXRlZ3kpIHN0cmF0ZWd5KS4KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGdldFZhbHVlQ29sdW1ucyhlbGVtLmdldFR5cGVNYXBwaW5n\nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChwc3RhdGUuam9pbmVk\nUmVsICYmIGVsZW0uZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldFR5cGVNYXBw\naW5nKCkuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoZWxlbS5nZXRDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uZ2V0Q29sdW1ucygpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29s\ndW1ucygpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHBzdGF0ZS5qb2luZWRSZWwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlw\nZU1hcHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldFBy\naW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHBzdGF0ZS5maWVsZC5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmll\nbGQuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiAoX2NsYXNzID09IG51bGwpID8gU2NoZW1hcy5FTVBUWV9D\nT0xVTU5TCiAgICAgICAgICAgIDogX2NsYXNzLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNWYXJpYWJsZSgp\nIHsKICAgICAgICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSAoQWN0aW9u\nKSBfYWN0aW9ucy5nZXRMYXN0KCk7CiAgICAgICAgcmV0dXJuIGFjdGlvbi5v\ncCA9PSBBY3Rpb24uVU5CT1VORF9WQVIgfHwgYWN0aW9uLm9wID09IEFjdGlv\nbi5WQVI7IAogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdldChGaWVsZE1ldGFE\nYXRhIGZpZWxkLCBib29sZWFuIG51bGxUcmF2ZXJzYWwpIHsKICAgICAgICBp\nZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2FjdGlvbnMgPSBu\nZXcgTGlua2VkTGlzdCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcg\nQWN0aW9uKCk7CiAgICAgICAgYWN0aW9uLm9wID0gKG51bGxUcmF2ZXJzYWwp\nID8gQWN0aW9uLkdFVF9PVVRFUiA6IEFjdGlvbi5HRVQ7CiAgICAgICAgYWN0\naW9uLmRhdGEgPSBmaWVsZDsKICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9u\nKTsKICAgICAgICBpZiAoX3R5cGUgPT0gVU5BQ0NFU1NFRF9WQVIpCiAgICAg\nICAgICAgIF90eXBlID0gQk9VTkRfVkFSOwogICAgICAgIF9jYXN0ID0gbnVs\nbDsKICAgICAgICBfa2V5ID0gZmFsc2U7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIGdldChGaWVsZE1ldGFEYXRhIGZtZCwgWE1MTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQogICAgICAgICAg\nICBfYWN0aW9ucyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgQWN0aW9u\nIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBhY3Rpb24ub3AgPSBB\nY3Rpb24uR0VUX1hQQVRIOwogICAgICAgIGFjdGlvbi5kYXRhID0gbWV0YTsK\nICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9\nIG51bGw7CiAgICAgICAgX2tleSA9IGZhbHNlOwogICAgICAgIF90eXBlID0g\nWFBBVEg7CiAgICAgICAgX3htbGZpZWxkID0gZm1kOwogICAgfQogICAgCiAg\nICBwdWJsaWMgdm9pZCBnZXQoWE1MTWV0YURhdGEgbWV0YSwgU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwog\nICAgICAgIGFjdGlvbi5vcCA9IEFjdGlvbi5HRVRfWFBBVEg7CiAgICAgICAg\nYWN0aW9uLmRhdGEgPSBtZXRhLmdldEZpZWxkTWFwcGluZyhuYW1lKTsKICAg\nICAgICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IG51\nbGw7CiAgICAgICAgX2tleSA9IGZhbHNlOwogICAgICAgIF90eXBlID0gWFBB\nVEg7CiAgICB9CiAgICAKICAgIHB1YmxpYyBYTUxNZXRhRGF0YSBnZXRYbWxN\nYXBwaW5nKCkgewogICAgICAgIEFjdGlvbiBhY3QgPSAoQWN0aW9uKSBfYWN0\naW9ucy5nZXRMYXN0KCk7CiAgICAgICAgaWYgKGFjdCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gKFhNTE1ldGFEYXRhKSBhY3QuZGF0YTsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVk\nIHZvaWQgZ2V0S2V5KCkgewogICAgICAgIGlmIChfY2lkKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIC8vIHJlcGxhY2UgdGhlIGxhc3QgZmllbGQg\nYWN0aW9uIHRvIGEgZ2V0IGtleQogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBs\nYXN0RmllbGRBY3Rpb24oKTsKICAgICAgICBBY3Rpb24ga2V5ID0gbmV3IEFj\ndGlvbigpOwogICAgICAgIGtleS5vcCA9IEFjdGlvbi5HRVRfS0VZOwogICAg\nICAgIGtleS5kYXRhID0gYWN0aW9uLmRhdGE7CiAgICAgICAgaW50IHBvcyA9\nIF9hY3Rpb25zLmluZGV4T2YoYWN0aW9uKTsKICAgICAgICBfYWN0aW9ucy5y\nZW1vdmUoYWN0aW9uKTsKICAgICAgICBfYWN0aW9ucy5hZGQocG9zLCBrZXkp\nOwogICAgICAgIF9jYXN0ID0gbnVsbDsKICAgICAgICBfa2V5ID0gdHJ1ZTsK\nICAgICAgICBfdHlwZSA9IFBBVEg7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGNoZWNrT2JqZWN0UGF0aEluaGVyaXRhbmNlVHlwZUpvaW5lZChQYXRoRXhw\nU3RhdGUgcHN0YXRlKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nIGlz\nIGluIEluaGVyaXRhbmNlVHlwZS5KT0lORUQsCiAgICAgICAgLy8gdGhlbiBh\nZGQgam9pbnMKICAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2UgPSBfY2xhc3M7\nCiAgICAgICAgIHdoaWxlIChiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgICBiYXNlID0gYmFzZS5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgaWYg\nKGJhc2UgIT0gX2NsYXNzKSB7CiAgICAgICAgICAgICBDbGFzc01hcHBpbmcg\nZnJvbSA9IF9jbGFzczsKICAgICAgICAgICAgIENsYXNzTWFwcGluZyB0byA9\nIGJhc2U7CiAgICAgICAgICAgICBfdHlwZSA9IE9CSkVDVF9QQVRIOwogICAg\nICAgICAgICAgZm9yICg7IGZyb20gIT0gbnVsbCAmJiBmcm9tICE9IHRvOyBm\ncm9tID0gZnJvbS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSkg\newogICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IGZyb20uam9pblN1\ncGVyY2xhc3MocHN0YXRlLmpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgICB9\nCiAgICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBs\nYXN0KCkgewogICAgICAgIEFjdGlvbiBhY3QgPSBsYXN0RmllbGRBY3Rpb24o\nKTsKICAgICAgICByZXR1cm4gKGFjdCA9PSBudWxsKSA/IG51bGwgOiBpc1hQ\nYXRoKCkgPwogICAgICAgICAgICBfeG1sZmllbGQgOiAoRmllbGRNZXRhRGF0\nYSkgYWN0LmRhdGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGxhc3QgYWN0aW9uIHRoYXQgZ2V0cyBhIGZpZWxkLgogICAgICovCiAgICBw\ncml2YXRlIEFjdGlvbiBsYXN0RmllbGRBY3Rpb24oKSB7CiAgICAgICAgaWYg\nKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBpZiAoaXNYUGF0aCgpKQogICAgICAgICAgICByZXR1cm4gKEFj\ndGlvbikgX2FjdGlvbnMuZ2V0TGFzdCgpOwogICAgICAgIAogICAgICAgIExp\nc3RJdGVyYXRvciBpdHIgPSBfYWN0aW9ucy5saXN0SXRlcmF0b3IoX2FjdGlv\nbnMuc2l6ZSgpKTsKICAgICAgICBBY3Rpb24gcHJldjsKICAgICAgICB3aGls\nZSAoaXRyLmhhc1ByZXZpb3VzKCkpIHsKICAgICAgICAgICAgcHJldiA9IChB\nY3Rpb24pIGl0ci5wcmV2aW91cygpOwogICAgICAgICAgICBpZiAocHJldi5v\ncCA9PSBBY3Rpb24uR0VUIHx8IHByZXYub3AgPT0gQWN0aW9uLkdFVF9PVVRF\nUgogICAgICAgICAgICAgICAgfHwgcHJldi5vcCA9PSBBY3Rpb24uR0VUX0tF\nWSkKICAgICAgICAgICAgICAgIHJldHVybiBwcmV2OwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0\nVHlwZSgpIHsKICAgICAgICBpZiAoX2Nhc3QgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9jYXN0OwogICAgICAgIEFjdGlvbiBhY3QgPSBsYXN0Rmll\nbGRBY3Rpb24oKTsKICAgICAgICBpZiAoYWN0ICE9IG51bGwgJiYgYWN0Lm9w\nID09IEFjdGlvbi5HRVRfWFBBVEgpCiAgICAgICAgICAgIHJldHVybiAoKFhN\nTE1ldGFEYXRhKSBhY3QuZGF0YSkuZ2V0VHlwZSgpOwoKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZsZCA9IChhY3QgPT0gbnVsbCkgPyBudWxsIDogKEZpZWxk\nTWV0YURhdGEpIGFjdC5kYXRhOwogICAgICAgIGJvb2xlYW4ga2V5ID0gYWN0\nICE9IG51bGwgJiYgYWN0Lm9wID09IEFjdGlvbi5HRVRfS0VZOwogICAgICAg\nIGlmIChmbGQgIT0gbnVsbCkgewogICAgICAgICAgICBzd2l0Y2ggKGZsZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGlmIChmbGQu\nZ2V0RGVjbGFyZWRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAgICAgICAg\nICAgICAgICAgICAgIHx8IGZsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBCeXRl\nW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAgfHwgZmxkLmdldERl\nY2xhcmVkVHlwZSgpID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAg\nICAgICAgICB8fCBmbGQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQ2hhcmFjdGVy\nW10uY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGQu\nZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGZsZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGtleSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZs\nZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmxkLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUo\nKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRFbGVtZW50KCku\nZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGQuZ2V0RGVjbGFyZWRUeXBl\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9jbGFz\ncyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2NsYXNzLmdldERlc2Ny\naWJlZFR5cGUoKTsKICAgICAgICByZXR1cm4gT2JqZWN0LmNsYXNzOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldEltcGxpY2l0VHlwZShDbGFzcyB0eXBl\nKSB7CiAgICAgICAgX2Nhc3QgPSB0eXBlOwogICAgfQoKICAgIHB1YmxpYyBF\neHBTdGF0ZSBpbml0aWFsaXplKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4\nLCBpbnQgZmxhZ3MpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0g\nbmV3IFBhdGhFeHBTdGF0ZShzZWwubmV3Sm9pbnMoKSk7CiAgICAgICAgYm9v\nbGVhbiBrZXkgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIg\nPSBmYWxzZTsKICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gX2NhbmRpZGF0\nZTsKCiAgICAgICAgc2VsLnNldFNjaGVtYUFsaWFzKF9zY2hlbWFBbGlhcyk7\nCgogICAgICAgIC8vIGl0ZXJhdGUgdG8gdGhlIGZpbmFsIGZpZWxkCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG93bmVyOwogICAgICAgIENsYXNzTWFwcGluZyBm\ncm9tLCB0bzsKICAgICAgICBBY3Rpb24gYWN0aW9uOwogICAgICAgIFZhcmlh\nYmxlIHZhcjsKICAgICAgICBJdGVyYXRvciBpdHIgPSAoX2FjdGlvbnMgPT0g\nbnVsbCkgPyBudWxsIDogX2FjdGlvbnMuaXRlcmF0b3IoKTsKICAgICAgICBG\naWVsZE1hcHBpbmcgZmllbGQgPSBudWxsOwogICAgICAgIEFjdGlvbiBwcmV2\nYWN0aW9uID0gbnVsbDsKICAgICAgICBib29sZWFuIGlzQ29ycmVsYXRlZFBh\ndGggPSBmYWxzZTsKICAgICAgICBib29sZWFuIGZyb21QYXJlbnRSb290SW5T\ndWJzZWxlY3QgPSBuYXZpZ2F0ZUZyb21QYXJlbnRSb290SW5TdWJzZWxlY3Qo\nc2VsKTsKICAgICAgICAgICAgICAgIAogICAgICAgIHdoaWxlIChpdHIgIT0g\nbnVsbCAmJiBpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIGFjdGlvbiA9\nIChBY3Rpb24pIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAvLyB0cmVhdCBz\ndWJxdWVyaWVzIGxpa2UgdmFyaWFibGVzIGZvciBhbGlhcyBnZW5lcmF0aW9u\nIHB1cnBvc2VzCiAgICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9u\nLlZBUikgewogICAgICAgICAgICAgICAgaWYgKHNlbC5nZXRQYXJlbnQoKSAh\nPSBudWxsICYmIGFjdGlvbi52YXIgIT0gbnVsbCAmJgogICAgICAgICAgICAg\nICAgICAgIHByZXZhY3Rpb24gIT0gbnVsbCAmJiBwcmV2YWN0aW9uLmRhdGEg\nIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAgIHNlbC5jdHgoKS5nZXRW\nYXJpYWJsZShhY3Rpb24udmFyKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgaXNDb3JyZWxhdGVkUGF0aCA9IHRydWU7CiAgICAgICAgICAgICAg\nICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldENvcnJlbGF0\nZWRWYXJpYWJsZShhY3Rpb24udmFyKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSAKICAgICAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUu\nam9pbnMuc2V0VmFyaWFibGUoKFN0cmluZykgYWN0aW9uLmRhdGEpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGFjdGlvbi5vcCA9PSBB\nY3Rpb24uU1VCUVVFUlkpIHsKICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lu\ncyA9IHBzdGF0ZS5qb2lucy5zZXRTdWJzZWxlY3QoKFN0cmluZykgYWN0aW9u\nLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGFj\ndGlvbi5vcCA9PSBBY3Rpb24uVU5CT1VORF9WQVIpIHsKICAgICAgICAgICAg\nICAgIC8vIHVuYm91bmQgdmFycyBhcmUgY3Jvc3Mtam9pbmVkIHRvIHRoZSBj\nYW5kaWRhdGUgdGFibGUKICAgICAgICAgICAgICAgIHZhciA9IChWYXJpYWJs\nZSkgYWN0aW9uLmRhdGE7CiAgICAgICAgICAgICAgICByZWwgPSAoQ2xhc3NN\nYXBwaW5nKSB2YXIuZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIGlm\nIChyZWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIAl0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAg\nICAgCSAgICAiaW52YWxpZC11bmJvdW5kLXZhciIsIHZhci5nZXROYW1lKCkp\nLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgCSAgICAKICAgICAgICAg\nICAgICAgIGlmIChzZWwuZ2V0UGFyZW50KCkgIT0gbnVsbCAmJiBhY3Rpb24u\ndmFyICE9IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICBzZWwuY3R4KCku\nZ2V0VmFyaWFibGUoYWN0aW9uLnZhcikgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIC8vU3lzdGVtLm91dC5wcmludGxuKCJDb3JyZWxhdGVkIGFj\ndGlvbiB2YXI9IithY3Rpb24udmFyKTsKICAgICAgICAgICAgICAgICAgICBp\nc0NvcnJlbGF0ZWRQYXRoID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBw\nc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0Q29ycmVsYXRlZFZhcmlh\nYmxlKHZhci5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgfSBlbHNlICAg\nICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBwc3RhdGUuam9p\nbnMgPSBwc3RhdGUuam9pbnMuc2V0VmFyaWFibGUodmFyLmdldE5hbWUoKSk7\nCgogICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5z\nLmNyb3NzSm9pbihfY2FuZGlkYXRlLmdldFRhYmxlKCksCiAgICAgICAgICAg\nICAgICAgICAgcmVsLmdldFRhYmxlKCkpOwogICAgICAgICAgICAgICAgaWYg\nKCFpdHIuaGFzTmV4dCgpICYmIGlzVmFyaWFibGUoKSkgewogICAgICAgICAg\nICAgICAgICAgIGNoZWNrT2JqZWN0UGF0aEluaGVyaXRhbmNlVHlwZUpvaW5l\nZChwc3RhdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgLy8gbW92ZSBwYXN0IHRoZSBwcmV2aW91\ncyBmaWVsZCwgaWYgYW55CiAgICAgICAgICAgICAgICBmaWVsZCA9IChGaWVs\nZE1hcHBpbmcpICgoYWN0aW9uLm9wID09IEFjdGlvbi5HRVRfWFBBVEgpID8K\nICAgICAgICAgICAgICAgICAgICBfeG1sZmllbGQgOiBhY3Rpb24uZGF0YSk7\nCgogICAgICAgICAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyB0aGUgc2Vjb25k\nLXRvLWxhc3QgZmllbGQgYW5kIHRoZSBsYXN0IGlzCiAgICAgICAgICAgICAg\nICAgICAgLy8gdGhlIHJlbGF0ZWQgZmllbGQgdGhpcyBmaWVsZCBqb2lucyB0\nbywgbm8gbmVlZCB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRyYXZlcnNl\nOiBqdXN0IHVzZSB0aGlzIGZpZWxkJ3MgZmsgY29sdW1ucwogICAgICAgICAg\nICAgICAgICAgIGlmICghaXRyLmhhc05leHQoKSAmJiAoZmxhZ3MgJiBKT0lO\nX1JFTCkgPT0gMAogICAgICAgICAgICAgICAgICAgICAgICAmJiBpc0pvaW5l\nZEZpZWxkKHBzdGF0ZS5maWVsZCwga2V5LCBmaWVsZCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgcHN0YXRlLmNtcGZpZWxkID0gZmllbGQ7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBp\nZiAoZnJvbVBhcmVudFJvb3RJblN1YnNlbGVjdCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpc0NvcnJlbGF0ZWRQYXRoID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNl\ndENvcnJlbGF0ZWRWYXJpYWJsZShfc2NoZW1hQWxpYXMpOwogICAgICAgICAg\nICAgICAgICAgICAgICBwc3RhdGUuam9pbnMuc2V0Sm9pbkNvbnRleHQobnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIAogICAgICAgICAgICAgICAgICAgIHJlbCA9IHRyYXZlcnNlRmllbGQocHN0\nYXRlLCBrZXksIGZvcmNlT3V0ZXIsIGZhbHNlKTsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAvLyBtYXJrIGlmIHRoZSBuZXh0IHRyYXZl\ncnNhbCBzaG91bGQgZ28gdGhyb3VnaAogICAgICAgICAgICAgICAgLy8gdGhl\nIGtleSByYXRoZXIgdGhhbiB2YWx1ZQogICAgICAgICAgICAgICAga2V5ID0g\nYWN0aW9uLm9wID09IEFjdGlvbi5HRVRfS0VZOwogICAgICAgICAgICAgICAg\nZm9yY2VPdXRlciB8PSBhY3Rpb24ub3AgPT0gQWN0aW9uLkdFVF9PVVRFUjsK\nICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGtleSAmJiBp\ndHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgICAgIF9rZXlQYXRoID0g\ndHJ1ZTsKCiAgICAgICAgICAgICAgICAvLyBnZXQgbWFwcGluZyBmb3IgdGhl\nIGN1cnJlbnQgZmllbGQKICAgICAgICAgICAgICAgIHBzdGF0ZS5maWVsZCA9\nIGZpZWxkOwoKICAgICAgICAgICAgICAgIG93bmVyID0gcHN0YXRlLmZpZWxk\nLmdldERlZmluaW5nTWFwcGluZygpOwogICAgICAgICAgICAgICAgaWYgKHBz\ndGF0ZS5maWVsZC5nZXRNYW5hZ2VtZW50KCkgCiAgICAgICAgICAgICAgICAg\nICAgIT0gRmllbGRNYXBwaW5nLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub24tcGVycy1maWVsZCIsIAogICAgICAgICAgICAgICAgICAgICAgICBw\nc3RhdGUuZmllbGQpKTsKCiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBt\nb3N0LWRlcml2ZWQgdHlwZSBiZXR3ZWVuIHRoZSBkZWNsYXJlZCByZWxhdGlv\nbgogICAgICAgICAgICAgICAgLy8gdHlwZSBhbmQgdGhlIGZpZWxkJ3Mgb3du\nZXIsIGFuZCBqb2luIGZyb20gdGhhdCB0eXBlIHRvCiAgICAgICAgICAgICAg\nICAvLyB0aGUgbGVzc2VyIGRlcml2ZWQgdHlwZQogICAgICAgICAgICAgICAg\naWYgKHJlbCAhPSBvd25lciAmJiByZWwgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGlmIChyZWwuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzQXNzaWdu\nYWJsZUZyb20KICAgICAgICAgICAgICAgICAgICAgICAgKG93bmVyLmdldERl\nc2NyaWJlZFR5cGUoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJv\nbSA9IG93bmVyOwogICAgICAgICAgICAgICAgICAgICAgICB0byA9IHJlbDsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICBmcm9tID0gcmVsOwogICAgICAgICAgICAgICAgICAgICAgICB0\nbyA9IG93bmVyOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgZm9yICg7IGZyb20gIT0gbnVsbCAmJiBmcm9tICE9IHRvOwog\nICAgICAgICAgICAgICAgICAgICAgICBmcm9tID0gZnJvbS5nZXRKb2luYWJs\nZVBDU3VwZXJjbGFzc01hcHBpbmcoKSkgewogICAgICAgICAgICAgICAgICAg\nIAlGaWVsZE1hcHBpbmcgY2FzdCA9IGZyb20uZ2V0RmllbGRNYXBwaW5nKHBz\ndGF0ZS5maWVsZAogICAgICAgICAgICAgICAgICAgIAkJCS5nZXROYW1lKCkp\nOwogICAgICAgICAgICAgICAgICAgIAlpZiAoY2FzdCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIAkJcHN0YXRlLmZpZWxkID0gY2FzdDsKICAgICAg\nICAgICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gZnJvbS5qb2luU3Vw\nZXJjbGFzcyhwc3RhdGUuam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBu\nb3RoaW5nIG1vcmUgdG8gZG8gZnJvbSBoZXJlIG9uIGFzIHdlIGVuY291bnRl\ncmVkIGFuIHhwYXRoCiAgICAgICAgICAgICAgICAvLyBhY3Rpb24KICAgICAg\nICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLkdFVF9YUEFUSCkK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBwcmV2YWN0aW9uID0gYWN0aW9uOwogICAgICAgICAgICBpZiAo\ncHJldmFjdGlvbiAhPSBudWxsICYmIHByZXZhY3Rpb24uY29udGV4dCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBDb250ZXh0IGpDdHggPSBKREJDU3Rv\ncmVRdWVyeS5nZXRUaHJlYWRMb2NhbENvbnRleHQocHJldmFjdGlvbi5jb250\nZXh0KTsKICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5q\nb2lucy5zZXRKb2luQ29udGV4dChqQ3R4KTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBpZiAoX3Zhck5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFZhcmlhYmxlKF92\nYXJOYW1lKTsKCiAgICAgICAgLy8gaWYgd2UncmUgbm90IGNvbXBhcmluZyB0\nbyBudWxsIG9yIGRvaW5nIGFuIGlzRW1wdHksIHRoZW4KICAgICAgICAvLyBq\nb2luIGludG8gdGhlIGRhdGEgb24gdGhlIGZpbmFsIGZpZWxkOyBvYnZpb3Vz\nbHkgd2UgY2FuJ3QgZG8gdGhlc2UKICAgICAgICAvLyBqb2lucyB3aGVuIGNv\nbXBhcmluZyB0byBudWxsIGIvYyB0aGUgd2hvbGUgcHVycG9zZSBpcyB0byBz\nZWUKICAgICAgICAvLyB3aGV0aGVyIHRoZSBqb2lucyBldmVuIGV4aXN0CiAg\nICAgICAgaWYgKChmbGFncyAmIE5VTExfQ01QKSA9PSAwKQogICAgICAgICAg\nICB0cmF2ZXJzZUZpZWxkKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVyLCB0cnVl\nKTsKICAgICAgICBwc3RhdGUuam9pbmVkUmVsID0gZmFsc2U7CiAgICAgICAg\naWYgKChmbGFncyAmIEpPSU5fUkVMKSAhPSAwKQogICAgICAgICAgICBqb2lu\nUmVsYXRpb24ocHN0YXRlLCBrZXksIGZvcmNlT3V0ZXIgfHwgKGZsYWdzICYg\nRk9SQ0VfT1VURVIpICE9IDAsCiAgICAgICAgICAgICAgICBmYWxzZSk7CiAg\nICAgICAgaWYgKGlzQ29ycmVsYXRlZFBhdGgpIHsKICAgICAgICAgICAgLy8g\nY2hlY2sgaWYgdGhlcmUgYXJlIGpvaW5zIHRoYXQgYmVsb25nIHRvIHBhcmVu\ndAogICAgICAgICAgICBwc3RhdGUuam9pbnMubW92ZUpvaW5zVG9QYXJlbnQo\nKTsKICAgICAgICB9CiAgICAgICAgcHN0YXRlLmpvaW5zLnNldEpvaW5Db250\nZXh0KG51bGwpOwogICAgICAgIAogICAgICAgIGlmIChfYWN0aW9ucyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBzdWJxQWxpYXMgPSBmaW5kU3Vi\ncUFsaWFzKHNlbCk7CiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0\nZS5qb2lucy5zZXRTdWJzZWxlY3Qoc3VicUFsaWFzKTsKICAgICAgICAgICAg\ncHN0YXRlLmpvaW5zLnNldENvcnJlbGF0ZWRWYXJpYWJsZShfc2NoZW1hQWxp\nYXMpOwogICAgICAgICAgICBjaGVja09iamVjdFBhdGhJbmhlcml0YW5jZVR5\ncGVKb2luZWQocHN0YXRlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\ncmV0dXJuIHBzdGF0ZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBTdHJpbmcg\nZmluZFN1YnFBbGlhcyhTZWxlY3Qgc2VsKSB7CiAgICAgICAgU2VsZWN0IHBT\nZWwgPSBzZWwuZ2V0UGFyZW50KCk7CiAgICAgICAgaWYgKHBTZWwgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgQ29udGV4dCBw\nQ3R4ID0gcFNlbC5jdHgoKTsKICAgICAgICBpZiAocEN0eC5zdWJxdWVyeSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\ncEN0eC5nZXRTY2hlbWEoX3NjaGVtYUFsaWFzKSAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gKChTdWJRKXBDdHguc3VicXVlcnkpLmdldENhbmRpZGF0\nZUFsaWFzKCk7CiAgICAgICAgcmV0dXJuIGZpbmRTdWJxQWxpYXMocFNlbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVuIGEgUENQYXRoIGlzIGluIHN1\nYnNlbGVjdCwgYW5kIGl0IGlzIHNpbXBseSBhIG5hdmlnYXRpb24KICAgICAq\nIGZyb20gdGhlIHBhcmVudCByb290LCB0aGUgam9pbnMgaW52b2x2ZWQgaW4g\ndGhpcyBQQ1BhdGgKICAgICAqIG11c3QgaGFwcGVuIGluIHRoZSBtYWluIHNl\nbGVjdC4gIAogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gbmF2aWdhdGVG\ncm9tUGFyZW50Um9vdEluU3Vic2VsZWN0KFNlbGVjdCBzZWwpIHsKICAgICAg\nICBpZiAoc2VsLmdldFBhcmVudCgpID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBJdGVyYXRvciBpdHIgPSAoX2FjdGlvbnMg\nPT0gbnVsbCkgPyBudWxsIDogX2FjdGlvbnMuaXRlcmF0b3IoKTsKCiAgICAg\nICAgYm9vbGVhbiBoYXNWYXIgPSBmYWxzZTsKICAgICAgICBib29sZWFuIHN0\nYXJ0c1dpdGhTdWJxdWVyeSA9IGZhbHNlOwogICAgICAgIHdoaWxlIChpdHIg\nIT0gbnVsbCAmJiBpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIEFjdGlv\nbiBhY3Rpb24gPSAoQWN0aW9uKSBpdHIubmV4dCgpOwogICAgICAgICAgICBp\nZiAoYWN0aW9uLm9wID09IEFjdGlvbi5WQVIpIAogICAgICAgICAgICAgICAg\naGFzVmFyID0gdHJ1ZTsKICAgICAgICAgICAgZWxzZSBpZiAoYWN0aW9uLm9w\nID09IEFjdGlvbi5TVUJRVUVSWSkKICAgICAgICAgICAgICAgIHN0YXJ0c1dp\ndGhTdWJxdWVyeSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiAh\naGFzVmFyICYmICFzdGFydHNXaXRoU3VicXVlcnkgJiYgc2VsLmN0eCgpLmdl\ndFNjaGVtYShfc2NoZW1hQWxpYXMpID09IG51bGw7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHNvdXJjZSBm\naWVsZCBqb2lucyB0byB0aGUgZ2l2ZW4gdGFyZ2V0IGZpZWxkLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzSm9pbmVkRmllbGQoRmll\nbGRNYXBwaW5nIHNyYywgYm9vbGVhbiBrZXksIAogICAgICAgIEZpZWxkTWFw\ncGluZyB0YXJnZXQpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgdm07CiAgICAg\nICAgc3dpdGNoIChzcmMuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIHZtID0gc3JjLmdldEVs\nZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgdm0g\nPSAoa2V5KSA/IHNyYy5nZXRLZXlNYXBwaW5nKCkgOiBzcmMuZ2V0RWxlbWVu\ndE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdm0gPSBzcmM7CiAgICAgICAg\nfQogICAgICAgIGlmICh2bS5nZXRKb2luRGlyZWN0aW9uKCkgIT0gVmFsdWVN\nYXBwaW5nLkpPSU5fRk9SV0FSRCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIEZvcmVpZ25LZXkgZmsgPSB2bS5nZXRGb3JlaWduS2V5KCk7\nCiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsgCiAgICAgICAgCiAgICAgICAgLy8gZm9yZWlnbiBrZXkgbXVzdCBq\nb2luIHRvIHRhcmdldCBjb2x1bW5zCiAgICAgICAgQ29sdW1uW10gcmVscyA9\nIGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBwa3MgPSB0YXJn\nZXQuZ2V0Q29sdW1ucygpOyAKICAgICAgICBpZiAocmVscy5sZW5ndGggIT0g\ncGtzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcmVscy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgaWYgKGZrLmdldFByaW1hcnlLZXlDb2x1bW4ocmVsc1tpXSkgIT0g\ncGtzW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgT2JqZWN0\nIGV2YWwoT2JqZWN0IGNhbmRpZGF0ZSwgT2JqZWN0IG9yaWcsCiAgICAgICAg\nU3RvcmVDb250ZXh0IGN0eCwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAg\naWYgKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjYW5k\naWRhdGU7CgogICAgICAgIEFjdGlvbiBhY3Rpb247CiAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbTsKICAgICAgICBCcm9rZXIgdG1wQnJva2VyOwog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2FjdGlvbnMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgYWN0aW9uID0gKEFj\ndGlvbilpdHIubmV4dCgpOwogICAgICAgICAgICBzbSA9IG51bGw7CiAgICAg\nICAgICAgIHRtcEJyb2tlciA9IG51bGw7CiAgICAgICAgICAgIGlmIChJbXBs\nSGVscGVyLmlzTWFuYWdlYWJsZShjYW5kaWRhdGUpKQogICAgICAgICAgICAg\nICAgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgKEltcGxIZWxwZXIudG9Q\nZXJzaXN0ZW5jZUNhcGFibGUoCiAgICAgICAgICAgICAgICAgICAgY2FuZGlk\nYXRlLCBjdHguZ2V0Q29uZmlndXJhdGlvbigpKSkuCiAgICAgICAgICAgICAg\nICAgICAgcGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgaWYgKHNt\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRtcEJyb2tlciA9IGN0eC5n\nZXRCcm9rZXIoKTsKICAgICAgICAgICAgICAgIHRtcEJyb2tlci50cmFuc2Fj\ndGlvbmFsKGNhbmRpZGF0ZSwgZmFsc2UsIG51bGwpOwogICAgICAgICAgICAg\nICAgc20gPSB0bXBCcm9rZXIuZ2V0U3RhdGVNYW5hZ2VyKGNhbmRpZGF0ZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFjdGlvbi5vcCAhPSBB\nY3Rpb24uR0VUICYmIGFjdGlvbi5vcCAhPSBBY3Rpb24uR0VUX09VVEVSKQog\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBjYW5kaWRhdGUgPSBzbS5mZXRjaEZpZWxkKAogICAg\nICAgICAgICAgICAgICAgICAgICAoKEZpZWxkTWFwcGluZylhY3Rpb24uZGF0\nYSkuZ2V0SW5kZXgoKSwgdHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKENs\nYXNzQ2FzdEV4Y2VwdGlvbiBjY2UpIHsKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBSdW50aW1lRXhjZXB0aW9uKGFjdGlvbi5kYXRhICsgIiBub3QgYSBm\naWVsZCBwYXRoIik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICAvLyB0cmFuc2FjdGlvbmFsIGRvZXMgbm90IGNsZWFyIHRoZSBz\ndGF0ZSwgd2hpY2ggaXMKICAgICAgICAgICAgICAgIC8vIGltcG9ydGFudCBz\naW5jZSB0bXBDYW5kaWRhdGUgbWlnaHQgYmUgYWxzbyBtYW5hZ2VkIGJ5CiAg\nICAgICAgICAgICAgICAvLyBhbm90aGVyIGJyb2tlciBpZiBpdCdzIGEgcHJv\neGllZCBub24tcGMgaW5zdGFuY2UKICAgICAgICAgICAgICAgIGlmICh0bXBC\ncm9rZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0bXBCcm9rZXIu\nbm9udHJhbnNhY3Rpb25hbChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVs\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNh\nbmRpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4cHJlc3Npb24gc3Rh\ndGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgUGF0aEV4cFN0\nYXRlCiAgICAgICAgZXh0ZW5kcyBFeHBTdGF0ZSB7CgogICAgICAgIHB1Ymxp\nYyBGaWVsZE1hcHBpbmcgZmllbGQgPSBudWxsOwogICAgICAgIHB1YmxpYyBG\naWVsZE1hcHBpbmcgY21wZmllbGQgPSBudWxsOwogICAgICAgIHB1YmxpYyBD\nb2x1bW5bXSBjb2xzID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBq\nb2luZWRSZWwgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Vt\nYmVkRWxlbWVudENvbGwgPSBmYWxzZTsKICAgICAgICAKICAgICAgICBwdWJs\naWMgUGF0aEV4cFN0YXRlKEpvaW5zIGpvaW5zKSB7CiAgICAgICAgICAgIHN1\ncGVyKGpvaW5zKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBU\ncmF2ZXJzZSBpbnRvIHRoZSBwcmV2aW91cyBmaWVsZCBvZiBhIHJlbGF0aW9u\nIHBhdGguCiAgICAgKgogICAgICogQHBhcmFtIGxhc3Qgd2hldGhlciB0aGlz\nIGlzIHRoZSBsYXN0IGZpZWxkIGluIHRoZSBwYXRoCiAgICAgKiBAcmV0dXJu\nIHRoZSBtYXBwaW5nIG9mIHRoZSByZWxhdGVkIHR5cGUsIG9yIG51bGwKICAg\nICAqLwogICAgcHJpdmF0ZSBDbGFzc01hcHBpbmcgdHJhdmVyc2VGaWVsZChQ\nYXRoRXhwU3RhdGUgcHN0YXRlLCBib29sZWFuIGtleSwgCiAgICAgICAgYm9v\nbGVhbiBmb3JjZU91dGVyLCBib29sZWFuIGxhc3QpIHsKICAgICAgICBpZiAo\ncHN0YXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICAvLyB0cmF2ZXJzZSBpbnRvIGZpZWxkIHZhbHVlCiAgICAg\nICAgaWYgKGtleSkKICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRl\nLmZpZWxkLmpvaW5LZXkocHN0YXRlLmpvaW5zLCBmb3JjZU91dGVyKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5m\naWVsZC5qb2luKHBzdGF0ZS5qb2lucywgZm9yY2VPdXRlcik7CgogICAgICAg\nIC8vIGlmIHRoaXMgaXNuJ3QgdGhlIGxhc3QgZmllbGQsIHRyYXZlcnNlIGlu\ndG8gdGhlIHJlbGF0aW9uCiAgICAgICAgaWYgKCFsYXN0KQogICAgICAgICAg\nICBqb2luUmVsYXRpb24ocHN0YXRlLCBrZXksIGZvcmNlT3V0ZXIsIHRydWUp\nOwoKICAgICAgICAvLyByZXR1cm4gdGhlIG1hcGluZyBvZiB0aGUgcmVsYXRl\nZCB0eXBlLCBpZiBhbnkKICAgICAgICBpZiAoa2V5KQogICAgICAgICAgICBy\nZXR1cm4gcHN0YXRlLmZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRUeXBlTWFw\ncGluZygpOwogICAgICAgIGlmIChwc3RhdGUuZmllbGQuZ2V0RWxlbWVudCgp\nLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICBy\nZXR1cm4gcHN0YXRlLmZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlw\nZU1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdldFR5\ncGVNYXBwaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBKb2luIGludG8g\ndGhlIHJlbGF0aW9uIHJlcHJlc2VudGVkIGJ5IHRoZSBjdXJyZW50IGZpZWxk\nLCBpZiBhbnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBqb2luUmVsYXRp\nb24oUGF0aEV4cFN0YXRlIHBzdGF0ZSwgYm9vbGVhbiBrZXksIAogICAgICAg\nIGJvb2xlYW4gZm9yY2VPdXRlciwgYm9vbGVhbiB0cmF2ZXJzZSkgewogICAg\nICAgIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIGlmIChrZXkpCiAgICAgICAgICAgIHBzdGF0ZS5qb2lu\ncyA9IHBzdGF0ZS5maWVsZC5qb2luS2V5UmVsYXRpb24ocHN0YXRlLmpvaW5z\nLCAKICAgICAgICAgICAgICAgIGZvcmNlT3V0ZXIsIHRyYXZlcnNlKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5m\naWVsZC5qb2luUmVsYXRpb24ocHN0YXRlLmpvaW5zLCBmb3JjZU91dGVyLAog\nICAgICAgICAgICAgICAgdHJhdmVyc2UpOwogICAgICAgIHBzdGF0ZS5qb2lu\nZWRSZWwgPSB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9EYXRh\nU3RvcmVWYWx1ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3Rh\ndGUgc3RhdGUsIAogICAgICAgIE9iamVjdCB2YWwpIHsKICAgICAgICBQYXRo\nRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAg\nICAgRmllbGRNYXBwaW5nIGZpZWxkID0gKHBzdGF0ZS5jbXBmaWVsZCAhPSBu\ndWxsKSA/IHBzdGF0ZS5jbXBmaWVsZCAKICAgICAgICAgICAgOiBwc3RhdGUu\nZmllbGQ7CiAgICAgICAgaWYgKGlzWFBhdGgoKSkKICAgICAgICAgICAgcmV0\ndXJuIHZhbDsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoX2tleSkKICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC50\nb0tleURhdGFTdG9yZVZhbHVlKHZhbCwgY3R4LnN0b3JlKTsKICAgICAgICAg\nICAgaWYgKGZpZWxkLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLk9CSkVDVCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmaWVsZC50b0RhdGFTdG9yZVZhbHVlKHZhbCwgY3R4LnN0b3JlKTsKCiAg\nICAgICAgICAgIHZhbCA9IGZpZWxkLmdldEV4dGVybmFsVmFsdWUodmFsLCBj\ndHguc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAgICAgICAgICAgcmV0dXJuIGZp\nZWxkLnRvRGF0YVN0b3JlVmFsdWUodmFsLCBjdHguc3RvcmUpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gX2NsYXNzLnRvRGF0YVN0b3JlVmFsdWUodmFs\nLCBfY2xhc3MuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSwKICAgICAgICAgICAg\nY3R4LnN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAg\nICAgICBib29sZWFuIHBrcykgewogICAgICAgIHNlbGVjdENvbHVtbnMoc2Vs\nLCBjdHgsIHN0YXRlLCBwa3MpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\nbGVjdENvbHVtbnMoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0\nYXRlIHN0YXRlLCAKICAgICAgICBib29sZWFuIHBrcykgewogICAgICAgIHNl\nbC5zZXRTY2hlbWFBbGlhcyhfc2NoZW1hQWxpYXMpOwogICAgICAgIENsYXNz\nTWFwcGluZyBtYXBwaW5nID0gZ2V0Q2xhc3NNYXBwaW5nKHN0YXRlKTsKICAg\nICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3Rh\ndGU7CiAgICAgICAgaWYgKF90eXBlICE9IE9CSkVDVF9QQVRIICYmIChtYXBw\naW5nID09IG51bGwgfHwgIXBzdGF0ZS5qb2luZWRSZWwgfHwKICAgICAgICAg\nICAgcHN0YXRlLmlzRW1iZWRFbGVtZW50Q29sbCkpCiAgICAgICAgICAgIHNl\nbC5zZWxlY3QoZ2V0Q29sdW1ucyhzdGF0ZSksIHBzdGF0ZS5qb2lucyk7CiAg\nICAgICAgZWxzZSBpZiAoX2tleSAmJiBwc3RhdGUuZmllbGQuZ2V0S2V5KCku\naXNFbWJlZGRlZCgpKQogICAgICAgICAgICBzZWxlY3RFbWJlZGRlZE1hcEtl\neShzZWwsIGN0eCwgc3RhdGUpOwogICAgICAgIGVsc2UgaWYgKHBrcykKICAg\nICAgICAgICAgc2VsLnNlbGVjdChtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCksIHBzdGF0ZS5qb2lucyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZzsgYWxsb3cgYW55IHN1YnMgYmVj\nYXVzZSB3ZSBrbm93IHRoaXMgbXVzdAogICAgICAgICAgICAvLyBiZSBlaXRo\nZXIgYSByZWxhdGlvbiwgaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGFscmVhZHkg\nYmUKICAgICAgICAgICAgLy8gY29uc3RyYWluZWQgYnkgdGhlIGpvaW5zLCBv\nciAndGhpcycsIGluIHdoaWNoIGNhc2UgdGhlCiAgICAgICAgICAgIC8vIEpE\nQkNFeHByZXNzaW9uRmFjdG9yeSB0YWtlcyBjYXJlIG9mIGFkZGluZyBjbGFz\ncyBjb25kaXRpb25zIGZvcgogICAgICAgICAgICAvLyB0aGUgY2FuZGlkYXRl\nIGNsYXNzIG9uIHRoZSBzZWxlY3QKICAgICAgICAgICAgaW50IHN1YnMgPSAo\nX3R5cGUgPT0gVU5CT1VORF9WQVIpID8gU2VsZWN0LlNVQlNfSk9JTkFCTEUK\nICAgICAgICAgICAgICAgIDogU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxFOwog\nICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmcsIHN1YnMsIGN0eC5zdG9y\nZSwgY3R4LmZldGNoLAogICAgICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbi5FQUdFUl9OT05FLCBzZWwub3V0ZXIocHN0YXRlLmpvaW5zKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlKSB7CiAg\nICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSBnZXRDbGFzc01hcHBpbmco\nc3RhdGUpOwogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4\ncFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8\nICFwc3RhdGUuam9pbmVkUmVsKQogICAgICAgICAgICBzZWwuZ3JvdXBCeShn\nZXRDb2x1bW5zKHN0YXRlKSwgc2VsLm91dGVyKHBzdGF0ZS5qb2lucykpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBpbnQgc3VicyA9IChfdHlwZSA9\nPSBVTkJPVU5EX1ZBUikgPyBTZWxlY3QuU1VCU19KT0lOQUJMRQogICAgICAg\nICAgICAgICAgOiBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEU7CiAgICAgICAg\nICAgIHNlbC5ncm91cEJ5KG1hcHBpbmcsIHN1YnMsIGN0eC5zdG9yZSwgY3R4\nLmZldGNoLCAKICAgICAgICAgICAgICAgIHNlbC5vdXRlcihwc3RhdGUuam9p\nbnMpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgb3JkZXJC\neShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUs\nIAogICAgICAgIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgc2VsLm9yZGVyQnko\nZ2V0Q29sdW1ucyhzdGF0ZSksIGFzYywgc2VsLm91dGVyKHN0YXRlLmpvaW5z\nKSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZChFeHBD\nb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIFJlc3VsdCByZXMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGxvYWQo\nY3R4LCBzdGF0ZSwgcmVzLCBmYWxzZSk7CiAgICB9CgogICAgT2JqZWN0IGxv\nYWQoRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCBSZXN1bHQgcmVz\nLCBib29sZWFuIHBrcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IGdldENsYXNzTWFwcGlu\nZyhzdGF0ZSk7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRo\nRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChtYXBwaW5nICE9IG51bGwg\nJiYgKHBzdGF0ZS5maWVsZCA9PSBudWxsIAogICAgICAgICAgICB8fCAhcHN0\nYXRlLmZpZWxkLmlzRW1iZWRkZWQoKSkpIHsKICAgICAgICAgICAgaWYgKHBr\ncykKICAgICAgICAgICAgICAgIHJldHVybiBtYXBwaW5nLmdldE9iamVjdElk\nKGN0eC5zdG9yZSwgcmVzLCBudWxsLCB0cnVlLCAKICAgICAgICAgICAgICAg\nICAgICBwc3RhdGUuam9pbnMpOwogICAgICAgICAgICBpZiAoX2tleSAmJiBw\nc3RhdGUuZmllbGQuZ2V0S2V5KCkuaXNFbWJlZGRlZCgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGxvYWRFbWJlZGRlZE1hcEtleShjdHgsIHN0YXRlLCBy\nZXMpOwogICAgICAgICAgICBpZiAocHN0YXRlLmlzRW1iZWRFbGVtZW50Q29s\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQubG9hZFBy\nb2plY3Rpb24oY3R4LnN0b3JlLCBjdHguZmV0Y2gsIHJlcywKICAgICAgICAg\nICAgICAgICAgICBwc3RhdGUuam9pbnMpOwogICAgICAgICAgICByZXR1cm4g\ncmVzLmxvYWQobWFwcGluZywgY3R4LnN0b3JlLCBjdHguZmV0Y2gsIHBzdGF0\nZS5qb2lucyk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QgcmV0OwogICAg\nICAgIGlmIChfa2V5KQogICAgICAgICAgICAvLyBNYXAga2V5IGlzIGEgamF2\nYSBwcmltaXRpdmUgdHlwZQogICAgICAgICAgICAvLyAgICBleGFtcGxlOiBN\nYXA8SW50ZWdlciwgRW1wbG95ZWU+IGVtcHMKICAgICAgICAgICAgcmV0ID0g\ncmVzLmdldE9iamVjdChwc3RhdGUuY29sc1swXSwKICAgICAgICAgICAgICAg\nIG51bGwsIHBzdGF0ZS5qb2lucyk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICByZXQgPSBwc3RhdGUuZmllbGQubG9hZFByb2plY3Rpb24oY3R4LnN0b3Jl\nLCBjdHguZmV0Y2gsIHJlcywgCiAgICAgICAgICAgICAgICBwc3RhdGUuam9p\nbnMpOwogICAgICAgIGlmIChfY2FzdCAhPSBudWxsKQogICAgICAgICAgICBy\nZXQgPSBGaWx0ZXJzLmNvbnZlcnQocmV0LCBfY2FzdCk7CiAgICAgICAgcmV0\ndXJuIHJldDsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVNYXBT\ndHJhdGVneShTdHJhdGVneSBzdHJhdGVneSkgewogICAgICAgIGlmIChzdHJh\ndGVneSA9PSBudWxsIHx8CiAgICAgICAgICAgICEoc3RyYXRlZ3kgaW5zdGFu\nY2VvZiBMUlNNYXBGaWVsZFN0cmF0ZWd5KSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFJ1bnRpbWVFeGNlcHRpb24oIkludmFsaWQgbWFwIGZpZWxkIHN0cmF0\nZWd5OiIrc3RyYXRlZ3kpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZWxl\nY3RFbWJlZGRlZE1hcEtleShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwK\nICAgICAgICBFeHBTdGF0ZSBzdGF0ZSkgewogICAgICAgIFBhdGhFeHBTdGF0\nZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICB2YWxp\nZGF0ZU1hcFN0cmF0ZWd5KHBzdGF0ZS5maWVsZC5nZXRTdHJhdGVneSgpKTsK\nICAgICAgICBMUlNNYXBGaWVsZFN0cmF0ZWd5IHN0cmF0ZWd5ID0gKExSU01h\ncEZpZWxkU3RyYXRlZ3kpCiAgICAgICAgICAgIHBzdGF0ZS5maWVsZC5nZXRT\ndHJhdGVneSgpOwogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gcHN0\nYXRlLmZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRUeXBlTWFwcGluZygpOwog\nICAgICAgIHN0cmF0ZWd5LnNlbGVjdEtleShzZWwsIG1hcHBpbmcsIG51bGws\nIGN0eC5zdG9yZSwgY3R4LmZldGNoLAogICAgICAgICAgICBwc3RhdGUuam9p\nbnMpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGxvYWRFbWJlZGRlZE1h\ncEtleShFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsCiAgICAgICAg\nUmVzdWx0IHJlcykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUGF0\naEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAg\nICAgIHZhbGlkYXRlTWFwU3RyYXRlZ3kocHN0YXRlLmZpZWxkLmdldFN0cmF0\nZWd5KCkpOwogICAgICAgIExSU01hcEZpZWxkU3RyYXRlZ3kgc3RyYXRlZ3kg\nPQogICAgICAgICAgICAoTFJTTWFwRmllbGRTdHJhdGVneSkgcHN0YXRlLmZp\nZWxkLmdldFN0cmF0ZWd5KCk7CiAgICAgICAgcmV0dXJuIHN0cmF0ZWd5Lmxv\nYWRLZXkobnVsbCwgY3R4LnN0b3JlLCBjdHguZmV0Y2gsIHJlcywKICAgICAg\nICAgICAgcHN0YXRlLmpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBj\nYWxjdWxhdGVWYWx1ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhw\nU3RhdGUgc3RhdGUsIAogICAgICAgIFZhbCBvdGhlciwgRXhwU3RhdGUgb3Ro\nZXJTdGF0ZSkgewogICAgICAgIC8vIHdlIGRvbid0IGNyZWF0ZSB0aGUgU1FM\nIGIvYyBpdCBmb3JjZXMgdGhlIFNlbGVjdCB0byBjYWNoZSBhbGlhc2VzCiAg\nICAgICAgLy8gZm9yIHRoZSB0YWJsZXMgd2UgdXNlLCBhbmQgdGhlc2UgYWxp\nYXNlcyBtaWdodCBub3QgZXZlciBiZSB1c2VkIGlmCiAgICAgICAgLy8gd2Ug\nZXZlbnR1YWxseSBjYWxsIGFwcGVuZElzRW1wdHkgb3IgYXBwZW5kSXNOdWxs\nIHJhdGhlciB0aGFuIGFwcGVuZFRvCiAgICB9CgogICAgcHVibGljIHZvaWQg\ndmVyaWZ5SW5kZXhlZEZpZWxkKCkgewogICAgICAgIEFjdGlvbiBsYXN0QWN0\naW9uID0gKEFjdGlvbikgbGFzdEZpZWxkQWN0aW9uKCk7CiAgICAgICAgRmll\nbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZykgbGFzdEFjdGlvbi5kYXRh\nOwogICAgICAgIGlmIChmbS5nZXRPcmRlckNvbHVtbigpID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1vcmRlci1jb2x1bW4iLCBmbS5nZXROYW1lKCkpKTsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IGxlbmd0aChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1ucyhz\ndGF0ZSkubGVuZ3RoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZFRv\nKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwg\nCiAgICAgICAgU1FMQnVmZmVyIHNxbCkgewogICAgICAgIENvbHVtbltdIGNv\nbHMgPSBnZXRDb2x1bW5zKHN0YXRlKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXBwZW5k\nVG8oc2VsLCBzdGF0ZSwgc3FsLCBjb2xzW2ldKTsKICAgICAgICAgICAgaWYg\nKGkgPCBjb2xzLmxlbmd0aCAtMSkKICAgICAgICAgICAgc3FsLmFwcGVuZCgi\nLCAiKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGFw\ncGVuZFRvKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBz\ndGF0ZSwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgaW50IGluZGV4KSB7CiAg\nICAgICAgQ29sdW1uIGNvbCA9IGdldENvbHVtbnMoc3RhdGUpW2luZGV4XTsK\nICAgICAgICBhcHBlbmRUbyhzZWwsIHN0YXRlLCBzcWwsIGNvbCk7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyB2b2lkIGFwcGVuZFRvKFNlbGVjdCBzZWwsIEV4\ncFN0YXRlIHN0YXRlLCBTUUxCdWZmZXIgc3FsLCBDb2x1bW4gY29sKSB7CiAg\nICAgICAgaWYgKHNlbCAhPSBudWxsKQogICAgICAgICAgICBzZWwuc2V0U2No\nZW1hQWxpYXMoX3NjaGVtYUFsaWFzKTsKCiAgICAgICAgLy8gaWYgc2VsZWN0\nIGlzIG51bGwsIGl0IG1lYW5zIHdlIGFyZSBub3QgYWxpYXNpbmcgY29sdW1u\ncwogICAgICAgIC8vIChlLmcuLCBkdXJpbmcgYSBidWxrIHVwZGF0ZSkKICAg\nICAgICBpZiAoc2VsID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQo\nY29sLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgZWxzZSBpZiAoX3R5cGUg\nPT0gWFBBVEgpCiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYW4geHBhdGgs\nIGFwcGVuZCB4cGF0aCBzdHJpbmcKICAgICAgICAgICAgc3FsLmFwcGVuZChn\nZXRYUGF0aCgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbCwgc3RhdGUuam9pbnMpKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJc0VtcHR5KFNlbGVjdCBzZWws\nIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgU1FM\nQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAo\nUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxk\nID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoRkFMU0UpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFwcGVuZElzRW1w\ndHkoc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYXBwZW5kSXNOb3RFbXB0eShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0\nIGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwp\nIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0\nZSkgc3RhdGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQog\nICAgICAgICAgICBzcWwuYXBwZW5kKEZBTFNFKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRJc05vdEVtcHR5KHNxbCwg\nc2VsLCBwc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFw\ncGVuZEluZGV4KFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0\nZSBzdGF0ZSwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBh\ndGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAg\nICAgICBpZiAocHN0YXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHNx\nbC5hcHBlbmQoIjEiKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHBzdGF0\nZS5maWVsZC5hcHBlbmRJbmRleChzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRUeXBlKFNlbGVjdCBzZWws\nIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgU1FM\nQnVmZmVyIHNxbCkgewogICAgICAgIERpc2NyaW1pbmF0b3IgZGlzYyA9IG51\nbGw7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IF9jbGFzczsKICAgICAg\nICB3aGlsZSAoc3VwLmdldE1hcHBlZFBDU3VwZXJjbGFzc01hcHBpbmcoKSAh\nPSBudWxsKQogICAgICAgICAgICBzdXAgPSBzdXAuZ2V0TWFwcGVkUENTdXBl\ncmNsYXNzTWFwcGluZygpOwoKICAgICAgICBkaXNjID0gc3VwLmdldERpc2Ny\naW1pbmF0b3IoKTsKCiAgICAgICAgQ29sdW1uW10gY29scyA9IG51bGw7CiAg\nICAgICAgaWYgKGRpc2MgIT0gbnVsbCkKICAgICAgICAgICAgY29scyA9IGRp\nc2MuZ2V0Q29sdW1ucygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29s\ncyA9IGdldENvbHVtbnMoc3RhdGUpOwoKICAgICAgICBpZiAoY29scyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIHNxbC5hcHBlbmQoIjEiKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpID4g\nMCkKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiwgIik7CiAgICAgICAg\nICAgIHNxbC5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbaV0sIHN0\nYXRlLmpvaW5zKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFwcGVuZFNpemUoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0\nYXRlIHN0YXRlLCAKICAgICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAg\nUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwog\nICAgICAgIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAg\nc3FsLmFwcGVuZCgiMSIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0\nYXRlLmZpZWxkLmFwcGVuZFNpemUoc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNOdWxsKFNlbGVjdCBz\nZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAg\nU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUg\nPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoRkFMU0UpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFwcGVuZElz\nTnVsbChzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBhcHBlbmRJc05vdE51bGwoU2VsZWN0IHNlbCwgRXhwQ29udGV4\ndCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBTUUxCdWZmZXIgc3Fs\nKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3Rh\ndGUpIHN0YXRlOwogICAgICAgIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkK\nICAgICAgICAgICAgc3FsLmFwcGVuZChUUlVFKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRJc05vdE51bGwoc3FsLCBz\nZWwsIHBzdGF0ZS5qb2lucyk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBib29s\nZWFuIGlzU3VicXVlcnlQYXRoKCkgewogICAgICAgIGlmIChfYWN0aW9ucyAh\nPSBudWxsICYmIF9hY3Rpb25zLnNpemUoKSA9PSAxICYmIAogICAgICAgICAg\nICgoQWN0aW9uKV9hY3Rpb25zLmdldCgwKSkub3AgPT0gQWN0aW9uLlNVQlFV\nRVJZKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAg\nICAgICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIF9jYW5kaWRhdGUuaGFzaENvZGUoKTsKICAgICAgICByZXR1cm4gX2NhbmRp\nZGF0ZS5oYXNoQ29kZSgpIF4gX2FjdGlvbnMuaGFzaENvZGUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAg\nICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgUENQYXRoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIFBDUGF0aCBwYXRo\nID0gKFBDUGF0aCkgb3RoZXI7CiAgICAgICAgcmV0dXJuIE9iamVjdFV0aWxz\nLmVxdWFscyhfY2FuZGlkYXRlLCBwYXRoLl9jYW5kaWRhdGUpCiAgICAgICAg\nICAgICYmIE9iamVjdFV0aWxzLmVxdWFscyhfYWN0aW9ucywgcGF0aC5fYWN0\naW9ucyk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBpbnQgZ2V0SWQoKSB7CiAg\nICAgICAgcmV0dXJuIFZhbC5WQUw7CiAgICB9CgoKICAgIC8qKgogICAgICog\nSGVscGVyIGNsYXNzIHJlcHJlc2VudGluZyBhbiBhY3Rpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEFjdGlvbgogICAgICAgIGltcGxl\nbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgR0VUID0gMDsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBHRVRfT1VURVIgPSAxOwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IEdFVF9LRVkgPSAyOwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IFZBUiA9IDM7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgU1VCUVVFUlkgPSA0OwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\naW50IFVOQk9VTkRfVkFSID0gNTsKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBDQVNUID0gNjsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBHRVRfWFBBVEggPSA3OwoKICAgICAgICBwdWJsaWMgaW50IG9wID0g\nLTE7CiAgICAgICAgcHVibGljIE9iamVjdCBkYXRhID0gbnVsbDsKICAgICAg\nICBwdWJsaWMgU3RyaW5nIHZhciA9IG51bGw7CiAgICAgICAgcHVibGljIENv\nbnRleHQgY29udGV4dCA9IG51bGw7CgogICAgICAgIHB1YmxpYyBTdHJpbmcg\ndG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBvcCArICJ8IiArIGRh\ndGE7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkg\newogICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG9wOwogICAgICAgICAgICByZXR1cm4gb3AgXiBkYXRhLmhh\nc2hDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9\nPSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nICAgIEFjdGlvbiBhID0gKEFjdGlvbikgb3RoZXI7CiAgICAgICAgICAgIHJl\ndHVybiBvcCA9PSBhLm9wCiAgICAgICAgICAgICAgICAmJiBPYmplY3RVdGls\ncy5lcXVhbHMoZGF0YSwgYS5kYXRhKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

