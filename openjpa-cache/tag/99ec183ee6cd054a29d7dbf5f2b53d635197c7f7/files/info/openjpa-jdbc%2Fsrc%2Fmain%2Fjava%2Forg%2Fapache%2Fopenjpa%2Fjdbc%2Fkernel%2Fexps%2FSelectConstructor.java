{"sha":"d7c2800a33fa855afe6df4463c9cf0784f461f30","node_id":"MDQ6QmxvYjIwNjM2NDpkN2MyODAwYTMzZmE4NTVhZmU2ZGY0NDYzYzljZjA3ODRmNDYxZjMw","size":17606,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d7c2800a33fa855afe6df4463c9cf0784f461f30","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5KREJDU3RvcmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5TUUxCdWZmZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5leHBzLkFic3RyYWN0RXhwcmVzc2lvblZpc2l0b3I7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQ29uc3Rh\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQ29u\ndGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5F\neHByZXNzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLlF1ZXJ5RXhwcmVzc2lvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuU3VicXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLmV4cHMuVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CgovKioKICogVHVy\nbnMgcGFyc2VkIHF1ZXJpZXMgaW50byBzZWxlY3RzLgogKgogKiBAYXV0aG9y\nIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgU2Vs\nZWN0Q29uc3RydWN0b3IKICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsK\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2V4dGVudCA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBTZWxlY3QgX3N1YnNlbGVjdCA9IG51bGw7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlKFNlbGVjdENvbnN0cnVjdG9yLmNsYXNzKTsKCiAgICAvKioKICAgICAq\nIFJldHVybiB0cnVlIGlmIHdlIGtub3cgdGhlIHNlbGVjdCB0byBoYXZlIG9u\nIGNyaXRlcmlhOyB0byBiZSBhbiBleHRlbnQuCiAgICAgKiBOb3RlIHRoYXQg\nZXZlbiBpZiB0aGlzIG1ldGhvZCByZXR1cm5zIGZhbHNlLCB7QGxpbmsgI2V2\nYWx1YXRlfSBtYXkgc3RpbGwKICAgICAqIHJldHVybiBudWxsIGlmIHdlIGhh\ndmVuJ3QgY2FjaGVkIHdoZXRoZXIgdGhlIHF1ZXJ5IGlzIGFuIGV4dGVudCB5\nZXQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRXh0ZW50KCkgewog\nICAgICAgIHJldHVybiBfZXh0ZW50OwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFN1YnNlbGVjdChTZWxlY3Qgc3Vic2VsZWN0KSB7CiAgICAgICAgX3N1\nYnNlbGVjdCA9IHN1YnNlbGVjdDsKICAgIH0KCiAgICAvKioKICAgICAqIEV2\nYWx1YXRlIHRoZSBleHByZXNzaW9uLCByZXR1cm5pbmcgYSBuZXcgc2VsZWN0\nIGFuZCBmaWxsaW5nIGluIGFueQogICAgICogYXNzb2NpYXRlZCBleHByZXNz\naW9uIHN0YXRlLiBVc2Uge0BsaW5rICNzZWxlY3R9IHRvIHRoZW4gc2VsZWN0\nIHRoZSBkYXRhLgogICAgICogCiAgICAgKiBAcGFyYW0gY3R4IGZpbGwgd2l0\naCBleGVjdXRpb24gY29udGV4dAogICAgICogQHBhcmFtIHN0YXRlIHdpbGwg\nYmUgZmlsbGVkIHdpdGggZXhwcmVzc2lvbiBzdGF0ZQogICAgICovCiAgICBw\ndWJsaWMgU2VsZWN0IGV2YWx1YXRlKEV4cENvbnRleHQgY3R4LCBTZWxlY3Qg\ncGFyZW50LCBTdHJpbmcgYWxpYXMsIAogICAgICAgIFF1ZXJ5RXhwcmVzc2lv\nbnMgZXhwcywgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlKSB7CiAgICAg\nICAgLy8gYWxyZWFkeSBrbm93IHRoYXQgdGhpcyBxdWVyeSBpcyBlcXVpdmFs\nZW50IHRvIGFuIGV4dGVudD8KICAgICAgICBTZWxlY3Qgc2VsOwogICAgICAg\nIGlmIChfZXh0ZW50KSB7CiAgICAgICAgICAgIHNlbCA9IGN0eC5zdG9yZS5n\nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIHNlbC5z\nZXRBdXRvRGlzdGluY3QoKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNU\nX0FVVE8pICE9IDApOwogICAgICAgICAgICByZXR1cm4gc2VsOwogICAgICAg\nIH0KCiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IHNlbGVjdCBhbmQgaW5pdGlh\nbGl6ZSBpdCB3aXRoIHRoZSBqb2lucyBuZWVkZWQgZm9yCiAgICAgICAgLy8g\ndGhlIGNyaXRlcmlhIG9mIHRoaXMgcXVlcnkKICAgICAgICBzZWwgPSBuZXdT\nZWxlY3QoY3R4LCBwYXJlbnQsIGFsaWFzLCBleHBzLCBzdGF0ZSk7CgogICAg\nICAgIC8vIGNyZWF0ZSB3aGVyZSBjbGF1c2U7IGlmIHRoZXJlIGFyZSBubyB3\naGVyZSBjb25kaXRpb25zIGFuZAogICAgICAgIC8vIG5vIG9yZGVyaW5nIG9y\nIHByb2plY3Rpb25zLCB3ZSByZXR1cm4gbnVsbCB0byBzaWduaWZ5IHRoYXQg\ndGhpcwogICAgICAgIC8vIHF1ZXJ5IHNob3VsZCBiZSB0cmVhdGVkIGxpa2Ug\nYW4gZXh0ZW50CiAgICAgICAgU2VsZWN0IGlubmVyID0gc2VsLmdldEZyb21T\nZWxlY3QoKTsKICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBidWlsZFdoZXJl\nKChpbm5lciAhPSBudWxsKSA/IGlubmVyIDogc2VsLCBjdHgsIAogICAgICAg\nICAgICBzdGF0ZS5maWx0ZXIsIGV4cHMuZmlsdGVyKTsKICAgICAgICBpZiAo\nd2hlcmUgPT0gbnVsbCAmJiBleHBzLnByb2plY3Rpb25zLmxlbmd0aCA9PSAw\nCiAgICAgICAgICAgICYmIGV4cHMub3JkZXJpbmcubGVuZ3RoID09IDAKICAg\nICAgICAgICAgJiYgKHNlbC5nZXRKb2lucygpID09IG51bGwgfHwgc2VsLmdl\ndEpvaW5zKCkuaXNFbXB0eSgpKSkgewogICAgICAgICAgICBfZXh0ZW50ID0g\ndHJ1ZTsKICAgICAgICAgICAgc2VsLnNldEF1dG9EaXN0aW5jdCgoZXhwcy5k\naXN0aW5jdCAmIGV4cHMuRElTVElOQ1RfQVVUTykgIT0gMCk7CiAgICAgICAg\nICAgIHJldHVybiBzZWw7CiAgICAgICAgfQoKICAgICAgICAvLyBub3cgc2V0\nIHNxbCBjcml0ZXJpYTsgaXQgZ29lcyBvbiB0aGUgaW5uZXIgc2VsZWN0IGlm\nIHByZXNlbnQKICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgaW5uZXIud2hlcmUod2hlcmUpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgc2VsLndoZXJlKHdoZXJlKTsKCiAgICAgICAgLy8gYXBwbHkgZ3JvdXBp\nbmcgYW5kIGhhdmluZy4gIHRoaXMgZG9lcyBub3Qgc2VsZWN0IHRoZSBncm91\ncGluZwogICAgICAgIC8vIGNvbHVtbnMsIGp1c3QgYnVpbGRzIHRoZSBHUk9V\nUCBCWSBjbGF1c2VzLiAgd2UgZG9uJ3QgYnVpbGQgdGhlCiAgICAgICAgLy8g\nT1JERVIgQlkgY2xhdXNlcyB5ZXQgYmVjYXVzZSBpZiB3ZSBkZWNpZGUgdG8g\nYWRkIHRoaXMgc2VsZWN0CiAgICAgICAgLy8gdG8gYSB1bmlvbiwgdGhlIE9S\nREVSIEJZIHZhbHVlcyBnZXQgYWxpYXNlZCBkaWZmZXJlbnRseQogICAgICAg\nIGlmIChleHBzLmhhdmluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIEV4cCBo\nYXZpbmdFeHAgPSAoRXhwKSBleHBzLmhhdmluZzsKICAgICAgICAgICAgU1FM\nQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIoY3R4LnN0b3JlLmdldERCRGlj\ndGlvbmFyeSgpKTsKICAgICAgICAgICAgaGF2aW5nRXhwLmFwcGVuZFRvKHNl\nbCwgY3R4LCBzdGF0ZS5oYXZpbmcsIGJ1Zik7CiAgICAgICAgICAgIHNlbC5o\nYXZpbmcoYnVmKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBleHBzLmdyb3VwaW5nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAo\nKFZhbCkgZXhwcy5ncm91cGluZ1tpXSkuZ3JvdXBCeShzZWwsIGN0eCwgc3Rh\ndGUuZ3JvdXBpbmdbaV0pOwogICAgICAgIAogICAgICAgIGlmIChleHBzLnBy\nb2plY3Rpb25zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIFZhbCB2YWwg\nPSAoVmFsKSBleHBzLnByb2plY3Rpb25zWzBdOwogICAgICAgICAgICBpZiAo\ndmFsIGluc3RhbmNlb2YgQ291bnQgJiYgKChDb3VudCl2YWwpLmlzQ291bnRE\naXN0aW5jdE11bHRpQ29scygpKSB7CiAgICAgICAgICAgICAgICBTZWxlY3Qg\nbmV3U2VsID0gY3R4LnN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdTZWxlY3Qo\nKTsKICAgICAgICAgICAgICAgIG5ld1NlbC5zZWxlY3QoIkNPVU5UKCopIiwg\ndmFsKTsKICAgICAgICAgICAgICAgIG5ld1NlbC5zZXRFeHBlY3RlZFJlc3Vs\ndENvdW50KDEsIHRydWUpOwogICAgICAgICAgICAgICAgbmV3U2VsLnNldEZy\nb21TZWxlY3Qoc2VsKTsKICAgICAgICAgICAgICAgIHNlbC5zZXRFeHBlY3Rl\nZFJlc3VsdENvdW50KDAsIHRydWUpOwogICAgICAgICAgICAgICAgc2VsID0g\nbmV3U2VsOwogICAgICAgICAgICB9CiAgICAgICAgfSAgICAgICAgCiAgICAg\nICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIG5ldyBzZWxlY3Qgd2l0aCBleHByZXNzaW9ucyBpbml0aWFsaXplZC4KICAg\nICAqLwogICAgcHJpdmF0ZSBTZWxlY3QgbmV3U2VsZWN0KEV4cENvbnRleHQg\nY3R4LCBTZWxlY3QgcGFyZW50LAogICAgICAgIFN0cmluZyBhbGlhcywgUXVl\ncnlFeHByZXNzaW9ucyBleHBzLCBRdWVyeUV4cHJlc3Npb25zU3RhdGUgc3Rh\ndGUpIHsKICAgICAgICBTZWxlY3Qgc3Vic2VsZWN0ID0gSkRCQ1N0b3JlUXVl\ncnkuZ2V0VGhyZWFkTG9jYWxTZWxlY3QoX3N1YnNlbGVjdCk7CiAgICAgICAg\nU2VsZWN0IHNlbCA9IHBhcmVudCAhPSBudWxsID8gc3Vic2VsZWN0CiAgICAg\nICAgICAgIDogY3R4LnN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdTZWxlY3Qo\nKTsKICAgICAgICBzZWwuc2V0QXV0b0Rpc3RpbmN0KChleHBzLmRpc3RpbmN0\nICYgZXhwcy5ESVNUSU5DVF9BVVRPKSAhPSAwKTsKICAgICAgICBzZWwuc2V0\nSm9pblN5bnRheChjdHguZmV0Y2guZ2V0Sm9pblN5bnRheCgpKTsKICAgICAg\nICBzZWwuc2V0UGFyZW50KHBhcmVudCwgYWxpYXMpOwoKICAgICAgICBDb250\nZXh0W10gcXJ5Q3R4ID0gSkRCQ1N0b3JlUXVlcnkuZ2V0VGhyZWFkTG9jYWxD\nb250ZXh0KCk7CiAgICAgICAgQ29udGV4dCBsY3R4ID0gbnVsbDsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHFyeUN0eC5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBpZiAocXJ5Q3R4W2ldLmNsb25lRnJvbSA9PSBleHBzLmN0\neCgpKSB7CiAgICAgICAgICAgICAgICBsY3R4ID0gcXJ5Q3R4W2ldOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGlmIChzZWwuY3R4KCkgPT0gbnVsbCkKICAgICAgICAgICAgc2Vs\nLnNldENvbnRleHQobGN0eCk7CgogICAgICAgIGlmIChwYXJlbnQgPT0gbnVs\nbCAmJiBsY3R4LmdldFN1YnNlbENvbnRleHRzKCkgIT0gbnVsbCkgewogICAg\nICAgICAgICAvLyB0aGlzIGlzIHRoZSBjYXNlIHN1YnNlbGVjdCB3YXMgY3Jl\nYXRlZCBiZWZvcmUgcGFyZW50IGdvdCBjcmVhdGVkCiAgICAgICAgICAgIExp\nc3Q8Q29udGV4dD4gc3Vic2VsQ3R4cyA9IGxjdHguZ2V0U3Vic2VsQ29udGV4\ndHMoKTsKICAgICAgICAgICAgZm9yIChDb250ZXh0IHN1YnNlbEN0eCA6IHN1\nYnNlbEN0eHMpIHsKICAgICAgICAgICAgICAgIFNlbGVjdCBzdWJzZWwgPSAo\nU2VsZWN0KSBzdWJzZWxDdHguZ2V0U2VsZWN0KCk7CiAgICAgICAgICAgICAg\nICBTdWJxdWVyeSBzdWJxdWVyeSA9IHN1YnNlbEN0eC5nZXRTdWJxdWVyeSgp\nOwogICAgICAgICAgICAgICAgc3Vic2VsLnNldFBhcmVudChzZWwsIHN1YnF1\nZXJ5LmdldENhbmRpZGF0ZUFsaWFzKCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGlmIChIYXNDb250YWluc0V4cHJlc3Npb25WaXNpdG9y\nLmhhc0NvbnRhaW5zKGV4cHMuZmlsdGVyKSkgewogICAgICAgICAgICBzZWwu\nc2V0SGFzU3Vic2VsZWN0KHRydWUpOwogICAgICAgIH0KICAgICAgICBpbml0\naWFsaXplKHNlbCwgY3R4LCBleHBzLCBzdGF0ZSk7CgogICAgICAgIGlmICgh\nc2VsLmdldEF1dG9EaXN0aW5jdCgpKSB7CiAgICAgICAgICAgIGlmICgoZXhw\ncy5kaXN0aW5jdCAmIGV4cHMuRElTVElOQ1RfVFJVRSkgIT0gMCkKICAgICAg\nICAgICAgICAgIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX0ZBTFNF\nKSAhPSAwKQogICAgICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KGZhbHNl\nKTsKICAgICAgICB9IGVsc2UgaWYgKGV4cHMucHJvamVjdGlvbnMubGVuZ3Ro\nID4gMCkgewogICAgICAgICAgICBpZiAoIXNlbC5pc0Rpc3RpbmN0KCkgJiYg\nKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX1RSVUUpICE9IDApewog\nICAgICAgICAgICAgICAgLy8gaWYgdGhlIHNlbGVjdCBpcyBub3QgZGlzdGlu\nY3QgYnV0IHRoZSBxdWVyeSBpcywgZm9yY2UKICAgICAgICAgICAgICAgIC8v\nIHRoZSBzZWxlY3QgdG8gYmUgZGlzdGluY3QKICAgICAgICAgICAgICAgIHNl\nbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChz\nZWwuaXNEaXN0aW5jdCgpKSB7CiAgICAgICAgICAgICAgICAvLyB3aGVuIGFn\nZ3JlZ2F0aW5nIGRhdGEgb3IgbWFraW5nIGEgbm9uLWRpc3RpbmN0IHByb2pl\nY3Rpb24KICAgICAgICAgICAgICAgIC8vIGZyb20gYSBkaXN0aW5jdCBzZWxl\nY3QsIHdlIGhhdmUgdG8gc2VsZWN0IGZyb20gYSB0bXAKICAgICAgICAgICAg\nICAgIC8vIHRhYmxlIGZvcm1lZCBieSBhIGRpc3RpbmN0IHN1YnNlbGVjdCBp\nbiB0aGUgZnJvbSBjbGF1c2U7CiAgICAgICAgICAgICAgICAvLyB0aGlzIHN1\nYnNlbGVjdCBzZWxlY3RzIHRoZSBwa3Mgb2YgdGhlIGNhbmRpZGF0ZSAodG8K\nICAgICAgICAgICAgICAgIC8vIGdldCB1bmlxdWUgY2FuZGlkYXRlIHZhbHVl\ncykgYW5kIG5lZWRlZCBmaWVsZCB2YWx1ZXMgYW5kCiAgICAgICAgICAgICAg\nICAvLyBhcHBsaWVzIHRoZSB3aGVyZSBjb25kaXRpb25zOyB0aGUgb3V0ZXIg\nc2VsZWN0IGFwcGxpZXMKICAgICAgICAgICAgICAgIC8vIG9yZGVyaW5nLCBn\ncm91cGluZywgZXRjCiAgICAgICAgICAgICAgICBib29sZWFuIGFnZyA9IGV4\ncHMuaXNBZ2dyZWdhdGUoKTsKICAgICAgICAgICAgICAgIGJvb2xlYW4gY2Fu\nZGlkYXRlID0gUHJvamVjdGlvbkV4cHJlc3Npb25WaXNpdG9yLgogICAgICAg\nICAgICAgICAgICAgIGhhc0NhbmRpZGF0ZVByb2plY3Rpb25zKGV4cHMucHJv\namVjdGlvbnMpOwogICAgICAgICAgICAgICAgaWYgKGFnZyB8fCAoY2FuZGlk\nYXRlIAogICAgICAgICAgICAgICAgICAgICYmIChleHBzLmRpc3RpbmN0ICYg\nZXhwcy5ESVNUSU5DVF9UUlVFKSA9PSAwKSkgewogICAgICAgICAgICAgICAg\nICAgIERCRGljdGlvbmFyeSBkaWN0ID0gY3R4LnN0b3JlLmdldERCRGljdGlv\nbmFyeSgpOwogICAgICAgICAgICAgICAgICAgIGRpY3QuYXNzZXJ0U3VwcG9y\ndChkaWN0LnN1cHBvcnRzU3Vic2VsZWN0LAogICAgICAgICAgICAgICAgICAg\nICAgICAiU3VwcG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAgICAgICAgICAg\nICAgU2VsZWN0IGlubmVyID0gc2VsOwogICAgICAgICAgICAgICAgICAgIHNl\nbCA9IGN0eC5zdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAg\nICAgICAgICAgICAgICAgICAgc2VsLnNldFBhcmVudChwYXJlbnQsIGFsaWFz\nKTsKICAgICAgICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoYWdnCiAg\nICAgICAgICAgICAgICAgICAgICAgICYmIChleHBzLmRpc3RpbmN0ICYgZXhw\ncy5ESVNUSU5DVF9UUlVFKSAhPSAwKTsKICAgICAgICAgICAgICAgICAgICBz\nZWwuc2V0RnJvbVNlbGVjdChpbm5lcik7CgogICAgICAgICAgICAgICAgLy8g\nYXV0by1kaXN0aW5jdGluZyBoYXBwZW5zIHRvIGdldCB1bmlxdWUgY2FuZGlk\nYXRlIGluc3RhbmNlcwogICAgICAgICAgICAgICAgLy8gYmFjazsgZG9uJ3Qg\nYXV0by1kaXN0aW5jdCBpZiB0aGUgdXNlciBpc24ndCBzZWxlY3RpbmcgCiAg\nICAgICAgICAgICAgICAvLyBjYW5kaWRhdGUgZGF0YQogICAgICAgICAgICAg\nICAgfSBlbHNlIGlmICghY2FuZGlkYXRlIAogICAgICAgICAgICAgICAgICAg\nICYmIChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9UUlVFKSA9PSAw\nKSAKICAgICAgICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFsc2Up\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGFsbCBleHByZXNz\naW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemUoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIFF1ZXJ5RXhwcmVzc2lvbnMgZXhw\ncywgCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlKSB7CiAg\nICAgICAgTWFwIGNvbnRhaW5zID0gbnVsbDsKICAgICAgICBpZiAoSGFzQ29u\ndGFpbnNFeHByZXNzaW9uVmlzaXRvci5oYXNDb250YWlucyhleHBzLmZpbHRl\ncikKICAgICAgICAgICAgfHwgSGFzQ29udGFpbnNFeHByZXNzaW9uVmlzaXRv\nci5oYXNDb250YWlucyhleHBzLmhhdmluZykpCiAgICAgICAgICAgIGNvbnRh\naW5zID0gbmV3IEhhc2hNYXAoNyk7CgogICAgICAgIC8vIGluaXRpYWxpemUg\nZmlsdGVyIGFuZCBoYXZpbmcgZXhwcmVzc2lvbnMKICAgICAgICBFeHAgZmls\ndGVyRXhwID0gKEV4cCkgZXhwcy5maWx0ZXI7CiAgICAgICAgc3RhdGUuZmls\ndGVyID0gZmlsdGVyRXhwLmluaXRpYWxpemUoc2VsLCBjdHgsIGNvbnRhaW5z\nKTsKICAgICAgICBFeHAgaGF2aW5nRXhwID0gKEV4cCkgZXhwcy5oYXZpbmc7\nCiAgICAgICAgaWYgKGhhdmluZ0V4cCAhPSBudWxsKQogICAgICAgICAgICBz\ndGF0ZS5oYXZpbmcgPSBoYXZpbmdFeHAuaW5pdGlhbGl6ZShzZWwsIGN0eCwg\nY29udGFpbnMpOwoKICAgICAgICAvLyBnZXQgdGhlIHRvcC1sZXZlbCBqb2lu\ncyBhbmQgbnVsbCB0aGUgZXhwcmVzc2lvbidzIGpvaW5zCiAgICAgICAgLy8g\nYXQgdGhlIHNhbWUgdGltZSBzbyB0aGV5IGFyZW4ndCBpbmNsdWRlZCBpbiB0\naGUgd2hlcmUvaGF2aW5nIFNRTAogICAgICAgIEpvaW5zIGZpbHRlckpvaW5z\nID0gc3RhdGUuZmlsdGVyLmpvaW5zOwogICAgICAgIEpvaW5zIGhhdmluZ0pv\naW5zID0gKHN0YXRlLmhhdmluZyA9PSBudWxsKSA/IG51bGwgOiBzdGF0ZS5o\nYXZpbmcuam9pbnM7CiAgICAgICAgSm9pbnMgam9pbnMgPSBzZWwuYW5kKGZp\nbHRlckpvaW5zLCBoYXZpbmdKb2lucyk7CgogICAgICAgIC8vIGluaXRpYWxp\nemUgcmVzdWx0IHZhbHVlcwogICAgICAgIGlmIChleHBzLnByb2plY3Rpb25z\nLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgc3RhdGUucHJvamVjdGlvbnMg\nPSBuZXcgRXhwU3RhdGVbZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGhdOwogICAg\nICAgICAgICBWYWwgcmVzdWx0VmFsOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGV4cHMucHJvamVjdGlvbnMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIHJlc3VsdFZhbCA9IChWYWwpIGV4cHMucHJvamVjdGlv\nbnNbaV07CiAgICAgICAgICAgICAgICBpZiAoIWN0eC5zdG9yZS5nZXREQkRp\nY3Rpb25hcnkoKS5zdXBwb3J0c1BhcmFtZXRlckluU2VsZWN0ICYmIHJlc3Vs\ndFZhbCBpbnN0YW5jZW9mIExpdCkgewogICAgICAgICAgICAgICAgICAgICgo\nTGl0KXJlc3VsdFZhbCkuc2V0UmF3KHRydWUpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgLy8gaGF2ZSB0byBqb2luIHRocm91Z2ggdG8g\ncmVsYXRlZCB0eXBlIGZvciBwYyBvYmplY3QgCiAgICAgICAgICAgICAgICAv\nLyBwcm9qZWN0aW9uczsgdGhpcyBlbnN1cmVzIHRoYXQgd2UgaGF2ZSBhbGwg\nb3VyIGpvaW5zIGNhY2hlZAogICAgICAgICAgICAgICAgc3RhdGUucHJvamVj\ndGlvbnNbaV0gPSByZXN1bHRWYWwuaW5pdGlhbGl6ZShzZWwsIGN0eCwgCiAg\nICAgICAgICAgICAgICAgICAgVmFsLkpPSU5fUkVMIHwgVmFsLkZPUkNFX09V\nVEVSKTsKICAgICAgICAgICAgICAgIGlmIChleHBzLnByb2plY3Rpb25zLmxl\nbmd0aCA+IDEgJiYgcmVzdWx0VmFsIGluc3RhbmNlb2YgQ291bnQpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoKChDb3VudClyZXN1bHRWYWwpLmlzQ291\nbnREaXN0aW5jdE11bHRpQ29scygpKQogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImNv\ndW50LWRpc3RpbmN0LW11bHRpLWNvbC1vbmx5IikpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgam9pbnMgPSBzZWwuYW5kKGpvaW5zLCBz\ndGF0ZS5wcm9qZWN0aW9uc1tpXS5qb2lucyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIGluaXRpYWxpemUgZ3JvdXBpbmcKICAgICAg\nICBpZiAoZXhwcy5ncm91cGluZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAg\nIHN0YXRlLmdyb3VwaW5nID0gbmV3IEV4cFN0YXRlW2V4cHMuZ3JvdXBpbmcu\nbGVuZ3RoXTsKICAgICAgICAgICAgVmFsIGdyb3VwVmFsOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGV4cHMuZ3JvdXBpbmcubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGdyb3VwVmFsID0gKFZhbCkgZXhwcy5n\ncm91cGluZ1tpXTsKICAgICAgICAgICAgICAgIC8vIGhhdmUgdG8gam9pbiB0\naHJvdWdoIHRvIHJlbGF0ZWQgdHlwZSBmb3IgcGMgb2JqZWN0IGdyb3VwaW5n\nczsKICAgICAgICAgICAgICAgIC8vIHRoaXMgZW5zdXJlcyB0aGF0IHdlIGhh\ndmUgYWxsIG91ciBqb2lucyBjYWNoZWQKICAgICAgICAgICAgICAgIHN0YXRl\nLmdyb3VwaW5nW2ldID0gZ3JvdXBWYWwuaW5pdGlhbGl6ZShzZWwsIGN0eCwg\nVmFsLkpPSU5fUkVMKTsKICAgICAgICAgICAgICAgIGpvaW5zID0gc2VsLmFu\nZChqb2lucywgc3RhdGUuZ3JvdXBpbmdbaV0uam9pbnMpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpbml0aWFsaXplIG9yZGVyaW5n\nCiAgICAgICAgaWYgKGV4cHMub3JkZXJpbmcubGVuZ3RoID4gMCkgewogICAg\nICAgICAgICBzdGF0ZS5vcmRlcmluZyA9IG5ldyBFeHBTdGF0ZVtleHBzLm9y\nZGVyaW5nLmxlbmd0aF07CiAgICAgICAgICAgIFZhbCBvcmRlclZhbDsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHBzLm9yZGVyaW5nLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBvcmRlclZhbCA9IChWYWwp\nIGV4cHMub3JkZXJpbmdbaV07CiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRl\ncmluZ1tpXSA9IG9yZGVyVmFsLmluaXRpYWxpemUoc2VsLCBjdHgsIDApOwog\nICAgICAgICAgICAgICAgam9pbnMgPSBzZWwuYW5kKGpvaW5zLCBzdGF0ZS5v\ncmRlcmluZ1tpXS5qb2lucyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgc2VsLndoZXJlKGpvaW5zKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSB0aGUgd2hlcmUgc3FsLgogICAgICovCiAgICBwcml2YXRlIFNR\nTEJ1ZmZlciBidWlsZFdoZXJlKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4\nLCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgRXhwcmVzc2lvbiBmaWx0ZXIp\nIHsKICAgICAgICAvLyBjcmVhdGUgd2hlcmUgYnVmZmVyCiAgICAgICAgU1FM\nQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcihjdHguc3RvcmUuZ2V0REJE\naWN0aW9uYXJ5KCkpOwogICAgICAgIHdoZXJlLmFwcGVuZCgiKCIpOwogICAg\nICAgIEV4cCBmaWx0ZXJFeHAgPSAoRXhwKSBmaWx0ZXI7CiAgICAgICAgZmls\ndGVyRXhwLmFwcGVuZFRvKHNlbCwgY3R4LCBzdGF0ZSwgd2hlcmUpOwoKICAg\nICAgICBpZiAod2hlcmUuc3FsRXF1YWxzKCIoIikgfHwgd2hlcmUuc3FsRXF1\nYWxzKCIoMSA9IDEiKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuIHdoZXJlLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIC8qKgog\nICAgICogU2VsZWN0IHRoZSBkYXRhIGZvciB0aGlzIHF1ZXJ5LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgRXhwQ29udGV4\ndCBjdHgsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIGJvb2xlYW4g\nc3ViY2xhc3NlcywgUXVlcnlFeHByZXNzaW9ucyBleHBzLCBRdWVyeUV4cHJl\nc3Npb25zU3RhdGUgc3RhdGUsCiAgICAgICAgaW50IGVhZ2VyKSB7CiAgICAg\nICAgU2VsZWN0IGlubmVyID0gc2VsLmdldEZyb21TZWxlY3QoKTsKICAgICAg\nICBWYWwgdmFsOwogICAgICAgIEpvaW5zIGpvaW5zID0gbnVsbDsKICAgICAg\nICBib29sZWFuIGlzQ291bnREaXN0aW5jdE11bHRpQ29scyA9IGZhbHNlOwoK\nICAgICAgICBpZiAoc2VsLmdldFN1YnNlbGVjdFBhdGgoKSAhPSBudWxsKQog\nICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygpLnNldFN1YnNlbGVj\ndChzZWwuZ2V0U3Vic2VsZWN0UGF0aCgpKTsKCiAgICAgICAgLy8gYnVpbGQg\nb3JkZXJpbmcgY2xhdXNlcyBiZWZvcmUgc2VsZWN0IHNvIHRoYXQgYW55IGVh\nZ2VyIGpvaW4KICAgICAgICAvLyBvcmRlcmluZyBnZXRzIGFwcGxpZWQgYWZ0\nZXIgcXVlcnkgb3JkZXJpbmcKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGV4cHMub3JkZXJpbmcubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICgoVmFs\nKSBleHBzLm9yZGVyaW5nW2ldKS5vcmRlckJ5KHNlbCwgY3R4LCBzdGF0ZS5v\ncmRlcmluZ1tpXSwKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ld\nKTsKCiAgICAgICAgLy8gaWYgbm8gcmVzdWx0IHN0cmluZyBzZXQsIHNlbGVj\ndCBtYXRjaGluZyBvYmplY3RzIGxpa2Ugbm9ybWFsCiAgICAgICAgaWYgKGV4\ncHMucHJvamVjdGlvbnMubGVuZ3RoID09IDAgJiYgc2VsLmdldFBhcmVudCgp\nID09IG51bGwpIHsKICAgICAgICAgICAgaW50IHN1YnMgPSAoc3ViY2xhc3Nl\ncykgPyBTZWxlY3QuU1VCU19KT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05PTkU7\nCiAgICAgICAgICAgIHNlbC5zZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1\nYnMsIGN0eC5zdG9yZSwgY3R4LmZldGNoLCBlYWdlcik7CiAgICAgICAgfSBl\nbHNlIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA9PSAwKSB7CiAgICAg\nICAgICAgIC8vIHN1YnNlbGVjdCBmb3Igb2JqZWN0czsgd2UgcmVhbGx5IGp1\nc3QgbmVlZCB0aGUgcHJpbWFyeSBrZXkgdmFsdWVzCiAgICAgICAgICAgIHNl\nbC5zZWxlY3QobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpLCBqb2lu\ncyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGV4cHMucHJv\namVjdGlvbnMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgIHZhbCA9\nIChWYWwpIGV4cHMucHJvamVjdGlvbnNbMF07CiAgICAgICAgICAgICAgICBp\nZiAodmFsIGluc3RhbmNlb2YgQ291bnQgJiYgKChDb3VudCl2YWwpLmlzQ291\nbnREaXN0aW5jdE11bHRpQ29scygpKSB7CiAgICAgICAgICAgICAgICAgICAg\naXNDb3VudERpc3RpbmN0TXVsdGlDb2xzID0gdHJ1ZTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoc2VsLmdldFBhcmVudCgpICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbihfbG9jLmdldCgiY291bnQtZGlzdGluY3QtbXVsdGktY29sLXN1YnNlbGVj\ndC11bnN1cHBvcnRlZCIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSAgICAgICAgICAgIAoKICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBh\nbiBpbm5lciBzZWxlY3QsIHdlIG5lZWQgdG8gc2VsZWN0IHRoZSBjYW5kaWRh\ndGUKICAgICAgICAgICAgLy8gY2xhc3MnIHBrIGNvbHVtbnMgdG8gZ3VhcmFu\ndGVlIHVuaXF1ZSBpbnN0YW5jZXMKICAgICAgICAgICAgaWYgKGlubmVyICE9\nIG51bGwgJiYgIWlzQ291bnREaXN0aW5jdE11bHRpQ29scykKICAgICAgICAg\nICAgICAgIGlubmVyLnNlbGVjdChtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCksIGpvaW5zKTsKCiAgICAgICAgICAgIC8vIHNlbGVjdCBlYWNoIHJl\nc3VsdCB2YWx1ZTsgbm8gbmVlZCB0byBwYXNzIG9uIHRoZSBlYWdlciBtb2Rl\nIHNpbmNlCiAgICAgICAgICAgIC8vIHVuZGVyIHByb2plY3Rpb25zIHdlIGFs\nd2F5cyB1c2UgRUFHRVJfTk9ORQogICAgICAgICAgICBib29sZWFuIHBrcyA9\nIHNlbC5nZXRQYXJlbnQoKSAhPSBudWxsOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGV4cHMucHJvamVjdGlvbnMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIHZhbCA9IChWYWwpIGV4cHMucHJvamVjdGlvbnNb\naV07CiAgICAgICAgICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGlmICghaXNDb3VudERpc3RpbmN0TXVsdGlDb2xz\nKQogICAgICAgICAgICAgICAgICAgICAgICB2YWwuc2VsZWN0Q29sdW1ucyhp\nbm5lciwgY3R4LCBzdGF0ZS5wcm9qZWN0aW9uc1tpXSwgcGtzKTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHZh\nbC5zZWxlY3QoaW5uZXIsIGN0eCwgc3RhdGUucHJvamVjdGlvbnNbaV0sIHBr\ncyk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAg\nICB2YWwuc2VsZWN0KHNlbCwgY3R4LCBzdGF0ZS5wcm9qZWN0aW9uc1tpXSwg\ncGtzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIGhhdmluZyBjb2x1bW5zIGFyZSBzZWxlY3RlZCBzaW5jZSBpdCBpcyByZXF1\naXJlZCBieSAKICAgICAgICAgICAgLy8gc29tZSBEQnMuICBwdXQgdGhlbSBs\nYXN0IHNvIHRoZXkgZG9uJ3QgYWZmZWN0IHJlc3VsdCBwcm9jZXNzaW5nCiAg\nICAgICAgICAgIGlmIChleHBzLmhhdmluZyAhPSBudWxsICYmIGlubmVyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAoKEV4cCkgZXhwcy5oYXZpbmcpLnNl\nbGVjdENvbHVtbnMoaW5uZXIsIGN0eCwgc3RhdGUuaGF2aW5nLCAKICAgICAg\nICAgICAgICAgICAgICB0cnVlKTsKICAgICAgICB9CgogICAgICAgIC8vIHNl\nbGVjdCBvcmRlcmluZyBjb2x1bW5zLCBzaW5jZSBpdCBpcyByZXF1aXJlZCBi\neSBzb21lIERCcy4gIHB1dCB0aGVtCiAgICAgICAgLy8gbGFzdCBzbyB0aGV5\nIGRvbid0IGFmZmVjdCByZXN1bHQgcHJvY2Vzc2luZwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZXhwcy5vcmRlcmluZy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICB2YWwgPSAoVmFsKSBleHBzLm9yZGVyaW5nW2ldOwogICAg\nICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHZh\nbC5zZWxlY3RDb2x1bW5zKGlubmVyLCBjdHgsIHN0YXRlLm9yZGVyaW5nW2ld\nLCB0cnVlKTsKICAgICAgICAgICAgdmFsLnNlbGVjdChzZWwsIGN0eCwgc3Rh\ndGUub3JkZXJpbmdbaV0sIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nYWRkIGNvbmRpdGlvbnMgbGltaXRpbmcgdGhlIHByb2plY3Rpb25zIHRvIHRo\nZSBwcm9wZXIgY2xhc3NlczsgaWYKICAgICAgICAvLyB0aGlzIGlzbid0IGEg\ncHJvamVjdGlvbiBvciBhIHN1YnEgdGhlbiB0aGV5IHdpbGwgYWxyZWFkeSBi\nZSBhZGRlZAogICAgICAgIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA+\nIDAgfHwgc2VsLmdldFBhcmVudCgpICE9IG51bGwpIHsKICAgICAgICAgICAg\nY3R4LnN0b3JlLmxvYWRTdWJjbGFzc2VzKG1hcHBpbmcpOwogICAgICAgICAg\nICBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5hZGRDbGFzc0NvbmRpdGlv\nbnMoKGlubmVyICE9IG51bGwpIAogICAgICAgICAgICAgICAgPyBpbm5lciA6\nIHNlbCwgc3ViY2xhc3Nlcywgam9pbnMpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFVzZWQgdG8gY2hlY2sgd2hldGhlciBhIHF1ZXJ5J3Mg\ncmVzdWx0IHByb2plY3Rpb25zIGFyZSBvbiB0aGUgY2FuZGlkYXRlLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQcm9qZWN0aW9uRXhwcmVz\nc2lvblZpc2l0b3IKICAgICAgICBleHRlbmRzIEFic3RyYWN0RXhwcmVzc2lv\nblZpc2l0b3IgewoKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX2NhbmRpZGF0\nZSA9IGZhbHNlOwogICAgICAgIHByaXZhdGUgaW50IF9sZXZlbCA9IDA7Cgog\nICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBoYXNDYW5kaWRhdGVQcm9q\nZWN0aW9ucyhWYWx1ZVtdIHByb2pzKSB7CiAgICAgICAgICAgIFByb2plY3Rp\nb25FeHByZXNzaW9uVmlzaXRvciB2ID0gbmV3IFByb2plY3Rpb25FeHByZXNz\naW9uVmlzaXRvcigpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHByb2pzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBwcm9qc1tp\nXS5hY2NlcHRWaXNpdCh2KTsKICAgICAgICAgICAgICAgIGlmICh2Ll9jYW5k\naWRhdGUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgZW50ZXIoVmFsdWUgdmFsKSB7CiAgICAg\nICAgICAgIGlmICghX2NhbmRpZGF0ZSkgewogICAgICAgICAgICAgICAgX2Nh\nbmRpZGF0ZSA9IChfbGV2ZWwgPT0gMCAmJiB2YWwgaW5zdGFuY2VvZiBDb25z\ndGFudCkKICAgICAgICAgICAgICAgICAgICB8fCAodmFsIGluc3RhbmNlb2Yg\nUENQYXRoIAogICAgICAgICAgICAgICAgICAgICYmICEoKFBDUGF0aCkgdmFs\nKS5pc1ZhcmlhYmxlUGF0aCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBfbGV2ZWwrKzsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGV4\naXQoVmFsdWUgdmFsKSB7CiAgICAgICAgICAgIF9sZXZlbC0tOwogICAgICAg\nIH0KICAgIH0KfQo=\n","encoding":"base64"}

