{"sha":"61ad9231780724e84b10112b1f8febf80584782e","node_id":"MDQ6QmxvYjIwNjM2NDo2MWFkOTIzMTc4MDcyNGU4NGIxMDExMmIxZjhmZWJmODA1ODQ3ODJl","size":103865,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/61ad9231780724e84b10112b1f8febf80584782e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVk\nTWFwOwppbXBvcnQgamF2YS51dGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGls\nLlRyZWVNYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLml0ZXJhdG9ycy5FbXB0eUl0ZXJhdG9yOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkVhZ2VyRmV0Y2hNb2Rl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJD\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNMb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5Db250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoK\nLyoqCiAqIFN0YW5kYXJkIHtAbGluayBTZWxlY3R9IGltcGxlbWVudGF0aW9u\nLiBVc2FnZSBub3RlOiB0aG91Z2ggdGhpcyBjbGFzcwogKiBpbXBsZW1lbnRz\nIHtAbGluayBKb2luc30sIGl0IHNob3VsZCBub3QgYmUgdXNlZCBmb3Igam9p\nbmluZyBkaXJlY3RseS4KICogSW5zdGVhZCwgdXNlIHRoZSByZXR1cm4gdmFs\ndWUgb2Yge0BsaW5rICNuZXdKb2luc30uCiAqCiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBTZWxlY3RJbXBs\nCiAgICBpbXBsZW1lbnRzIFNlbGVjdCwgUGF0aEpvaW5zIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgTk9OQVVUT19ESVNUSU5DVCA9IDIgPDwg\nMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBESVNUSU5DVCA9IDIg\nPDwgMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBOT1RfRElTVElO\nQ1QgPSAyIDw8IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgSU1Q\nTElDSVRfRElTVElOQ1QgPSAyIDw8IDM7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgVE9fTUFOWSA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBBR0dSRUdBVEUgPSAyIDw8IDU7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgTE9CID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE9VVEVSID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IExSUyA9IDIgPDwgODsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBFQUdFUl9UT19PTkUgPSAyIDw8IDk7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRUFHRVJfVE9fTUFOWSA9IDIgPDwgMTA7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgUkVDT1JEX09SREVSRUQgPSAy\nIDw8IDExOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEdST1VQSU5H\nID0gMiA8PCAxMjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGT1JD\nRV9DT1VOVCA9IDIgPDwgMTM7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nU3RyaW5nW10gVEFCTEVfQUxJQVNFUyA9IG5ldyBTdHJpbmdbMTZdOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nW10gT1JERVJfQUxJQVNFUyA9\nIG5ldyBTdHJpbmdbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2Jq\nZWN0W10gTlVMTF9JRFMgPSBuZXcgT2JqZWN0WzE2XTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIE9iamVjdFtdIFBMQUNFSE9MREVSUyA9IG5ldyBPYmpl\nY3RbNTBdOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoU2VsZWN0LmNsYXNzKTsKCiAg\nICBzdGF0aWMgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgVEFCTEVf\nQUxJQVNFUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgVEFCTEVfQUxJQVNF\nU1tpXSA9ICJ0IiArIGk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBP\nUkRFUl9BTElBU0VTLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBPUkRFUl9B\nTElBU0VTW2ldID0gIm8iICsgaTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IE5VTExfSURTLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBOVUxMX0lE\nU1tpXSA9IG5ldyBOdWxsSWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IFBMQUNFSE9MREVSUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgUExB\nQ0VIT0xERVJTW2ldID0gbmV3IFBsYWNlaG9sZGVyKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBmaW5hbCBKREJDQ29uZmlndXJhdGlvbiBfY29uZjsKICAgIHBy\naXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0OwoKICAgIC8vIG1hcCBv\nZiB2YXJpYWJsZSArIHJlbGF0aW9uIHBhdGggKyB0YWJsZSBrZXlzIHRvIHRo\nZSBjb3JyZWN0IGFsaWFzIGluZGV4OgogICAgLy8gZWFjaCByZWxhdGlvbiBw\nYXRoL3RhYmxlIGNvbWJpbmF0aW9uIHNob3VsZCBoYXZlIGEgdW5pcXVlIGFs\naWFzIGJlY2F1c2UKICAgIC8vIGl0IHJlcHJlc2VudHMgYSBzZXBhcmF0ZSBv\nYmplY3Q7IGZvciBleGFtcGxlLCBpZiBhIFBlcnNvbiBjbGFzcyBoYXMgYQog\nICAgLy8gJ3BhcmVudCcgZmllbGQgcmVwcmVzZW50aW5nIGFub3RoZXIgUGVy\nc29uIGFuZCBhbHNvIGhhcyBhbiAnYWRkcmVzcycKICAgIC8vIGZpZWxkIG9m\nIHR5cGUgQWRkcmVzczoKICAgIC8vICdhZGRyZXNzLnN0cmVldCcgc2hvdWxk\nIG1hcCB0byBhIGRpZmZlcmVudCB0YWJsZSBhbGlhcyB0aGFuCiAgICAvLyAn\ncGFyZW50LmFkZHJlc3Muc3RyZWV0JyBmb3IgdGhlIHB1cnBvc2VzIG9mIGNv\nbXBhcmlzb25zCiAgICBwcml2YXRlIE1hcCBfYWxpYXNlcyA9IG51bGw7Cgog\nICAgLy8gbWFwIG9mIGluZGV4ZXMgdG8gdGFibGUgYWxpYXNlcyBsaWtlICdU\nQUJMRU5BTUUgdDAnCiAgICBwcml2YXRlIFNvcnRlZE1hcCBfdGFibGVzID0g\nbnVsbDsKCiAgICAvLyBjb21iaW5lZCBsaXN0IG9mIHNlbGVjdGVkIGlkcyBh\nbmQgbWFwIG9mIGVhY2ggaWQgdG8gaXRzIGFsaWFzCiAgICBwcm90ZWN0ZWQg\nZmluYWwgU2VsZWN0cyBfc2VsZWN0cyA9IG5ld1NlbGVjdHMoKTsKICAgIHBy\naXZhdGUgTGlzdCBfb3JkZXJlZCA9IG51bGw7CiAgICBwcml2YXRlIExpc3Qg\nX2dyb3VwZWQgPSBudWxsOwoKICAgIC8vIGZsYWdzCiAgICBwcml2YXRlIGlu\ndCBfZmxhZ3MgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2pvaW5TeW50YXggPSAw\nOwogICAgcHJpdmF0ZSBsb25nIF9zdGFydElkeCA9IDA7CiAgICBwcml2YXRl\nIGxvbmcgX2VuZElkeCA9IExvbmcuTUFYX1ZBTFVFOwogICAgcHJpdmF0ZSBp\nbnQgX251bGxJZHMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX29yZGVycyA9IDA7\nCiAgICBwcml2YXRlIGludCBfcGxhY2Vob2xkZXJzID0gMDsKICAgIHByaXZh\ndGUgaW50IF9leHBlY3RlZFJlc3VsdENvdW50ID0gMDsKCiAgICAvLyBxdWVy\neSBjbGF1c2VzCiAgICBwcml2YXRlIFNRTEJ1ZmZlciBfb3JkZXJpbmcgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX3doZXJlID0gbnVsbDsKICAg\nIHByaXZhdGUgU1FMQnVmZmVyIF9ncm91cGluZyA9IG51bGw7CiAgICBwcml2\nYXRlIFNRTEJ1ZmZlciBfaGF2aW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FM\nQnVmZmVyIF9mdWxsID0gbnVsbDsKCiAgICAvLyBqb2lucyB0byBhZGQgdG8g\ndGhlIGVuZCBvZiBvdXIgd2hlcmUgY2xhdXNlLCBhbmQgam9pbnMgdG8gcHJl\ncGVuZCB0bwogICAgLy8gYWxsIHNlbGVjdHMgKHNlZSBzZWxlY3QoY2xhc3Nt\nYXBwaW5nKSBtZXRob2QpCiAgICBwcml2YXRlIFNlbGVjdEpvaW5zIF9qb2lu\ncyA9IG51bGw7CiAgICBwcml2YXRlIFN0YWNrIF9wcmVKb2lucyA9IG51bGw7\nCgogICAgLy8gbWFwIG9mIGpvaW5zK2tleXMgdG8gZWFnZXIgc2VsZWN0cyBh\nbmQgZ2xvYmFsIHNldCBvZiBlYWdlciBrZXlzOyB0aGUKICAgIC8vIHNhbWUg\na2V5IGNhbid0IGJlIHVzZWQgbW9yZSB0aGFuIG9uY2UKICAgIHByaXZhdGUg\nTWFwIF9lYWdlciA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZWFnZXJLZXlz\nID0gbnVsbDsKCiAgICAvLyBzdWJzZWxlY3Qgc3VwcG9ydAogICAgcHJpdmF0\nZSBMaXN0IF9zdWJzZWxzID0gbnVsbDsKICAgIHByaXZhdGUgU2VsZWN0SW1w\nbCBfcGFyZW50ID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9zdWJQYXRo\nID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaGFzU3ViID0gZmFsc2U7\nCgogICAgLy8gZnJvbSBzZWxlY3QgaWYgdGhpcyBzZWxlY3Qgc2VsZWN0cyBm\ncm9tIGEgdG1wIHRhYmxlIGNyZWF0ZWQgYnkgYW5vdGhlcgogICAgcHJpdmF0\nZSBTZWxlY3RJbXBsIF9mcm9tID0gbnVsbDsKICAgIHByb3RlY3RlZCBTZWxl\nY3RJbXBsIF9vdXRlciA9IG51bGw7CgogICAgLy8gSlBRTCBRdWVyeSBjb250\nZXh0IHRoaXMgc2VsZWN0IGlzIGFzc29jaWF0ZWQgd2l0aAogICAgcHJpdmF0\nZSBDb250ZXh0IF9jdHggPSBudWxsOwoKICAgIC8vIEEgcGF0aCBuYXZpZ2F0\naW9uIGlzIGJlZ2luIHdpdGggdGhpcyBzY2hlbWEgYWxpYXMKICAgIHByaXZh\ndGUgU3RyaW5nIF9zY2hlbWFBbGlhcyA9IG51bGw7CiAgICAgCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgdGFi\nbGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBhbGlhcyBpbmRleC4KICAgICAqLwog\nICAgc3RhdGljIFN0cmluZyB0b0FsaWFzKGludCBpbmRleCkgewogICAgICAg\nIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKGluZGV4IDwgVEFCTEVfQUxJQVNFUy5sZW5ndGgpCiAgICAg\nICAgICAgIHJldHVybiBUQUJMRV9BTElBU0VTW2luZGV4XTsKICAgICAgICBy\nZXR1cm4gInQiICsgaW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHJldHVybiB0aGUgcHJvcGVyIG9yZGVyIGFsaWFzIGZv\nciB0aGUgZ2l2ZW4gb3JkZXIKICAgICAqIGNvbHVtbiBpbmRleC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgdG9PcmRlckFsaWFzKGludCBp\nbmRleCkgewogICAgICAgIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGluZGV4IDwgT1JERVJfQUxJQVNF\nUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBPUkRFUl9BTElBU0VTW2lu\nZGV4XTsKICAgICAgICByZXR1cm4gIm8iICsgaW5kZXg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyBTZWxlY3RJbXBsKEpEQkNDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2Rp\nY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAg\nIF9qb2luU3ludGF4ID0gX2RpY3Quam9pblN5bnRheDsKICAgICAgICBfc2Vs\nZWN0cy5fZGljdCA9IF9kaWN0OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndENvbnRleHQoQ29udGV4dCBjb250ZXh0KSB7CiAgICAgICAgaWYgKF9jdHgg\nPT0gbnVsbCkgewogICAgICAgICAgICBfY3R4ID0gY29udGV4dDsKICAgICAg\nICAgICAgX2N0eC5zZXRTZWxlY3QodGhpcyk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBDb250ZXh0IGN0eCgpIHsKICAgICAgICByZXR1cm4gX2N0\neDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTY2hlbWFBbGlhcyhTdHJp\nbmcgc2NoZW1hQWxpYXMpIHsKICAgICAgICBfc2NoZW1hQWxpYXMgPSBzY2hl\nbWFBbGlhczsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFNlbGVjdEV4ZWN1dG9yIGltcGxlbWVudGF0aW9u\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgSkRCQ0NvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsK\nICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgcHVibGljIFNRTEJ1\nZmZlciB0b1NlbGVjdChib29sZWFuIGZvclVwZGF0ZSwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIF9mdWxsID0gX2RpY3QudG9T\nZWxlY3QodGhpcywgZm9yVXBkYXRlLCBmZXRjaCk7CiAgICAgICAgcmV0dXJu\nIF9mdWxsOwogICAgfQogICAgCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldFNR\nTCgpIHsKICAgICAgICByZXR1cm4gX2Z1bGw7CiAgICB9CgogICAgcHVibGlj\nIFNRTEJ1ZmZlciB0b1NlbGVjdENvdW50KCkgewogICAgICAgIHJldHVybiBf\nZGljdC50b1NlbGVjdENvdW50KHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldEF1dG9EaXN0aW5jdCgpIHsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIE5PTkFVVE9fRElTVElOQ1QpID09IDA7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0QXV0b0Rpc3RpbmN0KGJvb2xlYW4gdmFsKSB7CiAgICAg\nICAgaWYgKHZhbCkKICAgICAgICAgICAgX2ZsYWdzICY9IH5OT05BVVRPX0RJ\nU1RJTkNUOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzIHw9IE5P\nTkFVVE9fRElTVElOQ1Q7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNE\naXN0aW5jdCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIE5PVF9ESVNU\nSU5DVCkgPT0gMCAmJiAoKF9mbGFncyAmIERJU1RJTkNUKSAhPSAwCiAgICAg\nICAgICAgIHx8ICgoX2ZsYWdzICYgTk9OQVVUT19ESVNUSU5DVCkgPT0gMAog\nICAgICAgICAgICAmJiAoX2ZsYWdzICYgSU1QTElDSVRfRElTVElOQ1QpICE9\nIDApKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREaXN0aW5jdChib29s\nZWFuIGRpc3RpbmN0KSB7CiAgICAgICAgLy8gbmVlZCB0d28gZmxhZ3MgaW4g\nY2FzZSBzZXQgbm90X2Rpc3RpbmN0LCB0aGVuIGEgdG8tbWFueSBqb2luIGhh\ncHBlbnMKICAgICAgICAvLyBhbmQgZGlzdGluY3QgZmxhZyBnZXRzIHNldCBh\ndXRvbWF0aWNhbGx5CiAgICAgICAgaWYgKGRpc3RpbmN0KSB7CiAgICAgICAg\nICAgIF9mbGFncyB8PSBESVNUSU5DVDsKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5OT1RfRElTVElOQ1Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nX2ZsYWdzIHw9IE5PVF9ESVNUSU5DVDsKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5ESVNUSU5DVDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNMUlMoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBMUlMpICE9\nIDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TFJTKGJvb2xlYW4gbHJz\nKSB7CiAgICAgICAgaWYgKGxycykKICAgICAgICAgICAgX2ZsYWdzIHw9IExS\nUzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+TFJTOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgp\nIHsKICAgICAgICAvLyBpZiB0aGUgY291bnQgaXNuJ3QgZm9yY2VkIGFuZCB3\nZSBoYXZlIHRvLW1hbnkgZWFnZXIgam9pbnMgdGhhdCBjb3VsZAogICAgICAg\nIC8vIHRocm93IHRoZSBjb3VudCBvZmYsIGRvbid0IHBheSBhdHRlbnRpb24g\ndG8gaXQKICAgICAgICBpZiAoKF9mbGFncyAmIEZPUkNFX0NPVU5UKSA9PSAw\nICYmIGhhc0VhZ2VySm9pbih0cnVlKSkKICAgICAgICAgICAgcmV0dXJuIDA7\nCiAgICAgICAgcmV0dXJuIF9leHBlY3RlZFJlc3VsdENvdW50OwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldEV4cGVjdGVkUmVzdWx0Q291bnQoaW50IGV4\ncGVjdGVkUmVzdWx0Q291bnQsIGJvb2xlYW4gZm9yY2UpIHsKICAgICAgICBf\nZXhwZWN0ZWRSZXN1bHRDb3VudCA9IGV4cGVjdGVkUmVzdWx0Q291bnQ7CiAg\nICAgICAgaWYgKGZvcmNlKQogICAgICAgICAgICBfZmxhZ3MgfD0gRk9SQ0Vf\nQ09VTlQ7CiAgICAgICAgZWxzZSAKICAgICAgICAgICAgX2ZsYWdzICY9IH5G\nT1JDRV9DT1VOVDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEpvaW5TeW50\nYXgoKSB7CiAgICAgICAgcmV0dXJuIF9qb2luU3ludGF4OwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldEpvaW5TeW50YXgoaW50IGpvaW5TeW50YXgpIHsK\nICAgICAgICBfam9pblN5bnRheCA9IGpvaW5TeW50YXg7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21BY2Nlc3MoYm9vbGVhbiBm\nb3JVcGRhdGUpIHsKICAgICAgICByZXR1cm4gX2RpY3Quc3VwcG9ydHNSYW5k\nb21BY2Nlc3NSZXN1bHRTZXQodGhpcywgZm9yVXBkYXRlKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmcoKSB7CiAgICAgICAg\ncmV0dXJuIF9kaWN0LnN1cHBvcnRzTG9ja2luZyh0aGlzKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNNdWx0aXBsZVNlbGVjdHMoKSB7CiAgICAg\nICAgaWYgKF9lYWdlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gX2VhZ2VyLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoZW50cnkuZ2V0VmFsdWUo\nKSAhPSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldENvdW50KEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBudWxs\nOwogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gbnVsbDsKICAg\nICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIFNRTEJ1ZmZlciBzcWwgPSB0b1NlbGVjdENvdW50KCk7CiAgICAg\nICAgICAgIGNvbm4gPSBzdG9yZS5nZXROZXdDb25uZWN0aW9uKCk7CiAgICAg\nICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBzcWwsIG51\nbGwsIAogICAgICAgICAgICAgICAgUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9P\nTkxZLCAKICAgICAgICAgICAgICAgIFJlc3VsdFNldC5DT05DVVJfUkVBRF9P\nTkxZLCBmYWxzZSk7CiAgICAgICAgICAgIF9kaWN0LnNldFF1ZXJ5VGltZW91\ndChzdG1udCwKICAgICAgICAgICAgICAgICAgICBzdG9yZS5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKS5nZXRRdWVyeVRpbWVvdXQoKSk7CiAgICAgICAgICAg\nIHJzID0gZXhlY3V0ZVF1ZXJ5KGNvbm4sIHN0bW50LCBzcWwsIGZhbHNlLCBz\ndG9yZSk7CiAgICAgICAgICAgIHJldHVybiBnZXRDb3VudChycyk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cnkgeyBycy5jbG9zZSgpOyB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAoY29ubiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9zZSgpOyB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3RvcmUgc3RvcmUsIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIGZldGNoID0gc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgcmV0dXJuIGV4ZWN1dGUoc3RvcmUuZ2V0Q29udGV4dCgpLCBz\ndG9yZSwgZmV0Y2gsCiAgICAgICAgICAgIGZldGNoLmdldFJlYWRMb2NrTGV2\nZWwoKSk7CiAgICB9CgogICAgcHVibGljIFJlc3VsdCBleGVjdXRlKEpEQkNT\ndG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAg\nICAgICBpbnQgbG9ja0xldmVsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBm\nZXRjaCA9IHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAg\nIHJldHVybiBleGVjdXRlKHN0b3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZl\ndGNoLCBsb2NrTGV2ZWwpOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0\nZSB0aGlzIHNlbGVjdCBpbiB0aGUgY29udGV4dCBvZiB0aGUgZ2l2ZW4gc3Rv\ncmUgbWFuYWdlci4gVGhlCiAgICAgKiBjb250ZXh0IGlzIHBhc3NlZCBpbiBz\nZXBhcmF0ZWx5IGZvciBwcm9maWxpbmcgcHVycG9zZXMuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBSZXN1bHQgZXhlY3V0ZShTdG9yZUNvbnRleHQgY3R4LCBK\nREJDU3RvcmUgc3RvcmUsIAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIGludCBsb2NrTGV2ZWwpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUgPSBmYWxzZTsK\nICAgICAgICBpZiAoIWlzQWdncmVnYXRlKCkgJiYgX2dyb3VwaW5nID09IG51\nbGwpIHsKICAgICAgICAgICAgSkRCQ0xvY2tNYW5hZ2VyIGxtID0gc3RvcmUu\nZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICAgICAgaWYgKGxtICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBmb3JVcGRhdGUgPSBsbS5zZWxlY3RGb3JVcGRh\ndGUodGhpcywgbG9ja0xldmVsKTsKICAgICAgICB9CgogICAgICAgIFNRTEJ1\nZmZlciBzcWwgPSB0b1NlbGVjdChmb3JVcGRhdGUsIGZldGNoKTsKICAgICAg\nICBib29sZWFuIGlzTFJTID0gaXNMUlMoKTsKICAgICAgICBpbnQgcnNUeXBl\nID0gKGlzTFJTICYmIHN1cHBvcnRzUmFuZG9tQWNjZXNzKGZvclVwZGF0ZSkp\nCiAgICAgICAgICAgID8gLTEgOiBSZXN1bHRTZXQuVFlQRV9GT1JXQVJEX09O\nTFk7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gc3RvcmUuZ2V0Q29ubmVj\ndGlvbigpOwogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gbnVs\nbDsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChpc0xSUykgCiAgICAgICAgICAgICAgICBzdG1u\ndCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgc3FsLCBmZXRjaCwgcnNUeXBl\nLCAtMSwgdHJ1ZSk7IAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBzdG1udCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgc3FsLCBudWxsLCBy\nc1R5cGUsIC0xLCBmYWxzZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBf\nZGljdC5zZXRUaW1lb3V0cyhzdG1udCwgZmV0Y2gsIGZvclVwZGF0ZSk7CiAg\nICAgICAgICAgIAogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25u\nLCBzdG1udCwgc3FsLCBpc0xSUywgc3RvcmUpOwogICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAvLyBjbGVhbiB1cCBz\ndGF0ZW1lbnQKICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAgICAg\nICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UyKSB7fQogICAgICAgICAgICB0cnkgeyBjb25uLmNsb3Nl\nKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAgICAg\nIHRocm93IHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0RWFnZXJS\nZXN1bHQoY29ubiwgc3RtbnQsIHJzLCBzdG9yZSwgZmV0Y2gsIGZvclVwZGF0\nZSwgc3FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUgb3VyIGVh\nZ2VyIHNlbGVjdHMsIGFkZGluZyB0aGUgcmVzdWx0cyB1bmRlciB0aGUgc2Ft\nZSBrZXlzCiAgICAgKiB0byB0aGUgZ2l2ZW4gcmVzdWx0LgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyB2b2lkIGFkZEVhZ2VyUmVzdWx0cyhTZWxlY3RS\nZXN1bHQgcmVzLCBTZWxlY3RJbXBsIHNlbCwKICAgICAgICBKREJDU3RvcmUg\nc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHNlbC5fZWFnZXIg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBleGVj\ndXRlIGVhZ2VyIHNlbGVjdHMKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAg\nICAgICAgUmVzdWx0IGVyZXM7CiAgICAgICAgTWFwIGVhZ2VyOwogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gc2VsLl9lYWdlci5lbnRyeVNldCgpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVudHJ5\nID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKCiAgICAgICAgICAgIC8vIHNp\nbXVsYXRlZCBiYXRjaGVkIHNlbGVjdHMgZm9yIGlubmVyL291dGVyIGpvaW5z\nOyBmb3Igc2VwYXJhdGUKICAgICAgICAgICAgLy8gc2VsZWN0cywgZG9uJ3Qg\ncGFzcyBvbiBsb2NrIGxldmVsLCBiZWNhdXNlIHRoZXkncmUgcHJvYmFibHkK\nICAgICAgICAgICAgLy8gZm9yIHJlbGF0aW9ucyBhbmQgdGhlcmVmb3JlIHNo\nb3VsZCB1c2UgZGVmYXVsdCBsZXZlbAogICAgICAgICAgICBpZiAoZW50cnku\nZ2V0VmFsdWUoKSA9PSBzZWwpCiAgICAgICAgICAgICAgICBlcmVzID0gcmVz\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBlcmVzID0gKChT\nZWxlY3RFeGVjdXRvcikgZW50cnkuZ2V0VmFsdWUoKSkuZXhlY3V0ZShzdG9y\nZSwKICAgICAgICAgICAgICAgICAgICBmZXRjaCk7CgogICAgICAgICAgICBl\nYWdlciA9IHJlcy5nZXRFYWdlck1hcChmYWxzZSk7CiAgICAgICAgICAgIGlm\nIChlYWdlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBlYWdlciA9IG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAgICByZXMuc2V0RWFnZXJNYXAo\nZWFnZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVhZ2VyLnB1dChl\nbnRyeS5nZXRLZXkoKSwgZXJlcyk7CiAgICAgICAgfQogICAgfQoKCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUg\nZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0\naW9uIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENvbm5l\nY3Rpb24gY29ubiwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgCiAgICAgICAgaW50\nIHJzQ29uY3VyLCBib29sZWFuIGlzTFJTKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIHJzVHlwZSwgcnNDb25j\ndXIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHNxbC5wcmVw\nYXJlU3RhdGVtZW50KGNvbm4sIGZldGNoLCByc1R5cGUsIC0xKTsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRl\nIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBp\nbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVu\ndChDb25uZWN0aW9uIGNvbm4sIAogICAgICAgIFN0cmluZyBzcWwpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBjb25uLnByZXBhcmVT\ndGF0ZW1lbnQoc3FsKTsKICAgIH0gICAgCiAgICAKICAgIC8qKgogICAgICog\nVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpE\nQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZXhl\nY3V0aW5nIHF1ZXJ5LgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0\nIGV4ZWN1dGVRdWVyeShDb25uZWN0aW9uIGNvbm4sIFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCAKICAgICAgICBTUUxCdWZmZXIgc3FsLCBib29sZWFuIGlz\nTFJTLCBKREJDU3RvcmUgc3RvcmUpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92\nZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbiBvZiBleGVjdXRpbmcgcXVlcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KENvbm5lY3Rpb24gY29ubiwg\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgIFN0cmluZyBzcWws\nIEpEQkNTdG9yZSBzdG9yZSwgT2JqZWN0W10gcGFyYW1zLCBDb2x1bW5bXSBj\nb2xzKSAKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBu\nb24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBv\nZiBnZXR0aW5nIGNvdW50IGZyb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBpbnQgZ2V0Q291bnQoUmVzdWx0U2V0IHJzKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBycy5uZXh0KCk7CiAgICAgICAg\ncmV0dXJuIHJzLmdldEludCgxKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24t\nSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBl\neGVjdXRpbmcgZWFnZXIgc2VsZWN0cy4KICAgICAqLwogICAgcHVibGljIFJl\nc3VsdCBnZXRFYWdlclJlc3VsdChDb25uZWN0aW9uIGNvbm4sIAogICAgICAg\nIFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBSZXN1bHRTZXQgcnMsIEpEQkNT\ndG9yZSBzdG9yZSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgYm9vbGVhbiBmb3JVcGRhdGUsIFNRTEJ1ZmZlciBzcWwpIAogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNlbGVjdFJlc3Vs\ndCByZXMgPSBuZXcgU2VsZWN0UmVzdWx0KGNvbm4sIHN0bW50LCBycywgX2Rp\nY3QpOwogICAgICAgIHJlcy5zZXRTZWxlY3QodGhpcyk7CiAgICAgICAgcmVz\nLnNldFN0b3JlKHN0b3JlKTsKICAgICAgICByZXMuc2V0TG9ja2luZyhmb3JV\ncGRhdGUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFkZEVhZ2VyUmVz\ndWx0cyhyZXMsIHRoaXMsIHN0b3JlLCBmZXRjaCk7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHJlcy5jbG9zZSgp\nOwogICAgICAgICAgICB0aHJvdyBzZTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHJlczsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBTZWxlY3QgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgaW50IGluZGV4T2YoKSB7CiAg\nICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcHVibGljIExpc3QgZ2V0U3Vi\nc2VsZWN0cygpIHsKICAgICAgICByZXR1cm4gKF9zdWJzZWxzID09IG51bGwp\nID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6IF9zdWJzZWxzOwogICAgfQoK\nICAgIHB1YmxpYyBTZWxlY3QgZ2V0UGFyZW50KCkgewogICAgICAgIHJldHVy\nbiBfcGFyZW50OwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0U3Vic2Vs\nZWN0UGF0aCgpIHsKICAgICAgICByZXR1cm4gX3N1YlBhdGg7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0UGFyZW50KFNlbGVjdCBwYXJlbnQsIFN0cmlu\nZyBwYXRoKSB7CiAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkKICAgICAgICAg\nICAgX3N1YlBhdGggPSBwYXRoOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nX3N1YlBhdGggPSBudWxsOwoKICAgICAgICBpZiAocGFyZW50ID09IF9wYXJl\nbnQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX3BhcmVudCAh\nPSBudWxsKQogICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzLnJlbW92ZSh0\naGlzKTsKCiAgICAgICAgLy8jIyMgcmlnaHQgbm93IHdlIGNhbid0IHVzZSBz\ncWw5MiBqb2lucyB3aXRoIHN1YnNlbGVjdHMsIGNhdXNlCiAgICAgICAgLy8j\nIyMgSSBjYW4ndCBmaWd1cmUgb3V0IHdoYXQgdG8gZG8gd2hlbiB0aGUgc3Vi\nc2VsZWN0IGhhcyBhIGpvaW4KICAgICAgICAvLyMjIyB3aXRoIGFuIGFsaWFz\nIGFsc28gcHJlc2VudCBpbiB0aGUgb3V0ZXIgc2VsZWN0Li4uIHlvdSBkb24n\ndCB3YW50CiAgICAgICAgLy8jIyMgdGhlIGpvaW4gdG8gYXBwZWFyIGluIHRo\nZSBGUk9NIGNsYXVzZSBvZiB0aGUgc3Vic2VsZWN0IGNhdXNlCiAgICAgICAg\nLy8jIyMgdGhlbiBpdCByZS1hbGlhc2VzIGJvdGggdGFibGVzIGluIHRoZSBz\nY29wZSBvZiB0aGUgc3Vic2VsZWN0CiAgICAgICAgLy8jIyMgYW5kIHRoZSBj\nb3JyZWxhdGlvbiB3aXRoIHRoZSBvdXRlciBzZWxlY3QgaXMgbG9zdAogICAg\nICAgIF9wYXJlbnQgPSAoU2VsZWN0SW1wbCkgcGFyZW50OwogICAgICAgIGlm\nIChfcGFyZW50ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9wYXJlbnQu\nX3N1YnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wYXJlbnQuX3N1\nYnNlbHMgPSBuZXcgQXJyYXlMaXN0KDIpOwogICAgICAgICAgICBfcGFyZW50\nLl9zdWJzZWxzLmFkZCh0aGlzKTsKICAgICAgICAgICAgaWYgKF9wYXJlbnQu\nX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9TUUw5MikKICAg\nICAgICAgICAgICAgIF9qb2luU3ludGF4ID0gSm9pblN5bnRheGVzLlNZTlRB\nWF9UUkFESVRJT05BTDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgX2pvaW5TeW50YXggPSBfcGFyZW50Ll9qb2luU3ludGF4OwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0SGFzU3Vic2VsZWN0\nKGJvb2xlYW4gaGFzU3ViKSB7CiAgICAgICAgX2hhc1N1YiA9IGhhc1N1YjsK\nICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gZ2V0SGFzU3Vic2VsZWN0\nKCkgewogICAgICAgIHJldHVybiBfaGFzU3ViOyAgICAKICAgIH0KICAgIAog\nICAgcHVibGljIE1hcCBnZXRBbGlhc2VzKCkgewogICAgICAgIHJldHVybiBf\nYWxpYXNlczsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgcmVtb3ZlQWxp\nYXMoT2JqZWN0IGtleSkgewogICAgICAgIF9hbGlhc2VzLnJlbW92ZShrZXkp\nOwogICAgfQogICAgCiAgICBwdWJsaWMgTWFwIGdldFRhYmxlcygpIHsKICAg\nICAgICByZXR1cm4gX3RhYmxlczsKICAgIH0KICAgIAogICAgcHVibGljIHZv\naWQgcmVtb3ZlVGFibGUoT2JqZWN0IGtleSkgewogICAgICAgIF90YWJsZXMu\ncmVtb3ZlKGtleSk7CiAgICB9CgogICAgcHVibGljIFNlbGVjdCBnZXRGcm9t\nU2VsZWN0KCkgewogICAgICAgIHJldHVybiBfZnJvbTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRGcm9tU2VsZWN0KFNlbGVjdCBzZWwpIHsKICAgICAg\nICBfZnJvbSA9IChTZWxlY3RJbXBsKSBzZWw7CiAgICAgICAgaWYgKF9mcm9t\nICE9IG51bGwpCiAgICAgICAgICAgIF9mcm9tLl9vdXRlciA9IHRoaXM7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzRWFnZXJKb2luKGJvb2xlYW4g\ndG9NYW55KSB7CiAgICAgICAgaWYgKHRvTWFueSkKICAgICAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBFQUdFUl9UT19NQU5ZKSAhPSAwOwogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgRUFHRVJfVE9fT05FKSAhPSAwOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGhhc0pvaW4oYm9vbGVhbiB0b01hbnkpIHsKICAg\nICAgICBpZiAodG9NYW55KQogICAgICAgICAgICByZXR1cm4gKF9mbGFncyAm\nIFRPX01BTlkpICE9IDA7CiAgICAgICAgcmV0dXJuIF90YWJsZXMgIT0gbnVs\nbCAmJiBfdGFibGVzLnNpemUoKSA+IDE7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNTZWxlY3RlZChUYWJsZSB0YWJsZSkgewogICAgICAgIFBhdGhK\nb2lucyBwaiA9IGdldEpvaW5zKG51bGwsIGZhbHNlKTsKICAgICAgICBpZiAo\nX2Zyb20gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9mcm9tLmdldFRh\nYmxlSW5kZXgodGFibGUsIHBqLCBmYWxzZSkgIT0gLTE7CiAgICAgICAgcmV0\ndXJuIGdldFRhYmxlSW5kZXgodGFibGUsIHBqLCBmYWxzZSkgIT0gLTE7CiAg\nICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VGFibGVBbGlhc2VzKCkg\newogICAgICAgIHJldHVybiAoX3RhYmxlcyA9PSBudWxsKSA/IENvbGxlY3Rp\nb25zLkVNUFRZX1NFVCA6IF90YWJsZXMudmFsdWVzKCk7CiAgICB9CgogICAg\ncHVibGljIExpc3QgZ2V0U2VsZWN0cygpIHsKICAgICAgICByZXR1cm4gQ29s\nbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChfc2VsZWN0cyk7CiAgICB9Cgog\nICAgcHVibGljIExpc3QgZ2V0U2VsZWN0QWxpYXNlcygpIHsKICAgICAgICBy\nZXR1cm4gX3NlbGVjdHMuZ2V0QWxpYXNlcyhmYWxzZSwgX291dGVyICE9IG51\nbGwpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldElkZW50aWZpZXJBbGlh\nc2VzKCkgewogICAgICAgIHJldHVybiBfc2VsZWN0cy5nZXRBbGlhc2VzKHRy\ndWUsIF9vdXRlciAhPSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVm\nZmVyIGdldE9yZGVyaW5nKCkgewogICAgICAgIHJldHVybiBfb3JkZXJpbmc7\nCiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRHcm91cGluZygpIHsK\nICAgICAgICByZXR1cm4gX2dyb3VwaW5nOwogICAgfQoKICAgIHB1YmxpYyBT\nUUxCdWZmZXIgZ2V0V2hlcmUoKSB7CiAgICAgICAgcmV0dXJuIF93aGVyZTsK\nICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldEhhdmluZygpIHsKICAg\nICAgICByZXR1cm4gX2hhdmluZzsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBh\nZGRKb2luQ2xhc3NDb25kaXRpb25zKCkgewogICAgICAgIGlmIChfam9pbnMg\nPT0gbnVsbCB8fCBfam9pbnMuam9pbnMoKSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIC8vIGpvaW4gc2V0IGl0ZXJhdG9yIGFsbG93\ncyBjb25jdXJyZW50IG1vZGlmaWNhdGlvbgogICAgICAgIEpvaW4gajsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9qb2lucy5qb2lucygpLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGogPSAoSm9p\nbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGouZ2V0UmVsYXRpb25U\nYXJnZXQoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBqLmdldFJlbGF0\naW9uVGFyZ2V0KCkuZ2V0RGlzY3JpbWluYXRvcigpLmFkZENsYXNzQ29uZGl0\naW9ucwogICAgICAgICAgICAgICAgICAgICh0aGlzLCBqLmdldFN1YmNsYXNz\nZXMoKSA9PSBTVUJTX0pPSU5BQkxFLCAKICAgICAgICAgICAgICAgICAgICBq\nLmdldFJlbGF0aW9uSm9pbnMoKSk7CiAgICAgICAgICAgICAgICBqLnNldFJl\nbGF0aW9uKG51bGwsIDAsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBKb2lucyBnZXRKb2lucygpIHsKICAgICAg\nICByZXR1cm4gX2pvaW5zOwogICAgfQoKICAgIHB1YmxpYyBJdGVyYXRvciBn\nZXRKb2luSXRlcmF0b3IoKSB7CiAgICAgICAgaWYgKF9qb2lucyA9PSBudWxs\nIHx8IF9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBFbXB0\neUl0ZXJhdG9yLklOU1RBTkNFOwogICAgICAgIHJldHVybiBfam9pbnMuam9p\nbnMoKS5qb2luSXRlcmF0b3IoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBn\nZXRTdGFydEluZGV4KCkgewogICAgICAgIHJldHVybiBfc3RhcnRJZHg7CiAg\nICB9CgogICAgcHVibGljIGxvbmcgZ2V0RW5kSW5kZXgoKSB7CiAgICAgICAg\ncmV0dXJuIF9lbmRJZHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmFu\nZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBfc3RhcnRJZHgg\nPSBzdGFydDsKICAgICAgICBfZW5kSWR4ID0gZW5kOwogICAgfQoKICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCkgewogICAg\nICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIChKb2lucykgbnVsbCk7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1\nbW4gY29sLCBKb2lucyBqb2lucykgewogICAgICAgIHJldHVybiBnZXRDb2x1\nbW5BbGlhcyhjb2wsIGdldEpvaW5zKGpvaW5zLCBmYWxzZSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhbGlhcyBmb3IgdGhlIGdpdmVu\nIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Q29sdW1u\nQWxpYXMoQ29sdW1uIGNvbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgcmV0\ndXJuIGdldENvbHVtbkFsaWFzKGNvbC5nZXRJZGVudGlmaWVyKCkuZ2V0TmFt\nZSgpLCBjb2wuZ2V0VGFibGUoKSwgcGopOwogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFibGUgdGFibGUp\nIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCB0YWJsZSwg\nKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENv\nbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBKb2lucyBqb2lu\ncykgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIHRhYmxl\nLCBnZXRKb2lucyhqb2lucywgZmFsc2UpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlIGNvbHVtbgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBj\nb2wsIE9iamVjdCBwYXRoKSB7CiAgICAgICAgVGFibGUgdGFibGUgPSBjb2wu\nZ2V0VGFibGUoKTsKICAgICAgICBTdHJpbmcgdGFibGVBbGlhcyA9IG51bGw7\nCiAgICAgICAgSXRlcmF0b3IgaXRyID0gZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAg\nICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgSm9p\nbiBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChq\nb2luICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChqb2luLmdldFRh\nYmxlMSgpID09IHRhYmxlKQogICAgICAgICAgICAgICAgICAgIHRhYmxlQWxp\nYXMgPSBqb2luLmdldEFsaWFzMSgpOwogICAgICAgICAgICAgICAgZWxzZSBp\nZiAoam9pbi5nZXRUYWJsZTIoKSA9PSB0YWJsZSkKICAgICAgICAgICAgICAg\nICAgICB0YWJsZUFsaWFzID0gam9pbi5nZXRBbGlhczIoKTsKICAgICAgICAg\nICAgICAgIGlmICh0YWJsZUFsaWFzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdCdWlsZGVyKHRhYmxlQWxpYXMpLmFw\ncGVuZCgiLiIpLgogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQoX2Rp\nY3QuZ2V0TmFtaW5nVXRpbCgpLnRvREJOYW1lKGNvbC5nZXRJZGVudGlmaWVy\nKCkpKS50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigiQ2FuIG5vdCByZXNv\nbHZlIGFsaWFzIGZvciBmaWVsZDogIiArCiAgICAgICAgICAgIHBhdGgudG9T\ndHJpbmcoKSArICIgbWFwcGVkIHRvIGNvbHVtbjogIiArIGNvbC5nZXRJZGVu\ndGlmaWVyKCkuZ2V0TmFtZSgpICsKICAgICAgICAgICAgIiB0YWJsZTogIit0\nYWJsZS5nZXRJZGVudGlmaWVyKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBjb2x1\nbW4uCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENvbHVtbkFsaWFz\nKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGopIHsKICAg\nICAgICByZXR1cm4gZ2V0VGFibGVBbGlhcyh0YWJsZSwgcGopLmFwcGVuZChf\nZGljdC5nZXROYW1pbmdVdGlsKCkudG9EQk5hbWUoY29sKSkudG9TdHJpbmco\nKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBTdHJpbmdCdWlsZGVyIGdldFRh\nYmxlQWxpYXMoVGFibGUgdGFibGUsIFBhdGhKb2lucyBwaikgewogICAgICAg\nIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAg\nICAgICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcg\nYWxpYXMgPSB0b0FsaWFzKF9mcm9tLmdldFRhYmxlSW5kZXgodGFibGUsIHBq\nLCB0cnVlKSk7CiAgICAgICAgICAgIGlmIChfZGljdC5yZXF1aXJlc0FsaWFz\nRm9yU3Vic2VsZWN0KQogICAgICAgICAgICAgICAgcmV0dXJuIGJ1Zi5hcHBl\nbmQoRlJPTV9TRUxFQ1RfQUxJQVMpLmFwcGVuZCgiLiIpLmFwcGVuZChhbGlh\ncykuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCJfIik7CiAgICAgICAg\nICAgIHJldHVybiBidWYuYXBwZW5kKGFsaWFzKS5hcHBlbmQoIl8iKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi5hcHBlbmQodG9BbGlhcyhnZXRU\nYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpKS5hcHBlbmQoIi4iKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZSgpIHsKICAgICAg\nICByZXR1cm4gKF9mbGFncyAmIEFHR1JFR0FURSkgIT0gMDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRBZ2dyZWdhdGUoYm9vbGVhbiBhZ2cpIHsKICAg\nICAgICBpZiAoYWdnKQogICAgICAgICAgICBfZmxhZ3MgfD0gQUdHUkVHQVRF\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5BR0dSRUdB\nVEU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNMb2IoKSB7CiAgICAg\nICAgcmV0dXJuIChfZmxhZ3MgJiBMT0IpICE9IDA7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0TG9iKGJvb2xlYW4gbG9iKSB7CiAgICAgICAgaWYgKGxv\nYikKICAgICAgICAgICAgX2ZsYWdzIHw9IExPQjsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIF9mbGFncyAmPSB+TE9COwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGNsZWFyU2VsZWN0cygpIHsKICAgICAgICBfc2VsZWN0cy5jbGVhcigp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTUUxCdWZmZXIg\nc3FsLCBPYmplY3QgaWQpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KHNxbCwg\naWQsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChT\nUUxCdWZmZXIgc3FsLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgaWYgKCFpc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxl\nY3QoKE9iamVjdCkgc3FsLCBpZCwgam9pbnMpOwogICAgICAgIGdyb3VwQnko\nc3FsLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVjb3JkIHRoZSBzZWxlY3Qgb2YgdGhlIGdpdmVuIFNR\nTCBidWZmZXIgb3Igc3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gc2VsZWN0KE9iamVjdCBzcWwsIE9iamVjdCBpZCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgYm9v\nbGVhbiBjb250YWluczsKICAgICAgICBpZiAoaWQgPT0gbnVsbCkgewogICAg\nICAgICAgICBpbnQgaWR4ID0gX3NlbGVjdHMuaW5kZXhPZkFsaWFzKHNxbCk7\nCiAgICAgICAgICAgIGNvbnRhaW5zID0gaWR4ICE9IC0xOwogICAgICAgICAg\nICBpZiAoY29udGFpbnMpCiAgICAgICAgICAgICAgICBpZCA9IF9zZWxlY3Rz\nLmdldChpZHgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBp\nZCA9IG51bGxJZCgpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBjb250\nYWlucyA9IF9zZWxlY3RzLmNvbnRhaW5zKGlkKTsKCiAgICAgICAgaWYgKGNv\nbnRhaW5zKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgX3Nl\nbGVjdHMuc2V0QWxpYXMoaWQsIHNxbCwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIHVuaXF1\nZSBpZCBmb3IgYSBTUUwgc3RyaW5nIHdob3NlIGdpdmVuIGlkIGlzIG51bGwu\nCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IG51bGxJZCgpIHsKICAgICAg\nICBpZiAoX251bGxJZHMgPj0gTlVMTF9JRFMubGVuZ3RoKQogICAgICAgICAg\nICByZXR1cm4gbmV3IE51bGxJZCgpOwogICAgICAgIHJldHVybiBOVUxMX0lE\nU1tfbnVsbElkcysrXTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxl\nY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkKSB7CiAgICAgICAgcmV0dXJuIHNl\nbGVjdChzcWwsIGlkLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBzZWxlY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkLCBKb2lucyBqb2lucykg\newogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAgICByZXR1\ncm4gc2VsZWN0KChPYmplY3QpIHNxbCwgaWQsIGpvaW5zKTsKICAgICAgICBn\ncm91cEJ5KHNxbCwgam9pbnMpOwogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdFBsYWNlaG9sZGVyKFN0cmluZyBz\ncWwpIHsKICAgICAgICBPYmplY3QgaG9sZGVyID0gKF9wbGFjZWhvbGRlcnMg\nPj0gUExBQ0VIT0xERVJTLmxlbmd0aCkKICAgICAgICAgICAgPyBuZXcgUGxh\nY2Vob2xkZXIoKSA6IFBMQUNFSE9MREVSU1tfcGxhY2Vob2xkZXJzKytdOwog\nICAgICAgIHNlbGVjdChzcWwsIGhvbGRlcik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbnNlcnQgYSBwbGFjZWhvbGRlciBhdCB0aGUgZ2l2ZW4gaW5kZXg7\nIHVzZSBhIG5lZ2F0aXZlIGluZGV4CiAgICAgKiB0byBjb3VudCBmcm9tIHRo\nZSBiYWNrIG9mIHRoZSBzZWxlY3QgbGlzdC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgaW5zZXJ0UGxhY2Vob2xkZXIoU3RyaW5nIHNxbCwgaW50IHBvcykg\newogICAgICAgIE9iamVjdCBob2xkZXIgPSAoX3BsYWNlaG9sZGVycyA+PSBQ\nTEFDRUhPTERFUlMubGVuZ3RoKQogICAgICAgICAgICA/IG5ldyBQbGFjZWhv\nbGRlcigpIDogUExBQ0VIT0xERVJTW19wbGFjZWhvbGRlcnMrK107CiAgICAg\nICAgX3NlbGVjdHMuaW5zZXJ0QWxpYXMocG9zLCBob2xkZXIsIHNxbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBzZWxlY3RlZCBwbGFjZWhvbGRl\ncnMsIGFuZCByZXR1cm4gcmVtb3ZlZCBzZWxlY3QgaW5kZXhlcy4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgY2xlYXJQbGFjZWhvbGRlclNlbGVjdHMoKSB7\nCiAgICAgICAgX3NlbGVjdHMuY2xlYXJQbGFjZWhvbGRlcnMoKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCkgewogICAg\nICAgIHJldHVybiBzZWxlY3QoY29sLCAoSm9pbnMpIG51bGwpOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChDb2x1bW4gY29sLCBKb2lucyBq\nb2lucykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAg\nICByZXR1cm4gc2VsZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCBm\nYWxzZSk7CiAgICAgICAgZ3JvdXBCeShjb2wsIGpvaW5zKTsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3QoQ29s\ndW1uW10gY29scykgewogICAgICAgIHJldHVybiBzZWxlY3QoY29scywgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3QoQ29sdW1uW10gY29s\ncywgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8\nIGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAg\nICAgIGlmIChpc0dyb3VwaW5nKCkpIHsKICAgICAgICAgICAgZ3JvdXBCeShj\nb2xzLCBqb2lucyk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0K\nICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7\nCiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHNlbGVj\ndChjb2xzW2ldLCBwaiwgZmFsc2UpKQogICAgICAgICAgICAgICAgc2VsZCB8\nPSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZWxlY3QgdGhlIGdpdmVuIGNvbHVtbiBhZnRlciBtYWtpbmcg\ndGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\nc2VsZWN0KENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBpZGVu\ndCkgewogICAgICAgIC8vIHdlIGNhY2hlIG9uIGNvbHVtbiBvYmplY3QgaWYg\ndGhlcmUgYXJlIG5vIGpvaW5zIHNvIHRoYXQgd2hlbgogICAgICAgIC8vIGxv\nb2tpbmcgdXAgY29sdW1ucyBpbiB0aGUgcmVzdWx0IHdlIGRvbid0IGhhdmUg\ndG8gY3JlYXRlIGEgc3RyaW5nCiAgICAgICAgLy8gYnVmZmVyIGZvciB0aGUg\ndGFibGUgKyBjb2x1bW4gYWxpYXM7IGlmIHRoZXJlIGFyZSBqb2lucywgdGhl\nbgogICAgICAgIC8vIHdlIGtleSBvbiB0aGUgYWxpYXMKICAgICAgICBTdHJp\nbmcgYWxpYXMgPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAgICBP\nYmplY3QgaWQ7CiAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgp\nID09IG51bGwpCiAgICAgICAgICAgIGlkID0gY29sOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgaWQgPSBhbGlhczsKICAgICAgICBpZiAoX3NlbGVjdHMu\nY29udGFpbnMoaWQpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIGlmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IgfHwgY29sLmdl\ndFR5cGUoKSA9PSBUeXBlcy5DTE9CKQogICAgICAgICAgICBzZXRMb2IodHJ1\nZSk7CiAgICAgICAgX3NlbGVjdHMuc2V0QWxpYXMoaWQsIGFsaWFzLCBpZGVu\ndCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2VsZWN0KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3Nl\ncywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIGludCBlYWdlcikgewogICAgICAgIHNlbGVjdChtYXBw\naW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBudWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLAog\nICAgICAgIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsZWN0KHRoaXMsIG1h\ncHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpvaW5z\nLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdp\ndmVuIG1hcHBpbmcuCiAgICAgKi8KICAgIHZvaWQgc2VsZWN0KFNlbGVjdCB3\ncmFwcGVyLCBDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMs\nCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMgam9pbnMsIGJv\nb2xlYW4gaWRlbnQpIHsKICAgICAgICAvLyBub3RlIHRoYXQgdGhpcyBpcyBv\nbmUgY2FzZSB3aGVyZSB3ZSBkb24ndCB3YW50IHRvIHVzZSB0aGUgcmVzdWx0\nCiAgICAgICAgLy8gb2YgZ2V0Sm9pbnMoKTsganVzdCB1c2UgdGhlIGdpdmVu\nIGpvaW5zLCB3aGljaCB3aWxsIGVpdGhlciBiZSBjbGVhbgogICAgICAgIC8v\nIG9yIHRoZSByZXN1bHQgb2YgcHJldmlvdXMgcHJlLWpvaW5zLiB0aGlzIHdh\neSB3ZSBkb24ndCBwdXNoIGV4dHJhCiAgICAgICAgLy8gc3RhY2sgc3R1ZmYg\nd2hlbiBubyBhY3R1YWwgbmV3IGpvaW5zIGhhdmUgYmVlbiBtYWRlLCBhbmQg\nd2UgZG9uJ3QKICAgICAgICAvLyB0aGluayB0aGUgdXNlciB3YW50cyBvdXRl\nciBqb2lucyB3aGVuIGFjdHVhbGx5IG9ubHkgdGhlIHByZXZpb3VzCiAgICAg\nICAgLy8gam9pbnMgd2VyZSBvdXRlci4gIHdlIGRvIGludm9rZSBnZXRKb2lu\ncygpLCB0aG91Z2gsIHRvIGFkZCB0aGVzZQogICAgICAgIC8vIGpvaW5zIChp\nZiBhbnkpIHRvIG91ciB0b3AtbGV2ZWwgam9pbnM7IG90aGVyd2lzZSBpdCdk\nIGJlIHBvc3NpYmxlCiAgICAgICAgLy8gZm9yIHRoZSB1c2VyIHRvIGltbWVk\naWF0ZWx5IGRvIGFub3RoZXIgam9pbiBhbmQgc2VsZWN0IHNvbWV0aGluZywK\nICAgICAgICAvLyBhbmQgaWYgd2UncmUgaW4gb3V0ZXIgbW9kZSBhbGwgdGhl\nc2Ugam9pbnMgd2lsbCBnZXQgc3dpdGNoZWQgdG8gb3V0ZXIKICAgICAgICAv\nLyBqb2lucy4gIGNhY2hpbmcgdGhlbSBhcyB0aGVpciBvcmlnaW5hbCBqb2lu\nIHR5cGUgcHJldmVudHMgdGhhdAogICAgICAgIGdldEpvaW5zKGpvaW5zLCB0\ncnVlKTsKCiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9p\nbnM7CiAgICAgICAgYm9vbGVhbiBoYXNKb2lucyA9IHBqICE9IG51bGwgJiYg\ncGouaXNEaXJ0eSgpOwogICAgICAgIGlmIChoYXNKb2lucykgewogICAgICAg\nICAgICBpZiAoX3ByZUpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBf\ncHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAgX3ByZUpvaW5z\nLnB1c2gocGopOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhleSBhcmUg\nc2VsZWN0aW5nIHRoaXMgbWFwcGluZyB3aXRoIG91dGVyIGpvaW5zLCB0aGVu\nIGFsbCBqb2lucwogICAgICAgIC8vIGZyb20gdGhpcyBtYXBwaW5nIHNob3Vs\nZCBhbHNvIGJlIG91dGVyCiAgICAgICAgYm9vbGVhbiB3YXNPdXRlciA9IChf\nZmxhZ3MgJiBPVVRFUikgIT0gMDsKICAgICAgICBpZiAoaGFzSm9pbnMgJiYg\nIXdhc091dGVyICYmIHBqLmlzT3V0ZXIoKSkKICAgICAgICAgICAgX2ZsYWdz\nIHw9IE9VVEVSOwoKICAgICAgICAvLyBkZWxlZ2F0ZSB0byBzdG9yZSBtYW5h\nZ2VyIHRvIHNlbGVjdCBpbiBzYW1lIG9yZGVyIGl0IGxvYWRzIHJlc3VsdAog\nICAgICAgICgoSkRCQ1N0b3JlTWFuYWdlcikgc3RvcmUpLnNlbGVjdCh3cmFw\ncGVyLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBudWxsLAogICAgICAgICAgICBu\ndWxsLCBmZXRjaCwgZWFnZXIsIGlkZW50LCAoX2ZsYWdzICYgT1VURVIpICE9\nIDApOwoKICAgICAgICAvLyByZXNldAogICAgICAgIGlmIChoYXNKb2lucykK\nICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAgIGlmICghd2Fz\nT3V0ZXIgJiYgKF9mbGFncyAmIE9VVEVSKSAhPSAwKQogICAgICAgICAgICBf\nZmxhZ3MgJj0gfk9VVEVSOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNl\nbGVjdElkZW50aWZpZXIoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBz\nZWxlY3RJZGVudGlmaWVyKGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RJZGVudGlmaWVyKENvbHVtbiBjb2ws\nIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dyb3VwaW5nKCkpCiAg\nICAgICAgICAgIHJldHVybiBzZWxlY3QoY29sLCBnZXRKb2lucyhqb2lucywg\ndHJ1ZSksIHRydWUpOwogICAgICAgIGdyb3VwQnkoY29sLCBqb2lucyk7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2Vs\nZWN0SWRlbnRpZmllcihDb2x1bW5bXSBjb2xzKSB7CiAgICAgICAgcmV0dXJu\nIHNlbGVjdElkZW50aWZpZXIoY29scywgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIGludCBzZWxlY3RJZGVudGlmaWVyKENvbHVtbltdIGNvbHMsIEpvaW5z\nIGpvaW5zKSB7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAo\naXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywgam9p\nbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAg\nUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAg\nIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNv\nbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChzZWxlY3QoY29sc1tp\nXSwgcGosIHRydWUpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7\nCiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2VsZWN0SWRlbnRpZmllcihDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1\nYmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIpIHsKICAgICAgICBzZWxl\nY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRj\naCwgZWFnZXIsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndElkZW50aWZpZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFz\nc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLAogICAgICAgIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgc2VsZWN0KHRoaXMsIG1hcHBpbmcsIHN1YmNsYXNzZXMs\nIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpvaW5zLCB0cnVlKTsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IHNlbGVjdFByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcpIHsKICAgICAgICByZXR1cm4gc2VsZWN0UHJpbWFyeUtleShtYXBw\naW5nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdFByaW1h\ncnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24obWFwcGluZywgdHJ1\nZSwgbnVsbCwgam9pbnMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE9wZXJhdGUgb24gcHJpbWFyeSBrZXkgZGF0YS4gUmV0dXJuIGEgYml0IG1h\nc2sgb2Ygc2VsZWN0ZWQgY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSBp\nbnQgcHJpbWFyeUtleU9wZXJhdGlvbihDbGFzc01hcHBpbmcgbWFwcGluZywg\nYm9vbGVhbiBzZWwsCiAgICAgICAgQm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5z\nLCBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBpZiAoIXNlbCAmJiBh\nc2MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAgIC8v\nIGlmIHRoaXMgbWFwcGluZyBjYW4ndCBzZWxlY3QgdGhlIGZ1bGwgcGsgdmFs\ndWVzLCB0aGVuIGpvaW4gdG8KICAgICAgICAvLyBzdXBlciBhbmQgcmVjdXJz\nZQogICAgICAgIENsYXNzTWFwcGluZyBzdXA7CiAgICAgICAgaWYgKCFtYXBw\naW5nLmlzUHJpbWFyeUtleU9iamVjdElkKHRydWUpKSB7CiAgICAgICAgICAg\nIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCk7CiAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICBqb2lucyA9\nIG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAg\nICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24oc3VwLCBzZWwsIGFz\nYywgam9pbnMsIGFsaWFzT3JkZXIpOwogICAgICAgIH0KCiAgICAgICAgQ29s\ndW1uW10gY29scyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsK\nICAgICAgICBpZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdyb3Vw\nQnkoY29scywgam9pbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAg\nICB9CgogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCBm\nYWxzZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYg\nKGNvbHVtbk9wZXJhdGlvbihjb2xzW2ldLCBzZWwsIGFzYywgcGosIGFsaWFz\nT3JkZXIpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7CgogICAg\nICAgIC8vIGlmIHRoaXMgbWFwcGluZyBoYXMgbm90IGJlZW4gdXNlZCBpbiB0\naGUgc2VsZWN0IHlldCAoYW5kIHRoZXJlZm9yZQogICAgICAgIC8vIGlzIG5v\ndCBqb2luZWQgdG8gYW55dGhpbmcpLCBidXQgaGFzIGFuIG90aGVyLXRhYmxl\nIHN1cGVyY2xhc3MgdGhhdAogICAgICAgIC8vIGhhcyBiZWVuIHVzZWQsIG1h\na2Ugc3VyZSB0byBqb2luIHRvIGl0CiAgICAgICAgYm9vbGVhbiBqb2luZWQg\nPSBmYWxzZTsKICAgICAgICBmb3IgKHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7IHN1cCAhPSBudWxsOwogICAgICAg\nICAgICBtYXBwaW5nID0gc3VwLCBzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxl\nUENTdXBlcmNsYXNzTWFwcGluZygpKSB7CiAgICAgICAgICAgIGlmIChzdXAu\nZ2V0VGFibGUoKSA9PSBtYXBwaW5nLmdldFRhYmxlKCkpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChtYXBwaW5nLmdldFRh\nYmxlKCkgIT0gc3VwLmdldFRhYmxlKCkKICAgICAgICAgICAgICAgICYmIGdl\ndFRhYmxlSW5kZXgobWFwcGluZy5nZXRUYWJsZSgpLCBwaiwgZmFsc2UpID09\nIC0xCiAgICAgICAgICAgICAgICAmJiBnZXRUYWJsZUluZGV4KHN1cC5nZXRU\nYWJsZSgpLCBwaiwgZmFsc2UpICE9IC0xKSB7CiAgICAgICAgICAgICAgICBp\nZiAocGogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwaiA9IChQYXRo\nSm9pbnMpIG5ld0pvaW5zKCk7CiAgICAgICAgICAgICAgICBwaiA9IChQYXRo\nSm9pbnMpIG1hcHBpbmcuam9pblN1cGVyY2xhc3MocGosIGZhbHNlKTsKICAg\nICAgICAgICAgICAgIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlm\nIChqb2luZWQpCiAgICAgICAgICAgIHdoZXJlKHBqKTsKCiAgICAgICAgcmV0\ndXJuIHNlbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGFuIG9w\nZXJhdGlvbiBvbiBhIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIGNvbHVtbk9wZXJhdGlvbihDb2x1bW4gY29sLCBib29sZWFuIHNlbCwg\nQm9vbGVhbiBhc2MsCiAgICAgICAgUGF0aEpvaW5zIHBqLCBib29sZWFuIGFs\naWFzT3JkZXIpIHsKICAgICAgICBTdHJpbmcgYXMgPSBudWxsOwogICAgICAg\nIGlmIChhc2MgIT0gbnVsbCAmJiAoYWxpYXNPcmRlciB8fCAoX2ZsYWdzICYg\nUkVDT1JEX09SREVSRUQpICE9IDApKSB7CiAgICAgICAgICAgIE9iamVjdCBp\nZDsKICAgICAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgpID09\nIG51bGwpCiAgICAgICAgICAgICAgICBpZCA9IGNvbDsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgaWQgPSBnZXRDb2x1bW5BbGlhcyhjb2ws\nIHBqKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBSRUNPUkRfT1JERVJF\nRCkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9vcmRlcmVkID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgX29yZGVyZWQgPSBuZXcgQXJyYXlM\naXN0KDUpOwogICAgICAgICAgICAgICAgX29yZGVyZWQuYWRkKGlkKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWxpYXNPcmRlcikgewogICAg\nICAgICAgICAgICAgYXMgPSB0b09yZGVyQWxpYXMoX29yZGVycysrKTsKICAg\nICAgICAgICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKGlkLCBhcyk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gc2VsZCA9\nIHNlbCAmJiBzZWxlY3QoY29sLCBwaiwgZmFsc2UpOwogICAgICAgIGlmIChh\nc2MgIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSAoYXMg\nIT0gbnVsbCkgPyBhcyA6IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAg\nICAgICAgICBhcHBlbmRPcmRlcmluZyhhbGlhcywgYXNjLmJvb2xlYW5WYWx1\nZSgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBcHBlbmQgb3JkZXJpbmcgaW5mb3JtYXRpb24gdG8g\nb3VyIGludGVybmFsIGJ1ZmZlci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFwcGVuZE9yZGVyaW5nKE9iamVjdCBvcmRlckJ5LCBib29sZWFuIGFzYykg\newogICAgICAgIGlmIChfb3JkZXJpbmcgPT0gbnVsbCkKICAgICAgICAgICAg\nX29yZGVyaW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIsICIpOwoKICAgICAg\nICBpZiAob3JkZXJCeSBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAg\nICAgX29yZGVyaW5nLmFwcGVuZCgoU1FMQnVmZmVyKSBvcmRlckJ5KTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQoKFN0cmlu\nZykgb3JkZXJCeSk7CiAgICAgICAgaWYgKGFzYykKICAgICAgICAgICAgX29y\nZGVyaW5nLmFwcGVuZCgiIEFTQyIpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX29yZGVyaW5nLmFwcGVuZCgiIERFU0MiKTsKICAgIH0KCiAgICBwdWJs\naWMgaW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBib29sZWFuIGFzYywKICAgICAgICBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5UHJpbWFyeUtleShtYXBwaW5nLCBhc2MsIG51bGws\nIHNlbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFyeUtl\neShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAgICAg\nSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9y\nZGVyQnlQcmltYXJ5S2V5KG1hcHBpbmcsIGFzYywgam9pbnMsIHNlbCwgZmFs\nc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNl\ndCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIHB1Ymxp\nYyBpbnQgb3JkZXJCeVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nIGJvb2xlYW4gYXNjLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFuIHNl\nbCwgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIHByaW1h\ncnlLZXlPcGVyYXRpb24obWFwcGluZywgc2VsLAogICAgICAgICAgICAoYXNj\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsIGpvaW5zLCBhbGlh\nc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KENv\nbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5KGNvbCwgYXNjLCBudWxsLCBzZWwpOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9vbGVh\nbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAgIHJl\ndHVybiBvcmRlckJ5KGNvbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFz\nZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9vbGVhbiBvcmRl\nckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9v\nbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAg\nICAgcmV0dXJuIGNvbHVtbk9wZXJhdGlvbihjb2wsIHNlbCwgKGFzYykgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLAogICAgICAgICAgICBnZXRK\nb2lucyhqb2lucywgdHJ1ZSksIGFsaWFzT3JkZXIpOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFzYywg\nYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xzLCBh\nc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5\nKENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9v\nbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xzLCBhc2Ms\nIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFs\nbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5zLgog\nICAgICovCiAgICBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29sZWFu\nIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xl\nYW4gYWxpYXNPcmRlcikgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpv\naW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBpZiAoY29sdW1uT3BlcmF0aW9uKGNvbHNbaV0sIHNlbCwKICAg\nICAgICAgICAgICAgIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRSwgcGosIGFsaWFzT3JkZXIpKQogICAgICAgICAgICAgICAgc2VsZCB8\nPSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIgc3FsLCBib29sZWFuIGFz\nYywgYm9vbGVhbiBzZWwsIFZhbHVlIHNlbEFzKQogICAgewogICAgICAgIHJl\ndHVybiBvcmRlckJ5KHNxbCwgYXNjLCAoSm9pbnMpIG51bGwsIHNlbCwgc2Vs\nQXMpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU1FMQnVm\nZmVyIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLAogICAgICAgIGJv\nb2xlYW4gc2VsLCBWYWx1ZSBzZWxBcykgewogICAgICAgIHJldHVybiBvcmRl\nckJ5KHNxbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSwgc2VsQXMpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2Vz\nIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4gb3JkZXJC\neShTUUxCdWZmZXIgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJv\nb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlciwgVmFsdWUg\nc2VsQXMpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeSgoT2JqZWN0KSBzcWws\nIGFzYywgam9pbnMsIHNlbCwgYWxpYXNPcmRlciwgc2VsQXMpOwogICAgfQoK\nICAgIC8qKgogICAgICogT3JkZXIgb24gYSBTUUwgYnVmZmVyIG9yIHN0cmlu\nZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIG9yZGVyQnkoT2JqZWN0\nIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwK\nICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIsIFZhbHVlIHNlbEFzKSB7CiAg\nICAgICAgT2JqZWN0IG9yZGVyID0gc3FsOwogICAgICAgIGlmIChhbGlhc09y\nZGVyKSB7CiAgICAgICAgICAgIG9yZGVyID0gdG9PcmRlckFsaWFzKF9vcmRl\ncnMrKyk7CiAgICAgICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKHNxbCwg\nKFN0cmluZykgb3JkZXIpOwogICAgICAgIH0KICAgICAgICBpZiAoKF9mbGFn\ncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAwKSB7CiAgICAgICAgICAgIGlmIChf\nb3JkZXJlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgX29yZGVyZWQgPSBu\nZXcgQXJyYXlMaXN0KDUpOwogICAgICAgICAgICBfb3JkZXJlZC5hZGQoc2Vs\nQXMgPT0gbnVsbCA/IHNxbCA6IHNlbEFzKTsKICAgICAgICB9CgogICAgICAg\nIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBhcHBlbmRPcmRlcmlu\nZyhzZWxBcyAhPSBudWxsID8gc2VsQXMuZ2V0QWxpYXMoKSA6IG9yZGVyLCBh\nc2MpOwogICAgICAgIGlmIChzZWwpIHsKICAgICAgICAgICAgaW50IGlkeCA9\nIF9zZWxlY3RzLmluZGV4T2ZBbGlhcyhzcWwpOwogICAgICAgICAgICBpZiAo\naWR4ID09IC0xKSB7CiAgICAgICAgICAgICAgICBfc2VsZWN0cy5zZXRBbGlh\ncyhudWxsSWQoKSwgc3FsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJCeShT\ndHJpbmcgc3FsLCBib29sZWFuIGFzYywgYm9vbGVhbiBzZWwpIHsKICAgICAg\nICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBzcWwsIGJvb2xl\nYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwpIHsKICAgICAgICBy\nZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlh\nc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4gb3Jk\nZXJCeShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJv\nb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAg\nICAgIHJldHVybiBvcmRlckJ5KChPYmplY3QpIHNxbCwgYXNjLCBqb2lucywg\nc2VsLCBhbGlhc09yZGVyLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBjbGVhck9yZGVyaW5nKCkgewogICAgICAgIF9vcmRlcmluZyA9IG51bGw7\nCiAgICAgICAgX29yZGVycyA9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nbGxvdyB1bmlvbnMgdG8gcmVjb3JkIHRoZSBzZWxlY3QgbGlzdCBpbmRleGVz\nIG9mIGl0ZW1zIHdlIG9yZGVyIGJ5LgogICAgICovCiAgICB2b2lkIHNldFJl\nY29yZE9yZGVyZWRJbmRleGVzKGJvb2xlYW4gcmVjb3JkKSB7CiAgICAgICAg\naWYgKHJlY29yZCkKICAgICAgICAgICAgX2ZsYWdzIHw9IFJFQ09SRF9PUkRF\nUkVEOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBfb3JkZXJlZCA9IG51\nbGw7CiAgICAgICAgICAgIF9mbGFncyAmPSB+UkVDT1JEX09SREVSRUQ7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBpbmRl\neGVzIGluIHRoZSBzZWxlY3QgbGlzdCBvZiBhbGwgaXRlbXMgd2UncmUgb3Jk\nZXJpbmcKICAgICAqIGJ5LCBvciBudWxsIGlmIG5vbmUuIEZvciB1c2Ugd2l0\naCB1bmlvbnMuCiAgICAgKi8KICAgIExpc3QgZ2V0T3JkZXJlZEluZGV4ZXMo\nKSB7CiAgICAgICAgaWYgKF9vcmRlcmVkID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIExpc3QgaWR4cyA9IG5ldyBBcnJheUxp\nc3QoX29yZGVyZWQuc2l6ZSgpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IF9vcmRlcmVkLnNpemUoKTsgaSsrKQogICAgICAgICAgICBpZHhzLmFk\nZChOdW1iZXJzLnZhbHVlT2YoX3NlbGVjdHMuaW5kZXhPZihfb3JkZXJlZC5n\nZXQoaSkpKSk7CiAgICAgICAgcmV0dXJuIGlkeHM7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9iamVjdCBvaWQsIENsYXNzTWFw\ncGluZyBtYXBwaW5nLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkgewogICAg\nICAgIHdoZXJlUHJpbWFyeUtleShvaWQsIG1hcHBpbmcsIG51bGwsIHN0b3Jl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB3aGVyZSBjb25kaXRpb25z\nIHNldHRpbmcgdGhlIG1hcHBpbmcncyBwcmltYXJ5IGtleSB0byB0aGUgZ2l2\nZW4KICAgICAqIG9pZCB2YWx1ZXMuIElmIHRoZSBnaXZlbiBtYXBwaW5nIGRv\nZXMgbm90IHVzZSBvaWQgdmFsdWVzIGZvciBpdHMKICAgICAqIHByaW1hcnkg\na2V5LCB3ZSB3aWxsIHJlY3Vyc2l2ZWx5IGpvaW4gdG8gaXRzIHN1cGVyY2xh\nc3MgdW50aWwgd2UgZmluZAogICAgICogYW4gYW5jZXN0b3IgdGhhdCBkb2Vz\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9i\namVjdCBvaWQsIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKb2lucyBqb2lucywK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICAvLyBpZiB0aGlz\nIG1hcHBpbmcncyBpZGVudGlmaWVycyBpbmNsdWRlIHNvbWV0aGluZyBvdGhl\nciB0aGFuCiAgICAgICAgLy8gdGhlIHBrIHZhbHVlcywgam9pbiB0byBzdXBl\nciBhbmQgcmVjdXJzZQogICAgICAgIGlmICghbWFwcGluZy5pc1ByaW1hcnlL\nZXlPYmplY3RJZChmYWxzZSkpIHsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5n\nIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCk7CiAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICBqb2lucyA9\nIG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAg\nICAgICAgd2hlcmVQcmltYXJ5S2V5KG9pZCwgc3VwLCBqb2lucywgc3RvcmUp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBDb2x1\nbW5bXSBjb2xzID0gbWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwog\nICAgICAgIHdoZXJlKG9pZCwgbWFwcGluZywgY29scywgY29scywgbnVsbCwg\nbnVsbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLAogICAgICAgICAgICBzdG9y\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZv\ncmVpZ25LZXkgZmssIE9iamVjdCBvaWQsCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHdoZXJlRm9y\nZWlnbktleShmaywgb2lkLCBtYXBwaW5nLCBudWxsLCBzdG9yZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgd2hlcmUgY29uZGl0aW9ucyBzZXR0aW5n\nIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0byB0aGUgZ2l2ZW4KICAgICAqIG9p\nZCB2YWx1ZXMuCiAgICAgKgogICAgICogQHNlZSAjd2hlcmVQcmltYXJ5S2V5\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZUZvcmVpZ25LZXkoRm9y\nZWlnbktleSBmaywgT2JqZWN0IG9pZCwKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZywgSm9pbnMgam9pbnMsIEpEQkNTdG9yZSBzdG9yZSkgewogICAg\nICAgIC8vIGlmIHRoaXMgbWFwcGluZydzIGlkZW50aWZpZXJzIGluY2x1ZGUg\nc29tZXRoaW5nIG90aGVyIHRoYW4KICAgICAgICAvLyB0aGUgcGsgdmFsdWVz\nLCBvciBpZiB0aGlzIGZvcmVpZ24ga2V5IGRvZXNuJ3QgbGluayB0byBvbmx5\nCiAgICAgICAgLy8gaWRlbnRpZmllcnMsIGpvaW4gdG8gdGFibGUgYW5kIGRv\nIGEgZ2V0UHJpbWFyeUtleQogICAgICAgIGlmICghbWFwcGluZy5pc1ByaW1h\ncnlLZXlPYmplY3RJZChmYWxzZSkgfHwgIWNvbnRhaW5zQWxsCiAgICAgICAg\nICAgIChtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCksIGZrLmdldFBy\naW1hcnlLZXlDb2x1bW5zKCkpKSB7CiAgICAgICAgICAgIGlmIChqb2lucyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwog\nICAgICAgICAgICAvLyB0cmF2ZXJzZSB0byBmb3JlaWduIGtleSB0YXJnZXQg\nbWFwcGluZwogICAgICAgICAgICB3aGlsZSAobWFwcGluZy5nZXRUYWJsZSgp\nICE9IGZrLmdldFByaW1hcnlLZXlUYWJsZSgpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBqb2lu\ncyA9IG5ld0pvaW5zKCk7CiAgICAgICAgICAgICAgICBqb2lucyA9IG1hcHBp\nbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIG1hcHBpbmcgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmcgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBqb2lucyA9IGpv\naW5zLmpvaW4oZmssIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIHdoZXJl\nUHJpbWFyeUtleShvaWQsIG1hcHBpbmcsIGpvaW5zLCBzdG9yZSk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGZy\nb21Db2xzID0gZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHRv\nQ29scyA9IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgQ29s\ndW1uW10gY29uc3RDb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAg\nICAgICAgT2JqZWN0W10gY29uc3RzID0gZmsuZ2V0Q29uc3RhbnRzKCk7CiAg\nICAgICAgd2hlcmUob2lkLCBtYXBwaW5nLCB0b0NvbHMsIGZyb21Db2xzLCBj\nb25zdHMsIGNvbnN0Q29scywKICAgICAgICAgICAgZ2V0Sm9pbnMoam9pbnMs\nIHRydWUpLCBzdG9yZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5h\nbCBtZXRob2QgdG8gZmx1c2ggdGhlIG9pZCB2YWx1ZXMgYXMgd2hlcmUgY29u\nZGl0aW9ucyB0byB0aGUKICAgICAqIGdpdmVuIGNvbHVtbnMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCB3aGVyZShPYmplY3Qgb2lkLCBDbGFzc01hcHBp\nbmcgbWFwcGluZywgQ29sdW1uW10gdG9Db2xzLAogICAgICAgIENvbHVtbltd\nIGZyb21Db2xzLCBPYmplY3RbXSB2YWxzLCBDb2x1bW5bXSBjb25zdENvbHMs\nIFBhdGhKb2lucyBwaiwKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAg\nICAgICBWYWx1ZU1hcHBpbmcgZW1iZWQgPSBtYXBwaW5nLmdldEVtYmVkZGlu\nZ01hcHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgIT0gbnVsbCkgewogICAg\nICAgICAgICB3aGVyZShvaWQsIGVtYmVkLmdldEZpZWxkTWFwcGluZygpLmdl\ndERlZmluaW5nTWFwcGluZygpLAogICAgICAgICAgICAgICAgdG9Db2xzLCBm\ncm9tQ29scywgdmFscywgY29uc3RDb2xzLCBwaiwgc3RvcmUpOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBvbmx5IGJvdGhl\nciB0byBwYWNrIHBrIHZhbHVlcyBpbnRvIGFycmF5IGlmIGFwcCBpZAogICAg\nICAgIE9iamVjdFtdIHBrcyA9IG51bGw7CiAgICAgICAgaWYgKG1hcHBpbmcu\nZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0FQUExJQ0FU\nSU9OKQogICAgICAgICAgICBwa3MgPSBBcHBsaWNhdGlvbklkcy50b1BLVmFs\ndWVzKG9pZCwgbWFwcGluZyk7CgogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBu\nZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAgICAgICBKb2luYWJsZSBqb2luOwog\nICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAgaW50IGNvdW50ID0gMDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRvQ29scy5sZW5ndGg7IGkrKywg\nY291bnQrKykgewogICAgICAgICAgICBpZiAocGtzID09IG51bGwpCiAgICAg\nICAgICAgICAgICB2YWwgPSAob2lkID09IG51bGwpID8gbnVsbCA6CiAgICAg\nICAgICAgICAgICAgICAgICAgIE51bWJlcnMudmFsdWVPZigoKElkKSBvaWQp\nLmdldElkKCkpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAg\nIC8vIG11c3QgYmUgYXBwIGlkZW50aXR5OyB1c2UgcGsgaW5kZXggdG8gZ2V0\nIGNvcnJlY3QgcGsgdmFsdWUKICAgICAgICAgICAgICAgIGpvaW4gPSBtYXBw\naW5nLmFzc2VydEpvaW5hYmxlKHRvQ29sc1tpXSk7CiAgICAgICAgICAgICAg\nICB2YWwgPSBwa3NbbWFwcGluZy5nZXRGaWVsZChqb2luLmdldEZpZWxkSW5k\nZXgoKSkuCiAgICAgICAgICAgICAgICAgICAgZ2V0UHJpbWFyeUtleUluZGV4\nKCldOwogICAgICAgICAgICAgICAgdmFsID0gam9pbi5nZXRKb2luVmFsdWUo\ndmFsLCB0b0NvbHNbaV0sIHN0b3JlKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZ2V0Q29sdW1u\nQWxpYXMoZnJvbUNvbHNbaV0sIHBqKSk7CiAgICAgICAgICAgIGlmICh2YWwg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJUyAiKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nID0gIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1ZSh2YWwsIGZyb21D\nb2xzW2ldKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb25zdENvbHMgIT0g\nbnVsbCAmJiBjb25zdENvbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvbnN0Q29scy5sZW5ndGg7IGkrKywgY291\nbnQrKykgewogICAgICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZChnZXRDb2x1bW5BbGlhcyhjb25zdENvbHNbaV0s\nIHBqKSk7CgogICAgICAgICAgICAgICAgaWYgKHZhbHNbaV0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiID0gIik7CiAgICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUodmFs\nc1tpXSwgY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgd2hlcmUoYnVmLCBwaik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUZXN0IHRvIHNlZSBpZiB0aGUgZ2l2ZW4gc2V0IG9mIGNvbHVtbnMgY29u\ndGFpbnMgYWxsIHRoZQogICAgICogY29sdW1ucyBpbiB0aGUgZ2l2ZW4gcG90\nZW50aWFsIHN1YnNldC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiBjb250YWluc0FsbChDb2x1bW5bXSBzZXQsIENvbHVtbltdIHN1Yikg\newogICAgICAgIGlmIChzdWIubGVuZ3RoID4gc2V0Lmxlbmd0aCkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB0aGlzIGlzIG9idmlv\ndXNseSBuXjIsIGJ1dCB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgc2hvdWxkIGJl\nIGluCiAgICAgICAgLy8gdGhlIDEtMiByYW5nZSwgc28gbm8gYmlnZ2llCiAg\nICAgICAgYm9vbGVhbiBmb3VuZCA9IHRydWU7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBzdWIubGVuZ3RoICYmIGZvdW5kOyBpKyspIHsKICAgICAg\nICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9\nIDA7IGogPCBzZXQubGVuZ3RoICYmICFmb3VuZDsgaisrKQogICAgICAgICAg\nICAgICAgZm91bmQgPSBzdWJbaV0gPT0gc2V0W2pdOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZm91bmQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hl\ncmUoSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMgIT0gbnVsbCkK\nICAgICAgICAgICAgd2hlcmUoKFN0cmluZykgbnVsbCwgam9pbnMpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFNRTEJ1ZmZlciBzcWwpIHsKICAg\nICAgICB3aGVyZShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsK\nICAgICAgICB3aGVyZShzcWwsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNvbmRpdGlvbiB0\nbyB0aGUgV0hFUkUgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nd2hlcmUoU1FMQnVmZmVyIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAg\nLy8gbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoc3FsID09\nIG51bGwgfHwgc3FsLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpZiAoX3doZXJlID09IG51bGwpCiAgICAgICAgICAgIF93aGVy\nZSA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFf\nd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAgICBfd2hlcmUuYXBwZW5kKCIg\nQU5EICIpOwogICAgICAgIF93aGVyZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB3aGVyZShTdHJpbmcgc3FsKSB7CiAgICAgICAgd2hl\ncmUoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdoZXJlKFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgd2hl\ncmUoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhlIFdIRVJF\nIGNsYXVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlKFN0cmlu\nZyBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8g\ndXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\nc3FsKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3doZXJl\nID09IG51bGwpCiAgICAgICAgICAgIF93aGVyZSA9IG5ldyBTUUxCdWZmZXIo\nX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFfd2hlcmUuaXNFbXB0eSgpKQog\nICAgICAgICAgICBfd2hlcmUuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF93\naGVyZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZp\nbmcoU1FMQnVmZmVyIHNxbCkgewogICAgICAgIGhhdmluZyhzcWwsIChKb2lu\ncykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFNRTEJ1\nZmZlciBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaGF2aW5nKHNxbCwg\nZ2V0Sm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBz\ncWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNl\nIGpvaW5zLi4uCiAgICAgICAgaWYgKHNxbCA9PSBudWxsIHx8IHNxbC5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9oYXZp\nbmcgPT0gbnVsbCkKICAgICAgICAgICAgX2hhdmluZyA9IG5ldyBTUUxCdWZm\nZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFfaGF2aW5nLmlzRW1wdHko\nKSkKICAgICAgICAgICAgX2hhdmluZy5hcHBlbmQoIiBBTkQgIik7CiAgICAg\nICAgX2hhdmluZy5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBoYXZpbmcoU3RyaW5nIHNxbCkgewogICAgICAgIGhhdmluZyhzcWwsIChK\nb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFN0\ncmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaGF2aW5nKHNxbCwg\nZ2V0Sm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5nKFN0cmluZyBzcWws\nIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpv\naW5zLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3FsKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2hhdmluZyA9PSBu\ndWxsKQogICAgICAgICAgICBfaGF2aW5nID0gbmV3IFNRTEJ1ZmZlcihfZGlj\ndCk7CiAgICAgICAgZWxzZSBpZiAoIV9oYXZpbmcuaXNFbXB0eSgpKQogICAg\nICAgICAgICBfaGF2aW5nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBfaGF2\naW5nLmFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3Vw\nQnkoU1FMQnVmZmVyIHNxbCkgewogICAgICAgIGdyb3VwQnkoc3FsLCAoSm9p\nbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU1FM\nQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBnZXRKb2lucyhq\nb2lucywgdHJ1ZSk7CiAgICAgICAgZ3JvdXBCeUFwcGVuZChzcWwuZ2V0U1FM\nKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU3RyaW5nIHNx\nbCkgewogICAgICAgIGdyb3VwQnkoc3FsLCAoSm9pbnMpIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU3RyaW5nIHNxbCwgSm9pbnMg\nam9pbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAg\nICAgZ3JvdXBCeUFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGdyb3VwQnkoQ29sdW1uIGNvbCkgewogICAgICAgIGdyb3VwQnkoY29sLCBu\ndWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENvbHVtbiBj\nb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0\nSm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGdyb3VwQnlBcHBlbmQoZ2V0\nQ29sdW1uQWxpYXMoY29sLCBwaikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGdyb3VwQnkoQ29sdW1uW10gY29scykgewogICAgICAgIGdyb3VwQnkoY29s\ncywgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1\nbW5bXSBjb2xzLCBKb2lucyBqb2lucykgewogICAgICAgIFBhdGhKb2lucyBw\naiA9IGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ3Jv\ndXBCeUFwcGVuZChnZXRDb2x1bW5BbGlhcyhjb2xzW2ldLCBwaikpOwogICAg\nICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGdyb3VwQnlBcHBl\nbmQoU3RyaW5nIHNxbCkgewogICAgICAgIGlmIChfZ3JvdXBlZCA9PSBudWxs\nIHx8ICFfZ3JvdXBlZC5jb250YWlucyhzcWwpKSB7CiAgICAgICAgICAgIGlm\nIChfZ3JvdXBpbmcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2dyb3Vw\naW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgICAgICAgICBf\nZ3JvdXBlZCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICBfZ3JvdXBpbmcuYXBwZW5kKCIsICIpOwoKICAg\nICAgICAgICAgX2dyb3VwaW5nLmFwcGVuZChzcWwpOwogICAgICAgICAgICBf\nZ3JvdXBlZC5hZGQoc3FsKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgZ3JvdXBCeShDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNs\nYXNzZXMsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgZ3JvdXBCeShtYXBwaW5nLCBz\ndWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGdyb3VwQnkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBz\ndWJjbGFzc2VzLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpIHsKICAgICAgICAv\nLyB3ZSBpbXBsZW1lbnQgdGhpcyBieSBwdXR0aW5nIG91cnNlbHZlcyBpbnRv\nIGdyb3VwaW5nIG1vZGUsIHdoZXJlCiAgICAgICAgLy8gYWxsIHNlbGVjdCBp\nbnZvY2F0aW9ucyBhcmUgcmUtcm91dGVkIHRvIGdyb3VwLWJ5IGludm9jYXRp\nb25zIGluc3RlYWQuCiAgICAgICAgLy8gdGhpcyBhbGxvd3MgdXMgdG8gdXRp\nbGl6ZSB0aGUgc2FtZSBzZWxlY3QgQVBJcyBvZiB0aGUgc3RvcmUgbWFuYWdl\ncgogICAgICAgIC8vIGFuZCBhbGwgdGhlIG1hcHBpbmcgc3RyYXRlZ2llcywg\ncmF0aGVyIHRoYW4gaGF2aW5nIHRvIGNyZWF0ZSAKICAgICAgICAvLyBlcXVp\ndmFsZW50IEFQSXMgYW5kIGR1cGxpY2F0ZSBsb2dpYyBmb3IgZ3JvdXBpbmcK\nICAgICAgICBib29sZWFuIHdhc0dyb3VwaW5nID0gaXNHcm91cGluZygpOwog\nICAgICAgIF9mbGFncyB8PSBHUk9VUElORzsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBzZWxlY3QobWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZl\ndGNoLCAKICAgICAgICAgICAgICAgIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9O\nT05FLCBqb2lucyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKCF3YXNHcm91cGluZykKICAgICAgICAgICAgICAgIF9mbGFncyAmPSB+\nR1JPVVBJTkc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB3ZSdyZSBpbiBncm91cCBtb2RlLCB3aGVyZSBhbnkgc2VsZWN0IGlz\nIGNoYW5nZWQgdG8gYSBncm91cC1ieQogICAgICogY2FsbC4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGlzR3JvdXBpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBHUk9VUElORykgIT0gMDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgam9pbnMgdG8gdXNlIGZvciBjb2x1bW4gYWxp\nYXNlcywgZXRjLgogICAgICoKICAgICAqIEBwYXJhbSBqb2lucyBqb2lucyBn\naXZlbiBieSB0aGUgdXNlcgogICAgICogQHJldHVybiB0aGUgam9pbnMgdG8g\ndXNlIGZvciBhbGlhc2VzLCBldGMKICAgICAqLwogICAgcHJpdmF0ZSBQYXRo\nSm9pbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMsIGJvb2xlYW4gcmVjb3JkKSB7\nCiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9pbnM7CiAg\nICAgICAgYm9vbGVhbiBwcmUgPSAocGogPT0gbnVsbCB8fCAhcGouaXNEaXJ0\neSgpKQogICAgICAgICAgICAmJiBfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3By\nZUpvaW5zLmlzRW1wdHkoKTsKICAgICAgICBpZiAocHJlKQogICAgICAgICAg\nICBwaiA9IChQYXRoSm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7CgogICAgICAg\nIGlmIChwaiA9PSBudWxsIHx8ICFwai5pc0RpcnR5KCkpCiAgICAgICAgICAg\nIHBqID0gX2pvaW5zOwogICAgICAgIGVsc2UgaWYgKCFwcmUpIHsKICAgICAg\nICAgICAgaWYgKChfZmxhZ3MgJiBPVVRFUikgIT0gMCkKICAgICAgICAgICAg\nICAgIHBqID0gKFBhdGhKb2lucykgb3V0ZXIocGopOwogICAgICAgICAgICBp\nZiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICBpZiAoIXBqLmlzRW1wdHko\nKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zID0gbmV3IFNlbGVjdEpv\naW5zKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChfam9pbnMuam9p\nbnMoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfam9pbnMu\nc2V0Sm9pbnMobmV3IEpvaW5TZXQocGouam9pbnMoKSkpOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5z\nLmpvaW5zKCkuYWRkQWxsKHBqLmpvaW5zKCkpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBwajsK\nICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3Igd2hlcmVDbG9uZShp\nbnQgc2VscykgewogICAgICAgIGlmIChzZWxzIDwgMSkKICAgICAgICAgICAg\nc2VscyA9IDE7CgogICAgICAgIFNlbGVjdFtdIGNsb25lcyA9IG51bGw7CiAg\nICAgICAgU2VsZWN0SW1wbCBzZWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBzZWxzOyBpKyspIHsKICAgICAgICAgICAgc2VsID0gKFNlbGVjdElt\ncGwpIF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1NlbGVjdCgp\nOwogICAgICAgICAgICBzZWwuX2ZsYWdzID0gX2ZsYWdzOwogICAgICAgICAg\nICBzZWwuX2ZsYWdzICY9IH5BR0dSRUdBVEU7CiAgICAgICAgICAgIHNlbC5f\nZmxhZ3MgJj0gfk9VVEVSOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5M\nUlM7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfkVBR0VSX1RPX09ORTsK\nICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+RUFHRVJfVE9fTUFOWTsKICAg\nICAgICAgICAgc2VsLl9mbGFncyAmPSB+Rk9SQ0VfQ09VTlQ7CiAgICAgICAg\nICAgIHNlbC5fam9pblN5bnRheCA9IF9qb2luU3ludGF4OwogICAgICAgICAg\nICBzZWwuX3NjaGVtYUFsaWFzID0gX3NjaGVtYUFsaWFzOwogICAgICAgICAg\nICBpZiAoX2FsaWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5f\nYWxpYXNlcyA9IG5ldyBIYXNoTWFwKF9hbGlhc2VzKTsKICAgICAgICAgICAg\naWYgKF90YWJsZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fdGFi\nbGVzID0gbmV3IFRyZWVNYXAoX3RhYmxlcyk7CiAgICAgICAgICAgIGlmIChf\nam9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fam9pbnMgPSBf\nam9pbnMuY2xvbmUoc2VsKTsKICAgICAgICAgICAgaWYgKF93aGVyZSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgc2VsLl93aGVyZSA9IG5ldyBTUUxCdWZm\nZXIoX3doZXJlKTsKICAgICAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIHNlbC5fZnJvbSA9IChTZWxlY3RJbXBsKSBfZnJv\nbS53aGVyZUNsb25lKDEpOwogICAgICAgICAgICAgICAgc2VsLl9mcm9tLl9v\ndXRlciA9IHNlbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX3N1\nYnNlbHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsLl9zdWJzZWxz\nID0gbmV3IEFycmF5TGlzdChfc3Vic2Vscy5zaXplKCkpOwogICAgICAgICAg\nICAgICAgU2VsZWN0SW1wbCBzdWIsIHNlbFN1YjsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgX3N1YnNlbHMuc2l6ZSgpOyBqKyspIHsK\nICAgICAgICAgICAgICAgICAgICBzdWIgPSAoU2VsZWN0SW1wbCkgX3N1YnNl\nbHMuZ2V0KGopOwogICAgICAgICAgICAgICAgICAgIHNlbFN1YiA9IChTZWxl\nY3RJbXBsKSBzdWIuZnVsbENsb25lKDEpOwogICAgICAgICAgICAgICAgICAg\nIHNlbFN1Yi5fcGFyZW50ID0gc2VsOwogICAgICAgICAgICAgICAgICAgIHNl\nbFN1Yi5fc3ViUGF0aCA9IHN1Yi5fc3ViUGF0aDsKICAgICAgICAgICAgICAg\nICAgICBzZWwuX3N1YnNlbHMuYWRkKHNlbFN1Yik7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHNlbC5fd2hlcmUgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgc2VsLl93aGVyZS5yZXBsYWNlKHN1Yiwgc2VsU3ViKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKHNlbHMgPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiBzZWw7CiAgICAg\nICAgICAgIGlmIChjbG9uZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNs\nb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107CiAgICAgICAgICAgIGNsb25lc1tp\nXSA9IHNlbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jb25mLmdldFNR\nTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1VuaW9uKGNsb25lcyk7CiAgICB9Cgog\nICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIGZ1bGxDbG9uZShpbnQgc2Vscykg\newogICAgICAgIGlmIChzZWxzIDwgMSkKICAgICAgICAgICAgc2VscyA9IDE7\nCgogICAgICAgIFNlbGVjdFtdIGNsb25lcyA9IG51bGw7CiAgICAgICAgU2Vs\nZWN0SW1wbCBzZWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZWxz\nOyBpKyspIHsKICAgICAgICAgICAgc2VsID0gKFNlbGVjdEltcGwpIHdoZXJl\nQ2xvbmUoMSk7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7CiAg\nICAgICAgICAgIHNlbC5fZXhwZWN0ZWRSZXN1bHRDb3VudCA9IF9leHBlY3Rl\nZFJlc3VsdENvdW50OwogICAgICAgICAgICBzZWwuX3NlbGVjdHMuYWRkQWxs\nKF9zZWxlY3RzKTsKICAgICAgICAgICAgaWYgKF9vcmRlcmluZyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgc2VsLl9vcmRlcmluZyA9IG5ldyBTUUxCdWZm\nZXIoX29yZGVyaW5nKTsKICAgICAgICAgICAgc2VsLl9vcmRlcnMgPSBfb3Jk\nZXJzOwogICAgICAgICAgICBpZiAoX2dyb3VwaW5nICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBzZWwuX2dyb3VwaW5nID0gbmV3IFNRTEJ1ZmZlcihfZ3Jv\ndXBpbmcpOwogICAgICAgICAgICBpZiAoX2hhdmluZyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgc2VsLl9oYXZpbmcgPSBuZXcgU1FMQnVmZmVyKF9oYXZp\nbmcpOwogICAgICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgc2VsLl9mcm9tID0gKFNlbGVjdEltcGwpIF9mcm9tLmZ1bGxD\nbG9uZSgxKTsKICAgICAgICAgICAgICAgIHNlbC5fZnJvbS5fb3V0ZXIgPSBz\nZWw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWxzID09IDEp\nCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsOwogICAgICAgICAgICBpZiAo\nY2xvbmVzID09IG51bGwpCiAgICAgICAgICAgICAgICBjbG9uZXMgPSBuZXcg\nU2VsZWN0W3NlbHNdOwogICAgICAgICAgICBjbG9uZXNbaV0gPSBzZWw7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfY29uZi5nZXRTUUxGYWN0b3J5SW5z\ndGFuY2UoKS5uZXdVbmlvbihjbG9uZXMpOwogICAgfQoKICAgIHB1YmxpYyBT\nZWxlY3RFeGVjdXRvciBlYWdlckNsb25lKEZpZWxkTWFwcGluZyBrZXksIGlu\ndCBlYWdlclR5cGUsCiAgICAgICAgYm9vbGVhbiB0b01hbnksIGludCBzZWxz\nKSB7CiAgICAgICAgaWYgKGVhZ2VyVHlwZSA9PSBFQUdFUl9PVVRFUgogICAg\nICAgICAgICAmJiBfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFY\nX1RSQURJVElPTkFMKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpZiAoX2VhZ2VyS2V5cyAhPSBudWxsICYmIF9lYWdlcktleXMuY29udGFp\nbnMoa2V5KSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8v\nIGdsb2JhbCBzZXQgb2YgZWFnZXIga2V5cwogICAgICAgIGlmIChfZWFnZXJL\nZXlzID09IG51bGwpCiAgICAgICAgICAgIF9lYWdlcktleXMgPSBuZXcgSGFz\naFNldCgpOwogICAgICAgIF9lYWdlcktleXMuYWRkKGtleSk7CgogICAgICAg\nIFNlbGVjdEV4ZWN1dG9yIHNlbDsKICAgICAgICBpZiAoZWFnZXJUeXBlICE9\nIEVBR0VSX1BBUkFMTEVMKSB7CiAgICAgICAgICAgIGlmICh0b01hbnkpCiAg\nICAgICAgICAgICAgICBfZmxhZ3MgfD0gRUFHRVJfVE9fTUFOWTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEVBR0VSX1RP\nX09ORTsKICAgICAgICAgICAgc2VsID0gdGhpczsKICAgICAgICB9IGVsc2Ug\naWYgKHNlbHMgPCAyKQogICAgICAgICAgICBzZWwgPSBwYXJhbGxlbENsb25l\nKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIFNlbGVjdFtdIGNsb25l\ncyA9IG5ldyBTZWxlY3Rbc2Vsc107CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY2xvbmVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\nY2xvbmVzW2ldID0gcGFyYWxsZWxDbG9uZSgpOwogICAgICAgICAgICBzZWwg\nPSBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdVbmlvbihjbG9u\nZXMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9lYWdlciA9PSBudWxsKQog\nICAgICAgICAgICBfZWFnZXIgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9l\nYWdlci5wdXQodG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwsIGZhbHNl\nKSksIHNlbCk7CiAgICAgICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIGNsb25lIG9mIHRoaXMgc2VsZWN0IGZvciB1c2Ug\naW4gZWFnZXIgcGFyYWxsZWwgc2VsZWN0cy4KICAgICAqLwogICAgcHJpdmF0\nZSBTZWxlY3RJbXBsIHBhcmFsbGVsQ2xvbmUoKSB7CiAgICAgICAgU2VsZWN0\nSW1wbCBzZWwgPSAoU2VsZWN0SW1wbCkgd2hlcmVDbG9uZSgxKTsKICAgICAg\nICBzZWwuX2ZsYWdzICY9IH5OT05BVVRPX0RJU1RJTkNUOwogICAgICAgIHNl\nbC5fZWFnZXJLZXlzID0gX2VhZ2VyS2V5czsKICAgICAgICBpZiAoX3ByZUpv\naW5zICE9IG51bGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgc2VsLl9wcmVKb2lucyA9IG5ldyBTdGFjaygpOwogICAgICAgICAg\nICBzZWwuX3ByZUpvaW5zLnB1c2goKChTZWxlY3RKb2lucykgX3ByZUpvaW5z\nLnBlZWsoKSkuCiAgICAgICAgICAgICAgICBjbG9uZShzZWwpKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB2aWV3IG9mIGVhZ2VyIHNlbGVjdHMuIE1heSBiZSBudWxsLgog\nICAgICovCiAgICBwdWJsaWMgTWFwIGdldEVhZ2VyTWFwKCkgewogICAgICAg\nIHJldHVybiBfZWFnZXI7CiAgICB9CgogICAgcHVibGljIFNlbGVjdEV4ZWN1\ndG9yIGdldEVhZ2VyKEZpZWxkTWFwcGluZyBrZXkpIHsKICAgICAgICBpZiAo\nX2VhZ2VyID09IG51bGwgfHwgIV9lYWdlcktleXMuY29udGFpbnMoa2V5KSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIChTZWxl\nY3RFeGVjdXRvcikgX2VhZ2VyLmdldCh0b0VhZ2VyS2V5KGtleSwgZ2V0Sm9p\nbnMobnVsbCwKICAgICAgICAgICAgZmFsc2UpKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGVhZ2VyIGtleSB0byB1c2UgZm9yIHRoZSB1\nc2VyLWdpdmVuIGtleS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2Jq\nZWN0IHRvRWFnZXJLZXkoRmllbGRNYXBwaW5nIGtleSwgUGF0aEpvaW5zIHBq\nKSB7CiAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgpID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgcmV0dXJuIG5l\ndyBLZXkocGoucGF0aCgpLnRvU3RyaW5nKCksIGtleSk7CiAgICB9CgogICAg\ncHVibGljIEpvaW5zIG5ld0pvaW5zKCkgewogICAgICAgIGlmIChfcHJlSm9p\nbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHkoKSkgewogICAgICAg\nICAgICBTZWxlY3RKb2lucyBzaiA9IChTZWxlY3RKb2lucykgX3ByZUpvaW5z\nLnBlZWsoKTsKICAgICAgICAgICAgcmV0dXJuIHNqLmNsb25lKHRoaXMpOwog\nICAgICAgIH0KICAgICAgICAvLyByZXR1cm4gdGhpcyBmb3IgZWZmaWNpZW5j\neSBpbiBjYXNlIG5vIGpvaW5zIGVuZCB1cCBiZWluZyBtYWRlCiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG5ld091dGVy\nSm9pbnMoKSB7CiAgICAgICAgcmV0dXJuICgoUGF0aEpvaW5zKSBuZXdKb2lu\ncygpKS5zZXRPdXRlcih0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBh\ncHBlbmQoU1FMQnVmZmVyIGJ1ZiwgSm9pbnMgam9pbnMpIHsKICAgICAgICBp\nZiAoam9pbnMgPT0gbnVsbCB8fCBqb2lucy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAoX2pvaW5TeW50YXggPT0gSm9pblN5\nbnRheGVzLlNZTlRBWF9TUUw5MikKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBpZiAoIWJ1Zi5pc0VtcHR5KCkpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgSm9pbiBqb2luID0gbnVsbDsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9ICgoUGF0aEpvaW5zKSBqb2lucykuam9p\nbnMoKS5qb2luSXRlcmF0b3IoKTsKICAgICAgICAgICAgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICBzd2l0Y2ggKF9qb2luU3ludGF4KSB7CiAgICAgICAgICAg\nICAgICBjYXNlIEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUw6CiAg\nICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfZGljdC50b1RyYWRpdGlv\nbmFsSm9pbihqb2luKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEpvaW5TeW50YXhlcy5TWU5UQVhfREFUQUJB\nU0U6CiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfZGljdC50b05h\ndGl2ZUpvaW4oam9pbikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgSm9pbnMgYW5kKEpvaW5zIGpvaW5zMSwgSm9pbnMgam9pbnMyKSB7\nCiAgICAgICAgcmV0dXJuIGFuZCgoUGF0aEpvaW5zKSBqb2luczEsIChQYXRo\nSm9pbnMpIGpvaW5zMiwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIFNlbGVj\ndCBnZXRTZWxlY3QoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBqb2lucy4KICAgICAq\nLwogICAgcHJpdmF0ZSBTZWxlY3RKb2lucyBhbmQoUGF0aEpvaW5zIGoxLCBQ\nYXRoSm9pbnMgajIsIGJvb2xlYW4gbnVsbEpvaW5zKSB7CiAgICAgICAgaWYg\nKChqMSA9PSBudWxsIHx8IGoxLmlzRW1wdHkoKSkKICAgICAgICAgICAgJiYg\nKGoyID09IG51bGwgfHwgajIuaXNFbXB0eSgpKSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIFNlbGVjdEpvaW5zIHNqID0gbmV3IFNlbGVj\ndEpvaW5zKHRoaXMpOwogICAgICAgIGlmIChqMSA9PSBudWxsIHx8IGoxLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoajIuZ2V0U2VsZWN0KCkgPT0g\ndGhpcykgewogICAgICAgICAgICAgICAgaWYgKG51bGxKb2lucykKICAgICAg\nICAgICAgICAgICAgICBzai5zZXRKb2lucyhqMi5qb2lucygpKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzai5zZXRKb2lu\ncyhuZXcgSm9pblNldChqMi5qb2lucygpKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICBKb2luU2V0IHNldCA9IG51bGw7\nCiAgICAgICAgICAgIGlmIChqMS5nZXRTZWxlY3QoKSA9PSB0aGlzKSB7CiAg\nICAgICAgICAgICAgICBpZiAobnVsbEpvaW5zKQogICAgICAgICAgICAgICAg\nICAgIHNldCA9IGoxLmpvaW5zKCk7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgc2V0ID0gbmV3IEpvaW5TZXQoajEuam9pbnMo\nKSk7CgogICAgICAgICAgICAgICAgaWYgKGoyICE9IG51bGwgJiYgIWoyLmlz\nRW1wdHkoKQogICAgICAgICAgICAgICAgICAgICYmIGoyLmdldFNlbGVjdCgp\nID09IHRoaXMpCiAgICAgICAgICAgICAgICAgICAgc2V0LmFkZEFsbChqMi5q\nb2lucygpKTsKICAgICAgICAgICAgICAgIHNqLnNldEpvaW5zKHNldCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG51bGwgcHJldmlv\ndXMgam9pbnM7IGFsbCBhcmUgY29tYmluZWQgaW50byB0aGlzIG9uZQogICAg\nICAgIGlmIChudWxsSm9pbnMgJiYgajEgIT0gbnVsbCkKICAgICAgICAgICAg\najEubnVsbEpvaW5zKCk7CiAgICAgICAgaWYgKG51bGxKb2lucyAmJiBqMiAh\nPSBudWxsKQogICAgICAgICAgICBqMi5udWxsSm9pbnMoKTsKCiAgICAgICAg\ncmV0dXJuIHNqOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBvcihKb2lucyBq\nb2luczEsIEpvaW5zIGpvaW5zMikgewogICAgICAgIFBhdGhKb2lucyBqMSA9\nIChQYXRoSm9pbnMpIGpvaW5zMTsKICAgICAgICBQYXRoSm9pbnMgajIgPSAo\nUGF0aEpvaW5zKSBqb2luczI7CgogICAgICAgIC8vIGlmIG5vIGNvbW1vbiBq\nb2lucywgcmV0dXJuIG51bGw7IGlmIG9uZSBzaWRlIG9mIHRoZSBvciBjbGF1\nc2UgaGFzCiAgICAgICAgLy8gZGlmZmVyZW50IGpvaW5zIHRoYW4gdGhlIG90\naGVyLCB0aGVuIHdlIG5lZWQgdG8gdXNlIGRpc3RpbmN0CiAgICAgICAgYm9v\nbGVhbiBqMUVtcHR5ID0gajEgPT0gbnVsbCB8fCBqMS5pc0VtcHR5KCk7CiAg\nICAgICAgYm9vbGVhbiBqMkVtcHR5ID0gajIgPT0gbnVsbCB8fCBqMi5pc0Vt\ncHR5KCk7CiAgICAgICAgaWYgKGoxRW1wdHkgfHwgajJFbXB0eSkgewogICAg\nICAgICAgICBpZiAoajFFbXB0eSAmJiAhajJFbXB0eSkgewogICAgICAgICAg\nICAgICAgY29sbGVjdE91dGVySm9pbnMoajIpOwogICAgICAgICAgICAgICAg\naWYgKCFqMi5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgX2ZsYWdz\nIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKGoyRW1wdHkgJiYgIWoxRW1wdHkpIHsKICAgICAgICAgICAgICAgIGNvbGxl\nY3RPdXRlckpvaW5zKGoxKTsKICAgICAgICAgICAgICAgIGlmICghajEuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIF9mbGFncyB8PSBJTVBMSUNJ\nVF9ESVNUSU5DVDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGlmIGFsbCBjb21tb24gam9p\nbnMsIG1vdmUgYWxsIGpvaW5zIHRvIHJldHVybmVkIGluc3RhbmNlCiAgICAg\nICAgU2VsZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7CiAg\nICAgICAgaWYgKGoxLmpvaW5zKCkuZXF1YWxzKGoyLmpvaW5zKCkpKSB7CiAg\nICAgICAgICAgIHNqLnNldEpvaW5zKGoxLmpvaW5zKCkpOwogICAgICAgICAg\nICBqMS5udWxsSm9pbnMoKTsKICAgICAgICAgICAgajIubnVsbEpvaW5zKCk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSm9pblNldCBjb21tb25K\nb2lucyA9IG5ldyBKb2luU2V0KGoxLmpvaW5zKCkpOwogICAgICAgICAgICBj\nb21tb25Kb2lucy5yZXRhaW5BbGwoajIuam9pbnMoKSk7CiAgICAgICAgICAg\nIGlmICghY29tbW9uSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAg\nICAvLyBwdXQgY29tbW9uIGpvaW5zIGluIHJldHVybmVkIGluc3RhbmNlOyBy\nZW1vdmUgdGhlbSBmcm9tCiAgICAgICAgICAgICAgICAvLyBlYWNoIGdpdmVu\nIGluc3RhbmNlCiAgICAgICAgICAgICAgICBzai5zZXRKb2lucyhjb21tb25K\nb2lucyk7CiAgICAgICAgICAgICAgICBqMS5qb2lucygpLnJlbW92ZUFsbChj\nb21tb25Kb2lucyk7CiAgICAgICAgICAgICAgICBqMi5qb2lucygpLnJlbW92\nZUFsbChjb21tb25Kb2lucyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nY29sbGVjdE91dGVySm9pbnMoajEpOwogICAgICAgICAgICBjb2xsZWN0T3V0\nZXJKb2lucyhqMik7CgogICAgICAgICAgICAvLyBpZiBvbmUgc2lkZSBvZiB0\naGUgb3IgY2xhdXNlIGhhcyBkaWZmZXJlbnQgam9pbnMgdGhhbiB0aGUgb3Ro\nZXIsCiAgICAgICAgICAgIC8vIHRoZW4gd2UgbmVlZCB0byB1c2UgZGlzdGlu\nY3QKICAgICAgICAgICAgaWYgKCFqMS5pc0VtcHR5KCkgfHwgIWoyLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBJTVBMSUNJVF9ESVNU\nSU5DVDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNqOwogICAgfQoKICAg\nIHB1YmxpYyBKb2lucyBvdXRlcihKb2lucyBqb2lucykgewogICAgICAgIGlm\nIChfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElP\nTkFMIHx8IGpvaW5zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBqb2lu\nczsKCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBhbiBvdXRlciBq\nb2luIHNldCwgZXZlbiBpZiBpdCdzIGVtcHR5CiAgICAgICAgUGF0aEpvaW5z\nIHBqID0gKChQYXRoSm9pbnMpIGpvaW5zKS5zZXRPdXRlcih0cnVlKTsKICAg\nICAgICBpZiAocGouaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gcGo7\nCgogICAgICAgIEpvaW4gam9pbjsKICAgICAgICBKb2luIHJlYzsKICAgICAg\nICBib29sZWFuIGhhc0pvaW5zID0gX2pvaW5zICE9IG51bGwgJiYgX2pvaW5z\nLmpvaW5zKCkgIT0gbnVsbDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIHBqLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICBpZiAoam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lOTkVSKSB7CiAg\nICAgICAgICAgICAgICBpZiAoIWhhc0pvaW5zKQogICAgICAgICAgICAgICAg\nICAgIGpvaW4uc2V0VHlwZShKb2luLlRZUEVfT1VURVIpOwogICAgICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVjID0gX2pvaW5z\nLmpvaW5zKCkuZ2V0UmVjb3JkZWRKb2luKGpvaW4pOwogICAgICAgICAgICAg\nICAgICAgIGlmIChyZWMgPT0gbnVsbCB8fCByZWMuZ2V0VHlwZSgpID09IEpv\naW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgICAgICAgICAgICAgam9pbi5z\nZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpvaW5zOwog\nICAgfQoKICAgIC8qKgogICAgICogTW92ZXMgdGhlIGpvaW5zIGZyb20gdGhl\nIGdpdmVuIGluc3RhbmNlIGludG8gb3VyIG91dGVyIGpvaW5zIHNldC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGNvbGxlY3RPdXRlckpvaW5zKFBhdGhK\nb2lucyBwaikgewogICAgICAgIGlmIChfam9pblN5bnRheCA9PSBKb2luU3lu\ndGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMIHx8IHBqID09IG51bGwKICAgICAg\nICAgICAgfHwgcGouaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2pvaW5z\nID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwoKICAgICAgICBib29sZWFuIGFk\nZCA9IHRydWU7CiAgICAgICAgaWYgKF9qb2lucy5qb2lucygpID09IG51bGwp\nIHsKICAgICAgICAgICAgX2pvaW5zLnNldEpvaW5zKHBqLmpvaW5zKCkpOwog\nICAgICAgICAgICBhZGQgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIEpv\naW4gam9pbjsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBqLmpvaW5z\nKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoam9p\nbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lOTkVSKSB7CiAgICAgICAgICAg\nICAgICBpZiAoam9pbi5nZXRGb3JlaWduS2V5KCkgIT0gbnVsbAogICAgICAg\nICAgICAgICAgICAgICYmICFfZGljdC5jYW5PdXRlckpvaW4oX2pvaW5TeW50\nYXgsIGpvaW4uZ2V0Rm9yZWlnbktleSgpKSkgewogICAgICAgICAgICAgICAg\nICAgIExvZyBsb2cgPSBfY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24u\nTE9HX0pEQkMpOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2Fybihf\nbG9jLmdldCgiY2FudC1vdXRlci1mayIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBqb2luLmdldEZvcmVpZ25LZXkoKSkpOwogICAgICAgICAgICAg\nICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgam9pbi5zZXRUeXBlKEpv\naW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGFkZCkKICAgICAgICAgICAgICAgIF9qb2lucy5qb2lucygpLmFkZChqb2lu\nKTsKICAgICAgICB9CiAgICAgICAgcGoubnVsbEpvaW5zKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIGZvciB0aGUgZ2l2ZW4g\ndGFibGUgdW5kZXIgdGhlIGdpdmVuIGpvaW5zLgogICAgICogTk9URTogV0Ug\nUkVMWSBPTiBUSEVTRSBJTkRFWEVTIEJFSU5HIE1PTk9UT05JQ0FMTFkgSU5D\nUkVBU0lORyBGUk9NIDAKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0VGFi\nbGVJbmRleChUYWJsZSB0YWJsZSwgUGF0aEpvaW5zIHBqLCBib29sZWFuIGNy\nZWF0ZSkgewogICAgICAgIC8vIGlmIHdlIGhhdmUgYSBmcm9tIHNlbGVjdCwg\ndGhlbiB0aGVyZSBhcmUgbm8gdGFibGUgYWxpYXNlcwogICAgICAgIGlmIChf\nZnJvbSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAg\nIEludGVnZXIgaSA9IG51bGw7CiAgICAgICAgT2JqZWN0IGtleSA9IHRhYmxl\nLmdldEZ1bGxJZGVudGlmaWVyKCkuZ2V0TmFtZSgpOwogICAgICAgIGlmIChw\naiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAgICAgICBr\nZXkgPSBuZXcgS2V5KHBqLnBhdGgoKS50b1N0cmluZygpLCBrZXkpOwoKICAg\nICAgICBpZiAoX2N0eCAhPSBudWxsICYmIChfcGFyZW50ICE9IG51bGwgfHwg\nX3N1YnNlbHMgIT0gbnVsbCB8fCBfaGFzU3ViKSkgewogICAgICAgICAgICBp\nID0gZmluZEFsaWFzRm9yUXVlcnkodGFibGUsIHBqLCBrZXksIGNyZWF0ZSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAoaSAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gaS5pbnRWYWx1ZSgpOwoKICAgICAgICAvLyBjaGVjayBvdXQg\nZXhpc3RpbmcgYWxpYXNlcwogICAgICAgIGkgPSBmaW5kQWxpYXModGFibGUs\nIGtleSk7CgogICAgICAgIGlmIChpICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBpLmludFZhbHVlKCk7CiAgICAgICAgaWYgKCFjcmVhdGUpCiAgICAg\nICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgLy8gbm90IGZvdW5kOyBjcmVh\ndGUgYWxpYXMKICAgICAgICBpID0gTnVtYmVycy52YWx1ZU9mKGFsaWFzU2l6\nZShudWxsKSk7Ci8vICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkdldFRh\nYmxlSW5kZXhcdCIrCi8vICAgICAgICAgICAgICAgICgoX3BhcmVudCAhPSBu\ndWxsKSA/ICJTdWIiIDoiIikgKwovLyAgICAgICAgICAgICAgICAiIGNyZWF0\nZWQgYWxpYXM6ICIrCi8vICAgICAgICAgICAgICAgIGkuaW50VmFsdWUoKSsg\nIiAiKyBrZXkpOwogICAgICAgIHJlY29yZFRhYmxlQWxpYXModGFibGUsIGtl\neSwgaSk7CiAgICAgICAgcmV0dXJuIGkuaW50VmFsdWUoKTsKICAgIH0KCiAg\nICBwcml2YXRlIEludGVnZXIgZmluZEFsaWFzRm9yUXVlcnkoVGFibGUgdGFi\nbGUsIFBhdGhKb2lucyBwaiwgT2JqZWN0IGtleSwKICAgICAgICBib29sZWFu\nIGNyZWF0ZSkgewogICAgICAgIEludGVnZXIgaSA9IG51bGw7CiAgICAgICAg\nU2VsZWN0SW1wbCBzZWwgPSB0aGlzOwogICAgICAgIFN0cmluZyBhbGlhcyA9\nIF9zY2hlbWFBbGlhczsKICAgICAgICBpZiAoaXNQYXRoSW5UaGlzQ29udGV4\ndChwaikgfHwgdGFibGUuaXNBc3NvY2lhdGlvbigpKSAgICAgICAgICAKICAg\nICAgICAgICAgYWxpYXMgPSBudWxsOwoKICAgICAgICAvLyBmaW5kIHRoZSBj\nb250ZXh0IHdoZXJlIHRoaXMgYWxpYXMgaXMgZGVmaW5lZAogICAgICAgIENv\nbnRleHQgY3R4ID0gKGFsaWFzICE9IG51bGwpID8KICAgICAgICAgICAgX2N0\neC5maW5kQ29udGV4dChhbGlhcykgOiBudWxsOwogICAgICAgIGlmIChjdHgg\nIT0gbnVsbCkKICAgICAgICAgICAgc2VsID0gKFNlbGVjdEltcGwpIGN0eC5n\nZXRTZWxlY3QoKTsKCiAgICAgICAgaWYgKCFjcmVhdGUpIAogICAgICAgICAg\nICBpID0gc2VsLmZpbmRBbGlhcyh0YWJsZSwga2V5KTsgIC8vIGZpbmQgaW4g\ncGFyZW50IGFuZCBpbiBteXNlbGYKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIGkgPSBzZWwuZ2V0QWxpYXModGFibGUsIGtleSk7IC8vIGZpbmQgaW4gbXlz\nZWxmCiAgICAgICAgaWYgKGkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGk7CiAgICAgICAgCiAgICAgICAgaWYgKGNyZWF0ZSkgeyAvLyBjcmVhdGUg\naGVyZQogICAgICAgICAgICBpID0gc2VsLmNyZWF0ZUFsaWFzKHRhYmxlLCBr\nZXkpOwogICAgICAgIH0gZWxzZSBpZiAoY3R4ICE9IG51bGwgJiYgY3R4ICE9\nIGN0eCgpKSB7IC8vIGNyZWF0ZSBpbiBvdGhlciBzZWxlY3QKICAgICAgICAg\nICAgaSA9ICgoU2VsZWN0SW1wbCljdHguZ2V0U2VsZWN0KCkpLmNyZWF0ZUFs\naWFzKHRhYmxlLCBrZXkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGk7\nCiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzUGF0aEluVGhpc0NvbnRl\neHQoUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8gY3VyckN0eCBpcyBzZXQg\nZnJvbSBBY3Rpb24sIGl0IGlzIHJlc2V0IHRvIG51bGwgYWZ0ZXIgdGhlIFBD\nUGF0aCBpbml0aWFsaXphdGlvbgogICAgICAgIENvbnRleHQgY3VyckN0eCA9\nIHBqID09IG51bGwgPyBudWxsIDogKChQYXRoSm9pbnNJbXBsKXBqKS5jb250\nZXh0OwogICAgICAgIAogICAgICAgIC8vIGxhc3RDdHggaXMgc2V0IHRvIGN1\ncnJDdHggYWZ0ZXIgdGhlIFNlbGVjdEpvaW5zLmpvaW4uIHBqLmxhc3RDdHgg\nYW5kIHBqLnBhdGggc3RyaW5nIGFyZSAKICAgICAgICAvLyB0aGUgbGFzdCBz\nbmFwc2hvdCBvZiBwai4gVGhleSB3aWxsIGJlIHVzZWQgdG9nZXRoZXIgZm9y\nIGxhdGVyIHRhYmxlIGFsaWFzIHJlc29sdXRpb24gaW4KICAgICAgICAvLyB0\naGUgZ2V0Q29sdW1uQWxpYXMoKS4gCiAgICAgICAgQ29udGV4dCBsYXN0Q3R4\nID0gcGogPT0gbnVsbCA/IG51bGwgOiAoKFBhdGhKb2luc0ltcGwpcGopLmxh\nc3RDb250ZXh0OwogICAgICAgIENvbnRleHQgdGhpc0N0eCA9IGN1cnJDdHgg\nPT0gbnVsbCA/IGxhc3RDdHggOiBjdXJyQ3R4OwogICAgICAgIFN0cmluZyBj\nb3JyVmFyID0gcGogPT0gbnVsbCA/IG51bGwgOiBwai5nZXRDb3JyZWxhdGVk\nVmFyaWFibGUoKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKHBqICE9IG51\nbGwgJiYgcGoucGF0aCgpICE9IG51bGwgJiYgCiAgICAgICAgICAgIChjb3Jy\nVmFyID09IG51bGwgfHwgKHRoaXNDdHggIT0gbnVsbCAmJiBjdHgoKSA9PSB0\naGlzQ3R4KSkpOwogICAgfQogCiAgICBwcml2YXRlIEludGVnZXIgZ2V0QWxp\nYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXkpIHsKICAgICAgICBJbnRlZ2Vy\nIGFsaWFzID0gbnVsbDsKICAgICAgICBpZiAoX2FsaWFzZXMgIT0gbnVsbCkK\nICAgICAgICAgICAgYWxpYXMgPSAoSW50ZWdlcikgX2FsaWFzZXMuZ2V0KGtl\neSk7CiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgfQoKICAgIHByaXZhdGUg\naW50IGNyZWF0ZUFsaWFzKFRhYmxlIHRhYmxlLCBPYmplY3Qga2V5KSB7CiAg\nICAgICAgSW50ZWdlciBpID0gTnVtYmVycy52YWx1ZU9mKGN0eCgpLm5leHRB\nbGlhcygpKTsKLy8gICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiXHQiKwov\nLyAgICAgICAgICAgICAgICAoKF9wYXJlbnQgIT0gbnVsbCkgPyAiU3ViIiA6\nIiIpICsKLy8gICAgICAgICAgICAgICAgIlF1ZXJ5IGNyZWF0ZWQgYWxpYXM6\nICIrIAovLyAgICAgICAgICAgICAgICBpLmludFZhbHVlKCkrICIgIisga2V5\nKTsKICAgICAgICByZWNvcmRUYWJsZUFsaWFzKHRhYmxlLCBrZXksIGkpOwog\nICAgICAgIHJldHVybiBpLmludFZhbHVlKCk7CiAgICB9CgogICAgcHJpdmF0\nZSBJbnRlZ2VyIGZpbmRBbGlhcyhUYWJsZSB0YWJsZSwgT2JqZWN0IGtleSkg\newogICAgICAgIEludGVnZXIgYWxpYXMgPSBudWxsOwogICAgICAgIGlmIChf\nYWxpYXNlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGFsaWFzID0gKEludGVn\nZXIpIF9hbGlhc2VzLmdldChrZXkpOwogICAgICAgICAgICBpZiAoYWxpYXMg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChfcGFyZW50ICE9IG51\nbGwpIHsKICAgICAgICAgICAgYWxpYXMgPSBfcGFyZW50LmZpbmRBbGlhcyh0\nYWJsZSwga2V5KTsKICAgICAgICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBhbGlhczsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gYWxpYXM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWNvcmQgdGhlIG1hcHBpbmcgb2YgdGhlIGdpdmVuIGtleSB0\nbyB0aGUgZ2l2ZW4gYWxpYXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBy\nZWNvcmRUYWJsZUFsaWFzKFRhYmxlIHRhYmxlLCBPYmplY3Qga2V5LCBJbnRl\nZ2VyIGFsaWFzKSB7CiAgICAgICAgaWYgKF9hbGlhc2VzID09IG51bGwpCiAg\nICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBf\nYWxpYXNlcy5wdXQoa2V5LCBhbGlhcyk7CgogICAgICAgIFN0cmluZyB0YWJs\nZVN0cmluZyA9IF9kaWN0LmdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSkgKyAi\nICIKICAgICAgICAgICAgKyB0b0FsaWFzKGFsaWFzLmludFZhbHVlKCkpOwog\nICAgICAgIGlmIChfdGFibGVzID09IG51bGwpCiAgICAgICAgICAgIF90YWJs\nZXMgPSBuZXcgVHJlZU1hcCgpOwogICAgICAgIF90YWJsZXMucHV0KGFsaWFz\nLCB0YWJsZVN0cmluZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxh\ndGUgdG90YWwgbnVtYmVyIG9mIGFsaWFzZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgaW50IGFsaWFzU2l6ZShTZWxlY3RJbXBsIGZyb21TdWIpIHsKICAgICAg\nICBpbnQgYWxpYXNlcyA9IChfcGFyZW50ID09IG51bGwpID8gMAogICAgICAg\nICAgICA6IF9wYXJlbnQuYWxpYXNTaXplKHRoaXMpOwogICAgICAgIGFsaWFz\nZXMgKz0gKF9hbGlhc2VzID09IG51bGwpID8gMCA6IF9hbGlhc2VzLnNpemUo\nKTsKICAgICAgICBpZiAoX3N1YnNlbHMgIT0gbnVsbCkgewogICAgICAgICAg\nICBTZWxlY3RJbXBsIHN1YjsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfc3Vic2Vscy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAg\nc3ViID0gKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChpKTsKICAgICAgICAg\nICAgICAgIGlmIChzdWIgIT0gZnJvbVN1YikKICAgICAgICAgICAgICAgICAg\nICBhbGlhc2VzICs9IHN1Yi5hbGlhc1NpemUobnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsaWFzZXM7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIHRvU2VsZWN0KGZhbHNlLCBudWxsKS5nZXRTUUwoKTsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQYXRoSm9p\nbnMgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgUGF0aEpvaW5zIHNl\ndE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICByZXR1cm4gbmV3IFNl\nbGVjdEpvaW5zKHRoaXMpLnNldE91dGVyKHRydWUpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdCdWlsZGVyIHBhdGgoKSB7CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIEpvaW5TZXQg\nam9pbnMoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVi\nbGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2Nh\nbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICByZXR1cm4g\nbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmNyb3NzSm9pbihsb2NhbFRhYmxlLCBm\nb3JlaWduVGFibGUpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luKEZv\ncmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkp\nIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmpvaW4o\nZmssIGludmVyc2UsIHRvTWFueSk7CiAgICB9CgogICAgcHVibGljIEpvaW5z\nIG91dGVySm9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJv\nb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lu\ncyh0aGlzKS5vdXRlckpvaW4oZmssIGludmVyc2UsIHRvTWFueSk7CiAgICB9\nCgogICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwg\nRm9yZWlnbktleSBmaywgQ2xhc3NNYXBwaW5nIHRhcmdldCwKICAgICAgICBp\nbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewog\nICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuam9pblJlbGF0\naW9uKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIAogICAgICAgICAgICBpbnZl\ncnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBvdXRlckpv\naW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52\nZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICByZXR1cm4gbmV3IFNl\nbGVjdEpvaW5zKHRoaXMpLm91dGVySm9pblJlbGF0aW9uKG5hbWUsIGZrLCB0\nYXJnZXQsIHN1YnMsIAogICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBzZXRWYXJpYWJsZShTdHJpbmcgdmFy\nKSB7CiAgICAgICAgaWYgKHZhciA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nLnNldFZhcmlhYmxlKHZhcik7CiAgICB9CgogICAgcHVibGljIEpvaW5zIHNl\ndFN1YnNlbGVjdChTdHJpbmcgYWxpYXMpIHsKICAgICAgICBpZiAoYWxpYXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0\ndXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5zZXRTdWJzZWxlY3QoYWxpYXMp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIFNRTCBzdHJp\nbmcgc2VsZWN0ZWQgd2l0aCBudWxsIGlkLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBOdWxsSWQgewogICAgfQoKICAgIC8qKgogICAgICog\nUmVwcmVzZW50cyBhIHBsYWNlaG9sZGVyIFNRTCBzdHJpbmcuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFBsYWNlaG9sZGVyIHsKICAgIH0K\nICAgIAogICAgcHVibGljIFNlbGVjdEltcGwgY2xvbmUoQ29udGV4dCBjdHgp\nIHsKICAgICAgICBTZWxlY3RJbXBsIHNlbCA9IChTZWxlY3RJbXBsKSBfY29u\nZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdTZWxlY3QoKTsKICAgICAg\nICBzZWwuX2N0eCA9IGN0eDsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxs\nICYmIF9wYXJlbnQuY3R4KCkgIT0gbnVsbCkKICAgICAgICAgICAgc2VsLl9w\nYXJlbnQgPSAoU2VsZWN0SW1wbClfcGFyZW50LmN0eCgpLmdldFNlbGVjdCgp\nOwogICAgICAgIHNlbC5fc2NoZW1hQWxpYXMgPSBfc2NoZW1hQWxpYXM7CiAg\nICAgICAgc2VsLl9mbGFncyA9IF9mbGFnczsKICAgICAgICByZXR1cm4gc2Vs\nOwogICAgfQoKICAgIC8qKgogICAgICogS2V5IHR5cGUgdXNlZCBmb3IgYWxp\nYXNlcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgS2V5IHsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX3BhdGg7CiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBPYmplY3QgX2tleTsKCiAgICAgICAgcHVibGljIEtl\neShTdHJpbmcgcGF0aCwgT2JqZWN0IGtleSkgewogICAgICAgICAgICBfcGF0\naCA9IHBhdGg7CiAgICAgICAgICAgIF9rZXkgPSBrZXk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBy\nZXR1cm4gX3BhdGguaGFzaENvZGUoKSBeIF9rZXkuaGFzaENvZGUoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qg\nb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKG90aGVy\nLmdldENsYXNzKCkgIT0gZ2V0Q2xhc3MoKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgS2V5IGsgPSAoS2V5KSBvdGhlcjsK\nICAgICAgICAgICAgcmV0dXJuIGsuX3BhdGguZXF1YWxzKF9wYXRoKSAmJiBr\nLl9rZXkuZXF1YWxzKF9rZXkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIF9wYXRo\nICsgInwiICsgX2tleTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgT2Jq\nZWN0IGdldEtleSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9rZXk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQSB7QGxpbmsgUmVzdWx0fSBp\nbXBsZW1lbnRhdGlvbiB3cmFwcGVkIGFyb3VuZCB0aGlzIHNlbGVjdC4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBTZWxlY3RSZXN1bHQKICAg\nICAgICBleHRlbmRzIFJlc3VsdFNldFJlc3VsdAogICAgICAgIGltcGxlbWVu\ndHMgUGF0aEpvaW5zIHsKCiAgICAgICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9z\nZWwgPSBudWxsOwoKICAgICAgICAvLyBwb3NpdGlvbiBpbiBzZWxlY3RlZCBj\nb2x1bW5zIGxpc3Qgd2hlcmUgd2UgZXhwZWN0IHRoZSBuZXh0IGxvYWQKICAg\nICAgICBwcml2YXRlIGludCBfcG9zID0gMDsKICAgICAgICBwcml2YXRlIFN0\nYWNrIF9wcmVKb2lucyA9IG51bGw7CgogICAgICAgIC8qKgogICAgICAgICAq\nIENvbnN0cnVjdG9yLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBTZWxl\nY3RSZXN1bHQoQ29ubmVjdGlvbiBjb25uLCBTdGF0ZW1lbnQgc3RtbnQsIFJl\nc3VsdFNldCBycywKICAgICAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QpIHsK\nICAgICAgICAgICAgc3VwZXIoY29ubiwgc3RtbnQsIHJzLCBkaWN0KTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdCBmb3IgdGhp\ncyByZXN1bHQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIFNlbGVjdElt\ncGwgZ2V0U2VsZWN0KCkgewogICAgICAgICAgICByZXR1cm4gX3NlbDsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdCBmb3IgdGhp\ncyByZXN1bHQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0\nU2VsZWN0KFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAgICAgIF9zZWwgPSBz\nZWw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldEVhZ2Vy\nKEZpZWxkTWFwcGluZyBrZXkpIHsKICAgICAgICAgICAgLy8gZG9uJ3QgYm90\naGVyIGNyZWF0aW5nIGtleSBpZiB3ZSBrbm93IHdlIGRvbid0IGhhdmUgYW55\nCiAgICAgICAgICAgIC8vIGVhZ2VyIHJlc3VsdHMKICAgICAgICAgICAgaWYg\nKF9zZWwuX2VhZ2VyID09IG51bGwgfHwgIV9zZWwuX2VhZ2VyS2V5cy5jb250\nYWlucyhrZXkpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgICAgIE1hcCBtYXAgPSBTZWxlY3RSZXN1bHQudGhpcy5nZXRFYWdlck1h\ncCh0cnVlKTsKICAgICAgICAgICAgaWYgKG1hcCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBtYXAu\nZ2V0KF9zZWwudG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwpKSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBwdXRFYWdlcihGaWVsZE1h\ncHBpbmcga2V5LCBPYmplY3QgcmVzKSB7CiAgICAgICAgICAgIE1hcCBtYXAg\nPSBTZWxlY3RSZXN1bHQudGhpcy5nZXRFYWdlck1hcCh0cnVlKTsKICAgICAg\nICAgICAgaWYgKG1hcCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBtYXAg\nPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAgICAgc2V0RWFnZXJNYXAo\nbWFwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXAucHV0KF9zZWwu\ndG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwpKSwgcmVzKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgbG9hZChDbGFzc01hcHBpbmcg\nbWFwcGluZywgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgICAgICBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBKb2lucyBqb2lucykKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJvb2xlYW4g\naGFzSm9pbnMgPSBqb2lucyAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiAo\nKFBhdGhKb2lucykgam9pbnMpLnBhdGgoKSAhPSBudWxsOwogICAgICAgICAg\nICBpZiAoaGFzSm9pbnMpIHsKICAgICAgICAgICAgICAgIGlmIChfcHJlSm9p\nbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfcHJlSm9pbnMgPSBu\nZXcgU3RhY2soKTsKICAgICAgICAgICAgICAgIF9wcmVKb2lucy5wdXNoKGpv\naW5zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgT2JqZWN0IG9iaiA9\nIHN1cGVyLmxvYWQobWFwcGluZywgc3RvcmUsIGZldGNoLCBqb2lucyk7Cgog\nICAgICAgICAgICAvLyByZXNldAogICAgICAgICAgICBpZiAoaGFzSm9pbnMp\nCiAgICAgICAgICAgICAgICBfcHJlSm9pbnMucG9wKCk7CiAgICAgICAgICAg\nIHJldHVybiBvYmo7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMg\nbmV3Sm9pbnMoKSB7CiAgICAgICAgICAgIFBhdGhKb2lucyBwcmUgPSBnZXRQ\ncmVKb2lucygpOwogICAgICAgICAgICBpZiAocHJlID09IG51bGwgfHwgcHJl\nLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCgogICAgICAgICAgICBQYXRoSm9pbnNJbXBsIHBqID0gbmV3IFBhdGhKb2lu\nc0ltcGwoKTsKICAgICAgICAgICAgcGoucGF0aCA9IG5ldyBTdHJpbmdCdWls\nZGVyKHByZS5wYXRoKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIHJldHVy\nbiBwajsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBib29sZWFuIGNv\nbnRhaW5zSW50ZXJuYWwoT2JqZWN0IG9iaiwgSm9pbnMgam9pbnMpIHsKICAg\nICAgICAgICAgLy8gd2Uga2V5IGRpcmVjdGx5IG9uIG9ianMgYW5kIGpvaW4t\nbGVzcyBjb2xzLCBvciBvbiB0aGUgYWxpYXMKICAgICAgICAgICAgLy8gZm9y\nIGNvbHMgd2l0aCBqb2lucwogICAgICAgICAgICBQYXRoSm9pbnMgcGogPSBn\nZXRKb2lucyhqb2lucyk7CiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYm\nIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgb2JqID0gZ2V0\nQ29sdW1uQWxpYXMoKENvbHVtbikgb2JqLCBwaik7CiAgICAgICAgICAgIHJl\ndHVybiBvYmogIT0gbnVsbCAmJiBfc2VsLl9zZWxlY3RzLmNvbnRhaW5zKG9i\naik7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjb250\nYWluc0FsbEludGVybmFsKE9iamVjdFtdIG9ianMsIEpvaW5zIGpvaW5zKQog\nICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBP\nYmplY3Qgb2JqOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9i\nanMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwaiAhPSBu\ndWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIG9iaiA9IGdldENvbHVtbkFsaWFzKChDb2x1bW4pIG9ianNbaV0sIHBqKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBvYmog\nPSBvYmpzW2ldOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsIHx8\nICFfc2VsLl9zZWxlY3RzLmNvbnRhaW5zKG9iaikpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\ncHVzaEJhY2soKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAgIHN1cGVyLnB1c2hC\nYWNrKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBh\nYnNvbHV0ZUludGVybmFsKGludCByb3cpCiAgICAgICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBfcG9zID0gMDsKICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLmFic29sdXRlSW50ZXJuYWwocm93KTsKICAgICAg\nICB9CgogICAgICAgIHByb3RlY3RlZCBib29sZWFuIG5leHRJbnRlcm5hbCgp\nCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICBfcG9zID0gMDsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm5leHRJbnRl\ncm5hbCgpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGludCBmaW5k\nT2JqZWN0KE9iamVjdCBvYmosIEpvaW5zIGpvaW5zKQogICAgICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF9wb3MgPT0g\nX3NlbC5fc2VsZWN0cy5zaXplKCkpCiAgICAgICAgICAgICAgICBfcG9zID0g\nMDsKCiAgICAgICAgICAgIC8vIHdlIGtleSBkaXJlY3RseSBvbiBvYmpzIGFu\nZCBqb2luLWxlc3MgY29scywgb3Igb24gdGhlIGFsaWFzCiAgICAgICAgICAg\nIC8vIGZvciBjb2xzIHdpdGggam9pbnMKICAgICAgICAgICAgUGF0aEpvaW5z\nIHBqID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBCb29sZWFuIHBr\nID0gbnVsbDsKICAgICAgICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGoucGF0\naCgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENvbHVtbiBjb2wgPSAo\nQ29sdW1uKSBvYmo7CiAgICAgICAgICAgICAgICBwayA9IChjb2wuaXNQcmlt\nYXJ5S2V5KCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAg\nICAgICAgICAgICAgIG9iaiA9IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwog\nICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24oY29sLmdldFRhYmxlKCkg\nKyAiOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgcGoucGF0aCgpICsg\nIiAoIiArIF9zZWwuX2FsaWFzZXMgKyAiKSIpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyB3ZSBsb2FkIGluIHRoZSBzYW1lIG9yZGVyIHdlIHNl\nbGVjdCwgbW9yZSBvciBsZXNzLi4uCiAgICAgICAgICAgIGlmIChfc2VsLl9z\nZWxlY3RzLmdldChfcG9zKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAg\nIHJldHVybiArK19wb3M7CgogICAgICAgICAgICAvLyBpZiB3ZSdyZSBsb29r\naW5nIGZvciBhIHByaW1hcnkga2V5LCB0cnkgYmFjayBhIGNvdXBsZSBwbGFj\nZXMsCiAgICAgICAgICAgIC8vIHNpbmNlIHBrcyBtaWdodCBiZSBzZWxlY3Rl\nZCBpbiBhIHNsaWdodGx5IGRpZmZlcmVudCBvcmRlciB0aGFuCiAgICAgICAg\nICAgIC8vIHRoZXkgYXJlIGxvYWRlZCBiYWNrOyBkb24ndCBjaGFuZ2UgdGhl\nIG1hcmtlciBwb3NpdGlvbgogICAgICAgICAgICBpZiAocGsgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHBrID0gKG9iaiBpbnN0YW5jZW9mIENvbHVtbiAm\nJiAoKENvbHVtbikgb2JqKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAg\nICAgICAgICA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgICAgIGlmIChway5ib29sZWFuVmFsdWUoKSkgewogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IF9wb3MgLSAxOyBpID49IDAgJiYgaSA+PSBfcG9z\nIC0gMzsgaS0tKQogICAgICAgICAgICAgICAgICAgIGlmIChfc2VsLl9zZWxl\nY3RzLmdldChpKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGkgKyAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBzZWFyY2ggZm9yd2FyZCBvbiB0aGUgYXNzdW1wdGlvbiB0aGF0IHdlIG1p\nZ2h0IGJlIHNraXBwaW5nCiAgICAgICAgICAgIC8vIHNlbGVjdHMgZm9yIHNp\nYmxpbmcgY2xhc3NlczsgYWR2YW5jZSB0aGUgcG9zaXRpb24gaWYgd2UgZmlu\nZAogICAgICAgICAgICAvLyBzb21ldGhpbmcgZm9yd2FyZAogICAgICAgICAg\nICBmb3IgKGludCBpID0gX3BvcyArIDE7IGkgPCBfc2VsLl9zZWxlY3RzLnNp\nemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0\ncy5nZXQoaSkuZXF1YWxzKG9iaikpIHsKICAgICAgICAgICAgICAgICAgICBf\ncG9zID0gaTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKytfcG9zOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBtYXliZSB0aGUgY29sdW1uIHdhcyBzZWxlY3RlZCBieSAyIGRpZmZlcmVu\ndCBtYXBwaW5ncywgc28gaXQncwogICAgICAgICAgICAvLyBzb21ld2hlcmUg\ncHJpb3IgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb247IGluIHRoaXMgY2FzZSBs\nZWF2ZSB0aGUKICAgICAgICAgICAgLy8gcG9zaXRpb24gbWFya2VyIGF0IGl0\ncyBjdXJyZW50IHBsYWNlIGNhdXNlIHN1YnNlcXVlbnQgbG9hZHMgd2lsbAog\nICAgICAgICAgICAvLyBzdGlsbCBwcm9iYWJseSBzdGFydCBmcm9tIHRoZXJl\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3BvczsgaSsrKQog\nICAgICAgICAgICAgICAgaWYgKF9zZWwuX3NlbGVjdHMuZ2V0KGkpLmVxdWFs\ncyhvYmopKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMTsKCiAg\nICAgICAgICAgIC8vIHNvbWV0aGluZ3MncyB3cm9uZy4uLgogICAgICAgICAg\nICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKG9iai50b1N0cmluZygpKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgam9p\nbnMgdG8gdXNlIHRvIGZpbmQgY29sdW1uIGRhdGEuCiAgICAgICAgICovCiAg\nICAgICAgcHJpdmF0ZSBQYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMp\nIHsKICAgICAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9p\nbnM7CiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHBqOwogICAgICAgICAg\nICByZXR1cm4gZ2V0UHJlSm9pbnMoKTsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIFJldHVybiB0aGUgcHJlIGpvaW5zIGZvciB0aGUgcmVz\ndWx0LCBvciBudWxsIGlmIG5vbmUuIE5vdGUgdGhhdAogICAgICAgICAqIHdl\nIGhhdmUgdG8gdGFrZSB0aGUgU2VsZWN0J3MgcHJlIGpvaW5zIGludG8gYWNj\nb3VudCB0b28sIHNpbmNlCiAgICAgICAgICogYmF0Y2hlZCBzZWxlY3RzIGNh\nbiBoYXZlIGFkZGl0aW9uYWwgcHJlIGpvaW5zIG9uIHRoZSBzdGFjayBldmVu\nCiAgICAgICAgICogb24gZXhlY3V0aW9uLgogICAgICAgICAqLwogICAgICAg\nIHByaXZhdGUgUGF0aEpvaW5zIGdldFByZUpvaW5zKCkgewogICAgICAgICAg\nICBpZiAoX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gKFBhdGhKb2lucykgX3ByZUpv\naW5zLnBlZWsoKTsKICAgICAgICAgICAgaWYgKF9zZWwuX3ByZUpvaW5zICE9\nIG51bGwgJiYgIV9zZWwuX3ByZUpvaW5zLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgIHJldHVybiAoUGF0aEpvaW5zKSBfc2VsLl9wcmVKb2lucy5wZWVr\nKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBhbGlhcyB1c2VkIHRvIGtl\neSBvbiB0aGUgY29sdW1uIGRhdGEsIGNvbnNpZGVyaW5nIHRoZQogICAgICAg\nICAqIGdpdmVuIGpvaW5zLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUg\nU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIFBhdGhKb2lucyBw\naikgewogICAgICAgICAgICBTdHJpbmcgYWxpYXM7CiAgICAgICAgICAgIGlm\nIChfc2VsLl9mcm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGFsaWFz\nID0gX3NlbC50b0FsaWFzKF9zZWwuX2Zyb20uZ2V0VGFibGVJbmRleAogICAg\nICAgICAgICAgICAgICAgIChjb2wuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSk7\nCiAgICAgICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChf\nc2VsLl9kaWN0LnJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIEZST01fU0VMRUNUX0FMSUFTICsgIi4iICsg\nYWxpYXMgKyAiXyIgKyBjb2w7CiAgICAgICAgICAgICAgICByZXR1cm4gYWxp\nYXMgKyAiXyIgKyBjb2w7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxp\nYXMgPSBfc2VsLnRvQWxpYXMoX3NlbC5nZXRUYWJsZUluZGV4KGNvbC5nZXRU\nYWJsZSgpLCBwaiwgZmFsc2UpKTsKICAgICAgICAgICAgcmV0dXJuIChhbGlh\ncyA9PSBudWxsKSA/IG51bGwgOiBhbGlhcyArICIuIiArIGNvbDsKICAgICAg\nICB9CgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nICAgICAvLyBQYXRoSm9pbnMgaW1wbGVtZW50YXRpb24KICAgICAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9v\nbGVhbiBvdXRlcikgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBTdHJpbmdCdWlsZGVyIHBhdGgoKSB7CiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5TZXQgam9pbnMo\nKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVy\nbiAwOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgbnVsbEpvaW5z\nKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0\neSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2FsVGFibGUs\nIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luKEZvcmVp\nZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4g\naW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pblJl\nbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCAKICAgICAgICAg\nICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52\nZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBQYXRoSm9pbnNJbXBsKCkuam9pblJlbGF0aW9uKG5hbWUsIGZrLCB0YXJn\nZXQsIHN1YnMsIAogICAgICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW5SZWxh\ndGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywKICAgICAgICAgICAg\nQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJz\nZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQ\nYXRoSm9pbnNJbXBsKCkub3V0ZXJKb2luUmVsYXRpb24obmFtZSwgZmssIHRh\ncmdldCwgc3VicywKICAgICAgICAgICAgICAgIGludmVyc2UsIHRvTWFueSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0VmFyaWFibGUo\nU3RyaW5nIHZhcikgewogICAgICAgICAgICBpZiAodmFyID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBQYXRoSm9pbnNJbXBsKCkuc2V0VmFyaWFibGUodmFyKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRTdWJzZWxlY3QoU3RyaW5n\nIGFsaWFzKSB7CiAgICAgICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgUGF0aEpvaW5zSW1wbCgpLnNldFN1YnNlbGVjdChhbGlhcyk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0Q29ycmVsYXRlZFZhcmlh\nYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0Sm9pbkNvbnRleHQo\nQ29udGV4dCBjdHgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldENvcnJlbGF0ZWRWYXJp\nYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBtb3ZlSm9pbnNUb1BhcmVudCgpIHsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBCYXNlIGpvaW5zIGltcGxl\nbWVudGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQ\nYXRoSm9pbnNJbXBsCiAgICAgICAgaW1wbGVtZW50cyBQYXRoSm9pbnMgewoK\nICAgICAgICBwcm90ZWN0ZWQgU3RyaW5nQnVpbGRlciBwYXRoID0gbnVsbDsK\nICAgICAgICBwcm90ZWN0ZWQgU3RyaW5nIHZhciA9IG51bGw7CiAgICAgICAg\ncHJvdGVjdGVkIFN0cmluZyBjb3JyZWxhdGVkVmFyID0gbnVsbDsKICAgICAg\nICBwcm90ZWN0ZWQgQ29udGV4dCBjb250ZXh0ID0gbnVsbDsKICAgICAgICBw\ncm90ZWN0ZWQgQ29udGV4dCBsYXN0Q29udGV4dCA9IG51bGw7CgogICAgICAg\nIHB1YmxpYyBTZWxlY3QgZ2V0U2VsZWN0KCkgewogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nT3V0ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBv\ndXRlcikgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgICAg\nIHJldHVybiB2YXIgIT0gbnVsbCB8fCBwYXRoICE9IG51bGw7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgU3RyaW5nQnVpbGRlciBwYXRoKCkgewogICAg\nICAgICAgICByZXR1cm4gcGF0aDsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBKb2luU2V0IGpvaW5zKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewog\nICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIG51bGxKb2lucygpIHsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBKb2lucyBzZXRWYXJpYWJsZShTdHJpbmcgdmFyKSB7CiAgICAgICAgICAg\nIHRoaXMudmFyID0gdmFyOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFyaWFibGUoKSB7\nCiAgICAgICAgICAgIHJldHVybiB2YXI7CiAgICAgICAgfQogICAgICAgIAog\nICAgICAgIHB1YmxpYyBKb2lucyBzZXRDb3JyZWxhdGVkVmFyaWFibGUoU3Ry\naW5nIHZhcikgewogICAgICAgICAgICB0aGlzLmNvcnJlbGF0ZWRWYXIgPSB2\nYXI7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldENvcnJlbGF0ZWRWYXJpYWJs\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGNvcnJlbGF0ZWRWYXI7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0Sm9pbkNvbnRleHQoQ29u\ndGV4dCBjb250ZXh0KSB7CiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGNv\nbnRleHQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBKb2lucyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFz\nKSB7CiAgICAgICAgICAgIGFwcGVuZChhbGlhcyk7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2Fs\nVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAgICBhcHBl\nbmQodmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMg\nam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4g\ndG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAg\nICB2YXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW4oRm9yZWlnbktl\neSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAg\nICAgICAgICBhcHBlbmQodmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsK\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWdu\nS2V5IGZrLCAKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50\nIHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAg\nICAgICAgICAgYXBwZW5kKG5hbWUpOwogICAgICAgICAgICBhcHBlbmQodmFy\nKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJK\nb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAgICAg\nICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFu\nIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVu\nZChuYW1lKTsKICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAg\nIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kKFN0cmluZyBzdHIp\nIHsKICAgICAgICAgICAgaWYgKHN0ciAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBpZiAocGF0aCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHBh\ndGggPSBuZXcgU3RyaW5nQnVpbGRlcihzdHIpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIHBhdGguYXBwZW5kKCcuJykuYXBw\nZW5kKHN0cik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiAi\nUGF0aEpvaW5zSW1wbDwiICsgaGFzaENvZGUoKSArICI+OiAiCiAgICAgICAg\nICAgICAgICArIFN0cmluZy52YWx1ZU9mKHBhdGgpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgbW92ZUpvaW5zVG9QYXJlbnQoKSB7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogSm9pbnMgaW1wbGVtZW50YXRp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFNlbGVjdEpv\naW5zCiAgICAgICAgZXh0ZW5kcyBQYXRoSm9pbnNJbXBsIAogICAgICAgIGlt\ncGxlbWVudHMgQ2xvbmVhYmxlIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBT\nZWxlY3RJbXBsIF9zZWw7CiAgICAgICAgcHJpdmF0ZSBKb2luU2V0IF9qb2lu\ncyA9IG51bGw7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9vdXRlciA9IGZh\nbHNlOwogICAgICAgIHByaXZhdGUgaW50IF9jb3VudCA9IDA7CgogICAgICAg\nIHB1YmxpYyBTZWxlY3RKb2lucyhTZWxlY3RJbXBsIHNlbCkgewogICAgICAg\nICAgICBfc2VsID0gc2VsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFNl\nbGVjdCBnZXRTZWxlY3QoKSB7CiAgICAgICAgICAgIHJldHVybiBfc2VsOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9vdXRlcjsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcikgewog\nICAgICAgICAgICBfb3V0ZXIgPSBvdXRlcjsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Rp\ncnR5KCkgewogICAgICAgICAgICByZXR1cm4gc3VwZXIuaXNEaXJ0eSgpIHx8\nICFpc0VtcHR5KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pblNl\ndCBqb2lucygpIHsKICAgICAgICAgICAgcmV0dXJuIF9qb2luczsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldEpvaW5zKEpvaW5TZXQgam9p\nbnMpIHsKICAgICAgICAgICAgX2pvaW5zID0gam9pbnM7CiAgICAgICAgICAg\nIF9vdXRlciA9IGpvaW5zICE9IG51bGwgJiYgam9pbnMubGFzdCgpICE9IG51\nbGwKICAgICAgICAgICAgICAgICYmIGpvaW5zLmxhc3QoKS5nZXRUeXBlKCkg\nPT0gSm9pbi5UWVBFX09VVEVSOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgICAgIGlmIChfam9pbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBfY291bnQ7CiAgICAgICAg\nICAgIHJldHVybiBNYXRoLm1heChfY291bnQsIF9qb2lucy5zaXplKCkpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewog\nICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfY291bnQgPSBNYXRoLm1heChfY291bnQsIF9qb2lucy5zaXplKCkpOwog\nICAgICAgICAgICBfam9pbnMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9qb2lucyA9PSBudWxsIHx8IF9qb2lucy5pc0VtcHR5KCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2Fs\nVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAgICAvLyBj\ncm9zcyBqb2lucyBhcmUgZm9yIHVuYm91bmQgdmFyaWFibGVzOyB1bmZvcnR1\nbmF0ZWx5IHdlIGhhdmUKICAgICAgICAgICAgLy8gdG8gYWx3YXlzIGdvIERJ\nU1RJTkNUIGZvciB1bmJvdW5kIHZhcnMgYmVjYXVzZSB0aGVyZSBhcmUgY2Vy\ndGFpbgogICAgICAgICAgICAvLyBjYXNlcyB0aGF0IHJlcXVpcmUgaXQsIGFu\nZCB3ZSBjYW4ndCBkaWZmZXJlbnRpYXRlIHRoZW0gZnJvbSB0aGUKICAgICAg\nICAgICAgLy8gY2FzZXMgdGhhdCBkb24ndAogICAgICAgICAgICBfc2VsLl9m\nbGFncyB8PSBJTVBMSUNJVF9ESVNUSU5DVDsKCiAgICAgICAgICAgIGlmIChf\nc2VsLmdldEpvaW5TeW50YXgoKSAhPSBKb2luU3ludGF4ZXMuU1lOVEFYX1NR\nTDkyCiAgICAgICAgICAgICAgICB8fCBfc2VsLl9mcm9tICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIC8vIGRvbid0IG1ha2UgYW55IGpvaW5zLCBidXQg\ndXBkYXRlIHRoZSBwYXRoIGlmIGEgdmFyaWFibGUKICAgICAgICAgICAgICAg\nIC8vIGhhcyBiZWVuIHNldAogICAgICAgICAgICAgICAgdGhpcy5hcHBlbmQo\ndGhpcy52YXIpOwogICAgICAgICAgICAgICAgdGhpcy52YXIgPSBudWxsOwog\nICAgICAgICAgICAgICAgX291dGVyID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nZG9uJ3QgbGV0IHRoZSBnZXQgYWxpYXMgbWV0aG9kcyBzZWUgdGhhdCBhIHZh\nciBoYXMgYmVlbiBzZXQKICAgICAgICAgICAgLy8gdW50aWwgd2UgZ2V0IHBh\nc3QgdGhlIGxvY2FsIHRhYmxlCiAgICAgICAgICAgIFN0cmluZyB2YXIgPSB0\naGlzLnZhcjsKICAgICAgICAgICAgdGhpcy52YXIgPSBudWxsOwogICAgICAg\nICAgICBDb250ZXh0IGN0eCA9IGNvbnRleHQ7IAogICAgICAgICAgICBjb250\nZXh0ID0gbnVsbDsgCgogICAgICAgICAgICBpbnQgYWxpYXMxID0gX3NlbC5n\nZXRUYWJsZUluZGV4KGxvY2FsVGFibGUsIHRoaXMsIHRydWUpOwogICAgICAg\nICAgICB0aGlzLmFwcGVuZCh2YXIpOwogICAgICAgICAgICB0aGlzLmFwcGVu\nZChjb3JyZWxhdGVkVmFyKTsKICAgICAgICAgICAgY29udGV4dCA9IGN0eDsg\nCiAgICAgICAgICAgIAogICAgICAgICAgICBpbnQgYWxpYXMyID0gX3NlbC5n\nZXRUYWJsZUluZGV4KGZvcmVpZ25UYWJsZSwgdGhpcywgdHJ1ZSk7CiAgICAg\nICAgICAgIEpvaW4gaiA9IG5ldyBKb2luKGxvY2FsVGFibGUsIGFsaWFzMSwg\nZm9yZWlnblRhYmxlLCBhbGlhczIsCiAgICAgICAgICAgICAgICBudWxsLCBm\nYWxzZSk7CiAgICAgICAgICAgIGouc2V0VHlwZShKb2luLlRZUEVfQ1JPU1Mp\nOwoKICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgX2pvaW5zID0gbmV3IEpvaW5TZXQoKTsKICAgICAgICAgICAgX2pv\naW5zLmFkZChqKTsKICAgICAgICAgICAgc2V0Q29ycmVsYXRlZChqKTsKICAg\nICAgICAgICAgX291dGVyID0gZmFsc2U7CiAgICAgICAgICAgIGxhc3RDb250\nZXh0ID0gIGNvbnRleHQ7CiAgICAgICAgICAgIGNvbnRleHQgPSBudWxsOwog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBqb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJz\nZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4o\nbnVsbCwgZmssIG51bGwsIC0xLCBpbnZlcnNlLCB0b01hbnksIGZhbHNlKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW4oRm9y\nZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkg\newogICAgICAgICAgICByZXR1cm4gam9pbihudWxsLCBmaywgbnVsbCwgLTEs\nIGludmVyc2UsIHRvTWFueSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWdu\nS2V5IGZrLCAKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50\nIHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAg\nICAgICAgICAgcmV0dXJuIGpvaW4obmFtZSwgZmssIHRhcmdldCwgc3Vicywg\naW52ZXJzZSwgdG9NYW55LCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZv\ncmVpZ25LZXkgZmssCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQs\nIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgICAgIHJldHVybiBqb2luKG5hbWUsIGZrLCB0YXJnZXQsIHN1\nYnMsIGludmVyc2UsIHRvTWFueSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAg\nICBwcml2YXRlIEpvaW5zIGpvaW4oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkg\nZmssIENsYXNzTWFwcGluZyB0YXJnZXQsCiAgICAgICAgICAgIGludCBzdWJz\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55LCBib29sZWFuIG91\ndGVyKSB7CiAgICAgICAgICAgIC8vIGRvbid0IGxldCB0aGUgZ2V0IGFsaWFz\nIG1ldGhvZHMgc2VlIHRoYXQgYSB2YXIgaGFzIGJlZW4gc2V0CiAgICAgICAg\nICAgIC8vIHVudGlsIHdlIGdldCBwYXN0IHRoZSBsb2NhbCB0YWJsZQogICAg\nICAgICAgICBTdHJpbmcgdmFyID0gdGhpcy52YXI7CiAgICAgICAgICAgIHRo\naXMudmFyID0gbnVsbDsKICAgICAgICAgICAgQ29udGV4dCBjdHggPSBjb250\nZXh0OyAKICAgICAgICAgICAgY29udGV4dCA9IG51bGw7IAoKICAgICAgICAg\nICAgLy8gZ2V0IGZpcnN0IHRhYmxlIGFsaWFzIGJlZm9yZSB1cGRhdGluZyBw\nYXRoOyBpZiB0aGVyZSBpcyBhIGZyb20KICAgICAgICAgICAgLy8gc2VsZWN0\nIHRoZW4gd2Ugc2hvdWxkbid0IGFjdHVhbGx5IGNyZWF0ZSBhIGpvaW4gb2Jq\nZWN0LCBzaW5jZQogICAgICAgICAgICAvLyB0aGUgam9pbnMgd2lsbCBhbGwg\nYmUgZG9uZSBpbiB0aGUgZnJvbSBzZWxlY3QKICAgICAgICAgICAgYm9vbGVh\nbiBjcmVhdGVKb2luID0gX3NlbC5fZnJvbSA9PSBudWxsOwogICAgICAgICAg\nICBUYWJsZSB0YWJsZTEgPSBudWxsOwogICAgICAgICAgICBpbnQgYWxpYXMx\nID0gLTE7CiAgICAgICAgICAgIGlmIChjcmVhdGVKb2luKSB7CiAgICAgICAg\nICAgICAgICBib29sZWFuIGNyZWF0ZUluZGV4ID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIHRhYmxlMSA9IChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlU\nYWJsZSgpIDogZmsuZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAgIGlmIChj\nb3JyZWxhdGVkVmFyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY3Jl\nYXRlSW5kZXggPSBmYWxzZTsgIC8vIG5vdCB0byBjcmVhdGUgaGVyZQogICAg\nICAgICAgICAgICAgYWxpYXMxID0gX3NlbC5nZXRUYWJsZUluZGV4KHRhYmxl\nMSwgdGhpcywgY3JlYXRlSW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyB1cGRhdGUgdGhlIHBhdGggd2l0aCB0aGUgcmVsYXRpb24gbmFt\nZSBiZWZvcmUgZ2V0dGluZyBwayBhbGlhcwogICAgICAgICAgICB0aGlzLmFw\ncGVuZChuYW1lKTsKICAgICAgICAgICAgdGhpcy5hcHBlbmQodmFyKTsKICAg\nICAgICAgICAgaWYgKHZhciA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhp\ncy5hcHBlbmQoY29ycmVsYXRlZFZhcik7CiAgICAgICAgICAgIGNvbnRleHQg\nPSBjdHg7IAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRvTWFueSkg\newogICAgICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0gSU1QTElDSVRfRElT\nVElOQ1Q7CiAgICAgICAgICAgICAgICBfc2VsLl9mbGFncyB8PSBUT19NQU5Z\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9vdXRlciA9IG91dGVyOwoK\nICAgICAgICAgICAgaWYgKGNyZWF0ZUpvaW4pIHsKICAgICAgICAgICAgICAg\nIGJvb2xlYW4gY3JlYXRlSW5kZXggPSB0cnVlOwogICAgICAgICAgICAgICAg\nVGFibGUgdGFibGUyID0gKGludmVyc2UpID8gZmsuZ2V0VGFibGUoKSAKICAg\nICAgICAgICAgICAgICAgICA6IGZrLmdldFByaW1hcnlLZXlUYWJsZSgpOwog\nICAgICAgICAgICAgICAgYm9vbGVhbiBjcmVhdGVkID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICBpbnQgYWxpYXMyID0gLTE7CiAgICAgICAgICAgICAgICBp\nZiAodGFibGUyLmlzQXNzb2NpYXRpb24oKSkgewogICAgICAgICAgICAgICAg\nICAgIGFsaWFzMiA9IF9zZWwuZ2V0VGFibGVJbmRleCh0YWJsZTIsIHRoaXMs\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYWxpYXMyID09IC0x\nKQogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVJbmRleCA9IHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAg\nICAgICAgY3JlYXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBlbHNlIGlmIChjb250ZXh0ID09IF9zZWwuY3R4KCkpIAog\nICAgICAgICAgICAgICAgICAgY3JlYXRlSW5kZXggPSB0cnVlOwogICAgICAg\nICAgICAgICAgZWxzZSBpZiAoY29ycmVsYXRlZFZhciAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGNyZWF0ZUluZGV4ID0gZmFsc2U7CiAgICAgICAg\nICAgICAgICBpZiAoIWNyZWF0ZWQpCiAgICAgICAgICAgICAgICAgICAgYWxp\nYXMyID0gX3NlbC5nZXRUYWJsZUluZGV4KHRhYmxlMiwgdGhpcywgY3JlYXRl\nSW5kZXgpOwogICAgICAgICAgICAgICAgSm9pbiBqID0gbmV3IEpvaW4odGFi\nbGUxLCBhbGlhczEsIHRhYmxlMiwgYWxpYXMyLCBmaywgaW52ZXJzZSk7CiAg\nICAgICAgICAgICAgICBqLnNldFR5cGUoKG91dGVyKSA/IEpvaW4uVFlQRV9P\nVVRFUiA6IEpvaW4uVFlQRV9JTk5FUik7CgogICAgICAgICAgICAgICAgaWYg\nKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9qb2lucyA9\nIG5ldyBKb2luU2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoX2pvaW5zLmFk\nZChqKSAmJiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSAKICAgICAg\nICAgICAgICAgICAgICB8fCBzdWJzID09IFNlbGVjdC5TVUJTX05PTkUpKQog\nICAgICAgICAgICAgICAgICAgIGouc2V0UmVsYXRpb24odGFyZ2V0LCBzdWJz\nLCBjbG9uZShfc2VsKSk7CgogICAgICAgICAgICAgICAgc2V0Q29ycmVsYXRl\nZChqKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXN0Q29udGV4dCA9\nIGNvbnRleHQ7CiAgICAgICAgICAgIGNvbnRleHQgPSBudWxsOwogICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\ndm9pZCBzZXRDb3JyZWxhdGVkKEpvaW4gaikgewogICAgICAgICAgICBpZiAo\nX3NlbC5fcGFyZW50ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47\nCgogICAgICAgICAgICBpZiAoX3NlbC5fYWxpYXNlcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBqLnNldElzTm90TXlKb2luKCk7CiAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgT2JqZWN0\nIGFsaWFzZXNbXSA9IF9zZWwuX2FsaWFzZXMudmFsdWVzKCkudG9BcnJheSgp\nOwogICAgICAgICAgICBib29sZWFuIGZvdW5kMSA9IGZhbHNlOwogICAgICAg\nICAgICBib29sZWFuIGZvdW5kMiA9IGZhbHNlOwoKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpbnQgYWxpYXMgPSAoKEludGVnZXIpYWxpYXNlc1tpXSku\naW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChhbGlhcyA9PSBqLmdl\ndEluZGV4MSgpKQogICAgICAgICAgICAgICAgICAgIGZvdW5kMSA9IHRydWU7\nCiAgICAgICAgICAgICAgICBpZiAoYWxpYXMgPT0gai5nZXRJbmRleDIoKSkK\nICAgICAgICAgICAgICAgICAgICBmb3VuZDIgPSB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGZvdW5kMSAm\nJiBmb3VuZDIpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIGVsc2UgaWYgKCFmb3VuZDEgJiYgIWZvdW5kMikgewogICAgICAgICAgICAg\nICAgai5zZXRJc05vdE15Sm9pbigpOwogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgai5zZXRDb3JyZWxhdGVkKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG1vdmVKb2luc1RvUGFyZW50KCkg\newogICAgICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgSm9pbiBqID0gbnVsbDsKICAgICAg\nICAgICBMaXN0PEpvaW4+IHJlbW92ZWQgPSBuZXcgQXJyYXlMaXN0PEpvaW4+\nKDUpOwogICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2pvaW5zLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgIGog\nPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgaWYgKGouaXNO\nb3RNeUpvaW4oKSkgewogICAgICAgICAgICAgICAgICAgYWRkSm9pbnNUb1Bh\ncmVudChfc2VsLl9wYXJlbnQsIGopOwogICAgICAgICAgICAgICAgICAgcmVt\nb3ZlZC5hZGQoaik7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICB9CiAg\nICAgICAgICAgZm9yIChKb2luIGpvaW4gOiByZW1vdmVkKSB7CiAgICAgICAg\nICAgICAgIF9qb2lucy5yZW1vdmUoam9pbik7CiAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGFkZEpvaW5zVG9QYXJlbnQo\nU2VsZWN0SW1wbCBwYXJlbnQsIEpvaW4gam9pbikgewogICAgICAgICAgICBp\nZiAocGFyZW50Ll9hbGlhc2VzID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIE9iamVjdCBhbGlhc2VzW10gPSBwYXJlbnQu\nX2FsaWFzZXMudmFsdWVzKCkudG9BcnJheSgpOwogICAgICAgICAgICBib29s\nZWFuIGZvdW5kMSA9IGZhbHNlOwogICAgICAgICAgICBib29sZWFuIGZvdW5k\nMiA9IGZhbHNlOwoKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBh\nbGlhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpbnQgYWxp\nYXMgPSAoKEludGVnZXIpYWxpYXNlc1tpXSkuaW50VmFsdWUoKTsKICAgICAg\nICAgICAgICAgIGlmIChhbGlhcyA9PSBqb2luLmdldEluZGV4MSgpKQogICAg\nICAgICAgICAgICAgICAgIGZvdW5kMSA9IHRydWU7CiAgICAgICAgICAgICAg\nICBpZiAoYWxpYXMgPT0gam9pbi5nZXRJbmRleDIoKSkKICAgICAgICAgICAg\nICAgICAgICBmb3VuZDIgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAKICAgICAgICAgICAgaWYgKGZvdW5kMSAmJiBmb3VuZDIpIHsK\nICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgbXkgam9pbiwgYWRkIGpvaW4K\nICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuX2pvaW5zID09IG51bGwpIAog\nICAgICAgICAgICAgICAgICAgIHBhcmVudC5fam9pbnMgPSBuZXcgU2VsZWN0\nSm9pbnMocGFyZW50KTsKICAgICAgICAgICAgICAgIFNlbGVjdEpvaW5zIHAg\nPSBwYXJlbnQuX2pvaW5zOwogICAgICAgICAgICAgICAgaWYgKHAuam9pbnMo\nKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHAuc2V0Sm9pbnMobmV3\nIEpvaW5TZXQoKSk7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAg\ncC5qb2lucygpLmFkZChqb2luKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBlbHNlIGlmIChwYXJlbnQuX3BhcmVudCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgYWRkSm9pbnNUb1BhcmVudChwYXJlbnQuX3BhcmVudCwgam9pbik7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU2VsZWN0Sm9pbnMgY2xvbmUo\nU2VsZWN0SW1wbCBzZWwpIHsKICAgICAgICAgICAgU2VsZWN0Sm9pbnMgc2og\nPSBuZXcgU2VsZWN0Sm9pbnMoc2VsKTsKICAgICAgICAgICAgc2oudmFyID0g\ndmFyOwogICAgICAgICAgICBpZiAocGF0aCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgc2oucGF0aCA9IG5ldyBTdHJpbmdCdWlsZGVyKHBhdGgudG9TdHJp\nbmcoKSk7CiAgICAgICAgICAgIGlmIChfam9pbnMgIT0gbnVsbCAmJiAhX2pv\naW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHNqLl9qb2lucyA9IG5l\ndyBKb2luU2V0KF9qb2lucyk7CiAgICAgICAgICAgIHNqLl9vdXRlciA9IF9v\ndXRlcjsKICAgICAgICAgICAgcmV0dXJuIHNqOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLnRvU3RyaW5nKCkgKyAiICgiICsgX291dGVyICsgIik6ICIg\nKyBfam9pbnM7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcm90ZWN0ZWQg\nU2VsZWN0cyBuZXdTZWxlY3RzKCkgewogICAgICAgIHJldHVybiBuZXcgU2Vs\nZWN0cygpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHRv\nIHRyYWNrIHNlbGVjdGVkIGNvbHVtbnMsIHdpdGggZmFzdCBjb250YWlucyBt\nZXRob2QuCiAgICAgKiBBY3RzIGFzIGEgbGlzdCBvZiBzZWxlY3QgaWRzLCB3\naXRoIGFkZGl0aW9uYWwgbWV0aG9kcyB0byBtYW5pcHVsYXRlCiAgICAgKiB0\naGUgYWxpYXMgb2YgZWFjaCBzZWxlY3RlZCBpZC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHN0YXRpYyBjbGFzcyBTZWxlY3RzCiAgICAgICAgZXh0ZW5kcyBB\nYnN0cmFjdExpc3QgewoKICAgICAgICBwcm90ZWN0ZWQgTGlzdCBfaWRzID0g\nbnVsbDsKICAgICAgICBwcm90ZWN0ZWQgTGlzdCBfaWRlbnRzID0gbnVsbDsK\nICAgICAgICBwcm90ZWN0ZWQgTWFwIF9hbGlhc2VzID0gbnVsbDsKICAgICAg\nICBwcm90ZWN0ZWQgTWFwIF9zZWxlY3RBcyA9IG51bGw7CiAgICAgICAgcHJv\ndGVjdGVkIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CgogICAgICAgIC8q\nKgogICAgICAgICAqIEFkZCBhbGwgYWxpYXNlcyBmcm9tIGFub3RoZXIgaW5z\ndGFuY2UuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkQWxs\nKFNlbGVjdHMgc2VscykgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxs\nICYmIHNlbHMuX2lkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2lkcyA9\nIG5ldyBBcnJheUxpc3Qoc2Vscy5faWRzKTsKICAgICAgICAgICAgZWxzZSBp\nZiAoc2Vscy5faWRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfaWRzLmFk\nZEFsbChzZWxzLl9pZHMpOwoKICAgICAgICAgICAgaWYgKF9pZGVudHMgPT0g\nbnVsbCAmJiBzZWxzLl9pZGVudHMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9pZGVudHMgPSBuZXcgQXJyYXlMaXN0KHNlbHMuX2lkZW50cyk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKHNlbHMuX2lkZW50cyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX2lkZW50cy5hZGRBbGwoc2Vscy5faWRlbnRzKTsKCiAgICAg\nICAgICAgIGlmIChfYWxpYXNlcyA9PSBudWxsICYmIHNlbHMuX2FsaWFzZXMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhhc2hN\nYXAoc2Vscy5fYWxpYXNlcyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHNlbHMu\nX2FsaWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hbGlhc2VzLnB1\ndEFsbChzZWxzLl9hbGlhc2VzKTsKCiAgICAgICAgICAgIGlmIChfc2VsZWN0\nQXMgPT0gbnVsbCAmJiBzZWxzLl9zZWxlY3RBcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX3NlbGVjdEFzID0gbmV3IEhhc2hNYXAoc2Vscy5fc2VsZWN0\nQXMpOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9zZWxlY3RBcyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX3NlbGVjdEFzLnB1dEFsbChzZWxzLl9z\nZWxlY3RBcyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBS\nZXR1cm5zIHRoZSBhbGlhcyBvZiBhIGdpdmVuIGlkLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0QWxpYXMoT2JqZWN0IGlkKSB7CiAg\nICAgICAgICAgIHJldHVybiAoX2FsaWFzZXMgPT0gbnVsbCkgPyBudWxsIDog\nX2FsaWFzZXMuZ2V0KGlkKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFNldCBhbiBhbGlhcyBmb3IgYSBnaXZlbiBpZC4KICAgICAgICAg\nKi8KICAgICAgICBwdWJsaWMgaW50IHNldEFsaWFzKE9iamVjdCBpZCwgT2Jq\nZWN0IGFsaWFzLCBib29sZWFuIGlkZW50KSB7CiAgICAgICAgICAgIGlmIChf\naWRzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pZHMgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNo\nTWFwKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGludCBpZHg7CiAg\nICAgICAgICAgIGlmIChfYWxpYXNlcy5wdXQoaWQsIGFsaWFzKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgaWR4ID0gX2lkcy5pbmRleE9mKGlkKTsKICAg\nICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBfaWRzLmFkZChpZCk7\nCiAgICAgICAgICAgICAgICBpZHggPSBfaWRzLnNpemUoKSAtIDE7CgogICAg\nICAgICAgICAgICAgaWYgKGlkZW50KSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKF9pZGVudHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nX2lkZW50cyA9IG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgICAgICAg\nICAgX2lkZW50cy5hZGQoaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiBpZHg7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBTZXQgYW4gYWxpYXMgZm9yIGEgZ2l2ZW4g\naW5kZXguCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0QWxp\nYXMoaW50IGlkeCwgT2JqZWN0IGFsaWFzKSB7CiAgICAgICAgICAgIE9iamVj\ndCBpZCA9IF9pZHMuZ2V0KGlkeCk7CiAgICAgICAgICAgIF9hbGlhc2VzLnB1\ndChpZCwgYWxpYXMpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogSW5zZXJ0IGFuIGFsaWFzIGJlZm9yZSB0aGUgZ2l2ZW4gaW5kZXgsIHVz\naW5nIG5lZ2F0aXZlIGluZGV4ZXMKICAgICAgICAgKiB0byBjb3VudCBiYWNr\nd2FyZHMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgaW5zZXJ0\nQWxpYXMoaW50IGlkeCwgT2JqZWN0IGlkLCBPYmplY3QgYWxpYXMpIHsKICAg\nICAgICAgICAgX2FsaWFzZXMucHV0KGlkLCBhbGlhcyk7CiAgICAgICAgICAg\nIGlmIChpZHggPj0gMCkKICAgICAgICAgICAgICAgIF9pZHMuYWRkKGlkeCwg\naWQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfaWRzLmFk\nZChfaWRzLnNpemUoKSArIGlkeCwgaWQpOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4g\nYWxpYXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIGludCBpbmRleE9m\nQWxpYXMoT2JqZWN0IGFsaWFzKSB7CiAgICAgICAgICAgIGlmIChfYWxpYXNl\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9pZHMuc2l6ZSgpOyBpKyspCiAg\nICAgICAgICAgICAgICBpZiAoYWxpYXMuZXF1YWxzKF9hbGlhc2VzLmdldChf\naWRzLmdldChpKSkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwog\nICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBBIGxpc3QgcmVwcmVzZW50YXRpb24gb2YgdGhlIGFsaWFz\nZXMsIGluIHNlbGVjdCBvcmRlciwgd2l0aAogICAgICAgICAqIEFTIGFsaWFz\nZXMgcHJlc2VudC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgTGlzdCBn\nZXRBbGlhc2VzKGZpbmFsIGJvb2xlYW4gaWRlbnQsIGZpbmFsIGJvb2xlYW4g\naW5uZXIpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBBYnN0cmFjdExpc3QoKSB7CiAgICAgICAg\nICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIChpZGVudCAmJiBfaWRlbnRzICE9IG51bGwpID8gX2lkZW50\ncy5zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgOiBfaWRzLnNpemUo\nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMg\nT2JqZWN0IGdldChpbnQgaSkgewogICAgICAgICAgICAgICAgICAgIE9iamVj\ndCBpZCA9IChpZGVudCAmJiBfaWRlbnRzICE9IG51bGwpID8gX2lkZW50cy5n\nZXQoaSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBfaWRzLmdldChpKTsK\nICAgICAgICAgICAgICAgICAgICBPYmplY3QgYWxpYXMgPSBfYWxpYXNlcy5n\nZXQoaWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChpZCBpbnN0YW5jZW9m\nIENvbHVtbiAmJiAoKENvbHVtbikgaWQpLmlzWE1MKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGFsaWFzID0gYWxpYXMgKyBfZGljdC5nZXRTdHJpbmdW\nYWw7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAg\nICAgIFN0cmluZyBhcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGlubmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGlhcyBp\nbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGFzID0gKChTdHJpbmcpIGFsaWFzKS5yZXBsYWNlKCcuJywgJ18nKTsKICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9zZWxlY3RBcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBhcyA9IChTdHJpbmcpIF9zZWxl\nY3RBcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlk\nIGluc3RhbmNlb2YgVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGFz\nID0gKChWYWx1ZSkgaWQpLmdldEFsaWFzKCk7CgogICAgICAgICAgICAgICAg\nICAgIGlmIChhcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChpZGVudCAmJiBfaWRlbnRzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gYXM7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChhbGlhcyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGFsaWFzID0gbmV3IFNRTEJ1ZmZlcigoU1FM\nQnVmZmVyKSBhbGlhcykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYXBwZW5kKCIgQVMgIikuYXBwZW5kKGFzKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxp\nYXMgPSBhbGlhcyArICIgQVMgIiArIGFzOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBTZXQgdGhhdCBhIGdpdmVuIGlkJ3MgYWxpYXMgaGFz\nIGFuIEFTIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIHNldFNlbGVjdEFzKE9iamVjdCBpZCwgU3RyaW5nIGFzKSB7CiAgICAgICAg\nICAgIGlmIChfc2VsZWN0QXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9z\nZWxlY3RBcyA9IG5ldyBIYXNoTWFwKChpbnQpICg1ICogMS4zMyArIDEpKTsK\nICAgICAgICAgICAgX3NlbGVjdEFzLnB1dChpZCwgYXMpOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXIgYWxsIHBsYWNlaG9sZGVy\ncyBhbmQgc2VsZWN0IEFTIGNsYXVzZXMuCiAgICAgICAgICovCiAgICAgICAg\ncHVibGljIHZvaWQgY2xlYXJQbGFjZWhvbGRlcnMoKSB7CiAgICAgICAgICAg\nIGlmIChfaWRzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gX2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgaWQgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgaWYgKGlkIGluc3RhbmNlb2YgUGxhY2Vob2xkZXIpIHsKICAgICAgICAg\nICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAg\nX2FsaWFzZXMucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29u\ndGFpbnMoT2JqZWN0IGlkKSB7CiAgICAgICAgICAgIHJldHVybiBfYWxpYXNl\ncyAhPSBudWxsICYmIF9hbGlhc2VzLmNvbnRhaW5zS2V5KGlkKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGludCBpKSB7CiAgICAg\nICAgICAgIGlmIChfaWRzID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIHJldHVybiBfaWRzLmdldChpKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIChfaWRz\nID09IG51bGwpID8gMCA6IF9pZHMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgICAgIF9pZHMgPSBu\ndWxsOwogICAgICAgICAgICBfYWxpYXNlcyA9IG51bGw7CiAgICAgICAgICAg\nIF9zZWxlY3RBcyA9IG51bGw7CiAgICAgICAgICAgIF9pZGVudHMgPSBudWxs\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgc2V0Q29ycmVs\nYXRlZFZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICBpZiAodmFyID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIHJldHVy\nbiBuZXcgU2VsZWN0Sm9pbnModGhpcykuc2V0Q29ycmVsYXRlZFZhcmlhYmxl\nKHZhcik7CiAgICB9CiAgICAKICAgIHB1YmxpYyBKb2lucyBzZXRKb2luQ29u\ndGV4dChDb250ZXh0IGN0eCkgewogICAgICAgIGlmIChjdHggPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIG5ldyBT\nZWxlY3RKb2lucyh0aGlzKS5zZXRKb2luQ29udGV4dChjdHgpOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ycmVsYXRlZFZhcmlhYmxlKCkgewog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG1v\ndmVKb2luc1RvUGFyZW50KCkgewogICAgfQp9CgovKioKICogQ29tbW9uIGpv\naW5zIGludGVyZmFjZSB1c2VkIGludGVybmFsbHkuIENhbm5vdCBiZSBtYWRl\nIGFuIGlubmVyIGNsYXNzCiAqIGJlY2F1c2UgdGhlIG91dGVyIGNsYXNzIChT\nZWxlY3QpIGhhcyB0byBpbXBsZW1lbnQgaXQuCiAqLwppbnRlcmZhY2UgUGF0\naEpvaW5zCiAgICBleHRlbmRzIEpvaW5zIHsKCiAgICAvKioKICAgICAqIE1h\ncmsgdGhpcyBhcyBhbiBvdXRlciBqb2lucyBzZXQuCiAgICAgKi8KICAgIHB1\nYmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcik7CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGluc3RhbmNlIGhhcyBh\nIHBhdGgsIGFueSBqb2lucywgb3IgYSB2YXJpYWJsZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpOwoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSByZWxhdGlvbiBwYXRoIHRyYXZlcnNlZCBieSB0aGVzZSBqb2lu\ncywgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nQnVpbGRlciBwYXRoKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNl\ndCBvZiB7QGxpbmsgSm9pbn0gZWxlbWVudHMsIG9yIG51bGwgaWYgbm9uZS4K\nICAgICAqLwogICAgcHVibGljIEpvaW5TZXQgam9pbnMoKTsKCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgbWF4aW11bSBudW1iZXIgb2Ygam9pbnMgY29u\ndGFpbmVkIGluIHRoaXMgaW5zdGFuY2UgYXQgYW55CiAgICAgKiB0aW1lLgog\nICAgICovCiAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpOwoKICAgIC8qKgog\nICAgICogTnVsbCB0aGUgc2V0IG9mIHtAbGluayBKb2lufSBlbGVtZW50cy4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCk7CgogICAgLyoq\nCiAgICAgKiBUaGUgc2VsZWN0IG93bmVyIG9mIHRoaXMgam9pbgogICAgICog\nQHJldHVybgogICAgICovCiAgICBwdWJsaWMgU2VsZWN0IGdldFNlbGVjdCgp\nOwp9Cgo=\n","encoding":"base64"}

