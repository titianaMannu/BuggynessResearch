{"sha":"9eab145edc70f2d3495e66b2bde9cc12133ecbc6","node_id":"MDQ6QmxvYjIwNjM2NDo5ZWFiMTQ1ZWRjNzBmMmQzNDk1ZTY2YjJiZGU5Y2MxMjEzM2VjYmM2","size":15215,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9eab145edc70f2d3495e66b2bde9cc12133ecbc6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5SZW1v\ndGVDb21taXRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVu\ndC5SZW1vdGVDb21taXRMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIuY29uZi5Db25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuY29uY3VycmVudC5BYnN0cmFjdENvbmN1cnJl\nbnRFdmVudE1hbmFnZXI7CgovKioKICogQWJzdHJhY3Qge0BsaW5rIERhdGFD\nYWNoZX0gaW1wbGVtZW50YXRpb24gdGhhdCBwcm92aWRlcyB2YXJpb3VzCiAq\nIHN0YXRpc3RpY3MsIGxvZ2dpbmcsIGFuZCB0aW1lb3V0IGZ1bmN0aW9uYWxp\ndHkgY29tbW9uIGFjcm9zcyBjYWNoZQogKiBpbXBsZW1lbnRhdGlvbnMuCiAq\nCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGFi\nc3RyYWN0IGNsYXNzIEFic3RyYWN0RGF0YUNhY2hlIGV4dGVuZHMgQWJzdHJh\nY3RDb25jdXJyZW50RXZlbnRNYW5hZ2VyCiAgICBpbXBsZW1lbnRzIERhdGFD\nYWNoZSwgQ29uZmlndXJhYmxlIHsKCQogICAgcHJvdGVjdGVkIENhY2hlU3Rh\ndGlzdGljcy5EZWZhdWx0IHN0YXRzID0gbmV3IENhY2hlU3RhdGlzdGljcy5E\nZWZhdWx0KCk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQml0U2V0IEVN\nUFRZX0JJVFNFVCA9IG5ldyBCaXRTZXQoMCk7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIHNfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UoQWJzdHJhY3REYXRhQ2FjaGUuY2xhc3MpOwogICAgCgogICAgLyoqCiAg\nICAgKiBUaGUgY29uZmlndXJhdGlvbiBzZXQgYnkgdGhlIHN5c3RlbS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmY7\nCgogICAgLyoqCiAgICAgKiBUaGUgbG9nIHRvIHVzZS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIExvZyBsb2c7CgogICAgcHJpdmF0ZSBTdHJpbmcgX25hbWUg\nPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsK\nICAgIHByaXZhdGUgU3RyaW5nIF9zY2hlZHVsZSA9IG51bGw7CgogICAgcHVi\nbGljIFN0cmluZyBnZXROYW1lKCkgewogICAgICAgIHJldHVybiBfbmFtZTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROYW1lKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgX25hbWUgPSBuYW1lOwogICAgfQogICAgcHVibGljIHZvaWQg\nc2V0RW5hYmxlU3RhdGlzdGljcyhib29sZWFuIGVuYWJsZSl7CiAgICAgICAg\naWYoZW5hYmxlID09IHRydWUpewogICAgICAgICAgICBzdGF0cy5lbmFibGUo\nKTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgdm9pZCBnZXRFbmFibGVT\ndGF0aXN0aWNzKCl7CiAgICAgICAgc3RhdHMuaXNFbmFibGVkKCk7CiAgICB9\nCgogICAgcHVibGljIFN0cmluZyBnZXRFdmljdGlvblNjaGVkdWxlKCkgewog\nICAgICAgIHJldHVybiBfc2NoZWR1bGU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0RXZpY3Rpb25TY2hlZHVsZShTdHJpbmcgcykgewogICAgICAgIF9z\nY2hlZHVsZSA9IHM7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6\nZShEYXRhQ2FjaGVNYW5hZ2VyIG1hbmFnZXIpIHsKICAgICAgICBpZiAoX3Nj\naGVkdWxlICE9IG51bGwgJiYgISIiLmVxdWFscyhfc2NoZWR1bGUpKSB7CiAg\nICAgICAgICAgIERhdGFDYWNoZVNjaGVkdWxlciBzY2hlZHVsZXIgPSBtYW5h\nZ2VyLmdldERhdGFDYWNoZVNjaGVkdWxlcigpOwogICAgICAgICAgICBpZiAo\nc2NoZWR1bGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBzY2hlZHVsZXIu\nc2NoZWR1bGVFdmljdGlvbih0aGlzLCBfc2NoZWR1bGUpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21taXQoQ29sbGVjdGlvbjxEYXRh\nQ2FjaGVQQ0RhdGE+IGFkZGl0aW9ucywgQ29sbGVjdGlvbjxEYXRhQ2FjaGVQ\nQ0RhdGE+IG5ld1VwZGF0ZXMsCiAgICAgICAgICAgIENvbGxlY3Rpb248RGF0\nYUNhY2hlUENEYXRhPiBleGlzdGluZ1VwZGF0ZXMsIENvbGxlY3Rpb248T2Jq\nZWN0PiBkZWxldGVzKSB7CiAgICAgICAgLy8gcmVtb3ZlIGFsbCBvYmplY3Rz\nIGluIGRlbGV0ZXMgbGlzdAogICAgICAgIHJlbW92ZUFsbEludGVybmFsKGRl\nbGV0ZXMpOwoKICAgICAgICAvLyBuZXh0LCBhZGQgYWxsIHRoZSBuZXcgYWRk\naXRpb25zCiAgICAgICAgcHV0QWxsSW50ZXJuYWwoYWRkaXRpb25zKTsKICAg\nICAgICBwdXRBbGxJbnRlcm5hbChuZXdVcGRhdGVzKTsKCiAgICAgICAgLy8g\ncG9zc2libHkgYWRkIHRoZSBleGlzdGluZyB1cGRhdGVzLCBkZXBlbmRpbmcg\nb24gdGhlCiAgICAgICAgLy8gc2VtYW50aWNzIG9mIHRoZSBjYWNoZSwgYXMg\nZGljdGF0ZWQgYnkgcmVjYWNoZVVwZGF0ZXMoKQogICAgICAgIGlmIChyZWNh\nY2hlVXBkYXRlcygpKQogICAgICAgICAgICBwdXRBbGxJbnRlcm5hbChleGlz\ndGluZ1VwZGF0ZXMpOwoKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbjxPYmplY3Q+IGFkZElkcyA9\nIG5ldyBBcnJheUxpc3Q8T2JqZWN0PihhZGRpdGlvbnMuc2l6ZSgpKTsKICAg\nICAgICAgICAgQ29sbGVjdGlvbjxPYmplY3Q+IHVwSWRzID0gbmV3IEFycmF5\nTGlzdDxPYmplY3Q+KG5ld1VwZGF0ZXMuc2l6ZSgpKTsKICAgICAgICAgICAg\nQ29sbGVjdGlvbjxPYmplY3Q+IGV4SWRzID0gbmV3IEFycmF5TGlzdDxPYmpl\nY3Q+KGV4aXN0aW5nVXBkYXRlcy5zaXplKCkpOwoKICAgICAgICAgICAgZm9y\nIChEYXRhQ2FjaGVQQ0RhdGEgYWRkaXRpb24gOiBhZGRpdGlvbnMpCiAgICAg\nICAgICAgICAgICBhZGRJZHMuYWRkKGFkZGl0aW9uLmdldElkKCkpOwogICAg\nICAgICAgICBmb3IgKERhdGFDYWNoZVBDRGF0YSBuZXdVcGRhdGUgOiBuZXdV\ncGRhdGVzKQogICAgICAgICAgICAgICAgdXBJZHMuYWRkKG5ld1VwZGF0ZS5n\nZXRJZCgpKTsKICAgICAgICAgICAgZm9yIChEYXRhQ2FjaGVQQ0RhdGEgZXhp\nc3RpbmdVcGRhdGUgOiBleGlzdGluZ1VwZGF0ZXMpCiAgICAgICAgICAgICAg\nICBleElkcy5hZGQoZXhpc3RpbmdVcGRhdGUuZ2V0SWQoKSk7CgogICAgICAg\nICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1jb21taXQiLCBuZXcg\nT2JqZWN0W117IGFkZElkcywgdXBJZHMsIGV4SWRzLCBkZWxldGVzIH0pKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMo\nT2JqZWN0IGtleSkgewogICAgICAgIERhdGFDYWNoZVBDRGF0YSBvID0gZ2V0\nSW50ZXJuYWwoa2V5KTsKICAgICAgICBpZiAoc3RhdHMuaXNFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgc3RhdHMubmV3R2V0KG8gPT0gbnVsbCA/IG51bGwg\nOiBvLmdldFR5cGUoKSwgbyAhPSBudWxsKTsKICAgICAgICB9CiAgICAgICAg\naWYgKG8gIT0gbnVsbCAmJiBvLmlzVGltZWRPdXQoKSkgewogICAgICAgICAg\nICBvID0gbnVsbDsKICAgICAgICAgICAgcmVtb3ZlSW50ZXJuYWwoa2V5KTsK\nICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtdGltZW91dCIs\nIGtleSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbyAhPSBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgY29udGFpbnNBbGwoQ29sbGVjdGlv\nbjxPYmplY3Q+IGtleXMpIHsKICAgICAgICBpZiAoa2V5cy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9CSVRTRVQ7CgogICAgICAgIEJp\ndFNldCBzZXQgPSBuZXcgQml0U2V0KGtleXMuc2l6ZSgpKTsKICAgICAgICBp\nbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvcjxPYmplY3Q+IGl0ZXIg\nPSBrZXlzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyBpKyspCiAgICAg\nICAgICAgIGlmIChjb250YWlucyhpdGVyLm5leHQoKSkpCiAgICAgICAgICAg\nICAgICBzZXQuc2V0KGkpOwogICAgICAgIHJldHVybiBzZXQ7CiAgICB9Cgog\nICAgcHVibGljIERhdGFDYWNoZVBDRGF0YSBnZXQoT2JqZWN0IGtleSkgewog\nICAgICAgIERhdGFDYWNoZVBDRGF0YSBvID0gZ2V0SW50ZXJuYWwoa2V5KTsK\nICAgICAgICBpZiAobyAhPSBudWxsICYmIG8uaXNUaW1lZE91dCgpKSB7CiAg\nICAgICAgICAgIG8gPSBudWxsOwogICAgICAgICAgICByZW1vdmVJbnRlcm5h\nbChrZXkpOwogICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS10\naW1lb3V0Iiwga2V5KSk7CiAgICAgICAgfQogICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBpZiAobyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtbWlz\ncyIsIGtleSkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBs\nb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1oaXQiLCBrZXkpKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKHN0YXRzLmlzRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgIHN0YXRzLm5ld0dldCgobyA9PSBudWxsKSA/IG51bGwgOiBvLmdldFR5\ncGUoKSwgbyAhPSBudWxsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG87\nCiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgb2JqZWN0cyBm\nb3IgdGhlIGdpdmVuIGtleSBMaXN0LgogICAgICovCiAgICBwdWJsaWMgTWFw\nPE9iamVjdCxEYXRhQ2FjaGVQQ0RhdGE+IGdldEFsbChMaXN0PE9iamVjdD4g\na2V5cykgewogICAgICAgIE1hcDxPYmplY3QsRGF0YUNhY2hlUENEYXRhPiBy\nZXN1bHRNYXAgPSBuZXcgSGFzaE1hcDxPYmplY3QsRGF0YUNhY2hlUENEYXRh\nPihrZXlzLnNpemUoKSk7CiAgICAgICAgZm9yIChPYmplY3Qga2V5IDoga2V5\ncykKICAgICAgICAgICAgcmVzdWx0TWFwLnB1dChrZXksIGdldChrZXkpKTsK\nICAgICAgICByZXR1cm4gcmVzdWx0TWFwOwogICAgfQoKICAgIHB1YmxpYyBE\nYXRhQ2FjaGVQQ0RhdGEgcHV0KERhdGFDYWNoZVBDRGF0YSBkYXRhKSB7CiAg\nICAgICAgaWYgKHN0YXRzLmlzRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIHN0\nYXRzLm5ld1B1dChkYXRhLmdldFR5cGUoKSk7CiAgICAgICAgfQogICAgICAg\nIERhdGFDYWNoZVBDRGF0YSBvID0gcHV0SW50ZXJuYWwoZGF0YS5nZXRJZCgp\nLCBkYXRhKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXB1dCIsIGRh\ndGEuZ2V0SWQoKSkpOwogICAgICAgIHJldHVybiAobyA9PSBudWxsIHx8IG8u\naXNUaW1lZE91dCgpKSA/IG51bGwgOiBvOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHVwZGF0ZShEYXRhQ2FjaGVQQ0RhdGEgZGF0YSkgewogICAgICAgIGlm\nIChyZWNhY2hlVXBkYXRlcygpKSB7CiAgICAgICAgICAgIGlmIChzdGF0cy5p\nc0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgc3RhdHMubmV3UHV0KGRh\ndGEuZ2V0VHlwZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdXRJ\nbnRlcm5hbChkYXRhLmdldElkKCksIGRhdGEpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgRGF0YUNhY2hlUENEYXRhIHJlbW92ZShPYmplY3Qga2V5\nKSB7CiAgICAgICAgRGF0YUNhY2hlUENEYXRhIG8gPSByZW1vdmVJbnRlcm5h\nbChrZXkpOwogICAgICAgIGlmIChvICE9IG51bGwgJiYgby5pc1RpbWVkT3V0\nKCkpCiAgICAgICAgICAgIG8gPSBudWxsOwogICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBpZiAobyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcmVt\nb3ZlLW1pc3MiLCBrZXkpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcmVtb3ZlLWhpdCIs\nIGtleSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbzsKICAgIH0KCiAg\nICBwdWJsaWMgQml0U2V0IHJlbW92ZUFsbChDb2xsZWN0aW9uPE9iamVjdD4g\na2V5cykgewogICAgICAgIGlmIChrZXlzLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuIEVNUFRZX0JJVFNFVDsKCiAgICAgICAgQml0U2V0IHNldCA9\nIG5ldyBCaXRTZXQoa2V5cy5zaXplKCkpOwogICAgICAgIGludCBpID0gMDsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yPE9iamVjdD4gaXRlciA9IGtleXMuaXRl\ncmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7IGkrKykKICAgICAgICAgICAgaWYg\nKHJlbW92ZShpdGVyLm5leHQoKSkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHNldC5zZXQoaSk7CiAgICAgICAgcmV0dXJuIHNldDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlbW92ZSB0aGUgb2JqZWN0cyBvZiB0aGUgZ2l2ZW4gY2xh\nc3MgZnJvbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJl\nbW92ZUFsbChDbGFzczw/PiBjbHMsIGJvb2xlYW4gc3ViQ2xhc3Nlcykgewog\nICAgICAgIHJlbW92ZUFsbEludGVybmFsKGNscywgc3ViQ2xhc3Nlcyk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gcGluKE9iamVjdCBrZXkpIHsKICAg\nICAgICBib29sZWFuIGJvb2wgPSBwaW5JbnRlcm5hbChrZXkpOwogICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBpZiAo\nYm9vbCkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNh\nY2hlLXBpbi1oaXQiLCBrZXkpKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcGluLW1pc3Mi\nLCBrZXkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJvb2w7CiAgICB9\nCgogICAgcHVibGljIEJpdFNldCBwaW5BbGwoQ29sbGVjdGlvbjxPYmplY3Q+\nIGtleXMpIHsKICAgICAgICBpZiAoa2V5cy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybiBFTVBUWV9CSVRTRVQ7CgogICAgICAgIEJpdFNldCBzZXQg\nPSBuZXcgQml0U2V0KGtleXMuc2l6ZSgpKTsKICAgICAgICBpbnQgaSA9IDA7\nCiAgICAgICAgZm9yIChJdGVyYXRvcjxPYmplY3Q+IGl0ZXIgPSBrZXlzLml0\nZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyBpKyspCiAgICAgICAgICAgIGlm\nIChwaW4oaXRlci5uZXh0KCkpKQogICAgICAgICAgICAgICAgc2V0LnNldChp\nKTsKICAgICAgICByZXR1cm4gc2V0OwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHBpbkFsbChDbGFzczw/PiBjbHMsIGJvb2xlYW4gc3VicykgewogICAgICAg\nIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cud2Fy\nbihzX2xvYy5nZXQoImNhY2hlLWNsYXNzLXBpbiIsIGdldE5hbWUoKSkpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHVucGluKE9iamVjdCBrZXkpIHsK\nICAgICAgICBib29sZWFuIGJvb2wgPSB1bnBpbkludGVybmFsKGtleSk7CiAg\nICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAg\nIGlmIChib29sKQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdl\ndCgiY2FjaGUtdW5waW4taGl0Iiwga2V5KSk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXVu\ncGluLW1pc3MiLCBrZXkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJv\nb2w7CiAgICB9CgogICAgcHVibGljIEJpdFNldCB1bnBpbkFsbChDb2xsZWN0\naW9uPE9iamVjdD4ga2V5cykgewogICAgICAgIGlmIChrZXlzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0JJVFNFVDsKCiAgICAgICAg\nQml0U2V0IHNldCA9IG5ldyBCaXRTZXQoa2V5cy5zaXplKCkpOwogICAgICAg\nIGludCBpID0gMDsKICAgICAgICBmb3IgKEl0ZXJhdG9yPE9iamVjdD4gaXRl\nciA9IGtleXMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7IGkrKykKICAg\nICAgICAgICAgaWYgKHVucGluKGl0ZXIubmV4dCgpKSkKICAgICAgICAgICAg\nICAgIHNldC5zZXQoaSk7CiAgICAgICAgcmV0dXJuIHNldDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB1bnBpbkFsbChDbGFzczw/PiBjbHMsIGJvb2xlYW4g\nc3VicykgewogICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICBsb2cud2FybihzX2xvYy5nZXQoImNhY2hlLWNsYXNzLXVucGlu\nIiwgZ2V0TmFtZSgpKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXIo\nKSB7CiAgICAgICAgY2xlYXJJbnRlcm5hbCgpOwogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9j\nLmdldCgiY2FjaGUtY2xlYXIiLCBnZXROYW1lKCkpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBjbG9zZSh0cnVlKTsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBjbG9zZShib29sZWFuIGNsZWFyKSB7\nCiAgICAgICAgaWYgKCFfY2xvc2VkKSB7CiAgICAgICAgICAgIGlmIChjbGVh\ncikKICAgICAgICAgICAgICAgIGNsZWFySW50ZXJuYWwoKTsKICAgICAgICAg\nICAgX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzQ2xvc2VkKCkgewogICAgICAgIHJldHVybiBfY2xvc2Vk\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZEV4cGlyYXRpb25MaXN0ZW5l\ncihFeHBpcmF0aW9uTGlzdGVuZXIgbGlzdGVuKSB7CiAgICAgICAgYWRkTGlz\ndGVuZXIobGlzdGVuKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZW1v\ndmVFeHBpcmF0aW9uTGlzdGVuZXIoRXhwaXJhdGlvbkxpc3RlbmVyIGxpc3Rl\nbikgewogICAgICAgIHJldHVybiByZW1vdmVMaXN0ZW5lcihsaXN0ZW4pOwog\nICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAg\ncmV0dXJuICJbIiArIHN1cGVyLnRvU3RyaW5nKCkgKyAiOiIgKyBfbmFtZSAr\nICJdIjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHBh\ncnQgb2YgdGhlIHtAbGluayBSZW1vdGVDb21taXRMaXN0ZW5lcn0gaW50ZXJm\nYWNlLiBJZgogICAgICogeW91ciBjYWNoZSBzdWJjbGFzcyByZWxpZXMgb24g\nT3BlbkpQQSBmb3IgY2x1c3RlcmluZyBzdXBwb3J0LCBtYWtlIGl0CiAgICAg\nKiBpbXBsZW1lbnQgPGNvZGU+UmVtb3RlQ29tbWl0TGlzdGVuZXI8L2NvZGU+\nLiBUaGlzIG1ldGhvZCB3aWxsIHRha2UKICAgICAqIGNhcmUgb2YgaW52YWxp\nZGF0aW5nIGVudHJpZXMgZnJvbSByZW1vdGUgY29tbWl0cy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgYWZ0ZXJDb21taXQoUmVtb3RlQ29tbWl0RXZlbnQg\nZXZlbnQpIHsKICAgICAgICBpZiAoX2Nsb3NlZCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBpZiAoZXZlbnQuZ2V0UGF5bG9hZFR5cGUoKSA9PSBS\nZW1vdGVDb21taXRFdmVudC5QQVlMT0FEX0VYVEVOVFMpIHsKICAgICAgICAg\nICAgcmVtb3ZlQWxsVHlwZU5hbWVzSW50ZXJuYWwoZXZlbnQuZ2V0VXBkYXRl\nZFR5cGVOYW1lcygpKTsKICAgICAgICAgICAgcmVtb3ZlQWxsVHlwZU5hbWVz\nSW50ZXJuYWwoZXZlbnQuZ2V0RGVsZXRlZFR5cGVOYW1lcygpKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAvLyBkcm9wIGFsbCB0aGUgY29tbWl0\ndGVkIE9JRHMsIGV4Y2VwdGluZyBicmFuZAogICAgICAgICAgICAvLyBuZXcg\nT0lEcy4gYnJhbmQgbmV3IE9JRHMgZWl0aGVyIHdvbid0IGJlIGluCiAgICAg\nICAgICAgIC8vIHRoZSBjYWNoZSwgb3IgaWYgdGhleSBhcmUsIHdpbGwgYmUg\nbW9yZSB1cCB0byBkYXRlCiAgICAgICAgICAgIHJlbW92ZUFsbEludGVybmFs\nKGV2ZW50LmdldFVwZGF0ZWRPYmplY3RJZHMoKSk7CiAgICAgICAgICAgIHJl\nbW92ZUFsbEludGVybmFsKGV2ZW50LmdldERlbGV0ZWRPYmplY3RJZHMoKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHdoZW4g\nYSBrZXkgaXMgcmVtb3ZlZCBmcm9tIHRoaXMgY2FjaGUuIFByb3BhZ2F0ZXMg\ndGhlCiAgICAgKiBleHBpcmF0aW9uIGV2ZW50IG9uIHRvIGFsbCBleHBpcmF0\naW9uIGxpc3RlbmVycyByZWdpc3RlcmVkCiAgICAgKiB3aXRoIHRoaXMgY2xh\nc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGtleVJlbW92ZWQoT2Jq\nZWN0IGtleSwgYm9vbGVhbiBleHBpcmVkKSB7CiAgICAgICAgLy8gTm90aWZ5\nIGFueSBleHBpcmF0aW9uIGxpc3RlbmVycyBvZiB0aGUgZXhwaXJhdGlvbi4K\nICAgICAgICBpZiAoaGFzTGlzdGVuZXJzKCkpCiAgICAgICAgICAgIGZpcmVF\ndmVudChuZXcgRXhwaXJhdGlvbkV2ZW50KHRoaXMsIGtleSwgZXhwaXJlZCkp\nOwoKICAgICAgICBpZiAoZXhwaXJlZCAmJiBsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtZXhw\naXJlZCIsIGtleSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIDxj\nb2RlPnRydWU8L2NvZGU+IGlmIHVwZGF0ZXMgdG8gZGF0YSBhbHJlYWR5IGlu\nIHRoZQogICAgICogY2FjaGUgKGVpdGhlciBpbiB7QGxpbmsgI2NvbW1pdH0g\nb3IgdGhlIHtAbGluayAjdXBkYXRlfSkKICAgICAqIHNob3VsZCBiZSBwdXQg\nYmFjayBpbnRvIHRoZSBjYWNoZS4gUmV0dXJucyBmYWxzZSBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiByZWNhY2hlVXBkYXRl\ncygpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG9iamVjdCBmb3IgdGhlIGdpdmVuIG9pZC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IERhdGFDYWNoZVBDRGF0YSBn\nZXRJbnRlcm5hbChPYmplY3Qgb2lkKTsKCiAgICAvKioKICAgICAqIEFkZCB0\naGUgZ2l2ZW4gb2JqZWN0IHRvIHRoZSBjYWNoZSwgcmV0dXJuaW5nIHRoZSBv\nbGQgb2JqZWN0IHVuZGVyIHRoZQogICAgICogZ2l2ZW4gb2lkLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRGF0YUNhY2hlUENEYXRhIHB1dElu\ndGVybmFsKE9iamVjdCBvaWQsCiAgICAgICAgICAgIERhdGFDYWNoZVBDRGF0\nYSBwYyk7CiAgICAKICAgIC8qKgogICAgICogQWRkIGFsbCBvZiB0aGUgZ2l2\nZW4gb2JqZWN0cyB0byB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHB1dEFsbEludGVybmFsKENvbGxlY3Rpb248RGF0YUNhY2hlUENE\nYXRhPiBwY3MpIHsKICAgICAgICBmb3IgKERhdGFDYWNoZVBDRGF0YSBwYyA6\nIHBjcykgewogICAgICAgICAgICBpZiAoc3RhdHMuaXNFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgIHN0YXRzLm5ld1B1dChwYy5nZXRUeXBlKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHB1dEludGVybmFsKHBjLmdldElk\nKCksIHBjKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1v\ndmUgdGhlIG9iamVjdCB1bmRlciB0aGUgZ2l2ZW4gb2lkIGZyb20gdGhlIGNh\nY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRGF0YUNhY2hl\nUENEYXRhIHJlbW92ZUludGVybmFsKE9iamVjdCBvaWQpOwoKICAgIC8qKgog\nICAgICogRXZpY3Qgb2JqZWN0cyBpbiBjYWNoZSBieSBjbGFzcy4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IHZvaWQgcmVtb3ZlQWxsSW50ZXJu\nYWwoQ2xhc3M8Pz4gY2xzLCBib29sZWFuIHN1YmNsYXNzZXMpOwoKICAgIC8q\nKgogICAgICogUmVtb3ZlIGFsbCBvYmplY3RzIHVuZGVyIHRoZSBnaXZlbiBv\naWRzIGZyb20gdGhlIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCByZW1vdmVBbGxJbnRlcm5hbChDb2xsZWN0aW9uPE9iamVjdD4gb2lkcykg\newogICAgICAgIGZvciAoT2JqZWN0IG9pZCA6IG9pZHMpCiAgICAgICAgICAg\nIHJlbW92ZUludGVybmFsKG9pZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgYWxsIG9iamVjdHMgb2YgdGhlIGdpdmVuIGNsYXNzIG5hbWVzIGZy\nb20gdGhlIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZW1v\ndmVBbGxUeXBlTmFtZXNJbnRlcm5hbChDb2xsZWN0aW9uPFN0cmluZz4gY2xh\nc3NOYW1lcykgewogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IGNsYXNz\nZXMgPSBDYWNoZXMuYWRkVHlwZXNCeU5hbWUoY29uZiwgY2xhc3NOYW1lcywg\nbnVsbCk7CiAgICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBmb3IgKENsYXNzPD8+IGNscyA6IGNsYXNz\nZXMpIHsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcmVt\nb3ZlY2xhc3MiLCBjbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHJlbW92\nZUFsbEludGVybmFsKGNscywgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIENsZWFyIHRoZSBjYWNoZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGFic3RyYWN0IHZvaWQgY2xlYXJJbnRlcm5hbCgpOwoKICAgIC8q\nKgogICAgICogUGluIGFuIG9iamVjdCB0byB0aGUgY2FjaGUuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBhYnN0cmFjdCBib29sZWFuIHBpbkludGVybmFsKE9i\namVjdCBvaWQpOwoKICAgIC8qKgogICAgICogVW5waW4gYW4gb2JqZWN0IGZy\nb20gdGhlIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qg\nYm9vbGVhbiB1bnBpbkludGVybmFsKE9iamVjdCBvaWQpOwogICAgCiAgICAv\nKioKICAgICAqIAogICAgICovCiAgICBwdWJsaWMgRGF0YUNhY2hlIGdldFBh\ncnRpdGlvbihTdHJpbmcgbmFtZSwgYm9vbGVhbiBjcmVhdGUpIHsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKF9uYW1lLCBuYW1lKSkKICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiAKICAgICAqLwogICAgcHVibGljIFNldDxTdHJp\nbmc+IGdldFBhcnRpdGlvbk5hbWVzKCkgewogICAgICAgIHJldHVybiBDb2xs\nZWN0aW9ucy5lbXB0eVNldCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1BhcnRpdGlvbmVkKCkgewogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICBwdWJsaWMgQ2FjaGVTdGF0aXN0aWNzIGdldFN0YXRpc3Rp\nY3MoKSB7CiAgICAJcmV0dXJuIHN0YXRzOwogICAgfQoKICAgIC8vIC0tLS0t\nLS0tLS0gQ29uZmlndXJhYmxlIGltcGxlbWVudGF0aW9uIC0tLS0tLS0tLS0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRp\nb24gY29uZikgewogICAgICAgIHRoaXMuY29uZiA9IChPcGVuSlBBQ29uZmln\ndXJhdGlvbikgY29uZjsKICAgICAgICB0aGlzLmxvZyA9IGNvbmYuZ2V0TG9n\nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19EQVRBQ0FDSEUpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAg\nIGlmIChfbmFtZSA9PSBudWxsKQogICAgICAgICAgICBzZXROYW1lKE5BTUVf\nREVGQVVMVCk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLSBBYnN0cmFjdEV2\nZW50TWFuYWdlciBpbXBsZW1lbnRhdGlvbiAtLS0tLS0tLS0tCgogICAgcHJv\ndGVjdGVkIHZvaWQgZmlyZUV2ZW50KE9iamVjdCBldmVudCwgT2JqZWN0IGxp\nc3RlbmVyKSB7CiAgICAgICAgRXhwaXJhdGlvbkxpc3RlbmVyIGxpc3RlbiA9\nIChFeHBpcmF0aW9uTGlzdGVuZXIpIGxpc3RlbmVyOwogICAgICAgIEV4cGly\nYXRpb25FdmVudCBldiA9IChFeHBpcmF0aW9uRXZlbnQpIGV2ZW50OwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGxpc3Rlbi5vbkV4cGlyZShldik7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2Fy\nbihzX2xvYy5nZXQoImV4cC1saXN0ZW5lci1leCIpLCBlKTsKCQl9Cgl9CiAg\nICAKfQo=\n","encoding":"base64"}

