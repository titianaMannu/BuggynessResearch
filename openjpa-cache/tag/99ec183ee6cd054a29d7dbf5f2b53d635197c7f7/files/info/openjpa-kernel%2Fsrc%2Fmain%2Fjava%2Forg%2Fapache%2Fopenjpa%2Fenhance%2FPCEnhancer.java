{"sha":"d5a2c092d79f21f49ff86decf3c4ad8ec9bfe7c1","node_id":"MDQ6QmxvYjIwNjM2NDpkNWEyYzA5MmQ3OWYyMWY0OWZmODZkZWNmM2M0YWQ4ZWM5YmZlN2Mx","size":186839,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d5a2c092d79f21f49ff86decf3c4ad8ec9bfe7c1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJpZ0lu\ndGVnZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7\nCmltcG9ydCBqYXZhLnNlY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb247CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51\ndGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3Ry\naW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5j\nb25mLk9wZW5KUEFDb25maWd1cmF0aW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubWV0YS5DbGFzc0FyZ1BhcnNlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5CeXRlY29kZVdyaXRlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5GaWxlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuT3B0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5TZXJ2aWNlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXIu\nTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFjY2Vz\nc0NvZGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRh\nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZh\nbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRh\ndGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRvdWJsZUlk\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdHJp\nbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2Vy\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1w\nbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFzczsKaW1wb3J0\nIHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmllbGRJbnN0cnVj\ndGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlvbjsKaW1wb3J0\nIHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTG9h\nZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Mb29rdXBTd2l0\nY2hJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTWV0aG9kSW5z\ndHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLlRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb247CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLkNsYXNzSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJw\nLnV0aWwuTnVtYmVyczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoq\nCiAqIEJ5dGVjb2RlIGVuaGFuY2VyIHVzZWQgdG8gZW5oYW5jZSBwZXJzaXN0\nZW50IGNsYXNzZXMgZnJvbSBtZXRhZGF0YS4gVGhlCiAqIGVuaGFuY2VyIG11\nc3QgYmUgaW52b2tlZCBvbiBhbGwgcGVyc2lzdGVuY2UtY2FwYWJsZSBhbmQg\ncGVyc2lzdGVuY2UgYXdhcmUKICogY2xhc3Nlcy4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBQQ0VuaGFuY2VyIHsKICAgIC8v\nIERlc2lnbmF0ZXMgYSB2ZXJzaW9uIGZvciBtYWludGFpbmluZyBjb21wYXRi\naWxpdHkgd2hlbiBQQ0VuaGFuY2VyCiAgICAvLyBtb2RpZmllcyBlbmhhbmNl\nbWVudCB0aGF0IGNhbiBicmVhayBzZXJpYWxpemF0aW9uIG9yIG90aGVyIGNv\nbnRyYWN0cwogICAgLy8gRWFjaCBlbmhhbmNlZCBjbGFzcyB3aWxsIHJldHVy\nbiB0aGUgdmFsdWUgb2YgdGhpcyBmaWVsZCB2aWEKICAgIC8vIHB1YmxpYyBp\nbnQgZ2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb24oKQogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRVJfVkVSU0lPTiA9IDI7CiAgICAK\nICAgIGJvb2xlYW4gX2FkZFZlcnNpb25Jbml0RmxhZyA9IHRydWU7CgogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9OT05FID0gMDsKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VfQVdBUkUgPSAyIDw8\nIDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX0lOVEVS\nRkFDRSA9IDIgPDwgMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVO\nSEFOQ0VfUEMgPSAyIDw8IDI7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgUFJFID0gInBjIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3Ry\naW5nIElTREVUQUNIRURTVEFURURFRklOSVRJVkUgPSBQUkUgCiAgICAgICAg\nKyAiaXNEZXRhY2hlZFN0YXRlRGVmaW5pdGl2ZSI7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ2xhc3MgUENUWVBFID0gUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNNID0g\nUFJFICsgIlN0YXRlTWFuYWdlciI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBDbGFzcyBTTVRZUEUgPSBTdGF0ZU1hbmFnZXIuY2xhc3M7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgSU5IRVJJVCA9IFBSRSArICJJbmhl\ncml0ZWRGaWVsZENvdW50IjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0\ncmluZyBDT05URVhUTkFNRSA9ICJHZW5lcmljQ29udGV4dCI7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBVU0VSRVhDRVAgPSBVc2VyRXhjZXB0\naW9uLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSU5U\nRVJORVhDRVAgPSBJbnRlcm5hbEV4Y2VwdGlvbi5jbGFzczsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIENsYXNzIEhFTFBFUlRZUEUgPSBQQ1JlZ2lzdHJ5\nLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNVUEVS\nID0gUFJFICsgIlBDU3VwZXJjbGFzcyI7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBDbGFzcyBPSURGU1RZUEUgPSBGaWVsZFN1cHBsaWVyLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgT0lERkNUWVBFID0gRmll\nbGRDb25zdW1lci5jbGFzczsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgU3RyaW5nIFZFUlNJT05fSU5JVF9TVFIgPSAgUFJFICsgIlZlcnNpb25J\nbml0IjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFBDRW5oYW5jZXIu\nY2xhc3MpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFJFREVG\nSU5FRF9BVFRSSUJVVEUKICAgICAgICA9IFBDRW5oYW5jZXIuY2xhc3MuZ2V0\nTmFtZSgpICsgIiNyZWRlZmluZWQtdHlwZSI7CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIEF1eGlsaWFyeUVuaGFuY2VyW10gX2F1eEVuaGFuY2Vy\nczsKICAgIHN0YXRpYyB7CiAgICAgICAgQ2xhc3NbXSBjbGFzc2VzID0gU2Vy\ndmljZXMuZ2V0SW1wbGVtZW50b3JDbGFzc2VzKAogICAgICAgICAgICBBdXhp\nbGlhcnlFbmhhbmNlci5jbGFzcywKICAgICAgICAgICAgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhl\nbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihBdXhpbGlhcnlFbmhhbmNlci5j\nbGFzcykpKTsKICAgICAgICBMaXN0IGF1eEVuaGFuY2VycyA9IG5ldyBBcnJh\neUxpc3QoY2xhc3Nlcy5sZW5ndGgpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY2xhc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgYXV4RW5oYW5jZXJzLmFkZChBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjbGFzc2VzW2ldKSkpOwog\nICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAg\nICAgICAgLy8gYXV4IGVuaGFuY2VyIG1heSByZWx5IG9uIG5vbi1leGlzdGFu\ndCBzcGVjIGNsYXNzZXMsIGV0YwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIF9hdXhFbmhhbmNlcnMgPSAoQXV4aWxpYXJ5RW5oYW5jZXJbXSkg\nYXV4RW5oYW5jZXJzLnRvQXJyYXkKICAgICAgICAobmV3IEF1eGlsaWFyeUVu\naGFuY2VyW2F1eEVuaGFuY2Vycy5zaXplKCldKTsKICAgIH0KCiAgICBwcml2\nYXRlIEJDQ2xhc3MgX3BjOwogICAgcHJpdmF0ZSBmaW5hbCBCQ0NsYXNzIF9t\nYW5hZ2VkVHlwZTsKICAgIHByaXZhdGUgZmluYWwgTWV0YURhdGFSZXBvc2l0\nb3J5IF9yZXBvczsKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NNZXRhRGF0YSBf\nbWV0YTsKICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAgICBwcml2YXRl\nIENvbGxlY3Rpb24gX29pZHMgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9kZWZDb25zID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfcmVkZWZp\nbmUgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfc3ViY2xhc3MgPSBm\nYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfZmFpbCA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBTZXQgX3Zpb2xhdGlvbnMgPSBudWxsOwogICAgcHJpdmF0ZSBG\naWxlIF9kaXIgPSBudWxsOwogICAgcHJpdmF0ZSBCeXRlY29kZVdyaXRlciBf\nd3JpdGVyID0gbnVsbDsKICAgIHByaXZhdGUgTWFwIF9iYWNraW5nRmllbGRz\nID0gbnVsbDsgLy8gbWFwIG9mIHNldCAvIGdldCBuYW1lcyA9PiBmaWVsZCBu\nYW1lcwogICAgcHJpdmF0ZSBNYXAgX2F0dHJzVG9GaWVsZHMgPSBudWxsOyAv\nLyBtYXAgb2YgYXR0ciBuYW1lcyA9PiBmaWVsZCBuYW1lcwogICAgcHJpdmF0\nZSBNYXAgX2ZpZWxkc1RvQXR0cnMgPSBudWxsOyAvLyBtYXAgb2YgZmllbGQg\nbmFtZXMgPT4gYXR0ciBuYW1lcwogICAgcHJpdmF0ZSBib29sZWFuIF9pc0Fs\ncmVhZHlSZWRlZmluZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBf\naXNBbHJlYWR5U3ViY2xhc3NlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9iY3NDb25maWd1cmVkID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBD\nb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24gYW5kIHR5cGUgdG8g\nZW5oYW5jZS4gVGhpcyB3aWxsIGxvb2sKICAgICAqIHVwIHRoZSBtZXRhZGF0\nYSBmb3IgPGNvZGU+dHlwZTwvY29kZT4gZnJvbSA8Y29kZT5jb25mPC9jb2Rl\nPidzCiAgICAgKiByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgUENF\nbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFzcyB0eXBl\nKSB7CiAgICAgICAgdGhpcyhjb25mLCBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAubG9hZFByb2pl\nY3RDbGFzc0FjdGlvbihuZXcgUHJvamVjdCgpLCB0eXBlKSksCiAgICAgICAg\nICAgIChNZXRhRGF0YVJlcG9zaXRvcnkpIG51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uIGFu\nZCB0eXBlIHRvIGVuaGFuY2UuIFRoaXMgd2lsbCBsb29rCiAgICAgKiB1cCB0\naGUgbWV0YWRhdGEgZm9yIDxjb2RlPm1ldGE8L2NvZGU+IGJ5IGNvbnZlcnRp\nbmcgYmFjayB0byBhIGNsYXNzCiAgICAgKiBhbmQgdGhlbiBsb2FkaW5nIGZy\nb20gPGNvZGU+Y29uZjwvY29kZT4ncyByZXBvc2l0b3J5LgogICAgICovCiAg\nICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25m\nLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICB0aGlzKGNvbmYsIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAg\nICAgICAgICAgIC5sb2FkUHJvamVjdENsYXNzQWN0aW9uKG5ldyBQcm9qZWN0\nKCksIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSksCiAgICAgICAgICAgIG1l\ndGEuZ2V0UmVwb3NpdG9yeSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAqCiAgICAg\nKiBAcGFyYW0gdHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gZm8g\ndGhlIHR5cGUgdG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJlIGNyZWF0\nZWQgZnJvbSBhbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJhbSByZXBv\ncyBhIG1ldGFkYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRhZGF0YSBh\nY2Nlc3MsCiAgICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyByZXBvcml0\nb3J5OyB0aGUgcmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2ZW4gY29u\nZmlndXJhdGlvbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAqIGJlY2F1\nc2UgdGhlIGNvbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAqIGltcGxl\nbWVudGF0aW9uLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFkYXRhCiAg\nICAgKiByZXF1aXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFkYXRhIGZp\nbGVzCiAgICAgKiBAZGVwcmVjYXRlZCB1c2Uge0BsaW5rICNQQ0VuaGFuY2Vy\nKE9wZW5KUEFDb25maWd1cmF0aW9uLCBCQ0NsYXNzLAogICAgICAgIE1ldGFE\nYXRhUmVwb3NpdG9yeSwgQ2xhc3NMb2FkZXIpfSBpbnN0ZWFkLiAKICAgICAq\nLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24g\nY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9y\neSByZXBvcykgewogICAgICAgIHRoaXMoY29uZiwgdHlwZSwgcmVwb3MsIG51\nbGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBjb25maWd1cmF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRo\nZSBieXRlY29kZSByZXByZXNlbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAg\nICogZW5oYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJl\nYW0gb3IgZmlsZQogICAgICogQHBhcmFtIHJlcG9zIGEgbWV0YWRhdGEgcmVw\nb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFkYXRhIGFjY2VzcywKICAgICAqIG9y\nIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJlcG9yaXRvcnk7IHRoZSByZXBvc2l0\nb3J5CiAgICAgKiBmcm9tIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzbid0\nIHVzZWQgYnkgZGVmYXVsdAogICAgICogYmVjYXVzZSB0aGUgY29uZmlndXJh\ndGlvbiBtaWdodCBiZSBhbgogICAgICogaW1wbGVtZW50YXRpb24tc3BlY2lm\naWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRhdGEKICAgICAqIHJlcXVpcmVkIG1v\ncmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRhdGEgZmlsZXMKICAgICAqIEBwYXJh\nbSBsb2FkZXIgdGhlIGVudmlyb25tZW50IGNsYXNzbG9hZGVyIHRvIHVzZSBm\nb3IgbG9hZGluZwogICAgICogY2xhc3NlcyBhbmQgcmVzb3VyY2VzLgogICAg\nICovCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlv\nbiBjb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAgTWV0YURhdGFSZXBvc2l0\nb3J5IHJlcG9zLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfbWFu\nYWdlZFR5cGUgPSB0eXBlOwogICAgICAgIF9wYyA9IHR5cGU7CgogICAgICAg\nIF9sb2cgPSBjb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0df\nRU5IQU5DRSk7CgogICAgICAgIGlmIChyZXBvcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIF9yZXBvcyA9IGNvbmYubmV3TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgX3JlcG9zLnNldFNvdXJjZU1vZGUoTWV0\nYURhdGFSZXBvc2l0b3J5Lk1PREVfTUVUQSk7CiAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIF9tZXRhID0gX3Jl\ncG9zLmdldE1ldGFEYXRhKHR5cGUuZ2V0VHlwZSgpLCBsb2FkZXIsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkg\ncmVwb3NpdG9yeS4gVGhlIHJlcG9zaXRvcnkncyBjb25maWd1cmF0aW9uIHdp\nbGwKICAgICAqIGJlIHVzZWQsIGFuZCB0aGUgbWV0YWRhdGEgcGFzc2VkIGlu\nIHdpbGwgYmUgdXNlZCBhcy1pcyB3aXRob3V0IGRvaW5nCiAgICAgKiBhbnkg\nYWRkaXRpb25hbCBsb29rdXBzLiBUaGlzIGlzIHVzZWZ1bCB3aGVuIHJ1bm5p\nbmcgdGhlIGVuaGFuY2VyCiAgICAgKiBkdXJpbmcgbWV0YWRhdGEgbG9hZC4K\nICAgICAqCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBvc2l0\nb3J5IHRvIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAogICAgICogb3IgbnVs\nbCB0byBjcmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRvcnkK\nICAgICAqIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3QgdXNl\nZCBieSBkZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0aW9u\nIG1pZ2h0IGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZpYyBz\ndWJjbGFzcyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVxdWlyZWQgbW9yZSB0\naGFuIGp1c3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAgICogQHBhcmFtIHR5\ncGUgdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBlIHRv\nCiAgICAgKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20gYW55\nIHN0cmVhbSBvciBmaWxlCiAgICAgKiBAcGFyYW0gbWV0YSB0aGUgbWV0YWRh\ndGEgdG8gdXNlIGZvciBwcm9jZXNzaW5nIHRoaXMgdHlwZS4KICAgICAqCiAg\nICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVibGljIFBDRW5oYW5j\nZXIoTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zLCBCQ0NsYXNzIHR5cGUsCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgX21hbmFnZWRU\neXBlID0gdHlwZTsKICAgICAgICBfcGMgPSB0eXBlOwoKICAgICAgICBfbG9n\nID0gcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5nZXRM\nb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwoKICAgICAg\nICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfbWV0YSA9IG1ldGE7CiAgICB9\nCgogICAgc3RhdGljIFN0cmluZyB0b1BDU3ViY2xhc3NOYW1lKENsYXNzIGNs\ncykgewogICAgICAgIHJldHVybiBTdHJpbmdzLmdldFBhY2thZ2VOYW1lKFBD\nRW5oYW5jZXIuY2xhc3MpICsgIi4iCiAgICAgICAgICAgICsgY2xzLmdldE5h\nbWUoKS5yZXBsYWNlKCcuJywgJyQnKSArICIkcGNzdWJjbGFzcyI7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCA8Y29kZT5jbGFzc05h\nbWU8L2NvZGU+IGlzIHRoZSBuYW1lIGZvciBhCiAgICAgKiBkeW5hbWljYWxs\neS1jcmVhdGVkIHBlcnNpc3RlbmNlLWNhcGFibGUgc3ViY2xhc3MuCiAgICAg\nKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgYm9vbGVhbiBpc1BDU3ViY2xhc3NOYW1lKFN0cmluZyBjbGFzc05hbWUp\nIHsKICAgICAgICByZXR1cm4gY2xhc3NOYW1lLnN0YXJ0c1dpdGgoU3RyaW5n\ncy5nZXRQYWNrYWdlTmFtZShQQ0VuaGFuY2VyLmNsYXNzKSkKICAgICAgICAg\nICAgJiYgY2xhc3NOYW1lLmVuZHNXaXRoKCIkcGNzdWJjbGFzcyIpOwogICAg\nfQoKICAgIC8qKgogICAgICogSWYgPGNvZGU+Y2xhc3NOYW1lPC9jb2RlPiBp\ncyBhIGR5bmFtaWNhbGx5LWNyZWF0ZWQgcGVyc2lzdGVuY2UtY2FwYWJsZQog\nICAgICogc3ViY2xhc3MgbmFtZSwgcmV0dXJucyB0aGUgbmFtZSBvZiB0aGUg\nY2xhc3MgdGhhdCBpdCBzdWJjbGFzc2VzLgogICAgICogT3RoZXJ3aXNlLCBy\nZXR1cm5zIDxjb2RlPmNsYXNzTmFtZTwvY29kZT4uCiAgICAgKgogICAgICog\nQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5n\nIHRvTWFuYWdlZFR5cGVOYW1lKFN0cmluZyBjbGFzc05hbWUpIHsKICAgICAg\nICBpZiAoaXNQQ1N1YmNsYXNzTmFtZShjbGFzc05hbWUpKSB7CiAgICAgICAg\nICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS5zdWJzdHJpbmcoCiAgICAgICAg\nICAgICAgICBTdHJpbmdzLmdldFBhY2thZ2VOYW1lKFBDRW5oYW5jZXIuY2xh\nc3MpLmxlbmd0aCgpICsgMSk7CiAgICAgICAgICAgIGNsYXNzTmFtZSA9IGNs\nYXNzTmFtZS5zdWJzdHJpbmcoMCwgY2xhc3NOYW1lLmxhc3RJbmRleE9mKCIk\nIikpOwogICAgICAgICAgICAvLyB0aGlzIGlzIG5vdCBjb3JyZWN0IGZvciBu\nZXN0ZWQgUENzCiAgICAgICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS5y\nZXBsYWNlKCckJywgJy4nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\ncmV0dXJuIGNsYXNzTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0\ncnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbiwgdHlwZSwgYW5kIG1ldGFk\nYXRhLgogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29u\nZmlndXJhdGlvbiBjb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgdGhpcyhjb25mLCB0eXBlLCBtZXRh\nLmdldFJlcG9zaXRvcnkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwZXJzaXN0\nZW5jZS1jYXBhYmxlIGNsYXNzCiAgICAgKiBiZWluZyBtYW5pcHVsYXRlZC4K\nICAgICAqLwogICAgcHVibGljIEJDQ2xhc3MgZ2V0UENCeXRlY29kZSgpIHsK\nICAgICAgICByZXR1cm4gX3BjOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBieXRlY29kZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgbWFuYWdl\nZCBjbGFzcyBiZWluZwogICAgICogbWFuaXB1bGF0ZWQuIFRoaXMgaXMgdXN1\nYWxseSB0aGUgc2FtZSBhcyB7QGxpbmsgI2dldFBDQnl0ZWNvZGV9LAogICAg\nICogZXhjZXB0IHdoZW4gcnVubmluZyB0aGUgZW5oYW5jZXIgdG8gcmVkZWZp\nbmUgYW5kIHN1YmNsYXNzCiAgICAgKiBleGlzdGluZyBwZXJzaXN0ZW50IHR5\ncGVzLgogICAgICovCiAgICBwdWJsaWMgQkNDbGFzcyBnZXRNYW5hZ2VkVHlw\nZUJ5dGVjb2RlKCkgewogICAgICAgIHJldHVybiBfbWFuYWdlZFR5cGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0\naGUgY2xhc3MgYmVpbmcgbWFuaXB1bGF0ZWQsIG9yIG51bGwgaWYgbm90CiAg\nICAgKiBhIHBlcnNpc3RlbnQgdHlwZS4KICAgICAqLwogICAgcHVibGljIENs\nYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9t\nZXRhOwogICAgfQoKICAgIC8qKgogICAgICogQSBib29sZWFuIGluZGljYXRp\nbmcgd2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIGFkZCBhIG5vLWFyZ3MK\nICAgICAqIGNvbnN0cnVjdG9yIGlmIG9uZSBpcyBub3QgYWxyZWFkeSBwcmVz\nZW50IGluIHRoZSBjbGFzcy4gT3BlbkpQQQogICAgICogcmVxdWlyZXMgdGhh\ndCBhIG5vLWFyZyBjb25zdHJ1Y3RvciAod2hldGhlciBjcmVhdGVkIGJ5IHRo\nZSBjb21waWxlcgogICAgICogb3IgYnkgdGhlIHVzZXIpIGJlIHByZXNlbnQg\naW4gYSBQQy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0QWRkRGVm\nYXVsdENvbnN0cnVjdG9yKCkgewogICAgICAgIHJldHVybiBfZGVmQ29uczsK\nICAgIH0KCiAgICAvKioKICAgICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdo\nZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBhZGQgYSBuby1hcmdzCiAgICAg\nKiBjb25zdHJ1Y3RvciBpZiBvbmUgaXMgbm90IGFscmVhZHkgcHJlc2VudCBp\nbiB0aGUgY2xhc3MuIE9wZW5KUEEKICAgICAqIHJlcXVpcmVzIHRoYXQgYSBu\nby1hcmcgY29uc3RydWN0b3IgKHdoZXRoZXIgY3JlYXRlZCBieSB0aGUgY29t\ncGlsZXIKICAgICAqIG9yIGJ5IHRoZSB1c2VyKSBiZSBwcmVzZW50IGluIGEg\nUEMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEFkZERlZmF1bHRDb25z\ndHJ1Y3Rvcihib29sZWFuIGFkZERlZmF1bHRDb25zdHJ1Y3RvcikgewogICAg\nICAgIF9kZWZDb25zID0gYWRkRGVmYXVsdENvbnN0cnVjdG9yOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG11\ndGF0ZSBpdHMgYXJndW1lbnRzLCBvciBqdXN0IHJ1biB2YWxpZGF0aW9uCiAg\nICAgKiBhbmQgb3B0aW9uYWwgc3ViY2xhc3NpbmcgbG9naWMgb24gdGhlbS4g\nVXN1YWxseSB1c2VkIGluIGNvbmp1bmN0aW9uIHdpdGgKICAgICAqIDxjb2Rl\nPnNldENyZWF0ZVN1YmNsYXNzKHRydWUpPC9jb2RlPi4KICAgICAqCiAgICAg\nKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0\nUmVkZWZpbmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZWRlZmluZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBt\ndXRhdGUgaXRzIGFyZ3VtZW50cywgb3IganVzdCBydW4gdmFsaWRhdGlvbgog\nICAgICogYW5kIG9wdGlvbmFsIHN1YmNsYXNzaW5nIGxvZ2ljIG9uIHRoZW0u\nIFVzdWFsbHkgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoCiAgICAgKiA8Y29k\nZT5zZXRDcmVhdGVTdWJjbGFzcyh0cnVlKTwvY29kZT4uCiAgICAgKgogICAg\nICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJl\nZGVmaW5lKGJvb2xlYW4gcmVkZWZpbmUpIHsKICAgICAgICBfcmVkZWZpbmUg\nPSByZWRlZmluZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhl\nIHR5cGUgdGhhdCB0aGlzIGluc3RhbmNlIGlzIGVuaGFuY2luZyBoYXMgYWxy\nZWFkeSBiZWVuCiAgICAgKiByZWRlZmluZWQuCiAgICAgKgogICAgICogQHNp\nbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQWxyZWFk\neVJlZGVmaW5lZCgpIHsKICAgICAgICByZXR1cm4gX2lzQWxyZWFkeVJlZGVm\naW5lZDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUg\ndGhhdCB0aGlzIGluc3RhbmNlIGlzIGVuaGFuY2luZyBoYXMgYWxyZWFkeSBi\nZWVuCiAgICAgKiBzdWJjbGFzc2VkIGluIHRoaXMgaW5zdGFuY2UncyBlbnZp\ncm9ubWVudCBjbGFzc2xvYWRlci4KICAgICAqCiAgICAgKiBAc2luY2UgMS4w\nLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNBbHJlYWR5U3ViY2xh\nc3NlZCgpIHsKICAgICAgICByZXR1cm4gX2lzQWxyZWFkeVN1YmNsYXNzZWQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBz\naG91bGQgbWFrZSBpdHMgYXJndW1lbnRzIHBlcnNpc3RlbmNlLWNhcGFibGUs\nCiAgICAgKiBvciBnZW5lcmF0ZSBhIHBlcnNpc3RlbmNlLWNhcGFibGUgc3Vi\nY2xhc3MuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGdldENyZWF0ZVN1YmNsYXNzKCkgewogICAgICAg\nIHJldHVybiBfc3ViY2xhc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbWFrZSBpdHMgYXJndW1lbnRzIHBl\ncnNpc3RlbmNlLWNhcGFibGUsCiAgICAgKiBvciBnZW5lcmF0ZSBhIHBlcnNp\nc3RlbmNlLWNhcGFibGUgc3ViY2xhc3MuCiAgICAgKgogICAgICogQHNpbmNl\nIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENyZWF0ZVN1YmNs\nYXNzKGJvb2xlYW4gc3ViY2xhc3MpIHsKICAgICAgICBfc3ViY2xhc3MgPSBz\ndWJjbGFzczsKICAgICAgICBfYWRkVmVyc2lvbkluaXRGbGFnID0gZmFsc2U7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYgdGhl\nIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQKICAg\nICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJlIHZp\nb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyByZXN0\ncmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucygpIHsKICAgICAgICByZXR1cm4gX2Zh\naWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYg\ndGhlIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQK\nICAgICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJl\nIHZpb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyBy\nZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyhib29sZWFuIGZhaWwpIHsKICAgICAg\nICBfZmFpbCA9IGZhaWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhdGVk\nIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAgICAgKiBv\ndmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBudWxsLgog\nICAgICovCiAgICBwdWJsaWMgRmlsZSBnZXREaXJlY3RvcnkoKSB7CiAgICAg\nICAgcmV0dXJuIF9kaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhZWQg\nYmVuZWF0aCB0aGlzIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8KICAgICAqIG92\nZXJ3cml0aW5nIHRoZSBleGlzdGluZyBjbGFzcyBmaWxlIGlmIG51bGwuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERpcmVjdG9yeShGaWxlIGRpcikg\newogICAgICAgIF9kaXIgPSBkaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGN1cnJlbnQge0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3\ncml0ZSB0byBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBC\neXRlY29kZVdyaXRlciBnZXRCeXRlY29kZVdyaXRlcigpIHsKICAgICAgICBy\nZXR1cm4gX3dyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\ne0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3cml0ZSB0aGUgYnl0ZWNvZGUg\ndG8gb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCeXRlY29kZVdyaXRlcihCeXRlY29kZVdyaXRlciB3cml0ZXIpIHsKICAg\nICAgICBfd3JpdGVyID0gd3JpdGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nUGVyZm9ybSBieXRlY29kZSBlbmhhbmNlbWVudHMuCiAgICAgKgogICAgICog\nQHJldHVybiA8Y29kZT5FTkhBTkNFXyo8L2NvZGU+IGNvbnN0YW50CiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgcnVuKCkgewogICAgICAgIENsYXNzPD8+IHR5\ncGUgPSBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIGlmIG1hbmFnZWQgaW50ZXJmYWNlLCBza2lwCiAgICAg\nICAgICAgIGlmIChfcGMuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBFTkhBTkNFX0lOVEVSRkFDRTsKCiAgICAgICAgICAgIC8vIGNo\nZWNrIGlmIGFscmVhZHkgZW5oYW5jZWQKICAgICAgICAgICAgQ2xhc3NMb2Fk\nZXIgbG9hZGVyID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24odHlwZSkpOwogICAg\nICAgICAgICBmb3IgKENsYXNzPD8+IGlmYWNlIDogX21hbmFnZWRUeXBlLmdl\ndERlY2xhcmVkSW50ZXJmYWNlVHlwZXMoKSkgewogICAgICAgICAgICAgICAg\naWYgKGlmYWNlLmdldE5hbWUoKS5lcXVhbHMoUENUWVBFLmdldE5hbWUoKSkp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoInBjLXR5cGUiLCB0eXBlLCBsb2FkZXIpKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0Vf\nTk9ORTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLXN0YXJ0IiwgdHlw\nZSwgbG9hZGVyKSk7CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICBjb25m\naWd1cmVCQ3MoKTsKCiAgICAgICAgICAgIC8vIHZhbGlkYXRlIHByb3BlcnRp\nZXMgYmVmb3JlIHJlcGxhY2luZyBmaWVsZCBhY2Nlc3Mgc28gdGhhdAogICAg\nICAgICAgICAvLyB3ZSBidWlsZCB1cCBhIHJlY29yZCBvZiBiYWNraW5nIGZp\nZWxkcywgZXRjCiAgICAgICAgICAgIGlmIChpc1Byb3BlcnR5QWNjZXNzKF9t\nZXRhKSkgewogICAgICAgICAgICAgICAgdmFsaWRhdGVQcm9wZXJ0aWVzKCk7\nCiAgICAgICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAg\nICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGVUcmFuc2xhdGlvbigpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0ZUZp\nZWxkQWNjZXNzKCk7CiAgICAgICAgICAgIHByb2Nlc3NWaW9sYXRpb25zKCk7\nCgogICAgICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgZW5oYW5jZUNsYXNzKCk7CiAgICAgICAgICAgICAgICBhZGRGaWVs\nZHMoKTsKICAgICAgICAgICAgICAgIGFkZFN0YXRpY0luaXRpYWxpemVyKCk7\nCiAgICAgICAgICAgICAgICBhZGRQQ01ldGhvZHMoKTsKICAgICAgICAgICAg\nICAgIGFkZEFjY2Vzc29ycygpOwogICAgICAgICAgICAgICAgYWRkQXR0YWNo\nRGV0YWNoQ29kZSgpOwogICAgICAgICAgICAgICAgYWRkU2VyaWFsaXphdGlv\nbkNvZGUoKTsKICAgICAgICAgICAgICAgIGFkZENsb25pbmdDb2RlKCk7CiAg\nICAgICAgICAgICAgICBydW5BdXhpbGlhcnlFbmhhbmNlcnMoKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBFTkhBTkNFX1BDOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoInBlcnMtYXdhcmUiLCB0eXBl\nLCBsb2FkZXIpKTsKICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfQVdBUkU7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihf\nbG9jLmdldCgiZW5oYW5jZS1lcnJvciIsCiAgICAgICAgICAgICAgICB0eXBl\nLmdldE5hbWUoKSwgZS5nZXRNZXNzYWdlKCkpLCBlKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIGNvbmZpZ3VyZUJDcygpIHsKICAgICAg\nICBpZiAoIV9iY3NDb25maWd1cmVkKSB7CiAgICAgICAgICAgIGlmIChnZXRS\nZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX21hbmFnZWRUeXBl\nLmdldEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRFKSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5hZGRBdHRyaWJ1dGUo\nUkVERUZJTkVEX0FUVFJJQlVURSk7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgX2lzQWxyZWFkeVJlZGVmaW5lZCA9IHRydWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJj\nbGFzcygpKSB7CiAgICAgICAgICAgICAgICBQQ1N1YmNsYXNzVmFsaWRhdG9y\nIHZhbCA9IG5ldyBQQ1N1YmNsYXNzVmFsaWRhdG9yKAogICAgICAgICAgICAg\nICAgICAgIF9tZXRhLCBfbWFuYWdlZFR5cGUsIF9sb2csIF9mYWlsKTsKICAg\nICAgICAgICAgICAgIHZhbC5hc3NlcnRDYW5TdWJjbGFzcygpOwoKICAgICAg\nICAgICAgICAgIF9wYyA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkubG9h\nZENsYXNzKAogICAgICAgICAgICAgICAgICAgIHRvUENTdWJjbGFzc05hbWUo\nX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwogICAgICAgICAgICAgICAgaWYg\nKF9wYy5nZXRTdXBlcmNsYXNzQkMoKSAhPSBfbWFuYWdlZFR5cGUpIHsKICAg\nICAgICAgICAgICAgICAgICBfcGMuc2V0U3VwZXJjbGFzcyhfbWFuYWdlZFR5\ncGUpOwogICAgICAgICAgICAgICAgICAgIF9wYy5zZXRBYnN0cmFjdChfbWFu\nYWdlZFR5cGUuaXNBYnN0cmFjdCgpKTsKICAgICAgICAgICAgICAgICAgICBf\ncGMuZGVjbGFyZUludGVyZmFjZShEeW5hbWljUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgX2lzQWxyZWFkeVN1YmNsYXNzZWQgPSB0cnVlOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBfYmNzQ29u\nZmlndXJlZCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogV3JpdGUgdGhlIGdlbmVyYXRlZCBieXRlY29kZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgcmVjb3JkKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGlmIChfbWFuYWdlZFR5cGUgIT0gX3BjICYmIGdldFJl\nZGVmaW5lKCkpCiAgICAgICAgICAgIHJlY29yZChfbWFuYWdlZFR5cGUpOwog\nICAgICAgIHJlY29yZChfcGMpOwogICAgICAgIGlmIChfb2lkcyAhPSBudWxs\nKQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9vaWRzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgcmVjb3Jk\nKChCQ0NsYXNzKSBpdHIubmV4dCgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdyaXRlIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHJlY29yZChCQ0NsYXNzIGJjKQogICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKF93cml0ZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgX3dyaXRlci53cml0ZShiYyk7CiAgICAgICAgZWxzZSBpZiAoX2RpciA9\nPSBudWxsKQogICAgICAgICAgICBiYy53cml0ZSgpOwogICAgICAgIGVsc2Ug\newogICAgICAgICAgICBGaWxlIGRpciA9IEZpbGVzLmdldFBhY2thZ2VGaWxl\nKF9kaXIsIGJjLmdldFBhY2thZ2VOYW1lKCksIHRydWUpOwogICAgICAgICAg\nICBiYy53cml0ZShuZXcgRmlsZShkaXIsIGJjLmdldENsYXNzTmFtZSgpICsg\nIi5jbGFzcyIpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBW\nYWxpZGF0ZSB0aGF0IHRoZSBtZXRob2RzIHRoYXQgdXNlIGEgcHJvcGVydHkt\nYWNjZXNzIGluc3RhbmNlIGFyZQogICAgICogd3JpdHRlbiBjb3JyZWN0bHku\nIFRoaXMgbWV0aG9kIGFsc28gZ2F0aGVycyBpbmZvcm1hdGlvbiBvbiBlYWNo\nCiAgICAgKiBwcm9wZXJ0eSdzIGJhY2tpbmcgZmllbGQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCB2YWxpZGF0ZVByb3BlcnRpZXMoKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHM7CiAgICAgICAgaWYgKGdldENyZWF0ZVN1\nYmNsYXNzKCkpCiAgICAgICAgICAgIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMo\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZtZHMgPSBfbWV0YS5nZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIE1ldGhvZCBtZXRoOwogICAgICAg\nIEJDTWV0aG9kIGdldHRlciwgc2V0dGVyOwogICAgICAgIEJDRmllbGQgcmV0\ndXJuZWQsIGFzc2lnbmVkID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKCiAgICAgICAgICAgIGlmICgh\nKGZtZHNbaV0uZ2V0QmFja2luZ01lbWJlcigpIGluc3RhbmNlb2YgTWV0aG9k\nKSApIHsKICAgICAgICAgICAgICAgIC8vIElmIG5vdCBtaXhlZCBhY2Nlc3Mg\naXMgbm90IGRlZmluZWQsIGZsYWcgdGhlIGZpZWxkIG1lbWJlcnMsIAogICAg\nICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGRvIG5vdCBwcm9jZXNzIHRoZW0g\nYmVjYXVzZSB0aGV5IGFyZSB2YWxpZAogICAgICAgICAgICAgICAgLy8gcGVy\nc2lzdGVudCBhdHRyaWJ1dGVzLgogICAgICAgICAgICAgICAgaWYgKCFfbWV0\nYS5pc01peGVkQWNjZXNzKCkpIHsKICAgICAgICAgICAgICAgICAgICBhZGRW\naW9sYXRpb24oInByb3BlcnR5LWJhZC1tZW1iZXIiLAogICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IGZtZHNbaV0sIGZtZHNbaV0uZ2V0\nQmFja2luZ01lbWJlcigpIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRy\ndWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG1l\ndGggPSAoTWV0aG9kKSBmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKTsKICAg\nICAgICAgICAgLy8gIyMjIyMgdGhpcyB3aWxsIGZhaWwgaWYgd2Ugb3ZlcnJp\nZGUgYW5kIGRvbid0IGNhbGwgc3VwZXIuCiAgICAgICAgICAgIEJDQ2xhc3Mg\nZGVjbGFyaW5nVHlwZSA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkKICAg\nICAgICAgICAgICAgIC5sb2FkQ2xhc3MoZm1kc1tpXS5nZXREZWNsYXJpbmdU\neXBlKCkpOwogICAgICAgICAgICBnZXR0ZXIgPSBkZWNsYXJpbmdUeXBlLmdl\ndERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICAgICAgaWYg\nKGdldHRlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBhZGRWaW9sYXRp\nb24oInByb3BlcnR5LW5vLWdldHRlciIsIG5ldyBPYmplY3RbXXsgZm1kc1tp\nXSB9LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nZWQgPSBnZXRSZXR1cm5lZEZpZWxkKGdldHRlcik7CiAgICAgICAgICAgIGlm\nIChyZXR1cm5lZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcmVnaXN0ZXJC\nYWNraW5nRmllbGRJbmZvKGZtZHNbaV0sIGdldHRlciwgcmV0dXJuZWQpOwoK\nICAgICAgICAgICAgc2V0dGVyID0gZGVjbGFyaW5nVHlwZS5nZXREZWNsYXJl\nZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNbaV0pLAogICAgICAgICAgICAg\nICAgbmV3IENsYXNzW117IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkgfSk7\nCiAgICAgICAgICAgIGlmIChzZXR0ZXIgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgaWYgKHJldHVybmVkID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LW5vLXNldHRlciIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1kc1tpXSB9LCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBjcmVhdGUgc3ludGhldGljIHNldHRlcgogICAgICAg\nICAgICAgICAgICAgIHNldHRlciA9IF9tYW5hZ2VkVHlwZS5kZWNsYXJlTWV0\naG9kKGdldFNldHRlck5hbWUoZm1kc1tpXSksCiAgICAgICAgICAgICAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICAgICAgICAgIHNldHRlci5t\nYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICAgICAgICAgIENvZGUgY29kZSA9\nIHNldHRlci5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS54bG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUucHV0ZmllbGQoKS5zZXRGaWVsZChyZXR1cm5lZCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGFzc2lnbmVkID0gZ2V0QXNzaWduZWRGaWVs\nZChzZXR0ZXIpOwoKICAgICAgICAgICAgaWYgKGFzc2lnbmVkICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICByZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oZm1kc1tp\nXSwgc2V0dGVyLCBhc3NpZ25lZCk7CgogICAgICAgICAgICAgICAgaWYgKGFz\nc2lnbmVkICE9IHJldHVybmVkKQogICAgICAgICAgICAgICAgICAgIGFkZFZp\nb2xhdGlvbigicHJvcGVydHktc2V0dGVyLWdldHRlci1taXNtYXRjaCIsIG5l\ndyBPYmplY3RbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGZtZHNbaV0s\nIGFzc2lnbmVkLmdldE5hbWUoKSwgKHJldHVybmVkID09IG51bGwpIAogICAg\nICAgICAgICAgICAgICAgICAgICA/IG51bGwgOiByZXR1cm5lZC5nZXROYW1l\nKCkgfSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgdm9pZCByZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oRmll\nbGRNZXRhRGF0YSBmbWQsIEJDTWV0aG9kIG1ldGhvZCwKICAgICAgICBCQ0Zp\nZWxkIGZpZWxkKSB7CiAgICAgICAgaWYgKF9iYWNraW5nRmllbGRzID09IG51\nbGwpCiAgICAgICAgICAgIF9iYWNraW5nRmllbGRzID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICBfYmFja2luZ0ZpZWxkcy5wdXQobWV0aG9kLmdldE5hbWUo\nKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAgaWYgKF9hdHRyc1RvRmll\nbGRzID09IG51bGwpCiAgICAgICAgICAgIF9hdHRyc1RvRmllbGRzID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBfYXR0cnNUb0ZpZWxkcy5wdXQoZm1kLmdl\ndE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAgaWYgKF9maWVs\nZHNUb0F0dHJzID09IG51bGwpCiAgICAgICAgICAgIF9maWVsZHNUb0F0dHJz\nID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfZmllbGRzVG9BdHRycy5wdXQo\nZmllbGQuZ2V0TmFtZSgpLCBmbWQuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24oKSB7CgogICAg\nICAgIC8vIEdldCBhbGwgZmllbGQgbWV0YWRhdGEKICAgICAgICBBcnJheUxp\nc3Q8SW50ZWdlcj4gcHJvcEZtZHMgPSBuZXcgQXJyYXlMaXN0PEludGVnZXI+\nKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRG\naWVsZHMoKTsKCiAgICAgICAgaWYgKF9tZXRhLmlzTWl4ZWRBY2Nlc3MoKSkg\newogICAgICAgICAgICAvLyBTdG9yZXMgaW5kZXhlcyBvZiBwcm9wZXJ0eSBh\nY2Nlc3MgZmllbGRzIHRvIGJlIHVzZWQgaW4KICAgICAgICAgICAgLy8gCiAg\nICAgICAgICAgIHByb3BGbWRzID0gbmV3IEFycmF5TGlzdDxJbnRlZ2VyPigp\nOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNo\nIGZpZWxkcyBoYXZlIHByb3BlcnR5IGFjY2VzcyBhbmQgc2F2ZSB0aGVpciAK\nICAgICAgICAgICAgLy8gaW5kZXhlcwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nIGlmIChpc1Byb3BlcnR5QWNjZXNzKGZtZHNbaV0pKQogICAgICAgICAgICAg\nICAgICAgIHByb3BGbWRzLmFkZChpKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gaWYgbm8gZmllbGRzIGhhdmUgcHJvcGVydHkgYWNjZXNzIGRv\nIG5vdCBkbyBhdHRyaWJ1dGUgdHJhbnNsYXRpb24KICAgICAgICAgICAgaWYg\nKHByb3BGbWRzLnNpemUoKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoQXR0\ncmlidXRlVHJhbnNsYXRvci5jbGFzcyk7CiAgICAgICAgQkNNZXRob2QgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkF0dHJpYnV0ZUluZGV4\nVG9GaWVsZE5hbWUiLAogICAgICAgICAgICBTdHJpbmcuY2xhc3MsIG5ldyBD\nbGFzc1tdIHsgaW50LmNsYXNzIH0pOwogICAgICAgIG1ldGhvZC5tYWtlUHVi\nbGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgIGNvZGUuaWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBpZiAoIV9tZXRhLmlzTWl4ZWRB\nY2Nlc3MoKSkgewogICAgICAgICAgICAvLyBpZiBub3QgbWl4ZWQgYWNjZXNz\nIHVzZSBhIHRhYmxlIHN3aXRjaCBvbiBhbGwgcHJvcGVydHktYmFzZWQgZm1k\nLgogICAgICAgICAgICAvLyBhIHRhYmxlIHN3aXRjaCBpcyBtb3JlIGVmZmlj\naWVudCB3aXRoICsxIGluY3JlbWVudGFsIG9wZXJhdGlvbnMKICAgICAgICAg\nICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxl\nc3dpdGNoKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0YWJpbnMuc2V0\nTG93KDApOwogICAgICAgICAgICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0\naCAtIDEpOwoKICAgICAgICAgICAgLy8gY2FzZSBpOgogICAgICAgICAgICAv\nLyAgICAgcmV0dXJuIDxfYXR0cnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5nZXRO\nYW1lKCkpPgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJn\nZXQoY29kZS5jb25zdGFudCgpLnNldFZhbHVlKAogICAgICAgICAgICAgICAg\nICAgIF9hdHRyc1RvRmllbGRzLmdldChmbWRzW2ldLmdldE5hbWUoKSkpKTsK\nICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICB9\nICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5l\ndyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAgdGFi\naW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAg\nICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3Mp\nKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIElu\nIG1peGVkIGFjY2VzcyBtb2RlLCBwcm9wZXJ0eSBpbmRleGVzIGFyZSBub3Qg\nKzEgaW5jcmVtZW50YWwgCiAgICAgICAgICAgIC8vIGEgbG9va3VwIHN3aXRj\naCBtdXN0IGJlIHVzZWQgdG8gZG8gaW5kZXhlZCBsb29rdXAuCiAgICAgICAg\nICAgIExvb2t1cFN3aXRjaEluc3RydWN0aW9uIGxvb2t1cGlucyA9IGNvZGUu\nbG9va3Vwc3dpdGNoKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3Ig\nKEludGVnZXIgaSA6IHByb3BGbWRzKSB7CiAgICAgICAgICAgICAgICBsb29r\ndXBpbnMuYWRkQ2FzZShpLAogICAgICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSgKICAgICAgICAgICAgICAgICAgICBfYXR0cnNU\nb0ZpZWxkcy5nZXQoZm1kc1tpXS5nZXROYW1lKCkpKSk7CiAgICAgICAgICAg\nICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgfSAgICAgICAgICAg\nIAogICAgICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgICAgIGxvb2t1cGlucy5zZXRE\nZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAgICAgICAo\nY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBzZXR0ZXIg\nbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIFN0cmluZyBnZXRTZXR0ZXJOYW1lKEZpZWxkTWV0YURhdGEg\nZm1kKSB7CiAgICAgICAgcmV0dXJuICJzZXQiICsgU3RyaW5nVXRpbHMuY2Fw\naXRhbGl6ZShmbWQuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZmllbGQgcmV0dXJuZWQgYnkgdGhlIGdpdmVuIG1ldGhv\nZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2FnZS1wcm90ZWN0ZWQg\nYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAgc3RhdGljIEJD\nRmllbGQgZ2V0UmV0dXJuZWRGaWVsZChCQ01ldGhvZCBtZXRoKSB7CiAgICAg\nICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0Nv\nZGVBY3Rpb24oKSkpLnhyZXR1cm4oKQogICAgICAgICAgICAuc2V0VHlwZSht\nZXRoLmdldFJldHVyblR5cGUoKSksIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZmllbGQgYXNzaWduZWQgaW4gdGhlIGdpdmVu\nIG1ldGhvZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2FnZS1wcm90\nZWN0ZWQgYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAgc3Rh\ndGljIEJDRmllbGQgZ2V0QXNzaWduZWRGaWVsZChCQ01ldGhvZCBtZXRoKSB7\nCiAgICAgICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLm5ld0NvZGVBY3Rpb24oKSkpLnB1dGZpZWxkKCksIHRydWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCByZXR1cm5lZCAvIGFz\nc2lnbmVkIGJ5IDxjb2RlPm1ldGg8L2NvZGU+LiBSZXR1cm5zCiAgICAgKiBu\ndWxsIGlmIG5vbi1maWVsZHMgKG1ldGhvZHMsIGxpdGVyYWxzLCBwYXJhbWV0\nZXJzLCB2YXJpYWJsZXMpIGFyZQogICAgICogcmV0dXJuZWQsIG9yIGlmIG5v\nbi1wYXJhbWV0ZXJzIGFyZSBhc3NpZ25lZCB0byBmaWVsZHMuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIEJDRmllbGQgZmluZEZpZWxkKEJDTWV0aG9k\nIG1ldGgsIEluc3RydWN0aW9uIHRlbXBsYXRlLAogICAgICAgIGJvb2xlYW4g\nZmluZEFjY2Vzc2VkKSB7CiAgICAgICAgLy8gaWdub3JlIGFueSBzdGF0aWMg\nbWV0aG9kcy4gT3BlbkpQQSBvbmx5IGN1cnJlbnRseSBzdXBwb3J0cwogICAg\nICAgIC8vIG5vbi1zdGF0aWMgc2V0dGVycyBhbmQgZ2V0dGVycwogICAgICAg\nIGlmIChtZXRoLmlzU3RhdGljKCkpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUoZmFsc2UpOwog\nICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgQkNG\naWVsZCBmaWVsZCA9IG51bGwsIGN1cjsKICAgICAgICBJbnN0cnVjdGlvbiB0\nZW1wbGF0ZUlucywgcHJldklucywgZWFybGllckluczsKICAgICAgICB3aGls\nZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewogICAgICAgICAg\nICBpbnQgYmFja3VwQ291bnQgPSAzOwogICAgICAgICAgICB0ZW1wbGF0ZUlu\ncyA9IGNvZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgaWYgKCFjb2RlLmhh\nc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICAgICAgcHJldklucyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAg\nICAgIGlmIChwcmV2SW5zIGluc3RhbmNlb2YgQ2xhc3NJbnN0cnVjdGlvbgog\nICAgICAgICAgICAgICAgJiYgY29kZS5oYXNQcmV2aW91cygpKSB7CiAgICAg\nICAgICAgICAgICBwcmV2SW5zID0gY29kZS5wcmV2aW91cygpOwogICAgICAg\nICAgICAgICAgYmFja3VwQ291bnQrKzsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZWFybGllcklucyA9IGNvZGUu\ncHJldmlvdXMoKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBvcGNvZGUgdHdv\nIGJlZm9yZSB0aGUgdGVtcGxhdGUgd2FzIGFuIGFsb2FkXzAsIGNoZWNrCiAg\nICAgICAgICAgIC8vIGFnYWluc3QgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiBi\nYXNlZCBvbiB3aGF0IHR5cGUgb2YgZmluZAogICAgICAgICAgICAvLyB3ZSdy\nZSBkb2luZwogICAgICAgICAgICBpZiAoIShlYXJsaWVySW5zIGluc3RhbmNl\nb2YgTG9hZEluc3RydWN0aW9uKQogICAgICAgICAgICAgICAgfHwgISgoTG9h\nZEluc3RydWN0aW9uKSBlYXJsaWVySW5zKS5pc1RoaXMoKSkKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG1p\nZGRsZSBpbnN0cnVjdGlvbiB3YXMgYSBnZXRmaWVsZCwgdGhlbiBpdCdzIHRo\nZQogICAgICAgICAgICAvLyBmaWVsZCB0aGF0J3MgYmVpbmcgYWNjZXNzZWQK\nICAgICAgICAgICAgaWYgKCFmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0\nYW5jZW9mIEdldEZpZWxkSW5zdHJ1Y3Rpb24pIHsKICAgICAgICAgICAgICAg\nIGZpbmFsIEZpZWxkSW5zdHJ1Y3Rpb24gZlByZXZJbnMgPSAoRmllbGRJbnN0\ncnVjdGlvbikgcHJldkluczsKICAgICAgICAgICAgICAgIGN1ciA9IEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAg\nIEoyRG9Qcml2SGVscGVyLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVsZEFjdGlv\nbihmUHJldklucykpOwogICAgICAgICAgICAgICAgLy8gaWYgdGhlIG1pZGRs\nZSBpbnN0cnVjdGlvbiB3YXMgYW4geGxvYWRfMSwgdGhlbiB0aGUKICAgICAg\nICAgICAgICAgIC8vIG1hdGNoZWQgaW5zdHJ1Y3Rpb24gaXMgdGhlIGZpZWxk\nIHRoYXQncyBiZWluZyBzZXQuCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlu\nZEFjY2Vzc2VkICYmIHByZXZJbnMgaW5zdGFuY2VvZiBMb2FkSW5zdHJ1Y3Rp\nb24KICAgICAgICAgICAgICAgICYmICgoTG9hZEluc3RydWN0aW9uKSBwcmV2\nSW5zKS5nZXRQYXJhbSgpID09IDApIHsKICAgICAgICAgICAgICAgIGZpbmFs\nIEZpZWxkSW5zdHJ1Y3Rpb24gZlRlbXBsYXRlSW5zID0KICAgICAgICAgICAg\nICAgICAgICAoRmllbGRJbnN0cnVjdGlvbikgdGVtcGxhdGVJbnM7CiAgICAg\nICAgICAgICAgICBjdXIgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgICAgIC5nZXRGaWVs\nZEluc3RydWN0aW9uRmllbGRBY3Rpb24oZlRlbXBsYXRlSW5zKSk7CiAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBjdXIgIT0gZmllbGQp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZmll\nbGQgPSBjdXI7CgogICAgICAgICAgICAvLyByZWFkeSBmb3IgbmV4dCBzZWFy\nY2ggaXRlcmF0aW9uCiAgICAgICAgICAgIHdoaWxlIChiYWNrdXBDb3VudCA+\nIDApIHsKICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAg\nICAgICAgYmFja3VwQ291bnQtLTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZmllbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWNvcmQgYSB2aW9sYXRpb24gb2YgdGhlIHByb3BlcnR5IGFjY2VzcyByZXN0\ncmljdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRWaW9sYXRp\nb24oU3RyaW5nIGtleSwgT2JqZWN0W10gYXJncywgYm9vbGVhbiBmYXRhbCkg\newogICAgICAgIGlmIChfdmlvbGF0aW9ucyA9PSBudWxsKQogICAgICAgICAg\nICBfdmlvbGF0aW9ucyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgX3Zpb2xh\ndGlvbnMuYWRkKF9sb2MuZ2V0KGtleSwgYXJncykpOwogICAgICAgIF9mYWls\nIHw9IGZhdGFsOwogICAgfQoKICAgIC8qKgogICAgICogTG9nIC8gdGhyb3cg\ncmVjb3JkZWQgcHJvcGVydHkgYWNjZXNzIHZpb2xhdGlvbnMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwcm9jZXNzVmlvbGF0aW9ucygpIHsKICAgICAg\nICBpZiAoX3Zpb2xhdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBTdHJpbmcgc2VwID0gSjJEb1ByaXZIZWxwZXIuZ2V0TGlu\nZVNlcGFyYXRvcigpOwogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3\nIFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIF92aW9sYXRpb25zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoaXRyLm5leHQoKSk7CiAgICAgICAgICAg\nIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZChzZXApOwogICAgICAgIH0KICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2Mu\nZ2V0KCJwcm9wZXJ0eS12aW9sYXRpb25zIiwgYnVmKTsKCiAgICAgICAgaWYg\nKF9mYWlsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbiht\nc2cpOwogICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAg\nICAgICAgX2xvZy53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXBsYWNlZCBhbGwgZGlyZWN0IGFjY2VzcyB0byBtYW5hZ2VkIGZpZWxkcyB3\naXRoIHRoZSBhcHByb3ByaWF0ZQogICAgICogcGNHZXQvcGNTZXQgbWV0aG9k\nLiBOb3RlIHRoYXQgdGhpcyBpbmNsdWRlcyBhY2Nlc3MgdG8gZmllbGRzCiAg\nICAgKiBvd25lZCBieSBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3NlcyBvdGhl\nciB0aGFuIHRoaXMgb25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVw\nbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKSB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgcHV0\nZmllbGQvZ2V0ZmllbGQgaW5zdHJ1Y3Rpb25zIHRvIHNlYXJjaCBmb3IKICAg\nICAgICBDb2RlIHRlbXBsYXRlID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rp\nb24oKSk7CiAgICAgICAgSW5zdHJ1Y3Rpb24gcHV0ID0gdGVtcGxhdGUucHV0\nZmllbGQoKTsKICAgICAgICBJbnN0cnVjdGlvbiBnZXQgPSB0ZW1wbGF0ZS5n\nZXRmaWVsZCgpOwogICAgICAgIEluc3RydWN0aW9uIHN0YXQgPSB0ZW1wbGF0\nZS5pbnZva2VzdGF0aWMoKTsKCiAgICAgICAgLy8gbG9vayB0aHJvdWdoIGFs\nbCBtZXRob2RzOyB0aGlzIGlzIGRvbmUgYmVmb3JlIGFueSBtZXRob2RzIGFy\nZSBhZGRlZAogICAgICAgIC8vIHNvIHdlIGRvbid0IG5lZWQgdG8gd29ycnkg\nYWJvdXQgZXhjbHVkaW5nIHN5bnRoZXRpYyBtZXRob2RzLgogICAgICAgIEJD\nTWV0aG9kW10gbWV0aG9kcyA9IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZE1l\ndGhvZHMoKTsKICAgICAgICBDb2RlIGNvZGU7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBtZXRob2RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGNvZGUgPSBtZXRob2RzW2ldLmdldENvZGUoZmFsc2UpOwoKICAgICAgICAg\nICAgLy8gZG9uJ3QgbW9kaWZ5IHRoZSBtZXRob2RzIHNwZWNpZmllZCBieSB0\naGUgYXV4aWxpYXJ5IGVuaGFuY2VycwogICAgICAgICAgICBpZiAoY29kZSAh\nPSBudWxsICYmICFza2lwRW5oYW5jZShtZXRob2RzW2ldKSkgewogICAgICAg\nICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoY29kZSwg\nZ2V0LCB0cnVlLCBzdGF0KTsKICAgICAgICAgICAgICAgIHJlcGxhY2VBbmRW\nYWxpZGF0ZUZpZWxkQWNjZXNzKGNvZGUsIHB1dCwgZmFsc2UsIHN0YXQpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmVwbGFjZXMgYWxsIGluc3RydWN0aW9ucyBtYXRjaGluZyB0aGUgZ2l2ZW4g\ndGVtcGxhdGUgaW4gdGhlIGdpdmVuCiAgICAgKiBjb2RlIGJsb2NrIHdpdGgg\nY2FsbHMgdG8gdGhlIGFwcHJvcHJpYXRlIGdlbmVyYXRlZCBnZXR0ZXIvc2V0\ndGVyLgogICAgICoKICAgICAqIEBwYXJhbSBjb2RlIHRoZSBjb2RlIGJsb2Nr\nIHRvIG1vZGlmeTsgdGhlIGNvZGUgaXRlcmF0b3Igd2lsbAogICAgICogYmUg\ncGxhY2VkIGJlZm9yZSB0aGUgZmlyc3QgaW5zdHJ1Y3Rpb24gb24gbWV0aG9k\nIHN0YXJ0LAogICAgICogYW5kIHdpbGwgYmUgYWZ0ZXIgdGhlIGxhc3QgaW5z\ndHJ1Y3Rpb24gb24gbWV0aG9kIGNvbXBsZXRpb24KICAgICAqIEBwYXJhbSBp\nbnMgdGhlIHRlbXBsYXRlIGluc3RydWN0aW9uIHRvIHNlYXJjaCBmb3I7IGVp\ndGhlciBhCiAgICAgKiBnZXRmaWVsZCBvciBwdXRmaWVsZCBpbnN0cnVjdGlv\nbgogICAgICogQHBhcmFtIGdldCBib29sZWFuIGluZGljYXRpbmcgaWYgdGhp\ncyBpcyBhIGdldCBpbnN0cnVjdGlvbgogICAgICogQHBhcmFtIHN0YXQgdGVt\ncGxhdGUgaW52b2tlc3RhdGljIGluc3RydWN0aW9uIHRvIHJlcGxhY2Ugd2l0\naAogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVwbGFjZUFuZFZhbGlkYXRl\nRmllbGRBY2Nlc3MoQ29kZSBjb2RlLCBJbnN0cnVjdGlvbiBpbnMsCiAgICAg\nICAgYm9vbGVhbiBnZXQsIEluc3RydWN0aW9uIHN0YXQpIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGNvZGUuYmVmb3JlRmlyc3Qo\nKTsKCiAgICAgICAgRmllbGRJbnN0cnVjdGlvbiBmaTsKICAgICAgICBNZXRo\nb2RJbnN0cnVjdGlvbiBtaTsKICAgICAgICBDbGFzc01ldGFEYXRhIG93bmVy\nOwogICAgICAgIFN0cmluZyBuYW1lLCB0eXBlTmFtZSwgbWV0aG9kTmFtZTsK\nICAgICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKGlucykpIHsKICAg\nICAgICAgICAgLy8gYmFjayB1cCB0byB0aGUgbWF0Y2hlZCBpbnN0cnVjdGlv\nbgogICAgICAgICAgICBmaSA9IChGaWVsZEluc3RydWN0aW9uKSBjb2RlLnBy\nZXZpb3VzKCk7CiAgICAgICAgICAgIG5hbWUgPSBmaS5nZXRGaWVsZE5hbWUo\nKTsKICAgICAgICAgICAgdHlwZU5hbWUgPSBmaS5nZXRGaWVsZFR5cGVOYW1l\nKCk7CiAgICAgICAgICAgIG93bmVyID0gZ2V0UGVyc2lzdGVuY2VDYXBhYmxl\nT3duZXIobmFtZSwgZmkuZ2V0RmllbGREZWNsYXJlclR5cGUoKSk7CiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gb3duZXIgPT0gbnVsbCA/IG51\nbGwgOiBvd25lci5nZXRGaWVsZChuYW1lKTsKICAgICAgICAgICAgaWYgKGlz\nUHJvcGVydHlBY2Nlc3MoZm1kKSkgewogICAgICAgICAgICAgICAgLy8gaWYg\nd2UncmUgZGlyZWN0bHkgYWNjZXNzaW5nIGEgZmllbGQgaW4gYW5vdGhlciBj\nbGFzcwogICAgICAgICAgICAgICAgLy8gaGllcmFyY2h5IHRoYXQgdXNlcyBw\ncm9wZXJ0eSBhY2Nlc3MsIHNvbWV0aGluZyBpcyB3cm9uZwogICAgICAgICAg\nICAgICAgaWYgKG93bmVyICE9IF9tZXRhICYmIG93bmVyLmdldERlY2xhcmVk\nRmllbGQobmFtZSkgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAgIF9t\nZXRhICE9IG51bGwgJiYgIW93bmVyLmdldERlc2NyaWJlZFR5cGUoKQogICAg\nICAgICAgICAgICAgICAgICAgICAuaXNBc3NpZ25hYmxlRnJvbShfbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwcm9wZXJ0eS1maWVsZC1h\nY2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIF9tZXRhLCBvd25lciwgbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpIH0pKTsKCiAgICAgICAg\nICAgICAgICAvLyBpZiB3ZSdyZSBkaXJlY3RseSBhY2Nlc3NpbmcgYSBwcm9w\nZXJ0eS1iYWNraW5nIGZpZWxkIG91dHNpZGUKICAgICAgICAgICAgICAgIC8v\nIHRoZSBwcm9wZXJ0eSBpbiBvdXIgb3duIGNsYXNzLCBub3RpZnkgdXNlcgog\nICAgICAgICAgICAgICAgaWYgKGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJv\ncGVydHkobmFtZSwgY29kZSkpCiAgICAgICAgICAgICAgICAgICAgYWRkVmlv\nbGF0aW9uKCJwcm9wZXJ0eS1maWVsZC1hY2Nlc3MiLCBuZXcgT2JqZWN0W117\nIF9tZXRhLAogICAgICAgICAgICAgICAgICAgICAgICBvd25lciwgbmFtZSwg\nY29kZS5nZXRNZXRob2QoKS5nZXROYW1lKCkgfSwgZmFsc2UpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAob3duZXIgPT0gbnVsbCB8fAogICAg\nICAgICAgICAgICAgb3duZXIuZ2V0RGVjbGFyZWRGaWVsZChmcm9tQmFja2lu\nZ0ZpZWxkTmFtZShuYW1lKSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nLy8gbm90IHBlcnNpc3RlbnQgZmllbGQ/CiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9IGVsc2UgaWYgKCFnZXRSZWRlZmluZSgpICYmICFnZXRDcmVhdGVTdWJj\nbGFzcygpCiAgICAgICAgICAgICAgICAmJiBpc0ZpZWxkQWNjZXNzKGZtZCkp\nIHsKICAgICAgICAgICAgICAgIC8vIHJlcGxhY2UgdGhlIGluc3RydWN0aW9u\nIHdpdGggYSBjYWxsIHRvIHRoZSBnZW5lcmF0ZWQgYWNjZXNzCiAgICAgICAg\nICAgICAgICAvLyBtZXRob2QKICAgICAgICAgICAgICAgIG1pID0gKE1ldGhv\nZEluc3RydWN0aW9uKSBjb2RlLnNldChzdGF0KTsKCiAgICAgICAgICAgICAg\nICAvLyBpbnZva2UgdGhlIHByb3BlciBhY2Nlc3MgbWV0aG9kLCB3aGV0aGVy\nIGdldHRlciBvciBzZXR0ZXIKICAgICAgICAgICAgICAgIFN0cmluZyBwcmVm\naXggPSAoZ2V0KSA/IFBSRSArICJHZXQiIDogUFJFICsgIlNldCI7CiAgICAg\nICAgICAgICAgICBtZXRob2ROYW1lID0gcHJlZml4ICsgbmFtZTsKICAgICAg\nICAgICAgICAgIGlmIChnZXQpIHsKICAgICAgICAgICAgICAgICAgICBtaS5z\nZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICBtZXRob2ROYW1lLCB0eXBlTmFtZSwgbmV3IFN0cmlu\nZ1tdCiAgICAgICAgICAgICAgICAgICAgICAgIHsgZ2V0VHlwZShvd25lciku\nZ2V0TmFtZSgpIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICBtaS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lLCAi\ndm9pZCIsIG5ldyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7\nIGdldFR5cGUob3duZXIpLmdldE5hbWUoKSwgdHlwZU5hbWUgfSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmIChnZXRSZWRlZmluZSgpKSB7CiAgICAgICAg\nICAgICAgICBuYW1lID0gZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSk7CiAg\nICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAg\nYWRkTm90aWZ5QWNjZXNzKGNvZGUsIG93bmVyLmdldEZpZWxkKG5hbWUpKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0IHRo\nZSBzZXQgb3BlcmF0aW9ucyBhZnRlciB0aGUgZmllbGQgbXV0YXRpb24sIGJ1\ndAogICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IGxvYWQgdGhlIG9sZCB2\nYWx1ZSBmb3IgdXNlIGluIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIFN0\nYXRlTWFuYWdlci5zZXR0aW5nWFhYIG1ldGhvZC4KICAgICAgICAgICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZGaSA9IGZp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZCgKICAgICAgICAgICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIC5nZXRGaWVsZEluc3RydWN0aW9uRmllbGRBY3Rpb24oZkZp\nKSkpOwogICAgICAgICAgICAgICAgICAgIGludCB2YWwgPSBjb2RlLmdldE5l\neHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIGNvZGUueHN0\nb3JlKCkuc2V0TG9jYWwodmFsKS5zZXRUeXBlKGZpLmdldEZpZWxkVHlwZSgp\nKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gbW92ZSBwYXN0IHRoZSBwdXRm\naWVsZAogICAgICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwogICAgICAg\nICAgICAgICAgICAgIGFkZE5vdGlmeU11dGF0aW9uKGNvZGUsIG93bmVyLmdl\ndEZpZWxkKG5hbWUpLCB2YWwsIC0xKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvZGUubmV4dCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFkZE5vdGlm\neUFjY2VzcyhDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgLy8gUENIZWxwZXIuYWNjZXNzaW5nRmllbGQodGhpcywgPGFic29sdXRl\nLWluZGV4Pik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kLmdldEluZGV4KCkp\nOwogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZGVm\naW5pdGlvbkhlbHBlci5jbGFzcywKICAgICAgICAgICAgImFjY2Vzc2luZ0Zp\nZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW10geyBP\nYmplY3QuY2xhc3MsIGludC5jbGFzcyB9KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgc2V0dGluZyB0aGUgdmFs\ndWUgaW4gdGhlIG9iamVjdC4KICAgICAqIAogICAgICogQHBhcmFtIGNvZGUK\nICAgICAqIEBwYXJhbSB2YWwgdGhlIHBvc2l0aW9uIGluIHRoZSBsb2NhbCB2\nYXJpYWJsZSB0YWJsZSB3aGVyZSB0aGUKICAgICAqIG9sZCB2YWx1ZSBpcyBz\ndG9yZWQKICAgICAqIEBwYXJhbSBwYXJhbSB0aGUgcGFyYW1ldGVyIHBvc2l0\naW9uIGNvbnRhaW5pbmcgdGhlIG5ldyB2YWx1ZSwgb3IKICAgICAqIC0xIGlm\nIHRoZSBuZXcgdmFsdWUgaXMgdW5hdmFpbGFibGUgYW5kIHNob3VsZCB0aGVy\nZWZvcmUgYmUgbG9va2VkCiAgICAgKiB1cC4KICAgICAqIEB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGROb3RpZnlNdXRhdGlvbihDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1k\nLCBpbnQgdmFsLAogICAgICAgIGludCBwYXJhbSkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBQQ0hlbHBlci5z\nZXR0aW5nRmllbGQodGhpcywgPGFic29sdXRlLWluZGV4Piwgb2xkLCBuZXcp\nOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgpKTsKICAgICAg\nICBDbGFzcyB0eXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAg\nIC8vIHdlIG9ubHkgaGF2ZSBzcGVjaWFsIHNpZ25hdHVyZXMgZm9yIHByaW1p\ndGl2ZXMgYW5kIFN0cmluZ3MKICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRp\ndmUoKSAmJiB0eXBlICE9IFN0cmluZy5jbGFzcykKICAgICAgICAgICAgdHlw\nZSA9IE9iamVjdC5jbGFzczsKICAgICAgICBjb2RlLnhsb2FkKCkuc2V0TG9j\nYWwodmFsKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGlmIChwYXJhbSA9PSAt\nMSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvZGUueGxv\nYWQoKS5zZXRQYXJhbShwYXJhbSkuc2V0VHlwZSh0eXBlKTsKICAgICAgICB9\nCiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVkZWZp\nbml0aW9uSGVscGVyLmNsYXNzLCAic2V0dGluZ0ZpZWxkIiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAg\nT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MsIHR5cGUsIHR5cGUKICAgICAgICB9\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBn\naXZlbiBpbnN0cnVjdGlvbiBhY2Nlc3NlcyBhIGZpZWxkIHRoYXQgaXMgYSBi\nYWNraW5nCiAgICAgKiBmaWVsZCBvZiBhbm90aGVyIHByb3BlcnR5IGluIHRo\naXMgcHJvcGVydHktYWNjZXNzIGNsYXNzLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gaXNCYWNraW5nRmllbGRPZkFub3RoZXJQcm9wZXJ0eShTdHJp\nbmcgbmFtZSwgQ29kZSBjb2RlKSB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1l\nID0gY29kZS5nZXRNZXRob2QoKS5nZXROYW1lKCk7CiAgICAgICAgcmV0dXJu\nICEiPGluaXQ+Ii5lcXVhbHMobWV0aE5hbWUpCiAgICAgICAgICAgICYmIF9i\nYWNraW5nRmllbGRzICE9IG51bGwKICAgICAgICAgICAgJiYgIW5hbWUuZXF1\nYWxzKF9iYWNraW5nRmllbGRzLmdldChtZXRoTmFtZSkpCiAgICAgICAgICAg\nICYmIF9iYWNraW5nRmllbGRzLmNvbnRhaW5zVmFsdWUobmFtZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHJldHVybiB0aGUg\nZGVjbGFyaW5nIFBlcnNpc3RlbmNlQ2FwYWJsZSBjbGFzcyBvZgogICAgICog\ndGhlIGdpdmVuIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJhbSBmaWVsZE5h\nbWUgdGhlIG5hbWUgb2YgdGhlIGZpZWxkCiAgICAgKiBAcGFyYW0gb3duZXIg\ndGhlIG5vbWluYWwgb3duZXIgb2YgdGhlIGZpZWxkCiAgICAgKiBAcmV0dXJu\nIHRoZSBtZXRhZGF0YSBmb3IgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSB0eXBl\nIHRoYXQKICAgICAqIGRlY2xhcmVzIHRoZSBmaWVsZCAoYW5kIHRoZXJlZm9y\nZSBoYXMgdGhlIHN0YXRpYyBtZXRob2QpLCBvciBudWxsIGlmIG5vbmUKICAg\nICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIGdldFBlcnNpc3RlbmNl\nQ2FwYWJsZU93bmVyKFN0cmluZyBmaWVsZE5hbWUsCiAgICAgICAgQ2xhc3Mg\nb3duZXIpIHsKICAgICAgICAvLyBmaW5kIHRoZSBhY3R1YWwgYW5jZXN0b3Ig\nY2xhc3MgdGhhdCBkZWNsYXJlcyB0aGUgZmllbGQsIHRoZW4KICAgICAgICAv\nLyBjaGVjayBpZiB0aGUgY2xhc3MgaXMgcGVyc2lzdGVudCwgYW5kIGlmIHRo\nZSBmaWVsZCBpcyBtYW5hZ2VkCiAgICAgICAgRmllbGQgZiA9IFJlZmxlY3Rp\nb24uZmluZEZpZWxkKG93bmVyLCBmaWVsZE5hbWUsIGZhbHNlKTsKICAgICAg\nICBpZiAoZiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgLy8gbWFuYWdlZCBpbnRlcmZhY2UKICAgICAgICBpZiAoX21ldGEg\nIT0gbnVsbCAmJiBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZh\nY2UoKSkKICAgICAgICAgICAgcmV0dXJuIF9tZXRhOwoKICAgICAgICByZXR1\ncm4gX3JlcG9zLmdldE1ldGFEYXRhKGYuZ2V0RGVjbGFyaW5nQ2xhc3MoKSwg\nbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhbGwg\nc3ludGhldGljIG1ldGhvZHMgdG8gdGhlIGJ5dGVjb2RlIGJ5IGRlbGVnYXRp\nbmcgdG8KICAgICAqIHRoZSB2YXJpb3VzIGFkZFhYWE1ldGhvZHMgKCkgZnVu\nY3Rpb25zIGluIHRoaXMgY2xhc3MuIEluY2x1ZGVzCiAgICAgKiBhbGwgc3Rh\ndGljIGZpZWxkIGFjY2VzcyBtZXRob2RzLgogICAgICogTm90ZSB0aGF0IHRo\nZSAnc3RvY2snIG1ldGhvZHMgbGlrZSA8Y29kZT5wY0lzVHJhbnNhY3Rpb25h\nbDwvY29kZT4sCiAgICAgKiA8Y29kZT5wY0ZldGNoT2JqZWN0SWQ8L2NvZGU+\nLCBldGMgYXJlIGRlZmluZWQgb25seSBpbiB0aGUKICAgICAqIGxlYXN0LWRl\ncml2ZWQgUGVyc2lzdGVuY2VDYXBhYmxlIHR5cGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRQQ01ldGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGFkZENsZWFyRmllbGRzTWV0\naG9kKCk7CiAgICAgICAgYWRkTmV3SW5zdGFuY2VNZXRob2QodHJ1ZSk7CiAg\nICAgICAgYWRkTmV3SW5zdGFuY2VNZXRob2QoZmFsc2UpOwogICAgICAgIGFk\nZE1hbmFnZWRGaWVsZENvdW50TWV0aG9kKCk7CiAgICAgICAgYWRkUmVwbGFj\nZUZpZWxkc01ldGhvZHMoKTsKICAgICAgICBhZGRQcm92aWRlRmllbGRzTWV0\naG9kcygpOwogICAgICAgIGFkZENvcHlGaWVsZHNNZXRob2QoKTsKCiAgICAg\nICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51bGwgfHwgZ2V0\nQ3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBhZGRTdG9ja01ldGhv\nZHMoKTsKICAgICAgICAgICAgYWRkR2V0VmVyc2lvbk1ldGhvZCgpOwogICAg\nICAgICAgICBhZGRSZXBsYWNlU3RhdGVNYW5hZ2VyTWV0aG9kKCk7CgogICAg\nICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gQ2xhc3NN\nZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgICAgIGFkZE5v\nT3BBcHBsaWNhdGlvbklkZW50aXR5TWV0aG9kcygpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gYWRkIHRoZSBhcHAgaWQgbWV0aG9kcyB0byBlYWNoIHN1YmNs\nYXNzIHJhdGhlcgogICAgICAgIC8vIHRoYW4ganVzdCB0aGUgc3VwZXJjbGFz\ncywgc2luY2UgaXQgaXMgcG9zc2libGUgdG8gaGF2ZQogICAgICAgIC8vIGEg\nc3ViY2xhc3Mgd2l0aCBhbiBhcHAgaWQgaGllcmFyY2h5IHRoYXQgbWF0Y2hl\ncyB0aGUKICAgICAgICAvLyBwZXJzaXN0ZW50IGNsYXNzIGluaGVyaXRhbmNl\nIGhpZXJhcmNoeQogICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OCiAgICAgICAgICAg\nICYmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsIHx8IGdldENy\nZWF0ZVN1YmNsYXNzKCkgfHwKICAgICAgICAgICAgICAgIF9tZXRhLmdldE9i\namVjdElkVHlwZSgpICE9CiAgICAgICAgICAgICAgICAgICAgX21ldGEuZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRPYmplY3RJZFR5cGUoKSkpIHsK\nICAgICAgICAgICAgYWRkQ29weUtleUZpZWxkc1RvT2JqZWN0SWRNZXRob2Qo\ndHJ1ZSk7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElk\nTWV0aG9kKGZhbHNlKTsKICAgICAgICAgICAgYWRkQ29weUtleUZpZWxkc0Zy\nb21PYmplY3RJZE1ldGhvZCh0cnVlKTsKICAgICAgICAgICAgYWRkQ29weUtl\neUZpZWxkc0Zyb21PYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAg\nIGlmIChfbWV0YS5oYXNBYnN0cmFjdFBLRmllbGQoKSA9PSB0cnVlKSB7IAog\nICAgICAgICAgICAgICAgYWRkR2V0SURPd25pbmdDbGFzcygpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGFkZE5ld09iamVjdElkSW5zdGFuY2VNZXRo\nb2QodHJ1ZSk7CiAgICAgICAgICAgIGFkZE5ld09iamVjdElkSW5zdGFuY2VN\nZXRob2QoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChfbWV0\nYS5oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNzKCkpeyAKICAgICAgICAg\nICAgYWRkR2V0SURPd25pbmdDbGFzcygpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBhIG1ldGhvZCB0byBjbGVhciBhbGwgcGVyc2lz\ndGVudCBmaWVsZHM7IHdlJ2xsIGNhbGwgdGhpcyBmcm9tCiAgICAgKiB0aGUg\nbmV3IGluc3RhbmNlIG1ldGhvZCB0byBlbnN1cmUgdGhhdCB1bmxvYWRlZCBm\naWVsZHMgaGF2ZQogICAgICogZGVmYXVsdCB2YWx1ZXMuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRDbGVhckZpZWxkc01ldGhvZCgpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHJv\ndGVjdGVkIHZvaWQgcGNDbGVhckZpZWxkcyAoKQogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDbGVhckZpZWxk\ncyIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG51bGwpOwogICAgICAgIG1l\ndGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLnBjQ2xlYXJG\naWVsZHMgKCkKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkg\nIT0gbnVsbCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAg\nICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAi\nQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbnVs\nbCk7CiAgICAgICAgfQoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9\nIF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlm\nIChmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1B\nTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVB\nTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKDApOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRCk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoMEYpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nMEwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0TnVsbCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIGZtZHNbaV0pOwogICAgICAgIH0KCiAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wY05ld0luc3RhbmNlPC9jb2RlPiBt\nZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICogVGhlc2UgbWV0aG9kcyBh\ncmUgdXNlZCBieSB0aGUgaW1wbCBoZWxwZXIgdG8gY3JlYXRlIG5ldwogICAg\nICogbWFuYWdlZCBpbnN0YW5jZXMgZWZmaWNpZW50bHkgd2l0aG91dCByZWZs\nZWN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvaWQgc2V0IHRvIHRydWUg\ndG8gbWltaWMgdGhlIG1ldGhvZCB2ZXJzaW9uIHRoYXQgdGFrZXMKICAgICAq\nIGFuIG9pZCB2YWx1ZSBhcyB3ZWxsIGFzIGEgc3RhdGUgbWFuYWdlcgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkTmV3SW5zdGFuY2VNZXRob2QoYm9v\nbGVhbiBvaWQpIHsKICAgICAgICAvLyBwdWJsaWMgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjTmV3SW5zdGFuY2UgKC4uLikKICAgICAgICBDbGFzc1tdIGFyZ3Mg\nPQogICAgICAgICAgICAob2lkKSA/IG5ldyBDbGFzc1tdeyBTTVRZUEUsIE9i\namVjdC5jbGFzcywgYm9vbGVhbi5jbGFzcyB9CiAgICAgICAgICAgICAgICA6\nIG5ldyBDbGFzc1tdeyBTTVRZUEUsIGJvb2xlYW4uY2xhc3MgfTsKICAgICAg\nICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nTmV3SW5zdGFuY2UiLCBQQ1RZUEUsIGFyZ3MpOwogICAgICAgIENvZGUgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiB0aGUg\ndHlwZSBpcyBhYnN0cmFjdCwgdGhyb3cgYSBVc2VyRXhjZXB0aW9uCiAgICAg\nICAgaWYgKF9wYy5pc0Fic3RyYWN0KCkpIHsKICAgICAgICAgICAgdGhyb3dF\neGNlcHRpb24oY29kZSwgVVNFUkVYQ0VQKTsKICAgICAgICAgICAgY29kZS52\ncmV0dXJuKCk7CgogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIFhYWCBw\nYyA9IG5ldyBYWFggKCk7CiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShf\ncGMpOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxs\nKTsKICAgICAgICBpbnQgaW5zdCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAg\nICAgICAgLy8gaWYgKGNsZWFyKQogICAgICAgIC8vICAgcGMucGNDbGVhckZp\nZWxkcyAoKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oKG9pZCkg\nPyAyIDogMSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIG5vY2xlYXIgPSBj\nb2RlLmlmZXEoKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5z\ndCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBS\nRSArICJDbGVhckZpZWxkcyIsIHZvaWQuY2xhc3MsIG51bGwpOwoKICAgICAg\nICAvLyBwYy5wY1N0YXRlTWFuYWdlciA9IHNtOwogICAgICAgIG5vY2xlYXIu\nc2V0VGFyZ2V0KGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KSk7CiAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUucHV0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAgICAgICAgLy8gY29w\neSBrZXkgZmllbGRzIGZyb20gb2lkCiAgICAgICAgaWYgKG9pZCkgewogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJDb3B5S2V5Rmll\nbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyByZXR1cm4gcGM7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKGluc3QpOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhl\nIDxjb2RlPnByb3RlY3RlZCBzdGF0aWMgaW50IHBjR2V0TWFuYWdlZEZpZWxk\nQ291bnQgKCk8L2NvZGU+CiAgICAgKiBtZXRob2QgdG8gdGhlIGJ5dGVjb2Rl\nLCByZXR1cm5pbmcgdGhlIGluaGVyaXRlZCBmaWVsZCBjb3VudCBhZGRlZAog\nICAgICogdG8gdGhlIG51bWJlciBvZiBtYW5hZ2VkIGZpZWxkcyBpbiB0aGUg\nY3VycmVudCBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3MuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhvZCgpIHsK\nICAgICAgICAvLyBwcm90ZWN0ZWQgc3RhdGljIGludCBwY0dldE1hbmFnZWRG\naWVsZENvdW50ICgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIkdldE1hbmFnZWRGaWVsZENvdW50IiwKICAg\nICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRob2Quc2V0\nU3RhdGljKHRydWUpOwogICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIC8vIHJldHVybiA8ZmllbGRzPiArIHBjSW5oZXJpdGVkRmllbGRD\nb3VudAogICAgICAgIC8vIGF3aGl0ZTogdGhlIGFib3ZlIHNob3VsZCB3b3Jr\nLCBidXQgSSdtIHNlZWluZyBhIG1lc3NlZCB1cCBzaXR1YXRpb24KICAgICAg\nICAvLyBhbGwgb2YgYSBzdWRkZW4gd2hlcmUgd2hlbiBhIHN1YmNsYXNzIGNh\nbGxzIHRoaXMgbWV0aG9kLCBpdCBzb21laG93CiAgICAgICAgLy8gaGFwcGVu\ncyBiZWZvcmUgPGNsaW5pdD4gaXMgZXZlciBpbnZva2VkLCBhbmQgc28gb3Vy\nCiAgICAgICAgLy8gcGNJbmhlcml0ZWRGaWVsZENvdW50IGZpZWxkIGlzbid0\nIGluaXRpYWxpemVkISAgc28gaW5zdGVhZCwKICAgICAgICAvLyByZXR1cm4g\nPGZpZWxkcz4gKyA8c3VwZXJjbGFzcz4ucGNHZXRNYW5hZ2VkRmllbGRDb3Vu\ndCAoKQogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShfbWV0YS5n\nZXREZWNsYXJlZEZpZWxkcygpLmxlbmd0aCk7CiAgICAgICAgaWYgKF9tZXRh\nLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwpIHsKICAgICAgICAgICAgQ2xh\nc3Mgc3VwZXJDbGFzcyA9IGdldFR5cGUoX21ldGEuZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKSk7CiAgICAgICAgICAgIFN0cmluZyBzdXBlck5hbWUgPSBn\nZXRDcmVhdGVTdWJjbGFzcygpID8KICAgICAgICAgICAgICAgIFBDRW5oYW5j\nZXIudG9QQ1N1YmNsYXNzTmFtZShzdXBlckNsYXNzKSA6CiAgICAgICAgICAg\nICAgICBzdXBlckNsYXNzLmdldE5hbWUoKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2VzdGF0aWMoKS5zZXRNZXRob2Qoc3VwZXJOYW1lLAogICAgICAgICAg\nICAgICAgUFJFICsgIkdldE1hbmFnZWRGaWVsZENvdW50IiwgaW50LmNsYXNz\nLmdldE5hbWUoKSwgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaWFkZCgpOwog\nICAgICAgIH0KICAgICAgICBjb2RlLmlyZXR1cm4oKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZp\nZWxkfSBhbmQKICAgICAqIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNQ\ncm92aWRlRmllbGRzfSBtZXRob2RzIHRvIHRoZSBieXRlY29kZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3ZpZGVGaWVsZHNNZXRob2RzKCkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBwdWJsaWMgdm9pZCBwY1Byb3ZpZGVGaWVsZCAoaW50IGZpZWxkTnVt\nYmVyKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJQcm92aWRlRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBhZGRz\nIGV2ZXJ5dGhpbmcgdGhyb3VnaCB0aGUgc3dpdGNoICgpCiAgICAgICAgaW50\nIHJlbExvY2FsID0gYmVnaW5Td2l0Y2hNZXRob2QoUFJFICsgIlByb3ZpZGVG\naWVsZCIsIGNvZGUpOwoKICAgICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhp\ncyBpbnN0LCBqdXN0IHRocm93IGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdl\ndEZpZWxkcygpCiAgICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVs\nZHMoKTsKICAgICAgICBpZiAoZm1kcy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gc3dp\ndGNoICh2YWwpCiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChy\nZWxMb2NhbCk7CiAgICAgICAgICAgIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24g\ndGFiaW5zID0gY29kZS50YWJsZXN3aXRjaCgpOwogICAgICAgICAgICB0YWJp\nbnMuc2V0TG93KDApOwogICAgICAgICAgICB0YWJpbnMuc2V0SGlnaChmbWRz\nLmxlbmd0aCAtIDEpOwoKICAgICAgICAgICAgLy8gPGZpZWxkPiA9IHBjU3Rh\ndGVNYW5hZ2VyLnByb3ZpZGVkPHR5cGU+RmllbGQKICAgICAgICAgICAgLy8g\nICAgICh0aGlzLCBmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgdGFiaW5zLmFkZFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUu\naWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgYWRk\nR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKGdldFN0\nYXRlTWFuYWdlck1ldGhvZAogICAgICAgICAgICAgICAgICAgIChmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpLCAicHJvdmlkZWQiLCBmYWxzZSwgZmFsc2Up\nKTsKICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgICAgIHRhYmlucy5zZXRE\nZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAgICAgICAo\nY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAgICAg\nICAgfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgYWRkTXVs\ndGlwbGVGaWVsZHNNZXRob2RWZXJzaW9uKG1ldGhvZCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxl\nI3BjUmVwbGFjZUZpZWxkfSBhbmQKICAgICAqIHtAbGluayBQZXJzaXN0ZW5j\nZUNhcGFibGUjcGNSZXBsYWNlRmllbGRzfSBtZXRob2RzIHRvIHRoZSBieXRl\nY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFJlcGxhY2VGaWVs\nZHNNZXRob2RzKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY1JlcGxhY2VGaWVsZCAo\naW50IGZpZWxkTnVtYmVyKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJSZXBsYWNlRmllbGQiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcgdGhyb3VnaCB0aGUgc3dpdGNoICgp\nCiAgICAgICAgaW50IHJlbExvY2FsID0gYmVnaW5Td2l0Y2hNZXRob2QoUFJF\nICsgIlJlcGxhY2VGaWVsZCIsIGNvZGUpOwoKICAgICAgICAvLyBpZiBubyBm\naWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0IHRocm93IGV4Y2VwdGlvbgogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3Mo\nKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAgIDogX21ldGEuZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoZm1kcy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgICAgIGNvZGUuaWxvYWQo\nKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAgIFRhYmxlU3dpdGNo\nSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJsZXN3aXRjaCgpOwogICAg\nICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAgICAgICB0YWJpbnMu\nc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAgICAgLy8gPGZp\nZWxkPiA9IHBjU3RhdGVNYW5hZ2VyLnJlcGxhY2U8dHlwZT5GaWVsZAogICAg\nICAgICAgICAvLyAgKHRoaXMsIGZpZWxkTnVtYmVyKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICAvLyBmb3IgdGhlIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUg\nY2FsbCBiZWxvdy4KICAgICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQo\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSwgZm1kc1tpXSkpOwoK\nICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UsIGZtZHNbaV0pOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSwgZm1kc1tpXSk7CiAgICAgICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChnZXRTdGF0\nZU1hbmFnZXJNZXRob2QKICAgICAgICAgICAgICAgICAgICAoZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSwgInJlcGxhY2UiLCB0cnVlLCBmYWxzZSkpOwog\nICAgICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgp\nLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwoK\nICAgICAgICAgICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\nZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBpZihfYWRkVmVyc2lvbkluaXRG\nbGFnKXsKICAgICAgICAgICAgICAgICAgICBpZihmbWRzW2ldLmlzVmVyc2lv\nbigpKXsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBjYXNl\nIGlzIHNldHRpbmcgdGhlIHZlcnNpb24gZmllbGQKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gcGNWZXJzaW9uSW5pdCA9IHRydWU7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1dGZpZWxkKGNv\nZGUsIG51bGwsIFZFUlNJT05fSU5JVF9TVFIsIGJvb2xlYW4uY2xhc3MpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uICgpCiAgICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFy\nZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVs\nZHNNZXRob2RWZXJzaW9uKG1ldGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjQ29weUZp\nZWxkc30gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZENvcHlGaWVsZHNNZXRob2QoKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2\nb2lkIHBjQ29weUZpZWxkIChPYmplY3QgcGMsIGludCBmaWVsZCkKICAgICAg\nICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nQ29weUZpZWxkIiwKICAgICAgICAgICAgdm9pZC5jbGFzcy5nZXROYW1lKCks\nCiAgICAgICAgICAgIG5ldyBTdHJpbmdbXXsgX21hbmFnZWRUeXBlLmdldE5h\nbWUoKSwgaW50LmNsYXNzLmdldE5hbWUoKSB9KTsKICAgICAgICBtZXRob2Qu\nbWFrZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcgdGhy\nb3VnaCB0aGUgc3dpdGNoICgpCiAgICAgICAgaW50IHJlbExvY2FsID0gYmVn\naW5Td2l0Y2hNZXRob2QoUFJFICsgIkNvcHlGaWVsZCIsIGNvZGUpOwoKICAg\nICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0IHRocm93\nIGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0\nQ3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAg\nICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAo\nZm1kcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24o\nY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAg\nICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAg\nICAgIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJs\nZXN3aXRjaCgpOwogICAgICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAg\nICAgICAgICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAvLyA8ZmllbGQ+ID0gb3RoZXIuPGZpZWxk\nPjsKICAgICAgICAgICAgICAgIC8vIG9yIHNldDxmaWVsZD4gKG90aGVyLmdl\ndDxmaWVsZD4pOwogICAgICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlLCBmbWRzW2ldKSk7CiAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNb\naV0sIGZhbHNlKTsKICAgICAgICAgICAgICAgIGFkZFNldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAgICAgICAgLy8gYnJl\nYWs7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0YWJpbnMuc2V0\nRGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAgICAgICAg\nKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwogICAg\nICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIGFkZE11\nbHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwogICAgfQoKICAg\nIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBhZGQgdGhlIGNvZGUgY29t\nbW9uIHRvIHRoZSBiZWdpbm5pbmcgb2YgYm90aCB0aGUKICAgICAqIHBjUmVw\nbGFjZUZpZWxkIG1ldGhvZCBhbmQgdGhlIHBjUHJvdmlkZUZpZWxkIG1ldGhv\nZC4gVGhpcyBpbmNsdWRlcwogICAgICogY2FsY3VsYXRpbmcgdGhlIHJlbGF0\naXZlIGZpZWxkIG51bWJlciBvZiB0aGUgZGVzaXJlZCBmaWVsZCBhbmQgY2Fs\nbGluZwogICAgICogdGhlIHN1cGVyY2xhc3MgaWYgbmVjZXNzYXJ5LgogICAg\nICoKICAgICAqIEByZXR1cm4gdGhlIGluZGV4IGluIHdoaWNoIHRoZSBsb2Nh\nbCB2YXJpYWJsZSBob2xkaW5nIHRoZSByZWxhdGl2ZQogICAgICogZmllbGQg\nbnVtYmVyIGlzIHN0b3JlZAogICAgICovCiAgICBwcml2YXRlIGludCBiZWdp\nblN3aXRjaE1ldGhvZChTdHJpbmcgbmFtZSwgQ29kZSBjb2RlKSB7CiAgICAg\nICAgYm9vbGVhbiBjb3B5ID0gKFBSRSArICJDb3B5RmllbGQiKS5lcXVhbHMo\nbmFtZSk7CiAgICAgICAgaW50IGZpZWxkTnVtYmVyID0gKGNvcHkpID8gMSA6\nIDA7CgogICAgICAgIGludCByZWxMb2NhbCA9IGNvZGUuZ2V0TmV4dExvY2Fs\nc0luZGV4KCk7CiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsK\nICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVy\nKTsKICAgICAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChyZWxMb2Nh\nbCk7CiAgICAgICAgICAgIHJldHVybiByZWxMb2NhbDsKICAgICAgICB9Cgog\nICAgICAgIC8vIGludCByZWwgPSBmaWVsZE51bWJlciAtIHBjSW5oZXJpdGVk\nRmllbGRDb3VudAogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbShmaWVs\nZE51bWJlcik7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJ\nTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgIGNvZGUuaXN1YigpOwogICAg\nICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7CgogICAgICAgIC8v\nIHN1cGVyOiBpZiAocmVsIDwgMCkgc3VwZXIucGNSZXBsYWNlRmllbGQgKGZp\nZWxkTnVtYmVyKTsgcmV0dXJuOwogICAgICAgIC8vIG5vIHN1cGVyOiBpZiAo\ncmVsIDwgMCkgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAo\nKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmZ2Uo\nKTsKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVs\nbCkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgU3RyaW5nW10gYXJnczsKICAgICAgICAgICAg\naWYgKGNvcHkpIHsKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgU3RyaW5n\nW117IGdldFR5cGUoX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZSgpLCBpbnQuY2xhc3MuZ2V0\nTmFtZSgpIH07CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgYXJn\ncyA9IG5ldyBTdHJpbmdbXXsgaW50LmNsYXNzLmdldE5hbWUoKSB9OwogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXIpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0\nVHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCkpLmdldE5hbWUoKSwgbmFtZSwgCiAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgICAgIGNvZGUu\ndnJldHVybigpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICB0aHJvd0V4\nY2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3Mp\nOwoKICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICAg\nICAgcmV0dXJuIHJlbExvY2FsOwogICAgfQoKICAgIC8qKgogICAgICogVGhp\ncyBoZWxwZXIgbWV0aG9kLCBnaXZlbiB0aGUgcGNSZXBsYWNlRmllbGQgb3Ig\ncGNQcm92aWRlRmllbGQKICAgICAqIG1ldGhvZCwgYWRkcyB0aGUgYnl0ZWNv\nZGUgZm9yIHRoZSBjb3JyZXNwb25kaW5nICdwbHVyYWwnIHZlcnNpb24KICAg\nICAqIG9mIHRoZSBtZXRob2QgLS0gdGhlIHZlcnNpb24gdGhhdCB0YWtlcyBh\nbiBpbnRbXSBvZiBmaWVsZHMgdG8KICAgICAqIHRvIGFjY2VzcyByYXRoZXIg\ndGhhbiBhIHNpbmdsZSBmaWVsZC4gVGhlIG11bHRpcGxlIGZpZWxkcyB2ZXJz\naW9uCiAgICAgKiBzaW1wbHkgbG9vcHMgdGhyb3VnaCB0aGUgcHJvdmlkZWQg\naW5kZXhlcyBhbmQgZGVsZWdhdGVzIHRvIHRoZQogICAgICogc2luZ3VsYXIg\ndmVyc2lvbiBmb3IgZWFjaCBvbmUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24oQkNNZXRob2Qgc2lu\nZ2xlKSB7CiAgICAgICAgYm9vbGVhbiBjb3B5ID0gKFBSRSArICJDb3B5Rmll\nbGQiKS5lcXVhbHMoc2luZ2xlLmdldE5hbWUoKSk7CgogICAgICAgIC8vIHB1\nYmxpYyB2b2lkIDxtZXRob2Q+cyAoaW50W10gZmllbGRzKQogICAgICAgIENs\nYXNzW10gYXJncyA9IChjb3B5KSA/IG5ldyBDbGFzc1tdeyBPYmplY3QuY2xh\nc3MsIGludFtdLmNsYXNzIH0KICAgICAgICAgICAgOiBuZXcgQ2xhc3NbXXsg\naW50W10uY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZGVjbGFyZU1ldGhvZChzaW5nbGUuZ2V0TmFtZSgpICsgInMiLAogICAgICAg\nICAgICB2b2lkLmNsYXNzLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgaW50IGZpZWxkTnVtYmVy\ncyA9IDA7CiAgICAgICAgaW50IGluc3QgPSAwOwogICAgICAgIGlmIChjb3B5\nKSB7CiAgICAgICAgICAgIGZpZWxkTnVtYmVycyA9IDE7CgogICAgICAgICAg\nICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAg\nLy8gZ2V0IHRoZSBtYW5hZ2VkIGluc3RhbmNlIGludG8gdGhlIGxvY2FsIHZh\ncmlhYmxlIHRhYmxlCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygp\nLnNldE1ldGhvZChJbXBsSGVscGVyLmNsYXNzLAogICAgICAgICAgICAgICAg\nICAgICJnZXRNYW5hZ2VkSW5zdGFuY2UiLCBPYmplY3QuY2xhc3MsCiAgICAg\nICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MgfSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoX21h\nbmFnZWRUeXBlKTsKICAgICAgICAgICAgICAgIGluc3QgPSBjb2RlLmdldE5l\neHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgY29kZS5hc3RvcmUo\nKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAgICAgICAgICAvLyB0aGVyZSBt\naWdodCBiZSBhIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUgY2xhc3NlcyBvZiAn\ndGhpcycKICAgICAgICAgICAgICAgIC8vIHZzICdvdGhlcicgaW4gdGhpcyBj\nb250ZXh0OyB1c2UgdGhlIFBDIG1ldGhvZHMgdG8gZ2V0IHRoZSBTTQogICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKElt\ncGxIZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgInRvUGVyc2lz\ndGVuY2VDYXBhYmxlIiwgUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLAogICAg\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBP\nYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAgICAgInBjR2V0U3RhdGVNYW5hZ2VyIiwgU3Rh\ndGVNYW5hZ2VyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIC8vIFhYWCBvdGhlciA9IChYWFgpIHBjOwogICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAgICAg\nICAgICAgICAgICBpbnN0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICAgICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaW5zdCk7\nCgogICAgICAgICAgICAgICAgLy8gYWNjZXNzIHRoZSBvdGhlcidzIHNtIGZp\nZWxkIGRpcmVjdGx5CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaW5zdCk7CiAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGlmIChvdGhlci5wY1N0YXRlTWFuYWdlciAhPSBwY1N0YXRlTWFu\nYWdlcikKICAgICAgICAgICAgLy8JdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbgoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRG\naWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgSnVtcEluc3RydWN0aW9u\nIGlmaW5zID0gY29kZS5pZmFjbXBlcSgpOwogICAgICAgICAgICB0aHJvd0V4\nY2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3Mp\nOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7Cgog\nICAgICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkKICAg\nICAgICAgICAgLy8gIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24K\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwog\nICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsU3RhdGVF\neGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQo\nY29kZS5ub3AoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBmb3IgKGludCBp\nID0gMDsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAg\nICAgICAgaW50IGlkeCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAg\nICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChpZHgpOwogICAgICAgIEp1\nbXBJbnN0cnVjdGlvbiB0ZXN0aW5zID0gY29kZS5nbzIoKTsKCiAgICAgICAg\nLy8gPG1ldGhvZD4gKGZpZWxkc1tpXSk7CiAgICAgICAgSW5zdHJ1Y3Rpb24g\nYm9keWlucyA9IGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGlmIChjb3B5KQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGZp\nZWxkTnVtYmVycyk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGlk\neCk7CiAgICAgICAgY29kZS5pYWxvYWQoKTsKICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2Qoc2luZ2xlKTsKCiAgICAgICAgLy8gaSsr\nOwogICAgICAgIGNvZGUuaWluYygpLnNldEluY3JlbWVudCgxKS5zZXRMb2Nh\nbChpZHgpOwoKICAgICAgICAvLyBpIDwgZmllbGRzLmxlbmd0aAogICAgICAg\nIHRlc3RpbnMuc2V0VGFyZ2V0KGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpZHgp\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXJz\nKTsKICAgICAgICBjb2RlLmFycmF5bGVuZ3RoKCk7CiAgICAgICAgY29kZS5p\nZmljbXBsdCgpLnNldFRhcmdldChib2R5aW5zKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSAnc3RvY2snIG1ldGhvZHMgdG8gdGhlIGJ5\ndGVjb2RlOyB0aGVzZSBpbmNsdWRlIG1ldGhvZHMKICAgICAqIGxpa2Uge0Bs\naW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0ZldGNoT2JqZWN0SWR9CiAgICAg\nKiBhbmQge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0lzVHJhbnNhY3Rp\nb25hbH0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTdG9ja01ldGhv\nZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHBjR2V0R2VuZXJpY0NvbnRl\neHQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhv\nZCgKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERl\nY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBT\nTVRZUEUsICJnZXQiICsgQ09OVEVYVE5BTUUsIChDbGFzc1tdKSBudWxsKSks\nIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0ZldGNoT2JqZWN0SWQK\nICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgK\nICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xh\ncmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZ\nUEUsICJmZXRjaE9iamVjdElkIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2Up\nOwogICAgCiAgICAgICAgICAgIC8vIHBjSXNEZWxldGVkCiAgICAgICAgICAg\nIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAg\nICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFj\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNEZWxl\ndGVkIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAg\nICAgIC8vIHBjSXNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3Rh\ndGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAg\nICAgICAgICAgICAgIFNNVFlQRSwgImlzRGlydHkiLCAoQ2xhc3NbXSkgbnVs\nbCkpLCB0cnVlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzTmV3CiAgICAg\nICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAg\nICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1l\ndGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAi\naXNOZXciLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAg\nICAgICAgLy8gcGNJc1BlcnNpc3RlbnQKICAgICAgICAgICAgdHJhbnNsYXRl\nRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAg\nIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAg\nICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJpc1BlcnNpc3RlbnQiLCAo\nQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8g\ncGNJc1RyYW5zYWN0aW9uYWwKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0\nYXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAg\nICAgICAgICAgICAgICBTTVRZUEUsICJpc1RyYW5zYWN0aW9uYWwiLCAoQ2xh\nc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNT\nZXJpYWxpemluZwogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5h\nZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxw\nZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgIFNNVFlQRSwgInNlcmlhbGl6aW5nIiwgKENsYXNzW10pIG51bGwp\nKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjRGlydHkKICAgICAg\nICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAg\nICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0\naG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJk\naXJ0eSIsIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSkpLCBmYWxzZSk7\nCiAgICAKICAgICAgICAgICAgLy8gcGNHZXRTdGF0ZU1hbmFnZXIKICAgICAg\nICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJHZXRTdGF0ZU1hbmFnZXIiLAogICAgICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgQ29kZSBjb2RlID0gbWV0\naC5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTdGF0ZU1hbmFnZXIuY2xhc3MpOwogICAgICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24gcGFlKSB7CiAgICAgICAgICAgICB0aHJvdyAoTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uKSBwYWUuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBhZGQgYSBzdG9jayBt\nZXRob2QgdG8gdGhlIGJ5dGVjb2RlLiBFYWNoCiAgICAgKiBzdG9jayBtZXRo\nb2Qgc2ltcGx5IGRlbGVnYXRlcyB0byBhIGNvcnJlc3BvbmRpbmcgU3RhdGVN\nYW5hZ2VyIG1ldGhvZC4KICAgICAqIEdpdmVuIHRoZSBTdGF0ZU1hbmFnZXIg\nbWV0aG9kLCB0aGVuLCB0aGlzIGZ1bmN0aW9uIHRyYW5zbGF0ZXMgaXQgaW50\nbwogICAgICogdGhlIHdyYXBwZXIgbWV0aG9kIHRoYXQgc2hvdWxkIGJlIGFk\nZGVkIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoTWV0aG9kIG0sCiAg\nICAgICAgYm9vbGVhbiBpc0RpcnR5Q2hlY2tNZXRob2QpIHsKICAgICAgICAv\nLyBmb3JtIHRoZSBuYW1lIG9mIHRoZSBtZXRob2QgYnkgcHJlcGVuZGluZyAn\ncGMnIHRvIHRoZSBzbSBtZXRob2QKICAgICAgICBTdHJpbmcgbmFtZSA9IFBS\nRSArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUobS5nZXROYW1lKCkpOwogICAg\nICAgIENsYXNzW10gcGFyYW1zID0gbS5nZXRQYXJhbWV0ZXJUeXBlcygpOwog\nICAgICAgIENsYXNzIHJldHVyblR5cGUgPSBtLmdldFJldHVyblR5cGUoKTsK\nCiAgICAgICAgLy8gYWRkIHRoZSBtZXRob2QgdG8gdGhlIHBjCiAgICAgICAg\nQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QobmFtZSwgcmV0\ndXJuVHlwZSwgcGFyYW1zKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2Vy\nID09IG51bGwpIHJldHVybiA8ZGVmYXVsdD47CiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgaWYgKHJl\ndHVyblR5cGUuZXF1YWxzKGJvb2xlYW4uY2xhc3MpKQogICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwogICAgICAgIGVsc2Ug\naWYgKCFyZXR1cm5UeXBlLmVxdWFscyh2b2lkLmNsYXNzKSkKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLnhy\nZXR1cm4oKS5zZXRUeXBlKHJldHVyblR5cGUpOwoKICAgICAgICAvLyBpZiB0\naGlzIGlzIHRoZSBkaXJ0eS1jaGVjayBtZXRob2QgYW5kIHdlJ3JlIHN1YmNs\nYXNzaW5nIGJ1dCBub3QKICAgICAgICAvLyByZWRlZmluaW5nLCBob29rIGlu\ndG8gUENIZWxwZXIgdG8gZG8gdGhlIGRpcnR5IGNoZWNrCiAgICAgICAgaWYg\nKGlzRGlydHlDaGVja01ldGhvZCAmJiAhZ2V0UmVkZWZpbmUoKSkgewogICAg\nICAgICAgICAvLyBSZWRlZmluaXRpb25IZWxwZXIuZGlydHlDaGVjayhzbSk7\nCiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgY29kZS5kdXAo\nKTsgLy8gZm9yIHRoZSByZXR1cm4gc3RhdGVtZW50IGJlbG93CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZGVmaW5pdGlv\nbkhlbHBlci5jbGFzcywgCiAgICAgICAgICAgICAgICAiZGlydHlDaGVjayIs\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgU01UWVBFIH0pOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgLy8gcmV0dXJuIHBjU3RhdGVNYW5hZ2VyLjxtZXRo\nb2Q+ICg8YXJncz4pOwogICAgICAgIC8vIG1hbmFnZWQgaW5zdGFuY2UgbG9h\nZGVkIGFib3ZlIGluIGlmLWVsc2UgYmxvY2sKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgY29k\nZS54bG9hZCgpLnNldFBhcmFtKGkpOwogICAgICAgIGNvZGUuaW52b2tlaW50\nZXJmYWNlKCkuc2V0TWV0aG9kKG0pOwogICAgICAgIGNvZGUueHJldHVybigp\nLnNldFR5cGUocmV0dXJuVHlwZSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNp\nc3RlbmNlQ2FwYWJsZSNwY0dldFZlcnNpb259IG1ldGhvZCB0byB0aGUgYnl0\nZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRHZXRWZXJzaW9u\nTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiR2V0VmVyc2lvbiIsIE9iamVjdC5jbGFzcywKICAgICAgICAg\nICAgbnVsbCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxs\nKQogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVs\nbCgpOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmVyc2lvbkZpZWxkID0gX21l\ndGEuZ2V0VmVyc2lvbkZpZWxkKCk7CgogICAgICAgIGlmICh2ZXJzaW9uRmll\nbGQgPT0gbnVsbCkKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51\nbGwoKTsgLy8gcmV0dXJuIG51bGw7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIHJldHVybiA8dmVyc2lvbkZpZWxkPjsKICAgICAgICAgICAgQ2xh\nc3Mgd3JhcHBlciA9IHRvUHJpbWl0aXZlV3JhcHBlcih2ZXJzaW9uRmllbGQp\nOwogICAgICAgICAgICBpZiAod3JhcHBlciAhPSB2ZXJzaW9uRmllbGQuZ2V0\nRGVjbGFyZWRUeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUod3JhcHBlcik7CiAgICAgICAgICAgICAgICBjb2RlLmR1cCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFs\ndWVDb2RlKGNvZGUsIHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3\ncmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh3\ncmFwcGVyLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgdmVyc2lvbkZpZWxkLmdldERlY2xhcmVkVHlw\nZSgpIH0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAg\nICAgICAgLy8gcmV0dXJuIHBjU3RhdGVNYW5hZ2VyLmdldFZlcnNpb24gKCk7\nCiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoU01UWVBFLCAiZ2V0VmVyc2lvbiIsIE9iamVjdC5jbGFz\ncywKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSB2ZXJzaW9uIGZpZWxkIHR5cGUgYXMgYSBwcmltaXRp\ndmUgd3JhcHBlciwgb3IgbnVsbCBpZgogICAgICogdGhlIHZlcnNpb24gZmll\nbGQgaXMgbm90IHByaW1pdGl2ZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFz\ncyB0b1ByaW1pdGl2ZVdyYXBwZXIoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAg\nICAgIHJldHVybiBCb29sZWFuLmNsYXNzOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIEJ5dGUuY2xh\nc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAg\nICAgICAgICByZXR1cm4gQ2hhcmFjdGVyLmNsYXNzOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nRG91YmxlLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9B\nVDoKICAgICAgICAgICAgICAgIHJldHVybiBGbG9hdC5jbGFzczsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgcmV0\ndXJuIEludGVnZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gTG9uZy5jbGFzczsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gU2hvcnQuY2xhc3M7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFj\nZVN0YXRlTWFuYWdlcn0KICAgICAqIG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZXBsYWNlU3RhdGVNYW5h\nZ2VyTWV0aG9kKCkgewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjUmVwbGFj\nZVN0YXRlTWFuYWdlciAoU3RhdGVNYW5hZ2VyIHNtKQogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJSZXBsYWNl\nU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW117IFNNVFlQRSB9KTsKICAgICAgICBtZXRob2Quc2V0U3luY2hyb25p\nemVkKHRydWUpOwogICAgICAgIG1ldGhvZC5nZXRFeGNlcHRpb25zKHRydWUp\nLmFkZEV4Y2VwdGlvbihTZWN1cml0eUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAg\nIC8vIGlmIChwY1N0YXRlTWFuYWdlciAhPSBudWxsKQogICAgICAgIC8vCXBj\nU3RhdGVNYW5hZ2VyID0gcGNTdGF0ZU1hbmFnZXIucmVwbGFjZVN0YXRlTWFu\nYWdlcihzbSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUu\naWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJy\nZXBsYWNlU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAgU01UWVBFLCBuZXcg\nQ2xhc3NbXXsgU01UWVBFIH0pOwogICAgICAgIGNvZGUucHV0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nCiAgICAgICAgLy8gU2VjdXJpdHlNYW5hZ2VyIHNlYyA9IFN5c3RlbS5nZXRT\nZWN1cml0eU1hbmFnZXIgKCk7CiAgICAgICAgLy8gaWYgKHNlYyAhPSBudWxs\nKQogICAgICAgIC8vCQlzZWMuY2hlY2tQZXJtaXNzaW9uIChQZXJtaXNzaW9u\nLlNFVF9TVEFURV9NQU5BR0VSKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQo\nY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoU3lzdGVtLmNsYXNzLAog\nICAgICAgICAgICAiZ2V0U2VjdXJpdHlNYW5hZ2VyIiwgU2VjdXJpdHlNYW5h\nZ2VyLmNsYXNzLCBudWxsKSk7CgogICAgICAgIC8vIHBjU3RhdGVNYW5hZ2Vy\nID0gc207CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMg\ndGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBtZXRob2RzIGRlYWxpbmcgd2l0aCBh\ncHBsaWNhdGlvbgogICAgICogaWRlbnRpdHkgYW5kIGdpdmVzIHRoZW0gbm8t\nb3AgaW1wbGVtZW50YXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkTm9PcEFwcGxpY2F0aW9uSWRlbnRpdHlNZXRob2RzKCkgewogICAgICAg\nIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQgKE9i\namVjdElkRmllbGRTdXBwbGllciBmcywKICAgICAgICAvLyAJT2JqZWN0IG9p\nZCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0SWQiLAogICAgICAgICAg\nICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lERlNUWVBFLCBPYmplY3Qu\nY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQg\ncGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0IG9pZCkKICAgICAg\nICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZp\nZWxkc1RvT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBw\ndWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQgKE9iamVj\ndElkRmllbGRDb25zdW1lciBmYywKICAgICAgICAvLwlPYmplY3Qgb2lkKQog\nICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5\nS2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117IE9JREZDVFlQRSwgT2JqZWN0LmNsYXNzIH0pOwog\nICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNG\ncm9tT2JqZWN0SWQgKE9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0\nSWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0\nIHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoKQogICAgICAgIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwK\nICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIE9iamVjdCBw\nY05ld09iamVjdElkSW5zdGFuY2UgKE9iamVjdCBvYmopCiAgICAgICAgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5ld09iamVjdElkSW5z\ndGFuY2UiLAogICAgICAgICAgICBPYmplY3QuY2xhc3MsIG5ldyBDbGFzc1td\neyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wY0Nv\ncHlLZXlGaWVsZHNUb09iamVjdElkPC9jb2RlPiBtZXRob2RzCiAgICAgKiB0\nbyBjbGFzc2VzIHVzaW5nIGFwcGxpY2F0aW9uIGlkZW50aXR5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUtleUZpZWxkc1RvT2JqZWN0SWRN\nZXRob2QoYm9vbGVhbiBmaWVsZE1hbmFnZXIpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQg\ncGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1cHBs\naWVyIGZzLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgU3RyaW5n\nW10gYXJncyA9IChmaWVsZE1hbmFnZXIpID8KICAgICAgICAgICAgbmV3IFN0\ncmluZ1tdeyBPSURGU1RZUEUuZ2V0TmFtZSgpLCBPYmplY3QuY2xhc3MuZ2V0\nTmFtZSgpIH0KICAgICAgICAgICAgOiBuZXcgU3RyaW5nW117IE9iamVjdC5j\nbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0\nSWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIC8vIHNpbmdsZSBmaWVsZCBpZGVudGl0eSBhbHdheXMgdGhyb3dz\nIGV4Y2VwdGlvbgogICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0\neSgpKSB7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElOVEVS\nTkVYQ0VQKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIC8vIGNhbGwgc3VwZXJjbGFzcyBtZXRob2QK\nICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCAm\nJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGkpOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAg\nICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgIFBSRSArICJDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZCIsIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAg\nICB9CgogICAgICAgIC8vIE9iamVjdCBpZCA9IG9pZDsKICAgICAgICBpZiAo\nZmllbGRNYW5hZ2VyKQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CgogICAgICAgIGlmIChfbWV0YS5pc09iamVjdElkVHlw\nZVNoYXJlZCgpKSB7CiAgICAgICAgICAgIC8vIG9pZCA9ICgoT2JqZWN0SWQp\nIGlkKS5nZXRJZCAoKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAg\nICB9CgogICAgICAgIC8vIDxvaWQgdHlwZT4gaWQgPSAoPG9pZCB0eXBlPikg\nb2lkOwogICAgICAgIGludCBpZCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElk\nVHlwZSgpOwogICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShvaWRU\neXBlKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGlkKTsKCiAg\nICAgICAgLy8gaW50IGluaGVyaXRlZCA9IHBjSW5oZXJpdGVkRmllbGRDb3Vu\ndDsKICAgICAgICBpbnQgaW5oZXJpdGVkID0gMDsKICAgICAgICBpZiAoZmll\nbGRNYW5hZ2VyKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgaW5oZXJp\ndGVkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAg\nY29kZS5pc3RvcmUoKS5zZXRMb2NhbChpbmhlcml0ZWQpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gaWQuPGZpZWxkPiA9IGZzLmZldGNoPHR5cGU+RmllbGQg\nKDxpbmRleD4pOyBvci4uLgogICAgICAgIC8vIGlkLjxmaWVsZD4gPSBwYy48\nZmllbGQ+OwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAg\nIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBDbGFzcyB0\neXBlOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIEZpZWxkIGZpZWxk\nOwogICAgICAgIE1ldGhvZCBzZXR0ZXI7CiAgICAgICAgYm9vbGVhbiByZWZs\nZWN0OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5\nKCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKCiAgICAgICAgICAgIG5hbWUgPSBm\nbWRzW2ldLmdldE5hbWUoKTsKICAgICAgICAgICAgdHlwZSA9IGZtZHNbaV0u\nZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgaWYgKGlzRmll\nbGRBY2Nlc3MoZm1kc1tpXSkpIHsKICAgICAgICAgICAgICAgIHNldHRlciA9\nIG51bGw7CiAgICAgICAgICAgICAgICBmaWVsZCA9IFJlZmxlY3Rpb24uZmlu\nZEZpZWxkKG9pZFR5cGUsIG5hbWUsIHRydWUpOwogICAgICAgICAgICAgICAg\ncmVmbGVjdCA9ICFNb2RpZmllci5pc1B1YmxpYyhmaWVsZC5nZXRNb2RpZmll\ncnMoKSk7CiAgICAgICAgICAgICAgICBpZiAocmVmbGVjdCkgewogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKG9p\nZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShuYW1lKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywg\nCiAgICAgICAgICAgICAgICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5j\nbGFzcywgbmV3IENsYXNzW10geyBDbGFzcy5jbGFzcywKICAgICAgICAgICAg\nICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgZmllbGQgPSBudWxsOwogICAgICAgICAgICAgICAgc2V0dGVy\nID0gUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5cGUsIG5hbWUsIHR5cGUs\nIHRydWUpOwogICAgICAgICAgICAgICAgcmVmbGVjdCA9ICFNb2RpZmllci5p\nc1B1YmxpYyhzZXR0ZXIuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgICAgICAg\nICAgaWYgKHJlZmxlY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNs\nYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mo\ndHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsIAogICAgICAg\nICAgICAgICAgICAgICAgICAiZmluZFNldHRlciIsIE1ldGhvZC5jbGFzcywg\nbmV3IENsYXNzW10geyBDbGFzcy5jbGFzcywKICAgICAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nLmNsYXNzLCBDbGFzcy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKGZpZWxkTWFuYWdlcikgewogICAgICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICAgICAgY29kZS5p\nbG9hZCgpLnNldExvY2FsKGluaGVyaXRlZCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kCiAgICAgICAgICAgICAgICAgICAgKGdldEZpZWxk\nU3VwcGxpZXJNZXRob2QodHlwZSkpOwogICAgICAgICAgICAgICAgaWYgKGZt\nZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLk9CSkVDVCAmJgogICAgICAgICAgICAgICAgICAgICFmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZSgpLmlzRW51bSgpKSB7CiAgICAgICAgICAgICAgICAJY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgIAljb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2Jq\nZWN0SWQuY2xhc3MsICJnZXRJZCIsIAogICAgICAgICAgICAJCQlPYmplY3Qu\nY2xhc3MsIG51bGwpOyAgICAgICAgICAgICAgICAJCiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHR5cGUgb2YgdGhpcyBm\naWVsZCBtZXRhIGRhdGEgaXMKICAgICAgICAgICAgICAgIC8vIG5vbi1wcmlt\naXRpdmUgYW5kIG5vbi1zdHJpbmcsIGJlIHN1cmUgdG8gY2FzdAogICAgICAg\nICAgICAgICAgLy8gdG8gdGhlIGFwcHJvcHJpYXRlIHR5cGUuCiAgICAgICAg\nICAgICAgICBpZiAoIXJlZmxlY3QgJiYgIXR5cGUuaXNQcmltaXRpdmUoKQog\nICAgICAgICAgICAgICAgICAgICYmICF0eXBlLmdldE5hbWUoKS5lcXVhbHMo\nU3RyaW5nLmNsYXNzLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFs\ndWVDb2RlKGNvZGUsIGZtZHNbaV0pOwoKICAgICAgICAgICAgICAgIC8vIGdl\ndCBpZC9wayBmcm9tIHBjIGluc3RhbmNlCiAgICAgICAgICAgICAgICBpZiAo\nZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBD\nKQogICAgICAgICAgICAgICAgICAgIGFkZEV4dHJhY3RPYmplY3RJZEZpZWxk\nVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAocmVmbGVjdCAmJiBmaWVsZCAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZs\nZWN0aW9uLmNsYXNzLCAic2V0IiwgCiAgICAgICAgICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIEZpZWxkLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgICh0eXBlLmlzUHJpbWl0aXZlKCkp\nID8gdHlwZSA6IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChyZWZsZWN0KSB7IAogICAgICAgICAgICAgICAgY29kZS5pbnZva2Vz\ndGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywgInNldCIsIAog\nICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsg\nT2JqZWN0LmNsYXNzLCBNZXRob2QuY2xhc3MsCiAgICAgICAgICAgICAgICAg\nICAgKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBlIDogT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoZmllbGQp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2Qoc2V0dGVyKTsKICAgICAgICB9CiAgICAg\nICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGNvZGUgdG8gZXh0cmFjdCB0aGUg\naWQgb2YgdGhlIGdpdmVuIHByaW1hcnkga2V5IHJlbGF0aW9uIGZpZWxkIGZv\ncgogICAgICogc2V0dGluZyBpbnRvIGFuIG9iamVjdGlkIGluc3RhbmNlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkRXh0cmFjdE9iamVjdElkRmll\nbGRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIHBrKSB7CiAg\nICAgICAgLy8gaWYgKHZhbCAhPSBudWxsKSAKICAgICAgICAvLyAgdmFsID0g\nKChQZXJzaXN0ZW5jZUNhcGFibGUpIHZhbCkucGNGZXRjaE9iamVjdElkKCk7\nCiAgICAgICAgaW50IHBjID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKHBjKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwocGMpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZm51bGwxID0gY29kZS5pZm51bGwoKTsKICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOyAKICAgICAgICBp\nZiAoIXBrLmdldFR5cGVNZXRhRGF0YSgpLmlzT3BlbkpQQUlkZW50aXR5KCkp\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9k\nKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgIFBS\nRSArICJGZXRjaE9iamVjdElkIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAg\nICAgICAgIFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwgT2JqZWN0LmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgCiAgICAgICAgaW50IG9pZCA9IGNv\nZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5hc3RvcmUo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChvaWQpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZm51bGwyID0gY29k\nZS5pZm51bGwoKTsgCgogICAgICAgIC8vIGZvciBkYXRhc3RvcmUgLyBzaW5n\nbGUtZmllbGQgaWRlbnRpdHk6CiAgICAgICAgLy8gaWYgKHZhbCAhPSBudWxs\nKQogICAgICAgIC8vICAgdmFsID0gKChPcGVuSlBBSWQpIHZhbCkuZ2V0SWQo\nKTsKICAgICAgICBDbGFzc01ldGFEYXRhIHBrbWV0YSA9IHBrLmdldERlY2xh\ncmVkVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgaW50IHBrY29kZSA9IHBrLmdl\ndE9iamVjdElkRmllbGRUeXBlQ29kZSgpOwogICAgICAgIENsYXNzIHBrdHlw\nZSA9IHBrLmdldE9iamVjdElkRmllbGRUeXBlKCk7CiAgICAgICAgaWYgKHBr\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RB\nVEFTVE9SRSAKICAgICAgICAgICAgJiYgcGtjb2RlID09IEphdmFUeXBlcy5M\nT05HKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoSWQuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoSWQuY2xhc3MsICJnZXRJZCIsIAogICAgICAgICAgICAgICAgbG9uZy5j\nbGFzcywgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmIChwa21ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpIHsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAg\nICAgfSBlbHNlIGlmIChwa21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewog\nICAgICAgICAgICBzd2l0Y2ggKHBrY29kZSkgewogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShCeXRlLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5v\nIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShCeXRlSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChCeXRlSWQuY2xhc3MsICJnZXRJZCIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGUuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkJZ\nVEVfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoQnl0ZS5jbGFzcywgIjxpbml0PiIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7Ynl0ZS5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShDaGFyYWN0ZXIu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENoYXJJZC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKENo\nYXJJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nY2hhci5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBr\nY29kZSA9PSBKYXZhVHlwZXMuQ0hBUl9PQkopCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChDaGFyYWN0\nZXIuY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxpbml0\nPiIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHtjaGFyLmNsYXNzfSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYW5ldygpLnNldFR5cGUoRG91YmxlLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5v\nIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9p\nZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKERvdWJsZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRG91YmxlSWQuY2xhc3MsICJn\nZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRvdWJsZS5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZh\nVHlwZXMuRE9VQkxFX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKERvdWJsZS5jbGFzcywgIjxp\nbml0PiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117ZG91YmxlLmNsYXNzfSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0\nVHlwZShGbG9hdC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5k\ndXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEZsb2F0SWQuY2xh\nc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChGbG9hdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAg\nICAgICAgICAgICAgICBmbG9hdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuRkxPQVRfT0JKKQog\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QoRmxvYXQuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde2Zsb2F0\nLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoSW50ZWdlci5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAg\nICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShJbnRJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEludElkLmNsYXNzLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBpbnQuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5\ncGVzLklOVF9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChJbnRlZ2VyLmNsYXNzLCAiPGluaXQ+\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5l\ndyBDbGFzc1tdIHtpbnQuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JK\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoTG9u\nZy5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoTG9uZ0lkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nTG9uZ0lkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAg\nICBsb25nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\ncGtjb2RlID09IEphdmFUeXBlcy5MT05HX09CSikKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKExvbmcu\nY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2xvbmcuY2xhc3N9KTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFu\nZXcoKS5zZXRUeXBlKFNob3J0LmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFr\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU2hv\ncnRJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKFNob3J0SWQuY2xhc3MsICJnZXRJZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIHNob3J0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5TSE9S\nVF9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChTaG9ydC5jbGFzcywgIjxpbml0PiIsIAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW117c2hvcnQuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKERhdGVJ\nZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKERhdGVJZC5jbGFzcywgImdldElkIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgRGF0ZS5jbGFzcywgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBrdHlwZSAhPSBEYXRlLmNsYXNzKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIGphdmEuc3FsLkRhdGUuY2xhc3MKICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKHBrdHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShTdHJpbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZ0lkLmNs\nYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQmln\nRGVjaW1hbElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQmlnRGVjaW1hbElkLmNsYXNzLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBCaWdEZWNpbWFsLmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEJpZ0lu\ndGVnZXJJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEJpZ0ludGVnZXJJZC5jbGFzcywgImdl\ndElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgQmlnSW50ZWdlci5jbGFz\ncywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9i\namVjdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAg\nICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBlbHNlIGlmIChwa21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgIT0gbnVsbCkg\newogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuT0JKRUNUKSB7CiAg\nICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0\nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQiLCAKICAgICAg\nICAgICAgCQkJT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgfSAK\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHBrdHlwZSk7\nCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChvaWQpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBnbzIgPSBjb2Rl\nLmdvMigpOwoKICAgICAgICAvLyBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nLy8gICB2YWwgPSA8ZGVmYXVsdD47CiAgICAgICAgSW5zdHJ1Y3Rpb24gZGVm\nOwogICAgICAgIHN3aXRjaCAocGtjb2RlKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBkZWYgPSBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKGJ5\ndGUpIDApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoKGNoYXIpIDApOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgwRCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoMEYpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAg\nICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5MT05HOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGRl\nZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoc2hvcnQpIDApOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwog\nICAgICAgIH0KICAgICAgICBpZm51bGwxLnNldFRhcmdldChkZWYpOwogICAg\nICAgIGlmbnVsbDIuc2V0VGFyZ2V0KGRlZik7CiAgICAgICAgZ28yLnNldFRh\ncmdldChjb2RlLm5vcCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\ndGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZDwvY29kZT4g\nbWV0aG9kcwogICAgICogdG8gY2xhc3NlcyB1c2luZyBhcHBsaWNhdGlvbiBp\nZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENvcHlLZXlG\naWVsZHNGcm9tT2JqZWN0SWRNZXRob2QoYm9vbGVhbiBmaWVsZE1hbmFnZXIp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElk\nIChPYmplY3RJZEZpZWxkQ29uc3VtZXIgZmMsCiAgICAgICAgLy8JT2JqZWN0\nIG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZpZWxkTWFuYWdlcikg\nCiAgICAgICAgICAgID8gIG5ldyBTdHJpbmdbXXsgT0lERkNUWVBFLmdldE5h\nbWUoKSwgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9CiAgICAgICAgICAgIDog\nbmV3IFN0cmluZ1tdeyBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAg\nICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lk\nLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGNhbGwgc3VwZXJj\nbGFzcyBtZXRob2QKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNz\nKCkgIT0gbnVsbCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGkpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlw\nZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIFBSRSArICJDb3B5\nS2V5RmllbGRzRnJvbU9iamVjdElkIiwgdm9pZC5jbGFzcy5nZXROYW1lKCks\nIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwoK\nICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYgX21l\ndGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewogICAgICAgICAgICAvLyBv\naWQgPSAoKE9iamVjdElkKSBpZCkuZ2V0SWQgKCk7CiAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJ\nZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFz\ncywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICAvLyA8b2lkIHR5cGU+IGNh\nc3QgPSAoPG9pZCB0eXBlPikgb2lkOwogICAgICAgIGludCBpZCA9IGNvZGUu\nZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9\nIF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShvaWRUeXBlKTsKICAgICAgICBjb2RlLmFzdG9yZSgp\nLnNldExvY2FsKGlkKTsKCiAgICAgICAgLy8gZnMuc3RvcmU8dHlwZT5GaWVs\nZCAoPGluZGV4PiwgaWQuPGZpZWxkPik7IG9yLi4uCiAgICAgICAgLy8gdGhp\ncy48ZmllbGQ+ID0gaWQuPGZpZWxkPgogICAgICAgIC8vIG9yIGZvciBzaW5n\nbGUgZmllbGQgaWRlbnRpdHk6IGlkLmdldElkICgpCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEu\nZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZp\nZWxkcygpOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIENsYXNzIHR5\ncGU7CiAgICAgICAgQ2xhc3MgdW53cmFwcGVkOwogICAgICAgIEZpZWxkIGZp\nZWxkOwogICAgICAgIE1ldGhvZCBnZXR0ZXI7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlm\nICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0TmFtZSgp\nOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxk\nVHlwZSgpOwogICAgICAgICAgICBpZiAoIWZpZWxkTWFuYWdlciAKICAgICAg\nICAgICAgICAgICYmIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAgICAgLy8gaWYgKHNtID09\nIG51bGwpIHJldHVybjsKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5nZXRm\naWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAg\nSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAg\nICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICAgICAg\nLy8gc20uZ2V0UENQcmltYXJ5S2V5KG9pZCwgaSArIHBjSW5oZXJpdGVkRmll\nbGRDb3VudCk7IAogICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAg\nICAgIGNvZGUuZHVwKCk7IC8vIGxlYXZlIG9yaWcgb24gc3RhY2sgdG8gc2V0\nIHZhbHVlIGludG8KICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChpZCk7CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgICAgICBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFN0YXRlTWFuYWdlci5jbGFzcywg\nCiAgICAgICAgICAgICAgICAgICAgImdldFBDUHJpbWFyeUtleSIsIE9iamVj\ndC5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBP\nYmplY3QuY2xhc3MsIGludC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZSgpKTsKICAgICAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAgICAgICB1\nbndyYXBwZWQgPSAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0g\nSmF2YVR5cGVzLlBDKSAKICAgICAgICAgICAgICAgICAgICA/IHR5cGUgOiB1\nbndyYXBTaW5nbGVGaWVsZElkZW50aXR5KGZtZHNbaV0pOwogICAgICAgICAg\nICAgICAgaWYgKGZpZWxkTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAg\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CgogICAgICAgICAgICAgICAg\naWYgKHVud3JhcHBlZCAhPSB0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKICAgICAgICAgICAgICAg\nIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKG9pZFR5cGUgPT0gT2JqZWN0SWQuY2xhc3MpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoIWZpZWxkTWFuYWdlciAmJiB0eXBlICE9IE9iamVjdC5j\nbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9pZFR5cGUgPT0gRGF0ZUlk\nLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgRGF0ZS5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRNYW5hZ2VyICYmIHR5cGUg\nIT0gRGF0ZS5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZSgpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nb2lkVHlwZSwgImdldElkIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB1bndyYXBwZWQsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAodW53cmFwcGVkICE9IHR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgIjxp\nbml0PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5j\nbGFzcywgbmV3IENsYXNzW117IHVud3JhcHBlZCB9KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzRmllbGRB\nY2Nlc3MoZm1kc1tpXSkpIHsKICAgICAgICAgICAgICAgICAgICBmaWVsZCA9\nIFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUsIHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1B1YmxpYyhmaWVs\nZC5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZmxl\nY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgp\nLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10g\neyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBT\ndHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlvbkdldHRlck1l\ndGhvZCh0eXBlLCBGaWVsZC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVj\ndC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIGdldHRlciA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWRUeXBlLCBuYW1l\nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNQ\ndWJsaWMoZ2V0dGVyLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldHRl\ncik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlv\nbi5maW5kR2V0dGVyKC4uLikpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5h\nbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAiZmluZEdldHRlciIsIE1ldGhv\nZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChn\nZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUsIE1ldGhvZC5jbGFzcykp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRp\ndmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChn\nZXRGaWVsZENvbnN1bWVyTWV0aG9kKHR5cGUpKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWRzW2ldKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGlmIHRoZSBjbGFzcyB1c2VzIHRoZSBDbGFzcy9TdHJpbmcg\nY29uc3RydWN0b3IKICAgICAqIGluc3RlYWQgb2YganVzdCBTdHJpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiB1c2VzQ2xhc3NTdHJpbmdJZENv\nbnN0cnVjdG9yKCkgewogICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5\ncGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAg\nICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgaWYgKF9tZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKF9tZXRh\nLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNzKQogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBCb29s\nZWFuLlRSVUU7CiAgICAgICAgfQoKICAgICAgICBDbGFzcyBvaWRUeXBlID0g\nX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3NbXXsgQ2xh\nc3MuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uVFJVRTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBvaWRUeXBl\nLmdldENvbnN0cnVjdG9yKG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7\nCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgIH0g\nY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhlIGdpdmVuIGZp\nZWxkIGlzIGEgd3JhcHBlci10eXBlIHNpbmdsZSBmaWVsZCBpZGVudGl0eSBw\ncmltYXJ5IGtleSwKICAgICAqIHJldHVybiBpdHMgY29ycmVzcG9uZGluZyBw\ncmltaXRpdmUgY2xhc3MuIEVsc2UgcmV0dXJuIHRoZSBmaWVsZCB0eXBlLgog\nICAgICovCiAgICBwcml2YXRlIENsYXNzIHVud3JhcFNpbmdsZUZpZWxkSWRl\nbnRpdHkoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoIWZtZC5n\nZXREZWZpbmluZ01ldGFEYXRhKCkuaXNPcGVuSlBBSWRlbnRpdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKCiAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGJ5dGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXIuY2xh\nc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmxvYXQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLklOVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50LmNsYXNzOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAg\nICAgICAgICByZXR1cm4gc2hvcnQuY2xhc3M7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGxv\nbmcuY2xhc3M7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGdldHRlciBt\nZXRob2Qgb2YgdGhlIHtAbGluayBSZWZsZWN0aW9ufSBoZWxwZXIgZm9yCiAg\nICAgKiBhIGZpZWxkIG9yIGdldHRlciBtZXRob2Qgb2YgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldFJlZmxlY3Rpb25H\nZXR0ZXJNZXRob2QoQ2xhc3MgdHlwZSwgQ2xhc3MgYXJnVHlwZSkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBTdHJp\nbmcgbmFtZSA9ICJnZXQiOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZl\nKCkpCiAgICAgICAgICAgIG5hbWUgKz0gU3RyaW5nVXRpbHMuY2FwaXRhbGl6\nZSh0eXBlLmdldE5hbWUoKSk7CiAgICAgICAgcmV0dXJuIFJlZmxlY3Rpb24u\nY2xhc3MuZ2V0TWV0aG9kKG5hbWUsIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNs\nYXNzLCAKICAgICAgICAgICAgYXJnVHlwZSB9KTsgCiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBmZXRjaCBtZXRob2Qgb2YgdGhl\nIE9iamVjdElkRmllbGRTdXBwbGllciBmb3IKICAgICAqIGEgZmllbGQgb2Yg\ndGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdl\ndEZpZWxkU3VwcGxpZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0\nTWV0aG9kKE9JREZTVFlQRSwgdHlwZSwgImZldGNoIiwgdHJ1ZSwgZmFsc2Us\nIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJv\ncGVyIGZldGNoIG1ldGhvZCBvZiB0aGUgT2JqZWN0SWRGaWVsZENvbnN1bWVy\nIGZvcgogICAgICogYSBmaWVsZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0RmllbGRDb25zdW1lck1ldGhvZChD\nbGFzcyB0eXBlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBnZXRNZXRob2QoT0lERkNUWVBFLCB0eXBl\nLCAic3RvcmUiLCBmYWxzZSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgdGhlIHBjTmV3T2JqZWN0SWRJbnN0YW5jZSBtZXRo\nb2QgdG8gY2xhc3NlcyB1c2luZwogICAgICogYXBwbGljYXRpb24gaWRlbnRp\ndHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROZXdPYmplY3RJZElu\nc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2JqKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyBPYmplY3Qg\ncGNOZXdPYmplY3RJZEluc3RhbmNlICgpCiAgICAgICAgQ2xhc3NbXSBhcmdz\nID0gKG9iaikgPyBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0gOiBudWxs\nOwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9k\nKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwKICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgQm9vbGVhbiB1c2VzQ2xzU3RyaW5n\nID0gdXNlc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3RvcigpOwogICAgICAgIENs\nYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAg\nICBpZiAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0gbnVsbCkgewogICAgICAg\nICAgICAvLyB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgu\nLi4pOwogICAgICAgICAgICBTdHJpbmcgbXNnID0gX2xvYy5nZXQoInN0ci1j\nb25zIiwgb2lkVHlwZSwKICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSkuZ2V0TWVzc2FnZSgpOwogICAgICAgICAgICBjb2RlLmFu\nZXcoKS5zZXRUeXBlKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShtc2cpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nLmNsYXNzLAogICAgICAgICAgICAgICAgIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIGNv\nZGUuYXRocm93KCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlk\nZW50aXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewog\nICAgICAgICAgICAvLyBuZXcgT2JqZWN0SWQgKGNscywgb2lkKQogICAgICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgaWYoX21ldGEuaXNF\nbWJlZGRlZE9ubHkoKSB8fCBfbWV0YS5oYXNBYnN0cmFjdFBLRmllbGQoKSA9\nPSB0cnVlKSB7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJHZXRJRE93bmluZ0NsYXNzIiwKICAgICAgICAgICAg\nICAgICAgICBDbGFzcy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRD\nbGFzcyhnZXRUeXBlKF9tZXRhKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8vIG5ldyA8b2lkIGNsYXNzPiAoKTsKICAgICAgICBjb2Rl\nLmFuZXcoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgfHwgKG9i\naiAmJiB1c2VzQ2xzU3RyaW5nID09CiAgICAgICAgICAgICAgICAgICAgQm9v\nbGVhbi5UUlVFKSkgewogICAgICAgICAgICBpZihfbWV0YS5pc0VtYmVkZGVk\nT25seSgpIHx8IF9tZXRhLmhhc0Fic3RyYWN0UEtGaWVsZCgpID09IHRydWUg\nKSB7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKFBSRSArICJHZXRJRE93bmluZ0NsYXNzIiwKICAgICAgICAgICAgICAgICAg\nICBDbGFzcy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH1lbHNlIHsKICAg\nICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdl\ndFR5cGUoX21ldGEpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBpZiAob2JqKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFN0\ncmluZy5jbGFzcyk7CiAgICAgICAgICAgIGlmICh1c2VzQ2xzU3RyaW5nID09\nIEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xh\nc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcyB9OwogICAgICAgICAg\nICBlbHNlIGlmICh1c2VzQ2xzU3RyaW5nID09IEJvb2xlYW4uRkFMU0UpCiAg\nICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IFN0cmluZy5jbGFz\ncyB9OwogICAgICAgIH0gZWxzZSBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRp\ndHkoKSkgewogICAgICAgICAgICAvLyBuZXcgPHR5cGU+SWRlbnRpdHkgKFhY\nWC5jbGFzcywgPHBrPik7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIHBr\nID0gX21ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpWzBdOwogICAgICAgICAg\nICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrKTsKICAgICAgICAg\nICAgaWYgKHBrLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nUEMpCiAgICAgICAgICAgICAgICBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZh\nbHVlQ29kZShjb2RlLCBwayk7CiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRP\nYmplY3RJZFR5cGUoKSA9PSBPYmplY3RJZC5jbGFzcykKICAgICAgICAgICAg\nICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIE9iamVjdC5j\nbGFzcyB9OwogICAgICAgICAgICBlbHNlIGlmIChfbWV0YS5nZXRPYmplY3RJ\nZFR5cGUoKSA9PSBEYXRlLmNsYXNzKQogICAgICAgICAgICAgICAgYXJncyA9\nIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgRGF0ZS5jbGFzcyB9OwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNz\nW117IENsYXNzLmNsYXNzLCBway5nZXRPYmplY3RJZEZpZWxkVHlwZSgpIH07\nCiAgICAgICAgfQoKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2Qob2lkVHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIGFyZ3MpOwog\nICAgICAgIGlmICghX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSAmJiBfbWV0\nYS5pc09iamVjdElkVHlwZVNoYXJlZCgpKQogICAgICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICI8aW5p\ndD4iLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117\nIENsYXNzLmNsYXNzLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hlbiBjb21tdW5pY2F0aW5nIHdpdGggdGhlIFN0YXRl\nTWFuYWdlciwgbWFueSBtZXRob2RzIGFyZSB1c2VkCiAgICAgKiBkZXBlbmRp\nbmcgb24gdGhlIGNsYXNzIG9mIHN0YXRlIGJlaW5nIHBhc3NlZC4gVGhpcyBt\nZXRob2QsCiAgICAgKiBnaXZlbiB0aGUgdHlwZSBvZiBpbmZvcm1hdGlvbiBi\nZWluZyBwYXNzZWQgYW5kIHRoZSBwcmVmaXgKICAgICAqICgncHJvdmlkZWQn\nLCAncmVwbGFjZScsIGV0Yykgb2YgdGhlIG1ldGhvZCB0bwogICAgICogY2Fs\nbCwgcmV0dXJucyB0aGUgU3RhdGVNYW5hZ2VyIG1ldGhvZCB0aGF0IHNob3Vs\nZCBiZSB1c2VkLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBl\nIG9mIHN0YXRlIGJlaW5nIHBhc3NlZAogICAgICogQHBhcmFtIHByZWZpeCB0\naGUgcHJlZml4IG9mIHRoZSBtZXRob2QgdG8gY2FsbDsgYWxsIG1ldGhvZHMK\nICAgICAqIGVuZCBpbiAnW3N0YXRlIHR5cGVdRmllbGQnOyBvbmx5IHRoZSBw\ncmVmaXggdmFyaWVzCiAgICAgKiBAcGFyYW0gZ2V0IHRydWUgaWYgcmVjZWl2\naW5nIGluZm9ybWF0aW9uIGZyb20gdGhlCiAgICAgKiBTdGF0ZU1hbmFnZXIs\nIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhlIFNNCiAgICAgKiBAcGFyYW0g\nY3VyVmFsdWUgdHJ1ZSBpZiB0aGUgY3VycmVudCBzdGF0ZSB2YWx1ZSBpcyBw\nYXNzZWQgdG8KICAgICAqIHRoZSBTdGF0ZU1hbmFnZXIgYXMgYW4gZXh0cmEg\nYXJndW1lbnQKICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0U3RhdGVN\nYW5hZ2VyTWV0aG9kKENsYXNzIHR5cGUsIFN0cmluZyBwcmVmaXgsCiAgICAg\nICAgYm9vbGVhbiBnZXQsIGJvb2xlYW4gY3VyVmFsdWUpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdl\ndE1ldGhvZChTTVRZUEUsIHR5cGUsIHByZWZpeCwgZ2V0LCB0cnVlLCBjdXJW\nYWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGhv\nZCBvZiB0aGUgZ2l2ZW4gb3duZXIgdHlwZSBtYXRjaGluZyB0aGUgZ2l2ZW4g\nY3JpdGVyaWEuCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhlIHR5cGUg\nb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAgICAgKiBAcGFyYW0gcHJlZml4IHRo\nZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0byBjYWxsOyBhbGwgbWV0aG9kcwog\nICAgICogZW5kIGluICdbc3RhdGUgdHlwZV1GaWVsZCc7IG9ubHkgdGhlIHBy\nZWZpeCB2YXJpZXMKICAgICAqIEBwYXJhbSBnZXQgdHJ1ZSBpZiByZWNlaXZp\nbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUKICAgICAqIG93bmVyLCBmYWxzZSBp\nZiBwYXNzaW5nIGl0IHRvIHRoZSBvd25lcgogICAgICogQHBhcmFtIGhhc3Bj\nIHRydWUgaWYgdGhlIHBjIGlzIHBhc3NlZCBhcyBhbiBleHRyYSBhcmd1bWVu\ndAogICAgICogQHBhcmFtIGN1clZhbHVlIHRydWUgaWYgdGhlIGN1cnJlbnQg\nc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRvCiAgICAgKiB0aGUgb3duZXIgYXMg\nYW4gZXh0cmEgYXJndW1lbnQKICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2Qg\nZ2V0TWV0aG9kKENsYXNzIG93bmVyLCBDbGFzcyB0eXBlLCBTdHJpbmcgcHJl\nZml4LAogICAgICAgIGJvb2xlYW4gZ2V0LCBib29sZWFuIGhhc3BjLCBib29s\nZWFuIGN1clZhbHVlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIGFsbCBtZXRob2RzIGVuZCBpbiBbZmllbGQg\ndHlwZV1GaWVsZCwgd2hlcmUgdGhlIGZpZWxkIHR5cGUKICAgICAgICAvLyBj\nYW4gYmUgYW55IG9mIHRoZSBwcmltaXR2ZSB0eXBlcyAoYnV0IGNhcGl0YWxp\nemVkKSwgJ1N0cmluZycsCiAgICAgICAgLy8gb3IgJ09iamVjdCc7IGZpZ3Vy\nZSBvdXQgd2hhdCB0eXBlIHRvIHVzZQogICAgICAgIFN0cmluZyB0eXBlTmFt\nZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0\naXZlKCkpCiAgICAgICAgICAgIHR5cGVOYW1lID0gdHlwZU5hbWUuc3Vic3Ry\naW5nKDAsIDEpLnRvVXBwZXJDYXNlKExvY2FsZS5FTkdMSVNIKQogICAgICAg\nICAgICAgICAgKyB0eXBlTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgZWxz\nZSBpZiAodHlwZS5lcXVhbHMoU3RyaW5nLmNsYXNzKSkKICAgICAgICAgICAg\ndHlwZU5hbWUgPSAiU3RyaW5nIjsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgdHlwZU5hbWUgPSAiT2JqZWN0IjsKICAgICAgICAgICAgdHlwZSA9IE9i\namVjdC5jbGFzczsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBmaWVsZCBp\nbmRleCBpcyBhbHdheXMgcGFzc2VkIGFzIGFuIGFyZzsgdGhlIHBjIGluc3Rh\nbmNlIGFuZAogICAgICAgIC8vIHRoZSBjdXJyZW50IHZhbHVlIG1heSBiZSBw\nYXNzZWQ7IGlmIHNldHRpbmcgdGhlIG5ldyB2YWx1ZSBpcwogICAgICAgIC8v\nIGFsc28gcGFzc2VkCiAgICAgICAgTGlzdCBwbGlzdCA9IG5ldyBBcnJheUxp\nc3QoNCk7CiAgICAgICAgaWYgKGhhc3BjKQogICAgICAgICAgICBwbGlzdC5h\nZGQoUENUWVBFKTsKICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNzKTsKICAg\nICAgICBpZiAoIWdldCB8fCBjdXJWYWx1ZSkKICAgICAgICAgICAgcGxpc3Qu\nYWRkKHR5cGUpOwogICAgICAgIGlmICghZ2V0ICYmIGN1clZhbHVlKSB7CiAg\nICAgICAgICAgIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICAgICAgcGxpc3Qu\nYWRkKGludC5jbGFzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyB1c2UgcmVm\nbGVjdGlvbiB0byByZXR1cm4gdGhlIHJpZ2h0IG1ldGhvZAogICAgICAgIFN0\ncmluZyBuYW1lID0gcHJlZml4ICsgdHlwZU5hbWUgKyAiRmllbGQiOwogICAg\nICAgIENsYXNzW10gcGFyYW1zID0gKENsYXNzW10pIHBsaXN0LnRvQXJyYXko\nbmV3IENsYXNzW3BsaXN0LnNpemUoKV0pOwogICAgICAgIAogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERl\nY2xhcmVkTWV0aG9kQWN0aW9uKG93bmVyLCBuYW1lLCBwYXJhbXMpKTsKICAg\nICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBhZSkg\newogICAgICAgICAgICAgdGhyb3cgKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbikg\ncGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRoZSBjb2RlIG5lY2Vzc2Fy\neSB0byB0aHJvdyB0aGUgZ2l2ZW4KICAgICAqIGV4Y2VwdGlvbiB0eXBlLCBz\nYW5zIG1lc3NhZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1Y3Rpb24g\ndGhyb3dFeGNlcHRpb24oQ29kZSBjb2RlLCBDbGFzcyB0eXBlKSB7CiAgICAg\nICAgSW5zdHJ1Y3Rpb24gaW5zID0gY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBl\nKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgY29kZS5hdGhyb3coKTsKICAgICAgICByZXR1cm4g\naW5zOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgUGVyc2lzdGVu\nY2VDYXBhYmxlIGludGVyZmFjZSB0byB0aGUgY2xhc3MgYmVpbmcKICAgICAq\nIGVuaGFuY2VkLCBhbmQgYWRkcyBhIGRlZmF1bHQgY29uc3RydWN0b3IgZm9y\nIHVzZSBieSBPcGVuSlBBCiAgICAgKiBpZiBpdCBpcyBub3QgYWxyZWFkeSBw\ncmVzZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5oYW5jZUNsYXNz\nKCkgewogICAgICAgIC8vIG1ha2UgdGhlIGNsYXNzIGltcGxlbWVudCBQZXJz\naXN0ZW5jZUNhcGFibGUKICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFjZShQ\nQ1RZUEUpOwoKICAgICAgICAvLyBhZGQgYSB2ZXJzaW9uIHN0YW1wCiAgICAg\nICAgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb25NZXRob2QoKTsK\nCiAgICAgICAgLy8gZmluZCB0aGUgZGVmYXVsdCBjb25zdHJ1Y3RvcgogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgi\nPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKCiAgICAgICAgLy8gYSBkZWZh\ndWx0IGNvbnN0cnVjdG9yIGlzIHJlcXVpcmVkCiAgICAgICAgaWYgKG1ldGhv\nZCA9PSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBuYW1lID0gX3BjLmdl\ndE5hbWUoKTsKICAgICAgICAgICAgaWYgKCFfZGVmQ29ucykKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbmhh\nbmNlLWRlZmF1bHRjb25zdCIsIG5hbWUpKTsKCiAgICAgICAgICAgIG1ldGhv\nZCA9IF9wYy5hZGREZWZhdWx0Q29uc3RydWN0b3IoKTsKICAgICAgICAgICAg\nU3RyaW5nIGFjY2VzczsKICAgICAgICAgICAgaWYgKF9tZXRhLmlzRGV0YWNo\nYWJsZSgpKSB7CiAgICAgICAgICAgICAgICAvLyBleHRlcm5hbGl6YWJsZSBy\nZXF1aXJlcyB0aGF0IHRoZSBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgICAg\nLy8gYmUgcHVibGljLCBzbyBtYWtlIHRoZSBhZGRlZCBjb25zdHJ1Y3RvciBw\ndWJsaWMKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAg\nICAgICAgICAgICAgICBhY2Nlc3MgPSAicHVibGljIjsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChfcGMuaXNGaW5hbCgpKSB7CiAgICAgICAgICAgICAgICBt\nZXRob2QubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGFjY2VzcyA9\nICJwcml2YXRlIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgICAgICBh\nY2Nlc3MgPSAicHJvdGVjdGVkIjsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAoIShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZhY2Uo\nKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAgICAgJiYg\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImVuaGFuY2UtYWRkZGVmYXVsdGNvbnN0IiwgbmFtZSwg\nYWNjZXNzKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyB0aGUgZm9sbG93aW5nIGZpZWxkcyB0byB0aGUgUGVyc2lzdGVuY2VDYXBh\nYmxlIGluc3RhbmNlOgogICAgICogPHVsPgogICAgICogPGxpPjxjb2RlPnBy\naXZhdGUgc3RhdGljIGludCBwY0luaGVyaXRlZEZpZWxkQ291bnQ8L2NvZGU+\nPC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBDbGFzcyBw\nY1BDU3VwZXJjbGFzczwvY29kZT4KICAgICAqIDwvbGk+CiAgICAgKiA8bGk+\nPGNvZGU+cHJpdmF0ZSBzdGF0aWMgU3RyaW5nW10gcGNGaWVsZE5hbWVzPC9j\nb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgQ2xh\nc3NbXSBwY0ZpZWxkVHlwZXM8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29k\nZT5wcml2YXRlIHN0YXRpYyBieXRlW10gcGNGaWVsZEZsYWdzPC9jb2RlPjwv\nbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJvdGVjdGVkIHRyYW5zaWVudCBTdGF0\nZU1hbmFnZXIgcGNTdGF0ZU1hbmFnZXI8L2NvZGU+CiAgICAgKiBpZiBubyBQ\nZXJzaXN0ZW5jZUNhcGFibGUgc3VwZXJjbGFzcyBwcmVzZW50KTwvbGk+CiAg\nICAgKiA8L3VsPgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkRmllbGRz\nKCkgewogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoSU5IRVJJVCwgaW50LmNs\nYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVs\nZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKS5zZXRTdGF0\naWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQUkUgKyAiRmll\nbGRUeXBlcyIsIENsYXNzW10uY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsKICAg\nICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0\nZVtdLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xh\ncmVGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsK\nICAgICAgICBpZihfYWRkVmVyc2lvbkluaXRGbGFnICYmIF9tZXRhLmdldFZl\ncnNpb25GaWVsZCgpIT1udWxsKXsKICAgICAgICAgICAgLy8gcHJvdGVjdGVk\nIHRyYW5zaWVudCBib29sZWFuIHBjVmVyc2lvbkluaXQ7CiAgICAgICAgICAg\nIEJDRmllbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKFZFUlNJT05fSU5J\nVF9TVFIsIGJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBmaWVsZC5tYWtl\nUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGZpZWxkLnNldFRyYW5zaWVudCh0\ncnVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJj\nbGFzcygpID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAg\nICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZChTTSwg\nU01UWVBFKTsKICAgICAgICAgICAgZmllbGQubWFrZVByb3RlY3RlZCgpOwog\nICAgICAgICAgICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogTW9kaWZpZXMgdGhlIGNsYXNzIGlu\naXRpYWxpemF0aW9uIG1ldGhvZCAoY3JlYXRpbmcgb25lIGlmIG5lY2Vzc2Fy\neSkKICAgICAqIHRvIGluaXRpYWxpemUgdGhlIHN0YXRpYyBmaWVsZHMgb2Yg\ndGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZSBhbmQKICAgICAqIHRv\nIHJlZ2lzdGVyIGl0IHdpdGggdGhlIGltcGwgaGVscGVyLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKSB7CiAgICAg\nICAgQ29kZSBjb2RlID0gZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKHRydWUp\nOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAg\nICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAg\nICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKElOSEVS\nSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAvLyBwY0luaGVyaXRlZEZpZWxkQ291bnQgPSA8c3VwZXJDbGFz\ncz4ucGNHZXRNYW5hZ2VkRmllbGRDb3VudCgpCiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgog\nICAgICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkp\nLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFu\nYWdlZEZpZWxkQ291bnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsK\nICAgICAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoSU5I\nRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gcGNQQ1N1cGVyY2xhc3MgPSA8c3VwZXJDbGFzcz47CiAgICAgICAgICAg\nIC8vIHRoaXMgaW50ZW50aW9uYWxseSBjYWxscyBnZXREZXNjcmliZWRUeXBl\nKCkgZGlyZWN0bHkKICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiBQQ0VuaGFu\nY2VyLmdldFR5cGUoKQogICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQo\nKS5zZXRDbGFzcygKICAgICAgICAgICAgICAgIF9tZXRhLmdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAg\nICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xh\nc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gcGNGaWVsZE5hbWVzID0gbmV3\nIFN0cmluZ1tdIHsgIjxuYW1lMT4iLCAiPG5hbWUyPiIsIC4uLiB9OwogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1k\ncy5sZW5ndGgpOwogICAgICAgIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlwZShT\ndHJpbmcuY2xhc3MpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzW2ldLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAg\nICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5h\nbWVzIiwgU3RyaW5nW10uY2xhc3MpOwoKICAgICAgICAvLyBwY0ZpZWxkVHlw\nZXMgPSBuZXcgQ2xhc3NbXSB7IDx0eXBlMT4uY2xhc3MsIDx0eXBlMj4uY2xh\nc3MsIC4uLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nbWRzLmxlbmd0aCk7CiAgICAgICAgY29kZS5hbmV3YXJyYXkoKS5zZXRUeXBl\nKENsYXNzLmNsYXNzKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAg\nICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7\nCiAgICAgICAgfQogICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQo\nUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsKCiAgICAgICAg\nLy8gcGNGaWVsZEZsYWdzID0gbmV3IGJ5dGVbXSB7IDxmbGFnMT4sIDxmbGFn\nMj4sIC4uLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nbWRzLmxlbmd0aCk7CiAgICAgICAgY29kZS5uZXdhcnJheSgpLnNldFR5cGUo\nYnl0ZS5jbGFzcyk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGdldEZpZWxkRmxhZyhmbWRz\nW2ldKSk7CiAgICAgICAgICAgIGNvZGUuYmFzdG9yZSgpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVs\nZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKCiAgICAgICAgLy8gUENSZWdpc3Ry\neS5yZWdpc3RlciAoY2xzLAogICAgICAgIC8vCXBjRmllbGROYW1lcywgcGNG\naWVsZFR5cGVzLCBwY0ZpZWxkRmxhZ3MsCiAgICAgICAgLy8gIHBjUENTdXBl\ncmNsYXNzLCBhbGlhcywgbmV3IFhYWCAoKSk7CiAgICAgICAgY29kZS5jbGFz\nc2NvbnN0YW50KCkuc2V0Q2xhc3MoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJG\naWVsZE5hbWVzIiwgU3RyaW5nW10uY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1td\nLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBS\nRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcyk7CiAg\nICAgICAgCiAgICAgICAgaWYgKF9tZXRhLmlzTWFwcGVkKCkgfHwgX21ldGEu\naXNBYnN0cmFjdCgpKQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoX21ldGEuZ2V0VHlwZUFsaWFzKCkpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKCiAgICAgICAg\naWYgKF9wYy5pc0Fic3RyYWN0KCkpCiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXROdWxsKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNv\nZGUuYW5ldygpLnNldFR5cGUoX3BjKTsKICAgICAgICAgICAgY29kZS5kdXAo\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9k\nKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICB9CgogICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKEhFTFBFUlRZUEUs\nICJyZWdpc3RlciIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nW10uY2xhc3MsIENsYXNzW10uY2xh\nc3MsCiAgICAgICAgICAgICAgICBieXRlW10uY2xhc3MsIENsYXNzLmNsYXNz\nLCBTdHJpbmcuY2xhc3MsIFBDVFlQRSB9KTsKCiAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmbGFnIGZvciB0aGUgZ2l2\nZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJ5dGUgZ2V0\nRmllbGRGbGFnKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZt\nZC5nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfTk9O\nRSkKICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICBieXRlIGZsYWdz\nID0gMDsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpLmlzUHJp\nbWl0aXZlKCkKICAgICAgICAgICAgfHwgU2VyaWFsaXphYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oZm1kLmdldERlY2xhcmVkVHlwZSgpKSkKICAgICAg\nICAgICAgZmxhZ3MgPSBQZXJzaXN0ZW5jZUNhcGFibGUuU0VSSUFMSVpBQkxF\nOwoKICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1l\ndGFEYXRhLk1BTkFHRV9UUkFOU0FDVElPTkFMKQogICAgICAgICAgICBmbGFn\ncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfV1JJVEU7CiAgICAgICAg\nZWxzZSBpZiAoIWZtZC5pc1ByaW1hcnlLZXkoKSAmJiAhZm1kLmlzSW5EZWZh\ndWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICBmbGFncyB8PSBQZXJzaXN0\nZW5jZUNhcGFibGUuQ0hFQ0tfV1JJVEUKICAgICAgICAgICAgICAgIHwgUGVy\nc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1JFQUQ7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuTUVESUFURV9X\nUklURQogICAgICAgICAgICAgICAgfCBQZXJzaXN0ZW5jZUNhcGFibGUuTUVE\nSUFURV9SRUFEOwogICAgICAgIHJldHVybiBmbGFnczsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgdGhlIGNvZGUgdG8gcHJvcGVybHkgaGFuZGxlIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBzZXJpYWxpemF0aW9uCiAgICAgKiB0byB0aGUg\nYnl0ZWNvZGUuIFRoaXMgaW5jbHVkZXMgY3JlYXRpbmcgYW5kIGluaXRpYWxp\nemluZyB0aGUKICAgICAqIHN0YXRpYyA8Y29kZT5zZXJpYWxWZXJzaW9uVUlE\nPC9jb2RlPiBjb25zdGFudCBpZiBub3QgYWxyZWFkeSBkZWZpbmVkLAogICAg\nICogYXMgd2VsbCBhcyBjcmVhdGluZyBhIGN1c3RvbSA8Y29kZT53cml0ZU9i\namVjdDwvY29kZT4gbWV0aG9kIGlmIHRoZQogICAgICogY2xhc3MgaXMgU2Vy\naWFsaXphYmxlIGFuZCBkb2VzIG5vdCBkZWZpbmUgdGhlbS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGFkZFNlcmlhbGl6YXRpb25Db2RlKCkgewogICAg\nICAgIGlmIChleHRlcm5hbGl6ZURldGFjaGVkKCkKICAgICAgICAgICAgfHwg\nIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8g\nIyMjIyMgd2hhdCBzaG91bGQgaGFwcGVuIGlmIGEgdHlwZSBpcyBFeHRlcm5h\nbGl6YWJsZT8gSXQgbG9va3MKICAgICAgICAgICAgLy8gIyMjIyMgbGlrZSBF\neHRlcm5hbGl6YWJsZSBjbGFzc2VzIHdpbGwgbm90IGJlIHNlcmlhbGl6ZWQg\nYXMgUENzCiAgICAgICAgICAgIC8vICMjIyMjIGJhc2VkIG9uIHRoaXMgbG9n\naWMuCiAgICAgICAgICAgIGlmICghRXh0ZXJuYWxpemFibGUuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSgKICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSkpCiAgICAgICAgICAgICAgICBhZGRTdWJjbGFzc1Nlcmlh\nbGl6YXRpb25Db2RlKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIC8vIGlmIG5vdCBhbHJlYWR5IHByZXNlbnQsIGFkZCBhIHNl\ncmlhbFZlcnNpb25VSUQgZmllbGQ7IGlmIHRoZSBpbnN0YW5jZQogICAgICAg\nIC8vIGlzIGRldGFjaGFibGUgYW5kIHVzZXMgZGV0YWNoZWQgc3RhdGUgd2l0\naG91dCBhIGRlY2xhcmVkIGZpZWxkLAogICAgICAgIC8vIGNhbid0IGFkZCBh\nIHNlcmlhbCB2ZXJzaW9uIFVJRCBiZWNhdXNlIHdlJ2xsIGJlIGFkZGluZyBl\neHRyYSBmaWVsZHMKICAgICAgICAvLyB0byB0aGUgZW5oYW5jZWQgdmVyc2lv\nbgogICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0RGVjbGFyZWRGaWVs\nZCgic2VyaWFsVmVyc2lvblVJRCIpOwogICAgICAgIGlmIChmaWVsZCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIExvbmcgdWlkID0gbnVsbDsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHVpZCA9IE51bWJlcnMudmFsdWVP\nZihPYmplY3RTdHJlYW1DbGFzcy5sb29rdXAKICAgICAgICAgICAgICAgICAg\nICAoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKS5nZXRTZXJpYWxWZXJzaW9u\nVUlEKCkpOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewog\nICAgICAgICAgICAgICAgLy8gbGFzdC1jaGFuY2UgY2F0Y2ggZm9yIGJ1ZyAj\nMjgzICh3aGljaCBjYW4gaGFwcGVuCiAgICAgICAgICAgICAgICAvLyBpbiBh\nIHZhcmlldHkgb2YgQ2xhc3NMb2FkaW5nIGVudmlyb25tZW50cykKICAgICAg\nICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNlLXVpZC1h\nY2Nlc3MiLCBfbWV0YSksIHQpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS11\naWQtYWNjZXNzIiwgX21ldGEpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gaWYgd2UgY291bGRuJ3QgYWNjZXNzIHRoZSBzZXJpYWxWZXJzaW9u\nVUlELCB3ZSB3aWxsIGhhdmUgdG8KICAgICAgICAgICAgLy8gc2tpcCB0aGUg\nb3ZlcnJpZGUgb2YgdGhhdCBmaWVsZCBhbmQgbm90IGJlIHNlcmlhbGl6YXRp\nb24KICAgICAgICAgICAgLy8gY29tcGF0aWJsZSB3aXRoIG5vbi1lbmhhbmNl\nZCBjbGFzc2VzCiAgICAgICAgICAgIGlmICh1aWQgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKCJzZXJpYWxW\nZXJzaW9uVUlEIiwgbG9uZy5jbGFzcyk7CiAgICAgICAgICAgICAgICBmaWVs\nZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICAgICAgZmllbGQuc2V0U3Rh\ndGljKHRydWUpOwogICAgICAgICAgICAgICAgZmllbGQuc2V0RmluYWwodHJ1\nZSk7CgogICAgICAgICAgICAgICAgQ29kZSBjb2RlID0gZ2V0T3JDcmVhdGVD\nbGFzc0luaXRDb2RlKGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuYmVm\nb3JlRmlyc3QoKTsKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSh1aWQubG9uZ1ZhbHVlKCkpOwogICAgICAgICAgICAgICAgY29k\nZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChmaWVsZCk7CgogICAgICAgICAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBhZGQgd3JpdGUgb2JqZWN0IG1ldGhvZAog\nICAgICAgIEJDTWV0aG9kIHdyaXRlID0gX3BjLmdldERlY2xhcmVkTWV0aG9k\nKCJ3cml0ZU9iamVjdCIsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPYmpl\nY3RPdXRwdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAgICAgYm9vbGVhbiBmdWxs\nID0gd3JpdGUgPT0gbnVsbDsKICAgICAgICBpZiAoZnVsbCkgewogICAgICAg\nICAgICAvLyBwcml2YXRlIHZvaWQgd3JpdGVPYmplY3QgKE9iamVjdE91dHB1\ndFN0cmVhbSBvdXQpCiAgICAgICAgICAgIHdyaXRlID0gX3BjLmRlY2xhcmVN\nZXRob2QoIndyaXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfSk7\nCiAgICAgICAgICAgIHdyaXRlLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhj\nZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgd3JpdGUu\nbWFrZVByaXZhdGUoKTsKICAgICAgICB9CiAgICAgICAgbW9kaWZ5V3JpdGVP\nYmplY3RNZXRob2Qod3JpdGUsIGZ1bGwpOwoKICAgICAgICAvLyBhbmQgcmVh\nZCBvYmplY3QKICAgICAgICBCQ01ldGhvZCByZWFkID0gX3BjLmdldERlY2xh\ncmVkTWV0aG9kKCJyZWFkT2JqZWN0IiwKICAgICAgICAgICAgbmV3IENsYXNz\nW117IE9iamVjdElucHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAgIGZ1bGwg\nPSByZWFkID09IG51bGw7CiAgICAgICAgaWYgKGZ1bGwpIHsKICAgICAgICAg\nICAgLy8gcHJpdmF0ZSB2b2lkIHJlYWRPYmplY3QgKE9iamVjdElucHV0U3Ry\nZWFtIGluKQogICAgICAgICAgICByZWFkID0gX3BjLmRlY2xhcmVNZXRob2Qo\nInJlYWRPYmplY3QiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IE9iamVjdElucHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAg\nICAgICByZWFkLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKElP\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgcmVhZC5nZXRFeGNlcHRp\nb25zKHRydWUpLmFkZEV4Y2VwdGlvbgogICAgICAgICAgICAgICAgKENsYXNz\nTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICByZWFkLm1h\na2VQcml2YXRlKCk7CiAgICAgICAgfQogICAgICAgIG1vZGlmeVJlYWRPYmpl\nY3RNZXRob2QocmVhZCwgZnVsbCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGFkZFN1YmNsYXNzU2VyaWFsaXphdGlvbkNvZGUoKSB7CiAgICAgICAgLy8g\nZm9yIGdlbmVyYXRlZCBzdWJjbGFzc2VzLCBzZXJpYWxpemF0aW9uIG11c3Qg\nd3JpdGUgYW4gaW5zdGFuY2Ugb2YKICAgICAgICAvLyB0aGUgc3VwZXJjbGFz\ncyBpbnN0ZWFkIG9mIHRoZSBzdWJjbGFzcywgc28gdGhhdCB0aGUgY2xpZW50\nIFZNIGNhbgogICAgICAgIC8vIGRlc2VyaWFsaXplIHN1Y2Nlc3NmdWxseS4K\nCiAgICAgICAgLy8gcHJpdmF0ZSBPYmplY3Qgd3JpdGVSZXBsYWNlKCkgdGhy\nb3dzIE9iamVjdFN0cmVhbUV4Y2VwdGlvbgogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJ3cml0ZVJlcGxhY2UiLCBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5nZXRFeGNlcHRpb25z\nKHRydWUpLmFkZEV4Y2VwdGlvbihPYmplY3RTdHJlYW1FeGNlcHRpb24uY2xh\nc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBPYmplY3QgbyA9IG5ldyA8bWFuYWdlZC10eXBlPigp\nCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShfbWFuYWdlZFR5cGUpOyAv\nLyBmb3IgcmV0dXJuCiAgICAgICAgY29kZS5kdXAoKTsgLy8gZm9yIHBvc3Qt\nPGluaXQ+IHdvcmsKICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgPGluaXQ+\nCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5h\nZ2VkVHlwZS5nZXRUeXBlKCksICI8aW5pdD4iLAogICAgICAgICAgICB2b2lk\nLmNsYXNzLCBudWxsKTsKCiAgICAgICAgLy8gY29weSBhbGwgdGhlIGZpZWxk\ncy4KICAgICAgICAvLyAjIyMjIyBsaW1pdGluZyB0byBKUEEgQFRyYW5zaWVu\ndCBsaW1pdGF0aW9ucwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChmbWRzW2ld\nLmlzVHJhbnNpZW50KCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgLy8gby48ZmllbGQ+ID0gdGhpcy48ZmllbGQ+IChvciByZWZs\nZWN0aXZlIGFuYWxvZykKICAgICAgICAgICAgY29kZS5kdXAoKTsgLy8gZm9y\nIHB1dGZpZWxkCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7\nIC8vIGZvciBnZXRmaWVsZAogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBf\nbWFuYWdlZFR5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\ncHV0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLCBmbWRzW2ldLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkp\nOwogICAgICAgIH0KCiAgICAgICAgY29kZS5hcmV0dXJuKCkuc2V0VHlwZShP\nYmplY3QuY2xhc3MpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGNsYXNzIGJlaW5nIGVuaGFu\nY2VkIHNob3VsZCBleHRlcm5hbGl6ZSB0byBhIGRldGFjaGVkCiAgICAgKiBp\nbnN0YW5jZSByYXRoZXIgdGhhbiBzZXJpYWxpemUuCiAgICAgKi8KICAgIHBy\naXZhdGUgYm9vbGVhbiBleHRlcm5hbGl6ZURldGFjaGVkKCkgewogICAgICAg\nIHJldHVybiBDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEu\nZ2V0RGV0YWNoZWRTdGF0ZSgpKQogICAgICAgICAgICAmJiBTZXJpYWxpemFi\nbGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRU\neXBlKCkpCiAgICAgICAgICAgICYmICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlv\nbigpLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKS4KICAgICAgICAgICAgaXNE\nZXRhY2hlZFN0YXRlVHJhbnNpZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIGEgY3VzdG9tIHdyaXRlT2JqZWN0IG1ldGhvZCB0aGF0IGRlbGVn\nYXRlcyB0byB0aGUKICAgICAqIHtAbGluayBPYmplY3RPdXRwdXRTdHJlYW0j\nZGVmYXVsdFdyaXRlT2JqZWN0fSBtZXRob2QsCiAgICAgKiBidXQgb25seSBh\nZnRlciBjYWxsaW5nIHRoZSBpbnRlcm5hbCA8Y29kZT5wY1NlcmlhbGl6aW5n\nPC9jb2RlPiBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtb2Rp\nZnlXcml0ZU9iamVjdE1ldGhvZChCQ01ldGhvZCBtZXRob2QsIGJvb2xlYW4g\nZnVsbCkgewogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgLy8g\nYm9vbCBjbGVhciA9IHBjU2VyaWFsaXppbmcgKCk7CiAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXJpYWxpemluZyIsCiAg\nICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIGludCBj\nbGVhciA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29k\nZS5pc3RvcmUoKS5zZXRMb2NhbChjbGVhcik7CgogICAgICAgIGlmIChmdWxs\nKSB7CiAgICAgICAgICAgIC8vIG91dC5kZWZhdWx0V3JpdGVPYmplY3QgKCk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdE91\ndHB1dFN0cmVhbS5jbGFzcywKICAgICAgICAgICAgICAgICJkZWZhdWx0V3Jp\ndGVPYmplY3QiLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29k\nZS52cmV0dXJuKCk7CiAgICAgICAgfQoKICAgICAgICBJbnN0cnVjdGlvbiB0\nbXBsYXRlID0gKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS52cmV0\ndXJuKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIHRvcmV0OwogICAgICAg\nIEluc3RydWN0aW9uIHJldDsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7\nCiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2FyZCh0bXBsYXRlKSkg\newogICAgICAgICAgICByZXQgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAg\nICAgIC8vIGlmIChjbGVhcikgcGNTZXREZXRhY2hlZFN0YXRlIChudWxsKTsK\nICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGNsZWFyKTsKICAg\nICAgICAgICAgdG9yZXQgPSBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2V0RGV0YWNoZWRTdGF0\nZSIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\nT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB0b3JldC5zZXRUYXJnZXQo\ncmV0KTsKICAgICAgICAgICAgY29kZS5uZXh0KCk7IC8vIGp1bXAgb3ZlciBy\nZXR1cm4KICAgICAgICB9CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGRzIGEgY3VzdG9tIHJlYWRPYmplY3QgbWV0\naG9kIHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICoge0BsaW5rIE9iamVj\ndElucHV0U3RyZWFtI3JlYWRPYmplY3R9IG1ldGhvZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIG1vZGlmeVJlYWRPYmplY3RNZXRob2QoQkNNZXRob2Qg\nbWV0aG9kLCBib29sZWFuIGZ1bGwpIHsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0\nKCk7CgogICAgICAgIC8vIGlmIHRoaXMgaW5zdGFuY2UgdXNlcyBzeW50aGV0\naWMgZGV0YWNoZWQgc3RhdGUsIG5vdGUgdGhhdCBpdCBoYXMKICAgICAgICAv\nLyBiZWVuIGRlc2VyaWFsaXplZAogICAgICAgIGlmIChDbGFzc01ldGFEYXRh\nLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKSkg\newogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJ\nQUxJWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRl\nIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBP\nYmplY3QuY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZnVsbCkg\newogICAgICAgICAgICAvLyBpbi5kZWZhdWx0UmVhZE9iamVjdCAoKTsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXRT\ndHJlYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAiZGVmYXVsdFJlYWRPYmpl\nY3QiLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhlIHBjSXNEZXRhY2hlZCgp\nIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYW4gaW5zdGFuY2UKICAgICAqIGlz\nIGRldGFjaGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkSXNEZXRh\nY2hlZE1ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gcHVibGljIGJvb2xlYW4gcGNJc0RldGFjaGVk\nKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiSXNEZXRhY2hlZCIsCiAgICAgICAgICAgIEJvb2xlYW4uY2xh\nc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nYm9vbGVhbiBuZWVkc0RlZmluaXRpdmVNZXRob2QgPSB3cml0ZUlzRGV0YWNo\nZWRNZXRob2QoY29kZSk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAg\nICAgaWYgKCFuZWVkc0RlZmluaXRpdmVNZXRob2QpIAogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIC8vIHByaXZhdGUgYm9vbGVhbiBwY0lzRGV0YWNo\nZWRTdGF0ZURlZmluaXRpdmUoKQogICAgICAgIC8vICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIC8vIGF1eGlsbGlhcnkgZW5oYW5jZXJzIG1heSBjaGFuZ2Ug\ndGhlIHJldHVybiB2YWx1ZSBvZiB0aGlzIG1ldGhvZAogICAgICAgIC8vIGlm\nIHRoZWlyIHNwZWNzIGNvbnNpZGVyIGRldGFjaGVkIHN0YXRlIGRlZmluaXRp\ndmUKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChJU0RFVEFD\nSEVEU1RBVEVERUZJTklUSVZFLCBib29sZWFuLmNsYXNzLAogICAgICAgICAg\nICBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVByaXZhdGUoKTsKICAgICAg\nICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICBjb2RlLmlyZXR1\ncm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZXMgdGhlIGJvZHkgb2YgdGhlIHBjSXNEZXRhY2hlZCgp\nIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYW4KICAgICAqIGluc3RhbmNlIGlz\nIGRldGFjaGVkLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB3ZSBu\nZWVkIGEgcGNJc0RldGFjaGVkU3RhdGVEZWZpbml0aXZlIG1ldGhvZCwgZmFs\nc2UKICAgICAqIG90aGVyd2lzZQogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gd3JpdGVJc0RldGFjaGVkTWV0aG9kKENvZGUgY29kZSkKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBub3Qg\nZGV0YWNoYWJsZTogcmV0dXJuIEJvb2xlYW4uRkFMU0UKICAgICAgICBpZiAo\nIV9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9v\nbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBp\nZiAoc20gIT0gbnVsbCkKICAgICAgICAvLyAgICAgcmV0dXJuIChzbS5pc0Rl\ndGFjaGVkICgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZudWxsKCk7CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwg\nImlzRGV0YWNoZWQiLAogICAgICAgICAgICBib29sZWFuLmNsYXNzLCBudWxs\nKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZmYWxzZSA9IGNvZGUuaWZl\ncSgpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICBpZmZhbHNlLnNldFRhcmdldChjb2RlLmdl\ndHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAg\nICAgICAgICAgIEJvb2xlYW4uY2xhc3MpKTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKCiAgICAgICAgLy8gaWYgd2UgdXNlIGRldGFjaGVkIHN0YXRlOgog\nICAgICAgIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUgKCkgIT0gbnVsbAog\nICAgICAgIC8vICAgICAmJiBwY0dldERldGFjaGVkU3RhdGUgIT0gREVTRVJJ\nQUxJWkVEKQogICAgICAgIC8vICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwog\nICAgICAgIEJvb2xlYW4gc3RhdGUgPSBfbWV0YS51c2VzRGV0YWNoZWRTdGF0\nZSgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBub3RkZXNlciA9IG51bGw7\nCiAgICAgICAgSW5zdHJ1Y3Rpb24gdGFyZ2V0OwogICAgICAgIGlmIChzdGF0\nZSAhPSBCb29sZWFuLkZBTFNFKSB7CiAgICAgICAgICAgIGlmaW5zLnNldFRh\ncmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZudWxsKCk7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAg\nICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAg\nICAgICAgbm90ZGVzZXIgPSBjb2RlLmlmYWNtcGVxKCk7CiAgICAgICAgICAg\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRS\nVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CgogICAgICAgICAgICBpZiAoc3RhdGUgPT0gQm9vbGVhbi5UUlVFKSB7\nCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHRvIHVzZSBkZXRhY2hl\nZCBzdGF0ZToKICAgICAgICAgICAgICAgIC8vIHJldHVybiBCb29sZWFuLkZB\nTFNFOwogICAgICAgICAgICAgICAgdGFyZ2V0ID0gY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLAogICAgICAgICAg\nICAgICAgICAgIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBub3RkZXNl\nci5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYXJ0aWZpY2lh\nbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJnZXQgPSBjb2RlLm5v\ncCgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAg\nIGlmIChub3RkZXNlciAhPSBudWxsKQogICAgICAgICAgICBub3RkZXNlci5z\nZXRUYXJnZXQodGFyZ2V0KTsKCiAgICAgICAgLy8gYWxsb3cgdXNlcnMgd2l0\naCB2ZXJzaW9uIG9yIGF1dG8tYXNzaWduZWQgcGsgZmllbGRzIHRvIG1hbnVh\nbGx5IAogICAgICAgIC8vIGNvbnN0cnVjdCBhICJkZXRhY2hlZCIgaW5zdGFu\nY2UsIHNvIGNoZWNrIHRoZXNlIGJlZm9yZSB0YWtpbmcgaW50byAKICAgICAg\nICAvLyBhY2NvdW50IG5vbi1leGlzdGVudCBkZXRhY2hlZCBzdGF0ZQoKICAg\nICAgICAvLyBjb25zaWRlciBkZXRhY2hlZCBpZiB2ZXJzaW9uIGlzIG5vbi1k\nZWZhdWx0CiAgICAgICAgRmllbGRNZXRhRGF0YSB2ZXJzaW9uID0gX21ldGEu\nZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHN0YXRlICE9IEJvb2xl\nYW4uVFJVRSAmJiB2ZXJzaW9uICE9IG51bGwpIHsKICAgICAgICAgICAgLy8g\naWYgKDx2ZXJzaW9uPiAhPSA8ZGVmYXVsdD4pCiAgICAgICAgICAgIC8vCQly\nZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgdmVyc2lvbik7CiAgICAgICAgICAgIGlmaW5zID0gaWZEZWZh\ndWx0VmFsdWUoY29kZSwgdmVyc2lvbik7CiAgICAgICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29s\nZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgICAgIGlmICghX2FkZFZlcnNpb25Jbml0RmxhZyl7CiAgICAgICAgICAg\nICAgICAvLyBlbHNlIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlm\naW5zLnNldFRhcmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xl\nYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpKTsKICAgICAgICAg\nICAgfWVsc2V7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhIHZlcnNp\nb25Jbml0ID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZChWRVJTSU9OX0lOSVRf\nU1RSKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gbm9v\ncAogICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkp\nOwogICAgICAgICAgICAgICAgLy8gaWYgKHBjVmVyc2lvbkluaXQgIT0gZmFs\nc2UpCiAgICAgICAgICAgICAgICAvLyByZXR1cm4gdHJ1ZQogICAgICAgICAg\nICAgICAgLy8gZWxzZSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIHZlcnNpb25Jbml0LmdldE5hbWUo\nKSk7CiAgICAgICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNv\nZGUsIHZlcnNpb25Jbml0KTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3Rh\ndGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFu\nLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAg\nICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAg\nICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFu\nLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAg\nICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICAvLyBjb25zaWRlciBkZXRhY2hlZCBpZiBhdXRvLWdlbm5lZCBwcmltYXJ5\nIGtleXMgYXJlIG5vbi1kZWZhdWx0CiAgICAgICAgaWZpbnMgPSBudWxsOwog\nICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmluczIgPSBudWxsOwogICAgICAg\nIGJvb2xlYW4gaGFzQXV0b0Fzc2lnbmVkUEsgPSBmYWxzZTsKICAgICAgICBp\nZiAoc3RhdGUgIT0gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICYmIF9tZXRh\nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElD\nQVRJT04pIHsKICAgICAgICAgICAgLy8gZm9yIGVhY2ggcGsgZmllbGQ6CiAg\nICAgICAgICAgIC8vIGlmICg8cGs+ICE9IDxkZWZhdWx0PiBbJiYgISIiLmVx\ndWFscyAoPHBrPildKQogICAgICAgICAgICAvLwkJcmV0dXJuIEJvb2xlYW4u\nVFJVRTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IF9tZXRh\nLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nIGlmIChwa3NbaV0uZ2V0VmFsdWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRl\nZ2llcy5OT05FKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgIHRhcmdldCA9IGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKGlmaW5zICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7\nCiAgICAgICAgICAgICAgICBpZiAoaWZpbnMyICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAg\nICAgICAgICAgaWZpbnMyID0gbnVsbDsKCiAgICAgICAgICAgICAgICBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAg\nICAgICBpZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNvZGUsIHBrc1tpXSk7CiAg\nICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSA9PSBKYXZhVHlwZXMuU1RSSU5HKSB7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKCIiKTsKICAgICAgICAgICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBr\nc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKFN0cmluZy5jbGFzcywgImVxdWFscyIsCiAgICAgICAg\nICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG5ldyBDbGFzc1tdeyBP\nYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAgaWZpbnMyID0g\nY29kZS5pZm5lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJU\nUlVFIiwKICAgICAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKTsKICAg\nICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYXJ0aWZpY2lhbCB0YXJnZXQg\ndG8gc2ltcGxpZnkKICAgICAgICB0YXJnZXQgPSBjb2RlLm5vcCgpOwogICAg\nICAgIGlmIChpZmlucyAhPSBudWxsKQogICAgICAgICAgICBpZmlucy5zZXRU\nYXJnZXQodGFyZ2V0KTsKICAgICAgICBpZiAoaWZpbnMyICE9IG51bGwpCiAg\nICAgICAgICAgIGlmaW5zMi5zZXRUYXJnZXQodGFyZ2V0KTsKCiAgICAgICAg\nLy8gaWYgaGFzIGF1dG8tYXNzaWduZWQgcGsgYW5kIHdlIGdldCB0byB0aGlz\nIHBvaW50LCBtdXN0IGhhdmUgZGVmYXVsdAogICAgICAgIC8vIHZhbHVlLCBz\nbyBtdXN0IGJlIG5ldyBpbnN0YW5jZQogICAgICAgIGlmIChoYXNBdXRvQXNz\naWduZWRQSykgewogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwog\nICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgZGV0YWNoZWQgc3Rh\ndGUgaXMgbm90IGRlZmluaXRpdmUsIGp1c3QgZ2l2ZSB1cCBub3cgYW5kIHJl\ndHVybgogICAgICAgIC8vIG51bGwgc28gdGhhdCB0aGUgcnVudGltZSB3aWxs\nIHBlcmZvcm0gYSBEQiBsb29rdXAgdG8gZGV0ZXJtaW5lCiAgICAgICAgLy8g\nd2hldGhlciB3ZSdyZSBkZXRhY2hlZCBvciBuZXcKICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChJU0RFVEFDSEVEU1RBVEVERUZJTklUSVZFLCBib29sZWFu\nLmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBpZmlucyA9IGNv\nZGUuaWZuZSgpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgaWZpbnMuc2V0VGFy\nZ2V0KGNvZGUubm9wKCkpOwoKICAgICAgICAvLyBubyBkZXRhY2hlZCBzdGF0\nZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0ZSBhbmQgaXQncyBu\nb3QKICAgICAgICAvLyBzeW50aGV0aWMgb3IgdGhlIGluc3RhbmNlIGlzIG5v\ndCBzZXJpYWxpemFibGUgb3IgdGhlIHN0YXRlIGlzbid0CiAgICAgICAgLy8g\ndHJhbnNpZW50LCBtdXN0IG5vdCBiZSBkZXRhY2hlZAogICAgICAgIGlmIChz\ndGF0ZSA9PSBudWxsCiAgICAgICAgICAgICYmICghQ2xhc3NNZXRhRGF0YS5T\nWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3RhdGUoKSkKICAg\nICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVG\ncm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgfHwg\nIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0\nYW5jZSgpLgogICAgICAgICAgICBpc0RldGFjaGVkU3RhdGVUcmFuc2llbnQo\nKSkpIHsKICAgICAgICAgICAgLy8gcmV0dXJuIEJvb2xlYW4uRkFMU0UKICAg\nICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNs\nYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIH0KCiAgICAgICAgLy8gbm8gZGV0YWNoZWQgc3RhdGU6IGlmIGluc3RhbmNl\nIHVzZXMgZGV0YWNoZWQgc3RhdGUgKGFuZCBtdXN0IGJlCiAgICAgICAgLy8g\nc3ludGhldGljIGFuZCB0cmFuc2llbnQgaW4gc2VyaWFsaXphYmxlIGluc3Rh\nbmNlIGF0IHRoaXMgcG9pbnQpLAogICAgICAgIC8vIG5vdCBkZXRhY2hlZCBp\nZiBzdGF0ZSBub3Qgc2V0IHRvIERFU0VSSUFMSVpFRAogICAgICAgIGlmIChz\ndGF0ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIChwY0dldERldGFj\naGVkU3RhdGUgKCkgPT0gbnVsbCkgLy8gaW5zdGVhZCBvZiBERVNFUklBTEla\nRUQKICAgICAgICAgICAgLy8gICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBS\nRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIE9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm5v\nbm51bGwoKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVs\nZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIGlmaW5zLnNl\ndFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIGdp\ndmUgdXA7IHdlIGp1c3QgZG9uJ3Qga25vdwogICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYXJl\nIHRoZSBnaXZlbiBmaWVsZCB0byBpdHMgSmF2YSBkZWZhdWx0LCByZXR1cm5p\nbmcgdGhlCiAgICAgKiBjb21wYXJpc29uIGluc3RydWN0aW9uLiBUaGUgZmll\nbGQgdmFsdWUgd2lsbCBhbHJlYWR5IGJlIG9uIHRoZSBzdGFjay4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgSnVtcEluc3RydWN0aW9uIGlmRGVmYXVs\ndFZhbHVlKENvZGUgY29kZSwKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgY29kZS5kY21wbCgp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAgICAgICAgICBj\nb2RlLmZjbXBsKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVx\nKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEwpOwogICAgICAg\nICAgICAgICAgY29kZS5sY21wKCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gY29kZS5pZm51bGwoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGdldCB0aGUgY29kZSBm\nb3IgdGhlIGNsYXNzIGluaXRpYWxpemVyIG1ldGhvZCwKICAgICAqIGNyZWF0\naW5nIHRoZSBtZXRob2QgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdC4K\nICAgICAqLwogICAgcHJpdmF0ZSBDb2RlIGdldE9yQ3JlYXRlQ2xhc3NJbml0\nQ29kZShib29sZWFuIHJlcGxhY2VMYXN0KSB7CiAgICAgICAgQkNNZXRob2Qg\nY2xpbml0ID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8Y2xpbml0PiIpOwog\nICAgICAgIENvZGUgY29kZTsKICAgICAgICBpZiAoY2xpbml0ICE9IG51bGwp\nIHsKICAgICAgICAgICAgY29kZSA9IGNsaW5pdC5nZXRDb2RlKHRydWUpOwog\nICAgICAgICAgICBpZiAocmVwbGFjZUxhc3QpIHsKICAgICAgICAgICAgICAg\nIENvZGUgdGVtcGxhdGUgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2Rl\nQWN0aW9uKCkpOwogICAgICAgICAgICAgICAgY29kZS5zZWFyY2hGb3J3YXJk\nKHRlbXBsYXRlLnZyZXR1cm4oKSk7CiAgICAgICAgICAgICAgICBjb2RlLnBy\nZXZpb3VzKCk7CiAgICAgICAgICAgICAgICBjb2RlLnNldCh0ZW1wbGF0ZS5u\nb3AoKSk7CiAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gY29kZTsKICAgICAgICB9CgogICAg\nICAgIC8vIGFkZCBzdGF0aWMgaW5pdGlhbGl6ZXIgbWV0aG9kIGlmIG5vbiBl\neGlzdHMKICAgICAgICBjbGluaXQgPSBfcGMuZGVjbGFyZU1ldGhvZCgiPGNs\naW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICBjbGluaXQubWFr\nZVBhY2thZ2UoKTsKICAgICAgICBjbGluaXQuc2V0U3RhdGljKHRydWUpOwog\nICAgICAgIGNsaW5pdC5zZXRGaW5hbCh0cnVlKTsKCiAgICAgICAgY29kZSA9\nIGNsaW5pdC5nZXRDb2RlKHRydWUpOwogICAgICAgIGlmICghcmVwbGFjZUxh\nc3QpIHsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAg\nIGNvZGUucHJldmlvdXMoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNv\nZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGJ5dGVjb2RlIG1vZGlm\neWluZyB0aGUgY2xvbmluZyBiZWhhdmlvciBvZiB0aGUgY2xhc3MgYmVpbmcK\nICAgICAqIGVuaGFuY2VkIHRvIGNvcnJlY3RseSByZXBsYWNlIHRoZSA8Y29k\nZT5wY1N0YXRlTWFuYWdlcjwvY29kZT4gCiAgICAgKiBpbnN0YW5jZSBmaWVs\nZHMgb2YgYW55IGNsb25lIGNyZWF0ZWQgd2l0aCB0aGVpciBkZWZhdWx0IHZh\nbHVlcy4gCiAgICAgKiBBbHNvLCBpZiB0aGlzIGNsYXNzIGlzIHRoZSBiYXNl\nIFBDIHR5cGUgYW5kIGRvZXMgbm90IGRlY2xhcmVkIAogICAgICogYSBjbG9u\nZSBtZXRob2QsIG9uZSB3aWxsIGJlIGFkZGVkLiBBbHNvLCBpZiBfcGMgaXMg\nYSBzeW50aGV0aWMKICAgICAqIHN1YmNsYXNzLCBjcmVhdGUgdGhlIGNsb25l\nKCkgbWV0aG9kIHRoYXQgY2xlYXJzIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAg\nKiB0aGF0IG1heSBoYXZlIGJlZW4gaW5pdGlhbGl6ZWQgaW4gYSBzdXBlcidz\nIGNsb25lKCkgbWV0aG9kLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nQ2xvbmluZ0NvZGUoKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJj\nbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gYWRkIHRoZSBjbG9uZSBtZXRo\nb2QgaWYgbmVjZXNzYXJ5CiAgICAgICAgQkNNZXRob2QgY2xvbmUgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QoImNsb25lIiwgCiAgICAgICAgICAgIChTdHJp\nbmdbXSkgbnVsbCk7CiAgICAgICAgU3RyaW5nIHN1cGVyTmFtZSA9IF9tYW5h\nZ2VkVHlwZS5nZXRTdXBlcmNsYXNzTmFtZSgpOwogICAgICAgIENvZGUgY29k\nZSA9IG51bGw7CiAgICAgICAgaWYgKGNsb25lID09IG51bGwpIHsKICAgICAg\nICAgICAgLy8gYWRkIGNsb25lIHN1cHBvcnQgZm9yIGJhc2UgY2xhc3Nlcwog\nICAgICAgICAgICAvLyB3aGljaCBhbHNvIGltcGxlbWVudCBjbG9uZWFibGUK\nICAgICAgICAgICAgYm9vbGVhbiBpc0Nsb25lYWJsZSA9IENsb25lYWJsZS5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKAogICAgICAgICAgICAgICAgX21hbmFn\nZWRUeXBlLmdldFR5cGUoKSk7CiAgICAgICAgICAgIGJvb2xlYW4gZXh0ZW5k\nc09iamVjdCA9CiAgICAgICAgICAgICAgICBzdXBlck5hbWUuZXF1YWxzKE9i\namVjdC5jbGFzcy5nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAoIWlzQ2xv\nbmVhYmxlIHx8ICghZXh0ZW5kc09iamVjdCAmJiAhZ2V0Q3JlYXRlU3ViY2xh\nc3MoKSkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBp\nZiAoIWdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2cudHJhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJl\nbmhhbmNlLWNsb25lYWJsZSIsIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCkpKTsK\nCiAgICAgICAgICAgIC8vIGFkZCBjbG9uZSBtZXRob2QKICAgICAgICAgICAg\nLy8gcHJvdGVjdGVkIE9iamVjdCBjbG9uZSAoKSB0aHJvd3MgQ2xvbmVOb3RT\ndXBwb3J0ZWRFeGNlcHRpb24KICAgICAgICAgICAgY2xvbmUgPSBfcGMuZGVj\nbGFyZU1ldGhvZCgiY2xvbmUiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICBpZiAoIXNldFZpc2liaWxpdHlUb1N1cGVyTWV0aG9kKGNsb25l\nKSkKICAgICAgICAgICAgICAgIGNsb25lLm1ha2VQcm90ZWN0ZWQoKTsKICAg\nICAgICAgICAgY2xvbmUuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRp\nb24KICAgICAgICAgICAgICAgIChDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlv\nbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUgPSBjbG9uZS5nZXRDb2RlKHRy\ndWUpOwoKICAgICAgICAgICAgLy8gcmV0dXJuIHN1cGVyLmNsb25lICgpOwog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1\ncGVyTmFtZSwgImNsb25lIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFz\ncy5nZXROYW1lKCksIG51bGwpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBnZXQgdGhlIGNs\nb25lIG1ldGhvZCBjb2RlCiAgICAgICAgICAgIGNvZGUgPSBjbG9uZS5nZXRD\nb2RlKGZhbHNlKTsKICAgICAgICAgICAgaWYgKGNvZGUgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGNy\nZWF0ZSB0ZW1wbGF0ZSBzdXBlci5jbG9uZSAoKSBpbnN0cnVjdGlvbiB0byBt\nYXRjaCBhZ2FpbnN0CiAgICAgICAgSW5zdHJ1Y3Rpb24gdGVtcGxhdGUgPSAo\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSkpLmludm9rZXNwZWNpYWwo\nKQogICAgICAgICAgICAuc2V0TWV0aG9kKHN1cGVyTmFtZSwgImNsb25lIiwg\nT2JqZWN0LmNsYXNzLmdldE5hbWUoKSwgbnVsbCk7CgogICAgICAgIC8vIGZp\nbmQgY2FsbHMgdG8gdGhlIHRlbXBsYXRlIGluc3RydWN0aW9uOyBvbiBtYXRj\naAogICAgICAgIC8vIGNsb25lIHdpbGwgYmUgb24gc3RhY2sKICAgICAgICBj\nb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgaWYgKGNvZGUuc2VhcmNoRm9y\nd2FyZCh0ZW1wbGF0ZSkpIHsKICAgICAgICAgICAgLy8gKCg8dHlwZT4pIGNs\nb25lKS5wY1N0YXRlTWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShf\ncGMpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwog\nICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CgogICAgICAgICAgICAvLyBpZiBtb2RpZmllZCwgaW5jcmVhc2Ugc3Rh\nY2sKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIGF1eGlsaWFyeSBlbmhh\nbmNlcnMgcmVnaXN0ZXJlZCBhcyB7QGxpbmsgU2VydmljZXMgc2VydmljZXN9\nLgogICAgICovCiAgICBwdWJsaWMgQXV4aWxpYXJ5RW5oYW5jZXJbXSBnZXRB\ndXhpbGlhcnlFbmhhbmNlcnMoKSB7CgkJcmV0dXJuIF9hdXhFbmhhbmNlcnM7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWxsb3cgYW55IHJlZ2lzdGVy\nZWQgYXV4aWxpYXJ5IGNvZGUgZ2VuZXJhdG9ycyB0byBydW4uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBydW5BdXhpbGlhcnlFbmhhbmNlcnMoKSB7CiAg\nICAJZm9yIChpbnQgaSA9IDA7IGkgPCBfYXV4RW5oYW5jZXJzLmxlbmd0aDsg\naSsrKQogICAgCQlfYXV4RW5oYW5jZXJzW2ldLnJ1bihfcGMsIF9tZXRhKTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIHRoZSBnaXZl\nbiBtZXRob2QgYmUgc2tpcHBlZC4KICAgICAqIAogICAgICogQHBhcmFtIG1l\ndGhvZCBtZXRob2QgdG8gYmUgc2tpcHBlZCBvciBub3QKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiBhbnkgb2YgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMgc2tp\ncHMgdGhlIGdpdmVuIG1ldGhvZCwKICAgICAqIG9yIGlmIHRoZSBtZXRob2Qg\naXMgYSBjb25zdHJ1Y3RvcgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\nc2tpcEVuaGFuY2UoQkNNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgaWYgKCI8\naW5pdD4iLmVxdWFscyhtZXRob2QuZ2V0TmFtZSgpKSkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfYXV4RW5oYW5jZXJzLmxlbmd0aDsgaSsrKQogICAgCQlpZiAoX2F1\neEVuaGFuY2Vyc1tpXS5za2lwRW5oYW5jZShtZXRob2QpKQogICAgCQkJcmV0\ndXJuIHRydWU7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyBzeW50aGV0aWMgZmllbGQgYWNjZXNz\nIG1ldGhvZHMgdGhhdCB3aWxsIHJlcGxhY2UgYWxsIGRpcmVjdAogICAgICog\nZmllbGQgYWNjZXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRB\nY2Nlc3NvcnMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAgIDog\nX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAgIGlmICgh\nZ2V0UmVkZWZpbmUoKSAmJiBpc1Byb3BlcnR5QWNjZXNzKGZtZHNbaV0pKSB7\nCiAgICAgICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NTZXRNZXRob2QoZm1k\nc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NHZXRNZXRo\nb2QoZm1kc1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBhZGRHZXRNZXRob2QoaSwgZm1kc1tp\nXSk7CiAgICAgICAgICAgICAgICBhZGRTZXRNZXRob2QoaSwgZm1kc1tpXSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIGEgbm9uLXN0YXRpYyBzZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8g\ndGhlIHN1cGVyIG1ldGhvZHMsIGFuZAogICAgICogcGVyZm9ybXMgYW55IG5l\nY2Vzc2FyeSBmaWVsZCB0cmFja2luZy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFN1YmNsYXNzU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIENsYXNzIHByb3BUeXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAg\nICAgIFN0cmluZyBzZXR0ZXJOYW1lID0gZ2V0U2V0dGVyTmFtZShmbWQpOwog\nICAgICAgIEJDTWV0aG9kIHNldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKHNl\ndHRlck5hbWUsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1td\nIHsgcHJvcFR5cGUgfSk7CiAgICAgICAgc2V0VmlzaWJpbGl0eVRvU3VwZXJN\nZXRob2Qoc2V0dGVyKTsKICAgICAgICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gbm90IG5lY2Vzc2FyeSBpZiB3ZSdy\nZSBhbHJlYWR5IHRyYWNraW5nIGFjY2VzcyB2aWEgcmVkZWZpbml0aW9uCiAg\nICAgICAgaWYgKCFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIGdl\ndCB0aGUgb3JpZyB2YWx1ZSBvbnRvIHN0YWNrCiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRW\nYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgaW50IHZhbCA9IGNv\nZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGNvZGUueHN0\nb3JlKCkuc2V0TG9jYWwodmFsKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5\ncGUoKSk7CiAgICAgICAgICAgIGFkZE5vdGlmeU11dGF0aW9uKGNvZGUsIGZt\nZCwgdmFsLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vICMjIyMjIHRlc3Qg\nY2FzZTogQiBleHRlbmRzIEEuIE1ldGhvZHMgZGVmaW5lZCBpbiBBLiBXaGF0\nCiAgICAgICAgLy8gIyMjIyMgaGFwcGVucz8KICAgICAgICAvLyBzdXBlci5z\nZXRYWFgoLi4uKQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKDApLnNldFR5cGUocHJvcFR5\ncGUpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChf\nbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLAogICAgICAgICAgICBzZXR0ZXJOYW1l\nLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IHByb3BUeXBlIH0pOwoKICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gc2V0VmlzaWJpbGl0eVRvU3Vw\nZXJNZXRob2QoQkNNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgQkNNZXRob2Rb\nXSBtZXRob2RzID0gX21hbmFnZWRUeXBlLmdldE1ldGhvZHMobWV0aG9kLmdl\ndE5hbWUoKSwKICAgICAgICAgICAgbWV0aG9kLmdldFBhcmFtVHlwZXMoKSk7\nCiAgICAgICAgaWYgKG1ldGhvZHMubGVuZ3RoID09IDApCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hY2Nlc3Nv\nciIsCiAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBt\nZXRob2QuZ2V0TmFtZSgpKSk7CiAgICAgICAgQkNNZXRob2Qgc3VwZXJNZXRo\nID0gbWV0aG9kc1swXTsKICAgICAgICBpZiAoc3VwZXJNZXRoLmlzUHJpdmF0\nZSgpKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgpOwogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVy\nTWV0aC5pc1BhY2thZ2UoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVBh\nY2thZ2UoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBl\nbHNlIGlmIChzdXBlck1ldGguaXNQcm90ZWN0ZWQoKSkgewogICAgICAgICAg\nICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1B1YmxpYygp\nKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBn\nZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFu\nZAogICAgICogcGVyZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVsZCB0cmFja2lu\nZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzR2V0TWV0\naG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgU3RyaW5nIG1ldGhO\nYW1lID0gImdldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXRO\nYW1lKCkpOwogICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyht\nZXRoTmFtZSwgbmV3IENsYXNzWzBdKS5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgbWV0aE5hbWUgPSAiaXMiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShm\nbWQuZ2V0TmFtZSgpKTsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXIgPSBfcGMu\nZGVjbGFyZU1ldGhvZChtZXRoTmFtZSwgZm1kLmdldERlY2xhcmVkVHlwZSgp\nLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBzZXRWaXNpYmlsaXR5VG9T\ndXBlck1ldGhvZChnZXR0ZXIpOwogICAgICAgIGdldHRlci5tYWtlUHVibGlj\nKCk7CiAgICAgICAgQ29kZSBjb2RlID0gZ2V0dGVyLmdldENvZGUodHJ1ZSk7\nCgogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBhbHJlYWR5IHRyYWNraW5nIGZp\nZWxkIGFjY2VzcyB2aWEgcmVmbGVjdGlvbiwgdGhlbiB3ZQogICAgICAgIC8v\nIG11c3QgbWFrZSB0aGUgZ2V0dGVyIGhvb2sgaW4gbGF6eSBsb2FkaW5nIGJl\nZm9yZSBhY2Nlc3NpbmcgdGhlIHN1cGVyCiAgICAgICAgLy8gbWV0aG9kLgog\nICAgICAgIGlmICghZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAgYWRkTm90\naWZ5QWNjZXNzKGNvZGUsIGZtZCk7CgogICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksIG1ldGhOYW1lLAogICAgICAg\nICAgICBmbWQuZ2V0RGVjbGFyZWRUeXBlKCksIG51bGwpOwogICAgICAgIGNv\nZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgYSBzdGF0aWMgZ2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZp\nZWxkLgogICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdp\ndGggdGhlIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFu\nYWdlciB0byBnZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAg\nICAgKiBAcGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUg\nZmllbGQKICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZp\nZWxkIHRvIGdldAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWV0\naG9kKGludCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gY3JlYXRlR2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBj\nb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHJl\nYWRzIGFyZSBub3QgY2hlY2tlZCwganVzdCByZXR1cm4gdGhlIHZhbHVlCiAg\nICAgICAgYnl0ZSBmaWVsZEZsYWcgPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAg\nICAgICBpZiAoKGZpZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVD\nS19SRUFEKSA9PSAwCiAgICAgICAgICAgICYmIChmaWVsZEZsYWcgJiBQZXJz\naXN0ZW5jZUNhcGFibGUuTUVESUFURV9SRUFEKSA9PSAwKSB7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSwgZm1kKTsKICAg\nICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwog\nICAgICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSk7CgogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIChpbnN0LnBjU3RhdGVNYW5hZ2VyID09IG51bGwpIHJldHVybiBpbnN0Ljxm\naWVsZD47CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVl\nLCBmbWQpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2Rl\nLmlmbm9ubnVsbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgdHJ1ZSwgZm1kKTsKICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAvLyBpbnQgZmllbGQg\nPSBwY0luaGVyaXRlZEZpZWxkQ291bnQgKyA8ZmllbGRpbmRleD47CiAgICAg\nICAgaW50IGZpZWxkTG9jYWwgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgp\nOwogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmdldHN0YXRpYygpLnNl\ndEZpZWxkKElOSEVSSVQsIGludC5jbGFzcykpOwogICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7CiAgICAgICAgY29kZS5pYWRkKCk7\nCiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChmaWVsZExvY2FsKTsK\nCiAgICAgICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5hY2Nlc3NpbmdGaWVs\nZCAoZmllbGQpOwogICAgICAgIC8vIHJldHVybiBpbnN0LjxmaWVsZD47CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlLCBmbWQpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoZmllbGRMb2NhbCk7CiAg\nICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01UWVBF\nLCAiYWNjZXNzaW5nRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgdHJ1ZSwgZm1kKTsKICAgICAgICBhZGRHZXRNYW5h\nZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54cmV0dXJu\nKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBz\ndGF0aWMgc2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAg\nICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGggdGhlIGlu\nc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdlciB0byBz\nZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFy\nYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmllbGQKICAg\nICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxkIHRvIHNl\ndAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2V0TWV0aG9kKGludCBp\nbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nY3JlYXRlU2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIFBDRW5oYW5jZXIgdXNl\ncyBzdGF0aWMgbWV0aG9kczsgUENTdWJjbGFzc2VyIGRvZXMgbm90LgogICAg\nICAgIGludCBmaXJzdFBhcmFtT2Zmc2V0ID0gZ2V0QWNjZXNzb3JQYXJhbWV0\nZXJPZmZzZXQoZm1kKTsKCiAgICAgICAgLy8gaWYgKGluc3QucGNTdGF0ZU1h\nbmFnZXIgPT0gbnVsbCkgaW5zdC48ZmllbGQ+ID0gdmFsdWU7CiAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlLCBmbWQpOwogICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwog\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSwgZm1kKTsK\nICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oZmlyc3RQYXJhbU9mZnNl\ndCk7CiAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQp\nOwogICAgICAgIGlmKGZtZC5pc1ZlcnNpb24oKT09dHJ1ZSAmJiBfYWRkVmVy\nc2lvbkluaXRGbGFnKXsKICAgICAgICAgICAgLy8gaWYgd2UgYXJlIHNldHRp\nbmcgdGhlIHZlcnNpb24sIGZsaXAgdGhlIHZlcnNpb25Jbml0IGZsYWcgdG8g\ndHJ1ZQogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIHYgPSBfbWV0YS5hZGRE\nZWNsYXJlZEZpZWxkKFZFUlNJT05fSU5JVF9TVFIsIGJvb2xlYW4uY2xhc3Mp\nOwogICAgICAgICAgICB2LnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDEpOwogICAgICAgICAgICAv\nLyBwY1ZlcnNpb25Jbml0ID0gdHJ1ZTsKICAgICAgICAgICAgcHV0ZmllbGQo\nY29kZSwgbnVsbCwgdi5nZXROYW1lKCksIHYuZ2V0RGVjbGFyZWRUeXBlKCkp\nOyAgIAogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAg\nICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5zZXR0aW5nPGZpZWxkVHlwZT5G\naWVsZCAoaW5zdCwKICAgICAgICAvLyAgICAgcGNJbmhlcml0ZWRGaWVsZENv\ndW50ICsgPGluZGV4PiwgaW5zdC48ZmllbGQ+LCB2YWx1ZSwgMCk7CiAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\ndHJ1ZSwgZm1kKSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgdHJ1ZSwgZm1kKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGluZGV4KTsKICAgICAgICBjb2RlLmlhZGQoKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAg\nICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAg\nICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0KTsK\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5h\nZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCks\nICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsKICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0dGFjaCAvIGRldGFjaCBtZXRo\nb2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dGFj\naERldGFjaENvZGUoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIHNlZSBpZiBhbnkgc3VwZXJjbGFzc2VzIGFy\nZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxl\nID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIHBhcmVudCA9\nIF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAg\nIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKSkgewogICAgICAgICAgICBpZiAocGFyZW50LmlzRGV0\nYWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBwYXJlbnREZXRhY2hhYmxl\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwYXJlbnQgbm90IGRldGFjaGFi\nbGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRhY2ggc3RhdGUgZmllbGRzIGFu\nZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhvZHMKICAgICAgICBpZiAoX21l\ndGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJj\nbGFzcygpCiAgICAgICAgICAgIHx8IHBhcmVudERldGFjaGFibGUgIT0gX21l\ndGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgYWRkSXNEZXRhY2hl\nZE1ldGhvZCgpOwogICAgICAgICAgICBhZGREZXRhY2hlZFN0YXRlTWV0aG9k\ncyhfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpCiAgICAgICAgICAgICAgICAh\nPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHdl\nIGRldGFjaCBvbiBzZXJpYWxpemUsIHdlIGFsc28gbmVlZCB0byBpbXBsZW1l\nbnQgdGhlCiAgICAgICAgLy8gZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNlIHRv\nIHdyaXRlIGp1c3QgdGhlIHN0YXRlIGZvciB0aGUgZmllbGRzCiAgICAgICAg\nLy8gYmVpbmcgZGV0YWNoZWQKICAgICAgICBpZiAoZXh0ZXJuYWxpemVEZXRh\nY2hlZCgpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBh\nZGREZXRhY2hFeHRlcm5hbGl6ZShwYXJlbnREZXRhY2hhYmxlLAogICAgICAg\nICAgICAgICAgICAgIF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkgIT0gQm9v\nbGVhbi5GQUxTRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihuc21lKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZmllbGRzIHRvIGhv\nbGQgZGV0YWNoZWQgc3RhdGUgYW5kIHRoZWlyIGFjY2Vzc29yIG1ldGhvZHMu\nCiAgICAgKgogICAgICogQHBhcmFtIGltcGwgd2hldGhlciB0byBmdWxseSBp\nbXBsZW1lbnQgZGV0YWNoIHN0YXRlIGZ1bmN0aW9uYWxpdHkKICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaGVkU3RhdGVNZXRob2RzKGJvb2xl\nYW4gaW1wbCkgewogICAgICAgIEZpZWxkIGRldGFjaEZpZWxkID0gX21ldGEu\nZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCk7CiAgICAgICAgU3RyaW5nIG5hbWUg\nPSBudWxsOwogICAgICAgIFN0cmluZyBkZWNsYXJlciA9IG51bGw7CiAgICAg\nICAgaWYgKGltcGwgJiYgZGV0YWNoRmllbGQgPT0gbnVsbCkgewogICAgICAg\nICAgICBuYW1lID0gUFJFICsgIkRldGFjaGVkU3RhdGUiOwogICAgICAgICAg\nICBkZWNsYXJlciA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIEJDRmll\nbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKG5hbWUsIE9iamVjdC5jbGFz\ncyk7CiAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAg\nICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9IGVsc2Ug\naWYgKGltcGwpIHsKICAgICAgICAgICAgbmFtZSA9IGRldGFjaEZpZWxkLmdl\ndE5hbWUoKTsKICAgICAgICAgICAgZGVjbGFyZXIgPSBkZXRhY2hGaWVsZC5n\nZXREZWNsYXJpbmdDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHB1YmxpYyBPYmplY3QgcGNHZXREZXRhY2hlZFN0YXRlICgpCiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0aWMoZmFsc2UpOwog\nICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgaW50IGFjY2Vz\ncyA9IG1ldGhvZC5nZXRBY2Nlc3NGbGFncygpOwoKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1wbCkg\newogICAgICAgICAgICAvLyByZXR1cm4gcGNEZXRhY2hlZFN0YXRlOwogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLmdldFByb2pl\nY3QoKS5sb2FkQ2xhc3MoZGVjbGFyZXIpLAogICAgICAgICAgICAgICAgbmFt\nZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjU2V0\nRGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0YXRlKQogICAgICAgIG1ldGhvZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwK\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzIFtdeyBPYmplY3Qu\nY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLnNldEFjY2Vzc0ZsYWdzKGFjY2Vz\ncyk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHBjRGV0YWNoZWRTdGF0\nZSA9IHN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUu\nZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciksCiAgICAgICAgICAg\nICAgICBuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgIH0KICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4gdGhl\nIGluc3RydWN0aW9ucyB0byBnZXQgZmllbGQKICAgICAqIDxjb2RlPmF0dHJO\nYW1lPC9jb2RlPiBkZWNsYXJlZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVyPC9j\nb2RlPgogICAgICogb250byB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAgICAq\nCiAgICAgKiBUaGUgaW5zdGFuY2UgdG8gYWNjZXNzIG11c3QgYWxyZWFkeSBi\nZSBvbiB0aGUgdG9wIG9mIHRoZQogICAgICogc3RhY2sgd2hlbiB0aGlzIGlz\nIGludm9rZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRmaWVsZChD\nb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFtZSkg\newogICAgICAgIGlmIChkZWNsYXJlciA9PSBudWxsKQogICAgICAgICAgICBk\nZWNsYXJlciA9IF9tYW5hZ2VkVHlwZTsKCiAgICAgICAgLy8gZmlyc3QsIHNl\nZSBpZiB3ZSBjYW4gY29udmVydCB0aGUgYXR0cmlidXRlIG5hbWUgdG8gYSBm\naWVsZCBuYW1lCiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IHRvQmFja2lu\nZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAgICAgIC8vIG5leHQsIGZpbmQg\ndGhlIGZpZWxkIGluIHRoZSBtYW5hZ2VkIHR5cGUgaGllcmFyY2h5CiAgICAg\nICAgQkNGaWVsZCBmaWVsZCA9IG51bGw7CiAgICAgICAgb3V0ZXI6IGZvciAo\nQkNDbGFzcyBiYyA9IF9wYzsgYmMgIT0gbnVsbDsgYmMgPSBiYy5nZXRTdXBl\ncmNsYXNzQkMoKSkgewogICAgICAgICAgICBCQ0ZpZWxkW10gZmllbGRzID0g\nQWNjZXNzQ29udHJvbGxlcgogICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdl\nZChKMkRvUHJpdkhlbHBlci5nZXRCQ0NsYXNzRmllbGRzQWN0aW9uKGJjLAog\nICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZSkpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgZmllbGQgPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAg\nICAvLyBpZiB3ZSByZWFjaCBhIGZpZWxkIGRlY2xhcmVkIGluIHRoaXMgdHlw\nZSwgdGhlbiB0aGlzIGlzIHRoZQogICAgICAgICAgICAgICAgLy8gbW9zdC1t\nYXNraW5nIGZpZWxkLCBhbmQgaXMgdGhlIG9uZSB0aGF0IHdlIHdhbnQuCiAg\nICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmdldERlY2xhcmVyKCkgPT0g\nZGVjbGFyZXIpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkgJiYgY29kZS5nZXRNZXRo\nb2QoKS5nZXREZWNsYXJlcigpID09IF9wYwogICAgICAgICAgICAmJiAoZmll\nbGQgPT0gbnVsbCB8fCAhZmllbGQuaXNQdWJsaWMoKSkpIHsKICAgICAgICAg\nICAgLy8gd2UncmUgY3JlYXRpbmcgdGhlIHN1YmNsYXNzLCBub3QgcmVkZWZp\nbmluZyB0aGUgdXNlciB0eXBlLgoKICAgICAgICAgICAgLy8gUmVmbGVjdGlv\nbi5nZXRYWFgodGhpcywgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7CiAg\nICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGRlY2xh\ncmVyKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZp\nZWxkTmFtZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSh0cnVlKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICJmaW5k\nRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAg\nICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IF9tZXRhLmdldEZpZWxk\nKGF0dHJOYW1lKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kKAogICAgICAgICAgICAgICAgICAgIGdldFJlZmxlY3Rpb25HZXR0ZXJN\nZXRob2QodHlwZSwgRmllbGQuY2xhc3MpKTsKICAgICAgICAgICAgfSBjYXRj\naCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIC8vIHNob3VsZCBuZXZlciBoYXBwZW4KICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9i\namVjdC5jbGFzcykKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFtZSgpLCBm\naWVsZE5hbWUsCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRUeXBlKCkuZ2V0\nTmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHRvIDxjb2RlPmNvZGU8L2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMgdG8gc2V0\nIGZpZWxkCiAgICAgKiA8Y29kZT5hdHRyTmFtZTwvY29kZT4gZGVjbGFyZWQg\naW4gdHlwZSA8Y29kZT5kZWNsYXJlcjwvY29kZT4KICAgICAqIHRvIHRoZSB2\nYWx1ZSBvZiB0eXBlIDxjb2RlPmZpZWxkVHlwZTwvY29kZT4gb24gdGhlIHRv\ncCBvZiB0aGUgc3RhY2suCiAgICAgKgogICAgICogV2hlbiB0aGlzIG1ldGhv\nZCBpcyBpbnZva2VkLCB0aGUgdmFsdWUgdG8gbG9hZCBtdXN0CiAgICAgKiBh\nbHJlYWR5IGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGluIDxjb2RlPmNv\nZGU8L2NvZGU+LAogICAgICogYW5kIHRoZSBpbnN0YW5jZSB0byBsb2FkIGlu\ndG8gbXVzdCBiZSBzZWNvbmQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\ndXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBh\ndHRyTmFtZSwKICAgICAgICBDbGFzcyBmaWVsZFR5cGUpIHsKICAgICAgICBp\nZiAoZGVjbGFyZXIgPT0gbnVsbCkKICAgICAgICAgICAgZGVjbGFyZXIgPSBf\nbWFuYWdlZFR5cGU7CgogICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSB0b0Jh\nY2tpbmdGaWVsZE5hbWUoYXR0ck5hbWUpOwoKICAgICAgICBpZiAoZ2V0UmVk\nZWZpbmUoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nIC8vIFJlZmxlY3Rpb24uc2V0KHRoaXMsIFJlZmxlY3Rpb24uZmluZEZpZWxk\nKC4uLiksIHZhbHVlKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50\nKCkuc2V0Q2xhc3MoZGVjbGFyZXIpOwogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZmllbGROYW1lKTsKICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAg\nICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7CiAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNs\nYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLAogICAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZS5pc1ByaW1pdGl2ZSgp\nID8gZmllbGRUeXBlIDogT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAg\nICAgICBGaWVsZC5jbGFzcyB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBjb2RlLnB1dGZpZWxkKCkKICAgICAgICAgICAgICAgIC5zZXRGaWVs\nZChkZWNsYXJlci5nZXROYW1lKCksIGZpZWxkTmFtZSwgZmllbGRUeXBlLmdl\ndE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYg\ndXNpbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMgYSBkaWZm\nZXJlbnQgYmFja2luZyBmaWVsZAogICAgICogbmFtZSBmb3IgdGhlIHBlcnNp\nc3RlbnQgYXR0cmlidXRlIDxjb2RlPm5hbWU8L2NvZGU+LgogICAgICovCiAg\nICBwcml2YXRlIFN0cmluZyB0b0JhY2tpbmdGaWVsZE5hbWUoU3RyaW5nIG5h\nbWUpIHsKICAgICAgICAvLyBtZXRhIGlzIG51bGwgd2hlbiBlbmhhbmNpbmcg\ncGVyc2lzdGVuY2UtYXdhcmUgCiAgICAJRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YSA9PSBudWxsID8gbnVsbCA6IF9tZXRhLmdldEZpZWxkKG5hbWUpOwog\nICAgICAgIGlmIChfbWV0YSAhPSBudWxsICYmIGlzUHJvcGVydHlBY2Nlc3Mo\nZm1kKQogICAgICAgICAgICAmJiBfYXR0cnNUb0ZpZWxkcyAhPSBudWxsICYm\nIF9hdHRyc1RvRmllbGRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAg\nICBuYW1lID0gKFN0cmluZylfYXR0cnNUb0ZpZWxkcy5nZXQobmFtZSk7CiAg\nICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB1\nc2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBpcyBhIGRpZmZl\ncmVudCBwZXJzaXN0ZW50CiAgICAgKiBhdHRyaWJ1dGUgbmFtZSBmb3IgdGhl\nIGJhY2tpbmcgZmllbGQgPGNvZGU+bmFtZTwvY29kZT4uCiAgICAgKi8KICAg\nIHByaXZhdGUgU3RyaW5nIGZyb21CYWNraW5nRmllbGROYW1lKFN0cmluZyBu\nYW1lKSB7CiAgICAgICAgLy8gbWV0YSBpcyBudWxsIHdoZW4gZW5oYW5jaW5n\nIHBlcnNpc3RlbmNlLWF3YXJlIAogICAgCUZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEgPT0gbnVsbCA/IG51bGwgOiBfbWV0YS5nZXRGaWVsZChuYW1lKTsK\nICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCAmJiBpc1Byb3BlcnR5QWNjZXNz\nKGZtZCkKICAgICAgICAgICAgJiYgX2ZpZWxkc1RvQXR0cnMgIT0gbnVsbCAm\nJiBfZmllbGRzVG9BdHRycy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAg\nICAgcmV0dXJuIChTdHJpbmcpX2ZpZWxkc1RvQXR0cnMuZ2V0KG5hbWUpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIGV4dGVybmFsaXphYmxlIGlu\ndGVyZmFjZSB0byBkZXRhY2ggb24gc2VyaWFsaXplLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkRGV0YWNoRXh0ZXJuYWxpemUoYm9vbGVhbiBwYXJl\nbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBlbnN1cmUgdGhhdCB0aGUgZGVjbGFyZWQgZGVmYXVsdCBjb25zdHJ1\nY3RvciBpcyBwdWJsaWMgCiAgICAgICAgLy8gZm9yIGV4dGVybmFsaXphdGlv\nbgogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZ2V0RGVjbGFyZWRNZXRo\nb2QoIjxpbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7CiAgICAgICAgaWYgKCFt\nZXRoLmlzUHVibGljKCkpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJlbmhhbmNlLWRlZmNvbnMtZXh0ZXJuIiwgCiAgICAgICAgICAgICAgICAg\nIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpOwogICAgICAgICAgICBtZXRo\nLm1ha2VQdWJsaWMoKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVjbGFyZSBl\neHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UKICAgICAgICBpZiAoIUV4dGVybmFs\naXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKSkKICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2Uo\nRXh0ZXJuYWxpemFibGUuY2xhc3MpOwoKICAgICAgICAvLyBtYWtlIHN1cmUg\ndGhlIHVzZXIgZG9lc24ndCBhbHJlYWR5IGhhdmUgY3VzdG9tIGV4dGVybmFs\naXphdGlvbiBvcgogICAgICAgIC8vIHNlcmlhbGl6YXRpb24gbWV0aG9kcwog\nICAgICAgIENsYXNzW10gaW5wdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5w\ndXRTdHJlYW0uY2xhc3MgfTsKICAgICAgICBDbGFzc1tdIG91dHB1dCA9IG5l\ndyBDbGFzc1tdeyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfTsKICAgICAg\nICBpZiAoX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkT2Jq\nZWN0IiwgaW5wdXQpICE9IG51bGwKICAgICAgICAgICAgfHwgX21hbmFnZWRU\neXBlLmdldERlY2xhcmVkTWV0aG9kKCJ3cml0ZU9iamVjdCIsIG91dHB1dCkg\nIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImRldGFjaC1jdXN0b20tc2VyIiwgX21ldGEpKTsKICAgICAg\nICBpbnB1dFswXSA9IE9iamVjdElucHV0LmNsYXNzOwogICAgICAgIG91dHB1\ndFswXSA9IE9iamVjdE91dHB1dC5jbGFzczsKICAgICAgICBpZiAoX21hbmFn\nZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkRXh0ZXJuYWwiLCBpbnB1\ndCkgIT0gbnVsbAogICAgICAgICAgICB8fCBfbWFuYWdlZFR5cGUuZ2V0RGVj\nbGFyZWRNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCBvdXRwdXQpICE9IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJkZXRhY2gtY3VzdG9tLWV4dGVybiIsIF9tZXRhKSk7CgogICAgICAgIC8v\nIGNyZWF0ZSBsaXN0IG9mIGFsbCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZp\nZWxkcwogICAgICAgIEJDRmllbGRbXSBmaWVsZHMgPSBfbWFuYWdlZFR5cGUu\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBDb2xsZWN0aW9uIHVubWdk\nID0gbmV3IEFycmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoIWZpZWxkc1tpXS5pc1RyYW5zaWVudCgpICYmICFmaWVsZHNb\naV0uaXNTdGF0aWMoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5p\nc0ZpbmFsKCkKICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uZ2V0TmFt\nZSgpLnN0YXJ0c1dpdGgoUFJFKQogICAgICAgICAgICAgICAgJiYgX21ldGEu\nZ2V0RGVjbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdW5tZ2QuYWRkKGZpZWxkc1tpXSk7CiAgICAg\nICAgfQoKICAgICAgICBhZGRSZWFkRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJs\nZSwgZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkUmVhZFVubWFuYWdlZCh1\nbm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7CiAgICAgICAgYWRkV3JpdGVFeHRl\ncm5hbChwYXJlbnREZXRhY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAg\nICBhZGRXcml0ZVVubWFuYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgY3VzdG9tIHJlYWRFeHRlcm5h\nbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZWFkRXh0\nZXJuYWwoYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xl\nYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFz\nc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1l\ndGggPSBfcGMuZGVjbGFyZU1ldGhvZCgicmVhZEV4dGVybmFsIiwgdm9pZC5j\nbGFzcywgaW5hcmdzKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1l\ndGguZ2V0RXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhj\nZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBleGNlcHMuYWRk\nRXhjZXB0aW9uKENsYXNzTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gc3VwZXIucmVhZEV4dGVybmFsIChpbik7CiAgICAgICAgQ2xhc3Mgc3Vw\nID0gX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsK\nICAgICAgICBpZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFi\nbGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXAsICJyZWFkRXh0ZXJuYWwi\nLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgaW5hcmdzKTsKICAgICAg\nICB9CgogICAgICAgIC8vIHJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEpLAogICAgICAgICAgICBQ\nUkUgKyAiUmVhZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIGluYXJncyk7Cgog\nICAgICAgIGlmIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIHBj\nU2V0RGV0YWNoZWRTdGF0ZSAoaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNs\nYXNzLCAicmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoUFJFICsgIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9\nKTsKCiAgICAgICAgICAgIC8vIHBjUmVwbGFjZVN0YXRlTWFuYWdlciAoKFN0\nYXRlTWFuYWdlcikgaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAi\ncmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3Rh\ndGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFBSRSArICJSZXBsYWNlU3RhdGVNYW5hZ2VyIiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdGF0\nZU1hbmFnZXIuY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFk\nIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tp\nXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgcmVhZEV4dGVybmFs\nKGNvZGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAg\nIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlYWQgdW5tYW5hZ2VkIGZpZWxkcyBmcm9t\nIHRoZSBzdHJlYW0gKHBjUmVhZFVubWFuYWdlZCkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRSZWFkVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2Qs\nIGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9\nIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVhZFVu\nbWFuYWdlZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIGluYXJncyk7CiAg\nICAgICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9u\ncyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAg\nZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5kRXhjZXB0aW9u\nLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIHN1cGVyLnJlYWRVbm1hbmFnZWQgKGluKTsKICAg\nICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAg\nICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiUmVh\nZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAgICAgaW5h\ncmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgZGVjbGFyZWQgdW5t\nYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZp\nZWxkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAo\nQkNGaWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgcmVhZEV4dGVybmFs\nKGNvZGUsIGZpZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgpLCBudWxs\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIHJlYWQgYSBmaWVsZCBmcm9tIGFuIGV4dGVybmFsaXphdGlv\nbiBpbnB1dCBzdHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFk\nRXh0ZXJuYWwoQ29kZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0\neXBlLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRo\nTmFtZTsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAg\nICAgICAgIG1ldGhOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAg\nIG1ldGhOYW1lID0gbWV0aE5hbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJD\nYXNlKExvY2FsZS5FTkdMSVNIKQogICAgICAgICAgICAgICAgKyBtZXRoTmFt\nZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gInJlYWQi\nICsgbWV0aE5hbWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIG1ldGhO\nYW1lID0gInJlYWRPYmplY3QiOwoKICAgICAgICAvLyA8ZmllbGQ+ID0gaW4u\ncmVhZDx0eXBlPiAoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgQ2xhc3MgcmV0ID0gKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0\neXBlIDogT2JqZWN0LmNsYXNzOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCBtZXRoTmFtZSwK\nICAgICAgICAgICAgcmV0LCBudWxsKTsKICAgICAgICBpZiAoIXR5cGUuaXNQ\ncmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcHV0ZmllbGQoY29kZSwgbnVs\nbCwgZmllbGROYW1lLCB0eXBlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxF\nTkRBUjoKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAvLyAgIHNtLnByb3h5RGV0YWNoZWREZXNl\ncmlhbGl6ZWQgKDxpbmRleD4pOwogICAgICAgICAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmaW5zID0gY29kZS5p\nZm51bGwoKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChTTVRZUEUsCiAgICAgICAgICAgICAgICAgICAgICAgICJw\ncm94eURldGFjaGVkRGVzZXJpYWxpemVkIiwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsK\nICAgICAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3Ao\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgY3VzdG9tIHdyaXRlRXh0ZXJuYWwgbWV0aG9kLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkV3JpdGVFeHRlcm5hbChib29sZWFuIHBh\ncmVudERldGFjaGFibGUsCiAgICAgICAgYm9vbGVhbiBkZXRhY2hlZFN0YXRl\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIENsYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRw\ndXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xh\ncmVNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCB2b2lkLmNsYXNzLCBvdXRhcmdz\nKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0\naW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhj\nZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLndyaXRlRXh0ZXJuYWwgKG91\ndCk7CiAgICAgICAgQ2xhc3Mgc3VwID0gZ2V0VHlwZShfbWV0YSkuZ2V0U3Vw\nZXJjbGFzcygpOwogICAgICAgIGlmICghcGFyZW50RGV0YWNoYWJsZSAmJiBF\neHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cCkpIHsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cCwgIndy\naXRlRXh0ZXJuYWwiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgb3V0\nYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyB3cml0ZVVubWFuYWdlZCAo\nb3V0KTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEp\nLAogICAgICAgICAgICBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNs\nYXNzLCBvdXRhcmdzKTsKCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGdvMiA9\nIG51bGw7CiAgICAgICAgaWYgKGRldGFjaGVkU3RhdGUpIHsKICAgICAgICAg\nICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgIC8vICAgaWYgKHNt\nLndyaXRlRGV0YWNoZWQgKG91dCkpCiAgICAgICAgICAgIC8vICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmbnVsbCA9\nIGNvZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoU01UWVBFLCAid3JpdGVEZXRhY2hlZCIsCiAgICAg\nICAgICAgICAgICBib29sZWFuLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICAg\nICAgZ28yID0gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOwoKICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAvLyAgIG91\ndC53cml0ZU9iamVjdCAocGNHZXREZXRhY2hlZFN0YXRlICgpKTsKICAgICAg\nICAgICAgQ2xhc3NbXSBvYmphcmdzID0gbmV3IENsYXNzW117IE9iamVjdC5j\nbGFzcyB9OwogICAgICAgICAgICBpZm51bGwuc2V0VGFyZ2V0KGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAog\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0\ncHV0LmNsYXNzLAogICAgICAgICAgICAgICAgIndyaXRlT2JqZWN0Iiwgdm9p\nZC5jbGFzcywgb2JqYXJncyk7CiAgICAgICAgICAgIC8vICAgIG91dC53cml0\nZU9iamVjdCAobnVsbCkgLy8gU3RhdGVNYW5hZ2VyCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKChPYmplY3QpIG51bGwpOwogICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQu\nY2xhc3MsCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNs\nYXNzLCBvYmphcmdzKTsKICAgICAgICB9CiAgICAgICAgaWYgKGdvMiAhPSBu\ndWxsKQogICAgICAgICAgICBnbzIuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoK\nICAgICAgICAvLyB3cml0ZSBtYW5hZ2VkIGZpZWxkcwogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoIWZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAg\nICAgIHdyaXRlRXh0ZXJuYWwoY29kZSwgZm1kc1tpXS5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwg\nZm1kc1tpXSk7CgogICAgICAgIC8vIHJldHVybgogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogV3JpdGUgdW5tYW5hZ2VkIGZpZWxkcyB0byB0aGUgc3RyZWFt\nIChwY1dyaXRlVW5tYW5hZ2VkKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFdyaXRlVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2QsIGJvb2xlYW4g\ncGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIG91dGFyZ3MgPSBuZXcgQ2xh\nc3NbXXsgT2JqZWN0T3V0cHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRob2Qg\nbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJXcml0ZVVubWFuYWdl\nZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG91dGFyZ3MpOwogICAgICAg\nIG1ldGgubWFrZVByb3RlY3RlZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhj\nZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vw\ncy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3Vw\nZXIud3JpdGVVbm1hbmFnZWQgKG91dCk7CiAgICAgICAgaWYgKHBhcmVudERl\ndGFjaGFibGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpKSwgUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9p\nZC5jbGFzcywgCiAgICAgICAgICAgICAgICBvdXRhcmdzKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHdyaXRlIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJpYWxp\nemFibGUgZmllbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIHdyaXRlRXh0ZXJuYWwoY29kZSwgZmllbGQu\nZ2V0TmFtZSgpLCBmaWVsZC5nZXRUeXBlKCksIG51bGwpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gd3Jp\ndGUgYSBmaWVsZCB0byBhbiBleHRlcm5hbGl6YXRpb24gb3V0cHV0IHN0cmVh\nbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlRXh0ZXJuYWwoQ29k\nZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0eXBlLAogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRoTmFtZTsKICAgICAg\nICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAgICAgICAgIG1ldGhO\nYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAgIG1ldGhOYW1lID0g\nbWV0aE5hbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKExvY2FsZS5F\nTkdMSVNIKQogICAgICAgICAgICAgICAgKyBtZXRoTmFtZS5zdWJzdHJpbmco\nMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gIndyaXRlIiArIG1ldGhOYW1l\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJ3cml0\nZU9iamVjdCI7CgogICAgICAgIC8vIG91dC53cml0ZTx0eXBlPiAoPGZpZWxk\nPik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVs\nbCwgZmllbGROYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBDbGFzc1td\nIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgdHlwZSB9OwogICAgICAgIGlmICh0eXBl\nID09IGJ5dGUuY2xhc3MgfHwgdHlwZSA9PSBjaGFyLmNsYXNzIHx8IHR5cGUg\nPT0gc2hvcnQuY2xhc3MpCiAgICAgICAgICAgIGFyZ3NbMF0gPSBpbnQuY2xh\nc3M7CiAgICAgICAgZWxzZSBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSkKICAg\nICAgICAgICAgYXJnc1swXSA9IE9iamVjdC5jbGFzczsKICAgICAgICBjb2Rl\nLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xh\nc3MsIG1ldGhOYW1lLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBhcmdzKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZhbHVlQ29k\nZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kLCB0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIExvYWQgdGhlIGZpZWxkIHZhbHVlIHNwZWNpZmllZCBieSA8Y29k\nZT5mbWQ8L2NvZGU+IG9udG8gdGhlIHN0YWNrLgogICAgICogQmVmb3JlIHRo\naXMgbWV0aG9kIGlzIGNhbGxlZCwgdGhlIG9iamVjdCB0aGF0IHRoZSBkYXRh\nIHNob3VsZCBiZSBsb2FkZWQKICAgICAqIGZyb20gd2lsbCBiZSBvbiB0aGUg\ndG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVNh\nbWVDbGFzcyBpZiA8Y29kZT50cnVlPC9jb2RlPiwgdGhlbiA8Y29kZT5mbWQ8\nL2NvZGU+IGlzCiAgICAgKiBiZWluZyBsb2FkZWQgZnJvbSBhbiBpbnN0YW5j\nZSBvZiB0aGUgc2FtZSBjbGFzcyBhcyB0aGUgY3VycmVudCBleGVjdXRpb24K\nICAgICAqIGNvbnRleHQuIElmIDxjb2RlPmZhbHNlPC9jb2RlPiwgdGhlbiB0\naGUgaW5zdGFuY2Ugb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sKICAgICAqIG1p\nZ2h0IGJlIGEgc3VwZXJjbGFzcyBvZiB0aGUgY3VycmVudCBleGVjdXRpb24g\nY29udGV4dCdzICd0aGlzJyBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVs\nZE1ldGFEYXRhIGZtZCwKICAgICAgICBib29sZWFuIGZyb21TYW1lQ2xhc3Mp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gaWYgcmVkZWZpbmluZywgdGhlbiB3ZSBtdXN0IGFsd2F5cyByZWZs\nZWN0IChvciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAgICAgLy8gZGlyZWN0bHkg\naWYgYWNjZXNzaWJsZSksIHNpbmNlIHRoZSByZWRlZmluZWQgbWV0aG9kcyB3\naWxsIGFsd2F5cwogICAgICAgIC8vIHRyaWdnZXIgbWV0aG9kIGNhbGxzIHRv\nIFN0YXRlTWFuYWdlciwgZXZlbiBmcm9tIGludGVybmFsIGRpcmVjdC0KICAg\nICAgICAvLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxkIHdvcmsgYXJvdW5kIHRo\naXMgYnkgbm90IHJlZGVmaW5pbmcsIGFuZAogICAgICAgIC8vIGp1c3QgZG8g\nYSBzdWJjbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBCdXQgdGhpcyBpcyBub3Qg\nYSBnb29kIG9wdGlvbiwKICAgICAgICAvLyBzaW5jZSBpdCB3b3VsZCBzYWNy\naWZpY2UgbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2llbnQgZGlydHkgdHJhY2tp\nbmcuCgogICAgICAgIGlmIChnZXRSZWRlZmluZSgpIHx8IGlzRmllbGRBY2Nl\nc3MoZm1kKSkgewogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBudWxsLCBm\nbWQuZ2V0TmFtZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKGdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzLCBh\nbmQgd2UncmUgbm90IHJlZGVmaW5pbmcuIElmIHdlJ3JlIG9wZXJhdGluZwog\nICAgICAgICAgICAvLyBvbiBhbiBpbnN0YW5jZSB0aGF0IGlzIGRlZmluaXRl\nbHkgdGhlIHNhbWUgdHlwZSBhcyAndGhpcycsIHRoZW4KICAgICAgICAgICAg\nLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZCB0byBieXBhc3MgdHJhY2tpbmcu\nIE90aGVyd2lzZSwgcmVmbGVjdAogICAgICAgICAgICAvLyB0byBib3RoIGJ5\ncGFzcyB0cmFja2luZyBhbmQgYXZvaWQgY2xhc3MgdmVyaWZpY2F0aW9uIGVy\ncm9ycy4KICAgICAgICAgICAgaWYgKGZyb21TYW1lQ2xhc3MpIHsKICAgICAg\nICAgICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tp\nbmdNZW1iZXIoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChtZXRoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1l\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgLy8gcmVndWxhciBlbmhhbmNlbWVudCArIHByb3BlcnR5IGFjY2Vzcwog\nICAgICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNr\naW5nTWVtYmVyKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5\ncGVzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3Jl\nIHRoZSB2YWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjayBpbnRvIHRoZSBm\naWVsZCB2YWx1ZSBzcGVjaWZpZWQKICAgICAqIGJ5IDxjb2RlPmZtZDwvY29k\nZT4uIEJlZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBkYXRhIHRv\nIGxvYWQgd2lsbAogICAgICogYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sg\nYW5kIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9hZGVk\nCiAgICAgKiBpbnRvIHdpbGwgYmUgc2Vjb25kIGluIHRoZSBzdGFjay4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUo\nQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiByZWRlZmlu\naW5nLCB0aGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0\naGUgZmllbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwg\nc2luY2UgdGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlzCiAgICAg\nICAgLy8gdHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBl\ndmVuIGZyb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFjY2VzcyB1\nc2FnZS4gV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3QgcmVkZWZp\nbmluZywgYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNzIGFwcHJv\nYWNoIGluc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAog\nICAgICAgIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5IGxvYWRp\nbmcgYW5kIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAgICAgaWYg\nKGdldFJlZGVmaW5lKCkgfHwgaXNGaWVsZEFjY2VzcyhmbWQpKSB7CiAgICAg\nICAgICAgIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCksIGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIHByb3BlcnR5IGFj\nY2VzcywgYW5kIHdlJ3JlIG5vdCByZWRlZmluaW5nLiBpbnZva2UgdGhlCiAg\nICAgICAgICAgIC8vIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFj\na2luZy4KICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBn\nZXRTZXR0ZXJOYW1lKGZtZCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2Vt\nZW50ICsgcHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyBnZXRTZXR0ZXJOYW1lKGZtZCks\nCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgdGhlIHtAbGluayBJbnN0cnVjdGlvbn1zIHRvIGxv\nYWQgdGhlIGluc3RhbmNlIHRvIG1vZGlmeSBvbnRvIHRoZQogICAgICogc3Rh\nY2ssIGFuZCByZXR1cm4gaXQuIElmIDxjb2RlPmZvclN0YXRpYzwvY29kZT4g\naXMgc2V0LCB0aGVuCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiBpcyBpbiBh\nbiBhY2Nlc3NvciBtZXRob2Qgb3IgYW5vdGhlciBzdGF0aWMgbWV0aG9kOwog\nICAgICogb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2YgdGhlIFBDLXNwZWNp\nZmllZCBtZXRob2RzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpcnN0\nIGluc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+LgogICAg\nICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYywKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoZm9yU3RhdGljICYm\nIGlzRmllbGRBY2Nlc3MoZm1kKSkKICAgICAgICAgICAgcmV0dXJuIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICByZXR1cm4gY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUg\ne0BsaW5rIEluc3RydWN0aW9ufXMgdG8gbG9hZCB0aGUgaW5zdGFuY2UgdG8g\nbW9kaWZ5IG9udG8gdGhlCiAgICAgKiBzdGFjaywgYW5kIHJldHVybiBpdC4g\nIFRoaXMgbWV0aG9kIHNob3VsZCBub3QgYmUgdXNlZCB0byBsb2FkIHN0YXRp\nYwogICAgICogZmllbGRzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZp\ncnN0IGluc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+Lgog\nICAgICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYykgewogICAgCXJl\ndHVybiBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZvclN0YXRpYywgbnVs\nbCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IGdldEFjY2Vzc29yUGFy\nYW1ldGVyT2Zmc2V0KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICByZXR1\ncm4gaXNGaWVsZEFjY2VzcyhmbWQpID8gMSA6IDA7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZmZpcm1zIGlmIHRoZSBnaXZlbiBjbGFzcyBpcyB1c2luZyBm\naWVsZC1iYXNlZCBhY2Nlc3MuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNQcm9w\nZXJ0eUFjY2VzcyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgIAlyZXR1cm4g\nbWV0YSAhPSBudWxsICYmIChtZXRhLmlzTWl4ZWRBY2Nlc3MoKSB8fCAKICAg\nIAkJQWNjZXNzQ29kZS5pc1Byb3BlcnR5KG1ldGEuZ2V0QWNjZXNzVHlwZSgp\nKSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUg\nZ2l2ZW4gZmllbGQgaXMgdXNpbmcgZmllbGQtYmFzZWQgYWNjZXNzLgogICAg\nICovCiAgICBib29sZWFuIGlzUHJvcGVydHlBY2Nlc3MoRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgIAlyZXR1cm4gZm1kICE9IG51bGwgJiYgQWNjZXNzQ29k\nZS5pc1Byb3BlcnR5KGZtZC5nZXRBY2Nlc3NUeXBlKCkpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIGZpZWxkIGlz\nIHVzaW5nIG1ldGhvZC1iYXNlZCBhY2Nlc3MuCiAgICAgKi8KICAgIGJvb2xl\nYW4gaXNGaWVsZEFjY2VzcyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgCXJl\ndHVybiBmbWQgIT0gbnVsbCAmJiBBY2Nlc3NDb2RlLmlzRmllbGQoZm1kLmdl\ndEFjY2Vzc1R5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\ndGhlIGdlbmVyYXRlZCBnZXR0ZXIge0BsaW5rIEJDTWV0aG9kfSBmb3IgPGNv\nZGU+Zm1kPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxsaW5nIGVudmlyb25tZW50\nIHdpbGwgdGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhvZCdzIGNvZGUgYmxvY2su\nCiAgICAgKi8KICAgIHByaXZhdGUgQkNNZXRob2QgY3JlYXRlR2V0TWV0aG9k\nKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQkNNZXRob2QgZ2V0dGVy\nOwogICAgICAgIGlmIChpc0ZpZWxkQWNjZXNzKGZtZCkpIHsKICAgICAgICAg\nICAgLy8gc3RhdGljIDxmaWVsZHR5cGU+IHBjR2V0PGZpZWxkPiAoWFhYIGlu\nc3QpCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0RGVjbGFy\nZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZ2V0dGVyID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldCIgKyBmbWQuZ2V0TmFtZSgp\nLCBmbWQuCiAgICAgICAgICAgICAgICBnZXREZWNsYXJlZFR5cGUoKS5nZXRO\nYW1lKCksIG5ldyBTdHJpbmdbXXsgX3BjLmdldE5hbWUoKSB9KTsKICAgICAg\nICAgICAgZ2V0dGVyLnNldEFjY2Vzc0ZsYWdzKGZpZWxkLmdldEFjY2Vzc0Zs\nYWdzKCkKICAgICAgICAgICAgICAgICYgfkNvbnN0YW50cy5BQ0NFU1NfVFJB\nTlNJRU5UICYgfkNvbnN0YW50cy5BQ0NFU1NfVk9MQVRJTEUpOwogICAgICAg\nICAgICBnZXR0ZXIuc2V0U3RhdGljKHRydWUpOwogICAgICAgICAgICBnZXR0\nZXIuc2V0RmluYWwodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBnZXR0ZXI7\nCiAgICAgICAgfQoKICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3M6CiAgICAg\nICAgLy8gY29weSB0aGUgdXNlcidzIGdldHRlciBtZXRob2QgdG8gYSBuZXcg\nbmFtZTsgd2UgY2FuJ3QganVzdCByZXNldAogICAgICAgIC8vIHRoZSBuYW1l\nLCBiZWNhdXNlIHRoYXQgd2lsbCBhbHNvIHJlc2V0IGFsbCBjYWxscyB0byB0\naGUgbWV0aG9kCiAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQu\nZ2V0QmFja2luZ01lbWJlcigpOwogICAgICAgIGdldHRlciA9IF9wYy5nZXRE\nZWNsYXJlZE1ldGhvZChtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgbWV0\naC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBCQ01ldGhvZCBuZXdn\nZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUo\nKSwKICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0\nUGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgbmV3Z2V0dGVyLnNldEFjY2Vz\nc0ZsYWdzKGdldHRlci5nZXRBY2Nlc3NGbGFncygpKTsKICAgICAgICBuZXdn\nZXR0ZXIubWFrZVByb3RlY3RlZCgpOyAKICAgICAgICB0cmFuc2ZlckNvZGVB\ndHRyaWJ1dGVzKGdldHRlciwgbmV3Z2V0dGVyKTsKICAgICAgICByZXR1cm4g\nZ2V0dGVyOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBnZW5l\ncmF0ZWQgc2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9yIDxjb2RlPmZtZDwv\nY29kZT4uIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9ubWVudCB3aWxsIHRo\nZW4gcG9wdWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJsb2NrLgogICAgICov\nCiAgICBwcml2YXRlIEJDTWV0aG9kIGNyZWF0ZVNldE1ldGhvZChGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgIEJDTWV0aG9kIHNldHRlcjsKICAgICAg\nICBpZiAoaXNGaWVsZEFjY2VzcyhmbWQpKSB7CiAgICAgICAgICAgIC8vIHN0\nYXRpYyB2b2lkIHBjU2V0PGZpZWxkPiAoWFhYIGluc3QsIDxmaWVsZHR5cGU+\nIHZhbHVlKQogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERl\nY2xhcmVkRmllbGQoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHNldHRl\nciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXQiICsgZm1kLmdldE5h\nbWUoKSwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1td\neyBnZXRUeXBlKF9tZXRhKSwgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwog\nICAgICAgICAgICBzZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZmllbGQuZ2V0QWNj\nZXNzRmxhZ3MoKQogICAgICAgICAgICAgICAgJiB+Q29uc3RhbnRzLkFDQ0VT\nU19UUkFOU0lFTlQgJiB+Q29uc3RhbnRzLkFDQ0VTU19WT0xBVElMRSk7CiAg\nICAgICAgICAgIHNldHRlci5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAg\nIHNldHRlci5zZXRGaW5hbCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHNl\ndHRlcjsKICAgICAgICB9CgogICAgICAgIC8vIHByb3BlcnR5IGFjY2VzczoK\nICAgICAgICAvLyBjb3B5IHRoZSB1c2VyJ3MgZ2V0dGVyIG1ldGhvZCB0byBh\nIG5ldyBuYW1lOyB3ZSBjYW4ndCBqdXN0IHJlc2V0CiAgICAgICAgLy8gdGhl\nIG5hbWUsIGJlY2F1c2UgdGhhdCB3aWxsIGFsc28gcmVzZXQgYWxsIGNhbGxz\nIHRvIHRoZSBtZXRob2QKICAgICAgICBzZXR0ZXIgPSBfcGMuZ2V0RGVjbGFy\nZWRNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWQpLAogICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIEJD\nTWV0aG9kIG5ld3NldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArIHNl\ndHRlci5nZXROYW1lKCksCiAgICAgICAgICAgIHNldHRlci5nZXRSZXR1cm5O\nYW1lKCksIHNldHRlci5nZXRQYXJhbU5hbWVzKCkpOwogICAgICAgIG5ld3Nl\ndHRlci5zZXRBY2Nlc3NGbGFncyhzZXR0ZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7\nCiAgICAgICAgbmV3c2V0dGVyLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICB0\ncmFuc2ZlckNvZGVBdHRyaWJ1dGVzKHNldHRlciwgbmV3c2V0dGVyKTsKICAg\nICAgICByZXR1cm4gc2V0dGVyOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBh\nZGRHZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbk1ldGhvZCgpIHsKICAg\nICAgICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJz\naW9uKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyAKICAgICAgICAgICAgICAgICJHZXRFbmhhbmNlbWVudENv\nbnRyYWN0VmVyc2lvbiIsIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0\naG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoRU5IQU5DRVJfVkVSU0lPTik7CiAgICAgICAgY29kZS5pcmV0dXJuKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGNvbmNyZXRlIHR5cGUgZm9yIHRoZSBnaXZlbiBjbGFz\ncywgaS5lLiBpbXBsIGZvciBtYW5hZ2VkCiAgICAgKiBpbnRlcmZhY2VzCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmIChtZXRhLmdldEludGVyZmFjZUltcGwoKSAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCk7CiAgICAgICAgcmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogTW92ZSBjb2RlLXJlbGF0ZWQgYXR0\ncmlidXRlcyBmcm9tIG9uZSBtZXRob2QgdG8gYW5vdGhlci4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCB0cmFuc2ZlckNvZGVBdHRyaWJ1dGVz\nKEJDTWV0aG9kIGZyb20sIEJDTWV0aG9kIHRvKSB7CiAgICAgICAgQ29kZSBj\nb2RlID0gZnJvbS5nZXRDb2RlKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIHRvLmFkZEF0dHJpYnV0ZShjb2RlKTsK\nICAgICAgICAgICAgZnJvbS5yZW1vdmVDb2RlKCk7CiAgICAgICAgfQoKICAg\nICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IGZyb20uZ2V0RXhjZXB0aW9ucyhm\nYWxzZSk7CiAgICAgICAgaWYgKGV4Y2VwcyAhPSBudWxsKQogICAgICAgICAg\nICB0by5hZGRBdHRyaWJ1dGUoZXhjZXBzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFVzYWdlOiBqYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBD\nRW5oYW5jZXIgW29wdGlvbl0qCiAgICAgKiAmbHQ7Y2xhc3MgbmFtZSB8IC5q\nYXZhIGZpbGUgfCAuY2xhc3MgZmlsZSB8IC5qZG8gZmlsZSZndDsrCiAgICAg\nKiAgV2hlcmUgdGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSByZWNvZ25pemVk\nLgogICAgICogPHVsPgogICAgICogPGxpPjxpPi1wcm9wZXJ0aWVzLy1wICZs\ndDtwcm9wZXJ0aWVzIGZpbGUmZ3Q7PC9pPjogVGhlIHBhdGggdG8gYSBPcGVu\nSlBBCiAgICAgKiBwcm9wZXJ0aWVzIGZpbGUgY29udGFpbmluZyBpbmZvcm1h\ndGlvbiBhcyBvdXRsaW5lZCBpbgogICAgICoge0BsaW5rIENvbmZpZ3VyYXRp\nb259OyBvcHRpb25hbC48L2xpPgogICAgICogPGxpPjxpPi0mbHQ7cHJvcGVy\ndHkgbmFtZSZndDsgJmx0O3Byb3BlcnR5IHZhbHVlJmd0OzwvaT46IEFsbCBi\nZWFuCiAgICAgKiBwcm9wZXJ0aWVzIG9mIHRoZSBzdGFuZGFyZCBPcGVuSlBB\nIHtAbGluayBPcGVuSlBBQ29uZmlndXJhdGlvbn0gY2FuIGJlCiAgICAgKiBz\nZXQgYnkgdXNpbmcgdGhlaXIgbmFtZXMgYW5kIHN1cHBseWluZyBhIHZhbHVl\nOyBmb3IgZXhhbXBsZToKICAgICAqIDxsaT48aT4tZGlyZWN0b3J5Ly1kICZs\ndDtidWlsZCBkaXJlY3RvcnkmZ3Q7PC9pPjogVGhlIHBhdGggdG8gdGhlIGJh\nc2UKICAgICAqIGRpcmVjdG9yeSB3aGVyZSBlbmhhbmNlZCBjbGFzc2VzIGFy\nZSBzdG9yZWQuIEJ5IGRlZmF1bHQsIHRoZQogICAgICogZW5oYW5jZXIgb3Zl\ncndyaXRlcyB0aGUgb3JpZ2luYWwgLmNsYXNzIGZpbGUgd2l0aCB0aGUgZW5o\nYW5jZWQKICAgICAqIHZlcnNpb24uIFVzZSB0aGlzIG9wdGlvbiB0byBzdG9y\nZSB0aGUgZ2VuZXJhdGVkIC5jbGFzcyBmaWxlIGluCiAgICAgKiBhbm90aGVy\nIGRpcmVjdG9yeS4gVGhlIHBhY2thZ2Ugc3RydWN0dXJlIHdpbGwgYmUgY3Jl\nYXRlZCBiZW5lYXRoCiAgICAgKiB0aGUgZ2l2ZW4gZGlyZWN0b3J5LjwvbGk+\nCiAgICAgKiA8bGk+PGk+LWFkZERlZmF1bHRDb25zdHJ1Y3Rvci8tYWRjIFt0\ncnVlL3QgfCBmYWxzZS9mXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGFkZCBh\nIGRlZmF1bHQgY29uc3RydWN0b3IgdG8gcGVyc2lzdGVudCBjbGFzc2VzIG1p\nc3Npbmcgb25lLCBhcwogICAgICogb3Bwb3NlZCB0byB0aHJvd2luZyBhbiBl\neGNlcHRpb24uIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48\naT4tdG1wQ2xhc3NMb2FkZXIvLXRjbCBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+\nOiBXaGV0aGVyIHRvCiAgICAgKiBsb2FkIHRoZSBwcmUtZW5oYW5jZWQgY2xh\nc3NlcyB1c2luZyBhIHRlbXBvcmFyeSBjbGFzcyBsb2FkZXIuCiAgICAgKiBE\nZWZhdWx0cyB0byB0cnVlLiBTZXQgdGhpcyB0byBmYWxzZSB3aGVuIGF0dGVt\ncHRpbmcgdG8gZGVidWcKICAgICAqIGNsYXNzIGxvYWRpbmcgZXJyb3JzLjwv\nbGk+CiAgICAgKiA8bGk+PGk+LWVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9u\ncy8tZXByIFt0cnVlL3QgfCBmYWxzZS9mXTwvaT46CiAgICAgKiBXaGV0aGVy\nIHRvIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBhIFBST1BFUlRZIGFjY2VzcyBl\nbnRpdHkgYXBwZWFycwogICAgICogdG8gYmUgdmlvbGF0aW5nIHN0YW5kYXJk\nIHByb3BlcnR5IHJlc3RyaWN0aW9ucy4gRGVmYXVsdHMgdG8gZmFsc2UuPC9s\naT4KICAgICAqIDwvdWw+CiAgICAgKiAgRWFjaCBhZGRpdGlvbmFsIGFyZ3Vt\nZW50IGNhbiBiZSBlaXRoZXIgdGhlIGZ1bGwgY2xhc3MgbmFtZSBvZiB0aGUK\nICAgICAqIHR5cGUgdG8gZW5oYW5jZSwgdGhlIHBhdGggdG8gdGhlIC5qYXZh\nIGZpbGUgZm9yIHRoZSB0eXBlLCB0aGUgcGF0aCB0bwogICAgICogdGhlIC5j\nbGFzcyBmaWxlIGZvciB0aGUgdHlwZSwgb3IgdGhlIHBhdGggdG8gYSAuamRv\nIGZpbGUgbGlzdGluZyBvbmUKICAgICAqIG9yIG1vcmUgdHlwZXMgdG8gZW5o\nYW5jZS4KICAgICAqIElmIHRoZSB0eXBlIGJlaW5nIGVuaGFuY2VkIGhhcyBt\nZXRhZGF0YSwgaXQgd2lsbCBiZSBlbmhhbmNlZCBhcyBhCiAgICAgKiBwZXJz\naXN0ZW5jZSBjYXBhYmxlIGNsYXNzLiBJZiBub3QsIGl0IHdpbGwgYmUgY29u\nc2lkZXJlZCBhIHBlcnNpc3RlbmNlCiAgICAgKiBhd2FyZSBjbGFzcywgYW5k\nIGFsbCBhY2Nlc3MgdG8gZmllbGRzIG9mIHBlcnNpc3RlbmNlIGNhcGFibGUg\nY2xhc3NlcwogICAgICogd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgYXBwcm9w\ncmlhdGUJZ2V0L3NldCBtZXRob2QuIElmIHRoZSB0eXBlCiAgICAgKiBleHBs\naWNpdGx5IGRlY2xhcmVzIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGludGVy\nZmFjZSwgaXQgd2lsbAogICAgICogbm90IGJlIGVuaGFuY2VkLiBUaHVzLCBp\ndCBpcyBzYWZlIHRvIGludm9rZSB0aGUgZW5oYW5jZXIgb24gY2xhc3Nlcwog\nICAgICogdGhhdCBhcmUgYWxyZWFkeSBlbmhhbmNlZC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAg\nICAgIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgYXJn\ncyA9IG9wdHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CiAgICAgICAgaWYgKCFy\ndW4oYXJncywgb3B0cykpCiAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRs\nbihfbG9jLmdldCgiZW5oYW5jZS11c2FnZSIpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlk\nIG9wdGlvbnMgZ2l2ZW4uIFJ1bnMgYWdhaW5zdCBhbGwKICAgICAqIHRoZSBw\nZXJzaXN0ZW5jZSB1bml0cyBkZWZpbmVkIGluIHRoZSByZXNvdXJjZSB0byBw\nYXJzZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihm\naW5hbCBTdHJpbmdbXSBhcmdzLCBPcHRpb25zIG9wdHMpIHsKICAgICAgICBy\nZXR1cm4gQ29uZmlndXJhdGlvbnMucnVuQWdhaW5zdEFsbEFuY2hvcnMob3B0\ncywKICAgICAgICAgICAgbmV3IENvbmZpZ3VyYXRpb25zLlJ1bm5hYmxlKCkg\newogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW4oT3B0aW9ucyBvcHRz\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICAgICAgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBPcGVuSlBBQ29uZmlndXJhdGlv\nbkltcGwoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIFBDRW5oYW5jZXIucnVuKGNvbmYsIGFyZ3MsIG9wdHMp\nOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nICAgICBjb25mLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0\naGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlkIG9wdGlvbnMgZ2l2\nZW4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAg\nICBPcHRpb25zIG9wdHMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBGbGFncyBmbGFncyA9IG5ldyBGbGFncygpOwogICAgICAgIGZs\nYWdzLmRpcmVjdG9yeSA9IEZpbGVzLmdldEZpbGUob3B0cy5yZW1vdmVQcm9w\nZXJ0eSgiZGlyZWN0b3J5IiwgImQiLAogICAgICAgICAgICBudWxsKSwgbnVs\nbCk7CiAgICAgICAgZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9yID0gb3B0\ncy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJhZGREZWZh\ndWx0Q29uc3RydWN0b3IiLCAiYWRjIiwgZmxhZ3MuYWRkRGVmYXVsdENvbnN0\ncnVjdG9yKTsKICAgICAgICBmbGFncy50bXBDbGFzc0xvYWRlciA9IG9wdHMu\ncmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgidG1wQ2xhc3NM\nb2FkZXIiLCAidGNsIiwgZmxhZ3MudG1wQ2xhc3NMb2FkZXIpOwogICAgICAg\nIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IG9wdHMucmVt\nb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiZW5mb3JjZVByb3Bl\ncnR5UmVzdHJpY3Rpb25zIiwgImVwciIsCiAgICAgICAgICAgICAgICBmbGFn\ncy5lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMpOwoKICAgICAgICAvLyBm\nb3IgdW5pdCB0ZXN0aW5nCiAgICAgICAgQnl0ZWNvZGVXcml0ZXIgd3JpdGVy\nID0gKEJ5dGVjb2RlV3JpdGVyKSBvcHRzLmdldCgKICAgICAgICAgICAgUENF\nbmhhbmNlci5jbGFzcy5nZXROYW1lKCkgKyAiI2J5dGVjb2RlV3JpdGVyIik7\nCgogICAgICAgIENvbmZpZ3VyYXRpb25zLnBvcHVsYXRlQ29uZmlndXJhdGlv\nbihjb25mLCBvcHRzKTsKICAgICAgICByZXR1cm4gcnVuKGNvbmYsIGFyZ3Ms\nIGZsYWdzLCBudWxsLCB3cml0ZXIsIG51bGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogRW5oYW5jZSB0aGUgZ2l2ZW4gY2xhc3Nlcy4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihPcGVuSlBBQ29uZmlndXJhdGlv\nbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAgICAgIEZsYWdzIGZsYWdzLCBN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsIEJ5dGVjb2RlV3JpdGVyIHdyaXRl\nciwKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobG9hZGVyID09IG51bGwpCiAg\nICAgICAgICAgIGxvYWRlciA9IGNvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3Rh\nbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihQQ0VuaGFu\nY2VyLmNsYXNzLCBudWxsKTsKICAgICAgICBpZiAoZmxhZ3MudG1wQ2xhc3NM\nb2FkZXIpCiAgICAgICAgICAgIGxvYWRlciA9IEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAu\nbmV3VGVtcG9yYXJ5Q2xhc3NMb2FkZXJBY3Rpb24obG9hZGVyKSk7CgogICAg\nICAgIGlmIChyZXBvcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJlcG9zID0g\nY29uZi5uZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAg\nICAgICByZXBvcy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5N\nT0RFX01FVEEpOwogICAgICAgIH0KCiAgICAgICAgTG9nIGxvZyA9IGNvbmYu\nZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19UT09MKTsKICAgICAg\nICBDb2xsZWN0aW9uIGNsYXNzZXM7CiAgICAgICAgaWYgKGFyZ3MgPT0gbnVs\nbCB8fCBhcmdzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGxvZy5pbmZv\nKF9sb2MuZ2V0KCJydW5uaW5nLWFsbC1jbGFzc2VzIikpOwogICAgICAgICAg\nICBjbGFzc2VzID0gcmVwb3MuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyh0cnVl\nLCBsb2FkZXIpOwogICAgICAgICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIAlsb2cud2FybihfbG9jLmdldCgibm8tY2xhc3MtdG8t\nZW5oYW5jZSIpKTsKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENsYXNzQXJn\nUGFyc2VyIGNhcCA9IGNvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFu\nY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLm5l\nd0NsYXNzQXJnUGFyc2VyKCk7CiAgICAgICAgICAgIGNhcC5zZXRDbGFzc0xv\nYWRlcihsb2FkZXIpOwogICAgICAgICAgICBjbGFzc2VzID0gbmV3IEhhc2hT\nZXQoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChjYXAucGFyc2VUeXBlcyhhcmdzW2ldKSkpOwogICAgICAg\nIH0KCiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsK\nICAgICAgICBCQ0NsYXNzIGJjOwogICAgICAgIFBDRW5oYW5jZXIgZW5oYW5j\nZXI7CiAgICAgICAgaW50IHN0YXR1czsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGNsYXNzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgT2JqZWN0IG8gPSBpdHIubmV4dCgpOwogICAgICAgICAg\nICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtcnVubmluZyIsIG8pKTsKCiAg\nICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAg\nICAgICAgYmMgPSBwcm9qZWN0LmxvYWRDbGFzcygoU3RyaW5nKSBvLCBsb2Fk\nZXIpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBiYyA9IHBy\nb2plY3QubG9hZENsYXNzKChDbGFzcykgbyk7CiAgICAgICAgICAgIGVuaGFu\nY2VyID0gbmV3IFBDRW5oYW5jZXIoY29uZiwgYmMsIHJlcG9zLCBsb2FkZXIp\nOwogICAgICAgICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBlbmhhbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAg\nICAgICAgICBlbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5\nKTsKICAgICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVj\ndG9yKGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAg\nIHN0YXR1cyA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAoc3Rh\ndHVzID09IEVOSEFOQ0VfTk9ORSkgewogICAgICAgICAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShfbG9jLmdldCgiZW5oYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAg\nICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50\nZXJmYWNlIikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBF\nTkhBTkNFX0FXQVJFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJlbmhhbmNlLWF3YXJlIikpOwogICAgICAgICAgICAgICAgZW5o\nYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIHByb2plY3Qu\nY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBk\naXJlY3RvcnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERl\nZmF1bHRDb25zdHJ1Y3RvciA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xl\nYW4gdG1wQ2xhc3NMb2FkZXIgPSB0cnVlOwogICAgICAgIHB1YmxpYyBib29s\nZWFuIGVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IGZhbHNlOwogICAg\nfQoKICAgIC8qKgogICAgICogUGx1Z2luIGludGVyZmFjZSBmb3IgYWRkaXRp\nb25hbCBlbmhhbmNlbWVudC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBp\nbnRlcmZhY2UgQXV4aWxpYXJ5RW5oYW5jZXIKICAgIHsKICAgICAgICBwdWJs\naWMgdm9pZCBydW4gKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEgbWV0YSk7\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gc2tpcEVuaGFuY2UoQkNNZXRob2Qg\nbSk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBhZGRHZXRJRE93bmlu\nZ0NsYXNzKCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIkdldElET3duaW5nQ2xhc3MiLCAKICAgICAgICAgICAgQ2xhc3MuY2xhc3Ms\nIG51bGwpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwogICAgICAgIAogICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNl\ndENsYXNzKGdldFR5cGUoX21ldGEpKTsKICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICAKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KfQo=\n","encoding":"base64"}

