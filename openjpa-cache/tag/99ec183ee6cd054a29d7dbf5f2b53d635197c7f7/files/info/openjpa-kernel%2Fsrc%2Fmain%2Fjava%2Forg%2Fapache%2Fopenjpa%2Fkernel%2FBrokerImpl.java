{"sha":"a0ecab522c294313e6d0c2278b06561582736112","node_id":"MDQ6QmxvYjIwNjM2NDphMGVjYWI1MjJjMjk0MzEzZTZkMGMyMjc4YjA2NTYxNTgyNzM2MTEy","size":169293,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a0ecab522c294313e6d0c2278b06561582736112","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07Cmlt\ncG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3ND\nb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0Q29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBq\nYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7CmltcG9ydCBqYXZheC50cmFuc2Fj\ndGlvbi5TeW5jaHJvbml6YXRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmNvbGxlY3Rpb25zLml0ZXJhdG9ycy5JdGVyYXRvckNoYWluOwppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5JZGVudGl0\neU1hcDsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5t\nYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxl\nY3Rpb25zLnNldC5NYXBCYWNrZWRTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5Db21wYXRpYmlsaXR5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRhdGFDYWNoZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lZS5NYW5hZ2VkUnVudGltZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5SZWZsZWN0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2\nZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNs\nZUV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVu\ndC5SZW1vdGVDb21taXRFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZXZlbnQuVHJhbnNhY3Rpb25FdmVudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlvbkV2ZW50TWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNz\naW9uUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cu\nTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Q\ncml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5SZWZlcmVuY2VIYXNoTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hTZXQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlTWFwOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2ll\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9u\nSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNl\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJh\nbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklt\ncGxIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRl\ncm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludmFsaWRTdGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk5vVHJhbnNhY3Rpb25FeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RFeGlzdHNFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGlt\naXN0aWNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5SdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuV3JhcHBlZEV4Y2VwdGlvbjsK\nCi8qKgogKiBDb25jcmV0ZSB7QGxpbmsgQnJva2VyfS4gVGhlIGJyb2tlciBo\nYW5kbGVzIG9iamVjdC1sZXZlbCBiZWhhdmlvciwKICogYnV0IGxlYXZlcyBh\nbGwgaW50ZXJhY3Rpb24gd2l0aCB0aGUgZGF0YSBzdG9yZSB0byBhIHtAbGlu\nayBTdG9yZU1hbmFnZXJ9CiAqIHRoYXQgbXVzdCBiZSBzdXBwbGllZCBhdCBp\nbml0aWFsaXphdGlvbi4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCkBT\ndXBwcmVzc1dhcm5pbmdzKCJzZXJpYWwiKQpwdWJsaWMgY2xhc3MgQnJva2Vy\nSW1wbAogICAgaW1wbGVtZW50cyBCcm9rZXIsIEZpbmRDYWxsYmFja3MsIENs\nb25lYWJsZSwgU2VyaWFsaXphYmxlIHsKCiAgICAvKioKICAgICAqIEluY3Jl\nbWVudGFsIGZsdXNoLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBGTFVTSF9JTkMgPSAwOwoKICAgIC8qKgogICAgICogRmx1c2gg\naW4gcHJlcGFyYXRpb24gb2YgY29tbWl0LgogICAgICovCiAgICBwcm90ZWN0\nZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9DT01NSVQgPSAxOwoKICAgIC8q\nKgogICAgICogRmx1c2ggdG8gY2hlY2sgY29uc2lzdGVuY3kgb2YgY2FjaGUs\nIHRoZW4gaW1tZWRpYXRlbHkgcm9sbGJhY2sgY2hhbmdlcy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfUk9MTEJBQ0sg\nPSAyOwoKICAgIC8qKgogICAgICogUnVuIHBlcnNpc3RlbmNlLWJ5LXJlYWNo\nYWJpbGl0eSBhbmQgb3RoZXIgZmx1c2gtdGltZSBvcGVyYXRpb25zIHdpdGhv\ndXQKICAgICAqIGFjY2Vzc2luZyB0aGUgZGF0YWJhc2UuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZMVVNIX0xPR0lDQUwgPSAz\nOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTX0lOSVQgPSAwOwogICAg\nc3RhdGljIGZpbmFsIGludCBTVEFUVVNfVFJBTlNJRU5UID0gMTsKICAgIHN0\nYXRpYyBmaW5hbCBpbnQgU1RBVFVTX09JRF9BU1NJR04gPSAyOwogICAgc3Rh\ndGljIGZpbmFsIGludCBTVEFUVVNfQ09NTUlUX05FVyA9IDM7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfQUNUSVZFID0gMiA8PCAwOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfU1RPUkVfQUNUSVZF\nID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nQ0xPU0VfSU5WT0tFRCA9IDIgPDwgMjsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX1BSRVNUT1JJTkcgPSAyIDw8IDM7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19ERVJFRkRFTEVUSU5HID0gMiA8PCA0\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxVU0hJTkcg\nPSAyIDw8IDU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19T\nVE9SRV9GTFVTSElORyA9IDIgPDwgNjsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0ZMVVNIRUQgPSAyIDw8IDc7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSF9SRVFVSVJFRCA9IDIgPDwgODsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1JFTU9URV9MSVNU\nRU5FUiA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1JFVEFJTkVEX0NPTk4gPSAyIDw8IDEwOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEZMQUdfVFJBTlNfRU5ESU5HID0gMiA8PCAxMTsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBFTVBUWV9PQkpFQ1RT\nID0gbmV3IE9iamVjdFswXTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgX2xvYyA9CiAgICAgICAgTG9jYWxpemVyLmZvclBhY2thZ2Uo\nQnJva2VySW1wbC5jbGFzcyk7CgogICAgLy8JdGhlIHN0b3JlIG1hbmFnZXIg\naW4gdXNlOyB0aGlzIG1heSBiZSBhIGRlY29yYXRvciBzdWNoIGFzIGEKICAg\nIC8vCWRhdGEgY2FjaGUgc3RvcmUgbWFuYWdlciBhcm91bmQgdGhlIG5hdGl2\nZSBzdG9yZSBtYW5hZ2VyCiAgICBwcml2YXRlIHRyYW5zaWVudCBEZWxlZ2F0\naW5nU3RvcmVNYW5hZ2VyIF9zdG9yZSA9IG51bGw7CgogICAgcHJpdmF0ZSBG\nZXRjaENvbmZpZ3VyYXRpb24gX2ZjID0gbnVsbDsKICAgIHByaXZhdGUgU3Ry\naW5nIF91c2VyID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9wYXNzID0g\nbnVsbDsKCiAgICAvLyB0aGVzZSBtdXN0IGJlIHJlYnVpbHQgYnkgdGhlIGZh\nY2FkZSBsYXllciBkdXJpbmcgaXRzIGRlc2VyaWFsaXphdGlvbgogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxsOwogICAgcHJpdmF0ZSB0\ncmFuc2llbnQgQ29tcGF0aWJpbGl0eSBfY29tcGF0ID0gbnVsbDsKICAgIHBy\naXZhdGUgdHJhbnNpZW50IE1hbmFnZWRSdW50aW1lIF9ydW50aW1lID0gbnVs\nbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IExvY2tNYW5hZ2VyIF9sbSA9IG51\nbGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBJbnZlcnNlTWFuYWdlciBfaW0g\nPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVlbnRyYW50TG9jayBf\nbG9jayA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBPcENhbGxiYWNr\ncyBfY2FsbCA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBSdW50aW1l\nRXhjZXB0aW9uVHJhbnNsYXRvciBfZXh0cmFucyA9IG51bGw7CgogICAgLy8g\ncmVmIHRvIHByb2R1Y2luZyBmYWN0b3J5IGFuZCBjb25maWd1cmF0aW9uCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBBYnN0cmFjdEJyb2tlckZhY3RvcnkgX2Zh\nY3RvcnkgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgT3BlbkpQQUNv\nbmZpZ3VyYXRpb24gX2NvbmYgPSBudWxsOwoKICAgIC8vIGNhY2hlIGNsYXNz\nIGxvYWRlciBhc3NvY2lhdGVkIHdpdGggdGhlIGJyb2tlcgogICAgcHJpdmF0\nZSB0cmFuc2llbnQgQ2xhc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7CgogICAg\nLy8gdXNlciBzdGF0ZQogICAgcHJpdmF0ZSBTeW5jaHJvbml6YXRpb24gX3N5\nbmMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8T2JqZWN0LCBPYmplY3Q+IF91\nc2VyT2JqZWN0cyA9IG51bGw7CgogICAgLy8gbWFuYWdlZCBvYmplY3QgY2Fj\naGVzCiAgICBwcml2YXRlIE1hbmFnZWRDYWNoZSBfY2FjaGUgPSBudWxsOwog\nICAgcHJpdmF0ZSBUcmFuc2FjdGlvbmFsQ2FjaGUgX3RyYW5zQ2FjaGUgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTZXQ8U3RhdGVNYW5hZ2VySW1wbD4gX3RyYW5z\nQWRkaXRpb25zID0gbnVsbDsKICAgIHByaXZhdGUgU2V0PFN0YXRlTWFuYWdl\nckltcGw+IF9kZXJlZkNhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0PFN0\nYXRlTWFuYWdlckltcGw+IF9kZXJlZkFkZGl0aW9ucyA9IG51bGw7CgogICAg\nLy8gdGhlc2UgYXJlIHVzZWQgZm9yIG1ldGhvZC1pbnRlcm5hbCBzdGF0ZSBv\nbmx5CiAgICBwcml2YXRlIHRyYW5zaWVudCBNYXA8T2JqZWN0LCBTdGF0ZU1h\nbmFnZXJJbXBsPiBfbG9hZGluZyA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5z\naWVudCBTZXQ8T2JqZWN0PiBfb3BlcmF0aW5nID0gbnVsbDsKCiAgICBwcml2\nYXRlIFNldDxDbGFzczw/Pj4gX3BlcnNpc3RlZENsc3MgPSBudWxsOwogICAg\ncHJpdmF0ZSBTZXQ8Q2xhc3M8Pz4+IF91cGRhdGVkQ2xzcyA9IG51bGw7CiAg\nICBwcml2YXRlIFNldDxDbGFzczw/Pj4gX2RlbGV0ZWRDbHNzID0gbnVsbDsK\nICAgIHByaXZhdGUgU2V0PFN0YXRlTWFuYWdlckltcGw+IF9wZW5kaW5nID0g\nbnVsbDsKICAgIHByaXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7CgogICAg\nLy8gdHJhY2sgaW5zdGFuY2VzIHRoYXQgYmVjb21lIHRyYW5zYWN0aW9uYWwg\nYWZ0ZXIgdGhlIGZpcnN0IHNhdmVwb2ludAogICAgLy8gKHRoZSBmaXJzdCB1\nc2VzIHRoZSB0cmFuc2FjdGlvbmFsIGNhY2hlKQogICAgcHJpdmF0ZSBTZXQ8\nU3RhdGVNYW5hZ2VySW1wbD4gX3NhdmVwb2ludENhY2hlID0gbnVsbDsKICAg\nIHByaXZhdGUgTGlua2VkTWFwIF9zYXZlcG9pbnRzID0gbnVsbDsKICAgIHBy\naXZhdGUgdHJhbnNpZW50IFNhdmVwb2ludE1hbmFnZXIgX3NwbSA9IG51bGw7\nCgogICAgLy8gdHJhY2sgb3BlbiBxdWVyaWVzIGFuZCBleHRlbnRzIHNvIHdl\nIGNhbiBmcmVlIHRoZWlyIHJlc291cmNlcyBvbiBjbG9zZQogICAgcHJpdmF0\nZSB0cmFuc2llbnQgUmVmZXJlbmNlSGFzaFNldCBfcXVlcmllcyA9IG51bGw7\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBSZWZlcmVuY2VIYXNoU2V0IF9leHRl\nbnRzID0gbnVsbDsKCiAgICAvLyB0cmFjayBvcGVyYXRpb24gc3RhY2sgZGVw\ndGguIFRyYW5zaWVudCBiZWNhdXNlIG9wZXJhdGlvbnMgY2Fubm90CiAgICAv\nLyBzcGFuIHNlcmlhbGl6YXRpb24uCiAgICBwcml2YXRlIHRyYW5zaWVudCBp\nbnQgX29wZXJhdGlvbkNvdW50ID0gMDsKCiAgICAvLyBvcHRpb25zCiAgICBw\ncml2YXRlIGJvb2xlYW4gX25vbnRyYW5zUmVhZCA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9ub250cmFuc1dyaXRlID0gZmFsc2U7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX3JldGFpblN0YXRlID0gZmFsc2U7CiAgICBwcml2YXRl\nIGludCBfYXV0b0NsZWFyID0gQ0xFQVJfREFUQVNUT1JFOwogICAgcHJpdmF0\nZSBpbnQgX3Jlc3RvcmVTdGF0ZSA9IFJFU1RPUkVfSU1NVVRBQkxFOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9vcHRpbWlzdGljID0gZmFsc2U7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX2lnbm9yZUNoYW5nZXMgPSBmYWxzZTsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfbXVsdGl0aHJlYWRlZCA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9tYW5hZ2VkID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX3N5bmNNYW5hZ2VkID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfY29u\nblJldGFpbk1vZGUgPSBDT05OX1JFVEFJTl9ERU1BTkQ7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2V2aWN0RGF0YUNhY2hlID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX3BvcHVsYXRlRGF0YUNhY2hlID0gdHJ1ZTsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfbGFyZ2VUcmFuc2FjdGlvbiA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBpbnQgX2F1dG9EZXRhY2ggPSAwOwogICAgcHJpdmF0ZSBpbnQgX2Rl\ndGFjaFN0YXRlID0gREVUQUNIX0xPQURFRDsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfZGV0YWNoZWROZXcgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9v\ncmRlckRpcnR5ID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NhY2hl\nUHJlcGFyZWRRdWVyeSA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Nh\nY2hlRmluZGVyUXVlcnkgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9z\ndXBwcmVzc0JhdGNoT0xFTG9nZ2luZyA9IGZhbHNlOwoKICAgIC8vIHN0YXR1\ncwogICAgcHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsKCiAgICAvLyB0aGlzIGlz\nIG5vdCBpbiBzdGF0dXMgYmVjYXVzZSBpdCBzaG91bGQgbm90IGJlIHNlcmlh\nbGl6ZWQKICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX2lzU2VyaWFs\naXppbmcgPSBmYWxzZTsKCiAgICAvLyB0cmFuc2llbnQgYmVjYXVzZSBjbG9z\nZWQgYnJva2VycyBjYW4ndCBiZSBzZXJpYWxpemVkCiAgICBwcml2YXRlIHRy\nYW5zaWVudCBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsKICAgIHByaXZhdGUg\ndHJhbnNpZW50IFJ1bnRpbWVFeGNlcHRpb24gX2Nsb3NlZEV4Y2VwdGlvbiA9\nIG51bGw7CgogICAgLy8gZXZlbnQgbWFuYWdlcnMKICAgIHByaXZhdGUgVHJh\nbnNhY3Rpb25FdmVudE1hbmFnZXIgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbnVs\nbDsKICAgIHByaXZhdGUgaW50IF90cmFuc0NhbGxiYWNrTW9kZSA9IDA7CiAg\nICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFuYWdlciBfbGlmZUV2ZW50TWFu\nYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbGlmZUNhbGxiYWNrTW9k\nZSA9IDA7CgogICAgcHJpdmF0ZSB0cmFuc2llbnQgYm9vbGVhbiBfaW5pdGlh\nbGl6ZVdhc0ludm9rZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgdHJhbnNpZW50\nIGJvb2xlYW4gX2Zyb21Xcml0ZUJlaGluZENhbGxiYWNrID0gZmFsc2U7CiAg\nICBwcml2YXRlIExpbmtlZExpc3Q8RmV0Y2hDb25maWd1cmF0aW9uPiBfZmNz\nOwogICAgCiAgICAvLyBTZXQgb2Ygc3VwcG9ydGVkIHByb3BlcnR5IGtleXMu\nIFRoZSBrZXlzIGluIHRoaXMgc2V0IGNvcnJlc3BvbmQgdG8gYmVhbi1zdHls\nZSBzZXR0ZXIgbWV0aG9kcwogICAgLy8gdGhhdCBjYW4gYmUgc2V0IGJ5IHJl\nZmxlY3Rpb24uIFRoZSBrZXlzIGFyZSBub3QgcXVhbGlmaWVkIGJ5IGFueSBw\ncmVmaXguCiAgICBwcml2YXRlIHN0YXRpYyBTZXQ8U3RyaW5nPiBfc3VwcG9y\ndGVkUHJvcGVydHlOYW1lczsKICAgIHN0YXRpYyB7CiAgICAgICAgX3N1cHBv\ncnRlZFByb3BlcnR5TmFtZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAg\nICAgICAgX3N1cHBvcnRlZFByb3BlcnR5TmFtZXMuYWRkQWxsKEFycmF5cy5h\nc0xpc3QobmV3IFN0cmluZ1tdIHsKICAgICAgICAgICAgICAgICJBdXRvQ2xl\nYXIiLCAKICAgICAgICAgICAgICAgICJBdXRvRGV0YWNoIiwgCiAgICAgICAg\nICAgICAgICAiQ2FjaGVGaW5kZXJRdWVyeSIsIAogICAgICAgICAgICAgICAg\nIkNhY2hlUHJlcGFyZWRRdWVyeSIsIAogICAgICAgICAgICAgICAgIkRldGFj\naGVkTmV3IiwgCiAgICAgICAgICAgICAgICAiRGV0YWNoU3RhdGUiLCAKICAg\nICAgICAgICAgICAgICJFdmljdEZyb21EYXRhQ2FjaGUiLCAKICAgICAgICAg\nICAgICAgICJJZ25vcmVDaGFuZ2VzIiwgCiAgICAgICAgICAgICAgICAiTGlm\nZWN5Y2xlTGlzdGVuZXJDYWxsYmFja01vZGUiLCAKICAgICAgICAgICAgICAg\nICJNdWx0aXRocmVhZGVkIiwgCiAgICAgICAgICAgICAgICAiTm9udHJhbnNh\nY3Rpb25hbFJlYWQiLCAKICAgICAgICAgICAgICAgICJOb250cmFuc2FjdGlv\nbmFsV3JpdGUiLCAKICAgICAgICAgICAgICAgICJPcHRpbWlzdGljIiwgCiAg\nICAgICAgICAgICAgICAiUG9wdWxhdGVEYXRhQ2FjaGUiLAogICAgICAgICAg\nICAgICAgIlJlc3RvcmVTdGF0ZSIsIAogICAgICAgICAgICAgICAgIlJldGFp\nblN0YXRlIiwKICAgICAgICAgICAgICAgIH0pKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlcidzIGF1dGhlbnRp\nY2F0aW9uLiBUaGlzIGlzIHRoZSBmaXJzdAogICAgICogbWV0aG9kIGNhbGxl\nZCBhZnRlciBjb25zdHJ1Y3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIHVz\nZXIgdGhlIHVzZXJuYW1lIHRoaXMgYnJva2VyIHJlcHJlc2VudHM7IHVzZWQg\nd2hlbiBwb29saW5nCiAgICAgKiBicm9rZXJzIHRvIG1ha2Ugc3VyZSB0aGF0\nIGEgcmVxdWVzdCB0byB0aGUgZmFjdG9yeSBmb3IKICAgICAqIGEgY29ubmVj\ndGlvbiB3aXRoIGFuIGV4cGxpY2l0IHVzZXIgaXMgZGVsZWdhdGVkIHRvIGEg\nc3VpdGFibGUgYnJva2VyCiAgICAgKiBAcGFyYW0gcGFzcyB0aGUgcGFzc3dv\ncmQgZm9yIHRoZSBhYm92ZSB1c2VyCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEF1dGhlbnRpY2F0aW9uKFN0cmluZyB1c2VyLCBTdHJpbmcgcGFzcykg\newogICAgICAgIF91c2VyID0gdXNlcjsKICAgICAgICBfcGFzcyA9IHBhc3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHRoZSBwZXJzaXN0\nZW5jZSBtYW5hZ2VyLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQKICAgICAqIGF1\ndG9tYXRpY2FsbHkgYnkgdGhlIGZhY3RvcnkgYmVmb3JlIHVzZS4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZmFjdG9yeSB0aGUgZmFjdG9yeSB1c2VkIHRvIGNy\nZWF0ZSB0aGlzIGJyb2tlcgogICAgICogQHBhcmFtIHNtIGEgY29uY3JldGUg\nU3RvcmVNYW5hZ2VyIGltcGxlbWVudGF0aW9uIHRvCiAgICAgKiBoYW5kbGUg\naW50ZXJhY3Rpb24gd2l0aCB0aGUgZGF0YSBzdG9yZQogICAgICogQHBhcmFt\nIG1hbmFnZWQgdGhlIHRyYW5zYWN0aW9uIG1vZGUKICAgICAqIEBwYXJhbSBj\nb25uTW9kZSB0aGUgY29ubmVjdGlvbiByZXRhaW4gbW9kZQogICAgICogQHBh\ncmFtIGZyb21EZXNlcmlhbGl6YXRpb24gd2hldGhlciB0aGlzIGNhbGwgaGFw\ncGVuZWQgYmVjYXVzZSBvZiBhCiAgICAgKiBkZXNlcmlhbGl6YXRpb24gb3Ig\nY3JlYXRpb24gb2YgYSBuZXcgQnJva2VySW1wbC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgaW5pdGlhbGl6ZShBYnN0cmFjdEJyb2tlckZhY3RvcnkgZmFj\ndG9yeSwKICAgICAgICBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIHNtLCBib29s\nZWFuIG1hbmFnZWQsIGludCBjb25uTW9kZSwKICAgICAgICBib29sZWFuIGZy\nb21EZXNlcmlhbGl6YXRpb24pIHsKICAgICAgICBpbml0aWFsaXplKGZhY3Rv\ncnksIHNtLCBtYW5hZ2VkLCBjb25uTW9kZSwgZnJvbURlc2VyaWFsaXphdGlv\nbiwgZmFsc2UpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBpbml0aWFs\naXplKEFic3RyYWN0QnJva2VyRmFjdG9yeSBmYWN0b3J5LAogICAgICAgIERl\nbGVnYXRpbmdTdG9yZU1hbmFnZXIgc20sIGJvb2xlYW4gbWFuYWdlZCwgaW50\nIGNvbm5Nb2RlLAogICAgICAgIGJvb2xlYW4gZnJvbURlc2VyaWFsaXphdGlv\nbiwgYm9vbGVhbiBmcm9tV3JpdGVCZWhpbmRDYWxsYmFjaykgewogICAgICAg\nIF9mcm9tV3JpdGVCZWhpbmRDYWxsYmFjayA9IGZyb21Xcml0ZUJlaGluZENh\nbGxiYWNrOwogICAgICAgIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IHRydWU7\nCiAgICAgICAgX2xvYWRlciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xh\nc3NMb2FkZXJBY3Rpb24oKSk7CiAgICAgICAgaWYgKCFmcm9tRGVzZXJpYWxp\nemF0aW9uKQogICAgICAgICAgICBfY29uZiA9IGZhY3RvcnkuZ2V0Q29uZmln\ndXJhdGlvbigpOwogICAgICAgIF9jb21wYXQgPSBfY29uZi5nZXRDb21wYXRp\nYmlsaXR5SW5zdGFuY2UoKTsKICAgICAgICBfZmFjdG9yeSA9IGZhY3Rvcnk7\nCiAgICAgICAgX2xvZyA9IF9jb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJh\ndGlvbi5MT0dfUlVOVElNRSk7CiAgICAgICAgaWYgKCFmcm9tRGVzZXJpYWxp\nemF0aW9uKQogICAgICAgICAgICBfY2FjaGUgPSBuZXcgTWFuYWdlZENhY2hl\nKHRoaXMpOwogICAgICAgIGluaXRpYWxpemVPcGVyYXRpbmdTZXQoKTsKICAg\nICAgICBfY29ublJldGFpbk1vZGUgPSBjb25uTW9kZTsKICAgICAgICBfbWFu\nYWdlZCA9IG1hbmFnZWQ7CiAgICAgICAgaWYgKG1hbmFnZWQpCiAgICAgICAg\nICAgIF9ydW50aW1lID0gX2NvbmYuZ2V0TWFuYWdlZFJ1bnRpbWVJbnN0YW5j\nZSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3J1bnRpbWUgPSBuZXcg\nTG9jYWxNYW5hZ2VkUnVudGltZSh0aGlzKTsKCiAgICAgICAgaWYgKCFmcm9t\nRGVzZXJpYWxpemF0aW9uKSB7CiAgICAgICAgICAgIF9saWZlRXZlbnRNYW5h\nZ2VyID0gX2NvbmYuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5hZ2VySW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbmV3IFRyYW5z\nYWN0aW9uRXZlbnRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGludCBjbW9kZSA9\nIF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAg\nICAgICAgICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygp\nLmdldENhbGxiYWNrTW9kZSgpOwogICAgICAgICAgICBzZXRMaWZlY3ljbGVM\naXN0ZW5lckNhbGxiYWNrTW9kZShjbW9kZSk7CiAgICAgICAgICAgIHNldFRy\nYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwoKICAgICAg\nICAgICAgLy8gc2V0dXAgZGVmYXVsdCBvcHRpb25zCiAgICAgICAgICAgIF9m\nYWN0b3J5LmNvbmZpZ3VyZUJyb2tlcih0aGlzKTsKICAgICAgICB9CgogICAg\nICAgIC8vIG1ha2Ugc3VyZSB0byBkbyB0aGlzIGFmdGVyIGNvbmZpZ3VyaW5n\nIGJyb2tlciBzbyB0aGF0IHN0b3JlIG1hbmFnZXIKICAgICAgICAvLyBjYW4g\nbG9vayB0byBicm9rZXIgY29uZmlndXJhdGlvbjsgd2Ugc2V0IGJvdGggc3Rv\ncmUgYW5kIGxvY2sgbWFuYWdlcnMKICAgICAgICAvLyBiZWZvcmUgaW5pdGlh\nbGl6aW5nIHRoZW0gYmVjYXVzZSB0aGV5IG1heSBlYWNoIHRyeSB0byBhY2Nl\nc3MgdGhlCiAgICAgICAgLy8gb3RoZXIgaW4gdGhlaXIgaW5pdGlhbGl6YXRp\nb24KICAgICAgICBfc3RvcmUgPSBzbTsKICAgICAgICBfbG0gPSBfY29uZi5u\nZXdMb2NrTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX2ltID0gX2NvbmYu\nbmV3SW52ZXJzZU1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9zcG0gPSBf\nY29uZi5nZXRTYXZlcG9pbnRNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBf\nc3RvcmUuc2V0Q29udGV4dCh0aGlzKTsKICAgICAgICBfbG0uc2V0Q29udGV4\ndCh0aGlzKTsKCiAgICAgICAgaWYgKF9jb25uUmV0YWluTW9kZSA9PSBDT05O\nX1JFVEFJTl9BTFdBWVMpCiAgICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24o\nKTsKICAgICAgICBpZiAoIWZyb21EZXNlcmlhbGl6YXRpb24pIHsKICAgICAg\nICAgICAgX2ZjID0gX3N0b3JlLm5ld0ZldGNoQ29uZmlndXJhdGlvbigpOwog\nICAgICAgICAgICBfZmMuc2V0Q29udGV4dCh0aGlzKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIHN5bmNoIHdpdGggdGhlIGdsb2JhbCB0cmFuc2FjdGlvbiBp\nbiBwcm9ncmVzcywgaWYgYW55CiAgICAgICAgaWYgKF9mYWN0b3J5LnN5bmNX\naXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIGZhbHNlKSkKICAgICAgICAg\nICAgYmVnaW5JbnRlcm5hbCgpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBp\nbml0aWFsaXplT3BlcmF0aW5nU2V0KCkgewogICAgICAgIF9vcGVyYXRpbmcg\nPSBNYXBCYWNrZWRTZXQuZGVjb3JhdGUobmV3IElkZW50aXR5TWFwKCkpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIHVubW9kaWZpYWJs\nZSBzZXQgb2YgaW5zdGFuY2VzIGJlaW5nIG9wZXJhdGVkLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU2V0PE9iamVjdD4gZ2V0T3BlcmF0aW5nU2V0KCkgewog\nICAgCXJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVTZXQoX29wZXJh\ndGluZyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBjbG9uZSgpCiAgICAg\nICAgdGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoX2luaXRpYWxpemVXYXNJbnZva2VkKQogICAgICAgICAgICB0aHJv\ndyBuZXcgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEge0BsaW5rIE1h\ncH0gdG8gYmUgdXNlZCBmb3IgdGhlIHByaW1hcnkgbWFuYWdlZCBvYmplY3Qg\nY2FjaGUuCiAgICAgKiBNYXBzIG9pZHMgdG8gc3RhdGUgbWFuYWdlcnMuIEJ5\nIGRlZmF1bHQsIHRoaXMgY3JlYXRlcyBhCiAgICAgKiB7QGxpbmsgUmVmZXJl\nbmNlTWFwfSB3aXRoIHNvZnQgdmFsdWVzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgTWFwPD8sPz4gbmV3TWFuYWdlZE9iamVjdENhY2hlKCkgewogICAgICAg\nIHJldHVybiBuZXcgUmVmZXJlbmNlSGFzaE1hcChSZWZlcmVuY2VNYXAuSEFS\nRCwgUmVmZXJlbmNlTWFwLlNPRlQpOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9u\nIG9mIFN0b3JlQ29udGV4dAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBCcm9rZXIgZ2V0QnJva2VyKCkgewog\nICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBQcm9wZXJ0aWVzCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyB2b2lkIHNldEltcGxpY2l0QmVoYXZpb3IoT3BDYWxsYmFja3MgY2Fs\nbCwKICAgICAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciBleCkgewog\nICAgICAgIGlmIChfY2FsbCA9PSBudWxsKQogICAgICAgICAgICBfY2FsbCA9\nIGNhbGw7CiAgICAgICAgaWYgKF9leHRyYW5zID09IG51bGwpCiAgICAgICAg\nICAgIF9leHRyYW5zID0gZXg7CiAgICB9CgogICAgUnVudGltZUV4Y2VwdGlv\nblRyYW5zbGF0b3IgZ2V0SW5zdGFuY2VFeGNlcHRpb25UcmFuc2xhdG9yKCkg\newogICAgICAgIHJldHVybiAoX29wZXJhdGlvbkNvdW50ID09IDApID8gX2V4\ndHJhbnMgOiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5\nIGdldEJyb2tlckZhY3RvcnkoKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5\nOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0K\nCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIGdldEZldGNoQ29uZmln\ndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1\nYmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gcHVzaEZldGNoQ29uZmlndXJhdGlv\nbigpIHsKICAgICAgICBpZiAoX2ZjcyA9PSBudWxsKQogICAgICAgICAgICBf\nZmNzID0gbmV3IExpbmtlZExpc3Q8RmV0Y2hDb25maWd1cmF0aW9uPigpOwog\nICAgICAgIF9mY3MuYWRkKF9mYyk7CiAgICAgICAgX2ZjID0gKEZldGNoQ29u\nZmlndXJhdGlvbikgX2ZjLmNsb25lKCk7CiAgICAgICAgcmV0dXJuIF9mYzsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwb3BGZXRjaENvbmZpZ3VyYXRpb24o\nKSB7CiAgICAgICAgaWYgKF9mY3MgPT0gbnVsbCB8fCBfZmNzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oCiAgICAg\nICAgICAgICAgICAgICAgX2xvYy5nZXQoImZldGNoLWNvbmZpZ3VyYXRpb24t\nc3RhY2stZW1wdHkiKSk7CiAgICAgICAgX2ZjID0gX2Zjcy5yZW1vdmVMYXN0\nKCk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb25uZWN0aW9uUmV0YWlu\nTW9kZSgpIHsKICAgICAgICByZXR1cm4gX2Nvbm5SZXRhaW5Nb2RlOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTWFuYWdlZCgpIHsKICAgICAgICBy\nZXR1cm4gX21hbmFnZWQ7CiAgICB9CgogICAgcHVibGljIE1hbmFnZWRSdW50\naW1lIGdldE1hbmFnZWRSdW50aW1lKCkgewogICAgICAgIHJldHVybiBfcnVu\ndGltZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0Q2xhc3NM\nb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAgICB9CgogICAg\ncHVibGljIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIgZ2V0U3RvcmVNYW5hZ2Vy\nKCkgewogICAgICAgIHJldHVybiBfc3RvcmU7CiAgICB9CgogICAgcHVibGlj\nIExvY2tNYW5hZ2VyIGdldExvY2tNYW5hZ2VyKCkgewogICAgICAgIHJldHVy\nbiBfbG07CiAgICB9CgogICAgcHVibGljIEludmVyc2VNYW5hZ2VyIGdldElu\ndmVyc2VNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfaW07CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uVXNlck5hbWUoKSB7CiAg\nICAgICAgcmV0dXJuIF91c2VyOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0Q29ubmVjdGlvblBhc3N3b3JkKCkgewogICAgICAgIHJldHVybiBfcGFz\nczsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNdWx0aXRocmVhZGVk\nKCkgewogICAgICAgIHJldHVybiBfbXVsdGl0aHJlYWRlZDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRNdWx0aXRocmVhZGVkKGJvb2xlYW4gbXVsdGl0\naHJlYWRlZCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfbXVs\ndGl0aHJlYWRlZCA9IG11bHRpdGhyZWFkZWQ7CiAgICAgICAgaWYgKG11bHRp\ndGhyZWFkZWQgJiYgX2xvY2sgPT0gbnVsbCkKICAgICAgICAgICAgX2xvY2sg\nPSBuZXcgUmVlbnRyYW50TG9jaygpOwogICAgICAgIGVsc2UgaWYgKCFtdWx0\naXRocmVhZGVkKQogICAgICAgICAgICBfbG9jayA9IG51bGw7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygpIHsKICAgICAg\nICByZXR1cm4gX2lnbm9yZUNoYW5nZXM7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0SWdub3JlQ2hhbmdlcyhib29sZWFuIHZhbCkgewogICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICBfaWdub3JlQ2hhbmdlcyA9IHZhbDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFsUmVh\nZCgpIHsKICAgICAgICByZXR1cm4gX25vbnRyYW5zUmVhZDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsUmVhZChib29sZWFu\nIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlsbGVnYWwtb3AtaW4t\ncHJlc3RvcmUiKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGlt\nZSBzdXBwb3J0cyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBv\ncnRlZE9wdGlvbnMoKS5jb250YWlucwogICAgICAgICAgICAoT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uT1BUSU9OX05PTlRSQU5TX1JFQUQpKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAg\nICAgICAgICAgICAgICgibm9udHJhbnMtcmVhZC1ub3Qtc3VwcG9ydGVkIikp\nOwoKICAgICAgICBfbm9udHJhbnNSZWFkID0gdmFsOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpIHsKICAg\nICAgICByZXR1cm4gX25vbnRyYW5zV3JpdGU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRlKGJvb2xlYW4gdmFsKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19QUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9y\nZSIpKTsKCiAgICAgICAgX25vbnRyYW5zV3JpdGUgPSB2YWw7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gZ2V0T3B0aW1pc3RpYygpIHsKICAgICAgICBy\nZXR1cm4gX29wdGltaXN0aWM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nT3B0aW1pc3RpYyhib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJ0cmFucy1hY3RpdmUiLAogICAgICAgICAgICAgICAgIk9wdGlt\naXN0aWMiKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBz\ndXBwb3J0cyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRl\nZE9wdGlvbnMoKS5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJ\nT05fT1BUSU1JU1RJQykpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJvcHRp\nbWlzdGljLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgIF9vcHRpbWlzdGlj\nID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0UmVzdG9yZVN0YXRl\nKCkgewogICAgICAgIHJldHVybiBfcmVzdG9yZVN0YXRlOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFJlc3RvcmVTdGF0ZShpbnQgdmFsKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2ZSIsCiAgICAgICAg\nICAgICAgICAiUmVzdG9yZSIpKTsKCiAgICAgICAgX3Jlc3RvcmVTdGF0ZSA9\nIHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXRhaW5TdGF0\nZSgpIHsKICAgICAgICByZXR1cm4gX3JldGFpblN0YXRlOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFJldGFpblN0YXRlKGJvb2xlYW4gdmFsKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19QUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIp\nKTsKICAgICAgICBfcmV0YWluU3RhdGUgPSB2YWw7CiAgICB9CgogICAgcHVi\nbGljIGludCBnZXRBdXRvQ2xlYXIoKSB7CiAgICAgICAgcmV0dXJuIF9hdXRv\nQ2xlYXI7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0NsZWFyKGlu\ndCB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2F1dG9D\nbGVhciA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEF1dG9EZXRh\nY2goKSB7CiAgICAgICAgcmV0dXJuIF9hdXRvRGV0YWNoOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldEF1dG9EZXRhY2goaW50IGRldGFjaEZsYWdzKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9hdXRvRGV0YWNoID0g\nZGV0YWNoRmxhZ3M7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0Rl\ndGFjaChpbnQgZGV0YWNoRmxhZywgYm9vbGVhbiBvbikgewogICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICBpZiAob24pCiAgICAgICAgICAgIF9hdXRv\nRGV0YWNoIHw9IGRldGFjaEZsYWc7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfYXV0b0RldGFjaCAmPSB+ZGV0YWNoRmxhZzsKICAgIH0KCiAgICBwdWJs\naWMgaW50IGdldERldGFjaFN0YXRlKCkgewogICAgICAgIHJldHVybiBfZGV0\nYWNoU3RhdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoU3Rh\ndGUoaW50IG1vZGUpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nX2RldGFjaFN0YXRlID0gbW9kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0RldGFjaGVkTmV3KCkgewogICAgICAgIHJldHVybiBfZGV0YWNoZWRO\nZXc7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoZWROZXcoYm9v\nbGVhbiBpc05ldykgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBf\nZGV0YWNoZWROZXcgPSBpc05ldzsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRTeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoKSB7CiAgICAgICAg\ncmV0dXJuIF9zeW5jTWFuYWdlZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRTeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoYm9vbGVhbiBzeW5jKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5jTWFuYWdlZCA9\nIHN5bmM7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0RXZpY3RGcm9t\nRGF0YUNhY2hlKCkgewogICAgICAgIHJldHVybiBfZXZpY3REYXRhQ2FjaGU7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RXZpY3RGcm9tRGF0YUNhY2hl\nKGJvb2xlYW4gZXZpY3QpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgX2V2aWN0RGF0YUNhY2hlID0gZXZpY3Q7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSB7CiAgICAgICAgcmV0\ndXJuIF9wb3B1bGF0ZURhdGFDYWNoZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRQb3B1bGF0ZURhdGFDYWNoZShib29sZWFuIGNhY2hlKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9wb3B1bGF0ZURhdGFDYWNoZSA9\nIGNhY2hlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVHJhY2tDaGFu\nZ2VzQnlUeXBlKCkgewogICAgICAgIHJldHVybiBfbGFyZ2VUcmFuc2FjdGlv\nbjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUcmFja0NoYW5nZXNCeVR5\ncGUoYm9vbGVhbiBsYXJnZVRyYW5zYWN0aW9uKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIF9sYXJnZVRyYW5zYWN0aW9uID0gbGFyZ2VUcmFu\nc2FjdGlvbjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFVzZXJPYmpl\nY3QoT2JqZWN0IGtleSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF91c2VyT2Jq\nZWN0cyA9PSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgcHV0VXNl\nck9iamVjdChPYmplY3Qga2V5LCBPYmplY3QgdmFsKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAoX3Vz\nZXJPYmplY3RzID09IG51bGwpID8gbnVsbCA6IF91c2VyT2JqZWN0cy5yZW1v\ndmUoa2V5KTsKCiAgICAgICAgICAgIGlmIChfdXNlck9iamVjdHMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF91c2VyT2JqZWN0cyA9IG5ldyBIYXNoTWFw\nPE9iamVjdCwgT2JqZWN0PigpOwogICAgICAgICAgICByZXR1cm4gX3VzZXJP\nYmplY3RzLnB1dChrZXksIHZhbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogR2V0IGN1cnJlbnQgY29uZmlndXJhdGlvbiBwcm9wZXJ0\neSB2YWx1ZXMgdXNlZCBieSB0aGlzIGluc3RhbmNlLgogICAgICogVGhpcyB2\nYWx1ZXMgYXJlIGNvbWJpbmF0aW9uIG9mIHRoZSBjdXJyZW50IGNvbmZpZ3Vy\nYXRpb24gdmFsdWVzIAogICAgICogb3ZlcndyaXR0ZW4gYnkgdmFsdWVzIG1h\naW50YWluZWQgYnkgdGhpcyBpbnN0YW5jZSBzdWNoIGFzCiAgICAgKiBPcHRp\nbWlzdGljIGZsYWcuIAogICAgICovCiAgICBwdWJsaWMgTWFwPFN0cmluZywg\nT2JqZWN0PiBnZXRQcm9wZXJ0aWVzKCkgewogICAgICAgIE1hcDxTdHJpbmcs\nIE9iamVjdD4gcHJvcHMgPSBfY29uZi50b1Byb3BlcnRpZXModHJ1ZSk7CiAg\nICAgICAgZm9yIChTdHJpbmcgcyA6IF9zdXBwb3J0ZWRQcm9wZXJ0eU5hbWVz\nKSB7CiAgICAgICAgICAgIHByb3BzLnB1dCgib3BlbmpwYS4iICsgcywgUmVm\nbGVjdGlvbi5nZXRWYWx1ZSh0aGlzLCBzLCB0cnVlKSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBwcm9wczsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBHZXRzIHRoZSBwcm9wZXJ0eSBuYW1lcyB0aGF0IGNhbiBiZSB1c2VkIHRv\nIGNvcnJlc3BvbmRpbmcgc2V0dGVyIG1ldGhvZHMgb2YgdGhpcyByZWNlaXZl\ncgogICAgICogdG8gc2V0IGl0cyB2YWx1ZS4KICAgICAqLyAgICAKICAgIHB1\nYmxpYyBTZXQ8U3RyaW5nPiBnZXRTdXBwb3J0ZWRQcm9wZXJ0aWVzKCkgewog\nICAgICAgIFNldDxTdHJpbmc+IGtleXMgPSBfY29uZi5nZXRQcm9wZXJ0eUtl\neXMoKTsKICAgICAgICBmb3IgKFN0cmluZyBzIDogX3N1cHBvcnRlZFByb3Bl\ncnR5TmFtZXMpCiAgICAgICAgICAgIGtleXMuYWRkKCJvcGVuanBhLiIgKyBz\nKTsKICAgICAgICByZXR1cm4ga2V5czsKICAgIH0KCiAgICAvLyAvLy8vLy8v\nLwogICAgLy8gRXZlbnRzCiAgICAvLyAvLy8vLy8vLwoKICAgIHB1YmxpYyB2\nb2lkIGFkZExpZmVjeWNsZUxpc3RlbmVyKE9iamVjdCBsaXN0ZW5lciwgQ2xh\nc3NbXSBjbGFzc2VzKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2Up\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9saWZlRXZlbnRNYW5hZ2Vy\nLmFkZExpc3RlbmVyKGxpc3RlbmVyLCBjbGFzc2VzKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlTGlmZWN5Y2xlTGlzdGVu\nZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9saWZlRXZlbnRN\nYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGludCBnZXRMaWZlY3ljbGVMaXN0ZW5lckNh\nbGxiYWNrTW9kZSgpIHsKICAgICAgICByZXR1cm4gX2xpZmVDYWxsYmFja01v\nZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TGlmZWN5Y2xlTGlzdGVu\nZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2xpZmVD\nYWxsYmFja01vZGUgPSBtb2RlOwogICAgICAgICAgICBfbGlmZUV2ZW50TWFu\nYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENBTExCQUNLX0ZBSUxfRkFTVCkg\nIT0gMCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2l2\nZSBzdGF0ZSBtYW5hZ2VycyBhY2Nlc3MgdG8gdGhlIGxpZmVjeWNsZSBldmVu\ndCBtYW5hZ2VyLgogICAgICovCiAgICBwdWJsaWMgTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyIGdldExpZmVjeWNsZUV2ZW50TWFuYWdlcigpIHsKICAgICAgICBy\nZXR1cm4gX2xpZmVFdmVudE1hbmFnZXI7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGaXJlIGdpdmVuIGxpZmVjeWNsZSBldmVudCwgaGFuZGxpbmcgYW55IGV4\nY2VwdGlvbnMgYXBwcm9wcmlhdGVseS4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHdoZXRoZXIgZXZlbnRzIGFyZSBiZWluZyBwcm9jZXNzZWQgYXQgdGhpcyB0\naW1lCiAgICAgKi8KICAgIGJvb2xlYW4gZmlyZUxpZmVjeWNsZUV2ZW50KE9i\namVjdCBzcmMsIE9iamVjdCByZWxhdGVkLCBDbGFzc01ldGFEYXRhIG1ldGEs\nCiAgICAgICAgaW50IGV2ZW50VHlwZSkgewogICAgICAgIGlmIChfbGlmZUV2\nZW50TWFuYWdlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIGxvY2soKTsKICAgICAgICBFeGNlcHRpb25bXSBleHM7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgZXhzID0gX2xpZmVFdmVudE1hbmFn\nZXIuZmlyZUV2ZW50KHNyYywgcmVsYXRlZCwgbWV0YSwgZXZlbnRUeXBlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9IAogICAgICAgIGhhbmRsZUNhbGxiYWNrRXhjZXB0aW9ucyhleHMs\nIF9saWZlQ2FsbGJhY2tNb2RlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRha2UgYWN0aW9ucyBvbiBjYWxsYmFjayBl\neGNlcHRpb25zIGRlcGVuZGluZyBvbiBjYWxsYmFjayBtb2RlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKEV4\nY2VwdGlvbltdIGV4Y2VwcywgaW50IG1vZGUpIHsKICAgICAgICBpZiAoZXhj\nZXBzLmxlbmd0aCA9PSAwIHx8IChtb2RlICYgQ0FMTEJBQ0tfSUdOT1JFKSAh\nPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE9wZW5KUEFFeGNl\ncHRpb24gY2U7CiAgICAgICAgaWYgKGV4Y2Vwcy5sZW5ndGggPT0gMSkgewog\nICAgICAgICAgICAvLyBJZiB0aGUgZXhjZXB0aW9uIGlzIGFscmVhZHkgYSB3\ncmFwcGVkIGV4Y2VwdGlvbiB0aHJvdyB0aGUgCiAgICAgICAgICAgIC8vIGV4\nY2VwdGlvbiBpbnN0ZWFkIG9mIHdyYXBwaW5nIGl0IHdpdGggYSBjYWxsYmFj\nayBleGNlcHRpb24KICAgICAgICAgICAgaWYgKGV4Y2Vwc1swXSBpbnN0YW5j\nZW9mIFdyYXBwZWRFeGNlcHRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyAo\nV3JhcHBlZEV4Y2VwdGlvbilleGNlcHNbMF07CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIGNlID0gbmV3IENhbGxiYWNrRXhjZXB0aW9uKGV4\nY2Vwc1swXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2UgPSBu\nZXcgQ2FsbGJhY2tFeGNlcHRpb24oX2xvYy5nZXQoImNhbGxiYWNrLWVyciIp\nKS4KICAgICAgICAgICAgICAgIHNldE5lc3RlZFRocm93YWJsZXMoZXhjZXBz\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUk9M\nTEJBQ0spICE9IDAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7\nCiAgICAgICAgICAgIGNlLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBz\nZXRSb2xsYmFja09ubHlJbnRlcm5hbChjZSk7CiAgICAgICAgfQogICAgICAg\nIGlmICgobW9kZSAmIENBTExCQUNLX0xPRykgIT0gMCAmJiBfbG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy53YXJuKGNlKTsKICAgICAg\nICBpZiAoKG1vZGUgJiBDQUxMQkFDS19SRVRIUk9XKSAhPSAwKQogICAgICAg\nICAgICB0aHJvdyBjZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRUcmFu\nc2FjdGlvbkxpc3RlbmVyKE9iamVjdCB0bCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfdHJh\nbnNFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIodGwpOwogICAgICAgICAgICBp\nZiAodGwgaW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1hbmFnZXIpCiAg\nICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRU1PVEVfTElTVEVORVI7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZVRy\nYW5zYWN0aW9uTGlzdGVuZXIoT2JqZWN0IHRsKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfdHJhbnNFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIodGwpCiAgICAg\nICAgICAgICAgICAmJiAodGwgaW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVu\ndE1hbmFnZXIpKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JF\nTU9URV9MSVNURU5FUjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1\nYmxpYyBDb2xsZWN0aW9uPE9iamVjdD4gZ2V0VHJhbnNhY3Rpb25MaXN0ZW5l\ncnMoKSB7CiAgICAgICAgcmV0dXJuIF90cmFuc0V2ZW50TWFuYWdlci5nZXRM\naXN0ZW5lcnMoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFRyYW5zYWN0\naW9uTGlzdGVuZXJDYWxsYmFja01vZGUoKSB7CiAgICAgICAgcmV0dXJuIF90\ncmFuc0NhbGxiYWNrTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRU\ncmFuc2FjdGlvbkxpc3RlbmVyQ2FsbGJhY2tNb2RlKGludCBtb2RlKSB7CiAg\nICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIF90cmFuc0NhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAgICAg\nICAgIF90cmFuc0V2ZW50TWFuYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENB\nTExCQUNLX0ZBSUxfRkFTVCkgIT0gMCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogRmlyZSBnaXZlbiB0cmFuc2FjdGlvbiBldmVudCwg\naGFuZGxpbmcgYW55IGV4Y2VwdGlvbnMgYXBwcm9wcmlhdGVseS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGZpcmVUcmFuc2FjdGlvbkV2ZW50KFRyYW5z\nYWN0aW9uRXZlbnQgdHJhbnMpIHsKICAgICAgICBpZiAoX3RyYW5zRXZlbnRN\nYW5hZ2VyICE9IG51bGwpCiAgICAgICAgICAgIGhhbmRsZUNhbGxiYWNrRXhj\nZXB0aW9ucyhfdHJhbnNFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHRyYW5zKSwK\nICAgICAgICAgICAgICAgIF90cmFuc0NhbGxiYWNrTW9kZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgd2hldGhlciB0aGlzIEJyb2tlciB3aWxsIGdl\nbmVyYXRlIHZlcmJvc2Ugb3B0aW1pc3RpYyBsb2NrIGV4Y2VwdGlvbnMgd2hl\nbiBiYXRjaGluZwogICAgICogb3BlcmF0aW9ucy4gRGVmYXVsdHMgdG8gdHJ1\nZS4KICAgICAqIAogICAgICogQHBhcmFtIGIKICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0U3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmcoYm9vbGVhbiBiKSB7\nCiAgICAgICAgX3N1cHByZXNzQmF0Y2hPTEVMb2dnaW5nID0gYjsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGlzIEJyb2tl\nciB3aWxsIGdlbmVyYXRlIHZlcmJvc2Ugb3B0aW1pc3RpYyBsb2NrIGV4Y2Vw\ndGlvbnMgd2hlbiBiYXRjaGluZwogICAgICogb3BlcmF0aW9ucy4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gZ2V0U3VwcHJlc3NCYXRjaE9MRUxvZ2dp\nbmcoKSB7CiAgICAgICAgcmV0dXJuIF9zdXBwcmVzc0JhdGNoT0xFTG9nZ2lu\nZzsKICAgIH0KICAgIC8vLy8vLy8vLy8vCiAgICAvLyBMb29rdXBzCiAgICAv\nLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qgb2lk\nLCBib29sZWFuIHZhbGlkYXRlLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBpbnQgZmxhZ3MgPSBPSURfQ09QWSB8IE9JRF9BTExPV19ORVcgfCBP\nSURfTk9ERUxFVEVEOwogICAgICAgIGlmICghdmFsaWRhdGUpCiAgICAgICAg\nICAgIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOwogICAgICAgIHJldHVybiBm\naW5kKG9pZCwgX2ZjLCBudWxsLCBudWxsLCBmbGFncywgY2FsbCk7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgQml0U2V0IGV4Y2x1ZGUsCiAgICAgICAgT2Jq\nZWN0IGVkYXRhLCBpbnQgZmxhZ3MpIHsKICAgICAgICByZXR1cm4gZmluZChv\naWQsIGZldGNoLCBleGNsdWRlLCBlZGF0YSwgZmxhZ3MsIG51bGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZmluZGVyLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgT2JqZWN0IGZpbmQoT2JqZWN0IG9pZCwgRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBCaXRTZXQgZXhjbHVkZSwKICAgICAgICBPYmpl\nY3QgZWRhdGEsIGludCBmbGFncywgRmluZENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IHRo\naXM7CiAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQob2lkKTsK\nICAgICAgICBpZiAob2lkID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKChm\nbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAwKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\ndWxsLW9pZCIpKTsKICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1Jl\ndHVybihvaWQsIG51bGwpOwogICAgICAgIH0KICAgICAgICBpZiAoZmV0Y2gg\nPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfZmM7CgogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAv\nLyBjYWNoZWQgaW5zdGFuY2U/CiAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsCiAgICAgICAg\nICAgICAgICAoZmxhZ3MgJiBPSURfQUxMT1dfTkVXKSAhPSAwIHx8IGhhc0Zs\ndXNoZWQoKSk7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIXJlcXVpcmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gs\nIGVkYXRhLCBmbGFncykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNh\nbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKCiAgICAgICAgICAgICAgICBp\nZiAoIXNtLmlzTG9hZGluZygpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIGFsbCB0aGUgY29uZmlndXJlZCBmaWVsZHMgYXJlIGxvYWRl\nZDsgZG8gdGhpcwogICAgICAgICAgICAgICAgICAgIC8vIGFmdGVyIG1ha2lu\nZyBpbnN0YW5jZSB0cmFuc2FjdGlvbmFsIGZvciBsb2NraW5nCiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB1c2VU\ncmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQogICAgICAgICAgICAgICAgICAg\nICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICAgICAg\nYm9vbGVhbiBsb2FkZWQ7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gc20ubG9hZChmZXRjaCwg\nU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBleGNsdWRlLCBlZGF0YSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9u\nZmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9J\nRF9OT0RFTEVURUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\nLy8gaWYgbm8gZGF0YSBuZWVkZWQgdG8gYmUgbG9hZGVkIGFuZCB0aGUgdXNl\nciB3YW50cyB0bwogICAgICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRlLCBq\ndXN0IG1ha2Ugc3VyZSB0aGUgb2JqZWN0IGV4aXN0cwogICAgICAgICAgICAg\nICAgICAgIGlmICghbG9hZGVkICYmIChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSA9PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICYmIF9jb21wYXQuZ2V0\nVmFsaWRhdGVUcnVlQ2hlY2tzU3RvcmUoKQogICAgICAgICAgICAgICAgICAg\nICAgICAmJiAhc20uaXNUcmFuc2FjdGlvbmFsKCkKICAgICAgICAgICAgICAg\nICAgICAgICAgJiYgIV9zdG9yZS5leGlzdHMoc20sIGVkYXRhKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRF\nRCkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBj\nYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoImRlbC1pbnN0\nYW5jZSIsIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBvaWQpKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBv\nYmplY3Qgd2FzIGNhY2hlZCwgd2UgbWF5IG5lZWQgdG8gdXBncmFkZSBsb2Nr\nCiAgICAgICAgICAgICAgICAvLyBpZiBjdXJyZW50IGxldmVsIGlzIGhpZ2hl\nciB0aGFuIGxldmVsIG9mIGluaXRpYWwgbG9hZAogICAgICAgICAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAg\nICAgICAgICAgIGludCBsZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwo\nKTsKICAgICAgICAgICAgICAgICAgICBfbG0ubG9jayhzbSwgbGV2ZWwsIGZl\ndGNoLmdldExvY2tUaW1lb3V0KCksIGVkYXRhKTsKICAgICAgICAgICAgICAg\nICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBmZXRjaC5nZXRXcml0ZUxvY2tM\nZXZlbCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3Mgbm8gY2FjaGVkIHNtIGZv\nciBhIG5ldy90cmFuc2llbnQgaWQgdHlwZSwgd2UKICAgICAgICAgICAgLy8g\naXQgZGVmaW5pdGVseSBkb2Vzbid0IGV4aXN0CiAgICAgICAgICAgIGlmIChv\naWQgaW5zdGFuY2VvZiBTdGF0ZU1hbmFnZXJJZCkKICAgICAgICAgICAgICAg\nIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKCiAgICAg\nICAgICAgIC8vIGluaXRpYWxpemUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3Ig\ndGhlIGRhdGFzdG9yZSBpbnN0YW5jZQogICAgICAgICAgICBzbSA9IG5ld1N0\nYXRlTWFuYWdlckltcGwob2lkLCAoZmxhZ3MgJiBPSURfQ09QWSkgIT0gMCk7\nCiAgICAgICAgICAgIGJvb2xlYW4gbG9hZCA9IHJlcXVpcmVzTG9hZChzbSwg\nZmFsc2UsIGZldGNoLCBlZGF0YSwgZmxhZ3MpOwogICAgICAgICAgICBzbSA9\nIGluaXRpYWxpemUoc20sIGxvYWQsIGZldGNoLCBlZGF0YSk7CiAgICAgICAg\nICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZs\nYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKG9pZCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwg\nbnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3Vy\nZSBhbGwgY29uZmlndXJlZCBmaWVsZHMgd2VyZSBsb2FkZWQKICAgICAgICAg\nICAgaWYgKGxvYWQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2VySW1wbC5M\nT0FEX0ZHUywgZXhjbHVkZSwKICAgICAgICAgICAgICAgICAgICAgICAgZWRh\ndGEsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAgICAgICAg\nICAgICAgICAgICB8fCAoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkK\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVs\nbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluaXRp\nYWxpemUgYSBuZXdseS1jb25zdHJ1Y3RlZCBzdGF0ZSBtYW5hZ2VyLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBpbml0aWFsaXpl\nKFN0YXRlTWFuYWdlckltcGwgc20sIGJvb2xlYW4gbG9hZCwKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAg\nICAgIGlmICghbG9hZCkgewogICAgICAgICAgICBzbS5pbml0aWFsaXplKHNt\nLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAg\nICAgICAgUENTdGF0ZS5IT0xMT1cpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIFBDU3RhdGUgc3RhdGUgPSAodXNlVHJhbnNhY3Rpb25hbFN0YXRl\nKGZldGNoKSkKICAgICAgICAgICAgICAgID8gUENTdGF0ZS5QQ0xFQU4gOiBQ\nQ1N0YXRlLlBOT05UUkFOUzsKICAgICAgICAgICAgc20uc2V0TG9hZGluZyh0\ncnVlKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgh\nX3N0b3JlLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgc20uc2V0TG9hZGluZyhmYWxz\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNt\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rp\nb24gb2lkcywgYm9vbGVhbiB2YWxpZGF0ZSwKICAgICAgICBGaW5kQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpbnQgZmxhZ3MgPSBPSURfQ09QWSB8IE9J\nRF9BTExPV19ORVcgfCBPSURfTk9ERUxFVEVEOwogICAgICAgIGlmICghdmFs\naWRhdGUpCiAgICAgICAgICAgIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOwog\nICAgICAgIHJldHVybiBmaW5kQWxsKG9pZHMsIF9mYywgbnVsbCwgbnVsbCwg\nZmxhZ3MsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBmaW5k\nQWxsKENvbGxlY3Rpb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBm\nbGFncykgewogICAgICAgIHJldHVybiBmaW5kQWxsKG9pZHMsIGZldGNoLCBl\neGNsdWRlLCBlZGF0YSwgZmxhZ3MsIG51bGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgZmluZGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nT2JqZWN0W10gZmluZEFsbChDb2xsZWN0aW9uIG9pZHMsIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0\nIGVkYXRhLCBpbnQgZmxhZ3MsIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGZpbmRBbGxEZXB0aCArKzsKCiAgICAgICAgLy8gdGhyb3cgYW55IGV4\nY2VwdGlvbnMgZm9yIG51bGwgb2lkcyB1cCBpbW1lZGlhdGVseQogICAgICAg\nIGlmIChvaWRzID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxs\nUG9pbnRlckV4Y2VwdGlvbigib2lkcyA9PSBudWxsIik7CiAgICAgICAgaWYg\nKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwICYmIG9pZHMuY29udGFp\nbnMobnVsbCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJudWxsLW9pZHMiKSk7CgogICAgICAgIC8vIHdlIGhhdmUg\ndG8gdXNlIGEgbWFwIG9mIG9pZC0+c20gcmF0aGVyIHRoYW4gYSBzaW1wbGUK\nICAgICAgICAvLyBhcnJheSwgc28gdGhhdCB3ZSBtYWtlIHN1cmUgbm90IHRv\nIGNyZWF0ZSBtdWx0aXBsZSBzbXMgZm9yIGVxdWl2YWxlbnQKICAgICAgICAv\nLyBvaWRzIGlmIHRoZSB1c2VyIGhhcyBkdXBsaWNhdGVzIGluIHRoZSBnaXZl\nbiBhcnJheQogICAgICAgIGlmIChfbG9hZGluZyA9PSBudWxsKQogICAgICAg\nICAgICBfbG9hZGluZyA9IG5ldyBIYXNoTWFwPE9iamVjdCwgU3RhdGVNYW5h\nZ2VySW1wbD4oKGludCkgKG9pZHMuc2l6ZSgpICogMS4zMyArIDEpKTsKCiAg\nICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IHRo\naXM7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZl\ndGNoID0gX2ZjOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFs\nUmVhZCgpOwoKICAgICAgICAgICAgLy8gY29sbGVjdGlvbiBvZiBzdGF0ZSBt\nYW5hZ2VycyB0byBwYXNzIHRvIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAg\nTGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2VyPiBsb2FkID0gbnVsbDsKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgYm9vbGVh\nbiBpbml0aWFsaXplZDsKICAgICAgICAgICAgYm9vbGVhbiB0cmFuc1N0YXRl\nID0gdXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKTsKICAgICAgICAgICAg\nT2JqZWN0IG9iaiwgb2lkOwogICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBvaWRzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAv\nLyBpZiB3ZSd2ZSBhbHJlYWR5IHNlZW4gdGhpcyBvaWQsIHNraXAgcmVwZWF0\ncwogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIG9pZCA9IGNhbGwucHJvY2Vzc0FyZ3VtZW50KG9iaik7CiAgICAg\nICAgICAgICAgICBpZiAob2lkID09IG51bGwgfHwgX2xvYWRpbmcuY29udGFp\nbnNLZXkob2JqKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICAvLyBpZiB3ZSBkb24ndCBoYXZlIGEgY2FjaGVkIGlu\nc3RhbmNlIG9yIGl0IGlzIG5vdCB0cmFuc2FjdGlvbmFsCiAgICAgICAgICAg\nICAgICAvLyBhbmQgaXMgaG9sbG93IG9yIHdlIG5lZWQgdG8gdmFsaWRhdGUs\nIGxvYWQgaXQKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbEJ5SWQob2lkLCAoZmxhZ3MgJiBPSURfQUxMT1dfTkVXKSAhPSAwCiAg\nICAgICAgICAgICAgICAgICAgfHwgaGFzRmx1c2hlZCgpKTsKICAgICAgICAg\nICAgICAgIGluaXRpYWxpemVkID0gc20gIT0gbnVsbDsKICAgICAgICAgICAg\nICAgIGlmICghaW5pdGlhbGl6ZWQpCiAgICAgICAgICAgICAgICAgICAgc20g\nPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lEX0NPUFkp\nICE9IDApOwoKICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1dChvYmosIHNt\nKTsKICAgICAgICAgICAgICAgIGlmIChyZXF1aXJlc0xvYWQoc20sIGluaXRp\nYWxpemVkLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkgewogICAgICAgICAgICAg\nICAgICAgIHRyYW5zU3RhdGUgPSB0cmFuc1N0YXRlIHx8IHVzZVRyYW5zYWN0\naW9uYWxTdGF0ZShmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlu\naXRpYWxpemVkICYmICFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB0cmFuc1N0\nYXRlKQogICAgICAgICAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFs\nKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxpc3Q8T3Bl\nbkpQQVN0YXRlTWFuYWdlcj4ob2lkcy5zaXplKCkgLSBpZHgpOwogICAgICAg\nICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSBpZiAoIWluaXRpYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNt\nLmluaXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBl\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgIFBDU3RhdGUuSE9MTE9XKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGFzcyBhbGwgc3RhdGUg\nbWFuYWdlcnMgaW4gbmVlZCBvZiBsb2FkaW5nIG9yIHZhbGlkYXRpb24gdG8g\ndGhlCiAgICAgICAgICAgIC8vIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAg\naWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgUENTdGF0ZSBz\ndGF0ZSA9ICh0cmFuc1N0YXRlKSA/IFBDU3RhdGUuUENMRUFOCiAgICAgICAg\nICAgICAgICAgICAgOiBQQ1N0YXRlLlBOT05UUkFOUzsKICAgICAgICAgICAg\nICAgIENvbGxlY3Rpb248T2JqZWN0PiBmYWlsZWQgPSBfc3RvcmUubG9hZEFs\nbChsb2FkLCBzdGF0ZSwKICAgICAgICAgICAgICAgICAgICBTdG9yZU1hbmFn\nZXIuRk9SQ0VfTE9BRF9OT05FLCBmZXRjaCwgZWRhdGEpOwoKICAgICAgICAg\nICAgICAgIC8vIHNldCBmYWlsZWQgaW5zdGFuY2VzIHRvIG51bGwKICAgICAg\nICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURf\nTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkKTsKICAgICAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPE9iamVjdD4gaXRyID0gZmFp\nbGVkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgICAgICAgICBfbG9hZGluZy5wdXQoaXRyLm5leHQoKSwgbnVsbCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGNyZWF0ZSByZXN1bHRzIGFycmF5OyBtYWtlIHN1cmUgYWxsIGNvbmZpZ3Vy\nZWQgZmllbGRzIGFyZQogICAgICAgICAgICAvLyBsb2FkZWQgaW4gZWFjaCBp\nbnN0YW5jZQogICAgICAgICAgICBPYmplY3RbXSByZXN1bHRzID0gbmV3IE9i\namVjdFtvaWRzLnNpemUoKV07CiAgICAgICAgICAgIGJvb2xlYW4gYWN0aXZl\nID0gKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAgICAgICAgICBp\nbnQgbGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCk7CiAgICAgICAg\nICAgIGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRy\nID0gb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykgewog\nICAgICAgICAgICAgICAgb2lkID0gaXRyLm5leHQoKTsKICAgICAgICAgICAg\nICAgIHNtID0gX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBp\nZiAoc20gIT0gbnVsbCAmJiByZXF1aXJlc0xvYWQoc20sIHRydWUsIGZldGNo\nLCBlZGF0YSwgZmxhZ3MpKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVN\nYW5hZ2VySW1wbC5MT0FEX0ZHUywKICAgICAgICAgICAgICAgICAgICAgICAg\nCWV4Y2x1ZGUsIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChhY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9sbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwg\nZWRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20ucmVhZExv\nY2tlZChsZXZlbCwgZmV0Y2guZ2V0V3JpdGVMb2NrTGV2ZWwoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0\naW9uIG9uZmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFn\ncyAmIE9JRF9OT0RFTEVURUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAg\nICAgICAgICAgICAgICAgc20gPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdHNb\naWR4XSA9IGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGZpbmRBbGxEZXB0aC0t\nOwogICAgICAgICAgICBpZiAoZmluZEFsbERlcHRoID09IDApCiAgICAgICAg\nICAgICAgICBfbG9hZGluZyA9IG51bGw7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4g\naGFzRmx1c2hlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdf\nRkxVU0hFRCkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3\naGV0aGVyIHRoZSBnaXZlbiBpbnN0YW5jZSBuZWVkcyBsb2FkaW5nIGJlZm9y\nZSBiZWluZyByZXR1cm5lZAogICAgICogdG8gdGhlIHVzZXIuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiByZXF1aXJlc0xvYWQoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgYm9vbGVhbiBpbml0aWFsaXplZCwKICAgICAgICBGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdz\nKSB7CiAgICAgICAgaWYgKCFmZXRjaC5yZXF1aXJlc0xvYWQoKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICgoZmxhZ3MgJiBPSURf\nTk9WQUxJREFURSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgaWYgKGVkYXRhICE9IG51bGwpIC8vIHRha2UgYWR2YW50YWdlIG9m\nIGV4aXN0aW5nIHJlc3VsdAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICBpZiAoaW5pdGlhbGl6ZWQgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBD\nU3RhdGUuSE9MTE9XKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgaWYgKCFpbml0aWFsaXplZCAmJiBzbS5nZXRNZXRhRGF0YSgpLmdldFBD\nU3ViY2xhc3NlcygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIHJldHVybiAhX2NvbXBhdC5nZXRWYWxpZGF0ZUZhbHNl\nUmV0dXJuc0hvbGxvdygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHdoZXRoZXIgdG8gdXNlIGEgdHJhbnNhY3Rpb25hbCBzdGF0ZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwICYmICghX29wdGltaXN0aWMKICAg\nICAgICAgICAgfHwgX2F1dG9DbGVhciA9PSBDTEVBUl9BTEwKICAgICAgICAg\nICAgfHwgZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpICE9IExPQ0tfTk9ORSk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBmaW5kQ2FjaGVkKE9iamVjdCBv\naWQsIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsID09\nIG51bGwpCiAgICAgICAgICAgIGNhbGwgPSB0aGlzOwogICAgICAgIG9pZCA9\nIGNhbGwucHJvY2Vzc0FyZ3VtZW50KG9pZCk7CiAgICAgICAgaWYgKG9pZCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJu\nKG9pZCwgbnVsbCk7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsIHRydWUpOwogICAgICAg\nICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0T2JqZWN0\nSWRUeXBlKENsYXNzPD8+IGNscykgewogICAgICAgIGlmIChjbHMgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJ\nbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBf\nbG9hZGVyLCBmYWxzZSk7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwK\nICAgICAgICAgICAgICAgIHx8IG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0g\nQ2xhc3NNZXRhRGF0YS5JRF9VTktOT1dOKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlw\nZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAg\nICAgICAgICByZXR1cm4gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKCiAgICAg\nICAgICAgIHJldHVybiBfc3RvcmUuZ2V0RGF0YVN0b3JlSWRUeXBlKG1ldGEp\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgbmV3T2JqZWN0SWQoQ2xhc3M8Pz4gY2xzLCBPYmplY3QgdmFsKSB7\nCiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25m\nLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAg\nICAgICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIHRydWUpOwogICAgICAg\nICAgICBzd2l0Y2ggKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkpIHsKICAgICAg\nICAgICAgY2FzZSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRToKICAgICAg\nICAgICAgICAgIC8vIGRlbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIgZm9yIGRh\ndGFzdG9yZSBpZHMKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2Vv\nZiBTdHJpbmcKICAgICAgICAgICAgICAgICAgICAmJiAoKFN0cmluZykgdmFs\nKS5zdGFydHNXaXRoKFN0YXRlTWFuYWdlcklkLlNUUklOR19QUkVGSVgpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2VySWQo\nKFN0cmluZykgdmFsKTsKICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUu\nbmV3RGF0YVN0b3JlSWQodmFsLCBtZXRhKTsKICAgICAgICAgICAgY2FzZSBD\nbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OOgogICAgICAgICAgICAgICAg\naWYgKEltcGxIZWxwZXIuaXNBc3NpZ25hYmxlKG1ldGEuZ2V0T2JqZWN0SWRU\neXBlKCksIAogICAgICAgICAgICAgICAgICAgIHZhbC5nZXRDbGFzcygpKSkg\newogICAgICAgICAgICAgICAgICAgIGlmICghbWV0YS5pc09wZW5KUEFJZGVu\ndGl0eSgpIAogICAgICAgICAgICAgICAgICAgICAgICAmJiBtZXRhLmlzT2Jq\nZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgT2JqZWN0SWQoY2xzLCB2YWwpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB2YWw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgLy8gc3RyaW5naWZpZWQgYXBwIGlkPwogICAgICAgICAgICAgICAg\naWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZyAKICAgICAgICAgICAgICAgICAg\nICAmJiAhX2NvbmYuZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuCiAgICAg\nICAgICAgICAgICAgICAgICAgIGdldFN0cmljdElkZW50aXR5VmFsdWVzKCkK\nICAgICAgICAgICAgICAgICAgICAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChj\nbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBQQ1JlZ2lzdHJ5Lm5ld09iamVjdElkKGNscywgKFN0cmluZykgdmFsKTsK\nCiAgICAgICAgICAgICAgICBPYmplY3RbXSBhcnIgPSAodmFsIGluc3RhbmNl\nb2YgT2JqZWN0W10pID8gKE9iamVjdFtdKSB2YWwKICAgICAgICAgICAgICAg\nICAgICA6IG5ldyBPYmplY3RbXXsgdmFsIH07CiAgICAgICAgICAgICAgICBy\nZXR1cm4gQXBwbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKGFyciwgbWV0YSk7\nCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBj\nbHMpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbiBpYWUpIHsKICAgICAgICAJLy8gT1BFTkpQQS0z\nNjUKICAgICAgICAJdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1pZC12YWx1ZSIsIHZhbCwKICAgICAgICAgICAgICAgIHZhbC5nZXRD\nbGFzcygpLmdldE5hbWUoKSwgY2xzKSkuc2V0Q2F1c2UoaWFlKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKENsYXNzQ2FzdEV4Y2VwdGlv\nbiBjY2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1pZC12YWx1ZSIsIHZhbCwKICAgICAgICAgICAgICAg\nIHZhbC5nZXRDbGFzcygpLmdldE5hbWUoKSwgY2xzKSkuc2V0Q2F1c2UoY2Nl\nKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdGF0ZU1hbmFnZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwo\nT2JqZWN0IG9pZCwgYm9vbGVhbiBjb3B5KSB7CiAgICAgICAgLy8gc2VlIGlm\nIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIGxvYWRpbmcgdGhpcyBvaWQgaW4g\nYSBsb2FkQWxsIGNhbGwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgIGlmIChfbG9hZGluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIHNt\nID0gX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsICYmIHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfQoKICAgICAgICAv\nLyBmaW5kIG1ldGFkYXRhIGZvciB0aGUgb2lkCiAgICAgICAgQ2xhc3M8Pz4g\ncGNUeXBlID0gX3N0b3JlLmdldE1hbmFnZWRUeXBlKG9pZCk7CiAgICAgICAg\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYuZ2V0TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGE7CiAgICAgICAgaWYgKHBjVHlwZSAhPSBudWxsKQogICAgICAgICAgICBt\nZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEocGNUeXBlLCBfbG9hZGVyLCB0cnVl\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG1ldGEgPSByZXBvcy5nZXRN\nZXRhRGF0YShvaWQsIF9sb2FkZXIsIHRydWUpOwoKICAgICAgICAvLyBjb3B5\nIHRoZSBvaWQgaWYgbmVlZGVkCiAgICAgICAgaWYgKGNvcHkgJiYgX2NvbXBh\ndC5nZXRDb3B5T2JqZWN0SWRzKCkpIHsKICAgICAgICAgICAgaWYgKG1ldGEu\nZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNB\nVElPTikKICAgICAgICAgICAgICAgIG9pZCA9IEFwcGxpY2F0aW9uSWRzLmNv\ncHkob2lkLCBtZXRhKTsKICAgICAgICAgICAgZWxzZSBpZiAobWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgibWV0YS11bmtub3duaWQiLCBtZXRhKSk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIG9pZCA9IF9zdG9yZS5jb3B5RGF0YVN0b3JlSWQo\nb2lkLCBtZXRhKTsKICAgICAgICB9CgogICAgICAgIHNtID0gbmV3U3RhdGVN\nYW5hZ2VySW1wbChvaWQsIG1ldGEpOwogICAgICAgIHNtLnNldE9iamVjdElk\nKG9pZCk7CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIG9pZCBh\nbmQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFn\nZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9pZCwKICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gbmV3IFN0\nYXRlTWFuYWdlckltcGwob2lkLCBtZXRhLCB0aGlzKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8KICAgIC8vIFRyYW5zYWN0aW9uCiAgICAvLy8vLy8v\nLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYWN0aXZlIikpOwogICAgICAgICAgICBfZmFjdG9yeS5zeW5jV2l0aE1h\nbmFnZWRUcmFuc2FjdGlvbih0aGlzLCB0cnVlKTsKICAgICAgICAgICAgYmVn\naW5JbnRlcm5hbCgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIE5vdGlmeSB0aGUgc3RvcmUgbWFuYWdlciBvZiBhIHRyYW5zYWN0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVnaW5JbnRlcm5hbCgpIHsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBiZWdpblN0b3JlTWFuYWdlclRy\nYW5zYWN0aW9uKF9vcHRpbWlzdGljKTsKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfQUNUSVZFOwoKICAgICAgICAgICAgLy8gc3RhcnQgbG9ja2luZwog\nICAgICAgICAgICBpZiAoIV9vcHRpbWlzdGljKSB7CiAgICAgICAgICAgICAg\nICBfZmMuc2V0UmVhZExvY2tMZXZlbChfY29uZi5nZXRSZWFkTG9ja0xldmVs\nQ29uc3RhbnQoKSk7CiAgICAgICAgICAgICAgICBfZmMuc2V0V3JpdGVMb2Nr\nTGV2ZWwoX2NvbmYuZ2V0V3JpdGVMb2NrTGV2ZWxDb25zdGFudCgpKTsKICAg\nICAgICAgICAgICAgIF9mYy5zZXRMb2NrVGltZW91dChfY29uZi5nZXRMb2Nr\nVGltZW91dCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfbG0uYmVn\naW5UcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgaWYgKF90cmFuc0V2ZW50\nTWFuYWdlci5oYXNCZWdpbkxpc3RlbmVycygpKQogICAgICAgICAgICAgICAg\nZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhp\ncywKICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVS\nX0JFR0lOLCBudWxsLCBudWxsLCBudWxsLCBudWxsKSk7CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAvLyBp\nZiB3ZSBhbHJlYWR5IHN0YXJ0ZWQgdGhlIHRyYW5zYWN0aW9uLCBkb24ndCBs\nZXQgaXQgY29tbWl0CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJ\nbnRlcm5hbChrZSk7CiAgICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRy\ndWUpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgLy8gaWYgd2UgYWxyZWFkeSBzdGFydGVkIHRoZSB0cmFu\nc2FjdGlvbiwgZG9uJ3QgbGV0IGl0IGNvbW1pdAogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAg\nc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwocmUpOwogICAgICAgICAgICB0aHJv\ndyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpLnNldEZhdGFsKHRydWUpOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKF9wZW5kaW5nICE9IG51bGwpIHsKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdCA9IF9wZW5kaW5nLml0ZXJh\ndG9yKCk7IGl0Lmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0g\nKFN0YXRlTWFuYWdlckltcGwpIGl0Lm5leHQoKTsKICAgICAgICAgICAgICAg\nIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIGlmIChzbS5p\nc0RpcnR5KCkpCiAgICAgICAgICAgICAgICAgICAgc2V0RGlydHkoc20sIHRy\ndWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9wZW5kaW5nID0gbnVs\nbDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5TdG9y\nZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigp\nOwogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZF\nKSA9PSAwKQogICAgICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFu\nc2FjdGlvbihmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQmVnaW4gYSBzdG9yZSBtYW5hZ2VyIHRyYW5zYWN0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVnaW5TdG9yZU1hbmFn\nZXJUcmFuc2FjdGlvbihib29sZWFuIG9wdGltaXN0aWMpIHsKICAgICAgICBp\nZiAoIW9wdGltaXN0aWMpIHsKICAgICAgICAgICAgcmV0YWluQ29ubmVjdGlv\nbigpOwogICAgICAgICAgICBfc3RvcmUuYmVnaW4oKTsKICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfU1RPUkVfQUNUSVZFOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGlmIChfY29ublJldGFpbk1vZGUgPT0gQ09OTl9SRVRB\nSU5fVFJBTlMpCiAgICAgICAgICAgICAgICByZXRhaW5Db25uZWN0aW9uKCk7\nCiAgICAgICAgICAgIF9zdG9yZS5iZWdpbk9wdGltaXN0aWMoKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmQgdGhlIGN1cnJlbnQgc3Rv\ncmUgbWFuYWdlciB0cmFuc2FjdGlvbi4gVGhyb3dzIGFuCiAgICAgKiBleGNl\ncHRpb24gdG8gc2lnbmFsIGEgZm9yY2VkIHJvbGxiYWNrIGFmdGVyIGZhaWxl\nZCBjb21taXQsIG90aGVyd2lzZQogICAgICogcmV0dXJucyBhbnkgZXhjZXB0\naW9uIGVuY291bnRlcmVkIGR1cmluZyB0aGUgZW5kIHByb2Nlc3MuCiAgICAg\nKi8KICAgIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvbiBlbmRTdG9yZU1hbmFn\nZXJUcmFuc2FjdGlvbihib29sZWFuIHJvbGxiYWNrKSB7CiAgICAgICAgYm9v\nbGVhbiBmb3JjZWRSb2xsYmFjayA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4g\ncmVsZWFzZUNvbm4gPSBmYWxzZTsKICAgICAgICBSdW50aW1lRXhjZXB0aW9u\nIGVyciA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMCkgewogICAgICAgICAg\nICAgICAgcmVsZWFzZUNvbm4gPSBfY29ublJldGFpbk1vZGUgIT0gQ09OTl9S\nRVRBSU5fQUxXQVlTOwogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNrKQog\nICAgICAgICAgICAgICAgICAgIF9zdG9yZS5yb2xsYmFjaygpOwogICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIF9zdG9yZS5jb21t\naXQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJl\nbGVhc2VDb25uID0gX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX1RS\nQU5TOwogICAgICAgICAgICAgICAgX3N0b3JlLnJvbGxiYWNrT3B0aW1pc3Rp\nYygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlmICghcm9sbGJh\nY2spIHsKICAgICAgICAgICAgICAgIGZvcmNlZFJvbGxiYWNrID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgIHRyeSB7IF9zdG9yZS5yb2xsYmFjaygpOyB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlMikge30KICAgICAgICAgICAgfQog\nICAgICAgICAgICBlcnIgPSByZTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfU1RPUkVfQUNUSVZFOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKHJlbGVhc2VDb25uKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICByZWxlYXNlQ29ubmVjdGlvbigpOwogICAg\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZXJyID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgZXJyID0gcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIGlmIChmb3JjZWRSb2xsYmFjaykKICAgICAgICAgICAgdGhyb3cgZXJyOwog\nICAgICAgIHJldHVybiBlcnI7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29t\nbWl0KCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlv\nbigpOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rp\nb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNh\nY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAg\naWYgKHRyYW5zID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikp\nOwoKICAgICAgICAgICAgLy8gdGhpcyBjb21taXQgb24gdGhlIHRyYW5zYWN0\naW9uIHdpbGwgY2F1c2Ugb3VyCiAgICAgICAgICAgIC8vIGJlZm9yZUNvbXBs\nZXRpb24gbWV0aG9kIHRvIGJlIGludm9rZWQKICAgICAgICAgICAgdHJhbnMu\nY29tbWl0KCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5z\nLWVycm9yIiksIGtlKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKF9sb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2Uo\nX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBlKTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsKCiAgICAgICAgICAgIGph\ndmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAg\nICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRy\nYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdHJhbnMucm9sbGJhY2soKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChf\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVy\ncm9yIiksIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRp\nb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKCkgewogICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIV9tYW5h\nZ2VkKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgidHJhbnMtbm90LW1hbmFnZWQiKSk7CiAgICAg\nICAgICAgIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlv\nbih0aGlzLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIGJlZ2luSW50ZXJu\nYWwoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY29tbWl0QW5kUmVzdW1lKCkgewogICAgICAgIGVu\nZEFuZFJlc3VtZSh0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xs\nYmFja0FuZFJlc3VtZSgpIHsKICAgICAgICBlbmRBbmRSZXN1bWUoZmFsc2Up\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBlbmRBbmRSZXN1bWUoYm9vbGVh\nbiBjb21taXQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNvbW1pdCkKICAgICAgICAg\nICAgICAgIGNvbW1pdCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICByb2xsYmFjaygpOwogICAgICAgICAgICBiZWdpbigpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSb2xsYmFja09u\nbHkoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkg\nPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\nICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAg\nICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigp\nLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAg\nICByZXR1cm4gdHJhbnMuZ2V0U3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRVU19N\nQVJLRURfUk9MTEJBQ0s7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIFRocm93YWJsZSBnZXRSb2xsYmFja0NhdXNlKCkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0\naW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50\naW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7\nCiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmICh0cmFucy5nZXRTdGF0\ndXMoKSA9PSBTdGF0dXMuU1RBVFVTX01BUktFRF9ST0xMQkFDSykKICAgICAg\nICAgICAgICAgIHJldHVybiBfcnVudGltZS5nZXRSb2xsYmFja0NhdXNlKCk7\nCgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFja09ubHkoKSB7CiAgICAg\nICAgc2V0Um9sbGJhY2tPbmx5KG5ldyBVc2VyRXhjZXB0aW9uKCkpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFJvbGxiYWNrT25seShUaHJvd2FibGUg\nY2F1c2UpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlv\nbigpOwogICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChjYXVz\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0\naGUgY3VycmVudCB0cmFuc2FjdGlvbiBhcyByb2xsYmFjay1vbmx5LgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwo\nVGhyb3dhYmxlIGNhdXNlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\namF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAg\nICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0\nVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikpOwogICAgICAgICAgICAvLyBl\nbnN1cmUgdHJhbiBpcyBpbiBhIHZhbGlkIHN0YXRlIHRvIGFjY2VwdCB0aGUg\nc2V0Um9sbGJhY2tPbmx5CiAgICAgICAgICAgIGludCB0cmFuU3RhdHVzID0g\ndHJhbnMuZ2V0U3RhdHVzKCk7CiAgICAgICAgICAgIGlmICgodHJhblN0YXR1\ncyAhPSBTdGF0dXMuU1RBVFVTX05PX1RSQU5TQUNUSU9OKQogICAgICAgICAg\nICAgICAgICAgICYmICh0cmFuU3RhdHVzICE9IFN0YXR1cy5TVEFUVVNfUk9M\nTEVEQkFDSykKICAgICAgICAgICAgICAgICAgICAmJiAodHJhblN0YXR1cyAh\nPSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRCkpCiAgICAgICAgICAgICAgICBf\ncnVudGltZS5zZXRSb2xsYmFja09ubHkoY2F1c2UpOwogICAgICAgICAgICBl\nbHNlIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbnZhbGlkLXRyYW4tc3RhdHVzIiwg\nbmV3IEludGVnZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5TdGF0\ndXMpLCAic2V0Um9sbGJhY2tPbmx5IikpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldFNhdmVwb2ludChTdHJpbmcgbmFtZSkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAg\nICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmIF9zYXZlcG9pbnRzLmNv\nbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoInNhdmVwb2ludC1leGlzdHMiLCBuYW1l\nKSk7CgogICAgICAgICAgICBpZiAoaGFzRmx1c2hlZCgpICYmICFfc3BtLnN1\ncHBvcnRzSW5jcmVtZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAgICAgKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIp\nKTsKCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZSA9IF9zcG0u\nbmV3U2F2ZXBvaW50KG5hbWUsIHRoaXMpOwogICAgICAgICAgICBpZiAoX3Nh\ndmVwb2ludHMgPT0gbnVsbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICAgIHNhdmUuc2F2ZShnZXRUcmFuc2FjdGlvbmFsU3Rh\ndGVzKCkpOwogICAgICAgICAgICAgICAgX3NhdmVwb2ludHMgPSBuZXcgTGlu\na2VkTWFwKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBpZiAoX3NhdmVwb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgc2F2ZS5zYXZlKENvbGxlY3Rpb25zLkVNUFRZX1NFVCk7CiAgICAg\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzYXZlLnNh\ndmUoX3NhdmVwb2ludENhY2hlKTsKICAgICAgICAgICAgICAgICAgICBfc2F2\nZXBvaW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICBfc2F2ZXBvaW50cy5wdXQobmFtZSwgc2F2\nZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVs\nZWFzZVNhdmVwb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxz\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRz\nID09IG51bGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxh\nc3RzYXZlcG9pbnQiKSk7CiAgICAgICAgICAgIHJlbGVhc2VTYXZlcG9pbnQo\nKFN0cmluZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3Nh\ndmVwb2ludHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9p\nbnQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsK\nCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxs\nKSA/IC0xCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yo\nc2F2ZXBvaW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNs\nZWFyIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9p\nbnQgc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUo\nKSA+IGluZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVu\nSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAg\nICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAg\nICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRz\nLnJlbW92ZShpbmRleCk7CiAgICAgICAgICAgIHNhdmUucmVsZWFzZSh0cnVl\nKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2tUb1Nh\ndmVwb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51\nbGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxhc3RzYXZl\ncG9pbnQiKSk7CiAgICAgICAgICAgIHJvbGxiYWNrVG9TYXZlcG9pbnQoKFN0\ncmluZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3NhdmVw\nb2ludHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByb2xsYmFja1RvU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9p\nbnQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsK\nCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxs\nKSA/IC0xCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yo\nc2F2ZXBvaW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNs\nZWFyIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9p\nbnQgc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUo\nKSA+IGluZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVu\nSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAg\nICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAg\nICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRz\nLnJlbW92ZShpbmRleCk7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc2F2ZWQg\nPSBzYXZlLnJvbGxiYWNrKF9zYXZlcG9pbnRzLnZhbHVlcygpKTsKICAgICAg\nICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAgICAgICAgIGlm\nIChoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKSB7CiAgICAgICAgICAgICAg\nICAvLyBidWlsZCB1cCBhIG5ldyBjb2xsZWN0aW9uIG9mIHN0YXRlcwogICAg\nICAgICAgICAgICAgVHJhbnNhY3Rpb25hbENhY2hlIG9sZFRyYW5zQ2FjaGUg\nPSBfdHJhbnNDYWNoZTsKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uYWxD\nYWNoZSBuZXdUcmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZQog\nICAgICAgICAgICAgICAgICAgIChfb3JkZXJEaXJ0eSk7CiAgICAgICAgICAg\nICAgICBfdHJhbnNDYWNoZSA9IG51bGw7CgogICAgICAgICAgICAgICAgLy8g\nY3VycmVudGx5IHRoZXJlIGlzIHRoZSBhc3N1bXB0aW9uIHRoYXQgaW5jcmVt\nZW50YWwKICAgICAgICAgICAgICAgIC8vIGZsdXNoIGlzIGVpdGhlciBhKSBu\nb3QgYWxsb3dlZCwgb3IgYikgcmVxdWlyZWQKICAgICAgICAgICAgICAgIC8v\nIHByZS1zYXZlcG9pbnQuICB0aGlzIHNvbHZlcyBhIG51bWJlciBvZiBpc3N1\nZXMgaW5jbHVkaW5nCiAgICAgICAgICAgICAgICAvLyBzdG9yaW5nIGZsdXNo\nZWQgc3RhdGVzIGFzIHdlbGwgYXMgT0lEIGhhbmRsaW5nLgogICAgICAgICAg\nICAgICAgLy8gaWYgZnV0dXJlIHBsdWdpbnMgZG8gbm90IGZvbGxvdyB0aGlz\nLCB3ZSBuZWVkIHRvIGNhY2hlCiAgICAgICAgICAgICAgICAvLyBtb3JlIGlu\nZm8gcGVyIHN0YXRlCiAgICAgICAgICAgICAgICBTYXZlcG9pbnRGaWVsZE1h\nbmFnZXIgZm07CiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBzYXZl\nZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgICAgIGZtID0gKFNhdmVwb2ludEZpZWxkTWFuYWdlcikgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgICAgICBzbSA9IGZtLmdldFN0YXRlTWFuYWdl\ncigpOwogICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrVG9TYXZlcG9p\nbnQoZm0pOwogICAgICAgICAgICAgICAgICAgIG9sZFRyYW5zQ2FjaGUucmVt\nb3ZlKHNtKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBuZXdUcmFuc0NhY2hlLmFkZERp\ncnR5KHNtKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgICAgIG5ld1RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/\nPiBpdHIgPSBvbGRUcmFuc0NhY2hlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBzbS5yb2xs\nYmFjaygpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21UcmFuc2Fj\ndGlvbihzbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBf\ndHJhbnNDYWNoZSA9IG5ld1RyYW5zQ2FjaGU7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGZs\ndXNoKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIHJldHVybiBzaWxlbnRseSBpZiBubyB0\ncmFucyBpcyBhY3RpdmUsIG9yIGlmIHRoaXMgaXMgYSByZWVudHJhbnQKICAg\nICAgICAgICAgLy8gY2FsbCwgd2hpY2ggY2FuIGhhcHBlbiBpZiB0aGUgc3Rv\ncmUgbWFuYWdlciB0cmllcyB0byBnZXQgYW4KICAgICAgICAgICAgLy8gYXV0\nby1pbmMgb2lkIGR1cmluZyBmbHVzaAogICAgICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSA9PSAwCiAgICAgICAgICAgICAgICB8fCAoX2Zs\nYWdzICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVu\ndGltZSBzdXBwb3J0cyBpdAogICAgICAgICAgICBpZiAoIV9jb25mLnN1cHBv\ncnRlZE9wdGlvbnMoKS5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5P\nUFRJT05fSU5DX0ZMVVNIKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAg\nICAgICgiaW5jcmVtZW50YWwtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsKICAg\nICAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYgIV9zYXZlcG9p\nbnRzLmlzRW1wdHkoKQogICAgICAgICAgICAgICAgJiYgIV9zcG0uc3VwcG9y\ndHNJbmNyZW1lbnRhbEZsdXNoKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAg\nICAgICAgICAoInNhdmVwb2ludC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZsdXNoU2FmZShG\nTFVTSF9JTkMpOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxV\nU0hFRDsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICAgICAgLy8gcm9sbGJhY2sgb24gZmx1c2ggZXJy\nb3I7IG9iamVjdHMgbWF5IGJlIGluIGluY29uc2lzdGVudCBzdGF0ZQogICAg\nICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KGtlKTsKICAgICAgICAgICAg\nICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAv\nLyByb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBtYXkgYmUgaW4g\naW5jb25zaXN0ZW50IHN0YXRlCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFj\na09ubHkocmUpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhj\nZXB0aW9uKHJlKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByZUZs\ndXNoKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUp\nICE9IDApCiAgICAgICAgICAgICAgICBmbHVzaFNhZmUoRkxVU0hfTE9HSUNB\nTCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHZhbGlk\nYXRlQ2hhbmdlcygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiBubyB0cmFucywganVz\ndCByZXR1cm47IGlmIGFjdGl2ZSBkYXRhc3RvcmUgdHJhbnMsIGZsdXNoCiAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAgICAg\nIGZsdXNoKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBw\nb3J0cyBpbmMgZmx1c2gKICAgICAgICAgICAgaWYgKCFfY29uZi5zdXBwb3J0\nZWRPcHRpb25zKCkuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BU\nSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNI\nX1JPTExCQUNLKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc0FjdGl2ZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc1N0b3JlQWN0aXZlKCkgewogICAgICAgIC8v\nIHdlIG5lZWQgdG8gbG9jayBoZXJlLCBiZWNhdXNlIHdlIG1pZ2h0IGJlIGlu\nIHRoZSBtaWRkbGUgb2YgYW4KICAgICAgICAvLyBhdG9taWMgdHJhbnNhY3Rp\nb24gcHJvY2VzcyAoZS5nLiwgY29tbWl0QW5kUmVzdW1lKQogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiAoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDA7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gaXMgZW5kaW5nLCBpLmUuIGlu\nIHRoZSAybmQgcGhhc2UKICAgICAqIG9mIGEgY29tbWl0IG9yIHJvbGxiYWNr\nCiAgICAgKi8KICAgIGJvb2xlYW4gaXNUcmFuc2FjdGlvbkVuZGluZygpIHsK\nICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfVFJBTlNfRU5ESU5HKSAh\nPSAwOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGJlZ2luT3BlcmF0aW9u\nKGJvb2xlYW4gc3luY1RyYW5zKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKCiAgICAgICAgICAg\nIGlmIChzeW5jVHJhbnMgJiYgX29wZXJhdGlvbkNvdW50ID09IDAgJiYgX3N5\nbmNNYW5hZ2VkCiAgICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBzeW5jV2l0aE1hbmFnZWRU\ncmFuc2FjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX29wZXJhdGlvbkNv\ndW50KysgPT0gMTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTWFyayB0aGUgb3BlcmF0aW9uIG92ZXIuIElmIG91dGVybW9z\ndCBjYWxsZXIgb2Ygc3RhY2ssIHJldHVybnMgdHJ1ZQogICAgICogYW5kIHdp\nbGwgZGV0YWNoIG1hbmFnZWQgaW5zdGFuY2VzIGlmIG5lY2Vzc2FyeS4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gZW5kT3BlcmF0aW9uKCkgewogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQgPT0g\nMSAmJiAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhSRUFEKSAhPSAwCiAg\nICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDAp\nIHsKICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKG51bGwpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQg\nPCAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKF9sb2MuZ2V0KCJtdWx0aS10aHJlYWRlZC1hY2Nlc3MiKSk7CiAgICAg\nICAgICAgIHJldHVybiBfb3BlcmF0aW9uQ291bnQgPT0gMTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9vcGVyYXRpb25D\nb3VudC0tOwogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDAp\nCiAgICAgICAgICAgICAgICBpbml0aWFsaXplT3BlcmF0aW5nU2V0KCk7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgU3luY2hyb25pemF0aW9uIGdldFN5bmNocm9uaXphdGlvbigpIHsKICAg\nICAgICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nU3luY2hyb25pemF0aW9uKFN5bmNocm9uaXphdGlvbiBzeW5jKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5jID0gc3luYzsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3luY2hyb25pemF0\naW9uIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBiZWZvcmVD\nb21wbGV0aW9uKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB1c2VyLXN1cHBsaWVkIHN5\nbmNocm9uaXphdGlvbgogICAgICAgICAgICBpZiAoX3N5bmMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9zeW5jLmJlZm9yZUNvbXBsZXRpb24oKTsKCiAg\nICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9DT01NSVQpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAg\nICAgICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0\naW9uKGtlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMt\nZXJyb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5h\nZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihuZXcgU3RvcmVFeGNlcHRpb24ocmUp\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYWZ0ZXJD\nb21wbGV0aW9uKGludCBzdGF0dXMpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0\naXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFH\nX1RSQU5TX0VORElORzsKICAgICAgICAgICAgZW5kVHJhbnNhY3Rpb24oc3Rh\ndHVzKTsKICAgICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBfc3luYy5hZnRlckNvbXBsZXRpb24oc3RhdHVzKTsKCiAgICAg\nICAgICAgIGlmICgoX2F1dG9EZXRhY2ggJiBERVRBQ0hfQ09NTUlUKSAhPSAw\nKQogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBTdGF0dXMuU1RBVFVTX1JP\nTExFREJBQ0sKICAgICAgICAgICAgICAgICYmIChfYXV0b0RldGFjaCAmIERF\nVEFDSF9ST0xMQkFDSykgIT0gMCkgewogICAgICAgICAgICAgICAgZGV0YWNo\nQWxsSW50ZXJuYWwobnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIGluIGFuIGVlIGNvbnRleHQsIGl0J3MgcG9zc2libGUgdGhhdCB0aGUg\ndXNlciB0cmllZCB0byBjbG9zZQogICAgICAgICAgICAvLyB1cyBidXQgd2Ug\nZGlkbid0IGFjdHVhbGx5IGNsb3NlIGJlY2F1c2Ugd2Ugd2VyZSB3YWl0aW5n\nIG9uIHRoaXMKICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb247IGlmIHRoYXQn\ncyB0cnVlLCB0aGVuIGNsb3NlIG5vdwogICAgICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfQ0xPU0VfSU5WT0tFRCkgIT0gMAogICAgICAgICAgICAgICAg\nJiYgX2NvbXBhdC5nZXRDbG9zZU9uTWFuYWdlZENvbW1pdCgpKQogICAgICAg\nICAgICAgICAgZnJlZSgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVu\nZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IHRyYW5z\nbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKGtlKTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgcmUpOwogICAg\nICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2Vw\ndGlvbihuZXcgU3RvcmVFeGNlcHRpb24ocmUpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfQUNUSVZFOwogICAg\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX1RSQU5TX0VORElORzsKCiAgICAgICAgICAgIC8v\nIGV2ZW50IG1hbmFnZXIgbnVsbGVkIGlmIGZyZWVkIGJyb2tlcgogICAgICAg\nICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyICE9IG51bGwgCiAgICAgICAg\nICAgICAgICAmJiBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJz\nKCkpIHsKICAgICAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5l\ndyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAgICAgICAgICAgICAg\nc3RhdHVzID09IFN0YXR1cy5TVEFUVVNfQ09NTUlUVEVECiAgICAgICAgICAg\nICAgICAgICAgICAgID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9DT01NSVRf\nQ09NUExFVEUKICAgICAgICAgICAgICAgICAgICAgICAgOiBUcmFuc2FjdGlv\nbkV2ZW50LkFGVEVSX1JPTExCQUNLX0NPTVBMRVRFLAogICAgICAgICAgICAg\nICAgICAgIG51bGwsIG51bGwsIG51bGwsIG51bGwpKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogSWYgd2UncmUgaW4gYSBtYW5hZ2VkIHRyYW5z\nYWN0aW9uLCB1c2Ugb3VyIGltcGxpY2l0IGJlaGF2aW9yIGV4Y2VwdGlvbgog\nICAgICogdHJhbnNsYXRvciB0byB0cmFuc2xhdGUgYmVmb3JlL2FmdGVyQ29t\ncGxldGlvbiBjYWxsYmFjayBlcnJvcnMuCiAgICAgKi8KICAgIHByaXZhdGUg\nUnVudGltZUV4Y2VwdGlvbiB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4\nY2VwdGlvbgogICAgICAgIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgcmV0dXJuICghX21hbmFnZWQgfHwgX2V4dHJhbnMgPT0gbnVsbCkgPyBy\nZSA6IF9leHRyYW5zLnRyYW5zbGF0ZShyZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBGbHVzaCBzYWZlbHksIGNhdGNoaW5nIHJlZW50cmFudCBjYWxscy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoU2FmZShpbnQgcmVhc29u\nKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0ZMVVNISU5HKSAhPSAw\nKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJyZWVudHJhbnQtZmx1c2giKSk7CgogICAgICAgIF9mbGFn\ncyB8PSBGTEFHX0ZMVVNISU5HOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGZsdXNoKHJlYXNvbik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNISU5HOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSB0cmFuc2FjdGlvbmFsIHN0YXRl\nIHRvIHRoZSBkYXRhIHN0b3JlLiBTdWJjbGFzc2VzIHRoYXQKICAgICAqIGN1\nc3RvbWl6ZSBjb21taXQgYmVoYXZpb3Igc2hvdWxkIG92ZXJyaWRlIHRoaXMg\nbWV0aG9kLiBUaGUgbWV0aG9kCiAgICAgKiBhc3N1bWVzIHRoYXQgdGhlIHBl\ncnNpc3RlbmNlIG1hbmFnZXIgaXMgbG9ja2VkLCBpcyBub3QgY2xvc2VkLAog\nICAgICogYW5kIGhhcyBhbiBhY3RpdmUgdHJhbnNhY3Rpb24uCiAgICAgKgog\nICAgICogQHBhcmFtIHJlYXNvbiBvbmUgb2Yge0BsaW5rICNGTFVTSF9JTkN9\nLCB7QGxpbmsgI0ZMVVNIX0NPTU1JVH0sCiAgICAgKiB7QGxpbmsgI0ZMVVNI\nX1JPTExCQUNLfSwgb3Ige0BsaW5rICNGTFVTSF9MT0dJQ0FMfQogICAgICog\nQHNpbmNlIDAuMi41CiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGZsdXNo\nKGludCByZWFzb24pIHsKICAgICAgICAvLyB0aGlzIHdpbGwgZW5saXN0IHBy\nb3hpZWQgc3RhdGVzIGFzIG5lY2Vzc2FyeSBzbyB3ZSBrbm93IHdoZXRoZXIg\nd2UKICAgICAgICAvLyBoYXZlIGFueXRoaW5nIHRvIGZsdXNoCiAgICAgICAg\nQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsID0gZ2V0VHJhbnNhY3Rpb25hbFN0\nYXRlcygpOwoKICAgICAgICAvLyBkbyB3ZSBhY3R1YWxseSBoYXZlIHRvIGZs\ndXNoPyAgb25seSBpZiBvdXIgZmxhZ3Mgc2F5IHNvLCBvciBpZgogICAgICAg\nIC8vIHdlIGhhdmUgdHJhbnNhY3Rpb24gbGlzdGVuZXJzIHRoYXQgbmVlZCB0\nbyBiZSBpbnZva2VkIGZvciBjb21taXQKICAgICAgICAvLyAobm8gbmVlZCB0\nbyBpbnZva2UgdGhlbSBvbiBpbmMgZmx1c2ggaWYgbm90aGluZyBpcyBkaXJ0\neSkuICB3ZQogICAgICAgIC8vIHNwZWNpYWwgY2FzZSB0aGUgcmVtb3RlIGNv\nbW1pdCBsaXN0ZW5lciB1c2VkIGJ5IHRoZSBkYXRhY2FjaGUgY2F1c2UKICAg\nICAgICAvLyB3ZSBrbm93IGl0IGRvZXNuJ3QgcmVxdWlyZSB0aGUgY29tbWl0\nIGV2ZW50IHdoZW4gbm90aGluZyBjaGFuZ2VzCiAgICAgICAgYm9vbGVhbiBm\nbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVEKSAhPSAwOwog\nICAgICAgIGJvb2xlYW4gbGlzdGVuZXJzID0gKF90cmFuc0V2ZW50TWFuYWdl\nci5oYXNGbHVzaExpc3RlbmVycygpCiAgICAgICAgICAgIHx8IF90cmFuc0V2\nZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgJiYg\nKChfZmxhZ3MgJiBGTEFHX1JFTU9URV9MSVNURU5FUikgPT0gMAogICAgICAg\nICAgICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuZ2V0TGlzdGVuZXJzKCkuc2l6\nZSgpID4gMSk7CiAgICAgICAgaWYgKCFmbHVzaCAmJiAocmVhc29uICE9IEZM\nVVNIX0NPTU1JVCB8fCAhbGlzdGVuZXJzKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBDb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsKICAgICAgICBf\nZmxhZ3MgfD0gRkxBR19QUkVTVE9SSU5HOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChmbHVzaCkgewogICAgICAgICAgICAgICAgLy8gY2FsbCBw\ncmUgc3RvcmUgb24gYWxsIGN1cnJlbnRseSB0cmFuc2FjdGlvbmFsIG9ianMK\nICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJhbnNhY3Rp\nb25hbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAg\nICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCkpLmJlZm9y\nZUZsdXNoKHJlYXNvbiwgX2NhbGwpOwogICAgICAgICAgICAgICAgZmx1c2hB\nZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaG9wZWZ1bGx5IG5vdyBhbGwgZGVwZW5kZW50\nIGluc3RhbmNlcyB0aGF0IGFyZSBnb2luZyB0byBlbmQKICAgICAgICAgICAg\nLy8gdXAgcmVmZXJlbmNlZCBoYXZlIGJlZW4gbWFya2VkIGFzIHN1Y2g7IGRl\nbGV0ZSB1bnJlZmVkCiAgICAgICAgICAgIC8vIGRlcGVuZGVudHMKICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfREVSRUZERUxFVElORzsKICAgICAgICAg\nICAgaWYgKGZsdXNoICYmIF9kZXJlZkNhY2hlICE9IG51bGwgJiYgIV9kZXJl\nZkNhY2hlLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgZm9yIChJdGVy\nYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdHIgPSBfZGVyZWZDYWNoZS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBk\nZWxldGVEZXJlZihpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgIGZsdXNo\nQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChyZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkg\newogICAgICAgICAgICAgICAgLy8gaWYgbm8gZGF0YXN0b3JlIHRyYW5zYWN0\naW9uLCBzdGFydCBvbmU7IGV2ZW4gaWYgd2UgZG9uJ3QKICAgICAgICAgICAg\nICAgIC8vIHRoaW5rIHdlJ2xsIG5lZWQgdG8gZmx1c2ggYXQgdGhpcyBwb2lu\ndCwgb3VyIHRyYW5zYWN0aW9uCiAgICAgICAgICAgICAgICAvLyBsaXN0ZW5l\ncnMgbWlnaHQgaW50cm9kdWNlIHNvbWUgZGlydHkgb2JqZWN0cyBvciBpbnRl\ncmFjdAogICAgICAgICAgICAgICAgLy8gZGlyZWN0bHkgd2l0aCB0aGUgZGF0\nYWJhc2UKICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9S\nRV9BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICAgICAgYmVnaW5TdG9y\nZU1hbmFnZXJUcmFuc2FjdGlvbihmYWxzZSk7CgogICAgICAgICAgICAgICAg\naWYgKChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKQog\nICAgICAgICAgICAgICAgICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5oYXNF\nbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgICAgICAgICAmJiAoZmx1c2gg\nfHwgcmVhc29uID09IEZMVVNIX0NPTU1JVCkpIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBmaXJlIGV2ZW50cwogICAgICAgICAgICAgICAgICAgIG1vYmpz\nID0gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHRyYW5zYWN0aW9uYWwp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfQ09N\nTUlUCiAgICAgICAgICAgICAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFu\nYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVu\ndCh0aGlzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0\naW9uRXZlbnQuQkVGT1JFX0NPTU1JVCwgbW9ianMsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBf\nZGVsZXRlZENsc3MpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNo\nQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGZsdXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVR\nVUlSRUQpICE9IDA7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICBpZiAoZmx1c2ggJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhh\nc0ZsdXNoTGlzdGVuZXJzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhp\ncywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2\nZW50LkJFRk9SRV9GTFVTSCwgbW9ianMsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRl\nZENsc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlv\nbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19QUkVTVE9SSU5HOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVS\nRUZERUxFVElORzsKICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbnVs\nbDsKICAgICAgICAgICAgX2RlcmVmQWRkaXRpb25zID0gbnVsbDsKCiAgICAg\nICAgICAgIC8vIGFsc28gY2xlYXIgZGVyZWZlZCBzZXQ7IHRoZSBkZWxldGVz\nIGhhdmUgYmVlbiByZWNvcmRlZAogICAgICAgICAgICBpZiAoX2RlcmVmQ2Fj\naGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlID0gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIC8vIGZsdXNoIHRvIHN0b3JlIG1hbmFn\nZXIKICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoZmx1c2ggJiYgcmVhc29uICE9\nIEZMVVNIX0xPR0lDQUwpIHsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX1NUT1JFX0ZMVVNISU5HOwogICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2VwcywKICAgICAgICAgICAgICAgICAgICBuZXdGbHVzaEV4Y2Vw\ndGlvbihfc3RvcmUuZmx1c2godHJhbnNhY3Rpb25hbCkpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19TVE9SRV9GTFVTSElORzsKCiAgICAgICAgICAgIGlmIChyZWFz\nb24gPT0gRkxVU0hfUk9MTEJBQ0spCiAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbih0cnVl\nKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbiAhPSBGTFVTSF9MT0dJ\nQ0FMKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIX1JF\nUVVJUkVEOwoKICAgICAgICAgICAgLy8gbWFyayBzdGF0ZXMgYXMgZmx1c2hl\nZAogICAgICAgICAgICBpZiAoZmx1c2gpIHsKICAgICAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHRyYW5zYWN0aW9uYWwuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFn\nZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSBtYXkgaGF2\nZSBiZWNvbWUgdHJhbnNpZW50LCBzdWNoIGFzIGlmCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGl0IGlzIGVtYmVkZGVkIGFuZCB0aGUgb3duZXIgaGFz\nIGJlZW4gZGVsZXRlZCBkdXJpbmcKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gdGhpcyBmbHVzaCBwcm9jZXNzOyBidWcgIzExMDAKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRS\nQU5TSUVOVCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJGbHVzaChyZWFz\nb24pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uID09IEZM\nVVNIX0lOQykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYg\nbm90IGFib3V0IHRvIGNsZWFyIHRyYW5zIGNhY2hlIGZvciBjb21taXQgCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbnl3YXksIHJlLWNhY2hl\nIGRpcnR5IG9iamVjdHMgd2l0aCBkZWZhdWx0IHNvZnQKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHJlZnM7IHdlIGRvbid0IG5lZWQgaGFyZCBy\nZWZzIG5vdyB0aGF0IHRoZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGNoYW5nZXMgaGF2ZSBiZWVuIGZsdXNoZWQKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLnByb3h5RmllbGRzKHRydWUsIGZhbHNlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLmZsdXNoZWQo\nc20pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgZSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyB0byBz\naG9ydGN1dCBsaXN0ZW5lcnMgb24gZmFpbAogICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOwoKICAgICAgICBpZiAoZmx1c2gg\nJiYgcmVhc29uICE9IEZMVVNIX1JPTExCQUNLICYmIHJlYXNvbiAhPSBGTFVT\nSF9MT0dJQ0FMCiAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5o\nYXNGbHVzaExpc3RlbmVycygpKSB7CiAgICAgICAgICAgIGZpcmVUcmFuc2Fj\ndGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAg\nICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0ZMVVNILCBtb2Jqcywg\nX3BlcnNpc3RlZENsc3MsCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3Ms\nIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEZsdXNoIG5ld2x5LXRyYW5zYWN0aW9uYWwgb2JqZWN0cy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoQWRkaXRpb25zKENvbGxlY3Rpb24g\ndHJhbnNhY3Rpb25hbCwgaW50IHJlYXNvbikgewogICAgICAgIGJvb2xlYW4g\nbG9vcDsKICAgICAgICBkbyB7CiAgICAgICAgICAgIC8vIGZsdXNoIG5ldyB0\ncmFuc2FjdGlvbmFsIGluc3RhbmNlczsgbm90ZSBsb2dpY2FsIG9yCiAgICAg\nICAgICAgIGxvb3AgPSBmbHVzaFRyYW5zQWRkaXRpb25zKHRyYW5zYWN0aW9u\nYWwsIHJlYXNvbikKICAgICAgICAgICAgICAgIHwgZGVsZXRlRGVyZWZBZGRp\ndGlvbnMoX2RlcmVmQ2FjaGUpOwogICAgICAgIH0gd2hpbGUgKGxvb3ApOwog\nICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggdHJhbnNhY3Rpb25hbCBhZGRp\ndGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBmbHVzaFRyYW5z\nQWRkaXRpb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCwgaW50IHJlYXNv\nbikgewogICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCB8fCBf\ndHJhbnNBZGRpdGlvbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIGtlZXAgbG9jYWwgdHJhbnNhY3Rpb25hbCBs\naXN0IGNvcHkgdXAgdG8gZGF0ZQogICAgICAgIHRyYW5zYWN0aW9uYWwuYWRk\nQWxsKF90cmFuc0FkZGl0aW9ucyk7CgogICAgICAgIC8vIGNvcHkgdGhlIGNo\nYW5nZSBzZXQsIHRoZW4gY2xlYXIgaXQgZm9yIHRoZSBuZXh0IGl0ZXJhdGlv\nbgogICAgICAgIFN0YXRlTWFuYWdlckltcGxbXSBzdGF0ZXMgPSAoU3RhdGVN\nYW5hZ2VySW1wbFtdKSBfdHJhbnNBZGRpdGlvbnMuCiAgICAgICAgICAgIHRv\nQXJyYXkobmV3IFN0YXRlTWFuYWdlckltcGxbX3RyYW5zQWRkaXRpb25zLnNp\nemUoKV0pOwogICAgICAgIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CgogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBzdGF0ZXNbaV0uYmVmb3JlRmx1c2gocmVhc29uLCBfY2Fs\nbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEZWxldGUgbmV3IGRlcmVmZXJlbmNlZCBvYmplY3RzLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gZGVsZXRlRGVyZWZBZGRpdGlvbnMoQ29sbGVj\ndGlvbiBkZXJlZnMpIHsKICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zID09\nIG51bGwgfHwgX2RlcmVmQWRkaXRpb25zLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyByZW1lbWJlciB0aGVzZSBh\nZGRpdGlvbnMgaW4gY2FzZSBvbmUgYmVjb21lcyBkZXJlZmVkIGFnYWluIGxh\ndGVyCiAgICAgICAgZGVyZWZzLmFkZEFsbChfZGVyZWZBZGRpdGlvbnMpOwoK\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsW10gc3RhdGVzID0gKFN0YXRlTWFu\nYWdlckltcGxbXSkgX2RlcmVmQWRkaXRpb25zLgogICAgICAgICAgICB0b0Fy\ncmF5KG5ldyBTdGF0ZU1hbmFnZXJJbXBsW19kZXJlZkFkZGl0aW9ucy5zaXpl\nKCldKTsKICAgICAgICBfZGVyZWZBZGRpdGlvbnMgPSBudWxsOwoKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgZGVsZXRlRGVyZWYoc3RhdGVzW2ldKTsKICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBhIGRlcmVm\nZXJlbmNlZCBkZXBlbmRlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBk\nZWxldGVEZXJlZihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaW50\nIGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9ERUxF\nVEUsCiAgICAgICAgICAgIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBzbSwg\nbnVsbCk7CiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1Rf\nUlVOKSAhPSAwKQogICAgICAgICAgICBzbS5kZWxldGUoKTsKICAgICAgICBp\nZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQog\nICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRlKF9jYWxsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERldGVybWluZSB0aGUgYWN0aW9uIHRvIHRha2UgYmFz\nZWQgb24gdGhlIHVzZXIncyBnaXZlbiBjYWxsYmFja3MgYW5kCiAgICAgKiBv\ndXIgaW1wbGljaXQgYmVoYXZpb3IuCiAgICAgKi8KICAgIHByaXZhdGUgaW50\nIHByb2Nlc3NBcmd1bWVudChpbnQgb3AsIE9iamVjdCBvYmosIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChjYWxsICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBj\nYWxsLnByb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7CiAgICAgICAgaWYg\nKF9jYWxsICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FsbC5wcm9j\nZXNzQXJndW1lbnQob3AsIG9iaiwgc20pOwogICAgICAgIHJldHVybiBPcENh\nbGxiYWNrcy5BQ1RfUlVOIHwgT3BDYWxsYmFja3MuQUNUX0NBU0NBREU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyB0aGUgcHJvcGVyIGV4Y2VwdGlv\nbiBiYXNlZCBvbiB0aGUgZ2l2ZW4gc2V0IG9mIGZsdXNoIGVycm9ycywgb3IK\nICAgICAqIGRvIG5vdGhpbmcgaWYgbm8gZXJyb3JzIG9jY3VycmVkLgogICAg\nICovCiAgICBwcml2YXRlIE9wZW5KUEFFeGNlcHRpb24gbmV3Rmx1c2hFeGNl\ncHRpb24oQ29sbGVjdGlvbjxFeGNlcHRpb24+IGV4Y2VwcykgewogICAgICAg\nIGlmIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMuaXNFbXB0eSgpKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgVGhyb3dhYmxlW10gdCA9\nIGV4Y2Vwcy50b0FycmF5KG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUoKV0p\nOwogICAgICAgIExpc3Q8T2JqZWN0PiBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0\nPE9iamVjdD4odC5sZW5ndGgpOwoKICAgICAgICAvLyBjcmVhdGUgZmF0YWwg\nZXhjZXB0aW9uIHdpdGggbmVzdGVkIGV4Y2VwdGlvbnMgZm9yIGFsbCB0aGUg\nZmFpbGVkCiAgICAgICAgLy8gb2JqZWN0czsgaWYgYWxsIE9MIGV4Y2VwdGlv\nbnMsIHRocm93IGEgdG9wLWxldmVsIE9MIGV4Y2VwdGlvbgogICAgICAgIGJv\nb2xlYW4gb3B0ID0gdHJ1ZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgb3B0\nICYmIGkgPCB0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG9wdCA9IHRb\naV0gaW5zdGFuY2VvZiBPcHRpbWlzdGljRXhjZXB0aW9uOwogICAgICAgICAg\nICBpZiAob3B0KSB7CiAgICAgICAgICAgICAgICBPYmplY3QgZiA9ICgoT3B0\naW1pc3RpY0V4Y2VwdGlvbikgdFtpXSkuZ2V0RmFpbGVkT2JqZWN0KCk7CiAg\nICAgICAgICAgICAgICBpZiAoZiAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIGZhaWxlZC5hZGQoZik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgaWYgKG9wdCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkgewogICAgICAg\nICAgICBpZihfc3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmcgPT0gdHJ1ZSl7CiAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRpb24o\nX2xvYy5nZXQoImJyb2tlci1zdXBwcmVzc2luZy1leGNlcHRpb25zIix0Lmxl\nbmd0aCkpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihmYWlsZWQsIHQpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHQpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbih0KTsKICAgICAg\nICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyb2xsZWQt\nYmFjayIpKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyh0KS5z\nZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuZCB0aGUg\nY3VycmVudCB0cmFuc2FjdGlvbiwgbWFraW5nIGFwcHJvcHJpYXRlIHN0YXRl\nIHRyYW5zaXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBlbmRU\ncmFuc2FjdGlvbihpbnQgc3RhdHVzKSB7CiAgICAgICAgLy8gaWYgYSBkYXRh\nIHN0b3JlIHRyYW5zYWN0aW9uIHdhcyBpbiBwcm9ncmVzcywgZG8gdGhlCiAg\nICAgICAgLy8gYXBwcm9wcmlhdGUgdHJhbnNhY3Rpb24gY2hhbmdlCiAgICAg\nICAgYm9vbGVhbiByb2xsYmFjayA9IHN0YXR1cyAhPSBTdGF0dXMuU1RBVFVT\nX0NPTU1JVFRFRDsKICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0g\nbnVsbDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2VwcywgZW5kU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24ocm9sbGJhY2sp\nKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHJvbGxiYWNrID0gdHJ1ZTsKICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2VwcywgcmUpOwogICAgICAgIH0KCiAgICAgICAgLy8gZ28g\nYmFjayB0byBkZWZhdWx0IG5vbmUgbG9jayBsZXZlbAogICAgICAgIF9mYy5z\nZXRSZWFkTG9ja0xldmVsKExPQ0tfTk9ORSk7CiAgICAgICAgX2ZjLnNldFdy\naXRlTG9ja0xldmVsKExPQ0tfTk9ORSk7CiAgICAgICAgX2ZjLnNldExvY2tU\naW1lb3V0KC0xKTsKCiAgICAgICAgQ29sbGVjdGlvbiB0cmFuc1N0YXRlczsK\nICAgICAgICBpZiAoaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkKICAgICAg\nICAgICAgdHJhbnNTdGF0ZXMgPSBfdHJhbnNDYWNoZTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHRyYW5zU3RhdGVzID0gQ29sbGVjdGlvbnMuRU1QVFlf\nU0VUOwoKICAgICAgICAvLyBmaXJlIGFmdGVyIHJvbGxiYWNrL2NvbW1pdCBl\ndmVudAogICAgICAgIENvbGxlY3Rpb24gbW9ianMgPSBudWxsOwogICAgICAg\nIGlmIChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpIHsK\nICAgICAgICAgICAgbW9ianMgPSBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rp\nb24odHJhbnNTdGF0ZXMpOwogICAgICAgICAgICBpbnQgZXZlbnRUeXBlID0g\nKHJvbGxiYWNrKSA/IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfUk9MTEJBQ0sK\nICAgICAgICAgICAgICAgIDogVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9DT01N\nSVQ7CiAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFu\nc2FjdGlvbkV2ZW50KHRoaXMsIGV2ZW50VHlwZSwgbW9ianMsIAogICAgICAg\nICAgICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xzcywgX2RlbGV0\nZWRDbHNzKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBudWxsIHRyYW5zYWN0\naW9uYWwgY2FjaGVzIG5vdyBzbyB0aGF0IGFsbCB0aGUgcmVtb3ZlRnJvbVRy\nYW5zYWN0aW9uCiAgICAgICAgLy8gY2FsbHMgYXMgd2UgdHJhbnNpdGlvbiBl\nYWNoIG9iamVjdCBkb24ndCBoYXZlIHRvIGRvIGFueSB3b3JrOyBkb24ndAog\nICAgICAgIC8vIGNsZWFyIHRyYW5zIGNhY2hlIG9iamVjdCBiZWNhdXNlIHdl\nIHN0aWxsIG5lZWQgdGhlIHRyYW5zU3RhdGVzCiAgICAgICAgLy8gcmVmZXJl\nbmNlIHRvIGl0IGJlbG93CiAgICAgICAgX3RyYW5zQ2FjaGUgPSBudWxsOwog\nICAgICAgIGlmIChfcGVyc2lzdGVkQ2xzcyAhPSBudWxsKQogICAgICAgICAg\nICBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICAgICAgaWYgKF91cGRhdGVk\nQ2xzcyAhPSBudWxsKQogICAgICAgICAgICBfdXBkYXRlZENsc3MgPSBudWxs\nOwogICAgICAgIGlmIChfZGVsZXRlZENsc3MgIT0gbnVsbCkKICAgICAgICAg\nICAgX2RlbGV0ZWRDbHNzID0gbnVsbDsKCiAgICAgICAgLy8gbmV3IGNhY2hl\nIHdvdWxkIGdldCBjbGVhcmVkIGFueXdheSBkdXJpbmcgdHJhbnNpdGlvbnMs\nIGJ1dCBkb2luZyBzbwogICAgICAgIC8vIGltbWVkaWF0ZWx5IHNhdmVzIHVz\nIHNvbWUgbG9va3VwcwogICAgICAgIF9jYWNoZS5jbGVhck5ldygpOwoKICAg\nICAgICAvLyB0ZWxsIGFsbCBkZXJlZmVkIGluc3RhbmNlcyB0aGV5J3JlIG5v\nIGxvbmdlciBkZXJlZmVkOyB3ZSBjYW4ndAogICAgICAgIC8vIHJlbHkgb24g\ncm9sbGJhY2sgYW5kIGNvbW1pdCBjYWxscyBiZWxvdyBjYXVzZSBzb21lIGlu\nc3RhbmNlcyBtaWdodAogICAgICAgIC8vIG5vdCBiZSB0cmFuc2FjdGlvbmFs\nCiAgICAgICAgaWYgKF9kZXJlZkNhY2hlICE9IG51bGwgJiYgIV9kZXJlZkNh\nY2hlLmlzRW1wdHkoKSkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPFN0\nYXRlTWFuYWdlckltcGw+IGl0ciA9IF9kZXJlZkNhY2hlLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgaXRyLm5leHQoKS5z\nZXREZXJlZmVyZW5jZWREZXBlbmRlbnQoZmFsc2UsIGZhbHNlKTsKICAgICAg\nICAgICAgX2RlcmVmQ2FjaGUgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAg\nLy8gcGVyZm9ybSBjb21taXQgb3Igcm9sbGJhY2sgc3RhdGUgdHJhbnNpdGlv\nbnMgb24gZWFjaCBpbnN0YW5jZQogICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0cmFuc1N0YXRlcy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBzbSA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNrKSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gdGVsbCBvYmplY3RzIHRoYXQgbWF5IGhhdmUgYmVl\nbiBkZXJlZmVkIHRoZW4gZmx1c2hlZAogICAgICAgICAgICAgICAgICAgIC8v\nIChhbmQgdGhlcmVmb3JlIGRlbGV0ZWQpIHRvIHVuLWRlcmVmCiAgICAgICAg\nICAgICAgICAgICAgc20uc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50KGZhbHNl\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgc20ucm9sbGJhY2soKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVdERUxFVEVEIHx8\nIHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBERUxFVEVEKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChzbS5nZXRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKSwgbnVsbCwgc20uZ2V0TWV0YURhdGEoKSwg\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWZlY3ljbGVFdmVudC5B\nRlRFUl9ERUxFVEVfUEVSRk9STUVEKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgc20uY29tbWl0KCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90aWZ5\nIHRoZSBsb2NrIG1hbmFnZXIgdG8gY2xlYW4gdXAgYW5kIHJlbGVhc2UgcmVt\nYWluaW5nIGxvY2tzCiAgICAgICAgX2xtLmVuZFRyYW5zYWN0aW9uKCk7Cgog\nICAgICAgIC8vIGNsZWFyIG9sZCBzYXZlcG9pbnRzIGluIHJldmVyc2UKICAg\nICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAgICAgd2hpbGUgKF9z\nYXZlcG9pbnRzICE9IG51bGwgJiYgX3NhdmVwb2ludHMuc2l6ZSgpID4gMCkg\newogICAgICAgICAgICBzYXZlID0KICAgICAgICAgICAgICAgIChPcGVuSlBB\nU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoX3NhdmVwb2ludHMuc2l6\nZSgpIC0gMSk7CiAgICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAg\nICAgICAgfQogICAgICAgIF9zYXZlcG9pbnRzID0gbnVsbDsKICAgICAgICBf\nc2F2ZXBvaW50Q2FjaGUgPSBudWxsOwoKICAgICAgICAvLyBmaXJlIGFmdGVy\nIHN0YXRlIGNoYW5nZSBldmVudAogICAgICAgIGlmIChfdHJhbnNFdmVudE1h\nbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpCiAgICAgICAgICAgIGZpcmVUcmFu\nc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsIFRyYW5z\nYWN0aW9uRXZlbnQuCiAgICAgICAgICAgICAgICBBRlRFUl9TVEFURV9UUkFO\nU0lUSU9OUywgbW9ianMsIG51bGwsIG51bGwsIG51bGwpKTsKCiAgICAgICAg\nLy8gbm93IGNsZWFyIHRyYW5zIGNhY2hlOyBrZWVwIGNsZWFyZWQgdmVyc2lv\nbiByYXRoZXIgdGhhbgogICAgICAgIC8vIG51bGwgdG8gYXZvaWQgaGF2aW5n\nIHRvIHJlLWNyZWF0ZSB0aGUgc2V0IGxhdGVyOyBtb3JlIGVmZmljaWVudAog\nICAgICAgIGlmICh0cmFuc1N0YXRlcyAhPSBDb2xsZWN0aW9ucy5FTVBUWV9T\nRVQpIHsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSAoVHJhbnNhY3Rpb25h\nbENhY2hlKSB0cmFuc1N0YXRlczsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUu\nY2xlYXIoKTsKICAgICAgICB9CgogICAgICAgIHRocm93TmVzdGVkRXhjZXB0\naW9ucyhleGNlcHMsIHRydWUpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBPYmplY3QgbGlmZWN5Y2xlCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoT2JqZWN0IG9i\naiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHBlcnNpc3Qob2JqLCBu\ndWxsLCB0cnVlLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0\nYXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVjdCBpZCwKICAg\nICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcmV0dXJuIHBlcnNp\nc3Qob2JqLCBpZCwgdHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgcGVyc2lzdEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBwZXJzaXN0QWxsKG9ianMsIHRydWUsIGNhbGwpOwog\nICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0\ncy4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVy\nc2lzdAogICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQ\nTkVXUFJPVklTSU9OQUwpLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwZXJz\naXN0QWxsKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiBleHBsaWNpdCwgCiAg\nICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBz\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRXcml0\nZU9wZXJhdGlvbigpOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBp\ndHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHBlcnNpc3Qo\naXRyLm5leHQoKSwgZXhwbGljaXQsIGNhbGwpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAg\nICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgICAgICB0aHJvd05l\nc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJZiB0aGUgZ2l2ZW4gZWxlbWVudCBpcyBub3QgbnVsbCwgYWRk\nIGl0IHRvIHRoZSBnaXZlbiBsaXN0LAogICAgICogY3JlYXRpbmcgdGhlIGxp\nc3QgaWYgbmVjZXNzYXJ5LgogICAgICovCiAgICBwcml2YXRlIExpc3Q8RXhj\nZXB0aW9uPiBhZGQoTGlzdDxFeGNlcHRpb24+IGwsIEV4Y2VwdGlvbiBvKSB7\nCiAgICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGw7\nCiAgICAgICAgaWYgKGwgPT0gbnVsbCkKICAgICAgICAgICAgbCA9IG5ldyBM\naW5rZWRMaXN0PEV4Y2VwdGlvbj4oKTsKICAgICAgICBsLmFkZChvKTsKICAg\nICAgICByZXR1cm4gbDsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGFu\nIGV4Y2VwdGlvbiB3cmFwcGluZyB0aGUgZ2l2ZW4gbmVzdGVkIGV4Y2VwdGlv\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0aHJvd05lc3RlZEV4Y2Vw\ndGlvbnMoTGlzdDxFeGNlcHRpb24+IGV4Y2VwcywgYm9vbGVhbiBkYXRhc3Rv\ncmUpIHsKICAgICAgICBpZiAoZXhjZXBzID09IG51bGwgfHwgZXhjZXBzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChkYXRh\nc3RvcmUgJiYgZXhjZXBzLnNpemUoKSA9PSAxKQogICAgICAgICAgICB0aHJv\ndyAoUnVudGltZUV4Y2VwdGlvbikgZXhjZXBzLmdldCgwKTsKCiAgICAgICAg\nYm9vbGVhbiBmYXRhbCA9IGZhbHNlOwogICAgICAgIFRocm93YWJsZVtdIHQg\nPSBleGNlcHMudG9BcnJheShuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5zaXplKCld\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKHRbaV0gaW5zdGFuY2VvZiBPcGVuSlBBRXhj\nZXB0aW9uCiAgICAgICAgICAgICAgICAmJiAoKE9wZW5KUEFFeGNlcHRpb24p\nIHRbaV0pLmlzRmF0YWwoKSkKICAgICAgICAgICAgICAgIGZhdGFsID0gdHJ1\nZTsKICAgICAgICB9CiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBlcnI7CiAg\nICAgICAgaWYgKGRhdGFzdG9yZSkKICAgICAgICAgICAgZXJyID0gbmV3IFN0\nb3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhjZXBzIikpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgZXJyID0gbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMiKSk7CiAgICAgICAgdGhyb3cgZXJy\nLnNldE5lc3RlZFRocm93YWJsZXModCkuc2V0RmF0YWwoZmF0YWwpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0LiAg\nSW5kaWNhdGUgd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0\nCiAgICAgKiAoUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBORVdQ\nUk9WSVNJT05BTCkKICAgICAqLwogICAgcHVibGljIHZvaWQgcGVyc2lzdChP\nYmplY3Qgb2JqLCBib29sZWFuIGV4cGxpY2l0LCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgcGVyc2lzdChvYmosIG51bGwsIGV4cGxpY2l0LCBjYWxs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9i\namVjdC4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQg\ncGVyc2lzdAogICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0\nIChQTkVXUFJPVklTSU9OQUwpLgogICAgICogU2VlIHtAbGluayBCcm9rZXJ9\nIGZvciBkZXRhaWxzIG9uIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJs\naWMgT3BlbkpQQVN0YXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9i\namVjdCBpZCwgYm9vbGVhbiBleHBsaWNpdCwKICAgICAgICBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRp\nb24oKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRT\ndGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgh\nX29wZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgICAgIHJldHVybiBz\nbTsKCiAgICAgICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQo\nT3BDYWxsYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBzbSwgY2FsbCk7CiAgICAg\nICAgICAgIGlmIChhY3Rpb24gPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpCiAg\nICAgICAgICAgICAgICByZXR1cm4gc207CgogICAgICAgICAgICAvLyBBQ1Rf\nQ0FTQ0FERQogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tz\nLkFDVF9SVU4pID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNh\nbGwpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1BfUEVSU0lTVCwgb2Jq\nLCBjYWxsLAogICAgICAgICAgICAgICAgICAgICAgICAicGVyc2lzdCIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBBQ1RfUlVOCiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYzsKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdl\ndAogICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNpc3QtZGV0YWNoZWQi\nLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAgICAgICAgICAgICAg\nICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CgogICAgICAgICAgICAg\nICAgaWYgKCFzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBzbS5wZXJzaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLnBl\ncnNpc3Qoc20pOwogICAgICAgICAgICAgICAgICAgIGlmICgoYWN0aW9uICYg\nT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICAvLyBhbiBlbWJlZGRlZCBmaWVsZDsgbm90aWZ5IHRoZSBv\nd25lciB0aGF0IHRoZSB2YWx1ZSBoYXMKICAgICAgICAgICAgICAgIC8vIGNo\nYW5nZWQgYnkgYmVjb21pbmcgaW5kZXBlbmRlbnRseSBwZXJzaXN0ZW50CiAg\nICAgICAgICAgICAgICBzbS5nZXRPd25lcigpLmRpcnR5KHNtLmdldE93bmVy\nSW5kZXgoKSk7CiAgICAgICAgICAgICAgICBfY2FjaGUucGVyc2lzdChzbSk7\nCiAgICAgICAgICAgICAgICBwYyA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGMg\nPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKTsKICAgICAgICAgICAg\nICAgIGlmIChwYy5wY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFuLlRSVUUpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2Vw\ndGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNp\nc3QtZGV0YWNoZWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAg\nICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRl\nciwgdHJ1ZSk7CiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChvYmos\nIG51bGwsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9QRVJTSVNUKTsK\nCiAgICAgICAgICAgIC8vIGNyZWF0ZSBpZCBmb3IgaW5zdGFuY2UKICAgICAg\nICAgICAgaWYgKGlkID09IG51bGwpIHsKICAgICAgICAgICAgCWludCBpZFR5\ncGUgPSBtZXRhLmdldElkZW50aXR5VHlwZSgpOwogICAgICAgICAgICAgICAg\naWYgKGlkVHlwZSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQog\nICAgICAgICAgICAgICAgICAgIGlkID0gQXBwbGljYXRpb25JZHMuY3JlYXRl\nKHBjLCBtZXRhKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlkVHlwZSA9\nPSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5r\nbm93bmlkIiwgbWV0YSkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2Uo\ndGhpcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3Vy\nZSB3ZSBkb24ndCBhbHJlYWR5IGhhdmUgdGhlIGluc3RhbmNlIGNhY2hlZAog\nICAgICAgICAgICBjaGVja0ZvckR1cGxpY2F0ZUlkKGlkLCBvYmopOwoKICAg\nICAgICAgICAgLy8gaWYgaGFkIGVtYmVkZGVkIHNtLCBudWxsIGl0CiAgICAg\nICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGMucGNS\nZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwoKICAgICAgICAgICAgLy8gY3Jl\nYXRlIG5ldyBzbQogICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJ\nbXBsKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGV4\ncGxpY2l0KQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUocGMs\nIFBDU3RhdGUuUE5FVyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTkVXUFJP\nVklTSU9OQUwpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nIHNtLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5PTlRSQU5TTkVXKTsKICAg\nICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FE\nRSkgIT0gMCkKICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNh\nbGwpOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZW1wb3JhcmlseSBtYW5h\nZ2UgdGhlIGdpdmVuIGluc3RhbmNlIGluIG9yZGVyIHRvIGNhc2NhZGUgdGhl\nIGdpdmVuCiAgICAgKiBvcGVyYXRpb24gdGhyb3VnaCBpdC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGNhc2NhZGVUcmFuc2llbnQoaW50IG9wLCBPYmpl\nY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFN0cmluZyBlcnJP\ncCkgewogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IGFzc2VydFBl\ncnNpc3RlbmNlQ2FwYWJsZShvYmopOwoKICAgICAgICAvLyBpZiB1c2luZyBk\nZXRhY2hlZCBzdGF0ZSBtYW5hZ2VyLCBkb24ndCByZXBsYWNlCiAgICAgICAg\naWYgKHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCkgIT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCBlcnJPcCk7Cgog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRh\nKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwoU3RhdGVN\nYW5hZ2VySWQuCiAgICAgICAgICAgIG5ld0luc3RhbmNlKHRoaXMpLCBtZXRh\nLCB0aGlzKTsKICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlRM\nT0FERUQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAob3Ap\nIHsKICAgICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfUEVSU0lT\nVDoKICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxs\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgT3BDYWxsYmFja3MuT1BfREVMRVRFOgogICAgICAgICAgICAgICAg\nICAgIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9Q\nX1JFRlJFU0g6CiAgICAgICAgICAgICAgICAgICAgc20uZ2F0aGVyQ2FzY2Fk\nZVJlZnJlc2goY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihvcCkp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewog\nICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBkZWxldGVBbGwoQ29sbGVjdGlvbiBvYmpzLCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVy\nYXRpb24oKTsKCiAgICAgICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMg\nPSBudWxsOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAob2JqICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGRl\nbGV0ZShvYmosIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKSwgY2Fs\nbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVl\nKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywg\ndWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9iamVj\ndCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nV3JpdGVPcGVyYXRpb24oKTsKICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0\nU3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpLCBjYWxsKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFs\nIGRlbGV0ZS4KICAgICAqLwogICAgdm9pZCBkZWxldGUoT2JqZWN0IG9iaiwg\nU3RhdGVNYW5hZ2VySW1wbCBzbSwgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGlmICghX29wZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9w\nQ2FsbGJhY2tzLk9QX0RFTEVURSwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAg\naWYgKGFjdGlvbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAvLyBBQ1RfQ0FTQ0FERQogICAgICAgIGlm\nICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkgewogICAg\nICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYg\nKCFzbS5pc0VtYmVkZGVkKCkgfHwgIXNtLmdldERlcmVmZXJlbmNlZEVtYmVk\nRGVwZW5kZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRl\nRGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNhc2NhZGVUcmFu\nc2llbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLCBvYmosIGNhbGwsICJkZWxl\ndGUiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nLy8gQUNUX1JVTgogICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJkZWxldGUiKTsKICAgICAg\nICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkg\nIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKCFzbS5pc0VtYmVkZGVkKCkg\nfHwgIXNtLmdldERlcmVmZXJlbmNlZEVtYmVkRGVwZW5kZW50KCkpIHsKICAg\nICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRlKGNhbGwpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNtLmRl\nbGV0ZSgpOwogICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VD\nYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkgPT0gQm9vbGVhbi5UUlVFKQog\nICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJk\nZWxldGUiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGFuIGV4Y2Vw\ndGlvbiBpbmRpY2F0aW5nIHRoYXQgdGhlIGN1cnJlbnQgYWN0aW9uIGNhbid0\nIGJlCiAgICAgKiBwZXJmb3JtZWQgb24gYSBkZXRhY2hlZCBvYmplY3QuCiAg\nICAgKi8KICAgIHByaXZhdGUgT3BlbkpQQUV4Y2VwdGlvbiBuZXdEZXRhY2hl\nZEV4Y2VwdGlvbihPYmplY3Qgb2JqLAogICAgICAgIFN0cmluZyBvcGVyYXRp\nb24pIHsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLWRldGFjaGVkLW9wIiwgb3BlcmF0aW9uLAogICAgICAgICAgICBF\neGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2Jq\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlQWxsKENvbGxlY3Rp\nb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBMaXN0\nPEV4Y2VwdGlvbj4gZXhjZXBzID0gbnVsbDsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvcjw/PiBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIHJlbGVhc2UoaXRyLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93TmVzdGVkRXhj\nZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgcmVsZWFzZShPYmplY3Qgb2JqLCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0g\nZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBp\nbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JF\nTEVBU0UsIG9iaiwgc20sIGNhbGwpOwoKICAgICAgICAgICAgaWYgKHNtID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlm\nICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0gMCAmJiBzbS5p\nc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgYm9vbGVhbiBwZW5k\naW5nID0gc20uaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAg\nICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChw\nZW5kaW5nKQogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21QZW5kaW5n\nVHJhbnNhY3Rpb24oc20pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0\nYXRlTWFuYWdlciBlbWJlZChPYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwgVmFsdWVNZXRhRGF0YSBv\nd25lck1ldGEpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWcg\nPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAg\nIGlmIChvcmlnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGFs\ncmVhZHkgZW1iZWRkZWQsIG5vdGhpbmcgdG8gZG8KICAgICAgICAgICAgICAg\nIGlmIChvcmlnLmdldE93bmVyKCkgPT0gb3duZXIgJiYgb3JpZy5nZXRNZXRh\nRGF0YSgpLgogICAgICAgICAgICAgICAgICAgIGdldEVtYmVkZGluZ01ldGFE\nYXRhKCkgPT0gb3duZXJNZXRhKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBvcmlnOwoKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBtYWtlIHN1\ncmUgcGMgaXMgZnVsbHkgbG9hZGVkIGZvciB3aGVuIHdlIGNvcHkgaXRzCiAg\nICAgICAgICAgICAgICAvLyBkYXRhIGJlbG93CiAgICAgICAgICAgICAgICBv\ncmlnLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxMLCBudWxs\nLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGNyZWF0ZSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGVtYmVkZGVkIG1ldGFk\nYXRhCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG93bmVyTWV0\nYS5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChtZXRh\nID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oX2xvYy5nZXQoImJhZC1lbWJlZCIsIG93bmVyTWV0YSkpOwoK\nICAgICAgICAgICAgaWYgKGlkID09IG51bGwpCiAgICAgICAgICAgICAgICBp\nZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwoKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJ\nbXBsKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgc20uc2V0T3duZXIo\nKFN0YXRlTWFuYWdlckltcGwpIG93bmVyLCBvd25lck1ldGEpOwoKICAgICAg\nICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIGNvcHk7CiAgICAgICAgICAgIFBD\nU3RhdGUgc3RhdGU7CiAgICAgICAgICAgIENsYXNzPD8+IHR5cGUgPSBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgaWYgKG9iaiAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAvLyBnaXZlIGNvcHkgYW5kIHRoZSBv\ncmlnaW5hbCBpbnN0YW5jZSB0aGUgc2FtZSBzdGF0ZSBtYW5hZ2VyCiAgICAg\nICAgICAgICAgICAvLyBzbyB0aGF0IHdlIGNhbiBjb3B5IGZpZWxkcyBmcm9t\nIG9uZSB0byB0aGUgb3RoZXIKICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgY29weVNNOwogICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjOwogICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIGNvcHlTTSA9IHNtOwogICAgICAgICAgICAg\nICAgICAgIHBjID0gYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7CiAg\nICAgICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNt\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgY29weVNNID0gb3JpZzsKICAgICAgICAgICAgICAgICAgICBwYyA9IG9y\naWcuZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAv\nLyBjb3B5IHRoZSBpbnN0YW5jZS4gIHdlIGRvIHRoaXMgZXZlbiBpZiBpdCBk\nb2Vzbid0IGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIGEg\nc3RhdGUgbWFuYWdlciBpbiBjYXNlIGl0IGlzIGxhdGVyIGFzc2lnbmVkIHRv\nIGEKICAgICAgICAgICAgICAgICAgICAvLyBQQyBmaWVsZDsgYXQgdGhhdCBw\nb2ludCBpdCdzIHRvbyBsYXRlIHRvIGNvcHkKICAgICAgICAgICAgICAgICAg\nICBjb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZSh0eXBlLCBjb3B5U00s\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpbnRbXSBmaWVsZHMgPSBu\nZXcgaW50W21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoXTsKICAgICAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzW2ldID0gaTsKICAg\nICAgICAgICAgICAgICAgICBjb3B5LnBjQ29weUZpZWxkcyhwYywgZmllbGRz\nKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBDU3RhdGUuRUNPUFk7\nCiAgICAgICAgICAgICAgICAgICAgY29weS5wY1JlcGxhY2VTdGF0ZU1hbmFn\nZXIobnVsbCk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5jZSBkaWRuJ3QgaGF2ZSBh\nIHN0YXRlIG1hbmFnZXIgdG8gc3RhcnQsCiAgICAgICAgICAgICAgICAgICAg\nLy8gcmV2ZXJ0IGl0IHRvIGJlaW5nIHRyYW5zaWVudAogICAgICAgICAgICAg\nICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihudWxsKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUsIHNtLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZF\nKSAhPSAwICYmICFfb3B0aW1pc3RpYykKICAgICAgICAgICAgICAgICAgICBz\ndGF0ZSA9IFBDU3RhdGUuRUNMRUFOOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5FTk9OVFJBTlM7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoY29w\neSwgc3RhdGUpOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBub3QgYWxy\nZWFkeSBjYWNoZWQsIGNyZWF0ZSBhbiBlbXB0eSBjb3B5IG9mIHRoZSBnaXZl\nbiBzdGF0ZQogICAgICogbWFuYWdlciBpbiB0aGUgZ2l2ZW4gc3RhdGUuCiAg\nICAgKi8KICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgY29weShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIGNvcHksIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBjb3B5LmZl\ndGNoT2JqZWN0SWQoKTsKICAgICAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IGNv\ncHkuZ2V0TWFuYWdlZEluc3RhbmNlKCkuZ2V0Q2xhc3MoKTsKICAgICAgICAg\nICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIC8vIGNhY2hlZCBp\nbnN0YW5jZT8KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG51\nbGw7CiAgICAgICAgICAgIGlmICghY29weS5pc0VtYmVkZGVkKCkpCiAgICAg\nICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwg\ndHJ1ZSk7CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29uZi4KICAg\nICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5j\nZSgpOwogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVw\nb3MuZ2V0TWV0YURhdGEodHlwZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICAvLyBjb25zdHJ1Y3QgYSBuZXcgc3RhdGUgbWFuYWdlciB3aXRo\nIGFsbCBpbmZvIGtub3duCiAgICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0\nZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAg\nICBzbS5zZXRPYmplY3RJZChvaWQpOwogICAgICAgICAgICAgICAgc20uaW5p\ndGlhbGl6ZShzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwg\nc3RhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzbTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHJlZnJl\nc2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgaWYgKG9ianMgPT0gbnVsbCB8fCBvYmpzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2Fj\ndGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBp\ndHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSAKICAgICAg\nICAgICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKGl0ci5uZXh0KCksIGNh\nbGwpOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIAlyZXR1cm47CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5n\nLnNpemUoKSA9PSAxKQogICAgICAgICAgICAJcmVmcmVzaEludGVybmFsKF9v\ncGVyYXRpbmcuaXRlcmF0b3IoKS5uZXh0KCksIGNhbGwpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwoX29wZXJhdGlu\nZywgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlZnJlc2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAg\nICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2gob2JqLCBjYWxsKTsKICAgICAg\nICAgICAgaWYgKF9vcGVyYXRpbmcuaXNFbXB0eSgpKQogICAgICAgICAgICAJ\ncmV0dXJuOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXplKCkgPT0g\nMSkKICAgICAgICAgICAgCXJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLml0\nZXJhdG9yKCkubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcsIGNhbGwpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlcnMgYWxs\nIG9iamVjdHMgcmVhY2hhYmxlIHRocm91Z2ggY2FzY2FkZS1yZWZyZXNoIHJl\nbGF0aW9ucwogICAgICogaW50byB0aGUgb3BlcmF0aW5nIHNldC4KICAgICAq\nLwogICAgdm9pZCBnYXRoZXJDYXNjYWRlUmVmcmVzaChPYmplY3Qgb2JqLCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKCFfb3BlcmF0aW5nLmFk\nZChvYmopKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2Up\nOwogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxs\nYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgaWYg\nKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAg\nICAgICAgICAgc20uZ2F0aGVyQ2FzY2FkZVJlZnJlc2goY2FsbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBjYXNjYWRlVHJhbnNpZW50KE9wQ2FsbGJh\nY2tzLk9QX1JFRlJFU0gsIG9iaiwgY2FsbCwgInJlZnJlc2giKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aXRoIHRo\nZSBmdWxsIHNldCBvZiBvYmplY3RzIHJlYWNoYWJsZSB2aWEKICAgICAqIGNh\nc2NhZGUtcmVmcmVzaCByZWxhdGlvbnMgZnJvbSB0aGUgdXNlci1naXZlbiBp\nbnN0YW5jZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJ\nbnRlcm5hbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgIAlpZiAob2JqcyA9PSBudWxsIHx8IG9ianMuaXNFbXB0eSgpKQogICAg\nCQlyZXR1cm47CiAgICAgICAgTGlzdDxFeGNlcHRpb24+IGV4Y2VwcyA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29sbGVjdCBpbnN0\nYW5jZXMgdGhhdCBuZWVkIGEgcmVmcmVzaAogICAgICAgICAgICBDb2xsZWN0\naW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IGxvYWQgPSBudWxsOwogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBPYmplY3Qg\nb2JqOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IG9ianMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAob2JqID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0\nYXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUZSRVNI\nLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgICAgICAgICAmIE9w\nQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRh\nY2hlZCgpKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5l\nd0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZWxzZSBpZiAoc20uYmVmb3JlUmVmcmVzaCh0cnVl\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKGxvYWQgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgCQlsb2FkID0gbmV3IEFycmF5\nTGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2VyPihvYmpzLnNpemUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaW50\nIGxldmVsID0gX2ZjLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaW50IHRpbWVvdXQgPSBfZmMuZ2V0TG9ja1RpbWVvdXQo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVs\nLCB0aW1lb3V0LCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsKICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShv\nYmopLnBjSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgID09\nIEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\ncmVmcmVzaCBhbGwKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxPYmplY3Q+IGZhaWxlZCA9IF9z\ndG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsCiAgICAgICAgICAgICAgICAgICAg\nU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURfUkVGUkVTSCwgX2ZjLCBudWxsKTsK\nICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVk\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsK\nCiAgICAgICAgICAgICAgICAvLyBwZXJmb3JtIHBvc3QtcmVmcmVzaCB0cmFu\nc2l0aW9ucyBhbmQgbWFrZSBzdXJlIGFsbCBmZXRjaAogICAgICAgICAgICAg\nICAgLy8gZ3JvdXAgZmllbGRzIGFyZSBsb2FkZWQKICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3I8T3BlbkpQQVN0YXRlTWFuYWdlcj4gaXRyID0gbG9h\nZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxl\nZC5jb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHNtLmFmdGVyUmVmcmVzaCgpOwogICAgICAg\nICAgICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1w\nbC5MT0FEX0ZHUywgbnVsbCwgbnVsbCwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBleGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBub3cgaW52b2tlIHBvc3RSZWZyZXNoIG9uIGFsbCB0aGUgaW5z\ndGFuY2VzCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gb2Jq\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFu\nYWdlckltcGwoaXRyLm5leHQoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKHNtICE9IG51bGwgJiYgIXNtLmlzRGV0YWNoZWQoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KHNtLmdldE1h\nbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJf\nUkVGUkVTSCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0ZWRFeGNl\ncHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nT3B0aW1pemF0aW9uIGZvciBzaW5nbGUtb2JqZWN0IHJlZnJlc2guCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRlcm5hbChPYmplY3Qg\nb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCkKICAg\nICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAg\nICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgInJlZnJlc2giKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNt\nLmJlZm9yZVJlZnJlc2goZmFsc2UpKSB7CiAgICAgICAgICAgICAgICAgICAg\nc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGws\nIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBzbS5hZnRlclJl\nZnJlc2goKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlu\ndCBsZXZlbCA9IF9mYy5nZXRSZWFkTG9ja0xldmVsKCk7CiAgICAgICAgICAg\nICAgICBpbnQgdGltZW91dCA9IF9mYy5nZXRMb2NrVGltZW91dCgpOwogICAg\nICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCB0aW1lb3V0LCBudWxs\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxldmVs\nLCBsZXZlbCk7CiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQo\nc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsCiAgICAgICAgICAgICAg\nICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJf\nUkVGUkVTSCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lz\ndGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAg\nICAgID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5l\nd0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgIH0KICAgIH0KICAgIAogICAgCiAgICBwdWJsaWMgdm9pZCBy\nZXRyaWV2ZUFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZGZnT25seSwK\nICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMg\nPT0gbnVsbCB8fCBvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAg\nIHJldHJpZXZlKG9ianMuaXRlcmF0b3IoKS5uZXh0KCksIGRmZ09ubHksIGNh\nbGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBM\naXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0gbnVsbDsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxS\nZWFkKCk7CgogICAgICAgICAgICAvLyBjb2xsZWN0IGFsbCBob2xsb3cgaW5z\ndGFuY2VzIGZvciBsb2FkCiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAg\nICAgICAgIENvbGxlY3Rpb248T3BlbkpQQVN0YXRlTWFuYWdlcj4gbG9hZCA9\nIG51bGw7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAg\nICAgICAgIENvbGxlY3Rpb248U3RhdGVNYW5hZ2VySW1wbD4gc21zID0gbmV3\nIEFycmF5TGlzdDxTdGF0ZU1hbmFnZXJJbXBsPihvYmpzLnNpemUoKSk7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gb2Jqcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2JqID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmICgo\ncHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZFLCBvYmos\nIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgICAgICAgICAmIE9wQ2FsbGJh\nY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgp\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNo\nZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5I\nT0xMT1cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbG9hZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2FkID0gbmV3IEFycmF5TGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2Vy\nPigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRk\nKHNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVk\nKCkKICAgICAgICAgICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQog\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2Vw\ndGlvbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGV4\nY2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbG9hZCBhbGwgaG9sbG93IGlu\nc3RhbmNlcwogICAgICAgICAgICBDb2xsZWN0aW9uPE9iamVjdD4gZmFpbGVk\nID0gbnVsbDsKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBTdG9yZU1hbmFn\nZXIuRk9SQ0VfTE9BRF9ERkcKICAgICAgICAgICAgICAgICAgICA6IFN0b3Jl\nTWFuYWdlci5GT1JDRV9MT0FEX0FMTDsKICAgICAgICAgICAgICAgIGZhaWxl\nZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsIG1vZGUsIF9mYywgbnVs\nbCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZh\naWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2VwcywgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVk\nKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJldHJpZXZlIGFs\nbCBub24tZmFpbGVkIGluc3RhbmNlcwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yPFN0YXRlTWFuYWdlckltcGw+IGl0ciA9IHNtcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZh\naWxlZC5jb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBpbnQgbW9kZSA9IChkZmdP\nbmx5KSA/IFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MKICAgICAgICAgICAg\nICAgICAgICA6IFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtLmJlZm9yZVJl\nYWQoLTEpOwogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2Rl\nLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAg\ndGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHJldHJpZXZlKE9iamVjdCBvYmosIGJvb2xlYW4g\nZGZnT25seSwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmog\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxS\nZWFkKCk7CgogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0\nU3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAo\nKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRVRSSUVWRSwgb2Jq\nLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNU\nX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc20u\naXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0Rl\ndGFjaGVkRXhjZXB0aW9uKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAg\nICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAg\nICAgICBpbnQgbW9kZSA9IChkZmdPbmx5KSA/IFN0YXRlTWFuYWdlckltcGwu\nTE9BRF9GR1MKICAgICAgICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFn\nZXJJbXBsLkxPQURfQUxMOwogICAgICAgICAgICAgICAgICAgIHNtLmJlZm9y\nZVJlYWQoLTEpOwogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBt\nb2RlLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxl\nKG9iaikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAgICAgID09IEJvb2xl\nYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhj\nZXB0aW9uKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBldmljdCBhbGwgUENsZWFuIGFu\nZCBQTm9uVHJhbnMgb2JqZWN0cwogICAgICAgICAgICBDb2xsZWN0aW9uPFN0\nYXRlTWFuYWdlckltcGw+IGMgPSBnZXRNYW5hZ2VkU3RhdGVzKCk7CiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3I8U3RhdGVNYW5hZ2VySW1wbD4gaXRyID0gYy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgp\nICYmICFzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXZpY3Qo\nc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIGNhbGwpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZXZpY3RBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgTGlzdDxFeGNlcHRpb24+IGV4Y2VwcyA9IG51bGw7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gb2Jqcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBldmljdChpdHIubmV4dCgpLCBjYWxsKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxsKEV4dGVudCBleHRlbnQs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoZXh0ZW50ID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGV2aWN0\nIGFsbCBQQ2xlYW4gYW5kIFBOb25UcmFucyBvYmplY3RzIGluIGV4dGVudAog\nICAgICAgICAgICBDb2xsZWN0aW9uPFN0YXRlTWFuYWdlckltcGw+IGMgPSBn\nZXRNYW5hZ2VkU3RhdGVzKCk7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc207CiAgICAgICAgICAgIENsYXNzPD8+IGNsczsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdHIgPSBjLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0\nZW50KCkgJiYgIXNtLmlzRGlydHkoKSkgewogICAgICAgICAgICAgICAgICAg\nIGNscyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChjbHMgPT0gZXh0ZW50LmdldEVsZW1l\nbnRUeXBlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGV4dGVudC5o\nYXNTdWJjbGFzc2VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgZXh0\nZW50LmdldEVsZW1lbnRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShjbHMpKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgZXZpY3Qoc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCksIGNhbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0\nKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9i\naiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9w\nQ2FsbGJhY2tzLk9QX0VWSUNULCBvYmosIHNtLCBjYWxsKQogICAgICAgICAg\nICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHNtLmV2aWN0KCk7\nCiAgICAgICAgICAgIGlmIChfZXZpY3REYXRhQ2FjaGUgJiYgc20uZ2V0T2Jq\nZWN0SWQoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBEYXRhQ2FjaGUg\nY2FjaGUgPSBfY29uZi5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS5z\nZWxlY3RDYWNoZShzbSk7CiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBjYWNoZS5yZW1vdmUoc20uZ2V0\nT2JqZWN0SWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZGV0YWNo\nKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsK\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIGZh\nbHNlLCBjYWxsKS5kZXRhY2gob2JqKTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0YWNoQWxsKENvbGxl\nY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChv\nYmpzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZ\nX09CSkVDVFM7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAg\nICAgY2FsbCA9IF9jYWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbmV3IERldGFj\naE1hbmFnZXIodGhpcywgZmFsc2UsIGNhbGwpLmRldGFjaEFsbChvYmpzKTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBkZXRhY2hBbGwoT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGRldGFj\naEFsbChjYWxsLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZXRh\nY2hBbGwoT3BDYWxsYmFja3MgY2FsbCwgYm9vbGVhbiBmbHVzaCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIC8vIElmIGEgZmx1c2ggaXMgZGVzaXJlZCAoYmFzZWQgb24gaW5w\ndXQgcGFybSksIHRoZW4gY2hlY2sgaWYgdGhlCiAgICAgICAgICAgIC8vICJk\naXJ0eSIgZmxhZyBpcyBzZXQgYmVmb3JlIGNhbGxpbmcgZmx1c2goKS4KICAg\nICAgICAgICAgaWYgKGZsdXNoICYmIChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JF\nUVVJUkVEKSAhPSAwKQogICAgICAgICAgICAgICAgZmx1c2goKTsKICAgICAg\nICAgICAgZGV0YWNoQWxsSW50ZXJuYWwoY2FsbCk7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFsbElu\ndGVybmFsKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBDb2xsZWN0aW9u\nPFN0YXRlTWFuYWdlckltcGw+IHN0YXRlcyA9IGdldE1hbmFnZWRTdGF0ZXMo\nKTsKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZvciAo\nSXRlcmF0b3I8U3RhdGVNYW5hZ2VySW1wbD4gaXRyID0gc3RhdGVzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gaXRy\nLm5leHQoKTsKICAgICAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3RlbnQoKSkK\nICAgICAgICAgICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgZWxz\nZSBpZiAoIXNtLmdldE1ldGFEYXRhKCkuaXNEZXRhY2hhYmxlKCkpIHsKICAg\nICAgICAgICAgICAgIHNtLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAgICAgICAg\nICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgaWYgKHN0YXRlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9\nIF9jYWxsOwogICAgICAgIC8vIE1ha2Ugc3VyZSBBTEwgZW50aXRpZXMgYXJl\nIGRldGFjaGVkLCBldmVuIG5ldyBvbmVzIHRoYXQgYXJlIGxvYWRlZAogICAg\nICAgIC8vIGR1cmluZyB0aGUgZGV0YWNoIHByb2Nlc3NpbmcKICAgICAgICBi\nb29sZWFuIG9yaWdDYXNjYWRlID0gX2NvbXBhdC5nZXRDYXNjYWRlV2l0aERl\ndGFjaCgpOwogICAgICAgIF9jb21wYXQuc2V0Q2FzY2FkZVdpdGhEZXRhY2go\ndHJ1ZSk7ICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBuZXcg\nRGV0YWNoTWFuYWdlcih0aGlzLCB0cnVlLCBjYWxsKQogICAgICAgICAgICAg\nICAgLmRldGFjaEFsbChuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oc3Rh\ndGVzKSk7CiAgICAgICAgfSAKICAgICAgICBmaW5hbGx5IHsKICAgICAgICAg\nICAgX2NvbXBhdC5zZXRDYXNjYWRlV2l0aERldGFjaChvcmlnQ2FzY2FkZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgYXR0YWNoKE9i\namVjdCBvYmosIGJvb2xlYW4gY29weU5ldywgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBub3QgdG8gdHJ5IHRv\nIHNldCByb2xsYmFjayBvbmx5IGlmIHRoaXMgZmFpbHMKICAgICAgICAgICAg\nYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNoTWFuYWdlcih0aGlzLCBj\nb3B5TmV3LCBjYWxsKS5hdHRhY2gob2JqKTsKICAgICAgICAgICAgfSBjYXRj\naCAoT3B0aW1pc3RpY0V4Y2VwdGlvbiBvZSkgewogICAgICAgICAgICAgICAg\nc2V0Um9sbGJhY2tPbmx5KG9lKTsKICAgICAgICAgICAgICAgIHRocm93IG9l\nLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIE9iamVjdFtdIGF0dGFjaEFsbChDb2xsZWN0aW9uIG9ianMsIGJv\nb2xlYW4gY29weU5ldywKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgaWYgKG9ianMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gRU1QVFlfT0JKRUNUUzsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIG5vdCB0byB0cnkgdG8gc2V0IHJvbGxiYWNrIG9ubHkgaWYgdGhpcyBmYWls\ncwogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2hN\nYW5hZ2VyKHRoaXMsIGNvcHlOZXcsIGNhbGwpLmF0dGFjaEFsbChvYmpzKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoT3B0aW1pc3RpY0V4Y2VwdGlvbiBvZSkg\newogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG9lKTsKICAgICAg\nICAgICAgICAgIHRocm93IG9lLnNldEZhdGFsKHRydWUpOwogICAgICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9udHJhbnNhY3Rpb25h\nbEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0gbnVsbDsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIG5vbnRyYW5zYWN0aW9uYWwoaXRyLm5leHQoKSwg\nY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9u\nIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9udHJhbnNh\nY3Rpb25hbChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX05PTlRSQU5TQUNUSU9OQUwsIG9iaiwgc20s\nIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4p\nID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlm\nIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgc20ubm9udHJhbnNhY3Rp\nb25hbCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gaW5zdGFuY2VzIHRyYW5zYWN0aW9u\nYWwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRyYW5zYWN0aW9uYWxBbGwo\nQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIHVwZGF0ZVZlcnNpb24sCiAgICAg\nICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNp\nemUoKSA9PSAxKSB7CiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwob2Jqcy5p\ndGVyYXRvcigpLm5leHQoKSwgdXBkYXRlVmVyc2lvbiwgY2FsbCk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbGxl\nY3QgYWxsIGhvbGxvdyBpbnN0YW5jZXMgZm9yIGxvYWQsIGFuZCBtYWtlIHVu\nbWFuYW5nZWQKICAgICAgICAgICAgLy8gaW5zdGFuY2VzIHRyYW5zaWVudC10\ncmFuc2FjdGlvbmFsCiAgICAgICAgICAgIENvbGxlY3Rpb248T3BlbkpQQVN0\nYXRlTWFuYWdlcj4gbG9hZCA9IG51bGw7CiAgICAgICAgICAgIE9iamVjdCBv\nYmo7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICAgICAgQ29sbGVjdGlv\nbjxTdGF0ZU1hbmFnZXJJbXBsPiBzbXMgPSBuZXcgTGlua2VkSGFzaFNldDxT\ndGF0ZU1hbmFnZXJJbXBsPihvYmpzLnNpemUoKSk7CiAgICAgICAgICAgIExp\nc3Q8RXhjZXB0aW9uPiBleGNlcHMgPSBudWxsOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yPD8+IGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVu\ndChPcENhbGxiYWNrcy5PUF9UUkFOU0FDVElPTkFMLCBvYmosIHNtLAogICAg\nICAgICAgICAgICAgICAgICAgICBjYWxsKSAmIE9wQ2FsbGJhY2tzLkFDVF9S\nVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBtYW5hZ2UgdHJhbnNpZW50IGluc3RhbmNl\nCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEgPSBfY29uZi5nZXRNZXRh\nRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZ2V0TWV0YURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIs\nIHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc20gPSBuZXcgU3Rh\ndGVNYW5hZ2VySW1wbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKFN0\nYXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpLCBtZXRhLCB0aGlzKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShhc3NlcnRQ\nZXJzaXN0ZW5jZUNhcGFibGUob2JqKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIFBDU3RhdGUuVENMRUFOKTsKICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgaWYgKHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtcy5hZGQoc20pOwogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuSE9MTE9X\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBu\nZXcgQXJyYXlMaXN0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+KCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNl\ndENoZWNrVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHVwZGF0ZVZlcnNpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBzbS5zZXRVcGRhdGVWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAg\nICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSF9SRVFVSVJFRDsgLy8gdmVy\nc2lvbiBjaGVjay91cAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChVc2VyRXhjZXB0aW9u\nIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBsb2FkIGFsbCBob2xsb3cgaW5zdGFuY2VzCiAgICAgICAg\nICAgIENvbGxlY3Rpb248T2JqZWN0PiBmYWlsZWQgPSBudWxsOwogICAgICAg\nICAgICBpZiAobG9hZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmYWls\nZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLCBTdG9yZU1hbmFnZXIu\nRk9SQ0VfTE9BRF9OT05FLAogICAgICAgICAgICAgICAgICAgIF9mYywgbnVs\nbCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZh\naWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2VwcywKICAgICAgICAgICAgICAgICAgICAgICAgbmV3T2JqZWN0\nTm90Rm91bmRFeGNlcHRpb24oZmFpbGVkKSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHRyYW5zYWN0aW9uYWxTdGF0ZXNBbGwoc21zLCBmYWlsZWQs\nIGV4Y2Vwcyk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYWtlIHRoZSBnaXZlbiBpbnN0YW5jZXMgdHJhbnNhY3Rp\nb25hbC4KICAgICAqLwogICAgcHVibGljIHZvaWQgdHJhbnNhY3Rpb25hbChP\nYmplY3Qgb2JqLCBib29sZWFuIHVwZGF0ZVZlcnNpb24sCiAgICAgICAgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAg\nICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9UUkFO\nU0FDVElPTkFMLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBP\ncENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uaXNQZXJz\naXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5z\nYWN0aW9uKCk7CiAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7\nCiAgICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1w\nbC5MT0FEX0ZHUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgc20uc2V0Q2hlY2tWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAg\naWYgKHVwZGF0ZVZlcnNpb24pCiAgICAgICAgICAgICAgICAgICAgc20uc2V0\nVXBkYXRlVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgIF9mbGFncyB8\nPSBGTEFHX0ZMVVNIX1JFUVVJUkVEOyAvLyB2ZXJzaW9uIGNoZWNrL3VwCiAg\nICAgICAgICAgIH0gZWxzZSBpZiAoc20gPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgLy8gbWFuYWdlIHRyYW5zaWVudCBpbnN0YW5jZQogICAgICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgICAgICBnZXRN\nZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICBPYmplY3QgaWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0\nYW5jZSh0aGlzKTsKICAgICAgICAgICAgICAgIHNtID0gbmV3IFN0YXRlTWFu\nYWdlckltcGwoaWQsIG1ldGEsIHRoaXMpOwogICAgICAgICAgICAgICAgc20u\naW5pdGlhbGl6ZShhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKSwKICAg\nICAgICAgICAgICAgICAgICBQQ1N0YXRlLlRDTEVBTik7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogVHJhbnNpdGlvbiB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdl\ncnMgdG8gdHJhbnNhY3Rpb25hbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHRyYW5zYWN0aW9uYWxTdGF0ZXNBbGwoQ29sbGVjdGlvbiBzbXMsIENvbGxl\nY3Rpb24gZmFpbGVkLAogICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMp\nIHsKICAgICAgICAvLyBtYWtlIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsIGFu\nZCBtYWtlIHN1cmUgdGhleSBhcmUgbG9hZGVkCiAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IHNt\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBz\nbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRhaW5zKHNtLmdl\ndElkKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25hbCgpOwog\nICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwu\nTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZh\nbHNlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRXh0\nZW50LCBRdWVyeQogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMg\nRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNz\nZXMpIHsKICAgICAgICByZXR1cm4gbmV3RXh0ZW50KHR5cGUsIHN1YmNsYXNz\nZXMsIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgRXh0ZW50IG5ld0V4dGVu\ndChDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAgICAgRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgRXh0ZW50SW1w\nbCBleHRlbnQgPSBuZXcgRXh0ZW50SW1wbCh0aGlzLCB0eXBlLCBzdWJjbGFz\nc2VzLCBmZXRjaCk7CiAgICAgICAgICAgIGlmIChfZXh0ZW50cyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgX2V4dGVudHMgPSBuZXcgUmVmZXJlbmNlSGFz\naFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwogICAgICAgICAgICBfZXh0\nZW50cy5hZGQoZXh0ZW50KTsKCiAgICAgICAgICAgIHJldHVybiBleHRlbnQ7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEl0\nZXJhdG9yIGV4dGVudEl0ZXJhdG9yKENsYXNzIHR5cGUsIGJvb2xlYW4gc3Vi\nY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJv\nb2xlYW4gaWdub3JlQ2hhbmdlcykgewogICAgICAgIEV4dGVudCBleHRlbnQg\nPSBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3NlcywgZmV0Y2gpOwogICAgICAg\nIGV4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKGlnbm9yZUNoYW5nZXMpOwogICAg\nICAgIHJldHVybiBleHRlbnQuaXRlcmF0b3IoKTsKICAgIH0KCiAgICBwdWJs\naWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIENsYXNzIGNscywgT2Jq\nZWN0IHF1ZXJ5KSB7CiAgICAgICAgUXVlcnkgcSA9IG5ld1F1ZXJ5KGxhbmcs\nIHF1ZXJ5KTsKICAgICAgICBxLnNldENhbmRpZGF0ZVR5cGUoY2xzLCB0cnVl\nKTsKICAgICAgICByZXR1cm4gcTsKICAgIH0KCiAgICBwdWJsaWMgUXVlcnkg\nbmV3UXVlcnkoU3RyaW5nIGxhbmcsIE9iamVjdCBxdWVyeSkgewogICAgICAg\nIC8vIGNvbW1vbiBtaXN0YWtlcwogICAgICAgIGlmIChxdWVyeSBpbnN0YW5j\nZW9mIEV4dGVudCB8fCBxdWVyeSBpbnN0YW5jZW9mIENsYXNzKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW5l\ndy1xdWVyeSIpKTsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0b3JlUXVlcnkgc3EgPSBfc3Rv\ncmUubmV3UXVlcnkobGFuZyk7CiAgICAgICAgICAgIGlmIChzcSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBFeHByZXNzaW9uUGFyc2VyIGVwID0gUXVl\ncnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZyk7CiAgICAgICAg\nICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBz\ncSA9IG5ldyBFeHByZXNzaW9uU3RvcmVRdWVyeShlcCk7CiAgICAgICAgICAg\nICAgICBlbHNlIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX01FVEhPRFFMLmVx\ndWFscyhsYW5nKSkKICAgICAgICAgICAgICAgICAgICBzcSA9IG5ldyBNZXRo\nb2RTdG9yZVF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKGxh\nbmcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBRdWVyeSBxID0gbmV3\nUXVlcnlJbXBsKGxhbmcsIHNxKTsKICAgICAgICAgICAgcS5zZXRJZ25vcmVD\naGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAgICAgICAgaWYgKHF1ZXJ5\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBxLnNldFF1ZXJ5KHF1ZXJ5KTsK\nCiAgICAgICAgICAgIC8vIHRyYWNrIHF1ZXJpZXMKICAgICAgICAgICAgaWYg\nKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgICAgICBfcXVlcmllcyA9\nIG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7\nCiAgICAgICAgICAgIF9xdWVyaWVzLmFkZChxKTsKICAgICAgICAgICAgcmV0\ndXJuIHE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBRdWVyeUltcGwgbmV3UXVlcnlJbXBsKFN0cmluZyBsYW5nLCBTdG9y\nZVF1ZXJ5IHNxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUltcGwodGhp\ncywgbGFuZywgc3EpOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0SWRlbnRp\ndHlTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAo\nbWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICByZXR1cm4gZ2V0U2VxdWVuY2UobWV0YSwgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UoZm1kLmdldERl\nZmluaW5nTWV0YURhdGEoKSwgZm1kKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIHNlcXVlbmNlIGZvciB0aGUgZ2l2ZW4gY2xhc3MgYW5kIG9w\ndGlvbmFsIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIFNlcSBnZXRTZXF1\nZW5jZShDbGFzc01ldGFEYXRhIG1ldGEsIEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgLy8gZ2V0IHNlcXVlbmNlIHN0cmF0ZWd5IGZyb20gbWV0YWRh\ndGEKICAgICAgICBpbnQgc3RyYXRlZ3k7CiAgICAgICAgaWYgKGZtZCA9PSBu\ndWxsKQogICAgICAgICAgICBzdHJhdGVneSA9IG1ldGEuZ2V0SWRlbnRpdHlT\ndHJhdGVneSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RyYXRlZ3kg\nPSBmbWQuZ2V0VmFsdWVTdHJhdGVneSgpOwoKICAgICAgICAvLyB3ZSBjYW4g\naGFuZGxlIG5vbi1uYXRpdmUgc3RyYXRlZ2llcyB3aXRob3V0IHRoZSBzdG9y\nZSBtYW5hZ2VyCiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkgewogICAgICAg\nICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDoKICAgICAgICAg\nICAgICAgIHJldHVybiBVVUlESGV4U2VxLmdldEluc3RhbmNlKCk7CiAgICAg\nICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RSSU5HOgogICAg\nICAgICAgICAgICAgcmV0dXJuIFVVSURTdHJpbmdTZXEuZ2V0SW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9UWVBF\nNF9IRVg6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJRFR5cGU0SGV4U2Vx\nLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVn\naWVzLlVVSURfVFlQRTRfU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJu\nIFVVSURUeXBlNFN0cmluZ1NlcS5nZXRJbnN0YW5jZSgpOwogICAgICAgICAg\nICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRToKICAgICAgICAgICAg\nICAgIFNlcXVlbmNlTWV0YURhdGEgc21kID0gKGZtZCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgID8gbWV0YS5nZXRJZGVudGl0eVNlcXVlbmNlTWV0\nYURhdGEoKQogICAgICAgICAgICAgICAgICAgIDogZm1kLmdldFZhbHVlU2Vx\ndWVuY2VNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHNtZC5n\nZXRJbnN0YW5jZShfbG9hZGVyKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIC8vIHVzZSBzdG9yZSBtYW5hZ2VyIGZvciBuYXRpdmUg\nc2VxdWVuY2UKICAgICAgICAgICAgICAgIGlmIChmbWQgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gYSBzZXF1\nZW5jZSBldmVuIGZvciBhcHAgaWQgY2xhc3NlcywKICAgICAgICAgICAgICAg\nICAgICAvLyB3aGljaCBpcyB3aGF0IHdlIHdhbnQgZm9yIGJhY2t3YXJkcy1j\nb21wYXRpYmlsaXR5LgogICAgICAgICAgICAgICAgICAgIC8vIEV2ZW4gaWYg\ndXNlciB1c2VzIEFwcGxpY2F0aW9uIElkZW50aXR5LAogICAgICAgICAgICAg\nICAgICAgIC8vIHVzZXIgbWlnaHQgdXNlIGN1c3RvbSBzZXF1ZW5jZSBpbmZv\ncm1hdGlvbi4KICAgICAgICAgICAgICAgICAgICAvLyBTbywgZmlyc3QsIHRo\nZSBzZXF1ZW5jZSBzaG91bGQgYmUgY2hlY2tlZC4KICAgICAgICAgICAgICAg\nICAgICAvLyBUcnlpbmcgdG8gZ2V0IHByaW1hcnkga2V5IGZpZWxkIGlmIGl0\nIGhhcwogICAgICAgICAgICAgICAgICAgIC8vIHNlcXVlbmNlIG1ldGEgZGF0\nYS4KICAgICAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0g\nbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKHBrcyAhPSBudWxsICYmIHBrcy5sZW5ndGggPT0gMSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBzbWQgPSBwa3NbMF0uZ2V0VmFsdWVTZXF1\nZW5jZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgc21kID0gbWV0YS5nZXRJZGVudGl0\neVNlcXVlbmNlTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgICAgIGlmIChzbWQgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gc21kLmdldEluc3RhbmNlKF9sb2Fk\nZXIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0RGF0YVN0b3JlSWRTZXF1\nZW5jZShtZXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdldFZhbHVl\nU2VxdWVuY2UoZm1kKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8KICAgIC8vIExvY2tpbmcKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIHZvaWQgbG9jayhPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMg\nb3IgbG9jayBsZXZlbCBhbHdheXMgTk9ORQogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGxvY2sob2JqLCBfZmMuZ2V0V3JpdGVMb2NrTGV2ZWwoKSwgX2Zj\nLmdldExvY2tUaW1lb3V0KCksIGNhbGwpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9iamVjdCBvYmosIGludCBsZXZlbCwg\naW50IHRpbWVvdXQsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1\nZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJh\nY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAm\nIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsIHx8ICFzbS5pc1Bl\ncnNpc3RlbnQoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nICAgIF9sbS5sb2NrKHNtLCBsZXZlbCwgdGltZW91dCwgbnVsbCk7CiAgICAg\nICAgICAgIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsgLy8gdXNlIHNh\nbWUgbGV2ZWwgZm9yIGZ1dHVyZSB3cml0ZQogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2tBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMu\naXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMgb3IgbG9jayBsZXZl\nbCBhbHdheXMgTk9ORQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvY2tB\nbGwob2JqcywgX2ZjLmdldFdyaXRlTG9ja0xldmVsKCksIF9mYy5nZXRMb2Nr\nVGltZW91dCgpLAogICAgICAgICAgICAgICAgY2FsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2tBbGwoQ29sbGVjdGlvbiBv\nYmpzLCBpbnQgbGV2ZWwsIGludCB0aW1lb3V0LAogICAgICAgIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXplKCkgPT0gMSkg\newogICAgICAgICAgICBsb2NrKG9ianMuaXRlcmF0b3IoKS5uZXh0KCksIGxl\ndmVsLCB0aW1lb3V0LCBjYWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsK\nCiAgICAgICAgICAgIENvbGxlY3Rpb248U3RhdGVNYW5hZ2VySW1wbD4gc21z\nID0gbmV3IExpbmtlZEhhc2hTZXQ8U3RhdGVNYW5hZ2VySW1wbD4ob2Jqcy5z\naXplKCkpOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nPD8+IGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NB\ncmd1bWVudChPcENhbGxiYWNrcy5PUF9MT0NLLCBvYmosIHNtLCBjYWxsKQog\nICAgICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0g\nMCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmlzUGVyc2lzdGVudCgpKQogICAg\nICAgICAgICAgICAgICAgIHNtcy5hZGQoc20pOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBfbG0ubG9ja0FsbChzbXMsIGxldmVsLCB0aW1lb3V0LCBu\ndWxsKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxTdGF0ZU1hbmFnZXJJ\nbXBsPiBpdHIgPSBzbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAg\nICAgICAgICAgICAgICBpdHIubmV4dCgpLnJlYWRMb2NrZWQobGV2ZWwsIGxl\ndmVsKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vLwogICAgLy8gQ29ubmVjdGlvbgogICAgLy8vLy8vLy8vLy8v\nLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5jZWxBbGwoKSB7CiAgICAgICAg\nLy8gdGhpcyBtZXRob2QgZG9lcyBub3QgbG9jaywgc2luY2Ugd2Ugd2FudCB0\nbyBhbGxvdyBhIGRpZmZlcmVudAogICAgICAgIC8vIHRocmVhZCB0byBiZSBh\nYmxlIHRvIGNhbmNlbCBvbiBhIGxvY2tlZC11cCBwZXJzaXN0ZW5jZSBtYW5h\nZ2VyCgogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyBpZiB3ZSdyZSBmbHVzaGluZywgaGF2ZSB0byBzZXQgcm9s\nbGJhY2sgb25seSAtLSBkbyB0aGlzIGJlZm9yZSB3ZQogICAgICAgICAgICAv\nLyBhdHRlbXB0IHRvIGNhbmNlbCwgYmVjYXVzZSBvdGhlcndpc2UgdGhlIGNh\nbmNlbCBtaWdodCBjYXNlIHRoZQogICAgICAgICAgICAvLyB0cmFuc2FjdGlv\nbiB0byBjb21wbGV0ZSBiZWZvcmUgd2UgaGF2ZSBhIGNoYW5jZSB0byBzZXQg\ndGhlCiAgICAgICAgICAgIC8vIHJvbGxiYWNrIG9ubHkgZmxhZwogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfRkxVU0hJTkcpICE9IDAp\nCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChuZXcg\nVXNlckV4Y2VwdGlvbigpKTsKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5j\nYW5jZWxBbGwoKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2gg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFN0b3JlRXhjZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBnZXRDb25uZWN0aW9uKCkgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBpZiAoIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5j\nb250YWlucwogICAgICAgICAgICAoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BU\nSU9OX0RBVEFTVE9SRV9DT05ORUNUSU9OKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJjb25uLW5vdC1z\ndXBwb3J0ZWQiKSk7CgogICAgICAgIHJldHVybiBfc3RvcmUuZ2V0Q2xpZW50\nQ29ubmVjdGlvbigpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0Nv\nbm5lY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgRkxBR19SRVRBSU5FRF9DT05OKSAhPSAwOwogICAg\nfQoKICAgIC8qKgogICAgICogVGVsbCBzdG9yZSB0byByZXRhaW4gY29ubmVj\ndGlvbiBpZiB3ZSBoYXZlbid0IGFscmVhZHkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCByZXRhaW5Db25uZWN0aW9uKCkgewogICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19SRVRBSU5FRF9DT05OKSA9PSAwKSB7CiAgICAgICAgICAg\nIF9zdG9yZS5yZXRhaW5Db25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9mbGFn\ncyB8PSBGTEFHX1JFVEFJTkVEX0NPTk47CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogVGVsbCBzdG9yZSB0byByZWxlYXNlIGNvbm5lY3Rpb24g\naWYgd2UgaGF2ZSByZXRhaW5lZCBvbmUuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCByZWxlYXNlQ29ubmVjdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfUkVUQUlORURfQ09OTikgIT0gMCkgewogICAgICAgICAgICBf\nc3RvcmUucmVsZWFzZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX1JFVEFJTkVEX0NPTk47CiAgICAgICAgfQogICAgfQoKICAg\nIC8vLy8vLy8vLwogICAgLy8gQ2FjaGUKICAgIC8vLy8vLy8vLwoKICAgIHB1\nYmxpYyBDb2xsZWN0aW9uIGdldE1hbmFnZWRPYmplY3RzKCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdldE1h\nbmFnZWRTdGF0ZXMoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBDb2xsZWN0aW9uIGdldFRyYW5zYWN0aW9uYWxPYmplY3RzKCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdl\ndFRyYW5zYWN0aW9uYWxTdGF0ZXMoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFBlbmRpbmdUcmFuc2FjdGlvbmFs\nT2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2Jq\nZWN0Q29sbGVjdGlvbgogICAgICAgICAgICAgICAgKGdldFBlbmRpbmdUcmFu\nc2FjdGlvbmFsU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgQ29sbGVjdGlvbiBnZXREaXJ0eU9iamVjdHMoKSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0RGly\ndHlTdGF0ZXMoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldE9yZGVyRGlydHlPYmplY3RzKCkgewogICAgICAgIHJldHVy\nbiBfb3JkZXJEaXJ0eTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRPcmRl\nckRpcnR5T2JqZWN0cyhib29sZWFuIG9yZGVyKSB7CiAgICAgICAgX29yZGVy\nRGlydHkgPSBvcmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIGNvcHkgb2YgYWxsIG1hbmFnZWQgc3RhdGUgbWFuYWdlcnMuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldE1hbmFnZWRTdGF0ZXMoKSB7\nCiAgICAgICAgcmV0dXJuIF9jYWNoZS5jb3B5KCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCB0cmFuc2FjdGlvbmFsIHN0\nYXRlIG1hbmFnZXJzLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlv\nbjxTdGF0ZU1hbmFnZXJJbXBsPiBnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCkg\newogICAgICAgIGlmICghaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkKICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAg\nICByZXR1cm4gX3RyYW5zQ2FjaGUuY29weSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciBvciBub3QgdGhlcmUgYXJlIGFueSB0cmFuc2FjdGlv\nbmFsIG9iamVjdHMgaW4gdGhlIGN1cnJlbnQKICAgICAqIHBlcnNpc3RlbmNl\nIGNvbnRleHQuIElmIHRoZXJlIGFyZSBhbnkgaW5zdGFuY2VzIHdpdGggdW50\ncmFja2VkIHN0YXRlLAogICAgICogdGhpcyBtZXRob2Qgd2lsbCBjYXVzZSB0\naG9zZSBpbnN0YW5jZXMgdG8gYmUgc2Nhbm5lZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgewogICAg\nICAgIF9jYWNoZS5kaXJ0eUNoZWNrKCk7CiAgICAgICAgcmV0dXJuIF90cmFu\nc0NhY2hlICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYSBjb3B5IG9mIGFsbCBkaXJ0eSBzdGF0ZSBtYW5hZ2Vycy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0RGlydHlTdGF0ZXMoKSB7CiAg\nICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwoKICAgICAgICBy\nZXR1cm4gX3RyYW5zQ2FjaGUuY29weURpcnR5KCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBzdGF0ZSBtYW5hZ2VycyB3\naGljaCB3aWxsIGJlY29tZQogICAgICogdHJhbnNhY3Rpb25hbCB1cG9uIHRo\nZSBuZXh0IHRyYW5zYWN0aW9uLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29s\nbGVjdGlvbiBnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbFN0YXRlcygpIHsKICAg\nICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICByZXR1cm4gbmV3IExp\nbmtlZEhhc2hTZXQ8U3RhdGVNYW5hZ2VySW1wbD4oX3BlbmRpbmcpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBjYWNoZWQgU3RhdGVNYW5hZ2Vy\nIGZvciB0aGUgaW5zdGFuY2UgdGhhdCBoYWQgdGhlIGdpdmVuIG9pZC4KICAg\nICAqIFRoaXMgbWV0aG9kIG11c3Qgbm90IGJlIGNhbGxlZCBtdWx0aXBsZSB0\naW1lcyBmb3IgbmV3IGluc3RhbmNlcy4KICAgICAqCiAgICAgKiBAcGFyYW0g\naWQgdGhlIGlkIHByZXZpb3VzbHkgdXNlZCBieSB0aGUgaW5zdGFuY2UKICAg\nICAqIEBwYXJhbSBzbSB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGluc3Rh\nbmNlOyBpZiB0aGUgc3RhdGUKICAgICAqIG1hbmFnZXIgaXMgdHJhbnNpZW50\nLCB3ZSdsbCBzdG9wIG1hbmFnaW5nIHRoZSBpbnN0YW5jZTsKICAgICAqIGlm\nIGl0IGhhcyB1cGRhdGVkIGl0cyBvaWQsIHdlJ2xsIHJlLWNhY2hlIHVuZGVy\nIHRoZSBuZXcgb2lkCiAgICAgKiBAcGFyYW0gc3RhdHVzIG9uZSBvZiBvdXIg\nU1RBVFVTIGNvbnN0YW50cyBkZXNjcmliaW5nIHdoeSB3ZSdyZQogICAgICog\nc2V0dGluZyB0aGUgc3RhdGUgbWFuYWdlcgogICAgICovCiAgICB2b2lkIHNl\ndFN0YXRlTWFuYWdlcihPYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20s\nIGludCBzdGF0dXMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICAgICAgICAg\nIGNhc2UgU1RBVFVTX0lOSVQ6CiAgICAgICAgICAgICAgICAgICAgX2NhY2hl\nLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFNUQVRVU19UUkFOU0lFTlQ6CiAgICAgICAgICAgICAg\nICAgICAgX2NhY2hlLnJlbW92ZShpZCwgc20pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfT0lEX0FT\nU0lHTjoKICAgICAgICAgICAgICAgICAgICBhc3NpZ25PYmplY3RJZChfY2Fj\naGUsIGlkLCBzbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFNUQVRVU19DT01NSVRfTkVXOgogICAgICAgICAg\nICAgICAgICAgIF9jYWNoZS5jb21taXROZXcoaWQsIHNtKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE5vdGlmeSB0aGUgYnJva2VyIHRoYXQgdGhlIGdpdmVuIHN0\nYXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSBhZGRlZCB0byB0aGUgc2V0\nIG9mIGluc3RhbmNlcyBpbnZvbHZlZCBpbiB0aGUgY3VycmVudCB0cmFuc2Fj\ndGlvbi4KICAgICAqLwogICAgdm9pZCBhZGRUb1RyYW5zYWN0aW9uKFN0YXRl\nTWFuYWdlckltcGwgc20pIHsKICAgICAgICAvLyB3ZSBvbmx5IGFkZCBjbGVh\nbiBpbnN0YW5jZXMgbm93OyBkaXJ0eSBpbnN0YW5jZXMgYXJlIGFkZGVkIGlu\nCiAgICAgICAgLy8gdGhlIHNldERpcnR5IGNhbGxiYWNrCiAgICAgICAgaWYg\nKHNtLmlzRGlydHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFoYXNUcmFu\nc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAgICAgICAgICAgX3RyYW5zQ2Fj\naGUgPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlKF9vcmRlckRpcnR5KTsKICAg\nICAgICAgICAgX3RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFu\nYWdlciB0aGF0IHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAg\nICogYmUgcmVtb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9s\ndmVkIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uLgogICAgICovCiAgICB2\nb2lkIHJlbW92ZUZyb21UcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmIChfdHJhbnNDYWNoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgLy8g\naW50ZW50aW9uYWwgZGlyZWN0IGFjY2Vzczsgd2UgZG9uJ3Qgd2FudCB0byBy\nZWNvbXB1dGUKICAgICAgICAgICAgICAgIC8vIGRpcnRpbmVzcyB3aGlsZSBy\nZW1vdmluZyBpbnN0YW5jZXMgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgICAg\nICAgICAgICAgIF90cmFuc0NhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgICAg\nIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsICYmICFzbS5pc1BlcnNpc3RlbnQo\nKSkKICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlLnJlbW92ZShzbSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogTm90aWZpY2F0aW9uIHRoYXQg\ndGhlIGdpdmVuIGluc3RhbmNlIGhhcyBiZWVuIGRpcnRpZWQuIFRoaXMKICAg\nICAqIG5vdGlmaWNhdGlvbiBpcyBnaXZlbiB3aGVuIGFuIG9iamVjdCBmaXJz\ndCB0cmFuc2l0aW9ucyB0byBhIGRpcnR5IHN0YXRlLAogICAgICogYW5kIGV2\nZXJ5IHRpbWUgdGhlIG9iamVjdCBpcyBtb2RpZmllZCBieSB0aGUgdXNlciB0\naGVyZWFmdGVyLgogICAgICovCiAgICB2b2lkIHNldERpcnR5KFN0YXRlTWFu\nYWdlckltcGwgc20sIGJvb2xlYW4gZmlyc3REaXJ0eSkgewogICAgICAgIGlm\nIChzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfRkxVU0hfUkVRVUlSRUQ7CgogICAgICAgIGlmIChfc2F2ZXBvaW50cyAh\nPSBudWxsICYmICFfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgaWYgKF9zYXZlcG9pbnRDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgX3NhdmVwb2ludENhY2hlID0gbmV3IEhhc2hTZXQ8U3RhdGVNYW5hZ2Vy\nSW1wbD4oKTsKICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmFkZChzbSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAoZmlyc3REaXJ0eSAmJiBzbS5pc1Ry\nYW5zYWN0aW9uYWwoKSkgewogICAgICAgICAgICBsb2NrKCk7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBjYWNoZSBkaXJ0eSBpbnN0\nYW5jZQogICAgICAgICAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2Jq\nZWN0cygpKQogICAgICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlID0gbmV3\nIFRyYW5zYWN0aW9uYWxDYWNoZShfb3JkZXJEaXJ0eSk7CiAgICAgICAgICAg\nICAgICBfdHJhbnNDYWNoZS5hZGREaXJ0eShzbSk7CgogICAgICAgICAgICAg\nICAgLy8gYWxzbyByZWNvcmQgdGhhdCB0aGUgY2xhc3MgaXMgZGlydHkKICAg\nICAgICAgICAgICAgIGlmIChzbS5pc05ldygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzID0gbmV3IEhhc2hTZXQ8Q2xh\nc3M8Pz4+KCk7CiAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3Mu\nYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoc20uaXNEZWxldGVkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoX2RlbGV0ZWRDbHNzID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9kZWxldGVkQ2xzcyA9IG5ldyBIYXNo\nU2V0PENsYXNzPD8+PigpOwogICAgICAgICAgICAgICAgICAgIF9kZWxldGVk\nQ2xzcy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkp\nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX3VwZGF0ZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIF91cGRhdGVkQ2xzcyA9IG5ldyBIYXNoU2V0PENsYXNzPD8+Pigp\nOwogICAgICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xzcy5hZGQoc20uZ2V0\nTWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIHRyYWNraW5nIGNoYW5nZXMg\nYW5kIHRoaXMgaW5zdGFuY2Ugd2Fzbid0IGFscmVhZHkgZGlydHksCiAgICAg\nICAgICAgICAgICAvLyBhZGQgdG8gY2hhbmdlZCBzZXQ7IHdlIHVzZSB0aGlz\nIGZvciBkZXRlY3RpbmcgaW5zdGFuY2VzIHRoYXQKICAgICAgICAgICAgICAg\nIC8vIGVudGVyIHRoZSB0cmFuc2FjdGlvbiBkdXJpbmcgcHJlIHN0b3JlCiAg\nICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykg\nIT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChfdHJhbnNBZGRpdGlv\nbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX3RyYW5zQWRk\naXRpb25zID0gbmV3IEhhc2hTZXQ8U3RhdGVNYW5hZ2VySW1wbD4oKTsKICAg\nICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMuYWRkKHNtKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogTm90aWZ5IHRoZSBicm9rZXIgdGhhdCB0\naGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAqIGJlIGFkZGVk\nIHRvIHRoZSBzZXQgb2YgaW5zdGFuY2VzIHRoYXQgd2lsbCBiZWNvbWUgdHJh\nbnNhY3Rpb25hbAogICAgICogb24gdGhlIG5leHQgdHJhbnNhY3Rpb24KICAg\nICAqLwogICAgdm9pZCBhZGRUb1BlbmRpbmdUcmFuc2FjdGlvbihTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChfcGVuZGluZyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgX3BlbmRpbmcgPSBuZXcgSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBs\nPigpOwogICAgICAgICAgICBfcGVuZGluZy5hZGQoc20pOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFu\nYWdlciB0aGF0IHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAg\nICogYmUgcmVtb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9s\ndmVkIGluIHRoZSBuZXh0IHRyYW5zYWN0aW9uLgogICAgICovCiAgICB2b2lk\nIHJlbW92ZUZyb21QZW5kaW5nVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoX3BlbmRpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9w\nZW5kaW5nLnJlbW92ZShzbSk7CiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNo\nZSAhPSBudWxsICYmICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAg\nICAgIF9kZXJlZkNhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmpl\nY3QgdG8gdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIncyBjYWNoZS4KICAgICAq\nIE9uIGZsdXNoLCB0aGVzZSBvYmplY3RzIHdpbGwgYmUgZGVsZXRlZC4KICAg\nICAqLwogICAgdm9pZCBhZGREZXJlZmVyZW5jZWREZXBlbmRlbnQoU3RhdGVN\nYW5hZ2VySW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBpZiB3ZSdyZSBpbiB0aGUgbWlkZGxlIG9mIGZs\ndXNoIGFuZCBpbnRyb2R1Y2luZyBtb3JlIGRlcmVmcwogICAgICAgICAgICAv\nLyB2aWEgaW5zdGFuY2UgY2FsbGJhY2tzLCBhZGQgdGhlbSB0byB0aGUgc3Bl\nY2lhbCBhZGRpdGlvbnMgc2V0CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19ERVJFRkRFTEVUSU5HKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBp\nZiAoX2RlcmVmQWRkaXRpb25zID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgX2RlcmVmQWRkaXRpb25zID0gbmV3IEhhc2hTZXQ8U3RhdGVNYW5hZ2Vy\nSW1wbD4oKTsKICAgICAgICAgICAgICAgIF9kZXJlZkFkZGl0aW9ucy5hZGQo\nc20pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYg\nKF9kZXJlZkNhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2Rl\ncmVmQ2FjaGUgPSBuZXcgSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBsPigpOwog\nICAgICAgICAgICAgICAgX2RlcmVmQ2FjaGUuYWRkKHNtKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIHRoZSBnaXZlbiBwcmV2aW91c2x5IGRlcmVmZXJlbmNlZCBkZXBlbmRl\nbnQgb2JqZWN0IGZyb20gdGhlCiAgICAgKiBjYWNoZS4gSXQgaXMgbm93IHJl\nZmVyZW5jZWQuCiAgICAgKi8KICAgIHZvaWQgcmVtb3ZlRGVyZWZlcmVuY2Vk\nRGVwZW5kZW50KFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVk\nID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChfZGVyZWZBZGRpdGlvbnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJlbW92ZWQgPSBfZGVyZWZBZGRpdGlv\nbnMucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKCFyZW1vdmVkICYmIChf\nZGVyZWZDYWNoZSA9PSBudWxsIHx8ICFfZGVyZWZDYWNoZS5yZW1vdmUoc20p\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1kZXJlZmVkIiwKICAgICAgICAgICAgICAg\nICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHNtLmdldE1hbmFnZWRJbnN0YW5j\nZSgpKSkpLgogICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChz\nbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkuCiAgICAgICAgICAgICAgICAgICAg\nc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGRpcnR5VHlwZShDbGFzcyBjbHMpIHsKICAgICAgICBpZiAoY2xzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdXBk\nYXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xz\ncyA9IG5ldyBIYXNoU2V0PENsYXNzPD8+PigpOwogICAgICAgICAgICBfdXBk\nYXRlZENsc3MuYWRkKGNscyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBDb2xsZWN0aW9uIGdldFBlcnNpc3RlZFR5cGVzKCkgewogICAgICAg\nIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBudWxsIHx8IF9wZXJzaXN0ZWRDbHNz\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVN\nUFRZX1NFVDsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlh\nYmxlQ29sbGVjdGlvbihfcGVyc2lzdGVkQ2xzcyk7CiAgICB9CgogICAgcHVi\nbGljIENvbGxlY3Rpb24gZ2V0VXBkYXRlZFR5cGVzKCkgewogICAgICAgIGlm\nIChfdXBkYXRlZENsc3MgPT0gbnVsbCB8fCBfdXBkYXRlZENsc3MuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VU\nOwogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xs\nZWN0aW9uKF91cGRhdGVkQ2xzcyk7CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gZ2V0RGVsZXRlZFR5cGVzKCkgewogICAgICAgIGlmIChfZGVsZXRl\nZENsc3MgPT0gbnVsbCB8fCBfZGVsZXRlZENsc3MuaXNFbXB0eSgpKQogICAg\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xsZWN0aW9uKF9k\nZWxldGVkQ2xzcyk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIENs\nb3NpbmcKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gaXND\nbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIF9jbG9zZWQ7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNDbG9zZUludm9rZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9jbG9zZWQgfHwgKF9mbGFncyAmIEZMQUdfQ0xPU0VfSU5WT0tFRCkg\nIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGNsb3NpbmcgaW4gYW4g\nYWN0aXZlIGxvY2FsIHRyYW5zCiAgICAgICAgICAgIGlmICghX21hbmFnZWQg\nJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgi\nYWN0aXZlIikpOwoKICAgICAgICAgICAgLy8gb25seSBjbG9zZSBpZiBub3Qg\nYWN0aXZlOyBpZiBhY3RpdmUgbWFuYWdlZCB0cmFucyB3YWl0CiAgICAgICAg\nICAgIC8vIGZvciBjb21wbGV0aW9uCiAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX0NMT1NFX0lOVk9LRUQ7CgogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAgICAgZnJlZSgpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZyZWUgdGhlIHJl\nc291cmNlcyB1c2VkIGJ5IHRoaXMgcGVyc2lzdGVuY2UgbWFuYWdlci4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZnJlZSgpIHsKICAgICAgICBSdW50\naW1lRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgaWYgKChfYXV0b0Rl\ndGFjaCAmIERFVEFDSF9DTE9TRSkgIT0gMCkgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwoX2NhbGwpOwog\nICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgICAgICBlcnIgPSByZTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgX3N5bmMgPSBudWxsOwogICAgICAgIF91c2VyT2JqZWN0\ncyA9IG51bGw7CiAgICAgICAgX2NhY2hlLmNsZWFyKCk7CiAgICAgICAgX3Ry\nYW5zQ2FjaGUgPSBudWxsOwogICAgICAgIF9wZXJzaXN0ZWRDbHNzID0gbnVs\nbDsKICAgICAgICBfdXBkYXRlZENsc3MgPSBudWxsOwogICAgICAgIF9kZWxl\ndGVkQ2xzcyA9IG51bGw7CiAgICAgICAgX2RlcmVmQ2FjaGUgPSBudWxsOwog\nICAgICAgIF9wZW5kaW5nID0gbnVsbDsKICAgICAgICBfbG9hZGVyID0gbnVs\nbDsKICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIgPSBudWxsOwogICAgICAg\nIF9saWZlRXZlbnRNYW5hZ2VyID0gbnVsbDsKCiAgICAgICAgT3BlbkpQQVNh\ndmVwb2ludCBzYXZlOwogICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cyAhPSBu\ndWxsICYmICFfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nc2F2ZSA9CiAgICAgICAgICAgICAgICAoT3BlbkpQQVNhdmVwb2ludCkgX3Nh\ndmVwb2ludHMucmVtb3ZlKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEpOwogICAg\nICAgICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgIH0KICAgICAg\nICBfc2F2ZXBvaW50cyA9IG51bGw7CiAgICAgICAgX3NhdmVwb2ludENhY2hl\nID0gbnVsbDsKCiAgICAgICAgaWYgKF9xdWVyaWVzICE9IG51bGwpIHsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBfcXVlcmllcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAoKFF1ZXJ5KSBpdHIubmV4dCgpKS5j\nbG9zZVJlc291cmNlcygpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIF9xdWVyaWVzID0gbnVsbDsKICAgICAgICB9\nCgogICAgICAgIGlmIChfZXh0ZW50cyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIEV4dGVudCBlOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9\nIF9leHRlbnRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBlID0gKEV4dGVudCkgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZS5jbG9zZUFsbCgp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nICAgIF9leHRlbnRzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHRyeSB7\nIHJlbGVhc2VDb25uZWN0aW9uKCk7IH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHt9CgogICAgICAgIF9sbS5jbG9zZSgpOwogICAgICAgIF9zdG9y\nZS5jbG9zZSgpOwogICAgICAgIF9mbGFncyA9IDA7CiAgICAgICAgX2Nsb3Nl\nZCA9IHRydWU7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgX2Nsb3NlZEV4Y2VwdGlvbiA9IG5ldyBJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oKTsKCiAgICAgICAgX2ZhY3RvcnkucmVsZWFzZUJyb2tl\ncih0aGlzKTsKCiAgICAgICAgaWYgKGVyciAhPSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBlcnI7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gU3luY2hyb25pemF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sg\nIT0gbnVsbCkgCiAgICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB1bmxvY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9\nIG51bGwpCiAgICAgICAgICAgIF9sb2NrLnVubG9jaygpOwogICAgfQogICAg\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU3RhdGUgbWFuYWdl\nbWVudAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2Jq\nZWN0IG5ld0luc3RhbmNlKENsYXNzIGNscykgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKCiAgICAgICAgaWYgKCFjbHMuaXNJbnRlcmZhY2UoKSAmJiBNb2Rp\nZmllci5pc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbihf\nbG9jLmdldAogICAgICAgICAgICAgICAgKCJuZXctYWJzdHJhY3QiLCBjbHMp\nLmdldE1lc3NhZ2UoKSk7CgogICAgICAgIC8vIDEuNSBkb2Vzbid0IGluaXRp\nYWxpemUgY2xhc3NlcyB3aXRob3V0IGEgdHJ1ZSBDbGFzcy5mb3JOYW1lCiAg\nICAgICAgaWYgKCFQQ1JlZ2lzdHJ5LmlzUmVnaXN0ZXJlZChjbHMpKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1l\nKGNscy5nZXROYW1lKCksIHRydWUsIAogICAgICAgICAgICAgICAgICAgIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihj\nbHMpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChfY29uZi5nZXRN\nZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLmdldE1ldGFEYXRhKGNscywK\nICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoKSwgZmFsc2UpID09IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24oCiAgICAgICAgICAgICAgICBfbG9jLmdldCgibm8taW50ZXJmYWNlLW1l\ndGFkYXRhIiwgY2xzLmdldE5hbWUoKSkuZ2V0TWVzc2FnZSgpKTsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIFBDUmVnaXN0cnkubmV3SW5z\ndGFuY2UoY2xzLCBudWxsLCBmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uIGlzZSkgewogICAgICAgICAgICBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24gaWFlID0KICAgICAgICAgICAgICAgIG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oaXNlLmdldE1lc3NhZ2UoKSk7CiAg\nICAgICAgICAgIGlhZS5zZXRTdGFja1RyYWNlKGlzZS5nZXRTdGFja1RyYWNl\nKCkpOwogICAgICAgICAgICB0aHJvdyBpYWU7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0SWQoT2JqZWN0IG9iaikgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5p\nc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVs\ncGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKQogICAgICAg\nICAgICAgICAgLnBjRmV0Y2hPYmplY3RJZCgpOwogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja0xldmVsKE9iamVj\ndCBvKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChvID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9O\nRTsKCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IGdldFN0YXRl\nTWFuYWdlcihvKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIExvY2tMZXZlbHMuTE9DS19OT05FOwogICAgICAgIHJldHVy\nbiBnZXRMb2NrTWFuYWdlcigpLmdldExvY2tMZXZlbChzbSk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBnZXRWZXJzaW9uKE9iamVjdCBvYmopIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNN\nYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNHZXRWZXJz\naW9uKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNEaXJ0eShPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\nYmopKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7CiAg\nICAgICAgICAgIHJldHVybiBwYy5wY0lzRGlydHkoKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzVHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\nYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0\nZW5jZUNhcGFibGUob2JqLCBfY29uZikpCiAgICAgICAgICAgICAgICAucGNJ\nc1RyYW5zYWN0aW9uYWwoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaXNQZXJzaXN0ZW50KE9iamVjdCBvYmop\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxw\nZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1w\nbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkuCiAg\nICAgICAgICAgICAgICAgICAgcGNJc1BlcnNpc3RlbnQoKTsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNOZXco\nT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBp\nZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAg\ncmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwg\nX2NvbmYpKS5wY0lzTmV3KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGVsZXRlZChPYmplY3Qgb2JqKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxI\nZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNE\nZWxldGVkKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzRGV0YWNoZWQoT2JqZWN0IG9iaikgewogICAgICAg\nIGlmICghKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBf\nY29uZik7CiAgICAgICAgQm9vbGVhbiBkZXRhY2hlZCA9IHBjLnBjSXNEZXRh\nY2hlZCgpOwogICAgICAgIGlmIChkZXRhY2hlZCAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZGV0YWNoZWQuYm9vbGVhblZhbHVlKCk7CgogICAgICAg\nIC8vIGxhc3QgcmVzb3J0OiBpbnN0YW5jZSBpcyBkZXRhY2hlZCBpZiBpdCBo\nYXMgYSBzdG9yZSByZWNvcmQKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEg\nPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAg\nICAgICAgICBnZXRNZXRhRGF0YShJbXBsSGVscGVyLmdldE1hbmFnZWRJbnN0\nYW5jZShwYykuZ2V0Q2xhc3MoKSwKICAgICAgICAgICAgICAgIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgIE9iamVjdCBvaWQgPSBBcHBsaWNhdGlvbklkcy5j\ncmVhdGUocGMsIG1ldGEpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBmaW5kKG9p\nZCwgbnVsbCwgRVhDTFVERV9BTEwsIG51bGwsIDApICE9IG51bGw7CiAgICB9\nCgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0U3RhdGVNYW5h\nZ2VyKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgcmV0dXJuIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1hbmFnZXIg\nZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSwgb3IgbnVsbC4KICAgICAqCiAgICAg\nKiBAcGFyYW0gYXNzZXJ0VGhpc0NvbnRleHQgaWYgdHJ1ZSwgdGhvdyBhbiBl\neGNlcHRpb24gaWYgdGhlIGdpdmVuCiAgICAgKiBvYmplY3QgaXMgbWFuYWdl\nZCBieSBhbm90aGVyIGJyb2tlcgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Rh\ndGVNYW5hZ2VySW1wbCBnZXRTdGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvYmos\nCiAgICAgICAgYm9vbGVhbiBhc3NlcnRUaGlzQ29udGV4dCkgewogICAgICAg\nIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKSB7CiAgICAgICAg\nICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJz\naXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7CiAgICAgICAgICAgIEJyb2tl\nckltcGwgcGNCcm9rZXIgPSAoQnJva2VySW1wbClwYy5wY0dldEdlbmVyaWND\nb250ZXh0KCk7CiAgICAgICAgICAgIGlmIChwY0Jyb2tlciA9PSB0aGlzIHx8\nIGlzRnJvbVdyaXRlQmVoaW5kQ2FsbGJhY2soKSkKICAgICAgICAgICAgICAg\nIHJldHVybiAoU3RhdGVNYW5hZ2VySW1wbCkgcGMucGNHZXRTdGF0ZU1hbmFn\nZXIoKTsKICAgICAgICAgICAgaWYgKGFzc2VydFRoaXNDb250ZXh0ICYmIHBj\nQnJva2VyICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1hbmFnZWQiLAogICAgICAgICAg\nICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLnNldEZhaWxl\nZE9iamVjdChvYmopOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc3RhdGUgbWFuYWdl\nciBmb3IgdGhlIGdpdmVuIG9pZC4KICAgICAqCiAgICAgKiBAcGFyYW0gYWxs\nb3dOZXcgaWYgdHJ1ZSwgb2JqZWN0cyBtYWRlIHBlcnNpc3RlbnQgaW4gdGhl\nIGN1cnJlbnQKICAgICAqIHRyYW5zYWN0aW9uIHdpbGwgYmUgaW5jbHVkZWQg\naW4gdGhlIHNlYXJjaDsgaWYKICAgICAqIG11bHRpcGxlIG5ldyBvYmplY3Rz\nIG1hdGNoIHRoZSBnaXZlbiBvaWQsIGl0IGlzCiAgICAgKiB1bmRlZmluZWQg\nd2hpY2ggd2lsbCBiZSByZXR1cm5lZAogICAgICovCiAgICBwcm90ZWN0ZWQg\nU3RhdGVNYW5hZ2VySW1wbCBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChPYmpl\nY3Qgb2lkLAogICAgICAgIGJvb2xlYW4gYWxsb3dOZXcpIHsKICAgICAgICBy\nZXR1cm4gX2NhY2hlLmdldEJ5SWQob2lkLCBhbGxvd05ldyk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGdpdmVuIGluc3RhbmNlIGFzIGEg\ne0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZX0uCiAgICAgKiBJZiB0aGUgaW5z\ndGFuY2UgaXMgbm90IG1hbmFnZWFibGUgdGhyb3cgdGhlIHByb3BlciBleGNl\ncHRpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNhcGFi\nbGUgYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKE9iamVjdCBvYmopIHsKICAg\nICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQog\nICAgICAgICAgICByZXR1cm4gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2Fw\nYWJsZShvYmosIF9jb25mKTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIGRpZmZl\ncmVudCBpbnN0YW5jZXMgb2YgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRl\ncmZhY2UKICAgICAgICAvLyBhbmQgdGhyb3cgYSBiZXR0ZXIgZXJyb3IgdGhh\ndCBtZW50aW9ucyB0aGUgY2xhc3MgbG9hZGVycwogICAgICAgIENsYXNzPD8+\nW10gaW50ZnMgPSBvYmouZ2V0Q2xhc3MoKS5nZXRJbnRlcmZhY2VzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGludGZzICE9IG51bGwgJiYgaSA8IGlu\ndGZzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpbnRmc1tpXS5n\nZXROYW1lKCkuZXF1YWxzKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5nZXRO\nYW1lKCkpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgicGMtbG9hZGVyLWRpZmZlcmVudCIsCiAgICAgICAg\nICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopLAogICAgICAg\nICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFz\nc0xvYWRlckFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBl\ncnNpc3RlbmNlQ2FwYWJsZS5jbGFzcykpLAogICAgICAgICAgICAgICAgICAg\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlv\nbihpbnRmc1tpXSkpKSkKICAgICAgICAgICAgICAgICAgICAuc2V0RmFpbGVk\nT2JqZWN0KG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIG5vdCBlbmhhbmNlZAogICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJwYy1jYXN0IiwKICAgICAgICAgICAgRXhjZXB0aW9u\ncy50b1N0cmluZyhvYmopKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICB9\nCgogICAgLy8vLy8vLy8vCiAgICAvLyBVdGlscwogICAgLy8vLy8vLy8vCiAg\nICAvKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlvbiBpZiB0aGUgY29udGV4\ndCBpcyBjbG9zZWQuICBUaGUgZXhhY3QgbWVzc2FnZSBhbmQKICAgICAqIGNv\nbnRlbnQgb2YgdGhlIGV4Y2VwdGlvbiB2YXJpZXMgd2hldGhlciBUUkFDRSBp\ncyBlbmFibGVkIG9yIG5vdC4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNz\nZXJ0T3BlbigpIHsKICAgICAgICBpZiAoX2Nsb3NlZCkgewogICAgICAgICAg\nICBpZiAoX2Nsb3NlZEV4Y2VwdGlvbiA9PSBudWxsKSAgLy8gVFJBQ0Ugbm90\nIGVuYWJsZWQKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQoImNsb3NlZC1ub3RyYWNlIikpCiAgICAg\nICAgICAgICAgICAgICAgICAgIC5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgICAgICBPcGVuSlBBRXhjZXB0aW9uIGUg\nPSBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgIF9sb2MuZ2V0KCJjbG9zZWQiKSwgX2Nsb3NlZEV4Y2VwdGlvbikuc2V0\nRmF0YWwodHJ1ZSk7CiAgICAgICAgICAgICAgICBlLnNldENhdXNlKF9jbG9z\nZWRFeGNlcHRpb24pOwogICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3Nl\ncnRBY3RpdmVUcmFuc2FjdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgTm9U\ncmFuc2FjdGlvbkV4Y2VwdGlvbihfbG9jLmdldCgibm90LWFjdGl2ZSIpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGV4Y2VwdGlvbiBpZiBhIHRy\nYW5zYWN0aW9uLXJlbGF0ZWQgb3BlcmF0aW9uIGlzIGF0dGVtcHRlZCBhbmQK\nICAgICAqIG5vIHRyYW5zYWN0aW9uIGlzIGFjdGl2ZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCkgewog\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vdC1hY3RpdmUiKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXNz\nZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKSB7CiAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCAmJiAhX25vbnRyYW5zUmVhZCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgibm9uLXRyYW5zLXJlYWQiKSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKSB7CiAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCAmJiAoIV9ub250cmFuc1dyaXRlCiAg\nICAgICAgICAgIHx8IChfYXV0b0RldGFjaCAmIERFVEFDSF9OT05UWFJFQUQp\nICE9IDApKQogICAgICAgICAgICB0aHJvdyBuZXcgTm9UcmFuc2FjdGlvbkV4\nY2VwdGlvbihfbG9jLmdldCgid3JpdGUtb3BlcmF0aW9uIikpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGFuIG9iamVjdCBub3QgZm91bmQgZXhj\nZXB0aW9uIGNvbnRhaW5pbmcgbmVzdGVkIGV4Y2VwdGlvbnMKICAgICAqIGZv\nciBhbGwgb2YgdGhlIGdpdmVuIGZhaWxlZCBvYmplY3RzLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbiBuZXdP\nYmplY3ROb3RGb3VuZEV4Y2VwdGlvbgogICAgICAgIChDb2xsZWN0aW9uIGZh\naWxlZCkgewogICAgICAgIFRocm93YWJsZVtdIHQgPSBuZXcgVGhyb3dhYmxl\nW2ZhaWxlZC5zaXplKCldOwogICAgICAgIGludCBpZHggPSAwOwogICAgICAg\nIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gZmFpbGVkLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7IGlkeCsrKQogICAgICAgICAgICB0W2lkeF0gPSBuZXcg\nT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oaXRyLm5leHQoKSk7CiAgICAgICAg\ncmV0dXJuIG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQsIHQp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBGaW5kQ2FsbGJhY2tzIGltcGxlbWVudGF0aW9uCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBPYmpl\nY3QgcHJvY2Vzc0FyZ3VtZW50KE9iamVjdCBvaWQpIHsKICAgICAgICByZXR1\ncm4gb2lkOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgcHJvY2Vzc1JldHVy\nbihPYmplY3Qgb2lkLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAg\nICAgcmV0dXJuIChzbSA9PSBudWxsKSA/IG51bGwgOiBzbS5nZXRNYW5hZ2Vk\nSW5zdGFuY2UoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVPYmpl\nY3QoT2JqZWN0T3V0cHV0U3RyZWFtIG91dCkgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChpc0FjdGl2ZSgpKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIWdldE9wdGltaXN0aWMoKSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKAogICAg\nICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiY2FudC1zZXJpYWxpemUt\ncGVzc2ltaXN0aWMtYnJva2VyIikpOwogICAgICAgICAgICAgICAgaWYgKGhh\nc0ZsdXNoZWQoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52\nYWxpZFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBf\nbG9jLmdldCgiY2FudC1zZXJpYWxpemUtZmx1c2hlZC1icm9rZXIiKSk7CiAg\nICAgICAgICAgICAgICBpZiAoaGFzQ29ubmVjdGlvbigpKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJjYW50LXNlcmlhbGl6\nZS1jb25uZWN0ZWQtYnJva2VyIikpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgX2lzU2VyaWFsaXppbmcgPSB0\ncnVlOwogICAgICAgICAgICAgICAgb3V0LndyaXRlT2JqZWN0KF9mYWN0b3J5\nLmdldFBvb2xLZXkoKSk7CiAgICAgICAgICAgICAgICBvdXQuZGVmYXVsdFdy\naXRlT2JqZWN0KCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICBfaXNTZXJpYWxpemluZyA9IGZhbHNlOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0KE9i\namVjdElucHV0U3RyZWFtIGluKQogICAgICAgIHRocm93cyBDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IGZh\nY3RvcnlLZXkgPSBpbi5yZWFkT2JqZWN0KCk7CiAgICAgICAgQWJzdHJhY3RC\ncm9rZXJGYWN0b3J5IGZhY3RvcnkgPQogICAgICAgICAgICBBYnN0cmFjdEJy\nb2tlckZhY3RvcnkuZ2V0UG9vbGVkRmFjdG9yeUZvcktleShmYWN0b3J5S2V5\nKTsKCiAgICAgICAgLy8gdGhpcyBuZWVkcyB0byBoYXBwZW4gYmVmb3JlIGRl\nZmF1bHRSZWFkT2JqZWN0IHNvIHRoYXQgaXQncwogICAgICAgIC8vIGF2YWls\nYWJsZSBmb3IgY2FsbHMgdG8gYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKSBk\ndXJpbmcKICAgICAgICAvLyBTdGF0ZU1hbmFnZXIgZGVzZXJpYWxpemF0aW9u\nCiAgICAgICAgX2NvbmYgPSBmYWN0b3J5LmdldENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICAKICAgICAgICBpbi5kZWZhdWx0UmVhZE9iamVjdCgpOwogICAg\nICAgIGZhY3RvcnkuaW5pdGlhbGl6ZUJyb2tlcihfbWFuYWdlZCwgX2Nvbm5S\nZXRhaW5Nb2RlLCB0aGlzLCB0cnVlKTsKCiAgICAgICAgLy8gcmUtaW5pdGlh\nbGl6ZSB0aGUgbG9jayBpZiBuZWVkZWQuCiAgICAgICAgc2V0TXVsdGl0aHJl\nYWRlZChfbXVsdGl0aHJlYWRlZCk7CgogICAgICAgIGlmIChpc0FjdGl2ZSgp\nICYmIF9ydW50aW1lIGluc3RhbmNlb2YgTG9jYWxNYW5hZ2VkUnVudGltZSkK\nICAgICAgICAgICAgKChMb2NhbE1hbmFnZWRSdW50aW1lKSBfcnVudGltZSku\nYmVnaW4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90\nIHRoaXMgYnJva2VyIGlzIGluIHRoZSBtaWRzdCBvZiBiZWluZyBzZXJpYWxp\nemVkLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMCAKICAgICAqLwogICAg\nYm9vbGVhbiBpc1NlcmlhbGl6aW5nKCkgewogICAgICAgIHJldHVybiBfaXNT\nZXJpYWxpemluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zYWN0aW9u\nYWwgY2FjaGUgdGhhdCBob2xkcyBzb2Z0IHJlZnMgdG8gY2xlYW4gaW5zdGFu\nY2VzLgogICAgICovCiAgICBzdGF0aWMgY2xhc3MgVHJhbnNhY3Rpb25hbENh\nY2hlCiAgICAgICAgaW1wbGVtZW50cyBTZXQsIFNlcmlhbGl6YWJsZSB7Cgog\nICAgICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfb3JkZXJEaXJ0eTsKICAg\nICAgICBwcml2YXRlIFNldDxTdGF0ZU1hbmFnZXJJbXBsPiBfZGlydHkgPSBu\ndWxsOwogICAgICAgIHByaXZhdGUgU2V0PFN0YXRlTWFuYWdlckltcGw+IF9j\nbGVhbiA9IG51bGw7CgogICAgICAgIHB1YmxpYyBUcmFuc2FjdGlvbmFsQ2Fj\naGUoYm9vbGVhbiBvcmRlckRpcnR5KSB7CiAgICAgICAgICAgIF9vcmRlckRp\ncnR5ID0gb3JkZXJEaXJ0eTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIHRyYW5zYWN0aW9uYWwgc3Rh\ndGUgbWFuYWdlcnMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENvbGxl\nY3Rpb24gY29weSgpIHsKICAgICAgICAgICAgaWYgKGlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7Cgog\nICAgICAgICAgICAvLyBzaXplIG1heSBub3QgYmUgZW50aXJlbHkgYWNjdXJh\ndGUgZHVlIHRvIHJlZnMgZXhwaXJpbmcsIHNvCiAgICAgICAgICAgIC8vIG1h\nbnVhbGx5IGNvcHkgZWFjaCBvYmplY3Q7IGRvZXNuJ3QgbWF0dGVyIHRoaXMg\nd2F5IGlmIHNpemUgdG9vCiAgICAgICAgICAgIC8vIGJpZyBieSBzb21lCiAg\nICAgICAgICAgIFNldCBjb3B5ID0gbmV3IExpbmtlZEhhc2hTZXQoc2l6ZSgp\nKTsKICAgICAgICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdHIgPSBf\nZGlydHkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAg\nICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlm\nIChfY2xlYW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3I8U3RhdGVNYW5hZ2VySW1wbD4gaXRyID0gX2NsZWFuLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgIGNvcHkuYWRk\nKGl0ci5uZXh0KCkpOwogICAgICAgICAgICByZXR1cm4gY29weTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiBhIGNvcHkgb2Yg\nYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJzLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHlEaXJ0eSgpIHsKICAgICAgICAgICAg\naWYgKF9kaXJ0eSA9PSBudWxsIHx8IF9kaXJ0eS5pc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAg\nICAgICAgICByZXR1cm4gbmV3IExpbmtlZEhhc2hTZXQ8U3RhdGVNYW5hZ2Vy\nSW1wbD4oX2RpcnR5KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIFRyYW5zZmVyIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHRoZSBkaXJ0\neSBjYWNoZSB0byB0aGUgY2xlYW4gY2FjaGUuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIHZvaWQgZmx1c2hlZChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7\nCiAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkgJiYgX2RpcnR5ICE9IG51\nbGwgJiYgX2RpcnR5LnJlbW92ZShzbSkpCiAgICAgICAgICAgICAgICBhZGRD\nbGVhbkludGVybmFsKHNtKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGNsZWFuIGNh\nY2hlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZENsZWFu\nKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKGFkZENs\nZWFuSW50ZXJuYWwoc20pICYmIF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2RpcnR5LnJlbW92ZShzbSk7CiAgICAgICAgfQoKICAgICAgICBw\ncml2YXRlIGJvb2xlYW4gYWRkQ2xlYW5JbnRlcm5hbChTdGF0ZU1hbmFnZXJJ\nbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChfY2xlYW4gPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9jbGVhbiA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJl\nZmVyZW5jZUhhc2hTZXQuU09GVCk7CiAgICAgICAgICAgIHJldHVybiBfY2xl\nYW4uYWRkKHNtKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGRpcnR5IGNhY2hlLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZERpcnR5KFN0YXRl\nTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKF9kaXJ0eSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX29yZGVyRGlydHkpCiAgICAg\nICAgICAgICAgICAgICAgX2RpcnR5ID0gTWFwQmFja2VkU2V0LmRlY29yYXRl\nKG5ldyBMaW5rZWRNYXAoKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgX2RpcnR5ID0gbmV3IEhhc2hTZXQ8U3RhdGVNYW5h\nZ2VySW1wbD4oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX2Rp\ncnR5LmFkZChzbSkpCiAgICAgICAgICAgICAgICByZW1vdmVDbGVhbkludGVy\nbmFsKHNtKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJl\nbW92ZSB0aGUgZ2l2ZW4gaW5zdGFuY2UgZnJvbSB0aGUgY2FjaGUuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKFN0YXRlTWFu\nYWdlckltcGwgc20pIHsKICAgICAgICAgICAgcmV0dXJuIHJlbW92ZUNsZWFu\nSW50ZXJuYWwoc20pCiAgICAgICAgICAgICAgICB8fCAoX2RpcnR5ICE9IG51\nbGwgJiYgX2RpcnR5LnJlbW92ZShzbSkpOwogICAgICAgIH0KCiAgICAgICAg\ncHJpdmF0ZSBib29sZWFuIHJlbW92ZUNsZWFuSW50ZXJuYWwoU3RhdGVNYW5h\nZ2VySW1wbCBzbSkgewogICAgICAgICAgICByZXR1cm4gX2NsZWFuICE9IG51\nbGwgJiYgX2NsZWFuLnJlbW92ZShzbSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSXRlcmF0b3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIEl0ZXJh\ndG9yQ2hhaW4gY2hhaW4gPSBuZXcgSXRlcmF0b3JDaGFpbigpOwogICAgICAg\nICAgICBpZiAoX2RpcnR5ICE9IG51bGwgJiYgIV9kaXJ0eS5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICBjaGFpbi5hZGRJdGVyYXRvcihfZGlydHkuaXRl\ncmF0b3IoKSk7CiAgICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCAmJiAh\nX2NsZWFuLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGNoYWluLmFkZEl0\nZXJhdG9yKF9jbGVhbi5pdGVyYXRvcigpKTsKICAgICAgICAgICAgcmV0dXJu\nIGNoYWluOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29u\ndGFpbnMoT2JqZWN0IG9iaikgewogICAgICAgICAgICByZXR1cm4gKF9kaXJ0\neSAhPSBudWxsICYmIF9kaXJ0eS5jb250YWlucyhvYmopKQogICAgICAgICAg\nICAgICAgfHwgKF9jbGVhbiAhPSBudWxsICYmIF9jbGVhbi5jb250YWlucyhv\nYmopKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRh\naW5zQWxsKENvbGxlY3Rpb24gY29sbCkgewogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yPD8+IGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspCiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5zKGl0ci5uZXh0KCkp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBjbGVhcigpIHsKICAgICAgICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2RpcnR5ID0gbnVsbDsKICAgICAgICAgICAgaWYg\nKF9jbGVhbiAhPSBudWxsKQogICAgICAgICAgICAgICAgX2NsZWFuID0gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHko\nKSB7CiAgICAgICAgICAgIHJldHVybiAoX2RpcnR5ID09IG51bGwgfHwgX2Rp\ncnR5LmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICYmIChfY2xlYW4gPT0g\nbnVsbCB8fCBfY2xlYW4uaXNFbXB0eSgpKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgaW50IHNpemUgPSAw\nOwogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBzaXplICs9IF9kaXJ0eS5zaXplKCk7CiAgICAgICAgICAgIGlmIChf\nY2xlYW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0gX2NsZWFu\nLnNpemUoKTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2JqZWN0IG9iaikgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFs\nbChDb2xsZWN0aW9uIGNvbGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoT2JqZWN0IG9iaikgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92\nZUFsbChDb2xsZWN0aW9uIGNvbGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiByZXRhaW5BbGwoQ29sbGVjdGlvbiBj\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlv\nbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVj\ndFtdIHRvQXJyYXkoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIE9iamVjdFtdIHRvQXJyYXkoT2JqZWN0W10gYXJyKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVuaXF1ZSBp\nZCBmb3Igc3RhdGUgbWFuYWdlcnMgb2YgbmV3IGRhdGFzdG9yZSBpbnN0YW5j\nZXMgd2l0aG91dCBhc3NpZ25lZAogICAgICogb2JqZWN0IGlkcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU3RhdGVNYW5hZ2VySWQKICAg\nICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgU3RyaW5nIFNUUklOR19QUkVGSVggPSAib3Blbmpw\nYXNtOiI7CgogICAgICAgIHByaXZhdGUgc3RhdGljIGxvbmcgX2dlbmVyYXRv\nciA9IDA7CgogICAgICAgIHByaXZhdGUgZmluYWwgaW50IF9iaGFzaDsKICAg\nICAgICBwcml2YXRlIGZpbmFsIGxvbmcgX2lkOwoKICAgICAgICBwdWJsaWMg\nc3RhdGljIFN0YXRlTWFuYWdlcklkIG5ld0luc3RhbmNlKEJyb2tlciBiKSB7\nCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2VySWQoU3lzdGVt\nLmlkZW50aXR5SGFzaENvZGUoYiksIF9nZW5lcmF0b3IrKyk7CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIFN0YXRlTWFuYWdlcklkKGludCBiaGFzaCwg\nbG9uZyBpZCkgewogICAgICAgICAgICBfYmhhc2ggPSBiaGFzaDsKICAgICAg\nICAgICAgX2lkID0gaWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Rh\ndGVNYW5hZ2VySWQoU3RyaW5nIHN0cikgewogICAgICAgICAgICBzdHIgPSBz\ndHIuc3Vic3RyaW5nKFNUUklOR19QUkVGSVgubGVuZ3RoKCkpOwogICAgICAg\nICAgICBpbnQgaWR4ID0gc3RyLmluZGV4T2YoJzonKTsKICAgICAgICAgICAg\nX2JoYXNoID0gSW50ZWdlci5wYXJzZUludChzdHIuc3Vic3RyaW5nKDAsIGlk\neCkpOwogICAgICAgICAgICBfaWQgPSBMb25nLnBhcnNlTG9uZyhzdHIuc3Vi\nc3RyaW5nKGlkeCArIDEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICAgICAgaWYg\nKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBTdGF0ZU1hbmFn\nZXJJZCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlcklkIHNpZCA9IChTdGF0ZU1hbmFnZXJJZCkgb3Ro\nZXI7CiAgICAgICAgICAgIHJldHVybiBfYmhhc2ggPT0gc2lkLl9iaGFzaCAm\nJiBfaWQgPT0gc2lkLl9pZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVybiAoaW50KSAoX2lk\nIF4gKF9pZCA+Pj4gMzIpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBTVFJJTkdf\nUFJFRklYICsgX2JoYXNoICsgIjoiICsgX2lkOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIENvbGxlY3Rpb24gdHlwZSB0aGF0IGhvbGRzIHN0\nYXRlIG1hbmFnZXJzIGJ1dCB3aG9zZSBpbnRlcmZhY2UgZGVhbHMKICAgICAq\nIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWFuYWdlZCBvYmplY3RzLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNYW5hZ2VkT2JqZWN0Q29s\nbGVjdGlvbgogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RDb2xsZWN0aW9uIHsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uIF9zdGF0ZXM7Cgog\nICAgICAgIHB1YmxpYyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihDb2xsZWN0\naW9uIHN0YXRlcykgewogICAgICAgICAgICBfc3RhdGVzID0gc3RhdGVzOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24gZ2V0U3RhdGVN\nYW5hZ2VycygpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZXM7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfc3RhdGVzLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBJdGVyYXRvcigpIHsKICAgICAgICAgICAgICAgIHByaXZhdGUgZmlu\nYWwgSXRlcmF0b3IgX2l0ciA9IF9zdGF0ZXMuaXRlcmF0b3IoKTsKCiAgICAg\nICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNOZXh0KCkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBfaXRyLmhhc05leHQoKTsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMgT2JqZWN0IG5leHQo\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoT3BlbkpQQVN0YXRl\nTWFuYWdlcikgX2l0ci5uZXh0KCkpLgogICAgICAgICAgICAgICAgICAgICAg\nICBnZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCByZW1vdmUoKSB7CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQXNzaWduIHRoZSBvYmplY3QgaWQgdG8g\ndGhlIGNhY2hlLiBFeGNlcHRpb24gd2lsbCBiZQogICAgICogdGhyb3duIGlm\nIHRoZSBpZCBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgY2FjaGUuIAogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBhc3NpZ25PYmplY3RJZChPYmplY3QgY2Fj\naGUsIE9iamVjdCBpZCwgCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgICgoTWFuYWdlZENhY2hlKSBjYWNoZSkuYXNzaWduT2JqZWN0\nSWQoaWQsIHNtKTsgCiAgICB9CgogICAgLyoqIAogICAgICogVGhpcyBtZXRo\nb2QgbWFrZXMgc3VyZSB3ZSBkb24ndCBhbHJlYWR5IGhhdmUgdGhlIGluc3Rh\nbmNlIGNhY2hlZAogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjaGVja0Zv\nckR1cGxpY2F0ZUlkKE9iamVjdCBpZCwgT2JqZWN0IG9iaikgewogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgb3RoZXIgPSBnZXRTdGF0ZU1hbmFnZXJJbXBs\nQnlJZChpZCwgZmFsc2UpOwogICAgICAgIGlmIChvdGhlciAhPSBudWxsICYm\nICFvdGhlci5pc0RlbGV0ZWQoKSAmJiAhb3RoZXIuaXNOZXcoKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdl\ndCgiY2FjaGUtZXhpc3RzIiwKICAgICAgICAgICAgICAgIG9iai5nZXRDbGFz\ncygpLmdldE5hbWUoKSwgaWQpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAg\nIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gZ2V0Q2FjaGVQcmVwYXJlZFF1\nZXJ5KCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gX2NhY2hlUHJlcGFyZWRRdWVyeSAKICAgICAgICAgICAg\nICAgJiYgX2NvbmYuZ2V0UXVlcnlTUUxDYWNoZUluc3RhbmNlKCkgIT0gbnVs\nbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHNldENhY2hl\nUHJlcGFyZWRRdWVyeShib29sZWFuIGZsYWcpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2NhY2hlUHJlcGFyZWRRdWVy\neSA9IGZsYWc7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRDYWNoZUZpbmRlclF1ZXJ5KCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gX2NhY2hlRmluZGVyUXVl\ncnkgCiAgICAgICAgICAgICAgICYmIF9jb25mLmdldEZpbmRlckNhY2hlSW5z\ndGFuY2UoKSAhPSBudWxsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgc2V0Q2FjaGVGaW5kZXJRdWVyeShib29sZWFuIGZsYWcpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2NhY2hl\nUHJlcGFyZWRRdWVyeSA9IGZsYWc7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0Zyb21Xcml0ZUJlaGluZENhbGxiYWNrKCkgewog\nICAgICAgIHJldHVybiBfZnJvbVdyaXRlQmVoaW5kQ2FsbGJhY2s7CiAgICB9\nCn0K\n","encoding":"base64"}

