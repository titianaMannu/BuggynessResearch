{"sha":"d84484b0c98f3b3791f2dfa03e5434ef843be632","node_id":"MDQ6QmxvYjIwNjM2NDpkODQ0ODRiMGM5OGYzYjM3OTFmMmRmYTAzZTU0MzRlZjg0M2JlNjMy","size":35529,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d84484b0c98f3b3791f2dfa03e5434ef843be632","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdE\nZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBq\nYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnNl\nY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb247CmltcG9ydCBqYXZh\nLnNxbC5UaW1lOwppbXBvcnQgamF2YS5zcWwuVGltZXN0YW1wOwppbXBvcnQg\namF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRh\ncjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkFnZ3JlZ2F0ZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkZpbHRlckxpc3RlbmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNl\ncHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKaW1wb3J0IHNlcnAu\ndXRpbC5TdHJpbmdzOwoKLyoqCiAqIEhlbHBlciBtZXRob2RzIGZvciBkZWFs\naW5nIHdpdGggcXVlcnkgZmlsdGVycy4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEZpbHRlcnMgewoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEJpZ0RlY2ltYWwgWkVST19CSUdE\nRUNJTUFMID0gbmV3IEJpZ0RlY2ltYWwoMEQpOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgQmlnSW50ZWdlciBaRVJPX0JJR0lOVEVHRVIgPSBuZXcgQmln\nSW50ZWdlcigiMCIpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBP\nUF9BREQgPSAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE9QX1NV\nQlRSQUNUID0gMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBPUF9N\nVUxUSVBMWSA9IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1Bf\nRElWSURFID0gMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBPUF9N\nT0QgPSA0OwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoRmlsdGVycy5jbGFzcyk7Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvcnJlY3Qgd3JhcHBlciB0eXBl\nIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgQ2xhc3M8Pz4gd3JhcChDbGFzczw/PiBjKSB7CiAgICAgICAgaWYgKCFj\nLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIHJldHVybiBjOwogICAgICAg\nIGlmIChjID09IGludC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIEludGVn\nZXIuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gZmxvYXQuY2xhc3MpCiAgICAg\nICAgICAgIHJldHVybiBGbG9hdC5jbGFzczsKICAgICAgICBpZiAoYyA9PSBk\nb3VibGUuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7\nCiAgICAgICAgaWYgKGMgPT0gbG9uZy5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIExvbmcuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gYm9vbGVhbi5jbGFz\ncykKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uY2xhc3M7CiAgICAgICAg\naWYgKGMgPT0gc2hvcnQuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBTaG9y\ndC5jbGFzczsKICAgICAgICBpZiAoYyA9PSBieXRlLmNsYXNzKQogICAgICAg\nICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICBpZiAoYyA9PSBjaGFy\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gQ2hhcmFjdGVyLmNsYXNzOwog\nICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjb3JyZWN0IHByaW1pdGl2ZSB0eXBlIGZvciB0aGUgZ2l2ZW4gY2xh\nc3MsIGlmIGl0IGlzIGEKICAgICAqIHdyYXBwZXIuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgQ2xhc3M8Pz4gdW53cmFwKENsYXNzPD8+IGMpIHsKICAg\nICAgICBpZiAoYy5pc1ByaW1pdGl2ZSgpIHx8IGMgPT0gU3RyaW5nLmNsYXNz\nKQogICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICBpZiAoYyA9PSBJbnRl\nZ2VyLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gaW50LmNsYXNzOwogICAg\nICAgIGlmIChjID09IEZsb2F0LmNsYXNzKQogICAgICAgICAgICByZXR1cm4g\nZmxvYXQuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gRG91YmxlLmNsYXNzKQog\nICAgICAgICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgIGlmIChj\nID09IExvbmcuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBsb25nLmNsYXNz\nOwogICAgICAgIGlmIChjID09IEJvb2xlYW4uY2xhc3MpCiAgICAgICAgICAg\nIHJldHVybiBib29sZWFuLmNsYXNzOwogICAgICAgIGlmIChjID09IFNob3J0\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gc2hvcnQuY2xhc3M7CiAgICAg\nICAgaWYgKGMgPT0gQnl0ZS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGJ5\ndGUuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gQ2hhcmFjdGVyLmNsYXNzKQog\nICAgICAgICAgICByZXR1cm4gY2hhci5jbGFzczsKICAgICAgICByZXR1cm4g\nYzsKICAgIH0KCiAgICAvKioKICAgICAqIEdpdmVuIHR3byB0eXBlcywgcmV0\ndXJuIHR5cGUgdGhleSBzaG91bGQgYm90aCBiZSBjb252ZXJ0ZWQKICAgICAq\nIHRvIGJlZm9yZSBwZXJmb3JtaW5nIGFueSBvcGVyYXRpb25zIGJldHdlZW4g\ndGhlbS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBDbGFzczw/PiBwcm9t\nb3RlKENsYXNzPD8+IGMxLCBDbGFzczw/PiBjMikgewogICAgICAgIGlmIChj\nMSA9PSBjMikKICAgICAgICAgICAgcmV0dXJuIHVud3JhcChjMSk7CiAgICAg\nICAgQ2xhc3M8Pz4gdzEgPSB3cmFwKGMxKTsKICAgICAgICBDbGFzczw/PiB3\nMiA9IHdyYXAoYzIpOwogICAgICAgIGlmICh3MSA9PSB3MikKICAgICAgICAg\nICAgcmV0dXJuIHVud3JhcChjMSk7CgogICAgICAgIC8vIG5vdCBudW1iZXJz\nPwogICAgICAgIGJvb2xlYW4gdzFOdW1iZXIgPSBOdW1iZXIuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSh3MSk7CiAgICAgICAgYm9vbGVhbiB3Mk51bWJlciA9\nIE51bWJlci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHcyKTsKICAgICAgICBp\nZiAoIXcxTnVtYmVyIHx8ICF3Mk51bWJlcikgewogICAgICAgICAgICAvLyB0\naGUgb25seSBub24tbnVtZXJpYyBwcm9tb3Rpb24gd2UgZG8gaXMgc3RyaW5n\nIHRvIGNoYXIsCiAgICAgICAgICAgIC8vIG9yIGZyb20gY2hhci9zdHJpbmcg\ndG8gbnVtYmVyCiAgICAgICAgICAgIGlmICghdzFOdW1iZXIpIHsKICAgICAg\nICAgICAgICAgIGlmICh3Mk51bWJlciAmJiAodzEgPT0gQ2hhcmFjdGVyLmNs\nYXNzIHx8IHcxID09IFN0cmluZy5jbGFzcykpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuICh3MiA9PSBCeXRlLmNsYXNzIHx8IHcyID09IFNob3J0LmNs\nYXNzKQogICAgICAgICAgICAgICAgICAgICAgICA/IEludGVnZXIuY2xhc3Mg\nOiB1bndyYXAoYzIpOwogICAgICAgICAgICAgICAgaWYgKCF3Mk51bWJlciAm\nJiB3MSA9PSBDaGFyYWN0ZXIuY2xhc3MgJiYgdzIgPT0gU3RyaW5nLmNsYXNz\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuY2xhc3M7CiAg\nICAgICAgICAgICAgICBpZiAodzJOdW1iZXIpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHVud3JhcChjMik7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKCF3Mk51bWJlcikgewogICAgICAgICAgICAgICAgaWYgKHcxTnVt\nYmVyICYmICh3MiA9PSBDaGFyYWN0ZXIuY2xhc3MgfHwgdzIgPT0gU3RyaW5n\nLmNsYXNzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHcxID09IEJ5\ndGUuY2xhc3MgfHwgdzEgPT0gU2hvcnQuY2xhc3MpCiAgICAgICAgICAgICAg\nICAgICAgICAgID8gSW50ZWdlci5jbGFzcyA6IHVud3JhcChjMSk7CiAgICAg\nICAgICAgICAgICBpZiAoIXcxTnVtYmVyICYmIHcyID09IENoYXJhY3Rlci5j\nbGFzcyAmJiB3MSA9PSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIFN0cmluZy5jbGFzczsKICAgICAgICAgICAgICAgIGlmICh3\nMU51bWJlcikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMx\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbmVpdGhlciBh\ncmUgbnVtYmVycywgdXNlIGxlYXN0LWRlcml2ZWQgb2YgdGhlIHR3by4gIGlm\nIG5laXRoZXIKICAgICAgICAgICAgLy8gaXMgYXNzaWduYWJsZSBmcm9tIHRo\nZSBvdGhlciBidXQgb25lIGlzIGEgc3RhbmRhcmQgdHlwZSwgYXNzdW1lCiAg\nICAgICAgICAgIC8vIHRoZSBvdGhlciBjYW4gYmUgY29udmVydGVkIHRvIHRo\nYXQgc3RhbmRhcmQgdHlwZQogICAgICAgICAgICBpZiAoIXcxTnVtYmVyICYm\nICF3Mk51bWJlcikgewogICAgICAgICAgICAgICAgaWYgKHcxID09IE9iamVj\ndC5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMy\nKTsKICAgICAgICAgICAgICAgIGlmICh3MiA9PSBPYmplY3QuY2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcChjMSk7CiAgICAgICAg\nICAgICAgICBpZiAodzEuaXNBc3NpZ25hYmxlRnJvbSh3MikpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHVud3JhcChjMSk7CiAgICAgICAgICAgICAg\nICBpZiAodzIuaXNBc3NpZ25hYmxlRnJvbSh3MSkpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHVud3JhcChjMik7CiAgICAgICAgICAgICAgICBpZiAo\naXNOb25zdGFuZGFyZFR5cGUodzEpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiAoaXNOb25zdGFuZGFyZFR5cGUodzIpKSA/IE9iamVjdC5jbGFzcyA6\nIHVud3JhcChjMik7CiAgICAgICAgICAgICAgICBpZiAoaXNOb25zdGFuZGFy\nZFR5cGUodzIpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNOb25z\ndGFuZGFyZFR5cGUodzEpKSA/IE9iamVjdC5jbGFzcyA6IHVud3JhcChjMSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5jbGFz\nczsKICAgICAgICB9CgogICAgICAgIGlmICh3MSA9PSBCaWdEZWNpbWFsLmNs\nYXNzIHx8IHcyID09IEJpZ0RlY2ltYWwuY2xhc3MpCiAgICAgICAgICAgIHJl\ndHVybiBCaWdEZWNpbWFsLmNsYXNzOwogICAgICAgIGlmICh3MSA9PSBCaWdJ\nbnRlZ2VyLmNsYXNzKSB7CiAgICAgICAgICAgIGlmICh3MiA9PSBGbG9hdC5j\nbGFzcyB8fCB3MiA9PSBEb3VibGUuY2xhc3MpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gQmlnRGVjaW1hbC5jbGFzczsKICAgICAgICAgICAgcmV0dXJuIEJp\nZ0ludGVnZXIuY2xhc3M7CiAgICAgICAgfQogICAgICAgIGlmICh3MiA9PSBC\naWdJbnRlZ2VyLmNsYXNzKSB7CiAgICAgICAgICAgIGlmICh3MSA9PSBGbG9h\ndC5jbGFzcyB8fCB3MSA9PSBEb3VibGUuY2xhc3MpCiAgICAgICAgICAgICAg\nICByZXR1cm4gQmlnRGVjaW1hbC5jbGFzczsKICAgICAgICAgICAgcmV0dXJu\nIEJpZ0ludGVnZXIuY2xhc3M7CiAgICAgICAgfQogICAgICAgIGlmICh3MSA9\nPSBEb3VibGUuY2xhc3MgfHwgdzIgPT0gRG91YmxlLmNsYXNzKQogICAgICAg\nICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgIGlmICh3MSA9PSBG\nbG9hdC5jbGFzcyB8fCB3MiA9PSBGbG9hdC5jbGFzcykKICAgICAgICAgICAg\ncmV0dXJuIGZsb2F0LmNsYXNzOwogICAgICAgIGlmICh3MSA9PSBMb25nLmNs\nYXNzIHx8IHcyID09IExvbmcuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBs\nb25nLmNsYXNzOwogICAgICAgIHJldHVybiBpbnQuY2xhc3M7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gdHlwZSBp\ncyBub3QgYSBzdGFuZGFyZCBwZXJzaXN0ZW50IHR5cGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNOb25zdGFuZGFyZFR5cGUoQ2xh\nc3M8Pz4gYykgewogICAgICAgIHN3aXRjaCAoSmF2YVR5cGVzLmdldFR5cGVD\nb2RlKGMpKQogICAgICAgIHsKICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJB\nWToKICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICBjYXNlIEphdmFUeXBlcy5Q\nQzoKICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nQkpFQ1Q6CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciBhbiBpbnN0YW5jZSBv\nZiB0aGUgZmlyc3QgY2xhc3MgY2FuIGJlIGNvbnZlcnRlZCB0bwogICAgICog\nYW4gaW5zdGFuY2Ugb2YgdGhlIHNlY29uZC4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBib29sZWFuIGNhbkNvbnZlcnQoQ2xhc3M8Pz4gYzEsIENsYXNz\nPD8+IGMyLCBib29sZWFuIHN0cmljdCkgewogICAgICAgIGlmIChjMSA9PSBj\nMikKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgYzEgPSB3cmFw\nKGMxKTsKICAgICAgICBjMiA9IHdyYXAoYzIpOwogICAgICAgIGlmIChjMi5p\nc0Fzc2lnbmFibGVGcm9tKGMxKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCgogICAgICAgIGJvb2xlYW4gYzFOdW1iZXIgPSBOdW1iZXIuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbShjMSk7CiAgICAgICAgYm9vbGVhbiBjMk51bWJlciA9\nIE51bWJlci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGMyKTsKICAgICAgICBp\nZiAoYzFOdW1iZXIgJiYgYzJOdW1iZXIpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGlmICgoYzFOdW1iZXIgJiYgKGMyID09IENoYXJhY3Rl\nci5jbGFzcwogICAgICAgICAgICB8fCAoIXN0cmljdCAmJiBjMiA9PSBTdHJp\nbmcuY2xhc3MpKSkKICAgICAgICAgICAgfHwgKGMyTnVtYmVyICYmIChjMSA9\nPSBDaGFyYWN0ZXIuY2xhc3MKICAgICAgICAgICAgfHwgKCFzdHJpY3QgJiYg\nYzEgPT0gU3RyaW5nLmNsYXNzKSkpKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICBpZiAoYzEgPT0gU3RyaW5nLmNsYXNzICYmIGMyID09IENo\nYXJhY3Rlci5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKGMyID09IFN0cmluZy5jbGFzcykKICAgICAgICAgICAgcmV0dXJu\nICFzdHJpY3Q7CiAgICAgICAgaWYgKGMxID09IFN0cmluZy5jbGFzcyAmJiBp\nc1RlbXBvcmFsVHlwZShjMikpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIGlmICgoYzEgPT0gamF2YS51dGlsLkRhdGUuY2xhc3MgfHxjMSA9\nPSBqYXZhLnNxbC5UaW1lLmNsYXNzKSAmJiBjMiA9PSBqYXZhLnNxbC5UaW1l\nc3RhbXAuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBpZiAoKGMxID09IGphdmEudXRpbC5EYXRlLmNsYXNzIHx8YzEgPT0gamF2\nYS5zcWwuVGltZXN0YW1wLmNsYXNzKSAmJiBjMiA9PSBqYXZhLnNxbC5UaW1l\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYg\nKGlzVGVtcG9yYWxUeXBlKGMxKSAmJiBpc1RlbXBvcmFsVHlwZShjMikpCiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIHZhbHVl\nIHRvIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIE9iamVjdCBjb252ZXJ0KE9iamVjdCBvLCBDbGFzczw/PiB0eXBlKSB7CiAg\nICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgaWYgKG8uZ2V0Q2xhc3MoKSA9PSB0eXBlKQogICAgICAgICAg\nICByZXR1cm4gbzsKCiAgICAgICAgdHlwZSA9IHdyYXAodHlwZSk7CiAgICAg\nICAgaWYgKHR5cGUuaXNBc3NpZ25hYmxlRnJvbShvLmdldENsYXNzKCkpKQog\nICAgICAgICAgICByZXR1cm4gbzsKCiAgICAgICAgLy8gdGhlIG5vbi1udW1l\ncmljIGNvbnZlcnNpb25zIHdlIGRvIGFyZSB0byBzdHJpbmcsIG9yIGZyb20K\nICAgICAgICAvLyBzdHJpbmcvY2hhciB0byBudW1iZXIsIG9yIGNhbGVuZGFy\nL2RhdGUKICAgICAgICAvLyBTdHJpbmcgdG8gQm9vbGVhbgogICAgICAgIC8v\nIFN0cmluZyB0byBJbnRlZ2VyCiAgICAgICAgYm9vbGVhbiBudW0gPSBvIGlu\nc3RhbmNlb2YgTnVtYmVyOwogICAgICAgIGlmICghbnVtKSB7CiAgICAgICAg\nICAgIGlmICh0eXBlID09IFN0cmluZy5jbGFzcykKICAgICAgICAgICAgICAg\nIHJldHVybiBvLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHR5\ncGUgPT0gQm9vbGVhbi5jbGFzcyAmJiBvIGluc3RhbmNlb2YgU3RyaW5nKSAK\nICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLnZhbHVlT2Yoby50b1N0\ncmluZygpKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PSBJbnRlZ2Vy\nLmNsYXNzICYmIG8gaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW50ZWdl\ncihvLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoTnVt\nYmVyRm9ybWF0RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKF9sb2MuZ2V0KCJjYW50LWNv\nbnZlcnQiLCBvLAogICAgICAgICAgICAgICAgICAgICAgICBvLmdldENsYXNz\nKCksIHR5cGUpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT0gQ2hhcmFjdGVyLmNsYXNzKSB7\nCiAgICAgICAgICAgICAgICBTdHJpbmcgc3RyID0gby50b1N0cmluZygpOwog\nICAgICAgICAgICAgICAgaWYgKHN0ciAhPSBudWxsICYmIHN0ci5sZW5ndGgo\nKSA9PSAxKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFj\ndGVyKHN0ci5jaGFyQXQoMCkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKENh\nbGVuZGFyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkgJiYKICAgICAg\nICAgICAgICAgIG8gaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICAgICAg\nICBDYWxlbmRhciBjYWwgPSBDYWxlbmRhci5nZXRJbnN0YW5jZSgpOwogICAg\nICAgICAgICAgICAgY2FsLnNldFRpbWUoKERhdGUpIG8pOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGNhbDsKICAgICAgICAgICAgfSBlbHNlIGlmIChEYXRl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkgJiYKICAgICAgICAgICAg\nICAgIG8gaW5zdGFuY2VvZiBDYWxlbmRhcikgewogICAgICAgICAgICAgICAg\ncmV0dXJuICgoQ2FsZW5kYXIpIG8pLmdldFRpbWUoKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChOdW1iZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBl\nKSkgewogICAgICAgICAgICAgICAgSW50ZWdlciBpID0gbnVsbDsKICAgICAg\nICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgQ2hhcmFjdGVyKQogICAgICAg\nICAgICAgICAgICAgIGkgPSBOdW1iZXJzLnZhbHVlT2YoKChDaGFyYWN0ZXIp\nIG8pLmNoYXJWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKG8g\naW5zdGFuY2VvZiBTdHJpbmcgJiYgKChTdHJpbmcpIG8pLmxlbmd0aCgpID09\nIDEpCiAgICAgICAgICAgICAgICAgICAgaSA9IE51bWJlcnMudmFsdWVPZigo\nKFN0cmluZykgbykuY2hhckF0KDApKTsKCiAgICAgICAgICAgICAgICBpZiAo\naSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0g\nSW50ZWdlci5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGk7CiAgICAgICAgICAgICAgICAgICAgbnVtID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChvIGluc3RhbmNlb2Yg\nU3RyaW5nICYmIGlzSkRCQ1RlbXBvcmFsU3ludGF4KG8udG9TdHJpbmcoKSkp\nIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nT2JqZWN0IHRlbXBvcmFsID0gcGFyc2VKREJDVGVtcG9yYWxTeW50YXgoby50\nb1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcG9yYWwg\nIT0gbnVsbCAmJiB0eXBlLmlzQXNzaWduYWJsZUZyb20odGVtcG9yYWwuZ2V0\nQ2xhc3MoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1w\nb3JhbDsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKCFudW0pCiAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRp\nb24oX2xvYy5nZXQoImNhbnQtY29udmVydCIsIG8sCiAgICAgICAgICAgICAg\nICBvLmdldENsYXNzKCksIHR5cGUpLmdldE1lc3NhZ2UoKSk7CgogICAgICAg\nIGlmICh0eXBlID09IEludGVnZXIuY2xhc3MpIHsKICAgICAgICAgICAgcmV0\ndXJuIE51bWJlcnMudmFsdWVPZigoKE51bWJlcikgbykuaW50VmFsdWUoKSk7\nCiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IEZsb2F0LmNsYXNzKSB7CiAg\nICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQoKChOdW1iZXIpIG8pLmZsb2F0\nVmFsdWUoKSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IERvdWJsZS5j\nbGFzcykgewogICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZSgoKE51bWJl\ncikgbykuZG91YmxlVmFsdWUoKSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBl\nID09IExvbmcuY2xhc3MpIHsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMu\ndmFsdWVPZigoKE51bWJlcikgbykubG9uZ1ZhbHVlKCkpOwogICAgICAgIH0g\nZWxzZSBpZiAodHlwZSA9PSBCaWdEZWNpbWFsLmNsYXNzKSB7CiAgICAgICAg\nICAgIC8vIHRoZSBCaWdEZWNpbWFsIGNvbnN0cnVjdG9yIGRvZXNuJ3QgaGFu\nZGxlIHRoZQogICAgICAgICAgICAvLyAiTmFOIiBzdHJpbmcgdmVyc2lvbiBv\nZiBEb3VibGUuTmFOIGFuZCBGbG9hdC5OYU4sIG5vcgogICAgICAgICAgICAv\nLyBkb2VzIGl0IGhhbmRsZSBpbmZpbml0eTsgd2UgbmVlZCB0byBpbnN0ZWFk\nIHVzZSB0aGUgRG91YmxlCiAgICAgICAgICAgIC8vIGFuZCBGbG9hdCB2ZXJz\naW9ucywgZGVzcGl0ZSB3YW50aW5nIHRvIGNhc3QgaXQgdG8gQmlnRGVjaW1h\nbAogICAgICAgICAgICBkb3VibGUgZHZhbCA9ICgoTnVtYmVyKSBvKS5kb3Vi\nbGVWYWx1ZSgpOwogICAgICAgICAgICBpZiAoRG91YmxlLmlzTmFOKGR2YWwp\nIHx8IERvdWJsZS5pc0luZmluaXRlKGR2YWwpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBEb3VibGUoZHZhbCk7CgogICAgICAgICAgICBmbG9hdCBm\ndmFsID0gKChOdW1iZXIpIG8pLmZsb2F0VmFsdWUoKTsKICAgICAgICAgICAg\naWYgKEZsb2F0LmlzTmFOKGZ2YWwpIHx8IEZsb2F0LmlzSW5maW5pdGUoZnZh\nbCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZ2YWwpOwoK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBCaWdEZWNpbWFsKG8udG9TdHJpbmco\nKSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IEJpZ0ludGVnZXIuY2xh\nc3MpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBCaWdJbnRlZ2VyKG8udG9T\ndHJpbmcoKSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IFNob3J0LmNs\nYXNzKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU2hvcnQoKChOdW1iZXIp\nIG8pLnNob3J0VmFsdWUoKSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09\nIEJ5dGUuY2xhc3MpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBCeXRlKCgo\nTnVtYmVyKSBvKS5ieXRlVmFsdWUoKSk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZigoKE51bWJlcikgbyku\naW50VmFsdWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIHRoZSBnaXZlbiB2YWx1ZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgT2JqZWN0IGFkZChPYmplY3QgbzEsIENsYXNzPD8+IGMxLCBPYmplY3Qg\nbzIsIENsYXNzPD8+IGMyKSB7CiAgICAgICAgcmV0dXJuIG9wKG8xLCBjMSwg\nbzIsIGMyLCBPUF9BREQpOwogICAgfQoKICAgIC8qKgogICAgICogU3VidHJh\nY3QgdGhlIGdpdmVuIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBPYmplY3Qgc3VidHJhY3QoT2JqZWN0IG8xLCBDbGFzczw/PiBjMSwgT2Jq\nZWN0IG8yLCBDbGFzczw/PiBjMikgewogICAgICAgIHJldHVybiBvcChvMSwg\nYzEsIG8yLCBjMiwgT1BfU1VCVFJBQ1QpOwogICAgfQoKICAgIC8qKgogICAg\nICogTXVsdGlwbHkgdGhlIGdpdmVuIHZhbHVlcy4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBPYmplY3QgbXVsdGlwbHkoT2JqZWN0IG8xLCBDbGFzczw/\nPiBjMSwgT2JqZWN0IG8yLCBDbGFzczw/PiBjMikgewogICAgICAgIHJldHVy\nbiBvcChvMSwgYzEsIG8yLCBjMiwgT1BfTVVMVElQTFkpOwogICAgfQoKICAg\nIC8qKgogICAgICogRGl2aWRlIHRoZSBnaXZlbiB2YWx1ZXMuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGRpdmlkZShPYmplY3QgbzEsIENs\nYXNzPD8+IGMxLCBPYmplY3QgbzIsIENsYXNzPD8+IGMyKSB7CiAgICAgICAg\ncmV0dXJuIG9wKG8xLCBjMSwgbzIsIGMyLCBPUF9ESVZJREUpOwogICAgfQoK\nICAgIC8qKgogICAgICogTW9kIHRoZSBnaXZlbiB2YWx1ZXMuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG1vZChPYmplY3QgbzEsIENsYXNz\nPD8+IGMxLCBPYmplY3QgbzIsIENsYXNzPD8+IGMyKSB7CiAgICAgICAgcmV0\ndXJuIG9wKG8xLCBjMSwgbzIsIGMyLCBPUF9NT0QpOwogICAgfQoKICAgIC8q\nKgogICAgICogUGVyZm9ybSB0aGUgZ2l2ZW4gb3BlcmF0aW9uIG9uIHR3byBu\ndW1iZXJzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3Qgb3Ao\nT2JqZWN0IG8xLCBDbGFzczw/PiBjMSwgT2JqZWN0IG8yLCBDbGFzczw/PiBj\nMiwgaW50IG9wKSB7CiAgICAgICAgQ2xhc3M8Pz4gcHJvbW90ZSA9IHByb21v\ndGUoYzEsIGMyKTsKICAgICAgICBpZiAocHJvbW90ZSA9PSBpbnQuY2xhc3Mp\nIHsKICAgICAgICAgICAgaW50IG4xID0gKG8xID09IG51bGwpID8gMCA6ICgo\nTnVtYmVyKSBvMSkuaW50VmFsdWUoKTsKICAgICAgICAgICAgaW50IG4yID0g\nKG8yID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSBvMikuaW50VmFsdWUoKTsK\nICAgICAgICAgICAgcmV0dXJuIG9wKG4xLCBuMiwgb3ApOwogICAgICAgIH0K\nICAgICAgICBpZiAocHJvbW90ZSA9PSBmbG9hdC5jbGFzcykgewogICAgICAg\nICAgICBmbG9hdCBuMSA9IChvMSA9PSBudWxsKSA/IDBGIDogKChOdW1iZXIp\nIG8xKS5mbG9hdFZhbHVlKCk7CiAgICAgICAgICAgIGZsb2F0IG4yID0gKG8y\nID09IG51bGwpID8gMEYgOiAoKE51bWJlcikgbzIpLmZsb2F0VmFsdWUoKTsK\nICAgICAgICAgICAgcmV0dXJuIG9wKG4xLCBuMiwgb3ApOwogICAgICAgIH0K\nICAgICAgICBpZiAocHJvbW90ZSA9PSBkb3VibGUuY2xhc3MpIHsKICAgICAg\nICAgICAgZG91YmxlIG4xID0gKG8xID09IG51bGwpID8gMEQgOiAoKE51bWJl\ncikgbzEpLmRvdWJsZVZhbHVlKCk7CiAgICAgICAgICAgIGRvdWJsZSBuMiA9\nIChvMiA9PSBudWxsKSA/IDBEIDogKChOdW1iZXIpIG8yKS5kb3VibGVWYWx1\nZSgpOwogICAgICAgICAgICByZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAg\nICAgfQogICAgICAgIGlmIChwcm9tb3RlID09IGxvbmcuY2xhc3MpIHsKICAg\nICAgICAgICAgbG9uZyBuMSA9IChvMSA9PSBudWxsKSA/IDBMIDogKChOdW1i\nZXIpIG8xKS5sb25nVmFsdWUoKTsKICAgICAgICAgICAgbG9uZyBuMiA9IChv\nMiA9PSBudWxsKSA/IDBMIDogKChOdW1iZXIpIG8yKS5sb25nVmFsdWUoKTsK\nICAgICAgICAgICAgcmV0dXJuIG9wKG4xLCBuMiwgb3ApOwogICAgICAgIH0K\nICAgICAgICBpZiAocHJvbW90ZSA9PSBCaWdEZWNpbWFsLmNsYXNzKSB7CiAg\nICAgICAgICAgIEJpZ0RlY2ltYWwgbjEgPSAobzEgPT0gbnVsbCkgPyBaRVJP\nX0JJR0RFQ0lNQUwKICAgICAgICAgICAgICAgIDogKEJpZ0RlY2ltYWwpIGNv\nbnZlcnQobzEsIHByb21vdGUpOwogICAgICAgICAgICBCaWdEZWNpbWFsIG4y\nID0gKG8yID09IG51bGwpID8gWkVST19CSUdERUNJTUFMCiAgICAgICAgICAg\nICAgICA6IChCaWdEZWNpbWFsKSBjb252ZXJ0KG8yLCBwcm9tb3RlKTsKICAg\nICAgICAgICAgcmV0dXJuIG9wKG4xLCBuMiwgb3ApOwogICAgICAgIH0KICAg\nICAgICBpZiAocHJvbW90ZSA9PSBCaWdJbnRlZ2VyLmNsYXNzKSB7CiAgICAg\nICAgICAgIEJpZ0ludGVnZXIgbjEgPSAobzEgPT0gbnVsbCkgPyBaRVJPX0JJ\nR0lOVEVHRVIKICAgICAgICAgICAgICAgIDogKEJpZ0ludGVnZXIpIGNvbnZl\ncnQobzEsIHByb21vdGUpOwogICAgICAgICAgICBCaWdJbnRlZ2VyIG4yID0g\nKG8yID09IG51bGwpID8gWkVST19CSUdJTlRFR0VSCiAgICAgICAgICAgICAg\nICA6IChCaWdJbnRlZ2VyKSBjb252ZXJ0KG8yLCBwcm9tb3RlKTsKICAgICAg\nICAgICAgcmV0dXJuIG9wKG4xLCBuMiwgb3ApOwogICAgICAgIH0KICAgICAg\nICAvLyBkZWZhdWx0IHRvIGludAogICAgICAgIGludCBuMSA9IChvMSA9PSBu\ndWxsKSA/IDAgOiAoKE51bWJlcikgbzEpLmludFZhbHVlKCk7CiAgICAgICAg\naW50IG4yID0gKG8yID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSBvMikuaW50\nVmFsdWUoKTsKICAgICAgICByZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlc3VsdCBvZiBhIG1hdGhl\nbWF0aWNhbCBvcGVyYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIE9iamVjdCBvcChpbnQgbjEsIGludCBuMiwgaW50IG9wKSB7CiAgICAgICAg\naW50IHRvdDsKICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgIGNh\nc2UgT1BfQUREOgogICAgICAgICAgICAgICAgdG90ID0gbjEgKyBuMjsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE9QX1NVQlRS\nQUNUOgogICAgICAgICAgICAgICAgdG90ID0gbjEgLSBuMjsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE9QX01VTFRJUExZOgog\nICAgICAgICAgICAgICAgdG90ID0gbjEgKiBuMjsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIE9QX0RJVklERToKICAgICAgICAg\nICAgICAgIHRvdCA9IG4xIC8gbjI7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBPUF9NT0Q6CiAgICAgICAgICAgICAgICB0b3Qg\nPSBuMSAlIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE51bWJlcnMu\ndmFsdWVPZih0b3QpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSByZXN1bHQgb2YgYSBtYXRoZW1hdGljYWwgb3BlcmF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3Qgb3AoZmxvYXQgbjEsIGZsb2F0\nIG4yLCBpbnQgb3ApIHsKICAgICAgICBmbG9hdCB0b3Q7CiAgICAgICAgc3dp\ndGNoIChvcCkgewogICAgICAgICAgICBjYXNlIE9QX0FERDoKICAgICAgICAg\nICAgICAgIHRvdCA9IG4xICsgbjI7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBPUF9TVUJUUkFDVDoKICAgICAgICAgICAgICAg\nIHRvdCA9IG4xIC0gbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBPUF9NVUxUSVBMWToKICAgICAgICAgICAgICAgIHRvdCA9\nIG4xICogbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBPUF9ESVZJREU6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAvIG4y\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1Bf\nTU9EOgogICAgICAgICAgICAgICAgdG90ID0gbjEgJSBuMjsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBuZXcgRmxvYXQodG90KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIGEgbWF0aGVtYXRpY2Fs\nIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0\nIG9wKGRvdWJsZSBuMSwgZG91YmxlIG4yLCBpbnQgb3ApIHsKICAgICAgICBk\nb3VibGUgdG90OwogICAgICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAgICAg\nY2FzZSBPUF9BREQ6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSArIG4yOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfU1VC\nVFJBQ1Q6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAtIG4yOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfTVVMVElQTFk6\nCiAgICAgICAgICAgICAgICB0b3QgPSBuMSAqIG4yOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfRElWSURFOgogICAgICAg\nICAgICAgICAgdG90ID0gbjEgLyBuMjsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIE9QX01PRDoKICAgICAgICAgICAgICAgIHRv\ndCA9IG4xICUgbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5h\nbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IERv\ndWJsZSh0b3QpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBy\nZXN1bHQgb2YgYSBtYXRoZW1hdGljYWwgb3BlcmF0aW9uLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBPYmplY3Qgb3AobG9uZyBuMSwgbG9uZyBuMiwg\naW50IG9wKSB7CiAgICAgICAgbG9uZyB0b3Q7CiAgICAgICAgc3dpdGNoIChv\ncCkgewogICAgICAgICAgICBjYXNlIE9QX0FERDoKICAgICAgICAgICAgICAg\nIHRvdCA9IG4xICsgbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBPUF9TVUJUUkFDVDoKICAgICAgICAgICAgICAgIHRvdCA9\nIG4xIC0gbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBPUF9NVUxUSVBMWToKICAgICAgICAgICAgICAgIHRvdCA9IG4xICog\nbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBP\nUF9ESVZJREU6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAvIG4yOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfTU9EOgog\nICAgICAgICAgICAgICAgdG90ID0gbjEgJSBuMjsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YodG90KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIGEgbWF0aGVtYXRpY2Fs\nIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0\nIG9wKEJpZ0RlY2ltYWwgbjEsIEJpZ0RlY2ltYWwgbjIsIGludCBvcCkgewog\nICAgICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAgICAgY2FzZSBPUF9BREQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbjEuYWRkKG4yKTsKICAgICAgICAg\nICAgY2FzZSBPUF9TVUJUUkFDVDoKICAgICAgICAgICAgICAgIHJldHVybiBu\nMS5zdWJ0cmFjdChuMik7CiAgICAgICAgICAgIGNhc2UgT1BfTVVMVElQTFk6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbjEubXVsdGlwbHkobjIpOwogICAg\nICAgICAgICBjYXNlIE9QX0RJVklERToKICAgICAgICAgICAgICAgIGludCBz\nY2FsZSA9IE1hdGgubWF4KG4xLnNjYWxlKCksIG4yLnNjYWxlKCkpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIG4xLmRpdmlkZShuMiwgc2NhbGUsIEJpZ0Rl\nY2ltYWwuUk9VTkRfSEFMRl9VUCk7CiAgICAgICAgICAgIGNhc2UgT1BfTU9E\nOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm1vZC1iaWdkZWNpbWFsIikpOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSByZXN1bHQgb2YgYSBtYXRoZW1hdGljYWwgb3BlcmF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3Qgb3AoQmlnSW50ZWdlciBuMSwg\nQmlnSW50ZWdlciBuMiwgaW50IG9wKSB7CiAgICAgICAgc3dpdGNoIChvcCkg\newogICAgICAgICAgICBjYXNlIE9QX0FERDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBuMS5hZGQobjIpOwogICAgICAgICAgICBjYXNlIE9QX1NVQlRSQUNU\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG4xLnN1YnRyYWN0KG4yKTsKICAg\nICAgICAgICAgY2FzZSBPUF9NVUxUSVBMWToKICAgICAgICAgICAgICAgIHJl\ndHVybiBuMS5tdWx0aXBseShuMik7CiAgICAgICAgICAgIGNhc2UgT1BfRElW\nSURFOgogICAgICAgICAgICAgICAgcmV0dXJuIG4xLmRpdmlkZShuMik7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZXMgdGhlIGdpdmVuIGRlY2xhcmF0aW9ucyBpbnRvIGEg\nbGlzdCBvZiB0eXBlLCBuYW1lLCB0eXBlLCBuYW1lLi4uCiAgICAgKiBSZXR1\ncm5zIG51bGwgaWYgbm8gZGVjbGFyYXRpb25zLiBBc3N1bWVzIGRlY2xhcmF0\naW9uIGlzIG5vdCBhbiBlbXB0eQogICAgICogc3RyaW5nIGFuZCBpcyBhbHJl\nYWR5IHRyaW1tZWQgKHZhbGlkIGFzc3VtcHRpb25zIGdpdmVuIHRoZSBjaGVj\na3MgbWFkZQogICAgICogaW4gb3VyIHNldHRlcnMpLgogICAgICoKICAgICAq\nIEBwYXJhbSBkZWNUeXBlIHRoZSB0eXBlIG9mIGRlY2xhcmF0aW9uIGJlaW5n\nIHBhcnNlZCwgZm9yIHVzZSBpbgogICAgICogZXJyb3IgbWVzc2FnZXMKICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBMaXN0PFN0cmluZz4gcGFyc2VEZWNs\nYXJhdGlvbihTdHJpbmcgZGVjLCBjaGFyIHNwbGl0LCBTdHJpbmcgZGVjVHlw\nZSkgewogICAgICAgIGlmIChkZWMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIC8vIHdhdGNoIGZvciBjb21tb24gbWl4dXBz\nIGJldHdlZW4gY29tbWFzIGFuZCBzZW1pcwogICAgICAgIGNoYXIgYmFkID0g\nKGNoYXIpIDA7CiAgICAgICAgaWYgKHNwbGl0ID09ICcsJykKICAgICAgICAg\nICAgYmFkID0gJzsnOwogICAgICAgIGVsc2UgaWYgKHNwbGl0ID09ICc7JykK\nICAgICAgICAgICAgYmFkID0gJywnOwoKICAgICAgICBjaGFyIHNlbnRpbmFs\nID0gJyAnOwogICAgICAgIGNoYXIgY3VyOwogICAgICAgIGludCBzdGFydCA9\nIDA7CiAgICAgICAgYm9vbGVhbiBza2lwU3BhY2UgPSBmYWxzZTsKICAgICAg\nICBMaXN0PFN0cmluZz4gcmVzdWx0cyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5n\nPig2KTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGRlYy5sZW5ndGgo\nKTsgaSsrKSB7CiAgICAgICAgICAgIGN1ciA9IGRlYy5jaGFyQXQoaSk7CiAg\nICAgICAgICAgIGlmIChjdXIgPT0gYmFkKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kZWMiLCBkZWMs\nIGRlY1R5cGUpKTsKICAgICAgICAgICAgaWYgKGN1ciA9PSAnICcgJiYgc2tp\ncFNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGFydCsrOwogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNr\naXBTcGFjZSA9IGZhbHNlOwogICAgICAgICAgICBpZiAoY3VyICE9IHNlbnRp\nbmFsKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAv\nLyBpZiBsb29raW5nIGZvciBzcGFjZXMsIGxvb2sgZm9yIHNwbGl0IGNoYXIs\nIG9yIHZpY2UgdmVyc2EKICAgICAgICAgICAgc2VudGluYWwgPSAoc2VudGlu\nYWwgPT0gJyAnKSA/IHNwbGl0IDogJyAnOwogICAgICAgICAgICByZXN1bHRz\nLmFkZChkZWMuc3Vic3RyaW5nKHN0YXJ0LCBpKS50cmltKCkpOwogICAgICAg\nICAgICBzdGFydCA9IGkgKyAxOwogICAgICAgICAgICBza2lwU3BhY2UgPSB0\ncnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIGxhc3QgdG9rZW4sIGlm\nIGFueQogICAgICAgIGlmIChzdGFydCA8IGRlYy5sZW5ndGgoKSkKICAgICAg\nICAgICAgcmVzdWx0cy5hZGQoZGVjLnN1YnN0cmluZyhzdGFydCkpOwoKICAg\nICAgICAvLyBpZiBub3QgYW4gZXZlbiBudW1iZXIgb2YgZWxlbWVudHMsIHNv\nbWV0aGluZyBpcyB3cm9uZwogICAgICAgIGlmIChyZXN1bHRzLmlzRW1wdHko\nKSB8fCByZXN1bHRzLnNpemUoKSAlIDIgIT0gMCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kZWMiLCBkZWMs\nIGRlY1R5cGUpKTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTcGxpdCB0aGUgZ2l2ZW4gZXhwcmVzc2lvbiBsaXN0\nIGludG8gZGlzdGluY3QgZXhwcmVzc2lvbnMuIEFzc3VtZXMgdGhlCiAgICAg\nKiBnaXZlbiBzdHJpbmcgaXMgbm90IG51bGwgb3Igb2YgemVybyBsZW5ndGgg\nYW5kIGlzIGFscmVhZHkgdHJpbW1lZAogICAgICogKHZhbGlkIGFzc3VtcHRp\nb25zIGdpdmVuIHRoZSBjaGVja3MgaW4gb3VyIHNldHRlcnMgYW5kIGJlZm9y\nZQogICAgICogdGhpcyBtZXRob2QgY2FsbCkuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgTGlzdDxTdHJpbmc+IHNwbGl0RXhwcmVzc2lvbnMoU3RyaW5n\nIHN0ciwgY2hhciBzcGxpdCwgaW50IGV4cGVjdGVkKSB7CiAgICAgICAgaWYg\nKHN0ciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgTGlzdDxTdHJpbmc+IGV4cHMgPSBudWxsOwogICAgICAgIGludCBwYXJl\nbkRlcHRoID0gMDsKICAgICAgICBpbnQgYmVnaW4gPSAwLCBwb3MgPSAwOwog\nICAgICAgIGJvb2xlYW4gZXNjYXBlID0gZmFsc2U7CiAgICAgICAgYm9vbGVh\nbiBzdHJpbmcgPSBmYWxzZTsKICAgICAgICBib29sZWFuIG5vbnNwYWNlID0g\nZmFsc2U7CiAgICAgICAgY2hhciBxdW90ZSA9IDA7CiAgICAgICAgZm9yIChj\naGFyIGM7IHBvcyA8IHN0ci5sZW5ndGgoKTsgcG9zKyspIHsKICAgICAgICAg\nICAgYyA9IHN0ci5jaGFyQXQocG9zKTsKICAgICAgICAgICAgaWYgKGMgPT0g\nJ1xcJykgewogICAgICAgICAgICAgICAgZXNjYXBlID0gIWVzY2FwZTsKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChlc2NhcGUpIHsKICAgICAgICAgICAgICAgIGVzY2FwZSA9IGZh\nbHNlOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgY2Fz\nZSAnXCcnOgogICAgICAgICAgICAgICAgY2FzZSAnIic6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHN0cmluZyAmJiBxdW90ZSA9PSBjKQogICAgICAgICAg\nICAgICAgICAgICAgICBzdHJpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlIGlmICghc3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHF1b3RlID0gYzsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5n\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgbm9uc3BhY2UgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnKCc6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKCFzdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncmVuRGVwdGgrKzsKICAgICAgICAgICAgICAgICAgICBub25zcGFjZSA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlICcpJzoKICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmluZykK\nICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW5EZXB0aC0tOwogICAgICAg\nICAgICAgICAgICAgIG5vbnNwYWNlID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJyAnOgogICAgICAg\nICAgICAgICAgY2FzZSAnXHQnOgogICAgICAgICAgICAgICAgY2FzZSAnXG4n\nOgogICAgICAgICAgICAgICAgY2FzZSAnXHInOgogICAgICAgICAgICAgICAg\nICAgIGlmIChjID09IHNwbGl0ICYmICFzdHJpbmcgJiYgcGFyZW5EZXB0aCA9\nPSAwICYmIG5vbnNwYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChleHBzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBl\neHBzID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KGV4cGVjdGVkKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZXhwcy5hZGQoc3RyLnN1YnN0cmluZyhiZWdp\nbiwgcG9zKS50cmltKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBiZWdp\nbiA9IHBvcyArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vbnNwYWNl\nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgICAgICBpZiAoYyA9PSBzcGxpdCAmJiAhc3RyaW5nICYmIHBh\ncmVuRGVwdGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nZXhwcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhw\ncyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPihleHBlY3RlZCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGV4cHMuYWRkKHN0ci5zdWJzdHJpbmcoYmVnaW4s\nIHBvcykudHJpbSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW4g\nPSBwb3MgKyAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBub25zcGFjZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgZXNjYXBlID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAo\nZXhwcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGV4cHMgPSBDb2xsZWN0aW9u\ncy5zaW5nbGV0b25MaXN0KHN0cik7CiAgICAgICAgICAgIHJldHVybiBleHBz\nOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIGxhc3QgZXhwcmVzc2lvbiBh\nbmQgcmV0dXJuIGFycmF5CiAgICAgICAgU3RyaW5nIGxhc3QgPSBzdHIuc3Vi\nc3RyaW5nKGJlZ2luKS50cmltKCk7CiAgICAgICAgaWYgKGxhc3QubGVuZ3Ro\nKCkgPiAwKQogICAgICAgICAgICBleHBzLmFkZChsYXN0KTsKICAgICAgICBy\nZXR1cm4gZXhwczsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2\nZW4gYWNjZXNzIHBhdGggbWV0YWRhdGFzIHRvIHRoZSBmdWxsIHBhdGggbGlz\ndCwgbWFraW5nIHN1cmUKICAgICAqIHRvIG1haW50YWluIG9ubHkgYmFzZSBt\nZXRhZGF0YXMgaW4gdGhlIGxpc3QuIFRoZSBnaXZlbiBsaXN0IG1heSBiZSBu\ndWxsLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIExpc3Q8Q2xhc3NNZXRh\nRGF0YT4gYWRkQWNjZXNzUGF0aE1ldGFEYXRhcyhMaXN0PENsYXNzTWV0YURh\ndGE+IG1ldGFzLCBDbGFzc01ldGFEYXRhW10gcGF0aCkgewogICAgICAgIGlm\nIChwYXRoID09IG51bGwgfHwgcGF0aC5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgcmV0dXJuIG1ldGFzOwoKICAgICAgICAvLyBjcmVhdGUgc2V0IG9mIGJh\nc2UgY2xhc3MgbWV0YWRhdGFzIGluIGFjY2VzcyBwYXRoCiAgICAgICAgaWYg\nKG1ldGFzID09IG51bGwpCiAgICAgICAgICAgIG1ldGFzID0gbmV3IEFycmF5\nTGlzdDxDbGFzc01ldGFEYXRhPigpOwogICAgICAgIGludCBsYXN0ID0gbWV0\nYXMuc2l6ZSgpOwoKICAgICAgICAvLyBmb3IgZXZlcnkgZWxlbWVudCBpbiB0\naGUgcGF0aCBvZiB0aGlzIGV4ZWN1dG9yLCBjb21wYXJlIGl0CiAgICAgICAg\nLy8gdG8gYWxyZWFkeS1nYXRoZXJlZCBlbGVtZW50cyB0byBzZWUgaWYgaXQg\nc2hvdWxkIHJlcGxhY2UKICAgICAgICAvLyBhIHN1YmNsYXNzIGluIHRoZSBs\naXN0IG9yIHNob3VsZCBiZSBhZGRlZCBhcyBhIG5ldyBiYXNlOwogICAgICAg\nIC8vIGF0IGxlYXN0IGl0J3Mgbl4yIG9mIGEgc21hbGwgbi4uLgogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICBib29sZWFuIGFkZDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgYWRkID0gdHJ1ZTsKICAgICAgICAgICAgZm9yIChpbnQg\naiA9IDA7IGFkZCAmJiBqIDwgbGFzdDsgaisrKSB7CiAgICAgICAgICAgICAg\nICBtZXRhID0gbWV0YXMuZ2V0KGopOwoKICAgICAgICAgICAgICAgIGlmICht\nZXRhLmdldERlc2NyaWJlZFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKHBhdGhb\naV0uZ2V0RGVzY3JpYmVkVHlwZSgpKSkgewogICAgICAgICAgICAgICAgICAg\nIC8vIGxpc3QgYWxyZWFkeSBjb250YWlucyBiYXNlIGNsYXNzCiAgICAgICAg\nICAgICAgICAgICAgYWRkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgaWYgKHBhdGhbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpLmlzQXNzaWduYWJs\nZUZyb20obWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgLy8gdGhpcyBlbGVtZW50IHJlcGxhY2VzIGl0cyBzdWJjbGFz\ncwogICAgICAgICAgICAgICAgICAgIGFkZCA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgICAgIG1ldGFzLnNldChqLCBwYXRoW2ldKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbm8gYmFz\nZSBjbGFzcyBvZiBjdXJyZW50IHBhdGggZWxlbWVudCBhbHJlYWR5IGluCiAg\nICAgICAgICAgIC8vIGxpc3QgYW5kIHBhdGggZWxlbWVudCBkaWRuJ3QgcmVw\nbGFjZSBhIHN1YmNsYXNzIGluIHRoZQogICAgICAgICAgICAvLyBsaXN0LCB0\naGVuIGFkZCBpdCBub3cgYXMgYSBuZXcgYmFzZQogICAgICAgICAgICBpZiAo\nYWRkKQogICAgICAgICAgICAgICAgbWV0YXMuYWRkKHBhdGhbaV0pOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbWV0YXM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZXJ0IHRoZSB1c2VyLWdpdmVuIGhpbnQgdmFsdWUgdG8gYW4g\nYWdncmVnYXRlIGxpc3RlbmVyLgogICAgICogVGhlIGhpbnQgY2FuIGJlIGFu\nIGFnZ3JlZ2F0ZSBsaXN0ZW5lciBpbnN0YW5jZSBvciBjbGFzcyBuYW1lLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIEFnZ3JlZ2F0ZUxpc3RlbmVyIGhp\nbnRUb0FnZ3JlZ2F0ZUxpc3RlbmVyKE9iamVjdCBoaW50LCBDbGFzc0xvYWRl\nciBsb2FkZXIpIHsKICAgICAgICBpZiAoaGludCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9m\nIEFnZ3JlZ2F0ZUxpc3RlbmVyKQogICAgICAgICAgICByZXR1cm4gKEFnZ3Jl\nZ2F0ZUxpc3RlbmVyKSBoaW50OwoKICAgICAgICBFeGNlcHRpb24gY2F1c2Ug\nPSBudWxsOwogICAgICAgIGlmIChoaW50IGluc3RhbmNlb2YgU3RyaW5nKSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKEFn\nZ3JlZ2F0ZUxpc3RlbmVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0\nYW5jZUFjdGlvbihDbGFzcy5mb3JOYW1lKChTdHJpbmcpIGhpbnQsIHRydWUs\nIGxvYWRlcikpKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdl\nZEFjdGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAgICAgICBlID0gKChQ\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsK\nICAgICAgICAgICAgICAgIGNhdXNlID0gZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLWFnZy1saXN0ZW5lci1oaW50IiwgaGludCwKICAgICAgICAgICAg\naGludC5nZXRDbGFzcygpKSkuc2V0Q2F1c2UoY2F1c2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgdXNlci1naXZlbiBoaW50IHZhbHVl\nIHRvIGFuIGFycmF5IG9mIGFnZ3JlZ2F0ZSBsaXN0ZW5lcnMuCiAgICAgKiBU\naGUgaGludCBjYW4gYmUgYW4gYWdncmVnYXRlIGxpc3RlbmVyLCBhZ2dyZWdh\ndGUgbGlzdGVuZXIgYXJyYXksCiAgICAgKiBjb2xsZWN0aW9uLCBvciBjb21t\nYS1zZXBhcmF0ZWQgY2xhc3MgbmFtZXMuCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgQWdncmVnYXRlTGlzdGVuZXJbXSBoaW50VG9BZ2dyZWdhdGVMaXN0\nZW5lcnMoT2JqZWN0IGhpbnQsIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAg\nICAgIGlmIChoaW50ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIGlmIChoaW50IGluc3RhbmNlb2YgQWdncmVnYXRlTGlzdGVu\nZXJbXSkKICAgICAgICAgICAgcmV0dXJuIChBZ2dyZWdhdGVMaXN0ZW5lcltd\nKSBoaW50OwogICAgICAgIGlmIChoaW50IGluc3RhbmNlb2YgQWdncmVnYXRl\nTGlzdGVuZXIpCiAgICAgICAgICAgIHJldHVybiBuZXcgQWdncmVnYXRlTGlz\ndGVuZXJbXXsgKEFnZ3JlZ2F0ZUxpc3RlbmVyKSBoaW50IH07CiAgICAgICAg\naWYgKGhpbnQgaW5zdGFuY2VvZiBDb2xsZWN0aW9uKSB7CiAgICAgICAgICAg\nIENvbGxlY3Rpb248QWdncmVnYXRlTGlzdGVuZXI+IGMgPSAoQ29sbGVjdGlv\nbjxBZ2dyZWdhdGVMaXN0ZW5lcj4pIGhpbnQ7CiAgICAgICAgICAgIHJldHVy\nbiBjLnRvQXJyYXkobmV3IEFnZ3JlZ2F0ZUxpc3RlbmVyW2Muc2l6ZSgpXSk7\nCiAgICAgICAgfQoKICAgICAgICBFeGNlcHRpb24gY2F1c2UgPSBudWxsOwog\nICAgICAgIGlmIChoaW50IGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAg\nICAgIFN0cmluZ1tdIGNsc3MgPSBTdHJpbmdzLnNwbGl0KChTdHJpbmcpIGhp\nbnQsICIsIiwgMCk7CiAgICAgICAgICAgIEFnZ3JlZ2F0ZUxpc3RlbmVyW10g\nYWdncyA9IG5ldyBBZ2dyZWdhdGVMaXN0ZW5lcltjbHNzLmxlbmd0aF07CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNsc3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAg\nYWdnc1tpXSA9IChBZ2dyZWdhdGVMaXN0ZW5lcikgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZShjbHNzW2ldLCB0cnVlLCBsb2Fk\nZXIpKSk7IAogICAgICAgICAgICAgICAgcmV0dXJuIGFnZ3M7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBp\nZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAg\nICAgICAgICAgICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICBjYXVz\nZSA9IGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1hZ2ctbGlzdGVuZXIt\naGludCIsIGhpbnQsCiAgICAgICAgICAgIGhpbnQuZ2V0Q2xhc3MoKSkpLnNl\ndENhdXNlKGNhdXNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHVzZXItZ2l2ZW4gaGludCB2YWx1ZSB0byBhIGZpbHRlciBsaXN0ZW5l\nci4KICAgICAqIFRoZSBoaW50IGNhbiBiZSBhIGZpbHRlciBsaXN0ZW5lciBp\nbnN0YW5jZSBvciBjbGFzcyBuYW1lLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIEZpbHRlckxpc3RlbmVyIGhpbnRUb0ZpbHRlckxpc3RlbmVyKE9iamVj\ndCBoaW50LCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBpZiAoaGlu\ndCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nZiAoaGludCBpbnN0YW5jZW9mIEZpbHRlckxpc3RlbmVyKQogICAgICAgICAg\nICByZXR1cm4gKEZpbHRlckxpc3RlbmVyKSBoaW50OwoKICAgICAgICBFeGNl\ncHRpb24gY2F1c2UgPSBudWxsOwogICAgICAgIGlmIChoaW50IGluc3RhbmNl\nb2YgU3RyaW5nKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gKEZpbHRlckxpc3RlbmVyKSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5uZXdJbnN0YW5jZUFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nQ2xhc3MuZm9yTmFtZSgoU3RyaW5nKSBoaW50LCB0cnVlLCBsb2FkZXIpKSk7\nIAogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKQogICAgICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRB\nY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAg\nICAgICAgY2F1c2UgPSBlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmls\ndGVyLWxpc3RlbmVyLWhpbnQiLCBoaW50LAogICAgICAgICAgICBoaW50Lmdl\ndENsYXNzKCkpKS5zZXRDYXVzZShjYXVzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZXJ0IHRoZSB1c2VyLWdpdmVuIGhpbnQgdmFsdWUgdG8gYW4g\nYXJyYXkgb2YgZmlsdGVyIGxpc3RlbmVycy4KICAgICAqIFRoZSBoaW50IGNh\nbiBiZSBhIGZpbHRlciBsaXN0ZW5lciwgZmlsdGVyIGxpc3RlbmVyIGFycmF5\nLAogICAgICogY29sbGVjdGlvbiwgb3IgY29tbWEtc2VwYXJhdGVkIGNsYXNz\nIG5hbWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIEZpbHRlckxpc3Rl\nbmVyW10gaGludFRvRmlsdGVyTGlzdGVuZXJzKE9iamVjdCBoaW50LCBDbGFz\nc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBpZiAoaGludCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaGludCBpbnN0\nYW5jZW9mIEZpbHRlckxpc3RlbmVyW10pCiAgICAgICAgICAgIHJldHVybiAo\nRmlsdGVyTGlzdGVuZXJbXSkgaGludDsKICAgICAgICBpZiAoaGludCBpbnN0\nYW5jZW9mIEZpbHRlckxpc3RlbmVyKQogICAgICAgICAgICByZXR1cm4gbmV3\nIEZpbHRlckxpc3RlbmVyW117IChGaWx0ZXJMaXN0ZW5lcikgaGludCB9Owog\nICAgICAgIGlmIChoaW50IGluc3RhbmNlb2YgQ29sbGVjdGlvbikgewogICAg\nICAgICAgICBDb2xsZWN0aW9uPEZpbHRlckxpc3RlbmVyPiBjID0gKENvbGxl\nY3Rpb248RmlsdGVyTGlzdGVuZXI+KSBoaW50OwogICAgICAgICAgICByZXR1\ncm4gYy50b0FycmF5KG5ldyBGaWx0ZXJMaXN0ZW5lcltjLnNpemUoKV0pOwog\nICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9uIGNhdXNlID0gbnVsbDsKICAg\nICAgICBpZiAoaGludCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAg\nICBTdHJpbmdbXSBjbHNzID0gU3RyaW5ncy5zcGxpdCgoU3RyaW5nKSBoaW50\nLCAiLCIsIDApOwogICAgICAgICAgICBGaWx0ZXJMaXN0ZW5lcltdIGZpbHRz\nID0gbmV3IEZpbHRlckxpc3RlbmVyW2Nsc3MubGVuZ3RoXTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY2xzcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBmaWx0c1tp\nXSA9IChGaWx0ZXJMaXN0ZW5lcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLm5ld0luc3RhbmNlQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgQ2xhc3MuZm9yTmFtZShjbHNzW2ldLCB0cnVlLCBsb2FkZXIpKSk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmlsdHM7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0\nYW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAgICAgICAgICAg\nICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgZSku\nZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICBjYXVzZSA9IGU7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoImJhZC1maWx0ZXItbGlzdGVuZXItaGludCIs\nIGhpbnQsCiAgICAgICAgICAgIGhpbnQuZ2V0Q2xhc3MoKSkpLnNldENhdXNl\nKGNhdXNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmFs\ndWUgb2YgdGhlIHByb3BlcnR5IG5hbWVkIGJ5IHRoZSBoaW50IGtleS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgaGludFRvR2V0dGVyKE9i\namVjdCB0YXJnZXQsIFN0cmluZyBoaW50S2V5KSB7CiAgICAgICAgaWYgKHRh\ncmdldCA9PSBudWxsIHx8IGhpbnRLZXkgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIE1ldGhvZCBnZXR0ZXIgPSBSZWZsZWN0\naW9uLmZpbmRHZXR0ZXIodGFyZ2V0LmdldENsYXNzKCksIGhpbnRLZXksIHRy\ndWUpOwogICAgICAgIHJldHVybiBSZWZsZWN0aW9uLmdldCh0YXJnZXQsIGdl\ndHRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9m\nIHRoZSBwcm9wZXJ0eSBuYW1lZCBieSB0aGUgaGludCBrZXkuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBoaW50VG9TZXR0ZXIoT2JqZWN0IHRh\ncmdldCwgU3RyaW5nIGhpbnRLZXksCiAgICAgICAgT2JqZWN0IHZhbHVlKSB7\nCiAgICAgICAgaWYgKHRhcmdldCA9PSBudWxsIHx8IGhpbnRLZXkgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBNZXRob2Qgc2V0dGVy\nID0gUmVmbGVjdGlvbi5maW5kU2V0dGVyKHRhcmdldC5nZXRDbGFzcygpLCBo\naW50S2V5LCB0cnVlKTsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBT\ndHJpbmcpIHsKICAgICAgICAgICAgaWYgKCJudWxsIi5lcXVhbHModmFsdWUp\nKQogICAgICAgICAgICAgICAgdmFsdWUgPSBudWxsOwogICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgdmFsdWUgPSBTdHJpbmdzLnBhcnNlKChTdHJpbmcpIHZhbHVlLAogICAg\nICAgICAgICAgICAgICAgICAgICBzZXR0ZXIuZ2V0UGFyYW1ldGVyVHlwZXMo\nKVswXSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtc2V0dGVyLWhpbnQtYXJnIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgaGludEtleSwgdmFsdWUsIHNldHRlci5nZXRQYXJhbWV0\nZXJUeXBlcygpWzBdKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIHNldENh\ndXNlKGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIFJlZmxlY3Rpb24uc2V0KHRhcmdldCwgc2V0dGVyLCB2\nYWx1ZSk7Cgl9CiAgICAKICAgIC8qKgogICAgICogUGFyc2VzIHRoZSBnaXZl\nbiBzdHJpbmcgYXNzdW1pbmcgaXQgaXMgYSBKREJDIGtleSBleHByZXNzaW9u\nLiBFeHRyYWN0cyB0aGUgCiAgICAgKiBkYXRhIHBvcnRpb24gYW5kIGJhc2Vk\nIG9uIHRoZSBrZXksIGNhbGxzIHN0YXRpYyBqYXZhLnNxbC5EYXRlL1RpbWUv\nVGltZXN0YW1wLnZhbHVlT2YoU3RyaW5nKQogICAgICogbWV0aG9kIHRvIGNv\nbnZlcnQgdG8gYSBqYXZhLnNxbC5EYXRlL1RpbWUvVGltZXN0YW1wIGluc3Rh\nbmNlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBwYXJzZUpE\nQkNUZW1wb3JhbFN5bnRheChTdHJpbmcgcykgewogICAgICAgIHMgPSBjbGlw\nKHMudHJpbSgpLCAieyIsICJ9IiwgdHJ1ZSk7CiAgICAgICAgaWYgKHMuc3Rh\ncnRzV2l0aCgidHMiKSkgewogICAgICAgICAgICByZXR1cm4gamF2YS5zcWwu\nVGltZXN0YW1wLnZhbHVlT2YoY2xpcChzLnN1YnN0cmluZygyKS50cmltKCks\nICInIiwgIiciLCBmYWxzZSkpOwogICAgICAgIH0gZWxzZSBpZiAocy5zdGFy\ndHNXaXRoKCJkIikpIHsKICAgICAgICAgICAgcmV0dXJuIGphdmEuc3FsLkRh\ndGUudmFsdWVPZihjbGlwKHMuc3Vic3RyaW5nKDEpLnRyaW0oKSwgIiciLCAi\nJyIsIGZhbHNlKSk7CiAgICAgICAgfSBlbHNlIGlmIChzLnN0YXJ0c1dpdGgo\nInQiKSkgewogICAgICAgICAgICByZXR1cm4gamF2YS5zcWwuVGltZS52YWx1\nZU9mKGNsaXAocy5zdWJzdHJpbmcoMikudHJpbSgpLCAiJyIsICInIiwgZmFs\nc2UpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJt\ncyBpZiB0aGUgZ2l2ZW4gU3RyaW5nIGlzIGVuY2xvc2VkIGluIHt9LgogICAg\nICogCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0pEQkNU\nZW1wb3JhbFN5bnRheChTdHJpbmcgcykgewogICAgICAgIGlmIChzICE9IG51\nbGwpIHsKICAgICAgICAgICAgcyA9IHMudHJpbSgpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcyAhPSBudWxsICYmIHMuc3RhcnRzV2l0aCgieyIpICYm\nIHMuZW5kc1dpdGgoIn0iKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBS\nZW1vdmVzIHRoZSBmaXJzdCBhbmQgbGFzdCBzdHJpbmcgaWYgdGhleSBhcmUg\ndGhlIHRlcm1pbmFsIHNlcXVlbmNlIGluIHRoZSBnaXZlbiBzdHJpbmcuCiAg\nICAgKiAKICAgICAqIEBwYXJhbSBzIGEgc3RyaW5nIHRvIGJlIGV4YW1pbmVk\nCiAgICAgKiBAcGFyYW0gZmlyc3QgdGhlIGNoYXJhY3RlcnMgaW4gdGhlIGJl\nZ2lubmluZyBvZiB0aGUgZ2l2ZW4gc3RyaW5nCiAgICAgKiBAcGFyYW0gbGFz\ndCB0aGUgY2hhcmFjdGVycyBpbiB0aGUgZW5kIG9mIHRoZSBnaXZlbiBzdHJp\nbmcKICAgICAqIEBwYXJhbSBmYWlsIGlmIHRydWUgdGhyb3dzIGV4Y2VwdGlv\nbiBpZiB0aGUgZ2l2ZW4gc3RyaW5nIGRvZXMgbm90IGhhdmUgdGhlIGdpdmVu\nIHRlcm1pbmFsIHNlcXVlbmNlcy4KICAgICAqIEByZXR1cm4gdGhlIHN0cmlu\nZyB3aXRoIHRlcm1pbmFsIHNlcXVlbmNlcyByZW1vdmVkLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIFN0cmluZyBjbGlwKFN0cmluZyBzLCBTdHJpbmcg\nZmlyc3QsIFN0cmluZyBsYXN0LCBib29sZWFuIGZhaWwpIHsKICAgICAgICBp\nZiAocyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICBp\nZiAocy5zdGFydHNXaXRoKGZpcnN0KSAmJiBzLmVuZHNXaXRoKGxhc3QpKSB7\nCiAgICAgICAgICAgIHJldHVybiBzLnN1YnN0cmluZyhmaXJzdC5sZW5ndGgo\nKSwgcy5sZW5ndGgoKS1sYXN0Lmxlbmd0aCgpKS50cmltKCk7CiAgICAgICAg\nfQogICAgICAgIGlmIChmYWlsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24ocyArICIgaXMgbm90IHZhbGlkIGVz\nY2FwZSBzeW50YXggZm9yIEpEQkMiKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0\naGUgZ2l2ZW4gY2xhc3MgaXMgRGF0YSwgVGltZSBvciBUaW1lc3RhbXAuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc1RlbXBvcmFsVHlw\nZShDbGFzczw/PiBjKSB7CiAgICAgICAgcmV0dXJuIGMgIT0gbnVsbCAKICAg\nICAgICAgICAgJiYgKERhdGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjKSAK\nICAgICAgICAgICAgIHx8IFRpbWUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShj\nKSAKICAgICAgICAgICAgIHx8IFRpbWVzdGFtcC5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKGMpCiAgICAgICAgICAgICB8fCBDYWxlbmRhci5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKGMpKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRp\nYyBPYmplY3QgZ2V0RGVmYXVsdEZvck51bGwoQ2xhc3M8Pz4gblR5cGUpIHsK\nICAgICAgICBpZiAoblR5cGUgPT0gTG9uZy5jbGFzcykgCiAgICAgICAgICAg\nIHJldHVybiBuZXcgTG9uZygwKTsKICAgICAgICBpZiAoblR5cGUgPT0gSW50\nZWdlci5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG5ldyBJbnRlZ2VyKDAp\nOwogICAgICAgIGlmIChuVHlwZSA9PSBEb3VibGUuY2xhc3MpIAogICAgICAg\nICAgICByZXR1cm4gbmV3IERvdWJsZSgwLjApOwogICAgICAgIGlmIChuVHlw\nZSA9PSBGbG9hdC5jbGFzcykgCiAgICAgICAgICAgIHJldHVybiBuZXcgRmxv\nYXQoMC4wKTsKICAgICAgICBpZiAoblR5cGUgPT0gU2hvcnQuY2xhc3MpIAog\nICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0KChzaG9ydCkwKTsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCn0K\n","encoding":"base64"}

