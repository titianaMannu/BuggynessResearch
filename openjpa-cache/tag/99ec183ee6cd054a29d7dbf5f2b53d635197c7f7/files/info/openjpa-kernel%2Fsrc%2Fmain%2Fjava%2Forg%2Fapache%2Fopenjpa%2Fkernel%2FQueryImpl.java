{"sha":"9eaa8cd063236ddb71689cf7d72064cb80d8f311","node_id":"MDQ6QmxvYjIwNjM2NDo5ZWFhOGNkMDYzMjM2ZGRiNzE2ODljZjdkNzIwNjRjYjgwZDhmMzEx","size":75097,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9eaa8cd063236ddb71689cf7d72064cb80d8f311","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdEl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5jb25jdXJyZW50LmxvY2tzLlJlZW50cmFudExvY2s7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5MaW5rZWRNYXA7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLmV4cHMuQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLmV4cHMuQ29uc3RhbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuTGl0ZXJhbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXRoOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlF1ZXJ5RXhwcmVzc2lv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFs\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuRWFnZXJSZXN1bHRMaXN0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuTWVyZ2VkUmVz\ndWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnJvcC5SYW5nZVJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0TGlzdDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncmRlcmVkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLlJlZmVyZW5jZUhhc2hTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuTm9SZXN1bHRFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob25VbmlxdWVSZXN1bHRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBB\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5z\ndXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJz\nOwppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogSW1wbGVtZW50\nYXRpb24gb2YgdGhlIHtAbGluayBRdWVyeX0gaW50ZXJmYWNlLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpAU3VwcHJlc3NX\nYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNsYXNzIFF1ZXJ5SW1wbAogICAg\naW1wbGVtZW50cyBRdWVyeSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZShRdWVyeUlt\ncGwuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9sYW5ndWFn\nZTsKICAgIHByaXZhdGUgZmluYWwgU3RvcmVRdWVyeSBfc3RvcmVRdWVyeTsK\nICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIEJyb2tlckltcGwgX2Jyb2tl\ncjsKICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIExvZyBfbG9nOwogICAg\ncHJpdmF0ZSB0cmFuc2llbnQgQ2xhc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7\nCgogICAgLy8gcXVlcnkgaGFzIGl0cyBvd24gaW50ZXJuYWwgbG9jawogICAg\ncHJpdmF0ZSBSZWVudHJhbnRMb2NrIF9sb2NrOwoKICAgIC8vIHVucGFyc2Vk\nIHN0YXRlCiAgICBwcml2YXRlIENsYXNzPD8+IF9jbGFzcyA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX3N1YmNsYXNzZXMgPSB0cnVlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9yZWFkT25seSA9IGZhbHNlOwogICAgcHJpdmF0ZSBT\ndHJpbmcgX3F1ZXJ5ID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9wYXJh\nbXMgPSBudWxsOwoKICAgIC8vIHBhcnNlZCBzdGF0ZQogICAgcHJpdmF0ZSB0\ncmFuc2llbnQgQ29tcGlsYXRpb24gX2NvbXBpbGVkID0gbnVsbDsKICAgIHBy\naXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX2NvbXBpbGluZyA9IGZhbHNlOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVzdWx0UGFja2VyIF9wYWNrZXIgPSBu\ndWxsOwoKICAgIC8vIGNhbmRpZGF0ZXMKICAgIHByaXZhdGUgdHJhbnNpZW50\nIENvbGxlY3Rpb248Pz4gX2NvbGxlY3Rpb24gPSBudWxsOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgRXh0ZW50IF9leHRlbnQgPSBudWxsOwoKICAgIC8vIGxp\nc3RlbmVycwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLEZpbHRlckxpc3RlbmVy\nPiBfZmlsdExpc3RlbmVycyA9IG51bGw7CiAgICBwcml2YXRlIE1hcDxTdHJp\nbmcsQWdncmVnYXRlTGlzdGVuZXI+IF9hZ2dMaXN0ZW5lcnMgPSBudWxsOwoK\nICAgIC8vIGNvbmZpZ3VyYXRpb24gZm9yIGxvYWRpbmcgb2JqZWN0cwogICAg\ncHJpdmF0ZSBGZXRjaENvbmZpZ3VyYXRpb24gX2ZjID0gbnVsbDsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaWdub3JlQ2hhbmdlcyA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBDbGFzczw/PiBfcmVzdWx0TWFwcGluZ1Njb3BlID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RyaW5nIF9yZXN1bHRNYXBwaW5nTmFtZSA9IG51bGw7Cgog\nICAgLy8gdGhlc2UgZmllbGRzIHNob3VsZCBvbmx5IGJlIHVzZWQgZGlyZWN0\nbHkgYWZ0ZXIgd2UgaGF2ZSBhIGNvbXBpbGF0aW9uLAogICAgLy8gYmVjYXVz\nZSB0aGVpciB2YWx1ZXMgbWF5IGJlIGVuY29kZWQgaW4gdGhlIHF1ZXJ5IHN0\ncmluZwogICAgcHJpdmF0ZSBCb29sZWFuIF91bmlxdWUgPSBudWxsOwogICAg\ncHJpdmF0ZSBDbGFzczw/PiBfcmVzdWx0Q2xhc3MgPSBudWxsOwogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgbG9uZyBfc3RhcnRJZHggPSAwOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgbG9uZyBfZW5kSWR4ID0gTG9uZy5NQVhfVkFMVUU7CiAg\nICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9yYW5nZVNldCA9IGZhbHNl\nOwoKICAgIC8vIHJlbWVtYmVyIHRoZSBsaXN0IG9mIGFsbCB0aGUgcmVzdWx0\ncyB3ZSBoYXZlIHJldHVybmVkIHNvIHdlCiAgICAvLyBjYW4gZnJlZSB0aGVp\nciByZXNvdXJjZXMgd2hlbiBjbG9zZSBvciBjbG9zZUFsbCBpcyBjYWxsZWQK\nICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIENvbGxlY3Rpb248UmVtb3Zl\nT25DbG9zZVJlc3VsdExpc3Q+IF9yZXN1bHRMaXN0cyA9IAogICAgICAgIG5l\ndyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSBxdWVyeSBtYW5hZ2VkIGJ5IHRo\nZSBnaXZlbiBicm9rZXIuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeUltcGwo\nQnJva2VyIGJyb2tlciwgU3RyaW5nIGxhbmd1YWdlLCBTdG9yZVF1ZXJ5IHN0\nb3JlUXVlcnkpIHsKICAgICAgICBfYnJva2VyID0gKEJyb2tlckltcGwpIGJy\nb2tlcjsKICAgICAgICBfbGFuZ3VhZ2UgPSBsYW5ndWFnZTsKICAgICAgICBf\nc3RvcmVRdWVyeSA9IHN0b3JlUXVlcnk7CiAgICAgICAgX2ZjID0gKEZldGNo\nQ29uZmlndXJhdGlvbikgYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigp\nLmNsb25lKCk7CiAgICAgICAgX2xvZyA9IGJyb2tlci5nZXRDb25maWd1cmF0\naW9uKCkuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19RVUVSWSk7\nCiAgICAgICAgX3N0b3JlUXVlcnkuc2V0Q29udGV4dCh0aGlzKTsKCiAgICAg\nICAgaWYgKF9icm9rZXIgIT0gbnVsbCAmJiBfYnJva2VyLmdldE11bHRpdGhy\nZWFkZWQoKSkKICAgICAgICAgICAgX2xvY2sgPSBuZXcgUmVlbnRyYW50TG9j\naygpOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgc3RvcmUgcXVl\ncnkuCiAgICAgKi8KICAgIHB1YmxpYyBTdG9yZVF1ZXJ5IGdldFN0b3JlUXVl\ncnkoKSB7CiAgICAgICAgcmV0dXJuIF9zdG9yZVF1ZXJ5OwogICAgfQoKICAg\nIHB1YmxpYyBCcm9rZXIgZ2V0QnJva2VyKCkgewogICAgICAgIHJldHVybiBf\nYnJva2VyOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeSBnZXRRdWVyeSgpIHsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVD\nb250ZXh0IGdldFN0b3JlQ29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2Jy\nb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldExhbmd1YWdlKCkg\newogICAgICAgIHJldHVybiBfbGFuZ3VhZ2U7CiAgICB9CgogICAgcHVibGlj\nIEZldGNoQ29uZmlndXJhdGlvbiBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKSB7\nCiAgICAgICAgcmV0dXJuIF9mYzsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFF1ZXJ5U3RyaW5nKCkgewogICAgICAgIHJldHVybiBfcXVlcnk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygpIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9pZ25vcmVD\naGFuZ2VzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldElnbm9yZUNoYW5n\nZXMoYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgLy8g\nYWxsb3dlZCBtb2RpZmljYXRpb246IG5vIHJlYWQtb25seSBjaGVjawogICAg\nICAgICAgICBfaWdub3JlQ2hhbmdlcyA9IGZsYWc7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzUmVhZE9ubHkoKSB7CiAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBfcmVhZE9ubHk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0UmVhZE9ubHkoYm9vbGVhbiBmbGFnKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICAgICAgX3JlYWRPbmx5ID0gZmxhZzsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgYWRkRmlsdGVyTGlzdGVuZXIoRmls\ndGVyTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAg\nICBhc3NlcnROb3RSZWFkT25seSgpOwogICAgICAgICAgICBpZiAoX2ZpbHRM\naXN0ZW5lcnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9maWx0TGlzdGVu\nZXJzID0gbmV3IEhhc2hNYXA8U3RyaW5nLEZpbHRlckxpc3RlbmVyPig1KTsK\nICAgICAgICAgICAgX2ZpbHRMaXN0ZW5lcnMucHV0KGxpc3RlbmVyLmdldFRh\nZygpLCBsaXN0ZW5lcik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlbW92ZUZpbHRlckxpc3RlbmVyKEZpbHRlckxpc3RlbmVyIGxpc3RlbmVy\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHko\nKTsKICAgICAgICAgICAgaWYgKF9maWx0TGlzdGVuZXJzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfZmlsdExpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIu\nZ2V0VGFnKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlv\nbjxGaWx0ZXJMaXN0ZW5lcj4gZ2V0RmlsdGVyTGlzdGVuZXJzKCkgewogICAg\nICAgIGlmIChfZmlsdExpc3RlbmVycyA9PSBudWxsKSAKICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgcmV0dXJuIF9maWx0TGlzdGVuZXJzLnZhbHVlcygpOwog\nICAgfQoKICAgIHB1YmxpYyBGaWx0ZXJMaXN0ZW5lciBnZXRGaWx0ZXJMaXN0\nZW5lcihTdHJpbmcgdGFnKSB7CiAgICAgICAgLy8gZmlyc3QgY2hlY2sgbGlz\ndGVuZXJzIGZvciB0aGlzIHF1ZXJ5CiAgICAgICAgaWYgKF9maWx0TGlzdGVu\nZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgRmlsdGVyTGlzdGVuZXIgbGlz\ndGVuID0gKEZpbHRlckxpc3RlbmVyKSBfZmlsdExpc3RlbmVycy5nZXQodGFn\nKTsKICAgICAgICAgICAgaWYgKGxpc3RlbiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGxpc3RlbjsKICAgICAgICB9CgogICAgICAgIC8vIGNo\nZWNrIHVzZXItZGVmaW5lZCBsaXN0ZW5lcnMgZnJvbSBjb25maWd1cmF0aW9u\nCiAgICAgICAgRmlsdGVyTGlzdGVuZXJbXSBjb25mTGlzdGVuZXJzID0gX2Jy\nb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldEZpbHRl\nckxpc3RlbmVySW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb25mTGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoY29uZkxpc3RlbmVyc1tpXS5nZXRUYWcoKS5lcXVhbHModGFnKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBjb25mTGlzdGVuZXJzW2ldOwoKICAgICAg\nICAvLyBjaGVjayBzdG9yZSBsaXN0ZW5lcnMKICAgICAgICByZXR1cm4gX3N0\nb3JlUXVlcnkuZ2V0RmlsdGVyTGlzdGVuZXIodGFnKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBhZGRBZ2dyZWdhdGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0\nZW5lciBsaXN0ZW5lcikgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2Vy\ndE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAgIGlmIChfYWdnTGlzdGVuZXJz\nID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWdnTGlzdGVuZXJzID0gbmV3\nIEhhc2hNYXA8U3RyaW5nLEFnZ3JlZ2F0ZUxpc3RlbmVyPig1KTsKICAgICAg\nICAgICAgX2FnZ0xpc3RlbmVycy5wdXQobGlzdGVuZXIuZ2V0VGFnKCksIGxp\nc3RlbmVyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3Zl\nQWdncmVnYXRlTGlzdGVuZXIoQWdncmVnYXRlTGlzdGVuZXIgbGlzdGVuZXIp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb3RSZWFkT25seSgp\nOwogICAgICAgICAgICBpZiAoX2FnZ0xpc3RlbmVycyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX2FnZ0xpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIuZ2V0\nVGFnKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbjxB\nZ2dyZWdhdGVMaXN0ZW5lcj4gZ2V0QWdncmVnYXRlTGlzdGVuZXJzKCkgewog\nICAgICAgIGlmIChfYWdnTGlzdGVuZXJzID09IG51bGwpIAogICAgICAgICAg\nICByZXR1cm4gQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICByZXR1cm4gX2FnZ0xpc3RlbmVycy52YWx1ZXMoKTsK\nICAgIH0KCiAgICBwdWJsaWMgQWdncmVnYXRlTGlzdGVuZXIgZ2V0QWdncmVn\nYXRlTGlzdGVuZXIoU3RyaW5nIHRhZykgewogICAgICAgIC8vIGZpcnN0IGNo\nZWNrIGxpc3RlbmVycyBmb3IgdGhpcyBxdWVyeQogICAgICAgIGlmIChfYWdn\nTGlzdGVuZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgQWdncmVnYXRlTGlz\ndGVuZXIgbGlzdGVuID0gKEFnZ3JlZ2F0ZUxpc3RlbmVyKSBfYWdnTGlzdGVu\nZXJzLgogICAgICAgICAgICAgICAgZ2V0KHRhZyk7CiAgICAgICAgICAgIGlm\nIChsaXN0ZW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBsaXN0\nZW47CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayB1c2VyLWRlZmluZWQg\nbGlzdGVuZXJzIGZyb20gY29uZmlndXJhdGlvbgogICAgICAgIEFnZ3JlZ2F0\nZUxpc3RlbmVyW10gY29uZkxpc3RlbmVycyA9IF9icm9rZXIuZ2V0Q29uZmln\ndXJhdGlvbigpLgogICAgICAgICAgICBnZXRBZ2dyZWdhdGVMaXN0ZW5lcklu\nc3RhbmNlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uZkxp\nc3RlbmVycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNvbmZMaXN0\nZW5lcnNbaV0uZ2V0VGFnKCkuZXF1YWxzKHRhZykpCiAgICAgICAgICAgICAg\nICByZXR1cm4gY29uZkxpc3RlbmVyc1tpXTsKCiAgICAgICAgLy8gY2hlY2sg\nc3RvcmUgbGlzdGVuZXJzCiAgICAgICAgcmV0dXJuIF9zdG9yZVF1ZXJ5Lmdl\ndEFnZ3JlZ2F0ZUxpc3RlbmVyKHRhZyk7CiAgICB9CgogICAgcHVibGljIEV4\ndGVudCBnZXRDYW5kaWRhdGVFeHRlbnQoKSB7CiAgICAgICAgLy8gaWYganVz\ndCB0aGUgY2xhc3MgaXMgc2V0LCBmZXRjaCB0aGUgY29ycmVzcG9uZGluZyBl\neHRlbnQ7IGlmIHRoZQogICAgICAgIC8vIGV4dGVudCBpcyBhbHJlYWR5IHNl\ndCBidXQgaXRzIGlnbm9yZSBjYWNoZSBzZXR0aW5nIGlzIHdyb25nLAogICAg\nICAgIC8vIGdldCBhIG5ldyBleHRlbnQgd2l0aCB0aGUgY29ycmVjdCBzZXR0\naW5nIChkb24ndCBtb2RpZnkgb3JpZyBleHRlbnQKICAgICAgICAvLyBpbiBj\nYXNlIHRoZSB1c2VyIGhhcyBhIHJlZmVyZW5jZSB0byBpdCBhbmQgbWlnaHQg\ndXNlIGl0KQogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBDbGFzczw/PiBjbHMgPSBnZXRDYW5kaWRhdGVUeXBlKCk7CiAgICAg\nICAgICAgIGlmIChfZXh0ZW50ID09IG51bGwgJiYgX2NvbGxlY3Rpb24gPT0g\nbnVsbCAmJiBfYnJva2VyICE9IG51bGwKICAgICAgICAgICAgICAgICYmIGNs\ncyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gX2Jyb2tl\nci5uZXdFeHRlbnQoY2xzLCBfc3ViY2xhc3Nlcyk7CiAgICAgICAgICAgICAg\nICBfZXh0ZW50LnNldElnbm9yZUNoYW5nZXMoX2lnbm9yZUNoYW5nZXMpOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKF9leHRlbnQgIT0gbnVsbAogICAgICAg\nICAgICAgICAgJiYgX2V4dGVudC5nZXRJZ25vcmVDaGFuZ2VzKCkgIT0gX2ln\nbm9yZUNoYW5nZXMgJiYgY2xzICE9IG51bGwpewogICAgICAgICAgICAgICAg\nX2V4dGVudCA9IF9icm9rZXIubmV3RXh0ZW50KGNscywgX2V4dGVudC5oYXNT\ndWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgX2V4dGVudC5zZXRJZ25v\ncmVDaGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gX2V4dGVudDsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0Q2FuZGlkYXRlRXh0ZW50KEV4dGVudCBjYW5kaWRhdGVF\neHRlbnQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb3RSZWFk\nT25seSgpOwoKICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZUV4dGVudCA9PSBf\nZXh0ZW50KQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBp\nZiAoY2FuZGlkYXRlRXh0ZW50ID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIF9leHRlbnQgPSBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiBleHRlbnQgdGhlbiBub3Qg\nY29sbGVjdGlvbgogICAgICAgICAgICBfZXh0ZW50ID0gY2FuZGlkYXRlRXh0\nZW50OwogICAgICAgICAgICBfY29sbGVjdGlvbiA9IG51bGw7CgogICAgICAg\nICAgICBib29sZWFuIGludmFsaWRhdGUgPSBmYWxzZTsKICAgICAgICAgICAg\naWYgKF9leHRlbnQuZ2V0RWxlbWVudFR5cGUoKSAhPSBfY2xhc3MpIHsKICAg\nICAgICAgICAgICAgIF9jbGFzcyA9IF9leHRlbnQuZ2V0RWxlbWVudFR5cGUo\nKTsKICAgICAgICAgICAgICAgIF9sb2FkZXIgPSBudWxsOwogICAgICAgICAg\nICAgICAgaW52YWxpZGF0ZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKF9leHRlbnQuaGFzU3ViY2xhc3NlcygpICE9IF9zdWJjbGFz\nc2VzKSB7CiAgICAgICAgICAgICAgICBfc3ViY2xhc3NlcyA9IF9leHRlbnQu\naGFzU3ViY2xhc3NlcygpOwogICAgICAgICAgICAgICAgaW52YWxpZGF0ZSA9\nIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGludmFsaWRh\ndGUpCiAgICAgICAgICAgICAgICBpbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb248Pz4gZ2V0Q2Fu\nZGlkYXRlQ29sbGVjdGlvbigpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgcmV0dXJuIF9jb2xsZWN0aW9uOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldENhbmRpZGF0ZUNvbGxlY3Rpb24oQ29sbGVjdGlvbjw/PiBjYW5k\naWRhdGVDb2xsZWN0aW9uKSB7CiAgICAgICAgaWYgKCFfc3RvcmVRdWVyeS5z\ndXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgicXVlcnktbm9z\ndXBwb3J0IiwKICAgICAgICAgICAgICAgIF9sYW5ndWFnZSkpOwoKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Bl\nbigpOwoKICAgICAgICAgICAgLy8gaWYgY29sbGVjdGlvbiB0aGVuIG5vdCBl\neHRlbnQKICAgICAgICAgICAgX2NvbGxlY3Rpb24gPSBjYW5kaWRhdGVDb2xs\nZWN0aW9uOwogICAgICAgICAgICBpZiAoX2NvbGxlY3Rpb24gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9leHRlbnQgPSBudWxsOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgQ2xhc3MgZ2V0Q2FuZGlkYXRlVHlwZSgpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgICAgICBpZiAoX2NsYXNzICE9IG51bGwgfHwgX2NvbXBp\nbGVkICE9IG51bGwgfHwgX3F1ZXJ5ID09IG51bGwKICAgICAgICAgICAgICAg\nIHx8IF9icm9rZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBf\nY2xhc3M7CgogICAgICAgICAgICAvLyBjaGVjayBhZ2FpbiBhZnRlciBjb21w\naWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcKICAgICAgICAgICAg\nY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAgIHJldHVybiBf\nY2xhc3M7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENhbmRp\nZGF0ZVR5cGUoQ2xhc3MgY2FuZGlkYXRlQ2xhc3MsIGJvb2xlYW4gc3Vicykg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7\nCiAgICAgICAgICAgIF9jbGFzcyA9IGNhbmRpZGF0ZUNsYXNzOwogICAgICAg\nICAgICBfc3ViY2xhc3NlcyA9IHN1YnM7CiAgICAgICAgICAgIF9sb2FkZXIg\nPSBudWxsOwogICAgICAgICAgICBpbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzU3ViY2xhc3Nl\ncygpIHsKICAgICAgICByZXR1cm4gX3N1YmNsYXNzZXM7CiAgICB9CgogICAg\ncHVibGljIFN0cmluZyBnZXRSZXN1bHRNYXBwaW5nTmFtZSgpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9yZXN1bHRNYXBwaW5n\nTmFtZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0UmVzdWx0TWFwcGlu\nZ1Njb3BlKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1\ncm4gX3Jlc3VsdE1hcHBpbmdTY29wZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRSZXN1bHRNYXBwaW5nKENsYXNzPD8+IHNjb3BlLCBTdHJpbmcgbmFt\nZSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIF9yZXN1bHRNYXBwaW5nU2Nv\ncGUgPSBzY29wZTsKICAgICAgICAgICAgX3Jlc3VsdE1hcHBpbmdOYW1lID0g\nbmFtZTsKICAgICAgICAgICAgX3BhY2tlciA9IG51bGw7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVW5pcXVlKCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgICAgIGlmIChfdW5pcXVlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gX3VuaXF1ZS5ib29sZWFuVmFsdWUoKTsKICAgICAgICAg\nICAgaWYgKChfcXVlcnkgPT0gbnVsbCAmJiBfbGFuZ3VhZ2UuZW5kc1dpdGgo\nIkpQUUwiKSkgfHwgX2NvbXBpbGluZyB8fCBfYnJva2VyID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAvLyBj\naGVjayBhZ2FpbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBp\nbiBzdHJpbmcKICAgICAgICAgICAgaWYgKF9jb21waWxlZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsKICAg\nICAgICAgICAgICAgIGlmIChfdW5pcXVlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIF91bmlxdWUuYm9vbGVhblZhbHVlKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vIGV4cGxpY2l0IHNldHRpbmc7\nIGRlZmF1bHQKICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9\nIGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAgICAgICAgICBpZiAoIWV4Lmlz\nQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuICFleC5oYXNHcm91cGluZyhf\nc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAq\nIEFmZmlybXMgaWYgdGhpcyBxdWVyeSBoYXMgb3JpZ2luYXRlZCBieSBwYXJz\naW5nIGEgc3RyaW5nLWJhc2VkIHF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc1BhcnNlZFF1ZXJ5KCkgewogICAgICAgIHJldHVybiBnZXRR\ndWVyeVN0cmluZygpICE9IG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0VW5pcXVlKGJvb2xlYW4gdW5pcXVlKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgX3VuaXF1\nZSA9ICh1bmlxdWUpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIENsYXNzIGdldFJlc3VsdFR5cGUo\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgaWYgKF9yZXN1bHRDbGFzcyAh\nPSBudWxsIHx8IF9jb21waWxlZCAhPSBudWxsIHx8IF9xdWVyeSA9PSBudWxs\nCiAgICAgICAgICAgICAgICB8fCBfYnJva2VyID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gX3Jlc3VsdENsYXNzOwoKICAgICAgICAgICAgLy8g\nY2hlY2sgYWdhaW4gYWZ0ZXIgY29tcGlsYXRpb247IG1heWJlIGVuY29kZWQg\naW4gc3RyaW5nCiAgICAgICAgICAgIGNvbXBpbGVGb3JDb21waWxhdGlvbigp\nOwogICAgICAgICAgICByZXR1cm4gX3Jlc3VsdENsYXNzOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZXN1bHRUeXBlKENsYXNzIGNscykg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIC8vIGFsbG93ZWQgbW9kaWZpY2F0\naW9uOiBubyByZWFkLW9ubHkgY2hlY2sKICAgICAgICAgICAgX3Jlc3VsdENs\nYXNzID0gY2xzOwogICAgICAgICAgICBfcGFja2VyID0gbnVsbDsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0U3RhcnRSYW5nZSgpIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9zdGFydElkeDsK\nICAgIH0KCiAgICBwdWJsaWMgbG9uZyBnZXRFbmRSYW5nZSgpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9lbmRJZHg7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0UmFuZ2UobG9uZyBzdGFydCwgbG9uZyBl\nbmQpIHsKICAgICAgICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA8IDApCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZh\nbGlkLXJhbmdlIiwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKHN0\nYXJ0KSwgU3RyaW5nLnZhbHVlT2YoZW5kKSkpOwoKICAgICAgICBpZiAoZW5k\nIC0gc3RhcnQgPiBJbnRlZ2VyLk1BWF9WQUxVRSAmJiBlbmQgIT0gTG9uZy5N\nQVhfVkFMVUUpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJyYW5nZS10b28tYmlnIiwKICAgICAgICAgICAgICAgIFN0\ncmluZy52YWx1ZU9mKHN0YXJ0KSwgU3RyaW5nLnZhbHVlT2YoZW5kKSkpOwoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgICAgICAvLyBhbGxvd2VkIG1vZGlmaWNhdGlv\nbjogbm8gcmVhZC1vbmx5IGNoZWNrCiAgICAgICAgICAgIF9zdGFydElkeCA9\nIHN0YXJ0OwogICAgICAgICAgICBfZW5kSWR4ID0gZW5kOwogICAgICAgICAg\nICBfcmFuZ2VTZXQgPSB0cnVlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFBhcmFtZXRlckRlY2xhcmF0aW9uKCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgICAgIGlmIChfcGFyYW1zICE9IG51bGwgfHwgX2NvbXBpbGVk\nICE9IG51bGwgfHwgX2NvbXBpbGluZwogICAgICAgICAgICAgICAgfHwgX2Jy\nb2tlciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIF9wYXJhbXM7\nCgogICAgICAgICAgICAvLyBjaGVjayBhZ2FpbiBhZnRlciBjb21waWxhdGlv\nbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcKICAgICAgICAgICAgY29tcGls\nZUZvckNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAgIHJldHVybiBfcGFyYW1z\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZWNsYXJlUGFyYW1l\ndGVycyhTdHJpbmcgcGFyYW1zKSB7CiAgICAgICAgaWYgKCFfc3RvcmVRdWVy\neS5zdXBwb3J0c1BhcmFtZXRlckRlY2xhcmF0aW9ucygpKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInF1\nZXJ5LW5vc3VwcG9ydCIsCiAgICAgICAgICAgICAgICBfbGFuZ3VhZ2UpKTsK\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsK\nICAgICAgICAgICAgX3BhcmFtcyA9IFN0cmluZ1V0aWxzLnRyaW1Ub051bGwo\ncGFyYW1zKTsKICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbXBpbGUoKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9\nIGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAgICAgICAgICBnZXRSZXN1bHRQ\nYWNrZXIoX3N0b3JlUXVlcnksIGV4KTsKICAgICAgICAgICAgZXgudmFsaWRh\ndGUoX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldENvbXBpbGF0aW9uKCkgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckNvbXBpbGF0\naW9uKCkuc3RvcmVEYXRhOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENvbXBpbGUgcXVlcnkgcHJvcGVydGllcy4KICAgICAqLwogICAgcHJpdmF0\nZSBDb21waWxhdGlvbiBjb21waWxlRm9yQ29tcGlsYXRpb24oKSB7CiAgICAg\nICAgaWYgKF9jb21waWxlZCAhPSBudWxsIHx8IF9jb21waWxpbmcpCiAgICAg\nICAgICAgIHJldHVybiBfY29tcGlsZWQ7CgogICAgICAgIGFzc2VydE5vdFNl\ncmlhbGl6ZWQoKTsKICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgIGJv\nb2xlYW4gcmVhZE9ubHkgPSBfcmVhZE9ubHk7CiAgICAgICAgX3JlYWRPbmx5\nID0gZmFsc2U7CiAgICAgICAgX2NvbXBpbGluZyA9IHRydWU7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgX2NvbXBpbGVkID0gY29tcGlsYXRpb25Gcm9t\nQ2FjaGUoKTsKICAgICAgICAgICAgcmV0dXJuIF9jb21waWxlZDsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9jb21waWxp\nbmcgPSBmYWxzZTsKICAgICAgICAgICAgX3JlYWRPbmx5ID0gcmVhZE9ubHk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUgY2Fj\naGVkIGNvbXBpbGF0aW9uIGZvciB0aGUgY3VycmVudCBxdWVyeSwgY3JlYXRp\nbmcgb25lIGlmIGl0CiAgICAgKiBkb2VzIG5vdCBleGlzdC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENvbXBpbGF0aW9uIGNvbXBpbGF0aW9uRnJvbUNhY2hl\nKCkgewogICAgICAgIE1hcCBjb21wQ2FjaGUgPQogICAgICAgICAgICBfYnJv\na2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRRdWVyeUNvbXBpbGF0aW9uQ2Fj\naGVJbnN0YW5jZSgpOwogICAgICAgIGlmIChjb21wQ2FjaGUgPT0gbnVsbCB8\nfCAhaXNQYXJzZWRRdWVyeSgpKSB7CiAgICAgICAgICAgIHJldHVybiBuZXdD\nb21waWxhdGlvbigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENv\nbXBpbGF0aW9uS2V5IGtleSA9IG5ldyBDb21waWxhdGlvbktleSgpOwogICAg\nICAgICAgICBrZXkucXVlcnlUeXBlID0gX3N0b3JlUXVlcnkuZ2V0Q2xhc3Mo\nKTsKICAgICAgICAgICAga2V5LmNhbmRpZGF0ZVR5cGUgPSBnZXRDYW5kaWRh\ndGVUeXBlKCk7CiAgICAgICAgICAgIGtleS5zdWJjbGFzc2VzID0gaGFzU3Vi\nY2xhc3NlcygpOwogICAgICAgICAgICBrZXkucXVlcnkgPSBnZXRRdWVyeVN0\ncmluZygpOwogICAgICAgICAgICBrZXkubGFuZ3VhZ2UgPSBnZXRMYW5ndWFn\nZSgpOwogICAgICAgICAgICBrZXkuc3RvcmVLZXkgPSBfc3RvcmVRdWVyeS5u\nZXdDb21waWxhdGlvbktleSgpOwogICAgICAgICAgICBDb21waWxhdGlvbiBj\nb21wID0gKENvbXBpbGF0aW9uKSBjb21wQ2FjaGUuZ2V0KGtleSk7CgogICAg\nICAgICAgICAvLyBwYXJzZSBkZWNsYXJhdGlvbnMgaWYgbmVlZGVkCiAgICAg\nICAgICAgIGJvb2xlYW4gY2FjaGUgPSBmYWxzZTsKICAgICAgICAgICAgaWYg\nKGNvbXAgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29tcCA9IG5ld0Nv\nbXBpbGF0aW9uKCk7CiAgICAgICAgICAgICAgICAvLyBvbmx5IGNhY2hlIHRo\nb3NlIHF1ZXJpZXMgdGhhdCBjYW4gYmUgY29tcGlsZWQKICAgICAgICAgICAg\nICAgIGNhY2hlID0gY29tcC5zdG9yZURhdGEgIT0gbnVsbDsKICAgICAgICAg\nICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfc3RvcmVRdWVyeS5wb3B1bGF0\nZUZyb21Db21waWxhdGlvbihjb21wLnN0b3JlRGF0YSk7CgogICAgICAgICAg\nICAvLyBjYWNoZSBwYXJzZWQgc3RhdGUgaWYgbmVlZGVkCiAgICAgICAgICAg\nIGlmIChjYWNoZSkKICAgICAgICAgICAgICAgIGNvbXBDYWNoZS5wdXQoa2V5\nLCBjb21wKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXA7CiAgICAgICAgfQog\nICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgcG9wdWxhdGUg\nYSBuZXcgY29tcGlsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgQ29tcGls\nYXRpb24gbmV3Q29tcGlsYXRpb24oKSB7CiAgICAgICAgQ29tcGlsYXRpb24g\nY29tcCA9IG5ldyBDb21waWxhdGlvbigpOwogICAgICAgIGNvbXAuc3RvcmVE\nYXRhID0gX3N0b3JlUXVlcnkubmV3Q29tcGlsYXRpb24oKTsKICAgICAgICBf\nc3RvcmVRdWVyeS5wb3B1bGF0ZUZyb21Db21waWxhdGlvbihjb21wLnN0b3Jl\nRGF0YSk7CiAgICAgICAgcmV0dXJuIGNvbXA7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb21waWxlIGZvciBleGVjdXRpb24sIGNob29zaW5nIGJldHdlZW4g\nZGF0YXN0b3JlIGFuZCBpbi1tZW0KICAgICAqIGNvbXBpbGF0aW9uIGJhc2Vk\nIG9uIHdoYXQgd2Ugc3VwcG9ydCBhbmQgb3VyIHNldHRpbmdzLgogICAgICov\nCiAgICBwcml2YXRlIFN0b3JlUXVlcnkuRXhlY3V0b3IgY29tcGlsZUZvckV4\nZWN1dG9yKCkgewogICAgICAgIENvbXBpbGF0aW9uIGNvbXAgPSBjb21waWxl\nRm9yQ29tcGlsYXRpb24oKTsKICAgICAgICBpZiAoX2NvbGxlY3Rpb24gPT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoY29tcC5kYXRhc3RvcmUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBjb21wLmRhdGFzdG9yZTsKICAg\nICAgICAgICAgaWYgKGNvbXAubWVtb3J5ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gY29tcC5tZW1vcnk7CiAgICAgICAgICAgIGlmIChfc3Rv\ncmVRdWVyeS5zdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JEYXRhU3RvcmUoY29tcCk7CiAg\nICAgICAgICAgIHJldHVybiBjb21waWxlRm9ySW5NZW1vcnkoY29tcCk7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoY29tcC5tZW1vcnkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGNvbXAubWVtb3J5OwogICAgICAgIGlmIChjb21w\nLmRhdGFzdG9yZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY29tcC5k\nYXRhc3RvcmU7CiAgICAgICAgaWYgKF9zdG9yZVF1ZXJ5LnN1cHBvcnRzSW5N\nZW1vcnlFeGVjdXRpb24oKSkKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVG\nb3JJbk1lbW9yeShjb21wKTsKICAgICAgICByZXR1cm4gY29tcGlsZUZvckRh\ndGFTdG9yZShjb21wKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBh\nbiBleHByZXNzaW9uIHRyZWUgZm9yIGRhdGFzdG9yZSBleGVjdXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRvciBjb21waWxl\nRm9yRGF0YVN0b3JlKENvbXBpbGF0aW9uIGNvbXApIHsKICAgICAgICBpZiAo\nY29tcC5kYXRhc3RvcmUgPT0gbnVsbCkKICAgICAgICAgICAgY29tcC5kYXRh\nc3RvcmUgPSBjcmVhdGVFeGVjdXRvcihmYWxzZSk7CiAgICAgICAgcmV0dXJu\nIGNvbXAuZGF0YXN0b3JlOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGFuIGV4cHJlc3Npb24gdHJlZSBmb3IgaW4tbWVtb3J5IGV4ZWN1dGlvbi4K\nICAgICAqLwogICAgcHJpdmF0ZSBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGNvbXBp\nbGVGb3JJbk1lbW9yeShDb21waWxhdGlvbiBjb21wKSB7CiAgICAgICAgaWYg\nKGNvbXAubWVtb3J5ID09IG51bGwpCiAgICAgICAgICAgIGNvbXAubWVtb3J5\nID0gY3JlYXRlRXhlY3V0b3IodHJ1ZSk7CiAgICAgICAgcmV0dXJuIGNvbXAu\nbWVtb3J5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgcXVlcnkg\nZXhlY3V0b3Igb2YgdGhlIHByb3BlciB0eXBlLgogICAgICovCiAgICBwcml2\nYXRlIFN0b3JlUXVlcnkuRXhlY3V0b3IgY3JlYXRlRXhlY3V0b3IoYm9vbGVh\nbiBpbk1lbSkgewogICAgICAgIGFzc2VydENhbmRpZGF0ZVR5cGUoKTsKCiAg\nICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2Jyb2tlci5nZXRD\nb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3Np\ndG9yeUluc3RhbmNlKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\ncmVwb3MuZ2V0TWV0YURhdGEoX2NsYXNzLAogICAgICAgICAgICBfYnJva2Vy\nLmdldENsYXNzTG9hZGVyKCksIGZhbHNlKTsKCiAgICAgICAgQ2xhc3NNZXRh\nRGF0YVtdIG1ldGFzOwogICAgICAgIGlmIChfY2xhc3MgPT0gbnVsbCB8fCBf\nc3RvcmVRdWVyeS5zdXBwb3J0c0Fic3RyYWN0RXhlY3V0b3JzKCkpCiAgICAg\nICAgICAgIG1ldGFzID0gbmV3IENsYXNzTWV0YURhdGFbXXsgbWV0YSB9Owog\nICAgICAgIGVsc2UgaWYgKF9zdWJjbGFzc2VzICYmIChtZXRhID09IG51bGwg\nfHwgbWV0YS5pc01hbmFnZWRJbnRlcmZhY2UoKSkpCiAgICAgICAgICAgIG1l\ndGFzID0gcmVwb3MuZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXMoX2NsYXNzLAog\nICAgICAgICAgICAgICAgX2Jyb2tlci5nZXRDbGFzc0xvYWRlcigpLCB0cnVl\nKTsKICAgICAgICBlbHNlIGlmIChtZXRhICE9IG51bGwgJiYgKF9zdWJjbGFz\nc2VzIHx8IG1ldGEuaXNNYXBwZWQoKSkpCiAgICAgICAgICAgIG1ldGFzID0g\nbmV3IENsYXNzTWV0YURhdGFbXXsgbWV0YSB9OwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgbWV0YXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX01FVEFTOwoKICAg\nICAgICBpZiAobWV0YXMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1pbXBscyIsIF9jbGFz\ncykpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChtZXRhcy5sZW5n\ndGggPT0gMSkgewogICAgICAgICAgICAgICAgaWYgKGluTWVtKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBfc3RvcmVRdWVyeS5uZXdJbk1lbW9yeUV4\nZWN1dG9yKG1ldGFzWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBfc3Vi\nY2xhc3Nlcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnku\nbmV3RGF0YVN0b3JlRXhlY3V0b3IobWV0YXNbMF0sIF9zdWJjbGFzc2VzKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbXVsdGlwbGUgaW1wbGVt\nZW50b3JzCiAgICAgICAgICAgIFN0b3JlUXVlcnkuRXhlY3V0b3JbXSBlcyA9\nIG5ldyBTdG9yZVF1ZXJ5LkV4ZWN1dG9yW21ldGFzLmxlbmd0aF07CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlmIChpbk1lbSkKICAgICAgICAgICAgICAgICAg\nICBlc1tpXSA9IF9zdG9yZVF1ZXJ5Lm5ld0luTWVtb3J5RXhlY3V0b3IobWV0\nYXNbaV0sIHRydWUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIGVzW2ldID0gX3N0b3JlUXVlcnkubmV3RGF0YVN0b3JlRXhl\nY3V0b3IobWV0YXNbaV0sIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybiBuZXcgTWVyZ2VkRXhlY3V0b3IoZXMpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYW55IGNv\nbXBpbGF0aW9uLCBmb3JjaW5nIHRoaXMgcXVlcnkgdG8gYmUgcmVjb21waWxl\nZAogICAgICogbmV4dCB0aW1lIGl0J3MgZXhlY3V0ZWQuIFRoaXMgc2hvdWxk\nIGJlIGludm9rZWQgd2hlbmV2ZXIgYW55CiAgICAgKiBzdGF0ZSBjaGFuZ2Vz\nIHRoYXQgd291bGQgY2F1c2UgdGhlIHVuZGVybHlpbmcgcXVlcnkKICAgICAq\nIHJlcHJlc2VudGF0aW9uIHRvIGNoYW5nZS4KICAgICAqCiAgICAgKiBAc2lu\nY2UgMC4zLjAKICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGludmFsaWRh\ndGVDb21waWxhdGlvbigpIHsKICAgICAgICBpZiAoX2NvbXBpbGluZykKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIF9zdG9yZVF1ZXJ5Lmlu\ndmFsaWRhdGVDb21waWxhdGlvbigpOwogICAgICAgIF9jb21waWxlZCA9IG51\nbGw7CiAgICAgICAgX3BhY2tlciA9IG51bGw7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBleGVjdXRlKCkgewogICAg\nICAgIHJldHVybiBleGVjdXRlKChPYmplY3RbXSkgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBleGVjdXRlKE9iamVjdFtdIHBhcmFtcykgewog\nICAgICAgIHJldHVybiBleGVjdXRlKE9QX1NFTEVDVCwgcGFyYW1zKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGV4ZWN1dGUoTWFwIHBhcmFtcykgewog\nICAgICAgIHJldHVybiBleGVjdXRlKE9QX1NFTEVDVCwgcGFyYW1zKTsKICAg\nIH0KCiAgICBwcml2YXRlIE9iamVjdCBleGVjdXRlKGludCBvcGVyYXRpb24s\nIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIGlmIChwYXJhbXMgPT0gbnVs\nbCkKICAgICAgICAgICAgcGFyYW1zID0gU3RvcmVRdWVyeS5FTVBUWV9PQkpF\nQ1RTOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYXNzZXJ0Tm90U2VyaWFsaXplZCgpOwogICAgICAgICAgICBfYnJva2Vy\nLmJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAgICAgX2Jy\nb2tlci5hc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAg\nICAgICAgIC8vIGdldCBleGVjdXRvcgogICAgICAgICAgICAgICAgQ29tcGls\nYXRpb24gY29tcCA9IGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAg\nICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IChpc0luTWVtb3J5\nKG9wZXJhdGlvbikpCiAgICAgICAgICAgICAgICAgICAgPyBjb21waWxlRm9y\nSW5NZW1vcnkoY29tcCkgOiBjb21waWxlRm9yRGF0YVN0b3JlKGNvbXApOwoK\nICAgICAgICAgICAgICAgIGFzc2VydFBhcmFtZXRlcnMoX3N0b3JlUXVlcnks\nIGV4LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2dFeGVjdXRpb24o\nb3BlcmF0aW9uLCBleC5nZXRPcmRlcmVkUGFyYW1ldGVyVHlwZXMoX3N0b3Jl\nUXVlcnkpLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMpOwoKICAg\nICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT0gT1BfU0VMRUNUKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBleGVjdXRlKF9zdG9yZVF1ZXJ5LCBl\neCwgcGFyYW1zKTsKICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT0g\nT1BfREVMRVRFKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxldGUo\nX3N0b3JlUXVlcnksIGV4LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgaWYg\nKG9wZXJhdGlvbiA9PSBPUF9VUERBVEUpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHVwZGF0ZShfc3RvcmVRdWVyeSwgZXgsIHBhcmFtcyk7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIF9icm9rZXIuZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBl\neGVjdXRlKGludCBvcGVyYXRpb24sIE1hcCBwYXJhbXMpIHsKICAgICAgICBp\nZiAocGFyYW1zID09IG51bGwpCiAgICAgICAgICAgIHBhcmFtcyA9IENvbGxl\nY3Rpb25zLkVNUFRZX01BUDsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF9icm9rZXIuYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhc3NlcnROb3RT\nZXJpYWxpemVkKCk7CiAgICAgICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgICAgICAgICBfYnJva2VyLmFzc2VydE5vbnRyYW5zYWN0aW9uYWxS\nZWFkKCk7CgogICAgICAgICAgICAgICAgLy8gZ2V0IGV4ZWN1dG9yCiAgICAg\nICAgICAgICAgICBDb21waWxhdGlvbiBjb21wID0gY29tcGlsZUZvckNvbXBp\nbGF0aW9uKCk7CiAgICAgICAgICAgICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9y\nIGV4ID0gKGlzSW5NZW1vcnkob3BlcmF0aW9uKSkKICAgICAgICAgICAgICAg\nICAgICA/IGNvbXBpbGVGb3JJbk1lbW9yeShjb21wKSA6IGNvbXBpbGVGb3JE\nYXRhU3RvcmUoY29tcCk7CgogICAgICAgICAgICAgICAgYXNzZXJ0UGFyYW1l\ndGVycyhfc3RvcmVRdWVyeSwgZXgsIHBhcmFtcyk7CiAgICAgICAgICAgICAg\nICBPYmplY3RbXSBhcnIgPSAocGFyYW1zLmlzRW1wdHkoKSkgPyBTdG9yZVF1\nZXJ5LkVNUFRZX09CSkVDVFMgOgogICAgICAgICAgICAgICAgICAgIGV4LnRv\nUGFyYW1ldGVyQXJyYXkoX3N0b3JlUXVlcnksIHBhcmFtcyk7CiAgICAgICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIGxvZ0V4ZWN1dGlvbihvcGVyYXRpb24sIHBhcmFtcyk7Cgog\nICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiA9PSBPUF9TRUxFQ1QpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGUoX3N0b3JlUXVlcnks\nIGV4LCBhcnIpOwogICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiA9PSBP\nUF9ERUxFVEUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlbGV0ZShf\nc3RvcmVRdWVyeSwgZXgsIGFycik7CiAgICAgICAgICAgICAgICBpZiAob3Bl\ncmF0aW9uID09IE9QX1VQREFURSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gdXBkYXRlKF9zdG9yZVF1ZXJ5LCBleCwgYXJyKTsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJxdWVyeS1leGVjdXRpb24tZXJyb3IiLCAKICAgICAg\nICAgICAgICAgIAkJX3F1ZXJ5KSwgZSk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBfYnJva2VyLmVuZE9wZXJhdGlvbigpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIGxvbmcgZGVsZXRlQWxsKCkgewogICAgICAgIHJldHVybiBkZWxldGVBbGwo\nKE9iamVjdFtdKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBkZWxl\ndGVBbGwoT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICgoTnVt\nYmVyKSBleGVjdXRlKE9QX0RFTEVURSwgcGFyYW1zKSkubG9uZ1ZhbHVlKCk7\nCiAgICB9CgogICAgcHVibGljIGxvbmcgZGVsZXRlQWxsKE1hcCBwYXJhbXMp\nIHsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGV4ZWN1dGUoT1BfREVMRVRF\nLCBwYXJhbXMpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9u\nZyB1cGRhdGVBbGwoKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZUFsbCgoT2Jq\nZWN0W10pIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFs\nbChPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gKChOdW1iZXIp\nIGV4ZWN1dGUoT1BfVVBEQVRFLCBwYXJhbXMpKS5sb25nVmFsdWUoKTsKICAg\nIH0KCiAgICBwdWJsaWMgbG9uZyB1cGRhdGVBbGwoTWFwIHBhcmFtcykgewog\nICAgICAgIHJldHVybiAoKE51bWJlcikgZXhlY3V0ZShPUF9VUERBVEUsIHBh\ncmFtcykpLmxvbmdWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydHMgdGhlIHZhbHVlcyBvZiBnaXZlbiA8Y29kZT5wYXJhbXM8L2NvZGU+\nIE1hcCBpbnRvIGFuIGFycmF5IGluCiAgICAgKiBjb25zdWx0YXRpb24gb2Yg\ndGhlIDxjb2RlPnBhcmFtVHlwZXM8L2NvZGU+IE1hcC4KICAgICAqIAogICAg\nICogVGhlIGluZGV4aW5nIG9mIHRoZSByZXN1bHRhbnQgYXJyYXkgaXMgc2ln\nbmlmaWNhbnQgZm9yIGZvbGxvd2luZyAKICAgICAqIGludGVycmVsYXRlZCBi\ndXQgdGFjaXQgYXNzdW1wdGlvbnM6CiAgICAgKiBUaGUgdmFsdWVzIGluIHRo\nZSByZXR1cm5lZCBPYmplY3RbXSBpcyBjb25zdW1lZCBieSB7QGxpbmsgUGFy\nYW1ldGVyfQogICAgICogZXhwcmVzc2lvbnMuIFF1ZXJ5IHBhcnNpbmcgY3Jl\nYXRlcyB0aGVzZSBQYXJhbWV0ZXJzIGFuZCBzZXRzIHRoZWlyCiAgICAgKiBr\nZXkgYW5kIGluZGV4LiBUaGUgaW5kZXggc2V0IG9uIHRoZSBQYXJhbWV0ZXIg\nYnkgdGhlIHBhcnNlciBpcyB0aGUKICAgICAqIHNhbWUgaW5kZXggdXNlZCB0\nbyBhY2Nlc3MgdGhlIE9iamVjdFtdIGVsZW1lbnRzIHJldHVybmVkIGJ5IHRo\naXMgbWV0aG9kLgogICAgICogCiAgICAgKiB7QGxpbmsgSlBRTEV4cHJlc3Np\nb25CdWlsZGVyfSBjcmVhdGVzIGFuZCBwb3B1bGF0ZXMgcGFyYW1ldGVycyBh\ncwogICAgICogZm9sbG93czogCiAgICAgKiBUaGUgcGFyYW1ldGVyIGtleSBp\ncyBub3QgdGhlIHRva2VuIGVuY291bnRlcmVkIGJ5IHRoZSBwYXJzZXIsIGJ1\ndCAKICAgICAqIGNvbnZlcnRlZCB0byBJbnRlZ2VyIG9yIFN0cmluZyBiYXNl\nZCBvbiB0aGUgY29udGV4dCBpbiB3aGljaCB0aGUgdG9rZW4gCiAgICAgKiBh\ncHBlYXJlZC4gCiAgICAgKiBUaGUgaW5kZXggZm9yIHBvc2l0aW9uYWwgKElu\ndGVnZXIpIHBhcmFtZXRlciBpcyB0aGUgdmFsdWUgb2YgdGhlIGtleSAgIAog\nICAgICogbWludXMgMS4gCiAgICAgKiBUaGUgaW5kZXggZm9yIG5hbWVkIChT\ndHJpbmcpIHBhcmFtZXRlciBpcyB0aGUgb3JkZXIgaW4gd2hpY2ggdGhlICAK\nICAgICAqIHRva2VuIGFwcGVhcmVkIHRvIHBhcnNlciBkdXJpbmcgc2Nhbm5p\nbmcuIAogICAgICogCiAgICAgKiAKICAgICAqIFRoZSBmaXJzdCBMaW5rZWRN\nYXAgYXJndW1lbnQgdG8gdGhpcyBtZXRob2QgaXMgdGhlIHJlc3VsdCBvZiBw\nYXJzaW5nLgogICAgICogVGhpcyBMaW5rZWRNYXAgY29udGFpbnMgdGhlIHBh\ncmFtZXRlciBrZXkgYW5kIHRoZWlyIGV4cGVjdGVkIAogICAgICogKGlmIGRl\ndGVybWluYWJsZSkgdmFsdWUgdHlwZXMuIFRoYXQgaXQgaXMgYSBMaW5rZWRN\nYXAgcG9pbnRzIHRvIHRoZSAKICAgICAqIGZhY3QgdGhhdCBhbiBvcmRlcmlu\nZyBpcyBpbXBsaWNpdC4gVGhlIG9yZGVyaW5nIG9mIHRoZSBrZXlzIGluIHRo\naXMgTWFwIAogICAgICogaXMgdGhlIHNhbWUgYXMgdGhlIG9yZGVyIGluIHdo\naWNoIHBhcnNlciBlbmNvdW50ZXJlZCB0aGUgcGFyYW1ldGVyCiAgICAgKiB0\nb2tlbnMuCiAgICAgKiAKICAgICAqIEZvciBleGFtcGxlLCBwYXJzaW5nIHJl\nc3VsdCBvZiB0aGUgZm9sbG93aW5nIHR3byBKUFFMIHF1ZXJpZXMKICAgICAq\nICAgYSkgVVBEQVRFIENvbXBVc2VyIGUgU0VUIGUubmFtZT0gPzEsIGUuYWdl\nID0gPzIgV0hFUkUgZS51c2VyaWQgPSA/MwogICAgICogICBiKSBVUERBVEUg\nQ29tcFVzZXIgZSBTRVQgZS5uYW1lPSA6bmFtZSwgZS5hZ2UgPSA6YWdlIFdI\nRVJFIGUudXNlcmlkID0KICAgICAqICAgICAgICAgIDppZAogICAgICogVGhl\nIHBhcmFtZXRlciBrZXlzIHdpbGwgYXBwZWFyIGluIHRoZSBvcmRlciAoMywy\nLDEpIG9yICg6aWQsIDpuYW1lLCA6YWdlKQogICAgICogaW4gdGhlIGdpdmVu\nIExpbmtlZE1hcCBiZWNhdXNlIFdIRVJFIGNsYXVzZSBpcyBwYXJzZWQgYmVm\nb3JlIFNFVCBjbGF1c2UuCiAgICAgKiBUaGUgY29ycmVzcG9uZGluZyBQYXJh\nbWV0ZXIgRXhwcmVzc2lvbnMgY3JlYXRlZCBieSB0aGUgcGFyc2VyIHdpbGwg\naGF2ZQogICAgICogZm9sbG93aW5nIGtleSBhbmQgaW5kZXg6CiAgICAgKiAg\nICBhKSAxOjAsIDI6MSwgMzoyCiAgICAgKiAgICBiKSBuYW1lOjEsIGFnZToy\nLCBpZDowCiAgICAgKiAgICAKICAgICAqIFRoZSBwdXJwb3NlIG9mIHRoaXMg\nbWV0aG9kIGlzIHRvIHByb2R1Y2UgYW4gT2JqZWN0W10gd2l0aCBhbiBpbmRl\neGluZwogICAgICogc2NoZW1lIHRoYXQgbWF0Y2hlcyB0aGUgaW5kZXhpbmcg\nb2YgdGhlIFBhcmFtZXRlciBFeHByZXNzaW9uLgogICAgICogVGhlIHVzZXIg\nbWFwICh0aGUgc2Vjb25kIGFyZ3VtZW50KSBzaG91bGQgcHJvZHVjZSB0aGUg\nZm9sbG93aW5nIE9iamVjdFtdCiAgICAgKiBpbiB0d28gYWJvdmUtbWVudGlv\nbmVkIGNhc2VzCiAgICAgKiAgIGEpIHsxOiJTaGFubm9uIiwyOjI5LDM6NTAz\nMn0gLS0+IFsiU2hhbm5vbiIsIDI5LCA1MDMyXQogICAgICogICBiKSB7Im5h\nbWUiOiJTaGFubm9uIiwgImFnZSI6MjksICJpZCI6NTAzMn0gLS0+IFs1MDMy\nLCAiU2hhbm5vbiIsIDI5XQogICAgICogICAKICAgICAqLwoKICAgIC8qKgog\nICAgICogUmV0dXJuIHdoZXRoZXIgd2Ugc2hvdWxkIGV4ZWN1dGUgdGhpcyBx\ndWVyeSBpbiBtZW1vcnkuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBp\nc0luTWVtb3J5KGludCBvcGVyYXRpb24pIHsKICAgICAgICAvLyBpZiB0aGVy\nZSBhcmUgYW55IGRpcnR5IGluc3RhbmNlcyBpbiB0aGUgY3VycmVudCB0cmFu\ncyB0aGF0IGFyZQogICAgICAgIC8vIGludm9sdmVkIGluIHRoaXMgcXVlcnks\nIHdlIGhhdmUgdG8gZXhlY3V0ZSBpbiBtZW1vcnkgb3IgZmx1c2gKICAgICAg\nICBib29sZWFuIGluTWVtID0gIV9zdG9yZVF1ZXJ5LnN1cHBvcnRzRGF0YVN0\nb3JlRXhlY3V0aW9uKCkKICAgICAgICAgICAgfHwgX2NvbGxlY3Rpb24gIT0g\nbnVsbDsKICAgICAgICBpZiAoIWluTWVtICYmICghX2lnbm9yZUNoYW5nZXMg\nfHwgb3BlcmF0aW9uICE9IE9QX1NFTEVDVCkKICAgICAgICAgICAgJiYgX2Jy\nb2tlci5pc0FjdGl2ZSgpICYmIGlzQWNjZXNzUGF0aERpcnR5KCkpIHsKICAg\nICAgICAgICAgaW50IGZsdXNoID0gX2ZjLmdldEZsdXNoQmVmb3JlUXVlcmll\ncygpOwogICAgICAgICAgICBpZiAoKGZsdXNoID09IEZMVVNIX1RSVUUKICAg\nICAgICAgICAgICAgIHx8IChmbHVzaCA9PSBGTFVTSF9XSVRIX0NPTk5FQ1RJ\nT04gJiYgX2Jyb2tlci5oYXNDb25uZWN0aW9uKCkpCiAgICAgICAgICAgICAg\nICB8fCBvcGVyYXRpb24gIT0gT1BfU0VMRUNUCiAgICAgICAgICAgICAgICB8\nfCAhX3N0b3JlUXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpKQog\nICAgICAgICAgICAgICAgJiYgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCku\nc3VwcG9ydGVkT3B0aW9ucygpLgogICAgICAgICAgICAgICAgY29udGFpbnMo\nT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BUSU9OX0lOQ19GTFVTSCkpIHsKICAg\nICAgICAgICAgICAgIF9icm9rZXIuZmx1c2goKTsKICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLmluZm8oX2xvYy5nZXQoImZv\ncmNlLWluLW1lbSIsIF9jbGFzcykpOwogICAgICAgICAgICAgICAgaW5NZW0g\nPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\naW5NZW0gJiYgIV9zdG9yZVF1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRp\nb24oKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiY2FudC1leGVjLWlubWVtIiwKICAgICAgICAgICAg\nICAgIF9sYW5ndWFnZSkpOwogICAgICAgIHJldHVybiBpbk1lbTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEV4ZWN1dGUgdGhlIHF1ZXJ5IHVzaW5nIHRoZSBn\naXZlbiBjb21waWxhdGlvbiwgZXhlY3V0b3IsIGFuZCBwYXJhbWV0ZXIKICAg\nICAqIHZhbHVlcy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0aG9kcyBkZWxlZ2F0\nZSB0byB0aGlzIG9uZSBvciB0bwogICAgICoge0BsaW5rICNleGVjdXRlKFN0\nb3JlUXVlcnkuRXhlY3V0b3IsTWFwKX0gYWZ0ZXIgdmFsaWRhdGlvbiBhbmQg\nbG9ja2luZy4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZXhlY3V0ZShT\ndG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIAogICAgICAg\nIE9iamVjdFtdIHBhcmFtcykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBpZiB0aGlzIGlzIGFuIGltcG9zc2libGUgcmVzdWx0IHJh\nbmdlLCByZXR1cm4gbnVsbCAvIGVtcHR5IGxpc3QKICAgICAgICBTdG9yZVF1\nZXJ5LlJhbmdlIHJhbmdlID0gbmV3IFN0b3JlUXVlcnkuUmFuZ2UoX3N0YXJ0\nSWR4LCBfZW5kSWR4KTsKICAgICAgICBpZiAoIV9yYW5nZVNldCkKICAgICAg\nICAgICAgZXguZ2V0UmFuZ2UocSwgcGFyYW1zLCByYW5nZSk7CiAgICAgICAg\naWYgKHJhbmdlLnN0YXJ0ID49IHJhbmdlLmVuZCkKICAgICAgICAgICAgcmV0\ndXJuIGVtcHR5UmVzdWx0KHEsIGV4KTsKCiAgICAgICAgLy8gZXhlY3V0ZTsg\naWYgd2UgaGF2ZSBhIHJlc3VsdCBjbGFzcyBvciB3ZSBoYXZlIG9ubHkgb25l\nIHJlc3VsdAogICAgICAgIC8vIGFuZCBzbyBuZWVkIHRvIHJlbW92ZSBpdCBm\ncm9tIGl0cyBhcnJheSwgd3JhcCBpbiBhIHBhY2tpbmcgcm9wCiAgICAgICAg\ncmFuZ2UubHJzID0gaXNMUlMocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7CiAg\nICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wID0gZXguZXhlY3V0ZVF1\nZXJ5KHEsIHBhcmFtcywgcmFuZ2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiB0b1Jlc3VsdChxLCBleCwgcm9wLCByYW5nZSk7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKHJv\ncCAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcm9wLmNsb3NlKCk7\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMikge30KICAgICAgICAgICAgdGhyb3cg\nZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgdGhl\nIHF1ZXJ5IHVzaW5nIHRoZSBnaXZlbiBleGVjdXRvciwgYW5kIHBhcmFtZXRl\ncgogICAgICogdmFsdWVzLiBBbGwgb3RoZXIgZXhlY3V0ZSBtZXRob2RzIGRl\nbGVnYXRlIHRvIHRoaXMgb25lIG9yIHRvCiAgICAgKiB7QGxpbmsgI2RlbGV0\nZShTdG9yZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFmdGVyIHZhbGlkYXRpb24g\nYW5kIGxvY2tpbmcuCiAgICAgKiBUaGUgcmV0dXJuIHZhbHVlIHdpbGwgYmUg\nYSBOdW1iZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9mCiAgICAgKiBpbnN0\nYW5jZXMgZGVsZXRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBOdW1iZXIgZGVs\nZXRlKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgT2Jq\nZWN0W10gcGFyYW1zKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGFzc2VydEJ1bGtNb2RpZnkocSwgZXgsIHBhcmFtcyk7CiAgICAgICAg\ncmV0dXJuIGV4LmV4ZWN1dGVEZWxldGUocSwgcGFyYW1zKTsKICAgIH0KCiAg\nICBwdWJsaWMgTnVtYmVyIGRlbGV0ZUluTWVtb3J5KFN0b3JlUXVlcnkgcSwg\nU3RvcmVRdWVyeS5FeGVjdXRvciBleGVjdXRvciwKICAgICAgICBPYmplY3Rb\nXSBwYXJhbXMpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBPYmplY3Qg\nbyA9IGV4ZWN1dGUocSwgZXhlY3V0b3IsIHBhcmFtcyk7CiAgICAgICAgICAg\nIGlmICghKG8gaW5zdGFuY2VvZiBDb2xsZWN0aW9uKSkKICAgICAgICAgICAg\nICAgIG8gPSBDb2xsZWN0aW9ucy5zaW5nbGV0b24obyk7CgogICAgICAgICAg\nICBpbnQgc2l6ZSA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaSA9\nICgoQ29sbGVjdGlvbikgbykuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7IHNp\nemUrKykKICAgICAgICAgICAgICAgIF9icm9rZXIuZGVsZXRlKGkubmV4dCgp\nLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihz\naXplKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSB0\naGUgcXVlcnkgdXNpbmcgdGhlIGdpdmVuIGNvbXBpbGF0aW9uLCBleGVjdXRv\nciwgYW5kIHBhcmFtZXRlcgogICAgICogdmFsdWVzLiBBbGwgb3RoZXIgZXhl\nY3V0ZSBtZXRob2RzIGRlbGVnYXRlIHRvIHRoaXMgb25lIG9yIHRvCiAgICAg\nKiB7QGxpbmsgI3VwZGF0ZShTdG9yZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFm\ndGVyIHZhbGlkYXRpb24gYW5kIGxvY2tpbmcuCiAgICAgKiBUaGUgcmV0dXJu\nIHZhbHVlIHdpbGwgYmUgYSBOdW1iZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVy\nIG9mCiAgICAgKiBpbnN0YW5jZXMgdXBkYXRlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBOdW1iZXIgdXBkYXRlKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5F\neGVjdXRvciBleCwgT2JqZWN0W10gcGFyYW1zKQogICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIGFzc2VydEJ1bGtNb2RpZnkocSwgZXgsIHBh\ncmFtcyk7CiAgICAgICAgcmV0dXJuIGV4LmV4ZWN1dGVVcGRhdGUocSwgcGFy\nYW1zKTsKICAgIH0KCiAgICBwdWJsaWMgTnVtYmVyIHVwZGF0ZUluTWVtb3J5\nKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleGVjdXRvciwK\nICAgICAgICBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBPYmplY3QgbyA9IGV4ZWN1dGUocSwgZXhlY3V0b3IsIHBhcmFt\ncyk7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBDb2xsZWN0aW9u\nKSkKICAgICAgICAgICAgICAgIG8gPSBDb2xsZWN0aW9ucy5zaW5nbGV0b24o\nbyk7CgogICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaSA9ICgoQ29sbGVjdGlvbikgbykuaXRlcmF0b3IoKTsg\naS5oYXNOZXh0KCk7IHNpemUrKykKICAgICAgICAgICAgICAgIHVwZGF0ZUlu\nTWVtb3J5KGkubmV4dCgpLCBwYXJhbXMsIHEpOwogICAgICAgICAgICByZXR1\ncm4gTnVtYmVycy52YWx1ZU9mKHNpemUpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZXMgZm9yIHRoZSB1cGRhdGVzIGlu\nIG1lbW9yeS4KICAgICAqCiAgICAgKiBAcGFyYW0gb2IgdGhlIHBlcnNpc3Rl\nbnQgaW5zdGFuY2UgdG8gY2hhbmdlCiAgICAgKiBAcGFyYW0gcGFyYW1zIHRo\nZSBwYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgcXVlcnkKICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHVwZGF0ZUluTWVtb3J5KE9iamVjdCBvYiwgT2JqZWN0\nW10gcGFyYW1zLCBTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ID0gZ2V0VXBkYXRlcygpLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsK\nICAgICAgICAgICAgaXQuaGFzTmV4dCgpOykgewogICAgICAgICAgICBNYXAu\nRW50cnkgZSA9IChNYXAuRW50cnkpIGl0Lm5leHQoKTsKICAgICAgICAgICAg\nUGF0aCBwYXRoID0gKFBhdGgpIGUuZ2V0S2V5KCk7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gKEZpZWxkTWV0YURhdGEpIHBhdGgubGFzdCgp\nOwogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gX2Jyb2tl\nci5nZXRTdGF0ZU1hbmFnZXIob2IpOwoKICAgICAgICAgICAgT2JqZWN0IHZh\nbDsKICAgICAgICAgICAgT2JqZWN0IHZhbHVlID0gZS5nZXRWYWx1ZSgpOwog\nICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBWYWwpIHsKICAgICAg\nICAgICAgICAgIHZhbCA9ICgoVmFsKSB2YWx1ZSkuCiAgICAgICAgICAgICAg\nICAgICAgZXZhbHVhdGUob2IsIG51bGwsIGdldFN0b3JlQ29udGV4dCgpLCBw\nYXJhbXMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNl\nb2YgTGl0ZXJhbCkgewogICAgICAgICAgICAgICAgdmFsID0gKChMaXRlcmFs\nKSB2YWx1ZSkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2\nYWx1ZSBpbnN0YW5jZW9mIENvbnN0YW50KSB7CiAgICAgICAgICAgICAgICB2\nYWwgPSAoKENvbnN0YW50KSB2YWx1ZSkuZ2V0VmFsdWUocGFyYW1zKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgdmFsID0gcS5ldmFsdWF0ZSh2YWx1ZSwgb2IsIHBh\ncmFtcywgc20pOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVW5zdXBwb3J0\nZWRFeGNlcHRpb24gZTEpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9sb2MuZ2V0KCJmYWlsLXRvLWdldC11cGRhdGUtdmFsdWUiKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGludCBp\nID0gZm1kLmdldEluZGV4KCk7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBpbnRvID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShv\nYiwKICAgICAgICAgICAgICAgIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigp\nKTsKCiAgICAgICAgICAgIC8vIHNldCB0aGUgYWN0dWFsIGZpZWxkIGluIHRo\nZSBpbnN0YW5jZQogICAgICAgICAgICBpbnQgc2V0ID0gT3BlbkpQQVN0YXRl\nTWFuYWdlci5TRVRfVVNFUjsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRp\nbmdCb29sZWFuRmllbGQoaW50bywgaSwgc20uZmV0Y2hCb29sZWFuRmllbGQo\naSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gZmFs\nc2UgOiAoKEJvb2xlYW4pIHZhbCkuYm9vbGVhblZhbHVlKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAg\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdCeXRlRmllbGQoaW50bywgaSwg\nc20uZmV0Y2hCeXRlRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgp\nLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgICAg\nICBzbS5zZXR0aW5nQ2hhckZpZWxkKGludG8sIGksIHNtLmZldGNoQ2hhckZp\nZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/\nIDAgOiB2YWwudG9TdHJpbmcoKS5jaGFyQXQoMCksIHNldCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0Rv\ndWJsZUZpZWxkKGludG8sIGksIHNtLmZldGNoRG91YmxlRmllbGQoaSksCiAg\nICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVt\nYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCksIHNldCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVDoKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nRmxvYXRGaWVs\nZChpbnRvLCBpLCBzbS5mZXRjaEZsb2F0RmllbGQoaSksCiAgICAgICAgICAg\nICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwp\nLmZsb2F0VmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAg\nICAgICAgICAgICAgICBzbS5zZXR0aW5nSW50RmllbGQoaW50bywgaSwgc20u\nZmV0Y2hJbnRGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFs\nID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwgc2V0\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgc20u\nc2V0dGluZ0xvbmdGaWVsZChpbnRvLCBpLCBzbS5mZXRjaExvbmdGaWVsZChp\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDog\nKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCksIHNldCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nU2hvcnRG\naWVsZChpbnRvLCBpLCBzbS5mZXRjaFNob3J0RmllbGQoaSksCiAgICAgICAg\nICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2\nYWwpLnNob3J0VmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoK\nICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nU3RyaW5nRmllbGQoaW50\nbywgaSwgc20uZmV0Y2hTdHJpbmdGaWVsZChpKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgdmFsID09IG51bGwgPyBudWxsIDogdmFsLnRvU3RyaW5nKCks\nIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQk9PTEVBTl9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9V\nQkxFX09CSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nX09CSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRU5VTToKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nT2JqZWN0Rmll\nbGQoaW50bywgaSwgc20uZmV0Y2hPYmplY3RGaWVsZChpKSwgdmFsLAogICAg\nICAgICAgICAgICAgICAgICAgICBzZXQpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgib25s\neS11cGRhdGUtcHJpbWl0aXZlcyIpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyYWNlIGxvZyB0aGF0IHRoZSBx\ndWVyeSBpcyBleGVjdXRpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBs\nb2dFeGVjdXRpb24oaW50IG9wLCBPcmRlcmVkTWFwPE9iamVjdCwgQ2xhc3M8\nPz4+IHR5cGVzLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICBPcmRlcmVk\nTWFwPE9iamVjdCwgT2JqZWN0PiBwbWFwID0gbmV3IE9yZGVyZWRNYXA8T2Jq\nZWN0LCBPYmplY3Q+KCk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPiAw\nKSB7CiAgICAgICAgICAgIGlmICh0eXBlcyAhPSBudWxsICYmIHR5cGVzLnNp\nemUoKSA9PSBwYXJhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpbnQg\naSA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPE9iamVjdD4g\naXRyID0gdHlwZXMua2V5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspCiAgICAgICAgICAgICAgICAgICAgcG1hcC5wdXQoaXRyLm5leHQoKSwg\ncGFyYW1zW2krK10pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICAgICAgcG1hcC5wdXQoU3RyaW5nLnZhbHVlT2Yo\naSksIHBhcmFtc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgbG9nRXhlY3V0aW9uKG9wLCBwbWFwKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRyYWNlIGxvZyB0aGF0IHRoZSBxdWVyeSBpcyBleGVjdXRpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBsb2dFeGVjdXRpb24oaW50IG9wLCBN\nYXA8PywgPz4gcGFyYW1zKSB7CiAgICAgICAgU3RyaW5nIHMgPSBfcXVlcnk7\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocykpCiAgICAgICAg\nICAgIHMgPSB0b1N0cmluZygpOwoKICAgICAgICBTdHJpbmcgbXNnID0gImV4\nZWN1dGluZy1xdWVyeSI7CiAgICAgICAgaWYgKCFwYXJhbXMuaXNFbXB0eSgp\nKQogICAgICAgICAgICBtc2cgKz0gIi13aXRoLXBhcmFtcyI7CgogICAgICAg\nIF9sb2cudHJhY2UoX2xvYy5nZXQobXNnLCBzLCBwYXJhbXMpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoaXMgc2hvdWxkIGJl\nIHRyZWF0ZWQgYXMgYSBwb3RlbnRpYWwgbGFyZ2UgcmVzdWx0IHNldC4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzTFJTKGxvbmcgc3RhcnQsIGxv\nbmcgZW5kKSB7CiAgICAgICAgbG9uZyByYW5nZSA9IGVuZCAtIHN0YXJ0Owog\nICAgICAgIHJldHVybiBfZmMuZ2V0RmV0Y2hCYXRjaFNpemUoKSA+PSAwCiAg\nICAgICAgICAgICYmICEocmFuZ2UgPD0gX2ZjLmdldEZldGNoQmF0Y2hTaXpl\nKCkKICAgICAgICAgICAgfHwgKF9mYy5nZXRGZXRjaEJhdGNoU2l6ZSgpID09\nIDAgJiYgcmFuZ2UgPD0gNTApKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgcXVlcnkgcmVzdWx0IGZvciB0aGUgZ2l2ZW4gcmVzdWx0IG9i\namVjdCBwcm92aWRlci4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0\nb1Jlc3VsdChTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgs\nIAogICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyIHJvcCwgU3RvcmVRdWVy\neS5SYW5nZSByYW5nZSkKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBwYWNrIHByb2plY3Rpb25zIGlmIG5lY2Vzc2FyeQogICAgICAg\nIFN0cmluZ1tdIGFsaWFzZXMgPSBleC5nZXRQcm9qZWN0aW9uQWxpYXNlcyhx\nKTsKICAgICAgICBpZiAoIWV4LmlzUGFja2luZyhxKSkgewogICAgICAgICAg\nICBSZXN1bHRQYWNrZXIgcGFja2VyID0gZ2V0UmVzdWx0UGFja2VyKHEsIGV4\nKTsKICAgICAgICAgICAgaWYgKHBhY2tlciAhPSBudWxsIHx8IGFsaWFzZXMu\nbGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICByb3AgPSBuZXcgUGFja2lu\nZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKHJvcCwgcGFja2VyLAogICAgICAgICAg\nICAgICAgICAgIGFsaWFzZXMubGVuZ3RoKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGlmIHNpbmdsZSByZXN1bHQsIGV4dHJhY3QgaXQKICAgICAgICBpZiAo\nX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUgfHwgKGFsaWFzZXMubGVuZ3RoID4g\nMAogICAgICAgICAgICAmJiAhZXguaGFzR3JvdXBpbmcocSkgJiYgZXguaXNB\nZ2dyZWdhdGUocSkpKQogICAgICAgICAgICByZXR1cm4gc2luZ2xlUmVzdWx0\nKHJvcCwgcmFuZ2UpOwoKICAgICAgICAvLyBub3cgdGhhdCB3ZSd2ZSBleGVj\ndXRlZCB0aGUgcXVlcnksIHdlIGNhbiBjYWxsIGlzQWdncmVnYXRlIGFuZAog\nICAgICAgIC8vIGhhc0dyb3VwaW5nIGVmZmljaWVudGx5CiAgICAgICAgYm9v\nbGVhbiBkZXRhY2ggPSAoX2Jyb2tlci5nZXRBdXRvRGV0YWNoKCkgJgogICAg\nICAgICAgICBBdXRvRGV0YWNoLkRFVEFDSF9OT05UWFJFQUQpID4gMCAmJiAh\nX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAgICAgIGJvb2xlYW4gbHJzID0gcmFu\nZ2UubHJzICYmICFleC5pc0FnZ3JlZ2F0ZShxKSAmJiAhZXguaGFzR3JvdXBp\nbmcocSk7CiAgICAgICAgUmVzdWx0TGlzdDw/PiByZXMgPSAoIWRldGFjaCAm\nJiBscnMpID8gX2ZjLm5ld1Jlc3VsdExpc3Qocm9wKQogICAgICAgICAgICA6\nIG5ldyBFYWdlclJlc3VsdExpc3Qocm9wKTsKICAgICAgICByZXMuc2V0VXNl\nck9iamVjdChuZXcgT2JqZWN0W117cm9wLGV4fSk7CiAgICAgICAgX3Jlc3Vs\ndExpc3RzLmFkZChkZWNvcmF0ZVJlc3VsdExpc3QocmVzKSk7CiAgICAgICAg\ncmV0dXJuIHJlczsKICAgIH0KCiAgICAvKioKICAgICAqIE9wdGlvbmFsbHkg\nZGVjb3JhdGUgdGhlIG5hdGl2ZSByZXN1bHQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBSZW1vdmVPbkNsb3NlUmVzdWx0TGlzdCBkZWNvcmF0ZVJlc3VsdExp\nc3QoUmVzdWx0TGlzdDw/PiByZXMpIHsKICAgICAgICByZXR1cm4gbmV3IFJl\nbW92ZU9uQ2xvc2VSZXN1bHRMaXN0KHJlcyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSByZXN1bHQgcGFja2VyIGZvciB0aGlzIHByb2plY3Rp\nb24sIG9yIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0UGFja2Vy\nIGdldFJlc3VsdFBhY2tlcihTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhl\nY3V0b3IgZXgpIHsKICAgICAgICBpZiAoX3BhY2tlciAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX3BhY2tlcjsKCiAgICAgICAgQ2xhc3M8Pz4gcmVz\ndWx0Q2xhc3MgPSAoX3Jlc3VsdENsYXNzICE9IG51bGwpID8gX3Jlc3VsdENs\nYXNzCiAgICAgICAgICAgIDogZXguZ2V0UmVzdWx0Q2xhc3MocSk7CiAgICAg\nICAgaWYgKHJlc3VsdENsYXNzID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBTdHJpbmdbXSBhbGlhc2VzID0gZXguZ2V0UHJv\namVjdGlvbkFsaWFzZXMocSk7CiAgICAgICAgUmVzdWx0U2hhcGU8Pz4gc2hh\ncGUgPSBleC5nZXRSZXN1bHRTaGFwZShxKTsKICAgICAgICBpZiAoc2hhcGUg\nIT0gbnVsbCkgeyAvLyB1c2luZyBKUEEyLjAgc3R5bGUgcmVzdWx0IHNoYXBl\nIGZvciBwYWNraW5nCiAgICAgICAgICAgIGlmIChhbGlhc2VzLmxlbmd0aCA9\nPSAwKSB7CiAgICAgICAgICAgICAgICBfcGFja2VyID0gbmV3IFJlc3VsdFNo\nYXBlUGFja2VyKG5ldyBDbGFzc1tde19jbGFzc30sIG5ldyBTdHJpbmdbXXsi\nIn0sIHJlc3VsdENsYXNzLCBzaGFwZSk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBfcGFja2VyID0gbmV3IFJlc3VsdFNoYXBlUGFj\na2VyKGV4LmdldFByb2plY3Rpb25UeXBlcyhxKSwgYWxpYXNlcywgcmVzdWx0\nQ2xhc3MsIHNoYXBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGlmIChhbGlhc2VzLmxlbmd0aCA9PSAwKSB7CiAgICAg\nICAgICAgICAgICAvLyByZXN1bHQgY2xhc3MgYnV0IG5vIHJlc3VsdDsgbWVh\nbnMgY2FuZGlkYXRlIGlzIGJlaW5nIHNldAogICAgICAgICAgICAgICAgLy8g\naW50byBzb21lIHJlc3VsdCBjbGFzcwogICAgICAgICAgICAgICAgX3BhY2tl\nciA9IG5ldyBSZXN1bHRQYWNrZXIoX2NsYXNzLCBnZXRBbGlhcygpLCByZXN1\nbHRDbGFzcyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0Q2xhc3Mg\nIT0gbnVsbCkgeyAvLyBwcm9qZWN0aW9uCiAgICAgICAgICAgICAgICBDbGFz\nczw/PltdIHR5cGVzID0gZXguZ2V0UHJvamVjdGlvblR5cGVzKHEpOwogICAg\nICAgICAgICAgICAgX3BhY2tlciA9IG5ldyBSZXN1bHRQYWNrZXIodHlwZXMs\nIGFsaWFzZXMsIHJlc3VsdENsYXNzKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gX3BhY2tlcjsKICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZSBhbiBlbXB0eSByZXN1bHQgZm9yIHRoaXMgcXVlcnkuCiAg\nICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGVtcHR5UmVzdWx0KFN0b3JlUXVl\ncnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCkgewogICAgICAgIGlmIChf\ndW5pcXVlID09IEJvb2xlYW4uVFJVRSB8fCAoX3VuaXF1ZSA9PSBudWxsCiAg\nICAgICAgICAgICYmICFleC5oYXNHcm91cGluZyhxKSAmJiBleC5pc0FnZ3Jl\nZ2F0ZShxKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJl\ndHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgfQoKICAgIC8qKgog\nICAgICogRXh0cmFjdCBhbiBleHBlY3RlZCBzaW5nbGUgcmVzdWx0IGZyb20g\ndGhlIGdpdmVuIHByb3ZpZGVyLiBVc2VkIHdoZW4KICAgICAqIHRoZSByZXN1\nbHQgaXMgYW4gdW5ncm91cGVkIGFnZ3JlZ2F0ZSBvciB0aGUgdW5pcXVlIGZs\nYWcgaXMgc2V0IHRvIHRydWUuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0\nIHNpbmdsZVJlc3VsdChSZXN1bHRPYmplY3RQcm92aWRlciByb3AsIAogICAg\nICAgIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UpCiAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgcm9wLm9wZW4oKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyBtb3ZlIHRvIGV4cGVjdGVkIHJlc3VsdAogICAgICAg\nICAgICBib29sZWFuIG5leHQgPSByb3AubmV4dCgpOwoKICAgICAgICAgICAg\nLy8gZXh0cmFjdCBzaW5nbGUgcmVzdWx0OyB0aHJvdyBhbiBleGNlcHRpb24g\naWYgbXVsdGlwbGUgcmVzdWx0cwogICAgICAgICAgICAvLyBtYXRjaCBhbmQg\nbm90IGNvbnN0cmFpbnRlZCBieSByYW5nZSwgb3IgaWYgYSB1bmlxdWUgcXVl\ncnkgd2l0aAogICAgICAgICAgICAvLyBubyByZXN1bHRzCiAgICAgICAgICAg\nIE9iamVjdCBzaW5nbGUgPSBudWxsOwogICAgICAgICAgICBpZiAobmV4dCkg\newogICAgICAgICAgICAgICAgc2luZ2xlID0gcm9wLmdldFJlc3VsdE9iamVj\ndCgpOwogICAgICAgICAgICAgICAgaWYgKHJhbmdlLmVuZCAhPSByYW5nZS5z\ndGFydCArIDEgJiYgcm9wLm5leHQoKSkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTm9uVW5pcXVlUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb3QtdW5pcXVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgX2NsYXNzLCBf\ncXVlcnkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfdW5pcXVlID09IEJv\nb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBOb1Jlc3Vs\ndEV4Y2VwdGlvbihfbG9jLmdldCgibm8tcmVzdWx0IiwgCiAgICAgICAgICAg\nICAgICAgICAgX2NsYXNzLCBfcXVlcnkpKTsKCiAgICAgICAgICAgIC8vIGlm\nIHVuaXF1ZSBzZXQgdG8gZmFsc2UsIHVzZSBjb2xsZWN0aW9uCiAgICAgICAg\nICAgIGlmIChfdW5pcXVlID09IEJvb2xlYW4uRkFMU0UpIHsKICAgICAgICAg\nICAgICAgIGlmICghbmV4dCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAgICAgICAgICAgIC8vIENv\nbGxlY3Rpb25zLnNpbmdsZXRvbkxpc3QgaXMgSkRLIDEuMywgc28uLi4KICAg\nICAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KG5ldyBPYmplY3Rb\nXXsgc2luZ2xlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAg\nICAgICAgICAvLyByZXR1cm4gc2luZ2xlIHJlc3VsdAogICAgICAgICAgICBy\nZXR1cm4gc2luZ2xlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHJvcC5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENhbGN1bGF0ZXMgd2hldGhlciB0aGUgYWNjZXNzIHBhdGggb2YgdGhpcyBx\ndWVyeSBpbnRlcnNlY3RzIHdpdGgKICAgICAqIGFueSBkaXJ0eSBvYmplY3Rz\nIGluIHRoZSB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIGlzQWNjZXNzUGF0aERpcnR5KCkgewogICAgICAgIHJldHVybiBpc0Fj\nY2Vzc1BhdGhEaXJ0eShfYnJva2VyLCBnZXRBY2Nlc3NQYXRoTWV0YURhdGFz\nKCkpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0FjY2Vz\nc1BhdGhEaXJ0eShCcm9rZXIgYnJva2VyLAogICAgICAgIENsYXNzTWV0YURh\ndGFbXSBhY2Nlc3NNZXRhcykgewogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8\nPz4+IHBlcnNpc3RlZCA9IGJyb2tlci5nZXRQZXJzaXN0ZWRUeXBlcygpOwog\nICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHVwZGF0ZWQgPSBicm9rZXIu\nZ2V0VXBkYXRlZFR5cGVzKCk7CiAgICAgICAgQ29sbGVjdGlvbjxDbGFzczw/\nPj4gZGVsZXRlZCA9IGJyb2tlci5nZXREZWxldGVkVHlwZXMoKTsKICAgICAg\nICBpZiAocGVyc2lzdGVkLmlzRW1wdHkoKSAmJiB1cGRhdGVkLmlzRW1wdHko\nKSAmJiBkZWxldGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICAvLyBpZiBubyBhY2Nlc3MgbWV0YXMsIGFzc3VtZSBl\ndmVyeSBkaXJ0eSBvYmplY3QgYWZmZWN0cyBwYXRoIGp1c3QKICAgICAgICAv\nLyB0byBiZSBzYWZlCiAgICAgICAgaWYgKGFjY2Vzc01ldGFzLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgLy8gY29t\ncGFyZSBkaXJ0eSBjbGFzc2VzIHRvIHRoZSBhY2Nlc3MgcGF0aCBjbGFzc2Vz\nCiAgICAgICAgQ2xhc3M8Pz4gYWNjQ2xhc3M7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBhY2Nlc3NNZXRhcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoYWNjZXNzTWV0YXNbaV0gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAvLyBzaG9ydGN1dCBpZiBhY3R1\nYWwgY2xhc3MgaXMgZGlydHkKICAgICAgICAgICAgYWNjQ2xhc3MgPSBhY2Nl\nc3NNZXRhc1tpXS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgICAgIGlm\nIChwZXJzaXN0ZWQuY29udGFpbnMoYWNjQ2xhc3MpIHx8IHVwZGF0ZWQuY29u\ndGFpbnMoYWNjQ2xhc3MpCiAgICAgICAgICAgICAgICB8fCBkZWxldGVkLmNv\nbnRhaW5zKGFjY0NsYXNzKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwoKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGRpcnR5IHN1YmNsYXNzCiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3I8Q2xhc3M8Pz4+IGRpcnR5ID0gcGVy\nc2lzdGVkLml0ZXJhdG9yKCk7IGRpcnR5Lmhhc05leHQoKTspCiAgICAgICAg\nICAgICAgICBpZiAoYWNjQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbShkaXJ0eS5u\nZXh0KCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yPENsYXNzPD8+PiBkaXJ0eSA9IHVwZGF0\nZWQuaXRlcmF0b3IoKTsgZGlydHkuaGFzTmV4dCgpOykKICAgICAgICAgICAg\nICAgIGlmIChhY2NDbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGRpcnR5Lm5leHQo\nKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3I8Q2xhc3M8Pz4+IGRpcnR5ID0gZGVsZXRlZC5p\ndGVyYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAg\naWYgKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZyb20oZGlydHkubmV4dCgpKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9Cgog\nICAgICAgIC8vIG5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9zZUFsbCgpIHsKICAgICAg\nICBjbG9zZVJlc3VsdHModHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nY2xvc2VSZXNvdXJjZXMoKSB7CiAgICAgICAgY2xvc2VSZXN1bHRzKGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIG9wZW4gcmVzdWx0cy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNsb3NlUmVzdWx0cyhib29sZWFu\nIGZvcmNlKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKCiAgICAgICAgICAgIFJlbW92ZU9uQ2xv\nc2VSZXN1bHRMaXN0IHJlczsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxS\nZW1vdmVPbkNsb3NlUmVzdWx0TGlzdD4gaXRyID0gX3Jlc3VsdExpc3RzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBy\nZXMgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGZvcmNlIHx8\nIHJlcy5pc1Byb3ZpZGVyT3BlbigpKQogICAgICAgICAgICAgICAgICAgIHJl\ncy5jbG9zZShmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3Jl\nc3VsdExpc3RzLmNsZWFyKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKE1hcCBwYXJhbXMpIHsKICAg\nICAgICBpZiAocGFyYW1zID09IG51bGwpCiAgICAgICAgICAgIHBhcmFtcyA9\nIENvbGxlY3Rpb25zLkVNUFRZX01BUDsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5vdFNlcmlhbGl6ZWQoKTsK\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgU3RvcmVR\ndWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAg\nICAgICAgICBhc3NlcnRQYXJhbWV0ZXJzKF9zdG9yZVF1ZXJ5LCBleCwgcGFy\nYW1zKTsKICAgICAgICAgICAgT2JqZWN0W10gYXJyID0gZXgudG9QYXJhbWV0\nZXJBcnJheShfc3RvcmVRdWVyeSwgcGFyYW1zKTsKICAgICAgICAgICAgU3Rv\ncmVRdWVyeS5SYW5nZSByYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdlKF9z\ndGFydElkeCwgX2VuZElkeCk7CiAgICAgICAgICAgIGlmICghX3JhbmdlU2V0\nKQogICAgICAgICAgICAgICAgZXguZ2V0UmFuZ2UoX3N0b3JlUXVlcnksIGFy\nciwgcmFuZ2UpOwogICAgICAgICAgICByZXR1cm4gZXguZ2V0RGF0YVN0b3Jl\nQWN0aW9ucyhfc3RvcmVRdWVyeSwgYXJyLCByYW5nZSk7CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gc2V0UXVlcnkoT2JqZWN0IHF1ZXJ5KSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsK\nCiAgICAgICAgICAgIGlmIChxdWVyeSA9PSBudWxsIHx8IHF1ZXJ5IGluc3Rh\nbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAgICBpbnZhbGlkYXRlQ29t\ncGlsYXRpb24oKTsKICAgICAgICAgICAgICAgIF9xdWVyeSA9IChTdHJpbmcp\nIHF1ZXJ5OwogICAgICAgICAgICAgICAgaWYgKF9xdWVyeSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9xdWVyeSA9IF9xdWVyeS50cmltKCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoIShxdWVyeSBpbnN0YW5jZW9mIFF1ZXJ5SW1wbCkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnkuc2V0UXVlcnkocXVl\ncnkpOwoKICAgICAgICAgICAgLy8gY29weSBhbGwgbm9uLXRyYW5zaWVudCBz\ndGF0ZSBmcm9tIHRoZSBnaXZlbiBxdWVyeQogICAgICAgICAgICBpbnZhbGlk\nYXRlQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAgUXVlcnlJbXBsIHEgPSAo\nUXVlcnlJbXBsKSBxdWVyeTsKICAgICAgICAgICAgX2NsYXNzID0gcS5fY2xh\nc3M7CiAgICAgICAgICAgIF9zdWJjbGFzc2VzID0gcS5fc3ViY2xhc3NlczsK\nICAgICAgICAgICAgX3F1ZXJ5ID0gcS5fcXVlcnk7CiAgICAgICAgICAgIF9p\nZ25vcmVDaGFuZ2VzID0gcS5faWdub3JlQ2hhbmdlczsKICAgICAgICAgICAg\nX3VuaXF1ZSA9IHEuX3VuaXF1ZTsKICAgICAgICAgICAgX3Jlc3VsdENsYXNz\nID0gcS5fcmVzdWx0Q2xhc3M7CiAgICAgICAgICAgIF9wYXJhbXMgPSBxLl9w\nYXJhbXM7CiAgICAgICAgICAgIF9yZXN1bHRNYXBwaW5nU2NvcGUgPSBxLl9y\nZXN1bHRNYXBwaW5nU2NvcGU7CiAgICAgICAgICAgIF9yZXN1bHRNYXBwaW5n\nTmFtZSA9IHEuX3Jlc3VsdE1hcHBpbmdOYW1lOwogICAgICAgICAgICBfcmVh\nZE9ubHkgPSBxLl9yZWFkT25seTsKCiAgICAgICAgICAgIC8vIGRvbid0IHNo\nYXJlIG11dGFibGUgb2JqZWN0cwogICAgICAgICAgICBfZmMuY29weShxLl9m\nYyk7CiAgICAgICAgICAgIGlmIChxLl9maWx0TGlzdGVuZXJzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfZmlsdExpc3RlbmVycyA9IG5ldyBIYXNoTWFw\nPFN0cmluZyxGaWx0ZXJMaXN0ZW5lcj4ocS5fZmlsdExpc3RlbmVycyk7CiAg\nICAgICAgICAgIGlmIChxLl9hZ2dMaXN0ZW5lcnMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9hZ2dMaXN0ZW5lcnMgPSBuZXcgSGFzaE1hcDxTdHJpbmcs\nQWdncmVnYXRlTGlzdGVuZXI+KHEuX2FnZ0xpc3RlbmVycyk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldEFsaWFzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSBjb21waWxlRm9yRXhlY3V0\nb3IoKS5nZXRBbGlhcyhfc3RvcmVRdWVyeSk7CiAgICAgICAgICAgIGlmIChh\nbGlhcyA9PSBudWxsKQogICAgICAgICAgICAgICAgYWxpYXMgPSBTdHJpbmdz\nLmdldENsYXNzTmFtZShfY2xhc3MpOwogICAgICAgICAgICByZXR1cm4gYWxp\nYXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRQcm9q\nZWN0aW9uQWxpYXNlcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmdl\ndFByb2plY3Rpb25BbGlhc2VzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIENsYXNzPD8+W10gZ2V0UHJvamVjdGlvblR5cGVzKCkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0UHJvamVjdGlvblR5cGVz\nKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBn\nZXRPcGVyYXRpb24oKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRP\ncGVyYXRpb24oX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZSgpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVj\ndXRvcigpLmlzQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBib29sZWFuIGlzRGlzdGluY3QoKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBj\nb21waWxlRm9yRXhlY3V0b3IoKS5pc0Rpc3RpbmN0KF9zdG9yZVF1ZXJ5KTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgoKICAgIHB1YmxpYyBib29sZWFuIGhhc0dyb3VwaW5n\nKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuaGFzR3JvdXBpbmcoX3N0\nb3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNZXRh\nRGF0YVtdIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGFb\nXSBtZXRhcyA9IGNvbXBpbGVGb3JFeGVjdXRvcigpLgogICAgICAgICAgICAg\nICAgZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhfc3RvcmVRdWVyeSk7CiAgICAg\nICAgICAgIHJldHVybiAobWV0YXMgPT0gbnVsbCkgPyBTdG9yZVF1ZXJ5LkVN\nUFRZX01FVEFTIDogbWV0YXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBP\ncmRlcmVkTWFwPE9iamVjdCxDbGFzczw/Pj4gZ2V0T3JkZXJlZFBhcmFtZXRl\nclR5cGVzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0T3JkZXJl\nZFBhcmFtZXRlclR5cGVzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBMaW5rZWRNYXAgZ2V0UGFyYW1ldGVyVHlwZXMoKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExp\nbmtlZE1hcCB3cmFwID0gbmV3IExpbmtlZE1hcCgpOwogICAgICAgICAgICB3\ncmFwLnB1dEFsbChjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRPcmRlcmVkUGFy\nYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpKTsKICAgICAgICAgICAgcmV0dXJu\nIHdyYXA7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKCiAgICBwdWJsaWMgTWFwIGdldFVwZGF0\nZXMoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRVcGRhdGVzKF9z\ndG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9j\naygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAgICAgICAgICAg\nX2xvY2subG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVubG9jaygp\nIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAgICAgICAgICAgX2xv\nY2sudW5sb2NrKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzeW5jaHJvbml6\nZWQgdm9pZCBzdGFydExvY2tpbmcoKSB7CiAgICAJaWYgKF9sb2NrID09IG51\nbGwpIHsKICAgIAkJX2xvY2sgPSBuZXcgUmVlbnRyYW50TG9jaygpOwogICAg\nCX0KICAgIH0KICAgIAogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIHN0\nb3BMb2NraW5nKCkgewogICAgCWlmIChfbG9jayAhPSBudWxsICYmICFfYnJv\na2VyLmdldE11bHRpdGhyZWFkZWQoKSkKICAgIAkJX2xvY2sgPSBudWxsOwog\nICAgfQogICAgCiAgICAKCiAgICAvLy8vLy8vLy8KICAgIC8vIFV0aWxzCiAg\nICAvLy8vLy8vLy8KCiAgICBwdWJsaWMgQ2xhc3MgY2xhc3NGb3JOYW1lKFN0\ncmluZyBuYW1lLCBTdHJpbmdbXSBpbXBvcnRzKSB7CiAgICAgICAgLy8gZnVs\nbCBjbGFzcyBuYW1lIG9yIHByaW1pdGl2ZSB0eXBlPwogICAgICAgIENsYXNz\nIHR5cGUgPSB0b0NsYXNzKG5hbWUpOwogICAgICAgIGlmICh0eXBlICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiB0eXBlOwoKICAgICAgICAvLyBmaXJz\ndCBjaGVjayB0aGUgYWxpYXNlcyBtYXAgaW4gdGhlIE1ldGFEYXRhUmVwb3Np\ndG9yeQogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IChfY2xhc3MgPT0g\nbnVsbCkgPyBfbG9hZGVyCiAgICAgICAgICAgIDogQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXRDbGFzc0xvYWRlckFjdGlvbihfY2xhc3MpKTsgCiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCku\nCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCku\nZ2V0TWV0YURhdGEobmFtZSwgbG9hZGVyLCBmYWxzZSk7CiAgICAgICAgaWYg\nKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpOwoKICAgICAgICAvLyB0cnkgdGhlIG5hbWUgaW4gdGhl\nIHBhY2thZ2Ugb2YgdGhlIGNhbmRpZGF0ZSBjbGFzcwogICAgICAgIGlmIChf\nY2xhc3MgIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgZnVsbE5hbWUg\nPSBfY2xhc3MuZ2V0TmFtZSgpLnN1YnN0cmluZwogICAgICAgICAgICAgICAg\nKDAsIF9jbGFzcy5nZXROYW1lKCkubGFzdEluZGV4T2YoJy4nKSArIDEpICsg\nbmFtZTsKICAgICAgICAgICAgdHlwZSA9IHRvQ2xhc3MoZnVsbE5hbWUpOwog\nICAgICAgICAgICBpZiAodHlwZSAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIHR5cGU7CiAgICAgICAgfQoKICAgICAgICAvLyB0cnkgamF2YS5s\nYW5nCiAgICAgICAgdHlwZSA9IHRvQ2xhc3MoImphdmEubGFuZy4iICsgbmFt\nZSk7CiAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHR5cGU7CgogICAgICAgIC8vIHRyeSBlYWNoIGltcG9ydAogICAgICAg\nIGlmIChpbXBvcnRzICE9IG51bGwgJiYgaW1wb3J0cy5sZW5ndGggPiAwKSB7\nCiAgICAgICAgICAgIFN0cmluZyBkb3ROYW1lID0gIi4iICsgbmFtZTsKICAg\nICAgICAgICAgU3RyaW5nIGltcG9ydE5hbWU7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgaW1wb3J0cy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaW1wb3J0TmFtZSA9IGltcG9ydHNbaV07CgogICAgICAgICAg\nICAgICAgLy8gZnVsbCBjbGFzcyBuYW1lIGltcG9ydAogICAgICAgICAgICAg\nICAgaWYgKGltcG9ydE5hbWUuZW5kc1dpdGgoZG90TmFtZSkpCiAgICAgICAg\nICAgICAgICAgICAgdHlwZSA9IHRvQ2xhc3MoaW1wb3J0TmFtZSk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gd2lsZGNhcmQ7IHN0cmlwIHRvIHBhY2thZ2UK\nICAgICAgICAgICAgICAgIGVsc2UgaWYgKGltcG9ydE5hbWUuZW5kc1dpdGgo\nIi4qIikpIHsKICAgICAgICAgICAgICAgICAgICBpbXBvcnROYW1lID0gaW1w\nb3J0TmFtZS5zdWJzdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgKDAs\nIGltcG9ydE5hbWUubGVuZ3RoKCkgLSAxKTsKICAgICAgICAgICAgICAgICAg\nICB0eXBlID0gdG9DbGFzcyhpbXBvcnROYW1lICsgbmFtZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodHlwZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSB7QGxpbmsgQ2xhc3N9IGZvciB0aGUgZ2l2\nZW4gbmFtZSwgb3IgbnVsbCBpZiBuYW1lIG5vdCB2YWxpZC4KICAgICAqLwog\nICAgcHJpdmF0ZSBDbGFzcyB0b0NsYXNzKFN0cmluZyBuYW1lKSB7CiAgICAg\nICAgaWYgKF9sb2FkZXIgPT0gbnVsbCkKICAgICAgICAgICAgX2xvYWRlciA9\nIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldENsYXNzUmVzb2x2ZXJJ\nbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoX2Ns\nYXNzLCBfYnJva2VyLmdldENsYXNzTG9hZGVyKCkpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHJldHVybiBTdHJpbmdzLnRvQ2xhc3MobmFtZSwgX2xv\nYWRlcik7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgIH0gY2F0Y2ggKE5vQ2xhc3NEZWZGb3VuZEVycm9yIG5jZGZl\nKSB7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGFzc2VydE9wZW4oKSB7CiAgICAgICAgaWYgKF9icm9r\nZXIgIT0gbnVsbCkKICAgICAgICAgICAgX2Jyb2tlci5hc3NlcnRPcGVuKCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm90UmVhZE9ubHkoKSB7\nCiAgICAgICAgaWYgKF9yZWFkT25seSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgicmVhZC1vbmx5Iikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydE5vdFNlcmlhbGl6ZWQo\nKSB7CiAgICAgICAgaWYgKF9icm9rZXIgPT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgic2Vy\naWFsaXplZCIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoYXQg\nYSBjYW5kaWRhdGUgY2xhc3MgaGFzIGJlZW4gc2V0IGZvciB0aGUgcXVlcnku\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhc3NlcnRDYW5kaWRhdGVUeXBl\nKCkgewogICAgICAgIGlmIChfY2xhc3MgPT0gbnVsbCAmJiBfc3RvcmVRdWVy\neS5yZXF1aXJlc0NhbmRpZGF0ZVR5cGUoKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm8tY2xhc3Mi\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0aGF0IHdlIGFyZSBp\nbiBhIHN0YXRlIHRvIGJlIGFibGUgdG8gcGVyZm9ybSBhIGJ1bGsgb3BlcmF0\naW9uOwogICAgICogYWxzbyBmbHVzaCB0aGUgY3VycmVudCBtb2RmaWNhdGlv\nbnMgaWYgYW55IGVsZW1lbnRzIGFyZSBjdXJyZW50bHkgZGlydHkuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhc3NlcnRCdWxrTW9kaWZ5KFN0b3JlUXVl\ncnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgCiAgICAgICAgT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgX2Jyb2tlci5hc3NlcnRBY3RpdmVUcmFu\nc2FjdGlvbigpOwogICAgICAgIGlmIChfc3RhcnRJZHggIT0gMCB8fCBfZW5k\nSWR4ICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbW9kaWZ5LXJhbmdlIikpOwog\nICAgICAgIGlmIChfcmVzdWx0Q2xhc3MgIT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1vZGlmeS1y\nZXN1bHRjbGFzcyIpKTsKICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdl\nID0gbmV3IFN0b3JlUXVlcnkuUmFuZ2UoKTsKICAgICAgICBleC5nZXRSYW5n\nZShxLCBwYXJhbXMsIHJhbmdlKTsKICAgICAgICBpZiAocmFuZ2Uuc3RhcnQg\nIT0gMCB8fCByYW5nZS5lbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tb2Rp\nZnktcmFuZ2UiKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgdGhh\ndCB0aGUgcGFzc2VkIHBhcmFtZXRlcnMgbWF0Y2ggdGhlIGRlY2xhcmF0aW9u\ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYXNzZXJ0UGFyYW1ldGVy\ncyhTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIAogICAg\nICAgIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIGlmICghcS5yZXF1aXJl\nc1BhcmFtZXRlckRlY2xhcmF0aW9ucygpIHx8ICFpc1BhcnNlZFF1ZXJ5KCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgT3JkZXJlZE1hcDxPYmpl\nY3QsQ2xhc3M8Pz4+IHBhcmFtVHlwZXMgPSBleC5nZXRPcmRlcmVkUGFyYW1l\ndGVyVHlwZXMocSk7CiAgICAgICAgaW50IHR5cGVDb3VudCA9IHBhcmFtVHlw\nZXMuc2l6ZSgpOwogICAgICAgIGlmICh0eXBlQ291bnQgPiBwYXJhbXMubGVu\nZ3RoKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgidW5ib3VuZC1wYXJhbXMiLAogICAgICAgICAgICAgICAgcGFyYW1U\neXBlcy5rZXlTZXQoKSkpOwoKICAgICAgICBJdGVyYXRvcjxNYXAuRW50cnk8\nT2JqZWN0LENsYXNzPD8+Pj4gaXRyID0gcGFyYW1UeXBlcy5lbnRyeVNldCgp\nLml0ZXJhdG9yKCk7CiAgICAgICAgTWFwLkVudHJ5PE9iamVjdCxDbGFzczw/\nPj4gZW50cnk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGl0ci5oYXNOZXh0\nKCk7IGkrKykgewogICAgICAgICAgICBlbnRyeSA9IGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgIGlmIChlbnRyeS5nZXRWYWx1ZSgpLmlzUHJpbWl0aXZlKCkg\nJiYgcGFyYW1zW2ldID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1wcmltaXRpdmUtcGFy\nYW0iLCBlbnRyeS5nZXRLZXkoKSkpOwogICAgICAgIH0KICAgIH0KICAgIAog\nICAgcHJvdGVjdGVkIHZvaWQgYXNzZXJ0UGFyYW1ldGVycyhTdG9yZVF1ZXJ5\nIHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIE1hcCBwYXJhbXMpIHsKICAg\nICAgICBpZiAoIXEucmVxdWlyZXNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBPcmRlcmVkTWFwPE9iamVj\ndCxDbGFzczw/Pj4gcGFyYW1UeXBlcyA9IGV4LmdldE9yZGVyZWRQYXJhbWV0\nZXJUeXBlcyhxKTsKICAgICAgICBmb3IgKE9iamVjdCBhY3R1YWwgOiBwYXJh\nbXMua2V5U2V0KCkpIHsKICAgICAgICAgICAgaWYgKCFwYXJhbVR5cGVzLmNv\nbnRhaW5zS2V5KGFjdHVhbCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bmJvdW5kLXBhcmFtcyIsCiAgICAgICAg\nICAgICAgICBhY3R1YWwsIHBhcmFtVHlwZXMua2V5U2V0KCkpKTsKICAgICAg\nICB9CiAgICAgICAgZm9yIChPYmplY3QgZXhwZWN0ZWQgOiBwYXJhbVR5cGVz\nLmtleVNldCgpKSB7CiAgICAgICAgICAgIGlmICghcGFyYW1zLmNvbnRhaW5z\nS2V5KGV4cGVjdGVkKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoInVuYm91bmQtcGFyYW1zIiwKICAgICAgICAgICAg\nICAgIGV4cGVjdGVkLCBwYXJhbXMua2V5U2V0KCkpKTsKICAgICAgICB9Cgog\nICAgICAgIEl0ZXJhdG9yPE1hcC5FbnRyeTxPYmplY3QsIENsYXNzPD8+Pj4g\naXRyID0gcGFyYW1UeXBlcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAg\nICAgTWFwLkVudHJ5PE9iamVjdCwgQ2xhc3M8Pz4+IGVudHJ5OwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpdHIuaGFzTmV4dCgpOyBpKyspIHsKICAgICAg\nICAgICAgZW50cnkgPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoZW50\ncnkuZ2V0VmFsdWUoKS5pc1ByaW1pdGl2ZSgpIAogICAgICAgICAgICAgICAg\nJiYgcGFyYW1zLmdldChlbnRyeS5nZXRLZXkoKSkgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\ndWxsLXByaW1pdGl2ZS1wYXJhbSIsIGVudHJ5LmdldEtleSgpKSk7CiAgICAg\nICAgfQogICAgfQoKCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewog\nICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIo\nMjU1KTsKICAgICAgICBidWYuYXBwZW5kKCJRdWVyeTogIikuYXBwZW5kKHN1\ncGVyLnRvU3RyaW5nKCkpOwogICAgICAgIGJ1Zi5hcHBlbmQoIjsgY2FuZGlk\nYXRlIGNsYXNzOiAiKS5hcHBlbmQoX2NsYXNzKTsKICAgICAgICBidWYuYXBw\nZW5kKCI7IHF1ZXJ5OiAiKS5hcHBlbmQoX3F1ZXJ5KTsKICAgICAgICByZXR1\ncm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJ1\nY3Qgb2YgY29tcGlsZWQgcXVlcnkgcHJvcGVydGllcy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBDb21waWxhdGlvbgogICAgICAgIGlt\ncGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIFN0b3Jl\nUXVlcnkuRXhlY3V0b3IgbWVtb3J5ID0gbnVsbDsKICAgICAgICBwdWJsaWMg\nU3RvcmVRdWVyeS5FeGVjdXRvciBkYXRhc3RvcmUgPSBudWxsOwogICAgICAg\nIHB1YmxpYyBPYmplY3Qgc3RvcmVEYXRhID0gbnVsbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFN0cnVjdCB0byBob2xkIHRoZSB1bnBhcnNlZCBwcm9wZXJ0\naWVzIGFzc29jaWF0ZWQgd2l0aCBhIHF1ZXJ5LgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBjbGFzcyBDb21waWxhdGlvbktleQogICAgICAgIGltcGxl\nbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIENsYXNzIHF1\nZXJ5VHlwZSA9IG51bGw7CiAgICAgICAgcHVibGljIENsYXNzIGNhbmRpZGF0\nZVR5cGUgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIHN1YmNsYXNz\nZXMgPSB0cnVlOwogICAgICAgIHB1YmxpYyBTdHJpbmcgcXVlcnkgPSBudWxs\nOwogICAgICAgIHB1YmxpYyBTdHJpbmcgbGFuZ3VhZ2UgPSBudWxsOwogICAg\nICAgIHB1YmxpYyBPYmplY3Qgc3RvcmVLZXkgPSBudWxsOwoKICAgICAgICBw\ndWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQgcnMgPSAx\nNzsKICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChxdWVyeVR5cGUgPT0g\nbnVsbCkgPyAwIDogcXVlcnlUeXBlLmhhc2hDb2RlKCkpOwogICAgICAgICAg\nICBycyA9IDM3ICogcnMgKyAoKHF1ZXJ5ID09IG51bGwpID8gMCA6IHF1ZXJ5\nLmhhc2hDb2RlKCkpOwogICAgICAgICAgICBycyA9IDM3ICogcnMgKyAoKGxh\nbmd1YWdlID09IG51bGwpID8gMCA6IGxhbmd1YWdlLmhhc2hDb2RlKCkpOwog\nICAgICAgICAgICBycyA9IDM3ICogcnMgKyAoKHN0b3JlS2V5ID09IG51bGwp\nID8gMCA6IHN0b3JlS2V5Lmhhc2hDb2RlKCkpOwogICAgICAgICAgICBpZiAo\nc3ViY2xhc3NlcykKICAgICAgICAgICAgICBycysrOwogICAgICAgICAgICBy\nZXR1cm4gcnM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9\nPSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nICAgIGlmIChvdGhlciA9PSBudWxsIHx8IG90aGVyLmdldENsYXNzKCkgIT0g\nZ2V0Q2xhc3MoKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgICAgIENvbXBpbGF0aW9uS2V5IGtleSA9IChDb21waWxhdGlvbktl\neSkgb3RoZXI7CiAgICAgICAgICAgIGlmIChrZXkucXVlcnlUeXBlICE9IHF1\nZXJ5VHlwZQogICAgICAgICAgICAgICAgfHwgIVN0cmluZ1V0aWxzLmVxdWFs\ncyhrZXkucXVlcnksIHF1ZXJ5KQogICAgICAgICAgICAgICAgfHwgIVN0cmlu\nZ1V0aWxzLmVxdWFscyhrZXkubGFuZ3VhZ2UsIGxhbmd1YWdlKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGtleS5z\ndWJjbGFzc2VzICE9IHN1YmNsYXNzZXMpCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghT2JqZWN0VXRpbHMuZXF1YWxz\nKGtleS5zdG9yZUtleSwgc3RvcmVLZXkpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwoKICAgICAgICAgICAgLy8gYWxsb3cgZWl0aGVyIGNhbmRp\nZGF0ZSB0eXBlIHRvIGJlIG51bGwgYmVjYXVzZSBpdCBtaWdodCBiZQogICAg\nICAgICAgICAvLyBlbmNvZGVkIGluIHRoZSBxdWVyeSBzdHJpbmcsIGJ1dCBp\nZiBib3RoIGFyZSBzZXQgdGhlbiB0aGV5CiAgICAgICAgICAgIC8vIG11c3Qg\nYmUgZXF1YWwKICAgICAgICAgICAgcmV0dXJuIGtleS5jYW5kaWRhdGVUeXBl\nID09IG51bGwgfHwgY2FuZGlkYXRlVHlwZSA9PSBudWxsCiAgICAgICAgICAg\nICAgICB8fCBrZXkuY2FuZGlkYXRlVHlwZSA9PSBjYW5kaWRhdGVUeXBlOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEgbWVyZ2VkIGV4ZWN1\ndG9yIGV4ZWN1dGVzIG11bHRpcGxlIFF1ZXJpZXMgYW5kIHJldHVybnMKICAg\nICAqIGEgbWVyZ2VkIHJlc3VsdCBsaXN0IHdpdGggdGhlIGFwcHJvcHJpYXRl\nIG9yZGVyaW5nIChpZiBtb3JlIHRoYW4KICAgICAqIG9uZSBxdWVyeSBuZWVk\ncyB0byBiZSBleGVjdXRlZCkuIFRoaXMgZXhlY3V0b3IgaGFzIHRoZSBmb2xs\nb3dpbmcKICAgICAqIGxpbWl0YXRpb25zOgogICAgICogPHVsPgogICAgICog\nPGxpPkl0IGNhbm5vdCBjb21iaW5lIGFnZ3JlZ2F0ZXMuCiAgICAgKiA8bGk+\nSXQgY2Fubm90IGNvbGxhdGUgdGhlIHJlc3VsdCBsaXN0cyBpZiBvcmRlcmlu\nZyBpcyBzcGVjaWZpZWQgYW5kCiAgICAgKiBhIHJlc3VsdCBzdHJpbmcgaXMg\nZ2l2ZW4sIGJ1dCBkb2VzIG5vdCBpbmNsdWRlIHRoZSBvcmRlcmluZwogICAg\nICogY3JpdGVyaWEuPC9saT4KICAgICAqIDxsaT5JdCBjYW5ub3QgZmlsdGVy\nIGR1cGxpY2F0ZSByZXN1bHRzIGZyb20gZGlmZmVyZW50IHJlc3VsdCBsaXN0\ncyBpZgogICAgICogdGhlIHJlc3VsdCBpcyBtYXJrZWQgZGlzdGluY3QuIFRo\naXMgd291bGQgcmVxdWlyZSB0cmFja2luZyBhbGwKICAgICAqIHByZXZpb3Vz\nIHJlc3VsdHMsIHdoaWNoIHdvdWxkIGludGVyZmVyZSB3aXRoIGxhcmdlIHJl\nc3VsdCBzZXQKICAgICAqIGhhbmRsaW5nLjwvbGk+CiAgICAgKiA8L3VsPgog\nICAgICoKICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAg\nKiBAbm9qYXZhZG9jCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIE1lcmdlZEV4ZWN1dG9yCiAgICAgICAgaW1wbGVtZW50cyBTdG9yZVF1ZXJ5\nLkV4ZWN1dG9yIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdG9yZVF1ZXJ5\nLkV4ZWN1dG9yW10gX2V4ZWN1dG9yczsKCiAgICAgICAgcHVibGljIE1lcmdl\nZEV4ZWN1dG9yKFN0b3JlUXVlcnkuRXhlY3V0b3JbXSBleGVjdXRvcnMpIHsK\nICAgICAgICAgICAgX2V4ZWN1dG9ycyA9IGV4ZWN1dG9yczsKICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgcHVibGljIFF1ZXJ5RXhwcmVzc2lvbnNbXSBn\nZXRRdWVyeUV4cHJlc3Npb25zKCkgewogICAgICAgICAgICByZXR1cm4gX2V4\nZWN1dG9yc1swXS5nZXRRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZVF1\nZXJ5KFN0b3JlUXVlcnkgcSwKICAgICAgICAgICAgT2JqZWN0W10gcGFyYW1z\nLCBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIGlmIChf\nZXhlY3V0b3JzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJu\nIF9leGVjdXRvcnNbMF0uZXhlY3V0ZVF1ZXJ5KHEsIHBhcmFtcywgcmFuZ2Up\nOwoKICAgICAgICAgICAgLy8gdXNlIGxycyBzZXR0aW5ncyBpZiB3ZSBjb3Vs\nZG4ndCB0YWtlIGFkdmFudGFnZSBvZiB0aGUgc3RhcnQgaW5kZXgKICAgICAg\nICAgICAgLy8gc28gdGhhdCBob3BlZnVsbHkgdGhlIHNraXAgdG8gdGhlIHN0\nYXJ0IHdpbGwgYmUgZWZmaWNpZW50CiAgICAgICAgICAgIFN0b3JlUXVlcnku\nUmFuZ2Ugcm9wUmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZSgwLCByYW5n\nZS5lbmQpOwogICAgICAgICAgICByb3BSYW5nZS5scnMgPSByYW5nZS5scnMg\nfHwgKHJhbmdlLnN0YXJ0ID4gMCAmJiBxLmdldENvbnRleHQoKS4KICAgICAg\nICAgICAgICAgIGdldEZldGNoQ29uZmlndXJhdGlvbigpLmdldEZldGNoQmF0\nY2hTaXplKCkgPj0gMCk7CgogICAgICAgICAgICAvLyBleGVjdXRlIHRoZSBx\ndWVyeTsgd2UgY2Fubm90IHVzZSB0aGUgbG93ZXIgYm91bmQgb2YgdGhlIHJl\nc3VsdAogICAgICAgICAgICAvLyByYW5nZSwgYnV0IHdlIGNhbiB0YWtlIGFk\ndmFudGFnZSBvZiB0aGUgdXBwZXIgYm91bmQKICAgICAgICAgICAgUmVzdWx0\nT2JqZWN0UHJvdmlkZXJbXSByb3BzID0KICAgICAgICAgICAgICAgIG5ldyBS\nZXN1bHRPYmplY3RQcm92aWRlcltfZXhlY3V0b3JzLmxlbmd0aF07CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgIHJvcHNbaV0gPSBfZXhlY3V0b3JzW2ld\nLmV4ZWN1dGVRdWVyeShxLCBwYXJhbXMsIHJvcFJhbmdlKTsKCiAgICAgICAg\nICAgIGJvb2xlYW5bXSBhc2MgPSBfZXhlY3V0b3JzWzBdLmdldEFzY2VuZGlu\nZyhxKTsKICAgICAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wOwog\nICAgICAgICAgICBpZiAoYXNjLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAg\nICAgcm9wID0gbmV3IE1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyKHJvcHMp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByb3AgPSBuZXcg\nT3JkZXJpbmdNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcihyb3BzLCBhc2Ms\nCiAgICAgICAgICAgICAgICAgICAgX2V4ZWN1dG9ycywgcSwgcGFyYW1zKTsK\nCiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGEgbG93ZXIgYm91bmQsIHdy\nYXAgaW4gcmFuZ2Ugcm9wCiAgICAgICAgICAgIGlmIChyYW5nZS5zdGFydCAh\nPSAwKQogICAgICAgICAgICAgICAgcm9wID0gbmV3IFJhbmdlUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIocm9wLCByYW5nZS5zdGFydCwgCiAgICAgICAgICAgICAg\nICAgICAgcmFuZ2UuZW5kKTsKICAgICAgICAgICAgcmV0dXJuIHJvcDsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBOdW1iZXIgZXhlY3V0ZURlbGV0ZShT\ndG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgICAgICBs\nb25nIG51bSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIG51bSAr\nPSBfZXhlY3V0b3JzW2ldLmV4ZWN1dGVEZWxldGUocSwgcGFyYW1zKS5sb25n\nVmFsdWUoKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihu\ndW0pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE51bWJlciBleGVjdXRl\nVXBkYXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAg\nICAgICAgIGxvbmcgbnVtID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgbnVtICs9IF9leGVjdXRvcnNbaV0uZXhlY3V0ZVVwZGF0ZShxLCBwYXJh\nbXMpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52\nYWx1ZU9mKG51bSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5n\nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhTdG9yZVF1ZXJ5IHEsIE9iamVjdFtd\nIHBhcmFtcywKICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkg\newogICAgICAgICAgICBpZiAoX2V4ZWN1dG9ycy5sZW5ndGggPT0gMSkKICAg\nICAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldERhdGFTdG9y\nZUFjdGlvbnMocSwgcGFyYW1zLCByYW5nZSk7CgogICAgICAgICAgICBMaXN0\nIHJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0KF9leGVjdXRvcnMubGVuZ3RoKTsK\nICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByb3BSYW5nZSA9IG5ldyBT\ndG9yZVF1ZXJ5LlJhbmdlKDBMLCByYW5nZS5lbmQpOwogICAgICAgICAgICBT\ndHJpbmdbXSBhY3Rpb25zOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nIGFjdGlvbnMgPSBfZXhlY3V0b3JzW2ldLmdldERhdGFTdG9yZUFjdGlvbnMo\ncSwgcGFyYW1zLHJvcFJhbmdlKTsKICAgICAgICAgICAgICAgIGlmIChhY3Rp\nb25zICE9IG51bGwgJiYgYWN0aW9ucy5sZW5ndGggPiAwKQogICAgICAgICAg\nICAgICAgICAgIHJlc3VsdHMuYWRkQWxsKEFycmF5cy5hc0xpc3QoYWN0aW9u\ncykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoU3RyaW5n\nW10pIHJlc3VsdHMudG9BcnJheShuZXcgU3RyaW5nW3Jlc3VsdHMuc2l6ZSgp\nXSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCB2YWxpZGF0ZShT\ndG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgX2V4ZWN1dG9yc1swXS52YWxp\nZGF0ZShxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGdldFJh\nbmdlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLCAKICAgICAgICAg\nICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkgewogICAgICAgICAgICBfZXhl\nY3V0b3JzWzBdLmdldFJhbmdlKHEsIHBhcmFtcywgcmFuZ2UpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRlcmluZ1ZhbHVlKFN0\nb3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBPYmpl\nY3QgcmVzdWx0T2JqZWN0LCBpbnQgaWR4KSB7CiAgICAgICAgICAgIC8vIHVu\nZm9ydHVuYXRlbHksIGF0IHRoaXMgcG9pbnQgKG11c3QgYmUgYSBtZXJnZWQg\ncm9wIGNvbnRhaW5pbmcKICAgICAgICAgICAgLy8gb3RoZXIgbWVyZ2VkIHJv\ncHMpIHdlIGhhdmUgbm8gaWRlYSB3aGljaCBleGVjdXRvciB0byBleHRyYWN0\nCiAgICAgICAgICAgIC8vIHRoZSB2YWx1ZSBmcm9tCiAgICAgICAgICAgIHJl\ndHVybiBfZXhlY3V0b3JzWzBdLmdldE9yZGVyaW5nVmFsdWUocSwgcGFyYW1z\nLCByZXN1bHRPYmplY3QsIGlkeCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbltdIGdldEFzY2VuZGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0QXNjZW5kaW5nKHEp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRBbGlhcyhT\ndG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNb\nMF0uZ2V0QWxpYXMocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0UHJvamVjdGlvbkFsaWFzZXMoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFByb2plY3Rpb25B\nbGlhc2VzKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIENsYXNzIGdl\ndFJlc3VsdENsYXNzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1\ncm4gX2V4ZWN1dG9yc1swXS5nZXRSZXN1bHRDbGFzcyhxKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBSZXN1bHRTaGFwZTw/PiBnZXRSZXN1bHRTaGFw\nZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRv\ncnNbMF0uZ2V0UmVzdWx0U2hhcGUocSk7CiAgICAgICAgfQogICAgICAgIAog\nICAgICAgIHB1YmxpYyBDbGFzc1tdIGdldFByb2plY3Rpb25UeXBlcyhTdG9y\nZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0u\nZ2V0UHJvamVjdGlvblR5cGVzKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gaXNQYWNraW5nKFN0b3JlUXVlcnkgcSkgewogICAgICAg\nICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5pc1BhY2tpbmcocSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldEFjY2Vz\nc1BhdGhNZXRhRGF0YXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIGlm\nIChfZXhlY3V0b3JzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgcmV0\ndXJuIF9leGVjdXRvcnNbMF0uZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhxKTsK\nCiAgICAgICAgICAgIC8vIGNyZWF0ZSBzZXQgb2YgYmFzZSBjbGFzcyBtZXRh\nZGF0YXMgaW4gYWNjZXNzIHBhdGgKICAgICAgICAgICAgTGlzdCBtZXRhcyA9\nIG51bGw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1\ndG9ycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIG1ldGFzID0gRmls\ndGVycy5hZGRBY2Nlc3NQYXRoTWV0YURhdGFzKG1ldGFzLCBfZXhlY3V0b3Jz\nW2ldLgogICAgICAgICAgICAgICAgICAgIGdldEFjY2Vzc1BhdGhNZXRhRGF0\nYXMocSkpOwogICAgICAgICAgICBpZiAobWV0YXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVNUFRZX01FVEFTOwogICAg\nICAgICAgICByZXR1cm4gKENsYXNzTWV0YURhdGFbXSkgbWV0YXMudG9BcnJh\neQogICAgICAgICAgICAgICAgKG5ldyBDbGFzc01ldGFEYXRhW21ldGFzLnNp\nemUoKV0pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNB\nZ2dyZWdhdGUoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIGlmICghX2V4\nZWN1dG9yc1swXS5pc0FnZ3JlZ2F0ZShxKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHdlIGNhbid0IG1lcmdlIGFn\nZ3JlZ2F0ZXMKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJtZXJnZWQtYWdncmVnYXRlIiwKICAgICAgICAg\nICAgICAgIHEuZ2V0Q29udGV4dCgpLmdldENhbmRpZGF0ZVR5cGUoKSwKICAg\nICAgICAgICAgICAgIHEuZ2V0Q29udGV4dCgpLmdldFF1ZXJ5U3RyaW5nKCkp\nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNEaXN0aW5jdChTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9leGVjdXRvcnNbMF0uaXNEaXN0aW5jdChxKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBpbnQgZ2V0T3BlcmF0aW9uKFN0b3JlUXVlcnkgcSkgewog\nICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRPcGVyYXRpb24o\ncSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNHcm91\ncGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVj\ndXRvcnNbMF0uaGFzR3JvdXBpbmcocSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgT3JkZXJlZE1hcDxPYmplY3QsQ2xhc3M8Pz4+IGdldE9yZGVyZWRQ\nYXJhbWV0ZXJUeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9leGVjdXRvcnNbMF0uZ2V0T3JkZXJlZFBhcmFtZXRlclR5cGVzKHEp\nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwdWJsaWMgTGlua2VkTWFw\nIGdldFBhcmFtZXRlclR5cGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRQYXJhbWV0ZXJUeXBlcyhxKTsK\nICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIE9iamVjdFtdIHRv\nUGFyYW1ldGVyQXJyYXkoU3RvcmVRdWVyeSBxLCBNYXAgdXNlclBhcmFtcykg\newogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS50b1BhcmFtZXRl\nckFycmF5KHEsIHVzZXJQYXJhbXMpOwogICAgICAgIH0KCgogICAgICAgIHB1\nYmxpYyBNYXAgZ2V0VXBkYXRlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0VXBkYXRlcyhxKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXN1bHQgb2JqZWN0IHByb3Zp\nZGVyIHRoYXQgcGFja3MgcmVzdWx0cyBiZWZvcmUgcmV0dXJuaW5nIHRoZW0u\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgUGFja2luZ1Jlc3Vs\ndE9iamVjdFByb3ZpZGVyCiAgICAgICAgaW1wbGVtZW50cyBSZXN1bHRPYmpl\nY3RQcm92aWRlciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIgX2RlbGVnYXRlOwogICAgICAgIHByaXZhdGUgZmluYWwg\nUmVzdWx0UGFja2VyIF9wYWNrZXI7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBp\nbnQgX2xlbjsKCiAgICAgICAgcHVibGljIFBhY2tpbmdSZXN1bHRPYmplY3RQ\ncm92aWRlcihSZXN1bHRPYmplY3RQcm92aWRlciBkZWxlZ2F0ZSwKICAgICAg\nICAgICAgUmVzdWx0UGFja2VyIHBhY2tlciwgaW50IHJlc3VsdExlbmd0aCkg\newogICAgICAgICAgICBfZGVsZWdhdGUgPSBkZWxlZ2F0ZTsKICAgICAgICAg\nICAgX3BhY2tlciA9IHBhY2tlcjsKICAgICAgICAgICAgX2xlbiA9IHJlc3Vs\ndExlbmd0aDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzUmFuZG9tQWNjZXNzKCkgewogICAgICAgICAgICByZXR1cm4gX2Rl\nbGVnYXRlLnN1cHBvcnRzUmFuZG9tQWNjZXNzKCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBvcGVuKCkKICAgICAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIF9kZWxlZ2F0ZS5vcGVuKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldFJlc3VsdE9iamVjdCgp\nCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBP\nYmplY3Qgb2IgPSBfZGVsZWdhdGUuZ2V0UmVzdWx0T2JqZWN0KCk7CiAgICAg\nICAgICAgIGlmIChfcGFja2VyID09IG51bGwgJiYgX2xlbiA9PSAxKQogICAg\nICAgICAgICAgICAgcmV0dXJuICgoT2JqZWN0W10pIG9iKVswXTsKICAgICAg\nICAgICAgaWYgKF9wYWNrZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBvYjsKICAgICAgICAgICAgaWYgKF9sZW4gPT0gMCkKICAgICAgICAg\nICAgICAgIHJldHVybiBfcGFja2VyLnBhY2sob2IpOwogICAgICAgICAgICBy\nZXR1cm4gX3BhY2tlci5wYWNrKChPYmplY3RbXSkgb2IpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gbmV4dCgpCiAgICAgICAgICAgIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gX2RlbGVnYXRl\nLm5leHQoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFi\nc29sdXRlKGludCBwb3MpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgICAgICByZXR1cm4gX2RlbGVnYXRlLmFic29sdXRlKHBvcyk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKQogICAgICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIF9k\nZWxlZ2F0ZS5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCByZXNldCgpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBfZGVsZWdhdGUucmVzZXQoKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGNsb3NlKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIF9kZWxlZ2F0ZS5jbG9zZSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgaGFuZGxlQ2hlY2tlZEV4Y2VwdGlv\nbihFeGNlcHRpb24gZSkgewogICAgICAgICAgICBfZGVsZWdhdGUuaGFuZGxl\nQ2hlY2tlZEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgcHVibGljIFJlc3VsdE9iamVjdFByb3ZpZGVyIGdldERlbGVnYXRlKCkg\newogICAgICAgICAgICByZXR1cm4gX2RlbGVnYXRlOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJlc3VsdCBsaXN0IHRoYXQgcmVtb3ZlcyBp\ndHNlbGYgZnJvbSB0aGUgcXVlcnkncyBvcGVuIHJlc3VsdCBsaXN0CiAgICAg\nKiB3aGVuIGl0IGlzIGNsb3NlZC4gUHVibGljIGZvciB0ZXN0aW5nLgogICAg\nICovCiAgICBwdWJsaWMgY2xhc3MgUmVtb3ZlT25DbG9zZVJlc3VsdExpc3QK\nICAgICAgICBpbXBsZW1lbnRzIFJlc3VsdExpc3QgewoKICAgICAgICBwcml2\nYXRlIGZpbmFsIFJlc3VsdExpc3QgX3JlczsKCiAgICAgICAgcHVibGljIFJl\nbW92ZU9uQ2xvc2VSZXN1bHRMaXN0KFJlc3VsdExpc3QgcmVzKSB7CiAgICAg\nICAgICAgIF9yZXMgPSByZXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nUmVzdWx0TGlzdCBnZXREZWxlZ2F0ZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9yZXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1By\nb3ZpZGVyT3BlbigpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuaXNQcm92\naWRlck9wZW4oKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGlj\nIE9iamVjdCBnZXRVc2VyT2JqZWN0KCkgewogICAgICAgICAgICByZXR1cm4g\nX3Jlcy5nZXRVc2VyT2JqZWN0KCk7CiAgICAgICAgfQogICAgICAgIAogICAg\nICAgIHB1YmxpYyB2b2lkIHNldFVzZXJPYmplY3QoT2JqZWN0IG9wYXF1ZSkg\newogICAgICAgICAgICBfcmVzLnNldFVzZXJPYmplY3Qob3BhcXVlKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2VkKCkgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5pc0Nsb3NlZCgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgICAgIGNs\nb3NlKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xv\nc2UoYm9vbGVhbiByZW1vdmUpIHsKICAgICAgICAgICAgaWYgKGlzQ2xvc2Vk\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBfcmVz\nLmNsb3NlKCk7CiAgICAgICAgICAgIGlmICghcmVtb3ZlKQogICAgICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgbG9jaygpOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgLy8gZG9uJ3QgdXNlIHN0YW5kYXJk\nIF9yZXN1bHRMaXN0cy5yZW1vdmUgbWV0aG9kIGIvYyByZWxpZXMgb24KICAg\nICAgICAgICAgICAgIC8vIGNvbGxlY3Rpb24gZXF1YWxpdHksIHdoaWNoIHJl\nbGllcyBvbiBlbGVtZW50IGVxdWFsaXR5LCB3aGljaAogICAgICAgICAgICAg\nICAgLy8gbWVhbnMgd2UgZW5kIHVwIHRyYXZlcnNpbmcgZW50aXJlIHJlc3Vs\ndCBsaXN0cyEKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nX3Jlc3VsdExpc3RzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGl0ci5uZXh0KCkgPT0gdGhpcykgewog\nICAgICAgICAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfcmVzLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmlz\nRW1wdHkoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNv\nbnRhaW5zKE9iamVjdCBvKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmNv\nbnRhaW5zKG8pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9y\nIGl0ZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5pdGVyYXRv\ncigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdFtdIHRvQXJy\nYXkoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnRvQXJyYXkoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b0FycmF5KE9iamVj\ndFtdIGEpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMudG9BcnJheShhKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZChPYmplY3Qg\nbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5hZGQobyk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoT2JqZWN0IG8pIHsK\nICAgICAgICAgICAgcmV0dXJuIF9yZXMucmVtb3ZlKG8pOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNBbGwoQ29sbGVjdGlv\nbiBjKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmNvbnRhaW5zQWxsKGMp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKENv\nbGxlY3Rpb24gYykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5hZGRBbGwo\nYyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGRBbGwo\naW50IGlkeCwgQ29sbGVjdGlvbiBjKSB7CiAgICAgICAgICAgIHJldHVybiBf\ncmVzLmFkZEFsbChpZHgsIGMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gcmVtb3ZlQWxsKENvbGxlY3Rpb24gYykgewogICAgICAgICAg\nICByZXR1cm4gX3Jlcy5yZW1vdmVBbGwoYyk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiByZXRhaW5BbGwoQ29sbGVjdGlvbiBjKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcmVzLnJldGFpbkFsbChjKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgICAgICBf\ncmVzLmNsZWFyKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0\nIGdldChpbnQgaWR4KSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmdldChp\nZHgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBzZXQoaW50\nIGlkeCwgT2JqZWN0IG8pIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuc2V0\nKGlkeCwgbyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBhZGQo\naW50IGlkeCwgT2JqZWN0IG8pIHsKICAgICAgICAgICAgX3Jlcy5hZGQoaWR4\nLCBvKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgcmVtb3Zl\nKGludCBpZHgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMucmVtb3ZlKGlk\neCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGluZGV4T2YoT2Jq\nZWN0IG8pIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuaW5kZXhPZihvKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgbGFzdEluZGV4T2YoT2Jq\nZWN0IG8pIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMubGFzdEluZGV4T2Yo\nbyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTGlzdEl0ZXJhdG9yIGxp\nc3RJdGVyYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMubGlzdEl0\nZXJhdG9yKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTGlzdEl0ZXJh\ndG9yIGxpc3RJdGVyYXRvcihpbnQgaWR4KSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcmVzLmxpc3RJdGVyYXRvcihpZHgpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIExpc3Qgc3ViTGlzdChpbnQgc3RhcnQsIGludCBlbmQpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9yZXMuc3ViTGlzdChzdGFydCwgZW5kKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qg\nbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5lcXVhbHMobyk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAg\nICAgICByZXR1cm4gX3Jlcy5oYXNoQ29kZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZyAoKQoJCXsKCQkJcmV0dXJuIF9y\nZXMudG9TdHJpbmcgKCk7CgkJfQoKCQlwdWJsaWMgT2JqZWN0IHdyaXRlUmVw\nbGFjZSAoKQoJCXsKCQkJcmV0dXJuIF9yZXM7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

