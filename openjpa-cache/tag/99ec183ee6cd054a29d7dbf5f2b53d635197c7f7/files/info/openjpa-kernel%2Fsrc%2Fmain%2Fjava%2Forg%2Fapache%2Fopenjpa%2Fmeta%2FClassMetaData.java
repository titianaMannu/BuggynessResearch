{"sha":"77079e8e7d7b966bf37044cf38d780bdccddfbbf","node_id":"MDQ6QmxvYjIwNjM2NDo3NzA3OWU4ZTdkN2I5NjZiZjM3MDQ0Y2YzOGQ3ODBiZGNjZGRmYmJm","size":92159,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/77079e8e7d7b966bf37044cf38d780bdccddfbbf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5J\ndGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51\ndGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0\naWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5T\ndHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9w\nZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmRhdGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZUxpc3RlbmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5tZXRhLlNvdXJjZVRyYWNrZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi54bWwuQ29tbWVudGFibGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CaWdEZWNpbWFsSWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CaWdJbnRlZ2VySWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CeXRlSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFySWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkludElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRh\nRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3Bl\nbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU2hvcnRJ\nZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0cmluZ0lkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CgppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQ29u\ndGFpbnMgbWV0YWRhdGEgYWJvdXQgYSBwZXJzaXN0ZW50IHR5cGUuCiAqIFRo\naXMgbWV0YWRhdGEgaXMgYXZhaWxhYmxlIGJvdGggYXQgZW5oYW5jZW1lbnQg\ndGltZSBhbmQgcnVudGltZS4KICogIE5vdGUgdGhhdCB0aGlzIGNsYXNzIGVt\ncGxveXMgYWdncmVzc2l2ZSBjYWNoaW5nLCBhbmQgdGhlcmVmb3JlIGl0IGlz\nCiAqIGltcG9ydGFudCB0byBmaW5hbGl6ZSB0aGUgY29uZmlndXJhdGlvbiBv\nZiBmaWVsZCBtZXRhZGF0YXMgYmVmb3JlIGludm9raW5nCiAqIG1ldGhvZHMg\ndGhhdCBkZXBlbmQgb24gdGhhdCBjb25maWd1cmF0aW9uLCBzdWNoIGFzCiAq\nIHtAbGluayAjZ2V0UHJpbWFyeUtleUZpZWxkc30uCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVi\nbGljIGNsYXNzIENsYXNzTWV0YURhdGEKICAgIGV4dGVuZHMgRXh0ZW5zaW9u\ncwogICAgaW1wbGVtZW50cyBDb21wYXJhYmxlPENsYXNzTWV0YURhdGE+LCBT\nb3VyY2VUcmFja2VyLCBNZXRhRGF0YUNvbnRleHQsIAogICAgTWV0YURhdGFN\nb2RlcywgQ29tbWVudGFibGUsIFZhbHVlTGlzdGVuZXIgewoKICAgIC8qKgog\nICAgICogVW5rbm93biBpZGVudGl0eSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBJRF9VTktOT1dOID0gMDsKCiAgICAvKioK\nICAgICAqIERhdGFzdG9yZSBpZGVudGl0eSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBJRF9EQVRBU1RPUkUgPSAxOwoKICAg\nIC8qKgogICAgICogQXBwbGljYXRpb24gaWRlbnRpdHkgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSURfQVBQTElDQVRJT04g\nPSAyOwoKICAgIC8qKgogICAgICogVW5rbm93biBhY2Nlc3MgdHlwZS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQUNDRVNTX1VOS05P\nV04gPSBBY2Nlc3NDb2RlLlVOS05PV047CgogICAgLyoqCiAgICAgKiBQZXJz\naXN0ZW50IGF0dHJpYnV0ZXMgYXJlIGFjY2Vzc2VkIHZpYSBkaXJlY3QgZmll\nbGQgYWNjZXNzLiBCaXQgZmxhZy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgQUNDRVNTX0ZJRUxEID0gQWNjZXNzQ29kZS5GSUVMRDsK\nCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBhcmUgYWNj\nZXNzZWQgdmlhIHNldHRlcnMgYW5kIGdldHRlcnMuIEJpdCBmbGFnLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1NfUFJPUEVS\nVFkgPSBBY2Nlc3NDb2RlLlBST1BFUlRZOwoKICAgIC8qKgogICAgICogUGVy\nc2lzdGVudCBjbGFzcyBoYXMgZXhwbGljaXRseSBkZWZpbmVkIGFuIGFjY2Vz\ncyB0eXBlLiAKICAgICAqIFRoaXMgd2lsbCBhbGxvdyB0aGUgYXR0cmlidXRl\ncyB0byB1c2UgbWl4ZWQgYWNjZXNzIGkuZS4gc29tZSBmaWVsZCAKICAgICAq\nIG1heSB1c2UgQUNDRVNTX0ZJRUxEIHdoaWxlIG90aGVycyBBQ0NFU1NfUFJP\nUEVSVFkuIAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBB\nQ0NFU1NfRVhQTElDSVQgPSBBY2Nlc3NDb2RlLkVYUExJQ0lUOwogICAgCiAg\nICAvKioKICAgICAqIFZhbHVlIGZvciB1c2luZyBhIHN5bnRoZXRpYyBkZXRh\nY2hlZCBzdGF0ZSBmaWVsZCwgd2hpY2ggaXMgdGhlIGRlZmF1bHQuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFNZTlRIRVRJQyA9\nICJgc3luIjsKCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIFN0cmluZyBE\nRUZBVUxUX1NUUklORyA9ICJgIjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAg\nICAgKENsYXNzTWV0YURhdGEuY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIEZldGNoR3JvdXBbXSBFTVBUWV9GRVRDSF9HUk9VUF9BUlJBWQog\nICAgICAgID0gbmV3IEZldGNoR3JvdXBbMF07CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmdbXSBFTVBUWV9TVFJJTkdfQVJSQVkgPSBuZXcgU3Ry\naW5nWzBdOwoKICAgIHByaXZhdGUgTWV0YURhdGFSZXBvc2l0b3J5IF9yZXBv\nczsKICAgIHByaXZhdGUgdHJhbnNpZW50IENsYXNzTG9hZGVyIF9sb2FkZXIg\nPSBudWxsOwoKICAgIHByaXZhdGUgZmluYWwgVmFsdWVNZXRhRGF0YSBfb3du\nZXI7CiAgICBwcml2YXRlIGZpbmFsIExpZmVjeWNsZU1ldGFEYXRhIF9saWZl\nTWV0YSA9IG5ldyBMaWZlY3ljbGVNZXRhRGF0YSh0aGlzKTsKICAgIHByaXZh\ndGUgRmlsZSBfc3JjRmlsZSA9IG51bGw7CiAgICBwcml2YXRlIGludCBfc3Jj\nVHlwZSA9IFNSQ19PVEhFUjsKICAgIHByaXZhdGUgaW50IF9saW5lTnVtID0g\nMDsgIAogICAgcHJpdmF0ZSBpbnQgX2NvbE51bSA9IDA7ICAKICAgIHByaXZh\ndGUgU3RyaW5nW10gX2NvbW1lbnRzID0gbnVsbDsKICAgIHByaXZhdGUgaW50\nIF9saXN0SW5kZXggPSAtMTsKICAgIHByaXZhdGUgaW50IF9zcmNNb2RlID0g\nTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HOwogICAgcHJpdmF0ZSBpbnQgX3Jl\nc01vZGUgPSBNT0RFX05PTkU7CgogICAgcHJpdmF0ZSBDbGFzczw/PiBfdHlw\nZSA9IE9iamVjdC5jbGFzczsKICAgIHByaXZhdGUgZmluYWwgTWFwPFN0cmlu\nZyxGaWVsZE1ldGFEYXRhPiBfZmllbGRNYXAgPSBuZXcgVHJlZU1hcDxTdHJp\nbmcsRmllbGRNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPFN0cmluZyxG\naWVsZE1ldGFEYXRhPiBfc3VwRmllbGRNYXAgPSBudWxsOwogICAgcHJpdmF0\nZSBib29sZWFuIF9kZWZTdXBGaWVsZHMgPSBmYWxzZTsKICAgIHByaXZhdGUg\nQ29sbGVjdGlvbjxTdHJpbmc+IF9zdGF0aWNGaWVsZHMgPSBudWxsOwogICAg\ncHJpdmF0ZSBpbnRbXSBfZmllbGREYXRhVGFibGUgPSBudWxsOwogICAgcHJp\ndmF0ZSBNYXA8U3RyaW5nLEZldGNoR3JvdXA+IF9mZ01hcCA9IG51bGw7Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE5vdGU6IGlmIHlv\ndSBhZGQgYWRkaXRpb25hbCBzdGF0ZSwgbWFrZSBzdXJlIHRvIGFkZCBpdCB0\nbyBjb3B5KCkKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHJp\ndmF0ZSBDbGFzczw/PiBfb2JqZWN0SWQgPSBudWxsOwogICAgcHJpdmF0ZSBC\nb29sZWFuIF9vYmplY3RJZFNoYXJlZCA9IG51bGw7CiAgICBwcml2YXRlIEJv\nb2xlYW4gX29wZW5qcGFJZCA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4g\nX2V4dGVudCA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX2VtYmVkZGVk\nID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfZW1iZWRkYWJsZSA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBCb29sZWFuIF9pbnRlcmZhY2UgPSBudWxsOwog\nICAgcHJpdmF0ZSBDbGFzczw/PiBfaW1wbCA9IG51bGw7CiAgICBwcml2YXRl\nIExpc3Q8Q2xhc3M8Pz4+IF9pbnRlcmZhY2VzID0gbnVsbDsKICAgIHByaXZh\ndGUgZmluYWwgTWFwPENsYXNzPD8+LE1hcDxTdHJpbmcsU3RyaW5nPj4gX2lm\nYWNlTWFwID0gCiAgICAJbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sTWFwPFN0cmlu\nZyxTdHJpbmc+PigpOwogICAgcHJpdmF0ZSBpbnQgX2lkZW50aXR5ID0gSURf\nVU5LTk9XTjsKICAgIHByaXZhdGUgaW50IF9pZFN0cmF0ZWd5ID0gVmFsdWVT\ndHJhdGVnaWVzLk5PTkU7CiAgICBwcml2YXRlIGludCBfYWNjZXNzVHlwZSA9\nIEFjY2Vzc0NvZGUuVU5LTk9XTjsKICAgIHByaXZhdGUgYm9vbGVhbiBfcmVw\nbGljYXRlZCA9IGZhbHNlOwogICAgCiAgICBwcml2YXRlIFN0cmluZyBfc2Vx\nTmFtZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBTZXF1ZW5jZU1l\ndGFEYXRhIF9zZXFNZXRhID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9j\nYWNoZU5hbWUgPSBERUZBVUxUX1NUUklORzsgLy8gbnVsbCBpbXBsaWVzIEBE\nYXRhQ2FjaGUoZW5hYmxlZD1mYWxzZSkKICAgIHByaXZhdGUgYm9vbGVhbiBf\nZGF0YUNhY2hlRW5hYmxlZCA9IGZhbHNlOyAgICAgLy8gdHJ1ZSBpbXBsaWVz\nIHRoZSBjbGFzcyBoYXMgYmVlbiBhbm5vdGF0ZWQgYnkgdGhlIHVzZXIgb3Ig\nbmFtZSBvZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyB0aGUgY2FjaGUgaXMgZXhwbGljaXRseSBzZXQgYnkg\ndGhlIHVzZXIgdG8gYSBudWxsIHN0cmluZwoKICAgIHByaXZhdGUgQm9vbGVh\nbiBfY2FjaGVFbmFibGVkID0gbnVsbDsgICAgICAgLy8gZGVub3RlcyBzdGF0\ndXMgb2YgSlBBIDIgQENhY2hlYWJsZSBhbm5vdGF0aW9uCiAgICBwcml2YXRl\nIGludCBfY2FjaGVUaW1lb3V0ID0gSW50ZWdlci5NSU5fVkFMVUU7CiAgICBw\ncml2YXRlIEJvb2xlYW4gX2RldGFjaGFibGUgPSBudWxsOwogICAgcHJpdmF0\nZSBTdHJpbmcgX2RldGFjaFN0YXRlID0gREVGQVVMVF9TVFJJTkc7CiAgICBw\ncml2YXRlIFN0cmluZyBfYWxpYXMgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQg\nX3ZlcnNpb25JZHggPSBJbnRlZ2VyLk1JTl9WQUxVRTsKCiAgICBwcml2YXRl\nIENsYXNzPD8+IF9zdXBlciA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0\nYURhdGEgX3N1cGVyTWV0YSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzPD8+\nW10gX3N1YnMgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhW10g\nX3N1Yk1ldGFzID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YVtd\nIF9tYXBTdWJNZXRhcyA9IG51bGw7CgogICAgcHJpdmF0ZSBGaWVsZE1ldGFE\nYXRhW10gX2ZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZpZWxkTWV0YURh\ndGFbXSBfdW5tZ2RGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1l\ndGFEYXRhW10gX2FsbEZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZpZWxk\nTWV0YURhdGFbXSBfYWxsUEtGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBG\naWVsZE1ldGFEYXRhW10gX2FsbERGR0ZpZWxkcyA9IG51bGw7CiAgICBwcml2\nYXRlIEZpZWxkTWV0YURhdGFbXSBfZGVmaW5lZEZpZWxkcyA9IG51bGw7CiAg\nICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBfbGlzdGluZ0ZpZWxkcyA9IG51\nbGw7CiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBfYWxsTGlzdGluZ0Zp\nZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZldGNoR3JvdXBbXSBfZmdzID0g\nbnVsbDsKICAgIHByaXZhdGUgRmV0Y2hHcm91cFtdIF9jdXN0b21GR3MgPSBu\ndWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9pbnRlcmNlcHRpbmcgPSBmYWxz\nZTsKICAgIHByaXZhdGUgQm9vbGVhbiBfdXNlSWRDbGFzc0Zyb21QYXJlbnQg\nPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9hYnN0cmFjdCA9IGZhbHNl\nOwogICAgcHJpdmF0ZSBCb29sZWFuIF9oYXNBYnN0cmFjdFBLRmllbGQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9oYXNQS0ZpZWxkc0Zyb21BYnN0\ncmFjdENsYXNzID0gbnVsbDsKICAgIAogICAgLyoqCiAgICAgKiBDb25zdHJ1\nY3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCByZXBvc2l0b3J5Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YShDbGFzczw/PiB0\neXBlLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBfcmVw\nb3MgPSByZXBvczsKICAgICAgICBfb3duZXIgPSBudWxsOwogICAgICAgIHNl\ndERlc2NyaWJlZFR5cGUodHlwZSk7CiAgICAgICAgcmVnaXN0ZXJGb3JWYWx1\nZVVwZGF0ZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8qKgog\nICAgICogRW1iZWRkZWQgY29uc3RydWN0b3IuIFN1cHBseSBlbWJlZGRpbmcg\ndmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhKFZh\nbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICBfb3duZXIgPSBvd25lcjsK\nICAgICAgICBfcmVwb3MgPSBvd25lci5nZXRSZXBvc2l0b3J5KCk7CiAgICAg\nICAgc2V0RW52Q2xhc3NMb2FkZXIob3duZXIuZ2V0RmllbGRNZXRhRGF0YSgp\nLmdldERlZmluaW5nTWV0YURhdGEoKS4KICAgICAgICAgICAgZ2V0RW52Q2xh\nc3NMb2FkZXIoKSk7CiAgICAgICAgcmVnaXN0ZXJGb3JWYWx1ZVVwZGF0ZSgi\nRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGlj\nIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCkgewogICAgICAg\nIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGlz\nIG1ldGFkYXRhIGlzIGZvciBhbiBlbWJlZGRlZCBvYmplY3QsIHJldHVybmlu\nZyB0aGUgb3duaW5nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgVmFsdWVN\nZXRhRGF0YSBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpIHsKICAgICAgICByZXR1\ncm4gX293bmVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNpc3Rl\nbmNlIGNhcGFibGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRoaXMgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzczw/PiBnZXREZXNjcmliZWRUeXBl\nKCkgewogICAgICAgIHJldHVybiBfdHlwZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRoaXMgbWV0YWRhdGEu\nIFRoZSB0eXBlIG1heSBiZSByZXNldCB3aGVuCiAgICAgKiBhbiBlbWJlZGRl\nZCB2YWx1ZSBjaGFuZ2VzIGl0cyBkZWNsYXJlZCB0eXBlLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBzZXREZXNjcmliZWRUeXBlKENsYXNzPD8+IHR5\ncGUpIHsKICAgICAgICBpZiAodHlwZS5nZXRTdXBlcmNsYXNzKCkgIT0gbnVs\nbCAmJiAiamF2YS5sYW5nLkVudW0iLmVxdWFscwogICAgICAgICAgICAodHlw\nZS5nZXRTdXBlcmNsYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbnVtIiwgdHlw\nZSkpOwogICAgICAgIF90eXBlID0gdHlwZTsKICAgICAgICBpZiAoUGVyc2lz\ndGVuY2VDYXBhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkpCiAg\nICAgICAgICAgIHNldEludGVyY2VwdGluZyh0cnVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBlbnZpcm9ubWVudGFsIGxvYWRlciB1c2VkIHdoZW4g\nbG9hZGluZyB0aGlzIG1ldGFkYXRhLgogICAgICogVGhlIGNsYXNzIG1ldGFk\nYXRhIHNob3VsZCB1c2UgdGhpcyBsb2FkZXIgd2hlbiBsb2FkaW5nIG1ldGFk\nYXRhIGZvcgogICAgICogaXRzIHN1cGVyY2xhc3MgYW5kIGZpZWxkIHR5cGVz\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0RW52Q2xhc3NM\nb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgY2xhc3MgZW52aXJvbm1lbnRhbCBsb2FkZXIgdXNl\nZCB3aGVuIGxvYWRpbmcgdGhpcyBtZXRhZGF0YS4KICAgICAqIFRoZSBjbGFz\ncyBtZXRhZGF0YSBzaG91bGQgdXNlIHRoaXMgbG9hZGVyIHdoZW4gbG9hZGlu\nZyBtZXRhZGF0YSBmb3IKICAgICAqIGl0cyBzdXBlcmNsYXNzIGFuZCBmaWVs\nZCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RW52Q2xhc3NM\nb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgX2xvYWRlciA9\nIGxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwZXJzaXN0ZW5j\nZSBjYXBhYmxlIHN1cGVyY2xhc3Mgb2YgdGhlIGRlc2NyaWJlZCB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0UENTdXBlcmNsYXNzKCkg\newogICAgICAgIHJldHVybiBfc3VwZXI7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBzdXBlcmNsYXNzIG9mIHRoZSBk\nZXNjcmliZWQgdHlwZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UENT\ndXBlcmNsYXNzKENsYXNzPD8+IHBjKSB7CiAgICAgICAgY2xlYXJBbGxGaWVs\nZENhY2hlKCk7CiAgICAgICAgX3N1cGVyID0gcGM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgbWV0YWRhdGEgZm9yIHRoaXMgY2xhc3MnIHN1cGVyY2xh\nc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkgewogICAgICAgIGlmIChfc3VwZXJNZXRhID09\nIG51bGwgJiYgX3N1cGVyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9v\nd25lciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfc3VwZXJNZXRhID0g\nX3JlcG9zLm5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShfb3duZXIpOwogICAg\nICAgICAgICAgICAgX3N1cGVyTWV0YS5zZXREZXNjcmliZWRUeXBlKF9zdXBl\ncik7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgX3N1cGVy\nTWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YShfc3VwZXIsIF9sb2FkZXIsIHRy\ndWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3N1cGVyTWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSBmb3IgdGhpcyBjbGFz\ncycgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX3N1cGVyTWV0YSA9\nIG1ldGE7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAg\nc2V0UENTdXBlcmNsYXNzKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBjbGFzcyBpcyBtYXBw\nZWQgdG8gdGhlIGRhdGFzdG9yZS4gQnkgZGVmYXVsdCwgb25seQogICAgICog\ncmV0dXJucyBmYWxzZSBpZiBjbGFzcyBpcyBlbWJlZGRlZC1vbmx5LCBidXQg\nc3ViY2xhc3NlcyBtaWdodCBvdmVycmlkZQogICAgICogdG8gYWxsb3cgdW5t\nYXBwZWQgb3RoZXIgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzTWFwcGVkKCkgewogICAgICAgIHJldHVybiBfZW1iZWRkZWQgIT0gQm9v\nbGVhbi5UUlVFOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBj\nbG9zZXN0IG1hcHBlZCBzdXBlcmNsYXNzLgogICAgICovCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNYXBwZWRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsIHx8IHN1cC5p\nc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4gc3VwOwogICAgICAgIHJl\ndHVybiBzdXAuZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUga25vd24gcGVyc2lzdGVu\nY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9mIHRoZSBkZXNjcmliZWQgdHlwZSwK\nICAgICAqIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUgb3IgaWYgdGhpcyBpcyBl\nbWJlZGRlZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIENsYXNzPD8+\nW10gZ2V0UENTdWJjbGFzc2VzKCkgewogICAgICAgIGlmIChfb3duZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ldGFEYXRhUmVwb3NpdG9yeS5F\nTVBUWV9DTEFTU0VTOwoKICAgICAgICBfcmVwb3MucHJvY2Vzc1JlZ2lzdGVy\nZWRDbGFzc2VzKF9sb2FkZXIpOwogICAgICAgIGlmIChfc3VicyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHN1YnMgPSBf\ncmVwb3MuZ2V0UENTdWJjbGFzc2VzKF90eXBlKTsKICAgICAgICAgICAgX3N1\nYnMgPSAoQ2xhc3NbXSkgc3Vicy50b0FycmF5KG5ldyBDbGFzc1tzdWJzLnNp\nemUoKV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3N1YnM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUg\na25vd24gcGVyc2lzdGVuY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9mCiAgICAg\nKiB0aGUgZGVzY3JpYmVkIHR5cGUsIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUg\nb3IgaWYgdGhpcyBpcyBlbWJlZGRlZAogICAgICogbWV0YWRhdGEuCiAgICAg\nKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0UENTdWJjbGFzc01l\ndGFEYXRhcygpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBfcmVwb3MuRU1QVFlfTUVUQVM7CgogICAgICAgIENs\nYXNzPD8+W10gc3VicyA9IGdldFBDU3ViY2xhc3NlcygpOyAvLyBjaGVja3Mg\nZm9yIG5ldwogICAgICAgIGlmIChfc3ViTWV0YXMgPT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAg\nIF9zdWJNZXRhcyA9IF9yZXBvcy5FTVBUWV9NRVRBUzsKICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMg\nPSBfcmVwb3MubmV3Q2xhc3NNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAg\nICAgICAgKHN1YnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nICAgICBtZXRhc1tpXSA9IF9yZXBvcy5nZXRNZXRhRGF0YShzdWJzW2ldLCBf\nbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9zdWJNZXRhcyA9IG1l\ndGFzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nc3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIG1h\ncHBlZCBzdWJjbGFzc2VzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRh\nRGF0YVtdIGdldE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0YXMoKSB7CiAgICAg\nICAgaWYgKF9vd25lciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3Jl\ncG9zLkVNUFRZX01FVEFTOwoKICAgICAgICBDbGFzc01ldGFEYXRhW10gc3Vi\ncyA9IGdldFBDU3ViY2xhc3NNZXRhRGF0YXMoKTsgLy8gY2hlY2tzIGZvciBu\nZXcKICAgICAgICBpZiAoX21hcFN1Yk1ldGFzID09IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICBf\nbWFwU3ViTWV0YXMgPSBzdWJzOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIExpc3Q8Q2xhc3NNZXRhRGF0YT4gbWFwcGVkID0gCiAgICAg\nICAgICAgICAgICAJbmV3IEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPihzdWJz\nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKHN1\nYnNbaV0uaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWFw\ncGVkLmFkZChzdWJzW2ldKTsKICAgICAgICAgICAgICAgIF9tYXBTdWJNZXRh\ncyA9IChDbGFzc01ldGFEYXRhW10pIG1hcHBlZC50b0FycmF5CiAgICAgICAg\nICAgICAgICAgICAgKF9yZXBvcy5uZXdDbGFzc01ldGFEYXRhQXJyYXkobWFw\ncGVkLnNpemUoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBfbWFwU3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgdHlwZSBvZiBpZGVudGl0eSBiZWluZyB1c2VkLiBUaGlzIHdpbGwgYmUg\nb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxpPntAbGluayAjSURfVU5L\nTk9XTn06IHVua25vd24gaWRlbnRpdHkgdHlwZTwvbGk+CiAgICAgKiA8bGk+\ne0BsaW5rICNJRF9EQVRBU1RPUkV9OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRo\nZSBkYXRhIHN0b3JlIGFuZAogICAgICogaW5kZXBlbmRlbnQJb2YgdGhlIGZp\nZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICogPGxpPntAbGluayAj\nSURfQVBQTElDQVRJT059OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBhcHBs\naWNhdGlvbiBhbmQKICAgICAqIGRlZmluZWQgYnkgb25lIG9yIG1vcmUgZmll\nbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8L3VsPiBJZiB1bnNw\nZWNpZmllZCwgZGVmYXVsdHMgdG8ge0BsaW5rICNJRF9EQVRBU1RPUkV9IGlm\nIHRoZXJlIGFyZSBubwogICAgICogcHJpbWFyeSBrZXkgZmllbGRzLCBhbmQg\ne0BsaW5rICNJRF9BUFBMSUNBVElPTn0gb3RoZXJ3aXNlLgogICAgICovCiAg\nICBwdWJsaWMgaW50IGdldElkZW50aXR5VHlwZSgpIHsKICAgICAgICBpZiAo\nX2lkZW50aXR5ID09IElEX1VOS05PV04pIHsKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5VHlw\nZSgpICE9IElEX1VOS05PV04pCiAgICAgICAgICAgICAgICBfaWRlbnRpdHkg\nPSBzdXAuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKGdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGggPiAwKQogICAgICAgICAg\nICAgICAgX2lkZW50aXR5ID0gSURfQVBQTElDQVRJT047CiAgICAgICAgICAg\nIGVsc2UgaWYgKGlzTWFwcGVkKCkpCiAgICAgICAgICAgICAgICBfaWRlbnRp\ndHkgPSBJRF9EQVRBU1RPUkU7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIF9pZGVudGl0eSA9IF9yZXBvcy5nZXRNZXRhRGF0YUZhY3Rvcnko\nKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIGdldERlZmF1\nbHRJZGVudGl0eVR5cGUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9p\nZGVudGl0eTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0eXBlIG9mIGlk\nZW50aXR5IGJlaW5nIHVzZWQuIFRoaXMgd2lsbCBiZSBvbmUgb2Y6CiAgICAg\nKiA8dWw+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9VTktOT1dOfTogdW5rbm93\nbiBpZGVudGl0eSB0eXBlPC9saT4KICAgICAqIDxsaT57QGxpbmsgI0lEX0RB\nVEFTVE9SRX06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGRhdGEgc3RvcmUg\nYW5kCiAgICAgKiBpbmRlcGVuZGVudAlvZiB0aGUgZmllbGRzIG9mIHRoZSBp\nbnN0YW5jZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9BUFBMSUNBVElP\nTn06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGFwcGxpY2F0aW9uIGFuZAog\nICAgICogZGVmaW5lZCBieSBvbmUgb3IgbW9yZSBmaWVsZHMgb2YgdGhlIGlu\nc3RhbmNlPC9saT4KICAgICAqIDwvdWw+IElmIHVuc3BlY2lmaWVkLCBkZWZh\ndWx0cyB0byB7QGxpbmsgI0lEX0RBVEFTVE9SRX0gaWYgdGhlcmUgYXJlIG5v\nCiAgICAgKiBwcmltYXJ5IGtleSBmaWVsZHMsIGFuZCB7QGxpbmsgI0lEX0FQ\nUExJQ0FUSU9OfSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldElkZW50aXR5VHlwZShpbnQgdHlwZSkgewogICAgICAgIF9pZGVudGl0\neSA9IHR5cGU7CiAgICAgICAgaWYgKHR5cGUgIT0gSURfQVBQTElDQVRJT04p\nIHsKICAgICAgICAgICAgX29iamVjdElkID0gbnVsbDsKICAgICAgICAgICAg\nX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIG1ldGFkYXRhLXNwZWNpZmllZCBjbGFzcyB0byB1c2UgZm9y\nIHRoZSBvYmplY3QgSUQuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzczw/PiBn\nZXRPYmplY3RJZFR5cGUoKSB7CiAgICAgICAgLy8gaWYgdGhpcyBlbnRpdHkg\nZG9lcyBub3QgdXNlIElkQ2xhc3MgZnJvbSB0aGUgcGFyZW50IGVudGl0eSwK\nICAgICAgICAvLyBqdXN0IHJldHVybiB0aGUgX29iamVjdElkIHNldCBkdXJp\nbmcgYW5ub3RhdGlvbiBwYXJzaW5nIHRpbWUuCiAgICAgICAgaWYgKCF1c2VJ\nZENsYXNzRnJvbVBhcmVudCgpKSB7CiAgICAgICAgICAgIGlmIChfb2JqZWN0\nSWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0SWQ7\nCiAgICAgICAgfSAKICAgICAgICAKICAgICAgICAvLyBpZiB0aGlzIGVudGl0\neSB1c2VzIElkQ2xhc3MgZnJvbSB0aGUgcGFyZW50IGVudGl0eSwKICAgICAg\nICAvLyB0aGUgX29iamVjdElkIHNldCBkdXJpbmcgdGhlIHBhcnNpbmcgdGlt\nZSBzaG91bGQgYmUKICAgICAgICAvLyBpZ25vcmVkLCBhbmQgbGV0IHRoZSBz\neXN0ZW0gZGV0ZXJtaW5lIHRoZSBvYmplY3RJZCB0eXBlCiAgICAgICAgLy8g\nb2YgdGhpcyBlbnRpdHkuCiAgICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgp\nICE9IElEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRJ\nZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOKSB7CiAgICAgICAgICAgIF9v\nYmplY3RJZCA9IHN1cC5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAg\ncmV0dXJuIF9vYmplY3RJZDsKICAgICAgICB9CgogICAgICAgIC8vIGZpZ3Vy\nZSBvdXQgT3BlbkpQQSBpZGVudGl0eSB0eXBlIGJhc2VkIG9uIHByaW1hcnkg\na2V5IGZpZWxkCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IGdldFBy\naW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAocGtzLmxlbmd0aCAhPSAx\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBzd2l0Y2ggKHBr\nc1swXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEJ5\ndGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IENo\nYXJJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQg\nPSBEb3VibGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgX29iamVj\ndElkID0gRmxvYXRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0\nSWQgPSBJbnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJ\nZCA9IExvbmdJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgX29iamVj\ndElkID0gU2hvcnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAg\nICAgICBfb2JqZWN0SWQgPSBTdHJpbmdJZC5jbGFzczsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgog\nICAgICAgICAgICAgICAgX29iamVjdElkID0gRGF0ZUlkLmNsYXNzOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk9JRDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAg\nICAgICAgICAgICAgX29iamVjdElkID0gT2JqZWN0SWQuY2xhc3M7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQklHREVDSU1BTDoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEJpZ0Rl\nY2ltYWxJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAgICAg\nICAgX29iamVjdElkID0gQmlnSW50ZWdlcklkLmNsYXNzOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb2JqZWN0\nSWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEtc3BlY2lm\naWVkIGNsYXNzIHRvIHVzZSBmb3IgdGhlIG9iamVjdCBJRC4KICAgICAqIFdo\nZW4gdGhlcmUgaXMgSWRDbGFzcyBhbm5vdGF0aW9uLCBBbm5vdGF0aW9uTWV0\nYURhdGFQYXJzZXIKICAgICAqIHdpbGwgY2FsbCB0aGlzIG1ldGhvZCB0byBz\nZXQgT2JqZWN0SWQgdHlwZS4gSG93ZXZlciwgaWYgCiAgICAgKiB0aGlzIGlz\nIGEgZGVyaXZlZCBpZGVudGl0eSBpbiB0aGUgY2hpbGQgZW50aXR5IHdoZXJl\nIGEgCiAgICAgKiByZWxhdGlvbiBmaWVsZCAocGFyZW50IGVudGl0eSkgaXMg\ndXNlZCBhcyBhbiBpZCwgYW5kIHRoaXMgCiAgICAgKiByZWxhdGlvbiBmaWVs\nZCBoYXMgYW4gSWRDbGFzcywgdGhlIElkQ2xhc3MgYW5ub3RhdGlvbiBpbiAK\nICAgICAqIHRoZSBjaGlsZCBlbnRpdHkgY2FuIGJlIGlnbm9yZWQgYXMgT3Bl\nbmpwYSB3aWxsIGF1dG9tYXRpY2FsbHkgICAKICAgICAqIHdyYXAgcGFyZW50\nJ3MgSWRDbGFzcyBhcyBjaGlsZCdzIElkQ2xhc3MuIAogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRPYmplY3RJZFR5cGUoQ2xhc3M8Pz4gY2xzLCBib29s\nZWFuIHNoYXJlZCkgewogICAgICAgIF9vYmplY3RJZCA9IG51bGw7CiAgICAg\nICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgX29iamVjdElkU2hhcmVk\nID0gbnVsbDsKICAgICAgICBpZiAoY2xzICE9IG51bGwpIHsKICAgICAgICAg\nICAgLy8gZG9uJ3QgbGV0IHBlb3BsZSBhc3NpZ24gT3BlbkpQQUlkIHR5cGVz\nOyBzYWZlciB0byBjYWxjdWxhdGUgaXQKICAgICAgICAgICAgLy8gb3Vyc2Vs\ndmVzCiAgICAgICAgICAgIHNldElkZW50aXR5VHlwZShJRF9BUFBMSUNBVElP\nTik7CiAgICAgICAgICAgIGlmICghT3BlbkpQQUlkLmNsYXNzLmlzQXNzaWdu\nYWJsZUZyb20oY2xzKSkgewogICAgICAgICAgICAgICAgX29iamVjdElkID0g\nY2xzOwogICAgICAgICAgICAgICAgX29iamVjdElkU2hhcmVkID0gKHNoYXJl\nZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0\naGlzIHR5cGUgdXNlcyBhbiBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzcyB0\naGF0IGlzIHNoYXJlZAogICAgICogd2l0aCBvdGhlciBjbGFzc2VzLCBhbmQg\naXMgdGhlcmVmb3JlIHdyYXBwZWQgaW4gYW4ge0BsaW5rIE9iamVjdElkfS4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNPYmplY3RJZFR5cGVTaGFy\nZWQoKSB7CiAgICAgICAgaWYgKF9vYmplY3RJZFNoYXJlZCAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gX29iamVjdElkU2hhcmVkLmJvb2xlYW5WYWx1\nZSgpOwogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuaXNPYmplY3RJZFR5\ncGVTaGFyZWQoKTsKICAgICAgICByZXR1cm4gaXNPcGVuSlBBSWRlbnRpdHko\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyB0eXBlIHVz\nZXMgT3BlbkpQQSBpZGVudGl0eS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNPcGVuSlBBSWRlbnRpdHkoKSB7CiAgICAgICAgaWYgKF9vcGVuanBh\nSWQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzczw/PiBjbHMgPSBnZXRP\nYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAgaWYgKGNscyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBfb3Bl\nbmpwYUlkID0gKE9wZW5KUEFJZC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNs\ncykpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb3BlbmpwYUlkLmJv\nb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmF0\nZWd5IHRvIHVzZSBmb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdlbmVyYXRpb24u\nCiAgICAgKiBPbmUgb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtAbGluayBWYWx1\nZVN0cmF0ZWdpZXN9LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldElkZW50\naXR5U3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgp\nID09IElEX0RBVEFTVE9SRQogICAgICAgICAgICAmJiBfaWRTdHJhdGVneSA9\nPSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkgewogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBl\nKCkgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIF9pZFN0cmF0ZWd5\nID0gc3VwLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kgPSBWYWx1ZVN0cmF0ZWdp\nZXMuTkFUSVZFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2lkU3RyYXRl\nZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdG8gdXNl\nIGZvciBkYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJhdGlvbi4KICAgICAqIE9u\nZSBvZiB0aGUgY29uc3RhbnRzIGZyb20ge0BsaW5rIFZhbHVlU3RyYXRlZ2ll\nc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElkZW50aXR5U3RyYXRl\nZ3koaW50IHN0cmF0ZWd5KSB7CiAgICAgICAgX2lkU3RyYXRlZ3kgPSBzdHJh\ndGVneTsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gVmFsdWVTdHJhdGVnaWVz\nLlNFUVVFTkNFKQogICAgICAgICAgICBzZXRJZGVudGl0eVNlcXVlbmNlTmFt\nZShudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkYXRhc3RvcmUg\naWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBmb3Igbm9uZS4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJZGVudGl0eVNlcXVlbmNlTmFt\nZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9zZXFO\nYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfc2VxTmFtZSA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCkuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgX3NlcU5hbWUgPSBudWxsOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX3NlcU5hbWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNlIG5hbWUsIG9yIG51\nbGwgZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElkZW50\naXR5U2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1lKSB7CiAgICAgICAgX3Nl\ncU5hbWUgPSBzZXFOYW1lOwogICAgICAgIF9zZXFNZXRhID0gbnVsbDsKICAg\nICAgICBpZiAoc2VxTmFtZSAhPSBudWxsKQogICAgICAgICAgICBzZXRJZGVu\ndGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBmb3IgdGhlIGRhdGFzdG9yZSBp\nZGVudGl0eSBzZXF1ZW5jZS4KICAgICAqLwogICAgcHVibGljIFNlcXVlbmNl\nTWV0YURhdGEgZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRhKCkgewogICAg\nICAgIGlmIChfc2VxTWV0YSA9PSBudWxsICYmIGdldElkZW50aXR5U2VxdWVu\nY2VOYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAgX3NlcU1ldGEgPSBfcmVw\nb3MuZ2V0U2VxdWVuY2VNZXRhRGF0YSh0aGlzLAogICAgICAgICAgICAgICAg\nZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSwgdHJ1ZSk7CiAgICAgICAgcmV0\ndXJuIF9zZXFNZXRhOwogICAgfQoKICAgIC8qKgogICAgICogSW5mb3JtYXRp\nb24gYWJvdXQgbGlmZWN5Y2xlIGNhbGxiYWNrcyBmb3IgdGhpcyBjbGFzcy4K\nICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZU1ldGFEYXRhIGdldExpZmVj\neWNsZU1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbGlmZU1ldGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBhbGlhcyBmb3IgdGhl\nIGRlc2NyaWJlZCB0eXBlLCBvciA8Y29kZT5udWxsPC9jb2RlPiBpZiBub25l\nCiAgICAgKiBoYXMgYmVlbiBzZXQuCiAgICAgKiAKICAgICAqIEBzZWUgI3Nl\ndFR5cGVBbGlhcwogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5cGVB\nbGlhcygpIHsKICAgICAgICBpZiAoX2FsaWFzID09IG51bGwpCiAgICAgICAg\nICAgIF9hbGlhcyA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKF90eXBlKTsKICAg\nICAgICByZXR1cm4gX2FsaWFzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\ncyB0aGUgYWxpYXMgZm9yIHRoZSBkZXNjcmliZWQgdHlwZS4gVGhlIGFsaWFz\nIGNhbiBiZQogICAgICogYW55IGFyYml0cmFyeSBzdHJpbmcgdGhhdCB0aGUg\naW1wbGVtZW50YXRpb24gY2FuIGxhdGVyIHVzZSB0bwogICAgICogcmVmZXIg\ndG8gdGhlIGNsYXNzLiBOb3RlIHRoYXQgYXQgcnVudGltZSwgb25seSB0aGUg\nYWxpYXMKICAgICAqIGNvbXB1dGVkIHdoZW4gdGhlIHBlcnNpc3RlbnQgdHlw\nZSB3YXMgZW5oYW5jZWQgaXMgdXNlZC4KICAgICAqCiAgICAgKiBAcGFyYW0g\nYWxpYXMgdGhlIGFsaWFzIG5hbWUgdG8gYXBwbHkgdG8gdGhlIGRlc2NyaWJl\nZCB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFR5cGVBbGlhcyhT\ndHJpbmcgYWxpYXMpIHsKICAgICAgICBfYWxpYXMgPSBhbGlhczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2VkIGJ5IHRoaXMg\nY2xhc3MuIAogICAgICogCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0QWNj\nZXNzVHlwZSgpIHsKICAgICAgICByZXR1cm4gX2FjY2Vzc1R5cGU7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogU2V0cyB0aGUgYWNjZXNzIHR5cGUuIAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBY2Nlc3NUeXBlKGludCB0eXBl\nKSB7CiAgICAJaWYgKHR5cGUgPT0gX2FjY2Vzc1R5cGUgfHwgdHlwZSA9PSBB\nY2Nlc3NDb2RlLlVOS05PV04pCiAgICAJCXJldHVybjsKICAgIAlpZiAoIUFj\nY2Vzc0NvZGUuaXNWYWxpZENsYXNzQ29kZSh0eXBlKSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0\nKCJhY2Nlc3MtdHlwZS1pbnZhbGlkIiwgCiAgICAJCSAgICB0aGlzLCBBY2Nl\nc3NDb2RlLnRvQ2xhc3NTdHJpbmcodHlwZSkpLmdldE1lc3NhZ2UoKSk7CiAg\nICAJfQogICAgCWlmIChfYWNjZXNzVHlwZSAhPSBBY2Nlc3NDb2RlLlVOS05P\nV04pIHsgLy8gY2hhbmdpbmcgYWNjZXNzIHR5cGUKICAgIAkgICAgX3JlcG9z\nLmdldExvZygpLnRyYWNlKF9sb2MuZ2V0KCJhY2Nlc3MtdHlwZS1jaGFuZ2Ui\nLCAKICAgIAkJICAgIHRoaXMsIEFjY2Vzc0NvZGUudG9DbGFzc1N0cmluZyh0\neXBlKSwgCiAgICAJCSAgICBBY2Nlc3NDb2RlLnRvQ2xhc3NTdHJpbmcoX2Fj\nY2Vzc1R5cGUpKS5nZXRNZXNzYWdlKCkpOwogICAgCX0KICAgICAgICBfYWNj\nZXNzVHlwZSA9IHR5cGU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQXNz\nZXJ0cyB0aGUgdGhlIGdpdmVuIGZpZWxkICh3aGljaCBtdXN0IGJlbG9uZyB0\nbyB0aGlzIHJlY2VpdmVyKQogICAgICogY2FuIGJlIHNldCB0byB0aGUgZ2l2\nZW4gYWNjZXNzIGNvZGUuIElmIHRoZSBmaWVsZCBjb2RlIGlzIGFsbG93ZWQs\nCiAgICAgKiBpdCBtYXkgaGF2ZSB0aGUgc2lkZS1lZmZlY3Qgb2YgY2hhbmdp\nbmcgdGhlIGFjY2VzcyBjb2RlIG9mIHRoaXMgcmVjZWl2ZXIuCiAgICAgKi8K\nICAgIHZvaWQgbWVyZ2VGaWVsZEFjY2VzcyhGaWVsZE1ldGFEYXRhIGZtZCwg\naW50IGZDb2RlKSB7CiAgICAJc2V0QWNjZXNzVHlwZShBY2Nlc3NDb2RlLm1l\ncmdlRmllbGRDb2RlKHRoaXMsIGZtZCwgZkNvZGUpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFmZmlybXMgaWYgYWNjZXNzIHN0eWxlIGlzIGV4cGxpY2l0\nbHkgZGVmaW5lZC4KICAgICAqLyAgICAKICAgIHB1YmxpYyBib29sZWFuIGlz\nRXhwbGljaXRBY2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuIEFjY2Vzc0NvZGUu\naXNFeHBsaWNpdChfYWNjZXNzVHlwZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZmZpcm1zIGlmIGF0dHJpYnV0ZXMgb2YgdGhpcyBjbGFzcyB1c2UgbWl4\nZWQgYWNjZXNzIHR5cGVzLgogICAgICovICAgIAogICAgcHVibGljIGJvb2xl\nYW4gaXNNaXhlZEFjY2VzcygpIHsKICAgIAlyZXR1cm4gQWNjZXNzQ29kZS5p\nc01peGVkKF9hY2Nlc3NUeXBlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRoZSB0eXBlIHJlcXVpcmVzIGV4dGVudCBtYW5hZ2VtZW50\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXF1aXJlc0V4dGVu\ndCgpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51bGwgfHwgaXNFbWJlZGRl\nZE9ubHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBp\nZiAoX2V4dGVudCA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAg\nICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICAgICAgX2V4dGVudCA9\nIChzdXAuZ2V0UmVxdWlyZXNFeHRlbnQoKSkgPyBCb29sZWFuLlRSVUUKICAg\nICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIF9leHRlbnQgPSBCb29sZWFuLlRSVUU7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfZXh0ZW50LmJvb2xlYW5WYWx1\nZSgpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSBy\nZXF1aXJlcyBleHRlbnQgbWFuYWdlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0UmVxdWlyZXNFeHRlbnQoYm9vbGVhbiByZXEpIHsKICAgICAg\nICBfZXh0ZW50ID0gKHJlcSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZB\nTFNFOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSBj\nYW4gb25seSBiZSB1c2VkIGFzIGFuIGVtYmVkZGVkIG9iamVjdC4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNFbWJlZGRlZE9ubHkoKSB7CiAgICAg\nICAgaWYgKF9lbWJlZGRlZCA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNz\nTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICAgICAgX2Vt\nYmVkZGVkID0gKHN1cC5pc0VtYmVkZGVkT25seSgpKSA/IEJvb2xlYW4uVFJV\nRQogICAgICAgICAgICAgICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2VtYmVkZGVkID0gQm9vbGVh\nbi5GQUxTRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9lbWJlZGRlZC5i\nb29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhlIHR5cGUgY2FuIG9ubHkgYmUgdXNlZCBhcyBhbiBlbWJlZGRlZCBvYmpl\nY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVtYmVkZGVkT25seShi\nb29sZWFuIGVtYmVkKSB7CiAgICAgICAgX2VtYmVkZGVkID0gKGVtYmVkKSA/\nIEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkYWJsZSgpIHsKICAgICAgICByZXR1\ncm4gX2VtYmVkZGFibGU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHNl\ndEVtYmVkZGFibGUoKSB7CiAgICAgICAgX2VtYmVkZGFibGUgPSB0cnVlOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSdzIGZpZWxk\ncyBhcmUgYWN0aXZlbHkgaW50ZXJjZXB0ZWQsIGVpdGhlciBieQogICAgICog\ncmVkZWZpbml0aW9uIG9yIGVuaGFuY2VtZW50LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0ludGVyY2VwdGluZygpIHsKICAgICAgICByZXR1cm4g\nX2ludGVyY2VwdGluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhlIHR5cGUncyBmaWVsZHMgYXJlIGFjdGl2ZWx5IGludGVyY2VwdGVkLCBl\naXRoZXIgYnkKICAgICAqIHJlZGVmaW5pdGlvbiBvciBlbmhhbmNlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50ZXJjZXB0aW5nKGJvb2xl\nYW4gaW50ZXJjZXB0aW5nKSB7CiAgICAgICAgX2ludGVyY2VwdGluZyA9IGlu\ndGVyY2VwdGluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhl\nIHR5cGUgaXMgYSBtYW5hZ2VkIGludGVyZmFjZS4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gaXNNYW5hZ2VkSW50ZXJmYWNlKCkgewogICAgICAgIGlm\nICghX3R5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIHJldHVybiBfaW50ZXJmYWNlID09IG51bGwgPyBmYWxz\nZSA6IF9pbnRlcmZhY2UuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIGlzIGEgbWFuYWdlZCBpbnRlcmZh\nY2UKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWFuYWdlZEludGVyZmFj\nZShib29sZWFuIG1hbmFnZWRJbnRlcmZhY2UpIHsKICAgICAgICBpZiAoIV90\neXBlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWludGVyZmFjZSIsIF90eXBl\nKSk7CiAgICAgICAgX2ludGVyZmFjZSA9IG1hbmFnZWRJbnRlcmZhY2UgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBtYW5h\nZ2VkIGludGVyZmFjZXMgYWx3YXlzIGRvIHByb3BlciBpbnRlcmNlcHRpb247\nIE9wZW5KUEEgZ2VuZXJhdGVzCiAgICAgICAgLy8gdGhlIGltcGxlbWVudGF0\naW9ucy4KICAgICAgICBpZiAoaXNNYW5hZ2VkSW50ZXJmYWNlKCkpCiAgICAg\nICAgICAgIHNldEludGVyY2VwdGluZyh0cnVlKTsKCiAgICAgICAgLy8gbWFu\nYWdlZCBpbnRlcmZhY2VzIGFsd2F5cyB1c2UgcHJvcGVydHkgYWNjZXNzLgog\nICAgICAgIHNldEFjY2Vzc1R5cGUoQWNjZXNzQ29kZS5QUk9QRVJUWSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1hbmFnZWQgaW50ZXJm\nYWNlIGltcGxlbWVudG9yIGlmIGFueS4KICAgICAqLwogICAgcHVibGljIENs\nYXNzPD8+IGdldEludGVyZmFjZUltcGwoKSB7CiAgICAgICAgcmV0dXJuIF9p\nbXBsOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtYW5hZ2VkIGlu\ndGVyZmFjZSBpbXBsZW1lbnRvciBjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0SW50ZXJmYWNlSW1wbChDbGFzczw/PiBpbXBsKSB7CiAgICAg\nICAgX2ltcGwgPSBpbXBsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGFsbCBleHBsaWNpdGx5IGRlY2xhcmVkIGludGVyZmFjZXMgdGhpcyBjbGFz\ncyBpbXBsZW1lbnRzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3M8Pz5bXSBn\nZXREZWNsYXJlZEludGVyZmFjZXMoKSB7CiAgICAgICAgaWYgKF9pbnRlcmZh\nY2VzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNZXRhRGF0YVJlcG9z\naXRvcnkuRU1QVFlfQ0xBU1NFUzsKICAgICAgICByZXR1cm4gKENsYXNzW10p\nIF9pbnRlcmZhY2VzLnRvQXJyYXkobmV3IENsYXNzW19pbnRlcmZhY2VzLnNp\nemUoKV0pOwogICAgfQoKICAgIC8qKgogICAgICogRXhwbGljaXRseSBkZWNs\nYXJlIHRoZSBnaXZlbiBpbnRlcmZhY2UgYW1vbmcgdGhlIG9uZXMgdGhpcwog\nICAgICogY2xhc3MgaW1wbGVtZW50cy4KICAgICAqLwogICAgcHVibGljIHZv\naWQgYWRkRGVjbGFyZWRJbnRlcmZhY2UoQ2xhc3M8Pz4gaWZhY2UpIHsKICAg\nICAgICBpZiAoaWZhY2UgPT0gbnVsbCB8fCAhaWZhY2UuaXNJbnRlcmZhY2Uo\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJkZWNsYXJlLW5vbi1pbnRlcmZhY2UiLAogICAgICAgICAgICAg\nICAgdGhpcywgaWZhY2UpKTsKICAgICAgICBpZiAoX2ludGVyZmFjZXMgPT0g\nbnVsbCkKICAgICAgICAgICAgX2ludGVyZmFjZXMgPSBuZXcgQXJyYXlMaXN0\nPENsYXNzPD8+PigpOwogICAgICAgIF9pbnRlcmZhY2VzLmFkZChpZmFjZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIGludGVy\nZmFjZSBmcm9tIHRoZSBkZWNsYXJlZCBsaXN0LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVEZWNsYXJlZEludGVyZmFjZShDbGFzczw/PiBp\nZmFjZSkgewogICAgICAgIGlmIChfaW50ZXJmYWNlcyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9pbnRlcmZh\nY2VzLnJlbW92ZShpZmFjZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGlh\ncyBwcm9wZXJ0aWVzIGZyb20gdGhlIGdpdmVuIGludGVyZmFjZSBkdXJpbmcg\nIHF1ZXJpZXMgdG8KICAgICAqIHRoZSBsb2NhbCBmaWVsZC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0SW50ZXJmYWNlUHJvcGVydHlBbGlhcyhDbGFz\nczw/PiBpZmFjZSwgU3RyaW5nIG9yaWcsIAogICAgICAgIFN0cmluZyBsb2Nh\nbCkgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAgICAg\nICAgICAgIE1hcDxTdHJpbmcsU3RyaW5nPiBmaWVsZHMgPSBfaWZhY2VNYXAu\nZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBmaWVsZHMgPSBuZXcgSGFzaE1hcDxTdHJpbmcs\nU3RyaW5nPigpOwogICAgICAgICAgICAgICAgX2lmYWNlTWFwLnB1dChpZmFj\nZSwgZmllbGRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmll\nbGRzLmNvbnRhaW5zS2V5KG9yaWcpKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXBsaWNhdGUtaWZh\nY2UtYWxpYXMiLCAKICAgICAgICAgICAgICAgICAgICB0aGlzLCBvcmlnLCBs\nb2NhbCkpOwogICAgICAgICAgICBmaWVsZHMucHV0KG9yaWcsIGxvY2FsKTsK\nICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0IGxvY2Fs\nIGZpZWxkIGFsaWFzIGZvciB0aGUgZ2l2ZW4gaW50ZXJmYWNlIHByb3BlcnR5\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEludGVyZmFjZVByb3Bl\ncnR5QWxpYXMoQ2xhc3M8Pz4gaWZhY2UsIFN0cmluZyBvcmlnKSB7CiAgICAg\nICAgc3luY2hyb25pemVkIChfaWZhY2VNYXApIHsKICAgICAgICAgICAgTWFw\nPFN0cmluZyxTdHJpbmc+IGZpZWxkcyA9IF9pZmFjZU1hcC5nZXQoaWZhY2Up\nOwogICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5n\nZXQob3JpZyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFJldHVybiBhbGwgYWxpYXNlcyBwcm9wZXJ0eSBuYW1lZCBmb3IgdGhlIGdp\ndmVuIGludGVyZmFjZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdl\ndEludGVyZmFjZUFsaWFzZWRQcm9wZXJ0aWVzKENsYXNzPD8+IGlmYWNlKSB7\nCiAgICAgICAgc3luY2hyb25pemVkIChfaWZhY2VNYXApIHsKICAgICAgICAg\nICAgTWFwPFN0cmluZyxTdHJpbmc+IGZpZWxkcyA9IF9pZmFjZU1hcC5nZXQo\naWZhY2UpOwogICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gRU1QVFlfU1RSSU5HX0FSUkFZOwogICAgICAg\nICAgICByZXR1cm4gZmllbGRzLmtleVNldCgpLnRvQXJyYXkobmV3IFN0cmlu\nZ1tmaWVsZHMuc2l6ZSgpXSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIGZpZWxkcyB0aGF0IHVz\nZSBpbXBsIG9yIGludGVybWVkaWF0ZSBkYXRhLCBpbgogICAgICogb3JkZXIg\ndG8gY3JlYXRlIGEgY29tcGFjdGVkIGFycmF5IGZvciBzdG9yYWdlIG9mIHNh\naWQgZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRFeHRyYUZpZWxk\nRGF0YUxlbmd0aCgpIHsKICAgICAgICBpbnRbXSB0YWJsZSA9IGdldEV4dHJh\nRmllbGREYXRhVGFibGUoKTsKICAgICAgICBmb3IgKGludCBpID0gdGFibGUu\nbGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pCiAgICAgICAgICAgIGlmICh0YWJs\nZVtpXSAhPSAtMSkKICAgICAgICAgICAgICAgIHJldHVybiB0YWJsZVtpXSAr\nIDE7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGludGVybWVkaWF0ZSBmaWVsZCBkYXRhIGluZGV4IG9mIHRo\nZSBnaXZlbiBmaWVsZAogICAgICogaW4gdGhlIGNvbXBhY3RlZCBhcnJheSwg\nb3IgLTEgaWYgdGhlIGZpZWxkIGRvZXMgbm90IHVzZSBleHRyYSBkYXRhLgog\nICAgICoKICAgICAqIEBzZWUgI2dldEV4dHJhRmllbGREYXRhTGVuZ3RoCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RXh0cmFGaWVsZERhdGFJbmRleChp\nbnQgZmllbGQpIHsKICAgICAgICBpbnRbXSBhcnJheSA9IGdldEV4dHJhRmll\nbGREYXRhVGFibGUoKTsKICAgICAgICBpZiAoZmllbGQgPCAwIHx8IGZpZWxk\nID49IGFycmF5Lmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAg\nICAgIHJldHVybiBhcnJheVtmaWVsZF07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGVzIGEgdGFibGUgbWFwcGluZyBlYWNoIGZpZWxkIGluZGV4IHRv\nIGl0cyBleHRyYSBkYXRhIGluZGV4LgogICAgICovCiAgICBwcml2YXRlIGlu\ndFtdIGdldEV4dHJhRmllbGREYXRhVGFibGUoKSB7CiAgICAgICAgaWYgKF9m\naWVsZERhdGFUYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGludFtd\nIHRhYmxlID0gbmV3IGludFtmbWRzLmxlbmd0aF07CiAgICAgICAgICAgIGlu\ndCBpZHggPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ld\nLnVzZXNJbnRlcm1lZGlhdGUoKQogICAgICAgICAgICAgICAgICAgIHx8IGZt\nZHNbaV0udXNlc0ltcGxEYXRhKCkgIT0gQm9vbGVhbi5GQUxTRSkKICAgICAg\nICAgICAgICAgICAgICB0YWJsZVtpXSA9IGlkeCsrOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRhYmxlW2ldID0gLTE7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0gdGFi\nbGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZmllbGREYXRhVGFibGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2\nZW4gbmFtZSByZXByZXNlbnRzIGEgbWFuYWdlZCBvciBzdGF0aWMgZmllbGQg\nb2YKICAgICAqIHRoaXMgY2xhc3MsIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZp\nZWxkcy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNBY2Nlc3NpYmxl\nRmllbGQoU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGdldERlY2xhcmVk\nRmllbGQoZmllbGQpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIGlmIChfc3RhdGljRmllbGRzID09IG51bGwpIHsKICAgICAg\nICAgICAgRmllbGRbXSBmaWVsZHMgPSAoRmllbGRbXSkgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhl\nbHBlci5nZXREZWNsYXJlZEZpZWxkc0FjdGlvbihfdHlwZSkpOyAKICAgICAg\nICAgICAgU2V0PFN0cmluZz4gbmFtZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzU3Rh\ndGljKGZpZWxkc1tpXS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAg\nICAgICAgbmFtZXMuYWRkKGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAg\nICAgICBfc3RhdGljRmllbGRzID0gbmFtZXM7CiAgICAgICAgfQogICAgICAg\nIGlmIChfc3RhdGljRmllbGRzLmNvbnRhaW5zKGZpZWxkKSkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5p\nc0FjY2Vzc2libGVGaWVsZChmaWVsZCk7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmaWVsZCBtZXRh\nZGF0YSwgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLgogICAgICovCiAg\nICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldEZpZWxkcygpIHsKICAgICAg\nICBpZiAoX2FsbEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChf\nc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hbGxGaWVsZHMgPSBn\nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1\ncEZpZWxkcyA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAg\nICAgICAgICAgICAgZ2V0RmllbGRzKCk7CgogICAgICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGFsbEZpZWxkcyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFE\nYXRhQXJyYXkKICAgICAgICAgICAgICAgICAgICAoZmllbGRzLmxlbmd0aCAr\nIHN1cEZpZWxkcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFy\ncmF5Y29weShzdXBGaWVsZHMsIDAsIGFsbEZpZWxkcywgMCwgc3VwRmllbGRz\nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICByZXBsYWNlRGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZHMoYWxsRmllbGRzLCBzdXBGaWVsZHMubGVuZ3RoKTsKCiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5zZXRJ\nbmRleChzdXBGaWVsZHMubGVuZ3RoICsgaSk7CiAgICAgICAgICAgICAgICAg\nICAgYWxsRmllbGRzW3N1cEZpZWxkcy5sZW5ndGggKyBpXSA9IGZpZWxkc1tp\nXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9hbGxGaWVs\nZHMgPSBhbGxGaWVsZHM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9hbGxGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXBsYWNlIHN1cGVyY2xhc3MgZmllbGRzIHRoYXQgd2UgZGVmaW5lIHdpdGgg\nb3VyIHZlcnNpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXBsYWNl\nRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoRmllbGRNZXRhRGF0YVtdIGZpZWxk\ncywKICAgICAgICBpbnQgbGVuKSB7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1h\ncCA9PSBudWxsIHx8ICFfZGVmU3VwRmllbGRzKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGRvbid0IGFzc3VtZSBmaWVsZHMgYXJlIGluIG9y\nZGVyOyB0aGlzIG1ldGhvZCBpcyB1c2VkIGZvcgogICAgICAgIC8vIGxpc3Rp\nbmcgb3JkZXIgYXMgd2VsbAogICAgICAgIEZpZWxkTWV0YURhdGEgc3VwRmll\nbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgewog\nICAgICAgICAgICBzdXBGaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBfc3VwRmll\nbGRNYXAuZ2V0KGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBp\nZiAoc3VwRmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmllbGRz\nW2ldID0gc3VwRmllbGQ7CiAgICAgICAgICAgICAgICBzdXBGaWVsZC5zZXRJ\nbmRleChpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgc3VwZXJjbGFzcyBjb3B5IG9mIHRoZSBn\naXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURh\ndGEgZ2V0U3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURhdGEgc3VwRmllbGQp\nIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHNtID0gZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHNtID09\nIG51bGwgPyBudWxsIDogc20uZ2V0RmllbGQoc3VwRmllbGQuZ2V0TmFtZSgp\nKTsKICAgICAgICBpZiAoZm1kID09IG51bGwgCiAgICAgICAgfHwgZm1kLmdl\ndE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNU\nRU5UKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoInVubWFuYWdlZC1zdXAtZmllbGQiLAogICAgICAgICAgICAg\nICAgc3VwRmllbGQsIHRoaXMpKTsKICAgICAgICByZXR1cm4gZm1kOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIG9ubHkgdGhlIGZpZWxkcyBmb3Ig\ndGhpcyBjbGFzcywgd2l0aG91dCBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJlZEZpZWxk\ncygpIHsKICAgICAgICBpZiAoX2ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIExpc3Q8RmllbGRNZXRhRGF0YT4gZmllbGRzID0gCiAgICAgICAgICAg\nIAluZXcgQXJyYXlMaXN0PEZpZWxkTWV0YURhdGE+KF9maWVsZE1hcC5zaXpl\nKCkpOwogICAgICAgICAgICA7CiAgICAgICAgICAgIGZvciAoRmllbGRNZXRh\nRGF0YSBmbWQgOiBfZmllbGRNYXAudmFsdWVzKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEu\nTUFOQUdFX05PTkUpIHsKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RGVj\nbGFyZWRJbmRleChmaWVsZHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBmbWQuc2V0SW5kZXgoZm1kLmdldERlY2xhcmVkSW5kZXgoKSk7CiAgICAg\nICAgICAgICAgICAgICAgZmllbGRzLmFkZChmbWQpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZHMgPSBmaWVs\nZHMudG9BcnJheQogICAgICAgICAgICAJKF9yZXBvcy5uZXdGaWVsZE1ldGFE\nYXRhQXJyYXkoZmllbGRzLnNpemUoKSkpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX2ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBw\ncmltYXJ5IGtleSBmaWVsZHMsIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUuIFRo\nZSBvcmRlcgogICAgICogaW4gd2hpY2ggdGhlIGtleXMgYXJlIHJldHVybmVk\nIHdpbGwgYmUgdGhlIG9yZGVyIGluIHdoaWNoCiAgICAgKiB0aGUgZmllbGRz\nIGFyZSBkZWNsYXJlZCwgc3RhcnRpbmcgYXQgdGhlIGxlYXN0LWRlcml2ZWQg\nc3VwZXJjbGFzcwogICAgICogYW5kIGVuZGluZyB3aXRoIHRoZSBwcmltYXJ5\nIGtleSBmaWVsZHMgb2YgdGhlIG1vc3QtZGVyaXZlZCBzdWJjbGFzcy4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRQcmltYXJ5S2V5\nRmllbGRzKCkgewogICAgICAgIC8vIGNoZWNrIGZvciBwcmltYXJ5IGtleSBm\naWVsZHMgZXZlbiBpZiBub3Qgc2V0IHRvIElEX0FQUExJQ0FUSU9OIHNvIAog\nICAgICAgIC8vIHRoYXQgQXBwbGljYXRpb24gSWQgdG9vbCBzZWVzIHRoZW0g\nZXZlbiB3aGVuIHVzZXIgZG9lc24ndCBkZWNsYXJlIAogICAgCS8vIEFwcGxp\nY2F0aW9uIGlkZW50aXR5CiAgICAgICAgaWYgKF9hbGxQS0ZpZWxkcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBn\nZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IG51bSA9IDA7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc1ByaW1hcnlLZXkoKSkK\nICAgICAgICAgICAgICAgICAgICBudW0rKzsKCiAgICAgICAgICAgIGlmIChu\ndW0gPT0gMCkKICAgICAgICAgICAgICAgIF9hbGxQS0ZpZWxkcyA9IF9yZXBv\ncy5FTVBUWV9GSUVMRFM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IF9yZXBvcy5uZXdGaWVsZE1l\ndGFEYXRhQXJyYXkobnVtKTsKICAgICAgICAgICAgICAgIG51bSA9IDA7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0u\naXNQcmltYXJ5S2V5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmll\nbGRzW2ldLnNldFByaW1hcnlLZXlJbmRleChudW0pOwogICAgICAgICAgICAg\nICAgICAgICAgICBwa3NbbnVtXSA9IGZpZWxkc1tpXTsKICAgICAgICAgICAg\nICAgICAgICAgICAgbnVtKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX2FsbFBLRmllbGRzID0g\ncGtzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nYWxsUEtGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGxpc3Qgb2YgZmllbGRzIGluIHRoZSBkZWZhdWx0IGZldGNoIGdyb3VwLAog\nICAgICogaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLCBvciBhbiBlbXB0\neSBhcnJheSBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRh\nRGF0YVtdIGdldERlZmF1bHRGZXRjaEdyb3VwRmllbGRzKCkgewogICAgICAg\nIGlmIChfYWxsREZHRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAg\nICBpbnQgbnVtID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZmll\nbGRzW2ldLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICAg\nICAgICAgIG51bSsrOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRm\nZ3MgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KG51bSk7CiAgICAg\nICAgICAgIG51bSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZp\nZWxkc1tpXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAg\nICAgICAgICBkZmdzW251bSsrXSA9IGZpZWxkc1tpXTsKICAgICAgICAgICAg\nX2FsbERGR0ZpZWxkcyA9IGRmZ3M7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfYWxsREZHRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSB2ZXJzaW9uIGZpZWxkIGZvciB0aGlzIGNsYXNzLCBpZiBhbnkuCiAg\nICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldFZlcnNpb25GaWVs\nZCgpIHsKICAgICAgICBpZiAoX3ZlcnNpb25JZHggPT0gSW50ZWdlci5NSU5f\nVkFMVUUpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9\nIGdldEZpZWxkcygpOwogICAgICAgICAgICBpbnQgaWR4ID0gLTE7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzVmVyc2lvbigp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIm11bHQt\ndmVycy1maWVsZHMiLCB0aGlzLCBmaWVsZHNbaWR4XSwgZmllbGRzW2ldKSk7\nCiAgICAgICAgICAgICAgICAgICAgaWR4ID0gaTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfdmVyc2lvbklkeCA9IGlk\neDsKICAgICAgICB9CiAgICAgICAgaWYgKF92ZXJzaW9uSWR4ID09IC0xKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0Rmll\nbGRzKClbX3ZlcnNpb25JZHhdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNh\nY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gYWJzb2x1dGUg\naW5kZXguCiAgICAgKgogICAgICogQHJldHVybiB0aGUgZmllbGQncyBtZXRh\nZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwogICAgcHVibGlj\nIEZpZWxkTWV0YURhdGEgZ2V0RmllbGQoaW50IGluZGV4KSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAg\nIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gZmllbGRzLmxlbmd0aCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxkc1tp\nbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFk\nYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZpZWxk\nIHdpdGgKICAgICAqIHRoZSBnaXZlbiByZWxhdGl2ZSBpbmRleC4KICAgICAq\nCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxs\nIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0\nYSBnZXREZWNsYXJlZEZpZWxkKGludCBpbmRleCkgewogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAg\nICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gZmllbGRzLmxlbmd0aCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxk\nc1tpbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1l\ndGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZp\nZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBuYW1lLgogICAgICoKICAgICAq\nIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90\nIGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldEZp\nZWxkKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBnZXREZWNsYXJlZEZpZWxkKG5hbWUpOwogICAgICAgIGlmIChmbWQgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZtZDsKICAgICAgICBpZiAoX3N1\ncEZpZWxkTWFwICE9IG51bGwgJiYgX2RlZlN1cEZpZWxkcykgewogICAgICAg\nICAgICBmbWQgPSAoRmllbGRNZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChu\nYW1lKTsKICAgICAgICAgICAgaWYgKGZtZCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGZtZDsKICAgICAgICB9CiAgICAgICAgaWYgKF9zdXBl\nciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKS5nZXRGaWVsZChuYW1lKTsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEg\nZm9yIHRoZSBwZXJzaXN0ZW50IG9yIHRyYW5zYWN0aW9uYWwgZmllbGQgd2l0\naAogICAgICogdGhlIGdpdmVuIG5hbWUsIHdpdGhvdXQgaW5jbHVkaW5nIHN1\ncGVyY2xhc3MgZmllbGRzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZp\nZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAgKi8K\nICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldERlY2xhcmVkRmllbGQoU3Ry\naW5nIG5hbWUpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gKEZp\nZWxkTWV0YURhdGEpIF9maWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAgaWYg\nKGZpZWxkID09IG51bGwgfHwgZmllbGQuZ2V0TWFuYWdlbWVudCgpID09IEZp\nZWxkTWV0YURhdGEuTUFOQUdFX05PTkUpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIHJldHVybiBmaWVsZDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhbnkgZmllbGRzIHRoYXQgd2VyZSBhZGRlZCBhcyBub24t\nbWFuYWdlZC4KICAgICAqIEFsbCBvdGhlciBtZXRob2RzIHRvIGdldCBmaWVs\nZHMgcmV0dXJuIG9ubHkgdGhvc2UgdGhhdCBhcmUgbWFuYWdlZC4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJlZFVubWFu\nYWdlZEZpZWxkcygpIHsKICAgICAgICBpZiAoX3VubWdkRmllbGRzID09IG51\nbGwpIHsKICAgICAgICAgICAgTGlzdDxGaWVsZE1ldGFEYXRhPiB1bm1hbmFn\nZWQgPSBuZXcgQXJyYXlMaXN0PEZpZWxkTWV0YURhdGE+KDMpOwogICAgICAg\nICAgICA7CiAgICAgICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBmaWVsZCA6\nIF9maWVsZE1hcC52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgaWYgKGZp\nZWxkLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9O\nT05FKQogICAgICAgICAgICAgICAgICAgIHVubWFuYWdlZC5hZGQoZmllbGQp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF91bm1nZEZpZWxkcyA9IHVu\nbWFuYWdlZC50b0FycmF5CiAgICAgICAgICAgICAgICAoX3JlcG9zLm5ld0Zp\nZWxkTWV0YURhdGFBcnJheSh1bm1hbmFnZWQuc2l6ZSgpKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfdW5tZ2RGaWVsZHM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgYSBuZXcgZmllbGQgbWV0YWRhdGEgdG8gdGhpcyBjbGFz\ncy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgYWRkRGVjbGFy\nZWRGaWVsZChTdHJpbmcgbmFtZSwgQ2xhc3M8Pz4gdHlwZSkgewogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGEo\nbmFtZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7\nCiAgICAgICAgX2ZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAgICAgIHJl\ndHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdp\ndmVuIGZpZWxkIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxzZSBvdGhl\ncndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFy\nZWRGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAgaWYgKGZp\nZWxkICE9IG51bGwgJiYgX2ZpZWxkTWFwLnJlbW92ZShmaWVsZC5nZXROYW1l\nKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGRlZmluZWQgc3VwZXJjbGFzcyBmaWVsZCB3aXRoIHRoZSBnaXZlbiBuYW1l\nLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1l\ndGFEYXRhIGdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3RyaW5nIG5hbWUp\nIHsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoRmllbGRNZXRhRGF0\nYSkgX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBhIG5ldyBkZWZpbmVkIHN1cGVyY2xhc3MgZmllbGQgbWV0YWRh\ndGEgdG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0\nYURhdGEgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChTdHJpbmcgbmFtZSwg\nQ2xhc3M8Pz4gdHlwZSwKICAgICAgICBDbGFzczw/PiBzdXApIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRh\nKG5hbWUsIHR5cGUsIHRoaXMpOwogICAgICAgIGZtZC5zZXREZWNsYXJpbmdU\neXBlKHN1cCk7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAg\nICAgX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgICAgIGlmIChfc3VwRmll\nbGRNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX3N1cEZpZWxkTWFwID0gbmV3\nIEhhc2hNYXA8U3RyaW5nLEZpZWxkTWV0YURhdGE+KCk7CiAgICAgICAgX3N1\ncEZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAgICAgIHJldHVybiBmbWQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIGZpZWxk\nIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUg\naWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxzZSBvdGhlcndpc2UKICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVmaW5lZFN1cGVyY2xh\nc3NGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAgaWYgKGZp\nZWxkICE9IG51bGwgJiYgX3N1cEZpZWxkTWFwICE9IG51bGwKICAgICAgICAg\nICAgJiYgX3N1cEZpZWxkTWFwLnJlbW92ZShmaWVsZC5nZXROYW1lKCkpICE9\nIG51bGwpIHsKICAgICAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAg\nICAgICAgICAgIF9kZWZTdXBGaWVsZHMgPSBmYWxzZTsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEluY29ycG9yYXRlIHN1cGVyY2xhc3Mg\nZmllbGRzIHJlZGVmaW5lZCBpbiB0aGlzIHN1YmNsYXNzIGludG8gdGhpcwog\nICAgICogbWV0YWRhdGEuIFRoaXMgbWV0aG9kIGlzIGdlbmVyYWxseSBjYWxs\nZWQgYWZ0ZXIgbWV0YWRhdGEgaXMgcmVzb2x2ZWQKICAgICAqIGFuZCBtYXBw\naW5nIGluZm9ybWF0aW9uIGlzIGxvYWRlZCwgYnV0IGJlZm9yZSBtYXBwaW5n\nIHJlc29sdmUuCiAgICAgKgogICAgICogQHBhcmFtIGZvcmNlIHdoZXRoZXIg\ndG8gZm9yY2UgcmUtbWFwcGluZyBvZiBldmVuIG1hcHBlZCBzdXBlcmNsYXNz\nIGZpZWxkcwogICAgICovCiAgICBwdWJsaWMgdm9pZCBkZWZpbmVTdXBlcmNs\nYXNzRmllbGRzKGJvb2xlYW4gZm9yY2UpIHsKICAgICAgICBpZiAoX2RlZlN1\ncEZpZWxkcykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFzc01l\ndGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgaWYgKGlzTWFwcGVkKCkgJiYgc3VwICE9IG51bGwpIHsKICAgICAgICAg\nICAgLy8gcmVkZWZpbmUgYWxsIHVubWFwcGVkIHN1cGVyY2xhc3MgZmllbGRz\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBzID0gc3VwLmdldEZp\nZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1cHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICgoZm9yY2UgfHwg\nIXN1cHNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmlzTWFwcGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgJiYgZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVs\nZChzdXBzW2ldLmdldE5hbWUoKSkgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIGFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tpXS5nZXRO\nYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlKCksIHN1cHNbaV0uZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoKTsKCiAgICAgICAg\nLy8gdGhpcyBlbnN1cmVzIHRoYXQgYWxsIGZpZWxkIGluZGV4ZXMgZ2V0IHNl\ndCB3aGVuIGZpZWxkcyBhcmUgY2FjaGVkLgogICAgICAgIC8vIEkgZG9uJ3Qg\nbGlrZSBkb2luZyB0aGlzIHR3aWNlIChpdCdzIGFsc28gZG9uZSBpbiByZXNv\nbHZlTWV0YSksIGJ1dAogICAgICAgIC8vIHdlIGhhdmUgdG8gcmUtY2FjaGUg\naW4gY2FzZSB0aGlzIGNsYXNzIG9yIGFueSBzdXBlcmNsYXNzIHJlcGxhY2Vk\nCiAgICAgICAgLy8gc29tZSBmaWVsZHMgd2l0aCByZWRlZmluZWQgdmVyc2lv\nbnMsIGFuZCBJIGRvbid0IHdhbnQgb3V0c2lkZSBjb2RlCiAgICAgICAgLy8g\ndG8gaGF2ZSB0byBjYWxsIHRoaXMgbWV0aG9kIGFmdGVyIHJlc29sdmUganVz\ndCB0byBnZXQgZmllbGQgaW5kZXhlcywKICAgICAgICAvLyBldGMgc2V0IGNv\ncnJlY3RseQogICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAg\nIGNhY2hlRmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZl\nIHN1cGVyY2xhc3MgZmllbGRzIHdlJ3ZlIHJlZGVmaW5lZC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxk\ncygpIHsKICAgICAgICBfZGVmU3VwRmllbGRzID0gdHJ1ZTsKICAgICAgICBp\nZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBzdXA7CiAgICAgICAgZm9yIChGaWVs\nZE1ldGFEYXRhIGZtZCA6IF9zdXBGaWVsZE1hcC52YWx1ZXMoKSkgewogICAg\nICAgICAgICBzdXAgPSBnZXRTdXBlcmNsYXNzRmllbGQoZm1kKTsKCiAgICAg\nICAgICAgIC8vIEpQQSBtZXRhZGF0YSBkb2Vzbid0IHF1YWxpZnkgc3VwZXJj\nbGFzcyBmaWVsZCBuYW1lcywgc28gd2UKICAgICAgICAgICAgLy8gbWlnaHQg\nbm90IGtub3cgdGhlIGRlY2xhcmluZyB0eXBlIHVudGlsIG5vdwogICAgICAg\nICAgICBpZiAoZm1kLmdldERlY2xhcmluZ1R5cGUoKSA9PSBPYmplY3QuY2xh\nc3MpIHsKICAgICAgICAgICAgICAgIGZtZC5zZXREZWNsYXJpbmdUeXBlKHN1\ncC5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgZm1kLmJh\nY2tpbmdNZW1iZXIoZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhRmFjdG9y\neSgpLgogICAgICAgICAgICAgICAgICAgIGdldERlZmF1bHRzKCkuZ2V0QmFj\na2luZ01lbWJlcihmbWQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBm\nbWQuY29weShzdXApOwogICAgICAgICAgICBmbWQucmVzb2x2ZShNT0RFX01F\nVEEpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\nYW4gYXJyYXkgb2YgYWxsIHRoZSBmaWVsZHMgZGVmaW5lZCBieSB0aGlzIGNs\nYXNzLgogICAgICogVGhpcyBpbmNsdWRlcyBtYXBwZWQgZGVjbGFyZWQgZmll\nbGRzIGFuZCBhbnkgY29uY3JldGUgbWFwcGluZyBvZgogICAgICogdW5tYXBw\nZWQgc3VwZXJjbGFzcyBmaWVsZHMgcGVyZm9ybWVkIGJ5IHRoaXMgY2xhc3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVmaW5l\nZEZpZWxkcygpIHsKICAgICAgICBpZiAoX2RlZmluZWRGaWVsZHMgPT0gbnVs\nbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0\nRmllbGRzKCk7CiAgICAgICAgICAgIExpc3Q8RmllbGRNZXRhRGF0YT4gZGVm\naW5lZCA9IAogICAgICAgICAgICAJbmV3IEFycmF5TGlzdDxGaWVsZE1ldGFE\nYXRhPihmaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChGaWVsZE1l\ndGFEYXRhIGZtZCA6IGZpZWxkcykgewogICAgICAgICAgICAgICAgaWYgKGZt\nZC5pc01hcHBlZCgpCiAgICAgICAgICAgICAgICAgICAgJiYgZm1kLmdldERl\nZmluaW5nTWV0YURhdGEoKSA9PSB0aGlzKQogICAgICAgICAgICAgICAgICAg\nIGRlZmluZWQuYWRkKGZtZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nX2RlZmluZWRGaWVsZHMgPSAoRmllbGRNZXRhRGF0YVtdKSBkZWZpbmVkLnRv\nQXJyYXkKICAgICAgICAgICAgICAgIChfcmVwb3MubmV3RmllbGRNZXRhRGF0\nYUFycmF5KGRlZmluZWQuc2l6ZSgpKSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfZGVmaW5lZEZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgYWxsIGZpZWxkcyBpbiB0aGUgb3JkZXIgdGhleSBhcmUgbGlzdGVk\nIGluIHRoZSBtZXRhZGF0YQogICAgICogZmlsZS4gVW5saXN0ZWQgZmllbGRz\nIGFyZSBwbGFjZWQgYWZ0ZXIgbGlzdGVkIG9uZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RmllbGRzSW5MaXN0aW5nT3JkZXIo\nKSB7CiAgICAgICAgaWYgKF9hbGxMaXN0aW5nRmllbGRzID09IG51bGwpIHsK\nICAgICAgICAgICAgLy8gY29tYmluZSBkZWNsYXJlZCBhbmQgdW5tYW5hZ2Vk\nIGZpZWxkcyBpbnRvIGxpc3Rpbmcgb3JkZXIgYXJyYXkKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGRlYyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9IGdldERlY2xhcmVk\nVW5tYW5hZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBkZWNMaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQog\nICAgICAgICAgICAgICAgKGRlYy5sZW5ndGggKyB1bm1nZC5sZW5ndGgpOwog\nICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGRlYywgMCwgZGVjTGlzdGlu\nZywgMCwgZGVjLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNv\ncHkodW5tZ2QsIDAsIGRlY0xpc3RpbmcsIGRlYy5sZW5ndGgsIHVubWdkLmxl\nbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KGRlY0xpc3RpbmcsIExp\nc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2UoKSk7CgogICAgICAg\nICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWxs\nTGlzdGluZ0ZpZWxkcyA9IGRlY0xpc3Rpbmc7CiAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgLy8gcGxhY2Ugc3VwZXJjbGFzcyBmaWVsZHMg\naW4gbGlzdGluZyBvcmRlciBiZWZvcmUgb3VyCiAgICAgICAgICAgICAgICAv\nLyBsaXN0aW5nLW9yZGVyIGRlY2xhcmVkIGZpZWxkcwogICAgICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGRzSW5MaXN0aW5n\nT3JkZXIoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBsaXN0\naW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAgICAg\nICAgICAgICAgIChzdXAubGVuZ3RoICsgZGVjTGlzdGluZy5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShzdXAsIDAsIGxpc3Rp\nbmcsIDAsIHN1cC5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmVwbGFjZURl\nZmluZWRTdXBlcmNsYXNzRmllbGRzKGxpc3RpbmcsIHN1cC5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShkZWNMaXN0aW5nLCAw\nLCBsaXN0aW5nLCBzdXAubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGRl\nY0xpc3RpbmcubGVuZ3RoKTsKICAgICAgICAgICAgICAgIF9hbGxMaXN0aW5n\nRmllbGRzID0gbGlzdGluZzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gX2FsbExpc3RpbmdGaWVsZHM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIGFsbCBmaWVsZHMgZGVmaW5lZCBieSB0aGlzIGNs\nYXNzIGluIHRoZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQKICAgICAqIGluIHRo\nZSBtZXRhZGF0YSBmaWxlLiBVbmxpc3RlZCBmaWVsZHMgYXJlIHBsYWNlZCBh\nZnRlciBsaXN0ZWQgb25lcy4KICAgICAqIFRoaXMgYXJyYXkgaW5jbHVkZXMg\nZGVjbGFyZWQgdHJhbnNhY3Rpb25hbCBhbmQgdW5tYW5hZ2VkIGZpZWxkcy4K\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZpbmVk\nRmllbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAgICAgICAgaWYgKF9saXN0aW5n\nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBMaXN0PEZpZWxk\nTWV0YURhdGE+IGRlZmluZWQgPSAKICAgICAgICAgICAgCW5ldyBBcnJheUxp\nc3Q8RmllbGRNZXRhRGF0YT4oZmllbGRzLmxlbmd0aCk7CiAgICAgICAgICAg\nIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBmaWVsZHMpCiAgICAgICAgICAg\nICAgICBpZiAoZm1kLmdldERlZmluaW5nTWV0YURhdGEoKSA9PSB0aGlzKQog\nICAgICAgICAgICAgICAgICAgIGRlZmluZWQuYWRkKGZtZCk7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9IGdldERlY2xhcmVkVW5tYW5h\nZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBsaXN0\naW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAgICAg\nICAgICAgKGRlZmluZWQuc2l6ZSgpICsgdW5tZ2QubGVuZ3RoKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkZWZpbmVkLnNpemUoKTsgaSsr\nKQogICAgICAgICAgICAgICAgbGlzdGluZ1tpXSA9IChGaWVsZE1ldGFEYXRh\nKSBkZWZpbmVkLmdldChpKTsKICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29w\neSh1bm1nZCwgMCwgbGlzdGluZywgZGVmaW5lZC5zaXplKCksIHVubWdkLmxl\nbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KGxpc3RpbmcsIExpc3Rp\nbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2UoKSk7CiAgICAgICAgICAg\nIF9saXN0aW5nRmllbGRzID0gbGlzdGluZzsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9saXN0aW5nRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIG5hbWUgb2YgdGhlIGRhdGEgY2FjaGUgdGhhdCBzdG9yZXMgdGhlIG1h\nbmFnZWQgaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcywgYnkgZGVmYXVsdC4KICAg\nICAqIFRoaXMgY2FuIGJlIG92ZXJ3cml0dGVuIGJ5IHBlci1pbnN0YW5jZSBi\nYXNpcyB7QGxpbmtwbGFpbiBDYWNoZURpc3RyaWJ1dGlvblBvbGljeSBjYWNo\nZSBkaXN0cmlidXRpb24gcG9saWN5fS4gCiAgICAgKiAKICAgICAqIEByZXR1\ncm4gbnVsbCBpZiB0aGlzIGNsYXNzIGlzIGRpc2FibGVkIGZyb20gY2FjaGUg\nYnkgQERhdGFDYWNoZShlbmFibGVkPWZhbHNlKS4KICAgICAqICAgICAgICAg\ne0BsaW5rcGxhaW4gRGF0YUNhY2hlI05BTUVfREVGQVVMVCBkZWZhdWx0fSBp\nZiBARGF0YUNhY2hlKGVuYWJsZWQ9dHJ1ZSkgd2l0aG91dCBhIG5hbWUuCiAg\nICAgKiAgICAgICAgIE90aGVyd2lzZSwgZGF0YSBjYWNoZSBuYW1lIHNldCBi\neSB0aGUgdXNlciB2aWEgQERhdGFDYWNoZSBuYW1lIGF0dHJpYnV0ZS4gCiAg\nICAgKiAKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXREYXRhQ2FjaGVO\nYW1lKCkgewogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMoX2Nh\nY2hlTmFtZSkpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsICYm\nIFN0cmluZ1V0aWxzLmlzTm90RW1wdHkoZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKS5nZXREYXRhQ2FjaGVOYW1lKCkpKSB7CiAgICAgICAgICAgICAgICBf\nY2FjaGVOYW1lID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXREYXRh\nQ2FjaGVOYW1lKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBfY2FjaGVOYW1lID0gRGF0YUNhY2hlLk5BTUVfREVGQVVMVDsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NhY2hlTmFt\nZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTZXQgdGhlIGNhY2hlIG5h\nbWUgZm9yIHRoaXMgY2xhc3MuIAogICAgICogCiAgICAgKiBAcGFyYW0gY2Fu\nIGJlIG51bGwgdG8gZGlzYWJsZSBjYWNoZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RGF0YUNhY2hlTmFtZShTdHJpbmcgbmFtZSkgewogICAgICAg\nIF9jYWNoZU5hbWUgPSBuYW1lOwogICAgICAgIGlmIChuYW1lICE9IG51bGwp\nCiAgICAgICAgICAgIF9kYXRhQ2FjaGVFbmFibGVkID0gdHJ1ZTsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIHRydWUgaWYgdGhpcyByZWNl\naXZlciBpcyBhbm5vdGF0ZWQgd2l0aCBARGF0YUNhY2hlIGFuZCBpcyBub3Qg\nZGlzYWJsZWQuIAogICAgICogQSBzZXBhcmF0ZSBzdGF0ZSB2YXJpYWJsZSBp\ncyBuZWNlc3NhcnkgYmVzaWRlcyB0aGUgbmFtZSBvZiB0aGUgY2FjaGUgZGVm\nYXVsdGVkIHRvIGEgc3BlY2lhbCBzdHJpbmcuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGdldERhdGFDYWNoZUVuYWJsZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9kYXRhQ2FjaGVFbmFibGVkOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIGNhY2hlIHRpbWVvdXQgZm9yIHRoaXMgY2xhc3MuIC0xIGluZGljYXRl\ncyBubyB0aW1lb3V0LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldERhdGFD\nYWNoZVRpbWVvdXQoKSB7CiAgICAgICAgaWYgKF9jYWNoZVRpbWVvdXQgPT0g\nSW50ZWdlci5NSU5fVkFMVUUpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBfY2FjaGVUaW1lb3V0ID0gX3JlcG9zLmdldENvbmZpZ3VyYXRp\nb24oKS4KICAgICAgICAgICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1lb3V0\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY2FjaGVUaW1lb3V0Owog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIGNhY2hlIHRpbWVvdXQgZm9yIHRo\naXMgY2xhc3MuIC0xIGluZGljYXRlcyBubyB0aW1lb3V0LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVUaW1lb3V0KGludCB0aW1lb3V0\nKSB7CiAgICAgICAgX2NhY2hlVGltZW91dCA9IHRpbWVvdXQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGEgY2FjaGUgZm9yIHRoaXMg\nY2xhc3MsIG9yIG51bGwgaWYgaXQgaXMgbm90IGNhY2hhYmxlLgogICAgICov\nCiAgICBwdWJsaWMgRGF0YUNhY2hlIGdldERhdGFDYWNoZSgpIHsKICAgICAg\nICBTdHJpbmcgbmFtZSA9IGdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBp\nZiAobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX3JlcG9zLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS5nZXREYXRhQ2Fj\naGUobmFtZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIGluc3RhbmNlcyBhcmUgZGV0YWNoYWJsZS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gaXNEZXRhY2hhYmxlKCkgewogICAgICAgIGlmIChfZGV0YWNo\nYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfc3VwZXIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hhYmxlID0gKGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAg\nICAgICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZGV0YWNoYWJsZSA9IEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZGV0YWNoYWJs\nZS5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgaW5zdGFuY2VzIGFyZSBkZXRhY2hhYmxlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXREZXRhY2hhYmxlKGJvb2xlYW4gZGV0YWNoYWJsZSkgewog\nICAgICAgIF9kZXRhY2hhYmxlID0gKGRldGFjaGFibGUpID8gQm9vbGVhbi5U\nUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXREZXRhY2hlZFN0\nYXRlKCkgewogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMoX2Rl\ndGFjaFN0YXRlKSkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9\nIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChz\ndXAgIT0gbnVsbCAmJiBzdXAuaXNEZXRhY2hhYmxlKCkgPT0gaXNEZXRhY2hh\nYmxlKCkpCiAgICAgICAgICAgICAgICBfZGV0YWNoU3RhdGUgPSBzdXAuZ2V0\nRGV0YWNoZWRTdGF0ZSgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIEJvb2xlYW4gdXNlID0gdXNlc0RldGFjaGVkU3RhdGUoU1lOVEhF\nVElDLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9kZXRhY2hTdGF0ZSA9IChC\nb29sZWFuLkZBTFNFLmVxdWFscyh1c2UpKSA/IG51bGwgOiBTWU5USEVUSUM7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9kZXRh\nY2hTdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRo\nZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoZWRTdGF0ZShTdHJpbmcgZmll\nbGQpIHsKICAgICAgICBfZGV0YWNoU3RhdGUgPSBmaWVsZDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZGV0YWNoIHN0YXRlIGZpZWxkLCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZCBnZXRE\nZXRhY2hlZFN0YXRlRmllbGQoKSB7CiAgICAgICAgLy8gbm8gY2FjaGluZzsg\nb25seSB1c2VkIGF0IGVuaGFuY2VtZW50CiAgICAgICAgU3RyaW5nIGZpZWxk\nTmFtZSA9IGdldERldGFjaGVkU3RhdGUoKTsKICAgICAgICBpZiAoZmllbGRO\nYW1lID09IG51bGwgfHwgU1lOVEhFVElDLmVxdWFscyhmaWVsZE5hbWUpKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRmllbGQgZiA9IFJl\nZmxlY3Rpb24uZmluZEZpZWxkKF90eXBlLCBmaWVsZE5hbWUsIGZhbHNlKTsK\nICAgICAgICBpZiAoZiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZjsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbigKICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJuby1kZXRhY2gt\nc3RhdGUiLCBmaWVsZE5hbWUsIF90eXBlKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIGFuIGluc3RhbmNlIG9mIHRoaXMgdHlwZSBoYXMgZGV0\nYWNoZWQgc3RhdGUuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIGEg\nZGV0YWNoZWQgaW5zdGFuY2UgbXVzdCBoYXZlIGRldGFjaGVkIHN0YXRlLCBm\nYWxzZQogICAgICogaWYgaXQgZG9lcyBub3QsIGFuZCBudWxsIGlmIGl0IG1h\neSB1c2UgYQogICAgICogbWFudWFsbHktY29uc3RydWN0ZWQgaW5zdGFuY2Ug\nd2l0aG91dCBkZXRhY2hlZCBzdGF0ZQogICAgICovCiAgICBwdWJsaWMgQm9v\nbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZSgpIHsKICAgICAgICAvLyBubyBuZWVk\nIHRvIGxldCBjb25mIGRpc2FsbG93IGJlY2F1c2UgaXQncyB0YWtlbiBpbnRv\nIGFjY291bnQgaW4KICAgICAgICAvLyBnZXREZXRhY2hlZFN0YXRlKCkgY2Fs\nbAogICAgICAgIHJldHVybiB1c2VzRGV0YWNoZWRTdGF0ZShnZXREZXRhY2hl\nZFN0YXRlKCksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgYW4gaW5zdGFuY2Ugb2YgdGhpcyB0eXBlIGhhcyBkZXRhY2hlZCBzdGF0\nZSwgYXNzdW1pbmcgdGhlIGdpdmVuCiAgICAgKiBkZXRhY2hlZCBzdGF0ZSBm\naWVsZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYSBkZXRhY2hl\nZCBpbnN0YW5jZSBtdXN0IGhhdmUgZGV0YWNoZWQgc3RhdGUsIGZhbHNlCiAg\nICAgKiBpZiBpdCBkb2VzIG5vdCwgYW5kIG51bGwgaWYgaXQgbWF5IHVzZSBh\nCiAgICAgKiBtYW51YWxseS1jb25zdHJ1Y3RlZCBpbnN0YW5jZSB3aXRob3V0\nIGRldGFjaGVkIHN0YXRlCiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiB1\nc2VzRGV0YWNoZWRTdGF0ZShTdHJpbmcgZGV0YWNoZWRGaWVsZCwKICAgICAg\nICBib29sZWFuIGNvbmZEaXNhbGxvd3MpIHsKICAgICAgICBpZiAoIWlzRGV0\nYWNoYWJsZSgpKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsK\nCiAgICAgICAgLy8gaWYgd2UgZGVjbGFyZSBhIGRldGFjaGVkIHN0YXRlIGZp\nZWxkLCBoYXZlIHRvIHVzZSBpdAogICAgICAgIGlmIChkZXRhY2hlZEZpZWxk\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwog\nICAgICAgIGlmICghU1lOVEhFVElDLmVxdWFscyhkZXRhY2hlZEZpZWxkKSkK\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKCiAgICAgICAgLy8g\nYWxsb3cgY29uZiB0byBkaXNhbGxvdwogICAgICAgIGlmIChjb25mRGlzYWxs\nb3dzICYmICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAg\nICBnZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuZ2V0RGV0YWNoZWRTdGF0ZUZp\nZWxkKCkpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwoKICAg\nICAgICAvLyBoYXZlIHRvIHVzZSBkZXRhY2hlZCBzdGF0ZSB0byBzdG9yZSBk\nYXRhc3RvcmUgaWQKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBlKCkgPT0g\nSURfREFUQVNUT1JFKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVF\nOwoKICAgICAgICAvLyBhbGxvdyBkZXRhY2hlZCBzdGF0ZSB1c2UsIGJ1dCBk\nb24ndCByZXF1aXJlCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgZmllbGQgZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJBbGxGaWVsZENhY2hlKCkgewogICAg\nICAgIF9hbGxGaWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxERkdGaWVsZHMg\nPSBudWxsOwogICAgICAgIF9hbGxQS0ZpZWxkcyA9IG51bGw7CiAgICAgICAg\nX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAgICAgIF9saXN0aW5nRmllbGRz\nID0gbnVsbDsKICAgICAgICBfYWxsTGlzdGluZ0ZpZWxkcyA9IG51bGw7CiAg\nICAgICAgX2ZpZWxkRGF0YVRhYmxlID0gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIENsZWFyIGRlZmluZWQgZmllbGQgZGF0YS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgY2xlYXJEZWZpbmVkRmllbGRDYWNoZSgpIHsKICAg\nICAgICBfZGVmaW5lZEZpZWxkcyA9IG51bGw7CiAgICAgICAgX2xpc3RpbmdG\naWVsZHMgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2Fj\naGVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNs\nZWFyRmllbGRDYWNoZSgpIHsKICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUo\nKTsKICAgICAgICBfZmllbGRzID0gbnVsbDsKICAgICAgICBfdW5tZ2RGaWVs\nZHMgPSBudWxsOwogICAgICAgIF92ZXJzaW9uSWR4ID0gSW50ZWdlci5NSU5f\nVkFMVUU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgc3Vi\nY2xhc3MgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJT\ndWJjbGFzc0NhY2hlKCkgewogICAgICAgIF9zdWJzID0gbnVsbDsKICAgICAg\nICBfc3ViTWV0YXMgPSBudWxsOwogICAgICAgIF9tYXBTdWJNZXRhcyA9IG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBpbXBsIGRhdGEgYW5k\nIGludGVybWVkaWF0ZSBkYXRhIHRhYmxlLgogICAgICovCiAgICB2b2lkIGNs\nZWFyRXh0cmFGaWVsZERhdGFUYWJsZSgpIHsKICAgICAgICBfZmllbGREYXRh\nVGFibGUgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2FjaGUgZmll\nbGQgYXJyYXlzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2FjaGVGaWVs\nZHMoKSB7CiAgICAgICAgZ2V0RmllbGRzKCk7CiAgICAgICAgZ2V0UHJpbWFy\neUtleUZpZWxkcygpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgaGFzaENvZGUo\nKSB7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUoKS5oYXNoQ29kZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3Ro\nZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBD\nbGFzc01ldGFEYXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIHJldHVybiBfdHlwZSA9PSAoKENsYXNzTWV0YURhdGEpIG90aGVyKS5n\nZXREZXNjcmliZWRUeXBlKCk7CiAgICB9CgogICAgcHVibGljIGludCBjb21w\nYXJlVG8oQ2xhc3NNZXRhRGF0YSBvdGhlcikgewogICAgICAgIGlmIChvdGhl\nciA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICByZXR1\ncm4gX3R5cGUuZ2V0TmFtZSgpLmNvbXBhcmVUbygoKENsYXNzTWV0YURhdGEp\nIG90aGVyKS4KICAgICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5h\nbWUoKSk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsK\nICAgICAgICByZXR1cm4gZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJl\nc29sdmUgYW5kIHZhbGlkYXRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMg\nbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UmVzb2x2ZSgp\nIHsKICAgICAgICByZXR1cm4gX3Jlc01vZGU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgcmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1ldGFkYXRhLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlKSB7CiAg\nICAgICAgX3Jlc01vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHJlc29sdmUgbW9kZSBmb3IgdGhpcyBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShpbnQgbW9kZSwgYm9vbGVhbiBv\nbikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAg\nICAgX3Jlc01vZGUgPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9uKQogICAg\nICAgICAgICBfcmVzTW9kZSB8PSBtb2RlOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX3Jlc01vZGUgJj0gfm1vZGU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXNvbHZlIGFuZCB2YWxpZGF0ZSBtZXRhZGF0YS4gUmV0dXJuIHRydWUg\naWYgYWxyZWFkeSByZXNvbHZlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gcmVzb2x2ZShpbnQgbW9kZSkgewogICAgICAgIGlmICgoX3Jlc01vZGUg\nJiBtb2RlKSA9PSBtb2RlKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICBpbnQgY3VyID0gX3Jlc01vZGU7CiAgICAgICAgX3Jlc01vZGUgfD0g\nbW9kZTsKCiAgICAgICAgaW50IHZhbCA9IF9yZXBvcy5nZXRWYWxpZGF0ZSgp\nOwogICAgICAgIGJvb2xlYW4gcnVudGltZSA9ICh2YWwgJiBNZXRhRGF0YVJl\ncG9zaXRvcnkuVkFMSURBVEVfUlVOVElNRSkgIT0gMDsKICAgICAgICBib29s\nZWFuIHZhbGlkYXRlID0KICAgICAgICAgICAgIUltcGxIZWxwZXIuaXNNYW5h\nZ2VkVHlwZShnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLCBf\ndHlwZSkKICAgICAgICAgICAgfHwgKHZhbCAmIE1ldGFEYXRhUmVwb3NpdG9y\neS5WQUxJREFURV9VTkVOSEFOQ0VEKSA9PSAwOwoKICAgICAgICAvLyB3ZSBv\nbmx5IGRvIGFueSBhY3Rpb25zIGZvciBtZXRhZGF0YSBtb2RlCiAgICAgICAg\naWYgKChtb2RlICYgTU9ERV9NRVRBKSAhPSAwICYmIChjdXIgJiBNT0RFX01F\nVEEpID09IDApIHsKICAgICAgICAgICAgcmVzb2x2ZU1ldGEocnVudGltZSk7\nCiAgICAgICAgICAgIGlmICh2YWxpZGF0ZSAmJiAodmFsICYgTWV0YURhdGFS\nZXBvc2l0b3J5LlZBTElEQVRFX01FVEEpICE9IDApCiAgICAgICAgICAgICAg\nICB2YWxpZGF0ZU1ldGEocnVudGltZSk7CiAgICAgICAgfQogICAgICAgIGlm\nICgobW9kZSAmIE1PREVfTUFQUElORykgIT0gMCAmJiAoY3VyICYgTU9ERV9N\nQVBQSU5HKSA9PSAwKSB7CiAgICAgICAgICAgIHJlc29sdmVNYXBwaW5nKHJ1\nbnRpbWUpOwogICAgICAgICAgICBpZiAodmFsaWRhdGUgJiYgKHZhbCAmIE1l\ndGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9NQVBQSU5HKSAhPSAwKQogICAg\nICAgICAgICAgICAgdmFsaWRhdGVNYXBwaW5nKHJ1bnRpbWUpOwogICAgICAg\nIH0KICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkdfSU5JVCkgIT0g\nMCAmJiAoY3VyICYgTU9ERV9NQVBQSU5HX0lOSVQpID09IDApCiAgICAgICAg\nICAgIGluaXRpYWxpemVNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1ldGEoYm9vbGVhbiBy\ndW50aW1lKSB7CiAgICAgICAgYm9vbGVhbiBlbWJlZCA9IF9vd25lciAhPSBu\ndWxsICYmIF9vd25lci5nZXREZWNsYXJlZFR5cGUoKSA9PSBfdHlwZTsKICAg\nICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChs\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9s\nb2MuZ2V0KChlbWJlZCkgPyAicmVzb2x2ZS1lbWJlZC1tZXRhIiA6ICJyZXNv\nbHZlLW1ldGEiLAogICAgICAgICAgICAgICAgdGhpcyArICJAIiArIFN5c3Rl\nbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CgogICAgICAgIGlmIChydW50\naW1lICYmICFfdHlwZS5pc0ludGVyZmFjZSgpICYmCiAgICAgICAgICAgICFJ\nbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUoZ2V0UmVwb3NpdG9yeSgpLmdldENv\nbmZpZ3VyYXRpb24oKSxfdHlwZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVuaGFuY2VkIiwgX3R5\ncGUpKTsKCiAgICAgICAgLy8gYXJlIHdlIHRoZSB0YXJnZXQgb2YgYW4gZW1i\nZWRkZWQgdmFsdWU/CiAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAg\nIGlmIChyZWN1cnNpdmVFbWJlZChfb3duZXIpKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInJlY3Vy\nc2UtZW1iZWQiLCBfb3duZXIpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gY29weSBpbmZvIGZyb20gdGhlICJyZWFsIiBtZXRhZGF0YSBmb3Ig\ndGhpcyB0eXBlCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9y\nZXBvcy5nZXRNZXRhRGF0YShfdHlwZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAg\nICAgICAgIG1ldGEucmVzb2x2ZShNT0RFX01FVEEpOwogICAgICAgICAgICBj\nb3B5KHRoaXMsIG1ldGEpOwogICAgICAgICAgICBfZW1iZWRkZWQgPSBCb29s\nZWFuLkZBTFNFOyAvLyBlbWJlZGRlZCBpbnN0YW5jZSBpc24ndCBlbWJlZGRl\nZC1vbmx5CiAgICAgICAgfQoKICAgICAgICAvLyBtYWtlIHN1cmUgc3VwZXJj\nbGFzcyBpcyByZXNvbHZlZAogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoc3VwICE9\nIG51bGwpIHsKICAgICAgICAgICAgc3VwLnJlc29sdmUoTU9ERV9NRVRBKTsK\nICAgICAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAgICAgICAvLyBl\nbWJlZGRlZCBpbnN0YW5jZSBhbHdheXMgcmVkZWZpbmUgYWxsIHN1cGVyY2xh\nc3MgZmllbGRzCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gc3Vw\ncyA9IHN1cC5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbAogICAgICAgICAgICAg\nICAgICAgICAgICB8fCAhX3N1cEZpZWxkTWFwLmNvbnRhaW5zS2V5KHN1cHNb\naV0uZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRE\nZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJlZFR5\ncGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cHNbaV0uZ2V0\nRGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIHJlc29sdmUgZmllbGRzIGFuZCByZW1vdmUgaW52YWxpZHMKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZDsKICAgICAgICBmb3IgKEl0ZXJhdG9yPEZp\nZWxkTWV0YURhdGE+IGl0ciA9IF9maWVsZE1hcC52YWx1ZXMoKS5pdGVyYXRv\ncigpOyAKICAgICAgICAJaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nLy8gb25seSBwYXNzIG9uIG1ldGFkYXRhIHJlc29sdmUgbW9kZSBzbyB0aGF0\nIG1ldGFkYXRhIGlzIGFsd2F5cwogICAgICAgICAgICAvLyByZXNvbHZlZCBi\nZWZvcmUgYW55IG90aGVyIHJlc29sdmUgbW9kZXMgb3VyIHN1YmNsYXNzZXMg\ncGFzcyBhbG9uZwogICAgICAgICAgICBmbWQgPSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBmbWQucmVzb2x2ZShNT0RFX01FVEEpOwoKICAgICAgICAgICAg\naWYgKCFmbWQuaXNFeHBsaWNpdCgpCiAgICAgICAgICAgICAgICAmJiAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0JKRUNUCiAg\nICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5QQ19VTlRZUEVECiAgICAgICAgICAgICAgICB8fCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkKICAg\nICAgICAgICAgICAgICYmIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpCiAgICAgICAgICAgICAgICA9PSBKYXZhVHlwZXMuT0JKRUNU\nKSkpIHsKICAgICAgICAgICAgICAgIF9yZXBvcy5nZXRMb2coKS53YXJuKF9s\nb2MuZ2V0KCJybS1maWVsZCIsIGZtZCkpOwogICAgICAgICAgICAgICAgaWYg\nKGZtZC5nZXRMaXN0aW5nSW5kZXgoKSAhPSAtMSkKICAgICAgICAgICAgICAg\nICAgICBmbWQuc2V0TWFuYWdlbWVudChGaWVsZE1ldGFEYXRhLk1BTkFHRV9O\nT05FKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICBjbGVhckZpZWxkQ2Fj\naGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZW1i\nZWRkZWQgaW5zdGFuY2VzIG11c3QgZW1iZWQgYWxsIHN1cGVyY2xhc3MgZmll\nbGRzIHRvbwogICAgICAgIGlmIChlbWJlZCkgewogICAgICAgICAgICBjbGVh\nckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgcmVzb2x2ZURlZmluZWRT\ndXBlcmNsYXNzRmllbGRzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyB0aGlz\nIGVuc3VyZXMgdGhhdCBhbGwgZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdoZW4g\nZmllbGRzIGFyZSBjYWNoZWQKICAgICAgICBjYWNoZUZpZWxkcygpOwoKICAg\nICAgICAvLyByZXNvbHZlIGxpZmVjeWNsZSBtZXRhZGF0YSBub3cgdG8gcHJl\ndmVudCBsYXp5IHRocmVhZGluZyBwcm9ibGVtcwogICAgICAgIF9saWZlTWV0\nYS5yZXNvbHZlKCk7CgogICAgICAgIC8vIHJlY29yZCBpbXBsZW1lbnRzIGlu\nIHRoZSByZXBvc2l0b3J5CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzICE9IG51\nbGwpIHsKICAgICAgICAgICAgZm9yIChDbGFzczw/PiBpZmFjZSA6IF9pbnRl\ncmZhY2VzKQogICAgICAgICAgICAgICAgX3JlcG9zLmFkZERlY2xhcmVkSW50\nZXJmYWNlSW1wbCh0aGlzLCBpZmFjZSk7CiAgICAgICAgfQoKICAgICAgICAv\nLyByZXNvbHZlIGZldGNoIGdyb3VwcwogICAgICAgIGlmIChfZmdNYXAgIT0g\nbnVsbCkKICAgICAgICAgICAgZm9yIChGZXRjaEdyb3VwIGZnIDogX2ZnTWFw\nLnZhbHVlcygpKQogICAgICAgICAgICAgICAgZmcucmVzb2x2ZSgpOwoKICAg\nICAgICBpZiAoIWVtYmVkICYmIF90eXBlLmlzSW50ZXJmYWNlKCkpIHsKICAg\nICAgICAgICAgaWYgKF9pbnRlcmZhY2UgIT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJpbnRlcmZhY2UiLCBfdHlwZSkpOwoKICAgICAgICAgICAgaWYgKHJ1\nbnRpbWUpIHsKICAgICAgICAgICAgICAgIF9pbXBsID0gX3JlcG9zLmdldElt\ncGxHZW5lcmF0b3IoKS5jcmVhdGVJbXBsKHRoaXMpOwogICAgICAgICAgICAg\nICAgX3JlcG9zLnNldEludGVyZmFjZUltcGwodGhpcywgX2ltcGwpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGlzIGlzIHJ1\nbnRpbWUsIGNyZWF0ZSBhIHBjIGluc3RhbmNlIGFuZCBzY2FuIGl0IGZvciBj\nb21wYXJhdG9ycwogICAgICAgIGlmIChydW50aW1lICYmICFNb2RpZmllci5p\nc0Fic3RyYWN0KF90eXBlLmdldE1vZGlmaWVycygpKSkgewogICAgICAgICAg\nICBQcm94eVNldHVwU3RhdGVNYW5hZ2VyIHNtID0gbmV3IFByb3h5U2V0dXBT\ndGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgc20uc2V0UHJveHlEYXRhKFBD\nUmVnaXN0cnkubmV3SW5zdGFuY2UoX3R5cGUsIHNtLCBmYWxzZSksIHRoaXMp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gcmVjdXJz\naXZlRW1iZWQoVmFsdWVNZXRhRGF0YSBvd25lcikgewogICAgICAgIENsYXNz\nTWV0YURhdGEgY20gPSBvd25lci5nZXRGaWVsZE1ldGFEYXRhKCkuZ2V0RGVm\naW5pbmdNZXRhRGF0YSgpOyAKICAgICAgICBpZiAoY20uZ2V0RGVzY3JpYmVk\nVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oX3R5cGUpKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIG93bmVyMSA9IGNt\nLmdldEVtYmVkZGluZ01ldGFEYXRhKCk7CiAgICAgICAgaWYgKG93bmVyMSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZWxz\nZSAKICAgICAgICAgICAgcmV0dXJuIHJlY3Vyc2l2ZUVtYmVkKG93bmVyMSk7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogVmFsaWRhdGUgcmVzb2x2ZWQg\nbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHZhbGlkYXRl\nTWV0YShib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICB2YWxpZGF0ZURhdGFD\nYWNoZSgpOwogICAgICAgIHZhbGlkYXRlRGV0YWNoYWJsZSgpOwogICAgICAg\nIHZhbGlkYXRlRXh0ZW5zaW9uS2V5cygpOwogICAgICAgIHZhbGlkYXRlSWRl\nbnRpdHkoKTsKICAgICAgICB2YWxpZGF0ZUFjY2Vzc1R5cGUoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlc29sdmUgbWFwcGluZyBkYXRhLiBMb2dzIHJl\nc29sdmUgbWVzc2FnZSBhbmQgcmVzb2x2ZXMgc3VwZXIgYnkgZGVmYXVsdC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1hcHBpbmcoYm9v\nbGVhbiBydW50aW1lKSB7CiAgICAgICAgTG9nIGxvZyA9IF9yZXBvcy5nZXRM\nb2coKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgicmVzb2x2ZS1tYXBwaW5nIiwg\ndGhpcyArICJAIgogICAgICAgICAgICAgICAgKyBTeXN0ZW0uaWRlbnRpdHlI\nYXNoQ29kZSh0aGlzKSkpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgc3VwZXJj\nbGFzcyBpcyByZXNvbHZlZCBmaXJzdAogICAgICAgIENsYXNzTWV0YURhdGEg\nc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAo\nc3VwICE9IG51bGwpCiAgICAgICAgICAgIHN1cC5yZXNvbHZlKE1PREVfTUFQ\nUElORyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBtYXBwaW5n\nIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHZhbGlkYXRlTWFw\ncGluZyhib29sZWFuIHJ1bnRpbWUpIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIEluaXRpYWxpemUgbWFwcGluZy4gTG9ncyBpbml0IG1lc3NhZ2UgYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgaW5pdGlhbGl6ZU1h\ncHBpbmcoKSB7CiAgICAgICAgTG9nIGxvZyA9IF9yZXBvcy5nZXRMb2coKTsK\nICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nIGxvZy50cmFjZShfbG9jLmdldCgiaW5pdC1tYXBwaW5nIiwgdGhpcyArICJA\nIgogICAgICAgICAgICAgICAgKyBTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0\naGlzKSkpOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgZGF0YSBj\nYWNoZSBzZXR0aW5ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlk\nYXRlRGF0YUNhY2hlKCkgewogICAgICAgIGludCB0aW1lb3V0ID0gZ2V0RGF0\nYUNhY2hlVGltZW91dCgpOwogICAgICAgIGlmICh0aW1lb3V0IDwgLTEgfHwg\ndGltZW91dCA9PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImNhY2hlLXRpbWVvdXQtaW52YWxpZCIsCiAg\nICAgICAgICAgICAgICBfdHlwZSwgU3RyaW5nLnZhbHVlT2YodGltZW91dCkp\nKTsKCiAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsKSB7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CiAgICAgICAgU3RyaW5nIGNhY2hlID0gZ2V0\nRGF0YUNhY2hlTmFtZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFN0cmlu\nZyBzdXBlckNhY2hlID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRE\nYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgCiAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KHN1cGVyQ2FjaGUpKSB7ICAKICAgICAgICAgICAgaWYg\nKCFTdHJpbmdVdGlscy5lcXVhbHMoY2FjaGUsIHN1cGVyQ2FjaGUpKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImNhY2hlLW5hbWVzIiwgbmV3IE9iamVjdFtdIHsgX3R5cGUsIGNh\nY2hlLCBfc3VwZXIsIHN1cGVyQ2FjaGUgfSkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhl\nIGlkZW50aXR5IGhhbmRsaW5nIGZvciB0aGlzIGNsYXNzIGlzIHZhbGlkLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVJZGVudGl0eSgpIHsK\nICAgICAgICAvLyBtYWtlIHN1cmUgaWRlbnRpdHkgdHlwZXMgYXJlIGNvbnNp\nc3RlbnQKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaW50IGlkID0gZ2V0SWRlbnRpdHlU\neXBlKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRJZGVu\ndGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOCiAgICAgICAgICAgICYmIHN1cC5n\nZXRJZGVudGl0eVR5cGUoKSAhPSBpZCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpZC10eXBlcyIsIF90eXBl\nKSk7CgogICAgICAgIC8vIGNoZWNrIGZvciB0aGluZ3MgdGhlIGRhdGEgc3Rv\ncmUgZG9lc24ndCBzdXBwb3J0CiAgICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+\nIG9wdHMgPSBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRlZE9w\ndGlvbnMoKTsKICAgICAgICBpZiAoaWQgPT0gSURfQVBQTElDQVRJT04KICAg\nICAgICAgICAgJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24uT1BUSU9OX0lEX0FQUExJQ0FUSU9OKSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImFwcGlkLW5v\ndC1zdXBwb3J0ZWQiLAogICAgICAgICAgICAgICAgX3R5cGUpKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKGlkID09IElEX0RBVEFTVE9SRQogICAgICAgICAg\nICAmJiAhb3B0cy5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJ\nT05fSURfREFUQVNUT1JFKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgi\nZGF0YXN0b3JlaWQtbm90LXN1cHBvcnRlZCIsIF90eXBlKSk7CiAgICAgICAg\nfQoKICAgICAgICBpZiAoaWQgPT0gSURfQVBQTElDQVRJT04pIHsKICAgICAg\nICAgICAgaWYgKF9pZFN0cmF0ZWd5ICE9IFZhbHVlU3RyYXRlZ2llcy5OT05F\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJhcHBpZC1zdHJhdGVneSIsIF90eXBlKSk7CiAgICAgICAg\nICAgIHZhbGlkYXRlQXBwSWRDbGFzcygpOwogICAgICAgIH0gZWxzZSBpZiAo\naWQgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgdmFsaWRhdGVOb1BLRmll\nbGRzKCk7CgogICAgICAgIGludCBzdHJhdGVneSA9IGdldElkZW50aXR5U3Ry\nYXRlZ3koKTsKICAgICAgICBpZiAoc3RyYXRlZ3kgPT0gVmFsdWVTdHJhdGVn\naWVzLlNFUVVFTkNFCiAgICAgICAgICAgICYmIGdldElkZW50aXR5U2VxdWVu\nY2VOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zZXEtbmFtZSIsIF90eXBlKSk7\nCgogICAgICAgIFZhbHVlU3RyYXRlZ2llcy5hc3NlcnRTdXBwb3J0ZWQoc3Ry\nYXRlZ3ksIHRoaXMsCiAgICAgICAgICAgICJkYXRhc3RvcmUgaWRlbnRpdHkg\nc3RyYXRlZ3kiKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB0\naGUgYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3MgaXMgdmFsaWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xhc3MoKSB7CiAg\nICAgICAgLy8gYmFzZSB0eXBlcyBtdXN0IGRlY2xhcmUgYW4gb2lkIGNsYXNz\nIGlmIG5vdCBzaW5nbGUtZmllbGQgaWRlbnRpdHkKICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gcGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAg\nIGlmIChnZXRPYmplY3RJZFR5cGUoKSA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChwa3MubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVkLWlk\nLXR5cGUiLAogICAgICAgICAgICAgICAgICAgIF90eXBlLCBwa3NbMF0uZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgICAgIHBrc1swXS5nZXREZWNsYXJl\nZFR5cGUoKS5nZXROYW1lKCkpKTsKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1pZC1jbGFzcyIsIF90eXBl\nLCAKICAgICAgICAgICAgCQlBcnJheXMuYXNMaXN0KHRvTmFtZXMocGtzKSkp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9vYmplY3RJZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChpc09wZW5KUEFJZGVu\ndGl0eSgpKSB7CiAgICAgICAgICAgIGlmIChwa3NbMF0uZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpIHsKICAgICAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgZW1iZWQgPSBwa3NbMF0uZ2V0RW1iZWRkZWRNZXRh\nRGF0YSgpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNzTWV0\naG9kcyhlbWJlZC5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICAg\nICAgdmFsaWRhdGVBcHBJZENsYXNzUEtzKGVtYmVkLCBlbWJlZC5nZXRGaWVs\nZHMoKSwKICAgICAgICAgICAgICAgICAgICBlbWJlZC5nZXREZXNjcmliZWRU\neXBlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkgewogICAgICAg\nICAgICAvLyBjb25jcmV0ZSBzdXBlcmNsYXNzIG9pZCBtdXN0IG1hdGNoIG9y\nIGJlIHBhcmVudCBvZiBvdXJzCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAg\nQ2xhc3M8Pz4gb2JqZWN0SWRUeXBlID0gc3VwLmdldE9iamVjdElkVHlwZSgp\nOwogICAgICAgICAgICBpZiAob2JqZWN0SWRUeXBlICE9IG51bGwgJiYgCiAg\nICAgICAgICAgICAgICAhb2JqZWN0SWRUeXBlLmlzQXNzaWduYWJsZUZyb20o\nX29iamVjdElkKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiaWQtY2xhc3NlcyIsCiAgICAgICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyBfdHlwZSwgX29iamVjdElkLCBfc3Vw\nZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cC5nZXRPYmplY3RJZFR5\ncGUoKSB9KSk7CgogICAgICAgICAgICAvLyB2YWxpZGF0ZSB0aGF0IG5vIG90\naGVyIHBrcyBhcmUgZGVjbGFyZWQgaWYgd2UgaGF2ZSBhCiAgICAgICAgICAg\nIC8vIGNvbmNyZXRlIFBDIHN1cGVyY2xhc3MKICAgICAgICAgICAgaWYgKGhh\nc0NvbmNyZXRlUENTdXBlcmNsYXNzKCkpCiAgICAgICAgICAgICAgICB2YWxp\nZGF0ZU5vUEtGaWVsZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRo\naXMgY2xhc3MgaGFzIGl0cyBvd24gb2lkIGNsYXNzLCBkbyBzb21lIG1vcmUg\ndmFsaWRhdGlvbgogICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbAogICAgICAg\nICAgICB8fCBfb2JqZWN0SWQgIT0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKS5nZXRPYmplY3RJZFR5cGUoKSkgewogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgbm9uLWFic3RyYWN0IG9pZCBjbGFzc2VzIG92ZXJyaWRlIHRoZSBwcm9w\nZXIgbWV0aG9kcwogICAgICAgICAgICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJh\nY3QoX29iamVjdElkLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAg\nIHZhbGlkYXRlQXBwSWRDbGFzc01ldGhvZHMoX29iamVjdElkKTsKCiAgICAg\nICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgYXBwbGljYXRpb24gaWQgY2xhc3Mg\naGFzIGFsbCBwcmltYXJ5IGtleSBmaWVsZHMKICAgICAgICAgICAgdmFsaWRh\ndGVBcHBJZENsYXNzUEtzKHRoaXMsIHBrcywgX29iamVjdElkKTsKICAgICAg\nICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoaXMg\nY2xhc3MgdXNlcyBJZENsYXNzIGRlcml2ZWQgZnJvbSBpZENsYXNzIG9mIHRo\nZSAKICAgICAqIHBhcmVudCBlbnRpdHkgd2hpY2ggYW5ub3RhdGVkIGFzIGlk\nIGluIHRoZSBjaGlsZCBjbGFzcy4gCiAgICAgKiBJbiB0aGlzIGNhc2UsIHRo\nZXJlIGFyZSBubyBrZXkgZmllbGRzIGluIHRoZSBjaGlsZCBlbnRpdHkgY29y\ncmVzcG9uZGluZyAKICAgICAqIHRvIHRoZSBmaWVsZHMgaW4gdGhlIElkQ2xh\nc3MuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHVzZUlkQ2xhc3NGcm9t\nUGFyZW50KCkgewogICAgICAgIGlmIChfdXNlSWRDbGFzc0Zyb21QYXJlbnQg\nPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX29iamVjdElkID09IG51bGwp\nCiAgICAgICAgICAgICAgICBfdXNlSWRDbGFzc0Zyb21QYXJlbnQgPSBmYWxz\nZTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gcGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAg\nICAgICAgICAgaWYgKHBrcy5sZW5ndGggIT0gMSkgCiAgICAgICAgICAgICAg\nICAgICAgX3VzZUlkQ2xhc3NGcm9tUGFyZW50ID0gZmFsc2U7CiAgICAgICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIHBrTWV0YSA9IHBrc1swXS5nZXRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAocGtNZXRhID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIF91c2VJZENsYXNzRnJvbVBhcmVudCA9IGZhbHNlOwog\nICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICBDbGFzczw/PiBwa1R5cGUgPSBwa01ldGEuZ2V0T2JqZWN0SWRUeXBl\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwa1R5cGUgPT0gT2Jq\nZWN0SWQuY2xhc3MpIC8vcGFyZW50IGlkIGlzIEVtYmVkZGVkSWQKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHBrVHlwZSA9IHBrTWV0YS5nZXRQcmlt\nYXJ5S2V5RmllbGRzKClbMF0uZ2V0VHlwZSgpOwogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAocGtUeXBlID09IF9vYmplY3RJZCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIF91c2VJZENsYXNzRnJvbVBhcmVudCA9IHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgRmllbGQgZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxk\nKF9vYmplY3RJZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncGtzWzBdLmdldE5hbWUoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGYgIT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX3VzZUlkQ2xhc3NGcm9tUGFyZW50ID0gZmFsc2U7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICJpbnZhbGlkLWlkIiwgX3R5cGUsIHBrc1swXS5nZXROYW1lKCkp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gX3VzZUlkQ2xhc3NGcm9tUGFyZW50LmJvb2xl\nYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUg\naWYgdGhpcyBjbGFzcyBoYXMgYSBjb25jcmV0ZSBwZXJzaXN0ZW50IHN1cGVy\nY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNDb25jcmV0\nZVBDU3VwZXJjbGFzcygpIHsKICAgICAgICBpZiAoX3N1cGVyID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIU1vZGlm\naWVyLmlzQWJzdHJhY3QoX3N1cGVyLmdldE1vZGlmaWVycygpKSAmJiAKICAg\nICAgICAJCSghZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5pc0Fic3RyYWN0\nKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5oYXNDb25jcmV0ZVBDU3VwZXJj\nbGFzcygpOwogICAgfQoKICAgIC8qKgogICAgICogRW5zdXJlIHRoYXQgdGhl\nIHVzZXIgaGFzIG92ZXJyaWRkZW4gdGhlIGVxdWFscyBhbmQgaGFzaENvZGUg\nbWV0aG9kcywKICAgICAqIGFuZCBoYXMgdGhlIHByb3BlciBjb25zdHJ1Y3Rv\ncnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xh\nc3NNZXRob2RzKENsYXNzPD8+IG9pZCkgewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIG9pZC5nZXRDb25zdHJ1Y3RvcigoQ2xhc3NbXSkgbnVsbCk7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWNvbnMi\nLCBvaWQsIF90eXBlKSkuCiAgICAgICAgICAgICAgICBzZXRDYXVzZShlKTsK\nICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGZvciBlcXVhbHMgYW5kIGhh\nc2hjb2RlIG92ZXJyaWRlczsgZG9uJ3QgZW5mb3JjZSBpdAogICAgICAgIC8v\nIGZvciBhYnN0cmFjdCBhcHBsaWNhdGlvbiBpZCBjbGFzc2VzLCBzaW5jZSB0\naGV5IG1heSBub3QgbmVjZXNzYXJpbHkKICAgICAgICAvLyBkZWNsYXJlIHBy\naW1hcnkga2V5IGZpZWxkcwogICAgICAgIE1ldGhvZCBtZXRob2Q7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgbWV0aG9kID0gb2lkLmdldE1ldGhvZCgi\nZXF1YWxzIiwgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihlKS5zZXRGYXRhbCh0cnVlKTsKICAgICAg\nICB9CgogICAgICAgIGJvb2xlYW4gYWJzID0gTW9kaWZpZXIuaXNBYnN0cmFj\ndChfdHlwZS5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgaWYgKCFhYnMgJiYg\nbWV0aG9kLmdldERlY2xhcmluZ0NsYXNzKCkgPT0gT2JqZWN0LmNsYXNzKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImVxLW1ldGhvZCIsIF90eXBlKSk7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIG1ldGhvZCA9IG9pZC5nZXRNZXRob2QoImhhc2hDb2RlIiwgKENs\nYXNzW10pIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpLnNl\ndEZhdGFsKHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoIWFicyAmJiBt\nZXRob2QuZ2V0RGVjbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xhc3MpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiaGMtbWV0aG9kIiwgX3R5cGUpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFZhbGlkYXRlIHRoYXQgdGhlIHByaW1hcnkga2V5IGNsYXNzIGhhcyBhbGwg\ncGsgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVB\ncHBJZENsYXNzUEtzKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcywgQ2xhc3M8Pz4gb2lkKSB7CiAgICAgICAgaWYg\nKGZtZHMubGVuZ3RoID09IDAgJiYgIU1vZGlmaWVyLmlzQWJzdHJhY3QobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkuCiAgICAgICAgICAgIGdldE1vZGlmaWVy\ncygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1wayIsIF90eXBlKSk7CgogICAgICAgIC8vIGNoZWNr\nIHRoYXQgdGhlIG9pZCB0eXBlIGNvbnRhaW5zIGFsbCBwayBmaWVsZHMKICAg\nICAgICBGaWVsZCBmOwogICAgICAgIE1ldGhvZCBtOwogICAgICAgIENsYXNz\nPD8+IGM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGMgPSBmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpLmdldENvbXBvbmVudFR5cGUoKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoYyA9PSBieXRlLmNsYXNzIHx8IGMgPT0gQnl0ZS5j\nbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBjID09IGNoYXIuY2xh\nc3MgfHwgYyA9PSBDaGFyYWN0ZXIuY2xhc3MpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJyZWFrCiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk9JRDogLy8gd2UncmUgdmFsaWRhdGluZyBlbWJlZGRl\nZCBmaWVsZHMKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1way10eXBlIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgZm1kc1tpXSkpOwogICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICBjID0gZm1kc1tpXS5nZXRPYmpl\nY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAoQWNjZXNzQ29kZS5pc0ZpZWxkKGZtZHNbaV0uZ2V0QWNjZXNzVHlwZSgp\nKSkgewogICAgICAgICAgICAgICAgZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxk\nKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGlmIChmID09IG51bGwgfHwgIWYuZ2V0VHlwZSgpLmlzQXNzaWduYWJs\nZUZyb20oYykpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpKSk7CiAg\nICAgICAgICAgIH0gZWxzZSBpZiAoQWNjZXNzQ29kZS5pc1Byb3BlcnR5KGZt\nZHNbaV0uZ2V0QWNjZXNzVHlwZSgpKSkgewogICAgICAgICAgICAgICAgbSA9\nIFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWQsIGZtZHNbaV0uZ2V0TmFtZSgp\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAobSA9PSBudWxsIHx8ICFt\nLmdldFJldHVyblR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKGMpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIF90\neXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAgICAgICAgICAgICAgbSA9\nIFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWQsIGZtZHNbaV0uZ2V0TmFtZSgp\nLAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVs\nZFR5cGUoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKG0gPT0gbnVs\nbCB8fCBtLmdldFJldHVyblR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIF90\neXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGlz\nIGNsYXNzIGRvZXNuJ3QgZGVjbGFyZSBhbnkgcHJpbWFyeSBrZXkgZmllbGRz\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVOb1BLRmllbGRz\nKCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXREZWNs\nYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmll\nbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlz\nUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGsiLCBmaWVsZHNbaV0pKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoaXMgY2xhc3Mn\nIGFjY2VzcyB0eXBlIGlzIGFsbG93ZWQuCiAgICAgKiBJZiBubyBhY2Nlc3Mg\nc3R5bGUgaXMgc2V0IG9yIGFuIGV4cGxpY2l0IHN0eWxlIGlzIHNldCByZXR1\ncm4uCiAgICAgKiBPdGhlcndpc2UsIGlmIHRoZSBzdXBlcmNsYXNzIGhhcyBw\nZXJzaXN0ZW50IGF0dHJpYnV0ZXMsICBjaGVjayB0aGF0IAogICAgICogdGhl\nIHN1cGVyY2xhc3MgYWNjZXNzIHN0eWxlLCBpZiBkZWZhdWx0ZWQsIGlzIHRo\nZSBzYW1lIGFzIHRoYXQgb2YgdGhpcyAKICAgICAqIHJlY2VpdmVyLiAKICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlQWNjZXNzVHlwZSgpIHsK\nICAgICAgICBpZiAoQWNjZXNzQ29kZS5pc0VtcHR5KF9hY2Nlc3NUeXBlKSAK\nICAgICAgICAgICB8fCBBY2Nlc3NDb2RlLmlzRXhwbGljaXQoX2FjY2Vzc1R5\ncGUpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIHdo\naWxlIChzdXAgIT0gbnVsbCAmJiBzdXAuaXNFeHBsaWNpdEFjY2VzcygpKQog\nICAgICAgIAlzdXAgPSBzdXAuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldERlY2xhcmVkRmll\nbGRzKCkubGVuZ3RoID4gMCkgewogICAgICAgIAlpbnQgc3VwQ29kZSA9IHN1\ncC5nZXRBY2Nlc3NUeXBlKCk7CiAgICAgICAgCWlmICghQWNjZXNzQ29kZS5p\nc0NvbXBhdGlibGVTdXBlcihfYWNjZXNzVHlwZSwgc3VwQ29kZSkpCiAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImFjY2Vzcy1pbmNvbnNpc3RlbnQtaW5oZXJpdCIsCiAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117dGhpcywgQWNjZXNzQ29kZS50b0NsYXNzU3RyaW5nKF9h\nY2Nlc3NUeXBlKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3VwLCBB\nY2Nlc3NDb2RlLnRvQ2xhc3NTdHJpbmcoc3VwQ29kZSl9KS50b1N0cmluZygp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhh\ndCBkZXRhY2htZW50IGNvbmZpZ3VyYXRpb24gaXMgdmFsaWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZURldGFjaGFibGUoKSB7CiAgICAg\nICAgYm9vbGVhbiBmaXJzdCA9IHRydWU7CiAgICAgICAgZm9yIChDbGFzc01l\ndGFEYXRhIHBhcmVudCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAg\nICAgICAgICAgIGZpcnN0ICYmIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBw\nYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAgICAgICB7CiAg\nICAgICAgICAgIGlmIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAg\nICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRmll\nbGQgZmllbGQgPSBnZXREZXRhY2hlZFN0YXRlRmllbGQoKTsKICAgICAgICBp\nZiAoZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIWZpcnN0KQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwYXJlbnQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAgICAg\nICAgICBfdHlwZSkpOwogICAgICAgICAgICBpZiAoZ2V0RmllbGQoZmllbGQu\nZ2V0TmFtZSgpKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJtYW5hZ2VkLWRldGFjaC1z\ndGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBf\ndHlwZSkpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZSgpICE9IE9i\namVjdC5jbGFzcykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaC1zdGF0ZSIsCiAgICAg\nICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlwZSkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZldGNo\nIEdyb3VwCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgZmV0Y2ggZ3JvdXBzIGRlY2xhcmVkIGV4cGxpY2l0bHkgaW4g\ndGhpcyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdl\ndERlY2xhcmVkRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYgKF9mZ3MgPT0g\nbnVsbCkKICAgICAgICAgICAgX2ZncyA9IChfZmdNYXAgPT0gbnVsbCkgPyBF\nTVBUWV9GRVRDSF9HUk9VUF9BUlJBWSA6IChGZXRjaEdyb3VwW10pCiAgICAg\nICAgICAgICAgICBfZmdNYXAudmFsdWVzKCkudG9BcnJheShuZXcgRmV0Y2hH\ncm91cFtfZmdNYXAuc2l6ZSgpXSk7IAogICAgICAgIHJldHVybiBfZmdzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmZXRjaCBncm91cHMg\nZm9yIHRoaXMgdHlwZSwgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZ3JvdXBzLgog\nICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldEN1c3RvbUZldGNo\nR3JvdXBzKCkgewogICAgICAgIGlmIChfY3VzdG9tRkdzID09IG51bGwpIHsK\nICAgICAgICAgICAgLy8gbWFwIGZldGNoIGdyb3VwcyB0byBuYW1lcywgYWxs\nb3dpbmcgb3VyIGdyb3VwcyB0byBvdmVycmlkZSBzdXBlcgogICAgICAgICAg\nICBNYXA8U3RyaW5nLEZldGNoR3JvdXA+IGZncyA9IG5ldyBIYXNoTWFwPFN0\ncmluZyxGZXRjaEdyb3VwPigpOwogICAgICAgICAgICBDbGFzc01ldGFEYXRh\nIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAg\nIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAg\nICAgRmV0Y2hHcm91cFtdIHN1cEZHcyA9IHN1cC5nZXRDdXN0b21GZXRjaEdy\nb3VwcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ndXBGR3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZmdzLnB1\ndChzdXBGR3NbaV0uZ2V0TmFtZSgpLCBzdXBGR3NbaV0pOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIEZldGNoR3JvdXBbXSBkZWNzID0gZ2V0RGVjbGFy\nZWRGZXRjaEdyb3VwcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGRlY3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBmZ3MucHV0\nKGRlY3NbaV0uZ2V0TmFtZSgpLCBkZWNzW2ldKTsKICAgICAgICAgICAgCiAg\nICAgICAgICAgIC8vIHJlbW92ZSBzdGFuZGFyZCBncm91cHMKICAgICAgICAg\nICAgZmdzLnJlbW92ZShGZXRjaEdyb3VwLk5BTUVfREVGQVVMVCk7CiAgICAg\nICAgICAgIGZncy5yZW1vdmUoRmV0Y2hHcm91cC5OQU1FX0FMTCk7CgogICAg\nICAgICAgICBfY3VzdG9tRkdzID0gKEZldGNoR3JvdXBbXSkgZmdzLnZhbHVl\ncygpLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgRmV0Y2hHcm91cFtm\nZ3Muc2l6ZSgpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY3VzdG9t\nRkdzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyBhIG5hbWVkIGZldGNo\nIGdyb3VwLiBJZiBub3QgYXZhaWxhYmxlIGluIHRoaXMgcmVjZWl2ZXIgdGhl\nbiBsb29rcwogICAgICogdXAgdGhlIGluaGVyaXRhbmNlIGhpZXJhcmNoeS4g\nCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgbmFtZSBvZiBhIGZldGNoIGdy\nb3VwLgogICAgICogQHJldHVybiBhbiBleGlzdGluZyBmZXRjaCBncm91cCBv\nZiB0aGUgZ2l2ZW4gbmFtZSBpZiBrbm93biB0byB0aGlzIAogICAgICogcmVj\nZWl2ZXIgb3IgYW55IG9mIGl0cyBzdXBlcmNsYXNzZXMuIE90aGVyd2lzZSBu\ndWxsLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBnZXRGZXRjaEdy\nb3VwKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IChf\nZmdNYXAgPT0gbnVsbCkgPyBudWxsIDogKEZldGNoR3JvdXApIF9mZ01hcC5n\nZXQobmFtZSk7CiAgICAgICAgaWYgKGZnICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBmZzsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gc3VwLmdldEZldGNoR3JvdXAobmFtZSk7\nCiAgICAgICAgaWYgKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxULmVxdWFscyhu\nYW1lKSkKICAgICAgICAgICAgcmV0dXJuIEZldGNoR3JvdXAuREVGQVVMVDsK\nICAgICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0FMTC5lcXVhbHMobmFtZSkp\nCiAgICAgICAgICAgIHJldHVybiBGZXRjaEdyb3VwLkFMTDsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgZmV0Y2gg\nZ3JvdXAgb2YgdGhlIGdpdmVuIG5hbWUsIG9yIHJldHVybnMgZXhpc3Rpbmcg\naW5zdGFuY2UuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgYSBub24tbnVs\nbCwgbm9uLWVtcHR5IG5hbWUuIE11c3QgYmUgdW5pcXVlIHdpdGhpbiB0aGlz\nCiAgICAgKiByZWNlaXZlcidzIHNjb3BlLiBUaGUgc3VwZXIgY2xhc3MgPGVt\nPm1heTwvZW0+IGhhdmUgYSBncm91cCB3aXRoCiAgICAgKiB0aGUgc2FtZSBu\nYW1lLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBhZGREZWNsYXJl\nZEZldGNoR3JvdXAoU3RyaW5nIG5hbWUpIHsKICAgIAlpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShuYW1lKSkKICAgIAkJdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJlbXB0eS1mZy1uYW1lIiwgdGhpcykpOwogICAg\nICAgIGlmIChfZmdNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX2ZnTWFwID0g\nbmV3IEhhc2hNYXA8U3RyaW5nLEZldGNoR3JvdXA+KCk7CiAgICAgICAgRmV0\nY2hHcm91cCBmZyA9IChGZXRjaEdyb3VwKSBfZmdNYXAuZ2V0KG5hbWUpOwog\nICAgICAgIGlmIChmZyA9PSBudWxsKSB7CiAgICAgICAgCWZnID0gbmV3IEZl\ndGNoR3JvdXAodGhpcywgbmFtZSk7CiAgICAgICAgCV9mZ01hcC5wdXQobmFt\nZSwgZmcpOwogICAgICAgICAgICBfZmdzID0gbnVsbDsKICAgICAgICAgICAg\nX2N1c3RvbUZHcyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBm\nZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIGRlY2xhcmVkIGZl\ndGNoIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVE\nZWNsYXJlZEZldGNoR3JvdXAoRmV0Y2hHcm91cCBmZykgewogICAgICAgIGlm\nIChmZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgaWYgKF9mZ01hcC5yZW1vdmUoZmcuZ2V0TmFtZSgpKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIF9mZ3MgPSBudWxsOwogICAgICAgICAgICBfY3VzdG9t\nRkdzID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gU291cmNlVHJhY2tlcgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAg\nICAgIHJldHVybiBfc3JjRmlsZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldFNvdXJjZVNjb3BlKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgZ2V0U291cmNlVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gX3NyY1R5cGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U291\ncmNlKEZpbGUgZmlsZSwgaW50IHNyY1R5cGUpIHsKICAgICAgICBfc3JjRmls\nZSA9IGZpbGU7CiAgICAgICAgX3NyY1R5cGUgPSBzcmNUeXBlOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVzb3VyY2VOYW1lKCkgewogICAgICAg\nIHJldHVybiBfdHlwZS5nZXROYW1lKCk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBpbnQgZ2V0TGluZU51bWJlcigpIHsKICAgICAgICByZXR1cm4gX2xpbmVO\ndW07CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TGluZU51bWJlcihpbnQg\nbGluZU51bSkgewogICAgICAgIF9saW5lTnVtID0gbGluZU51bTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGdldENvbE51bWJlcigpIHsKICAgICAgICByZXR1\ncm4gX2NvbE51bTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb2xOdW1i\nZXIoaW50IGNvbE51bSkgewogICAgICAgIF9jb2xOdW0gPSBjb2xOdW07CiAg\nICB9CiAgICAKCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlz\nIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAg\ncHVibGljIGludCBnZXRTb3VyY2VNb2RlKCkgewogICAgICAgIHJldHVybiBf\nc3JjTW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9k\nZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSkgewog\nICAgICAgIF9zcmNNb2RlID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRl\nZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9k\nZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChtb2RlID09\nIE1PREVfTk9ORSkKICAgICAgICAgICAgX3NyY01vZGUgPSBtb2RlOwogICAg\nICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfc3JjTW9kZSB8PSBtb2Rl\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3NyY01vZGUgJj0gfm1vZGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhp\ncyBjbGFzcyB3YXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMg\ndG8KICAgICAqIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBu\nb3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRMaXN0aW5nSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9saXN0\nSW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4gd2hp\nY2ggdGhpcyBmaWVsZCB3YXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4gRGVm\nYXVsdHMgdG8KICAgICAqIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNz\nIHdhcyBub3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0TGlzdGluZ0luZGV4KGludCBpbmRleCkgewogICAg\nICAgIF9saXN0SW5kZXggPSBpbmRleDsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIENvbW1lbnRhYmxlCiAgICAvLy8vLy8vLy8vLy8vLy8K\nCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q29tbWVudHMoKSB7CiAgICAgICAg\ncmV0dXJuIChfY29tbWVudHMgPT0gbnVsbCkgPyBFTVBUWV9DT01NRU5UUyA6\nIF9jb21tZW50czsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb21tZW50\ncyhTdHJpbmdbXSBjb21tZW50cykgewogICAgICAgIF9jb21tZW50cyA9IGNv\nbW1lbnRzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBTdGF0\nZSBjb3B5CiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQ29w\neSB0aGUgbWV0YWRhdGEgZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhp\ncyBvbmUuIERvIG5vdAogICAgICogY29weSBtYXBwaW5nIGluZm9ybWF0aW9u\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjb3B5KENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSAh\nPSBfdHlwZSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKCk7CiAgICAgICAgc3VwZXIuY29weShtZXRhKTsKCiAgICAgICAgLy8g\nY29weSBjbGFzcy1sZXZlbCBpbmZvOyB1c2UgZ2V0IG1ldGhvZHMgdG8gZm9y\nY2UgcmVzb2x1dGlvbiBvZgogICAgICAgIC8vIGxhenkgZGF0YQogICAgICAg\nIF9zdXBlciA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzKCk7CiAgICAgICAgX29i\namVjdElkID0gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBfZXh0\nZW50ID0gKG1ldGEuZ2V0UmVxdWlyZXNFeHRlbnQoKSkgPyBCb29sZWFuLlRS\nVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgIF9lbWJlZGRlZCA9IChtZXRh\nLmlzRW1iZWRkZWRPbmx5KCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRTsKICAgICAgICBfZW1iZWRkYWJsZSA9IG1ldGEuX2VtYmVkZGFibGU7\nCiAgICAgICAgX2ludGVyZmFjZSA9IChtZXRhLmlzTWFuYWdlZEludGVyZmFj\nZSgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nc2V0SW50ZXJjZXB0aW5nKG1ldGEuaXNJbnRlcmNlcHRpbmcoKSk7CiAgICAg\nICAgX2ltcGwgPSBtZXRhLmdldEludGVyZmFjZUltcGwoKTsKICAgICAgICBf\naWRlbnRpdHkgPSBtZXRhLmdldElkZW50aXR5VHlwZSgpOwogICAgICAgIF9p\nZFN0cmF0ZWd5ID0gbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5KCk7CiAgICAg\nICAgX3NlcU5hbWUgPSBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VOYW1lKCk7\nCiAgICAgICAgX3NlcU1ldGEgPSBudWxsOwogICAgICAgIF9hbGlhcyA9IG1l\ndGEuZ2V0VHlwZUFsaWFzKCk7CiAgICAgICAgX2FjY2Vzc1R5cGUgPSBtZXRh\nLmdldEFjY2Vzc1R5cGUoKTsKCiAgICAgICAgLy8gb25seSBjb3B5IHRoaXMg\naW5mb3JtYXRpb24gaWYgaXQgd2Fzbid0IHNldCBleHBsaWNpdGx5IGZvciB0\naGlzCiAgICAgICAgLy8gaW5zdGFuY2UKICAgICAgICBpZiAoREVGQVVMVF9T\nVFJJTkcuZXF1YWxzKF9jYWNoZU5hbWUpKQogICAgICAgICAgICBfY2FjaGVO\nYW1lID0gbWV0YS5nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgaWYgKF9j\nYWNoZVRpbWVvdXQgPT0gSW50ZWdlci5NSU5fVkFMVUUpCiAgICAgICAgICAg\nIF9jYWNoZVRpbWVvdXQgPSBtZXRhLmdldERhdGFDYWNoZVRpbWVvdXQoKTsK\nICAgICAgICBfY2FjaGVFbmFibGVkID0gbWV0YS5nZXRDYWNoZUVuYWJsZWQo\nKTsKICAgICAgICBfZGF0YUNhY2hlRW5hYmxlZCA9IG1ldGEuZ2V0RGF0YUNh\nY2hlRW5hYmxlZCgpOwogICAgICAgIGlmIChfZGV0YWNoYWJsZSA9PSBudWxs\nKQogICAgICAgICAgICBfZGV0YWNoYWJsZSA9IG1ldGEuX2RldGFjaGFibGU7\nCiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVxdWFscyhfZGV0YWNoU3Rh\ndGUpKQogICAgICAgICAgICBfZGV0YWNoU3RhdGUgPSBtZXRhLmdldERldGFj\naGVkU3RhdGUoKTsKCiAgICAgICAgLy8gc3luY2ggZmllbGQgaW5mb3JtYXRp\nb247IGZpcnN0IHJlbW92ZSBleHRyYSBmaWVsZHMKICAgICAgICBjbGVhckZp\nZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRNYXAua2V5U2V0KCkucmV0YWlu\nQWxsKG1ldGEuX2ZpZWxkTWFwLmtleVNldCgpKTsKCiAgICAgICAgLy8gYWRk\nIGNvcGllcyBvZiBkZWNsYXJlZCBmaWVsZHM7IG90aGVyIGRlZmluZWQgZmll\nbGRzIGFscmVhZHkgY29waWVkCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZp\nZWxkcyA9IG1ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZpZWxkOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZpZWxkID0gZ2V0\nRGVjbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgaWYgKGZpZWxkID09IG51bGwpCiAgICAgICAgICAgICAgICBmaWVsZCA9\nIGFkZERlY2xhcmVkRmllbGQoZmllbGRzW2ldLmdldE5hbWUoKSwKICAgICAg\nICAgICAgICAgICAgICBmaWVsZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwog\nICAgICAgICAgICBmaWVsZC5zZXREZWNsYXJlZEluZGV4KC0xKTsKICAgICAg\nICAgICAgZmllbGQuc2V0SW5kZXgoLTEpOwogICAgICAgICAgICBmaWVsZC5j\nb3B5KGZpZWxkc1tpXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBjb3B5IGZl\ndGNoIGdyb3VwcwogICAgICAgIEZldGNoR3JvdXBbXSBmZ3MgPSBtZXRhLmdl\ndERlY2xhcmVkRmV0Y2hHcm91cHMoKTsKICAgICAgICBGZXRjaEdyb3VwIGZn\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmdzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGZnID0gYWRkRGVjbGFyZWRGZXRjaEdyb3VwKGZn\nc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBmZy5jb3B5KGZnc1tpXSk7\nIAogICAgICAgIH0KCiAgICAgICAgLy8gY29weSBpbnRlcmZhY2UgcmUtbWFw\ncGluZwogICAgICAgIF9pZmFjZU1hcC5jbGVhcigpOwogICAgICAgIF9pZmFj\nZU1hcC5wdXRBbGwobWV0YS5faWZhY2VNYXApOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVjdXJzaXZlIGhlbHBlciB0byBjb3B5IGVtYmVkZGVkIG1ldGFk\nYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGNvcHkoQ2xh\nc3NNZXRhRGF0YSBlbWJlZCwgQ2xhc3NNZXRhRGF0YSBkZWMpIHsKICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGRlYy5nZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAgICAg\nICBlbWJlZC5zZXRQQ1N1cGVyY2xhc3Moc3VwLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICAgICAgICAgIGNvcHkoZW1iZWQuZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKSwgc3VwKTsKICAgICAgICB9CiAgICAgICAgZW1iZWQuY29weShk\nZWMpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZEV4dGVuc2lvbktl\neXMoQ29sbGVjdGlvbiBleHRzKSB7CiAgICAgICAgX3JlcG9zLmdldE1ldGFE\nYXRhRmFjdG9yeSgpLmFkZENsYXNzRXh0ZW5zaW9uS2V5cyhleHRzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbXBhcmF0b3IgdXNlZCB0byBwdXQgZmll\nbGQgbWV0YWRhdGEgaW50byBsaXN0aW5nIG9yZGVyLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBMaXN0aW5nT3JkZXJDb21wYXJhdG9yCiAg\nICAgICAgaW1wbGVtZW50cyBDb21wYXJhdG9yPEZpZWxkTWV0YURhdGE+IHsK\nCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTGlzdGluZ09yZGVyQ29t\ncGFyYXRvciBfaW5zdGFuY2UKICAgICAgICAgICAgPSBuZXcgTGlzdGluZ09y\nZGVyQ29tcGFyYXRvcigpOwoKICAgICAgICAvKioKICAgICAgICAgKiBBY2Nl\nc3Mgc2luZ2xldG9uIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyBzdGF0aWMgTGlzdGluZ09yZGVyQ29tcGFyYXRvciBnZXRJbnN0YW5j\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShGaWVsZE1ldGFEYXRhIGYx\nLCBGaWVsZE1ldGFEYXRhIGYyKSB7CiAgICAgICAgICAgIGlmIChmMSA9PSBm\nMikKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICBpZiAo\nZjEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAg\nICAgICBpZiAoZjIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAt\nMTsKCiAgICAgICAgICAgIGlmIChmMS5nZXRMaXN0aW5nSW5kZXgoKSA9PSBm\nMi5nZXRMaXN0aW5nSW5kZXgoKSkgewogICAgICAgICAgICAgICAgaWYgKGYx\nLmdldEluZGV4KCkgPT0gZjIuZ2V0SW5kZXgoKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZjEuZ2V0RnVsbE5hbWUoZmFsc2UpLmNvbXBhcmVUbwog\nICAgICAgICAgICAgICAgICAgICAgICAoZjIuZ2V0RnVsbE5hbWUoZmFsc2Up\nKTsKCQkJCWlmIChmMS5nZXRJbmRleCAoKSA9PSAtMSkKCQkJCQlyZXR1cm4g\nMTsKCQkJCWlmIChmMi5nZXRJbmRleCAoKSA9PSAtMSkKCQkJCQlyZXR1cm4g\nLTE7CgkJCQlyZXR1cm4gZjEuZ2V0SW5kZXggKCkgLSBmMi5nZXRJbmRleCAo\nKTsKCQkJfQkKCQkJaWYgKGYxLmdldExpc3RpbmdJbmRleCAoKSA9PSAtMSkK\nCQkJCXJldHVybiAxOwoJCQlpZiAoZjIuZ2V0TGlzdGluZ0luZGV4ICgpID09\nIC0xKQoJCQkJcmV0dXJuIC0xOwoJCQlyZXR1cm4gZjEuZ2V0TGlzdGluZ0lu\nZGV4ICgpIC0gZjIuZ2V0TGlzdGluZ0luZGV4ICgpOwoJCX0KCX0KICAgIAog\nICAgcHVibGljIHZvaWQgcmVnaXN0ZXJGb3JWYWx1ZVVwZGF0ZShTdHJpbmcu\nLi52YWx1ZXMpIHsKICAgIAlpZiAodmFsdWVzID09IG51bGwpCiAgICAJCXJl\ndHVybjsKICAgIAlmb3IgKFN0cmluZyBrZXkgOiB2YWx1ZXMpIHsKICAgIAkJ\nVmFsdWUgdmFsdWUgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlv\nbigpCiAgICAJCQkuZ2V0VmFsdWUoa2V5KTsKICAgIAkJaWYgKHZhbHVlICE9\nIG51bGwpCiAgICAJCQl2YWx1ZS5hZGRMaXN0ZW5lcih0aGlzKTsKICAgIAl9\nCiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHZhbHVlQ2hhbmdlZChWYWx1\nZSB2YWwpIHsKICAgIAlpZiAodmFsICE9IG51bGwgJiYgdmFsLm1hdGNoZXMo\nIkRhdGFDYWNoZVRpbWVvdXQiKSkgewogICAgCQlfY2FjaGVUaW1lb3V0ID0g\nSW50ZWdlci5NSU5fVkFMVUU7CiAgICAJfQogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFV0aWxpdHkgbWV0aG9kIHRvIGdldCBuYW1lcyBvZiBhbGwgZmll\nbGRzIGluY2x1ZGluZyB0aGUgc3VwZXJjbGFzc2VzJwogICAgICogc29ydGVk\nIGluIGxleGljYWwgb3JkZXIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXRGaWVsZE5hbWVzKCkgewogICAgCXJldHVybiB0b05hbWVzKGdldEZp\nZWxkcygpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBVdGlsaXR5IG1l\ndGhvZCB0byBnZXQgbmFtZXMgb2YgYWxsIGRlY2xhcmVkIGZpZWxkcyBleGNs\ndWRpbmcgdGhlIAogICAgICogc3VwZXJjbGFzc2VzJyBzb3J0ZWQgaW4gbGV4\naWNhbCBvcmRlci4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERl\nY2xhcmVkRmllbGROYW1lcygpIHsKICAgIAlyZXR1cm4gdG9OYW1lcyhnZXRE\nZWNsYXJlZEZpZWxkcygpKTsKICAgIH0KICAgIAogICAgU3RyaW5nW10gdG9O\nYW1lcyhGaWVsZE1ldGFEYXRhW10gZmllbGRzKSB7CiAgICAJTGlzdDxTdHJp\nbmc+IHJlc3VsdCA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgCWZv\nciAoRmllbGRNZXRhRGF0YSBmbWQgOiBmaWVsZHMpIHsKICAgIAkJcmVzdWx0\nLmFkZChmbWQuZ2V0TmFtZSgpKTsKICAgIAl9CiAgICAJQ29sbGVjdGlvbnMu\nc29ydChyZXN1bHQpOwogICAgCXJldHVybiByZXN1bHQudG9BcnJheShuZXcg\nU3RyaW5nW3Jlc3VsdC5zaXplKCldKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBBZmZpcm1zIHRoZSBwZXJzaXN0ZW5jZSBpbnN0YW5jZXMgb2YgdGhp\ncyByZWNlaXZlciBpcyByZXBsaWNhdGVkIGFjcm9zcwogICAgICogbXVsdGlw\nbGUgZGF0YWJhc2VzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1Jl\ncGxpY2F0ZWQoKSB7CiAgICAJcmV0dXJuIF9yZXBsaWNhdGVkOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIFNldHMgdGhlIHBlcnNpc3RlbmNlIGluc3Rh\nbmNlcyBvZiB0aGlzIHJlY2VpdmVyIHRvIGJlIHJlcGxpY2F0ZWQgYWNyb3Nz\nCiAgICAgKiBtdWx0aXBsZSBkYXRhYmFzZXMuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFJlcGxpY2F0ZWQoYm9vbGVhbiBmbGFnKSB7CiAgICAJX3Jl\ncGxpY2F0ZWQgPSBmbGFnOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nQWJzdHJhY3QoKSB7CiAgICAgICAgcmV0dXJuIF9hYnN0cmFjdDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRBYnN0cmFjdChib29sZWFuIGZsYWcpIHsK\nICAgICAgICBfYWJzdHJhY3QgPSBmbGFnOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIGRldGVybWluZSBpZiB0aGUgcGNU\neXBlIG1vZGVsZWQgYnkKICAgICAqIHRoaXMgQ2xhc3NNZXRhRGF0YSBvYmpl\nY3QgaXMgYm90aCBhYnN0cmFjdCBhbmQgZGVjbGFyZXMgUEtGaWVsZHMuIFRo\naXMKICAgICAqIG1ldGhvZCBpcyB1c2VkIGJ5IHRoZSBQQ0VuaGFuY2VyIHRv\nIGRldGVybWluZSBpZiBzcGVjaWFsIGhhbmRsaW5nIGlzCiAgICAgKiByZXF1\naXJlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGhhc0Fic3RyYWN0UEtGaWVsZCgpIHsKICAgICAgICBpZiAo\nX2hhc0Fic3RyYWN0UEtGaWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfaGFzQWJzdHJhY3RQS0ZpZWxkLmJvb2xlYW5WYWx1ZSgpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gRGVmYXVsdCB0byBmYWxzZSwgc2V0IHRvIHRy\ndWUgb25seSBpZiB0aGlzIHR5cGUgaXMgYWJzdHJhY3QgYW5kCiAgICAgICAg\nLy8gZGVjbGFyZXMgYSBQS0ZpZWxkLgogICAgICAgIF9oYXNBYnN0cmFjdFBL\nRmllbGQgPSBCb29sZWFuLkZBTFNFOwoKICAgICAgICBpZiAoaXNBYnN0cmFj\ndCgpID09IHRydWUpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRl\nY2xhcmVkRmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAg\nICAgaWYgKGRlY2xhcmVkRmllbGRzICE9IG51bGwgJiYgZGVjbGFyZWRGaWVs\nZHMubGVuZ3RoICE9IDApIHsKICAgICAgICAgICAgICAgIGZvciAoRmllbGRN\nZXRhRGF0YSBmbWQgOiBkZWNsYXJlZEZpZWxkcykgewogICAgICAgICAgICAg\nICAgICAgIGlmIChmbWQuaXNQcmltYXJ5S2V5KCkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgX2hhc0Fic3RyYWN0UEtGaWVsZCA9IEJvb2xlYW4uVFJV\nRTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICByZXR1cm4gX2hhc0Fic3RyYWN0UEtGaWVsZC5i\nb29sZWFuVmFsdWUoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDb252\nZW5pZW5jZSBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIHRoaXMgdHlwZSBpcyBh\nIGRpcmVjdAogICAgICogZGVjZW5kZW50IG9mIGFuIGFic3RyYWN0IHR5cGUg\nZGVjbGFyaW5nIFBLRmllbGRzLiBSZXR1cm5zIHRydWUgaWYgdGhlcmUKICAg\nICAqIGFyZSBubyBwY1R5cGVzIG1hcHBlZCB0byBhIHRhYmxlIGJldHdlZW4g\ndGhpcyB0eXBlIGFuZCBhbiBhYnN0cmFjdCBwY1R5cGUKICAgICAqIGRlY2xh\ncmluZyBQS0ZpZWxkcy4gUmV0dXJucyBmYWxzZSBpZiB0aGVyZSBubyBzdWNo\nIGFic3RyYWN0IHBjVHlwZXMgaW4KICAgICAqIHRoZSBpbmhlcml0YW5jZSBo\naWVyYXJjaHkgb3IgaWYgdGhlcmUgYXJlIGFueSBwY1R5cGVzIG1hcHBlZCB0\nbyB0YWJsZXMgaW4KICAgICAqIGJldHdlZW4gdGhlIHR5cGUgcmVwcmVzZW50\nZWQgYnkgdGhpcyBDbGFzc01ldGFEYXRhIG9iamVjdCBhbmQgdGhlCiAgICAg\nKiBhYnN0cmFjdCBwY1R5cGUgZGVjbGFyaW5nIFBLRmllbGRzLgogICAgICoK\nICAgICAqIEByZXR1cm4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaGFz\nUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFzcygpIHsKICAgICAgICBpZiAoX2hh\nc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3MgIT0gbnVsbCkgewogICAgICAg\nICAgICByZXR1cm4gX2hhc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3MuYm9v\nbGVhblZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBEZWZhdWx0IHRv\nIEZBTFNFLCB1bnRpbCBwcm92ZW4gdHJ1ZS4KICAgICAgICBfaGFzUEtGaWVs\nZHNGcm9tQWJzdHJhY3RDbGFzcyA9IEJvb2xlYW4uRkFMU0U7CgogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBwa0ZpZWxkcyA9IGdldFByaW1hcnlLZXlGaWVs\nZHMoKTsKICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogcGtGaWVs\nZHMpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBmbWRETURBID0gZm1k\nLmdldERlY2xhcmluZ01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChmbWRE\nTURBLmlzQWJzdHJhY3QoKSkgewogICAgICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBjbWQgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAg\nICAgICAgICAgd2hpbGUgKGNtZCAhPSBmbWRETURBKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGZtZERNREEuaXNBYnN0cmFjdCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNtZCA9IGNtZC5nZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjbWQgPT0g\nZm1kRE1EQSkgewogICAgICAgICAgICAgICAgICAgIF9oYXNQS0ZpZWxkc0Zy\nb21BYnN0cmFjdENsYXNzID0gQm9vbGVhbi5UUlVFOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2hhc1BLRmllbGRzRnJvbUFi\nc3RyYWN0Q2xhc3MuYm9vbGVhblZhbHVlKCk7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogU2V0cyB0aGUgZWxpZ2liaWxpdHkgc3RhdHVzIG9mIHRoaXMg\nY2xhc3MgZm9yIGNhY2hlLgogICAgICogCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldENhY2hlRW5hYmxlZChib29sZWFuIGVuYWJsZWQpIHsgCiAgICAg\nICAgX2NhY2hlRW5hYmxlZCA9IGVuYWJsZWQ7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogUmV0dXJucyB0cmktc3RhdGUgc3RhdHVzIG9uIHdoZXRoZXIg\ndGhpcyBjbGFzcyBoYXMgYmVlbiBlbmFibGVkIGZvciBjYWNoaW5nLgogICAg\nICogCiAgICAgKiBAcmV0dXJuIFRSVUUgb3IgRkFMU0UgZGVub3RlIHRoaXMg\nY2xhc3MgaGFzIGJlZW4gZXhwbGljaXRseSBlbmFibGVkIG9yIGRpc2FibGVk\nIGZvciBjYWNoaW5nLgogICAgICogSWYgbm8gc3RhdHVzIGhhcyBiZWVuIGV4\ncGxpY2l0bHkgc2V0LCB0aGVuIHRoZSBzdGF0dXMgb2YgdGhlIHBlcnNpc3Rl\nbnQgc3VwZXIgY2xhc3MsIGlmIGFueSwgaXMgcmV0dXJuZWQuIAogICAgICov\nCiAgICBwdWJsaWMgQm9vbGVhbiBnZXRDYWNoZUVuYWJsZWQoKSB7IAogICAg\nICAgIGlmIChfY2FjaGVFbmFibGVkICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBfY2FjaGVFbmFibGVkOwogICAgICAgIHJldHVybiBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpICE9IG51bGwgPyAgZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKS5nZXRDYWNoZUVuYWJsZWQoKSA6IG51bGw7IAogICAgfQp9Cgo=\n","encoding":"base64"}

