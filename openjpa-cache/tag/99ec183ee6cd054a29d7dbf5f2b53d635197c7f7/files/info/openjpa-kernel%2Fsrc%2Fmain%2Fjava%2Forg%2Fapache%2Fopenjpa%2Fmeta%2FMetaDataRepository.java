{"sha":"ab63ae71891224d7da4f5b0840ad86682b3c1185","node_id":"MDQ6QmxvYjIwNjM2NDphYjYzYWU3MTg5MTIyNGQ3ZGE0ZjViMDg0MGFkODY2ODJiM2MxMTg1","size":95579,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ab63ae71891224d7da4f5b0840ad86682b3c1185","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLlRyZWVTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkR5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3Ry\neS5SZWdpc3RlckNsYXNzTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3NlYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTXVsdGlDbGFz\nc0xvYWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlN0\ncmluZ0Rpc3RhbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklu\ndGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5PcGVuSlBBSWQ7CgppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7\nCgovKioKICogUmVwb3NpdG9yeSBvZiBhbmQgZmFjdG9yeSBmb3IgcGVyc2lz\ndGVudCBtZXRhZGF0YS4KICogCiAqIEBzaW5jZSAwLjMuMAogKiBAYXV0aG9y\nIEFiZSBXaGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbSAocXVlcnkgbWV0YWRh\ndGEpCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNs\nYXNzIE1ldGFEYXRhUmVwb3NpdG9yeSBpbXBsZW1lbnRzIFBDUmVnaXN0cnku\nUmVnaXN0ZXJDbGFzc0xpc3RlbmVyLCBDb25maWd1cmFibGUsIENsb3NlYWJs\nZSwgTWV0YURhdGFNb2RlcywKICAgIFNlcmlhbGl6YWJsZSB7CgogICAgLyoq\nCiAgICAgKiBDb25zdGFudCB0byBub3QgdmFsaWRhdGUgYW55IG1ldGFkYXRh\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFU\nRV9OT05FID0gMDsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlk\nYXRlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBWQUxJREFURV9NRVRBID0gMTsKCiAgICAvKioKICAgICAqIEJpdCBm\nbGFnIHRvIHZhbGlkYXRlIG1hcHBpbmdzLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9NQVBQSU5HID0gMjsKCiAgICAv\nKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlkYXRlIHVuZW5oYW5jZWQgbWV0\nYWRhdGEgb25seS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgVkFMSURBVEVfVU5FTkhBTkNFRCA9IDQ7CgogICAgLyoqCiAgICAgKiBC\naXQgZmxhZyBmb3IgcnVudGltZSB2YWxpZGF0aW9uLiBSZXF1aXJlcyB0aGF0\nIGFsbCBjbGFzc2VzIGFyZSBlbmhhbmNlZCwgYW5kIHBlcmZvcm1zIGV4dHJh\nCiAgICAgKiBmaWVsZCByZXNvbHV0aW9uIHN0ZXBzLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9SVU5USU1FID0gODsK\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIENsYXNzPD8+W10gRU1QVFlf\nQ0xBU1NFUyA9IG5ldyBDbGFzc1swXTsKICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gRU1QVFlfTk9OX1BFUlNJ\nU1RFTlQgPSBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhWzBdOwogICAgcHJv\ndGVjdGVkIGZpbmFsIENsYXNzTWV0YURhdGFbXSBFTVBUWV9NRVRBUzsKICAg\nIHByb3RlY3RlZCBmaW5hbCBGaWVsZE1ldGFEYXRhW10gRU1QVFlfRklFTERT\nOwogICAgcHJvdGVjdGVkIGZpbmFsIE9yZGVyW10gRU1QVFlfT1JERVJTOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9j\nYWxpemVyLmZvclBhY2thZ2UoTWV0YURhdGFSZXBvc2l0b3J5LmNsYXNzKTsK\nCiAgICAvLyBzeXN0ZW0gc2VxdWVuY2UKICAgIHByaXZhdGUgU2VxdWVuY2VN\nZXRhRGF0YSBfc3lzU2VxID0gbnVsbDsKICAgIC8vIGNhY2hlIG9mIHBhcnNl\nZCBtZXRhZGF0YSwgb2lkIGNsYXNzIHRvIGNsYXNzLCBhbmQgaW50ZXJmYWNl\nIGNsYXNzCiAgICAvLyB0byBtZXRhZGF0YXMKICAgIHByaXZhdGUgTWFwPENs\nYXNzPD8+LCBDbGFzc01ldGFEYXRhPiBfbWV0YXMgPSBuZXcgSGFzaE1hcDxD\nbGFzczw/PiwgQ2xhc3NNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPENs\nYXNzPD8+LCBDbGFzczw/Pj4gX29pZHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJv\nbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNzPD8+PigpKTsK\nICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBDb2xsZWN0aW9uPENsYXNzPD8+\nPj4gX2ltcGxzID0KICAgICAgICBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRN\nYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENvbGxlY3Rpb248Q2xhc3M8Pz4+\nPigpKTsKICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBDbGFzczw/Pj4gX2lm\nYWNlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1h\ncDxDbGFzczw/PiwgQ2xhc3M8Pz4+KCkpOwogICAgcHJpdmF0ZSBNYXA8T2Jq\nZWN0LCBRdWVyeU1ldGFEYXRhPiBfcXVlcmllcyA9IG5ldyBIYXNoTWFwPE9i\namVjdCwgUXVlcnlNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPFN0cmlu\nZywgU2VxdWVuY2VNZXRhRGF0YT4gX3NlcXMgPSBuZXcgSGFzaE1hcDxTdHJp\nbmcsIFNlcXVlbmNlTWV0YURhdGE+KCk7CiAgICBwcml2YXRlIE1hcDxTdHJp\nbmcsIExpc3Q8Q2xhc3M8Pz4+PiBfYWxpYXNlcyA9IENvbGxlY3Rpb25zLnN5\nbmNocm9uaXplZE1hcChuZXcgSGFzaE1hcDxTdHJpbmcsIExpc3Q8Q2xhc3M8\nPz4+PigpKTsKICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBOb25QZXJzaXN0\nZW50TWV0YURhdGE+IF9wYXdhcmVzID0KICAgICAgICBDb2xsZWN0aW9ucy5z\neW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE5vblBlcnNp\nc3RlbnRNZXRhRGF0YT4oKSk7CiAgICBwcml2YXRlIE1hcDxDbGFzczw/Piwg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhPiBfbm9uTWFwcGVkID0KICAgICAgICBD\nb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8\nPz4sIE5vblBlcnNpc3RlbnRNZXRhRGF0YT4oKSk7CiAgICBwcml2YXRlIE1h\ncDxDbGFzczw/PiwgQ2xhc3M8Pz4+IF9tZXRhbW9kZWwgPSBDb2xsZWN0aW9u\ncy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNz\nPD8+PigpKTsKCiAgICAvLyBtYXAgb2YgY2xhc3NlcyB0byBsaXN0cyBvZiB0\naGVpciBzdWJjbGFzc2VzCiAgICBwcml2YXRlIE1hcDxDbGFzczw/PiwgTGlz\ndDxDbGFzczw/Pj4+IF9zdWJzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVk\nTWFwKG5ldyBIYXNoTWFwPENsYXNzPD8+LCBMaXN0PENsYXNzPD8+Pj4oKSk7\nCgogICAgLy8geG1sIG1hcHBpbmcKICAgIHByb3RlY3RlZCBmaW5hbCBYTUxN\nZXRhRGF0YVtdIEVNUFRZX1hNTE1FVEFTOwogICAgcHJpdmF0ZSBmaW5hbCBN\nYXA8Q2xhc3M8Pz4sIFhNTE1ldGFEYXRhPiBfeG1sbWV0YXMgPSBuZXcgSGFz\naE1hcDxDbGFzczw/PiwgWE1MTWV0YURhdGE+KCk7CgogICAgcHJpdmF0ZSB0\ncmFuc2llbnQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmYgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxsOwogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgSW50ZXJmYWNlSW1wbEdlbmVyYXRvciBfaW1wbEdl\nbiA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBNZXRhRGF0YUZhY3Rv\ncnkgX2ZhY3RvcnkgPSBudWxsOwoKICAgIHByaXZhdGUgaW50IF9yZXNNb2Rl\nID0gTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HOwogICAgcHJpdmF0ZSBpbnQg\nX3NvdXJjZU1vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RF\nX1FVRVJZOwogICAgcHJpdmF0ZSBpbnQgX3ZhbGlkYXRlID0gVkFMSURBVEVf\nTUVUQSB8IFZBTElEQVRFX1VORU5IQU5DRUQ7CgogICAgLy8gd2UgYnVmZmVy\nIHVwIGFueSBjbGFzc2VzIHRoYXQgcmVnaXN0ZXIgdGhlbXNlbHZlcyB0byBw\ncmV2ZW50CiAgICAvLyByZWVudHJhbmN5IGVycm9ycyBpZiBjbGFzc2VzIHJl\nZ2lzdGVyIGR1cmluZyBhIGN1cnJlbnQgcGFyc2UgKGNvbW1vbikKICAgIHBy\naXZhdGUgZmluYWwgQ29sbGVjdGlvbjxDbGFzczw/Pj4gX3JlZ2lzdGVyZWQg\nPSBuZXcgSGFzaFNldDxDbGFzczw/Pj4oKTsKCiAgICAvLyBzZXQgb2YgbWV0\nYWRhdGFzIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmluZwogICAg\ncHJpdmF0ZSBmaW5hbCBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxpc3Qg\nX3Jlc29sdmluZyA9IG5ldyBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxp\nc3QoKTsKICAgIHByaXZhdGUgZmluYWwgSW5oZXJpdGFuY2VPcmRlcmVkTWV0\nYURhdGFMaXN0IF9tYXBwaW5nID0gbmV3IEluaGVyaXRhbmNlT3JkZXJlZE1l\ndGFEYXRhTGlzdCgpOwogICAgcHJpdmF0ZSBmaW5hbCBMaXN0PFJ1bnRpbWVF\neGNlcHRpb24+IF9lcnJzID0gbmV3IExpbmtlZExpc3Q8UnVudGltZUV4Y2Vw\ndGlvbj4oKTsKCiAgICAvLyBzeXN0ZW0gbGlzdGVuZXJzCiAgICBwcml2YXRl\nIExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QgX2xpc3RlbmVy\ncyA9IG5ldyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KDMp\nOwoKICAgIHByb3RlY3RlZCBib29sZWFuIF9wcmVsb2FkID0gZmFsc2U7CiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBfcHJlbG9hZENvbXBsZXRlID0gZmFsc2U7\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBfbG9ja2luZyA9IHRydWU7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgUFJFTE9BRF9TVFIgPSAiUHJl\nbG9hZCI7CiAgICAKICAgIHByaXZhdGUgYm9vbGVhbiBfcmVvcmRlck1ldGFE\nYXRhUmVzb2x1dGlvbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICogRGVmYXVs\ndCBjb25zdHJ1Y3Rvci4gQ29uZmlndXJlIHZpYSB7QGxpbmsgQ29uZmlndXJh\nYmxlfS4KICAgICAqLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSgp\nIHsKICAgICAgICBFTVBUWV9NRVRBUyA9IG5ld0NsYXNzTWV0YURhdGFBcnJh\neSgwKTsKICAgICAgICBFTVBUWV9GSUVMRFMgPSBuZXdGaWVsZE1ldGFEYXRh\nQXJyYXkoMCk7CiAgICAgICAgRU1QVFlfT1JERVJTID0gbmV3T3JkZXJBcnJh\neSgwKTsKICAgICAgICBFTVBUWV9YTUxNRVRBUyA9IG5ld1hNTENsYXNzTWV0\nYURhdGFBcnJheSgwKTsKICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgY29uZmlndXJhdGlvbiBmb3IgdGhlIHJlcG9zaXRvcnku\nCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgbG9nLgogICAg\nICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAgICByZXR1cm4g\nX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBJL08gdXNlZCB0byBs\nb2FkIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFGYWN0\nb3J5IGdldE1ldGFEYXRhRmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2Zh\nY3Rvcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgSS9PIHVzZWQgdG8g\nbG9hZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWV0\nYURhdGFGYWN0b3J5KE1ldGFEYXRhRmFjdG9yeSBmYWN0b3J5KSB7CiAgICAg\nICAgZmFjdG9yeS5zZXRSZXBvc2l0b3J5KHRoaXMpOwogICAgICAgIF9mYWN0\nb3J5ID0gZmFjdG9yeTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0byA8Y29kZT5WQUxJ\nREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgZ2V0VmFsaWRhdGUoKSB7CiAgICAgICAgcmV0\ndXJuIF92YWxpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0byA8Y29kZT5WQUxJ\nREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFZhbGlkYXRlKGludCB2YWxpZGF0ZSkg\newogICAgICAgIF92YWxpZGF0ZSA9IHZhbGlkYXRlOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1\nbHRzIHRvCiAgICAgKiA8Y29kZT5WQUxJREFURV9NRVRBIHwgVkFMSURBVEVf\nTUFQUElORyB8IFZBTElEQVRFX1VORU5IQU5DRUQ8L2NvZGU+LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRWYWxpZGF0ZShpbnQgdmFsaWRhdGUsIGJv\nb2xlYW4gb24pIHsKICAgICAgICBpZiAodmFsaWRhdGUgPT0gVkFMSURBVEVf\nTk9ORSkKICAgICAgICAgICAgX3ZhbGlkYXRlID0gdmFsaWRhdGU7CiAgICAg\nICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF92YWxpZGF0ZSB8PSB2YWxp\nZGF0ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF92YWxpZGF0ZSAmPSB+\ndmFsaWRhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEg\ncmVzb2x1dGlvbiBtb2RlLiBEZWZhdWx0cyB0byA8Y29kZT5NT0RFX01FVEEg\nfCBNT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNNb2RlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHJlc29sdXRpb24gbW9k\nZS4gRGVmYXVsdHMgdG8gPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5H\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShp\nbnQgbW9kZSkgewogICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERl\nZmF1bHRzIHRvIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQUElORzwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1v\nZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05P\nTkUpCiAgICAgICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgICAgICBlbHNl\nIGlmIChvbikKICAgICAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9yZXNNb2RlICY9IH5tb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdo\nYXQgbWV0YWRhdGEgdG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2Rl\nPk1PREVfTUVUQSB8IE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9zb3VyY2VNb2RlOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEg\ndG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8\nIE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlKSB7CiAgICAg\nICAgX3NvdXJjZU1vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEgdG8g\nbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1P\nREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlLCBib29sZWFuIG9u\nKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAg\nICBfc291cmNlTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAg\nICAgICAgICAgIF9zb3VyY2VNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBfc291cmNlTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldHMgd2hldGhlciB0aGlzIHJlcG9zaXRvcnkgd2lsbCBs\nb2FkIGFsbCBrbm93biBwZXJzaXN0ZW50IGNsYXNzZXMgYXQgaW5pdGlhbGl6\nYXRpb24uCiAgICAgKiBEZWZhdWx0cyB0byBmYWxzZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gZ2V0UHJlbG9hZCgpIHsKICAgICAgICByZXR1cm4g\nX3ByZWxvYWQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB3aGV0\naGVyIHRoaXMgcmVwb3NpdG9yeSB3aWxsIGxvYWQgYWxsIGtub3duIHBlcnNp\nc3RlbnQgY2xhc3NlcyBhdCBpbml0aWFsaXphdGlvbi4KICAgICAqIERlZmF1\nbHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmVs\nb2FkKGJvb2xlYW4gbCkgewogICAgICAgIF9wcmVsb2FkID0gbDsKICAgIH0K\nCgogICAgIC8qKgogICAgICogSWYgdGhlIG9wZW5qcGEuTWV0YURhdGFSZXBv\nc2l0b3J5IHBsdWdpbiB2YWx1ZSBQcmVsb2FkPXRydWUgaXMgc2V0LCB0aGlz\nIG1ldGhvZCB3aWxsIGxvYWQgYWxsCiAgICAgKiBNZXRhRGF0YSBmb3IgYWxs\nIHBlcnNpc3RlbnQgY2xhc3NlcyBhbmQgd2lsbCByZW1vdmUgbG9ja2luZyBm\ncm9tIHRoaXMgY2xhc3MuIAogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIHZvaWQgcHJlbG9hZCgpIHsKICAgICAgICBpZiAoX3ByZWxvYWQgPT0g\nZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAg\nICAvLyBJZiBwb29saW5nIEVNRnMsIHRoaXMgbWV0aG9kIG1heSBiZSBpbnZv\na2VkIG1vcmUgdGhhbiBvbmNlLiBPbmx5IHBlcmZvcm0gdGhpcyB3b3JrIG9u\nY2UuCiAgICAgICAgaWYgKF9wcmVsb2FkQ29tcGxldGUgPT0gdHJ1ZSkgewog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNdWx0aUNs\nYXNzTG9hZGVyIG11bHRpID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoSjJEb1ByaXZIZWxwZXIubmV3TXVsdGlDbGFzc0xvYWRlckFjdGlvbigp\nKTsKICAgICAgICBtdWx0aS5hZGRDbGFzc0xvYWRlcihBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xh\nc3NMb2FkZXJBY3Rpb24oKSkpOwogICAgICAgIG11bHRpLmFkZENsYXNzTG9h\nZGVyKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVs\ncGVyCiAgICAgICAgICAgIC5nZXRDbGFzc0xvYWRlckFjdGlvbihNZXRhRGF0\nYVJlcG9zaXRvcnkuY2xhc3MpKSk7CgogICAgICAgIFNldDxTdHJpbmc+IGNs\nYXNzZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBtdWx0aSk7\nCiAgICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCB8fCBjbGFzc2VzLnNpemUo\nKSA9PSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6ZUVhZ2VyLW5vbmUiKSk7\nCiAgICAgICAgfQogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkg\nPT0gdHJ1ZSkgewogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJy\nZXBvcy1pbml0aWFsaXplRWFnZXItZm91bmQiLCBjbGFzc2VzKSk7CiAgICAg\nICAgfQoKICAgICAgICBMaXN0PENsYXNzPD8+PiBsb2FkZWQgPSBuZXcgQXJy\nYXlMaXN0PENsYXNzPD8+PigpOwogICAgICAgIGZvciAoU3RyaW5nIGMgOiBj\nbGFzc2VzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBD\nbGFzczw/PiBjbHMgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgo\nSjJEb1ByaXZIZWxwZXIuZ2V0Rm9yTmFtZUFjdGlvbihjLCB0cnVlLCBtdWx0\naSkpKTsKICAgICAgICAgICAgICAgIGxvYWRlZC5hZGQoY2xzKTsKICAgICAg\nICAgICAgICAgIC8vIFRoaXMgY2FsbCBtYXkgYmUgdW5uZWNlc3Nhcnk/CiAg\nICAgICAgICAgICAgICBfZmFjdG9yeS5sb2FkKGNscywgTU9ERV9BTEwsIG11\nbHRpKTsKICAgICAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4\nY2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6ZUVhZ2Vy\nLWVycm9yIiksIHBhZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmVzb2x2ZUFsbChtdWx0aSk7CgogICAgICAgIC8vIEhvb2sgaW4gdGhp\ncyBjbGFzcyBhcyBhIGxpc3RlbmVyIGFuZCBwcm9jZXNzIHJlZ2lzdGVyZWQg\nY2xhc3NlcyBsaXN0IHRvIHBvcHVsYXRlIF9hbGlhc2VzCiAgICAgICAgLy8g\nbGlzdC4KICAgICAgICBQQ1JlZ2lzdHJ5LmFkZFJlZ2lzdGVyQ2xhc3NMaXN0\nZW5lcih0aGlzKTsKICAgICAgICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMo\nbXVsdGkpOwogICAgICAgIF9sb2NraW5nID0gZmFsc2U7CiAgICAgICAgX3By\nZWxvYWRDb21wbGV0ZSA9IHRydWU7CiAgICB9CgogICAgCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4K\nICAgICAqIAogICAgICogQHBhcmFtIGNscwogICAgICogICAgICAgICAgICB0\naGUgY2xhc3MgdG8gcmV0cmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFy\nYW0gZW52TG9hZGVyCiAgICAgKiAgICAgICAgICAgIHRoZSBlbnZpcm9ubWVu\ndGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBAcGFyYW0gbXVzdEV4\naXN0CiAgICAgKiAgICAgICAgICAgIGlmIHRydWUsIHRocm93cyBhIHtAbGlu\nayBNZXRhRGF0YUV4Y2VwdGlvbn0gaWYgbm8gbWV0YWRhdGEgaXMgZm91bmQK\nICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEo\nQ2xhc3M8Pz4gY2xzLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4g\nbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCh0aGlzKXsKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRNZXRhRGF0YUludGVybmFsKGNscywgZW52TG9hZGVyLCBtdXN0RXhp\nc3QpOyAgICAKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHJldHVybiBnZXRNZXRhRGF0YUludGVybmFsKGNscywgZW52TG9h\nZGVyLCBtdXN0RXhpc3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGFJbnRlcm5hbChDbGFzczw/PiBj\nbHMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3Qp\nIHsKICAgICAgICAgICAgaWYgKGNscyAhPSBudWxsICYmIER5bmFtaWNQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQog\nICAgICAgICAgICAgICAgY2xzID0gY2xzLmdldFN1cGVyY2xhc3MoKTsKCiAg\nICAgICAgICAgIC8vIGlmIGNscyBpcyBhIGdlbmVyYXRlZCBpbnRlcmZhY2Us\nIHVzZSB0aGUgdXNlciBpbnRlcmZhY2UKICAgICAgICAgICAgLy8gdG8gbG9j\nYXRlIG1ldGFkYXRhCiAgICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiBf\naW1wbEdlbiAhPSBudWxsICYmIF9pbXBsR2VuLmlzSW1wbFR5cGUoY2xzKSkK\nICAgICAgICAgICAgICAgIGNscyA9IF9pbXBsR2VuLnRvTWFuYWdlZEludGVy\nZmFjZShjbHMpOwoKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nZ2V0TWV0YURhdGFJbnRlcm5hbChjbHMsIGVudkxvYWRlcik7CiAgICAgICAg\nICAgIGlmIChtZXRhID09IG51bGwgJiYgbXVzdEV4aXN0KSB7CiAgICAgICAg\nICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgIUltcGxIZWxwZXIuaXNNYW5h\nZ2VkVHlwZShfY29uZiwgY2xzKSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEtbm90\ncGMiLCBjbHMpKS5zZXRGYXRhbChmYWxzZSk7CgogICAgICAgICAgICAgICAg\nU2V0PFN0cmluZz4gcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMo\nZmFsc2UsIGVudkxvYWRlcik7CiAgICAgICAgICAgICAgICBpZiAocGNOYW1l\ncyAhPSBudWxsICYmIHBjTmFtZXMuc2l6ZSgpID4gMCkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLW1ldGEtdHlwZXMiLCBjbHMsIHBjTmFtZXMpKTsKCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLW1ldGEiLCBjbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNv\nbHZlKG1ldGEpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZl\nbiBhbGlhcyBuYW1lLgogICAgICogCiAgICAgKiBAcGFyYW0gYWxpYXMKICAg\nICAqICAgICAgICAgICAgdGhlIGFsaWFzIHRvIGNsYXNzIHRvIHJldHJpZXZl\nIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICog\nICAgICAgICAgICB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlm\nIGFueQogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAgICAgICAg\nICBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259\nIGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKiBAc2VlIENsYXNzTWV0\nYURhdGEjZ2V0VHlwZUFsaWFzCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01l\ndGFEYXRhIGdldE1ldGFEYXRhKFN0cmluZyBhbGlhcywgQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlmIChh\nbGlhcyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRh\nIiwgYWxpYXMsIF9hbGlhc2VzKSk7CiAgICAgICAgaWYgKGFsaWFzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVj\nayBjYWNoZQogICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZM\nb2FkZXIpOwogICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGNsYXNzTGlzdCA9IF9h\nbGlhc2VzLmdldChhbGlhcyk7CgogICAgICAgIC8vIG11bHRpcGxlIGNsYXNz\nZXMgbWF5IGhhdmUgYmVlbiBkZWZpbmVkIHdpdGggdGhlIHNhbWUgYWxpYXM6\nIHdlCiAgICAgICAgLy8gd2lsbCBmaWx0ZXIgYnkgY2hlY2tpbmcgYWdhaW5z\ndCB0aGUgY3VycmVudCBsaXN0IG9mIHRoZQogICAgICAgIC8vIHBlcnNpc3Rl\nbnQgdHlwZXMgYW5kIGZpbHRlciBiYXNlZCBvbiB3aGljaCBjbGFzc2VzIGFy\nZSBsb2FkYWJsZQogICAgICAgIC8vIHZpYSB0aGUgY3VycmVudCBlbnZpcm9u\nbWVudCdzIENsYXNzTG9hZGVyCiAgICAgICAgU2V0PFN0cmluZz4gcGNOYW1l\ncyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7\nCiAgICAgICAgQ2xhc3M8Pz4gY2xzID0gbnVsbDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgY2xhc3NMaXN0ICE9IG51bGwgJiYgaSA8IGNsYXNzTGlzdC5z\naXplKCk7IGkrKykgewogICAgICAgICAgICBDbGFzczw/PiBjID0gY2xhc3NM\naXN0LmdldChpKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIC8vIHJlLWxvYWQgdGhlIGNsYXNzIGluIHRoZSBjdXJyZW50IGVudmlyb25t\nZW50IGxvYWRlciBzbwogICAgICAgICAgICAgICAgLy8gdGhhdCB3ZSBjYW4g\naGFuZGxlIHJlZGVwbG95bWVudCBvZiB0aGUgc2FtZSBjbGFzcyBuYW1lCiAg\nICAgICAgICAgICAgICBDbGFzczw/PiBuYyA9IENsYXNzLmZvck5hbWUoYy5n\nZXROYW1lKCksIGZhbHNlLCBlbnZMb2FkZXIpOwoKICAgICAgICAgICAgICAg\nIC8vIGlmIHdlIGhhdmUgc3BlY2lmaWVkIGEgbGlzdCBvZiBwZXJzaXN0ZW50\nIGNsYXNlcywKICAgICAgICAgICAgICAgIC8vIGFsc28gY2hlY2sgdG8gZW5z\ndXJlIHRoYXQgdGhlIGNsYXNzIGlzIGluIHRoYXQgbGlzdAogICAgICAgICAg\nICAgICAgaWYgKHBjTmFtZXMgPT0gbnVsbCB8fCBwY05hbWVzLnNpemUoKSA9\nPSAwIHx8IHBjTmFtZXMuY29udGFpbnMobmMuZ2V0TmFtZSgpKSkgewogICAg\nICAgICAgICAgICAgICAgIGNscyA9IG5jOwogICAgICAgICAgICAgICAgICAg\nIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNsYXNzTGlzdC5hZGQoY2xzKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMg\naGFwcGVucyB3aGVuIHRoZSBjbGFzcyBpcyBub3QgbG9hZGFibGUgYnkKICAg\nICAgICAgICAgICAgIC8vIHRoZSBlbnZpcm9ubWVudCBjbGFzcyBsb2FkZXIs\nIHNvIGl0IHdhcyBwcm9iYWJseQogICAgICAgICAgICAgICAgLy8gbGlzdGVk\nIGVsc2V3aGVyZTsgYWxzbyBpZ25vcmUgbGlua2FnZSBmYWlsdXJlcyBhbmQK\nICAgICAgICAgICAgICAgIC8vIG90aGVyIGNsYXNzIGxvYWRpbmcgcHJvYmxl\nbXMKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2xzICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVu\ndkxvYWRlciwgbXVzdEV4aXN0KTsKCiAgICAgICAgLy8gbWF5YmUgdGhpcyBp\ncyBzb21lIHR5cGUgd2UndmUgc2VlbiBidXQganVzdCBpc24ndCB2YWxpZAog\nICAgICAgIGlmIChfYWxpYXNlcy5jb250YWluc0tleShhbGlhcykpIHsKICAg\nICAgICAgICAgaWYgKG11c3RFeGlzdCkKICAgICAgICAgICAgICAgIHRocm93\nTm9SZWdpc3RlcmVkQWxpYXMoYWxpYXMpOwogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFdlIG5lZWQgdG8gc3luY2hy\nb25pemUgb24gX2FsaWFzZXMgYmVjYXVzZSBhIENvbmN1cnJlbnRNb2RpZmlj\nYXRpb25FeGNlcHRpb24gY2FuIGlmIHRoZXJlCiAgICAgICAgLy8gaXMgYSB0\naHJlYWQgaW4gZ2V0QWxpYXNOYW1lcygpIEFORCB0aGlzIGNsYXNzIGlzbid0\nIHVzaW5nIGFueSBsb2NraW5nLgogICAgICAgIHN5bmNocm9uaXplZCAoX2Fs\naWFzZXMpIHsKICAgICAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBh\nbiBpbnZhbGlkIHR5cGUKICAgICAgICAgICAgX2FsaWFzZXMucHV0KGFsaWFz\nLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGlmICghbXVzdEV4aXN0KQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gdGhyb3dO\nb1JlZ2lzdGVyZWRBbGlhcyhhbGlhcyk7CiAgICB9CgogICAgcHJpdmF0ZSBD\nbGFzc01ldGFEYXRhIHRocm93Tm9SZWdpc3RlcmVkQWxpYXMoU3RyaW5nIGFs\naWFzKSB7CiAgICAgICAgU3RyaW5nIGNsb3NlID0gZ2V0Q2xvc2VzdEFsaWFz\nTmFtZShhbGlhcyk7CiAgICAgICAgaWYgKGNsb3NlICE9IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tYWxpYXMtbWV0YS1oaW50IiwgYWxpYXMsIF9hbGlhc2VzLCBjbG9zZSkp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsIF9h\nbGlhc2VzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBu\nZWFyZXN0IG1hdGNoIHRvIHRoZSBzcGVjaWZpZWQgYWxpYXMgbmFtZQogICAg\nICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQ2xvc2VzdEFsaWFzTmFtZShTdHJpbmcgYWxpYXMpIHsKICAgICAgICBDb2xs\nZWN0aW9uPFN0cmluZz4gYWxpYXNlcyA9IGdldEFsaWFzTmFtZXMoKTsKICAg\nICAgICByZXR1cm4gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0\nZWluRGlzdGFuY2UoYWxpYXMsIGFsaWFzZXMpOwogICAgfQoKICAgIC8qKgog\nICAgICogQHJldHVybiB0aGUgcmVnaXN0ZXJlZCBhbGlhcyBuYW1lcwogICAg\nICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBDb2xsZWN0aW9u\nPFN0cmluZz4gZ2V0QWxpYXNOYW1lcygpIHsKICAgICAgICBpZiAoX2xvY2tp\nbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChfYWxpYXNlcykgewog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldEFsaWFzTmFtZXNJbnRlcm5hbCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\ncmV0dXJuIGdldEFsaWFzTmFtZXNJbnRlcm5hbCgpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIGZpbmFsIENvbGxlY3Rpb248U3RyaW5nPiBnZXRB\nbGlhc05hbWVzSW50ZXJuYWwoKSB7CiAgICAgICAgQ29sbGVjdGlvbjxTdHJp\nbmc+IGFsaWFzZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3I8TWFwLkVudHJ5PFN0cmluZywgTGlzdDxDbGFz\nczw/Pj4+PiBpdGVyID0gX2FsaWFzZXMuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIE1hcC5FbnRy\neTxTdHJpbmcsIExpc3Q8Q2xhc3M8Pz4+PiBlID0gaXRlci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBpZiAoZS5nZXRWYWx1ZSgpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgYWxpYXNlcy5hZGQoZS5nZXRLZXkoKSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBhbGlhc2VzOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGdldCB0aGUgbWV0YWRhdGEgZm9y\nIHRoZSBnaXZlbiBjbGFzcywgd2l0aG91dCByZXNvbHZpbmcgaXQuCiAgICAg\nKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YUludGVy\nbmFsKENsYXNzPD8+IGNscywgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAg\nICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUgZm9yIGV4aXN0aW5nIG1ldGFk\nYXRhLCBvciBnaXZlIHVwIGlmIG5vIG1ldGFkYXRhIGFuZAogICAgICAgIC8v\nIG91ciBsaXN0IG9mIGNvbmZpZ3VyZWQgcGVyc2lzdGVudCB0eXBlcyBkb2Vz\nbid0IGluY2x1ZGUgdGhlIGNsYXNzCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsICYmICgobWV0YS5nZXRTb3VyY2VNb2RlKCkg\nJiBNT0RFX01FVEEpICE9IDAgfHwgKF9zb3VyY2VNb2RlICYgTU9ERV9NRVRB\nKSA9PSAwKSkKICAgICAgICAgICAgcmV0dXJuIG1ldGE7CgogICAgICAgIC8v\nIGlmIHJ1bnRpbWUsIGN1dCBvZmYgc2VhcmNoIGlmIG5vdCBpbiBwYyBsaXN0\nLiB3ZSBkb24ndCBkbyB0aGlzIGF0CiAgICAgICAgLy8gZGV2IHRpbWUgc28g\ndGhhdCB1c2VyIGNhbiBtYW5pcHVsYXRlIHBlcnNpc3RlbnQgY2xhc3NlcyBo\nZSdzIHdyaXRpbmcKICAgICAgICAvLyBiZWZvcmUgYWRkaW5nIHRoZW0gdG8g\ndGhlIGxpc3QKICAgICAgICBpZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JV\nTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgU2V0PFN0cmluZz4gcGNOYW1l\ncyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7\nCiAgICAgICAgICAgIGlmIChwY05hbWVzICE9IG51bGwgJiYgIXBjTmFtZXMu\nY29udGFpbnMoY2xzLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbWV0YTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXRhID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIG1heWJlIHdlIGtu\nb3cgdGhpcyBjbGFzcyBoYXMgbm8gbWV0YWRhdGEKICAgICAgICAgICAgaWYg\nKF9tZXRhcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhpcyBpc24n\ndCBhbiBvYnZpb3VzbHkgYmFkIGNsYXNzCiAgICAgICAgICAgIGlmIChjbHMu\naXNQcmltaXRpdmUoKSB8fCBjbHMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoImph\ndmEuIikgfHwgY2xzID09IFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcykKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8gZGVz\naWduZWQgdG8gZ2V0IGFyb3VuZCBqaWtlcyAxLjE3IC8gSkRLMS41IGlzc3Vl\nIHdoZXJlIHN0YXRpYwogICAgICAgICAgICAvLyBpbml0aWFsaXplcnMgYXJl\nIG5vdCBpbnZva2VkIHdoZW4gYSBjbGFzcyBpcyByZWZlcmVuY2VkLCBzbyB0\naGUKICAgICAgICAgICAgLy8gY2xhc3MgbmV2ZXIgcmVnaXN0ZXJzIGl0c2Vs\nZiB3aXRoIHRoZSBzeXN0ZW0KICAgICAgICAgICAgaWYgKChfdmFsaWRhdGUg\nJiBWQUxJREFURV9SVU5USU1FKSAhPSAwKSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzLmdl\ndE5hbWUoKSwgdHJ1ZSwgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGNscykpKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG5vdCBpbiBjYWNoZTogbG9h\nZCBtZXRhZGF0YSBvciBtYXBwaW5ncyBkZXBlbmRpbmcgb24gc291cmNlIG1v\nZGUuCiAgICAgICAgLy8gbG9hZGluZyBtZXRhZGF0YSBtaWdodCBhbHNvIGxv\nYWQgbWFwcGluZ3MsIGJ1dCBkb2Vzbid0IGhhdmUgdG8KICAgICAgICBpbnQg\nbW9kZSA9IDA7CiAgICAgICAgaWYgKChfc291cmNlTW9kZSAmIE1PREVfTUVU\nQSkgIT0gMCkKICAgICAgICAgICAgbW9kZSA9IF9zb3VyY2VNb2RlICYgfk1P\nREVfTUFQUElORzsKICAgICAgICBlbHNlIGlmICgoX3NvdXJjZU1vZGUgJiBN\nT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIG1vZGUgPSBfc291cmNl\nTW9kZTsKICAgICAgICBpZiAobW9kZSAhPSBNT0RFX05PTkUpIHsKICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImxvYWQtY2xzIiwgY2xzLCB0b01v\nZGVTdHJpbmcobW9kZSkpKTsKICAgICAgICAgICAgX2ZhY3RvcnkubG9hZChj\nbHMsIG1vZGUsIGVudkxvYWRlcik7CiAgICAgICAgfQoKICAgICAgICAvLyBj\naGVjayBjYWNoZSBhZ2FpbgogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAg\nICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdldChj\nbHMpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwgJiYgKChtZXRhLmdldFNv\ndXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0gMCB8fCAoX3NvdXJjZU1vZGUg\nJiBNT0RFX01FVEEpID09IDApKQogICAgICAgICAgICByZXR1cm4gbWV0YTsK\nCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBjbGFzcyBoYXMgbm8gbWV0\nYWRhdGE7IGNoZWNraW5nIGZvciB0aGlzIGxhdGVyCiAgICAgICAgLy8gc3Bl\nZWRzIHRoaW5ncyB1cCBpbiBlbnZpcm9ubWVudHMgd2l0aCBzbG93IGNsYXNz\nIGxvYWRpbmcKICAgICAgICAvLyBsaWtlIGFwcHNlcnZlcnMKICAgICAgICBp\nZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICByZW1vdmVNZXRhRGF0YSht\nZXRhKTsKICAgICAgICBfbWV0YXMucHV0KGNscywgbnVsbCk7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBz\ndHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIG1vZGUgZmxhZ3Mu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyB0b01vZGVTdHJp\nbmcoaW50IG1vZGUpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5l\ndyBTdHJpbmdCdWlsZGVyKDMxKTsKICAgICAgICBpZiAoKG1vZGUgJiBNT0RF\nX01FVEEpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltNRVRBXSIp\nOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfUVVFUlkpICE9IDApCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIltRVUVSWV0iKTsKICAgICAgICBpZiAoKG1v\nZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIltNQVBQSU5HXSIpOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfTUFQ\nUElOR19JTklUKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5kKCJbTUFQ\nUElOR19JTklUXSIpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUgbWV0YWRhdGEgZm9yIG1h\ncHBpbmcgcmVzb2x1dGlvbi4gVGhpcyBtZXRob2QgbWlnaHQgbWFwIHBhcnRz\nIG9mIHRoZSBtZXRhZGF0YSB0aGF0CiAgICAgKiBkb24ndCByZWx5IG9uIG90\naGVyIGNsYXNzZXMgYmVpbmcgbWFwcGVkLCBidXQgdGhhdCBvdGhlciBjbGFz\nc2VzIG1pZ2h0IHJlbHkgb24gZHVyaW5nIHRoZWlyCiAgICAgKiBvd24gbWFw\ncGluZyAoZm9yIGV4YW1wbGUsIHByaW1hcnkga2V5IGZpZWxkcykuIEJ5IGRl\nZmF1bHQsIHRoaXMgbWV0aG9kIG9ubHkgY2FsbHMKICAgICAqIHtAbGluayBD\nbGFzc01ldGFEYXRhI2RlZmluZVN1cGVyY2xhc3NGaWVsZHN9LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwcmVwYXJlTWFwcGluZyhDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBtZXRhLmRlZmluZVN1cGVyY2xhc3NGaWVs\nZHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSB0aGUg\nZ2l2ZW4gbWV0YWRhdGEgaWYgbmVlZGVkLiBUaGVyZSBhcmUgdGhyZWUgZ29h\nbHM6CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+TWFrZSBzdXJlIG5vIHVucmVz\nb2x2ZWQgbWV0YWRhdGEgZ2V0cyBiYWNrIHRvIHRoZSBjbGllbnQuPC9saT4K\nICAgICAqIDxsaT5Bdm9pZCBpbmZpbml0ZSByZWVudHJhbnQgY2FsbHMgZm9y\nIG11dHVhbGx5LWRlcGVuZGVudCBtZXRhZGF0YXMgYnkgYWxsb3dpbmcgdW5y\nZXNvbHZlZAogICAgICogbWV0YWRhdGEgdG8gYmUgcmV0dXJuZWQgdG8gb3Ro\nZXIgbWV0YWRhdGFzLjwvbGk+CiAgICAgKiA8bGk+QWx3YXlzIG1ha2Ugc3Vy\nZSB0aGUgc3VwZXJjbGFzcyBtZXRhZGF0YSBpcyByZXNvbHZlZCBiZWZvcmUg\ndGhlIHN1YmNsYXNzIG1ldGFkYXRhIHNvIHRoYXQKICAgICAqIHRoZSBzdWJj\nbGFzcyBjYW4gYWNjZXNzIHRoZSBzdXBlcidzIGxpc3Qgb2YgZmllbGRzLjwv\nbGk+CiAgICAgKiA8L29sPgogICAgICogTm90ZSB0aGF0IHRoZSBjb2RlIGNh\nbGxpbmcgdGhpcyBtZXRob2QgaXMgc3luY2hyb25pemVkLCBzbyB0aGlzIG1l\ndGhvZCBkb2Vzbid0IGhhdmUgdG8gYmUuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCByZXNvbHZlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIC8v\nIHJldHVybiBhbnl0aGluZyB0aGF0IGhhcyBpdHMgbWV0YWRhdGEgcmVzb2x2\nZWQsIGJlY2F1c2UgdGhhdCBtZWFucwogICAgICAgIC8vIGl0IGlzIGVpdGhl\nciBmdWxseSByZXNvbHZlZCBvciBtdXN0IGF0IGxlYXN0IGJlIGluIHRoZSBw\ncm9jZXNzIG9mCiAgICAgICAgLy8gcmVzb2x2aW5nIG1hcHBpbmcsIGV0YyBz\naW5jZSB3ZSBkbyB0aGF0IHJpZ2h0IGFmdGVyIG1ldGEgcmVzb2x2ZQogICAg\nICAgIGlmIChtZXRhID09IG51bGwgfHwgX3Jlc01vZGUgPT0gTU9ERV9OT05F\nIHx8IChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUVUQSkgIT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyByZXNvbHZlIG1ldGFkYXRh\nCiAgICAgICAgTGlzdDxDbGFzc01ldGFEYXRhPiByZXNvbHZlZCA9IHJlc29s\ndmVNZXRhKG1ldGEpOwogICAgICAgIGlmIChyZXNvbHZlZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGxvYWQgbWFwcGluZyBk\nYXRhCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXNvbHZlZC5zaXpl\nKCk7IGkrKykKICAgICAgICAgICAgbG9hZE1hcHBpbmcocmVzb2x2ZWQuZ2V0\nKGkpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlc29sdmVkLnNp\nemUoKTsgaSsrKQogICAgICAgICAgICBwcmVNYXBwaW5nKHJlc29sdmVkLmdl\ndChpKSk7CgogICAgICAgIC8vIHJlc29sdmUgbWFwcGluZ3MKICAgICAgICBi\nb29sZWFuIGVyciA9IHRydWU7CiAgICAgICAgaWYgKChfcmVzTW9kZSAmIE1P\nREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCByZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgIGVy\nciAmPSByZXNvbHZlTWFwcGluZyhyZXNvbHZlZC5nZXQoaSkpOwoKICAgICAg\nICAvLyB0aHJvdyBlcnJvcnMgZW5jb3VudGVyZWQKICAgICAgICBpZiAoZXJy\nICYmICFfZXJycy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgUnVudGltZUV4\nY2VwdGlvbiByZTsKICAgICAgICAgICAgaWYgKF9lcnJzLnNpemUoKSA9PSAx\nKQogICAgICAgICAgICAgICAgcmUgPSBfZXJycy5nZXQoMCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIHJlID0KICAgICAgICAgICAgICAg\nICAgICBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInJlc29sdmUt\nZXJycyIpKS5zZXROZXN0ZWRUaHJvd2FibGVzKChUaHJvd2FibGVbXSkgX2Vy\ncnMKICAgICAgICAgICAgICAgICAgICAgICAgLnRvQXJyYXkobmV3IEV4Y2Vw\ndGlvbltfZXJycy5zaXplKCldKSk7CiAgICAgICAgICAgIF9lcnJzLmNsZWFy\nKCk7CiAgICAgICAgICAgIHRocm93IHJlOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJlc29sdmUgbWV0YWRhdGEgbW9kZSwgcmV0dXJuaW5n\nIGxpc3Qgb2YgcHJvY2Vzc2VkIG1ldGFkYWRhdGFzLCBvciBudWxsIGlmIHdl\nJ3JlIHN0aWxsIGluIHRoZQogICAgICogcHJvY2VzcyBvZiByZXNvbHZpbmcg\nb3RoZXIgbWV0YWRhdGFzLgogICAgICovCiAgICBwcml2YXRlIExpc3Q8Q2xh\nc3NNZXRhRGF0YT4gcmVzb2x2ZU1ldGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgaWYgKG1ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCkg\newogICAgICAgICAgICAvLyBzZXQgc3VwZXJjbGFzcwogICAgICAgICAgICBD\nbGFzczw/PiBzdXAgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXRTdXBl\ncmNsYXNzKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwTWV0YTsK\nICAgICAgICAgICAgd2hpbGUgKHN1cCAhPSBudWxsICYmIHN1cCAhPSBPYmpl\nY3QuY2xhc3MpIHsKICAgICAgICAgICAgICAgIHN1cE1ldGEgPSBnZXRNZXRh\nRGF0YShzdXAsIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgaWYgKHN1cE1ldGEgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIG1ldGEuc2V0UENTdXBlcmNsYXNzKHN1cCk7CiAgICAg\nICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YShz\ndXBNZXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHN1cCA9IHN1cC5n\nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJmYWNlKCkpIHsKICAg\nICAgICAgICAgICAgIENsYXNzPD8+W10gc3VwcyA9IG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLmdldEludGVyZmFjZXMoKTsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgICAgIHN1cE1ldGEgPSBnZXRNZXRhRGF0YShzdXBzW2ldLCBt\nZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIGZhbHNlKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoc3VwTWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGEuc2V0UENTdXBlcmNsYXNzKHN1cCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIG1ldGEuc2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nc3VwTWV0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiYXNzaWduZWQt\nc3VwIiwgbWV0YSwgbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSkpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gcmVzb2x2ZSByZWxhdGlvbiBwcmltYXJ5IGtleSBm\naWVsZHMgZm9yIG1hcHBpbmcgZGVwZW5kZW5jaWVzCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBtZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAg\nICAgICAgICAgIGdldE1ldGFEYXRhKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBl\nKCksIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgZmFsc2UpOwoKICAgICAg\nICAvLyByZXNvbHZlIG1ldGFkYXRhOyBpZiB3ZSdyZSBub3QgaW4gdGhlIHBy\nb2Nlc3Mgb2YgcmVzb2x2aW5nCiAgICAgICAgLy8gb3RoZXJzLCB0aGlzIHdp\nbGwgcmV0dXJuIHRoZSBzZXQgb2YgaW50ZXJyZWxhdGVkIG1ldGFzIHRoYXQK\nICAgICAgICAvLyByZXNvbHZlZAogICAgICAgIHJldHVybiBwcm9jZXNzQnVm\nZmVyKG1ldGEsIF9yZXNvbHZpbmcsIE1PREVfTUVUQSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBMb2FkIG1hcHBpbmcgaW5mb3JtYXRpb24gZm9yIHRoZSBn\naXZlbiBtZXRhZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvYWRN\nYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmICgobWV0\nYS5nZXRSZXNvbHZlKCkgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gbG9hZCBtYXBwaW5nIGluZm9ybWF0\naW9uCiAgICAgICAgaWYgKChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVf\nTUFQUElORykgPT0gMCAmJiAoX3NvdXJjZU1vZGUgJiBNT0RFX01BUFBJTkcp\nICE9IDApIHsKICAgICAgICAgICAgLy8gZW1iZWRkZWQtb25seSBtZXRhZGF0\nYSBkb2Vzbid0IGhhdmUgbWFwcGluZywgc28gYWx3YXlzIGxvYWRlZAogICAg\nICAgICAgICBpZiAobWV0YS5pc0VtYmVkZGVkT25seSgpKQogICAgICAgICAg\nICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUFQUElORywgdHJ1ZSk7\nCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gbG9hZCBt\nYXBwaW5nIGRhdGEKICAgICAgICAgICAgICAgIGludCBtb2RlID0gX3NvdXJj\nZU1vZGUgJiB+TU9ERV9NRVRBOwogICAgICAgICAgICAgICAgaWYgKF9sb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJsb2FkLW1hcHBpbmciLCBtZXRhLCB0b01vZGVTdHJp\nbmcobW9kZSkpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgX2ZhY3RvcnkubG9hZChtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSwgbW9kZSwgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigpKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAg\nICAgICAgICAgICBfZXJycy5hZGQocmUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUHJlLW1hcHBpbmcgcHJlcGFyYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBwcmVNYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIGlmICgobWV0YS5nZXRSZXNvbHZlKCkgJiBNT0RFX01BUFBJTkcpICE9IDAp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gcHJlcGFyZSBtYXBw\naW5ncyBmb3IgcmVzb2x2ZTsgaWYgbm90IHJlc29sdmluZyBtYXBwaW5ncywg\ndGhlbgogICAgICAgIC8vIG1ha2Ugc3VyZSBhbnkgc3VwZXJjbGFzcyBmaWVs\nZHMgZGVmaW5lZCBpbiBtZXRhZGF0YSBhcmUgcmVzb2x2ZWQKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9ERV9NQVBQSU5H\nKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoInByZXAtbWFwcGluZyIsIG1ldGEpKTsKICAgICAgICAgICAgICAgIHBy\nZXBhcmVNYXBwaW5nKG1ldGEpOwogICAgICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgICAgIG1ldGEuZGVmaW5lU3VwZXJjbGFzc0ZpZWxkcyhmYWxzZSk7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAgICAgX2Vy\ncnMuYWRkKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXNvbHZlIGFuZCBpbml0aWFsaXplIG1hcHBpbmcuCiAgICAgKiAKICAgICAq\nIEByZXR1cm4gZmFsc2UgaWYgd2UncmUgc3RpbGwgaW4gdGhlIHByb2Nlc3Mg\nb2YgcmVzb2x2aW5nIG1hcHBpbmdzCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiByZXNvbHZlTWFwcGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBMaXN0PENsYXNzTWV0YURhdGE+IG1hcHBlZCA9IHByb2Nlc3NCdWZm\nZXIobWV0YSwgX21hcHBpbmcsIE1PREVfTUFQUElORyk7CiAgICAgICAgaWYg\nKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgIC8vIGluaXRpYWxpemUgbWFwcGluZyBmb3IgcnVudGltZSB1c2UK\nICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9ERV9NQVBQSU5HX0lOSVQpICE9\nIDApIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwZWQu\nc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NN\nZXRhRGF0YSkgbWFwcGVkLmdldChpKTsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgbWV0YS5yZXNvbHZlKE1PREVfTUFQUElO\nR19JTklUKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVNZXRhRGF0\nYShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBfZXJycy5hZGQocmUpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUHJvY2Vz\ncyB0aGUgZ2l2ZW4gbWV0YWRhdGEgYW5kIHRoZSBhc3NvY2lhdGVkIGJ1ZmZl\nci4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PENsYXNzTWV0YURhdGE+IHBy\nb2Nlc3NCdWZmZXIoQ2xhc3NNZXRhRGF0YSBtZXRhLCBJbmhlcml0YW5jZU9y\nZGVyZWRNZXRhRGF0YUxpc3QgYnVmZmVyLCBpbnQgbW9kZSkgewogICAgICAg\nIC8vIGlmIHdlJ3JlIGFscmVhZHkgcHJvY2Vzc2luZyBhIG1ldGFkYXRhLCBq\ndXN0IGJ1ZmZlciB0aGlzIG9uZTsgd2hlbgogICAgICAgIC8vIHRoZSBpbml0\naWFsIG1ldGFkYXRhIGZpbmlzaGVzIHByb2Nlc3NpbmcsIHdlIHRyYXZlcnNl\nIHRoZSBidWZmZXIKICAgICAgICAvLyBhbmQgcHJvY2VzcyBhbGwgdGhlIG90\naGVycyB0aGF0IHdlcmUgaW50cm9kdWNlZCBkdXJpbmcgcmVlbnRyYW50CiAg\nICAgICAgLy8gY2FsbHMKICAgICAgICBpZiAoIWJ1ZmZlci5hZGQobWV0YSkg\nfHwgYnVmZmVyLnNpemUoKSAhPSAxKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gY29udGludWFsbHkgcG9wIGEgbWV0YWRhdGEgYW5k\nIHByb2Nlc3MgaXQgdW50aWwgd2UgcnVuIG91dDsgbm90ZQogICAgICAgIC8v\nIHRoYXQgZWFjaCBwcm9jZXNzaW5nIGNhbGwgbWlnaHQgcGxhY2UgbW9yZSBt\nZXRhcyBpbiB0aGUgYnVmZmVyIGFzCiAgICAgICAgLy8gb25lIGNsYXNzIHRy\naWVzIHRvIGFjY2VzcyBtZXRhZGF0YSBmb3IgYW5vdGhlcjsgYWxzbyBub3Rl\nIHRoYXQgdGhlCiAgICAgICAgLy8gYnVmZmVyIG9yZGVycyBpdHNlbGYgZnJv\nbSBsZWFzdCB0byBtb3N0IGRlcml2ZWQKICAgICAgICBDbGFzc01ldGFEYXRh\nIGJ1ZmZlcmVkOwogICAgICAgIExpc3Q8Q2xhc3NNZXRhRGF0YT4gcHJvY2Vz\nc2VkID0gbmV3IEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPig1KTsKICAgICAg\nICB3aGlsZSAoIWJ1ZmZlci5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYnVm\nZmVyZWQgPSBidWZmZXIucGVlaygpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgYnVmZmVyZWQucmVzb2x2ZShtb2RlKTsKICAgICAgICAg\nICAgICAgIHByb2Nlc3NlZC5hZGQoYnVmZmVyZWQpOwogICAgICAgICAgICAg\nICAgYnVmZmVyLnJlbW92ZShidWZmZXJlZCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIF9l\ncnJzLmFkZChyZSk7CgogICAgICAgICAgICAgICAgLy8gYW55IGV4Y2VwdGlv\nbiBkdXJpbmcgcmVzb2x1dGlvbiBvZiBvbmUgdHlwZSBtZWFucyB3ZSBjYW4n\ndAogICAgICAgICAgICAgICAgLy8gcmVzb2x2ZSBhbnkgb2YgdGhlIHJlbGF0\nZWQgdHlwZXMsIHNvIGNsZWFyIGJ1ZmZlci4gdGhpcyBhbHNvCiAgICAgICAg\nICAgICAgICAvLyBlbnN1cmVzIHRoYXQgaWYgdHdvIHR5cGVzIHJlbGF0ZSB0\nbyBlYWNoIG90aGVyIGFuZCBvbmUKICAgICAgICAgICAgICAgIC8vIGRpZXMs\nIHdlIGRvbid0IGdldCBpbnRvIGluZmluaXRlIGN5Y2xlcwogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvcjxDbGFzc01ldGFEYXRhPiBpdHIgPSBidWZm\nZXIuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgICAgICBtZXRhID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAg\nICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAobWV0YSAhPSBidWZmZXJlZCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBfZXJycy5hZGQobmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJw\ncmV2LWVycnMiLCBtZXRhLCBidWZmZXJlZCkpKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBidWZm\nZXIuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAK\nICAgICAgICAvLyBDaGVjayBpZiBwcm9jZXNzIGJ1ZmZlciByZW9yZGVyaW5n\nIGZvciBQQ1R5cGVzIHRoYXQgaGF2ZSByZWxhdGlvbnNoaXBzIHRvIG90aGVy\nIFBDVHlwZXMgaW4gdGhlaXIgaWRlbnRpdHkgCiAgICAgICAgLy8gc2hvdWxk\nIGJlIHBlcmZvcm1lZC4KICAgICAgICBpZiAoX3Jlb3JkZXJNZXRhRGF0YVJl\nc29sdXRpb24pIHsKICAgICAgICAgICAgcHJvY2Vzc2VkID0gcmVzb2x2ZUZL\nSW5QS0RlcGVuZGVuY2llc09yZGVyaW5nKHByb2Nlc3NlZCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBwcm9jZXNzZWQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYWxsIHRoZSBtZXRhZGF0YSBpbnN0YW5jZXMgY3VycmVu\ndGx5IGluIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NNZXRhRGF0YVtdIGdldE1ldGFEYXRhcygpIHsKICAgICAgICBpZiAoX2xv\nY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpewogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldE1ldGFEYXRhc0ludGVybmFsKCk7ICAg\nIAogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\ncmV0dXJuIGdldE1ldGFEYXRhc0ludGVybmFsKCk7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGFbXSBnZXRNZXRhRGF0\nYXNJbnRlcm5hbCgpIHsKICAgICAgICAgICAgLy8gcHJldmVudCBjb25jdXJy\nZW50IG1vZCBlcnJvcnMgd2hlbiByZXNvbHZpbmcgb25lIG1ldGFkYXRhCiAg\nICAgICAgICAgIC8vIGludHJvZHVjZXMgb3RoZXJzCiAgICAgICAgICAgIENs\nYXNzTWV0YURhdGFbXSBtZXRhcyA9IChDbGFzc01ldGFEYXRhW10pIF9tZXRh\ncy52YWx1ZXMoKS50b0FycmF5KG5ldyBDbGFzc01ldGFEYXRhW19tZXRhcy5z\naXplKCldKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXRh\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChtZXRhc1tpXSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG1ldGFz\nW2ldLmdldERlc2NyaWJlZFR5cGUoKSwgbWV0YXNbaV0uZ2V0RW52Q2xhc3NM\nb2FkZXIoKSwgdHJ1ZSk7CgogICAgICAgICAgICBMaXN0PENsYXNzTWV0YURh\ndGE+IHJlc29sdmVkID0gbmV3IEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPihf\nbWV0YXMuc2l6ZSgpKTsKICAgICAgICAgICAgZm9yIChDbGFzc01ldGFEYXRh\nIG1ldGEgOiBfbWV0YXMudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAgIGlm\nIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWQu\nYWRkKG1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1ldGFzID0g\ncmVzb2x2ZWQudG9BcnJheShuZXdDbGFzc01ldGFEYXRhQXJyYXkocmVzb2x2\nZWQuc2l6ZSgpKSk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KG1ldGFzKTsK\nICAgICAgICAgICAgcmV0dXJuIG1ldGFzOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBjYWNoZWQgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBj\nbGFzcywgd2l0aG91dCBhbnkgcmVzb2x1dGlvbi4gUmV0dXJuIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0Q2Fj\naGVkTWV0YURhdGEoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgcmV0dXJuIChD\nbGFzc01ldGFEYXRhKSBfbWV0YXMuZ2V0KGNscyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdp\ndGggZGVmYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0IHRvIHRoZSByZXBvc2l0\nb3J5LCBhbmQKICAgICAqIHJldHVybiBpdC4gVXNlIHRoZSBkZWZhdWx0IGFj\nY2VzcyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBh\nZGRNZXRhRGF0YShDbGFzczw/PiBjbHMpIHsKICAgICAgICByZXR1cm4gYWRk\nTWV0YURhdGEoY2xzLCBBY2Nlc3NDb2RlLlVOS05PV04pOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IG1ldGFkYXRhLCBwb3B1bGF0ZSBp\ndCB3aXRoIGRlZmF1bHQgaW5mb3JtYXRpb24sIGFkZCBpdCB0byB0aGUgcmVw\nb3NpdG9yeSwgYW5kCiAgICAgKiByZXR1cm4gaXQuCiAgICAgKiAKICAgICAq\nIEBwYXJhbSBhY2Nlc3MKICAgICAqICAgICAgICAgICAgdGhlIGFjY2VzcyB0\neXBlIHRvIHVzZSBpbiBwb3B1bGF0aW5nIG1ldGFkYXRhCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzPD8+IGNs\ncywgaW50IGFjY2VzcykgewogICAgICAgIHJldHVybiBhZGRNZXRhRGF0YShj\nbHMsIGFjY2VzcywgZmFsc2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9wdWxhdGUgaXQgd2l0aCBkZWZh\ndWx0IGluZm9ybWF0aW9uLCBhZGQgaXQgdG8gdGhlIHJlcG9zaXRvcnksIGFu\nZAogICAgICogcmV0dXJuIGl0LgogICAgICogCiAgICAgKiBAcGFyYW0gYWNj\nZXNzCiAgICAgKiAgICAgICAgICAgIHRoZSBhY2Nlc3MgdHlwZSB0byB1c2Ug\naW4gcG9wdWxhdGluZyBtZXRhZGF0YQogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NNZXRhRGF0YSBhZGRNZXRhRGF0YShDbGFzczw/PiBjbHMsIGludCBhY2Nl\nc3MsIGJvb2xlYW4gaWdub3JlVHJhbnNpZW50KSB7CiAgICAgICAgaWYgKGNs\ncyA9PSBudWxsIHx8IGNscy5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbmV3\nQ2xhc3NNZXRhRGF0YShjbHMpOwogICAgICAgIF9mYWN0b3J5LmdldERlZmF1\nbHRzKCkucG9wdWxhdGUobWV0YSwgYWNjZXNzLCBpZ25vcmVUcmFuc2llbnQp\nOwoKICAgICAgICAvLyBzeW5jaHJvbml6ZSBvbiB0aGlzIHJhdGhlciB0aGFu\nIHRoZSBtYXAsIGJlY2F1c2UgYWxsIG90aGVyIG1ldGhvZHMKICAgICAgICAv\nLyB0aGF0IGFjY2VzcyBfbWV0YXMgYXJlIHN5bmNocm9uaXplZCBvbiB0aGlz\nCiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9u\naXplZCh0aGlzKXsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhc1B1dElu\ndGVybmFsKGNscywgbWV0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICByZXR1cm4gbWV0YXNQdXRJbnRlcm5hbChjbHMs\nIG1ldGEpOwogICAgICAgIH0KICAgICAgICAgICAgCiAgICB9CgogICAgcHJp\ndmF0ZSBDbGFzc01ldGFEYXRhIG1ldGFzUHV0SW50ZXJuYWwoQ2xhc3M8Pz4g\nY2xzLCBDbGFzc01ldGFEYXRhIG1ldGEpewogICAgICAgICAgICBpZiAoX3Bh\nd2FyZXMuY29udGFpbnNLZXkoY2xzKSkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicGMtYW5kLWF3YXJl\nIiwgY2xzKSk7CiAgICAgICAgICAgIF9tZXRhcy5wdXQoY2xzLCBtZXRhKTsK\nICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyBjbGFzcyBtZXRhZGF0YSBpbnN0YW5jZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgbmV3Q2xhc3NNZXRhRGF0YShD\nbGFzczw/PiB0eXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01ldGFE\nYXRhKHR5cGUsIHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IGFycmF5IG9mIHRoZSBwcm9wZXIgY2xhc3MgbWV0YWRhdGEgc3Vi\nY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhW10g\nbmV3Q2xhc3NNZXRhRGF0YUFycmF5KGludCBsZW5ndGgpIHsKICAgICAgICBy\nZXR1cm4gbmV3IENsYXNzTWV0YURhdGFbbGVuZ3RoXTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBmaWVsZCBtZXRhZGF0YSBpbnN0YW5j\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURhdGEgbmV3Rmll\nbGRNZXRhRGF0YShTdHJpbmcgbmFtZSwgQ2xhc3M8Pz4gdHlwZSwgQ2xhc3NN\nZXRhRGF0YSBvd25lcikgewogICAgICAgIHJldHVybiBuZXcgRmllbGRNZXRh\nRGF0YShuYW1lLCB0eXBlLCBvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgYXJyYXkgb2YgdGhlIHByb3BlciBmaWVsZCBtZXRh\nZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWV0\nYURhdGFbXSBuZXdGaWVsZE1ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkgewog\nICAgICAgIHJldHVybiBuZXcgRmllbGRNZXRhRGF0YVtsZW5ndGhdOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGFycmF5IG9mIHRoZSBw\ncm9wZXIgeG1sIGNsYXNzIG1ldGFkYXRhIHN1YmNsYXNzLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgWE1MTWV0YURhdGFbXSBuZXdYTUxDbGFzc01ldGFEYXRh\nQXJyYXkoaW50IGxlbmd0aCkgewogICAgICAgIHJldHVybiBuZXcgWE1MQ2xh\nc3NNZXRhRGF0YVtsZW5ndGhdOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgbmV3IGVtYmVkZGVkIGNsYXNzIG1ldGFkYXRhIGluc3RhbmNlLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YSBuZXdFbWJlZGRl\nZENsYXNzTWV0YURhdGEoVmFsdWVNZXRhRGF0YSBvd25lcikgewogICAgICAg\nIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YShvd25lcik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgdmFsdWUgbWV0YWRhdGEgaW5zdGFu\nY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZU1ldGFEYXRhIG5ld1Zh\nbHVlTWV0YURhdGEoRmllbGRNZXRhRGF0YSBvd25lcikgewogICAgICAgIHJl\ndHVybiBuZXcgVmFsdWVNZXRhRGF0YUltcGwob3duZXIpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGFuIHtAbGluayBPcmRlcn0gZm9yIHRoZSBn\naXZlbiBmaWVsZCBhbmQgZGVjbGFyYXRpb24uIFRoaXMgbWV0aG9kIGRlbGVn\nYXRlcyB0bwogICAgICoge0BsaW5rICNuZXdSZWxhdGVkRmllbGRPcmRlcn0g\nYW5kIHtAbGluayAjbmV3VmFsdWVGaWVsZE9yZGVyfSBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3T3JkZXIoRmllbGRNZXRh\nRGF0YSBvd25lciwgU3RyaW5nIG5hbWUsIGJvb2xlYW4gYXNjKSB7CiAgICAg\nICAgLy8gcGF0aHMgY2FuIHN0YXJ0IHdpdGggKG9yIGVxdWFsKSAnI2VsZW1l\nbnQnCiAgICAgICAgaWYgKG5hbWUuc3RhcnRzV2l0aChPcmRlci5FTEVNRU5U\nKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKE9yZGVyLkVM\nRU1FTlQubGVuZ3RoKCkpOwogICAgICAgIGlmIChuYW1lLmxlbmd0aCgpID09\nIDApCiAgICAgICAgICAgIHJldHVybiBuZXdWYWx1ZU9yZGVyKG93bmVyLCBh\nc2MpOwoKICAgICAgICAvLyBuZXh0IHRva2VuIHNob3VsZCBiZSAnLicKICAg\nICAgICBpZiAobmFtZS5jaGFyQXQoMCkgPT0gJy4nKQogICAgICAgICAgICBu\nYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CgogICAgICAgIC8vIHJlbGF0ZWQg\nZmllbGQKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBvd25lci5nZXRF\nbGVtZW50KCkuZ2V0VHlwZU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGEg\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub25wYy1maWVsZC1vcmRlcmFibGUiLCBvd25lciwg\nbmFtZSkpOwogICAgICAgIEZpZWxkTWV0YURhdGEgcmVsID0gZ2V0T3JkZXJC\neUZpZWxkKG1ldGEsIG5hbWUpOwogICAgICAgIGlmIChyZWwgPT0gbnVsbCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtZmllbGQtb3JkZXJhYmxlIiwgb3duZXIsIG5hbWUpKTsKICAg\nICAgICByZXR1cm4gbmV3UmVsYXRlZEZpZWxkT3JkZXIob3duZXIsIHJlbCwg\nYXNjKTsKICAgIH0KCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRPcmRl\nckJ5RmllbGQoQ2xhc3NNZXRhRGF0YSBtZXRhLCBTdHJpbmcgb3JkZXJCeSkg\newogICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQgPSBtZXRhLmdldEZpZWxk\nKG9yZGVyQnkpOwogICAgICAgIGlmIChmaWVsZCAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZmllbGQ7CiAgICAgICAgaW50IGRvdElkeCA9IG9yZGVy\nQnkuaW5kZXhPZigiLiIpOwogICAgICAgIGlmIChkb3RJZHggPT0gLTEpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIFN0cmluZyBmaWVsZE5h\nbWUgPSBvcmRlckJ5LnN1YnN0cmluZygwLCBkb3RJZHgpOwogICAgICAgIEZp\nZWxkTWV0YURhdGEgZmllbGQxID0gbWV0YS5nZXRGaWVsZChmaWVsZE5hbWUp\nOwogICAgICAgIGlmIChmaWVsZDEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhMSA9IGZpZWxk\nMS5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGExID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIFN0cmlu\nZyBtYXBwZWRCeTEgPSBvcmRlckJ5LnN1YnN0cmluZyhkb3RJZHggKyAxKTsK\nICAgICAgICByZXR1cm4gZ2V0T3JkZXJCeUZpZWxkKG1ldGExLCBtYXBwZWRC\neTEpOwogICAgfQoKICAgIC8qKgogICAgICogT3JkZXIgYnkgdGhlIGZpZWxk\nIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3VmFsdWVP\ncmRlcihGaWVsZE1ldGFEYXRhIG93bmVyLCBib29sZWFuIGFzYykgewogICAg\nICAgIHJldHVybiBuZXcgSW5NZW1vcnlWYWx1ZU9yZGVyKGFzYywgZ2V0Q29u\nZmlndXJhdGlvbigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9yZGVyIGJ5\nIGEgZmllbGQgb2YgdGhlIHJlbGF0ZWQgdHlwZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIE9yZGVyIG5ld1JlbGF0ZWRGaWVsZE9yZGVyKEZpZWxkTWV0YURh\ndGEgb3duZXIsIEZpZWxkTWV0YURhdGEgcmVsLCBib29sZWFuIGFzYykgewog\nICAgICAgIHJldHVybiBuZXcgSW5NZW1vcnlSZWxhdGVkRmllbGRPcmRlcihy\nZWwsIGFzYywgZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhbiBhcnJheSBvZiBvcmRlcnMgb2YgdGhlIGdpdmVu\nIHNpemUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRlcltdIG5ld09yZGVy\nQXJyYXkoaW50IHNpemUpIHsKICAgICAgICByZXR1cm4gbmV3IE9yZGVyW3Np\nemVdOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgbWV0YWRhdGEg\naW5zdGFuY2UgZnJvbSB0aGUgcmVwb3NpdG9yeS4KICAgICAqIAogICAgICog\nQHJldHVybiB0cnVlIGlmIHJlbW92ZWQsIGZhbHNlIGlmIG5vdCBpbiB0aGlz\nIHJlcG9zaXRvcnkKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3Zl\nTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1l\ndGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIHJldHVybiByZW1vdmVNZXRhRGF0YShtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBtZXRhZGF0YSBp\nbnN0YW5jZSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAgICogCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHRoaXMg\ncmVwb3NpdG9yeQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVN\nZXRhRGF0YShDbGFzczw/PiBjbHMpIHsKICAgICAgICBpZihfbG9ja2luZyl7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCh0aGlzKXsKICAgICAgICAgICAg\nICAgIHJldHVybiByZW1vdmVNZXRhRGF0YUludGVybmFsKGNscyk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgcmV0dXJuIHJl\nbW92ZU1ldGFEYXRhSW50ZXJuYWwoY2xzKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSBib29sZWFuIHJlbW92ZU1ldGFEYXRhSW50ZXJuYWwoQ2xh\nc3M8Pz4gY2xzKSB7CiAgICAgICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKF9t\nZXRhcy5yZW1vdmUoY2xzKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBD\nbGFzczw/PiBpbXBsID0gX2lmYWNlcy5yZW1vdmUoY2xzKTsKICAgICAgICAg\nICAgICAgIGlmIChpbXBsICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nX21ldGFzLnJlbW92ZShpbXBsKTsKICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBtZXRhZGF0YSBh\ncyBkZWNsYXJlZCBpbnRlcmZhY2UgaW1wbGVtZW50YXRpb24uCiAgICAgKi8K\nICAgIHZvaWQgYWRkRGVjbGFyZWRJbnRlcmZhY2VJbXBsKENsYXNzTWV0YURh\ndGEgbWV0YSwgQ2xhc3M8Pz4gaWZhY2UpIHsKICAgICAgICBpZiAoX2xvY2tp\nbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChfaW1wbHMpIHsKICAg\nICAgICAgICAgICAgIGFkZERlY2xhcmVkSW50ZXJmYWNlSW1wbEludGVybmFs\nKG1ldGEsIGlmYWNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGFkZERlY2xhcmVkSW50ZXJmYWNlSW1wbEludGVybmFs\nKG1ldGEsIGlmYWNlKTsKICAgICAgICB9CiAgICB9CgogICBwcml2YXRlIHZv\naWQgYWRkRGVjbGFyZWRJbnRlcmZhY2VJbXBsSW50ZXJuYWwoQ2xhc3NNZXRh\nRGF0YSBtZXRhLCBDbGFzczw/PiBpZmFjZSkgewogICAgICAgICAgICBDb2xs\nZWN0aW9uPENsYXNzPD8+PiB2YWxzID0gX2ltcGxzLmdldChpZmFjZSk7Cgog\nICAgICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgdGhlIHN1cGVyY2xhc3Mg\nYWxyZWFkeSBkZWNsYXJlcyB0byBhdm9pZCBkdXBzCiAgICAgICAgICAgIGlm\nICh2YWxzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgICAgICAgICAgZm9yICg7IHN1cCAhPSBudWxsOyBzdXAgPSBzdXAuZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAgICAgICAgICAgICAgICAgICBp\nZiAodmFscy5jb250YWlucyhzdXAuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfaW1wbHMsIGlmYWNlLCBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSwgZmFsc2UpOwogICAgICAgIH0KICAgIC8q\nKgogICAgICogU2V0IHRoZSBpbXBsZW1lbnRhdGlvbiBmb3IgdGhlIGdpdmVu\nIG1hbmFnZWQgaW50ZXJmYWNlLgogICAgICovCiAgICB2b2lkIHNldEludGVy\nZmFjZUltcGwoQ2xhc3NNZXRhRGF0YSBtZXRhLCBDbGFzczw/PiBpbXBsKSB7\nCiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9u\naXplZCAodGhpcykgewogICAgICAgICAgICAgICAgc2V0SW50ZXJmYWNlSW1w\nbEludGVybmFsKG1ldGEsIGltcGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgc2V0SW50ZXJmYWNlSW1wbEludGVybmFs\nKG1ldGEsIGltcGwpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgc2V0SW50ZXJmYWNlSW1wbEludGVybmFsKENsYXNzTWV0YURhdGEgbWV0\nYSwgQ2xhc3M8Pz4gaW1wbCkgewogICAgICAgICAgICBpZiAoIW1ldGEuaXNN\nYW5hZ2VkSW50ZXJmYWNlKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5hZ2VkLWludGVy\nZmFjZSIsIG1ldGEsIGltcGwpKTsKICAgICAgICAgICAgX2lmYWNlcy5wdXQo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIGltcGwpOwogICAgICAgICAgICBh\nZGREZWNsYXJlZEludGVyZmFjZUltcGwobWV0YSwgbWV0YS5nZXREZXNjcmli\nZWRUeXBlKCkpOwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IG1l\ndGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgd2hp\nbGUgKHN1cCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyByZWNvcmQg\nc3VwZXJjbGFzcyBpbnRlcmZhY2UgaW5mbyB3aGlsZSB3ZSBjYW4gYXMgd2Vs\nbCBhcyB3ZQogICAgICAgICAgICAgICAgLy8gd2lsbCBvbmx5IHJlZ2lzdGVy\nIGNvbmNyZXRlIHN1cGVyY2xhc3MgaW4gUENSZWdpc3RyeQogICAgICAgICAg\nICAgICAgc3VwLmNsZWFyU3ViY2xhc3NDYWNoZSgpOwogICAgICAgICAgICAg\nICAgYWRkVG9Db2xsZWN0aW9uKF9zdWJzLCBzdXAuZ2V0RGVzY3JpYmVkVHlw\nZSgpLCBpbXBsLCB0cnVlKTsKICAgICAgICAgICAgICAgIHN1cCA9IChDbGFz\nc01ldGFEYXRhKSBzdXAuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICB9CiAgICB9CgogICAgSW50ZXJmYWNlSW1wbEdlbmVyYXRvciBnZXRJ\nbXBsR2VuZXJhdG9yKCkgewogICAgICAgIHJldHVybiBfaW1wbEdlbjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbGVhc3QtZGVyaXZlZCBj\nbGFzcyBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGlkZW50\naXR5IG9iamVjdC4KICAgICAqIAogICAgICogQHBhcmFtIG9pZAogICAgICog\nICAgICAgICAgICB0aGUgb2lkIHRvIGdldCB0aGUgbWV0YWRhdGEgZm9yCiAg\nICAgKiBAcGFyYW0gZW52TG9hZGVyCiAgICAgKiAgICAgICAgICAgIHRoZSBl\nbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBAcGFy\nYW0gbXVzdEV4aXN0CiAgICAgKiAgICAgICAgICAgIGlmIHRydWUsIHRocm93\ncyBhIHtAbGluayBNZXRhRGF0YUV4Y2VwdGlvbn0gaWYgbm8gbWV0YWRhdGEg\naXMgZm91bmQKICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0\nTWV0YURhdGEoT2JqZWN0IG9pZCwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBi\nb29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCAm\nJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibm8tb2lkLW1ldGEiLCBvaWQsICI/IiwgX29p\nZHMudG9TdHJpbmcoKSkpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlmIChvaWQgaW5zdGFu\nY2VvZiBPcGVuSlBBSWQpIHsKICAgICAgICAgICAgQ2xhc3M8Pz4gY2xzID0g\nKChPcGVuSlBBSWQpIG9pZCkuZ2V0VHlwZSgpOwogICAgICAgICAgICByZXR1\ncm4gZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBjaGVjayBjYWNoZQogICAgICAgIHByb2Nl\nc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZMb2FkZXIpOwogICAgICAgIENsYXNz\nPD8+IGNscyA9IF9vaWRzLmdldChvaWQuZ2V0Q2xhc3MoKSk7CiAgICAgICAg\naWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURh\ndGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CgogICAgICAgIC8vIG1h\neWJlIHRoaXMgaXMgc29tZSB0eXBlIHdlJ3ZlIHNlZW4gYnV0IGp1c3QgaXNu\nJ3QgdmFsaWQKICAgICAgICBpZiAoX29pZHMuY29udGFpbnNLZXkob2lkLmdl\ndENsYXNzKCkpKSB7CiAgICAgICAgICAgIGlmIChtdXN0RXhpc3QpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLW9pZC1tZXRhIiwgb2lkLCBvaWQuZ2V0Q2xhc3MoKSwgX29pZHMp\nKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAg\nICAvLyBpZiBzdGlsbCBub3QgbWF0Y2gsIHJlZ2lzdGVyIGFueSBjbGFzc2Vz\nIHRoYXQgbG9vayBzaW1pbGFyIHRvIHRoZQogICAgICAgIC8vIG9pZCBjbGFz\ncyBhbmQgY2hlY2sgYWdhaW4KICAgICAgICByZXNvbHZlSWRlbnRpdHlDbGFz\ncyhvaWQpOwogICAgICAgIGlmIChwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMo\nZW52TG9hZGVyKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNscyA9IF9v\naWRzLmdldChvaWQuZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAgIGlmIChjbHMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShj\nbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAgICAgICB9CgogICAgICAg\nIC8vIHJlY29yZCB0aGF0IHRoaXMgaXMgYW4gaW52YWxpZCB0eXBlCiAgICAg\nICAgX29pZHMucHV0KG9pZC5nZXRDbGFzcygpLCBudWxsKTsKCiAgICAgICAg\naWYgKCFtdXN0RXhpc3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8t\nb2lkLW1ldGEiLCBvaWQsIG9pZC5nZXRDbGFzcygpLCBfb2lkcykpLnNldEZh\naWxlZE9iamVjdChvaWQpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBz\nb21lIGd1ZXNzZXMgYWJvdXQgdGhlIG5hbWUgb2YgYSB0YXJnZXQgY2xhc3Mg\nZm9yIGFuIHVua25vd24gYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3MuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXNvbHZlSWRlbnRpdHlDbGFzcyhP\nYmplY3Qgb2lkKSB7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIENsYXNzPD8+IG9pZENsYXNzID0gb2lk\nLmdldENsYXNzKCk7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicmVzb2x2ZS1p\nZGVudGl0eSIsIG9pZENsYXNzKSk7CgogICAgICAgIENsYXNzTG9hZGVyIGNs\nID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxw\nZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24ob2lkQ2xhc3MpKTsKICAgICAgICBT\ndHJpbmcgY2xhc3NOYW1lOwogICAgICAgIHdoaWxlIChvaWRDbGFzcyAhPSBu\ndWxsICYmIG9pZENsYXNzICE9IE9iamVjdC5jbGFzcykgewogICAgICAgICAg\nICBjbGFzc05hbWUgPSBvaWRDbGFzcy5nZXROYW1lKCk7CgogICAgICAgICAg\nICAvLyB3ZSB0YWtlIGEgYnJ1dGUtZm9yY2UgYXBwcm9hY2g6IHRyeSB0byBs\nb2FkIGFsbCB0aGUgY2xhc3MnCiAgICAgICAgICAgIC8vIHN1YnN0cmluZ3Mu\nIHRoaXMgd2lsbCBoYW5kbGUgdGhlIGZvbGxvd2luZyBjb21tb24gbmFtaW5n\nIGNhc2VzOgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBjb20uY29t\ncGFueS5NeUNsYXNzJElEIC0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAgICAg\nICAgICAgLy8gY29tLmNvbXBhbnkuTXlDbGFzc0lkIC0+IGNvbS5jb21wYW55\nLk15Q2xhc3MKICAgICAgICAgICAgLy8gY29tLmNvbXBhbnkuTXlDbGFzc09p\nZCAtPiBjb20uY29tcGFueS5NeUNsYXNzCiAgICAgICAgICAgIC8vIGNvbS5j\nb21wYW55Lk15Q2xhc3NQSyAtPiBjb20uY29tcGFueS5NeUNsYXNzCiAgICAg\nICAgICAgIC8vCiAgICAgICAgICAgIC8vIHRoaXMgaXNuJ3QgdGhlIGZhc3Rl\nc3QgdGhpbmcgcG9zc2libGUsIGJ1dCB0aGlzIG1ldGhvZCB3aWxsCiAgICAg\nICAgICAgIC8vIG9ubHkgYmUgY2FsbGVkIG9uY2UgcGVyIEpWTSBwZXIgdW5r\nbm93biBhcHAgaWQgY2xhc3MKICAgICAgICAgICAgZm9yIChpbnQgaSA9IGNs\nYXNzTmFtZS5sZW5ndGgoKTsgaSA+IDE7IGktLSkgewogICAgICAgICAgICAg\nICAgaWYgKGNsYXNzTmFtZS5jaGFyQXQoaSAtIDEpID09ICcuJykKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xhc3NOYW1lLnN1\nYnN0cmluZygwLCBpKSwgdHJ1ZSwgY2wpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0gLy8gY29u\nc3VtZSBhbGwgZXhjZXB0aW9ucwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBtb3ZlIHVwIHRoZSBPSUQgaGllcmFyY2h5CiAgICAgICAgICAgIG9p\nZENsYXNzID0gb2lkQ2xhc3MuZ2V0U3VwZXJjbGFzcygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgbGVhc3QtZGVyaXZl\nZCBtZXRhZGF0YXMgd2l0aCBzb21lIG1hcHBlZCBhc3NpZ25hYmxlIHR5cGUg\ndGhhdCBpbXBsZW1lbnQgdGhlIGdpdmVuCiAgICAgKiBjbGFzcy4KICAgICAq\nIAogICAgICogQHBhcmFtIGNscwogICAgICogICAgICAgICAgICB0aGUgY2xh\nc3Mgb3IgaW50ZXJmYWNlIHRvIHJldHJpZXZlIGltcGxlbWVudG9ycyBmb3IK\nICAgICAqIEBwYXJhbSBlbnZMb2FkZXIKICAgICAqICAgICAgICAgICAgdGhl\nIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVyLCBpZiBhbnkKICAgICAqIEBw\nYXJhbSBtdXN0RXhpc3QKICAgICAqICAgICAgICAgICAgaWYgdHJ1ZSwgdGhy\nb3dzIGEge0BsaW5rIE1ldGFEYXRhRXhjZXB0aW9ufSBpZiBubyBtZXRhZGF0\nYSBpcyBmb3VuZAogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtd\nIGdldEltcGxlbWVudG9yTWV0YURhdGFzKENsYXNzPD8+IGNscywgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAg\nIGlmIChjbHMgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YSIs\nIGNscykpOwogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIEVNUFRZX01FVEFTOwoKICAgICAgICAvLyBnZXQgaW1wbHMgb2Yg\nZ2l2ZW4gaW50ZXJmYWNlIC8gYWJzdHJhY3QgY2xhc3MKICAgICAgICBsb2Fk\nUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEoZW52TG9hZGVyKTsKICAgICAgICBD\nb2xsZWN0aW9uPENsYXNzPD8+PiB2YWxzID0gX2ltcGxzLmdldChjbHMpOwog\nICAgICAgIENsYXNzTWV0YURhdGFbXSBtYXBwZWQgPSBudWxsOwogICAgICAg\nIGlmICh2YWxzICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9sb2NraW5n\nKSB7CiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHZhbHMpIHsKICAg\nICAgICAgICAgICAgICAgICBtYXBwZWQgPSBnZXRJbXBsZW1lbnRvck1ldGFE\nYXRhc0ludGVybmFsKHZhbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIG1hcHBlZCA9IGdldEltcGxlbWVudG9yTWV0YURhdGFzSW50ZXJu\nYWwodmFscywgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAobWFwcGVkID09IG51bGwgJiYgbXVz\ndEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vLW1ldGEiLCBjbHMpKTsKICAgICAgICBpZiAobWFw\ncGVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9NRVRBUzsK\nICAgICAgICByZXR1cm4gbWFwcGVkOwogICAgfQoKICAgIHByaXZhdGUgQ2xh\nc3NNZXRhRGF0YVtdIGdldEltcGxlbWVudG9yTWV0YURhdGFzSW50ZXJuYWwo\nQ29sbGVjdGlvbjxDbGFzczw/Pj4gY2xhc3NlcywgQ2xhc3NMb2FkZXIgZW52\nTG9hZGVyLAogICAgICAgIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAg\nQ29sbGVjdGlvbjxDbGFzc01ldGFEYXRhPiBtYXBwZWQgPSBuZXcgQXJyYXlM\naXN0PENsYXNzTWV0YURhdGE+KGNsYXNzZXMuc2l6ZSgpKTsKICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGEgPSBudWxsOwogICAgICAgIGZvciAoQ2xhc3M8\nPz4gYyA6IGNsYXNzZXMpIHsKICAgICAgICAgICAgbWV0YSA9IGdldE1ldGFE\nYXRhKGMsIGVudkxvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChtZXRh\nLmlzTWFwcGVkKCkgfHwgbWV0YS5nZXRNYXBwZWRQQ1N1YmNsYXNzTWV0YURh\ndGFzKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbWFwcGVkLmFk\nZChtZXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbWFwcGVkLnRvQXJyYXkobmV3IENsYXNzTWV0YURhdGFbXXt9KTsKICAg\nIH0KICAgIC8qKgogICAgICogR2V0cyB0aGUgbWV0YWRhdGEgY29ycmVzcG9u\nZGluZyB0byB0aGUgZ2l2ZW4gcGVyc2lzdGVuY2UtYXdhcmUgY2xhc3MuIFJl\ndHVybnMgbnVsbCwgaWYgdGhlCiAgICAgKiBnaXZlbiBjbGFzcyBpcyBub3Qg\ncmVnaXN0ZXJlZCBhcyBwZXJzaXN0ZW5jZS1hd2FyZS4KICAgICAqLwogICAg\ncHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBnZXRQZXJzaXN0ZW5jZUF3\nYXJlKENsYXNzPD8+IGNscykgewogICAgICAgIHJldHVybiAoTm9uUGVyc2lz\ndGVudE1ldGFEYXRhKSBfcGF3YXJlcy5nZXQoY2xzKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEdldHMgYWxsIHRoZSBtZXRhZGF0YXMgZm9yIHBlcnNpc3Rl\nbmNlLWF3YXJlIGNsYXNzZXMKICAgICAqIAogICAgICogQHJldHVybiBlbXB0\neSBhcnJheSBpZiBubyBjbGFzcyBoYXMgYmVlbiByZWdpc3RlcmVkIGFzIHBl\ncnMtYXdhcmUKICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRh\nRGF0YVtdIGdldFBlcnNpc3RlbmNlQXdhcmVzKCkgewogICAgICAgIGlmIChf\nbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKF9wYXdhcmVz\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGVyc2lzdGVuY2VBd2Fy\nZXNJbnRlcm5hbCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgcmV0dXJuIGdldFBlcnNpc3RlbmNlQXdhcmVzSW50ZXJu\nYWwoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBOb25QZXJzaXN0\nZW50TWV0YURhdGFbXSBnZXRQZXJzaXN0ZW5jZUF3YXJlc0ludGVybmFsKCkg\newogICAgICAgICAgICBpZiAoX3Bhd2FyZXMuaXNFbXB0eSgpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIEVNUFRZX05PTl9QRVJTSVNURU5UOwogICAgICAg\nICAgICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdKSBfcGF3YXJl\ncy52YWx1ZXMoKS50b0FycmF5KG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGFb\nX3Bhd2FyZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\ndGhlIGdpdmVuIGNsYXNzIGFzIHBlcnNpc3RlbmNlLWF3YXJlLgogICAgICog\nCiAgICAgKiBAcGFyYW0gY2xzCiAgICAgKiAgICAgICAgICAgIG5vbi1udWxs\nIGFuZCBtdXN0IG5vdCBhbHJlYWRkeSBiZSBhZGRlZCBhcyBwZXJzaXRlbmNl\nLWNhcGFibGUKICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRh\nRGF0YSBhZGRQZXJzaXN0ZW5jZUF3YXJlKENsYXNzPD8+IGNscykgewogICAg\nICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9u\naXplZCAodGhpcykgewogICAgICAgICAgICAgICAgcmV0dXJuIGFkZFBlcnNp\nc3RlbmNlQXdhcmVJbnRlcm5hbChjbHMpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGFkZFBlcnNpc3RlbmNl\nQXdhcmVJbnRlcm5hbChjbHMpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2\nYXRlIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBhZGRQZXJzaXN0ZW5jZUF3YXJl\nSW50ZXJuYWwoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgICAgIGlmIChfcGF3\nYXJlcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIChOb25QZXJzaXN0ZW50TWV0YURhdGEpIF9wYXdhcmVzLmdldChjbHMpOwog\nICAgICAgICAgICBpZiAoZ2V0Q2FjaGVkTWV0YURhdGEoY2xzKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJwYy1hbmQtYXdhcmUiLCBjbHMpKTsKICAgICAgICAgICAg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhIG1ldGEgPQogICAgICAgICAgICAgICAg\nbmV3IE5vblBlcnNpc3RlbnRNZXRhRGF0YShjbHMsIHRoaXMsIE5vblBlcnNp\nc3RlbnRNZXRhRGF0YS5UWVBFX1BFUlNJU1RFTkNFX0FXQVJFKTsKICAgICAg\nICAgICAgX3Bhd2FyZXMucHV0KGNscywgbWV0YSk7CiAgICAgICAgICAgIHJl\ndHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgcGVy\nc2l0ZW5jZS1hd2FyZSBjbGFzcyBmcm9tIHRoZSByZXBvc2l0b3J5CiAgICAg\nKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZVBlcnNpc3RlbmNlQXdhcmUoQ2xhc3M8\nPz4gY2xzKSB7CiAgICAgICAgcmV0dXJuIF9wYXdhcmVzLnJlbW92ZShjbHMp\nICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtZXRh\nZGF0YSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBub24tbWFwcGVkIGlu\ndGVyZmFjZS4gUmV0dXJucyBudWxsLCBpZiB0aGUgZ2l2ZW4KICAgICAqIGlu\ndGVyZmFjZSBpcyBub3QgcmVnaXN0ZXJlZCBhcyBwZXJzaXN0ZW5jZS1hd2Fy\nZS4KICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBn\nZXROb25NYXBwZWRJbnRlcmZhY2UoQ2xhc3M8Pz4gaWZhY2UpIHsKICAgICAg\nICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSkgX25vbk1hcHBlZC5n\nZXQoaWZhY2UpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgY29y\ncmVzcG9uZGluZyBtZXRhZGF0YXMgZm9yIGFsbCByZWdpc3RlcmVkLCBub24t\nbWFwcGVkIGludGVyZmFjZXMKICAgICAqIAogICAgICogQHJldHVybiBlbXB0\neSBhcnJheSBpZiBubyBub24tbWFwcGVkIGludGVyZmFjZSBoYXMgYmVlbiBy\nZWdpc3RlcmVkLgogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1l\ndGFEYXRhW10gZ2V0Tm9uTWFwcGVkSW50ZXJmYWNlcygpIHsKICAgICAgICBp\nZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChfbm9u\nTWFwcGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Tm9uTWFwcGVk\nSW50ZXJmYWNlc0ludGVybmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0Tm9uTWFwcGVkSW50ZXJm\nYWNlc0ludGVybmFsKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gZ2V0Tm9uTWFwcGVkSW50ZXJmYWNl\nc0ludGVybmFsKCkgewogICAgICAgICAgICBpZiAoX25vbk1hcHBlZC5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRU1QVFlfTk9OX1BFUlNJ\nU1RFTlQ7CiAgICAgICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFE\nYXRhW10pIF9ub25NYXBwZWQudmFsdWVzKCkudG9BcnJheShuZXcgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhW19ub25NYXBwZWQuc2l6ZSgpXSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIG5vbi1tYXBwZWQgaW50ZXJm\nYWNlIHRvIHRoZSByZXBvc2l0b3J5LgogICAgICogCiAgICAgKiBAcGFyYW0g\naWZhY2UKICAgICAqICAgICAgICAgICAgdGhlIG5vbi1tYXBwZWQgaW50ZXJm\nYWNlCiAgICAgKi8KICAgIHB1YmxpYyBOb25QZXJzaXN0ZW50TWV0YURhdGEg\nYWRkTm9uTWFwcGVkSW50ZXJmYWNlKENsYXNzPD8+IGlmYWNlKSB7CiAgICAg\nICAgaWYgKGlmYWNlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIGlmICghaWZhY2UuaXNJbnRlcmZhY2UoKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qt\nbm9uLW1hcHBlZCIsIGlmYWNlKSk7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAg\nICAgICAgcmV0dXJuIGFkZE5vbk1hcHBlZEludGVyZmFjZUludGVybmFsKGlm\nYWNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIHJldHVybiBhZGROb25NYXBwZWRJbnRlcmZhY2VJbnRlcm5hbChpZmFj\nZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcml2YXRlIE5vblBlcnNp\nc3RlbnRNZXRhRGF0YSBhZGROb25NYXBwZWRJbnRlcmZhY2VJbnRlcm5hbChD\nbGFzczw/PiBpZmFjZSkgewogICAgICAgICAgICBpZiAoX25vbk1hcHBlZC5j\nb250YWluc0tleShpZmFjZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gKE5v\nblBlcnNpc3RlbnRNZXRhRGF0YSkgX25vbk1hcHBlZC5nZXQoaWZhY2UpOwog\nICAgICAgICAgICBpZiAoZ2V0Q2FjaGVkTWV0YURhdGEoaWZhY2UpICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vbi1tYXBwZWQtcGMiLCBpZmFjZSkpOwogICAgICAg\nICAgICBOb25QZXJzaXN0ZW50TWV0YURhdGEgbWV0YSA9CiAgICAgICAgICAg\nICAgICBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhKGlmYWNlLCB0aGlzLCBO\nb25QZXJzaXN0ZW50TWV0YURhdGEuVFlQRV9OT05fTUFQUEVEX0lOVEVSRkFD\nRSk7CiAgICAgICAgICAgIF9ub25NYXBwZWQucHV0KGlmYWNlLCBtZXRhKTsK\nICAgICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICAgICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIGEgbm9uLW1hcHBlZCBpbnRlcmZhY2UgZnJvbSB0aGUg\ncmVwb3NpdG9yeQogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVt\nb3ZlZAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVOb25NYXBw\nZWRJbnRlcmZhY2UoQ2xhc3M8Pz4gaWZhY2UpIHsKICAgICAgICByZXR1cm4g\nX25vbk1hcHBlZC5yZW1vdmUoaWZhY2UpICE9IG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDbGVhciB0aGUgY2FjaGUgb2YgcGFyc2VkIG1ldGFkYXRh\nLiBUaGlzIG1ldGhvZCBhbHNvIGNsZWFycyB0aGUgaW50ZXJuYWwKICAgICAq\nIHtAbGluayBNZXRhRGF0YUZhY3RvcnkgTWV0YURhdGFGYWN0b3J5fSdzIGNh\nY2hlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nX2xvZy50cmFjZShfbG9jLmdldCgiY2xlYXItcmVwb3MiLCB0aGlzKSk7CiAg\nICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICAgICAgY2xlYXJJbnRlcm5hbCgpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2xl\nYXJJbnRlcm5hbCgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgY2xlYXJJbnRlcm5hbCgpewogICAgICAgIC8vIFJlY3JlYXRpbmcgdGhl\nc2UgZGF0YXN0cnVjdHVyZXMgaXMgcHJvYmFibHkgZmFzdGVyIHRoYW4gY2Fs\nbGluZyBjbGVhci4gRnV0dXJlIGNoYW5nZT8KICAgICAgICAgICAgX21ldGFz\nLmNsZWFyKCk7CiAgICAgICAgICAgIF9vaWRzLmNsZWFyKCk7CiAgICAgICAg\nICAgIF9zdWJzLmNsZWFyKCk7CiAgICAgICAgICAgIF9pbXBscy5jbGVhcigp\nOwogICAgICAgICAgICBfcXVlcmllcy5jbGVhcigpOwogICAgICAgICAgICBf\nc2Vxcy5jbGVhcigpOwogICAgICAgICAgICBfcmVnaXN0ZXJlZC5jbGVhcigp\nOwogICAgICAgICAgICBfZmFjdG9yeS5jbGVhcigpOwogICAgICAgICAgICBf\nYWxpYXNlcy5jbGVhcigpOwogICAgICAgICAgICBfcGF3YXJlcy5jbGVhcigp\nOwogICAgICAgICAgICBfbm9uTWFwcGVkLmNsZWFyKCk7CiAgICB9CiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgc2V0IG9mIGNvbmZpZ3VyZWQgcGVyc2lz\ndGVudCBjbGFzc2VzLCBvciBudWxsIGlmIHRoZSB1c2VyIGRpZCBub3QgY29u\nZmlndXJlIGFueS4KICAgICAqIAogICAgICogQHBhcmFtIGRldnBhdGgKICAg\nICAqICAgICAgICAgICAgaWYgdHJ1ZSwgc2VhcmNoIGZvciBtZXRhZGF0YSBm\naWxlcyBpbiBkaXJlY3RvcmllcyBpbiB0aGUgY2xhc3NwYXRoIGlmIG5vIGNs\nYXNzZXMKICAgICAqICAgICAgICAgICAgYXJlIGNvbmZpZ3VyZWQgZXhwbGlj\naXRseQogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICogICAgICAgICAg\nICB0aGUgY2xhc3MgbG9hZGVyIHRvIHVzZSwgb3IgbnVsbCBmb3IgZGVmYXVs\ndAogICAgICovCiAgICBwdWJsaWMgU2V0PFN0cmluZz4gZ2V0UGVyc2lzdGVu\ndFR5cGVOYW1lcyhib29sZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVudkxv\nYWRlcikgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBz\neW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQZXJzaXN0ZW50VHlwZU5hbWVzSW50ZXJuYWwoZGV2cGF0aCwgZW52TG9h\nZGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIHJldHVybiBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzSW50ZXJuYWwoZGV2\ncGF0aCwgZW52TG9hZGVyKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSBTZXQ8U3RyaW5nPiBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzSW50ZXJuYWwo\nYm9vbGVhbiBkZXZwYXRoLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAg\nICAgICByZXR1cm4gX2ZhY3RvcnkuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhk\nZXZwYXRoLCBlbnZMb2FkZXIpOwogICAgfQogICAgLyoqCiAgICAgKiBMb2Fk\nIHRoZSBwZXJzaXN0ZW50IGNsYXNzZXMgbmFtZWQgaW4gY29uZmlndXJhdGlv\nbi4KICAgICAqIFRoaXMgZW5zdXJlcyB0aGF0IGFsbCBzdWJjbGFzc2VzIGFu\nZCBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzc2VzIG9mCiAgICAgKiBlYWNo\nIHR5cGUgYXJlIGtub3duIGluIGFkdmFuY2UsIHdpdGhvdXQgaGF2aW5nIHRv\nIHJlbHkgb24gdGhlCiAgICAgKiBhcHBsaWNhdGlvbiBsb2FkaW5nIHRoZSBj\nbGFzc2VzIGJlZm9yZSBwZXJmb3JtaW5nIG9wZXJhdGlvbnMgdGhhdAogICAg\nICogbWlnaHQgaW52b2x2ZSB0aGVtLgogICAgICoKICAgICAqIEBwYXJhbSBk\nZXZwYXRoIGlmIHRydWUsIHNlYXJjaCBmb3IgbWV0YWRhdGEgZmlsZXMgaW4g\nZGlyZWN0b3JpZXMKICAgICAqIGluIHRoZSBjbGFzc3BhdGggaWYgdGhlIG5v\nIGNsYXNzZXMgYXJlIGNvbmZpZ3VyZWQgZXhwbGljaXRseQogICAgICogQHBh\ncmFtIGVudkxvYWRlciB0aGUgY2xhc3MgbG9hZGVyIHRvIHVzZSwgb3IgbnVs\nbCBmb3IgZGVmYXVsdAogICAgICogQHJldHVybiB0aGUgbG9hZGVkIGNsYXNz\nZXMsIG9yIGVtcHR5IGNvbGxlY3Rpb24gaWYgbm9uZQogICAgICovCiAgICBw\ndWJsaWMgQ29sbGVjdGlvbjxDbGFzczw/Pj4gbG9hZFBlcnNpc3RlbnRUeXBl\ncyhib29sZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewog\nICAgICAgIHJldHVybiBsb2FkUGVyc2lzdGVudFR5cGVzKGRldnBhdGgsIGVu\ndkxvYWRlciwgZmFsc2UpOwogICAgfQogICAgLyoqCiAgICAgKiBMb2FkIHRo\nZSBwZXJzaXN0ZW50IGNsYXNzZXMgbmFtZWQgaW4gY29uZmlndXJhdGlvbi4g\nVGhpcyBlbnN1cmVzIHRoYXQgYWxsIHN1YmNsYXNzZXMgYW5kCiAgICAgKiBh\ncHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzc2VzIG9mIGVhY2ggdHlwZSBhcmUg\na25vd24gaW4gYWR2YW5jZSwgd2l0aG91dCBoYXZpbmcgdG8gcmVseSBvbiB0\naGUKICAgICAqIGFwcGxpY2F0aW9uIGxvYWRpbmcgdGhlIGNsYXNzZXMgYmVm\nb3JlIHBlcmZvcm1pbmcgb3BlcmF0aW9ucyB0aGF0IG1pZ2h0IGludm9sdmUg\ndGhlbS4KICAgICAqIAogICAgICogQHBhcmFtIGRldnBhdGgKICAgICAqICAg\nICAgICAgICAgaWYgdHJ1ZSwgc2VhcmNoIGZvciBtZXRhZGF0YSBmaWxlcyBp\nbiBkaXJlY3RvcmllcyBpbiB0aGUgY2xhc3NwYXRoIGlmIHRoZSBubwogICAg\nICogICAgICAgICAgICBjbGFzc2VzIGFyZSBjb25maWd1cmVkIGV4cGxpY2l0\nbHkKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIKICAgICAqICAgICAgICAgICAg\ndGhlIGNsYXNzIGxvYWRlciB0byB1c2UsIG9yIG51bGwgZm9yIGRlZmF1bHQK\nICAgICAqIEBwYXJhbSBtdXN0RXhpc3QKICAgICAqICAgICAgICAgICAgaWYg\ndHJ1ZSB0aGVuIGVtcHR5IGxpc3Qgb2YgY2xhc3NlcyBvciBhbnkgdW5sb2Fk\nYWJsZSBidXQgc3BlY2lmaWVkIGNsYXNzIHdpbGwKICAgICAqICAgICAgICAg\nICAgcmFpc2UgYW4gZXhjZXB0aW9uLgogICAgICogQHJldHVybiB0aGUgbG9h\nZGVkIGNsYXNzZXMsIG9yIGVtcHR5IGNvbGxlY3Rpb24gaWYgbm9uZQogICAg\nICovCiAgICBwdWJsaWMgQ29sbGVjdGlvbjxDbGFzczw/Pj4gbG9hZFBlcnNp\nc3RlbnRUeXBlcyhib29sZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVudkxv\nYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBpZiAoX2xvY2tp\nbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gbG9hZFBlcnNpc3RlbnRUeXBlc0ludGVybmFs\nKGRldnBhdGgsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBsb2FkUGVy\nc2lzdGVudFR5cGVzSW50ZXJuYWwoZGV2cGF0aCwgZW52TG9hZGVyLCBtdXN0\nRXhpc3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIENvbGxlY3Rp\nb248Q2xhc3M8Pz4+IGxvYWRQZXJzaXN0ZW50VHlwZXNJbnRlcm5hbChib29s\nZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVudkxvYWRlciwgCiAgICAgICAg\nYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICAgICAgU2V0PFN0cmluZz4g\nbmFtZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGRldnBhdGgsIGVudkxv\nYWRlcik7CiAgICAgICAgICAgIGlmIChuYW1lcyA9PSBudWxsIHx8IG5hbWVz\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgaWYgKCFtdXN0RXhpc3Qp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5\nTGlzdCgpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZWFn\nZXItbm8tY2xhc3MtZm91bmQiKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGF0dGVtcHQgdG8gbG9hZCBjbGFzc2VzIHNvIHRoYXQgdGhleSBn\nZXQgcHJvY2Vzc2VkCiAgICAgICAgICAgIENsYXNzTG9hZGVyIGNsc0xvYWRl\nciA9IF9jb25mLmdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLmdldENsYXNz\nTG9hZGVyKGdldENsYXNzKCksIGVudkxvYWRlcik7CiAgICAgICAgICAgIExp\nc3Q8Q2xhc3M8Pz4+IGNsYXNzZXMgPSBuZXcgQXJyYXlMaXN0PENsYXNzPD8+\nPihuYW1lcy5zaXplKCkpOwogICAgICAgICAgICBDbGFzczw/PiBjbHM7CiAg\nICAgICAgICAgIGZvciAoU3RyaW5nIGNsYXNzTmFtZSA6IG5hbWVzKSB7CiAg\nICAgICAgICAgICAgICBjbHMgPSBjbGFzc0Zvck5hbWUoY2xhc3NOYW1lLCBj\nbHNMb2FkZXIpOwogICAgICAgICAgICAgICAgaWYgKF9mYWN0b3J5LmlzTWV0\nYUNsYXNzKGNscykpIHsKICAgICAgICAgICAgICAgICAgICBzZXRNZXRhTW9k\nZWwoY2xzKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgIGNsYXNzZXMuYWRkKGNscyk7CgogICAg\nICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBjbGFzcyBpcyBhbiBpbnRlcmZh\nY2UsIGxvYWQgaXRzIG1ldGFkYXRhIHRvIGtpY2sKICAgICAgICAgICAgICAg\nICAgICAvLyBvZmYgdGhlIGltcGwgZ2VuZXJhdG9yCiAgICAgICAgICAgICAg\nICAgICAgaWYgKGNscy5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YShjbHMsIGNsc0xvYWRlciwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjbHMgPT0gbnVsbCAmJiBtdXN0\nRXhpc3QpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImVhZ2VyLWNsYXNzLW5vdC1mb3VuZCIs\nIGNsYXNzTmFtZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBjbGFzc2VzOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjbGFzcyBmb3IgdGhlIGdpdmVuIG5hbWUsIG9y\nIG51bGwgaWYgbm90IGxvYWRhYmxlLgogICAgICovCiAgICBwcml2YXRlIENs\nYXNzPD8+IGNsYXNzRm9yTmFtZShTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIg\nbG9hZGVyKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENs\nYXNzLmZvck5hbWUobmFtZSwgdHJ1ZSwgbG9hZGVyKTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoKF92YWxpZGF0\nZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9nLndhcm4oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5h\nbWUsIGxvYWRlcikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9sb2cuaXNJ\nbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2Mu\nZ2V0KCJiYWQtZGlzY292ZXItY2xhc3MiLCBuYW1lLCBsb2FkZXIpKTsKICAg\nICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgIF9sb2cudHJhY2UoZSk7CiAgICAgICAgfSBjYXRjaCAoTm9TdWNo\nTWV0aG9kRXJyb3IgbnNtZSkgewogICAgICAgICAgICBpZiAobnNtZS5nZXRN\nZXNzYWdlKCkuaW5kZXhPZigiLnBjIikgPT0gLTEpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuc21lOwoKICAgICAgICAgICAgLy8gaWYgdGhlIGVycm9yIGlz\nIGFib3V0IGEgbWV0aG9kIHRoYXQgdXNlcyB0aGUgUGVyc2lzdGVuY2VDYXBh\nYmxlCiAgICAgICAgICAgIC8vICdwYycgbWV0aG9kIHByZWZpeCwgcGVyZm9y\nbSBzb21lIGxvZ2dpbmcgYW5kIGNvbnRpbnVlLiBUaGlzCiAgICAgICAgICAg\nIC8vIHByb2JhYmx5IGp1c3QgbWVhbnMgdGhhdCB0aGUgY2xhc3MgaXMgbm90\nIHlldCBlbmhhbmNlZC4KICAgICAgICAgICAgaWYgKChfdmFsaWRhdGUgJiBW\nQUxJREFURV9SVU5USU1FKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJiYWQtZGlzY292ZXItY2xhc3MiLCBuYW1lLCBs\nb2FkZXIpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfbG9nLmlzSW5mb0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgi\nYmFkLWRpc2NvdmVyLWNsYXNzIiwgbmFtZSwgbG9hZGVyKSk7CiAgICAgICAg\nICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBfbG9nLnRyYWNlKG5zbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwga25vd24g\nc3ViY2xhc3NlcyBmb3IgdGhlIGdpdmVuIGNsYXNzIG1hcHBpbmcuIE5vdGUg\ndGhhdCB0aGlzIG1ldGhvZCBvbmx5IHdvcmtzCiAgICAgKiBkdXJpbmcgcnVu\ndGltZSB3aGVuIHRoZSByZXBvc2l0b3J5IGlzIHJlZ2lzdGVyZWQgYXMgYSB7\nQGxpbmsgUmVnaXN0ZXJDbGFzc0xpc3RlbmVyfS4KICAgICAqLwogICAgQ29s\nbGVjdGlvbjxDbGFzczw/Pj4gZ2V0UENTdWJjbGFzc2VzKENsYXNzPD8+IGNs\ncykgewogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHN1YnMgPSBfc3Vi\ncy5nZXQoY2xzKTsKICAgICAgICBpZiAoc3VicyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CiAgICAgICAg\ncmV0dXJuIHN1YnM7CiAgICB9CgogICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlZ2lzdGVyQ2xhc3NMaXN0\nZW5lciBpbXBsZW1lbnRhdGlvbgogICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCByZWdpc3Rl\ncihDbGFzczw/PiBjbHMpIHsKICAgICAgICAvLyBidWZmZXIgcmVnaXN0ZXJl\nZCBjbGFzc2VzIHVudGlsIGFuIG9pZCBtZXRhZGF0YSByZXF1ZXN0IGlzIG1h\nZGUsCiAgICAgICAgLy8gYXQgd2hpY2ggcG9pbnQgd2UnbGwgcGFyc2UgZXZl\ncnl0aGluZyBpbiB0aGUgYnVmZmVyCiAgICAgICAgaWYgKF9sb2NraW5nKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoX3JlZ2lzdGVyZWQpIHsKICAg\nICAgICAgICAgICAgIF9yZWdpc3RlcmVkLmFkZChjbHMpOwogICAgICAgICAg\nICAgICAgcmVnaXN0ZXJBbGlhcyhjbHMpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgX3JlZ2lzdGVyZWQuYWRkKGNscyk7\nCiAgICAgICAgICAgIHJlZ2lzdGVyQWxpYXMoY2xzKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZXMgdGhlIG1ldGFkYXRhIGZvciBh\nbGwgcmVnaXN0ZXJlZCBjbGFzc2VzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgbG9hZFJlZ2lzdGVyZWRDbGFzc01ldGFEYXRhKENsYXNzTG9hZGVyIGVu\ndkxvYWRlcikgewogICAgICAgIENsYXNzPD8+W10gcmVnID0gcHJvY2Vzc1Jl\nZ2lzdGVyZWRDbGFzc2VzKGVudkxvYWRlcik7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCByZWcubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKHJlZ1tpXSwgZW52TG9h\nZGVyLCBmYWxzZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE1ldGFEYXRhRXhj\nZXB0aW9uIG1lKSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5F\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKG1lKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFVwZGF0ZXMgb3VyIGRhdGFzdHJ1Y3R1cmVzIHdpdGggdGhlIGxhdGVzdCBy\nZWdpc3RlcmVkIGNsYXNzZXMuCiAgICAgKi8KICAgIENsYXNzPD8+W10gcHJv\nY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKENsYXNzTG9hZGVyIGVudkxvYWRlcikg\newogICAgICAgIGlmIChfcmVnaXN0ZXJlZC5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybiBFTVBUWV9DTEFTU0VTOwoKICAgICAgICAvLyBjb3B5IGlu\ndG8gbmV3IGNvbGxlY3Rpb24gdG8gYXZvaWQgY29uY3VycmVudCBtb2QgZXJy\nb3JzIG9uIHJlZW50cmFudAogICAgICAgIC8vIHJlZ2lzdHJhdGlvbnMKICAg\nICAgICBDbGFzczw/PltdIHJlZzsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsK\nICAgICAgICAgICAgc3luY2hyb25pemVkIChfcmVnaXN0ZXJlZCkgewogICAg\nICAgICAgICAgICAgcmVnID0gX3JlZ2lzdGVyZWQudG9BcnJheShuZXcgQ2xh\nc3NbX3JlZ2lzdGVyZWQuc2l6ZSgpXSk7CiAgICAgICAgICAgICAgICBfcmVn\naXN0ZXJlZC5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcmVnID0gX3JlZ2lzdGVyZWQudG9BcnJheShuZXcg\nQ2xhc3NbX3JlZ2lzdGVyZWQuc2l6ZSgpXSk7CiAgICAgICAgICAgIF9yZWdp\nc3RlcmVkLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIAoKICAgICAgICBD\nb2xsZWN0aW9uPFN0cmluZz4gcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBl\nTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7CiAgICAgICAgQ29sbGVjdGlvbjxD\nbGFzczw/Pj4gZmFpbGVkID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHJlZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBkb24n\ndCBwcm9jZXNzIHR5cGVzIHRoYXQgYXJlbid0IGxpc3RlZCBieSB0aGUgdXNl\ncjsgbWF5IGJlbG9uZwogICAgICAgICAgICAvLyB0byBhIGRpZmZlcmVudCBw\nZXJzaXN0ZW5jZSB1bml0CiAgICAgICAgICAgIGlmIChwY05hbWVzICE9IG51\nbGwgJiYgIXBjTmFtZXMuaXNFbXB0eSgpICYmICFwY05hbWVzLmNvbnRhaW5z\nKHJlZ1tpXS5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcHJvY2Vzc1Jl\nZ2lzdGVyZWRDbGFzcyhyZWdbaV0pOwogICAgICAgICAgICB9IGNhdGNoIChU\naHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAgaWYgKCFfY29uZi5nZXRS\nZXRyeUNsYXNzUmVnaXN0cmF0aW9uKCkpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlcnJvci1y\nZWdpc3RlcmVkIiwgcmVnW2ldKSwgdCk7CgogICAgICAgICAgICAgICAgaWYg\nKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgiZmFpbGVkLXJlZ2lzdGVyZWQiLCByZWdbaV0p\nLCB0KTsKICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0PENsYXNz\nPD8+PigpOwogICAgICAgICAgICAgICAgZmFpbGVkLmFkZChyZWdbaV0pOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChmYWlsZWQgIT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgICAgIHN5bmNocm9uaXplZCAoX3JlZ2lzdGVyZWQpIHsKICAgICAgICAg\nICAgICAgICAgICBfcmVnaXN0ZXJlZC5hZGRBbGwoZmFpbGVkKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIF9yZWdpc3RlcmVkLmFkZEFsbChmYWlsZWQpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiByZWc7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBVcGRhdGVzIG91ciBkYXRhc3RydWN0dXJlcyB3aXRoIHRoZSBn\naXZlbiByZWdpc3RlcmVkIGNsYXNzLiBSZWxpZXMgb24gdGhlIGZhY3QgdGhh\ndCBhIGNoaWxkCiAgICAgKiBjbGFzcyBjYW5ub3QgcmVnaXN0ZXIgaXRzZWxm\nIHdpdGhvdXQgYWxzbyByZWdpc3RlcmluZyBpdHMgcGFyZW50IGNsYXNzIGJ5\nIHNwZWNpZnlpbmcgaXRzCiAgICAgKiBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1\ncGVyY2xhc3MgaW4gdGhlIHJlZ2lzdHJhdGlvbiBldmVudC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3MoQ2xhc3M8\nPz4gY2xzKSB7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicHJvY2Vzcy1yZWdp\nc3RlcmVkIiwgY2xzKSk7CgogICAgICAgIC8vIHVwZGF0ZSBzdWJjbGFzcyBs\naXN0czsgc3luY2hyb25pemUgb24gdGhpcyBiZWNhdXNlIGFjY2Vzc2luZyBf\nbWV0YXMKICAgICAgICAvLyByZXF1aXJlcyBpdAogICAgICAgIENsYXNzPD8+\nIGxlYXN0RGVyaXZlZCA9IGNsczsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAg\nICAgICBmb3IgKENsYXNzPD8+IGFuYyA9IGNsczsgKGFuYyA9IFBDUmVnaXN0\ncnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3MoYW5jKSkgIT0gbnVsbDspIHsK\nICAgICAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfc3VicywgYW5jLCBj\nbHMsIHRydWUpOwogICAgICAgICAgICAgICAgbWV0YSA9IChDbGFzc01ldGFE\nYXRhKSBfbWV0YXMuZ2V0KGFuYyk7CiAgICAgICAgICAgICAgICBpZiAobWV0\nYSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG1ldGEuY2xlYXJTdWJj\nbGFzc0NhY2hlKCk7CiAgICAgICAgICAgICAgICBsZWFzdERlcml2ZWQgPSBh\nbmM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\nLy8gdXBkYXRlIG9pZCBtYXBwaW5ncyBpZiB0aGlzIGlzIGEgYmFzZSBjb25j\ncmV0ZSBjbGFzcwogICAgICAgIE9iamVjdCBvaWQgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIG9pZCA9IFBDUmVnaXN0cnkubmV3T2JqZWN0\nSWQoY2xzKTsKICAgICAgICB9IGNhdGNoIChJbnRlcm5hbEV4Y2VwdGlvbiBp\nZSkgewogICAgICAgICAgICAvLyB0aHJvd24gZm9yIHNpbmdsZSBmaWVsZCBp\nZGVudGl0eSB3aXRoIG51bGwgcGsgZmllbGQgdmFsdWUKICAgICAgICB9CiAg\nICAgICAgaWYgKG9pZCAhPSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzPD8+\nIGV4aXN0aW5nID0gX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAg\nICAgICAgaWYgKGV4aXN0aW5nICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIC8vIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBjbGFzcyBmb3IgdGhpcyBPSUQs\nIHRoZW4gd2Uga25vdwogICAgICAgICAgICAgICAgLy8gdGhhdCBtdWx0aXBs\nZSBjbGFzc2VzIGFyZSB1c2luZyB0aGUgc2FtZSBPSUQ6IHRoZXJlZm9yZSwK\nICAgICAgICAgICAgICAgIC8vIHB1dCB0aGUgbGVhc3QgZGVyaXZlZCBQQyBz\ndXBlcmNsYXNzIGludG8gdGhlIG1hcC4gVGhpcwogICAgICAgICAgICAgICAg\nLy8gZ2V0cyBhcm91bmQgdGhlIHByb2JsZW0gb2YgYW4gYWJzdHJhY3QgUEMg\nc3VwZXJjbGFzcwogICAgICAgICAgICAgICAgLy8gdXNpbmcgYXBwbGljYXRp\nb24gaWRlbnRpdHkgKHNpbmNlIG5ld09iamVjdElkCiAgICAgICAgICAgICAg\nICAvLyB3aWxsIHJldHVybiBudWxsIGZvciBhYnN0cmFjdCBjbGFzc2VzKS4K\nICAgICAgICAgICAgICAgIENsYXNzPD8+IHN1cCA9IGNsczsKICAgICAgICAg\nICAgICAgIHdoaWxlIChQQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNs\nYXNzKHN1cCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzdXAgPSBQ\nQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKHN1cCk7CgogICAg\nICAgICAgICAgICAgX29pZHMucHV0KG9pZC5nZXRDbGFzcygpLCBzdXApOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKGV4aXN0aW5nID09IG51bGwgfHwgY2xz\nLmlzQXNzaWduYWJsZUZyb20oZXhpc3RpbmcpKQogICAgICAgICAgICAgICAg\nX29pZHMucHV0KG9pZC5nZXRDbGFzcygpLCBjbHMpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdXBkYXRlIG1hcHBpbmdzIGZyb20gaW50ZXJmYWNlcyBhbmQg\nbm9uLXBjIHN1cGVyY2xhc3NlcyB0bwogICAgICAgIC8vIHBjIGltcGxlbWVu\ndGluZyB0eXBlcwogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAg\nICBzeW5jaHJvbml6ZWQgKF9pbXBscykgewogICAgICAgICAgICAgICAgdXBk\nYXRlSW1wbHMoY2xzLCBsZWFzdERlcml2ZWQsIGNscyk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cGRhdGVJbXBscyhj\nbHMsIGxlYXN0RGVyaXZlZCwgY2xzKTsKICAgICAgICB9CgogICAgICAgIC8v\nIHNldCBhbGlhcyBmb3IgY2xhc3MKICAgICAgICByZWdpc3RlckFsaWFzKGNs\ncyk7CiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBSZWdpc3RlciB0\naGUgZ2l2ZW4gY2xhc3MgdG8gdGhlIGxpc3Qgb2Yga25vd24gYWxpYXNlcy4K\nICAgICAqIFRoZSBhbGlhcyBpcyByZWdpc3RlcmVkIG9ubHkgaWYgdGhlIGNs\nYXNzIGhhcyBiZWVuIGVuaGFuY2VkLgogICAgICogCiAgICAgKi8KICAgIHZv\naWQgcmVnaXN0ZXJBbGlhcyhDbGFzczw/PiBjbHMpIHsKICAgICAgICByZWdp\nc3RlckFsaWFzKFBDUmVnaXN0cnkuZ2V0VHlwZUFsaWFzKGNscyksIGNscyk7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVyQWxpYXMoU3Ry\naW5nIGFsaWFzLCBDbGFzczw/PiBjbHMpIHsKICAgICAgICBpZiAoYWxpYXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChhbGlhcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBMaXN0PENsYXNzPD8+PiBjbGFzc2VzID0gX2FsaWFzZXMuZ2V0KGFsaWFz\nKTsKICAgICAgICAgICAgICAgIGlmIChjbGFzc2VzID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgY2xhc3NlcyA9IG5ldyBBcnJheUxpc3Q8Q2xhc3M8\nPz4+KDMpOwogICAgICAgICAgICAgICAgaWYgKCFjbGFzc2VzLmNvbnRhaW5z\nKGNscykpIHsKICAgICAgICAgICAgICAgICAgICBjbGFzc2VzLmFkZChjbHMp\nOwogICAgICAgICAgICAgICAgICAgIF9hbGlhc2VzLnB1dChhbGlhcywgY2xh\nc3Nlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGNhdGNoIChJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaXNlKSB7CiAgICAg\nICAgICAgIC8vIHRoZSBjbGFzcyBoYXMgbm90IGJlZW4gcmVnaXN0ZXJlZCB0\nbyBQQ1JlZ2lzdHJ5CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVXBkYXRlIHRoZSBsaXN0IG9mIGltcGxlbWVudGF0aW9ucyBvZiBiYXNlIGNs\nYXNzZXMgYW5kIGludGVyZmFjZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB1cGRhdGVJbXBscyhDbGFzczw/PiBjbHMsIENsYXNzPD8+IGxlYXN0RGVy\naXZlZCwgQ2xhc3M8Pz4gY2hlY2spIHsKICAgICAgICAvLyBhbGxvdyB1c2Vy\ncyB0byBxdWVyeSBvbiBjb21tb24gbm9uLXBjIHN1cGVyY2xhc3NlcwogICAg\nICAgIENsYXNzPD8+IHN1cCA9IGNoZWNrLmdldFN1cGVyY2xhc3MoKTsKICAg\nICAgICBpZiAobGVhc3REZXJpdmVkID09IGNscyAmJiBzdXAgIT0gbnVsbCAm\nJiBzdXAgIT0gT2JqZWN0LmNsYXNzKSB7CiAgICAgICAgICAgIGFkZFRvQ29s\nbGVjdGlvbihfaW1wbHMsIHN1cCwgY2xzLCBmYWxzZSk7CiAgICAgICAgICAg\nIHVwZGF0ZUltcGxzKGNscywgbGVhc3REZXJpdmVkLCBzdXApOwogICAgICAg\nIH0KCiAgICAgICAgLy8gYWxsb3cgdXNlcnMgdG8gcXVlcnkgb24gYW55IGlt\ncGxlbWVudGVkIGludGVyZmFjZXMgdW5sZXNzIGRlZmF1bHRzCiAgICAgICAg\nLy8gc2F5IHRoZSB1c2VyIG11c3QgaW1wbGVtZW50IHBlcnNpc3RlbnQgaW50\nZXJmYWNlcyBleHBsaWNpdGx5IGluIG1ldGEKICAgICAgICBpZiAoIV9mYWN0\nb3J5LmdldERlZmF1bHRzKCkuaXNEZWNsYXJlZEludGVyZmFjZVBlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIENsYXNzPD8+W10g\naW50cyA9IGNoZWNrLmdldEludGVyZmFjZXMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nLy8gZG9uJ3QgbWFwIGphdmEtc3RhbmRhcmQgaW50ZXJmYWNlcwogICAgICAg\nICAgICBpZiAoaW50c1tpXS5nZXROYW1lKCkuc3RhcnRzV2l0aCgiamF2YS4i\nKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8g\nb25seSBtYXAgbGVhc3QtZGVyaXZlZCBpbnRlcmZhY2UgaW1wbGVtZW50b3Jz\nCiAgICAgICAgICAgIGlmIChsZWFzdERlcml2ZWQgPT0gY2xzIHx8IGlzTGVh\nc3REZXJpdmVkSW1wbChpbnRzW2ldLCBjbHMpKSB7CiAgICAgICAgICAgICAg\nICBhZGRUb0NvbGxlY3Rpb24oX2ltcGxzLCBpbnRzW2ldLCBjbHMsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIHVwZGF0ZUltcGxzKGNscywgbGVhc3REZXJp\ndmVkLCBpbnRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiBjbGFz\ncyBpcyB0aGUgbGVhc3QtZGVyaXZlZCBwZXJzaXN0ZW50IGltcGxlbWVudG9y\nIG9mIHRoZSBnaXZlbgogICAgICogaW50ZXJmYWNlLCBmYWxzZSBvdGhlcndp\nc2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0xlYXN0RGVyaXZl\nZEltcGwoQ2xhc3M8Pz4gaW50ZXIsIENsYXNzPD8+IGNscykgewogICAgICAg\nIENsYXNzPD8+IHBhcmVudCA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1\ncGVyY2xhc3MoY2xzKTsKICAgICAgICB3aGlsZSAocGFyZW50ICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKEFycmF5cy5hc0xpc3QocGFyZW50LmdldElu\ndGVyZmFjZXMoKSkuY29udGFpbnMoaW50ZXIpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICBwYXJlbnQgPSBQQ1JlZ2lzdHJ5\nLmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKHBhcmVudCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIHRoZSBnaXZlbiB2YWx1ZSB0byB0aGUgY29sbGVjdGlvbiBjYWNoZWQgaW4g\ndGhlIGdpdmVuIG1hcCB1bmRlciB0aGUgZ2l2ZW4ga2V5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkVG9Db2xsZWN0aW9uKE1hcCBtYXAsIENsYXNz\nPD8+IGtleSwgQ2xhc3M8Pz4gdmFsdWUsIGJvb2xlYW4gaW5oZXJpdGFuY2Up\nIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChtYXApIHsKICAgICAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlv\nbkludGVybmFsKG1hcCwga2V5LCB2YWx1ZSwgaW5oZXJpdGFuY2UpOwogICAg\nICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWRkVG9D\nb2xsZWN0aW9uSW50ZXJuYWwobWFwLCBrZXksIHZhbHVlLCBpbmhlcml0YW5j\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRUb0Nv\nbGxlY3Rpb25JbnRlcm5hbChNYXAgbWFwLCBDbGFzczw/PiBrZXksIENsYXNz\nPD8+IHZhbHVlLCBib29sZWFuIGluaGVyaXRhbmNlKSB7CiAgICAgICAgQ29s\nbGVjdGlvbiBjb2xsID0gKENvbGxlY3Rpb24pIG1hcC5nZXQoa2V5KTsKICAg\nICAgICBpZiAoY29sbCA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbmhl\ncml0YW5jZSkgewogICAgICAgICAgICAgICAgSW5oZXJpdGFuY2VDb21wYXJh\ndG9yIGNvbXAgPSBuZXcgSW5oZXJpdGFuY2VDb21wYXJhdG9yKCk7CiAgICAg\nICAgICAgICAgICBjb21wLnNldEJhc2Uoa2V5KTsKICAgICAgICAgICAgICAg\nIGNvbGwgPSBuZXcgVHJlZVNldDxDbGFzczw/Pj4oY29tcCk7CiAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgY29sbCA9IG5ldyBMaW5rZWRM\naXN0PENsYXNzPD8+PigpOwogICAgICAgICAgICBtYXAucHV0KGtleSwgY29s\nbCk7CiAgICAgICAgfQogICAgICAgIGNvbGwuYWRkKHZhbHVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFB1dHMgdGhlIG1ldGEgY2xhc3MgY29ycmVzcG9u\nZGluZyB0byB0aGUgZ2l2ZW4gZW50aXR5IGNsYXNzLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRNZXRhTW9kZWwoQ2xhc3M8Pz4gbTIpIHsKICAgICAg\nICBDbGFzczw/PiBjbHMgPSBfZmFjdG9yeS5nZXRNYW5hZ2VkQ2xhc3MobTIp\nOwogICAgICAgIGlmIChjbHMgIT0gbnVsbCkKICAgICAgICAgICAgX21ldGFt\nb2RlbC5wdXQoY2xzLCBtMik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQdXRz\nIHRoZSBtZXRhIGNsYXNzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIHBl\ncnNpc3RlbnQgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1l\ndGFNb2RlbChDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNzPD8+IG0yKSB7CiAg\nICAgICAgX21ldGFtb2RlbC5wdXQobWV0YS5nZXREZXNjcmliZWRUeXBlKCks\nIG0yKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIG1ldGEgY2xh\nc3MgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gcGVyc2lzdGVudCBjbGFz\ncy4KICAgICAqLwogICAgcHVibGljIENsYXNzPD8+IGdldE1ldGFNb2RlbChD\nbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gbG9hZCkgewogICAgICAgIHJl\ndHVybiBnZXRNZXRhTW9kZWwobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIGxv\nYWQpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgbWV0YSBjbGFz\ncyBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBjbGFzcy4gSWYgbG9hZCBp\ncyBmYWxzZSwgcmV0dXJucyB0aGUgbWV0YQogICAgICogY2xhc3MgaWYgaGFz\nIGJlZW4gc2V0IGZvciB0aGUgZ2l2ZW4gcGVyc2lzdGVudCBjbGFzcyBlYXJs\naWVyLiBJZiB0aGUgbG9hZCBpcyB0cnVlIHRoZW4gYWxzbwogICAgICogYXR0\nZW1wdHMgdG8gYXBwbHkgdGhlIGN1cnJlbnQgbmFtaW5nIHBvbGljeSB0byBk\nZXJpdmUgbWV0YSBjbGFzcyBuYW1lIGFuZCBhdHRlbXB0cyB0byBsb2FkCiAg\nICAgKiB0aGUgbWV0YSBjbGFzcy4KICAgICAqLwogICAgcHVibGljIENsYXNz\nPD8+IGdldE1ldGFNb2RlbChDbGFzczw/PiBlbnRpdHksIGJvb2xlYW4gbG9h\nZCkgewogICAgICAgIGlmIChfbWV0YW1vZGVsLmNvbnRhaW5zS2V5KGVudGl0\neSkpCiAgICAgICAgICAgIHJldHVybiBfbWV0YW1vZGVsLmdldChlbnRpdHkp\nOwogICAgICAgIFN0cmluZyBtMiA9IF9mYWN0b3J5LmdldE1ldGFNb2RlbENs\nYXNzTmFtZShlbnRpdHkuZ2V0TmFtZSgpKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFj\ndGlvbihlbnRpdHkpKTsKICAgICAgICAgICAgQ2xhc3M8Pz4gbTJjbHMgPSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5n\nZXRGb3JOYW1lQWN0aW9uKG0yLCB0cnVlLCBsb2FkZXIpKTsKICAgICAgICAg\nICAgX21ldGFtb2RlbC5wdXQoZW50aXR5LCBtMmNscyk7CiAgICAgICAgICAg\nIHJldHVybiBtMmNsczsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoIm1ldGEtbm8tbW9kZWwi\nLCBtMiwgZW50aXR5LCB0KSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBDb25maWd1cmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8v\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZv\naWQgc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYpIHsKICAg\nICAgICBfY29uZiA9IChPcGVuSlBBQ29uZmlndXJhdGlvbikgY29uZjsKICAg\nICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9u\nLkxPR19NRVRBREFUQSk7CiAgICAgICAgX3Jlb3JkZXJNZXRhRGF0YVJlc29s\ndXRpb24gPSBfY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXRS\nZW9yZGVyTWV0YURhdGFSZXNvbHV0aW9uKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc3RhcnRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgaW5pdGlhbGl6\nZU1ldGFEYXRhRmFjdG9yeSgpOwogICAgICAgIGlmIChfaW1wbEdlbiA9PSBu\ndWxsKQogICAgICAgICAgICBfaW1wbEdlbiA9IG5ldyBJbnRlcmZhY2VJbXBs\nR2VuZXJhdG9yKHRoaXMpOwogICAgICAgIGlmIChfcHJlbG9hZCA9PSB0cnVl\nKSB7CiAgICAgICAgICAgIF9vaWRzID0gbmV3IEhhc2hNYXA8Q2xhc3M8Pz4s\nIENsYXNzPD8+PigpOwogICAgICAgICAgICBfaW1wbHMgPSBuZXcgSGFzaE1h\ncDxDbGFzczw/PiwgQ29sbGVjdGlvbjxDbGFzczw/Pj4+KCk7CiAgICAgICAg\nICAgIF9pZmFjZXMgPSBuZXcgSGFzaE1hcDxDbGFzczw/PiwgQ2xhc3M8Pz4+\nKCk7CiAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhhc2hNYXA8U3RyaW5n\nLCBMaXN0PENsYXNzPD8+Pj4oKTsKICAgICAgICAgICAgX3Bhd2FyZXMgPSBu\nZXcgSGFzaE1hcDxDbGFzczw/PiwgTm9uUGVyc2lzdGVudE1ldGFEYXRhPigp\nOwogICAgICAgICAgICBfbm9uTWFwcGVkID0gbmV3IEhhc2hNYXA8Q2xhc3M8\nPz4sIE5vblBlcnNpc3RlbnRNZXRhRGF0YT4oKTsKICAgICAgICAgICAgX3N1\nYnMgPSBuZXcgSGFzaE1hcDxDbGFzczw/PiwgTGlzdDxDbGFzczw/Pj4+KCk7\nCiAgICAgICAgICAgIC8vIFdhaXQgdGlsbCB3ZSdyZSBkb25lIGxvYWRpbmcg\nTWV0YURhdGEgdG8gZmxpcCBfbG9jayBib29sZWFuLgogICAgICAgIH0gICAg\nICAgICAgICAKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5pdGlhbGl6ZU1l\ndGFEYXRhRmFjdG9yeSgpIHsKICAgICAgICBpZiAoX2ZhY3RvcnkgPT0gbnVs\nbCkgewogICAgICAgICAgICBNZXRhRGF0YUZhY3RvcnkgbWRmID0gX2NvbmYu\nbmV3TWV0YURhdGFGYWN0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYg\nKG1kZiA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhZGF0YWZhY3RvcnkiKSk7\nCiAgICAgICAgICAgIHNldE1ldGFEYXRhRmFjdG9yeShtZGYpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVy\neSBtZXRhZGF0YQogICAgLy8gLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogUmV0dXJuIHF1ZXJ5IG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xh\nc3MsIG5hbWUsIGFuZCBjbGFzc2xvYWRlci4KICAgICAqLwogICAgcHVibGlj\nIFF1ZXJ5TWV0YURhdGEgZ2V0UXVlcnlNZXRhRGF0YShDbGFzczw/PiBjbHMs\nIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4g\nbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFF1ZXJ5TWV0YURhdGFJbnRlcm5hbChjbHMsIG5hbWUsIGVudkxv\nYWRlciwgbXVzdEV4aXN0KTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRRdWVyeU1ldGFEYXRhSW50ZXJu\nYWwoY2xzLCBuYW1lLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgUXVlcnlNZXRhRGF0YSBnZXRRdWVyeU1l\ndGFEYXRhSW50ZXJuYWwoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgbmFtZSwgQ2xh\nc3NMb2FkZXIgZW52TG9hZGVyLCAKICAgICAgICBib29sZWFuIG11c3RFeGlz\ndCkgewogICAgICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGEgPSBnZXRRdWVy\neU1ldGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2FkZXIpOwogICAg\nICAgICAgICBpZiAobWV0YSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAv\nLyBsb2FkIGFsbCB0aGUgbWV0YWRhdGFzIGZvciBhbGwgdGhlIGtub3duIGNs\nYXNzZXMgc28gdGhhdAogICAgICAgICAgICAgICAgLy8gcXVlcnkgbmFtZXMg\nYXJlIHNlZW4gYW5kIHJlZ2lzdGVyZWQKICAgICAgICAgICAgICAgIHJlc29s\ndmVBbGwoZW52TG9hZGVyKTsKICAgICAgICAgICAgICAgIG1ldGEgPSBnZXRR\ndWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2FkZXIpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsICYm\nIG11c3RFeGlzdCkgewogICAgICAgICAgICAgICAgaWYgKGNscyA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1uYW1lZC1xdWVyeS1udWxsLWNsYXNzIiwg\nZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwKICAgICAgICAgICAgICAg\nICAgICAgICAgZW52TG9hZGVyKSwgbmFtZSkpOwogICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hbWVkLXF1ZXJ5IiwgY2xzLCBu\nYW1lKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogUmVz\nb2x2ZSBhbGwga25vd24gbWV0YWRhdGEgY2xhc3Nlcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHJlc29sdmVBbGwoQ2xhc3NMb2FkZXIgZW52TG9hZGVy\nKSB7CiAgICAgICAgQ29sbGVjdGlvbjxDbGFzczw/Pj4gdHlwZXMgPSBsb2Fk\nUGVyc2lzdGVudFR5cGVzKGZhbHNlLCBlbnZMb2FkZXIpOwogICAgICAgIGZv\nciAoQ2xhc3M8Pz4gYyA6IHR5cGVzKSB7CiAgICAgICAgICAgIGdldE1ldGFE\nYXRhKGMsIGVudkxvYWRlciwgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBxdWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdp\ndmVuIGNsYXNzLCBuYW1lLCBhbmQgY2xhc3Nsb2FkZXIuCiAgICAgKi8KICAg\nIHByaXZhdGUgUXVlcnlNZXRhRGF0YSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJu\nYWwoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52\nTG9hZGVyKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBxbSA9IG51\nbGw7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKSB7CiAgICAgICAgICAgIHFt\nID0gc2VhcmNoUXVlcnlNZXRhRGF0YUJ5TmFtZShuYW1lKTsKICAgICAgICAg\nICAgaWYgKHFtICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gcW07\nCiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGNhY2hlCiAgICAgICAgT2Jq\nZWN0IGtleSA9IGdldFF1ZXJ5S2V5KGNscywgbmFtZSk7CiAgICAgICAgcW0g\nPSAoUXVlcnlNZXRhRGF0YSkgX3F1ZXJpZXMuZ2V0KGtleSk7CiAgICAgICAg\naWYgKHFtICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBxbTsKCiAgICAg\nICAgLy8gZ2V0IG1ldGFkYXRhIGZvciBjbGFzcywgd2hpY2ggd2lsbCBmaW5k\nIHF1ZXJpZXMgaW4gbWV0YWRhdGEgZmlsZQogICAgICAgIGlmIChjbHMgIT0g\nbnVsbCAmJiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgZmFsc2UpICE9\nIG51bGwpIHsKICAgICAgICAgICAgcW0gPSBfcXVlcmllcy5nZXQoa2V5KTsK\nICAgICAgICAgICAgaWYgKHFtICE9IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gcW07CiAgICAgICAgfQogICAgICAgIGlmICgoX3NvdXJjZU1vZGUg\nJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgLy8gc2VlIGlmIGZhY3RvcnkgY2FuIGZpZ3VyZSBvdXQgYSBz\nY29wZSBmb3IgdGhpcyBxdWVyeQogICAgICAgIGlmIChjbHMgPT0gbnVsbCkK\nICAgICAgICAgICAgY2xzID0gX2ZhY3RvcnkuZ2V0UXVlcnlTY29wZShuYW1l\nLCBlbnZMb2FkZXIpOwoKICAgICAgICAvLyBub3QgaW4gY2FjaGU7IGxvYWQK\nICAgICAgICBfZmFjdG9yeS5sb2FkKGNscywgTU9ERV9RVUVSWSwgZW52TG9h\nZGVyKTsKICAgICAgICByZXR1cm4gX3F1ZXJpZXMuZ2V0KGtleSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBxdWVyeSBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURhdGFbXSBnZXRR\ndWVyeU1ldGFEYXRhcygpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gKFF1ZXJ5TWV0YURhdGFbXSkgX3F1ZXJpZXMudmFsdWVzKCku\ndG9BcnJheShuZXcgUXVlcnlNZXRhRGF0YVtfcXVlcmllcy5zaXplKCldKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJl\ndHVybiAoUXVlcnlNZXRhRGF0YVtdKSBfcXVlcmllcy52YWx1ZXMoKS50b0Fy\ncmF5KG5ldyBRdWVyeU1ldGFEYXRhW19xdWVyaWVzLnNpemUoKV0pOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVk\nIHF1ZXJ5IG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwog\nICAgcHVibGljIFF1ZXJ5TWV0YURhdGEgZ2V0Q2FjaGVkUXVlcnlNZXRhRGF0\nYShDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9s\nb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewog\nICAgICAgICAgICAgICAgcmV0dXJuIChRdWVyeU1ldGFEYXRhKSBfcXVlcmll\ncy5nZXQoZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0\nYURhdGEpIF9xdWVyaWVzLmdldChnZXRRdWVyeUtleShjbHMsIG5hbWUpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgcXVl\ncnkgbWV0YWRhdGEgdG8gdGhlIHJlcG9zaXRvcnkgYW5kIHJldHVybiBpdC4K\nICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURhdGEgYWRkUXVlcnlNZXRh\nRGF0YShDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYg\nKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykg\newogICAgICAgICAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRhID0gbmV3UXVl\ncnlNZXRhRGF0YShjbHMsIG5hbWUpOwogICAgICAgICAgICAgICAgX3F1ZXJp\nZXMucHV0KGdldFF1ZXJ5S2V5KG1ldGEpLCBtZXRhKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBtZXRhOwogICAgICAgICAgICB9CiAgICAgICAgfWVsc2V7\nCiAgICAgICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IG5ld1F1ZXJ5TWV0\nYURhdGEoY2xzLCBuYW1lKTsKICAgICAgICAgICAgX3F1ZXJpZXMucHV0KGdl\ndFF1ZXJ5S2V5KG1ldGEpLCBtZXRhKTsKICAgICAgICAgICAgcmV0dXJuIG1l\ndGE7ICAgCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IHF1ZXJ5IG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgUXVlcnlNZXRhRGF0YSBuZXdRdWVyeU1ldGFEYXRhKENsYXNz\nPD8+IGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBRdWVyeU1ldGFEYXRh\nIG1ldGEgPSBuZXcgUXVlcnlNZXRhRGF0YShuYW1lKTsKICAgICAgICBtZXRh\nLnNldERlZmluaW5nVHlwZShjbHMpOwogICAgICAgIHJldHVybiBtZXRhOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBxdWVyeSBt\nZXRhZGF0YSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVRdWVyeU1ldGFEYXRhKFF1ZXJ5TWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAg\nICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gX3F1ZXJpZXMucmVtb3ZlKGdldFF1ZXJ5S2V5KG1ldGEpKSAhPSBu\ndWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtleShtZXRhKSkg\nIT0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1v\ndmUgcXVlcnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGlm\nIGluIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiByZW1vdmVRdWVyeU1ldGFEYXRhKENsYXNzPD8+IGNscywgU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgIHJldHVybiBfcXVlcmllcy5yZW1vdmUoZ2V0UXVlcnlL\nZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBf\ncXVlcmllcy5yZW1vdmUoZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKSkgIT0gbnVs\nbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWFyY2hlcyBh\nbGwgY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhIGJ5IG5hbWUuCiAgICAgKi8KICAg\nIHB1YmxpYyBRdWVyeU1ldGFEYXRhIHNlYXJjaFF1ZXJ5TWV0YURhdGFCeU5h\nbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBmb3IgKE9iamVjdCBrZXkgOiBf\ncXVlcmllcy5rZXlTZXQoKSkgewogICAgICAgICAgICBpZiAoa2V5IGluc3Rh\nbmNlb2YgUXVlcnlLZXkpCiAgICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuZXF1YWxzKCgoUXVlcnlLZXkpIGtleSkubmFtZSwgbmFtZSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIChRdWVyeU1ldGFEYXRhKSBfcXVlcmll\ncy5nZXQoa2V5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciBh\nIGdpdmVuIFF1ZXJ5TWV0YURhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIE9iamVjdCBnZXRRdWVyeUtleShRdWVyeU1ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICByZXR1cm4gZ2V0UXVlcnlLZXkobWV0YS5nZXREZWZp\nbmluZ1R5cGUoKSwgbWV0YS5nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgdW5pcXVlIGtleSBmb3IgYSBnaXZlbiBjbGFzcyAv\nIG5hbWUuIFRoZSBjbGFzcyBhcmd1bWVudCBjYW4gYmUgbnVsbC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHN0YXRpYyBPYmplY3QgZ2V0UXVlcnlLZXkoQ2xh\nc3M8Pz4gY2xzLCBTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChjbHMgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICAgICAgUXVlcnlL\nZXkga2V5ID0gbmV3IFF1ZXJ5S2V5KCk7CiAgICAgICAga2V5LmNsc05hbWUg\nPSBjbHMuZ2V0TmFtZSgpOwogICAgICAgIGtleS5uYW1lID0gbmFtZTsKICAg\nICAgICByZXR1cm4ga2V5OwogICAgfQoKICAgIC8vIC8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIFNlcXVlbmNlIG1ldGFkYXRhCiAgICAvLyAvLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gc2VxdWVuY2Ug\nbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1lIGFuZCBjbGFzc2xvYWRlci4K\nICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlTWV0YURhdGEgZ2V0U2VxdWVu\nY2VNZXRhRGF0YShTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVy\nLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlmIChfbG9ja2luZykg\newogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBnZXRTZXF1ZW5jZU1ldGFEYXRhSW50ZXJuYWwobmFt\nZSwgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNlTWV0\nYURhdGFJbnRlcm5hbChuYW1lLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgU2VxdWVuY2VNZXRhRGF0YSBn\nZXRTZXF1ZW5jZU1ldGFEYXRhSW50ZXJuYWwoU3RyaW5nIG5hbWUsIENsYXNz\nTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAg\nICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gZ2V0U2VxdWVuY2VNZXRh\nRGF0YUludGVybmFsKG5hbWUsIGVudkxvYWRlcik7CiAgICAgICAgICAgIGlm\nIChtZXRhID09IG51bGwgJiYgU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RF\nTS5lcXVhbHMobmFtZSkpIHsKICAgICAgICAgICAgICAgIGlmIChfc3lzU2Vx\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3N5c1NlcSA9IG5ld1Nl\ncXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nX3N5c1NlcTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWV0YSA9\nPSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmFtZWQtc2VxdWVu\nY2UiLCBuYW1lKSk7CiAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAgfQoK\nICAgIC8qKgogICAgICogVXNlZCBpbnRlcm5hbGx5IGJ5IG1ldGFkYXRhIHRv\nIHJldHJpZXZlIHNlcXVlbmNlIG1ldGFkYXRhcyBiYXNlZCBvbiBwb3NzaWJs\neS11bnF1YWxpZmllZAogICAgICogc2VxdWVuY2UgbmFtZS4KICAgICAqLwog\nICAgU2VxdWVuY2VNZXRhRGF0YSBnZXRTZXF1ZW5jZU1ldGFEYXRhKENsYXNz\nTWV0YURhdGEgY29udGV4dCwgU3RyaW5nIG5hbWUsIGJvb2xlYW4gbXVzdEV4\naXN0KSB7CiAgICAgICAgLy8gdHJ5IHdpdGggZ2l2ZW4gbmFtZQogICAgICAg\nIE1ldGFEYXRhRXhjZXB0aW9uIGUgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIFNlcXVlbmNlTWV0YURhdGEgc2VxID0gZ2V0U2VxdWVuY2VN\nZXRhRGF0YShuYW1lLCBjb250ZXh0LmdldEVudkNsYXNzTG9hZGVyKCksIG11\nc3RFeGlzdCk7CiAgICAgICAgICAgIGlmIChzZXEgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBzZXE7CiAgICAgICAgfSBjYXRjaCAoTWV0YURh\ndGFFeGNlcHRpb24gbWRlKSB7CiAgICAgICAgICAgIGUgPSBtZGU7CiAgICAg\nICAgfQoKICAgICAgICAvLyBpZiBnaXZlbiBuYW1lIGFscmVhZHkgZnVsbHkg\ncXVhbGlmaWVkLCBnaXZlIHVwCiAgICAgICAgaWYgKG5hbWUuaW5kZXhPZign\nLicpICE9IC0xKSB7CiAgICAgICAgICAgIGlmIChlICE9IG51bGwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIC8vIHRyeSB3aXRoIHF1YWxpZmllZCBuYW1l\nCiAgICAgICAgbmFtZSA9IFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoY29udGV4\ndC5nZXREZXNjcmliZWRUeXBlKCkpICsgIi4iICsgbmFtZTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2VNZXRhRGF0YShu\nYW1lLCBjb250ZXh0LmdldEVudkNsYXNzTG9hZGVyKCksIG11c3RFeGlzdCk7\nCiAgICAgICAgfSBjYXRjaCAoTWV0YURhdGFFeGNlcHRpb24gbWRlKSB7CiAg\nICAgICAgICAgIC8vIHRocm93IG9yaWdpbmFsIGV4Y2VwdGlvbgogICAgICAg\nICAgICBpZiAoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgZTsK\nICAgICAgICAgICAgdGhyb3cgbWRlOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBzZXF1ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdp\ndmVuIG5hbWUgYW5kIGNsYXNzbG9hZGVyLgogICAgICovCiAgICBwcml2YXRl\nIFNlcXVlbmNlTWV0YURhdGEgZ2V0U2VxdWVuY2VNZXRhRGF0YUludGVybmFs\nKFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAg\nICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAgICBTZXF1ZW5jZU1ldGFE\nYXRhIG1ldGEgPSBfc2Vxcy5nZXQobmFtZSk7CiAgICAgICAgaWYgKG1ldGEg\nPT0gbnVsbCkgewogICAgICAgICAgICAvLyBsb2FkIG1ldGFkYXRhIGZvciBy\nZWdpc3RlcmVkIGNsYXNzZXMgdG8gaG9wZWZ1bGx5IGZpbmQgc2VxdWVuY2UK\nICAgICAgICAgICAgLy8gZGVmaW5pdGlvbgogICAgICAgICAgICBsb2FkUmVn\naXN0ZXJlZENsYXNzTWV0YURhdGEoZW52TG9hZGVyKTsKICAgICAgICAgICAg\nbWV0YSA9IF9zZXFzLmdldChuYW1lKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNh\nY2hlZCBzZXF1ZW5jZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIFNl\ncXVlbmNlTWV0YURhdGFbXSBnZXRTZXF1ZW5jZU1ldGFEYXRhcygpIHsKICAg\nICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKFNlcXVlbmNlTWV0\nYURhdGFbXSkgX3NlcXMudmFsdWVzKCkudG9BcnJheShuZXcgU2VxdWVuY2VN\nZXRhRGF0YVtfc2Vxcy5zaXplKCldKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAoU2VxdWVuY2VNZXRhRGF0\nYVtdKSBfc2Vxcy52YWx1ZXMoKS50b0FycmF5KG5ldyBTZXF1ZW5jZU1ldGFE\nYXRhW19zZXFzLnNpemUoKV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgY2FjaGVkIGEgc2VxdWVuY2UgbWV0YWRhdGEg\nZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVu\nY2VNZXRhRGF0YSBnZXRDYWNoZWRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBu\nYW1lKSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5\nbmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgcmV0dXJuIChT\nZXF1ZW5jZU1ldGFEYXRhKSBfc2Vxcy5nZXQobmFtZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKFNlcXVl\nbmNlTWV0YURhdGEpIF9zZXFzLmdldChuYW1lKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgc2VxdWVuY2UgbWV0YWRhdGEg\ndG8gdGhlIHJlcG9zaXRvcnkgYW5kIHJldHVybiBpdC4KICAgICAqLwogICAg\ncHVibGljIFNlcXVlbmNlTWV0YURhdGEgYWRkU2VxdWVuY2VNZXRhRGF0YShT\ndHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAg\nICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIFNl\ncXVlbmNlTWV0YURhdGEgbWV0YSA9IG5ld1NlcXVlbmNlTWV0YURhdGEobmFt\nZSk7CiAgICAgICAgICAgICAgICBfc2Vxcy5wdXQobmFtZSwgbWV0YSk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0\nYSA9IG5ld1NlcXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAgICAgIF9z\nZXFzLnB1dChuYW1lLCBtZXRhKTsKICAgICAgICAgICAgcmV0dXJuIG1ldGE7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3\nIHNlcXVlbmNlIG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgU2VxdWVuY2VNZXRhRGF0YSBuZXdTZXF1ZW5jZU1ldGFEYXRhKFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZXF1ZW5jZU1ldGFE\nYXRhKG5hbWUsIHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3Zl\nIHRoZSBnaXZlbiBzZXF1ZW5jZSBtZXRhZGF0YSBmcm9tIHRoZSByZXBvc2l0\nb3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVTZXF1ZW5j\nZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlm\nIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3NlcXMucmVtb3Zl\nKG1ldGEuZ2V0TmFtZSgpKSAhPSBudWxsOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIF9zZXFzLnJlbW92ZSht\nZXRhLmdldE5hbWUoKSkgIT0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZW1vdmUgc2VxdWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBu\nYW1lIGlmIGluIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBz\neW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBf\nc2Vxcy5yZW1vdmUobmFtZSkgIT0gbnVsbDsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBfc2Vxcy5yZW1vdmUo\nbmFtZSkgIT0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgdGhlIGdpdmVuIHN5c3RlbSBsaWZlY3ljbGUgbGlzdGVuZXIuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZFN5c3RlbUxpc3RlbmVyKE9iamVj\ndCBsaXN0ZW5lcikgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAg\nICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIC8v\nIGNvcHkgdG8gYXZvaWQgaXNzdWVzIHdpdGggTGlzdGVuZXJMaXN0IGFuZCBh\ndm9pZCB1bm5jZXNzYXJ5CiAgICAgICAgICAgICAgICAvLyBsb2NraW5nIG9u\nIHRoZSBsaXN0IGR1cmluZyBydW50aW1lCiAgICAgICAgICAgICAgICBMaWZl\nY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0IGxpc3RlbmVycyA9IG5l\ndyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KF9saXN0ZW5l\ncnMpOwogICAgICAgICAgICAgICAgbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7\nCiAgICAgICAgICAgICAgICBfbGlzdGVuZXJzID0gbGlzdGVuZXJzOwogICAg\nICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgTGlmZWN5\nY2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcg\nTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdChfbGlzdGVuZXJz\nKTsKICAgICAgICAgICAgbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7CiAgICAg\nICAgICAgIF9saXN0ZW5lcnMgPSBsaXN0ZW5lcnM7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzeXN0ZW0gbGlm\nZWN5Y2xlIGxpc3RlbmVyLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZW1vdmVTeXN0ZW1MaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAg\nICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0\naGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVtb3ZlU3lzdGVtTGlz\ndGVuZXJJbnRlcm5hbChsaXN0ZW5lcik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gcmVtb3ZlU3lzdGVtTGlz\ndGVuZXJJbnRlcm5hbChsaXN0ZW5lcik7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgYm9vbGVhbiByZW1vdmVTeXN0ZW1MaXN0ZW5lckludGVybmFs\nKE9iamVjdCBsaXN0ZW5lcikgewogICAgICAgICAgICBpZiAoIV9saXN0ZW5l\ncnMuY29udGFpbnMobGlzdGVuZXIpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICAgICAgLy8gY29weSB0byBhdm9pZCBpc3N1ZXMg\nd2l0aCBMaXN0ZW5lckxpc3QgYW5kIGF2b2lkIHVubmNlc3NhcnkKICAgICAg\nICAgICAgLy8gbG9ja2luZyBvbiB0aGUgbGlzdCBkdXJpbmcgcnVudGltZQog\nICAgICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0\nIGxpc3RlbmVycyA9IG5ldyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVu\nZXJMaXN0KF9saXN0ZW5lcnMpOwogICAgICAgICAgICBsaXN0ZW5lcnMucmVt\nb3ZlKGxpc3RlbmVyKTsKICAgICAgICAgICAgX2xpc3RlbmVycyA9IGxpc3Rl\nbmVyczsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHN5c3RlbSBsaWZlY3ljbGUgbGlzdGVuZXJz\nCiAgICAgKi8KICAgIHB1YmxpYyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlz\ndGVuZXJMaXN0IGdldFN5c3RlbUxpc3RlbmVycygpIHsKICAgICAgICByZXR1\ncm4gX2xpc3RlbmVyczsKICAgIH0KCiAgICAvKioKICAgICAqIEZyZWUgdGhl\nIHJlc291cmNlcyB1c2VkIGJ5IHRoaXMgcmVwb3NpdG9yeS4gQ2xvc2VzIGFs\nbCB1c2VyIHNlcXVlbmNlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xv\nc2UoKSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5\nbmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgY2xvc2VJbnRl\ncm5hbCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgY2xvc2VJbnRlcm5hbCgpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgY2xvc2VJbnRlcm5hbCgpIHsKICAgICAgICAgICAgU2Vx\ndWVuY2VNZXRhRGF0YVtdIHNtZHMgPSBnZXRTZXF1ZW5jZU1ldGFEYXRhcygp\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNtZHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBzbWRzW2ldLmNsb3NlKCk7CiAgICAg\nICAgICAgIGNsZWFyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBRdWVyeSBr\nZXkgc3RydWN0LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBR\ndWVyeUtleSBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1\nYmxpYyBTdHJpbmcgY2xzTmFtZTsKICAgICAgICBwdWJsaWMgU3RyaW5nIG5h\nbWU7CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAg\nICAgIGludCBjbHNIYXNoID0gKGNsc05hbWUgPT0gbnVsbCkgPyAwIDogY2xz\nTmFtZS5oYXNoQ29kZSgpOwogICAgICAgICAgICBpbnQgbmFtZUhhc2ggPSAo\nbmFtZSA9PSBudWxsKSA/IDAgOiBuYW1lLmhhc2hDb2RlKCk7CiAgICAgICAg\nICAgIHJldHVybiBjbHNIYXNoICsgbmFtZUhhc2g7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG9iaikgewogICAg\nICAgICAgICBpZiAob2JqID09IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgUXVl\ncnlLZXkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAgICAgUXVlcnlLZXkgcWsgPSAoUXVlcnlLZXkpIG9iajsKICAgICAgICAg\nICAgcmV0dXJuIFN0cmluZ1V0aWxzLmVxdWFscyhjbHNOYW1lLCBxay5jbHNO\nYW1lKSAmJiBTdHJpbmdVdGlscy5lcXVhbHMobmFtZSwgcWsubmFtZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIFhNTCBtZXRh\nZGF0YSBmb3IgYSBnaXZlbiBmaWVsZCBtZXRhZGF0YQogICAgICogCiAgICAg\nKiBAcGFyYW0gZm1kCiAgICAgKiBAcmV0dXJuIFhNTCBtZXRhZGF0YQogICAg\nICovCiAgICBwdWJsaWMgWE1MTWV0YURhdGEgZ2V0WE1MTWV0YURhdGEoRmll\nbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0WE1MTWV0YURhdGFJbnRlcm5hbChmbWQpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdl\ndFhNTE1ldGFEYXRhSW50ZXJuYWwoZm1kKTsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgWE1MTWV0YURhdGEgZ2V0WE1MTWV0YURhdGFJbnRl\ncm5hbChGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIENsYXNzPD8+IGNs\ncyA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAvLyBjaGVjayBp\nZiBjYWNoZWQgYmVmb3JlCiAgICAgICAgWE1MTWV0YURhdGEgeG1sbWV0YSA9\nIF94bWxtZXRhcy5nZXQoY2xzKTsKICAgICAgICBpZiAoeG1sbWV0YSAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4geG1sbWV0YTsKCiAgICAgICAgLy8g\nbG9hZCBKQVhCIFhNTCBtZXRhZGF0YQogICAgICAgIF9mYWN0b3J5LmxvYWRY\nTUxNZXRhRGF0YShmbWQpOwoKICAgICAgICB4bWxtZXRhID0gKFhNTENsYXNz\nTWV0YURhdGEpIF94bWxtZXRhcy5nZXQoY2xzKTsKCiAgICAgICAgcmV0dXJu\nIHhtbG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVsdCBpbmZvcm1hdGlv\nbiwgYWRkIGl0IHRvIHRoZSByZXBvc2l0b3J5LCBhbmQKICAgICAqIHJldHVy\nbiBpdC4KICAgICAqIAogICAgICogQHBhcmFtIGFjY2VzcwogICAgICogICAg\nICAgICAgICB0aGUgYWNjZXNzIHR5cGUgdG8gdXNlIGluIHBvcHVsYXRpbmcg\nbWV0YWRhdGEKICAgICAqLwogICAgcHVibGljIFhNTENsYXNzTWV0YURhdGEg\nYWRkWE1MTWV0YURhdGEoQ2xhc3M8Pz4gdHlwZSwgU3RyaW5nIG5hbWUpIHsK\nICAgICAgICBYTUxDbGFzc01ldGFEYXRhIG1ldGEgPSBuZXdYTUxDbGFzc01l\ndGFEYXRhKHR5cGUsIG5hbWUpOwogICAgICAgIGlmKF9sb2NraW5nKXsKICAg\nICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpewogICAgICAgICAgICAgICAg\nX3htbG1ldGFzLnB1dCh0eXBlLCBtZXRhKTsgICAgICAgICAgICAgICAgCiAg\nICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgX3htbG1l\ndGFzLnB1dCh0eXBlLCBtZXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hl\nZCBYTUxDbGFzc01ldGFEYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MgUmV0dXJu\nIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFhNTE1ldGFEYXRh\nIGdldENhY2hlZFhNTE1ldGFEYXRhKENsYXNzPD8+IGNscykgewogICAgICAg\nIHJldHVybiBfeG1sbWV0YXMuZ2V0KGNscyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgeG1sIGNsYXNzIG1ldGFkYXRhCiAgICAgKiAK\nICAgICAqIEBwYXJhbSB0eXBlCiAgICAgKiBAcGFyYW0gbmFtZQogICAgICog\nQHJldHVybiBhIFhNTENsYXNzTWV0YURhdGEKICAgICAqLwogICAgcHJvdGVj\ndGVkIFhNTENsYXNzTWV0YURhdGEgbmV3WE1MQ2xhc3NNZXRhRGF0YShDbGFz\nczw/PiB0eXBlLCBTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiBuZXcg\nWE1MQ2xhc3NNZXRhRGF0YSh0eXBlLCBuYW1lKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhIG5ldyB4bWwgZmllbGQgbWV0YSwgYWRkIGl0IHRv\nIHRoZSBmaWVsZE1hcCBpbiB0aGUgZ2l2ZW4geG1sIGNsYXNzIG1ldGFkYXRh\nCiAgICAgKiAKICAgICAqIEBwYXJhbSB0eXBlCiAgICAgKiBAcGFyYW0gbmFt\nZQogICAgICogQHBhcmFtIG1ldGEKICAgICAqIEByZXR1cm4gYSBYTUxGaWVs\nZE1ldGFEYXRhCiAgICAgKi8KICAgIHB1YmxpYyBYTUxGaWVsZE1ldGFEYXRh\nIG5ld1hNTEZpZWxkTWV0YURhdGEoQ2xhc3M8Pz4gdHlwZSwgU3RyaW5nIG5h\nbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFhNTEZpZWxkTWV0YURhdGEodHlw\nZSwgbmFtZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQW5hbHl6ZXMg\ndGhlIGxpc3Qgb2YgQ2xhc3NNZXRhRGF0YSBpbiB0aGUgc3VwcGxpZWQgbGlz\ndCBmb3IgYW55IHdoaWNoIGhhcyBmb3JlaWduIGtleXMgdG8gb3RoZXIgQ2xh\nc3NNZXRhRGF0YSAKICAgICAqIGluc3RhbmNlcyBpbiBpdHMgaWRlbnRpdHkg\nKGluIG90aGVyIHdvcmRzLCBQQ1R5cGVzIHdoaWNoIGhhdmUgcHJpbWFyeSBr\nZXlzIHRoYXQgYXJlIGZvcmVpZ24ga2V5cyB0byBvdGhlcgogICAgICogdGFi\nbGVzKSwgYW5kIHJldHVybnMgYSBsaXN0IGFycmFuZ2VkIHNvIHRoYXQgYSBD\nbGFzc01ldGFEYXRhIHRoYXQgZGVwZW5kcyBvbiBhbm90aGVyIENsYXNzTWV0\nYURhdGEgYXBwZWFycwogICAgICogYWZ0ZXIgaXQgaW4gdGhlIGxpc3QuCiAg\nICAgKgogICAgICogQHBhcmFtIGNtZExpc3QgLSBMaXN0IG9mIENsYXNzTWV0\nYURhdGEgdG8gZXhhbWluZQogICAgICogQHJldHVybiAtIExpc3Qgb2YgQ2xh\nc3NNZXRhRGF0YSwgd2l0aCBDbGFzc01ldGFEYXRhIGRlcGVuZGVlcyBtb3Zl\nZCBhZnRlciB0aGUgbGFzdCBpZGVudGlmaWVkIGRlcGVuZGVudCAKICAgICAq\nICAgICAgICAgICBDbGFzc01ldGFEYXRhLCBpZiBhbnkgbW92ZSBpcyBuZWNl\nc3NhcnkuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxDbGFzc01ldGFEYXRh\nPiByZXNvbHZlRktJblBLRGVwZW5kZW5jaWVzT3JkZXJpbmcoTGlzdDxDbGFz\nc01ldGFEYXRhPiBjbWRMaXN0KSB7CiAgICAgICAgSGFzaE1hcDxDbGFzc01l\ndGFEYXRhLCBDTUREZXBlbmRlbmN5Tm9kZT4gbm9kZU1hcCA9IG5ldyBIYXNo\nTWFwPENsYXNzTWV0YURhdGEsIENNRERlcGVuZGVuY3lOb2RlPigpOwogICAg\nICAgIEhhc2hTZXQ8Q01ERGVwZW5kZW5jeU5vZGU+IG5vZGVzV2l0aERlcGVu\nZGVuY2llc1NldCA9IG5ldyBIYXNoU2V0PENNRERlcGVuZGVuY3lOb2RlPigp\nOwogICAgICAgIEFycmF5TGlzdDxDTUREZXBlbmRlbmN5Tm9kZT4gbm9kZUxp\nc3QgPSBuZXcgQXJyYXlMaXN0PENNRERlcGVuZGVuY3lOb2RlPihjbWRMaXN0\nLnNpemUoKSk7CiAgICAgICAgCiAgICAgICAgLy8gSW5pdGlhbCBhbmFseXNp\ncyBvZiBDbGFzc01ldGFEYXRhIG9iamVjdHMgLS0gUG9wdWxhdGUgdGhlIGxp\nbmtlZCBsaXN0IHdpdGggb2JqZWN0cyBpbiB0aGUgc2FtZSBvcmRlciBvZiAK\nICAgICAgICAvLyBhcHBlYXJhbmNlIGluIHRoZSBvcmlnaW5hbCBsaXN0LiBJ\nZGVudGlmeSBDTURzIHdob3NlIGlkZW50aXRpZXMgaGF2ZSBhIEZLIHRvIGFu\nb3RoZXIgQ01ELCBhbmQgY2F0YWxvZyB0aGF0IAogICAgICAgIC8vIGRlcGVu\nZGVuY3kuCiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIGNtZCA6IGNtZExp\nc3QpIHsKICAgICAgICAgICAgLy8gQWRkIHRoaXMgbm9kZSB0byB0aGUgbGlz\ndAogICAgICAgICAgICBDTUREZXBlbmRlbmN5Tm9kZSBub2RlID0gbm9kZU1h\ncC5nZXQoY21kKTsKICAgICAgICAgICAgaWYgKG5vZGUgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgbm9kZSA9IG5ldyBDTUREZXBlbmRlbmN5Tm9kZShj\nbWQpOwogICAgICAgICAgICAgICAgbm9kZU1hcC5wdXQoY21kLCBub2RlKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBub2RlTGlzdC5hZGQobm9kZSk7\nCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBFeGFtaW5lIGl0cyBwcmlt\nYXJ5IGtleSBmaWVsZHMsIGZsYWcgYW55IHJlZmVyZW5jZXMgdG8gYW5vdGhl\nciBQQ1R5cGUgdGhhdCBpcyBkZWZpbmVkIGluIGNtZExpc3QgYXMgYSAKICAg\nICAgICAgICAgLy8gZGVwZW5kZW5jeQogICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kQXJyID0gY21kLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAg\nICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IGZtZEFycikgewog\nICAgICAgICAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQgPSBmbWQuZ2V0VmFs\ndWUoKTsKICAgICAgICAgICAgICAgIGlmICh2bWQuaXNUeXBlUEMoKSkgewog\nICAgICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgdGFyZ2V0Q01EID0g\ndm1kLmdldERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7CgogICAgICAgICAgICAg\nICAgICAgIC8vIE9ubHkgcHJvY2VzcyBlbnRyaWVzIHdoaWNoIGFyZSBpbiB0\naGUgY21kTGlzdCwgYXMgd2UgZG9uJ3Qgd2FudCB0byBiZSBhZGRpbmcgYW55\ndGhpbmcgbmV3LgogICAgICAgICAgICAgICAgICAgIGlmICghY21kTGlzdC5j\nb250YWlucyh0YXJnZXRDTUQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGRlcGVuZGVuY3kKICAgICAgICAg\nICAgICAgICAgICBDTUREZXBlbmRlbmN5Tm9kZSB0YXJnZXROb2RlID0gbnVs\nbDsKICAgICAgICAgICAgICAgICAgICBpZiAoKHRhcmdldE5vZGUgPSBub2Rl\nTWFwLmdldCh0YXJnZXRDTUQpKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHRhcmdldE5vZGUgPSBuZXcgQ01ERGVwZW5kZW5jeU5vZGUo\ndGFyZ2V0Q01EKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZU1hcC5w\ndXQodGFyZ2V0Q01ELCB0YXJnZXROb2RlKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZWdpc3RlckRlcGVuZGVu\ndE5vZGUodGFyZ2V0Tm9kZSk7CiAgICAgICAgICAgICAgICAgICAgbm9kZXNX\naXRoRGVwZW5kZW5jaWVzU2V0LmFkZChub2RlKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAv\nLyBBbmFseXNpcyBpcyBjb21wbGV0ZS4gRm9yIGVhY2ggQ01EIHRoYXQgaGFz\nIGFuIGlkZW50aXR5IGZvcmVpZ24ga2V5IGRlcGVuZGVuY3kgb24gYW5vdGhl\nciBDTUQsIGVuc3VyZSB0aGF0IGl0CiAgICAgICAgLy8gYXBwZWFycyBsYXRl\nciBpbiB0aGUgbGlzdCB0aGVuIHRoZSBDTUQgaXQgaXMgZGVwZW5kZW50IG9u\nLiBJZiBpdCBhcHBlYXJzIGVhcmxpZXIsIG1vdmUgaXQgaW1tZWRpYXRlbHkg\nYWZ0ZXIgCiAgICAgICAgLy8gdGhlIENNRC4gSWYgdGhlcmUgYXJlIG11bHRp\ncGxlIENNRHMgdGhlIGlkZW50aXR5IGlzIGRlcGVuZGVudCBvbiwgbW92ZSBp\ndCBhZnRlciB0aGUgbGFzdCBkZXBlbmRlbmN5IGluCiAgICAgICAgLy8gdGhl\nIGxpbmtlZCBsaXN0LgogICAgICAgIGZvciAoQ01ERGVwZW5kZW5jeU5vZGUg\nbm9kZSA6IG5vZGVzV2l0aERlcGVuZGVuY2llc1NldCkgewogICAgICAgICAg\nICAvLyBDaGVjayBpZiB0aGVyZSBpcyBhIGN5Y2xlIChkZXBlbmRlbmNpZXMg\nb3Igc3ViZGVwZW5kZW5jaWVzIHRoYXQgY3JlYXRlIGEgY3ljbGUgaW4gdGhl\nIGdyYXBoLiBJZiBvbmUgaXMgCiAgICAgICAgICAgIC8vIGRldGVjdGVkLCB0\naGVuIHRoaXMgYWxnb3JpdGhtIGNhbm5vdCBiZSB1c2VkIHRvIHJlb3JkZXIg\ndGhlIENNRCBsaXN0LiAgRW1pdCBhIHdhcm5pbmcsIGFuZCByZXR1cm4gdGhl\nIAogICAgICAgICAgICAvLyBvcmlnaW5hbCBsaXN0LgogICAgICAgICAgICBp\nZiAobm9kZS5jaGVja0ZvckN5Y2xlKCkpIHsKICAgICAgICAgICAgICAgIGlm\nIChfbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nIF9sb2cud2FybihfbG9jLmdldCgiY21kLWRpc2NvdmVyLWN5Y2xlIiwgbm9k\nZS5nZXRDbWQoKS5nZXRSZXNvdXJjZU5hbWUoKSkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNtZExpc3Q7CiAgICAgICAg\nICAgIH0KIAogICAgICAgICAgICBpbnQgbm9kZUluZGV4ID0gbm9kZUxpc3Qu\naW5kZXhPZihub2RlKTsKICAgICAgICAgICAgU2V0PENNRERlcGVuZGVuY3lO\nb2RlPiBkZXBlbmRlbmNpZXMgPSBub2RlLmdldERlcGVuZHNPblNldCgpOyAg\nICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIElmIHRoZSBjdXJy\nZW50IG5vZGUgaGFzIGEgZGVwZW5kZW5jeSB0aGF0IGFwcGVhcnMgbGF0ZXIg\naW4gdGhlIGxpc3QsIHRoZW4gdGhpcyBub2RlIG5lZWRzCiAgICAgICAgICAg\nIC8vIHRvIGJlIG1vdmVkIHRvIHRoZSBwb2ludCBpbW1lZGlhdGVseSBhZnRl\nciB0aGF0IGRlcGVuZGVuY3kuCiAgICAgICAgICAgIENNRERlcGVuZGVuY3lO\nb2RlIG1vdmVBZnRlciA9IG51bGw7CiAgICAgICAgICAgIGludCBtb3ZlQWZ0\nZXJJbmRleCA9IC0xOwogICAgICAgICAgICBmb3IgKENNRERlcGVuZGVuY3lO\nb2RlIGRlcE5vZGUgOiBkZXBlbmRlbmNpZXMpIHsgICAgICAgICAgICAgICAK\nICAgICAgICAgICAgICAgIGludCBkZXBlbmRlbmN5SW5kZXggPSBub2RlTGlz\ndC5pbmRleE9mKGRlcE5vZGUpOwogICAgICAgICAgICAgICAgaWYgKChub2Rl\nSW5kZXggPCBkZXBlbmRlbmN5SW5kZXgpICYmIChtb3ZlQWZ0ZXJJbmRleCA8\nIGRlcGVuZGVuY3lJbmRleCkpIHsKICAgICAgICAgICAgICAgICAgICBtb3Zl\nQWZ0ZXIgPSBkZXBOb2RlOwogICAgICAgICAgICAgICAgICAgIG1vdmVBZnRl\nckluZGV4ID0gZGVwZW5kZW5jeUluZGV4OwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtb3ZlQWZ0ZXIgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgbm9kZUxpc3QucmVtb3ZlKG5vZGVJbmRl\neCk7CiAgICAgICAgICAgICAgICBub2RlTGlzdC5hZGQobm9kZUxpc3QuaW5k\nZXhPZihtb3ZlQWZ0ZXIpICsgMSwgbm9kZSk7CiAgICAgICAgICAgIH0gICAg\nICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gU29ydGluZyBpcyBj\nb21wbGV0ZSwgYnVpbGQgdGhlIHJldHVybiBsaXN0LiAgQ2xlYXIgdGhlIGRl\ncGVuZHNPblNldCBmb3IgdGhlIEdDLgogICAgICAgIEFycmF5TGlzdDxDbGFz\nc01ldGFEYXRhPiByZXR1cm5MaXN0ID0gbmV3IEFycmF5TGlzdDxDbGFzc01l\ndGFEYXRhPigpOwogICAgICAgIGZvciAoQ01ERGVwZW5kZW5jeU5vZGUgY3Vy\ncmVudCA6IG5vZGVMaXN0KSB7CiAgICAgICAgICAgIHJldHVybkxpc3QuYWRk\nKGN1cnJlbnQuZ2V0Q21kKCkpOwogICAgICAgICAgICBjdXJyZW50LmdldERl\ncGVuZHNPblNldCgpLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIAogICAg\nICAgIHJldHVybiByZXR1cm5MaXN0OwogICAgfQoKCiAgICAvKioKICAgICAq\nIExpbmtlZCBsaXN0IG5vZGUgY2xhc3MgZm9yIG1hbmFnaW5nIGFueSBmb3Jl\naWduIGtleXMgaW4gdGhlIGlkZW50aXR5IG9mIGEgQ2xhc3NNZXRhRGF0YSBp\nbnN0YW5jZS4KICAgICAqIAogICAgICovCiAgICBwcml2YXRlIGNsYXNzIENN\nRERlcGVuZGVuY3lOb2RlIHsKICAgICAgICBwcml2YXRlIENsYXNzTWV0YURh\ndGEgY21kOwoKICAgICAgICAvLyBNYXJrZXIgZm9yIHF1aWNrIGRldGVybWlu\nYXRpb24gaWYgdGhpcyBub2RlIGhhcyBkZXBlbmRlbmNpZXMKICAgICAgICBw\ncml2YXRlIGJvb2xlYW4gaGFzRGVwZW5kZW5jaWVzID0gZmFsc2U7CgogICAg\nICAgIC8vIExpc3Qgb2YgQ2xhc3NNZXRhRGF0YSBvYmplY3RzIHRoaXMgQ2xh\nc3NNZXRhRGF0YSBkZXBlbmRzIG9uCiAgICAgICAgcHJpdmF0ZSBIYXNoU2V0\nPENNRERlcGVuZGVuY3lOb2RlPiBkZXBlbmRzT25TZXQgPSBuZXcgSGFzaFNl\ndDxDTUREZXBlbmRlbmN5Tm9kZT4oKTsKCiAgICAgICAgLyoqCiAgICAgICAg\nICogSW5uZXIgY2xhc3MgY29uc3RydWN0b3IKICAgICAgICAgKi8KICAgICAg\nICBDTUREZXBlbmRlbmN5Tm9kZShDbGFzc01ldGFEYXRhIGNtZCkgewogICAg\nICAgICAgICB0aGlzLmNtZCA9IGNtZDsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIFJldHVybnMgdGhlIENsYXNzTWV0YURhdGEgaW5zdGFu\nY2UgcmVmZXJlbmNlZCBieSB0aGlzIG5vZGUuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0Q21kKCkgewogICAgICAgICAg\nICByZXR1cm4gY21kOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogCiAgICAgICAgICogQHJldHVybiB0cnVlIGlmIHRoaXMgbm9kZSdzIENs\nYXNzTWV0YURhdGEgaGFzIGEgRksgaW4gaXRzIGlkZW50aXR5IHRoYXQgcmVm\nZXJzIHRvIGFub3RoZXIgQ2xhc3NNZXRhRGF0YTsgCiAgICAgICAgICogICAg\nICAgICBmYWxzZSBpZiBpdCBkb2VzIG5vdC4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBnZXRIYXNEZXBlbmRlbmNpZXMoKSB7CiAgICAg\nICAgICAgIHJldHVybiBoYXNEZXBlbmRlbmNpZXM7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBSZWdpc3RlcnMgYSBDbGFzc01ldGFEYXRh\nIG1vZGVsbGVkIGJ5IGEgQ01ERGVwZW5kZW5jeU5vZGUgYXMgYSBkZXBlbmRl\nbmN5IG9mIHRoaXMgQ2xhc3NNZXRhRGF0YS4KICAgICAgICAgKiAKICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCByZWdpc3RlckRlcGVuZGVudE5v\nZGUoQ01ERGVwZW5kZW5jeU5vZGUgbm9kZSkgewogICAgICAgICAgICBnZXRE\nZXBlbmRzT25TZXQoKS5hZGQobm9kZSk7CiAgICAgICAgICAgIGhhc0RlcGVu\nZGVuY2llcyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBSZXR1cm5zIGEgU2V0IGNvbnRhaW5pbmcgYWxsIG9mIHRoZSBDTURE\nZXBlbmRlbmN5Tm9kZSBpbnN0YW5jZXMgdGhhdCB0aGlzIG5vZGUgaGFzIGEg\nRksgaW4gaWRlbnRpdHkgCiAgICAgICAgICogZGVwZW5kZW5jeSBvbi4KICAg\nICAgICAgKiAKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgU2V0PENNRERl\ncGVuZGVuY3lOb2RlPiBnZXREZXBlbmRzT25TZXQoKSB7CiAgICAgICAgICAg\nIHJldHVybiBkZXBlbmRzT25TZXQ7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBDaGVja3MgYWxsIGRlcGVuZGVuY2llcywgYW5kIHN1Yi1k\nZXBlbmRlbmNpZXMsIGZvciBhbnkgY3ljbGVzIGluIHRoZSBkZXBlbmRlbmN5\nIGdyYXBoLgogICAgICAgICAqIAogICAgICAgICAqIEByZXR1cm4gdHJ1ZSBp\nZiBhIGN5Y2xlIHdhcyBkaXNjb3ZlcmVkLCBmYWxzZSBpZiBub3QuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIGJvb2xlYW4gY2hlY2tGb3JDeWNsZSgp\nIHsKICAgICAgICAgICAgamF2YS51dGlsLlN0YWNrPENNRERlcGVuZGVuY3lO\nb2RlPiB2aXNpdFN0YWNrID0gbmV3IGphdmEudXRpbC5TdGFjazxDTUREZXBl\nbmRlbmN5Tm9kZT4oKTsKICAgICAgICAgICAgcmV0dXJuIGludGVybmFsQ2hl\nY2tGb3JDeWNsZSh2aXNpdFN0YWNrKTsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIHRoZSBj\neWNsZSBkZXRlY3Rpb24uCiAgICAgICAgICogCiAgICAgICAgICogQHBhcmFt\nIHZpc2l0U3RhY2sKICAgICAgICAgKiBAcmV0dXJuIHRydWUgaWYgYSBjeWNs\nZSBpcyBkZXRlY3RlZCwgZmFsc2UgaWYgbm8gY3ljbGUgd2FzIGRldGVjdGVk\nLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBpbnRlcm5h\nbENoZWNrRm9yQ3ljbGUoamF2YS51dGlsLlN0YWNrPENNRERlcGVuZGVuY3lO\nb2RlPiB2aXNpdFN0YWNrKSB7CiAgICAgICAgICAgIGlmICh2aXNpdFN0YWNr\nLmNvbnRhaW5zKHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2aXNpdFN0YWNrLnB1c2go\ndGhpcyk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9y\nIChDTUREZXBlbmRlbmN5Tm9kZSBub2RlIDogZGVwZW5kc09uU2V0KSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZ2V0SGFzRGVwZW5kZW5jaWVz\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuaW50ZXJu\nYWxDaGVja0ZvckN5Y2xlKHZpc2l0U3RhY2spID09IHRydWUpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgdmlzaXRTdGFjay5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gbmVlZHNQcmVsb2FkKE9w\ndGlvbnMgbykgewogICAgICAgIGlmIChvLmdldEJvb2xlYW5Qcm9wZXJ0eShQ\nUkVMT0FEX1NUUikgPT0gdHJ1ZSkgewogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKfQo=\n","encoding":"base64"}

