{"sha":"1acf3685cda203c8d52cac7d63be480640e1884d","node_id":"MDQ6QmxvYjIwNjM2NDoxYWNmMzY4NWNkYTIwM2M4ZDUyY2FjN2Q2M2JlNDgwNjQwZTE4ODRk","size":12146,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1acf3685cda203c8d52cac7d63be480640e1884d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLnNwaS5Mb2FkU3Rh\ndGU7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lz\ndGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFu\nY2UuU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5Ccm9rZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0YXRlTWFuYWdlckltcGw7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CgpwdWJsaWMgY2xhc3MgT3BlbkpQ\nQVBlcnNpc3RlbmNlVXRpbCB7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRo\nZSBpZGVudGlmaWVyIG9mIHRoZSBwZXJzaXN0ZW50IGVudGl0eS4KICAgICAq\nIEBwYXJhbSBlbnRpdHkKICAgICAqIEByZXR1cm4gVGhlIGlkZW50aWZpZXIg\nb2YgdGhlIGVudGl0eSBvciBudWxsIGlmIHRoZSBlbnRpdHkKICAgICAqIGlz\nIG5vdCBwZXJzaXN0ZW50LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9i\namVjdCBnZXRJZGVudGlmaWVyKE9iamVjdCBlbnRpdHkpIHsKICAgICAgICBy\nZXR1cm4gZ2V0SWRlbnRpZmllcihudWxsLCBlbnRpdHkpOwogICAgfQoKICAg\nIC8qKgogICAgICogR2V0IHRoZSBvYmplY3QgaWRlbnRpZmllciBmb3IgYSBw\nZXJzaXN0ZW50IGVudGl0eSBtYW5hZ2VkIGJ5IG9uZQogICAgICogb2YgdGhl\nIGVudGl0eSBtYW5hZ2VycyBvZiB0aGUgc3BlY2lmaWVkIGVudGl0eSBtYW5h\nZ2VyIGZhY3RvcnkuCiAgICAgKiBAcmV0dXJuIFRoZSBpZGVudGlmaWVyIG9m\nIHRoZSBlbnRpdHkgb3IgbnVsbCBpZiB0aGUgZW50aXR5IGRvZXMKICAgICAq\nIG5vdCBoYXZlIGFuIGlkZW50aWZpZXIgYXNzaWduZWQgb3IgaXMgbm90IG1h\nbmFnZWQgYnkgYW55IG9mIHRoZQogICAgICogZW50aXR5IG1hbmFnZXJzIG9m\nIHRoZSBlbnRpdHkgbWFuYWdlciBmYWN0b3J5LgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIE9iamVjdCBnZXRJZGVudGlmaWVyKE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyRmFjdG9yeSBlbWYsIAogICAgICAgIE9iamVjdCBlbnRpdHkpIHsK\nCiAgICAgICAgaWYgKGVudGl0eSBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSkgewogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAo\nUGVyc2lzdGVuY2VDYXBhYmxlKWVudGl0eTsKICAgICAgICAgICAgLy8gUGVy\nIGNvbnRyYWN0LCBpZiBub3QgbWFuYWdlZCBieSB0aGUgb3duaW5nIGVtZiwg\ncmV0dXJuIG51bGwuCiAgICAgICAgICAgIGlmIChlbWYgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKCFpc01hbmFnZWRCeShlbWYsIHBjKSkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIFN0YXRlTWFuYWdlciBz\nbSA9IHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgIAogICAg\nICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbSBpbnN0YW5jZW9mIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgb3NtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpc207CiAgICAg\nICAgICAgICAgICByZXR1cm4gb3NtLmdldE9iamVjdElkKCk7ICAgICAgICAg\nICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lcyB3aGV0\naGVyIHRoZSBzcGVjaWZpZWQgc3RhdGUgbWFuYWdlciBpcyBtYW5hZ2VkIGJ5\nIGFuIG9wZW4KICAgICAqIGJyb2tlciB3aXRoaW4gdGhlIHBlcnNpc3RlbmNl\nIHVuaXQgb2YgdGhlIHByb3ZpZGVkIEVNRiBpbnN0YW5jZS4KICAgICAqIEBw\nYXJhbSBlbWYgT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5CiAgICAgKiBA\ncGFyYW0gc20gU3RhdGVNYW5hZ2VyCiAgICAgKiBAcmV0dXJuIHRydWUgaWYg\ndGhpcyBzdGF0ZSBtYW5hZ2VyIGlzIG1hbmFnZWQgYnkgYSBicm9rZXIgd2l0\naGluCiAgICAgKiB0aGlzIHBlcnNpc3RlbmNlIHVuaXQuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc01hbmFnZWRCeShPcGVuSlBBRW50\naXR5TWFuYWdlckZhY3RvcnkgZW1mLCBPYmplY3QgZW50aXR5KSB7CiAgICAg\nICAgLy8gQXNzZXJ0IGEgdmFsaWQgZW1mIHdhcyBwcm92aWRlZCwgaXQgaXMg\nb3BlbiwgYW5kIHRoZSBlbnRpdHkgaXMgUEMKICAgICAgICBpZiAoZW1mID09\nIG51bGwgfHwgIWVtZi5pc09wZW4oKSB8fCAhSW1wbEhlbHBlci5pc01hbmFn\nZWFibGUoZW50aXR5KSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgICAgIC8vIEFzc2VydCB0aGUgY29udGV4dCBpcyBhIGJy\nb2tlcgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IChQZXJzaXN0\nZW5jZUNhcGFibGUpZW50aXR5OwogICAgICAgIGlmICghKHBjLnBjR2V0R2Vu\nZXJpY0NvbnRleHQoKSBpbnN0YW5jZW9mIEJyb2tlcikpIHsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBBc3NlcnQg\ndGhlIGJyb2tlciBpcyBhdmFpbGFibGUgYW5kIG9wZW4KICAgICAgICBCcm9r\nZXIgYnJva2VyID0gKEJyb2tlcilwYy5wY0dldEdlbmVyaWNDb250ZXh0KCk7\nCiAgICAgICAgaWYgKGJyb2tlciA9PSBudWxsIHx8IGJyb2tlci5pc0Nsb3Nl\nZCgpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAg\nICAgICAgLy8gQXNzZXJ0IHRoZSBlbWYgYXNzb2NpYXRlZCB3aXRoIHRoZSBQ\nQyBpcyB0aGUgc2FtZSBhcyB0aGUgcHJvdmlkZWQgZW1mCiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5IGVlbWYgPSBKUEFGYWNhZGVIZWxw\nZXIudG9FbnRpdHlNYW5hZ2VyRmFjdG9yeShicm9rZXIuZ2V0QnJva2VyRmFj\ndG9yeSgpKTsKICAgICAgICBpZiAoZWVtZiA9PSBlbWYgJiYgZWVtZi5pc09w\nZW4oKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRGV0\nZXJtaW5lcyB3aGV0aGVyIHRoZSBhdHRyaWJ1dGUgb24gdGhlIHNwZWNpZmll\nZCBvYmplY3QgaXMgbG9hZGVkIGFuZAogICAgICogaXMgbWFuYWdlZCBieSBv\nbmUgb2YgdGhlIGVudGl0eSBtYW5hZ2Vycy4gIFVzZSBpc01hbmFnZWRCeSgp\nIHRvCiAgICAgKiBkZXRlcm1pbmUgaWYgYW4gb2JqZWN0IGlzIG1hbmFnZWQg\nYnkgYSBzcGVjaWZpYyBlbnRpdHkgbWFuYWdlcgogICAgICogZmFjdG9yeS4K\nICAgICAqIAogICAgICogQHJldHVybiBMb2FkU3RhdGUuTE9BREVEIC0gaWYg\ndGhlIGF0dHJpYnV0ZSBpcyBsb2FkZWQuCiAgICAgKiAgICAgICAgIExvYWRT\ndGF0ZS5OT1RfTE9BREVEIC0gaWYgdGhlIGF0dHJpYnV0ZSBpcyBub3QgbG9h\nZGVkIG9yIGFueQogICAgICogICAgICAgICBFQUdFUiBmZXRjaCBhdHRyaWJ1\ndGVzIG9mIHRoZSBlbnRpdHkgYXJlIG5vdCBsb2FkZWQuCiAgICAgKiAgICAg\nICAgIExvYWRTdGF0ZS5VTktOT1dOIC0gaWYgdGhlIGVudGl0eSBpcyBub3Qg\nbWFuYWdlZCBieSB0aGlzCiAgICAgKiAgICAgICAgIHByb3ZpZGVyIG9yIGlm\nIGl0IGRvZXMgbm90IGNvbnRhaW4gdGhlIHBlcnNpc3RlbnQKICAgICAqICAg\nICAgICAgYXR0cmlidXRlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIExv\nYWRTdGF0ZSBpc0xvYWRlZChPYmplY3Qgb2JqLCBTdHJpbmcgYXR0cikgewoK\nICAgICAgICBpZiAob2JqID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJu\nIExvYWRTdGF0ZS5VTktOT1dOOwogICAgICAgIH0KICAgICAgICAKICAgICAg\nICAvLyBJZiB0aGUgb2JqZWN0IGhhcyBhIHN0YXRlIG1hbmFnZXIsIGNhbGwg\naXQgZGlyZWN0bHkuCiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFBlcnNp\nc3RlbmNlQ2FwYWJsZSkgewogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKW9iajsKICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VyIHNtID0gcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAg\nICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20gaW5zdGFuY2VvZiBPcGVu\nSlBBU3RhdGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXNM\nb2FkZWQoKE9wZW5KUEFTdGF0ZU1hbmFnZXIpc20sIGF0dHIsIG51bGwpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSAgICAgICAgCiAgICAgICAgcmV0dXJu\nIExvYWRTdGF0ZS5VTktOT1dOOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIExvYWRTdGF0ZSBpc0xvYWRlZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBT\ndHJpbmcgYXR0ciwgCiAgICAgICAgSGFzaFNldDxPcGVuSlBBU3RhdGVNYW5h\nZ2VyPiBwY3MpIHsKICAgICAgICBib29sZWFuIGlzTG9hZGVkID0gdHJ1ZTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBCaXRTZXQgbG9hZFNldCA9IHNt\nLmdldExvYWRlZCgpOwogICAgICAgICAgICBpZiAoYXR0ciAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RmllbGQoYXR0cik7CiAgICAgICAgICAgICAgICAvLyBD\nb3VsZCBub3QgZmluZCBmaWVsZCBtZXRhZGF0YSBmb3IgdGhlIHNwZWNpZmll\nZCBhdHRyaWJ1dGUuCiAgICAgICAgICAgICAgICBpZiAoZm1kID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTG9hZFN0YXRlLlVOS05P\nV047CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBPdGhl\ncndpc2UsIHJldHVybiB0aGUgbG9hZCBzdGF0ZQogICAgICAgICAgICAgICAg\naWYoIWxvYWRTZXQuZ2V0KGZtZC5nZXRJbmRleCgpKSkgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBMb2FkU3RhdGUuTk9UX0xPQURFRDsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgIC8vIENoZWNrIGxvYWQgc3RhdGUgb2YgYWxsIHBlcnNp\nc3RlbnQgZWFnZXIgZmV0Y2ggYXR0cmlidXRlcwogICAgICAgICAgICBpZiAo\nZm1kcyAhPSBudWxsICYmIGZtZHMubGVuZ3RoID4gMCkgewogICAgICAgICAg\nICAgICAgcGNzID0gYWRkVG9Mb2FkU2V0KHBjcywgc20pOwogICAgICAgICAg\nICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IGZtZHMpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAocmVxdWlyZXNGZXRjaChzbSwgZm1kKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTG9hZGVkRmllbGQoc20s\nIGZtZCwgcGNzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNM\nb2FkZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGNz\nLnJlbW92ZShzbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gdHJlYXQgYW55\nIGV4Y2VwdGlvbnMsIGxpa2UgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24KICAgICAgICAgICAgLy8gZm9yIGRldGFjaGVkIGVudGl0aWVzLCBhcyBM\nb2FkU3RhdGUuVU5LTk9XTgogICAgICAgICAgICByZXR1cm4gTG9hZFN0YXRl\nLlVOS05PV047CiAgICAgICAgfQogICAgICAgIHJldHVybiBpc0xvYWRlZCA/\nIExvYWRTdGF0ZS5MT0FERUQgOiBMb2FkU3RhdGUuTk9UX0xPQURFRDsgICAg\nICAgIAogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIHJl\ncXVpcmVzRmV0Y2goT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICBpZiAoc20gaW5zdGFuY2VvZiBTdGF0ZU1h\nbmFnZXJJbXBsKQogICAgICAgICAgICByZXR1cm4gKChTdGF0ZU1hbmFnZXJJ\nbXBsKXNtKS5yZXF1aXJlc0ZldGNoKGZtZCk7CiAgICAgICAgcmV0dXJuIGZt\nZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKTsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBIYXNoU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+IGFkZFRvTG9h\nZFNldCgKICAgICAgICBIYXNoU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+IHBj\ncywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIGlmIChwY3Mg\nPT0gbnVsbCkgewogICAgICAgICAgICBwY3MgPSBuZXcgSGFzaFNldDxPcGVu\nSlBBU3RhdGVNYW5hZ2VyPigpOwogICAgICAgIH0KICAgICAgICBwY3MuYWRk\nKHNtKTsKICAgICAgICByZXR1cm4gcGNzOwogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIGJvb2xlYW4gaXNMb2FkZWRGaWVsZChPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kLCBIYXNoU2V0PE9w\nZW5KUEFTdGF0ZU1hbmFnZXI+IHBjcykgewogICAgICAgIEJpdFNldCBsb2Fk\nU2V0ID0gc20uZ2V0TG9hZGVkKCk7CiAgICAgICAgICAgICAgICAKICAgICAg\nICAvLyBTaW1wbGUgbG9hZCBzdGF0ZSBjaGVjayBmb3IgdGhlIGZpZWxkCiAg\nICAgICAgaWYgKCFsb2FkU2V0LmdldChmbWQuZ2V0SW5kZXgoKSkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgT2JqZWN0IGZpZWxkID0g\nc20uZmV0Y2hGaWVsZChmbWQuZ2V0SW5kZXgoKSwgZmFsc2UpOwoKICAgICAg\nICAvLyBHZXQgdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBmaWVsZCwgaWYg\naXQgaXMgYSBQQwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2ZzbSA9\nIGdldFN0YXRlTWFuYWdlcihmaWVsZCk7CgogICAgICAgIC8vIFByZXZlbnQg\nY2lyY3VsYXIgbG9hZCBzdGF0ZSBldmFsdWF0aW9uIGZvciB0aGlzIHNtLgog\nICAgICAgIGlmIChvZnNtICE9IG51bGwgJiYgcGNzLmNvbnRhaW5zKG9mc20p\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgICAgICAv\nLyBJZiBhIGNvbGxlY3Rpb24gdHlwZSwgZGV0ZXJtaW5lIGlmIGl0IGlzIGxv\nYWRlZAogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOiAg\nIAogICAgICAgICAgICAgICAgcmV0dXJuIGlzTG9hZGVkQ29sbGVjdGlvbihz\nbSwgZm1kLmdldEVsZW1lbnQoKSwgCiAgICAgICAgICAgICAgICAgICAgKENv\nbGxlY3Rpb248Pz4pZmllbGQsIHBjcyk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIHJldHVybiBpc0xvYWRlZE1h\ncChzbSwgZm1kLCAKICAgICAgICAgICAgICAgICAgICAoTWFwPD8sPz4pZmll\nbGQsIHBjcyk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGlzTG9hZGVkQXJyYXkoc20sIGZtZC5n\nZXRFbGVtZW50KCksIAogICAgICAgICAgICAgICAgICAgIChPYmplY3RbXSlm\naWVsZCwgcGNzKTsKICAgICAgICB9CiAgICAgICAgLy8gSWYgb3RoZXIgUEMg\ndHlwZSwgZGV0ZXJtaW5lIGlmIGl0IGlzIGxvYWRlZAogICAgICAgIGlmIChv\nZnNtICE9IG51bGwgJiYgZm1kLmlzRGVjbGFyZWRUeXBlUEMoKSkgewogICAg\nICAgICAgICByZXR1cm4gaXNMb2FkZWQob2ZzbSwgbnVsbCwgcGNzKSA9PQog\nICAgICAgICAgICAgICAgTG9hZFN0YXRlLkxPQURFRDsKICAgICAgICB9Cgog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfSAKICAgIAogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBpc0xvYWRlZENvbGxlY3Rpb24oT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQsIENvbGxl\nY3Rpb248Pz4gY29sbCwgSGFzaFNldDxPcGVuSlBBU3RhdGVNYW5hZ2VyPiBw\nY3MpIHsKICAgICAgICAKICAgICAgICAvLyBUaGlzIGZpZWxkIHBhc3NlZCB0\naGUgbG9hZCBzdGF0ZSBjaGVjayBpbiBpc0xvYWRlZEZpZWxkLCBzbwogICAg\nICAgIC8vIGlmIGFueSBvZiB0aGVzZSBjb25kaXRpb25zIGFyZSB0cnVlIHRo\nZSBjb2xsZWN0aW9uIGlzIGxvYWRlZC4KICAgICAgICBpZiAoc20gPT0gbnVs\nbCB8fCBjb2xsID09IG51bGwgfHwgY29sbC5zaXplKCkgPT0gMCkgewogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgLy8gQ29udmVydCB0byBhcnJheSB0byBwcmV2ZW50IGNvbmN1cnJlbmN5\nIGlzc3VlcwogICAgICAgIE9iamVjdFtdIGFyciA9IGNvbGwudG9BcnJheSgp\nOwoKICAgICAgICByZXR1cm4gaXNMb2FkZWRBcnJheShzbSwgdm1kLCBhcnIs\nIHBjcyk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0xv\nYWRlZEFycmF5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIAogICAgICAgIFZh\nbHVlTWV0YURhdGEgdm1kLCBPYmplY3RbXSBhcnIsIAogICAgICAgIEhhc2hT\nZXQ8T3BlbkpQQVN0YXRlTWFuYWdlcj4gcGNzKSB7CgogICAgICAgIC8vIFRo\naXMgZmllbGQgcGFzc2VkIHRoZSBsb2FkIHN0YXRlIGNoZWNrIGluIGlzTG9h\nZGVkRmllbGQsIHNvCiAgICAgICAgLy8gaWYgYW55IG9mIHRoZXNlIGNvbmRp\ndGlvbnMgYXJlIHRydWUgdGhlIGFycmF5IGlzIGxvYWRlZC4KICAgICAgICBp\nZiAoc20gPT0gbnVsbCB8fCBhcnIgPT0gbnVsbCB8fCBhcnIubGVuZ3RoID09\nIDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAg\nICAgICAvLyBOb3QgYSBjb2xsZWN0aW9uIG9mIFBDJ3MgCiAgICAgICAgaWYg\nKCF2bWQuaXNEZWNsYXJlZFR5cGVQQygpKSB7CiAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChPYmplY3Qg\ncGMgOiBhcnIpIHsKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBl\nc20gPSBnZXRTdGF0ZU1hbmFnZXIocGMpOwogICAgICAgICAgICBpZiAoZXNt\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmICghKGlzTG9hZGVkKGVzbSwgbnVs\nbCwgcGNzKSA9PSBMb2FkU3RhdGUuTE9BREVEKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0xvYWRlZE1h\ncChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCAKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCwgTWFwPD8sPz4gbWFwLCBIYXNoU2V0PE9wZW5KUEFTdGF0ZU1h\nbmFnZXI+IHBjcykgewogICAgICAgICAgICAgICAgCiAgICAgICAgLy8gVGhp\ncyBmaWVsZCBwYXNzZWQgdGhlIGxvYWQgc3RhdGUgY2hlY2sgaW4gaXNMb2Fk\nZWRGaWVsZCwgc28KICAgICAgICAvLyBpZiBhbnkgb2YgdGhlc2UgY29uZGl0\naW9ucyBhcmUgdHJ1ZSB0aGUgbWFwIGlzIGxvYWRlZC4KICAgICAgICBpZiAo\nc20gPT0gbnVsbCB8fCBtYXAgPT0gbnVsbCB8fCBtYXAuc2l6ZSgpID09IDAp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAg\nICBib29sZWFuIGtleUlzUEMgPSBmbWQuZ2V0S2V5KCkuaXNEZWNsYXJlZFR5\ncGVQQygpOwogICAgICAgIGJvb2xlYW4gdmFsSXNQQyA9IGZtZC5nZXRFbGVt\nZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpOwoKICAgICAgICAvLyBNYXAgaXMg\nZG9lcyBub3QgY29udGFpbiBQQ3MgaW4gZWl0aGVyIGtleXMgb3IgdmFsdWVz\nCiAgICAgICAgaWYgKCEoa2V5SXNQQyB8fCB2YWxJc1BDKSkgewogICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIE9i\namVjdFtdIGFyciA9IG1hcC5rZXlTZXQoKS50b0FycmF5KCk7CgogICAgICAg\nIGZvciAoT2JqZWN0IGtleSA6IGFycikgewogICAgICAgICAgICBpZiAoa2V5\nSXNQQykgewogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBr\nc20gPSBnZXRTdGF0ZU1hbmFnZXIoa2V5KTsKICAgICAgICAgICAgICAgIGlm\nIChrc20gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAg\nIAogICAgICAgICAgICAgICAgaWYgKCEoaXNMb2FkZWQoa3NtLCBudWxsLCBw\nY3MpID09IExvYWRTdGF0ZS5MT0FERUQpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAo\ndmFsSXNQQykgewogICAgICAgICAgICAgICAgT2JqZWN0IHZhbHVlID0gbWFw\nLmdldChrZXkpOwogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciB2c20gPSBnZXRTdGF0ZU1hbmFnZXIodmFsdWUpOwogICAgICAgICAgICAg\nICAgaWYgKHZzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAg\nICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIShpc0xvYWRlZCh2c20sIG51\nbGwsIHBjcykgPT0gTG9hZFN0YXRlLkxPQURFRCkpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOyAgICAgICAgICAgICAgICAgICAgCiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgcHJpdmF0ZSBzdGF0aWMgT3BlbkpQQVN0YXRlTWFuYWdlciBnZXRT\ndGF0ZU1hbmFnZXIoT2JqZWN0IG9iaikgeyAgICAgICAgCiAgICAgICAgaWYg\nKG9iaiA9PSBudWxsIHx8ICEob2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VD\nYXBhYmxlKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gKFBl\ncnNpc3RlbmNlQ2FwYWJsZSlvYmo7CiAgICAgICAgU3RhdGVNYW5hZ2VyIHNt\nID0gcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICBpZiAoc20gPT0g\nbnVsbCB8fCAhKHNtIGluc3RhbmNlb2YgT3BlbkpQQVN0YXRlTWFuYWdlcikp\nIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiAoT3BlbkpQQVN0YXRlTWFuYWdlcilzbTsKICAgIH0KfQo=\n","encoding":"base64"}

