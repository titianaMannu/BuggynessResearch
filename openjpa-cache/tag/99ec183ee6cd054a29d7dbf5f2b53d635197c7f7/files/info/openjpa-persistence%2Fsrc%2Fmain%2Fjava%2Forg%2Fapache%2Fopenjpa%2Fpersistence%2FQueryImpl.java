{"sha":"df2f0289a2d5da60623f1219307936c3c986fb8e","node_id":"MDQ6QmxvYjIwNjM2NDpkZjJmMDI4OWEyZDVkYTYwNjIzZjEyMTkzMDc5MzZjM2M5ODZmYjhl","size":37360,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/df2f0289a2d5da60623f1219307936c3c986fb8e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5n\ndWFnZXMuTEFOR19QUkVQQVJFRF9TUUw7CgppbXBvcnQgamF2YS5pby5TZXJp\nYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5z\ncWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nbG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5GbHVzaE1vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTG9j\na01vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTm9SZXN1bHRF\neGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Ob25VbmlxdWVS\nZXN1bHRFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QYXJh\nbWV0ZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlRlbXBvcmFsVHlwZTsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlR5cGVkUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5jcml0ZXJpYS5QYXJhbWV0ZXJFeHByZXNzaW9uOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkJyb2tl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGlu\nZ1F1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5EZWxl\nZ2F0aW5nUmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GaWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5QcmVwYXJlZFF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5QcmVwYXJlZFF1ZXJ5Q2FjaGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5U3RhdGlzdGlj\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGlzdGluY3RS\nZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLkFnZ3JlZ2F0ZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5leHBzLkZpbHRlckxpc3RlbmVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5qcHFsLkpQUUxQYXJzZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5PcmRlcmVkTWFwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLmNyaXRlcmlhLkNyaXRlcmlh\nQnVpbGRlckltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUnVu\ndGltZUV4Y2VwdGlvblRyYW5zbGF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKCi8qKgogKiBJbXBsZW1lbnRh\ndGlvbiBvZiB7QGxpbmsgUXVlcnl9IGludGVyZmFjZS4KICogCiAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nIEBub2phdmFkb2MKICovCkBTdXBwcmVzc1dhcm5pbmdzKCJzZXJpYWwiKQpw\ndWJsaWMgY2xhc3MgUXVlcnlJbXBsPFg+IGltcGxlbWVudHMgT3BlbkpQQVF1\nZXJ5U1BJPFg+LCBTZXJpYWxpemFibGUgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2Uo\nUXVlcnlJbXBsLmNsYXNzKTsKCglwcml2YXRlIERlbGVnYXRpbmdRdWVyeSBf\ncXVlcnk7Cglwcml2YXRlIHRyYW5zaWVudCBFbnRpdHlNYW5hZ2VySW1wbCBf\nZW07Cglwcml2YXRlIHRyYW5zaWVudCBGZXRjaFBsYW4gX2ZldGNoOwoKICAg\nIHByaXZhdGUgTWFwPFBhcmFtZXRlcjw/PiwgT2JqZWN0PiBfYm91bmRQYXJh\nbXM7CiAgICBwcml2YXRlIE1hcDxPYmplY3QsIFBhcmFtZXRlcjw/Pj4gX2Rl\nY2xhcmVkUGFyYW1zOwoJcHJpdmF0ZSBTdHJpbmcgX2lkOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgUmVlbnRyYW50TG9jayBfbG9jayA9IG51bGw7Cglwcml2\nYXRlIEhpbnRIYW5kbGVyIF9oaW50SGFuZGxlcjsKCgkvKioKCSAqIENvbnN0\ncnVjdG9yOyBzdXBwbHkgZmFjdG9yeSBleGNlcHRpb24gdHJhbnNsYXRvciBh\nbmQgZGVsZWdhdGUuCgkgKiAKCSAqIEBwYXJhbSBlbSAgVGhlIEVudGl0eU1h\nbmFnZXIgd2hpY2ggY3JlYXRlZCB0aGlzIHF1ZXJ5CgkgKiBAcGFyYW0gcmV0\nIEV4Y2VwdGlvbiB0cmFuc2xhdG9yIGZvciB0aGlzIHF1ZXJ5CgkgKiBAcGFy\nYW0gcXVlcnkgVGhlIHVuZGVybHlpbmcgImtlcm5lbCIgcXVlcnkuCgkgKi8K\nCXB1YmxpYyBRdWVyeUltcGwoRW50aXR5TWFuYWdlckltcGwgZW0sIFJ1bnRp\nbWVFeGNlcHRpb25UcmFuc2xhdG9yIHJldCwKCQkJb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5RdWVyeSBxdWVyeSkgewoJCV9lbSA9IGVtOwoJCV9xdWVy\neSA9IG5ldyBEZWxlZ2F0aW5nUXVlcnkocXVlcnksIHJldCk7CgkJX2xvY2sg\nPSBuZXcgUmVlbnRyYW50TG9jaygpOwoJfQoKCS8qKgoJICogQ29uc3RydWN0\nb3I7IHN1cHBseSBmYWN0b3J5IGFuZCBkZWxlZ2F0ZS4KCSAqIAoJICogQGRl\ncHJlY2F0ZWQKCSAqLwoJcHVibGljIFF1ZXJ5SW1wbChFbnRpdHlNYW5hZ2Vy\nSW1wbCBlbSwKCSAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5R\ndWVyeSBxdWVyeSkgewoJCXRoaXMoZW0sIG51bGwsIHF1ZXJ5KTsKCX0KCgkv\nKioKCSAqIERlbGVnYXRlLgoJICovCglwdWJsaWMgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5RdWVyeSBnZXREZWxlZ2F0ZSgpIHsKCQlyZXR1cm4gX3F1\nZXJ5LmdldERlbGVnYXRlKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyIGdldEVudGl0eU1hbmFnZXIoKSB7CgkJcmV0dXJuIF9lbTsKCX0K\nCglwdWJsaWMgU3RyaW5nIGdldExhbmd1YWdlKCkgewoJCXJldHVybiBfcXVl\ncnkuZ2V0TGFuZ3VhZ2UoKTsKCX0KCglwdWJsaWMgUXVlcnlPcGVyYXRpb25U\neXBlIGdldE9wZXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gUXVlcnlPcGVy\nYXRpb25UeXBlLmZyb21LZXJuZWxDb25zdGFudChfcXVlcnkuZ2V0T3BlcmF0\naW9uKCkpOwoJfQoKCXB1YmxpYyBGZXRjaFBsYW4gZ2V0RmV0Y2hQbGFuKCkg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlfcXVlcnkuYXNz\nZXJ0Tm90U2VyaWFsaXplZCgpOwoJCV9xdWVyeS5sb2NrKCk7CgkJdHJ5IHsK\nCQkJaWYgKF9mZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZldGNo\nID0gKChFbnRpdHlNYW5hZ2VyRmFjdG9yeUltcGwpIF9lbQogICAgICAgICAg\nICAgICAgICAgICAgICAuZ2V0RW50aXR5TWFuYWdlckZhY3RvcnkoKSkudG9G\nZXRjaFBsYW4oX3F1ZXJ5CiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRC\ncm9rZXIoKSwgX3F1ZXJ5LmdldEZldGNoQ29uZmlndXJhdGlvbigpKTsKCQkJ\ncmV0dXJuIF9mZXRjaDsKCQl9IGZpbmFsbHkgewoJCQlfcXVlcnkudW5sb2Nr\nKCk7CgkJfQoJfQoKCXB1YmxpYyBTdHJpbmcgZ2V0UXVlcnlTdHJpbmcoKSB7\nCgkJcmV0dXJuIF9xdWVyeS5nZXRRdWVyeVN0cmluZygpOwoJfQoKCXB1Ymxp\nYyBib29sZWFuIGdldElnbm9yZUNoYW5nZXMoKSB7CgkJcmV0dXJuIF9xdWVy\neS5nZXRJZ25vcmVDaGFuZ2VzKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVy\neTxYPiBzZXRJZ25vcmVDaGFuZ2VzKGJvb2xlYW4gaWdub3JlKSB7CgkJX2Vt\nLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5zZXRJZ25vcmVD\naGFuZ2VzKGlnbm9yZSk7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJcHVibGljIE9w\nZW5KUEFRdWVyeTxYPiBhZGRGaWx0ZXJMaXN0ZW5lcihGaWx0ZXJMaXN0ZW5l\nciBsaXN0ZW5lcikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsK\nCQlfcXVlcnkuYWRkRmlsdGVyTGlzdGVuZXIobGlzdGVuZXIpOwoJCXJldHVy\nbiB0aGlzOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gcmVtb3ZlRmls\ndGVyTGlzdGVuZXIoRmlsdGVyTGlzdGVuZXIgbGlzdGVuZXIpIHsKCQlfZW0u\nYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LnJlbW92ZUZpbHRl\nckxpc3RlbmVyKGxpc3RlbmVyKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJs\naWMgT3BlbkpQQVF1ZXJ5PFg+IGFkZEFnZ3JlZ2F0ZUxpc3RlbmVyKEFnZ3Jl\nZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7CgkJX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwoJCV9xdWVyeS5hZGRBZ2dyZWdhdGVMaXN0ZW5lcihsaXN0\nZW5lcik7CgkJcmV0dXJuIHRoaXM7Cgl9CgogICAgcHVibGljIE9wZW5KUEFR\ndWVyeTxYPiByZW1vdmVBZ2dyZWdhdGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0\nZW5lciBsaXN0ZW5lcikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQo\nKTsKCQlfcXVlcnkucmVtb3ZlQWdncmVnYXRlTGlzdGVuZXIobGlzdGVuZXIp\nOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBDb2xsZWN0aW9uPD8+IGdl\ndENhbmRpZGF0ZUNvbGxlY3Rpb24oKSB7CgkJcmV0dXJuIF9xdWVyeS5nZXRD\nYW5kaWRhdGVDb2xsZWN0aW9uKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVy\neTxYPiBzZXRDYW5kaWRhdGVDb2xsZWN0aW9uKENvbGxlY3Rpb24gY29sbCkg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlfcXVlcnkuc2V0\nQ2FuZGlkYXRlQ29sbGVjdGlvbihjb2xsKTsKCQlyZXR1cm4gdGhpczsKCX0K\nCglwdWJsaWMgQ2xhc3MgZ2V0UmVzdWx0Q2xhc3MoKSB7CgkJQ2xhc3MgcmVz\nID0gX3F1ZXJ5LmdldFJlc3VsdFR5cGUoKTsKCQlpZiAocmVzICE9IG51bGwp\nCgkJCXJldHVybiByZXM7CgkJcmV0dXJuIF9xdWVyeS5nZXRDYW5kaWRhdGVU\neXBlKCk7Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRSZXN1bHRD\nbGFzcyhDbGFzcyBjbHMpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2Vk\nKCk7CgkJaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShfZW0uZ2V0Q29u\nZmlndXJhdGlvbigpLCBjbHMpKQoJCQlfcXVlcnkuc2V0Q2FuZGlkYXRlVHlw\nZShjbHMsIHRydWUpOwoJCWVsc2UKCQkJX3F1ZXJ5LnNldFJlc3VsdFR5cGUo\nY2xzKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgYm9vbGVhbiBoYXNT\ndWJjbGFzc2VzKCkgewoJCXJldHVybiBfcXVlcnkuaGFzU3ViY2xhc3Nlcygp\nOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0U3ViY2xhc3Nlcyhi\nb29sZWFuIHN1YnMpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7\nCgkJQ2xhc3M8Pz4gY2xzID0gX3F1ZXJ5LmdldENhbmRpZGF0ZVR5cGUoKTsK\nICAgICAgICBfcXVlcnkuc2V0Q2FuZGlkYXRlRXh0ZW50KF9xdWVyeS5nZXRC\ncm9rZXIoKS5uZXdFeHRlbnQoY2xzLCBzdWJzKSk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIGludCBnZXRGaXJzdFJlc3VsdCgpIHsKCQlyZXR1cm4g\nYXNJbnQoX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7Cgl9CgoJcHVibGljIE9w\nZW5KUEFRdWVyeTxYPiBzZXRGaXJzdFJlc3VsdChpbnQgc3RhcnRQb3NpdGlv\nbikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlsb25nIGVu\nZDsKCQlpZiAoX3F1ZXJ5LmdldEVuZFJhbmdlKCkgPT0gTG9uZy5NQVhfVkFM\nVUUpCgkJCWVuZCA9IExvbmcuTUFYX1ZBTFVFOwoJCWVsc2UKCQkJZW5kID0g\nc3RhcnRQb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICsgKF9xdWVyeS5n\nZXRFbmRSYW5nZSgpIC0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7CgkJX3F1\nZXJ5LnNldFJhbmdlKHN0YXJ0UG9zaXRpb24sIGVuZCk7CgkJcmV0dXJuIHRo\naXM7Cgl9CgoJcHVibGljIGludCBnZXRNYXhSZXN1bHRzKCkgewoJCXJldHVy\nbiBhc0ludChfcXVlcnkuZ2V0RW5kUmFuZ2UoKSAtIF9xdWVyeS5nZXRTdGFy\ndFJhbmdlKCkpOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0TWF4\nUmVzdWx0cyhpbnQgbWF4KSB7CgkJX2VtLmFzc2VydE5vdENsb3NlSW52b2tl\nZCgpOwoJCWxvbmcgc3RhcnQgPSBfcXVlcnkuZ2V0U3RhcnRSYW5nZSgpOwoJ\nCWlmIChtYXggPT0gSW50ZWdlci5NQVhfVkFMVUUpCgkJCV9xdWVyeS5zZXRS\nYW5nZShzdGFydCwgTG9uZy5NQVhfVkFMVUUpOwoJCWVsc2UKCQkJX3F1ZXJ5\nLnNldFJhbmdlKHN0YXJ0LCBzdGFydCArIG1heCk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIE9wZW5KUEFRdWVyeTxYPiBjb21waWxlKCkgewoJCV9l\nbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlfcXVlcnkuY29tcGlsZSgp\nOwoJCXJldHVybiB0aGlzOwoJfQoJCgkvKioKCSAqIEdldHMgYSBtYXAgb2Yg\ndmFsdWVzIG9mIGVhY2ggcGFyYW1ldGVyIGluZGV4ZWQgYnkgdGhlaXIgPGVt\nPm9yaWdpbmFsPC9lbT4ga2V5LgoJICogCgkgKiBAcmV0dXJuIGFuIGVtcHR5\nIG1hcCBpZiBubyBwYXJhbWV0ZXIgaXMgZGVjbGFyZWQgZm9yIHRoaXMgcXVl\ncnkuCiAgICAgKiBUaGUgdW5ib3VuZCBwYXJhbWV0ZXJzIGhhcyBhIHZhbHVl\nIG9mIG51bGwgd2hpY2ggaXMgaW5kaXN0aW5ndWlzaGFibGUKICAgICAqIGZy\nb20gdGhlIHZhbHVlIGJlaW5nIGJvdW5kIHRvIG51bGwuCgkgKi8KCU1hcDxP\nYmplY3QsT2JqZWN0PiBnZXRQYXJhbWV0ZXJWYWx1ZXMoKSB7CgkgICAgTWFw\nPE9iamVjdCxPYmplY3Q+IHJlc3VsdCA9IG5ldyBIYXNoTWFwPE9iamVjdCxP\nYmplY3Q+KCk7CgkgICAgaWYgKF9ib3VuZFBhcmFtcyA9PSBudWxsKQoJICAg\nICAgICByZXR1cm4gcmVzdWx0OwoJICAgIGZvciAoTWFwLkVudHJ5PE9iamVj\ndCxQYXJhbWV0ZXI8Pz4+IGVudHJ5IDogZ2V0RGVjbGFyZWRQYXJhbWV0ZXJz\nKCkuZW50cnlTZXQoKSkgewoJICAgICAgICBPYmplY3QgcGFyYW1LZXkgPSBl\nbnRyeS5nZXRLZXkoKTsKCSAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0g\nZW50cnkuZ2V0VmFsdWUoKTsKCSAgICAgICAgcmVzdWx0LnB1dChwYXJhbUtl\neSwgX2JvdW5kUGFyYW1zLmdldChwYXJhbSkpOwoJICAgIH0KCSAgICByZXR1\ncm4gcmVzdWx0OwoJfQoJCglwcml2YXRlIE9iamVjdCBleGVjdXRlKCkgewog\nICAgICAgIGlmICghaXNOYXRpdmUoKSAmJiBfcXVlcnkuZ2V0T3BlcmF0aW9u\nKCkgIT0gUXVlcnlPcGVyYXRpb25zLk9QX1NFTEVDVCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLXNlbGVjdC1xdWVyeSIsIGdldFF1ZXJ5U3RyaW5nKCkpLCBudWxsLCBudWxs\nLCBmYWxzZSk7CgkJdHJ5IHsKCQkgICAgbG9jaygpOwogICAgICAgICAgICBN\nYXAgcGFyYW1zID0gZ2V0UGFyYW1ldGVyVmFsdWVzKCk7CiAgICAgICAgICAg\nIGJvb2xlYW4gcmVnaXN0ZXJlZCA9IHByZUV4ZWN1dGUocGFyYW1zKTsKICAg\nICAgICAgICAgT2JqZWN0IHJlc3VsdCA9IF9xdWVyeS5leGVjdXRlKHBhcmFt\ncyk7CiAgICAgICAgICAgIGlmIChyZWdpc3RlcmVkKSB7CiAgICAgICAgICAg\nICAgICBwb3N0RXhlY3V0ZShyZXN1bHQpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiByZXN1bHQ7CgkJfSBmaW5hbGx5IHsKCQkgICAgdW5s\nb2NrKCk7CgkJfQoJfQoJCglwdWJsaWMgTGlzdCBnZXRSZXN1bHRMaXN0KCkg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlPYmplY3Qgb2Ig\nPSBleGVjdXRlKCk7CgkJaWYgKG9iIGluc3RhbmNlb2YgTGlzdCkgewoJCQlM\naXN0IHJldCA9IChMaXN0KSBvYjsKCQkJaWYgKHJldCBpbnN0YW5jZW9mIFJl\nc3VsdExpc3QpIHsKCQkJICAgIFJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9y\nIHRyYW5zID0gUGVyc2lzdGVuY2VFeGNlcHRpb25zLmdldFJvbGxiYWNrVHJh\nbnNsYXRvcihfZW0pOwoJCQkgICAgaWYgKF9xdWVyeS5pc0Rpc3RpbmN0KCkp\nIHsKCQkJICAgICAgICByZXR1cm4gbmV3IERpc3RpbmN0UmVzdWx0TGlzdCgo\nUmVzdWx0TGlzdCkgcmV0LCB0cmFucyk7CgkJCSAgICB9IGVsc2UgewoJCQkg\nICAgICAgIHJldHVybiBuZXcgRGVsZWdhdGluZ1Jlc3VsdExpc3QoKFJlc3Vs\ndExpc3QpIHJldCwgdHJhbnMpOwoJCQkgICAgfQoJCQl9IGVsc2UgewoJCQkJ\ncmV0dXJuIHJldDsKCQkJfQoJCX0KCgkJcmV0dXJuIENvbGxlY3Rpb25zLnNp\nbmdsZXRvbkxpc3Qob2IpOwoJfQoKCS8qKgoJICogRXhlY3V0ZSBhIHF1ZXJ5\nIHRoYXQgcmV0dXJucyBhIHNpbmdsZSByZXN1bHQuCgkgKi8KCXB1YmxpYyBY\nIGdldFNpbmdsZVJlc3VsdCgpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZv\na2VkKCk7CiAgICAgICAgc2V0SGludCgib3BlbmpwYS5oaW50Lk9wdGltaXpl\nUmVzdWx0Q291bnQiLCAxKTsgLy8gZm9yIERCMiBvcHRpbWl6YXRpb24KCQlM\naXN0IHJlc3VsdCA9IGdldFJlc3VsdExpc3QoKTsKCQlpZiAocmVzdWx0ID09\nIG51bGwgfHwgcmVzdWx0LmlzRW1wdHkoKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQiLCBn\nZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAgICAgIC5nZXRNZXNz\nYWdlKCkpOwoJCWlmIChyZXN1bHQuc2l6ZSgpID4gMSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE5vblVuaXF1ZVJlc3VsdEV4Y2VwdGlvbihfbG9jLmdldCgi\nbm9uLXVuaXF1ZS1yZXN1bHQiLAogICAgICAgICAgICAgICAgICAgIGdldFF1\nZXJ5U3RyaW5nKCksIHJlc3VsdC5zaXplKCkpLmdldE1lc3NhZ2UoKSk7CgkJ\ndHJ5IHsKCQkgICAgcmV0dXJuIChYKXJlc3VsdC5nZXQoMCk7CgkJfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5vUmVz\ndWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQiLCBnZXRRdWVyeVN0\ncmluZygpKQogICAgICAgICAgICAgICAgLmdldE1lc3NhZ2UoKSk7CgkJfQoJ\nfQoKCXB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHsKCQlfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgTWFwPD8sPz4gcGFyYW1WYWx1\nZXMgPSBnZXRQYXJhbWV0ZXJWYWx1ZXMoKTsKCQlpZiAoX3F1ZXJ5LmdldE9w\nZXJhdGlvbigpID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9ERUxFVEUpIHsKCQkg\nICByZXR1cm4gYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0eSgpID8gX3F1ZXJ5\nLmRlbGV0ZUFsbCgpIDogX3F1ZXJ5LmRlbGV0ZUFsbChwYXJhbVZhbHVlcykp\nOwoJCX0KCQlpZiAoX3F1ZXJ5LmdldE9wZXJhdGlvbigpID09IFF1ZXJ5T3Bl\ncmF0aW9ucy5PUF9VUERBVEUpIHsKCSAgICAgICByZXR1cm4gYXNJbnQocGFy\nYW1WYWx1ZXMuaXNFbXB0eSgpID8gX3F1ZXJ5LnVwZGF0ZUFsbCgpIDogX3F1\nZXJ5LnVwZGF0ZUFsbChwYXJhbVZhbHVlcykpOwoJCX0KICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtdXBk\nYXRlLWRlbGV0ZS1xdWVyeSIsIGdldFF1ZXJ5U3RyaW5nKCkpLCBudWxsLCBu\ndWxsLCBmYWxzZSk7Cgl9CgoJLyoqCgkgKiBDYXN0IHRoZSBzcGVjaWZpZWQg\nbG9uZyBkb3duIHRvIGFuIGludCwgZmlyc3QgY2hlY2tpbmcgZm9yIG92ZXJm\nbG93LgoJICovCglwcml2YXRlIHN0YXRpYyBpbnQgYXNJbnQobG9uZyBsKSB7\nCgkJaWYgKGwgPiBJbnRlZ2VyLk1BWF9WQUxVRSkKCQkJcmV0dXJuIEludGVn\nZXIuTUFYX1ZBTFVFOwogICAgICAgIGlmIChsIDwgSW50ZWdlci5NSU5fVkFM\nVUUpIC8vIHVubGlrZWx5LCBidXQgd2UgbWlnaHQgYXMgd2VsbCBjaGVjawoJ\nCQlyZXR1cm4gSW50ZWdlci5NSU5fVkFMVUU7CgkJcmV0dXJuIChpbnQpIGw7\nCgl9CgoJcHVibGljIEZsdXNoTW9kZVR5cGUgZ2V0Rmx1c2hNb2RlKCkgewoJ\nCXJldHVybiBFbnRpdHlNYW5hZ2VySW1wbC5mcm9tRmx1c2hCZWZvcmVRdWVy\naWVzKF9xdWVyeQogICAgICAgICAgICAgICAgLmdldEZldGNoQ29uZmlndXJh\ndGlvbigpLmdldEZsdXNoQmVmb3JlUXVlcmllcygpKTsKCX0KCglwdWJsaWMg\nT3BlbkpQQVF1ZXJ5PFg+IHNldEZsdXNoTW9kZShGbHVzaE1vZGVUeXBlIGZs\ndXNoTW9kZSkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlf\ncXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuc2V0Rmx1c2hCZWZvcmVR\ndWVyaWVzKAogICAgICAgICAgICAgICAgRW50aXR5TWFuYWdlckltcGwudG9G\nbHVzaEJlZm9yZVF1ZXJpZXMoZmx1c2hNb2RlKSk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIGJvb2xlYW4gaXNOYXRpdmUoKSB7CgkJcmV0dXJuIFF1\nZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhnZXRMYW5ndWFnZSgpKTsK\nCX0KCgkvKioKCSAqIEFzc2VydHMgdGhhdCB0aGlzIHF1ZXJ5IGlzIGEgSlBR\nTCBvciBDcml0ZXJpYSBRdWVyeS4KCSAqLwoJdm9pZCBhc3NlcnRKUFFMT3JD\ncml0ZXJpYVF1ZXJ5KCkgewogICAgICAgIFN0cmluZyBsYW5ndWFnZSA9IGdl\ndExhbmd1YWdlKCk7CiAgICAgICAgaWYgKEpQUUxQYXJzZXIuTEFOR19KUFFM\nLmVxdWFscyhsYW5ndWFnZSkgCiAgICAgICAgIHx8IFF1ZXJ5TGFuZ3VhZ2Vz\nLkxBTkdfUFJFUEFSRURfU1FMLmVxdWFscyhsYW5ndWFnZSkKICAgICAgICAg\nfHwgQ3JpdGVyaWFCdWlsZGVySW1wbC5MQU5HX0NSSVRFUklBLmVxdWFscyhs\nYW5ndWFnZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vdC1qcHFsLW9yLWNyaXRlcmlhLXF1ZXJ5IikuZ2V0\nTWVzc2FnZSgpKTsKICAgICAgICB9Cgl9CgoJcHVibGljIE9wZW5KUEFRdWVy\neTxYPiBjbG9zZUFsbCgpIHsKCQlfcXVlcnkuY2xvc2VBbGwoKTsKCQlyZXR1\ncm4gdGhpczsKCX0KCglwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0\naW9ucyhNYXAgcGFyYW1zKSB7CgkJcmV0dXJuIF9xdWVyeS5nZXREYXRhU3Rv\ncmVBY3Rpb25zKHBhcmFtcyk7Cgl9CgogICAgcHVibGljIExvY2tNb2RlVHlw\nZSBnZXRMb2NrTW9kZSgpIHsKICAgICAgICBhc3NlcnRKUFFMT3JDcml0ZXJp\nYVF1ZXJ5KCk7CiAgICAgICAgcmV0dXJuIGdldEZldGNoUGxhbigpLmdldFJl\nYWRMb2NrTW9kZSgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyBsb2Nr\nIG1vZGUgb24gdGhlIGdpdmVuIHF1ZXJ5LgogICAgICogSWYgdGhlIHRhcmdl\ndCBxdWVyeSBoYXMgYmVlbiBwcmVwYXJlZCBhbmQgY2FjaGVkLCB0aGVuIGln\nbm9yZXMgdGhlIGNhY2hlZCB2ZXJzaW9uLgogICAgICogQHNlZSAjaWdub3Jl\nUHJlcGFyZWRRdWVyeSgpCiAgICAgKi8KICAgIHB1YmxpYyBUeXBlZFF1ZXJ5\nPFg+IHNldExvY2tNb2RlKExvY2tNb2RlVHlwZSBsb2NrTW9kZSkgewogICAg\nICAgIFN0cmluZyBsYW5ndWFnZSA9IGdldExhbmd1YWdlKCk7CiAgICAgICAg\naWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURfU1FMLmVxdWFscyhs\nYW5ndWFnZSkpIHsKICAgICAgICAgICAgaWdub3JlUHJlcGFyZWRRdWVyeSgp\nOwogICAgICAgIH0KICAgICAgICBhc3NlcnRKUFFMT3JDcml0ZXJpYVF1ZXJ5\nKCk7CiAgICAgICBnZXRGZXRjaFBsYW4oKS5zZXRSZWFkTG9ja01vZGUobG9j\na01vZGUpOwogICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgoJcHVibGljIGlu\ndCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gKF9xdWVyeSA9PSBudWxs\nKSA/IDAgOiBfcXVlcnkuaGFzaENvZGUoKTsKCX0KCglwdWJsaWMgYm9vbGVh\nbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CgkJaWYgKG90aGVyID09IHRoaXMp\nCgkJCXJldHVybiB0cnVlOwogICAgICAgIGlmICgob3RoZXIgPT0gbnVsbCkg\nfHwgKG90aGVyLmdldENsYXNzKCkgIT0gdGhpcy5nZXRDbGFzcygpKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChfcXVlcnkgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCXJldHVybiBfcXVl\ncnkuZXF1YWxzKCgoUXVlcnlJbXBsKSBvdGhlcikuX3F1ZXJ5KTsKCX0KCgkv\nKioKCSAqIEdldCBhbGwgdGhlIGFjdGl2ZSBoaW50cyBhbmQgdGhlaXIgdmFs\ndWVzLgoJICogCgkgKi8KICAgIC8vVE9ETzogSlBBIDIuMCBIaW50cyB0aGF0\nIGFyZSBub3Qgc2V0IHRvIEZldGNoQ29uZmlndXJhdGlvbiAKICAgIHB1Ymxp\nYyBNYXA8U3RyaW5nLCBPYmplY3Q+IGdldEhpbnRzKCkgewogICAgICAgIGlm\nIChfaGludEhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLmVtcHR5TWFwKCk7CiAgICAgICAgcmV0dXJuIF9oaW50SGFu\nZGxlci5nZXRIaW50cygpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVl\ncnk8WD4gc2V0SGludChTdHJpbmcga2V5LCBPYmplY3QgdmFsdWUpIHsKICAg\nICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgaWYg\nKF9oaW50SGFuZGxlciA9PSBudWxsKSB7CiAgICAgICAgICAgIF9oaW50SGFu\nZGxlciA9IG5ldyBIaW50SGFuZGxlcih0aGlzKTsKICAgICAgICB9CiAgICAg\nICAgX2hpbnRIYW5kbGVyLnNldEhpbnQoa2V5LCB2YWx1ZSk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNldDxTdHJpbmc+IGdl\ndFN1cHBvcnRlZEhpbnRzKCkgewogICAgICAgIGlmIChfaGludEhhbmRsZXIg\nPT0gbnVsbCkgewogICAgICAgICAgICBfaGludEhhbmRsZXIgPSBuZXcgSGlu\ndEhhbmRsZXIodGhpcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfaGlu\ndEhhbmRsZXIuZ2V0U3VwcG9ydGVkSGludHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIGlubmVybW9zdCBpbXBsZW1lbnRhdGlvbiB0\naGF0IGlzIGFuIGluc3RhbmNlIG9mIHRoZSBnaXZlbiAKICAgICAqIGNsYXNz\nLiAKICAgICAqIAogICAgICogQHRocm93cyBQZXJzaXN0ZW5jZUV4Y2VwdGlv\nbiBpZiBub25lIGluIHRoZSBkZWxlZ2F0ZSBjaGFpbiBpcyBhbiAKICAgICAq\nIGluc3RhbmNlIG9mIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqIAogICAgICog\nQHNpbmNlIDIuMC4wCiAgICAgKi8KICAgIHB1YmxpYyA8VD4gVCB1bndyYXAo\nQ2xhc3M8VD4gY2xzKSB7CiAgICAgICAgT2JqZWN0W10gZGVsZWdhdGVzID0g\nbmV3IE9iamVjdFtde19xdWVyeS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpLCAK\nICAgICAgICAgICAgX3F1ZXJ5LmdldERlbGVnYXRlKCksIF9xdWVyeSwgdGhp\nc307CiAgICAgICAgaWYgKGNscyA9PSBudWxsIHx8IGNscyA9PSBPYmplY3Qu\nY2xhc3MpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBlcnNpc3RlbmNlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJ1bndyYXAtZW0taW52YWxpZCIsIGNscykKICAg\nICAgICAgICAgICAgICAgICAudG9TdHJpbmcoKSwgbnVsbCwgdGhpcywgZmFs\nc2UpOwogICAgICAgIH0KICAgICAgICBmb3IgKE9iamVjdCBvIDogZGVsZWdh\ndGVzKSB7CiAgICAgICAgICAgIGlmIChjbHMuaXNJbnN0YW5jZShvKSkKICAg\nICAgICAgICAgICAgIHJldHVybiAoVClvOwogICAgICAgIH0KICAgICAgICB0\naHJvdyBuZXcgUGVyc2lzdGVuY2VFeGNlcHRpb24oX2xvYy5nZXQoInVud3Jh\ncC1xdWVyeS1pbnZhbGlkIiwgY2xzKQogICAgICAgICAgICAudG9TdHJpbmco\nKSwgbnVsbCwgdGhpcywgZmFsc2UpOwogICAgfQogICAgCiAgICAvLyA9PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gUHJlcGFyZWQgUXVlcnkg\nQ2FjaGUgcmVsYXRlZCBtZXRob2RzCiAgICAvLyA9PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PQogICAgCiAgICAvKioKICAgICAqIEludm9rZWQgYmVmb3Jl\nIGEgcXVlcnkgaXMgZXhlY3V0ZWQuCiAgICAgKiBJZiB0aGlzIHJlY2VpdmVy\nIGlzIGNhY2hlZCBhcyBhIHtAbGlua3BsYWluIFByZXBhcmVkUXVlcnkgcHJl\ncGFyZWQgcXVlcnl9CiAgICAgKiB0aGVuIHJlLXBhcmFtZXRlcml6ZXMgdGhl\nIGdpdmVuIHVzZXIgcGFyYW1ldGVycy4gVGhlIGdpdmVuIG1hcCBpcyBjbGVh\ncmVkCiAgICAgKiBhbmQgcmUtcGFyYW1ldGVyaXplZCB2YWx1ZXMgYXJlIGZp\nbGxlZCBpbi4gCiAgICAgKiAKICAgICAqIEBwYXJhbSBwYXJhbXMgdXNlciBz\ndXBwbGllZCBwYXJhbWV0ZXIga2V5LXZhbHVlcy4gQWx3YXlzIHN1cHBseSBh\nIAogICAgICogbm9uLW51bGwgbWFwIGV2ZW4gaWYgdGhlIHVzZXIgaGFzIG5v\ndCBzcGVjaWZpZWQgYW55IHBhcmFtZXRlciwgYmVjYXVzZSAKICAgICAqIHRo\nZSBzYW1lIG1hcCB3aWxsIHRvIGJlIHBvcHVsYXRlZCBieSByZS1wYXJhbWV0\nZXJpemF0aW9uLgogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhp\ncyBpbnZvY2F0aW9uIGNhdXNlZCB0aGUgcXVlcnkgYmVpbmcgcmVnaXN0ZXJl\nZCBpbiB0aGUKICAgICAqIGNhY2hlLiAKICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIHByZUV4ZWN1dGUoTWFwIHBhcmFtcykgewogICAgICAgIFByZXBh\ncmVkUXVlcnlDYWNoZSBjYWNoZSA9IF9lbS5nZXRQcmVwYXJlZFF1ZXJ5Q2Fj\naGUoKTsKICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkgewogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCA9IF9xdWVyeS5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICBCb29sZWFuIHJlZ2lzdGVyZWQgPSBjYWNoZS5yZWdpc3Rl\ncihfaWQsIF9xdWVyeSwgZmV0Y2gpOwogICAgICAgIGJvb2xlYW4gYWxyZWFk\neUNhY2hlZCA9IChyZWdpc3RlcmVkID09IG51bGwpOwogICAgICAgIFN0cmlu\nZyBsYW5nID0gX3F1ZXJ5LmdldExhbmd1YWdlKCk7CiAgICAgICAgUXVlcnlT\ndGF0aXN0aWNzPFN0cmluZz4gc3RhdHMgPSBjYWNoZS5nZXRTdGF0aXN0aWNz\nKCk7CiAgICAgICAgaWYgKGFscmVhZHlDYWNoZWQgJiYgTEFOR19QUkVQQVJF\nRF9TUUwuZXF1YWxzKGxhbmcpKSB7CiAgICAgICAgICAgIFByZXBhcmVkUXVl\ncnkgcHEgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeShfaWQpOwogICAgICAgICAg\nICBpZiAocHEuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIE1hcCByZXAgPSBwcS5yZXBhcmFt\nZXRyaXplKHBhcmFtcywgX2VtLmdldEJyb2tlcigpKTsKICAgICAgICAgICAg\nICAgICAgICBwYXJhbXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBw\nYXJhbXMucHV0QWxsKHJlcCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChV\nc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW52YWxp\nZGF0ZVByZXBhcmVkUXVlcnkoKTsKICAgICAgICAgICAgICAgICAgICBMb2cg\nbG9nID0gX2VtLmdldENvbmZpZ3VyYXRpb24oKS5nZXRMb2coT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uTE9HX1JVTlRJTUUpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBsb2cud2Fybih1ZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICBzdGF0cy5yZWNvcmRFeGVjdXRpb24ocHEu\nZ2V0T3JpZ2luYWxRdWVyeSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBzdGF0cy5yZWNvcmRFeGVjdXRpb24oX3F1ZXJ5LmdldFF1ZXJ5U3Ry\naW5nKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVnaXN0ZXJlZCA9\nPSBCb29sZWFuLlRSVUU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogSW5p\ndGlhbGl6ZSB0aGUgcmVnaXN0ZXJlZCBQcmVwYXJlZCBRdWVyeSBmcm9tIHRo\nZSBnaXZlbiBvcGFxdWUgb2JqZWN0LgogICAgICogCiAgICAgKiBAcGFyYW0g\ncmVzdWx0IGFuIG9wYXF1ZSBvYmplY3QgcmVwcmVzZW50aW5nIGV4ZWN1dGlv\nbiByZXN1bHQgb2YgYSBxdWVyeQogICAgICogCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgdGhlIHByZXBhcmVkIHF1ZXJ5IGNhbiBiZSBpbml0aWFsaXplZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHBvc3RFeGVjdXRlKE9iamVj\ndCByZXN1bHQpIHsKICAgICAgICBQcmVwYXJlZFF1ZXJ5Q2FjaGUgY2FjaGUg\nPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeUNhY2hlKCk7CiAgICAgICAgaWYgKGNh\nY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gY2FjaGUuaW5pdGlhbGl6ZShfaWQsIHJl\nc3VsdCkgIT0gbnVsbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZW1v\ndmUgdGhpcyBxdWVyeSBmcm9tIFByZXBhcmVkUXVlcnlDYWNoZS4gCiAgICAg\nKi8KICAgIGJvb2xlYW4gaW52YWxpZGF0ZVByZXBhcmVkUXVlcnkoKSB7CiAg\nICAgICAgUHJlcGFyZWRRdWVyeUNhY2hlIGNhY2hlID0gX2VtLmdldFByZXBh\ncmVkUXVlcnlDYWNoZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWdub3JlUHJlcGFy\nZWRRdWVyeSgpOwogICAgICAgIHJldHVybiBjYWNoZS5pbnZhbGlkYXRlKF9p\nZCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogSWdub3JlcyB0aGlzIHF1\nZXJ5IGZyb20gUHJlcGFyZWRRdWVyeUNhY2hlIGJ5IHJlY3JlYXRpbmcgdGhl\nIG9yaWdpbmFsCiAgICAgKiBxdWVyeSBpZiBpdCBoYXMgYmVlbiBjYWNoZWQu\nIAogICAgICovCiAgICB2b2lkIGlnbm9yZVByZXBhcmVkUXVlcnkoKSB7CiAg\nICAgICAgUHJlcGFyZWRRdWVyeSBjYWNoZWQgPSBfZW0uZ2V0UHJlcGFyZWRR\ndWVyeShfaWQpOwogICAgICAgIGlmIChjYWNoZWQgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIEJyb2tlciBicm9rZXIgPSBfZW0uZ2V0\nQnJva2VyKCk7CiAgICAgICAgLy8gQ3JpdGljYWwgYXNzdW1wdGlvbjogT25s\neSBKUFFMIHF1ZXJpZXMgYXJlIGNhY2hlZCBhbmQgbW9yZSAKICAgICAgICAv\nLyBpbXBvcnRhbnRseSwgdGhlIGlkZW50aWZpZXIgb2YgdGhlIHByZXBhcmVk\nIHF1ZXJ5IGlzIHRoZSBvcmlnaW5hbAogICAgICAgIC8vIEpQUUwgU3RyaW5n\nCiAgICAgICAgU3RyaW5nIEpQUUwgPSBKUFFMUGFyc2VyLkxBTkdfSlBRTDsK\nICAgICAgICBTdHJpbmcganBxbCA9IF9pZDsKICAgICAgICAKICAgICAgICBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IG5ld1F1ZXJ5ID0gYnJv\na2VyLm5ld1F1ZXJ5KEpQUUwsIGpwcWwpOwogICAgICAgIG5ld1F1ZXJ5Lmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpLmNvcHkoX3F1ZXJ5LmdldEZldGNoQ29u\nZmlndXJhdGlvbigpKTsKICAgICAgICBuZXdRdWVyeS5jb21waWxlKCk7CiAg\nICAgICAgX3F1ZXJ5ID0gbmV3IERlbGVnYXRpbmdRdWVyeShuZXdRdWVyeSwg\nX2VtLmdldEV4Y2VwdGlvblRyYW5zbGF0b3IoKSk7CiAgICB9CiAgICAKICAg\nIC8vIHBhY2thZ2UgcHJvdGVjdGVkCiAgICBRdWVyeUltcGwgc2V0SWQoU3Ry\naW5nIGlkKSB7CiAgICAgICAgX2lkID0gaWQ7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CiAgICAvLyA9PT09PT09PT09PT09PT09IEVuZCBvZiBQcmVw\nYXJlZCBRdWVyeSByZWxhdGVkIG1ldGhvZHMgPT09PT09PT09PT09PT09PT09\nPT09CiAgICAKICAgIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sg\nIT0gbnVsbCkgCiAgICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAgIH0KCiAg\nICB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkK\nICAgICAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgCiAgICAv\nLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8v\nICAgUGFyYW1ldGVyIHByb2Nlc3Npbmcgcm91dGluZXMKICAgIC8vID09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIC8qKgogICAg\nICogQmluZHMgdGhlIHBhcmFtZXRlciBpZGVudGlmaWVkIGJ5IHRoZSBnaXZl\nbiBwb3NpdGlvbiB0byB0aGUgZ2l2ZW4gdmFsdWUuCiAgICAgKiBUaGUgcGFy\nYW1ldGVyIGFyZSBib3VuZCB0byBhIHZhbHVlIGluIHRoZSBjb250ZXh0IG9m\nIHRoaXMgcXVlcnkuIAogICAgICogVGhlIHNhbWUgcGFyYW1ldGVyIG1heSBi\nZSBib3VuZCB0byBhIGRpZmZlcmVudCB2YWx1ZSBpbiB0aGUgY29udGV4dCBv\nZiAKICAgICAqIGFub3RoZXIgcXVlcnkuCiAgICAgKiA8YnI+CiAgICAgKiBG\nb3Igbm9uLW5hdGl2ZSBxdWVyaWVzLCB0aGUgZ2l2ZW4gcG9zaXRpb24gbXVz\ndCBiZSBhIHZhbGlkIHBvc2l0aW9uIGluCiAgICAgKiB0aGUgZGVjbGFyZWQg\ncGFyYW1ldGVycy4KICAgICAqIDxicj4KICAgICAqIEFzIG5hdGl2ZSBxdWVy\naWVzIG1heSBub3QgYmUgcGFyc2VkIGFuZCBoZW5jZSB0aGVpciBkZWNsYXJl\nZCBwYXJhbWV0ZXJzCiAgICAgKiBtYXkgbm90IGJlIGtub3duLCBzZXR0aW5n\nIGFuIHBvc2l0aW9uYWwgcGFyYW1ldGVyIGhhcyB0aGUgc2lkZS1lZmZlY3QK\nICAgICAqIG9mIGEgcG9zaXRpb25hbCBwYXJhbWV0ZXIgYmVpbmcgZGVjbGFy\nZWQuCiAgICAgKiAgIAogICAgICogQHBhcmFtIHBvc2l0aW9uIHBvc2l0aXZl\nLCBpbnRlZ2VyIHBvc2l0aW9uIG9mIHRoZSBwYXJhbWV0ZXIKICAgICAqIEBw\nYXJhbSB2YWx1ZSBhbiBhc3NpZ25tZW50IGNvbXBhdGlibGUgdmFsdWUKICAg\nICAqIEByZXR1cm4gdGhlIHNhbWUgcXVlcnkgaW5zdGFuY2UKICAgICAqIEB0\naHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHBvc2l0aW9uIGRv\nZXMgbm90IGNvcnJlc3BvbmQgdG8gYSBwb3NpdGlvbmFsIAogICAgICogcGFy\nYW1ldGVyIG9mIHRoZSBxdWVyeSBvciBpZiB0aGUgYXJndW1lbnQgaXMgb2Yg\naW5jb3JyZWN0IHR5cGUKICAgICAqLyAgICAKICAgIHB1YmxpYyBPcGVuSlBB\nUXVlcnk8WD4gc2V0UGFyYW1ldGVyKGludCBwb3MsIE9iamVjdCB2YWx1ZSkg\newogICAgICAgIF9xdWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2VtLmFz\nc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHBvcyA8IDEpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24oX2xvYy5nZXQoImlsbGVnYWwtaW5kZXgiLCBwb3MpLmdldE1lc3NhZ2Uo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgUGFyYW1ldGVyPD8+IHBh\ncmFtID0gbnVsbDsKICAgICAgICAgICAgaWYgKGlzTmF0aXZlKCkpIHsKICAg\nICAgICAgICAgICAgIHBhcmFtID0gbmV3IFBhcmFtZXRlckltcGw8T2JqZWN0\nPihwb3MsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgICAgICBkZWNsYXJl\nUGFyYW1ldGVyKHBvcywgcGFyYW0pOwogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgcGFyYW0gPSBnZXRQYXJhbWV0ZXIocG9zKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBiaW5kVmFsdWUocGFyYW0sIHZhbHVl\nKTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhl\nIGdpdmVuIHBvc2l0aW9uYWwgcGFyYW1ldGVyIGFmdGVyIGNvbnZlcnNpb24g\nb2YgdGhlCiAgICAgKiBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gVGVtcG9y\nYWwgVHlwZS4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBz\nZXRQYXJhbWV0ZXIoaW50IHBvc2l0aW9uLCBDYWxlbmRhciB2YWx1ZSwgVGVt\ncG9yYWxUeXBlIHQpIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVyKHBv\nc2l0aW9uLCBjb252ZXJ0VGVtcG9yYWxUeXBlKHZhbHVlLCB0KSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4g\nbmFtZWQgcGFyYW1ldGVyIGFmdGVyIGNvbnZlcnNpb24gb2YgdGhlCiAgICAg\nKiBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gVGVtcG9yYWwgVHlwZS4KICAg\nICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXIo\naW50IHBvc2l0aW9uLCBEYXRlIHZhbHVlLCBUZW1wb3JhbFR5cGUgdHlwZSkg\newogICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIocG9zaXRpb24sIGNvbnZl\ncnRUZW1wb3JhbFR5cGUodmFsdWUsIHR5cGUpKTsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gRGF0ZSB0byBhIHZhbHVl\nIGNvcnJlc3BvbmRpbmcgdG8gZ2l2ZW4gdGVtcG9yYWwgdHlwZS4KICAgICAq\nLwogICAgT2JqZWN0IGNvbnZlcnRUZW1wb3JhbFR5cGUoRGF0ZSB2YWx1ZSwg\nVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsK\nICAgICAgICBjYXNlIERBVEU6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsK\nICAgICAgICBjYXNlIFRJTUU6CiAgICAgICAgICAgIHJldHVybiBuZXcgVGlt\nZSh2YWx1ZS5nZXRUaW1lKCkpOwogICAgICAgIGNhc2UgVElNRVNUQU1QOgog\nICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcCh2YWx1ZS5nZXRUaW1l\nKCkpOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KICAgIH0KCiAgICBPYmplY3QgY29udmVydFRlbXBvcmFs\nVHlwZShDYWxlbmRhciB2YWx1ZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAg\nICAgICByZXR1cm4gY29udmVydFRlbXBvcmFsVHlwZSh2YWx1ZS5nZXRUaW1l\nKCksIHR5cGUpOwogICAgfQoKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiBk\nZWNsYXJlZCBwYXJhbWV0ZXJzIHVzZSBwb3NpdGlvbiBpZGVudGlmaWVyLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNQb3NpdGlvbmFsUGFyYW1l\ndGVycygpIHsKICAgICAgICByZXR1cm4gIWdldERlY2xhcmVkUGFyYW1ldGVy\nS2V5cyhJbnRlZ2VyLmNsYXNzKS5pc0VtcHR5KCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBHZXRzIHRoZSBhcnJheSBvZiBwb3NpdGlvbmFsIHBhcmFtZXRl\nciB2YWx1ZXMuCiAgICAgKiBUaGUgbi10aCBhcnJheSBlbGVtZW50IHJlcHJl\nc2VudHMgKG4rMSktdGggcG9zaXRpb25hbCBwYXJhbWV0ZXIuICAKICAgICAq\nIElmIGEgcGFyYW1ldGVyIGhhcyBiZWVuIGRlY2xhcmVkIGJ1dCBub3QgYm91\nbmQgdG8gYSB2YWx1ZSB0aGVuCiAgICAgKiB0aGUgdmFsdWUgaXMgbnVsbCBh\nbmQgaGVuY2UgaXMgaW5kaXN0aW5ndWlzaGFibGUgZnJvbSB0aGUgdmFsdWUK\nICAgICAqIGJlaW5nIGFjdHVhbGx5IG51bGwuCiAgICAgKiBJZiB0aGUgcGFy\nYW1ldGVyIGluZGV4aW5nIGlzIG5vdCBjb250aWd1b3VzIHRoZW4gdGhlIHVu\nc3BlY2lmaWVkCiAgICAgKiBwYXJhbWV0ZXJzIGFyZSBjb25zaWRlcmVkIGFz\nIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3RbXSBnZXRQb3NpdGlv\nbmFsUGFyYW1ldGVycygpIHsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFNldDxJbnRlZ2VyPiBwb3NpdGlvbmFs\nS2V5cyA9IGdldERlY2xhcmVkUGFyYW1ldGVyS2V5cyhJbnRlZ2VyLmNsYXNz\nKTsKICAgICAgICAgICAgT2JqZWN0W10gcmVzdWx0ID0gbmV3IE9iamVjdFtj\nYWxjdWxhdGVNYXhLZXkocG9zaXRpb25hbEtleXMpXTsKICAgICAgICAgICAg\nZm9yIChJbnRlZ2VyIHBvcyA6IHBvc2l0aW9uYWxLZXlzKSB7CiAgICAgICAg\nICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQYXJhbWV0ZXIocG9z\nKTsKICAgICAgICAgICAgICAgIHJlc3VsdFtwb3MuaW50VmFsdWUoKS0xXSA9\nIGlzQm91bmQocGFyYW0pID8gZ2V0UGFyYW1ldGVyVmFsdWUocG9zKSA6IG51\nbGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENhbGN1\nbGF0ZSB0aGUgbWF4aW11bSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gc2V0LgogICAg\nICovCiAgICBpbnQgY2FsY3VsYXRlTWF4S2V5KFNldDxJbnRlZ2VyPiBwKSB7\nCiAgICAgICAgaWYgKHAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDA7\nCiAgICAgICAgaW50IG1heCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAgICAg\nIGZvciAoSW50ZWdlciBpIDogcCkKICAgICAgICAgICAgbWF4ID0gTWF0aC5t\nYXgobWF4LCBpKTsKICAgICAgICByZXR1cm4gbWF4OwogICAgfQoKICAgIC8q\nKgogICAgICogQmluZHMgdGhlIGdpdmVuIHZhbHVlcyBhcyBwb3NpdGlvbmFs\nIHBhcmFtZXRlcnMuIAogICAgICogVGhlIG4tdGggYXJyYXkgZWxlbWVudCB2\nYWx1ZSBpcyBzZXQgdG8gYSBQYXJhbWV0ZXIgd2l0aCAobisxKS10aCBwb3Np\ndGlvbmFsIGlkZW50aWZpZXIuICAKICAgICAqLwogICAgcHVibGljIE9wZW5K\nUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXJzKE9iamVjdC4uLiBwYXJhbXMpIHsK\nICAgICAgICBfcXVlcnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9lbS5hc3Nl\ncnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNsZWFyQmluZGluZygpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgcGFyYW1zICE9IG51bGwgJiYgaSA8\nIHBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgc2V0UGFy\nYW1ldGVyKGkgKyAxLCBwYXJhbXNbaV0pOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICAK\nICAgIHZvaWQgY2xlYXJCaW5kaW5nKCkgewogICAgICAgIGlmIChfYm91bmRQ\nYXJhbXMgIT0gbnVsbCkKICAgICAgICAgICAgX2JvdW5kUGFyYW1zLmNsZWFy\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSB2YWx1ZSBvZiBh\nbGwgdGhlIG5hbWVkIHBhcmFtZXRlcnMuICAKICAgICAqIAogICAgICogSWYg\nYSBwYXJhbWV0ZXIgaGFzIGJlZW4gZGVjbGFyZWQgYnV0IG5vdCBib3VuZCB0\nbyBhIHZhbHVlIHRoZW4KICAgICAqIHRoZSB2YWx1ZSBpcyBudWxsIGFuZCBo\nZW5jZSBpcyBpbmRpc3Rpbmd1aXNoYWJsZSBmcm9tIHRoZSB2YWx1ZQogICAg\nICogYmVpbmcgYWN0dWFsbHkgbnVsbC4KICAgICAqLwogICAgcHVibGljIE1h\ncDxTdHJpbmcsIE9iamVjdD4gZ2V0TmFtZWRQYXJhbWV0ZXJzKCkgewogICAg\nICAgIF9xdWVyeS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nTWFwPFN0cmluZywgT2JqZWN0PiByZXN1bHQgPSBuZXcgSGFzaE1hcDxTdHJp\nbmcsIE9iamVjdD4oKTsKICAgICAgICAgICAgU2V0PFN0cmluZz4gbmFtZWRL\nZXlzID0gZ2V0RGVjbGFyZWRQYXJhbWV0ZXJLZXlzKFN0cmluZy5jbGFzcyk7\nCiAgICAgICAgICAgIGZvciAoU3RyaW5nIG5hbWUgOiBuYW1lZEtleXMpIHsK\nICAgICAgICAgICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldFBhcmFt\nZXRlcihuYW1lKTsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQobmFtZSwg\naXNCb3VuZChwYXJhbSkgPyBnZXRQYXJhbWV0ZXJWYWx1ZShuYW1lKSA6IG51\nbGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgdGhl\nIHZhbHVlcyBvZiB0aGUgcGFyYW1ldGVycyBmcm9tIHRoZSBnaXZlbiBNYXAu\nCiAgICAgKiBUaGUga2V5cyBvZiB0aGUgZ2l2ZW4gbWFwIGRlc2lnbmF0ZSB0\naGUgbmFtZSBvZiB0aGUgZGVjbGFyZWQgcGFyYW1ldGVyLgogICAgICAKICAg\nICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXJz\nKE1hcCBwYXJhbXMpIHsKICAgICAgICBfcXVlcnkuYXNzZXJ0T3BlbigpOwog\nICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBf\ncXVlcnkubG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNsZWFy\nQmluZGluZygpOwogICAgICAgICAgICBpZiAocGFyYW1zICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBmb3IgKE1hcC5FbnRyeSBlIDogKFNldDxNYXAuRW50\ncnk+KSBwYXJhbXMuZW50cnlTZXQoKSkKICAgICAgICAgICAgICAgICAgICBz\nZXRQYXJhbWV0ZXIoKFN0cmluZykgZS5nZXRLZXkoKSwgZS5nZXRWYWx1ZSgp\nKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgcGFyYW1ldGVyIG9mIHRoZSBn\naXZlbiBuYW1lIGFuZCB0eXBlLgogICAgICogCiAgICAgKiBAdGhyb3dzIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1ldGVyIG9mIHRo\nZQogICAgICogICAgICAgICBzcGVjaWZpZWQgbmFtZSBkb2VzIG5vdCBleGlz\ndCBvciBpcyBub3QgYXNzaWduYWJsZQogICAgICogICAgICAgICB0byB0aGUg\ndHlwZQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYg\naW52b2tlZCBvbiBhIG5hdGl2ZSBxdWVyeSAKICAgICAqLwogICAgcHVibGlj\nIDxUPiBQYXJhbWV0ZXI8VD4gZ2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lLCBD\nbGFzczxUPiB0eXBlKSB7CiAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0g\nZ2V0UGFyYW1ldGVyKG5hbWUpOwogICAgICAgIGlmIChwYXJhbS5nZXRQYXJh\nbWV0ZXJUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihwYXJhbSAr\nICIgZG9lcyBub3QgbWF0Y2ggdGhlIHJlcXVlc3RlZCB0eXBlICIgKyB0eXBl\nKTsKICAgICAgICByZXR1cm4gKFBhcmFtZXRlcjxUPilwYXJhbTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEdldCB0aGUgcG9zaXRpb25hbCBwYXJhbWV0ZXIg\nd2l0aCB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHR5cGUuCiAgICAgKiBAdGhy\nb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1ldGVy\nIHdpdGggdGhlCiAgICAgKiAgICAgICAgIHNwZWNpZmllZCBwb3NpdGlvbiBk\nb2VzIG5vdCBleGlzdCBvciBpcyBub3QgYXNzaWduYWJsZQogICAgICogICAg\nICAgICB0byB0aGUgdHlwZQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVF\neGNlcHRpb24gaWYgaW52b2tlZCBvbiBhIG5hdGl2ZSBxdWVyeSB1bmxlc3MK\nICAgICAqIHRoZSBzYW1lIHBhcmFtZXRlciBwb3NpdGlvbiBpcyBib3VuZCBh\nbHJlYWR5LgogICAgICovCiAgICBwdWJsaWMgPFQ+IFBhcmFtZXRlcjxUPiBn\nZXRQYXJhbWV0ZXIoaW50IHBvcywgQ2xhc3M8VD4gdHlwZSkgewogICAgICAg\nIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldFBhcmFtZXRlcihwb3MpOwogICAg\nICAgIGlmIChwYXJhbS5nZXRQYXJhbWV0ZXJUeXBlKCkuaXNBc3NpZ25hYmxl\nRnJvbSh0eXBlKSkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbihwYXJhbSArICIgZG9lcyBub3QgbWF0Y2ggdGhlIHJl\ncXVlc3RlZCB0eXBlICIgKyB0eXBlKTsKICAgICAgICByZXR1cm4gKFBhcmFt\nZXRlcjxUPilwYXJhbTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgdmFsdWUgYm91bmQgdG8gdGhlIHBhcmFtZXRlci4KICAgICAqIEBwYXJh\nbSBwYXJhbSBwYXJhbWV0ZXIgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHBhcmFt\nZXRlciB2YWx1ZQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24gaWYgdGhlIHBhcmFtZXRlciBoYXMgbm90IGJlZW4gYmVlbiBib3VuZAog\nICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgdGhl\nIHBhcmFtZXRlciBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBxdWVyeQogICAg\nICovCiAgICBwdWJsaWMgPFQ+IFQgZ2V0UGFyYW1ldGVyVmFsdWUoUGFyYW1l\ndGVyPFQ+IHApIHsKICAgICAgICBpZiAoIWlzQm91bmQocCkpIHsKICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJwYXJhbS1taXNzaW5nIiwgcCwgZ2V0UXVlcnlTdHJpbmcoKSwgCiAg\nICAgICAgICAgICAgIGdldEJvdW5kUGFyYW1ldGVyS2V5cygpKS5nZXRNZXNz\nYWdlKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKFQpX2JvdW5kUGFy\nYW1zLmdldChwKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIHBh\ncmFtZXRlcnMgZGVjbGFyZWQgaW4gdGhpcyBxdWVyeS4KICAgICAqLwogICAg\ncHVibGljIFNldDxQYXJhbWV0ZXI8Pz4+IGdldFBhcmFtZXRlcnMoKSB7CiAg\nICAgICAgU2V0PFBhcmFtZXRlcjw/Pj4gcmVzdWx0ID0gbmV3IEhhc2hTZXQ8\nUGFyYW1ldGVyPD8+PigpOwogICAgICAgIHJlc3VsdC5hZGRBbGwoZ2V0RGVj\nbGFyZWRQYXJhbWV0ZXJzKCkudmFsdWVzKCkpOwogICAgICAgIHJldHVybiBy\nZXN1bHQ7CiAgICB9CgogICAgcHVibGljIDxUPiBPcGVuSlBBUXVlcnk8WD4g\nc2V0UGFyYW1ldGVyKFBhcmFtZXRlcjxUPiBwLCBUIGFyZzEpIHsKICAgICAg\nICBiaW5kVmFsdWUoKFBhcmFtZXRlcjxUPilwLCBhcmcxKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+\nIHNldFBhcmFtZXRlcihQYXJhbWV0ZXI8RGF0ZT4gcCwgRGF0ZSBkYXRlLCBU\nZW1wb3JhbFR5cGUgdHlwZSkgewogICAgICAgIHJldHVybiBzZXRQYXJhbWV0\nZXIocCwgKERhdGUpY29udmVydFRlbXBvcmFsVHlwZShkYXRlLCB0eXBlKSk7\nCiAgICB9CgogICAgcHVibGljIFR5cGVkUXVlcnk8WD4gc2V0UGFyYW1ldGVy\nKFBhcmFtZXRlcjxDYWxlbmRhcj4gcCwgQ2FsZW5kYXIgY2FsLCBUZW1wb3Jh\nbFR5cGUgdHlwZSkgewogICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIocCwg\nKENhbGVuZGFyKWNvbnZlcnRUZW1wb3JhbFR5cGUoY2FsLCB0eXBlKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHBhcmFtZXRlciBvYmplY3Qg\nY29ycmVzcG9uZGluZyB0byB0aGUgZGVjbGFyZWQgcGFyYW1ldGVyIG9mIHRo\nZSBnaXZlbiBuYW1lLgogICAgICogVGhpcyBtZXRob2QgaXMgbm90IHJlcXVp\ncmVkIHRvIGJlIHN1cHBvcnRlZCBmb3IgbmF0aXZlIHF1ZXJpZXMuCiAgICAg\nKiAKICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlm\nIHRoZSBwYXJhbWV0ZXIgb2YgdGhlIHNwZWNpZmllZCBuYW1lIGRvZXMgbm90\nIGV4aXN0CiAgICAgKiBAdGhyb3dzIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBp\nZiBpbnZva2VkIG9uIGEgbmF0aXZlIHF1ZXJ5CiAgICAgKi8KICAgIHB1Ymxp\nYyBQYXJhbWV0ZXI8Pz4gZ2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgaWYgKGlzTmF0aXZlKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgicGFyYW0tbmFtZWQt\nbm9uLW5hdGl2ZSIsIG5hbWUpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQog\nICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldERlY2xhcmVkUGFyYW1l\ndGVycygpLmdldChuYW1lKTsKICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCkg\newogICAgICAgICAgICBTZXQ8UGFyYW1ldGVyRXhwcmVzc2lvbj4gZXhwcyA9\nIGdldERlY2xhcmVkUGFyYW1ldGVyS2V5cyhQYXJhbWV0ZXJFeHByZXNzaW9u\nLmNsYXNzKTsKICAgICAgICAgICAgZm9yIChQYXJhbWV0ZXJFeHByZXNzaW9u\nPD8+IGUgOiBleHBzKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZS5lcXVh\nbHMoZS5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBl\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoInBhcmFtLW1pc3NpbmctbmFt\nZSIsIAogICAgICAgICAgICAgICAgbmFtZSwgZ2V0UXVlcnlTdHJpbmcoKSwg\nZ2V0RGVjbGFyZWRQYXJhbWV0ZXJLZXlzKCkpLmdldE1lc3NhZ2UoKSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBwYXJhbTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEdldCB0aGUgcG9zaXRpb25hbCBwYXJhbWV0ZXIgd2l0aCB0aGUg\nZ2l2ZW4gcG9zaXRpb24uCiAgICAgKiBUaGUgcGFyYW1ldGVyIG1heSBqdXN0\nIGhhdmUgYmVlbiBkZWNsYXJlZCBhbmQgbm90IGJvdW5kIHRvIGEgdmFsdWUu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBwb3NpdGlvbiBzcGVjaWZpZWQgaW4g\ndGhlIHVzZXIgcXVlcnkuCiAgICAgKiBAcmV0dXJuIHBhcmFtZXRlciBvYmpl\nY3QKICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlm\nIHRoZSBwYXJhbWV0ZXIgd2l0aCB0aGUgZ2l2ZW4gcG9zaXRpb24gZG9lcyBu\nb3QgZXhpc3QKICAgICAqLwogICAgcHVibGljIFBhcmFtZXRlcjw/PiBnZXRQ\nYXJhbWV0ZXIoaW50IHBvcykgewogICAgICAgIFBhcmFtZXRlcjw/PiBwYXJh\nbSA9IGdldERlY2xhcmVkUGFyYW1ldGVycygpLmdldChwb3MpOwogICAgICAg\nIGlmIChwYXJhbSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1taXNzaW5n\nLXBvcyIsIAogICAgICAgICAgICAgICAgcG9zLCBnZXRRdWVyeVN0cmluZygp\nLCBnZXREZWNsYXJlZFBhcmFtZXRlcktleXMoKSkuZ2V0TWVzc2FnZSgpKTsK\nICAgICAgICByZXR1cm4gcGFyYW07CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHZhbHVlIGJvdW5kIHRvIHRoZSBwYXJhbWV0ZXIuCiAgICAg\nKiAKICAgICAqIEBwYXJhbSBuYW1lIG5hbWUgb2YgdGhlIHBhcmFtZXRlcgog\nICAgICogQHJldHVybiBwYXJhbWV0ZXIgdmFsdWUKICAgICAqIAogICAgICog\nQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgdGhpcyBwYXJhbWV0\nZXIgaGFzIG5vdCBiZWVuIGJvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0UGFyYW1ldGVyVmFsdWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBy\nZXR1cm4gX2JvdW5kUGFyYW1zLmdldChnZXRQYXJhbWV0ZXIobmFtZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBib3VuZCB0\nbyB0aGUgcGFyYW1ldGVyLgogICAgICogCiAgICAgKiBAcGFyYW0gcG9zIHBv\nc2l0aW9uIG9mIHRoZSBwYXJhbWV0ZXIKICAgICAqIEByZXR1cm4gcGFyYW1l\ndGVyIHZhbHVlCiAgICAgKiAKICAgICAqIEB0aHJvd3MgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uIGlmIHRoaXMgcGFyYW1ldGVyIGhhcyBub3QgYmVlbiBib3Vu\nZAogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldFBhcmFtZXRlclZhbHVl\nKGludCBwb3MpIHsKICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQ\nYXJhbWV0ZXIocG9zKTsKICAgICAgICBhc3NlcnRCb3VuZChwYXJhbSk7CiAg\nICAgICAgcmV0dXJuIF9ib3VuZFBhcmFtcy5nZXQocGFyYW0pOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIHBhcmFtZXRlciBrZXlzIGJv\ndW5kIHdpdGggdGhpcyBxdWVyeS4KICAgICAqIFBhcmFtZXRlciBrZXkgY2Fu\nIGJlIEludGVnZXIsIFN0cmluZyBvciBhIFBhcmFtZXRlckV4cHJlc3Npb24g\naXRzZWxmCiAgICAgKiBidXQgYWxsIHBhcmFtZXRlcnMga2V5cyBvZiBhIHBh\ncnRpY3VsYXIgcXVlcnkgYXJlIG9mIHRoZSBzYW1lIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTZXQ8Pz4gZ2V0Qm91bmRQYXJhbWV0ZXJLZXlzKCkgewog\nICAgICAgIGlmIChfYm91bmRQYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICBnZXREZWNs\nYXJlZFBhcmFtZXRlcnMoKTsKICAgICAgICBTZXQ8T2JqZWN0PiByZXN1bHQg\nPSBuZXcgSGFzaFNldDxPYmplY3Q+KCk7CiAgICAgICAgZm9yIChNYXAuRW50\ncnk8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+IGVudHJ5IDogX2RlY2xhcmVkUGFy\nYW1zLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgaWYgKGlzQm91bmQoZW50\ncnkuZ2V0VmFsdWUoKSkpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQo\nZW50cnkuZ2V0S2V5KCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nR2V0cyB0aGUgZGVjbGFyZWQgcGFyYW1ldGVyIGtleXMgaW4gdGhlIGdpdmVu\nIHF1ZXJ5LgogICAgICogVGhpcyBpbmZvcm1hdGlvbiBpcyBvbmx5IGF2YWls\nYWJsZSBhZnRlciB0aGUgcXVlcnkgaGFzIGJlZW4gcGFyc2VkLgogICAgICog\nQXMgbmF0aXZlIGxhbmd1YWdlIHF1ZXJpZXMgYXJlIG5vdCBwYXJzZWQsIHRo\naXMgaW5mb3JtYXRpb24gaXMgbm90IGF2YWlsYWJsZSBmb3IgdGhlbS4KICAg\nICAqICAgCiAgICAgKiBAcmV0dXJuIHNldCBvZiBwYXJhbWV0ZXIgaWRlbnRp\nZmllcnMgaW4gYSBwYXJzZWQgcXVlcnkKICAgICAqLwogICAgcHVibGljIFNl\ndDw/PiBnZXREZWNsYXJlZFBhcmFtZXRlcktleXMoKSB7CiAgICAgICAgcmV0\ndXJuIGdldERlY2xhcmVkUGFyYW1ldGVycygpLmtleVNldCgpOwogICAgfQog\nICAgCiAgICBwdWJsaWMgPFQ+IFNldDxUPiBnZXREZWNsYXJlZFBhcmFtZXRl\ncktleXMoQ2xhc3M8VD4ga2V5VHlwZSkgewogICAgICAgIFNldDxUPiByZXN1\nbHQgPSBuZXcgSGFzaFNldDxUPigpOwogICAgICAgIGZvciAoT2JqZWN0IGtl\neSA6IGdldERlY2xhcmVkUGFyYW1ldGVyS2V5cygpKSB7CiAgICAgICAgICAg\nIGlmIChrZXlUeXBlLmlzSW5zdGFuY2Uoa2V5KSkKICAgICAgICAgICAgICAg\nIHJlc3VsdC5hZGQoKFQpa2V5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHJlc3VsdDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBw\nYXJhbWV0ZXIgaW5zdGFuY2VzIGRlY2xhcmVkIGluIHRoaXMgcXVlcnkuCiAg\nICAgKiBBbGwgcGFyYW1ldGVyIGtleXMgYXJlIG9mIHRoZSBzYW1lIHR5cGUu\nIEl0IGlzIG5vdCBhbGxvd2VkIHRvIG1peCBrZXlzIG9mIGRpZmZlcmVudCB0\neXBlCiAgICAgKiBzdWNoIGFzIG5hbWVkIGFuZCBwb3NpdGlvbmFsIGtleXMu\nIAogICAgICogCiAgICAgKiBGb3Igc3RyaW5nLWJhc2VkIHF1ZXJpZXMsIHRo\nZSBwYXJzZXIgc3VwcGxpZXMgdGhlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBk\nZWNsYXJlZCBwYXJhbWV0ZXJzCiAgICAgKiBhcyBhIExpbmtlZE1hcCBvZiBl\neHBlY3RlZCBwYXJhbWV0ZXIgdmFsdWUgdHlwZSBpbmRleGVkIGJ5IHBhcmFt\nZXRlciBpZGVudGlmaWVyLgogICAgICogRm9yIG5vbiBzdHJpbmctYmFzZWQg\ncXVlcmllcyB0aGF0IGEgZmFjYWRlIGl0c2VsZiBtYXkgY29uc3RydWN0IChl\nLmcuIENyaXRlcmlhUXVlcnkpLAogICAgICogdGhlIHBhcmFtZXRlcnMgbXVz\ndCBiZSBkZWNsYXJlZCBieSB0aGUgY2FsbGVyLgogICAgICogVGhpcyByZWNl\naXZlciBjb25zdHJ1Y3RzIGNvbmNyZXRlIFBhcmFtZXRlciBpbnN0YW5jZXMg\nZnJvbSB0aGUgZ2l2ZW4gcGFyYW1ldGVyIGlkZW50aWZpZXJzLgogICAgICog\nCiAgICAgKiBAcmV0dXJuIGEgTWFwIHdoZXJlIHRoZSBrZXkgcmVwcmVzZW50\ncyB0aGUgb3JpZ2luYWwgaWRlbnRpZmllciBvZiB0aGUgcGFyYW1ldGVyIChj\nYW4gYmUgYSBTdHJpbmcsCiAgICAgKiBJbnRlZ2VyIG9yIGEgUGFyYW1ldGVy\nRXhwcmVzc2lvbiBpdHNlbGYpIGFuZCB0aGUgdmFsdWUgaXMgdGhlIGNvbmNy\nZXRlIFBhcmFtZXRlciBpbnN0YW5jZQogICAgICogZWl0aGVyIGNvbnN0cnVj\ndGVkIGFzIGEgcmVzdWx0IG9mIHRoaXMgY2FsbCBvciBzdXBwbGllZCBieSBk\nZWNsYXJpbmcgdGhlIHBhcmFtZXRlciBleHBsaWNpdGx5CiAgICAgKiB2aWEg\ne0BsaW5rcGxhaW4gI2RlY2xhcmVQYXJhbWV0ZXIoUGFyYW1ldGVyKX0uCiAg\nICAgKi8KICAgIHB1YmxpYyBNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+IGdl\ndERlY2xhcmVkUGFyYW1ldGVycygpIHsKICAgICAgICBpZiAoX2RlY2xhcmVk\nUGFyYW1zID09IG51bGwpIHsKICAgICAgICAgICAgX2RlY2xhcmVkUGFyYW1z\nID0gbmV3IEhhc2hNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+KCk7CiAgICAg\nICAgICAgIE9yZGVyZWRNYXA8T2JqZWN0LENsYXNzPD8+PiBwYXJhbVR5cGVz\nID0gX3F1ZXJ5LmdldE9yZGVyZWRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAg\nICAgICBmb3IgKE9iamVjdCBrZXkgOiBwYXJhbVR5cGVzLmtleVNldCgpKSB7\nCiAgICAgICAgICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBudWxsOwog\nICAgICAgICAgICAgICAgQ2xhc3M8Pz4gZXhwZWN0ZWRWYWx1ZVR5cGUgPSBw\nYXJhbVR5cGVzLmdldChrZXkpOwogICAgICAgICAgICAgICAgaWYgKGtleSBp\nbnN0YW5jZW9mIEludGVnZXIpIHsKICAgICAgICAgICAgICAgICAgICBwYXJh\nbSA9IG5ldyBQYXJhbWV0ZXJJbXBsKChJbnRlZ2VyKWtleSwgZXhwZWN0ZWRW\nYWx1ZVR5cGUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgaW5z\ndGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbSA9\nIG5ldyBQYXJhbWV0ZXJJbXBsKChTdHJpbmcpa2V5LCBleHBlY3RlZFZhbHVl\nVHlwZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSBpbnN0YW5j\nZW9mIFBhcmFtZXRlcikgewogICAgICAgICAgICAgICAgICAgIHBhcmFtID0g\nKFBhcmFtZXRlcjw/PilrZXk7CiAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24oInBhcmFtZXRlciBpZGVudGlmaWVyICIgKyBrZXkgKyAiIHVu\ncmVjb2duaXplZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgZGVjbGFyZVBhcmFtZXRlcihrZXksIHBhcmFtKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2RlY2xhcmVkUGFyYW1zOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIERlY2xhcmVzIHRoZSBnaXZlbiBw\nYXJhbWV0ZXIgZm9yIHRoaXMgcXVlcnkuIAogICAgICogVXNlZCBieSBub24t\nc3RyaW5nIGJhc2VkIHF1ZXJpZXMgdGhhdCBhcmUgY29uc3RydWN0ZWQgYnkg\ndGhlIGZhY2FkZSBpdHNlbGYgcmF0aGVyIHRoYW4KICAgICAqIE9wZW5KUEEg\ncGFyc2luZyB0aGUgcXVlcnkgdG8gZGV0ZWN0IHRoZSBkZWNsYXJlZCBwYXJh\nbWV0ZXJzLgogICAgICogCiAgICAgKiBAcGFyYW0ga2V5IHRoaXMgaXMgdGhl\nIGtleSB0byBpZGVudGlmeSB0aGUgcGFyYW1ldGVyIGxhdGVyIGluIHRoZSBj\nb250ZXh0IG9mIHRoaXMgcXVlcnkuCiAgICAgKiBWYWxpZCBrZXkgdHlwZXMg\nYXJlIEludGVnZXIsIFN0cmluZyBvciBQYXJhbWV0ZXJFeHByZXNzaW9uIGl0\nc2VsZi4KICAgICAqIEBwYXJhbSB0aGUgcGFyYW1ldGVyIGluc3RhbmNlIHRv\nIGJlIGRlY2xhcmVkCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGRlY2xhcmVQ\nYXJhbWV0ZXIoT2JqZWN0IGtleSwgUGFyYW1ldGVyPD8+IHBhcmFtKSB7CiAg\nICAgICAgaWYgKF9kZWNsYXJlZFBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIF9kZWNsYXJlZFBhcmFtcyA9IG5ldyBIYXNoTWFwPE9iamVjdCwgUGFy\nYW1ldGVyPD8+PigpOwogICAgICAgIH0KICAgICAgICBfZGVjbGFyZWRQYXJh\nbXMucHV0KGtleSwgcGFyYW0pOwogICAgfQoKICAgIC8qKgogICAgICogQWZm\naXJtcyBpZiB0aGUgZ2l2ZW4gcGFyYW1ldGVyIGlzIGJvdW5kIHRvIGEgdmFs\ndWUgZm9yIHRoaXMgcXVlcnkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzQm91bmQoUGFyYW1ldGVyPD8+IHBhcmFtKSB7CiAgICAgICAgcmV0dXJu\nIF9ib3VuZFBhcmFtcyAhPSBudWxsICYmIF9ib3VuZFBhcmFtcy5jb250YWlu\nc0tleShwYXJhbSk7CiAgICB9CiAgICAKICAgIHZvaWQgYXNzZXJ0Qm91bmQo\nUGFyYW1ldGVyPD8+IHBhcmFtKSB7CiAgICAgICAgaWYgKCFpc0JvdW5kKHBh\ncmFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1ub3QtYm91bmQiLCBwYXJhbSwgZ2V0\nUXVlcnlTdHJpbmcoKSwgCiAgICAgICAgICAgICAgICAgICAgZ2V0Qm91bmRQ\nYXJhbWV0ZXJLZXlzKCkpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAg\nfQogICAgLyoqCiAgICAgKiBCaW5kcyB0aGUgZ2l2ZW4gdmFsdWUgdG8gdGhl\nIGdpdmVuIHBhcmFtZXRlci4KICAgICAqIFZhbGlkYXRlcyBpZiB0aGUgcGFy\nYW1ldGVyIGNhbiBhY2NlcHQgdGhlIHZhbHVlIGJ5IGl0cyB0eXBlLgogICAg\nICovCiAgICB2b2lkIGJpbmRWYWx1ZShQYXJhbWV0ZXI8Pz4gcGFyYW0sIE9i\namVjdCB2YWx1ZSkgewogICAgICAgIGFzc2VydFZhbHVlQXNzaWduYWJsZShw\nYXJhbSwgdmFsdWUpOwogICAgICAgIGlmIChfYm91bmRQYXJhbXMgPT0gbnVs\nbCkKICAgICAgICAgICAgX2JvdW5kUGFyYW1zID0gbmV3IEhhc2hNYXA8UGFy\nYW1ldGVyPD8+LCBPYmplY3Q+KCk7CiAgICAgICAgX2JvdW5kUGFyYW1zLnB1\ndChwYXJhbSwgdmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVl\ncnk8WD4gc2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lLCBDYWxlbmRhciB2YWx1\nZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICByZXR1cm4gc2V0UGFy\nYW1ldGVyKG5hbWUsIGNvbnZlcnRUZW1wb3JhbFR5cGUodmFsdWUsIHR5cGUp\nKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFt\nZXRlcihTdHJpbmcgbmFtZSwgRGF0ZSB2YWx1ZSwgVGVtcG9yYWxUeXBlIHR5\ncGUpIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVyKG5hbWUsIGNvbnZl\ncnRUZW1wb3JhbFR5cGUodmFsdWUsIHR5cGUpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldHMgdGhlIHBhcmFtZXRlciBvZiB0aGUgZ2l2ZW4gbmFtZSB0\nbyB0aGUgZ2l2ZW4gdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBB\nUXVlcnk8WD4gc2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lLCBPYmplY3QgdmFs\ndWUpIHsKICAgICAgICBfcXVlcnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9l\nbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIG5hdGl2ZSBxdWVy\naWVzIGNhbiBub3QgaGF2ZSBuYW1lZCBwYXJhbWV0ZXJzCiAgICAgICAgICAg\nIGlmIChpc05hdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYW1lZC1w\nYXJhbXMiLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLCBnZXRRdWVy\neVN0cmluZygpKS50b1N0cmluZygpKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGJpbmRWYWx1ZShnZXRQYXJhbWV0ZXIobmFtZSks\nIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgX3F1ZXJ5LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lk\nIGFzc2VydFZhbHVlQXNzaWduYWJsZShQYXJhbWV0ZXI8Pz4gcGFyYW0sIE9i\namVjdCB2KSB7CiAgICAgICAgaWYgKHYgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAocGFyYW0uZ2V0UGFyYW1ldGVyVHlwZSgpLmlzUHJpbWl0aXZlKCkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1udWxsLXByaW1pdGl2ZSIsIHBhcmFt\nKS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIGlmICghRmlsdGVycy5jYW5Db252ZXJ0KHYuZ2V0Q2xhc3Mo\nKSwgcGFyYW0uZ2V0UGFyYW1ldGVyVHlwZSgpLCB0cnVlKSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJwYXJhbS10eXBlLW1pc21hdGNoIiwgbmV3IE9iamVjdFtdewogICAg\nICAgICAgICAgICAgcGFyYW0sIGdldFF1ZXJ5U3RyaW5nKCksIHYsIHYuZ2V0\nQ2xhc3MoKS5nZXROYW1lKCksIHBhcmFtLmdldFBhcmFtZXRlclR5cGUoKS5n\nZXROYW1lKCl9KS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLy8gPT09PT09PT09PT09PT09PT09IEVuZCBvZiBQYXJhbWV0ZXIg\nUHJvY2Vzc2luZyByb3V0aW5lcyA9PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PQp9Cg==\n","encoding":"base64"}

