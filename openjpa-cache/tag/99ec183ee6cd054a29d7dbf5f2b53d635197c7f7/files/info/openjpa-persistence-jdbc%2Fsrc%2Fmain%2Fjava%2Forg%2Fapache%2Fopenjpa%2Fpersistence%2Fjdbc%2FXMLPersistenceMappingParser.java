{"sha":"40b0b53e0680d2dafb34dae867404290cefc4fb9","node_id":"MDQ6QmxvYjIwNjM2NDo0MGIwYjUzZTA2ODBkMmRhZmIzNGRhZTg2NzQwNDI5MGNlZmM0ZmI5","size":51288,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/40b0b53e0680d2dafb34dae867404290cefc4fb9","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0IGph\ndmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuRW51bVNl\ndDsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGls\nLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGls\nLlNldDsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5EaXNjcmltaW5hdG9y\nVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudW1UeXBlOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuSW5oZXJpdGFuY2VUeXBlOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWxUeXBlOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZpZXIuREJJZGVu\ndGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRp\nZmllci5RdWFsaWZpZWREQklkZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nSW5mbzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRv\nck1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkZpZWxkTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLk1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuUXVlcnlSZXN1bHRN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5T\nZXF1ZW5jZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLlF1ZXJ5UmVzdWx0TWFwcGluZy5QQ1Jlc3VsdDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVudW1WYWx1ZUhh\nbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5GbGF0Q2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZ1bGxDbGFzc1N0cmF0ZWd5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUNs\nYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5WZXJ0aWNhbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJhY2tlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5BY2Nlc3NDb2RlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuWE1MUGVyc2lzdGVuY2VN\nZXRhRGF0YVBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLnhtbC5zYXgu\nQXR0cmlidXRlczsKaW1wb3J0IG9yZy54bWwuc2F4LkxvY2F0b3I7CmltcG9y\ndCBvcmcueG1sLnNheC5TQVhFeGNlcHRpb247CgppbXBvcnQgc3RhdGljIG9y\nZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5qZGJjLk1hcHBpbmdUYWcu\nKjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwovKioKICogQ3VzdG9tIFNB\nWCBwYXJzZXIgdXNlZCBieSB0aGUgc3lzdGVtIHRvIHBhcnNlIHBlcnNpc3Rl\nbmNlIG1hcHBpbmcgZmlsZXMuCiAqCiAqIEBhdXRob3IgU3RldmUgS2ltCiAq\nIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBYTUxQZXJzaXN0ZW5jZU1h\ncHBpbmdQYXJzZXIKICAgIGV4dGVuZHMgWE1MUGVyc2lzdGVuY2VNZXRhRGF0\nYVBhcnNlciB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPFN0cmlu\nZywgTWFwcGluZ1RhZz4gX2VsZW1zID0KICAgICAgICBuZXcgSGFzaE1hcDxT\ndHJpbmcsIE1hcHBpbmdUYWc+KCk7CgogICAgc3RhdGljIHsKICAgICAgICBf\nZWxlbXMucHV0KCJhc3NvY2lhdGlvbi1vdmVycmlkZSIsIEFTU09DX09WRVJS\nSURFKTsKICAgICAgICBfZWxlbXMucHV0KCJhdHRyaWJ1dGUtb3ZlcnJpZGUi\nLCBBVFRSX09WRVJSSURFKTsKICAgICAgICBfZWxlbXMucHV0KCJjb2xsZWN0\naW9uLXRhYmxlIiwgQ09MTEVDVElPTl9UQUJMRSk7CiAgICAgICAgX2VsZW1z\nLnB1dCgiY29sdW1uIiwgQ09MKTsKICAgICAgICBfZWxlbXMucHV0KCJjb2x1\nbW4tbmFtZSIsIENPTFVNTl9OQU1FKTsKICAgICAgICBfZWxlbXMucHV0KCJj\nb2x1bW4tcmVzdWx0IiwgQ09MVU1OX1JFU1VMVCk7CiAgICAgICAgX2VsZW1z\nLnB1dCgiZGVsaW1pdGVkLWlkZW50aWZpZXJzIiwgREVMSU1JVEVEX0lEUyk7\nCiAgICAgICAgX2VsZW1zLnB1dCgiZGlzY3JpbWluYXRvci1jb2x1bW4iLCBE\nSVNDUklNX0NPTCk7CiAgICAgICAgX2VsZW1zLnB1dCgiZGlzY3JpbWluYXRv\nci12YWx1ZSIsIERJU0NSSU1fVkFMKTsKICAgICAgICBfZWxlbXMucHV0KCJl\nbnRpdHktcmVzdWx0IiwgRU5USVRZX1JFU1VMVCk7CiAgICAgICAgX2VsZW1z\nLnB1dCgiZW51bWVyYXRlZCIsIEVOVU1FUkFURUQpOwogICAgICAgIF9lbGVt\ncy5wdXQoImZpZWxkLXJlc3VsdCIsIEZJRUxEX1JFU1VMVCk7CiAgICAgICAg\nX2VsZW1zLnB1dCgiaW5oZXJpdGFuY2UiLCBJTkhFUklUQU5DRSk7CiAgICAg\nICAgX2VsZW1zLnB1dCgiam9pbi1jb2x1bW4iLCBKT0lOX0NPTCk7CiAgICAg\nICAgX2VsZW1zLnB1dCgiaW52ZXJzZS1qb2luLWNvbHVtbiIsIENPTCk7CiAg\nICAgICAgX2VsZW1zLnB1dCgiam9pbi10YWJsZSIsIEpPSU5fVEFCTEUpOwog\nICAgICAgIF9lbGVtcy5wdXQoIm1hcC1rZXktZW51bWVyYXRlZCIsIE1BUF9L\nRVlfRU5VTUVSQVRFRCk7CiAgICAgICAgX2VsZW1zLnB1dCgibWFwLWtleS1j\nb2x1bW4iLCBNQVBfS0VZX0NPTCk7CiAgICAgICAgX2VsZW1zLnB1dCgibWFw\nLWtleS1qb2luLWNvbHVtbiIsIE1BUF9LRVlfSk9JTl9DT0wpOwogICAgICAg\nIF9lbGVtcy5wdXQoIm1hcC1rZXktdGVtcG9yYWwiLCBNQVBfS0VZX1RFTVBP\nUkFMKTsKICAgICAgICBfZWxlbXMucHV0KCJuYW1lIiwgTkFNRSk7CiAgICAg\nICAgX2VsZW1zLnB1dCgib3JkZXItY29sdW1uIiwgT1JERVJfQ09MVU1OKTsK\nICAgICAgICBfZWxlbXMucHV0KCJwcmltYXJ5LWtleS1qb2luLWNvbHVtbiIs\nIFBLX0pPSU5fQ09MKTsKICAgICAgICBfZWxlbXMucHV0KCJzZWNvbmRhcnkt\ndGFibGUiLCBTRUNPTkRBUllfVEFCTEUpOwogICAgICAgIF9lbGVtcy5wdXQo\nInNxbC1yZXN1bHQtc2V0LW1hcHBpbmciLCBTUUxfUkVTVUxUX1NFVF9NQVBQ\nSU5HKTsKICAgICAgICBfZWxlbXMucHV0KCJ0YWJsZSIsIFRBQkxFKTsKICAg\nICAgICBfZWxlbXMucHV0KCJ0YWJsZS1nZW5lcmF0b3IiLCBUQUJMRV9HRU4p\nOwogICAgICAgIF9lbGVtcy5wdXQoInRlbXBvcmFsIiwgVEVNUE9SQUwpOwog\nICAgICAgIF9lbGVtcy5wdXQoInVuaXF1ZS1jb25zdHJhaW50IiwgVU5JUVVF\nKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFhNTFBlcnNp\nc3RlbmNlTWFwcGluZ1BhcnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBTdHJp\nbmcgX292ZXJyaWRlID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9zY2hl\nbWEgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX2NvbFRhYmxlID0gbnVs\nbDsKICAgIHByaXZhdGUgU3RyaW5nIF9zZWNvbmRhcnlUYWJsZSA9IG51bGw7\nCiAgICBwcml2YXRlIExpc3Q8Q29sdW1uPiBfY29scyA9IG51bGw7CiAgICBw\ncml2YXRlIExpc3Q8Q29sdW1uPiBfam9pbkNvbHMgPSBudWxsOwogICAgcHJp\ndmF0ZSBMaXN0PENvbHVtbj4gX3N1cEpvaW5Db2xzID0gbnVsbDsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfbG9iID0gZmFsc2U7CiAgICBwcml2YXRlIFRlbXBv\ncmFsVHlwZSBfdGVtcG9yYWwgPSBudWxsOwogICAgcHJpdmF0ZSBFbnVtU2V0\nPFVuaXF1ZUZsYWc+IF91bmlxdWUgPSBFbnVtU2V0Lm5vbmVPZihVbmlxdWVG\nbGFnLmNsYXNzKTsKICAgIHByaXZhdGUgRGlzY3JpbWluYXRvclR5cGUgX2Rp\nc2NUeXBlOwogICAgcHJpdmF0ZSBDb2x1bW4gX2Rpc2NDb2w7CiAgICBwcml2\nYXRlIGludCBfcmVzdWx0SWR4ID0gMDsKICAgIHByaXZhdGUgZmluYWwgREJE\naWN0aW9uYXJ5IF9kaWN0OwoKICAgIHByaXZhdGUgZmluYWwgTWFwPENsYXNz\nPD8+LCBBcnJheUxpc3Q8RGVmZXJyZWRFbWJlZGRhYmxlT3ZlcnJpZGVzPj4g\nCiAgICAgICAgX2RlZmVycmVkTWFwcGluZ3MgPSBuZXcgSGFzaE1hcDxDbGFz\nczw/PiwgCiAgICAgICAgICAgICBBcnJheUxpc3Q8RGVmZXJyZWRFbWJlZGRh\nYmxlT3ZlcnJpZGVzPj4oKTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9y\nOyBzdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFhN\nTFBlcnNpc3RlbmNlTWFwcGluZ1BhcnNlcihKREJDQ29uZmlndXJhdGlvbiBj\nb25mKSB7CiAgICAgICAgc3VwZXIoY29uZik7CiAgICAgICAgX2RpY3QgPSBj\nb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNldCgpIHsKICAgICAgICBz\ndXBlci5yZXNldCgpOwogICAgICAgIGNsZWFyQ29sdW1uSW5mbygpOwogICAg\nICAgIGNsZWFyQ2xhc3NJbmZvKCk7CiAgICAgICAgY2xlYXJTZWNvbmRhcnlU\nYWJsZUluZm8oKTsKICAgICAgICBfb3ZlcnJpZGUgPSBudWxsOwogICAgICAg\nIF9zY2hlbWEgPSBudWxsOwogICAgICAgIF9yZXN1bHRJZHggPSAwOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIE9iamVjdCBzdGFydFN5\nc3RlbU1hcHBpbmdFbGVtZW50KFN0cmluZyBuYW1lLCBBdHRyaWJ1dGVzIGF0\ndHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIE1h\ncHBpbmdUYWcgdGFnID0gX2VsZW1zLmdldChuYW1lKTsKICAgICAgICBpZiAo\ndGFnID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKCJzY2hlbWEiLmVxdWFs\ncyhuYW1lKSkKICAgICAgICAgICAgICAgIHJldHVybiBuYW1lOwogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4g\ncmV0OwogICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2Ug\nVEFCTEVfR0VOOgogICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRUYWJsZUdl\nbmVyYXRvcihhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBTUUxfUkVTVUxUX1NFVF9NQVBQSU5HOgogICAgICAgICAg\nICAgICAgcmV0ID0gc3RhcnRTUUxSZXN1bHRTZXRNYXBwaW5nKGF0dHJzKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEVOVElU\nWV9SRVNVTFQ6CiAgICAgICAgICAgICAgICByZXQgPSBzdGFydEVudGl0eVJl\nc3VsdChhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBGSUVMRF9SRVNVTFQ6CiAgICAgICAgICAgICAgICByZXQgPSBz\ndGFydEZpZWxkUmVzdWx0KGF0dHJzKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIENPTFVNTl9SRVNVTFQ6CiAgICAgICAgICAg\nICAgICByZXQgPSBzdGFydENvbHVtblJlc3VsdChhdHRycyk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIHJldCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nKHJldCkgPyB0YWcgOiBudWxsOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHJvdGVjdGVkIHZvaWQgZW5kU3lzdGVtTWFwcGluZ0VsZW1lbnQoU3RyaW5n\nIG5hbWUpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAg\nTWFwcGluZ1RhZyB0YWcgPSBfZWxlbXMuZ2V0KG5hbWUpOwogICAgICAgIGlm\nICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoInNjaGVtYSIuZXF1\nYWxzKG5hbWUpKQogICAgICAgICAgICAgICAgX3NjaGVtYSA9IGN1cnJlbnRU\nZXh0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgU1FMX1JFU1VMVF9T\nRVRfTUFQUElORzoKICAgICAgICAgICAgICAgIGVuZFNRTFJlc3VsdFNldE1h\ncHBpbmcoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEVOVElUWV9SRVNVTFQ6CiAgICAgICAgICAgICAgICBlbmRFbnRpdHlS\nZXN1bHQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBPYmplY3Qgc3RhcnRD\nbGFzc01hcHBpbmdFbGVtZW50KFN0cmluZyBuYW1lLCBBdHRyaWJ1dGVzIGF0\ndHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIE1h\ncHBpbmdUYWcgdGFnID0gX2VsZW1zLmdldChuYW1lKTsKICAgICAgICBpZiAo\ndGFnID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBib29sZWFuIHJldDsKICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAg\nICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRU\nYWJsZShhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBTRUNPTkRBUllfVEFCTEU6CiAgICAgICAgICAgICAgICByZXQg\nPSBzdGFydFNlY29uZGFyeVRhYmxlKGF0dHJzKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIERJU0NSSU1fQ09MOgogICAgICAg\nICAgICAgICAgcGFyc2VEaXNjcmltaW5hdG9yQ29sdW1uKGF0dHJzKTsKICAg\nICAgICAgICAgICAgIF9kaXNjQ29sID0gcGFyc2VDb2x1bW4oYXR0cnMpOwog\nICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIERJU0NSSU1fVkFMOgogICAgICAgICAg\nICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIElOSEVSSVRBTkNFOgogICAgICAgICAgICAgICAgcmV0\nID0gc3RhcnRJbmhlcml0YW5jZShhdHRycyk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBBU1NPQ19PVkVSUklERToKICAgICAg\nICAgICAgY2FzZSBBVFRSX09WRVJSSURFOgogICAgICAgICAgICAgICAgcmV0\nID0gc3RhcnRBdHRyaWJ1dGVPdmVycmlkZShhdHRycyk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQS19KT0lOX0NPTDoKICAg\nICAgICAgICAgICAgIHJldCA9IHN0YXJ0UHJpbWFyeUtleUpvaW5Db2x1bW4o\nYXR0cnMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgQ09MOgogICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRDb2x1bW4oYXR0\ncnMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSk9JTl9DT0w6CiAgICAgICAgICAgICAgICByZXQgPSBzdGFydEpvaW5Db2x1\nbW4oYXR0cnMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSk9JTl9UQUJMRToKICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0\nSm9pblRhYmxlKGF0dHJzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAgIHJldCA9\nIHN0YXJ0VGFibGVHZW5lcmF0b3IoYXR0cnMpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVU5JUVVFOgogICAgICAgICAgICAg\nICAgcmV0ID0gc3RhcnRVbmlxdWVDb25zdHJhaW50KGF0dHJzKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE5BTUU6CiAgICAg\nICAgICAgICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgVEVNUE9SQUw6CiAgICAgICAgICAgIGNhc2Ug\nRU5VTUVSQVRFRDoKICAgICAgICAgICAgY2FzZSBNQVBfS0VZX0VOVU1FUkFU\nRUQ6CiAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9URU1QT1JBTDoKICAgICAg\nICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBTUUxfUkVTVUxUX1NFVF9NQVBQSU5HOgogICAg\nICAgICAgICAgICAgcmV0ID0gc3RhcnRTUUxSZXN1bHRTZXRNYXBwaW5nKGF0\ndHJzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEVOVElUWV9SRVNVTFQ6CiAgICAgICAgICAgICAgICByZXQgPSBzdGFydEVu\ndGl0eVJlc3VsdChhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBGSUVMRF9SRVNVTFQ6CiAgICAgICAgICAgICAgICBy\nZXQgPSBzdGFydEZpZWxkUmVzdWx0KGF0dHJzKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIENPTFVNTl9SRVNVTFQ6CiAgICAg\nICAgICAgICAgICByZXQgPSBzdGFydENvbHVtblJlc3VsdChhdHRycyk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDT0xVTU5f\nTkFNRToKICAgICAgICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDT0xMRUNUSU9OX1RBQkxF\nOgogICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRDb2xsZWN0aW9uVGFibGUo\nYXR0cnMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgTUFQX0tFWV9DT0w6CiAgICAgICAgICAgICAgICByZXQgPSBzdGFydE1h\ncEtleUNvbHVtbihhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBNQVBfS0VZX0pPSU5fQ09MOgogICAgICAgICAgICAg\nICAgcmV0ID0gc3RhcnRNYXBLZXlKb2luQ29sdW1uKGF0dHJzKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgcmV0ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiAocmV0KSA/IHRhZyA6IG51bGw7CiAgICB9CgogICAgcHJpdmF0ZSBib29s\nZWFuIGVuZE5hbWUoKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSB0aGlzLmN1\ncnJlbnRUZXh0KCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzTm90RW1w\ndHkobmFtZSkpIHsKICAgICAgICAgICAgT2JqZWN0IGN1cnJlbnQgPSBjdXJy\nZW50RWxlbWVudCgpOwogICAgICAgICAgICBpZiAoY3VycmVudCBpbnN0YW5j\nZW9mIFVuaXF1ZSkgewogICAgICAgICAgICAgICAgVW5pcXVlIHVucSA9IChV\nbmlxdWUpY3VycmVudDsKICAgICAgICAgICAgICAgIHVucS5zZXRJZGVudGlm\naWVyKERCSWRlbnRpZmllci5uZXdDb25zdHJhaW50KG5hbWUsIGRlbGltaXQo\nKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICAgICAKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCB2b2lkIGVuZENsYXNzTWFwcGluZ0VsZW1lbnQoU3RyaW5nIG5h\nbWUpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgTWFw\ncGluZ1RhZyB0YWcgPSBfZWxlbXMuZ2V0KG5hbWUpOwogICAgICAgIGlmICh0\nYWcgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBzd2l0\nY2ggKHRhZykgewogICAgICAgICAgICBjYXNlIFNFQ09OREFSWV9UQUJMRToK\nICAgICAgICAgICAgICAgIGVuZFNlY29uZGFyeVRhYmxlKCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBESVNDUklNX1ZBTDoK\nICAgICAgICAgICAgICAgIGVuZERpc2NyaW1pbmF0b3JWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQVNTT0NfT1ZF\nUlJJREU6ICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjYXNlIEFUVFJf\nT1ZFUlJJREU6CiAgICAgICAgICAgICAgICBlbmRBdHRyaWJ1dGVPdmVycmlk\nZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSk9JTl9UQUJMRToKICAgICAgICAgICAgICAgIGVuZEpvaW5UYWJsZSgpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVEVNUE9S\nQUw6CiAgICAgICAgICAgICAgICBlbmRUZW1wb3JhbCgpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9URU1QT1JB\nTDoKICAgICAgICAgICAgICAgIGVuZE1hcEtleVRlbXBvcmFsKCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBFTlVNRVJBVEVE\nOgogICAgICAgICAgICAgICAgZW5kRW51bWVyYXRlZCgpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9FTlVNRVJB\nVEVEOgogICAgICAgICAgICAgICAgZW5kTWFwS2V5RW51bWVyYXRlZCgpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU1FMX1JF\nU1VMVF9TRVRfTUFQUElORzoKICAgICAgICAgICAgICAgIGVuZFNRTFJlc3Vs\ndFNldE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEVOVElUWV9SRVNVTFQ6CiAgICAgICAgICAgICAgICBlbmRF\nbnRpdHlSZXN1bHQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIFVOSVFVRToKICAgICAgICAgICAgICAgIGVuZFVuaXF1ZUNv\nbnN0cmFpbnQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIENPTFVNTl9OQU1FOgogICAgICAgICAgICAgICAgZW5kQ29sdW1u\nTmFtZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgVEFCTEVfR0VOOgogICAgICAgICAgICAJZW5kVGFibGVHZW5lcmF0b3Io\nKTsKICAgICAgICAgICAgCWJyZWFrOwogICAgICAgICAgICBjYXNlIE5BTUU6\nCiAgICAgICAgICAgICAgICBlbmROYW1lKCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90\nZWN0ZWQgdm9pZCBzdGFydENsYXNzTWFwcGluZyhDbGFzc01ldGFEYXRhIG1l\ndGEsIGJvb2xlYW4gbWFwcGVkU3VwZXIsCiAgICAgICAgQXR0cmlidXRlcyBh\ndHRycykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAobWFwcGVkU3VwZXIpCiAgICAgICAgICAgICgoQ2xhc3NNYXBwaW5nKSBt\nZXRhKS5nZXRNYXBwaW5nSW5mbygpLnNldFN0cmF0ZWd5CiAgICAgICAgICAg\nICAgICAoTm9uZUNsYXNzU3RyYXRlZ3kuQUxJQVMpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgZW5kQ2xhc3NNYXBwaW5nKENs\nYXNzTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9u\nIHsKICAgICAgICBDbGFzc01hcHBpbmcgY20gPSAoQ2xhc3NNYXBwaW5nKSBt\nZXRhOwogICAgICAgIGlmIChfc2NoZW1hICE9IG51bGwpCiAgICAgICAgICAg\nIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0U2NoZW1hSWRlbnRpZmllcihEQklk\nZW50aWZpZXIubmV3U2NoZW1hKF9zY2hlbWEsIGRlbGltaXQoKSkpOwoKICAg\nICAgICBpZiAoX3N1cEpvaW5Db2xzICE9IG51bGwpCiAgICAgICAgICAgIGNt\nLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucyhfc3VwSm9pbkNvbHMpOwoK\nICAgICAgICBpZiAoX2Rpc2NDb2wgIT0gbnVsbCkgewogICAgICAgICAgICBE\naXNjcmltaW5hdG9yTWFwcGluZ0luZm8gZGluZm8gPSBjbS5nZXREaXNjcmlt\naW5hdG9yKCkKICAgICAgICAgICAgICAgICAgICAuZ2V0TWFwcGluZ0luZm8o\nKTsKICAgICAgICAgICAgc3dpdGNoIChfZGlzY1R5cGUpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgQ0hBUjoKICAgICAgICAgICAgICAgICAgICBfZGlzY0Nv\nbC5zZXRKYXZhVHlwZShKYXZhVHlwZXMuQ0hBUik7CiAgICAgICAgICAgICAg\nICAgICAgY20uZ2V0RGlzY3JpbWluYXRvcigpLnNldEphdmFUeXBlKEphdmFU\neXBlcy5DSEFSKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSU5URUdFUjoKICAgICAgICAgICAgICAgICAgICBf\nZGlzY0NvbC5zZXRKYXZhVHlwZShKYXZhVHlwZXMuSU5UKTsKICAgICAgICAg\nICAgICAgICAgICBjbS5nZXREaXNjcmltaW5hdG9yKCkuc2V0SmF2YVR5cGUo\nSmF2YVR5cGVzLklOVCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIF9k\naXNjQ29sLnNldEphdmFUeXBlKEphdmFUeXBlcy5TVFJJTkcpOwogICAgICAg\nICAgICAgICAgICAgIGNtLmdldERpc2NyaW1pbmF0b3IoKS5zZXRKYXZhVHlw\nZShKYXZhVHlwZXMuU1RSSU5HKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgICAgICBkaW5mby5zZXRDb2x1bW5z\nKEFycmF5cy5hc0xpc3QobmV3IENvbHVtbltdeyBfZGlzY0NvbCB9KSk7CiAg\nICAgICAgfQogICAgICAgIGNsZWFyQ2xhc3NJbmZvKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgY2xhc3MgbWFwcGluZyBpbmZvLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgY2xlYXJDbGFzc0luZm8oKSB7CiAg\nICAgICAgX3N1cEpvaW5Db2xzID0gbnVsbDsKICAgICAgICBfZGlzY0NvbCA9\nIG51bGw7CiAgICAgICAgX2Rpc2NUeXBlID0gbnVsbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFN0YXJ0IHRyYWNraW5nIHNlY29uZGFyeSB0YWJsZSBpbmZv\ncm1hdGlvbiBhbmQgY29sdW1ucwogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gc3RhcnRTZWNvbmRhcnlUYWJsZShBdHRyaWJ1dGVzIGF0dHJzKQogICAg\nICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIF9zZWNvbmRhcnlU\nYWJsZSA9IHRvVGFibGVJZGVudGlmaWVyKGF0dHJzLmdldFZhbHVlKCJzY2hl\nbWEiKSwKICAgICAgICAgICAgYXR0cnMuZ2V0VmFsdWUoIm5hbWUiKSkuZ2V0\nTmFtZSgpOwogICAgICAgICgoQ2xhc3NNYXBwaW5nKWN1cnJlbnRFbGVtZW50\nKCkpLmdldE1hcHBpbmdJbmZvKCkKICAgICAgICAJLmFkZFNlY29uZGFyeVRh\nYmxlKERCSWRlbnRpZmllci5uZXdUYWJsZShfc2Vjb25kYXJ5VGFibGUpKTsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgc2Vjb25kYXJ5IHRhYmxlIGluZm9ybWF0aW9uIGJhY2sgdG8gdGhl\nIG93bmluZyBjbGFzcyBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZW5kU2Vjb25kYXJ5VGFibGUoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIGNtID0gKENsYXNzTWFwcGluZykgY3VycmVudEVsZW1lbnQoKTsKICAgICAg\nICBDbGFzc01hcHBpbmdJbmZvIGluZm8gPSBjbS5nZXRNYXBwaW5nSW5mbygp\nOwogICAgICAgIGluZm8uc2V0U2Vjb25kYXJ5VGFibGVKb2luQ29sdW1ucyhE\nQklkZW50aWZpZXIubmV3VGFibGUoX3NlY29uZGFyeVRhYmxlLCBkZWxpbWl0\nKCkpLCBfam9pbkNvbHMpOwogICAgICAgIGNsZWFyU2Vjb25kYXJ5VGFibGVJ\nbmZvKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgc2Vj\nb25kYXJ5IHRhYmxlIGluZm8uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBj\nbGVhclNlY29uZGFyeVRhYmxlSW5mbygpIHsKICAgICAgICBfam9pbkNvbHMg\nPSBudWxsOwogICAgICAgIF9zZWNvbmRhcnlUYWJsZSA9IG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSB0YWJsZS1nZW5lcmF0b3IuCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzdGFydFRhYmxlR2VuZXJhdG9yKEF0\ndHJpYnV0ZXMgYXR0cnMpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGF0dHJz\nLmdldFZhbHVlKCJuYW1lIik7CiAgICAgICAgTG9nIGxvZyA9IGdldExvZygp\nOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1nZW4iLCBuYW1lKSk7CiAg\nICAgICAgaWYgKGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRTZXF1ZW5jZU1l\ndGFEYXRhKG5hbWUpICE9IG51bGwKICAgICAgICAgICAgJiYgbG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoIm92\nZXJyaWRlLWdlbiIsIG5hbWUpKTsKCiAgICAgICAgU2VxdWVuY2VNYXBwaW5n\nIHNlcSA9IChTZXF1ZW5jZU1hcHBpbmcpIGdldFJlcG9zaXRvcnkoKS4KICAg\nICAgICAgICAgYWRkU2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAgICBz\nZXEuc2V0U2VxdWVuY2VQbHVnaW4oU2VxdWVuY2VNYXBwaW5nLklNUExfVkFM\nVUVfVEFCTEUpOwogICAgICAgIHNlcS5zZXRUYWJsZUlkZW50aWZpZXIodG9U\nYWJsZUlkZW50aWZpZXIoYXR0cnMuZ2V0VmFsdWUoInNjaGVtYSIpLAogICAg\nICAgICAgICBhdHRycy5nZXRWYWx1ZSgidGFibGUiKSkpOwogICAgICAgIHNl\ncS5zZXRQcmltYXJ5S2V5Q29sdW1uSWRlbnRpZmllcihEQklkZW50aWZpZXIu\nbmV3Q29sdW1uKGF0dHJzLmdldFZhbHVlKCJway1jb2x1bW4tbmFtZSIpLCBk\nZWxpbWl0KCkpKTsgCiAgICAgICAgc2VxLnNldFNlcXVlbmNlQ29sdW1uSWRl\nbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uKGF0dHJzLmdldFZhbHVl\nKCJ2YWx1ZS1jb2x1bW4tbmFtZSIpLCBkZWxpbWl0KCkpKTsgCiAgICAgICAg\nc2VxLnNldFByaW1hcnlLZXlWYWx1ZShhdHRycy5nZXRWYWx1ZSgicGstY29s\ndW1uLXZhbHVlIikpOwogICAgICAgIFN0cmluZyB2YWwgPSBhdHRycy5nZXRW\nYWx1ZSgiaW5pdGlhbC12YWx1ZSIpOwogICAgICAgIGlmICh2YWwgIT0gbnVs\nbCkKICAgICAgICAgICAgc2VxLnNldEluaXRpYWxWYWx1ZShJbnRlZ2VyLnBh\ncnNlSW50KHZhbCkpOwogICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJh\nbGxvY2F0aW9uLXNpemUiKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAg\nICAgICAgICAgIHNlcS5zZXRBbGxvY2F0ZShJbnRlZ2VyLnBhcnNlSW50KHZh\nbCkpOwoKICAgICAgICBPYmplY3QgY3VyID0gY3VycmVudEVsZW1lbnQoKTsK\nICAgICAgICBPYmplY3Qgc2NvcGUgPSAoY3VyIGluc3RhbmNlb2YgQ2xhc3NN\nZXRhRGF0YSkKICAgICAgICAgICAgPyAoKENsYXNzTWV0YURhdGEpIGN1ciku\nZ2V0RGVzY3JpYmVkVHlwZSgpIDogbnVsbDsKICAgICAgICBzZXEuc2V0U291\ncmNlKGdldFNvdXJjZUZpbGUoKSwgc2NvcGUsIFNvdXJjZVRyYWNrZXIuU1JD\nX1hNTCk7CiAgICAgICAgTG9jYXRvciBsb2NhdG9yID0gZ2V0TG9jYXRpb24o\nKS5nZXRMb2NhdG9yKCk7CiAgICAgICAgaWYgKGxvY2F0b3IgIT0gbnVsbCkg\newogICAgICAgICAgICBzZXEuc2V0TGluZU51bWJlcihOdW1iZXJzLnZhbHVl\nT2YobG9jYXRvci5nZXRMaW5lTnVtYmVyKCkpKTsKICAgICAgICAgICAgc2Vx\nLnNldENvbE51bWJlcihOdW1iZXJzLnZhbHVlT2YobG9jYXRvci5nZXRDb2x1\nbW5OdW1iZXIoKSkpOwogICAgICAgIH0KICAgICAgICBwdXNoRWxlbWVudChz\nZXEpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwcml2\nYXRlIHZvaWQgZW5kVGFibGVHZW5lcmF0b3IoKSB7CiAgICAJcG9wRWxlbWVu\ndCgpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgaW5oZXJpdGFuY2Uu\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzdGFydEluaGVyaXRhbmNl\nKEF0dHJpYnV0ZXMgYXR0cnMpIHsKICAgICAgICBTdHJpbmcgdmFsID0gYXR0\ncnMuZ2V0VmFsdWUoInN0cmF0ZWd5Iik7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgQ2xhc3NN\nYXBwaW5nIGNtID0gKENsYXNzTWFwcGluZykgY3VycmVudEVsZW1lbnQoKTsK\nICAgICAgICBDbGFzc01hcHBpbmdJbmZvIGluZm8gPSBjbS5nZXRNYXBwaW5n\nSW5mbygpOwogICAgICAgIHN3aXRjaCAoRW51bS52YWx1ZU9mKEluaGVyaXRh\nbmNlVHlwZS5jbGFzcywgdmFsKSkgewogICAgICAgICAgICBjYXNlIFNJTkdM\nRV9UQUJMRToKICAgICAgICAgICAgICAgIGluZm8uc2V0SGllcmFyY2h5U3Ry\nYXRlZ3koRmxhdENsYXNzU3RyYXRlZ3kuQUxJQVMpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSk9JTkVEOgogICAgICAgICAg\nICAgICAgaW5mby5zZXRIaWVyYXJjaHlTdHJhdGVneShWZXJ0aWNhbENsYXNz\nU3RyYXRlZ3kuQUxJQVMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgVEFCTEVfUEVSX0NMQVNTOgogICAgICAgICAgICAgICAg\naW5mby5zZXRIaWVyYXJjaHlTdHJhdGVneShGdWxsQ2xhc3NTdHJhdGVneS5B\nTElBUyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBk\naXNjcmltaW5hdG9yLXZhbHVlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nZW5kRGlzY3JpbWluYXRvclZhbHVlKCkgewogICAgICAgIFN0cmluZyB2YWwg\nPSBjdXJyZW50VGV4dCgpOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KHZhbCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NN\nYXBwaW5nIGNtID0gKENsYXNzTWFwcGluZykgY3VycmVudEVsZW1lbnQoKTsK\nICAgICAgICBjbS5nZXREaXNjcmltaW5hdG9yKCkuZ2V0TWFwcGluZ0luZm8o\nKS5zZXRWYWx1ZSh2YWwpOwoKICAgICAgICBpZiAoTW9kaWZpZXIuaXNBYnN0\ncmFjdChjbS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TW9kaWZpZXJzKCkpCiAg\nICAgICAgICAgICAgICAmJiBnZXRMb2coKS5pc0luZm9FbmFibGVkKCkpIHsK\nICAgICAgICAgICAgZ2V0TG9nKCkuaW5mbygKICAgICAgICAgICAgICAgICAg\nICBfbG9jLmdldCgiZGlzY3JpbWluYXRvci1vbi1hYnN0cmFjdC1jbGFzcyIs\nIGNtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmdldE5hbWUoKSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIHRlbXBvcmFsLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZW5kVGVtcG9yYWwoKSB7CiAgICAgICAgU3RyaW5nIHRlbXAgPSBjdXJy\nZW50VGV4dCgpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eSh0\nZW1wKSkKICAgICAgICAgICAgX3RlbXBvcmFsID0gRW51bS52YWx1ZU9mKFRl\nbXBvcmFsVHlwZS5jbGFzcywgdGVtcCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSB0ZW1wb3JhbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGVu\nZE1hcEtleVRlbXBvcmFsKCkgewogICAgICAgIFN0cmluZyB0ZW1wID0gY3Vy\ncmVudFRleHQoKTsKICAgICAgICBUZW1wb3JhbFR5cGUgX21hcEtleVRlbXBv\ncmFsID0gbnVsbDsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\ndGVtcCkpCiAgICAgICAgICAgIF9tYXBLZXlUZW1wb3JhbCA9IEVudW0udmFs\ndWVPZihUZW1wb3JhbFR5cGUuY2xhc3MsIHRlbXApOwogICAgICAgIEZpZWxk\nTWFwcGluZyBmbSA9IChGaWVsZE1hcHBpbmcpIGN1cnJlbnRFbGVtZW50KCk7\nCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBmbS5nZXRLZXlNYXBwaW5n\nKCkuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmIChj\nb2xzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBjb2xzID0gQXJyYXlzLmFz\nTGlzdChuZXcgQ29sdW1uW117IG5ldyBDb2x1bW4oKSB9KTsKICAgICAgICAg\nICAgZm0uZ2V0S2V5TWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVt\nbnMoY29scyk7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW4gY29sID0gKENv\nbHVtbikgY29scy5nZXQoMCk7CiAgICAgICAgc3dpdGNoIChfbWFwS2V5VGVt\ncG9yYWwpIHsKICAgICAgICAgICAgY2FzZSBEQVRFOgogICAgICAgICAgICAg\nICAgY29sLnNldFR5cGUoVHlwZXMuREFURSk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBUSU1FOgogICAgICAgICAgICAgICAg\nY29sLnNldFR5cGUoVHlwZXMuVElNRSk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBUSU1FU1RBTVA6CiAgICAgICAgICAgICAg\nICBjb2wuc2V0VHlwZShUeXBlcy5USU1FU1RBTVApOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgZW51bWVyYXRlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGVuZEVu\ndW1lcmF0ZWQoKSB7CiAgICAgICAgU3RyaW5nIHRleHQgPSBjdXJyZW50VGV4\ndCgpOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHRleHQpKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgRW51bVR5cGUgdHlwZSA9IEVu\ndW0udmFsdWVPZihFbnVtVHlwZS5jbGFzcywgdGV4dCk7CgogICAgICAgIEZp\nZWxkTWFwcGluZyBmbSA9IChGaWVsZE1hcHBpbmcpIGN1cnJlbnRFbGVtZW50\nKCk7CiAgICAgICAgU3RyaW5nIHN0cmF0ID0gRW51bVZhbHVlSGFuZGxlci5j\nbGFzcy5nZXROYW1lKCkgKyAiKFN0b3JlT3JkaW5hbD0iCiAgICAgICAgICAg\nICsgU3RyaW5nLnZhbHVlT2YodHlwZSA9PSBFbnVtVHlwZS5PUkRJTkFMKSAr\nICIpIjsKICAgICAgICBpZiAoZm0uaXNFbGVtZW50Q29sbGVjdGlvbigpKQog\nICAgICAgICAgICBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5m\nbygpLnNldFN0cmF0ZWd5KHN0cmF0KTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGZtLmdldFZhbHVlSW5mbygpLnNldFN0cmF0ZWd5KHN0cmF0KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIG1hcC1rZXktZW51bWVyYXRlZC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGVuZE1hcEtleUVudW1lcmF0ZWQo\nKSB7CiAgICAgICAgU3RyaW5nIHRleHQgPSBjdXJyZW50VGV4dCgpOwogICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHRleHQpKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgRW51bVR5cGUgdHlwZSA9IEVudW0udmFsdWVP\nZihFbnVtVHlwZS5jbGFzcywgdGV4dCk7CgogICAgICAgIEZpZWxkTWFwcGlu\nZyBmbSA9IChGaWVsZE1hcHBpbmcpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAg\nICAgU3RyaW5nIHN0cmF0ID0gRW51bVZhbHVlSGFuZGxlci5jbGFzcy5nZXRO\nYW1lKCkgKyAiKFN0b3JlT3JkaW5hbD0iCiAgICAgICAgICAgICsgU3RyaW5n\nLnZhbHVlT2YodHlwZSA9PSBFbnVtVHlwZS5PUkRJTkFMKSArICIpIjsKICAg\nICAgICBmbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0U3Ry\nYXRlZ3koc3RyYXQpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVj\ndGVkIGJvb2xlYW4gc3RhcnRMb2IoQXR0cmlidXRlcyBhdHRycykKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3VwZXIuc3Rh\ncnRMb2IoYXR0cnMpKSB7CiAgICAgICAgICAgIF9sb2IgPSB0cnVlOwogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRXh0ZW5kIHRvIGNsZWFy\nIGFubm90YXRpb24gbWFwcGluZyBpbmZvLgogICAgICovCiAgICBAT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCB2b2lkIHN0YXJ0RmllbGRNYXBwaW5nKEZpZWxk\nTWV0YURhdGEgZmllbGQsIEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhy\nb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc3RhcnRGaWVsZE1h\ncHBpbmcoZmllbGQsIGF0dHJzKTsKICAgICAgICBpZiAoZ2V0QW5ub3RhdGlv\nblBhcnNlcigpICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5n\nIGZtID0gKEZpZWxkTWFwcGluZykgZmllbGQ7CiAgICAgICAgICAgIGZtLmdl\ndE1hcHBpbmdJbmZvKCkuY2xlYXIoKTsKICAgICAgICAgICAgZm0uZ2V0VmFs\ndWVJbmZvKCkuY2xlYXIoKTsKICAgICAgICAgICAgZm0uZ2V0RWxlbWVudE1h\ncHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5jbGVhcigpOwogICAgICAgICAgICBm\nbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuY2xlYXIoKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHRlbmQgdG8gc2V0IHRo\nZSBjb2x1bW5zLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCB2b2lkIGVuZEZpZWxkTWFwcGluZyhGaWVsZE1ldGFEYXRhIGZpZWxkKQog\nICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIC8vIHNldHVw\nIGNvbHVtbnMgd2l0aCBjYWNoZWQgbG9iIGFuZCB0ZW1wb3JhbCBpbmZvCiAg\nICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZykgZmllbGQ7\nCiAgICAgICAgaWYgKF9sb2IgfHwgX3RlbXBvcmFsICE9IG51bGwpIHsKICAg\nICAgICAgICAgaW50IHR5cGVDb2RlID0gZm0uaXNFbGVtZW50Q29sbGVjdGlv\nbigpID8gZm0uZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZUNvZGUoKSA6\nIAogICAgICAgICAgICAgICAgZm0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpOwog\nICAgICAgICAgICBDbGFzczw/PiB0eXBlID0gZm0uaXNFbGVtZW50Q29sbGVj\ndGlvbigpID8gZm0uZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpIDog\nZm0uZ2V0RGVjbGFyZWRUeXBlKCk7ICAKICAgICAgICAgICAgaWYgKF9jb2xz\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIF9jb2xzID0gbmV3IEFycmF5\nTGlzdDxDb2x1bW4+KDEpOwogICAgICAgICAgICAgICAgX2NvbHMuYWRkKG5l\ndyBDb2x1bW4oKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChD\nb2x1bW4gY29sIDogX2NvbHMpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9i\nICYmICh0eXBlQ29kZSA9PSBKYXZhVHlwZXMuU1RSSU5HCiAgICAgICAgICAg\nICAgICAgICAgfHwgdHlwZSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAg\nICAgICAgICB8fCB0eXBlID09IENoYXJhY3RlcltdLmNsYXNzKSkgewogICAg\nICAgICAgICAgICAgICAgIGNvbC5zZXRTaXplKC0xKTsKICAgICAgICAgICAg\nICAgICAgICBjb2wuc2V0VHlwZShUeXBlcy5DTE9CKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAoX2xvYikKICAgICAgICAgICAgICAgICAgICBjb2wu\nc2V0VHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAgICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX3RlbXBvcmFsKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNhc2UgREFURToKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVzLkRBVEUpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNhc2UgVElNRToKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbC5zZXRUeXBlKFR5cGVzLlRJTUUpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2Ug\nVElNRVNUQU1QOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLnNl\ndFR5cGUoVHlwZXMuVElNRVNUQU1QKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKF9jb2xzICE9IG51bGwpIHsKICAgICAgICAgICAgc3dpdGNoIChmbS5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIENsYXNzPD8+IHR5\ncGUgPSBmbS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAodHlwZSA9PSBieXRlW10uY2xhc3MgfHwgdHlwZSA9PSBCeXRlW10u\nY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAgfHwgdHlwZSA9PSBjaGFy\nW10uY2xhc3MgfHwgdHlwZSA9PSBDaGFyYWN0ZXJbXS5jbGFzcyApIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0Q29s\ndW1ucyhfY29scyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBl\nbHNlIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQ\nOgogICAgICAgICAgICAgICAgICAgIGZtLmdldEVsZW1lbnRNYXBwaW5nKCku\nZ2V0VmFsdWVJbmZvKCkuc2V0Q29sdW1ucyhfY29scyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMo\nX2NvbHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfY29sVGFi\nbGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZv\nKCkuc2V0VGFibGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdUYWJsZShf\nY29sVGFibGUsIGRlbGltaXQoKSkpOwogICAgICAgICAgICBzZXRVbmlxdWUo\nZm0pOwogICAgICAgIH0KICAgICAgICBjbGVhckNvbHVtbkluZm8oKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB1bmlxdWUgZm9yIGZpZWxkLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgc2V0VW5pcXVlKEZpZWxkTWFwcGluZyBm\nbSkgewogICAgICAgIHNldFVuaXF1ZShmbSwgX3VuaXF1ZSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIHNldFVuaXF1ZShGaWVsZE1hcHBpbmcgZm0sIEVu\ndW1TZXQ8VW5pcXVlRmxhZz4gdW5pcXVlKSB7CiAgICAgICAgaWYgKHVuaXF1\nZS5zaXplKCkgPT0gMikgLy8gaS5lLiBUUlVFICYgRkFMU0UKICAgICAgICAg\nICAgZ2V0TG9nKCkud2FybihfbG9jLmdldCgiaW5jb25zaXN0LWNvbC1hdHRy\ncyIsIGZtKSk7CiAgICAgICAgZWxzZSBpZiAodW5pcXVlLmNvbnRhaW5zKFVu\naXF1ZUZsYWcuVFJVRSkpCiAgICAgICAgICAgIGZtLmdldFZhbHVlSW5mbygp\nLnNldFVuaXF1ZShuZXcgVW5pcXVlKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2xlYXIgZmllbGQgbGV2ZWwgY29sdW1uIGluZm9ybWF0aW9uLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgY2xlYXJDb2x1bW5JbmZvKCkgewogICAg\nICAgIF9jb2xzID0gbnVsbDsKICAgICAgICBfam9pbkNvbHMgPSBudWxsOwog\nICAgICAgIF9jb2xUYWJsZSA9IG51bGw7CiAgICAgICAgX2xvYiA9IGZhbHNl\nOwogICAgICAgIF90ZW1wb3JhbCA9IG51bGw7CiAgICAgICAgX3VuaXF1ZS5j\nbGVhcigpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgYXR0cmlidXRl\nLW92ZXJyaWRlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3RhcnRB\ndHRyaWJ1dGVPdmVycmlkZShBdHRyaWJ1dGVzIGF0dHIpIHsKICAgICAgICBf\nb3ZlcnJpZGUgPSBhdHRyLmdldFZhbHVlKCJuYW1lIik7CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYXR0cmlidXRl\nIG92ZXJyaWRlIGludG8gcHJvcGVyIG1hcHBpbmcuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBlbmRBdHRyaWJ1dGVPdmVycmlkZSgpCiAgICAgICAgdGhy\nb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IGVsZW0gPSBjdXJy\nZW50RWxlbWVudCgpOwogICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IG51bGw7\nCiAgICAgICAgaWYgKGVsZW0gaW5zdGFuY2VvZiBDbGFzc01hcHBpbmcpCiAg\nICAgICAgICAgIGZtID0gZ2V0QXR0cmlidXRlT3ZlcnJpZGUoKENsYXNzTWFw\ncGluZykgZWxlbSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEZpZWxk\nTWFwcGluZyBiYXNlZm0gPSAoRmllbGRNYXBwaW5nKSBlbGVtOwogICAgICAg\nICAgICAKICAgICAgICAgICAgZm0gPSBnZXRBdHRyaWJ1dGVPdmVycmlkZUZv\nckVtYmVkZGFibGUoYmFzZWZtLCBfb3ZlcnJpZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKGZtID09IG51bGwpIHsKICAgICAgICAgICAgICAgIERlZmVy\ncmVkRW1iZWRkYWJsZU92ZXJyaWRlcyBkZm0gPSAKICAgICAgICAgICAgICAg\nICAgICBnZXREZWZlcnJlZEZpZWxkTWFwcGluZ0luZm8oCiAgICAgICAgICAg\nICAgICAgICAgICAgIEFubm90YXRpb25QZXJzaXN0ZW5jZU1hcHBpbmdQYXJz\nZXIuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEVtYmVkZGVkQ2xhc3NU\neXBlKGJhc2VmbSwgX292ZXJyaWRlKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgYmFzZWZtLCBfb3ZlcnJpZGUsIHRydWUpOwogICAgICAgICAgICAgICAg\nZGZtLl9kZWZDb2xzID0gX2NvbHM7CiAgICAgICAgICAgICAgICBkZm0uX2Rl\nZlRhYmxlID0gREJJZGVudGlmaWVyLm5ld1RhYmxlKF9jb2xUYWJsZSwgZGVs\naW1pdCgpKTsKICAgICAgICAgICAgICAgIGRmbS5fYXR0ck5hbWUgPSBfb3Zl\ncnJpZGU7CiAgICAgICAgICAgICAgICBkZm0uX3VuaXF1ZSA9IF91bmlxdWU7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZtICE9IG51\nbGwgJiYgX2NvbHMgIT0gbnVsbCkgewogICAgICAgICAgICBmbS5nZXRWYWx1\nZUluZm8oKS5zZXRDb2x1bW5zKF9jb2xzKTsKICAgICAgICAgICAgaWYgKF9j\nb2xUYWJsZSAhPSBudWxsKQogICAgICAgICAgICAgICAgZm0uZ2V0TWFwcGlu\nZ0luZm8oKS5zZXRUYWJsZUlkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld1Rh\nYmxlKF9jb2xUYWJsZSwgZGVsaW1pdCgpKSk7CiAgICAgICAgICAgIHNldFVu\naXF1ZShmbSk7CiAgICAgICAgfQogICAgICAgIGNsZWFyQ29sdW1uSW5mbygp\nOwogICAgICAgIF9vdmVycmlkZSA9IG51bGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHByb3BlciBvdmVycmlkZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBGaWVsZE1hcHBpbmcgZ2V0QXR0cmlidXRlT3ZlcnJpZGUoQ2xh\nc3NNYXBwaW5nIGNtKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIHN1cCA9IChG\naWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRTdXBlcmNsYXNzRmllbGQKICAg\nICAgICAgICAgKF9vdmVycmlkZSk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxs\nKQogICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5hZGREZWZp\nbmVkU3VwZXJjbGFzc0ZpZWxkKF9vdmVycmlkZSwKICAgICAgICAgICAgICAg\nIE9iamVjdC5jbGFzcywgT2JqZWN0LmNsYXNzKTsKICAgICAgICByZXR1cm4g\nc3VwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcm9wZXIg\nb3ZlcnJpZGUuCiAgICAgKi8KICAgIHByaXZhdGUgRmllbGRNYXBwaW5nIGdl\ndEF0dHJpYnV0ZU92ZXJyaWRlRm9yRW1iZWRkYWJsZShGaWVsZE1hcHBpbmcg\nZm0sIAogICAgICAgIFN0cmluZyBhdHRyTmFtZSwgYm9vbGVhbiBtdXN0RXhp\nc3QpIAogICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIEFubm90YXRpb25QZXJzaXN0ZW5jZU1hcHBpbmdQYXJzZXIuZ2V0RW1iZWRk\nZWRGaWVsZE1hcHBpbmcoZm0sIAogICAgICAgICAgICBhdHRyTmFtZSwgbXVz\ndEV4aXN0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHRhYmxlLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3RhcnRUYWJsZShBdHRyaWJ1\ndGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgY3Vy\ncmVudEVsZW1lbnQoKTsKICAgICAgICBpZiAobWFwcGluZy5pc0Fic3RyYWN0\nKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ0YWJsZS1ub3QtYWxsb3dlZCIsIG1hcHBpbmcpKTsKICAgICAgICBE\nQklkZW50aWZpZXIgdGFibGUgPSB0b1RhYmxlSWRlbnRpZmllcihhdHRycy5n\nZXRWYWx1ZSgic2NoZW1hIiksCiAgICAgICAgICAgIGF0dHJzLmdldFZhbHVl\nKCJuYW1lIikpOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbCh0\nYWJsZSkpCiAgICAgICAgICAgIG1hcHBpbmcuZ2V0TWFwcGluZ0luZm8oKS5z\nZXRUYWJsZUlkZW50aWZpZXIodGFibGUpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ugam9pbi10YWJsZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHN0YXJ0Sm9pblRhYmxlKEF0dHJp\nYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAg\nICAgICAgREJJZGVudGlmaWVyIHNUYWJsZSA9IHRvVGFibGVJZGVudGlmaWVy\nKGF0dHJzLmdldFZhbHVlKCJzY2hlbWEiKSwKICAgICAgICAgICAgYXR0cnMu\nZ2V0VmFsdWUoIm5hbWUiKSk7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIu\naXNOdWxsKHNUYWJsZSkpIHsKICAgICAgICAgICAgT2JqZWN0IGVsZW0gPSBj\ndXJyZW50RWxlbWVudCgpOwogICAgICAgICAgICBGaWVsZE1hcHBpbmcgZm0g\nPSBudWxsOwogICAgICAgICAgICBpZiAoZWxlbSBpbnN0YW5jZW9mIEZpZWxk\nTWFwcGluZykgewogICAgICAgICAgICAgICAgZm0gPSAoRmllbGRNYXBwaW5n\nKSBlbGVtOyAKICAgICAgICAgICAgICAgIGlmIChfb3ZlcnJpZGUgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZyBiYXNlZm0g\nPSAoRmllbGRNYXBwaW5nKSBlbGVtOwogICAgICAgICAgICAgICAgICAgIGZt\nID0gZ2V0QXR0cmlidXRlT3ZlcnJpZGVGb3JFbWJlZGRhYmxlKGJhc2VmbSwg\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9vdmVycmlkZSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChmbSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyBk\nZm0gPSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldERlZmVycmVk\nRmllbGRNYXBwaW5nSW5mbygKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNYXBwaW5nUGFyc2VyLgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEVtYmVkZGVkQ2xhc3NU\neXBlKGJhc2VmbSwgX292ZXJyaWRlKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBiYXNlZm0sIF9vdmVycmlkZSwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGRmbS5fZGVmVGFibGUgPSBzVGFibGUuY2xvbmUo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGZtLl9hdHRyTmFtZSA9IF9v\ndmVycmlkZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbSBpbnN0YW5jZW9mIENs\nYXNzTWFwcGluZykgewogICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNt\nID0gKENsYXNzTWFwcGluZykgZWxlbTsKICAgICAgICAgICAgICAgIGZtID0g\nZ2V0QXR0cmlidXRlT3ZlcnJpZGUoY20pOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChmbSAhPSBudWxsKQogICAgICAgICAgICAgICAgZm0uZ2V0\nTWFwcGluZ0luZm8oKS5zZXRUYWJsZUlkZW50aWZpZXIoc1RhYmxlKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGpvaW4gdGFibGUgaW5mb3JtYXRpb24gYmFjay4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGVuZEpvaW5UYWJsZSgpIHRocm93cyBT\nQVhFeGNlcHRpb24gewogICAgICAgIE9iamVjdCBlbGVtID0gY3VycmVudEVs\nZW1lbnQoKTsKICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSBudWxsOwogICAg\nICAgIGlmIChlbGVtIGluc3RhbmNlb2YgRmllbGRNYXBwaW5nKSB7CiAgICAg\nICAgICAgIGZtID0gKEZpZWxkTWFwcGluZykgZWxlbTsKICAgICAgICAgICAg\naWYgKF9vdmVycmlkZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBGaWVs\nZE1hcHBpbmcgYmFzZWZtID0gKEZpZWxkTWFwcGluZykgZWxlbTsKICAgICAg\nICAgICAgICAgIGZtID0gZ2V0QXR0cmlidXRlT3ZlcnJpZGVGb3JFbWJlZGRh\nYmxlKGJhc2VmbSwgX292ZXJyaWRlLCAKICAgICAgICAgICAgICAgICAgICBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoZm0gPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyBk\nZm0gPSAKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGVmZXJyZWRGaWVs\nZE1hcHBpbmdJbmZvKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5u\nb3RhdGlvblBlcnNpc3RlbmNlTWFwcGluZ1BhcnNlci4KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGdldEVtYmVkZGVkQ2xhc3NUeXBlKGJhc2VmbSwg\nX292ZXJyaWRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2Vm\nbSwgX292ZXJyaWRlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBkZm0u\nX2RlZkNvbHMgPSBfY29sczsKICAgICAgICAgICAgICAgICAgICBkZm0uX2Rl\nZkVsZW1Kb2luQ29scyA9IF9qb2luQ29sczsKICAgICAgICAgICAgICAgICAg\nICBkZm0uX2F0dHJOYW1lID0gX292ZXJyaWRlOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChlbGVtIGluc3Rh\nbmNlb2YgQ2xhc3NNYXBwaW5nKXsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5n\nIGNtID0gKENsYXNzTWFwcGluZykgZWxlbTsKICAgICAgICAgICAgZm0gPSBn\nZXRBdHRyaWJ1dGVPdmVycmlkZShjbSk7CiAgICAgICAgfQoKICAgICAgICBp\nZiAoZm0gIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2pvaW5Db2xzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNl\ndENvbHVtbnMoX2pvaW5Db2xzKTsKICAgICAgICAgICAgaWYgKF9jb2xzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBmbS5nZXRFbGVtZW50TWFwcGluZygp\nLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoX2NvbHMpOwogICAgICAgIH0K\nICAgICAgICBjbGVhckNvbHVtbkluZm8oKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIHByaW1hcnkta2V5LWpvaW4tY29sdW1uLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gc3RhcnRQcmltYXJ5S2V5Sm9pbkNvbHVtbihB\ndHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24g\newogICAgICAgIENvbHVtbiBjb2wgPSBwYXJzZUNvbHVtbihhdHRycyk7CiAg\nICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfUEtfSk9JTiwgdHJ1ZSk7\nCiAgICAgICAgLy8gcGsgam9pbiBjb2x1bW5zIG9uIGZpZWxkcyBhY3QgYXMg\nZmllbGQgY29scwogICAgICAgIGlmIChjdXJyZW50RWxlbWVudCgpIGluc3Rh\nbmNlb2YgRmllbGRNYXBwaW5nKSB7CiAgICAgICAgICAgIGlmIChfY29scyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX2NvbHMgPSBuZXcgQXJyYXlMaXN0\nPENvbHVtbj4oMyk7CiAgICAgICAgICAgIF9jb2xzLmFkZChjb2wpOwogICAg\nICAgIH0gZWxzZSBpZiAoY3VycmVudFBhcmVudCgpID09IFNFQ09OREFSWV9U\nQUJMRSkgewogICAgICAgICAgICAvLyBwayBqb2luIGNvbHVtbnMgaW4gc2Vj\nb25kYXJ5IHRhYmxlIGFjdHMgYXMgam9pbiBjb2xzCiAgICAgICAgICAgIGlm\nIChfam9pbkNvbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9qb2luQ29s\ncyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPigzKTsKICAgICAgICAgICAgX2pv\naW5Db2xzLmFkZChjb2wpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIC8vIG11c3QgYmUgcGsgam9pbiBjb2xzIGZyb20gdGhpcyBjbGFzcyB0byBz\ndXBlcmNsYXNzCiAgICAgICAgICAgIGlmIChfc3VwSm9pbkNvbHMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9zdXBKb2luQ29scyA9IG5ldyBBcnJheUxp\nc3Q8Q29sdW1uPigzKTsKICAgICAgICAgICAgX3N1cEpvaW5Db2xzLmFkZChj\nb2wpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIGpvaW4tY29sdW1uLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gc3RhcnRKb2luQ29sdW1uKEF0dHJpYnV0ZXMgYXR0\ncnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nb25seSBqb2luIGNvbHMgaW4gYSBqb2luIHRhYmxlIGpvaW4gZmllbGQgdGFi\nbGUgdG8gY2xhc3MgdGFibGU7CiAgICAgICAgLy8gb3RoZXJzIGFjdCBhcyBk\nYXRhIGZrIGNvbHMKICAgICAgICBPYmplY3QgY3VycmVudFBhcmVudCA9IGN1\ncnJlbnRQYXJlbnQoKTsKICAgICAgICBpZiAoY3VycmVudFBhcmVudCA9PSBD\nT0xMRUNUSU9OX1RBQkxFKSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBm\nbSA9IChGaWVsZE1hcHBpbmcpIHBlZWtFbGVtZW50KCk7CiAgICAgICAgICAg\nIENvbHVtbiBjb2wgPSBwYXJzZUNvbHVtbihhdHRycyk7CiAgICAgICAgICAg\nIExpc3Q8Q29sdW1uPiBjb2xMaXN0ID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+\nKCk7CiAgICAgICAgICAgIGNvbExpc3QuYWRkKGNvbCk7CiAgICAgICAgICAg\nIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucyhjb2xMaXN0KTsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAg\nICAgIGlmIChjdXJyZW50UGFyZW50ICE9IEpPSU5fVEFCTEUpCiAgICAgICAg\nICAgIHJldHVybiBzdGFydENvbHVtbihhdHRycyk7CgogICAgICAgIGlmIChf\nam9pbkNvbHMgPT0gbnVsbCkKICAgICAgICAgICAgX2pvaW5Db2xzID0gbmV3\nIEFycmF5TGlzdDxDb2x1bW4+KDMpOwogICAgICAgIF9qb2luQ29scy5hZGQo\ncGFyc2VDb2x1bW4oYXR0cnMpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNvbHVtbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIHN0YXJ0Q29sdW1uKEF0dHJpYnV0ZXMgYXR0cnMp\nCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1u\nIGNvbCA9IHBhcnNlQ29sdW1uKGF0dHJzKTsKICAgICAgICBPYmplY3Qgb2Jq\nID0gcGVla0VsZW1lbnQoKTsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2Yg\nRmllbGRNYXBwaW5nKSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmbSA9\nIChGaWVsZE1hcHBpbmcpb2JqOwogICAgICAgICAgICAvLyBhIGNvbGxlY3Rp\nb24gb2YgYmFzaWMgdHlwZXMKICAgICAgICAgICAgLy8gdGhlIGNvbHVtbiBp\ncyBpbiBhIHNlcGFyYXRlIHRhYmxlCiAgICAgICAgICAgIGlmIChmbS5pc0Vs\nZW1lbnRDb2xsZWN0aW9uKCkgJiYKICAgICAgICAgICAgICAgICFmbS5nZXRF\nbGVtZW50TWFwcGluZygpLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAg\nICAgTGlzdDxDb2x1bW4+IGxpc3QgPSBmbS5nZXRFbGVtZW50TWFwcGluZygp\nLmdldFZhbHVlSW5mbygpLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAg\nIGlmIChsaXN0LnNpemUoKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAg\nbGlzdCA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPigpOwogICAgICAgICAgICAg\nICAgICAgIGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCku\nc2V0Q29sdW1ucyhsaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGxpc3QuYWRkKGNvbCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoX2Nv\nbHMgPT0gbnVsbCkKICAgICAgICAgICAgX2NvbHMgPSBuZXcgQXJyYXlMaXN0\nPENvbHVtbj4oMyk7CiAgICAgICAgX2NvbHMuYWRkKGNvbCk7CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBtYXAt\na2V5LWNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHN0YXJ0\nTWFwS2V5Q29sdW1uKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZp\nZWxkTWFwcGluZykgcGVla0VsZW1lbnQoKTsKICAgICAgICBDb2x1bW4gY29s\nID0gcGFyc2VDb2x1bW4oYXR0cnMpOwogICAgICAgIE1hcHBpbmdJbmZvIGlu\nZm8gPSBmbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCk7CiAgICAg\nICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4o\nKTsKICAgICAgICBjb2xzLmFkZChjb2wpOwogICAgICAgIGluZm8uc2V0Q29s\ndW1ucyhjb2xzKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIG1hcC1rZXktam9pbi1jb2x1bW4uCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBzdGFydE1hcEtleUpvaW5Db2x1bW4oQXR0\ncmlidXRlcyBhdHRycykKICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nICAgIGJvb2xlYW4gcmV0VmFsID0gc3RhcnRNYXBLZXlDb2x1bW4oYXR0cnMp\nOwogICAgICAgIC8vIGNoZWNrIGlmIG5hbWUgaXMgbm90IHNldCwgc2V0IGl0\nIHRvIGRlZmF1bHQ6IHRoZQogICAgICAgIC8vIGNvbmNhdGVuYXRpb24gb2Yg\ndGhlIG5hbWUgb2YgdGhlIHJlZmVyZW5jaW5nIHByb3BlcnR5CiAgICAgICAg\nLy8gb3IgZmllbGQgbmFtZSwgIi0iLCAiS0VZIgogICAgICAgIEZpZWxkTWFw\ncGluZyBmbSA9IChGaWVsZE1hcHBpbmcpIHBlZWtFbGVtZW50KCk7CiAgICAg\nICAgTWFwcGluZ0luZm8gaW5mbyA9IGZtLmdldEtleU1hcHBpbmcoKS5nZXRW\nYWx1ZUluZm8oKTsKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IGluZm8u\nZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbiBjb2wgPSBjb2xzLmdldCgw\nKTsKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzTnVsbChjb2wuZ2V0SWRl\nbnRpZmllcigpKSkgewogICAgICAgICAgICBjb2wuc2V0SWRlbnRpZmllcihE\nQklkZW50aWZpZXIubmV3Q29sdW1uKGZtLmdldE5hbWUoKSArICJfIiArICJL\nRVkiLCBkZWxpbWl0KCkpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBy\nZXRWYWw7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlIGEgY29s\ndW1uIHdpdGggdGhlIGdpdmVuIGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHBy\naXZhdGUgQ29sdW1uIHBhcnNlQ29sdW1uKEF0dHJpYnV0ZXMgYXR0cnMpCiAg\nICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGNv\nbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBTdHJpbmcgdmFsID0gYXR0cnMu\nZ2V0VmFsdWUoIm5hbWUiKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAg\nICAgICAgICAgIGNvbC5zZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdD\nb2x1bW4odmFsLCBkZWxpbWl0KCkpKTsKICAgICAgICB2YWwgPSBhdHRycy5n\nZXRWYWx1ZSgicmVmZXJlbmNlZC1jb2x1bW4tbmFtZSIpOwogICAgICAgIGlm\nICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgY29sLnNldFRhcmdldElkZW50\naWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbih2YWwsIGRlbGltaXQoKSkp\nOwogICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJjb2x1bW4tZGVmaW5p\ndGlvbiIpOwogICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAg\nY29sLnNldFR5cGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW5E\nZWZpbml0aW9uKHZhbCkpOwogICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVl\nKCJwcmVjaXNpb24iKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAg\nICAgICAgIGNvbC5zZXRTaXplKEludGVnZXIucGFyc2VJbnQodmFsKSk7CiAg\nICAgICAgdmFsID0gYXR0cnMuZ2V0VmFsdWUoImxlbmd0aCIpOwogICAgICAg\nIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgY29sLnNldFNpemUoSW50\nZWdlci5wYXJzZUludCh2YWwpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRW\nYWx1ZSgic2NhbGUiKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAg\nICAgICAgIGNvbC5zZXREZWNpbWFsRGlnaXRzKEludGVnZXIucGFyc2VJbnQo\ndmFsKSk7CiAgICAgICAgdmFsID0gYXR0cnMuZ2V0VmFsdWUoIm51bGxhYmxl\nIik7CiAgICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICBjb2wu\nc2V0Tm90TnVsbCgiZmFsc2UiLmVxdWFscyh2YWwpKTsKICAgICAgICB2YWwg\nPSBhdHRycy5nZXRWYWx1ZSgiaW5zZXJ0YWJsZSIpOwogICAgICAgIGlmICh2\nYWwgIT0gbnVsbCkKICAgICAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZM\nQUdfVU5JTlNFUlRBQkxFLCAiZmFsc2UiLmVxdWFscyh2YWwpKTsKICAgICAg\nICB2YWwgPSBhdHRycy5nZXRWYWx1ZSgidXBkYXRhYmxlIik7CiAgICAgICAg\naWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICBjb2wuc2V0RmxhZyhDb2x1\nbW4uRkxBR19VTlVQREFUQUJMRSwgImZhbHNlIi5lcXVhbHModmFsKSk7Cgog\nICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJ1bmlxdWUiKTsKICAgICAg\nICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIF91bmlxdWUuYWRkKEVu\ndW0udmFsdWVPZihVbmlxdWVGbGFnLmNsYXNzLCB2YWwudG9VcHBlckNhc2Uo\nKSkpOwogICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJ0YWJsZSIpOwog\nICAgICAgIGlmICh2YWwgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2Nv\nbFRhYmxlICE9IG51bGwgJiYgIV9jb2xUYWJsZS5lcXVhbHModmFsKSkKICAg\nICAgICAgICAgICAgIHRocm93IGdldEV4Y2VwdGlvbihfbG9jLmdldCgic2Vj\nb25kLWluY29uc2lzdCIsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEVs\nZW1lbnQoKSkpOwogICAgICAgICAgICBfY29sVGFibGUgPSB2YWw7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBjb2xsZWN0aW9uVGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiBzdGFydENvbGxlY3Rpb25UYWJsZShBdHRyaWJ1dGVzIGF0dHJz\nKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIEZpZWxk\nTWFwcGluZyBmbSA9IChGaWVsZE1hcHBpbmcpIHBlZWtFbGVtZW50KCk7Cgog\nICAgICAgIEZpZWxkTWFwcGluZ0luZm8gaW5mbyA9IGZtLmdldE1hcHBpbmdJ\nbmZvKCk7CiAgICAgICAgREJJZGVudGlmaWVyIGN0YmwgPSBwYXJzZUNvbGxl\nY3Rpb25UYWJsZShhdHRycyk7CiAgICAgICAgaW5mby5zZXRUYWJsZUlkZW50\naWZpZXIoY3RibCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\ncHJpdmF0ZSBEQklkZW50aWZpZXIgcGFyc2VDb2xsZWN0aW9uVGFibGUoQXR0\ncmlidXRlcyBhdHRycykgewogICAgICAgIFN0cmluZyB0VmFsID0gYXR0cnMu\nZ2V0VmFsdWUoIm5hbWUiKTsKICAgICAgICBTdHJpbmcgc1ZhbCA9IGF0dHJz\nLmdldFZhbHVlKCJzY2hlbWEiKTsKICAgICAgICByZXR1cm4gdG9UYWJsZUlk\nZW50aWZpZXIoc1ZhbCwgdFZhbCk7IAogICAgfQoKICAgIC8qKgogICAgICog\nRm9ybSBhIHF1YWxpZmllZCB0YWJsZSBuYW1lIGZyb20gYSBzY2hlbWEgYW5k\nIHRhYmxlIG5hbWUuCiAgICAgKi8KICAgIHByaXZhdGUgREJJZGVudGlmaWVy\nIHRvVGFibGVJZGVudGlmaWVyKFN0cmluZyBzY2hlbWEsIFN0cmluZyB0YWJs\nZSkgewogICAgICAgIERCSWRlbnRpZmllciBzTmFtZSA9IERCSWRlbnRpZmll\nci5uZXdTY2hlbWEoc2NoZW1hLCBkZWxpbWl0KCkpOwogICAgICAgIERCSWRl\nbnRpZmllciB0TmFtZSA9IERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZSwg\nZGVsaW1pdCgpKTsKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzRW1wdHko\ndE5hbWUpIHx8IERCSWRlbnRpZmllci5pc0VtcHR5KHNOYW1lKSkgewogICAg\nICAgICAgICByZXR1cm4gdE5hbWU7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBRdWFsaWZpZWREQklkZW50aWZpZXIubmV3UGF0aChzTmFtZSwgdE5hbWUp\nOwogICAgfQoKCiAgICAvKioKICAgICAqIFN0YXJ0IHByb2Nlc3NpbmcgPGNv\nZGU+c3FsLXJlc3VsdC1zZXQtbWFwcGluZzwvY29kZT4gbm9kZS4KICAgICAq\nIFB1c2hlcyB0aGUge0BsaW5rIFF1ZXJ5UmVzdWx0TWFwcGluZ30gb250byB0\naGUgc3RhY2sgYXMgY3VycmVudCBlbGVtZW50LgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gc3RhcnRTUUxSZXN1bHRTZXRNYXBwaW5nKEF0dHJpYnV0\nZXMgYXR0cnMpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGF0dHJzLmdldFZh\nbHVlKCJuYW1lIik7CiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1zcWxyc21hcHBpbmciLCBuYW1lKSk7\nCgogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdS\nZXBvc2l0b3J5KSBnZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgUXVlcnlSZXN1\nbHRNYXBwaW5nIHJlc3VsdCA9IHJlcG9zLmdldENhY2hlZFF1ZXJ5UmVzdWx0\nTWFwcGluZwogICAgICAgICAgICAobnVsbCwgbmFtZSk7CiAgICAgICAgaWYg\nKHJlc3VsdCAhPSBudWxsICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAg\nICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJvdmVycmlkZS1zcWxyc21hcHBp\nbmciLCBuYW1lLAogICAgICAgICAgICAgICAgY3VycmVudExvY2F0aW9uKCkp\nKTsKCiAgICAgICAgcmVzdWx0ID0gcmVwb3MuYWRkUXVlcnlSZXN1bHRNYXBw\naW5nKG51bGwsIG5hbWUpOwogICAgICAgIHJlc3VsdC5zZXRMaXN0aW5nSW5k\nZXgoX3Jlc3VsdElkeCsrKTsKICAgICAgICBhZGRDb21tZW50cyhyZXN1bHQp\nOwoKICAgICAgICBPYmplY3QgY3VyID0gY3VycmVudEVsZW1lbnQoKTsKICAg\nICAgICBPYmplY3Qgc2NvcGUgPSAoY3VyIGluc3RhbmNlb2YgQ2xhc3NNZXRh\nRGF0YSkKICAgICAgICAgICAgPyAoKENsYXNzTWV0YURhdGEpIGN1cikuZ2V0\nRGVzY3JpYmVkVHlwZSgpIDogbnVsbDsKICAgICAgICByZXN1bHQuc2V0U291\ncmNlKGdldFNvdXJjZUZpbGUoKSwgc2NvcGUsIFNvdXJjZVRyYWNrZXIuU1JD\nX1hNTCk7CiAgICAgICAgTG9jYXRvciBsb2NhdG9yID0gZ2V0TG9jYXRpb24o\nKS5nZXRMb2NhdG9yKCk7CiAgICAgICAgaWYgKGxvY2F0b3IgIT0gbnVsbCkg\newogICAgICAgICAgICByZXN1bHQuc2V0TGluZU51bWJlcihOdW1iZXJzLnZh\nbHVlT2YobG9jYXRvci5nZXRMaW5lTnVtYmVyKCkpKTsKICAgICAgICAgICAg\ncmVzdWx0LnNldENvbE51bWJlcihOdW1iZXJzLnZhbHVlT2YobG9jYXRvci5n\nZXRDb2x1bW5OdW1iZXIoKSkpOwogICAgICAgIH0KICAgICAgICBwdXNoRWxl\nbWVudChyZXN1bHQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBlbmRTUUxSZXN1bHRTZXRNYXBwaW5nKCkKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBwb3BFbGVtZW50KCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdGFydCBwcm9jZXNzaW5nIDxjb2Rl\nPmVudGl0eS1yZXN1bHQ8L2NvZGU+IG5vZGUuCiAgICAgKiBQdXNoZXMgdGhl\nIHtAbGluayBRdWVyeVJlc3VsdE1hcHBpbmcuUENSZXN1bHR9CiAgICAgKiBv\nbnRvIHRoZSBzdGFjayBhcyBjdXJyZW50IGVsZW1lbnQuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiBzdGFydEVudGl0eVJlc3VsdChBdHRyaWJ1dGVz\nIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAg\nIENsYXNzPD8+IGVudGl0eUNsYXNzID0gY2xhc3NGb3JOYW1lKGF0dHJzLmdl\ndFZhbHVlKCJlbnRpdHktY2xhc3MiKSk7CiAgICAgICAgU3RyaW5nIGRpc2Ny\naW1pbmF0b3IgPSBEQklkZW50aWZpZXIubmV3Q29sdW1uKGF0dHJzLmdldFZh\nbHVlKCJkaXNjcmltaW5hdG9yLWNvbHVtbiIpLCBkZWxpbWl0KCkpLmdldE5h\nbWUoKTsgCgogICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyBwYXJlbnQgPSAo\nUXVlcnlSZXN1bHRNYXBwaW5nKSBjdXJyZW50RWxlbWVudCgpOwogICAgICAg\nIFF1ZXJ5UmVzdWx0TWFwcGluZy5QQ1Jlc3VsdCByZXN1bHQgPSBwYXJlbnQu\nYWRkUENSZXN1bHQoZW50aXR5Q2xhc3MpOwogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShkaXNjcmltaW5hdG9yKSkKICAgICAgICAgICAgcmVz\ndWx0LmFkZE1hcHBpbmcoUENSZXN1bHQuRElTQ1JJTUlOQVRPUiwgZGlzY3Jp\nbWluYXRvcik7CiAgICAgICAgcHVzaEVsZW1lbnQocmVzdWx0KTsKICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZW5kRW50\naXR5UmVzdWx0KCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nICAgICBwb3BFbGVtZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9j\nZXNzIGEgPGNvZGU+ZmllbGQtcmVzdWx0PC9jb2RlPiBub2RlLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gc3RhcnRGaWVsZFJlc3VsdChBdHRyaWJ1\ndGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nICAgIFN0cmluZyBmaWVsZE5hbWUgPSBhdHRycy5nZXRWYWx1ZSgibmFtZSIp\nOwogICAgICAgIFN0cmluZyBjb2x1bW5OYW1lID0gREJJZGVudGlmaWVyLm5l\nd0NvbHVtbihhdHRycy5nZXRWYWx1ZSgiY29sdW1uIiksIGRlbGltaXQoKSku\nZ2V0TmFtZSgpOwoKICAgICAgICBRdWVyeVJlc3VsdE1hcHBpbmcuUENSZXN1\nbHQgcGFyZW50ID0gKFF1ZXJ5UmVzdWx0TWFwcGluZy5QQ1Jlc3VsdCkKICAg\nICAgICAgICAgY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBwYXJlbnQuYWRk\nTWFwcGluZyhmaWVsZE5hbWUsIGNvbHVtbk5hbWUpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUHJvY2VzcyBhIDxjb2Rl\nPmNvbHVtbi1yZXN1bHQ8L2NvZGU+IG5vZGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBzdGFydENvbHVtblJlc3VsdChBdHRyaWJ1dGVzIGF0dHJz\nKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIFF1ZXJ5\nUmVzdWx0TWFwcGluZyBwYXJlbnQgPSAoUXVlcnlSZXN1bHRNYXBwaW5nKSBj\ndXJyZW50RWxlbWVudCgpOwogICAgICAgIHBhcmVudC5hZGRDb2x1bW5SZXN1\nbHQoYXR0cnMuZ2V0VmFsdWUoIm5hbWUiKSk7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgLyoqIAogICAgICogU3RhcnRzIHByb2Nlc3Npbmcg\nJmx0O3VuaXF1ZS1jb25zdHJhaW50Jmd0OyBwcm92aWRlZCB0aGUgdGFnIG9j\nY3VycwogICAgICogd2l0aGluIGEgQ2xhc3NNYXBwaW5nIGVsZW1lbnQgYW5k\nIDxlbT5ub3Q8L2VtPiB3aXRoaW4gYSBzZWNvbmRhcnkKICAgICAqIHRhYmxl\nLiAKICAgICAqIFB1c2hlcyB0aGUgVW5pcXVlIGVsZW1lbnQgaW4gdGhlIHN0\nYWNrLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3RhcnRVbmlxdWVD\nb25zdHJhaW50KEF0dHJpYnV0ZXMgYXR0cnMpIAogICAgICAgIHRocm93cyBT\nQVhFeGNlcHRpb24gewogICAgICAgIFVuaXF1ZSB1bmlxdWUgPSBuZXcgVW5p\ncXVlKCk7CgogICAgICAgIERCSWRlbnRpZmllciBuYW1lID0gREJJZGVudGlm\naWVyLm5ld0NvbnN0cmFpbnQoYXR0cnMuZ2V0VmFsdWUoIm5hbWUiKSwgZGVs\naW1pdCgpKTsKICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc0VtcHR5KG5h\nbWUpKSB7CiAgICAgICAgICAgIHVuaXF1ZS5zZXRJZGVudGlmaWVyKG5hbWUp\nOwogICAgICAgIH0KCiAgICAgICAgcHVzaEVsZW1lbnQodW5pcXVlKTsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBF\nbmRzIHByb2Nlc3NpbmcgJmx0O3VuaXF1ZS1jb25zdHJhaW50Jmd0OyBwcm92\naWRlZCB0aGUgdGFnIG9jY3VycwogICAgICogd2l0aGluIGEgQ2xhc3NNYXBw\naW5nIGVsZW1lbnQgYW5kIDxlbT5ub3Q8L2VtPiB3aXRoaW4gYSBzZWNvbmRh\ncnkKICAgICAqIHRhYmxlLiBUaGUgc3RhY2sgaXMgcG9wcGVkIGFuZCB0aGUg\nVW5pcXVlIGVsZW1lbnQgaXMgYWRkZWQgdG8gdGhlCiAgICAgKiBDbGFzc01h\ncHBpbmdJbmZvLiAKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGVuZFVuaXF1\nZUNvbnN0cmFpbnQoKSB7CiAgICAgICAgVW5pcXVlIHVuaXF1ZSA9IChVbmlx\ndWUpIHBvcEVsZW1lbnQoKTsKICAgICAgICBPYmplY3QgY3R4ID0gY3VycmVu\ndEVsZW1lbnQoKTsKICAgICAgICBEQklkZW50aWZpZXIgdGFibGVOYW1lID0g\nREJJZGVudGlmaWVyLm5ld1RhYmxlKCI/Iik7CiAgICAgICAgaWYgKGN0eCBp\nbnN0YW5jZW9mIENsYXNzTWFwcGluZykgewogICAgICAgIAlDbGFzc01hcHBp\nbmdJbmZvIGluZm8gPSAoKENsYXNzTWFwcGluZykgY3R4KS5nZXRNYXBwaW5n\nSW5mbygpOwogICAgICAgIAl0YWJsZU5hbWUgPSAoX3NlY29uZGFyeVRhYmxl\nID09IG51bGwpIAogICAgICAgIAkJPyBpbmZvLmdldFRhYmxlSWRlbnRpZmll\ncigpIDogREJJZGVudGlmaWVyLm5ld1RhYmxlKF9zZWNvbmRhcnlUYWJsZSwg\nZGVsaW1pdCgpKTsKICAgICAgICAJaW5mby5hZGRVbmlxdWUodGFibGVOYW1l\nLCB1bmlxdWUpOwogICAgICAgIH0gZWxzZSBpZiAoY3R4IGluc3RhbmNlb2Yg\nRmllbGRNYXBwaW5nKSB7Ly8gSm9pblRhYmxlCiAgICAgICAgCUZpZWxkTWFw\ncGluZ0luZm8gaW5mbyA9ICgoRmllbGRNYXBwaW5nKWN0eCkuZ2V0TWFwcGlu\nZ0luZm8oKTsKICAgICAgICAJaW5mby5hZGRKb2luVGFibGVVbmlxdWUodW5p\ncXVlKTsKICAgICAgICB9IGVsc2UgaWYgKGN0eCBpbnN0YW5jZW9mIFNlcXVl\nbmNlTWFwcGluZykgewogICAgICAgIAlTZXF1ZW5jZU1hcHBpbmcgc2VxID0g\nKFNlcXVlbmNlTWFwcGluZyljdHg7CiAgICAgICAgCXVuaXF1ZS5zZXRUYWJs\nZUlkZW50aWZpZXIoc2VxLmdldFRhYmxlSWRlbnRpZmllcigpKTsKICAgICAg\nICAJQ29sdW1uW10gdW5pcXVlQ29sdW1ucyA9IHVuaXF1ZS5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgCURCSWRlbnRpZmllcltdIGNvbHVtbk5hbWVzID0gbmV3\nIERCSWRlbnRpZmllclt1bmlxdWVDb2x1bW5zLmxlbmd0aF07CiAgICAgICAg\nCWludCBpID0gMDsKICAgICAgICAJZm9yIChDb2x1bW4gdW5pcXVlQ29sdW1u\nIDogdW5pcXVlQ29sdW1ucykKICAgICAgICAJCWNvbHVtbk5hbWVzW2krK10g\nPSB1bmlxdWVDb2x1bW4uZ2V0SWRlbnRpZmllcigpLmNsb25lKCk7CiAgICAg\nICAgCXNlcS5zZXRVbmlxdWVDb2x1bW5zSWRlbnRpZmllcihjb2x1bW5OYW1l\ncyk7CiAgICAgICAgCWlmICghREJJZGVudGlmaWVyLmlzRW1wdHkodW5pcXVl\nLmdldElkZW50aWZpZXIoKSkpIHsKICAgICAgICAJICAgIHNlcS5zZXRVbmlx\ndWVDb25zdHJhaW50SWRlbnRpZmllcih1bmlxdWUuZ2V0SWRlbnRpZmllcigp\nKTsKICAgICAgICAJfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgCXRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBFbmRzIHByb2Nlc3NpbmcgJmx0O2NvbHVtbi1u\nYW1lJmd0OyB0YWcgYnkgYWRkaW5nIHRoZSBjb2x1bW4gbmFtZSBpbgogICAg\nICogdGhlIGN1cnJlbnQgVW5pcXVlIGVsZW1lbnQgdGhhdCByZXNpZGVzIGlu\nIHRoZSB0b3Agb2YgdGhlIHN0YWNrLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gZW5kQ29sdW1uTmFtZSgpIHsKICAgICAgICBPYmplY3QgY3VycmVu\ndCA9IGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgaWYgKGN1cnJlbnQgaW5z\ndGFuY2VvZiBVbmlxdWUpIHsKICAgICAgICAgICAgVW5pcXVlIHVuaXF1ZSA9\nIChVbmlxdWUpIGN1cnJlbnQ7CiAgICAgICAgICAgIENvbHVtbiBjb2x1bW4g\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgICAgIGNvbHVtbi5zZXRJZGVudGlm\naWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW4odGhpcy5jdXJyZW50VGV4dCgp\nLCBkZWxpbWl0KCkpKTsKICAgICAgICAgICAgdW5pcXVlLmFkZENvbHVtbihj\nb2x1bW4pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFRyYWNrIHVuaXF1ZSBjb2x1bW4gc2V0dGluZ3MuCgkgKi8KCXByaXZhdGUg\nc3RhdGljIGVudW0gVW5pcXVlRmxhZwoJewoJCVRSVUUsCgkJRkFMU0UKCX0K\nCQoJcHJpdmF0ZSB2b2lkIHBhcnNlRGlzY3JpbWluYXRvckNvbHVtbihBdHRy\naWJ1dGVzIGF0dHJzKSB7IAoJICAgIFN0cmluZyB2YWwgPSBhdHRycy5nZXRW\nYWx1ZSgiZGlzY3JpbWluYXRvci10eXBlIik7CiAgICAgICAgaWYgKHZhbCAh\nPSBudWxsKSB7CiAgICAgICAgICAgIF9kaXNjVHlwZSA9IEVudW0udmFsdWVP\nZihEaXNjcmltaW5hdG9yVHlwZS5jbGFzcywgdmFsKTsKICAgICAgICB9CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9kaXNjVHlwZSA9IERpc2NyaW1p\nbmF0b3JUeXBlLlNUUklORzsKICAgICAgICB9CiAgICAgICAgICAgIAoJfSAg\nCiAgICAKICAgIC8qKgogICAgICogUHJvY2VzcyBPcmRlckNvbHVtbi4KICAg\nICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3RhcnRPcmRlckNvbHVtbihB\ndHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24g\newogICAgICAgIENvbHVtbiBjb2wgPSBwYXJzZU9yZGVyQ29sdW1uKGF0dHJz\nKTsKICAgICAgICBPYmplY3Qgb2JqID0gcGVla0VsZW1lbnQoKTsKICAgICAg\nICBpZiAob2JqIGluc3RhbmNlb2YgRmllbGRNYXBwaW5nKSB7CiAgICAgICAg\nICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVsZE1hcHBpbmcpb2JqOwogICAg\nICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldE9yZGVyQ29sdW1uKGNv\nbCk7CgogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAg\nIC8qKgogICAgICogQ3JlYXRlIGFuIG9yZGVyIGNvbHVtbiB3aXRoIHRoZSBn\naXZlbiBhdHRyaWJ1dGVzLgogICAgICovCiAgICBwcml2YXRlIENvbHVtbiBw\nYXJzZU9yZGVyQ29sdW1uKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhy\nb3dzIFNBWEV4Y2VwdGlvbiB7CgogICAgICAgIENvbHVtbiBjb2wgPSBuZXcg\nQ29sdW1uKCk7CiAgICAgICAgU3RyaW5nIHZhbCA9IGF0dHJzLmdldFZhbHVl\nKCJuYW1lIik7CiAgICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAg\nICBjb2wuc2V0SWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29sdW1uKHZh\nbCwgZGVsaW1pdCgpKSk7CiAgICAgICAgdmFsID0gYXR0cnMuZ2V0VmFsdWUo\nImNvbHVtbi1kZWZpbml0aW9uIik7IAogICAgICAgIGlmICh2YWwgIT0gbnVs\nbCkKICAgICAgICAgICAgY29sLnNldFR5cGVJZGVudGlmaWVyKERCSWRlbnRp\nZmllci5uZXdDb2x1bW5EZWZpbml0aW9uKHZhbCkpOwogICAgICAgIHZhbCA9\nIGF0dHJzLmdldFZhbHVlKCJwcmVjaXNpb24iKTsKICAgICAgICBpZiAodmFs\nICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5zZXRTaXplKEludGVnZXIucGFy\nc2VJbnQodmFsKSk7CiAgICAgICAgdmFsID0gYXR0cnMuZ2V0VmFsdWUoImxl\nbmd0aCIpOwogICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAg\nY29sLnNldFNpemUoSW50ZWdlci5wYXJzZUludCh2YWwpKTsKICAgICAgICB2\nYWwgPSBhdHRycy5nZXRWYWx1ZSgic2NhbGUiKTsKICAgICAgICBpZiAodmFs\nICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5zZXREZWNpbWFsRGlnaXRzKElu\ndGVnZXIucGFyc2VJbnQodmFsKSk7CiAgICAgICAgdmFsID0gYXR0cnMuZ2V0\nVmFsdWUoIm51bGxhYmxlIik7CiAgICAgICAgaWYgKHZhbCAhPSBudWxsKQog\nICAgICAgICAgICBjb2wuc2V0Tm90TnVsbCgiZmFsc2UiLmVxdWFscyh2YWwp\nKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1ZSgiaW5zZXJ0YWJsZSIp\nOwogICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgY29sLnNl\ndEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAiZmFsc2UiLmVxdWFs\ncyh2YWwpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1ZSgidXBkYXRh\nYmxlIik7CiAgICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICBj\nb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgImZhbHNlIi5l\ncXVhbHModmFsKSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGNvbDsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBQcm9jZXNzIGFsbCBkZWZlcnJlZCBl\nbWJlZGRhYmxlIG92ZXJyaWRlcyBmb3IgYSBnaXZlbiBjbGFzcy4gIAogICAg\nICogVGhpcyBzaG91bGQgb25seSBvY2N1ciBhZnRlciB0aGUgZW1iZWRkYWJs\nZSBpcyBtYXBwZWQuCiAgICAgKiAKICAgICAqIEBwYXJhbSBlbWJlZFR5cGUg\nIGVtYmVkZGFibGUgY2xhc3MgCiAgICAgKiBAcGFyYW0gYWNjZXNzIGNsYXNz\nIGxldmVsIGFjY2VzcyBmb3IgZW1iZWRkYWJsZQogICAgICogQHRocm93cyBT\nQVhFeGNlcHRpb24gCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHJvdGVj\ndGVkIHZvaWQgYXBwbHlEZWZlcnJlZEVtYmVkZGFibGVPdmVycmlkZXMoQ2xh\nc3M8Pz4gY2xzKSAKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nICAgICBBcnJheUxpc3Q8RGVmZXJyZWRFbWJlZGRhYmxlT3ZlcnJpZGVzPiBk\nZWZNYXBwaW5ncyA9IAogICAgICAgICAgICBfZGVmZXJyZWRNYXBwaW5ncy5n\nZXQoY2xzKTsKICAgICAgICBpZiAoZGVmTWFwcGluZ3MgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIAogICAgICAgIGZvciAoRGVmZXJy\nZWRFbWJlZGRhYmxlT3ZlcnJpZGVzIGRlZk1hcCA6IGRlZk1hcHBpbmdzKSB7\nCiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVsZE1hcHBpbmcp\nZGVmTWFwLl9mbTsKICAgICAgICAgICAgaWYgKGRlZk1hcCA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBmbSA9IGdldEF0\ndHJpYnV0ZU92ZXJyaWRlRm9yRW1iZWRkYWJsZShmbSwgZGVmTWFwLl9hdHRy\nTmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgIC8vIEFwcGx5IGNvbHVtbiwgdGFi\nbGUsIGFuZCB1bmlxdWUgb3ZlcnJpZGVzCiAgICAgICAgICAgIGlmIChkZWZN\nYXAuX2RlZkNvbHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZm0uZ2V0\nVmFsdWVJbmZvKCkuc2V0Q29sdW1ucyhkZWZNYXAuX2RlZkNvbHMpOwogICAg\nICAgICAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKGRlZk1hcC5f\nZGVmVGFibGUpKQogICAgICAgICAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJ\nbmZvKCkuc2V0VGFibGVJZGVudGlmaWVyKGRlZk1hcC5fZGVmVGFibGUpOwog\nICAgICAgICAgICAgICAgc2V0VW5pcXVlKGZtLCBkZWZNYXAuX3VuaXF1ZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQXBwbHkgSm9pbiBjb2x1\nbW4gYW5kIGVsZW1lbnQgam9pbiBjb2x1bW5zIG92ZXJyaWRlcyBvdmVycmlk\nZXMKICAgICAgICAgICAgaWYgKGRlZk1hcC5fZGVmSm9pbkNvbHMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29s\ndW1ucyhkZWZNYXAuX2RlZkpvaW5Db2xzKTsKICAgICAgICAgICAgaWYgKGRl\nZk1hcC5fZGVmRWxlbUpvaW5Db2xzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldENv\nbHVtbnMoCiAgICAgICAgICAgICAgICAgICAgZGVmTWFwLl9kZWZFbGVtSm9p\nbkNvbHMpOwogICAgICAgIH0KICAgICAgICAvLyBDbGVhbiB1cCBhZnRlciBh\ncHBseWluZyBtYXBwaW5ncwogICAgICAgIGRlZk1hcHBpbmdzLmNsZWFyKCk7\nCiAgICAgICAgX2RlZmVycmVkTWFwcGluZ3MucmVtb3ZlKGNscyk7CiAgICB9\nCgogICAgLyoKICAgICAqIERlZmVyIG92ZXJyaWRlcyBmb3IgdGhlIHNwZWNp\nZmllZCBmaWVsZCBtYXBwaW5nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBk\nZWZlckVtYmVkZGFibGVPdmVycmlkZXMoCiAgICAgICAgQ2xhc3M8Pz4gY2xz\nLCBEZWZlcnJlZEVtYmVkZGFibGVPdmVycmlkZXMgZGVmTWFwKSB7CiAgICAg\nICAgQXJyYXlMaXN0PERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcz4gZGVm\nTWFwcGluZ3MgPSAKICAgICAgICAgICAgX2RlZmVycmVkTWFwcGluZ3MuZ2V0\nKGNscyk7CiAgICAgICAgaWYgKGRlZk1hcHBpbmdzID09IG51bGwpIHsKICAg\nICAgICAgICAgZGVmTWFwcGluZ3MgPSBuZXcgQXJyYXlMaXN0PERlZmVycmVk\nRW1iZWRkYWJsZU92ZXJyaWRlcz4oKTsKICAgICAgICAgICAgX2RlZmVycmVk\nTWFwcGluZ3MucHV0KGNscywgZGVmTWFwcGluZ3MpOwogICAgICAgIH0KICAg\nICAgICBkZWZNYXBwaW5ncy5hZGQoZGVmTWFwKTsKICAgIH0KICAgIAogICAg\nLyoKICAgICAqIENsZWFuIHVwIGFueSBkZWZlcnJlZCBtYXBwaW5ncwogICAg\nICovCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyRGVm\nZXJyZWRNZXRhRGF0YSgpIHsKICAgICAgICBzdXBlci5jbGVhckRlZmVycmVk\nTWV0YURhdGEoKTsKICAgICAgICBfZGVmZXJyZWRNYXBwaW5ncy5jbGVhcigp\nOwogICAgfQogICAgCiAgICAvKgogICAgICogR2V0IGVtYmVkZGFibGUgb3Zl\ncnJpZGVzIGZvciB0aGUgc3BlY2lmaWVkIGZpZWxkIG1hcHBpbmcuICBJZiBj\ncmVhdGUKICAgICAqIGlzIHRydWUsIGNyZWF0ZSBhIG5ldyBvdmVycmlkZSBp\nZiBvbmUgZG9lcyBub3QgZXhpc3QuCiAgICAgKi8KICAgIHByaXZhdGUgRGVm\nZXJyZWRFbWJlZGRhYmxlT3ZlcnJpZGVzIAogICAgICAgIGdldERlZmVycmVk\nRmllbGRNYXBwaW5nSW5mbyhDbGFzczw/PiBjbHMsIEZpZWxkTWFwcGluZyBm\nbSwgCiAgICAgICAgICAgIFN0cmluZyBhdHRyTmFtZSwgYm9vbGVhbiBjcmVh\ndGUpIHsKCiAgICAgICAgQXJyYXlMaXN0PERlZmVycmVkRW1iZWRkYWJsZU92\nZXJyaWRlcz4gZGVmTWFwcGluZ3MgPSAKICAgICAgICAgICAgX2RlZmVycmVk\nTWFwcGluZ3MuZ2V0KGNscyk7CiAgICAgICAgCiAgICAgICAgaWYgKGRlZk1h\ncHBpbmdzID09IG51bGwgJiYgY3JlYXRlKSB7CiAgICAgICAgICAgIGRlZk1h\ncHBpbmdzID0gbmV3IEFycmF5TGlzdDxEZWZlcnJlZEVtYmVkZGFibGVPdmVy\ncmlkZXM+KCk7CiAgICAgICAgICAgIF9kZWZlcnJlZE1hcHBpbmdzLnB1dChj\nbHMsIGRlZk1hcHBpbmdzKTsKICAgICAgICB9CiAgICAgICAgRGVmZXJyZWRF\nbWJlZGRhYmxlT3ZlcnJpZGVzIGRmbSA9IAogICAgICAgICAgICBmaW5kRGVm\nZXJyZWRNYXBwaW5nKGNscywgZm0sIGF0dHJOYW1lKTsKCiAgICAgICAgaWYg\nKGRmbSA9PSBudWxsICYgY3JlYXRlKSB7CiAgICAgICAgICAgIGRmbSA9IG5l\ndyBEZWZlcnJlZEVtYmVkZGFibGVPdmVycmlkZXMoZm0sIGF0dHJOYW1lKTsK\nICAgICAgICAgICAgZGVmZXJFbWJlZGRhYmxlT3ZlcnJpZGVzKGNscywgZGZt\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRmbTsgICAgICAgICAgICAK\nICAgIH0KCiAgICAvKgogICAgICogRmluZCBkZWZlcnJlZCBtYXBwaW5ncyBm\nb3IgdGhlIGdpdmVuIGNsYXNzLCBmbSwgYW5kIGF0dHIgbmFtZQogICAgICov\nCiAgICBwcml2YXRlIERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyBmaW5k\nRGVmZXJyZWRNYXBwaW5nKENsYXNzPD8+IGNscywgCiAgICAgICAgRmllbGRN\nYXBwaW5nIGZtLCBTdHJpbmcgYXR0ck5hbWUpIHsKICAgICAgICBBcnJheUxp\nc3Q8RGVmZXJyZWRFbWJlZGRhYmxlT3ZlcnJpZGVzPiBkZWZNYXBwaW5ncyA9\nIAogICAgICAgICAgICBfZGVmZXJyZWRNYXBwaW5ncy5nZXQoY2xzKTsKICAg\nICAgICBpZiAoZGVmTWFwcGluZ3MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgCiAgICAgICAgZm9yIChEZWZlcnJlZEVtYmVk\nZGFibGVPdmVycmlkZXMgZGZtIDogZGVmTWFwcGluZ3MpIHsKICAgICAgICAg\nICAgaWYgKGRmbSAhPSBudWxsICYmIGRmbS5fZm0gPT0gZm0gJiYgCiAgICAg\nICAgICAgICAgICBhdHRyTmFtZS5lcXVhbHMoZGZtLl9hdHRyTmFtZSkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gZGZtOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nlc3MgYWxs\nIGRlZmVycmVkIGVtYmVkZGFibGVzIHVzaW5nIGFuIHVua25vd24gYWNjZXNz\nIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZERlZmVycmVk\nRW1iZWRkYWJsZU1ldGFEYXRhKCkgewogICAgICAgIHN1cGVyLmFkZERlZmVy\ncmVkRW1iZWRkYWJsZU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKF9kZWZlcnJl\nZE1hcHBpbmdzLnNpemUoKSA+IDApIHsKICAgICAgICAgICAgU2V0PENsYXNz\nPD8+PiBrZXlzID0gX2RlZmVycmVkTWFwcGluZ3Mua2V5U2V0KCk7CiAgICAg\nICAgICAgIENsYXNzW10gY2xhc3NlcyA9IGtleXMudG9BcnJheShuZXcgQ2xh\nc3NbMF0pOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsYXNz\nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgYXBwbHlEZWZlcnJlZEVtYmVkZGFibGVPdmVycmlk\nZXMoY2xhc3Nlc1tpXSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9s\nb2MuZ2V0KCJuby1lbWJlZGRhYmxlLW1ldGFkYXRhIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjbGFzc2VzW2ldLmdldE5hbWUoKSksIGUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIAogICAgfSAgICAKICAgIAogICAgLy8gSW5uZXIgY2xhc3MgZm9y\nIHN0b3Jpbmcgb3ZlcnJpZGUgaW5mb3JtYXRpb24KICAgIGNsYXNzIERlZmVy\ncmVkRW1iZWRkYWJsZU92ZXJyaWRlcyB7CiAgICAgICAgRGVmZXJyZWRFbWJl\nZGRhYmxlT3ZlcnJpZGVzKEZpZWxkTWFwcGluZyBmbSwgU3RyaW5nIGF0dHJO\nYW1lKSB7CiAgICAgICAgICAgIF9mbSA9IGZtOwogICAgICAgICAgICBfYXR0\nck5hbWUgPSBhdHRyTmFtZTsKICAgICAgICAgICAgX2RlZlRhYmxlID0gREJJ\nZGVudGlmaWVyLk5VTEw7CiAgICAgICAgfQogICAgICAgIHByaXZhdGUgRmll\nbGRNYXBwaW5nIF9mbTsKICAgICAgICBwcml2YXRlIExpc3Q8Q29sdW1uPiBf\nZGVmQ29sczsKICAgICAgICBwcml2YXRlIExpc3Q8Q29sdW1uPiBfZGVmRWxl\nbUpvaW5Db2xzOwogICAgICAgIHByaXZhdGUgTGlzdDxDb2x1bW4+IF9kZWZK\nb2luQ29sczsKICAgICAgICBwcml2YXRlIERCSWRlbnRpZmllciBfZGVmVGFi\nbGU7CiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgX2F0dHJOYW1lOwogICAgICAg\nIHByaXZhdGUgRW51bVNldDxVbmlxdWVGbGFnPiBfdW5pcXVlOwogICAgfSAg\nCiAgICAKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3Rh\ncnREZWxpbWl0ZWRJZGVudGlmaWVycygpIHsKICAgICAgICBKREJDQ29uZmln\ndXJhdGlvbiBjb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBnZXRDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBjb25mLmdl\ndERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAgZGljdC5zZXREZWxp\nbWl0SWRlbnRpZmllcnModHJ1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CiAgICAKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIFN0cmluZyBu\nb3JtYWxpemVTZXF1ZW5jZU5hbWUoU3RyaW5nIHNlcU5hbWUpIHsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzZXFOYW1lKSkgewogICAgICAg\nICAgICByZXR1cm4gc2VxTmFtZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIERCSWRlbnRpZmllci5uZXdTZXF1ZW5jZShzZXFOYW1lLCBkZWxpbWl0KCkp\nLmdldE5hbWUoKTsKICAgIH0KICAgIAogICAgQE92ZXJyaWRlCiAgICBwcm90\nZWN0ZWQgU3RyaW5nIG5vcm1hbGl6ZVNjaGVtYU5hbWUoU3RyaW5nIHNjaE5h\nbWUpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzY2hOYW1l\nKSkgewogICAgICAgICAgICByZXR1cm4gc2NoTmFtZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoTmFtZSwg\nZGVsaW1pdCgpKS5nZXROYW1lKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwcm90ZWN0ZWQgU3RyaW5nIG5vcm1hbGl6ZUNhdGFsb2dOYW1lKFN0cmlu\nZyBjYXROYW1lKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\nY2F0TmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuIGNhdE5hbWU7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhj\nYXROYW1lLCBkZWxpbWl0KCkpLmdldE5hbWUoKTsKICAgIH0KCiAgICBwcml2\nYXRlIGJvb2xlYW4gZGVsaW1pdCgpIHsKICAgICAgICByZXR1cm4gX2RpY3Qu\nZ2V0RGVsaW1pdElkZW50aWZpZXJzKCk7CiAgICB9Cn0K\n","encoding":"base64"}

