{"sha":"f45afafebfdeadbdf3eb98ecd26aba975b4a3865","node_id":"MDQ6QmxvYjIwNjM2NDpmNDVhZmFmZWJmZGVhZGJkZjNlYjk4ZWNkMjZhYmE5NzViNGEzODY1","size":5500,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f45afafebfdeadbdf3eb98ecd26aba975b4a3865","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGU7\nCgppbXBvcnQgamF2YS51dGlsLkFycmF5czsKCmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5FbnRpdHlNYW5hZ2VyOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5kYXRhY2FjaGUuQ2FjaGVTdGF0aXN0aWNzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFFbnRpdHlNYW5hZ2Vy\nRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5j\nZS5TdG9yZUNhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLlN0b3JlQ2FjaGVJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLnRlc3QuU2luZ2xlRU1GVGVzdENhc2U7CgovKioK\nICogVGVzdHMgc3RhdGlzdGljcyBvZiBkYXRhIGNhY2hlIG9wZXJhdGlvbi4K\nICogIAogKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICoKICovCnB1YmxpYyBj\nbGFzcyBUZXN0U3RhdGlzdGljcyBleHRlbmRzIFNpbmdsZUVNRlRlc3RDYXNl\nIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGJvb2xlYW4gTDJDYWNoZWQg\nPSB0cnVlOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgYm9vbGVhbiBMMUNh\nY2hlZCA9IHRydWU7CiAgICBwcml2YXRlIHN0YXRpYyBDYWNoZWRQZXJzb24g\ncGVyc29uOwogICAgcHJpdmF0ZSBFbnRpdHlNYW5hZ2VyIGVtOwogICAgcHJp\ndmF0ZSBTdG9yZUNhY2hlIGNhY2hlOwogICAgQ2FjaGVTdGF0aXN0aWNzIHN0\nYXRzOwogICAgcHVibGljIHZvaWQgc2V0VXAoKSB7CiAgICAgICAgc3VwZXIu\nc2V0VXAoQ0xFQVJfVEFCTEVTLCBDYWNoZWRQZXJzb24uY2xhc3MsCiAgICAg\nICAgICAgICAgICAib3BlbmpwYS5EYXRhQ2FjaGUiLCAidHJ1ZShFbmFibGVT\ndGF0aXN0aWNzPXRydWUpIiwKICAgICAgICAgICAgICAgICJvcGVuanBhLlF1\nZXJ5Q2FjaGUiLCAidHJ1ZSIsCiAgICAgICAgICAgICAgICAib3BlbmpwYS5S\nZW1vdGVDb21taXRQcm92aWRlciIsICJzanZtIik7CiAgICAgICAgY2FjaGUg\nPSBlbWYuZ2V0U3RvcmVDYWNoZSgpOwogICAgICAgIGFzc2VydE5vdE51bGwo\nY2FjaGUpOwogICAgICAgIHN0YXRzID0gY2FjaGUuZ2V0U3RhdGlzdGljcygp\nOwogICAgICAgIGFzc2VydE5vdE51bGwoc3RhdHMpOwogICAgICAgIGVtID0g\nZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICAKICAgICAgICBw\nZXJzb24gPSBjcmVhdGVEYXRhKCk7CiAgICAgICAgc3RhdHMucmVzZXQoKTsK\nICAgICAgICBlbS5jbGVhcigpOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFRlc3QgdGhhdCB0aGUgQ2FjaGVTdGF0aXN0aWNzIGlzIGRpc2FibGVkIGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3REZWZhdWx0\nU2V0dGluZ3MoKSB7CiAgICAgICAgT2JqZWN0W10gcHJvcHMgPSB7Im9wZW5q\ncGEuRGF0YUNhY2hlIiwgInRydWUiLCAib3BlbmpwYS5SZW1vdGVDb21taXRQ\ncm92aWRlciIsICJzanZtIn07CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFn\nZXJGYWN0b3J5IGVtZjEgPSBjcmVhdGVOYW1lZEVNRigic2Vjb25kLXBlcnNp\nc3RlbmNlLXVuaXQiLCBwcm9wcyk7CiAgICAgICAgCiAgICAgICAgYXNzZXJ0\nRmFsc2UoZW1mMS5nZXRTdG9yZUNhY2hlKCkuZ2V0U3RhdGlzdGljcygpLmlz\nRW5hYmxlZCgpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBGaW5kaW5n\nIGFuIGVudGl0eSBmcm9tIGEgY2xlYW4gc2hvdWxkIGhpdCB0aGUgTDIgY2Fj\naGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RGaW5kKCkgewogICAg\nICAgIGFzc2VydFRydWUoY2FjaGUuZ2V0U3RhdGlzdGljcygpLmlzRW5hYmxl\nZCgpKTsKICAgICAgICBPYmplY3QgcGlkID0gcGVyc29uLmdldElkKCk7CiAg\nICAgICAgYXNzZXJ0Q2FjaGVkKHBlcnNvbiwgcGlkLCAhTDFDYWNoZWQsIEwy\nQ2FjaGVkKTsKICAgICAgICAKICAgICAgICBsb25nW10gYmVmb3JlID0gc25h\ncHNob3QoKTsKICAgICAgICBDYWNoZWRQZXJzb24gcCA9IGVtLmZpbmQoQ2Fj\naGVkUGVyc29uLmNsYXNzLCBwaWQpOwogICAgICAgIGxvbmdbXSBhZnRlciA9\nIHNuYXBzaG90KCk7CgogICAgICAgIGFzc2VydERlbHRhKGJlZm9yZSwgYWZ0\nZXIsIDEsIDEsIDApOyAvLyBSRUFEOjEgSElUOjEsIFdSSVRFOjAKICAgICAg\nICBhc3NlcnRDYWNoZWQocCwgcGlkLCBMMUNhY2hlZCwgTDJDYWNoZWQpOwoK\nICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgdGVzdE11bHRpcGxlVW5pdHMo\nKSB7CiAgICAgICAgU3RyaW5nW10gcHJvcHMgPSB7Im9wZW5qcGEuRGF0YUNh\nY2hlIiwgInRydWUiLCAib3BlbmpwYS5SZW1vdGVDb21taXRQcm92aWRlciIs\nICJzanZtIn07CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5\nIGVtZjEgPSBjcmVhdGVOYW1lZEVNRigidGVzdCIsIHByb3BzKTsKICAgICAg\nICBPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnkgZW1mMiA9IGNyZWF0ZU5h\nbWVkRU1GKCJlbXB0eS1wdSIsIHByb3BzKTsKICAgICAgICBhc3NlcnROb3RT\nYW1lKGVtZjEsIGVtZjIpOwogICAgICAgIGFzc2VydE5vdFNhbWUoZW1mMS5n\nZXRTdG9yZUNhY2hlKCksIGVtZjIuZ2V0U3RvcmVDYWNoZSgpKTsKICAgICAg\nICBhc3NlcnROb3RTYW1lKGVtZjEuZ2V0U3RvcmVDYWNoZSgpLmdldFN0YXRp\nc3RpY3MoKSwgZW1mMi5nZXRTdG9yZUNhY2hlKCkuZ2V0U3RhdGlzdGljcygp\nKTsKICAgICAgICBhc3NlcnROb3RTYW1lKCgoU3RvcmVDYWNoZUltcGwpZW1m\nMS5nZXRTdG9yZUNhY2hlKCkpLmdldERlbGVnYXRlKCksIAogICAgICAgICAg\nICAgICAgKChTdG9yZUNhY2hlSW1wbCllbWYyLmdldFN0b3JlQ2FjaGUoKSku\nZ2V0RGVsZWdhdGUoKSk7CiAgICAgICAgCiAgICB9CiAgICAKICAgIENhY2hl\nZFBlcnNvbiBjcmVhdGVEYXRhKCkgewogICAgICAgIGVtLmdldFRyYW5zYWN0\naW9uKCkuYmVnaW4oKTsKICAgICAgICBDYWNoZWRQZXJzb24gcCA9IG5ldyBD\nYWNoZWRQZXJzb24oKTsKICAgICAgICBwLnNldElkKChpbnQpU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCkpOwogICAgICAgIGVtLnBlcnNpc3QocCk7CiAg\nICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICBy\nZXR1cm4gcDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXQge2hpdCxy\nZWFkLHdyaXRlfSBjb3VudCBmb3IgdGhlIGNhY2hlIGFjcm9zcyBhbGwgaW5z\ndGFuY2VzLgogICAgICovCiAgICBsb25nW10gc25hcHNob3QoKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBsb25nW117c3RhdHMuZ2V0UmVhZENvdW50KCksIHN0\nYXRzLmdldEhpdENvdW50KCksIHN0YXRzLmdldFdyaXRlQ291bnQoKX07CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogR2V0IHtoaXQscmVhZCx3cml0ZX0g\nY291bnQgZm9yIHRoZSBjYWNoZSBhY3Jvc3MgZ2l2ZW4gY2xhc3MgZXh0ZW50\nLgogICAgICovCiAgICBsb25nW10gc25hcHNob3QoQ2xhc3M8Pz4gY2xzKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBsb25nW117c3RhdHMuZ2V0UmVhZENvdW50\nKGNscyksIHN0YXRzLmdldEhpdENvdW50KGNscyksIHN0YXRzLmdldFdyaXRl\nQ291bnQoY2xzKX07CiAgICB9CiAgICAKICAgIHZvaWQgYXNzZXJ0RGVsdGEo\nbG9uZ1tdIGJlZm9yZSwgbG9uZ1tdIGFmdGVyLCBsb25nIHJlYWREZWx0YSwg\nbG9uZyBoaXREZWx0YSwgbG9uZyB3cml0ZURlbHRhKSB7CiAgICAgICAgYXNz\nZXJ0RXF1YWxzKCJSRUFEIGNvdW50IG1pc21hdGNoIiwgIHJlYWREZWx0YSwg\nIGFmdGVyWzBdIC0gYmVmb3JlWzBdKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nIkhJVCBjb3VudCBtaXNtYXRjaCIsICAgaGl0RGVsdGEsICAgYWZ0ZXJbMV0g\nLSBiZWZvcmVbMV0pOwogICAgICAgIGFzc2VydEVxdWFscygiV1JJVEUgY291\nbnQgbWlzbWF0Y2giLCB3cml0ZURlbHRhLCBhZnRlclsyXSAtIGJlZm9yZVsy\nXSk7CiAgICB9CiAgICAKICAgIAogICAgdm9pZCBhc3NlcnRDYWNoZWQoT2Jq\nZWN0IG8sIE9iamVjdCBvaWQsIGJvb2xlYW4gbDEsIGJvb2xlYW4gbDIpIHsK\nICAgICAgICBib29sZWFuIGwxYSA9IGVtLmNvbnRhaW5zKG8pOwogICAgICAg\nIGJvb2xlYW4gbDJhID0gY2FjaGUuY29udGFpbnMoby5nZXRDbGFzcygpLCBv\naWQpOwogICAgICAgIGlmIChsMSAhPSBsMWEpIHsKICAgICAgICAgICAgZmFp\nbCgiRXhwZWN0ZWQgIiArIChsMSA/ICIiOiJub3QiKSArICIgdG8gZmluZCBp\nbnN0YW5jZSAiICsgCiAgICAgICAgICAgICAgICAgICAgby5nZXRDbGFzcygp\nLmdldFNpbXBsZU5hbWUoKSsiOiIrb2lkICsgIiBpbiBMMSBjYWNoZSIpOwog\nICAgICAgIH0KICAgICAgICBpZiAobDIgIT0gbDJhKSB7CiAgICAgICAgICAg\nIGZhaWwoIkV4cGVjdGVkICIgKyAobDIgPyAiIjoibm90IikgKyAiIHRvIGZp\nbmQgaW5zdGFuY2UgIiArIAogICAgICAgICAgICAgICAgICAgIG8uZ2V0Q2xh\nc3MoKS5nZXRTaW1wbGVOYW1lKCkrIjoiK29pZCArICIgaW4gTDIgY2FjaGUi\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHZvaWQgcHJpbnQoU3RyaW5n\nIG1zZywgQ2FjaGVTdGF0aXN0aWNzIHN0YXRzKSB7CiAgICAgICAgU3lzdGVt\nLmVyci5wcmludGxuKG1zZyArIHN0YXRzICsgIiBIOiIgKyBzdGF0cy5nZXRI\naXRDb3VudCgpICsgIiBSOiIgKyBzdGF0cy5nZXRSZWFkQ291bnQoKSArICIg\nVzoiICsgCiAgICAgICAgICAgICAgICBzdGF0cy5nZXRXcml0ZUNvdW50KCkp\nOwogICAgfQp9Cg==\n","encoding":"base64"}

