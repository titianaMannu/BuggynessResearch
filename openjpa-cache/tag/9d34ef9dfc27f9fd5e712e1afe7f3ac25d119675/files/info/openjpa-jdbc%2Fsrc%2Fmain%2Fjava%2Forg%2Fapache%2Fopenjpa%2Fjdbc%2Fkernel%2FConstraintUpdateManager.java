{"sha":"c445fdb8461789a8d3bb30f1b107db5626b04aa1","node_id":"MDQ6QmxvYjIwNjM2NDpjNDQ1ZmRiODQ2MTc4OWE4ZDNiYjMwZjFiMTA3ZGI1NjI2YjA0YWEx","size":21733,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c445fdb8461789a8d3bb30f1b107db5626b04aa1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbDsKCmltcG9ydCBq\nYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0\naW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlByaW1hcnlSb3c7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd0ltcGw7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dNYW5hZ2VySW1wbDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxFeGNlcHRpb25z\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3Rh\ndGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5ncmFw\naC5EZXB0aEZpcnN0QW5hbHlzaXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmdyYXBoLkVkZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmdyYXBoLkdyYXBoOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioKICogPHA+U3RhbmRh\ncmQgdXBkYXRlIG1hbmFnZXIsIGNhcGFibGUgb2YgZm9yZWlnbiBrZXkgY29u\nc3RyYWludCBldmFsdWF0aW9uLjwvcD4KICoKICogQHNpbmNlIDEuMC4wCiAq\nLwpwdWJsaWMgY2xhc3MgQ29uc3RyYWludFVwZGF0ZU1hbmFnZXIKICAgIGV4\ndGVuZHMgQWJzdHJhY3RVcGRhdGVNYW5hZ2VyIHsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlCiAgICAgICAgKENvbnN0cmFpbnRVcGRhdGVNYW5hZ2VyLmNsYXNzKTsK\nCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckRpcnR5KCkgewogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRl\nbWVudE1hbmFnZXIgbmV3UHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VyCiAgICAg\nICAgKEpEQkNTdG9yZSBzdG9yZSwgQ29ubmVjdGlvbiBjb25uKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBQcmVwYXJlZFN0YXRlbWVudE1hbmFnZXJJbXBsKHN0\nb3JlLCBjb25uKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgUm93TWFuYWdlciBu\nZXdSb3dNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBuZXcgUm93TWFuYWdl\nckltcGwoZmFsc2UpOwogICAgfQoKICAgIHByb3RlY3RlZCBDb2xsZWN0aW9u\nIGZsdXNoKFJvd01hbmFnZXIgcm93TWdyLAogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50TWFuYWdlciBwc01nciwgQ29sbGVjdGlvbiBleGNlcHMpIHsKICAg\nICAgICBSb3dNYW5hZ2VySW1wbCBybWltcGwgPSAoUm93TWFuYWdlckltcGwp\nIHJvd01ncjsKCiAgICAgICAgLy8gZmlyc3QgdGFrZSBjYXJlIG9mIGFsbCBz\nZWNvbmRhcnkgdGFibGUgZGVsZXRlcyBhbmQgJ2FsbCByb3cnIGRlbGV0ZXMK\nICAgICAgICAvLyAod2hpY2ggYXJlIHByb2JhYmx5IHNlY29uZGFyeSB0YWJs\nZSBkZWxldGVzKSwgc2luY2Ugbm8gZm9yZWlnbgogICAgICAgIC8vIGtleXMg\nZXZlciByZWx5IG9uIHNlY29uZGFyeSB0YWJsZSBwa3MKICAgICAgICBmbHVz\naChybWltcGwuZ2V0QWxsUm93RGVsZXRlcygpLCBwc01ncik7CiAgICAgICAg\nZmx1c2gocm1pbXBsLmdldFNlY29uZGFyeURlbGV0ZXMoKSwgcHNNZ3IpOwoK\nICAgICAgICAvLyBub3cgZG8gYW55ICdhbGwgcm93JyB1cGRhdGVzCiAgICAg\nICAgZmx1c2gocm1pbXBsLmdldEFsbFJvd1VwZGF0ZXMoKSwgcHNNZ3IpOwoK\nICAgICAgICAvLyBhbmFseXplIGZvcmVpZ24ga2V5cwogICAgICAgIENvbGxl\nY3Rpb24gaW5zZXJ0cyA9IHJtaW1wbC5nZXRJbnNlcnRzKCk7CiAgICAgICAg\nQ29sbGVjdGlvbiB1cGRhdGVzID0gcm1pbXBsLmdldFVwZGF0ZXMoKTsKICAg\nICAgICBDb2xsZWN0aW9uIGRlbGV0ZXMgPSBybWltcGwuZ2V0RGVsZXRlcygp\nOwogICAgICAgIEdyYXBoW10gZ3JhcGhzID0gbmV3IEdyYXBoWzJdOyAgICAv\nLyBpbnNlcnQgZ3JhcGgsIGRlbGV0ZSBncmFwaAogICAgICAgIGFuYWx5emVG\nb3JlaWduS2V5cyhpbnNlcnRzLCB1cGRhdGVzLCBkZWxldGVzLCBybWltcGws\nIGdyYXBocyk7CgogICAgICAgIC8vIGZsdXNoIGluc2VydCBncmFwaCwgaWYg\nYW55CiAgICAgICAgYm9vbGVhbiBhdXRvQXNzaWduID0gcm1pbXBsLmhhc0F1\ndG9Bc3NpZ25Db25zdHJhaW50cygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZsdXNoR3JhcGgoZ3JhcGhzWzBdLCBwc01nciwgYXV0b0Fzc2lnbik7\nCiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAg\nICAgIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIGRpY3QpKTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZEV4\nY2VwdGlvbihleGNlcHMsIGtlKTsKICAgICAgICB9CgogICAgICAgIC8vIGZs\ndXNoIHRoZSByZXN0IG9mIHRoZSBpbnNlcnRzIGFuZCB1cGRhdGVzOyBpbnNl\ncnRzIGJlZm9yZSB1cGRhdGVzCiAgICAgICAgLy8gYmVjYXVzZSBzb21lIHVw\nZGF0ZSBma3MgbWlnaHQgcmVmZXJlbmNlIHBrcyB0aGF0IGhhdmUgdG8gYmUg\naW5zZXJ0ZWQKICAgICAgICBmbHVzaChpbnNlcnRzLCBwc01ncik7CiAgICAg\nICAgZmx1c2godXBkYXRlcywgcHNNZ3IpOwoKICAgICAgICAvLyBmbHVzaCB0\naGUgZGVsZXRlIGdyYXBoLCBpZiBhbnkKICAgICAgICB0cnkgewogICAgICAg\nICAgICBmbHVzaEdyYXBoKGdyYXBoc1sxXSwgcHNNZ3IsIGF1dG9Bc3NpZ24p\nOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICBleGNlcHMgPSBhZGRFeGNlcHRpb24oZXhjZXBzLCBTUUxFeGNlcHRp\nb25zLmdldFN0b3JlKHNlLCBkaWN0KSk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBleGNlcHMgPSBhZGRF\neGNlcHRpb24oZXhjZXBzLCBrZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBw\ndXQgdGhlIHJlbWFpbmRlciBvZiB0aGUgZGVsZXRlcyBhZnRlciB1cGRhdGVz\nIGJlY2F1c2Ugc29tZSB1cGRhdGVzCiAgICAgICAgLy8gbWF5IGJlIG51bGxp\nbmcgZmtzIHRvIHJvd3MgdGhhdCBhcmUgZ29pbmcgdG8gYmUgZGVsZXRlZAog\nICAgICAgIGZsdXNoKGRlbGV0ZXMsIHBzTWdyKTsKCiAgICAgICAgLy8gdGFr\nZSBjYXJlIG9mIGFsbCBzZWNvbmRhcnkgdGFibGUgaW5zZXJ0cyBhbmQgdXBk\nYXRlcyBsYXN0LCBzaW5jZQogICAgICAgIC8vIHRoZXkgbWF5IHJlbHkgb24g\ncHJldmlvdXMgaW5zZXJ0cyBvciB1cGRhdGVzLCBidXQgbm90aGluZyByZWxp\nZXMKICAgICAgICAvLyBvbiB0aGVtCiAgICAgICAgZmx1c2gocm1pbXBsLmdl\ndFNlY29uZGFyeVVwZGF0ZXMoKSwgcHNNZ3IpOwoKICAgICAgICAvLyBmbHVz\naCBhbnkgbGVmdCBvdmVyIHByZXBhcmVkIHN0YXRlbWVudHMKICAgICAgICBw\nc01nci5mbHVzaCgpOwogICAgICAgIHJldHVybiBleGNlcHM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBbmFseXplIGZvcmVpZ24ga2V5IGRlcGVuZGVuY2ll\ncyBvbiB0aGUgZ2l2ZW4gcm93cwogICAgICogYW5kIGNyZWF0ZSBhbiBpbnNl\ncnQgYW5kIGEgZGVsZXRlIGdyYXBoIHRvIGV4ZWN1dGUuICBUaGUgaW5zZXJ0\nCiAgICAgKiBncmFwaCB3aWxsIGJlIGZsdXNoZWQgYmVmb3JlIGFsbCBvdGhl\nciByb3dzLCBhbmQgdGhlIGRlbGV0ZSBncmFwaCB3aWxsCiAgICAgKiBiZSBm\nbHVzaGVkIGFmdGVyIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nbmFseXplRm9yZWlnbktleXMoQ29sbGVjdGlvbiBpbnNlcnRzLCBDb2xsZWN0\naW9uIHVwZGF0ZXMsCiAgICAgICAgQ29sbGVjdGlvbiBkZWxldGVzLCBSb3dN\nYW5hZ2VySW1wbCByb3dNZ3IsIEdyYXBoW10gZ3JhcGhzKSB7CiAgICAgICAg\nLy8gaWYgdGhlcmUgYXJlIGFueSBkZWxldGVzLCB3ZSBoYXZlIHRvIG1hcCB0\naGUgaW5zZXJ0IG9iamVjdHMgb24gdGhlaXIKICAgICAgICAvLyBvaWRzIHNv\nIHdlJ2xsIGJlIGFibGUgdG8gZGV0ZWN0IGRlbGV0ZS10aGVuLWluc2VydC1z\nYW1lLXBrIGNhc2VzCiAgICAgICAgTWFwIGluc2VydE1hcCA9IG51bGw7CiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbTsKICAgICAgICBpZiAoIWRl\nbGV0ZXMuaXNFbXB0eSgpICYmICFpbnNlcnRzLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICBpbnNlcnRNYXAgPSBuZXcgSGFzaE1hcCgoaW50KSAoaW5zZXJ0\ncy5zaXplKCkgKiAxLjMzICsgMSkpOwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IGluc2VydHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIHNtID0gKChSb3cpIGl0ci5uZXh0KCkpLmdl\ndFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nICYmIHNtLmdldE9iamVjdElkKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBpbnNlcnRNYXAucHV0KHNtLmdldE9iamVjdElkKCksIHNtKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZmlyc3QgY29uc3Ry\ndWN0IHRoZSBncmFwaCBmb3IgZGVsZXRlczsgdGhpcyBtYXkgZXhwYW5kIHRv\nIGluY2x1ZGUKICAgICAgICAvLyBpbnNlcnRzIGFuZCB1cGRhdGVzIGFzIHdl\nbGwgaWYgdGhlcmUgYXJlIGFueSBpbnNlcnRzIHRoYXQgcmVseSBvbgogICAg\nICAgIC8vIGRlbGV0ZXMgKGRlbGV0ZS10aGVuLWluc2VydC1zYW1lLXBrIGNh\nc2VzKQogICAgICAgIFByaW1hcnlSb3cgcm93OwogICAgICAgIFJvdyByb3cy\nOwogICAgICAgIEZvcmVpZ25LZXlbXSBma3M7CiAgICAgICAgT3BlbkpQQVN0\nYXRlTWFuYWdlciBma1ZhbDsKICAgICAgICBib29sZWFuIGlnbm9yZVVwZGF0\nZXMgPSB0cnVlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZGVsZXRl\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBy\nb3cgPSAoUHJpbWFyeVJvdykgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYg\nKCFyb3cuaXNWYWxpZCgpKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICByb3cyID0gZ2V0SW5zZXJ0Um93KGluc2VydE1hcCwgcm93\nTWdyLCByb3cpOwogICAgICAgICAgICBpZiAocm93MiAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZ25vcmVVcGRhdGVzID0gZmFsc2U7CiAgICAgICAg\nICAgICAgICBncmFwaHNbMV0gPSBhZGRFZGdlKGdyYXBoc1sxXSwgKFByaW1h\ncnlSb3cpIHJvdzIsIHJvdywgbnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIG5vdyBjaGVjayB0aGlzIHJvdydzIGZrcyBhZ2FpbnN0IG90\naGVyIGRlbGV0ZXMKICAgICAgICAgICAgZmtzID0gcm93LmdldFRhYmxlKCku\nZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCBma3MubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8vIHdo\nZW4gZGVsZXRpbmcgcmVmIGZrcyB0aGV5J2xsIGp1c3Qgc2V0IGEgd2hlcmUg\ndmFsdWUsIHNvCiAgICAgICAgICAgICAgICAvLyBjaGVjayBib3RoIGZvciBm\nayB1cGRhdGVzIChyZWxhdGlvbiBma3MpIGFuZCB3aGVyZXMgKHJlZiBma3Mp\nCiAgICAgICAgICAgICAgICBma1ZhbCA9IHJvdy5nZXRGb3JlaWduS2V5U2V0\nKGZrc1tqXSk7CiAgICAgICAgICAgICAgICBpZiAoZmtWYWwgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBma1ZhbCA9IHJvdy5nZXRGb3JlaWduS2V5\nV2hlcmUoZmtzW2pdKTsKICAgICAgICAgICAgICAgIGlmIChma1ZhbCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgIHJvdzIgPSByb3dNZ3IuZ2V0Um93KGZrc1tqXS5nZXRQcmltYXJ5\nS2V5VGFibGUoKSwKICAgICAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX0RF\nTEVURSwgZmtWYWwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmIChyb3cy\nICE9IG51bGwgJiYgcm93Mi5pc1ZhbGlkKCkgJiYgcm93MiAhPSByb3cpCiAg\nICAgICAgICAgICAgICAgICAgZ3JhcGhzWzFdID0gYWRkRWRnZShncmFwaHNb\nMV0sIChQcmltYXJ5Um93KSByb3cyLCByb3csCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZrc1tqXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGlmIChpZ25vcmVVcGRhdGVzKQogICAgICAgICAgICBncmFwaHNbMF0g\nPSBhbmFseXplQWdhaW5zdEluc2VydHMoaW5zZXJ0cywgcm93TWdyLCBncmFw\naHNbMF0pOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBwdXQgaW5z\nZXJ0cyAqYW5kIHVwZGF0ZXMqIGluIHRoZSBkZWxldGUgZ3JhcGg7IHRoZXkg\nYWxsIHJlbHkKICAgICAgICAgICAgLy8gb24gZWFjaCBvdGhlcgogICAgICAg\nICAgICBncmFwaHNbMV0gPSBhbmFseXplQWdhaW5zdEluc2VydHModXBkYXRl\ncywgcm93TWdyLCBncmFwaHNbMV0pOwogICAgICAgICAgICBncmFwaHNbMV0g\nPSBhbmFseXplQWdhaW5zdEluc2VydHMoaW5zZXJ0cywgcm93TWdyLCBncmFw\naHNbMV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENoZWNr\nIHRvIHNlZSBpZiB0aGVyZSBpcyBhbiBpbnNlcnQgZm9yIGZvciB0aGUgc2Ft\nZSB0YWJsZSBhbmQgcHJpbWFyeQogICAgICoga2V5IHZhbHVlcyBhcyB0aGUg\nZ2l2ZW4gZGVsZXRlIHJvdy4KICAgICAqLwogICAgcHJpdmF0ZSBSb3cgZ2V0\nSW5zZXJ0Um93KE1hcCBpbnNlcnRNYXAsIFJvd01hbmFnZXJJbXBsIHJvd01n\nciwgUm93IHJvdykgewogICAgICAgIGlmIChpbnNlcnRNYXAgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20gPSByb3cuZ2V0UHJpbWFyeUtleSgpOwogICAgICAgIGlm\nIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgLy8gbG9vayBmb3IgYSBuZXcgb2JqZWN0IHdob3NlIGluc2VydCBpZCBp\ncyB0aGUgc2FtZSBhcyB0aGlzIGRlbGV0ZSBvbmUKICAgICAgICBPYmplY3Qg\nb2lkID0gc20uZ2V0T2JqZWN0SWQoKTsKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIG5zbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpbnNlcnRNYXAu\nZ2V0KG9pZCk7CiAgICAgICAgaWYgKG5zbSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gZm91bmQgbmV3IG9iamVjdDsg\nZ2V0IGl0cyByb3cKICAgICAgICByb3cgPSByb3dNZ3IuZ2V0Um93KHJvdy5n\nZXRUYWJsZSgpLCBSb3cuQUNUSU9OX0lOU0VSVCwgbnNtLCBmYWxzZSk7CiAg\nICAgICAgcmV0dXJuIChyb3cgPT0gbnVsbCB8fCByb3cuaXNWYWxpZCgpKSA/\nIHJvdyA6IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbmFseXplIHRo\nZSBnaXZlbiByb3dzIGFnYWluc3QgdGhlIGluc2VydHMsIHBsYWNpbmcgZGVw\nZW5kZW5jaWVzCiAgICAgKiBpbiB0aGUgZ2l2ZW4gZ3JhcGguCiAgICAgKi8K\nICAgIHByaXZhdGUgR3JhcGggYW5hbHl6ZUFnYWluc3RJbnNlcnRzKENvbGxl\nY3Rpb24gcm93cywgUm93TWFuYWdlckltcGwgcm93TWdyLAogICAgICAgIEdy\nYXBoIGdyYXBoKSB7CiAgICAgICAgUHJpbWFyeVJvdyByb3c7CiAgICAgICAg\nUm93IHJvdzI7CiAgICAgICAgRm9yZWlnbktleVtdIGZrczsKICAgICAgICBD\nb2x1bW5bXSBjb2xzOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcm93\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBy\nb3cgPSAoUHJpbWFyeVJvdykgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYg\nKCFyb3cuaXNWYWxpZCgpKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICAvLyBjaGVjayB0aGlzIHJvdydzIGZrcyBhZ2FpbnN0IGlu\nc2VydHM7IGEgbG9naWNhbCBmayB0byBhbiBhdXRvLWluYwogICAgICAgICAg\nICAvLyBjb2x1bW4gaXMgdHJlYXRlZCBqdXN0IGFzIGFjdHVhbCBkYXRhYmFz\nZSBmayBiZWNhdXNlIHRoZSByZXN1bHQKICAgICAgICAgICAgLy8gaXMgdGhl\nIHNhbWU6IHRoZSBwayByb3cgaGFzIHRvIGJlIGluc2VydGVkIGJlZm9yZSB0\naGUgZmsgcm93CiAgICAgICAgICAgIGZrcyA9IHJvdy5nZXRUYWJsZSgpLmdl\ndEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBq\nIDwgZmtzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBpZiAocm93\nLmdldEZvcmVpZ25LZXlTZXQoZmtzW2pdKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIC8vIHNlZSBp\nZiB0aGlzIHJvdyBpcyBkZXBlbmRlbnQgb24gYW5vdGhlci4gIGlmIGl0J3Mg\nb25seQogICAgICAgICAgICAgICAgLy8gZGVwZW5lbnQgb24gaXRzZWxmLCBz\nZWUgaWYgdGhlIGZrIGlzIGxvZ2ljYWwgb3IgZGVmZXJyZWQsIGluCiAgICAg\nICAgICAgICAgICAvLyB3aGljaCBjYXNlIGl0IG11c3QgYmUgYW4gYXV0by1p\nbmMgYmVjYXVzZSBvdGhlcndpc2Ugd2UKICAgICAgICAgICAgICAgIC8vIHdv\ndWxkbid0IGhhdmUgcmVjb3JkZWQgaXQKICAgICAgICAgICAgICAgIHJvdzIg\nPSByb3dNZ3IuZ2V0Um93KGZrc1tqXS5nZXRQcmltYXJ5S2V5VGFibGUoKSwK\nICAgICAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX0lOU0VSVCwgcm93Lmdl\ndEZvcmVpZ25LZXlTZXQoZmtzW2pdKSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgaWYgKHJvdzIgIT0gbnVsbCAmJiByb3cyLmlzVmFsaWQoKSAmJiAocm93\nMiAhPSByb3cKICAgICAgICAgICAgICAgICAgICB8fCBma3Nbal0uaXNEZWZl\ncnJlZCgpIHx8IGZrc1tqXS5pc0xvZ2ljYWwoKSkpCiAgICAgICAgICAgICAg\nICAgICAgZ3JhcGggPSBhZGRFZGdlKGdyYXBoLCByb3csIChQcmltYXJ5Um93\nKSByb3cyLCBma3Nbal0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBzZWUgaWYgdGhlcmUgYXJlIGFueSByZWxhdGlvbiBpZCBjb2x1bW5zIGRl\ncGVuZGVudCBvbgogICAgICAgICAgICAvLyBhdXRvLWluYyBvYmplY3RzCiAg\nICAgICAgICAgIGNvbHMgPSByb3cuZ2V0VGFibGUoKS5nZXRSZWxhdGlvbklk\nQ29sdW1ucygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGNv\nbHMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20gPSByb3cuZ2V0UmVsYXRpb25JZFNldChjb2xzW2pdKTsK\nICAgICAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHJvdzIgPSByb3dN\nZ3IuZ2V0Um93KGdldEJhc2VUYWJsZShzbSksIFJvdy5BQ1RJT05fSU5TRVJU\nLAogICAgICAgICAgICAgICAgICAgIHNtLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICBpZiAocm93MiAhPSBudWxsICYmIHJvdzIuaXNWYWxpZCgpKQogICAg\nICAgICAgICAgICAgICAgIGdyYXBoID0gYWRkRWRnZShncmFwaCwgcm93LCAo\nUHJpbWFyeVJvdykgcm93MiwgY29sc1tqXSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGdyYXBoOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBiYXNlIHRhYmxlIGZvciB0aGUgZ2l2ZW4gaW5z\ndGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFRhYmxlIGdldEJh\nc2VUYWJsZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nIGNscyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRh\nKCk7CiAgICAgICAgd2hpbGUgKGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFz\nc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0\nSm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJu\nIGNscy5nZXRUYWJsZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFu\nIGVkZ2UgYmV0d2VlbiB0aGUgZ2l2ZW4gcm93cyBpbiB0aGUgZ2l2ZW4gZm9y\nZWlnbiBrZXkgZ3JhcGguCiAgICAgKi8KICAgIHByaXZhdGUgR3JhcGggYWRk\nRWRnZShHcmFwaCBncmFwaCwgUHJpbWFyeVJvdyByb3cxLCBQcmltYXJ5Um93\nIHJvdzIsCiAgICAgICAgT2JqZWN0IGZrKSB7CiAgICAgICAgLy8gZGVsYXkg\nY3JlYXRpb24gb2YgdGhlIGdyYXBoCiAgICAgICAgaWYgKGdyYXBoID09IG51\nbGwpCiAgICAgICAgICAgIGdyYXBoID0gbmV3IEdyYXBoKCk7CgogICAgICAg\nIHJvdzEuc2V0RGVwZW5kZW50KHRydWUpOwogICAgICAgIHJvdzIuc2V0RGVw\nZW5kZW50KHRydWUpOwogICAgICAgIGdyYXBoLmFkZE5vZGUocm93MSk7CiAg\nICAgICAgZ3JhcGguYWRkTm9kZShyb3cyKTsKCiAgICAgICAgLy8gYWRkIGFu\nIGVkZ2UgZnJvbSByb3cxIHRvIHJvdzIsIGFuZCBzZXQgdGhlIGZrIGNhdXNp\nbmcgdGhlCiAgICAgICAgLy8gZGVwZW5kZW5jeSBhcyB0aGUgdXNlciBvYmpl\nY3Qgc28gd2UgY2FuIHJldHJpZXZlIGl0IHdoZW4gcmVzb2x2aW5nCiAgICAg\nICAgLy8gY2lyY3VsYXIgY29uc3RyYWludHMKICAgICAgICBFZGdlIGVkZ2Ug\nPSBuZXcgRWRnZShyb3cxLCByb3cyLCB0cnVlKTsKICAgICAgICBlZGdlLnNl\ndFVzZXJPYmplY3QoZmspOwogICAgICAgIGdyYXBoLmFkZEVkZ2UoZWRnZSk7\nCgogICAgICAgIHJldHVybiBncmFwaDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZsdXNoIHRoZSBnaXZlbiBncmFwaCBvZiByb3dzIGluIHRoZSBwcm9wZXIg\nb3JkZXIuCiAgICAgKiBAcGFyYW0gZ3JhcGggVGhlIGdyYXBoIG9mIHN0YXRl\nbWVudHMgdG8gYmUgd2Fsa2VkCiAgICAgKiBAcGFyYW0gcHNNZ3IgVGhlIHBy\nZXBhcmVkIHN0YXRlbWVudCBtYW5hZ2VyIHRvIHVzZSB0byBpc3N1ZSB0aGUK\nICAgICAqIHN0YXRlbWVudHMKICAgICAqIEBwYXJhbSBhdXRvQXNzaWduIFdo\nZXRoZXIgYW55IG9mIHRoZSByb3dzIGluIHRoZSBncmFwaCBoYXZlIGFueQog\nICAgICogYXV0by1hc3NpZ24gY29uc3RyYWludHMKICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgZmx1c2hHcmFwaChHcmFwaCBncmFwaCwgUHJlcGFyZWRT\ndGF0ZW1lbnRNYW5hZ2VyIHBzTWdyLAogICAgICAgIGJvb2xlYW4gYXV0b0Fz\nc2lnbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoZ3JhcGggPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBEZXB0aEZpcnN0QW5hbHlzaXMgZGZhID0gbmV3RGVwdGhGaXJzdEFuYWx5\nc2lzKGdyYXBoLCBhdXRvQXNzaWduKTsKICAgICAgICBDb2xsZWN0aW9uIGlu\nc2VydFVwZGF0ZXMgPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAgIENvbGxl\nY3Rpb24gZGVsZXRlVXBkYXRlcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAg\nICAgYm9vbGVhbiByZWNhbGN1bGF0ZTsKCiAgICAgICAgLy8gSGFuZGxlIGNp\ncmN1bGFyIGNvbnN0cmFpbnRzOgogICAgICAgIC8vIC0gaWYgZGVsZXRlZCBy\nb3cgQSBoYXMgYSBjaXJpY3VsYXIgZmsgdG8gZGVsZXRlZCByb3cgQiwgCiAg\nICAgICAgLy8gICB0aGVuIHVzZSBhbiB1cGRhdGUgc3RhdGVtZW50IHRvIG51\nbGwgQSdzIGZrIHRvIEIgYmVmb3JlIGZsdXNoaW5nLCAKICAgICAgICAvLyAg\nIGFuZCB0aGVuIGZsdXNoCiAgICAgICAgLy8gLSBpZiBpbnNlcnRlZCByb3cg\nQSBoYXMgYSBjaXJjdWxhciBmayB0byB1cGRhdGVkL2luc2VydGVkIHJvdyBC\nLAogICAgICAgIC8vICAgdGhlbiBudWxsIHRoZSBmayBpbiB0aGUgQiByb3cg\nb2JqZWN0LCB0aGVuIGZsdXNoLAogICAgICAgIC8vICAgYW5kIGFmdGVyIGZs\ndXNoaW5nLCB1c2UgYW4gdXBkYXRlIHRvIHNldCB0aGUgZmsgYmFjayB0byBB\nCiAgICAgICAgLy8gRGVwZW5kaW5nIG9uIHdoZXJlIGNpcmN1bGFyIGRlcGVu\nZGVuY2llcyBhcmUgYnJva2VuLCB0aGUgIAogICAgICAgIC8vIHRvcG9sb2dp\nY2FsIG9yZGVyIG9mIHRoZSBncmFwaCBub2RlcyBoYXMgdG8gYmUgcmUtY2Fs\nY3VsYXRlZC4KICAgICAgICByZWNhbGN1bGF0ZSA9IHJlc29sdmVDeWNsZXMo\nZ3JhcGgsIGRmYS5nZXRFZGdlcyhFZGdlLlRZUEVfQkFDSyksCiAgICAgICAg\nICAgICAgICBkZWxldGVVcGRhdGVzLCBpbnNlcnRVcGRhdGVzKTsKICAgICAg\nICByZWNhbGN1bGF0ZSB8PSByZXNvbHZlQ3ljbGVzKGdyYXBoLCBkZmEuZ2V0\nRWRnZXMoRWRnZS5UWVBFX0ZPUldBUkQpLAogICAgICAgICAgICAgICAgZGVs\nZXRlVXBkYXRlcywgaW5zZXJ0VXBkYXRlcyk7CgogICAgICAgIGlmIChyZWNh\nbGN1bGF0ZSkgewogICAgICAgICAgICBkZmEgPSByZWNhbGN1bGF0ZURlcHRo\nRmlyc3RBbmFseXNpcyhncmFwaCwgYXV0b0Fzc2lnbik7CiAgICAgICAgfQoK\nICAgICAgICAvLyBmbHVzaCBkZWxldGUgdXBkYXRlcyB0byBudWxsIGZrcywg\ndGhlbiBhbGwgcm93cyBpbiBvcmRlciwgdGhlbgogICAgICAgIC8vIHRoZSBp\nbnNlcnQgdXBkYXRlcyB0byBzZXQgY2lyY3VsYXIgZmsgdmFsdWVzCiAgICAg\nICAgZmx1c2goZGVsZXRlVXBkYXRlcywgcHNNZ3IpOwogICAgICAgIENvbGxl\nY3Rpb24gbm9kZXMgPSBkZmEuZ2V0U29ydGVkTm9kZXMoKTsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IG5vZGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KQogICAgICAgICAgICBwc01nci5mbHVzaCgoUm93SW1wbCkgaXRy\nLm5leHQoKSk7CiAgICAgICAgZmx1c2goaW5zZXJ0VXBkYXRlcywgcHNNZ3Ip\nOwogICAgfQoKICAgIC8qKgogICAgICogQnJlYWsgYSBjaXJjdWxhciBkZXBl\nbmRlbmN5IGNhdXNlZCBieSBkZWxldGUgb3BlcmF0aW9ucy4KICAgICAqIElm\nIGRlbGV0ZWQgcm93IEEgaGFzIGEgY2lyaWN1bGFyIGZrIHRvIGRlbGV0ZWQg\ncm93IEIsIHRoZW4gdXNlIGFuIHVwZGF0ZSAKICAgICAqIHN0YXRlbWVudCB0\nbyBudWxsIEEncyBmayB0byBCIGJlZm9yZSBkZWxldGluZyBCLCB0aGVuIGRl\nbGV0ZSBBLgogICAgICogQHBhcmFtIGVkZ2UgRWRnZSBpbiB0aGUgZGVwZW5k\nZW5jeSBncmFwaCBjb3JyZXNwb25kaW5nIHRvIGEgZm9yZWlnbiBrZXkKICAg\nICAqIGNvbnN0cmFpbnQuIFRoaXMgZGVwZW5kZW5jeSBpcyBicm9rZW4gYnkg\nbnVsbGlmeWluZyB0aGUgZm9yZWlnbiBrZXkuCiAgICAgKiBAcGFyYW0gZGVs\nZXRlVXBkYXRlcyBDb2xsZWN0aW9uIG9mIHVwZGF0ZSBzdGF0ZW1lbnRzIHRo\nYXQgYXJlIGV4ZWN1dGVkCiAgICAgKiBiZWZvcmUgdGhlIGRlbGV0ZSBvcGVy\nYXRpb25zIGFyZSBmbHVzaGVkIAogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkRGVsZXRlVXBkYXRlKEVkZ2UgZWRnZSwgQ29sbGVjdGlvbiBkZWxldGVV\ncGRhdGVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIFByaW1hcnlSb3cgcm93OwogICAgICAgIFJvd0ltcGwgdXBkYXRlOwogICAg\nICAgIEZvcmVpZ25LZXkgZms7CgogICAgICAgIC8vIGNvcHkgd2hlcmUgY29u\nZGl0aW9ucyBpbnRvIG5ldyB1cGRhdGUgdGhhdCBudWxscyB0aGUgZmsKICAg\nICAgICByb3cgPSAoUHJpbWFyeVJvdykgZWRnZS5nZXRUbygpOwogICAgICAg\nIHVwZGF0ZSA9IG5ldyBQcmltYXJ5Um93KHJvdy5nZXRUYWJsZSgpLCBSb3cu\nQUNUSU9OX1VQREFURSwgbnVsbCk7CiAgICAgICAgcm93LmNvcHlJbnRvKHVw\nZGF0ZSwgdHJ1ZSk7CiAgICAgICAgaWYgKGVkZ2UuZ2V0VXNlck9iamVjdCgp\nIGluc3RhbmNlb2YgRm9yZWlnbktleSkgewogICAgICAgICAgICBmayA9IChG\nb3JlaWduS2V5KSBlZGdlLmdldFVzZXJPYmplY3QoKTsKICAgICAgICAgICAg\ndXBkYXRlLnNldEZvcmVpZ25LZXkoZmssIHJvdy5nZXRGb3JlaWduS2V5SU8o\nZmspLCBudWxsKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgdXBkYXRl\nLnNldE51bGwoKENvbHVtbikgZWRnZS5nZXRVc2VyT2JqZWN0KCkpOwoKICAg\nICAgICBkZWxldGVVcGRhdGVzLmFkZCh1cGRhdGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQnJlYWsgYSBjaXJjdWxhciBkZXBlbmRlbmN5IGNhdXNlZCBi\neSBpbnNlcnQgb3BlcmF0aW9ucy4KICAgICAqIElmIGluc2VydGVkIHJvdyBB\nIGhhcyBhIGNpcmN1bGFyIGZrIHRvIHVwZGF0ZWQvaW5zZXJ0ZWQgcm93IEIs\nCiAgICAgKiB0aGVuIG51bGwgdGhlIGZrIGluIHRoZSBCIHJvdyBvYmplY3Qs\nIHRoZW4gZmx1c2gsCiAgICAgKiBhbmQgYWZ0ZXIgZmx1c2hpbmcsIHVzZSBh\nbiB1cGRhdGUgdG8gc2V0IHRoZSBmayBiYWNrIHRvIEEuCiAgICAgKiBAcGFy\nYW0gcm93IFJvdyB0byBiZSBmbHVzaGVkCiAgICAgKiBAcGFyYW0gZWRnZSBF\nZGdlIGluIHRoZSBkZXBlbmRlbmN5IGdyYXBoIGNvcnJlc3BvbmRpbmcgdG8g\nYSBmb3JlaWduIGtleQogICAgICogY29uc3RyYWludC4gVGhpcyBkZXBlbmRl\nbmN5IGlzIGJyb2tlbiBieSBudWxsaWZ5aW5nIHRoZSBmb3JlaWduIGtleS4K\nICAgICAqIEBwYXJhbSBpbnNlcnRVcGRhdGVzIENvbGxlY3Rpb24gb2YgdXBk\nYXRlIHN0YXRlbWVudHMgdGhhdCBhcmUgZXhlY3V0ZWQKICAgICAqIGFmdGVy\nIHRoZSBpbnNlcnQvdXBkYXRlIG9wZXJhdGlvbnMgYXJlIGZsdXNoZWQgCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRJbnNlcnRVcGRhdGUoUHJpbWFy\neVJvdyByb3csIEVkZ2UgZWRnZSwKICAgICAgICBDb2xsZWN0aW9uIGluc2Vy\ndFVwZGF0ZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFJvd0lt\ncGwgdXBkYXRlOwogICAgICAgIEZvcmVpZ25LZXkgZms7CiAgICAgICAgQ29s\ndW1uIGNvbDsKCiAgICAgICAgLy8gY29weSB3aGVyZSBjb25kaXRpb25zIGlu\ndG8gbmV3IHVwZGF0ZSB0aGF0IHNldHMgdGhlIGZrCiAgICAgICAgdXBkYXRl\nID0gbmV3IFByaW1hcnlSb3cocm93LmdldFRhYmxlKCksIFJvdy5BQ1RJT05f\nVVBEQVRFLCBudWxsKTsKICAgICAgICBpZiAocm93LmdldEFjdGlvbigpID09\nIFJvdy5BQ1RJT05fSU5TRVJUKSB7CiAgICAgICAgICAgIGlmIChyb3cuZ2V0\nUHJpbWFyeUtleSgpID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoInJlZi1jeWNsZSIpKTsK\nICAgICAgICAgICAgdXBkYXRlLndoZXJlUHJpbWFyeUtleShyb3cuZ2V0UHJp\nbWFyeUtleSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBS\nb3cuQUNUSU9OX1VQREFURQogICAgICAgICAgICByb3cuY29weUludG8odXBk\nYXRlLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGVkZ2UuZ2V0VXNl\nck9iamVjdCgpIGluc3RhbmNlb2YgRm9yZWlnbktleSkgewogICAgICAgICAg\nICBmayA9IChGb3JlaWduS2V5KSBlZGdlLmdldFVzZXJPYmplY3QoKTsKICAg\nICAgICAgICAgdXBkYXRlLnNldEZvcmVpZ25LZXkoZmssIHJvdy5nZXRGb3Jl\naWduS2V5SU8oZmspLAogICAgICAgICAgICAgICAgcm93LmdldEZvcmVpZ25L\nZXlTZXQoZmspKTsKICAgICAgICAgICAgcm93LmNsZWFyRm9yZWlnbktleShm\nayk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29sID0gKENvbHVt\nbikgZWRnZS5nZXRVc2VyT2JqZWN0KCk7CiAgICAgICAgICAgIHVwZGF0ZS5z\nZXRSZWxhdGlvbklkKGNvbCwgcm93LmdldFJlbGF0aW9uSWRTZXQoY29sKSwK\nICAgICAgICAgICAgICAgIHJvdy5nZXRSZWxhdGlvbklkQ2FsbGJhY2soY29s\nKSk7CiAgICAgICAgICAgIHJvdy5jbGVhclJlbGF0aW9uSWQoY29sKTsKICAg\nICAgICB9CgogICAgICAgIGluc2VydFVwZGF0ZXMuYWRkKHVwZGF0ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGaW5kcyBhIG51bGxhYmxlIGZvcmVpZ24g\na2V5IGJ5IHdhbGtpbmcgdGhlIGRlcGVuZGVuY3kgY3ljbGUuIAogICAgICog\nQ2lyY3VsYXIgZGVwZW5kZW5jaWVzIGNhbiBiZSBicm9rZW4gYXQgdGhpcyBw\nb2ludC4KICAgICAqIEBwYXJhbSBjeWNsZSBDeWNsZSBpbiB0aGUgZGVwZW5k\nZW5jeSBncmFwaC4KICAgICAqIEByZXR1cm4gRWRnZSBjb3JyZXNwb25kaW5n\nIHRvIGEgbnVsbGFibGUgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHByaXZh\ndGUgRWRnZSBmaW5kQnJlYWthYmxlTGluayhMaXN0IGN5Y2xlKSB7CiAgICAg\nICAgRWRnZSBicmVha2FibGVMaW5rID0gbnVsbDsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ZXIgPSBjeWNsZS5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQo\nKTsgKSB7CiAgICAgICAgICAgIEVkZ2UgZWRnZSA9IChFZGdlKSBpdGVyLm5l\neHQoKTsKICAgICAgICAgICAgT2JqZWN0IHVzZXJPYmplY3QgPSBlZGdlLmdl\ndFVzZXJPYmplY3QoKTsKICAgICAgICAgICAgaWYgKHVzZXJPYmplY3QgaW5z\ndGFuY2VvZiBGb3JlaWduS2V5KSB7CiAgICAgICAgICAgICAgICAgaWYgKCEo\nKEZvcmVpZ25LZXkpIHVzZXJPYmplY3QpLmhhc05vdE51bGxDb2x1bW5zKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgYnJlYWthYmxlTGluayA9IGVkZ2U7\nCiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh1c2VyT2JqZWN0IGluc3RhbmNl\nb2YgQ29sdW1uKSB7CiAgICAgICAgICAgICAgICBpZiAoISgoQ29sdW1uKSB1\nc2VyT2JqZWN0KS5pc05vdE51bGwoKSkgewogICAgICAgICAgICAgICAgICAg\nIGJyZWFrYWJsZUxpbmsgPSBlZGdlOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBicmVha2FibGVMaW5rOwogICAgfQoKICAgIC8q\nKgogICAgICogUmUtY2FsY3VsYXRlcyB0aGUgRGVwdGhGaXJzdFNlYXJjaCBh\nbmFseXNpcyBvZiB0aGUgZ3JhcGggCiAgICAgKiBhZnRlciBzb21lIG9mIHRo\nZSBlZGdlcyBoYXZlIGJlZW4gcmVtb3ZlZC4gRW5zdXJlcwogICAgICogdGhh\ndCB0aGUgZGVwZW5kZW5jeSBncmFwaCBpcyBjeWNsZSBmcmVlLgogICAgICog\nQHBhcmFtIGdyYXBoIFRoZSBncmFwaCBvZiBzdGF0ZW1lbnRzIHRvIGJlIHdh\nbGtlZAogICAgICogQHBhcmFtIGF1dG9Bc3NpZ24gV2hldGhlciBhbnkgb2Yg\ndGhlIHJvd3MgaW4gdGhlIGdyYXBoIGhhdmUgYW55CiAgICAgKiBhdXRvLWFz\nc2lnbiBjb25zdHJhaW50cwogICAgICovCiAgICBwcml2YXRlIERlcHRoRmly\nc3RBbmFseXNpcyByZWNhbGN1bGF0ZURlcHRoRmlyc3RBbmFseXNpcyhHcmFw\naCBncmFwaCwKICAgICAgICBib29sZWFuIGF1dG9Bc3NpZ24pIHsKICAgICAg\nICBEZXB0aEZpcnN0QW5hbHlzaXMgZGZhOwogICAgICAgIC8vIGNsZWFyIHBy\nZXZpb3VzIHRyYXZlcnNhbCBkYXRhCiAgICAgICAgZ3JhcGguY2xlYXJUcmF2\nZXJzYWwoKTsKICAgICAgICBkZmEgPSBuZXdEZXB0aEZpcnN0QW5hbHlzaXMo\nZ3JhcGgsIGF1dG9Bc3NpZ24pOwogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0\nIHRoZSBncmFwaCBpcyBub24tY3ljbGljIG5vdwogICAgICAgIGFzc2VydCAo\nZGZhLmhhc05vQ3ljbGVzKCkpOiBfbG9jLmdldCgiZ3JhcGgtbm90LWN5Y2xl\nLWZyZWUiKTsKICAgICAgICByZXR1cm4gZGZhOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVzb2x2ZSBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYnkgaWRlbnRp\nZnlpbmcgYW5kIGJyZWFraW5nCiAgICAgKiBhIG51bGxhYmxlIGZvcmVpZ24g\na2V5LgogICAgICogQHBhcmFtIGdyYXBoIERlcGVuZGVuY3kgZ3JhcGguCiAg\nICAgKiBAcGFyYW0gZWRnZXMgQ29sbGVjdGlvbiBvZiBlZGdlcy4gRWFjaCBl\nZGdlIGluZGljYXRlcyBhIHBvc3NpYmxlIAogICAgICogY2lyY3VsYXIgZGVw\nZW5kZW5jeQogICAgICogQHBhcmFtIGRlbGV0ZVVwZGF0ZXMgQ29sbGVjdGlv\nbiBvZiB1cGRhdGUgb3BlcmF0aW9ucyAobnVsbGlmeWluZyAKICAgICAqIGZv\ncmVpZ24ga2V5cykgdG8gYmUgZmlsbGVkLiBUaGVzZSB1cGRhdGVzIHdpbGwg\nYmUgZXhlY3V0ZWQgYmVmb3JlIAogICAgICogdGhlIHJvd3MgaW4gdGhlIGRl\ncGVuZGVuY3kgZ3JhcGggYXJlIGZsdXNoZWQKICAgICAqIEBwYXJhbSBpbnNl\ncnRVcGRhdGVzIENDb2xsZWN0aW9uIG9mIHVwZGF0ZSBvcGVyYXRpb25zIChu\ndWxsaWZ5aW5nIAogICAgICogZm9yZWlnbiBrZXlzKSB0byBiZSBmaWxsZWQu\nIFRoZXNlIHVwZGF0ZXMgd2lsbCBiZSBleGVjdXRlZCBhZnRlciAKICAgICAq\nIHRoZSByb3dzIGluIHRoZSBkZXBlbmRlbmN5IGdyYXBoIGFyZSBmbHVzaGVk\nCiAgICAgKiBAcmV0dXJuIERlcGVuZGluZyBvbiB3aGVyZSBjaXJjdWxhciBk\nZXBlbmRlbmNpZXMgYXJlIGJyb2tlbiwgdGhlICAKICAgICAqIHRvcG9sb2dp\nY2FsIG9yZGVyIG9mIHRoZSBncmFwaCBub2RlcyBoYXMgdG8gYmUgcmUtY2Fs\nY3VsYXRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHJlc29sdmVD\neWNsZXMoR3JhcGggZ3JhcGgsIENvbGxlY3Rpb24gZWRnZXMsCiAgICAgICAg\nQ29sbGVjdGlvbiBkZWxldGVVcGRhdGVzLCBDb2xsZWN0aW9uIGluc2VydFVw\nZGF0ZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nYm9vbGVhbiByZWNhbGN1bGF0ZSA9IGZhbHNlOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gZWRnZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgRWRnZSBlZGdlID0gKEVkZ2UpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIExpc3QgY3ljbGUgPSBlZGdlLmdldEN5Y2xlKCk7Cgog\nICAgICAgICAgICBpZiAoY3ljbGUgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgLy8gZmluZCBhIG51bGxhYmxlIGZvcmVpZ24ga2V5CiAgICAgICAgICAg\nICAgICBFZGdlIGJyZWFrYWJsZUxpbmsgPSBmaW5kQnJlYWthYmxlTGluayhj\neWNsZSk7CiAgICAgICAgICAgICAgICBpZiAoYnJlYWthYmxlTGluayA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLW51bGxhYmxlLWZrIikpOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHRvcG9sb2dpYyBub2RlIG9y\nZGVyIG11c3QgYmUgcmUtY2FsY3VsYXRlZCwgIGlmIHRoZQogICAgICAgICAg\nICAgICAgLy8gYnJlYWthYmxlIGxpbmsgaXMgZGlmZmVyZW50IGZyb20gdGhl\nIGVkZ2Ugd2hlcmUKICAgICAgICAgICAgICAgIC8vIHRoZSBjaXJjdWxhciBk\nZXBlbmRlbmN5IHdhcyBvcmlnaW5hbGx5IGRldGVjdGVkCiAgICAgICAgICAg\nICAgICBpZiAoZWRnZSAhPSBicmVha2FibGVMaW5rKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmVjYWxjdWxhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIGlmICghYnJlYWthYmxlTGluay5pc1JlbW92\nZWRGcm9tR3JhcGgoKSkgewoKICAgICAgICAgICAgICAgICAgICAvLyB1c2Ug\nYSBwcmltYXJ5IHJvdyB1cGRhdGUgdG8gcHJldmVudCBzZXR0aW5nIHBrIGFu\nZCBmayB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAvLyB1bnRpbCBhZnRl\nciBmbHVzaCwgdG8gZ2V0IGxhdGVzdCBhdXRvLWluY3JlbWVudCB2YWx1ZXMK\nICAgICAgICAgICAgICAgICAgICBQcmltYXJ5Um93IHJvdyA9IChQcmltYXJ5\nUm93KSBicmVha2FibGVMaW5rLmdldEZyb20oKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAocm93LmdldEFjdGlvbigpID09IFJvdy5BQ1RJT05fREVMRVRF\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERlbGV0ZVVwZGF0ZShi\ncmVha2FibGVMaW5rLCBkZWxldGVVcGRhdGVzKTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRJbnNl\ncnRVcGRhdGUocm93LCBicmVha2FibGVMaW5rLCBpbnNlcnRVcGRhdGVzKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ3Jh\ncGgucmVtb3ZlRWRnZShicmVha2FibGVMaW5rKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVj\nYWxjdWxhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\ne0BsaW5rIERlcHRoRmlyc3RBbmFseXNpc30gc3VpdGFibGUgZm9yIHRoZSBn\naXZlbiBncmFwaAogICAgICogYW5kIGF1dG8tYXNzaWduIHNldHRpbmdzLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgRGVwdGhGaXJzdEFuYWx5c2lzIG5ld0Rl\ncHRoRmlyc3RBbmFseXNpcyhHcmFwaCBncmFwaCwKICAgICAgICBib29sZWFu\nIGF1dG9Bc3NpZ24pIHsKICAgICAgICByZXR1cm4gbmV3IERlcHRoRmlyc3RB\nbmFseXNpcyhncmFwaCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCB0\naGUgZ2l2ZW4gY29sbGVjdGlvbiBvZiBzZWNvbmRhcnkgcm93cy4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgZmx1c2goQ29sbGVjdGlvbiByb3dzLCBQ\ncmVwYXJlZFN0YXRlbWVudE1hbmFnZXIgcHNNZ3IpIHsKICAgICAgICBpZiAo\ncm93cy5zaXplKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBSb3dJbXBsIHJvdzsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHJv\nd3MuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgKSB7CiAgICAgICAgICAg\nIHJvdyA9IChSb3dJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\ncm93LmlzVmFsaWQoKSAmJiAhcm93LmlzRGVwZW5kZW50KCkpCiAgICAgICAg\nICAgICAgICBwc01nci5mbHVzaChyb3cpOwogICAgICAgIH0KICAgIH0KfQ==\n","encoding":"base64"}

