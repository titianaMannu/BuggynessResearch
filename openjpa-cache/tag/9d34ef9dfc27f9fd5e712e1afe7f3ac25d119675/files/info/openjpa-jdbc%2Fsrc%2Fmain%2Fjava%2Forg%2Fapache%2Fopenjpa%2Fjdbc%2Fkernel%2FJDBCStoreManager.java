{"sha":"d1eda4e92084551003ff194530a53dfeb60652df","node_id":"MDQ6QmxvYjIwNjM2NDpkMWVkYTRlOTIwODQ1NTEwMDNmZjE5NDUzMGE1M2RmZWI2MDY1MmRm","size":67750,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d1eda4e92084551003ff194530a53dfeb60652df","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3Rh\ndGVtZW50OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQg\namF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsK\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5j\nZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3Jw\naGFuZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuY29uZi5RdWVyeVNRTENhY2hlVmFsdWU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRv\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5W\nYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5Kb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU1FMRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU2VsZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuTG9ja01hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TZXE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25Q\nYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuRGVs\nZWdhdGluZ0Nvbm5lY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmpkYmMuRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdTdGF0ZW1l\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5NZXJnZWRSZXN1bHRP\nYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ncm9wLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIFN0b3JlTWFuYWdl\nciBwbHVnaW4gdGhhdCB1c2VzIEpEQkMgdG8gc3RvcmUgcGVyc2lzdGVudCBk\nYXRhIGluIGEKICogcmVsYXRpb25hbCBkYXRhIHN0b3JlLgogKgogKiBAYXV0\naG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3Mg\nSkRCQ1N0b3JlTWFuYWdlciAKICAgIGltcGxlbWVudHMgU3RvcmVNYW5hZ2Vy\nLCBKREJDU3RvcmUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoSkRC\nQ1N0b3JlTWFuYWdlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBTdG9yZUNvbnRl\neHQgX2N0eCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkNDb25maWd1cmF0aW9u\nIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgREJEaWN0aW9uYXJ5IF9kaWN0\nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMRmFjdG9yeSBfc3FsID0gbnVsbDsK\nICAgIHByaXZhdGUgSkRCQ0xvY2tNYW5hZ2VyIF9sbSA9IG51bGw7CiAgICBw\ncml2YXRlIERhdGFTb3VyY2UgX2RzID0gbnVsbDsKICAgIHByaXZhdGUgUmVm\nQ291bnRDb25uZWN0aW9uIF9jb25uID0gbnVsbDsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfYWN0aXZlID0gZmFsc2U7CgogICAgLy8gdHJhY2sgdGhlIHBlbmRp\nbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRoZW0KICAgIHByaXZh\ndGUgU2V0IF9zdG1udHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRTZXQo\nbmV3IEhhc2hTZXQoKSk7CiAgICAKICAgIHByaXZhdGUgTWFwIF9zcWxDYWNo\nZSA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2lzUXVlcnlTUUxDYWNo\nZSA9IHRydWU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgX251\nbGxDYWNoZVZhbHVlID0gbmV3IE9iamVjdCgpOwogICAgCiAgICBwdWJsaWMg\nU3RvcmVDb250ZXh0IGdldENvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9j\ndHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNv\nbnRleHQgY3R4KSB7CiAgICAgICAgc2V0Q29udGV4dChjdHgsIChKREJDQ29u\nZmlndXJhdGlvbikgY3R4LmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIHNldENvbnRleHQoU3RvcmVDb250ZXh0IGN0\neCwgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jdHggPSBj\ndHg7CiAgICAgICAgX2NvbmYgPSBjb25mOwogICAgICAgIF9kaWN0ID0gX2Nv\nbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBfc3FsID0g\nX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCk7CgogICAgICAgIExvY2tN\nYW5hZ2VyIGxtID0gY3R4LmdldExvY2tNYW5hZ2VyKCk7CiAgICAgICAgaWYg\nKGxtIGluc3RhbmNlb2YgSkRCQ0xvY2tNYW5hZ2VyKQogICAgICAgICAgICBf\nbG0gPSAoSkRCQ0xvY2tNYW5hZ2VyKSBsbTsKCiAgICAgICAgaWYgKCFjdHgu\naXNNYW5hZ2VkKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVN\nYW5hZ2VkKCkpCiAgICAgICAgICAgIF9kcyA9IF9jb25mLmdldERhdGFTb3Vy\nY2UyKGN0eCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHMgPSBfY29u\nZi5nZXREYXRhU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRV\ncGRhdGVNYW5hZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAg\nICAgIGN0eC5zZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgICAgICAK\nICAgICAgICBfc3FsQ2FjaGUgPSBfY29uZi5nZXRRdWVyeVNRTENhY2hlSW5z\ndGFuY2UoKTsKICAgICAgICBfaXNRdWVyeVNRTENhY2hlID0gX2NvbmYuaXNR\ndWVyeVNRTENhY2hlT24oKTsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0NvbmZp\nZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4g\nX2NvbmY7CiAgICB9CgogICAgcHVibGljIERCRGljdGlvbmFyeSBnZXREQkRp\nY3Rpb25hcnkoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0OwogICAgfQoKICAg\nIHB1YmxpYyBTUUxGYWN0b3J5IGdldFNRTEZhY3RvcnkoKSB7CiAgICAgICAg\ncmV0dXJuIF9zcWw7CiAgICB9CgogICAgcHVibGljIEpEQkNMb2NrTWFuYWdl\nciBnZXRMb2NrTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX2xtOwogICAg\nfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGdldEZldGNo\nQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gKEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24pIF9jdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5PcHRpbWlzdGljKCkgewogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrT3B0aW1pc3RpYygpIHsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBfYWN0aXZl\nID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKCFfY3R4\nLmlzTWFuYWdlZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9k\nZU1hbmFnZWQoKSkKICAgICAgICAgICAgICAgICYmIF9jb25uLmdldEF1dG9D\nb21taXQoKSkKICAgICAgICAgICAgICAgIF9jb25uLnNldEF1dG9Db21taXQo\nZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIHRocm93\nIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICghX2N0eC5pc01hbmFnZWQoKSB8fCAhX2Nv\nbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkpCiAgICAgICAg\nICAgICAgICBfY29ubi5jb21taXQoKTsKICAgICAgICB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIF9jb25uLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZTIpIHsKICAgICAgICAgICAgfQogICAgICAgICAgICB0\naHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2FjdGl2ZSA9IGZhbHNlOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsK\nICAgICAgICAvLyBhbHJlYWR5IHJvbGxlZCBiYWNrIG91cnNlbHZlcz8KICAg\nICAgICBpZiAoIV9hY3RpdmUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9jb25uICE9IG51bGwKICAgICAg\nICAgICAgICAgICYmICghX2N0eC5pc01hbmFnZWQoKSB8fCAhX2NvbmYKICAg\nICAgICAgICAgICAgICAgICAuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5h\nZ2VkKCkpKQogICAgICAgICAgICAgICAgX2Nvbm4ucm9sbGJhY2soKTsKICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\ndGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBmYWxzZTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmV0YWluQ29ubmVj\ndGlvbigpIHsKICAgICAgICBjb25uZWN0KGZhbHNlKTsKICAgICAgICBfY29u\nbi5zZXRSZXRhaW4odHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVs\nZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKF9jb25uICE9IG51bGwp\nCiAgICAgICAgICAgIF9jb25uLnNldFJldGFpbihmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBnZXRDbGllbnRDb25uZWN0aW9uKCkgewogICAg\nICAgIHJldHVybiBuZXcgQ2xpZW50Q29ubmVjdGlvbihnZXRDb25uZWN0aW9u\nKCkpOwogICAgfQoKICAgIHB1YmxpYyBDb25uZWN0aW9uIGdldENvbm5lY3Rp\nb24oKSB7CiAgICAgICAgY29ubmVjdCh0cnVlKTsKICAgICAgICByZXR1cm4g\nX2Nvbm47CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBEYXRhU291cmNlIGdl\ndERhdGFTb3VyY2UoKSB7CiAgICAJcmV0dXJuIF9kczsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29uZGl0\naW9ucyBvbiBiYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNsYXNz\nCiAgICAgICAgLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNt\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIGV4aXN0cyhtYXBwaW5n\nLCBzbS5nZXRPYmplY3RJZCgpLCBjb250ZXh0KTsKICAgIH0KCiAgICBwcml2\nYXRlIGJvb2xlYW4gZXhpc3RzKENsYXNzTWFwcGluZyBtYXBwaW5nLCBPYmpl\nY3Qgb2lkLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIGFkZCB3aGVy\nZSBjb25kaXRpb25zIG9uIGJhc2UgY2xhc3MgdG8gYXZvaWQgam9pbnMgaWYg\nc3ViY2xhc3MKICAgICAgICAvLyBkb2Vzbid0IHVzZSBvaWQgYXMgaWRlbnRp\nZmllcgogICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwog\nICAgICAgIHdoaWxlIChtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBw\naW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwoKICAgICAg\nICBzZWwud2hlcmVQcmltYXJ5S2V5KG9pZCwgbWFwcGluZywgdGhpcyk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHNlbC5nZXRDb3VudCh0\naGlzKSAhPSAwOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNl\nLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHN5bmNWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xh\nc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHJldHVybiBtYXBwaW5nLmdldFZlcnNpb24oKS5jaGVja1Zl\ncnNpb24oc20sIHRoaXMsIHRydWUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25z\nLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBpbnQgY29tcGFyZVZlcnNpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBz\ndGF0ZSwgT2JqZWN0IHYxLCBPYmplY3QgdjIpIHsKICAgICAgICBDbGFzc01h\ncHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHN0YXRlLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmNv\nbXBhcmVWZXJzaW9uKHYxLCB2Mik7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaW5pdGlhbGl6ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRl\nIHN0YXRlLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0g\nKENvbm5lY3Rpb25JbmZvKSBjb250ZXh0OwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBpbml0aWFsaXplU3RhdGUoc20sIHN0YXRlLCAoSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbikgZmV0Y2gsIAogICAgICAgICAgICAgICAg\naW5mbyk7CiAgICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlv\nbiBjbmZlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBf\nZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlh\nbGl6ZSBhIG5ld2x5LWxvYWRlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaW5pdGlhbGl6ZVN0YXRlKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIFBDU3RhdGUgc3RhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgQ29ubmVjdGlvbkluZm8gaW5mbykKICAgICAg\nICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0T2JqZWN0SWQoKTsKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNt\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBp\nbmZvLnJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXMgPSBp\nbmZvLnJlc3VsdDsKICAgICAgICAgICAgICAgIGluZm8uc20gPSBzbTsKICAg\nICAgICAgICAgICAgIGlmIChpbmZvLm1hcHBpbmcgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAg\nICAgICAgICAgbWFwcGluZyA9IGluZm8ubWFwcGluZzsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQKICAgICAgICAg\nICAgICAgICYmICEoKE9wZW5KUEFJZCkgb2lkKS5oYXNTdWJjbGFzc2VzKCkp\nIHsKICAgICAgICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9h\nZChzbSwgbWFwcGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAgICAgICAg\nIGlmIChjdXN0b20gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gY3VzdG9tLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAgICAgcmVz\nID0gZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBmZXRj\naCwKICAgICAgICAgICAgICAgICAgICBTZWxlY3QuU1VCU19FWEFDVCk7CiAg\nICAgICAgICAgICAgICBpZiAocmVzID09IG51bGwgJiYgIXNlbGVjdFByaW1h\ncnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eVJl\nc3VsdChyZXMpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZ1tdIG1hcHBpbmdzID0gbWFwcGluZy4KICAgICAgICAgICAgICAgICAg\nICBnZXRJbmRlcGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgICAg\nICAgICAgICAgaWYgKG1hcHBpbmdzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAg\nICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmdzWzBdOwogICAgICAgICAg\nICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9hZChzbSwgbWFw\ncGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nY3VzdG9tICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBjdXN0b20uYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAg\ncmVzID0gZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBm\nZXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0LlNVQlNfQU5Z\nX0pPSU5BQkxFKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzID09IG51\nbGwgJiYgIXNlbGVjdFByaW1hcnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0\nSW5pdGlhbGl6ZVN0YXRlVW5pb25SZXN1bHQoc20sIG1hcHBpbmcsIG1hcHBp\nbmdzLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaCk7CiAgICAgICAg\nICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChyZXMpKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gZmlndXJlIG91dCB3aGF0IHR5cGUgb2Ygb2JqZWN0IHRoaXMgaXM7\nIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAgICAgICAgIC8vIG9ubHkgZ3VhcmFu\ndGVlcyB0byBwcm92aWRlIGEgYmFzZSBjbGFzcwogICAgICAgICAgICBDbGFz\ncyB0eXBlOwogICAgICAgICAgICBpZiAoKHR5cGUgPSBnZXRUeXBlKHJlcywg\nbWFwcGluZykpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXMu\nZ2V0QmFzZU1hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIG1hcHBpbmcgPSByZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICAgICAg\nICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KG1hcHBpbmcuZ2V0RGlzY3JpbWlu\nYXRvcigpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgdHlwZSA9IG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpLmdldENs\nYXNzKHRoaXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ncyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgICAgIHJlcy5lbmREYXRhUmVxdWVzdCgpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFsaXplIHRo\nZSBzdGF0ZSBtYW5hZ2VyOyB0aGlzIG1heSBjaGFuZ2UgdGhlIG1hcHBpbmcK\nICAgICAgICAgICAgLy8gYW5kIHRoZSBvYmplY3QgaWQgaW5zdGFuY2UgaWYg\ndGhlIHR5cGUgYXMgZGV0ZXJtaW5lZAogICAgICAgICAgICAvLyBmcm9tIHRo\nZSBpbmRpY2F0b3IgaXMgYSBzdWJjbGFzcyBvZiBleHBlY3RlZCB0eXBlCiAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUodHlwZSwgc3RhdGUpOwoKICAgICAg\nICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBpbmZvLnJlc3VsdCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkQnlGaWVs\nZE1hcHBpbmcgPSBpbmZvLnJlc3VsdC4KICAgICAgICAgICAgICAgICAgICBn\nZXRNYXBwZWRCeUZpZWxkTWFwcGluZygpOwogICAgICAgICAgICAgICAgT2Jq\nZWN0IG1hcHBlZEJ5T2JqZWN0ID0gaW5mby5yZXN1bHQuZ2V0TWFwcGVkQnlW\nYWx1ZSgpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5RmllbGRNYXBw\naW5nICE9IG51bGwgJiYgbWFwcGVkQnlPYmplY3QgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBpZiAobWFwcGVkQnlPYmplY3QgaW5zdGFuY2VvZiBP\ncGVuSlBBSWQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZy5n\nZXRFeHRyYUZpZWxkRGF0YUluZGV4KG1hcHBlZEJ5RmllbGRNYXBwaW5nLgog\nICAgICAgICAgICAgICAgICAgICAgICBnZXRJbmRleCgpKSAhPSAtMSkKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGludmVyc2UgcmVsYXRpb24g\nY2FuIG5vdCBiZSBzZXQgc2luY2UKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gd2UgYXJlIGVhZ2VybHkgbG9hZGluZyB0aGlzIHNtIGZvcgogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBhIHNtIG93bmVyIHRoYXQgaXMgc3RpbGwg\naW4gdGhlIHByb2Nlc3Mgb2YgCiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGluaXRpYWxpemluZyBpdHNlbGYuCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIFJlbWVtYmVyIG93bmVyIG9pZCBieSBzZXRJbnRlcm1lZGlhdGUoKS4K\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGludmVyc2UgcmVsYXRp\nb24gaXMgc2V0IGxhdGVyIGJ5CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIHNldEludmVyc2VSZWxhdGlvbigpIHdoZW4gdGhlIHNtIG93bmVyIGlzIGZ1\nbGx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemVkLgog\nICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRJbnRlcm1lZGlhdGUobWFw\ncGVkQnlGaWVsZE1hcHBpbmcuZ2V0SW5kZXgoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHNldE1hcHBlZEJ5\nKHNtLCBtYXBwZWRCeUZpZWxkTWFwcGluZywgbWFwcGVkQnlPYmplY3QpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGxvYWQgdGhlIHNlbGVjdGVk\nIG1hcHBpbmdzIGludG8gdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIKICAgICAg\nICAgICAgaWYgKHJlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBy\nZS1nZXQgdGhlIG1hcHBpbmcgaW4gY2FzZSB0aGUgaW5zdGFuY2Ugd2FzIGEg\nc3ViY2xhc3MKICAgICAgICAgICAgICAgIG1hcHBpbmcgPSAoQ2xhc3NNYXBw\naW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgbG9hZCht\nYXBwaW5nLCBzbSwgZmV0Y2gsIHJlcyk7CiAgICAgICAgICAgICAgICBnZXRW\nZXJzaW9uKG1hcHBpbmcsIHNtLCByZXMpOwogICAgICAgICAgICAgICAgc2V0\nSW52ZXJzZVJlbGF0aW9uKHNtLCBtYXBwaW5nLCByZXMpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiAoaW5mbyA9PSBu\ndWxsIHx8IHJlcyAhPSBpbmZvLnJlc3VsdCkpCiAgICAgICAgICAgICAgICBy\nZXMuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIHNldEludmVyc2VSZWxhdGlvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVy\nLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBSZXN1bHQgcmVzKSB7\nCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXRGaWVs\nZE1hcHBpbmdzKCk7CgogICAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIHRoZSBv\nd25lciBpcyBmdWxseSBpbml0aWFsaXplZC4KICAgICAgICAvLyBDaGVjayBp\nZiB0aGUgb3duZXIgaGFzIGVhZ2VybHkgbG9hZGVkIFRvTWFueSByZWxhdGlv\nbnMuCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKHJlcy5nZXRFYWdlcihmbXNbaV0pICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIE9iamVjdCBjb2xsID0gIG93bmVy\nLmZldGNoT2JqZWN0KGZtc1tpXS5nZXRJbmRleCgpKTsKICAgICAgICAgICAg\nICAgIGlmIChjb2xsIGluc3RhbmNlb2YgQ29sbGVjdGlvbiAmJiAKICAgICAg\nICAgICAgICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwpLnNpemUoKSA+IDAp\nIHsKICAgICAgICAgICAgICAgICAgICAvLyBGb3VuZCBlYWdlcmx5IGxvYWRl\nZCBjb2xsZWN0aW9uLgogICAgICAgICAgICAgICAgICAgIC8vIFB1Ymxpc2hl\nciAoMSkgPD09PiAgKE0pIE1hZ2F6aW5lCiAgICAgICAgICAgICAgICAgICAg\nLy8gICAgcHVibGlzaGVyIGhhcyBhIEVBR0VSIE9uZVRvTWFueSByZWxhdGlv\nbgogICAgICAgICAgICAgICAgICAgIC8vICAgIG1hZ2F6aW5lIGhhcyBhIEVB\nR0VSIG9yIExBWlkgTWFueVRvT25lIHB1Ymxpc2hlcgogICAgICAgICAgICAg\nICAgICAgIC8vIEZvciBlYWNoIG1lbWJlciAoTWFnYXppbmUpIGluIHRoZSBj\nb2xsZWN0aW9uLCAKICAgICAgICAgICAgICAgICAgICAvLyBzZXQgaXRzIGlu\ndmVyc2UgcmVsYXRpb24gKFB1Ymxpc2hlcikuCiAgICAgICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSAoKENvbGxlY3Rpb24pIGNvbGwpLml0\nZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpIGl0ci5uZXh0KCk7Cgog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocGMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IChPcGVuSlBB\nU3RhdGVNYW5hZ2VyKSBwYy4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIEZpZWxkTWFwcGluZ1tdIGZtZCA9ICgoQ2xhc3NNYXBwaW5nKSBzbS5nZXRN\nZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEZp\nZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChp\nbnQgaiA9IDA7IGogPCBmbWQubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIE9iamVjdCBvaWQgPSBzbS5nZXRJbnRlcm1lZGlh\ndGUoZm1kW2pdLmdldEluZGV4KCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gaWYgb2lkIHdhcyBzZXRJbnRlcm1lZGlhdGUoKSBwcmV2aW91\nc2x5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgaXQgaXMg\ndGhlIHNhbWUgYXMgdGhlIG93bmVyLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gdGhlbiBzZXQgdGhlIGludmVyc2UgcmVsYXRpb24KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChvaWQgIT0gbnVsbCAmJgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9pZC5lcXVhbHMob3duZXIu\nZ2V0T2JqZWN0SWQoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBzbS5zdG9yZU9iamVjdChmbWRbal0uZ2V0SW5kZXgoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIuZ2V0UGVyc2lz\ndGVuY2VDYXBhYmxlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIHByb3RlY3RlZCB2b2lkIHNldE1hcHBlZEJ5KE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sCiAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZEJ5Rmll\nbGRNYXBwaW5nLCBPYmplY3QgbWFwcGVkQnlPYmplY3QpIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1l\ndGFEYXRhKCk7CiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGlu\nZy5nZXREZWNsYXJlZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoZm1zW2ldID09IG1hcHBlZEJ5RmllbGRNYXBwaW5nKSB7CiAgICAgICAg\nICAgICAgICBzbS5zdG9yZU9iamVjdChmbXNbaV0uZ2V0SW5kZXgoKSwgbWFw\ncGVkQnlPYmplY3QpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBt\nZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3Ig\nSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyB2\nZXJzaW9uIGZyb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGdldFZlcnNpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgUmVzdWx0IHJlcykgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9u\nKCkuYWZ0ZXJMb2FkKHNtLCB0aGlzKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBu\nb24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBv\nZiBjaGVja2luZyB3aGV0aGVyIHRoZSByZXN1bHQgc2V0IGlzIGVtcHR5IG9y\nIG5vdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNFbXB0eVJl\nc3VsdChSZXN1bHQgcmVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAocmVzICE9IG51bGwgJiYgIXJlcy5uZXh0KCkpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92\nZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbiBvZiBnZXR0aW5nIHR5cGUgZnJvbSB0aGUgcmVzdWx0IHNl\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzIGdldFR5cGUoUmVzdWx0\nIHJlcywgQ2xhc3NNYXBwaW5nIG1hcHBpbmcpewogICAgICAgIGlmIChyZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0RGVzY3Jp\nYmVkVHlwZSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogQWxsb3cgdGhlIG1hcHBpbmcgdG8gY3VzdG9tIGxvYWQgZGF0\nYS4gUmV0dXJuIG51bGwgaWYgdGhlIG1hcHBpbmcKICAgICAqIGRvZXMgbm90\nIHVzZSBjdXN0b20gbG9hZGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBCb29s\nZWFuIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgUENTdGF0ZSBzdGF0ZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAgICB0aHJvd3MgQ2xhc3NO\nb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBj\naGVjayB0byBzZWUgaWYgdGhlIG1hcHBpbmcgdGFrZXMgY2FyZSBvZiBpbml0\naWFsaXphdGlvbgogICAgICAgIGlmICghbWFwcGluZy5jdXN0b21Mb2FkKHNt\nLCB0aGlzLCBzdGF0ZSwgZmV0Y2gpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpZiAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkgIT0gbnVs\nbCkgewogICAgICAgICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5hZnRlckxv\nYWQoc20sIHRoaXMpOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVF\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZGF0YSBmb3IgdGhlIGdp\ndmVuIGluc3RhbmNlIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4gUmV0dXJuCiAg\nICAgKiBudWxsIGlmIHRoZXJlIGlzIG5vIGRhdGEgaW4gdGhlIGN1cnJlbnQg\nZmV0Y2ggZ3JvdXBzIHRvIHNlbGVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBS\nZXN1bHQgZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBzdWJzKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIExpc3QgcGFyYW1zID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgICAgIFNlbGVjdCBzZWwgPSBuZXdTZWxlY3Qo\nc20sIG1hcHBpbmcsIGZldGNoLCBzdWJzLCBwYXJhbXMpOwogICAgICAgIGlm\nIChzZWwgPT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIHNl\nbC5leGVjdXRlKHRoaXMsIGZldGNoLCBwYXJhbXMpOwogICAgfQogICAgCiAg\nICBNYXA8U2VsZWN0S2V5LCBTZWxlY3Q+IHNlbGVjdEltcGxDYWNoZU1hcCA9\nIG51bGw7CiAgICBwcml2YXRlIFNlbGVjdCBuZXdTZWxlY3QoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHN1YnMsCiAgICAg\nICAgTGlzdCBwYXJhbXMpIHsKICAgICAgICBpZiAoIV9pc1F1ZXJ5U1FMQ2Fj\naGUpIAogICAgICAgICAgICByZXR1cm4gbmV3U2VsZWN0KHNtLCBtYXBwaW5n\nLCBmZXRjaCwgc3Vicyk7ICAgICAgIAogICAgICAgICAgIAogICAgICAgIGlm\nIChzZWxlY3RJbXBsQ2FjaGVNYXAgPT0gbnVsbCkgewogICAgICAgICAgICBz\nZWxlY3RJbXBsQ2FjaGVNYXAgPQogICAgICAgICAgICAgICAgZ2V0Q2FjaGVN\nYXBGcm9tUXVlcnlTUUxDYWNoZShKREJDU3RvcmVNYW5hZ2VyLmNsYXNzKTsK\nICAgICAgICB9CiAgICAgICAgIAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2hDbG9uZSA9IG5ldyBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nSW1wbCgpOwogICAgICAgIGZldGNoQ2xvbmUuY29weShmZXRjaCk7CiAgICAg\nICAgU2VsZWN0S2V5IHNlbEtleSA9IG5ldyBTZWxlY3RLZXkobWFwcGluZywg\nbnVsbCwgZmV0Y2hDbG9uZSk7CiAgICAgICAgU2VsZWN0IHNlbCA9IG51bGw7\nCiAgICAgICAgYm9vbGVhbiBmb3VuZCA9IHRydWU7CiAgICAgICAgT2JqZWN0\nIG9iaiA9IHNlbGVjdEltcGxDYWNoZU1hcC5nZXQoc2VsS2V5KTsKICAgICAg\nICBpZiAob2JqID09IG51bGwpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nIChzZWxlY3RJbXBsQ2FjaGVNYXApIHsKICAgICAgICAgICAgICAgIG9iaiA9\nIHNlbGVjdEltcGxDYWNoZU1hcC5nZXQoc2VsS2V5KTsKICAgICAgICAgICAg\nICAgIGlmIChvYmogPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIC8v\nIE5vdCBmb3VuZCBpbiBjYWNoZSwgY3JlYXRlIGEgbmV3IHNlbGVjdAogICAg\nICAgICAgICAgICAgICAgIG9iaiA9IG5ld1NlbGVjdChzbSwgbWFwcGluZywg\nZmV0Y2gsIHN1YnMpOwogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gZmFs\nc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAg\nICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyBJZiB0aGUgZ2VuZXJhdGVkIFNlbGVjdEltcGwgaXMgbnVs\nbCwgc3RvcmUgYSBnZW5lcmljCiAgICAgICAgICAgICAgICAgICAgLy8ga25v\nd24gb2JqZWN0IGluIHRoZSBjYWNoZSBhcyBhIHBsYWNlaG9sZGVyLiBTb21l\nIG1hcCAKICAgICAgICAgICAgICAgICAgICAvLyBpbXBsZW1lbnRhdGlvbnMg\nZG8gbm90IGFsbG93IG51bGwgdmFsdWVzLgogICAgICAgICAgICAgICAgICAg\nIG9iaiA9IF9udWxsQ2FjaGVWYWx1ZTsKICAgICAgICAgICAgICAgICAgICBm\nb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgZWxzZSBpZiAob2JqICE9IF9udWxsQ2FjaGVWYWx1ZSkKICAgICAgICAg\nICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzZWwgPSAoU2VsZWN0KW9i\najsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsLmdldFNRTCgpID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsLnNldFNRTCh0aGlz\nLCBmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gZmFs\nc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgICAgICAg\nICAgIGFkZFRvU3FsQ2FjaGUoc2VsZWN0SW1wbENhY2hlTWFwLCBzZWxLZXks\nIG9iaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIGlmIChvYmogIT0gbnVsbCAmJiBvYmogIT0gX251bGxD\nYWNoZVZhbHVlKQogICAgICAgICAgICBzZWwgPSAoU2VsZWN0KSBvYmo7Cgog\nICAgICAgIExvZyBsb2cgPSBfY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRp\nb24uTE9HX0pEQkMpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkgewogICAgICAgICAgICBpZiAoIWZvdW5kKQogICAgICAgICAgICAgICAg\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJjYWNoZS1taXNzZWQiLCBtYXBwaW5nLCB0\naGlzLmdldENsYXNzKCkpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJjYWNoZS1oaXQiLCBtYXBwaW5n\nLCB0aGlzLmdldENsYXNzKCkpKTsKICAgICAgICB9CgogICAgICAgIGlmIChz\nZWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nCiAgICAgICAgT2JqZWN0IG9pZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAg\nICAgQ29sdW1uW10gY29scyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVt\nbnMoKTsKICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KG1hcHBpbmcsIGNv\nbHMsIGNvbHMsIG9pZCwgdGhpcywgCiAgICAgICAgCW51bGwsIG51bGwsIHBh\ncmFtcyk7CiAgICAgICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgU2VsZWN0IG5ld1NlbGVjdChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAog\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBpbnQgc3VicykgewogICAgICAgIFNlbGVjdCBzZWwg\nPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgIGlmICghc2VsZWN0KHNlbCwg\nbWFwcGluZywgc3Vicywgc20sIG51bGwsIGZldGNoLAogICAgICAgICAgICBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sIHRydWUsIGZhbHNl\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgc2VsLndoZXJl\nUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0aGlzKTsK\nICAgICAgICBzZWwuc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgxLCBmYWxzZSk7\nCiAgICAgICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\nbGVjdCBhIHVuaW9uIG9mIHRoZSBkYXRhIGZvciB0aGUgZ2l2ZW4gaW5zdGFu\nY2UgZnJvbSBwb3NzaWJsZSBjb25jcmV0ZQogICAgICogbWFwcGluZ3MgYW5k\nIHJldHVybiB0aGUgcmVzdWx0LgogICAgICovCiAgICBwcml2YXRlIFJlc3Vs\ndCBnZXRJbml0aWFsaXplU3RhdGVVbmlvblJlc3VsdChmaW5hbCBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBmaW5hbCBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncywKICAgICAgICBmaW5h\nbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBmaW5hbCBKREJDU3RvcmVNYW5hZ2VyIHN0b3Jl\nID0gdGhpczsKICAgICAgICBmaW5hbCBpbnQgZWFnZXIgPSBNYXRoLm1pbihm\nZXRjaC5nZXRFYWdlckZldGNoTW9kZSgpLAogICAgICAgICAgICBKREJDRmV0\nY2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4pOwoKICAgICAgICBVbmlvbiB1\nbmlvbiA9IF9zcWwubmV3VW5pb24obWFwcGluZ3MubGVuZ3RoKTsKICAgICAg\nICB1bmlvbi5zZXRFeHBlY3RlZFJlc3VsdENvdW50KDEsIGZhbHNlKTsKICAg\nICAgICBpZiAoZmV0Y2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUobWFwcGluZykg\nIT0gZmV0Y2guRUFHRVJfSk9JTikKICAgICAgICAgICAgdW5pb24uYWJvcnRV\nbmlvbigpOwogICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0\nb3IoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qg\nc2VsLCBpbnQgaSkgewogICAgICAgICAgICAgICAgc2VsLnNlbGVjdChtYXBw\naW5nc1tpXSwgU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxFLCBzdG9yZSwgZmV0\nY2gsCiAgICAgICAgICAgICAgICAgICAgZWFnZXIpOwogICAgICAgICAgICAg\nICAgc2VsLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBw\naW5nc1tpXSwgc3RvcmUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAg\nICAgICAgcmV0dXJuIHVuaW9uLmV4ZWN1dGUodGhpcywgZmV0Y2gpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2VsZWN0IHByaW1hcnkga2V5IGRhdGEgdG8g\nbWFrZSBzdXJlIHRoZSBnaXZlbiBpbnN0YW5jZSBleGlzdHMsIGxvY2tpbmcK\nICAgICAqIGlmIG5lZWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHNlbGVjdFByaW1hcnlLZXkoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBzZWxlY3QgcGtzIGZyb20gYmFzZSBjbGFzcyByZWNvcmQgdG8g\nZW5zdXJlIGl0IGV4aXN0cyBhbmQgbG9jawogICAgICAgIC8vIGl0IGlmIG5l\nZWRlZAogICAgICAgIENsYXNzTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAg\nICAgICB3aGlsZSAoYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKSAhPSBudWxsKQogICAgICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2lu\nYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKCiAgICAgICAgU2VsZWN0IHNl\nbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgc2VsLnNlbGVjdChiYXNl\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCkpOwogICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgYmFzZSwgdGhpcyk7CiAgICAg\nICAgUmVzdWx0IGV4aXN0cyA9IHNlbC5leGVjdXRlKHRoaXMsIGZldGNoKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChl\neGlzdHMpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAgICAgLy8gcmVjb3JkIGxvY2tlZD8KICAgICAgICAgICAgaWYgKF9hY3Rp\ndmUgJiYgX2xtICE9IG51bGwgJiYgZXhpc3RzLmlzTG9ja2luZygpKQogICAg\nICAgICAgICAgICAgX2xtLmxvYWRlZEZvclVwZGF0ZShzbSk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGV4aXN0cy5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNl\ndCBmaWVsZHMsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBp\nbnQgbG9ja0xldmVsLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gamZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24pIGZldGNoOwoKICAgICAgICAvLyBnZXQgYSBjb25uZWN0aW9uLCBv\nciByZXVzZSBjdXJyZW50IG9uZQogICAgICAgIENvbm5lY3Rpb25JbmZvIGlu\nZm8gPSAoQ29ubmVjdGlvbkluZm8pIGNvbnRleHQ7CiAgICAgICAgUmVzdWx0\nIHJlcyA9IG51bGw7CiAgICAgICAgaWYgKGluZm8gIT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBpZiBpbml0aWFsaXplKCkgZmFpbHMgdG8gbG9hZCByZXF1\naXJlZCBmaWVsZHMsIHRoZW4gdGhpcyBtZXRob2QKICAgICAgICAgICAgLy8g\naXMgY2FsbGVkOyBtYWtlIHN1cmUgbm90IHRvIHRyeSB0byB1c2UgdGhlIGdp\ndmVuIHJlc3VsdCBpZiBpdCdzCiAgICAgICAgICAgIC8vIHRoZSBzYW1lIG9u\nZSB3ZSBqdXN0IGZhaWxlZCB0byBjb21wbGV0ZWx5IGluaXRpYWxpemUoKSB3\naXRoCiAgICAgICAgICAgIGlmIChpbmZvLnNtICE9IHNtKQogICAgICAgICAg\nICAgICAgcmVzID0gaW5mby5yZXN1bHQ7CiAgICAgICAgICAgIGluZm8uc20g\nPSBudWxsOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyBpZiB0aGVyZSdzIGFuIGV4aXN0aW5nIHJlc3VsdCwgbG9hZCBhbGwgd2Ug\nY2FuIGZyb20gaXQKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcg\nPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgICAg\nICBpZiAocmVzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvYWQobWFw\ncGluZywgc20sIGpmZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIHJlbW92\nZUxvYWRlZEZpZWxkcyhzbSwgZmllbGRzKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gaWYgdGhlIGluc3RhbmNlIGlzIGhvbGxvdyBhbmQgdGhl\ncmUncyBhIGN1c3RvbWl6ZWQKICAgICAgICAgICAgLy8gZ2V0IGJ5IGlkIG1l\ndGhvZCwgdXNlIGl0CiAgICAgICAgICAgIGlmIChzbS5nZXRMb2FkZWQoKS5s\nZW5ndGgoKSA9PSAwIAogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5jdXN0\nb21Mb2FkKHNtLCB0aGlzLCBudWxsLCBqZmV0Y2gpKQogICAgICAgICAgICAg\nICAgcmVtb3ZlTG9hZGVkRmllbGRzKHNtLCBmaWVsZHMpOwoKICAgICAgICAg\nICAgLy8jIyMgc2VsZWN0IGlzIGtpbmQgb2YgYSBiaWcgb2JqZWN0LCBhbmQg\naW4gc29tZSBjYXNlcyB3ZSBkb24ndAogICAgICAgICAgICAvLyMjIyB1c2Ug\naXQuLi4gd291bGQgaXQgYmUgd29ydGggaXQgdG8gaGF2ZSBhIHNtYWxsIHNo\nZWxsIHNlbGVjdAogICAgICAgICAgICAvLyMjIyBvYmplY3QgdGhhdCBvbmx5\nIGNyZWF0ZXMgYSByZWFsIHNlbGVjdCB3aGVuIGFjdHVhbGx5IHVzZWQ/Cgog\nICAgICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAg\nICAgICAgICAgaWYgKHNlbGVjdChzZWwsIG1hcHBpbmcsIFNlbGVjdC5TVUJT\nX0VYQUNULCBzbSwgZmllbGRzLCBqZmV0Y2gsCiAgICAgICAgICAgICAgICBF\nYWdlckZldGNoTW9kZXMuRUFHRVJfSk9JTiwgdHJ1ZSwgZmFsc2UpKSB7CiAg\nICAgICAgICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVj\ndElkKCksIG1hcHBpbmcsIHRoaXMpOwogICAgICAgICAgICAgICAgcmVzID0g\nc2VsLmV4ZWN1dGUodGhpcywgamZldGNoLCBsb2NrTGV2ZWwpOwogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAJaWYgKGlzRW1wdHlS\nZXN1bHQocmVzKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGpm\nZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdyBhbGxvdyB0aGUg\nZmllbGRzIHRvIGxvYWQgdGhlbXNlbHZlcyBpbmRpdmlkdWFsbHkgdG9vCiAg\nICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0Rmll\nbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHMu\nZ2V0KGkpICYmICFzbS5nZXRMb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAg\nICAgICAgICAgZm1zW2ldLmxvYWQoc20sIHRoaXMsIGpmZXRjaC50cmF2ZXJz\nZUpEQkMoZm1zW2ldKSk7CiAgICAgICAgICAgIG1hcHBpbmcuZ2V0VmVyc2lv\nbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24g\nY25mZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24o\nY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9k\naWN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYSBsaXN0IGZvcm1lZCBieSByZW1vdmluZyBhbGwgbG9hZGVkIGZpZWxkcyBm\ncm9tIHRoZSBnaXZlbiBvbmUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBy\nZW1vdmVMb2FkZWRGaWVsZHMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0\nU2V0IGZpZWxkcykgewogICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBm\naWVsZHMubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykKICAgICAgICAgICAgaWYg\nKGZpZWxkcy5nZXQoaSkgJiYgc20uZ2V0TG9hZGVkKCkuZ2V0KGkpKQogICAg\nICAgICAgICAgICAgZmllbGRzLmNsZWFyKGkpOwogICAgfQoKICAgIHB1Ymxp\nYyBDb2xsZWN0aW9uIGxvYWRBbGwoQ29sbGVjdGlvbiBzbXMsIFBDU3RhdGUg\nc3RhdGUsIGludCBsb2FkLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICByZXR1cm4gSW1wbEhl\nbHBlci5sb2FkQWxsKHNtcywgdGhpcywgc3RhdGUsIGxvYWQsIGZldGNoLCBj\nb250ZXh0KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWZvcmVTdGF0ZUNo\nYW5nZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIGZyb21TdGF0\nZSwKICAgICAgICBQQ1N0YXRlIHRvU3RhdGUpIHsKICAgIH0KCiAgICBwdWJs\naWMgQ29sbGVjdGlvbiBmbHVzaChDb2xsZWN0aW9uIHNtcykgewogICAgICAg\nIHJldHVybiBfY29uZi5nZXRVcGRhdGVNYW5hZ2VySW5zdGFuY2UoKS5mbHVz\naChzbXMsIHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGNhbmNl\nbEFsbCgpIHsKICAgICAgICAvLyBub3RlIHRoYXQgdGhpcyBtZXRob2QgZG9l\ncyBub3QgbG9jayB0aGUgY29udGV4dCwgc2luY2UKICAgICAgICAvLyB3ZSB3\nYW50IHRvIGFsbG93IGEgZGlmZmVyZW50IHRocmVhZCB0byBiZSBhYmxlIHRv\nIGNhbmNlbCB0aGUKICAgICAgICAvLyBvdXRzdGFuZGluZyBzdGF0ZW1lbnQg\nb24gYSBkaWZmZXJlbnQgY29udGV4dAoKICAgICAgICBDb2xsZWN0aW9uIHN0\nbW50czsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9zdG1udHMpIHsKICAgICAg\nICAgICAgaWYgKF9zdG1udHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICBzdG1udHMgPSBuZXcgQXJyYXlM\naXN0KF9zdG1udHMpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzdG1udHMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAoKFN0YXRlbWVudCkg\naXRyLm5leHQoKSkuY2FuY2VsKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGFzc2lnbk9i\namVjdElkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGJvb2xlYW4gcHJlRmx1\nc2gpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBzbS5nZXRNZXRh\nRGF0YSgpOwogICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgIHJl\ndHVybiBBcHBsaWNhdGlvbklkcy5hc3NpZ24oc20sIHRoaXMsIHByZUZsdXNo\nKTsKCiAgICAgICAgLy8gZGF0YXN0b3JlIGlkZW50aXR5CiAgICAgICAgT2Jq\nZWN0IHZhbCA9IEltcGxIZWxwZXIuZ2VuZXJhdGVJZGVudGl0eVZhbHVlKF9j\ndHgsIG1ldGEsCiAgICAgICAgICAgIEphdmFUeXBlcy5MT05HKTsKICAgICAg\nICBpZiAodmFsID09IG51bGwgJiYgbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5\nKCkgIT0gVmFsdWVTdHJhdGVnaWVzLk5BVElWRSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAg\nICAgdmFsID0gZ2V0RGF0YVN0b3JlSWRTZXF1ZW5jZShtZXRhKS5uZXh0KF9j\ndHgsIG1ldGEpOwogICAgICAgIHNtLnNldE9iamVjdElkKG5ld0RhdGFTdG9y\nZUlkKHZhbCwgbWV0YSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGFzc2lnbkZpZWxkKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIGludCBmaWVsZCwKICAgICAgICBib29sZWFuIHByZUZsdXNo\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbS5nZXRNZXRhRGF0\nYSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBPYmplY3QgdmFsID0gSW1w\nbEhlbHBlci5nZW5lcmF0ZUZpZWxkVmFsdWUoX2N0eCwgZm1kKTsKICAgICAg\nICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICBzbS5zdG9yZShmaWVsZCwgdmFsKTsKICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0TWFuYWdlZFR5cGUo\nT2JqZWN0IG9pZCkgewogICAgICAgIGlmIChvaWQgaW5zdGFuY2VvZiBJZCkK\nICAgICAgICAgICAgcmV0dXJuICgoSWQpIG9pZCkuZ2V0VHlwZSgpOwogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRE\nYXRhU3RvcmVJZFR5cGUoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAg\ncmV0dXJuIElkLmNsYXNzOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgY29w\neURhdGFTdG9yZUlkKE9iamVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIElkIGlkID0gKElkKSBvaWQ7CiAgICAgICAgcmV0dXJuIG5l\ndyBJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgaWQuZ2V0SWQoKSwgaWQu\naGFzU3ViY2xhc3NlcygpKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5l\nd0RhdGFTdG9yZUlkKE9iamVjdCB2YWwsIENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIHJldHVybiBJZC5uZXdJbnN0YW5jZShtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSwgdmFsKTsKICAgIH0KCiAgICBwdWJsaWMgSWQgbmV3RGF0\nYVN0b3JlSWQobG9uZyBpZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xl\nYW4gc3VicykgewogICAgICAgIHJldHVybiBuZXcgSWQobWFwcGluZy5nZXRE\nZXNjcmliZWRUeXBlKCksIGlkLCBzdWJzKTsKICAgIH0KCiAgICBwdWJsaWMg\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZUV4dGVudChDbGFzc01ldGFE\nYXRhIG1ldGEsCiAgICAgICAgZmluYWwgYm9vbGVhbiBzdWJjbGFzc2VzLCBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBDbGFzc01hcHBp\nbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIG1ldGE7CiAgICAgICAgZmlu\nYWwgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3M7CiAgICAgICAgaWYgKHN1YmNs\nYXNzZXMpCiAgICAgICAgICAgIG1hcHBpbmdzID0gbWFwcGluZy5nZXRJbmRl\ncGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgbWFwcGluZ3MgPSBuZXcgQ2xhc3NNYXBwaW5nW10geyBtYXBw\naW5nIH07CgogICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyW10gcm9wcyA9\nIG51bGw7CiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBq\nZmV0Y2ggPSAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgZmV0Y2g7CiAgICAg\nICAgaWYgKGpmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAh\nPSBqZmV0Y2guRUFHRVJfSk9JTikKICAgICAgICAgICAgcm9wcyA9IG5ldyBS\nZXN1bHRPYmplY3RQcm92aWRlclttYXBwaW5ncy5sZW5ndGhdOwoKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBjaGVjayBmb3IgY3VzdG9tIGxvYWRz\nCiAgICAgICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyIHJvcDsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgcm9wID0gbWFwcGluZ3NbaV0uY3VzdG9t\nTG9hZCh0aGlzLCBzdWJjbGFzc2VzLCBqZmV0Y2gsIDAsCiAgICAgICAgICAg\nICAgICAgICAgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICAgICAgaWYg\nKHJvcCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvcHMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgcm9wcyA9IG5ldyBS\nZXN1bHRPYmplY3RQcm92aWRlclttYXBwaW5ncy5sZW5ndGhdOwogICAgICAg\nICAgICAgICAgICAgIHJvcHNbaV0gPSByb3A7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHdlJ3JlIHNlbGVj\ndGluZyBpbmRlcGVuZGVudCBtYXBwaW5ncyBzZXBhcmF0ZWx5IG9yIGhhdmUK\nICAgICAgICAgICAgLy8gY3VzdG9tIGxvYWRzLCBkbyBpbmRpdmlkdWFsIHNl\nbGVjdHMgZm9yIGVhY2ggY2xhc3MKICAgICAgICAgICAgcm9wID0gbnVsbDsK\nICAgICAgICAgICAgaWYgKHJvcHMgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgICAgIGlmIChyb3BzW2ldICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAg\nICAgICAgICAgICAgICBzZWwuc2V0TFJTKHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIEJpdFNldCBwYWdlZCA9IHNlbGVjdEV4dGVudChzZWwsIG1hcHBp\nbmdzW2ldLCBqZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmNs\nYXNzZXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChwYWdlZCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICByb3BzW2ldID0gbmV3IEluc3Rh\nbmNlUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbWFwcGluZ3NbaV0sIHRoaXMsIGpmZXRjaCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBy\nb3BzW2ldID0gbmV3IFBhZ2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKHNlbCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzW2ldLCB0aGlz\nLCBqZmV0Y2gsIHBhZ2VkLCBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBpZiAocm9wcy5sZW5ndGggPT0gMSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9wc1swXTsKICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlkZXIo\ncm9wcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBlcmZvcm0g\nYSB1bmlvbiBvbiBhbGwgaW5kZXBlbmRlbnQgY2xhc3NlcwogICAgICAgICAg\nICBVbmlvbiB1bmlvbiA9IF9zcWwubmV3VW5pb24obWFwcGluZ3MubGVuZ3Ro\nKTsKICAgICAgICAgICAgdW5pb24uc2V0TFJTKHRydWUpOwogICAgICAgICAg\nICBmaW5hbCBCaXRTZXRbXSBwYWdlZCA9IG5ldyBCaXRTZXRbbWFwcGluZ3Mu\nbGVuZ3RoXTsKICAgICAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5T\nZWxlY3RvcigpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICAgICAg\ncGFnZWRbaWR4XSA9IHNlbGVjdEV4dGVudChzZWwsIG1hcHBpbmdzW2lkeF0s\nIGpmZXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3Nlcyk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAg\nICAgLy8gdXNpbmcgcGFnaW5nIHJvcCBpZiBhbnkgdW5pb24gZWxlbWVudCBo\nYXMgcGFnZWQgZmllbGRzCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgcGFnZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChw\nYWdlZFtpXSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIodW5pb24sIG1hcHBpbmdz\nLAogICAgICAgICAgICAgICAgICAgICAgICBKREJDU3RvcmVNYW5hZ2VyLnRo\naXMsIGpmZXRjaCwgcGFnZWQsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IEluc3RhbmNlUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIodW5pb24sIG1hcHBpbmdzWzBdLCB0aGlzLAogICAgICAg\nICAgICAgICAgamZldGNoKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRT\ndG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFNlbGVjdCB0aGUgZ2l2ZW4gbWFwcGluZyBmb3IgdXNlIGluIGFuIGV4\ndGVudCwgcmV0dXJuaW5nIHBhZ2VkIGZpZWxkcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBCaXRTZXQgc2VsZWN0RXh0ZW50KFNlbGVjdCBzZWwsIENsYXNzTWFw\ncGluZyBtYXBwaW5nLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGJvb2xlYW4gc3ViY2xhc3NlcykgewogICAgICAgIGludCBzdWJz\nID0gKHN1YmNsYXNzZXMpID8gU2VsZWN0LlNVQlNfSk9JTkFCTEUgOiBTZWxl\nY3QuU1VCU19OT05FOwogICAgICAgIC8vIGRlY2lkZSBiZXR3ZWVuIHBhZ2lu\nZyBhbmQgc3RhbmRhcmQgaXRlcmF0aW9uCiAgICAgICAgQml0U2V0IHBhZ2Vk\nID0gUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIuZ2V0UGFnZWRGaWVsZHMo\nc2VsLCBtYXBwaW5nLAogICAgICAgICAgICB0aGlzLCBmZXRjaCwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbi5FQUdFUl9QQVJBTExFTCwKICAgICAgICAgICAg\nTG9uZy5NQVhfVkFMVUUpOwogICAgICAgIGlmIChwYWdlZCA9PSBudWxsKQog\nICAgICAgICAgICBzZWwuc2VsZWN0SWRlbnRpZmllcihtYXBwaW5nLCBzdWJz\nLCB0aGlzLCBmZXRjaCwKICAgICAgICAgICAgICAgIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24uRUFHRVJfUEFSQUxMRUwpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc2VsLnNlbGVjdElkZW50aWZpZXIobWFwcGluZywgc3VicywgdGhp\ncywgZmV0Y2gsCiAgICAgICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uLkVBR0VSX0pPSU4pOwogICAgICAgIHJldHVybiBwYWdlZDsKICAgIH0K\nCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBuZXdRdWVyeShTdHJpbmcgbGFuZ3Vh\nZ2UpIHsKICAgICAgICBFeHByZXNzaW9uUGFyc2VyIGVwID0gUXVlcnlMYW5n\ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZ3VhZ2UpOwogICAgICAgIGlm\nIChlcCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IEpEQkNTdG9y\nZVF1ZXJ5KHRoaXMsIGVwKTsKICAgICAgICBpZiAoUXVlcnlMYW5ndWFnZXMu\nTEFOR19TUUwuZXF1YWxzKGxhbmd1YWdlKSkKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTUUxTdG9yZVF1ZXJ5KHRoaXMpOwogICAgICAgIHJldHVybiBudWxs\nOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gbmV3RmV0\nY2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbkltcGwoKTsKICAgIH0KCiAgICBwdWJsaWMgU2Vx\nIGdldERhdGFTdG9yZUlkU2VxdWVuY2UoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpID09IFZh\nbHVlU3RyYXRlZ2llcy5OQVRJVkUKICAgICAgICAgICAgfHwgbWV0YS5nZXRJ\nZGVudGl0eVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAg\nICAgICAgICAgIHJldHVybiBfY29uZi5nZXRTZXF1ZW5jZUluc3RhbmNlKCk7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIFNlcSBn\nZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7\nCiAgICAgICAgaWYgKF9jb25uICE9IG51bGwpCiAgICAgICAgICAgIF9jb25u\nLmZyZWUoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAgICAvLyBVdGls\naXRpZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIENvbm5l\nY3QgdG8gdGhlIGRiLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29ubmVj\ndChib29sZWFuIHJlZikgewogICAgICAgIF9jdHgubG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbm5lY3QgaWYgdGhlIGNvbm5lY3Rp\nb24gaXMgY3VycmVudGx5IG51bGwsIG9yIGlmCiAgICAgICAgICAgIC8vIHRo\nZSBjb25uZWN0aW9uIGhhcyBiZWVuIGNsb3NlZCBvdXQgZnJvbSB1bmRlciB1\ncwogICAgICAgICAgICBpZiAoX2Nvbm4gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9jb25uID0gY29ubmVjdEludGVybmFsKCk7CiAgICAgICAgICAgIGlm\nIChyZWYpCiAgICAgICAgICAgICAgICBfY29ubi5yZWYoKTsKICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cg\nU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdCB0byB0aGUgZGF0YWJh\nc2UuIFRoaXMgbWV0aG9kIGlzIHNlcGFyYXRlZCBvdXQgc28gdGhhdCBpdAog\nICAgICogY2FuIGJlIG92ZXJyaWRkZW4uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBSZWZDb3VudENvbm5lY3Rpb24gY29ubmVjdEludGVybmFsKCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIG5ldyBSZWZDb3VudENv\nbm5lY3Rpb24oX2RzLmdldENvbm5lY3Rpb24oKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBGaW5kIHRoZSBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gb2lkLgog\nICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGZpbmQoT2JqZWN0IG9pZCwgVmFs\ndWVNYXBwaW5nIHZtLCAKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBPYmplY3QgcGMgPSBfY3R4LmZpbmQo\nb2lkLCBmZXRjaCwgbnVsbCwgbnVsbCwgMCk7CiAgICAgICAgaWYgKHBjID09\nIG51bGwgJiYgdm0gIT0gbnVsbCkgewogICAgICAgICAgICBPcnBoYW5lZEtl\neUFjdGlvbiBhY3Rpb24gPSBfY29uZi5nZXRPcnBoYW5lZEtleUFjdGlvbklu\nc3RhbmNlKCk7CiAgICAgICAgICAgIHBjID0gYWN0aW9uLm9ycGhhbihvaWQs\nIG51bGwsIHZtKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBjOwogICAg\nfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgb2JqZWN0IGluIHRoZSBjdXJy\nZW50IHJvdyBvZiB0aGUgZ2l2ZW4gcmVzdWx0LgogICAgICovCiAgICBwdWJs\naWMgT2JqZWN0IGxvYWQoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUs\nIFJlc3VsdCByZXN1bHQpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmICghbWFwcGluZy5pc01hcHBlZCgpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJ2aXJ0dWFsLW1h\ncHBpbmciLCAKICAgICAgICAgICAgICAgIG1hcHBpbmcpKTsKCiAgICAgICAg\nLy8gZ2V0IHRoZSBvYmplY3QgaWQgZm9yIHRoZSByb3c7IGJhc2UgY2xhc3Mg\nc2VsZWN0cyBwayBjb2x1bW5zCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2Ug\nPSBtYXBwaW5nOwogICAgICAgIHdoaWxlIChiYXNlLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIGJhc2Ug\nPSBiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAg\nICAgIE9iamVjdCBvaWQgPSBiYXNlLmdldE9iamVjdElkKHRoaXMsIHJlc3Vs\ndCwgbnVsbCwgdHJ1ZSwgbnVsbCk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29ubmVjdGlv\nbkluZm8gaW5mbyA9IG5ldyBDb25uZWN0aW9uSW5mbygpOwogICAgICAgIGlu\nZm8ucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIGluZm8ubWFwcGluZyA9IG1h\ncHBpbmc7CgogICAgICAgIC8vIGlmIGludmVyc2UgcmVsYXRpb24gaXMga25v\nd24sIGV4Y2x1ZGUgbG9hZGluZyBkdXJpbmcgZmluZAogICAgICAgIGV4Y2x1\nZGUgPSBleGNsdWRlSW52ZXJzZVJlbGF0aW9uKG1hcHBpbmcsIGluZm8sIGV4\nY2x1ZGUpOwogICAgICAgIHJldHVybiBfY3R4LmZpbmQob2lkLCBmZXRjaCwg\nZXhjbHVkZSwgaW5mbywgMCk7CiAgICB9CgogICAgcHJpdmF0ZSBCaXRTZXQg\nZXhjbHVkZUludmVyc2VSZWxhdGlvbihDbGFzc01hcHBpbmcgbWFwcGluZywK\nICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvLCBCaXRTZXQgZXhjbHVkZSkg\newogICAgICAgIEZpZWxkTWFwcGluZyBpbnZlcnNlID0gaW5mby5yZXN1bHQu\nZ2V0TWFwcGVkQnlGaWVsZE1hcHBpbmcoKTsKICAgICAgICBpZiAoaW52ZXJz\nZSAhPSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9\nIG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAg\nICAgaWYgKGV4Y2x1ZGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGV4Y2x1\nZGUgPSBuZXcgQml0U2V0KGZtcy5sZW5ndGgpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgaWYgKGZtc1tpXSA9PSBpbnZlcnNlKSB7CiAgICAgICAgICAgICAg\nICAgICAgZXhjbHVkZS5zZXQoZm1zW2ldLmdldEluZGV4KCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGNsdWRlOwogICAg\nfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdl\nciB3aXRoIGRhdGEgZnJvbSB0aGUgcmVzdWx0IHNldC4gT25seQogICAgICog\nbWFwcGluZ3Mgb3JpZ2luYWxseSBzZWxlY3RlZCB3aWxsIGJlIGxvYWRlZC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvYWQoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcykgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55\nID0gbG9hZChtYXBwaW5nLCBzbSwgZmV0Y2gsIHJlcywgbnVsbCk7CiAgICAg\nICAgaWYgKGVhZ2VyVG9NYW55ICE9IG51bGwpCiAgICAgICAgICAgIGVhZ2Vy\nVG9NYW55LmxvYWRFYWdlckpvaW4oc20sIHRoaXMsIGZldGNoLnRyYXZlcnNl\nSkRCQyhlYWdlclRvTWFueSksCiAgICAgICAgICAgICAgICByZXMpOwogICAg\nICAgIGlmIChfYWN0aXZlICYmIF9sbSAhPSBudWxsICYmIHJlcy5pc0xvY2tp\nbmcoKSkKICAgICAgICAgICAgX2xtLmxvYWRlZEZvclVwZGF0ZShzbSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBmaWVsZHMgb2YgdGhlIGdp\ndmVuIG1hcHBpbmcuIFJldHVybiBhbnkgdG8tbWFueSBlYWdlciBmaWVsZAog\nICAgICogd2l0aG91dCBsb2FkaW5nIGl0LgogICAgICovCiAgICBwcml2YXRl\nIEZpZWxkTWFwcGluZyBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMsIEZpZWxkTWFwcGluZyBlYWdlclRv\nTWFueSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAobWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBmZXRjaCwgcmVzKSkK\nICAgICAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwoKICAgICAgICAvLyBs\nb2FkIHN1cGVyY2xhc3MgZGF0YTsgYmFzZSBjbGFzcyBsb2FkcyB2ZXJzaW9u\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1hcHBpbmcuZ2V0Sm9p\nbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHBhcmVu\ndCAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFueSA9IGxvYWQocGFy\nZW50LCBzbSwgZmV0Y2gsIHJlcywgZWFnZXJUb01hbnkpOwogICAgICAgIGVs\nc2UgaWYgKHNtLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAgICAgICAgICBt\nYXBwaW5nLmdldFZlcnNpb24oKS5sb2FkKHNtLCB0aGlzLCByZXMpOwoKICAg\nICAgICAvLyBsb2FkIHVubG9hZGVkIGZpZWxkcwogICAgICAgIEZpZWxkTWFw\ncGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3Mo\nKTsKICAgICAgICBPYmplY3QgZXJlcywgcHJvY2Vzc2VkOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmIChmbXNbaV0uaXNQcmltYXJ5S2V5KCkgfHwgc20uZ2V0TG9hZGVk\nKCkuZ2V0KGZtc1tpXS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gY2hlY2sgZm9y\nIGVhZ2VyIHJlc3VsdCwgYW5kIGlmIG5vdCBwcmVzZW50IGRvIHN0YW5kYXJk\nIGxvYWQKICAgICAgICAgICAgZXJlcyA9IHJlcy5nZXRFYWdlcihmbXNbaV0p\nOwogICAgICAgICAgICByZXMuc3RhcnREYXRhUmVxdWVzdChmbXNbaV0pOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICBpZiAoZXJlcyA9PSBy\nZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWFnZXJUb01hbnkgPT0g\nbnVsbCAmJiBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBlYWdlclRvTWFueSA9IGZtc1tpXTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZt\nc1tpXS5sb2FkRWFnZXJKb2luKHNtLCB0aGlzLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCByZXMpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcmVzICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICBwcm9jZXNzZWQgPSBmbXNbaV0ubG9hZEVhZ2Vy\nUGFyYWxsZWwoc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAgIAlmZXRj\naC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZXJlcyk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHByb2Nlc3NlZCAhPSBlcmVzKQogICAgICAgICAgICAgICAg\nICAgICAgICByZXMucHV0RWFnZXIoZm1zW2ldLCBwcm9jZXNzZWQpOwogICAg\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm1zW2ld\nLmxvYWQoc20sIHRoaXMsIGZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBy\nZXMpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\ncmVzLmVuZERhdGFSZXF1ZXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoKICAgIC8qKgog\nICAgICogRm9yIGltcGxlbWVudGF0aW9uIHVzZSBvbmx5LgogICAgICogUmV0\ndXJuIGEgc2VsZWN0IGZvciB0aGUgcHJvcGVyIG1hcHBpbmdzLiBSZXR1cm4g\nbnVsbCBpZiBubyBzZWxlY3QgaXMKICAgICAqIG5lZWRlZC4gVGhlIG1ldGhv\nZCBpcyBkZXNpZ25lZCB0byBiZSBjb21wbGVtZW50YXJ5IHRvIHRoZSBsb2Fk\nIG1ldGhvZHMuCiAgICAgKgogICAgICogQHBhcmFtIHNlbCBzZWxlY3QgdG8g\nYnVpbGQgb24KICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtYXBwaW5nIGZv\nciB0aGUgYmFzZSB0eXBlIHRvIHNlbGVjdCBmb3IKICAgICAqIEBwYXJhbSBz\ndWJzIHdoZXRoZXIgdGhlIHNlbGVjdCBtaWdodCBpbmNsdWRlIHN1YmNsYXNz\nZXMgb2YgdGhlCiAgICAgKiBnaXZlbiBtYXBwaW5nCiAgICAgKiBAcGFyYW0g\nc20gc3RhdGUgbWFuYWdlciBpZiBhbiBpbnN0YW5jZSBpcyBiZWluZyBsb2Fk\nZWQgb3IKICAgICAqIGluaXRpYWxpemVkLCBlbHNlIG51bGwKICAgICAqIEBw\nYXJhbSBmaWVsZHMgaWYgYSBzdGF0ZSBtYW5hZ2VyIGlzIGJlaW5nIGxvYWRl\nZCwgdGhlIHNldCBvZgogICAgICogZmllbGRzIHRoYXQgbXVzdCBiZSBsb2Fk\nZWQgaW4gb3JkZXIsIGVsc2UgbnVsbAogICAgICogQHBhcmFtIGZldGNoIHRo\nZSBmZXRjaCBjb25maWd1cmF0aW9uOyB1c2VkIGlmIG5vIHNwZWNpZmljIGZp\nZWxkcwogICAgICogbXVzdCBiZSBsb2FkZWQsIGFuZCB1c2VkIHdoZW4gc2Vs\nZWN0aW5nIHJlbGF0aW9ucwogICAgICogQHBhcmFtIGVhZ2VyIGVhZ2VyIGZl\ndGNoIG1vZGUgdG8gdXNlCiAgICAgKiBAcGFyYW0gaWRlbnQgd2hldGhlciB0\nbyBzZWxlY3QgcHJpbWFyeSBrZXkgY29sdW1ucyBhcyBkaXN0aW5jdAogICAg\nICogaWRlbnRpZmllcnMKICAgICAqIEBwYXJhbSBvdXRlciB3aGV0aGVyIHdl\nJ3JlIG91dGVyLWpvaW5pbmcgdG8gdGhpcyB0eXBlCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhlIHNlbGVjdCBpcyByZXF1aXJlZCwgZmFsc2Ugb3RoZXJ3\naXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTZWxlY3Qg\nc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YnMsCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgZWFnZXIsIGJv\nb2xlYW4gaWRlbnQsIGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAvLyBhZGQg\nY2xhc3MgY29uZGl0aW9ucyBzbyB0aGF0IHRoZXkncmUgY2xvbmVkIGZvciBh\nbnkgYmF0Y2hlZCBzZWxlY3RzCiAgICAgICAgYm9vbGVhbiBqb2luZWRTdXBl\ncnMgPSBmYWxzZTsKICAgICAgICBpZiAoKHNtID09IG51bGwgfHwgc20uZ2V0\nUENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKQogICAgICAgICAgICAm\nJiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJzID09IFNl\nbGVjdC5TVUJTX05PTkUpKSB7CiAgICAgICAgICAgIGxvYWRTdWJjbGFzc2Vz\nKG1hcHBpbmcpOyAKICAgICAgICAgICAgSm9pbnMgam9pbnMgPSAob3V0ZXIp\nID8gc2VsLm5ld091dGVySm9pbnMoKSA6IG51bGw7CiAgICAgICAgICAgIGpv\naW5lZFN1cGVycyA9IG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpLmFkZENs\nYXNzQ29uZGl0aW9ucyhzZWwsCiAgICAgICAgICAgICAgICBzdWJzID09IFNl\nbGVjdC5TVUJTX0pPSU5BQkxFLCBqb2lucyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBjcmVhdGUgYWxsIG91ciBlYWdlciBzZWxlY3RzIHNvIHRoYXQgdGhv\nc2UgZmllbGRzIGFyZSByZXNlcnZlZAogICAgICAgIC8vIGFuZCBjYW5ub3Qg\nYmUgcmV1c2VkIGR1cmluZyB0aGUgYWN0dWFsIGVhZ2VyIHNlbGVjdCBwcm9j\nZXNzLAogICAgICAgIC8vIHByZXZlbnRpbmcgaW5maW5pdGUgcmVjdXJzaW9u\nCiAgICAgICAgZWFnZXIgPSBNYXRoLm1pbihlYWdlciwgZmV0Y2guZ2V0RWFn\nZXJGZXRjaE1vZGUoKSk7CiAgICAgICAgRmllbGRNYXBwaW5nIGVhZ2VyVG9N\nYW55ID0gY3JlYXRlRWFnZXJTZWxlY3RzKHNlbCwgbWFwcGluZywgc20sIGZp\nZWxkcywKICAgICAgICAgICAgZmV0Y2gsIGVhZ2VyKTsKCiAgICAgICAgLy8g\nc2VsZWN0IGFsbCBiYXNlIGNsYXNzIG1hcHBpbmdzOyBkbyB0aGlzIGFmdGVy\nIGJhdGNoaW5nIHNvIHRoYXQKICAgICAgICAvLyB0aGUgam9pbnMgbmVlZGVk\nIGJ5IHRoZXNlIHNlbGVjdHMgZG9uJ3QgZ2V0IGluIHRoZSBXSEVSRSBjbGF1\nc2UKICAgICAgICAvLyBvZiB0aGUgYmF0Y2hlZCBzZWxlY3RzCiAgICAgICAg\naW50IHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBtYXBwaW5nLCBt\nYXBwaW5nLCBzbSwgZmllbGRzLAogICAgICAgICAgICBmZXRjaCwgZWFnZXIs\nIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkU3VwZXJzKTsKCiAgICAgICAg\nLy8gc2VsZWN0IGVhZ2VyIHRvLW1hbnkgcmVsYXRpb25zIGxhc3QgYmVjYXVz\nZSBkdXJpbmcgbG9hZCB0aGV5CiAgICAgICAgLy8gYWR2YW5jZSB0aGUgcmVz\ndWx0IHNldCBhbmQgY291bGQgZXhoYXVzdCBpdCwgc28gbm8gb3RoZXIgbWFw\ncGluZ3MKICAgICAgICAvLyBjYW4gbG9hZCBhZnRlcndvcmRzCiAgICAgICAg\naWYgKGVhZ2VyVG9NYW55ICE9IG51bGwpCiAgICAgICAgICAgIGVhZ2VyVG9N\nYW55LnNlbGVjdEVhZ2VySm9pbihzZWwsIHNtLCB0aGlzLCAKICAgICAgICAg\nICAgICAgIGZldGNoLnRyYXZlcnNlSkRCQyhlYWdlclRvTWFueSksIGVhZ2Vy\nKTsKCiAgICAgICAgLy8gb3B0aW9uYWxseSBzZWxlY3Qgc3ViY2xhc3MgbWFw\ncGluZ3MKICAgICAgICBpZiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJM\nRSB8fCBzdWJzID09IFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSkKICAgICAg\nICAgICAgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhzZWwsIG1hcHBpbmcsIHNt\nLCBmZXRjaCk7CiAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAg\nIHNlbC5zZXREaXN0aW5jdChmYWxzZSk7CiAgICAgICAgcmV0dXJuIHNlbGQg\nPiAwOwogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGUgZmllbGRzIG9m\nIHRoaXMgbWFwcGluZyBhcyByZXNlcnZlZCBzbyB0aGF0IGVhZ2VyIGZldGNo\nZXMgY2FuJ3QKICAgICAqIGdldCBpbnRvIGluZmluaXRlIHJlY3Vyc2l2ZSBz\naXR1YXRpb25zLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFwcGluZyBj\ncmVhdGVFYWdlclNlbGVjdHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0\nIGZpZWxkcywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAg\nICBpbnQgZWFnZXIpIHsKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8\nIGVhZ2VyID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxkTWFwcGlu\nZyBlYWdlclRvTWFueSA9IGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWwsIAogICAg\nICAgICAgICBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpLCBzbSwgZmllbGRzLCBmZXRjaCwgZWFnZXIpOwoKICAgICAgICBGaWVs\nZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBp\nbmdzKCk7CiAgICAgICAgYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNlbC5oYXNF\nYWdlckpvaW4oZmFsc2UpOwogICAgICAgIGludCBzZWxzOwogICAgICAgIGlu\ndCBqdHlwZTsKICAgICAgICBpbnQgbW9kZTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtb2Rl\nID0gZm1zW2ldLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIGlm\nIChtb2RlID09IGZldGNoLkVBR0VSX05PTkUpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgaWYgKCFyZXF1aXJlc1NlbGVjdChmbXNb\naV0sIHNtLCBmaWVsZHMsIGZldGNoKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRoIGpvaW4g\nZmlyc3QKICAgICAgICAgICAganR5cGUgPSAoZm1zW2ldLmdldE51bGxWYWx1\nZSgpID09IGZtc1tpXS5OVUxMX0VYQ0VQVElPTikgCiAgICAgICAgICAgICAg\nICA/IHNlbC5FQUdFUl9JTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsKICAgICAg\nICAgICAgaWYgKG1vZGUgIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwgJiYgIWZt\nc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYm\nIGZtc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywg\nZmV0Y2gpID4gMAogICAgICAgICAgICAgICAgJiYgc2VsLmVhZ2VyQ2xvbmUo\nZm1zW2ldLCBqdHlwZSwgZmFsc2UsIDEpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGJvb2xlYW4gaGFzSm9pbiA9\nIGZldGNoLmhhc0pvaW4oZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNlKSk7Cgog\nICAgICAgICAgICAvLyBpZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBwcmVmZXJy\nZWQgc2VsZWN0IG1vZGUgb2Ygam9pbiBvciBkb2VzIG5vdAogICAgICAgICAg\nICAvLyBoYXZlIGEgcHJlZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRvaW5nIGEg\nYnktaWQgbG9va3VwLCB0cnkKICAgICAgICAgICAgLy8gdG8gdXNlIGEgdG8t\nbWFueSBqb2luIGFsc28uICBjdXJyZW50bHkgd2UgbGltaXQgZWFnZXIKICAg\nICAgICAgICAgLy8gb3V0ZXIgam9pbnMgdG8gbm9uLUxSUywgbm9uLXJhbmdl\nZCBzZWxlY3RzIHRoYXQgZG9uJ3QgYWxyZWFkeQogICAgICAgICAgICAvLyBo\nYXZlIGFuIGVhZ2VyIHRvLW1hbnkgam9pbgogICAgICAgICAgICBpZiAoKGhh\nc0pvaW4gfHwgbW9kZSA9PSBmZXRjaC5FQUdFUl9KT0lOIAogICAgICAgICAg\nICAgICAgfHwgKG1vZGUgPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAhPSBudWxs\nKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9N\nYW55KCkKICAgICAgICAgICAgICAgICYmICFpbkVhZ2VySm9pbgogICAgICAg\nICAgICAgICAgJiYgIXNlbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAgICAgICAg\nICAgICAgICYmICghc2VsLmdldEF1dG9EaXN0aW5jdCgpIHx8ICghc2VsLmlz\nTFJTKCkKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRTdGFydEluZGV4KCkg\nPT0gMCAKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09\nIExvbmcuTUFYX1ZBTFVFKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5z\ndXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4g\nMCkgewogICAgICAgICAgICAgICAgaWYgKHNlbC5lYWdlckNsb25lKGZtc1tp\nXSwganR5cGUsIHRydWUsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGZpbmFsbHksIHRyeSBwYXJhbGxlbAogICAgICAg\nICAgICBpZiAoZWFnZXIgPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwKICAgICAg\nICAgICAgICAgICYmIChzZWxzID0gZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNl\nbCwgc2VsLkVBR0VSX1BBUkFMTEVMLCBzbSwKICAgICAgICAgICAgICAgIHRo\naXMsIGZldGNoKSkgIT0gMCkKICAgICAgICAgICAgICAgIHNlbC5lYWdlckNs\nb25lKGZtc1tpXSwgU2VsZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAgICAgICAg\nICAgICAgICAgICBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpLCBzZWxz\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAg\nfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZlbiBmaWVs\nZCBuZWVkcyB0byBiZSBzZWxlY3RlZC4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiByZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBpbmcgZm0s\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxk\ncywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlm\nIChmaWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5n\nZXQoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYg\nc20uZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAgICAgICAg\nICAgICYmIHNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBmZXRjaC5y\nZXF1aXJlc0ZldGNoKGZtKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hf\nTE9BRDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZmllbGQg\nbWFwcGluZ3Mgb2YgdGhlIGdpdmVuIGNsYXNzIGFuZCBhbGwgaXRzIHN1cGVy\nY2xhc3Nlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3Qg\ndG8gdXNlCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbW9zdC1kZXJpdmVk\nIHR5cGUgdG8gc2VsZWN0IGZvcgogICAgICogQHBhcmFtIG9yaWcgdGhlIG9y\naWdpbmFsIG1hcHBpbmcgdHlwZSBzZWxlY3RlZAogICAgICogQHBhcmFtIHNt\nIHRoZSBpbnN0YW5jZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYg\nbm9uZQogICAgICogQHBhcmFtIGZpZWxkcyB0aGUgZmllbGRzIHRvIGxvYWQK\nICAgICAqIEBwYXJhbSBmZXRjaCBmZXRjaCBjb25maWd1cmF0aW9uIHRvIHVz\nZSBmb3IgbG9hZGluZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciB0\naGUgZWFnZXIgZmV0Y2ggbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBqb2lu\nZWQgd2hldGhlciB0aGUgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBqb2luZWQg\nZG93biB0bwogICAgICogaXRzIGJhc2UgY2xhc3MKICAgICAqIEByZXR1cm4g\nJmd0OyAwIGlmIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIDAgaWYgZGF0YSB3\nYXMKICAgICAqIHNlbGVjdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQsIGFuZCAm\nbHQ7IDAgaWYgbm90aGluZyB3YXMgc2VsZWN0ZWQKICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgc2VsZWN0QmFzZU1hcHBpbmdzKFNlbGVjdCBzZWwsIENsYXNz\nTWFwcGluZyBtYXBwaW5nLAogICAgICAgIENsYXNzTWFwcGluZyBvcmlnLCBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwgRmll\nbGRNYXBwaW5nIGVhZ2VyVG9NYW55LAogICAgICAgIGJvb2xlYW4gaWRlbnQs\nIGJvb2xlYW4gam9pbmVkKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVu\ndCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7\nCiAgICAgICAgaWYgKHBhcmVudCA9PSBudWxsICYmICFtYXBwaW5nLmlzTWFw\ncGVkKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoInZpcnR1YWwtbWFwcGluZyIsIG1hcHBpbmcuCiAg\nICAgICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkpKTsKCiAgICAgICAg\naW50IHNlbGQgPSAtMTsKICAgICAgICBpbnQgcHNlbGQgPSAtMTsKCiAgICAg\nICAgLy8gYmFzZSBjbGFzcyBzZWxlY3RzIHBrcywgZXRjCiAgICAgICAgaWYg\nKHBhcmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIGluc3Rh\nbmNlLCBzZWxlY3QgcGtzCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaWRlbnQpCiAgICAgICAgICAgICAgICAg\nICAgc2VsLnNlbGVjdElkZW50aWZpZXIobWFwcGluZy5nZXRQcmltYXJ5S2V5\nQ29sdW1ucygpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVt\nbnMoKSk7CiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaWYgbm8gaW5zdGFuY2Ugb3Igbm90IGluaXRp\nYWxpemVkIGFuZCBub3QgZXhhY3Qgb2lkLCBzZWxlY3QgdHlwZQogICAgICAg\nICAgICBpZiAoKHNtID09IG51bGwgfHwgKHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLlRSQU5TSUVOVCAKICAgICAgICAgICAgICAgICYmICghKHNtLmdl\ndE9iamVjdElkKCkgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIAogICAgICAgICAg\nICAgICAgfHwgKChPcGVuSlBBSWQpIHNtLmdldE9iamVjdElkKCkpLmhhc1N1\nYmNsYXNzZXMoKSkpKQogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXRE\naXNjcmltaW5hdG9yKCkuc2VsZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAg\nICAgICBzZWxkID0gMTsKCiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNl\nIG9yIG5vIHZlcnNpb24sIHNlbGVjdCB2ZXJzaW9uCiAgICAgICAgICAgIGlm\nICgoc20gPT0gbnVsbCB8fCBzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICYmIG1hcHBpbmcuZ2V0VmVyc2lvbigpLnNlbGVjdChz\nZWwsIG9yaWcpKQogICAgICAgICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVjdXJzZSBvbiBwYXJlbnQKICAg\nICAgICAgICAgcHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBwYXJl\nbnQsIG9yaWcsIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBmZXRjaCwg\nZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZ3MgaW4gdGhlIGdpdmVu\nIGZpZWxkcyBzZXQsIG9yIGJhc2VkIG9uIGZldGNoCiAgICAgICAgLy8gY29u\nZmlndXJhdGlvbiBpZiBubyBmaWVsZHMgZ2l2ZW4KICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgU2VsZWN0RXhlY3V0b3IgZXNlbDsKICAgICAgICBpbnQg\nZnNlbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgLy8gc2tpcCBlYWdlciB0by1tYW55IHNl\nbGVjdDsgd2UgZG8gdGhhdCBzZXBhcmF0ZWx5IGluIGNhbGxpbmcKICAgICAg\nICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gZWFn\nZXJUb01hbnkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIC8vIGNoZWNrIGZvciBlYWdlciBzZWxlY3QKICAgICAgICAgICAgZXNl\nbCA9IHNlbC5nZXRFYWdlcihmbXNbaV0pOwogICAgICAgICAgICBpZiAoZXNl\nbCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZXNlbCA9PSBzZWwp\nCiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VySm9pbihz\nZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJh\ndmVyc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJQYXJh\nbGxlbChlc2VsLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZl\ndGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAg\nICAgICBzZWxkID0gTWF0aC5tYXgoMCwgc2VsZCk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAocmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmllbGRzLCBm\nZXRjaCkpIHsKICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVj\ndChzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2\nZXJzZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2Vs\nZCA9IE1hdGgubWF4KGZzZWxkLCBzZWxkKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChvcHRTZWxlY3QoZm1zW2ldLCBzZWwsIHNtLCBmZXRjaCkpIHsKICAg\nICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0\naGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1z\nW2ldKSwgZmV0Y2guRUFHRVJfTk9ORSk7CgogICAgICAgICAgICAgICAgLy8g\nZG9uJ3QgdXBncmFkZSBzZWxkIHRvID4gMCBiYXNlZCBvbiB0aGVzZSBmaWVs\nZHMsIHNpbmNlCiAgICAgICAgICAgICAgICAvLyB0aGV5J3JlIG5vdCBpbiB0\naGUgY2FsY3VsYXRlZCBmaWVsZCBzZXQKICAgICAgICAgICAgICAgIGlmIChm\nc2VsZCA+PSAwICYmIHNlbGQgPCAwKQogICAgICAgICAgICAgICAgICAgIHNl\nbGQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBq\nb2luIHRvIHBhcmVudCB0YWJsZSBpZiB0aGUgcGFyZW50IC8gYW55IGFuY2Vz\ndG9ycyBoYXZlIHNlbGVjdGVkCiAgICAgICAgLy8gYW55dGhpbmcKICAgICAg\nICBpZiAoIWpvaW5lZCAmJiBwc2VsZCA+PSAwICYmIHBhcmVudC5nZXRUYWJs\nZSgpICE9IG1hcHBpbmcuZ2V0VGFibGUoKSkKICAgICAgICAgICAgc2VsLndo\nZXJlKG1hcHBpbmcuam9pblN1cGVyY2xhc3Moc2VsLm5ld0pvaW5zKCksIGZh\nbHNlKSk7CgogICAgICAgIC8vIHJldHVybiB0aGUgaGlnaGVzdCB2YWx1ZQog\nICAgICAgIHJldHVybiBNYXRoLm1heChwc2VsZCwgc2VsZCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGVuIHNlbGVjdGluZyBmaWVsZGVzLCBhIHNwZWNp\nYWwgY2FzZSBpcyBtYWRlIGZvciBtYXBwaW5ncyB0aGF0IHVzZQogICAgICog\nMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QgZXhwbGljaXRseSAqbm90KiBp\nbiB0aGUgZGZnIHNvIHRoYXQgdGhleQogICAgICogY2FuIGdldCB0aGVpciBw\ncmltYXJ5IHRhYmxlIGRhdGEuIFRoaXMgbWV0aG9kIHRlc3RzIGZvciB0aGF0\nIHNwZWNpYWwKICAgICAqIGNhc2UgYXMgYW4gb3B0aW1pemF0aW9uLgogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gb3B0U2VsZWN0KEZpZWxkTWFwcGlu\nZyBmbSwgU2VsZWN0IHNlbCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAg\ncmV0dXJuICFmbS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAg\nICAgJiYgIWZtLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdCgpCiAgICAg\nICAgICAgICYmIChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLlRSQU5TSUVOVCAKICAgICAgICAgICAgfHwgIXNtLmdldExvYWRl\nZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgJiYgZm0uc3Vw\ncG9ydHNTZWxlY3Qoc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMs\nIGZldGNoKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZmll\nbGQgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmln\ndXJhdGlvbiBmb3IKICAgICAqIHN1YmNsYXNzZXMgb2YgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVz\nZQogICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIHR5cGUgd2hvc2Ugc3ViY2xh\nc3NlcyB0byBzZWxlY3QKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFuY2Ug\nYmVpbmcgc2VsZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAgICAqIEBw\nYXJhbSBmZXRjaCB0aGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhTZWxlY3Qg\nc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7\nCiAgICAgICAgbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5nLmdldEpvaW5hYmxl\nUENTdWJjbGFzc01hcHBpbmdzKCk7CiAgICAgICAgaWYgKHN1Yk1hcHBpbmdz\nLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8v\nIHNlbGVjdCBhbGwgc3ViY2xhc3MgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUg\nZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAgIC8vIGFuZCB3aG9zZSB0YWJs\nZSBpcyBpbiB0aGUgbGlzdCBvZiB0aG9zZSBzZWxlY3RlZCBzbyBmYXI7IHRo\naXMKICAgICAgICAvLyB3YXkgd2Ugc2VsZWN0IHRoZSBtYXggcG9zc2libGUg\nd2l0aG91dCBzZWxlY3RpbmcgYW55IHRhYmxlcyB0aGF0CiAgICAgICAgLy8g\nYXJlbid0IHByZXNlbnQgaW4gYWxsIHBvc3NpYmxlIHF1ZXJ5IG1hdGNoZXM7\nIGEgc3BlY2lhbCBjYXNlCiAgICAgICAgLy8gaXMgbWFkZSBmb3IgbWFwcGlu\nZ3MgdGhhdCB1c2UgMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QKICAgICAg\nICAvLyBleHBsaWNpdGx5ICpub3QqIGluIHRoZSBkZWZhdWx0IHNvIHRoYXQg\ndGhleSBjYW4gZ2V0IHRoZWlyCiAgICAgICAgLy8gcHJpbWFyeSB0YWJsZSBk\nYXRhCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zOwogICAgICAgIGJvb2xl\nYW4gam9pbmVkOwogICAgICAgIGJvb2xlYW4gY2FuSm9pbiA9IF9kaWN0Lmpv\naW5TeW50YXggIT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTAog\nICAgICAgICAgICAmJiBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBw\naW5nKSAhPSBmZXRjaC5FQUdFUl9OT05FOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc3ViTWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgaWYgKCFzdWJNYXBwaW5nc1tpXS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNl\nbCwgc20sIHRoaXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICBmZXRjaCkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGlu\naXRpYWxpemUgc28gdGhhdCBpZiB3ZSBjYW4ndCBqb2luLCB3ZSBwcmV0ZW5k\nIHdlIGFscmVhZHkgaGF2ZQogICAgICAgICAgICBqb2luZWQgPSAhY2FuSm9p\nbjsKICAgICAgICAgICAgZm1zID0gc3ViTWFwcGluZ3NbaV0uZ2V0RGVmaW5l\nZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCBmbXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSBpbiBvbmUgb2YgY29uZmlndXJlZCBmZXRjaCBncm91cHMKICAg\nICAgICAgICAgCWlmIChmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tqXSkgIT0g\nRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX0xPQUQKICAgICAgICAgICAgICAg\nICAgICAmJiAoKCFmbXNbal0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAg\nICAgICAgICAgICAgICAgICAgJiYgZm1zW2pdLmlzRGVmYXVsdEZldGNoR3Jv\ndXBFeHBsaWNpdCgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZtc1tqXS5z\ndXBwb3J0c1NlbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhp\ncywgCiAgICAgICAgICAgICAgICAgICAgZmV0Y2gpIDw9IDApKSAKICAgICAg\nICAgICAgCQljb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBj\nYW4gam9pbiB0byB0aGUgc3ViY2xhc3MsIGRvIHNvOyBtdWNoIGJldHRlciBj\naGFuY2UKICAgICAgICAgICAgICAgIC8vIHRoYXQgdGhlIGZpZWxkIHdpbGwg\nYmUgYWJsZSB0byBzZWxlY3QgaXRzZWxmIHdpdGhvdXQgam9pbnMKICAgICAg\nICAgICAgICAgIGlmICgham9pbmVkKSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8gbWFyayBqb2luZWQgd2hldGhlciBvciBub3Qgd2Ugam9pbiwgc28gd2Ug\nZG9uJ3QgaGF2ZSB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgY29u\nZGl0aW9ucyBhZ2FpbiBmb3IgdGhpcyBzdWJjbGFzcwogICAgICAgICAgICAg\nICAgICAgIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2Vs\nLndoZXJlKGpvaW5TdWJjbGFzcyhzZWwsIG1hcHBpbmcsIHN1Yk1hcHBpbmdz\nW2ldLCBudWxsKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgLy8gaWYgY2FuIHNlbGVjdCB3aXRoIHRhYmxlcyBhbHJlYWR5IHNlbGVj\ndGVkLCBkbyBpdAogICAgICAgICAgICAgICAgaWYgKGZtc1tqXS5zdXBwb3J0\nc1NlbGVjdChzZWwsIHNlbC5UWVBFX0pPSU5MRVNTLCBzbSwgdGhpcywKICAg\nICAgICAgICAgICAgICAgICBmZXRjaCkgPiAwKQogICAgICAgICAgICAgICAg\nICAgIGZtc1tqXS5zZWxlY3Qoc2VsLCBudWxsLCB0aGlzLCBmZXRjaC50cmF2\nZXJzZUpEQkMoZm1zW2pdKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0\nY2guRUFHRVJfTk9ORSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGpvaW4gZnJvbSBj\nbGFzcyB0byBpdHMgc3ViY2xhc3MuIFJlY3Vyc2l2ZSB0byBhbGxvdwogICAg\nICogZm9yIG11bHRpcGxlIGhvcHMsIHN0YXJ0aW5nIGZyb20gdGhlIGJhc2Ug\nY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpvaW5zIGpvaW5T\ndWJjbGFzcyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgYmFzZSwKICAgICAg\nICBDbGFzc01hcHBpbmcgc3ViLCBKb2lucyBqb2lucykgewogICAgICAgIGlm\nIChzdWIgPT0gYmFzZSB8fCBzdWIuZ2V0VGFibGUoKSA9PSBiYXNlLmdldFRh\nYmxlKCkKICAgICAgICAgICAgfHwgc2VsLmlzU2VsZWN0ZWQoc3ViLmdldFRh\nYmxlKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8g\ncmVjdXJzZSBmaXJzdCBzbyB3ZSBnbyBsZWFzdC0+bW9zdCBkZXJpdmVkCiAg\nICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IHN1Yi5nZXRKb2luYWJsZVBDU3Vw\nZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBqb2lucyA9IGpvaW5TdWJjbGFz\ncyhzZWwsIGJhc2UsIHN1cCwgam9pbnMpOwogICAgICAgIGlmIChqb2lucyA9\nPSBudWxsKQogICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygpOwog\nICAgICAgIHJldHVybiBzdWIuam9pblN1cGVyY2xhc3Moam9pbnMsIHRydWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgc3VyZSBhbGwgc3ViY2xh\nc3NlcyBvZiB0aGUgZ2l2ZW4gdHlwZSBhcmUgbG9hZGVkIGluIHRoZSBKVk0u\nCiAgICAgKiBUaGlzIGlzIHVzdWFsbHkgZG9uZSBhdXRvbWF0aWNhbGx5Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBsb2FkU3ViY2xhc3NlcyhDbGFzc01h\ncHBpbmcgbWFwcGluZykgewogICAgICAgIERpc2NyaW1pbmF0b3IgZHNjID0g\nbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCk7CiAgICAgICAgaWYgKGRzYy5n\nZXRTdWJjbGFzc2VzTG9hZGVkKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gaWYgdGhlIHN1YmNsYXNzIGxpc3QgaXMgc2V0LCBubyBuZWVk\nIHRvIGxvYWQgc3VicwogICAgICAgIGlmIChtYXBwaW5nLmdldFJlcG9zaXRv\ncnkoKS5nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAgICAgICAg\nICBfY3R4LmdldENsYXNzTG9hZGVyKCkpICE9IG51bGwpIHsKICAgICAgICAg\nICAgZHNjLnNldFN1YmNsYXNzZXNMb2FkZWQodHJ1ZSk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGRzYy5sb2FkU3ViY2xhc3Nlcyh0aGlzKTsKICAgICAgICB9IGNhdGNoIChD\nbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNl\ncHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTWFrZSB0aGUgc3RhdGVtZW50IGEgY2FuZGlkYXRl\nIGZvciBjYW5jZWxsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBi\nZWZvcmVFeGVjdXRlU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAg\nICAgIF9zdG1udHMuYWRkKHN0bW50KTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbW92ZSB0aGUgc3RhdGVtZW50IGZyb20gdGhlIGNhbmNlbGxhYmxlIHNl\ndC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFmdGVyRXhlY3V0ZVN0YXRl\nbWVudChTdGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3RtbnRzLnJlbW92\nZShzdG1udCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHJl\ndHVybmVkIHRvIGNsaWVudCBjb2RlLiBNYWtlcyBzdXJlIGl0cyB3cmFwcGVk\nIGNvbm5lY3Rpb24KICAgICAqIHJlZiBjb3VudCBpcyBkZWNyZW1lbnRlZCBv\nbiBmaW5hbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nQ2xpZW50Q29ubmVjdGlvbiBleHRlbmRzIERlbGVnYXRpbmdDb25uZWN0aW9u\nIHsKCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsK\nCiAgICAgICAgcHVibGljIENsaWVudENvbm5lY3Rpb24oQ29ubmVjdGlvbiBj\nb25uKSB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4pOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgICAgIHN1\ncGVyLmNsb3NlKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9p\nZCBmaW5hbGl6ZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICBpZiAoIV9jbG9zZWQpCiAgICAgICAgICAgICAgICBjbG9zZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gd3JhcHBl\nciB0aGF0IGtlZXBzIGFuIGludGVybmFsIHJlZiBjb3VudCBzbyB0aGF0IGl0\nIGtub3dzCiAgICAgKiB3aGVuIHRvIHJlYWxseSBjbG9zZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGNsYXNzIFJlZkNvdW50Q29ubmVjdGlvbiBleHRlbmRz\nIERlbGVnYXRpbmdDb25uZWN0aW9uIHsKCiAgICAgICAgcHJpdmF0ZSBib29s\nZWFuIF9yZXRhaW4gPSBmYWxzZTsKICAgICAgICBwcml2YXRlIGludCBfcmVm\ncyA9IDA7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9mcmVlZCA9IGZhbHNl\nOwoKICAgICAgICBwdWJsaWMgUmVmQ291bnRDb25uZWN0aW9uKENvbm5lY3Rp\nb24gY29ubikgewogICAgICAgICAgICBzdXBlcihjb25uKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGdldFJldGFpbigpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9yZXRhaW47CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzZXRSZXRhaW4oYm9vbGVhbiByZXRhaW4pIHsKICAgICAgICAg\nICAgaWYgKF9yZXRhaW4gJiYgIXJldGFpbiAmJiBfcmVmcyA8PSAwKQogICAg\nICAgICAgICAgICAgZnJlZSgpOwogICAgICAgICAgICBfcmV0YWluID0gcmV0\nYWluOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVmKCkgewog\nICAgICAgICAgICAvLyBkb24ndCBoYXZlIHRvIGxvY2s7IGNhbGxlZCBmcm9t\nIGNvbm5lY3QoKSwgd2hpY2ggaXMgbG9ja2VkCiAgICAgICAgICAgIF9yZWZz\nKys7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAvLyBsb2NrIGF0IGJy\nb2tlciBsZXZlbCB0byBhdm9pZCBkZWFkbG9ja3MKICAgICAgICAgICAgX2N0\neC5sb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBf\ncmVmcy0tOwogICAgICAgICAgICAgICAgaWYgKF9yZWZzIDw9IDAgJiYgIV9y\nZXRhaW4pCiAgICAgICAgICAgICAgICAgICAgZnJlZSgpOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2N0eC51bmxvY2soKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nZnJlZSgpIHsKICAgICAgICAgICAgLy8gZW5zdXJlIHRoYXQgd2UgZG8gbm90\nIGNsb3NlIHRoZSB1bmRlcmx5aW5nIGNvbm5lY3Rpb24KICAgICAgICAgICAg\nLy8gbXVsdGlwbGUgdGltZXM7IHRoaXMgY291bGQgaGFwcGVuIGlmIHNvbWVv\nbmUgKGUuZy4sIGFuCiAgICAgICAgICAgIC8vIEV4dGVudCkgaG9sZHMgYSBS\nZWZDb25uZWN0aW9uLCBhbmQgdGhlbiBjbG9zZXMgaXQgKGUuZy4sIGluCiAg\nICAgICAgICAgIC8vIHRoZSBmaW5hbGl6ZXIpIGFmdGVyIHRoZSBTdG9yZU1h\nbmFnZXIgaGFzIGFscmVhZHkgYmVlbiBjbG9zZWQuCiAgICAgICAgICAgIGlm\nIChfZnJlZWQpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgZ2V0RGVsZWdhdGUoKS5jbG9zZSgp\nOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBfZnJlZWQgPSB0cnVlOwogICAgICAg\nICAgICBfY29ubiA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0\nZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudChib29sZWFuIHdyYXApIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3IENh\nbmNlbFN0YXRlbWVudChzdXBlci5jcmVhdGVTdGF0ZW1lbnQoZmFsc2UpLAog\nICAgICAgICAgICAgICAgUmVmQ291bnRDb25uZWN0aW9uLnRoaXMpOwogICAg\nICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0YXRlbWVudCBjcmVhdGVTdGF0\nZW1lbnQoaW50IHJzVHlwZSwgaW50IHJzQ29uY3VyLAogICAgICAgICAgICBi\nb29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICByZXR1cm4gbmV3IENhbmNlbFN0YXRlbWVudChzdXBlci5jcmVhdGVTdGF0\nZW1lbnQocnNUeXBlLCByc0NvbmN1ciwKICAgICAgICAgICAgICAgIGZhbHNl\nKSwgUmVmQ291bnRDb25uZWN0aW9uLnRoaXMpOwogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1l\nbnQoU3RyaW5nIHNxbCwgYm9vbGVhbiB3cmFwKQogICAgICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5j\nZWxQcmVwYXJlZFN0YXRlbWVudChzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNx\nbCwKICAgICAgICAgICAgICAgIGZhbHNlKSwgUmVmQ291bnRDb25uZWN0aW9u\nLnRoaXMpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVk\nU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwgaW50IHJz\nVHlwZSwKICAgICAgICAgICAgaW50IHJzQ29uY3VyLCBib29sZWFuIHdyYXAp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3\nIENhbmNlbFByZXBhcmVkU3RhdGVtZW50KHN1cGVyLnByZXBhcmVTdGF0ZW1l\nbnQoc3FsLAogICAgICAgICAgICAgICAgcnNUeXBlLCByc0NvbmN1ciwgZmFs\nc2UpLCBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFu\nZCByZW1vdmVzIGl0c2VsZiBmcm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAg\nKiBzdGF0ZW1lbnRzIHNvIHRoYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAg\nICovCiAgICBwcml2YXRlIGNsYXNzIENhbmNlbFN0YXRlbWVudCBleHRlbmRz\nIERlbGVnYXRpbmdTdGF0ZW1lbnQgewoKICAgICAgICBwdWJsaWMgQ2FuY2Vs\nU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCwgQ29ubmVjdGlvbiBjb25uKSB7\nCiAgICAgICAgICAgIHN1cGVyKHN0bW50LCBjb25uKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZShTdHJpbmcgc3FsKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0\nZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlVXBkYXRlKHNxbCk7CiAgICAg\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1\ndGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KFN0cmlu\nZyBzcWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQo\ndGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZXhlY3V0ZVF1ZXJ5KHNxbCwgd3JhcCk7CiAgICAgICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0\nZW1lbnQodGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTdGF0ZW1lbnQgdHlwZSB0aGF0IGFkZHMgYW5kIHJl\nbW92ZXMgaXRzZWxmIGZyb20gdGhlIHNldCBvZiBhY3RpdmUKICAgICAqIHN0\nYXRlbWVudHMgc28gdGhhdCBpdCBjYW4gYmUgY2FuY2VsZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgY2xhc3MgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQgZXh0\nZW5kcyBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQgewoKICAgICAgICBw\ndWJsaWMgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIAogICAgICAgICAgICBDb25uZWN0aW9uIGNvbm4pIHsKICAg\nICAgICAgICAgc3VwZXIoc3RtbnQsIGNvbm4pOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBleGVjdXRlVXBkYXRlKCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhp\ncyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwZXIuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQg\nUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShib29sZWFuIHdyYXApIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVt\nZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLmV4ZWN1dGVRdWVyeSh3cmFwKTsKICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRl\nbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludFtdIGV4ZWN1dGVCYXRjaCgpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLmV4ZWN1dGVCYXRjaCgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMg\nTWFwIGdldENhY2hlTWFwRnJvbVF1ZXJ5U1FMQ2FjaGUoT2JqZWN0IGtleSkg\newogICAgICAgIHN5bmNocm9uaXplZChfc3FsQ2FjaGUpIHsKICAgICAgICAg\nICAgLy9zcWxDYWNoZSBpcyBhIG1hcCBvZiBtYXAKICAgICAgICAgICAgTWFw\nIGNhY2hlTWFwID0gKE1hcClfc3FsQ2FjaGUuZ2V0KGtleSk7CiAgICAgICAg\nICAgIGlmIChjYWNoZU1hcCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBj\nYWNoZU1hcCA9IGNyZWF0ZVNRTENhY2hlKCk7CiAgICAgICAgICAgICAgICBf\nc3FsQ2FjaGUucHV0KGtleSwgY2FjaGVNYXApOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBjYWNoZU1hcDsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIGFkZFRvU3FsQ2FjaGUoTWFwIGNhY2hlTWFw\nLCBPYmplY3Qga2V5LCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBjYWNoZU1h\ncC5wdXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBNYXAg\nY3JlYXRlU1FMQ2FjaGUoKSB7CiAgICAgICAgUXVlcnlTUUxDYWNoZVZhbHVl\nIHF1ZXJ5U1FMQ2FjaGUgPSBfY29uZi5nZXRRdWVyeVNRTENhY2hlKCk7CiAg\nICAgICAgcmV0dXJuIChNYXApcXVlcnlTUUxDYWNoZS5uZXdJbnN0YW5jZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUXVlcnlTUUxDYWNoZU9u\nKCkgewogICAgICAgIHJldHVybiBfaXNRdWVyeVNRTENhY2hlOyAgCiAgICB9\nCiAgICAKICAgIHB1YmxpYyBNYXAgZ2V0UXVlcnlTUUxDYWNoZSgpIHsKICAg\nICAgICByZXR1cm4gX3NxbENhY2hlOwogICAgfQogICAgCiAgICBwdWJsaWMg\nc3RhdGljIGNsYXNzIFNlbGVjdEtleSB7CiAgICAgICAgcHVibGljIENsYXNz\nTWFwcGluZyBtYXBwaW5nOwogICAgICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcg\nZm07CiAgICAgICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2g7CiAgICAgICAgCiAgICAgICAgcHVibGljIFNlbGVjdEtleSAoQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIEZpZWxkTWFwcGluZyBmbSwgCiAgICAgICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICAgICAg\ndGhpcy5tYXBwaW5nID0gbWFwcGluZzsKICAgICAgICAgICAgdGhpcy5mbSA9\nIGZtOwogICAgICAgICAgICB0aGlzLmZldGNoID0gZmV0Y2g7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmpl\nY3QgbykgewogICAgICAgICAgICBpZiAodGhpcyA9PSBvKSByZXR1cm4gdHJ1\nZTsKICAgICAgICAgICAgaWYgKG8gPT0gbnVsbCB8fCBnZXRDbGFzcygpICE9\nIG8uZ2V0Q2xhc3MoKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgU2Vs\nZWN0S2V5IHNlbGVjdEtleSA9IChTZWxlY3RLZXkpIG87CiAgICAgICAgICAg\nIGlmIChmZXRjaCAhPSBudWxsID8gIWVxdWFscyhmZXRjaCwgc2VsZWN0S2V5\nLmZldGNoKSA6CiAgICAgICAgICAgICAgICBzZWxlY3RLZXkuZmV0Y2ggIT0g\nbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAobWFwcGluZyAh\nPSBudWxsID8gIW1hcHBpbmcuZXF1YWxzKHNlbGVjdEtleS5tYXBwaW5nKSA6\nCiAgICAgICAgICAgICAgICBzZWxlY3RLZXkubWFwcGluZyAhPSBudWxsKSBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChmbSAhPSBudWxsID8gIWZt\nLmVxdWFscyhzZWxlY3RLZXkuZm0pIDoKICAgICAgICAgICAgICAgIHNlbGVj\ndEtleS5mbSAhPSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBlcXVhbHMoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaDEs\nCiAgICAgICAgCUpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gyKSB7CiAg\nICAgICAgICAgIGlmIChmZXRjaDEgPT0gZmV0Y2gyKSAKICAgICAgICAgICAg\nCXJldHVybiB0cnVlOwoKICAgICAgICAgICAgaWYgKGZldGNoMS5nZXRJc29s\nYXRpb24oKSAhPSBmZXRjaDIuZ2V0SXNvbGF0aW9uKCkpIAogICAgICAgICAg\nICAJcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoZmV0Y2gxLmdldEZl\ndGNoRGlyZWN0aW9uKCkgIT0gZmV0Y2gyLmdldEZldGNoRGlyZWN0aW9uKCkp\nIAogICAgICAgICAgICAJcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAo\nZmV0Y2gxLmdldEVhZ2VyRmV0Y2hNb2RlKCkgIT0gZmV0Y2gyLmdldEVhZ2Vy\nRmV0Y2hNb2RlKCkpIAogICAgICAgICAgICAJcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICBpZiAoZmV0Y2gxLmdldFN1YmNsYXNzRmV0Y2hNb2RlKCkgIT0g\nZmV0Y2gyLmdldFN1YmNsYXNzRmV0Y2hNb2RlKCkpIAogICAgICAgICAgICAJ\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoZmV0Y2gxLmdldEpvaW5T\neW50YXgoKSAhPSBmZXRjaDIuZ2V0Sm9pblN5bnRheCgpKSAKICAgICAgICAg\nICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgU2V0IGpvaW5zMSA9IGZl\ndGNoMS5nZXRKb2lucygpOwogICAgICAgICAgICBTZXQgam9pbnMyID0gZmV0\nY2gyLmdldEpvaW5zKCk7CiAgICAgICAgICAgIGlmIChqb2luczEgIT0gbnVs\nbCA/ICFqb2luczEuZXF1YWxzKGpvaW5zMikgOiBqb2luczIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgCiAg\nICAgICAgICAgIGlmIChmZXRjaDEuZ2V0TWF4RmV0Y2hEZXB0aCgpICE9IGZl\ndGNoMi5nZXRNYXhGZXRjaERlcHRoKCkpIAogICAgICAgICAgICAJcmV0dXJu\nIGZhbHNlOwogICAgICAgICAgICBpZiAoZmV0Y2gxLmdldFJlYWRMb2NrTGV2\nZWwoKSAhPSBmZXRjaDIuZ2V0UmVhZExvY2tMZXZlbCgpKSAKICAgICAgICAg\nICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGZldGNoMS5nZXRX\ncml0ZUxvY2tMZXZlbCgpICE9IGZldGNoMi5nZXRXcml0ZUxvY2tMZXZlbCgp\nKSAKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgCiAg\nICAgICAgICAgIGJvb2xlYW4gc2FtZUZldGNoR3JvdXAgPSBmYWxzZTsKICAg\nICAgICAgICAgYm9vbGVhbiBoYXNGZXRjaEdyb3VwQWxsID0gKChKREJDRmV0\nY2hDb25maWd1cmF0aW9uSW1wbClmZXRjaDEpLgogICAgICAgICAgICAJaGFz\nRmV0Y2hHcm91cEFsbCgpOwogICAgICAgICAgICBib29sZWFuIGhhc0ZldGNo\nR3JvdXBBbGwxID0gKChKREJDRmV0Y2hDb25maWd1cmF0aW9uSW1wbClmZXRj\naDIpLgogICAgICAgICAgICAJaGFzRmV0Y2hHcm91cEFsbCgpOwogICAgICAg\nICAgICBpZiAoaGFzRmV0Y2hHcm91cEFsbCAmJiBoYXNGZXRjaEdyb3VwQWxs\nMSkgCiAgICAgICAgICAgICAgICBzYW1lRmV0Y2hHcm91cCA9IHRydWU7CiAg\nICAgICAgICAgIGVsc2UgaWYgKCFoYXNGZXRjaEdyb3VwQWxsICYmICFoYXNG\nZXRjaEdyb3VwQWxsMSl7CiAgICAgICAgICAgICAgICBib29sZWFuIGhhc0Zl\ndGNoR3JvdXBEZWZhdWx0ID0gCiAgICAgICAgICAgICAgICAJKChKREJDRmV0\nY2hDb25maWd1cmF0aW9uSW1wbClmZXRjaDEpLmhhc0ZldGNoR3JvdXBEZWZh\ndWx0KCk7CiAgICAgICAgICAgICAgICBib29sZWFuIGhhc0ZldGNoR3JvdXBE\nZWZhdWx0MSA9IAogICAgICAgICAgICAgICAgCSgoSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbkltcGwpZmV0Y2gyKS5oYXNGZXRjaEdyb3VwRGVmYXVsdCgpOwog\nICAgICAgICAgICAgICAgaWYgKGhhc0ZldGNoR3JvdXBEZWZhdWx0ICYmIGhh\nc0ZldGNoR3JvdXBEZWZhdWx0MSkgCiAgICAgICAgICAgICAgICAgICAgc2Ft\nZUZldGNoR3JvdXAgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIAogICAgICAgICAgICBpZiAoIXNhbWVGZXRjaEdyb3VwKSB7CiAgICAgICAg\nICAgICAgICBTZXQgZmV0Y2hHcm91cHMgPSBmZXRjaDEuZ2V0RmV0Y2hHcm91\ncHMoKTsKICAgICAgICAgICAgICAgIFNldCBmZXRjaEdyb3VwczEgPSBmZXRj\naDIuZ2V0RmV0Y2hHcm91cHMoKTsKICAgICAgICAgICAgICAgIGlmIChmZXRj\naEdyb3VwcyAhPSBudWxsID8gIWZldGNoR3JvdXBzLmVxdWFscyhmZXRjaEdy\nb3VwczEpIDogCiAgICAgICAgICAgICAgICAJZmV0Y2hHcm91cHMxICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBTZXQgZmllbGRzID0g\nZmV0Y2gxLmdldEZpZWxkcygpOwogICAgICAgICAgICBTZXQgZmllbGRzMSA9\nIGZldGNoMi5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IHNpemUgPSBm\naWVsZHMuc2l6ZSgpOwogICAgICAgICAgICBpbnQgc2l6ZTEgPSBmaWVsZHMx\nLnNpemUoKTsKICAgICAgICAgICAgaWYgKHNpemUgPT0gMCAmJiBzaXplMSA9\nPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAg\nIGVsc2UgaWYgKHNpemUgIT0gc2l6ZTEpIAogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOyAgIAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGZp\nZWxkcyAhPSBudWxsID8gIWZpZWxkcy5lcXVhbHMoZmllbGRzMSkgOiBmaWVs\nZHMxICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgcHVibGljIGludCBoYXNoQ29k\nZSgpIHsKICAgICAgICAgICAgaW50IHJlc3VsdCA9IDA7CiAgICAgICAgICAg\nIHJlc3VsdCA9IDMxICogcmVzdWx0ICsgKG1hcHBpbmcgIT0gbnVsbCA/IG1h\ncHBpbmcuaGFzaENvZGUoKSA6IDApOwogICAgICAgICAgICByZXN1bHQgPSAz\nMSAqIHJlc3VsdCArIChmbSAhPSBudWxsID8gZm0uaGFzaENvZGUoKSA6IDAp\nOwogICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGZldGNoLmdl\ndElzb2xhdGlvbigpOwogICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3Vs\ndCArIGZldGNoLmdldEZldGNoRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIHJl\nc3VsdCA9IDMxICogcmVzdWx0ICsgZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUo\nKTsKICAgICAgICAgICAgcmVzdWx0ID0gMzEgKiByZXN1bHQgKyBmZXRjaC5n\nZXRTdWJjbGFzc0ZldGNoTW9kZSgpOwogICAgICAgICAgICByZXN1bHQgPSAz\nMSAqIHJlc3VsdCArIGZldGNoLmdldEpvaW5TeW50YXgoKTsKICAgICAgICAg\nICAgU2V0IGpvaW5zID0gZmV0Y2guZ2V0Sm9pbnMoKTsKICAgICAgICAgICAg\ncmVzdWx0ID0gMzEgKiByZXN1bHQgKyAoam9pbnMgIT0gbnVsbCA/IGpvaW5z\nLmhhc2hDb2RlKCkgOiAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJl\nc3VsdCA9IDMxICogcmVzdWx0ICsgZmV0Y2guZ2V0TWF4RmV0Y2hEZXB0aCgp\nOwogICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGZldGNoLmdl\ndFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAgcmVzdWx0ID0gMzEgKiBy\nZXN1bHQgKyBmZXRjaC5nZXRXcml0ZUxvY2tMZXZlbCgpOwogICAgICAgIAkK\nICAgICAgICAgICAgaWYgKCgoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwp\nZmV0Y2gpLmhhc0ZldGNoR3JvdXBBbGwoKSkgCiAgICAgICAgICAgIAlyZXN1\nbHQgPSAzMSAqIHJlc3VsdCArIEZldGNoR3JvdXAuTkFNRV9BTEwuaGFzaENv\nZGUoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBTZXQg\nZmV0Y2hHcm91cHMgPSBmZXRjaC5nZXRGZXRjaEdyb3VwcygpOwogICAgICAg\nICAgICAgICAgaWYgKCgoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwpZmV0\nY2gpLmhhc0ZldGNoR3JvdXBEZWZhdWx0KCkgCiAgICAgICAgICAgICAgICAJ\nJiYgZmV0Y2hHcm91cHMgIT0gbnVsbCAmJiBmZXRjaEdyb3Vwcy5zaXplKCkg\nPT0gMSkKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3Vs\ndCArIEZldGNoR3JvdXAuTkFNRV9ERUZBVUxULmhhc2hDb2RlKCk7CiAgICAg\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQg\nPSAzMSAqIHJlc3VsdCArIChmZXRjaEdyb3VwcyAhPSBudWxsICYmIAogICAg\nICAgICAgICAgICAgICAgICAgICBmZXRjaEdyb3Vwcy5zaXplKCkgPiAwID8g\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoR3JvdXBzLmhhc2hDb2Rl\nKCkgOiAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgICAgICBTZXQgZmllbGRzID0gZmV0Y2guZ2V0RmllbGRzKCk7CiAgICAg\nICAgCXJlc3VsdCA9IDMxICogcmVzdWx0ICsgKGZpZWxkcyAhPSBudWxsICYm\nICBmaWVsZHMuc2l6ZSgpID4gMCA/IAogICAgICAgIAkJZmllbGRzLmhhc2hD\nb2RlKCkgOiAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBy\nZXN1bHQ7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

