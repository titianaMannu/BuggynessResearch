{"sha":"84e8a6ead042513062e03274f7a05a93506d6a2a","node_id":"MDQ6QmxvYjIwNjM2NDo4NGU4YTZlYWQwNDI1MTMwNjJlMDMyNzRmN2EwNWE5MzUwNmQ2YTJh","size":37321,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/84e8a6ead042513062e03274f7a05a93506d6a2a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7Cmlt\ncG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nSGFzaE1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5Q\nZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUNs\nYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5SZWxhdGlvbkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZldGNoQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0\nYXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxv\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9i\namVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuQXBwbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKCi8qKgogKiBTcGVjaWFsaXphdGlv\nbiBvZiBtZXRhZGF0YSBmb3IgcmVsYXRpb25hbCBkYXRhYmFzZXMuCiAqCiAq\nIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgQ2xhc3NNYXBw\naW5nCiAgICBleHRlbmRzIENsYXNzTWV0YURhdGEKICAgIGltcGxlbWVudHMg\nQ2xhc3NTdHJhdGVneSB7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBDbGFz\nc01hcHBpbmdbXSBFTVBUWV9NQVBQSU5HUyA9IG5ldyBDbGFzc01hcHBpbmdb\nMF07CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2Mg\nPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChDbGFzc01hcHBpbmcu\nY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NNYXBwaW5nSW5mbyBf\naW5mbzsKICAgIHByaXZhdGUgZmluYWwgRGlzY3JpbWluYXRvciBfZGlzY3Jp\nbTsKICAgIHByaXZhdGUgZmluYWwgVmVyc2lvbiBfdmVyc2lvbjsKICAgIHBy\naXZhdGUgQ2xhc3NTdHJhdGVneSBfc3RyYXRlZ3kgPSBudWxsOwoKICAgIHBy\naXZhdGUgVGFibGUgX3RhYmxlID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1u\nSU8gX2lvID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uW10gX2NvbHMgPSBT\nY2hlbWFzLkVNUFRZX0NPTFVNTlM7CiAgICBwcml2YXRlIEZvcmVpZ25LZXkg\nX2ZrID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9zdWJjbGFzc01vZGUgPSBJ\nbnRlZ2VyLk1BWF9WQUxVRTsKCiAgICBwcml2YXRlIENsYXNzTWFwcGluZ1td\nIF9qb2luU3ViTWFwcyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWFwcGlu\nZ1tdIF9hc3NpZ25NYXBzID0gbnVsbDsKCiAgICAvLyBtYXBzIGNvbHVtbnMg\ndG8gam9pbmFibGVzCiAgICBwcml2YXRlIGZpbmFsIE1hcCBfam9pbmFibGVz\nID0gbmV3IENvbmN1cnJlbnRIYXNoTWFwKCk7CgogICAgLyoqCiAgICAgKiBD\nb25zdHJ1Y3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCBvd25pbmcg\ncmVwb3NpdG9yeS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWFwcGlu\nZyhDbGFzcyB0eXBlLCBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcykgewogICAg\nICAgIHN1cGVyKHR5cGUsIHJlcG9zKTsKICAgICAgICBfZGlzY3JpbSA9IHJl\ncG9zLm5ld0Rpc2NyaW1pbmF0b3IodGhpcyk7CiAgICAgICAgX3ZlcnNpb24g\nPSByZXBvcy5uZXdWZXJzaW9uKHRoaXMpOwogICAgICAgIF9pbmZvID0gcmVw\nb3MubmV3TWFwcGluZ0luZm8odGhpcyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBFbWJlZGRlZCBjb25zdHJ1Y3Rvci4gU3VwcGx5IGVtYmVkZGluZyB2YWx1\nZSBhbmQgb3duaW5nIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBDbGFzc01hcHBpbmcoVmFsdWVNZXRhRGF0YSB2bWQpIHsKICAgICAgICBz\ndXBlcih2bWQpOwogICAgICAgIF9kaXNjcmltID0gZ2V0TWFwcGluZ1JlcG9z\naXRvcnkoKS5uZXdEaXNjcmltaW5hdG9yKHRoaXMpOwogICAgICAgIF92ZXJz\naW9uID0gZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5uZXdWZXJzaW9uKHRoaXMp\nOwogICAgICAgIF9pbmZvID0gZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5uZXdN\nYXBwaW5nSW5mbyh0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBj\nbGFzcyBkaXNjcmltaW5hdG9yLgogICAgICovCiAgICBwdWJsaWMgRGlzY3Jp\nbWluYXRvciBnZXREaXNjcmltaW5hdG9yKCkgewogICAgICAgIHJldHVybiBf\nZGlzY3JpbTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB2ZXJzaW9uIGlu\nZGljYXRvci4KICAgICAqLwogICAgcHVibGljIFZlcnNpb24gZ2V0VmVyc2lv\nbigpIHsKICAgICAgICByZXR1cm4gX3ZlcnNpb247CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8KICAgIC8vIFJ1bnRpbWUKICAgIC8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG9pZCB2YWx1ZSBzdG9yZWQgaW4gdGhl\nIHJlc3VsdC4gVGhpcyBpbXBsZW1lbnRhdGlvbiB3aWxsCiAgICAgKiByZWN1\ncnNlIHVudGlsIGl0IGZpbmRzIGFuIGFuY2VzdG9yIGNsYXNzIHdobyB1c2Vz\nIG9pZCB2YWx1ZXMgZm9yIGl0cwogICAgICogcHJpbWFyeSBrZXkuCiAgICAg\nKgogICAgICogQHBhcmFtIGZrIGlmIG5vbi1udWxsLCB1c2UgdGhlIGxvY2Fs\nIGNvbHVtbnMgb2YgdGhlIGdpdmVuIGZvcmVpZ24KICAgICAqIGtleSBpbiBw\nbGFjZSBvZiB0aGlzIGNsYXNzJyBwcmltYXJ5IGtleSBjb2x1bW5zCiAgICAg\nKiBAc2VlICNpc1ByaW1hcnlLZXlPYmplY3RJZAogICAgICovCiAgICBwdWJs\naWMgT2JqZWN0IGdldE9iamVjdElkKEpEQkNTdG9yZSBzdG9yZSwgUmVzdWx0\nIHJlcywgRm9yZWlnbktleSBmaywKICAgICAgICBib29sZWFuIHN1YnMsIEpv\naW5zIGpvaW5zKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIFZhbHVlTWFwcGluZyBlbWJlZCA9IGdldEVtYmVkZGluZ01hcHBpbmco\nKTsKICAgICAgICBpZiAoZW1iZWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGVtYmVkLmdldEZpZWxkTWFwcGluZygpLmdldERlZmluaW5nTWFwcGlu\nZygpLgogICAgICAgICAgICAgICAgZ2V0T2JqZWN0SWQoc3RvcmUsIHJlcywg\nZmssIHN1YnMsIGpvaW5zKTsKCiAgICAgICAgcmV0dXJuIGdldE9iamVjdElk\nKHRoaXMsIHN0b3JlLCByZXMsIGZrLCBzdWJzLCBqb2lucyk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVyIGZvciBwdWJsaWMgPGNv\nZGU+Z2V0T2JqZWN0SWQ8L2NvZGU+IG1ldGhvZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBPYmplY3QgZ2V0T2JqZWN0SWQoQ2xhc3NNYXBwaW5nIGNscywgSkRC\nQ1N0b3JlIHN0b3JlLCBSZXN1bHQgcmVzLAogICAgICAgIEZvcmVpZ25LZXkg\nZmssIGJvb2xlYW4gc3VicywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFpc1ByaW1hcnlLZXlPYmpl\nY3RJZCh0cnVlKSkKICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFz\nc01hcHBpbmcoKS5nZXRPYmplY3RJZChjbHMsIHN0b3JlLCByZXMsIGZrLAog\nICAgICAgICAgICAgICAgc3Vicywgam9pbnMpOwogICAgICAgIGlmIChnZXRJ\nZGVudGl0eVR5cGUoKSA9PSBJRF9VTktOT1dOKQogICAgICAgICAgICB0aHJv\ndyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAgICAgQ29sdW1uW10g\ncGtzID0gZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBpZiAoZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAg\nIENvbHVtbiBjb2wgPSAoZmsgPT0gbnVsbCkgPyBwa3NbMF0gOiBmay5nZXRD\nb2x1bW4ocGtzWzBdKTsKICAgICAgICAgICAgbG9uZyBpZCA9IHJlcy5nZXRM\nb25nKGNvbCwgam9pbnMpOwogICAgICAgICAgICByZXR1cm4gKGlkID09IDAg\nJiYgcmVzLndhc051bGwoKSkgPyBudWxsCiAgICAgICAgICAgICAgICA6IHN0\nb3JlLm5ld0RhdGFTdG9yZUlkKGlkLCBjbHMsIHN1YnMpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gYXBwbGljYXRpb24gaWRlbnRpdHkKICAgICAgICBPYmpl\nY3RbXSB2YWxzID0gbmV3IE9iamVjdFtnZXRQcmltYXJ5S2V5RmllbGRzKCku\nbGVuZ3RoXTsKICAgICAgICBGaWVsZE1hcHBpbmcgZm07CiAgICAgICAgSm9p\nbmFibGUgam9pbjsKICAgICAgICBpbnQgcGtJZHg7CiAgICAgICAgYm9vbGVh\nbiBpc051bGxQSyA9IHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBwa3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gd2Uga25vdyB0\naGF0IGFsbCBwayBjb2x1bW4gam9pbiBtYXBwaW5ncyB1c2UgcHJpbWFyeSBr\nZXkgZmllbGRzLAogICAgICAgICAgICAvLyBjYXVzZSB0aGlzIG1hcHBpbmcg\ndXNlcyB0aGUgb2lkIGFzIGl0cyBwcmltYXJ5IGtleSAod2UgcmVjdXJzZWQK\nICAgICAgICAgICAgLy8gYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgbWV0aG9k\nIHRvIGVuc3VyZSB0aGlzKQogICAgICAgICAgICBqb2luID0gYXNzZXJ0Sm9p\nbmFibGUocGtzW2ldKTsKICAgICAgICAgICAgZm0gPSBnZXRGaWVsZE1hcHBp\nbmcoam9pbi5nZXRGaWVsZEluZGV4KCkpOwogICAgICAgICAgICBwa0lkeCA9\nIGZtLmdldFByaW1hcnlLZXlJbmRleCgpOwoKICAgICAgICAgICAgLy8gY291\nbGQgaGF2ZSBhbHJlYWR5IHNldCB2YWx1ZSB3aXRoIHByZXZpb3VzIG11bHRp\nLWNvbHVtbiBqb2luYWJsZQogICAgICAgICAgICBpZiAodmFsc1twa0lkeF0g\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmVzLnN0YXJ0RGF0YVJlcXVl\nc3QoZm0pOwogICAgICAgICAgICAgICAgdmFsc1twa0lkeF0gPSBqb2luLmdl\ndFByaW1hcnlLZXlWYWx1ZShyZXMsIGpvaW4uZ2V0Q29sdW1ucygpLAogICAg\nICAgICAgICAgICAgICAgIGZrLCBzdG9yZSwgam9pbnMpOwogICAgICAgICAg\nICAgICAgcmVzLmVuZERhdGFSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICBp\nc051bGxQSyA9IGlzTnVsbFBLICYmIHZhbHNbcGtJZHhdID09IG51bGw7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGlzTnVsbFBLKSB7\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAg\nLy8gdGhlIG9pZCBkYXRhIGlzIGxvYWRlZCBieSB0aGUgYmFzZSB0eXBlLCBi\ndXQgaWYgZGlzY3JpbWluYXRvciBkYXRhCiAgICAgICAgLy8gaXMgcHJlc2Vu\ndCwgbWFrZSBzdXJlIHRvIHVzZSBpdCB0byBjb25zdHJ1Y3QgdGhlIGFjdHVh\nbCBvaWQgaW5zdGFuY2UKICAgICAgICAvLyBzbyB0aGF0IHdlIGdldCB0aGUg\nY29ycmVjdCBhcHAgaWQgY2xhc3MsIGV0YwogICAgICAgIENsYXNzTWFwcGlu\nZyBkY2xzID0gY2xzOwogICAgICAgIGlmIChzdWJzKSB7CiAgICAgICAgICAg\nIHJlcy5zdGFydERhdGFSZXF1ZXN0KGNscy5nZXREaXNjcmltaW5hdG9yKCkp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgQ2xhc3MgZHR5\ncGUgPSBjbHMuZ2V0RGlzY3JpbWluYXRvcigpLmdldENsYXNzKHN0b3JlLCBj\nbHMsIHJlcyk7CiAgICAgICAgICAgICAgICBpZiAoZHR5cGUgIT0gY2xzLmdl\ndERlc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgICAgICAgZGNscyA9IGNs\ncy5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmcoZHR5cGUsIAog\nICAgICAgICAgICAgICAgICAgIHN0b3JlLmdldENvbnRleHQoKS5nZXRDbGFz\nc0xvYWRlcigpLCB0cnVlKTsgCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBpbnRlbnRpb25hbGx5IGln\nbm9yZWQKICAgICAgICAgICAgfQogICAgICAgICAgICByZXMuZW5kRGF0YVJl\ncXVlc3QoKTsgIAogICAgICAgIH0KICAgICAgICBPYmplY3Qgb2lkID0gQXBw\nbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKHZhbHMsIGRjbHMpOwogICAgICAg\nIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIHsKICAgICAgICAgICAg\nKChPcGVuSlBBSWQpIG9pZCkuc2V0TWFuYWdlZEluc3RhbmNlVHlwZShkY2xz\nLmdldERlc2NyaWJlZFR5cGUoKSwgCiAgICAgICAgICAgICAgICBzdWJzKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9pZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZ2l2ZW4gY29sdW1uIHZhbHVlKHMpIGZvciB0\naGUgZ2l2ZW4gb2JqZWN0LiBUaGUgZ2l2ZW4KICAgICAqIGNvbHVtbnMgd2ls\nbCBiZSBwcmltYXJ5IGtleSBjb2x1bW5zIG9mIHRoaXMgbWFwcGluZywgYnV0\nIG1heSBiZSBpbgogICAgICogYW55IG9yZGVyLiBJZiB0aGVyZSBpcyBvbmx5\nIG9uZSBjb2x1bW4sIHJldHVybiBpdHMgdmFsdWUuIElmIHRoZXJlCiAgICAg\nKiBhcmUgbXVsdGlwbGUgY29sdW1ucywgcmV0dXJuIGFuIG9iamVjdCBhcnJh\neSBvZiB0aGVpciB2YWx1ZXMsIGluIHRoZQogICAgICogc2FtZSBvcmRlciB0\naGUgY29sdW1ucyBhcmUgZ2l2ZW4uCiAgICAgKi8KICAgIHB1YmxpYyBPYmpl\nY3QgdG9EYXRhU3RvcmVWYWx1ZShPYmplY3Qgb2JqLCBDb2x1bW5bXSBjb2xz\nLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICBPYmplY3QgcmV0ID0gKGNv\nbHMubGVuZ3RoID09IDEpID8gbnVsbCA6IG5ldyBPYmplY3RbY29scy5sZW5n\ndGhdOwoKICAgICAgICAvLyBpbiB0aGUgcGFzdCB3ZSd2ZSBiZWVuIGxlbmll\nbnQgYWJvdXQgYmVpbmcgYWJsZSB0byB0cmFuc2xhdGUgb2JqZWN0cwogICAg\nICAgIC8vIGZyb20gb3RoZXIgcGVyc2lzdGVuY2UgY29udGV4dHMsIHNvIHRy\neSB0byBnZXQgc20gZGlyZWN0bHkgZnJvbQogICAgICAgIC8vIGluc3RhbmNl\nIGJlZm9yZSBhc2tpbmcgb3VyIGNvbnRleHQKICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdl\nYWJsZShvYmopKSB7CiAgICAgICAgCVBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9\nIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLAogICAgICAg\nICAgICAgICAgICAgIGdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9u\nKCkpOwogICAgICAgICAgICBzbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBw\nYy5wY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAgICAgICBpZiAoc20gPT0g\nbnVsbCkgewogICAgICAgICAgICAJcmV0ID0gZ2V0VmFsdWVGcm9tVW5tYW5h\nZ2VkSW5zdGFuY2Uob2JqLCBjb2xzLCB0cnVlKTsKICAgICAgICAgICAgfSBl\nbHNlIGlmIChzbS5pc0RldGFjaGVkKCkpIHsKICAgICAgICAgICAgCW9iaiA9\nIHN0b3JlLmdldENvbnRleHQoKS5maW5kKHNtLmdldE9iamVjdElkKCksIGZh\nbHNlLCBudWxsKTsKICAgICAgICAgICAgCXNtID0gc3RvcmUuZ2V0Q29udGV4\ndCgpLmdldFN0YXRlTWFuYWdlcihvYmopOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgc20gPSBzdG9yZS5nZXRDb250ZXh0\nKCkuZ2V0U3RhdGVNYW5hZ2VyKG9iaik7CiAgICAgICAgfQogICAgICAgIGlm\nIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gcmV0OwoKICAgICAg\nICBPYmplY3QgdmFsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29s\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YWwgPSBhc3NlcnRKb2lu\nYWJsZShjb2xzW2ldKS5nZXRKb2luVmFsdWUoc20sIGNvbHNbaV0sIHN0b3Jl\nKTsKICAgICAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09IDEpCiAgICAgICAg\nICAgICAgICByZXQgPSB2YWw7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICgoT2JqZWN0W10pIHJldClbaV0gPSB2YWw7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBqb2luYWJsZSBmb3IgdGhlIGdpdmVuIGNvbHVtbiwgb3Ig\ndGhyb3cgYW4gZXhjZXB0aW9uIGlmCiAgICAgKiBub25lIGlzIGF2YWlsYWJs\nZS4KICAgICAqLwogICAgcHVibGljIEpvaW5hYmxlIGFzc2VydEpvaW5hYmxl\nKENvbHVtbiBjb2wpIHsKICAgICAgICBKb2luYWJsZSBqb2luID0gZ2V0Sm9p\nbmFibGUoY29sKTsKICAgICAgICBpZiAoam9pbiA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLWpvaW5hYmxlIiwKICAgICAgICAgICAgICAgIGNvbC5nZXRGdWxsTmFtZSgp\nKSk7CiAgICAgICAgcmV0dXJuIGpvaW47CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHtAbGluayBKb2luYWJsZX0gZm9yIHRoZSBnaXZlbiBj\nb2x1bW4uIEFueSBjb2x1bW4gdGhhdAogICAgICogYW5vdGhlciBtYXBwaW5n\nIGpvaW5zIHRvIG11c3QgYmUgY29udHJvbGxlZCBieSBhIGpvaW5hYmxlLgog\nICAgICovCiAgICBwdWJsaWMgSm9pbmFibGUgZ2V0Sm9pbmFibGUoQ29sdW1u\nIGNvbCkgewogICAgICAgIEpvaW5hYmxlIGpvaW47CiAgICAgICAgaWYgKGdl\ndEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbCkgewogICAgICAgICAgICBq\nb2luID0gZ2V0RW1iZWRkaW5nTWFwcGluZygpLmdldEZpZWxkTWFwcGluZygp\nLgogICAgICAgICAgICAgICAgZ2V0RGVmaW5pbmdNYXBwaW5nKCkuZ2V0Sm9p\nbmFibGUoY29sKTsKICAgICAgICAgICAgaWYgKGpvaW4gIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBqb2luOwogICAgICAgIH0KICAgICAgICBD\nbGFzc01hcHBpbmcgc3VwID0gZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGpvaW4gPSBzdXAuZ2V0Sm9pbmFibGUoY29sKTsKICAgICAgICAgICAgaWYg\nKGpvaW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBqb2luOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gKEpvaW5hYmxlKSBfam9pbmFibGVz\nLmdldChjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZl\nbiBjb2x1bW4tdG8tam9pbmFibGUgbWFwcGluZy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0Sm9pbmFibGUoQ29sdW1uIGNvbCwgSm9pbmFibGUgam9p\nbmFibGUpIHsKICAgICAgICAvLyBkb24ndCBsZXQgbm9uLXBrIG92ZXJyaWRl\nIHBrCiAgICAgICAgSm9pbmFibGUgam9pbiA9IChKb2luYWJsZSkgX2pvaW5h\nYmxlcy5nZXQoY29sKTsKICAgICAgICBpZiAoam9pbiA9PSBudWxsIHx8IChq\nb2luLmdldEZpZWxkSW5kZXgoKSAhPSAtMQogICAgICAgICAgICAmJiBnZXRG\naWVsZChqb2luLmdldEZpZWxkSW5kZXgoKSkuZ2V0UHJpbWFyeUtleUluZGV4\nKCkgPT0gLTEpKQogICAgICAgICAgICBfam9pbmFibGVzLnB1dChjb2wsIGpv\naW5hYmxlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBjb2x1bW5zIG9mIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0byB0aGlz\nIG1hcHBpbmcKICAgICAqIGNhbiBiZSB1c2VkIHRvIGNvbnN0cnVjdCBhbiBv\nYmplY3QgaWQgZm9yIHRoaXMgdHlwZS4gVGhpcyBpcyBhCiAgICAgKiByZWxh\ndGl2ZWx5IGV4cGVuc2l2ZSBvcGVyYXRpb247IGl0cyByZXN1bHRzIHNob3Vs\nZCBiZSBjYWNoZWQuCiAgICAgKgogICAgICogQHJldHVybiB7QGxpbmsgQm9v\nbGVhbiNUUlVFfSBpZiB0aGUgZm9yZWlnbiBrZXkgY29udGFpbnMgYWxsIG9p\nZAogICAgICogY29sdW1ucywgPGNvZGU+bnVsbDwvY29kZT4gaWYgaXQgY29u\ndGFpbnMgb25seSBzb21lIGNvbHVtbnMsCiAgICAgKiBvciB7QGxpbmsgQm9v\nbGVhbiNGQUxTRX0gaWYgaXQgY29udGFpbnMgbm9uLW9pZCBjb2x1bW5zCiAg\nICAgKi8KICAgIHB1YmxpYyBCb29sZWFuIGlzRm9yZWlnbktleU9iamVjdElk\nKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICAvLyBpZiB0aGlzIG1hcHBpbmcn\ncyBwcmltYXJ5IGtleSBjYW4ndCBjb25zdHJ1Y3QgYW4gb2lkLCB0aGVuIG5v\nIHdheQogICAgICAgIC8vIGZvcmVpZ24ga2V5IGNhbgogICAgICAgIGlmIChn\nZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9VTktOT1dOIHx8ICFpc1ByaW1hcnlL\nZXlPYmplY3RJZChmYWxzZSkpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFu\nLkZBTFNFOwoKICAgICAgICAvLyB3aXRoIGRhdGFzdG9yZSBpZGVudGl0eSwg\naXQncyBhbGwgb3Igbm90aGluZwogICAgICAgIENvbHVtbltdIGNvbHMgPSBm\nay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGlmIChnZXRJZGVu\ndGl0eVR5cGUoKSA9PSBJRF9EQVRBU1RPUkUpIHsKICAgICAgICAgICAgaWYg\nKGNvbHMubGVuZ3RoICE9IDEgfHwgY29sc1swXSAhPSBnZXRQcmltYXJ5S2V5\nQ29sdW1ucygpWzBdKQogICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAg\nICAgfQoKICAgICAgICAvLyBjaGVjayB0aGUgam9pbiBtYXBwaW5nIGZvciBl\nYWNoIHBrIGNvbHVtbiB0byBzZWUgaWYgaXQgbGlua3MgdXAgdG8KICAgICAg\nICAvLyBhIHByaW1hcnkga2V5IGZpZWxkCiAgICAgICAgSm9pbmFibGUgam9p\nbjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgam9pbiA9IGFzc2VydEpvaW5hYmxlKGNvbHNb\naV0pOwogICAgICAgICAgICBpZiAoam9pbi5nZXRGaWVsZEluZGV4KCkgIT0g\nLTEKICAgICAgICAgICAgICAgICYmIGdldEZpZWxkKGpvaW4uZ2V0RmllbGRJ\nbmRleCgpKS5nZXRQcmltYXJ5S2V5SW5kZXgoKSA9PSAtMSkKICAgICAgICAg\nICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgYWxsIHByaW1hcnkga2V5IGxpbmtzLCBzZWUgd2hldGhlciB3\nZSBqb2luIHRvIGFsbCBwa3MKICAgICAgICBpZiAoaXNQcmltYXJ5S2V5T2Jq\nZWN0SWQodHJ1ZSkKICAgICAgICAgICAgJiYgY29scy5sZW5ndGggPT0gZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKS5sZW5ndGgpCiAgICAgICAgICAgIHJldHVy\nbiBCb29sZWFuLlRSVUU7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgLy8vLy8vLwogICAgLy8gT1JNCiAgICAvLy8vLy8vCgogICAgLyoqCiAg\nICAgKiBSYXcgbWFwcGluZyBkYXRhLgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NNYXBwaW5nSW5mbyBnZXRNYXBwaW5nSW5mbygpIHsKICAgICAgICByZXR1\ncm4gX2luZm87CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kg\ndXNlZCB0byBtYXAgdGhpcyBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMg\nQ2xhc3NTdHJhdGVneSBnZXRTdHJhdGVneSgpIHsKICAgICAgICByZXR1cm4g\nX3N0cmF0ZWd5OwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5\nIHVzZWQgdG8gbWFwIHRoaXMgbWFwcGluZy4gVGhlIDxjb2RlPmFkYXB0PC9j\nb2RlPgogICAgICogcGFyYW1ldGVyIGRldGVybWluZXMgd2hldGhlciB0byBh\nZGFwdCB3aGVuIG1hcHBpbmcgdGhlIHN0cmF0ZWd5OwogICAgICogdXNlIG51\nbGwgaWYgdGhlIHN0cmF0ZWd5IHNob3VsZCBub3QgYmUgbWFwcGVkLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJhdGVneShDbGFzc1N0cmF0ZWd5\nIHN0cmF0ZWd5LCBCb29sZWFuIGFkYXB0KSB7CiAgICAgICAgLy8gc2V0IHN0\ncmF0ZWd5IGZpcnN0IHNvIHdlIGNhbiBhY2Nlc3MgaXQgZHVyaW5nIG1hcHBp\nbmcKICAgICAgICBDbGFzc1N0cmF0ZWd5IG9yaWcgPSBfc3RyYXRlZ3k7CiAg\nICAgICAgX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICAgICAgaWYgKHN0cmF0\nZWd5ICE9IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHN0cmF0ZWd5LnNldENsYXNzTWFwcGluZyh0aGlzKTsKICAgICAgICAg\nICAgICAgIGlmIChhZGFwdCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHN0cmF0ZWd5Lm1hcChhZGFwdC5ib29sZWFuVmFsdWUoKSk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgICAgIC8vIHJlc2V0IHN0cmF0ZWd5CiAgICAgICAgICAgICAgICBfc3Ry\nYXRlZ3kgPSBvcmlnOwogICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nbWFwcGluZydzIHByaW1hcnkgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBU\nYWJsZSBnZXRUYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3RhYmxlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG1hcHBpbmcncyBwcmltYXJ5IHRhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUYWJsZShUYWJsZSB0YWJs\nZSkgewogICAgICAgIF90YWJsZSA9IHRhYmxlOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIGNvbHVtbnMgdGhpcyBtYXBwaW5nIHVzZXMgdG8gdW5pcXVl\nbHkgaWRlbnRpZnkgYW4gb2JqZWN0LgogICAgICogVGhlc2Ugd2lsbCB0eXBp\nY2FsbHkgYmUgdGhlIHByaW1hcnkga2V5IGNvbHVtbnMgb3IgdGhlIGNvbHVt\nbnMgdGhpcwogICAgICogY2xhc3MgdXNlcyB0byBsaW5rIHRvIGl0cyBzdXBl\ncmNsYXNzIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKSB7CiAgICAgICAgaWYgKGdldElkZW50aXR5\nVHlwZSgpID09IElEX0FQUExJQ0FUSU9OICYmIGlzTWFwcGVkKCkpIHsKICAg\nICAgICAgICAgaWYgKF9jb2xzLmxlbmd0aCA9PSAwKSB7ICAgICAgICAgICAg\nCiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBwa3MgPSBnZXRQcmlt\nYXJ5S2V5RmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICAgICAgQ29sbGVj\ndGlvbiBjb2xzID0gbmV3IEFycmF5TGlzdChwa3MubGVuZ3RoKTsKICAgICAg\nICAgICAgICAgIENvbHVtbltdIGZpZWxkQ29sczsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcGtzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICAgICAgZmllbGRDb2xzID0gcGtzW2ldLmdldENvbHVtbnMo\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGRDb2xzLmxlbmd0aCA9\nPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb2xzID0gbmV3IENv\nbHVtblswXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb2xz\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBm\nb3IgKGludCBqID0gMDsgaiA8IGZpZWxkQ29scy5sZW5ndGg7IGorKykKICAg\nICAgICAgICAgICAgICAgICAgICAgY29scy5hZGQoZmllbGRDb2xzW2pdKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9jb2xzID0gKENv\nbHVtbltdKSBjb2xzLnRvQXJyYXkobmV3IENvbHVtbltjb2xzLnNpemUoKV0p\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY29s\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBjb2x1bW5zIHRoaXMgbWFw\ncGluZyB1c2VzIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IGFuIG9iamVjdC4KICAg\nICAqIFRoZXNlIHdpbGwgdHlwaWNhbGx5IGJlIHRoZSBwcmltYXJ5IGtleSBj\nb2x1bW5zIG9yIHRoZSBjb2x1bW5zIHRoaXMKICAgICAqIGNsYXNzIHVzZXMg\ndG8gbGluayB0byBpdHMgc3VwZXJjbGFzcyB0YWJsZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0UHJpbWFyeUtleUNvbHVtbnMoQ29sdW1uW10gY29s\ncykgewogICAgICAgIGlmIChjb2xzID09IG51bGwpCiAgICAgICAgICAgIGNv\nbHMgPSBTY2hlbWFzLkVNUFRZX0NPTFVNTlM7CiAgICAgICAgX2NvbHMgPSBj\nb2xzOwogICAgfQoKICAgIC8qKgogICAgICogSS9PIGluZm9ybWF0aW9uIG9u\nIHRoZSBrZXkgY29sdW1ucyAvIGpvaW4ga2V5LgogICAgICovCiAgICBwdWJs\naWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAgICAgcmV0dXJuIChf\naW8gPT0gbnVsbCkgPyBDb2x1bW5JTy5VTlJFU1RSSUNURUQgOiBfaW87CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJL08gaW5mb3JtYXRpb24gb24gdGhlIGtl\neSBjb2x1bW5zIC8gam9pbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldENvbHVtbklPKENvbHVtbklPIGlvKSB7CiAgICAgICAgX2lvID0gaW87\nCiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JlaWduIGtleSBsaW5raW5nIHRo\nZSBwcmltYXJ5IGtleSBjb2x1bW5zIHRvIHRoZSBzdXBlcmNsYXNzIHRhYmxl\nLAogICAgICogb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMg\nRm9yZWlnbktleSBnZXRKb2luRm9yZWlnbktleSgpIHsKICAgICAgICByZXR1\ncm4gX2ZrOwogICAgfQoKICAgIC8qKgogICAgICogRm9yZWlnbiBrZXkgbGlu\na2luZyB0aGUgcHJpbWFyeSBrZXkgY29sdW1ucyB0byB0aGUgc3VwZXJjbGFz\ncyB0YWJsZSwKICAgICAqIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Sm9pbkZvcmVpZ25LZXkoRm9yZWlnbktleSBmaykg\newogICAgICAgIF9mayA9IGZrOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJl\nZlNjaGVtYUNvbXBvbmVudHMoKSB7CiAgICAgICAgaWYgKGdldEVtYmVkZGlu\nZ01ldGFEYXRhKCkgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX3RhYmxl\nICE9IG51bGwgJiYgX3RhYmxlLmdldFByaW1hcnlLZXkoKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX3RhYmxlLmdldFByaW1hcnlLZXkoKS5yZWYoKTsK\nICAgICAgICAgICAgaWYgKF9mayAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2ZrLnJlZigpOwogICAgICAgICAgICBDb2x1bW5bXSBwa3MgPSBnZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHBrcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIHBrc1tpXS5y\nZWYoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBmaWVsZHMgPSBnZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICAgICAgZmllbGRzW2ldLnJlZlNjaGVtYUNvbXBvbmVudHMoKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBtYXBwaW5n\nIGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgc3RyYXRlZ3kuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGNsZWFyTWFwcGluZygpIHsKICAgICAgICBfc3RyYXRl\nZ3kgPSBudWxsOwogICAgICAgIF9jb2xzID0gU2NoZW1hcy5FTVBUWV9DT0xV\nTU5TOwogICAgICAgIF9mayA9IG51bGw7CiAgICAgICAgX3RhYmxlID0gbnVs\nbDsKICAgICAgICBfaW5mby5jbGVhcigpOwogICAgICAgIHNldFJlc29sdmUo\nTU9ERV9NQVBQSU5HIHwgTU9ERV9NQVBQSU5HX0lOSVQsIGZhbHNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSB7QGxpbmsgTWFwcGluZ0luZm99\nIHdpdGggb3VyIGN1cnJlbnQgbWFwcGluZyBpbmZvcm1hdGlvbi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc3luY01hcHBpbmdJbmZvKCkgewogICAgICAg\nIGlmIChnZXRFbWJlZGRpbmdNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAg\nICAgIF9pbmZvLnN5bmNXaXRoKHRoaXMpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICBfaW5mby5jbGVhcigpOwogICAgICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBmaWVsZHMgPSBnZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICAgICAgZmllbGRzW2ldLnN5bmNNYXBwaW5nSW5mbygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAv\nLyBNZXRhRGF0YSBpbnRlcmZhY2UKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXREZXNjcmliZWRUeXBlKENsYXNz\nIHR5cGUpIHsKICAgICAgICBzdXBlci5zZXREZXNjcmliZWRUeXBlKHR5cGUp\nOwogICAgICAgIC8vIHRoaXMgbWV0aG9kIGNhbGxlZCBmcm9tIHN1cGVyY2xh\nc3MgY29uc3RydWN0b3IsIHNvIF9pbmZvIG5vdCB5ZXQKICAgICAgICAvLyBp\nbml0aWFsaXplZAogICAgICAgIGlmIChfaW5mbyAhPSBudWxsKQogICAgICAg\nICAgICBfaW5mby5zZXRDbGFzc05hbWUodHlwZS5nZXROYW1lKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIHN1YmNsYXNzIGZldGNoIG1vZGUsIGFz\nIG9uZSBvZiB0aGUgZWFnZXIgY29uc3RhbnRzIGluCiAgICAgKiB7QGxpbmsg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbn0uCiAgICAgKi8KICAgIHB1YmxpYyBp\nbnQgZ2V0U3ViY2xhc3NGZXRjaE1vZGUoKSB7CiAgICAgICAgaWYgKF9zdWJj\nbGFzc01vZGUgPT0gSW50ZWdlci5NQVhfVkFMVUUpIHsKICAgICAgICAgICAg\naWYgKGdldFBDU3VwZXJjbGFzcygpICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfc3ViY2xhc3NNb2RlID0gZ2V0UENTdXBlcmNsYXNzTWFwcGluZygpLgog\nICAgICAgICAgICAgICAgICAgIGdldFN1YmNsYXNzRmV0Y2hNb2RlKCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9zdWJjbGFzc01vZGUg\nPSBGZXRjaENvbmZpZ3VyYXRpb24uREVGQVVMVDsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9zdWJjbGFzc01vZGU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgc3ViY2xhc3MgZmV0Y2ggbW9kZSwgYXMgb25lIG9mIHRoZSBlYWdl\nciBjb25zdGFudHMgaW4KICAgICAqIHtAbGluayBKREJDRmV0Y2hDb25maWd1\ncmF0aW9ufS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3ViY2xhc3NG\nZXRjaE1vZGUoaW50IG1vZGUpIHsKICAgICAgICBfc3ViY2xhc3NNb2RlID0g\nbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhv\nZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0\nYURhdGEjZ2V0UmVwb3NpdG9yeX0uCiAgICAgKi8KICAgIHB1YmxpYyBNYXBw\naW5nUmVwb3NpdG9yeSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpIHsKICAgICAg\nICByZXR1cm4gKE1hcHBpbmdSZXBvc2l0b3J5KSBnZXRSZXBvc2l0b3J5KCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8g\ncGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRh\nI2dldEVtYmVkZGluZ01ldGFEYXRhfQogICAgICovCiAgICBwdWJsaWMgVmFs\ndWVNYXBwaW5nIGdldEVtYmVkZGluZ01hcHBpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIChWYWx1ZU1hcHBpbmcpIGdldEVtYmVkZGluZ01ldGFEYXRhKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBjbGFz\ncyBkb2VzIG5vdCB1c2UgdGhlICJub25lIiBzdHJhdGVneSAoaW5jbHVkaW5n\nCiAgICAgKiBpZiBpdCBoYXMgYSBudWxsIHN0cmF0ZWd5LCBhbmQgdGhlcmVm\nb3JlIGlzIHByb2JhYmx5IGluIHRoZSBwcm9jZXNzIG9mCiAgICAgKiBiZWlu\nZyBtYXBwZWQpLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc01hcHBl\nZCgpIHsKICAgICAgICBpZiAoIXN1cGVyLmlzTWFwcGVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX3N0cmF0ZWd5ICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBfc3RyYXRlZ3kgIT0gTm9uZUNsYXNz\nU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gIU5vbmVD\nbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhfaW5mby5nZXRTdHJhdGVneSgp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0\nbyBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURh\ndGEjZ2V0UENTdXBlcmNsYXNzTWV0YURhdGF9LgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3NNYXBwaW5nIGdldFBDU3VwZXJjbGFzc01hcHBpbmcoKSB7CiAg\nICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmcpIGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBt\nZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFz\nc01ldGFEYXRhI2dldE1hcHBlZFBDU3VwZXJjbGFzc01ldGFEYXRhfS4KICAg\nICAqLwogICAgcHVibGljIENsYXNzTWFwcGluZyBnZXRNYXBwZWRQQ1N1cGVy\nY2xhc3NNYXBwaW5nKCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5n\nKSBnZXRNYXBwZWRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBuZWFyZXN0IG1hcHBlZCBzdXBlcmNs\nYXNzIHRoYXQgY2FuIGpvaW4gdG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAg\ncHVibGljIENsYXNzTWFwcGluZyBnZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IGdldE1hcHBl\nZFBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChfZmsg\nIT0gbnVsbCB8fCBfdGFibGUgPT0gbnVsbCB8fCBfdGFibGUuZXF1YWxzKHN1\ncC5nZXRUYWJsZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHN1cDsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmll\nbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5r\nIENsYXNzTWV0YURhdGEjZ2V0UENTdWJjbGFzc01ldGFEYXRhc30uCiAgICAg\nKi8KICAgIHB1YmxpYyBDbGFzc01hcHBpbmdbXSBnZXRQQ1N1YmNsYXNzTWFw\ncGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkgZ2V0\nUENTdWJjbGFzc01ldGFEYXRhcygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAg\nKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRNYXBwZWRQQ1N1YmNsYXNzTWV0\nYURhdGFzfS4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdl\ndE1hcHBlZFBDU3ViY2xhc3NNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4g\nKENsYXNzTWFwcGluZ1tdKSBnZXRNYXBwZWRQQ1N1YmNsYXNzTWV0YURhdGFz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gbWFwcGVkIHN1YmNs\nYXNzZXMgdGhhdCBhcmUgcmVhY2hhYmxlIHZpYSBqb2lucy4KICAgICAqLwog\nICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdldEpvaW5hYmxlUENTdWJjbGFz\nc01hcHBpbmdzKCkgewogICAgICAgIENsYXNzTWFwcGluZ1tdIHN1YnMgPSBn\nZXRNYXBwZWRQQ1N1YmNsYXNzTWFwcGluZ3MoKTsgLy8gY2hlY2tzIGZvciBu\nZXcKICAgICAgICBpZiAoX2pvaW5TdWJNYXBzID09IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICBf\nam9pblN1Yk1hcHMgPSBzdWJzOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIExpc3Qgam9pbmFibGUgPSBuZXcgQXJyYXlMaXN0KHN1YnMu\nbGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc3Vicy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAoaXNT\ndWJKb2luYWJsZShzdWJzW2ldKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nam9pbmFibGUuYWRkKHN1YnNbaV0pOwogICAgICAgICAgICAgICAgX2pvaW5T\ndWJNYXBzID0gKENsYXNzTWFwcGluZ1tdKSBqb2luYWJsZS50b0FycmF5CiAg\nICAgICAgICAgICAgICAgICAgKG5ldyBDbGFzc01hcHBpbmdbam9pbmFibGUu\nc2l6ZSgpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9qb2luU3ViTWFwczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB3aGV0aGVyIHdlIGNhbiByZWFjaCB0aGUgZ2l2ZW4gc3ViY2xhc3Mgdmlh\nIGpvaW5zLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNTdWJKb2lu\nYWJsZShDbGFzc01hcHBpbmcgc3ViKSB7CiAgICAgICAgaWYgKHN1YiA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHN1\nYiA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBy\nZXR1cm4gaXNTdWJKb2luYWJsZShzdWIuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0\naGUgY2xvc2VzdC1kZXJpdmVkIGxpc3Qgb2Ygbm9uLWludGVyLWpvaW5hYmxl\nIG1hcHBlZCB0eXBlcwogICAgICogYXNzaWduYWJsZSB0byB0aGlzIHR5cGUu\nIE1heSByZXR1cm4gdGhpcyBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMg\nQ2xhc3NNYXBwaW5nW10gZ2V0SW5kZXBlbmRlbnRBc3NpZ25hYmxlTWFwcGlu\nZ3MoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3VicyA9IGdldE1hcHBl\nZFBDU3ViY2xhc3NNYXBwaW5ncygpOyAvLyBjaGVja3MgZm9yIG5ldwogICAg\nICAgIGlmIChfYXNzaWduTWFwcyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8v\nIHJlbW92ZSB1bm1hcHBlZCBzdWJzCiAgICAgICAgICAgIGlmIChzdWJzLmxl\nbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNNYXBwZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBfYXNzaWduTWFwcyA9IG5ldyBDbGFzc01h\ncHBpbmdbXXsgdGhpcyB9OwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIF9hc3NpZ25NYXBzID0gc3ViczsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGludCBzaXplID0gKGludCkgKHN1\nYnMubGVuZ3RoICogMS4zMyArIDIpOwogICAgICAgICAgICAgICAgU2V0IGlu\nZGVwZW5kZW50ID0gbmV3IExpbmtlZEhhc2hTZXQoc2l6ZSk7CiAgICAgICAg\nICAgICAgICBpZiAoaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICBp\nbmRlcGVuZGVudC5hZGQodGhpcyk7CiAgICAgICAgICAgICAgICBpbmRlcGVu\nZGVudC5hZGRBbGwoQXJyYXlzLmFzTGlzdChzdWJzKSk7CgogICAgICAgICAg\nICAgICAgLy8gcmVtb3ZlIGFsbCBtYXBwaW5ncyB0aGF0IGhhdmUgYSBzdXBl\ncmNsYXNzIG1hcHBpbmcgaW4gdGhlIHNldAogICAgICAgICAgICAgICAgQ2xh\nc3NNYXBwaW5nIG1hcCwgc3VwOwogICAgICAgICAgICAgICAgTGlzdCBjbGVh\nciA9IG51bGw7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGluZGVwZW5kZW50Lml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICAgICAgbWFwID0gKENsYXNzTWFwcGluZykgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgICAgICAgICBzdXAgPSBtYXAuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHN1cCAhPSBudWxsICYmIGluZGVwZW5kZW50LmNvbnRhaW5zKHN1cCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNsZWFyID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhciA9IG5ldyBBcnJh\neUxpc3QoaW5kZXBlbmRlbnQuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNsZWFyLmFkZChtYXApOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjbGVh\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGluZGVwZW5kZW50LnJl\nbW92ZUFsbChjbGVhcik7CgogICAgICAgICAgICAgICAgX2Fzc2lnbk1hcHMg\nPSAoQ2xhc3NNYXBwaW5nW10pIGluZGVwZW5kZW50LnRvQXJyYXkKICAgICAg\nICAgICAgICAgICAgICAobmV3IENsYXNzTWFwcGluZ1tpbmRlcGVuZGVudC5z\naXplKCldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2Fzc2lnbk1hcHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20ge0BsaW5rIENsYXNz\nTWV0YURhdGEjZ2V0RmllbGRzfS4KICAgICAqLwogICAgcHVibGljIEZpZWxk\nTWFwcGluZ1tdIGdldEZpZWxkTWFwcGluZ3MoKSB7CiAgICAgICAgcmV0dXJu\nIChGaWVsZE1hcHBpbmdbXSkgZ2V0RmllbGRzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZy\nb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldERlY2xhcmVkRmll\nbGRzfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZ1tdIGdldERl\nY2xhcmVkRmllbGRNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4gKEZpZWxk\nTWFwcGluZ1tdKSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBm\ncm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRQcmltYXJ5S2V5\nRmllbGRzfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZ1tdIGdl\ndFByaW1hcnlLZXlGaWVsZE1hcHBpbmdzKCkgewogICAgICAgIHJldHVybiAo\nRmllbGRNYXBwaW5nW10pIGdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3Jt\nIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0VmVy\nc2lvbkZpZWxkfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBn\nZXRWZXJzaW9uRmllbGRNYXBwaW5nKCkgewogICAgICAgIHJldHVybiAoRmll\nbGRNYXBwaW5nKSBnZXRWZXJzaW9uRmllbGQoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJv\nbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0RGVmYXVsdEZldGNo\nR3JvdXBGaWVsZHN9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5n\nW10gZ2V0RGVmYXVsdEZldGNoR3JvdXBGaWVsZE1hcHBpbmdzKCkgewogICAg\nICAgIHJldHVybiAoRmllbGRNYXBwaW5nW10pIGdldERlZmF1bHRGZXRjaEdy\nb3VwRmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5j\nZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBD\nbGFzc01ldGFEYXRhI2dldERlZmluZWRGaWVsZHN9LgogICAgICovCiAgICBw\ndWJsaWMgRmllbGRNYXBwaW5nW10gZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3Mo\nKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBpbmdbXSkgZ2V0RGVmaW5l\nZEZpZWxkcygpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xh\nc3NNZXRhRGF0YSNnZXRGaWVsZHNJbkxpc3RpbmdPcmRlcn0uCiAgICAgKi8K\nICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBnZXRGaWVsZE1hcHBpbmdzSW5M\naXN0aW5nT3JkZXIoKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBpbmdb\nXSkgZ2V0RmllbGRzSW5MaXN0aW5nT3JkZXIoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJv\nbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0RGVmaW5lZEZpZWxk\nc0luTGlzdGluZ09yZGVyfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFw\ncGluZ1tdIGdldERlZmluZWRGaWVsZE1hcHBpbmdzSW5MaXN0aW5nT3JkZXIo\nKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBpbmdbXSkgZ2V0RGVmaW5l\nZEZpZWxkc0luTGlzdGluZ09yZGVyKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20ge0Bs\naW5rIENsYXNzTWV0YURhdGEjZ2V0RmllbGR9LgogICAgICovCiAgICBwdWJs\naWMgRmllbGRNYXBwaW5nIGdldEZpZWxkTWFwcGluZyhpbnQgaW5kZXgpIHsK\nICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZykgZ2V0RmllbGQoaW5kZXgp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRv\nIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0\nYSNnZXREZWNsYXJlZEZpZWxkfS4KICAgICAqLwogICAgcHVibGljIEZpZWxk\nTWFwcGluZyBnZXREZWNsYXJlZEZpZWxkTWFwcGluZyhpbnQgaW5kZXgpIHsK\nICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZykgZ2V0RGVjbGFyZWRGaWVs\nZChpbmRleCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBt\nZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20ge0BsaW5rIENsYXNzTWV0YURh\ndGEjZ2V0RmllbGR9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5n\nIGdldEZpZWxkTWFwcGluZyhTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVy\nbiAoRmllbGRNYXBwaW5nKSBnZXRGaWVsZChuYW1lKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3Qg\nZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0RGVjbGFyZWRG\naWVsZH0uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RGVj\nbGFyZWRGaWVsZE1hcHBpbmcoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1\ncm4gKEZpZWxkTWFwcGluZykgZ2V0RGVjbGFyZWRGaWVsZChuYW1lKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJm\nb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0\nRGVjbGFyZWRVbm1hbmFnZWRGaWVsZHN9LgogICAgICovCiAgICBwdWJsaWMg\nRmllbGRNYXBwaW5nW10gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZE1hcHBp\nbmdzKCkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5nW10pIGdldERl\nY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAg\nICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2FkZERlY2xhcmVkRmllbGR9Lgog\nICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGFkZERlY2xhcmVkRmll\nbGRNYXBwaW5nKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBlKSB7CiAgICAgICAg\ncmV0dXJuIChGaWVsZE1hcHBpbmcpIGFkZERlY2xhcmVkRmllbGQobmFtZSwg\ndHlwZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1hcHBp\nbmcoYm9vbGVhbiBydW50aW1lKSB7CiAgICAgICAgc3VwZXIucmVzb2x2ZU1h\ncHBpbmcocnVudGltZSk7CgogICAgICAgIC8vIG1hcCBjbGFzcyBzdHJhdGVn\neTsgaXQgbWF5IGFscmVhZHkgYmUgbWFwcGVkIGJ5IHRoZSByZXBvc2l0b3J5\nIGJlZm9yZQogICAgICAgIC8vIHRoZSByZXNvbHZlIHByb2Nlc3MgYmVnaW5z\nCiAgICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MgPSBnZXRNYXBwaW5n\nUmVwb3NpdG9yeSgpOwogICAgICAgIGlmIChfc3RyYXRlZ3kgPT0gbnVsbCkK\nICAgICAgICAgICAgcmVwb3MuZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pbnN0\nYWxsU3RyYXRlZ3kodGhpcyk7CiAgICAgICAgTG9nIGxvZyA9IGdldFJlcG9z\naXRvcnkoKS5nZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgic3RyYXRl\nZ3kiLCB0aGlzLCBfc3RyYXRlZ3kuZ2V0QWxpYXMoKSkpOwoKICAgICAgICAv\nLyBtYWtlIHN1cmUgdW5tYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMgYXJlIGRl\nZmluZWQgaWYgd2UncmUgbWFwcGVkOwogICAgICAgIC8vIGFsc28gbWF5IGhh\ndmUgYmVlbiBkb25lIGJ5IHJlcG9zaXRvcnkgYWxyZWFkeQogICAgICAgIGRl\nZmluZVN1cGVyY2xhc3NGaWVsZHMoZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCkgPT0gbnVsbCk7CgogICAgICAgIC8vIHJlc29sdmUgZXZlcnl0\naGluZyB0aGF0IGRvZXNuJ3QgcmVseSBvbiBhbnkgcmVsYXRpb25zIHRvIGF2\nb2lkCiAgICAgICAgLy8gcmVjdXJzaW9uLCB0aGVuIHJlc29sdmUgYWxsIGZp\nZWxkcwogICAgICAgIHJlc29sdmVOb25SZWxhdGlvbk1hcHBpbmdzKCk7CiAg\nICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gZ2V0RmllbGRNYXBwaW5ncygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmIChmbXNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0\nYSgpID09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGJvb2xlYW4gZmlsbCA9\nCiAgICAgICAgICAgICAgICAgICAgZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5n\nZXRNYXBwaW5nRGVmYXVsdHMoKQogICAgICAgICAgICAgICAgICAgICAgICAu\nZGVmYXVsdE1pc3NpbmdJbmZvKCk7CiAgICAgICAgICAgICAgICBGb3JlaWdu\nS2V5IGZrID0gZm1zW2ldLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICAgICAg\nICAgIGlmIChmaWxsICYmIGZrICE9IG51bGwgJiYgCiAgICAgICAgICAgICAg\nICAgICAgZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKS5sZW5ndGggPT0gMCkg\neyAKICAgICAgICAgICAgICAgICAgICAvLyBzZXQgcmVzb2x2ZSBtb2RlIHRv\nIGZvcmNlIHRoaXMgZmllbGQgbWFwcGluZyB0byBiZSAKICAgICAgICAgICAg\nICAgICAgICAvLyByZXNvbHZlZCBhZ2Fpbi4gVGhlIG5lZWQgdG8gcmVzb2x2\nZSBhZ2FpbiBvY2N1cnMgd2hlbiAKICAgICAgICAgICAgICAgICAgICAvLyBh\nIHByaW1hcnkga2V5IGlzIGEgcmVsYXRpb24gZmllbGQgd2l0aCB0aGUgZm9y\nZWlnbiBrZXkKICAgICAgICAgICAgICAgICAgICAvLyBhbm5vdGF0aW9uLiBJ\nbiB0aGlzIHNpdHVhdGlvbiwgdGhpcyBwcmltYXJ5IGtleSBmaWVsZAogICAg\nICAgICAgICAgICAgICAgIC8vIG1hcHBpbmcgaXMgcmVzb2x2ZWQgZHVyaW5n\nIHRoZSBjYWxsIHRvIAogICAgICAgICAgICAgICAgICAgIC8vIHJlc29sdmVO\nb25SZWxhdGlvbk1hcHBpbmcuIFNpbmNlIGl0IGlzIGEgcmVsYXRpb24KICAg\nICAgICAgICAgICAgICAgICAvLyBmaWVsZCwgdGhlIGZvcmVpZ24ga2V5IHdp\nbGwgYmUgY29uc3RydWN0ZWQuIEhvd2V2ZXIsIAogICAgICAgICAgICAgICAg\nICAgIC8vIHRoZSBwcmltYXJ5IGtleSBvZiB0aGUgcGFyZW50IGVudGl0eSBt\nYXkgbm90IGhhdmUgYmVlbiAKICAgICAgICAgICAgICAgICAgICAvLyByZXNv\nbHZlZCB5ZXQsIHJlc3VsdGluZyBpbiBtaXNzaW5nIGluZm9ybWFpdG9uIGlu\nIHRoZSBmawogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5zZXRSZXNvbHZl\nKE1PREVfTUVUQSk7CiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLmdldFN0\ncmF0ZWd5KCkubWFwKGZhbHNlKTsKICAgICAgICAgICAgICAgICAKICAgICAg\nICAgICAgICAgIH0gICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBm\nbXNbaV0ucmVzb2x2ZShNT0RFX01BUFBJTkcpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZtcyA9IGdldERlY2xhcmVkVW5tYW5hZ2VkRmll\nbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1z\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBmbXNbaV0ucmVzb2x2ZShNT0RF\nX01BUFBJTkcpOwoKICAgICAgICAvLyBtYXJrIG1hcHBlZCBjb2x1bW5zCiAg\nICAgICAgaWYgKF9jb2xzICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1u\nSU8gaW8gPSBnZXRDb2x1bW5JTygpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaW8uaXNJbnNlcnRhYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAg\nICAgICAgICBfY29sc1tpXS5zZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9J\nTlNFUlQsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGlvLmlzVXBkYXRh\nYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICBfY29sc1tpXS5z\nZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9VUERBVEUsIHRydWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIG9uY2UgY29sdW1ucyBh\ncmUgcmVzb2x2ZWQsIHJlc29sdmUgdW5pcXVlIGNvbnN0cmFpbnRzIGFzIHRo\nZXkgbmVlZAogICAgICAgIC8vIHRoZSBjb2x1bW5zIGJlIHJlc29sdmVkIAog\nICAgICAgIF9pbmZvLmdldFVuaXF1ZXModGhpcywgdHJ1ZSk7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogUmVzb2x2ZSBub24tcmVsYXRpb24gZmllbGQg\nbWFwcGluZ3Mgc28gdGhhdCB3aGVuIHdlIGRvIHJlbGF0aW9uCiAgICAgKiBt\nYXBwaW5ncyB0aGV5IGNhbiByZWx5IG9uIHRoZW0gZm9yIGpvaW5zLgogICAg\nICovCiAgICB2b2lkIHJlc29sdmVOb25SZWxhdGlvbk1hcHBpbmdzKCkgewog\nICAgICAgIC8vIG1ha2Ugc3VyZSBwcmltYXJ5IGtleSBmaWVsZHMgYXJlIHJl\nc29sdmVkIGZpcnN0IGJlY2F1c2Ugb3RoZXIKICAgICAgICAvLyBmaWVsZHMg\nbWlnaHQgcmVseSBvbiB0aGVtCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1z\nID0gZ2V0UHJpbWFyeUtleUZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nZm1zW2ldLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKCiAgICAgICAgLy8gcmVz\nb2x2ZSBkZWZpbmVkIGZpZWxkcyB0aGF0IGFyZSBzYWZlOyB0aGF0IGRvbid0\nIHJlbHkgb24gb3RoZXIgdHlwZXMKICAgICAgICAvLyBhbHNvIGJlaW5nIHJl\nc29sdmVkLiAgZG9uJ3QgdXNlIGdldERlZmluZWRGaWVsZHMgYi9jIGl0IHJl\nbGllcyBvbgogICAgICAgIC8vIHdoZXRoZXIgZmllbGRzIGFyZSBtYXBwZWQs\nIHdoaWNoIGlzbid0IGtub3duIHlldAogICAgICAgIGZtcyA9IGdldEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZtc1tpXS5nZXREZWZpbmlu\nZ01ldGFEYXRhKCkgPT0gdGhpcwogICAgICAgICAgICAgICAgJiYgIWZtc1tp\nXS5pc1R5cGVQQygpICYmICFmbXNbaV0uZ2V0S2V5KCkuaXNUeXBlUEMoKQog\nICAgICAgICAgICAgICAgJiYgIWZtc1tpXS5nZXRFbGVtZW50KCkuaXNUeXBl\nUEMoKSkKICAgICAgICAgICAgICAgIGZtc1tpXS5yZXNvbHZlKE1PREVfTUFQ\nUElORyk7CgogICAgICAgIF9kaXNjcmltLnJlc29sdmUoTU9ERV9NQVBQSU5H\nKTsKICAgICAgICBfdmVyc2lvbi5yZXNvbHZlKE1PREVfTUFQUElORyk7ICAg\nICAgICAKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFw\ncGluZygpIHsKICAgICAgICBzdXBlci5pbml0aWFsaXplTWFwcGluZygpOwoK\nICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBnZXREZWZpbmVkRmll\nbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmll\nbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBmaWVsZHNbaV0ucmVzb2x2\nZShNT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX2Rpc2NyaW0ucmVzb2x2\nZShNT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX3ZlcnNpb24ucmVzb2x2\nZShNT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX3N0cmF0ZWd5LmluaXRp\nYWxpemUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckRlZmlu\nZWRGaWVsZENhY2hlKCkgewogICAgICAgIC8vIGp1c3QgbWFrZSB0aGlzIG1l\ndGhvZCBhdmFpbGFibGUgdG8gb3RoZXIgY2xhc3NlcyBpbiB0aGlzIHBhY2th\nZ2UKICAgICAgICBzdXBlci5jbGVhckRlZmluZWRGaWVsZENhY2hlKCk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJTdWJjbGFzc0NhY2hlKCkg\newogICAgICAgIHN1cGVyLmNsZWFyU3ViY2xhc3NDYWNoZSgpOwogICAgICAg\nIF9qb2luU3ViTWFwcyA9IG51bGw7CiAgICAgICAgX2Fzc2lnbk1hcHMgPSBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvcHkoQ2xhc3NNZXRhRGF0\nYSBjbHMpIHsKICAgICAgICBzdXBlci5jb3B5KGNscyk7CiAgICAgICAgaWYg\nKF9zdWJjbGFzc01vZGUgPT0gSW50ZWdlci5NQVhfVkFMVUUpCiAgICAgICAg\nICAgIF9zdWJjbGFzc01vZGUgPSAoKENsYXNzTWFwcGluZykgY2xzKS5nZXRT\ndWJjbGFzc0ZldGNoTW9kZSgpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29s\nZWFuIHZhbGlkYXRlRGF0YVN0b3JlRXh0ZW5zaW9uUHJlZml4KFN0cmluZyBw\ncmVmaXgpIHsKICAgICAgICByZXR1cm4gImpkYmMtIi5lcXVhbHMocHJlZml4\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gQ2xhc3NTdHJhdGVneSBpbXBsZW1lbnRhdGlvbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldEFsaWFzKCkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVn\neSgpLmdldEFsaWFzKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFwKGJv\nb2xlYW4gYWRhcHQpIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLm1hcChh\nZGFwdCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZSgpIHsK\nICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmluaXRpYWxpemUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCku\naW5zZXJ0KHNtLCBzdG9yZSwgcm0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3Rv\ncmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS51cGRhdGUoc20sIHN0b3Jl\nLCBybSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBy\nbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3Nl\ncnRTdHJhdGVneSgpLmRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgIH0KCiAg\nICBwdWJsaWMgQm9vbGVhbiBpc0N1c3RvbUluc2VydChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1cm4g\nYXNzZXJ0U3RyYXRlZ3koKS5pc0N1c3RvbUluc2VydChzbSwgc3RvcmUpOwog\nICAgfQoKICAgIHB1YmxpYyBCb29sZWFuIGlzQ3VzdG9tVXBkYXRlKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAg\nIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmlzQ3VzdG9tVXBkYXRlKHNtLCBz\ndG9yZSk7CiAgICB9CgogICAgcHVibGljIEJvb2xlYW4gaXNDdXN0b21EZWxl\ndGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKSB7\nCiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuaXNDdXN0b21EZWxl\ndGUoc20sIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjdXN0b21J\nbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3Jl\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2Vy\ndFN0cmF0ZWd5KCkuY3VzdG9tSW5zZXJ0KHNtLCBzdG9yZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY3VzdG9tVXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmN1c3RvbVVwZGF0\nZShzbSwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGN1c3RvbURl\nbGV0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0\nU3RyYXRlZ3koKS5jdXN0b21EZWxldGUoc20sIHN0b3JlKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDbGFzc01hcHBpbmcoQ2xhc3NNYXBwaW5nIG93\nbmVyKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5zZXRDbGFzc01hcHBp\nbmcob3duZXIpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUHJpbWFy\neUtleU9iamVjdElkKGJvb2xlYW4gaGFzQWxsKSB7CiAgICAgICAgcmV0dXJu\nIGFzc2VydFN0cmF0ZWd5KCkuaXNQcmltYXJ5S2V5T2JqZWN0SWQoaGFzQWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pblN1cGVyY2xhc3MoSm9p\nbnMgam9pbnMsIGJvb2xlYW4gdG9UaGlzKSB7CiAgICAgICAgcmV0dXJuIGFz\nc2VydFN0cmF0ZWd5KCkuam9pblN1cGVyY2xhc3Moam9pbnMsIHRvVGhpcyk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNFYWdlclNlbGVj\ndChTZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgQ2xhc3NNYXBwaW5nIGJhc2UsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0\nU3RyYXRlZ3koKS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20sIHN0b3Jl\nLCBiYXNlLAogICAgICAgICAgICBmZXRjaCk7CiAgICB9CgogICAgcHVibGlj\nIFJlc3VsdE9iamVjdFByb3ZpZGVyIGN1c3RvbUxvYWQoSkRCQ1N0b3JlIHN0\nb3JlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgbG9uZyBzdGFydElkeCwgbG9uZyBlbmRJZHgp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tTG9hZChzdG9yZSwgc3ViY2xhc3Nl\ncywgZmV0Y2gsCiAgICAgICAgICAgIHN0YXJ0SWR4LCBlbmRJZHgpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIFBDU3RhdGUg\nc3RhdGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tTG9hZChz\nbSwgc3RvcmUsIHN0YXRlLCBmZXRjaCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gY3VzdG9tTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgUmVzdWx0IHJlc3VsdCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5jdXN0b21M\nb2FkKHNtLCBzdG9yZSwgZmV0Y2gsIHJlc3VsdCk7CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgQ2xhc3NTdHJhdGVneSBhc3NlcnRTdHJhdGVneSgpIHsKICAg\nICAgICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIHJldHVybiBfc3Ry\nYXRlZ3k7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogRmluZCB0aGUgZmll\nbGQgbWFwcGluZ3MgdGhhdCBjb3JyZXNwb25kIHRvIHRoZSBnaXZlbiBjb2x1\nbW5zLgogICAgICogCiAgICAgKiBAcmV0dXJuIG51bGwgaWYgbm8gY29sdW1u\ncyBhcmUgZ2l2ZW4gb3Igbm8gZmllbGQgbWFwcGluZyB1c2VzIHRoZSBnaXZl\nbgogICAgICogY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PEZp\nZWxkTWFwcGluZz4gZ2V0RmllbGRNYXBwaW5ncyhDb2x1bW5bXSBjb2xzLCBi\nb29sZWFuIHByaW1lKSB7CiAgICAJaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xz\nLmxlbmd0aCA9PSAwKQogICAgCQlyZXR1cm4gbnVsbDsKICAgIAlMaXN0PEZp\nZWxkTWFwcGluZz4gcmVzdWx0ID0gbnVsbDsKICAgIAlmb3IgKENvbHVtbiBj\nIDogY29scykgewogICAgCQlMaXN0PEZpZWxkTWFwcGluZz4gZm1zID0gaGFz\nQ29sdW1uKGMsIHByaW1lKTsKICAgIAkJaWYgKGZtcyA9PSBudWxsKSBjb250\naW51ZTsKCQkJaWYgKHJlc3VsdCA9PSBudWxsKQoJCQkJcmVzdWx0ID0gbmV3\nIEFycmF5TGlzdDxGaWVsZE1hcHBpbmc+KCk7CgkJCWZvciAoRmllbGRNYXBw\naW5nIGZtIDogZm1zKQoJCQkJaWYgKCFyZXN1bHQuY29udGFpbnMoZm0pKQoJ\nCQkJCXJlc3VsdC5hZGQoZm0pOwogICAgCX0KICAgIAlyZXR1cm4gcmVzdWx0\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIExvb2tzIHVwIGluIHJldmVy\nc2UgdG8gZmluZCB0aGUgbGlzdCBvZiBmaWVsZCBtYXBwaW5ncyB0aGF0IGlu\nY2x1ZGUgdGhlCiAgICAgKiBnaXZlbiBjb2x1bW4uIENvc3RseS4KICAgICAq\nIAogICAgICogQHJldHVybiBudWxsIGlmIG5vIGZpZWxkIG1hcHBpbmdzIGNh\ncnJ5IHRoaXMgY29sdW1uLiAKICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PEZp\nZWxkTWFwcGluZz4gaGFzQ29sdW1uKENvbHVtbiBjLCBib29sZWFuIHByaW1l\nKSB7CiAgICAJTGlzdDxGaWVsZE1hcHBpbmc+IHJlc3VsdCA9IG51bGw7CiAg\nICAJRmllbGRNYXBwaW5nW10gZm1zID0gKHByaW1lKSA/IAogICAgCQlnZXRQ\ncmltYXJ5S2V5RmllbGRNYXBwaW5ncygpIDogZ2V0RmllbGRNYXBwaW5ncygp\nOwogICAgCWZvciAoRmllbGRNYXBwaW5nIGZtIDogZm1zKSB7CiAgICAJCUNv\nbHVtbltdIGNvbHMgPSBmbS5nZXRDb2x1bW5zKCk7CiAgICAJCWlmIChjb250\nYWlucyhjb2xzLCBjKSkgewogICAgCQkJaWYgKHJlc3VsdCA9PSBudWxsKQog\nICAgCQkJCXJlc3VsdCA9IG5ldyBBcnJheUxpc3Q8RmllbGRNYXBwaW5nPigp\nOwogICAgCQkJcmVzdWx0LmFkZChmbSk7CiAgICAJCX0KICAgIAl9CiAgICAJ\ncmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIAogICAgYm9vbGVhbiBjb250YWlu\ncyhDb2x1bW5bXSBjb2xzLCBDb2x1bW4gYykgewogICAgCWZvciAoQ29sdW1u\nIGNvbCA6IGNvbHMpCiAgICAJCWlmIChjb2wgPT0gYykKICAgIAkJCXJldHVy\nbiB0cnVlOwogICAgCXJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBHZXRzIHRoZSBmaWVsZCB2YWx1ZXMgb2YgdGhlIGdpdmVuIGlu\nc3RhbmNlIGZvciB0aGUgZ2l2ZW4gY29sdW1ucy4KICAgICAqIFRoZSBnaXZl\nbiBjb2x1bW5zIGFyZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBmaWVsZHMgYnkg\nYSByZXZlcnNlIGxvb2t1cC4KICAgICAqICAKICAgICAqIEByZXR1cm4gYSBz\naW5nbGUgb2JqZWN0IG9yIGFuIGFycmF5IG9mIG9iamVjdHMgYmFzZWQgb24g\nbnVtYmVyIG9mIAogICAgICogZmllbGRzIHRoZSBnaXZlbiBjb2x1bW5zIHJl\ncHJlc2VudC4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZ2V0VmFsdWVG\ncm9tVW5tYW5hZ2VkSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29sdW1uW10gY29s\ncywgCiAgICAJCWJvb2xlYW4gcHJpbWUpIHsKICAgIAlMaXN0PEZpZWxkTWFw\ncGluZz4gZm1zID0gZ2V0RmllbGRNYXBwaW5ncyhjb2xzLCBwcmltZSk7CiAg\nICAJaWYgKGZtcyA9PSBudWxsKQogICAgCQlyZXR1cm4gbnVsbDsKICAgIAlp\nZiAoZm1zLnNpemUoKSA9PSAxKQogICAgCQlyZXR1cm4gUmVmbGVjdGlvbi5n\nZXRWYWx1ZShvYmosIGZtcy5nZXQoMCkuZ2V0TmFtZSgpLCB0cnVlKTsKICAg\nIAlPYmplY3RbXSByZXN1bHQgPSBuZXcgT2JqZWN0W2Ztcy5zaXplKCldOwog\nICAgCWludCBpID0gMDsKICAgIAlmb3IgKEZpZWxkTWFwcGluZyBmbSA6IGZt\ncykgewogICAgCQlyZXN1bHRbaSsrXSA9IFJlZmxlY3Rpb24uZ2V0VmFsdWUo\nb2JqLCBmbS5nZXROYW1lKCksIHRydWUpOwogICAgCX0KICAgIAlyZXR1cm4g\ncmVzdWx0OwogICAgfQp9Cg==\n","encoding":"base64"}

