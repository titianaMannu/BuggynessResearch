{"sha":"72f633a67cefcb430abc2cf3c12a0ccdb192f141","node_id":"MDQ6QmxvYjIwNjM2NDo3MmY2MzNhNjdjZWZjYjQzMGFiYzJjZjNjMTJhMGNjZGIxOTJmMTQx","size":55485,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/72f633a67cefcb430abc2cf3c12a0ccdb192f141","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Q\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlw\nZXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5CbG9iVmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuQnl0ZUFycmF5VmFsdWVIYW5kbGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQ2hh\nckFycmF5U3RyZWFtVmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQ2hhckFycmF5VmFsdWVIYW5kbGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQ2xvYlZhbHVlSGFuZGxl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRz\nLkVsZW1lbnRFbWJlZFZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVtYmVkRmllbGRTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVt\nYmVkZGVkQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuc3RyYXRzLkZsYXRDbGFzc1N0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRnVsbENsYXNz\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5IYW5kbGVyQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkhh\nbmRsZXJGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuSGFuZGxlckhhbmRsZXJNYXBUYWJsZUZpZWxk\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5IYW5kbGVyUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3k7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5J\nbW11dGFibGVWYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5Mb2JGaWVsZFN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTWF4RW1iZWRk\nZWRCbG9iRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuc3RyYXRzLk1heEVtYmVkZGVkQnl0ZUFycmF5RmllbGRT\ndHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nc3RyYXRzLk1heEVtYmVkZGVkQ2hhckFycmF5RmllbGRTdHJhdGVneTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk1heEVt\nYmVkZGVkQ2xvYkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5OYW5vUHJlY2lzaW9uVGltZXN0YW1w\nVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuTm9uZUNsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lRGlzY3JpbWlu\nYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuTm9uZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lVmVyc2lvblN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuTnVtYmVyVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5zdHJhdHMuT2JqZWN0SWRDbGFzc1N0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nT2JqZWN0SWRWYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5QcmltaXRpdmVGaWVsZFN0cmF0ZWd5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuUmVs\nYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtleUZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlv\nbkNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlvbkZpZWxkU3Ry\nYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5SZWxhdGlvbkhhbmRsZXJNYXBUYWJsZUZpZWxkU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxh\ndGlvbk1hcEludmVyc2VLZXlGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuUmVsYXRpb25NYXBUYWJs\nZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLnN0cmF0cy5SZWxhdGlvblJlbGF0aW9uTWFwVGFibGVGaWVsZFN0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5z\ndHJhdHMuU3RhdGVDb21wYXJpc29uVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3RyaW5nRmll\nbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuc3RyYXRzLlN1YmNsYXNzSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1\ncGVyY2xhc3NEaXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5TdXBlcmNsYXNzVmVyc2lv\nblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuVW50eXBlZFBDVmFs\ndWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuVmFsdWVNYXBEaXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5WZXJ0aWNh\nbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5Kb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkphdmFWZXJz\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2Nh\nbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRh\nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk9y\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVl\nTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRh\nRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiBSZXBvc2l0b3J5IG9mIG9iamVjdC9y\nZWxhdGlvbmFsIG1hcHBpbmcgaW5mb3JtYXRpb24uCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgTWFwcGluZ1JlcG9zaXRvcnkK\nICAgIGV4dGVuZHMgTWV0YURhdGFSZXBvc2l0b3J5IHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQ\nYWNrYWdlCiAgICAgICAgKE1hcHBpbmdSZXBvc2l0b3J5LmNsYXNzKTsKCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBEQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxs\nOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgTWFwcGluZ0RlZmF1bHRzIF9kZWZh\ndWx0cyA9IG51bGw7CiAgICAKICAgIHByaXZhdGUgTWFwIF9yZXN1bHRzID0g\nbmV3IEhhc2hNYXAoKTsgLy8gb2JqZWN0LT5xdWVyeXJlc3VsdG1hcHBpbmcK\nICAgIHByaXZhdGUgU2NoZW1hR3JvdXAgX3NjaGVtYSA9IG51bGw7CiAgICBw\ncml2YXRlIFN0cmF0ZWd5SW5zdGFsbGVyIF9pbnN0YWxsZXIgPSBudWxsOwoK\nICAgIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gIENvbmZpZ3Vy\nZSB2aWEgCiAgICAgKiB7QGxpbmsgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5j\nb25mLkNvbmZpZ3VyYWJsZX0uCiAgICAgKi8KICAgIHB1YmxpYyBNYXBwaW5n\nUmVwb3NpdG9yeSgpIHsKICAgICAgICBzZXRWYWxpZGF0ZShWQUxJREFURV9N\nQVBQSU5HLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmll\nbnQgYWNjZXNzIHRvIGRpY3Rpb25hcnkgZm9yIG1hcHBpbmdzLgogICAgICov\nCiAgICBwdWJsaWMgREJEaWN0aW9uYXJ5IGdldERCRGljdGlvbmFyeSgpIHsK\nICAgICAgICByZXR1cm4gX2RpY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYXBwaW5nIGRlZmF1bHRzLgogICAgICovCiAgICBwdWJsaWMgTWFwcGluZ0Rl\nZmF1bHRzIGdldE1hcHBpbmdEZWZhdWx0cygpIHsKICAgICAgICByZXR1cm4g\nX2RlZmF1bHRzOwogICAgfQoKICAgIC8qKgogICAgICogTWFwcGluZyBkZWZh\ndWx0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNYXBwaW5nRGVmYXVs\ndHMoTWFwcGluZ0RlZmF1bHRzIGRlZmF1bHRzKSB7CiAgICAgICAgX2RlZmF1\nbHRzID0gZGVmYXVsdHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNl\nbnRhdGlvbiBvZiB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICovCiAgICBw\ndWJsaWMgU2NoZW1hR3JvdXAgZ2V0U2NoZW1hR3JvdXAoKSB7CiAgICAgICAg\naWYoX2xvY2tpbmcpewogICAgICAgICAgICBzeW5jaHJvbml6ZWQodGhpcyl7\nCiAgICAgICAgICAgICAgICBpZiAoX3NjaGVtYSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIF9zY2hlbWEgPSAoKEpEQkNDb25maWd1cmF0aW9uKSBn\nZXRDb25maWd1cmF0aW9uKCkpLgogICAgICAgICAgICAgICAgICAgICAgICBn\nZXRTY2hlbWFGYWN0b3J5SW5zdGFuY2UoKS5yZWFkU2NoZW1hKCk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gX3NjaGVtYTsgICAgICAgICAgICAgICAgCiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9zY2hlbWEgPT0g\nbnVsbCkKICAgICAgICAgICAgX3NjaGVtYSA9ICgoSkRCQ0NvbmZpZ3VyYXRp\nb24pIGdldENvbmZpZ3VyYXRpb24oKSkuCiAgICAgICAgICAgICAgICBnZXRT\nY2hlbWFGYWN0b3J5SW5zdGFuY2UoKS5yZWFkU2NoZW1hKCk7CiAgICAgICAg\ncmV0dXJuIF9zY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNl\nbnRhdGlvbiBvZiB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRTY2hlbWFHcm91cChTY2hlbWFHcm91cCBzY2hlbWEp\nIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hy\nb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBfc2NoZW1hID0gc2No\nZW1hOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgX3NjaGVtYSA9IHNjaGVtYTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbnN0YWxscyBtYXBwaW5nIHN0cmF0ZWdpZXMgb24gY29tcG9u\nZW50cy4KICAgICAqLwogICAgcHVibGljIFN0cmF0ZWd5SW5zdGFsbGVyIGdl\ndFN0cmF0ZWd5SW5zdGFsbGVyKCkgewogICAgICAgIGlmIChfbG9ja2luZykg\newogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAg\nICAgICAgIGlmIChfaW5zdGFsbGVyID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgX2luc3RhbGxlciA9IG5ldyBSdW50aW1lU3RyYXRlZ3lJbnN0YWxs\nZXIodGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2luc3RhbGxlcjsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlm\nIChfaW5zdGFsbGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBfaW5zdGFs\nbGVyID0gbmV3IFJ1bnRpbWVTdHJhdGVneUluc3RhbGxlcih0aGlzKTsKICAg\nICAgICAgICAgcmV0dXJuIF9pbnN0YWxsZXI7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSW5zdGFsbHMgbWFwcGluZyBzdHJhdGVnaWVzIG9u\nIGNvbXBvbmVudHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFN0cmF0\nZWd5SW5zdGFsbGVyKFN0cmF0ZWd5SW5zdGFsbGVyIGluc3RhbGxlcikgewog\nICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIF9pbnN0YWxsZXIgPSBpbnN0\nYWxsZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBfaW5zdGFsbGVyID0gaW5zdGFsbGVyOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcXVlcnkgcmVzdWx0IG1hcHBp\nbmcgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgICovCiAgICBwdWJsaWMgUXVl\ncnlSZXN1bHRNYXBwaW5nIGdldFF1ZXJ5UmVzdWx0TWFwcGluZyhDbGFzcyBj\nbHMsCiAgICAgICAgU3RyaW5nIG5hbWUsIENsYXNzTG9hZGVyIGVudkxvYWRl\nciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBRdWVyeVJlc3VsdE1h\ncHBpbmcgcmVzID0gbnVsbDsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICByZXMgPSBnZXRRdWVyeVJlc3VsdE1hcHBpbmdJbnRlcm5hbChjbHMsIG5h\nbWUsIGVudkxvYWRlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICByZXMgPSBnZXRRdWVyeVJlc3VsdE1hcHBpbmdJbnRl\ncm5hbChjbHMsIG5hbWUsIGVudkxvYWRlcik7CiAgICAgICAgfQogICAgICAg\nIGlmIChyZXMgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tcXVlcnkt\ncmVzIiwgY2xzLCBuYW1lKSk7CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybmVkIHRoZSBxdWVyeSByZXN1bHQgbWFw\ncGluZyB3aXRoIHRoZSBnaXZlbiBuYW1lLgogICAgICovCiAgICBwcml2YXRl\nIFF1ZXJ5UmVzdWx0TWFwcGluZyBnZXRRdWVyeVJlc3VsdE1hcHBpbmdJbnRl\ncm5hbChDbGFzcyBjbHMsCiAgICAgICAgU3RyaW5nIG5hbWUsIENsYXNzTG9h\nZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVjayBjYWNo\nZQogICAgICAgIE9iamVjdCBrZXkgPSBnZXRRdWVyeVJlc3VsdEtleShjbHMs\nIG5hbWUpOwogICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMgPSAoUXVl\ncnlSZXN1bHRNYXBwaW5nKSBfcmVzdWx0cy5nZXQoa2V5KTsKICAgICAgICBp\nZiAocmVzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiByZXM7CgogICAg\nICAgIC8vIGdldCBtZXRhZGF0YSBmb3IgY2xhc3MsIHdoaWNoIHdpbGwgZmlu\nZCByZXN1bHRzIGluIG1ldGFkYXRhIGZpbGUKICAgICAgICBpZiAoY2xzICE9\nIG51bGwgJiYgZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIGZhbHNlKSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIHJlcyA9IChRdWVyeVJlc3VsdE1hcHBp\nbmcpIF9yZXN1bHRzLmdldChrZXkpOwogICAgICAgICAgICBpZiAocmVzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0K\nICAgICAgICBpZiAoKGdldFNvdXJjZU1vZGUoKSAmIE1PREVfUVVFUlkpID09\nIDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAoY2xz\nID09IG51bGwpCiAgICAgICAgICAgIGNscyA9IGdldE1ldGFEYXRhRmFjdG9y\neSgpCiAgICAgICAgICAgICAgICAgICAgLmdldFJlc3VsdFNldE1hcHBpbmdT\nY29wZShuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgIC8vIG5vdCBpbiBjYWNo\nZTsgbG9hZAogICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLmxvYWQoY2xz\nLCBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcsIGVudkxvYWRlcik7CiAgICAg\nICAgcmV0dXJuIChRdWVyeVJlc3VsdE1hcHBpbmcpIF9yZXN1bHRzLmdldChr\nZXkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBjYWNoZWQg\ncXVlcnkgcmVzdWx0IG1hcHBpbmdzLgogICAgICovCiAgICBwdWJsaWMgUXVl\ncnlSZXN1bHRNYXBwaW5nW10gZ2V0UXVlcnlSZXN1bHRNYXBwaW5ncygpIHsK\nICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25p\nemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIHZhbHVl\ncyA9IF9yZXN1bHRzLnZhbHVlcygpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIChRdWVyeVJlc3VsdE1hcHBpbmdbXSkgdmFsdWVzLnRvQXJyYXkobmV3IFF1\nZXJ5UmVzdWx0TWFwcGluZ1t2YWx1ZXMuc2l6ZSgpXSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBDb2xsZWN0aW9uIHZh\nbHVlcyA9IF9yZXN1bHRzLnZhbHVlcygpOwogICAgICAgICAgICByZXR1cm4g\nKFF1ZXJ5UmVzdWx0TWFwcGluZ1tdKSB2YWx1ZXMudG9BcnJheShuZXcgUXVl\ncnlSZXN1bHRNYXBwaW5nW3ZhbHVlcy5zaXplKCldKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBxdWVyeSBy\nZXN1bHQgbWFwcGluZyB3aXRoIHRoZSBnaXZlbiBuYW1lLCBvciBudWxsIGlm\nCiAgICAgKiBub25lLgogICAgICovCiAgICBwdWJsaWMgUXVlcnlSZXN1bHRN\nYXBwaW5nIGdldENhY2hlZFF1ZXJ5UmVzdWx0TWFwcGluZwogICAgICAgIChD\nbGFzcyBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2NraW5n\nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAg\nICAgICAgICAgcmV0dXJuIChRdWVyeVJlc3VsdE1hcHBpbmcpIF9yZXN1bHRz\nLmdldChnZXRRdWVyeVJlc3VsdEtleShjbHMsIG5hbWUpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAoUXVl\ncnlSZXN1bHRNYXBwaW5nKSBfcmVzdWx0cy5nZXQoZ2V0UXVlcnlSZXN1bHRL\nZXkoY2xzLCBuYW1lKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIGEgcXVlcnkgcmVzdWx0IG1hcHBpbmcuCiAgICAgKi8KICAgIHB1\nYmxpYyBRdWVyeVJlc3VsdE1hcHBpbmcgYWRkUXVlcnlSZXN1bHRNYXBwaW5n\nKENsYXNzIGNscywKICAgICAgICBTdHJpbmcgbmFtZSkgewogICAgICAgIGlm\nIChfbG9ja2luZykgewogICAgICAgICAgICByZXR1cm4gYWRkUXVlcnlSZXN1\nbHRNYXBwaW5nTG9ja2luZyhjbHMsIG5hbWUpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIHJldHVybiBhZGRRdWVyeVJlc3VsdE1hcHBpbmdJbnRl\ncm5hbChjbHMsIG5hbWUpOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUg\nc3luY2hyb25pemVkIFF1ZXJ5UmVzdWx0TWFwcGluZyBhZGRRdWVyeVJlc3Vs\ndE1hcHBpbmdMb2NraW5nKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAg\nICAgICByZXR1cm4gYWRkUXVlcnlSZXN1bHRNYXBwaW5nSW50ZXJuYWwoY2xz\nLCBuYW1lKTsKICAgIH0KCiAgICBwcml2YXRlIFF1ZXJ5UmVzdWx0TWFwcGlu\nZyBhZGRRdWVyeVJlc3VsdE1hcHBpbmdJbnRlcm5hbChDbGFzcyBjbHMsIFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlcyA9\nIG5ldyBRdWVyeVJlc3VsdE1hcHBpbmcobmFtZSwgdGhpcyk7CiAgICAgICAg\ncmVzLnNldERlZmluaW5nVHlwZShjbHMpOwogICAgICAgIF9yZXN1bHRzLnB1\ndChnZXRRdWVyeVJlc3VsdEtleShyZXMpLCByZXMpOwogICAgICAgIHJldHVy\nbiByZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBxdWVyeSBy\nZXN1bHQgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVt\nb3ZlUXVlcnlSZXN1bHRNYXBwaW5nCiAgICAgICAgKFF1ZXJ5UmVzdWx0TWFw\ncGluZyByZXMpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gX3Jlc3VsdHMucmVtb3ZlKGdldFF1ZXJ5UmVzdWx0S2V5KHJlcykpICE9\nIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICByZXR1cm4gX3Jlc3VsdHMucmVtb3ZlKGdldFF1ZXJ5UmVzdWx0S2V5\nKHJlcykpICE9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIGEgcXVlcnkgcmVzdWx0IG1hcHBpbmcuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5UmVzdWx0TWFwcGluZyhDbGFz\ncyBjbHMsCiAgICAgICAgU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoX2xv\nY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAg\nICAgICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBf\ncmVzdWx0cy5yZW1vdmUoZ2V0UXVlcnlSZXN1bHRLZXkoY2xzLCBuYW1lKSkg\nIT0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0cy5yZW1vdmUo\nZ2V0UXVlcnlSZXN1bHRLZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5\nIGZvciB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgT2JqZWN0IGdldFF1ZXJ5UmVzdWx0S2V5KFF1ZXJ5UmVzdWx0TWFw\ncGluZyByZXMpIHsKICAgICAgICBpZiAocmVzID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBnZXRRdWVyeVJlc3Vs\ndEtleShyZXMuZ2V0RGVmaW5pbmdUeXBlKCksIHJlcy5nZXROYW1lKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgdW5pcXVlIGtleSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzIC8gbmFtZS4gVGhlIGNsYXNzIGFyZ3VtZW50CiAg\nICAgKiBjYW4gYmUgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nT2JqZWN0IGdldFF1ZXJ5UmVzdWx0S2V5KENsYXNzIGNscywgU3RyaW5nIG5h\nbWUpIHsKICAgICAgICByZXR1cm4gZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKTsK\nICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldE1hcHBpbmcoQ2xh\nc3MgY2xzLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsCiAgICAgICAgYm9vbGVh\nbiBtdXN0RXhpc3QpIHsKICAgICAgICByZXR1cm4gKENsYXNzTWFwcGluZykg\nc3VwZXIuZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7\nCiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdldE1hcHBpbmdz\nKCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nW10pIHN1cGVyLmdl\ndE1ldGFEYXRhcygpOwogICAgfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmcg\nZ2V0TWFwcGluZyhPYmplY3Qgb2lkLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIs\nCiAgICAgICAgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICByZXR1cm4g\nKENsYXNzTWFwcGluZykgc3VwZXIuZ2V0TWV0YURhdGEob2lkLCBlbnZMb2Fk\nZXIsIG11c3RFeGlzdCk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGlu\nZ1tdIGdldEltcGxlbWVudG9yTWFwcGluZ3MoQ2xhc3MgY2xzLAogICAgICAg\nIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsK\nICAgICAgICByZXR1cm4gKENsYXNzTWFwcGluZ1tdKSBzdXBlci5nZXRJbXBs\nZW1lbnRvck1ldGFEYXRhcyhjbHMsIGVudkxvYWRlciwKICAgICAgICAgICAg\nbXVzdEV4aXN0KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsK\nICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25p\nemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBzdXBlci5jbGVhcigpOwog\nICAgICAgICAgICAgICAgX3NjaGVtYSA9IG51bGw7CiAgICAgICAgICAgICAg\nICBfcmVzdWx0cy5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICAgICAg\nX3NjaGVtYSA9IG51bGw7CiAgICAgICAgICAgIF9yZXN1bHRzLmNsZWFyKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHByZXBhcmVN\nYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIC8vIG1ha2Ug\nc3VyZSBzdXBlcmNsYXNzIHJlc29sdmVkIGZpcnN0OyByZXNvbHZpbmcgc3Vw\nZXJjbGFzcyBtYXkgaGF2ZQogICAgICAgIC8vIHJlc29sdmVkIHRoaXMgbWFw\ncGluZwogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFw\ncGluZykgbWV0YTsKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGlu\nZy5nZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1cCAh\nPSBudWxsICYmIChtYXBwaW5nLmdldFJlc29sdmUoKSAmIE1PREVfTUFQUElO\nRykgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIAogICAgICAg\nIC8vIGlmIHRoaXMgbWFwcGluZyBpcyBub3QgZm9yIGEgbWFuYWdlZCBpbnRl\ncmZhY2UsIGVuc3VyZSB0aGF0IGlmIAogICAgICAgIC8vIHdlIGhhdmUgYW4g\naW5oZXJpdGFuY2UgaGllcmFyY2h5IHRoZXJlIGlzIGEgZGVmYXVsdCBzdHJh\ndGVneQogICAgICAgIC8vIGFwcGxpZWQgdG8gdGhlIHJvb3QgY2xhc3MKICAg\nICAgICBpZiAoIW1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJm\nYWNlKCkgJiYKICAgICAgICAgICAgIW1hcHBpbmcuaXNFbWJlZGRlZE9ubHko\nKSkgewogICAgICAgICAgICAvLyBpZiBhbiBpbmhlcml0YW5jZSBzdHJhdGVn\neSBoYXMgbm90IGJlZW4gc2V0IG9uIHRoaXMgbWFwcGluZwogICAgICAgICAg\nICAvLyBkZXRlcm1pbmUgaWYgbmVlZHMgb25lIGFuZCBpZiBzbywgc2V0IGl0\nCiAgICAgICAgICAgIGlmICghaGFzSW5oZXJpdGFuY2VTdHJhdGVneShtYXBw\naW5nKSkgewogICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2VNYXBw\naW5nID0gZmluZEJhc2VDbGFzc01hcHBpbmcobWFwcGluZyk7IAogICAgICAg\nICAgICAgICAgaWYgKGJhc2VNYXBwaW5nICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgc2V0RGVmYXVsdEluaGVyaXRhbmNlU3RyYXRlZ3koYmFzZU1h\ncHBpbmcpOwogICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgfQoK\nICAgICAgICAvLyBkZWZpbmUgc3VwZXJjbGFzcyBmaWVsZHMgYWZ0ZXIgbWFw\ncGluZyBjbGFzcywgc28gd2UgY2FuIHRlbGwgd2hldGhlcgogICAgICAgIC8v\nIHRoZSBjbGFzcyBpcyBtYXBwZWQgYW5kIG5lZWRzIHRvIHJlZGVmaW5lIGFi\nc3RyYWN0IHN1cGVyY2xhc3MgZmllbGRzCiAgICAgICAgZ2V0U3RyYXRlZ3lJ\nbnN0YWxsZXIoKS5pbnN0YWxsU3RyYXRlZ3kobWFwcGluZyk7CiAgICAgICAg\nbWFwcGluZy5kZWZpbmVTdXBlcmNsYXNzRmllbGRzKG1hcHBpbmcuZ2V0Sm9p\nbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkKICAgICAgICAgICAgPT0gbnVs\nbCk7CgogICAgICAgIC8vIHJlc29sdmUgZXZlcnl0aGluZyB0aGF0IGRvZXNu\nJ3QgaW52b2x2ZSByZWxhdGlvbnMgdG8gYWxsb3cgcmVsYXRpb24KICAgICAg\nICAvLyBtYXBwaW5ncyB0byB1c2UgdGhlIG90aGVycyBhcyBqb2luYWJsZXMK\nICAgICAgICBtYXBwaW5nLnJlc29sdmVOb25SZWxhdGlvbk1hcHBpbmdzKCk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgbmV3Q2xhc3NN\nZXRhRGF0YShDbGFzcyB0eXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFz\nc01hcHBpbmcodHlwZSwgdGhpcyk7CiAgICB9CgogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGFbXSBuZXdDbGFzc01ldGFEYXRhQXJyYXkoaW50IGxlbmd0\naCkgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNYXBwaW5nW2xlbmd0aF07\nCiAgICB9CgogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURhdGEgbmV3RmllbGRN\nZXRhRGF0YShTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBDbGFz\nc01ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZE1h\ncHBpbmcobmFtZSwgdHlwZSwgKENsYXNzTWFwcGluZykgb3duZXIpOwogICAg\nfQoKICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhW10gbmV3RmllbGRNZXRh\nRGF0YUFycmF5KGludCBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gbmV3IEZp\nZWxkTWFwcGluZ1tsZW5ndGhdOwogICAgfQoKICAgIHByb3RlY3RlZCBDbGFz\nc01ldGFEYXRhIG5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShWYWx1ZU1ldGFE\nYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01hcHBpbmco\nb3duZXIpOwogICAgfQoKICAgIHByb3RlY3RlZCBWYWx1ZU1ldGFEYXRhIG5l\nd1ZhbHVlTWV0YURhdGEoRmllbGRNZXRhRGF0YSBvd25lcikgewogICAgICAg\nIHJldHVybiBuZXcgVmFsdWVNYXBwaW5nSW1wbCgoRmllbGRNYXBwaW5nKSBv\nd25lcik7CiAgICB9CgogICAgcHJvdGVjdGVkIFNlcXVlbmNlTWV0YURhdGEg\nbmV3U2VxdWVuY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkgewogICAgICAgIHJl\ndHVybiBuZXcgU2VxdWVuY2VNYXBwaW5nKG5hbWUsIHRoaXMpOwogICAgfQoK\nICAgIHByb3RlY3RlZCBPcmRlciBuZXdWYWx1ZU9yZGVyKEZpZWxkTWV0YURh\ndGEgb3duZXIsIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBK\nREJDVmFsdWVPcmRlcigoRmllbGRNYXBwaW5nKSBvd25lciwgYXNjKTsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3UmVsYXRlZEZpZWxkT3JkZXIo\nRmllbGRNZXRhRGF0YSBvd25lciwKICAgICAgICBGaWVsZE1ldGFEYXRhIHJl\nbCwgYm9vbGVhbiBhc2MpIHsKICAgICAgICByZXR1cm4gbmV3IEpEQkNSZWxh\ndGVkRmllbGRPcmRlcigoRmllbGRNYXBwaW5nKSBvd25lciwKICAgICAgICAg\nICAgKEZpZWxkTWFwcGluZykgcmVsLCBhc2MpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBPcmRlcltdIG5ld09yZGVyQXJyYXkoaW50IHNpemUpIHsKICAgICAg\nICByZXR1cm4gbmV3IEpEQkNPcmRlcltzaXplXTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSB2ZXJzaW9uIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4g\nY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uIG5ld1ZlcnNp\nb24oQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIHJldHVybiBuZXcgVmVy\nc2lvbihjbHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGRpc2Ny\naW1pbmF0b3IgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAgICAq\nLwogICAgcHJvdGVjdGVkIERpc2NyaW1pbmF0b3IgbmV3RGlzY3JpbWluYXRv\ncihDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEaXNj\ncmltaW5hdG9yKGNscyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\ncmF3IG1hcHBpbmcgaW5mbyBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNYXBwaW5nSW5mbyBuZXdNYXBwaW5n\nSW5mbyhDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nSW5mbyBpbmZvID0gbmV3IENsYXNzTWFwcGluZ0luZm8oKTsKICAgICAgICBp\nbmZvLnNldENsYXNzTmFtZShjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5h\nbWUoKSk7CiAgICAgICAgcmV0dXJuIGluZm87CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgcmF3IG1hcHBpbmcgaW5mbyBmb3IgdGhlIGdpdmVuIGlu\nc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmllbGRNYXBwaW5nSW5m\nbyBuZXdNYXBwaW5nSW5mbyhGaWVsZE1hcHBpbmcgZm0pIHsKICAgICAgICBy\nZXR1cm4gbmV3IEZpZWxkTWFwcGluZ0luZm8oKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZvciB0aGUgZ2l2ZW4g\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZU1hcHBpbmdJ\nbmZvIG5ld01hcHBpbmdJbmZvKFZhbHVlTWFwcGluZyB2bSkgewogICAgICAg\nIHJldHVybiBuZXcgVmFsdWVNYXBwaW5nSW5mbygpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIHJhdyBtYXBwaW5nIGluZm8gZm9yIHRoZSBnaXZl\nbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25NYXBw\naW5nSW5mbyBuZXdNYXBwaW5nSW5mbyhWZXJzaW9uIHZlcnNpb24pIHsKICAg\nICAgICByZXR1cm4gbmV3IFZlcnNpb25NYXBwaW5nSW5mbygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIHJhdyBtYXBwaW5nIGluZm8gZm9yIHRo\nZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIERpc2Ny\naW1pbmF0b3JNYXBwaW5nSW5mbyBuZXdNYXBwaW5nSW5mbyhEaXNjcmltaW5h\ndG9yIGRpc2MpIHsKICAgICAgICByZXR1cm4gbmV3IERpc2NyaW1pbmF0b3JN\nYXBwaW5nSW5mbygpOwogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFudGlh\ndGUgdGhlIGdpdmVuIGNsYXNzJyBuYW1lZCBzdHJhdGVneSwgb3IgcmV0dXJu\nIG51bGwgaWYgbm8KICAgICAqIG5hbWVkIHN0cmF0ZWd5LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ2xhc3NTdHJhdGVneSBuYW1lZFN0cmF0ZWd5KENsYXNz\nTWFwcGluZyBjbHMpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGNscy5nZXRN\nYXBwaW5nSW5mbygpLmdldFN0cmF0ZWd5KCk7CiAgICAgICAgcmV0dXJuIGlu\nc3RhbnRpYXRlQ2xhc3NTdHJhdGVneShuYW1lLCBjbHMpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBzdHJhdGVneSBmb3IgdGhlIGdpdmVu\nIG5hbWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc1N0cmF0ZWd5IGlu\nc3RhbnRpYXRlQ2xhc3NTdHJhdGVneShTdHJpbmcgbmFtZSwKICAgICAgICBD\nbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKE5vbmVDbGFz\nc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0\ndXJuIE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAg\nIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMo\nbmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNz\nTmFtZShuYW1lKTsKICAgICAgICBDbGFzcyBzdHJhdCA9IG51bGw7CgogICAg\nICAgIC8vIGJhc2UgYW5kIHZlcnRpY2FsIHN0cmF0ZWdpZXMgdXNlIHNhbWUg\nYWxpYXM7IGRpZmZlcmVudGlhdGUgb24gam9pbgogICAgICAgIGlmIChGdWxs\nQ2xhc3NTdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAg\nIHN0cmF0ID0gRnVsbENsYXNzU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxz\nZSBpZiAoRmxhdENsYXNzU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQog\nICAgICAgICAgICBzdHJhdCA9IEZsYXRDbGFzc1N0cmF0ZWd5LmNsYXNzOwog\nICAgICAgIGVsc2UgaWYgKFZlcnRpY2FsQ2xhc3NTdHJhdGVneS5BTElBUy5l\ncXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gVmVydGljYWxDbGFz\nc1N0cmF0ZWd5LmNsYXNzOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChzdHJhdCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3RyYXQgPSBKYXZh\nVHlwZXMuY2xhc3NGb3JOYW1lKG5hbWUsIGNscywKICAgICAgICAgICAgICAg\nICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXRDbGFzc0xvYWRlckFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIENsYXNzU3RyYXRlZ3kuY2xhc3MpKSk7CiAgICAgICAgICAgIENsYXNz\nU3RyYXRlZ3kgc3RyYXRlZ3kgPSAKICAgICAgICAgICAgICAgIChDbGFzc1N0\ncmF0ZWd5KSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlv\nbihzdHJhdCkpOwogICAgICAgICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1\ncmVJbnN0YW5jZShzdHJhdGVneSwgZ2V0Q29uZmlndXJhdGlvbigpLAogICAg\nICAgICAgICAgICAgcHJvcHMpOwogICAgICAgICAgICByZXR1cm4gc3RyYXRl\nZ3k7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9u\nKQogICAgICAgICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWNscy1zdHJhdGVn\neSIsCiAgICAgICAgICAgICAgICBjbHMsIG5hbWUpLCBlKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4g\nZmllbGQncyBuYW1lZCBzdHJhdGVneSwgb3IgcmV0dXJuIG51bGwgaWYgbm8K\nICAgICAqIG5hbWVkIHN0cmF0ZWd5LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nRmllbGRTdHJhdGVneSBuYW1lZFN0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVs\nZCwKICAgICAgICBib29sZWFuIGluc3RhbGxIYW5kbGVycykgewogICAgICAg\nIFN0cmluZyBuYW1lID0gZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5nZXRTdHJh\ndGVneSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBpZiAoTm9uZUZpZWxkU3RyYXRlZ3ku\nQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gTm9uZUZp\nZWxkU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgU3RyaW5nIHBy\nb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhuYW1lKTsKICAg\nICAgICBuYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBKYXZhVHlw\nZXMuY2xhc3NGb3JOYW1lKG5hbWUsIGZpZWxkLAogICAgICAgICAgICAgICAg\nKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xv\nYWRlckFjdGlvbihGaWVsZFN0cmF0ZWd5LmNsYXNzKSkpOwogICAgICAgICAg\nICBpZiAoRmllbGRTdHJhdGVneS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGMp\nKSB7CiAgICAgICAgICAgICAgICBGaWVsZFN0cmF0ZWd5IHN0cmF0ID0gKEZp\nZWxkU3RyYXRlZ3kpCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKGMpKTsKICAgICAgICAg\nICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKHN0cmF0\nLCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgcHJv\ncHMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmF0OwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBtdXN0IGJlIG5hbWVkIGhhbmRsZXIKICAg\nICAgICAgICAgaWYgKGluc3RhbGxIYW5kbGVycykgewogICAgICAgICAgICAg\nICAgVmFsdWVIYW5kbGVyIHZoID0gKFZhbHVlSGFuZGxlcikgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oYykpOwogICAgICAgICAg\nICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2UodmgsIGdl\ndENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgICAgICBwcm9wcyk7\nCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRIYW5kbGVyKHZoKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJGaWVsZFN0\ncmF0ZWd5KCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKQogICAgICAgICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlv\nbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWZpZWxk\nLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAgIGZpZWxkLCBuYW1lKSwgZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGUg\ndGhlIGdpdmVuIGRpc2NyaW1pbmF0b3IncyBuYW1lZCBzdHJhdGVneSwgb3Ig\ncmV0dXJuIG51bGwKICAgICAqIGlmIG5vIG5hbWVkIHN0cmF0ZWd5LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgRGlzY3JpbWluYXRvclN0cmF0ZWd5IG5hbWVk\nU3RyYXRlZ3koRGlzY3JpbWluYXRvciBkaXNjcmltKSB7CiAgICAgICAgU3Ry\naW5nIG5hbWUgPSBkaXNjcmltLmdldE1hcHBpbmdJbmZvKCkuZ2V0U3RyYXRl\nZ3koKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gaWYgdGhlcmUgaXMgYSBuYW1lZCBz\ndHJhdGVneSBwcmVzZW50LCBkaXNjYXJkIGl0IGlmIGl0IG1hdGNoZXMKICAg\nICAgICAvLyB0aGUgYmFzZSBzdHJhdGVneSwgc28gdGhhdCB3ZSB3b24ndCBj\ncmVhdGUgYW4gaW5kZXBlbmRlbnQgaW5zdGFuY2UKICAgICAgICBDbGFzc01h\ncHBpbmcgY2xzID0gZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKTsKICAgICAg\nICB3aGlsZSAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nICE9IG51bGwpCiAgICAgICAgICAgIGNscyA9IGNscy5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBEaXNjcmltaW5hdG9yIGJh\nc2UgPSBjbHMuZ2V0RGlzY3JpbWluYXRvcigpOwogICAgICAgIGlmIChiYXNl\nICE9IGRpc2NyaW0gJiYgYmFzZS5nZXRTdHJhdGVneSgpICE9IG51bGwKICAg\nICAgICAgICAgJiYgbmFtZS5lcXVhbHMoYmFzZS5nZXRTdHJhdGVneSgpLmdl\ndEFsaWFzKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\ncmV0dXJuIGluc3RhbnRpYXRlRGlzY3JpbWluYXRvclN0cmF0ZWd5KG5hbWUs\nIGRpc2NyaW0pOwogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGUg\ndGhlIGdpdmVuIGRpc2NyaW1pbmF0b3Igc3RyYXRlZ3kuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBEaXNjcmltaW5hdG9yU3RyYXRlZ3kgaW5zdGFudGlhdGVE\naXNjcmltaW5hdG9yU3RyYXRlZ3kKICAgICAgICAoU3RyaW5nIG5hbWUsIERp\nc2NyaW1pbmF0b3IgZGlzY3JpbSkgewogICAgICAgIGlmIChOb25lRGlzY3Jp\nbWluYXRvclN0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAg\nICAgcmV0dXJuIE5vbmVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuZ2V0SW5zdGFu\nY2UoKTsKCiAgICAgICAgU3RyaW5nIHByb3BzID0gQ29uZmlndXJhdGlvbnMu\nZ2V0UHJvcGVydGllcyhuYW1lKTsKICAgICAgICBuYW1lID0gQ29uZmlndXJh\ndGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUpOwogICAgICAgIENsYXNzIHN0cmF0\nID0gbnVsbDsKCiAgICAgICAgaWYgKENsYXNzTmFtZURpc2NyaW1pbmF0b3JT\ndHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0\nID0gQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzOwogICAg\nICAgIGVsc2UgaWYgKFZhbHVlTWFwRGlzY3JpbWluYXRvclN0cmF0ZWd5LkFM\nSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBWYWx1ZU1h\ncERpc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFzczsKICAgICAgICBlbHNlIGlm\nIChTdWJjbGFzc0pvaW5EaXNjcmltaW5hdG9yU3RyYXRlZ3kuQUxJQVMuZXF1\nYWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IFN1YmNsYXNzSm9pbkRp\nc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFzczsKCiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgICAgICBz\ndHJhdCA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUobmFtZSwKICAgICAgICAg\nICAgICAgICAgICBkaXNjcmltLmdldENsYXNzTWFwcGluZygpLAogICAgICAg\nICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzKSkpOwog\nICAgICAgICAgICBEaXNjcmltaW5hdG9yU3RyYXRlZ3kgc3RyYXRlZ3kgPSAo\nRGlzY3JpbWluYXRvclN0cmF0ZWd5KQogICAgICAgICAgICAgICAgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oc3RyYXQpKTsKICAg\nICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2Uoc3Ry\nYXRlZ3ksIGdldENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIHBy\nb3BzKTsKICAgICAgICAgICAgcmV0dXJuIHN0cmF0ZWd5OwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3Rh\nbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAg\nICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4\nY2VwdGlvbigpOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1kaXNjcmltLXN0cmF0ZWd5IiwKICAgICAg\nICAgICAgICAgIGRpc2NyaW0uZ2V0Q2xhc3NNYXBwaW5nKCksIG5hbWUpLCBl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0\nZSB0aGUgZ2l2ZW4gdmVyc2lvbidzIG5hbWVkIHN0cmF0ZWd5LCBvciByZXR1\ncm4gbnVsbAogICAgICogaWYgbm8gbmFtZWQgc3RyYXRlZ3kuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kgbmFtZWRTdHJhdGVneShW\nZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IHZlcnNp\nb24uZ2V0TWFwcGluZ0luZm8oKS5nZXRTdHJhdGVneSgpOwogICAgICAgIGlm\nIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICAvLyBpZiB0aGVyZSBpcyBhIG5hbWVkIHN0cmF0ZWd5IHByZXNlbnQs\nIGRpc2NhcmQgaXQgaWYgaXQgbWF0Y2hlcwogICAgICAgIC8vIHRoZSBiYXNl\nIHN0cmF0ZWd5LCBzbyB0aGF0IHdlIHdvbid0IGNyZWF0ZSBhbiBpbmRlcGVu\nZGVudCBpbnN0YW5jZQogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSB2ZXJz\naW9uLmdldENsYXNzTWFwcGluZygpOwogICAgICAgIHdoaWxlIChjbHMuZ2V0\nSm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgY2xzID0gY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpOwogICAgICAgIFZlcnNpb24gYmFzZSA9IGNscy5nZXRWZXJzaW9uKCk7\nCiAgICAgICAgaWYgKGJhc2UgIT0gdmVyc2lvbiAmJiBiYXNlLmdldFN0cmF0\nZWd5KCkgIT0gbnVsbAogICAgICAgICAgICAmJiBuYW1lLmVxdWFscyhiYXNl\nLmdldFN0cmF0ZWd5KCkuZ2V0QWxpYXMoKSkpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVWZXJzaW9uU3Ry\nYXRlZ3kobmFtZSwgdmVyc2lvbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmVyc2lvbiBzdHJhdGVneS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFZlcnNpb25TdHJhdGVneSBpbnN0YW50aWF0ZVZl\ncnNpb25TdHJhdGVneShTdHJpbmcgbmFtZSwKICAgICAgICBWZXJzaW9uIHZl\ncnNpb24pIHsKICAgICAgICBpZiAoTm9uZVZlcnNpb25TdHJhdGVneS5BTElB\nUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHJldHVybiBOb25lVmVyc2lv\nblN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9w\ncyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAg\nICAgbmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsK\nICAgICAgICBDbGFzcyBzdHJhdCA9IG51bGw7CgogICAgICAgIGlmIChOdW1i\nZXJWZXJzaW9uU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAg\nICAgICBzdHJhdCA9IE51bWJlclZlcnNpb25TdHJhdGVneS5jbGFzczsKICAg\nICAgICBlbHNlIGlmIChUaW1lc3RhbXBWZXJzaW9uU3RyYXRlZ3kuQUxJQVMu\nZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IFRpbWVzdGFtcFZl\ncnNpb25TdHJhdGVneS5jbGFzczsKICAgICAgICBlbHNlIGlmIChOYW5vUHJl\nY2lzaW9uVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5LkFMSUFTLmVxdWFscyhu\nYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBOYW5vUHJlY2lzaW9uVGltZXN0\nYW1wVmVyc2lvblN0cmF0ZWd5LmNsYXNzOwogICAgICAgIGVsc2UgaWYgKFN0\nYXRlQ29tcGFyaXNvblZlcnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFt\nZSkpCiAgICAgICAgICAgIHN0cmF0ID0gU3RhdGVDb21wYXJpc29uVmVyc2lv\nblN0cmF0ZWd5LmNsYXNzOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0cmF0ID0gSmF2\nYVR5cGVzLmNsYXNzRm9yTmFtZShuYW1lLAogICAgICAgICAgICAgICAgICAg\nIHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCksCiAgICAgICAgICAgICAgICAg\nICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nQ2xhc3NMb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBWZXJzaW9uU3RyYXRlZ3kuY2xhc3MpKSk7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtdmVyc2lvbi1zdHJhdGVneSIsCiAg\nICAgICAgICAgICAgICB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpLCBuYW1l\nKSwgZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVW\nZXJzaW9uU3RyYXRlZ3koc3RyYXQsIHZlcnNpb24sIHByb3BzKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBnaXZlbiB2ZXJzaW9u\nIHN0cmF0ZWd5LgogICAgICovCiAgICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0\nZWd5IGluc3RhbnRpYXRlVmVyc2lvblN0cmF0ZWd5KENsYXNzIHN0cmF0LAog\nICAgICAgIFZlcnNpb24gdmVyc2lvbiwgU3RyaW5nIHByb3BzKSB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgVmVyc2lvblN0cmF0ZWd5IHN0cmF0ZWd5\nID0gKFZlcnNpb25TdHJhdGVneSkKICAgICAgICAgICAgICAgIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKHN0cmF0KSk7CiAgICAg\nICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKHN0cmF0\nZWd5LCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICBwcm9w\ncyk7CiAgICAgICAgICAgIHJldHVybiBzdHJhdGVneTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoZSBpbnN0YW5j\nZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAgICAgICAgICAgICAg\nICBlID0gKChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtdmVyc2lvbi1zdHJhdGVneSIsCiAgICAgICAg\nICAgICAgICB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpLCBzdHJhdCArICIi\nKSwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJt\naW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVu\nIGNsYXNzLiBEb2VzCiAgICAgKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhl\nIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIENsYXNzU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KENsYXNzTWFwcGlu\nZyBjbHMpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGNscywg\nZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5\nIHRvIHVzZSBmb3IgdGhlIGdpdmVuIGNsYXNzLiBEb2VzCiAgICAgKiBub3Qg\ndGFrZSBpbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFu\neS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzU3RyYXRlZ3kgZGVmYXVs\ndFN0cmF0ZWd5KENsYXNzTWFwcGluZyBjbHMsCiAgICAgICAgYm9vbGVhbiBh\nZGFwdGluZykgewogICAgICAgIFZhbHVlTWFwcGluZyBlbWJlZCA9IGNscy5n\nZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVtYmVkICE9IG51\nbGwpIHsKICAgICAgICAgICAgLy8gc3VwZXJjbGFzcyBvZiBlbWJlZGRlZCBj\nbGFzcyBpc24ndCBtYXBwZWQKICAgICAgICAgICAgaWYgKGVtYmVkLmdldFR5\ncGUoKSAhPSBjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpCiAgICAgICAgICAgICAg\nICB8fCBlbWJlZC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRTdHJhdGVneSgpCiAg\nICAgICAgICAgICAgICA9PSBOb25lRmllbGRTdHJhdGVneS5nZXRJbnN0YW5j\nZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmVDbGFzc1N0cmF0ZWd5\nLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmIChlbWJlZC5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IE9iamVjdElkQ2xhc3NTdHJhdGVneSgpOwogICAgICAgICAgICBy\nZXR1cm4gbmV3IEVtYmVkZGVkQ2xhc3NTdHJhdGVneSgpOwogICAgICAgIH0K\nICAgICAgICBpZiAoY2xzLmlzRW1iZWRkZWRPbmx5KCkpCiAgICAgICAgICAg\nIHJldHVybiBOb25lQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAg\nICAgICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVsdHMuZ2V0U3RyYXRlZ3koY2xz\nLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKHN0cmF0IGluc3RhbmNlb2YgU3Ry\naW5nKQogICAgICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVDbGFzc1N0cmF0\nZWd5KChTdHJpbmcpIHN0cmF0LCBjbHMpOwogICAgICAgIGlmIChzdHJhdCAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKENsYXNzU3RyYXRlZ3kpIHN0\ncmF0OwogICAgICAgIAogICAgICAgIC8vIHNlZSBpZiB0aGVyZSBpcyBhIGRl\nY2xhcmVkIGhpZXJhcmNoeSBzdHJhdGVneQogICAgICAgIENsYXNzU3RyYXRl\nZ3kgaHN0cmF0ID0gbnVsbDsKICAgICAgICBmb3IgKENsYXNzTWFwcGluZyBi\nYXNlID0gY2xzOyBiYXNlICE9IG51bGwgJiYgaHN0cmF0ID09IG51bGw7KSB7\nCiAgICAgICAgICAgIGhzdHJhdCA9IGluc3RhbnRpYXRlQ2xhc3NTdHJhdGVn\neShiYXNlLmdldE1hcHBpbmdJbmZvKCkuCiAgICAgICAgICAgICAgICBnZXRI\naWVyYXJjaHlTdHJhdGVneSgpLCBjbHMpOwogICAgICAgICAgICBiYXNlID0g\nYmFzZS5nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\nfQoKICAgICAgICAvLyB0aGUgZnVsbCBzdHJhdGVneSBhcyBhcHBsaWVkIHRv\nIGEgaGllcmFyY2h5IGlzIGEKICAgICAgICAvLyB0YWJsZS1wZXItY29uY3Jl\ndGUtY2xhc3Mgc3RyYXRlZ3ksIHNvIGRvbid0IG1hcCBhYnN0cmFjdCB0eXBl\ncwogICAgICAgIGlmIChoc3RyYXQgaW5zdGFuY2VvZiBGdWxsQ2xhc3NTdHJh\ndGVneQogICAgICAgICAgICAmJiAhY2xzLmlzTWFuYWdlZEludGVyZmFjZSgp\nCiAgICAgICAgICAgICYmIE1vZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldERl\nc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHJl\ndHVybiBOb25lQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAg\nIAogICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBjbHMuZ2V0TWFwcGVkUENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChzdXAgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBGdWxsQ2xhc3NTdHJhdGVneSgpOwog\nICAgICAgIGlmIChoc3RyYXQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGhzdHJhdDsKICAgICAgICByZXR1cm4gbmV3IEZsYXRDbGFzc1N0cmF0ZWd5\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1\nbHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gZmllbGQuIERvZXMK\nICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgbmFtZWQgb3IgY3Vy\ncmVudCBzdHJhdGVneSwgaWYgYW55LiBJZiBhCiAgICAgKiBub24tbnVsbCBz\ndHJhdGVneSBpcyByZXR1cm5lZCwgdGhpcyBtZXRob2QgbWF5IGFzIGEgc2lk\nZSBlZmZlY3QgaW5zdGFsbAogICAgICogdmFsdWUgaGFuZGxlcnMgb24gdGhl\nIGZpZWxkJ3MgdmFsdWUgbWFwcGluZ3MuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBGaWVsZFN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShGaWVsZE1hcHBpbmcg\nZmllbGQsCiAgICAgICAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAg\nICAgICByZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGZpZWxkLCBpbnN0YWxsSGFu\nZGxlcnMsCiAgICAgICAgICAgIGdldFN0cmF0ZWd5SW5zdGFsbGVyKCkuaXNB\nZGFwdGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0\naGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiBmaWVs\nZC4gRG9lcwogICAgICogbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBuYW1l\nZCBvciBjdXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuIElmIGEKICAgICAqIG5v\nbi1udWxsIHN0cmF0ZWd5IGlzIHJldHVybmVkLCB0aGlzIG1ldGhvZCBtYXkg\nYXMgYSBzaWRlIGVmZmVjdCBpbnN0YWxsCiAgICAgKiB2YWx1ZSBoYW5kbGVy\ncyBvbiB0aGUgZmllbGQncyB2YWx1ZSBtYXBwaW5ncy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KEZpZWxk\nTWFwcGluZyBmaWVsZCwKICAgICAgICBib29sZWFuIGluc3RhbGxIYW5kbGVy\ncywgYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIC8vIG5vdCBwZXJzaXN0\nZW50PwogICAgICAgIGlmIChmaWVsZC5nZXRNYW5hZ2VtZW50KCkgIT0gZmll\nbGQuTUFOQUdFX1BFUlNJU1RFTlQKICAgICAgICAgICAgfHwgZmllbGQuaXNW\nZXJzaW9uKCkpCiAgICAgICAgICAgIHJldHVybiBOb25lRmllbGRTdHJhdGVn\neS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlmIChmaWVsZC5nZXREZWZpbmlu\nZ01hcHBpbmcoKS5nZXRTdHJhdGVneSgpID09CiAgICAgICAgICAgIE5vbmVD\nbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCkpCiAgICAgICAgICAgIHJldHVy\nbiBOb25lRmllbGRTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICAv\nLyBjaGVjayBmb3IgbmFtZWQgaGFuZGxlciBmaXJzdAogICAgICAgIFZhbHVl\nSGFuZGxlciBoYW5kbGVyID0gbmFtZWRIYW5kbGVyKGZpZWxkKTsKICAgICAg\nICBpZiAoaGFuZGxlciAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbnN0\nYWxsSGFuZGxlcnMpCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRIYW5kbGVy\nKGhhbmRsZXIpOwogICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJGaWVs\nZFN0cmF0ZWd5KCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmllbGQuaXNT\nZXJpYWxpemVkKCkpIHsKICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVk\nZGVkQmxvYlNpemUgIT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIE1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAvLyBjaGVjayBmb3IgbWFwcGVkIHN0cmF0ZWd5\nCiAgICAgICAgICAgIE9iamVjdCBzdHJhdCA9IG1hcHBlZFN0cmF0ZWd5KGZp\nZWxkLCBmaWVsZC5nZXRUeXBlKCksIGFkYXB0aW5nKTsKICAgICAgICAgICAg\naWYgKHN0cmF0IGluc3RhbmNlb2YgRmllbGRTdHJhdGVneSkKICAgICAgICAg\nICAgICAgIHJldHVybiAoRmllbGRTdHJhdGVneSkgc3RyYXQ7CiAgICAgICAg\nICAgIGlmIChzdHJhdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\naW5zdGFsbEhhbmRsZXJzKQogICAgICAgICAgICAgICAgICAgIGZpZWxkLnNl\ndEhhbmRsZXIoKFZhbHVlSGFuZGxlcikgc3RyYXQpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBIYW5kbGVyRmllbGRTdHJhdGVneSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBmb3Iga25vd24g\nZmllbGQgc3RyYXRlZ2llcwogICAgICAgIGlmICghZmllbGQuaXNTZXJpYWxp\nemVkKCkgJiYgKGZpZWxkLmdldFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAg\nICAgICAgICAgfHwgZmllbGQuZ2V0VHlwZSgpID09IEJ5dGVbXS5jbGFzcykp\nIHsKICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQmxvYlNpemUg\nIT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1heEVtYmVkZGVk\nQnl0ZUFycmF5RmllbGRTdHJhdGVneSgpOwogICAgICAgIH0gZWxzZSBpZiAo\nIWZpZWxkLmlzU2VyaWFsaXplZCgpCiAgICAgICAgICAgICYmIChmaWVsZC5n\nZXRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAgIHx8IGZpZWxk\nLmdldFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykpIHsKICAgICAgICAg\nICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUgIT0gLTEgJiYgaXND\nbG9iKGZpZWxkLCBmYWxzZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIE1heEVtYmVkZGVkQ2hhckFycmF5RmllbGRTdHJhdGVneSgpOwogICAgICAg\nIH0gZWxzZSBpZiAoIWZpZWxkLmlzU2VyaWFsaXplZCgpKSB7CiAgICAgICAg\nICAgIEZpZWxkU3RyYXRlZ3kgc3RyYXQgPSBkZWZhdWx0VHlwZVN0cmF0ZWd5\nKGZpZWxkLCBpbnN0YWxsSGFuZGxlcnMsCiAgICAgICAgICAgICAgICBhZGFw\ndGluZyk7CiAgICAgICAgICAgIGlmIChzdHJhdCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHN0cmF0OwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2hlY2sgZm9yIGRlZmF1bHQgaGFuZGxlcgogICAgICAgIGhhbmRsZXIgPSBk\nZWZhdWx0SGFuZGxlcihmaWVsZCwgYWRhcHRpbmcpOwogICAgICAgIGlmICho\nYW5kbGVyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGluc3RhbGxIYW5k\nbGVycykKICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRsZXIoaGFuZGxl\ncik7CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlckZpZWxkU3RyYXRl\nZ3koKTsKICAgICAgICB9CgogICAgICAgIC8vIGRlZmF1bHQgdG8gYmxvYgog\nICAgICAgIGlmIChpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICAgICAgaWYg\nKGdldExvZygpLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGdl\ndExvZygpLndhcm4oX2xvYy5nZXQoIm5vLWZpZWxkLXN0cmF0ZWd5IiwgZmll\nbGQpKTsKICAgICAgICAgICAgZmllbGQuc2V0U2VyaWFsaXplZCh0cnVlKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQmxvYlNp\nemUgPT0gLTEpIHsKICAgICAgICAgICAgaWYgKGluc3RhbGxIYW5kbGVycykK\nICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRsZXIoQmxvYlZhbHVlSGFu\nZGxlci5nZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBI\nYW5kbGVyRmllbGRTdHJhdGVneSgpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbmV3IE1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3koKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnVpbHQtaW4gc3RyYXRlZ3kg\nZm9yIHRoZSBmaWVsZCdzIHR5cGUsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgZGVmYXVsdFR5cGVTdHJh\ndGVneShGaWVsZE1hcHBpbmcgZmllbGQsCiAgICAgICAgYm9vbGVhbiBpbnN0\nYWxsSGFuZGxlcnMsIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBzd2l0\nY2ggKGZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgUHJpbWl0aXZlRmllbGRTdHJhdGVneSgpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBpZiAo\nIWlzQ2xvYihmaWVsZCwgZmFsc2UpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nRmllbGRTdHJhdGVneSgpOwogICAgICAgICAgICAg\nICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUgIT0gLTEpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXhFbWJlZGRlZENsb2JGaWVs\nZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAoZmll\nbGQuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBFbWJlZEZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAgIGlm\nIChmaWVsZC5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkKICAgICAgICAg\nICAgICAgICAgICB8fCAhdXNlVW50eXBlZFBDSGFuZGxlcihmaWVsZCkpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvbkZpZWxkU3Ry\nYXRlZ3koKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIFZhbHVlTWFwcGluZyBl\nbGVtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAg\nICAgIFZhbHVlSGFuZGxlciBlaGFuZGxlciA9IG5hbWVkSGFuZGxlcihlbGVt\nKTsKICAgICAgICAgICAgICAgIGlmIChlaGFuZGxlciA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGVoYW5kbGVyID0gZGVmYXVsdEhhbmRsZXIoZWxl\nbSk7CiAgICAgICAgICAgICAgICBpZiAoZWhhbmRsZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlckNvbGxlY3Rpb25TdHJh\ndGVneShmaWVsZCwgZWhhbmRsZXIsIAogICAgICAgICAgICAgICAgICAgICAg\nICBpbnN0YWxsSGFuZGxlcnMpOwogICAgICAgICAgICAgICAgaWYgKGVsZW0u\nZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMKICAgICAgICAgICAgICAg\nICAgICAmJiAhZWxlbS5pc1NlcmlhbGl6ZWQoKSAmJiAhZWxlbS5pc0VtYmVk\nZGVkUEMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh1c2VJbnZlcnNl\nS2V5TWFwcGluZyhmaWVsZCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgUmVsYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtleUZpZWxkU3Ry\nYXRlZ3koKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlbGF0\naW9uQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneSgpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIFZhbHVlTWFwcGlu\nZyBrZXkgPSBmaWVsZC5nZXRLZXlNYXBwaW5nKCk7CiAgICAgICAgICAgICAg\nICBWYWx1ZUhhbmRsZXIga2hhbmRsZXIgPSBuYW1lZEhhbmRsZXIoa2V5KTsK\nICAgICAgICAgICAgICAgIGlmIChraGFuZGxlciA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIGtoYW5kbGVyID0gZGVmYXVsdEhhbmRsZXIoa2V5KTsK\nICAgICAgICAgICAgICAgIFZhbHVlTWFwcGluZyB2YWwgPSBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpOwogICAgICAgICAgICAgICAgVmFsdWVIYW5kbGVy\nIHZoYW5kbGVyID0gbmFtZWRIYW5kbGVyKHZhbCk7CiAgICAgICAgICAgICAg\nICBpZiAodmhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB2\naGFuZGxlciA9IGRlZmF1bHRIYW5kbGVyKHZhbCk7CiAgICAgICAgICAgICAg\nICBib29sZWFuIGtyZWwgPSBraGFuZGxlciA9PSBudWxsIAogICAgICAgICAg\nICAgICAgICAgICYmIGtleS5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5Q\nQwogICAgICAgICAgICAgICAgICAgICYmICFrZXkuaXNTZXJpYWxpemVkKCkg\nJiYgIWtleS5pc0VtYmVkZGVkUEMoKTsKICAgICAgICAgICAgICAgIGJvb2xl\nYW4gdnJlbCA9IHZoYW5kbGVyID09IG51bGwgCiAgICAgICAgICAgICAgICAg\nICAgJiYgdmFsLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDCiAgICAg\nICAgICAgICAgICAgICAgJiYgIXZhbC5pc1NlcmlhbGl6ZWQoKSAmJiAhdmFs\nLmlzRW1iZWRkZWRQQygpOwogICAgICAgICAgICAgICAgaWYgKCFrcmVsICYm\nIHZyZWwgJiYga2V5LmdldFZhbHVlTWFwcGVkQnkoKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHVzZUludmVyc2VLZXlNYXBwaW5nKGZp\nZWxkKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxh\ndGlvbk1hcEludmVyc2VLZXlGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvbk1hcFRhYmxlRmllbGRTdHJh\ndGVneSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYg\nKCFrcmVsICYmIGtoYW5kbGVyID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBpZiAoIXZyZWwgJiYgdmhhbmRs\nZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIHJldHVybiBoYW5kbGVyTWFwU3RyYXRlZ3koZmllbGQsIGto\nYW5kbGVyLCB2aGFuZGxlciwga3JlbCwKICAgICAgICAgICAgICAgICAgICB2\ncmVsLCBpbnN0YWxsSGFuZGxlcnMpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlBVVF9TVFJFQU06CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLklOUFVUX1JFQURFUjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTG9i\nRmllbGRTdHJhdGVneSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29sbGVjdGlv\nbiBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgaGFuZGxlciwgb3Ig\nbnVsbAogICAgICogaWYgbm9uZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZp\nZWxkU3RyYXRlZ3kgaGFuZGxlckNvbGxlY3Rpb25TdHJhdGVneShGaWVsZE1h\ncHBpbmcgZmllbGQsIAogICAgICAgIFZhbHVlSGFuZGxlciBlaGFuZGxlciwg\nYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICBpZiAoZ2V0Q29u\nZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpCiAgICAg\nICAgICAgIC5nZXRTdG9yZU1hcENvbGxlY3Rpb25JbkVudGl0eUFzQmxvYigp\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5zdGFs\nbEhhbmRsZXJzKQogICAgICAgICAgICBmaWVsZC5nZXRFbGVtZW50TWFwcGlu\nZygpLnNldEhhbmRsZXIoZWhhbmRsZXIpOwogICAgICAgIHJldHVybiBuZXcg\nSGFuZGxlckNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3koKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWFwIHN0cmF0ZWd5IGZvciB0\naGUgZ2l2ZW4ga2V5IGFuZCB2YWx1ZSBoYW5kbGVycyAvIHJlbGF0aW9ucywK\nICAgICAqIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIEZpZWxkU3RyYXRlZ3kgaGFuZGxlck1hcFN0cmF0ZWd5KEZpZWxkTWFwcGlu\nZyBmaWVsZCwgCiAgICAgICAgVmFsdWVIYW5kbGVyIGtoYW5kbGVyLCBWYWx1\nZUhhbmRsZXIgdmhhbmRsZXIsIGJvb2xlYW4ga3JlbCwgCiAgICAgICAgYm9v\nbGVhbiB2cmVsLCAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAg\nICBpZiAoZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0\nYW5jZSgpCiAgICAgICAgICAgIC5nZXRTdG9yZU1hcENvbGxlY3Rpb25JbkVu\ndGl0eUFzQmxvYigpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpZiAoaW5zdGFsbEhhbmRsZXJzKSB7CiAgICAgICAgICAgIGZpZWxkLmdl\ndEtleU1hcHBpbmcoKS5zZXRIYW5kbGVyKGtoYW5kbGVyKTsKICAgICAgICAg\nICAgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5zZXRIYW5kbGVyKHZoYW5k\nbGVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFrcmVsICYmICF2cmVsKQog\nICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJIYW5kbGVyTWFwVGFibGVG\naWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKCFrcmVsICYmIHZyZWwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlclJlbGF0aW9uTWFwVGFibGVG\naWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKGtyZWwgJiYgIXZyZWwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25IYW5kbGVyTWFwVGFibGVG\naWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvblJl\nbGF0aW9uTWFwVGFibGVGaWVsZFN0cmF0ZWd5KCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBVc2UgaGludHMgaW4gbWFwcGluZyBkYXRhIHRvIGZpZ3VyZSBv\ndXQgd2hldGhlciB0aGUgZ2l2ZW4gcmVsYXRpb24KICAgICAqIGZpZWxkIHNo\nb3VsZCB1c2UgYW4gaW52ZXJzZSBmb3JlaWduIGtleSBvciBhbiBhc3NvY2lh\ndGlvbiB0YWJsZSBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gdXNlSW52ZXJzZUtleU1hcHBpbmcoRmllbGRNYXBwaW5nIGZpZWxkKSB7\nCiAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZCA9IGZpZWxkLmdldE1hcHBl\nZEJ5TWFwcGluZygpOwogICAgICAgIGlmIChtYXBwZWQgIT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAobWFwcGVkLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5\ncGVzLlBDKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nICAgIGlmIChtYXBwZWQuZ2V0RWxlbWVudCgpLmdldFR5cGVDb2RlKCkgPT0g\nSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tYXBwZWQtYnkiLCBmaWVsZCwKICAgICAgICAgICAgICAgIG1h\ncHBlZCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gd2l0aG91dCBhIG1hcHBl\nZC1ieSwgd2UgaGF2ZSB0byBsb29rIGZvciBjbHVlcyBhcyB0byB0aGUgbWFw\ncGluZy4KICAgICAgICAvLyB3ZSBhc3N1bWUgdGhhdCBhbnl0aGluZyB3aXRo\nIGVsZW1lbnQgZm9yZWlnbiBrZXkgY29sdW1ucyBidXQgbm8gam9pbgogICAg\nICAgIC8vIGNvbHVtbnMgb3IgdGFibGUgdXNlcyBhbiBpbnZlcnNlIGZvcmVp\nZ24ga2V5LCBhbmQgYW55dGhpbmcgZWxzZSB1c2VzCiAgICAgICAgLy8gYW4g\nYXNzb2NpYXRpb24gdGFibGUKICAgICAgICBGaWVsZE1hcHBpbmdJbmZvIGlu\nZm8gPSBmaWVsZC5nZXRNYXBwaW5nSW5mbygpOwogICAgICAgIFZhbHVlTWFw\ncGluZyBlbGVtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAg\nICByZXR1cm4gaW5mby5nZXRUYWJsZU5hbWUoKSA9PSBudWxsICYmIGluZm8u\nZ2V0Q29sdW1ucygpLmlzRW1wdHkoKQogICAgICAgICAgICAmJiAhZWxlbS5n\nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCkuaXNFbXB0eSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ2hlY2sgdGhlIGdpdmVuIHZhbHVlIGFnYWluc3Qg\nbWFwcGVkIHN0cmF0ZWdpZXMuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0\nIG1hcHBlZFN0cmF0ZWd5KFZhbHVlTWFwcGluZyB2YWwsIENsYXNzIHR5cGUs\nCiAgICAgICAgYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIGlmICh0eXBl\nID09IG51bGwgfHwgdHlwZSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVs\ndHMuZ2V0U3RyYXRlZ3kodmFsLCB0eXBlLCBhZGFwdGluZyk7CgogICAgICAg\nIC8vIHJlY3Vyc2Ugb24gc3VwZXJjbGFzcyBzbyB0aGF0LCBmb3IgZXhhbXBs\nZSwgYSByZWdpc3RlcmVkIGhhbmRsZXIKICAgICAgICAvLyBmb3IgamF2YS5s\nYW5nLkVudW0gd2lsbCB3b3JrIG9uIGFsbCBlbnVtcwogICAgICAgIGlmIChz\ndHJhdCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWFwcGVkU3RyYXRl\nZ3kodmFsLCB0eXBlLmdldFN1cGVyY2xhc3MoKSwgYWRhcHRpbmcpOwogICAg\nICAgIGlmICghKHN0cmF0IGluc3RhbmNlb2YgU3RyaW5nKSkKICAgICAgICAg\nICAgcmV0dXJuIHN0cmF0OwoKICAgICAgICBTdHJpbmcgbmFtZSA9IChTdHJp\nbmcpIHN0cmF0OwogICAgICAgIGlmIChOb25lRmllbGRTdHJhdGVneS5BTElB\nUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHJldHVybiBOb25lRmllbGRT\ndHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICBTdHJpbmcgcHJvcHMg\nPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKG5hbWUpOwogICAgICAg\nIG5hbWUgPSBDb25maWd1cmF0aW9ucy5nZXRDbGFzc05hbWUobmFtZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3MgYyA9IEphdmFUeXBlcy5j\nbGFzc0Zvck5hbWUobmFtZSwgdmFsLAogICAgICAgICAgICAgICAgKENsYXNz\nTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFj\ndGlvbihGaWVsZFN0cmF0ZWd5LmNsYXNzKSkpOwogICAgICAgICAgICBPYmpl\nY3QgbyA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oYykp\nOwogICAgICAgICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5j\nZShvLCBnZXRDb25maWd1cmF0aW9uKCksIHByb3BzKTsKICAgICAgICAgICAg\ncmV0dXJuIG87CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKQogICAgICAgICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlv\nbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1hcHBl\nZC1zdHJhdGVneSIsCiAgICAgICAgICAgICAgICB2YWwsIG5hbWUpLCBlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0\naGUgZ2l2ZW4gdmFsdWUncyBuYW1lZCBoYW5kbGVyLCBvciByZXR1cm4gbnVs\nbCBpZiBubwogICAgICogbmFtZWQgaGFuZGxlci4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFZhbHVlSGFuZGxlciBuYW1lZEhhbmRsZXIoVmFsdWVNYXBwaW5n\nIHZhbCkgewogICAgICAgIFN0cmluZyBuYW1lID0gdmFsLmdldFZhbHVlSW5m\nbygpLmdldFN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFN0cmluZyBwcm9w\ncyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAg\nICAgbmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzcyBjID0gSmF2YVR5cGVz\nLmNsYXNzRm9yTmFtZShuYW1lLCB2YWwsCiAgICAgICAgICAgICAgICAoQ2xh\nc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVy\nQWN0aW9uKFZhbHVlSGFuZGxlci5jbGFzcykpKTsKICAgICAgICAgICAgaWYg\nKFZhbHVlSGFuZGxlci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGMpKSB7CiAg\nICAgICAgICAgICAgICBWYWx1ZUhhbmRsZXIgdmggPSAoVmFsdWVIYW5kbGVy\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjKSk7\nCiAgICAgICAgICAgICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0\nYW5jZSh2aCwgZ2V0Q29uZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAg\nICAgIHByb3BzKTsKICAgICAgICAgICAgICAgIHJldHVybiB2aDsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsgLy8gbmFtZWQgZmll\nbGQgc3RyYXRlZ3kKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24pCiAgICAgICAgICAgICAgICBlID0gKChQcml2aWxlZ2VkQWN0\naW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtdmFs\ndWUtaGFuZGxlciIsCiAgICAgICAgICAgICAgICB2YWwsIG5hbWUpLCBlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhl\nIGRlZmF1bHQgaGFuZGxlciB0byB1c2UgZm9yIHRoZSBnaXZlbiB2YWx1ZS4g\nRG9lcwogICAgICogbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBuYW1lZCBo\nYW5kbGVyLCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZUhh\nbmRsZXIgZGVmYXVsdEhhbmRsZXIoVmFsdWVNYXBwaW5nIHZhbCkgewogICAg\nICAgIHJldHVybiBkZWZhdWx0SGFuZGxlcih2YWwsIGdldFN0cmF0ZWd5SW5z\ndGFsbGVyKCkuaXNBZGFwdGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERldGVybWluZSB0aGUgZGVmYXVsdCBoYW5kbGVyIHRvIHVzZSBmb3IgdGhl\nIGdpdmVuIHZhbHVlLiBEb2VzCiAgICAgKiBub3QgdGFrZSBpbnRvIGFjY291\nbnQgdGhlIG5hbWVkIGhhbmRsZXIsIGlmIGFueS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFZhbHVlSGFuZGxlciBkZWZhdWx0SGFuZGxlcihWYWx1ZU1hcHBp\nbmcgdmFsLCBib29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgaWYgKHZhbC5p\nc1NlcmlhbGl6ZWQoKSkgewogICAgICAgICAgICBpZiAoX2RpY3QubWF4RW1i\nZWRkZWRCbG9iU2l6ZSAhPSAtMSkKICAgICAgICAgICAgICAgIHdhcm5NYXhF\nbWJlZGRlZCh2YWwsIF9kaWN0Lm1heEVtYmVkZGVkQmxvYlNpemUpOwogICAg\nICAgICAgICByZXR1cm4gQmxvYlZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgp\nOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IGhhbmRsZXIgPSBtYXBwZWRT\ndHJhdGVneSh2YWwsIHZhbC5nZXRUeXBlKCksIGFkYXB0aW5nKTsKICAgICAg\nICBpZiAoaGFuZGxlciBpbnN0YW5jZW9mIFZhbHVlSGFuZGxlcikKICAgICAg\nICAgICAgcmV0dXJuIChWYWx1ZUhhbmRsZXIpIGhhbmRsZXI7CgogICAgICAg\nIGlmICh2YWwuZ2V0VHlwZSgpID09IGJ5dGVbXS5jbGFzcyAKICAgICAgICAg\nICAgfHwgdmFsLmdldFR5cGUoKSA9PSBCeXRlW10uY2xhc3MpIHsKICAgICAg\nICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQmxvYlNpemUgIT0gLTEpCiAg\nICAgICAgICAgICAgICB3YXJuTWF4RW1iZWRkZWQodmFsLCBfZGljdC5tYXhF\nbWJlZGRlZEJsb2JTaXplKTsKICAgICAgICAgICAgcmV0dXJuIEJ5dGVBcnJh\neVZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgpOwogICAgICAgIH0KICAgICAg\nICBpZiAodmFsLmdldFR5cGUoKSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAg\nICAgfHwgdmFsLmdldFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykgewog\nICAgICAgICAgICBpZiAoaXNDbG9iKHZhbCwgdHJ1ZSkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gQ2hhckFycmF5U3RyZWFtVmFsdWVIYW5kbGVyLmdldElu\nc3RhbmNlKCk7CiAgICAgICAgICAgIHJldHVybiBDaGFyQXJyYXlWYWx1ZUhh\nbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICB9CgogICAgICAgIHN3aXRj\naCAodmFsLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5U\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQk9PTEVBTl9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEVfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09C\nSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRF\nR0VSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNBTEVOREFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NB\nTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gSW1tdXRhYmxlVmFsdWVIYW5k\nbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNUUklORzoKICAgICAgICAgICAgICAgIGlmIChpc0Nsb2IodmFsLCB0cnVl\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ2xvYlZhbHVlSGFuZGxl\nci5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIEltbXV0\nYWJsZVZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGlmICghdmFsLmdl\ndFR5cGVNYXBwaW5nKCkuaXNNYXBwZWQoKQogICAgICAgICAgICAgICAgICAg\nICYmIHVzZVVudHlwZWRQQ0hhbmRsZXIodmFsKSkgCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIFVudHlwZWRQQ1ZhbHVlSGFuZGxlci5nZXRJbnN0YW5j\nZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nVW50eXBlZFBDVmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgT2JqZWN0SWRWYWx1ZUhhbmRsZXIoKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKCFnZXRDb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0aWJpbGl0eUlu\nc3RhbmNlKCkKICAgICAgICAgICAgLmdldFN0b3JlTWFwQ29sbGVjdGlvbklu\nRW50aXR5QXNCbG9iKCkKICAgICAgICAgICAgJiYgdmFsLmlzRW1iZWRkZWRQ\nQygpKQogICAgICAgICAgICByZXR1cm4gbmV3IEVsZW1lbnRFbWJlZFZhbHVl\nSGFuZGxlcigpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgd2Ugc2hvdWxkIHVzZSB0aGUgZ2Vu\nZXJpYyB1bnR5cGVkIFBDIGhhbmRsZXIgZm9yIHRoZQogICAgICogZ2l2ZW4g\ndW5tYXBwZWQgcmVsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiB1c2VVbnR5cGVkUENIYW5kbGVyKFZhbHVlTWFwcGluZyB2YWwpIHsKICAg\nICAgICBDbGFzc01hcHBpbmcgcmVsID0gdmFsLmdldFR5cGVNYXBwaW5nKCk7\nCiAgICAgICAgcmV0dXJuIHJlbC5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFz\nc01hcHBpbmcuSURfVU5LTk9XTgogICAgICAgICAgICB8fCAocmVsLmdldElk\nZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5JRF9BUFBMSUNBVElPTgog\nICAgICAgICAgICAmJiAocmVsLmdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5n\ndGggPT0gMAogICAgICAgICAgICB8fCAoIXJlbC5pc09wZW5KUEFJZGVudGl0\neSgpICYmIE1vZGlmaWVyLmlzQWJzdHJhY3QKICAgICAgICAgICAgKHJlbC5n\nZXRPYmplY3RJZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkpKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDaGVja3MgZm9yIGhpbnRzIGFzIHRvIHdoZXRoZXIg\ndGhlIGdpdmVuIGNvbHVtbiBpcyBhIENMT0IuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBpc0Nsb2IoVmFsdWVNYXBwaW5nIHZhbCwgYm9vbGVhbiB3\nYXJuKSB7CiAgICAgICAgTGlzdCBjb2xzID0gdmFsLmdldFZhbHVlSW5mbygp\nLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scy5zaXplKCkgIT0gMSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBDb2x1bW4gY29s\nID0gKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAgICAgaWYgKGNvbC5nZXRT\naXplKCkgIT0gLTEgJiYgY29sLmdldFR5cGUoKSAhPSBUeXBlcy5DTE9CKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmIChfZGljdC5n\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkNMT0IpICE9IFR5cGVzLkNMT0IpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKHdhcm4gJiYg\nX2RpY3QubWF4RW1iZWRkZWRDbG9iU2l6ZSAhPSAtMSkKICAgICAgICAgICAg\nd2Fybk1heEVtYmVkZGVkKHZhbCwgX2RpY3QubWF4RW1iZWRkZWRDbG9iU2l6\nZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXYXJuIHRoYXQgdGhlIGdpdmVuIHZhbHVlIGlzIGJlaW5nIG1hcHBlZCB0\nbyBhIGhhbmRsZXIgdGhhdCB3aWxsIG5vdAogICAgICogYmUgYWJsZSB0byBz\ndG9yZSBsYXJnZSBsb2JzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2Fy\nbk1heEVtYmVkZGVkKFZhbHVlTWFwcGluZyB2YWwsIGludCBzaXplKSB7CiAg\nICAgICAgaWYgKGdldExvZygpLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAg\nICAgZ2V0TG9nKCkud2FybihfbG9jLmdldCgibWF4LWVtYmVkLWxvYiIsIHZh\nbCwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKHNpemUpKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1bHQgc3Ry\nYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gZGlzY3JpbWluYXRvci4KICAg\nICAqIERvZXMgbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBjdXJyZW50IHN0\ncmF0ZWd5LCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBEaXNjcmlt\naW5hdG9yU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KERpc2NyaW1pbmF0b3Ig\nZGlzY3JpbSkgewogICAgICAgIHJldHVybiBkZWZhdWx0U3RyYXRlZ3koZGlz\nY3JpbSwgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0\ncmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIGRpc2NyaW1pbmF0b3IuCiAg\nICAgKiBEb2VzIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgY3VycmVudCBz\ndHJhdGVneSwgaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQgRGlzY3Jp\nbWluYXRvclN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShEaXNjcmltaW5hdG9y\nIGRpc2NyaW0sCiAgICAgICAgYm9vbGVhbiBhZGFwdGluZykgewogICAgICAg\nIENsYXNzTWFwcGluZyBjbHMgPSBkaXNjcmltLmdldENsYXNzTWFwcGluZygp\nOwogICAgICAgIGlmIChjbHMuZ2V0RW1iZWRkaW5nTWV0YURhdGEoKSAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gTm9uZURpc2NyaW1pbmF0b3JTdHJh\ndGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlmIChjbHMuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgPT0gbnVsbAogICAgICAgICAgICAm\nJiAoY2xzLmdldFN0cmF0ZWd5KCkgPT0gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0\nSW5zdGFuY2UoKQogICAgICAgICAgICB8fCBNb2RpZmllci5pc0ZpbmFsKGRp\nc2NyaW0uZ2V0Q2xhc3NNYXBwaW5nKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLgog\nICAgICAgICAgICBnZXRNb2RpZmllcnMoKSkpKQogICAgICAgICAgICByZXR1\ncm4gTm9uZURpc2NyaW1pbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoK\nICAgICAgICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVsdHMuZ2V0U3RyYXRlZ3ko\nZGlzY3JpbSwgYWRhcHRpbmcpOwogICAgICAgIGlmIChzdHJhdCBpbnN0YW5j\nZW9mIFN0cmluZykKICAgICAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlRGlz\nY3JpbWluYXRvclN0cmF0ZWd5KChTdHJpbmcpIHN0cmF0LCBkaXNjcmltKTsK\nICAgICAgICBpZiAoc3RyYXQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIChEaXNjcmltaW5hdG9yU3RyYXRlZ3kpIHN0cmF0OwoKICAgICAgICBpZiAo\nY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBuZXcgU3VwZXJjbGFzc0Rpc2NyaW1pbmF0\nb3JTdHJhdGVneSgpOwogICAgICAgIGlmIChkaXNjcmltLmdldE1hcHBpbmdJ\nbmZvKCkuZ2V0VmFsdWUoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbmV3IFZhbHVlTWFwRGlzY3JpbWluYXRvclN0cmF0ZWd5KCk7CiAgICAgICAg\naWYgKGNscy5nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIE5vbmVEaXNjcmltaW5hdG9yU3RyYXRl\nZ3kuZ2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAoYWRhcHRpbmcgfHwgX2Rl\nZmF1bHRzLmRlZmF1bHRNaXNzaW5nSW5mbygpKQogICAgICAgICAgICByZXR1\ncm4gbmV3IENsYXNzTmFtZURpc2NyaW1pbmF0b3JTdHJhdGVneSgpOwogICAg\nICAgIERCRGljdGlvbmFyeSBkaWN0ID0gKChKREJDQ29uZmlndXJhdGlvbikg\nZ2V0Q29uZmlndXJhdGlvbigpKS4KICAgICAgICAgICAgZ2V0REJEaWN0aW9u\nYXJ5SW5zdGFuY2UoKTsKICAgICAgICBpZiAoZGljdC5qb2luU3ludGF4ID09\nIEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwpCiAgICAgICAgICAg\nIHJldHVybiBOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5LmdldEluc3RhbmNl\nKCk7CiAgICAgICAgcmV0dXJuIG5ldyBTdWJjbGFzc0pvaW5EaXNjcmltaW5h\ndG9yU3RyYXRlZ3koKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWlu\nZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiB2\nZXJzaW9uLgogICAgICogRG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhl\nIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFZlcnNpb25TdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koVmVyc2lvbiB2\nZXJzaW9uKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRTdHJhdGVneSh2ZXJz\naW9uLCBnZXRTdHJhdGVneUluc3RhbGxlcigpLmlzQWRhcHRpbmcoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1bHQgc3Ry\nYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmVyc2lvbi4KICAgICAqIERv\nZXMgbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBjdXJyZW50IHN0cmF0ZWd5\nLCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRl\nZ3kgZGVmYXVsdFN0cmF0ZWd5KFZlcnNpb24gdmVyc2lvbiwKICAgICAgICBi\nb29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9\nIHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKGNscy5n\nZXRFbWJlZGRpbmdNZXRhRGF0YSgpICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBOb25lVmVyc2lvblN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAgICAg\nICAgaWYgKGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSA9\nPSBudWxsCiAgICAgICAgICAgICYmIGNscy5nZXRTdHJhdGVneSgpID09IE5v\nbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCkpCiAgICAgICAgICAgIHJl\ndHVybiBOb25lVmVyc2lvblN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAg\nICAgIE9iamVjdCBzdHJhdCA9IF9kZWZhdWx0cy5nZXRTdHJhdGVneSh2ZXJz\naW9uLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKHN0cmF0IGluc3RhbmNlb2Yg\nU3RyaW5nKQogICAgICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVWZXJzaW9u\nU3RyYXRlZ3koKFN0cmluZykgc3RyYXQsIHZlcnNpb24pOwogICAgICAgIGlm\nIChzdHJhdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKFZlcnNpb25T\ndHJhdGVneSkgc3RyYXQ7CgogICAgICAgIGlmIChjbHMuZ2V0Sm9pbmFibGVQ\nQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTdXBlcmNsYXNzVmVyc2lvblN0cmF0ZWd5KCk7CgogICAgICAg\nIEZpZWxkTWFwcGluZyB2ZmllbGQgPSB2ZXJzaW9uLmdldENsYXNzTWFwcGlu\nZygpLgogICAgICAgICAgICBnZXRWZXJzaW9uRmllbGRNYXBwaW5nKCk7CiAg\nICAgICAgaWYgKHZmaWVsZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZGVmYXVsdFN0cmF0ZWd5KHZlcnNpb24sIHZmaWVsZCk7CiAgICAgICAgaWYg\nKGFkYXB0aW5nIHx8IF9kZWZhdWx0cy5kZWZhdWx0TWlzc2luZ0luZm8oKSkK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBOdW1iZXJWZXJzaW9uU3RyYXRlZ3ko\nKTsKICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJhdGVneS5nZXRJbnN0\nYW5jZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWZh\ndWx0IHZlcnNpb24gc3RyYXRlZ3ksIGdpdmVuIGEgdmVyc2lvbiBmaWVsZC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25TdHJhdGVneSBkZWZhdWx0\nU3RyYXRlZ3koVmVyc2lvbiB2ZXJzLAogICAgICAgIEZpZWxkTWFwcGluZyB2\nZmllbGQpIHsKICAgICAgICBzd2l0Y2ggKHZmaWVsZC5nZXRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAgICAg\ncmV0dXJuIChKYXZhVmVyc2lvbnMuVkVSU0lPTiA+PSA1KSAKICAgICAgICAg\nICAgICAgICAgICA/IG5ldyBOYW5vUHJlY2lzaW9uVGltZXN0YW1wVmVyc2lv\nblN0cmF0ZWd5KCkKICAgICAgICAgICAgICAgICAgICA6IG5ldyBUaW1lc3Rh\nbXBWZXJzaW9uU3RyYXRlZ3koKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgTnVtYmVyVmVyc2lvblN0cmF0ZWd5KCk7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJhdGVn\neS5nZXRJbnN0YW5jZSgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVi\nbGljIHZvaWQgZW5kQ29uZmlndXJhdGlvbigpCiAgICB7CiAgICAgICAgc3Vw\nZXIuZW5kQ29uZmlndXJhdGlvbigpOwoKICAgICAgICBKREJDQ29uZmlndXJh\ndGlvbiBjb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBnZXRDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgX2RpY3QgPSBjb25mLmdldERCRGljdGlvbmFyeUlu\nc3RhbmNlKCk7CiAgICAgICAgaWYgKF9kZWZhdWx0cyA9PSBudWxsKQogICAg\nICAgICAgICBfZGVmYXVsdHMgPSBjb25mLmdldE1hcHBpbmdEZWZhdWx0c0lu\nc3RhbmNlKCk7CiAgICAgICAgaWYgKF9zY2hlbWEgIT0gbnVsbCAmJiBfc2No\nZW1hIGluc3RhbmNlb2YgQ29uZmlndXJhYmxlKSB7CiAgICAgICAgICAgICgo\nQ29uZmlndXJhYmxlKSBfc2NoZW1hKS5zZXRDb25maWd1cmF0aW9uKGNvbmYp\nOwogICAgICAgICAgICAoKENvbmZpZ3VyYWJsZSkgX3NjaGVtYSkuc3RhcnRD\nb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgICgoQ29uZmlndXJhYmxlKSBf\nc2NoZW1hKS5lbmRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgfSAgICAgICAg\nICAgIAogICAgfQogICAgCiAgICAvKioKICAgICAqIEZpbmRzIHRoZSBiYXNl\nIGNsYXNzIG1hcHBpbmcgZm9yIHRoZSBzcGVjaWZpZWQgbWFwcGluZy4gIExv\nYWRzIGFsbAogICAgICogcGVyc2lzdGVudCB0eXBlcyBpZiBuZWNlc3Nhcnks\nIHNpbmNlIGFsbCBwZXJzaXN0ZW50IHN1YmNsYXNzZXMgb2YgdGhpcwogICAg\nICogbWFwcGluZyBtYXkgbm90IGhhdmUgYmVlbiByZXNvbHZlZCBiZWZvcmUg\ndGhpcyBtZXRob2QgaXMgY2FsbGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nQ2xhc3NNYXBwaW5nIGZpbmRCYXNlQ2xhc3NNYXBwaW5nKENsYXNzTWFwcGlu\nZyBtYXBwaW5nKSB7ICAgICAgICAKICAgICAgICBDbGFzc01hcHBpbmcgYmFz\nZU1hcHBpbmcgPSBudWxsOwogICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBt\nYXBwaW5nLmdldFBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAo\nc3VwID09IG51bGwpIHsKICAgICAgICAgICAgLy8gbm8gc3VwZXJjbGFzcyBt\nZXRhZGF0YSB3YXMgcHJvdmlkZWQuICBjaGVjayB0byBzZWUgaWYgdGhpcyBj\nbGFzcwogICAgICAgICAgICAvLyBoYXMgYW55IHBlcnNpc3RlbnQgc3ViY2xh\nc3Nlcy4KICAgICAgICAgICAgaWYgKG1hcHBpbmcuZ2V0UENTdWJjbGFzc2Vz\nKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIGJhc2VNYXBwaW5nID0g\nbWFwcGluZzsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAv\nLyBwZXJzaXN0ZW50IHN1YmNsYXNzZXMgbWF5IG5vdCBoYXZlIGJlZW4gcmVz\nb2x2ZWQgeWV0LiAgCiAgICAgICAgICAgICAgICAvLyBydW4gdGhyb3VnaCB0\naGUgcGVyc2lzdGVudCB0eXBlcyB0byBzZWUgaWYgYW55IG9mIHRoZW0gCiAg\nICAgICAgICAgICAgICAvLyBvciB0aGVpciBzdXBlcmNsYXNzIGlzIGEgc3Vi\nY2xhc3Mgb2YgdGhpcyBjbGFzcy4KICAgICAgICAgICAgICAgIENvbGxlY3Rp\nb24gY2xhc3NlcyA9IGxvYWRQZXJzaXN0ZW50VHlwZXMoZmFsc2UsIAogICAg\nICAgICAgICAgICAgICAgICAgICBtYXBwaW5nLmdldEVudkNsYXNzTG9hZGVy\nKCkpOwogICAgICAgICAgICAgICAgQ2xhc3MgY2xzOwogICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBjbGFzc2VzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgY2xzID0gKENs\nYXNzKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIENsYXNzIHN1\ncGNsID0gY2xzLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgICAgICAg\nICB3aGlsZSAoc3VwY2wgIT0gbnVsbCAmJiAKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIXN1cGNsLmdldENsYXNzKCkuZXF1YWxzKGphdmEubGFuZy5P\nYmplY3QuY2xhc3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgh\nc3VwY2wuaXNJbnRlcmZhY2UoKSAmJgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc3VwY2wuZXF1YWxzKG1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgp\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZU1hcHBpbmcg\nPSBtYXBwaW5nOyAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIHN1cGNsID0gc3VwY2wuZ2V0U3VwZXJjbGFzcygpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoYmFz\nZU1hcHBpbmcgIT0gbnVsbCkgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCFzdXAuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLmlzSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgLy8gaWYg\ndGhlIHN1cGVyY2xhc3MgaXMgbm90IGEgbWFuYWdlZCBpbnRlcmZhY2UsIGZp\nbmQgdGhlIHJvb3QKICAgICAgICAgICAgLy8gc3VwZXJjbGFzcyBhbmQgZ2V0\nIGl0cyBtYXBwaW5nIGluZm8KICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHN1\ncGNtID0gc3VwOwogICAgICAgICAgICB3aGlsZSAoc3VwY20gIT0gbnVsbCAm\nJiAKICAgICAgICAgICAgICAgICAgICAhc3VwY20uZ2V0RGVzY3JpYmVkVHlw\nZSgpLmlzSW50ZXJmYWNlKCkgJiYKICAgICAgICAgICAgICAgICAgICAhc3Vw\nY20uaXNFbWJlZGRlZE9ubHkoKSkgewogICAgICAgICAgICAgICAgQ2xhc3NN\nYXBwaW5nIHN1cGNtMiA9IHN1cGNtLmdldFBDU3VwZXJjbGFzc01hcHBpbmco\nKTsKICAgICAgICAgICAgICAgIGlmIChzdXBjbTIgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBiYXNlTWFwcGluZyA9IHN1cGNtOwogICAgICAgICAg\nICAgICAgc3VwY20gPSBzdXBjbTI7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGJhc2VNYXBwaW5nOwogICAgfQogICAKICAgIC8q\nKgogICAgICogSWYgYW4gaW5oZXJpdGFuY2Ugc3RyYXRlZ3kgaGFzIG5vdCBi\nZWVuIHNldCBvbiB0aGlzIG1hcHBpbmcsIHNldCBpdAogICAgICogdG8gdGhl\nIGRlZmF1bHQgKGZsYXQpLiAgVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxl\nZCBiZWZvcmUgc3RyYXRlZ2llcwogICAgICogYXJlIGNyZWF0ZWQgZm9yIHRo\nZSBzcGVjaWZpZWQgbWFwcGluZy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgc2V0RGVmYXVsdEluaGVyaXRhbmNlU3RyYXRlZ3koQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcpIHsKICAgICAgICBDbGFzc01hcHBpbmdJbmZvIGluZm8gPSBt\nYXBwaW5nLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgaWYgKGluZm8gIT0g\nbnVsbCAmJiBpbmZvLmdldEhpZXJhcmNoeVN0cmF0ZWd5KCkgPT0gbnVsbCkK\nICAgICAgICAgICAgaW5mby5zZXRIaWVyYXJjaHlTdHJhdGVneShGbGF0Q2xh\nc3NTdHJhdGVneS5BTElBUyk7ICAgICAgICAKICAgIH0gCiAgICAKICAgIC8q\nKgogICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGFuIGluaGVydGFuY2Ugc3Ry\nYXRlZ3kgaGFzIGJlZW4gc2V0IG9uIHRoZQogICAgICogc3BlY2lmaWVkIG1h\ncHBpbmcuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhc0luaGVy\naXRhbmNlU3RyYXRlZ3koQ2xhc3NNYXBwaW5nIG1hcHBpbmcpIHsKICAgICAg\nICBDbGFzc01hcHBpbmdJbmZvIGluZm8gPSBtYXBwaW5nLmdldE1hcHBpbmdJ\nbmZvKCk7CiAgICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBpbmZvLmdldEhp\nZXJhcmNoeVN0cmF0ZWd5KCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAgICAgCiAgICB9Cn0K\n","encoding":"base64"}

