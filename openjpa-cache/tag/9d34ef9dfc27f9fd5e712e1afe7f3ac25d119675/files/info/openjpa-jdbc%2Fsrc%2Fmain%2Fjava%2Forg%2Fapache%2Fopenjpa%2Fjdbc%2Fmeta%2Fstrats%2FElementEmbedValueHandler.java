{"sha":"0559d61e68a53bf8b9035b949ec244ae7d28c8ee","node_id":"MDQ6QmxvYjIwNjM2NDowNTU5ZDYxZTY4YTUzYmY4YjkwMzViOTQ5ZWMyNDRhZTdkMjhjOGVl","size":6192,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0559d61e68a53bf8b9035b949ec244ae7d28c8ee","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1w\nb3J0IGphdmEuc3FsLio7CmltcG9ydCBqYXZhLnV0aWwuKjsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuKjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuKjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS4qOwoKLyoq\nCiAqIDxwPkhhbmRsZXIgZm9yIGVtYmVkZGVkIG9iamVjdHMgYXMgZWxlbWVu\ndHMgb2YgYSBjb2xsZWN0aW9uIG9yIG1hcC4gIEZvcgogKiBlbWJlZGRlZCBv\nYmplY3RzIGFzIGZpZWxkcywgdXNlIHRoZSBtb3JlIHBvd2VyZnVsCiAqIHtA\nbGluayBFbWJlZEZpZWxkU3RyYXRlZ3l9LjwvcD4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wLCAxLjEuMAogKiBAbm9qYXZhZG9j\nCiAqLwpwdWJsaWMgY2xhc3MgRWxlbWVudEVtYmVkVmFsdWVIYW5kbGVyCiAg\nICBleHRlbmRzIEVtYmVkVmFsdWVIYW5kbGVyCiAgICBpbXBsZW1lbnRzIFJl\nbGF0aW9uSWQgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoRWxlbWVu\ndEVtYmVkVmFsdWVIYW5kbGVyLmNsYXNzKTsKCiAgICBwcml2YXRlIFZhbHVl\nTWFwcGluZyBfdm0gPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5bXSBfY29s\ncyA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdFtdIF9hcmdzID0gbnVsbDsK\nICAgIHByaXZhdGUgaW50IF9udWxsSWR4ID0gLTE7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX3N5bnRoZXRpYyA9IGZhbHNlOwoKICAgIHB1YmxpYyBDb2x1bW5b\nXSBtYXAoVmFsdWVNYXBwaW5nIHZtLCBTdHJpbmcgbmFtZSwgQ29sdW1uSU8g\naW8sCiAgICAgICAgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIExpbmtlZExp\nc3QgY29scyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgTGlua2VkTGlz\ndCBhcmdzID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBzdXBlci5tYXAo\ndm0sIG5hbWUsIGlvLCBhZGFwdCwgY29scywgYXJncyk7CgogICAgICAgIFZh\nbHVlTWFwcGluZ0luZm8gdmluZm8gPSB2bS5nZXRWYWx1ZUluZm8oKTsKICAg\nICAgICBDb2x1bW4gbnVsbEluZCA9IHZpbmZvLmdldE51bGxJbmRpY2F0b3JD\nb2x1bW4odm0sIG5hbWUsCiAgICAgICAgICAgIHZtLmdldEZpZWxkTWFwcGlu\nZygpLmdldFRhYmxlKCksIGFkYXB0KTsKICAgICAgICBpZiAobnVsbEluZCAh\nPSBudWxsKQogICAgICAgICAgICB2bS5zZXRDb2x1bW5zKG5ldyBDb2x1bW5b\nXXsgbnVsbEluZCB9KTsKCiAgICAgICAgLy8gcmVjb3JkIGluZGV4IG9mIG51\nbGwgaW5kaWNhdG9yIGNvbHVtbiBhbmQgd2hldGhlciBpdCBpcyBzeW50aGV0\naWMKICAgICAgICBpZiAobnVsbEluZCAhPSBudWxsKSB7CiAgICAgICAgICAg\nIF9udWxsSWR4ID0gY29scy5pbmRleE9mKG51bGxJbmQpOwogICAgICAgICAg\nICBpZiAoX251bGxJZHggPT0gLTEpIHsKICAgICAgICAgICAgICAgIGNvbHMu\nYWRkRmlyc3QobnVsbEluZCk7CiAgICAgICAgICAgICAgICBhcmdzLmFkZEZp\ncnN0KG51bGwpOwogICAgICAgICAgICAgICAgX251bGxJZHggPSAwOwogICAg\nICAgICAgICAgICAgX3N5bnRoZXRpYyA9IHRydWU7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIF92bSA9IHZtOwogICAgICAgIF9jb2xzID0g\nKENvbHVtbltdKSBjb2xzLnRvQXJyYXkobmV3IENvbHVtbltjb2xzLnNpemUo\nKV0pOwogICAgICAgIF9hcmdzID0gYXJncy50b0FycmF5KCk7CiAgICAgICAg\ncmV0dXJuIF9jb2xzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9iamVj\ndFZhbHVlUmVxdWlyZXNMb2FkKFZhbHVlTWFwcGluZyB2bSkgewogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0UmVz\ndWx0QXJndW1lbnQoVmFsdWVNYXBwaW5nIHZtKSB7CiAgICAgICAgcmV0dXJu\nIF9hcmdzOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9EYXRhU3RvcmVW\nYWx1ZShWYWx1ZU1hcHBpbmcgdm0sIE9iamVjdCB2YWwsCiAgICAgICAgSkRC\nQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBl\nbSA9IHN0b3JlLmdldENvbnRleHQoKS5nZXRTdGF0ZU1hbmFnZXIodmFsKTsK\nICAgICAgICBPYmplY3QgcnZhbCA9IG51bGw7CiAgICAgICAgaWYgKF9jb2xz\nLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIHJ2YWwgPSBuZXcgT2JqZWN0W19j\nb2xzLmxlbmd0aF07CgogICAgICAgIC8vIHNldCBudWxsIGluZGljYXRvciBj\nb2x1bW4KICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICBpZiAoX3N5bnRo\nZXRpYykgewogICAgICAgICAgICBPYmplY3QgY3ZhbCA9ICgoRW1iZWRkZWRD\nbGFzc1N0cmF0ZWd5KSB2bS5nZXRFbWJlZGRlZE1hcHBpbmcoKS4KICAgICAg\nICAgICAgICAgIGdldFN0cmF0ZWd5KCkpLmdldE51bGxJbmRpY2F0b3JWYWx1\nZShlbSk7CiAgICAgICAgICAgIGlmIChfY29scy5sZW5ndGggPT0gMSkKICAg\nICAgICAgICAgICAgIHJldHVybiBjdmFsOwogICAgICAgICAgICAoKE9iamVj\ndFtdKSBydmFsKVtpZHgrK10gPSBjdmFsOwogICAgICAgIH0KCiAgICAgICAg\ncmV0dXJuIHN1cGVyLnRvRGF0YVN0b3JlVmFsdWUoZW0sIHZtLCBzdG9yZSwg\nX2NvbHMsIHJ2YWwsIGlkeCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB0\nb09iamVjdFZhbHVlKFZhbHVlTWFwcGluZyB2bSwgT2JqZWN0IHZhbCwKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoImNhbnQtcHJvamVjdC1vd25lZCIsCiAgICAgICAgICAgICAgICB2bSkp\nOwoKICAgICAgICAvLyBjaGVjayBudWxsIGluZGljYXRvciBmaXJzdAogICAg\nICAgIGlmIChfbnVsbElkeCAhPSAtMSkgewogICAgICAgICAgICBPYmplY3Qg\nbnZhbDsKICAgICAgICAgICAgaWYgKF9jb2xzLmxlbmd0aCA9PSAxKQogICAg\nICAgICAgICAgICAgbnZhbCA9IHZhbDsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgbnZhbCA9ICgoT2JqZWN0W10pIHZhbClbX251bGxJZHhd\nOwogICAgICAgICAgICBpZiAoKChFbWJlZGRlZENsYXNzU3RyYXRlZ3kpIHZt\nLmdldEVtYmVkZGVkTWFwcGluZygpLgogICAgICAgICAgICAgICAgZ2V0U3Ry\nYXRlZ3koKSkuaW5kaWNhdGVzTnVsbChudmFsKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIGVt\nYmVkZGVkIGluc3RhbmNlCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBl\nbSA9IHN0b3JlLmdldENvbnRleHQoKS5lbWJlZChudWxsLCBudWxsLCBzbSwg\ndm0pOwogICAgICAgIGludCBpZHggPSAoX3N5bnRoZXRpYykgPyAxIDogMDsK\nICAgICAgICBzdXBlci50b09iamVjdFZhbHVlKGVtLCB2bSwgdmFsLCBzdG9y\nZSwgZmV0Y2gsIF9jb2xzLCBpZHgpOwoKICAgICAgICAvLyBhZnRlciBsb2Fk\naW5nIGV2ZXJ5dGhpbmcgZnJvbSByZXN1bHQsIGxvYWQgdGhlIHJlc3Qgb2Yg\ndGhlCiAgICAgICAgLy8gY29uZmlndXJlZCBmaWVsZHMKICAgICAgICBlbS5s\nb2FkKGZldGNoKTsKICAgICAgICByZXR1cm4gZW0uZ2V0TWFuYWdlZEluc3Rh\nbmNlKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIFJlbGF0aW9uSWQgaW1wbGVtZW50YXRpb24KICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCB0\nb1JlbGF0aW9uRGF0YVN0b3JlVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiB0b1JlbGF0aW9uRGF0\nYVN0b3JlVmFsdWUoc20sIGNvbCwgMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWN1cnNpdmUgaGVscGVyLgogICAgICovCiAgICBwcml2YXRlIE9iamVj\ndCB0b1JlbGF0aW9uRGF0YVN0b3JlVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgQ29sdW1uIGNvbCwKICAgICAgICBpbnQgaWR4KSB7CiAgICAgICAg\nRmllbGRNYXBwaW5nIGZpZWxkID0gZmluZEZpZWxkKGNvbCwgaWR4KTsKICAg\nICAgICBpZiAoZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCk7CgogICAgICAgIGlmIChmaWVsZC5nZXRI\nYW5kbGVyKCkgaW5zdGFuY2VvZiBSZWxhdGlvbklkKQogICAgICAgICAgICBy\nZXR1cm4gKChSZWxhdGlvbklkKSBmaWVsZC5nZXRTdHJhdGVneSgpKS4KICAg\nICAgICAgICAgICAgIHRvUmVsYXRpb25EYXRhU3RvcmVWYWx1ZShzbSwgY29s\nKTsKICAgICAgICBpZiAoZmllbGQuZ2V0U3RyYXRlZ3koKSBpbnN0YW5jZW9m\nIFJlbGF0aW9uSWQpCiAgICAgICAgICAgIHJldHVybiAoKFJlbGF0aW9uSWQp\nIGZpZWxkLmdldFN0cmF0ZWd5KCkpLgogICAgICAgICAgICAgICAgdG9SZWxh\ndGlvbkRhdGFTdG9yZVZhbHVlKHNtLCBjb2wpOwogICAgICAgIHJldHVybiB0\nb1JlbGF0aW9uRGF0YVN0b3JlVmFsdWUoc20sIGNvbCwgZmllbGQuZ2V0SW5k\nZXgoKSArIDEpOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUgZmly\nc3QgZmllbGQgbWFwcGluZyB0aGF0IHVzZXMgdGhlIGdpdmVuIGNvbHVtbiBz\ndGFydGluZyB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gZmllbGQgaW5kZXguCiAg\nICAgKi8KICAgIHByaXZhdGUgRmllbGRNYXBwaW5nIGZpbmRGaWVsZChDb2x1\nbW4gY29sLCBpbnQgaWR4KSB7CiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1z\nID0gX3ZtLmdldEVtYmVkZGVkTWFwcGluZygpLmdldEZpZWxkTWFwcGluZ3Mo\nKTsKICAgICAgICBDb2x1bW5bXSBjb2xzOwogICAgICAgIGZvciAoaW50IGkg\nPSBpZHg7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKGZtc1tpXS5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNYXBwaW5nLk1BTkFH\nRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIGNvbHMgPSAoKEVtYmVkZGFibGUpIGZtc1tpXSkuZ2V0Q29sdW1u\ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGNvbHMubGVu\nZ3RoOyBqKyspCiAgICAgICAgICAgICAgICBpZiAoY29sc1tqXSA9PSBjb2wp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZtc1tpXTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG51bGw7Cgl9Cn0K\n","encoding":"base64"}

