{"sha":"3731c0620982c87c17cdbdcae618c174cdbf2ace","node_id":"MDQ6QmxvYjIwNjM2NDozNzMxYzA2MjA5ODJjODdjMTdjZGJkY2FlNjE4YzE3NGNkYmYyYWNl","size":12403,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3731c0620982c87c17cdbdcae618c174cdbf2ace","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1w\nb3J0IGphdmEuc3FsLio7CmltcG9ydCBqYXZhLnV0aWwuKjsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC4qOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS4qOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLio7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC4qOwoKLyoqCiAqIDxwPk1hcHBpbmcgZm9y\nIGEgbWFwIHdob3NlIGtleXMgYXJlIGNvbnRyb2xsZWQgYnkgYSB7QGxpbmsg\nVmFsdWVIYW5kbGVyfQogKiBhbmQgd2hvc2UgdmFsdWVzIGFyZSByZWxhdGlv\nbnMgdG8gb3RoZXIgcGVyc2lzdGVudCBvYmplY3RzLjwvcD4KICoKICogQGF1\ndGhvciBBYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wLCAxLjEuMAogKi8KcHVi\nbGljIGNsYXNzIEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmllbGRTdHJhdGVn\neQogICAgZXh0ZW5kcyBNYXBUYWJsZUZpZWxkU3RyYXRlZ3kgewoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UKICAgICAgICAoSGFuZGxlclJlbGF0aW9uTWFwVGFibGVG\naWVsZFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwcml2YXRlIENvbHVtbltdIF9r\nY29scyA9IG51bGw7CiAgICBwcml2YXRlIENvbHVtbklPIF9raW8gPSBudWxs\nOwogICAgcHJpdmF0ZSBib29sZWFuIF9rbG9hZCA9IGZhbHNlOwoKICAgIHB1\nYmxpYyBDb2x1bW5bXSBnZXRLZXlDb2x1bW5zKENsYXNzTWFwcGluZyBjbHMp\nIHsKICAgICAgICByZXR1cm4gX2tjb2xzOwogICAgfQoKICAgIHB1YmxpYyBD\nb2x1bW5bXSBnZXRWYWx1ZUNvbHVtbnMoQ2xhc3NNYXBwaW5nIGNscykgewog\nICAgICAgIHJldHVybiBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldENv\nbHVtbnMoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RLZXkoU2Vs\nZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGtleSwgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsLnNl\nbGVjdChfa2NvbHMsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZWxlY3RWYWx1ZShTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgdmFsLAogICAg\nICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgCiAgICAgICAgSm9pbnMg\nam9pbnMpIHsKICAgICAgICBzZWwuc2VsZWN0KHZhbCwgZmllbGQuZ2V0RWxl\nbWVudE1hcHBpbmcoKS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksCiAgICAgICAg\nICAgIHN0b3JlLCBmZXRjaCwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdF\nUl9OT05FLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIFJlc3VsdFtdIGdl\ndFJlc3VsdHMoZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAg\nICBmaW5hbCBKREJDU3RvcmUgc3RvcmUsIGZpbmFsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgZmluYWwgaW50IGVhZ2VyTW9kZSwg\nZmluYWwgSm9pbnNbXSByZXNKb2lucywgYm9vbGVhbiBscnMpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVs\nZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGZpbmFs\nIENsYXNzTWFwcGluZ1tdIHZhbHMgPSBlbGVtLmdldEluZGVwZW5kZW50VHlw\nZU1hcHBpbmdzKCk7CiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRT\nUUxGYWN0b3J5KCkubmV3VW5pb24odmFscy5sZW5ndGgpOwogICAgICAgIGlm\nIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShlbGVtLmdldFR5cGVNYXBw\naW5nKCkpCiAgICAgICAgICAgICE9IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24u\nRUFHRVJfSk9JTikKICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlvbigpOwog\nICAgICAgIHVuaW9uLnNldExSUyhscnMpOwogICAgICAgIHVuaW9uLnNlbGVj\ndChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAg\nICAgICBzZWwuc2VsZWN0KF9rY29scyk7CiAgICAgICAgICAgICAgICBzZWwu\nd2hlcmVGb3JlaWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCksCiAg\nICAgICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgZmllbGQuZ2V0\nRGVmaW5pbmdNYXBwaW5nKCksIHN0b3JlKTsKCiAgICAgICAgICAgICAgICBK\nb2lucyBqb2lucyA9IGpvaW5WYWx1ZVJlbGF0aW9uKHNlbC5uZXdKb2lucygp\nLCB2YWxzW2lkeF0pOwogICAgICAgICAgICAgICAgc2VsLnNlbGVjdCh2YWxz\nW2lkeF0sIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuCiAgICAgICAgICAg\nICAgICAgICAgZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCBzdG9yZSwgZmV0Y2gs\nIGVhZ2VyTW9kZSwgam9pbnMpOwoKICAgICAgICAgICAgICAgIC8vIyMjIGNo\nZWF0OiByZXN1bHQgam9pbnMgb25seSBjYXJlIGFib3V0IHRoZSByZWxhdGlv\nbiBwYXRoOwogICAgICAgICAgICAgICAgLy8jIyMgdGh1cyB3ZSBjYW4gdXNl\nIGZpcnN0IG1hcHBpbmcgb2YgdW5pb24gb25seQogICAgICAgICAgICAgICAg\naWYgKGlkeCA9PSAwKQogICAgICAgICAgICAgICAgICAgIHJlc0pvaW5zWzFd\nID0gam9pbnM7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBS\nZXN1bHQgcmVzID0gdW5pb24uZXhlY3V0ZShzdG9yZSwgZmV0Y2gpOwogICAg\nICAgIHJldHVybiBuZXcgUmVzdWx0W117IHJlcywgcmVzIH07CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBsb2FkS2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzLCBKb2lucyBqb2lucykKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gSGFuZGxl\nclN0cmF0ZWdpZXMubG9hZE9iamVjdChmaWVsZC5nZXRLZXlNYXBwaW5nKCks\nCiAgICAgICAgICAgIHNtLCBzdG9yZSwgZmV0Y2gsIHJlcywgam9pbnMsIF9r\nY29scywgX2tsb2FkKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGxvYWRW\nYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0\nIHJlcywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHZhbCA9IHJlcy5nZXRCYXNlTWFw\ncGluZygpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAg\ndmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRJbmRlcGVuZGVu\ndFR5cGVNYXBwaW5ncygpWzBdOwogICAgICAgIHJldHVybiByZXMubG9hZCh2\nYWwsIHN0b3JlLCBmZXRjaCwgam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyBK\nb2lucyBqb2luVmFsdWVSZWxhdGlvbihKb2lucyBqb2lucywgQ2xhc3NNYXBw\naW5nIHZhbCkgewogICAgICAgIFZhbHVlTWFwcGluZyB2bSA9IGZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW5S\nZWxhdGlvbihmaWVsZC5nZXROYW1lKCksIHZtLmdldEZvcmVpZ25LZXkodmFs\nKSwgdmFsLAogICAgICAgICAgICB2bS5nZXRTZWxlY3RTdWJjbGFzc2VzKCks\nIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFwKGJv\nb2xlYW4gYWRhcHQpIHsKICAgICAgICBzdXBlci5tYXAoYWRhcHQpOwoKICAg\nICAgICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygp\nOwogICAgICAgIGlmIChrZXkuZ2V0SGFuZGxlcigpID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8taGFuZGxlciIsIGtleSkpOwogICAgICAgIFZhbHVlTWFwcGluZyB2YWwg\nPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGlmICh2YWwu\nZ2V0VHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuUEMgfHwgdmFsLmlzRW1iZWRk\nZWRQQygpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vdC1yZWxhdGlvbiIsIHZhbCkpOwogICAgICAgIGFz\nc2VydE5vdE1hcHBlZEJ5KCk7CgogICAgICAgIGZpZWxkLm1hcEpvaW4oYWRh\ncHQsIHRydWUpOwogICAgICAgIF9raW8gPSBuZXcgQ29sdW1uSU8oKTsKICAg\nICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IGZpZWxkLmdldE1hcHBpbmdSZXBv\nc2l0b3J5KCkuZ2V0REJEaWN0aW9uYXJ5KCk7CiAgICAgICAgX2tjb2xzID0g\nSGFuZGxlclN0cmF0ZWdpZXMubWFwKGtleSwgCiAgICAgICAgICAgIGRpY3Qu\nZ2V0VmFsaWRDb2x1bW5OYW1lKCJrZXkiLCBmaWVsZC5nZXRUYWJsZSgpKSwg\nX2tpbywgYWRhcHQpOwoKICAgICAgICBpZiAodmFsLmdldFR5cGVNYXBwaW5n\nKCkuaXNNYXBwZWQoKSkgewogICAgICAgICAgICBWYWx1ZU1hcHBpbmdJbmZv\nIHZpbmZvID0gdmFsLmdldFZhbHVlSW5mbygpOwogICAgICAgICAgICBGb3Jl\naWduS2V5IGZrID0gdmluZm8uZ2V0VHlwZUpvaW4odmFsLCAidmFsdWUiLCBm\nYWxzZSwgYWRhcHQpOwogICAgICAgICAgICB2YWwuc2V0Rm9yZWlnbktleShm\nayk7CiAgICAgICAgICAgIHZhbC5zZXRDb2x1bW5JTyh2aW5mby5nZXRDb2x1\nbW5JTygpKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgUmVsYXRpb25T\ndHJhdGVnaWVzLm1hcFJlbGF0aW9uVG9Vbm1hcHBlZFBDKHZhbCwgInZhbHVl\nIiwgYWRhcHQpOwoKICAgICAgICB2YWwubWFwQ29uc3RyYWludHMoInZhbHVl\nIiwgYWRhcHQpOwogICAgICAgIGZpZWxkLm1hcFByaW1hcnlLZXkoYWRhcHQp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoKSB7CiAgICAg\nICAgX2tsb2FkID0gZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldEhhbmRsZXIo\nKS4KICAgICAgICAgICAgb2JqZWN0VmFsdWVSZXF1aXJlc0xvYWQoZmllbGQu\nZ2V0S2V5TWFwcGluZygpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbnNl\ncnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBS\nb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGluc2VydChzbSwgc3RvcmUsIHJtLCAoTWFwKSBzbS5mZXRjaE9i\namVjdChmaWVsZC5nZXRJbmRleCgpKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIGluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUg\nc3RvcmUsIFJvd01hbmFnZXIgcm0sCiAgICAgICAgTWFwIG1hcCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAobWFwID09IG51\nbGwgfHwgbWFwLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBSb3cgcm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRh\nYmxlKCksIFJvdy5BQ1RJT05fSU5TRVJUKTsKICAgICAgICByb3cuc2V0Rm9y\nZWlnbktleShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpLCBmaWVsZC5nZXRK\nb2luQ29sdW1uSU8oKSwKICAgICAgICAgICAgc20pOwoKICAgICAgICBWYWx1\nZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOwogICAgICAg\nIFZhbHVlTWFwcGluZyB2YWwgPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgIFN0b3JlQ29udGV4dCBjdHggPSBzdG9yZS5nZXRDb250ZXh0\nKCk7CiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciB2YWxzbTsKICAgICAg\nICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLnNldChrZXksIGVudHJ5\nLmdldEtleSgpLCBzdG9yZSwgcm93LCBfa2NvbHMsCiAgICAgICAgICAgICAg\nICBfa2lvLCB0cnVlKTsKICAgICAgICAgICAgdmFsc20gPSBSZWxhdGlvblN0\ncmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGVudHJ5LmdldFZhbHVlKCksCiAg\nICAgICAgICAgICAgICBjdHgpOwogICAgICAgICAgICB2YWwuc2V0Rm9yZWln\nbktleShyb3csIHZhbHNtKTsKICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRh\ncnlSb3cocm93KTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9y\nZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBNYXAgbWFwID0gKE1hcCkgc20uZmV0Y2hPYmplY3QoZmll\nbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAgQ2hhbmdlVHJhY2tlciBjdCA9IG51\nbGw7CiAgICAgICAgaWYgKG1hcCBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAg\nICAgICAgIFByb3h5IHByb3h5ID0gKFByb3h5KSBtYXA7CiAgICAgICAgICAg\nIGlmIChQcm94aWVzLmlzT3duZXIocHJveHksIHNtLCBmaWVsZC5nZXRJbmRl\neCgpKSkKICAgICAgICAgICAgICAgIGN0ID0gcHJveHkuZ2V0Q2hhbmdlVHJh\nY2tlcigpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm8gZmluZS1ncmFp\nbmVkIGNoYW5nZSB0cmFja2luZyB0aGVuIGp1c3QgZGVsZXRlIGFuZCByZWlu\nc2VydAogICAgICAgIGlmIChjdCA9PSBudWxsIHx8ICFjdC5pc1RyYWNraW5n\nKCkpIHsKICAgICAgICAgICAgZGVsZXRlKHNtLCBzdG9yZSwgcm0pOwogICAg\nICAgICAgICBpbnNlcnQoc20sIHN0b3JlLCBybSwgbWFwKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgVmFsdWVNYXBwaW5nIGtl\neSA9IGZpZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBT\ndG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29udGV4dCgpOwogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgdmFsc207CgogICAgICAgIC8vIHVwZGF0\nZSB0aGUgY2hhbmdlczsgbm90ZSB0aGF0IHdlIGhhdmUgdG8gbW9kZWwgY2hh\nbmdlcyBhcwogICAgICAgIC8vIGRlbGV0ZS10aGVuLWluc2VydCBpZiB3ZSBo\nYXZlIGEgZm9yZWlnbiBrZXkgYWN0aW9uLCBiZWNhdXNlCiAgICAgICAgLy8g\nc2Vjb25kYXJ5IHJvdyB1cGRhdGVzIGFyZW4ndCBwYXJ0IG9mIHRoZSBjb25z\ndHJhaW50IGdyYXBoCiAgICAgICAgQ29sbGVjdGlvbiBjaGFuZ2UgPSBjdC5n\nZXRDaGFuZ2VkKCk7CiAgICAgICAgYm9vbGVhbiBjYW5DaGFuZ2UgPSB2YWwu\nZ2V0Rm9yZWlnbktleSgpLmlzTG9naWNhbCgpOwogICAgICAgIE9iamVjdCBt\na2V5OwogICAgICAgIGlmIChjYW5DaGFuZ2UgJiYgIWNoYW5nZS5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgUm93IGNoYW5nZVJvdyA9IHJtLmdldFNlY29u\nZGFyeVJvdyhmaWVsZC5nZXRUYWJsZSgpLAogICAgICAgICAgICAgICAgUm93\nLkFDVElPTl9VUERBVEUpOwogICAgICAgICAgICBjaGFuZ2VSb3cud2hlcmVG\nb3JlaWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCksIHNtKTsKCiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2hhbmdlLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBta2V5ID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVz\nLndoZXJlKGtleSwgbWtleSwgc3RvcmUsIGNoYW5nZVJvdywgX2tjb2xzKTsK\nICAgICAgICAgICAgICAgIHZhbHNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdl\ndFN0YXRlTWFuYWdlcihtYXAuZ2V0KG1rZXkpLCBjdHgpOwogICAgICAgICAg\nICAgICAgdmFsLnNldEZvcmVpZ25LZXkoY2hhbmdlUm93LCB2YWxzbSk7CiAg\nICAgICAgICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhjaGFuZ2VSb3cp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBkZWxldGUg\ndGhlIHJlbW92ZXMKICAgICAgICBDb2xsZWN0aW9uIHJlbSA9IGN0LmdldFJl\nbW92ZWQoKTsKICAgICAgICBpZiAoIXJlbS5pc0VtcHR5KCkgfHwgKCFjYW5D\naGFuZ2UgJiYgIWNoYW5nZS5pc0VtcHR5KCkpKSB7CiAgICAgICAgICAgIFJv\ndyBkZWxSb3cgPSBybS5nZXRTZWNvbmRhcnlSb3coZmllbGQuZ2V0VGFibGUo\nKSwKICAgICAgICAgICAgICAgIFJvdy5BQ1RJT05fREVMRVRFKTsKICAgICAg\nICAgICAgZGVsUm93LndoZXJlRm9yZWlnbktleShmaWVsZC5nZXRKb2luRm9y\nZWlnbktleSgpLCBzbSk7CgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHJlbS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMud2hlcmUoa2V5LCBpdHIubmV4\ndCgpLCBzdG9yZSwgZGVsUm93LAogICAgICAgICAgICAgICAgICAgIF9rY29s\ncyk7CiAgICAgICAgICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhkZWxS\nb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghY2FuQ2hhbmdl\nICYmICFjaGFuZ2UuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IGNoYW5nZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVz\nLndoZXJlKGtleSwgaXRyLm5leHQoKSwgc3RvcmUsIGRlbFJvdywKICAgICAg\nICAgICAgICAgICAgICAgICAgX2tjb2xzKTsKICAgICAgICAgICAgICAgICAg\nICBybS5mbHVzaFNlY29uZGFyeVJvdyhkZWxSb3cpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpbnNl\ncnQgdGhlIGFkZHMKICAgICAgICBDb2xsZWN0aW9uIGFkZCA9IGN0LmdldEFk\nZGVkKCk7CiAgICAgICAgaWYgKCFhZGQuaXNFbXB0eSgpIHx8ICghY2FuQ2hh\nbmdlICYmICFjaGFuZ2UuaXNFbXB0eSgpKSkgewogICAgICAgICAgICBSb3cg\nYWRkUm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCks\nCiAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX0lOU0VSVCk7CiAgICAgICAg\nICAgIGFkZFJvdy5zZXRGb3JlaWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWdu\nS2V5KCksCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRKb2luQ29sdW1uSU8o\nKSwgc20pOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhZGQu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIG1rZXkgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgSGFuZGxlclN0\ncmF0ZWdpZXMuc2V0KGtleSwgbWtleSwgc3RvcmUsIGFkZFJvdywgX2tjb2xz\nLAogICAgICAgICAgICAgICAgICAgIF9raW8sIHRydWUpOwogICAgICAgICAg\nICAgICAgdmFsc20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5h\nZ2VyKG1hcC5nZXQobWtleSksIGN0eCk7CiAgICAgICAgICAgICAgICB2YWwu\nc2V0Rm9yZWlnbktleShhZGRSb3csIHZhbHNtKTsKICAgICAgICAgICAgICAg\nIHJtLmZsdXNoU2Vjb25kYXJ5Um93KGFkZFJvdyk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKCFjYW5DaGFuZ2UgJiYgIWNoYW5nZS5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2hh\nbmdlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICAgICAgbWtleSA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAg\nICAgSGFuZGxlclN0cmF0ZWdpZXMuc2V0KGtleSwgbWtleSwgc3RvcmUsIGFk\nZFJvdywgX2tjb2xzLAogICAgICAgICAgICAgICAgICAgICAgICBfa2lvLCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICB2YWxzbSA9IFJlbGF0aW9uU3Ry\nYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIobWFwLmdldChta2V5KSwKICAgICAg\nICAgICAgICAgICAgICAgICAgY3R4KTsKICAgICAgICAgICAgICAgICAgICB2\nYWwuc2V0Rm9yZWlnbktleShhZGRSb3csIHZhbHNtKTsKICAgICAgICAgICAg\nICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhhZGRSb3cpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oSm9pbnMgam9pbnMsIGJvb2xl\nYW4gZm9yY2VPdXRlciwKICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7CiAg\nICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxkLmdldEVsZW1lbnRNYXBw\naW5nKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gY2xzcyA9IHZhbC5nZXRJ\nbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOwogICAgICAgIGlmIChjbHNzLmxl\nbmd0aCAhPSAxKSB7CiAgICAgICAgICAgIGlmICh0cmF2ZXJzZSkKICAgICAg\nICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmpvaW5hYmxl\nKHZhbCk7CiAgICAgICAgICAgIHJldHVybiBqb2luczsKICAgICAgICB9CiAg\nICAgICAgaWYgKGZvcmNlT3V0ZXIpCiAgICAgICAgICAgIHJldHVybiBqb2lu\ncy5vdXRlckpvaW5SZWxhdGlvbihmaWVsZC5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICB2YWwuZ2V0Rm9yZWlnbktleShjbHNzWzBdKSwgY2xzc1swXSwg\ndmFsLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwKICAgICAgICAgICAgICAgIGZh\nbHNlLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW5SZWxhdGlv\nbihmaWVsZC5nZXROYW1lKCksCiAgICAgICAgICAgIHZhbC5nZXRGb3JlaWdu\nS2V5KGNsc3NbMF0pLCBjbHNzWzBdLCB2YWwuZ2V0U2VsZWN0U3ViY2xhc3Nl\ncygpLCAKICAgICAgICAgICAgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBw\ndWJsaWMgSm9pbnMgam9pbktleVJlbGF0aW9uKEpvaW5zIGpvaW5zLCBib29s\nZWFuIGZvcmNlT3V0ZXIsCiAgICAgICAgYm9vbGVhbiB0cmF2ZXJzZSkgewog\nICAgICAgIGlmICh0cmF2ZXJzZSkKICAgICAgICAgICAgSGFuZGxlclN0cmF0\nZWdpZXMuYXNzZXJ0Sm9pbmFibGUoZmllbGQuZ2V0S2V5TWFwcGluZygpKTsK\nICAgICAgICByZXR1cm4gam9pbnM7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCB0b0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9y\nZSkgewogICAgICAgIHJldHVybiBSZWxhdGlvblN0cmF0ZWdpZXMudG9EYXRh\nU3RvcmVWYWx1ZShmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLAogICAgICAg\nICAgICB2YWwsIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRv\nS2V5RGF0YVN0b3JlVmFsdWUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3Jl\nKSB7CiAgICAgICAgcmV0dXJuIEhhbmRsZXJTdHJhdGVnaWVzLnRvRGF0YVN0\nb3JlVmFsdWUoZmllbGQuZ2V0S2V5TWFwcGluZygpLCB2YWwsCiAgICAgICAg\nICAgIF9rY29scywgc3RvcmUpOwogICAgfQp9Cg==\n","encoding":"base64"}

