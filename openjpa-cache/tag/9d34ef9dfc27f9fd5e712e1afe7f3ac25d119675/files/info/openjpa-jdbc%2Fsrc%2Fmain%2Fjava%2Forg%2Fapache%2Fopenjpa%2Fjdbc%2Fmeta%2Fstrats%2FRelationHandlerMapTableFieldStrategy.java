{"sha":"35a3a1c619765a5acee6dd0a3de6f37190526a75","node_id":"MDQ6QmxvYjIwNjM2NDozNWEzYTFjNjE5NzY1YTVhY2VlNmRkMGEzZGU2ZjM3MTkwNTI2YTc1","size":11146,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/35a3a1c619765a5acee6dd0a3de6f37190526a75","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1w\nb3J0IGphdmEuc3FsLio7CmltcG9ydCBqYXZhLnV0aWwuKjsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC4qOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS4qOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLio7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC4qOwoKLyoqCiAqIDxwPk1hcHBpbmcgZm9y\nIGEgbWFwIHdob3NlIGtleXMgYXJlIHJlbGF0aW9ucyB0byBvdGhlciBwZXJz\naXN0ZW50IG9iamVjdHMKICogYW5kIHdob3NlIHZhbHVlcyBhcmUgY29udHJv\nbGxlZCBieSBhIHtAbGluayBWYWx1ZUhhbmRsZXJ9LjwvcD4KICoKICogQGF1\ndGhvciBBYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wLCAxLjEuMAogKi8KcHVi\nbGljIGNsYXNzIFJlbGF0aW9uSGFuZGxlck1hcFRhYmxlRmllbGRTdHJhdGVn\neQogICAgZXh0ZW5kcyBNYXBUYWJsZUZpZWxkU3RyYXRlZ3kgewoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UKICAgICAgICAoUmVsYXRpb25IYW5kbGVyTWFwVGFibGVG\naWVsZFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwcml2YXRlIENvbHVtbltdIF92\nY29scyA9IG51bGw7CiAgICBwcml2YXRlIENvbHVtbklPIF92aW8gPSBudWxs\nOwogICAgcHJpdmF0ZSBib29sZWFuIF92bG9hZCA9IGZhbHNlOwoKICAgIHB1\nYmxpYyBDb2x1bW5bXSBnZXRLZXlDb2x1bW5zKENsYXNzTWFwcGluZyBjbHMp\nIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldENv\nbHVtbnMoKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0VmFsdWVD\nb2x1bW5zKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICByZXR1cm4gX3Zj\nb2xzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdEtleShTZWxlY3Qg\nc2VsLCBDbGFzc01hcHBpbmcga2V5LCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBzZWwuc2VsZWN0\nKGtleSwgZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFNlbGVjdFN1YmNsYXNz\nZXMoKSwKICAgICAgICAgICAgc3RvcmUsIGZldGNoLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uLkVBR0VSX05PTkUsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZWxlY3RWYWx1ZShTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcg\ndmFsLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9y\nZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgCiAgICAg\nICAgSm9pbnMgam9pbnMpIHsKICAgICAgICBzZWwuc2VsZWN0KF92Y29scywg\nam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHRbXSBnZXRSZXN1bHRz\nKGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgZmluYWwg\nSkRCQ1N0b3JlIHN0b3JlLCBmaW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLAogICAgICAgIGZpbmFsIGludCBlYWdlck1vZGUsIGZpbmFsIEpv\naW5zW10gcmVzSm9pbnMsIGJvb2xlYW4gbHJzKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIFZhbHVlTWFwcGluZyBrZXkgPSBmaWVs\nZC5nZXRLZXlNYXBwaW5nKCk7CiAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5n\nW10ga2V5cyA9IGtleS5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOwog\nICAgICAgIFVuaW9uIHVuaW9uID0gc3RvcmUuZ2V0U1FMRmFjdG9yeSgpLm5l\nd1VuaW9uKGtleXMubGVuZ3RoKTsKICAgICAgICBpZiAoZmV0Y2guZ2V0U3Vi\nY2xhc3NGZXRjaE1vZGUoa2V5LmdldFR5cGVNYXBwaW5nKCkpIAogICAgICAg\nICAgICAhPSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4pCiAg\nICAgICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAgICB1bmlvbi5z\nZXRMUlMobHJzKTsKICAgICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNl\nbGVjdG9yKCkgewogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2Vs\nZWN0IHNlbCwgaW50IGlkeCkgewogICAgICAgICAgICAgICAgc2VsLnNlbGVj\ndChfdmNvbHMpOwogICAgICAgICAgICAgICAgc2VsLndoZXJlRm9yZWlnbktl\neShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpLAogICAgICAgICAgICAgICAg\nICAgIHNtLmdldE9iamVjdElkKCksIGZpZWxkLmdldERlZmluaW5nTWFwcGlu\nZygpLCBzdG9yZSk7CgogICAgICAgICAgICAgICAgSm9pbnMgam9pbnMgPSBq\nb2luS2V5UmVsYXRpb24oc2VsLm5ld0pvaW5zKCksIGtleXNbaWR4XSk7CiAg\nICAgICAgICAgICAgICBzZWwuc2VsZWN0KGtleXNbaWR4XSwgZmllbGQuZ2V0\nS2V5TWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdldFNlbGVjdFN1\nYmNsYXNzZXMoKSwgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIGpvaW5zKTsK\nCiAgICAgICAgICAgICAgICAvLyMjIyBjaGVhdDogcmVzdWx0IGpvaW5zIG9u\nbHkgY2FyZSBhYm91dCB0aGUgcmVsYXRpb24gcGF0aDsKICAgICAgICAgICAg\nICAgIC8vIyMjIHRodXMgd2UgY2FuIHVzZSBmaXJzdCBtYXBwaW5nIG9mIHVu\naW9uIG9ubHkKICAgICAgICAgICAgICAgIGlmIChpZHggPT0gMCkKICAgICAg\nICAgICAgICAgICAgICByZXNKb2luc1swXSA9IGpvaW5zOwogICAgICAgICAg\nICB9CiAgICAgICAgfSk7CiAgICAgICAgUmVzdWx0IHJlcyA9IHVuaW9uLmV4\nZWN1dGUoc3RvcmUsIGZldGNoKTsKICAgICAgICByZXR1cm4gbmV3IFJlc3Vs\ndFtdeyByZXMsIHJlcyB9OwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9h\nZEtleShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0\nIHJlcywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGtleSA9IHJlcy5nZXRCYXNlTWFw\ncGluZygpOwogICAgICAgIGlmIChrZXkgPT0gbnVsbCkKICAgICAgICAgICAg\na2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldEluZGVwZW5kZW50VHlw\nZU1hcHBpbmdzKClbMF07CiAgICAgICAgcmV0dXJuIHJlcy5sb2FkKGtleSwg\nc3RvcmUsIGZldGNoLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBsb2FkVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3Jl\nIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBIYW5kbGVyU3RyYXRlZ2llcy5s\nb2FkT2JqZWN0KGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCksCiAgICAgICAg\nICAgIHNtLCBzdG9yZSwgZmV0Y2gsIHJlcywgam9pbnMsIF92Y29scywgX3Zs\nb2FkKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbktleVJlbGF0aW9u\nKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcga2V5KSB7CiAgICAgICAgVmFs\ndWVNYXBwaW5nIHZtID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOwogICAgICAg\nIHJldHVybiBqb2lucy5qb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLCB2\nbS5nZXRGb3JlaWduS2V5KGtleSksIGtleSwKICAgICAgICAgICAgdm0uZ2V0\nU2VsZWN0U3ViY2xhc3NlcygpLCBmYWxzZSwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIG1hcChib29sZWFuIGFkYXB0KSB7CiAgICAgICAgc3Vw\nZXIubWFwKGFkYXB0KTsKCiAgICAgICAgVmFsdWVNYXBwaW5nIGtleSA9IGZp\nZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAgICBpZiAoa2V5LmdldFR5cGVD\nb2RlKCkgIT0gSmF2YVR5cGVzLlBDIHx8IGtleS5pc0VtYmVkZGVkUEMoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtcmVsYXRpb24iLCBrZXkpKTsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBp\nZiAodmFsLmdldEhhbmRsZXIoKSA9PSBudWxsKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWhhbmRsZXIi\nLCB2YWwpKTsKICAgICAgICBhc3NlcnROb3RNYXBwZWRCeSgpOwoKICAgICAg\nICBmaWVsZC5tYXBKb2luKGFkYXB0LCB0cnVlKTsKICAgICAgICBfdmlvID0g\nbmV3IENvbHVtbklPKCk7CiAgICAgICAgX3Zjb2xzID0gSGFuZGxlclN0cmF0\nZWdpZXMubWFwKHZhbCwgInZhbHVlIiwgX3ZpbywgYWRhcHQpOwoKICAgICAg\nICBpZiAoa2V5LmdldFR5cGVNYXBwaW5nKCkuaXNNYXBwZWQoKSkgewogICAg\nICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZvID0ga2V5LmdldFZhbHVl\nSW5mbygpOwogICAgICAgICAgICBGb3JlaWduS2V5IGZrID0gdmluZm8uZ2V0\nVHlwZUpvaW4oa2V5LCAia2V5IiwgZmFsc2UsIGFkYXB0KTsKICAgICAgICAg\nICAga2V5LnNldEZvcmVpZ25LZXkoZmspOwogICAgICAgICAgICBrZXkuc2V0\nQ29sdW1uSU8odmluZm8uZ2V0Q29sdW1uSU8oKSk7CiAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgIFJlbGF0aW9uU3RyYXRlZ2llcy5tYXBSZWxhdGlvblRv\nVW5tYXBwZWRQQyhrZXksICJrZXkiLCBhZGFwdCk7CgogICAgICAgIGtleS5t\nYXBDb25zdHJhaW50cygia2V5IiwgYWRhcHQpOwogICAgICAgIGZpZWxkLm1h\ncFByaW1hcnlLZXkoYWRhcHQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGlu\naXRpYWxpemUoKSB7CiAgICAgICAgX3Zsb2FkID0gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRIYW5kbGVyKCkuCiAgICAgICAgICAgIG9iamVjdFZh\nbHVlUmVxdWlyZXNMb2FkKGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGluc2VydChPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaW5zZXJ0KHNtLCBz\ndG9yZSwgcm0sIChNYXApIHNtLmZldGNoT2JqZWN0KGZpZWxkLmdldEluZGV4\nKCkpKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5zZXJ0KE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBy\nbSwKICAgICAgICBNYXAgbWFwKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChtYXAgPT0gbnVsbCB8fCBtYXAuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFJvdyByb3cgPSBybS5n\nZXRTZWNvbmRhcnlSb3coZmllbGQuZ2V0VGFibGUoKSwgUm93LkFDVElPTl9J\nTlNFUlQpOwogICAgICAgIHJvdy5zZXRGb3JlaWduS2V5KGZpZWxkLmdldEpv\naW5Gb3JlaWduS2V5KCksIGZpZWxkLmdldEpvaW5Db2x1bW5JTygpLAogICAg\nICAgICAgICBzbSk7CgogICAgICAgIFZhbHVlTWFwcGluZyB2YWwgPSBmaWVs\nZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIFZhbHVlTWFwcGluZyBr\nZXkgPSBmaWVsZC5nZXRLZXlNYXBwaW5nKCk7CiAgICAgICAgU3RvcmVDb250\nZXh0IGN0eCA9IHN0b3JlLmdldENvbnRleHQoKTsKICAgICAgICBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIGtleXNtOwogICAgICAgIE1hcC5FbnRyeSBlbnRyeTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVudHJ5\nID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAga2V5c20g\nPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGVudHJ5Lmdl\ndEtleSgpLCBjdHgpOwogICAgICAgICAgICBrZXkuc2V0Rm9yZWlnbktleShy\nb3csIGtleXNtKTsKICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMuc2V0\nKHZhbCwgZW50cnkuZ2V0VmFsdWUoKSwgc3RvcmUsIHJvdywgX3Zjb2xzLAog\nICAgICAgICAgICAgICAgX3ZpbywgdHJ1ZSk7CiAgICAgICAgICAgIHJtLmZs\ndXNoU2Vjb25kYXJ5Um93KHJvdyk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgTWFwIG1hcCA9IChNYXApIHNtLmZldGNo\nT2JqZWN0KGZpZWxkLmdldEluZGV4KCkpOwogICAgICAgIENoYW5nZVRyYWNr\nZXIgY3QgPSBudWxsOwogICAgICAgIGlmIChtYXAgaW5zdGFuY2VvZiBQcm94\neSkgewogICAgICAgICAgICBQcm94eSBwcm94eSA9IChQcm94eSkgbWFwOwog\nICAgICAgICAgICBpZiAoUHJveGllcy5pc093bmVyKHByb3h5LCBzbSwgZmll\nbGQuZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBjdCA9IHByb3h5Lmdl\ndENoYW5nZVRyYWNrZXIoKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIG5v\nIGZpbmUtZ3JhaW5lZCBjaGFuZ2UgdHJhY2tpbmcgdGhlbiBqdXN0IGRlbGV0\nZSBhbmQgcmVpbnNlcnQKICAgICAgICBpZiAoY3QgPT0gbnVsbCB8fCAhY3Qu\naXNUcmFja2luZygpKSB7CiAgICAgICAgICAgIGRlbGV0ZShzbSwgc3RvcmUs\nIHJtKTsKICAgICAgICAgICAgaW5zZXJ0KHNtLCBzdG9yZSwgcm0sIG1hcCk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGRl\nbGV0ZSB0aGUgcmVtb3ZlcwogICAgICAgIFZhbHVlTWFwcGluZyBrZXkgPSBm\naWVsZC5nZXRLZXlNYXBwaW5nKCk7CiAgICAgICAgU3RvcmVDb250ZXh0IGN0\neCA9IHN0b3JlLmdldENvbnRleHQoKTsKICAgICAgICBDb2xsZWN0aW9uIHJl\nbSA9IGN0LmdldFJlbW92ZWQoKTsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIGtleXNtOwogICAgICAgIGlmICghcmVtLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICBSb3cgZGVsUm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxk\nLmdldFRhYmxlKCksCiAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX0RFTEVU\nRSk7CiAgICAgICAgICAgIGRlbFJvdy53aGVyZUZvcmVpZ25LZXkoZmllbGQu\nZ2V0Sm9pbkZvcmVpZ25LZXkoKSwgc20pOwogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IHJlbS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAga2V5c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMu\nZ2V0U3RhdGVNYW5hZ2VyKGl0ci5uZXh0KCksIGN0eCk7CiAgICAgICAgICAg\nICAgICBrZXkud2hlcmVGb3JlaWduS2V5KGRlbFJvdywga2V5c20pOwogICAg\nICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coZGVsUm93KTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaW5zZXJ0IHRoZSBh\nZGRzCiAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxkLmdldEVsZW1l\nbnRNYXBwaW5nKCk7CiAgICAgICAgQ29sbGVjdGlvbiBhZGQgPSBjdC5nZXRB\nZGRlZCgpOwogICAgICAgIE9iamVjdCBta2V5OwogICAgICAgIGlmICghYWRk\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBSb3cgYWRkUm93ID0gcm0uZ2V0\nU2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksCiAgICAgICAgICAgICAg\nICBSb3cuQUNUSU9OX0lOU0VSVCk7CiAgICAgICAgICAgIGFkZFJvdy5zZXRG\nb3JlaWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCksCiAgICAgICAg\nICAgICAgICBmaWVsZC5nZXRKb2luQ29sdW1uSU8oKSwgc20pOwoKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhZGQuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIG1rZXkgPSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAga2V5c20gPSBSZWxhdGlvblN0cmF0ZWdp\nZXMuZ2V0U3RhdGVNYW5hZ2VyKG1rZXksIGN0eCk7CiAgICAgICAgICAgICAg\nICBrZXkuc2V0Rm9yZWlnbktleShhZGRSb3csIGtleXNtKTsKICAgICAgICAg\nICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLnNldCh2YWwsIG1hcC5nZXQobWtl\neSksIHN0b3JlLCBhZGRSb3csCiAgICAgICAgICAgICAgICAgICAgX3Zjb2xz\nLCBfdmlvLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJtLmZsdXNoU2Vjb25k\nYXJ5Um93KGFkZFJvdyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIHVwZGF0ZSB0aGUgY2hhbmdlcwogICAgICAgIENvbGxlY3Rpb24g\nY2hhbmdlID0gY3QuZ2V0Q2hhbmdlZCgpOwogICAgICAgIGlmICghY2hhbmdl\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBSb3cgY2hhbmdlUm93ID0gcm0u\nZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksCiAgICAgICAgICAg\nICAgICBSb3cuQUNUSU9OX1VQREFURSk7CiAgICAgICAgICAgIGNoYW5nZVJv\ndy53aGVyZUZvcmVpZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwg\nc20pOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjaGFuZ2Uu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIG1rZXkgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAga2V5c20gPSBS\nZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKG1rZXksIGN0eCk7\nCiAgICAgICAgICAgICAgICBrZXkud2hlcmVGb3JlaWduS2V5KGNoYW5nZVJv\ndywga2V5c20pOwogICAgICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMu\nc2V0KHZhbCwgbWFwLmdldChta2V5KSwgc3RvcmUsIGNoYW5nZVJvdywKICAg\nICAgICAgICAgICAgICAgICBfdmNvbHMsIF92aW8sIHRydWUpOwogICAgICAg\nICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coY2hhbmdlUm93KTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgSm9pbnMg\nam9pblJlbGF0aW9uKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIs\nCiAgICAgICAgYm9vbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIGlmICh0cmF2\nZXJzZSkKICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMuYXNzZXJ0Sm9p\nbmFibGUoZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKSk7CiAgICAgICAgcmV0\ndXJuIGpvaW5zOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luS2V5UmVs\nYXRpb24oSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRlciwKICAgICAg\nICBib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGtl\neSA9IGZpZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAgICBDbGFzc01hcHBp\nbmdbXSBjbHNzID0ga2V5LmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7\nCiAgICAgICAgaWYgKGNsc3MubGVuZ3RoICE9IDEpIHsKICAgICAgICAgICAg\naWYgKHRyYXZlcnNlKQogICAgICAgICAgICAgICAgdGhyb3cgUmVsYXRpb25T\ndHJhdGVnaWVzLnVuam9pbmFibGUoZmllbGQuZ2V0S2V5TWFwcGluZygpKTsK\nICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwogICAgICAgIH0KICAgICAgICBp\nZiAoZm9yY2VPdXRlcikKICAgICAgICAgICAgcmV0dXJuIGpvaW5zLm91dGVy\nSm9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nIGtleS5nZXRGb3JlaWduS2V5KGNsc3NbMF0pLCBjbHNzWzBdLCBrZXkuZ2V0\nU2VsZWN0U3ViY2xhc3NlcygpLAogICAgICAgICAgICAgICAgZmFsc2UsIGZh\nbHNlKTsKICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxk\nLmdldE5hbWUoKSwKICAgICAgICAgICAga2V5LmdldEZvcmVpZ25LZXkoY2xz\nc1swXSksIGNsc3NbMF0sIGtleS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksCiAg\nICAgICAgICAgIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCB0b0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBz\ndG9yZSkgewogICAgICAgIHJldHVybiBIYW5kbGVyU3RyYXRlZ2llcy50b0Rh\ndGFTdG9yZVZhbHVlKGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCksCiAgICAg\nICAgICAgIHZhbCwgX3Zjb2xzLCBzdG9yZSk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCB0b0tleURhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNT\ndG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBSZWxhdGlvblN0cmF0ZWdp\nZXMudG9EYXRhU3RvcmVWYWx1ZShmaWVsZC5nZXRLZXlNYXBwaW5nKCksIHZh\nbCwKICAgICAgICAgICAgc3RvcmUpOwogICAgfQp9Cg==\n","encoding":"base64"}

