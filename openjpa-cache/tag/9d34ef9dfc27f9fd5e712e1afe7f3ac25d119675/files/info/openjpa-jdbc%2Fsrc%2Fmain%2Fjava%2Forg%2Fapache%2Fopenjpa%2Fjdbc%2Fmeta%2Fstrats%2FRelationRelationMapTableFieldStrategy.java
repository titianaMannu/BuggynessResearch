{"sha":"14a15da3e8e378216122c8979dc92e4d1800e29a","node_id":"MDQ6QmxvYjIwNjM2NDoxNGExNWRhM2U4ZTM3ODIxNjEyMmM4OTc5ZGM5MmU0ZDE4MDBlMjlh","size":15118,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/14a15da3e8e378216122c8979dc92e4d1800e29a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1w\nb3J0IGphdmEuc3FsLio7CmltcG9ydCBqYXZhLnV0aWwuKjsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC4qOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS4qOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLio7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC4qOwoKLyoqCiAqIDxwPk1hcHBpbmcgZm9y\nIGEgbWFwIHdob3NlIGtleXMgYW5kIHZhbHVlcyBhcmUgYm90aCByZWxhdGlv\nbnMgdG8gb3RoZXIKICogcGVyc2lzdGVudCBvYmplY3RzLjwvcD4KICoKICog\nQGF1dGhvciBBYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wLCAxLjEuMAogKi8K\ncHVibGljIGNsYXNzIFJlbGF0aW9uUmVsYXRpb25NYXBUYWJsZUZpZWxkU3Ry\nYXRlZ3kKICAgIGV4dGVuZHMgTWFwVGFibGVGaWVsZFN0cmF0ZWd5IHsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKFJlbGF0aW9uUmVsYXRpb25NYXBU\nYWJsZUZpZWxkU3RyYXRlZ3kuY2xhc3MpOwoKICAgIHByaXZhdGUgU3RyaW5n\nIF9rZXlSZWxhdGlvbk5hbWUgPSBudWxsOwoKICAgIHB1YmxpYyBDb2x1bW5b\nXSBnZXRLZXlDb2x1bW5zKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBy\nZXR1cm4gZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldENvbHVtbnMoKTsKICAg\nIH0KCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0VmFsdWVDb2x1bW5zKENsYXNz\nTWFwcGluZyBjbHMpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRDb2x1bW5zKCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2VsZWN0S2V5KFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBrZXksIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3Jl\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBKb2lucyBqb2lucykg\newogICAgICAgIHNlbC5zZWxlY3Qoa2V5LCBmaWVsZC5nZXRLZXlNYXBwaW5n\nKCkuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLAogICAgICAgICAgICBzdG9yZSwg\nZmV0Y2gsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSwgam9p\nbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdFZhbHVlKFNlbGVj\ndCBzZWwsIENsYXNzTWFwcGluZyB2YWwsCiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCAKICAgICAgICBKb2lucyBqb2lucykgewogICAgICAg\nIHNlbC5zZWxlY3QodmFsLCBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdl\ndFNlbGVjdFN1YmNsYXNzZXMoKSwKICAgICAgICAgICAgc3RvcmUsIGZldGNo\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX05PTkUsIGpvaW5zKTsK\nICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0W10gZ2V0UmVzdWx0cyhmaW5hbCBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIGZpbmFsIEpEQkNTdG9y\nZSBzdG9yZSwgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwK\nICAgICAgICBmaW5hbCBpbnQgZWFnZXJNb2RlLCBmaW5hbCBKb2luc1tdIHJl\nc0pvaW5zLCBib29sZWFuIGxycykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5\nTWFwcGluZygpOwogICAgICAgIGZpbmFsIENsYXNzTWFwcGluZ1tdIGtleXMg\nPSBrZXkuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsKICAgICAgICBV\nbmlvbiBrdW5pb24gPSBzdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3VW5pb24o\na2V5cy5sZW5ndGgpOwogICAgICAgIGlmIChmZXRjaC5nZXRTdWJjbGFzc0Zl\ndGNoTW9kZShrZXkuZ2V0VHlwZU1hcHBpbmcoKSkKICAgICAgICAgICAgIT0g\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKQogICAgICAgICAg\nICBrdW5pb24uYWJvcnRVbmlvbigpOwogICAgICAgIGt1bmlvbi5zZXRMUlMo\nbHJzKTsKICAgICAgICBrdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3Rv\ncigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBz\nZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIHNlbC53aGVyZUZvcmVp\nZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwKICAgICAgICAgICAg\nICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBmaWVsZC5nZXREZWZpbmluZ01h\ncHBpbmcoKSwgc3RvcmUpOwoKICAgICAgICAgICAgICAgIC8vIG9yZGVyIGJl\nZm9yZSBzZWxlY3QgaW4gY2FzZSB3ZSdyZSBmYWtpbmcgdW5pb24gd2l0aAog\nICAgICAgICAgICAgICAgLy8gbXVsdGlwbGUgc2VsZWN0czsgb3JkZXIgdmFs\ncyB1c2VkIHRvIG1lcmdlIHJlc3VsdHMKICAgICAgICAgICAgICAgIEpvaW5z\nIGpvaW5zID0gam9pbktleVJlbGF0aW9uKHNlbC5uZXdKb2lucygpLCBrZXlz\nW2lkeF0pOwogICAgICAgICAgICAgICAgc2VsLm9yZGVyQnkoZmllbGQuZ2V0\nS2V5TWFwcGluZygpLmdldENvbHVtbnMoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICBzZWwuc2VsZWN0KGtleXNbaWR4XSwgZmllbGQuZ2V0S2V5\nTWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdldFNlbGVjdFN1YmNs\nYXNzZXMoKSwgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIGpvaW5zKTsKCiAg\nICAgICAgICAgICAgICAvLyMjIyBjaGVhdDogcmVzdWx0IGpvaW5zIG9ubHkg\nY2FyZSBhYm91dCB0aGUgcmVsYXRpb24gcGF0aDsKICAgICAgICAgICAgICAg\nIC8vIyMjIHRodXMgd2UgY2FuIHVzZSBmaXJzdCBtYXBwaW5nIG9mIHVuaW9u\nIG9ubHkKICAgICAgICAgICAgICAgIGlmIChpZHggPT0gMCkKICAgICAgICAg\nICAgICAgICAgICByZXNKb2luc1swXSA9IGpvaW5zOwogICAgICAgICAgICB9\nCiAgICAgICAgfSk7CgogICAgICAgIFZhbHVlTWFwcGluZyB2YWwgPSBmaWVs\nZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGZpbmFsIENsYXNzTWFw\ncGluZ1tdIHZhbHMgPSB2YWwuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3Mo\nKTsKICAgICAgICBVbmlvbiB2dW5pb24gPSBzdG9yZS5nZXRTUUxGYWN0b3J5\nKCkubmV3VW5pb24odmFscy5sZW5ndGgpOwogICAgICAgIGlmIChmZXRjaC5n\nZXRTdWJjbGFzc0ZldGNoTW9kZSh2YWwuZ2V0VHlwZU1hcHBpbmcoKSkKICAg\nICAgICAgICAgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lO\nKQogICAgICAgICAgICB2dW5pb24uYWJvcnRVbmlvbigpOwogICAgICAgIHZ1\nbmlvbi5zZXRMUlMobHJzKTsKICAgICAgICB2dW5pb24uc2VsZWN0KG5ldyBV\nbmlvbi5TZWxlY3RvcigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2Vs\nZWN0KFNlbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIHNl\nbC53aGVyZUZvcmVpZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwK\nICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBmaWVsZC5n\nZXREZWZpbmluZ01hcHBpbmcoKSwgc3RvcmUpOwoKICAgICAgICAgICAgICAg\nIC8vIG9yZGVyIGJlZm9yZSBzZWxlY3QgaW4gY2FzZSB3ZSdyZSBmYWtpbmcg\ndW5pb24gd2l0aAogICAgICAgICAgICAgICAgLy8gbXVsdGlwbGUgc2VsZWN0\nczsgb3JkZXIgdmFscyB1c2VkIHRvIG1lcmdlIHJlc3VsdHMKICAgICAgICAg\nICAgICAgIEpvaW5zIGpvaW5zID0gam9pblZhbHVlUmVsYXRpb24oc2VsLm5l\nd0pvaW5zKCksIHZhbHNbaWR4XSk7CiAgICAgICAgICAgICAgICBzZWwub3Jk\nZXJCeShmaWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0Q29sdW1ucygpLCB0cnVl\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIHNlbC5zZWxlY3QodmFsc1tpZHhd\nLCBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLgogICAgICAgICAgICAgICAg\nICAgIGdldFNlbGVjdFN1YmNsYXNzZXMoKSwgc3RvcmUsIGZldGNoLCBlYWdl\nck1vZGUsIGpvaW5zKTsKCiAgICAgICAgICAgICAgICAvLyMjIyBjaGVhdDog\ncmVzdWx0IGpvaW5zIG9ubHkgY2FyZSBhYm91dCB0aGUgcmVsYXRpb24gcGF0\naDsKICAgICAgICAgICAgICAgIC8vIyMjIHRodXMgd2UgY2FuIHVzZSBmaXJz\ndCBtYXBwaW5nIG9mIHVuaW9uIG9ubHkKICAgICAgICAgICAgICAgIGlmIChp\nZHggPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXNKb2luc1sxXSA9IGpv\naW5zOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIFJlc3Vs\ndCBrcmVzID0gbnVsbDsKICAgICAgICBSZXN1bHQgdnJlcyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAga3JlcyA9IGt1bmlvbi5leGVjdXRl\nKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgICAgIHZyZXMgPSB2dW5pb24uZXhl\nY3V0ZShzdG9yZSwgZmV0Y2gpOwogICAgICAgICAgICByZXR1cm4gbmV3IFJl\nc3VsdFtdeyBrcmVzLCB2cmVzIH07CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIGlmIChrcmVzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBrcmVzLmNsb3NlKCk7CiAgICAgICAgICAgIGlmICh2\ncmVzICE9IG51bGwpCiAgICAgICAgICAgICAgICB2cmVzLmNsb3NlKCk7CiAg\nICAgICAgICAgIHRocm93IHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGxvYWRLZXkoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRC\nQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIENsYXNzTWFwcGluZyBrZXkgPSBy\nZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICBpZiAoa2V5ID09IG51bGwp\nCiAgICAgICAgICAgIGtleSA9IGZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRJ\nbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpWzBdOwogICAgICAgIHJldHVybiBy\nZXMubG9hZChrZXksIHN0b3JlLCBmZXRjaCwgam9pbnMpOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgbG9hZFZhbHVlKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzLCBKb2lucyBqb2lucykKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcg\ndmFsID0gcmVzLmdldEJhc2VNYXBwaW5nKCk7CiAgICAgICAgaWYgKHZhbCA9\nPSBudWxsKQogICAgICAgICAgICB2YWwgPSBmaWVsZC5nZXRFbGVtZW50TWFw\ncGluZygpLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKClbMF07CiAgICAg\nICAgcmV0dXJuIHJlcy5sb2FkKHZhbCwgc3RvcmUsIGZldGNoLCBqb2lucyk7\nCiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5LZXlSZWxhdGlvbihKb2lu\ncyBqb2lucywgQ2xhc3NNYXBwaW5nIGtleSkgewogICAgICAgIFZhbHVlTWFw\ncGluZyB2bSA9IGZpZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAgICByZXR1\ncm4gam9pbnMuam9pblJlbGF0aW9uKF9rZXlSZWxhdGlvbk5hbWUsIHZtLmdl\ndEZvcmVpZ25LZXkoa2V5KSwga2V5LAogICAgICAgICAgICB2bS5nZXRTZWxl\nY3RTdWJjbGFzc2VzKCksIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgcHVi\nbGljIEpvaW5zIGpvaW5WYWx1ZVJlbGF0aW9uKEpvaW5zIGpvaW5zLCBDbGFz\nc01hcHBpbmcgdmFsKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIHZtID0gZmll\nbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gam9pbnMu\nam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwgdm0uZ2V0Rm9yZWlnbktl\neSh2YWwpLCB2YWwsCiAgICAgICAgICAgIHZtLmdldFNlbGVjdFN1YmNsYXNz\nZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBt\nYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIHN1cGVyLm1hcChhZGFwdCk7\nCgogICAgICAgIFZhbHVlTWFwcGluZyBrZXkgPSBmaWVsZC5nZXRLZXlNYXBw\naW5nKCk7CiAgICAgICAgaWYgKGtleS5nZXRUeXBlQ29kZSgpICE9IEphdmFU\neXBlcy5QQyB8fCBrZXkuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LXJlbGF0\naW9uIiwga2V5KSk7CiAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgaWYgKHZhbC5nZXRUeXBl\nQ29kZSgpICE9IEphdmFUeXBlcy5QQyB8fCB2YWwuaXNFbWJlZGRlZFBDKCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgibm90LXJlbGF0aW9uIiwgdmFsKSk7CiAgICAgICAgYXNzZXJ0Tm90\nTWFwcGVkQnkoKTsKCiAgICAgICAgZmllbGQubWFwSm9pbihhZGFwdCwgdHJ1\nZSk7CiAgICAgICAgbWFwVHlwZUpvaW4oa2V5LCAia2V5IiwgYWRhcHQpOwog\nICAgICAgIG1hcFR5cGVKb2luKHZhbCwgInZhbHVlIiwgYWRhcHQpOwoKICAg\nICAgICBmaWVsZC5tYXBQcmltYXJ5S2V5KGFkYXB0KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIE1hcCB0aGUgZ2l2ZW4gdmFsdWUncyBqb2luIHRvIGl0cyBw\nZXJzaXN0ZW50IHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtYXBU\neXBlSm9pbihWYWx1ZU1hcHBpbmcgdm0sIFN0cmluZyBuYW1lLCBib29sZWFu\nIGFkYXB0KSB7CiAgICAgICAgaWYgKHZtLmdldFR5cGVNYXBwaW5nKCkuaXNN\nYXBwZWQoKSkgewogICAgICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZv\nID0gdm0uZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgICAgIEZvcmVpZ25LZXkg\nZmsgPSB2aW5mby5nZXRUeXBlSm9pbih2bSwgbmFtZSwgZmFsc2UsIGFkYXB0\nKTsKICAgICAgICAgICAgdm0uc2V0Rm9yZWlnbktleShmayk7CiAgICAgICAg\nICAgIHZtLnNldENvbHVtbklPKHZpbmZvLmdldENvbHVtbklPKCkpOwogICAg\nICAgIH0gZWxzZQogICAgICAgICAgICBSZWxhdGlvblN0cmF0ZWdpZXMubWFw\nUmVsYXRpb25Ub1VubWFwcGVkUEModm0sIG5hbWUsIGFkYXB0KTsKICAgICAg\nICB2bS5tYXBDb25zdHJhaW50cyhuYW1lLCBhZGFwdCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgaW5pdGlhbGl6ZSgpIHsKICAgICAgICBfa2V5UmVsYXRp\nb25OYW1lID0gZmllbGQuZ2V0TmFtZSgpICsgIjprZXkiOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBK\nREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaW5zZXJ0KHNtLCBybSwgKE1hcCkg\nc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSkpOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nUm93TWFuYWdlciBybSwgTWFwIG1hcCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAobWFwID09IG51bGwgfHwgbWFwLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBSb3cgcm93ID0g\ncm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksIFJvdy5BQ1RJ\nT05fSU5TRVJUKTsKICAgICAgICByb3cuc2V0Rm9yZWlnbktleShmaWVsZC5n\nZXRKb2luRm9yZWlnbktleSgpLCBmaWVsZC5nZXRKb2luQ29sdW1uSU8oKSwK\nICAgICAgICAgICAgc20pOwoKICAgICAgICBWYWx1ZU1hcHBpbmcga2V5ID0g\nZmllbGQuZ2V0S2V5TWFwcGluZygpOwogICAgICAgIFZhbHVlTWFwcGluZyB2\nYWwgPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIFN0b3Jl\nQ29udGV4dCBjdHggPSBzbS5nZXRDb250ZXh0KCk7CiAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBrZXlzbSwgdmFsc207CiAgICAgICAgTWFwLkVudHJ5\nIGVudHJ5OwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbWFwLmVudHJ5\nU2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAg\nICBrZXlzbSA9IFJlbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIo\nZW50cnkuZ2V0S2V5KCksIGN0eCk7CiAgICAgICAgICAgIHZhbHNtID0gUmVs\nYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihlbnRyeS5nZXRWYWx1\nZSgpLCBjdHgpOwogICAgICAgICAgICBrZXkuc2V0Rm9yZWlnbktleShyb3cs\nIGtleXNtKTsKICAgICAgICAgICAgdmFsLnNldEZvcmVpZ25LZXkocm93LCB2\nYWxzbSk7CiAgICAgICAgICAgIHJtLmZsdXNoU2Vjb25kYXJ5Um93KHJvdyk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZShPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFn\nZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nTWFwIG1hcCA9IChNYXApIHNtLmZldGNoT2JqZWN0KGZpZWxkLmdldEluZGV4\nKCkpOwogICAgICAgIENoYW5nZVRyYWNrZXIgY3QgPSBudWxsOwogICAgICAg\nIGlmIChtYXAgaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgICAgICBQcm94\neSBwcm94eSA9IChQcm94eSkgbWFwOwogICAgICAgICAgICBpZiAoUHJveGll\ncy5pc093bmVyKHByb3h5LCBzbSwgZmllbGQuZ2V0SW5kZXgoKSkpCiAgICAg\nICAgICAgICAgICBjdCA9IHByb3h5LmdldENoYW5nZVRyYWNrZXIoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIG5vIGZpbmUtZ3JhaW5lZCBjaGFuZ2Ug\ndHJhY2tpbmcgdGhlbiBqdXN0IGRlbGV0ZSBhbmQgcmVpbnNlcnQKICAgICAg\nICBpZiAoY3QgPT0gbnVsbCB8fCAhY3QuaXNUcmFja2luZygpKSB7CiAgICAg\nICAgICAgIGRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgICAgICAgICAgaW5z\nZXJ0KHNtLCBybSwgbWFwKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgVmFsdWVNYXBwaW5nIGtleSA9IGZpZWxkLmdldEtleU1h\ncHBpbmcoKTsKICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQuZ2V0\nRWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBTdG9yZUNvbnRleHQgY3R4ID0g\nc3RvcmUuZ2V0Q29udGV4dCgpOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIga2V5c20sIHZhbHNtOwoKICAgICAgICAvLyB1cGRhdGUgdGhlIGNoYW5n\nZXM7IG5vdGUgdGhhdCB3ZSBoYXZlIHRvIG1vZGVsIGNoYW5nZXMgYXMKICAg\nICAgICAvLyBkZWxldGUtdGhlbi1pbnNlcnQgaWYgd2UgaGF2ZSBhIGZvcmVp\nZ24ga2V5IGFjdGlvbiwgYmVjYXVzZQogICAgICAgIC8vIHNlY29uZGFyeSBy\nb3cgdXBkYXRlcyBhcmVuJ3QgcGFydCBvZiB0aGUgY29uc3RyYWludCBncmFw\naAogICAgICAgIENvbGxlY3Rpb24gY2hhbmdlID0gY3QuZ2V0Q2hhbmdlZCgp\nOwogICAgICAgIGJvb2xlYW4gY2FuQ2hhbmdlID0gdmFsLmdldEZvcmVpZ25L\nZXkoKS5pc0xvZ2ljYWwoKTsKICAgICAgICBPYmplY3QgbWtleTsKICAgICAg\nICBpZiAoY2FuQ2hhbmdlICYmICFjaGFuZ2UuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgIFJvdyBjaGFuZ2VSb3cgPSBybS5nZXRTZWNvbmRhcnlSb3coZmll\nbGQuZ2V0VGFibGUoKSwKICAgICAgICAgICAgICAgIFJvdy5BQ1RJT05fVVBE\nQVRFKTsKICAgICAgICAgICAgY2hhbmdlUm93LndoZXJlRm9yZWlnbktleShm\naWVsZC5nZXRKb2luRm9yZWlnbktleSgpLCBzbSk7CgogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IGNoYW5nZS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgbWtleSA9IGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBrZXlzbSA9IFJlbGF0aW9uU3RyYXRlZ2llcy5n\nZXRTdGF0ZU1hbmFnZXIobWtleSwgY3R4KTsKICAgICAgICAgICAgICAgIHZh\nbHNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihtYXAu\nZ2V0KG1rZXkpLCBjdHgpOwogICAgICAgICAgICAgICAga2V5LndoZXJlRm9y\nZWlnbktleShjaGFuZ2VSb3csIGtleXNtKTsKICAgICAgICAgICAgICAgIHZh\nbC5zZXRGb3JlaWduS2V5KGNoYW5nZVJvdywgdmFsc20pOwogICAgICAgICAg\nICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coY2hhbmdlUm93KTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZGVsZXRlIHRoZSByZW1v\ndmVzCiAgICAgICAgQ29sbGVjdGlvbiByZW0gPSBjdC5nZXRSZW1vdmVkKCk7\nCiAgICAgICAgaWYgKCFyZW0uaXNFbXB0eSgpIHx8ICghY2FuQ2hhbmdlICYm\nICFjaGFuZ2UuaXNFbXB0eSgpKSkgewogICAgICAgICAgICBSb3cgZGVsUm93\nID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksCiAgICAg\nICAgICAgICAgICBSb3cuQUNUSU9OX0RFTEVURSk7CiAgICAgICAgICAgIGRl\nbFJvdy53aGVyZUZvcmVpZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXko\nKSwgc20pOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSByZW0u\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIGtleXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihp\ndHIubmV4dCgpLCBjdHgpOwogICAgICAgICAgICAgICAga2V5LndoZXJlRm9y\nZWlnbktleShkZWxSb3csIGtleXNtKTsKICAgICAgICAgICAgICAgIHJtLmZs\ndXNoU2Vjb25kYXJ5Um93KGRlbFJvdyk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKCFjYW5DaGFuZ2UgJiYgIWNoYW5nZS5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2hhbmdlLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAg\nICAga2V5c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2Vy\nKGl0ci5uZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eCk7CiAg\nICAgICAgICAgICAgICAgICAga2V5LndoZXJlRm9yZWlnbktleShkZWxSb3cs\nIGtleXNtKTsKICAgICAgICAgICAgICAgICAgICBybS5mbHVzaFNlY29uZGFy\neVJvdyhkZWxSb3cpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBpbnNlcnQgdGhlIGFkZHMKICAgICAg\nICBDb2xsZWN0aW9uIGFkZCA9IGN0LmdldEFkZGVkKCk7CiAgICAgICAgaWYg\nKCFhZGQuaXNFbXB0eSgpIHx8ICghY2FuQ2hhbmdlICYmICFjaGFuZ2UuaXNF\nbXB0eSgpKSkgewogICAgICAgICAgICBSb3cgYWRkUm93ID0gcm0uZ2V0U2Vj\nb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksCiAgICAgICAgICAgICAgICBS\nb3cuQUNUSU9OX0lOU0VSVCk7CiAgICAgICAgICAgIGFkZFJvdy5zZXRGb3Jl\naWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCksCiAgICAgICAgICAg\nICAgICBmaWVsZC5nZXRKb2luQ29sdW1uSU8oKSwgc20pOwoKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBhZGQuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIG1rZXkgPSBpdHIubmV4dCgp\nOwogICAgICAgICAgICAgICAga2V5c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMu\nZ2V0U3RhdGVNYW5hZ2VyKG1rZXksIGN0eCk7CiAgICAgICAgICAgICAgICB2\nYWxzbSA9IFJlbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIobWFw\nLmdldChta2V5KSwgY3R4KTsKICAgICAgICAgICAgICAgIGtleS5zZXRGb3Jl\naWduS2V5KGFkZFJvdywga2V5c20pOwogICAgICAgICAgICAgICAgdmFsLnNl\ndEZvcmVpZ25LZXkoYWRkUm93LCB2YWxzbSk7CiAgICAgICAgICAgICAgICBy\nbS5mbHVzaFNlY29uZGFyeVJvdyhhZGRSb3cpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmICghY2FuQ2hhbmdlICYmICFjaGFuZ2UuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNoYW5n\nZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgICAgIG1rZXkgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAg\nIGtleXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlciht\na2V5LCBjdHgpOwogICAgICAgICAgICAgICAgICAgIHZhbHNtID0gUmVsYXRp\nb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihtYXAuZ2V0KG1rZXkpLAog\nICAgICAgICAgICAgICAgICAgICAgICBjdHgpOwogICAgICAgICAgICAgICAg\nICAgIGtleS5zZXRGb3JlaWduS2V5KGFkZFJvdywga2V5c20pOwogICAgICAg\nICAgICAgICAgICAgIHZhbC5zZXRGb3JlaWduS2V5KGFkZFJvdywgdmFsc20p\nOwogICAgICAgICAgICAgICAgICAgIHJtLmZsdXNoU2Vjb25kYXJ5Um93KGFk\nZFJvdyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihKb2lu\ncyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyLAogICAgICAgIGJvb2xlYW4g\ndHJhdmVyc2UpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBDbGFzc01hcHBpbmdbXSBj\nbHNzID0gdmFsLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICAg\nICAgaWYgKGNsc3MubGVuZ3RoICE9IDEpIHsKICAgICAgICAgICAgaWYgKHRy\nYXZlcnNlKQogICAgICAgICAgICAgICAgdGhyb3cgUmVsYXRpb25TdHJhdGVn\naWVzLnVuam9pbmFibGUodmFsKTsKICAgICAgICAgICAgcmV0dXJuIGpvaW5z\nOwogICAgICAgIH0KICAgICAgICBpZiAoZm9yY2VPdXRlcikKICAgICAgICAg\nICAgcmV0dXJuIGpvaW5zLm91dGVySm9pblJlbGF0aW9uKGZpZWxkLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgIHZhbC5nZXRGb3JlaWduS2V5KGNsc3Nb\nMF0pLCBjbHNzWzBdLCB2YWwuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLAogICAg\nICAgICAgICAgICAgZmFsc2UsIGZhbHNlKTsKICAgICAgICByZXR1cm4gam9p\nbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAg\ndmFsLmdldEZvcmVpZ25LZXkoY2xzc1swXSksIGNsc3NbMF0sIHZhbC5nZXRT\nZWxlY3RTdWJjbGFzc2VzKCksCiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSk7\nCiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5LZXlSZWxhdGlvbihKb2lu\ncyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyLAogICAgICAgIGJvb2xlYW4g\ndHJhdmVyc2UpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQu\nZ2V0S2V5TWFwcGluZygpOwogICAgICAgIENsYXNzTWFwcGluZ1tdIGNsc3Mg\nPSBrZXkuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsKICAgICAgICBp\nZiAoY2xzcy5sZW5ndGggIT0gMSkgewogICAgICAgICAgICBpZiAodHJhdmVy\nc2UpCiAgICAgICAgICAgICAgICB0aHJvdyBSZWxhdGlvblN0cmF0ZWdpZXMu\ndW5qb2luYWJsZShrZXkpOwogICAgICAgICAgICByZXR1cm4gam9pbnM7CiAg\nICAgICAgfQogICAgICAgIGlmIChmb3JjZU91dGVyKQogICAgICAgICAgICBy\nZXR1cm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgp\nLAogICAgICAgICAgICAgICAga2V5LmdldEZvcmVpZ25LZXkoY2xzc1swXSks\nIGNsc3NbMF0sIGtleS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksCiAgICAgICAg\nICAgICAgICBmYWxzZSwgZmFsc2UpOwogICAgICAgIHJldHVybiBqb2lucy5q\nb2luUmVsYXRpb24oX2tleVJlbGF0aW9uTmFtZSwKICAgICAgICAgICAga2V5\nLmdldEZvcmVpZ25LZXkoY2xzc1swXSksIGNsc3NbMF0sIGtleS5nZXRTZWxl\nY3RTdWJjbGFzc2VzKCksIAogICAgICAgICAgICBmYWxzZSwgZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9EYXRhU3RvcmVWYWx1ZShPYmpl\nY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1cm4gUmVs\nYXRpb25TdHJhdGVnaWVzLnRvRGF0YVN0b3JlVmFsdWUoZmllbGQuZ2V0RWxl\nbWVudE1hcHBpbmcoKSwKICAgICAgICAgICAgdmFsLCBzdG9yZSk7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCB0b0tleURhdGFTdG9yZVZhbHVlKE9iamVj\ndCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBSZWxh\ndGlvblN0cmF0ZWdpZXMudG9EYXRhU3RvcmVWYWx1ZShmaWVsZC5nZXRLZXlN\nYXBwaW5nKCksCiAgICAgICAgICAgIHZhbCwgc3RvcmUpOwogICAgfQp9Cg==\n","encoding":"base64"}

