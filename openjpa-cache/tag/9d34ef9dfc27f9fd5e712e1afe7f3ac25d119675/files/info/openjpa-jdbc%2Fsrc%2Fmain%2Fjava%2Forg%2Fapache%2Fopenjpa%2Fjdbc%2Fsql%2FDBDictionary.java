{"sha":"96cf76fbef1bba2997326af5eb63c7a94b904538","node_id":"MDQ6QmxvYjIwNjM2NDo5NmNmNzZmYmVmMWJiYTI5OTczMjZhZjVlYjYzYzdhOTRiOTA0NTM4","size":165438,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/96cf76fbef1bba2997326af5eb63c7a94b904538","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkNoYXJBcnJheVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52\nb2NhdGlvblRhcmdldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBv\ncnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBqYXZhLnNxbC5BcnJh\neTsKaW1wb3J0IGphdmEuc3FsLkJsb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9i\nOwppbXBvcnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3Fs\nLkRhdGFiYXNlTWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0\nYXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlJlZjsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuc3FsLlNRTFdhcm5pbmc7CmltcG9ydCBqYXZhLnNxbC5TdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5zcWwu\nVGltZXN0YW1wOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZh\nLnRleHQuTWVzc2FnZUZvcm1hdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGls\nLkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0\nZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGls\nLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IGphdmF4LnNxbC5E\nYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0\ncmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29u\nZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkV4cENv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5FeHBTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5leHBzLkZpbHRlclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuTnVsbDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLlZhbDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkphdmFTUUxUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRGF0\nYVNvdXJjZUZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5OYW1lU2V0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmlsdGVyczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU2VxOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuQ29ubmVjdGlv\nbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRi\nYy5Mb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTG9ja0V4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVj\ndEV4aXN0c0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SZWZlcmVudGlhbEludGVncml0\neUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlNl\ncmlhbGl6YXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5T\ndG9yZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCmltcG9ydCBzZXJwLnV0aWwuTnVt\nYmVyczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIENsYXNz\nIHdoaWNoIGFsbG93cyB0aGUgY3JlYXRpb24gb2YgU1FMIGR5bmFtaWNhbGx5\nLCBpbiBhCiAqIGRhdGFiYXNlIGFnbm9zdGljIGZhc2hpb24uIFN1YmNsYXNz\nIGZvciB0aGUgbnVhbmNlcyBvZiBkaWZmZXJlbnQgZGF0YSBzdG9yZXMuCiAq\nLwpwdWJsaWMgY2xhc3MgREJEaWN0aW9uYXJ5CiAgICBpbXBsZW1lbnRzIENv\nbmZpZ3VyYWJsZSwgQ29ubmVjdGlvbkRlY29yYXRvciwgSm9pblN5bnRheGVz\nLAogICAgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FMV2FybmluZ0hh\nbmRsZXIgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFZFTkRP\nUl9PVEhFUiA9ICJvdGhlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBWRU5ET1JfREFUQURJUkVDVCA9ICJkYXRhZGlyZWN0IjsKCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9VUFBFUiA9\nICJ1cHBlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hF\nTUFfQ0FTRV9MT1dFUiA9ICJsb3dlciI7CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9QUkVTRVJWRSA9ICJwcmVzZXJ2ZSI7\nCgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX0JF\nRk9SRSA9ICJiZWZvcmUiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgQ09OU19OQU1FX01JRCA9ICJtaWQiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgQ09OU19OQU1FX0FGVEVSID0gImFmdGVyIjsKICAgIAog\nICAgcHVibGljIGludCBibG9iQnVmZmVyU2l6ZSA9IDUwMDAwOwogICAgcHVi\nbGljIGludCBjbG9iQnVmZmVyU2l6ZSA9IDUwMDAwOwoKICAgIHByb3RlY3Rl\nZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BPU1RfU0VMRUNUID0gMDsKICAg\nIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BSRV9ESVNUSU5D\nVCA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBSQU5HRV9Q\nT1NUX0RJU1RJTkNUID0gMjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFJBTkdFX1BPU1RfTE9DSyA9IDM7CgogICAgcHJvdGVjdGVkIHN0YXRp\nYyBmaW5hbCBpbnQgTkFOTyA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBNSUNSTyA9IE5BTk8gKiAxMDAwOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgTUlMTEkgPSBNSUNSTyAqIDEwMDA7CiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIGludCBDRU5USSA9IE1JTExJICogMTA7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBERUNJID0gTUlMTEkgKiAx\nMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBTRUMgPSBNSUxM\nSSAqIDEwMDA7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFN\nRV9BTlkgPSAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFN\nRV9UQUJMRSA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBO\nQU1FX1NFUVVFTkNFID0gMjsKICAgIAogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBpbnQgVU5MSU1JVEVEID0gLTE7CiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIGludCBOT19CQVRDSCA9IDA7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIFpFUk9fREFURV9TVFIgPQogICAgICAgICInIiArIG5l\ndyBqYXZhLnNxbC5EYXRlKDApICsgIiciOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIFpFUk9fVElNRV9TVFIgPSAiJyIgKyBuZXcgVGltZSgw\nKSArICInIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBaRVJP\nX1RJTUVTVEFNUF9TVFIgPQogICAgICAgICInIiArIG5ldyBUaW1lc3RhbXAo\nMCkgKyAiJyI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVy\nIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChEQkRpY3Rp\nb25hcnkuY2xhc3MpOwoKICAgIC8vIHNjaGVtYSBkYXRhCiAgICBwdWJsaWMg\nU3RyaW5nIHBsYXRmb3JtID0gIkdlbmVyaWMiOwogICAgcHVibGljIFN0cmlu\nZyBkcml2ZXJWZW5kb3IgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjYXRh\nbG9nU2VwYXJhdG9yID0gIi4iOwogICAgcHVibGljIGJvb2xlYW4gY3JlYXRl\nUHJpbWFyeUtleXMgPSB0cnVlOwogICAgcHVibGljIFN0cmluZyBjb25zdHJh\naW50TmFtZU1vZGUgPSBDT05TX05BTUVfQkVGT1JFOwogICAgcHVibGljIGlu\ndCBtYXhUYWJsZU5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1h\neENvbHVtbk5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heENv\nbnN0cmFpbnROYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJ\nbmRleE5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heEluZGV4\nZXNQZXJUYWJsZSA9IEludGVnZXIuTUFYX1ZBTFVFOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNGb3JlaWduS2V5cyA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzID0gdHJ1ZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3RyaWN0RGVs\nZXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nQ2FzY2FkZURlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3RVcGRhdGVBY3Rp\nb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNDYXNjYWRl\nVXBkYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTnVsbFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbiA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFibGVX\naXRoRHJvcENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0NvbW1lbnRzID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5nIHJlc2Vy\ndmVkV29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzeXN0ZW1TY2hl\nbWFzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVtVGFibGVzID0g\nbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VsZWN0V29yZHMgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBmaXhlZFNpemVUeXBlTmFtZXMgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBzY2hlbWFDYXNlID0gU0NIRU1BX0NBU0VfVVBQ\nRVI7CiAgICBwdWJsaWMgYm9vbGVhbiBzZXRTdHJpbmdSaWdodFRydW5jYXRp\nb25PbiA9IHRydWU7CgogICAgLy8gc3FsCiAgICBwdWJsaWMgU3RyaW5nIHZh\nbGlkYXRpb25TUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjbG9zZVBv\nb2xTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBpbml0aWFsaXphdGlv\nblNRTCA9IG51bGw7CiAgICBwdWJsaWMgaW50IGpvaW5TeW50YXggPSBTWU5U\nQVhfU1FMOTI7CiAgICBwdWJsaWMgU3RyaW5nIG91dGVySm9pbkNsYXVzZSA9\nICJMRUZUIE9VVEVSIEpPSU4iOwogICAgcHVibGljIFN0cmluZyBpbm5lckpv\naW5DbGF1c2UgPSAiSU5ORVIgSk9JTiI7CiAgICBwdWJsaWMgU3RyaW5nIGNy\nb3NzSm9pbkNsYXVzZSA9ICJDUk9TUyBKT0lOIjsKICAgIHB1YmxpYyBib29s\nZWFuIHJlcXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luID0gZmFsc2U7CiAg\nICBwdWJsaWMgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSA9ICJGT1IgVVBEQVRF\nIjsKICAgIHB1YmxpYyBTdHJpbmcgdGFibGVGb3JVcGRhdGVDbGF1c2UgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBkaXN0aW5jdENvdW50Q29sdW1uU2Vw\nYXJhdG9yID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2Vs\nZWN0Rm9yVXBkYXRlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTG9ja2luZ1dpdGhEaXN0aW5jdENsYXVzZSA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMg\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0\naE9yZGVyQ2xhdXNlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbiA9IHRydWU7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFu\nZ2UgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNRdWVyeVRp\nbWVvdXQgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc2ltdWxhdGVMb2Nr\naW5nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1N1YnNl\nbGVjdCA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0NvcnJl\nbGF0ZWRTdWJzZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNIYXZpbmcgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNTZWxlY3RTdGFydEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMg\naW50IHJhbmdlUG9zaXRpb24gPSBSQU5HRV9QT1NUX1NFTEVDVDsKICAgIHB1\nYmxpYyBib29sZWFuIHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QgPSBmYWxz\nZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzVGFyZ2V0Rm9yRGVsZXRl\nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBhbGxvd3NBbGlhc0luQnVs\na0NsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c011\nbHRpcGxlTm9udHJhbnNhY3Rpb25hbFJlc3VsdFNldHMgPSB0cnVlOwogICAg\ncHVibGljIGJvb2xlYW4gcmVxdWlyZXNTZWFyY2hTdHJpbmdFc2NhcGVGb3JM\naWtlID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcgc2VhcmNoU3RyaW5nRXNj\nYXBlID0gIlxcIjsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ2FzdEZv\nck1hdGhGdW5jdGlvbnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHJl\ncXVpcmVzQ2FzdEZvckNvbXBhcmlzb25zID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c01vZE9wZXJhdG9yID0gZmFsc2U7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c1hNTENvbHVtbiA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gcmVwb3J0c1N1Y2Nlc3NOb0luZm9PbkJhdGNoVXBkYXRl\ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNDYXNlQ29u\ndmVyc2lvbkZvckxvYiA9IGZhbHNlOwogICAgCiAgICAvKioKICAgICAqIFNv\nbWUgRGF0YWJhc2VzIGFwcGVuZCB3aGl0ZXNwYWNlIGFmdGVyIHRoZSBzY2hl\nbWEgbmFtZSAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gdHJpbVNjaGVt\nYU5hbWUgPSBmYWxzZTsKCiAgICAvLyBmdW5jdGlvbnMKICAgIHB1YmxpYyBT\ndHJpbmcgY2FzdEZ1bmN0aW9uID0gIkNBU1QoezB9IEFTIHsxfSkiOwogICAg\ncHVibGljIFN0cmluZyB0b0xvd2VyQ2FzZUZ1bmN0aW9uID0gIkxPV0VSKHsw\nfSkiOwogICAgcHVibGljIFN0cmluZyB0b1VwcGVyQ2FzZUZ1bmN0aW9uID0g\nIlVQUEVSKHswfSkiOwogICAgcHVibGljIFN0cmluZyBzdHJpbmdMZW5ndGhG\ndW5jdGlvbiA9ICJDSEFSX0xFTkdUSCh7MH0pIjsKICAgIHB1YmxpYyBTdHJp\nbmcgYml0TGVuZ3RoRnVuY3Rpb24gPSAiKE9DVEVUX0xFTkdUSCh7MH0pICog\nOCkiOwogICAgcHVibGljIFN0cmluZyB0cmltTGVhZGluZ0Z1bmN0aW9uID0g\nIlRSSU0oTEVBRElORyB7MX0gRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJp\nbmcgdHJpbVRyYWlsaW5nRnVuY3Rpb24gPSAiVFJJTShUUkFJTElORyB7MX0g\nRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgdHJpbUJvdGhGdW5jdGlv\nbiA9ICJUUklNKEJPVEggezF9IEZST00gezB9KSI7CiAgICBwdWJsaWMgU3Ry\naW5nIGNvbmNhdGVuYXRlRnVuY3Rpb24gPSAiKHswfXx8ezF9KSI7CiAgICBw\ndWJsaWMgU3RyaW5nIGNvbmNhdGVuYXRlRGVsaW1pdGVyID0gIidPUEVOSlBB\nVE9LRU4nIjsKICAgIHB1YmxpYyBTdHJpbmcgc3Vic3RyaW5nRnVuY3Rpb25O\nYW1lID0gIlNVQlNUUklORyI7CiAgICBwdWJsaWMgU3RyaW5nIGN1cnJlbnRE\nYXRlRnVuY3Rpb24gPSAiQ1VSUkVOVF9EQVRFIjsKICAgIHB1YmxpYyBTdHJp\nbmcgY3VycmVudFRpbWVGdW5jdGlvbiA9ICJDVVJSRU5UX1RJTUUiOwogICAg\ncHVibGljIFN0cmluZyBjdXJyZW50VGltZXN0YW1wRnVuY3Rpb24gPSAiQ1VS\nUkVOVF9USU1FU1RBTVAiOwogICAgcHVibGljIFN0cmluZyBkcm9wVGFibGVT\nUUwgPSAiRFJPUCBUQUJMRSB7MH0iOwoKICAgIC8vIHR5cGVzCiAgICBwdWJs\naWMgYm9vbGVhbiBzdG9yYWdlTGltaXRhdGlvbnNGYXRhbCA9IGZhbHNlOwog\nICAgcHVibGljIGJvb2xlYW4gc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3Mg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN0b3JlQ2hhcnNBc051bWJl\ncnMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0Qnl0ZXNGb3JC\nbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlU2V0Qnl0ZXNG\nb3JCbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0T2Jq\nZWN0Rm9yQmxvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZUdl\ndFN0cmluZ0ZvckNsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1\nc2VTZXRTdHJpbmdGb3JDbG9icyA9IGZhbHNlOwogICAgcHVibGljIGludCBt\nYXhFbWJlZGRlZEJsb2JTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IG1heEVt\nYmVkZGVkQ2xvYlNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgaW5DbGF1c2VM\naW1pdCA9IC0xOwogICAgcHVibGljIGludCBkYXRlUHJlY2lzaW9uID0gTUlM\nTEk7CiAgICBwdWJsaWMgaW50IGNoYXJhY3RlckNvbHVtblNpemUgPSAyNTU7\nCiAgICBwdWJsaWMgU3RyaW5nIGFycmF5VHlwZU5hbWUgPSAiQVJSQVkiOwog\nICAgcHVibGljIFN0cmluZyBiaWdpbnRUeXBlTmFtZSA9ICJCSUdJTlQiOwog\nICAgcHVibGljIFN0cmluZyBiaW5hcnlUeXBlTmFtZSA9ICJCSU5BUlkiOwog\nICAgcHVibGljIFN0cmluZyBiaXRUeXBlTmFtZSA9ICJCSVQiOwogICAgcHVi\nbGljIFN0cmluZyBibG9iVHlwZU5hbWUgPSAiQkxPQiI7CiAgICBwdWJsaWMg\nU3RyaW5nIGJvb2xlYW5UeXBlTmFtZSA9ICJCT09MRUFOIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgY2hhclR5cGVOYW1lID0gIkNIQVIiOwogICAgcHVibGljIFN0\ncmluZyBjbG9iVHlwZU5hbWUgPSAiQ0xPQiI7CiAgICBwdWJsaWMgU3RyaW5n\nIGRhdGVUeXBlTmFtZSA9ICJEQVRFIjsKICAgIHB1YmxpYyBTdHJpbmcgZGVj\naW1hbFR5cGVOYW1lID0gIkRFQ0lNQUwiOwogICAgcHVibGljIFN0cmluZyBk\naXN0aW5jdFR5cGVOYW1lID0gIkRJU1RJTkNUIjsKICAgIHB1YmxpYyBTdHJp\nbmcgZG91YmxlVHlwZU5hbWUgPSAiRE9VQkxFIjsKICAgIHB1YmxpYyBTdHJp\nbmcgZmxvYXRUeXBlTmFtZSA9ICJGTE9BVCI7CiAgICBwdWJsaWMgU3RyaW5n\nIGludGVnZXJUeXBlTmFtZSA9ICJJTlRFR0VSIjsKICAgIHB1YmxpYyBTdHJp\nbmcgamF2YU9iamVjdFR5cGVOYW1lID0gIkpBVkFfT0JKRUNUIjsKICAgIHB1\nYmxpYyBTdHJpbmcgbG9uZ1ZhcmJpbmFyeVR5cGVOYW1lID0gIkxPTkdWQVJC\nSU5BUlkiOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyY2hhclR5cGVOYW1l\nID0gIkxPTkdWQVJDSEFSIjsKICAgIHB1YmxpYyBTdHJpbmcgbnVsbFR5cGVO\nYW1lID0gIk5VTEwiOwogICAgcHVibGljIFN0cmluZyBudW1lcmljVHlwZU5h\nbWUgPSAiTlVNRVJJQyI7CiAgICBwdWJsaWMgU3RyaW5nIG90aGVyVHlwZU5h\nbWUgPSAiT1RIRVIiOwogICAgcHVibGljIFN0cmluZyByZWFsVHlwZU5hbWUg\nPSAiUkVBTCI7CiAgICBwdWJsaWMgU3RyaW5nIHJlZlR5cGVOYW1lID0gIlJF\nRiI7CiAgICBwdWJsaWMgU3RyaW5nIHNtYWxsaW50VHlwZU5hbWUgPSAiU01B\nTExJTlQiOwogICAgcHVibGljIFN0cmluZyBzdHJ1Y3RUeXBlTmFtZSA9ICJT\nVFJVQ1QiOwogICAgcHVibGljIFN0cmluZyB0aW1lVHlwZU5hbWUgPSAiVElN\nRSI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbWVzdGFtcFR5cGVOYW1lID0gIlRJ\nTUVTVEFNUCI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbnlpbnRUeXBlTmFtZSA9\nICJUSU5ZSU5UIjsKICAgIHB1YmxpYyBTdHJpbmcgdmFyYmluYXJ5VHlwZU5h\nbWUgPSAiVkFSQklOQVJZIjsKICAgIHB1YmxpYyBTdHJpbmcgdmFyY2hhclR5\ncGVOYW1lID0gIlZBUkNIQVIiOwogICAgcHVibGljIFN0cmluZyB4bWxUeXBl\nTmFtZSA9ICJYTUwiOwogICAgcHVibGljIFN0cmluZyBnZXRTdHJpbmdWYWwg\nPSAiIjsKCiAgICAvLyBzY2hlbWEgbWV0YWRhdGEKICAgIHB1YmxpYyBib29s\nZWFuIHVzZVNjaGVtYU5hbWUgPSB0cnVlOwogICAgcHVibGljIFN0cmluZyB0\nYWJsZVR5cGVzID0gIlRBQkxFIjsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzU2NoZW1hRm9yR2V0VGFibGVzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzU2NoZW1hRm9yR2V0Q29sdW1ucyA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldENvbHVtbnMg\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNOdWxsVGFibGVG\nb3JHZXRQcmltYXJ5S2V5cyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbmRleEluZm8gPSBmYWxzZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0SW1wb3J0\nZWRLZXlzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VHZXRCZXN0\nUm93SWRlbnRpZmllckZvclByaW1hcnlLZXlzID0gZmFsc2U7CiAgICBwdWJs\naWMgYm9vbGVhbiByZXF1aXJlc0F1dG9Db21taXRGb3JNZXRhRGF0YSA9IGZh\nbHNlOwoKICAgIC8vIGF1dG8taW5jcmVtZW50CiAgICBwdWJsaWMgaW50IG1h\neEF1dG9Bc3NpZ25OYW1lTGVuZ3RoID0gMzE7CiAgICBwdWJsaWMgU3RyaW5n\nIGF1dG9Bc3NpZ25DbGF1c2UgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBh\ndXRvQXNzaWduVHlwZU5hbWUgPSBudWxsOwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNBdXRvQXNzaWduID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5n\nIGxhc3RHZW5lcmF0ZWRLZXlRdWVyeSA9IG51bGw7CiAgICBwdWJsaWMgU3Ry\naW5nIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gbnVsbDsKICAgIHB1YmxpYyBTdHJp\nbmcgc2VxdWVuY2VTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzZXF1\nZW5jZVNjaGVtYVNRTCA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHNlcXVl\nbmNlTmFtZVNRTCA9IG51bGw7CiAgICAvLyBtb3N0IG5hdGl2ZSBzZXF1ZW5j\nZXMgY2FuIGJlIHJ1biBpbnNpZGUgdGhlIGJ1c2luZXNzIHRyYW5zYWN0aW9u\nCiAgICBwdWJsaWMgaW50IG5hdGl2ZVNlcXVlbmNlVHlwZT0gU2VxLlRZUEVf\nVFJBTlNBQ1RJT05BTDsKCiAgICBwcm90ZWN0ZWQgSkRCQ0NvbmZpZ3VyYXRp\nb24gY29uZiA9IG51bGw7CiAgICBwcm90ZWN0ZWQgTG9nIGxvZyA9IG51bGw7\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjb25uZWN0ZWQgPSBmYWxzZTsKICAg\nIHByb3RlY3RlZCBib29sZWFuIGlzSkRCQzMgPSBmYWxzZTsKICAgIHByb3Rl\nY3RlZCBmaW5hbCBTZXQgcmVzZXJ2ZWRXb3JkU2V0ID0gbmV3IEhhc2hTZXQo\nKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQgc3lzdGVtU2NoZW1hU2V0ID0g\nbmV3IEhhc2hTZXQoKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQgc3lzdGVt\nVGFibGVTZXQgPSBuZXcgSGFzaFNldCgpOwogICAgcHJvdGVjdGVkIGZpbmFs\nIFNldCBmaXhlZFNpemVUeXBlTmFtZVNldCA9IG5ldyBIYXNoU2V0KCk7CiAg\nICBwcm90ZWN0ZWQgZmluYWwgU2V0IHR5cGVNb2RpZmllclNldCA9IG5ldyBI\nYXNoU2V0KCk7CiAgICAKICAgIC8qKgogICAgICogU29tZSBKREJDIGRyaXZl\ncnMgLSBpZSBEQjIgdHlwZSAyIG9uIFovT1MgdGhyb3cgZXhjZXB0aW9ucyBv\nbgogICAgICogc2V0UXVlcnlUaW1lb3V0IHdoZW4gcHJvdmlkZWQgc3BlY2lm\naWMgaW5wdXQgdmFsdWVzLgogICAgICogVG8gcmVtYWluIGNvbnNpc3RlbnQg\nd2l0aCBlYXJsaWVyIHZlcnNpb25zIG9mIHRoZSBkcml2ZXIgd2Ugc2hvdWxk\nIGlnbm9yZQogICAgICogdGhlIGV4Y2VwdGlvbi4KICAgICAqIAogICAgICog\nVGhpcyB2YXJpYWJsZSB3aWxsIGJlIHJlbW92ZWQgaW4gZnV0dXJlIHJlbGVh\nc2VzIHdoZW4gd2UgY2FuIGhhbmRsZSB0aGUKICAgICAqIGV4Y2VwdGlvbiBw\ncm9wZXJseS4KICAgICAqLyAKICAgIEBEZXByZWNhdGVkCiAgICBwdWJsaWMg\nYm9vbGVhbiBpZ25vcmVTUUxFeGNlcHRpb25PblNldFF1ZXJ5VGltZW91dCA9\nIGZhbHNlOyAKCiAgICAvKioKICAgICAqIElmIGEgbmF0aXZlIHF1ZXJ5IGJl\nZ2lucyB3aXRoIGFueSBvZiB0aGUgdmFsdWVzIGZvdW5kIGhlcmUgdGhlbiBp\ndCB3aWxsCiAgICAgKiBiZSB0cmVhdGVkIGFzIGEgc2VsZWN0IHN0YXRlbWVu\ndC4gIAogICAgICovCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHNlbGVjdFdv\ncmRTZXQgPSBuZXcgSGFzaFNldCgpOwoKICAgIC8vIHdoZW4gd2Ugc3RvcmUg\ndmFsdWVzIHRoYXQgbG9zZSBwcmVjaW9uLCB0cmFjayB0aGUgdHlwZXMgc28g\ndGhhdCB0aGUKICAgIC8vIGZpcnN0IHRpbWUgaXQgaGFwcGVucyB3ZSBjYW4g\nd2FybiB0aGUgdXNlcgogICAgcHJpdmF0ZSBTZXQgX3ByZWNpc2lvbldhcm5l\nZFR5cGVzID0gbnVsbDsKCiAgICAvLyBjYWNoZSBsb2IgbWV0aG9kcwogICAg\ncHJpdmF0ZSBNZXRob2QgX3NldEJ5dGVzID0gbnVsbDsKICAgIHByaXZhdGUg\nTWV0aG9kIF9zZXRTdHJpbmcgPSBudWxsOwogICAgcHJpdmF0ZSBNZXRob2Qg\nX3NldENoYXJTdHJlYW0gPSBudWxsOwoKICAgIC8vIGJhdGNoTGltaXQgdmFs\ndWU6CiAgICAvLyAtMSA9IHVubGltaXRlZAogICAgLy8gMCAgPSBubyBiYXRj\naAogICAgLy8gYW55IHBvc2l0aXZlIG51bWJlciA9IGJhdGNoIGxpbWl0CiAg\nICBwdWJsaWMgaW50IGJhdGNoTGltaXQgPSBOT19CQVRDSDsKICAgIAogICAg\ncHVibGljIGZpbmFsIE1hcDxJbnRlZ2VyLFNldDxTdHJpbmc+PiBzcWxTdGF0\nZUNvZGVzID0gCiAgICAJbmV3IEhhc2hNYXA8SW50ZWdlciwgU2V0PFN0cmlu\nZz4+KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAKICAgIHB1YmxpYyBEQkRpY3Rpb25hcnkoKSB7CiAgICAgICAg\nZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3\nIFN0cmluZ1tdewogICAgICAgICAgICAiQklHSU5UIiwgIkJJVCIsICJCTE9C\nIiwgIkNMT0IiLCAiREFURSIsICJERUNJTUFMIiwgIkRJU1RJTkNUIiwKICAg\nICAgICAgICAgIkRPVUJMRSIsICJGTE9BVCIsICJJTlRFR0VSIiwgIkpBVkFf\nT0JKRUNUIiwgIk5VTEwiLCAiTlVNRVJJQyIsCiAgICAgICAgICAgICJPVEhF\nUiIsICJSRUFMIiwgIlJFRiIsICJTTUFMTElOVCIsICJTVFJVQ1QiLCAiVElN\nRSIsICJUSU1FU1RBTVAiLAogICAgICAgICAgICAiVElOWUlOVCIsCiAgICAg\nICAgfSkpOwogICAgICAgIAogICAgICAgIHNlbGVjdFdvcmRTZXQuYWRkKCJT\nRUxFQ1QiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlz\nIGNhbGxlZCB3aGVuIHRoZSBkaWN0aW9uYXJ5IGZpcnN0IHNlZXMgYW55IGNv\nbm5lY3Rpb24uCiAgICAgKiBJdCBpcyB1c2VkIHRvIGluaXRpYWxpemUgZGlj\ndGlvbmFyeSBtZXRhZGF0YSBpZiBuZWVkZWQuIElmIHlvdQogICAgICogb3Zl\ncnJpZGUgdGhpcyBtZXRob2QsIGJlIHN1cmUgdG8gY2FsbAogICAgICogPGNv\nZGU+c3VwZXIuY29ubmVjdGVkQ29uZmlndXJhdGlvbjwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oQ29u\nbmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmICghY29ubmVjdGVkKSB7CiAgICAgICAgICAgIERhdGFiYXNl\nTWV0YURhdGEgbWV0YURhdGEgPSBudWxsOwogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgbWV0YURhdGEgPSBjb25uLmdldE1ldGFEYXRhKCk7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIC8v\nIEpEQkMzLW9ubHkgbWV0aG9kLCBzbyBpdCBtaWdodCB0aHJvdyBhIAogICAg\nICAgICAgICAgICAgICAgIC8vIEFic3RyYWN0TWV0aG9kRXJyb3IKICAgICAg\nICAgICAgICAgICAgICBpc0pEQkMzID0gbWV0YURhdGEuZ2V0SkRCQ01ham9y\nVmVyc2lvbigpID49IDM7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgdCkgewogICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBpZiBu\nb3QgSkRCQzMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nZS50b1N0cmluZygpLCBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7ICAgICAgICAgICAgICAgICAg\nICAKICAgICAgICAgICAgICAgIGxvZy50cmFjZShEQkRpY3Rpb25hcnlGYWN0\nb3J5LnRvU3RyaW5nKG1ldGFEYXRhKSk7CgogICAgICAgICAgICAgICAgaWYg\nKGlzSkRCQzMpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJjb25uZWN0aW9uLWRlZmF1bHRzIiwgbmV3IE9iamVjdFtdewogICAg\nICAgICAgICAgICAgICAgICAgICBjb25uLmdldEF1dG9Db21taXQoKSwgY29u\nbi5nZXRIb2xkYWJpbGl0eSgpLAogICAgICAgICAgICAgICAgICAgICAgICBj\nb25uLmdldFRyYW5zYWN0aW9uSXNvbGF0aW9uKCl9KSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgY29ubmVjdGVkID0gdHJ1ZTsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBSZXN1bHRTZXQg\nd3JhcHBlcnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgQXJyYXkgZ2V0QXJyYXkoUmVzdWx0U2V0IHJz\nLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBycy5nZXRBcnJheShjb2x1bW4pOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRBc2NpaVN0\ncmVhbShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEFzY2lpU3Ry\nZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRo\nZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRo\nZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGlj\nIEJpZ0RlY2ltYWwgZ2V0QmlnRGVjaW1hbChSZXN1bHRTZXQgcnMsIGludCBj\nb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSB7CiAgICAgICAgICAg\nIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAg\nICAgIHJldHVybiAoc3RyID09IG51bGwpID8gbnVsbCA6IG5ldyBCaWdEZWNp\nbWFsKHN0cik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBycy5nZXRCaWdE\nZWNpbWFsKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIHZhbHVlIGFzIGFuIHVua25vd24gbnVt\nZXJpYyB0eXBlOwogICAgICogd2UgdHJ5IGZyb20gdGhlIG1vc3QgZ2VuZXJp\nYyB0byB0aGUgbGVhc3QgZ2VuZXJpYy4KICAgICAqLwogICAgcHVibGljIE51\nbWJlciBnZXROdW1iZXIoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIHRyeSBmcm9t\nIHRoZSBtb3N0IGdlbmVyaWMsIGFuZCBpZiBlcnJvcnMgb2NjdXIsIHRyeQog\nICAgICAgIC8vIGxlc3MgZ2VuZXJpYyB0eXBlczsgdGhpcyBlbmFibGVzIHVz\nIHRvIGhhbmRsZSB2YWx1ZXMKICAgICAgICAvLyBsaWtlIERvdWJsZS5OYU4g\nd2l0aG91dCBoYXZpbmcgdG8gaW50cm9zcGVjdCBvbiB0aGUKICAgICAgICAv\nLyBSZXN1bHRTZXRNZXRhRGF0YSAoYnVnICMxMDUzKS4gbm90ZSB0aGF0IHdl\nIGhhbmRsZQogICAgICAgIC8vIGdlbmVyaWMgZXhjZXB0aW9ucywgc2luY2Ug\nc29tZSBkcml2ZXJzIG1heSB0aHJvdwogICAgICAgIC8vIE51bWJlckZvcm1h\ndEV4Y2VwdGlvbnMsIHdoZXJlYXMgb3RoZXJzIG1heSB0aHJvdyBTUUxFeGNl\ncHRpb25zCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGdldEJp\nZ0RlY2ltYWwocnMsIGNvbHVtbik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUxKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IERvdWJsZShnZXREb3VibGUocnMsIGNvbHVtbikpOwogICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTIpIHsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9h\ndChnZXRGbG9hdChycywgY29sdW1uKSk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZTMpIHsKICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1\nZU9mKGdldExvbmcocnMsIGNvbHVtbikpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlNCkgewogICAgICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIE51bWJlcnMudmFsdWVPZihnZXRJbnQocnMsIGNvbHVtbikpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGUxIGluc3RhbmNlb2YgUnVudGltZUV4Y2VwdGlvbikKICAgICAgICAg\nICAgICAgIHRocm93KFJ1bnRpbWVFeGNlcHRpb24pIGUxOwogICAgICAgICAg\nICBpZiAoZTEgaW5zdGFuY2VvZiBTUUxFeGNlcHRpb24pCiAgICAgICAgICAg\nICAgICB0aHJvdyhTUUxFeGNlcHRpb24pIGUxOwogICAgICAgIH0KCiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRv\nIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIEJpZ0ludGVnZXIgZ2V0QmlnSW50ZWdlcihSZXN1bHRTZXQgcnMsIGlu\ndCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSB7CiAgICAgICAg\nICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAg\nICAgICAgIHJldHVybiAoc3RyID09IG51bGwpID8gbnVsbCA6IG5ldyBCaWdE\nZWNpbWFsKHN0cikudG9CaWdJbnRlZ2VyKCk7CiAgICAgICAgfQogICAgICAg\nIEJpZ0RlY2ltYWwgYmQgPSBnZXRCaWdEZWNpbWFsKHJzLCBjb2x1bW4pOwog\nICAgICAgIHJldHVybiAoYmQgPT0gbnVsbCkgPyBudWxsIDogYmQudG9CaWdJ\nbnRlZ2VyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBw\ncm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIElu\ncHV0U3RyZWFtIGdldEJpbmFyeVN0cmVhbShSZXN1bHRTZXQgcnMsIGludCBj\nb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIHJzLmdldEJpbmFyeVN0cmVhbShjb2x1bW4pOwogICAgfQoKICAg\nIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRMT0JTdHJlYW0oSkRCQ1N0b3JlIHN0\nb3JlLCBSZXN1bHRTZXQgcnMsCiAgICAgICAgaW50IGNvbHVtbikgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJpbmFyeVN0\ncmVhbShjb2x1bW4pOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENvbnZl\ncnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQg\ndG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgQmxvYiBnZXRCbG9iKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\ncnMuZ2V0QmxvYihjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBPYmplY3QgZ2V0QmxvYk9iamVjdChSZXN1bHRTZXQgcnMsIGlu\ndCBjb2x1bW4sIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBJbnB1dFN0cmVhbSBpbiA9IG51bGw7CiAg\nICAgICAgaWYgKHVzZUdldEJ5dGVzRm9yQmxvYnMgfHwgdXNlR2V0T2JqZWN0\nRm9yQmxvYnMpIHsKICAgICAgICAgICAgYnl0ZVtdIGJ5dGVzID0gZ2V0Qnl0\nZXMocnMsIGNvbHVtbik7CiAgICAgICAgICAgIGlmIChieXRlcyAhPSBudWxs\nICYmIGJ5dGVzLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBpbiA9IG5l\ndyBCeXRlQXJyYXlJbnB1dFN0cmVhbShieXRlcyk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgQmxvYiBibG9iID0gZ2V0QmxvYihycywgY29sdW1u\nKTsKICAgICAgICAgICAgaWYgKGJsb2IgIT0gbnVsbCAmJiBibG9iLmxlbmd0\naCgpID4gMCkKICAgICAgICAgICAgICAgIGluID0gYmxvYi5nZXRCaW5hcnlT\ndHJlYW0oKTsKICAgICAgICB9CiAgICAgICAgaWYgKGluID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoc3RvcmUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBTZXJpYWxpemF0aW9uLmRlc2VyaWFsaXplKGluLCBudWxsKTsKICAgICAg\nICAgICAgcmV0dXJuIFNlcmlhbGl6YXRpb24uZGVzZXJpYWxpemUoaW4sIHN0\nb3JlLmdldENvbnRleHQoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGluLmNsb3NlKCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0\naGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0\naGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGdldEJvb2xlYW4oUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBycy5nZXRCb29sZWFuKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVz\ndWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIGJ5dGUgZ2V0Qnl0ZShSZXN1bHRTZXQgcnMsIGludCBj\nb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIHJzLmdldEJ5dGUoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBS\nZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAg\nICovCiAgICBwdWJsaWMgYnl0ZVtdIGdldEJ5dGVzKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAodXNlR2V0Qnl0ZXNGb3JCbG9icykKICAgICAgICAgICAgcmV0\ndXJuIHJzLmdldEJ5dGVzKGNvbHVtbik7CiAgICAgICAgaWYgKHVzZUdldE9i\namVjdEZvckJsb2JzKQogICAgICAgICAgICByZXR1cm4gKGJ5dGVbXSkgcnMu\nZ2V0T2JqZWN0KGNvbHVtbik7CgogICAgICAgIEJsb2IgYmxvYiA9IGdldEJs\nb2IocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGJsb2IgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaW50IGxlbmd0aCA9IChp\nbnQpIGJsb2IubGVuZ3RoKCk7CiAgICAgICAgaWYgKGxlbmd0aCA9PSAwKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gYmxvYi5n\nZXRCeXRlcygxLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuIENvbnZlcnRzIHRo\nZSBkYXRlIGZyb20gYSB7QGxpbmsgVGltZXN0YW1wfSBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgQ2FsZW5kYXIgZ2V0Q2FsZW5kYXIoUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIERhdGUgZCA9IGdldERhdGUocnMsIGNvbHVtbik7CiAg\nICAgICAgaWYgKGQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENhbGVuZGFyIGNhbCA9IENhbGVuZGFyLmdldEluc3RhbmNl\nKCk7CiAgICAgICAgY2FsLnNldFRpbWUoZCk7CiAgICAgICAgcmV0dXJuIGNh\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgY2hhciBnZXRD\naGFyKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3RvcmVDaGFyc0FzTnVtYmVy\ncykKICAgICAgICAgICAgcmV0dXJuIChjaGFyKSBnZXRJbnQocnMsIGNvbHVt\nbik7CgogICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVt\nbik7CiAgICAgICAgcmV0dXJuIChTdHJpbmdVdGlscy5pc0VtcHR5KHN0cikp\nID8gMCA6IHN0ci5jaGFyQXQoMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0\nU2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwog\nICAgcHVibGljIFJlYWRlciBnZXRDaGFyYWN0ZXJTdHJlYW0oUmVzdWx0U2V0\nIHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBycy5nZXRDaGFyYWN0ZXJTdHJlYW0oY29sdW1u\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xvYiBnZXRD\nbG9iKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Q2xvYihjb2x1\nbW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0Q2xvYlN0cmluZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZUdldFN0\ncmluZ0ZvckNsb2JzKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0U3RyaW5n\nKGNvbHVtbik7CgogICAgICAgIENsb2IgY2xvYiA9IGdldENsb2IocnMsIGNv\nbHVtbik7CiAgICAgICAgaWYgKGNsb2IgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGNsb2IubGVuZ3RoKCkgPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuICIiOwoKICAgICAgICAvLyB1bmxpa2VseSB0\naGF0IHdlJ2xsIGhhdmUgc3RyaW5ncyBvdmVyIEludGVnZXIuTUFYX1ZBTFVF\nIGNoYXJzCiAgICAgICAgcmV0dXJuIGNsb2IuZ2V0U3ViU3RyaW5nKDEsIChp\nbnQpIGNsb2IubGVuZ3RoKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuIENvbnZlcnRzIHRo\nZSBkYXRlIGZyb20gYSB7QGxpbmsgVGltZXN0YW1wfSBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgRGF0ZSBnZXREYXRlKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBUaW1lc3RhbXAgdHN0YW1wID0gZ2V0VGltZXN0YW1wKHJzLCBjb2x1\nbW4sIG51bGwpOwogICAgICAgIGlmICh0c3RhbXAgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGdldCB0aGUgZnJhY3Rp\nb25hbCBzZWNvbmRzIGNvbXBvbmVudCwgcm91bmRpbmcgYXdheSBhbnl0aGlu\nZyBiZXlvbmQKICAgICAgICAvLyBtaWxsaXNlY29uZHMKICAgICAgICBpbnQg\nZnJhY3Rpb25hbCA9IChpbnQpIE1hdGgucm91bmQodHN0YW1wLmdldE5hbm9z\nKCkgLyAoZG91YmxlKSBNSUxMSSk7CgogICAgICAgIC8vIGdldCB0aGUgbWls\nbGlzIGNvbXBvbmVudDsgc29tZSBKREJDIGRyaXZlcnMgcm91bmQgdGhpcyB0\nbyB0aGUKICAgICAgICAvLyBuZWFyZXN0IHNlY29uZCwgd2hpbGUgb3RoZXJz\nIGRvIG5vdAogICAgICAgIGxvbmcgbWlsbGlzID0gKHRzdGFtcC5nZXRUaW1l\nKCkgLyAxMDAwTCkgKiAxMDAwTDsKICAgICAgICByZXR1cm4gbmV3IERhdGUo\nbWlsbGlzICsgZnJhY3Rpb25hbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0\nU2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwog\nICAgcHVibGljIGphdmEuc3FsLkRhdGUgZ2V0RGF0ZShSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4sIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBycy5nZXREYXRlKGNvbHVtbik7CiAgICAgICAgcmV0dXJu\nIHJzLmdldERhdGUoY29sdW1uLCBjYWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBkb3VibGUgZ2V0RG91YmxlKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gcnMuZ2V0RG91YmxlKGNvbHVtbik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIGZsb2F0IGdldEZsb2F0KFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcnMuZ2V0RmxvYXQoY29sdW1uKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4g\nb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2\nYSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEludChSZXN1bHRT\nZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEludChjb2x1bW4pOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBMb2NhbGUgZ2V0TG9jYWxlKFJl\nc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJzLCBj\nb2x1bW4pOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHN0cikp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmdbXSBw\nYXJhbXMgPSBTdHJpbmdzLnNwbGl0KHN0ciwgIl8iLCAzKTsKICAgICAgICBp\nZiAocGFyYW1zLmxlbmd0aCA8IDMpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiBuZXcgTG9jYWxlKHBhcmFtc1swXSwgcGFyYW1z\nWzFdLCBwYXJhbXNbMl0pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVy\ndCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0\nbyB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBsb25nIGdldExvbmcoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBy\ncy5nZXRMb25nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIE9iamVjdCBnZXRPYmplY3QoUmVzdWx0U2V0IHJzLCBpbnQgY29s\ndW1uLCBNYXAgbWFwKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJz\nLmdldE9iamVjdChjb2x1bW4pOwogICAgICAgIHJldHVybiBycy5nZXRPYmpl\nY3QoY29sdW1uLCBtYXApOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVy\ndCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0\nbyB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBSZWYgZ2V0UmVmKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgTWFw\nIG1hcCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0UmVmKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVz\ndWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIHNob3J0IGdldFNob3J0KFJlc3VsdFNldCBycywgaW50\nIGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gcnMuZ2V0U2hvcnQoY29sdW1uKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFN0cmluZyhSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldFN0cmluZyhjb2x1bW4pOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBUaW1lIGdldFRpbWUoUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gcnMuZ2V0VGltZShjb2x1bW4pOwogICAgICAg\nIHJldHVybiBycy5nZXRUaW1lKGNvbHVtbiwgY2FsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgVGltZXN0YW1wIGdldFRpbWVzdGFtcChS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENhbGVuZGFyIGNhbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBycy5nZXRUaW1lc3RhbXAoY29sdW1u\nKTsKICAgICAgICByZXR1cm4gcnMuZ2V0VGltZXN0YW1wKGNvbHVtbiwgY2Fs\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIFByZXBhcmVkU3RhdGVtZW50IHdyYXBwZXJzCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QXJyYXkoUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIEFycmF5IHZhbCwKICAgICAgICBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHN0bW50LnNldEFycmF5KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8g\ndGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QXNj\naWlTdHJlYW0oUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsCiAg\nICAgICAgSW5wdXRTdHJlYW0gdmFsLCBpbnQgbGVuZ3RoLCBDb2x1bW4gY29s\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50\nLnNldEFzY2lpU3RyZWFtKGlkeCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\nciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCaWdEZWNpbWFsKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4\nLCBCaWdEZWNpbWFsIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICgoY29sICE9IG51\nbGwgJiYgY29sLmlzQ29tcGF0aWJsZShUeXBlcy5WQVJDSEFSLCBudWxsLCAw\nLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9PSBudWxsICYmIHN0b3JlTGFy\nZ2VOdW1iZXJzQXNTdHJpbmdzKSkKICAgICAgICAgICAgc2V0U3RyaW5nKHN0\nbW50LCBpZHgsIHZhbC50b1N0cmluZygpLCBjb2wpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc3RtbnQuc2V0QmlnRGVjaW1hbChpZHgsIHZhbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEg\ncGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEJpZ0ludGVnZXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nIGludCBpZHgsIEJpZ0ludGVnZXIgdmFsLAogICAgICAgIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKChj\nb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21wYXRpYmxlKFR5cGVzLlZBUkNIQVIs\nIG51bGwsIDAsIDApKQogICAgICAgICAgICB8fCAoY29sID09IG51bGwgJiYg\nc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpKQogICAgICAgICAgICBzZXRT\ndHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCksIGNvbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgs\nIG5ldyBCaWdEZWNpbWFsKHZhbCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpbmFy\neVN0cmVhbShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwKICAg\nICAgICBJbnB1dFN0cmVhbSB2YWwsIGludCBsZW5ndGgsIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQu\nc2V0QmluYXJ5U3RyZWFtKGlkeCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\nciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCbG9iKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBCbG9i\nIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzdG1udC5zZXRCbG9iKGlkeCwgdmFsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4gVXNlcyB0aGUKICAgICAqIHtAbGluayAj\nc2VyaWFsaXplfSBtZXRob2QgdG8gc2VyaWFsaXplIHRoZSB2YWx1ZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0QmxvYk9iamVjdChQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBD\nb2x1bW4gY29sLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0Qnl0ZXMoc3RtbnQsIGlkeCwgc2Vy\naWFsaXplKHZhbCwgc3RvcmUpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUg\nc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCb29sZWFu\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBib29sZWFuIHZh\nbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHN0bW50LnNldEludChpZHgsICh2YWwpID8gMSA6\nIDApOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRCeXRlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBieXRlIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRCeXRlKGlkeCwg\ndmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0Qnl0ZXMoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsIGJ5dGVbXSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNl\nU2V0Qnl0ZXNGb3JCbG9icykKICAgICAgICAgICAgc3RtbnQuc2V0Qnl0ZXMo\naWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0QmluYXJ5\nU3RyZWFtKHN0bW50LCBpZHgsIG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbSh2\nYWwpLAogICAgICAgICAgICAgICAgdmFsLmxlbmd0aCwgY29sKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0Q2hhcihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\nY2hhciB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKChjb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21w\nYXRpYmxlKFR5cGVzLklOVEVHRVIsIG51bGwsIDAsIDApKQogICAgICAgICAg\nICB8fCAoY29sID09IG51bGwgJiYgc3RvcmVDaGFyc0FzTnVtYmVycykpCiAg\nICAgICAgICAgIHNldEludChzdG1udCwgaWR4LCAoaW50KSB2YWwsIGNvbCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlk\neCwgU3RyaW5nLnZhbHVlT2YodmFsKSwgY29sKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8g\ndGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2hh\ncmFjdGVyU3RyZWFtKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4\nLAogICAgICAgIFJlYWRlciB2YWwsIGludCBsZW5ndGgsIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQu\nc2V0Q2hhcmFjdGVyU3RyZWFtKGlkeCwgdmFsLCBsZW5ndGgpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRDbG9iKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBD\nbG9iIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXRDbG9iKGlkeCwgdmFsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0Q2xvYlN0cmluZyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgU3RyaW5nIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh1c2VTZXRTdHJp\nbmdGb3JDbG9icykKICAgICAgICAgICAgc3RtbnQuc2V0U3RyaW5nKGlkeCwg\ndmFsKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gc2V0IHJlYWRl\nciBmcm9tIHN0cmluZwogICAgICAgICAgICBTdHJpbmdSZWFkZXIgaW4gPSBu\nZXcgU3RyaW5nUmVhZGVyKHZhbCk7CiAgICAgICAgICAgIHNldENoYXJhY3Rl\nclN0cmVhbShzdG1udCwgaWR4LCBpbiwgdmFsLmxlbmd0aCgpLCBjb2wpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4g\ndmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0RGF0ZShQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgRGF0ZSB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNvbCAhPSBudWxs\nICYmIGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuREFURSkKICAgICAgICAgICAg\nc2V0RGF0ZShzdG1udCwgaWR4LCBuZXcgamF2YS5zcWwuRGF0ZSh2YWwuZ2V0\nVGltZSgpKSwgbnVsbCwgY29sKTsKICAgICAgICBlbHNlIGlmIChjb2wgIT0g\nbnVsbCAmJiBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLlRJTUUpCiAgICAgICAg\nICAgIHNldFRpbWUoc3RtbnQsIGlkeCwgbmV3IFRpbWUodmFsLmdldFRpbWUo\nKSksIG51bGwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNl\nb2YgVGltZXN0YW1wKQogICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQs\nIGlkeCwoVGltZXN0YW1wKSB2YWwsIG51bGwsIGNvbCk7ICAgCiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwgbmV3\nIFRpbWVzdGFtcCh2YWwuZ2V0VGltZSgpKSwgbnVsbCwgY29sKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0RGF0ZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\namF2YS5zcWwuRGF0ZSB2YWwsCiAgICAgICAgQ2FsZW5kYXIgY2FsLCBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQuc2V0RGF0ZShp\nZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udC5zZXRE\nYXRlKGlkeCwgdmFsLCBjYWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDYWxlbmRhcihQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQ2FsZW5kYXIgdmFsLAog\nICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gYnkgZGVmYXVsdCB3ZSBtZXJlbHkgZGVsZWdhdGUg\ndGhlIHRoZSBEYXRlIHBhcmFtZXRlcgogICAgICAgIHNldERhdGUoc3RtbnQs\nIGlkeCwgdmFsLmdldFRpbWUoKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhl\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RG91Ymxl\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBkb3VibGUgdmFs\nLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc3RtbnQuc2V0RG91YmxlKGlkeCwgdmFsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RmxvYXQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBp\nZHgsIGZsb2F0IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEZsb2F0KGlk\neCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4g\ndmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0SW50KFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LCBpbnQgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEludChpZHgs\nIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldExvbmcoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsIGxvbmcgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldExvbmcoaWR4\nLCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NhbGUoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIExvY2FsZSB2YWwsCiAgICAgICAgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRT\ndHJpbmcoc3RtbnQsIGlkeCwgdmFsLmdldExhbmd1YWdlKCkgKyAiXyIgKyB2\nYWwuZ2V0Q291bnRyeSgpCiAgICAgICAgICAgICsgIl8iICsgdmFsLmdldFZh\ncmlhbnQoKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXJzIHRvIHRoZSBzdGF0ZW1lbnQu\nIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBjb21lIGZyb20ge0BsaW5r\nIFR5cGVzfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TnVsbChQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgaW50IGNvbFR5cGUsCiAg\nICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzdG1udC5zZXROdWxsKGlkeCwgY29sVHlwZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFy\nYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldE51bWJlcihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgTnVtYmVyIG51bSwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGNoZWNrIGZvciBrbm93\nbiBmbG9hdGluZyBwb2ludCB0eXBlcyB0byBnaXZlIGRyaXZlciBhIGNoYW5j\nZSB0bwogICAgICAgIC8vIGhhbmRsZSBzcGVjaWFsIG51bWJlcnMgbGlrZSBO\nYU4gYW5kIGluZmluaXR5OyBidWcgIzEwNTMKICAgICAgICBpZiAobnVtIGlu\nc3RhbmNlb2YgRG91YmxlKQogICAgICAgICAgICBzZXREb3VibGUoc3RtbnQs\nIGlkeCwgKChEb3VibGUpIG51bSkuZG91YmxlVmFsdWUoKSwgY29sKTsKICAg\nICAgICBlbHNlIGlmIChudW0gaW5zdGFuY2VvZiBGbG9hdCkKICAgICAgICAg\nICAgc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChGbG9hdCkgbnVtKS5mbG9hdFZh\nbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRCaWdE\nZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdEZWNpbWFsKG51bS50b1N0cmlu\nZygpKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXJzIHRvIHRoZSBzdGF0ZW1lbnQuIFRo\nZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBjb21lIGZyb20ge0BsaW5rIFR5\ncGVzfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0T2JqZWN0KFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBPYmplY3QgdmFsLAogICAg\nICAgIGludCBjb2xUeXBlLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjb2xUeXBlID09IC0xIHx8IGNv\nbFR5cGUgPT0gVHlwZXMuT1RIRVIpCiAgICAgICAgICAgIHN0bW50LnNldE9i\namVjdChpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1u\ndC5zZXRPYmplY3QoaWR4LCB2YWwsIGNvbFR5cGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0\nbyB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRS\nZWYoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIFJlZiB2YWws\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgc3RtbnQuc2V0UmVmKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8g\ndGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U2hv\ncnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIHNob3J0IHZh\nbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHN0bW50LnNldFNob3J0KGlkeCwgdmFsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0U3RyaW5nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBTdHJpbmcgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0U3RyaW5n\nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0VGltZShQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgVGltZSB2YWwsCiAgICAgICAgQ2FsZW5kYXIg\nY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQu\nc2V0VGltZShpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\ndG1udC5zZXRUaW1lKGlkeCwgdmFsLCBjYWwpOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0\naGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1l\nc3RhbXAoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAg\nICAgVGltZXN0YW1wIHZhbCwgQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGVuc3Vy\nZSB0aGF0IHdlIGRvIG5vdCBpbnNlcnQgZGF0ZXMgYXQgYSBncmVhdGVyIHBy\nZWNpc2lvbiB0aGFuCiAgICAgICAgLy8gdGhhdCBhdCB3aGljaCB0aGV5IHdp\nbGwgYmUgcmV0dXJuZWQgYnkgYSBTRUxFQ1QKICAgICAgICBpbnQgcm91bmRl\nZCA9IChpbnQpIE1hdGgucm91bmQodmFsLmdldE5hbm9zKCkgLwogICAgICAg\nICAgICAoZG91YmxlKSBkYXRlUHJlY2lzaW9uKTsKICAgICAgICBpbnQgbmFu\nb3MgPSByb3VuZGVkICogZGF0ZVByZWNpc2lvbjsKICAgICAgICBpZiAobmFu\nb3MgPiA5OTk5OTk5OTkpIHsKICAgICAgICAgICAgLy8gcm9sbG92ZXIgdG8g\nbmV4dCBzZWNvbmQKICAgICAgICAgICAgdmFsLnNldFRpbWUodmFsLmdldFRp\nbWUoKSArIDEwMDApOwogICAgICAgICAgICBuYW5vcyA9IDA7CiAgICAgICAg\nfQoKICAgICAgICB2YWwuc2V0TmFub3MobmFub3MpOwoKICAgICAgICBpZiAo\nY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0bW50LnNldFRpbWVzdGFtcChp\nZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udC5zZXRU\naW1lc3RhbXAoaWR4LCB2YWwsIGNhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgYSBjb2x1bW4gdmFsdWUgaW50byBhIHByZXBhcmVkIHN0YXRlbWVu\ndC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RtbnQgdGhlIHByZXBhcmVkIHN0\nYXRlbWVudCB0byBwYXJhbWV0ZXJpemUKICAgICAqIEBwYXJhbSBpZHggdGhl\nIGluZGV4IG9mIHRoZSBwYXJhbWV0ZXIgaW4gdGhlIHByZXBhcmVkIHN0YXRl\nbWVudAogICAgICogQHBhcmFtIHZhbCB0aGUgdmFsdWUgb2YgdGhlIGNvbHVt\nbgogICAgICogQHBhcmFtIGNvbCB0aGUgY29sdW1uIGJlaW5nIHNldAogICAg\nICogQHBhcmFtIHR5cGUgdGhlIGZpZWxkIG1hcHBpbmcgdHlwZSBjb2RlIGZv\nciB0aGUgdmFsdWUKICAgICAqIEBwYXJhbSBzdG9yZSB0aGUgc3RvcmUgbWFu\nYWdlciBmb3IgdGhlIGN1cnJlbnQgY29udGV4dAogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRUeXBlZChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29sLCBpbnQgdHlw\nZSwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAgICAgICAgICBz\nZXROdWxsKHN0bW50LCBpZHgsIChjb2wgPT0gbnVsbCkgPyBUeXBlcy5PVEhF\nUiA6IGNvbC5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBjb2wpOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBTaXplZCBzOwog\nICAgICAgIENhbGVuZGFyZCBjOwogICAgICAgIHN3aXRjaCAodHlwZSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgICAg\nIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwgKChCb29sZWFuKSB2YWwpLmJvb2xl\nYW5WYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgc2V0Qnl0ZShz\ndG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5ieXRlVmFsdWUoKSwgY29sKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09C\nSjoKICAgICAgICAgICAgICAgIHNldENoYXIoc3RtbnQsIGlkeCwgKChDaGFy\nYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAg\nICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwp\nLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgICAgIHNl\ndEZsb2F0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmZsb2F0VmFsdWUo\nKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLklOVF9PQko6CiAgICAgICAgICAgICAgICBzZXRJbnQoc3RtbnQsIGlkeCwg\nKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwgY29sKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAg\nICAgICAgIHNldExvbmcoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkubG9u\nZ1ZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgIHNldFNob3J0\nKHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLnNob3J0VmFsdWUoKSwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBpZiAoY29sICE9IG51\nbGwgJiYgKGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0xPQgogICAgICAgICAg\nICAgICAgICAgIHx8IGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuTE9OR1ZBUkNI\nQVIpKQogICAgICAgICAgICAgICAgICAgIHNldENsb2JTdHJpbmcoc3RtbnQs\nIGlkeCwgKFN0cmluZykgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCAo\nU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAg\nICAgc2V0QmxvYk9iamVjdChzdG1udCwgaWR4LCB2YWwsIGNvbCwgc3RvcmUp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBzZXREYXRlKHN0bW50LCBp\nZHgsIChEYXRlKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAg\nICAgICAgICBzZXRDYWxlbmRhcihzdG1udCwgaWR4LCAoQ2FsZW5kYXIpIHZh\nbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAgICAgICAgc2V0\nQmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVjaW1hbCkgdmFsLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICBzZXRCaWdJbnRl\nZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNvbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTlVNQkVSOgogICAgICAgICAgICAgICAgc2V0TnVtYmVyKHN0bW50LCBpZHgs\nIChOdW1iZXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAg\nICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2FsZSkgdmFsLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAgICAgICAgICAgIHNldEFycmF5\nKHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJ\nX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZhbDsKICAg\nICAgICAgICAgICAgIHNldEFzY2lpU3RyZWFtKHN0bW50LCBpZHgsIChJbnB1\ndFN0cmVhbSkgcy52YWx1ZSwgcy5zaXplLCBjb2wpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJJTkFS\nWV9TVFJFQU06CiAgICAgICAgICAgICAgICBzID0gKFNpemVkKSB2YWw7CiAg\nICAgICAgICAgICAgICBzZXRCaW5hcnlTdHJlYW0oc3RtbnQsIGlkeCwgKElu\ncHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQkxP\nQjoKICAgICAgICAgICAgICAgIHNldEJsb2Ioc3RtbnQsIGlkeCwgKEJsb2Ip\nIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoKICAgICAgICAgICAgICAgIHNl\ndEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZhbCwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5DSEFSX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZh\nbDsKICAgICAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVhbShzdG1udCwg\naWR4LCAoUmVhZGVyKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMu\nQ0xPQjoKICAgICAgICAgICAgICAgIHNldENsb2Ioc3RtbnQsIGlkeCwgKENs\nb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfREFURToKICAgICAgICAgICAg\nICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcmQpIHsKICAgICAgICAg\nICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFsOwogICAgICAgICAgICAg\nICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIGMu\ndmFsdWUsIGMuY2FsZW5kYXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAg\nICBzZXREYXRlKHN0bW50LCBpZHgsIChqYXZhLnNxbC5EYXRlKSB2YWwsIG51\nbGwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhU1FMVHlwZXMuUkVGOgogICAgICAgICAgICAgICAgc2V0UmVm\nKHN0bW50LCBpZHgsIChSZWYpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5USU1FOgog\nICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyZCkg\newogICAgICAgICAgICAgICAgICAgIGMgPSAoQ2FsZW5kYXJkKSB2YWw7CiAg\nICAgICAgICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4LCAoVGltZSkg\nYy52YWx1ZSwgYy5jYWxlbmRhciwgY29sKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFRpbWUoc3RtbnQsIGlkeCwg\nKFRpbWUpIHZhbCwgbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5USU1FU1RBTVA6CiAg\nICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5kYXJkKSB7\nCiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQpIHZhbDsKICAg\nICAgICAgICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwgKFRp\nbWVzdGFtcCkgYy52YWx1ZSwgYy5jYWxlbmRhciwKICAgICAgICAgICAgICAg\nICAgICAgICAgY29sKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAoVGltZXN0\nYW1wKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChjb2wg\nIT0gbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5CTE9CCiAgICAg\nICAgICAgICAgICAgICAgfHwgY29sLmdldFR5cGUoKSA9PSBUeXBlcy5WQVJC\nSU5BUlkpKQogICAgICAgICAgICAgICAgICAgIHNldEJsb2JPYmplY3Qoc3Rt\nbnQsIGlkeCwgdmFsLCBjb2wsIHN0b3JlKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBzZXRPYmplY3Qoc3RtbnQsIGlkeCwg\ndmFsLCBjb2wuZ2V0VHlwZSgpLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCBhIGNvbXBsZXRlbHkgdW5rbm93biBwYXJhbWV0\nZXIgaW50byBhIHByZXBhcmVkIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0VW5rbm93bihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNpemVkIHNpemVk\nID0gbnVsbDsKICAgICAgICBDYWxlbmRhcmQgY2FsZCA9IG51bGw7CiAgICAg\nICAgaWYgKHZhbCBpbnN0YW5jZW9mIFNpemVkKSB7CiAgICAgICAgICAgIHNp\nemVkID0gKFNpemVkKSB2YWw7CiAgICAgICAgICAgIHZhbCA9IHNpemVkLnZh\nbHVlOwogICAgICAgIH0gZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5k\nYXJkKSB7CiAgICAgICAgICAgIGNhbGQgPSAoQ2FsZW5kYXJkKSB2YWw7CiAg\nICAgICAgICAgIHZhbCA9IGNhbGQudmFsdWU7CiAgICAgICAgfQoKICAgICAg\nICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHNldE51bGwoc3RtbnQs\nIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVzLk9USEVSIDogY29sLmdldFR5\ncGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7CiAgICAgICAgZWxzZSBpZiAo\ndmFsIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICBzZXRTdHJpbmco\nc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCksIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgSW50ZWdlcikKICAgICAgICAgICAgc2V0\nSW50KHN0bW50LCBpZHgsICgoSW50ZWdlcikgdmFsKS5pbnRWYWx1ZSgpLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJvb2xlYW4p\nCiAgICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwgKChCb29sZWFu\nKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIExvbmcpCiAgICAgICAgICAgIHNldExvbmcoc3Rt\nbnQsIGlkeCwgKChMb25nKSB2YWwpLmxvbmdWYWx1ZSgpLCBjb2wpOwogICAg\nICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEZsb2F0KQogICAgICAgICAg\nICBzZXRGbG9hdChzdG1udCwgaWR4LCAoKEZsb2F0KSB2YWwpLmZsb2F0VmFs\ndWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBE\nb3VibGUpCiAgICAgICAgICAgIHNldERvdWJsZShzdG1udCwgaWR4LCAoKERv\ndWJsZSkgdmFsKS5kb3VibGVWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIEJ5dGUpCiAgICAgICAgICAgIHNldEJ5dGUo\nc3RtbnQsIGlkeCwgKChCeXRlKSB2YWwpLmJ5dGVWYWx1ZSgpLCBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENoYXJhY3RlcikKICAg\nICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAoKENoYXJhY3RlcikgdmFs\nKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5z\ndGFuY2VvZiBTaG9ydCkKICAgICAgICAgICAgc2V0U2hvcnQoc3RtbnQsIGlk\neCwgKChTaG9ydCkgdmFsKS5zaG9ydFZhbHVlKCksIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgTG9jYWxlKQogICAgICAgICAgICBz\nZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2FsZSkgdmFsLCBjb2wpOwogICAg\nICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJpZ0RlY2ltYWwpCiAgICAg\nICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgKEJpZ0RlY2ltYWwp\nIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBC\naWdJbnRlZ2VyKQogICAgICAgICAgICBzZXRCaWdJbnRlZ2VyKHN0bW50LCBp\nZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAo\ndmFsIGluc3RhbmNlb2YgQXJyYXkpCiAgICAgICAgICAgIHNldEFycmF5KHN0\nbW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIEJsb2IpCiAgICAgICAgICAgIHNldEJsb2Ioc3Rt\nbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBieXRlW10pCiAgICAgICAgICAgIHNldEJ5dGVzKHN0\nbW50LCBpZHgsIChieXRlW10pIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBDbG9iKQogICAgICAgICAgICBzZXRDbG9iKHN0\nbW50LCBpZHgsIChDbG9iKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAo\ndmFsIGluc3RhbmNlb2YgUmVmKQogICAgICAgICAgICBzZXRSZWYoc3RtbnQs\nIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIGphdmEuc3FsLkRhdGUpCiAgICAgICAgICAgIHNldERhdGUo\nc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZhbCwKICAgICAgICAgICAg\nICAgIChjYWxkID09IG51bGwpID8gbnVsbCA6IGNhbGQuY2FsZW5kYXIsIGNv\nbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgVGltZXN0YW1w\nKQogICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwgKFRpbWVz\ndGFtcCkgdmFsLAogICAgICAgICAgICAgICAgKGNhbGQgPT0gbnVsbCkgPyBu\ndWxsIDogY2FsZC5jYWxlbmRhciwgY29sKTsKICAgICAgICBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBUaW1lKQogICAgICAgICAgICBzZXRUaW1lKHN0bW50\nLCBpZHgsIChUaW1lKSB2YWwsCiAgICAgICAgICAgICAgICAoY2FsZCA9PSBu\ndWxsKSA/IG51bGwgOiBjYWxkLmNhbGVuZGFyLCBjb2wpOwogICAgICAgIGVs\nc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpCiAgICAgICAgICAgIHNldERh\ndGUoc3RtbnQsIGlkeCwgKERhdGUpIHZhbCwgY29sKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcikKICAgICAgICAgICAgc2V0\nRGF0ZShzdG1udCwgaWR4LCAoKENhbGVuZGFyKSB2YWwpLmdldFRpbWUoKSwg\nY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBSZWFkZXIp\nCiAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVhbShzdG1udCwgaWR4LCAo\nUmVhZGVyKSB2YWwsCiAgICAgICAgICAgICAgICAoc2l6ZWQgPT0gbnVsbCkg\nPyAwIDogc2l6ZWQuc2l6ZSwgY29sKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGFy\nYW0iLCB2YWwuZ2V0Q2xhc3MoKSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBzZXJpYWxpemVkIGJ5dGVzIGZvciB0aGUgZ2l2ZW4gb2Jq\nZWN0LgogICAgICovCiAgICBwdWJsaWMgYnl0ZVtdIHNlcmlhbGl6ZShPYmpl\nY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgU2Vy\naWFsaXplZERhdGEpCiAgICAgICAgICAgIHJldHVybiAoKFNlcmlhbGl6ZWRE\nYXRhKSB2YWwpLmJ5dGVzOwogICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9u\nLnNlcmlhbGl6ZSh2YWwsIHN0b3JlLmdldENvbnRleHQoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIEpESyAxLjQgPGNvZGU+c2V0Qnl0\nZXM8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQkxPQiBvYmplY3QuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dEJ5dGVzKE9iamVjdCBibG9iLCBi\neXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoX3NldEJ5dGVzID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIF9zZXRCeXRlcyA9IGJsb2IuZ2V0Q2xhc3Mo\nKS5nZXRNZXRob2QoInNldEJ5dGVzIiwKICAgICAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgYnl0ZVtdLmNsYXNzIH0pOwogICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExvYk1ldGhvZChfc2V0Qnl0\nZXMsIGJsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgTnVtYmVycy52\nYWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIElu\ndm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRTdHJpbmc8L2NvZGU+IG1ldGhv\nZCBvbiB0aGUgZ2l2ZW4gQ0xPQgogICAgICogb2JqZWN0LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBwdXRTdHJpbmcoT2JqZWN0IGNsb2IsIFN0cmluZyBk\nYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChfc2V0U3RyaW5nID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIF9zZXRTdHJpbmcgPSBjbG9iLmdldENsYXNzKCkuZ2V0\nTWV0aG9kKCJzZXRTdHJpbmciLAogICAgICAgICAgICAgICAgICAgIG5ldyBD\nbGFzc1tdeyBsb25nLmNsYXNzLCBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9zZXRTdHJpbmcs\nIGNsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgTnVtYmVycy52YWx1\nZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9r\nZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRDaGFyYWN0ZXJTdHJlYW08L2NvZGU+\nIG1ldGhvZCBvbiB0aGUgZ2l2ZW4KICAgICAqIENMT0Igb2JqZWN0LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBwdXRDaGFycyhPYmplY3QgY2xvYiwgY2hh\ncltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKF9zZXRDaGFyU3RyZWFtID09IG51bGwpIHsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRDaGFyU3RyZWFtID0gY2xvYi5n\nZXRDbGFzcygpLmdldE1ldGhvZAogICAgICAgICAgICAgICAgICAgICgic2V0\nQ2hhcmFjdGVyU3RyZWFtIiwgbmV3IENsYXNzW117IGxvbmcuY2xhc3MgfSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIFdyaXRlciB3cml0ZXIgPSAoV3Jp\ndGVyKSBpbnZva2VQdXRMb2JNZXRob2QoX3NldENoYXJTdHJlYW0sIGNsb2Is\nCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgTnVtYmVycy52YWx1ZU9mKDFM\nKSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3cml0ZXIud3JpdGUo\nZGF0YSk7CiAgICAgICAgICAgIHdyaXRlci5mbHVzaCgpOwogICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgU1FMRXhjZXB0aW9uKGlvZS50b1N0cmluZygpKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIGdpdmVuIExPQiBtZXRo\nb2Qgb24gdGhlIGdpdmVuIHRhcmdldCB3aXRoIHRoZSBnaXZlbiBkYXRhLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgaW52b2tlUHV0TG9i\nTWV0aG9kKE1ldGhvZCBtZXRob2QsIE9iamVjdCB0YXJnZXQsCiAgICAgICAg\nT2JqZWN0W10gYXJncykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbWV0aG9kLmludm9r\nZSh0YXJnZXQsIGFyZ3MpOwogICAgICAgIH0gY2F0Y2ggKEludm9jYXRpb25U\nYXJnZXRFeGNlcHRpb24gaXRlKSB7CiAgICAgICAgICAgIFRocm93YWJsZSB0\nID0gaXRlLmdldFRhcmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICBpZiAo\ndCBpbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIHRo\ncm93KFNRTEV4Y2VwdGlvbikgdDsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKHQpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXYXJuIHRoYXQgYSBw\nYXJ0aWN1bGFyIHZhbHVlIGNvdWxkIG5vdCBiZSBzdG9yZWQgcHJlY2lzZWx5\nLgogICAgICogQWZ0ZXIgdGhlIGZpcnN0IHdhcm5pbmcgZm9yIGEgcGFydGlj\ndWxhciB0eXBlLCBtZXNzYWdlcwogICAgICogd2lsbCBiZSB0dXJuZWQgaW50\nbyB0cmFjZSBtZXNzYWdlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nc3RvcmFnZVdhcm5pbmcoT2JqZWN0IG9yaWcsIE9iamVjdCBjb252ZXJ0ZWQp\nIHsKICAgICAgICBib29sZWFuIHdhcm47CiAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChfcHJlY2lzaW9uV2FybmVkVHlw\nZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wcmVjaXNpb25XYXJuZWRU\neXBlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIHdhcm4gPSBfcHJl\nY2lzaW9uV2FybmVkVHlwZXMuYWRkKG9yaWcuZ2V0Q2xhc3MoKSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwgfHwg\nKHdhcm4gJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgfHwg\nKCF3YXJuICYmIGxvZy5pc1RyYWNlRW5hYmxlZCgpKSkgewogICAgICAgICAg\nICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJzdG9yYWdlLXJlc3RyaWN0aW9u\nIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgcGxhdGZvcm0sCiAg\nICAgICAgICAgICAgICBvcmlnLAogICAgICAgICAgICAgICAgb3JpZy5nZXRD\nbGFzcygpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGNvbnZlcnRlZCwK\nICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoc3RvcmFnZUxpbWl0\nYXRpb25zRmF0YWwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVF\neGNlcHRpb24obXNnKTsKCiAgICAgICAgICAgIGlmICh3YXJuKQogICAgICAg\nICAgICAgICAgbG9nLndhcm4obXNnKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgbG9nLnRyYWNlKG1zZyk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vLy8vLy8vLwogICAgLy8gVHlwZXMKICAgIC8vLy8vLy8vLwoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVz\nfSBjb25zdGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5\ncGVzfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAq\nLwogICAgcHVibGljIGludCBnZXRKREJDVHlwZShpbnQgbWV0YVR5cGVDb2Rl\nLCBib29sZWFuIGxvYikgewogICAgICAgIGlmIChsb2IpIHsKICAgICAgICAg\nICAgc3dpdGNoIChtZXRhVHlwZUNvZGUpIHsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVNRTFR5cGVzLkNIQVJfU1RSRUFNOgogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChtZXRhVHlwZUNvZGUpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CSVQpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVm\nZXJyZWRUeXBlKFR5cGVzLlRJTllJTlQpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFS\nX09CSjoKICAgICAgICAgICAgICAgIGlmIChzdG9yZUNoYXJzQXNOdW1iZXJz\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBl\nKFR5cGVzLklOVEVHRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFBy\nZWZlcnJlZFR5cGUoVHlwZXMuQ0hBUik7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9V\nQkxFX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLkRPVUJMRSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5SRUFMKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuSU5URUdFUik7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQklHSU5UKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVm\nZXJyZWRUeXBlKFR5cGVzLlNNQUxMSU5UKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT0NBTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJX1NU\nUkVBTToKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQ0hBUl9TVFJF\nQU06CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklH\nSU5URUdFUjoKICAgICAgICAgICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVy\nc0FzU3RyaW5ncykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJJR0lOVCk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAg\nICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVkFSQ0hB\nUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5OVU1FUklDKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTlVN\nQkVSOgogICAgICAgICAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNT\ndHJpbmdzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuTlVNRVJJQyk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZl\ncnJlZFR5cGUoVHlwZXMuVElNRVNUQU1QKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhU1FMVHlwZXMuU1FMX0FSUkFZOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQVJSQVkpOwogICAgICAgICAgICBj\nYXNlIEphdmFTUUxUeXBlcy5CSU5BUllfU1RSRUFNOgogICAgICAgICAgICBj\nYXNlIEphdmFTUUxUeXBlcy5CTE9COgogICAgICAgICAgICBjYXNlIEphdmFT\nUUxUeXBlcy5CWVRFUzoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVm\nZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgICAgICBjYXNlIEphdmFT\nUUxUeXBlcy5DTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZl\ncnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAgICAgICAgICAgIGNhc2UgSmF2YVNR\nTFR5cGVzLlNRTF9EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFBy\nZWZlcnJlZFR5cGUoVHlwZXMuREFURSk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVNRTFR5cGVzLlRJTUU6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5USU1FKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nU1FMVHlwZXMuVElNRVNUQU1QOgogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRVNUQU1QKTsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLkJMT0IpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgcHJlZmVycmVkIHtAbGluayBUeXBlc30gdHlwZSBm\nb3IgdGhlIGdpdmVuIG9uZS4gUmV0dXJucwogICAgICogdGhlIGdpdmVuIHR5\ncGUgYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRQcmVm\nZXJyZWRUeXBlKGludCB0eXBlKSB7CiAgICAgICAgcmV0dXJuIHR5cGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJlZCBkYXRh\nYmFzZSB0eXBlIG5hbWUgZm9yIHRoZSBnaXZlbiBjb2x1bW4ncyB0eXBlCiAg\nICAgKiBmcm9tIHtAbGluayBUeXBlc30uCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0VHlwZU5hbWUoQ29sdW1uIGNvbCkgewogICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShjb2wuZ2V0VHlwZU5hbWUoKSkpCiAgICAg\nICAgICAgIHJldHVybiBhcHBlbmRTaXplKGNvbCwgY29sLmdldFR5cGVOYW1l\nKCkpOwoKICAgICAgICBpZiAoY29sLmlzQXV0b0Fzc2lnbmVkKCkgJiYgYXV0\nb0Fzc2lnblR5cGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBh\ncHBlbmRTaXplKGNvbCwgYXV0b0Fzc2lnblR5cGVOYW1lKTsKCiAgICAgICAg\ncmV0dXJuIGFwcGVuZFNpemUoY29sLCBnZXRUeXBlTmFtZShjb2wuZ2V0VHlw\nZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB0eXBl\nIG5hbWUgZm9yIHRoZSBzcGVjaWZpYyBjb25zdGFudCBhcyBkZWZpbmVkCiAg\nICAgKiBieSB7QGxpbmsgamF2YS5zcWwuVHlwZXN9LgogICAgICoKICAgICAq\nIEBwYXJhbSB0eXBlIHRoZSB0eXBlCiAgICAgKiBAcmV0dXJuIHRoZSBuYW1l\nIGZvciB0aGUgdHlwZQogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5\ncGVOYW1lKGludCB0eXBlKSB7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAg\nICAgICAgICAgIGNhc2UgVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gYXJyYXlUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5C\nSUdJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gYmlnaW50VHlwZU5hbWU7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklOQVJZOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGJpbmFyeVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLkJJVDoKICAgICAgICAgICAgICAgIHJldHVybiBiaXRUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5CTE9COgogICAgICAgICAgICAgICAg\ncmV0dXJuIGJsb2JUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5C\nT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIGJvb2xlYW5UeXBlTmFt\nZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DSEFSOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGNoYXJUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5DTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIGNsb2JUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGRhdGVUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5E\nRUNJTUFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGRlY2ltYWxUeXBlTmFt\nZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ESVNUSU5DVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBkaXN0aW5jdFR5cGVOYW1lOwogICAgICAgICAgICBj\nYXNlIFR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBkb3Vi\nbGVUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5GTE9BVDoKICAg\nICAgICAgICAgICAgIHJldHVybiBmbG9hdFR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLklOVEVHRVI6CiAgICAgICAgICAgICAgICByZXR1cm4g\naW50ZWdlclR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkpBVkFf\nT0JKRUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIGphdmFPYmplY3RUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQklOQVJZOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGxvbmdWYXJiaW5hcnlUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAgICAg\nICAgICAgIHJldHVybiBsb25nVmFyY2hhclR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLk5VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6CiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVtZXJpY1R5cGVOYW1lOwogICAgICAg\nICAgICBjYXNlIFR5cGVzLk9USEVSOgogICAgICAgICAgICAgICAgcmV0dXJu\nIG90aGVyVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVBTDoK\nICAgICAgICAgICAgICAgIHJldHVybiByZWFsVHlwZU5hbWU7CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuUkVGOgogICAgICAgICAgICAgICAgcmV0dXJuIHJl\nZlR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5UOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHNtYWxsaW50VHlwZU5hbWU7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuU1RSVUNUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIHN0cnVjdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJ\nTUU6CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZVR5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAg\nIHJldHVybiB0aW1lc3RhbXBUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBU\neXBlcy5USU5ZSU5UOgogICAgICAgICAgICAgICAgcmV0dXJuIHRpbnlpbnRU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5WQVJCSU5BUlk6CiAg\nICAgICAgICAgICAgICByZXR1cm4gdmFyYmluYXJ5VHlwZU5hbWU7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJl\ndHVybiB2YXJjaGFyVHlwZU5hbWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gb3RoZXJUeXBlTmFtZTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBz\naXplIHByb3BlcnRpZXMgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICog\nSWYgcHJlc2VudCwgdGhlIHN0cmluZyAiezB9IiB3aWxsIGJlIHJlcGxhY2Vk\nIHdpdGggdGhlIHNpemUgZGVmaW5pdGlvbjsKICAgICAqIG90aGVyd2lzZSB0\naGUgc2l6ZSBkZWZpbml0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIHR5\ncGUgbmFtZS4KICAgICAqIElmIHlvdXIgZGF0YWJhc2UgaGFzIGNvbHVtbiB0\neXBlcyB0aGF0IGRvbid0IGFsbG93IHNpemUgZGVmaW5pdGlvbnMsCiAgICAg\nKiBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byByZXR1cm4gdGhlIHVuYWx0ZXJl\nZCB0eXBlIG5hbWUgZm9yIGNvbHVtbnMgb2YKICAgICAqIHRob3NlIHR5cGVz\nIChvciBhZGQgdGhlIHR5cGUgbmFtZXMgdG8gdGhlCiAgICAgKiA8Y29kZT5m\naXhlZFNpemVUeXBlTmFtZVNldDwvY29kZT4pLgogICAgICogCiAgICAgKiA8\nUD5Tb21lIGRhdGFiYXNlcyBzdXBwb3J0ICJ0eXBlIG1vZGlmaWVycyIgZm9y\nIGV4YW1wbGUgdGhlIHVuc2lnbmVkCiAgICAgKiAibW9kaWZpZXIiIGluIE15\nU1FMLiBJbiB0aGVzZSBjYXNlcyB0aGUgc2l6ZSBzaG91bGQgZ28gYmV0d2Vl\nbiB0aGUgdHlwZSAKICAgICAqIGFuZCB0aGUgIm1vZGlmaWVyIiwgaW5zdGVh\nZCBvZiBhZnRlciB0aGUgbW9kaWZpZXIuIEZvciBleGFtcGxlIAogICAgICog\nQ1JFQVRFIHRhYmxlIEZPTyAoIG15aW50IElOVCAoMTApIFVOU0lHTkVEIC4g\nLiAuKSBpbnN0ZWFkIG9mIAogICAgICogQ1JFQVRFIHRhYmxlIEZPTyAoIG15\naW50IElOVCBVTlNJR05FRCAoMTApIC4gLiAuKS4KICAgICAqIFR5cGUgbW9k\naWZpZXJzIHNob3VsZCBiZSBhZGRlZCB0byA8Y29kZT50eXBlTW9kaWZpZXJT\nZXQ8L2NvZGU+IGluIAogICAgICogc3ViY2xhc3Nlcy4gCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgYXBwZW5kU2l6ZShDb2x1bW4gY29sLCBTdHJp\nbmcgdHlwZU5hbWUpIHsKICAgICAgICBpZiAoZml4ZWRTaXplVHlwZU5hbWVT\nZXQuY29udGFpbnModHlwZU5hbWUudG9VcHBlckNhc2UoKSkpCiAgICAgICAg\nICAgIHJldHVybiB0eXBlTmFtZTsKICAgICAgICBpZiAodHlwZU5hbWUuaW5k\nZXhPZignKCcpICE9IC0xKQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7\nCgogICAgICAgIFN0cmluZyBzaXplID0gbnVsbDsKICAgICAgICBpZiAoY29s\nLmdldFNpemUoKSA+IDApIHsKICAgICAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIoMTApOwogICAgICAgICAgICBidWYuYXBw\nZW5kKCIoIikuYXBwZW5kKGNvbC5nZXRTaXplKCkpOwogICAgICAgICAgICBp\nZiAoY29sLmdldERlY2ltYWxEaWdpdHMoKSA+IDApCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIsICIpLmFwcGVuZChjb2wuZ2V0RGVjaW1hbERpZ2l0\ncygpKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgICAgICAg\nICBzaXplID0gYnVmLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICBy\nZXR1cm4gaW5zZXJ0U2l6ZSh0eXBlTmFtZSwgc2l6ZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRoYXQgaW5zZXJ0cyBhIHNpemUg\nY2xhdXNlIGZvciBhIGdpdmVuIFNRTCB0eXBlLiAKICAgICAqIAogICAgICog\nQHNlZSBhcHBlbmRTaXplCiAgICAgKiAKICAgICAqIEBwYXJhbSB0eXBlTmFt\nZSAgVGhlIFNRTCB0eXBlIGllIElOVAogICAgICogQHBhcmFtIHNpemUgICAg\nICBUaGUgc2l6ZSBjbGF1c2UgaWUgKDEwKQogICAgICogQHJldHVybiAgICAg\nICAgICBUaGUgdHlwZU5hbWUgKyBzaXplIGNsYXVzZS4gVXN1YWxseSB0aGUg\nc2l6ZSBjbGF1c2Ugd2lsbCAKICAgICAqICAgICAgICAgICAgICAgICAgYmUg\nYXBwZW5kZWQgdG8gdHlwZU5hbWUuIElmIHRoZSB0eXBlTmFtZSBjb250YWlu\ncyBhIAogICAgICogICAgICAgICAgICAgICAgICBtYXJrZXIgOiB7MH0gb3Ig\naWYgdHlwZU5hbWUgY29udGFpbnMgYSBtb2RpZmllciB0aGUgCiAgICAgKiAg\nICAgICAgICAgICAgICAgIHNpemUgY2xhdXNlIHdpbGwgYmUgaW5zZXJ0ZWQg\nYXBwcm9wcmlhdGVseS4gICAKICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmlu\nZyBpbnNlcnRTaXplKFN0cmluZyB0eXBlTmFtZSwgU3RyaW5nIHNpemUpIHsK\nICAgIAlpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzaXplKSkgewogICAgICAg\nICAgICBpbnQgaWR4ID0gdHlwZU5hbWUuaW5kZXhPZigiezB9Iik7CiAgICAg\nICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7CiAgICAgICAgfQogICAgCQog\nICAgICAgIGludCBpZHggPSB0eXBlTmFtZS5pbmRleE9mKCJ7MH0iKTsKICAg\nICAgICBpZiAoaWR4ICE9IC0xKSB7CiAgICAgICAgICAgIC8vIHJlcGxhY2Ug\nJ3swfScgd2l0aCBzaXplCiAgICAgICAgICAgIFN0cmluZyByZXQgPSB0eXBl\nTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICAgICAgaWYgKHNpemUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldCA9IHJldCArIHNpemU7CiAg\nICAgICAgICAgIGlmICh0eXBlTmFtZS5sZW5ndGgoKSA+IGlkeCArIDMpCiAg\nICAgICAgICAgICAgICByZXQgPSByZXQgKyB0eXBlTmFtZS5zdWJzdHJpbmco\naWR4ICsgMyk7CiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQog\nICAgICAgIGlmICghdHlwZU1vZGlmaWVyU2V0LmlzRW1wdHkoKSkgewogICAg\nICAgICAgICBTdHJpbmcgczsKICAgICAgICAgICAgaWR4ID0gdHlwZU5hbWUu\nbGVuZ3RoKCk7CiAgICAgICAgICAgIGludCBjdXJJZHggPSAtMTsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpID0gdHlwZU1vZGlmaWVyU2V0Lml0ZXJh\ndG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgcyA9IChT\ndHJpbmcpIGkubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVOYW1l\nLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihzKSAhPSAtMSkgewogICAgICAgICAg\nICAgICAgICAgIGN1cklkeCA9IHR5cGVOYW1lLnRvVXBwZXJDYXNlKCkuaW5k\nZXhPZihzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VySWR4ICE9IC0x\nICYmIGN1cklkeCA8IGlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZHggPSBjdXJJZHg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGlkeCAhPSB0\neXBlTmFtZS5sZW5ndGgoKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIHJl\ndCA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAgICAgICAgICAg\nICAgcmV0ID0gcmV0ICsgc2l6ZTsKICAgICAgICAgICAgICAgIHJldCA9IHJl\ndCArICcgJyArIHR5cGVOYW1lLnN1YnN0cmluZyhpZHgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdHlwZU5hbWUgKyBzaXplOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vCiAgICAvLyBTZWxlY3RzCiAgICAvLy8vLy8vLy8vLwoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBuYW1lIG9mIHRoZSBqb2luIHN5bnRheCB0byB1\nc2U6IHNxbDkyLCB0cmFkaXRpb25hbCwgZGF0YWJhc2UKICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Sm9pblN5bnRheChTdHJpbmcgc3ludGF4KSB7CiAg\nICAgICAgaWYgKCJzcWw5MiIuZXF1YWxzKHN5bnRheCkpCiAgICAgICAgICAg\nIGpvaW5TeW50YXggPSBTWU5UQVhfU1FMOTI7CiAgICAgICAgZWxzZSBpZiAo\nInRyYWRpdGlvbmFsIi5lcXVhbHMoc3ludGF4KSkKICAgICAgICAgICAgam9p\nblN5bnRheCA9IFNZTlRBWF9UUkFESVRJT05BTDsKICAgICAgICBlbHNlIGlm\nICgiZGF0YWJhc2UiLmVxdWFscyhzeW50YXgpKQogICAgICAgICAgICBqb2lu\nU3ludGF4ID0gU1lOVEFYX0RBVEFCQVNFOwogICAgICAgIGVsc2UgaWYgKCFT\ndHJpbmdVdGlscy5pc0VtcHR5KHN5bnRheCkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oc3ludGF4KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIFNRTCBzdHJpbmcgdG8gYWN0IGFz\nIGEgcGxhY2Vob2xkZXIgZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0UGxhY2Vob2xkZXJWYWx1ZVN0cmluZyhD\nb2x1bW4gY29sKSB7CiAgICAgICAgc3dpdGNoIChjb2wuZ2V0VHlwZSgpKSB7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklHSU5UOgogICAgICAgICAgICBj\nYXNlIFR5cGVzLkJJVDoKICAgICAgICAgICAgY2FzZSBUeXBlcy5JTlRFR0VS\nOgogICAgICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuU01BTExJTlQ6CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nVElOWUlOVDoKICAgICAgICAgICAgICAgIHJldHVybiAiMCI7CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiAo\nc3RvcmVDaGFyc0FzTnVtYmVycykgPyAiMCIgOiAiJyAnIjsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5DTE9COgogICAgICAgICAgICBjYXNlIFR5cGVzLkxP\nTkdWQVJDSEFSOgogICAgICAgICAgICBjYXNlIFR5cGVzLlZBUkNIQVI6CiAg\nICAgICAgICAgICAgICByZXR1cm4gIicnIjsKICAgICAgICAgICAgY2FzZSBU\neXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIFpFUk9fREFURV9T\nVFI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuREVDSU1BTDoKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVBTDoKICAgICAgICAg\nICAgICAgIHJldHVybiAiMC4wIjsKICAgICAgICAgICAgY2FzZSBUeXBlcy5U\nSU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIFpFUk9fVElNRV9TVFI7CiAg\nICAgICAgICAgIGNhc2UgVHlwZXMuVElNRVNUQU1QOgogICAgICAgICAgICAg\nICAgcmV0dXJuIFpFUk9fVElNRVNUQU1QX1NUUjsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAiTlVMTCI7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgU0VMRUNUIENPVU5U\nIHN0YXRlbWVudCBpbiB0aGUgcHJvcGVyIGpvaW4gc3ludGF4IGZvciB0aGUK\nICAgICAqIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIHRvU2VsZWN0Q291bnQoU2VsZWN0IHNlbCkgewogICAgICAgIFNR\nTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tOwogICAgICAgIHNlbC5hZGRKb2luQ2xhc3ND\nb25kaXRpb25zKCk7CiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkg\nIT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9IGdldEZyb21TZWxlY3Qoc2Vs\nLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmcm9tID0gZ2V0\nRnJvbShzZWwsIGZhbHNlKTsKICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBn\nZXRXaGVyZShzZWwsIGZhbHNlKTsKCiAgICAgICAgLy8gaWYgbm8gZ3JvdXBp\nbmcgYW5kIG5vIHJhbmdlLCB3ZSBtaWdodCBiZSBhYmxlIHRvIGdldCBieSB3\naXRob3V0CiAgICAgICAgLy8gYSBzdWJzZWxlY3QKICAgICAgICBpZiAoc2Vs\nLmdldEdyb3VwaW5nKCkgPT0gbnVsbCAmJiBzZWwuZ2V0U3RhcnRJbmRleCgp\nID09IDAKICAgICAgICAgICAgJiYgc2VsLmdldEVuZEluZGV4KCkgPT0gTG9u\nZy5NQVhfVkFMVUUpIHsKICAgICAgICAgICAgLy8gaWYgdGhlIHNlbGVjdCBo\nYXMgbm8gaWRlbnRpZmllciBjb2xzLCB1c2UgQ09VTlQoKikKICAgICAgICAg\nICAgTGlzdCBhbGlhc2VzID0gKCFzZWwuaXNEaXN0aW5jdCgpKSA/IENvbGxl\nY3Rpb25zLkVNUFRZX0xJU1QKICAgICAgICAgICAgICAgIDogc2VsLmdldElk\nZW50aWZpZXJBbGlhc2VzKCk7CiAgICAgICAgICAgIGlmIChhbGlhc2VzLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgi\nQ09VTlQoKikiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0b1NlbGVjdChz\nZWxlY3RTUUwsIG51bGwsIGZyb20sIHdoZXJlLCBudWxsLCBudWxsLCBudWxs\nLAogICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgMCwgTG9uZy5N\nQVhfVkFMVUUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB0\naGVyZSBpcyBhIHNpbmdsZSBkaXN0aW5jdCBjb2wsIHVzZSBDT1VOVChESVNU\nSU5DVCBjb2wpCiAgICAgICAgICAgIGlmIChhbGlhc2VzLnNpemUoKSA9PSAx\nKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCJDT1VOVChE\nSVNUSU5DVCAiKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoYWxpYXNl\ncy5nZXQoMCkudG9TdHJpbmcoKSkuYXBwZW5kKCIpIik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9tLCB3\naGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBm\nYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gY2FuIHdlIGNvbWJpbmUgZGlzdGluY3QgY29s\ncz8KICAgICAgICAgICAgaWYgKGRpc3RpbmN0Q291bnRDb2x1bW5TZXBhcmF0\nb3IgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVu\nZCgiQ09VTlQoRElTVElOQ1QgIik7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgc2VsZWN0U1FMLmFwcGVuZCgiICIpOwogICAgICAgICAgICAgICAgICAg\nICAgICBzZWxlY3RTUUwuYXBwZW5kKGRpc3RpbmN0Q291bnRDb2x1bW5TZXBh\ncmF0b3IpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBw\nZW5kKCIgIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoYWxpYXNlcy5nZXQoaSkudG9TdHJp\nbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxl\nY3RTUUwuYXBwZW5kKCIpIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdG9T\nZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9tLCB3aGVyZSwgbnVsbCwgbnVs\nbCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIDAs\nIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gc2luY2Ugd2UgY2FuJ3QgY29tYmluZSBkaXN0aW5jdCBjb2xz\nLCB3ZSBoYXZlIHRvIHBlcmZvcm0gYW4gb3V0ZXIKICAgICAgICAvLyBDT1VO\nVCgqKSBzZWxlY3QgdXNpbmcgdGhlIG9yaWdpbmFsIHNlbGVjdCBhcyBhIHN1\nYnNlbGVjdCBpbiB0aGUKICAgICAgICAvLyBGUk9NIGNsYXVzZQogICAgICAg\nIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNTdWJzZWxlY3QsICJTdXBwb3J0c1N1\nYnNlbGVjdCIpOwoKICAgICAgICBTUUxCdWZmZXIgc3ViU2VsZWN0ID0gZ2V0\nU2VsZWN0cyhzZWwsIHRydWUsIGZhbHNlKTsKICAgICAgICBTUUxCdWZmZXIg\nc3ViRnJvbSA9IGZyb207CiAgICAgICAgZnJvbSA9IG5ldyBTUUxCdWZmZXIo\ndGhpcyk7CiAgICAgICAgZnJvbS5hcHBlbmQoIigiKTsKICAgICAgICBmcm9t\nLmFwcGVuZCh0b1NlbGVjdChzdWJTZWxlY3QsIG51bGwsIHN1YkZyb20sIHdo\nZXJlLAogICAgICAgICAgICBzZWwuZ2V0R3JvdXBpbmcoKSwgc2VsLmdldEhh\ndmluZygpLCBudWxsLCBzZWwuaXNEaXN0aW5jdCgpLAogICAgICAgICAgICBm\nYWxzZSwgc2VsLmdldFN0YXJ0SW5kZXgoKSwgc2VsLmdldEVuZEluZGV4KCks\nIHRydWUpKTsKICAgICAgICBmcm9tLmFwcGVuZCgiKSIpOwogICAgICAgIGlm\nIChyZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAgICAgICAgICBmcm9t\nLmFwcGVuZCgiICIpLmFwcGVuZChTZWxlY3QuRlJPTV9TRUxFQ1RfQUxJQVMp\nOwoKICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCJDT1VOVCgqKSIpOwogICAg\nICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIG51\nbGwsIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAgICAgIGZhbHNlLCBmYWxz\nZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgREVMRVRFIHN0YXRlbWVudCBmb3IgdGhlIHNwZWNpZmllZCBT\nZWxlY3QuIElmIHRoZQogICAgICogZGF0YWJhc2UgZG9lcyBub3Qgc3VwcG9y\ndCB0aGUgYnVsayBkZWxldGUgc3RhdGVtZW50IChzdWNoIGFzCiAgICAgKiBj\nYXNlcyB3aGVyZSBhIHN1YnNlbGVjdCBpcyByZXF1aXJlZCBhbmQgdGhlIGRh\ndGFiYXNlIGRvZXNuJ3Qgc3VwcG9ydAogICAgICogc3Vic2VsZWN0cyksIHRo\naXMgbWV0aG9kIHNob3VsZCByZXR1cm4gbnVsbC4KICAgICAqLwogICAgcHVi\nbGljIFNRTEJ1ZmZlciB0b0RlbGV0ZShDbGFzc01hcHBpbmcgbWFwcGluZywg\nU2VsZWN0IHNlbCwgCiAgICAgICAgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAg\nICAgcmV0dXJuIHRvQnVsa09wZXJhdGlvbihtYXBwaW5nLCBzZWwsIG51bGws\nIHBhcmFtcywgbnVsbCk7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0\nb1VwZGF0ZShDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0IHNlbCwKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUsIE9iamVjdFtdIHBhcmFtcywgTWFwIHVw\nZGF0ZXMpIHsKICAgICAgICByZXR1cm4gdG9CdWxrT3BlcmF0aW9uKG1hcHBp\nbmcsIHNlbCwgc3RvcmUsIHBhcmFtcywgdXBkYXRlcyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBTUUwgZm9yIGEgYnVsayBvcGVyYXRp\nb24sIGVpdGhlciBhIERFTEVURSBvciBhbiBVUERBVEUuCiAgICAgKgogICAg\nICogQHBhcmFtIG1hcHBpbmcgdGhlIG1hcHBuZyBhZ2FpbnN0IHdoaWNoIHdl\nIGFyZSBvcGVyYXRpbmcKICAgICAqIEBwYXJhbSBzZWwgdGhlIFNlbGVjdCB0\naGF0IHdpbGwgY29uc3RpdHV0ZSB0aGUgV0hFUkUgY2xhdXNlCiAgICAgKiBA\ncGFyYW0gc3RvcmUgdGhlIGN1cnJlbnQgc3RvcmUKICAgICAqIEBwYXJhbSB1\ncGRhdGVQYXJhbXMgdGhlIE1hcCB0aGF0IGhvbGRzIHRoZSB1cGRhdGUgcGFy\nYW1ldGVyczsgYSBudWxsCiAgICAgKiB2YWx1ZSBpbmRpY2F0ZXMgdGhhdCB0\naGlzIGlzIGEgZGVsZXRlIG9wZXJhdGlvbgogICAgICogQHJldHVybiB0aGUg\nU1FMQnVmZmVyIGZvciB0aGUgdXBkYXRlLCBvciA8ZW0+bnVsbDwvZW0+IGlm\nIGl0IGlzIG5vdAogICAgICogcG9zc2libGUgdG8gcGVyZm9ybSB0aGUgYnVs\nayB1cGRhdGUKICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciB0b0J1\nbGtPcGVyYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFNlbGVjdCBzZWws\nCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMsIE1h\ncCB1cGRhdGVQYXJhbXMpIHsKICAgICAgICBTUUxCdWZmZXIgc3FsID0gbmV3\nIFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpZiAodXBkYXRlUGFyYW1zID09\nIG51bGwpIHsKICAgICAgICAgIGlmIChyZXF1aXJlc1RhcmdldEZvckRlbGV0\nZSkgewogICAgICAgICAgICBzcWwuYXBwZW5kKCJERUxFVEUgIik7CiAgICAg\nICAgICAgIFNRTEJ1ZmZlciBkZWxldGVUYXJnZXRzID0gZ2V0RGVsZXRlVGFy\nZ2V0cyhzZWwpOwogICAgICAgICAgICBzcWwuYXBwZW5kKGRlbGV0ZVRhcmdl\ndHMpOwogICAgICAgICAgICBzcWwuYXBwZW5kKCIgRlJPTSAiKTsKICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNxbC5hcHBlbmQoIkRFTEVURSBG\nUk9NICIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHNxbC5hcHBlbmQoIlVQREFURSAiKTsKICAgICAgICBzZWwu\nYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygpOwoKICAgICAgICAvLyBpZiB0aGVy\nZSBpcyBvbmx5IGEgc2luZ2xlIHRhYmxlIGluIHRoZSBzZWxlY3QsIHRoZW4g\nd2UgY2FuCiAgICAgICAgLy8ganVzdCBpc3N1ZSBhIHNpbmdsZSBERUxFVEUg\nRlJPTSBUQUJMRSBXSEVSRSA8Y29uZGl0aW9ucz4KICAgICAgICAvLyBzdGF0\nZW1lbnQ7IG90aGVyd2lzZSwgc2luY2UgU1FMIGRvZXNuJ3QgYWxsb3cgZGVs\nZXRpbmcKICAgICAgICAvLyBmcm9tIG9uZSBvZiBhIG11bHRpLXRhYmxlIHNl\nbGVjdCwgd2UgbmVlZCB0byBpc3N1ZSBhIHN1YnNlbGVjdAogICAgICAgIC8v\nIGxpa2UgREVMRVRFIEZST00gVEFCTEUgV0hFUkUgRVhJU1RTCiAgICAgICAg\nLy8gKFNFTEVDVCAxIEZST00gVEFCTEUgdDAgV0hFUkUgdDAuSUQgPSBUQUJM\nRS5JRCk7IGFsc28sIHNvbWUKICAgICAgICAvLyBkYXRhYmFzZXMgZG8gbm90\nIGFsbG93IGFsaWFzZXMgaW4gZGVsZXRlIHN0YXRlbWVudHMsIHdoaWNoCiAg\nICAgICAgLy8gYWxzbyBjYXVzZXMgdXMgdG8gdXNlIGEgc3Vic2VsZWN0CiAg\nICAgICAgaWYgKHNlbC5nZXRUYWJsZUFsaWFzZXMoKS5zaXplKCkgPT0gMSAm\nJiBzdXBwb3J0c1N1YnNlbGVjdAogICAgICAgICAgICAmJiBhbGxvd3NBbGlh\nc0luQnVsa0NsYXVzZSkgewogICAgICAgICAgICBTUUxCdWZmZXIgZnJvbTsK\nICAgICAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tU2VsZWN0KHNlbCwgZmFs\nc2UpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBmcm9tID0g\nZ2V0RnJvbShzZWwsIGZhbHNlKTsKCiAgICAgICAgICAgIHNxbC5hcHBlbmQo\nZnJvbSk7CiAgICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwg\nc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywKICAgICAgICAgICAgICAgIGFs\nbG93c0FsaWFzSW5CdWxrQ2xhdXNlKTsKCiAgICAgICAgICAgIFNRTEJ1ZmZl\nciB3aGVyZSA9IHNlbC5nZXRXaGVyZSgpOwogICAgICAgICAgICBpZiAod2hl\ncmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAg\nICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgIik7CiAgICAgICAgICAgICAgICBz\ncWwuYXBwZW5kKHdoZXJlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gc3FsOwogICAgICAgIH0KCiAgICAgICAgVGFibGUgdGFibGUgPSBt\nYXBwaW5nLmdldFRhYmxlKCk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSA9\nIGdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSk7CgogICAgICAgIC8vIG9ubHkg\ndXNlIGEgIHN1YnNlbGVjdCBpZiB0aGUgd2hlcmUgaXMgbm90IGVtcHR5OyBv\ndGhlcndpc2UKICAgICAgICAvLyBhbiB1bnF1YWxpZmllZCBkZWxldGUgb3Ig\ndXBkYXRlIHdpbGwgd29yawogICAgICAgIGlmIChzZWwuZ2V0V2hlcmUoKSA9\nPSBudWxsIHx8IHNlbC5nZXRXaGVyZSgpLmlzRW1wdHkoKSkgewogICAgICAg\nICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFwcGVu\nZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFt\ncywgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gc3FsOwogICAgICAgIH0K\nCiAgICAgICAgLy8gd2UgbmVlZCB0byB1c2UgYSBzdWJzZWxlY3QgaWYgd2Ug\nYXJlIHRvIGJ1bGsgZGVsZXRlIHdoZXJlCiAgICAgICAgLy8gdGhlIHNlbGVj\ndCBpbmNsdWRlcyBtdWx0aXBsZSB0YWJsZXM7IGlmIHRoZSBkYXRhYmFzZQog\nICAgICAgIC8vIGRvZXNuJ3Qgc3VwcG9ydCBpdCwgdGhlbiB3ZSBuZWVkIHRv\nIHNpZ2FsIHRoaXMgYnkgcmV0dXJuaW5nIG51bGwKICAgICAgICBpZiAoIXN1\ncHBvcnRzU3Vic2VsZWN0IHx8ICFzdXBwb3J0c0NvcnJlbGF0ZWRTdWJzZWxl\nY3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1bW5b\nXSBwa3MgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAg\nICAgc2VsLmNsZWFyU2VsZWN0cygpOwogICAgICAgIHNlbC5zZXREaXN0aW5j\ndCh0cnVlKTsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBvbmx5IGEgc2luZ2xl\nIFBLLCB3ZSBjYW4gdXNlIGEgbm9uLWNvcnJlbGF0ZWQKICAgICAgICAvLyBz\ndWJxdWVyeSAodXNpbmcgYW4gSU4gc3RhdGVtZW50KSwgd2hpY2ggaXMgbXVj\naCBmYXN0ZXIgdGhhbgogICAgICAgIC8vIGEgY29ycmVsYXRlZCBzdWJxdWVy\neSAoc2luY2UgYSBjb3JyZWxhdGVkIHN1YnF1ZXJ5IG5lZWRzCiAgICAgICAg\nLy8gdG8gYmUgZXhlY3V0ZWQgb25jZSBmb3IgZWFjaCByb3cgaW4gdGhlIHRh\nYmxlKQogICAgICAgIGlmIChwa3MubGVuZ3RoID09IDEpIHsKICAgICAgICAg\nICAgc2VsLnNlbGVjdChwa3NbMF0pOwogICAgICAgICAgICBzcWwuYXBwZW5k\nKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2VsLCBz\ndG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywgZmFsc2UpOwogICAg\nICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgIikuCiAgICAgICAgICAgICAg\nICBhcHBlbmQocGtzWzBdKS5hcHBlbmQoIiBJTiAoIikuCiAgICAgICAgICAg\nICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBudWxsKSkuYXBwZW5k\nKCIpIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsLmNsZWFy\nU2VsZWN0cygpOwogICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFsc2Up\nOwoKICAgICAgICAgICAgLy8gc2luY2UgdGhlIHNlbGVjdCBpcyB1c2luZyBh\nIGNvcnJlbGF0ZWQgc3VicXVlcnksIHdlCiAgICAgICAgICAgIC8vIG9ubHkg\nbmVlZCB0byBzZWxlY3QgYSBib2d1cyB2aXJ0dWFsIGNvbHVtbgogICAgICAg\nICAgICBzZWwuc2VsZWN0KCIxIiwgbnVsbCk7CgogICAgICAgICAgICAvLyBh\nZGQgaW4gdGhlIGpvaW5zIHRvIHRoZSB0YWJsZQogICAgICAgICAgICBDb2x1\nbW5bXSBjb2xzID0gdGFibGUuZ2V0UHJpbWFyeUtleSgpLmdldENvbHVtbnMo\nKTsKICAgICAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIo\ndGhpcyk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIigiKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEFORCAiKTsKCiAgICAgICAgICAgICAgICAvLyBhZGQg\naW4gInQwLlBLID0gTVlUQUJMRS5QSyIKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbaV0sIG51bGwpKS5hcHBl\nbmQoIiA9ICIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZCh0YWJsZSku\nYXBwZW5kKGNhdGFsb2dTZXBhcmF0b3IpLmFwcGVuZChjb2xzW2ldKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAg\nICAgICAgIHNlbC53aGVyZShidWYsIG51bGwpOwoKICAgICAgICAgICAgc3Fs\nLmFwcGVuZCh0YWJsZU5hbWUpOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVz\nKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNl\nKTsKICAgICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFIEVYSVNUUyAoIiku\nCiAgICAgICAgICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBu\ndWxsKSkuYXBwZW5kKCIpIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBz\ncWw7CiAgICB9CgogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXREZWxldGVU\nYXJnZXRzKFNlbGVjdCBzZWwpIHsKICAgICAgU1FMQnVmZmVyIGRlbGV0ZVRh\ncmdldHMgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICBDb2xsZWN0aW9u\nIGFsaWFzZXMgPSBzZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAgICAgIC8vIEFz\nc3VtZXMgYWxpYXNlcyBhcmUgb2YgdGhlIGZvcm0gIlRBQkxFTkFNRSB0MCIK\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhbGlhc2VzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgU3RyaW5nIHRhYmxlQWxpYXMg\nPSBpdHIubmV4dCgpLnRvU3RyaW5nKCk7CiAgICAgICAgaW50IHNwYWNlSW5k\nZXggPSB0YWJsZUFsaWFzLmluZGV4T2YoJyAnKTsKICAgICAgICBpZiAoc3Bh\nY2VJbmRleCA+IDAgJiYgc3BhY2VJbmRleCA8IHRhYmxlQWxpYXMubGVuZ3Ro\nKCkgLSAxKSB7CiAgICAgICAgICBpZiAoYWxsb3dzQWxpYXNJbkJ1bGtDbGF1\nc2UpIHsKICAgICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBlbmQodGFibGVB\nbGlhcy5zdWJzdHJpbmcoc3BhY2VJbmRleCArIDEpKTsKICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIGRlbGV0ZVRhcmdldHMuYXBwZW5kKHRhYmxl\nQWxpYXMuc3Vic3RyaW5nKDAsIHNwYWNlSW5kZXgpKTsKICAgICAgICAgIH0K\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBl\nbmQodGFibGVBbGlhcyk7CiAgICAgICAgfQogICAgICAgIGlmIChpdHIuaGFz\nTmV4dCgpKQogICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBlbmQoIiwgIik7\nCiAgICAgIH0gICAgICAKICAgICAgcmV0dXJuIGRlbGV0ZVRhcmdldHM7ICAg\nICAgCiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kVXBkYXRlcyhT\nZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUsIFNRTEJ1ZmZlciBzcWwsCiAg\nICAgICAgT2JqZWN0W10gcGFyYW1zLCBNYXAgdXBkYXRlUGFyYW1zLCBib29s\nZWFuIGFsbG93QWxpYXMpIHsKICAgICAgICBpZiAodXBkYXRlUGFyYW1zID09\nIG51bGwgfHwgdXBkYXRlUGFyYW1zLnNpemUoKSA9PSAwKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIC8vIG1hbnVhbGx5IGJ1aWxkIHVwIHRoZSBT\nRVQgY2xhdXNlIGZvciB0aGUgVVBEQVRFIHN0YXRlbWVudAogICAgICAgIHNx\nbC5hcHBlbmQoIiBTRVQgIik7CiAgICAgICAgRXhwQ29udGV4dCBjdHggPSBu\nZXcgRXhwQ29udGV4dChzdG9yZSwgcGFyYW1zLCAKICAgICAgICAgICAgc3Rv\ncmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkpOwoKICAgICAgICAvLyBJZiB0\naGUgdXBkYXRlcyBtYXAgY29udGFpbnMgYW55IHZlcnNpb24gZmllbGRzLCBh\nc3N1bWUgdGhhdCB0aGUKICAgICAgICAvLyBvcHRpbWlzdGljIGxvY2sgdmVy\nc2lvbiBkYXRhIGlzIGJlaW5nIGhhbmRsZWQgcHJvcGVybHkgYnkgdGhlCiAg\nICAgICAgLy8gY2FsbGVyLiBPdGhlcndpc2UsIGdpdmUgdGhlIHZlcnNpb24g\naW5kaWNhdG9yIGFuIG9wcG9ydHVuaXR5IHRvCiAgICAgICAgLy8gYWRkIG1v\ncmUgdXBkYXRlIGNsYXVzZXMgYXMgbmVlZGVkLgogICAgICAgIGJvb2xlYW4g\nYXVnbWVudFVwZGF0ZXMgPSB0cnVlOwoKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGkgPSB1cGRhdGVQYXJhbXMuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IG5leHQgPSAoTWFw\nLkVudHJ5KSBpLm5leHQoKTsKICAgICAgICAgICAgUGF0aCBwYXRoID0gKFBh\ndGgpIG5leHQuZ2V0S2V5KCk7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBm\nbWQgPSAoRmllbGRNYXBwaW5nKSBwYXRoLmxhc3QoKTsKCiAgICAgICAgICAg\nIGlmIChmbWQuaXNWZXJzaW9uKCkpCiAgICAgICAgICAgICAgICBhdWdtZW50\nVXBkYXRlcyA9IGZhbHNlOwoKICAgICAgICAgICAgVmFsIHZhbCA9IChWYWwp\nIG5leHQuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKHZhbCA9PSBudWxs\nKQogICAgICAgICAgICAJdmFsID0gbmV3IE51bGwoKTsKICAgICAgICAgICAg\nQ29sdW1uIGNvbCA9IGZtZC5nZXRDb2x1bW5zKClbMF07CiAgICAgICAgICAg\nIGlmIChhbGxvd0FsaWFzKSB7CiAgICAgICAgICAgICAgc3FsLmFwcGVuZChz\nZWwuZ2V0Q29sdW1uQWxpYXMoY29sKSk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgc3FsLmFwcGVuZChjb2wuZ2V0TmFtZSgpKTsgIAog\nICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoIiA9ICIpOwoKICAgICAgICAgICAgRXhwU3RhdGUgc3RhdGUgPSB2YWwu\naW5pdGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAgICAgICAgICAgIC8vIEpEQkMg\nUGF0aHMgYXJlIGFsd2F5cyBQQ1BhdGhzOyBQQ1BhdGggaW1wbGVtZW50cyBW\nYWwKICAgICAgICAgICAgRXhwU3RhdGUgcGF0aFN0YXRlID0gKChWYWwpIHBh\ndGgpLmluaXRpYWxpemUoc2VsLCBjdHgsIDApOwogICAgICAgICAgICBjYWxj\ndWxhdGVWYWx1ZSh2YWwsIHNlbCwgY3R4LCBzdGF0ZSwgcGF0aCwgcGF0aFN0\nYXRlKTsKCiAgICAgICAgICAgIC8vIGFwcGVuZCB0aGUgdmFsdWUgd2l0aCBh\nIG51bGwgZm9yIHRoZSBTZWxlY3Q7IGkKICAgICAgICAgICAgLy8gaW5kaWNh\ndGVzIHRoYXQgdGhlCiAgICAgICAgICAgIGludCBsZW5ndGggPSB2YWwubGVu\nZ3RoKHNlbCwgY3R4LCBzdGF0ZSk7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgbGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAgICB2YWwuYXBw\nZW5kVG8oKGFsbG93QWxpYXMpID8gc2VsIDogbnVsbCwgY3R4LCBzdGF0ZSwg\nc3FsLCBqKTsKCiAgICAgICAgICAgIGlmIChpLmhhc05leHQoKSkKICAgICAg\nICAgICAgICAgIHNxbC5hcHBlbmQoIiwgIik7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoYXVnbWVudFVwZGF0ZXMpIHsKICAgICAgICAgICAgUGF0aCBwYXRo\nID0gKFBhdGgpIHVwZGF0ZVBhcmFtcy5rZXlTZXQoKS5pdGVyYXRvcigpLm5l\neHQoKTsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFw\ncGluZykgcGF0aC5sYXN0KCk7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyBt\nZXRhID0gZm0uZ2V0RGVjbGFyaW5nTWFwcGluZygpOwogICAgICAgICAgICBN\nYXAgdXBkYXRlcyA9IG1ldGEuZ2V0VmVyc2lvbigpLmdldEJ1bGtVcGRhdGVW\nYWx1ZXMoKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0gdXBk\nYXRlcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICBp\ndGVyLmhhc05leHQoKTsgKSB7CiAgICAgICAgICAgICAgICBNYXAuRW50cnkg\nZSA9IChNYXAuRW50cnkpIGl0ZXIubmV4dCgpOwogICAgICAgICAgICAgICAg\nQ29sdW1uIGNvbCA9IChDb2x1bW4pIGUuZ2V0S2V5KCk7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgdmFsID0gKFN0cmluZykgZS5nZXRWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgc3FsLmFwcGVuZCgiLCAiKS5hcHBlbmQoY29sLmdldE5h\nbWUoKSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCIgPSAiKS5hcHBl\nbmQodmFsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBDcmVhdGUgU1FMIHRvIGRlbGV0ZSB0aGUgY29udGVu\ndHMgb2YgdGhlIHNwZWNpZmllZCB0YWJsZXMuIAogICAgICogVGhlIGRlZmF1\nbHQgaW1wbGVtZW50YXRpb24gZHJvcHMgYWxsIG5vbi1kZWZlcnJlZCBSRVNU\nUklDVCBmb3JlaWduIGtleSAKICAgICAqIGNvbnN0cmFpbnRzIGludm9sdmlu\nZyB0aGUgc3BlY2lmaWVkIHRhYmxlcywgaXNzdWVzIERFTEVURSBzdGF0ZW1l\nbnRzIAogICAgICogYWdhaW5zdCB0aGUgdGFibGVzLCBhbmQgdGhlbiBhZGRz\nIHRoZSBkcm9wcGVkIGNvbnN0cmFpbnRzIGJhY2sgaW4uIAogICAgICogRGF0\nYWJhc2VzIHdpdGggbW9yZSBvcHRpbWFsIHdheXMgb2YgZGVsZXRpbmcgdGhl\nIGNvbnRlbnRzIG9mIHNldmVyYWwgCiAgICAgKiB0YWJsZXMgc2hvdWxkIG92\nZXJyaWRlIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nW10gZ2V0RGVsZXRlVGFibGVDb250ZW50c1NRTChUYWJsZVtdIHRhYmxlcykg\newogICAgICAgIENvbGxlY3Rpb24gc3FsID0gbmV3IEFycmF5TGlzdCgpOwog\nICAgICAgIAogICAgICAgIC8vIGNvbGxlY3QgYW5kIGRyb3Agbm9uLWRlZmVy\ncmVkIHBoeXNpY2FsIHJlc3RyaWN0IGNvbnN0cmFpbnRzLCBhbmQKICAgICAg\nICAvLyBjb2xsZWN0IHRoZSBERUxFVEUgRlJPTSBzdGF0ZW1lbnRzCiAgICAg\nICAgQ29sbGVjdGlvbiBkZWxldGVTUUwgPSBuZXcgQXJyYXlMaXN0KHRhYmxl\ncy5sZW5ndGgpOwogICAgICAgIENvbGxlY3Rpb24gcmVzdHJpY3RDb25zdHJh\naW50cyA9IG5ldyBMaW5rZWRIYXNoU2V0KCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCB0YWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlc1tpXS5nZXRGb3JlaWduS2V5cygp\nOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGZrcy5sZW5ndGg7\nIGorKykgewogICAgICAgICAgICAgICAgaWYgKCFma3Nbal0uaXNMb2dpY2Fs\nKCkgJiYgIWZrc1tqXS5pc0RlZmVycmVkKCkgCiAgICAgICAgICAgICAgICAg\nICAgJiYgZmtzW2pdLmdldERlbGV0ZUFjdGlvbigpID09IEZvcmVpZ25LZXku\nQUNUSU9OX1JFU1RSSUNUKQogICAgICAgICAgICAgICAgcmVzdHJpY3RDb25z\ndHJhaW50cy5hZGQoZmtzW2pdKTsKICAgICAgICAgICAgICAgIFN0cmluZ1td\nIGNvbnN0cmFpbnRTUUwgPSBnZXREcm9wRm9yZWlnbktleVNRTChma3Nbal0p\nOwogICAgICAgICAgICAgICAgc3FsLmFkZEFsbChBcnJheXMuYXNMaXN0KGNv\nbnN0cmFpbnRTUUwpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAg\nICAgICAgICAgZGVsZXRlU1FMLmFkZCgiREVMRVRFIEZST00gIiArIHRhYmxl\nc1tpXS5nZXRGdWxsTmFtZSgpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgLy8gYWRkIHRoZSBkZWxldGUgc3RhdGVtZW50cyBhZnRlciBhbGwgdGhl\nIGNvbnN0cmFpbnQgbXV0YXRpb25zCiAgICAgICAgc3FsLmFkZEFsbChkZWxl\ndGVTUUwpOwogICAgICAgIAogICAgICAgIC8vIGFkZCB0aGUgZGVsZXRlZCBj\nb25zdHJhaW50cyBiYWNrIHRvIHRoZSBzY2hlbWEKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ZXIgPSByZXN0cmljdENvbnN0cmFpbnRzLml0ZXJhdG9yKCk7\nIGl0ZXIuaGFzTmV4dCgpOyApIHsKICAgICAgICAgICAgU3RyaW5nW10gY29u\nc3RyYWludFNRTCA9IAogICAgICAgICAgICAgICAgZ2V0QWRkRm9yZWlnbktl\neVNRTCgoRm9yZWlnbktleSkgaXRlci5uZXh0KCkpOwogICAgICAgICAgICBz\ncWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29uc3RyYWludFNRTCkpOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gKFN0cmluZ1tdKSBzcWwu\ndG9BcnJheShuZXcgU3RyaW5nW3NxbC5zaXplKCldKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIFNFTEVDVCBzdGF0ZW1lbnQgaW4gdGhlIHBy\nb3BlciBqb2luIHN5bnRheCBmb3IgdGhlIGdpdmVuCiAgICAgKiBpbnN0YW5j\nZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdChTZWxl\nY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSwKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgc2VsLmFkZEpvaW5DbGFz\nc0NvbmRpdGlvbnMoKTsKICAgICAgICBib29sZWFuIHVwZGF0ZSA9IGZvclVw\nZGF0ZSAmJiBzZWwuZ2V0RnJvbVNlbGVjdCgpID09IG51bGw7CiAgICAgICAg\nU1FMQnVmZmVyIHNlbGVjdCA9IGdldFNlbGVjdHMoc2VsLCBmYWxzZSwgdXBk\nYXRlKTsKICAgICAgICBTUUxCdWZmZXIgb3JkZXJpbmcgPSBudWxsOwogICAg\nICAgIGlmICghc2VsLmlzQWdncmVnYXRlKCkgfHwgc2VsLmdldEdyb3VwaW5n\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgb3JkZXJpbmcgPSBzZWwuZ2V0T3Jk\nZXJpbmcoKTsKICAgICAgICBTUUxCdWZmZXIgZnJvbTsKICAgICAgICBpZiAo\nc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxsKQogICAgICAgICAgICBmcm9t\nID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZvclVwZGF0ZSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBmcm9tID0gZ2V0RnJvbShzZWwsIHVwZGF0ZSk7CiAg\nICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0V2hlcmUoc2VsLCB1cGRhdGUp\nOwogICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3QsIGZldGNoLCBmcm9t\nLCB3aGVyZSwgc2VsLmdldEdyb3VwaW5nKCksCiAgICAgICAgICAgIHNlbC5n\nZXRIYXZpbmcoKSwgb3JkZXJpbmcsIHNlbC5pc0Rpc3RpbmN0KCksIGZvclVw\nZGF0ZSwKICAgICAgICAgICAgc2VsLmdldFN0YXJ0SW5kZXgoKSwgc2VsLmdl\ndEVuZEluZGV4KCksIHNlbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1lbnQgYmV0d2Vl\nbiB0aGUgRlJPTSBrZXl3b3JkCiAgICAgKiBhbmQgdGhlIFdIRVJFIGtleXdv\ncmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgZ2V0RnJvbShT\nZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIFNRTEJ1\nZmZlciBmcm9tU1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBD\nb2xsZWN0aW9uIGFsaWFzZXMgPSBzZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAg\nICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpIDwgMiB8fCBzZWwuZ2V0Sm9pblN5\nbnRheCgpICE9IFNZTlRBWF9TUUw5MikgewogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IGFsaWFzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGZyb21TUUwuYXBwZW5kKGl0ci5uZXh0\nKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICBpZiAoZm9yVXBkYXRl\nICYmIHRhYmxlRm9yVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JV\ncGRhdGVDbGF1c2UpOwogICAgICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0\nKCkpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiwgIik7\nCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBJ\ndGVyYXRvciBpdHIgPSBzZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAgICAgICAg\nICAgIGJvb2xlYW4gZmlyc3QgPSB0cnVlOwogICAgICAgICAgICB3aGlsZSAo\naXRyLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBl\nbmQodG9TUUw5MkpvaW4oKEpvaW4pIGl0ci5uZXh0KCksIGZvclVwZGF0ZSwK\nICAgICAgICAgICAgICAgICAgICBmaXJzdCkpOwogICAgICAgICAgICAgICAg\nZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgRlJPTSBjbGF1c2UgZm9yIGEgc2VsZWN0IHRoYXQgc2VsZWN0cyBm\ncm9tIGEgdG1wIHRhYmxlCiAgICAgKiBjcmVhdGVkIGJ5IGFuIGlubmVyIHNl\nbGVjdC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRGcm9t\nU2VsZWN0KFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAg\nICAgU1FMQnVmZmVyIGZyb21TUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwog\nICAgICAgIGZyb21TUUwuYXBwZW5kKCIoIik7CiAgICAgICAgZnJvbVNRTC5h\ncHBlbmQodG9TZWxlY3Qoc2VsLmdldEZyb21TZWxlY3QoKSwgZm9yVXBkYXRl\nLCBudWxsKSk7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQoIikiKTsKICAgICAg\nICBpZiAocmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAg\nZnJvbVNRTC5hcHBlbmQoIiAiKS5hcHBlbmQoU2VsZWN0LkZST01fU0VMRUNU\nX0FMSUFTKTsKICAgICAgICByZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgV0hFUkUgcG9ydGlvbiBvZiB0aGUgc2Vs\nZWN0IHN0YXRlbWVudCwgb3IgbnVsbCBpZiBubyB3aGVyZQogICAgICogY29u\nZGl0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRX\naGVyZShTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAg\nIEpvaW5zIGpvaW5zID0gc2VsLmdldEpvaW5zKCk7CiAgICAgICAgaWYgKHNl\nbC5nZXRKb2luU3ludGF4KCkgPT0gU1lOVEFYX1NRTDkyCiAgICAgICAgICAg\nIHx8IGpvaW5zID09IG51bGwgfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gc2VsLmdldFdoZXJlKCk7CgogICAgICAgIFNRTEJ1ZmZl\nciB3aGVyZSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKHNl\nbC5nZXRXaGVyZSgpICE9IG51bGwpCiAgICAgICAgICAgIHdoZXJlLmFwcGVu\nZChzZWwuZ2V0V2hlcmUoKSk7CiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwp\nCiAgICAgICAgICAgIHNlbC5hcHBlbmQod2hlcmUsIGpvaW5zKTsKICAgICAg\nICByZXR1cm4gd2hlcmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhl\nIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0\ncyB0YWJsZXMgaW4KICAgICAqIHRoZSB0cmFkaXRpb25hbCBzdHlsZS4KICAg\nICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1RyYWRpdGlvbmFsSm9pbihK\nb2luIGpvaW4pIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0gam9pbi5nZXRG\nb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGludmVyc2UgPSBq\nb2luLmlzRm9yZWlnbktleUludmVyc2VkKCk7CiAgICAgICAgQ29sdW1uW10g\nZnJvbSA9IChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkK\nICAgICAgICAgICAgOiBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1u\nW10gdG8gPSAoaW52ZXJzZSkgPyBmay5nZXRDb2x1bW5zKCkKICAgICAgICAg\nICAgOiBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAgICAgICAvLyBk\nbyBjb2x1bW4gam9pbnMKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNR\nTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbS5sZW5ndGg7IGkrKywgY291bnQr\nKykgewogICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVu\nZChqb2luLmdldEFsaWFzMSgpKS5hcHBlbmQoIi4iKS5hcHBlbmQoZnJvbVtp\nXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLmFw\ncGVuZCh0b1tpXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBkbyBjb25zdGFu\ndCBqb2lucwogICAgICAgIENvbHVtbltdIGNvbnN0Q29scyA9IGZrLmdldENv\nbnN0YW50Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY29uc3RDb2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAg\nIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIg\nQU5EICIpOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmRWYWx1ZShmay5nZXRDb25zdGFudChjb25zdENvbHNb\naV0pLCBjb25zdENvbHNbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgi\nLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0p\nOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAg\nIGlmIChpbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChqb2lu\nLmdldEFsaWFzMigpKS5hcHBlbmQoIi4iKS4KICAgICAgICAgICAgICAgICAg\nICBhcHBlbmQoY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldENvbnN0YW50KGNv\nbnN0Q29sc1tpXSksIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgfQoKICAgICAg\nICBDb2x1bW5bXSBjb25zdENvbHNQSyA9IGZrLmdldENvbnN0YW50UHJpbWFy\neUtleUNvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNv\nbnN0Q29sc1BLLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAg\nIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIg\nQU5EICIpOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIiku\nCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGNvbnN0Q29sc1BLW2ldKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZh\nbHVlKGZrLmdldFByaW1hcnlLZXlDb25zdGFudChjb25zdENvbHNQS1tpXSks\nCiAgICAgICAgICAgICAgICAgICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZl\ncnNlKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFBy\naW1hcnlLZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAgICAgICAgICAg\nICAgICAgICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFw\ncGVuZCgiLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25zdENv\nbHNQS1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWY7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2Ug\ndG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRo\nZSBTUUw5MiBzdHlsZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0\nb1NRTDkySm9pbihKb2luIGpvaW4sIGJvb2xlYW4gZm9yVXBkYXRlLCBib29s\nZWFuIGZpcnN0KSB7CiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxC\ndWZmZXIodGhpcyk7CiAgICAgICAgaWYgKGZpcnN0KSB7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoam9pbi5nZXRUYWJsZTEoKSkuYXBwZW5kKCIgIikuCiAg\nICAgICAgICAgICAgICBhcHBlbmQoam9pbi5nZXRBbGlhczEoKSk7CiAgICAg\nICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2Ug\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBl\nbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAgICAgIH0KCiAgICAgICAg\nYnVmLmFwcGVuZCgiICIpOwogICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9\nPSBKb2luLlRZUEVfT1VURVIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQob3V0\nZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNlIGlmIChqb2luLmdldFR5cGUo\nKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\naW5uZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNlIC8vIGNyb3NzCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoY3Jvc3NKb2luQ2xhdXNlKTsKICAgICAgICBi\ndWYuYXBwZW5kKCIgIik7CgogICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRU\nYWJsZTIoKSkuYXBwZW5kKCIgIikuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkp\nOwogICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1\nc2UgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVu\nZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CgogICAgICAgIGlmIChqb2luLmdl\ndEZvcmVpZ25LZXkoKSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgT04gIikuYXBwZW5kKHRvVHJhZGl0aW9uYWxKb2luKGpvaW4pKTsKICAg\nICAgICBlbHNlIGlmIChyZXF1aXJlc0NvbmRpdGlvbkZvckNyb3NzSm9pbiAm\nJgogICAgICAgICAgICBqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfQ1JP\nU1MpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiAoMSA9IDEpIik7Cgog\nICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2Ug\ndGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5n\nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSBkYXRhYmFzZSdzIG5hdGl2ZSBz\neW50YXguIFRocm93cyBhbiBleGNlcHRpb24gYnkgZGVmYXVsdC4KICAgICAq\nLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b05hdGl2ZUpvaW4oSm9pbiBqb2lu\nKSB7CiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGlmIHRoZSBnaXZlbiBm\nb3JlaWduIGtleSBjYW4gYmUgZWFnZXJseSBsb2FkZWQgdXNpbmcgb3RoZXIg\nam9pbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNhbk91dGVySm9p\nbihpbnQgc3ludGF4LCBGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgcmV0dXJu\nIHN5bnRheCAhPSBTWU5UQVhfVFJBRElUSU9OQUw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjb21wb25lbnRzIGludG8gYSBT\nRUxFQ1Qgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVy\nIHRvU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZm\nZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICBTUUxCdWZmZXIg\naGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0\naW5jdCwgYm9vbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5k\nKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdldFNlbGVjdE9wZXJh\ndGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdoZXJlLAogICAgICAgICAg\nICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGluY3QsIHN0YXJ0LCBlbmQs\nCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNsYXVzZShmZXRjaCwgZm9yVXBk\nYXRlLCBudWxsKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRo\nZSBnaXZlbiBjb21wb25lbnRzIGludG8gYSBTRUxFQ1Qgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZl\nciBzZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZl\nciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIg\nb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JV\ncGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIGJvb2xlYW4g\nc3Vic2VsZWN0KSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdldFNl\nbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdoZXJlLAog\nICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGluY3QsIHN0\nYXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNsYXVzZShmZXRj\naCwgZm9yVXBkYXRlLCBudWxsKSwgc3Vic2VsZWN0KTsKICAgIH0KICAgIAog\nICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0\ncywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICAgICAg\nU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdy\nb3VwLAogICAgICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIg\nb3JkZXIsCiAgICAgICAgICAgIGJvb2xlYW4gZGlzdGluY3QsIGJvb2xlYW4g\nZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICAgICAg\nYm9vbGVhbiBzdWJzZWxlY3QsIGJvb2xlYW4gY2hlY2tUYWJsZUZvclVwZGF0\nZSkgewogICAgICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24oZ2V0U2VsZWN0\nT3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJvbSwgd2hlcmUsCiAgICAg\nICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGluY3QsIHN0\nYXJ0LCBlbmQsCiAgICAgICAgICAgICAgICBnZXRGb3JVcGRhdGVDbGF1c2Uo\nZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCksIHN1YnNlbGVjdCwgY2hlY2tUYWJs\nZUZvclVwZGF0ZSk7CiAgICAgICAgfQoKICAgIC8qKgogICAgICogQ29tYmlu\nZSB0aGUgZ2l2ZW4gY29tcG9uZW50cyBpbnRvIGEgU0VMRUNUIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxC\ndWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwK\nICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxC\ndWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVmZmVyIGhhdmluZywgU1FMQnVm\nZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3QsIGJvb2xlYW4g\nZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTZWxl\nY3Qgc2VsKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdldFNlbGVj\ndE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdoZXJlLAogICAg\nICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGluY3QsIHN0YXJ0\nLCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNsYXVzZShmZXRjaCwg\nZm9yVXBkYXRlLCBzZWwpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0\naGUgdXBkYXRlIGNsYXVzZSBmb3IgdGhlIHF1ZXJ5IGJhc2VkIG9uIHRoZQog\nICAgICogdXBkYXRlQ2xhdXNlIGFuZCBpc29sYXRpb25MZXZlbCBoaW50cwog\nICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldEZvclVwZGF0ZUNsYXVz\nZShKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIGJvb2xl\nYW4gaXNGb3JVcGRhdGUsIFNlbGVjdCBzZWwpIHsKICAgICAgICBpZiAoZmV0\nY2ggIT0gbnVsbCAmJiBmZXRjaC5nZXRJc29sYXRpb24oKSAhPSAtMSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KAogICAgICAgICAgICAgICAgImlzb2xhdGlvbi1sZXZlbC1jb25m\naWctbm90LXN1cHBvcnRlZCIsIGdldENsYXNzKCkuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgfSBlbHNlIGlmIChpc0ZvclVwZGF0ZSAmJiAhc2ltdWxhdGVMb2Nr\naW5nKSB7CiAgICAgICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNTZWxl\nY3RGb3JVcGRhdGUsICJTdXBwb3J0c1NlbGVjdEZvclVwZGF0ZSIpOwogICAg\nICAgICAgICByZXR1cm4gZm9yVXBkYXRlQ2xhdXNlOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgIlNFTEVDVCIgb3BlcmF0aW9u\nIGNsYXVzZSwgYWRkaW5nIGFueSBhdmFpbGFibGUgaGludHMsIGV0Yy4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTZWxlY3RPcGVyYXRpb24oSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJldHVybiAi\nU0VMRUNUIjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FM\nIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAgICAqLwog\nICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihTdHJpbmcgb3AsIFNR\nTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxC\ndWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVmZmVyIGhhdmlu\nZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xlYW4gZGlzdGluY3Qs\nIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0cmluZyBmb3JVcGRh\ndGVDbGF1c2UpIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24ob3AsIHNl\nbGVjdHMsIGZyb20sIHdoZXJlLCBncm91cCwgaGF2aW5nLCBvcmRlciwKICAg\nICAgICAgICAgZGlzdGluY3QsIHN0YXJ0LCBlbmQsIGZvclVwZGF0ZUNsYXVz\nZSwgZmFsc2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAg\nICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihTdHJpbmcg\nb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZlciBmcm9t\nLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVmZmVy\nIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xlYW4gZGlz\ndGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0cmluZyBm\nb3JVcGRhdGVDbGF1c2UsIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAgICAgICAg\ncmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwg\nZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAgICAgICAgICAgICBkaXN0aW5j\ndCwgc3RhcnQsIGVuZCwgZm9yVXBkYXRlQ2xhdXNlLCBzdWJzZWxlY3QsIGZh\nbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FMIGZv\nciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9wLCBTUUxC\ndWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVm\nZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBoYXZpbmcs\nCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRpc3RpbmN0LCBs\nb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcgZm9yVXBkYXRl\nQ2xhdXNlLCBib29sZWFuIHN1YnNlbGVjdCwgYm9vbGVhbiBjaGVja1RhYmxl\nRm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxC\ndWZmZXIodGhpcyk7CiAgICAgICAgYnVmLmFwcGVuZChvcCk7CgogICAgICAg\nIGJvb2xlYW4gcmFuZ2UgPSBzdGFydCAhPSAwIHx8IGVuZCAhPSBMb25nLk1B\nWF9WQUxVRTsKICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlvbiA9\nPSBSQU5HRV9QUkVfRElTVElOQ1QpCiAgICAgICAgICAgIGFwcGVuZFNlbGVj\ndFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsKICAgICAgICBp\nZiAoZGlzdGluY3QpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBESVNUSU5D\nVCIpOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9uID09IFJB\nTkdFX1BPU1RfRElTVElOQ1QpCiAgICAgICAgICAgIGFwcGVuZFNlbGVjdFJh\nbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsKCiAgICAgICAgYnVm\nLmFwcGVuZCgiICIpLmFwcGVuZChzZWxlY3RzKS5hcHBlbmQoIiBGUk9NICIp\nLmFwcGVuZChmcm9tKTsKCiAgICAgICAgaWYgKGNoZWNrVGFibGVGb3JVcGRh\ndGUKICAgICAgICAgICAgICAgICYmIChTdHJpbmdVdGlscy5pc0VtcHR5KGZv\nclVwZGF0ZUNsYXVzZSkgJiYgIVN0cmluZ1V0aWxzCiAgICAgICAgICAgICAg\nICAgICAgICAgIC5pc0VtcHR5KHRhYmxlRm9yVXBkYXRlQ2xhdXNlKSkpIHsK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVw\nZGF0ZUNsYXVzZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlcmUgIT0g\nbnVsbCAmJiAhd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAgICBidWYuYXBw\nZW5kKCIgV0hFUkUgIikuYXBwZW5kKHdoZXJlKTsKICAgICAgICBpZiAoZ3Jv\ndXAgIT0gbnVsbCAmJiAhZ3JvdXAuaXNFbXB0eSgpKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgR1JPVVAgQlkgIikuYXBwZW5kKGdyb3VwKTsKICAgICAg\nICBpZiAoaGF2aW5nICE9IG51bGwgJiYgIWhhdmluZy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c0hhdmluZywgIlN1\ncHBvcnRzSGF2aW5nIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBIQVZJ\nTkcgIikuYXBwZW5kKGhhdmluZyk7CiAgICAgICAgfQogICAgICAgIGlmIChv\ncmRlciAhPSBudWxsICYmICFvcmRlci5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBPUkRFUiBCWSAiKS5hcHBlbmQob3JkZXIpOwogICAg\nICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1Rf\nU0VMRUNUKQogICAgICAgICAgICBhcHBlbmRTZWxlY3RSYW5nZShidWYsIHN0\nYXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAgICAgaWYgKGZvclVwZGF0ZUNs\nYXVzZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBw\nZW5kKGZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgaWYgKHJhbmdlICYmIHJh\nbmdlUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9MT0NLKQogICAgICAgICAgICBh\ncHBlbmRTZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7\nCiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICAvKioKICAgICAqIElm\nIHRoaXMgZGljdGlvbmFyeSBjYW4gc2VsZWN0IHJhbmdlcywKICAgICAqIHVz\nZSB0aGlzIG1ldGhvZCB0byBhcHBlbmQgdGhlIHJhbmdlIFNRTC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kU2VsZWN0UmFuZ2UoU1FMQnVm\nZmVyIGJ1ZiwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAgYm9vbGVh\nbiBzdWJzZWxlY3QpIHsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0YXRlbWVudCBiZXR3ZWVuIHRo\nZSBTRUxFQ1Qga2V5d29yZAogICAgICogYW5kIHRoZSBGUk9NIGtleXdvcmQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgZ2V0U2VsZWN0cyhT\nZWxlY3Qgc2VsLCBib29sZWFuIGRpc3RpbmN0SWRlbnRpZmllcnMsCiAgICAg\nICAgYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICAvLyBhcHBlbmQgdGhl\nIGFsaWFzZXMgZm9yIGFsbCB0aGUgY29sdW1ucwogICAgICAgIFNRTEJ1ZmZl\nciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIExp\nc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlzdGluY3RJZGVudGlmaWVycykK\nICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlmaWVyQWxpYXNl\ncygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5n\nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAgIE9iamVjdCBhbGlhczsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgYWxpYXMgPSBhbGlhc2VzLmdldChpKTsKICAgICAg\nICAgICAgYXBwZW5kU2VsZWN0KHNlbGVjdFNRTCwgYWxpYXMsIHNlbCwgaSk7\nCiAgICAgICAgICAgIGlmIChpIDwgYWxpYXNlcy5zaXplKCkgLSAxKQogICAg\nICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiLCAiKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHNlbGVjdFNRTDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFwcGVuZCA8Y29kZT5lbGVtPC9jb2RlPiB0byA8Y29kZT5zZWxlY3RT\nUUw8L2NvZGU+LgogICAgICogQHBhcmFtIHNlbGVjdFNRTCBUaGUgU1FMQnVm\nZmVyIHRvIGFwcGVuZCB0by4KICAgICAqIEBwYXJhbSBhbGlhcyBBIHtAbGlu\nayBTUUxCdWZmZXJ9IG9yIGEge0BsaW5rIFN0cmluZ30gdG8gYXBwZW5kLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBhcHBlbmRTZWxlY3QoU1FMQnVmZmVyIHNlbGVjdFNRTCwgT2Jq\nZWN0IGVsZW0sIFNlbGVjdCBzZWwsCiAgICAgICAgaW50IGlkeCkgewogICAg\nICAgIGlmIChlbGVtIGluc3RhbmNlb2YgU1FMQnVmZmVyKQogICAgICAgICAg\nICBzZWxlY3RTUUwuYXBwZW5kKChTUUxCdWZmZXIpIGVsZW0pOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChlbGVtLnRvU3Ry\naW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlm\nIGEgIkZPUiBVUERBVEUiIGNsYXVzZSBjYW4gYmUgdXNlZCBmb3IgdGhlIHNw\nZWNpZmllZAogICAgICogU2VsZWN0IG9iamVjdC4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nKFNlbGVjdCBzZWwpIHsKICAg\nICAgICBpZiAoc2VsLmlzQWdncmVnYXRlKCkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBpZiAoIXN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRl\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFzdXBw\nb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2UgJiYgKHNlbC5nZXRTdGFydElu\nZGV4KCkgIT0gMAogICAgICAgICAgICB8fCBzZWwuZ2V0RW5kSW5kZXgoKSAh\nPSBMb25nLk1BWF9WQUxVRSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgLy8gb25seSBpbm5lciBzZWxlY3QgaXMgbG9ja2VkCiAgICAg\nICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkKICAgICAgICAg\nICAgc2VsID0gc2VsLmdldEZyb21TZWxlY3QoKTsKCiAgICAgICAgaWYgKCFz\ndXBwb3J0c0xvY2tpbmdXaXRoRGlzdGluY3RDbGF1c2UgJiYgc2VsLmlzRGlz\ndGluY3QoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nICghc3VwcG9ydHNMb2NraW5nV2l0aE11bHRpcGxlVGFibGVzCiAgICAgICAg\nICAgICYmIHNlbC5nZXRUYWJsZUFsaWFzZXMoKS5zaXplKCkgPiAxKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c0xv\nY2tpbmdXaXRoT3JkZXJDbGF1c2UgJiYgc2VsLmdldE9yZGVyaW5nKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICgh\nc3VwcG9ydHNMb2NraW5nV2l0aE91dGVySm9pbiB8fCAhc3VwcG9ydHNMb2Nr\naW5nV2l0aElubmVySm9pbikgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIEpvaW4gam9pbiA9IChKb2luKSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRo\nT3V0ZXJKb2luCiAgICAgICAgICAgICAgICAgICAgJiYgam9pbi5nZXRUeXBl\nKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghc3VwcG9ydHNMb2Nr\naW5nV2l0aElubmVySm9pbgogICAgICAgICAgICAgICAgICAgICYmIGpvaW4u\nZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gZmFsc2UgaWYgdGhlIGdpdmVuIHNlbGVjdCByZXF1aXJlcyBhIGZvcndh\ncmQtb25seSByZXN1bHQgc2V0LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c1JhbmRvbUFjY2Vzc1Jlc3VsdFNldChTZWxlY3Qgc2VsLAog\nICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgcmV0dXJuICFz\nZWwuaXNBZ2dyZWdhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2Vy\ndCB0aGF0IHRoZSBnaXZlbiBkaWN0aW9uYXJ5IGZsYWcgaXMgdHJ1ZS4gSWYg\naXQgaXMgbm90IHRydWUsCiAgICAgKiB0aHJvdyBhbiBlcnJvciBzYXlpbmcg\ndGhhdCB0aGUgZ2l2ZW4gc2V0dGluZyBuZWVkcyB0byByZXR1cm4gdHJ1ZSBm\nb3IKICAgICAqIHRoZSBjdXJyZW50IG9wZXJhdGlvbiB0byB3b3JrLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRTdXBwb3J0KGJvb2xlYW4gZmVh\ndHVyZSwgU3RyaW5nIHByb3BlcnR5KSB7CiAgICAgICAgaWYgKCFmZWF0dXJl\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24o\nX2xvYy5nZXQoImZlYXR1cmUtbm90LXN1cHBvcnRlZCIsCiAgICAgICAgICAg\nICAgICBnZXRDbGFzcygpLCBwcm9wZXJ0eSkpOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVyeSBmdW5jdGlvbnMKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhp\ncyBkYXRhYmFzZSdzIHN1YnN0cmluZyBmdW5jdGlvbi4KICAgICAqCiAgICAg\nKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBzdWJz\ndHJpbmcgaW52b2NhdGlvbiB0bwogICAgICogQHBhcmFtIHN0ciBhIHF1ZXJ5\nIHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHN0cmluZwogICAgICog\nQHBhcmFtIHN0YXJ0IGEgcXVlcnkgdmFsdWUgcmVwcmVzZW50aW5nIHRoZSBz\ndGFydCBpbmRleAogICAgICogQHBhcmFtIGVuZCBhIHF1ZXJ5IHZhbHVlIHJl\ncHJlc2VudGluZyB0aGUgZW5kIGluZGV4LCBvciBudWxsIGZvciBub25lCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHN1YnN0cmluZyhTUUxCdWZmZXIgYnVm\nLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVlIHN0YXJ0LAogICAgICAg\nIEZpbHRlclZhbHVlIGVuZCkgewogICAgICAgIGJ1Zi5hcHBlbmQoc3Vic3Ry\naW5nRnVuY3Rpb25OYW1lKS5hcHBlbmQoIigiKTsKICAgICAgICBzdHIuYXBw\nZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAg\nIGlmIChzdGFydC5nZXRWYWx1ZSgpIGluc3RhbmNlb2YgTnVtYmVyKSB7CiAg\nICAgICAgICAgIGxvbmcgc3RhcnRMb25nID0gdG9Mb25nKHN0YXJ0KTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZChMb25nLnRvU3RyaW5nKHN0YXJ0TG9uZyAr\nIDEpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWYuYXBwZW5k\nKCIoIik7CiAgICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiArIDEpIik7CiAgICAgICAgfQogICAgICAg\nIGlmIChlbmQgIT0gbnVsbCkgewogICAgICAgICAgICBidWYuYXBwZW5kKCIs\nICIpOwogICAgICAgICAgICBpZiAoc3RhcnQuZ2V0VmFsdWUoKSBpbnN0YW5j\nZW9mIE51bWJlcgogICAgICAgICAgICAgICAgJiYgZW5kLmdldFZhbHVlKCkg\naW5zdGFuY2VvZiBOdW1iZXIpIHsKICAgICAgICAgICAgICAgIGxvbmcgc3Rh\ncnRMb25nID0gdG9Mb25nKHN0YXJ0KTsKICAgICAgICAgICAgICAgIGxvbmcg\nZW5kTG9uZyA9IHRvTG9uZyhlbmQpOwogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZChMb25nLnRvU3RyaW5nKGVuZExvbmcgLSBzdGFydExvbmcpKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVuZC5hcHBlbmRU\nbyhidWYpOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIC0gKCIpOwog\nICAgICAgICAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgbG9uZyB0\nb0xvbmcoRmlsdGVyVmFsdWUgbGl0VmFsdWUpIHsKICAgICAgICByZXR1cm4g\nKChOdW1iZXIpIGxpdFZhbHVlLmdldFZhbHVlKCkpLmxvbmdWYWx1ZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoaXMgZGF0YWJhc2UncyBp\nbmRleE9mIGZ1bmN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBidWYgdGhl\nIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGluZGV4T2YgaW52b2NhdGlvbiB0\nbwogICAgICogQHBhcmFtIHN0ciBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGlu\nZyB0aGUgdGFyZ2V0IHN0cmluZwogICAgICogQHBhcmFtIGZpbmQgYSBxdWVy\neSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHNlYXJjaCBzdHJpbmcKICAgICAq\nIEBwYXJhbSBzdGFydCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUg\nc3RhcnQgaW5kZXgsIG9yIG51bGwKICAgICAqIHRvIHN0YXJ0IGF0IHRoZSBi\nZWdpbm5pbmcKICAgICAqLwogICAgcHVibGljIHZvaWQgaW5kZXhPZihTUUxC\ndWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVlIGZpbmQs\nCiAgICAgICAgRmlsdGVyVmFsdWUgc3RhcnQpIHsKICAgICAgICBidWYuYXBw\nZW5kKCIoSU5TVFIoKCIpOwogICAgICAgIGlmIChzdGFydCAhPSBudWxsKQog\nICAgICAgICAgICBzdWJzdHJpbmcoYnVmLCBzdHIsIHN0YXJ0LCBudWxsKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0ci5hcHBlbmRUbyhidWYpOwog\nICAgICAgIGJ1Zi5hcHBlbmQoIiksICgiKTsKICAgICAgICBmaW5kLmFwcGVu\nZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiKSkgLSAxIik7CiAgICAg\nICAgaWYgKHN0YXJ0ICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiICsgIik7CiAgICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAg\nICAgICAgfQogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFwcGVuZCB0aGUgbnVtZXJpYyBwYXJ0cyBvZiBhIG1hdGhl\nbWF0aWNhbCBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRo\nZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBtYXRoIGZ1bmN0aW9uCiAgICAg\nKiBAcGFyYW0gb3AgdGhlIG1hdGhlbWF0aWNhbCBvcGVyYXRpb24gdG8gcGVy\nZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNpZGUgb2Yg\ndGhlIG1hdGggZnVuY3Rpb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0\nIGhhbmQgc2lkZSBvZiB0aGUgbWF0aCBmdW5jdGlvbgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBtYXRoRnVuY3Rpb24oU1FMQnVmZmVyIGJ1ZiwgU3RyaW5n\nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVyVmFsdWUgcmhz\nKSB7CiAgICAgICAgYm9vbGVhbiBjYXN0bGhzID0gZmFsc2U7CiAgICAgICAg\nYm9vbGVhbiBjYXN0cmhzID0gZmFsc2U7CiAgICAgICAgQ2xhc3MgbGMgPSBG\naWx0ZXJzLndyYXAobGhzLmdldFR5cGUoKSk7CiAgICAgICAgQ2xhc3MgcmMg\nPSBGaWx0ZXJzLndyYXAocmhzLmdldFR5cGUoKSk7CiAgICAgICAgaW50IHR5\ncGUgPSAwOwogICAgICAgIGlmIChyZXF1aXJlc0Nhc3RGb3JNYXRoRnVuY3Rp\nb25zICYmIChsYyAhPSByYwogICAgICAgICAgICB8fCAobGhzLmlzQ29uc3Rh\nbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSkpIHsKICAgICAgICAgICAgQ2xh\nc3MgYyA9IEZpbHRlcnMucHJvbW90ZShsYywgcmMpOwogICAgICAgICAgICB0\neXBlID0gZ2V0SkRCQ1R5cGUoSmF2YVR5cGVzLmdldFR5cGVDb2RlKGMpLCBm\nYWxzZSk7CiAgICAgICAgICAgIGlmICh0eXBlICE9IFR5cGVzLlZBUkJJTkFS\nWSAmJiB0eXBlICE9IFR5cGVzLkJMT0IpIHsKICAgICAgICAgICAgICAgIGNh\nc3RsaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgp\nKSB8fCBsYyAhPSBjOwogICAgICAgICAgICAgICAgY2FzdHJocyA9IChsaHMu\naXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8IHJjICE9IGM7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gbW9k\nID0gIk1PRCIuZXF1YWxzKG9wKTsKICAgICAgICBpZiAobW9kKSB7CiAgICAg\nICAgICAgIGlmIChzdXBwb3J0c01vZE9wZXJhdG9yKQogICAgICAgICAgICAg\nICAgb3AgPSAiJSI7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQob3ApOwogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5k\nKCIoIik7CgogICAgICAgIGlmIChjYXN0bGhzKQogICAgICAgICAgICBhcHBl\nbmRDYXN0KGJ1ZiwgbGhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGxocy5hcHBlbmRUbyhidWYpOwoKICAgICAgICBpZiAobW9kICYmICFz\ndXBwb3J0c01vZE9wZXJhdG9yKQogICAgICAgICAgICBidWYuYXBwZW5kKCIs\nICIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZChvcCkuYXBwZW5kKCIgIik7CgogICAgICAgIGlmIChjYXN0cmhz\nKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgcmhzLCB0eXBlKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHJocy5hcHBlbmRUbyhidWYpOwoKICAg\nICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgYSBjb21wYXJpc29uLgogICAgICoKICAgICAqIEBwYXJhbSBidWYg\ndGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlzb24KICAgICAq\nIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVyYXRpb24gdG8gcGVyZm9y\nbQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhl\nIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQg\nc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBjb21wYXJpc29uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVy\nVmFsdWUgbGhzLAogICAgICAgIEZpbHRlclZhbHVlIHJocykgewogICAgICAg\nIGJvb2xlYW4gbGhzeG1sID0gbGhzLmdldFhQYXRoKCkgIT0gbnVsbDsKICAg\nICAgICBib29sZWFuIHJoc3htbCA9IHJocy5nZXRYUGF0aCgpICE9IG51bGw7\nCiAgICAgICAgaWYgKGxoc3htbCB8fCByaHN4bWwpIHsKICAgICAgICAgICAg\nYXBwZW5kWG1sQ29tcGFyaXNvbihidWYsIG9wLCBsaHMsIHJocywgbGhzeG1s\nLCByaHN4bWwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAg\nICAgIGJvb2xlYW4gY2FzdGxocyA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4g\nY2FzdHJocyA9IGZhbHNlOwogICAgICAgIENsYXNzIGxjID0gRmlsdGVycy53\ncmFwKGxocy5nZXRUeXBlKCkpOwogICAgICAgIENsYXNzIHJjID0gRmlsdGVy\ncy53cmFwKHJocy5nZXRUeXBlKCkpOwogICAgICAgIGludCB0eXBlID0gMDsK\nICAgICAgICBpZiAocmVxdWlyZXNDYXN0Rm9yQ29tcGFyaXNvbnMgJiYgKGxj\nICE9IHJjCiAgICAgICAgICAgIHx8IChsaHMuaXNDb25zdGFudCgpICYmIHJo\ncy5pc0NvbnN0YW50KCkpKSkgewogICAgICAgICAgICBDbGFzcyBjID0gRmls\ndGVycy5wcm9tb3RlKGxjLCByYyk7CiAgICAgICAgICAgIHR5cGUgPSBnZXRK\nREJDVHlwZShKYXZhVHlwZXMuZ2V0VHlwZUNvZGUoYyksIGZhbHNlKTsKICAg\nICAgICAgICAgaWYgKHR5cGUgIT0gVHlwZXMuVkFSQklOQVJZICYmIHR5cGUg\nIT0gVHlwZXMuQkxPQikgewogICAgICAgICAgICAgICAgY2FzdGxocyA9IChs\naHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8IGxjICE9\nIGM7CiAgICAgICAgICAgICAgICBjYXN0cmhzID0gKGxocy5pc0NvbnN0YW50\nKCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwgcmMgIT0gYzsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGNhc3RsaHMpCiAgICAgICAg\nICAgIGFwcGVuZENhc3QoYnVmLCBsaHMsIHR5cGUpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgbGhzLmFwcGVuZFRvKGJ1Zik7CgogICAgICAgIGJ1Zi5h\ncHBlbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwoKICAgICAgICBp\nZiAoY2FzdHJocykKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIHJocywg\ndHlwZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByaHMuYXBwZW5kVG8o\nYnVmKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoaXMgZGljdGlvbmFy\neSBzdXBwb3J0cyBYTUwgdHlwZSwKICAgICAqIHVzZSB0aGlzIG1ldGhvZCB0\nbyBhcHBlbmQgeG1sIHByZWRpY2F0ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgYXBwZW5kWG1sQ29tcGFyaXNvbihTUUxCdWZmZXIgYnVmLCBTdHJpbmcg\nb3AsIEZpbHRlclZhbHVlIGxocywKICAgICAgICBGaWx0ZXJWYWx1ZSByaHMs\nIGJvb2xlYW4gbGhzeG1sLCBib29sZWFuIHJoc3htbCkgewogICAgICAgIGFz\nc2VydFN1cHBvcnQoc3VwcG9ydHNYTUxDb2x1bW4sICJTdXBwb3J0c1hNTENv\nbHVtbiIpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIFNRTCBmb3Ig\ndGhlIGdpdmVuIG51bWVyaWMgdmFsdWUgdG8gdGhlIGJ1ZmZlciwgY2FzdGlu\nZyBhcyBuZWVkZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFwcGVu\nZE51bWVyaWNDYXN0KFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHZhbCkg\newogICAgICAgIGlmICh2YWwuaXNDb25zdGFudCgpKQogICAgICAgICAgICBh\ncHBlbmRDYXN0KGJ1ZiwgdmFsLCBUeXBlcy5OVU1FUklDKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHZhbC5hcHBlbmRUbyhidWYpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2FzdCB0aGUgc3BlY2lmaWVkIHZhbHVlIHRvIHRoZSBz\ncGVjaWZpZWQgdHlwZS4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBi\ndWZmZXIgdG8gYXBwZW5kIHRoZSBjYXN0IHRvCiAgICAgKiBAcGFyYW0gdmFs\nIHRoZSB2YWx1ZSB0byBjYXN0CiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgdHlw\nZSBvZiB0aGUgY2FzZSwgZS5nLiB7QGxpbmsgVHlwZXMjTlVNRVJJQ30KICAg\nICAqLwogICAgcHVibGljIHZvaWQgYXBwZW5kQ2FzdChTUUxCdWZmZXIgYnVm\nLCBPYmplY3QgdmFsLCBpbnQgdHlwZSkgewogICAgICAgIC8vIENvbnZlcnQg\ndGhlIGNhc3QgZnVuY3Rpb246ICJDQVNUKHswfSBBUyB7MX0pIgogICAgICAg\nIGludCBmaXJzdFBhcmFtID0gY2FzdEZ1bmN0aW9uLmluZGV4T2YoInswfSIp\nOwogICAgICAgIFN0cmluZyBwcmUgPSBjYXN0RnVuY3Rpb24uc3Vic3RyaW5n\nKDAsIGZpcnN0UGFyYW0pOyAvLyAiQ0FTVCgiCiAgICAgICAgU3RyaW5nIG1p\nZCA9IGNhc3RGdW5jdGlvbi5zdWJzdHJpbmcoZmlyc3RQYXJhbSArIDMpOwog\nICAgICAgIGludCBzZWNvbmRQYXJhbSA9IG1pZC5pbmRleE9mKCJ7MX0iKTsK\nICAgICAgICBTdHJpbmcgcG9zdDsKICAgICAgICBpZiAoc2Vjb25kUGFyYW0g\nPiAtMSkgewogICAgICAgICAgICBwb3N0ID0gbWlkLnN1YnN0cmluZyhzZWNv\nbmRQYXJhbSArIDMpOyAvLyAiKSIKICAgICAgICAgICAgbWlkID0gbWlkLnN1\nYnN0cmluZygwLCBzZWNvbmRQYXJhbSk7IC8vICIgQVMgIgogICAgICAgIH0g\nZWxzZQogICAgICAgICAgICBwb3N0ID0gIiI7CgogICAgICAgIGJ1Zi5hcHBl\nbmQocHJlKTsKICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgRmlsdGVyVmFs\ndWUpCiAgICAgICAgICAgICgoRmlsdGVyVmFsdWUpIHZhbCkuYXBwZW5kVG8o\nYnVmKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBTUUxCdWZm\nZXIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoKChTUUxCdWZmZXIpIHZhbCkp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFwcGVuZCh2YWwudG9T\ndHJpbmcoKSk7CiAgICAgICAgYnVmLmFwcGVuZChtaWQpOwogICAgICAgIGJ1\nZi5hcHBlbmQoZ2V0VHlwZU5hbWUodHlwZSkpOwogICAgICAgIGFwcGVuZExl\nbmd0aChidWYsIHR5cGUpOwogICAgICAgIGJ1Zi5hcHBlbmQocG9zdCk7CiAg\nICB9CiAgICAKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZExlbmd0aChTUUxC\ndWZmZXIgYnVmLCBpbnQgdHlwZSkgeyAgICAgICAgCiAgICB9CgogICAgCiAg\nICAvKioKICAgICAqIGFkZCBDQVNUIGZvciBhIGZ1bmN0aW9uIG9wZXJhdG9y\nIHdoZXJlIG9wZXJhbmQgaXMgYSBwYXJhbQogICAgICogQHBhcmFtIGZ1bmMg\nIGZ1bmN0aW9uIG5hbWUKICAgICAqIEBwYXJhbSB2YWwgCiAgICAgKiBAcmV0\ndXJuIHVwZGF0ZWQgZnVuYwogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGFk\nZENhc3RBc1R5cGUoU3RyaW5nIGZ1bmMsIFZhbCB2YWwpIHsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0gICAgCgoKICAgIC8vLy8vLy8vLy8vCiAgICAv\nLyBEREwgU1FMCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogSW5j\ncmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQgb2YgYW55IHRhYmxlIGNvbXBv\nbmVudHMgdGhhdCB0aGlzCiAgICAgKiBkaWN0aW9uYXJ5IGFkZHMgdGhhdCBh\ncmUgbm90IHVzZWQgYnkgbWFwcGluZ3MuIERvZXMgbm90aGluZyBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWZTY2hlbWFDb21wb25l\nbnRzKFRhYmxlIHRhYmxlKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRhYmxlLCBpbmNsdWRpbmcgdGhl\nIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB7QGxpbmsgI2NhdGFsb2dT\nZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRGdWxs\nTmFtZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dpY2FsKSB7CiAgICAgICAg\naWYgKCF1c2VTY2hlbWFOYW1lIHx8IHRhYmxlLmdldFNjaGVtYU5hbWUoKSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGFibGUuZ2V0TmFtZSgpOwog\nICAgICAgIGlmIChsb2dpY2FsIHx8ICIuIi5lcXVhbHMoY2F0YWxvZ1NlcGFy\nYXRvcikpCiAgICAgICAgICAgIHJldHVybiB0YWJsZS5nZXRGdWxsTmFtZSgp\nOwogICAgICAgIHJldHVybiB0YWJsZS5nZXRTY2hlbWFOYW1lKCkgKyBjYXRh\nbG9nU2VwYXJhdG9yICsgdGFibGUuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0aGUgZnVsbCBuYW1lIG9mIHRoZSBpbmRleCwg\naW5jbHVkaW5nIHRoZSBzY2hlbWEgKGRlbGltaXRlZAogICAgICogYnkgdGhl\nIHJlc3VsdCBvZiB7QGxpbmsgI2NhdGFsb2dTZXBhcmF0b3J9KS4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFtZShJbmRleCBpbmRleCkg\newogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBpbmRleC5nZXRTY2hl\nbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGluZGV4Lmdl\ndE5hbWUoKTsKICAgICAgICBpZiAoIi4iLmVxdWFscyhjYXRhbG9nU2VwYXJh\ndG9yKSkKICAgICAgICAgICAgcmV0dXJuIGluZGV4LmdldEZ1bGxOYW1lKCk7\nCiAgICAgICAgcmV0dXJuIGluZGV4LmdldFNjaGVtYU5hbWUoKSArIGNhdGFs\nb2dTZXBhcmF0b3IgKyBpbmRleC5nZXROYW1lKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHNlcXVlbmNl\nLCBpbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB0\naGUgcmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRvcn0pLgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1lKFNlcXVlbmNlIHNl\ncSkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBzZXEuZ2V0U2No\nZW1hTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBzZXEuZ2V0\nTmFtZSgpOwogICAgICAgIGlmICgiLiIuZXF1YWxzKGNhdGFsb2dTZXBhcmF0\nb3IpKQogICAgICAgICAgICByZXR1cm4gc2VxLmdldEZ1bGxOYW1lKCk7CiAg\nICAgICAgcmV0dXJuIHNlcS5nZXRTY2hlbWFOYW1lKCkgKyBjYXRhbG9nU2Vw\nYXJhdG9yICsgc2VxLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB0YWJs\nZSBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVu\ndCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFRhYmxl\nTmFtZShTdHJpbmcgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHdo\naWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFtZSA9\nIG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZh\nbGlkKG5hbWUsIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAg\nICBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfVEFCTEUpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhl\nIGdpdmVuIHNlcXVlbmNlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICog\nZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFZhbGlkU2VxdWVuY2VOYW1lKFN0cmluZyBuYW1lLCBTY2hlbWEgc2No\nZW1hKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQog\nICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAg\ncmV0dXJuIG1ha2VOYW1lVmFsaWQoIlNfIiArIG5hbWUsIHNjaGVtYS5nZXRT\nY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGgs\nIE5BTUVfU0VRVUVOQ0UpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBh\nbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGNvbHVtbiBuYW1l\nIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBEQi4g\nIFRoZSBjb2x1bW4gbmFtZSB3aWxsIGJlIG1hZGUgdW5pcXVlIGZvciB0aGUK\nICAgICAqIHNwZWNpZmllZCB0YWJsZS4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZyBnZXRWYWxpZENvbHVtbk5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgcmV0dXJuIGdldFZhbGlkQ29sdW1uTmFtZShuYW1l\nLCB0YWJsZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFu\neSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gY29sdW1uIG5hbWUg\ndG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLiAg\nSWYgY2hlY2tGb3JVbmlxdWVuZXNzIGlzIHRydWUsIHRoZSBjb2x1bW4gbmFt\nZSB3aWxsIAogICAgICogYmUgbWFkZSB1bmlxdWUgZm9yIHRoZSBzcGVjaWZp\nZWQgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRD\nb2x1bW5OYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSwKICAgICAgICBi\nb29sZWFuIGNoZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAgIHdoaWxlIChu\nYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUu\nc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5h\nbWUsIHRhYmxlLCBtYXhDb2x1bW5OYW1lTGVuZ3RoLCBOQU1FX0FOWSwKICAg\nICAgICAgICAgY2hlY2tGb3JVbmlxdWVuZXNzKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZl\nbiBwcmltYXJ5IGtleSBuYW1lIHRvIG1ha2UgaXQKICAgICAqIHZhbGlkIGZv\nciB0aGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRWYWxpZFByaW1hcnlLZXlOYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJs\nZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAg\nICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJl\ndHVybiBtYWtlTmFtZVZhbGlkKCJQXyIgKyBuYW1lLCB0YWJsZS5nZXRTY2hl\nbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhDb25zdHJh\naW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAgIC8qKgogICAg\nICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGZv\ncmVpZ24ga2V5IG5hbWUgdG8gbWFrZSBpdAogICAgICogdmFsaWQgZm9yIHRo\nZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZh\nbGlkRm9yZWlnbktleU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlLAog\nICAgICAgIFRhYmxlIHRvVGFibGUpIHsKICAgICAgICB3aGlsZSAobmFtZS5z\ndGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0\ncmluZygxKTsKICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0gdGFibGUuZ2V0\nTmFtZSgpOwogICAgICAgIGludCBsZW4gPSBNYXRoLm1pbih0YWJsZU5hbWUu\nbGVuZ3RoKCksIDcpOwogICAgICAgIG5hbWUgPSAiRl8iICsgc2hvcnRlbih0\nYWJsZU5hbWUsIGxlbikgKyAiXyIgKyBuYW1lOwogICAgICAgIHJldHVybiBt\nYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLmdldFNjaGVtYSgpLmdldFNjaGVt\nYUdyb3VwKCksCiAgICAgICAgICAgIG1heENvbnN0cmFpbnROYW1lTGVuZ3Ro\nLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBu\nZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gaW5kZXggbmFtZSB0byBt\nYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRJbmRleE5hbWUoU3RyaW5n\nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3Rh\ncnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJp\nbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSA9IHRhYmxlLmdldE5h\nbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0aC5taW4odGFibGVOYW1lLmxl\nbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0gIklfIiArIHNob3J0ZW4odGFi\nbGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsKICAgICAgICByZXR1cm4gbWFr\nZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS5nZXRTY2hlbWFH\ncm91cCgpLAogICAgICAgICAgICBtYXhJbmRleE5hbWVMZW5ndGgsIE5BTUVf\nQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2Fy\neSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB1bmlxdWUgY29uc3RyYWludCBuYW1l\nIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFVuaXF1ZU5hbWUo\nU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUgKG5h\nbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5z\ndWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSA9IHRhYmxl\nLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0aC5taW4odGFibGVO\nYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0gIlVfIiArIHNob3J0\nZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsKICAgICAgICByZXR1\ncm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS5nZXRT\nY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhDb25zdHJhaW50TmFtZUxl\nbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAgIC8qKgogICAgICogU2hvcnRl\nbiB0aGUgc3BlY2lmaWVkIG5hbWUgdG8gdGhlIHNwZWNpZmllZCB0YXJnZXQg\nbmFtZS4gVGhpcyB3aWxsCiAgICAgKiBiZSBkb25lIGJ5IGZpcnN0IHN0cmlw\ncGluZyBvdXQgdGhlIHZvd2VscywgYW5kIHRoZW4gcmVtb3ZpbmcKICAgICAq\nIGNoYXJhY3RlcnMgZnJvbSB0aGUgbWlkZGxlIG9mIHRoZSB3b3JkIHVudGls\nIGl0IHJlYWNoZXMgdGhlIHRhcmdldAogICAgICogbGVuZ3RoLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIFN0cmluZyBzaG9ydGVuKFN0cmluZyBu\nYW1lLCBpbnQgdGFyZ2V0TGVuZ3RoKSB7CiAgICAgICAgaWYgKG5hbWUgPT0g\nbnVsbCB8fCBuYW1lLmxlbmd0aCgpIDw9IHRhcmdldExlbmd0aCkKICAgICAg\nICAgICAgcmV0dXJuIG5hbWU7CgogICAgICAgIFN0cmluZ0J1ZmZlciBubSA9\nIG5ldyBTdHJpbmdCdWZmZXIobmFtZSk7CiAgICAgICAgd2hpbGUgKG5tLmxl\nbmd0aCgpID4gdGFyZ2V0TGVuZ3RoKSB7CiAgICAgICAgICAgIGlmICghc3Ry\naXBWb3dlbChubSkpIHsKICAgICAgICAgICAgICAgIC8vIGN1dCBvdXQgdGhl\nIG1pZGRsZSBjaGFyCiAgICAgICAgICAgICAgICBubS5yZXBsYWNlKG5tLmxl\nbmd0aCgpIC8gMiwgKG5tLmxlbmd0aCgpIC8gMikgKyAxLCAiIik7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5tLnRvU3RyaW5n\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdm93ZWxzIGZyb20g\ndGhlIHNwZWNpZmllZCBTdHJpbmdCdWZmZXIuCiAgICAgKgogICAgICogQHJl\ndHVybiB0cnVlIGlmIGFueSB2b3dlbHMgaGF2ZSBiZWVuIHJlbW92ZWQKICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBzdHJpcFZvd2VsKFN0\ncmluZ0J1ZmZlciBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCB8\nfCBuYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgY2hhcltdIHZvd2VscyA9IHsgJ0EnLCAnRScsICdJJywg\nJ08nLCAnVScsIH07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB2b3dl\nbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaW50IGluZGV4ID0gbmFt\nZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkuaW5kZXhPZih2b3dlbHNbaV0p\nOwogICAgICAgICAgICBpZiAoaW5kZXggIT0gLTEpIHsKICAgICAgICAgICAg\nICAgIG5hbWUucmVwbGFjZShpbmRleCwgaW5kZXggKyAxLCAiIik7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4gbWF4aW11\nbSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0IGlzIG5vdCBh\nIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBhcHBlbmRzIGEg\nIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdpdGggYW4gZXhp\nc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCwgdGhlIGxhc3QKICAgICAqIGNoYXJh\nY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVuICcxJywgZXRjLgogICAg\nICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVuIG1heSBiZSAwIGlmIHRo\nZSBkYXRhYmFzZSBtZXRhZGF0YSBpcwogICAgICogaW5jb21wbGV0ZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBtYWtlTmFtZVZhbGlkKFN0cmlu\nZyBuYW1lLCBOYW1lU2V0IHNldCwgaW50IG1heExlbiwKICAgICAgICBpbnQg\nbmFtZVR5cGUpIHsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1l\nLCBzZXQsIG1heExlbiwgbmFtZVR5cGUsIHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2hvcnRlbnMgdGhlIGdpdmVuIG5hbWUgdG8gdGhlIGdpdmVu\nIG1heGltdW0gbGVuZ3RoLCB0aGVuIGNoZWNrcyB0aGF0CiAgICAgKiBpdCBp\ncyBub3QgYSByZXNlcnZlZCB3b3JkLiBJZiBpdCBpcyByZXNlcnZlZCwgYXBw\nZW5kcyBhICIwIi4gSWYKICAgICAqIHRoZSBuYW1lIGNvbmZsaWN0cyB3aXRo\nIGFuIGV4aXN0aW5nIHNjaGVtYSBjb21wb25lbnQgYW5kIHVuaXF1ZW5lc3MK\nICAgICAqIGNoZWNraW5nIGlzIGVuYWJsZWQsIHRoZSBsYXN0IGNoYXJhY3Rl\nciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVuIAogICAgICogJzEnLCBldGMu\nIAogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVuIG1heSBiZSAw\nIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcyAKICAgICAqIGluY29tcGxl\ndGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgbWFrZU5hbWVWYWxp\nZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQsIGludCBtYXhMZW4sCiAgICAg\nICAgaW50IG5hbWVUeXBlLCBib29sZWFuIGNoZWNrRm9yVW5pcXVlbmVzcykg\newogICAgICAgIGlmIChtYXhMZW4gPCAxKQogICAgICAgICAgICBtYXhMZW4g\nPSAyNTU7CiAgICAgICAgaWYgKG5hbWUubGVuZ3RoKCkgPiBtYXhMZW4pCiAg\nICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBtYXhMZW4pOwog\nICAgICAgIGlmIChyZXNlcnZlZFdvcmRTZXQuY29udGFpbnMobmFtZS50b1Vw\ncGVyQ2FzZSgpKSkgewogICAgICAgICAgICBpZiAobmFtZS5sZW5ndGgoKSA9\nPSBtYXhMZW4pCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJp\nbmcoMCwgbmFtZS5sZW5ndGgoKSAtIDEpOwogICAgICAgICAgICBuYW1lICs9\nICIwIjsKICAgICAgICB9CgogICAgICAgIC8vIG5vdyBtYWtlIHN1cmUgdGhl\nIG5hbWUgaXMgdW5pcXVlCiAgICAgICAgaWYgKHNldCAhPSBudWxsICYmIGNo\nZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAgICAgICBvdXRlcjoKICAgICAg\nICAgICAgZm9yIChpbnQgdmVyc2lvbiA9IDEsIGNoYXJzID0gMTsgdHJ1ZTsg\ndmVyc2lvbisrKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgdGFibGUgbmFt\nZXMsIHdlIGNoZWNrIGZvciB0aGUgdGFibGUgaXRzZWxmIGluIGNhc2UgdGhl\nCiAgICAgICAgICAgICAgICAvLyBuYW1lIHNldCBpcyBsYXp5IGFib3V0IHNj\naGVtYSByZWZsZWN0aW9uCiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hbWVU\neXBlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBOQU1FX1RBQkxFOgog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgoU2NoZW1hR3JvdXApIHNl\ndCkuaXNLbm93blRhYmxlKG5hbWUpKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgTkFNRV9TRVFVRU5DRToK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoKFNjaGVtYUdyb3VwKSBz\nZXQpLmlzS25vd25TZXF1ZW5jZShuYW1lKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrIG91dGVyOwogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoIXNldC5pc05hbWVUYWtlbihuYW1lKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGEgc2luZ2xlIGNo\nYXIgZm9yIHRoZSB2ZXJzaW9uIGlzIHByb2JhYmx5IGVub3VnaCwgYnV0IG1p\nZ2h0CiAgICAgICAgICAgICAgICAvLyBhcyB3ZWxsIGJlIGdlbmVyYWwgYWJv\ndXQgaXQuLi4KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uID4gMSkKICAg\nICAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgbmFt\nZS5sZW5ndGgoKSAtIGNoYXJzKTsKICAgICAgICAgICAgICAgIGlmICh2ZXJz\naW9uID49IE1hdGgucG93KDEwLCBjaGFycykpCiAgICAgICAgICAgICAgICAg\nICAgY2hhcnMrKzsKICAgICAgICAgICAgICAgIGlmIChuYW1lLmxlbmd0aCgp\nICsgY2hhcnMgPiBtYXhMZW4pCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9\nIG5hbWUuc3Vic3RyaW5nKDAsIG1heExlbiAtIGNoYXJzKTsKICAgICAgICAg\nICAgICAgIG5hbWUgPSBuYW1lICsgdmVyc2lvbjsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbmFtZS50b1VwcGVyQ2FzZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBz\ndGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gdGFibGUsIGNvbXBsZXRl\nCiAgICAgKiB3aXRoIGNvbHVtbnMuIEluZGV4ZXMgYW5kIGNvbnN0cmFpbnRz\nIHdpbGwgYmUgY3JlYXRlZCBzZXBhcmF0ZWx5LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFibGUgdGFibGUpIHsK\nICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSBUQUJMRSAiKS5hcHBlbmQo\nZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSk7CiAgICAgICAgaWYgKHN1cHBv\ncnRzQ29tbWVudHMgJiYgdGFibGUuaGFzQ29tbWVudCgpKSB7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiAiKTsKICAgICAgICAgICAgY29tbWVudChidWYs\nIHRhYmxlLmdldENvbW1lbnQoKSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIlxuICAgICgiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgKCIpOwogICAgICAgIH0KCiAgICAgICAgLy8gZG8gdGhpcyBi\nZWZvcmUgZ2V0dGluZyB0aGUgY29sdW1ucyBzbyB3ZSBrbm93IGhvdyB0byBo\nYW5kbGUKICAgICAgICAvLyB0aGUgbGFzdCBjb21tYQogICAgICAgIFN0cmlu\nZ0J1ZmZlciBlbmRCdWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAg\nUHJpbWFyeUtleSBwayA9IHRhYmxlLmdldFByaW1hcnlLZXkoKTsKICAgICAg\nICBTdHJpbmcgcGtTdHI7CiAgICAgICAgaWYgKHBrICE9IG51bGwpIHsKICAg\nICAgICAgICAgcGtTdHIgPSBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChw\nayk7CiAgICAgICAgICAgIGlmIChwa1N0ciAhPSBudWxsKQogICAgICAgICAg\nICAgICAgZW5kQnVmLmFwcGVuZChwa1N0cik7CiAgICAgICAgfQoKICAgICAg\nICBVbmlxdWVbXSB1bnFzID0gdGFibGUuZ2V0VW5pcXVlcygpOwogICAgICAg\nIFN0cmluZyB1bnFTdHI7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1\nbnFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVucVN0ciA9IGdldFVu\naXF1ZUNvbnN0cmFpbnRTUUwodW5xc1tpXSk7CiAgICAgICAgICAgIGlmICh1\nbnFTdHIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGVuZEJ1Zi5s\nZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVu\nZCgiLCAiKTsKICAgICAgICAgICAgICAgIGVuZEJ1Zi5hcHBlbmQodW5xU3Ry\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10g\nY29scyA9IHRhYmxlLmdldENvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYnVm\nLmFwcGVuZChnZXREZWNsYXJlQ29sdW1uU1FMKGNvbHNbaV0sIGZhbHNlKSk7\nCiAgICAgICAgICAgIGlmIChpIDwgY29scy5sZW5ndGggLSAxIHx8IGVuZEJ1\nZi5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIs\nICIpOwogICAgICAgICAgICBpZiAoc3VwcG9ydHNDb21tZW50cyAmJiBjb2xz\nW2ldLmhhc0NvbW1lbnQoKSkgewogICAgICAgICAgICAgICAgY29tbWVudChi\ndWYsIGNvbHNbaV0uZ2V0Q29tbWVudCgpKTsKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIlxuICAgICIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBidWYuYXBwZW5kKGVuZEJ1Zi50b1N0cmluZygpKTsKICAgICAg\nICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdb\nXXsgYnVmLnRvU3RyaW5nKCkgfTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nQnVmZmVyIGNvbW1lbnQoU3RyaW5nQnVmZmVyIGJ1ZiwgU3RyaW5nIGNv\nbW1lbnQpIHsKICAgICAgICByZXR1cm4gYnVmLmFwcGVuZCgiLS0gIikuYXBw\nZW5kKGNvbW1lbnQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHRh\nYmxlLiBJbmRleGVzCiAgICAgKiB3aWxsIGJlIGRyb3BwZWQgc2VwYXJhdGVs\neS4gUmV0dXJucwogICAgICogPGNvZGU+RFJPUCBUQUJMRSAmbHQ7dGFibGUg\nbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXREcm9wVGFibGVTUUwoVGFibGUgdGFibGUpIHsKICAg\nICAgICBTdHJpbmcgZHJvcCA9IE1lc3NhZ2VGb3JtYXQuZm9ybWF0KGRyb3BU\nYWJsZVNRTCwgbmV3IE9iamVjdFtdewogICAgICAgICAgICBnZXRGdWxsTmFt\nZSh0YWJsZSwgZmFsc2UpIH0pOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nW117IGRyb3AgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNl\ncmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBjcmVhdGUgdGhlIGdpdmVuIHNl\ncXVlbmNlLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5DUkVBVEUgU0VRVUVOQ0Ug\nJmx0O3NlcXVlbmNlIG5hbWUmZ3Q7WyBTVEFSVCBXSVRIICZsdDtzdGFydCZn\ndDtdCiAgICAgKiBbIElOQ1JFTUVOVCBCWSAmbHQ7aW5jcmVtZW50Jmd0O108\nL2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXRDcmVhdGVTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAg\nICBpZiAobmV4dFNlcXVlbmNlUXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFIFNF\nUVVFTkNFICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0RnVsbE5hbWUoc2Vx\nKSk7CiAgICAgICAgaWYgKHNlcS5nZXRJbml0aWFsVmFsdWUoKSAhPSAwKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCIgU1RBUlQgV0lUSCAiKS5hcHBlbmQo\nc2VxLmdldEluaXRpYWxWYWx1ZSgpKTsKICAgICAgICBpZiAoc2VxLmdldElu\nY3JlbWVudCgpID4gMSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElOQ1JF\nTUVOVCBCWSAiKS5hcHBlbmQoc2VxLmdldEluY3JlbWVudCgpKTsKICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1tdeyBidWYudG9TdHJpbmcoKSB9OwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0\nZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHNlcXVlbmNlLiBSZXR1cm5zCiAg\nICAgKiA8Y29kZT5EUk9QIFNFUVVFTkNFICZsdDtzZXF1ZW5jZSBuYW1lJmd0\nOzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZ1tdIGdldERyb3BTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiRFJPUCBTRVFVRU5DRSAiICsgZ2V0\nRnVsbE5hbWUoc2VxKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2\nZW4gaW5kZXguIFJldHVybnMKICAgICAqIDxjb2RlPkNSRUFURSBbVU5JUVVF\nXSBJTkRFWCAmbHQ7aW5kZXggbmFtZSZndDsgT04gJmx0O3RhYmxlIG5hbWUm\nZ3Q7CiAgICAgKiAoJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+IGJ5IGRlZmF1\nbHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVJbmRl\neFNRTChJbmRleCBpbmRleCkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYg\nPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiQ1JF\nQVRFICIpOwogICAgICAgIGlmIChpbmRleC5pc1VuaXF1ZSgpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCJVTklRVUUgIik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiSU5ERVggIikuYXBwZW5kKGluZGV4LmdldE5hbWUoKSk7CgogICAgICAg\nIGJ1Zi5hcHBlbmQoIiBPTiAiKS5hcHBlbmQoZ2V0RnVsbE5hbWUoaW5kZXgu\nZ2V0VGFibGUoKSwgZmFsc2UpKTsKICAgICAgICBidWYuYXBwZW5kKCIgKCIp\nLmFwcGVuZChTdHJpbmdzLmpvaW4oaW5kZXguZ2V0Q29sdW1ucygpLCAiLCAi\nKSkuCiAgICAgICAgICAgIGFwcGVuZCgiKSIpOwoKICAgICAgICByZXR1cm4g\nbmV3IFN0cmluZ1tdeyBidWYudG9TdHJpbmcoKSB9OwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRv\nIGRyb3AgdGhlIGdpdmVuIGluZGV4LiBSZXR1cm5zCiAgICAgKiA8Y29kZT5E\nUk9QIElOREVYICZsdDtpbmRleCBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BJbmRleFNR\nTChJbmRleCBpbmRleCkgewogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117\nICJEUk9QIElOREVYICIgKyBnZXRGdWxsTmFtZShpbmRleCkgfTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVt\nZW50cyB0byBhZGQgdGhlIGdpdmVuIGNvbHVtbiB0bwogICAgICogaXRzIHRh\nYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBz\ndXBwb3J0ZWQuIFJldHVybnMKICAgICAqIDxjb2RlPkFMVEVSIFRBQkxFICZs\ndDt0YWJsZSBuYW1lJmd0OyBBREQgKCZsdDtjb2wgZGVjJmd0Oyk8L2NvZGU+\nCiAgICAgKiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nW10gZ2V0QWRkQ29sdW1uU1FMKENvbHVtbiBjb2x1bW4pIHsKICAgICAgICBp\nZiAoIXN1cHBvcnRzQWx0ZXJUYWJsZVdpdGhBZGRDb2x1bW4pCiAgICAgICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwoKICAgICAgICBTdHJpbmcgZGVj\nID0gZ2V0RGVjbGFyZUNvbHVtblNRTChjb2x1bW4sIHRydWUpOwogICAgICAg\nIGlmIChkZWMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJp\nbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRB\nQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShjb2x1bW4uZ2V0VGFi\nbGUoKSwgZmFsc2UpICsgIiBBREQgIiArIGRlYyB9OwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRv\nIGRyb3AgdGhlIGdpdmVuIGNvbHVtbiBmcm9tCiAgICAgKiBpdHMgdGFibGUu\nIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBv\ncnRlZC4gUmV0dXJucwogICAgICogPGNvZGU+QUxURVIgVEFCTEUgJmx0O3Rh\nYmxlIG5hbWUmZ3Q7IERST1AgQ09MVU1OICZsdDtjb2wgbmFtZSZndDs8L2Nv\nZGU+CiAgICAgKiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0RHJvcENvbHVtblNRTChDb2x1bW4gY29sdW1uKSB7CiAgICAg\nICAgaWYgKCFzdXBwb3J0c0FsdGVyVGFibGVXaXRoRHJvcENvbHVtbikKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJu\nIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBn\nZXRGdWxsTmFtZShjb2x1bW4uZ2V0VGFibGUoKSwgZmFsc2UpCiAgICAgICAg\nICAgICsgIiBEUk9QIENPTFVNTiAiICsgY29sdW1uIH07CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMg\ndG8gYWRkIHRoZSBnaXZlbiBwcmltYXJ5IGtleSB0bwogICAgICogaXRzIHRh\nYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBz\ndXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFMVEVSIFRBQkxFICZs\ndDt0YWJsZSBuYW1lJmd0OyBBREQKICAgICAqICZsdDtwayBjb25zIHNxbCAm\nZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0QWRkUHJpbWFyeUtleVNRTChQcmltYXJ5S2V5IHBrKSB7CiAg\nICAgICAgU3RyaW5nIHBrc3FsID0gZ2V0UHJpbWFyeUtleUNvbnN0cmFpbnRT\nUUwocGspOwogICAgICAgIGlmIChwa3NxbCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0\ncmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1bGxO\nYW1lKHBrLmdldFRhYmxlKCksIGZhbHNlKSArICIgQUREICIgKyBwa3NxbCB9\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNR\nTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHByaW1hcnkga2V5IGZy\nb20KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlm\nIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0dXJucyA8Y29k\nZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgRFJPUCBDT05TVFJB\nSU5UCiAgICAgKiAmbHQ7cGsgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wUHJpbWFyeUtl\neVNRTChQcmltYXJ5S2V5IHBrKSB7CiAgICAgICAgaWYgKHBrLmdldE5hbWUo\nKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsK\nICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgog\nICAgICAgICAgICArIGdldEZ1bGxOYW1lKHBrLmdldFRhYmxlKCksIGZhbHNl\nKQogICAgICAgICAgICArICIgRFJPUCBDT05TVFJBSU5UICIgKyBway5nZXRO\nYW1lKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmll\ncyBvZiBTUUwgc3RhdGVtZW50cyB0byBhZGQgdGhlIGdpdmVuIGZvcmVpZ24g\na2V5IHRvCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJh\neSBpZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4KICAgICAqIFJldHVybnMg\nPGNvZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IEFERAogICAg\nICogJmx0O2ZrIGNvbnMgc3FsICZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRBZGRGb3JlaWduS2V5U1FM\nKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBTdHJpbmcgZmtTUUwgPSBnZXRG\nb3JlaWduS2V5Q29uc3RyYWludFNRTChmayk7CiAgICAgICAgaWYgKGZrU1FM\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwog\nICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAg\nICAgICAgICAgICsgZ2V0RnVsbE5hbWUoZmsuZ2V0VGFibGUoKSwgZmFsc2Up\nICsgIiBBREQgIiArIGZrU1FMIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUg\nZ2l2ZW4gZm9yZWlnbiBrZXkgZnJvbQogICAgICogaXRzIHRhYmxlLiBSZXR1\ncm4gYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQu\nCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBu\nYW1lJmd0OyBEUk9QIENPTlNUUkFJTlQKICAgICAqICZsdDtmayBuYW1lJmd0\nOzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZ1tdIGdldERyb3BGb3JlaWduS2V5U1FMKEZvcmVpZ25LZXkgZmspIHsKICAg\nICAgICBpZiAoZmsuZ2V0TmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUo\nZmsuZ2V0VGFibGUoKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENP\nTlNUUkFJTlQgIiArIGZrLmdldE5hbWUoKSB9OwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZl\nbiBjb2x1bW4uIFRoaXMgbWV0aG9kIGlzIHVzZWQKICAgICAqIGZvciBlYWNo\nIGNvbHVtbiBmcm9tIHdpdGhpbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FM\nfSBhbmQKICAgICAqIHtAbGluayAjZ2V0QWRkQ29sdW1uU1FMfS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXREZWNsYXJlQ29sdW1uU1FMKENv\nbHVtbiBjb2wsIGJvb2xlYW4gYWx0ZXIpIHsKICAgICAgICBTdHJpbmdCdWZm\nZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoY29sKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBwZW5kKGdldFR5\ncGVOYW1lKGNvbCkpOwoKICAgICAgICAvLyBjYW4ndCBhZGQgY29uc3RyYWlu\ndHMgdG8gYSBjb2x1bW4gd2UncmUgYWRkaW5nIGFmdGVyIHRhYmxlCiAgICAg\nICAgLy8gY3JlYXRpb24sIGNhdXNlIHNvbWUgZGF0YSBtaWdodCBhbHJlYWR5\nIGJlIGluc2VydGVkCiAgICAgICAgaWYgKCFhbHRlcikgewogICAgICAgICAg\nICBpZiAoY29sLmdldERlZmF1bHRTdHJpbmcoKSAhPSBudWxsICYmICFjb2wu\naXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBERUZBVUxUICIpLmFwcGVuZChjb2wuZ2V0RGVmYXVsdFN0cmluZygpKTsK\nICAgICAgICAgICAgaWYgKGNvbC5pc05vdE51bGwoKSkKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiBOT1QgTlVMTCIpOwogICAgICAgIH0KICAgICAg\nICBpZiAoY29sLmlzQXV0b0Fzc2lnbmVkKCkpIHsKICAgICAgICAgICAgaWYg\nKCFzdXBwb3J0c0F1dG9Bc3NpZ24pCiAgICAgICAgICAgICAgICBsb2cud2Fy\nbihfbG9jLmdldCgiaW52YWxpZC1hdXRvYXNzaWduIiwgcGxhdGZvcm0sIGNv\nbCkpOwogICAgICAgICAgICBlbHNlIGlmIChhdXRvQXNzaWduQ2xhdXNlICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5k\nKGF1dG9Bc3NpZ25DbGF1c2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdpdmVuIHByaW1hcnkga2V5\nLiBUaGlzIG1ldGhvZCBpcwogICAgICogdXNlZCBmcm9tIHdpdGhpbiB7QGxp\nbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQKICAgICAqIHtAbGluayAjZ2V0\nQWRkUHJpbWFyeUtleVNRTH0uIFJldHVybnMKICAgICAqIDxjb2RlPkNPTlNU\nUkFJTlQgJmx0O3BrIG5hbWUmZ3Q7IFBSSU1BUlkgS0VZICgmbHQ7Y29sIGxp\nc3QmZ3Q7KTwvY29kZT4KICAgICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0UHJpbWFyeUtleUNvbnN0cmFpbnRTUUwo\nUHJpbWFyeUtleSBwaykgewogICAgICAgIC8vIGlmIHdlIGhhdmUgZGlzYWJs\nZWQgdGhlIGNyZWF0aW9uIG9mIHByaW1hcnkga2V5cywgYWJvcnQgaGVyZQog\nICAgICAgIGlmICghY3JlYXRlUHJpbWFyeUtleXMpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgbmFtZSA9IHBrLmdldE5hbWUo\nKTsKICAgICAgICBpZiAobmFtZSAhPSBudWxsICYmIHJlc2VydmVkV29yZFNl\ndC5jb250YWlucyhuYW1lLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICBu\nYW1lID0gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAobmFtZSAhPSBudWxsICYmIENP\nTlNfTkFNRV9CRUZPUkUuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5kKG5h\nbWUpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlBSSU1BUlkg\nS0VZICIpOwogICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgQ09OU19OQU1F\nX01JRC5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAg\nYnVmLmFwcGVuZChuYW1lKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBw\nZW5kKCIoIikuYXBwZW5kKFN0cmluZ3Muam9pbihway5nZXRDb2x1bW5zKCks\nICIsICIpKS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CiAgICAgICAgaWYg\nKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0\ncmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05T\nVFJBSU5UICIpLmFwcGVuZChuYW1lKTsKICAgICAgICByZXR1cm4gYnVmLnRv\nU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRl\nY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdpdmVuIGZvcmVpZ24ga2V5LCBvciBu\ndWxsIGlmIGl0IGlzCiAgICAgKiBub3Qgc3VwcG9ydGVkLiBUaGlzIG1ldGhv\nZCBpcyB1c2VkIGZyb20gd2l0aGluCiAgICAgKiB7QGxpbmsgI2dldENyZWF0\nZVRhYmxlU1FMfSBhbmQge0BsaW5rICNnZXRBZGRGb3JlaWduS2V5U1FMfS4g\nUmV0dXJucwogICAgICogPGNvZGU+Q09OU1RSQUlOVCAmbHQ7Y29ucyBuYW1l\nJmd0OyBGT1JFSUdOIEtFWSAoJmx0O2NvbCBsaXN0Jmd0OykKICAgICAqIFJF\nRkVSRU5DRVMgJmx0O2ZvcmVpZ24gdGFibGUmZ3Q7ICgmbHQ7Y29sIGxpc3Qm\nZ3Q7KQogICAgICogW09OIERFTEVURSAmbHQ7YWN0aW9uJmd0O10gW09OIFVQ\nREFURSAmbHQ7YWN0aW9uJmd0O108L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Rm9yZWlnbktleUNvbnN0cmFp\nbnRTUUwoRm9yZWlnbktleSBmaykgewogICAgICAgIGlmICghc3VwcG9ydHNG\nb3JlaWduS2V5cykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKGZrLmdldERlbGV0ZUFjdGlvbigpID09IEZvcmVpZ25LZXkuQUNUSU9O\nX05PTkUpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChm\nay5pc0RlZmVycmVkKCkgJiYgIXN1cHBvcnRzRGVmZXJyZWRGb3JlaWduS2V5\nQ29uc3RyYWludHMoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaWYgKCFzdXBwb3J0c0RlbGV0ZUFjdGlvbihmay5nZXREZWxldGVBY3Rp\nb24oKSkKICAgICAgICAgICAgfHwgIXN1cHBvcnRzVXBkYXRlQWN0aW9uKGZr\nLmdldFVwZGF0ZUFjdGlvbigpKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENvbHVtbltdIGxvY2FscyA9IGZrLmdldENvbHVtbnMoKTsK\nICAgICAgICBDb2x1bW5bXSBmb3JlaWducyA9IGZrLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CgogICAgICAgIGludCBkZWxBY3Rpb25JZCA9IGZrLmdldERl\nbGV0ZUFjdGlvbigpOwogICAgICAgIGlmIChkZWxBY3Rpb25JZCA9PSBGb3Jl\naWduS2V5LkFDVElPTl9OVUxMKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbG9jYWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAobG9jYWxzW2ldLmlzTm90TnVsbCgpKQogICAgICAgICAgICAgICAg\nICAgIGRlbEFjdGlvbklkID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGRlbEFjdGlv\nbiA9IGdldEFjdGlvbk5hbWUoZGVsQWN0aW9uSWQpOwogICAgICAgIFN0cmlu\nZyB1cEFjdGlvbiA9IGdldEFjdGlvbk5hbWUoZmsuZ2V0VXBkYXRlQWN0aW9u\nKCkpOwoKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1\nZmZlcigpOwogICAgICAgIGlmIChmay5nZXROYW1lKCkgIT0gbnVsbAogICAg\nICAgICAgICAmJiBDT05TX05BTUVfQkVGT1JFLmVxdWFscyhjb25zdHJhaW50\nTmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJDT05TVFJBSU5U\nICIpLmFwcGVuZChmay5nZXROYW1lKCkpLmFwcGVuZCgiICIpOwogICAgICAg\nIGJ1Zi5hcHBlbmQoIkZPUkVJR04gS0VZICIpOwogICAgICAgIGlmIChmay5n\nZXROYW1lKCkgIT0gbnVsbCAmJiBDT05TX05BTUVfTUlELmVxdWFscyhjb25z\ndHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKGZrLmdl\ndE5hbWUoKSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIp\nLmFwcGVuZChTdHJpbmdzLmpvaW4obG9jYWxzLCAiLCAiKSkuYXBwZW5kKCIp\nIik7CiAgICAgICAgYnVmLmFwcGVuZCgiIFJFRkVSRU5DRVMgIik7CiAgICAg\nICAgYnVmLmFwcGVuZChnZXRGdWxsTmFtZShmb3JlaWduc1swXS5nZXRUYWJs\nZSgpLCBmYWxzZSkpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAoIikuYXBwZW5k\nKFN0cmluZ3Muam9pbihmb3JlaWducywgIiwgIikpLmFwcGVuZCgiKSIpOwog\nICAgICAgIGlmIChkZWxBY3Rpb24gIT0gbnVsbCkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIE9OIERFTEVURSAiKS5hcHBlbmQoZGVsQWN0aW9uKTsKICAg\nICAgICBpZiAodXBBY3Rpb24gIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIE9OIFVQREFURSAiKS5hcHBlbmQodXBBY3Rpb24pOwogICAgICAg\nIGlmIChmay5pc0RlZmVycmVkKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBJTklUSUFMTFkgREVGRVJSRUQiKTsKICAgICAgICBpZiAoc3VwcG9ydHNE\nZWZlcnJlZEZvcmVpZ25LZXlDb25zdHJhaW50cygpKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgREVGRVJSQUJMRSIpOwogICAgICAgIGlmIChmay5nZXRO\nYW1lKCkgIT0gbnVsbAogICAgICAgICAgICAmJiBDT05TX05BTUVfQUZURVIu\nZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBDT05TVFJBSU5UICIpLmFwcGVuZChmay5nZXROYW1lKCkpOwog\nICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgb3Igbm90IHRoaXMgZGljdGlvbmFyeSBzdXBwb3J0\ncyBkZWZlcnJlZCBmb3JlaWduIGtleSBjb25zdHJhaW50cy4KICAgICAqIFRo\naXMgaW1wbGVtZW50YXRpb24gcmV0dXJucyB7QGxpbmsgI3N1cHBvcnRzVW5p\ncXVlQ29uc3RyYWludHN9LgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAog\nICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdXBwb3J0c0RlZmVycmVk\nRm9yZWlnbktleUNvbnN0cmFpbnRzKCkgewogICAgICAgIHJldHVybiBzdXBw\nb3J0c0RlZmVycmVkQ29uc3RyYWludHM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGFj\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0QWN0aW9uTmFt\nZShpbnQgYWN0aW9uKSB7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAg\nICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9DQVNDQURFOgogICAg\nICAgICAgICAgICAgcmV0dXJuICJDQVNDQURFIjsKICAgICAgICAgICAgY2Fz\nZSBGb3JlaWduS2V5LkFDVElPTl9OVUxMOgogICAgICAgICAgICAgICAgcmV0\ndXJuICJTRVQgTlVMTCI7CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5B\nQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiAiU0VUIERF\nRkFVTFQiOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGlzIGRhdGFiYXNlIHN1cHBvcnRzIHRoZSBnaXZlbiBmb3Jl\naWduIGtleSBkZWxldGUgYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBzdXBwb3J0c0RlbGV0ZUFjdGlvbihpbnQgYWN0aW9uKSB7CiAgICAg\nICAgaWYgKGFjdGlvbiA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9y\nZWlnbktleXMpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBz\nd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXku\nQUNUSU9OX1JFU1RSSUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBv\ncnRzUmVzdHJpY3REZWxldGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9y\nZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJldHVy\nbiBzdXBwb3J0c0Nhc2NhZGVEZWxldGVBY3Rpb247CiAgICAgICAgICAgIGNh\nc2UgRm9yZWlnbktleS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb247CiAgICAgICAgICAgIGNh\nc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBwb3J0c0RlZmF1bHREZWxldGVBY3Rpb247CiAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIGRh\ndGFiYXNlIHN1cHBvcnRzIHRoZSBnaXZlbiBmb3JlaWduIGtleSB1cGRhdGUg\nYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Vw\nZGF0ZUFjdGlvbihpbnQgYWN0aW9uKSB7CiAgICAgICAgaWYgKGFjdGlvbiA9\nPSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBzd2l0Y2ggKGFjdGlvbikg\newogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNU\nOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzUmVzdHJpY3RVcGRh\ndGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05f\nQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c0Nhc2Nh\nZGVVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5B\nQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c051\nbGxVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5B\nQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0\nc0RlZmF1bHRVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9y\nIHRoZSBnaXZlbiB1bmlxdWUgY29uc3RyYWludC4gVGhpcwogICAgICogbWV0\naG9kIGlzIHVzZWQgZnJvbSB3aXRoaW4ge0BsaW5rICNnZXRDcmVhdGVUYWJs\nZVNRTH0uCiAgICAgKiBSZXR1cm5zCTxjb2RlPkNPTlNUUkFJTlQgJmx0O25h\nbWUmZ3Q7IFVOSVFVRSAoJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+CiAgICAg\nKiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\ndFVuaXF1ZUNvbnN0cmFpbnRTUUwoVW5pcXVlIHVucSkgewogICAgICAgIGlm\nICghc3VwcG9ydHNVbmlxdWVDb25zdHJhaW50cwogICAgICAgICAgICB8fCAo\ndW5xLmlzRGVmZXJyZWQoKSAmJiAhc3VwcG9ydHNEZWZlcnJlZFVuaXF1ZUNv\nbnN0cmFpbnRzKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAg\nICAgICBpZiAodW5xLmdldE5hbWUoKSAhPSBudWxsCiAgICAgICAgICAgICYm\nIENPTlNfTkFNRV9CRUZPUkUuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5k\nKHVucS5nZXROYW1lKCkpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIlVOSVFVRSAiKTsKICAgICAgICBpZiAodW5xLmdldE5hbWUoKSAhPSBu\ndWxsICYmIENPTlNfTkFNRV9NSUQuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9k\nZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQodW5xLmdldE5hbWUoKSkuYXBw\nZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChTdHJp\nbmdzLmpvaW4odW5xLmdldENvbHVtbnMoKSwgIiwgIikpLgogICAgICAgICAg\nICBhcHBlbmQoIikiKTsKICAgICAgICBpZiAodW5xLmlzRGVmZXJyZWQoKSkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElOSVRJQUxMWSBERUZFUlJFRCIp\nOwogICAgICAgIGlmIChzdXBwb3J0c0RlZmVycmVkVW5pcXVlQ29uc3RyYWlu\ndHMoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIERFRkVSUkFCTEUiKTsK\nICAgICAgICBpZiAodW5xLmdldE5hbWUoKSAhPSBudWxsCiAgICAgICAgICAg\nICYmIENPTlNfTkFNRV9BRlRFUi5lcXVhbHMoY29uc3RyYWludE5hbWVNb2Rl\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIENPTlNUUkFJTlQgIikuYXBw\nZW5kKHVucS5nZXROYW1lKCkpOwogICAgICAgIHJldHVybiBidWYudG9TdHJp\nbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90IHRo\naXMgZGljdGlvbmFyeSBzdXBwb3J0cyBkZWZlcnJlZCB1bmlxdWUgY29uc3Ry\nYWludHMuCiAgICAgKiBUaGlzIGltcGxlbWVudGF0aW9uIHJldHVybnMge0Bs\naW5rICNzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzfS4KICAgICAqCiAgICAg\nKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4g\nc3VwcG9ydHNEZWZlcnJlZFVuaXF1ZUNvbnN0cmFpbnRzKCkgewogICAgICAg\nIHJldHVybiBzdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHM7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBEYXRhYmFzZSBtZXRh\nZGF0YQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZpbHRlciBzeXN0ZW0gdGFibGVz\nIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBp\nZiB0aGUgZ2l2ZW4gdGFibGUgbmFtZSByZXByZXNlbnRzIGEgc3lzdGVtIHRh\nYmxlIHRoYXQKICAgICAqIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hl\nbWEgZGVmaW5pdGlvbi4gQnkgZGVmYXVsdCwgcmV0dXJucwogICAgICogdHJ1\nZSBvbmx5IGlmIHRoZSBnaXZlbiB0YWJsZSBpcyBpbiB0aGUgaW50ZXJuYWwg\nbGlzdCBvZiBzeXN0ZW0gdGFibGVzLAogICAgICogb3IgaWYgdGhlIGdpdmVu\nIHNjaGVtYSBpcyBpbiB0aGUgbGlzdCBvZiBzeXN0ZW0gc2NoZW1hcyBhbmQg\naXMgbm90CiAgICAgKiB0aGUgdGFyZ2V0IHNjaGVtYS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gbmFtZSB0aGUgdGFibGUgbmFtZQogICAgICogQHBhcmFtIHNj\naGVtYSB0aGUgdGFibGUgc2NoZW1hOyBtYXkgYmUgbnVsbAogICAgICogQHBh\ncmFtIHRhcmdldFNjaGVtYSBpZiB0cnVlLCB0aGVuIHRoZSBnaXZlbiBzY2hl\nbWEgd2FzIGxpc3RlZCBieQogICAgICogdGhlIHVzZXIgYXMgb25lIG9mIGhp\ncyBzY2hlbWFzCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVt\nVGFibGUoU3RyaW5nIG5hbWUsIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9v\nbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAgICAgICBpZiAoc3lzdGVtVGFibGVT\nZXQuY29udGFpbnMobmFtZS50b1VwcGVyQ2FzZSgpKSkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuICF0YXJnZXRTY2hlbWEgJiYg\nc2NoZW1hICE9IG51bGwKICAgICAgICAgICAgJiYgc3lzdGVtU2NoZW1hU2V0\nLmNvbnRhaW5zKHNjaGVtYS50b1VwcGVyQ2FzZSgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3Rl\nbSBpbmRleGVzIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1\ncm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gaW5kZXggbmFtZSByZXByZXNlbnRzIGEg\nc3lzdGVtIGluZGV4IHRoYXQKICAgICAqIHNob3VsZCBub3QgYXBwZWFyIGlu\nIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gUmV0dXJucyBmYWxzZSBieSBkZWZh\ndWx0LgogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIHRoZSBpbmRleCBuYW1l\nCiAgICAgKiBAcGFyYW0gdGFibGUgdGhlIGluZGV4IHRhYmxlCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtSW5kZXgoU3RyaW5nIG5hbWUs\nIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIg\nc3lzdGVtIHNlcXVlbmNlcyBmcm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHNlcXVlbmNlIHJlcHJlc2Vu\ndHMgYSBzeXN0ZW0gc2VxdWVuY2UgdGhhdAogICAgICogc2hvdWxkIG5vdCBh\ncHBlYXIgaW4gdGhlIHNjaGVtYSBkZWZpbml0aW9uLiBSZXR1cm5zIHRydWUg\naWYgc3lzdGVtCiAgICAgKiBzY2hlbWEgYnkgZGVmYXVsdC4KICAgICAqCiAg\nICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFibGUgbmFtZQogICAgICogQHBhcmFt\nIHNjaGVtYSB0aGUgdGFibGUgc2NoZW1hOyBtYXkgYmUgbnVsbAogICAgICog\nQHBhcmFtIHRhcmdldFNjaGVtYSBpZiB0cnVlLCB0aGVuIHRoZSBnaXZlbiBz\nY2hlbWEgd2FzIGxpc3RlZCBieQogICAgICogdGhlIHVzZXIgYXMgb25lIG9m\nIGhpcyBzY2hlbWFzCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzU3lz\ndGVtU2VxdWVuY2UoU3RyaW5nIG5hbWUsIFN0cmluZyBzY2hlbWEsCiAgICAg\nICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAgICAgICByZXR1cm4gIXRh\ncmdldFNjaGVtYSAmJiBzY2hlbWEgIT0gbnVsbAogICAgICAgICAgICAmJiBz\neXN0ZW1TY2hlbWFTZXQuY29udGFpbnMoc2NoZW1hLnRvVXBwZXJDYXNlKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1h\nIHRvIGZpbmQgdGFibGVzIG1hdGNoaW5nIHRoZSBnaXZlbiBuYW1lIHBhdHRl\ncm4uCiAgICAgKi8KICAgIHB1YmxpYyBUYWJsZVtdIGdldFRhYmxlcyhEYXRh\nYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0\ncmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9u\nIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKCFzdXBwb3J0c1NjaGVtYUZvckdldFRhYmxlcykKICAgICAgICAgICAg\nc2NoZW1hTmFtZSA9IG51bGw7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\nY2hlbWFOYW1lID0gZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5h\nbWUpOwoKICAgICAgICBTdHJpbmdbXSB0eXBlcyA9IFN0cmluZ3Muc3BsaXQo\ndGFibGVUeXBlcywgIiwiLCAwKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHR5cGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB0eXBlc1tpXSA9\nIHR5cGVzW2ldLnRyaW0oKTsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVy\nYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0U2V0IHRhYmxlcyA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGFibGVzID0gbWV0YS5nZXRU\nYWJsZXMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9nKSwKICAg\nICAgICAgICAgICAgIHNjaGVtYU5hbWUsIGdldFRhYmxlTmFtZUZvck1ldGFk\nYXRhKHRhYmxlTmFtZSksIHR5cGVzKTsKICAgICAgICAgICAgTGlzdCB0YWJs\nZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlICh0\nYWJsZXMgIT0gbnVsbCAmJiB0YWJsZXMubmV4dCgpKQogICAgICAgICAgICAg\nICAgdGFibGVMaXN0LmFkZChuZXdUYWJsZSh0YWJsZXMpKTsKICAgICAgICAg\nICAgcmV0dXJuIChUYWJsZVtdKSB0YWJsZUxpc3QudG9BcnJheShuZXcgVGFi\nbGVbdGFibGVMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGlmICh0YWJsZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdGFibGVzLmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyB0YWJsZSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUg\nc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgVGFibGUg\nbmV3VGFibGUoUmVzdWx0U2V0IHRhYmxlTWV0YSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBUYWJsZSB0ID0gbmV3IFRhYmxlKCk7\nCiAgICAgICAgdC5zZXROYW1lKHRhYmxlTWV0YS5nZXRTdHJpbmcoIlRBQkxF\nX05BTUUiKSk7CiAgICAgICAgcmV0dXJuIHQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBzZXF1ZW5jZXMg\nbWF0Y2hpbmcgdGhlIGdpdmVuIG5hbWUgcGF0dGVybi4KICAgICAqIFJldHVy\nbnMgYW4gZW1wdHkgYXJyYXkgYnkgZGVmYXVsdCwgYXMgdGhlcmUgaXMgbm8g\nc3RhbmRhcmQgd2F5IHRvCiAgICAgKiByZXRyaWV2ZSBhIGxpc3Qgb2Ygc2Vx\ndWVuY2VzLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VbXSBnZXRTZXF1\nZW5jZXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywK\nICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFt\nZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIFN0cmluZyBzdHIgPSBnZXRTZXF1ZW5jZXNTUUwoc2No\nZW1hTmFtZSwgc2VxdWVuY2VOYW1lKTsKICAgICAgICBpZiAoc3RyID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU2VxdWVuY2VbMF07CgogICAg\nICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gcHJlcGFyZVN0YXRlbWVu\ndChjb25uLCBzdHIpOyAgICAgICAgCiAgICAgICAgUmVzdWx0U2V0IHJzID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgaWR4ID0gMTsK\nICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHN0bW50LnNldFN0cmluZyhpZHgrKywgc2NoZW1hTmFtZS50b1Vw\ncGVyQ2FzZSgpKTsKICAgICAgICAgICAgaWYgKHNlcXVlbmNlTmFtZSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgc3RtbnQuc2V0U3RyaW5nKGlkeCsrLCBz\nZXF1ZW5jZU5hbWUpOwoKICAgICAgICAgICAgcnMgPSBleGVjdXRlUXVlcnko\nY29ubiwgc3RtbnQsIHN0cik7CiAgICAgICAgICAgIHJldHVybiBnZXRTZXF1\nZW5jZShycyk7ICAgICAgICAgICAgCiAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9zZSgpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKSAgICAKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc3RtbnQu\nY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzZXF1ZW5jZSBmcm9tIHRoZSBp\nbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU2VxdWVuY2UgbmV3U2VxdWVuY2UoUmVzdWx0U2V0IHNl\ncXVlbmNlTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBTZXF1ZW5jZSBzZXEgPSBuZXcgU2VxdWVuY2UoKTsKICAgICAgICBz\nZXEuc2V0U2NoZW1hTmFtZShzZXF1ZW5jZU1ldGEuZ2V0U3RyaW5nKCJTRVFV\nRU5DRV9TQ0hFTUEiKSk7CiAgICAgICAgc2VxLnNldE5hbWUoc2VxdWVuY2VN\nZXRhLmdldFN0cmluZygiU0VRVUVOQ0VfTkFNRSIpKTsKICAgICAgICByZXR1\ncm4gc2VxOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBTUUwg\nbmVlZGVkIHRvIHNlbGVjdCB0aGUgbGlzdCBvZiBzZXF1ZW5jZXMuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2VzU1FMKFN0cmlu\nZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lKSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9u\nIHRoZSBzY2hlbWEgdG8gZmluZCBjb2x1bW5zIG1hdGNoaW5nIHRoZSBnaXZl\nbiB0YWJsZSBhbmQKICAgICAqIGNvbHVtbiBwYXR0ZXJucy4KICAgICAqLwog\nICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0\nYSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1h\nTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5hbWUsIENv\nbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwgJiYgIXN1cHBvcnRzTnVs\nbFRhYmxlRm9yR2V0Q29sdW1ucykKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIGlmICghc3VwcG9ydHNTY2hlbWFGb3JHZXRDb2x1bW5zKQog\nICAgICAgICAgICBzY2hlbWFOYW1lID0gbnVsbDsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHNjaGVtYU5hbWUgPSBnZXRTY2hlbWFOYW1lRm9yTWV0YWRh\ndGEoc2NoZW1hTmFtZSk7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0\naW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBjb2xzID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBjb2xzID0gbWV0YS5nZXRDb2x1bW5z\nKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyksCiAgICAgICAg\nICAgICAgICBzY2hlbWFOYW1lLCBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0\nYWJsZU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0Q29sdW1uTmFtZUZvck1l\ndGFkYXRhKGNvbHVtbk5hbWUpKTsKCiAgICAgICAgICAgIExpc3QgY29sdW1u\nTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKGNv\nbHMgIT0gbnVsbCAmJiBjb2xzLm5leHQoKSkKICAgICAgICAgICAgICAgIGNv\nbHVtbkxpc3QuYWRkKG5ld0NvbHVtbihjb2xzKSk7CiAgICAgICAgICAgIHJl\ndHVybiAoQ29sdW1uW10pIGNvbHVtbkxpc3QudG9BcnJheQogICAgICAgICAg\nICAgICAgKG5ldyBDb2x1bW5bY29sdW1uTGlzdC5zaXplKCldKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoY29scyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb2xz\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBjb2x1bW4gZnJvbSB0aGUgaW5mb3Jt\nYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIENvbHVtbiBuZXdDb2x1bW4oUmVzdWx0U2V0IGNvbE1ldGEpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGMg\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgYy5zZXRTY2hlbWFOYW1lKGNvbE1l\ndGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIpKTsKICAgICAgICBjLnNldFRh\nYmxlTmFtZShjb2xNZXRhLmdldFN0cmluZygiVEFCTEVfTkFNRSIpKTsKICAg\nICAgICBjLnNldE5hbWUoY29sTWV0YS5nZXRTdHJpbmcoIkNPTFVNTl9OQU1F\nIikpOwogICAgICAgIGMuc2V0VHlwZShjb2xNZXRhLmdldEludCgiREFUQV9U\nWVBFIikpOwogICAgICAgIGMuc2V0VHlwZU5hbWUoY29sTWV0YS5nZXRTdHJp\nbmcoIlRZUEVfTkFNRSIpKTsKICAgICAgICBjLnNldFNpemUoY29sTWV0YS5n\nZXRJbnQoIkNPTFVNTl9TSVpFIikpOwogICAgICAgIGMuc2V0RGVjaW1hbERp\nZ2l0cyhjb2xNZXRhLmdldEludCgiREVDSU1BTF9ESUdJVFMiKSk7CiAgICAg\nICAgYy5zZXROb3ROdWxsKGNvbE1ldGEuZ2V0SW50KCJOVUxMQUJMRSIpCiAg\nICAgICAgICAgID09IERhdGFiYXNlTWV0YURhdGEuY29sdW1uTm9OdWxscyk7\nCgogICAgICAgIFN0cmluZyBkZWYgPSBjb2xNZXRhLmdldFN0cmluZygiQ09M\nVU1OX0RFRiIpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShk\nZWYpICYmICEibnVsbCIuZXF1YWxzSWdub3JlQ2FzZShkZWYpKQogICAgICAg\nICAgICBjLnNldERlZmF1bHRTdHJpbmcoZGVmKTsKICAgICAgICByZXR1cm4g\nYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVt\nYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhlIGdpdmVuIHRhYmxlIHBh\ndHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBQcmltYXJ5S2V5W10gZ2V0UHJp\nbWFyeUtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLAogICAgICAgIFN0cmlu\nZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFt\nZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICh1c2VHZXRCZXN0Um93SWRlbnRpZmllckZvclBy\naW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4gZ2V0UHJpbWFyeUtleXNG\ncm9tQmVzdFJvd0lkZW50aWZpZXIobWV0YSwgY2F0YWxvZywKICAgICAgICAg\nICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwgY29ubik7CiAgICAgICAg\ncmV0dXJuIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1hcnlLZXlzKG1ldGEs\nIGNhdGFsb2csCiAgICAgICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwg\nY29ubik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBz\nY2hlbWEgdG8gZmluZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJs\nZSBwYXR0ZXJuLgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJpbWFyeUtleVtd\nIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1hcnlLZXlzCiAgICAgICAgKERh\ndGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBz\nY2hlbWFOYW1lLAogICAgICAgICAgICBTdHJpbmcgdGFibGVOYW1lLCBDb25u\nZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBwb3J0c051bGxU\nYWJsZUZvckdldFByaW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAg\nICAgICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcGtzID0gbWV0YS5nZXRQcmltYXJ5S2V5cyhnZXRDYXRhbG9n\nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgZ2V0\nU2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAgICAg\nICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSk7Cgog\nICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxsICYmIHBrcy5uZXh0KCkpCiAg\nICAgICAgICAgICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocGtzKSk7\nCiAgICAgICAgICAgIHJldHVybiAoUHJpbWFyeUtleVtdKSBwa0xpc3QudG9B\ncnJheQogICAgICAgICAgICAgICAgKG5ldyBQcmltYXJ5S2V5W3BrTGlzdC5z\naXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\ncGtzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIHBrcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcHJpbWFyeSBr\nZXkgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlLZXkgbmV3UHJpbWFy\neUtleShSZXN1bHRTZXQgcGtNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIFByaW1hcnlLZXkgcGsgPSBuZXcgUHJpbWFyeUtl\neSgpOwogICAgICAgIHBrLnNldFNjaGVtYU5hbWUocGtNZXRhLmdldFN0cmlu\nZygiVEFCTEVfU0NIRU0iKSk7CiAgICAgICAgcGsuc2V0VGFibGVOYW1lKHBr\nTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAgICAgcGsuc2V0\nQ29sdW1uTmFtZShwa01ldGEuZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpKTsK\nICAgICAgICBway5zZXROYW1lKHBrTWV0YS5nZXRTdHJpbmcoIlBLX05BTUUi\nKSk7CiAgICAgICAgcmV0dXJuIHBrOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBrZXlzIGZv\nciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21CZXN0Um93SWRl\nbnRpZmllcgogICAgICAgIChEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmlu\nZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwKICAgICAgICAgICAgU3Ry\naW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1l\ndGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBwa3Mg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBrcyA9IG1ldGEu\nZ2V0QmVzdFJvd0lkZW50aWZpZXIoY2F0YWxvZywgc2NoZW1hTmFtZSwKICAg\nICAgICAgICAgICAgIHRhYmxlTmFtZSwgMCwgZmFsc2UpOwoKICAgICAgICAg\nICAgTGlzdCBwa0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAg\nIHdoaWxlIChwa3MgIT0gbnVsbCAmJiBwa3MubmV4dCgpKSB7CiAgICAgICAg\nICAgICAgICBQcmltYXJ5S2V5IHBrID0gbmV3IFByaW1hcnlLZXkoKTsKICAg\nICAgICAgICAgICAgIHBrLnNldFNjaGVtYU5hbWUoc2NoZW1hTmFtZSk7CiAg\nICAgICAgICAgICAgICBway5zZXRUYWJsZU5hbWUodGFibGVOYW1lKTsKICAg\nICAgICAgICAgICAgIHBrLnNldENvbHVtbk5hbWUocGtzLmdldFN0cmluZygi\nQ09MVU1OX05BTUUiKSk7CiAgICAgICAgICAgICAgICBwa0xpc3QuYWRkKHBr\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKFByaW1hcnlL\nZXlbXSkgcGtMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgUHJp\nbWFyeUtleVtwa0xpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKHBrcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBwa3MuY2xvc2UoKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVj\ndCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgaW5kZXhlcyBtYXRjaGluZyB0aGUg\nZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHVibGljIEluZGV4\nW10gZ2V0SW5kZXhJbmZvKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5n\nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0\nYWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVlLAogICAgICAgIGJvb2xlYW4gYXBw\ncm94LCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBw\nb3J0c051bGxUYWJsZUZvckdldEluZGV4SW5mbykKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNv\nbm4pOwogICAgICAgIFJlc3VsdFNldCBpbmRleGVzID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpbmRleGVzID0gbWV0YS5nZXRJbmRleElu\nZm8oZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9nKSwKICAgICAg\nICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShzY2hlbWFOYW1l\nKSwKICAgICAgICAgICAgICAgIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHRh\nYmxlTmFtZSksIHVuaXF1ZSwgYXBwcm94KTsKCiAgICAgICAgICAgIExpc3Qg\naW5kZXhMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGls\nZSAoaW5kZXhlcyAhPSBudWxsICYmIGluZGV4ZXMubmV4dCgpKQogICAgICAg\nICAgICAgICAgaW5kZXhMaXN0LmFkZChuZXdJbmRleChpbmRleGVzKSk7CiAg\nICAgICAgICAgIHJldHVybiAoSW5kZXhbXSkgaW5kZXhMaXN0LnRvQXJyYXko\nbmV3IEluZGV4W2luZGV4TGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAoaW5kZXhlcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpbmRleGVzLmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhIG5ldyBpbmRleCBmcm9tIHRoZSBpbmZvcm1hdGlv\nbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0\nZWQgSW5kZXggbmV3SW5kZXgoUmVzdWx0U2V0IGlkeE1ldGEpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgSW5kZXggaWR4ID0gbmV3\nIEluZGV4KCk7CiAgICAgICAgaWR4LnNldFNjaGVtYU5hbWUoaWR4TWV0YS5n\nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIikpOwogICAgICAgIGlkeC5zZXRUYWJs\nZU5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAg\nICAgaWR4LnNldENvbHVtbk5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIkNPTFVN\nTl9OQU1FIikpOwogICAgICAgIGlkeC5zZXROYW1lKGlkeE1ldGEuZ2V0U3Ry\naW5nKCJJTkRFWF9OQU1FIikpOwogICAgICAgIGlkeC5zZXRVbmlxdWUoIWlk\neE1ldGEuZ2V0Qm9vbGVhbigiTk9OX1VOSVFVRSIpKTsKICAgICAgICByZXR1\ncm4gaWR4OwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUg\nc2NoZW1hIHRvIHJldHVybiBmb3JlaWduIGtleXMgaW1wb3J0ZWQgYnkgdGhl\nIGdpdmVuCiAgICAgKiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJs\naWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFE\nYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hl\nbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzdXBw\nb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAodGFibGVOYW1lID09IG51bGwgJiYgIXN1cHBvcnRzTnVsbFRh\nYmxlRm9yR2V0SW1wb3J0ZWRLZXlzKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAg\nICAgICAgUmVzdWx0U2V0IGtleXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGtleXMgPSBtZXRhLmdldEltcG9ydGVkS2V5cyhnZXRDYXRh\nbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAg\nZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAg\nICAgICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSk7\nCgogICAgICAgICAgICBMaXN0IGltcG9ydGVkS2V5TGlzdCA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKGtleXMgIT0gbnVsbCAmJiBr\nZXlzLm5leHQoKSkKICAgICAgICAgICAgICAgIGltcG9ydGVkS2V5TGlzdC5h\nZGQobmV3Rm9yZWlnbktleShrZXlzKSk7CiAgICAgICAgICAgIHJldHVybiAo\nRm9yZWlnbktleVtdKSBpbXBvcnRlZEtleUxpc3QudG9BcnJheQogICAgICAg\nICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2ltcG9ydGVkS2V5TGlzdC5zaXpl\nKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoa2V5\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBrZXlzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBmb3JlaWduIGtl\neSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRh\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgRm9yZWlnbktleSBuZXdGb3JlaWdu\nS2V5KFJlc3VsdFNldCBma01ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRm9yZWlnbktleSBmayA9IG5ldyBGb3JlaWduS2V5\nKCk7CiAgICAgICAgZmsuc2V0U2NoZW1hTmFtZShma01ldGEuZ2V0U3RyaW5n\nKCJGS1RBQkxFX1NDSEVNIikpOwogICAgICAgIGZrLnNldFRhYmxlTmFtZShm\na01ldGEuZ2V0U3RyaW5nKCJGS1RBQkxFX05BTUUiKSk7CiAgICAgICAgZmsu\nc2V0Q29sdW1uTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS0NPTFVNTl9OQU1F\nIikpOwogICAgICAgIGZrLnNldE5hbWUoZmtNZXRhLmdldFN0cmluZygiRktf\nTkFNRSIpKTsKICAgICAgICBmay5zZXRQcmltYXJ5S2V5U2NoZW1hTmFtZShm\na01ldGEuZ2V0U3RyaW5nKCJQS1RBQkxFX1NDSEVNIikpOwogICAgICAgIGZr\nLnNldFByaW1hcnlLZXlUYWJsZU5hbWUoZmtNZXRhLmdldFN0cmluZygiUEtU\nQUJMRV9OQU1FIikpOwogICAgICAgIGZrLnNldFByaW1hcnlLZXlDb2x1bW5O\nYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBLQ09MVU1OX05BTUUiKSk7CiAgICAg\nICAgZmsuc2V0S2V5U2VxdWVuY2UoZmtNZXRhLmdldFNob3J0KCJLRVlfU0VR\nIikpOwogICAgICAgIGZrLnNldERlZmVycmVkKGZrTWV0YS5nZXRTaG9ydCgi\nREVGRVJSQUJJTElUWSIpCiAgICAgICAgICAgID09IERhdGFiYXNlTWV0YURh\ndGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCk7CgogICAgICAgIGlu\ndCBkZWwgPSBma01ldGEuZ2V0U2hvcnQoIkRFTEVURV9SVUxFIik7CiAgICAg\nICAgc3dpdGNoIChkZWwpIHsKICAgICAgICAgICAgY2FzZSBEYXRhYmFzZU1l\ndGFEYXRhLmltcG9ydGVkS2V5U2V0TnVsbDoKICAgICAgICAgICAgICAgIGZr\nLnNldERlbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9OVUxMKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIERhdGFiYXNl\nTWV0YURhdGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0OgogICAgICAgICAgICAg\nICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFV\nTFQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleUNhc2NhZGU6CiAgICAgICAg\nICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktleS5BQ1RJT05f\nQ0FTQ0FERSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihG\nb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZrOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0aGUgdGFibGUgbmFtZSB0aGF0IHdpbGwg\nYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9t\nIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFN0cmluZyBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YShTdHJpbmcgdGFi\nbGVOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKHRh\nYmxlTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBz\nY2hlbWEgbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGlu\nZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRh\nfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRTY2hlbWFOYW1l\nRm9yTWV0YWRhdGEoU3RyaW5nIHNjaGVtYU5hbWUpIHsKICAgICAgICBpZiAo\nc2NoZW1hTmFtZSA9PSBudWxsKQogICAgICAgICAgICBzY2hlbWFOYW1lID0g\nY29uZi5nZXRTY2hlbWEoKTsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVt\nYUNhc2Uoc2NoZW1hTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRoZSBjYXRhbG9nIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9i\ndGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJh\nc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nQ2F0YWxvZ05hbWVGb3JNZXRhZGF0YShTdHJpbmcgY2F0YWxvZ05hbWUpIHsK\nICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoY2F0YWxvZ05hbWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY29sdW1uIG5h\nbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlv\nbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q29sdW1uTmFtZUZvck1ldGFk\nYXRhKFN0cmluZyBjb2x1bW5OYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZl\ncnRTY2hlbWFDYXNlKGNvbHVtbk5hbWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIHNjaGVtYSBuYW1lIHRvIGEgbmFt\nZSB0aGF0IHRoZSBkYXRhYmFzZSB3aWxsCiAgICAgKiBiZSBhYmxlIHRvIHVu\nZGVyc3RhbmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgY29udmVy\ndFNjaGVtYUNhc2UoU3RyaW5nIG9iamVjdE5hbWUpIHsKICAgICAgICBpZiAo\nb2JqZWN0TmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgU3RyaW5nIHNjYXNlID0gZ2V0U2NoZW1hQ2FzZSgpOwogICAg\nICAgIGlmIChTQ0hFTUFfQ0FTRV9MT1dFUi5lcXVhbHMoc2Nhc2UpKQogICAg\nICAgICAgICByZXR1cm4gb2JqZWN0TmFtZS50b0xvd2VyQ2FzZSgpOwogICAg\nICAgIGlmIChTQ0hFTUFfQ0FTRV9QUkVTRVJWRS5lcXVhbHMoc2Nhc2UpKQog\nICAgICAgICAgICByZXR1cm4gb2JqZWN0TmFtZTsKICAgICAgICByZXR1cm4g\nb2JqZWN0TmFtZS50b1VwcGVyQ2FzZSgpOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFJldHVybiBEQiBzcGVjaWZpYyBzY2hlbWFDYXNlIAogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nIGdldFNjaGVtYUNhc2UoKXsKICAgICAgICBy\nZXR1cm4gc2NoZW1hQ2FzZTsKICAgIH0KICAgICAgICAKICAgIC8qKgogICAg\nICogUHJlcGFyZWQgdGhlIGNvbm5lY3Rpb24gZm9yIG1ldGFkYXRhIG9wZXJh\ndGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZvcmVNZXRhZGF0\nYU9wZXJhdGlvbihDb25uZWN0aW9uIGMpIHsKICAgICAgICBpZiAocmVxdWly\nZXNBdXRvQ29tbWl0Rm9yTWV0YURhdGEpIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGMucm9sbGJhY2soKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUpIHsKICAgICAgICAgICAgfQogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFjLmdldEF1dG9D\nb21taXQoKSkKICAgICAgICAgICAgICAgICAgICBjLnNldEF1dG9Db21taXQo\ndHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzcWxl\nKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFNlcXVlbmNlcyBhbmQg\nQXV0by1Bc3NpZ24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxhc3QgZ2VuZXJhdGVkIHZh\nbHVlIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICogVGhyb3dzIGFuIGV4\nY2VwdGlvbiBieSBkZWZhdWx0IGlmIHtAbGluayAjbGFzdEdlbmVyYXRlZEtl\neVF1ZXJ5fSBpcyBudWxsLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndEdlbmVyYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxhc3RH\nZW5lcmF0ZWRLZXlRdWVyeSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWF1dG8tYXNzaWduIikp\nOwoKICAgICAgICAvLyByZXBsYWNlIHRoaW5ncyBsaWtlICJTRUxFQ1QgTUFY\nKHswfSkgRlJPTSB7MX0iCiAgICAgICAgU3RyaW5nIHF1ZXJ5ID0gbGFzdEdl\nbmVyYXRlZEtleVF1ZXJ5OwogICAgICAgIGlmIChxdWVyeS5pbmRleE9mKCd7\nJykgIT0gLTEpIC8vIG9ubHkgaWYgdGhlIHRva2VuIGlzIGluIHRoZSBzdHJp\nbmcKICAgICAgICB7CiAgICAgICAgICAgIHF1ZXJ5ID0gTWVzc2FnZUZvcm1h\ndC5mb3JtYXQocXVlcnksIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAg\nIGNvbC5nZXROYW1lKCksIGdldEZ1bGxOYW1lKGNvbC5nZXRUYWJsZSgpLCBm\nYWxzZSksCiAgICAgICAgICAgICAgICBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5j\nZU5hbWUoY29sKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAg\nICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IHByZXBhcmVTdGF0ZW1lbnQo\nY29ubiwgcXVlcnkpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcnMgPSBleGVjdXRlUXVlcnkoY29u\nbiwgc3RtbnQsIHF1ZXJ5KTsKICAgICAgICAgICAgcmV0dXJuIGdldEtleShy\ncywgY29sKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\ncnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgaWYg\nKHN0bW50ICE9IG51bGwpICAgIAogICAgICAgICAgICAgICAgdHJ5IHsgc3Rt\nbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fSAKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNlcXVl\nbmNlIG5hbWUgdXNlZCBieSBkYXRhYmFzZXMgZm9yIHRoZSBnaXZlbiBhdXRv\nYXNzaWduZWQKICAgICAqIGNvbHVtbi4gVGhpcyBpcyBvbmx5IHVzZWQgYnkg\nZGF0YWJhc2VzIHRoYXQgcmVxdWlyZSBhbiBleHBsaWNpdCBuYW1lCiAgICAg\nKiB0byBiZSB1c2VkIGZvciBhdXRvLWFzc2lnbiBzdXBwb3J0LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldEdlbmVyYXRlZEtleVNlcXVlbmNl\nTmFtZShDb2x1bW4gY29sKSB7CiAgICAgICAgU3RyaW5nIHRuYW1lID0gY29s\nLmdldFRhYmxlTmFtZSgpOwogICAgICAgIFN0cmluZyBjbmFtZSA9IGNvbC5n\nZXROYW1lKCk7CiAgICAgICAgaW50IG1heCA9IG1heEF1dG9Bc3NpZ25OYW1l\nTGVuZ3RoOwogICAgICAgIGludCBleHRyYUNoYXJzID0gLW1heCArIHRuYW1l\nLmxlbmd0aCgpICsgMSAvLyA8dG5hbWU+ICsgJ18nCiAgICAgICAgICAgICsg\nY25hbWUubGVuZ3RoKCkgKyA0OyAvLyA8Y25hbWU+ICsgJ19TRVEnCiAgICAg\nICAgaWYgKGV4dHJhQ2hhcnMgPiAwKSB7CiAgICAgICAgICAgIC8vIHRoaXMg\nYXNzdW1lcyB0aGF0IHRuYW1lIGlzIGxvbmdlciB0aGFuIGV4dHJhQ2hhcnMK\nICAgICAgICAgICAgdG5hbWUgPSB0bmFtZS5zdWJzdHJpbmcoMCwgdG5hbWUu\nbGVuZ3RoKCkgLSBleHRyYUNoYXJzKTsKICAgICAgICB9CiAgICAgICAgU3Ry\naW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIobWF4KTsKICAgICAg\nICBidWYuYXBwZW5kKHRuYW1lKS5hcHBlbmQoIl8iKS5hcHBlbmQoY25hbWUp\nLmFwcGVuZCgiX1NFUSIpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmco\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBDb25maWd1cmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBz\nZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAg\nIHRoaXMuY29uZiA9IChKREJDQ29uZmlndXJhdGlvbikgY29uZjsKICAgICAg\nICB0aGlzLmxvZyA9IHRoaXMuY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRp\nb24uTE9HX0pEQkMpOwoKICAgICAgICAvLyB3YXJuIGFib3V0IHVuc3VwcG9y\ndGVkIGRpY3RzCiAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkgJiYg\nIWlzU3VwcG9ydGVkKCkpCiAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0\nKCJkaWN0LW5vdC1zdXBwb3J0ZWQiLCBnZXRDbGFzcygpKSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSBib29sZWFuIGlzU3VwcG9ydGVkKCkgewogICAgICAgIC8v\nIGlmIHRoaXMgaXMgYSBjdXN0b20gZGljdCwgdHJhdmVyc2UgdG8gd2hhdGV2\nZXIgb3BlbmpwYSBkaWN0IGl0IGV4dGVuZHMKICAgICAgICBDbGFzcyBjID0g\nZ2V0Q2xhc3MoKTsKICAgICAgICB3aGlsZSAoIWMuZ2V0TmFtZSgpLnN0YXJ0\nc1dpdGgoIm9yZy5hcGFjaGUub3BlbmpwYS4iKSkKICAgICAgICAgICAgYyA9\nIGMuZ2V0U3VwZXJjbGFzcygpOwoKICAgICAgICAvLyB0aGUgZ2VuZXJpYyBk\nYmRpY3Rpb25hcnkgaXMgbm90IGNvbnNpZGVyZWQgYSBzdXBwb3J0ZWQgZGlj\ndDsgYWxsCiAgICAgICAgLy8gb3RoZXIgY29uY3JldGUgZGljdGlvbmFyaWVz\nIGFyZQogICAgICAgIGlmIChjID09IERCRGljdGlvbmFyeS5jbGFzcykKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewog\nICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHNldCBvZiByZXNlcnZlZCBTUUw5\nMiB3b3JkcyBmcm9tIHJlc291cmNlCiAgICAgICAgSW5wdXRTdHJlYW0gaW4g\nPSBEQkRpY3Rpb25hcnkuY2xhc3MuZ2V0UmVzb3VyY2VBc1N0cmVhbQogICAg\nICAgICAgICAoInNxbC1rZXl3b3Jkcy5yc3JjIik7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgU3RyaW5nIGtleXdvcmRzID0gbmV3IEJ1ZmZlcmVkUmVh\nZGVyKG5ldyBJbnB1dFN0cmVhbVJlYWRlcihpbikpLgogICAgICAgICAgICAg\nICAgcmVhZExpbmUoKTsKICAgICAgICAgICAgaW4uY2xvc2UoKTsKICAgICAg\nICAgICAgcmVzZXJ2ZWRXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0\ncmluZ3Muc3BsaXQKICAgICAgICAgICAgICAgIChrZXl3b3JkcywgIiwiLCAw\nKSkpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihpb2UpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7IGluLmNsb3NlKCk7\nIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQoKICAgICAg\nICAvLyBhZGQgYWRkaXRpb25hbCByZXNlcnZlZCB3b3JkcyBzZXQgYnkgdXNl\ncgogICAgICAgIGlmIChyZXNlcnZlZFdvcmRzICE9IG51bGwpCiAgICAgICAg\nICAgIHJlc2VydmVkV29yZFNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJp\nbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAocmVzZXJ2ZWRXb3Jkcy50b1Vw\ncGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBzeXN0ZW0g\nc2NoZW1hcyBzZXQgYnkgdXNlcgogICAgICAgIGlmIChzeXN0ZW1TY2hlbWFz\nICE9IG51bGwpCiAgICAgICAgICAgIHN5c3RlbVNjaGVtYVNldC5hZGRBbGwo\nQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAo\nc3lzdGVtU2NoZW1hcy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAg\nICAgIC8vIGFkZCBzeXN0ZW0gdGFibGVzIHNldCBieSB1c2VyCiAgICAgICAg\naWYgKHN5c3RlbVRhYmxlcyAhPSBudWxsKQogICAgICAgICAgICBzeXN0ZW1U\nYWJsZVNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAg\nICAgICAgICAgICAgICAoc3lzdGVtVGFibGVzLnRvVXBwZXJDYXNlKCksICIs\nIiwgMCkpKTsKCiAgICAgICAgLy8gYWRkIGZpeGVkIHNpemUgdHlwZSBuYW1l\ncyBzZXQgYnkgdGhlIHVzZXIKICAgICAgICBpZiAoZml4ZWRTaXplVHlwZU5h\nbWVzICE9IG51bGwpCiAgICAgICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1lU2V0\nLmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAg\nICAgICAgIChmaXhlZFNpemVUeXBlTmFtZXMudG9VcHBlckNhc2UoKSwgIiwi\nLCAwKSkpOwogICAgICAgIAogICAgICAgIC8vIGlmIHVzZXIgaGFzIHVuc2V0\nIHNlcXVlbmNlIHNxbCwgbnVsbCBpdCBvdXQgc28gd2Uga25vdyBzZXF1ZW5j\nZXMKICAgICAgICAvLyBhcmVuJ3Qgc3VwcG9ydGVkCiAgICAgICAgbmV4dFNl\ncXVlbmNlUXVlcnkgPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKG5leHRTZXF1\nZW5jZVF1ZXJ5KTsKICAgICAgICAKICAgICAgICBpZiAoc2VsZWN0V29yZHMg\nIT0gbnVsbCkKICAgICAgICAgICAgc2VsZWN0V29yZFNldC5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0KHNlbGVjdFdvcmRzCiAgICAgICAg\nICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKICAgICAg\nICAKICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBlcnJvciBjb2RlcwogICAg\nICAgIFNRTEVycm9yQ29kZVJlYWRlciBjb2RlUmVhZGVyID0gbmV3IFNRTEVy\ncm9yQ29kZVJlYWRlcigpOwogICAgICAgIFN0cmluZyByc3JjID0gInNxbC1l\ncnJvci1zdGF0ZS1jb2Rlcy54bWwiOwogICAgICAgIElucHV0U3RyZWFtIHN0\ncmVhbSA9IGdldENsYXNzKCkuZ2V0UmVzb3VyY2VBc1N0cmVhbShyc3JjKTsK\nICAgICAgICBTdHJpbmcgZGljdGlvbmFyeUNsYXNzTmFtZSA9IGdldENsYXNz\nKCkuZ2V0TmFtZSgpOwogICAgICAgIGlmIChzdHJlYW0gPT0gbnVsbCkgeyAv\nLyBVc2VyIHN1cHBsaWVkIGRpY3Rpb25hcnkgYnV0IG5vIGVycm9yIGNvZGVz\nIHhtbAogICAgICAgIAlzdHJlYW0gPSBEQkRpY3Rpb25hcnkuY2xhc3MuZ2V0\nUmVzb3VyY2VBc1N0cmVhbShyc3JjKTsgLy8gdXNlIGRlZmF1bHQKICAgICAg\nICAJZGljdGlvbmFyeUNsYXNzTmFtZSA9IGdldENsYXNzKCkuZ2V0U3VwZXJj\nbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9CiAgICAgICAgY29kZVJlYWRl\nci5wYXJzZShzdHJlYW0sIGRpY3Rpb25hcnlDbGFzc05hbWUsIHRoaXMpOwog\nICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBhZGRFcnJvckNvZGUoaW50IGVy\ncm9yVHlwZSwgU3RyaW5nIGVycm9yQ29kZSkgewogICAgCWlmIChlcnJvckNv\nZGUgPT0gbnVsbCB8fCBlcnJvckNvZGUudHJpbSgpLmxlbmd0aCgpID09IDAp\nCiAgICAJCXJldHVybjsKCQlTZXQ8U3RyaW5nPiBjb2RlcyA9IHNxbFN0YXRl\nQ29kZXMuZ2V0KGVycm9yVHlwZSk7CiAgICAJaWYgKGNvZGVzID09IG51bGwp\nIHsKICAgIAkJY29kZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICAJ\nCWNvZGVzLmFkZChlcnJvckNvZGUudHJpbSgpKTsKICAgIAkJc3FsU3RhdGVD\nb2Rlcy5wdXQoZXJyb3JUeXBlLCBjb2Rlcyk7CiAgICAJfSBlbHNlIHsKICAg\nIAkJY29kZXMuYWRkKGVycm9yQ29kZS50cmltKCkpOwogICAgCX0KICAgIH0K\nICAgIAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIENvbm5lY3Rpb25EZWNvcmF0b3IgaW1wbGVtZW50YXRpb24K\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgLyoqCiAgICAgKiBEZWNvcmF0ZSB0aGUgZ2l2ZW4gY29ubmVjdGlvbiBp\nZiBuZWVkZWQuIFNvbWUgZGF0YWJhc2VzIHJlcXVpcmUgc3BlY2lhbAogICAg\nICogaGFuZGxpbmcgZm9yIEpEQkMgYnVncy4gVGhpcyBpbXBsZW1lbnRhdGlv\nbiBpc3N1ZXMgYW55CiAgICAgKiB7QGxpbmsgI2luaXRpYWxpemF0aW9uU1FM\nfSB0aGF0IGhhcyBiZWVuIHNldCBmb3IgdGhlIGRpY3Rpb25hcnkgYnV0CiAg\nICAgKiBkb2VzIG5vdCBkZWNvcmF0ZSB0aGUgY29ubmVjdGlvbi4KICAgICAq\nLwogICAgcHVibGljIENvbm5lY3Rpb24gZGVjb3JhdGUoQ29ubmVjdGlvbiBj\nb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nICghY29ubmVjdGVkKQogICAgICAgICAgICBjb25uZWN0ZWRDb25maWd1cmF0\naW9uKGNvbm4pOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShp\nbml0aWFsaXphdGlvblNRTCkpIHsKICAgICAgICAgICAgUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoaW5pdGlh\nbGl6YXRpb25TUUwpOwogICAgICAgICAgICAgICAgc3RtbnQuZXhlY3V0ZSgp\nOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIGxvZy50cmFjZShlLnRvU3RyaW5nKCksIGUpOwogICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKHN0bW50ICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGNvbm47CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnRhdGlvbiBv\nZiB0aGUKICAgICAqIHtAbGluayBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRv\nci5TUUxXYXJuaW5nSGFuZGxlcn0gaW50ZXJmYWNlCiAgICAgKiB0aGF0IGFs\nbG93cyBjdXN0b21pemF0aW9uIG9mIHRoZSBhY3Rpb25zIHRvIHBlcmZvcm0g\nd2hlbiBhCiAgICAgKiB7QGxpbmsgU1FMV2FybmluZ30gb2NjdXJzIGF0IGFu\neSBwb2ludCBvbiBhIHtAbGluayBDb25uZWN0aW9ufSwKICAgICAqIHtAbGlu\nayBTdGF0ZW1lbnR9LCBvciB7QGxpbmsgUmVzdWx0U2V0fS4gVGhpcyBtZXRo\nb2QgbWF5CiAgICAgKiBiZSB1c2VkIGRldGVybWluZSB0aG9zZSB3YXJuaW5n\ncyB0aGUgYXBwbGljYXRpb24gd2FudHMgdG8KICAgICAqIGNvbnNpZGVyIGNy\naXRpY2FsIGZhaWx1cmVzLCBhbmQgdGhyb3cgdGhlIHdhcm5pbmcgaW4gdGhv\nc2UKICAgICAqIGNhc2VzLiBCeSBkZWZhdWx0LCB0aGlzIG1ldGhvZCBkb2Vz\nIG5vdGhpbmcuCiAgICAgKgogICAgICogQHNlZSBMb2dnaW5nQ29ubmVjdGlv\nbkRlY29yYXRvciNzZXRXYXJuaW5nQWN0aW9uCiAgICAgKiBAc2VlIExvZ2dp\nbmdDb25uZWN0aW9uRGVjb3JhdG9yI3NldFdhcm5pbmdIYW5kbGVyCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGhhbmRsZVdhcm5pbmcoU1FMV2FybmluZyB3\nYXJuaW5nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IGV4Y2VwdGlvbiB0aGF0IHdy\nYXBzIDxjb2RlPmNhdXNlczwvY29kZT4uCiAgICAgKiBIb3dldmVyLCB0aGUg\nZGV0YWlscyBvZiBleGFjdGx5IHdoYXQgdHlwZSBvZiBleGNlcHRpb24gaXMg\ncmV0dXJuZWQgY2FuCiAgICAgKiBiZSBkZXRlcm1pbmVkIGJ5IHRoZSBpbXBs\nZW1lbnRhdGlvbi4gVGhpcyBtYXkgdGFrZSBpbnRvIGFjY291bnQKICAgICAq\nIERCLXNwZWNpZmljIGV4Y2VwdGlvbiBpbmZvcm1hdGlvbiBpbiA8Y29kZT5j\nYXVzZXM8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUV4Y2Vw\ndGlvbiBuZXdTdG9yZUV4Y2VwdGlvbihTdHJpbmcgbXNnLCBTUUxFeGNlcHRp\nb25bXSBjYXVzZXMsCiAgICAgICAgT2JqZWN0IGZhaWxlZCkgewogICAgCWlm\nIChjYXVzZXMgIT0gbnVsbCAmJiBjYXVzZXMubGVuZ3RoID4gMCkgewogICAg\nCQlPcGVuSlBBRXhjZXB0aW9uIHJldCA9IG5hcnJvdyhtc2csIGNhdXNlc1sw\nXSk7CiAgICAJCXJldC5zZXRGYWlsZWRPYmplY3QoZmFpbGVkKS5zZXROZXN0\nZWRUaHJvd2FibGVzKGNhdXNlcyk7CiAgICAJCXJldHVybiByZXQ7CiAgICAJ\nfQogICAgICAgIHJldHVybiBuZXcgU3RvcmVFeGNlcHRpb24obXNnKS5zZXRG\nYWlsZWRPYmplY3QoZmFpbGVkKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhy\nb3dhYmxlcyhjYXVzZXMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEdl\ndHMgdGhlIHN1YnR5cGUgb2YgU3RvcmVFeGNlcHRpb24gYnkgbWF0Y2hpbmcg\ndGhlIGdpdmVuIFNRTEV4Y2VwdGlvbidzCiAgICAgKiBlcnJvciBzdGF0ZSBj\nb2RlIHRvIHRoZSBsaXN0IG9mIGVycm9yIGNvZGVzIHN1cHBsaWVkIGJ5IHRo\nZSBkaWN0aW9uYXJ5LgogICAgICogUmV0dXJucyAtMSBpZiBubyBtYXRjaGlu\nZyBjb2RlIGNhbiBiZSBmb3VuZC4KICAgICAqLwogICAgT3BlbkpQQUV4Y2Vw\ndGlvbiBuYXJyb3coU3RyaW5nIG1zZywgU1FMRXhjZXB0aW9uIGV4KSB7CiAg\nICAJU3RyaW5nIGVycm9yU3RhdGUgPSBleC5nZXRTUUxTdGF0ZSgpOwogICAg\nCWludCBlcnJvclR5cGUgPSBTdG9yZUV4Y2VwdGlvbi5HRU5FUkFMOwogICAg\nCWZvciAoSW50ZWdlciB0eXBlIDogc3FsU3RhdGVDb2Rlcy5rZXlTZXQoKSkg\newogICAgCQlTZXQ8U3RyaW5nPiBlcnJvU3RhdGVzID0gc3FsU3RhdGVDb2Rl\ncy5nZXQodHlwZSk7CiAgICAJCWlmIChlcnJvU3RhdGVzICE9IG51bGwgJiYg\nZXJyb1N0YXRlcy5jb250YWlucyhlcnJvclN0YXRlKSkgewogICAgCQkJZXJy\nb3JUeXBlID0gdHlwZTsKICAgIAkJCWJyZWFrOwogICAgCQl9CiAgICAJfQog\nICAgCXN3aXRjaCAoZXJyb3JUeXBlKSB7CgkgICAgCWNhc2UgU3RvcmVFeGNl\ncHRpb24uTE9DSzogCgkgICAgICAgICAgICByZXR1cm4gbmV3IExvY2tFeGNl\ncHRpb24obXNnKTsKCSAgICAJY2FzZSBTdG9yZUV4Y2VwdGlvbi5PQkpFQ1Rf\nRVhJU1RTOgoJICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RFeGlzdHNF\neGNlcHRpb24obXNnKTsKCSAgICAJY2FzZSBTdG9yZUV4Y2VwdGlvbi5PQkpF\nQ1RfTk9UX0ZPVU5EOgoJICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RO\nb3RGb3VuZEV4Y2VwdGlvbihtc2cpOwoJICAgIAljYXNlIFN0b3JlRXhjZXB0\naW9uLk9QVElNSVNUSUM6CgkgICAgICAgICAgICByZXR1cm4gbmV3IE9wdGlt\naXN0aWNFeGNlcHRpb24obXNnKTsKCSAgICAJY2FzZSBTdG9yZUV4Y2VwdGlv\nbi5SRUZFUkVOVElBTF9JTlRFR1JJVFk6IAoJICAgICAgICAgICAgcmV0dXJu\nIG5ldyBSZWZlcmVudGlhbEludGVncml0eUV4Y2VwdGlvbihtc2cpOwoJICAg\nICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgcmV0dXJuIG5ldyBTdG9yZUV4\nY2VwdGlvbihtc2cpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBDbG9zZXMgdGhlIHNwZWNpZmllZCB7QGxpbmsgRGF0YVNvdXJjZX0g\nYW5kIHJlbGVhc2VzIGFueQogICAgICogcmVzb3VyY2VzIGFzc29jaWF0ZWQg\nd2l0aCBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YVNvdXJjZSB0aGUg\nRGF0YVNvdXJjZSB0byBjbG9zZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBj\nbG9zZURhdGFTb3VyY2UoRGF0YVNvdXJjZSBkYXRhU291cmNlKSB7CiAgICAg\nICAgRGF0YVNvdXJjZUZhY3RvcnkuY2xvc2VEYXRhU291cmNlKGRhdGFTb3Vy\nY2UpOwogICAgfQoKICAgIC8qKgogICAgICogVXNlZCBieSBzb21lIG1hcHBp\nbmdzIHRvIHJlcHJlc2VudCBkYXRhIHRoYXQgaGFzIGFscmVhZHkgYmVlbgog\nICAgICogc2VyaWFsaXplZCBzbyB0aGF0IHdlIGRvbid0IGhhdmUgdG8gc2Vy\naWFsaXplIG11bHRpcGxlIHRpbWVzLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGNsYXNzIFNlcmlhbGl6ZWREYXRhIHsKCiAgICAgICAgcHVibGljIGZp\nbmFsIGJ5dGVbXSBieXRlczsKCiAgICAgICAgcHVibGljIFNlcmlhbGl6ZWRE\nYXRhKGJ5dGVbXSBieXRlcykgewogICAgICAgICAgICB0aGlzLmJ5dGVzID0g\nYnl0ZXM7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIFJl\ndHVybiB2ZXJzaW9uIGNvbHVtbiBuYW1lCiAgICAgKiBAcGFyYW0gY29sdW1u\nCiAgICAgKiBAcGFyYW0gdGFibGVBbGlhcyA6IHRoaXMgaXMgbmVlZGVkIGZv\nciBwbGF0Zm9ybSBzcGVjaWZpYyB2ZXJzaW9uIGNvbHVtbgogICAgICogQHJl\ndHVybgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZlcnNpb25Db2x1\nbW4oQ29sdW1uIGNvbHVtbiwgU3RyaW5nIHRhYmxlQWxpYXMpIHsKICAgICAg\nICByZXR1cm4gY29sdW1uLnRvU3RyaW5nKCk7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIGluc2VydEJsb2JGb3JTdHJlYW1pbmdMb2FkKFJvdyByb3cs\nIENvbHVtbiBjb2wsIAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgT2JqZWN0\nIG9iLCBTZWxlY3Qgc2VsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAob2IgIT0gbnVsbCkgewogICAgICAgICAgICByb3cuc2V0QmluYXJ5\nU3RyZWFtKGNvbCwgCiAgICAgICAgICAgICAgICBuZXcgQnl0ZUFycmF5SW5w\ndXRTdHJlYW0obmV3IGJ5dGVbMF0pLCAwKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICByb3cuc2V0TnVsbChjb2wpOwogICAgICAgIH0KICAgIH0K\nICAgIAogICAgcHVibGljIHZvaWQgaW5zZXJ0Q2xvYkZvclN0cmVhbWluZ0xv\nYWQoUm93IHJvdywgQ29sdW1uIGNvbCwgT2JqZWN0IG9iKQogICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9iICE9IG51bGwpIHsKICAg\nICAgICByb3cuc2V0Q2hhcmFjdGVyU3RyZWFtKGNvbCwKICAgICAgICAgICAg\nICAgIG5ldyBDaGFyQXJyYXlSZWFkZXIobmV3IGNoYXJbMF0pLCAwKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cuc2V0TnVsbChjb2wpOwog\nICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgdXBkYXRlQmxv\nYihTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUsIElucHV0U3RyZWFtIGlz\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNRTEJ1\nZmZlciBzcWwgPSBzZWwudG9TZWxlY3QodHJ1ZSwgc3RvcmUuZ2V0RmV0Y2hD\nb25maWd1cmF0aW9uKCkpOwogICAgICAgIFJlc3VsdFNldCByZXMgPSBudWxs\nOwogICAgICAgIENvbm5lY3Rpb24gY29ubiA9IHN0b3JlLmdldENvbm5lY3Rp\nb24oKTsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RtbnQgPSBzcWwucHJlcGFy\nZVN0YXRlbWVudChjb25uLCBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKSwKICAgICAgICAgICAgICAgIFJlc3VsdFNldC5UWVBFX1NDUk9MTF9TRU5T\nSVRJVkUsCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQuQ09OQ1VSX1VQREFU\nQUJMRSk7CiAgICAgICAgICAgIHJlcyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgp\nOwogICAgICAgICAgICBpZiAoIXJlcy5uZXh0KCkpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdldCgic3Ry\nZWFtLWV4Y2VwdGlvbiIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBC\nbG9iIGJsb2IgPSByZXMuZ2V0QmxvYigxKTsKICAgICAgICAgICAgT3V0cHV0\nU3RyZWFtIG9zID0gYmxvYi5zZXRCaW5hcnlTdHJlYW0oMSk7CiAgICAgICAg\nICAgIGNvcHkoaXMsIG9zKTsKICAgICAgICAgICAgb3MuY2xvc2UoKTsKICAg\nICAgICAgICAgcmVzLnVwZGF0ZUJsb2IoMSwgYmxvYik7CiAgICAgICAgICAg\nIHJlcy51cGRhdGVSb3coKTsKCiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRp\nb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlv\nbihpb2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChy\nZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJlcy5jbG9zZSAo\nKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlm\nIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQu\nY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7fQogICAgICAg\nICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsg\nY29ubi5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAg\nICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCB1cGRhdGVDbG9i\nKFNlbGVjdCBzZWwsIEpEQkNTdG9yZSBzdG9yZSwgUmVhZGVyIHJlYWRlcikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTUUxCdWZm\nZXIgc3FsID0gc2VsLnRvU2VsZWN0KHRydWUsIHN0b3JlLmdldEZldGNoQ29u\nZmlndXJhdGlvbigpKTsKICAgICAgICBSZXN1bHRTZXQgcmVzID0gbnVsbDsK\nICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9u\nKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0bW50ID0gc3FsLnByZXBhcmVT\ndGF0ZW1lbnQoY29ubiwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCks\nCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQuVFlQRV9TQ1JPTExfU0VOU0lU\nSVZFLAogICAgICAgICAgICAgICAgUmVzdWx0U2V0LkNPTkNVUl9VUERBVEFC\nTEUpOwogICAgICAgICAgICByZXMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsK\nICAgICAgICAgICAgaWYgKCFyZXMubmV4dCgpKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoInN0cmVh\nbS1leGNlcHRpb24iKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2xv\nYiBjbG9iID0gcmVzLmdldENsb2IoMSk7CiAgICAgICAgICAgIFdyaXRlciB3\ncml0ZXIgPSBjbG9iLnNldENoYXJhY3RlclN0cmVhbSgxKTsKICAgICAgICAg\nICAgY29weShyZWFkZXIsIHdyaXRlcik7CiAgICAgICAgICAgIHdyaXRlci5j\nbG9zZSgpOwogICAgICAgICAgICByZXMudXBkYXRlQ2xvYigxLCBjbG9iKTsK\nICAgICAgICAgICAgcmVzLnVwZGF0ZVJvdygpOwoKICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgaWYgKHJlcyAhPSBudWxsKSAKICAgICAgICAgICAgICAgIHRyeSB7\nIHJlcy5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAg\nICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKSAKICAgICAgICAgICAgICAg\nIHRyeSB7IHN0bW50LmNsb3NlICgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nZSkge30KICAgICAgICAgICAgaWYgKGNvbm4gIT0gbnVsbCkgCiAgICAgICAg\nICAgICAgICB0cnkgeyBjb25uLmNsb3NlICgpOyB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gZSkge30KICAgICAgICB9ICAgIAogICAgfQogICAgCiAgICBwcm90\nZWN0ZWQgbG9uZyBjb3B5KElucHV0U3RyZWFtIGluLCBPdXRwdXRTdHJlYW0g\nb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGJ5dGVbXSBjb3B5\nQnVmZmVyID0gbmV3IGJ5dGVbYmxvYkJ1ZmZlclNpemVdOwogICAgICAgIGxv\nbmcgYnl0ZXNDb3BpZWQgPSAwOwogICAgICAgIGludCByZWFkID0gLTE7Cgog\nICAgICAgIHdoaWxlICgocmVhZCA9IGluLnJlYWQoY29weUJ1ZmZlciwgMCwg\nY29weUJ1ZmZlci5sZW5ndGgpKSAhPSAtMSkgewogICAgICAgICAgICBvdXQu\nd3JpdGUoY29weUJ1ZmZlciwgMCwgcmVhZCk7CiAgICAgICAgICAgIGJ5dGVz\nQ29waWVkICs9IHJlYWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBieXRl\nc0NvcGllZDsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGxvbmcgY29weShS\nZWFkZXIgcmVhZGVyLCBXcml0ZXIgd3JpdGVyKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGNoYXJbXSBjb3B5QnVmZmVyID0gbmV3IGNoYXJbY2xv\nYkJ1ZmZlclNpemVdOwogICAgICAgIGxvbmcgYnl0ZXNDb3BpZWQgPSAwOwog\nICAgICAgIGludCByZWFkID0gLTE7CgogICAgICAgIHdoaWxlICgocmVhZCA9\nIHJlYWRlci5yZWFkKGNvcHlCdWZmZXIsIDAsIGNvcHlCdWZmZXIubGVuZ3Ro\nKSkgIT0gLTEpIHsKICAgICAgICAgICAgd3JpdGVyLndyaXRlKGNvcHlCdWZm\nZXIsIDAsIHJlYWQpOwogICAgICAgICAgICBieXRlc0NvcGllZCArPSByZWFk\nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJ5dGVzQ29waWVkOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIEF0dGFjaCBDQVNUIHRvIHRoZSBjdXJy\nZW50IGZ1bmN0aW9uIGlmIG5lY2Vzc2FyeQogICAgICogCiAgICAgKiBAcGFy\nYW0gdmFsIG9wZXJhbmQgdmFsdWUKICAgICAqIEBwYXJtYSBmdW5jIHRoZSBz\ncWwgZnVuY3Rpb24gc3RhdGVtZW50CiAgICAgKiBAcmV0dXJuIGEgU3RyaW5n\nIHdpdGggdGhlIGNvcnJlY3QgQ0FTVCBmdW5jdGlvbiBzeW50YXgKICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRDYXN0RnVuY3Rpb24oVmFsIHZhbCwg\nU3RyaW5nIGZ1bmMpIHsKICAgICAgICByZXR1cm4gZnVuYzsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgY29ycmVjdCBDQVNUIGZ1bmN0aW9u\nIHN5bnRheC4gIFRoaXMgc2hvdWxkIGJlIG92ZXJyaWRlbiBieSBzdWJjbGFz\nc2VzCiAgICAgKiB0aGF0IG5lZWQgYWNjZXNzIHRvIHRoZSBDb2x1bW4gaW5m\nb3JtYXRpb24uCiAgICAgKiAKICAgICAqIEBwYXJhbSB2YWwgb3BlcmFuZCBv\nZiBjYXN0CiAgICAgKiBAcGFyYW0gZnVuYyBvcmlnaW5hbCBzdHJpbmcKICAg\nICAqIEBwYXJhbSBjb2wgZGF0YWJhc2UgY29sdW1uCiAgICAgKiBAcmV0dXJu\nIGEgU3RyaW5nIHdpdGggdGhlIGNvcnJlY3QgQ0FTVCBmdW5jdGlvbiBzeW50\nYXgKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDYXN0RnVuY3Rpb24o\nVmFsIHZhbCwgU3RyaW5nIGZ1bmMsIENvbHVtbiBjb2wpIHsKICAgIAlyZXR1\ncm4gZ2V0Q2FzdEZ1bmN0aW9uICh2YWwsIGZ1bmMpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhbiBpbmRleCBpZiBuZWNlc3NhcnkgZm9y\nIHNvbWUgZGF0YWJhc2UgdGFibGVzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGNyZWF0ZUluZGV4SWZOZWNlc3NhcnkoU2NoZW1hIHNjaGVtYSwgU3RyaW5n\nIHRhYmxlLAogICAgICAgICAgICBDb2x1bW4gcGtDb2x1bW4pIHsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJhdGNoTGltaXQKICAg\nICAqLwogICAgcHVibGljIGludCBnZXRCYXRjaExpbWl0KCl7CiAgICAgICAg\ncmV0dXJuIGJhdGNoTGltaXQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nU2V0IHRoZSBiYXRjaExpbWl0IHZhbHVlCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldEJhdGNoTGltaXQoaW50IGxpbWl0KXsKICAgICAgICBiYXRjaExp\nbWl0ID0gbGltaXQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVmFsaWRh\ndGUgdGhlIGJhdGNoIHByb2Nlc3MuIEluIHNvbWUgY2FzZXMsIHdlIGNhbid0\nIGJhdGNoIHRoZSBzdGF0ZW1lbnRzCiAgICAgKiBkdWUgdG8gc29tZSByZXN0\ncmljdGlvbnMuIEZvciBleGFtcGxlLCBpZiB0aGUgR2VuZXJhdGVkVHlwZT1J\nREVOVElUWSwKICAgICAqIHdlIGhhdmUgdG8gZGlzYWJsZSB0aGUgYmF0Y2gg\ncHJvY2VzcyBiZWNhdXNlIHdlIG5lZWQgdG8gZ2V0IHRoZSBJRCB2YWx1ZQog\nICAgICogcmlnaHQgYXdheSBmb3IgdGhlIGluLW1lbW9yeSBlbnRpdHkgdG8g\ndXNlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB2YWxpZGF0ZUJhdGNo\nUHJvY2VzcyhSb3dJbXBsIHJvdywgQ29sdW1uW10gYXV0b0Fzc2lnbiwKICAg\nICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciAgc20sIENsYXNzTWFwcGlu\nZyBjbWQgKSB7CiAgICAgICAgYm9vbGVhbiBkaXNhYmxlQmF0Y2ggPSBmYWxz\nZTsKICAgICAgICBpZiAoZ2V0QmF0Y2hMaW1pdCgpPT0gMCkgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGlmIChhdXRvQXNzaWduICE9IG51bGwgJiYgc20gIT0g\nbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kID0gY21k\nLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAgaW50IGkgPSAw\nOwogICAgICAgICAgICB3aGlsZSAoIWRpc2FibGVCYXRjaCAmJiBpIDwgZm1k\nLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKGZtZFtpXS5nZXRWYWx1\nZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLkFVVE9BU1NJR04pCiAg\nICAgICAgICAgICAgICAgICAgZGlzYWJsZUJhdGNoID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgIGkrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICAvLyBnbyB0byBlYWNoIERpY3Rpb25hcnkgdG8gdmFsaWRhdGUgdGhlIGJh\ndGNoIGNhcGFiaWxpdHkKICAgICAgICBpZiAoIWRpc2FibGVCYXRjaCkKICAg\nICAgICAgICAgZGlzYWJsZUJhdGNoID0gdmFsaWRhdGVEQlNwZWNpZmljQmF0\nY2hQcm9jZXNzKGRpc2FibGVCYXRjaCwgcm93LCAKICAgICAgICAgICAgICAg\nIGF1dG9Bc3NpZ24sIHNtLCBjbWQpOwogICAgICAgIHJldHVybiBkaXNhYmxl\nQmF0Y2g7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWxsb3cgZWFjaCBE\naWN0aW9uYXJ5IHRvIHZhbGlkYXRlIGl0cyBvd24gYmF0Y2ggcHJvY2Vzcy4g\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHZhbGlkYXRlREJTcGVjaWZp\nY0JhdGNoUHJvY2VzcyAoYm9vbGVhbiBkaXNhYmxlQmF0Y2gsIAogICAgICAg\nICAgICBSb3dJbXBsIHJvdywgQ29sdW1uW10gYXV0b0Fzc2lnbiwgCiAgICAg\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgIHNtLCBDbGFzc01hcHBpbmcg\nY21kICkgewogICAgICAgIHJldHVybiBkaXNhYmxlQmF0Y2g7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBv\ndmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1w\nbGVtZW50YXRpb24gb2YgZXhlY3V0aW5nIHF1ZXJ5LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShDb25uZWN0aW9uIGNv\nbm4sIFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBTdHJpbmcgc3FsIAogICAg\nICAgICkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHN0\nbW50LmV4ZWN1dGVRdWVyeSgpOwogICAgfQogICAgICAgICAgICAKICAgIC8q\nKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBm\nb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRp\nb24gb2YgcHJlcGFyaW5nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoQ29ubmVj\ndGlvbiBjb25uLCBTdHJpbmcgc3FsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBjb25uLnByZXBhcmVTdGF0ZW1lbnQo\nc3FsKTsKICAgIH0gICAgCiAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2Qg\naXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1s\naWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyBzZXF1ZW5j\nZSBmcm9tIHRoZSByZXN1bHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nU2VxdWVuY2VbXSBnZXRTZXF1ZW5jZShSZXN1bHRTZXQgcnMpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIExpc3Qgc2VxTGlzdCA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICB3aGlsZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0\nKCkpCiAgICAgICAgICAgIHNlcUxpc3QuYWRkKG5ld1NlcXVlbmNlKHJzKSk7\nCiAgICAgICAgcmV0dXJuIChTZXF1ZW5jZVtdKSBzZXFMaXN0LnRvQXJyYXko\nbmV3IFNlcXVlbmNlW3NlcUxpc3Quc2l6ZSgpXSk7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlk\nZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50\nYXRpb24gb2YgZ2V0dGluZyBrZXkgZnJvbSB0aGUgcmVzdWx0IHNldC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCBnZXRLZXkgKFJlc3VsdFNldCBy\ncywgQ29sdW1uIGNvbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKCFycy5uZXh0KCkpCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4\nY2VwdGlvbihfbG9jLmdldCgibm8tZ2Vua2V5IikpOwogICAgICAgIE9iamVj\ndCBrZXkgPSBycy5nZXRPYmplY3QoMSk7CiAgICAgICAgaWYgKGtleSA9PSBu\ndWxsKQogICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiaW52YWxpZC1n\nZW5rZXkiLCBjb2wpKTsKICAgICAgICByZXR1cm4ga2V5OyAgICAgICAgCiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJv\ndmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAg\nICogaW1wbGVtZW50YXRpb24gb2YgY2FsY3VsYXRpbmcgdmFsdWUuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGNhbGN1bGF0ZVZhbHVlKFZhbCB2YWws\nIFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCAKICAgICAgICBFeHBTdGF0\nZSBzdGF0ZSwgUGF0aCBwYXRoLCBFeHBTdGF0ZSBwYXRoU3RhdGUpIHsKICAg\nICAgICB2YWwuY2FsY3VsYXRlVmFsdWUoc2VsLCBjdHgsIHN0YXRlLCAoVmFs\nKSBwYXRoLCBwYXRoU3RhdGUpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0\nZXJtaW5lIHdoZXRoZXIgdGhlIHByb3ZpZGVkIDxjb2RlPnNxbDwvY29kZT4g\nbWF5IGJlIHRyZWF0ZWQgYXMgYSAKICAgICAqIHNlbGVjdCBzdGF0ZW1lbnQg\nb24gdGhpcyBkYXRhYmFzZS4KICAgICAqICAKICAgICAqIEBwYXJhbSBzcWwg\nICBBIHNxbCBzdGF0ZW1lbnQuIAogICAgICogCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgPGNvZGU+c3FsPC9jb2RlPiByZXByZXNlbnRzIGEgc2VsZWN0IHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNTZWxlY3Qo\nU3RyaW5nIHNxbCkgewogICAgICAgIEl0ZXJhdG9yIGkgPSBzZWxlY3RXb3Jk\nU2V0Lml0ZXJhdG9yKCk7CiAgICAgICAgU3RyaW5nIGN1cjsKICAgICAgICB3\naGlsZSAoaS5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgY3VyID0gKFN0cmlu\nZykgaS5uZXh0KCk7CiAgICAgICAgICAgIGlmIChzcWwubGVuZ3RoKCkgPj0g\nY3VyLmxlbmd0aCgpCiAgICAgICAgICAgICAgICAgICAgJiYgc3FsLnN1YnN0\ncmluZygwLCBjdXIubGVuZ3RoKCkpLmVxdWFsc0lnbm9yZUNhc2UoY3VyKSkg\newogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIG5lZWRzVG9DcmVhdGVJbmRleChJbmRleCBpZHgsIFRh\nYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYmF0Y2hlZCBzdGF0ZW1lbnRzIHVwZGF0ZSBz\ndWNjZXMgY291bnQKICAgICAqIEBwYXJhbSBwcyBBIFByZXBhcmVkU3RhdGVt\nZW50CiAgICAgKiBAcmV0dXJuIHJldHVybiB1cGRhdGUgY291bnQKICAgICAq\nLwogICAgcHVibGljIGludCBnZXRCYXRjaFVwZGF0ZUNvdW50KFByZXBhcmVk\nU3RhdGVtZW50IHBzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gMDsKICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gZ2V0VHJp\nbVNjaGVtYU5hbWUoKSB7IAogICAgICAgIHJldHVybiB0cmltU2NoZW1hTmFt\nZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0VHJpbVNjaGVtYU5h\nbWUoYm9vbGVhbiB0cmltU2NoZW1hTmFtZSkgeyAKICAgICAgICB0aGlzLnRy\naW1TY2hlbWFOYW1lID0gdHJpbVNjaGVtYU5hbWU7IAogICAgfQogICAgCiAg\nICBwdWJsaWMgdm9pZCBkZWxldGVTdHJlYW0oSkRCQ1N0b3JlIHN0b3JlLCBT\nZWxlY3Qgc2VsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBE\nbyBub3RoaW5nCiAgICB9Cn0K\n","encoding":"base64"}

