{"sha":"14a011c65979e73ba771064ea6081c9586b8fe01","node_id":"MDQ6QmxvYjIwNjM2NDoxNGEwMTFjNjU5NzllNzNiYTc3MTA2NGVhNjA4MWM5NTg2YjhmZTAx","size":44031,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/14a011c65979e73ba771064ea6081c9586b8fe01","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc3FsLkJs\nb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRp\nbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9y\ndCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpE\nQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJWYWx1ZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRp\nbmdEYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5qZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9yZUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRp\nb247CgppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogRGljdGlv\nbmFyeSBmb3IgT3JhY2xlLgogKi8KcHVibGljIGNsYXNzIE9yYWNsZURpY3Rp\nb25hcnkKICAgIGV4dGVuZHMgREJEaWN0aW9uYXJ5IHsKCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIFN0cmluZyBTRUxFQ1RfSElOVCA9ICJvcGVuanBhLmhp\nbnQuT3JhY2xlU2VsZWN0SGludCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIFN0cmluZyBWRU5ET1JfT1JBQ0xFID0gIm9yYWNsZSI7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEJFSEFWRV9PVEhFUiA9IDA7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX09SQUNMRSA9IDE7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX0RBVEFESVJFQ1QzMSA9\nIDI7CgogICAgcHJpdmF0ZSBzdGF0aWMgQmxvYiBFTVBUWV9CTE9CID0gbnVs\nbDsKICAgIHByaXZhdGUgc3RhdGljIENsb2IgRU1QVFlfQ0xPQiA9IG51bGw7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChPcmFjbGVEaWN0aW9uYXJ5\nLmNsYXNzKTsKCiAgICAvKioKICAgICAqIElmIHRydWUsIHRoZW4gc2ltdWxh\ndGUgYXV0by1hc3NpZ25lZCB2YWx1ZXMgaW4gT3JhY2xlIGJ5CiAgICAgKiB1\nc2luZyBhIHRyaWdnZXIgdGhhdCBpbnNlcnRzIGEgc2VxdWVuY2UgdmFsdWUg\naW50byB0aGUKICAgICAqIHByaW1hcnkga2V5IHZhbHVlIHdoZW4gYSByb3cg\naXMgaW5zZXJ0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHVzZVRy\naWdnZXJzRm9yQXV0b0Fzc2lnbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog\nVGhlIGdsb2JhbCBzZXF1ZW5jZSBuYW1lIHRvIHVzZSBmb3IgYXV0b2Fzc2ln\nbiBzaW11bGF0aW9uLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGF1dG9B\nc3NpZ25TZXF1ZW5jZU5hbWUgPSBudWxsOwoKICAgIC8qKgogICAgICogRmxh\nZyB0byB1c2UgT3BlbkpQQSAwLjMgc3R5bGUgbmFtaW5nIGZvciBhdXRvIGFz\nc2lnbiBzZXF1ZW5jZSBuYW1lIGFuZAogICAgICogdHJpZ2dlciBuYW1lIGZv\nciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gb3BlbmpwYTNHZW5lcmF0ZWRLZXlOYW1lcyA9IGZhbHNlOwoK\nICAgIC8qKgogICAgICogSWYgdHJ1ZSwgdGhlbiBPcGVuSlBBIHdpbGwgYXR0\nZW1wdCB0byB1c2UgdGhlIHNwZWNpYWwKICAgICAqIE9yYWNsZVByZXBhcmVk\nU3RhdGVtZW50LnNldEZvcm1PZlVzZSBtZXRob2QgdG8KICAgICAqIGNvbmZp\nZ3VyZSBzdGF0ZW1lbnRzIHRoYXQgaXQgZGV0ZWN0cyBhcmUgb3BlcmF0aW5n\nIG9uIHVuaWNvZGUgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiB1c2VTZXRGb3JtT2ZVc2VGb3JVbmljb2RlID0gdHJ1ZTsKCiAgICAvLyBz\nb21lIG9yYWNsZSBkcml2ZXJzIGhhdmUgcHJvYmxlbXMgd2l0aCBzZWxlY3Qg\nZm9yIHVwZGF0ZTsgd2FybiB0aGUKICAgIC8vIGZpcnN0IHRpbWUgbG9ja2lu\nZyBpcyBhdHRlbXB0ZWQKICAgIHByaXZhdGUgYm9vbGVhbiBfY2hlY2tlZFVw\nZGF0ZUJ1ZyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF93YXJuZWRD\naGFyQ29sdW1uID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3dhcm5l\nZE5jaGFyQ29sdW1uID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfZHJpdmVy\nQmVoYXZpb3IgPSAtMTsKCiAgICAvLyBjYWNoZSBsb2IgbWV0aG9kcwogICAg\ncHJpdmF0ZSBNZXRob2QgX3B1dEJ5dGVzID0gbnVsbDsKICAgIHByaXZhdGUg\nTWV0aG9kIF9wdXRTdHJpbmcgPSBudWxsOwogICAgcHJpdmF0ZSBNZXRob2Qg\nX3B1dENoYXJzID0gbnVsbDsKICAgIAogICAgLy8gYmF0Y2ggbGltaXQKICAg\nIHByaXZhdGUgaW50IGRlZmF1bHRCYXRjaExpbWl0ID0gMTAwOwoKICAgIHB1\nYmxpYyBPcmFjbGVEaWN0aW9uYXJ5KCkgewogICAgICAgIHBsYXRmb3JtID0g\nIk9yYWNsZSI7CiAgICAgICAgdmFsaWRhdGlvblNRTCA9ICJTRUxFQ1QgU1lT\nREFURSBGUk9NIERVQUwiOwogICAgICAgIG5leHRTZXF1ZW5jZVF1ZXJ5ID0g\nIlNFTEVDVCB7MH0uTkVYVFZBTCBGUk9NIERVQUwiOwogICAgICAgIHN0cmlu\nZ0xlbmd0aEZ1bmN0aW9uID0gIkxFTkdUSCh7MH0pIjsKICAgICAgICBqb2lu\nU3ludGF4ID0gU1lOVEFYX0RBVEFCQVNFOwogICAgICAgIG1heFRhYmxlTmFt\nZUxlbmd0aCA9IDMwOwogICAgICAgIG1heENvbHVtbk5hbWVMZW5ndGggPSAz\nMDsKICAgICAgICBtYXhJbmRleE5hbWVMZW5ndGggPSAzMDsKICAgICAgICBt\nYXhDb25zdHJhaW50TmFtZUxlbmd0aCA9IDMwOwogICAgICAgIG1heEVtYmVk\nZGVkQmxvYlNpemUgPSA0MDAwOwogICAgICAgIG1heEVtYmVkZGVkQ2xvYlNp\nemUgPSA0MDAwOwogICAgICAgIGluQ2xhdXNlTGltaXQgPSAxMDAwOwoKICAg\nICAgICBzdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMgPSB0cnVlOwogICAg\nICAgIHN1cHBvcnRzTG9ja2luZ1dpdGhEaXN0aW5jdENsYXVzZSA9IGZhbHNl\nOwogICAgICAgIHN1cHBvcnRzU2VsZWN0U3RhcnRJbmRleCA9IHRydWU7CiAg\nICAgICAgc3VwcG9ydHNTZWxlY3RFbmRJbmRleCA9IHRydWU7CgogICAgICAg\nIHN5c3RlbVNjaGVtYVNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3Ry\naW5nW117CiAgICAgICAgICAgICJDVFhTWVMiLCAiTURTWVMiLCAiU1lTIiwg\nIlNZU1RFTSIsICJXS1NZUyIsICJXTVNZUyIsICJYREIiLAogICAgICAgIH0p\nKTsKCiAgICAgICAgc3VwcG9ydHNYTUxDb2x1bW4gPSB0cnVlOwogICAgICAg\nIHhtbFR5cGVOYW1lID0gIlhNTFR5cGUiOwogICAgICAgIGJpZ2ludFR5cGVO\nYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgYml0VHlwZU5hbWUgPSAiTlVN\nQkVSezB9IjsKICAgICAgICBkZWNpbWFsVHlwZU5hbWUgPSAiTlVNQkVSezB9\nIjsKICAgICAgICBkb3VibGVUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAg\nICAgIGludGVnZXJUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIG51\nbWVyaWNUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIHNtYWxsaW50\nVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICB0aW55aW50VHlwZU5h\nbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBsb25nVmFyY2hhclR5cGVOYW1l\nID0gIkxPTkciOwogICAgICAgIGJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwog\nICAgICAgIHZhcmJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwogICAgICAgIGxv\nbmdWYXJiaW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICB0aW1lVHlw\nZU5hbWUgPSAiREFURSI7CiAgICAgICAgdmFyY2hhclR5cGVOYW1lID0gIlZB\nUkNIQVIyezB9IjsKICAgICAgICBmaXhlZFNpemVUeXBlTmFtZVNldC5hZGRB\nbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAgICJM\nT05HIFJBVyIsICJSQVciLCAiTE9ORyIsICJSRUYiLAogICAgICAgIH0pKTsK\nICAgICAgICByZXNlcnZlZFdvcmRTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3Qo\nbmV3IFN0cmluZ1tdewogICAgICAgICAgICAiQUNDRVNTIiwgIkFVRElUIiwg\nIkNMVVNURVIiLCAiQ09NTUVOVCIsICJDT01QUkVTUyIsICJFWENMVVNJVkUi\nLAogICAgICAgICAgICAiRklMRSIsICJJREVOVElGSUVEIiwgIklOQ1JFTUVO\nVCIsICJJTkRFWCIsICJJTklUSUFMIiwgIkxPQ0siLAogICAgICAgICAgICAi\nTE9ORyIsICJNQVhFWFRFTlRTIiwgIk1JTlVTIiwgIk1PREUiLCAiTk9BVURJ\nVCIsICJOT0NPTVBSRVNTIiwKICAgICAgICAgICAgIk5PV0FJVCIsICJPRkZM\nSU5FIiwgIk9OTElORSIsICJQQ1RGUkVFIiwgIlJPVyIsCiAgICAgICAgfSkp\nOwoKICAgICAgICBzdWJzdHJpbmdGdW5jdGlvbk5hbWUgPSAiU1VCU1RSIjsK\nICAgICAgICBzdXBlci5zZXRCYXRjaExpbWl0KGRlZmF1bHRCYXRjaExpbWl0\nKTsKICAgICAgICBzZWxlY3RXb3JkU2V0LmFkZCgiV0lUSCIpOwogICAgICAg\nIHJlcG9ydHNTdWNjZXNzTm9JbmZvT25CYXRjaFVwZGF0ZXMgPSB0cnVlOwog\nICAgICAgIHJlcXVpcmVzU2VhcmNoU3RyaW5nRXNjYXBlRm9yTGlrZSA9IGZh\nbHNlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24o\nKSB7CiAgICAgICAgc3VwZXIuZW5kQ29uZmlndXJhdGlvbigpOwogICAgICAg\nIGlmICh1c2VUcmlnZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHN1\ncHBvcnRzQXV0b0Fzc2lnbiA9IHRydWU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgY29ubmVjdGVkQ29uZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuY29u\nbmVjdGVkQ29uZmlndXJhdGlvbihjb25uKTsKICAgICAgICBpZiAoZHJpdmVy\nVmVuZG9yID09IG51bGwpIHsKICAgICAgICAgICAgRGF0YWJhc2VNZXRhRGF0\nYSBtZXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICBTdHJp\nbmcgdXJsID0gKG1ldGEuZ2V0VVJMKCkgPT0gbnVsbCkgPyAiIiA6IG1ldGEu\nZ2V0VVJMKCk7CiAgICAgICAgICAgIFN0cmluZyBkcml2ZXJOYW1lID0gbWV0\nYS5nZXREcml2ZXJOYW1lKCk7CiAgICAgICAgICAgIFN0cmluZyBtZXRhZGF0\nYUNsYXNzTmFtZTsKICAgICAgICAgICAgaWYgKG1ldGEgaW5zdGFuY2VvZiBE\nZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YSkKICAgICAgICAgICAgICAgIG1l\ndGFkYXRhQ2xhc3NOYW1lID0gKChEZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0\nYSkgbWV0YSkuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVs\nZWdhdGUoKS5nZXRDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgbWV0YWRhdGFDbGFzc05hbWUgPSBtZXRhLmdl\ndENsYXNzKCkuZ2V0TmFtZSgpOwoKICAgICAgICAgICAgLy8gY2hlY2sgYm90\naCB0aGUgZHJpdmVyIGNsYXNzIG5hbWUgYW5kIHRoZSBVUkwgZm9yIGtub3du\nIHBhdHRlcm5zCiAgICAgICAgICAgIGlmIChtZXRhZGF0YUNsYXNzTmFtZS5z\ndGFydHNXaXRoKCJvcmFjbGUuIikKICAgICAgICAgICAgICAgIHx8IHVybC5p\nbmRleE9mKCJqZGJjOm9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAg\nfHwgIk9yYWNsZSBKREJDIGRyaXZlciIuZXF1YWxzKGRyaXZlck5hbWUpKSB7\nCiAgICAgICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfT1JBQ0xF\nICsgbWV0YS5nZXREcml2ZXJNYWpvclZlcnNpb24oKQogICAgICAgICAgICAg\nICAgICAgICsgbWV0YS5nZXREcml2ZXJNaW5vclZlcnNpb24oKTsKCiAgICAg\nICAgICAgICAgICBTdHJpbmcgcHJvZHVjdFZlcnNpb24gPSBtZXRhLmdldERh\ndGFiYXNlUHJvZHVjdFZlcnNpb24oKQogICAgICAgICAgICAgICAgICAgIC5z\ncGxpdCgiUmVsZWFzZSAiLDApWzFdLnNwbGl0KCJcXC4iLDApWzBdOwogICAg\nICAgICAgICAgICAgaW50IHJlbGVhc2UgPSBJbnRlZ2VyLnBhcnNlSW50KHBy\nb2R1Y3RWZXJzaW9uKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAg\nICAgLy8gd2FybiBzcWw5MgogICAgICAgICAgICAgICAgaWYgKHJlbGVhc2Ug\nPD0gOCkgewogICAgICAgICAgICAgICAgICAgIGlmIChqb2luU3ludGF4ID09\nIFNZTlRBWF9TUUw5MiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgib3JhY2xlLXN5\nbnRheCIpKTsKICAgICAgICAgICAgICAgICAgICBqb2luU3ludGF4ID0gU1lO\nVEFYX0RBVEFCQVNFOwogICAgICAgICAgICAgICAgICAgIGRhdGVUeXBlTmFt\nZSA9ICJEQVRFIjsgLy8gYWRkZWQgb3JhY2xlIDkKICAgICAgICAgICAgICAg\nICAgICB0aW1lc3RhbXBUeXBlTmFtZSA9ICJEQVRFIjsgLy8gYWRkZWQgb3Jh\nY2xlIDkKICAgICAgICAgICAgICAgICAgICBzdXBwb3J0c1hNTENvbHVtbiA9\nIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIC8vIHNlbGVjdCBvZiBhbiB4bWwgY29sdW1uIHJlcXVpcmVzICIuZ2V0U3Ry\naW5nVmFsKCkiCiAgICAgICAgICAgICAgICAgICAgLy8gc3VmZml4LiBlZy4g\ndDAueG1sY29sLmdldFN0cmluZ1ZhbCgpCiAgICAgICAgICAgICAgICAgICAg\nZ2V0U3RyaW5nVmFsID0gIi5nZXRTdHJpbmdWYWwoKSI7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAobWV0YWRhdGFDbGFzc05hbWUuc3RhcnRzV2l0aCgiY29t\nLmRkdGVrLiIpCiAgICAgICAgICAgICAgICB8fCB1cmwuaW5kZXhPZigiamRi\nYzpkYXRhZGlyZWN0Om9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAg\nfHwgIk9yYWNsZSIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAgICAgICAgICAg\nICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfREFUQURJUkVDVCArIG1ldGEu\nZ2V0RHJpdmVyTWFqb3JWZXJzaW9uKCkKICAgICAgICAgICAgICAgICAgICAr\nIG1ldGEuZ2V0RHJpdmVyTWlub3JWZXJzaW9uKCk7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX09U\nSEVSOwogICAgICAgIH0KICAgICAgICBjYWNoZURyaXZlckJlaGF2aW9yKGRy\naXZlclZlbmRvcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBjb25z\ndGFudCBmb3IgZHJpdmVycyB3aXRoIGJlaGF2aW9ycyB3ZSBoYXZlIHRvIGRl\nYWwgd2l0aC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNhY2hlRHJpdmVy\nQmVoYXZpb3IoU3RyaW5nIGRyaXZlclZlbmRvcikgewogICAgICAgIGlmIChf\nZHJpdmVyQmVoYXZpb3IgIT0gLTEpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgZHJpdmVyVmVuZG9yID0gZHJpdmVyVmVuZG9yLnRvTG93ZXJDYXNl\nKCk7CiAgICAgICAgaWYgKGRyaXZlclZlbmRvci5zdGFydHNXaXRoKFZFTkRP\nUl9PUkFDTEUpKQogICAgICAgICAgICBfZHJpdmVyQmVoYXZpb3IgPSBCRUhB\nVkVfT1JBQ0xFOwogICAgICAgIGVsc2UgaWYgKGRyaXZlclZlbmRvci5lcXVh\nbHMoVkVORE9SX0RBVEFESVJFQ1QgKyAiMzAiKQogICAgICAgICAgICB8fCBk\ncml2ZXJWZW5kb3IuZXF1YWxzKFZFTkRPUl9EQVRBRElSRUNUICsgIjMxIikp\nCiAgICAgICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFWRV9EQVRBRElS\nRUNUMzE7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHJpdmVyQmVoYXZp\nb3IgPSBCRUhBVkVfT1RIRVI7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbnN1\ncmUgdGhhdCB0aGUgZHJpdmVyIHZlbmRvciBoYXMgYmVlbiBzZXQsIGFuZCBp\nZiBub3QsIHNldCBpdCBub3cuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGVu\nc3VyZURyaXZlclZlbmRvcigpIHsKICAgICAgICBpZiAoZHJpdmVyVmVuZG9y\nICE9IG51bGwpIHsKICAgICAgICAgICAgY2FjaGVEcml2ZXJCZWhhdmlvcihk\ncml2ZXJWZW5kb3IpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoIm9yYWNsZS1jb25uZWN0aW5nLWZvci1kcml2\nZXIiKSk7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBjb25uID0gY29uZi5nZXREYXRhU291cmNl\nMihudWxsKS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIGNvbm5lY3Rl\nZENvbmZpZ3VyYXRpb24oY29ubik7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsIHRoaXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChjb25uICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0xvY2tpbmcoU2VsZWN0IHNlbCkgewogICAgICAgIGlmICghc3Vw\nZXIuc3VwcG9ydHNMb2NraW5nKHNlbCkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICByZXR1cm4gIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFu\nZ2Uoc2VsLmdldFN0YXJ0SW5kZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVu\nZEluZGV4KCksIHNlbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygp\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldFNlbGVjdHMo\nU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZpZXJzLAogICAg\nICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8gaWYgcmFuZ2Ug\nZG9lc24ndCByZXF1aXJlIGEgc3Vic2VsZWN0IGNhbiB1c2Ugc3VwZXIKICAg\nICAgICBpZiAoIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2Uoc2VsLmdldFN0\nYXJ0SW5kZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVuZEluZGV4KCksIHNl\nbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygpKSkKICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLmdldFNlbGVjdHMoc2VsLCBkaXN0aW5jdElkZW50\naWZpZXJzLCBmb3JVcGRhdGUpOwoKICAgICAgICAvLyBpZiB0aGVyZSBhcmUg\nbm8gam9pbnMgaW52b2x2ZWQgb3Igd2UncmUgdXNpbmcgYSBmcm9tIHNlbGVj\ndCBzbwogICAgICAgIC8vIHRoYXQgYWxsIGNvbHMgYWxyZWFkeSBoYXZlIHVu\naXF1ZSBhbGlhc2VzLCBjYW4gdXNlIHN1cGVyCiAgICAgICAgaWYgKHNlbC5n\nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCB8fCBzZWwuZ2V0VGFibGVBbGlhc2Vz\nKCkuc2l6ZSgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFNl\nbGVjdHMoc2VsLCBkaXN0aW5jdElkZW50aWZpZXJzLCBmb3JVcGRhdGUpOwoK\nICAgICAgICAvLyBzaW5jZSBub25lIG9mIHRoZSBjb25kaXRpb25zIGFib3Zl\nIHdlcmUgbWV0LCB3ZSdyZSBkZWFsaW5nIHdpdGgKICAgICAgICAvLyBhIHNl\nbGVjdCB0aGF0IHVzZXMgam9pbnMgYW5kIHJlcXVpcmVzIHN1YnNlbGVjdHMg\ndG8gc2VsZWN0IHRoZQogICAgICAgIC8vIHByb3BlciByYW5nZTsgYWxpYXMg\nYWxsIGNvbHVtbiB2YWx1ZXMgc28gdGhhdCB0aGV5IGFyZSB1bmlxdWUgd2l0\naGluCiAgICAgICAgLy8gdGhlIHN1YnNlbGVjdAogICAgICAgIFNRTEJ1ZmZl\nciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIExp\nc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlzdGluY3RJZGVudGlmaWVycykK\nICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlmaWVyQWxpYXNl\ncygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5n\nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAgIE9iamVjdCBhbGlhczsKICAg\nICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBh\nbGlhc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGkrKykgewogICAg\nICAgICAgICBhbGlhcyA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChh\nbGlhcyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgICAgIHNl\nbGVjdFNRTC5hcHBlbmQoKFNRTEJ1ZmZlcikgYWxpYXMpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGFsaWFz\nLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIg\nQVMgYyIpLmFwcGVuZChTdHJpbmcudmFsdWVPZihpKSk7CiAgICAgICAgICAg\nIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgc2VsZWN0U1FM\nLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGVj\ndFNRTDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5PdXRlckpvaW4o\naW50IHN5bnRheCwgRm9yZWlnbktleSBmaykgewogICAgICAgIGlmICghc3Vw\nZXIuY2FuT3V0ZXJKb2luKHN5bnRheCwgZmspKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgaWYgKGZrICE9IG51bGwgJiYgc3ludGF4ID09\nIFNZTlRBWF9EQVRBQkFTRSkgewogICAgICAgICAgICBpZiAoZmsuZ2V0Q29u\nc3RhbnRzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgaWYgKGZrLmdldFByaW1hcnlLZXlDb25zdGFu\ndHMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvTmF0aXZlSm9pbihKb2luIGpvaW4pIHsKICAg\nICAgICBpZiAoam9pbi5nZXRUeXBlKCkgIT0gSm9pbi5UWVBFX09VVEVSKQog\nICAgICAgICAgICByZXR1cm4gdG9UcmFkaXRpb25hbEpvaW4oam9pbik7Cgog\nICAgICAgIEZvcmVpZ25LZXkgZmsgPSBqb2luLmdldEZvcmVpZ25LZXkoKTsK\nICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGJvb2xlYW4gaW52ZXJzZSA9IGpvaW4uaXNGb3JlaWdu\nS2V5SW52ZXJzZWQoKTsKICAgICAgICBDb2x1bW5bXSBmcm9tID0gKGludmVy\nc2UpID8gZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKQogICAgICAgICAgICA6\nIGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSB0byA9IChpbnZl\ncnNlKSA/IGZrLmdldENvbHVtbnMoKQogICAgICAgICAgICA6IGZrLmdldFBy\naW1hcnlLZXlDb2x1bW5zKCk7CgogICAgICAgIC8vIGRvIGNvbHVtbiBqb2lu\ncwogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMp\nOwogICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmcm9tLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAg\nICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxp\nYXMxKCkpLmFwcGVuZCgiLiIpLmFwcGVuZChmcm9tW2ldKTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nam9pbi5nZXRBbGlhczIoKSkuYXBwZW5kKCIuIikuYXBwZW5kKHRvW2ldKTsK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiKCspIik7CiAgICAgICAgfQoKICAg\nICAgICAvLyBjaGVjayBjb25zdGFudCBqb2lucwogICAgICAgIGlmIChmay5n\nZXRDb25zdGFudENvbHVtbnMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm9yYWNsZS1jb25z\ndGFudCIsCiAgICAgICAgICAgICAgICBqb2luLmdldFRhYmxlMSgpLCBqb2lu\nLmdldFRhYmxlMigpKSkuc2V0RmF0YWwodHJ1ZSk7CgogICAgICAgIGlmIChm\nay5nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID4gMCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJvcmFjbGUtY29uc3RhbnQiLAogICAgICAgICAgICAgICAgam9pbi5nZXRU\nYWJsZTEoKSwgam9pbi5nZXRUYWJsZTIoKSkpLnNldEZhdGFsKHRydWUpOwog\nICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0LCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciB0YWJsZXMsIFNRTEJ1\nZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNRTEJ1ZmZl\nciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29sZWFuIGRp\nc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBl\nbmQsCiAgICAgICAgU2VsZWN0IHNlbCkgewogICAgICAgIGlmICghX2NoZWNr\nZWRVcGRhdGVCdWcpIHsKICAgICAgICAgICAgZW5zdXJlRHJpdmVyVmVuZG9y\nKCk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUgJiYgX2RyaXZlckJlaGF2\naW9yID09IEJFSEFWRV9EQVRBRElSRUNUMzEpCiAgICAgICAgICAgICAgICBs\nb2cud2FybihfbG9jLmdldCgiZGQtbG9jay1idWciKSk7CiAgICAgICAgICAg\nIF9jaGVja2VkVXBkYXRlQnVnID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAg\nIC8vIGlmIG5vIHJhbmdlLCB1c2Ugc3RhbmRhcmQgc2VsZWN0CiAgICAgICAg\naWYgKHN0YXJ0ID09IDAgJiYgZW5kID09IExvbmcuTUFYX1ZBTFVFKQogICAg\nICAgICAgICByZXR1cm4gc3VwZXIudG9TZWxlY3Qoc2VsZWN0LCBmZXRjaCwg\ndGFibGVzLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywKICAgICAgICAgICAgICAg\nIG9yZGVyLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxV\nRSwgc2VsKTsKCiAgICAgICAgLy8gaWYgbm8gc2tpcCwgb3JkZXJpbmcsIG9y\nIGRpc3RpbmN0IGNhbiB1c2Ugcm93bnVtIGRpcmVjdGx5CiAgICAgICAgU1FM\nQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYg\nKCFyZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKHN0YXJ0LCBlbmQsIGRpc3Rp\nbmN0LCBvcmRlcikpIHsKICAgICAgICAgICAgaWYgKHdoZXJlICE9IG51bGwg\nJiYgIXdoZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQod2hlcmUpLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7CiAgICAgICAg\nICAgIHJldHVybiBzdXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJs\nZXMsIGJ1ZiwgZ3JvdXAsIGhhdmluZywKICAgICAgICAgICAgICAgIG9yZGVy\nLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxVRSwgc2Vs\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoZXJlIGlzIG9yZGVyaW5n\nLCBza2lwLCBvciBkaXN0aW5jdCB3ZSBoYXZlIHRvIHVzZSBzdWJzZWxlY3Rz\nCiAgICAgICAgU1FMQnVmZmVyIG5ld3NlbCA9IHN1cGVyLnRvU2VsZWN0KHNl\nbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hlcmUsCiAgICAgICAgICAgIGdyb3Vw\nLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25n\nLk1BWF9WQUxVRSwKICAgICAgICAgICAgc2VsKTsKCiAgICAgICAgLy8gaWYg\nbm8gc2tpcCwgY2FuIHVzZSBzaW5nbGUgbmVzdGVkIHN1YnNlbGVjdAogICAg\nICAgIGlmIChzdGFydCA9PSAwKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSArICIgKiBGUk9NICgiKTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZChuZXdzZWwpOwogICAgICAgICAgICBidWYu\nYXBwZW5kKCIpIFdIRVJFIFJPV05VTSA8PSAiKS5hcHBlbmRWYWx1ZShlbmQp\nOwogICAgICAgICAgICByZXR1cm4gYnVmOwogICAgICAgIH0KCiAgICAgICAg\nLy8gd2l0aCBhIHNraXAsIHdlIGhhdmUgdG8gdXNlIGEgZG91YmxlLW5lc3Rl\nZCBzdWJzZWxlY3QgdG8gcHV0CiAgICAgICAgLy8gd2hlcmUgY29uZGl0aW9u\ncyBvbiB0aGUgcm93bnVtCiAgICAgICAgYnVmLmFwcGVuZChnZXRTZWxlY3RP\ncGVyYXRpb24oZmV0Y2gpCiAgICAgICAgICAgICsgIiAqIEZST00gKFNFTEVD\nVCByLiosIFJPV05VTSBSTlVNIEZST00gKCIpOwogICAgICAgIGJ1Zi5hcHBl\nbmQobmV3c2VsKTsKICAgICAgICBidWYuYXBwZW5kKCIpIHIiKTsKICAgICAg\nICBpZiAoZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgV0hFUkUgUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiKSBXSEVSRSBSTlVNID4gIikuYXBwZW5k\nVmFsdWUoc3RhcnQpOwogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgc2VsZWN0IHdpdGggdGhl\nIGdpdmVuIHBhcmFtZXRlcnMgbmVlZHMgYQogICAgICogc3Vic2VsZWN0IHRv\nIGFwcGx5IGEgcmFuZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBy\nZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKGxvbmcgc3RhcnQsIGxvbmcgZW5k\nLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3QsIFNRTEJ1ZmZlciBvcmRlcikg\newogICAgICAgIGlmIChzdGFydCA9PSAwICYmIGVuZCA9PSBMb25nLk1BWF9W\nQUxVRSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVy\nbiBzdGFydCAhPSAwIHx8IGRpc3RpbmN0IHx8IChvcmRlciAhPSBudWxsICYm\nICFvcmRlci5pc0VtcHR5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hl\nY2sgdG8gc2VlIGlmIHdlIGhhdmUgc2V0IHRoZSB7QGxpbmsgI1NFTEVDVF9I\nSU5UfSBpbiB0aGUKICAgICAqIGZldGNoIGNvbmZpZ3VyYWl0b24sIGFuZCBp\nZiBzbywgYXBwZW5kIHRoZSBPcmFjaGUgaGludCBhZnRlciB0aGUKICAgICAq\nICJTRUxFQ1QiIHBhcnQgb2YgdGhlIHF1ZXJ5LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldFNlbGVjdE9wZXJhdGlvbihKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB7CiAgICAgICAgT2JqZWN0IGhpbnQgPSBmZXRjaCA9\nPSBudWxsID8gbnVsbCA6IGZldGNoLmdldEhpbnQoU0VMRUNUX0hJTlQpOwog\nICAgICAgIFN0cmluZyBzZWxlY3QgPSAiU0VMRUNUIjsKICAgICAgICBpZiAo\naGludCAhPSBudWxsKQogICAgICAgICAgICBzZWxlY3QgKz0gIiAiICsgaGlu\ndDsKICAgICAgICByZXR1cm4gc2VsZWN0OwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFN0cmluZyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgU3RyaW5nIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIG9yYWNsZSBOQ0hBUi9O\nVkFSQ0hBUi9OQ0xPQiB1bmljb2RlIGNvbHVtbnMgcmVxdWlyZSBzb21lCiAg\nICAgICAgLy8gc3BlY2lhbCBoYW5kbGluZyB0byBjb25maWd1cmUgdGhlbSBj\nb3JyZWN0bHk7IHNlZToKICAgICAgICAvLyBodHRwOi8vd3d3Lm9yYWNsZS5j\nb20vdGVjaG5vbG9neS9zYW1wbGVfY29kZS90ZWNoL2phdmEvCiAgICAgICAg\nLy8gc3Fsal9qZGJjL2ZpbGVzLzlpX2pkYmMvTkNIQVJzdXBwb3J0NFVuaWNv\nZGVTYW1wbGUvUmVhZG1lLmh0bWwKICAgICAgICBTdHJpbmcgdHlwZU5hbWUg\nPSAoY29sID09IG51bGwpID8gbnVsbCA6IGNvbC5nZXRUeXBlTmFtZSgpOwog\nICAgICAgIGlmICh1c2VTZXRGb3JtT2ZVc2VGb3JVbmljb2RlICYmIHR5cGVO\nYW1lICE9IG51bGwgJiYKICAgICAgICAgICAgKHR5cGVOYW1lLnRvTG93ZXJD\nYXNlKCkuc3RhcnRzV2l0aCgibnZhcmNoYXIiKSB8fAogICAgICAgICAgICAg\nICAgdHlwZU5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCJuY2hhciIp\nIHx8CiAgICAgICAgICAgICAgICB0eXBlTmFtZS50b0xvd2VyQ2FzZSgpLnN0\nYXJ0c1dpdGgoIm5jbG9iIikpKSB7CiAgICAgICAgICAgIFN0YXRlbWVudCBp\nbm5lciA9IHN0bW50OwogICAgICAgICAgICBpZiAoaW5uZXIgaW5zdGFuY2Vv\nZiBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQpCiAgICAgICAgICAgICAg\nICBpbm5lciA9ICgoRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KSBpbm5l\ncikuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdhdGUo\nKTsKICAgICAgICAgICAgaWYgKGlzT3JhY2xlUHJlcGFyZWRTdGF0ZW1lbnQo\naW5uZXIpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIGlubmVyLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRGb3JtT2ZV\nc2UiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50\nLmNsYXNzLCBzaG9ydC5jbGFzcyB9KS4KICAgICAgICAgICAgICAgICAgICAg\nICAgaW52b2tlKGlubmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG5ldyBJbnRlZ2VyKGlkeCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQ2xhc3MuZm9yTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAoIm9yYWNsZS5qZGJjLk9yYWNsZVByZXBhcmVkU3RhdGVt\nZW50IikuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdl\ndEZpZWxkKCJGT1JNX05DSEFSIikuZ2V0KG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIV93\nYXJuZWROY2hhckNvbHVtbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICBfd2FybmVkTmNoYXJDb2x1bW4gPSB0cnVlOwogICAg\nICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVuY29uZmlndXJlZC1u\nY2hhci1jb2xzIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyBjYWxsIHNldEZpeGVkQ0hBUiBmb3IgZml4ZWQgd2lkdGggY2hhcmFj\ndGVyIGNvbHVtbnMgdG8gZ2V0IHBhZGRpbmcKICAgICAgICAvLyBzZW1hbnRp\nY3MKICAgICAgICBpZiAoY29sICE9IG51bGwgJiYgY29sLmdldFR5cGUoKSA9\nPSBUeXBlcy5DSEFSCiAgICAgICAgICAgICYmIHZhbCAhPSBudWxsICYmIHZh\nbC5sZW5ndGgoKSAhPSBjb2wuZ2V0U2l6ZSgpKSB7CiAgICAgICAgICAgIFN0\nYXRlbWVudCBpbm5lciA9IHN0bW50OwogICAgICAgICAgICBpZiAoaW5uZXIg\naW5zdGFuY2VvZiBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQpCiAgICAg\nICAgICAgICAgICBpbm5lciA9ICgoRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVt\nZW50KSBpbm5lcikuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0\nRGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKGlzT3JhY2xlUHJlcGFyZWRT\ndGF0ZW1lbnQoaW5uZXIpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIGlubmVyLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJz\nZXRGaXhlZENIQVIiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2xh\nc3NbXXsgaW50LmNsYXNzLCBTdHJpbmcuY2xhc3MgfSkuCiAgICAgICAgICAg\nICAgICAgICAgICAgIGludm9rZShpbm5lciwgbmV3IE9iamVjdFtdeyBuZXcg\nSW50ZWdlcihpZHgpLCB2YWwgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgICAgICBsb2cud2FybihlKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFfd2FybmVk\nQ2hhckNvbHVtbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgICAgICBfd2FybmVkQ2hhckNvbHVtbiA9IHRydWU7CiAgICAgICAgICAg\nICAgICBsb2cud2FybihfbG9jLmdldCgidW5wYWRkZWQtY2hhci1jb2xzIikp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN1cGVyLnNldFN0\ncmluZyhzdG1udCwgaWR4LCB2YWwsIGNvbCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0TnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgaW50IGNvbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoKGNvbFR5cGUgPT0g\nVHlwZXMuQ0xPQiB8fCBjb2xUeXBlID09IFR5cGVzLkJMT0IpICYmIGNvbC5p\nc05vdE51bGwoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoIm51bGwtYmxvYi1pbi1ub3QtbnVsbGFibGUiLCBjb2wK\nICAgICAgICAgICAgICAgIC5nZXRGdWxsTmFtZSgpKSk7CiAgICAgICAgaWYg\nKGNvbFR5cGUgPT0gVHlwZXMuQkxPQiAmJiBfZHJpdmVyQmVoYXZpb3IgPT0g\nQkVIQVZFX09SQUNMRSkKICAgICAgICAgICAgc3RtbnQuc2V0QmxvYihpZHgs\nIGdldEVtcHR5QmxvYigpKTsKICAgICAgICBlbHNlIGlmIChjb2xUeXBlID09\nIFR5cGVzLkNMT0IgJiYgX2RyaXZlckJlaGF2aW9yID09IEJFSEFWRV9PUkFD\nTEUKICAgICAgICAgICAgJiYgIWNvbC5pc1hNTCgpKQogICAgICAgICAgICBz\ndG1udC5zZXRDbG9iKGlkeCwgZ2V0RW1wdHlDbG9iKCkpOwogICAgICAgIGVs\nc2UgaWYgKChjb2xUeXBlID09IFR5cGVzLlNUUlVDVCB8fCBjb2xUeXBlID09\nIFR5cGVzLk9USEVSKQogICAgICAgICAgICAmJiBjb2wgIT0gbnVsbCAmJiBj\nb2wuZ2V0VHlwZU5hbWUoKSAhPSBudWxsKQogICAgICAgICAgICBzdG1udC5z\nZXROdWxsKGlkeCwgVHlwZXMuU1RSVUNULCBjb2wuZ2V0VHlwZU5hbWUoKSk7\nCiAgICAgICAgICAgIC8vIHNvbWUgdmVyc2lvbnMgb2YgdGhlIE9yYWNsZSBK\nREJDIGRyaXZlciB3aWxsIGZhaWwgaWYgY2FsbGluZwogICAgICAgICAgICAv\nLyBzZXROdWxsIHdpdGggREFURTsgc2VlIGJ1ZyAjMTE3MQogICAgICAgIGVs\nc2UgaWYgKGNvbFR5cGUgPT0gVHlwZXMuREFURSkKICAgICAgICAgICAgc3Vw\nZXIuc2V0TnVsbChzdG1udCwgaWR4LCBUeXBlcy5USU1FU1RBTVAsIGNvbCk7\nCiAgICAgICAgLy8gdGhlIE9yYWNsZSBkcml2ZXIgZG9lcyBub3Qgc3VwcG9y\ndCBUeXBlcy5PVEhFUiB3aXRoIHNldE51bGwKICAgICAgICBlbHNlIGlmIChj\nb2xUeXBlID09IFR5cGVzLk9USEVSIHx8IGNvbC5pc1hNTCgpKQogICAgICAg\nICAgICBzdXBlci5zZXROdWxsKHN0bW50LCBpZHgsIFR5cGVzLk5VTEwsIGNv\nbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdXBlci5zZXROdWxsKHN0\nbW50LCBpZHgsIGNvbFR5cGUsIGNvbCk7CiAgICB9CgogICAgcHVibGljIFN0\ncmluZyBnZXRDbG9iU3RyaW5nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2Ry\naXZlckJlaGF2aW9yICE9IEJFSEFWRV9PUkFDTEUpCiAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5nZXRDbG9iU3RyaW5nKHJzLCBjb2x1bW4pOwoKICAgICAg\nICBDbG9iIGNsb2IgPSBnZXRDbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlm\nIChjbG9iID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIGlmIChjbG9iLmdldENsYXNzKCkuZ2V0TmFtZSgpLmVxdWFscygib3Jh\nY2xlLnNxbC5DTE9CIikpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGlmICgoKEJvb2xlYW4pIENsYXNzLmZvck5hbWUoIm9yYWNsZS5z\ncWwuQ0xPQiIpLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGhvZCgiaXNF\nbXB0eUxvYiIsIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAgICAgICAgICAg\naW52b2tlKGNsb2IsIG5ldyBPYmplY3RbMF0pKS4KICAgICAgICAgICAgICAg\nICAgICBib29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIC8vIHBvc3NpYmx5IGRpZmZlcmVudCB2ZXJzaW9u\nIG9mIHRoZSBkcml2ZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBpZiAoY2xvYi5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgLy8gdW5saWtlbHkgdGhhdCB3ZSdsbCBoYXZlIHN0\ncmluZ3Mgb3ZlciA0IGJpbGxpb24gY2hhcnMKICAgICAgICByZXR1cm4gY2xv\nYi5nZXRTdWJTdHJpbmcoMSwgKGludCkgY2xvYi5sZW5ndGgoKSk7CiAgICB9\nCgogICAgcHVibGljIFRpbWVzdGFtcCBnZXRUaW1lc3RhbXAoUmVzdWx0U2V0\nIHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nZ2V0VGltZXN0YW1wKHJzLCBjb2x1bW4sIGNhbCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBhZSkgewog\nICAgICAgICAgICAgICAgLy8gQ1IyOTU2MDQ6IGlzc3VlIGEgd2FybmluZyB0\naGlzIHRoaXMgYnVnIGNhbiBiZSBnb3R0ZW4KICAgICAgICAgICAgICAgIC8v\nIGFyb3VuZCB3aXRoIFN1cHBvcnRzVGltZXN0YW1wTmFub3M9ZmFsc2UKICAg\nICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJvcmFjbGUtdGltZXN0\nYW1wLWJ1ZyIpLCBhZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBhZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIE9yYWNs\nZSBidWcgd2hlcmUgbmFub3Mgbm90IHJldHVybmVkIGZyb20gY2FsbCB3aXRo\nIENhbGVuZGFyCiAgICAgICAgLy8gcGFyYW1ldGVyCiAgICAgICAgVGltZXN0\nYW1wIHRzID0gcnMuZ2V0VGltZXN0YW1wKGNvbHVtbiwgY2FsKTsKICAgICAg\nICBpZiAodHMgIT0gbnVsbCAmJiB0cy5nZXROYW5vcygpID09IDApCiAgICAg\nICAgICAgIHRzLnNldE5hbm9zKHJzLmdldFRpbWVzdGFtcChjb2x1bW4pLmdl\ndE5hbm9zKCkpOwogICAgICAgIHJldHVybiB0czsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldE9iamVjdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4s\nIE1hcCBtYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gcmVjZW50IG9yYWNsZSBkcml2ZXJzIHJldHVybiBvcmFjbGUtc3Bl\nY2lmaWMgdHlwZXMgZm9yIHRpbWVzdGFtcHMKICAgICAgICAvLyBhbmQgZGF0\nZXMKICAgICAgICBPYmplY3Qgb2JqID0gc3VwZXIuZ2V0T2JqZWN0KHJzLCBj\nb2x1bW4sIG1hcCk7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoIm9yYWNsZS5zcWwuREFU\nRSIuZXF1YWxzKG9iai5nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAgICAgICAg\nICAgIG9iaiA9IGNvbnZlcnRGcm9tT3JhY2xlVHlwZShvYmosICJkYXRlVmFs\ndWUiKTsKICAgICAgICBlbHNlIGlmICgib3JhY2xlLnNxbC5USU1FU1RBTVAi\nLmVxdWFscyhvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAg\nICBvYmogPSBjb252ZXJ0RnJvbU9yYWNsZVR5cGUob2JqLCAidGltZXN0YW1w\nVmFsdWUiKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVydCBhbiBvYmplY3QgZnJvbSBpdHMgcHJvcHJpZXRhcnkg\nT3JhY2xlIHR5cGUgdG8gdGhlIHN0YW5kYXJkCiAgICAgKiBKYXZhIHR5cGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBjb252ZXJ0RnJv\nbU9yYWNsZVR5cGUoT2JqZWN0IG9iaiwKICAgICAgICBTdHJpbmcgY29udmVy\ndE1ldGhvZCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBNZXRob2QgbSA9IG9iai5nZXRDbGFzcygp\nLmdldE1ldGhvZChjb252ZXJ0TWV0aG9kLCAoQ2xhc3NbXSkgbnVsbCk7CiAg\nICAgICAgICAgIHJldHVybiBtLmludm9rZShvYmosIChPYmplY3RbXSkgbnVs\nbCk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAg\nICAgaWYgKHQgaW5zdGFuY2VvZiBJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9u\nKQogICAgICAgICAgICAgICAgdCA9ICgoSW52b2NhdGlvblRhcmdldEV4Y2Vw\ndGlvbikgdCkuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIGlm\nICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAgICAg\ndGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBuZXcg\nU1FMRXhjZXB0aW9uKHQuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2No\nZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5hbWUs\nIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gc3VwZXIuZ2V0Q29sdW1ucyht\nZXRhLCBjYXRhbG9nLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsCiAgICAgICAg\nICAgIGNvbHVtbk5hbWUsIGNvbm4pOwoKICAgICAgICBmb3IgKGludCBpID0g\nMDsgY29scyAhPSBudWxsICYmIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmIChjb2xzW2ldLmdldFR5cGVOYW1lKCkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoY29s\nc1tpXS5nZXRUeXBlTmFtZSgpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgi\nVElNRVNUQU1QIikpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUo\nVHlwZXMuVElNRVNUQU1QKTsKICAgICAgICAgICAgZWxzZSBpZiAoIkJMT0Ii\nLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgpKSkKICAg\nICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5CTE9CKTsKICAg\nICAgICAgICAgZWxzZSBpZiAoIkNMT0IiLmVxdWFsc0lnbm9yZUNhc2UoY29s\nc1tpXS5nZXRUeXBlTmFtZSgpKQogICAgICAgICAgICAgICAgfHwgIk5DTE9C\nIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkpCiAg\nICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQ0xPQik7CiAg\nICAgICAgICAgIGVsc2UgaWYgKCJGTE9BVCIuZXF1YWxzSWdub3JlQ2FzZShj\nb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29sc1tp\nXS5zZXRUeXBlKFR5cGVzLkZMT0FUKTsKICAgICAgICAgICAgZWxzZSBpZiAo\nIk5WQVJDSEFSIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5h\nbWUoKSkpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMu\nVkFSQ0hBUik7CiAgICAgICAgICAgIGVsc2UgaWYgKCJOQ0hBUiIuZXF1YWxz\nSWdub3JlQ2FzZShjb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAg\nICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLkNIQVIpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gY29sczsKICAgIH0KCiAgICBwdWJsaWMgUHJpbWFy\neUtleVtdIGdldFByaW1hcnlLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwK\nICAgICAgICBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUsIFN0\ncmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0g\nbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVD\nVCB0MC5PV05FUiBBUyBUQUJMRV9TQ0hFTSwgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgidDAuVEFCTEVfTkFNRSBBUyBUQUJMRV9OQU1FLCAiKS4KICAgICAg\nICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFNRSwg\nIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09OU1RSQUlOVF9OQU1FIEFT\nIFBLX05BTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfQ09O\nU19DT0xVTU5TIHQwLCBBTExfQ09OU1RSQUlOVFMgdDEgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiV0hFUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4KICAg\nICAgICAgICAgYXBwZW5kKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0gdDEu\nQ09OU1RSQUlOVF9OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0\nMS5DT05TVFJBSU5UX1RZUEUgPSAnUCciKTsKICAgICAgICBpZiAoc2NoZW1h\nTmFtZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQw\nLk9XTkVSID0gPyIpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0g\nPyIpOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4u\ncHJlcGFyZVN0YXRlbWVudChidWYudG9TdHJpbmcoKSk7CiAgICAgICAgUmVz\ndWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nbnQgaWR4ID0gMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHNj\naGVtYU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIGlm\nICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0cmlu\nZyhzdG1udCwgaWR4KyssIHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxs\nKTsKCiAgICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAg\nICAgICAgICAgIExpc3QgcGtMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAg\nICAgICAgICB3aGlsZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0KCkpCiAgICAg\nICAgICAgICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocnMpKTsKICAg\nICAgICAgICAgcmV0dXJuIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0FycmF5\nCiAgICAgICAgICAgICAgICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNpemUo\nKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBycy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIEluZGV4W10gZ2V0SW5kZXhJbmZvKERh\ndGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAg\nU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIGJvb2xlYW4g\ndW5pcXVlLCBib29sZWFuIGFwcHJveCwKICAgICAgICBDb25uZWN0aW9uIGNv\nbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3Ry\naW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBi\ndWYuYXBwZW5kKCJTRUxFQ1QgdDAuSU5ERVhfT1dORVIgQVMgVEFCTEVfU0NI\nRU0sICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLlRBQkxFX05BTUUgQVMg\nVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RFKHQx\nLlVOSVFVRU5FU1MsICdVTklRVUUnLCAwLCAnTk9OVU5JUVVFJywgMSkgIiku\nCiAgICAgICAgICAgIGFwcGVuZCgiQVMgTk9OX1VOSVFVRSwgIikuCiAgICAg\nICAgICAgIGFwcGVuZCgidDAuSU5ERVhfTkFNRSBBUyBJTkRFWF9OQU1FLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xV\nTU5fTkFNRSAiKS4KICAgICAgICAgICAgYXBwZW5kKCJGUk9NIEFMTF9JTkRf\nQ09MVU1OUyB0MCwgQUxMX0lOREVYRVMgdDEgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgiV0hFUkUgdDAuSU5ERVhfT1dORVIgPSB0MS5PV05FUiAiKS4KICAg\nICAgICAgICAgYXBwZW5kKCJBTkQgdDAuSU5ERVhfTkFNRSA9IHQxLklOREVY\nX05BTUUiKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLlRBQkxFX09XTkVSID0gPyIp\nOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwoKICAgICAg\nICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFyZVN0YXRl\nbWVudChidWYudG9TdHJpbmcoKSk7CiAgICAgICAgUmVzdWx0U2V0IHJzID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgaWR4ID0gMTsK\nICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHNjaGVtYU5hbWUudG9V\ncHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIGlmICh0YWJsZU5hbWUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4\nKyssIHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxsKTsKCiAgICAgICAg\nICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExp\nc3QgaWR4TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hp\nbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICAgICAg\naWR4TGlzdC5hZGQobmV3SW5kZXgocnMpKTsKICAgICAgICAgICAgcmV0dXJu\nIChJbmRleFtdKSBpZHhMaXN0LnRvQXJyYXkobmV3IEluZGV4W2lkeExpc3Qu\nc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldElt\ncG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRh\nbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVO\nYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGRlbEFjdGlvbiA9IG5ldyBT\ndHJpbmdCdWZmZXIoIkRFQ09ERSh0MS5ERUxFVEVfUlVMRSIpLgogICAgICAg\nICAgICBhcHBlbmQoIiwgJ05PIEFDVElPTicsICIpLmFwcGVuZChtZXRhLmlt\ncG9ydGVkS2V5Tm9BY3Rpb24pLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1JF\nU1RSSUNUJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlSZXN0cmljdCku\nCiAgICAgICAgICAgIGFwcGVuZCgiLCAnQ0FTQ0FERScsICIpLmFwcGVuZCht\nZXRhLmltcG9ydGVkS2V5Q2FzY2FkZSkuCiAgICAgICAgICAgIGFwcGVuZCgi\nLCAnU0VUIE5VTEwnLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRlZEtleVNldE51\nbGwpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1NFVCBERUZBVUxUJywgIiku\nYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0KS4KICAgICAgICAg\nICAgYXBwZW5kKCIpIik7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBu\nZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiU0VMRUNU\nIHQyLk9XTkVSIEFTIFBLVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAgICBh\ncHBlbmQoInQyLlRBQkxFX05BTUUgQVMgUEtUQUJMRV9OQU1FLCAiKS4KICAg\nICAgICAgICAgYXBwZW5kKCJ0Mi5DT0xVTU5fTkFNRSBBUyBQS0NPTFVNTl9O\nQU1FLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5PV05FUiBBUyBGS1RB\nQkxFX1NDSEVNLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5UQUJMRV9O\nQU1FIEFTIEZLVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgi\ndDAuQ09MVU1OX05BTUUgQVMgRktDT0xVTU5fTkFNRSwgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgidDAuUE9TSVRJT04gQVMgS0VZX1NFUSwgIikuCiAgICAg\nICAgICAgIGFwcGVuZChkZWxBY3Rpb24pLmFwcGVuZCgiIEFTIERFTEVURV9S\nVUxFLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT05TVFJBSU5UX05B\nTUUgQVMgRktfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RF\nKHQxLkRFRkVSUkVELCAnREVGRVJSRUQnLCAiKS4KICAgICAgICAgICAgYXBw\nZW5kKG1ldGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCkuCiAgICAg\nICAgICAgIGFwcGVuZCgiLCAnSU1NRURJQVRFJywgIikuCiAgICAgICAgICAg\nIGFwcGVuZChtZXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5SW1tZWRpYXRlKS4K\nICAgICAgICAgICAgYXBwZW5kKCIpIEFTIERFRkVSUkFCSUxJVFkgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xVTU5TIHQwLCBB\nTExfQ09OU1RSQUlOVFMgdDEsICIpLgogICAgICAgICAgICBhcHBlbmQoIkFM\nTF9DT05TX0NPTFVNTlMgdDIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiV0hF\nUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5k\nKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RSQUlOVF9OQU1F\nICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05TVFJBSU5UX1RZ\nUEUgPSAnUicgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQxLlJfT1dO\nRVIgPSB0Mi5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDEu\nUl9DT05TVFJBSU5UX05BTUUgPSB0Mi5DT05TVFJBSU5UX05BTUUgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgiQU5EIHQwLlBPU0lUSU9OID0gdDIuUE9TSVRJ\nT04iKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLk9XTkVSID0gPyIpOwogICAgICAg\nIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIiBPUkRFUiBCWSB0Mi5PV05FUiwgdDIuVEFCTEVfTkFNRSwgdDAuUE9T\nSVRJT04iKTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBj\nb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkpOwogICAgICAg\nIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaW50IGlkeCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hlbWFOYW1lICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsr\nLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwogICAgICAgICAg\nICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRT\ndHJpbmcoc3RtbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9VcHBlckNhc2UoKSwg\nbnVsbCk7CgogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgp\nOwogICAgICAgICAgICBMaXN0IGZrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsK\nICAgICAgICAgICAgd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQog\nICAgICAgICAgICAgICAgZmtMaXN0LmFkZChuZXdGb3JlaWduS2V5KHJzKSk7\nCiAgICAgICAgICAgIHJldHVybiAoRm9yZWlnbktleVtdKSBma0xpc3QudG9B\ncnJheQogICAgICAgICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2ZrTGlzdC5z\naXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\ncnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgcnMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBzdG1udC5jbG9zZSgpOwogICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVU\nYWJsZVNRTChUYWJsZSB0YWJsZSkgewogICAgICAgIC8vIG9ubHkgb3ZlcnJp\nZGUgaWYgd2UgYXJlIHNpbXVsYXRpbmcgYXV0by1pbmNyZW1lbmV0IHdpdGgg\ndHJpZ2dlcnMKICAgICAgICBTdHJpbmdbXSBjcmVhdGUgPSBzdXBlci5nZXRD\ncmVhdGVUYWJsZVNRTCh0YWJsZSk7CiAgICAgICAgaWYgKCF1c2VUcmlnZ2Vy\nc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBjcmVhdGU7Cgog\nICAgICAgIENvbHVtbltdIGNvbHMgPSB0YWJsZS5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgTGlzdCBzZXFzID0gbnVsbDsKICAgICAgICBTdHJpbmcgc2VxLCB0\ncmlnOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBjb2xzICE9IG51bGwgJiYg\naSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFjb2xz\nW2ldLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHNlcXMgPSBuZXcgQXJyYXlMaXN0KDQpOwoKICAgICAgICAgICAgc2Vx\nID0gYXV0b0Fzc2lnblNlcXVlbmNlTmFtZTsKICAgICAgICAgICAgaWYgKHNl\ncSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAob3BlbmpwYTNHZW5l\ncmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgICAgICAgICBzZXEgPSBnZXRP\ncGVuSlBBM0dlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2xzW2ldKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXEgPSBn\nZXRHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sc1tpXSk7CiAgICAgICAg\nICAgICAgICBzZXFzLmFkZCgiQ1JFQVRFIFNFUVVFTkNFICIgKyBzZXEgKyAi\nIFNUQVJUIFdJVEggMSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChvcGVuanBhM0dlbmVyYXRlZEtleU5hbWVzKQogICAgICAgICAgICAgICAg\ndHJpZyA9IGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5VHJpZ2dlck5hbWUoY29s\nc1tpXSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRyaWcg\nPSBnZXRHZW5lcmF0ZWRLZXlUcmlnZ2VyTmFtZShjb2xzW2ldKTsKCiAgICAg\nICAgICAgIC8vIGNyZWF0ZSB0aGUgdHJpZ2dlciB0aGF0IHdpbGwgaW5zZXJ0\nIG5ldyB2YWx1ZXMgaW50bwogICAgICAgICAgICAvLyB0aGUgdGFibGUgd2hl\nbmV2ZXIgYSByb3cgaXMgY3JlYXRlZAogICAgICAgICAgICBzZXFzLmFkZCgi\nQ1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiAiICsgdHJpZwogICAgICAgICAg\nICAgICAgKyAiIEJFRk9SRSBJTlNFUlQgT04gIiArIHRhYmxlLmdldE5hbWUo\nKQogICAgICAgICAgICAgICAgKyAiIEZPUiBFQUNIIFJPVyBCRUdJTiBTRUxF\nQ1QgIiArIHNlcSArICIubmV4dHZhbCBJTlRPICIKICAgICAgICAgICAgICAg\nICsgIjpuZXcuIiArIGNvbHNbaV0uZ2V0TmFtZSgpICsgIiBGUk9NIERVQUw7\nICIKICAgICAgICAgICAgICAgICsgIkVORCAiICsgdHJpZyArICI7Iik7CiAg\nICAgICAgfQogICAgICAgIGlmIChzZXFzID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBjcmVhdGU7CgogICAgICAgIC8vIGNvbWJpbmUgY3JlYXRlIHRh\nYmxlIHNxbCBhbmQgY3JlYXRlIHNlcWVuY2VzIHNxbAogICAgICAgIFN0cmlu\nZ1tdIHNxbCA9IG5ldyBTdHJpbmdbY3JlYXRlLmxlbmd0aCArIHNlcXMuc2l6\nZSgpXTsKICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGNyZWF0ZSwgMCwgc3Fs\nLCAwLCBjcmVhdGUubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHNlcXMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIHNxbFtjcmVhdGUu\nbGVuZ3RoICsgaV0gPSAoU3RyaW5nKSBzZXFzLmdldChpKTsKICAgICAgICBy\nZXR1cm4gc3FsOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVh\ndGVTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBTdHJpbmdb\nXSBzcWwgPSBzdXBlci5nZXRDcmVhdGVTZXF1ZW5jZVNRTChzZXEpOwogICAg\nICAgIGlmIChzZXEuZ2V0QWxsb2NhdGUoKSA+IDEpCiAgICAgICAgICAgIHNx\nbFswXSArPSAiIENBQ0hFICIgKyBzZXEuZ2V0QWxsb2NhdGUoKTsKICAgICAg\nICByZXR1cm4gc3FsOwogICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nU2VxdWVuY2VzU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVu\nY2VOYW1lKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJp\nbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgU0VRVUVO\nQ0VfT1dORVIgQVMgU0VRVUVOQ0VfU0NIRU1BLCAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJTRVFVRU5DRV9OQU1FIEZST00gQUxMX1NFUVVFTkNFUyIpOwog\nICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwgfHwgc2VxdWVuY2VOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAiKTsK\nICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIlNFUVVFTkNFX09XTkVSID0gPyIpOwogICAgICAgICAg\nICBpZiAoc2VxdWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vx\ndWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlNF\nUVVFTkNFX05BTUUgPSA/Iik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmlu\nZygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVu\nY2UoU3RyaW5nIG5hbWUsIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVh\nbiB0YXJnZXRTY2hlbWEpIHsKICAgICAgICBpZiAoc3VwZXIuaXNTeXN0ZW1T\nZXF1ZW5jZShuYW1lLCBzY2hlbWEsIHRhcmdldFNjaGVtYSkpCiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBmaWx0ZXIgb3V0IGdlbmVy\nYXRlZCBzZXF1ZW5jZXMgdXNlZCBmb3IgYXV0by1hc3NpZ24KICAgICAgICBy\nZXR1cm4gKGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWUgIT0gbnVsbAogICAgICAg\nICAgICAmJiBuYW1lLmVxdWFsc0lnbm9yZUNhc2UoYXV0b0Fzc2lnblNlcXVl\nbmNlTmFtZSkpCiAgICAgICAgICAgIHx8IChhdXRvQXNzaWduU2VxdWVuY2VO\nYW1lID09IG51bGwKICAgICAgICAgICAgJiYgbmFtZS50b1VwcGVyQ2FzZSgp\nLnN0YXJ0c1dpdGgoIlNUXyIpKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldEdlbmVyYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCF1\nc2VUcmlnZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBO\ndW1iZXJzLnZhbHVlT2YoMEwpOwoKICAgICAgICAvLyBpZiB3ZSBzaW11bGF0\nZSBhdXRvLWFzc2lnbmVkIGNvbHVtbnMgdXNpbmcgdHJpZ2dlcnMgYW5kCiAg\nICAgICAgLy8gc2VxdWVuY2VzLCB0aGVuIHJldHVybiB0aGUgY3VycmVudCB2\nYWx1ZSBvZiB0aGUgc2VxdWVuY2UKICAgICAgICAvLyBmcm9tIGF1dG9Bc3Np\nZ25TZXF1ZW5jZU5hbWUKICAgICAgICBTdHJpbmcgc2VxID0gYXV0b0Fzc2ln\nblNlcXVlbmNlTmFtZTsKICAgICAgICBpZiAoc2VxID09IG51bGwgJiYgb3Bl\nbmpwYTNHZW5lcmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgc2VxID0gZ2V0\nT3BlbkpQQTNHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAg\nICBlbHNlIGlmIChzZXEgPT0gbnVsbCkKICAgICAgICAgICAgc2VxID0gZ2V0\nR2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbCk7CiAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoIlNF\nTEVDVCAiICsgc2VxCiAgICAgICAgICAgICsgIi5jdXJydmFsIEZST00gRFVB\nTCIpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAg\nICAgICAgICAgcnMubmV4dCgpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVy\ncy52YWx1ZU9mKHJzLmdldExvbmcoMSkpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nfQogICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVHJpZ2dlciBuYW1lIGZvciBzaW11bGF0aW5nIGF1dG8tYXNzaWdu\nIHZhbHVlcyBvbiB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwcm90\nZWN0ZWQgU3RyaW5nIGdldEdlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVt\nbiBjb2wpIHsKICAgICAgICAvLyByZXBsYWNlIHRyYWlsaW5nIF9TRVEgd2l0\naCBfVFJHCiAgICAgICAgU3RyaW5nIHNlcU5hbWUgPSBnZXRHZW5lcmF0ZWRL\nZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAgICByZXR1cm4gc2VxTmFtZS5z\ndWJzdHJpbmcoMCwgc2VxTmFtZS5sZW5ndGgoKSAtIDMpICsgIlRSRyI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgT3BlbkpQQSAzLWNvbXBh\ndGlibGUgbmFtZSBmb3IgYW4gYXV0by1hc3NpZ24gc2VxdWVuY2UuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0T3BlbkpQQTNHZW5lcmF0ZWRL\nZXlTZXF1ZW5jZU5hbWUoQ29sdW1uIGNvbCkgewogICAgICAgIFRhYmxlIHRh\nYmxlID0gY29sLmdldFRhYmxlKCk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1l\nVmFsaWQoIlNFUV8iICsgdGFibGUuZ2V0TmFtZSgpLCB0YWJsZS5nZXRTY2hl\nbWEoKS4KICAgICAgICAgICAgZ2V0U2NoZW1hR3JvdXAoKSwgbWF4VGFibGVO\nYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIGEgT3BlbkpQQSAzLWNvbXBhdGlibGUgbmFtZSBmb3IgYW4gYXV0\nby1hc3NpZ24gdHJpZ2dlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmlu\nZyBnZXRPcGVuSlBBM0dlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBj\nb2wpIHsKICAgICAgICBUYWJsZSB0YWJsZSA9IGNvbC5nZXRUYWJsZSgpOwog\nICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKCJUUklHXyIgKyB0YWJsZS5n\nZXROYW1lKCksIHRhYmxlLmdldFNjaGVtYSgpLgogICAgICAgICAgICBnZXRT\nY2hlbWFHcm91cCgpLCBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5w\ndXRCeXRlczwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVj\ndC4KICAgICAqIFVzZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBibG9iIGlz\nIHdyYXBwZWQgaW4gYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNs\nYXNzOyBmb3IgZXhhbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBk\ncml2ZXIKICAgICAqIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGgg\ndGhlIHNhbWUgbWV0aG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0\nQnl0ZXMoT2JqZWN0IGJsb2IsIGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChibG9iID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX3B1dEJ5dGVzID09IG51\nbGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9wdXRC\neXRlcyA9IGJsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInB1dEJ5dGVzIiwK\nICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywg\nYnl0ZVtdLmNsYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0\naW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9r\nZVB1dExvYk1ldGhvZChfcHV0Qnl0ZXMsIGJsb2IsIGRhdGEpOwogICAgfQoK\nICAgIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1dFN0cmlu\nZzwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CIG9iamVjdC4KICAg\nICAqIFVzZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBw\nZWQgaW4gYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBm\nb3IgZXhhbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIK\nICAgICAqIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNh\nbWUgbWV0aG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0U3RyaW5n\nKE9iamVjdCBjbG9iLCBTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3B1dFN0cmluZyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcHV0U3RyaW5n\nID0gY2xvYi5nZXRDbGFzcygpLmdldE1ldGhvZCgicHV0U3RyaW5nIiwKICAg\nICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgU3Ry\naW5nLmNsYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1\ndExvYk1ldGhvZChfcHV0U3RyaW5nLCBjbG9iLCBkYXRhKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5wdXRDaGFyczwv\nY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CCiAgICAgKiBvYmplY3Qu\nIFVzZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBwZWQg\naW4gYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3Ig\nZXhhbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAg\nICAqIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUg\nbWV0aG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Q2hhcnMoT2Jq\nZWN0IGNsb2IsIGNoYXJbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChfcHV0Q2hhcnMgPT0gbnVsbCkgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3B1dENoYXJzID0gY2xv\nYi5nZXRDbGFzcygpLmdldE1ldGhvZCgicHV0Q2hhcnMiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBjaGFyW10uY2xh\nc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0\naG9kKF9wdXRDaGFycywgY2xvYiwgZGF0YSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbnZva2UgdGhlIGdpdmVuIExPQiBtZXRob2Qgb24gdGhlIGdpdmVu\nIHRhcmdldCB3aXRoIHRoZSBnaXZlbiBkYXRhLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyB2b2lkIGludm9rZVB1dExvYk1ldGhvZChNZXRob2QgbWV0\naG9kLCBPYmplY3QgdGFyZ2V0LAogICAgICAgIE9iamVjdCBkYXRhKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIG1ldGhvZC5pbnZva2UodGFyZ2V0LCBuZXcgT2JqZWN0W117IE51\nbWJlcnMudmFsdWVPZigxTCksIGRhdGEgfSk7CiAgICAgICAgfSBjYXRjaCAo\nSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbiBpdGUpIHsKICAgICAgICAgICAg\nVGhyb3dhYmxlIHQgPSBpdGUuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAg\nICAgICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24odCk7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhj\nZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIENsb2Ig\nZ2V0RW1wdHlDbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoRU1QVFlfQ0xPQiAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gRU1QVFlfQ0xPQjsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gRU1QVFlfQ0xPQiA9IChDbG9iKSBDbGFzcy5mb3JOYW1lKCJvcmFj\nbGUuc3FsLkNMT0IiLHRydWUsIAogICAgICAgICAgICAgICAgICAgIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29udGV4dENsYXNzTG9hZGVy\nQWN0aW9uKCkpKS4KICAgICAgICAgICAgICAgIGdldE1ldGhvZCgiZW1wdHlf\nbG9iIiwgbmV3IENsYXNzWzBdKS4KICAgICAgICAgICAgICAgIGludm9rZShu\ndWxsLCBuZXcgT2JqZWN0WzBdKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGUu\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBC\nbG9iIGdldEVtcHR5QmxvYigpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKEVNUFRZX0JMT0IgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIEVNUFRZX0JMT0I7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgcmV0dXJuIEVNUFRZX0JMT0IgPSAoQmxvYikgQ2xhc3MuZm9yTmFtZSgi\nb3JhY2xlLnNxbC5CTE9CIix0cnVlLCAKICAgICAgICAgICAgICAgICAgICBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbnRleHRDbGFzc0xv\nYWRlckFjdGlvbigpKSkuCiAgICAgICAgICAgICAgICBnZXRNZXRob2QoImVt\ncHR5X2xvYiIsIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAgICAgICBpbnZv\na2UobnVsbCwgbmV3IE9iamVjdFswXSk7CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlv\nbihlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgc3RhdGljIGJvb2xlYW4gaXNPcmFjbGVQcmVwYXJlZFN0YXRlbWVudChT\ndGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gQ2xhc3MuZm9yTmFtZSgib3JhY2xlLmpkYmMuT3JhY2xlUHJlcGFy\nZWRTdGF0ZW1lbnQiKS4KICAgICAgICAgICAgICAgIGlzSW5zdGFuY2Uoc3Rt\nbnQpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogSWYgdGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRzIFhNTCB0eXBl\nLAogICAgICogdXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB4bWwgcHJlZGlj\nYXRlLgogICAgICogCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVy\nIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFyYW0gb3AgdGhl\nIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAgICAqIEBwYXJh\nbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAg\nICAgKiBAcGFyYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIGNv\nbXBhcmlzb24KICAgICAqLwogICAgcHVibGljIHZvaWQgYXBwZW5kWG1sQ29t\ncGFyaXNvbihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVl\nIGxocywKICAgICAgICBGaWx0ZXJWYWx1ZSByaHMsIGJvb2xlYW4gbGhzeG1s\nLCBib29sZWFuIHJoc3htbCkgewogICAgICAgIHN1cGVyLmFwcGVuZFhtbENv\nbXBhcmlzb24oYnVmLCBvcCwgbGhzLCByaHMsIGxoc3htbCwgcmhzeG1sKTsK\nICAgICAgICBpZiAobGhzeG1sICYmIHJoc3htbCkKICAgICAgICAgICAgYXBw\nZW5kWG1sQ29tcGFyaXNvbjIoYnVmLCBvcCwgbGhzLCByaHMpOwogICAgICAg\nIGVsc2UgaWYgKGxoc3htbCkKICAgICAgICAgICAgYXBwZW5kWG1sQ29tcGFy\naXNvbjEoYnVmLCBvcCwgbGhzLCByaHMpOwogICAgICAgIGVsc2UgCiAgICAg\nICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwgb3AsIHJocywgbGhz\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBcHBlbmQgYW4geG1sIGNv\nbXBhcmlzb24gcHJlZGljYXRlCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0\naGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFyaXNvbgogICAgICog\nQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlvbiB0byBwZXJmb3Jt\nCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQgc2lkZSBvZiB0aGUg\nY29tcGFyaXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAgICogQHBhcmFt\nIHJocyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxDb21wYXJpc29uMShT\nUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsCiAgICAgICAgRmlsdGVyVmFsdWUg\nbGhzLCBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBhcHBlbmRYbWxFeHRy\nYWN0VmFsdWUoYnVmLCBsaHMpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5h\ncHBlbmQob3ApLmFwcGVuZCgiICIpOwogICAgICAgIHJocy5hcHBlbmRUbyhi\ndWYpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFwcGVuZCBhbiB4bWwg\nY29tcGFyaXNvbiBwcmVkaWNhdGUgKGJvdGggb3BlcmFuZHMgbWFwIHRvIHht\nbCBjb2x1bW4pCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1\nZmZlciB0byB3cml0ZSB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFtIG9w\nIHRoZSBjb21wYXJpc29uIG9wZXJhdGlvbiB0byBwZXJmb3JtCiAgICAgKiBA\ncGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFyaXNv\nbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAgICogQHBhcmFtIHJocyB0aGUg\ncmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uIChtYXBzIHRvIHht\nbCBjb2x1bW4pCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxD\nb21wYXJpc29uMihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsIAogICAgICAg\nIEZpbHRlclZhbHVlIGxocywgRmlsdGVyVmFsdWUgcmhzKSB7CiAgICAgICAg\nYXBwZW5kWG1sRXh0cmFjdFZhbHVlKGJ1ZiwgbGhzKTsKICAgICAgICBidWYu\nYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAiKTsKICAgICAgICBh\ncHBlbmRYbWxFeHRyYWN0VmFsdWUoYnVmLCByaHMpOwogICAgfQogICAgCiAg\nICBwcml2YXRlIHZvaWQgYXBwZW5kWG1sRXh0cmFjdFZhbHVlKFNRTEJ1ZmZl\nciBidWYsIEZpbHRlclZhbHVlIHZhbCkgewogICAgICAgIGJ1Zi5hcHBlbmQo\nImV4dHJhY3RWYWx1ZSgiKS4KICAgICAgICAgICAgYXBwZW5kKHZhbC5nZXRD\nb2x1bW5BbGlhcygKICAgICAgICAgICAgdmFsLmdldEZpZWxkTWFwcGluZygp\nLmdldENvbHVtbnMoKVswXSkpLgogICAgICAgICAgICBhcHBlbmQoIiwnLyov\nIik7CiAgICAgICAgdmFsLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFw\ncGVuZCgiJykiKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgaW5zZXJ0\nQmxvYkZvclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1uIGNvbCwgT2Jq\nZWN0IG9iKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmIChvYiA9PSBudWxsKQogICAgICAgICAgICBjb2wuc2V0VHlwZShUeXBl\ncy5PVEhFUik7CiAgICAgICAgcm93LnNldE51bGwoY29sKTsKICAgIH0KICAg\nIAogICAgcHVibGljIHZvaWQgaW5zZXJ0Q2xvYkZvclN0cmVhbWluZ0xvYWQo\nUm93IHJvdywgQ29sdW1uIGNvbCwgT2JqZWN0IG9iKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChvYiA9PSBudWxsKQogICAg\nICAgICAgICBjb2wuc2V0VHlwZShUeXBlcy5PVEhFUik7CiAgICAgICAgcm93\nLnNldE51bGwoY29sKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEJhdGNo\nVXBkYXRlQ291bnQoUHJlcGFyZWRTdGF0ZW1lbnQgcHMpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGludCB1cGRhdGVTdWNjZXNzQ250ID0gMDsK\nICAgICAgICBpZiAoYmF0Y2hMaW1pdCAhPSAwICYmIHBzICE9IG51bGwpIHsK\nICAgICAgICAgICAgdXBkYXRlU3VjY2Vzc0NudCA9IHBzLmdldFVwZGF0ZUNv\ndW50KCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiYmF0Y2gtdXBk\nYXRlLXN1Y2Nlc3MtY291bnQiLAogICAgICAgICAgICAgICAgICAgIHVwZGF0\nZVN1Y2Nlc3NDbnQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVwZGF0\nZVN1Y2Nlc3NDbnQ7CiAgICB9Cn0K\n","encoding":"base64"}

