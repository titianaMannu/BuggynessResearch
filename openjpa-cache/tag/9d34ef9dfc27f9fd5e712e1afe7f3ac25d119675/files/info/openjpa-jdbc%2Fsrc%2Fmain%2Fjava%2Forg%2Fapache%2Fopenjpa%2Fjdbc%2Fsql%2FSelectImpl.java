{"sha":"3c492d3a6e4dc449b86cd99f7fd6bad30a777569","node_id":"MDQ6QmxvYjIwNjM2NDozYzQ5MmQzYTZlNGRjNDQ5Yjg2Y2Q5OWY3ZmQ2YmFkMzBhNzc3NTY5","size":101984,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3c492d3a6e4dc449b86cd99f7fd6bad30a777569","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5pdGVyYXRvcnMuRW1wdHlJ\ndGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDTG9j\na01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLkpEQkNTdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2luYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogU3RhbmRhcmQge0BsaW5r\nIFNlbGVjdH0gaW1wbGVtZW50YXRpb24uIFVzYWdlIG5vdGU6IHRob3VnaCB0\naGlzIGNsYXNzCiAqIGltcGxlbWVudHMge0BsaW5rIEpvaW5zfSwgaXQgc2hv\ndWxkIG5vdCBiZSB1c2VkIGZvciBqb2luaW5nIGRpcmVjdGx5LgogKiBJbnN0\nZWFkLCB1c2UgdGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgI25ld0pvaW5z\nfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFNlbGVjdEltcGwKICAgIGltcGxlbWVudHMgU2VsZWN0\nLCBQYXRoSm9pbnMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBO\nT05BVVRPX0RJU1RJTkNUID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IERJU1RJTkNUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE5PVF9ESVNUSU5DVCA9IDIgPDwgMjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBJTVBMSUNJVF9ESVNUSU5DVCA9IDIgPDwg\nMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT19NQU5ZID0gMiA8\nPCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFHR1JFR0FURSA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMT0IgPSAy\nIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1VURVIgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTFJTID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX09O\nRSA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBFQUdF\nUl9UT19NQU5ZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBSRUNPUkRfT1JERVJFRCA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgR1JPVVBJTkcgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZPUkNFX0NPVU5UID0gMiA8PCAxMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBUQUJMRV9BTElBU0VT\nID0gbmV3IFN0cmluZ1sxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndHJpbmdbXSBPUkRFUl9BTElBU0VTID0gbmV3IFN0cmluZ1sxNl07CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBOVUxMX0lEUyA9IG5ldyBP\nYmplY3RbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nUExBQ0VIT0xERVJTID0gbmV3IE9iamVjdFs1MF07CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShTZWxlY3QuY2xhc3MpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBUQUJMRV9BTElBU0VTLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBUQUJMRV9BTElBU0VTW2ldID0gInQiICsgaTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IE9SREVSX0FMSUFTRVMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE9SREVSX0FMSUFTRVNbaV0gPSAibyIgKyBpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTlVMTF9JRFMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE5VTExfSURTW2ldID0gbmV3IE51bGxJZCgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUExBQ0VIT0xERVJTLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBQTEFDRUhPTERFUlNbaV0gPSBuZXcgUGxh\nY2Vob2xkZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEpEQkNDb25m\naWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25h\ncnkgX2RpY3Q7CgogICAgLy8gbWFwIG9mIHZhcmlhYmxlICsgcmVsYXRpb24g\ncGF0aCArIHRhYmxlIGtleXMgdG8gdGhlIGNvcnJlY3QgYWxpYXMgaW5kZXg6\nCiAgICAvLyBlYWNoIHJlbGF0aW9uIHBhdGgvdGFibGUgY29tYmluYXRpb24g\nc2hvdWxkIGhhdmUgYSB1bmlxdWUgYWxpYXMgYmVjYXVzZQogICAgLy8gaXQg\ncmVwcmVzZW50cyBhIHNlcGFyYXRlIG9iamVjdDsgZm9yIGV4YW1wbGUsIGlm\nIGEgUGVyc29uIGNsYXNzIGhhcyBhCiAgICAvLyAncGFyZW50JyBmaWVsZCBy\nZXByZXNlbnRpbmcgYW5vdGhlciBQZXJzb24gYW5kIGFsc28gaGFzIGFuICdh\nZGRyZXNzJwogICAgLy8gZmllbGQgb2YgdHlwZSBBZGRyZXNzOgogICAgLy8g\nJ2FkZHJlc3Muc3RyZWV0JyBzaG91bGQgbWFwIHRvIGEgZGlmZmVyZW50IHRh\nYmxlIGFsaWFzIHRoYW4KICAgIC8vICdwYXJlbnQuYWRkcmVzcy5zdHJlZXQn\nIGZvciB0aGUgcHVycG9zZXMgb2YgY29tcGFyaXNvbnMKICAgIHByaXZhdGUg\nTWFwIF9hbGlhc2VzID0gbnVsbDsKCiAgICAvLyB0byBjYWNoZSB0YWJsZSBh\nbGlhcyB1c2luZyBUYWJsZSBhcyB0aGUga2V5CiAgICBwcml2YXRlIE1hcCBf\ndGFibGVBbGlhc2VzID0gbnVsbDsKCiAgICAvLyBtYXAgb2YgaW5kZXhlcyB0\nbyB0YWJsZSBhbGlhc2VzIGxpa2UgJ1RBQkxFTkFNRSB0MCcKICAgIHByaXZh\ndGUgU29ydGVkTWFwIF90YWJsZXMgPSBudWxsOwoKICAgIC8vIGNvbWJpbmVk\nIGxpc3Qgb2Ygc2VsZWN0ZWQgaWRzIGFuZCBtYXAgb2YgZWFjaCBpZCB0byBp\ndHMgYWxpYXMKICAgIHByb3RlY3RlZCBmaW5hbCBTZWxlY3RzIF9zZWxlY3Rz\nID0gbmV3U2VsZWN0cygpOwogICAgcHJpdmF0ZSBMaXN0IF9vcmRlcmVkID0g\nbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfZ3JvdXBlZCA9IG51bGw7CgogICAg\nLy8gZmxhZ3MKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2\nYXRlIGludCBfam9pblN5bnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5N\nQVhfVkFMVUU7CiAgICBwcml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBw\ncml2YXRlIGludCBfb3JkZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFj\nZWhvbGRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0\nQ291bnQgPSAwOwoKICAgIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vcmRlcmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBfd2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dy\nb3VwaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcg\nPSBudWxsOwoKICAgIC8vIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91\nciB3aGVyZSBjbGF1c2UsIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAv\nLyBhbGwgc2VsZWN0cyAoc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhv\nZCkKICAgIHByaXZhdGUgU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAg\nb2Ygam9pbnMra2V5cyB0byBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0\nIG9mIGVhZ2VyIGtleXM7IHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUg\ndXNlZCBtb3JlIHRoYW4gb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAg\nIC8vIHN1YnNlbGVjdCBzdXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAg\nIC8vIGZyb20gc2VsZWN0IGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBh\nIHRtcCB0YWJsZSBjcmVhdGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2Vs\nZWN0SW1wbCBfZnJvbSA9IG51bGw7CiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1w\nbCBfb3V0ZXIgPSBudWxsOwogICAgCiAgICAvLyBiaXRTZXQgaW5kaWNhdGlu\nZyBpZiBhbiBhbGlhcyBpcyByZW1vdmVkIGZyb20gcGFyZW50IHNlbGVjdAog\nICAgLy8gYml0IDAgOiBjb3JyZXNwb25kIHRvIGFsaWFzIDAKICAgIC8vIGJp\ndCAxIDogY29ycmVzcG9uZCB0byBhbGlhcyAxLCBldGMuCiAgICAvLyBpZiB0\naGUgYml0IGlzIHNldCwgdGhlIGNvcnJlc3BvbmRpbmcgYWxpYXMgaGFzIGJl\nZW4gcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgLy8gYW5kIHJlY29yZGVkIHVu\nZGVyIHN1YnNlbGVjdC4KICAgIHByaXZhdGUgQml0U2V0IF9yZW1vdmVkQWxp\nYXNGcm9tUGFyZW50ID0gbmV3IEJpdFNldCgxNik7CgogICAgLy9jb250YWlu\ncyBmaW5hbCBzcWwgc3RhdGVtZW50IHRvIGJlIGV4ZWN1dGVkL2NhY2hlZAog\nICAgcHJpdmF0ZSBTUUxCdWZmZXIgX3NxbCA9IG51bGw7CiAgICAKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhlIHByb3BlciB0\nYWJsZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGFsaWFzIGluZGV4LgogICAgICov\nCiAgICBzdGF0aWMgU3RyaW5nIHRvQWxpYXMoaW50IGluZGV4KSB7CiAgICAg\nICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoaW5kZXggPCBUQUJMRV9BTElBU0VTLmxlbmd0aCkKICAg\nICAgICAgICAgcmV0dXJuIFRBQkxFX0FMSUFTRVNbaW5kZXhdOwogICAgICAg\nIHJldHVybiAidCIgKyBpbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgb3JkZXIgYWxpYXMg\nZm9yIHRoZSBnaXZlbiBvcmRlcgogICAgICogY29sdW1uIGluZGV4LgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b09yZGVyQWxpYXMoaW50\nIGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBPUkRFUl9BTElB\nU0VTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIE9SREVSX0FMSUFTRVNb\naW5kZXhdOwogICAgICAgIHJldHVybiAibyIgKyBpbmRleDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIFNlbGVjdEltcGwoSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBf\nZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAg\nICAgX2pvaW5TeW50YXggPSBfZGljdC5qb2luU3ludGF4OwogICAgICAgIF9z\nZWxlY3RzLl9kaWN0ID0gX2RpY3Q7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3RFeGVjdXRvciBp\nbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIEpEQkNDb25maWd1cmF0aW9uIGdldENvbmZp\nZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoYm9vbGVhbiBmb3JVcGRhdGUs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1\ncm4gX2RpY3QudG9TZWxlY3QodGhpcywgZm9yVXBkYXRlLCBmZXRjaCk7CiAg\nICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdENvdW50KCkgewog\nICAgICAgIHJldHVybiBfZGljdC50b1NlbGVjdENvdW50KHRoaXMpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGdldEF1dG9EaXN0aW5jdCgpIHsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIE5PTkFVVE9fRElTVElOQ1QpID09IDA7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0Rpc3RpbmN0KGJvb2xl\nYW4gdmFsKSB7CiAgICAgICAgaWYgKHZhbCkKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5OT05BVVRPX0RJU1RJTkNUOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX2ZsYWdzIHw9IE5PTkFVVE9fRElTVElOQ1Q7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNEaXN0aW5jdCgpIHsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIE5PVF9ESVNUSU5DVCkgPT0gMCAmJiAoKF9mbGFncyAmIERJU1RJ\nTkNUKSAhPSAwCiAgICAgICAgICAgIHx8ICgoX2ZsYWdzICYgTk9OQVVUT19E\nSVNUSU5DVCkgPT0gMAogICAgICAgICAgICAmJiAoX2ZsYWdzICYgSU1QTElD\nSVRfRElTVElOQ1QpICE9IDApKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXREaXN0aW5jdChib29sZWFuIGRpc3RpbmN0KSB7CiAgICAgICAgLy8gbmVl\nZCB0d28gZmxhZ3MgaW4gY2FzZSBzZXQgbm90X2Rpc3RpbmN0LCB0aGVuIGEg\ndG8tbWFueSBqb2luIGhhcHBlbnMKICAgICAgICAvLyBhbmQgZGlzdGluY3Qg\nZmxhZyBnZXRzIHNldCBhdXRvbWF0aWNhbGx5CiAgICAgICAgaWYgKGRpc3Rp\nbmN0KSB7CiAgICAgICAgICAgIF9mbGFncyB8PSBESVNUSU5DVDsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5OT1RfRElTVElOQ1Q7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IE5PVF9ESVNUSU5DVDsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5ESVNUSU5DVDsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNMUlMoKSB7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBMUlMpICE9IDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nTFJTKGJvb2xlYW4gbHJzKSB7CiAgICAgICAgaWYgKGxycykKICAgICAgICAg\nICAgX2ZsYWdzIHw9IExSUzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9m\nbGFncyAmPSB+TFJTOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RXhwZWN0\nZWRSZXN1bHRDb3VudCgpIHsKICAgICAgICAvLyBpZiB0aGUgY291bnQgaXNu\nJ3QgZm9yY2VkIGFuZCB3ZSBoYXZlIHRvLW1hbnkgZWFnZXIgam9pbnMgdGhh\ndCBjb3VsZAogICAgICAgIC8vIHRocm93IHRoZSBjb3VudCBvZmYsIGRvbid0\nIHBheSBhdHRlbnRpb24gdG8gaXQKICAgICAgICBpZiAoKF9mbGFncyAmIEZP\nUkNFX0NPVU5UKSA9PSAwICYmIGhhc0VhZ2VySm9pbih0cnVlKSkKICAgICAg\nICAgICAgcmV0dXJuIDA7CiAgICAgICAgcmV0dXJuIF9leHBlY3RlZFJlc3Vs\ndENvdW50OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEV4cGVjdGVkUmVz\ndWx0Q291bnQoaW50IGV4cGVjdGVkUmVzdWx0Q291bnQsIGJvb2xlYW4gZm9y\nY2UpIHsKICAgICAgICBfZXhwZWN0ZWRSZXN1bHRDb3VudCA9IGV4cGVjdGVk\nUmVzdWx0Q291bnQ7CiAgICAgICAgaWYgKGZvcmNlKQogICAgICAgICAgICBf\nZmxhZ3MgfD0gRk9SQ0VfQ09VTlQ7CiAgICAgICAgZWxzZSAKICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GT1JDRV9DT1VOVDsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldEpvaW5TeW50YXgoKSB7CiAgICAgICAgcmV0dXJuIF9qb2luU3lu\ndGF4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEpvaW5TeW50YXgoaW50\nIGpvaW5TeW50YXgpIHsKICAgICAgICBfam9pblN5bnRheCA9IGpvaW5TeW50\nYXg7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21B\nY2Nlc3MoYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICByZXR1cm4gX2Rp\nY3Quc3VwcG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQodGhpcywgZm9yVXBk\nYXRlKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tp\nbmcoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0LnN1cHBvcnRzTG9ja2luZyh0\naGlzKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENvdW50KEpEQkNTdG9y\nZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBDb25uZWN0aW9uIGNvbm4gPSBudWxsOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBu\ndWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBzcWwg\nPSB0b1NlbGVjdENvdW50KCk7CiAgICAgICAgICAgIGNvbm4gPSBzdG9yZS5n\nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0\nYXRlbWVudChjb25uLCBzcWwsIG51bGwsIAogICAgICAgICAgICAgICAgUmVz\ndWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZLCAKICAgICAgICAgICAgICAgIFJl\nc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZLCBmYWxzZSk7CiAgICAgICAgICAg\nIHJzID0gZXhlY3V0ZVF1ZXJ5KGNvbm4sIHN0bW50LCBzcWwsIGZhbHNlLCBz\ndG9yZSwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBnZXRDb3VudChycyk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgeyBycy5jbG9zZSgpOyB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAo\nY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9z\nZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3RvcmUgc3Rv\ncmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIAogICAgICAgIExp\nc3QgcGFybXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0\nb3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICBm\nZXRjaC5nZXRSZWFkTG9ja0xldmVsKCksIHBhcm1zKTsKICAgIH0KCiAgICBw\ndWJsaWMgUmVzdWx0IGV4ZWN1dGUoSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSAKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZSwgZmV0Y2gs\nIG51bGwpOwogICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0IGV4ZWN1dGUoSkRC\nQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAog\nICAgICAgIGludCBsb2NrTGV2ZWwsIExpc3QgcGFybXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChmZXRjaCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgZmV0Y2ggPSBzdG9yZS5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGUoc3Rv\ncmUuZ2V0Q29udGV4dCgpLCBzdG9yZSwgZmV0Y2gsIGxvY2tMZXZlbCwgcGFy\nbXMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAg\nICAgaW50IGxvY2tMZXZlbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZSwgZmV0Y2gsIGxvY2tM\nZXZlbCwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIHRo\naXMgc2VsZWN0IGluIHRoZSBjb250ZXh0IG9mIHRoZSBnaXZlbiBzdG9yZSBt\nYW5hZ2VyLiBUaGUKICAgICAqIGNvbnRleHQgaXMgcGFzc2VkIGluIHNlcGFy\nYXRlbHkgZm9yIHByb2ZpbGluZyBwdXJwb3Nlcy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFJlc3VsdCBleGVjdXRlKFN0b3JlQ29udGV4dCBjdHgsIEpEQkNT\ndG9yZSBzdG9yZSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgaW50IGxvY2tMZXZlbCwgTGlzdCBwYXJhbXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUg\nPSBpc0ZvclVwZGF0ZShzdG9yZSwgbG9ja0xldmVsKTsKICAgICAgICAKICAg\nICAgICAvLyBBIG5vbi1udWxsIF9zcWwgaW5kaWNhdGVzIHRoYXQgdGhpcyBT\nZWxlY3RJbXBsIG9iamVjdAogICAgICAgIC8vIGlzIG9idGFpbmVkIGZyb20g\nY2FjaGUuIFRoZSBfc3FsIGlzIGNvbnN0cnVjdGVkCiAgICAgICAgLy8gdW5k\nZXIgdGhlIGFzc3VtcHRpb24gdGhhdCBpc0FnZ3JlZ2F0ZSgpIGlzIGZhbHNl\nCiAgICAgICAgLy8gYW5kIF9ncm91cGluZyBpcyBudWxsLiBJZiBuZWl0aGVy\nIG9mIHRoZXNlIGhvbGRzLAogICAgICAgIC8vIHdlIG5lZWQgdG8gcmUtY29u\nc3RydWN0IHRoZSBfc3FsCiAgICAgICAgaWYgKF9zcWwgIT0gbnVsbCAmJiAo\naXNBZ2dyZWdhdGUoKSB8fCBfZ3JvdXBpbmcgIT0gbnVsbCkpIAogICAgICAg\nICAgICBfc3FsID0gbnVsbDsKICAgICAgICAKICAgICAgICBpZiAoX3NxbCA9\nPSBudWxsKSAKICAgICAgICAJX3NxbCA9IHRvU2VsZWN0KGZvclVwZGF0ZSwg\nZmV0Y2gpOwogICAgICAgIAogICAgICAgIGJvb2xlYW4gaXNMUlMgPSBpc0xS\nUygpOwogICAgICAgIGludCByc1R5cGUgPSAoaXNMUlMgJiYgc3VwcG9ydHNS\nYW5kb21BY2Nlc3MoZm9yVXBkYXRlKSkKICAgICAgICAgICAgPyAtMSA6IFJl\nc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsKICAgICAgICBDb25uZWN0aW9u\nIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgIFJlc3VsdFNldCBy\ncyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzTFJT\nKSAKICAgICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChj\nb25uLCBfc3FsLCBmZXRjaCwgcnNUeXBlLCAtMSwgdHJ1ZSwgCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcmFtcyk7IAogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBzdG1udCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwg\nX3NxbCwgbnVsbCwgcnNUeXBlLCAtMSwgZmFsc2UsIAogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJhbXMpOwogICAgICAgICAgICAKICAgICAgICAgICAg\nc2V0VGltZW91dChzdG1udCwgZm9yVXBkYXRlLCBmZXRjaCk7CiAgICAgICAg\nICAgIAogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1u\ndCwgX3NxbCwgaXNMUlMsIHN0b3JlLCBwYXJhbXMpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAvLyBjbGVhbiB1\ncCBzdGF0ZW1lbnQKICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UyKSB7fQogICAgICAgICAgICB0cnkgeyBjb25uLmNs\nb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAg\nICAgIHRocm93IHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGdldEVh\nZ2VyUmVzdWx0KGNvbm4sIHN0bW50LCBycywgc3RvcmUsIGZldGNoLCBmb3JV\ncGRhdGUsIAogICAgICAgICAgICBfc3FsLmdldFNRTCgpLCBwYXJhbXMpOwog\nICAgfQogICAgCiAgICBwcml2YXRlIGJvb2xlYW4gaXNGb3JVcGRhdGUoSkRC\nQ1N0b3JlIHN0b3JlLCBpbnQgbG9ja0xldmVsKSB7CiAgICAJYm9vbGVhbiBm\nb3JVcGRhdGUgPSBmYWxzZTsKICAgICAgICBpZiAoIWlzQWdncmVnYXRlKCkg\nJiYgX2dyb3VwaW5nID09IG51bGwpIHsKICAgICAgICAgICAgSkRCQ0xvY2tN\nYW5hZ2VyIGxtID0gc3RvcmUuZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICAg\nICAgaWYgKGxtICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3JVcGRhdGUg\nPSBsbS5zZWxlY3RGb3JVcGRhdGUodGhpcywgbG9ja0xldmVsKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGZvclVwZGF0ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEV4ZWN1dGUgb3VyIGVhZ2VyIHNlbGVjdHMsIGFkZGluZyB0aGUg\ncmVzdWx0cyB1bmRlciB0aGUgc2FtZSBrZXlzCiAgICAgKiB0byB0aGUgZ2l2\nZW4gcmVzdWx0LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGFk\nZEVhZ2VyUmVzdWx0cyhTZWxlY3RSZXN1bHQgcmVzLCBTZWxlY3RJbXBsIHNl\nbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIExpc3QgcGFyYW1zKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChzZWwuX2VhZ2VyID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZXhlY3V0ZSBlYWdlciBz\nZWxlY3RzCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIFJlc3Vs\ndCBlcmVzOwogICAgICAgIE1hcCBlYWdlcjsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHNlbC5fZWFnZXIuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50\ncnkpIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAvLyBzaW11bGF0ZWQgYmF0\nY2hlZCBzZWxlY3RzIGZvciBpbm5lci9vdXRlciBqb2luczsgZm9yIHNlcGFy\nYXRlCiAgICAgICAgICAgIC8vIHNlbGVjdHMsIGRvbid0IHBhc3Mgb24gbG9j\nayBsZXZlbCwgYmVjYXVzZSB0aGV5J3JlIHByb2JhYmx5CiAgICAgICAgICAg\nIC8vIGZvciByZWxhdGlvbnMgYW5kIHRoZXJlZm9yZSBzaG91bGQgdXNlIGRl\nZmF1bHQgbGV2ZWwKICAgICAgICAgICAgaWYgKGVudHJ5LmdldFZhbHVlKCkg\nPT0gc2VsKQogICAgICAgICAgICAgICAgZXJlcyA9IHJlczsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgZXJlcyA9ICgoU2VsZWN0RXhlY3V0\nb3IpIGVudHJ5LmdldFZhbHVlKCkpLmV4ZWN1dGUoc3RvcmUsCiAgICAgICAg\nICAgICAgICAgICAgZmV0Y2gsIHBhcmFtcyk7CgogICAgICAgICAgICBlYWdl\nciA9IHJlcy5nZXRFYWdlck1hcChmYWxzZSk7CiAgICAgICAgICAgIGlmIChl\nYWdlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBlYWdlciA9IG5ldyBI\nYXNoTWFwKCk7CiAgICAgICAgICAgICAgICByZXMuc2V0RWFnZXJNYXAoZWFn\nZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVhZ2VyLnB1dChlbnRy\neS5nZXRLZXkoKSwgZXJlcyk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioK\nICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9y\nIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9u\nIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rp\nb24gY29ubiwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgCiAgICAgICAgaW50IHJz\nQ29uY3VyLCBib29sZWFuIGlzTFJTKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBhZGQgY29tbWVudHMgd2h5IHdlIHBhc3MgaW4gbnVsbCBh\ncyB0aGUgbGFzdCBwYXJhbWV0ZXIKICAgICAgICByZXR1cm4gcHJlcGFyZVN0\nYXRlbWVudChjb25uLCBzcWwsIGZldGNoLCByc1R5cGUsIHJzQ29uY3VyLCBp\nc0xSUywgCiAgICAgICAgICAgICAgICBudWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9y\nIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9u\nIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rp\nb24gY29ubiwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgCiAgICAgICAgaW50IHJz\nQ29uY3VyLCBib29sZWFuIGlzTFJTLCBMaXN0IHBhcmFtcykgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBzcWwucHJlcGFyZVN0YXRlbWVudChjb25uLCByc1R5\ncGUsIHJzQ29uY3VyLCBwYXJhbXMpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgcmV0dXJuIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIGZldGNoLCBy\nc1R5cGUsIC0xLCBwYXJhbXMpOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1K\nREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHNl\ndHRpbmcgcXVlcnkgdGltZW91dC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgc2V0VGltZW91dChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgYm9vbGVh\nbiBmb3JVcGRhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYgdGhp\ncyBpcyBhIGxvY2tpbmcgc2VsZWN0IGFuZCB0aGUgbG9jayB0aW1lb3V0IGlz\nIGdyZWF0ZXIgdGhhbgogICAgICAgIC8vIHRoZSBjb25maWd1cmVkIHF1ZXJ5\nIHRpbWVvdXQsIHVzZSB0aGUgbG9jayB0aW1lb3V0CiAgICAgICAgaWYgKGZv\nclVwZGF0ZSAmJiBfZGljdC5zdXBwb3J0c1F1ZXJ5VGltZW91dCAmJiBmZXRj\naCAhPSBudWxsIAogICAgICAgICAgICAmJiBmZXRjaC5nZXRMb2NrVGltZW91\ndCgpID4gc3RtbnQuZ2V0UXVlcnlUaW1lb3V0KCkgKiAxMDAwKSB7CiAgICAg\nICAgICAgIGludCB0aW1lb3V0ID0gZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKTsK\nICAgICAgICAgICAgTG9nIGxvZyA9IF9jb25mLmdldExvZyhKREJDQ29uZmln\ndXJhdGlvbi5MT0dfSkRCQyk7CiAgICAgICAgICAgIGlmICh0aW1lb3V0IDwg\nMTAwMCkgewogICAgICAgICAgICAgICAgdGltZW91dCA9IDEwMDA7IAogICAg\nICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoIm1pbGxpcy1xdWVyeS10\naW1lb3V0IikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7IAog\nICAgICAgICAgICAgICAgc3RtbnQuc2V0UXVlcnlUaW1lb3V0KGZldGNoLmdl\ndExvY2tUaW1lb3V0KCkgLyAxMDAwKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjYXRjaChTUUxFeGNlcHRpb24gZSkgeyAKICAgICAgICAgICAgICAg\nIGlmKF9kaWN0Lmlnbm9yZVNRTEV4Y2VwdGlvbk9uU2V0UXVlcnlUaW1lb3V0\nKSB7IAogICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xv\nYy5nZXQoImVycm9yLXNldHRpbmctcXVlcnktdGltZW91dCIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBuZXcgSW50ZWdlcih0aW1lb3V0KSwgZS5n\nZXRNZXNzYWdlKCkpLCBlKTsKICAgICAgICAgICAgICAgICAgICB9ICAgCiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsgCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRo\naXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJD\nIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1\ndGluZyBxdWVyeS4KICAgICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdFNldCBl\neGVjdXRlUXVlcnkoQ29ubmVjdGlvbiBjb25uLCBQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBpc0xS\nUywgSkRCQ1N0b3JlIHN0b3JlLCBMaXN0IHBhcmFtcykgCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHN0bW50LmV4ZWN1\ndGVRdWVyeSgpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpE\nQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRpbmcgY291\nbnQgZnJvbSB0aGUgcmVzdWx0IHNldC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGludCBnZXRDb3VudChSZXN1bHRTZXQgcnMpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJzLm5leHQoKTsKICAgICAgICByZXR1cm4gcnMuZ2V0\nSW50KDEpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMt\nbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyBlYWdl\nciBzZWxlY3RzLgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVzdWx0IGdldEVh\nZ2VyUmVzdWx0KENvbm5lY3Rpb24gY29ubiwgCiAgICAgICAgUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQsIFJlc3VsdFNldCBycywgSkRCQ1N0b3JlIHN0b3Jl\nLCAKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29s\nZWFuIGZvclVwZGF0ZSwgU3RyaW5nIHNxbFN0ciwKICAgICAgICBMaXN0IHBh\ncmFtcykgCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nU2VsZWN0UmVzdWx0IHJlcyA9IG5ldyBTZWxlY3RSZXN1bHQoY29ubiwgc3Rt\nbnQsIHJzLCBfZGljdCk7CiAgICAgICAgcmVzLnNldFNlbGVjdCh0aGlzKTsK\nICAgICAgICByZXMuc2V0U3RvcmUoc3RvcmUpOwogICAgICAgIHJlcy5zZXRM\nb2NraW5nKGZvclVwZGF0ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYWRkRWFnZXJSZXN1bHRzKHJlcywgdGhpcywgc3RvcmUsIGZldGNoLCBwYXJh\nbXMpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAg\nICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICAgICAgdGhyb3cgc2U7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0IGltcGxlbWVudGF0\naW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIGludCBpbmRleE9mKCkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAg\nIHB1YmxpYyBMaXN0IGdldFN1YnNlbGVjdHMoKSB7CiAgICAgICAgcmV0dXJu\nIChfc3Vic2VscyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1Qg\nOiBfc3Vic2VsczsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0IGdldFBhcmVu\ndCgpIHsKICAgICAgICByZXR1cm4gX3BhcmVudDsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIGdldFN1YnNlbGVjdFBhdGgoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdWJQYXRoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFBhcmVudChT\nZWxlY3QgcGFyZW50LCBTdHJpbmcgcGF0aCkgewogICAgICAgIGlmIChwYXRo\nICE9IG51bGwpCiAgICAgICAgICAgIF9zdWJQYXRoID0gcGF0aCArICc6JzsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zdWJQYXRoID0gbnVsbDsKCiAg\nICAgICAgaWYgKHBhcmVudCA9PSBfcGFyZW50KQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCkKICAgICAgICAgICAg\nX3BhcmVudC5fc3Vic2Vscy5yZW1vdmUodGhpcyk7CgogICAgICAgIC8vIyMj\nIHJpZ2h0IG5vdyB3ZSBjYW4ndCB1c2Ugc3FsOTIgam9pbnMgd2l0aCBzdWJz\nZWxlY3RzLCBjYXVzZQogICAgICAgIC8vIyMjIEkgY2FuJ3QgZmlndXJlIG91\ndCB3aGF0IHRvIGRvIHdoZW4gdGhlIHN1YnNlbGVjdCBoYXMgYSBqb2luCiAg\nICAgICAgLy8jIyMgd2l0aCBhbiBhbGlhcyBhbHNvIHByZXNlbnQgaW4gdGhl\nIG91dGVyIHNlbGVjdC4uLiB5b3UgZG9uJ3Qgd2FudAogICAgICAgIC8vIyMj\nIHRoZSBqb2luIHRvIGFwcGVhciBpbiB0aGUgRlJPTSBjbGF1c2Ugb2YgdGhl\nIHN1YnNlbGVjdCBjYXVzZQogICAgICAgIC8vIyMjIHRoZW4gaXQgcmUtYWxp\nYXNlcyBib3RoIHRhYmxlcyBpbiB0aGUgc2NvcGUgb2YgdGhlIHN1YnNlbGVj\ndAogICAgICAgIC8vIyMjIGFuZCB0aGUgY29ycmVsYXRpb24gd2l0aCB0aGUg\nb3V0ZXIgc2VsZWN0IGlzIGxvc3QKICAgICAgICBfcGFyZW50ID0gKFNlbGVj\ndEltcGwpIHBhcmVudDsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGlmIChfcGFyZW50Ll9zdWJzZWxzID09IG51bGwpCiAg\nICAgICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzID0gbmV3IEFycmF5TGlz\ndCgyKTsKICAgICAgICAgICAgX3BhcmVudC5fc3Vic2Vscy5hZGQodGhpcyk7\nCiAgICAgICAgICAgIGlmIChfcGFyZW50Ll9qb2luU3ludGF4ID09IEpvaW5T\neW50YXhlcy5TWU5UQVhfU1FMOTIpCiAgICAgICAgICAgICAgICBfam9pblN5\nbnRheCA9IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUw7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9qb2luU3ludGF4ID0gX3Bh\ncmVudC5fam9pblN5bnRheDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\naWYgKF9wYXJlbnQuZ2V0QWxpYXNlcygpID09IG51bGwgfHwgX3N1YlBhdGgg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3Bh\ncmVudC5fYWxpYXNlcy5zaXplKCkgPD0gMSkKICAgICAgICAgICAgcmV0dXJu\nOwogCiAgICAgICAgLy8gRG8gbm90IHJlbW92ZSBhbGlhc2VzIGZvciBkYXRh\nYmFzZXMgdGhhdCB1c2UgU1lOVEFYX0RBVEFCQVNFIChvcmFjbGUpCiAgICAg\nICAgaWYoX3BhcmVudC5fam9pblN5bnRheCAhPSBKb2luU3ludGF4ZXMuU1lO\nVEFYX0RBVEFCQVNFKSB7CiAgICAgICAgICAgIC8vIHJlc29sdmUgYWxpYXNl\ncyBmb3Igc3Vic2VsZWN0IGZyb20gcGFyZW50CiAgICAgICAgICAgIFNldDxN\nYXAuRW50cnk+IGVudHJpZXMgPSBfcGFyZW50LmdldEFsaWFzZXMoKS5lbnRy\neVNldCgpOwogICAgICAgICAgICBmb3IgKE1hcC5FbnRyeSBlbnRyeSA6IGVu\ndHJpZXMpIHsKICAgICAgICAgICAgICAgIE9iamVjdCBrZXkgPSBlbnRyeS5n\nZXRLZXkoKTsKICAgICAgICAgICAgICAgIEludGVnZXIgYWxpYXMgPSAoSW50\nZWdlcikgZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChr\nZXkudG9TdHJpbmcoKS5pbmRleE9mKF9zdWJQYXRoKSAhPSAtMSB8fAogICAg\nICAgICAgICAgICAgICAgICAgICBfcGFyZW50LmZpbmRUYWJsZUFsaWFzKGFs\naWFzKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfYWxp\nYXNlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfYWxpYXNl\ncyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgX2FsaWFz\nZXMucHV0KGtleSwgYWxpYXMpOwoKICAgICAgICAgICAgICAgICAgICBPYmpl\nY3QgdGFibGVTdHJpbmcgPSBfcGFyZW50LmdldFRhYmxlcygpLmdldChhbGlh\ncyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF90YWJsZXMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgX3RhYmxlcyA9IG5ldyBUcmVlTWFw\nKCk7CiAgICAgICAgICAgICAgICAgICAgX3RhYmxlcy5wdXQoYWxpYXMsIHRh\nYmxlU3RyaW5nKTsKCiAgICAgICAgICAgICAgICAgICAgX3JlbW92ZWRBbGlh\nc0Zyb21QYXJlbnQuc2V0KGFsaWFzLmludFZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX2FsaWFz\nZXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gYWxpYXNlcyBtb3Zl\nZCBpbnRvIHN1YnNlbGVjdCBzaG91bGQgYmUgcmVtb3ZlZCBmcm9tIHBhcmVu\ndAogICAgICAgICAgICAgICAgZW50cmllcyA9IF9hbGlhc2VzLmVudHJ5U2V0\nKCk7CiAgICAgICAgICAgICAgICBmb3IgKE1hcC5FbnRyeSBlbnRyeSA6IGVu\ndHJpZXMpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Qga2V5ID0gZW50\ncnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICAgICAgSW50ZWdlciBhbGlh\ncyA9IChJbnRlZ2VyKSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChrZXkudG9TdHJpbmcoKS5pbmRleE9mKF9zdWJQYXRoKSAh\nPSAtMSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3BhcmVudC5m\naW5kVGFibGVBbGlhcyhhbGlhcykgPT0gZmFsc2UpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgX3BhcmVudC5yZW1vdmVBbGlhcyhrZXkpOwoKICAgICAg\nICAgICAgICAgICAgICAgICAgT2JqZWN0IHRhYmxlU3RyaW5nID0gX3BhcmVu\ndC5nZXRUYWJsZXMoKS5nZXQoYWxpYXMpOwogICAgICAgICAgICAgICAgICAg\nICAgICBfcGFyZW50LnJlbW92ZVRhYmxlKGFsaWFzKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgYm9vbGVhbiBmaW5kVGFi\nbGVBbGlhcyhJbnRlZ2VyIGFsaWFzKSB7CiAgICAgICAgLy8gaWYgYWxpYXMg\naXMgZGVmaW5lZCBhbmQgcmVmZXJlbmNlZCwgcmV0dXJuIHRydWUuCiAgICAg\nICAgU3RyaW5nIHZhbHVlID0gInQiICsgYWxpYXMudG9TdHJpbmcoKSArICIu\nIjsKICAgICAgICBpZiAoX3RhYmxlQWxpYXNlcyAhPSBudWxsKQogICAgICAg\nICAgICBpZiAoX3RhYmxlQWxpYXNlcy5jb250YWluc1ZhbHVlKHZhbHVlKSkK\nICAgICAgICAgICAgICAgcmV0dXJuIF90YWJsZXMuY29udGFpbnNLZXkoYWxp\nYXMpOwogICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgcmV0dXJuIF9q\nb2lucyAhPSBudWxsOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICB9CiAgICAKICAgIHB1YmxpYyBNYXAgZ2V0QWxpYXNlcygp\nIHsKICAgICAgICByZXR1cm4gX2FsaWFzZXM7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIHJlbW92ZUFsaWFzKE9iamVjdCBrZXkpIHsKICAgICAgICBf\nYWxpYXNlcy5yZW1vdmUoa2V5KTsKICAgIH0KICAgIAogICAgcHVibGljIE1h\ncCBnZXRUYWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIF90YWJsZXM7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyB2b2lkIHJlbW92ZVRhYmxlKE9iamVjdCBrZXkp\nIHsKICAgICAgICBfdGFibGVzLnJlbW92ZShrZXkpOwogICAgfQoKICAgIHB1\nYmxpYyBTZWxlY3QgZ2V0RnJvbVNlbGVjdCgpIHsKICAgICAgICByZXR1cm4g\nX2Zyb207CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RnJvbVNlbGVjdChT\nZWxlY3Qgc2VsKSB7CiAgICAgICAgX2Zyb20gPSAoU2VsZWN0SW1wbCkgc2Vs\nOwogICAgICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAgICAgICBfZnJv\nbS5fb3V0ZXIgPSB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhh\nc0VhZ2VySm9pbihib29sZWFuIHRvTWFueSkgewogICAgICAgIGlmICh0b01h\nbnkpCiAgICAgICAgICAgIHJldHVybiAoX2ZsYWdzICYgRUFHRVJfVE9fTUFO\nWSkgIT0gMDsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEVBR0VSX1RPX09O\nRSkgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNKb2luKGJv\nb2xlYW4gdG9NYW55KSB7CiAgICAgICAgaWYgKHRvTWFueSkKICAgICAgICAg\nICAgcmV0dXJuIChfZmxhZ3MgJiBUT19NQU5ZKSAhPSAwOwogICAgICAgIHJl\ndHVybiBfdGFibGVzICE9IG51bGwgJiYgX3RhYmxlcy5zaXplKCkgPiAxOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU2VsZWN0ZWQoVGFibGUgdGFi\nbGUpIHsKICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhudWxsLCBm\nYWxzZSk7CiAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBfZnJvbS5nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgZmFsc2Up\nICE9IC0xOwogICAgICAgIHJldHVybiBnZXRUYWJsZUluZGV4KHRhYmxlLCBw\naiwgZmFsc2UpICE9IC0xOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9u\nIGdldFRhYmxlQWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gKF90YWJsZXMg\nPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgOiBfdGFibGVzLnZh\nbHVlcygpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFNlbGVjdHMoKSB7\nCiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3Qo\nX3NlbGVjdHMpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFNlbGVjdEFs\naWFzZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zZWxlY3RzLmdldEFsaWFzZXMo\nZmFsc2UsIF9vdXRlciAhPSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgTGlz\ndCBnZXRJZGVudGlmaWVyQWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gX3Nl\nbGVjdHMuZ2V0QWxpYXNlcyh0cnVlLCBfb3V0ZXIgIT0gbnVsbCk7CiAgICB9\nCgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRPcmRlcmluZygpIHsKICAgICAg\nICByZXR1cm4gX29yZGVyaW5nOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZm\nZXIgZ2V0R3JvdXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9ncm91cGluZzsK\nICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldFdoZXJlKCkgewogICAg\nICAgIHJldHVybiBfd2hlcmU7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciBnZXRIYXZpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9oYXZpbmc7CiAgICB9\nCgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRTUUwoKSB7CiAgICAgICAgcmV0\ndXJuIF9zcWw7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U1FMKFNRTEJ1\nZmZlciBzcWwpIHsKICAgICAgICBfc3FsID0gc3FsOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldFNRTChKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBib29sZWFuIGZvclVwZGF0\nZSA9IGlzRm9yVXBkYXRlKHN0b3JlLCBmZXRjaC5nZXRSZWFkTG9ja0xldmVs\nKCkpOwogICAgICAgIF9zcWwgPSB0b1NlbGVjdChmb3JVcGRhdGUsIGZldGNo\nKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgYWRkSm9pbkNsYXNzQ29u\nZGl0aW9ucygpIHsKICAgICAgICBpZiAoX2pvaW5zID09IG51bGwgfHwgX2pv\naW5zLmpvaW5zKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBqb2luIHNldCBpdGVyYXRvciBhbGxvd3MgY29uY3VycmVudCBt\nb2RpZmljYXRpb24KICAgICAgICBKb2luIGo7CiAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBfam9pbnMuam9pbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICBqID0gKEpvaW4pIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIGlmIChqLmdldFJlbGF0aW9uVGFyZ2V0KCkgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgai5nZXRSZWxhdGlvblRhcmdldCgpLmdl\ndERpc2NyaW1pbmF0b3IoKS5hZGRDbGFzc0NvbmRpdGlvbnMKICAgICAgICAg\nICAgICAgICAgICAodGhpcywgai5nZXRTdWJjbGFzc2VzKCkgPT0gU1VCU19K\nT0lOQUJMRSwgCiAgICAgICAgICAgICAgICAgICAgai5nZXRSZWxhdGlvbkpv\naW5zKCkpOwogICAgICAgICAgICAgICAgai5zZXRSZWxhdGlvbihudWxsLCAw\nLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgSm9pbnMgZ2V0Sm9pbnMoKSB7CiAgICAgICAgcmV0dXJuIF9qb2lu\nczsKICAgIH0KCiAgICBwdWJsaWMgSXRlcmF0b3IgZ2V0Sm9pbkl0ZXJhdG9y\nKCkgewogICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gRW1wdHlJdGVyYXRvci5JTlNU\nQU5DRTsKICAgICAgICByZXR1cm4gX2pvaW5zLmpvaW5zKCkuam9pbkl0ZXJh\ndG9yKCk7CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0U3RhcnRJbmRleCgp\nIHsKICAgICAgICByZXR1cm4gX3N0YXJ0SWR4OwogICAgfQoKICAgIHB1Ymxp\nYyBsb25nIGdldEVuZEluZGV4KCkgewogICAgICAgIHJldHVybiBfZW5kSWR4\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJhbmdlKGxvbmcgc3RhcnQs\nIGxvbmcgZW5kKSB7CiAgICAgICAgX3N0YXJ0SWR4ID0gc3RhcnQ7CiAgICAg\nICAgX2VuZElkeCA9IGVuZDsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndENvbHVtbkFsaWFzKENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gZ2V0\nQ29sdW1uQWxpYXMoY29sLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCwgSm9pbnMg\nam9pbnMpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCBn\nZXRKb2lucyhqb2lucywgZmFsc2UpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAg\nKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBj\nb2wsIFBhdGhKb2lucyBwaikgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5B\nbGlhcyhjb2wuZ2V0TmFtZSgpLCBjb2wuZ2V0VGFibGUoKSwgcGopOwogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNv\nbCwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxp\nYXMoY29sLCB0YWJsZSwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRh\nYmxlLCBKb2lucyBqb2lucykgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5B\nbGlhcyhjb2wsIHRhYmxlLCBnZXRKb2lucyhqb2lucywgZmFsc2UpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBn\naXZlbiBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENv\nbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMg\ncGopIHsKICAgICAgICBTdHJpbmcgdGFibGVBbGlhcyA9IG51bGw7CiAgICAg\nICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgpID09IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKF90YWJsZUFsaWFzZXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF90YWJsZUFsaWFzZXMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAg\nICAgICB0YWJsZUFsaWFzID0gKFN0cmluZykgX3RhYmxlQWxpYXNlcy5nZXQo\ndGFibGUpOwogICAgICAgICAgICBpZiAodGFibGVBbGlhcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICB0YWJsZUFsaWFzID0gZ2V0VGFibGVBbGlhcyh0\nYWJsZSwgcGopLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBfdGFibGVB\nbGlhc2VzLnB1dCh0YWJsZSwgdGFibGVBbGlhcyk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdCdWlsZGVyKHRhYmxlQWxp\nYXMpLmFwcGVuZChjb2wpLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBnZXRUYWJsZUFsaWFzKHRhYmxlLCBwaikuYXBwZW5kKGNvbCku\ndG9TdHJpbmcoKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBTdHJpbmdCdWls\nZGVyIGdldFRhYmxlQWxpYXMoVGFibGUgdGFibGUsIFBhdGhKb2lucyBwaikg\newogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKTsKICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAg\nICBTdHJpbmcgYWxpYXMgPSB0b0FsaWFzKF9mcm9tLmdldFRhYmxlSW5kZXgo\ndGFibGUsIHBqLCB0cnVlKSk7CiAgICAgICAgICAgIGlmIChfZGljdC5yZXF1\naXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAgICAgICAgICAgICAgcmV0dXJu\nIGJ1Zi5hcHBlbmQoRlJPTV9TRUxFQ1RfQUxJQVMpLmFwcGVuZCgiLiIpLmFw\ncGVuZChhbGlhcykuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCJfIik7\nCiAgICAgICAgICAgIHJldHVybiBidWYuYXBwZW5kKGFsaWFzKS5hcHBlbmQo\nIl8iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi5hcHBlbmQodG9B\nbGlhcyhnZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpKS5hcHBlbmQo\nIi4iKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZSgp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEFHR1JFR0FURSkgIT0gMDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBZ2dyZWdhdGUoYm9vbGVhbiBh\nZ2cpIHsKICAgICAgICBpZiAoYWdnKQogICAgICAgICAgICBfZmxhZ3MgfD0g\nQUdHUkVHQVRFOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5BR0dSRUdBVEU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNMb2Io\nKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBMT0IpICE9IDA7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0TG9iKGJvb2xlYW4gbG9iKSB7CiAgICAg\nICAgaWYgKGxvYikKICAgICAgICAgICAgX2ZsYWdzIHw9IExPQjsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+TE9COwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNsZWFyU2VsZWN0cygpIHsKICAgICAgICBfc2VsZWN0\ncy5jbGVhcigpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChT\nUUxCdWZmZXIgc3FsLCBPYmplY3QgaWQpIHsKICAgICAgICByZXR1cm4gc2Vs\nZWN0KHNxbCwgaWQsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHNlbGVjdChTUUxCdWZmZXIgc3FsLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgaWYgKCFpc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJl\ndHVybiBzZWxlY3QoKE9iamVjdCkgc3FsLCBpZCwgam9pbnMpOwogICAgICAg\nIGdyb3VwQnkoc3FsLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkIHRoZSBzZWxlY3Qgb2YgdGhl\nIGdpdmVuIFNRTCBidWZmZXIgb3Igc3RyaW5nLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gc2VsZWN0KE9iamVjdCBzcWwsIE9iamVjdCBpZCwgSm9p\nbnMgam9pbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAg\nICAgICAgYm9vbGVhbiBjb250YWluczsKICAgICAgICBpZiAoaWQgPT0gbnVs\nbCkgewogICAgICAgICAgICBpbnQgaWR4ID0gX3NlbGVjdHMuaW5kZXhPZkFs\naWFzKHNxbCk7CiAgICAgICAgICAgIGNvbnRhaW5zID0gaWR4ICE9IC0xOwog\nICAgICAgICAgICBpZiAoY29udGFpbnMpCiAgICAgICAgICAgICAgICBpZCA9\nIF9zZWxlY3RzLmdldChpZHgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBpZCA9IG51bGxJZCgpOwogICAgICAgIH0gZWxzZQogICAgICAg\nICAgICBjb250YWlucyA9IF9zZWxlY3RzLmNvbnRhaW5zKGlkKTsKCiAgICAg\nICAgaWYgKGNvbnRhaW5zKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgX3NlbGVjdHMuc2V0QWxpYXMoaWQsIHNxbCwgZmFsc2UpOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\ncyBhIHVuaXF1ZSBpZCBmb3IgYSBTUUwgc3RyaW5nIHdob3NlIGdpdmVuIGlk\nIGlzIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IG51bGxJZCgp\nIHsKICAgICAgICBpZiAoX251bGxJZHMgPj0gTlVMTF9JRFMubGVuZ3RoKQog\nICAgICAgICAgICByZXR1cm4gbmV3IE51bGxJZCgpOwogICAgICAgIHJldHVy\nbiBOVUxMX0lEU1tfbnVsbElkcysrXTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBzZWxlY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkKSB7CiAgICAgICAg\ncmV0dXJuIHNlbGVjdChzcWwsIGlkLCBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBzZWxlY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkLCBKb2lu\ncyBqb2lucykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAg\nICAgICByZXR1cm4gc2VsZWN0KChPYmplY3QpIHNxbCwgaWQsIGpvaW5zKTsK\nICAgICAgICBncm91cEJ5KHNxbCwgam9pbnMpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdFBsYWNlaG9sZGVy\nKFN0cmluZyBzcWwpIHsKICAgICAgICBPYmplY3QgaG9sZGVyID0gKF9wbGFj\nZWhvbGRlcnMgPj0gUExBQ0VIT0xERVJTLmxlbmd0aCkKICAgICAgICAgICAg\nPyBuZXcgUGxhY2Vob2xkZXIoKSA6IFBMQUNFSE9MREVSU1tfcGxhY2Vob2xk\nZXJzKytdOwogICAgICAgIHNlbGVjdChzcWwsIGhvbGRlcik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbnNlcnQgYSBwbGFjZWhvbGRlciBhdCB0aGUgZ2l2\nZW4gaW5kZXg7IHVzZSBhIG5lZ2F0aXZlIGluZGV4CiAgICAgKiB0byBjb3Vu\ndCBmcm9tIHRoZSBiYWNrIG9mIHRoZSBzZWxlY3QgbGlzdC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgaW5zZXJ0UGxhY2Vob2xkZXIoU3RyaW5nIHNxbCwg\naW50IHBvcykgewogICAgICAgIE9iamVjdCBob2xkZXIgPSAoX3BsYWNlaG9s\nZGVycyA+PSBQTEFDRUhPTERFUlMubGVuZ3RoKQogICAgICAgICAgICA/IG5l\ndyBQbGFjZWhvbGRlcigpIDogUExBQ0VIT0xERVJTW19wbGFjZWhvbGRlcnMr\nK107CiAgICAgICAgX3NlbGVjdHMuaW5zZXJ0QWxpYXMocG9zLCBob2xkZXIs\nIHNxbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBzZWxlY3RlZCBw\nbGFjZWhvbGRlcnMsIGFuZCByZXR1cm4gcmVtb3ZlZCBzZWxlY3QgaW5kZXhl\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xlYXJQbGFjZWhvbGRlclNl\nbGVjdHMoKSB7CiAgICAgICAgX3NlbGVjdHMuY2xlYXJQbGFjZWhvbGRlcnMo\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNv\nbCkgewogICAgICAgIHJldHVybiBzZWxlY3QoY29sLCAoSm9pbnMpIG51bGwp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChDb2x1bW4gY29s\nLCBKb2lucyBqb2lucykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQog\nICAgICAgICAgICByZXR1cm4gc2VsZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMs\nIHRydWUpLCBmYWxzZSk7CiAgICAgICAgZ3JvdXBCeShjb2wsIGpvaW5zKTsK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGludCBz\nZWxlY3QoQ29sdW1uW10gY29scykgewogICAgICAgIHJldHVybiBzZWxlY3Qo\nY29scywgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3QoQ29s\ndW1uW10gY29scywgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoY29scyA9\nPSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVy\nbiAwOwogICAgICAgIGlmIChpc0dyb3VwaW5nKCkpIHsKICAgICAgICAgICAg\nZ3JvdXBCeShjb2xzLCBqb2lucyk7CiAgICAgICAgICAgIHJldHVybiAwOwog\nICAgICAgIH0KICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\naWYgKHNlbGVjdChjb2xzW2ldLCBwaiwgZmFsc2UpKQogICAgICAgICAgICAg\nICAgc2VsZCB8PSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdpdmVuIGNvbHVtbiBhZnRl\nciBtYWtpbmcgdGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gc2VsZWN0KENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaiwgYm9v\nbGVhbiBpZGVudCkgewogICAgICAgIC8vIHdlIGNhY2hlIG9uIGNvbHVtbiBv\nYmplY3QgaWYgdGhlcmUgYXJlIG5vIGpvaW5zIHNvIHRoYXQgd2hlbgogICAg\nICAgIC8vIGxvb2tpbmcgdXAgY29sdW1ucyBpbiB0aGUgcmVzdWx0IHdlIGRv\nbid0IGhhdmUgdG8gY3JlYXRlIGEgc3RyaW5nCiAgICAgICAgLy8gYnVmZmVy\nIGZvciB0aGUgdGFibGUgKyBjb2x1bW4gYWxpYXM7IGlmIHRoZXJlIGFyZSBq\nb2lucywgdGhlbgogICAgICAgIC8vIHdlIGtleSBvbiB0aGUgYWxpYXMKICAg\nICAgICBTdHJpbmcgYWxpYXMgPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsK\nICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgaWYgKHBqID09IG51bGwgfHwg\ncGoucGF0aCgpID09IG51bGwpCiAgICAgICAgICAgIGlkID0gY29sOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgaWQgPSBhbGlhczsKICAgICAgICBpZiAo\nX3NlbGVjdHMuY29udGFpbnMoaWQpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIGlmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0Ig\nfHwgY29sLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9CKQogICAgICAgICAgICBz\nZXRMb2IodHJ1ZSk7CiAgICAgICAgX3NlbGVjdHMuc2V0QWxpYXMoaWQsIGFs\naWFzLCBpZGVudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2VsZWN0KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQg\nc3ViY2xhc3NlcywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlcikgewogICAgICAgIHNl\nbGVjdChtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2Vy\nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNT\ndG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50\nIGVhZ2VyLAogICAgICAgIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsZWN0\nKHRoaXMsIG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgZWFn\nZXIsIGpvaW5zLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxl\nY3QgdGhlIGdpdmVuIG1hcHBpbmcuCiAgICAgKi8KICAgIHZvaWQgc2VsZWN0\nKFNlbGVjdCB3cmFwcGVyLCBDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1\nYmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gaWRlbnQpIHsKICAgICAgICAvLyBub3RlIHRoYXQg\ndGhpcyBpcyBvbmUgY2FzZSB3aGVyZSB3ZSBkb24ndCB3YW50IHRvIHVzZSB0\naGUgcmVzdWx0CiAgICAgICAgLy8gb2YgZ2V0Sm9pbnMoKTsganVzdCB1c2Ug\ndGhlIGdpdmVuIGpvaW5zLCB3aGljaCB3aWxsIGVpdGhlciBiZSBjbGVhbgog\nICAgICAgIC8vIG9yIHRoZSByZXN1bHQgb2YgcHJldmlvdXMgcHJlLWpvaW5z\nLiB0aGlzIHdheSB3ZSBkb24ndCBwdXNoIGV4dHJhCiAgICAgICAgLy8gc3Rh\nY2sgc3R1ZmYgd2hlbiBubyBhY3R1YWwgbmV3IGpvaW5zIGhhdmUgYmVlbiBt\nYWRlLCBhbmQgd2UgZG9uJ3QKICAgICAgICAvLyB0aGluayB0aGUgdXNlciB3\nYW50cyBvdXRlciBqb2lucyB3aGVuIGFjdHVhbGx5IG9ubHkgdGhlIHByZXZp\nb3VzCiAgICAgICAgLy8gam9pbnMgd2VyZSBvdXRlci4gIHdlIGRvIGludm9r\nZSBnZXRKb2lucygpLCB0aG91Z2gsIHRvIGFkZCB0aGVzZQogICAgICAgIC8v\nIGpvaW5zIChpZiBhbnkpIHRvIG91ciB0b3AtbGV2ZWwgam9pbnM7IG90aGVy\nd2lzZSBpdCdkIGJlIHBvc3NpYmxlCiAgICAgICAgLy8gZm9yIHRoZSB1c2Vy\nIHRvIGltbWVkaWF0ZWx5IGRvIGFub3RoZXIgam9pbiBhbmQgc2VsZWN0IHNv\nbWV0aGluZywKICAgICAgICAvLyBhbmQgaWYgd2UncmUgaW4gb3V0ZXIgbW9k\nZSBhbGwgdGhlc2Ugam9pbnMgd2lsbCBnZXQgc3dpdGNoZWQgdG8gb3V0ZXIK\nICAgICAgICAvLyBqb2lucy4gIGNhY2hpbmcgdGhlbSBhcyB0aGVpciBvcmln\naW5hbCBqb2luIHR5cGUgcHJldmVudHMgdGhhdAogICAgICAgIGdldEpvaW5z\nKGpvaW5zLCB0cnVlKTsKCiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhK\nb2lucykgam9pbnM7CiAgICAgICAgYm9vbGVhbiBoYXNKb2lucyA9IHBqICE9\nIG51bGwgJiYgcGouaXNEaXJ0eSgpOwogICAgICAgIGlmIChoYXNKb2lucykg\newogICAgICAgICAgICBpZiAoX3ByZUpvaW5zID09IG51bGwpCiAgICAgICAg\nICAgICAgICBfcHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAg\nX3ByZUpvaW5zLnB1c2gocGopOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYg\ndGhleSBhcmUgc2VsZWN0aW5nIHRoaXMgbWFwcGluZyB3aXRoIG91dGVyIGpv\naW5zLCB0aGVuIGFsbCBqb2lucwogICAgICAgIC8vIGZyb20gdGhpcyBtYXBw\naW5nIHNob3VsZCBhbHNvIGJlIG91dGVyCiAgICAgICAgYm9vbGVhbiB3YXNP\ndXRlciA9IChfZmxhZ3MgJiBPVVRFUikgIT0gMDsKICAgICAgICBpZiAoaGFz\nSm9pbnMgJiYgIXdhc091dGVyICYmIHBqLmlzT3V0ZXIoKSkKICAgICAgICAg\nICAgX2ZsYWdzIHw9IE9VVEVSOwoKICAgICAgICAvLyBkZWxlZ2F0ZSB0byBz\ndG9yZSBtYW5hZ2VyIHRvIHNlbGVjdCBpbiBzYW1lIG9yZGVyIGl0IGxvYWRz\nIHJlc3VsdAogICAgICAgICgoSkRCQ1N0b3JlTWFuYWdlcikgc3RvcmUpLnNl\nbGVjdCh3cmFwcGVyLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBudWxsLAogICAg\nICAgICAgICBudWxsLCBmZXRjaCwgZWFnZXIsIGlkZW50LCAoX2ZsYWdzICYg\nT1VURVIpICE9IDApOwoKICAgICAgICAvLyByZXNldAogICAgICAgIGlmICho\nYXNKb2lucykKICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAg\nIGlmICghd2FzT3V0ZXIgJiYgKF9mbGFncyAmIE9VVEVSKSAhPSAwKQogICAg\nICAgICAgICBfZmxhZ3MgJj0gfk9VVEVSOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIHNlbGVjdElkZW50aWZpZXIoQ29sdW1uIGNvbCkgewogICAgICAg\nIHJldHVybiBzZWxlY3RJZGVudGlmaWVyKGNvbCwgKEpvaW5zKSBudWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RJZGVudGlmaWVyKENv\nbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dyb3Vw\naW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoY29sLCBnZXRKb2lu\ncyhqb2lucywgdHJ1ZSksIHRydWUpOwogICAgICAgIGdyb3VwQnkoY29sLCBq\nb2lucyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgc2VsZWN0SWRlbnRpZmllcihDb2x1bW5bXSBjb2xzKSB7CiAgICAg\nICAgcmV0dXJuIHNlbGVjdElkZW50aWZpZXIoY29scywgbnVsbCk7CiAgICB9\nCgogICAgcHVibGljIGludCBzZWxlY3RJZGVudGlmaWVyKENvbHVtbltdIGNv\nbHMsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8\nfCBjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAg\nICAgICBpZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdyb3VwQnko\nY29scywgam9pbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9\nCiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nOwogICAgICAgIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChzZWxl\nY3QoY29sc1tpXSwgcGosIHRydWUpKQogICAgICAgICAgICAgICAgc2VsZCB8\nPSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2VsZWN0SWRlbnRpZmllcihDbGFzc01hcHBpbmcgbWFwcGlu\nZywgaW50IHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIpIHsKICAg\nICAgICBzZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0\nb3JlLCBmZXRjaCwgZWFnZXIsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNlbGVjdElkZW50aWZpZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGlu\ndCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLAogICAgICAgIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgc2VsZWN0KHRoaXMsIG1hcHBpbmcsIHN1\nYmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpvaW5zLCB0cnVlKTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdFByaW1hcnlLZXkoQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcpIHsKICAgICAgICByZXR1cm4gc2VsZWN0UHJpbWFy\neUtleShtYXBwaW5nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNl\nbGVjdFByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpv\naW5zKSB7CiAgICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24obWFw\ncGluZywgdHJ1ZSwgbnVsbCwgam9pbnMsIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIE9wZXJhdGUgb24gcHJpbWFyeSBrZXkgZGF0YS4gUmV0dXJu\nIGEgYml0IG1hc2sgb2Ygc2VsZWN0ZWQgY29sdW1ucy4KICAgICAqLwogICAg\ncHJpdmF0ZSBpbnQgcHJpbWFyeUtleU9wZXJhdGlvbihDbGFzc01hcHBpbmcg\nbWFwcGluZywgYm9vbGVhbiBzZWwsCiAgICAgICAgQm9vbGVhbiBhc2MsIEpv\naW5zIGpvaW5zLCBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBpZiAo\nIXNlbCAmJiBhc2MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDA7Cgog\nICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZyBjYW4ndCBzZWxlY3QgdGhlIGZ1\nbGwgcGsgdmFsdWVzLCB0aGVuIGpvaW4gdG8KICAgICAgICAvLyBzdXBlciBh\nbmQgcmVjdXJzZQogICAgICAgIENsYXNzTWFwcGluZyBzdXA7CiAgICAgICAg\naWYgKCFtYXBwaW5nLmlzUHJpbWFyeUtleU9iamVjdElkKHRydWUpKSB7CiAg\nICAgICAgICAgIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCk7CiAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAg\nICBqb2lucyA9IG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNl\nKTsKICAgICAgICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24oc3Vw\nLCBzZWwsIGFzYywgam9pbnMsIGFsaWFzT3JkZXIpOwogICAgICAgIH0KCiAg\nICAgICAgQ29sdW1uW10gY29scyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNv\nbHVtbnMoKTsKICAgICAgICBpZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAg\nICAgIGdyb3VwQnkoY29scywgam9pbnMpOwogICAgICAgICAgICByZXR1cm4g\nMDsKICAgICAgICB9CgogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5z\nKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgaWYgKGNvbHVtbk9wZXJhdGlvbihjb2xzW2ldLCBzZWwsIGFzYywg\ncGosIGFsaWFzT3JkZXIpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8\nIGk7CgogICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZyBoYXMgbm90IGJlZW4g\ndXNlZCBpbiB0aGUgc2VsZWN0IHlldCAoYW5kIHRoZXJlZm9yZQogICAgICAg\nIC8vIGlzIG5vdCBqb2luZWQgdG8gYW55dGhpbmcpLCBidXQgaGFzIGFuIG90\naGVyLXRhYmxlIHN1cGVyY2xhc3MgdGhhdAogICAgICAgIC8vIGhhcyBiZWVu\nIHVzZWQsIG1ha2Ugc3VyZSB0byBqb2luIHRvIGl0CiAgICAgICAgYm9vbGVh\nbiBqb2luZWQgPSBmYWxzZTsKICAgICAgICBmb3IgKHN1cCA9IG1hcHBpbmcu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7IHN1cCAhPSBudWxs\nOwogICAgICAgICAgICBtYXBwaW5nID0gc3VwLCBzdXAgPSBtYXBwaW5nLmdl\ndEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpKSB7CiAgICAgICAgICAg\nIGlmIChzdXAuZ2V0VGFibGUoKSA9PSBtYXBwaW5nLmdldFRhYmxlKCkpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChtYXBw\naW5nLmdldFRhYmxlKCkgIT0gc3VwLmdldFRhYmxlKCkKICAgICAgICAgICAg\nICAgICYmIGdldFRhYmxlSW5kZXgobWFwcGluZy5nZXRUYWJsZSgpLCBwaiwg\nZmFsc2UpID09IC0xCiAgICAgICAgICAgICAgICAmJiBnZXRUYWJsZUluZGV4\nKHN1cC5nZXRUYWJsZSgpLCBwaiwgZmFsc2UpICE9IC0xKSB7CiAgICAgICAg\nICAgICAgICBpZiAocGogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBw\naiA9IChQYXRoSm9pbnMpIG5ld0pvaW5zKCk7CiAgICAgICAgICAgICAgICBw\naiA9IChQYXRoSm9pbnMpIG1hcHBpbmcuam9pblN1cGVyY2xhc3MocGosIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGpvaW5lZCA9IHRydWU7CiAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQog\nICAgICAgIGlmIChqb2luZWQpCiAgICAgICAgICAgIHdoZXJlKHBqKTsKCiAg\nICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJm\nb3JtIGFuIG9wZXJhdGlvbiBvbiBhIGNvbHVtbi4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIGNvbHVtbk9wZXJhdGlvbihDb2x1bW4gY29sLCBib29s\nZWFuIHNlbCwgQm9vbGVhbiBhc2MsCiAgICAgICAgUGF0aEpvaW5zIHBqLCBi\nb29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBTdHJpbmcgYXMgPSBudWxs\nOwogICAgICAgIGlmIChhc2MgIT0gbnVsbCAmJiAoYWxpYXNPcmRlciB8fCAo\nX2ZsYWdzICYgUkVDT1JEX09SREVSRUQpICE9IDApKSB7CiAgICAgICAgICAg\nIE9iamVjdCBpZDsKICAgICAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGou\ncGF0aCgpID09IG51bGwpCiAgICAgICAgICAgICAgICBpZCA9IGNvbDsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWQgPSBnZXRDb2x1bW5B\nbGlhcyhjb2wsIHBqKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBSRUNP\nUkRfT1JERVJFRCkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9vcmRl\ncmVkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX29yZGVyZWQgPSBu\nZXcgQXJyYXlMaXN0KDUpOwogICAgICAgICAgICAgICAgX29yZGVyZWQuYWRk\nKGlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWxpYXNPcmRl\ncikgewogICAgICAgICAgICAgICAgYXMgPSB0b09yZGVyQWxpYXMoX29yZGVy\ncysrKTsKICAgICAgICAgICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKGlk\nLCBhcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvb2xl\nYW4gc2VsZCA9IHNlbCAmJiBzZWxlY3QoY29sLCBwaiwgZmFsc2UpOwogICAg\nICAgIGlmIChhc2MgIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgYWxp\nYXMgPSAoYXMgIT0gbnVsbCkgPyBhcyA6IGdldENvbHVtbkFsaWFzKGNvbCwg\ncGopOwogICAgICAgICAgICBhcHBlbmRPcmRlcmluZyhhbGlhcywgYXNjLmJv\nb2xlYW5WYWx1ZSgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgb3JkZXJpbmcgaW5mb3Jt\nYXRpb24gdG8gb3VyIGludGVybmFsIGJ1ZmZlci4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFwcGVuZE9yZGVyaW5nKE9iamVjdCBvcmRlckJ5LCBib29s\nZWFuIGFzYykgewogICAgICAgIGlmIChfb3JkZXJpbmcgPT0gbnVsbCkKICAg\nICAgICAgICAgX29yZGVyaW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIsICIp\nOwoKICAgICAgICBpZiAob3JkZXJCeSBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikK\nICAgICAgICAgICAgX29yZGVyaW5nLmFwcGVuZCgoU1FMQnVmZmVyKSBvcmRl\nckJ5KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBl\nbmQoKFN0cmluZykgb3JkZXJCeSk7CiAgICAgICAgaWYgKGFzYykKICAgICAg\nICAgICAgX29yZGVyaW5nLmFwcGVuZCgiIEFTQyIpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgX29yZGVyaW5nLmFwcGVuZCgiIERFU0MiKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBib29sZWFuIGFzYywKICAgICAgICBib29sZWFuIHNlbCkg\newogICAgICAgIHJldHVybiBvcmRlckJ5UHJpbWFyeUtleShtYXBwaW5nLCBh\nc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5\nUHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2Ms\nCiAgICAgICAgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAg\ncmV0dXJuIG9yZGVyQnlQcmltYXJ5S2V5KG1hcHBpbmcsIGFzYywgam9pbnMs\nIHNlbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5p\nb25zIHRvIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgb3JkZXJCeVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGJvb2xlYW4gYXNjLAogICAgICAgIEpvaW5zIGpvaW5zLCBi\nb29sZWFuIHNlbCwgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0\ndXJuIHByaW1hcnlLZXlPcGVyYXRpb24obWFwcGluZywgc2VsLAogICAgICAg\nICAgICAoYXNjKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsIGpv\naW5zLCBhbGlhc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBv\ncmRlckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkg\newogICAgICAgIHJldHVybiBvcmRlckJ5KGNvbCwgYXNjLCBudWxsLCBzZWwp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNv\nbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewog\nICAgICAgIHJldHVybiBvcmRlckJ5KGNvbCwgYXNjLCBqb2lucywgc2VsLCBm\nYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8g\nc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9v\nbGVhbiBvcmRlckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBq\nb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVy\nKSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbk9wZXJhdGlvbihjb2wsIHNlbCwg\nKGFzYykgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLAogICAgICAg\nICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSksIGFsaWFzT3JkZXIpOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29s\nZWFuIGFzYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJC\neShjb2xzLCBhc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGlu\ndCBvcmRlckJ5KENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBq\nb2lucywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShj\nb2xzLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBj\nb2x1bW5zLgogICAgICovCiAgICBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xz\nLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAg\nICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIFBhdGhKb2lucyBw\naiA9IGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9\nIDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICBpZiAoY29sdW1uT3BlcmF0aW9uKGNvbHNbaV0s\nIHNlbCwKICAgICAgICAgICAgICAgIChhc2MpID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRSwgcGosIGFsaWFzT3JkZXIpKQogICAgICAgICAgICAg\nICAgc2VsZCB8PSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIgc3FsLCBi\nb29sZWFuIGFzYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3Jk\nZXJCeShzcWwsIGFzYywgKEpvaW5zKSBudWxsLCBzZWwpOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU1FMQnVmZmVyIHNxbCwgYm9vbGVh\nbiBhc2MsIEpvaW5zIGpvaW5zLAogICAgICAgIGJvb2xlYW4gc2VsKSB7CiAg\nICAgICAgcmV0dXJuIG9yZGVyQnkoc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGZh\nbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVuaW9ucyB0byBz\nZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5zLgogICAgICovCiAgICBib29s\nZWFuIG9yZGVyQnkoU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5z\nIGpvaW5zLCBib29sZWFuIHNlbCwKICAgICAgICBib29sZWFuIGFsaWFzT3Jk\nZXIpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeSgoT2JqZWN0KSBzcWwsIGFz\nYywgam9pbnMsIHNlbCwgYWxpYXNPcmRlcik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBPcmRlciBvbiBhIFNRTCBidWZmZXIgb3Igc3RyaW5nLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gb3JkZXJCeShPYmplY3Qgc3FsLCBib29s\nZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJv\nb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIE9iamVjdCBvcmRlciA9IHNx\nbDsKICAgICAgICBpZiAoYWxpYXNPcmRlcikgewogICAgICAgICAgICBvcmRl\nciA9IHRvT3JkZXJBbGlhcyhfb3JkZXJzKyspOwogICAgICAgICAgICBfc2Vs\nZWN0cy5zZXRTZWxlY3RBcyhzcWwsIChTdHJpbmcpIG9yZGVyKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKChfZmxhZ3MgJiBSRUNPUkRfT1JERVJFRCkgIT0g\nMCkgewogICAgICAgICAgICBpZiAoX29yZGVyZWQgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9vcmRlcmVkID0gbmV3IEFycmF5TGlzdCg1KTsKICAgICAg\nICAgICAgX29yZGVyZWQuYWRkKHNxbCk7CiAgICAgICAgfQoKICAgICAgICBn\nZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgYXBwZW5kT3JkZXJpbmco\nb3JkZXIsIGFzYyk7CiAgICAgICAgaWYgKHNlbCkgewogICAgICAgICAgICBp\nbnQgaWR4ID0gX3NlbGVjdHMuaW5kZXhPZkFsaWFzKHNxbCk7CiAgICAgICAg\nICAgIGlmIChpZHggPT0gLTEpIHsKICAgICAgICAgICAgICAgIF9zZWxlY3Rz\nLnNldEFsaWFzKG51bGxJZCgpLCBzcWwsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBv\ncmRlckJ5KFN0cmluZyBzcWwsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkg\newogICAgICAgIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCBudWxsLCBzZWwp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNx\nbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewog\nICAgICAgIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCBqb2lucywgc2VsLCBm\nYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8g\nc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9v\nbGVhbiBvcmRlckJ5KFN0cmluZyBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBq\nb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVy\nKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoKE9iamVjdCkgc3FsLCBhc2Ms\nIGpvaW5zLCBzZWwsIGFsaWFzT3JkZXIpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGNsZWFyT3JkZXJpbmcoKSB7CiAgICAgICAgX29yZGVyaW5nID0gbnVs\nbDsKICAgICAgICBfb3JkZXJzID0gMDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFsbG93IHVuaW9ucyB0byByZWNvcmQgdGhlIHNlbGVjdCBsaXN0IGluZGV4\nZXMgb2YgaXRlbXMgd2Ugb3JkZXIgYnkuCiAgICAgKi8KICAgIHZvaWQgc2V0\nUmVjb3JkT3JkZXJlZEluZGV4ZXMoYm9vbGVhbiByZWNvcmQpIHsKICAgICAg\nICBpZiAocmVjb3JkKQogICAgICAgICAgICBfZmxhZ3MgfD0gUkVDT1JEX09S\nREVSRUQ7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9vcmRlcmVkID0g\nbnVsbDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5SRUNPUkRfT1JERVJFRDsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGlu\nZGV4ZXMgaW4gdGhlIHNlbGVjdCBsaXN0IG9mIGFsbCBpdGVtcyB3ZSdyZSBv\ncmRlcmluZwogICAgICogYnksIG9yIG51bGwgaWYgbm9uZS4gRm9yIHVzZSB3\naXRoIHVuaW9ucy4KICAgICAqLwogICAgTGlzdCBnZXRPcmRlcmVkSW5kZXhl\ncygpIHsKICAgICAgICBpZiAoX29yZGVyZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgTGlzdCBpZHhzID0gbmV3IEFycmF5\nTGlzdChfb3JkZXJlZC5zaXplKCkpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgX29yZGVyZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIGlkeHMu\nYWRkKE51bWJlcnMudmFsdWVPZihfc2VsZWN0cy5pbmRleE9mKF9vcmRlcmVk\nLmdldChpKSkpKTsKICAgICAgICByZXR1cm4gaWR4czsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB3aGVyZVByaW1hcnlLZXkoT2JqZWN0IG9pZCwgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAg\nICAgICAgd2hlcmVQcmltYXJ5S2V5KG9pZCwgbWFwcGluZywgbnVsbCwgc3Rv\ncmUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHdoZXJlIGNvbmRpdGlv\nbnMgc2V0dGluZyB0aGUgbWFwcGluZydzIHByaW1hcnkga2V5IHRvIHRoZSBn\naXZlbgogICAgICogb2lkIHZhbHVlcy4gSWYgdGhlIGdpdmVuIG1hcHBpbmcg\nZG9lcyBub3QgdXNlIG9pZCB2YWx1ZXMgZm9yIGl0cwogICAgICogcHJpbWFy\neSBrZXksIHdlIHdpbGwgcmVjdXJzaXZlbHkgam9pbiB0byBpdHMgc3VwZXJj\nbGFzcyB1bnRpbCB3ZSBmaW5kCiAgICAgKiBhbiBhbmNlc3RvciB0aGF0IGRv\nZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZVByaW1hcnlLZXko\nT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5z\nLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIC8vIGlmIHRo\naXMgbWFwcGluZydzIGlkZW50aWZpZXJzIGluY2x1ZGUgc29tZXRoaW5nIG90\naGVyIHRoYW4KICAgICAgICAvLyB0aGUgcGsgdmFsdWVzLCBqb2luIHRvIHN1\ncGVyIGFuZCByZWN1cnNlCiAgICAgICAgaWYgKCFtYXBwaW5nLmlzUHJpbWFy\neUtleU9iamVjdElkKGZhbHNlKSkgewogICAgICAgICAgICBDbGFzc01hcHBp\nbmcgc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKTsKICAgICAgICAgICAgaWYgKGpvaW5zID09IG51bGwpCiAgICAgICAg\nICAgICAgICBqb2lucyA9IG5ld0pvaW5zKCk7CiAgICAgICAgICAgIGpvaW5z\nID0gbWFwcGluZy5qb2luU3VwZXJjbGFzcyhqb2lucywgZmFsc2UpOwogICAg\nICAgICAgICB3aGVyZVByaW1hcnlLZXkob2lkLCBzdXAsIGpvaW5zLCBzdG9y\nZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIENv\nbHVtbltdIGNvbHMgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7\nCiAgICAgICAgd2hlcmUob2lkLCBtYXBwaW5nLCBjb2xzLCBjb2xzLCBudWxs\nLCBudWxsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSksCiAgICAgICAgICAgIHN0\nb3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUZvcmVpZ25LZXko\nRm9yZWlnbktleSBmaywgT2JqZWN0IG9pZCwKICAgICAgICBDbGFzc01hcHBp\nbmcgbWFwcGluZywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgd2hlcmVG\nb3JlaWduS2V5KGZrLCBvaWQsIG1hcHBpbmcsIG51bGwsIHN0b3JlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB3aGVyZSBjb25kaXRpb25zIHNldHRp\nbmcgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IHRvIHRoZSBnaXZlbgogICAgICog\nb2lkIHZhbHVlcy4KICAgICAqCiAgICAgKiBAc2VlICN3aGVyZVByaW1hcnlL\nZXkKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlRm9yZWlnbktleShG\nb3JlaWduS2V5IGZrLCBPYmplY3Qgb2lkLAogICAgICAgIENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBKb2lucyBqb2lucywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAg\nICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nJ3MgaWRlbnRpZmllcnMgaW5jbHVk\nZSBzb21ldGhpbmcgb3RoZXIgdGhhbgogICAgICAgIC8vIHRoZSBwayB2YWx1\nZXMsIG9yIGlmIHRoaXMgZm9yZWlnbiBrZXkgZG9lc24ndCBsaW5rIHRvIG9u\nbHkKICAgICAgICAvLyBpZGVudGlmaWVycywgam9pbiB0byB0YWJsZSBhbmQg\nZG8gYSBnZXRQcmltYXJ5S2V5CiAgICAgICAgaWYgKCFtYXBwaW5nLmlzUHJp\nbWFyeUtleU9iamVjdElkKGZhbHNlKSB8fCAhY29udGFpbnNBbGwKICAgICAg\nICAgICAgKG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSwgZmsuZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKSkpIHsKICAgICAgICAgICAgaWYgKGpvaW5z\nID09IG51bGwpCiAgICAgICAgICAgICAgICBqb2lucyA9IG5ld0pvaW5zKCk7\nCiAgICAgICAgICAgIC8vIHRyYXZlcnNlIHRvIGZvcmVpZ24ga2V5IHRhcmdl\ndCBtYXBwaW5nCiAgICAgICAgICAgIHdoaWxlIChtYXBwaW5nLmdldFRhYmxl\nKCkgIT0gZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGpv\naW5zID0gbmV3Sm9pbnMoKTsKICAgICAgICAgICAgICAgIGpvaW5zID0gbWFw\ncGluZy5qb2luU3VwZXJjbGFzcyhqb2lucywgZmFsc2UpOwogICAgICAgICAg\nICAgICAgbWFwcGluZyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBpZiAobWFwcGluZyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGpvaW5zID0g\nam9pbnMuam9pbihmaywgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgICAgd2hl\ncmVQcmltYXJ5S2V5KG9pZCwgbWFwcGluZywgam9pbnMsIHN0b3JlKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10g\nZnJvbUNvbHMgPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10g\ndG9Db2xzID0gZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBD\nb2x1bW5bXSBjb25zdENvbHMgPSBmay5nZXRDb25zdGFudENvbHVtbnMoKTsK\nICAgICAgICBPYmplY3RbXSBjb25zdHMgPSBmay5nZXRDb25zdGFudHMoKTsK\nICAgICAgICB3aGVyZShvaWQsIG1hcHBpbmcsIHRvQ29scywgZnJvbUNvbHMs\nIGNvbnN0cywgY29uc3RDb2xzLAogICAgICAgICAgICBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSksIHN0b3JlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVy\nbmFsIG1ldGhvZCB0byBmbHVzaCB0aGUgb2lkIHZhbHVlcyBhcyB3aGVyZSBj\nb25kaXRpb25zIHRvIHRoZQogICAgICogZ2l2ZW4gY29sdW1ucy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlKE9iamVjdCBvaWQsIENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBDb2x1bW5bXSB0b0NvbHMsCiAgICAgICAgQ29sdW1u\nW10gZnJvbUNvbHMsIE9iamVjdFtdIHZhbHMsIENvbHVtbltdIGNvbnN0Q29s\ncywgUGF0aEpvaW5zIHBqLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkgewog\nICAgICAgIFZhbHVlTWFwcGluZyBlbWJlZCA9IG1hcHBpbmcuZ2V0RW1iZWRk\naW5nTWFwcGluZygpOwogICAgICAgIGlmIChlbWJlZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIHdoZXJlKG9pZCwgZW1iZWQuZ2V0RmllbGRNYXBwaW5nKCku\nZ2V0RGVmaW5pbmdNYXBwaW5nKCksCiAgICAgICAgICAgICAgICB0b0NvbHMs\nIGZyb21Db2xzLCB2YWxzLCBjb25zdENvbHMsIHBqLCBzdG9yZSk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNRTEJ1ZmZlciBi\ndWYgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKCiAgICAgICAgLy8gb25seSBi\nb3RoZXIgdG8gcGFjayBwayB2YWx1ZXMgaW50byBhcnJheSBpZiBhcHAgaWQg\nICAgICAgIAogICAgICAgIGludCBjb3VudCA9IHdoZXJlUHJpbWFyeUtleSht\nYXBwaW5nLCB0b0NvbHMsIGZyb21Db2xzLCBvaWQsIHN0b3JlLCBwaiwgCiAg\nICAgICAgCWJ1ZiwgbnVsbCk7CiAgICAgICAgICAgIAkKICAgICAgICBpZiAo\nY29uc3RDb2xzICE9IG51bGwgJiYgY29uc3RDb2xzLmxlbmd0aCA+IDApIHsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25zdENvbHMubGVu\nZ3RoOyBpKyssIGNvdW50KyspIHsKICAgICAgICAgICAgICAgIGlmIChjb3Vu\ndCA+IDApCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAi\nKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZ2V0Q29sdW1uQWxpYXMo\nY29uc3RDb2xzW2ldLCBwaikpOwoKICAgICAgICAgICAgICAgIGlmICh2YWxz\nW2ldID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIElTICIpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZFZhbHVlKHZhbHNbaV0sIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHdoZXJlKGJ1ZiwgcGopOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgd2hlcmVQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBDb2x1bW5bXSB0b0NvbHMsIAogICAgCUNvbHVtbltdIGZyb21D\nb2xzLCBPYmplY3Qgb2lkLCBKREJDU3RvcmUgc3RvcmUsIFBhdGhKb2lucyBw\naiwKICAgIAlTUUxCdWZmZXIgYnVmLCBMaXN0IHBhcm1MaXN0KSB7CiAgICAg\nICAgLy8gb25seSBib3RoZXIgdG8gcGFjayBwayB2YWx1ZXMgaW50byBhcnJh\neSBpZiBhcHAgaWQKICAgIAlib29sZWFuIGNvbGxlY3RQYXJtVmFsdWVPbmx5\nID0gKHBhcm1MaXN0ICE9IG51bGwgPyB0cnVlIDogZmFsc2UpOwogICAgICAg\nIE9iamVjdFtdIHBrcyA9IG51bGw7CiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0FQUExJQ0FUSU9O\nKQogICAgICAgICAgICBwa3MgPSBBcHBsaWNhdGlvbklkcy50b1BLVmFsdWVz\nKG9pZCwgbWFwcGluZyk7CgogICAgICAgIEpvaW5hYmxlIGpvaW47CiAgICAg\nICAgT2JqZWN0IHZhbDsKICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgdG9Db2xzLmxlbmd0aDsgaSsrLCBjb3Vu\ndCsrKSB7CiAgICAgICAgICAgIGlmIChwa3MgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHZhbCA9IChvaWQgPT0gbnVsbCkgPyBudWxsIDogTnVtYmVycy52\nYWx1ZU9mKCgoSWQpIG9pZCkuZ2V0SWQoKSk7CiAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgLy8gbXVzdCBiZSBhcHAgaWRlbnRpdHk7IHVz\nZSBwayBpbmRleCB0byBnZXQgY29ycmVjdCBwayB2YWx1ZQogICAgICAgICAg\nICAgICAgam9pbiA9IG1hcHBpbmcuYXNzZXJ0Sm9pbmFibGUodG9Db2xzW2ld\nKTsKICAgICAgICAgICAgICAgIHZhbCA9IHBrc1ttYXBwaW5nLmdldEZpZWxk\nKGpvaW4uZ2V0RmllbGRJbmRleCgpKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRQcmltYXJ5S2V5SW5kZXgoKV07CiAgICAgICAgICAgICAgICB2YWwgPSBq\nb2luLmdldEpvaW5WYWx1ZSh2YWwsIHRvQ29sc1tpXSwgc3RvcmUpOwogICAg\nICAgICAgICAgICAgaWYgKHBhcm1MaXN0ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAJcGFybUxpc3QuYWRkKHZhbCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgCiAgICAgICAgICAgIGlmIChjb2xsZWN0UGFybVZhbHVlT25seSkg\nCiAgICAgICAgICAgIAljb250aW51ZTsKICAgICAgICAgICAgCiAgICAgICAg\nICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGdldENvbHVtbkFs\naWFzKGZyb21Db2xzW2ldLCBwaikpOwogICAgICAgICAgICBpZiAodmFsID09\nIG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9\nICIpOwogICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUodmFsLCBmcm9tQ29s\nc1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb3VudDsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBUZXN0IHRvIHNlZSBpZiB0aGUgZ2l2ZW4g\nc2V0IG9mIGNvbHVtbnMgY29udGFpbnMgYWxsIHRoZQogICAgICogY29sdW1u\ncyBpbiB0aGUgZ2l2ZW4gcG90ZW50aWFsIHN1YnNldC4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBjb250YWluc0FsbChDb2x1bW5bXSBz\nZXQsIENvbHVtbltdIHN1YikgewogICAgICAgIGlmIChzdWIubGVuZ3RoID4g\nc2V0Lmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAvLyB0aGlzIGlzIG9idmlvdXNseSBuXjIsIGJ1dCB0aGUgbnVtYmVyIG9m\nIGNvbHVtbnMgc2hvdWxkIGJlIGluCiAgICAgICAgLy8gdGhlIDEtMiByYW5n\nZSwgc28gbm8gYmlnZ2llCiAgICAgICAgYm9vbGVhbiBmb3VuZCA9IHRydWU7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdWIubGVuZ3RoICYmIGZv\ndW5kOyBpKyspIHsKICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAg\nICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBzZXQubGVuZ3RoICYmICFmb3Vu\nZDsgaisrKQogICAgICAgICAgICAgICAgZm91bmQgPSBzdWJbaV0gPT0gc2V0\nW2pdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZm91bmQ7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgd2hlcmUoSm9pbnMgam9pbnMpIHsKICAgICAgICBp\nZiAoam9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgd2hlcmUoKFN0cmluZykg\nbnVsbCwgam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFNR\nTEJ1ZmZlciBzcWwpIHsKICAgICAgICB3aGVyZShzcWwsIChKb2lucykgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNx\nbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICB3aGVyZShzcWwsIGdldEpvaW5z\nKGpvaW5zLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhl\nIGdpdmVuIGNvbmRpdGlvbiB0byB0aGUgV0hFUkUgY2xhdXNlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNxbCwgUGF0aEpv\naW5zIHBqKSB7CiAgICAgICAgLy8gbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4K\nICAgICAgICBpZiAoc3FsID09IG51bGwgfHwgc3FsLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3doZXJlID09IG51bGwp\nCiAgICAgICAgICAgIF93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwog\nICAgICAgIGVsc2UgaWYgKCFfd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAg\nICBfd2hlcmUuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF93aGVyZS5hcHBl\nbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShTdHJpbmcg\nc3FsKSB7CiAgICAgICAgd2hlcmUoc3FsLCAoSm9pbnMpIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFN0cmluZyBzcWwsIEpvaW5zIGpv\naW5zKSB7CiAgICAgICAgd2hlcmUoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1\nZSkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25k\naXRpb24gdG8gdGhlIFdIRVJFIGNsYXVzZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHdoZXJlKFN0cmluZyBzcWwsIFBhdGhKb2lucyBwaikgewogICAg\nICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkoc3FsKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpZiAoX3doZXJlID09IG51bGwpCiAgICAgICAgICAgIF93aGVy\nZSA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFf\nd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAgICBfd2hlcmUuYXBwZW5kKCIg\nQU5EICIpOwogICAgICAgIF93aGVyZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBoYXZpbmcoU1FMQnVmZmVyIHNxbCkgewogICAgICAg\nIGhhdmluZyhzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBzcWwsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgaGF2aW5nKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRv\nIHRoZSBIQVZJTkcgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\naGF2aW5nKFNRTEJ1ZmZlciBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAg\nIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKHNxbCA9\nPSBudWxsIHx8IHNxbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgaWYgKF9oYXZpbmcgPT0gbnVsbCkKICAgICAgICAgICAgX2hh\ndmluZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYg\nKCFfaGF2aW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAgX2hhdmluZy5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgX2hhdmluZy5hcHBlbmQoc3FsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZpbmcoU3RyaW5nIHNxbCkgewogICAg\nICAgIGhhdmluZyhzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgaGF2aW5nKFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgaGF2aW5nKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRv\nIHRoZSBIQVZJTkcgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\naGF2aW5nKFN0cmluZyBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8v\nIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkoc3FsKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBpZiAoX2hhdmluZyA9PSBudWxsKQogICAgICAgICAgICBfaGF2aW5nID0g\nbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBpZiAoIV9oYXZp\nbmcuaXNFbXB0eSgpKQogICAgICAgICAgICBfaGF2aW5nLmFwcGVuZCgiIEFO\nRCAiKTsKICAgICAgICBfaGF2aW5nLmFwcGVuZChzcWwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdyb3VwQnkoU1FMQnVmZmVyIHNxbCkgewogICAgICAg\nIGdyb3VwQnkoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsK\nICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgZ3JvdXBC\neUFwcGVuZChzcWwuZ2V0U1FMKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGdyb3VwQnkoU3RyaW5nIHNxbCkgewogICAgICAgIGdyb3VwQnkoc3FsLCAo\nSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnko\nU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBnZXRKb2lucyhq\nb2lucywgdHJ1ZSk7CiAgICAgICAgZ3JvdXBCeUFwcGVuZChzcWwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uIGNvbCkgewogICAg\nICAgIGdyb3VwQnkoY29sLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBncm91cEJ5KENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\nUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAg\nIGdyb3VwQnlBcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29sLCBwaikpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uW10gY29scykgewog\nICAgICAgIGdyb3VwQnkoY29scywgbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgZ3JvdXBCeShDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lucykgewog\nICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0cnVlKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgZ3JvdXBCeUFwcGVuZChnZXRDb2x1bW5BbGlhcyhj\nb2xzW2ldLCBwaikpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0\nZSB2b2lkIGdyb3VwQnlBcHBlbmQoU3RyaW5nIHNxbCkgewogICAgICAgIGlm\nIChfZ3JvdXBlZCA9PSBudWxsIHx8ICFfZ3JvdXBlZC5jb250YWlucyhzcWwp\nKSB7CiAgICAgICAgICAgIGlmIChfZ3JvdXBpbmcgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgX2dyb3VwaW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7\nCiAgICAgICAgICAgICAgICBfZ3JvdXBlZCA9IG5ldyBBcnJheUxpc3QoKTsK\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfZ3JvdXBpbmcu\nYXBwZW5kKCIsICIpOwoKICAgICAgICAgICAgX2dyb3VwaW5nLmFwcGVuZChz\ncWwpOwogICAgICAgICAgICBfZ3JvdXBlZC5hZGQoc3FsKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDbGFzc01hcHBpbmcg\nbWFwcGluZywgaW50IHN1YmNsYXNzZXMsIEpEQkNTdG9yZSBzdG9yZSwKICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAg\nZ3JvdXBCeShtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIG51\nbGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMg\nam9pbnMpIHsKICAgICAgICAvLyB3ZSBpbXBsZW1lbnQgdGhpcyBieSBwdXR0\naW5nIG91cnNlbHZlcyBpbnRvIGdyb3VwaW5nIG1vZGUsIHdoZXJlCiAgICAg\nICAgLy8gYWxsIHNlbGVjdCBpbnZvY2F0aW9ucyBhcmUgcmUtcm91dGVkIHRv\nIGdyb3VwLWJ5IGludm9jYXRpb25zIGluc3RlYWQuCiAgICAgICAgLy8gdGhp\ncyBhbGxvd3MgdXMgdG8gdXRpbGl6ZSB0aGUgc2FtZSBzZWxlY3QgQVBJcyBv\nZiB0aGUgc3RvcmUgbWFuYWdlcgogICAgICAgIC8vIGFuZCBhbGwgdGhlIG1h\ncHBpbmcgc3RyYXRlZ2llcywgcmF0aGVyIHRoYW4gaGF2aW5nIHRvIGNyZWF0\nZSAKICAgICAgICAvLyBlcXVpdmFsZW50IEFQSXMgYW5kIGR1cGxpY2F0ZSBs\nb2dpYyBmb3IgZ3JvdXBpbmcKICAgICAgICBib29sZWFuIHdhc0dyb3VwaW5n\nID0gaXNHcm91cGluZygpOwogICAgICAgIF9mbGFncyB8PSBHUk9VUElORzsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBzZWxlY3QobWFwcGluZywgc3Vi\nY2xhc3Nlcywgc3RvcmUsIGZldGNoLCAKICAgICAgICAgICAgICAgIEVhZ2Vy\nRmV0Y2hNb2Rlcy5FQUdFUl9OT05FLCBqb2lucyk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgaWYgKCF3YXNHcm91cGluZykKICAgICAgICAg\nICAgICAgIF9mbGFncyAmPSB+R1JPVVBJTkc7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB3ZSdyZSBpbiBncm91cCBtb2RlLCB3\naGVyZSBhbnkgc2VsZWN0IGlzIGNoYW5nZWQgdG8gYSBncm91cC1ieQogICAg\nICogY2FsbC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzR3JvdXBp\nbmcoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBHUk9VUElORykgIT0g\nMDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgam9pbnMgdG8g\ndXNlIGZvciBjb2x1bW4gYWxpYXNlcywgZXRjLgogICAgICoKICAgICAqIEBw\nYXJhbSBqb2lucyBqb2lucyBnaXZlbiBieSB0aGUgdXNlcgogICAgICogQHJl\ndHVybiB0aGUgam9pbnMgdG8gdXNlIGZvciBhbGlhc2VzLCBldGMKICAgICAq\nLwogICAgcHJpdmF0ZSBQYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMs\nIGJvb2xlYW4gcmVjb3JkKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBh\ndGhKb2lucykgam9pbnM7CiAgICAgICAgYm9vbGVhbiBwcmUgPSAocGogPT0g\nbnVsbCB8fCAhcGouaXNEaXJ0eSgpKQogICAgICAgICAgICAmJiBfcHJlSm9p\nbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHkoKTsKICAgICAgICBp\nZiAocHJlKQogICAgICAgICAgICBwaiA9IChQYXRoSm9pbnMpIF9wcmVKb2lu\ncy5wZWVrKCk7CgogICAgICAgIGlmIChwaiA9PSBudWxsIHx8ICFwai5pc0Rp\ncnR5KCkpCiAgICAgICAgICAgIHBqID0gX2pvaW5zOwogICAgICAgIGVsc2Ug\naWYgKCFwcmUpIHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBPVVRFUikg\nIT0gMCkKICAgICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgb3V0ZXIo\ncGopOwogICAgICAgICAgICBpZiAocmVjb3JkKSB7CiAgICAgICAgICAgICAg\nICBpZiAoIXBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICByZW1v\ndmVQYXJlbnRKb2lucyhwaik7CiAgICAgICAgICAgICAgICBpZiAoIXBqLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZUpvaW5zRnJv\nbVN1YnNlbGVjdHMocGopOwogICAgICAgICAgICAgICAgICAgIGlmIChfam9p\nbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zID0g\nbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChfam9pbnMuam9pbnMoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBfam9pbnMuc2V0Sm9pbnMobmV3IEpvaW5TZXQocGouam9pbnMoKSkp\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICAgICAgX2pvaW5zLmpvaW5zKCkuYWRkQWxsKHBqLmpvaW5zKCkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBwajsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhbnkg\nam9pbnMgYWxyZWFkeSBpbiBvdXIgcGFyZW50IHNlbGVjdCBmcm9tIHRoZSBn\naXZlbiBub24tZW1wdHkKICAgICAqIGpvaW4gc2V0LgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcmVtb3ZlUGFyZW50Sm9pbnMoUGF0aEpvaW5zIHBqKSB7\nCiAgICAgICAgaWYgKF9wYXJlbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIGlmIChfcGFyZW50Ll9qb2lucyAhPSBudWxsICYmICFf\ncGFyZW50Ll9qb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYm9vbGVh\nbiByZW1vdmVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmICghX3JlbW92ZWRB\nbGlhc0Zyb21QYXJlbnQuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHBqLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgIEpvaW4gam4gPSAo\nSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgIGlmIChfYWxp\nYXNlcy5jb250YWluc1ZhbHVlKGpuLmdldEluZGV4MSgpKSkKICAgICAgICAg\nICAgICAgICAgICAgICByZW1vdmVkID0gX3BhcmVudC5fam9pbnMuam9pbnMo\nKS5yZW1vdmUoam4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmICghcmVtb3ZlZCkKICAgICAgICAgICAgICAgIHBq\nLmpvaW5zKCkucmVtb3ZlQWxsKF9wYXJlbnQuX2pvaW5zLmpvaW5zKCkpOwog\nICAgICAgIH0KICAgICAgICBpZiAoIXBqLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgX3BhcmVudC5yZW1vdmVQYXJlbnRKb2lucyhwaik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIG5vbi1lbXB0eSBqb2lucyBm\ncm9tIHRoZSBqb2lucyBvZiBvdXIgc3Vic2VsZWN0cy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHJlbW92ZUpvaW5zRnJvbVN1YnNlbGVjdHMoUGF0aEpv\naW5zIHBqKSB7CiAgICAgICAgaWYgKF9zdWJzZWxzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBTZWxlY3RJbXBsIHN1YjsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IF9zdWJzZWxzLnNpemUoKTsgaSsrKSB7\nCiAgICAgICAgICAgIHN1YiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQo\naSk7CiAgICAgICAgICAgIGlmIChzdWIuX2pvaW5zICE9IG51bGwgJiYgIXN1\nYi5fam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgc3ViLl9qb2lu\ncy5qb2lucygpLnJlbW92ZUFsbChwai5qb2lucygpKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIHdoZXJlQ2xvbmUoaW50\nIHNlbHMpIHsKICAgICAgICBpZiAoc2VscyA8IDEpCiAgICAgICAgICAgIHNl\nbHMgPSAxOwoKICAgICAgICBTZWxlY3RbXSBjbG9uZXMgPSBudWxsOwogICAg\nICAgIFNlbGVjdEltcGwgc2VsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgc2VsczsgaSsrKSB7CiAgICAgICAgICAgIHNlbCA9IChTZWxlY3RJbXBs\nKSBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdTZWxlY3QoKTsK\nICAgICAgICAgICAgc2VsLl9mbGFncyA9IF9mbGFnczsKICAgICAgICAgICAg\nc2VsLl9mbGFncyAmPSB+QUdHUkVHQVRFOwogICAgICAgICAgICBzZWwuX2Zs\nYWdzICY9IH5PVVRFUjsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+TFJT\nOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5FQUdFUl9UT19PTkU7CiAg\nICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfkVBR0VSX1RPX01BTlk7CiAgICAg\nICAgICAgIHNlbC5fZmxhZ3MgJj0gfkZPUkNFX0NPVU5UOwogICAgICAgICAg\nICBzZWwuX2pvaW5TeW50YXggPSBfam9pblN5bnRheDsKICAgICAgICAgICAg\naWYgKF9hbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2Fs\naWFzZXMgPSBuZXcgSGFzaE1hcChfYWxpYXNlcyk7CiAgICAgICAgICAgIGlm\nIChfdGFibGVzICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX3RhYmxl\ncyA9IG5ldyBUcmVlTWFwKF90YWJsZXMpOwogICAgICAgICAgICBpZiAoX2pv\naW5zICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2pvaW5zID0gX2pv\naW5zLmNsb25lKHNlbCk7CiAgICAgICAgICAgIGlmIChfd2hlcmUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHNlbC5fd2hlcmUgPSBuZXcgU1FMQnVmZmVy\nKF93aGVyZSk7CiAgICAgICAgICAgIGlmIChfZnJvbSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBzZWwuX2Zyb20gPSAoU2VsZWN0SW1wbCkgX2Zyb20u\nd2hlcmVDbG9uZSgxKTsKICAgICAgICAgICAgICAgIHNlbC5fZnJvbS5fb3V0\nZXIgPSBzZWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9zdWJz\nZWxzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbC5fc3Vic2VscyA9\nIG5ldyBBcnJheUxpc3QoX3N1YnNlbHMuc2l6ZSgpKTsKICAgICAgICAgICAg\nICAgIFNlbGVjdEltcGwgc3ViLCBzZWxTdWI7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBqID0gMDsgaiA8IF9zdWJzZWxzLnNpemUoKTsgaisrKSB7CiAg\nICAgICAgICAgICAgICAgICAgc3ViID0gKFNlbGVjdEltcGwpIF9zdWJzZWxz\nLmdldChqKTsKICAgICAgICAgICAgICAgICAgICBzZWxTdWIgPSAoU2VsZWN0\nSW1wbCkgc3ViLmZ1bGxDbG9uZSgxKTsKICAgICAgICAgICAgICAgICAgICBz\nZWxTdWIuX3BhcmVudCA9IHNlbDsKICAgICAgICAgICAgICAgICAgICBzZWxT\ndWIuX3N1YlBhdGggPSBzdWIuX3N1YlBhdGg7CiAgICAgICAgICAgICAgICAg\nICAgc2VsLl9zdWJzZWxzLmFkZChzZWxTdWIpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChzZWwuX3doZXJlICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNlbC5fd2hlcmUucmVwbGFjZShzdWIsIHNlbFN1Yik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChz\nZWxzID09IDEpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsOwogICAgICAg\nICAgICBpZiAoY2xvbmVzID09IG51bGwpCiAgICAgICAgICAgICAgICBjbG9u\nZXMgPSBuZXcgU2VsZWN0W3NlbHNdOwogICAgICAgICAgICBjbG9uZXNbaV0g\nPSBzZWw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY29uZi5nZXRTUUxG\nYWN0b3J5SW5zdGFuY2UoKS5uZXdVbmlvbihjbG9uZXMpOwogICAgfQoKICAg\nIHB1YmxpYyBTZWxlY3RFeGVjdXRvciBmdWxsQ2xvbmUoaW50IHNlbHMpIHsK\nICAgICAgICBpZiAoc2VscyA8IDEpCiAgICAgICAgICAgIHNlbHMgPSAxOwoK\nICAgICAgICBTZWxlY3RbXSBjbG9uZXMgPSBudWxsOwogICAgICAgIFNlbGVj\ndEltcGwgc2VsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2Vsczsg\naSsrKSB7CiAgICAgICAgICAgIHNlbCA9IChTZWxlY3RJbXBsKSB3aGVyZUNs\nb25lKDEpOwogICAgICAgICAgICBzZWwuX2ZsYWdzID0gX2ZsYWdzOwogICAg\nICAgICAgICBzZWwuX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBfZXhwZWN0ZWRS\nZXN1bHRDb3VudDsKICAgICAgICAgICAgc2VsLl9zZWxlY3RzLmFkZEFsbChf\nc2VsZWN0cyk7CiAgICAgICAgICAgIGlmIChfb3JkZXJpbmcgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHNlbC5fb3JkZXJpbmcgPSBuZXcgU1FMQnVmZmVy\nKF9vcmRlcmluZyk7CiAgICAgICAgICAgIHNlbC5fb3JkZXJzID0gX29yZGVy\nczsKICAgICAgICAgICAgaWYgKF9ncm91cGluZyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgc2VsLl9ncm91cGluZyA9IG5ldyBTUUxCdWZmZXIoX2dyb3Vw\naW5nKTsKICAgICAgICAgICAgaWYgKF9oYXZpbmcgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNlbC5faGF2aW5nID0gbmV3IFNRTEJ1ZmZlcihfaGF2aW5n\nKTsKICAgICAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHNlbC5fZnJvbSA9IChTZWxlY3RJbXBsKSBfZnJvbS5mdWxsQ2xv\nbmUoMSk7CiAgICAgICAgICAgICAgICBzZWwuX2Zyb20uX291dGVyID0gc2Vs\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VscyA9PSAxKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHNlbDsKICAgICAgICAgICAgaWYgKGNs\nb25lcyA9PSBudWxsKQogICAgICAgICAgICAgICAgY2xvbmVzID0gbmV3IFNl\nbGVjdFtzZWxzXTsKICAgICAgICAgICAgY2xvbmVzW2ldID0gc2VsOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3Rh\nbmNlKCkubmV3VW5pb24oY2xvbmVzKTsKICAgIH0KCiAgICBwdWJsaWMgU2Vs\nZWN0RXhlY3V0b3IgZWFnZXJDbG9uZShGaWVsZE1hcHBpbmcga2V5LCBpbnQg\nZWFnZXJUeXBlLAogICAgICAgIGJvb2xlYW4gdG9NYW55LCBpbnQgc2Vscykg\newogICAgICAgIGlmIChlYWdlclR5cGUgPT0gRUFHRVJfT1VURVIKICAgICAg\nICAgICAgJiYgX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9U\nUkFESVRJT05BTCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKF9lYWdlcktleXMgIT0gbnVsbCAmJiBfZWFnZXJLZXlzLmNvbnRhaW5z\nKGtleSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBn\nbG9iYWwgc2V0IG9mIGVhZ2VyIGtleXMKICAgICAgICBpZiAoX2VhZ2VyS2V5\ncyA9PSBudWxsKQogICAgICAgICAgICBfZWFnZXJLZXlzID0gbmV3IEhhc2hT\nZXQoKTsKICAgICAgICBfZWFnZXJLZXlzLmFkZChrZXkpOwoKICAgICAgICBT\nZWxlY3RFeGVjdXRvciBzZWw7CiAgICAgICAgaWYgKGVhZ2VyVHlwZSAhPSBF\nQUdFUl9QQVJBTExFTCkgewogICAgICAgICAgICBpZiAodG9NYW55KQogICAg\nICAgICAgICAgICAgX2ZsYWdzIHw9IEVBR0VSX1RPX01BTlk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBFQUdFUl9UT19P\nTkU7CiAgICAgICAgICAgIHNlbCA9IHRoaXM7CiAgICAgICAgfSBlbHNlIGlm\nIChzZWxzIDwgMikKICAgICAgICAgICAgc2VsID0gcGFyYWxsZWxDbG9uZSgp\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBTZWxlY3RbXSBjbG9uZXMg\nPSBuZXcgU2VsZWN0W3NlbHNdOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNsb25lcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNs\nb25lc1tpXSA9IHBhcmFsbGVsQ2xvbmUoKTsKICAgICAgICAgICAgc2VsID0g\nX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3VW5pb24oY2xvbmVz\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChfZWFnZXIgPT0gbnVsbCkKICAg\nICAgICAgICAgX2VhZ2VyID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfZWFn\nZXIucHV0KHRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsLCBmYWxzZSkp\nLCBzZWwpOwogICAgICAgIHJldHVybiBzZWw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBjbG9uZSBvZiB0aGlzIHNlbGVjdCBmb3IgdXNlIGlu\nIGVhZ2VyIHBhcmFsbGVsIHNlbGVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUg\nU2VsZWN0SW1wbCBwYXJhbGxlbENsb25lKCkgewogICAgICAgIFNlbGVjdElt\ncGwgc2VsID0gKFNlbGVjdEltcGwpIHdoZXJlQ2xvbmUoMSk7CiAgICAgICAg\nc2VsLl9mbGFncyAmPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBzZWwu\nX2VhZ2VyS2V5cyA9IF9lYWdlcktleXM7CiAgICAgICAgaWYgKF9wcmVKb2lu\ncyAhPSBudWxsICYmICFfcHJlSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAgICAg\nICAgIHNlbC5fcHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAg\nc2VsLl9wcmVKb2lucy5wdXNoKCgoU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5w\nZWVrKCkpLgogICAgICAgICAgICAgICAgY2xvbmUoc2VsKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBzZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdmlldyBvZiBlYWdlciBzZWxlY3RzLiBNYXkgYmUgbnVsbC4KICAg\nICAqLwogICAgcHVibGljIE1hcCBnZXRFYWdlck1hcCgpIHsKICAgICAgICBy\nZXR1cm4gX2VhZ2VyOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRv\nciBnZXRFYWdlcihGaWVsZE1hcHBpbmcga2V5KSB7CiAgICAgICAgaWYgKF9l\nYWdlciA9PSBudWxsIHx8ICFfZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoU2VsZWN0\nRXhlY3V0b3IpIF9lYWdlci5nZXQodG9FYWdlcktleShrZXksIGdldEpvaW5z\nKG51bGwsCiAgICAgICAgICAgIGZhbHNlKSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBlYWdlciBrZXkgdG8gdXNlIGZvciB0aGUgdXNl\nci1naXZlbiBrZXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVj\ndCB0b0VhZ2VyS2V5KEZpZWxkTWFwcGluZyBrZXksIFBhdGhKb2lucyBwaikg\newogICAgICAgIGlmIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgIHJldHVybiBuZXcg\nS2V5KHBqLnBhdGgoKS50b1N0cmluZygpLCBrZXkpOwogICAgfQoKICAgIHB1\nYmxpYyBKb2lucyBuZXdKb2lucygpIHsKICAgICAgICBpZiAoX3ByZUpvaW5z\nICE9IG51bGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgU2VsZWN0Sm9pbnMgc2ogPSAoU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5w\nZWVrKCk7CiAgICAgICAgICAgIHJldHVybiBzai5jbG9uZSh0aGlzKTsKICAg\nICAgICB9CiAgICAgICAgLy8gcmV0dXJuIHRoaXMgZm9yIGVmZmljaWVuY3kg\naW4gY2FzZSBubyBqb2lucyBlbmQgdXAgYmVpbmcgbWFkZQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBuZXdPdXRlckpv\naW5zKCkgewogICAgICAgIHJldHVybiAoKFBhdGhKb2lucykgbmV3Sm9pbnMo\nKSkuc2V0T3V0ZXIodHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBw\nZW5kKFNRTEJ1ZmZlciBidWYsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYg\nKGpvaW5zID09IG51bGwgfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGlmICghYnVmLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBKb2luIGpvaW4g\nPSBudWxsOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gKChQYXRoSm9p\nbnMpIGpvaW5zKS5qb2lucygpLmpvaW5JdGVyYXRvcigpOwogICAgICAgICAg\nICBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2luID0gKEpvaW4p\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHN3aXRjaCAoX2pvaW5TeW50YXgp\nIHsKICAgICAgICAgICAgICAgIGNhc2UgSm9pblN5bnRheGVzLlNZTlRBWF9U\nUkFESVRJT05BTDoKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKF9k\naWN0LnRvVHJhZGl0aW9uYWxKb2luKGpvaW4pKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSm9pblN5bnRheGVz\nLlNZTlRBWF9EQVRBQkFTRToKICAgICAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKF9kaWN0LnRvTmF0aXZlSm9pbihqb2luKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBKb2lucyBhbmQoSm9pbnMgam9pbnMxLCBK\nb2lucyBqb2luczIpIHsKICAgICAgICByZXR1cm4gYW5kKChQYXRoSm9pbnMp\nIGpvaW5zMSwgKFBhdGhKb2lucykgam9pbnMyLCB0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbWJpbmUgdGhlIGdpdmVuIGpvaW5zLgogICAgICov\nCiAgICBwcml2YXRlIFNlbGVjdEpvaW5zIGFuZChQYXRoSm9pbnMgajEsIFBh\ndGhKb2lucyBqMiwgYm9vbGVhbiBudWxsSm9pbnMpIHsKICAgICAgICBpZiAo\nKGoxID09IG51bGwgfHwgajEuaXNFbXB0eSgpKQogICAgICAgICAgICAmJiAo\najIgPT0gbnVsbCB8fCBqMi5pc0VtcHR5KCkpKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgU2VsZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0\nSm9pbnModGhpcyk7CiAgICAgICAgaWYgKGoxID09IG51bGwgfHwgajEuaXNF\nbXB0eSgpKSB7CiAgICAgICAgICAgIGlmIChudWxsSm9pbnMpCiAgICAgICAg\nICAgICAgICBzai5zZXRKb2lucyhqMi5qb2lucygpKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgc2ouc2V0Sm9pbnMobmV3IEpvaW5TZXQo\najIuam9pbnMoKSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEpv\naW5TZXQgc2V0OwogICAgICAgICAgICBpZiAobnVsbEpvaW5zKQogICAgICAg\nICAgICAgICAgc2V0ID0gajEuam9pbnMoKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgc2V0ID0gbmV3IEpvaW5TZXQoajEuam9pbnMoKSk7\nCgogICAgICAgICAgICBpZiAoajIgIT0gbnVsbCAmJiAhajIuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgc2V0LmFkZEFsbChqMi5qb2lucygpKTsKICAg\nICAgICAgICAgc2ouc2V0Sm9pbnMoc2V0KTsKICAgICAgICB9CgogICAgICAg\nIC8vIG51bGwgcHJldmlvdXMgam9pbnM7IGFsbCBhcmUgY29tYmluZWQgaW50\nbyB0aGlzIG9uZQogICAgICAgIGlmIChudWxsSm9pbnMgJiYgajEgIT0gbnVs\nbCkKICAgICAgICAgICAgajEubnVsbEpvaW5zKCk7CiAgICAgICAgaWYgKG51\nbGxKb2lucyAmJiBqMiAhPSBudWxsKQogICAgICAgICAgICBqMi5udWxsSm9p\nbnMoKTsKCiAgICAgICAgcmV0dXJuIHNqOwogICAgfQoKICAgIHB1YmxpYyBK\nb2lucyBvcihKb2lucyBqb2luczEsIEpvaW5zIGpvaW5zMikgewogICAgICAg\nIFBhdGhKb2lucyBqMSA9IChQYXRoSm9pbnMpIGpvaW5zMTsKICAgICAgICBQ\nYXRoSm9pbnMgajIgPSAoUGF0aEpvaW5zKSBqb2luczI7CgogICAgICAgIC8v\nIGlmIG5vIGNvbW1vbiBqb2lucywgcmV0dXJuIG51bGw7IGlmIG9uZSBzaWRl\nIG9mIHRoZSBvciBjbGF1c2UgaGFzCiAgICAgICAgLy8gZGlmZmVyZW50IGpv\naW5zIHRoYW4gdGhlIG90aGVyLCB0aGVuIHdlIG5lZWQgdG8gdXNlIGRpc3Rp\nbmN0CiAgICAgICAgYm9vbGVhbiBqMUVtcHR5ID0gajEgPT0gbnVsbCB8fCBq\nMS5pc0VtcHR5KCk7CiAgICAgICAgYm9vbGVhbiBqMkVtcHR5ID0gajIgPT0g\nbnVsbCB8fCBqMi5pc0VtcHR5KCk7CiAgICAgICAgaWYgKGoxRW1wdHkgfHwg\najJFbXB0eSkgewogICAgICAgICAgICBpZiAoajFFbXB0eSAmJiAhajJFbXB0\neSkgewogICAgICAgICAgICAgICAgY29sbGVjdE91dGVySm9pbnMoajIpOwog\nICAgICAgICAgICAgICAgaWYgKCFqMi5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKGoyRW1wdHkgJiYgIWoxRW1wdHkpIHsKICAgICAg\nICAgICAgICAgIGNvbGxlY3RPdXRlckpvaW5zKGoxKTsKICAgICAgICAgICAg\nICAgIGlmICghajEuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIF9m\nbGFncyB8PSBJTVBMSUNJVF9ESVNUSU5DVDsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIGFsbCBjb21tb24gam9pbnMsIG1vdmUgYWxsIGpvaW5zIHRvIHJldHVybmVk\nIGluc3RhbmNlCiAgICAgICAgU2VsZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0\nSm9pbnModGhpcyk7CiAgICAgICAgaWYgKGoxLmpvaW5zKCkuZXF1YWxzKGoy\nLmpvaW5zKCkpKSB7CiAgICAgICAgICAgIHNqLnNldEpvaW5zKGoxLmpvaW5z\nKCkpOwogICAgICAgICAgICBqMS5udWxsSm9pbnMoKTsKICAgICAgICAgICAg\najIubnVsbEpvaW5zKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nSm9pblNldCBjb21tb25Kb2lucyA9IG5ldyBKb2luU2V0KGoxLmpvaW5zKCkp\nOwogICAgICAgICAgICBjb21tb25Kb2lucy5yZXRhaW5BbGwoajIuam9pbnMo\nKSk7CiAgICAgICAgICAgIGlmICghY29tbW9uSm9pbnMuaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgICAgICAvLyBwdXQgY29tbW9uIGpvaW5zIGluIHJldHVy\nbmVkIGluc3RhbmNlOyByZW1vdmUgdGhlbSBmcm9tCiAgICAgICAgICAgICAg\nICAvLyBlYWNoIGdpdmVuIGluc3RhbmNlCiAgICAgICAgICAgICAgICBzai5z\nZXRKb2lucyhjb21tb25Kb2lucyk7CiAgICAgICAgICAgICAgICBqMS5qb2lu\ncygpLnJlbW92ZUFsbChjb21tb25Kb2lucyk7CiAgICAgICAgICAgICAgICBq\nMi5qb2lucygpLnJlbW92ZUFsbChjb21tb25Kb2lucyk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgY29sbGVjdE91dGVySm9pbnMoajEpOwogICAgICAg\nICAgICBjb2xsZWN0T3V0ZXJKb2lucyhqMik7CgogICAgICAgICAgICAvLyBp\nZiBvbmUgc2lkZSBvZiB0aGUgb3IgY2xhdXNlIGhhcyBkaWZmZXJlbnQgam9p\nbnMgdGhhbiB0aGUgb3RoZXIsCiAgICAgICAgICAgIC8vIHRoZW4gd2UgbmVl\nZCB0byB1c2UgZGlzdGluY3QKICAgICAgICAgICAgaWYgKCFqMS5pc0VtcHR5\nKCkgfHwgIWoyLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIF9mbGFncyB8\nPSBJTVBMSUNJVF9ESVNUSU5DVDsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHNqOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBvdXRlcihKb2lucyBqb2lu\ncykgewogICAgICAgIGlmIChfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMu\nU1lOVEFYX1RSQURJVElPTkFMIHx8IGpvaW5zID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBqb2luczsKCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhp\ncyBpcyBhbiBvdXRlciBqb2luIHNldCwgZXZlbiBpZiBpdCdzIGVtcHR5CiAg\nICAgICAgUGF0aEpvaW5zIHBqID0gKChQYXRoSm9pbnMpIGpvaW5zKS5zZXRP\ndXRlcih0cnVlKTsKICAgICAgICBpZiAocGouaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gcGo7CgogICAgICAgIEpvaW4gam9pbjsKICAgICAgICBK\nb2luIHJlYzsKICAgICAgICBib29sZWFuIGhhc0pvaW5zID0gX2pvaW5zICE9\nIG51bGwgJiYgX2pvaW5zLmpvaW5zKCkgIT0gbnVsbDsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IHBqLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgam9pbiA9IChKb2luKSBpdHIubmV4\ndCgpOwogICAgICAgICAgICBpZiAoam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5U\nWVBFX0lOTkVSKSB7CiAgICAgICAgICAgICAgICBpZiAoIWhhc0pvaW5zKQog\nICAgICAgICAgICAgICAgICAgIGpvaW4uc2V0VHlwZShKb2luLlRZUEVfT1VU\nRVIpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgcmVjID0gX2pvaW5zLmpvaW5zKCkuZ2V0UmVjb3JkZWRKb2luKGpvaW4p\nOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWMgPT0gbnVsbCB8fCByZWMu\nZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgICAg\nICAgICAgICAgam9pbi5zZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGpvaW5zOwogICAgfQoKICAgIC8qKgogICAgICogTW92ZXMgdGhl\nIGpvaW5zIGZyb20gdGhlIGdpdmVuIGluc3RhbmNlIGludG8gb3VyIG91dGVy\nIGpvaW5zIHNldC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNvbGxlY3RP\ndXRlckpvaW5zKFBhdGhKb2lucyBwaikgewogICAgICAgIGlmIChfam9pblN5\nbnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMIHx8IHBq\nID09IG51bGwKICAgICAgICAgICAgfHwgcGouaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAg\nICAgICAgICAgX2pvaW5zID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwoKICAg\nICAgICBib29sZWFuIGFkZCA9IHRydWU7CiAgICAgICAgaWYgKF9qb2lucy5q\nb2lucygpID09IG51bGwpIHsKICAgICAgICAgICAgX2pvaW5zLnNldEpvaW5z\nKHBqLmpvaW5zKCkpOwogICAgICAgICAgICBhZGQgPSBmYWxzZTsKICAgICAg\nICB9CgogICAgICAgIEpvaW4gam9pbjsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHBqLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBpZiAoam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lOTkVS\nKSB7CiAgICAgICAgICAgICAgICBpZiAoam9pbi5nZXRGb3JlaWduS2V5KCkg\nIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICYmICFfZGljdC5jYW5PdXRl\nckpvaW4oX2pvaW5TeW50YXgsIGpvaW4uZ2V0Rm9yZWlnbktleSgpKSkgewog\nICAgICAgICAgICAgICAgICAgIExvZyBsb2cgPSBfY29uZi5nZXRMb2coSkRC\nQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBsb2cud2FybihfbG9jLmdldCgiY2FudC1vdXRlci1mayIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBqb2luLmdldEZvcmVpZ25LZXkoKSkp\nOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nam9pbi5zZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKGFkZCkKICAgICAgICAgICAgICAgIF9qb2lucy5q\nb2lucygpLmFkZChqb2luKTsKICAgICAgICB9CiAgICAgICAgcGoubnVsbEpv\naW5zKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFz\nIGZvciB0aGUgZ2l2ZW4gdGFibGUgdW5kZXIgdGhlIGdpdmVuIGpvaW5zLgog\nICAgICogTk9URTogV0UgUkVMWSBPTiBUSEVTRSBJTkRFWEVTIEJFSU5HIE1P\nTk9UT05JQ0FMTFkgSU5DUkVBU0lORyBGUk9NIDAKICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgZ2V0VGFibGVJbmRleChUYWJsZSB0YWJsZSwgUGF0aEpvaW5z\nIHBqLCBib29sZWFuIGNyZWF0ZSkgewogICAgICAgIC8vIGlmIHdlIGhhdmUg\nYSBmcm9tIHNlbGVjdCwgdGhlbiB0aGVyZSBhcmUgbm8gdGFibGUgYWxpYXNl\ncwogICAgICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gLTE7CgogICAgICAgIE9iamVjdCBrZXkgPSB0YWJsZS5nZXRGdWxsTmFt\nZSgpOwogICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBu\ndWxsKQogICAgICAgICAgICBrZXkgPSBuZXcgS2V5KHBqLnBhdGgoKS50b1N0\ncmluZygpLCBrZXkpOwoKICAgICAgICAvLyBjaGVjayBvdXQgZXhpc3Rpbmcg\nYWxpYXNlcwogICAgICAgIEludGVnZXIgaSA9IGZpbmRBbGlhcyh0YWJsZSwg\na2V5LCBmYWxzZSwgbnVsbCk7CiAgICAgICAgaWYgKGkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGkuaW50VmFsdWUoKTsKICAgICAgICBpZiAoIWNy\nZWF0ZSkKICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICAvLyBub3Qg\nZm91bmQ7IGNyZWF0ZSBhbGlhcwogICAgICAgIGkgPSBOdW1iZXJzLnZhbHVl\nT2YoYWxpYXNTaXplKCkpOwogICAgICAgIHJlY29yZFRhYmxlQWxpYXModGFi\nbGUsIGtleSwgaSk7CiAgICAgICAgcmV0dXJuIGkuaW50VmFsdWUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEF0dGVtcHQgdG8gZmluZCB0aGUgYWxpYXMg\nZm9yIHRoZSBnaXZlbiBrZXkuCiAgICAgKgogICAgICogQHBhcmFtIGZyb21Q\nYXJlbnQgd2hldGhlciBhIHBhcmVudCBpcyBjaGVja2luZyBpdHMgc3Vic2Vs\nZWN0cwogICAgICogQHBhcmFtIGZyb21TdWIgdGhlIHN1YnNlbGVjdCBjaGVj\na2luZyBpdHMgcGFyZW50CiAgICAgKi8KICAgIHByaXZhdGUgSW50ZWdlciBm\naW5kQWxpYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXksIGJvb2xlYW4gZnJv\nbVBhcmVudCwKICAgICAgICBTZWxlY3RJbXBsIGZyb21TdWIpIHsKICAgICAg\nICBJbnRlZ2VyIGFsaWFzID0gbnVsbDsKICAgICAgICBpZiAoX2FsaWFzZXMg\nIT0gbnVsbCkgewogICAgICAgICAgICBhbGlhcyA9IChJbnRlZ2VyKSAoKGZy\nb21QYXJlbnQpID8gX2FsaWFzZXMucmVtb3ZlKGtleSkKICAgICAgICAgICAg\nICAgIDogX2FsaWFzZXMuZ2V0KGtleSkpOwogICAgICAgICAgICBpZiAoYWxp\nYXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGZyb21QYXJlbnQp\nCiAgICAgICAgICAgICAgICAgICAgX3RhYmxlcy5yZW1vdmUoYWxpYXMpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGlmICghZnJvbVBhcmVudCAmJiBfcGFyZW50ICE9\nIG51bGwpIHsKICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVBbGlhc0Zyb21Q\nYXJlbnQgPSBrZXkudG9TdHJpbmcoKS5pbmRleE9mKCI6IikgIT0gLTE7CiAg\nICAgICAgICAgIGFsaWFzID0gX3BhcmVudC5maW5kQWxpYXModGFibGUsIGtl\neSwgcmVtb3ZlQWxpYXNGcm9tUGFyZW50LCB0aGlzKTsKICAgICAgICAgICAg\naWYgKGFsaWFzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZW1v\ndmVBbGlhc0Zyb21QYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICByZWNv\ncmRUYWJsZUFsaWFzKHRhYmxlLCBrZXksIGFsaWFzKTsKICAgICAgICAgICAg\nICAgICAgICBfcmVtb3ZlZEFsaWFzRnJvbVBhcmVudC5zZXQoYWxpYXMuaW50\nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXR1cm4gYWxpYXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\naWYgKF9zdWJzZWxzICE9IG51bGwpIHsKICAgICAgICAgICAgU2VsZWN0SW1w\nbCBzdWI7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3N1YnNl\nbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIHN1YiA9IChTZWxl\nY3RJbXBsKSBfc3Vic2Vscy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAo\nc3ViID09IGZyb21TdWIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgICAgICBpZiAoYWxpYXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIGlmIChzdWIuX2FsaWFzZXMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgc3ViLl9hbGlhc2VzLnJlbW92ZShrZXkpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChzdWIuX3RhYmxlcyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBzdWIuX3RhYmxlcy5yZW1vdmUoYWxp\nYXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoa2V5IGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGFsaWFzID0gc3ViLmZpbmRBbGlhcyh0YWJsZSwga2V5\nLCB0cnVlLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFm\ncm9tUGFyZW50ICYmIGFsaWFzICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZWNvcmRUYWJsZUFsaWFzKHRhYmxlLCBrZXksIGFsaWFz\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsaWFzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkIHRoZSBtYXBwaW5nIG9mIHRo\nZSBnaXZlbiBrZXkgdG8gdGhlIGdpdmVuIGFsaWFzLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcmVjb3JkVGFibGVBbGlhcyhUYWJsZSB0YWJsZSwgT2Jq\nZWN0IGtleSwgSW50ZWdlciBhbGlhcykgewogICAgICAgIGlmIChfYWxpYXNl\ncyA9PSBudWxsKQogICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFw\nKCk7CiAgICAgICAgX2FsaWFzZXMucHV0KGtleSwgYWxpYXMpOwoKICAgICAg\nICBTdHJpbmcgdGFibGVTdHJpbmcgPSBfZGljdC5nZXRGdWxsTmFtZSh0YWJs\nZSwgZmFsc2UpICsgIiAiCiAgICAgICAgICAgICsgdG9BbGlhcyhhbGlhcy5p\nbnRWYWx1ZSgpKTsKICAgICAgICBpZiAoX3RhYmxlcyA9PSBudWxsKQogICAg\nICAgICAgICBfdGFibGVzID0gbmV3IFRyZWVNYXAoKTsKICAgICAgICBfdGFi\nbGVzLnB1dChhbGlhcywgdGFibGVTdHJpbmcpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ2FsY3VsYXRlIHRvdGFsIG51bWJlciBvZiBhbGlhc2VzLgogICAg\nICovCiAgICBwcml2YXRlIGludCBhbGlhc1NpemUoKSB7CiAgICAgICAgcmV0\ndXJuIGFsaWFzU2l6ZShmYWxzZSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDYWxjdWxhdGUgdG90YWwgbnVtYmVyIG9mIGFsaWFzZXMuCiAgICAg\nKgogICAgICogQHBhcmFtIGZyb21QYXJlbnQgd2hldGhlciBhIHBhcmVudCBp\ncyBjaGVja2luZyBpdHMgc3Vic2VsZWN0cwogICAgICogQHBhcmFtIGZyb21T\ndWIgdGhlIHN1YnNlbGVjdCBjaGVja2luZyBpdHMgcGFyZW50CiAgICAgKi8K\nICAgIHByaXZhdGUgaW50IGFsaWFzU2l6ZShib29sZWFuIGZyb21QYXJlbnQs\nIFNlbGVjdEltcGwgZnJvbVN1YikgewogICAgICAgIGludCBhbGlhc2VzID0g\nKGZyb21QYXJlbnQgfHwgX3BhcmVudCA9PSBudWxsKSA/IDAKICAgICAgICAg\nICAgOiBfcGFyZW50LmFsaWFzU2l6ZShmYWxzZSwgdGhpcyk7CiAgICAgICAg\nYWxpYXNlcyArPSAoX2FsaWFzZXMgPT0gbnVsbCkgPyAwIDogX2FsaWFzZXMu\nc2l6ZSgpOwogICAgICAgIGlmIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIFNlbGVjdEltcGwgc3ViOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9zdWJzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBzdWIgPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0KGkpOwogICAg\nICAgICAgICAgICAgaWYgKHN1YiAhPSBmcm9tU3ViKQogICAgICAgICAgICAg\nICAgICAgIGFsaWFzZXMgKz0gc3ViLmFsaWFzU2l6ZSh0cnVlLCBudWxsKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYWxpYXNl\nczsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAg\nICAgIHJldHVybiB0b1NlbGVjdChmYWxzZSwgbnVsbCkuZ2V0U1FMKCk7CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nUGF0aEpvaW5zIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIFBhdGhK\nb2lucyBzZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5zZXRPdXRlcih0cnVlKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgo\nKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIEpv\naW5TZXQgam9pbnMoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgcHVibGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIDA7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICB9CgogICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJs\nZSBsb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmNyb3NzSm9pbihsb2NhbFRh\nYmxlLCBmb3JlaWduVGFibGUpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBq\nb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0\nb01hbnkpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nLmpvaW4oZmssIGludmVyc2UsIHRvTWFueSk7CiAgICB9CgogICAgcHVibGlj\nIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVy\nc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxl\nY3RKb2lucyh0aGlzKS5vdXRlckpvaW4oZmssIGludmVyc2UsIHRvTWFueSk7\nCiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcg\nbmFtZSwgRm9yZWlnbktleSBmaywgQ2xhc3NNYXBwaW5nIHRhcmdldCwKICAg\nICAgICBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFu\neSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuam9p\nblJlbGF0aW9uKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIAogICAgICAgICAg\nICBpbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBv\ndXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywg\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xl\nYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICByZXR1cm4g\nbmV3IFNlbGVjdEpvaW5zKHRoaXMpLm91dGVySm9pblJlbGF0aW9uKG5hbWUs\nIGZrLCB0YXJnZXQsIHN1YnMsIAogICAgICAgICAgICBpbnZlcnNlLCB0b01h\nbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBzZXRWYXJpYWJsZShTdHJp\nbmcgdmFyKSB7CiAgICAgICAgaWYgKHZhciA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5z\nKHRoaXMpLnNldFZhcmlhYmxlKHZhcik7CiAgICB9CgogICAgcHVibGljIEpv\naW5zIHNldFN1YnNlbGVjdChTdHJpbmcgYWxpYXMpIHsKICAgICAgICBpZiAo\nYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5zZXRTdWJzZWxlY3Qo\nYWxpYXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIFNR\nTCBzdHJpbmcgc2VsZWN0ZWQgd2l0aCBudWxsIGlkLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBOdWxsSWQgewogICAgfQoKICAgIC8qKgog\nICAgICogUmVwcmVzZW50cyBhIHBsYWNlaG9sZGVyIFNRTCBzdHJpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFBsYWNlaG9sZGVyIHsK\nICAgIH0KCiAgICAvKioKICAgICAqIEtleSB0eXBlIHVzZWQgZm9yIGFsaWFz\nZXMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEtleSB7Cgog\nICAgICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9wYXRoOwogICAgICAgIHBy\naXZhdGUgZmluYWwgT2JqZWN0IF9rZXk7CgogICAgICAgIHB1YmxpYyBLZXko\nU3RyaW5nIHBhdGgsIE9iamVjdCBrZXkpIHsKICAgICAgICAgICAgX3BhdGgg\nPSBwYXRoOwogICAgICAgICAgICBfa2V5ID0ga2V5OwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9wYXRoLmhhc2hDb2RlKCkgXiBfa2V5Lmhhc2hDb2RlKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90\naGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChvdGhlci5n\nZXRDbGFzcygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIEtleSBrID0gKEtleSkgb3RoZXI7CiAg\nICAgICAgICAgIHJldHVybiBrLl9wYXRoLmVxdWFscyhfcGF0aCkgJiYgay5f\na2V5LmVxdWFscyhfa2V5KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBfcGF0aCAr\nICJ8IiArIF9rZXk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQSB7QGxpbmsgUmVzdWx0fSBpbXBsZW1lbnRhdGlvbiB3cmFwcGVkIGFyb3Vu\nZCB0aGlzIHNlbGVjdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFz\ncyBTZWxlY3RSZXN1bHQKICAgICAgICBleHRlbmRzIFJlc3VsdFNldFJlc3Vs\ndAogICAgICAgIGltcGxlbWVudHMgUGF0aEpvaW5zIHsKCiAgICAgICAgcHJp\ndmF0ZSBTZWxlY3RJbXBsIF9zZWwgPSBudWxsOwoKICAgICAgICAvLyBwb3Np\ndGlvbiBpbiBzZWxlY3RlZCBjb2x1bW5zIGxpc3Qgd2hlcmUgd2UgZXhwZWN0\nIHRoZSBuZXh0IGxvYWQKICAgICAgICBwcml2YXRlIGludCBfcG9zID0gMDsK\nICAgICAgICBwcml2YXRlIFN0YWNrIF9wcmVKb2lucyA9IG51bGw7CgogICAg\nICAgIC8qKgogICAgICAgICAqIENvbnN0cnVjdG9yLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyBTZWxlY3RSZXN1bHQoQ29ubmVjdGlvbiBjb25uLCBT\ndGF0ZW1lbnQgc3RtbnQsIFJlc3VsdFNldCBycywKICAgICAgICAgICAgREJE\naWN0aW9uYXJ5IGRpY3QpIHsKICAgICAgICAgICAgc3VwZXIoY29ubiwgc3Rt\nbnQsIHJzLCBkaWN0KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIFNlbGVjdCBmb3IgdGhpcyByZXN1bHQuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIFNlbGVjdEltcGwgZ2V0U2VsZWN0KCkgewogICAgICAgICAg\nICByZXR1cm4gX3NlbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIFNlbGVjdCBmb3IgdGhpcyByZXN1bHQuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIHZvaWQgc2V0U2VsZWN0KFNlbGVjdEltcGwgc2VsKSB7CiAg\nICAgICAgICAgIF9zZWwgPSBzZWw7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgT2JqZWN0IGdldEVhZ2VyKEZpZWxkTWFwcGluZyBrZXkpIHsKICAgICAg\nICAgICAgLy8gZG9uJ3QgYm90aGVyIGNyZWF0aW5nIGtleSBpZiB3ZSBrbm93\nIHdlIGRvbid0IGhhdmUgYW55CiAgICAgICAgICAgIC8vIGVhZ2VyIHJlc3Vs\ndHMKICAgICAgICAgICAgaWYgKF9zZWwuX2VhZ2VyID09IG51bGwgfHwgIV9z\nZWwuX2VhZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgICAgIE1hcCBtYXAgPSBTZWxlY3RSZXN1\nbHQudGhpcy5nZXRFYWdlck1hcCh0cnVlKTsKICAgICAgICAgICAgaWYgKG1h\ncCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgICAgIHJldHVybiBtYXAuZ2V0KF9zZWwudG9FYWdlcktleShrZXksIGdl\ndEpvaW5zKG51bGwpKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBwdXRFYWdlcihGaWVsZE1hcHBpbmcga2V5LCBPYmplY3QgcmVzKSB7CiAg\nICAgICAgICAgIE1hcCBtYXAgPSBTZWxlY3RSZXN1bHQudGhpcy5nZXRFYWdl\nck1hcCh0cnVlKTsKICAgICAgICAgICAgaWYgKG1hcCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBtYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAg\nICAgICAgc2V0RWFnZXJNYXAobWFwKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBtYXAucHV0KF9zZWwudG9FYWdlcktleShrZXksIGdldEpvaW5zKG51\nbGwpKSwgcmVzKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Qg\nbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgSkRCQ1N0b3JlIHN0b3JlLAog\nICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBKb2lu\ncyBqb2lucykKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIGJvb2xlYW4gaGFzSm9pbnMgPSBqb2lucyAhPSBudWxsCiAg\nICAgICAgICAgICAgICAmJiAoKFBhdGhKb2lucykgam9pbnMpLnBhdGgoKSAh\nPSBudWxsOwogICAgICAgICAgICBpZiAoaGFzSm9pbnMpIHsKICAgICAgICAg\nICAgICAgIGlmIChfcHJlSm9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBfcHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAgICAg\nIF9wcmVKb2lucy5wdXNoKGpvaW5zKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgT2JqZWN0IG9iaiA9IHN1cGVyLmxvYWQobWFwcGluZywgc3RvcmUs\nIGZldGNoLCBqb2lucyk7CgogICAgICAgICAgICAvLyByZXNldAogICAgICAg\nICAgICBpZiAoaGFzSm9pbnMpCiAgICAgICAgICAgICAgICBfcHJlSm9pbnMu\ncG9wKCk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSm9pbnMgbmV3Sm9pbnMoKSB7CiAgICAgICAgICAgIFBh\ndGhKb2lucyBwcmUgPSBnZXRQcmVKb2lucygpOwogICAgICAgICAgICBpZiAo\ncHJlID09IG51bGwgfHwgcHJlLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CgogICAgICAgICAgICBQYXRoSm9pbnNJbXBs\nIHBqID0gbmV3IFBhdGhKb2luc0ltcGwoKTsKICAgICAgICAgICAgcGoucGF0\naCA9IG5ldyBTdHJpbmdCdWZmZXIocHJlLnBhdGgoKS50b1N0cmluZygpKTsK\nICAgICAgICAgICAgcmV0dXJuIHBqOwogICAgICAgIH0KCiAgICAgICAgcHJv\ndGVjdGVkIGJvb2xlYW4gY29udGFpbnNJbnRlcm5hbChPYmplY3Qgb2JqLCBK\nb2lucyBqb2lucykgewogICAgICAgICAgICAvLyB3ZSBrZXkgZGlyZWN0bHkg\nb24gb2JqcyBhbmQgam9pbi1sZXNzIGNvbHMsIG9yIG9uIHRoZSBhbGlhcwog\nICAgICAgICAgICAvLyBmb3IgY29scyB3aXRoIGpvaW5zCiAgICAgICAgICAg\nIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAgICAg\naWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBvYmogPSBnZXRDb2x1bW5BbGlhcygoQ29sdW1uKSBvYmosIHBq\nKTsKICAgICAgICAgICAgcmV0dXJuIG9iaiAhPSBudWxsICYmIF9zZWwuX3Nl\nbGVjdHMuY29udGFpbnMob2JqKTsKICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBib29sZWFuIGNvbnRhaW5zQWxsSW50ZXJuYWwoT2JqZWN0W10gb2Jq\ncywgSm9pbnMgam9pbnMpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lu\ncyk7CiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgb2Jqcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgb2JqID0gZ2V0Q29sdW1uQWxpYXMoKENvbHVt\nbikgb2Jqc1tpXSwgcGopOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIG9iaiA9IG9ianNbaV07CiAgICAgICAgICAgICAgICBp\nZiAob2JqID09IG51bGwgfHwgIV9zZWwuX3NlbGVjdHMuY29udGFpbnMob2Jq\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBwdXNoQmFjaygpCiAgICAgICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBfcG9zID0gMDsKICAgICAg\nICAgICAgc3VwZXIucHVzaEJhY2soKTsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBib29sZWFuIGFic29sdXRlSW50ZXJuYWwoaW50IHJvdykKICAg\nICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9w\nb3MgPSAwOwogICAgICAgICAgICByZXR1cm4gc3VwZXIuYWJzb2x1dGVJbnRl\ncm5hbChyb3cpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xl\nYW4gbmV4dEludGVybmFsKCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIF9wb3MgPSAwOwogICAgICAgICAgICByZXR1\ncm4gc3VwZXIubmV4dEludGVybmFsKCk7CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgaW50IGZpbmRPYmplY3QoT2JqZWN0IG9iaiwgSm9pbnMgam9p\nbnMpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICBpZiAoX3BvcyA9PSBfc2VsLl9zZWxlY3RzLnNpemUoKSkKICAgICAg\nICAgICAgICAgIF9wb3MgPSAwOwoKICAgICAgICAgICAgLy8gd2Uga2V5IGRp\ncmVjdGx5IG9uIG9ianMgYW5kIGpvaW4tbGVzcyBjb2xzLCBvciBvbiB0aGUg\nYWxpYXMKICAgICAgICAgICAgLy8gZm9yIGNvbHMgd2l0aCBqb2lucwogICAg\nICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucyk7CiAgICAg\nICAgICAgIEJvb2xlYW4gcGsgPSBudWxsOwogICAgICAgICAgICBpZiAocGog\nIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgQ29sdW1uIGNvbCA9IChDb2x1bW4pIG9iajsKICAgICAgICAgICAgICAg\nIHBrID0gKGNvbC5pc1ByaW1hcnlLZXkoKSkgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFOwogICAgICAgICAgICAgICAgb2JqID0gZ2V0Q29sdW1u\nQWxpYXMoY29sLCBwaik7CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlv\nbihjb2wuZ2V0VGFibGUoKSArICI6ICIKICAgICAgICAgICAgICAgICAgICAg\nICAgKyBwai5wYXRoKCkgKyAiICgiICsgX3NlbC5fYWxpYXNlcyArICIpIik7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHdlIGxvYWQgaW4gdGhl\nIHNhbWUgb3JkZXIgd2Ugc2VsZWN0LCBtb3JlIG9yIGxlc3MuLi4KICAgICAg\nICAgICAgaWYgKF9zZWwuX3NlbGVjdHMuZ2V0KF9wb3MpLmVxdWFscyhvYmop\nKQogICAgICAgICAgICAgICAgcmV0dXJuICsrX3BvczsKCiAgICAgICAgICAg\nIC8vIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIGEgcHJpbWFyeSBrZXksIHRyeSBi\nYWNrIGEgY291cGxlIHBsYWNlcywKICAgICAgICAgICAgLy8gc2luY2UgcGtz\nIG1pZ2h0IGJlIHNlbGVjdGVkIGluIGEgc2xpZ2h0bHkgZGlmZmVyZW50IG9y\nZGVyIHRoYW4KICAgICAgICAgICAgLy8gdGhleSBhcmUgbG9hZGVkIGJhY2s7\nIGRvbid0IGNoYW5nZSB0aGUgbWFya2VyIHBvc2l0aW9uCiAgICAgICAgICAg\nIGlmIChwayA9PSBudWxsKQogICAgICAgICAgICAgICAgcGsgPSAob2JqIGlu\nc3RhbmNlb2YgQ29sdW1uICYmICgoQ29sdW1uKSBvYmopLmlzUHJpbWFyeUtl\neSgpKQogICAgICAgICAgICAgICAgICAgID8gQm9vbGVhbi5UUlVFIDogQm9v\nbGVhbi5GQUxTRTsKICAgICAgICAgICAgaWYgKHBrLmJvb2xlYW5WYWx1ZSgp\nKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gX3BvcyAtIDE7IGkg\nPj0gMCAmJiBpID49IF9wb3MgLSAzOyBpLS0pCiAgICAgICAgICAgICAgICAg\nICAgaWYgKF9zZWwuX3NlbGVjdHMuZ2V0KGkpLmVxdWFscyhvYmopKQogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSArIDE7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHNlYXJjaCBmb3J3YXJkIG9uIHRoZSBhc3N1\nbXB0aW9uIHRoYXQgd2UgbWlnaHQgYmUgc2tpcHBpbmcKICAgICAgICAgICAg\nLy8gc2VsZWN0cyBmb3Igc2libGluZyBjbGFzc2VzOyBhZHZhbmNlIHRoZSBw\nb3NpdGlvbiBpZiB3ZSBmaW5kCiAgICAgICAgICAgIC8vIHNvbWV0aGluZyBm\nb3J3YXJkCiAgICAgICAgICAgIGZvciAoaW50IGkgPSBfcG9zICsgMTsgaSA8\nIF9zZWwuX3NlbGVjdHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAg\nIGlmIChfc2VsLl9zZWxlY3RzLmdldChpKS5lcXVhbHMob2JqKSkgewogICAg\nICAgICAgICAgICAgICAgIF9wb3MgPSBpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiArK19wb3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIG1heWJlIHRoZSBjb2x1bW4gd2FzIHNlbGVj\ndGVkIGJ5IDIgZGlmZmVyZW50IG1hcHBpbmdzLCBzbyBpdCdzCiAgICAgICAg\nICAgIC8vIHNvbWV3aGVyZSBwcmlvciB0byB0aGUgY3VycmVudCBwb3NpdGlv\nbjsgaW4gdGhpcyBjYXNlIGxlYXZlIHRoZQogICAgICAgICAgICAvLyBwb3Np\ndGlvbiBtYXJrZXIgYXQgaXRzIGN1cnJlbnQgcGxhY2UgY2F1c2Ugc3Vic2Vx\ndWVudCBsb2FkcyB3aWxsCiAgICAgICAgICAgIC8vIHN0aWxsIHByb2JhYmx5\nIHN0YXJ0IGZyb20gdGhlcmUKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfcG9zOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoX3NlbC5fc2Vs\nZWN0cy5nZXQoaSkuZXF1YWxzKG9iaikpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGkgKyAxOwoKICAgICAgICAgICAgLy8gc29tZXRoaW5ncydzIHdy\nb25nLi4uCiAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24ob2Jq\nLnRvU3RyaW5nKCkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmV0dXJuIHRoZSBqb2lucyB0byB1c2UgdG8gZmluZCBjb2x1bW4gZGF0\nYS4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIFBhdGhKb2lucyBnZXRK\nb2lucyhKb2lucyBqb2lucykgewogICAgICAgICAgICBQYXRoSm9pbnMgcGog\nPSAoUGF0aEpvaW5zKSBqb2luczsKICAgICAgICAgICAgaWYgKHBqICE9IG51\nbGwgJiYgcGoucGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gcGo7CiAgICAgICAgICAgIHJldHVybiBnZXRQcmVKb2lucygpOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBwcmUg\nam9pbnMgZm9yIHRoZSByZXN1bHQsIG9yIG51bGwgaWYgbm9uZS4gTm90ZSB0\naGF0CiAgICAgICAgICogd2UgaGF2ZSB0byB0YWtlIHRoZSBTZWxlY3QncyBw\ncmUgam9pbnMgaW50byBhY2NvdW50IHRvbywgc2luY2UKICAgICAgICAgKiBi\nYXRjaGVkIHNlbGVjdHMgY2FuIGhhdmUgYWRkaXRpb25hbCBwcmUgam9pbnMg\nb24gdGhlIHN0YWNrIGV2ZW4KICAgICAgICAgKiBvbiBleGVjdXRpb24uCiAg\nICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBQYXRoSm9pbnMgZ2V0UHJlSm9p\nbnMoKSB7CiAgICAgICAgICAgIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAh\nX3ByZUpvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiAo\nUGF0aEpvaW5zKSBfcHJlSm9pbnMucGVlaygpOwogICAgICAgICAgICBpZiAo\nX3NlbC5fcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3NlbC5fcHJlSm9pbnMuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIChQYXRoSm9pbnMpIF9z\nZWwuX3ByZUpvaW5zLnBlZWsoKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhl\nIGFsaWFzIHVzZWQgdG8ga2V5IG9uIHRoZSBjb2x1bW4gZGF0YSwgY29uc2lk\nZXJpbmcgdGhlCiAgICAgICAgICogZ2l2ZW4gam9pbnMuCiAgICAgICAgICov\nCiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1u\nIGNvbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgICAgIFN0cmluZyBhbGlh\nczsKICAgICAgICAgICAgaWYgKF9zZWwuX2Zyb20gIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgYWxpYXMgPSBfc2VsLnRvQWxpYXMoX3NlbC5fZnJvbS5n\nZXRUYWJsZUluZGV4CiAgICAgICAgICAgICAgICAgICAgKGNvbC5nZXRUYWJs\nZSgpLCBwaiwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGlmIChhbGlhcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgICAgICAgICAgaWYgKF9zZWwuX2RpY3QucmVxdWlyZXNBbGlhc0ZvclN1\nYnNlbGVjdCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRlJPTV9TRUxF\nQ1RfQUxJQVMgKyAiLiIgKyBhbGlhcyArICJfIiArIGNvbDsKICAgICAgICAg\nICAgICAgIHJldHVybiBhbGlhcyArICJfIiArIGNvbDsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBhbGlhcyA9IF9zZWwudG9BbGlhcyhfc2VsLmdldFRh\nYmxlSW5kZXgoY29sLmdldFRhYmxlKCksIHBqLCBmYWxzZSkpOwogICAgICAg\nICAgICByZXR1cm4gKGFsaWFzID09IG51bGwpID8gbnVsbCA6IGFsaWFzICsg\nIi4iICsgY29sOwogICAgICAgIH0KCiAgICAgICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBhdGhKb2lucyBpbXBsZW1lbnRh\ndGlvbgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFBhdGhK\nb2lucyBzZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNEaXJ0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRoKCkgewogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBKb2luU2V0IGpvaW5zKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewog\nICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIG51bGxKb2lucygpIHsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihU\nYWJsZSBsb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pbnMgam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJv\nb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pbihGb3JlaWdu\nS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktl\neSBmaywgCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBz\ndWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAg\nICAgICAgIHJldHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLmpvaW5SZWxhdGlv\nbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAgICAgIGlu\ndmVyc2UsIHRvTWFueSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9p\nbnMgb3V0ZXJKb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkg\nZmssCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJz\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLm91dGVySm9pblJlbGF0\naW9uKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsCiAgICAgICAgICAgICAgICBp\nbnZlcnNlLCB0b01hbnkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpv\naW5zIHNldFZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICAgICAgaWYg\nKHZhciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIHJldHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLnNldFZhcmlh\nYmxlKHZhcik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0\nU3Vic2VsZWN0KFN0cmluZyBhbGlhcykgewogICAgICAgICAgICBpZiAoYWxp\nYXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgICAgICByZXR1cm4gbmV3IFBhdGhKb2luc0ltcGwoKS5zZXRTdWJzZWxl\nY3QoYWxpYXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEJh\nc2Ugam9pbnMgaW1wbGVtZW50YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIFBhdGhKb2luc0ltcGwKICAgICAgICBpbXBsZW1lbnRz\nIFBhdGhKb2lucyB7CgogICAgICAgIHByb3RlY3RlZCBTdHJpbmdCdWZmZXIg\ncGF0aCA9IG51bGw7CiAgICAgICAgcHJvdGVjdGVkIFN0cmluZyB2YXIgPSBu\ndWxsOwoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgICAgICByZXR1cm4gdmFyICE9\nIG51bGwgfHwgcGF0aCAhPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIFN0cmluZ0J1ZmZlciBwYXRoKCkgewogICAgICAgICAgICByZXR1cm4g\ncGF0aDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0IGpvaW5z\nKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICByZXR1\ncm4gMDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxKb2lu\ncygpIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRWYXJp\nYWJsZShTdHJpbmcgdmFyKSB7CiAgICAgICAgICAgIHRoaXMudmFyID0gdmFy\nOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBKb2lucyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAg\nICAgICAgICAgIGlmICghYWxpYXMuZW5kc1dpdGgoIjoiKSkKICAgICAgICAg\nICAgICAgIGFsaWFzICs9ICc6JzsKICAgICAgICAgICAgYXBwZW5kKGFsaWFz\nKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBjcm9z\nc0pvaW4oVGFibGUgbG9jYWxUYWJsZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7\nCiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBu\ndWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2lucyBqb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4g\naW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgYXBwZW5k\nKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91\ndGVySm9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xl\nYW4gdG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAg\nICAgICB2YXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3Ry\naW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAgICAgICBDbGFzc01h\ncHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29s\nZWFuIHRvTWFueSkgewogICAgICAgICAgICBhcHBlbmQobmFtZSk7CiAgICAg\nICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBudWxsOwog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBvdXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9y\nZWlnbktleSBmaywKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwg\naW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICAgICAgYXBwZW5kKG5hbWUpOwogICAgICAgICAgICBhcHBlbmQo\ndmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBh\ncHBlbmQoU3RyaW5nIHN0cikgewogICAgICAgICAgICBpZiAoc3RyICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGlmIChwYXRoID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgcGF0aCA9IG5ldyBTdHJpbmdCdWZmZXIoc3RyKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwYXRo\nLmFwcGVuZCgnLicpLmFwcGVuZChzdHIpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAg\nICAgICAgICByZXR1cm4gIlBhdGhKb2luc0ltcGw8IiArIGhhc2hDb2RlKCkg\nKyAiPjogIgogICAgICAgICAgICAgICAgKyBTdHJpbmcudmFsdWVPZihwYXRo\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBKb2lucyBpbXBs\nZW1lbnRhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nU2VsZWN0Sm9pbnMKICAgICAgICBleHRlbmRzIFBhdGhKb2luc0ltcGwgCiAg\nICAgICAgaW1wbGVtZW50cyBDbG9uZWFibGUgewoKICAgICAgICBwcml2YXRl\nIGZpbmFsIFNlbGVjdEltcGwgX3NlbDsKICAgICAgICBwcml2YXRlIEpvaW5T\nZXQgX2pvaW5zID0gbnVsbDsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX291\ndGVyID0gZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX2NvdW50ID0gMDsK\nCiAgICAgICAgcHVibGljIFNlbGVjdEpvaW5zKFNlbGVjdEltcGwgc2VsKSB7\nCiAgICAgICAgICAgIF9zZWwgPSBzZWw7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgICAgICByZXR1cm4g\nX291dGVyOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFBhdGhKb2lucyBz\nZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgICAgIF9vdXRlciA9\nIG91dGVyOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgICAg\nIHJldHVybiBzdXBlci5pc0RpcnR5KCkgfHwgIWlzRW1wdHkoKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkgewogICAgICAg\nICAgICByZXR1cm4gX2pvaW5zOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgc2V0Sm9pbnMoSm9pblNldCBqb2lucykgewogICAgICAgICAgICBf\nam9pbnMgPSBqb2luczsKICAgICAgICAgICAgX291dGVyID0gam9pbnMgIT0g\nbnVsbCAmJiBqb2lucy5sYXN0KCkgIT0gbnVsbAogICAgICAgICAgICAgICAg\nJiYgam9pbnMubGFzdCgpLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVI7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpIHsK\nICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIF9jb3VudDsKICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4\nKF9jb3VudCwgX2pvaW5zLnNpemUoKSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAgICAgICAgICAgIGlmIChfam9p\nbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9jb3VudCA9IE1hdGgubWF4\nKF9jb3VudCwgX2pvaW5zLnNpemUoKSk7CiAgICAgICAgICAgIF9qb2lucyA9\nIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Vt\ncHR5KCkgewogICAgICAgICAgICByZXR1cm4gX2pvaW5zID09IG51bGwgfHwg\nX2pvaW5zLmlzRW1wdHkoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBK\nb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxUYWJsZSwgVGFibGUgZm9yZWln\nblRhYmxlKSB7CiAgICAgICAgICAgIC8vIGNyb3NzIGpvaW5zIGFyZSBmb3Ig\ndW5ib3VuZCB2YXJpYWJsZXM7IHVuZm9ydHVuYXRlbHkgd2UgaGF2ZQogICAg\nICAgICAgICAvLyB0byBhbHdheXMgZ28gRElTVElOQ1QgZm9yIHVuYm91bmQg\ndmFycyBiZWNhdXNlIHRoZXJlIGFyZSBjZXJ0YWluCiAgICAgICAgICAgIC8v\nIGNhc2VzIHRoYXQgcmVxdWlyZSBpdCwgYW5kIHdlIGNhbid0IGRpZmZlcmVu\ndGlhdGUgdGhlbSBmcm9tIHRoZQogICAgICAgICAgICAvLyBjYXNlcyB0aGF0\nIGRvbid0CiAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9IElNUExJQ0lUX0RJ\nU1RJTkNUOwoKICAgICAgICAgICAgaWYgKF9zZWwuZ2V0Sm9pblN5bnRheCgp\nICE9IEpvaW5TeW50YXhlcy5TWU5UQVhfU1FMOTIKICAgICAgICAgICAgICAg\nIHx8IF9zZWwuX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8g\nZG9uJ3QgbWFrZSBhbnkgam9pbnMsIGJ1dCB1cGRhdGUgdGhlIHBhdGggaWYg\nYSB2YXJpYWJsZQogICAgICAgICAgICAgICAgLy8gaGFzIGJlZW4gc2V0CiAg\nICAgICAgICAgICAgICB0aGlzLmFwcGVuZCh0aGlzLnZhcik7CiAgICAgICAg\nICAgICAgICB0aGlzLnZhciA9IG51bGw7CiAgICAgICAgICAgICAgICBfb3V0\nZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBkb24ndCBsZXQgdGhlIGdldCBh\nbGlhcyBtZXRob2RzIHNlZSB0aGF0IGEgdmFyIGhhcyBiZWVuIHNldAogICAg\nICAgICAgICAvLyB1bnRpbCB3ZSBnZXQgcGFzdCB0aGUgbG9jYWwgdGFibGUK\nICAgICAgICAgICAgU3RyaW5nIHZhciA9IHRoaXMudmFyOwogICAgICAgICAg\nICB0aGlzLnZhciA9IG51bGw7CgogICAgICAgICAgICBpbnQgYWxpYXMxID0g\nX3NlbC5nZXRUYWJsZUluZGV4KGxvY2FsVGFibGUsIHRoaXMsIHRydWUpOwog\nICAgICAgICAgICB0aGlzLmFwcGVuZCh2YXIpOwogICAgICAgICAgICBpbnQg\nYWxpYXMyID0gX3NlbC5nZXRUYWJsZUluZGV4KGZvcmVpZ25UYWJsZSwgdGhp\ncywgdHJ1ZSk7CiAgICAgICAgICAgIEpvaW4gaiA9IG5ldyBKb2luKGxvY2Fs\nVGFibGUsIGFsaWFzMSwgZm9yZWlnblRhYmxlLCBhbGlhczIsCiAgICAgICAg\nICAgICAgICBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIGouc2V0VHlwZShK\nb2luLlRZUEVfQ1JPU1MpOwoKICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX2pvaW5zID0gbmV3IEpvaW5TZXQoKTsK\nICAgICAgICAgICAgX2pvaW5zLmFkZChqKTsKICAgICAgICAgICAgX291dGVy\nID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBy\nZXR1cm4gam9pbihudWxsLCBmaywgbnVsbCwgLTEsIGludmVyc2UsIHRvTWFu\neSwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91\ndGVySm9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xl\nYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBqb2luKG51bGwsIGZr\nLCBudWxsLCAtMSwgaW52ZXJzZSwgdG9NYW55LCB0cnVlKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5h\nbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAgICAgICBDbGFzc01hcHBpbmcg\ndGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRv\nTWFueSkgewogICAgICAgICAgICByZXR1cm4gam9pbihuYW1lLCBmaywgdGFy\nZ2V0LCBzdWJzLCBpbnZlcnNlLCB0b01hbnksIGZhbHNlKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW5SZWxhdGlvbihTdHJp\nbmcgbmFtZSwgRm9yZWlnbktleSBmaywKICAgICAgICAgICAgQ2xhc3NNYXBw\naW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVh\nbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4obmFtZSwgZmss\nIHRhcmdldCwgc3VicywgaW52ZXJzZSwgdG9NYW55LCB0cnVlKTsKICAgICAg\nICB9CgogICAgICAgIHByaXZhdGUgSm9pbnMgam9pbihTdHJpbmcgbmFtZSwg\nRm9yZWlnbktleSBmaywgQ2xhc3NNYXBwaW5nIHRhcmdldCwKICAgICAgICAg\nICAgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnks\nIGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbGV0IHRo\nZSBnZXQgYWxpYXMgbWV0aG9kcyBzZWUgdGhhdCBhIHZhciBoYXMgYmVlbiBz\nZXQKICAgICAgICAgICAgLy8gdW50aWwgd2UgZ2V0IHBhc3QgdGhlIGxvY2Fs\nIHRhYmxlCiAgICAgICAgICAgIFN0cmluZyB2YXIgPSB0aGlzLnZhcjsKICAg\nICAgICAgICAgdGhpcy52YXIgPSBudWxsOwoKICAgICAgICAgICAgLy8gZ2V0\nIGZpcnN0IHRhYmxlIGFsaWFzIGJlZm9yZSB1cGRhdGluZyBwYXRoOyBpZiB0\naGVyZSBpcyBhIGZyb20KICAgICAgICAgICAgLy8gc2VsZWN0IHRoZW4gd2Ug\nc2hvdWxkbid0IGFjdHVhbGx5IGNyZWF0ZSBhIGpvaW4gb2JqZWN0LCBzaW5j\nZQogICAgICAgICAgICAvLyB0aGUgam9pbnMgd2lsbCBhbGwgYmUgZG9uZSBp\nbiB0aGUgZnJvbSBzZWxlY3QKICAgICAgICAgICAgYm9vbGVhbiBjcmVhdGVK\nb2luID0gX3NlbC5fZnJvbSA9PSBudWxsOwogICAgICAgICAgICBUYWJsZSB0\nYWJsZTEgPSBudWxsOwogICAgICAgICAgICBpbnQgYWxpYXMxID0gLTE7CiAg\nICAgICAgICAgIGlmIChjcmVhdGVKb2luKSB7CiAgICAgICAgICAgICAgICB0\nYWJsZTEgPSAoaW52ZXJzZSkgPyBmay5nZXRQcmltYXJ5S2V5VGFibGUoKSA6\nIGZrLmdldFRhYmxlKCk7CiAgICAgICAgICAgICAgICBhbGlhczEgPSBfc2Vs\nLmdldFRhYmxlSW5kZXgodGFibGUxLCB0aGlzLCB0cnVlKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBwYXRoIHdpdGggdGhl\nIHJlbGF0aW9uIG5hbWUgYmVmb3JlIGdldHRpbmcgcGsgYWxpYXMKICAgICAg\nICAgICAgdGhpcy5hcHBlbmQobmFtZSk7CiAgICAgICAgICAgIHRoaXMuYXBw\nZW5kKHZhcik7CiAgICAgICAgICAgIGlmICh0b01hbnkpIHsKICAgICAgICAg\nICAgICAgIF9zZWwuX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAg\nICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0gVE9fTUFOWTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBfb3V0ZXIgPSBvdXRlcjsKCiAgICAgICAgICAg\nIGlmIChjcmVhdGVKb2luKSB7CiAgICAgICAgICAgICAgICBUYWJsZSB0YWJs\nZTIgPSAoaW52ZXJzZSkgPyBmay5nZXRUYWJsZSgpIAogICAgICAgICAgICAg\nICAgICAgIDogZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCk7CiAgICAgICAgICAg\nICAgICBpbnQgYWxpYXMyID0gX3NlbC5nZXRUYWJsZUluZGV4KHRhYmxlMiwg\ndGhpcywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBKb2luIGogPSBuZXcgSm9p\nbih0YWJsZTEsIGFsaWFzMSwgdGFibGUyLCBhbGlhczIsIGZrLCBpbnZlcnNl\nKTsKICAgICAgICAgICAgICAgIGouc2V0VHlwZSgob3V0ZXIpID8gSm9pbi5U\nWVBFX09VVEVSIDogSm9pbi5UWVBFX0lOTkVSKTsKCiAgICAgICAgICAgICAg\nICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2pv\naW5zID0gbmV3IEpvaW5TZXQoKTsKICAgICAgICAgICAgICAgIGlmIChfam9p\nbnMuYWRkKGopICYmIChzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFIAog\nICAgICAgICAgICAgICAgICAgIHx8IHN1YnMgPT0gU2VsZWN0LlNVQlNfTk9O\nRSkpCiAgICAgICAgICAgICAgICAgICAgai5zZXRSZWxhdGlvbih0YXJnZXQs\nIHN1YnMsIGNsb25lKF9zZWwpKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTZWxl\nY3RKb2lucyBjbG9uZShTZWxlY3RJbXBsIHNlbCkgewogICAgICAgICAgICBT\nZWxlY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lucyhzZWwpOwogICAgICAg\nICAgICBzai52YXIgPSB2YXI7CiAgICAgICAgICAgIGlmIChwYXRoICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBzai5wYXRoID0gbmV3IFN0cmluZ0J1ZmZl\ncihwYXRoLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBpZiAoX2pvaW5zICE9\nIG51bGwgJiYgIV9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBz\nai5fam9pbnMgPSBuZXcgSm9pblNldChfam9pbnMpOwogICAgICAgICAgICBz\nai5fb3V0ZXIgPSBfb3V0ZXI7CiAgICAgICAgICAgIHJldHVybiBzajsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAg\nICAgICAgICAgIHJldHVybiBzdXBlci50b1N0cmluZygpICsgIiAoIiArIF9v\ndXRlciArICIpOiAiICsgX2pvaW5zOwogICAgICAgIH0KICAgIH0KICAgIAog\nICAgcHJvdGVjdGVkIFNlbGVjdHMgbmV3U2VsZWN0cygpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFNlbGVjdHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBjbGFzcyB0byB0cmFjayBzZWxlY3RlZCBjb2x1bW5zLCB3aXRoIGZh\nc3QgY29udGFpbnMgbWV0aG9kLgogICAgICogQWN0cyBhcyBhIGxpc3Qgb2Yg\nc2VsZWN0IGlkcywgd2l0aCBhZGRpdGlvbmFsIG1ldGhvZHMgdG8gbWFuaXB1\nbGF0ZQogICAgICogdGhlIGFsaWFzIG9mIGVhY2ggc2VsZWN0ZWQgaWQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgU2VsZWN0cwogICAg\nICAgIGV4dGVuZHMgQWJzdHJhY3RMaXN0IHsKCiAgICAgICAgcHJvdGVjdGVk\nIExpc3QgX2lkcyA9IG51bGw7CiAgICAgICAgcHJvdGVjdGVkIExpc3QgX2lk\nZW50cyA9IG51bGw7CiAgICAgICAgcHJvdGVjdGVkIE1hcCBfYWxpYXNlcyA9\nIG51bGw7CiAgICAgICAgcHJvdGVjdGVkIE1hcCBfc2VsZWN0QXMgPSBudWxs\nOwogICAgICAgIHByb3RlY3RlZCBEQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxs\nOwoKICAgICAgICAvKioKICAgICAgICAgKiBBZGQgYWxsIGFsaWFzZXMgZnJv\nbSBhbm90aGVyIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIGFkZEFsbChTZWxlY3RzIHNlbHMpIHsKICAgICAgICAgICAgaWYg\nKF9pZHMgPT0gbnVsbCAmJiBzZWxzLl9pZHMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9pZHMgPSBuZXcgQXJyYXlMaXN0KHNlbHMuX2lkcyk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKHNlbHMuX2lkcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2lkcy5hZGRBbGwoc2Vscy5faWRzKTsKCiAgICAgICAgICAgIGlm\nIChfaWRlbnRzID09IG51bGwgJiYgc2Vscy5faWRlbnRzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfaWRlbnRzID0gbmV3IEFycmF5TGlzdChzZWxzLl9p\nZGVudHMpOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9pZGVudHMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9pZGVudHMuYWRkQWxsKHNlbHMuX2lk\nZW50cyk7CgogICAgICAgICAgICBpZiAoX2FsaWFzZXMgPT0gbnVsbCAmJiBz\nZWxzLl9hbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWxpYXNl\ncyA9IG5ldyBIYXNoTWFwKHNlbHMuX2FsaWFzZXMpOwogICAgICAgICAgICBl\nbHNlIGlmIChzZWxzLl9hbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfYWxpYXNlcy5wdXRBbGwoc2Vscy5fYWxpYXNlcyk7CgogICAgICAgICAg\nICBpZiAoX3NlbGVjdEFzID09IG51bGwgJiYgc2Vscy5fc2VsZWN0QXMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9zZWxlY3RBcyA9IG5ldyBIYXNoTWFw\nKHNlbHMuX3NlbGVjdEFzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vscy5f\nc2VsZWN0QXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zZWxlY3RBcy5w\ndXRBbGwoc2Vscy5fc2VsZWN0QXMpOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogUmV0dXJucyB0aGUgYWxpYXMgb2YgYSBnaXZlbiBpZC4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgT2JqZWN0IGdldEFsaWFzKE9i\namVjdCBpZCkgewogICAgICAgICAgICByZXR1cm4gKF9hbGlhc2VzID09IG51\nbGwpID8gbnVsbCA6IF9hbGlhc2VzLmdldChpZCk7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBTZXQgYW4gYWxpYXMgZm9yIGEgZ2l2ZW4g\naWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIGludCBzZXRBbGlhcyhP\nYmplY3QgaWQsIE9iamVjdCBhbGlhcywgYm9vbGVhbiBpZGVudCkgewogICAg\nICAgICAgICBpZiAoX2lkcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBf\naWRzID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgX2FsaWFz\nZXMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpbnQgaWR4OwogICAgICAgICAgICBpZiAoX2FsaWFzZXMucHV0KGlkLCBh\nbGlhcykgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGlkeCA9IF9pZHMuaW5k\nZXhPZihpZCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nX2lkcy5hZGQoaWQpOwogICAgICAgICAgICAgICAgaWR4ID0gX2lkcy5zaXpl\nKCkgLSAxOwoKICAgICAgICAgICAgICAgIGlmIChpZGVudCkgewogICAgICAg\nICAgICAgICAgICAgIGlmIChfaWRlbnRzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9pZGVudHMgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAg\nICAgICAgICAgICAgICAgIF9pZGVudHMuYWRkKGlkKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaWR4Owog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IGFuIGFsaWFz\nIGZvciBhIGdpdmVuIGluZGV4LgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIHNldEFsaWFzKGludCBpZHgsIE9iamVjdCBhbGlhcykgewogICAg\nICAgICAgICBPYmplY3QgaWQgPSBfaWRzLmdldChpZHgpOwogICAgICAgICAg\nICBfYWxpYXNlcy5wdXQoaWQsIGFsaWFzKTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIEluc2VydCBhbiBhbGlhcyBiZWZvcmUgdGhlIGdp\ndmVuIGluZGV4LCB1c2luZyBuZWdhdGl2ZSBpbmRleGVzCiAgICAgICAgICog\ndG8gY291bnQgYmFja3dhcmRzLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIGluc2VydEFsaWFzKGludCBpZHgsIE9iamVjdCBpZCwgT2JqZWN0\nIGFsaWFzKSB7CiAgICAgICAgICAgIF9hbGlhc2VzLnB1dChpZCwgYWxpYXMp\nOwogICAgICAgICAgICBpZiAoaWR4ID49IDApCiAgICAgICAgICAgICAgICBf\naWRzLmFkZChpZHgsIGlkKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgX2lkcy5hZGQoX2lkcy5zaXplKCkgKyBpZHgsIGlkKTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5kZXgg\nb2YgdGhlIGdpdmVuIGFsaWFzLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyBpbnQgaW5kZXhPZkFsaWFzKE9iamVjdCBhbGlhcykgewogICAgICAgICAg\nICBpZiAoX2FsaWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiAtMTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfaWRzLnNp\nemUoKTsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGFsaWFzLmVxdWFscyhf\nYWxpYXNlcy5nZXQoX2lkcy5nZXQoaSkpKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gaTsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogQSBsaXN0IHJlcHJlc2VudGF0aW9u\nIG9mIHRoZSBhbGlhc2VzLCBpbiBzZWxlY3Qgb3JkZXIsIHdpdGgKICAgICAg\nICAgKiBBUyBhbGlhc2VzIHByZXNlbnQuCiAgICAgICAgICovCiAgICAgICAg\ncHVibGljIExpc3QgZ2V0QWxpYXNlcyhmaW5hbCBib29sZWFuIGlkZW50LCBm\naW5hbCBib29sZWFuIGlubmVyKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1Q\nVFlfTElTVDsKCiAgICAgICAgICAgIHJldHVybiBuZXcgQWJzdHJhY3RMaXN0\nKCkgewogICAgICAgICAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAg\nICAgICAgICAgICAgICAgIHJldHVybiAoaWRlbnQgJiYgX2lkZW50cyAhPSBu\ndWxsKSA/IF9pZGVudHMuc2l6ZSgpCiAgICAgICAgICAgICAgICAgICAgICAg\nIDogX2lkcy5zaXplKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgcHVibGljIE9iamVjdCBnZXQoaW50IGkpIHsKICAgICAgICAgICAg\nICAgICAgICBPYmplY3QgaWQgPSAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxs\nKSA/IF9pZGVudHMuZ2V0KGkpCiAgICAgICAgICAgICAgICAgICAgICAgIDog\nX2lkcy5nZXQoaSk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGFsaWFz\nID0gX2FsaWFzZXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\naWQgaW5zdGFuY2VvZiBDb2x1bW4gJiYgKChDb2x1bW4pIGlkKS5pc1hNTCgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBhbGlhcyA9IGFsaWFzICsgX2Rp\nY3QuZ2V0U3RyaW5nVmFsOwogICAgICAgICAgICAgICAgICAgICAgICAKICAg\nICAgICAgICAgICAgICAgICBTdHJpbmcgYXMgPSBudWxsOwogICAgICAgICAg\nICAgICAgICAgIGlmIChpbm5lcikKICAgICAgICAgICAgICAgICAgICAgICAg\nYXMgPSAoKFN0cmluZykgYWxpYXMpLnJlcGxhY2UoJy4nLCAnXycpOwogICAg\nICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9zZWxlY3RBcyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBhcyA9IChTdHJpbmcpIF9zZWxlY3RB\ncy5nZXQoaWQpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoYXMgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnQgJiYgX2lk\nZW50cyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGFzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxpYXMgaW5z\ndGFuY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBhbGlhcyA9IG5ldyBTUUxCdWZmZXIoKFNRTEJ1ZmZlcikgYWxpYXMpLgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZCgiIEFTICIp\nLmFwcGVuZChhcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWFzID0gYWxpYXMgKyAiIEFT\nICIgKyBhczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9OwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0\nIHRoYXQgYSBnaXZlbiBpZCdzIGFsaWFzIGhhcyBhbiBBUyB2YWx1ZS4KICAg\nICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBzZXRTZWxlY3RBcyhPYmpl\nY3QgaWQsIFN0cmluZyBhcykgewogICAgICAgICAgICBpZiAoX3NlbGVjdEFz\nID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2VsZWN0QXMgPSBuZXcgSGFz\naE1hcCgoaW50KSAoNSAqIDEuMzMgKyAxKSk7CiAgICAgICAgICAgIF9zZWxl\nY3RBcy5wdXQoaWQsIGFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIENsZWFyIGFsbCBwbGFjZWhvbGRlcnMgYW5kIHNlbGVjdCBBUyBj\nbGF1c2VzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFy\nUGxhY2Vob2xkZXJzKCkgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgT2JqZWN0\nIGlkOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9pZHMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGlk\nID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChpZCBpbnN0YW5j\nZW9mIFBsYWNlaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgaXRyLnJl\nbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIF9hbGlhc2VzLnJlbW92ZShp\nZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE9iamVjdCBpZCkg\newogICAgICAgICAgICByZXR1cm4gX2FsaWFzZXMgIT0gbnVsbCAmJiBfYWxp\nYXNlcy5jb250YWluc0tleShpZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgT2JqZWN0IGdldChpbnQgaSkgewogICAgICAgICAgICBpZiAoX2lkcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhP\ndXRPZkJvdW5kc0V4Y2VwdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX2lk\ncy5nZXQoaSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUo\nKSB7CiAgICAgICAgICAgIHJldHVybiAoX2lkcyA9PSBudWxsKSA/IDAgOiBf\naWRzLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNs\nZWFyKCkgewogICAgICAgICAgICBfaWRzID0gbnVsbDsKICAgICAgICAgICAg\nX2FsaWFzZXMgPSBudWxsOwogICAgICAgICAgICBfc2VsZWN0QXMgPSBudWxs\nOwogICAgICAgICAgICBfaWRlbnRzID0gbnVsbDsKICAgICAgICB9CiAgICB9\nCn0KCi8qKgogKiBDb21tb24gam9pbnMgaW50ZXJmYWNlIHVzZWQgaW50ZXJu\nYWxseS4gQ2Fubm90IGJlIG1hZGUgYW4gaW5uZXIgY2xhc3MKICogYmVjYXVz\nZSB0aGUgb3V0ZXIgY2xhc3MgKFNlbGVjdCkgaGFzIHRvIGltcGxlbWVudCBp\ndC4KICovCmludGVyZmFjZSBQYXRoSm9pbnMKICAgIGV4dGVuZHMgSm9pbnMg\newoKICAgIC8qKgogICAgICogTWFyayB0aGlzIGFzIGFuIG91dGVyIGpvaW5z\nIHNldC4KICAgICAqLwogICAgcHVibGljIFBhdGhKb2lucyBzZXRPdXRlcihi\nb29sZWFuIG91dGVyKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlm\nIHRoaXMgaW5zdGFuY2UgaGFzIGEgcGF0aCwgYW55IGpvaW5zLCBvciBhIHZh\ncmlhYmxlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCk7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlbGF0aW9uIHBhdGggdHJh\ndmVyc2VkIGJ5IHRoZXNlIGpvaW5zLCBvciBudWxsIGlmIG5vbmUuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmdCdWZmZXIgcGF0aCgpOwoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBzZXQgb2Yge0BsaW5rIEpvaW59IGVsZW1lbnRz\nLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBKb2luU2V0\nIGpvaW5zKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1heGltdW0g\nbnVtYmVyIG9mIGpvaW5zIGNvbnRhaW5lZCBpbiB0aGlzIGluc3RhbmNlIGF0\nIGFueQogICAgICogdGltZS4KICAgICAqLwogICAgcHVibGljIGludCBqb2lu\nQ291bnQoKTsKCiAgICAvKioKICAgICAqIE51bGwgdGhlIHNldCBvZiB7QGxp\nbmsgSm9pbn0gZWxlbWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG51\nbGxKb2lucygpOwp9Cgo=\n","encoding":"base64"}

