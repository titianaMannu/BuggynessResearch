{"sha":"1627d11afbb839732ecedbba7d1645a9997f9823","node_id":"MDQ6QmxvYjIwNjM2NDoxNjI3ZDExYWZiYjgzOTczMmVjZWRiYmE3ZDE2NDVhOTk5N2Y5ODIz","size":14901,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1627d11afbb839732ecedbba7d1645a9997f9823","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlz\nOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5D\nb2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5ldmVudC5SZW1vdGVDb21taXRFdmVudDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5ldmVudC5SZW1vdGVDb21taXRMaXN0ZW5lcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmFi\nbGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxv\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3Vy\ncmVudC5BYnN0cmFjdENvbmN1cnJlbnRFdmVudE1hbmFnZXI7CgppbXBvcnQg\nc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQWJzdHJhY3Qge0BsaW5rIERh\ndGFDYWNoZX0gaW1wbGVtZW50YXRpb24gdGhhdCBwcm92aWRlcyB2YXJpb3Vz\nCiAqIHN0YXRpc3RpY3MsIGxvZ2dpbmcsIGFuZCB0aW1lb3V0IGZ1bmN0aW9u\nYWxpdHkgY29tbW9uIGFjcm9zcyBjYWNoZQogKiBpbXBsZW1lbnRhdGlvbnMu\nCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBhdXRob3IgQWJl\nIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3REYXRh\nQ2FjaGUKICAgIGV4dGVuZHMgQWJzdHJhY3RDb25jdXJyZW50RXZlbnRNYW5h\nZ2VyCiAgICBpbXBsZW1lbnRzIERhdGFDYWNoZSwgQ29uZmlndXJhYmxlIHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBCaXRTZXQgRU1QVFlfQklUU0VU\nID0gbmV3IEJpdFNldCgwKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgc19sb2MgPQogICAgICAgIExvY2FsaXplci5mb3JQYWNrYWdl\nKEFic3RyYWN0RGF0YUNhY2hlLmNsYXNzKTsKCiAgICAvKioKICAgICAqIFRo\nZSBjb25maWd1cmF0aW9uIHNldCBieSB0aGUgc3lzdGVtLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZjsKCiAgICAv\nKioKICAgICAqIFRoZSBsb2cgdG8gdXNlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgTG9nIGxvZzsKCiAgICBwcml2YXRlIFN0cmluZyBfbmFtZSA9IG51bGw7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2Nsb3NlZCA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBTdHJpbmcgX3NjaGVkdWxlID0gbnVsbDsKICAgIAogICAgcHJvdGVj\ndGVkIFNldDxTdHJpbmc+IF9pbmNsdWRlZFR5cGVzOwogICAgcHJvdGVjdGVk\nIFNldDxTdHJpbmc+IF9leGNsdWRlZFR5cGVzOwoKICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gX25hbWU7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0TmFtZShTdHJpbmcgbmFtZSkgewogICAgICAg\nIF9uYW1lID0gbmFtZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldEV2\naWN0aW9uU2NoZWR1bGUoKSB7CiAgICAgICAgcmV0dXJuIF9zY2hlZHVsZTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFdmljdGlvblNjaGVkdWxlKFN0\ncmluZyBzKSB7CiAgICAgICAgX3NjaGVkdWxlID0gczsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBpbml0aWFsaXplKERhdGFDYWNoZU1hbmFnZXIgbWFuYWdl\ncikgewogICAgICAgIGlmIChfc2NoZWR1bGUgIT0gbnVsbCAmJiAhIiIuZXF1\nYWxzKF9zY2hlZHVsZSkpIHsKICAgICAgICAgICAgRGF0YUNhY2hlU2NoZWR1\nbGVyIHNjaGVkdWxlciA9IG1hbmFnZXIuZ2V0RGF0YUNhY2hlU2NoZWR1bGVy\nKCk7CiAgICAgICAgICAgIGlmIChzY2hlZHVsZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZUV2aWN0aW9uKHRoaXMsIF9z\nY2hlZHVsZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNv\nbW1pdChDb2xsZWN0aW9uIGFkZGl0aW9ucywgQ29sbGVjdGlvbiBuZXdVcGRh\ndGVzLAogICAgICAgIENvbGxlY3Rpb24gZXhpc3RpbmdVcGRhdGVzLCBDb2xs\nZWN0aW9uIGRlbGV0ZXMpIHsKICAgICAgICAvLyByZW1vdmUgYWxsIG9iamVj\ndHMgaW4gZGVsZXRlcyBsaXN0CiAgICAgICAgcmVtb3ZlQWxsSW50ZXJuYWwo\nZGVsZXRlcyk7CgogICAgICAgIC8vIG5leHQsIGFkZCBhbGwgdGhlIG5ldyBh\nZGRpdGlvbnMKICAgICAgICBwdXRBbGxJbnRlcm5hbChhZGRpdGlvbnMpOwog\nICAgICAgIHB1dEFsbEludGVybmFsKG5ld1VwZGF0ZXMpOwoKICAgICAgICAv\nLyBwb3NzaWJseSBhZGQgdGhlIGV4aXN0aW5nIHVwZGF0ZXMsIGRlcGVuZGlu\nZyBvbiB0aGUKICAgICAgICAvLyBzZW1hbnRpY3Mgb2YgdGhlIGNhY2hlLCBh\ncyBkaWN0YXRlZCBieSByZWNhY2hlVXBkYXRlcygpCiAgICAgICAgaWYgKHJl\nY2FjaGVVcGRhdGVzKCkpCiAgICAgICAgICAgIHB1dEFsbEludGVybmFsKGV4\naXN0aW5nVXBkYXRlcyk7CgogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJs\nZWQoKSkgewogICAgICAgICAgICBDb2xsZWN0aW9uIGFkZElkcyA9IG5ldyBB\ncnJheUxpc3QoYWRkaXRpb25zLnNpemUoKSk7CiAgICAgICAgICAgIENvbGxl\nY3Rpb24gdXBJZHMgPSBuZXcgQXJyYXlMaXN0KG5ld1VwZGF0ZXMuc2l6ZSgp\nKTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBleElkcyA9IG5ldyBBcnJheUxp\nc3QoZXhpc3RpbmdVcGRhdGVzLnNpemUoKSk7CgogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ZXIgPSBhZGRpdGlvbnMuaXRlcmF0b3IoKTsgaXRlci5o\nYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgYWRkSWRzLmFkZCgoKERhdGFD\nYWNoZVBDRGF0YSkgaXRlci5uZXh0KCkpLmdldElkKCkpOwogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBuZXdVcGRhdGVzLml0ZXJhdG9yKCk7\nIGl0ZXIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgIHVwSWRzLmFkZCgo\nKERhdGFDYWNoZVBDRGF0YSkgaXRlci5uZXh0KCkpLmdldElkKCkpOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBleGlzdGluZ1VwZGF0ZXMu\naXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAg\nZXhJZHMuYWRkKCgoRGF0YUNhY2hlUENEYXRhKSBpdGVyLm5leHQoKSkuZ2V0\nSWQoKSk7CgogICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNo\nZS1jb21taXQiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhZGRJ\nZHMsIHVwSWRzLCBleElkcywgZGVsZXRlcyB9KSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE9iamVjdCBrZXkpIHsK\nICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgbyA9IGdldEludGVybmFsKGtleSk7\nCiAgICAgICAgaWYgKG8gIT0gbnVsbCAmJiBvLmlzVGltZWRPdXQoKSkgewog\nICAgICAgICAgICBvID0gbnVsbDsKICAgICAgICAgICAgcmVtb3ZlSW50ZXJu\nYWwoa2V5KTsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUt\ndGltZW91dCIsIGtleSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbyAh\nPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgY29udGFpbnNBbGwo\nQ29sbGVjdGlvbiBrZXlzKSB7CiAgICAgICAgaWYgKGtleXMuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm4gRU1QVFlfQklUU0VUOwoKICAgICAgICBC\naXRTZXQgc2V0ID0gbmV3IEJpdFNldChrZXlzLnNpemUoKSk7CiAgICAgICAg\naW50IGkgPSAwOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IGtleXMu\naXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7IGkrKykKICAgICAgICAgICAg\naWYgKGNvbnRhaW5zKGl0ZXIubmV4dCgpKSkKICAgICAgICAgICAgICAgIHNl\ndC5zZXQoaSk7CiAgICAgICAgcmV0dXJuIHNldDsKICAgIH0KCiAgICBwdWJs\naWMgRGF0YUNhY2hlUENEYXRhIGdldChPYmplY3Qga2V5KSB7CiAgICAgICAg\nRGF0YUNhY2hlUENEYXRhIG8gPSBnZXRJbnRlcm5hbChrZXkpOwogICAgICAg\nIGlmIChvICE9IG51bGwgJiYgby5pc1RpbWVkT3V0KCkpIHsKICAgICAgICAg\nICAgbyA9IG51bGw7CiAgICAgICAgICAgIHJlbW92ZUludGVybmFsKGtleSk7\nCiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXRpbWVvdXQi\nLCBrZXkpKTsKICAgICAgICB9CgogICAgICAgIGlmIChsb2cuaXNUcmFjZUVu\nYWJsZWQoKSkgewogICAgICAgICAgICBpZiAobyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtbWlzcyIsIGtl\neSkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsb2cudHJh\nY2Uoc19sb2MuZ2V0KCJjYWNoZS1oaXQiLCBrZXkpKTsKICAgICAgICB9Cgog\nICAgICAgIHJldHVybiBvOwogICAgfQoKICAgIHB1YmxpYyBEYXRhQ2FjaGVQ\nQ0RhdGEgcHV0KERhdGFDYWNoZVBDRGF0YSBkYXRhKSB7CiAgICAgICAgRGF0\nYUNhY2hlUENEYXRhIG8gPSBwdXRJbnRlcm5hbChkYXRhLmdldElkKCksIGRh\ndGEpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcHV0IiwgZGF0YS5n\nZXRJZCgpKSk7CiAgICAgICAgcmV0dXJuIChvID09IG51bGwgfHwgby5pc1Rp\nbWVkT3V0KCkpID8gbnVsbCA6IG87CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndXBkYXRlKERhdGFDYWNoZVBDRGF0YSBkYXRhKSB7CiAgICAgICAgaWYgKHJl\nY2FjaGVVcGRhdGVzKCkpCiAgICAgICAgICAgIHB1dEludGVybmFsKGRhdGEu\nZ2V0SWQoKSwgZGF0YSk7CiAgICB9CgogICAgcHVibGljIERhdGFDYWNoZVBD\nRGF0YSByZW1vdmUoT2JqZWN0IGtleSkgewogICAgICAgIERhdGFDYWNoZVBD\nRGF0YSBvID0gcmVtb3ZlSW50ZXJuYWwoa2V5KTsKICAgICAgICBpZiAobyAh\nPSBudWxsICYmIG8uaXNUaW1lZE91dCgpKQogICAgICAgICAgICBvID0gbnVs\nbDsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAg\nICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGxvZy50cmFj\nZShzX2xvYy5nZXQoImNhY2hlLXJlbW92ZS1taXNzIiwga2V5KSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5n\nZXQoImNhY2hlLXJlbW92ZS1oaXQiLCBrZXkpKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG87CiAgICB9CgogICAgcHVibGljIEJpdFNldCByZW1vdmVB\nbGwoQ29sbGVjdGlvbiBrZXlzKSB7CiAgICAgICAgaWYgKGtleXMuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gRU1QVFlfQklUU0VUOwoKICAgICAg\nICBCaXRTZXQgc2V0ID0gbmV3IEJpdFNldChrZXlzLnNpemUoKSk7CiAgICAg\nICAgaW50IGkgPSAwOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IGtl\neXMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7IGkrKykKICAgICAgICAg\nICAgaWYgKHJlbW92ZShpdGVyLm5leHQoKSkgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHNldC5zZXQoaSk7CiAgICAgICAgcmV0dXJuIHNldDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgb2JqZWN0cyBvZiB0aGUgZ2l2\nZW4gY2xhc3MgZnJvbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHJlbW92ZUFsbChDbGFzcyBjbHMsIGJvb2xlYW4gc3ViQ2xhc3Nlcykg\newogICAgICAgIHJlbW92ZUFsbEludGVybmFsKGNscywgc3ViQ2xhc3Nlcyk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gcGluKE9iamVjdCBrZXkpIHsK\nICAgICAgICBib29sZWFuIGJvb2wgPSBwaW5JbnRlcm5hbChrZXkpOwogICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBp\nZiAoYm9vbCkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQo\nImNhY2hlLXBpbi1oaXQiLCBrZXkpKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcGluLW1p\nc3MiLCBrZXkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJvb2w7CiAg\nICB9CgogICAgcHVibGljIEJpdFNldCBwaW5BbGwoQ29sbGVjdGlvbiBrZXlz\nKSB7CiAgICAgICAgaWYgKGtleXMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gRU1QVFlfQklUU0VUOwoKICAgICAgICBCaXRTZXQgc2V0ID0gbmV3\nIEJpdFNldChrZXlzLnNpemUoKSk7CiAgICAgICAgaW50IGkgPSAwOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IGtleXMuaXRlcmF0b3IoKTsgaXRl\nci5oYXNOZXh0KCk7IGkrKykKICAgICAgICAgICAgaWYgKHBpbihpdGVyLm5l\neHQoKSkpCiAgICAgICAgICAgICAgICBzZXQuc2V0KGkpOwogICAgICAgIHJl\ndHVybiBzZXQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgcGluQWxsKENsYXNz\nIGNscywgYm9vbGVhbiBzdWJzKSB7CiAgICAgICAgaWYgKGxvZy5pc1dhcm5F\nbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy53YXJuKHNfbG9jLmdldCgiY2Fj\naGUtY2xhc3MtcGluIiwgZ2V0TmFtZSgpKSk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gdW5waW4oT2JqZWN0IGtleSkgewogICAgICAgIGJvb2xlYW4g\nYm9vbCA9IHVucGluSW50ZXJuYWwoa2V5KTsKICAgICAgICBpZiAobG9nLmlz\nVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgaWYgKGJvb2wpCiAgICAg\nICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS11bnBpbi1o\naXQiLCBrZXkpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtdW5waW4tbWlzcyIsIGtleSkp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYm9vbDsKICAgIH0KCiAgICBw\ndWJsaWMgQml0U2V0IHVucGluQWxsKENvbGxlY3Rpb24ga2V5cykgewogICAg\nICAgIGlmIChrZXlzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVN\nUFRZX0JJVFNFVDsKCiAgICAgICAgQml0U2V0IHNldCA9IG5ldyBCaXRTZXQo\na2V5cy5zaXplKCkpOwogICAgICAgIGludCBpID0gMDsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ZXIgPSBrZXlzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4\ndCgpOyBpKyspCiAgICAgICAgICAgIGlmICh1bnBpbihpdGVyLm5leHQoKSkp\nCiAgICAgICAgICAgICAgICBzZXQuc2V0KGkpOwogICAgICAgIHJldHVybiBz\nZXQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgdW5waW5BbGwoQ2xhc3MgY2xz\nLCBib29sZWFuIHN1YnMpIHsKICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oc19sb2MuZ2V0KCJjYWNoZS1j\nbGFzcy11bnBpbiIsIGdldE5hbWUoKSkpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGNsZWFyKCkgewogICAgICAgIGNsZWFySW50ZXJuYWwoKTsKICAgICAg\nICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50\ncmFjZShzX2xvYy5nZXQoImNhY2hlLWNsZWFyIiwgZ2V0TmFtZSgpKSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgY2xvc2Uo\ndHJ1ZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xvc2UoYm9vbGVh\nbiBjbGVhcikgewogICAgICAgIGlmICghX2Nsb3NlZCkgewogICAgICAgICAg\nICBpZiAoY2xlYXIpCiAgICAgICAgICAgICAgICBjbGVhckludGVybmFsKCk7\nCiAgICAgICAgICAgIF9jbG9zZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsKICAgICAgICByZXR1\ncm4gX2Nsb3NlZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRFeHBpcmF0\naW9uTGlzdGVuZXIoRXhwaXJhdGlvbkxpc3RlbmVyIGxpc3RlbikgewogICAg\nICAgIGFkZExpc3RlbmVyKGxpc3Rlbik7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gcmVtb3ZlRXhwaXJhdGlvbkxpc3RlbmVyKEV4cGlyYXRpb25MaXN0\nZW5lciBsaXN0ZW4pIHsKICAgICAgICByZXR1cm4gcmVtb3ZlTGlzdGVuZXIo\nbGlzdGVuKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkg\newogICAgICAgIHJldHVybiAiWyIgKyBzdXBlci50b1N0cmluZygpICsgIjoi\nICsgX25hbWUgKyAiXSI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1l\ndGhvZCBpcyBwYXJ0IG9mIHRoZSB7QGxpbmsgUmVtb3RlQ29tbWl0TGlzdGVu\nZXJ9IGludGVyZmFjZS4gSWYKICAgICAqIHlvdXIgY2FjaGUgc3ViY2xhc3Mg\ncmVsaWVzIG9uIE9wZW5KUEEgZm9yIGNsdXN0ZXJpbmcgc3VwcG9ydCwgbWFr\nZSBpdAogICAgICogaW1wbGVtZW50IDxjb2RlPlJlbW90ZUNvbW1pdExpc3Rl\nbmVyPC9jb2RlPi4gVGhpcyBtZXRob2Qgd2lsbCB0YWtlCiAgICAgKiBjYXJl\nIG9mIGludmFsaWRhdGluZyBlbnRyaWVzIGZyb20gcmVtb3RlIGNvbW1pdHMu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29tbWl0KFJlbW90ZUNv\nbW1pdEV2ZW50IGV2ZW50KSB7CiAgICAgICAgaWYgKF9jbG9zZWQpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGV2ZW50LmdldFBheWxvYWRU\neXBlKCkgPT0gUmVtb3RlQ29tbWl0RXZlbnQuUEFZTE9BRF9FWFRFTlRTKSB7\nCiAgICAgICAgICAgIHJlbW92ZUFsbFR5cGVOYW1lc0ludGVybmFsKGV2ZW50\nLmdldFVwZGF0ZWRUeXBlTmFtZXMoKSk7CiAgICAgICAgICAgIHJlbW92ZUFs\nbFR5cGVOYW1lc0ludGVybmFsKGV2ZW50LmdldERlbGV0ZWRUeXBlTmFtZXMo\nKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gZHJvcCBhbGwg\ndGhlIGNvbW1pdHRlZCBPSURzLCBleGNlcHRpbmcgYnJhbmQKICAgICAgICAg\nICAgLy8gbmV3IE9JRHMuIGJyYW5kIG5ldyBPSURzIGVpdGhlciB3b24ndCBi\nZSBpbgogICAgICAgICAgICAvLyB0aGUgY2FjaGUsIG9yIGlmIHRoZXkgYXJl\nLCB3aWxsIGJlIG1vcmUgdXAgdG8gZGF0ZQogICAgICAgICAgICByZW1vdmVB\nbGxJbnRlcm5hbChldmVudC5nZXRVcGRhdGVkT2JqZWN0SWRzKCkpOwogICAg\nICAgICAgICByZW1vdmVBbGxJbnRlcm5hbChldmVudC5nZXREZWxldGVkT2Jq\nZWN0SWRzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElu\ndm9rZSB3aGVuIGEga2V5IGlzIHJlbW92ZWQgZnJvbSB0aGlzIGNhY2hlLiBQ\ncm9wYWdhdGVzIHRoZQogICAgICogZXhwaXJhdGlvbiBldmVudCBvbiB0byBh\nbGwgZXhwaXJhdGlvbiBsaXN0ZW5lcnMgcmVnaXN0ZXJlZAogICAgICogd2l0\naCB0aGlzIGNsYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBrZXlS\nZW1vdmVkKE9iamVjdCBrZXksIGJvb2xlYW4gZXhwaXJlZCkgewogICAgICAg\nIC8vIE5vdGlmeSBhbnkgZXhwaXJhdGlvbiBsaXN0ZW5lcnMgb2YgdGhlIGV4\ncGlyYXRpb24uCiAgICAgICAgaWYgKGhhc0xpc3RlbmVycygpKQogICAgICAg\nICAgICBmaXJlRXZlbnQobmV3IEV4cGlyYXRpb25FdmVudCh0aGlzLCBrZXks\nIGV4cGlyZWQpKTsKCiAgICAgICAgaWYgKGV4cGlyZWQgJiYgbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQo\nImNhY2hlLWV4cGlyZWQiLCBrZXkpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiA8Y29kZT50cnVlPC9jb2RlPiBpZiB1cGRhdGVzIHRvIGRhdGEg\nYWxyZWFkeSBpbiB0aGUKICAgICAqIGNhY2hlIChlaXRoZXIgaW4ge0BsaW5r\nICNjb21taXR9IG9yIHRoZSB7QGxpbmsgI3VwZGF0ZX0pCiAgICAgKiBzaG91\nbGQgYmUgcHV0IGJhY2sgaW50byB0aGUgY2FjaGUuIFJldHVybnMgZmFsc2Ug\nYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gcmVj\nYWNoZVVwZGF0ZXMoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBvYmplY3QgZm9yIHRoZSBnaXZl\nbiBvaWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBEYXRhQ2Fj\naGVQQ0RhdGEgZ2V0SW50ZXJuYWwoT2JqZWN0IG9pZCk7CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGdpdmVuIG9iamVjdCB0byB0aGUgY2FjaGUsIHJldHVy\nbmluZyB0aGUgb2xkIG9iamVjdCB1bmRlciB0aGUKICAgICAqIGdpdmVuIG9p\nZC4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IERhdGFDYWNoZVBD\nRGF0YSBwdXRJbnRlcm5hbChPYmplY3Qgb2lkLAogICAgICAgIERhdGFDYWNo\nZVBDRGF0YSBwYyk7CgogICAgLyoqCiAgICAgKiBBbGwgYWxsIG9mIHRoZSBn\naXZlbiBvYmplY3RzIHRvIHRoZSBjYWNoZS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgcHV0QWxsSW50ZXJuYWwoQ29sbGVjdGlvbiBwY3MpIHsKICAg\nICAgICBEYXRhQ2FjaGVQQ0RhdGEgcGM7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdGVyID0gcGNzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICBwYyA9IChEYXRhQ2FjaGVQQ0RhdGEpIGl0ZXIubmV4dCgp\nOwogICAgICAgICAgICBwdXRJbnRlcm5hbChwYy5nZXRJZCgpLCBwYyk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBvYmpl\nY3QgdW5kZXIgdGhlIGdpdmVuIG9pZCBmcm9tIHRoZSBjYWNoZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IERhdGFDYWNoZVBDRGF0YSByZW1v\ndmVJbnRlcm5hbChPYmplY3Qgb2lkKTsKCiAgICAvKioKICAgICAqIEV2aWN0\nIG9iamVjdHMgaW4gY2FjaGUgYnkgY2xhc3MuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBhYnN0cmFjdCB2b2lkIHJlbW92ZUFsbEludGVybmFsKENsYXNzIGNs\ncywgYm9vbGVhbiBzdWJjbGFzc2VzKTsKCiAgICAvKioKICAgICAqIFJlbW92\nZSBhbGwgb2JqZWN0cyB1bmRlciB0aGUgZ2l2ZW4gb2lkcyBmcm9tIHRoZSBj\nYWNoZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVtb3ZlQWxsSW50\nZXJuYWwoQ29sbGVjdGlvbiBvaWRzKSB7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdGVyID0gb2lkcy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTspCiAg\nICAgICAgICAgIHJlbW92ZUludGVybmFsKGl0ZXIubmV4dCgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZSBhbGwgb2JqZWN0cyBvZiB0aGUgZ2l2\nZW4gY2xhc3MgbmFtZXMgZnJvbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIHJlbW92ZUFsbFR5cGVOYW1lc0ludGVybmFsKENvbGxl\nY3Rpb24gY2xhc3NOYW1lcykgewogICAgICAgIENvbGxlY3Rpb24gY2xhc3Nl\ncyA9IENhY2hlcy5hZGRUeXBlc0J5TmFtZShjb25mLCBjbGFzc05hbWVzLCBu\ndWxsKTsKICAgICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIENsYXNzIGNsczsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ZXIgPSBjbGFzc2VzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBjbHMgPSAoQ2xhc3MpIGl0ZXIubmV4dCgp\nOwogICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1yZW1vdmVj\nbGFzcyIsIGNscy5nZXROYW1lKCkpKTsKICAgICAgICAgICAgcmVtb3ZlQWxs\nSW50ZXJuYWwoY2xzLCBmYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQ2xlYXIgdGhlIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgYWJzdHJhY3Qgdm9pZCBjbGVhckludGVybmFsKCk7CgogICAgLyoqCiAg\nICAgKiBQaW4gYW4gb2JqZWN0IHRvIHRoZSBjYWNoZS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGFic3RyYWN0IGJvb2xlYW4gcGluSW50ZXJuYWwoT2JqZWN0\nIG9pZCk7CgogICAgLyoqCiAgICAgKiBVbnBpbiBhbiBvYmplY3QgZnJvbSB0\naGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBib29s\nZWFuIHVucGluSW50ZXJuYWwoT2JqZWN0IG9pZCk7CgogICAgLy8gLS0tLS0t\nLS0tLSBDb25maWd1cmFibGUgaW1wbGVtZW50YXRpb24gLS0tLS0tLS0tLQoK\nICAgIHB1YmxpYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlv\nbiBjb25mKSB7CiAgICAgICAgdGhpcy5jb25mID0gKE9wZW5KUEFDb25maWd1\ncmF0aW9uKSBjb25mOwogICAgICAgIHRoaXMubG9nID0gY29uZi5nZXRMb2co\nT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0RBVEFDQUNIRSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RhcnRDb25maWd1cmF0aW9uKCkgewogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAg\naWYgKF9uYW1lID09IG51bGwpCiAgICAgICAgICAgIHNldE5hbWUoTkFNRV9E\nRUZBVUxUKTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tIEFic3RyYWN0RXZl\nbnRNYW5hZ2VyIGltcGxlbWVudGF0aW9uIC0tLS0tLS0tLS0KCiAgICBwcm90\nZWN0ZWQgdm9pZCBmaXJlRXZlbnQoT2JqZWN0IGV2ZW50LCBPYmplY3QgbGlz\ndGVuZXIpIHsKICAgICAgICBFeHBpcmF0aW9uTGlzdGVuZXIgbGlzdGVuID0g\nKEV4cGlyYXRpb25MaXN0ZW5lcikgbGlzdGVuZXI7CiAgICAgICAgRXhwaXJh\ndGlvbkV2ZW50IGV2ID0gKEV4cGlyYXRpb25FdmVudCkgZXZlbnQ7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgbGlzdGVuLm9uRXhwaXJlKGV2KTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAo\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJu\nKHNfbG9jLmdldCgiZXhwLWxpc3RlbmVyLWV4IiksIGUpOwoJCX0KCX0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIG9iamVjdHMgZm9yIHRoZSBnaXZl\nbiBrZXkgTGlzdC4KICAgICAqLwogICAgcHVibGljIE1hcCBnZXRBbGwoTGlz\ndCBrZXlzKSB7CiAgICAgICAgTWFwIHJlc3VsdE1hcCA9IG5ldyBIYXNoTWFw\nKGtleXMuc2l6ZSgpKTsKICAgICAgICBmb3IoaW50IGk9MDsgaTxrZXlzLnNp\nemUoKTsgaSsrKQogICAgICAgICAgICByZXN1bHRNYXAucHV0KGtleXMuZ2V0\nKGkpLCBnZXQoa2V5cy5nZXQoaSkpKTsKICAgICAgICByZXR1cm4gcmVzdWx0\nTWFwOwogICAgfQogICAgCiAgICBwdWJsaWMgU2V0PFN0cmluZz4gZ2V0VHlw\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9pbmNsdWRlZFR5cGVzOwogICAgfQog\nICAgCiAgICBwdWJsaWMgU2V0PFN0cmluZz4gZ2V0RXhjbHVkZWRUeXBlcygp\nIHsKICAgICAgICByZXR1cm4gX2V4Y2x1ZGVkVHlwZXM7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0VHlwZXMoU2V0PFN0cmluZz4gdHlwZXMpIHsKICAg\nICAgICBfaW5jbHVkZWRUeXBlcyA9IHR5cGVzOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFR5cGVzKFN0cmluZyB0eXBlcykgewogICAgICAgIF9pbmNs\ndWRlZFR5cGVzID0KICAgICAgICAgICAgU3RyaW5nVXRpbHMuaXNFbXB0eSh0\neXBlcykgPyBudWxsIDogbmV3IEhhc2hTZXQ8U3RyaW5nPihBcnJheXMKICAg\nICAgICAgICAgICAgIC5hc0xpc3QoU3RyaW5ncy5zcGxpdCh0eXBlcywgIjsi\nLCAwKSkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEV4Y2x1ZGVkVHlw\nZXMoU2V0PFN0cmluZz4gdHlwZXMpIHsKICAgICAgICBfZXhjbHVkZWRUeXBl\ncyA9IHR5cGVzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEV4Y2x1ZGVk\nVHlwZXMoU3RyaW5nIHR5cGVzKSB7CiAgICAgICAgX2V4Y2x1ZGVkVHlwZXMg\nPQogICAgICAgICAgICBTdHJpbmdVdGlscy5pc0VtcHR5KHR5cGVzKSA/IG51\nbGwgOiBuZXcgSGFzaFNldDxTdHJpbmc+KEFycmF5cwogICAgICAgICAgICAg\nICAgLmFzTGlzdChTdHJpbmdzLnNwbGl0KHR5cGVzLCAiOyIsIDApKSk7CiAg\nICB9Cn0K\n","encoding":"base64"}

