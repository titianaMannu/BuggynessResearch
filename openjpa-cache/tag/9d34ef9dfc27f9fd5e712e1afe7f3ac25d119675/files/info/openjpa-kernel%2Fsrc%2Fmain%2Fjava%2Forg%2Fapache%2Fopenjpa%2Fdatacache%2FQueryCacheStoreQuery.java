{"sha":"6b615df8cdbf5c8dcba5c3e6545049241f378ecf","node_id":"MDQ6QmxvYjIwNjM2NDo2YjYxNWRmOGNkYmY1YzhkY2JhNWMzZTY1NDUwNDkyNDFmMzc4ZWNm","size":21880,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6b615df8cdbf5c8dcba5c3e6545049241f378ecf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2NrTGV2ZWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3Jl\nQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3Rv\ncmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIucm9wLkxpc3RSZXN1bHRPYmplY3RQcm92aWRlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVj\ndFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xh\nc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkph\ndmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFE\nYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5O\ndW1iZXJzOwoKLyoqCiAqIEEge0BsaW5rIFN0b3JlUXVlcnl9IGltcGxlbWVu\ndGF0aW9uIHRoYXQgY2FjaGVzIHRoZSBPSURzIGludm9sdmVkIGluCiAqIHRo\nZSBxdWVyeSwgYW5kIGNhbiBkZXRlcm1pbmUgd2hldGhlciBvciBub3QgdGhl\nIHF1ZXJ5IGhhcyBiZWVuIGRpcnRpZWQuCiAqCiAqIEBhdXRob3IgUGF0cmlj\nayBMaW5za2V5CiAqIEBzaW5jZSAwLjIuNS4wCiAqLwpwdWJsaWMgY2xhc3Mg\nUXVlcnlDYWNoZVN0b3JlUXVlcnkKICAgIGltcGxlbWVudHMgU3RvcmVRdWVy\neSB7CgogICAgcHJpdmF0ZSBmaW5hbCBTdG9yZVF1ZXJ5IF9xdWVyeTsKICAg\nIHByaXZhdGUgZmluYWwgUXVlcnlDYWNoZSBfY2FjaGU7CiAgICBwcml2YXRl\nIFN0b3JlQ29udGV4dCBfc2N0eDsKICAgIHByaXZhdGUgTWV0YURhdGFSZXBv\nc2l0b3J5IF9yZXBvczsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBp\nbnN0YW5jZSB0aGF0IGRlbGVnYXRlcyB0byA8Y29kZT5xdWVyeTwvY29kZT4g\naWYgbm8KICAgICAqIGNhY2hlZCByZXN1bHRzIGFyZSBhdmFpbGFibGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBRdWVyeUNhY2hlU3RvcmVRdWVyeShTdG9yZVF1\nZXJ5IHF1ZXJ5LCBRdWVyeUNhY2hlIGNhY2hlKSB7CiAgICAgICAgX3F1ZXJ5\nID0gcXVlcnk7CiAgICAgICAgX2NhY2hlID0gY2FjaGU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHtAbGluayBRdWVyeUNhY2hlfSB0aGF0\nIHRoaXMgb2JqZWN0IGlzIGFzc29jaWF0ZWQgd2l0aC4KICAgICAqLwogICAg\ncHVibGljIFF1ZXJ5Q2FjaGUgZ2V0Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9jYWNoZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlLgogICAg\nICovCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBnZXREZWxlZ2F0ZSgpIHsKICAg\nICAgICByZXR1cm4gX3F1ZXJ5OwogICAgfQoKICAgIC8qKgogICAgICogTG9v\nayBpbiB0aGUgcXVlcnkgY2FjaGUgZm9yIGEgcmVzdWx0IGZvciB0aGUgZ2l2\nZW4gcXVlcnkKICAgICAqIGtleS4gT25seSBsb29rIGlmIHRoaXMgcXVlcnkg\naXMgYmVpbmcgZXhlY3V0ZWQgb3V0c2lkZSBhCiAgICAgKiB0cmFuc2FjdGlv\nbiBvciBpbiBhIHRyYW5zYWN0aW9uIHdpdGggSWdub3JlQ2hhbmdlcyBzZXQg\ndG8gdHJ1ZQogICAgICogb3IgaW4gYSB0cmFuc2FjdGlvbiB3aXRoIElnbm9y\nZUNoYW5nZXMgc2V0IHRvIGZhbHNlIGJ1dCBpbiB3aGljaAogICAgICogbm9u\nZSBvZiB0aGUgY2xhc3NlcyBpbnZvbHZlZCBpbiB0aGlzIHF1ZXJ5IGhhdmUg\nYmVlbiB0b3VjaGVkLgogICAgICogIENhY2hpbmcgaXMgbm90IHVzZWQgd2hl\nbiB1c2luZyBvYmplY3QgbG9ja2luZy4KICAgICAqIFRoaXMgaXMgYmVjYXVz\nZSB3ZSBtdXN0IG9idGFpbiBsb2NrcyBvbiB0aGUKICAgICAqIGRhdGEsIGFu\nZCBpdCBpcyBsaWtlbHkgdGhhdCBtYWtpbmcgbiB0cmlwcyB0byB0aGUgZGF0\nYWJhc2UgdG8KICAgICAqIG1ha2UgdGhlIGxvY2tzIHdpbGwgYmUgc2xvd2Vy\nIHRoYW4gcnVubmluZyB0aGUgcXVlcnkgYWdhaW5zdAogICAgICogdGhlIGRh\ndGFiYXNlLgogICAgICogIElmIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uIGhh\ncyBxdWVyeSBjYWNoaW5nIGRpc2FibGVkLAogICAgICogdGhlbiB0aGlzIG1l\ndGhvZCByZXR1cm5zIDxjb2RlPm51bGw8L2NvZGU+LgogICAgICogIFJldHVy\nbiB0aGUgbGlzdCBpZiB3ZSBtZWV0IHRoZSBhYm92ZSBjcml0ZXJpYSBhbmQg\naWYgYSBsaXN0CiAgICAgKiBpcyBmb3VuZCBmb3IgPGNvZGU+cWs8L2NvZGU+\nLiBFbHNlLCByZXR1cm4KICAgICAqIDxjb2RlPm51bGw8L2NvZGU+LgogICAg\nICogIFRoaXMgaW1wbGVtZW50YXRpb24gbWVhbnMgdGhhdCBxdWVyaWVzIGFn\nYWluc3QgdGhlIGNhY2hlCiAgICAgKiBhcmUgb2YgUkVBRF9DT01NSVRURUQg\naXNvbGF0aW9uIGxldmVsLiBJdCdkIGJlIG5pY2UgdG8gc3VwcG9ydAogICAg\nICogUkVBRF9TRVJJQUxJWkFCTEUgLS0gdG8gZG8gc28sIHdlJ2QganVzdCBy\nZXR1cm4gZmFsc2Ugd2hlbiBpbgogICAgICogYSB0cmFuc2FjdGlvbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBMaXN0IGNoZWNrQ2FjaGUoUXVlcnlLZXkgcWsp\nIHsKICAgICAgICBpZiAocWsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoID0gZ2V0\nQ29udGV4dCgpLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIGlm\nICghZmV0Y2guZ2V0UXVlcnlDYWNoZUVuYWJsZWQoKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGZldGNoLmdldFJlYWRMb2NrTGV2\nZWwoKSA+IExvY2tMZXZlbHMuTE9DS19OT05FKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgLy8gZ2V0IHRoZSBjYWNoZWQgZGF0YQogICAg\nICAgIFF1ZXJ5UmVzdWx0IHJlcyA9IF9jYWNoZS5nZXQocWspOwogICAgICAg\nIGlmIChyZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKHJlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICBpbnQgcHJvanMgPSBn\nZXRDb250ZXh0KCkuZ2V0UHJvamVjdGlvbkFsaWFzZXMoKS5sZW5ndGg7CiAg\nICAgICAgaWYgKHByb2pzID09IDApIHsKICAgICAgICAgICAgLy8gbWFrZSBz\ndXJlIHRoZSBkYXRhIGNhY2hlIGNvbnRhaW5zIHRoZSBvaWRzIGZvciB0aGUg\ncXVlcnkgcmVzdWx0OwogICAgICAgICAgICAvLyBpZiBpdCBkb2Vzbid0LCB0\naGVuIHVzaW5nIHRoZSByZXN1bHQgY291bGQgYmUgc2xvd2VyIHRoYW4gbm90\nCiAgICAgICAgICAgIC8vIHVzaW5nIGl0IGJlY2F1c2Ugb2YgdGhlIGluZGl2\naWR1YWwgYnktb2lkIGxvb2t1cHMKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gX3JlcG9zLmdldE1ldGFEYXRhKGdldENvbnRleHQoKS4KICAg\nICAgICAgICAgICAgIGdldENhbmRpZGF0ZVR5cGUoKSwgX3NjdHguZ2V0Q2xh\nc3NMb2FkZXIoKSwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChtZXRhLmdldERh\ndGFDYWNoZSgpID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgICAgIEJpdFNldCBpZHhzID0gbWV0YS5nZXREYXRhQ2Fj\naGUoKS5jb250YWluc0FsbChyZXMpOwoKICAgICAgICAgICAgLy8gZXZlbnR1\nYWxseSB3ZSBzaG91bGQgb3B0aW1pemUgdGhpcyB0byBmaWd1cmUgb3V0IGhv\ndyBtYW55IG9iamVjdHMKICAgICAgICAgICAgLy8gdGhlIGNhY2hlIGlzIG1p\nc3NpbmcgYW5kIGlmIG9ubHkgYSBmZXcgZG8gYSBidWxrIGZldGNoIGZvciB0\naGVtCiAgICAgICAgICAgIGludCBsZW4gPSBpZHhzLmxlbmd0aCgpOwogICAg\nICAgICAgICBpZiAobGVuIDwgcmVzLnNpemUoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGxlbjsgaSsrKQogICAgICAgICAgICAgICAgaWYgKCFpZHhzLmdldChpKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIG5ldyBDYWNoZWRMaXN0KHJlcywgcHJvanMgIT0gMCwg\nX3NjdHgpOwogICAgfQoKICAgIC8qKgogICAgICogV3JhcCB0aGUgcmVzdWx0\nIG9iamVjdCBwcm92aWRlciByZXR1cm5lZCBieSBvdXIgZGVsZWdhdGUgaW4g\nYQogICAgICogY2FjaGluZyBwcm92aWRlci4KICAgICAqLwogICAgcHJpdmF0\nZSBSZXN1bHRPYmplY3RQcm92aWRlciB3cmFwUmVzdWx0KFJlc3VsdE9iamVj\ndFByb3ZpZGVyIHJvcCwKICAgICAgICBRdWVyeUtleSBrZXkpIHsKICAgICAg\nICBpZiAoa2V5ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiByb3A7CiAg\nICAgICAgcmV0dXJuIG5ldyBDYWNoaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIo\ncm9wLCBnZXRDb250ZXh0KCkuCiAgICAgICAgICAgIGdldFByb2plY3Rpb25B\nbGlhc2VzKCkubGVuZ3RoID4gMCwga2V5KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvcHkgYSBwcm9qZWN0aW9uIGVsZW1lbnQgZm9yIGNhY2hpbmcgLyBy\nZXR1cm5pbmcuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBj\nb3B5UHJvamVjdGlvbihPYmplY3Qgb2JqLCBTdG9yZUNvbnRleHQgY3R4KSB7\nCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBzd2l0Y2ggKEphdmFUeXBlcy5nZXRUeXBlQ29kZShv\nYmouZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09C\nSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLklOVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JK\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk9JRDoKICAgICAgICAgICAgICAgIHJldHVybiBvYmo7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gKChEYXRlKSBvYmopLmNsb25lKCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAgICAgICAgIHJldHVybiAo\nKExvY2FsZSkgb2JqKS5jbG9uZSgpOwogICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIENhY2hlZE9iamVj\ndElkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmcm9tT2JqZWN0SWQo\nKChDYWNoZWRPYmplY3RJZCkgb2JqKS5vaWQsIGN0eCk7CiAgICAgICAgICAg\nICAgICBPYmplY3Qgb2lkID0gY3R4LmdldE9iamVjdElkKG9iaik7CiAgICAg\nICAgICAgICAgICBpZiAob2lkICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBDYWNoZWRPYmplY3RJZChvaWQpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHJlc3VsdCBvYmplY3QgYmFzZWQgb24gaXRzIGNh\nY2hlZCBvaWQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBm\ncm9tT2JqZWN0SWQoT2JqZWN0IG9pZCwgU3RvcmVDb250ZXh0IHNjdHgpIHsK\nICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBPYmplY3Qgb2JqID0gc2N0eC5maW5kKG9pZCwgbnVs\nbCwgbnVsbCwgbnVsbCwgMCk7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24o\nb2lkKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICB0aHJvd3MgT2JqZWN0U3Ry\nZWFtRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5OwogICAgfQoK\nICAgIHB1YmxpYyBRdWVyeUNvbnRleHQgZ2V0Q29udGV4dCgpIHsKICAgICAg\nICByZXR1cm4gX3F1ZXJ5LmdldENvbnRleHQoKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRDb250ZXh0KFF1ZXJ5Q29udGV4dCBxY3R4KSB7CiAgICAg\nICAgX3F1ZXJ5LnNldENvbnRleHQocWN0eCk7CiAgICAgICAgX3NjdHggPSBx\nY3R4LmdldFN0b3JlQ29udGV4dCgpOwogICAgICAgIF9yZXBvcyA9IF9zY3R4\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNldFF1ZXJ5KE9i\namVjdCBxdWVyeSkgewogICAgICAgIHJldHVybiBfcXVlcnkuc2V0UXVlcnko\ncXVlcnkpOwogICAgfQoKICAgIHB1YmxpYyBGaWx0ZXJMaXN0ZW5lciBnZXRG\naWx0ZXJMaXN0ZW5lcihTdHJpbmcgdGFnKSB7CiAgICAgICAgcmV0dXJuIF9x\ndWVyeS5nZXRGaWx0ZXJMaXN0ZW5lcih0YWcpOwogICAgfQoKICAgIHB1Ymxp\nYyBBZ2dyZWdhdGVMaXN0ZW5lciBnZXRBZ2dyZWdhdGVMaXN0ZW5lcihTdHJp\nbmcgdGFnKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5nZXRBZ2dyZWdhdGVM\naXN0ZW5lcih0YWcpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3Q29t\ncGlsYXRpb25LZXkoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5uZXdDb21w\naWxhdGlvbktleSgpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3Q29t\ncGlsYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5uZXdDb21waWxh\ndGlvbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBvcHVsYXRlRnJvbUNv\nbXBpbGF0aW9uKE9iamVjdCBjb21wKSB7CiAgICAgICAgX3F1ZXJ5LnBvcHVs\nYXRlRnJvbUNvbXBpbGF0aW9uKGNvbXApOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGludmFsaWRhdGVDb21waWxhdGlvbigpIHsKICAgICAgICBfcXVlcnku\naW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNEYXRhU3RvcmVFeGVjdXRpb24oKSB7CiAgICAgICAg\ncmV0dXJuIF9xdWVyeS5zdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzSW5NZW1vcnlFeGVj\ndXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zdXBwb3J0c0luTWVt\nb3J5RXhlY3V0aW9uKCk7CiAgICB9CgogICAgcHVibGljIEV4ZWN1dG9yIG5l\nd0luTWVtb3J5RXhlY3V0b3IoQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFu\nIHN1YnMpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lm5ld0luTWVtb3J5RXhl\nY3V0b3IobWV0YSwgc3Vicyk7CiAgICB9CgogICAgcHVibGljIEV4ZWN1dG9y\nIG5ld0RhdGFTdG9yZUV4ZWN1dG9yKENsYXNzTWV0YURhdGEgbWV0YSwgYm9v\nbGVhbiBzdWJzKSB7CiAgICAgICAgRXhlY3V0b3IgZXggPSBfcXVlcnkubmV3\nRGF0YVN0b3JlRXhlY3V0b3IobWV0YSwgc3Vicyk7CiAgICAgICAgcmV0dXJu\nIG5ldyBRdWVyeUNhY2hlRXhlY3V0b3IoZXgsIG1ldGEsIHN1YnMpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQWJzdHJhY3RFeGVjdXRv\ncnMoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zdXBwb3J0c0Fic3RyYWN0\nRXhlY3V0b3JzKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gcmVxdWly\nZXNDYW5kaWRhdGVUeXBlKCkgewogICAgICAgIHJldHVybiBfcXVlcnkucmVx\ndWlyZXNDYW5kaWRhdGVUeXBlKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gcmVxdWlyZXNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKSB7CiAgICAgICAg\ncmV0dXJuIF9xdWVyeS5yZXF1aXJlc1BhcmFtZXRlckRlY2xhcmF0aW9ucygp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUGFyYW1ldGVy\nRGVjbGFyYXRpb25zKCkgewogICAgICAgIHJldHVybiBfcXVlcnkuc3VwcG9y\ndHNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKTsKICAgIH0KIAogICAgcHVibGlj\nIE9iamVjdCBldmFsdWF0ZShPYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2Jq\nZWN0W10gcGFyYW1zLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20p\nIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmV2YWx1YXRlKHZhbHVlLCBvYiwg\ncGFyYW1zLCBzbSk7ICAgICAgICAgCiAgICB9CgogICAgLyoqCiAgICAgKiBD\nYWNoaW5nIGV4ZWN1dG9yLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBRdWVyeUNhY2hlRXhlY3V0b3IKICAgICAgICBpbXBsZW1lbnRzIEV4\nZWN1dG9yIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBFeGVjdXRvciBfZXg7\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBDbGFzcyBfY2FuZGlkYXRlOwogICAg\nICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfc3ViczsKCiAgICAgICAgcHVi\nbGljIFF1ZXJ5Q2FjaGVFeGVjdXRvcihFeGVjdXRvciBleCwgQ2xhc3NNZXRh\nRGF0YSBtZXRhLAogICAgICAgICAgICBib29sZWFuIHN1YnMpIHsKICAgICAg\nICAgICAgX2V4ID0gZXg7CiAgICAgICAgICAgIF9jYW5kaWRhdGUgPSAobWV0\nYSA9PSBudWxsKSA/IG51bGwgOiBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsK\nICAgICAgICAgICAgX3N1YnMgPSBzdWJzOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVRdWVyeShTdG9y\nZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgUmFuZ2Ug\ncmFuZ2UpIHsKICAgICAgICAgICAgUXVlcnlDYWNoZVN0b3JlUXVlcnkgY3Eg\nPSAoUXVlcnlDYWNoZVN0b3JlUXVlcnkpIHE7CiAgICAgICAgICAgIFF1ZXJ5\nS2V5IGtleSA9IFF1ZXJ5S2V5Lm5ld0luc3RhbmNlKGNxLmdldENvbnRleHQo\nKSwKICAgICAgICAgICAgICAgIF9leC5pc1BhY2tpbmcocSksIHBhcmFtcywg\nX2NhbmRpZGF0ZSwgX3N1YnMsIHJhbmdlLnN0YXJ0LCAKICAgICAgICAgICAg\nICAgIHJhbmdlLmVuZCk7CiAgICAgICAgICAgIExpc3QgY2FjaGVkID0gY3Eu\nY2hlY2tDYWNoZShrZXkpOwogICAgICAgICAgICBpZiAoY2FjaGVkICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExpc3RSZXN1bHRPYmpl\nY3RQcm92aWRlcihjYWNoZWQpOwoKICAgICAgICAgICAgUmVzdWx0T2JqZWN0\nUHJvdmlkZXIgcm9wID0gX2V4LmV4ZWN1dGVRdWVyeShjcS5nZXREZWxlZ2F0\nZSgpLAogICAgICAgICAgICAgICAgcGFyYW1zLCByYW5nZSk7CiAgICAgICAg\nICAgIHJldHVybiBjcS53cmFwUmVzdWx0KHJvcCwga2V5KTsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIENsZWFyIHRoZSBjYWNoZWQgcXVl\ncmllcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFjY2VzcyBwYXRoCiAgICAgICAg\nICogY2xhc3NlcyBpbiB0aGUgcXVlcnkuIFRoaXMgaXMgZG9uZSB3aGVuIGJ1\nbGsgb3BlcmF0aW9ucwogICAgICAgICAqIChzdWNoIGFzIGRlbGV0ZXMgb3Ig\ndXBkYXRlcykgYXJlIHBlcmZvcm1lZCBzbyB0aGF0IHRoZQogICAgICAgICAq\nIGNhY2hlIHJlbWFpbnMgdXAtdG8tZGF0ZS4KICAgICAgICAgKi8KICAgICAg\nICBwcml2YXRlIHZvaWQgY2xlYXJBY2Nlc3NQYXRoKFN0b3JlUXVlcnkgcSkg\newogICAgICAgICAgICBpZiAocSA9PSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIGNtZCA9IGdl\ndEFjY2Vzc1BhdGhNZXRhRGF0YXMocSk7CiAgICAgICAgICAgIGlmIChjbWQg\nPT0gbnVsbCB8fCBjbWQubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICBMaXN0IGNsYXNzZXMgPSBuZXcgQXJyYXlM\naXN0KGNtZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGNtZC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNsYXNzZXMu\nYWRkKGNtZFtpXS5nZXREZXNjcmliZWRUeXBlKCkpOwoKICAgICAgICAgICAg\nLy8gZXZpY3QgZnJvbSB0aGUgcXVlcnkgY2FjaGUKICAgICAgICAgICAgUXVl\ncnlDYWNoZVN0b3JlUXVlcnkgY3EgPSAoUXVlcnlDYWNoZVN0b3JlUXVlcnkp\nIHE7CiAgICAgICAgICAgIGNxLmdldENhY2hlKCkub25UeXBlc0NoYW5nZWQo\nbmV3IFR5cGVzQ2hhbmdlZEV2ZW50CiAgICAgICAgICAgICAgICAocS5nZXRD\nb250ZXh0KCksIGNsYXNzZXMpKTsKCiAgICAgICAgICAgIC8vIGV2aWN0IGZy\nb20gdGhlIGRhdGEgY2FjaGUKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjbWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChj\nbWRbaV0uZ2V0RGF0YUNhY2hlKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBjbWRbaV0uZ2V0RGF0YUNhY2hlKCkucmVtb3ZlQWxsKAogICAgICAg\nICAgICAgICAgICAgICAgICBjbWRbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpLCB0\ncnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIE51bWJlciBleGVjdXRlRGVsZXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10g\ncGFyYW1zKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gX2V4LmV4ZWN1dGVEZWxldGUodW53cmFwKHEpLCBwYXJhbXMpOwog\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgY2xlYXJB\nY2Nlc3NQYXRoKHEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgTnVtYmVyIGV4ZWN1dGVVcGRhdGUoU3RvcmVRdWVyeSBxLCBP\nYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHJldHVybiBfZXguZXhlY3V0ZVVwZGF0ZSh1bndyYXAocSksIHBh\ncmFtcyk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICBjbGVhckFjY2Vzc1BhdGgocSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25z\nKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBS\nYW5nZSByYW5nZSkgewogICAgICAgICAgICByZXR1cm4gRU1QVFlfU1RSSU5H\nUzsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHZhbGlkYXRlKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICBfZXgudmFsaWRhdGUodW53cmFw\nKHEpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIHZvaWQg\nZ2V0UmFuZ2UoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMsIFJhbmdl\nIHJhbmdlKSB7CiAgICAgICAgICAgIF9leC5nZXRSYW5nZShxLCBwYXJhbXMs\nIHJhbmdlKTsgCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdl\ndE9yZGVyaW5nVmFsdWUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMs\nCiAgICAgICAgICAgIE9iamVjdCByZXN1bHRPYmplY3QsIGludCBvcmRlcklu\nZGV4KSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0T3JkZXJpbmdWYWx1\nZSh1bndyYXAocSksIHBhcmFtcywgcmVzdWx0T2JqZWN0LAogICAgICAgICAg\nICAgICAgb3JkZXJJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbltdIGdldEFzY2VuZGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9leC5nZXRBc2NlbmRpbmcodW53cmFwKHEpKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzUGFja2luZyhTdG9y\nZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5pc1BhY2tpbmco\ndW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0QWxpYXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0QWxpYXModW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBDbGFzcyBnZXRSZXN1bHRDbGFzcyhTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9leC5nZXRSZXN1bHRDbGFzcyh1bndyYXAocSkp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZ1tdIGdldFByb2pl\nY3Rpb25BbGlhc2VzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1\ncm4gX2V4LmdldFByb2plY3Rpb25BbGlhc2VzKHVud3JhcChxKSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3NbXSBnZXRQcm9qZWN0aW9uVHlw\nZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0\nUHJvamVjdGlvblR5cGVzKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldEFjY2Vzc1BhdGhNZXRhRGF0\nYXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0\nQWNjZXNzUGF0aE1ldGFEYXRhcyh1bndyYXAocSkpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBnZXRPcGVyYXRpb24oU3RvcmVRdWVyeSBxKSB7\nCiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0T3BlcmF0aW9uKHVud3JhcChx\nKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3Jl\nZ2F0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5p\nc0FnZ3JlZ2F0ZSh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gaGFzR3JvdXBpbmcoU3RvcmVRdWVyeSBxKSB7CiAgICAg\nICAgICAgIHJldHVybiBfZXguaGFzR3JvdXBpbmcodW53cmFwKHEpKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBMaW5rZWRNYXAgZ2V0UGFyYW1ldGVy\nVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXgu\nZ2V0UGFyYW1ldGVyVHlwZXModW53cmFwKHEpKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBNYXAgZ2V0VXBkYXRlcyhTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9leC5nZXRVcGRhdGVzKHVud3JhcChxKSk7CiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBTdG9yZVF1ZXJ5IHVu\nd3JhcChTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuICgoUXVl\ncnlDYWNoZVN0b3JlUXVlcnkpIHEpLmdldERlbGVnYXRlKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmVzdWx0IGxpc3QgaW1wbGVtZW50\nYXRpb24gZm9yIGEgY2FjaGVkIHF1ZXJ5IHJlc3VsdC4gUGFja2FnZS1wcm90\nZWN0ZWQKICAgICAqIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGNsYXNzIENhY2hlZExpc3QKICAgICAgICBleHRlbmRzIEFic3Ry\nYWN0TGlzdAogICAgICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAg\nICAgICAgcHJpdmF0ZSBmaW5hbCBRdWVyeVJlc3VsdCBfcmVzOwogICAgICAg\nIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfcHJvajsKICAgICAgICBwcml2YXRl\nIGZpbmFsIFN0b3JlQ29udGV4dCBfc2N0eDsKCiAgICAgICAgcHVibGljIENh\nY2hlZExpc3QoUXVlcnlSZXN1bHQgcmVzLCBib29sZWFuIHByb2osIFN0b3Jl\nQ29udGV4dCBjdHgpIHsKICAgICAgICAgICAgX3JlcyA9IHJlczsKICAgICAg\nICAgICAgX3Byb2ogPSBwcm9qOwogICAgICAgICAgICBfc2N0eCA9IGN0eDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGludCBpZHgp\nIHsKICAgICAgICAgICAgaWYgKCFfcHJvaikKICAgICAgICAgICAgICAgIHJl\ndHVybiBmcm9tT2JqZWN0SWQoX3Jlcy5nZXQoaWR4KSwgX3NjdHgpOwoKICAg\nICAgICAgICAgT2JqZWN0W10gY2FjaGVkID0gKE9iamVjdFtdKSBfcmVzLmdl\ndChpZHgpOwogICAgICAgICAgICBpZiAoY2FjaGVkID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgT2JqZWN0W10g\ndW5jYWNoZWQgPSBuZXcgT2JqZWN0W2NhY2hlZC5sZW5ndGhdOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNhY2hlZC5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIHVuY2FjaGVkW2ldID0gY29weVByb2plY3Rpb24o\nY2FjaGVkW2ldLCBfc2N0eCk7CiAgICAgICAgICAgIHJldHVybiB1bmNhY2hl\nZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9yZXMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIE9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAgICAgICAgICB0\naHJvd3MgT2JqZWN0U3RyZWFtRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBBcnJheUxpc3QodGhpcyk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQSB3cmFwcGVyIGFyb3VuZCBhIHtAbGluayBSZXN1bHRP\nYmplY3RQcm92aWRlcn0gdGhhdCBidWlsZHMgdXAgYSBsaXN0IG9mCiAgICAg\nKiBhbGwgdGhlIE9JRHMgaW4gdGhpcyBsaXN0IGFuZCByZWdpc3RlcnMgdGhh\ndCBsaXN0IHdpdGggdGhlCiAgICAgKiBxdWVyeSBjYWNoZS4gQWJhbmRvbnMg\nbW9uaXRvcmluZyBhbmQgcmVnaXN0ZXJpbmcgaWYgb25lIG9mIHRoZSBjbGFz\nc2VzCiAgICAgKiBpbiB0aGUgYWNjZXNzIHBhdGggaXMgbW9kaWZpZWQgd2hp\nbGUgdGhlIHF1ZXJ5IHJlc3VsdHMgYXJlIGJlaW5nIGxvYWRlZC4KICAgICAq\nLwogICAgcHJpdmF0ZSBjbGFzcyBDYWNoaW5nUmVzdWx0T2JqZWN0UHJvdmlk\nZXIKICAgICAgICBpbXBsZW1lbnRzIFJlc3VsdE9iamVjdFByb3ZpZGVyLCBU\neXBlc0NoYW5nZWRMaXN0ZW5lciB7CgogICAgICAgIHByaXZhdGUgZmluYWwg\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgX3JvcDsKICAgICAgICBwcml2YXRlIGZp\nbmFsIGJvb2xlYW4gX3Byb2o7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBRdWVy\neUtleSBfcWs7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBUcmVlTWFwIF9kYXRh\nID0gbmV3IFRyZWVNYXAoKTsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX21h\naW50YWluQ2FjaGUgPSB0cnVlOwogICAgICAgIHByaXZhdGUgaW50IF9wb3Mg\nPSAtMTsKCiAgICAgICAgLy8gdXNlZCB0byBkZXRlcm1pbmUgbGlzdCBzaXpl\nIHdpdGhvdXQgbmVjZXNzYXJpbHkgY2FsbGluZyBzaXplKCksCiAgICAgICAg\nLy8gd2hpY2ggbWF5IHJlcXVpcmUgYSBEQiB0cmlwIG9yIHJldHVybiBJbnRl\nZ2VyLk1BWF9WQUxVRQogICAgICAgIHByaXZhdGUgaW50IF9tYXggPSAtMTsK\nICAgICAgICBwcml2YXRlIGludCBfc2l6ZSA9IEludGVnZXIuTUFYX1ZBTFVF\nOwoKICAgICAgICAvKioKICAgICAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5\nIGRlbGVnYXRlIHJlc3VsdCBwcm92aWRlciBhbmQgb3VyIHF1ZXJ5IGtleS4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ2FjaGluZ1Jlc3VsdE9iamVj\ndFByb3ZpZGVyKFJlc3VsdE9iamVjdFByb3ZpZGVyIHJvcCwKICAgICAgICAg\nICAgYm9vbGVhbiBwcm9qLCBRdWVyeUtleSBrZXkpIHsKICAgICAgICAgICAg\nX3JvcCA9IHJvcDsKICAgICAgICAgICAgX3Byb2ogPSBwcm9qOwogICAgICAg\nICAgICBfcWsgPSBrZXk7CiAgICAgICAgICAgIF9jYWNoZS5hZGRUeXBlc0No\nYW5nZWRMaXN0ZW5lcih0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIFN0b3AgY2FjaGluZy4KICAgICAgICAgKi8KICAgICAgICBw\ncml2YXRlIHZvaWQgYWJvcnRDYWNoaW5nKCkgewogICAgICAgICAgICBpZiAo\nIV9tYWludGFpbkNhY2hlKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAgICAgLy8gdGhpcyBjYW4gYmUgY2FsbGVkIHZpYSBhbiBldmVudCBm\ncm9tIGFub3RoZXIgdGhyZWFkCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\ndGhpcykgewogICAgICAgICAgICAgICAgLy8gaXQncyBpbXBvcnRhbnQgdGhh\ndCB3ZSBzZXQgdGhpcyBmbGFnIGZpcnN0IHNvIHRoYXQgYW55CiAgICAgICAg\nICAgICAgICAvLyBzdWJzZXF1ZW50IGNhbGxzIHRvIHRoaXMgb2JqZWN0IGFy\nZSBieXBhc3NlZC4KICAgICAgICAgICAgICAgIF9tYWludGFpbkNhY2hlID0g\nZmFsc2U7CiAgICAgICAgICAgICAgICBfY2FjaGUucmVtb3ZlVHlwZXNDaGFu\nZ2VkTGlzdGVuZXIodGhpcyk7CiAgICAgICAgICAgICAgICBfZGF0YS5jbGVh\ncigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBDaGVjayB3aGV0aGVyIHdlJ3ZlIGJ1ZmZlcmVkIGFsbCByZXN1\nbHRzLCB3aGlsZSBvcHRpb25hbGx5IGFkZGluZwogICAgICAgICAqIHRoZSBn\naXZlbiByZXN1bHQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lk\nIGNoZWNrRmluaXNoZWQoT2JqZWN0IG9iaiwgYm9vbGVhbiByZXN1bHQpIHsK\nICAgICAgICAgICAgLy8gdGhpcyBjYW4gYmUgY2FsbGVkIGF0IHRoZSBzYW1l\nIHRpbWUgYXMgYWJvcnRDYWNoaW5nIHZpYQogICAgICAgICAgICAvLyBhIHR5\ncGVzIGNoYW5nZWQgZXZlbnQKICAgICAgICAgICAgYm9vbGVhbiBmaW5pc2hl\nZCA9IGZhbHNlOwogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgICAgIGlmIChfbWFpbnRhaW5DYWNoZSkgewogICAgICAg\nICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgSW50ZWdlciBpbmRleCA9IE51bWJlcnMudmFsdWVPZihfcG9zKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfZGF0YS5jb250YWluc0tl\neShpbmRleCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVj\ndCBjYWNoZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2Jq\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Fj\naGVkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ug\naWYgKCFfcHJvaikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nYWNoZWQgPSBfc2N0eC5nZXRPYmplY3RJZChvYmopOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgT2JqZWN0W10gYXJyID0gKE9iamVjdFtdKSBvYmo7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0W10gY3AgPSBuZXcg\nT2JqZWN0W2Fyci5sZW5ndGhdOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcFtpXSA9IGNv\ncHlQcm9qZWN0aW9uKGFycltpXSwgX3NjdHgpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNhY2hlZCA9IGNwOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGNhY2hlZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIF9kYXRhLnB1dChpbmRleCwgY2FjaGVkKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBmaW5pc2hlZCA9IF9zaXplID09IF9kYXRhLnNpemUoKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKGZpbmlzaGVkKSB7CiAgICAgICAgICAgICAgICAvLyBhbiBhYm9ydENhY2hp\nbmcgY2FsbCBjYW4gc25lYWsgaW4gaGVyZSB2aWEgb25FeHBpcmU7IHRoZQog\nICAgICAgICAgICAgICAgLy8gY2FjaGUgaXMgbG9ja2VkIGR1cmluZyBldmVu\ndCBmaXJpbmdzLCBzbyB0aGUgbG9jayBoZXJlIHdpbGwKICAgICAgICAgICAg\nICAgIC8vIHdhaXQgZm9yIGl0IChvciB3aWxsIGZvcmNlIHRoZSBuZXh0IGZp\ncmluZyB0byB3YWl0KQogICAgICAgICAgICAgICAgX2NhY2hlLndyaXRlTG9j\naygpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgd2UgZGlkbid0IGFib3J0CiAgICAgICAgICAgICAg\nICAgICAgaWYgKF9tYWludGFpbkNhY2hlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIFF1ZXJ5UmVzdWx0IHJlcyA9IG51bGw7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmVzID0gbmV3IFF1ZXJ5UmVzdWx0KF9xaywgX2Rh\ndGEudmFsdWVzKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIF9jYWNoZS5wdXQoX3FrLCByZXMpOwogICAg\nICAgICAgICAgICAgICAgICAgICBhYm9ydENhY2hpbmcoKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBfY2FjaGUud3JpdGVV\nbmxvY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21B\nY2Nlc3MoKSB7CiAgICAgICAgICAgIHJldHVybiBfcm9wLnN1cHBvcnRzUmFu\nZG9tQWNjZXNzKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBv\ncGVuKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIF9yb3Aub3BlbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9i\namVjdCBnZXRSZXN1bHRPYmplY3QoKQogICAgICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgT2JqZWN0IG9iaiA9IF9yb3AuZ2V0UmVz\ndWx0T2JqZWN0KCk7CiAgICAgICAgICAgIGNoZWNrRmluaXNoZWQob2JqLCB0\ncnVlKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIG5leHQoKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcysrOwogICAgICAgICAgICBi\nb29sZWFuIG5leHQgPSBfcm9wLm5leHQoKTsKICAgICAgICAgICAgaWYgKCFu\nZXh0ICYmIF9wb3MgPT0gX21heCArIDEpIHsKICAgICAgICAgICAgICAgIF9z\naXplID0gX3BvczsKICAgICAgICAgICAgICAgIGNoZWNrRmluaXNoZWQobnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG5leHQgJiYgX3Bv\ncyA+IF9tYXgpCiAgICAgICAgICAgICAgICBfbWF4ID0gX3BvczsKICAgICAg\nICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBhYnNvbHV0ZShpbnQgcG9zKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9IHBvczsKICAgICAgICAg\nICAgYm9vbGVhbiB2YWxpZCA9IF9yb3AuYWJzb2x1dGUocG9zKTsKICAgICAg\nICAgICAgaWYgKCF2YWxpZCAmJiBfcG9zID09IF9tYXggKyAxKSB7CiAgICAg\nICAgICAgICAgICBfc2l6ZSA9IF9wb3M7CiAgICAgICAgICAgICAgICBjaGVj\na0ZpbmlzaGVkKG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nICh2YWxpZCAmJiBfcG9zID4gX21heCkKICAgICAgICAgICAgICAgIF9tYXgg\nPSBfcG9zOwogICAgICAgICAgICByZXR1cm4gdmFsaWQ7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IHNpemUoKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF9zaXplICE9IEludGVnZXIu\nTUFYX1ZBTFVFKQogICAgICAgICAgICAgICAgcmV0dXJuIF9zaXplOwogICAg\nICAgICAgICBpbnQgc2l6ZSA9IF9yb3Auc2l6ZSgpOwogICAgICAgICAgICBf\nc2l6ZSA9IHNpemU7CiAgICAgICAgICAgIGNoZWNrRmluaXNoZWQobnVsbCwg\nZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHJlc2V0KCkKICAgICAgICAgICAgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9yb3AucmVzZXQoKTsKICAgICAg\nICAgICAgX3BvcyA9IC0xOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgY2xvc2UoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAgICAgIF9yb3AuY2xv\nc2UoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGhhbmRsZUNo\nZWNrZWRFeGNlcHRpb24oRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgX3Jv\ncC5oYW5kbGVDaGVja2VkRXhjZXB0aW9uKGUpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgb25UeXBlc0NoYW5nZWQoVHlwZXNDaGFuZ2VkRXZl\nbnQgZXYpIHsKICAgICAgICAgICAgaWYgKF9xay5jaGFuZ2VJbnZhbGlkYXRl\nc1F1ZXJ5KGV2LmdldFR5cGVzKCkpKQogICAgICAgICAgICAgICAgYWJvcnRD\nYWNoaW5nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3Ry\ndWN0IHRvIHJlY29nbml6ZSBjYWNoZWQgb2lkcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgQ2FjaGVkT2JqZWN0SWQgewoKICAgICAgICBw\ndWJsaWMgZmluYWwgT2JqZWN0IG9pZDsKCiAgICAgICAgcHVibGljIENhY2hl\nZE9iamVjdElkIChPYmplY3Qgb2lkKQoJCXsKCQkJdGhpcy5vaWQgPSBvaWQ7\nCgkJfQoJfQp9Cg==\n","encoding":"base64"}

