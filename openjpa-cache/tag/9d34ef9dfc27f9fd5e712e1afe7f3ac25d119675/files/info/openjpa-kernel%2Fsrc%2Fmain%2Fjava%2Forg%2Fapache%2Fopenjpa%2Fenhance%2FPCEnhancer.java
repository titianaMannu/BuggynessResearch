{"sha":"a73a22669b76bd7d1e5196a98f071589dfa3703c","node_id":"MDQ6QmxvYjIwNjM2NDphNzNhMjI2NjliNzZiZDdkMWU1MTk2YTk4ZjA3MTU4OWRmYTM3MDNj","size":183151,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a73a22669b76bd7d1e5196a98f071589dfa3703c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5Mb2NhbGU7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNv\nbmZpZ3VyYXRpb25JbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5tZXRhLkNsYXNzQXJnUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLkJ5dGVjb2RlV3JpdGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkZpbGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLlNlcnZpY2VzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdp\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJu\nYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdEZWNpbWFsSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdJbnRlZ2VySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\neXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFySWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5GbG9hdElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nTG9uZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0\nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TaG9ydElkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RyaW5nSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7Cmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3M7CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkJDRmllbGQ7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDTWV0aG9kOwpp\nbXBvcnQgc2VycC5ieXRlY29kZS5Db2RlOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5Db25zdGFudHM7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkV4Y2VwdGlvbnM7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkZpZWxkSW5zdHJ1Y3Rpb247CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLkdldEZpZWxkSW5zdHJ1Y3Rpb247CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLklmSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5KdW1wSW5z\ndHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkxvYWRJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTWV0aG9kSW5zdHJ1Y3Rpb247Cmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLlRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkNsYXNzSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVy\nczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEJ5dGVjb2Rl\nIGVuaGFuY2VyIHVzZWQgdG8gZW5oYW5jZSBwZXJzaXN0ZW50IGNsYXNzZXMg\nZnJvbSBtZXRhZGF0YS4gVGhlCiAqIGVuaGFuY2VyIG11c3QgYmUgaW52b2tl\nZCBvbiBhbGwgcGVyc2lzdGVuY2UtY2FwYWJsZSBhbmQgcGVyc2lzdGVuY2Ug\nYXdhcmUKICogY2xhc3Nlcy4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICov\nCnB1YmxpYyBjbGFzcyBQQ0VuaGFuY2VyIHsKICAgIC8vIERlc2lnbmF0ZXMg\nYSB2ZXJzaW9uIGZvciBtYWludGFpbmluZyBjb21wYXRiaWxpdHkgd2hlbiBQ\nQ0VuaGFuY2VyCiAgICAvLyBtb2RpZmllcyBlbmhhbmNlbWVudCB0aGF0IGNh\nbiBicmVhayBzZXJpYWxpemF0aW9uIG9yIG90aGVyIGNvbnRyYWN0cwogICAg\nLy8gRWFjaCBlbmhhbmNlZCBjbGFzcyB3aWxsIHJldHVybiB0aGUgdmFsdWUg\nb2YgdGhpcyBmaWVsZCB2aWEKICAgIC8vIHB1YmxpYyBpbnQgZ2V0RW5oYW5j\nZW1lbnRDb250cmFjdFZlcnNpb24oKQogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRVJfVkVSU0lPTiA9IDI7CiAgICAKICAgIGJvb2xlYW4g\nX2FkZFZlcnNpb25Jbml0RmxhZyA9IHRydWU7CgogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgRU5IQU5DRV9OT05FID0gMDsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IEVOSEFOQ0VfQVdBUkUgPSAyIDw8IDA7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX0lOVEVSRkFDRSA9IDIgPDwg\nMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VfUEMgPSAy\nIDw8IDI7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgUFJFID0g\nInBjIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIElTREVUQUNI\nRURTVEFURURFRklOSVRJVkUgPSBQUkUgCiAgICAgICAgKyAiaXNEZXRhY2hl\nZFN0YXRlRGVmaW5pdGl2ZSI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nQ2xhc3MgUENUWVBFID0gUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNNID0gUFJFICsgIlN0YXRl\nTWFuYWdlciI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBTTVRZ\nUEUgPSBTdGF0ZU1hbmFnZXIuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBTdHJpbmcgSU5IRVJJVCA9IFBSRSArICJJbmhlcml0ZWRGaWVsZENv\ndW50IjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBDT05URVhU\nTkFNRSA9ICJHZW5lcmljQ29udGV4dCI7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBDbGFzcyBVU0VSRVhDRVAgPSBVc2VyRXhjZXB0aW9uLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSU5URVJORVhDRVAgPSBJ\nbnRlcm5hbEV4Y2VwdGlvbi5jbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIENsYXNzIEhFTFBFUlRZUEUgPSBQQ1JlZ2lzdHJ5LmNsYXNzOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNVUEVSID0gUFJFICsgIlBD\nU3VwZXJjbGFzcyI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBP\nSURGU1RZUEUgPSBGaWVsZFN1cHBsaWVyLmNsYXNzOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ2xhc3MgT0lERkNUWVBFID0gRmllbGRDb25zdW1lci5j\nbGFzczsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFZF\nUlNJT05fSU5JVF9TVFIgPSAgUFJFICsgIlZlcnNpb25Jbml0IjsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKFBDRW5oYW5jZXIuY2xhc3MpOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFJFREVGSU5FRF9BVFRSSUJV\nVEUKICAgICAgICA9IFBDRW5oYW5jZXIuY2xhc3MuZ2V0TmFtZSgpICsgIiNy\nZWRlZmluZWQtdHlwZSI7CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIEF1eGlsaWFyeUVuaGFuY2VyW10gX2F1eEVuaGFuY2VyczsKICAgIHN0YXRp\nYyB7CiAgICAgICAgQ2xhc3NbXSBjbGFzc2VzID0gU2VydmljZXMuZ2V0SW1w\nbGVtZW50b3JDbGFzc2VzKAogICAgICAgICAgICBBdXhpbGlhcnlFbmhhbmNl\nci5jbGFzcywKICAgICAgICAgICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKEF1eGlsaWFyeUVuaGFuY2Vy\nLmNsYXNzKSkpOwogICAgICAgIExpc3QgYXV4RW5oYW5jZXJzID0gbmV3IEFy\ncmF5TGlzdChjbGFzc2VzLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBhdXhFbmhhbmNlcnMuYWRkKEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKGNsYXNzZXNbaV0pKSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAg\nICAgICAgICAvLyBhdXggZW5oYW5jZXIgbWF5IHJlbHkgb24gbm9uLWV4aXN0\nYW50IHNwZWMgY2xhc3NlcywgZXRjCiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgX2F1eEVuaGFuY2VycyA9IChBdXhpbGlhcnlFbmhhbmNlcltd\nKSBhdXhFbmhhbmNlcnMudG9BcnJheQogICAgICAgIChuZXcgQXV4aWxpYXJ5\nRW5oYW5jZXJbYXV4RW5oYW5jZXJzLnNpemUoKV0pOwogICAgfQoKICAgIHBy\naXZhdGUgQkNDbGFzcyBfcGM7CiAgICBwcml2YXRlIGZpbmFsIEJDQ2xhc3Mg\nX21hbmFnZWRUeXBlOwogICAgcHJpdmF0ZSBmaW5hbCBNZXRhRGF0YVJlcG9z\naXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc01ldGFEYXRh\nIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cgX2xvZzsKICAgIHByaXZh\ndGUgQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX2RlZkNvbnMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9yZWRl\nZmluZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9zdWJjbGFzcyA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9mYWlsID0gZmFsc2U7CiAg\nICBwcml2YXRlIFNldCBfdmlvbGF0aW9ucyA9IG51bGw7CiAgICBwcml2YXRl\nIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2YXRlIEJ5dGVjb2RlV3JpdGVy\nIF93cml0ZXIgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2JhY2tpbmdGaWVs\nZHMgPSBudWxsOyAvLyBtYXAgb2Ygc2V0IC8gZ2V0IG5hbWVzID0+IGZpZWxk\nIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfYXR0cnNUb0ZpZWxkcyA9IG51bGw7\nIC8vIG1hcCBvZiBhdHRyIG5hbWVzID0+IGZpZWxkIG5hbWVzCiAgICBwcml2\nYXRlIE1hcCBfZmllbGRzVG9BdHRycyA9IG51bGw7IC8vIG1hcCBvZiBmaWVs\nZCBuYW1lcyA9PiBhdHRyIG5hbWVzCiAgICBwcml2YXRlIGJvb2xlYW4gX2lz\nQWxyZWFkeVJlZGVmaW5lZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9pc0FscmVhZHlTdWJjbGFzc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX2Jjc0NvbmZpZ3VyZWQgPSBmYWxzZTsKCiAgICAvKioKICAgICAq\nIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbiBhbmQgdHlwZSB0\nbyBlbmhhbmNlLiBUaGlzIHdpbGwgbG9vawogICAgICogdXAgdGhlIG1ldGFk\nYXRhIGZvciA8Y29kZT50eXBlPC9jb2RlPiBmcm9tIDxjb2RlPmNvbmY8L2Nv\nZGU+J3MKICAgICAqIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBQ\nQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIENsYXNzIHR5\ncGUpIHsKICAgICAgICB0aGlzKGNvbmYsIChCQ0NsYXNzKSBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAg\nICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihuZXcgUHJvamVjdCgpLCB0eXBl\nKSksCiAgICAgICAgICAgIChNZXRhRGF0YVJlcG9zaXRvcnkpIG51bGwpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25m\naWd1cmF0aW9uIGFuZCB0eXBlIHRvIGVuaGFuY2UuIFRoaXMgd2lsbCBsb29r\nCiAgICAgKiB1cCB0aGUgbWV0YWRhdGEgZm9yIDxjb2RlPm1ldGE8L2NvZGU+\nIGJ5IGNvbnZlcnRpbmcgYmFjayB0byBhIGNsYXNzCiAgICAgKiBhbmQgdGhl\nbiBsb2FkaW5nIGZyb20gPGNvZGU+Y29uZjwvY29kZT4ncyByZXBvc2l0b3J5\nLgogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmln\ndXJhdGlvbiBjb25mLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICB0\naGlzKGNvbmYsIChCQ0NsYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAubG9hZFByb2plY3RD\nbGFzc0FjdGlvbihuZXcgUHJvamVjdCgpLCBtZXRhLmdldERlc2NyaWJlZFR5\ncGUoKSkpLAogICAgICAgICAgICBtZXRhLmdldFJlcG9zaXRvcnkoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZp\nZ3VyYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhlIGJ5dGVj\nb2RlIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBlIHRvCiAgICAgKiBlbmhh\nbmNlOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20gYW55IHN0cmVhbSBvciBm\naWxlCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBvc2l0b3J5\nIHRvIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAogICAgICogb3IgbnVsbCB0\nbyBjcmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRvcnkKICAg\nICAqIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3QgdXNlZCBi\neSBkZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0aW9uIG1p\nZ2h0IGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZpYyBzdWJj\nbGFzcyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVxdWlyZWQgbW9yZSB0aGFu\nIGp1c3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAgICogQGRlcHJlY2F0ZWQg\ndXNlIHtAbGluayAjUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiwg\nQkNDbGFzcywKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnksIENsYXNzTG9h\nZGVyKX0gaW5zdGVhZC4gCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2Vy\nKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICB0aGlz\nKGNvbmYsIHR5cGUsIHJlcG9zLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAq\nCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRp\nb24gZm8gdGhlIHR5cGUgdG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJl\nIGNyZWF0ZWQgZnJvbSBhbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJh\nbSByZXBvcyBhIG1ldGFkYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRh\nZGF0YSBhY2Nlc3MsCiAgICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyBy\nZXBvcml0b3J5OyB0aGUgcmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2\nZW4gY29uZmlndXJhdGlvbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAq\nIGJlY2F1c2UgdGhlIGNvbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAq\nIGltcGxlbWVudGF0aW9uLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFk\nYXRhCiAgICAgKiByZXF1aXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFk\nYXRhIGZpbGVzCiAgICAgKiBAcGFyYW0gbG9hZGVyIHRoZSBlbnZpcm9ubWVu\ndCBjbGFzc2xvYWRlciB0byB1c2UgZm9yIGxvYWRpbmcKICAgICAqIGNsYXNz\nZXMgYW5kIHJlc291cmNlcy4KICAgICAqLwogICAgcHVibGljIFBDRW5oYW5j\nZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQkNDbGFzcyB0eXBlLAog\nICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcywgQ2xhc3NMb2FkZXIg\nbG9hZGVyKSB7CiAgICAgICAgX21hbmFnZWRUeXBlID0gdHlwZTsKICAgICAg\nICBfcGMgPSB0eXBlOwoKICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwoKICAgICAgICBpZiAo\ncmVwb3MgPT0gbnVsbCkgewogICAgICAgICAgICBfcmVwb3MgPSBjb25mLm5l\nd01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIF9y\nZXBvcy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01F\nVEEpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBfcmVwb3MgPSByZXBv\nczsKICAgICAgICBfbWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YSh0eXBlLmdl\ndFR5cGUoKSwgbG9hZGVyLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IHJlcG9zaXRvcnkuIFRoZSByZXBvc2l0\nb3J5J3MgY29uZmlndXJhdGlvbiB3aWxsCiAgICAgKiBiZSB1c2VkLCBhbmQg\ndGhlIG1ldGFkYXRhIHBhc3NlZCBpbiB3aWxsIGJlIHVzZWQgYXMtaXMgd2l0\naG91dCBkb2luZwogICAgICogYW55IGFkZGl0aW9uYWwgbG9va3Vwcy4gVGhp\ncyBpcyB1c2VmdWwgd2hlbiBydW5uaW5nIHRoZSBlbmhhbmNlcgogICAgICog\nZHVyaW5nIG1ldGFkYXRhIGxvYWQuCiAgICAgKgogICAgICogQHBhcmFtIHJl\ncG9zIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFkYXRh\nIGFjY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJlcG9y\naXRvcnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBmcm9tIHRoZSBnaXZlbiBj\nb25maWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVmYXVsdAogICAgICogYmVj\nYXVzZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBiZSBhbgogICAgICogaW1w\nbGVtZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRhdGEK\nICAgICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRhdGEg\nZmlsZXMKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBieXRlY29kZSByZXByZXNl\nbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAgICogZW5oYW5jZTsgdGhpcyBj\nYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0gb3IgZmlsZQogICAgICog\nQHBhcmFtIG1ldGEgdGhlIG1ldGFkYXRhIHRvIHVzZSBmb3IgcHJvY2Vzc2lu\nZyB0aGlzIHR5cGUuCiAgICAgKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAg\nKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE1ldGFEYXRhUmVwb3NpdG9yeSBy\nZXBvcywgQkNDbGFzcyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIF9tYW5hZ2VkVHlwZSA9IHR5cGU7CiAgICAgICAgX3Bj\nID0gdHlwZTsKCiAgICAgICAgX2xvZyA9IHJlcG9zLmdldENvbmZpZ3VyYXRp\nb24oKQogICAgICAgICAgICAuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9u\nLkxPR19FTkhBTkNFKTsKCiAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAg\nICAgX21ldGEgPSBtZXRhOwogICAgfQoKICAgIHN0YXRpYyBTdHJpbmcgdG9Q\nQ1N1YmNsYXNzTmFtZShDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gU3Ry\naW5ncy5nZXRQYWNrYWdlTmFtZShQQ0VuaGFuY2VyLmNsYXNzKSArICIuIgog\nICAgICAgICAgICArIGNscy5nZXROYW1lKCkucmVwbGFjZSgnLicsICckJykg\nKyAiJHBjc3ViY2xhc3MiOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciBvciBub3QgPGNvZGU+Y2xhc3NOYW1lPC9jb2RlPiBpcyB0aGUgbmFtZSBm\nb3IgYQogICAgICogZHluYW1pY2FsbHktY3JlYXRlZCBwZXJzaXN0ZW5jZS1j\nYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gaXNQQ1N1YmNsYXNz\nTmFtZShTdHJpbmcgY2xhc3NOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNsYXNz\nTmFtZS5zdGFydHNXaXRoKFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoUENFbmhh\nbmNlci5jbGFzcykpCiAgICAgICAgICAgICYmIGNsYXNzTmFtZS5lbmRzV2l0\naCgiJHBjc3ViY2xhc3MiKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIDxj\nb2RlPmNsYXNzTmFtZTwvY29kZT4gaXMgYSBkeW5hbWljYWxseS1jcmVhdGVk\nIHBlcnNpc3RlbmNlLWNhcGFibGUKICAgICAqIHN1YmNsYXNzIG5hbWUsIHJl\ndHVybnMgdGhlIG5hbWUgb2YgdGhlIGNsYXNzIHRoYXQgaXQgc3ViY2xhc3Nl\ncy4KICAgICAqIE90aGVyd2lzZSwgcmV0dXJucyA8Y29kZT5jbGFzc05hbWU8\nL2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b01hbmFnZWRUeXBlTmFtZShTdHJp\nbmcgY2xhc3NOYW1lKSB7CiAgICAgICAgaWYgKGlzUENTdWJjbGFzc05hbWUo\nY2xhc3NOYW1lKSkgewogICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05h\nbWUuc3Vic3RyaW5nKAogICAgICAgICAgICAgICAgU3RyaW5ncy5nZXRQYWNr\nYWdlTmFtZShQQ0VuaGFuY2VyLmNsYXNzKS5sZW5ndGgoKSArIDEpOwogICAg\nICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUuc3Vic3RyaW5nKDAsIGNs\nYXNzTmFtZS5sYXN0SW5kZXhPZigiJCIpKTsKICAgICAgICAgICAgLy8gdGhp\ncyBpcyBub3QgY29ycmVjdCBmb3IgbmVzdGVkIFBDcwogICAgICAgICAgICBj\nbGFzc05hbWUgPSBjbGFzc05hbWUucmVwbGFjZSgnJCcsICcuJyk7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBjbGFzc05hbWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3Vy\nYXRpb24sIHR5cGUsIGFuZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGlj\nIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQkNDbGFz\ncyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIHRoaXMoY29uZiwgdHlwZSwgbWV0YS5nZXRSZXBvc2l0b3J5KCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBieXRlY29kZSByZXByZXNl\nbnRhdGlvbiBvZiB0aGUgcGVyc2lzdGVuY2UtY2FwYWJsZSBjbGFzcwogICAg\nICogYmVpbmcgbWFuaXB1bGF0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyBCQ0Ns\nYXNzIGdldFBDQnl0ZWNvZGUoKSB7CiAgICAgICAgcmV0dXJuIF9wYzsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnl0ZWNvZGUgcmVwcmVz\nZW50YXRpb24gb2YgdGhlIG1hbmFnZWQgY2xhc3MgYmVpbmcKICAgICAqIG1h\nbmlwdWxhdGVkLiBUaGlzIGlzIHVzdWFsbHkgdGhlIHNhbWUgYXMge0BsaW5r\nICNnZXRQQ0J5dGVjb2RlfSwKICAgICAqIGV4Y2VwdCB3aGVuIHJ1bm5pbmcg\ndGhlIGVuaGFuY2VyIHRvIHJlZGVmaW5lIGFuZCBzdWJjbGFzcwogICAgICog\nZXhpc3RpbmcgcGVyc2lzdGVudCB0eXBlcy4KICAgICAqLwogICAgcHVibGlj\nIEJDQ2xhc3MgZ2V0TWFuYWdlZFR5cGVCeXRlY29kZSgpIHsKICAgICAgICBy\nZXR1cm4gX21hbmFnZWRUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGNsYXNzIGJlaW5nIG1hbmlwdWxh\ndGVkLCBvciBudWxsIGlmIG5vdAogICAgICogYSBwZXJzaXN0ZW50IHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRh\nKCkgewogICAgICAgIHJldHVybiBfbWV0YTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGVuaGFuY2Vy\nIHNob3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBjb25zdHJ1Y3RvciBpZiBv\nbmUgaXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0aGUgY2xhc3MuIE9wZW5K\nUEEKICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1hcmcgY29uc3RydWN0b3Ig\nKHdoZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGlsZXIKICAgICAqIG9yIGJ5\nIHRoZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGdldEFkZERlZmF1bHRDb25zdHJ1Y3RvcigpIHsKICAg\nICAgICByZXR1cm4gX2RlZkNvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBlbmhhbmNlciBzaG91\nbGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0b3IgaWYgb25lIGlz\nIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNzLiBPcGVuSlBBCiAg\nICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0cnVjdG9yICh3aGV0\naGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAgKiBvciBieSB0aGUg\ndXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRBZGREZWZhdWx0Q29uc3RydWN0b3IoYm9vbGVhbiBhZGREZWZh\ndWx0Q29uc3RydWN0b3IpIHsKICAgICAgICBfZGVmQ29ucyA9IGFkZERlZmF1\nbHRDb25zdHJ1Y3RvcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhlIGVuaGFuY2VyIHNob3VsZCBtdXRhdGUgaXRzIGFyZ3VtZW50cywgb3Ig\nanVzdCBydW4gdmFsaWRhdGlvbgogICAgICogYW5kIG9wdGlvbmFsIHN1YmNs\nYXNzaW5nIGxvZ2ljIG9uIHRoZW0uIFVzdWFsbHkgdXNlZCBpbiBjb25qdW5j\ndGlvbiB3aXRoCiAgICAgKiA8Y29kZT5zZXRDcmVhdGVTdWJjbGFzcyh0cnVl\nKTwvY29kZT4uCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGdldFJlZGVmaW5lKCkgewogICAgICAgIHJl\ndHVybiBfcmVkZWZpbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0cyBhcmd1bWVudHMsIG9y\nIGp1c3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFuZCBvcHRpb25hbCBzdWJj\nbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5IHVzZWQgaW4gY29uanVu\nY3Rpb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3JlYXRlU3ViY2xhc3ModHJ1\nZSk8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRSZWRlZmluZShib29sZWFuIHJlZGVmaW5l\nKSB7CiAgICAgICAgX3JlZGVmaW5lID0gcmVkZWZpbmU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhpcyBpbnN0YW5j\nZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAgICogcmVkZWZp\nbmVkLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0FscmVhZHlSZWRlZmluZWQoKSB7CiAgICAgICAg\ncmV0dXJuIF9pc0FscmVhZHlSZWRlZmluZWQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhpcyBpbnN0YW5jZSBpcyBl\nbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAgICogc3ViY2xhc3NlZCBp\nbiB0aGlzIGluc3RhbmNlJ3MgZW52aXJvbm1lbnQgY2xhc3Nsb2FkZXIuCiAg\nICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGlzQWxyZWFkeVN1YmNsYXNzZWQoKSB7CiAgICAgICAgcmV0dXJu\nIF9pc0FscmVhZHlTdWJjbGFzc2VkOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG1ha2UgaXRzIGFyZ3VtZW50\ncyBwZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAgICogb3IgZ2VuZXJhdGUgYSBw\nZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBz\naW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRDcmVh\ndGVTdWJjbGFzcygpIHsKICAgICAgICByZXR1cm4gX3N1YmNsYXNzOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxk\nIG1ha2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAg\nICogb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNz\nLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRDcmVhdGVTdWJjbGFzcyhib29sZWFuIHN1YmNsYXNzKSB7\nCiAgICAgICAgX3N1YmNsYXNzID0gc3ViY2xhc3M7CiAgICAgICAgX2FkZFZl\ncnNpb25Jbml0RmxhZyA9IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUgdXNlcyBw\ncm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRlY29kZSBhbmFseXNpcyBz\naG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdzIHByb3Bl\ncnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMo\nKSB7CiAgICAgICAgcmV0dXJuIF9mYWlsOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUgdXNl\ncyBwcm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRlY29kZSBhbmFseXNp\ncyBzaG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdzIHBy\nb3BlcnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMo\nYm9vbGVhbiBmYWlsKSB7CiAgICAgICAgX2ZhaWwgPSBmYWlsOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRvIGdl\nbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICogc3Ry\ndWN0dXJlIHdpbGwgYmUgY3JlYXRlZCBiZW5lYXRoIHRoaXMgZGlyZWN0b3J5\nLiBEZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRpbmcgdGhlIGV4aXN0aW5n\nIGNsYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwogICAgcHVibGljIEZpbGUg\nZ2V0RGlyZWN0b3J5KCkgewogICAgICAgIHJldHVybiBfZGlyOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRvIGdl\nbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICogc3Ry\ndWN0dXJlIHdpbGwgYmUgY3JlYWVkIGJlbmVhdGggdGhpcyBkaXJlY3Rvcnku\nIERlZmF1bHRzIHRvCiAgICAgKiBvdmVyd3JpdGluZyB0aGUgZXhpc3Rpbmcg\nY2xhc3MgZmlsZSBpZiBudWxsLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXREaXJlY3RvcnkoRmlsZSBkaXIpIHsKICAgICAgICBfZGlyID0gZGlyOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjdXJyZW50IHtAbGlu\nayBCeXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdG8gb3IgbnVsbCBpZiBub25l\nLgogICAgICovCiAgICBwdWJsaWMgQnl0ZWNvZGVXcml0ZXIgZ2V0Qnl0ZWNv\nZGVXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIF93cml0ZXI7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIHtAbGluayBCeXRlY29kZVdyaXRlcn0g\ndG8gd3JpdGUgdGhlIGJ5dGVjb2RlIHRvIG9yIG51bGwgaWYgbm9uZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZWNvZGVXcml0ZXIoQnl0ZWNv\nZGVXcml0ZXIgd3JpdGVyKSB7CiAgICAgICAgX3dyaXRlciA9IHdyaXRlcjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gYnl0ZWNvZGUgZW5oYW5j\nZW1lbnRzLgogICAgICoKICAgICAqIEByZXR1cm4gPGNvZGU+RU5IQU5DRV8q\nPC9jb2RlPiBjb25zdGFudAogICAgICovCiAgICBwdWJsaWMgaW50IHJ1bigp\nIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLXN0YXJ0IiwgX21h\nbmFnZWRUeXBlLmdldFR5cGUoKSkpOwoKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBpZiBtYW5hZ2VkIGludGVyZmFjZSwgc2tpcAogICAgICAgICAg\nICBpZiAoX3BjLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gRU5IQU5DRV9JTlRFUkZBQ0U7CgogICAgICAgICAgICAvLyBjaGVjayBp\nZiBhbHJlYWR5IGVuaGFuY2VkCiAgICAgICAgICAgIENsYXNzW10gaW50ZXJm\nYWNlcyA9IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZEludGVyZmFjZVR5cGVz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW50ZXJmYWNl\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGludGVyZmFj\nZXNbaV0uZ2V0TmFtZSgpLmVxdWFscyhQQ1RZUEUuZ2V0TmFtZSgpKSkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQo\nInBjLXR5cGUiLCBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfTk9ORTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uZmlndXJlQkNz\nKCk7CgogICAgICAgICAgICAvLyB2YWxpZGF0ZSBwcm9wZXJ0aWVzIGJlZm9y\nZSByZXBsYWNpbmcgZmllbGQgYWNjZXNzIHNvIHRoYXQKICAgICAgICAgICAg\nLy8gd2UgYnVpbGQgdXAgYSByZWNvcmQgb2YgYmFja2luZyBmaWVsZHMsIGV0\nYwogICAgICAgICAgICBpZiAoX21ldGEgIT0gbnVsbAogICAgICAgICAgICAg\nICAgJiYgX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEu\nQUNDRVNTX1BST1BFUlRZKSB7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZVBy\nb3BlcnRpZXMoKTsKICAgICAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJj\nbGFzcygpKQogICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZVRyYW5z\nbGF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVwbGFjZUFu\nZFZhbGlkYXRlRmllbGRBY2Nlc3MoKTsKICAgICAgICAgICAgcHJvY2Vzc1Zp\nb2xhdGlvbnMoKTsKCiAgICAgICAgICAgIGlmIChfbWV0YSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBlbmhhbmNlQ2xhc3MoKTsKICAgICAgICAgICAg\nICAgIGFkZEZpZWxkcygpOwogICAgICAgICAgICAgICAgYWRkU3RhdGljSW5p\ndGlhbGl6ZXIoKTsKICAgICAgICAgICAgICAgIGFkZFBDTWV0aG9kcygpOwog\nICAgICAgICAgICAgICAgYWRkQWNjZXNzb3JzKCk7CiAgICAgICAgICAgICAg\nICBhZGRBdHRhY2hEZXRhY2hDb2RlKCk7CiAgICAgICAgICAgICAgICBhZGRT\nZXJpYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAgICAgICAgYWRkQ2xvbmlu\nZ0NvZGUoKTsKICAgICAgICAgICAgICAgIHJ1bkF1eGlsaWFyeUVuaGFuY2Vy\ncygpOwogICAgICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfUEM7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgicGVycy1h\nd2FyZSIsIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpKTsKICAgICAgICAgICAg\ncmV0dXJuIEVOSEFOQ0VfQVdBUkU7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihfbG9jLmdldCgiZW5oYW5jZS1lcnJvciIs\nCiAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLmdldE5h\nbWUoKSwgZS5nZXRNZXNzYWdlKCkpLCBlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIGNvbmZpZ3VyZUJDcygpIHsKICAgICAgICBpZiAo\nIV9iY3NDb25maWd1cmVkKSB7CiAgICAgICAgICAgIGlmIChnZXRSZWRlZmlu\nZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX21hbmFnZWRUeXBlLmdldEF0\ndHJpYnV0ZShSRURFRklORURfQVRUUklCVVRFKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5hZGRBdHRyaWJ1dGUoUkVERUZJ\nTkVEX0FUVFJJQlVURSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgX2lzQWxyZWFkeVJlZGVmaW5lZCA9IHRydWU7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgICAgICBQQ1N1YmNsYXNzVmFsaWRhdG9yIHZhbCA9\nIG5ldyBQQ1N1YmNsYXNzVmFsaWRhdG9yKAogICAgICAgICAgICAgICAgICAg\nIF9tZXRhLCBfbWFuYWdlZFR5cGUsIF9sb2csIF9mYWlsKTsKICAgICAgICAg\nICAgICAgIHZhbC5hc3NlcnRDYW5TdWJjbGFzcygpOwoKICAgICAgICAgICAg\nICAgIF9wYyA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkubG9hZENsYXNz\nKAogICAgICAgICAgICAgICAgICAgIHRvUENTdWJjbGFzc05hbWUoX21hbmFn\nZWRUeXBlLmdldFR5cGUoKSkpOwogICAgICAgICAgICAgICAgaWYgKF9wYy5n\nZXRTdXBlcmNsYXNzQkMoKSAhPSBfbWFuYWdlZFR5cGUpIHsKICAgICAgICAg\nICAgICAgICAgICBfcGMuc2V0U3VwZXJjbGFzcyhfbWFuYWdlZFR5cGUpOwog\nICAgICAgICAgICAgICAgICAgIF9wYy5zZXRBYnN0cmFjdChfbWFuYWdlZFR5\ncGUuaXNBYnN0cmFjdCgpKTsKICAgICAgICAgICAgICAgICAgICBfcGMuZGVj\nbGFyZUludGVyZmFjZShEeW5hbWljUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNz\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgX2lzQWxyZWFkeVN1YmNsYXNzZWQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBfYmNzQ29uZmlndXJl\nZCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV3Jp\ndGUgdGhlIGdlbmVyYXRlZCBieXRlY29kZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgcmVjb3JkKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGlmIChfbWFuYWdlZFR5cGUgIT0gX3BjICYmIGdldFJlZGVmaW5l\nKCkpCiAgICAgICAgICAgIHJlY29yZChfbWFuYWdlZFR5cGUpOwogICAgICAg\nIHJlY29yZChfcGMpOwogICAgICAgIGlmIChfb2lkcyAhPSBudWxsKQogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9vaWRzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgcmVjb3JkKChCQ0Ns\nYXNzKSBpdHIubmV4dCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRl\nIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJl\nY29yZChCQ0NsYXNzIGJjKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKF93cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgX3dy\naXRlci53cml0ZShiYyk7CiAgICAgICAgZWxzZSBpZiAoX2RpciA9PSBudWxs\nKQogICAgICAgICAgICBiYy53cml0ZSgpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICBGaWxlIGRpciA9IEZpbGVzLmdldFBhY2thZ2VGaWxlKF9kaXIs\nIGJjLmdldFBhY2thZ2VOYW1lKCksIHRydWUpOwogICAgICAgICAgICBiYy53\ncml0ZShuZXcgRmlsZShkaXIsIGJjLmdldENsYXNzTmFtZSgpICsgIi5jbGFz\ncyIpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0\nZSB0aGF0IHRoZSBtZXRob2RzIGluIHRoaXMgcHJvcGVydHktYWNjZXNzIGlu\nc3RhbmNlIGFyZQogICAgICogd3JpdHRlbiBjb3JyZWN0bHkuIFRoaXMgbWV0\naG9kIGFsc28gZ2F0aGVycyBpbmZvcm1hdGlvbiBvbiBlYWNoCiAgICAgKiBw\ncm9wZXJ0eSdzIGJhY2tpbmcgZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB2YWxpZGF0ZVByb3BlcnRpZXMoKSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHM7CiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkp\nCiAgICAgICAgICAgIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZp\nZWxkcygpOwogICAgICAgIE1ldGhvZCBtZXRoOwogICAgICAgIEJDTWV0aG9k\nIGdldHRlciwgc2V0dGVyOwogICAgICAgIEJDRmllbGQgcmV0dXJuZWQsIGFz\nc2lnbmVkID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCEoZm1kc1tpXS5n\nZXRCYWNraW5nTWVtYmVyKCkgaW5zdGFuY2VvZiBNZXRob2QpKSB7CiAgICAg\nICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LWJhZC1tZW1iZXIi\nLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1kc1tpXSwg\nZm1kc1tpXS5nZXRCYWNraW5nTWVtYmVyKCkgfSwKICAgICAgICAgICAgICAg\nICAgICB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBtZXRoID0gKE1ldGhvZCkgZm1kc1tpXS5n\nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgICAgIC8vICMjIyMjIHRoaXMg\nd2lsbCBmYWlsIGlmIHdlIG92ZXJyaWRlIGFuZCBkb24ndCBjYWxsIHN1cGVy\nLgogICAgICAgICAgICBCQ0NsYXNzIGRlY2xhcmluZ1R5cGUgPSBfbWFuYWdl\nZFR5cGUuZ2V0UHJvamVjdCgpCiAgICAgICAgICAgICAgICAubG9hZENsYXNz\nKGZtZHNbaV0uZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgZ2V0\ndGVyID0gZGVjbGFyaW5nVHlwZS5nZXREZWNsYXJlZE1ldGhvZChtZXRoLmdl\ndE5hbWUoKSwKICAgICAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVyVHlw\nZXMoKSk7CiAgICAgICAgICAgIGlmIChnZXR0ZXIgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1uby1nZXR0ZXIi\nLCBuZXcgT2JqZWN0W117IGZtZHNbaV0gfSwKICAgICAgICAgICAgICAgICAg\nICB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybmVkID0gZ2V0UmV0dXJuZWRGaWVsZChn\nZXR0ZXIpOwogICAgICAgICAgICBpZiAocmV0dXJuZWQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJlZ2lzdGVyQmFja2luZ0ZpZWxkSW5mbyhmbWRzW2ld\nLCBnZXR0ZXIsIHJldHVybmVkKTsKCiAgICAgICAgICAgIHNldHRlciA9IGRl\nY2xhcmluZ1R5cGUuZ2V0RGVjbGFyZWRNZXRob2QoZ2V0U2V0dGVyTmFtZShm\nbWRzW2ldKSwKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICBpZiAoc2V0dGVy\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5lZCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9w\nZXJ0eS1uby1zZXR0ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W117IGZtZHNbaV0gfSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFnZXRS\nZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIHN5\nbnRoZXRpYyBzZXR0ZXIKICAgICAgICAgICAgICAgICAgICBzZXR0ZXIgPSBf\nbWFuYWdlZFR5cGUuZGVjbGFyZU1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNb\naV0pLAogICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXXsgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAg\nICAgICAgICAgICAgICBzZXR0ZXIubWFrZVByaXZhdGUoKTsKICAgICAgICAg\nICAgICAgICAgICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQo\ncmV0dXJuZWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAg\nICAgICBpZiAoc2V0dGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBhc3Np\nZ25lZCA9IGdldEFzc2lnbmVkRmllbGQoc2V0dGVyKTsKCiAgICAgICAgICAg\nIGlmIChhc3NpZ25lZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nc2V0dGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJC\nYWNraW5nRmllbGRJbmZvKGZtZHNbaV0sIHNldHRlciwgYXNzaWduZWQpOwoK\nICAgICAgICAgICAgICAgIGlmIChhc3NpZ25lZCAhPSByZXR1cm5lZCkKICAg\nICAgICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LXNldHRl\nci1nZXR0ZXItbWlzbWF0Y2giLCBuZXcgT2JqZWN0W10KICAgICAgICAgICAg\nICAgICAgICAgICAgeyBmbWRzW2ldLCBhc3NpZ25lZC5nZXROYW1lKCksIChy\nZXR1cm5lZCA9PSBudWxsKSAKICAgICAgICAgICAgICAgICAgICAgICAgPyBu\ndWxsIDogcmV0dXJuZWQuZ2V0TmFtZSgpIH0sIGZhbHNlKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVnaXN0\nZXJCYWNraW5nRmllbGRJbmZvKEZpZWxkTWV0YURhdGEgZm1kLCBCQ01ldGhv\nZCBtZXRob2QsCiAgICAgICAgQkNGaWVsZCBmaWVsZCkgewogICAgICAgIGlm\nIChfYmFja2luZ0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICBfYmFja2lu\nZ0ZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2JhY2tpbmdGaWVs\nZHMucHV0KG1ldGhvZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7Cgog\nICAgICAgIGlmIChfYXR0cnNUb0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAg\nICBfYXR0cnNUb0ZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2F0\ndHJzVG9GaWVsZHMucHV0KGZtZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUo\nKSk7CgogICAgICAgIGlmIChfZmllbGRzVG9BdHRycyA9PSBudWxsKQogICAg\nICAgICAgICBfZmllbGRzVG9BdHRycyA9IG5ldyBIYXNoTWFwKCk7CiAgICAg\nICAgX2ZpZWxkc1RvQXR0cnMucHV0KGZpZWxkLmdldE5hbWUoKSwgZm1kLmdl\ndE5hbWUoKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dHJpYnV0\nZVRyYW5zbGF0aW9uKCkgewogICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNl\nKEF0dHJpYnV0ZVRyYW5zbGF0b3IuY2xhc3MpOwogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJBdHRyaWJ1dGVJ\nbmRleFRvRmllbGROYW1lIiwKICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBu\nZXcgQ2xhc3NbXSB7IGludC5jbGFzcyB9KTsKICAgICAgICBtZXRob2QubWFr\nZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRh\nLmdldEZpZWxkcygpOwoKICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAg\nICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgVGFibGVTd2l0\nY2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAg\nICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICB0YWJpbnMuc2V0SGln\naChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAvLyBjYXNlIGk6CiAgICAg\nICAgLy8gICAgIHJldHVybiA8X2F0dHJzVG9GaWVsZHMuZ2V0KGZtZHNbaV0u\nZ2V0TmFtZSgpKT4KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoCiAgICAgICAgICAgICAgICBfYXR0\ncnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5nZXROYW1lKCkpKSk7CiAgICAgICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgLy8gZGVm\nYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQog\nICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9u\nCiAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24u\nY2xhc3MpKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIHNldHRlciBtZXRo\nb2QgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgU3RyaW5nIGdldFNldHRlck5hbWUoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICByZXR1cm4gInNldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFs\naXplKGZtZC5nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBmaWVsZCByZXR1cm5lZCBieSB0aGUgZ2l2ZW4gbWV0aG9kLCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBhbmQg\nc3RhdGljIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBzdGF0aWMgQkNGaWVs\nZCBnZXRSZXR1cm5lZEZpZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAgICAgICBy\nZXR1cm4gZmluZEZpZWxkKG1ldGgsICgoQ29kZSkgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5l\nd0NvZGVBY3Rpb24oKSkpLnhyZXR1cm4oKQogICAgICAgICAgICAuc2V0VHlw\nZShtZXRoLmdldFJldHVyblR5cGUoKSksIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgYXNzaWduZWQgaW4gdGhlIGdp\ndmVuIG1ldGhvZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2FnZS1w\ncm90ZWN0ZWQgYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAg\nc3RhdGljIEJDRmllbGQgZ2V0QXNzaWduZWRGaWVsZChCQ01ldGhvZCBtZXRo\nKSB7CiAgICAgICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoKENvZGUpIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS5wdXRmaWVsZCgpLCB0cnVl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgcmV0\ndXJuZWQgLyBhc3NpZ25lZCBieSA8Y29kZT5tZXRoPC9jb2RlPi4gUmV0dXJu\ncwogICAgICogbnVsbCBpZiBub24tZmllbGRzIChtZXRob2RzLCBsaXRlcmFs\ncywgcGFyYW1ldGVycywgdmFyaWFibGVzKSBhcmUKICAgICAqIHJldHVybmVk\nLCBvciBpZiBub24tcGFyYW1ldGVycyBhcmUgYXNzaWduZWQgdG8gZmllbGRz\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBCQ0ZpZWxkIGZpbmRGaWVs\nZChCQ01ldGhvZCBtZXRoLCBJbnN0cnVjdGlvbiB0ZW1wbGF0ZSwKICAgICAg\nICBib29sZWFuIGZpbmRBY2Nlc3NlZCkgewogICAgICAgIC8vIGlnbm9yZSBh\nbnkgc3RhdGljIG1ldGhvZHMuIE9wZW5KUEEgb25seSBjdXJyZW50bHkgc3Vw\ncG9ydHMKICAgICAgICAvLyBub24tc3RhdGljIHNldHRlcnMgYW5kIGdldHRl\ncnMKICAgICAgICBpZiAobWV0aC5pc1N0YXRpYygpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2Rl\nKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7Cgog\nICAgICAgIEJDRmllbGQgZmllbGQgPSBudWxsLCBjdXI7CiAgICAgICAgSW5z\ndHJ1Y3Rpb24gdGVtcGxhdGVJbnMsIHByZXZJbnMsIGVhcmxpZXJJbnM7CiAg\nICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZSkpIHsK\nICAgICAgICAgICAgaW50IGJhY2t1cENvdW50ID0gMzsKICAgICAgICAgICAg\ndGVtcGxhdGVJbnMgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAgIGlm\nICghY29kZS5oYXNQcmV2aW91cygpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIHByZXZJbnMgPSBjb2RlLnByZXZpb3VzKCk7\nCgogICAgICAgICAgICBpZiAocHJldklucyBpbnN0YW5jZW9mIENsYXNzSW5z\ndHJ1Y3Rpb24KICAgICAgICAgICAgICAgICYmIGNvZGUuaGFzUHJldmlvdXMo\nKSkgewogICAgICAgICAgICAgICAgcHJldklucyA9IGNvZGUucHJldmlvdXMo\nKTsKICAgICAgICAgICAgICAgIGJhY2t1cENvdW50Kys7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmICghY29kZS5oYXNQcmV2aW91cygpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGVhcmxpZXJJ\nbnMgPSBjb2RlLnByZXZpb3VzKCk7CgogICAgICAgICAgICAvLyBpZiB0aGUg\nb3Bjb2RlIHR3byBiZWZvcmUgdGhlIHRlbXBsYXRlIHdhcyBhbiBhbG9hZF8w\nLCBjaGVjawogICAgICAgICAgICAvLyBhZ2FpbnN0IHRoZSBtaWRkbGUgaW5z\ndHJ1Y3Rpb24gYmFzZWQgb24gd2hhdCB0eXBlIG9mIGZpbmQKICAgICAgICAg\nICAgLy8gd2UncmUgZG9pbmcKICAgICAgICAgICAgaWYgKCEoZWFybGllcklu\ncyBpbnN0YW5jZW9mIExvYWRJbnN0cnVjdGlvbikKICAgICAgICAgICAgICAg\nIHx8ICEoKExvYWRJbnN0cnVjdGlvbikgZWFybGllcklucykuaXNUaGlzKCkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8v\nIGlmIHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGEgZ2V0ZmllbGQsIHRo\nZW4gaXQncyB0aGUKICAgICAgICAgICAgLy8gZmllbGQgdGhhdCdzIGJlaW5n\nIGFjY2Vzc2VkCiAgICAgICAgICAgIGlmICghZmluZEFjY2Vzc2VkICYmIHBy\nZXZJbnMgaW5zdGFuY2VvZiBHZXRGaWVsZEluc3RydWN0aW9uKSB7CiAgICAg\nICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZQcmV2SW5zID0g\nKEZpZWxkSW5zdHJ1Y3Rpb24pIHByZXZJbnM7CiAgICAgICAgICAgICAgICBj\ndXIgPSAoQkNGaWVsZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RmllbGRJ\nbnN0cnVjdGlvbkZpZWxkQWN0aW9uKGZQcmV2SW5zKSk7CiAgICAgICAgICAg\nICAgICAvLyBpZiB0aGUgbWlkZGxlIGluc3RydWN0aW9uIHdhcyBhbiB4bG9h\nZF8xLCB0aGVuIHRoZQogICAgICAgICAgICAgICAgLy8gbWF0Y2hlZCBpbnN0\ncnVjdGlvbiBpcyB0aGUgZmllbGQgdGhhdCdzIGJlaW5nIHNldC4KICAgICAg\nICAgICAgfSBlbHNlIGlmIChmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0\nYW5jZW9mIExvYWRJbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgJiYgKChM\nb2FkSW5zdHJ1Y3Rpb24pIHByZXZJbnMpLmdldFBhcmFtKCkgPT0gMCkgewog\nICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0cnVjdGlvbiBmVGVtcGxh\ndGVJbnMgPQogICAgICAgICAgICAgICAgICAgIChGaWVsZEluc3RydWN0aW9u\nKSB0ZW1wbGF0ZUluczsKICAgICAgICAgICAgICAgIGN1ciA9IChCQ0ZpZWxk\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncgogICAgICAgICAgICAgICAgICAgIC5nZXRGaWVsZEluc3RydWN0aW9uRmll\nbGRBY3Rpb24oZlRlbXBsYXRlSW5zKSk7CiAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBpZiAo\nZmllbGQgIT0gbnVsbCAmJiBjdXIgIT0gZmllbGQpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZmllbGQgPSBjdXI7CgogICAg\nICAgICAgICAvLyByZWFkeSBmb3IgbmV4dCBzZWFyY2ggaXRlcmF0aW9uCiAg\nICAgICAgICAgIHdoaWxlIChiYWNrdXBDb3VudCA+IDApIHsKICAgICAgICAg\nICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICAgICAgYmFja3VwQ291\nbnQtLTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nZmllbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgYSB2aW9sYXRp\nb24gb2YgdGhlIHByb3BlcnR5IGFjY2VzcyByZXN0cmljdGlvbnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRWaW9sYXRpb24oU3RyaW5nIGtleSwg\nT2JqZWN0W10gYXJncywgYm9vbGVhbiBmYXRhbCkgewogICAgICAgIGlmIChf\ndmlvbGF0aW9ucyA9PSBudWxsKQogICAgICAgICAgICBfdmlvbGF0aW9ucyA9\nIG5ldyBIYXNoU2V0KCk7CiAgICAgICAgX3Zpb2xhdGlvbnMuYWRkKF9sb2Mu\nZ2V0KGtleSwgYXJncykpOwogICAgICAgIF9mYWlsIHw9IGZhdGFsOwogICAg\nfQoKICAgIC8qKgogICAgICogTG9nIC8gdGhyb3cgcmVjb3JkZWQgcHJvcGVy\ndHkgYWNjZXNzIHZpb2xhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwcm9jZXNzVmlvbGF0aW9ucygpIHsKICAgICAgICBpZiAoX3Zpb2xhdGlv\nbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJp\nbmcgc2VwID0gSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRvcigpOwog\nICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7\nCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfdmlvbGF0aW9ucy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBidWYuYXBw\nZW5kKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQo\nKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VwKTsKICAgICAgICB9\nCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgicHJvcGVydHktdmlv\nbGF0aW9ucyIsIGJ1Zik7CgogICAgICAgIGlmIChfZmFpbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24obXNnKTsKICAgICAgICBpZiAo\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fybiht\nc2cpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZWQgYWxsIGRpcmVj\ndCBhY2Nlc3MgdG8gbWFuYWdlZCBmaWVsZHMgd2l0aCB0aGUgYXBwcm9wcmlh\ndGUKICAgICAqIHBjR2V0L3BjU2V0IG1ldGhvZC4gTm90ZSB0aGF0IHRoaXMg\naW5jbHVkZXMgYWNjZXNzIHRvIGZpZWxkcwogICAgICogb3duZWQgYnkgUGVy\nc2lzdGVuY2VDYXBhYmxlIGNsYXNzZXMgb3RoZXIgdGhhbiB0aGlzIG9uZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRWYWxpZGF0ZUZp\nZWxkQWNjZXNzKCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gY3JlYXRlIHRlbXBsYXRlIHB1dGZpZWxkL2dldGZpZWxkIGlu\nc3RydWN0aW9ucyB0byBzZWFyY2ggZm9yCiAgICAgICAgQ29kZSB0ZW1wbGF0\nZSA9IChDb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAg\nICAgICBJbnN0cnVjdGlvbiBwdXQgPSB0ZW1wbGF0ZS5wdXRmaWVsZCgpOwog\nICAgICAgIEluc3RydWN0aW9uIGdldCA9IHRlbXBsYXRlLmdldGZpZWxkKCk7\nCiAgICAgICAgSW5zdHJ1Y3Rpb24gc3RhdCA9IHRlbXBsYXRlLmludm9rZXN0\nYXRpYygpOwoKICAgICAgICAvLyBsb29rIHRocm91Z2ggYWxsIG1ldGhvZHM7\nIHRoaXMgaXMgZG9uZSBiZWZvcmUgYW55IG1ldGhvZHMgYXJlIGFkZGVkCiAg\nICAgICAgLy8gc28gd2UgZG9uJ3QgbmVlZCB0byB3b3JyeSBhYm91dCBleGNs\ndWRpbmcgc3ludGhldGljIG1ldGhvZHMuCiAgICAgICAgQkNNZXRob2RbXSBt\nZXRob2RzID0gX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kcygpOwog\nICAgICAgIENvZGUgY29kZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG1ldGhvZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZSA9IG1l\ndGhvZHNbaV0uZ2V0Q29kZShmYWxzZSk7CgogICAgICAgICAgICAvLyBkb24n\ndCBtb2RpZnkgdGhlIG1ldGhvZHMgc3BlY2lmaWVkIGJ5IHRoZSBhdXhpbGlh\ncnkgZW5oYW5jZXJzCiAgICAgICAgICAgIGlmIChjb2RlICE9IG51bGwgJiYg\nIXNraXBFbmhhbmNlKG1ldGhvZHNbaV0pKSB7CiAgICAgICAgICAgICAgICBy\nZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBnZXQsIHRydWUs\nIHN0YXQpOwogICAgICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmll\nbGRBY2Nlc3MoY29kZSwgcHV0LCBmYWxzZSwgc3RhdCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlcyBh\nbGwgaW5zdHJ1Y3Rpb25zIG1hdGNoaW5nIHRoZSBnaXZlbiB0ZW1wbGF0ZSBp\nbiB0aGUgZ2l2ZW4KICAgICAqIGNvZGUgYmxvY2sgd2l0aCBjYWxscyB0byB0\naGUgYXBwcm9wcmlhdGUgZ2VuZXJhdGVkIGdldHRlci9zZXR0ZXIuCiAgICAg\nKgogICAgICogQHBhcmFtIGNvZGUgdGhlIGNvZGUgYmxvY2sgdG8gbW9kaWZ5\nOyB0aGUgY29kZSBpdGVyYXRvciB3aWxsCiAgICAgKiBiZSBwbGFjZWQgYmVm\nb3JlIHRoZSBmaXJzdCBpbnN0cnVjdGlvbiBvbiBtZXRob2Qgc3RhcnQsCiAg\nICAgKiBhbmQgd2lsbCBiZSBhZnRlciB0aGUgbGFzdCBpbnN0cnVjdGlvbiBv\nbiBtZXRob2QgY29tcGxldGlvbgogICAgICogQHBhcmFtIGlucyB0aGUgdGVt\ncGxhdGUgaW5zdHJ1Y3Rpb24gdG8gc2VhcmNoIGZvcjsgZWl0aGVyIGEKICAg\nICAqIGdldGZpZWxkIG9yIHB1dGZpZWxkIGluc3RydWN0aW9uCiAgICAgKiBA\ncGFyYW0gZ2V0IGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGlzIGlzIGEgZ2V0\nIGluc3RydWN0aW9uCiAgICAgKiBAcGFyYW0gc3RhdCB0ZW1wbGF0ZSBpbnZv\na2VzdGF0aWMgaW5zdHJ1Y3Rpb24gdG8gcmVwbGFjZSB3aXRoCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vz\ncyhDb2RlIGNvZGUsIEluc3RydWN0aW9uIGlucywKICAgICAgICBib29sZWFu\nIGdldCwgSW5zdHJ1Y3Rpb24gc3RhdCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAg\nICBGaWVsZEluc3RydWN0aW9uIGZpOwogICAgICAgIE1ldGhvZEluc3RydWN0\naW9uIG1pOwogICAgICAgIENsYXNzTWV0YURhdGEgb3duZXI7CiAgICAgICAg\nU3RyaW5nIG5hbWUsIHR5cGVOYW1lLCBtZXRob2ROYW1lOwogICAgICAgIHdo\naWxlIChjb2RlLnNlYXJjaEZvcndhcmQoaW5zKSkgewogICAgICAgICAgICAv\nLyBiYWNrIHVwIHRvIHRoZSBtYXRjaGVkIGluc3RydWN0aW9uCiAgICAgICAg\nICAgIGZpID0gKEZpZWxkSW5zdHJ1Y3Rpb24pIGNvZGUucHJldmlvdXMoKTsK\nICAgICAgICAgICAgbmFtZSA9IGZpLmdldEZpZWxkTmFtZSgpOwogICAgICAg\nICAgICB0eXBlTmFtZSA9IGZpLmdldEZpZWxkVHlwZU5hbWUoKTsKICAgICAg\nICAgICAgb3duZXIgPSBnZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihuYW1l\nLCBmaS5nZXRGaWVsZERlY2xhcmVyVHlwZSgpKTsKCiAgICAgICAgICAgIGlm\nIChvd25lciAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBvd25lci5nZXRB\nY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkp\nIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGRpcmVjdGx5IGFjY2Vz\nc2luZyBhIGZpZWxkIGluIGFub3RoZXIgY2xhc3MKICAgICAgICAgICAgICAg\nIC8vIGhpZXJhcmNoeSB0aGF0IHVzZXMgcHJvcGVydHkgYWNjZXNzLCBzb21l\ndGhpbmcgaXMgd3JvbmcKICAgICAgICAgICAgICAgIGlmIChvd25lciAhPSBf\nbWV0YSAmJiBvd25lci5nZXREZWNsYXJlZEZpZWxkKG5hbWUpICE9IG51bGwg\nJiYKICAgICAgICAgICAgICAgICAgICBfbWV0YSAhPSBudWxsICYmICFvd25l\nci5nZXREZXNjcmliZWRUeXBlKCkKICAgICAgICAgICAgICAgICAgICAgICAg\nLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgicHJvcGVydHktZmllbGQtYWNjZXNzIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBfbWV0YSwgb3duZXIsIG5hbWUs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmdldE1ldGhvZCgp\nLmdldE5hbWUoKSB9KSk7CgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUg\nZGlyZWN0bHkgYWNjZXNzaW5nIGEgcHJvcGVydHktYmFja2luZyBmaWVsZCBv\ndXRzaWRlCiAgICAgICAgICAgICAgICAvLyB0aGUgcHJvcGVydHkgaW4gb3Vy\nIG93biBjbGFzcywgbm90aWZ5IHVzZXIKICAgICAgICAgICAgICAgIGlmIChp\nc0JhY2tpbmdGaWVsZE9mQW5vdGhlclByb3BlcnR5KG5hbWUsIGNvZGUpKQog\nICAgICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktZmll\nbGQtYWNjZXNzIiwgbmV3IE9iamVjdFtdeyBfbWV0YSwKICAgICAgICAgICAg\nICAgICAgICAgICAgb3duZXIsIG5hbWUsIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0\nTmFtZSgpIH0sIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKG93bmVyID09IG51bGwgfHwKICAgICAgICAgICAgICAgIG93bmVyLmdl\ndERlY2xhcmVkRmllbGQoZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSkpID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIG5vdCBwZXJzaXN0ZW50IGZp\nZWxkPwogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghZ2V0UmVk\nZWZpbmUoKSAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKQogICAgICAgICAgICAg\nICAgJiYgb3duZXIuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEu\nQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgICAgICAvLyByZXBsYWNlIHRo\nZSBpbnN0cnVjdGlvbiB3aXRoIGEgY2FsbCB0byB0aGUgZ2VuZXJhdGVkIGFj\nY2VzcwogICAgICAgICAgICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAgICAg\nICBtaSA9IChNZXRob2RJbnN0cnVjdGlvbikgY29kZS5zZXQoc3RhdCk7Cgog\nICAgICAgICAgICAgICAgLy8gaW52b2tlIHRoZSBwcm9wZXIgYWNjZXNzIG1l\ndGhvZCwgd2hldGhlciBnZXR0ZXIgb3Igc2V0dGVyCiAgICAgICAgICAgICAg\nICBTdHJpbmcgcHJlZml4ID0gKGdldCkgPyBQUkUgKyAiR2V0IiA6IFBSRSAr\nICJTZXQiOwogICAgICAgICAgICAgICAgbWV0aG9kTmFtZSA9IHByZWZpeCAr\nIG5hbWU7CiAgICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAgICAg\nICAgICAgICAgbWkuc2V0TWV0aG9kKGdldFR5cGUob3duZXIpLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZSwgdHlwZU5h\nbWUsIG5ldyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGdl\ndFR5cGUob3duZXIpLmdldE5hbWUoKSB9KTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWkuc2V0TWV0aG9kKGdldFR5\ncGUob3duZXIpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nbWV0aG9kTmFtZSwgInZvaWQiLCBuZXcgU3RyaW5nW10KICAgICAgICAgICAg\nICAgICAgICAgICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1lKCksIHR5cGVO\nYW1lIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29k\nZS5uZXh0KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2V0UmVkZWZpbmUo\nKSkgewogICAgICAgICAgICAgICAgbmFtZSA9IGZyb21CYWNraW5nRmllbGRO\nYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKGdldCkgewogICAgICAg\nICAgICAgICAgICAgIGFkZE5vdGlmeUFjY2Vzcyhjb2RlLCBvd25lci5nZXRG\naWVsZChuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIC8vIGluc2VydCB0aGUgc2V0IG9wZXJhdGlvbnMgYWZ0ZXIgdGhlIGZpZWxk\nIG11dGF0aW9uLCBidXQKICAgICAgICAgICAgICAgICAgICAvLyBmaXJzdCBs\nb2FkIHRoZSBvbGQgdmFsdWUgZm9yIHVzZSBpbiB0aGUKICAgICAgICAgICAg\nICAgICAgICAvLyBTdGF0ZU1hbmFnZXIuc2V0dGluZ1hYWCBtZXRob2QuCiAg\nICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0cnVj\ndGlvbiBmRmkgPSBmaTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoCiAgICAgICAgICAgICAgICAgICAgICAgIChCQ0Zp\nZWxkKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldEZpZWxkSW5z\ndHJ1Y3Rpb25GaWVsZEFjdGlvbihmRmkpKSk7CiAgICAgICAgICAgICAgICAg\nICAgaW50IHZhbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS54c3RvcmUoKS5zZXRMb2NhbCh2YWwpLnNl\ndFR5cGUoZmkuZ2V0RmllbGRUeXBlKCkpOwoKICAgICAgICAgICAgICAgICAg\nICAvLyBtb3ZlIHBhc3QgdGhlIHB1dGZpZWxkCiAgICAgICAgICAgICAgICAg\nICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYWRkTm90aWZ5\nTXV0YXRpb24oY29kZSwgb3duZXIuZ2V0RmllbGQobmFtZSksIHZhbCwgLTEp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgYWRkTm90aWZ5QWNjZXNzKENvZGUgY29kZSwgRmll\nbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBQQ0hlbHBlci5hY2Nlc3Np\nbmdGaWVsZCh0aGlzLCA8YWJzb2x1dGUtaW5kZXg+KTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgY29kZS5pbnZva2Vz\ndGF0aWMoKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNzLAog\nICAgICAgICAgICAiYWNjZXNzaW5nRmllbGQiLCB2b2lkLmNsYXNzLAogICAg\nICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNsYXNz\nIH0pOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtdXN0IGJlIGNhbGxl\nZCBhZnRlciBzZXR0aW5nIHRoZSB2YWx1ZSBpbiB0aGUgb2JqZWN0LgogICAg\nICogCiAgICAgKiBAcGFyYW0gY29kZQogICAgICogQHBhcmFtIHZhbCB0aGUg\ncG9zaXRpb24gaW4gdGhlIGxvY2FsIHZhcmlhYmxlIHRhYmxlIHdoZXJlIHRo\nZQogICAgICogb2xkIHZhbHVlIGlzIHN0b3JlZAogICAgICogQHBhcmFtIHBh\ncmFtIHRoZSBwYXJhbWV0ZXIgcG9zaXRpb24gY29udGFpbmluZyB0aGUgbmV3\nIHZhbHVlLCBvcgogICAgICogLTEgaWYgdGhlIG5ldyB2YWx1ZSBpcyB1bmF2\nYWlsYWJsZSBhbmQgc2hvdWxkIHRoZXJlZm9yZSBiZSBsb29rZWQKICAgICAq\nIHVwLgogICAgICogQHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5vdGlmeU11dGF0aW9uKENvZGUg\nY29kZSwgRmllbGRNZXRhRGF0YSBmbWQsIGludCB2YWwsCiAgICAgICAgaW50\nIHBhcmFtKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIC8vIFBDSGVscGVyLnNldHRpbmdGaWVsZCh0aGlzLCA8YWJz\nb2x1dGUtaW5kZXg+LCBvbGQsIG5ldyk7CiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZm1kLmdldEluZGV4KCkpOwogICAgICAgIENsYXNzIHR5cGUgPSBmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCk7CiAgICAgICAgLy8gd2Ugb25seSBoYXZlIHNwZWNp\nYWwgc2lnbmF0dXJlcyBmb3IgcHJpbWl0aXZlcyBhbmQgU3RyaW5ncwogICAg\nICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gU3RyaW5n\nLmNsYXNzKQogICAgICAgICAgICB0eXBlID0gT2JqZWN0LmNsYXNzOwogICAg\nICAgIGNvZGUueGxvYWQoKS5zZXRMb2NhbCh2YWwpLnNldFR5cGUodHlwZSk7\nCiAgICAgICAgaWYgKHBhcmFtID09IC0xKSB7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKHBhcmFtKS5z\nZXRUeXBlKHR5cGUpOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsICJz\nZXR0aW5nRmllbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7CiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIGludC5jbGFz\ncywgdHlwZSwgdHlwZQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGluc3RydWN0aW9uIGFjY2Vz\nc2VzIGEgZmllbGQgdGhhdCBpcyBhIGJhY2tpbmcKICAgICAqIGZpZWxkIG9m\nIGFub3RoZXIgcHJvcGVydHkgaW4gdGhpcyBwcm9wZXJ0eS1hY2Nlc3MgY2xh\nc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0JhY2tpbmdGaWVs\nZE9mQW5vdGhlclByb3BlcnR5KFN0cmluZyBuYW1lLCBDb2RlIGNvZGUpIHsK\nICAgICAgICBTdHJpbmcgbWV0aE5hbWUgPSBjb2RlLmdldE1ldGhvZCgpLmdl\ndE5hbWUoKTsKICAgICAgICByZXR1cm4gISI8aW5pdD4iLmVxdWFscyhtZXRo\nTmFtZSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMgIT0gbnVsbAog\nICAgICAgICAgICAmJiAhbmFtZS5lcXVhbHMoX2JhY2tpbmdGaWVsZHMuZ2V0\nKG1ldGhOYW1lKSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMuY29u\ndGFpbnNWYWx1ZShuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBl\nciBtZXRob2QgdG8gcmV0dXJuIHRoZSBkZWNsYXJpbmcgUGVyc2lzdGVuY2VD\nYXBhYmxlIGNsYXNzIG9mCiAgICAgKiB0aGUgZ2l2ZW4gZmllbGQuCiAgICAg\nKgogICAgICogQHBhcmFtIGZpZWxkTmFtZSB0aGUgbmFtZSBvZiB0aGUgZmll\nbGQKICAgICAqIEBwYXJhbSBvd25lciB0aGUgbm9taW5hbCBvd25lciBvZiB0\naGUgZmllbGQKICAgICAqIEByZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUg\nUGVyc2lzdGVuY2VDYXBhYmxlIHR5cGUgdGhhdAogICAgICogZGVjbGFyZXMg\ndGhlIGZpZWxkIChhbmQgdGhlcmVmb3JlIGhhcyB0aGUgc3RhdGljIG1ldGhv\nZCksIG9yIG51bGwgaWYgbm9uZQogICAgICovCiAgICBwcml2YXRlIENsYXNz\nTWV0YURhdGEgZ2V0UGVyc2lzdGVuY2VDYXBhYmxlT3duZXIoU3RyaW5nIGZp\nZWxkTmFtZSwKICAgICAgICBDbGFzcyBvd25lcikgewogICAgICAgIC8vIGZp\nbmQgdGhlIGFjdHVhbCBhbmNlc3RvciBjbGFzcyB0aGF0IGRlY2xhcmVzIHRo\nZSBmaWVsZCwgdGhlbgogICAgICAgIC8vIGNoZWNrIGlmIHRoZSBjbGFzcyBp\ncyBwZXJzaXN0ZW50LCBhbmQgaWYgdGhlIGZpZWxkIGlzIG1hbmFnZWQKICAg\nICAgICBGaWVsZCBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQob3duZXIsIGZp\nZWxkTmFtZSwgZmFsc2UpOwogICAgICAgIGlmIChmID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBtYW5hZ2VkIGludGVy\nZmFjZQogICAgICAgIGlmIChfbWV0YSAhPSBudWxsICYmIF9tZXRhLmdldERl\nc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICByZXR1\ncm4gX21ldGE7CgogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0TWV0YURhdGEo\nZi5nZXREZWNsYXJpbmdDbGFzcygpLCBudWxsLCBmYWxzZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIGFsbCBzeW50aGV0aWMgbWV0aG9kcyB0byB0\naGUgYnl0ZWNvZGUgYnkgZGVsZWdhdGluZyB0bwogICAgICogdGhlIHZhcmlv\ndXMgYWRkWFhYTWV0aG9kcyAoKSBmdW5jdGlvbnMgaW4gdGhpcyBjbGFzcy4g\nSW5jbHVkZXMKICAgICAqIGFsbCBzdGF0aWMgZmllbGQgYWNjZXNzIG1ldGhv\nZHMuCiAgICAgKiBOb3RlIHRoYXQgdGhlICdzdG9jaycgbWV0aG9kcyBsaWtl\nIDxjb2RlPnBjSXNUcmFuc2FjdGlvbmFsPC9jb2RlPiwKICAgICAqIDxjb2Rl\nPnBjRmV0Y2hPYmplY3RJZDwvY29kZT4sIGV0YyBhcmUgZGVmaW5lZCBvbmx5\nIGluIHRoZQogICAgICogbGVhc3QtZGVyaXZlZCBQZXJzaXN0ZW5jZUNhcGFi\nbGUgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFBDTWV0aG9k\ncygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgYWRkQ2xlYXJGaWVsZHNNZXRob2QoKTsKICAgICAgICBhZGROZXdJ\nbnN0YW5jZU1ldGhvZCh0cnVlKTsKICAgICAgICBhZGROZXdJbnN0YW5jZU1l\ndGhvZChmYWxzZSk7CiAgICAgICAgYWRkTWFuYWdlZEZpZWxkQ291bnRNZXRo\nb2QoKTsKICAgICAgICBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpOwogICAg\nICAgIGFkZFByb3ZpZGVGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRkQ29w\neUZpZWxkc01ldGhvZCgpOwoKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBl\ncmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAg\nICAgICAgICAgIGFkZFN0b2NrTWV0aG9kcygpOwogICAgICAgICAgICBhZGRH\nZXRWZXJzaW9uTWV0aG9kKCk7CiAgICAgICAgICAgIGFkZFJlcGxhY2VTdGF0\nZU1hbmFnZXJNZXRob2QoKTsKCiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9O\nKQogICAgICAgICAgICAgICAgYWRkTm9PcEFwcGxpY2F0aW9uSWRlbnRpdHlN\nZXRob2RzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgdGhlIGFwcCBp\nZCBtZXRob2RzIHRvIGVhY2ggc3ViY2xhc3MgcmF0aGVyCiAgICAgICAgLy8g\ndGhhbiBqdXN0IHRoZSBzdXBlcmNsYXNzLCBzaW5jZSBpdCBpcyBwb3NzaWJs\nZSB0byBoYXZlCiAgICAgICAgLy8gYSBzdWJjbGFzcyB3aXRoIGFuIGFwcCBp\nZCBoaWVyYXJjaHkgdGhhdCBtYXRjaGVzIHRoZQogICAgICAgIC8vIHBlcnNp\nc3RlbnQgY2xhc3MgaW5oZXJpdGFuY2UgaGllcmFyY2h5CiAgICAgICAgaWYg\nKF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURf\nQVBQTElDQVRJT04KICAgICAgICAgICAgJiYgKF9tZXRhLmdldFBDU3VwZXJj\nbGFzcygpID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSB8fAogICAg\nICAgICAgICAgICAgX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgIT0KICAgICAg\nICAgICAgICAgICAgICBfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nLmdldE9iamVjdElkVHlwZSgpKSkgewogICAgICAgICAgICBhZGRDb3B5S2V5\nRmllbGRzVG9PYmplY3RJZE1ldGhvZCh0cnVlKTsKICAgICAgICAgICAgYWRk\nQ29weUtleUZpZWxkc1RvT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAgICAg\nICAgICBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKHRydWUp\nOwogICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0\naG9kKGZhbHNlKTsKICAgICAgICAgICAgaWYgKF9tZXRhLmhhc0Fic3RyYWN0\nUEtGaWVsZCgpID09IHRydWUpIHsKICAgICAgICAgICAgICAgIGFkZEdldElE\nT3duaW5nQ2xhc3MoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRO\nZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKHRydWUpOwogICAgICAgICAgICBh\nZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAgICAgICB9\nIGVsc2UgaWYgKF9tZXRhLmhhc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3Mo\nKSkgewogICAgICAgICAgICBhZGRHZXRJRE93bmluZ0NsYXNzKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbWV0aG9kIHRvIGNs\nZWFyIGFsbCBwZXJzaXN0ZW50IGZpZWxkczsgd2UnbGwgY2FsbCB0aGlzIGZy\nb20KICAgICAqIHRoZSBuZXcgaW5zdGFuY2UgbWV0aG9kIHRvIGVuc3VyZSB0\naGF0IHVubG9hZGVkIGZpZWxkcyBoYXZlCiAgICAgKiBkZWZhdWx0IHZhbHVl\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENsZWFyRmllbGRzTWV0\naG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBwcm90ZWN0ZWQgdm9pZCBwY0NsZWFyRmllbGRzICgpCiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbnVs\nbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\nc3VwZXIucGNDbGVhckZpZWxkcyAoKQogICAgICAgIGlmIChfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBl\nKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKSksIFBSRSArICJDbGVhckZpZWxkcyIsIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgICAgICBudWxsKTsKICAgICAgICB9CgogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZp\nZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5ET1VCTEU6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDBEKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFkZFNldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgfQoKICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIDxjb2RlPnBjTmV3SW5z\ndGFuY2U8L2NvZGU+IG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKiBU\naGVzZSBtZXRob2RzIGFyZSB1c2VkIGJ5IHRoZSBpbXBsIGhlbHBlciB0byBj\ncmVhdGUgbmV3CiAgICAgKiBtYW5hZ2VkIGluc3RhbmNlcyBlZmZpY2llbnRs\neSB3aXRob3V0IHJlZmxlY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIG9p\nZCBzZXQgdG8gdHJ1ZSB0byBtaW1pYyB0aGUgbWV0aG9kIHZlcnNpb24gdGhh\ndCB0YWtlcwogICAgICogYW4gb2lkIHZhbHVlIGFzIHdlbGwgYXMgYSBzdGF0\nZSBtYW5hZ2VyCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROZXdJbnN0\nYW5jZU1ldGhvZChib29sZWFuIG9pZCkgewogICAgICAgIC8vIHB1YmxpYyBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGNOZXdJbnN0YW5jZSAoLi4uKQogICAgICAg\nIENsYXNzW10gYXJncyA9CiAgICAgICAgICAgIChvaWQpID8gbmV3IENsYXNz\nW117IFNNVFlQRSwgT2JqZWN0LmNsYXNzLCBib29sZWFuLmNsYXNzIH0KICAg\nICAgICAgICAgICAgIDogbmV3IENsYXNzW117IFNNVFlQRSwgYm9vbGVhbi5j\nbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArICJOZXdJbnN0YW5jZSIsIFBDVFlQRSwgYXJncyk7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIC8vIGlmIHRoZSB0eXBlIGlzIGFic3RyYWN0LCB0aHJvdyBhIFVzZXJF\neGNlcHRpb24KICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkgewogICAg\nICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBVU0VSRVhDRVApOwogICAg\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgLy8gWFhYIHBjID0gbmV3IFhYWCAoKTsKICAgICAgICBjb2RlLmFu\nZXcoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAg\nICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZv\naWQuY2xhc3MsIG51bGwpOwogICAgICAgIGludCBpbnN0ID0gY29kZS5nZXRO\nZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExv\nY2FsKGluc3QpOwoKICAgICAgICAvLyBpZiAoY2xlYXIpCiAgICAgICAgLy8g\nICBwYy5wY0NsZWFyRmllbGRzICgpOwogICAgICAgIGNvZGUuaWxvYWQoKS5z\nZXRQYXJhbSgob2lkKSA/IDIgOiAxKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gbm9jbGVhciA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywg\nbnVsbCk7CgogICAgICAgIC8vIHBjLnBjU3RhdGVNYW5hZ2VyID0gc207CiAg\nICAgICAgbm9jbGVhci5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldExvY2Fs\nKGluc3QpKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwoK\nICAgICAgICAvLyBjb3B5IGtleSBmaWVsZHMgZnJvbSBvaWQKICAgICAgICBp\nZiAob2lkKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChp\nbnN0KTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJF\nICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsK\nICAgICAgICB9CgogICAgICAgIC8vIHJldHVybiBwYzsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyB0aGUgPGNvZGU+cHJvdGVjdGVkIHN0YXRpYyBpbnQgcGNH\nZXRNYW5hZ2VkRmllbGRDb3VudCAoKTwvY29kZT4KICAgICAqIG1ldGhvZCB0\nbyB0aGUgYnl0ZWNvZGUsIHJldHVybmluZyB0aGUgaW5oZXJpdGVkIGZpZWxk\nIGNvdW50IGFkZGVkCiAgICAgKiB0byB0aGUgbnVtYmVyIG9mIG1hbmFnZWQg\nZmllbGRzIGluIHRoZSBjdXJyZW50IFBlcnNpc3RlbmNlQ2FwYWJsZSBjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE1hbmFnZWRGaWVsZENv\ndW50TWV0aG9kKCkgewogICAgICAgIC8vIHByb3RlY3RlZCBzdGF0aWMgaW50\nIHBjR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0TWFuYWdlZEZp\nZWxkQ291bnQiLAogICAgICAgICAgICBpbnQuY2xhc3MsIG51bGwpOwogICAg\nICAgIG1ldGhvZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgbWV0aG9kLm1h\na2VQcm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgcGNJ\nbmhlcml0ZWRGaWVsZENvdW50CiAgICAgICAgLy8gYXdoaXRlOiB0aGUgYWJv\ndmUgc2hvdWxkIHdvcmssIGJ1dCBJJ20gc2VlaW5nIGEgbWVzc2VkIHVwIHNp\ndHVhdGlvbgogICAgICAgIC8vIGFsbCBvZiBhIHN1ZGRlbiB3aGVyZSB3aGVu\nIGEgc3ViY2xhc3MgY2FsbHMgdGhpcyBtZXRob2QsIGl0IHNvbWVob3cKICAg\nICAgICAvLyBoYXBwZW5zIGJlZm9yZSA8Y2xpbml0PiBpcyBldmVyIGludm9r\nZWQsIGFuZCBzbyBvdXIKICAgICAgICAvLyBwY0luaGVyaXRlZEZpZWxkQ291\nbnQgZmllbGQgaXNuJ3QgaW5pdGlhbGl6ZWQhICBzbyBpbnN0ZWFkLAogICAg\nICAgIC8vIHJldHVybiA8ZmllbGRzPiArIDxzdXBlcmNsYXNzPi5wY0dldE1h\nbmFnZWRGaWVsZENvdW50ICgpCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCkubGVuZ3RoKTsKICAg\nICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCkgewog\nICAgICAgICAgICBDbGFzcyBzdXBlckNsYXNzID0gZ2V0VHlwZShfbWV0YS5n\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKTsKICAgICAgICAgICAgU3RyaW5n\nIHN1cGVyTmFtZSA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPwogICAgICAgICAg\nICAgICAgUENFbmhhbmNlci50b1BDU3ViY2xhc3NOYW1lKHN1cGVyQ2xhc3Mp\nIDoKICAgICAgICAgICAgICAgIHN1cGVyQ2xhc3MuZ2V0TmFtZSgpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChzdXBlck5h\nbWUsCiAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFuYWdlZEZpZWxkQ291\nbnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAgICAg\nY29kZS5pYWRkKCk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaXJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFi\nbGUjcGNQcm92aWRlRmllbGR9IGFuZAogICAgICoge0BsaW5rIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSNwY1Byb3ZpZGVGaWVsZHN9IG1ldGhvZHMgdG8gdGhlIGJ5\ndGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUHJvdmlkZUZp\nZWxkc01ldGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjUHJvdmlkZUZpZWxk\nIChpbnQgZmllbGROdW1iZXIpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlByb3ZpZGVGaWVsZCIsIHZvaWQu\nY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2gg\nKCkKICAgICAgICBpbnQgcmVsTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQ\nUkUgKyAiUHJvdmlkZUZpZWxkIiwgY29kZSk7CgogICAgICAgIC8vIGlmIG5v\nIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFz\ncygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5n\nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChmbWRzLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICAgICAgY29kZS5pbG9h\nZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgVGFibGVTd2l0\nY2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAg\nICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlu\ncy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAvLyA8\nZmllbGQ+ID0gcGNTdGF0ZU1hbmFnZXIucHJvdmlkZWQ8dHlwZT5GaWVsZAog\nICAgICAgICAgICAvLyAgICAgKHRoaXMsIGZpZWxkTnVtYmVyKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNb\naV0pOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5z\nZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgICAg\nICAgICAgKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksICJwcm92aWRlZCIs\nIGZhbHNlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRo\ncm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAg\nICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAg\nICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24u\nY2xhc3MpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoK\nICAgICAgICBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9k\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJz\naXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlRmllbGR9IGFuZAogICAgICoge0Bs\naW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZHN9IG1ldGhv\nZHMgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkUmVwbGFjZUZpZWxkc01ldGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBj\nUmVwbGFjZUZpZWxkIChpbnQgZmllbGROdW1iZXIpCiAgICAgICAgQkNNZXRo\nb2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlcGxhY2VG\naWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBp\nbnQuY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJvdWdo\nIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVsTG9jYWwgPSBiZWdpblN3\naXRjaE1ldGhvZChQUkUgKyAiUmVwbGFjZUZpZWxkIiwgY29kZSk7CgogICAg\nICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3QgdGhyb3cg\nZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRD\ncmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAg\nICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChm\nbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihj\nb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAg\nIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICAg\nICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICAg\nICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxl\nc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7CiAgICAg\nICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7CgogICAg\nICAgICAgICAvLyA8ZmllbGQ+ID0gcGNTdGF0ZU1hbmFnZXIucmVwbGFjZTx0\neXBlPkZpZWxkCiAgICAgICAgICAgIC8vICAodGhpcywgZmllbGROdW1iZXIp\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIGZvciB0aGUgYWRkU2V0TWFu\nYWdlZFZhbHVlQ29kZSBjYWxsIGJlbG93LgogICAgICAgICAgICAgICAgdGFi\naW5zLmFkZFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKSk7CgogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUu\naWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKGdldFN0YXRlTWFuYWdlck1ldGhv\nZAogICAgICAgICAgICAgICAgICAgIChmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZSgpLCAicmVwbGFjZSIsIHRydWUsIGZhbHNlKSk7CiAgICAgICAgICAgICAg\nICBpZiAoIWZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkuaXNQcmltaXRpdmUo\nKSkKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAgICAgICAg\nICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAg\nICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYoX2FkZFZlcnNpb25J\nbml0RmxhZyl7CiAgICAgICAgICAgICAgICAgICAgaWYoZm1kc1tpXS5pc1Zl\ncnNpb24oKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMg\nY2FzZSBpcyBzZXR0aW5nIHRoZSB2ZXJzaW9uIGZpZWxkCiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIHBjVmVyc2lvbkluaXQgPSB0cnVlOwogICAgICAg\nICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDEpOwogICAgICAgICAgICAgICAgICAgICAgICBwdXRmaWVs\nZChjb2RlLCBudWxsLCBWRVJTSU9OX0lOSVRfU1RSLCBib29sZWFuLmNsYXNz\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0YWJpbnMuc2V0RGVmYXVs\ndFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAgICAgICAgKGNvZGUs\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwogICAgICAgIH0K\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIGFkZE11bHRpcGxl\nRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0Nv\ncHlGaWVsZHN9IG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRDb3B5RmllbGRzTWV0aG9kKCkKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJs\naWMgdm9pZCBwY0NvcHlGaWVsZCAoT2JqZWN0IHBjLCBpbnQgZmllbGQpCiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkNvcHlGaWVsZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFt\nZSgpLAogICAgICAgICAgICBuZXcgU3RyaW5nW117IF9tYW5hZ2VkVHlwZS5n\nZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkgfSk7CiAgICAgICAgbWV0\naG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5n\nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9\nIGJlZ2luU3dpdGNoTWV0aG9kKFBSRSArICJDb3B5RmllbGQiLCBjb2RlKTsK\nCiAgICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0\naHJvdyBleGNlcHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9\nIGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAg\nICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAg\naWYgKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0\naW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAg\nICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUu\ndGFibGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsK\nICAgICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsK\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgLy8gPGZpZWxkPiA9IG90aGVyLjxm\naWVsZD47CiAgICAgICAgICAgICAgICAvLyBvciBzZXQ8ZmllbGQ+IChvdGhl\nci5nZXQ8ZmllbGQ+KTsKICAgICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJn\nZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIGZtZHNbaV0pOwoKICAgICAgICAgICAgICAgIC8vIGJyZWFrOwog\nICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAgdGFiaW5zLnNldERlZmF1\nbHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgICAgIChjb2Rl\nLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKICAgICAgICB9\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBhZGRNdWx0aXBs\nZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9kKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRoZSBjb2RlIGNvbW1vbiB0\nbyB0aGUgYmVnaW5uaW5nIG9mIGJvdGggdGhlCiAgICAgKiBwY1JlcGxhY2VG\naWVsZCBtZXRob2QgYW5kIHRoZSBwY1Byb3ZpZGVGaWVsZCBtZXRob2QuIFRo\naXMgaW5jbHVkZXMKICAgICAqIGNhbGN1bGF0aW5nIHRoZSByZWxhdGl2ZSBm\naWVsZCBudW1iZXIgb2YgdGhlIGRlc2lyZWQgZmllbGQgYW5kIGNhbGxpbmcK\nICAgICAqIHRoZSBzdXBlcmNsYXNzIGlmIG5lY2Vzc2FyeS4KICAgICAqCiAg\nICAgKiBAcmV0dXJuIHRoZSBpbmRleCBpbiB3aGljaCB0aGUgbG9jYWwgdmFy\naWFibGUgaG9sZGluZyB0aGUgcmVsYXRpdmUKICAgICAqIGZpZWxkIG51bWJl\nciBpcyBzdG9yZWQKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgYmVnaW5Td2l0\nY2hNZXRob2QoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewogICAgICAgIGJv\nb2xlYW4gY29weSA9IChQUkUgKyAiQ29weUZpZWxkIikuZXF1YWxzKG5hbWUp\nOwogICAgICAgIGludCBmaWVsZE51bWJlciA9IChjb3B5KSA/IDEgOiAwOwoK\nICAgICAgICBpbnQgcmVsTG9jYWwgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRl\neCgpOwogICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAg\nICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcik7CiAg\nICAgICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwocmVsTG9jYWwpOwog\nICAgICAgICAgICByZXR1cm4gcmVsTG9jYWw7CiAgICAgICAgfQoKICAgICAg\nICAvLyBpbnQgcmVsID0gZmllbGROdW1iZXIgLSBwY0luaGVyaXRlZEZpZWxk\nQ291bnQKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1i\nZXIpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJ\nVCwgaW50LmNsYXNzKTsKICAgICAgICBjb2RlLmlzdWIoKTsKICAgICAgICBj\nb2RlLmlzdG9yZSgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICBjb2Rl\nLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwoKICAgICAgICAvLyBzdXBl\ncjogaWYgKHJlbCA8IDApIHN1cGVyLnBjUmVwbGFjZUZpZWxkIChmaWVsZE51\nbWJlcik7IHJldHVybjsKICAgICAgICAvLyBubyBzdXBlcjogaWYgKHJlbCA8\nIDApIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCk7CiAg\nICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZmdlKCk7CiAg\nICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwpIHsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIFN0cmluZ1tdIGFyZ3M7CiAgICAgICAgICAgIGlmIChj\nb3B5KSB7CiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0cmluZ1tdeyBn\nZXRUeXBlKF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLgogICAg\nICAgICAgICAgICAgICAgIGdldE5hbWUoKSwgaW50LmNsYXNzLmdldE5hbWUo\nKSB9OwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGFyZ3MgPSBu\nZXcgU3RyaW5nW117IGludC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICAg\nICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUo\nX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpKS5nZXROYW1lKCksIG5hbWUsIAogICAgICAgICAgICAgICAgdm9pZC5j\nbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgdGhyb3dFeGNlcHRp\nb24oY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKCiAg\nICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgIHJl\ndHVybiByZWxMb2NhbDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgaGVs\ncGVyIG1ldGhvZCwgZ2l2ZW4gdGhlIHBjUmVwbGFjZUZpZWxkIG9yIHBjUHJv\ndmlkZUZpZWxkCiAgICAgKiBtZXRob2QsIGFkZHMgdGhlIGJ5dGVjb2RlIGZv\nciB0aGUgY29ycmVzcG9uZGluZyAncGx1cmFsJyB2ZXJzaW9uCiAgICAgKiBv\nZiB0aGUgbWV0aG9kIC0tIHRoZSB2ZXJzaW9uIHRoYXQgdGFrZXMgYW4gaW50\nW10gb2YgZmllbGRzIHRvCiAgICAgKiB0byBhY2Nlc3MgcmF0aGVyIHRoYW4g\nYSBzaW5nbGUgZmllbGQuIFRoZSBtdWx0aXBsZSBmaWVsZHMgdmVyc2lvbgog\nICAgICogc2ltcGx5IGxvb3BzIHRocm91Z2ggdGhlIHByb3ZpZGVkIGluZGV4\nZXMgYW5kIGRlbGVnYXRlcyB0byB0aGUKICAgICAqIHNpbmd1bGFyIHZlcnNp\nb24gZm9yIGVhY2ggb25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9uKEJDTWV0aG9kIHNpbmdsZSkg\newogICAgICAgIGJvb2xlYW4gY29weSA9IChQUkUgKyAiQ29weUZpZWxkIiku\nZXF1YWxzKHNpbmdsZS5nZXROYW1lKCkpOwoKICAgICAgICAvLyBwdWJsaWMg\ndm9pZCA8bWV0aG9kPnMgKGludFtdIGZpZWxkcykKICAgICAgICBDbGFzc1td\nIGFyZ3MgPSAoY29weSkgPyBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzLCBp\nbnRbXS5jbGFzcyB9CiAgICAgICAgICAgIDogbmV3IENsYXNzW117IGludFtd\nLmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2Qoc2luZ2xlLmdldE5hbWUoKSArICJzIiwKICAgICAgICAgICAg\ndm9pZC5jbGFzcywgYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9k\nLmdldENvZGUodHJ1ZSk7CgogICAgICAgIGludCBmaWVsZE51bWJlcnMgPSAw\nOwogICAgICAgIGludCBpbnN0ID0gMDsKICAgICAgICBpZiAoY29weSkgewog\nICAgICAgICAgICBmaWVsZE51bWJlcnMgPSAxOwoKICAgICAgICAgICAgaWYg\nKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAgIC8vIGdl\ndCB0aGUgbWFuYWdlZCBpbnN0YW5jZSBpbnRvIHRoZSBsb2NhbCB2YXJpYWJs\nZSB0YWJsZQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoSW1wbEhlbHBlci5jbGFzcywKICAgICAgICAgICAgICAgICAgICAi\nZ2V0TWFuYWdlZEluc3RhbmNlIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzIH0pOwogICAg\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9tYW5hZ2Vk\nVHlwZSk7CiAgICAgICAgICAgICAgICBpbnN0ID0gY29kZS5nZXROZXh0TG9j\nYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0\nTG9jYWwoaW5zdCk7CgogICAgICAgICAgICAgICAgLy8gdGhlcmUgbWlnaHQg\nYmUgYSBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGNsYXNzZXMgb2YgJ3RoaXMn\nCiAgICAgICAgICAgICAgICAvLyB2cyAnb3RoZXInIGluIHRoaXMgY29udGV4\ndDsgdXNlIHRoZSBQQyBtZXRob2RzIHRvIGdldCB0aGUgU00KICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChJbXBsSGVs\ncGVyLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICJ0b1BlcnNpc3RlbmNl\nQ2FwYWJsZSIsIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgT2JqZWN0\nLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLAogICAg\nICAgICAgICAgICAgICAgICJwY0dldFN0YXRlTWFuYWdlciIsIFN0YXRlTWFu\nYWdlci5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAvLyBYWFggb3RoZXIgPSAoWFhYKSBwYzsKICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShfcGMpOwogICAgICAgICAg\nICAgICAgaW5zdCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAg\nICAgICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGluc3QpOwoKICAg\nICAgICAgICAgICAgIC8vIGFjY2VzcyB0aGUgb3RoZXIncyBzbSBmaWVsZCBk\naXJlY3RseQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKGluc3QpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBpZiAob3RoZXIucGNTdGF0ZU1hbmFnZXIgIT0gcGNTdGF0ZU1hbmFnZXIp\nCiAgICAgICAgICAgIC8vCXRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24KCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nU00sIFNNVFlQRSk7CiAgICAgICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlu\ncyA9IGNvZGUuaWZhY21wZXEoKTsKICAgICAgICAgICAgdGhyb3dFeGNlcHRp\nb24oY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoKICAgICAg\nICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAg\nICAgIC8vICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uCiAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAg\nICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUu\nbm9wKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gZm9yIChpbnQgaSA9IDA7\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDApOwogICAgICAg\nIGludCBpZHggPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAg\nIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwoaWR4KTsKICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gdGVzdGlucyA9IGNvZGUuZ28yKCk7CgogICAgICAgIC8vIDxt\nZXRob2Q+IChmaWVsZHNbaV0pOwogICAgICAgIEluc3RydWN0aW9uIGJvZHlp\nbnMgPSBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICBpZiAoY29weSkKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKGluc3QpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShmaWVsZE51\nbWJlcnMpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpZHgpOwog\nICAgICAgIGNvZGUuaWFsb2FkKCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKHNpbmdsZSk7CgogICAgICAgIC8vIGkrKzsKICAg\nICAgICBjb2RlLmlpbmMoKS5zZXRJbmNyZW1lbnQoMSkuc2V0TG9jYWwoaWR4\nKTsKCiAgICAgICAgLy8gaSA8IGZpZWxkcy5sZW5ndGgKICAgICAgICB0ZXN0\naW5zLnNldFRhcmdldChjb2RlLmlsb2FkKCkuc2V0TG9jYWwoaWR4KSk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVycyk7CiAg\nICAgICAgY29kZS5hcnJheWxlbmd0aCgpOwogICAgICAgIGNvZGUuaWZpY21w\nbHQoKS5zZXRUYXJnZXQoYm9keWlucyk7CiAgICAgICAgY29kZS52cmV0dXJu\nKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyB0aGUgJ3N0b2NrJyBtZXRob2RzIHRvIHRoZSBieXRlY29k\nZTsgdGhlc2UgaW5jbHVkZSBtZXRob2RzCiAgICAgKiBsaWtlIHtAbGluayBQ\nZXJzaXN0ZW5jZUNhcGFibGUjcGNGZXRjaE9iamVjdElkfQogICAgICogYW5k\nIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNJc1RyYW5zYWN0aW9uYWx9\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3RvY2tNZXRob2RzKCkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBwY0dldEdlbmVyaWNDb250ZXh0CiAg\nICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAg\nICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAg\nICAgU01UWVBFLCAiZ2V0IiArIENPTlRFWFROQU1FLCAoQ2xhc3NbXSkgbnVs\nbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNGZXRjaE9iamVj\ndElkCiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRo\nb2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhl\nbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAg\nICAgICAgICAgU01UWVBFLCAiZmV0Y2hPYmplY3RJZCIsIChDbGFzc1tdKSBu\ndWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzRGVsZXRl\nZAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9k\nKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxw\nZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgIFNNVFlQRSwgImlzRGVsZXRlZCIsIChDbGFzc1tdKSBudWxsKSks\nIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzRGlydHkKICAgICAg\nICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAg\nICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERl\nY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBT\nTVRZUEUsICJpc0RpcnR5IiwgKENsYXNzW10pIG51bGwpKSwgdHJ1ZSk7CiAg\nICAKICAgICAgICAgICAgLy8gcGNJc05ldwogICAgICAgICAgICB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1l\ndGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RB\nY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzTmV3\nIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAg\nIC8vIHBjSXNQZXJzaXN0ZW50CiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21T\ndGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigK\nICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNQZXJzaXN0ZW50\nIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAg\nIC8vIHBjSXNUcmFuc2FjdGlvbmFsCiAgICAgICAgICAgIHRyYW5zbGF0ZUZy\nb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9k\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlv\nbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNUcmFuc2Fj\ndGlvbmFsIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAg\nICAgICAgIC8vIHBjU2VyaWFsaXppbmcKICAgICAgICAgICAgdHJhbnNsYXRl\nRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChNZXRo\nb2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0\naW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJzZXJpYWxp\nemluZyIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAg\nICAgICAvLyBwY0RpcnR5CiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0\nZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiZGlydHkiLCBuZXcgQ2xh\nc3NbXXsgU3RyaW5nLmNsYXNzIH0pKSwgZmFsc2UpOwogICAgCiAgICAgICAg\nICAgIC8vIHBjR2V0U3RhdGVNYW5hZ2VyCiAgICAgICAgICAgIEJDTWV0aG9k\nIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0U3RhdGVNYW5h\nZ2VyIiwKICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlci5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU3RhdGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9\nIGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBhZSkgewogICAg\nICAgICAgICAgdGhyb3cgKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbikgcGFlLmdl\ndEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEhlbHBlciBtZXRob2QgdG8gYWRkIGEgc3RvY2sgbWV0aG9kIHRvIHRoZSBi\neXRlY29kZS4gRWFjaAogICAgICogc3RvY2sgbWV0aG9kIHNpbXBseSBkZWxl\nZ2F0ZXMgdG8gYSBjb3JyZXNwb25kaW5nIFN0YXRlTWFuYWdlciBtZXRob2Qu\nCiAgICAgKiBHaXZlbiB0aGUgU3RhdGVNYW5hZ2VyIG1ldGhvZCwgdGhlbiwg\ndGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGl0IGludG8KICAgICAqIHRoZSB3\ncmFwcGVyIG1ldGhvZCB0aGF0IHNob3VsZCBiZSBhZGRlZCB0byB0aGUgYnl0\nZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0cmFuc2xhdGVGcm9t\nU3RhdGVNYW5hZ2VyTWV0aG9kKE1ldGhvZCBtLAogICAgICAgIGJvb2xlYW4g\naXNEaXJ0eUNoZWNrTWV0aG9kKSB7CiAgICAgICAgLy8gZm9ybSB0aGUgbmFt\nZSBvZiB0aGUgbWV0aG9kIGJ5IHByZXBlbmRpbmcgJ3BjJyB0byB0aGUgc20g\nbWV0aG9kCiAgICAgICAgU3RyaW5nIG5hbWUgPSBQUkUgKyBTdHJpbmdVdGls\ncy5jYXBpdGFsaXplKG0uZ2V0TmFtZSgpKTsKICAgICAgICBDbGFzc1tdIHBh\ncmFtcyA9IG0uZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICBDbGFzcyBy\nZXR1cm5UeXBlID0gbS5nZXRSZXR1cm5UeXBlKCk7CgogICAgICAgIC8vIGFk\nZCB0aGUgbWV0aG9kIHRvIHRoZSBwYwogICAgICAgIEJDTWV0aG9kIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKG5hbWUsIHJldHVyblR5cGUsIHBhcmFt\ncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7\nCgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxsKSByZXR1\ncm4gPGRlZmF1bHQ+OwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGlmIChyZXR1cm5UeXBlLmVxdWFs\ncyhib29sZWFuLmNsYXNzKSkKICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICBlbHNlIGlmICghcmV0dXJuVHlw\nZS5lcXVhbHModm9pZC5jbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlw\nZShyZXR1cm5UeXBlKTsKCiAgICAgICAgLy8gaWYgdGhpcyBpcyB0aGUgZGly\ndHktY2hlY2sgbWV0aG9kIGFuZCB3ZSdyZSBzdWJjbGFzc2luZyBidXQgbm90\nCiAgICAgICAgLy8gcmVkZWZpbmluZywgaG9vayBpbnRvIFBDSGVscGVyIHRv\nIGRvIHRoZSBkaXJ0eSBjaGVjawogICAgICAgIGlmIChpc0RpcnR5Q2hlY2tN\nZXRob2QgJiYgIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAgLy8gUmVk\nZWZpbml0aW9uSGVscGVyLmRpcnR5Q2hlY2soc20pOwogICAgICAgICAgICBp\nZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSkpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00s\nIFNNVFlQRSk7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7IC8vIGZvciB0aGUg\ncmV0dXJuIHN0YXRlbWVudCBiZWxvdwogICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3Ms\nIAogICAgICAgICAgICAgICAgImRpcnR5Q2hlY2siLCB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXSB7IFNNVFlQRSB9KTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSkpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAg\nIC8vIHJldHVybiBwY1N0YXRlTWFuYWdlci48bWV0aG9kPiAoPGFyZ3M+KTsK\nICAgICAgICAvLyBtYW5hZ2VkIGluc3RhbmNlIGxvYWRlZCBhYm92ZSBpbiBp\nZi1lbHNlIGJsb2NrCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJh\nbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQ\nYXJhbShpKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChtKTsKICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKHJldHVy\nblR5cGUpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUj\ncGNHZXRWZXJzaW9ufSBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0VmVyc2lvbk1ldGhvZCgpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFZl\ncnNpb24iLCBPYmplY3QuY2xhc3MsCiAgICAgICAgICAgIG51bGwpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcElu\nc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICBG\naWVsZE1ldGFEYXRhIHZlcnNpb25GaWVsZCA9IF9tZXRhLmdldFZlcnNpb25G\naWVsZCgpOwoKICAgICAgICBpZiAodmVyc2lvbkZpZWxkID09IG51bGwpCiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7IC8vIHJldHVy\nbiBudWxsOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyByZXR1cm4g\nPHZlcnNpb25GaWVsZD47CiAgICAgICAgICAgIENsYXNzIHdyYXBwZXIgPSB0\nb1ByaW1pdGl2ZVdyYXBwZXIodmVyc2lvbkZpZWxkKTsKICAgICAgICAgICAg\naWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZpZWxkLmdldERlY2xhcmVkVHlwZSgp\nKSB7CiAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHdyYXBw\nZXIpOwogICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCB2\nZXJzaW9uRmllbGQpOwogICAgICAgICAgICBpZiAod3JhcHBlciAhPSB2ZXJz\naW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkpCiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qod3JhcHBlciwgIjxpbml0\nPiIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNz\nW117IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAg\nICB9CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgIC8vIHJldHVy\nbiBwY1N0YXRlTWFuYWdlci5nZXRWZXJzaW9uICgpOwogICAgICAgIGlmaW5z\nLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7\nCiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNN\nVFlQRSwgImdldFZlcnNpb24iLCBPYmplY3QuY2xhc3MsCiAgICAgICAgICAg\nIG51bGwpOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\ndmVyc2lvbiBmaWVsZCB0eXBlIGFzIGEgcHJpbWl0aXZlIHdyYXBwZXIsIG9y\nIG51bGwgaWYKICAgICAqIHRoZSB2ZXJzaW9uIGZpZWxkIGlzIG5vdCBwcmlt\naXRpdmUuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3MgdG9QcmltaXRpdmVX\ncmFwcGVyKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICByZXR1cm4gQm9v\nbGVhbi5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToK\nICAgICAgICAgICAgICAgIHJldHVybiBCeXRlLmNsYXNzOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJu\nIENoYXJhY3Rlci5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIERvdWJsZS5jbGFzczsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gRmxvYXQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIHJldHVybiBJbnRlZ2VyLmNs\nYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICAgICAgcmV0dXJuIExvbmcuY2xhc3M7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIFNob3J0\nLmNsYXNzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZm1kLmdldERlY2xh\ncmVkVHlwZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0Bs\naW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VTdGF0ZU1hbmFnZXJ9\nCiAgICAgKiBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1ldGhvZCgpIHsK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY1JlcGxhY2VTdGF0ZU1hbmFnZXIg\nKFN0YXRlTWFuYWdlciBzbSkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVwbGFjZVN0YXRlTWFuYWdlciIs\nCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTTVRZUEUg\nfSk7CiAgICAgICAgbWV0aG9kLnNldFN5bmNocm9uaXplZCh0cnVlKTsKICAg\nICAgICBtZXRob2QuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24o\nU2VjdXJpdHlFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiAocGNTdGF0\nZU1hbmFnZXIgIT0gbnVsbCkKICAgICAgICAvLwlwY1N0YXRlTWFuYWdlciA9\nIHBjU3RhdGVNYW5hZ2VyLnJlcGxhY2VTdGF0ZU1hbmFnZXIoc20pOwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVsbCgpOwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoU01UWVBFLCAicmVwbGFjZVN0YXRlTWFu\nYWdlciIsCiAgICAgICAgICAgIFNNVFlQRSwgbmV3IENsYXNzW117IFNNVFlQ\nRSB9KTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIC8vIFNl\nY3VyaXR5TWFuYWdlciBzZWMgPSBTeXN0ZW0uZ2V0U2VjdXJpdHlNYW5hZ2Vy\nICgpOwogICAgICAgIC8vIGlmIChzZWMgIT0gbnVsbCkKICAgICAgICAvLwkJ\nc2VjLmNoZWNrUGVybWlzc2lvbiAoUGVybWlzc2lvbi5TRVRfU1RBVEVfTUFO\nQUdFUik7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKFN5c3RlbS5jbGFzcywKICAgICAgICAgICAgImdl\ndFNlY3VyaXR5TWFuYWdlciIsIFNlY3VyaXR5TWFuYWdlci5jbGFzcywgbnVs\nbCkpOwoKICAgICAgICAvLyBwY1N0YXRlTWFuYWdlciA9IHNtOwogICAgICAg\nIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBQZXJzaXN0ZW5j\nZUNhcGFibGUgbWV0aG9kcyBkZWFsaW5nIHdpdGggYXBwbGljYXRpb24KICAg\nICAqIGlkZW50aXR5IGFuZCBnaXZlcyB0aGVtIG5vLW9wIGltcGxlbWVudGF0\naW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5vT3BBcHBsaWNh\ndGlvbklkZW50aXR5TWV0aG9kcygpIHsKICAgICAgICAvLyBwdWJsaWMgdm9p\nZCBwY0NvcHlLZXlGaWVsZHNUb09iamVjdElkIChPYmplY3RJZEZpZWxkU3Vw\ncGxpZXIgZnMsCiAgICAgICAgLy8gCU9iamVjdCBvaWQpCiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlL\nZXlGaWVsZHNUb09iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW117IE9JREZTVFlQRSwgT2JqZWN0LmNsYXNzIH0pOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxk\nc1RvT2JqZWN0SWQgKE9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElk\nIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGND\nb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIChPYmplY3RJZEZpZWxkQ29uc3Vt\nZXIgZmMsCiAgICAgICAgLy8JT2JqZWN0IG9pZCkKICAgICAgICBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21P\nYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPSURGQ1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAg\nLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIChP\nYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9k\nKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsK\nICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKCiAgICAgICAgLy8gcHVibGljIE9iamVjdCBwY05ld09iamVjdElk\nSW5zdGFuY2UgKCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9i\namVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZElu\nc3RhbmNlIChPYmplY3Qgb2JqKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwKICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZDwvY29kZT4gbWV0aG9kcwogICAgICogdG8gY2xhc3NlcyB1c2lu\nZyBhcHBsaWNhdGlvbiBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElkTWV0aG9kKGJvb2xlYW4g\nZmllbGRNYW5hZ2VyKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxk\nc1RvT2JqZWN0SWQgKE9iamVjdElkRmllbGRTdXBwbGllciBmcywKICAgICAg\nICAvLwlPYmplY3Qgb2lkKQogICAgICAgIFN0cmluZ1tdIGFyZ3MgPSAoZmll\nbGRNYW5hZ2VyKSA/CiAgICAgICAgICAgIG5ldyBTdHJpbmdbXXsgT0lERlNU\nWVBFLmdldE5hbWUoKSwgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9CiAgICAg\nICAgICAgIDogbmV3IFN0cmluZ1tdeyBPYmplY3QuY2xhc3MuZ2V0TmFtZSgp\nIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzaW5n\nbGUgZmllbGQgaWRlbnRpdHkgYWx3YXlzIHRocm93cyBleGNlcHRpb24KICAg\nICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAg\nICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJTlRFUk5FWENFUCk7CiAgICAg\nICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kCiAgICAgICAgaWYgKF9t\nZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbShpKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICBQUkUgKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0SWQiLCB2b2lk\nLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBPYmplY3QgaWQgPSBvaWQ7CiAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwoK\nICAgICAgICBpZiAoX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewog\nICAgICAgICAgICAvLyBvaWQgPSAoKE9iamVjdElkKSBpZCkuZ2V0SWQgKCk7\nCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJ\nZC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICAv\nLyA8b2lkIHR5cGU+IGlkID0gKDxvaWQgdHlwZT4pIG9pZDsKICAgICAgICBp\nbnQgaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIENs\nYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAg\nY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpZCk7CgogICAgICAgIC8vIGludCBp\nbmhlcml0ZWQgPSBwY0luaGVyaXRlZEZpZWxkQ291bnQ7CiAgICAgICAgaW50\nIGluaGVyaXRlZCA9IDA7CiAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikgewog\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQs\nIGludC5jbGFzcyk7CiAgICAgICAgICAgIGluaGVyaXRlZCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGNvZGUuaXN0b3JlKCku\nc2V0TG9jYWwoaW5oZXJpdGVkKTsKICAgICAgICB9CgogICAgICAgIC8vIGlk\nLjxmaWVsZD4gPSBmcy5mZXRjaDx0eXBlPkZpZWxkICg8aW5kZXg+KTsgb3Iu\nLi4KICAgICAgICAvLyBpZC48ZmllbGQ+ID0gcGMuPGZpZWxkPjsKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkg\nPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERl\nY2xhcmVkRmllbGRzKCk7CiAgICAgICAgQ2xhc3MgdHlwZTsKICAgICAgICBT\ndHJpbmcgbmFtZTsKICAgICAgICBGaWVsZCBmaWVsZDsKICAgICAgICBNZXRo\nb2Qgc2V0dGVyOwogICAgICAgIGJvb2xlYW4gcmVmbGVjdDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChpZCk7CgogICAgICAgICAgICBuYW1lID0gZm1kc1tpXS5nZXROYW1l\nKCk7CiAgICAgICAgICAgIHR5cGUgPSBmbWRzW2ldLmdldE9iamVjdElkRmll\nbGRUeXBlKCk7CiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAg\nICAgICAgIHNldHRlciA9IG51bGw7CiAgICAgICAgICAgICAgICBmaWVsZCA9\nIFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUsIHRydWUpOwog\nICAgICAgICAgICAgICAgcmVmbGVjdCA9ICFNb2RpZmllci5pc1B1YmxpYyhm\naWVsZC5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgICAgICAgICBpZiAocmVm\nbGVjdCkgewogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFu\ndCgpLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVm\nbGVjdGlvbi5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgICAgICJmaW5k\nRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10geyBDbGFzcy5jbGFz\ncywKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBib29s\nZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgZmllbGQgPSBudWxsOwogICAgICAg\nICAgICAgICAgc2V0dGVyID0gUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5\ncGUsIG5hbWUsIHR5cGUsIHRydWUpOwogICAgICAgICAgICAgICAgcmVmbGVj\ndCA9ICFNb2RpZmllci5pc1B1YmxpYyhzZXR0ZXIuZ2V0TW9kaWZpZXJzKCkp\nOwogICAgICAgICAgICAgICAgaWYgKHJlZmxlY3QpIHsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBl\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0\nYW50KCkuc2V0Q2xhc3ModHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24u\nY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAiZmluZFNldHRlciIs\nIE1ldGhvZC5jbGFzcywgbmV3IENsYXNzW10geyBDbGFzcy5jbGFzcywKICAg\nICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBDbGFzcy5jbGFz\ncywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikgewogICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAg\nICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGluaGVyaXRlZCk7CiAg\nICAgICAgICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kCiAgICAgICAgICAgICAg\nICAgICAgKGdldEZpZWxkU3VwcGxpZXJNZXRob2QodHlwZSkpOwogICAgICAg\nICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2Rl\nKCkgPT0gSmF2YVR5cGVzLk9CSkVDVCkgewogICAgICAgICAgICAgICAgCWNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAgICAg\nICAgICAgICAgICAJY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9i\namVjdElkLmNsYXNzLCAiZ2V0SWQiLCAKICAgICAgICAgICAgCQkJT2JqZWN0\nLmNsYXNzLCBudWxsKTsgICAgICAgICAgICAgICAgCQogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB0eXBlIG9mIHRoaXMg\nZmllbGQgbWV0YSBkYXRhIGlzCiAgICAgICAgICAgICAgICAvLyBub24tcHJp\nbWl0aXZlIGFuZCBub24tc3RyaW5nLCBiZSBzdXJlIHRvIGNhc3QKICAgICAg\nICAgICAgICAgIC8vIHRvIHRoZSBhcHByb3ByaWF0ZSB0eXBlLgogICAgICAg\nICAgICAgICAgaWYgKCFyZWZsZWN0ICYmICF0eXBlLmlzUHJpbWl0aXZlKCkK\nICAgICAgICAgICAgICAgICAgICAmJiAhdHlwZS5nZXROYW1lKCkuZXF1YWxz\nKFN0cmluZy5jbGFzcy5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKCiAgICAgICAgICAgICAgICAvLyBn\nZXQgaWQvcGsgZnJvbSBwYyBpbnN0YW5jZQogICAgICAgICAgICAgICAgaWYg\nKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5Q\nQykKICAgICAgICAgICAgICAgICAgICBhZGRFeHRyYWN0T2JqZWN0SWRGaWVs\nZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKHJlZmxlY3QgJiYgZmllbGQgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVm\nbGVjdGlvbi5jbGFzcywgInNldCIsIAogICAgICAgICAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBGaWVsZC5j\nbGFzcywKICAgICAgICAgICAgICAgICAgICAodHlwZS5pc1ByaW1pdGl2ZSgp\nKSA/IHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAocmVmbGVjdCkgeyAKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsICJzZXQiLCAK\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nIE9iamVjdC5jbGFzcywgTWV0aG9kLmNsYXNzLAogICAgICAgICAgICAgICAg\nICAgICh0eXBlLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6IE9iamVjdC5jbGFz\ncyB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGZpZWxk\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHNldHRlcik7CiAgICAgICAgfQogICAg\nICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBjb2RlIHRvIGV4dHJhY3QgdGhl\nIGlkIG9mIHRoZSBnaXZlbiBwcmltYXJ5IGtleSByZWxhdGlvbiBmaWVsZCBm\nb3IKICAgICAqIHNldHRpbmcgaW50byBhbiBvYmplY3RpZCBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEV4dHJhY3RPYmplY3RJZEZp\nZWxkVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBwaykgewog\nICAgICAgIC8vIGlmICh2YWwgIT0gbnVsbCkgCiAgICAgICAgLy8gIHZhbCA9\nICgoUGVyc2lzdGVuY2VDYXBhYmxlKSB2YWwpLnBjRmV0Y2hPYmplY3RJZCgp\nOwogICAgICAgIGludCBwYyA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7\nCiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChwYyk7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKHBjKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gaWZudWxsMSA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKHBjKTsKICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzKTsgCiAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoUGVyc2lzdGVuY2VD\nYXBhYmxlLmNsYXNzLAogICAgICAgICAgICBQUkUgKyAiRmV0Y2hPYmplY3RJ\nZCIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IG9pZCA9IGNv\nZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5hc3RvcmUo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChvaWQpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZm51bGwyID0gY29k\nZS5pZm51bGwoKTsgCgogICAgICAgIC8vIGZvciBkYXRhc3RvcmUgLyBzaW5n\nbGUtZmllbGQgaWRlbnRpdHk6CiAgICAgICAgLy8gaWYgKHZhbCAhPSBudWxs\nKQogICAgICAgIC8vICAgdmFsID0gKChPcGVuSlBBSWQpIHZhbCkuZ2V0SWQo\nKTsKICAgICAgICBDbGFzc01ldGFEYXRhIHBrbWV0YSA9IHBrLmdldERlY2xh\ncmVkVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgaW50IHBrY29kZSA9IHBrLmdl\ndE9iamVjdElkRmllbGRUeXBlQ29kZSgpOwogICAgICAgIENsYXNzIHBrdHlw\nZSA9IHBrLmdldE9iamVjdElkRmllbGRUeXBlKCk7CiAgICAgICAgaWYgKHBr\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RB\nVEFTVE9SRSAKICAgICAgICAgICAgJiYgcGtjb2RlID09IEphdmFUeXBlcy5M\nT05HKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoSWQuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoSWQuY2xhc3MsICJnZXRJZCIsIAogICAgICAgICAgICAgICAgbG9uZy5j\nbGFzcywgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmIChwa21ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpIHsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAg\nICAgfSBlbHNlIGlmIChwa21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewog\nICAgICAgICAgICBzd2l0Y2ggKHBrY29kZSkgewogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShCeXRlLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5v\nIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShCeXRlSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChCeXRlSWQuY2xhc3MsICJnZXRJZCIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGUuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkJZ\nVEVfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoQnl0ZS5jbGFzcywgIjxpbml0PiIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7Ynl0ZS5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShDaGFyYWN0ZXIu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENoYXJJZC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKENo\nYXJJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nY2hhci5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBr\nY29kZSA9PSBKYXZhVHlwZXMuQ0hBUl9PQkopCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChDaGFyYWN0\nZXIuY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxpbml0\nPiIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHtjaGFyLmNsYXNzfSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYW5ldygpLnNldFR5cGUoRG91YmxlLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5v\nIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9p\nZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKERvdWJsZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRG91YmxlSWQuY2xhc3MsICJn\nZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRvdWJsZS5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZh\nVHlwZXMuRE9VQkxFX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKERvdWJsZS5jbGFzcywgIjxp\nbml0PiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117ZG91YmxlLmNsYXNzfSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0\nVHlwZShGbG9hdC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5k\ndXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEZsb2F0SWQuY2xh\nc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChGbG9hdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAg\nICAgICAgICAgICAgICBmbG9hdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuRkxPQVRfT0JKKQog\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QoRmxvYXQuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde2Zsb2F0\nLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoSW50ZWdlci5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAg\nICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShJbnRJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEludElkLmNsYXNzLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBpbnQuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5\ncGVzLklOVF9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChJbnRlZ2VyLmNsYXNzLCAiPGluaXQ+\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5l\ndyBDbGFzc1tdIHtpbnQuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JK\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoTG9u\nZy5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoTG9uZ0lkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nTG9uZ0lkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAg\nICBsb25nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\ncGtjb2RlID09IEphdmFUeXBlcy5MT05HX09CSikKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKExvbmcu\nY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2xvbmcuY2xhc3N9KTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFu\nZXcoKS5zZXRUeXBlKFNob3J0LmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFr\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU2hv\ncnRJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKFNob3J0SWQuY2xhc3MsICJnZXRJZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIHNob3J0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5TSE9S\nVF9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChTaG9ydC5jbGFzcywgIjxpbml0PiIsIAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW117c2hvcnQuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKERhdGVJ\nZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKERhdGVJZC5jbGFzcywgImdldElkIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgRGF0ZS5jbGFzcywgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKFN0cmluZ0lkLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoU3RyaW5n\nSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0\ncmluZy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShCaWdEZWNpbWFsSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaWdEZWNpbWFsSWQuY2xh\nc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJpZ0RlY2lt\nYWxJZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShCaWdJbnRlZ2VySWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaWdJbnRlZ2VySWQuY2xh\nc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJpZ0ludGVn\nZXJJZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAg\nICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBlbHNlIGlmIChwa21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkg\nIT0gbnVsbCkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\nb2lkKTsKICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuT0JK\nRUNUKSB7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQi\nLCAKICAgICAgICAgICAgCQkJT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgfSAKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKHBrdHlwZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBn\nbzIgPSBjb2RlLmdvMigpOwoKICAgICAgICAvLyBpZiAodmFsID09IG51bGwp\nCiAgICAgICAgLy8gICB2YWwgPSA8ZGVmYXVsdD47CiAgICAgICAgSW5zdHJ1\nY3Rpb24gZGVmOwogICAgICAgIHN3aXRjaCAocGtjb2RlKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBk\nZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEU6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoKGJ5dGUpIDApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBk\nZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKGNoYXIpIDApOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRPVUJMRToKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgwRCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBk\nZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEYpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoc2hvcnQp\nIDApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0\nTnVsbCgpOwogICAgICAgIH0KICAgICAgICBpZm51bGwxLnNldFRhcmdldChk\nZWYpOwogICAgICAgIGlmbnVsbDIuc2V0VGFyZ2V0KGRlZik7CiAgICAgICAg\nZ28yLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJ\nZDwvY29kZT4gbWV0aG9kcwogICAgICogdG8gY2xhc3NlcyB1c2luZyBhcHBs\naWNhdGlvbiBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QoYm9vbGVhbiBmaWVs\nZE1hbmFnZXIpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzRnJv\nbU9iamVjdElkIChPYmplY3RJZEZpZWxkQ29uc3VtZXIgZmMsCiAgICAgICAg\nLy8JT2JqZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZpZWxk\nTWFuYWdlcikgCiAgICAgICAgICAgID8gIG5ldyBTdHJpbmdbXXsgT0lERkNU\nWVBFLmdldE5hbWUoKSwgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9CiAgICAg\nICAgICAgIDogbmV3IFN0cmluZ1tdeyBPYmplY3QuY2xhc3MuZ2V0TmFtZSgp\nIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAg\nICAgICB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGNh\nbGwgc3VwZXJjbGFzcyBtZXRob2QKICAgICAgICBpZiAoX21ldGEuZ2V0UENT\ndXBlcmNsYXNzKCkgIT0gbnVsbCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkg\newogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKGkpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIFBS\nRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwgdm9pZC5jbGFzcy5n\nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpZWxk\nTWFuYWdlcikKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwoKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlkZW50aXR5\nKCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewogICAgICAg\nICAgICAvLyBvaWQgPSAoKE9iamVjdElkKSBpZCkuZ2V0SWQgKCk7CiAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFz\ncyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChPYmplY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgIE9i\namVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICAvLyA8b2lk\nIHR5cGU+IGNhc3QgPSAoPG9pZCB0eXBlPikgb2lkOwogICAgICAgIGludCBp\nZCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgQ2xhc3Mg\nb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShvaWRUeXBlKTsKICAgICAgICBjb2Rl\nLmFzdG9yZSgpLnNldExvY2FsKGlkKTsKCiAgICAgICAgLy8gZnMuc3RvcmU8\ndHlwZT5GaWVsZCAoPGluZGV4PiwgaWQuPGZpZWxkPik7IG9yLi4uCiAgICAg\nICAgLy8gdGhpcy48ZmllbGQ+ID0gaWQuPGZpZWxkPgogICAgICAgIC8vIG9y\nIGZvciBzaW5nbGUgZmllbGQgaWRlbnRpdHk6IGlkLmdldElkICgpCiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygp\nID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAg\nIENsYXNzIHR5cGU7CiAgICAgICAgQ2xhc3MgdW53cmFwcGVkOwogICAgICAg\nIEZpZWxkIGZpZWxkOwogICAgICAgIE1ldGhvZCBnZXR0ZXI7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0u\nZ2V0TmFtZSgpOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmpl\nY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICBpZiAoIWZpZWxkTWFuYWdl\nciAKICAgICAgICAgICAgICAgICYmIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAgICAgLy8g\nc20uZ2V0UENQcmltYXJ5S2V5KG9pZCwgaSArIHBjSW5oZXJpdGVkRmllbGRD\nb3VudCk7IAogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBs\nZWF2ZSBvcmlnIG9uIHN0YWNrIHRvIHNldCB2YWx1ZSBpbnRvCiAgICAgICAg\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwog\nICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwog\nICAgICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhF\nUklULCBpbnQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChTdGF0ZU1hbmFnZXIuY2xhc3MsIAogICAgICAgICAgICAgICAgICAg\nICJnZXRQQ1ByaW1hcnlLZXkiLCBPYmplY3QuY2xhc3MsIAogICAgICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xh\nc3MgfSk7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIH0g\nZWxzZSB7IAogICAgICAgICAgICAgICAgdW53cmFwcGVkID0gKGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgCiAgICAg\nICAgICAgICAgICAgICAgPyB0eXBlIDogdW53cmFwU2luZ2xlRmllbGRJZGVu\ndGl0eShmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZE1hbmFn\nZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwoKICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlw\nZSkgewogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\ndHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChpZCk7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBB\nSWRlbnRpdHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChvaWRUeXBl\nID09IE9iamVjdElkLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0\nSWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZE1h\nbmFnZXIgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1kc1tp\nXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIGlmIChvaWRUeXBlID09IERhdGVJZC5jbGFzcykgewogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nb2lkVHlwZSwgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIERhdGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoIWZpZWxkTWFuYWdlciAmJiB0eXBlICE9IERhdGUuY2xhc3MpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsIAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwcGVkLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVud3JhcHBlZCAhPSB0eXBl\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyB1\nbndyYXBwZWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfSBlbHNlIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpewogICAgICAgICAgICAgICAgICAg\nIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgbmFtZSwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzUHVi\nbGljKGZpZWxkLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGZpZWxkKTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gUmVmbGVjdGlvbi5nZXRYWFgob2lkLCBSZWZsZWN0aW9uLmZpbmRGaWVs\nZCguLi4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2Nv\nbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcg\nQ2xhc3NbXSB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3Mu\nY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChnZXRSZWZsZWN0aW9u\nR2V0dGVyTWV0aG9kKHR5cGUsIEZpZWxkLmNsYXNzKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUg\nIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgZ2V0dGVyID0gUmVmbGVjdGlvbi5maW5kR2V0dGVyKG9pZFR5\ncGUsIG5hbWUsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChNb2Rp\nZmllci5pc1B1YmxpYyhnZXR0ZXIuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoZ2V0dGVyKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5nZXRYWFgob2lkLCBS\nZWZsZWN0aW9uLmZpbmRHZXR0ZXIoLi4uKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKG9pZFR5cGUp\nOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5j\nbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmaW5kR2V0dGVy\nIiwgTWV0aG9kLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBib29s\nZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwgTWV0aG9k\nLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHlwZS5p\nc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpZWxkTWFuYWdl\ncikKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0\nTWV0aG9kKGdldEZpZWxkQ29uc3VtZXJNZXRob2QodHlwZSkpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVD\nb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgIH0KICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gaWYgdGhlIGNsYXNzIHVzZXMgdGhlIENsYXNz\nL1N0cmluZyBjb25zdHJ1Y3RvcgogICAgICogaW5zdGVhZCBvZiBqdXN0IFN0\ncmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBCb29sZWFuIHVzZXNDbGFzc1N0\ncmluZ0lkQ29uc3RydWN0b3IoKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldElk\nZW50aXR5VHlwZSgpICE9IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04p\nCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICBp\nZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICBp\nZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gT2JqZWN0SWQuY2xhc3Mp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9CgogICAgICAgIENsYXNzIG9p\nZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBvaWRUeXBlLmdldENvbnN0cnVjdG9yKG5ldyBDbGFz\nc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIG9pZFR5cGUuZ2V0Q29uc3RydWN0b3IobmV3IENsYXNzW117IFN0cmluZy5j\nbGFzcyB9KTsKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUg\nZ2l2ZW4gZmllbGQgaXMgYSB3cmFwcGVyLXR5cGUgc2luZ2xlIGZpZWxkIGlk\nZW50aXR5IHByaW1hcnkga2V5LAogICAgICogcmV0dXJuIGl0cyBjb3JyZXNw\nb25kaW5nIHByaW1pdGl2ZSBjbGFzcy4gRWxzZSByZXR1cm4gdGhlIGZpZWxk\nIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3MgdW53cmFwU2luZ2xl\nRmllbGRJZGVudGl0eShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlm\nICghZm1kLmdldERlZmluaW5nTWV0YURhdGEoKS5pc09wZW5KUEFJZGVudGl0\neSgpKQogICAgICAgICAgICByZXR1cm4gZm1kLmdldERlY2xhcmVkVHlwZSgp\nOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkp\nIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAg\nICAgICAgICAgICByZXR1cm4gYnl0ZS5jbGFzczsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4g\nY2hhci5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxF\nX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBkb3VibGUuY2xhc3M7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgICAgIHJldHVybiBmbG9hdC5jbGFzczsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBpbnQu\nY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoK\nICAgICAgICAgICAgICAgIHJldHVybiBzaG9ydC5jbGFzczsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbG9uZy5jbGFzczsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHJldHVybiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcm9wZXIg\nZ2V0dGVyIG1ldGhvZCBvZiB0aGUge0BsaW5rIFJlZmxlY3Rpb259IGhlbHBl\nciBmb3IKICAgICAqIGEgZmllbGQgb3IgZ2V0dGVyIG1ldGhvZCBvZiB0aGUg\nZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0UmVm\nbGVjdGlvbkdldHRlck1ldGhvZChDbGFzcyB0eXBlLCBDbGFzcyBhcmdUeXBl\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIFN0cmluZyBuYW1lID0gImdldCI7CiAgICAgICAgaWYgKHR5cGUuaXNQ\ncmltaXRpdmUoKSkKICAgICAgICAgICAgbmFtZSArPSBTdHJpbmdVdGlscy5j\nYXBpdGFsaXplKHR5cGUuZ2V0TmFtZSgpKTsKICAgICAgICByZXR1cm4gUmVm\nbGVjdGlvbi5jbGFzcy5nZXRNZXRob2QobmFtZSwgbmV3IENsYXNzW10geyBP\nYmplY3QuY2xhc3MsIAogICAgICAgICAgICBhcmdUeXBlIH0pOyAKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGZldGNoIG1ldGhv\nZCBvZiB0aGUgT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZvcgogICAgICogYSBm\naWVsZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBN\nZXRob2QgZ2V0RmllbGRTdXBwbGllck1ldGhvZChDbGFzcyB0eXBlKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBnZXRNZXRob2QoT0lERlNUWVBFLCB0eXBlLCAiZmV0Y2giLCB0cnVl\nLCBmYWxzZSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBwcm9wZXIgZmV0Y2ggbWV0aG9kIG9mIHRoZSBPYmplY3RJZEZpZWxk\nQ29uc3VtZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9mIHRoZSBnaXZlbiB0eXBl\nLgogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRGaWVsZENvbnN1bWVy\nTWV0aG9kKENsYXNzIHR5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChPSURGQ1RZ\nUEUsIHR5cGUsICJzdG9yZSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgcGNOZXdPYmplY3RJZEluc3Rh\nbmNlIG1ldGhvZCB0byBjbGFzc2VzIHVzaW5nCiAgICAgKiBhcHBsaWNhdGlv\nbiBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5ld09i\namVjdElkSW5zdGFuY2VNZXRob2QoYm9vbGVhbiBvYmopCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGlj\nIE9iamVjdCBwY05ld09iamVjdElkSW5zdGFuY2UgKCkKICAgICAgICBDbGFz\nc1tdIGFyZ3MgPSAob2JqKSA/IG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3Mg\nfSA6IG51bGw7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAg\nICAgICBPYmplY3QuY2xhc3MsIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICBCb29sZWFuIHVzZXND\nbHNTdHJpbmcgPSB1c2VzQ2xhc3NTdHJpbmdJZENvbnN0cnVjdG9yKCk7CiAg\nICAgICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgp\nOwogICAgICAgIGlmIChvYmogJiYgdXNlc0Nsc1N0cmluZyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24gKC4uLik7CiAgICAgICAgICAgIFN0cmluZyBtc2cgPSBfbG9jLmdl\ndCgic3RyLWNvbnMiLCBvaWRUeXBlLAogICAgICAgICAgICAgICAgX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAg\nIGNvZGUuYW5ldygpLnNldFR5cGUoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG1zZyk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24uY2xhc3MsCiAgICAgICAgICAgICAgICAiPGluaXQ+Iiwgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW117IFN0cmluZy5jbGFzcyB9KTsKICAgICAg\nICAgICAgY29kZS5hdGhyb3coKTsKICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CgogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghX21ldGEuaXNP\ncGVuSlBBSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJl\nZCgpKSB7CiAgICAgICAgICAgIC8vIG5ldyBPYmplY3RJZCAoY2xzLCBvaWQp\nCiAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoT2JqZWN0SWQuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBpZiAo\nX21ldGEuaGFzQWJzdHJhY3RQS0ZpZWxkKCkgPT0gZmFsc2UpIHsKICAgICAg\nICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5\ncGUoX21ldGEpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoCiAgICAgICAgICAgICAg\nICAgICAgICAgIFBSRSArICJHZXRJRE93bmluZ0NsYXNzIiwgQ2xhc3MuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nLyBuZXcgPG9pZCBjbGFzcz4gKCk7CiAgICAgICAgY29kZS5hbmV3KCkuc2V0\nVHlwZShvaWRUeXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGlm\nIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpIHx8IChvYmogJiYgdXNlc0Ns\nc1N0cmluZyA9PSBCb29sZWFuLlRSVUUpKQogICAgICAgIHsKICAgICAgICAg\nICAgaWYgKF9tZXRhLmhhc0Fic3RyYWN0UEtGaWVsZCgpID09IGZhbHNlKSB7\nCiAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFz\ncyhnZXRUeXBlKF9tZXRhKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKAogICAgICAg\nICAgICAgICAgICAgIFBSRSArICJHZXRJRE93bmluZ0NsYXNzIiwgQ2xhc3Mu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGlmIChvYmopIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3Ry\naW5nLmNsYXNzKTsKICAgICAgICAgICAgaWYgKHVzZXNDbHNTdHJpbmcgPT0g\nQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFz\nc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzIH07CiAgICAgICAgICAg\nIGVsc2UgaWYgKHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5GQUxTRSkKICAg\nICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNz\nIH07CiAgICAgICAgfSBlbHNlIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0\neSgpKSB7CiAgICAgICAgICAgIC8vIG5ldyA8dHlwZT5JZGVudGl0eSAoWFhY\nLmNsYXNzLCA8cGs+KTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgcGsg\nPSBfbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKClbMF07CiAgICAgICAgICAg\nIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGspOwogICAgICAgICAg\nICBpZiAocGsuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5Q\nQykKICAgICAgICAgICAgICAgIGFkZEV4dHJhY3RPYmplY3RJZEZpZWxkVmFs\ndWVDb2RlKGNvZGUsIHBrKTsKICAgICAgICAgICAgaWYgKF9tZXRhLmdldE9i\namVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNzKQogICAgICAgICAgICAg\nICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgT2JqZWN0LmNs\nYXNzIH07CiAgICAgICAgICAgIGVsc2UgaWYgKF9tZXRhLmdldE9iamVjdElk\nVHlwZSgpID09IERhdGUuY2xhc3MpCiAgICAgICAgICAgICAgICBhcmdzID0g\nbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBEYXRlLmNsYXNzIH07CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3Nb\nXXsgQ2xhc3MuY2xhc3MsIHBrLmdldE9iamVjdElkRmllbGRUeXBlKCkgfTsK\nICAgICAgICB9CgogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZChvaWRUeXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywgYXJncyk7CiAg\nICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYmIF9tZXRh\nLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywgIjxpbml0\nPiIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\nQ2xhc3MuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGFkZEdldElET3duaW5nQ2xhc3MoKSB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0SURPd25pbmdDbGFzcyIs\nCiAgICAgICAgICAgIENsYXNzLmNsYXNzLCBudWxsKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgY29kZS5j\nbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwogICAg\nICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZW4gY29tbXVuaWNhdGluZyB3aXRo\nIHRoZSBTdGF0ZU1hbmFnZXIsIG1hbnkgbWV0aG9kcyBhcmUgdXNlZAogICAg\nICogZGVwZW5kaW5nIG9uIHRoZSBjbGFzcyBvZiBzdGF0ZSBiZWluZyBwYXNz\nZWQuIFRoaXMgbWV0aG9kLAogICAgICogZ2l2ZW4gdGhlIHR5cGUgb2YgaW5m\nb3JtYXRpb24gYmVpbmcgcGFzc2VkIGFuZCB0aGUgcHJlZml4CiAgICAgKiAo\nJ3Byb3ZpZGVkJywgJ3JlcGxhY2UnLCBldGMpIG9mIHRoZSBtZXRob2QgdG8K\nICAgICAqIGNhbGwsIHJldHVybnMgdGhlIFN0YXRlTWFuYWdlciBtZXRob2Qg\ndGhhdCBzaG91bGQgYmUgdXNlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlw\nZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNzZWQKICAgICAqIEBwYXJh\nbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUgbWV0aG9kIHRvIGNhbGw7IGFs\nbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0ZSB0eXBlXUZpZWxkJzsg\nb25seSB0aGUgcHJlZml4IHZhcmllcwogICAgICogQHBhcmFtIGdldCB0cnVl\nIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9tIHRoZQogICAgICogU3Rh\ndGVNYW5hZ2VyLCBmYWxzZSBpZiBwYXNzaW5nIGl0IHRvIHRoZSBTTQogICAg\nICogQHBhcmFtIGN1clZhbHVlIHRydWUgaWYgdGhlIGN1cnJlbnQgc3RhdGUg\ndmFsdWUgaXMgcGFzc2VkIHRvCiAgICAgKiB0aGUgU3RhdGVNYW5hZ2VyIGFz\nIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9k\nIGdldFN0YXRlTWFuYWdlck1ldGhvZChDbGFzcyB0eXBlLCBTdHJpbmcgcHJl\nZml4LAogICAgICAgIGJvb2xlYW4gZ2V0LCBib29sZWFuIGN1clZhbHVlKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBnZXRNZXRob2QoU01UWVBFLCB0eXBlLCBwcmVmaXgsIGdldCwg\ndHJ1ZSwgY3VyVmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBtZXRob2Qgb2YgdGhlIGdpdmVuIG93bmVyIHR5cGUgbWF0Y2hpbmcg\ndGhlIGdpdmVuIGNyaXRlcmlhLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBl\nIHRoZSB0eXBlIG9mIHN0YXRlIGJlaW5nIHBhc3NlZAogICAgICogQHBhcmFt\nIHByZWZpeCB0aGUgcHJlZml4IG9mIHRoZSBtZXRob2QgdG8gY2FsbDsgYWxs\nIG1ldGhvZHMKICAgICAqIGVuZCBpbiAnW3N0YXRlIHR5cGVdRmllbGQnOyBv\nbmx5IHRoZSBwcmVmaXggdmFyaWVzCiAgICAgKiBAcGFyYW0gZ2V0IHRydWUg\naWYgcmVjZWl2aW5nIGluZm9ybWF0aW9uIGZyb20gdGhlCiAgICAgKiBvd25l\nciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0aGUgb3duZXIKICAgICAqIEBw\nYXJhbSBoYXNwYyB0cnVlIGlmIHRoZSBwYyBpcyBwYXNzZWQgYXMgYW4gZXh0\ncmEgYXJndW1lbnQKICAgICAqIEBwYXJhbSBjdXJWYWx1ZSB0cnVlIGlmIHRo\nZSBjdXJyZW50IHN0YXRlIHZhbHVlIGlzIHBhc3NlZCB0bwogICAgICogdGhl\nIG93bmVyIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKi8KICAgIHByaXZh\ndGUgTWV0aG9kIGdldE1ldGhvZChDbGFzcyBvd25lciwgQ2xhc3MgdHlwZSwg\nU3RyaW5nIHByZWZpeCwKICAgICAgICBib29sZWFuIGdldCwgYm9vbGVhbiBo\nYXNwYywgYm9vbGVhbiBjdXJWYWx1ZSkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBhbGwgbWV0aG9kcyBlbmQg\naW4gW2ZpZWxkIHR5cGVdRmllbGQsIHdoZXJlIHRoZSBmaWVsZCB0eXBlCiAg\nICAgICAgLy8gY2FuIGJlIGFueSBvZiB0aGUgcHJpbWl0dmUgdHlwZXMgKGJ1\ndCBjYXBpdGFsaXplZCksICdTdHJpbmcnLAogICAgICAgIC8vIG9yICdPYmpl\nY3QnOyBmaWd1cmUgb3V0IHdoYXQgdHlwZSB0byB1c2UKICAgICAgICBTdHJp\nbmcgdHlwZU5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICBpZiAodHlw\nZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICB0eXBlTmFtZSA9IHR5cGVO\nYW1lLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZShMb2NhbGUuRU5HTElT\nSCkKICAgICAgICAgICAgICAgICsgdHlwZU5hbWUuc3Vic3RyaW5nKDEpOwog\nICAgICAgIGVsc2UgaWYgKHR5cGUuZXF1YWxzKFN0cmluZy5jbGFzcykpCiAg\nICAgICAgICAgIHR5cGVOYW1lID0gIlN0cmluZyI7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIHR5cGVOYW1lID0gIk9iamVjdCI7CiAgICAgICAgICAg\nIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgfQoKICAgICAgICAvLyB0\naGUgZmllbGQgaW5kZXggaXMgYWx3YXlzIHBhc3NlZCBhcyBhbiBhcmc7IHRo\nZSBwYyBpbnN0YW5jZSBhbmQKICAgICAgICAvLyB0aGUgY3VycmVudCB2YWx1\nZSBtYXkgYmUgcGFzc2VkOyBpZiBzZXR0aW5nIHRoZSBuZXcgdmFsdWUgaXMK\nICAgICAgICAvLyBhbHNvIHBhc3NlZAogICAgICAgIExpc3QgcGxpc3QgPSBu\nZXcgQXJyYXlMaXN0KDQpOwogICAgICAgIGlmIChoYXNwYykKICAgICAgICAg\nICAgcGxpc3QuYWRkKFBDVFlQRSk7CiAgICAgICAgcGxpc3QuYWRkKGludC5j\nbGFzcyk7CiAgICAgICAgaWYgKCFnZXQgfHwgY3VyVmFsdWUpCiAgICAgICAg\nICAgIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICBpZiAoIWdldCAmJiBjdXJW\nYWx1ZSkgewogICAgICAgICAgICBwbGlzdC5hZGQodHlwZSk7CiAgICAgICAg\nICAgIHBsaXN0LmFkZChpbnQuY2xhc3MpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gdXNlIHJlZmxlY3Rpb24gdG8gcmV0dXJuIHRoZSByaWdodCBtZXRob2QK\nICAgICAgICBTdHJpbmcgbmFtZSA9IHByZWZpeCArIHR5cGVOYW1lICsgIkZp\nZWxkIjsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IChDbGFzc1tdKSBwbGlz\ndC50b0FycmF5KG5ldyBDbGFzc1twbGlzdC5zaXplKCldKTsKICAgICAgICAK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKE1ldGhvZCkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbihvd25lciwg\nbmFtZSwgcGFyYW1zKSk7CiAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgIHRocm93IChOb1N1\nY2hNZXRob2RFeGNlcHRpb24pIHBhZS5nZXRFeGNlcHRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFk\nZCB0aGUgY29kZSBuZWNlc3NhcnkgdG8gdGhyb3cgdGhlIGdpdmVuCiAgICAg\nKiBleGNlcHRpb24gdHlwZSwgc2FucyBtZXNzYWdlLgogICAgICovCiAgICBw\ncml2YXRlIEluc3RydWN0aW9uIHRocm93RXhjZXB0aW9uKENvZGUgY29kZSwg\nQ2xhc3MgdHlwZSkgewogICAgICAgIEluc3RydWN0aW9uIGlucyA9IGNvZGUu\nYW5ldygpLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgIjxp\nbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUuYXRocm93\nKCk7CiAgICAgICAgcmV0dXJuIGluczsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRlcmZhY2UgdG8gdGhl\nIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCwgYW5kIGFkZHMgYSBkZWZh\ndWx0IGNvbnN0cnVjdG9yIGZvciB1c2UgYnkgT3BlbkpQQQogICAgICogaWYg\naXQgaXMgbm90IGFscmVhZHkgcHJlc2VudC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGVuaGFuY2VDbGFzcygpIHsKICAgICAgICAvLyBtYWtlIHRoZSBj\nbGFzcyBpbXBsZW1lbnQgUGVyc2lzdGVuY2VDYXBhYmxlCiAgICAgICAgX3Bj\nLmRlY2xhcmVJbnRlcmZhY2UoUENUWVBFKTsKCiAgICAgICAgLy8gYWRkIGEg\ndmVyc2lvbiBzdGFtcAogICAgICAgIGFkZEdldEVuaGFuY2VtZW50Q29udHJh\nY3RWZXJzaW9uTWV0aG9kKCk7CgogICAgICAgIC8vIGZpbmQgdGhlIGRlZmF1\nbHQgY29uc3RydWN0b3IKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QoIjxpbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7\nCgogICAgICAgIC8vIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciBpcyByZXF1aXJl\nZAogICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCkgewogICAgICAgICAgICBT\ndHJpbmcgbmFtZSA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIGlmICgh\nX2RlZkNvbnMpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgiZW5oYW5jZS1kZWZhdWx0Y29uc3QiLCBuYW1lKSk7\nCgogICAgICAgICAgICBtZXRob2QgPSBfcGMuYWRkRGVmYXVsdENvbnN0cnVj\ndG9yKCk7CiAgICAgICAgICAgIFN0cmluZyBhY2Nlc3M7CiAgICAgICAgICAg\nIGlmIChfbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAgICAgICAg\nLy8gZXh0ZXJuYWxpemFibGUgcmVxdWlyZXMgdGhhdCB0aGUgY29uc3RydWN0\nb3IKICAgICAgICAgICAgICAgIC8vIGJlIHB1YmxpYywgc28gbWFrZSB0aGUg\nYWRkZWQgY29uc3RydWN0b3IgcHVibGljCiAgICAgICAgICAgICAgICBtZXRo\nb2QubWFrZVB1YmxpYygpOwogICAgICAgICAgICAgICAgYWNjZXNzID0gInB1\nYmxpYyI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3BjLmlzRmluYWwoKSkg\newogICAgICAgICAgICAgICAgbWV0aG9kLm1ha2VQcml2YXRlKCk7CiAgICAg\nICAgICAgICAgICBhY2Nlc3MgPSAicHJpdmF0ZSI7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgp\nOwogICAgICAgICAgICAgICAgYWNjZXNzID0gInByb3RlY3RlZCI7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKCEoX21ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmlzSW50ZXJmYWNlKCkgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkK\nICAgICAgICAgICAgICAgICYmIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNlLWFkZGRl\nZmF1bHRjb25zdCIsIG5hbWUsIGFjY2VzcykpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgdGhlIGZvbGxvd2luZyBmaWVsZHMgdG8g\ndGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZToKICAgICAqIDx1bD4K\nICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBpbnQgcGNJbmhlcml0\nZWRGaWVsZENvdW50PC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJp\ndmF0ZSBzdGF0aWMgQ2xhc3MgcGNQQ1N1cGVyY2xhc3M8L2NvZGU+CiAgICAg\nKiA8L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIFN0cmlu\nZ1tdIHBjRmllbGROYW1lczwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2Rl\nPnByaXZhdGUgc3RhdGljIENsYXNzW10gcGNGaWVsZFR5cGVzPC9jb2RlPjwv\nbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgYnl0ZVtdIHBj\nRmllbGRGbGFnczwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2RlPnByb3Rl\nY3RlZCB0cmFuc2llbnQgU3RhdGVNYW5hZ2VyIHBjU3RhdGVNYW5hZ2VyPC9j\nb2RlPgogICAgICogaWYgbm8gUGVyc2lzdGVuY2VDYXBhYmxlIHN1cGVyY2xh\nc3MgcHJlc2VudCk8L2xpPgogICAgICogPC91bD4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZEZpZWxkcygpIHsKICAgICAgICBfcGMuZGVjbGFyZUZp\nZWxkKElOSEVSSVQsIGludC5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAg\nICAgIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkTmFtZXMiLCBTdHJp\nbmdbXS5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAgICAgIF9wYy5kZWNs\nYXJlRmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKS5z\nZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQUkUg\nKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcykuc2V0U3RhdGljKHRydWUp\nOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoU1VQRVIsIENsYXNzLmNsYXNz\nKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgaWYgKF9hZGRWZXJzaW9uSW5p\ndEZsYWcgJiYgX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCkgIT0gbnVsbCkgewog\nICAgICAgICAgICAvLyBwcm90ZWN0ZWQgdHJhbnNpZW50IGJvb2xlYW4gcGNW\nZXJzaW9uSW5pdDsKICAgICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5k\nZWNsYXJlRmllbGQoVkVSU0lPTl9JTklUX1NUUiwgYm9vbGVhbi5jbGFzcyk7\nCiAgICAgICAgICAgIGZpZWxkLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICAg\nICAgZmllbGQuc2V0VHJhbnNpZW50KHRydWUpOwogICAgICAgIH0KICAgICAg\nICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIEJDRmllbGQgZmllbGQg\nPSBfcGMuZGVjbGFyZUZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBm\naWVsZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGZpZWxkLnNldFRy\nYW5zaWVudCh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNb2RpZmllcyB0aGUgY2xhc3MgaW5pdGlhbGl6YXRpb24gbWV0aG9kIChj\ncmVhdGluZyBvbmUgaWYgbmVjZXNzYXJ5KQogICAgICogdG8gaW5pdGlhbGl6\nZSB0aGUgc3RhdGljIGZpZWxkcyBvZiB0aGUgUGVyc2lzdGVuY2VDYXBhYmxl\nIGluc3RhbmNlIGFuZAogICAgICogdG8gcmVnaXN0ZXIgaXQgd2l0aCB0aGUg\naW1wbCBoZWxwZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTdGF0\naWNJbml0aWFsaXplcigpIHsKICAgICAgICBDb2RlIGNvZGUgPSBnZXRPckNy\nZWF0ZUNsYXNzSW5pdENvZGUodHJ1ZSk7CiAgICAgICAgaWYgKF9tZXRhLmdl\ndFBDU3VwZXJjbGFzcygpICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGdl\ndENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICAgICAgICAgIGNvZGUucHV0\nc3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHBjSW5oZXJpdGVk\nRmllbGRDb3VudCA9IDxzdXBlckNsYXNzPi5wY0dldE1hbmFnZWRGaWVsZENv\ndW50KCkKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0\nTWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmllbGRDb3VudCIsIGludC5j\nbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAgICAgICAgICAgY29kZS5w\ndXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBwY1BDU3VwZXJjbGFzcyA9IDxz\ndXBlckNsYXNzPjsKICAgICAgICAgICAgLy8gdGhpcyBpbnRlbnRpb25hbGx5\nIGNhbGxzIGdldERlc2NyaWJlZFR5cGUoKSBkaXJlY3RseQogICAgICAgICAg\nICAvLyBpbnN0ZWFkIG9mIFBDRW5oYW5jZXIuZ2V0VHlwZSgpCiAgICAgICAg\nICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKAogICAgICAgICAg\nICAgICAgX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXREZXNj\ncmliZWRUeXBlKCkpOwogICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNl\ndEZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBwY0ZpZWxkTmFtZXMgPSBuZXcgU3RyaW5nW10geyAiPG5hbWUxPiIs\nICI8bmFtZTI+IiwgLi4uIH07CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAgICAgY29k\nZS5hbmV3YXJyYXkoKS5zZXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGZtZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgY29kZS5h\nYXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIGNvZGUucHV0c3RhdGljKCku\nc2V0RmllbGQoUFJFICsgIkZpZWxkTmFtZXMiLCBTdHJpbmdbXS5jbGFzcyk7\nCgogICAgICAgIC8vIHBjRmllbGRUeXBlcyA9IG5ldyBDbGFzc1tdIHsgPHR5\ncGUxPi5jbGFzcywgPHR5cGUyPi5jbGFzcywgLi4uIH07CiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBj\nb2RlLmFuZXdhcnJheSgpLnNldFR5cGUoQ2xhc3MuY2xhc3MpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFu\ndCgpLnNldENsYXNzKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAg\nICAgICAgICBjb2RlLmFhc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgY29k\nZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChQUkUgKyAiRmllbGRUeXBlcyIsIENs\nYXNzW10uY2xhc3MpOwoKICAgICAgICAvLyBwY0ZpZWxkRmxhZ3MgPSBuZXcg\nYnl0ZVtdIHsgPGZsYWcxPiwgPGZsYWcyPiwgLi4uIH07CiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBj\nb2RlLm5ld2FycmF5KCkuc2V0VHlwZShieXRlLmNsYXNzKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoZ2V0RmllbGRGbGFnKGZtZHNbaV0pKTsKICAgICAgICAgICAgY29k\nZS5iYXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIGNvZGUucHV0c3RhdGlj\nKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkRmxhZ3MiLCBieXRlW10uY2xhc3Mp\nOwoKICAgICAgICAvLyBQQ1JlZ2lzdHJ5LnJlZ2lzdGVyIChjbHMsCiAgICAg\nICAgLy8JcGNGaWVsZE5hbWVzLCBwY0ZpZWxkVHlwZXMsIHBjRmllbGRGbGFn\ncywKICAgICAgICAvLyAgcGNQQ1N1cGVyY2xhc3MsIGFsaWFzLCBuZXcgWFhY\nICgpKTsKICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhf\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgIGNvZGUuZ2V0c3Rh\ndGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkTmFtZXMiLCBTdHJpbmdbXS5j\nbGFzcyk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQUkUg\nKyAiRmllbGRUeXBlcyIsIENsYXNzW10uY2xhc3MpOwogICAgICAgIGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkRmxhZ3MiLCBieXRl\nW10uY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQo\nU1VQRVIsIENsYXNzLmNsYXNzKTsKICAgICAgICAKICAgICAgICBpZiAoX21l\ndGEuaXNNYXBwZWQoKSkKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKF9tZXRhLmdldFR5cGVBbGlhcygpKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CgogICAgICAg\nIGlmIChfcGMuaXNBYnN0cmFjdCgpKQogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0TnVsbCgpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgICAgIGNvZGUuZHVw\nKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhv\nZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgfQoKICAg\nICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChIRUxQRVJUWVBF\nLCAicmVnaXN0ZXIiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xh\nc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZ1tdLmNsYXNzLCBDbGFzc1tdLmNs\nYXNzLAogICAgICAgICAgICAgICAgYnl0ZVtdLmNsYXNzLCBDbGFzcy5jbGFz\ncywgU3RyaW5nLmNsYXNzLCBQQ1RZUEUgfSk7CgogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZmxhZyBmb3IgdGhlIGdp\ndmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBieXRlIGdl\ndEZpZWxkRmxhZyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChm\nbWQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxkTWV0YURhdGEuTUFOQUdFX05P\nTkUpCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgYnl0ZSBmbGFn\ncyA9IDA7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGUoKS5pc1By\naW1pdGl2ZSgpCiAgICAgICAgICAgIHx8IFNlcmlhbGl6YWJsZS5jbGFzcy5p\nc0Fzc2lnbmFibGVGcm9tKGZtZC5nZXREZWNsYXJlZFR5cGUoKSkpCiAgICAg\nICAgICAgIGZsYWdzID0gUGVyc2lzdGVuY2VDYXBhYmxlLlNFUklBTElaQUJM\nRTsKCiAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRN\nZXRhRGF0YS5NQU5BR0VfVFJBTlNBQ1RJT05BTCkKICAgICAgICAgICAgZmxh\nZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1dSSVRFOwogICAgICAg\nIGVsc2UgaWYgKCFmbWQuaXNQcmltYXJ5S2V5KCkgJiYgIWZtZC5pc0luRGVm\nYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAgZmxhZ3MgfD0gUGVyc2lz\ndGVuY2VDYXBhYmxlLkNIRUNLX1dSSVRFCiAgICAgICAgICAgICAgICB8IFBl\ncnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFEOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgZmxhZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLk1FRElBVEVf\nV1JJVEUKICAgICAgICAgICAgICAgIHwgUGVyc2lzdGVuY2VDYXBhYmxlLk1F\nRElBVEVfUkVBRDsKICAgICAgICByZXR1cm4gZmxhZ3M7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSBjb2RlIHRvIHByb3Blcmx5IGhhbmRsZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUgc2VyaWFsaXphdGlvbgogICAgICogdG8gdGhl\nIGJ5dGVjb2RlLiBUaGlzIGluY2x1ZGVzIGNyZWF0aW5nIGFuZCBpbml0aWFs\naXppbmcgdGhlCiAgICAgKiBzdGF0aWMgPGNvZGU+c2VyaWFsVmVyc2lvblVJ\nRDwvY29kZT4gY29uc3RhbnQgaWYgbm90IGFscmVhZHkgZGVmaW5lZCwKICAg\nICAqIGFzIHdlbGwgYXMgY3JlYXRpbmcgYSBjdXN0b20gPGNvZGU+d3JpdGVP\nYmplY3Q8L2NvZGU+IG1ldGhvZCBpZiB0aGUKICAgICAqIGNsYXNzIGlzIFNl\ncmlhbGl6YWJsZSBhbmQgZG9lcyBub3QgZGVmaW5lIHRoZW0uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRTZXJpYWxpemF0aW9uQ29kZSgpIHsKICAg\nICAgICBpZiAoZXh0ZXJuYWxpemVEZXRhY2hlZCgpCiAgICAgICAgICAgIHx8\nICFTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8v\nICMjIyMjIHdoYXQgc2hvdWxkIGhhcHBlbiBpZiBhIHR5cGUgaXMgRXh0ZXJu\nYWxpemFibGU/IEl0IGxvb2tzCiAgICAgICAgICAgIC8vICMjIyMjIGxpa2Ug\nRXh0ZXJuYWxpemFibGUgY2xhc3NlcyB3aWxsIG5vdCBiZSBzZXJpYWxpemVk\nIGFzIFBDcwogICAgICAgICAgICAvLyAjIyMjIyBiYXNlZCBvbiB0aGlzIGxv\nZ2ljLgogICAgICAgICAgICBpZiAoIUV4dGVybmFsaXphYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oCiAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNj\ncmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NTZXJp\nYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiBub3QgYWxyZWFkeSBwcmVzZW50LCBhZGQgYSBz\nZXJpYWxWZXJzaW9uVUlEIGZpZWxkOyBpZiB0aGUgaW5zdGFuY2UKICAgICAg\nICAvLyBpcyBkZXRhY2hhYmxlIGFuZCB1c2VzIGRldGFjaGVkIHN0YXRlIHdp\ndGhvdXQgYSBkZWNsYXJlZCBmaWVsZCwKICAgICAgICAvLyBjYW4ndCBhZGQg\nYSBzZXJpYWwgdmVyc2lvbiBVSUQgYmVjYXVzZSB3ZSdsbCBiZSBhZGRpbmcg\nZXh0cmEgZmllbGRzCiAgICAgICAgLy8gdG8gdGhlIGVuaGFuY2VkIHZlcnNp\nb24KICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERlY2xhcmVkRmll\nbGQoInNlcmlhbFZlcnNpb25VSUQiKTsKICAgICAgICBpZiAoZmllbGQgPT0g\nbnVsbCkgewogICAgICAgICAgICBMb25nIHVpZCA9IG51bGw7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICB1aWQgPSBOdW1iZXJzLnZhbHVl\nT2YoT2JqZWN0U3RyZWFtQ2xhc3MubG9va3VwCiAgICAgICAgICAgICAgICAg\nICAgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkuZ2V0U2VyaWFsVmVyc2lv\nblVJRCgpKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsK\nICAgICAgICAgICAgICAgIC8vIGxhc3QtY2hhbmNlIGNhdGNoIGZvciBidWcg\nIzI4MyAod2hpY2ggY2FuIGhhcHBlbgogICAgICAgICAgICAgICAgLy8gaW4g\nYSB2YXJpZXR5IG9mIENsYXNzTG9hZGluZyBlbnZpcm9ubWVudHMpCiAgICAg\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS11aWQt\nYWNjZXNzIiwgX21ldGEpLCB0KTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2Ut\ndWlkLWFjY2VzcyIsIF9tZXRhKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGlmIHdlIGNvdWxkbid0IGFjY2VzcyB0aGUgc2VyaWFsVmVyc2lv\nblVJRCwgd2Ugd2lsbCBoYXZlIHRvCiAgICAgICAgICAgIC8vIHNraXAgdGhl\nIG92ZXJyaWRlIG9mIHRoYXQgZmllbGQgYW5kIG5vdCBiZSBzZXJpYWxpemF0\naW9uCiAgICAgICAgICAgIC8vIGNvbXBhdGlibGUgd2l0aCBub24tZW5oYW5j\nZWQgY2xhc3NlcwogICAgICAgICAgICBpZiAodWlkICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZCgic2VyaWFs\nVmVyc2lvblVJRCIsIGxvbmcuY2xhc3MpOwogICAgICAgICAgICAgICAgZmll\nbGQubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGZpZWxkLnNldFN0\nYXRpYyh0cnVlKTsKICAgICAgICAgICAgICAgIGZpZWxkLnNldEZpbmFsKHRy\ndWUpOwoKICAgICAgICAgICAgICAgIENvZGUgY29kZSA9IGdldE9yQ3JlYXRl\nQ2xhc3NJbml0Q29kZShmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmJl\nZm9yZUZpcnN0KCk7CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUodWlkLmxvbmdWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNv\nZGUucHV0c3RhdGljKCkuc2V0RmllbGQoZmllbGQpOwoKICAgICAgICAgICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHdyaXRlIG9iamVjdCBtZXRob2QK\nICAgICAgICBCQ01ldGhvZCB3cml0ZSA9IF9wYy5nZXREZWNsYXJlZE1ldGhv\nZCgid3JpdGVPYmplY3QiLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAgIGJvb2xlYW4gZnVs\nbCA9IHdyaXRlID09IG51bGw7CiAgICAgICAgaWYgKGZ1bGwpIHsKICAgICAg\nICAgICAgLy8gcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0IChPYmplY3RPdXRw\ndXRTdHJlYW0gb3V0KQogICAgICAgICAgICB3cml0ZSA9IF9wYy5kZWNsYXJl\nTWV0aG9kKCJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH0p\nOwogICAgICAgICAgICB3cml0ZS5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4\nY2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHdyaXRl\nLm1ha2VQcml2YXRlKCk7CiAgICAgICAgfQogICAgICAgIG1vZGlmeVdyaXRl\nT2JqZWN0TWV0aG9kKHdyaXRlLCBmdWxsKTsKCiAgICAgICAgLy8gYW5kIHJl\nYWQgb2JqZWN0CiAgICAgICAgQkNNZXRob2QgcmVhZCA9IF9wYy5nZXREZWNs\nYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICBmdWxs\nID0gcmVhZCA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7CiAgICAgICAg\nICAgIC8vIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0IChPYmplY3RJbnB1dFN0\ncmVhbSBpbikKICAgICAgICAgICAgcmVhZCA9IF9wYy5kZWNsYXJlTWV0aG9k\nKCJyZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5l\ndyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAg\nICAgICAgcmVhZC5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4Y2VwdGlvbihJ\nT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHJlYWQuZ2V0RXhjZXB0\naW9ucyh0cnVlKS5hZGRFeGNlcHRpb24KICAgICAgICAgICAgICAgIChDbGFz\nc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgcmVhZC5t\nYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2RpZnlSZWFkT2Jq\nZWN0TWV0aG9kKHJlYWQsIGZ1bGwpOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBhZGRTdWJjbGFzc1NlcmlhbGl6YXRpb25Db2RlKCkgewogICAgICAgIC8v\nIGZvciBnZW5lcmF0ZWQgc3ViY2xhc3Nlcywgc2VyaWFsaXphdGlvbiBtdXN0\nIHdyaXRlIGFuIGluc3RhbmNlIG9mCiAgICAgICAgLy8gdGhlIHN1cGVyY2xh\nc3MgaW5zdGVhZCBvZiB0aGUgc3ViY2xhc3MsIHNvIHRoYXQgdGhlIGNsaWVu\ndCBWTSBjYW4KICAgICAgICAvLyBkZXNlcmlhbGl6ZSBzdWNjZXNzZnVsbHku\nCgogICAgICAgIC8vIHByaXZhdGUgT2JqZWN0IHdyaXRlUmVwbGFjZSgpIHRo\ncm93cyBPYmplY3RTdHJlYW1FeGNlcHRpb24KICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVSZXBsYWNlIiwgT2Jq\nZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRob2QuZ2V0RXhjZXB0aW9u\ncyh0cnVlKS5hZGRFeGNlcHRpb24oT2JqZWN0U3RyZWFtRXhjZXB0aW9uLmNs\nYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgLy8gT2JqZWN0IG8gPSBuZXcgPG1hbmFnZWQtdHlwZT4o\nKQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX21hbmFnZWRUeXBlKTsg\nLy8gZm9yIHJldHVybgogICAgICAgIGNvZGUuZHVwKCk7IC8vIGZvciBwb3N0\nLTxpbml0PiB3b3JrCiAgICAgICAgY29kZS5kdXAoKTsgLy8gZm9yIDxpbml0\nPgogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFu\nYWdlZFR5cGUuZ2V0VHlwZSgpLCAiPGluaXQ+IiwKICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbnVsbCk7CgogICAgICAgIC8vIGNvcHkgYWxsIHRoZSBmaWVs\nZHMuCiAgICAgICAgLy8gIyMjIyMgbGltaXRpbmcgdG8gSlBBIEBUcmFuc2ll\nbnQgbGltaXRhdGlvbnMKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9\nIF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1kc1tp\nXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgIC8vIG8uPGZpZWxkPiA9IHRoaXMuPGZpZWxkPiAob3IgcmVm\nbGVjdGl2ZSBhbmFsb2cpCiAgICAgICAgICAgIGNvZGUuZHVwKCk7IC8vIGZv\nciBwdXRmaWVsZAogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygp\nOyAvLyBmb3IgZ2V0ZmllbGQKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwg\nX21hbmFnZWRUeXBlLCBmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAg\nIHB1dGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5nZXROYW1l\nKCksCiAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgp\nKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuYXJldHVybigpLnNldFR5cGUo\nT2JqZWN0LmNsYXNzKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBjbGFzcyBiZWluZyBlbmhh\nbmNlZCBzaG91bGQgZXh0ZXJuYWxpemUgdG8gYSBkZXRhY2hlZAogICAgICog\naW5zdGFuY2UgcmF0aGVyIHRoYW4gc2VyaWFsaXplLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gZXh0ZXJuYWxpemVEZXRhY2hlZCgpIHsKICAgICAg\nICByZXR1cm4gQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRh\nLmdldERldGFjaGVkU3RhdGUoKSkKICAgICAgICAgICAgJiYgU2VyaWFsaXph\nYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpKQogICAgICAgICAgICAmJiAhX3JlcG9zLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuCiAgICAgICAgICAgIGlz\nRGV0YWNoZWRTdGF0ZVRyYW5zaWVudCgpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyBhIGN1c3RvbSB3cml0ZU9iamVjdCBtZXRob2QgdGhhdCBkZWxl\nZ2F0ZXMgdG8gdGhlCiAgICAgKiB7QGxpbmsgT2JqZWN0T3V0cHV0U3RyZWFt\nI2RlZmF1bHRXcml0ZU9iamVjdH0gbWV0aG9kLAogICAgICogYnV0IG9ubHkg\nYWZ0ZXIgY2FsbGluZyB0aGUgaW50ZXJuYWwgPGNvZGU+cGNTZXJpYWxpemlu\nZzwvY29kZT4gbWV0aG9kLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbW9k\naWZ5V3JpdGVPYmplY3RNZXRob2QoQkNNZXRob2QgbWV0aG9kLCBib29sZWFu\nIGZ1bGwpIHsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIC8v\nIGJvb2wgY2xlYXIgPSBwY1NlcmlhbGl6aW5nICgpOwogICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2VyaWFsaXppbmciLAog\nICAgICAgICAgICBib29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBpbnQg\nY2xlYXIgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNv\nZGUuaXN0b3JlKCkuc2V0TG9jYWwoY2xlYXIpOwoKICAgICAgICBpZiAoZnVs\nbCkgewogICAgICAgICAgICAvLyBvdXQuZGVmYXVsdFdyaXRlT2JqZWN0ICgp\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RP\ndXRwdXRTdHJlYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAiZGVmYXVsdFdy\naXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgSW5zdHJ1Y3Rpb24g\ndG1wbGF0ZSA9ICgoQ29kZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24o\nKSkpLnZyZXR1cm4oKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gdG9yZXQ7\nCiAgICAgICAgSW5zdHJ1Y3Rpb24gcmV0OwogICAgICAgIGNvZGUuYmVmb3Jl\nRmlyc3QoKTsKICAgICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRt\ncGxhdGUpKSB7CiAgICAgICAgICAgIHJldCA9IGNvZGUucHJldmlvdXMoKTsK\nICAgICAgICAgICAgLy8gaWYgKGNsZWFyKSBwY1NldERldGFjaGVkU3RhdGUg\nKG51bGwpOwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoY2xl\nYXIpOwogICAgICAgICAgICB0b3JldCA9IGNvZGUuaWZlcSgpOwogICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXREZXRh\nY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIHRvcmV0LnNl\ndFRhcmdldChyZXQpOwogICAgICAgICAgICBjb2RlLm5leHQoKTsgLy8ganVt\ncCBvdmVyIHJldHVybgogICAgICAgIH0KICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBjdXN0b20gcmVhZE9i\namVjdCBtZXRob2QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiB7QGxp\nbmsgT2JqZWN0SW5wdXRTdHJlYW0jcmVhZE9iamVjdH0gbWV0aG9kLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgbW9kaWZ5UmVhZE9iamVjdE1ldGhvZChC\nQ01ldGhvZCBtZXRob2QsIGJvb2xlYW4gZnVsbCkgewogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYmVm\nb3JlRmlyc3QoKTsKCiAgICAgICAgLy8gaWYgdGhpcyBpbnN0YW5jZSB1c2Vz\nIHN5bnRoZXRpYyBkZXRhY2hlZCBzdGF0ZSwgbm90ZSB0aGF0IGl0IGhhcwog\nICAgICAgIC8vIGJlZW4gZGVzZXJpYWxpemVkCiAgICAgICAgaWYgKENsYXNz\nTWV0YURhdGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hlZFN0\nYXRlKCkpKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAg\nICJERVNFUklBTElaRUQiLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNldERldGFj\naGVkU3RhdGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICB9CgogICAgICAgIGlm\nIChmdWxsKSB7CiAgICAgICAgICAgIC8vIGluLmRlZmF1bHRSZWFkT2JqZWN0\nICgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmpl\nY3RJbnB1dFN0cmVhbS5jbGFzcywKICAgICAgICAgICAgICAgICJkZWZhdWx0\nUmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgcGNJc0Rl\ndGFjaGVkKCkgbWV0aG9kIHRvIGRldGVybWluZSBpZiBhbiBpbnN0YW5jZQog\nICAgICogaXMgZGV0YWNoZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRJc0RldGFjaGVkTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgYm9vbGVhbiBwY0lz\nRGV0YWNoZWQoKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJJc0RldGFjaGVkIiwKICAgICAgICAgICAgQm9v\nbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBib29sZWFuIG5lZWRzRGVmaW5pdGl2ZU1ldGhvZCA9IHdyaXRl\nSXNEZXRhY2hlZE1ldGhvZChjb2RlKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICBpZiAoIW5lZWRzRGVmaW5pdGl2ZU1ldGhvZCkgCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gcHJpdmF0ZSBib29sZWFuIHBj\nSXNEZXRhY2hlZFN0YXRlRGVmaW5pdGl2ZSgpCiAgICAgICAgLy8gICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgLy8gYXV4aWxsaWFyeSBlbmhhbmNlcnMgbWF5\nIGNoYW5nZSB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoaXMgbWV0aG9kCiAgICAg\nICAgLy8gaWYgdGhlaXIgc3BlY3MgY29uc2lkZXIgZGV0YWNoZWQgc3RhdGUg\nZGVmaW5pdGl2ZQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9k\nKElTREVUQUNIRURTVEFURURFRklOSVRJVkUsIGJvb2xlYW4uY2xhc3MsCiAg\nICAgICAgICAgIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgp\nOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwogICAgICAgIGNv\nZGUuaXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgYm9keSBvZiB0aGUgcGNJc0Rl\ndGFjaGVkKCkgbWV0aG9kIHRvIGRldGVybWluZSBpZiBhbgogICAgICogaW5z\ndGFuY2UgaXMgZGV0YWNoZWQuCiAgICAgKgogICAgICogQHJldHVybiB0cnVl\nIGlmIHdlIG5lZWQgYSBwY0lzRGV0YWNoZWRTdGF0ZURlZmluaXRpdmUgbWV0\naG9kLCBmYWxzZQogICAgICogb3RoZXJ3aXNlCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiB3cml0ZUlzRGV0YWNoZWRNZXRob2QoQ29kZSBjb2RlKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIC8vIG5vdCBkZXRhY2hhYmxlOiByZXR1cm4gQm9vbGVhbi5GQUxTRQogICAg\nICAgIGlmICghX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFM\nU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAgICAgIC8vCQlyZXR1cm4gKHNt\nLmlzRGV0YWNoZWQgKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwo\nKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01U\nWVBFLCAiaXNEZXRhY2hlZCIsCiAgICAgICAgICAgIGJvb2xlYW4uY2xhc3Ms\nIG51bGwpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmZhbHNlID0gY29k\nZS5pZmVxKCk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChC\nb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgIGlmZmFsc2Uuc2V0VGFyZ2V0KGNv\nZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNF\nIiwKICAgICAgICAgICAgQm9vbGVhbi5jbGFzcykpOwogICAgICAgIGNvZGUu\nYXJldHVybigpOwoKICAgICAgICAvLyBpZiB3ZSB1c2UgZGV0YWNoZWQgc3Rh\ndGU6CiAgICAgICAgLy8gaWYgKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSAhPSBu\ndWxsCiAgICAgICAgLy8gICAgICYmIHBjR2V0RGV0YWNoZWRTdGF0ZSAhPSBE\nRVNFUklBTElaRUQpCiAgICAgICAgLy8gICAgIHJldHVybiBCb29sZWFuLlRS\nVUU7CiAgICAgICAgQm9vbGVhbiBzdGF0ZSA9IF9tZXRhLnVzZXNEZXRhY2hl\nZFN0YXRlKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIG5vdGRlc2VyID0g\nbnVsbDsKICAgICAgICBJbnN0cnVjdGlvbiB0YXJnZXQ7CiAgICAgICAgaWYg\nKHN0YXRlICE9IEJvb2xlYW4uRkFMU0UpIHsKICAgICAgICAgICAgaWZpbnMu\nc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBS\nRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIE9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm51\nbGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAg\nICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAg\nICAgICAgICAgICAgICJERVNFUklBTElaRUQiLCBPYmplY3QuY2xhc3MpOwog\nICAgICAgICAgICBub3RkZXNlciA9IGNvZGUuaWZhY21wZXEoKTsKICAgICAg\nICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNz\nLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKCiAgICAgICAgICAgIGlmIChzdGF0ZSA9PSBCb29sZWFuLlRS\nVUUpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgdG8gdXNlIGRl\ndGFjaGVkIHN0YXRlOgogICAgICAgICAgICAgICAgLy8gcmV0dXJuIEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgICAgICAgICB0YXJnZXQgPSBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAgICAg\nICAgICAgICAgICAgICAgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgICAg\nICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIG5v\ndGRlc2VyLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBhcnRp\nZmljaWFsIHRhcmdldCB0byBzaW1wbGlmeQogICAgICAgIHRhcmdldCA9IGNv\nZGUubm9wKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAg\nICAgICAgaWYgKG5vdGRlc2VyICE9IG51bGwpCiAgICAgICAgICAgIG5vdGRl\nc2VyLnNldFRhcmdldCh0YXJnZXQpOwoKICAgICAgICAvLyBhbGxvdyB1c2Vy\ncyB3aXRoIHZlcnNpb24gb3IgYXV0by1hc3NpZ25lZCBwayBmaWVsZHMgdG8g\nbWFudWFsbHkgCiAgICAgICAgLy8gY29uc3RydWN0IGEgImRldGFjaGVkIiBp\nbnN0YW5jZSwgc28gY2hlY2sgdGhlc2UgYmVmb3JlIHRha2luZyBpbnRvIAog\nICAgICAgIC8vIGFjY291bnQgbm9uLWV4aXN0ZW50IGRldGFjaGVkIHN0YXRl\nCgogICAgICAgIC8vIGNvbnNpZGVyIGRldGFjaGVkIGlmIHZlcnNpb24gaXMg\nbm9uLWRlZmF1bHQKICAgICAgICBGaWVsZE1ldGFEYXRhIHZlcnNpb24gPSBf\nbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKICAgICAgICBpZiAoc3RhdGUgIT0g\nQm9vbGVhbi5UUlVFICYmIHZlcnNpb24gIT0gbnVsbCkgewogICAgICAgICAg\nICAvLyBpZiAoPHZlcnNpb24+ICE9IDxkZWZhdWx0PikKICAgICAgICAgICAg\nLy8JCXJldHVybiB0cnVlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCB2ZXJzaW9uKTsKICAgICAgICAgICAgaWZpbnMgPSBp\nZkRlZmF1bHRWYWx1ZShjb2RlLCB2ZXJzaW9uKTsKICAgICAgICAgICAgY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiVFJVRSIs\nIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICAgICAgaWYgKCFfYWRkVmVyc2lvbkluaXRGbGFnKXsKICAgICAg\nICAgICAgICAgIC8vIGVsc2UgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQo\nQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcykpOwogICAg\nICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGEg\ndmVyc2lvbkluaXQgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkKFZFUlNJT05f\nSU5JVF9TVFIpOwogICAgICAgICAgICAgICAgLy8gbm9vcAogICAgICAgICAg\nICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgICAg\nICAgICAgLy8gaWYgKHBjVmVyc2lvbkluaXQpCiAgICAgICAgICAgICAgICAv\nLyByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgLy8gZWxzZSByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51\nbGwsIHZlcnNpb25Jbml0LmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICBp\nZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNvZGUsIHZlcnNpb25Jbml0KTsKICAg\nICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgICAgICAgICAgY29kZS5nZXRz\ndGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29s\nZWFuLmNsYXNzKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hl\nZCBpZiBhdXRvLWdlbm5lZCBwcmltYXJ5IGtleXMgYXJlIG5vbi1kZWZhdWx0\nCiAgICAgICAgaWZpbnMgPSBudWxsOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmluczIgPSBudWxsOwogICAgICAgIGJvb2xlYW4gaGFzQXV0b0Fzc2ln\nbmVkUEsgPSBmYWxzZTsKICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5U\nUlVFCiAgICAgICAgICAgICYmIF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAg\nLy8gZm9yIGVhY2ggcGsgZmllbGQ6CiAgICAgICAgICAgIC8vIGlmICg8cGs+\nICE9IDxkZWZhdWx0PiBbJiYgISIiLmVxdWFscyAoPHBrPildKQogICAgICAg\nICAgICAvLwkJcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIHBrcyA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFsdWVT\ndHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRhcmdldCA9\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgaWYgKGlmaW5zICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\naWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZiAo\naWZpbnMyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZpbnMyLnNl\ndFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAgaWZpbnMyID0gbnVs\nbDsKCiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVs\ndFZhbHVlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAocGtz\nW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuU1RSSU5H\nKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKCIiKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBhZGRHZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZy5j\nbGFzcywgImVxdWFscyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xl\nYW4uY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAg\nICAgICAgICAgICAgICAgaWZpbnMyID0gY29kZS5pZm5lKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNl\ndEZpZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwKICAgICAgICAgICAgICAg\nICAgICBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBj\ncmVhdGUgYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0\nYXJnZXQgPSBjb2RlLm5vcCgpOwogICAgICAgIGlmIChpZmlucyAhPSBudWxs\nKQogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAg\nICBpZiAoaWZpbnMyICE9IG51bGwpCiAgICAgICAgICAgIGlmaW5zMi5zZXRU\nYXJnZXQodGFyZ2V0KTsKCiAgICAgICAgLy8gaWYgaGFzIGF1dG8tYXNzaWdu\nZWQgcGsgYW5kIHdlIGdldCB0byB0aGlzIHBvaW50LCBtdXN0IGhhdmUgZGVm\nYXVsdAogICAgICAgIC8vIHZhbHVlLCBzbyBtdXN0IGJlIG5ldyBpbnN0YW5j\nZQogICAgICAgIGlmIChoYXNBdXRvQXNzaWduZWRQSykgewogICAgICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJG\nQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgZGV0YWNoZWQgc3RhdGUgaXMgbm90IGRlZmluaXRpdmUs\nIGp1c3QgZ2l2ZSB1cCBub3cgYW5kIHJldHVybgogICAgICAgIC8vIG51bGwg\nc28gdGhhdCB0aGUgcnVudGltZSB3aWxsIHBlcmZvcm0gYSBEQiBsb29rdXAg\ndG8gZGV0ZXJtaW5lCiAgICAgICAgLy8gd2hldGhlciB3ZSdyZSBkZXRhY2hl\nZCBvciBuZXcKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChJU0RFVEFDSEVE\nU1RBVEVERUZJTklUSVZFLCBib29sZWFuLmNsYXNzLAogICAgICAgICAgICBu\ndWxsKTsKICAgICAgICBpZmlucyA9IGNvZGUuaWZuZSgpOwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoKICAg\nICAgICAvLyBubyBkZXRhY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBk\nZXRhY2hlZCBzdGF0ZSBhbmQgaXQncyBub3QKICAgICAgICAvLyBzeW50aGV0\naWMgb3IgdGhlIGluc3RhbmNlIGlzIG5vdCBzZXJpYWxpemFibGUgb3IgdGhl\nIHN0YXRlIGlzbid0CiAgICAgICAgLy8gdHJhbnNpZW50LCBtdXN0IG5vdCBi\nZSBkZXRhY2hlZAogICAgICAgIGlmIChzdGF0ZSA9PSBudWxsCiAgICAgICAg\nICAgICYmICghQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRh\nLmdldERldGFjaGVkU3RhdGUoKSkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6\nYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSkKICAgICAgICAgICAgfHwgIV9yZXBvcy5nZXRDb25maWd1cmF0\naW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBp\nc0RldGFjaGVkU3RhdGVUcmFuc2llbnQoKSkpIHsKICAgICAgICAgICAgLy8g\ncmV0dXJuIEJvb2xlYW4uRkFMU0UKICAgICAgICAgICAgY29kZS5nZXRzdGF0\naWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFu\nLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gZGV0\nYWNoZWQgc3RhdGU6IGlmIGluc3RhbmNlIHVzZXMgZGV0YWNoZWQgc3RhdGUg\nKGFuZCBtdXN0IGJlCiAgICAgICAgLy8gc3ludGhldGljIGFuZCB0cmFuc2ll\nbnQgaW4gc2VyaWFsaXphYmxlIGluc3RhbmNlIGF0IHRoaXMgcG9pbnQpLAog\nICAgICAgIC8vIG5vdCBkZXRhY2hlZCBpZiBzdGF0ZSBub3Qgc2V0IHRvIERF\nU0VSSUFMSVpFRAogICAgICAgIGlmIChzdGF0ZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUgKCkgPT0gbnVsbCkg\nLy8gaW5zdGVhZCBvZiBERVNFUklBTElaRUQKICAgICAgICAgICAgLy8gICAg\nIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRl\nIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFM\nU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsK\nICAgICAgICB9CgogICAgICAgIC8vIGdpdmUgdXA7IHdlIGp1c3QgZG9uJ3Qg\na25vdwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb21wYXJlIHRoZSBnaXZlbiBmaWVsZCB0byBp\ndHMgSmF2YSBkZWZhdWx0LCByZXR1cm5pbmcgdGhlCiAgICAgKiBjb21wYXJp\nc29uIGluc3RydWN0aW9uLiBUaGUgZmllbGQgdmFsdWUgd2lsbCBhbHJlYWR5\nIGJlIG9uIHRoZSBzdGFjay4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nSnVtcEluc3RydWN0aW9uIGlmRGVmYXVsdFZhbHVlKENvZGUgY29kZSwKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZl\ncSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAg\nICAgICAgICAgICAgY29kZS5kY21wbCgpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVDoKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgwRik7CiAgICAgICAgICAgICAgICBjb2RlLmZjbXBsKCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMEwpOwogICAgICAgICAgICAgICAgY29kZS5sY21wKCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZm51\nbGwoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIGdldCB0aGUgY29kZSBmb3IgdGhlIGNsYXNzIGluaXRpYWxp\nemVyIG1ldGhvZCwKICAgICAqIGNyZWF0aW5nIHRoZSBtZXRob2QgaWYgaXQg\nZG9lcyBub3QgYWxyZWFkeSBleGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBD\nb2RlIGdldE9yQ3JlYXRlQ2xhc3NJbml0Q29kZShib29sZWFuIHJlcGxhY2VM\nYXN0KSB7CiAgICAgICAgQkNNZXRob2QgY2xpbml0ID0gX3BjLmdldERlY2xh\ncmVkTWV0aG9kKCI8Y2xpbml0PiIpOwogICAgICAgIENvZGUgY29kZTsKICAg\nICAgICBpZiAoY2xpbml0ICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZSA9\nIGNsaW5pdC5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBpZiAocmVwbGFj\nZUxhc3QpIHsKICAgICAgICAgICAgICAgIENvZGUgdGVtcGxhdGUgPSAoQ29k\nZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAg\nICAgICAgICAgICAgIGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZS52cmV0\ndXJuKCkpOwogICAgICAgICAgICAgICAgY29kZS5wcmV2aW91cygpOwogICAg\nICAgICAgICAgICAgY29kZS5zZXQodGVtcGxhdGUubm9wKCkpOwogICAgICAg\nICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGNvZGU7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgc3Rh\ndGljIGluaXRpYWxpemVyIG1ldGhvZCBpZiBub24gZXhpc3RzCiAgICAgICAg\nY2xpbml0ID0gX3BjLmRlY2xhcmVNZXRob2QoIjxjbGluaXQ+Iiwgdm9pZC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgY2xpbml0Lm1ha2VQYWNrYWdlKCk7CiAg\nICAgICAgY2xpbml0LnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBjbGluaXQu\nc2V0RmluYWwodHJ1ZSk7CgogICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29k\nZSh0cnVlKTsKICAgICAgICBpZiAoIXJlcGxhY2VMYXN0KSB7CiAgICAgICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICBjb2RlLnByZXZpb3Vz\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb2RlOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyBieXRlY29kZSBtb2RpZnlpbmcgdGhlIGNsb25p\nbmcgYmVoYXZpb3Igb2YgdGhlIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNl\nZCB0byBjb3JyZWN0bHkgcmVwbGFjZSB0aGUgPGNvZGU+cGNTdGF0ZU1hbmFn\nZXI8L2NvZGU+IAogICAgICogaW5zdGFuY2UgZmllbGRzIG9mIGFueSBjbG9u\nZSBjcmVhdGVkIHdpdGggdGhlaXIgZGVmYXVsdCB2YWx1ZXMuIAogICAgICog\nQWxzbywgaWYgdGhpcyBjbGFzcyBpcyB0aGUgYmFzZSBQQyB0eXBlIGFuZCBk\nb2VzIG5vdCBkZWNsYXJlZCAKICAgICAqIGEgY2xvbmUgbWV0aG9kLCBvbmUg\nd2lsbCBiZSBhZGRlZC4gQWxzbywgaWYgX3BjIGlzIGEgc3ludGhldGljCiAg\nICAgKiBzdWJjbGFzcywgY3JlYXRlIHRoZSBjbG9uZSgpIG1ldGhvZCB0aGF0\nIGNsZWFycyB0aGUgc3RhdGUgbWFuYWdlcgogICAgICogdGhhdCBtYXkgaGF2\nZSBiZWVuIGluaXRpYWxpemVkIGluIGEgc3VwZXIncyBjbG9uZSgpIG1ldGhv\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENsb25pbmdDb2RlKCkg\newogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIC8vIGFkZCB0aGUgY2xvbmUgbWV0aG9kIGlmIG5lY2Vzc2Fy\neQogICAgICAgIEJDTWV0aG9kIGNsb25lID0gX3BjLmdldERlY2xhcmVkTWV0\naG9kKCJjbG9uZSIsIAogICAgICAgICAgICAoU3RyaW5nW10pIG51bGwpOwog\nICAgICAgIFN0cmluZyBzdXBlck5hbWUgPSBfbWFuYWdlZFR5cGUuZ2V0U3Vw\nZXJjbGFzc05hbWUoKTsKICAgICAgICBDb2RlIGNvZGUgPSBudWxsOwogICAg\nICAgIGlmIChjbG9uZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGFkZCBj\nbG9uZSBzdXBwb3J0IGZvciBiYXNlIGNsYXNzZXMKICAgICAgICAgICAgLy8g\nd2hpY2ggYWxzbyBpbXBsZW1lbnQgY2xvbmVhYmxlCiAgICAgICAgICAgIGJv\nb2xlYW4gaXNDbG9uZWFibGUgPSBDbG9uZWFibGUuY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbSgKICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBl\nKCkpOwogICAgICAgICAgICBib29sZWFuIGV4dGVuZHNPYmplY3QgPQogICAg\nICAgICAgICAgICAgc3VwZXJOYW1lLmVxdWFscyhPYmplY3QuY2xhc3MuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgaWYgKCFpc0Nsb25lYWJsZSB8fCAoIWV4\ndGVuZHNPYmplY3QgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKCFnZXRDcmVhdGVT\ndWJjbGFzcygpKQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKAogICAg\nICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiZW5oYW5jZS1jbG9uZWFi\nbGUiLCBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpKSk7CgogICAgICAgICAgICAv\nLyBhZGQgY2xvbmUgbWV0aG9kCiAgICAgICAgICAgIC8vIHByb3RlY3RlZCBP\nYmplY3QgY2xvbmUgKCkgdGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0\naW9uCiAgICAgICAgICAgIGNsb25lID0gX3BjLmRlY2xhcmVNZXRob2QoImNs\nb25lIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFz\nZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChjbG9uZSkpCiAgICAgICAgICAg\nICAgICBjbG9uZS5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGNsb25l\nLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAg\nICAgICAoQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nICAgIC8vIHJldHVybiBzdXBlci5jbG9uZSAoKTsKICAgICAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9u\nZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBu\ndWxsKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgLy8gZ2V0IHRoZSBjbG9uZSBtZXRob2QgY29k\nZQogICAgICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29kZShmYWxzZSk7CiAg\nICAgICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgdGVtcGxhdGUg\nc3VwZXIuY2xvbmUgKCkgaW5zdHJ1Y3Rpb24gdG8gbWF0Y2ggYWdhaW5zdAog\nICAgICAgIEluc3RydWN0aW9uIHRlbXBsYXRlID0gKChDb2RlKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIubmV3Q29kZUFjdGlvbigpKSkuaW52b2tlc3BlY2lhbCgpCiAgICAg\nICAgICAgIC5zZXRNZXRob2Qoc3VwZXJOYW1lLCAiY2xvbmUiLCBPYmplY3Qu\nY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKCiAgICAgICAgLy8gZmluZCBjYWxs\ncyB0byB0aGUgdGVtcGxhdGUgaW5zdHJ1Y3Rpb247IG9uIG1hdGNoCiAgICAg\nICAgLy8gY2xvbmUgd2lsbCBiZSBvbiBzdGFjawogICAgICAgIGNvZGUuYmVm\nb3JlRmlyc3QoKTsKICAgICAgICBpZiAoY29kZS5zZWFyY2hGb3J3YXJkKHRl\nbXBsYXRlKSkgewogICAgICAgICAgICAvLyAoKDx0eXBlPikgY2xvbmUpLnBj\nU3RhdGVNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAg\nICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAg\nICAgICAgICAgIC8vIGlmIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2V0cyB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBy\nZWdpc3RlcmVkIGFzIHtAbGluayBTZXJ2aWNlcyBzZXJ2aWNlc30uCiAgICAg\nKi8KICAgIHB1YmxpYyBBdXhpbGlhcnlFbmhhbmNlcltdIGdldEF1eGlsaWFy\neUVuaGFuY2VycygpIHsKCQlyZXR1cm4gX2F1eEVuaGFuY2VyczsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBBbGxvdyBhbnkgcmVnaXN0ZXJlZCBhdXhp\nbGlhcnkgY29kZSBnZW5lcmF0b3JzIHRvIHJ1bi4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHJ1bkF1eGlsaWFyeUVuaGFuY2VycygpIHsKICAgIAlmb3Ig\nKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAg\nICAJCV9hdXhFbmhhbmNlcnNbaV0ucnVuKF9wYywgX21ldGEpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIG1ldGhv\nZCBiZSBza2lwcGVkLgogICAgICogCiAgICAgKiBAcGFyYW0gbWV0aG9kIG1l\ndGhvZCB0byBiZSBza2lwcGVkIG9yIG5vdAogICAgICogQHJldHVybiB0cnVl\nIGlmIGFueSBvZiB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBza2lwcyB0aGUg\nZ2l2ZW4gbWV0aG9kLAogICAgICogb3IgaWYgdGhlIG1ldGhvZCBpcyBhIGNv\nbnN0cnVjdG9yCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBza2lwRW5o\nYW5jZShCQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBpZiAoIjxpbml0PiIu\nZXF1YWxzKG1ldGhvZC5nZXROYW1lKCkpKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9h\ndXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCWlmIChfYXV4RW5oYW5j\nZXJzW2ldLnNraXBFbmhhbmNlKG1ldGhvZCkpCiAgICAJCQlyZXR1cm4gdHJ1\nZTsKICAgICAgICAKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHN5bnRoZXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9k\ncyB0aGF0IHdpbGwgcmVwbGFjZSBhbGwgZGlyZWN0CiAgICAgKiBmaWVsZCBh\nY2Nlc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEFjY2Vzc29y\ncygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFz\ncygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5n\nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAgaWYgKCFnZXRSZWRl\nZmluZSgpCiAgICAgICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpICE9IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAg\nICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NTZXRNZXRob2QoZm1kc1tpXSk7\nCiAgICAgICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NHZXRNZXRob2QoZm1k\nc1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBhZGRHZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAg\nICAgICAgICAgICAgICBhZGRTZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIGEgbm9uLXN0YXRpYyBzZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1\ncGVyIG1ldGhvZHMsIGFuZAogICAgICogcGVyZm9ybXMgYW55IG5lY2Vzc2Fy\neSBmaWVsZCB0cmFja2luZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZFN1YmNsYXNzU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNz\nIHByb3BUeXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIFN0\ncmluZyBzZXR0ZXJOYW1lID0gZ2V0U2V0dGVyTmFtZShmbWQpOwogICAgICAg\nIEJDTWV0aG9kIHNldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKHNldHRlck5h\nbWUsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgcHJv\ncFR5cGUgfSk7CiAgICAgICAgc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2Qo\nc2V0dGVyKTsKICAgICAgICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgLy8gbm90IG5lY2Vzc2FyeSBpZiB3ZSdyZSBhbHJl\nYWR5IHRyYWNraW5nIGFjY2VzcyB2aWEgcmVkZWZpbml0aW9uCiAgICAgICAg\naWYgKCFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIGdldCB0aGUg\nb3JpZyB2YWx1ZSBvbnRvIHN0YWNrCiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgaW50IHZhbCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGNvZGUueHN0b3JlKCku\nc2V0TG9jYWwodmFsKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7\nCiAgICAgICAgICAgIGFkZE5vdGlmeU11dGF0aW9uKGNvZGUsIGZtZCwgdmFs\nLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vICMjIyMjIHRlc3QgY2FzZTog\nQiBleHRlbmRzIEEuIE1ldGhvZHMgZGVmaW5lZCBpbiBBLiBXaGF0CiAgICAg\nICAgLy8gIyMjIyMgaGFwcGVucz8KICAgICAgICAvLyBzdXBlci5zZXRYWFgo\nLi4uKQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAg\nY29kZS54bG9hZCgpLnNldFBhcmFtKDApLnNldFR5cGUocHJvcFR5cGUpOwog\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdl\nZFR5cGUuZ2V0VHlwZSgpLAogICAgICAgICAgICBzZXR0ZXJOYW1lLCB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IHByb3BUeXBlIH0pOwoKICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0K\nCiAgICBwcml2YXRlIGJvb2xlYW4gc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRo\nb2QoQkNNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgQkNNZXRob2RbXSBtZXRo\nb2RzID0gX21hbmFnZWRUeXBlLmdldE1ldGhvZHMobWV0aG9kLmdldE5hbWUo\nKSwKICAgICAgICAgICAgbWV0aG9kLmdldFBhcmFtVHlwZXMoKSk7CiAgICAg\nICAgaWYgKG1ldGhvZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hY2Nlc3NvciIsCiAg\nICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBtZXRob2Qu\nZ2V0TmFtZSgpKSk7CiAgICAgICAgQkNNZXRob2Qgc3VwZXJNZXRoID0gbWV0\naG9kc1swXTsKICAgICAgICBpZiAoc3VwZXJNZXRoLmlzUHJpdmF0ZSgpKSB7\nCiAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5p\nc1BhY2thZ2UoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVBhY2thZ2Uo\nKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlm\nIChzdXBlck1ldGguaXNQcm90ZWN0ZWQoKSkgewogICAgICAgICAgICBtZXRo\nb2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1B1YmxpYygpKSB7CiAg\nICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBnZXR0ZXIg\ndGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFuZAogICAg\nICogcGVyZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVsZCB0cmFja2luZy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzR2V0TWV0aG9kKEZp\nZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lID0g\nImdldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkp\nOwogICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRoTmFt\nZSwgbmV3IENsYXNzWzBdKS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgbWV0\naE5hbWUgPSAiaXMiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0\nTmFtZSgpKTsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXIgPSBfcGMuZGVjbGFy\nZU1ldGhvZChtZXRoTmFtZSwgZm1kLmdldERlY2xhcmVkVHlwZSgpLAogICAg\nICAgICAgICBudWxsKTsKICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1l\ndGhvZChnZXR0ZXIpOwogICAgICAgIGdldHRlci5tYWtlUHVibGljKCk7CiAg\nICAgICAgQ29kZSBjb2RlID0gZ2V0dGVyLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIC8vIGlmIHdlJ3JlIG5vdCBhbHJlYWR5IHRyYWNraW5nIGZpZWxkIGFj\nY2VzcyB2aWEgcmVmbGVjdGlvbiwgdGhlbiB3ZQogICAgICAgIC8vIG11c3Qg\nbWFrZSB0aGUgZ2V0dGVyIGhvb2sgaW4gbGF6eSBsb2FkaW5nIGJlZm9yZSBh\nY2Nlc3NpbmcgdGhlIHN1cGVyCiAgICAgICAgLy8gbWV0aG9kLgogICAgICAg\nIGlmICghZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAgYWRkTm90aWZ5QWNj\nZXNzKGNvZGUsIGZtZCk7CgogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9t\nYW5hZ2VkVHlwZS5nZXRUeXBlKCksIG1ldGhOYW1lLAogICAgICAgICAgICBm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCksIG51bGwpOwogICAgICAgIGNvZGUueHJl\ndHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\nYSBzdGF0aWMgZ2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgog\nICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGggdGhl\nIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdlciB0\nbyBnZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAgKiBA\ncGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmllbGQK\nICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxkIHRv\nIGdldAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWV0aG9kKGlu\ndCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9k\nID0gY3JlYXRlR2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHJlYWRzIGFy\nZSBub3QgY2hlY2tlZCwganVzdCByZXR1cm4gdGhlIHZhbHVlCiAgICAgICAg\nYnl0ZSBmaWVsZEZsYWcgPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAgICAgICBp\nZiAoKGZpZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFE\nKSA9PSAwCiAgICAgICAgICAgICYmIChmaWVsZEZsYWcgJiBQZXJzaXN0ZW5j\nZUNhcGFibGUuTUVESUFURV9SRUFEKSA9PSAwKSB7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgICAgIGFk\nZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAg\nY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkp\nOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0\nYXRlTWFuYWdlciA9PSBudWxsKSByZXR1cm4gaW5zdC48ZmllbGQ+OwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAg\nICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAg\nY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkp\nOwoKICAgICAgICAvLyBpbnQgZmllbGQgPSBwY0luaGVyaXRlZEZpZWxkQ291\nbnQgKyA8ZmllbGRpbmRleD47CiAgICAgICAgaW50IGZpZWxkTG9jYWwgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGlmaW5zLnNldFRh\ncmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5j\nbGFzcykpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRl\neCk7CiAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgY29kZS5pc3RvcmUo\nKS5zZXRMb2NhbChmaWVsZExvY2FsKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0\nYXRlTWFuYWdlci5hY2Nlc3NpbmdGaWVsZCAoZmllbGQpOwogICAgICAgIC8v\nIHJldHVybiBpbnN0LjxmaWVsZD47CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExv\nY2FsKGZpZWxkTG9jYWwpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKFNNVFlQRSwgImFjY2Vzc2luZ0ZpZWxkIiwgdm9pZC5j\nbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAg\nICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyBhIHN0YXRpYyBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2\nZW4gZmllbGQuCiAgICAgKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFj\ndHMgd2l0aCB0aGUgaW5zdGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3Rh\ndGVNYW5hZ2VyIHRvIHNldCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAg\nICoKICAgICAqIEBwYXJhbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9m\nIHRoZSBmaWVsZAogICAgICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0\naGUgZmllbGQgdG8gc2V0CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRT\nZXRNZXRob2QoaW50IGluZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBjcmVhdGVTZXRNZXRob2QoZm1kKTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\nUENFbmhhbmNlciB1c2VzIHN0YXRpYyBtZXRob2RzOyBQQ1N1YmNsYXNzZXIg\nZG9lcyBub3QuCiAgICAgICAgaW50IGZpcnN0UGFyYW1PZmZzZXQgPSBnZXRB\nY2Nlc3NvclBhcmFtZXRlck9mZnNldCgpOwoKICAgICAgICAvLyBpZiAoaW5z\ndC5wY1N0YXRlTWFuYWdlciA9PSBudWxsKSBpbnN0LjxmaWVsZD4gPSB2YWx1\nZTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVs\nbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZpcnN0UGFyYW1PZmZz\nZXQpOwogICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1k\nKTsKICAgICAgICBpZihmbWQuaXNWZXJzaW9uKCk9PXRydWUgJiYgX2FkZFZl\ncnNpb25Jbml0RmxhZyl7CiAgICAgICAgICAgIC8vIGlmIHdlIGFyZSBzZXR0\naW5nIHRoZSB2ZXJzaW9uLCBmbGlwIHRoZSB2ZXJzaW9uSW5pdCBmbGFnIHRv\nIHRydWUKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSB2ID0gX21ldGEuYWRk\nRGVjbGFyZWRGaWVsZChWRVJTSU9OX0lOSVRfU1RSLCBib29sZWFuLmNsYXNz\nKTsKICAgICAgICAgICAgdi5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgxKTsKICAgICAgICAgICAg\nYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCB2KTsgICAKICAgICAgICB9\nCiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIC8vIGluc3QucGNT\ndGF0ZU1hbmFnZXIuc2V0dGluZzxmaWVsZFR5cGU+RmllbGQgKGluc3QsCiAg\nICAgICAgLy8gICAgIHBjSW5oZXJpdGVkRmllbGRDb3VudCArIDxpbmRleD4s\nIGluc3QuPGZpZWxkPiwgdmFsdWUsIDApOwogICAgICAgIGlmaW5zLnNldFRh\ncmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpKTsKICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBj\nb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGluZGV4KTsKICAg\nICAgICBjb2RlLmlhZGQoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIHRydWUpOwogICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oZmly\nc3RQYXJhbU9mZnNldCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKDApOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0\naG9kKGdldFN0YXRlTWFuYWdlck1ldGhvZAogICAgICAgICAgICAoZm1kLmdl\ndERlY2xhcmVkVHlwZSgpLCAic2V0dGluZyIsIGZhbHNlLCB0cnVlKSk7CiAg\nICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lcyB3aGljaCBhdHRh\nY2ggLyBkZXRhY2ggbWV0aG9kcyB0byB1c2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRBdHRhY2hEZXRhY2hDb2RlKCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBzZWUgaWYgYW55\nIHN1cGVyY2xhc3NlcyBhcmUgZGV0YWNoYWJsZQogICAgICAgIGJvb2xlYW4g\ncGFyZW50RGV0YWNoYWJsZSA9IGZhbHNlOwogICAgICAgIGZvciAoQ2xhc3NN\nZXRhRGF0YSBwYXJlbnQgPSBfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgICAgICAgICBwYXJlbnQgIT0gbnVsbDsgcGFyZW50ID0gcGFy\nZW50LmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpIHsKICAgICAgICAgICAg\naWYgKHBhcmVudC5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAgICAgICAg\ncGFyZW50RGV0YWNoYWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaWYgcGFy\nZW50IG5vdCBkZXRhY2hhYmxlLCB3ZSBuZWVkIHRvIGFkZCB0aGUgZGV0YWNo\nIHN0YXRlIGZpZWxkcyBhbmQKICAgICAgICAvLyBhY2Nlc3NvciBtZXRob2Rz\nCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51bGwg\nfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKQogICAgICAgICAgICB8fCBwYXJlbnRE\nZXRhY2hhYmxlICE9IF9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAg\nICAgIGFkZElzRGV0YWNoZWRNZXRob2QoKTsKICAgICAgICAgICAgYWRkRGV0\nYWNoZWRTdGF0ZU1ldGhvZHMoX21ldGEudXNlc0RldGFjaGVkU3RhdGUoKQog\nICAgICAgICAgICAgICAgIT0gQm9vbGVhbi5GQUxTRSk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBpZiB3ZSBkZXRhY2ggb24gc2VyaWFsaXplLCB3ZSBhbHNv\nIG5lZWQgdG8gaW1wbGVtZW50IHRoZQogICAgICAgIC8vIGV4dGVybmFsaXph\nYmxlIGludGVyZmFjZSB0byB3cml0ZSBqdXN0IHRoZSBzdGF0ZSBmb3IgdGhl\nIGZpZWxkcwogICAgICAgIC8vIGJlaW5nIGRldGFjaGVkCiAgICAgICAgaWYg\nKGV4dGVybmFsaXplRGV0YWNoZWQoKSkgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgYWRkRGV0YWNoRXh0ZXJuYWxpemUocGFyZW50RGV0\nYWNoYWJsZSwKICAgICAgICAgICAgICAgICAgICBfbWV0YS51c2VzRGV0YWNo\nZWRTdGF0ZSgpICE9IEJvb2xlYW4uRkFMU0UpOwogICAgICAgICAgICB9IGNh\ndGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24obnNtZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\ndGhlIGZpZWxkcyB0byBob2xkIGRldGFjaGVkIHN0YXRlIGFuZCB0aGVpciBh\nY2Nlc3NvciBtZXRob2RzLgogICAgICoKICAgICAqIEBwYXJhbSBpbXBsIHdo\nZXRoZXIgdG8gZnVsbHkgaW1wbGVtZW50IGRldGFjaCBzdGF0ZSBmdW5jdGlv\nbmFsaXR5CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGREZXRhY2hlZFN0\nYXRlTWV0aG9kcyhib29sZWFuIGltcGwpIHsKICAgICAgICBGaWVsZCBkZXRh\nY2hGaWVsZCA9IF9tZXRhLmdldERldGFjaGVkU3RhdGVGaWVsZCgpOwogICAg\nICAgIFN0cmluZyBuYW1lID0gbnVsbDsKICAgICAgICBTdHJpbmcgZGVjbGFy\nZXIgPSBudWxsOwogICAgICAgIGlmIChpbXBsICYmIGRldGFjaEZpZWxkID09\nIG51bGwpIHsKICAgICAgICAgICAgbmFtZSA9IFBSRSArICJEZXRhY2hlZFN0\nYXRlIjsKICAgICAgICAgICAgZGVjbGFyZXIgPSBfcGMuZ2V0TmFtZSgpOwog\nICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZChu\nYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBmaWVsZC5tYWtlUHJp\ndmF0ZSgpOwogICAgICAgICAgICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7\nCiAgICAgICAgfSBlbHNlIGlmIChpbXBsKSB7CiAgICAgICAgICAgIG5hbWUg\nPSBkZXRhY2hGaWVsZC5nZXROYW1lKCk7CiAgICAgICAgICAgIGRlY2xhcmVy\nID0gZGV0YWNoRmllbGQuZ2V0RGVjbGFyaW5nQ2xhc3MoKS5nZXROYW1lKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjR2V0RGV0\nYWNoZWRTdGF0ZSAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRob2Quc2V0\nU3RhdGljKGZhbHNlKTsKICAgICAgICBtZXRob2QubWFrZVB1YmxpYygpOwog\nICAgICAgIGludCBhY2Nlc3MgPSBtZXRob2QuZ2V0QWNjZXNzRmxhZ3MoKTsK\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgaWYgKGltcGwpIHsKICAgICAgICAgICAgLy8gcmV0dXJuIHBjRGV0\nYWNoZWRTdGF0ZTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIF9tYW5h\nZ2VkVHlwZS5nZXRQcm9qZWN0KCkubG9hZENsYXNzKGRlY2xhcmVyKSwKICAg\nICAgICAgICAgICAgIG5hbWUpOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwoKICAgICAgICAvLyBw\ndWJsaWMgdm9pZCBwY1NldERldGFjaGVkU3RhdGUgKE9iamVjdCBzdGF0ZSkK\nICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiU2V0\nRGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzcyBbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIG1ldGhvZC5zZXRB\nY2Nlc3NGbGFncyhhY2Nlc3MpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1wbCkgewogICAgICAgICAgICAv\nLyBwY0RldGFjaGVkU3RhdGUgPSBzdGF0ZTsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgcHV0ZmllbGQoY29k\nZSwgX21hbmFnZWRUeXBlLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoZGVjbGFy\nZXIpLAogICAgICAgICAgICAgICAgbmFtZSwgT2JqZWN0LmNsYXNzKTsKICAg\nICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRvIDxjb2Rl\nPmNvZGU8L2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMgdG8gZ2V0IGZpZWxkCiAg\nICAgKiA8Y29kZT5hdHRyTmFtZTwvY29kZT4gZGVjbGFyZWQgaW4gdHlwZSA8\nY29kZT5kZWNsYXJlcjwvY29kZT4KICAgICAqIG9udG8gdGhlIHRvcCBvZiB0\naGUgc3RhY2suCiAgICAgKgogICAgICogVGhlIGluc3RhbmNlIHRvIGFjY2Vz\ncyBtdXN0IGFscmVhZHkgYmUgb24gdGhlIHRvcCBvZiB0aGUKICAgICAqIHN0\nYWNrIHdoZW4gdGhpcyBpcyBpbnZva2VkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgZ2V0ZmllbGQoQ29kZSBjb2RlLCBCQ0NsYXNzIGRlY2xhcmVyLCBT\ndHJpbmcgYXR0ck5hbWUpIHsKICAgICAgICBpZiAoZGVjbGFyZXIgPT0gbnVs\nbCkKICAgICAgICAgICAgZGVjbGFyZXIgPSBfbWFuYWdlZFR5cGU7CgogICAg\nICAgIC8vIGZpcnN0LCBzZWUgaWYgd2UgY2FuIGNvbnZlcnQgdGhlIGF0dHJp\nYnV0ZSBuYW1lIHRvIGEgZmllbGQgbmFtZQogICAgICAgIFN0cmluZyBmaWVs\nZE5hbWUgPSB0b0JhY2tpbmdGaWVsZE5hbWUoYXR0ck5hbWUpOwoKICAgICAg\nICAvLyBuZXh0LCBmaW5kIHRoZSBmaWVsZCBpbiB0aGUgbWFuYWdlZCB0eXBl\nIGhpZXJhcmNoeQogICAgICAgIEJDRmllbGQgZmllbGQgPSBudWxsOwogICAg\nICAgIG91dGVyOiBmb3IgKEJDQ2xhc3MgYmMgPSBfcGM7IGJjICE9IG51bGw7\nIGJjID0gYmMuZ2V0U3VwZXJjbGFzc0JDKCkpIHsKICAgICAgICAgICAgQkNG\naWVsZFtdIGZpZWxkcyA9IChCQ0ZpZWxkW10pIEFjY2Vzc0NvbnRyb2xsZXIK\nICAgICAgICAgICAgICAgIC5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIu\nZ2V0QkNDbGFzc0ZpZWxkc0FjdGlvbihiYywKICAgICAgICAgICAgICAgICAg\nICBmaWVsZE5hbWUpKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGZpZWxk\nID0gZmllbGRzW2ldOwogICAgICAgICAgICAgICAgLy8gaWYgd2UgcmVhY2gg\nYSBmaWVsZCBkZWNsYXJlZCBpbiB0aGlzIHR5cGUsIHRoZW4gdGhpcyBpcyB0\naGUKICAgICAgICAgICAgICAgIC8vIG1vc3QtbWFza2luZyBmaWVsZCwgYW5k\nIGlzIHRoZSBvbmUgdGhhdCB3ZSB3YW50LgogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkc1tpXS5nZXREZWNsYXJlcigpID09IGRlY2xhcmVyKSB7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChnZXRDcmVh\ndGVTdWJjbGFzcygpICYmIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0RGVjbGFyZXIo\nKSA9PSBfcGMKICAgICAgICAgICAgJiYgKGZpZWxkID09IG51bGwgfHwgIWZp\nZWxkLmlzUHVibGljKCkpKSB7CiAgICAgICAgICAgIC8vIHdlJ3JlIGNyZWF0\naW5nIHRoZSBzdWJjbGFzcywgbm90IHJlZGVmaW5pbmcgdGhlIHVzZXIgdHlw\nZS4KCiAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKHRoaXMsIFJl\nZmxlY3Rpb24uZmluZEZpZWxkKC4uLikpOwogICAgICAgICAgICBjb2RlLmNs\nYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhkZWNsYXJlcik7CiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmaWVsZE5hbWUpOwogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24u\nY2xhc3MsCiAgICAgICAgICAgICAgICAiZmluZEZpZWxkIiwgRmllbGQuY2xh\nc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAgIENsYXNzLmNsYXNz\nLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAg\nIENsYXNzIHR5cGUgPSBfbWV0YS5nZXRGaWVsZChhdHRyTmFtZSkuZ2V0RGVj\nbGFyZWRUeXBlKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZCgKICAgICAgICAgICAg\nICAgICAgICBnZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUsIEZpZWxk\nLmNsYXNzKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBzaG91bGQgbmV2ZXIg\naGFwcGVuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0eXBl\nLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKGRlY2xhcmVyLmdldE5hbWUoKSwgZmllbGROYW1lLAogICAgICAg\nICAgICAgICAgZmllbGQuZ2V0VHlwZSgpLmdldE5hbWUoKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0byA8Y29kZT5jb2RlPC9j\nb2RlPiB0aGUgaW5zdHJ1Y3Rpb25zIHRvIHNldCBmaWVsZAogICAgICogPGNv\nZGU+YXR0ck5hbWU8L2NvZGU+IGRlY2xhcmVkIGluIHR5cGUgPGNvZGU+ZGVj\nbGFyZXI8L2NvZGU+CiAgICAgKiB0byB0aGUgdmFsdWUgb2YgdHlwZSA8Y29k\nZT5maWVsZFR5cGU8L2NvZGU+IG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrLgog\nICAgICoKICAgICAqIFdoZW4gdGhpcyBtZXRob2QgaXMgaW52b2tlZCwgdGhl\nIHZhbHVlIHRvIGxvYWQgbXVzdAogICAgICogYWxyZWFkeSBiZSBvbiB0aGUg\ndG9wIG9mIHRoZSBzdGFjayBpbiA8Y29kZT5jb2RlPC9jb2RlPiwKICAgICAq\nIGFuZCB0aGUgaW5zdGFuY2UgdG8gbG9hZCBpbnRvIG11c3QgYmUgc2Vjb25k\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHV0ZmllbGQoQ29kZSBjb2Rl\nLCBCQ0NsYXNzIGRlY2xhcmVyLCBTdHJpbmcgYXR0ck5hbWUsCiAgICAgICAg\nQ2xhc3MgZmllbGRUeXBlKSB7CiAgICAgICAgaWYgKGRlY2xhcmVyID09IG51\nbGwpCiAgICAgICAgICAgIGRlY2xhcmVyID0gX21hbmFnZWRUeXBlOwoKICAg\nICAgICBTdHJpbmcgZmllbGROYW1lID0gdG9CYWNraW5nRmllbGROYW1lKGF0\ndHJOYW1lKTsKCiAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkgfHwgZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAvLyBSZWZsZWN0aW9uLnNl\ndCh0aGlzLCBSZWZsZWN0aW9uLmZpbmRGaWVsZCguLi4pLCB2YWx1ZSk7CiAg\nICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGRlY2xh\ncmVyKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZp\nZWxkTmFtZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSh0cnVlKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICJmaW5k\nRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAg\nICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QoUmVmbGVjdGlvbi5jbGFzcywgInNldCIsCiAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10gewogICAg\nICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywKICAgICAgICAgICAgICAg\nICAgICBmaWVsZFR5cGUuaXNQcmltaXRpdmUoKSA/IGZpZWxkVHlwZSA6IE9i\namVjdC5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgRmllbGQuY2xhc3Mg\nfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29kZS5wdXRmaWVs\nZCgpCiAgICAgICAgICAgICAgICAuc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFt\nZSgpLCBmaWVsZE5hbWUsIGZpZWxkVHlwZS5nZXROYW1lKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIElmIHVzaW5nIHByb3BlcnR5IGFj\nY2Vzcywgc2VlIGlmIHRoZXJlIGlzIGEgZGlmZmVyZW50IGJhY2tpbmcgZmll\nbGQKICAgICAqIG5hbWUgZm9yIHRoZSBwZXJzaXN0ZW50IGF0dHJpYnV0ZSA8\nY29kZT5uYW1lPC9jb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcg\ndG9CYWNraW5nRmllbGROYW1lKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYg\nKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VT\nU19QUk9QRVJUWQogICAgICAgICAgICAmJiBfYXR0cnNUb0ZpZWxkcyAhPSBu\ndWxsICYmIF9hdHRyc1RvRmllbGRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAg\nICAgICAgICBuYW1lID0gKFN0cmluZykgX2F0dHJzVG9GaWVsZHMuZ2V0KG5h\nbWUpOwogICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIC8qKgogICAg\nICogSWYgdXNpbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMg\nYSBkaWZmZXJlbnQgcGVyc2lzdGVudAogICAgICogYXR0cmlidXRlIG5hbWUg\nZm9yIHRoZSBiYWNraW5nIGZpZWxkIDxjb2RlPm5hbWU8L2NvZGU+LgogICAg\nICovCiAgICBwcml2YXRlIFN0cmluZyBmcm9tQmFja2luZ0ZpZWxkTmFtZShT\ndHJpbmcgbmFtZSkgewogICAgICAgIC8vIG1ldGEgaXMgbnVsbCB3aGVuIGRv\naW5nIHBlcnNpc3RlbmNlLWF3YXJlIGVuaGFuY2VtZW50CiAgICAgICAgaWYg\nKF9tZXRhICE9IG51bGwKICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZCiAgICAg\nICAgICAgICYmIF9maWVsZHNUb0F0dHJzICE9IG51bGwgJiYgX2ZpZWxkc1Rv\nQXR0cnMuY29udGFpbnNLZXkobmFtZSkpCiAgICAgICAgICAgIHJldHVybiAo\nU3RyaW5nKSBfZmllbGRzVG9BdHRycy5nZXQobmFtZSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEltcGxlbWVudCB0aGUgZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNlIHRv\nIGRldGFjaCBvbiBzZXJpYWxpemUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGREZXRhY2hFeHRlcm5hbGl6ZShib29sZWFuIHBhcmVudERldGFjaGFi\nbGUsCiAgICAgICAgYm9vbGVhbiBkZXRhY2hlZFN0YXRlKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGVuc3Vy\nZSB0aGF0IHRoZSBkZWNsYXJlZCBkZWZhdWx0IGNvbnN0cnVjdG9yIGlzIHB1\nYmxpYyAKICAgICAgICAvLyBmb3IgZXh0ZXJuYWxpemF0aW9uCiAgICAgICAg\nQkNNZXRob2QgbWV0aCA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgiPGluaXQ+\nIiwgKFN0cmluZ1tdKSBudWxsKTsKICAgICAgICBpZiAoIW1ldGguaXNQdWJs\naWMoKSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2Ut\nZGVmY29ucy1leHRlcm4iLCAKICAgICAgICAgICAgICAgICAgX21ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpKSk7CiAgICAgICAgICAgIG1ldGgubWFrZVB1Ymxp\nYygpOwogICAgICAgIH0KICAgICAgICAvLyBkZWNsYXJlIGV4dGVybmFsaXph\nYmxlIGludGVyZmFjZQogICAgICAgIGlmICghRXh0ZXJuYWxpemFibGUuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkp\nKQogICAgICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFjZShFeHRlcm5hbGl6\nYWJsZS5jbGFzcyk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgdXNlciBk\nb2Vzbid0IGFscmVhZHkgaGF2ZSBjdXN0b20gZXh0ZXJuYWxpemF0aW9uIG9y\nCiAgICAgICAgLy8gc2VyaWFsaXphdGlvbiBtZXRob2RzCiAgICAgICAgQ2xh\nc3NbXSBpbnB1dCA9IG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5j\nbGFzcyB9OwogICAgICAgIENsYXNzW10gb3V0cHV0ID0gbmV3IENsYXNzW117\nIE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9OwogICAgICAgIGlmIChfbWFu\nYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRPYmplY3QiLCBpbnB1\ndCkgIT0gbnVsbAogICAgICAgICAgICB8fCBfbWFuYWdlZFR5cGUuZ2V0RGVj\nbGFyZWRNZXRob2QoIndyaXRlT2JqZWN0Iiwgb3V0cHV0KSAhPSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nZGV0YWNoLWN1c3RvbS1zZXIiLCBfbWV0YSkpOwogICAgICAgIGlucHV0WzBd\nID0gT2JqZWN0SW5wdXQuY2xhc3M7CiAgICAgICAgb3V0cHV0WzBdID0gT2Jq\nZWN0T3V0cHV0LmNsYXNzOwogICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0\nRGVjbGFyZWRNZXRob2QoInJlYWRFeHRlcm5hbCIsIGlucHV0KSAhPSBudWxs\nCiAgICAgICAgICAgIHx8IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhv\nZCgid3JpdGVFeHRlcm5hbCIsIG91dHB1dCkgIT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImRldGFjaC1j\ndXN0b20tZXh0ZXJuIiwgX21ldGEpKTsKCiAgICAgICAgLy8gY3JlYXRlIGxp\nc3Qgb2YgYWxsIHVubWFuYWdlZCBzZXJpYWxpemFibGUgZmllbGRzCiAgICAg\nICAgQkNGaWVsZFtdIGZpZWxkcyA9IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgIENvbGxlY3Rpb24gdW5tZ2QgPSBuZXcgQXJy\nYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICgh\nZmllbGRzW2ldLmlzVHJhbnNpZW50KCkgJiYgIWZpZWxkc1tpXS5pc1N0YXRp\nYygpCiAgICAgICAgICAgICAgICAmJiAhZmllbGRzW2ldLmlzRmluYWwoKQog\nICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5nZXROYW1lKCkuc3RhcnRz\nV2l0aChQUkUpCiAgICAgICAgICAgICAgICAmJiBfbWV0YS5nZXREZWNsYXJl\nZEZpZWxkKGZpZWxkc1tpXS5nZXROYW1lKCkpID09IG51bGwpCiAgICAgICAg\nICAgICAgICB1bm1nZC5hZGQoZmllbGRzW2ldKTsKICAgICAgICB9CgogICAg\nICAgIGFkZFJlYWRFeHRlcm5hbChwYXJlbnREZXRhY2hhYmxlLCBkZXRhY2hl\nZFN0YXRlKTsKICAgICAgICBhZGRSZWFkVW5tYW5hZ2VkKHVubWdkLCBwYXJl\nbnREZXRhY2hhYmxlKTsKICAgICAgICBhZGRXcml0ZUV4dGVybmFsKHBhcmVu\ndERldGFjaGFibGUsIGRldGFjaGVkU3RhdGUpOwogICAgICAgIGFkZFdyaXRl\nVW5tYW5hZ2VkKHVubWdkLCBwYXJlbnREZXRhY2hhYmxlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBjdXN0b20gcmVhZEV4dGVybmFsIG1ldGhvZC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFJlYWRFeHRlcm5hbChib29s\nZWFuIHBhcmVudERldGFjaGFibGUsCiAgICAgICAgYm9vbGVhbiBkZXRhY2hl\nZFN0YXRlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIENsYXNzW10gaW5hcmdzID0gbmV3IENsYXNzW117IE9iamVj\ndElucHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKCJyZWFkRXh0ZXJuYWwiLCB2b2lkLmNsYXNzLCBpbmFy\nZ3MpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNl\ncHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9F\neGNlcHRpb24uY2xhc3MpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24o\nQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBj\nb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci5y\nZWFkRXh0ZXJuYWwgKGluKTsKICAgICAgICBDbGFzcyBzdXAgPSBfbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkuZ2V0U3VwZXJjbGFzcygpOwogICAgICAgIGlm\nICghcGFyZW50RGV0YWNoYWJsZSAmJiBFeHRlcm5hbGl6YWJsZS5jbGFzcy5p\nc0Fzc2lnbmFibGVGcm9tKHN1cCkpIHsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKHN1cCwgInJlYWRFeHRlcm5hbCIsCiAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBpbmFyZ3MpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gcmVhZFVubWFuYWdlZCAoaW4pOwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoZ2V0VHlwZShfbWV0YSksCiAgICAgICAgICAgIFBSRSArICJSZWFk\nVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywgaW5hcmdzKTsKCiAgICAgICAgaWYg\nKGRldGFjaGVkU3RhdGUpIHsKICAgICAgICAgICAgLy8gcGNTZXREZXRhY2hl\nZFN0YXRlIChpbi5yZWFkT2JqZWN0ICgpKTsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXQuY2xhc3MsICJyZWFk\nT2JqZWN0IiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQ\nUkUgKyAiU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwoKICAgICAg\nICAgICAgLy8gcGNSZXBsYWNlU3RhdGVNYW5hZ2VyICgoU3RhdGVNYW5hZ2Vy\nKSBpbi5yZWFkT2JqZWN0ICgpKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXQuY2xhc3MsICJyZWFkT2JqZWN0\nIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShTdGF0ZU1hbmFnZXIu\nY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IFN0YXRlTWFuYWdlci5j\nbGFzcyB9KTsKICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgbWFuYWdlZCBm\naWVsZHMKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdl\ndEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzVHJhbnNp\nZW50KCkpCiAgICAgICAgICAgICAgICByZWFkRXh0ZXJuYWwoY29kZSwgZm1k\nc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSwgZm1kc1tpXSk7CgogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVhZCB1bm1hbmFnZWQgZmllbGRzIGZyb20gdGhlIHN0cmVh\nbSAocGNSZWFkVW5tYW5hZ2VkKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFJlYWRVbm1hbmFnZWQoQ29sbGVjdGlvbiB1bm1nZCwgYm9vbGVhbiBw\nYXJlbnREZXRhY2hhYmxlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIENsYXNzW10gaW5hcmdzID0gbmV3IENsYXNz\nW117IE9iamVjdElucHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0\naCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJSZWFkVW5tYW5hZ2VkIiwg\ndm9pZC5jbGFzcywKICAgICAgICAgICAgaW5hcmdzKTsKICAgICAgICBtZXRo\nLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9\nIG1ldGguZ2V0RXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRk\nRXhjZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBleGNlcHMu\nYWRkRXhjZXB0aW9uKENsYXNzTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gc3VwZXIucmVhZFVubWFuYWdlZCAoaW4pOwogICAgICAgIGlmIChw\nYXJlbnREZXRhY2hhYmxlKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKSksIFBSRSArICJSZWFkVW5tYW5hZ2Vk\nIiwgdm9pZC5jbGFzcywgCiAgICAgICAgICAgICAgICBpbmFyZ3MpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gcmVhZCBkZWNsYXJlZCB1bm1hbmFnZWQgc2Vy\naWFsaXphYmxlIGZpZWxkcwogICAgICAgIEJDRmllbGQgZmllbGQ7CiAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSB1bm1nZC5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBmaWVsZCA9IChCQ0ZpZWxkKSBp\ndHIubmV4dCgpOwogICAgICAgICAgICByZWFkRXh0ZXJuYWwoY29kZSwgZmll\nbGQuZ2V0TmFtZSgpLCBmaWVsZC5nZXRUeXBlKCksIG51bGwpOwogICAgICAg\nIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8g\ncmVhZCBhIGZpZWxkIGZyb20gYW4gZXh0ZXJuYWxpemF0aW9uIGlucHV0IHN0\ncmVhbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlYWRFeHRlcm5hbChD\nb2RlIGNvZGUsIFN0cmluZyBmaWVsZE5hbWUsIENsYXNzIHR5cGUsCiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lOwogICAg\nICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpIHsKICAgICAgICAgICAgbWV0\naE5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICAgICAgbWV0aE5hbWUg\nPSBtZXRoTmFtZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoTG9jYWxl\nLkVOR0xJU0gpCiAgICAgICAgICAgICAgICArIG1ldGhOYW1lLnN1YnN0cmlu\nZygxKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSAicmVhZCIgKyBtZXRoTmFt\nZTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgbWV0aE5hbWUgPSAicmVh\nZE9iamVjdCI7CgogICAgICAgIC8vIDxmaWVsZD4gPSBpbi5yZWFkPHR5cGU+\nICgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBD\nbGFzcyByZXQgPSAodHlwZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmpl\nY3QuY2xhc3M7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoT2JqZWN0SW5wdXQuY2xhc3MsIG1ldGhOYW1lLAogICAgICAgICAg\nICByZXQsIG51bGwpOwogICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgp\nICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgaWYgKGZtZCA9PSBu\ndWxsKQogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBudWxsLCBmaWVsZE5h\nbWUsIHR5cGUpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBhZGRTZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIHN3aXRj\naCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAg\nICAgICAgICAgICAgICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIC8vICAgc20ucHJveHlEZXRhY2hlZERlc2VyaWFsaXplZCAo\nPGluZGV4Pik7CiAgICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAg\nICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVsbCgpOwog\nICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kLmdldEluZGV4KCkpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9k\nKFNNVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb3h5RGV0YWNo\nZWREZXNlcmlhbGl6ZWQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgICAg\nICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBj\ndXN0b20gd3JpdGVFeHRlcm5hbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRXcml0ZUV4dGVybmFsKGJvb2xlYW4gcGFyZW50RGV0YWNo\nYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3Nb\nXSBvdXRhcmdzID0gbmV3IENsYXNzW117IE9iamVjdE91dHB1dC5jbGFzcyB9\nOwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZCgi\nd3JpdGVFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwogICAgICAg\nIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUp\nOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xh\nc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gc3VwZXIud3JpdGVFeHRlcm5hbCAob3V0KTsKICAgICAg\nICBDbGFzcyBzdXAgPSBnZXRUeXBlKF9tZXRhKS5nZXRTdXBlcmNsYXNzKCk7\nCiAgICAgICAgaWYgKCFwYXJlbnREZXRhY2hhYmxlICYmIEV4dGVybmFsaXph\nYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oc3VwKSkgewogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3VwLCAid3JpdGVFeHRlcm5h\nbCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBvdXRhcmdzKTsKICAg\nICAgICB9CgogICAgICAgIC8vIHdyaXRlVW5tYW5hZ2VkIChvdXQpOwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YSksCiAgICAgICAg\nICAgIFBSRSArICJXcml0ZVVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIG91dGFy\nZ3MpOwoKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gbnVsbDsKICAg\nICAgICBpZiAoZGV0YWNoZWRTdGF0ZSkgewogICAgICAgICAgICAvLyBpZiAo\nc20gIT0gbnVsbCkKICAgICAgICAgICAgLy8gICBpZiAoc20ud3JpdGVEZXRh\nY2hlZCAob3V0KSkKICAgICAgICAgICAgLy8gICAgICByZXR1cm47CiAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZudWxsID0gY29kZS5pZm51\nbGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChTTVRZUEUsICJ3cml0ZURldGFjaGVkIiwKICAgICAgICAgICAgICAg\nIGJvb2xlYW4uY2xhc3MsIG91dGFyZ3MpOwogICAgICAgICAgICBnbzIgPSBj\nb2RlLmlmZXEoKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAg\nICAgICAgICAvLyBlbHNlCiAgICAgICAgICAgIC8vICAgb3V0LndyaXRlT2Jq\nZWN0IChwY0dldERldGFjaGVkU3RhdGUgKCkpOwogICAgICAgICAgICBDbGFz\nc1tdIG9iamFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH07CiAg\nICAgICAgICAgIGlmbnVsbC5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLCBv\nYmphcmdzKTsKICAgICAgICAgICAgLy8gICAgb3V0LndyaXRlT2JqZWN0IChu\ndWxsKSAvLyBTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoKE9iamVjdCkgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywKICAg\nICAgICAgICAgICAgICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG9iamFy\nZ3MpOwogICAgICAgIH0KICAgICAgICBpZiAoZ28yICE9IG51bGwpCiAgICAg\nICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CgogICAgICAgIC8v\nIHdyaXRlIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICgh\nZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgd3JpdGVF\neHRlcm5hbChjb2RlLCBmbWRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCBmbWRzW2ldKTsK\nCiAgICAgICAgLy8gcmV0dXJuCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\ncml0ZSB1bm1hbmFnZWQgZmllbGRzIHRvIHRoZSBzdHJlYW0gKHBjV3JpdGVV\nbm1hbmFnZWQpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkV3JpdGVV\nbm1hbmFnZWQoQ29sbGVjdGlvbiB1bm1nZCwgYm9vbGVhbiBwYXJlbnREZXRh\nY2hhYmxlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIENsYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmpl\nY3RPdXRwdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9pZC5j\nbGFzcywKICAgICAgICAgICAgb3V0YXJncyk7CiAgICAgICAgbWV0aC5tYWtl\nUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRo\nLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2Vw\ndGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci53cml0ZVVu\nbWFuYWdlZCAob3V0KTsKICAgICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkg\newogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlw\nZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkpLCBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCAK\nICAgICAgICAgICAgICAgIG91dGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gd3JpdGUgZGVjbGFyZWQgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVs\nZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxkOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gdW5tZ2QuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgZmllbGQgPSAoQkNGaWVsZCkgaXRyLm5leHQoKTsKICAg\nICAgICAgICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmaWVsZC5nZXROYW1lKCks\nIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byB3cml0ZSBhIGZpZWxk\nIHRvIGFuIGV4dGVybmFsaXphdGlvbiBvdXRwdXQgc3RyZWFtLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgd3JpdGVFeHRlcm5hbChDb2RlIGNvZGUsIFN0\ncmluZyBmaWVsZE5hbWUsIENsYXNzIHR5cGUsCiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lOwogICAgICAgIGlmICh0eXBl\nLmlzUHJpbWl0aXZlKCkpIHsKICAgICAgICAgICAgbWV0aE5hbWUgPSB0eXBl\nLmdldE5hbWUoKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSBtZXRoTmFtZS5z\ndWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoTG9jYWxlLkVOR0xJU0gpCiAg\nICAgICAgICAgICAgICArIG1ldGhOYW1lLnN1YnN0cmluZygxKTsKICAgICAg\nICAgICAgbWV0aE5hbWUgPSAid3JpdGUiICsgbWV0aE5hbWU7CiAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgIG1ldGhOYW1lID0gIndyaXRlT2JqZWN0IjsK\nCiAgICAgICAgLy8gb3V0LndyaXRlPHR5cGU+ICg8ZmllbGQ+KTsKICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgaWYgKGZtZCA9PSBu\ndWxsKQogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBudWxsLCBmaWVsZE5h\nbWUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIENsYXNzW10gYXJncyA9IG5l\ndyBDbGFzc1tdeyB0eXBlIH07CiAgICAgICAgaWYgKHR5cGUgPT0gYnl0ZS5j\nbGFzcyB8fCB0eXBlID09IGNoYXIuY2xhc3MgfHwgdHlwZSA9PSBzaG9ydC5j\nbGFzcykKICAgICAgICAgICAgYXJnc1swXSA9IGludC5jbGFzczsKICAgICAg\nICBlbHNlIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICBh\ncmdzWzBdID0gT2JqZWN0LmNsYXNzOwogICAgICAgIGNvZGUuaW52b2tlaW50\nZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywgbWV0aE5h\nbWUsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIGFyZ3MpOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29k\nZSwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29k\nZShjb2RlLCBmbWQsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogTG9h\nZCB0aGUgZmllbGQgdmFsdWUgc3BlY2lmaWVkIGJ5IDxjb2RlPmZtZDwvY29k\nZT4gb250byB0aGUgc3RhY2suCiAgICAgKiBCZWZvcmUgdGhpcyBtZXRob2Qg\naXMgY2FsbGVkLCB0aGUgb2JqZWN0IHRoYXQgdGhlIGRhdGEgc2hvdWxkIGJl\nIGxvYWRlZAogICAgICogZnJvbSB3aWxsIGJlIG9uIHRoZSB0b3Agb2YgdGhl\nIHN0YWNrLgogICAgICoKICAgICAqIEBwYXJhbSBmcm9tU2FtZUNsYXNzIGlm\nIDxjb2RlPnRydWU8L2NvZGU+LCB0aGVuIDxjb2RlPmZtZDwvY29kZT4gaXMK\nICAgICAqIGJlaW5nIGxvYWRlZCBmcm9tIGFuIGluc3RhbmNlIG9mIHRoZSBz\nYW1lIGNsYXNzIGFzIHRoZSBjdXJyZW50IGV4ZWN1dGlvbgogICAgICogY29u\ndGV4dC4gSWYgPGNvZGU+ZmFsc2U8L2NvZGU+LCB0aGVuIHRoZSBpbnN0YW5j\nZSBvbiB0aGUgdG9wIG9mIHRoZSBzdGFjawogICAgICogbWlnaHQgYmUgYSBz\ndXBlcmNsYXNzIG9mIHRoZSBjdXJyZW50IGV4ZWN1dGlvbiBjb250ZXh0J3Mg\nJ3RoaXMnIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nR2V0TWFuYWdlZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEg\nZm1kLAogICAgICAgIGJvb2xlYW4gZnJvbVNhbWVDbGFzcykKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiBy\nZWRlZmluaW5nLCB0aGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFj\nY2VzcyB0aGUgZmllbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3Np\nYmxlKSwgc2luY2UgdGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlz\nCiAgICAgICAgLy8gdHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5h\nZ2VyLCBldmVuIGZyb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFj\nY2VzcyB1c2FnZS4gV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3Qg\ncmVkZWZpbmluZywgYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNz\nIGFwcHJvYWNoIGluc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0\naW9uLAogICAgICAgIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5\nIGxvYWRpbmcgYW5kIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAg\nICAgaWYgKGdldFJlZGVmaW5lKCkKICAgICAgICAgICAgfHwgX21ldGEuZ2V0\nQWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7\nCiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1l\nKCkpOwogICAgICAgIH0gZWxzZSBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkg\newogICAgICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3MsIGFuZCB3ZSdyZSBu\nb3QgcmVkZWZpbmluZy4gSWYgd2UncmUgb3BlcmF0aW5nCiAgICAgICAgICAg\nIC8vIG9uIGFuIGluc3RhbmNlIHRoYXQgaXMgZGVmaW5pdGVseSB0aGUgc2Ft\nZSB0eXBlIGFzICd0aGlzJywgdGhlbgogICAgICAgICAgICAvLyBjYWxsIHN1\ncGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFja2luZy4gT3RoZXJ3aXNl\nLCByZWZsZWN0CiAgICAgICAgICAgIC8vIHRvIGJvdGggYnlwYXNzIHRyYWNr\naW5nIGFuZCBhdm9pZCBjbGFzcyB2ZXJpZmljYXRpb24gZXJyb3JzLgogICAg\nICAgICAgICBpZiAoZnJvbVNhbWVDbGFzcykgewogICAgICAgICAgICAgICAg\nTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQuZ2V0QmFja2luZ01lbWJlcigp\nOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKG1ldGgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgZm1kLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWd1\nbGFyIGVuaGFuY2VtZW50ICsgcHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAg\nIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tpbmdNZW1iZXIo\nKTsKCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChQUkUgKyBtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIG1ldGgu\nZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSB2YWx1\nZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjayBpbnRvIHRoZSBmaWVsZCB2YWx1\nZSBzcGVjaWZpZWQKICAgICAqIGJ5IDxjb2RlPmZtZDwvY29kZT4uIEJlZm9y\nZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBkYXRhIHRvIGxvYWQgd2ls\nbAogICAgICogYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sgYW5kIHRoZSBv\nYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9hZGVkCiAgICAgKiBp\nbnRvIHdpbGwgYmUgc2Vjb25kIGluIHRoZSBzdGFjay4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2Rl\nLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiByZWRlZmluaW5nLCB0aGVu\nIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0aGUgZmllbGQK\nICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwgc2luY2UgdGhl\nIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlzCiAgICAgICAgLy8gdHJp\nZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBldmVuIGZyb20g\naW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFjY2VzcyB1c2FnZS4gV2Ug\nY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3QgcmVkZWZpbmluZywgYW5k\nCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNzIGFwcHJvYWNoIGluc3Rl\nYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAogICAgICAgIC8v\nIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5IGxvYWRpbmcgYW5kIGVm\nZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAgICAgaWYgKGdldFJlZGVm\naW5lKCkKICAgICAgICAgICAgfHwgX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09\nIENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgIHB1\ndGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCksIGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRDcmVhdGVTdWJj\nbGFzcygpKSB7CiAgICAgICAgICAgIC8vIHByb3BlcnR5IGFjY2VzcywgYW5k\nIHdlJ3JlIG5vdCByZWRlZmluaW5nLiBpbnZva2UgdGhlCiAgICAgICAgICAg\nIC8vIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFja2luZy4KICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5h\nZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBnZXRTZXR0ZXJO\nYW1lKGZtZCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xh\nc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2VtZW50ICsgcHJv\ncGVydHkgYWNjZXNzCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChQUkUgKyBnZXRTZXR0ZXJOYW1lKGZtZCksCiAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIG9mZnNldCB0aGF0IHRoZSBmaXJzdCBtZWFuaW5nZnVs\nIGFjY2Vzc29yIHBhcmFtZXRlciBpcyBhdC4KICAgICAqLwogICAgcHJpdmF0\nZSBpbnQgZ2V0QWNjZXNzb3JQYXJhbWV0ZXJPZmZzZXQoKSB7CiAgICAgICAg\ncmV0dXJuIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5BQ0NFU1NfRklFTEQpID8gMSA6IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgdGhlIHtAbGluayBJbnN0cnVjdGlvbn1zIHRvIGxvYWQgdGhlIGlu\nc3RhbmNlIHRvIG1vZGlmeSBvbnRvIHRoZQogICAgICogc3RhY2ssIGFuZCBy\nZXR1cm4gaXQuIElmIDxjb2RlPmZvclN0YXRpYzwvY29kZT4gaXMgc2V0LCB0\naGVuCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiBpcyBpbiBhbiBhY2Nlc3Nv\nciBtZXRob2Qgb3IgYW5vdGhlciBzdGF0aWMgbWV0aG9kOwogICAgICogb3Ro\nZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2YgdGhlIFBDLXNwZWNpZmllZCBtZXRo\nb2RzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpcnN0IGluc3RydWN0\naW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+LgogICAgICovCiAgICBw\ncml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5zdGFuY2UoQ29kZSBj\nb2RlLCBib29sZWFuIGZvclN0YXRpYykgewogICAgICAgIGlmIChfbWV0YS5n\nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQg\nJiYgZm9yU3RhdGljKQogICAgICAgICAgICByZXR1cm4gY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgIHJldHVybiBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBnZW5l\ncmF0ZWQgZ2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9yIDxjb2RlPmZtZDwv\nY29kZT4uIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9ubWVudCB3aWxsIHRo\nZW4gcG9wdWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJsb2NrLgogICAgICov\nCiAgICBwcml2YXRlIEJDTWV0aG9kIGNyZWF0ZUdldE1ldGhvZChGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgIEJDTWV0aG9kIGdldHRlcjsKICAgICAg\nICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEu\nQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgIC8vIHN0YXRpYyA8ZmllbGR0\neXBlPiBwY0dldDxmaWVsZD4gKFhYWCBpbnN0KQogICAgICAgICAgICBCQ0Zp\nZWxkIGZpZWxkID0gX3BjLmdldERlY2xhcmVkRmllbGQoZm1kLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGdldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJHZXQiICsgZm1kLmdldE5hbWUoKSwgZm1kLgogICAgICAgICAgICAg\nICAgZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0TmFtZSgpLCBuZXcgU3RyaW5nW117\nIF9wYy5nZXROYW1lKCkgfSk7CiAgICAgICAgICAgIGdldHRlci5zZXRBY2Nl\nc3NGbGFncyhmaWVsZC5nZXRBY2Nlc3NGbGFncygpCiAgICAgICAgICAgICAg\nICAmIH5Db25zdGFudHMuQUNDRVNTX1RSQU5TSUVOVCAmIH5Db25zdGFudHMu\nQUNDRVNTX1ZPTEFUSUxFKTsKICAgICAgICAgICAgZ2V0dGVyLnNldFN0YXRp\nYyh0cnVlKTsKICAgICAgICAgICAgZ2V0dGVyLnNldEZpbmFsKHRydWUpOwog\nICAgICAgICAgICByZXR1cm4gZ2V0dGVyOwogICAgICAgIH0KCiAgICAgICAg\nLy8gcHJvcGVydHkgYWNjZXNzOgogICAgICAgIC8vIGNvcHkgdGhlIHVzZXIn\ncyBnZXR0ZXIgbWV0aG9kIHRvIGEgbmV3IG5hbWU7IHdlIGNhbid0IGp1c3Qg\ncmVzZXQKICAgICAgICAvLyB0aGUgbmFtZSwgYmVjYXVzZSB0aGF0IHdpbGwg\nYWxzbyByZXNldCBhbGwgY2FsbHMgdG8gdGhlIG1ldGhvZAogICAgICAgIE1l\ndGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tpbmdNZW1iZXIoKTsK\nICAgICAgICBnZXR0ZXIgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QobWV0aC5n\nZXROYW1lKCksCiAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMo\nKSk7CiAgICAgICAgQkNNZXRob2QgbmV3Z2V0dGVyID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgbWV0aC5nZXROYW1lKCksCiAgICAgICAgICAgIG1ldGgu\nZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwog\nICAgICAgIG5ld2dldHRlci5zZXRBY2Nlc3NGbGFncyhnZXR0ZXIuZ2V0QWNj\nZXNzRmxhZ3MoKSk7CiAgICAgICAgbmV3Z2V0dGVyLm1ha2VQcm90ZWN0ZWQo\nKTsgCiAgICAgICAgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhnZXR0ZXIsIG5l\nd2dldHRlcik7CiAgICAgICAgcmV0dXJuIGdldHRlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSB0aGUgZ2VuZXJhdGVkIHNldHRlciB7QGxpbmsg\nQkNNZXRob2R9IGZvciA8Y29kZT5mbWQ8L2NvZGU+LiBUaGUKICAgICAqIGNh\nbGxpbmcgZW52aXJvbm1lbnQgd2lsbCB0aGVuIHBvcHVsYXRlIHRoaXMgbWV0\naG9kJ3MgY29kZSBibG9jay4KICAgICAqLwogICAgcHJpdmF0ZSBCQ01ldGhv\nZCBjcmVhdGVTZXRNZXRob2QoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICBCQ01ldGhvZCBzZXR0ZXI7CiAgICAgICAgaWYgKF9tZXRhLmdldEFjY2Vz\nc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAg\nICAgICAgICAvLyBzdGF0aWMgdm9pZCBwY1NldDxmaWVsZD4gKFhYWCBpbnN0\nLCA8ZmllbGR0eXBlPiB2YWx1ZSkKICAgICAgICAgICAgQkNGaWVsZCBmaWVs\nZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKGZtZC5nZXROYW1lKCkpOwogICAg\nICAgICAgICBzZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiU2V0\nIiArIGZtZC5nZXROYW1lKCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXXsgZ2V0VHlwZShfbWV0YSksIGZtZC5nZXREZWNsYXJl\nZFR5cGUoKSB9KTsKICAgICAgICAgICAgc2V0dGVyLnNldEFjY2Vzc0ZsYWdz\nKGZpZWxkLmdldEFjY2Vzc0ZsYWdzKCkKICAgICAgICAgICAgICAgICYgfkNv\nbnN0YW50cy5BQ0NFU1NfVFJBTlNJRU5UICYgfkNvbnN0YW50cy5BQ0NFU1Nf\nVk9MQVRJTEUpOwogICAgICAgICAgICBzZXR0ZXIuc2V0U3RhdGljKHRydWUp\nOwogICAgICAgICAgICBzZXR0ZXIuc2V0RmluYWwodHJ1ZSk7CiAgICAgICAg\nICAgIHJldHVybiBzZXR0ZXI7CiAgICAgICAgfQoKICAgICAgICAvLyBwcm9w\nZXJ0eSBhY2Nlc3M6CiAgICAgICAgLy8gY29weSB0aGUgdXNlcidzIGdldHRl\nciBtZXRob2QgdG8gYSBuZXcgbmFtZTsgd2UgY2FuJ3QganVzdCByZXNldAog\nICAgICAgIC8vIHRoZSBuYW1lLCBiZWNhdXNlIHRoYXQgd2lsbCBhbHNvIHJl\nc2V0IGFsbCBjYWxscyB0byB0aGUgbWV0aG9kCiAgICAgICAgc2V0dGVyID0g\nX3BjLmdldERlY2xhcmVkTWV0aG9kKGdldFNldHRlck5hbWUoZm1kKSwKICAg\nICAgICAgICAgbmV3IENsYXNzW117IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9\nKTsKICAgICAgICBCQ01ldGhvZCBuZXdzZXR0ZXIgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyBzZXR0ZXIuZ2V0TmFtZSgpLAogICAgICAgICAgICBzZXR0\nZXIuZ2V0UmV0dXJuTmFtZSgpLCBzZXR0ZXIuZ2V0UGFyYW1OYW1lcygpKTsK\nICAgICAgICBuZXdzZXR0ZXIuc2V0QWNjZXNzRmxhZ3Moc2V0dGVyLmdldEFj\nY2Vzc0ZsYWdzKCkpOwogICAgICAgIG5ld3NldHRlci5tYWtlUHJvdGVjdGVk\nKCk7CiAgICAgICAgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhzZXR0ZXIsIG5l\nd3NldHRlcik7CiAgICAgICAgcmV0dXJuIHNldHRlcjsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb25N\nZXRob2QoKSB7CiAgICAgICAgLy8gcHVibGljIGludCBnZXRFbmhhbmNlbWVu\ndENvbnRyYWN0VmVyc2lvbigpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgCiAgICAgICAgICAgICAgICAiR2V0\nRW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb24iLCBpbnQuY2xhc3MsIG51bGwp\nOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBj\nb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKEVOSEFOQ0VSX1ZFUlNJT04pOwogICAgICAgIGNv\nZGUuaXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25jcmV0ZSB0eXBlIGZvciB0\naGUgZ2l2ZW4gY2xhc3MsIGkuZS4gaW1wbCBmb3IgbWFuYWdlZAogICAgICog\naW50ZXJmYWNlcwogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0VHlwZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRJbnRl\ncmZhY2VJbXBsKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1ldGEu\nZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIHJldHVybiBtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1vdmUgY29k\nZS1yZWxhdGVkIGF0dHJpYnV0ZXMgZnJvbSBvbmUgbWV0aG9kIHRvIGFub3Ro\nZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgdHJhbnNmZXJD\nb2RlQXR0cmlidXRlcyhCQ01ldGhvZCBmcm9tLCBCQ01ldGhvZCB0bykgewog\nICAgICAgIENvZGUgY29kZSA9IGZyb20uZ2V0Q29kZShmYWxzZSk7CiAgICAg\nICAgaWYgKGNvZGUgIT0gbnVsbCkgewogICAgICAgICAgICB0by5hZGRBdHRy\naWJ1dGUoY29kZSk7CiAgICAgICAgICAgIGZyb20ucmVtb3ZlQ29kZSgpOwog\nICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBmcm9tLmdl\ndEV4Y2VwdGlvbnMoZmFsc2UpOwogICAgICAgIGlmIChleGNlcHMgIT0gbnVs\nbCkKICAgICAgICAgICAgdG8uYWRkQXR0cmlidXRlKGV4Y2Vwcyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBhY2hlLm9wZW5q\ncGEuZW5oYW5jZS5QQ0VuaGFuY2VyIFtvcHRpb25dKgogICAgICogJmx0O2Ns\nYXNzIG5hbWUgfCAuamF2YSBmaWxlIHwgLmNsYXNzIGZpbGUgfCAuamRvIGZp\nbGUmZ3Q7KwogICAgICogIFdoZXJlIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBh\ncmUgcmVjb2duaXplZC4KICAgICAqIDx1bD4KICAgICAqIDxsaT48aT4tcHJv\ncGVydGllcy8tcCAmbHQ7cHJvcGVydGllcyBmaWxlJmd0OzwvaT46IFRoZSBw\nYXRoIHRvIGEgT3BlbkpQQQogICAgICogcHJvcGVydGllcyBmaWxlIGNvbnRh\naW5pbmcgaW5mb3JtYXRpb24gYXMgb3V0bGluZWQgaW4KICAgICAqIHtAbGlu\nayBDb25maWd1cmF0aW9ufTsgb3B0aW9uYWwuPC9saT4KICAgICAqIDxsaT48\naT4tJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7ICZsdDtwcm9wZXJ0eSB2YWx1ZSZn\ndDs8L2k+OiBBbGwgYmVhbgogICAgICogcHJvcGVydGllcyBvZiB0aGUgc3Rh\nbmRhcmQgT3BlbkpQQSB7QGxpbmsgT3BlbkpQQUNvbmZpZ3VyYXRpb259IGNh\nbiBiZQogICAgICogc2V0IGJ5IHVzaW5nIHRoZWlyIG5hbWVzIGFuZCBzdXBw\nbHlpbmcgYSB2YWx1ZTsgZm9yIGV4YW1wbGU6CiAgICAgKiA8bGk+PGk+LWRp\ncmVjdG9yeS8tZCAmbHQ7YnVpbGQgZGlyZWN0b3J5Jmd0OzwvaT46IFRoZSBw\nYXRoIHRvIHRoZSBiYXNlCiAgICAgKiBkaXJlY3Rvcnkgd2hlcmUgZW5oYW5j\nZWQgY2xhc3NlcyBhcmUgc3RvcmVkLiBCeSBkZWZhdWx0LCB0aGUKICAgICAq\nIGVuaGFuY2VyIG92ZXJ3cml0ZXMgdGhlIG9yaWdpbmFsIC5jbGFzcyBmaWxl\nIHdpdGggdGhlIGVuaGFuY2VkCiAgICAgKiB2ZXJzaW9uLiBVc2UgdGhpcyBv\ncHRpb24gdG8gc3RvcmUgdGhlIGdlbmVyYXRlZCAuY2xhc3MgZmlsZSBpbgog\nICAgICogYW5vdGhlciBkaXJlY3RvcnkuIFRoZSBwYWNrYWdlIHN0cnVjdHVy\nZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0aAogICAgICogdGhlIGdpdmVuIGRp\ncmVjdG9yeS48L2xpPgogICAgICogPGxpPjxpPi1hZGREZWZhdWx0Q29uc3Ry\ndWN0b3IvLWFkYyBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+OiBXaGV0aGVyIHRv\nCiAgICAgKiBhZGQgYSBkZWZhdWx0IGNvbnN0cnVjdG9yIHRvIHBlcnNpc3Rl\nbnQgY2xhc3NlcyBtaXNzaW5nIG9uZSwgYXMKICAgICAqIG9wcG9zZWQgdG8g\ndGhyb3dpbmcgYW4gZXhjZXB0aW9uLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+\nCiAgICAgKiA8bGk+PGk+LXRtcENsYXNzTG9hZGVyLy10Y2wgW3RydWUvdCB8\nIGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwogICAgICogbG9hZCB0aGUgcHJl\nLWVuaGFuY2VkIGNsYXNzZXMgdXNpbmcgYSB0ZW1wb3JhcnkgY2xhc3MgbG9h\nZGVyLgogICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4gU2V0IHRoaXMgdG8gZmFs\nc2Ugd2hlbiBhdHRlbXB0aW5nIHRvIGRlYnVnCiAgICAgKiBjbGFzcyBsb2Fk\naW5nIGVycm9ycy48L2xpPgogICAgICogPGxpPjxpPi1lbmZvcmNlUHJvcGVy\ndHlSZXN0cmljdGlvbnMvLWVwciBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+Ogog\nICAgICogV2hldGhlciB0byB0aHJvdyBhbiBleGNlcHRpb24gaWYgYSBQUk9Q\nRVJUWSBhY2Nlc3MgZW50aXR5IGFwcGVhcnMKICAgICAqIHRvIGJlIHZpb2xh\ndGluZyBzdGFuZGFyZCBwcm9wZXJ0eSByZXN0cmljdGlvbnMuIERlZmF1bHRz\nIHRvIGZhbHNlLjwvbGk+CiAgICAgKiA8L3VsPgogICAgICogIEVhY2ggYWRk\naXRpb25hbCBhcmd1bWVudCBjYW4gYmUgZWl0aGVyIHRoZSBmdWxsIGNsYXNz\nIG5hbWUgb2YgdGhlCiAgICAgKiB0eXBlIHRvIGVuaGFuY2UsIHRoZSBwYXRo\nIHRvIHRoZSAuamF2YSBmaWxlIGZvciB0aGUgdHlwZSwgdGhlIHBhdGggdG8K\nICAgICAqIHRoZSAuY2xhc3MgZmlsZSBmb3IgdGhlIHR5cGUsIG9yIHRoZSBw\nYXRoIHRvIGEgLmpkbyBmaWxlIGxpc3Rpbmcgb25lCiAgICAgKiBvciBtb3Jl\nIHR5cGVzIHRvIGVuaGFuY2UuCiAgICAgKiBJZiB0aGUgdHlwZSBiZWluZyBl\nbmhhbmNlZCBoYXMgbWV0YWRhdGEsIGl0IHdpbGwgYmUgZW5oYW5jZWQgYXMg\nYQogICAgICogcGVyc2lzdGVuY2UgY2FwYWJsZSBjbGFzcy4gSWYgbm90LCBp\ndCB3aWxsIGJlIGNvbnNpZGVyZWQgYSBwZXJzaXN0ZW5jZQogICAgICogYXdh\ncmUgY2xhc3MsIGFuZCBhbGwgYWNjZXNzIHRvIGZpZWxkcyBvZiBwZXJzaXN0\nZW5jZSBjYXBhYmxlIGNsYXNzZXMKICAgICAqIHdpbGwgYmUgcmVwbGFjZWQg\nYnkgdGhlIGFwcHJvcHJpYXRlCWdldC9zZXQgbWV0aG9kLiBJZiB0aGUgdHlw\nZQogICAgICogZXhwbGljaXRseSBkZWNsYXJlcyB0aGUgcGVyc2lzdGVuY2Ut\nY2FwYWJsZSBpbnRlcmZhY2UsIGl0IHdpbGwKICAgICAqIG5vdCBiZSBlbmhh\nbmNlZC4gVGh1cywgaXQgaXMgc2FmZSB0byBpbnZva2UgdGhlIGVuaGFuY2Vy\nIG9uIGNsYXNzZXMKICAgICAqIHRoYXQgYXJlIGFscmVhZHkgZW5oYW5jZWQu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1td\nIGFyZ3MpIHsKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygp\nOwogICAgICAgIGFyZ3MgPSBvcHRzLnNldEZyb21DbWRMaW5lKGFyZ3MpOwog\nICAgICAgIGlmICghcnVuKGFyZ3MsIG9wdHMpKQogICAgICAgICAgICBTeXN0\nZW0uZXJyLnByaW50bG4oX2xvYy5nZXQoImVuaGFuY2UtdXNhZ2UiKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybnMgZmFs\nc2UgaWYgaW52YWxpZCBvcHRpb25zIGdpdmVuLiBSdW5zIGFnYWluc3QgYWxs\nCiAgICAgKiB0aGUgcGVyc2lzdGVuY2UgdW5pdHMgZGVmaW5lZCBpbiB0aGUg\ncmVzb3VyY2UgdG8gcGFyc2UuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nYm9vbGVhbiBydW4oZmluYWwgU3RyaW5nW10gYXJncywgT3B0aW9ucyBvcHRz\nKSB7CiAgICAgICAgcmV0dXJuIENvbmZpZ3VyYXRpb25zLnJ1bkFnYWluc3RB\nbGxBbmNob3JzKG9wdHMsCiAgICAgICAgICAgIG5ldyBDb25maWd1cmF0aW9u\ncy5SdW5uYWJsZSgpIHsKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gcnVu\nKE9wdGlvbnMgb3B0cykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb25JbXBsKCk7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBQQ0VuaGFuY2VyLnJ1bihjb25m\nLCBhcmdzLCBvcHRzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICAgICAgY29uZi5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybnMgZmFsc2UgaWYgaW52YWxp\nZCBvcHRpb25zIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJv\nb2xlYW4gcnVuKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIFN0cmluZ1td\nIGFyZ3MsCiAgICAgICAgT3B0aW9ucyBvcHRzKQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgRmxhZ3MgZmxhZ3MgPSBuZXcgRmxhZ3Mo\nKTsKICAgICAgICBmbGFncy5kaXJlY3RvcnkgPSBGaWxlcy5nZXRGaWxlKG9w\ndHMucmVtb3ZlUHJvcGVydHkoImRpcmVjdG9yeSIsICJkIiwKICAgICAgICAg\nICAgbnVsbCksIG51bGwpOwogICAgICAgIGZsYWdzLmFkZERlZmF1bHRDb25z\ndHJ1Y3RvciA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAg\nICAgICgiYWRkRGVmYXVsdENvbnN0cnVjdG9yIiwgImFkYyIsIGZsYWdzLmFk\nZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgZmxhZ3MudG1wQ2xhc3NM\nb2FkZXIgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAg\nICAoInRtcENsYXNzTG9hZGVyIiwgInRjbCIsIGZsYWdzLnRtcENsYXNzTG9h\nZGVyKTsKICAgICAgICBmbGFncy5lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlv\nbnMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAo\nImVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyIsICJlcHIiLAogICAgICAg\nICAgICAgICAgZmxhZ3MuZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zKTsK\nCiAgICAgICAgLy8gZm9yIHVuaXQgdGVzdGluZwogICAgICAgIEJ5dGVjb2Rl\nV3JpdGVyIHdyaXRlciA9IChCeXRlY29kZVdyaXRlcikgb3B0cy5nZXQoCiAg\nICAgICAgICAgIFBDRW5oYW5jZXIuY2xhc3MuZ2V0TmFtZSgpICsgIiNieXRl\nY29kZVdyaXRlciIpOwoKICAgICAgICBDb25maWd1cmF0aW9ucy5wb3B1bGF0\nZUNvbmZpZ3VyYXRpb24oY29uZiwgb3B0cyk7CiAgICAgICAgcmV0dXJuIHJ1\nbihjb25mLCBhcmdzLCBmbGFncywgbnVsbCwgd3JpdGVyLCBudWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEVuaGFuY2UgdGhlIGdpdmVuIGNsYXNzZXMu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAgICBG\nbGFncyBmbGFncywgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zLCBCeXRlY29k\nZVdyaXRlciB3cml0ZXIsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyKQog\nICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxvYWRl\nciA9PSBudWxsKQogICAgICAgICAgICBsb2FkZXIgPSBjb25mLmdldENsYXNz\nUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0Q2xhc3NM\nb2FkZXIoUENFbmhhbmNlci5jbGFzcywgbnVsbCk7CiAgICAgICAgaWYgKGZs\nYWdzLnRtcENsYXNzTG9hZGVyKQogICAgICAgICAgICBsb2FkZXIgPSAoQ2xh\nc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Q\ncml2SGVscGVyCiAgICAgICAgICAgICAgICAubmV3VGVtcG9yYXJ5Q2xhc3NM\nb2FkZXJBY3Rpb24obG9hZGVyKSk7CgogICAgICAgIGlmIChyZXBvcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIHJlcG9zID0gY29uZi5uZXdNZXRhRGF0YVJl\ncG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICByZXBvcy5zZXRTb3Vy\nY2VNb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01FVEEpOwogICAgICAg\nIH0KCiAgICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25m\naWd1cmF0aW9uLkxPR19UT09MKTsKICAgICAgICBDb2xsZWN0aW9uIGNsYXNz\nZXM7CiAgICAgICAgaWYgKGFyZ3MgPT0gbnVsbCB8fCBhcmdzLmxlbmd0aCA9\nPSAwKSB7CiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJydW5uaW5n\nLWFsbC1jbGFzc2VzIikpOwogICAgICAgICAgICBjbGFzc2VzID0gcmVwb3Mu\nZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyh0cnVlLCBsb2FkZXIpOwogICAgICAg\nICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKSB7CiAgICAgICAgICAgIAlsb2cu\nd2FybihfbG9jLmdldCgibm8tY2xhc3MtdG8tZW5oYW5jZSIpKTsKICAgICAg\nICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIENsYXNzQXJnUGFyc2VyIGNhcCA9IGNvbmYu\nZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAg\nICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLm5ld0NsYXNzQXJnUGFyc2VyKCk7\nCiAgICAgICAgICAgIGNhcC5zZXRDbGFzc0xvYWRlcihsb2FkZXIpOwogICAg\nICAgICAgICBjbGFzc2VzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAgICAgY2xhc3Nlcy5hZGRBbGwoQXJyYXlzLmFzTGlzdChjYXAucGFy\nc2VUeXBlcyhhcmdzW2ldKSkpOwogICAgICAgIH0KCiAgICAgICAgUHJvamVj\ndCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsKICAgICAgICBCQ0NsYXNzIGJj\nOwogICAgICAgIFBDRW5oYW5jZXIgZW5oYW5jZXI7CiAgICAgICAgaW50IHN0\nYXR1czsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNsYXNzZXMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgT2JqZWN0\nIG8gPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQo\nImVuaGFuY2UtcnVubmluZyIsIG8pKTsKCiAgICAgICAgICAgIGlmIChvIGlu\nc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICAgICAgYmMgPSBwcm9qZWN0\nLmxvYWRDbGFzcygoU3RyaW5nKSBvLCBsb2FkZXIpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBiYyA9IHByb2plY3QubG9hZENsYXNzKChD\nbGFzcykgbyk7CiAgICAgICAgICAgIGVuaGFuY2VyID0gbmV3IFBDRW5oYW5j\nZXIoY29uZiwgYmMsIHJlcG9zLCBsb2FkZXIpOwogICAgICAgICAgICBpZiAo\nd3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBlbmhhbmNlci5zZXRC\neXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAgICAgICAgICBlbmhhbmNlci5z\nZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsKICAgICAgICAgICAgZW5o\nYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGZsYWdzLmFkZERlZmF1\nbHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIHN0YXR1cyA9IGVuaGFuY2Vy\nLnJ1bigpOwogICAgICAgICAgICBpZiAoc3RhdHVzID09IEVOSEFOQ0VfTk9O\nRSkgewogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5o\nYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMg\nPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAgICAgICAgICAgICAgIGlmIChs\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cu\ndHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50ZXJmYWNlIikpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX0FXQVJFKSB7CiAg\nICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLWF3\nYXJlIikpOwogICAgICAgICAgICAgICAgZW5oYW5jZXIucmVjb3JkKCk7CiAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgZW5oYW5jZXIucmVj\nb3JkKCk7CiAgICAgICAgICAgIHByb2plY3QuY2xlYXIoKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\ndW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRmxh\nZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3RvcnkgPSBudWxsOwog\nICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERlZmF1bHRDb25zdHJ1Y3RvciA9\nIHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdG1wQ2xhc3NMb2FkZXIg\nPSB0cnVlOwoJCXB1YmxpYyBib29sZWFuIGVuZm9yY2VQcm9wZXJ0eVJlc3Ry\naWN0aW9ucyA9IGZhbHNlOwoJfQoKCS8qKgogCSAqIFBsdWdpbiBpbnRlcmZh\nY2UgZm9yIGFkZGl0aW9uYWwgZW5oYW5jZW1lbnQuCgkgKi8KCXB1YmxpYyBz\ndGF0aWMgaW50ZXJmYWNlIEF1eGlsaWFyeUVuaGFuY2VyCgl7CgkJcHVibGlj\nIHZvaWQgcnVuIChCQ0NsYXNzIGJjLCBDbGFzc01ldGFEYXRhIG1ldGEpOwoJ\nCXB1YmxpYyBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0aG9kIG0pOwoJfQp9\nCg==\n","encoding":"base64"}

