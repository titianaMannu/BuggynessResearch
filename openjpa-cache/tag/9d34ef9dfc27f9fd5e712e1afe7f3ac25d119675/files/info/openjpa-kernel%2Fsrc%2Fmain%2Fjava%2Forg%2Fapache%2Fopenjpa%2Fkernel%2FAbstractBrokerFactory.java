{"sha":"7398858be29d01f61149753b59ad80c565aa6b2f","node_id":"MDQ6QmxvYjIwNjM2NDo3Mzk4ODU4YmUyOWQwMWY2MTE0OTc1M2I1OWFkODBjNTY1YWE2YjJm","size":28671,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7398858be29d01f61149753b59ad80c565aa6b2f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVz\nOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmF4LnRyYW5zYWN0\naW9uLlN0YXR1czsKaW1wb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN5bmNocm9u\naXphdGlvbjsKaW1wb3J0IGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9u\nOwppbXBvcnQgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb25NYW5hZ2Vy\nOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLnNldC5N\nYXBCYWNrZWRTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5jb25mLk9wZW5KUEFWZXJzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuQnJva2VyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRhdGFDYWNoZVN0b3JlTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lZS5NYW5hZ2VkUnVudGlt\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5NYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmV2ZW50LkJyb2tlckZhY3RvcnlFdmVudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5SZW1vdGVDb21taXRFdmVudE1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25m\naWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9n\nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRv\nUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5Mb2NhbGl6ZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25j\ndXJyZW50SGFzaE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRSZWZlcmVuY2VIYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50TG9j\nazsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVw\nb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkdlbmVy\nYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbnZhbGlkU3RhdGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBBYnN0cmFjdCBp\nbXBsZW1lbnRhdGlvbiBvZiB0aGUge0BsaW5rIEJyb2tlckZhY3Rvcnl9CiAq\nIHRoYXQgbXVzdCBiZSBzdWJjbGFzc2VkIGZvciBhIHNwZWNpZmljIHJ1bnRp\nbWUuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJh\nY3QgY2xhc3MgQWJzdHJhY3RCcm9rZXJGYWN0b3J5CiAgICBpbXBsZW1lbnRz\nIEJyb2tlckZhY3RvcnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAo\nQWJzdHJhY3RCcm9rZXJGYWN0b3J5LmNsYXNzKTsKCiAgICAvLyBzdGF0aWMg\nbWFwcGluZyBvZiBjb25maWd1cmF0aW9ucyB0byBwb29sZWQgYnJva2VyIGZh\nY3RvcmllcwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwIF9wb29sID0g\nQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwKCkpOwoK\nICAgIC8vIGNvbmZpZ3VyYXRpb24KICAgIHByaXZhdGUgZmluYWwgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBwcml2YXRlIHRyYW5zaWVudCBi\nb29sZWFuIF9yZWFkT25seSA9IGZhbHNlOwogICAgcHJpdmF0ZSB0cmFuc2ll\nbnQgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIHRyYW5z\naWVudCBSdW50aW1lRXhjZXB0aW9uIF9jbG9zZWRFeGNlcHRpb24gPSBudWxs\nOwogICAgcHJpdmF0ZSBNYXAgX3VzZXJPYmplY3RzID0gbnVsbDsKCiAgICAv\nLyBpbnRlcm5hbCBsb2NrOiBzcGVjIGZvcmJpZHMgc3luY2hyb25pemF0aW9u\nIG9uIHRoaXMgb2JqZWN0CiAgICBwcml2YXRlIGZpbmFsIFJlZW50cmFudExv\nY2sgX2xvY2sgPSBuZXcgUmVlbnRyYW50TG9jaygpOwoKICAgIC8vIG1hcHMg\nZ2xvYmFsIHRyYW5zYWN0aW9ucyB0byBhc3NvY2lhdGVkIGJyb2tlcnMKICAg\nIHByaXZhdGUgdHJhbnNpZW50IENvbmN1cnJlbnRIYXNoTWFwIF90cmFuc2Fj\ndGlvbmFsCiAgICAgICAgPSBuZXcgQ29uY3VycmVudEhhc2hNYXAoKTsKCiAg\nICAvLyB3ZWFrLXJlZiB0cmFja2luZyBvZiBvcGVuIGJyb2tlcnMKICAgIHBy\naXZhdGUgdHJhbnNpZW50IFNldCBfYnJva2VyczsKCiAgICAvLyBjYWNoZSB0\naGUgY2xhc3MgbmFtZXMgbG9hZGVkIGZyb20gdGhlIHBlcnNpc3RlbnQgY2xh\nc3NlcyBwcm9wZXJ0eSBzbwogICAgLy8gdGhhdCB3ZSBjYW4gcmUtbG9hZCB0\naGVtIGZvciBlYWNoIG5ldyBicm9rZXIKICAgIHByaXZhdGUgdHJhbnNpZW50\nIENvbGxlY3Rpb24gX3BjQ2xhc3NOYW1lcyA9IG51bGw7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBDb2xsZWN0aW9uIF9wY0NsYXNzTG9hZGVycyA9IG51bGw7\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9wZXJzaXN0ZW50VHlw\nZXNMb2FkZWQgPSBmYWxzZTsKCiAgICAvLyBsaWZlY3ljbGUgbGlzdGVuZXJz\nIHRvIHBhc3MgdG8gZWFjaCBicm9rZXIKICAgIHByaXZhdGUgdHJhbnNpZW50\nIE1hcCBfbGlmZWN5Y2xlTGlzdGVuZXJzID0gbnVsbDsKCiAgICAvLyB0cmFu\nc2FjdGlvbiBsaXN0ZW5lcnMgdG8gcGFzcyB0byBlYWNoIGJyb2tlcgogICAg\ncHJpdmF0ZSB0cmFuc2llbnQgTGlzdCBfdHJhbnNhY3Rpb25MaXN0ZW5lcnMg\nPSBudWxsOwoKICAgIC8vIGtleSB1bmRlciB3aGljaCB0aGlzIGluc3RhbmNl\nIGNhbiBiZSBzdG9yZWQgaW4gdGhlIGJyb2tlciBwb29sCiAgICAvLyBhbmQg\nbGF0ZXIgaWRlbnRpZmllZAogICAgcHJpdmF0ZSBPYmplY3QgX3Bvb2xLZXk7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gaW50ZXJuYWwgZmFjdG9yeSBw\nb29sIGtleSBmb3IgdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24uCiAgICAgKgog\nICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0\naWMgT2JqZWN0IHRvUG9vbEtleShNYXAgbWFwKSB7CiAgICAgICAgT2JqZWN0\nIGtleSA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnR5KCJJZCIsIG1hcCk7\nCiAgICAgICAgcmV0dXJuICgga2V5ICE9IG51bGwpID8ga2V5IDogbWFwOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVnaXN0ZXIgPGNvZGU+ZmFjdG9yeTwv\nY29kZT4gaW4gdGhlIHBvb2wgdW5kZXIgPGNvZGU+a2V5PC9jb2RlPi4KICAg\nICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHJvdGVjdGVk\nIHN0YXRpYyB2b2lkIHBvb2woT2JqZWN0IGtleSwgQWJzdHJhY3RCcm9rZXJG\nYWN0b3J5IGZhY3RvcnkpIHsKICAgICAgICBzeW5jaHJvbml6ZWQoX3Bvb2wp\nIHsKICAgICAgICAgICAgX3Bvb2wucHV0KGtleSwgZmFjdG9yeSk7CiAgICAg\nICAgICAgIGZhY3Rvcnkuc2V0UG9vbEtleShrZXkpOwogICAgICAgICAgICBm\nYWN0b3J5Lm1ha2VSZWFkT25seSgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcG9vbGVkIGZhY3RvcnkgbWF0Y2hpbmcg\ndGhlIGdpdmVuIGtleSwgb3IgbnVsbAogICAgICogaWYgbm9uZS4gVGhlIGtl\neSBtdXN0IGJlIG9mIHRoZSBmb3JtIGNyZWF0ZWQgYnkge0BsaW5rICNnZXRQ\nb29sS2V5fS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBBYnN0cmFjdEJy\nb2tlckZhY3RvcnkgZ2V0UG9vbGVkRmFjdG9yeUZvcktleShPYmplY3Qga2V5\nKSB7CiAgICAgICAgcmV0dXJuIChBYnN0cmFjdEJyb2tlckZhY3RvcnkpIF9w\nb29sLmdldChrZXkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0\nb3IuIENvbmZpZ3VyYXRpb24gbXVzdCBiZSBwcm92aWRlZCBvbiBjb25zdHJ1\nY3Rpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBBYnN0cmFjdEJyb2tlckZh\nY3RvcnkoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZmlnKSB7CiAgICAgICAg\nX2NvbmYgPSBjb25maWc7CiAgICAgICAgX2Jyb2tlcnMgPSBuZXdCcm9rZXJT\nZXQoKTsKICAgICAgICBnZXRQY0NsYXNzTG9hZGVycygpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25maWd1cmF0aW9uIGZvciB0aGlz\nIGZhY3RvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJh\ndGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29u\nZjsKICAgIH0KCiAgICBwdWJsaWMgQnJva2VyIG5ld0Jyb2tlcigpIHsKICAg\nICAgICByZXR1cm4gbmV3QnJva2VyKF9jb25mLmdldENvbm5lY3Rpb25Vc2Vy\nTmFtZSgpLAogICAgICAgICAgICBfY29uZi5nZXRDb25uZWN0aW9uUGFzc3dv\ncmQoKSk7CiAgICB9CgogICAgcHVibGljIEJyb2tlciBuZXdCcm9rZXIoU3Ry\naW5nIHVzZXIsIFN0cmluZyBwYXNzKSB7CiAgICAgICAgcmV0dXJuIG5ld0Jy\nb2tlcih1c2VyLCBwYXNzLCBfY29uZi5pc1RyYW5zYWN0aW9uTW9kZU1hbmFn\nZWQoKSwKICAgICAgICAgICAgX2NvbmYuZ2V0Q29ubmVjdGlvblJldGFpbk1v\nZGVDb25zdGFudCgpKTsKICAgIH0KCiAgICBwdWJsaWMgQnJva2VyIG5ld0Jy\nb2tlcihib29sZWFuIG1hbmFnZWQsIGludCBjb25uUmV0YWluTW9kZSkgewog\nICAgICAgIHJldHVybiBuZXdCcm9rZXIoX2NvbmYuZ2V0Q29ubmVjdGlvblVz\nZXJOYW1lKCksCiAgICAgICAgICAgIF9jb25mLmdldENvbm5lY3Rpb25QYXNz\nd29yZCgpLCBtYW5hZ2VkLCBjb25uUmV0YWluTW9kZSk7CiAgICB9CgogICAg\ncHVibGljIEJyb2tlciBuZXdCcm9rZXIoU3RyaW5nIHVzZXIsIFN0cmluZyBw\nYXNzLCBib29sZWFuIG1hbmFnZWQsCiAgICAgICAgaW50IGNvbm5SZXRhaW5N\nb2RlKSB7CiAgICAgICAgcmV0dXJuIG5ld0Jyb2tlcih1c2VyLCBwYXNzLCBt\nYW5hZ2VkLCBjb25uUmV0YWluTW9kZSwgdHJ1ZSk7CiAgICB9CgogICAgcHVi\nbGljIEJyb2tlciBuZXdCcm9rZXIoU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNz\nLCBib29sZWFuIG1hbmFnZWQsCiAgICAgICAgaW50IGNvbm5SZXRhaW5Nb2Rl\nLCBib29sZWFuIGZpbmRFeGlzdGluZykgewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgbWFrZVJlYWRPbmx5\nKCk7CgogICAgICAgICAgICBCcm9rZXJJbXBsIGJyb2tlciA9IG51bGw7CiAg\nICAgICAgICAgIGlmIChmaW5kRXhpc3RpbmcpCiAgICAgICAgICAgICAgICBi\ncm9rZXIgPSBmaW5kQnJva2VyKHVzZXIsIHBhc3MsIG1hbmFnZWQpOwogICAg\nICAgICAgICBpZiAoYnJva2VyID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGJyb2tlciA9IG5ld0Jyb2tlckltcGwodXNlciwgcGFzcyk7CiAgICAgICAg\nICAgICAgICBpbml0aWFsaXplQnJva2VyKG1hbmFnZWQsIGNvbm5SZXRhaW5N\nb2RlLCBicm9rZXIsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gYnJva2VyOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHZvaWQgaW5pdGlhbGl6ZUJyb2tlcihib29sZWFuIG1hbmFnZWQsIGlu\ndCBjb25uUmV0YWluTW9kZSwKICAgICAgICBCcm9rZXJJbXBsIGJyb2tlciwg\nYm9vbGVhbiBmcm9tRGVzZXJpYWxpemF0aW9uKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIG1ha2VSZWFkT25seSgpOwoKICAgICAgICAvLyBk\nZWNvcmF0ZSB0aGUgc3RvcmUgbWFuYWdlciBmb3IgZGF0YSBjYWNoaW5nIGFu\nZCBjdXN0b20KICAgICAgICAvLyByZXN1bHQgb2JqZWN0IHByb3ZpZGVyczsg\nYWx3YXlzIG1ha2Ugc3VyZSBpdCdzIGEgZGVsZWdhdGluZwogICAgICAgIC8v\nIHN0b3JlIG1hbmFnZXIsIGJlY2F1c2UgaXQncyBlYXNpZXIgZm9yIHVzZXJz\nIHRvIGRlYWwgd2l0aAogICAgICAgIC8vIHRoYXQgd2F5CiAgICAgICAgU3Rv\ncmVNYW5hZ2VyIHNtID0gbmV3U3RvcmVNYW5hZ2VyKCk7CiAgICAgICAgRGVs\nZWdhdGluZ1N0b3JlTWFuYWdlciBkc20gPSBudWxsOwogICAgICAgIGlmIChf\nY29uZi5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS5nZXRTeXN0ZW1E\nYXRhQ2FjaGUoKQogICAgICAgICAgICAhPSBudWxsKQogICAgICAgICAgICBk\nc20gPSBuZXcgRGF0YUNhY2hlU3RvcmVNYW5hZ2VyKHNtKTsKICAgICAgICBk\nc20gPSBuZXcgUk9QU3RvcmVNYW5hZ2VyKChkc20gPT0gbnVsbCkgPyBzbSA6\nIGRzbSk7CgogICAgICAgIGJyb2tlci5pbml0aWFsaXplKHRoaXMsIGRzbSwg\nbWFuYWdlZCwgY29ublJldGFpbk1vZGUsCiAgICAgICAgICAgIGZyb21EZXNl\ncmlhbGl6YXRpb24pOwogICAgICAgIGlmICghZnJvbURlc2VyaWFsaXphdGlv\nbikKICAgICAgICAgICAgYWRkTGlzdGVuZXJzKGJyb2tlcik7CgogICAgICAg\nIC8vIGlmIHdlJ3JlIHVzaW5nIHJlbW90ZSBldmVudHMsIHJlZ2lzdGVyIHRo\nZSBldmVudCBtYW5hZ2VyIHNvCiAgICAgICAgLy8gdGhhdCBpdCBjYW4gYnJv\nYWRjYXN0IGNvbW1pdCBub3RpZmljYXRpb25zIGZyb20gdGhlIGJyb2tlcgog\nICAgICAgIFJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlciByZW1vdGUgPSBfY29u\nZi4KICAgICAgICAgICAgZ2V0UmVtb3RlQ29tbWl0RXZlbnRNYW5hZ2VyKCk7\nCiAgICAgICAgaWYgKHJlbW90ZS5hcmVSZW1vdGVFdmVudHNFbmFibGVkKCkp\nCiAgICAgICAgICAgIGJyb2tlci5hZGRUcmFuc2FjdGlvbkxpc3RlbmVyKHJl\nbW90ZSk7CgogICAgICAgIGxvYWRQZXJzaXN0ZW50VHlwZXMoYnJva2VyLmdl\ndENsYXNzTG9hZGVyKCkpOwogICAgICAgIF9icm9rZXJzLmFkZChicm9rZXIp\nOwogICAgICAgIF9jb25mLnNldFJlYWRPbmx5KENvbmZpZ3VyYXRpb24uSU5J\nVF9TVEFURV9GUk9aRU4pOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGZh\nY3RvcnktcmVnaXN0ZXJlZCBsaWZlY3ljbGUgbGlzdGVuZXJzIHRvIHRoZSBi\ncm9rZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZExpc3RlbmVy\ncyhCcm9rZXJJbXBsIGJyb2tlcikgewogICAgICAgIGlmIChfbGlmZWN5Y2xl\nTGlzdGVuZXJzICE9IG51bGwgJiYgIV9saWZlY3ljbGVMaXN0ZW5lcnMuaXNF\nbXB0eSgpKSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfbGlmZWN5Y2xlTGlzdGVuZXJz\nLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50\ncnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBicm9rZXIuYWRkTGlm\nZWN5Y2xlTGlzdGVuZXIoZW50cnkuZ2V0S2V5KCksIChDbGFzc1tdKQogICAg\nICAgICAgICAgICAgICAgIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoX3RyYW5zYWN0aW9uTGlzdGVu\nZXJzICE9IG51bGwgJiYgIV90cmFuc2FjdGlvbkxpc3RlbmVycy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfdHJhbnNh\nY3Rpb25MaXN0ZW5lcnMuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIGl0\nci5oYXNOZXh0KCk7ICkgewogICAgICAgICAgICAgICAgYnJva2VyLmFkZFRy\nYW5zYWN0aW9uTGlzdGVuZXIoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBjb25m\naWd1cmVkIHBlcnNpc3RlbnQgY2xhc3NlcyBsaXN0LiBQZXJmb3JtZWQgYXV0\nb21hdGljYWxseQogICAgICogd2hlbmV2ZXIgYSBicm9rZXIgaXMgY3JlYXRl\nZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgbG9hZFBlcnNpc3RlbnRUeXBl\ncyhDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICAvLyBpZiB3ZSd2\nZSBsb2FkZWQgdGhlIHBlcnNpc3RlbnQgdHlwZXMgYW5kIHRoZSBjbGFzcyBu\nYW1lIGxpc3QKICAgICAgICAvLyBpcyBlbXB0eSwgdGhlbiB3ZSBjYW4gc2lt\ncGx5IHJldHVybi4gTm90ZSB0aGF0IHRoZXJlIGlzIGEKICAgICAgICAvLyBw\nb3RlbnRpYWwgdGhyZWFkaW5nIHNjZW5hcmlvIGluIHdoaWNoIF9wZXJzaXN0\nZW50VHlwZXNMb2FkZWQgaXMKICAgICAgICAvLyBmYWxzZSB3aGVuIHJlYWQs\nIGJ1dCB0aGUgd29yayB0byBwb3B1bGF0ZSBfcGNDbGFzc05hbWVzIGhhcwog\nICAgICAgIC8vIGFscmVhZHkgYmVlbiBkb25lLiBUaGlzIGlzIG9rOyBfcGND\nbGFzc05hbWVzIGNhbiB0b2xlcmF0ZQogICAgICAgIC8vIGNvbmN1cnJlbnQg\nYWNjZXNzLCBzbyB0aGUgd29yc3QgY2FzZSBpcyB0aGF0IHRoZSBsaXN0IGlz\nCiAgICAgICAgLy8gcGVyc2lzdGVudCB0eXBlIGRhdGEgaXMgcHJvY2Vzc2Vk\nIG11bHRpcGxlIHRpbWVzLCB3aGljaCB0aGlzCiAgICAgICAgLy8gYWxnb3Jp\ndGhtIHRha2VzIGludG8gYWNjb3VudC4KICAgICAgICBpZiAoX3BlcnNpc3Rl\nbnRUeXBlc0xvYWRlZCAmJiBfcGNDbGFzc05hbWVzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBjYWNoZSBwZXJzaXN0ZW50\nIHR5cGUgbmFtZXMgaWYgbm90IGFscmVhZHkKICAgICAgICBDbGFzc0xvYWRl\nciBsb2FkZXIgPSBfY29uZi5nZXRDbGFzc1Jlc29sdmVySW5zdGFuY2UoKS4K\nICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoZ2V0Q2xhc3MoKSwgZW52TG9h\nZGVyKTsKICAgICAgICBDb2xsZWN0aW9uIHRvUmVkZWZpbmUgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgaWYgKCFfcGVyc2lzdGVudFR5cGVzTG9hZGVk\nKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gY2xzcyA9IF9jb25mLmdldE1l\ndGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBs\nb2FkUGVyc2lzdGVudFR5cGVzKGZhbHNlLCBsb2FkZXIpOwogICAgICAgICAg\nICBpZiAoY2xzcy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBfcGNDbGFz\nc05hbWVzID0gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gYyA9IG5ldyBBcnJh\neUxpc3QoY2xzcy5zaXplKCkpOwogICAgICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBjbHNzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICAgICAgQ2xhc3MgY2xzID0gKENsYXNzKSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGMuYWRkKGNscy5nZXROYW1l\nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChuZWVkc1N1YihjbHMpKQog\nICAgICAgICAgICAgICAgICAgICAgICB0b1JlZGVmaW5lLmFkZChjbHMpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2V0UGNDbGFzc0xv\nYWRlcnMoKS5hZGQobG9hZGVyKTsKICAgICAgICAgICAgICAgIF9wY0NsYXNz\nTmFtZXMgPSBjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9wZXJzaXN0\nZW50VHlwZXNMb2FkZWQgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIC8vIHJlbG9hZCB3aXRoIHRoaXMgbG9hZGVyCiAgICAgICAgICAg\nIGlmIChnZXRQY0NsYXNzTG9hZGVycygpLmFkZChsb2FkZXIpKSB7CiAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9wY0NsYXNzTmFtZXMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBDbGFzcyBjbHMg\nPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZSgo\nU3RyaW5nKSBpdHIubmV4dCgpLCB0cnVlLCBsb2FkZXIpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAobmVlZHNTdWIoY2xzKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRvUmVkZWZpbmUuYWRkKGNscyk7CiAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0\naW9uLkxPR19SVU5USU1FKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLndhcm4obnVsbCwgdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nLyBnZXQgdGhlIE1hbmFnZWRDbGFzc1N1YmNsYXNzZXIgaW50byB0aGUgbG9v\ncAogICAgICAgIE1hbmFnZWRDbGFzc1N1YmNsYXNzZXIucHJlcGFyZVVuZW5o\nYW5jZWRDbGFzc2VzKAogICAgICAgICAgICBfY29uZiwgdG9SZWRlZmluZSwg\nZW52TG9hZGVyKTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gbmVlZHNT\ndWIoQ2xhc3MgY2xzKSB7CiAgICAgICAgcmV0dXJuICFjbHMuaXNJbnRlcmZh\nY2UoKQogICAgICAgICAgICAmJiAhUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNz\nLmlzQXNzaWduYWJsZUZyb20oY2xzKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBhZGRMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIsIENsYXNz\nW10gY2xhc3NlcykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfbGlm\nZWN5Y2xlTGlzdGVuZXJzID09IG51bGwpCiAgICAgICAgICAgICAgICBfbGlm\nZWN5Y2xlTGlzdGVuZXJzID0gbmV3IEhhc2hNYXAoNyk7CiAgICAgICAgICAg\nIF9saWZlY3ljbGVMaXN0ZW5lcnMucHV0KGxpc3RlbmVyLCBjbGFzc2VzKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlTGlmZWN5Y2xl\nTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgaWYgKF9saWZlY3ljbGVMaXN0ZW5lcnMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9saWZlY3ljbGVMaXN0ZW5lcnMucmVtb3ZlKGxpc3RlbmVy\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYWRkVHJhbnNhY3Rp\nb25MaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgICAgICBpZiAoX3RyYW5zYWN0aW9uTGlzdGVuZXJzID09IG51bGwpCiAg\nICAgICAgICAgICAgICBfdHJhbnNhY3Rpb25MaXN0ZW5lcnMgPSBuZXcgTGlu\na2VkTGlzdCgpOwogICAgICAgICAgICBfdHJhbnNhY3Rpb25MaXN0ZW5lcnMu\nYWRkKGxpc3RlbmVyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncmVtb3ZlVHJhbnNhY3Rpb25MaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgICAgICBpZiAoX3RyYW5zYWN0aW9uTGlzdGVu\nZXJzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfdHJhbnNhY3Rpb25MaXN0\nZW5lcnMucmVtb3ZlKGxpc3RlbmVyKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBicm9rZXIgZmFjdG9yeSBp\ncyBjbG9zZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2Vk\nKCkgewogICAgICAgIHJldHVybiBfY2xvc2VkOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2Vy\ndE5vQWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIC8vIHJlbW92\nZSBmcm9tIGZhY3RvcnkgcG9vbAogICAgICAgICAgICBzeW5jaHJvbml6ZWQg\nKF9wb29sKSB7CiAgICAgICAgICAgICAgICBpZiAoX3Bvb2wuZ2V0KF9wb29s\nS2V5KSA9PSB0aGlzKQogICAgICAgICAgICAgICAgICAgIF9wb29sLnJlbW92\nZShfcG9vbEtleSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNs\nb3NlIGFsbCBicm9rZXJzCiAgICAgICAgICAgIEJyb2tlciBicm9rZXI7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2Jyb2tlcnMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGJyb2tl\nciA9IChCcm9rZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAvLyBD\naGVjayBmb3IgbnVsbCBiZWNhdXNlIF9icm9rZXJzIG1heSBjb250YWluIHdl\nYWsgcmVmZXJlbmNlcwogICAgICAgICAgICAgICAgaWYgKChicm9rZXIgIT0g\nbnVsbCkgJiYgKCFicm9rZXIuaXNDbG9zZWQoKSkpCiAgICAgICAgICAgICAg\nICAgICAgYnJva2VyLmNsb3NlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmKF9jb25mLm1ldGFEYXRhUmVwb3NpdG9yeUF2YWlsYWJsZSgpKSB7\nCiAgICAgICAgICAgICAgICAvLyByZW1vdmUgbWV0YWRhdGEgcmVwb3NpdG9y\neSBmcm9tIGxpc3RlbmVyIGxpc3QKICAgICAgICAgICAgICAgIFBDUmVnaXN0\ncnkucmVtb3ZlUmVnaXN0ZXJDbGFzc0xpc3RlbmVyCiAgICAgICAgICAgICAg\nICAgICAgKF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29uZi5jbG9zZSgpOwog\nICAgICAgICAgICBfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgTG9nIGxv\nZyA9IF9jb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVO\nVElNRSk7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgIF9jbG9zZWRFeGNlcHRpb24gPSBuZXcgSWxsZWdh\nbFN0YXRlRXhjZXB0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU3ViY2xhc3NlcyBzaG91bGQgb3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8g\nYWRkIGEgPGNvZGU+UGxhdGZvcm08L2NvZGU+CiAgICAgKiBwcm9wZXJ0eSBs\naXN0aW5nIHRoZSBydW50aW1lIHBsYXRmb3JtLCBzdWNoIGFzOgogICAgICog\nPGNvZGU+T3BlbkpQQSBKREJDIEVkaXRpb246IE9yYWNsZSBEYXRhYmFzZTwv\nY29kZT4KICAgICAqLwogICAgcHVibGljIFByb3BlcnRpZXMgZ2V0UHJvcGVy\ndGllcygpIHsKICAgICAgICAvLyByZXF1aXJlZCBwcm9wcyBhcmUgVmVuZG9y\nTmFtZSBhbmQgVmVyc2lvbk51bWJlcgogICAgICAgIFByb3BlcnRpZXMgcHJv\ncHMgPSBuZXcgUHJvcGVydGllcygpOwogICAgICAgIHByb3BzLnNldFByb3Bl\ncnR5KCJWZW5kb3JOYW1lIiwgT3BlbkpQQVZlcnNpb24uVkVORE9SX05BTUUp\nOwogICAgICAgIHByb3BzLnNldFByb3BlcnR5KCJWZXJzaW9uTnVtYmVyIiwg\nT3BlbkpQQVZlcnNpb24uVkVSU0lPTl9OVU1CRVIpOwogICAgICAgIHByb3Bz\nLnNldFByb3BlcnR5KCJWZXJzaW9uSWQiLCBPcGVuSlBBVmVyc2lvbi5WRVJT\nSU9OX0lEKTsKICAgICAgICByZXR1cm4gcHJvcHM7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBnZXRVc2VyT2JqZWN0KE9iamVjdCBrZXkpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9PSBudWxs\nKSA/IG51bGwgOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgcHV0VXNlck9iamVjdChPYmplY3Qga2V5\nLCBPYmplY3QgdmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgaWYgKHZh\nbCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIChfdXNlck9iamVj\ndHMgPT0gbnVsbCkgPyBudWxsIDogX3VzZXJPYmplY3RzLnJlbW92ZShrZXkp\nOwoKICAgICAgICAgICAgaWYgKF91c2VyT2JqZWN0cyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgX3VzZXJPYmplY3RzID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICAgICAgcmV0dXJuIF91c2VyT2JqZWN0cy5wdXQoa2V5LCB2YWwpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrKCkgewogICAgICAg\nIF9sb2NrLmxvY2soKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB1bmxvY2so\nKSB7CiAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXBsYWNlcyB0aGUgZmFjdG9yeSB3aXRoIHRoaXMgSlZNcyBwb29s\nZWQgdmVyc2lvbiBpZiBpdCBleGlzdHMuIEFsc28KICAgICAqIGZyZWV6ZXMg\ndGhlIGZhY3RvcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgcmVh\nZFJlc29sdmUoKQogICAgICAgIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRp\nb24gewogICAgICAgIEFic3RyYWN0QnJva2VyRmFjdG9yeSBmYWN0b3J5ID0g\nZ2V0UG9vbGVkRmFjdG9yeUZvcktleShfcG9vbEtleSk7CiAgICAgICAgaWYg\nKGZhY3RvcnkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnk7\nCgogICAgICAgIC8vIHJlc2V0IHRoZXNlIHRyYW5zaWVudCBmaWVsZHMgdG8g\nZW1wdHkgdmFsdWVzCiAgICAgICAgX3RyYW5zYWN0aW9uYWwgPSBuZXcgQ29u\nY3VycmVudEhhc2hNYXAoKTsKICAgICAgICBfYnJva2VycyA9IG5ld0Jyb2tl\nclNldCgpOwoKICAgICAgICBtYWtlUmVhZE9ubHkoKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICBwcml2YXRlIFNldCBuZXdCcm9rZXJTZXQo\nKSB7CiAgICAgICAgQnJva2VyVmFsdWUgYnY7CiAgICAgICAgaWYgKF9jb25m\nIGluc3RhbmNlb2YgT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBsKQogICAgICAg\nICAgICBidiA9ICgoT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBsKSBfY29uZiku\nYnJva2VyUGx1Z2luOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnYgPSAo\nQnJva2VyVmFsdWUpIF9jb25mLmdldFZhbHVlKEJyb2tlclZhbHVlLktFWSk7\nCgogICAgICAgIGlmIChGaW5hbGl6aW5nQnJva2VySW1wbC5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKAogICAgICAgICAgICBidi5nZXRUZW1wbGF0ZUJyb2tl\nclR5cGUoX2NvbmYpKSkgewogICAgICAgICAgICByZXR1cm4gTWFwQmFja2Vk\nU2V0LmRlY29yYXRlKG5ldyBDb25jdXJyZW50SGFzaE1hcCgpLAogICAgICAg\nICAgICAgICAgbmV3IE9iamVjdCgpIHsgfSk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBDb25jdXJyZW50UmVmZXJlbmNlSGFz\naFNldCgKICAgICAgICAgICAgICAgIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNo\nU2V0LldFQUspOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIE1ldGhvZHMgZm9yIE92ZXJyaWRlCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIG5ldyBTdG9yZU1hbmFnZXIgZm9yIHRoaXMgcnVudGltZS4gTm90ZSB0\naGF0IHRoZSBpbnN0YW5jZQogICAgICogcmV0dXJuZWQgaGVyZSBtYXkgYmUg\nd3JhcHBlZCBiZWZvcmUgYmVpbmcgcGFzc2VkIHRvIHRoZQogICAgICoge0Bs\naW5rICNuZXdCcm9rZXJ9IG1ldGhvZC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGFic3RyYWN0IFN0b3JlTWFuYWdlciBuZXdTdG9yZU1hbmFnZXIoKTsKCiAg\nICAvKioKICAgICAqIEZpbmQgYSBwb29sZWQgYnJva2VyLCBvciByZXR1cm4g\nbnVsbCBpZiBub25lLiBJZiB1c2luZwogICAgICogbWFuYWdlZCB0cmFuc2Fj\ndGlvbnMsIGxvb2tzIGZvciBhIHRyYW5zYWN0aW9uYWwgYnJva2VyOwogICAg\nICogb3RoZXJ3aXNlIHJldHVybnMgbnVsbCBieSBkZWZhdWx0LiBUaGlzIG1l\ndGhvZCB3aWxsIGJlIGNhbGxlZCBiZWZvcmUKICAgICAqIHtAbGluayAjbmV3\nU3RvcmVNYW5hZ2VyfSBzbyB0aGF0IGZhY3Rvcnkgc3ViY2xhc3NlcyBpbXBs\nZW1lbnRpbmcKICAgICAqIHBvb2xpbmcgY2FuIHJldHVybiBhIG1hdGNoaW5n\nIG1hbmFnZXIgYmVmb3JlIGEgbmV3IHtAbGluayBTdG9yZU1hbmFnZXJ9CiAg\nICAgKiBpcyBjcmVhdGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgQnJva2Vy\nSW1wbCBmaW5kQnJva2VyKFN0cmluZyB1c2VyLCBTdHJpbmcgcGFzcywgYm9v\nbGVhbiBtYW5hZ2VkKSB7CiAgICAgICAgaWYgKG1hbmFnZWQpCiAgICAgICAg\nICAgIHJldHVybiBmaW5kVHJhbnNhY3Rpb25hbEJyb2tlcih1c2VyLCBwYXNz\nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGJyb2tlciBjb25maWd1cmVkIHdpdGggdGhlIHByb3BlciBz\nZXR0aW5ncy4KICAgICAqIEJ5IGRlZmF1bHQsIHRoaXMgbWV0aG9kIGNvbnN0\ncnVjdHMgYSBuZXcKICAgICAqIEJyb2tlckltcGwgb2YgdGhlIGNsYXNzIHNl\ndCBmb3IgdGhpcyBmYWN0b3J5LgogICAgICovCiAgICBwcm90ZWN0ZWQgQnJv\na2VySW1wbCBuZXdCcm9rZXJJbXBsKFN0cmluZyB1c2VyLCBTdHJpbmcgcGFz\ncykgewogICAgICAgIEJyb2tlckltcGwgYnJva2VyID0gX2NvbmYubmV3QnJv\na2VySW5zdGFuY2UodXNlciwgcGFzcyk7CiAgICAgICAgaWYgKGJyb2tlciA9\nPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tYnJva2VyLWNsYXNzIiwKICAgICAgICAgICAgICAgIF9j\nb25mLmdldEJyb2tlckltcGwoKSkpOwoKICAgICAgICByZXR1cm4gYnJva2Vy\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0dXAgdHJhbnNpZW50IHN0YXRl\nIHVzZWQgYnkgdGhpcyBmYWN0b3J5IGJhc2VkIG9uIHRoZQogICAgICogY3Vy\ncmVudCBjb25maWd1cmF0aW9uLCB3aGljaCB3aWxsIHN1YnNlcXVlbnRseSBi\nZSBsb2NrZWQgZG93bi4gVGhpcwogICAgICogbWV0aG9kIHdpbGwgYmUgY2Fs\nbGVkIGJlZm9yZSB0aGUgZmlyc3QgYnJva2VyIGlzIHJlcXVlc3RlZCwKICAg\nICAqIGFuZCB3aWxsIGJlIHJlLWNhbGxlZCBlYWNoIHRpbWUgdGhlIGZhY3Rv\ncnkgaXMgZGVzZXJpYWxpemVkIGludG8gYSBKVk0KICAgICAqIHRoYXQgaGFz\nIG5vIGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgZGF0YSBzdG9yZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0dXAoKSB7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBGaW5kIGEgbWFuYWdlZCBydW50aW1lIGJyb2tl\nciBhc3NvY2lhdGVkIHdpdGggdGhlCiAgICAgKiBjdXJyZW50IHRyYW5zYWN0\naW9uLCBvciByZXR1cm5zIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIEJyb2tlckltcGwgZmluZFRyYW5zYWN0aW9uYWxCcm9rZXIoU3Ry\naW5nIHVzZXIsIFN0cmluZyBwYXNzKSB7CiAgICAgICAgVHJhbnNhY3Rpb24g\ndHJhbnM7CiAgICAgICAgTWFuYWdlZFJ1bnRpbWUgbXIgPSBfY29uZi5nZXRN\nYW5hZ2VkUnVudGltZUluc3RhbmNlKCk7CiAgICAgICAgT2JqZWN0IHR4S2V5\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRyYW5zID0gbXIuZ2V0VHJh\nbnNhY3Rpb25NYW5hZ2VyKCkuCiAgICAgICAgICAgICAgICBnZXRUcmFuc2Fj\ndGlvbigpOwogICAgICAgICAgICB0eEtleSA9IG1yLmdldFRyYW5zYWN0aW9u\nS2V5KCk7CgogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbAogICAgICAg\nICAgICAgICAgfHwgdHJhbnMuZ2V0U3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRV\nU19OT19UUkFOU0FDVElPTgogICAgICAgICAgICAgICAgfHwgdHJhbnMuZ2V0\nU3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRVU19VTktOT1dOKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CgogICAgICAgIENvbGxl\nY3Rpb24gYnJva2VycyA9IChDb2xsZWN0aW9uKSBfdHJhbnNhY3Rpb25hbC5n\nZXQodHhLZXkpOwogICAgICAgIGlmIChicm9rZXJzICE9IG51bGwpIHsKICAg\nICAgICAgICAgLy8gd2UgZG9uJ3QgbmVlZCB0byBzeW5jaHJvbml6ZSBvbiBi\ncm9rZXJzIHNpbmNlIG9uZSBKVEEgdHJhbnNhY3Rpb24KICAgICAgICAgICAg\nLy8gY2FuIG5ldmVyIGJlIGFjdGl2ZSBvbiBtdWx0aXBsZSBjb25jdXJyZW50\nIHRocmVhZHMuCiAgICAgICAgICAgIEJyb2tlckltcGwgYnJva2VyOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGJyb2tlcnMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGJyb2tlciA9\nIChCcm9rZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmVxdWFscyhicm9rZXIuZ2V0Q29ubmVjdGlvblVzZXJO\nYW1lKCksCiAgICAgICAgICAgICAgICAgICAgdXNlcikgJiYgU3RyaW5nVXRp\nbHMuZXF1YWxzCiAgICAgICAgICAgICAgICAgICAgKGJyb2tlci5nZXRDb25u\nZWN0aW9uUGFzc3dvcmQoKSwgcGFzcykpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGJyb2tlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3Vy\nZXMgdGhlIGdpdmVuIGJyb2tlciB3aXRoIHRoZSBjdXJyZW50IGZhY3Rvcnkg\nb3B0aW9uIHNldHRpbmdzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBj\nb25maWd1cmVCcm9rZXIoQnJva2VySW1wbCBicm9rZXIpIHsKICAgICAgICBi\ncm9rZXIuc2V0T3B0aW1pc3RpYyhfY29uZi5nZXRPcHRpbWlzdGljKCkpOwog\nICAgICAgIGJyb2tlci5zZXROb250cmFuc2FjdGlvbmFsUmVhZChfY29uZi5n\nZXROb250cmFuc2FjdGlvbmFsUmVhZCgpKTsKICAgICAgICBicm9rZXIuc2V0\nTm9udHJhbnNhY3Rpb25hbFdyaXRlKF9jb25mLmdldE5vbnRyYW5zYWN0aW9u\nYWxXcml0ZSgpKTsKICAgICAgICBicm9rZXIuc2V0UmV0YWluU3RhdGUoX2Nv\nbmYuZ2V0UmV0YWluU3RhdGUoKSk7CiAgICAgICAgYnJva2VyLnNldFJlc3Rv\ncmVTdGF0ZShfY29uZi5nZXRSZXN0b3JlU3RhdGVDb25zdGFudCgpKTsKICAg\nICAgICBicm9rZXIuc2V0QXV0b0NsZWFyKF9jb25mLmdldEF1dG9DbGVhckNv\nbnN0YW50KCkpOwogICAgICAgIGJyb2tlci5zZXRJZ25vcmVDaGFuZ2VzKF9j\nb25mLmdldElnbm9yZUNoYW5nZXMoKSk7CiAgICAgICAgYnJva2VyLnNldE11\nbHRpdGhyZWFkZWQoX2NvbmYuZ2V0TXVsdGl0aHJlYWRlZCgpKTsKICAgICAg\nICBicm9rZXIuc2V0QXV0b0RldGFjaChfY29uZi5nZXRBdXRvRGV0YWNoQ29u\nc3RhbnQoKSk7CiAgICAgICAgYnJva2VyLnNldERldGFjaFN0YXRlKF9jb25m\nLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0RGV0\nYWNoU3RhdGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGcmVlemVzIHRo\nZSBjb25maWd1cmF0aW9uIG9mIHRoaXMgZmFjdG9yeS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgbWFrZVJlYWRPbmx5KCkgewogICAgICAgIGlmIChfcmVh\nZE9ubHkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGFnYWluCiAgICAg\nICAgICAgIGlmIChfcmVhZE9ubHkpCiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIF9yZWFkT25seSA9IHRydWU7CgogICAgICAgICAgICBM\nb2cgbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxP\nR19SVU5USU1FKTsKICAgICAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICBsb2cuaW5mbyhnZXRGYWN0b3J5SW5pdGlh\nbGl6YXRpb25CYW5uZXIoKSk7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFj\nZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgTWFwIHByb3BzID0gX2Nv\nbmYudG9Qcm9wZXJ0aWVzKHRydWUpOwogICAgICAgICAgICAgICAgU3RyaW5n\nIGxpbmVTZXAgPSBKMkRvUHJpdkhlbHBlci5nZXRMaW5lU2VwYXJhdG9yKCk7\nCiAgICAgICAgICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1ZmZlcigpOwogICAgICAgICAgICAgICAgTWFwLkVudHJ5IGVudHJ5Owog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBwcm9wcy5lbnRy\neVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAu\nRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZChlbnRyeS5nZXRLZXkoKSkuYXBwZW5kKCI6ICIpLgogICAgICAgICAg\nICAgICAgICAgICAgICBhcHBlbmQoZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQobGluZVNlcCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImZh\nY3RvcnktcHJvcGVydGllcyIsIGJ1Zi50b1N0cmluZygpKSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIHNldHVwIHRyYW5zaWVudCBzdGF0ZQog\nICAgICAgICAgICBzZXR1cCgpOwoKICAgICAgICAgICAgLy8gcmVnaXN0ZXIg\ndGhlIG1ldGRhdGEgcmVwb3NpdG9yeSB0byBhdXRvLWxvYWQgcGVyc2lzdGVu\ndCB0eXBlcwogICAgICAgICAgICAvLyBhbmQgbWFrZSBzdXJlIHR5cGVzIGFy\nZSBlbmhhbmNlZAogICAgICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVw\nb3MgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwog\nICAgICAgICAgICByZXBvcy5zZXRWYWxpZGF0ZShyZXBvcy5WQUxJREFURV9S\nVU5USU1FLCB0cnVlKTsKICAgICAgICAgICAgcmVwb3Muc2V0UmVzb2x2ZShy\nZXBvcy5NT0RFX01BUFBJTkdfSU5JVCwgdHJ1ZSk7CiAgICAgICAgICAgIFBD\nUmVnaXN0cnkuYWRkUmVnaXN0ZXJDbGFzc0xpc3RlbmVyKHJlcG9zKTsKCiAg\nICAgICAgICAgIC8vIGZyZWV6ZSB1bmRlcmx5aW5nIGNvbmZpZ3VyYXRpb24g\nYW5kIGVhZ2VybHkgaW5pdGlhbGl6ZSB0bwogICAgICAgICAgICAvLyBhdm9p\nZCBzeW5jaHJvbml6YXRpb24KICAgICAgICAgICAgX2NvbmYuc2V0UmVhZE9u\nbHkoQ29uZmlndXJhdGlvbi5JTklUX1NUQVRFX0ZSRUVaSU5HKTsKICAgICAg\nICAgICAgX2NvbmYuaW5zdGFudGlhdGVBbGwoKTsKCiAgICAgICAgICAgIC8v\nIGZpcmUgYW4gZXZlbnQgZm9yIGFsbCB0aGUgYnJva2VyIGZhY3RvcnkgbGlz\ndGVuZXJzCiAgICAgICAgICAgIC8vIHJlZ2lzdGVyZWQgb24gdGhlIGNvbmZp\nZ3VyYXRpb24uCiAgICAgICAgICAgIF9jb25mLmdldEJyb2tlckZhY3RvcnlF\ndmVudE1hbmFnZXIoKS5maXJlRXZlbnQoCiAgICAgICAgICAgICAgICBuZXcg\nQnJva2VyRmFjdG9yeUV2ZW50KHRoaXMsCiAgICAgICAgICAgICAgICAgICAg\nQnJva2VyRmFjdG9yeUV2ZW50LkJST0tFUl9GQUNUT1JZX0NSRUFURUQpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gb2JqZWN0\nIHRvIGJlIHdyaXR0ZW4gdG8gdGhlIGxvZyB3aGVuIHRoaXMgYnJva2VyIGZh\nY3RvcnkKICAgICAqIGluaXRpYWxpemVzLiBUaGlzIGhhcHBlbnMgYWZ0ZXIg\ndGhlIGNvbmZpZ3VyYXRpb24gaXMgZnVsbHkgbG9hZGVkLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgT2JqZWN0IGdldEZhY3RvcnlJbml0aWFsaXphdGlvbkJh\nbm5lcigpIHsKICAgICAgICByZXR1cm4gX2xvYy5nZXQoImZhY3RvcnktaW5p\ndCIsIE9wZW5KUEFWZXJzaW9uLlZFUlNJT05fTlVNQkVSKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlvbiBpZiB0aGUgZmFjdG9y\neSBpcyBjbG9zZWQuICBUaGUgZXhhY3QgbWVzc2FnZSBhbmQKICAgICAqIGNv\nbnRlbnQgb2YgdGhlIGV4Y2VwdGlvbiB2YXJpZXMgd2hldGhlciBUUkFDRSBp\ncyBlbmFibGVkIG9yIG5vdC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFz\nc2VydE9wZW4oKSB7CiAgICAgICAgaWYgKF9jbG9zZWQpIHsKICAgICAgICAg\nICAgaWYgKF9jbG9zZWRFeGNlcHRpb24gPT0gbnVsbCkgIC8vIFRSQUNFIG5v\ndCBlbmFibGVkCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0\nYXRlRXhjZXB0aW9uKF9sb2MKICAgICAgICAgICAgICAgICAgICAgICAgLmdl\ndCgiY2xvc2VkLWZhY3Rvcnktbm90cmFjZSIpKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiY2xvc2VkLWZhY3RvcnkiKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgLnNldENhdXNlKF9jbG9zZWRFeGNlcHRpb24pOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nQnJva2VyIHV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIFRocm93cyBhIHtAbGluayBVc2VyRXhjZXB0aW9ufSBp\nZiBhIHRyYW5zYWN0aW9uIGlzIGFjdGl2ZS4gVGhlIHRocm93bgogICAgICog\nZXhjZXB0aW9uIHdpbGwgY29udGFpbiBhbGwgdGhlIEJyb2tlcnMgd2l0aCBh\nY3RpdmUgdHJhbnNhY3Rpb25zIGFzCiAgICAgKiBmYWlsZWQgb2JqZWN0cyBp\nbiB0aGUgbmVzdGVkIGV4Y2VwdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhc3NlcnROb0FjdGl2ZVRyYW5zYWN0aW9uKCkgewogICAgICAgIENv\nbGxlY3Rpb24gZXhjczsKICAgICAgICBpZiAoX3RyYW5zYWN0aW9uYWwuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGV4Y3MgPSBu\nZXcgQXJyYXlMaXN0KF90cmFuc2FjdGlvbmFsLnNpemUoKSk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciB0cmFucyA9IF90cmFuc2FjdGlvbmFsLnZhbHVlcygp\nLml0ZXJhdG9yKCk7CiAgICAgICAgICAgIHRyYW5zLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgQ29sbGVjdGlvbiBicm9rZXJzID0gKENvbGxlY3Rpb24p\nIHRyYW5zLm5leHQoKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBicm9rZXJzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBleGNzLmFkZChuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJhY3RpdmUiKSkuCiAgICAgICAgICAgICAgICAgICAgc2V0\nRmFpbGVkT2JqZWN0KGl0ci5uZXh0KCkpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgaWYgKCFleGNzLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgi\nbmVzdGVkLWV4Y2VwcyIpKS4KICAgICAgICAgICAgICAgIHNldE5lc3RlZFRo\ncm93YWJsZXMoKFRocm93YWJsZVtdKSBleGNzLnRvQXJyYXkKICAgICAgICAg\nICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNzLnNpemUoKV0pKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIHRoZSBnaXZlbiBicm9r\nZXIgd2l0aCBhIG1hbmFnZWQgdHJhbnNhY3Rpb24sCiAgICAgKiBvcHRpb25h\nbGx5IHN0YXJ0aW5nIG9uZSBpZiBub25lIGlzIGluIHByb2dyZXNzLgogICAg\nICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBzeW5jaGVkIHdpdGggdHJhbnNh\nY3Rpb24sIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBib29sZWFuIHN5\nbmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKEJyb2tlckltcGwgYnJva2VyLCBi\nb29sZWFuIGJlZ2luKSB7CiAgICAgICAgVHJhbnNhY3Rpb24gdHJhbnM7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgTWFuYWdlZFJ1bnRpbWUgbXIgPSBi\ncm9rZXIuZ2V0TWFuYWdlZFJ1bnRpbWUoKTsKICAgICAgICAgICAgVHJhbnNh\nY3Rpb25NYW5hZ2VyIHRtID0gbXIuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCk7\nCiAgICAgICAgICAgIHRyYW5zID0gdG0uZ2V0VHJhbnNhY3Rpb24oKTsKICAg\nICAgICAgICAgaWYgKHRyYW5zICE9IG51bGwKICAgICAgICAgICAgICAgICYm\nICh0cmFucy5nZXRTdGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX05PX1RSQU5T\nQUNUSU9OCiAgICAgICAgICAgICAgICB8fCB0cmFucy5nZXRTdGF0dXMoKSA9\nPSBTdGF0dXMuU1RBVFVTX1VOS05PV04pKQogICAgICAgICAgICAgICAgdHJh\nbnMgPSBudWxsOwoKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwgJiYg\nYmVnaW4pIHsKICAgICAgICAgICAgICAgIHRtLmJlZ2luKCk7CiAgICAgICAg\nICAgICAgICB0cmFucyA9IHRtLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAg\nICAgIH0gZWxzZSBpZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHN5bmNoIGJyb2tlciBh\nbmQgdHJhbnMKICAgICAgICAgICAgdHJhbnMucmVnaXN0ZXJTeW5jaHJvbml6\nYXRpb24oYnJva2VyKTsKCiAgICAgICAgICAgIC8vIHdlIGRvbid0IG5lZWQg\ndG8gc3luY2hyb25pemUgb24gYnJva2VycyBvciBndWFyZCBhZ2FpbnN0IG11\nbHRpcGxlCiAgICAgICAgICAgIC8vIHRocmVhZHMgdXNpbmcgdGhlIHNhbWUg\ndHJhbnMgc2luY2Ugb25lIEpUQSB0cmFuc2FjdGlvbiBjYW4gbmV2ZXIKICAg\nICAgICAgICAgLy8gYmUgYWN0aXZlIG9uIG11bHRpcGxlIGNvbmN1cnJlbnQg\ndGhyZWFkcy4KICAgICAgICAgICAgT2JqZWN0IHR4S2V5ID0gbXIuZ2V0VHJh\nbnNhY3Rpb25LZXkoKTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBicm9rZXJz\nID0gKENvbGxlY3Rpb24pIF90cmFuc2FjdGlvbmFsLmdldCh0eEtleSk7CiAg\nICAgICAgICAgIAogICAgICAgICAgICBpZiAoYnJva2VycyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBicm9rZXJzID0gbmV3IEFycmF5TGlzdCgyKTsK\nICAgICAgICAgICAgICAgIF90cmFuc2FjdGlvbmFsLnB1dCh0eEtleSwgYnJv\na2Vycyk7CiAgICAgICAgICAgICAgICB0cmFucy5yZWdpc3RlclN5bmNocm9u\naXphdGlvbihuZXcgUmVtb3ZlVHJhbnNhY3Rpb25TeW5jKHR4S2V5KSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgYnJva2Vycy5hZGQoYnJva2VyKTsK\nICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIHNldCBvZiBh\nbGwgdGhlIG9wZW4gYnJva2VycyBhc3NvY2lhdGVkIHdpdGggdGhpcyBmYWN0\nb3J5LiBUaGUKICAgICAqIHJldHVybmVkIHNldCBpcyB1bm1vZGlmaWFibGUs\nIGFuZCBtYXkgY29udGFpbiBudWxsIHJlZmVyZW5jZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBDb2xsZWN0aW9uIGdldE9wZW5Ccm9rZXJzKCkgewogICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xsZWN0aW9uKF9i\ncm9rZXJzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgPGNvZGU+\nYnJva2VyPC9jb2RlPiBmcm9tIGFueSBpbnRlcm5hbCBkYXRhIHN0cnVjdHVy\nZXMuIFRoaXMKICAgICAqIGlzIGludm9rZWQgYnkgPGNvZGU+YnJva2VyPC9j\nb2RlPiBhZnRlciB0aGUgYnJva2VyIGlzIGZ1bGx5IGNsb3NlZC4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgcmVsZWFzZUJyb2tlcihCcm9rZXJJbXBsIGJyb2tlcikgewogICAgICAg\nIF9icm9rZXJzLnJlbW92ZShicm9rZXIpOwogICAgfQoKICAgIC8qKgogICAg\nICogQHJldHVybiBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIHRvIG9idGFpbiB0\naGlzIGJyb2tlciBmYWN0b3J5IGZyb20gdGhlCiAgICAgKiBwb29sIGF0IGEg\nbGF0ZXIgdGltZS4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAq\nLwogICAgcHVibGljIE9iamVjdCBnZXRQb29sS2V5KCkgewogICAgICAgIHJl\ndHVybiBfcG9vbEtleTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGtl\neSB0aGF0IGNhbiBiZSB1c2VkIHRvIG9idGFpbiB0aGlzIGJyb2tlciBmYWN0\nb3J5IGZyb20gdGhlCiAgICAgKiBwb29sIGF0IGEgbGF0ZXIgdGltZS4KICAg\nICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgdm9pZCBzZXRQ\nb29sS2V5KE9iamVjdCBrZXkpIHsKICAgICAgICBfcG9vbEtleSA9IGtleTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNpbXBsZSBzeW5jaHJvbml6YXRpb24g\nbGlzdGVuZXIgdG8gcmVtb3ZlIGNvbXBsZXRlZCB0cmFuc2FjdGlvbnMKICAg\nICAqIGZyb20gb3VyIGNhY2hlLgogICAgICovCiAgICBwcml2YXRlIGNsYXNz\nIFJlbW92ZVRyYW5zYWN0aW9uU3luYwogICAgICAgIGltcGxlbWVudHMgU3lu\nY2hyb25pemF0aW9uIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBPYmplY3Qg\nX3RyYW5zOwoKICAgICAgICBwdWJsaWMgUmVtb3ZlVHJhbnNhY3Rpb25TeW5j\nKE9iamVjdCB0cmFucykgewogICAgICAgICAgICBfdHJhbnMgPSB0cmFuczsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGJlZm9yZUNvbXBsZXRp\nb24oKSB7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBhZnRlckNv\nbXBsZXRpb24oaW50IHN0YXR1cykgewogICAgICAgICAgICBfdHJhbnNhY3Rp\nb25hbC5yZW1vdmUgKF90cmFucyk7CgkJfQoJfQogICAgCiAgICAvKioKICAg\nICAqIE1ldGhvZCBpbnN1cmVzIHRoYXQgZGVzZXJpYWxpemVkIEVNRiBoYXMg\ndGhpcyByZWZlcmVuY2UgcmUtaW5zdGFudGlhdGVkCiAgICAgKi8KICAgIHBy\naXZhdGUgQ29sbGVjdGlvbiBnZXRQY0NsYXNzTG9hZGVycygpIHsKICAgICAg\nIGlmIChfcGNDbGFzc0xvYWRlcnMgPT0gbnVsbCkKICAgICAgICAgX3BjQ2xh\nc3NMb2FkZXJzID0gbmV3IENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoU2V0KAog\nICAgICAgICAgICAgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7\nCiAgICAgICAgICAKICAgICAgIHJldHVybiBfcGNDbGFzc0xvYWRlcnM7CiAg\nICB9Cn0K\n","encoding":"base64"}

