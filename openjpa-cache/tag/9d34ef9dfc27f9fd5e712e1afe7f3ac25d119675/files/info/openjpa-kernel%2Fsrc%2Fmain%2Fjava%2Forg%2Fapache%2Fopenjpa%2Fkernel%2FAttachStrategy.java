{"sha":"2906698764916771a52bfcb0904ed11311aeed7c","node_id":"MDQ6QmxvYjIwNjM2NDoyOTA2Njk4NzY0OTE2NzcxYTUyYmZjYjA5MDRlZDExMzExYWVlZDdj","size":20647,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2906698764916771a52bfcb0904ed11311aeed7c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOwoKLyoqCiAqIFN0cmF0ZWd5IGZvciBhdHRhY2hpbmcgb2JqZWN0cy4K\nICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhvciBT\ndGV2ZSBLaW0KICogQG5vamF2YWRvYwogKi8KYWJzdHJhY3QgY2xhc3MgQXR0\nYWNoU3RyYXRlZ3kKICAgIGV4dGVuZHMgVHJhbnNmZXJGaWVsZE1hbmFnZXIg\newoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQXR0YWNoU3RyYXRlZ3ku\nY2xhc3MpOwoKICAgIC8qKgogICAgICogQXR0YWNoLgogICAgICoKICAgICAq\nIEBwYXJhbSBtYW5hZ2VyIG1hbmFnZXIgaG9sZGluZyBjYWNoZSBvZiBhdHRh\nY2hlZCBpbnN0YW5jZXMKICAgICAqIEBwYXJhbSB0b0F0dGFjaCBkZXRhY2hl\nZCBpbnN0YW5jZQogICAgICogQHBhcmFtIG1ldGEgbWV0YWRhdGEgZm9yIHRo\nZSBpbnN0YW5jZSBiZWluZyBhdHRhY2hlZAogICAgICogQHBhcmFtIGludG8g\naW5zdGFuY2Ugd2UncmUgYXR0YWNoaW5nIGludG8KICAgICAqIEBwYXJhbSBv\nd25lciBzdGF0ZSBtYW5hZ2VyIGZvciA8Y29kZT5pbnRvPC9jb2RlPgogICAg\nICogQHBhcmFtIG93bmVyTWV0YSBmaWVsZCB3ZSB0cmF2ZXJzZWQgdG8gZmlu\nZCA8Y29kZT50b0F0dGFjaDwvY29kZT4KICAgICAqIEBwYXJhbSBleHBsaWNp\ndCB3aGV0aGVyIHRvIG1ha2UgbmV3IGluc3RhbmNlcyBleHBsaWNpdGx5IHBl\ncnNpc3RlbnQKICAgICAqLwogICAgcHVibGljIGFic3RyYWN0IE9iamVjdCBh\ndHRhY2goQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAgIE9iamVjdCB0\nb0F0dGFjaCwgQ2xhc3NNZXRhRGF0YSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFi\nbGUgaW50bywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBW\nYWx1ZU1ldGFEYXRhIG93bmVyTWV0YSwgYm9vbGVhbiBleHBsaWNpdCk7Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGlkZW50aXR5IG9mIHRoZSBnaXZl\nbiBkZXRhY2hlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFi\nc3RyYWN0IE9iamVjdCBnZXREZXRhY2hlZE9iamVjdElkKEF0dGFjaE1hbmFn\nZXIgbWFuYWdlciwKICAgICAgICBPYmplY3QgdG9BdHRhY2gpOwoKICAgIC8q\nKgogICAgICogUHJvdmlkZSB0aGUgZ2l2ZW4gZmllbGQgaW50byB0aGlzIGZp\nZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2\nb2lkIHByb3ZpZGVGaWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdl\nckltcGwgc20sCiAgICAgICAgaW50IGZpZWxkKTsKCiAgICAvKioKICAgICAq\nIFJldHVybiBhIFBOZXcvUE5ld1Byb3Zpc2lvbmFsIG1hbmFnZWQgb2JqZWN0\nIGZvciB0aGUgZ2l2ZW4gZGV0YWNoZWQgCiAgICAgKiBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgcGVyc2lzdChB\ndHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEsIE9iamVjdCBhcHBJZCwgCiAg\nICAgICAgYm9vbGVhbiBleHBsaWNpdCkgewogICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBuZXdJbnN0YW5jZTsKICAgICAgICBpZiAoIW1hbmFnZXIuZ2V0\nQ29weU5ldygpKQogICAgICAgICAgICBuZXdJbnN0YW5jZSA9IHBjOwogICAg\nICAgIGVsc2UgaWYgKGFwcElkID09IG51bGwpCiAgICAgICAgICAgIC8vIGRh\ndGFzdG9yZSBpZGVudGl0eSBvciBhcHBsaWNhdGlvbiBpZGVudGl0eSB3aXRo\nIGdlbmVyYXRlZCBrZXlzCiAgICAgICAgICAgIG5ld0luc3RhbmNlID0gcGMu\ncGNOZXdJbnN0YW5jZShudWxsLCBmYWxzZSk7CiAgICAgICAgZWxzZSAvLyBh\ncHBsaWNhdGlvbiBpZGVudGl0eTogdXNlIGV4aXN0aW5nIGZpZWxkcwogICAg\nICAgICAgICBuZXdJbnN0YW5jZSA9IHBjLnBjTmV3SW5zdGFuY2UobnVsbCwg\nYXBwSWQsIGZhbHNlKTsKCiAgICAgICAgcmV0dXJuIChTdGF0ZU1hbmFnZXJJ\nbXBsKSBtYW5hZ2VyLmdldEJyb2tlcigpLnBlcnNpc3QKICAgICAgICAgICAg\nKG5ld0luc3RhbmNlLCBhcHBJZCwgZXhwbGljaXQsIG1hbmFnZXIuZ2V0QmVo\nYXZpb3IoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggdGhlIGdp\ndmVuIGZpZWxkIGludG8gdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICoKICAg\nICAqIEBwYXJhbSB0b0F0dGFjaCB0aGUgZGV0YWNoZWQgcGVyc2lzdGVudCBp\nbnN0YW5jZQogICAgICogQHBhcmFtIHNtIHN0YXRlIG1hbmFnZXIgZm9yIHRo\nZSBtYW5hZ2VkIGluc3RhbmNlIHdlJ3JlIGNvcHlpbmcKICAgICAqIGludG87\nIDxjb2RlPnRvQXR0YWNoPC9jb2RlPiBhbHNvIHVzZXMgdGhpcyBzdGF0ZSBt\nYW5hZ2VyCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFkYXRhIG9uIHRoZSBmaWVs\nZCB3ZSdyZSBjb3B5aW5nCiAgICAgKiBAcGFyYW0gbnVsbExvYWRlZCBpZiBm\nYWxzZSwgbnVsbHMgd2lsbCBiZSBjb25zaWRlcmVkIHVubG9hZGVkIGFuZCB3\naWxsCiAgICAgKiBub3QgYmUgYXR0YWNoZWQKICAgICAqLwogICAgcHJvdGVj\ndGVkIGJvb2xlYW4gYXR0YWNoRmllbGQoQXR0YWNoTWFuYWdlciBtYW5hZ2Vy\nLCBPYmplY3QgdG9BdHRhY2gsCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSwgRmllbGRNZXRhRGF0YSBmbWQsIGJvb2xlYW4gbnVsbExvYWRlZCkgewog\nICAgICAgIGlmIChmbWQuaXNWZXJzaW9uKCkKICAgICAgICAgICAgfHwgZm1k\nLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJT\nSVNURU5UKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBpbnRvID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBh\nYmxlKCk7CiAgICAgICAgaW50IGkgPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAg\nICBwcm92aWRlRmllbGQodG9BdHRhY2gsIHNtLCBpKTsKCiAgICAgICAgaW50\nIHNldCA9IFN0YXRlTWFuYWdlci5TRVRfQVRUQUNIOwogICAgICAgIE9iamVj\ndCB2YWw7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAg\nICAgICAgICAgICAgICBzbS5zZXR0aW5nQm9vbGVhbkZpZWxkKGludG8sIGks\nIHNtLmZldGNoQm9vbGVhbkZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAg\nIGZldGNoQm9vbGVhbkZpZWxkKGkpLCBzZXQpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICBzbS5zZXR0aW5nQnl0ZUZpZWxkKGludG8sIGksIHNtLmZl\ndGNoQnl0ZUZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgIGZldGNoQnl0\nZUZpZWxkKGkpLCBzZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBz\nbS5zZXR0aW5nQ2hhckZpZWxkKGludG8sIGksIHNtLmZldGNoQ2hhckZpZWxk\nKGkpLAogICAgICAgICAgICAgICAgICAgIGZldGNoQ2hhckZpZWxkKGkpLCBz\nZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdE\nb3VibGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaERvdWJsZUZpZWxkKGkpLAog\nICAgICAgICAgICAgICAgICAgIGZldGNoRG91YmxlRmllbGQoaSksIHNldCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBzbS5zZXR0aW5nRmxvYXRG\naWVsZChpbnRvLCBpLCBzbS5mZXRjaEZsb2F0RmllbGQoaSksCiAgICAgICAg\nICAgICAgICAgICAgZmV0Y2hGbG9hdEZpZWxkKGkpLCBzZXQpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdJbnRGaWVsZChpbnRvLCBp\nLCBzbS5mZXRjaEludEZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgIGZl\ndGNoSW50RmllbGQoaSksIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nICAgIHNtLnNldHRpbmdMb25nRmllbGQoaW50bywgaSwgc20uZmV0Y2hMb25n\nRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hMb25nRmllbGQo\naSksIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBzbS5zZXR0\naW5nU2hvcnRGaWVsZChpbnRvLCBpLCBzbS5mZXRjaFNob3J0RmllbGQoaSks\nCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hTaG9ydEZpZWxkKGkpLCBzZXQp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIFN0cmluZyBzdmFsID0g\nZmV0Y2hTdHJpbmdGaWVsZChpKTsKICAgICAgICAgICAgICAgIGlmIChzdmFs\nID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgc20uc2V0dGluZ1N0cmlu\nZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoU3RyaW5nRmllbGQoaSksIHN2YWws\nCiAgICAgICAgICAgICAgICAgICAgc2V0KTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PSUQ6CiAgICAgICAgICAgICAgICB2YWwgPSBmZXRjaE9iamVjdEZpZWxk\nKGkpOwogICAgICAgICAgICAgICAgaWYgKHZhbCA9PSBudWxsICYmICFudWxs\nTG9hZGVkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCBz\nbS5mZXRjaE9iamVjdEZpZWxkKGkpLCB2YWwsCiAgICAgICAgICAgICAgICAg\nICAgc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIE9iamVjdCBmcm1wYyA9IGZl\ndGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAoZnJtcGMg\nPT0gbnVsbCAmJiAhbnVsbExvYWRlZCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHRvc20gPSBtYW5hZ2VyLmdldEJyb2tlcigpLmdldFN0YXRlTWFuYWdl\ncgogICAgICAgICAgICAgICAgICAgIChzbS5mZXRjaE9iamVjdEZpZWxkKGkp\nKTsKICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSB0b3BjID0g\nKHRvc20gPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAgICAgICAgICAgOiB0\nb3NtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgICAgICAgICAg\naWYgKGZybXBjICE9IG51bGwgfHwgdG9wYyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGZtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX05PTkUpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZybXBjID0gZ2V0UmVmZXJlbmNlKG1hbmFnZXIsIGZybXBjLCBzbSwg\nZm1kKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIGludG9wYyA9IHRvcGM7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm1kLmlzRW1iZWRkZWRQ\nQygpICYmIGZybXBjICE9IG51bGwgJiYgdG9wYyAhPSBudWxsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAmJiAhT2JqZWN0VXRpbHMuZXF1YWxzKHRv\ncGMucGNGZXRjaE9iamVjdElkKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBtYW5hZ2VyLmdldERldGFjaGVkT2JqZWN0SWQoZnJtcGMpKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50b3BjID0gbnVsbDsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBmcm1wYyA9IG1hbmFnZXIuYXR0YWNoKGZybXBjLCBpbnRvcGMsIHNtLCBm\nbWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGZybXBjICE9IHRvcGMpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCB0b3BjLCBm\ncm1wYywgc2V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9O\nOgogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBmcm1jID0gKENvbGxlY3Rp\nb24pIGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAo\nZnJtYyA9PSBudWxsICYmICFudWxsTG9hZGVkKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24g\ndG9jID0gKENvbGxlY3Rpb24pIHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAg\nICAgICAgICAgICAgICBpZiAoKHRvYyAhPSBudWxsICYmICF0b2MuaXNFbXB0\neSgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZybWMgIT0gbnVsbCAmJiAh\nZnJtYy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJt\nYyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5n\nT2JqZWN0RmllbGQoaW50bywgaSwgdG9jLCBudWxsLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKHRvYyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBp\nLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNoQ29s\nbGVjdGlvbihtYW5hZ2VyLCBmcm1jLCBzbSwgZm1kKSwgc2V0KTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvYyBpbnN0YW5jZW9mIFNldCAm\nJiBmcm1jIGluc3RhbmNlb2YgU2V0KQogICAgICAgICAgICAgICAgICAgICAg\nICByZXBsYWNlQ29sbGVjdGlvbihtYW5hZ2VyLCBmcm1jLCB0b2MsIHNtLCBm\nbWQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgdG9j\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUxpc3QobWFu\nYWdlciwgZnJtYywgdG9jLCBzbSwgZm1kKSwgc2V0KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAg\nICAgICAgICAgTWFwIGZybW0gPSAoTWFwKSBmZXRjaE9iamVjdEZpZWxkKGkp\nOwogICAgICAgICAgICAgICAgaWYgKGZybW0gPT0gbnVsbCAmJiAhbnVsbExv\nYWRlZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgICAgICBNYXAgdG9tID0gKE1hcCkgc20uZmV0Y2hPYmplY3RGaWVs\nZChpKTsKICAgICAgICAgICAgICAgIGlmICgodG9tICE9IG51bGwgJiYgIXRv\nbS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgfHwgKGZybW0gIT0g\nbnVsbCAmJiAhZnJtbS5pc0VtcHR5KCkpKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGZybW0gPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHRvbSwgbnVsbCwgc2V0\nKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b20gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ09iamVjdEZpZWxk\nKGludG8sIGksIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\ndHRhY2hNYXAobWFuYWdlciwgZnJtbSwgc20sIGZtZCksIHNldCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXBsYWNlTWFwKG1hbmFnZXIsIGZybW0sIHRvbSwgc20sIGZtZCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBPYmpl\nY3QgZnJtYSA9IGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAg\nICBpZiAoZnJtYSA9PSBudWxsICYmICFudWxsTG9hZGVkKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIE9iamVj\ndCB0b2EgPSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAg\nICAgaWYgKCh0b2EgIT0gbnVsbCAmJiBBcnJheS5nZXRMZW5ndGgodG9hKSA+\nIDApCiAgICAgICAgICAgICAgICAgICAgfHwgKGZybWEgIT0gbnVsbCAmJiBB\ncnJheS5nZXRMZW5ndGgoZnJtYSkgPiAwKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChmcm1hID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCB0b2EsIG51bGwsIHNl\ndCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgdG9hLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUFycmF5KG1hbmFn\nZXIsIGZybWEsIHRvYSwgc20sIGZtZCksIHNldCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbihmbWQudG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbWFuYWdlZCwg\ncG9zc2libHkgaG9sbG93IHJlZmVyZW5jZSBmb3IgdGhlIGdpdmVuIGRldGFj\naGVkCiAgICAgKiBvYmplY3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmpl\nY3QgZ2V0UmVmZXJlbmNlKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgT2JqZWN0\nIHRvQXR0YWNoLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBWYWx1ZU1ldGFE\nYXRhIHZtZCkgewogICAgICAgIGlmICh0b0F0dGFjaCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKG1hbmFnZXIuZ2V0\nQnJva2VyKCkuaXNOZXcodG9BdHRhY2gpKSB7CiAgICAgICAgICAgIC8vIENo\nZWNrIGlmIHRvQXR0YWNoIGlzIGFscmVhZHkgbWFwcGVkIHRvIGEgbWFuYWdl\nZCBpbnN0YW5jZQogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMg\nPSBtYW5hZ2VyLmdldEF0dGFjaGVkQ29weSh0b0F0dGFjaCk7CiAgICAgICAg\nICAgIGlmIChwYyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncGM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdG9BdHRhY2g7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYg\nKG1hbmFnZXIuZ2V0QnJva2VyKCkuaXNQZXJzaXN0ZW50KHRvQXR0YWNoKSkg\newogICAgICAgICAgICByZXR1cm4gdG9BdHRhY2g7CiAgICAgICAgfSBlbHNl\nIGlmIChtYW5hZ2VyLmdldEJyb2tlcigpLmlzRGV0YWNoZWQodG9BdHRhY2gp\nKSB7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBtYW5hZ2VyLmdldERldGFj\naGVkT2JqZWN0SWQodG9BdHRhY2gpOwogICAgICAgICAgICBpZiAob2lkICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYW5hZ2VyLmdldEJy\nb2tlcigpLmZpbmQob2lkLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoImNhbnQtY2FzY2FkZS1hdHRhY2giLCB2bWQpKS5zZXRGYWlsZWRP\nYmplY3QodG9BdHRhY2gpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFj\nZSB0aGUgY29udGVudHMgb2YgPGNvZGU+dG9jPC9jb2RlPiB3aXRoIHRoZSBj\nb250ZW50cyBvZgogICAgICogPGNvZGU+ZnJtYzwvY29kZT4uIE5laXRoZXIg\nY29sbGVjdGlvbiBpcyBudWxsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncmVwbGFjZUNvbGxlY3Rpb24oQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBDb2xs\nZWN0aW9uIGZybWMsCiAgICAgICAgQ29sbGVjdGlvbiB0b2MsIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\nLy8gaWYgZnJtYyBjb2xsZWN0aW9uIGlzIGVtcHR5LCBqdXN0IGNsZWFyIHRv\nYwogICAgICAgIGlmIChmcm1jLmlzRW1wdHkoKSkgewogICAgICAgICAgICBp\nZiAoIXRvYy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICB0b2MuY2xlYXIo\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\naWYgdGhpcyBpcyBhIHBjIGNvbGxlY3Rpb24sIGF0dGFjaCBhbGwgaW5zdGFu\nY2VzCiAgICAgICAgYm9vbGVhbiBwYyA9IGZtZC5nZXRFbGVtZW50KCkuaXNE\nZWNsYXJlZFR5cGVQQygpOwogICAgICAgIGlmIChwYykKICAgICAgICAgICAg\nZnJtYyA9IGF0dGFjaENvbGxlY3Rpb24obWFuYWdlciwgZnJtYywgc20sIGZt\nZCk7CgogICAgICAgIC8vIHJlbW92ZSBhbGwgZWxlbWVudHMgZnJvbSB0aGUg\ndG9jIGNvbGxlY3Rpb24gdGhhdCBhcmVuJ3QgaW4gZnJtYwogICAgICAgIHRv\nYy5yZXRhaW5BbGwoZnJtYyk7CgogICAgICAgIC8vIG5vdyBhZGQgYWxsIGVs\nZW1lbnRzIHRoYXQgYXJlIGluIGZybWMgYnV0IG5vdCB0b2MKICAgICAgICBp\nZiAoZnJtYy5zaXplKCkgIT0gdG9jLnNpemUoKSkgewogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGkgPSBmcm1jLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgT2JqZWN0IG9iID0gaS5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBpZiAoIXRvYy5jb250YWlucyhvYikpCiAgICAgICAg\nICAgICAgICAgICAgdG9jLmFkZChvYik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgY29sbGVj\ndGlvbiB3aXRoIHRoZSBhdHRhY2hlZCBjb250ZW50cyBvZiB0aGUgZ2l2ZW4g\nb25lLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBhdHRhY2hD\nb2xsZWN0aW9uKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwKICAgICAgICBDb2xs\nZWN0aW9uIG9yaWcsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0\nYURhdGEgZm1kKSB7CiAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gY29weUNv\nbGxlY3Rpb24obWFuYWdlciwgb3JpZywgZm1kKTsKICAgICAgICBWYWx1ZU1l\ndGFEYXRhIHZtZCA9IGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgaWYgKCF2\nbWQuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICByZXR1cm4gY29s\nbDsKCiAgICAgICAgLy8gdW5mb3J0dW5hdGVseSB3ZSBoYXZlIHRvIGNsZWFy\nIHRoZSBvcmlnaW5hbCBhbmQgcmUtYWRkCiAgICAgICAgY29sbC5jbGVhcigp\nOwogICAgICAgIE9iamVjdCBlbGVtOwogICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gb3JpZy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBpZiAodm1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAgICAgIGVsZW0gPSBn\nZXRSZWZlcmVuY2UobWFuYWdlciwgaXRyLm5leHQoKSwgc20sIHZtZCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGVsZW0gPSBtYW5hZ2Vy\nLmF0dGFjaChpdHIubmV4dCgpLCBudWxsLCBzbSwgdm1kLCBmYWxzZSk7CiAg\nICAgICAgICAgIGNvbGwuYWRkKGVsZW0pOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gY29sbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvcGllcyB0aGUg\nZ2l2ZW4gY29sbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0\naW9uIGNvcHlDb2xsZWN0aW9uKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgQ29s\nbGVjdGlvbiBvcmlnLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICAgICAgQ29sbGVjdGlvbiBjb2xsID0gbWFuYWdlci5nZXRQcm94eU1hbmFn\nZXIoKS5jb3B5Q29sbGVjdGlvbihvcmlnKTsKICAgICAgICBpZiAoY29sbCA9\nPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibm90LWNvcHlhYmxlIiwgZm1kKSk7CiAgICAgICAgcmV0dXJu\nIGNvbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGF0dGFj\naGVkIHZlcnNpb24gb2YgdGhlIDxjb2RlPmZybWw8L2NvZGU+CiAgICAgKiBs\naXN0IGlmIGl0IGlzIGRpZmZlcmVudCB0aGFuIDxjb2RlPnRvbDwvY29kZT4u\nIElmIHRoZSBsaXN0cwogICAgICogd2lsbCBiZSBpZGVudGljYWwsIHJldHVy\nbnMgPGNvZGU+dG9sPC9jb2RlPi4gTmVpdGhlciBsaXN0IGlzIG51bGwuCiAg\nICAgKi8KICAgIHByaXZhdGUgQ29sbGVjdGlvbiByZXBsYWNlTGlzdChBdHRh\nY2hNYW5hZ2VyIG1hbmFnZXIsIENvbGxlY3Rpb24gZnJtbCwKICAgICAgICBD\nb2xsZWN0aW9uIHRvbCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICBib29sZWFuIHBjID0gZm1kLmdldEVs\nZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgaWYgKHBjKQog\nICAgICAgICAgICBmcm1sID0gYXR0YWNoQ29sbGVjdGlvbihtYW5hZ2VyLCBm\ncm1sLCBzbSwgZm1kKTsKCiAgICAgICAgLy8gaWYgdGhlIG9ubHkgZGlmZiBi\nZXR3ZWVuIGZybWwgYW5kIHRvbCBpcyBzb21lIGFkZGVkIGVsZW1lbnRzIGF0\nCiAgICAgICAgLy8gdGhlIGVuZCwgbWFrZSB0aGUgY2hhbmdlcyBkaXJlY3Rs\neSBpbiB0b2wKICAgICAgICBpZiAoZnJtbC5zaXplKCkgPj0gdG9sLnNpemUo\nKSkgewogICAgICAgICAgICBJdGVyYXRvciBmcm1pID0gZnJtbC5pdGVyYXRv\ncigpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIHRvaSA9IHRvbC5pdGVy\nYXRvcigpOyB0b2kuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgLy8g\naWYgdGhlcmUncyBhbiBpbmNvbXBhdGliaWxpdHksIGp1c3QgcmV0dXJuIGEg\nY29weSBvZiBmcm1sCiAgICAgICAgICAgICAgICAvLyAoaXQncyBhbHJlYWR5\nIGNvcGllZCBpZiB3ZSBhdHRhY2hlZCBpdCkKICAgICAgICAgICAgICAgIGlm\nICghZXF1YWxzKGZybWkubmV4dCgpLCB0b2kubmV4dCgpLCBwYykpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIChwYykgPyBmcm1sIDogY29weUNvbGxl\nY3Rpb24obWFuYWdlciwgZnJtbCwgZm1kKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8ganVzdCBhZGQgdGhlIGV4dHJhIGVsZW1lbnRzIGluIGZy\nbWwgdG8gdG9sIGFuZCByZXR1cm4gdG9sCiAgICAgICAgICAgIHdoaWxlIChm\ncm1pLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIHRvbC5hZGQoZnJtaS5u\nZXh0KCkpOwogICAgICAgICAgICByZXR1cm4gdG9sOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdGhlIGxpc3RzIGFyZSBkaWZmZXJlbnQ7IGp1c3QgbWFrZSBz\ndXJlIGZybWwgaXMgY29waWVkIGFuZCByZXR1cm4gaXQKICAgICAgICByZXR1\ncm4gKHBjKSA/IGZybWwgOiBjb3B5Q29sbGVjdGlvbihtYW5hZ2VyLCBmcm1s\nLCBmbWQpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSB0aGUgY29u\ndGVudHMgb2YgPGNvZGU+dG9tPC9jb2RlPiB3aXRoIHRoZSBjb250ZW50cyBv\nZgogICAgICogPGNvZGU+ZnJtbTwvY29kZT4uIE5laXRoZXIgbWFwIGlzIG51\nbGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXBsYWNlTWFwKEF0dGFj\naE1hbmFnZXIgbWFuYWdlciwgTWFwIGZybW0sIE1hcCB0b20sCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsK\nICAgICAgICBpZiAoZnJtbS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgaWYg\nKCF0b20uaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgdG9tLmNsZWFyKCk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHRoaXMgaXMgYSBwYyBtYXAsIGF0dGFjaCBhbGwgaW5zdGFuY2VzCiAgICAg\nICAgYm9vbGVhbiBrZXlQQyA9IGZtZC5nZXRLZXkoKS5pc0RlY2xhcmVkVHlw\nZVBDKCk7CiAgICAgICAgYm9vbGVhbiB2YWxQQyA9IGZtZC5nZXRFbGVtZW50\nKCkuaXNEZWNsYXJlZFR5cGVQQygpOwogICAgICAgIGlmIChrZXlQQyB8fCB2\nYWxQQykKICAgICAgICAgICAgZnJtbSA9IGF0dGFjaE1hcChtYW5hZ2VyLCBm\ncm1tLCBzbSwgZm1kKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCB0aGUg\na2V5cyBpbiB0aGUgZnJvbSBtYXAgYXJlIGluIHRoZSB0d28gbWFwLCBhbmQK\nICAgICAgICAvLyB0aGF0IHRoZXkgaGF2ZSB0aGUgc2FtZSB2YWx1ZXMKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGkgPSBmcm1tLmVudHJ5U2V0KCkuaXRlcmF0\nb3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBl\nbnRyeSA9IChNYXAuRW50cnkpIGkubmV4dCgpOwogICAgICAgICAgICBpZiAo\nIXRvbS5jb250YWluc0tleShlbnRyeS5nZXRLZXkoKSkKICAgICAgICAgICAg\nICAgIHx8ICFlcXVhbHModG9tLmdldChlbnRyeS5nZXRLZXkoKSksIGVudHJ5\nLmdldFZhbHVlKCksIHZhbFBDKSkgewogICAgICAgICAgICAgICAgdG9tLnB1\ndChlbnRyeS5nZXRLZXkoKSwgZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZSBhbnkga2V5cyBp\nbiB0aGUgdG8gbWFwIHRoYXQgYXJlbid0IGluIHRoZSBmcm9tIG1hcAogICAg\nICAgIGlmICh0b20uc2l6ZSgpICE9IGZybW0uc2l6ZSgpKSB7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaSA9IHRvbS5rZXlTZXQoKS5pdGVyYXRvcigp\nOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGlmICghKGZybW0u\nY29udGFpbnNLZXkoaS5uZXh0KCkpKSkKICAgICAgICAgICAgICAgICAgICBp\nLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBzdXJlIGFsbCB0aGUgdmFsdWVzIGluIHRoZSBn\naXZlbiBtYXAgYXJlIGF0dGFjaGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nTWFwIGF0dGFjaE1hcChBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIE1hcCBvcmln\nLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgTWFwIG1hcCA9IG1hbmFnZXIuZ2V0UHJveHlN\nYW5hZ2VyKCkuY29weU1hcChvcmlnKTsKICAgICAgICBpZiAobWFwID09IG51\nbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtY29weWFibGUiLCBmbWQpKTsKCiAgICAgICAgVmFsdWVNZXRh\nRGF0YSBrZXltZCA9IGZtZC5nZXRLZXkoKTsKICAgICAgICBWYWx1ZU1ldGFE\nYXRhIHZhbG1kID0gZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICBpZiAoIWtl\neW1kLmlzRGVjbGFyZWRUeXBlUEMoKSAmJiAhdmFsbWQuaXNEZWNsYXJlZFR5\ncGVQQygpKQogICAgICAgICAgICByZXR1cm4gbWFwOwoKICAgICAgICAvLyBp\nZiB3ZSBoYXZlIHRvIHJlcGxhY2Uga2V5cywganVzdCBjbGVhciBhbmQgcmUt\nYWRkOyBvdGhlcndpc2UKICAgICAgICAvLyB3ZSBjYW4gdXNlIHRoZSBlbnRy\neSBzZXQgdG8gcmVzZXQgdGhlIHZhbHVlcyBvbmx5CiAgICAgICAgTWFwLkVu\ndHJ5IGVudHJ5OwogICAgICAgIGlmIChrZXltZC5pc0RlY2xhcmVkVHlwZVBD\nKCkpIHsKICAgICAgICAgICAgbWFwLmNsZWFyKCk7CiAgICAgICAgICAgIE9i\namVjdCBrZXksIHZhbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBvcmlnLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgICAgIGtleSA9IGVudHJ5LmdldEtleSgpOwog\nICAgICAgICAgICAgICAgaWYgKGtleW1kLmdldENhc2NhZGVBdHRhY2goKSA9\nPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAgICAg\nICAgICBrZXkgPSBnZXRSZWZlcmVuY2UobWFuYWdlciwga2V5LCBzbSwga2V5\nbWQpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIGtleSA9IG1hbmFnZXIuYXR0YWNoKGtleSwgbnVsbCwgc20sIGtleW1kLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICB2YWwgPSBlbnRyeS5nZXRWYWx1ZSgp\nOwogICAgICAgICAgICAgICAgaWYgKHZhbG1kLmlzRGVjbGFyZWRUeXBlUEMo\nKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh2YWxtZC5nZXRDYXNjYWRl\nQXR0YWNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHZhbCA9IGdldFJlZmVyZW5jZShtYW5hZ2Vy\nLCB2YWwsIHNtLCB2YWxtZCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBtYW5hZ2VyLmF0dGFjaCh2\nYWwsIG51bGwsIHNtLCB2YWxtZCwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgbWFwLnB1dChrZXksIHZhbCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBPYmplY3QgdmFs\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgICAgICBpZiAodmFsbWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVl\nTWV0YURhdGEuQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAgICAgIHZh\nbCA9IGdldFJlZmVyZW5jZShtYW5hZ2VyLCBlbnRyeS5nZXRWYWx1ZSgpLCBz\nbSwgdmFsbWQpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIHZhbCA9IG1hbmFnZXIuYXR0YWNoKGVudHJ5LmdldFZhbHVlKCks\nIG51bGwsIHNtLCB2YWxtZCwgCiAgICAgICAgICAgICAgICAgICAgICAgIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGVudHJ5LnNldFZhbHVlKHZhbCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1hcDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXR0YWNoZWQgdmVyc2lv\nbiBvZiB0aGUgPGNvZGU+ZnJtYTwvY29kZT4KICAgICAqIGFycmF5IGlmIGl0\nIGlzIGRpZmZlcmVudCB0aGFuIDxjb2RlPnRvYTwvY29kZT4uIElmIHRoZSBh\ncnJheXMKICAgICAqIHdpbGwgYmUgaWRlbnRpY2FsLCByZXR1cm5zIDxjb2Rl\nPnRvYTwvY29kZT4uCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IHJlcGxh\nY2VBcnJheShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIE9iamVjdCBmcm1hLAog\nICAgICAgIE9iamVjdCB0b2EsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZp\nZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaW50IGxlbiA9IEFycmF5Lmdl\ndExlbmd0aChmcm1hKTsKICAgICAgICBib29sZWFuIGRpZmYgPSB0b2EgPT0g\nbnVsbCB8fCBsZW4gIT0gQXJyYXkuZ2V0TGVuZ3RoKHRvYSk7CgogICAgICAg\nIC8vIHBvcHVsYXRlIGFuIGFycmF5IGNvcHkgb24gdGhlIGluaXRpYWwgYXNz\ndW1wdGlvbiB0aGF0IHRoZSBhcnJheQogICAgICAgIC8vIGlzIGRpcnR5CiAg\nICAgICAgT2JqZWN0IG5ld2EgPSBBcnJheS5uZXdJbnN0YW5jZShmbWQuZ2V0\nRWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICBsZW4p\nOwogICAgICAgIFZhbHVlTWV0YURhdGEgdm1kID0gZm1kLmdldEVsZW1lbnQo\nKTsKICAgICAgICBib29sZWFuIHBjID0gdm1kLmlzRGVjbGFyZWRUeXBlUEMo\nKTsKICAgICAgICBPYmplY3QgZWxlbTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGVsZW0gPSBBcnJheS5n\nZXQoZnJtYSwgaSk7CiAgICAgICAgICAgIGlmIChwYykgewogICAgICAgICAg\nICAgICAgaWYgKHZtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX05PTkUpCiAgICAgICAgICAgICAgICAgICAgZWxlbSA9\nIGdldFJlZmVyZW5jZShtYW5hZ2VyLCBlbGVtLCBzbSwgdm1kKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBlbGVtID0gbWFu\nYWdlci5hdHRhY2goZWxlbSwgbnVsbCwgc20sIHZtZCwgZmFsc2UpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGRpZmYgPSBkaWZmIHx8ICFlcXVhbHMo\nZWxlbSwgQXJyYXkuZ2V0KHRvYSwgaSksIHBjKTsKICAgICAgICAgICAgQXJy\nYXkuc2V0KG5ld2EsIGksIGVsZW0pOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gKGRpZmYpID8gbmV3YSA6IHRvYTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiBvYmplY3RzIGFyZSBlcXVhbC4g\nUENzIGFyZSBjb21wYXJlZCBmb3IKICAgICAqIG9uIEpWTSBpZGVudGl0eS4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBlcXVhbHMoT2Jq\nZWN0IGEsIE9iamVjdCBiLCBib29sZWFuIHBjKSB7CiAgICAgICAgaWYgKGEg\nPT0gYikKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKHBj\nIHx8IGEgPT0gbnVsbCB8fCBiID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCQlyZXR1cm4gYS5lcXVhbHMgKGIpOwoJfQp9Cg==\n","encoding":"base64"}

