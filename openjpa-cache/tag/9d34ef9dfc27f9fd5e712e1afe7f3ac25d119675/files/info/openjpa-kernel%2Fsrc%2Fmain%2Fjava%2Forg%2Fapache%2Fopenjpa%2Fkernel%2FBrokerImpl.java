{"sha":"f441052d283eee2c717e413f068ea50f57ba0eab","node_id":"MDQ6QmxvYjIwNjM2NDpmNDQxMDUyZDI4M2VlZTJjNzE3ZTQxM2YwNjhlYTUwZjU3YmEwZWFi","size":161884,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f441052d283eee2c717e413f068ea50f57ba0eab","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07Cmlt\ncG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3ND\nb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0Q29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQml0U2V0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51\ndGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZEhhc2hTZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7CmltcG9y\ndCBqYXZheC50cmFuc2FjdGlvbi5TeW5jaHJvbml6YXRpb247CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLml0ZXJhdG9ycy5JdGVy\nYXRvckNoYWluOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLm1hcC5JZGVudGl0eU1hcDsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9u\ncy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmNvbGxlY3Rpb25zLnNldC5NYXBCYWNrZWRTZXQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5Db21wYXRpYmlsaXR5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRhdGFD\nYWNoZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lZS5NYW5hZ2VkUnVu\ndGltZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVn\naXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJz\naXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZl\nbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlvbkV2ZW50\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5zYWN0aW9u\nRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5leHBzLkV4cHJlc3Npb25QYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hNYXA7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNldDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5sb2Nrcy5SZWVudHJhbnRM\nb2NrOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0\nYVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5T\nZXF1ZW5jZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0ZUV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk5vVHJhbnNhY3Rpb25FeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RF\neGlzdHNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRv\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0\nZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nc2VyRXhjZXB0aW9uOwoKLyoqCiAqIENvbmNyZXRlIHtAbGluayBCcm9rZXJ9\nLiBUaGUgYnJva2VyIGhhbmRsZXMgb2JqZWN0LWxldmVsIGJlaGF2aW9yLAog\nKiBidXQgbGVhdmVzIGFsbCBpbnRlcmFjdGlvbiB3aXRoIHRoZSBkYXRhIHN0\nb3JlIHRvIGEge0BsaW5rIFN0b3JlTWFuYWdlcn0KICogdGhhdCBtdXN0IGJl\nIHN1cHBsaWVkIGF0IGluaXRpYWxpemF0aW9uLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIEJyb2tlckltcGwKICAgIGltcGxl\nbWVudHMgQnJva2VyLCBGaW5kQ2FsbGJhY2tzLCBDbG9uZWFibGUsIFNlcmlh\nbGl6YWJsZSB7CgogICAgLyoqCiAgICAgKiBJbmNyZW1lbnRhbCBmbHVzaC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hf\nSU5DID0gMDsKCiAgICAvKioKICAgICAqIEZsdXNoIGluIHByZXBhcmF0aW9u\nIG9mIGNvbW1pdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5h\nbCBpbnQgRkxVU0hfQ09NTUlUID0gMTsKCiAgICAvKioKICAgICAqIEZsdXNo\nIHRvIGNoZWNrIGNvbnNpc3RlbmN5IG9mIGNhY2hlLCB0aGVuIGltbWVkaWF0\nZWx5IHJvbGxiYWNrIGNoYW5nZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBz\ndGF0aWMgZmluYWwgaW50IEZMVVNIX1JPTExCQUNLID0gMjsKCiAgICAvKioK\nICAgICAqIFJ1biBwZXJzaXN0ZW5jZS1ieS1yZWFjaGFiaWxpdHkgYW5kIG90\naGVyIGZsdXNoLXRpbWUgb3BlcmF0aW9ucyB3aXRob3V0CiAgICAgKiBhY2Nl\nc3NpbmcgdGhlIGRhdGFiYXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIGludCBGTFVTSF9MT0dJQ0FMID0gMzsKCiAgICBzdGF0aWMg\nZmluYWwgaW50IFNUQVRVU19JTklUID0gMDsKICAgIHN0YXRpYyBmaW5hbCBp\nbnQgU1RBVFVTX1RSQU5TSUVOVCA9IDE7CiAgICBzdGF0aWMgZmluYWwgaW50\nIFNUQVRVU19PSURfQVNTSUdOID0gMjsKICAgIHN0YXRpYyBmaW5hbCBpbnQg\nU1RBVFVTX0NPTU1JVF9ORVcgPSAzOwoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0FDVElWRSA9IDIgPDwgMDsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBGTEFHX1NUT1JFX0FDVElWRSA9IDIgPDwgMTsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0NMT1NFX0lOVk9LRUQg\nPSAyIDw8IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19Q\nUkVTVE9SSU5HID0gMiA8PCAzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEZMQUdfREVSRUZERUxFVElORyA9IDIgPDwgNDsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX0ZMVVNISU5HID0gMiA8PCA1OwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfU1RPUkVfRkxVU0hJTkcg\nPSAyIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19G\nTFVTSEVEID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50\nIEZMQUdfRkxVU0hfUkVRVUlSRUQgPSAyIDw8IDg7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRkxBR19SRU1PVEVfTElTVEVORVIgPSAyIDw8IDk7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19SRVRBSU5FRF9D\nT05OID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1RSQU5TX0VORElORyA9IDIgPDwgMTE7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgT2JqZWN0W10gRU1QVFlfT0JKRUNUUyA9IG5ldyBPYmplY3Rb\nMF07CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2Mg\nPQogICAgICAgIExvY2FsaXplci5mb3JQYWNrYWdlKEJyb2tlckltcGwuY2xh\nc3MpOwoKICAgIC8vCXRoZSBzdG9yZSBtYW5hZ2VyIGluIHVzZTsgdGhpcyBt\nYXkgYmUgYSBkZWNvcmF0b3Igc3VjaCBhcyBhCiAgICAvLwlkYXRhIGNhY2hl\nIHN0b3JlIG1hbmFnZXIgYXJvdW5kIHRoZSBuYXRpdmUgc3RvcmUgbWFuYWdl\ncgogICAgcHJpdmF0ZSB0cmFuc2llbnQgRGVsZWdhdGluZ1N0b3JlTWFuYWdl\nciBfc3RvcmUgPSBudWxsOwoKICAgIHByaXZhdGUgRmV0Y2hDb25maWd1cmF0\naW9uIF9mYyA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfdXNlciA9IG51\nbGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFzcyA9IG51bGw7CgogICAgLy8g\ndGhlc2UgbXVzdCBiZSByZWJ1aWx0IGJ5IHRoZSBmYWNhZGUgbGF5ZXIgZHVy\naW5nIGl0cyBkZXNlcmlhbGl6YXRpb24KICAgIHByaXZhdGUgdHJhbnNpZW50\nIExvZyBfbG9nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IENvbXBh\ndGliaWxpdHkgX2NvbXBhdCA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVu\ndCBNYW5hZ2VkUnVudGltZSBfcnVudGltZSA9IG51bGw7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBMb2NrTWFuYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgSW52ZXJzZU1hbmFnZXIgX2ltID0gbnVsbDsKICAgIHBy\naXZhdGUgdHJhbnNpZW50IFJlZW50cmFudExvY2sgX2xvY2sgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgT3BDYWxsYmFja3MgX2NhbGwgPSBudWxs\nOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgUnVudGltZUV4Y2VwdGlvblRyYW5z\nbGF0b3IgX2V4dHJhbnMgPSBudWxsOwoKICAgIC8vIHJlZiB0byBwcm9kdWNp\nbmcgZmFjdG9yeSBhbmQgY29uZmlndXJhdGlvbgogICAgcHJpdmF0ZSB0cmFu\nc2llbnQgQWJzdHJhY3RCcm9rZXJGYWN0b3J5IF9mYWN0b3J5ID0gbnVsbDsK\nICAgIHByaXZhdGUgdHJhbnNpZW50IE9wZW5KUEFDb25maWd1cmF0aW9uIF9j\nb25mID0gbnVsbDsKCiAgICAvLyBjYWNoZSBjbGFzcyBsb2FkZXIgYXNzb2Np\nYXRlZCB3aXRoIHRoZSBicm9rZXIKICAgIHByaXZhdGUgdHJhbnNpZW50IENs\nYXNzTG9hZGVyIF9sb2FkZXIgPSBudWxsOwoKICAgIC8vIHVzZXIgc3RhdGUK\nICAgIHByaXZhdGUgU3luY2hyb25pemF0aW9uIF9zeW5jID0gbnVsbDsKICAg\nIHByaXZhdGUgTWFwIF91c2VyT2JqZWN0cyA9IG51bGw7CgogICAgLy8gbWFu\nYWdlZCBvYmplY3QgY2FjaGVzCiAgICBwcml2YXRlIE1hbmFnZWRDYWNoZSBf\nY2FjaGUgPSBudWxsOwogICAgcHJpdmF0ZSBUcmFuc2FjdGlvbmFsQ2FjaGUg\nX3RyYW5zQ2FjaGUgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX3RyYW5zQWRk\naXRpb25zID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9kZXJlZkNhY2hlID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9kZXJlZkFkZGl0aW9ucyA9IG51bGw7\nCgogICAgLy8gdGhlc2UgYXJlIHVzZWQgZm9yIG1ldGhvZC1pbnRlcm5hbCBz\ndGF0ZSBvbmx5CiAgICBwcml2YXRlIHRyYW5zaWVudCBNYXAgX2xvYWRpbmcg\nPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgU2V0IF9vcGVyYXRpbmcg\nPSBudWxsOwoKICAgIHByaXZhdGUgU2V0IF9wZXJzaXN0ZWRDbHNzID0gbnVs\nbDsKICAgIHByaXZhdGUgU2V0IF91cGRhdGVkQ2xzcyA9IG51bGw7CiAgICBw\ncml2YXRlIFNldCBfZGVsZXRlZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBT\nZXQgX3BlbmRpbmcgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgZmluZEFsbERl\ncHRoID0gMDsKCiAgICAvLyB0cmFjayBpbnN0YW5jZXMgdGhhdCBiZWNvbWUg\ndHJhbnNhY3Rpb25hbCBhZnRlciB0aGUgZmlyc3Qgc2F2ZXBvaW50CiAgICAv\nLyAodGhlIGZpcnN0IHVzZXMgdGhlIHRyYW5zYWN0aW9uYWwgY2FjaGUpCiAg\nICBwcml2YXRlIFNldCBfc2F2ZXBvaW50Q2FjaGUgPSBudWxsOwogICAgcHJp\ndmF0ZSBMaW5rZWRNYXAgX3NhdmVwb2ludHMgPSBudWxsOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgU2F2ZXBvaW50TWFuYWdlciBfc3BtID0gbnVsbDsKCiAg\nICAvLyB0cmFjayBvcGVuIHF1ZXJpZXMgYW5kIGV4dGVudHMgc28gd2UgY2Fu\nIGZyZWUgdGhlaXIgcmVzb3VyY2VzIG9uIGNsb3NlCiAgICBwcml2YXRlIHRy\nYW5zaWVudCBSZWZlcmVuY2VIYXNoU2V0IF9xdWVyaWVzID0gbnVsbDsKICAg\nIHByaXZhdGUgdHJhbnNpZW50IFJlZmVyZW5jZUhhc2hTZXQgX2V4dGVudHMg\nPSBudWxsOwoKICAgIC8vIHRyYWNrIG9wZXJhdGlvbiBzdGFjayBkZXB0aC4g\nVHJhbnNpZW50IGJlY2F1c2Ugb3BlcmF0aW9ucyBjYW5ub3QKICAgIC8vIHNw\nYW4gc2VyaWFsaXphdGlvbi4KICAgIHByaXZhdGUgdHJhbnNpZW50IGludCBf\nb3BlcmF0aW9uQ291bnQgPSAwOwoKICAgIC8vIG9wdGlvbnMKICAgIHByaXZh\ndGUgYm9vbGVhbiBfbm9udHJhbnNSZWFkID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX25vbnRyYW5zV3JpdGUgPSBmYWxzZTsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfcmV0YWluU3RhdGUgPSBmYWxzZTsKICAgIHByaXZhdGUgaW50\nIF9hdXRvQ2xlYXIgPSBDTEVBUl9EQVRBU1RPUkU7CiAgICBwcml2YXRlIGlu\ndCBfcmVzdG9yZVN0YXRlID0gUkVTVE9SRV9JTU1VVEFCTEU7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX29wdGltaXN0aWMgPSBmYWxzZTsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfaWdub3JlQ2hhbmdlcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9tdWx0aXRocmVhZGVkID0gZmFsc2U7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX21hbmFnZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nc3luY01hbmFnZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgaW50IF9jb25uUmV0\nYWluTW9kZSA9IENPTk5fUkVUQUlOX0RFTUFORDsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfZXZpY3REYXRhQ2FjaGUgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfcG9wdWxhdGVEYXRhQ2FjaGUgPSB0cnVlOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9sYXJnZVRyYW5zYWN0aW9uID0gZmFsc2U7CiAgICBwcml2YXRl\nIGludCBfYXV0b0RldGFjaCA9IDA7CiAgICBwcml2YXRlIGludCBfZGV0YWNo\nU3RhdGUgPSBERVRBQ0hfTE9BREVEOwogICAgcHJpdmF0ZSBib29sZWFuIF9k\nZXRhY2hlZE5ldyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX29yZGVy\nRGlydHkgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfc3VwcHJlc3NC\nYXRjaE9MRUxvZ2dpbmcgPSBmYWxzZTsKCiAgICAvLyBzdGF0dXMKICAgIHBy\naXZhdGUgaW50IF9mbGFncyA9IDA7CgogICAgLy8gdGhpcyBpcyBub3QgaW4g\nc3RhdHVzIGJlY2F1c2UgaXQgc2hvdWxkIG5vdCBiZSBzZXJpYWxpemVkCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9pc1NlcmlhbGl6aW5nID0g\nZmFsc2U7CgogICAgLy8gdHJhbnNpZW50IGJlY2F1c2UgY2xvc2VkIGJyb2tl\ncnMgY2FuJ3QgYmUgc2VyaWFsaXplZAogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIHRyYW5zaWVu\ndCBSdW50aW1lRXhjZXB0aW9uIF9jbG9zZWRFeGNlcHRpb24gPSBudWxsOwoK\nICAgIC8vIGV2ZW50IG1hbmFnZXJzCiAgICBwcml2YXRlIFRyYW5zYWN0aW9u\nRXZlbnRNYW5hZ2VyIF90cmFuc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICBw\ncml2YXRlIGludCBfdHJhbnNDYWxsYmFja01vZGUgPSAwOwogICAgcHJpdmF0\nZSBMaWZlY3ljbGVFdmVudE1hbmFnZXIgX2xpZmVFdmVudE1hbmFnZXIgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnQgX2xpZmVDYWxsYmFja01vZGUgPSAwOwoK\nICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX2luaXRpYWxpemVXYXNJ\nbnZva2VkID0gZmFsc2U7CiAgICBwcml2YXRlIExpbmtlZExpc3QgX2ZjczsK\nCiAgICAvKioKICAgICAqIFNldCB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlcidz\nIGF1dGhlbnRpY2F0aW9uLiBUaGlzIGlzIHRoZSBmaXJzdAogICAgICogbWV0\naG9kIGNhbGxlZCBhZnRlciBjb25zdHJ1Y3Rpb24uCiAgICAgKgogICAgICog\nQHBhcmFtIHVzZXIgdGhlIHVzZXJuYW1lIHRoaXMgYnJva2VyIHJlcHJlc2Vu\ndHM7IHVzZWQgd2hlbiBwb29saW5nCiAgICAgKiBicm9rZXJzIHRvIG1ha2Ug\nc3VyZSB0aGF0IGEgcmVxdWVzdCB0byB0aGUgZmFjdG9yeSBmb3IKICAgICAq\nIGEgY29ubmVjdGlvbiB3aXRoIGFuIGV4cGxpY2l0IHVzZXIgaXMgZGVsZWdh\ndGVkIHRvIGEgc3VpdGFibGUgYnJva2VyCiAgICAgKiBAcGFyYW0gcGFzcyB0\naGUgcGFzc3dvcmQgZm9yIHRoZSBhYm92ZSB1c2VyCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEF1dGhlbnRpY2F0aW9uKFN0cmluZyB1c2VyLCBTdHJp\nbmcgcGFzcykgewogICAgICAgIF91c2VyID0gdXNlcjsKICAgICAgICBfcGFz\ncyA9IHBhc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHRo\nZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQK\nICAgICAqIGF1dG9tYXRpY2FsbHkgYnkgdGhlIGZhY3RvcnkgYmVmb3JlIHVz\nZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZmFjdG9yeSB0aGUgZmFjdG9yeSB1\nc2VkIHRvIGNyZWF0ZSB0aGlzIGJyb2tlcgogICAgICogQHBhcmFtIHNtIGEg\nY29uY3JldGUgU3RvcmVNYW5hZ2VyIGltcGxlbWVudGF0aW9uIHRvCiAgICAg\nKiBoYW5kbGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgZGF0YSBzdG9yZQogICAg\nICogQHBhcmFtIG1hbmFnZWQgdGhlIHRyYW5zYWN0aW9uIG1vZGUKICAgICAq\nIEBwYXJhbSBjb25uTW9kZSB0aGUgY29ubmVjdGlvbiByZXRhaW4gbW9kZQog\nICAgICogQHBhcmFtIGZyb21EZXNlcmlhbGl6YXRpb24gd2hldGhlciB0aGlz\nIGNhbGwgaGFwcGVuZWQgYmVjYXVzZSBvZiBhCiAgICAgKiBkZXNlcmlhbGl6\nYXRpb24gb3IgY3JlYXRpb24gb2YgYSBuZXcgQnJva2VySW1wbC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZShBYnN0cmFjdEJyb2tlckZh\nY3RvcnkgZmFjdG9yeSwKICAgICAgICBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2Vy\nIHNtLCBib29sZWFuIG1hbmFnZWQsIGludCBjb25uTW9kZSwKICAgICAgICBi\nb29sZWFuIGZyb21EZXNlcmlhbGl6YXRpb24pIHsKICAgICAgICBfaW5pdGlh\nbGl6ZVdhc0ludm9rZWQgPSB0cnVlOwogICAgICAgIF9sb2FkZXIgPSAoQ2xh\nc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xhc3NMb2FkZXJB\nY3Rpb24oKSk7CiAgICAgICAgaWYgKCFmcm9tRGVzZXJpYWxpemF0aW9uKQog\nICAgICAgICAgICBfY29uZiA9IGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigp\nOwogICAgICAgIF9jb21wYXQgPSBfY29uZi5nZXRDb21wYXRpYmlsaXR5SW5z\ndGFuY2UoKTsKICAgICAgICBfZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICAgICAg\nX2xvZyA9IF9jb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0df\nUlVOVElNRSk7CiAgICAgICAgaWYgKCFmcm9tRGVzZXJpYWxpemF0aW9uKQog\nICAgICAgICAgICBfY2FjaGUgPSBuZXcgTWFuYWdlZENhY2hlKHRoaXMpOwog\nICAgICAgIGluaXRpYWxpemVPcGVyYXRpbmdTZXQoKTsKICAgICAgICBfY29u\nblJldGFpbk1vZGUgPSBjb25uTW9kZTsKICAgICAgICBfbWFuYWdlZCA9IG1h\nbmFnZWQ7CiAgICAgICAgaWYgKG1hbmFnZWQpCiAgICAgICAgICAgIF9ydW50\naW1lID0gX2NvbmYuZ2V0TWFuYWdlZFJ1bnRpbWVJbnN0YW5jZSgpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgX3J1bnRpbWUgPSBuZXcgTG9jYWxNYW5h\nZ2VkUnVudGltZSh0aGlzKTsKCiAgICAgICAgaWYgKCFmcm9tRGVzZXJpYWxp\nemF0aW9uKSB7CiAgICAgICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyID0gbmV3\nIExpZmVjeWNsZUV2ZW50TWFuYWdlcigpOwogICAgICAgICAgICBfdHJhbnNF\ndmVudE1hbmFnZXIgPSBuZXcgVHJhbnNhY3Rpb25FdmVudE1hbmFnZXIoKTsK\nICAgICAgICAgICAgaW50IGNtb2RlID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBv\nc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRh\nRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCk7CiAg\nICAgICAgICAgIHNldExpZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNt\nb2RlKTsKICAgICAgICAgICAgc2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxi\nYWNrTW9kZShjbW9kZSk7CgogICAgICAgICAgICAvLyBzZXR1cCBkZWZhdWx0\nIG9wdGlvbnMKICAgICAgICAgICAgX2ZhY3RvcnkuY29uZmlndXJlQnJva2Vy\nKHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFrZSBzdXJlIHRvIGRv\nIHRoaXMgYWZ0ZXIgY29uZmlndXJpbmcgYnJva2VyIHNvIHRoYXQgc3RvcmUg\nbWFuYWdlcgogICAgICAgIC8vIGNhbiBsb29rIHRvIGJyb2tlciBjb25maWd1\ncmF0aW9uOyB3ZSBzZXQgYm90aCBzdG9yZSBhbmQgbG9jayBtYW5hZ2Vycwog\nICAgICAgIC8vIGJlZm9yZSBpbml0aWFsaXppbmcgdGhlbSBiZWNhdXNlIHRo\nZXkgbWF5IGVhY2ggdHJ5IHRvIGFjY2VzcyB0aGUKICAgICAgICAvLyBvdGhl\nciBpbiB0aGllciBpbml0aWFsaXphdGlvbgogICAgICAgIF9zdG9yZSA9IHNt\nOwogICAgICAgIF9sbSA9IF9jb25mLm5ld0xvY2tNYW5hZ2VySW5zdGFuY2Uo\nKTsKICAgICAgICBfaW0gPSBfY29uZi5uZXdJbnZlcnNlTWFuYWdlckluc3Rh\nbmNlKCk7CiAgICAgICAgX3NwbSA9IF9jb25mLmdldFNhdmVwb2ludE1hbmFn\nZXJJbnN0YW5jZSgpOwogICAgICAgIF9zdG9yZS5zZXRDb250ZXh0KHRoaXMp\nOwogICAgICAgIF9sbS5zZXRDb250ZXh0KHRoaXMpOwoKICAgICAgICBpZiAo\nX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX0FMV0FZUykKICAgICAg\nICAgICAgcmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgIGlmICghZnJvbURl\nc2VyaWFsaXphdGlvbikgewogICAgICAgICAgICBfZmMgPSBfc3RvcmUubmV3\nRmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIF9mYy5zZXRDb250\nZXh0KHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gc3luY2ggd2l0aCB0\naGUgZ2xvYmFsIHRyYW5zYWN0aW9uIGluIHByb2dyZXNzLCBpZiBhbnkKICAg\nICAgICBpZiAoX2ZhY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24o\ndGhpcywgZmFsc2UpKQogICAgICAgICAgICBiZWdpbkludGVybmFsKCk7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemVPcGVyYXRpbmdTZXQo\nKSB7CiAgICAgICAgX29wZXJhdGluZyA9IE1hcEJhY2tlZFNldC5kZWNvcmF0\nZShuZXcgSWRlbnRpdHlNYXAoKSk7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogR2V0cyB0aGUgdW5tb2RpZmlhYmxlIHNldCBvZiBpbnN0YW5jZXMgYmVp\nbmcgb3BlcmF0ZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZXQgZ2V0T3Bl\ncmF0aW5nU2V0KCkgewogICAgCXJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlm\naWFibGVTZXQoX29wZXJhdGluZyk7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBjbG9uZSgpCiAgICAgICAgdGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoX2luaXRpYWxpemVXYXNJbnZva2VkKQog\nICAgICAgICAgICB0aHJvdyBuZXcgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRp\nb24oKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLmNsb25lKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEge0BsaW5rIE1hcH0gdG8gYmUgdXNlZCBmb3IgdGhlIHByaW1hcnkg\nbWFuYWdlZCBvYmplY3QgY2FjaGUuCiAgICAgKiBNYXBzIG9pZHMgdG8gc3Rh\ndGUgbWFuYWdlcnMuIEJ5IGRlZmF1bHQsIHRoaXMgY3JlYXRlcyBhCiAgICAg\nKiB7QGxpbmsgUmVmZXJlbmNlTWFwfSB3aXRoIHNvZnQgdmFsdWVzLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgTWFwIG5ld01hbmFnZWRPYmplY3RDYWNoZSgp\nIHsKICAgICAgICByZXR1cm4gbmV3IFJlZmVyZW5jZUhhc2hNYXAoUmVmZXJl\nbmNlTWFwLkhBUkQsIFJlZmVyZW5jZU1hcC5TT0ZUKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBs\nZW1lbnRhdGlvbiBvZiBTdG9yZUNvbnRleHQKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgQnJva2VyIGdldEJy\nb2tlcigpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vLwogICAgLy8gUHJvcGVydGllcwogICAgLy8vLy8vLy8vLy8v\nLy8KCiAgICBwdWJsaWMgdm9pZCBzZXRJbXBsaWNpdEJlaGF2aW9yKE9wQ2Fs\nbGJhY2tzIGNhbGwsCiAgICAgICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0\nb3IgZXgpIHsKICAgICAgICBpZiAoX2NhbGwgPT0gbnVsbCkKICAgICAgICAg\nICAgX2NhbGwgPSBjYWxsOwogICAgICAgIGlmIChfZXh0cmFucyA9PSBudWxs\nKQogICAgICAgICAgICBfZXh0cmFucyA9IGV4OwogICAgfQoKICAgIFJ1bnRp\nbWVFeGNlcHRpb25UcmFuc2xhdG9yIGdldEluc3RhbmNlRXhjZXB0aW9uVHJh\nbnNsYXRvcigpIHsKICAgICAgICByZXR1cm4gKF9vcGVyYXRpb25Db3VudCA9\nPSAwKSA/IF9leHRyYW5zIDogbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgQnJv\na2VyRmFjdG9yeSBnZXRCcm9rZXJGYWN0b3J5KCkgewogICAgICAgIHJldHVy\nbiBfZmFjdG9yeTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2Nv\nbmY7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBnZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9mYzsKICAg\nIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHB1c2hGZXRjaENv\nbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgaWYgKF9mY3MgPT0gbnVsbCkKICAg\nICAgICAgICAgX2ZjcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgX2Zj\ncy5hZGQoX2ZjKTsKICAgICAgICBfZmMgPSAoRmV0Y2hDb25maWd1cmF0aW9u\nKSBfZmMuY2xvbmUoKTsKICAgICAgICByZXR1cm4gX2ZjOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHBvcEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAg\nICBpZiAoX2ZjcyA9PSBudWxsIHx8IF9mY3MuaXNFbXB0eSgpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZmV0Y2gt\nY29uZmlndXJhdGlvbi1zdGFjay1lbXB0eSIpKTsKICAgICAgICBfZmMgPSAo\nRmV0Y2hDb25maWd1cmF0aW9uKSBfZmNzLnJlbW92ZUxhc3QoKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGdldENvbm5lY3Rpb25SZXRhaW5Nb2RlKCkgewog\nICAgICAgIHJldHVybiBfY29ublJldGFpbk1vZGU7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNNYW5hZ2VkKCkgewogICAgICAgIHJldHVybiBfbWFu\nYWdlZDsKICAgIH0KCiAgICBwdWJsaWMgTWFuYWdlZFJ1bnRpbWUgZ2V0TWFu\nYWdlZFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIF9ydW50aW1lOwogICAg\nfQoKICAgIHB1YmxpYyBDbGFzc0xvYWRlciBnZXRDbGFzc0xvYWRlcigpIHsK\nICAgICAgICByZXR1cm4gX2xvYWRlcjsKICAgIH0KCiAgICBwdWJsaWMgRGVs\nZWdhdGluZ1N0b3JlTWFuYWdlciBnZXRTdG9yZU1hbmFnZXIoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdG9yZTsKICAgIH0KCiAgICBwdWJsaWMgTG9ja01hbmFn\nZXIgZ2V0TG9ja01hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sbTsKICAg\nIH0KCiAgICBwdWJsaWMgSW52ZXJzZU1hbmFnZXIgZ2V0SW52ZXJzZU1hbmFn\nZXIoKSB7CiAgICAgICAgcmV0dXJuIF9pbTsKICAgIH0KCiAgICBwdWJsaWMg\nU3RyaW5nIGdldENvbm5lY3Rpb25Vc2VyTmFtZSgpIHsKICAgICAgICByZXR1\ncm4gX3VzZXI7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0\naW9uUGFzc3dvcmQoKSB7CiAgICAgICAgcmV0dXJuIF9wYXNzOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGdldE11bHRpdGhyZWFkZWQoKSB7CiAgICAg\nICAgcmV0dXJuIF9tdWx0aXRocmVhZGVkOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldE11bHRpdGhyZWFkZWQoYm9vbGVhbiBtdWx0aXRocmVhZGVkKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9tdWx0aXRocmVhZGVk\nID0gbXVsdGl0aHJlYWRlZDsKICAgICAgICBpZiAobXVsdGl0aHJlYWRlZCAm\nJiBfbG9jayA9PSBudWxsKQogICAgICAgICAgICBfbG9jayA9IG5ldyBSZWVu\ndHJhbnRMb2NrKCk7CiAgICAgICAgZWxzZSBpZiAoIW11bHRpdGhyZWFkZWQp\nCiAgICAgICAgICAgIF9sb2NrID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRJZ25vcmVDaGFuZ2VzKCkgewogICAgICAgIHJldHVybiBf\naWdub3JlQ2hhbmdlczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25v\ncmVDaGFuZ2VzKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIF9pZ25vcmVDaGFuZ2VzID0gdmFsOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGdldE5vbnRyYW5zYWN0aW9uYWxSZWFkKCkgewogICAg\nICAgIHJldHVybiBfbm9udHJhbnNSZWFkOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldE5vbnRyYW5zYWN0aW9uYWxSZWFkKGJvb2xlYW4gdmFsKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19QUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIp\nKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRz\nIGl0CiAgICAgICAgaWYgKHZhbCAmJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9u\ncygpLmNvbnRhaW5zCiAgICAgICAgICAgIChfY29uZi5PUFRJT05fTk9OVFJB\nTlNfUkVBRCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJub250cmFucy1y\nZWFkLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgIF9ub250cmFuc1JlYWQg\nPSB2YWw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJhbnNh\nY3Rpb25hbFdyaXRlKCkgewogICAgICAgIHJldHVybiBfbm9udHJhbnNXcml0\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFs\nV3JpdGUoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJp\nbGxlZ2FsLW9wLWluLXByZXN0b3JlIikpOwoKICAgICAgICBfbm9udHJhbnNX\ncml0ZSA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcHRp\nbWlzdGljKCkgewogICAgICAgIHJldHVybiBfb3B0aW1pc3RpYzsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRPcHRpbWlzdGljKGJvb2xlYW4gdmFsKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2ZSIsCiAg\nICAgICAgICAgICAgICAiT3B0aW1pc3RpYyIpKTsKCiAgICAgICAgLy8gbWFr\nZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0CiAgICAgICAgaWYgKHZh\nbCAmJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25m\nLk9QVElPTl9PUFRJTUlTVElDKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAo\nIm9wdGltaXN0aWMtbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAgX29wdGlt\naXN0aWMgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRSZXN0b3Jl\nU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXN0b3JlU3RhdGU7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0UmVzdG9yZVN0YXRlKGludCB2YWwpIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidHJhbnMtYWN0aXZlIiwKICAg\nICAgICAgICAgICAgICJSZXN0b3JlIikpOwoKICAgICAgICBfcmVzdG9yZVN0\nYXRlID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFJldGFp\nblN0YXRlKCkgewogICAgICAgIHJldHVybiBfcmV0YWluU3RhdGU7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0UmV0YWluU3RhdGUoYm9vbGVhbiB2YWwp\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbGxlZ2FsLW9wLWluLXByZXN0\nb3JlIikpOwogICAgICAgIF9yZXRhaW5TdGF0ZSA9IHZhbDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldEF1dG9DbGVhcigpIHsKICAgICAgICByZXR1cm4g\nX2F1dG9DbGVhcjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQ2xl\nYXIoaW50IHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBf\nYXV0b0NsZWFyID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0QXV0\nb0RldGFjaCgpIHsKICAgICAgICByZXR1cm4gX2F1dG9EZXRhY2g7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFjaChpbnQgZGV0YWNoRmxh\nZ3MpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2F1dG9EZXRh\nY2ggPSBkZXRhY2hGbGFnczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRB\ndXRvRGV0YWNoKGludCBkZXRhY2hGbGFnLCBib29sZWFuIG9uKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChvbikKICAgICAgICAgICAg\nX2F1dG9EZXRhY2ggfD0gZGV0YWNoRmxhZzsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9hdXRvRGV0YWNoICY9IH5kZXRhY2hGbGFnOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0RGV0YWNoU3RhdGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9kZXRhY2hTdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREZXRh\nY2hTdGF0ZShpbnQgbW9kZSkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBfZGV0YWNoU3RhdGUgPSBtb2RlOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRGV0YWNoZWROZXcoKSB7CiAgICAgICAgcmV0dXJuIF9kZXRh\nY2hlZE5ldzsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hlZE5l\ndyhib29sZWFuIGlzTmV3KSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIF9kZXRhY2hlZE5ldyA9IGlzTmV3OwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldFN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9ucygpIHsKICAg\nICAgICByZXR1cm4gX3N5bmNNYW5hZ2VkOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9ucyhib29sZWFuIHN5\nbmMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX3N5bmNNYW5h\nZ2VkID0gc3luYzsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRFdmlj\ndEZyb21EYXRhQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9ldmljdERhdGFD\nYWNoZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFdmljdEZyb21EYXRh\nQ2FjaGUoYm9vbGVhbiBldmljdCkgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBfZXZpY3REYXRhQ2FjaGUgPSBldmljdDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXRQb3B1bGF0ZURhdGFDYWNoZSgpIHsKICAgICAg\nICByZXR1cm4gX3BvcHVsYXRlRGF0YUNhY2hlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFBvcHVsYXRlRGF0YUNhY2hlKGJvb2xlYW4gY2FjaGUpIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX3BvcHVsYXRlRGF0YUNh\nY2hlID0gY2FjaGU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFj\na0NoYW5nZXNCeVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9sYXJnZVRyYW5z\nYWN0aW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFRyYWNrQ2hhbmdl\nc0J5VHlwZShib29sZWFuIGxhcmdlVHJhbnNhY3Rpb24pIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgX2xhcmdlVHJhbnNhY3Rpb24gPSBsYXJn\nZVRyYW5zYWN0aW9uOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VXNl\nck9iamVjdChPYmplY3Qga2V5KSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoX3Vz\nZXJPYmplY3RzID09IG51bGwpID8gbnVsbCA6IF91c2VyT2JqZWN0cy5nZXQo\na2V5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBw\ndXRVc2VyT2JqZWN0KE9iamVjdCBrZXksIE9iamVjdCB2YWwpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIChfdXNlck9iamVjdHMgPT0gbnVsbCkgPyBudWxsIDogX3VzZXJPYmplY3Rz\nLnJlbW92ZShrZXkpOwoKICAgICAgICAgICAgaWYgKF91c2VyT2JqZWN0cyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX3VzZXJPYmplY3RzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICAgICAgcmV0dXJuIF91c2VyT2JqZWN0cy5wdXQo\na2V5LCB2YWwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8v\nCiAgICAvLyBFdmVudHMKICAgIC8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9p\nZCBhZGRMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIsIENsYXNz\nW10gY2xhc3NlcykgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBfbGlmZUV2ZW50TWFuYWdlci5h\nZGRMaXN0ZW5lcihsaXN0ZW5lciwgY2xhc3Nlcyk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZUxpZmVjeWNsZUxpc3RlbmVy\nKE9iamVjdCBsaXN0ZW5lcikgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZh\nbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfbGlmZUV2ZW50TWFu\nYWdlci5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcik7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxs\nYmFja01vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9saWZlQ2FsbGJhY2tNb2Rl\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExpZmVjeWNsZUxpc3RlbmVy\nQ2FsbGJhY2tNb2RlKGludCBtb2RlKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9saWZlQ2Fs\nbGJhY2tNb2RlID0gbW9kZTsKICAgICAgICAgICAgX2xpZmVFdmVudE1hbmFn\nZXIuc2V0RmFpbEZhc3QoKG1vZGUgJiBDQUxMQkFDS19GQUlMX0ZBU1QpICE9\nIDApOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdpdmUg\nc3RhdGUgbWFuYWdlcnMgYWNjZXNzIHRvIHRoZSBsaWZlY3ljbGUgZXZlbnQg\nbWFuYWdlci4KICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZUV2ZW50TWFu\nYWdlciBnZXRMaWZlY3ljbGVFdmVudE1hbmFnZXIoKSB7CiAgICAgICAgcmV0\ndXJuIF9saWZlRXZlbnRNYW5hZ2VyOwogICAgfQoKICAgIC8qKgogICAgICog\nRmlyZSBnaXZlbiBsaWZlY3ljbGUgZXZlbnQsIGhhbmRsaW5nIGFueSBleGNl\ncHRpb25zIGFwcHJvcHJpYXRlbHkuCiAgICAgKgogICAgICogQHJldHVybiB3\naGV0aGVyIGV2ZW50cyBhcmUgYmVpbmcgcHJvY2Vzc2VkIGF0IHRoaXMgdGlt\nZQogICAgICovCiAgICBib29sZWFuIGZpcmVMaWZlY3ljbGVFdmVudChPYmpl\nY3Qgc3JjLCBPYmplY3QgcmVsYXRlZCwgQ2xhc3NNZXRhRGF0YSBtZXRhLAog\nICAgICAgIGludCBldmVudFR5cGUpIHsKICAgICAgICBpZiAoX2xpZmVFdmVu\ndE1hbmFnZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGhhbmRsZUNhbGxiYWNrRXhjZXB0aW9ucyhfbGlmZUV2ZW50TWFu\nYWdlci5maXJlRXZlbnQoc3JjLCByZWxhdGVkLCAKICAgICAgICAgICAgbWV0\nYSwgZXZlbnRUeXBlKSwgX2xpZmVDYWxsYmFja01vZGUpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVGFrZSBhY3Rpb25z\nIG9uIGNhbGxiYWNrIGV4Y2VwdGlvbnMgZGVwZW5kaW5nIG9uIGNhbGxiYWNr\nIG1vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYW5kbGVDYWxsYmFj\na0V4Y2VwdGlvbnMoRXhjZXB0aW9uW10gZXhjZXBzLCBpbnQgbW9kZSkgewog\nICAgICAgIGlmIChleGNlcHMubGVuZ3RoID09IDAgfHwgKG1vZGUgJiBDQUxM\nQkFDS19JR05PUkUpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgT3BlbkpQQUV4Y2VwdGlvbiBjZTsKICAgICAgICBpZiAoZXhjZXBzLmxl\nbmd0aCA9PSAxKQogICAgICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2Vw\ndGlvbihleGNlcHNbMF0pOwogICAgICAgIGVsc2UgCiAgICAgICAgICAgIGNl\nID0gbmV3IENhbGxiYWNrRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWxsYmFjay1l\ncnIiKSkuCiAgICAgICAgICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKGV4\nY2Vwcyk7CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUk9MTEJBQ0sp\nICE9IDAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAgICAg\nICAgICAgIGNlLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBzZXRSb2xs\nYmFja09ubHlJbnRlcm5hbChjZSk7CiAgICAgICAgfQogICAgICAgIGlmICgo\nbW9kZSAmIENBTExCQUNLX0xPRykgIT0gMCAmJiBfbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgX2xvZy53YXJuKGNlKTsKICAgICAgICBpZiAo\nKG1vZGUgJiBDQUxMQkFDS19SRVRIUk9XKSAhPSAwKQogICAgICAgICAgICB0\naHJvdyBjZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRUcmFuc2FjdGlv\nbkxpc3RlbmVyKE9iamVjdCB0bCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfdHJhbnNFdmVu\ndE1hbmFnZXIuYWRkTGlzdGVuZXIodGwpOwogICAgICAgICAgICBpZiAodGwg\naW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1hbmFnZXIpCiAgICAgICAg\nICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRU1PVEVfTElTVEVORVI7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZVRyYW5zYWN0\naW9uTGlzdGVuZXIoT2JqZWN0IHRsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdHJh\nbnNFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIodGwpCiAgICAgICAgICAg\nICAgICAmJiAodGwgaW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1hbmFn\nZXIpKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JFTU9URV9M\nSVNURU5FUjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBn\nZXRUcmFuc2FjdGlvbkxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgewogICAgICAg\nIHJldHVybiBfdHJhbnNDYWxsYmFja01vZGU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNrTW9kZShpbnQg\nbW9kZSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBfdHJhbnNDYWxsYmFja01vZGUgPSBtb2Rl\nOwogICAgICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIuc2V0RmFpbEZhc3Qo\nKG1vZGUgJiBDQUxMQkFDS19GQUlMX0ZBU1QpICE9IDApOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgZ2l2ZW4gdHJhbnNhY3Rp\nb24gZXZlbnQsIGhhbmRsaW5nIGFueSBleGNlcHRpb25zIGFwcHJvcHJpYXRl\nbHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBmaXJlVHJhbnNhY3Rpb25F\ndmVudChUcmFuc2FjdGlvbkV2ZW50IHRyYW5zKSB7CiAgICAgICAgaWYgKF90\ncmFuc0V2ZW50TWFuYWdlciAhPSBudWxsKQogICAgICAgICAgICBoYW5kbGVD\nYWxsYmFja0V4Y2VwdGlvbnMoX3RyYW5zRXZlbnRNYW5hZ2VyLmZpcmVFdmVu\ndCh0cmFucyksCiAgICAgICAgICAgICAgICBfdHJhbnNDYWxsYmFja01vZGUp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHdoZXRoZXIgdGhpcyBCcm9r\nZXIgd2lsbCBnZW5lcmF0ZSB2ZXJib3NlIG9wdGltaXN0aWMgbG9jayBleGNl\ncHRpb25zIHdoZW4gYmF0Y2hpbmcKICAgICAqIG9wZXJhdGlvbnMuIERlZmF1\nbHRzIHRvIHRydWUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBiCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFN1cHByZXNzQmF0Y2hPTEVMb2dnaW5nKGJv\nb2xlYW4gYikgewogICAgICAgIF9zdXBwcmVzc0JhdGNoT0xFTG9nZ2luZyA9\nIGI7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIg\ndGhpcyBCcm9rZXIgd2lsbCBnZW5lcmF0ZSB2ZXJib3NlIG9wdGltaXN0aWMg\nbG9jayBleGNlcHRpb25zIHdoZW4gYmF0Y2hpbmcKICAgICAqIG9wZXJhdGlv\nbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN1cHByZXNzQmF0\nY2hPTEVMb2dnaW5nKCkgewogICAgICAgIHJldHVybiBfc3VwcHJlc3NCYXRj\naE9MRUxvZ2dpbmc7CiAgICB9CiAgICAvLy8vLy8vLy8vLwogICAgLy8gTG9v\na3VwcwogICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2JqZWN0IGZpbmQo\nT2JqZWN0IG9pZCwgYm9vbGVhbiB2YWxpZGF0ZSwgRmluZENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaW50IGZsYWdzID0gT0lEX0NPUFkgfCBPSURfQUxM\nT1dfTkVXIHwgT0lEX05PREVMRVRFRDsKICAgICAgICBpZiAoIXZhbGlkYXRl\nKQogICAgICAgICAgICBmbGFncyB8PSBPSURfTk9WQUxJREFURTsKICAgICAg\nICByZXR1cm4gZmluZChvaWQsIF9mYywgbnVsbCwgbnVsbCwgZmxhZ3MsIGNh\nbGwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qgb2lk\nLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBleGNsdWRlLAog\nICAgICAgIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAgICAgICAgcmV0\ndXJuIGZpbmQob2lkLCBmZXRjaCwgZXhjbHVkZSwgZWRhdGEsIGZsYWdzLCBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGZpbmRlci4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCBmaW5kKE9iamVjdCBvaWQs\nIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgQml0U2V0IGV4Y2x1ZGUsCiAg\nICAgICAgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MsIEZpbmRDYWxsYmFja3Mg\nY2FsbCkgewogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAg\nIGNhbGwgPSB0aGlzOwogICAgICAgIG9pZCA9IGNhbGwucHJvY2Vzc0FyZ3Vt\nZW50KG9pZCk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKSB7CiAgICAgICAg\nICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgPT0gMCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihf\nbG9jLmdldCgibnVsbC1vaWQiKSk7CiAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICB9CiAgICAgICAg\naWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0gX2ZjOwoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAg\nICAgICAgICAgLy8gY2FjaGVkIGluc3RhbmNlPwogICAgICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQob2lk\nLAogICAgICAgICAgICAgICAgKGZsYWdzICYgT0lEX0FMTE9XX05FVykgIT0g\nMCB8fCBoYXNGbHVzaGVkKCkpOwogICAgICAgICAgICBpZiAoc20gIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgaWYgKCFyZXF1aXJlc0xvYWQoc20sIHRy\ndWUsIGZldGNoLCBlZGF0YSwgZmxhZ3MpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CgogICAgICAg\nICAgICAgICAgaWYgKCFzbS5pc0xvYWRpbmcoKSkgewogICAgICAgICAgICAg\nICAgICAgIC8vIG1ha2Ugc3VyZSBhbGwgdGhlIGNvbmZpZ3VyZWQgZmllbGRz\nIGFyZSBsb2FkZWQ7IGRvIHRoaXMKICAgICAgICAgICAgICAgICAgICAvLyBh\nZnRlciBtYWtpbmcgaW5zdGFuY2UgdHJhbnNhY3Rpb25hbCBmb3IgbG9ja2lu\nZwogICAgICAgICAgICAgICAgICAgIGlmICghc20uaXNUcmFuc2FjdGlvbmFs\nKCkgJiYgdXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAg\nICAgICAgICAgIGJvb2xlYW4gbG9hZGVkOwogICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZCA9IHNtLmxv\nYWQoZmV0Y2gsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZSwgZWRhdGEsIGZhbHNlKTsK\nICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbiBvbmZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgo\nZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSAhPSAwCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB8fCAoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG9uZmU7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4o\nb2lkLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgICAgIC8vIGlmIG5vIGRhdGEgbmVlZGVkIHRvIGJlIGxvYWRlZCBh\nbmQgdGhlIHVzZXIgd2FudHMgdG8KICAgICAgICAgICAgICAgICAgICAvLyB2\nYWxpZGF0ZSwganVzdCBtYWtlIHN1cmUgdGhlIG9iamVjdCBleGlzdHMKICAg\nICAgICAgICAgICAgICAgICBpZiAoIWxvYWRlZCAmJiAoZmxhZ3MgJiBPSURf\nTk9WQUxJREFURSkgPT0gMAogICAgICAgICAgICAgICAgICAgICAgICAmJiBf\nY29tcGF0LmdldFZhbGlkYXRlVHJ1ZUNoZWNrc1N0b3JlKCkKICAgICAgICAg\nICAgICAgICAgICAgICAgJiYgIXNtLmlzVHJhbnNhY3Rpb25hbCgpCiAgICAg\nICAgICAgICAgICAgICAgICAgICYmICFfc3RvcmUuZXhpc3RzKHNtLCBlZGF0\nYSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9J\nRF9OT0RFTEVURUQpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKCJkZWwtaW5zdGFuY2UiLCBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgb2lk\nKSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmpl\nY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBz\naW5jZSB0aGUgb2JqZWN0IHdhcyBjYWNoZWQsIHdlIG1heSBuZWVkIHRvIHVw\nZ3JhZGUgbG9jawogICAgICAgICAgICAgICAgLy8gaWYgY3VycmVudCBsZXZl\nbCBpcyBoaWdoZXIgdGhhbiBsZXZlbCBvZiBpbml0aWFsIGxvYWQKICAgICAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApIHsK\nICAgICAgICAgICAgICAgICAgICBpbnQgbGV2ZWwgPSBmZXRjaC5nZXRSZWFk\nTG9ja0xldmVsKCk7CiAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20s\nIGxldmVsLCBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBlZGF0YSk7CiAgICAg\nICAgICAgICAgICAgICAgc20ucmVhZExvY2tlZChsZXZlbCwgZmV0Y2guZ2V0\nV3JpdGVMb2NrTGV2ZWwoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIG5vIGNh\nY2hlZCBzbSBmb3IgYSBuZXcvdHJhbnNpZW50IGlkIHR5cGUsIHdlCiAgICAg\nICAgICAgIC8vIGl0IGRlZmluaXRlbHkgZG9lc24ndCBleGlzdAogICAgICAg\nICAgICBpZiAob2lkIGluc3RhbmNlb2YgU3RhdGVNYW5hZ2VySWQpCiAgICAg\nICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVs\nbCk7CgogICAgICAgICAgICAvLyBpbml0aWFsaXplIGEgbmV3IHN0YXRlIG1h\nbmFnZXIgZm9yIHRoZSBkYXRhc3RvcmUgaW5zdGFuY2UKICAgICAgICAgICAg\nc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lEX0NP\nUFkpICE9IDApOwogICAgICAgICAgICBib29sZWFuIGxvYWQgPSByZXF1aXJl\nc0xvYWQoc20sIGZhbHNlLCBmZXRjaCwgZWRhdGEsIGZsYWdzKTsKICAgICAg\nICAgICAgc20gPSBpbml0aWFsaXplKHNtLCBsb2FkLCBmZXRjaCwgZWRhdGEp\nOwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbihvaWQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1Jl\ndHVybihvaWQsIG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBtYWtlIHN1cmUgYWxsIGNvbmZpZ3VyZWQgZmllbGRzIHdlcmUgbG9hZGVk\nCiAgICAgICAgICAgIGlmIChsb2FkKSB7CiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoZmV0Y2gsIFN0YXRlTWFu\nYWdlckltcGwuTE9BRF9GR1MsIGV4Y2x1ZGUsCiAgICAgICAgICAgICAgICAg\nICAgICAgIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbiBvbmZlKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT0RFTEVURUQpICE9IDAKICAg\nICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFMSURB\nVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG9uZmU7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVy\nbihvaWQsIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBz\nbSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbml0aWFsaXplIGEgbmV3bHktY29uc3RydWN0ZWQgc3RhdGUgbWFu\nYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwg\naW5pdGlhbGl6ZShTdGF0ZU1hbmFnZXJJbXBsIHNtLCBib29sZWFuIGxvYWQs\nCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgZWRh\ndGEpIHsKICAgICAgICBpZiAoIWxvYWQpIHsKICAgICAgICAgICAgc20uaW5p\ndGlhbGl6ZShzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgIFBDU3RhdGUuSE9MTE9XKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBQQ1N0YXRlIHN0YXRlID0gKHVzZVRyYW5zYWN0\naW9uYWxTdGF0ZShmZXRjaCkpCiAgICAgICAgICAgICAgICA/IFBDU3RhdGUu\nUENMRUFOIDogUENTdGF0ZS5QTk9OVFJBTlM7CiAgICAgICAgICAgIHNtLnNl\ndExvYWRpbmcodHJ1ZSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBpZiAoIV9zdG9yZS5pbml0aWFsaXplKHNtLCBzdGF0ZSwgZmV0Y2gs\nIGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHNtLnNldExv\nYWRpbmcoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBzbTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZmluZEFs\nbChDb2xsZWN0aW9uIG9pZHMsIGJvb2xlYW4gdmFsaWRhdGUsCiAgICAgICAg\nRmluZENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaW50IGZsYWdzID0gT0lE\nX0NPUFkgfCBPSURfQUxMT1dfTkVXIHwgT0lEX05PREVMRVRFRDsKICAgICAg\nICBpZiAoIXZhbGlkYXRlKQogICAgICAgICAgICBmbGFncyB8PSBPSURfTk9W\nQUxJREFURTsKICAgICAgICByZXR1cm4gZmluZEFsbChvaWRzLCBfZmMsIG51\nbGwsIG51bGwsIGZsYWdzLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0W10gZmluZEFsbChDb2xsZWN0aW9uIG9pZHMsIEZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0IGVk\nYXRhLCBpbnQgZmxhZ3MpIHsKICAgICAgICByZXR1cm4gZmluZEFsbChvaWRz\nLCBmZXRjaCwgZXhjbHVkZSwgZWRhdGEsIGZsYWdzLCBudWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludGVybmFsIGZpbmRlci4KICAgICAqLwogICAg\ncHJvdGVjdGVkIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgQml0U2V0IGV4Y2x1\nZGUsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzLCBGaW5kQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBmaW5kQWxsRGVwdGggKys7CgogICAgICAgIC8vIHRo\ncm93IGFueSBleGNlcHRpb25zIGZvciBudWxsIG9pZHMgdXAgaW1tZWRpYXRl\nbHkKICAgICAgICBpZiAob2lkcyA9PSBudWxsKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oIm9pZHMgPT0gbnVsbCIpOwog\nICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCAmJiBv\naWRzLmNvbnRhaW5zKG51bGwpKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1vaWRzIikpOwoKICAgICAgICAv\nLyB3ZSBoYXZlIHRvIHVzZSBhIG1hcCBvZiBvaWQtPnNtIHJhdGhlciB0aGFu\nIGEgc2ltcGxlCiAgICAgICAgLy8gYXJyYXksIHNvIHRoYXQgd2UgbWFrZSBz\ndXJlIG5vdCB0byBjcmVhdGUgbXVsdGlwbGUgc21zIGZvciBlcXVpdmFsZW50\nCiAgICAgICAgLy8gb2lkcyBpZiB0aGUgdXNlciBoYXMgZHVwbGljYXRlcyBp\nbiB0aGUgZ2l2ZW4gYXJyYXkKICAgICAgICBpZiAoX2xvYWRpbmcgPT0gbnVs\nbCkKICAgICAgICAgICAgX2xvYWRpbmcgPSBuZXcgSGFzaE1hcCgoaW50KSAo\nb2lkcy5zaXplKCkgKiAxLjMzICsgMSkpOwoKICAgICAgICBpZiAoY2FsbCA9\nPSBudWxsKQogICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBpZiAo\nZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfZmM7CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAg\nICAgICAvLyBjb2xsZWN0aW9uIG9mIHN0YXRlIG1hbmFnZXJzIHRvIHBhc3Mg\ndG8gc3RvcmUgbWFuYWdlcgogICAgICAgICAgICBMaXN0IGxvYWQgPSBudWxs\nOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAg\nICBib29sZWFuIGluaXRpYWxpemVkOwogICAgICAgICAgICBib29sZWFuIHRy\nYW5zU3RhdGUgPSB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpOwogICAg\nICAgICAgICBPYmplY3Qgb2JqLCBvaWQ7CiAgICAgICAgICAgIGludCBpZHgg\nPSAwOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9pZHMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspIHsKICAgICAgICAgICAg\nICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgc2VlbiB0aGlzIG9pZCwgc2tpcCBy\nZXBlYXRzCiAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAg\nICAgICAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQob2JqKTsK\nICAgICAgICAgICAgICAgIGlmIChvaWQgPT0gbnVsbCB8fCBfbG9hZGluZy5j\nb250YWluc0tleShvYmopKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGRvbid0IGhhdmUgYSBjYWNo\nZWQgaW5zdGFuY2Ugb3IgaXQgaXMgbm90IHRyYW5zYWN0aW9uYWwKICAgICAg\nICAgICAgICAgIC8vIGFuZCBpcyBob2xsb3cgb3Igd2UgbmVlZCB0byB2YWxp\nZGF0ZSwgbG9hZCBpdAogICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1h\nbmFnZXJJbXBsQnlJZChvaWQsIChmbGFncyAmIE9JRF9BTExPV19ORVcpICE9\nIDAKICAgICAgICAgICAgICAgICAgICB8fCBoYXNGbHVzaGVkKCkpOwogICAg\nICAgICAgICAgICAgaW5pdGlhbGl6ZWQgPSBzbSAhPSBudWxsOwogICAgICAg\nICAgICAgICAgaWYgKCFpbml0aWFsaXplZCkKICAgICAgICAgICAgICAgICAg\nICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCAoZmxhZ3MgJiBPSURf\nQ09QWSkgIT0gMCk7CgogICAgICAgICAgICAgICAgX2xvYWRpbmcucHV0KG9i\naiwgc20pOwogICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVzTG9hZChzbSwg\naW5pdGlhbGl6ZWQsIGZldGNoLCBlZGF0YSwgZmxhZ3MpKSB7CiAgICAgICAg\nICAgICAgICAgICAgdHJhbnNTdGF0ZSA9IHRyYW5zU3RhdGUgfHwgdXNlVHJh\nbnNhY3Rpb25hbFN0YXRlKGZldGNoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoaW5pdGlhbGl6ZWQgJiYgIXNtLmlzVHJhbnNhY3Rpb25hbCgpICYmIHRy\nYW5zU3RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0\naW9uYWwoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBsb2FkID0gbmV3IEFycmF5TGlz\ndChvaWRzLnNpemUoKSAtIGlkeCk7CiAgICAgICAgICAgICAgICAgICAgbG9h\nZC5hZGQoc20pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaW5pdGlh\nbGl6ZWQpCiAgICAgICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShzbS5n\nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgUENTdGF0ZS5IT0xMT1cpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBwYXNzIGFsbCBzdGF0ZSBtYW5hZ2VycyBpbiBuZWVk\nIG9mIGxvYWRpbmcgb3IgdmFsaWRhdGlvbiB0byB0aGUKICAgICAgICAgICAg\nLy8gc3RvcmUgbWFuYWdlcgogICAgICAgICAgICBpZiAobG9hZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBQQ1N0YXRlIHN0YXRlID0gKHRyYW5zU3Rh\ndGUpID8gUENTdGF0ZS5QQ0xFQU4KICAgICAgICAgICAgICAgICAgICA6IFBD\nU3RhdGUuUE5PTlRSQU5TOwogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBm\nYWlsZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBzdGF0ZSwKICAgICAgICAg\nICAgICAgICAgICBTdG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FLCBmZXRj\naCwgZWRhdGEpOwoKICAgICAgICAgICAgICAgIC8vIHNldCBmYWlsZWQgaW5z\ndGFuY2VzIHRvIG51bGwKICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0g\nbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3T2JqZWN0Tm90Rm91bmRFeGNl\ncHRpb24oZmFpbGVkKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IGZhaWxlZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykK\nICAgICAgICAgICAgICAgICAgICAgICAgX2xvYWRpbmcucHV0KGl0ci5uZXh0\nKCksIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBjcmVhdGUgcmVzdWx0cyBhcnJheTsgbWFrZSBzdXJl\nIGFsbCBjb25maWd1cmVkIGZpZWxkcyBhcmUKICAgICAgICAgICAgLy8gbG9h\nZGVkIGluIGVhY2ggaW5zdGFuY2UKICAgICAgICAgICAgT2JqZWN0W10gcmVz\ndWx0cyA9IG5ldyBPYmplY3Rbb2lkcy5zaXplKCldOwogICAgICAgICAgICBi\nb29sZWFuIGFjdGl2ZSA9IChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMDsK\nICAgICAgICAgICAgaW50IGxldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZl\nbCgpOwogICAgICAgICAgICBpZHggPSAwOwogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IG9pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsg\naWR4KyspIHsKICAgICAgICAgICAgICAgIG9pZCA9IGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbG9hZGlu\nZy5nZXQob2lkKTsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYm\nIHJlcXVpcmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRhLCBmbGFncykp\nIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURf\nRkdTLAogICAgICAgICAgICAgICAgICAgICAgICAJZXhjbHVkZSwgZWRhdGEs\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxl\ndmVsLCBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBlZGF0YSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBmZXRj\naC5nZXRXcml0ZUxvY2tMZXZlbCgpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRF\nRCkgIT0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdz\nICYgT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAgICAgICBz\nbSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmVzdWx0c1tpZHhdID0gY2FsbC5wcm9j\nZXNzUmV0dXJuKG9pZCwgc20pOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiByZXN1bHRzOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZmluZEFsbERlcHRoLS07CiAgICAgICAgICAgIGlm\nIChmaW5kQWxsRGVwdGggPT0gMCkKICAgICAgICAgICAgICAgIF9sb2FkaW5n\nID0gbnVsbDsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNGbHVzaGVkKCkgewog\nICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAhPSAwOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVu\nIGluc3RhbmNlIG5lZWRzIGxvYWRpbmcgYmVmb3JlIGJlaW5nIHJldHVybmVk\nCiAgICAgKiB0byB0aGUgdXNlci4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIHJlcXVpcmVzTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29s\nZWFuIGluaXRpYWxpemVkLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MpIHsKICAgICAgICBpZiAo\nIWZldGNoLnJlcXVpcmVzTG9hZCgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAw\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZWRhdGEg\nIT0gbnVsbCkgLy8gdGFrZSBhZHZhbnRhZ2Ugb2YgZXhpc3RpbmcgcmVzdWx0\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChpbml0aWFs\naXplZCAmJiBzbS5nZXRQQ1N0YXRlKCkgIT0gUENTdGF0ZS5IT0xMT1cpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIWluaXRpYWxp\nemVkICYmIHNtLmdldE1ldGFEYXRhKCkuZ2V0UENTdWJjbGFzc2VzKCkubGVu\nZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0\ndXJuICFfY29tcGF0LmdldFZhbGlkYXRlRmFsc2VSZXR1cm5zSG9sbG93KCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0byB1c2Ug\nYSB0cmFuc2FjdGlvbmFsIHN0YXRlLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gdXNlVHJhbnNhY3Rpb25hbFN0YXRlKEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDAgJiYgKCFfb3B0aW1pc3RpYwogICAgICAgICAgICB8fCBfYXV0\nb0NsZWFyID09IENMRUFSX0FMTAogICAgICAgICAgICB8fCBmZXRjaC5nZXRS\nZWFkTG9ja0xldmVsKCkgIT0gTE9DS19OT05FKTsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGZpbmRDYWNoZWQoT2JqZWN0IG9pZCwgRmluZENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAg\nICAgY2FsbCA9IHRoaXM7CiAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJn\ndW1lbnQob2lkKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGxCeUlkKG9pZCwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5cGUoQ2xhc3MgY2xzKSB7\nCiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25m\nLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAg\nICAgICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbAogICAgICAgICAgICAgICAgfHwgbWV0\nYS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05P\nV04pCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAg\naWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5J\nRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhLmdl\ndE9iamVjdElkVHlwZSgpOwoKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5n\nZXREYXRhU3RvcmVJZFR5cGUobWV0YSk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdPYmplY3RJZChDbGFz\ncyBjbHMsIE9iamVjdCB2YWwpIHsKICAgICAgICBpZiAodmFsID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgX2xv\nYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIHN3aXRjaCAobWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSkgewogICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEu\nSURfREFUQVNUT1JFOgogICAgICAgICAgICAgICAgLy8gZGVsZWdhdGUgdG8g\nc3RvcmUgbWFuYWdlciBmb3IgZGF0YXN0b3JlIGlkcwogICAgICAgICAgICAg\nICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZwogICAgICAgICAgICAgICAg\nICAgICYmICgoU3RyaW5nKSB2YWwpLnN0YXJ0c1dpdGgoU3RhdGVNYW5hZ2Vy\nSWQuU1RSSU5HX1BSRUZJWCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTdGF0ZU1hbmFnZXJJZCgoU3RyaW5nKSB2YWwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIF9zdG9yZS5uZXdEYXRhU3RvcmVJZCh2YWwsIG1ldGEp\nOwogICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJ\nT046CiAgICAgICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc0Fzc2lnbmFi\nbGUobWV0YS5nZXRPYmplY3RJZFR5cGUoKSwgCiAgICAgICAgICAgICAgICAg\nICAgdmFsLmdldENsYXNzKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgCiAgICAgICAgICAgICAgICAg\nICAgICAgICYmIG1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIHZh\nbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBzdHJpbmdpZmllZCBhcHAg\naWQ/CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5n\nIAogICAgICAgICAgICAgICAgICAgICYmICFfY29uZi5nZXRDb21wYXRpYmls\naXR5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0U3Ry\naWN0SWRlbnRpdHlWYWx1ZXMoKQogICAgICAgICAgICAgICAgICAgICYmICFN\nb2RpZmllci5pc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIFBDUmVnaXN0cnkubmV3T2JqZWN0SWQo\nY2xzLCAoU3RyaW5nKSB2YWwpOwoKICAgICAgICAgICAgICAgIE9iamVjdFtd\nIGFyciA9ICh2YWwgaW5zdGFuY2VvZiBPYmplY3RbXSkgPyAoT2JqZWN0W10p\nIHZhbAogICAgICAgICAgICAgICAgICAgIDogbmV3IE9iamVjdFtdeyB2YWwg\nfTsKICAgICAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5mcm9t\nUEtWYWx1ZXMoYXJyLCBtZXRhKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJtZXRhLXVua25vd25pZCIsIGNscykpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlhZSkgewog\nICAgICAgIAl0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLWlkLXZhbHVlIiwgdmFsLAogICAgICAgICAgICAgICAgdmFsLmdldENsYXNz\nKCkuZ2V0TmFtZSgpLCBjbHMpKS5zZXRDYXVzZShpYWUpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoQ2xhc3NDYXN0RXhjZXB0aW9uIGNj\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLWlkLXZhbHVlIiwgdmFsLAogICAgICAgICAgICAgICAgdmFs\nLmdldENsYXNzKCkuZ2V0TmFtZSgpLCBjbHMpKS5zZXRDYXVzZShjY2UpOwog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzdGF0\nZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gb2lkLgogICAgICovCiAgICBwcml2\nYXRlIFN0YXRlTWFuYWdlckltcGwgbmV3U3RhdGVNYW5hZ2VySW1wbChPYmpl\nY3Qgb2lkLCBib29sZWFuIGNvcHkpIHsKICAgICAgICAvLyBzZWUgaWYgd2Un\ncmUgaW4gdGhlIHByb2Nlc3Mgb2YgbG9hZGluZyB0aGlzIG9pZCBpbiBhIGxv\nYWRBbGwgY2FsbAogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAg\nICAgaWYgKF9sb2FkaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgc20gPSAo\nU3RhdGVNYW5hZ2VySW1wbCkgX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAgICAg\nICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gc207CiAgICAg\nICAgfQoKICAgICAgICAvLyBmaW5kIG1ldGFkYXRhIGZvciB0aGUgb2lkCiAg\nICAgICAgQ2xhc3MgcGNUeXBlID0gX3N0b3JlLmdldE1hbmFnZWRUeXBlKG9p\nZCk7CiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYu\nZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGE7CiAgICAgICAgaWYgKHBjVHlwZSAhPSBudWxsKQog\nICAgICAgICAgICBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEocGNUeXBlLCBf\nbG9hZGVyLCB0cnVlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG1ldGEg\nPSByZXBvcy5nZXRNZXRhRGF0YShvaWQsIF9sb2FkZXIsIHRydWUpOwoKICAg\nICAgICAvLyBjb3B5IHRoZSBvaWQgaWYgbmVlZGVkCiAgICAgICAgaWYgKGNv\ncHkgJiYgX2NvbXBhdC5nZXRDb3B5T2JqZWN0SWRzKCkpIHsKICAgICAgICAg\nICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgICAgIG9pZCA9IEFwcGxp\nY2F0aW9uSWRzLmNvcHkob2lkLCBtZXRhKTsKICAgICAgICAgICAgZWxzZSBp\nZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklE\nX1VOS05PV04pCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBtZXRhKSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG9pZCA9IF9zdG9yZS5jb3B5\nRGF0YVN0b3JlSWQob2lkLCBtZXRhKTsKICAgICAgICB9CgogICAgICAgIHNt\nID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQsIG1ldGEpOwogICAgICAgIHNt\nLnNldE9iamVjdElkKG9pZCk7CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGEgc3RhdGUgbWFuYWdlciBmb3IgdGhl\nIGdpdmVuIG9pZCBhbmQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBTdGF0ZU1hbmFnZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwoT2JqZWN0\nIG9pZCwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFN0YXRlTWFuYWdlckltcGwob2lkLCBtZXRhLCB0aGlzKTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIFRyYW5zYWN0aW9u\nCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigp\nIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAw\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiYWN0aXZlIikpOwogICAgICAgICAgICBfZmFjdG9y\neS5zeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbih0aGlzLCB0cnVlKTsKICAg\nICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgc3RvcmUgbWFuYWdlciBvZiBh\nIHRyYW5zYWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVnaW5J\nbnRlcm5hbCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBiZWdpblN0\nb3JlTWFuYWdlclRyYW5zYWN0aW9uKF9vcHRpbWlzdGljKTsKICAgICAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfQUNUSVZFOwoKICAgICAgICAgICAgLy8gc3Rh\ncnQgbG9ja2luZwogICAgICAgICAgICBpZiAoIV9vcHRpbWlzdGljKSB7CiAg\nICAgICAgICAgICAgICBfZmMuc2V0UmVhZExvY2tMZXZlbChfY29uZi5nZXRS\nZWFkTG9ja0xldmVsQ29uc3RhbnQoKSk7CiAgICAgICAgICAgICAgICBfZmMu\nc2V0V3JpdGVMb2NrTGV2ZWwoX2NvbmYuZ2V0V3JpdGVMb2NrTGV2ZWxDb25z\ndGFudCgpKTsKICAgICAgICAgICAgICAgIF9mYy5zZXRMb2NrVGltZW91dChf\nY29uZi5nZXRMb2NrVGltZW91dCgpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBfbG0uYmVnaW5UcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgaWYg\nKF90cmFuc0V2ZW50TWFuYWdlci5oYXNCZWdpbkxpc3RlbmVycygpKQogICAg\nICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0\naW9uRXZlbnQodGhpcywKICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlv\nbkV2ZW50LkFGVEVSX0JFR0lOLCBudWxsLCBudWxsLCBudWxsLCBudWxsKSk7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICAvLyBpZiB3ZSBhbHJlYWR5IHN0YXJ0ZWQgdGhlIHRyYW5zYWN0\naW9uLCBkb24ndCBsZXQgaXQgY29tbWl0CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICBzZXRS\nb2xsYmFja09ubHlJbnRlcm5hbChrZSk7CiAgICAgICAgICAgIHRocm93IGtl\nLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgLy8gaWYgd2UgYWxyZWFkeSBzdGFy\ndGVkIHRoZSB0cmFuc2FjdGlvbiwgZG9uJ3QgbGV0IGl0IGNvbW1pdAogICAg\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAg\nICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwocmUpOwogICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpLnNldEZhdGFs\nKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9wZW5kaW5nICE9IG51\nbGwpIHsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdCA9IF9wZW5kaW5nLml0ZXJhdG9yKCk7\nIGl0Lmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKFN0YXRl\nTWFuYWdlckltcGwpIGl0Lm5leHQoKTsKICAgICAgICAgICAgICAgIHNtLnRy\nYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5\nKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0RGlydHkoc20sIHRydWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIF9wZW5kaW5nID0gbnVsbDsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5TdG9yZSgpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOwogICAg\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSA9PSAw\nKQogICAgICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlv\nbihmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQmVnaW4gYSBzdG9yZSBtYW5hZ2VyIHRyYW5zYWN0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVnaW5TdG9yZU1hbmFnZXJUcmFu\nc2FjdGlvbihib29sZWFuIG9wdGltaXN0aWMpIHsKICAgICAgICBpZiAoIW9w\ndGltaXN0aWMpIHsKICAgICAgICAgICAgcmV0YWluQ29ubmVjdGlvbigpOwog\nICAgICAgICAgICBfc3RvcmUuYmVnaW4oKTsKICAgICAgICAgICAgX2ZsYWdz\nIHw9IEZMQUdfU1RPUkVfQUNUSVZFOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIGlmIChfY29ublJldGFpbk1vZGUgPT0gQ09OTl9SRVRBSU5fVFJB\nTlMpCiAgICAgICAgICAgICAgICByZXRhaW5Db25uZWN0aW9uKCk7CiAgICAg\nICAgICAgIF9zdG9yZS5iZWdpbk9wdGltaXN0aWMoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBFbmQgdGhlIGN1cnJlbnQgc3RvcmUgbWFu\nYWdlciB0cmFuc2FjdGlvbi4gVGhyb3dzIGFuCiAgICAgKiBleGNlcHRpb24g\ndG8gc2lnbmFsIGEgZm9yY2VkIHJvbGxiYWNrIGFmdGVyIGZhaWxlZCBjb21t\naXQsIG90aGVyd2lzZQogICAgICogcmV0dXJucyBhbnkgZXhjZXB0aW9uIGVu\nY291bnRlcmVkIGR1cmluZyB0aGUgZW5kIHByb2Nlc3MuCiAgICAgKi8KICAg\nIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvbiBlbmRTdG9yZU1hbmFnZXJUcmFu\nc2FjdGlvbihib29sZWFuIHJvbGxiYWNrKSB7CiAgICAgICAgYm9vbGVhbiBm\nb3JjZWRSb2xsYmFjayA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gcmVsZWFz\nZUNvbm4gPSBmYWxzZTsKICAgICAgICBSdW50aW1lRXhjZXB0aW9uIGVyciA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAg\ncmVsZWFzZUNvbm4gPSBfY29ublJldGFpbk1vZGUgIT0gQ09OTl9SRVRBSU5f\nQUxXQVlTOwogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNrKQogICAgICAg\nICAgICAgICAgICAgIF9zdG9yZS5yb2xsYmFjaygpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIF9zdG9yZS5jb21taXQoKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbGVhc2VD\nb25uID0gX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX1RSQU5TOwog\nICAgICAgICAgICAgICAgX3N0b3JlLnJvbGxiYWNrT3B0aW1pc3RpYygpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlmICghcm9sbGJhY2spIHsK\nICAgICAgICAgICAgICAgIGZvcmNlZFJvbGxiYWNrID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgIHRyeSB7IF9zdG9yZS5yb2xsYmFjaygpOyB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlMikge30KICAgICAgICAgICAgfQogICAgICAg\nICAgICBlcnIgPSByZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfU1RPUkVfQUNUSVZFOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKHJlbGVhc2VDb25uKSB7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICByZWxlYXNlQ29ubmVjdGlvbigpOwogICAgICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nICAgICBpZiAoZXJyID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZXJy\nID0gcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChm\nb3JjZWRSb2xsYmFjaykKICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAg\nIHJldHVybiBlcnI7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0KCkg\newogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOwoK\nICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJh\nbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25N\nYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRy\nYW5zID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikpOwoKICAg\nICAgICAgICAgLy8gdGhpcyBjb21taXQgb24gdGhlIHRyYW5zYWN0aW9uIHdp\nbGwgY2F1c2Ugb3VyCiAgICAgICAgICAgIC8vIGJlZm9yZUNvbXBsZXRpb24g\nbWV0aG9kIHRvIGJlIGludm9rZWQKICAgICAgICAgICAgdHJhbnMuY29tbWl0\nKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9y\nIiksIGtlKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoImVuZC10cmFucy1lcnJvciIpLCBlKTsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nVHJhbnNhY3Rpb25PcGVyYXRpb24oKTsKCiAgICAgICAgICAgIGphdmF4LnRy\nYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAgICAgICAg\nIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0\naW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJhbnMucm9sbGJhY2soKTsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiks\nIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN5bmNX\naXRoTWFuYWdlZFRyYW5zYWN0aW9uKCkgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIV9tYW5hZ2VkKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgidHJhbnMtbm90LW1hbmFnZWQiKSk7CiAgICAgICAgICAg\nIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbih0aGlz\nLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIGJlZ2luSW50ZXJuYWwoKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY29tbWl0QW5kUmVzdW1lKCkgewogICAgICAgIGVuZEFuZFJl\nc3VtZSh0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFja0Fu\nZFJlc3VtZSgpIHsKICAgICAgICBlbmRBbmRSZXN1bWUoZmFsc2UpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBlbmRBbmRSZXN1bWUoYm9vbGVhbiBjb21t\naXQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKGNvbW1pdCkKICAgICAgICAgICAgICAg\nIGNvbW1pdCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBy\nb2xsYmFjaygpOwogICAgICAgICAgICBiZWdpbigpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSb2xsYmFja09ubHkoKSB7\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIGph\ndmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAg\nICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRy\nYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1\ncm4gdHJhbnMuZ2V0U3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRVU19NQVJLRURf\nUk9MTEJBQ0s7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFRo\ncm93YWJsZSBnZXRSb2xsYmFja0NhdXNlKCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRy\nYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdl\ndFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAg\nICAgICAgIGlmICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIGlmICh0cmFucy5nZXRTdGF0dXMoKSA9\nPSBTdGF0dXMuU1RBVFVTX01BUktFRF9ST0xMQkFDSykKICAgICAgICAgICAg\nICAgIHJldHVybiBfcnVudGltZS5nZXRSb2xsYmFja0NhdXNlKCk7CgogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFja09ubHkoKSB7CiAgICAgICAgc2V0\nUm9sbGJhY2tPbmx5KG5ldyBVc2VyRXhjZXB0aW9uKCkpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFJvbGxiYWNrT25seShUaHJvd2FibGUgY2F1c2Up\nIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOwog\nICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChjYXVzZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGUgY3Vy\ncmVudCB0cmFuc2FjdGlvbiBhcyByb2xsYmFjay1vbmx5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoVGhyb3dh\nYmxlIGNhdXNlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgamF2YXgu\ndHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAg\nICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNh\nY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJudWxsLXRyYW5zIikpOwogICAgICAgICAgICAvLyBlbnN1cmUg\ndHJhbiBpcyBpbiBhIHZhbGlkIHN0YXRlIHRvIGFjY2VwdCB0aGUgc2V0Um9s\nbGJhY2tPbmx5CiAgICAgICAgICAgIGludCB0cmFuU3RhdHVzID0gdHJhbnMu\nZ2V0U3RhdHVzKCk7CiAgICAgICAgICAgIGlmICgodHJhblN0YXR1cyAhPSBT\ndGF0dXMuU1RBVFVTX05PX1RSQU5TQUNUSU9OKQogICAgICAgICAgICAgICAg\nICAgICYmICh0cmFuU3RhdHVzICE9IFN0YXR1cy5TVEFUVVNfUk9MTEVEQkFD\nSykKICAgICAgICAgICAgICAgICAgICAmJiAodHJhblN0YXR1cyAhPSBTdGF0\ndXMuU1RBVFVTX0NPTU1JVFRFRCkpCiAgICAgICAgICAgICAgICBfcnVudGlt\nZS5zZXRSb2xsYmFja09ubHkoY2F1c2UpOwogICAgICAgICAgICBlbHNlIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJpbnZhbGlkLXRyYW4tc3RhdHVzIiwgbmV3IElu\ndGVnZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5TdGF0dXMpLCAi\nc2V0Um9sbGJhY2tPbmx5IikpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldFNhdmVwb2ludChTdHJpbmcgbmFtZSkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlm\nIChfc2F2ZXBvaW50cyAhPSBudWxsICYmIF9zYXZlcG9pbnRzLmNvbnRhaW5z\nS2V5KG5hbWUpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoInNhdmVwb2ludC1leGlzdHMiLCBuYW1lKSk7Cgog\nICAgICAgICAgICBpZiAoaGFzRmx1c2hlZCgpICYmICFfc3BtLnN1cHBvcnRz\nSW5jcmVtZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAg\nICAgICAgKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsKCiAg\nICAgICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZSA9IF9zcG0ubmV3U2F2\nZXBvaW50KG5hbWUsIHRoaXMpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2lu\ndHMgPT0gbnVsbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgICAgIHNhdmUuc2F2ZShnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCkp\nOwogICAgICAgICAgICAgICAgX3NhdmVwb2ludHMgPSBuZXcgTGlua2VkTWFw\nKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAo\nX3NhdmVwb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nc2F2ZS5zYXZlKENvbGxlY3Rpb25zLkVNUFRZX1NFVCk7CiAgICAgICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzYXZlLnNhdmUoX3Nh\ndmVwb2ludENhY2hlKTsKICAgICAgICAgICAgICAgICAgICBfc2F2ZXBvaW50\nQ2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICBfc2F2ZXBvaW50cy5wdXQobmFtZSwgc2F2ZSk7CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVsZWFzZVNh\ndmVwb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51\nbGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxhc3RzYXZl\ncG9pbnQiKSk7CiAgICAgICAgICAgIHJlbGVhc2VTYXZlcG9pbnQoKFN0cmlu\nZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3NhdmVwb2lu\ndHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9pbnQpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAg\nICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxsKSA/IC0x\nCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yoc2F2ZXBv\naW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zYXZl\ncG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNsZWFyIG9s\nZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2\nZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUoKSA+IGlu\nZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVuSlBBU2F2\nZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAgICAgICAg\nICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgICAgICBz\nYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92\nZShpbmRleCk7CiAgICAgICAgICAgIHNhdmUucmVsZWFzZSh0cnVlKTsKICAg\nICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2tUb1NhdmVwb2lu\ndCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51bGwgfHwg\nX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxhc3RzYXZlcG9pbnQi\nKSk7CiAgICAgICAgICAgIHJvbGxiYWNrVG9TYXZlcG9pbnQoKFN0cmluZykg\nX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3NhdmVwb2ludHMu\nc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByb2xsYmFja1RvU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9pbnQpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAg\nICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxsKSA/IC0x\nCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yoc2F2ZXBv\naW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zYXZl\ncG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNsZWFyIG9s\nZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2\nZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUoKSA+IGlu\nZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVuSlBBU2F2\nZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAgICAgICAg\nICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgICAgICBz\nYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92\nZShpbmRleCk7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc2F2ZWQgPSBzYXZl\nLnJvbGxiYWNrKF9zYXZlcG9pbnRzLnZhbHVlcygpKTsKICAgICAgICAgICAg\naWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAgICAgICAgIGlmIChoYXNU\ncmFuc2FjdGlvbmFsT2JqZWN0cygpKSB7CiAgICAgICAgICAgICAgICAvLyBi\ndWlsZCB1cCBhIG5ldyBjb2xsZWN0aW9uIG9mIHN0YXRlcwogICAgICAgICAg\nICAgICAgVHJhbnNhY3Rpb25hbENhY2hlIG9sZFRyYW5zQ2FjaGUgPSBfdHJh\nbnNDYWNoZTsKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uYWxDYWNoZSBu\nZXdUcmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZQogICAgICAg\nICAgICAgICAgICAgIChfb3JkZXJEaXJ0eSk7CiAgICAgICAgICAgICAgICBf\ndHJhbnNDYWNoZSA9IG51bGw7CgogICAgICAgICAgICAgICAgLy8gY3VycmVu\ndGx5IHRoZXJlIGlzIHRoZSBhc3N1bXB0aW9uIHRoYXQgaW5jcmVtZW50YWwK\nICAgICAgICAgICAgICAgIC8vIGZsdXNoIGlzIGVpdGhlciBhKSBub3QgYWxs\nb3dlZCwgb3IgYikgcmVxdWlyZWQKICAgICAgICAgICAgICAgIC8vIHByZS1z\nYXZlcG9pbnQuICB0aGlzIHNvbHZlcyBhIG51bWJlciBvZiBpc3N1ZXMgaW5j\nbHVkaW5nCiAgICAgICAgICAgICAgICAvLyBzdG9yaW5nIGZsdXNoZWQgc3Rh\ndGVzIGFzIHdlbGwgYXMgT0lEIGhhbmRsaW5nLgogICAgICAgICAgICAgICAg\nLy8gaWYgZnV0dXJlIHBsdWdpbnMgZG8gbm90IGZvbGxvdyB0aGlzLCB3ZSBu\nZWVkIHRvIGNhY2hlCiAgICAgICAgICAgICAgICAvLyBtb3JlIGluZm8gcGVy\nIHN0YXRlCiAgICAgICAgICAgICAgICBTYXZlcG9pbnRGaWVsZE1hbmFnZXIg\nZm07CiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzYXZlZC5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIGZt\nID0gKFNhdmVwb2ludEZpZWxkTWFuYWdlcikgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgICAgICBzbSA9IGZtLmdldFN0YXRlTWFuYWdlcigpOwogICAg\nICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrVG9TYXZlcG9pbnQoZm0pOwog\nICAgICAgICAgICAgICAgICAgIG9sZFRyYW5zQ2FjaGUucmVtb3ZlKHNtKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBuZXdUcmFuc0NhY2hlLmFkZERpcnR5KHNtKTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIG5ld1RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvbGRU\ncmFuc0NhY2hlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgICAgICAgICBzbS5yb2xsYmFjaygpOwogICAg\nICAgICAgICAgICAgICAgIHJlbW92ZUZyb21UcmFuc2FjdGlvbihzbSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9\nIG5ld1RyYW5zQ2FjaGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGZsdXNoKCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIC8vIHJldHVybiBzaWxlbnRseSBpZiBubyB0cmFucyBpcyBhY3Rp\ndmUsIG9yIGlmIHRoaXMgaXMgYSByZWVudHJhbnQKICAgICAgICAgICAgLy8g\nY2FsbCwgd2hpY2ggY2FuIGhhcHBlbiBpZiB0aGUgc3RvcmUgbWFuYWdlciB0\ncmllcyB0byBnZXQgYW4KICAgICAgICAgICAgLy8gYXV0by1pbmMgb2lkIGR1\ncmluZyBmbHVzaAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSA9PSAwCiAgICAgICAgICAgICAgICB8fCAoX2ZsYWdzICYgRkxBR19T\nVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0\ncyBpdAogICAgICAgICAgICBpZiAoIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMo\nKS5jb250YWlucyhfY29uZi5PUFRJT05fSU5DX0ZMVVNIKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndAogICAgICAgICAgICAgICAgICAgICgiaW5jcmVtZW50YWwtZmx1c2gtbm90\nLXN1cHBvcnRlZCIpKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9\nIG51bGwgJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKQogICAgICAgICAgICAg\nICAgJiYgIV9zcG0uc3VwcG9ydHNJbmNyZW1lbnRhbEZsdXNoKCkpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICAgICAoInNhdmVwb2ludC1mbHVzaC1u\nb3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGZsdXNoU2FmZShGTFVTSF9JTkMpOwogICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgLy8gcm9s\nbGJhY2sgb24gZmx1c2ggZXJyb3I7IG9iamVjdHMgbWF5IGJlIGluIGluY29u\nc2lzdGVudCBzdGF0ZQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5\nKGtlKTsKICAgICAgICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUp\nOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsg\nb2JqZWN0cyBtYXkgYmUgaW4gaW5jb25zaXN0ZW50IHN0YXRlCiAgICAgICAg\nICAgICAgICBzZXRSb2xsYmFja09ubHkocmUpOwogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKS5zZXRGYXRhbCh0cnVlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHByZUZsdXNoKCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICBmbHVz\naFNhZmUoRkxVU0hfTE9HSUNBTCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHZhbGlkYXRlQ2hhbmdlcygpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyBpZiBubyB0cmFucywganVzdCByZXR1cm47IGlmIGFjdGl2ZSBkYXRhc3Rv\ncmUgdHJhbnMsIGZsdXNoCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDAp\nIHsKICAgICAgICAgICAgICAgIGZsdXNoKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3Vy\nZSB0aGUgcnVudGltZSBzdXBwb3J0cyBpbmMgZmx1c2gKICAgICAgICAgICAg\naWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMoX2NvbmYu\nT1BUSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAg\nICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7Cgog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZM\nVVNIX1JPTExCQUNLKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0FjdGl2ZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N0b3JlQWN0aXZlKCkgewogICAgICAg\nIC8vIHdlIG5lZWQgdG8gbG9jayBoZXJlLCBiZWNhdXNlIHdlIG1pZ2h0IGJl\nIGluIHRoZSBtaWRkbGUgb2YgYW4KICAgICAgICAvLyBhdG9taWMgdHJhbnNh\nY3Rpb24gcHJvY2VzcyAoZS5nLiwgY29tbWl0QW5kUmVzdW1lKQogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDA7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gaXMgZW5kaW5nLCBpLmUu\nIGluIHRoZSAybmQgcGhhc2UKICAgICAqIG9mIGEgY29tbWl0IG9yIHJvbGxi\nYWNrCiAgICAgKi8KICAgIGJvb2xlYW4gaXNUcmFuc2FjdGlvbkVuZGluZygp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfVFJBTlNfRU5ESU5H\nKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGJlZ2luT3BlcmF0\naW9uKGJvb2xlYW4gc3luY1RyYW5zKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKCiAgICAgICAg\nICAgIGlmIChzeW5jVHJhbnMgJiYgX29wZXJhdGlvbkNvdW50ID09IDAgJiYg\nX3N5bmNNYW5hZ2VkCiAgICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBzeW5jV2l0aE1hbmFn\nZWRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX29wZXJhdGlv\nbkNvdW50KysgPT0gMTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTWFyayB0aGUgb3BlcmF0aW9uIG92ZXIuIElmIG91dGVy\nbW9zdCBjYWxsZXIgb2Ygc3RhY2ssIHJldHVybnMgdHJ1ZQogICAgICogYW5k\nIHdpbGwgZGV0YWNoIG1hbmFnZWQgaW5zdGFuY2VzIGlmIG5lY2Vzc2FyeS4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZW5kT3BlcmF0aW9uKCkgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQg\nPT0gMSAmJiAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhSRUFEKSAhPSAw\nCiAgICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDApIHsKICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKG51bGwp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291\nbnQgPCAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJtdWx0aS10aHJlYWRlZC1hY2Nlc3MiKSk7CiAg\nICAgICAgICAgIHJldHVybiBfb3BlcmF0aW9uQ291bnQgPT0gMTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9vcGVyYXRp\nb25Db3VudC0tOwogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09\nIDApCiAgICAgICAgICAgICAgICBpbml0aWFsaXplT3BlcmF0aW5nU2V0KCk7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgU3luY2hyb25pemF0aW9uIGdldFN5bmNocm9uaXphdGlvbigpIHsK\nICAgICAgICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0U3luY2hyb25pemF0aW9uKFN5bmNocm9uaXphdGlvbiBzeW5jKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5jID0gc3luYzsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3luY2hyb25p\nemF0aW9uIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBiZWZv\ncmVDb21wbGV0aW9uKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB1c2VyLXN1cHBsaWVk\nIHN5bmNocm9uaXphdGlvbgogICAgICAgICAgICBpZiAoX3N5bmMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9zeW5jLmJlZm9yZUNvbXBsZXRpb24oKTsK\nCiAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9DT01NSVQpOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAg\nICAgICAgICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhj\nZXB0aW9uKGtlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJh\nbnMtZXJyb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVN\nYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihuZXcgU3RvcmVFeGNlcHRpb24o\ncmUpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYWZ0\nZXJDb21wbGV0aW9uKGludCBzdGF0dXMpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nQWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX1RSQU5TX0VORElORzsKICAgICAgICAgICAgZW5kVHJhbnNhY3Rpb24o\nc3RhdHVzKTsKICAgICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfc3luYy5hZnRlckNvbXBsZXRpb24oc3RhdHVzKTsKCiAg\nICAgICAgICAgIGlmICgoX2F1dG9EZXRhY2ggJiBERVRBQ0hfQ09NTUlUKSAh\nPSAwKQogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBTdGF0dXMuU1RBVFVT\nX1JPTExFREJBQ0sgCiAgICAgICAgICAgICAgICAmJiAoX2F1dG9EZXRhY2gg\nJiBERVRBQ0hfUk9MTEJBQ0spICE9IDApIHsKICAgICAgICAgICAgICAgIGRl\ndGFjaEFsbEludGVybmFsKG51bGwpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBpbiBhbiBlZSBjb250ZXh0LCBpdCdzIHBvc3NpYmxlIHRoYXQg\ndGhlIHVzZXIgdHJpZWQgdG8gY2xvc2UKICAgICAgICAgICAgLy8gdXMgYnV0\nIHdlIGRpZG4ndCBhY3R1YWxseSBjbG9zZSBiZWNhdXNlIHdlIHdlcmUgd2Fp\ndGluZyBvbiB0aGlzCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uOyBpZiB0\naGF0J3MgdHJ1ZSwgdGhlbiBjbG9zZSBub3cKICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX0NMT1NFX0lOVk9LRUQpICE9IDAKICAgICAgICAgICAg\nICAgICYmIF9jb21wYXQuZ2V0Q2xvc2VPbk1hbmFnZWRDb21taXQoKSkKICAg\nICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJlbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0aHJvdyB0\ncmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihrZSk7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIHJlKTsK\nICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25F\neGNlcHRpb24obmV3IFN0b3JlRXhjZXB0aW9uKHJlKSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0FDVElWRTsK\nICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RkxBR19UUkFOU19FTkRJTkc7CgogICAgICAgICAg\nICAvLyBldmVudCBtYW5hZ2VyIG51bGxlZCBpZiBmcmVlZCBicm9rZXIKICAg\nICAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlciAhPSBudWxsIAogICAg\nICAgICAgICAgICAgJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3Rl\nbmVycygpKSB7CiAgICAgICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVu\ndChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLAogICAgICAgICAgICAgICAg\nICAgIHN0YXR1cyA9PSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRAogICAgICAg\nICAgICAgICAgICAgICAgICA/IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09N\nTUlUX0NPTVBMRVRFCiAgICAgICAgICAgICAgICAgICAgICAgIDogVHJhbnNh\nY3Rpb25FdmVudC5BRlRFUl9ST0xMQkFDS19DT01QTEVURSwKICAgICAgICAg\nICAgICAgICAgICBudWxsLCBudWxsLCBudWxsLCBudWxsKSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIElmIHdlJ3JlIGluIGEgbWFuYWdlZCB0\ncmFuc2FjdGlvbiwgdXNlIG91ciBpbXBsaWNpdCBiZWhhdmlvciBleGNlcHRp\nb24KICAgICAqIHRyYW5zbGF0b3IgdG8gdHJhbnNsYXRlIGJlZm9yZS9hZnRl\nckNvbXBsZXRpb24gY2FsbGJhY2sgZXJyb3JzLgogICAgICovCiAgICBwcml2\nYXRlIFJ1bnRpbWVFeGNlcHRpb24gdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRp\nb25FeGNlcHRpb24KICAgICAgICAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgIHJldHVybiAoIV9tYW5hZ2VkIHx8IF9leHRyYW5zID09IG51bGwp\nID8gcmUgOiBfZXh0cmFucy50cmFuc2xhdGUocmUpOwogICAgfQoKICAgIC8q\nKgogICAgICogRmx1c2ggc2FmZWx5LCBjYXRjaGluZyByZWVudHJhbnQgY2Fs\nbHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBmbHVzaFNhZmUoaW50IHJl\nYXNvbikgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19GTFVTSElORykg\nIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgicmVlbnRyYW50LWZsdXNoIikpOwoKICAgICAgICBf\nZmxhZ3MgfD0gRkxBR19GTFVTSElORzsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBmbHVzaChyZWFzb24pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSElORzsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCB0aGUgdHJhbnNhY3Rpb25hbCBz\ndGF0ZSB0byB0aGUgZGF0YSBzdG9yZS4gU3ViY2xhc3NlcyB0aGF0CiAgICAg\nKiBjdXN0b21pemUgY29tbWl0IGJlaGF2aW9yIHNob3VsZCBvdmVycmlkZSB0\naGlzIG1ldGhvZC4gVGhlIG1ldGhvZAogICAgICogYXNzdW1lcyB0aGF0IHRo\nZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyIGlzIGxvY2tlZCwgaXMgbm90IGNsb3Nl\nZCwKICAgICAqIGFuZCBoYXMgYW4gYWN0aXZlIHRyYW5zYWN0aW9uLgogICAg\nICoKICAgICAqIEBwYXJhbSByZWFzb24gb25lIG9mIHtAbGluayAjRkxVU0hf\nSU5DfSwge0BsaW5rICNGTFVTSF9DT01NSVR9LAogICAgICoge0BsaW5rICNG\nTFVTSF9ST0xMQkFDS30sIG9yIHtAbGluayAjRkxVU0hfTE9HSUNBTH0KICAg\nICAqIEBzaW5jZSAwLjIuNQogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBm\nbHVzaChpbnQgcmVhc29uKSB7CiAgICAgICAgLy8gdGhpcyB3aWxsIGVubGlz\ndCBwcm94aWVkIHN0YXRlcyBhcyBuZWNlc3Nhcnkgc28gd2Uga25vdyB3aGV0\naGVyIHdlCiAgICAgICAgLy8gaGF2ZSBhbnl0aGluZyB0byBmbHVzaAogICAg\nICAgIENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCA9IGdldFRyYW5zYWN0aW9u\nYWxTdGF0ZXMoKTsKCiAgICAgICAgLy8gZG8gd2UgYWN0dWFsbHkgaGF2ZSB0\nbyBmbHVzaD8gIG9ubHkgaWYgb3VyIGZsYWdzIHNheSBzbywgb3IgaWYKICAg\nICAgICAvLyB3ZSBoYXZlIHRyYW5zYWN0aW9uIGxpc3RlbmVycyB0aGF0IG5l\nZWQgdG8gYmUgaW52b2tlZCBmb3IgY29tbWl0CiAgICAgICAgLy8gKG5vIG5l\nZWQgdG8gaW52b2tlIHRoZW0gb24gaW5jIGZsdXNoIGlmIG5vdGhpbmcgaXMg\nZGlydHkpLiAgd2UKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgdGhlIHJlbW90\nZSBjb21taXQgbGlzdGVuZXIgdXNlZCBieSB0aGUgZGF0YWNhY2hlIGNhdXNl\nCiAgICAgICAgLy8gd2Uga25vdyBpdCBkb2Vzbid0IHJlcXVpcmUgdGhlIGNv\nbW1pdCBldmVudCB3aGVuIG5vdGhpbmcgY2hhbmdlcwogICAgICAgIGJvb2xl\nYW4gZmx1c2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0g\nMDsKICAgICAgICBib29sZWFuIGxpc3RlbmVycyA9IChfdHJhbnNFdmVudE1h\nbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKQogICAgICAgICAgICB8fCBfdHJh\nbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpCiAgICAgICAgICAg\nICYmICgoX2ZsYWdzICYgRkxBR19SRU1PVEVfTElTVEVORVIpID09IDAKICAg\nICAgICAgICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmdldExpc3RlbmVycygp\nLnNpemUoKSA+IDEpOwogICAgICAgIGlmICghZmx1c2ggJiYgKHJlYXNvbiAh\nPSBGTFVTSF9DT01NSVQgfHwgIWxpc3RlbmVycykpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7CiAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfUFJFU1RPUklORzsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoZmx1c2gpIHsKICAgICAgICAgICAgICAgIC8vIGNh\nbGwgcHJlIHN0b3JlIG9uIGFsbCBjdXJyZW50bHkgdHJhbnNhY3Rpb25hbCBv\nYmpzCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5z\nYWN0aW9uYWwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAg\nICAgICAgICAgICAgKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpKS5i\nZWZvcmVGbHVzaChyZWFzb24sIF9jYWxsKTsKICAgICAgICAgICAgICAgIGZs\ndXNoQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGhvcGVmdWxseSBub3cgYWxsIGRlcGVu\nZGVudCBpbnN0YW5jZXMgdGhhdCBhcmUgZ29pbmcgdG8gZW5kCiAgICAgICAg\nICAgIC8vIHVwIHJlZmVyZW5jZWQgaGF2ZSBiZWVuIG1hcmtlZCBhcyBzdWNo\nOyBkZWxldGUgdW5yZWZlZAogICAgICAgICAgICAvLyBkZXBlbmRlbnRzCiAg\nICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0RFUkVGREVMRVRJTkc7CiAgICAg\nICAgICAgIGlmIChmbHVzaCAmJiBfZGVyZWZDYWNoZSAhPSBudWxsICYmICFf\nZGVyZWZDYWNoZS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX2RlcmVmQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlRGVyZWYoKFN0\nYXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCkpOwogICAgICAgICAgICAgICAg\nZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlYXNvbiAhPSBGTFVTSF9MT0dJ\nQ0FMKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBubyBkYXRhc3RvcmUgdHJh\nbnNhY3Rpb24sIHN0YXJ0IG9uZTsgZXZlbiBpZiB3ZSBkb24ndAogICAgICAg\nICAgICAgICAgLy8gdGhpbmsgd2UnbGwgbmVlZCB0byBmbHVzaCBhdCB0aGlz\nIHBvaW50LCBvdXIgdHJhbnNhY3Rpb24KICAgICAgICAgICAgICAgIC8vIGxp\nc3RlbmVycyBtaWdodCBpbnRyb2R1Y2Ugc29tZSBkaXJ0eSBvYmplY3RzIG9y\nIGludGVyYWN0CiAgICAgICAgICAgICAgICAvLyBkaXJlY3RseSB3aXRoIHRo\nZSBkYXRhYmFzZQogICAgICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX1NUT1JFX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICBiZWdp\nblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGZhbHNlKTsKCiAgICAgICAgICAg\nICAgICBpZiAoKF90cmFuc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVy\ncygpCiAgICAgICAgICAgICAgICAgICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2Vy\nLmhhc0VuZExpc3RlbmVycygpKQogICAgICAgICAgICAgICAgICAgICYmIChm\nbHVzaCB8fCByZWFzb24gPT0gRkxVU0hfQ09NTUlUKSkgewogICAgICAgICAg\nICAgICAgICAgIC8vIGZpcmUgZXZlbnRzCiAgICAgICAgICAgICAgICAgICAg\nbW9ianMgPSBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24odHJhbnNhY3Rp\nb25hbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVT\nSF9DT01NSVQKICAgICAgICAgICAgICAgICAgICAgICAgJiYgX3RyYW5zRXZl\nbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlv\nbkV2ZW50KHRoaXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJh\nbnNhY3Rpb25FdmVudC5CRUZPUkVfQ09NTUlULCBtb2JqcywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENs\nc3MsIF9kZWxldGVkQ2xzcykpOwoKICAgICAgICAgICAgICAgICAgICAgICAg\nZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZmx1c2ggPSAoX2ZsYWdzICYgRkxBR19GTFVT\nSF9SRVFVSVJFRCkgIT0gMDsKICAgICAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgICAgIGlmIChmbHVzaCAmJiBfdHJhbnNFdmVudE1hbmFn\nZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVu\ndCh0aGlzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0\naW9uRXZlbnQuQkVGT1JFX0ZMVVNILCBtb2JqcywKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9k\nZWxldGVkQ2xzcykpOwogICAgICAgICAgICAgICAgICAgICAgICBmbHVzaEFk\nZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX1BSRVNUT1JJTkc7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19ERVJFRkRFTEVUSU5HOwogICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMg\nPSBudWxsOwogICAgICAgICAgICBfZGVyZWZBZGRpdGlvbnMgPSBudWxsOwoK\nICAgICAgICAgICAgLy8gYWxzbyBjbGVhciBkZXJlZmVkIHNldDsgdGhlIGRl\nbGV0ZXMgaGF2ZSBiZWVuIHJlY29yZGVkCiAgICAgICAgICAgIGlmIChfZGVy\nZWZDYWNoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgX2RlcmVmQ2FjaGUg\nPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gZmx1c2ggdG8gc3RvcmUg\nbWFuYWdlcgogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoZmx1c2ggJiYgcmVhc29uICE9IEZMVVNI\nX0xPR0lDQUwpIHsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1NU\nT1JFX0ZMVVNISU5HOwogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4\nY2VwcywKICAgICAgICAgICAgICAgICAgICBuZXdGbHVzaEV4Y2VwdGlvbihf\nc3RvcmUuZmx1c2godHJhbnNhY3Rpb25hbCkpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19TVE9SRV9GTFVTSElORzsKCiAgICAgICAgICAgIGlmIChyZWFzb24gPT0g\nRkxVU0hfUk9MTEJBQ0spCiAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbih0cnVlKSk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMKQog\nICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIX1JFUVVJUkVE\nOwoKICAgICAgICAgICAgLy8gbWFyayBzdGF0ZXMgYXMgZmx1c2hlZAogICAg\nICAgICAgICBpZiAoZmx1c2gpIHsKICAgICAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc207CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHRyYW5zYWN0aW9uYWwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBs\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSBtYXkgaGF2ZSBiZWNv\nbWUgdHJhbnNpZW50LCBzdWNoIGFzIGlmCiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGl0IGlzIGVtYmVkZGVkIGFuZCB0aGUgb3duZXIgaGFzIGJlZW4g\nZGVsZXRlZCBkdXJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhp\ncyBmbHVzaCBwcm9jZXNzOyBidWcgIzExMDAKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRSQU5TSUVO\nVCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJGbHVzaChyZWFzb24pOwog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uID09IEZMVVNIX0lO\nQykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm90IGFi\nb3V0IHRvIGNsZWFyIHRyYW5zIGNhY2hlIGZvciBjb21taXQgCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvLyBhbnl3YXksIHJlLWNhY2hlIGRpcnR5\nIG9iamVjdHMgd2l0aCBkZWZhdWx0IHNvZnQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIHJlZnM7IHdlIGRvbid0IG5lZWQgaGFyZCByZWZzIG5v\ndyB0aGF0IHRoZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNo\nYW5nZXMgaGF2ZSBiZWVuIGZsdXNoZWQKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLnByb3h5RmllbGRzKHRydWUsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLmZsdXNoZWQoc20pOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgZSk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyB0byBzaG9ydGN1\ndCBsaXN0ZW5lcnMgb24gZmFpbAogICAgICAgIHRocm93TmVzdGVkRXhjZXB0\naW9ucyhleGNlcHMsIHRydWUpOwoKICAgICAgICBpZiAoZmx1c2ggJiYgcmVh\nc29uICE9IEZMVVNIX1JPTExCQUNLICYmIHJlYXNvbiAhPSBGTFVTSF9MT0dJ\nQ0FMCiAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5oYXNGbHVz\naExpc3RlbmVycygpKSB7CiAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2\nZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAgICAgICAg\nICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0ZMVVNILCBtb2JqcywgX3BlcnNp\nc3RlZENsc3MsCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3MsIF9kZWxl\ndGVkQ2xzcykpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZs\ndXNoIG5ld2x5LXRyYW5zYWN0aW9uYWwgb2JqZWN0cy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGZsdXNoQWRkaXRpb25zKENvbGxlY3Rpb24gdHJhbnNh\nY3Rpb25hbCwgaW50IHJlYXNvbikgewogICAgICAgIGJvb2xlYW4gbG9vcDsK\nICAgICAgICBkbyB7CiAgICAgICAgICAgIC8vIGZsdXNoIG5ldyB0cmFuc2Fj\ndGlvbmFsIGluc3RhbmNlczsgbm90ZSBsb2dpY2FsIG9yCiAgICAgICAgICAg\nIGxvb3AgPSBmbHVzaFRyYW5zQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJl\nYXNvbikKICAgICAgICAgICAgICAgIHwgZGVsZXRlRGVyZWZBZGRpdGlvbnMo\nX2RlcmVmQ2FjaGUpOwogICAgICAgIH0gd2hpbGUgKGxvb3ApOwogICAgfQoK\nICAgIC8qKgogICAgICogRmx1c2ggdHJhbnNhY3Rpb25hbCBhZGRpdGlvbnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBmbHVzaFRyYW5zQWRkaXRp\nb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCwgaW50IHJlYXNvbikgewog\nICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCB8fCBfdHJhbnNB\nZGRpdGlvbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIC8vIGtlZXAgbG9jYWwgdHJhbnNhY3Rpb25hbCBsaXN0IGNv\ncHkgdXAgdG8gZGF0ZQogICAgICAgIHRyYW5zYWN0aW9uYWwuYWRkQWxsKF90\ncmFuc0FkZGl0aW9ucyk7CgogICAgICAgIC8vIGNvcHkgdGhlIGNoYW5nZSBz\nZXQsIHRoZW4gY2xlYXIgaXQgZm9yIHRoZSBuZXh0IGl0ZXJhdGlvbgogICAg\nICAgIFN0YXRlTWFuYWdlckltcGxbXSBzdGF0ZXMgPSAoU3RhdGVNYW5hZ2Vy\nSW1wbFtdKSBfdHJhbnNBZGRpdGlvbnMuCiAgICAgICAgICAgIHRvQXJyYXko\nbmV3IFN0YXRlTWFuYWdlckltcGxbX3RyYW5zQWRkaXRpb25zLnNpemUoKV0p\nOwogICAgICAgIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBzdGF0ZXNbaV0uYmVmb3JlRmx1c2gocmVhc29uLCBfY2FsbCk7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxl\ndGUgbmV3IGRlcmVmZXJlbmNlZCBvYmplY3RzLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gZGVsZXRlRGVyZWZBZGRpdGlvbnMoQ29sbGVjdGlvbiBk\nZXJlZnMpIHsKICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zID09IG51bGwg\nfHwgX2RlcmVmQWRkaXRpb25zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwoKICAgICAgICAvLyByZW1lbWJlciB0aGVzZSBhZGRpdGlv\nbnMgaW4gY2FzZSBvbmUgYmVjb21lcyBkZXJlZmVkIGFnYWluIGxhdGVyCiAg\nICAgICAgZGVyZWZzLmFkZEFsbChfZGVyZWZBZGRpdGlvbnMpOwoKICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsW10gc3RhdGVzID0gKFN0YXRlTWFuYWdlcklt\ncGxbXSkgX2RlcmVmQWRkaXRpb25zLgogICAgICAgICAgICB0b0FycmF5KG5l\ndyBTdGF0ZU1hbmFnZXJJbXBsW19kZXJlZkFkZGl0aW9ucy5zaXplKCldKTsK\nICAgICAgICBfZGVyZWZBZGRpdGlvbnMgPSBudWxsOwoKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgZGVsZXRlRGVyZWYoc3RhdGVzW2ldKTsKICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBhIGRlcmVmZXJlbmNl\nZCBkZXBlbmRlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkZWxldGVE\nZXJlZihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaW50IGFjdGlv\nbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9ERUxFVEUsCiAg\nICAgICAgICAgIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBzbSwgbnVsbCk7\nCiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSAh\nPSAwKQogICAgICAgICAgICBzbS5kZWxldGUoKTsKICAgICAgICBpZiAoKGFj\ndGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQogICAgICAg\nICAgICBzbS5jYXNjYWRlRGVsZXRlKF9jYWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIERldGVybWluZSB0aGUgYWN0aW9uIHRvIHRha2UgYmFzZWQgb24g\ndGhlIHVzZXIncyBnaXZlbiBjYWxsYmFja3MgYW5kCiAgICAgKiBvdXIgaW1w\nbGljaXQgYmVoYXZpb3IuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHByb2Nl\nc3NBcmd1bWVudChpbnQgb3AsIE9iamVjdCBvYmosIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmIChjYWxsICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjYWxsLnBy\nb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7CiAgICAgICAgaWYgKF9jYWxs\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FsbC5wcm9jZXNzQXJn\ndW1lbnQob3AsIG9iaiwgc20pOwogICAgICAgIHJldHVybiBPcENhbGxiYWNr\ncy5BQ1RfUlVOIHwgT3BDYWxsYmFja3MuQUNUX0NBU0NBREU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaHJvdyB0aGUgcHJvcGVyIGV4Y2VwdGlvbiBiYXNl\nZCBvbiB0aGUgZ2l2ZW4gc2V0IG9mIGZsdXNoIGVycm9ycywgb3IKICAgICAq\nIGRvIG5vdGhpbmcgaWYgbm8gZXJyb3JzIG9jY3VycmVkLgogICAgICovCiAg\nICBwcml2YXRlIE9wZW5KUEFFeGNlcHRpb24gbmV3Rmx1c2hFeGNlcHRpb24o\nQ29sbGVjdGlvbiBleGNlcHMpIHsKICAgICAgICBpZiAoZXhjZXBzID09IG51\nbGwgfHwgZXhjZXBzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIFRocm93YWJsZVtdIHQgPSAoVGhyb3dhYmxlW10pIGV4\nY2Vwcy50b0FycmF5CiAgICAgICAgICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vw\ncy5zaXplKCldKTsKICAgICAgICBMaXN0IGZhaWxlZCA9IG5ldyBBcnJheUxp\nc3QodC5sZW5ndGgpOwoKICAgICAgICAvLyBjcmVhdGUgZmF0YWwgZXhjZXB0\naW9uIHdpdGggbmVzdGVkIGV4Y2VwdGlvbnMgZm9yIGFsbCB0aGUgZmFpbGVk\nCiAgICAgICAgLy8gb2JqZWN0czsgaWYgYWxsIE9MIGV4Y2VwdGlvbnMsIHRo\ncm93IGEgdG9wLWxldmVsIE9MIGV4Y2VwdGlvbgogICAgICAgIGJvb2xlYW4g\nb3B0ID0gdHJ1ZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgb3B0ICYmIGkg\nPCB0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG9wdCA9IHRbaV0gaW5z\ndGFuY2VvZiBPcHRpbWlzdGljRXhjZXB0aW9uOwogICAgICAgICAgICBpZiAo\nb3B0KSB7CiAgICAgICAgICAgICAgICBPYmplY3QgZiA9ICgoT3B0aW1pc3Rp\nY0V4Y2VwdGlvbikgdFtpXSkuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAg\nICAgICAgICBpZiAoZiAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZh\naWxlZC5hZGQoZik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\naWYgKG9wdCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkgewogICAgICAgICAgICBp\nZihfc3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmcgPT0gdHJ1ZSl7CiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRpb24oX2xvYy5n\nZXQoImJyb2tlci1zdXBwcmVzc2luZy1leGNlcHRpb25zIix0Lmxlbmd0aCkp\nOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihmYWlsZWQsIHQpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHQpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbih0KTsKICAgICAgICByZXR1\ncm4gbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyb2xsZWQtYmFjayIp\nKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyh0KS5zZXRGYXRh\nbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuZCB0aGUgY3VycmVu\ndCB0cmFuc2FjdGlvbiwgbWFraW5nIGFwcHJvcHJpYXRlIHN0YXRlIHRyYW5z\naXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBlbmRUcmFuc2Fj\ndGlvbihpbnQgc3RhdHVzKSB7CiAgICAgICAgLy8gaWYgYSBkYXRhIHN0b3Jl\nIHRyYW5zYWN0aW9uIHdhcyBpbiBwcm9ncmVzcywgZG8gdGhlCiAgICAgICAg\nLy8gYXBwcm9wcmlhdGUgdHJhbnNhY3Rpb24gY2hhbmdlCiAgICAgICAgYm9v\nbGVhbiByb2xsYmFjayA9IHN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX0NPTU1J\nVFRFRDsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CgogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGVuZFN0b3Jl\nTWFuYWdlclRyYW5zYWN0aW9uKHJvbGxiYWNrKSk7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICByb2xsYmFj\nayA9IHRydWU7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJl\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGdvIGJhY2sgdG8gZGVmYXVsdCBu\nb25lIGxvY2sgbGV2ZWwKICAgICAgICBfZmMuc2V0UmVhZExvY2tMZXZlbChM\nT0NLX05PTkUpOwogICAgICAgIF9mYy5zZXRXcml0ZUxvY2tMZXZlbChMT0NL\nX05PTkUpOwogICAgICAgIF9mYy5zZXRMb2NrVGltZW91dCgtMSk7CgogICAg\nICAgIENvbGxlY3Rpb24gdHJhbnNTdGF0ZXM7CiAgICAgICAgaWYgKGhhc1Ry\nYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAgICAgICAgIHRyYW5zU3RhdGVz\nID0gX3RyYW5zQ2FjaGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0cmFu\nc1N0YXRlcyA9IENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKCiAgICAgICAgLy8g\nZmlyZSBhZnRlciByb2xsYmFjay9jb21taXQgZXZlbnQKICAgICAgICBDb2xs\nZWN0aW9uIG1vYmpzID0gbnVsbDsKICAgICAgICBpZiAoX3RyYW5zRXZlbnRN\nYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7CiAgICAgICAgICAgIG1vYmpz\nID0gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHRyYW5zU3RhdGVzKTsK\nICAgICAgICAgICAgaW50IGV2ZW50VHlwZSA9IChyb2xsYmFjaykgPyBUcmFu\nc2FjdGlvbkV2ZW50LkFGVEVSX1JPTExCQUNLCiAgICAgICAgICAgICAgICA6\nIFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09NTUlUOwogICAgICAgICAgICBm\naXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlz\nLCBldmVudFR5cGUsIG1vYmpzLCAKICAgICAgICAgICAgICAgIF9wZXJzaXN0\nZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gbnVsbCB0cmFuc2FjdGlvbmFsIGNhY2hlcyBub3cg\nc28gdGhhdCBhbGwgdGhlIHJlbW92ZUZyb21UcmFuc2FjdGlvbgogICAgICAg\nIC8vIGNhbGxzIGFzIHdlIHRyYW5zaXRpb24gZWFjaCBvYmplY3QgZG9uJ3Qg\naGF2ZSB0byBkbyBhbnkgd29yazsgZG9uJ3QKICAgICAgICAvLyBjbGVhciB0\ncmFucyBjYWNoZSBvYmplY3QgYmVjYXVzZSB3ZSBzdGlsbCBuZWVkIHRoZSB0\ncmFuc1N0YXRlcwogICAgICAgIC8vIHJlZmVyZW5jZSB0byBpdCBiZWxvdwog\nICAgICAgIF90cmFuc0NhY2hlID0gbnVsbDsKICAgICAgICBpZiAoX3BlcnNp\nc3RlZENsc3MgIT0gbnVsbCkKICAgICAgICAgICAgX3BlcnNpc3RlZENsc3Mg\nPSBudWxsOwogICAgICAgIGlmIChfdXBkYXRlZENsc3MgIT0gbnVsbCkKICAg\nICAgICAgICAgX3VwZGF0ZWRDbHNzID0gbnVsbDsKICAgICAgICBpZiAoX2Rl\nbGV0ZWRDbHNzICE9IG51bGwpCiAgICAgICAgICAgIF9kZWxldGVkQ2xzcyA9\nIG51bGw7CgogICAgICAgIC8vIG5ldyBjYWNoZSB3b3VsZCBnZXQgY2xlYXJl\nZCBhbnl3YXkgZHVyaW5nIHRyYW5zaXRpb25zLCBidXQgZG9pbmcgc28KICAg\nICAgICAvLyBpbW1lZGlhdGVseSBzYXZlcyB1cyBzb21lIGxvb2t1cHMKICAg\nICAgICBfY2FjaGUuY2xlYXJOZXcoKTsKCiAgICAgICAgLy8gdGVsbCBhbGwg\nZGVyZWZlZCBpbnN0YW5jZXMgdGhleSdyZSBubyBsb25nZXIgZGVyZWZlZDsg\nd2UgY2FuJ3QKICAgICAgICAvLyByZWx5IG9uIHJvbGxiYWNrIGFuZCBjb21t\naXQgY2FsbHMgYmVsb3cgY2F1c2Ugc29tZSBpbnN0YW5jZXMgbWlnaHQKICAg\nICAgICAvLyBub3QgYmUgdHJhbnNhY3Rpb25hbAogICAgICAgIGlmIChfZGVy\nZWZDYWNoZSAhPSBudWxsICYmICFfZGVyZWZDYWNoZS5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGVyZWZDYWNoZS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICgo\nU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkuc2V0RGVyZWZlcmVuY2Vk\nRGVwZW5kZW50CiAgICAgICAgICAgICAgICAgICAgKGZhbHNlLCBmYWxzZSk7\nCiAgICAgICAgICAgIF9kZXJlZkNhY2hlID0gbnVsbDsKICAgICAgICB9Cgog\nICAgICAgIC8vIHBlZm9ybSBjb21taXQgb3Igcm9sbGJhY2sgc3RhdGUgdHJh\nbnNpdGlvbnMgb24gZWFjaCBpbnN0YW5jZQogICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc207CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0cmFuc1N0\nYXRlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNrKSB7CiAg\nICAgICAgICAgICAgICAgICAgLy8gdGVsbCBvYmplY3RzIHRoYXQgbWF5IGhh\ndmUgYmVlbiBkZXJlZmVkIHRoZW4gZmx1c2hlZAogICAgICAgICAgICAgICAg\nICAgIC8vIChhbmQgdGhlcmVmb3JlIGRlbGV0ZWQpIHRvIHVuLWRlcmVmCiAg\nICAgICAgICAgICAgICAgICAgc20uc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50\nKGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgc20ucm9sbGJh\nY2soKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNtLmNvbW1pdCgpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCByZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIG5vdGlmeSB0aGUgbG9jayBtYW5hZ2VyIHRvIGNsZWFuIHVwIGFuZCBy\nZWxlYXNlIHJlbWFpbmluZyBsb2NrcwogICAgICAgIF9sbS5lbmRUcmFuc2Fj\ndGlvbigpOwoKICAgICAgICAvLyBjbGVhciBvbGQgc2F2ZXBvaW50cyBpbiBy\nZXZlcnNlCiAgICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOwogICAgICAg\nIHdoaWxlIChfc2F2ZXBvaW50cyAhPSBudWxsICYmIF9zYXZlcG9pbnRzLnNp\nemUoKSA+IDApIHsKICAgICAgICAgICAgc2F2ZSA9CiAgICAgICAgICAgICAg\nICAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKF9zYXZl\ncG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICBzYXZlLnJlbGVhc2Uo\nZmFsc2UpOwogICAgICAgIH0KICAgICAgICBfc2F2ZXBvaW50cyA9IG51bGw7\nCiAgICAgICAgX3NhdmVwb2ludENhY2hlID0gbnVsbDsKCiAgICAgICAgLy8g\nZmlyZSBhZnRlciBzdGF0ZSBjaGFuZ2UgZXZlbnQKICAgICAgICBpZiAoX3Ry\nYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKQogICAgICAgICAg\nICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0\naGlzLCBUcmFuc2FjdGlvbkV2ZW50LgogICAgICAgICAgICAgICAgQUZURVJf\nU1RBVEVfVFJBTlNJVElPTlMsIG1vYmpzLCBudWxsLCBudWxsLCBudWxsKSk7\nCgogICAgICAgIC8vIG5vdyBjbGVhciB0cmFucyBjYWNoZTsga2VlcCBjbGVh\ncmVkIHZlcnNpb24gcmF0aGVyIHRoYW4KICAgICAgICAvLyBudWxsIHRvIGF2\nb2lkIGhhdmluZyB0byByZS1jcmVhdGUgdGhlIHNldCBsYXRlcjsgbW9yZSBl\nZmZpY2llbnQKICAgICAgICBpZiAodHJhbnNTdGF0ZXMgIT0gQ29sbGVjdGlv\nbnMuRU1QVFlfU0VUKSB7CiAgICAgICAgICAgIF90cmFuc0NhY2hlID0gKFRy\nYW5zYWN0aW9uYWxDYWNoZSkgdHJhbnNTdGF0ZXM7CiAgICAgICAgICAgIF90\ncmFuc0NhY2hlLmNsZWFyKCk7CiAgICAgICAgfQoKICAgICAgICB0aHJvd05l\nc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCB0cnVlKTsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gT2JqZWN0IGxpZmVjeWNsZQogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0\nKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBwZXJz\naXN0KG9iaiwgbnVsbCwgdHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgcGVyc2lzdChPYmplY3Qgb2JqLCBPYmpl\nY3QgaWQsCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHJl\ndHVybiBwZXJzaXN0KG9iaiwgaWQsIHRydWUsIGNhbGwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHBlcnNpc3RBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcGVyc2lzdEFsbChvYmpzLCB0cnVl\nLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdp\ndmVuIG9iamVjdHMuICBJbmRpY2F0ZSB3aGV0aGVyIHRoaXMgd2FzIGFuIGV4\ncGxpY2l0IHBlcnNpc3QKICAgICAqIChQTkVXKSBvciBhIHByb3Zpc29uYWwg\ncGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFMKS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgcGVyc2lzdEFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZXhw\nbGljaXQsIAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgTGlzdCBleGNlcHMg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRl\nT3BlcmF0aW9uKCk7CgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGVyc2lzdChpdHIu\nbmV4dCgpLCBleHBsaWNpdCwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIElmIHRoZSBnaXZlbiBlbGVtZW50IGlzIG5vdCBudWxsLCBhZGQgaXQg\ndG8gdGhlIGdpdmVuIGxpc3QsCiAgICAgKiBjcmVhdGluZyB0aGUgbGlzdCBp\nZiBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdCBhZGQoTGlz\ndCBsLCBPYmplY3QgbykgewogICAgICAgIGlmIChvID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBsOwogICAgICAgIGlmIChsID09IG51bGwpCiAgICAg\nICAgICAgIGwgPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAgIGwuYWRkKG8p\nOwogICAgICAgIHJldHVybiBsOwogICAgfQoKICAgIC8qKgogICAgICogVGhy\nb3cgYW4gZXhjZXB0aW9uIHdyYXBwaW5nIHRoZSBnaXZlbiBuZXN0ZWQgZXhj\nZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhMaXN0IGV4Y2VwcywgYm9vbGVhbiBkYXRhc3RvcmUpIHsK\nICAgICAgICBpZiAoZXhjZXBzID09IG51bGwgfHwgZXhjZXBzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChkYXRhc3RvcmUg\nJiYgZXhjZXBzLnNpemUoKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAoUnVu\ndGltZUV4Y2VwdGlvbikgZXhjZXBzLmdldCgwKTsKCiAgICAgICAgYm9vbGVh\nbiBmYXRhbCA9IGZhbHNlOwogICAgICAgIFRocm93YWJsZVtdIHQgPSAoVGhy\nb3dhYmxlW10pIGV4Y2Vwcy50b0FycmF5CiAgICAgICAgICAgIChuZXcgVGhy\nb3dhYmxlW2V4Y2Vwcy5zaXplKCldKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRbaV0g\naW5zdGFuY2VvZiBPcGVuSlBBRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAm\nJiAoKE9wZW5KUEFFeGNlcHRpb24pIHRbaV0pLmlzRmF0YWwoKSkKICAgICAg\nICAgICAgICAgIGZhdGFsID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgT3Bl\nbkpQQUV4Y2VwdGlvbiBlcnI7CiAgICAgICAgaWYgKGRhdGFzdG9yZSkKICAg\nICAgICAgICAgZXJyID0gbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nZXN0ZWQtZXhjZXBzIikpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZXJy\nID0gbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMi\nKSk7CiAgICAgICAgdGhyb3cgZXJyLnNldE5lc3RlZFRocm93YWJsZXModCku\nc2V0RmF0YWwoZmF0YWwpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lz\ndCB0aGUgZ2l2ZW4gb2JqZWN0LiAgSW5kaWNhdGUgd2hldGhlciB0aGlzIHdh\ncyBhbiBleHBsaWNpdCBwZXJzaXN0CiAgICAgKiAoUE5FVykgb3IgYSBwcm92\naXNvbmFsIHBlcnNpc3QgKFBORVdQUk9WSVNJT05BTCkKICAgICAqLwogICAg\ncHVibGljIHZvaWQgcGVyc2lzdChPYmplY3Qgb2JqLCBib29sZWFuIGV4cGxp\nY2l0LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcGVyc2lzdChvYmos\nIG51bGwsIGV4cGxpY2l0LCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdC4gIEluZGljYXRlIHdoZXRoZXIg\ndGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lzdAogICAgICogKFBORVcpIG9y\nIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVXUFJPVklTSU9OQUwpLgogICAg\nICogU2VlIHtAbGluayBCcm9rZXJ9IGZvciBkZXRhaWxzIG9uIHRoaXMgbWV0\naG9kLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdlciBw\nZXJzaXN0KE9iamVjdCBvYmosIE9iamVjdCBpZCwgYm9vbGVhbiBleHBsaWNp\ndCwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9i\naiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKCiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1\nZSk7CiAgICAgICAgICAgIGlmICghX29wZXJhdGluZy5hZGQob2JqKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBzbTsKCiAgICAgICAgICAgIGludCBhY3Rp\nb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUEVSU0lTVCwg\nb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gT3BD\nYWxsYmFja3MuQUNUX05PTkUpCiAgICAgICAgICAgICAgICByZXR1cm4gc207\nCgogICAgICAgICAgICAvLyBBQ1RfQ0FTQ0FERQogICAgICAgICAgICBpZiAo\nKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApIHsKICAgICAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxs\nYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBjYWxsLAogICAgICAgICAgICAgICAg\nICAgICAgICAicGVyc2lzdCIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHNt\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBQ1RfUlVOCiAgICAg\nICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYzsKICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFj\naGVkKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4\naXN0c0V4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAg\nICAoInBlcnNpc3QtZGV0YWNoZWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9i\naikpKS4KICAgICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0\nKG9iaik7CgogICAgICAgICAgICAgICAgaWYgKCFzbS5pc0VtYmVkZGVkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBzbS5wZXJzaXN0KCk7CiAgICAgICAg\nICAgICAgICAgICAgX2NhY2hlLnBlcnNpc3Qoc20pOwogICAgICAgICAgICAg\nICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUp\nICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJz\naXN0KGNhbGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzbTsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBhbiBlbWJlZGRl\nZCBmaWVsZDsgbm90aWZ5IHRoZSBvd25lciB0aGF0IHRoZSB2YWx1ZSBoYXMK\nICAgICAgICAgICAgICAgIC8vIGNoYW5nZWQgYnkgYmVjb21pbmcgaW5kZXBl\nbmRlbnRseSBwZXJzaXN0ZW50CiAgICAgICAgICAgICAgICBzbS5nZXRPd25l\ncigpLmRpcnR5KHNtLmdldE93bmVySW5kZXgoKSk7CiAgICAgICAgICAgICAg\nICBfY2FjaGUucGVyc2lzdChzbSk7CiAgICAgICAgICAgICAgICBwYyA9IHNt\nLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqKTsKICAgICAgICAgICAgICAgIGlmIChwYy5wY0lzRGV0YWNoZWQo\nKSA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAg\nICAgICAgICAgICAgICAoInBlcnNpc3QtZGV0YWNoZWQiLCBFeGNlcHRpb25z\nLnRvU3RyaW5nKG9iaikpKS4KICAgICAgICAgICAgICAgICAgICAgICAgc2V0\nRmFpbGVkT2JqZWN0KG9iaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3Np\ndG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShv\nYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIGZp\ncmVMaWZlY3ljbGVFdmVudChvYmosIG51bGwsIG1ldGEsIExpZmVjeWNsZUV2\nZW50LkJFRk9SRV9QRVJTSVNUKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBp\nZCBmb3IgaW5zdGFuY2UKICAgICAgICAgICAgaWYgKGlkID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAg\nICAgICAgaWQgPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUocGMsIG1ldGEpOwog\nICAgICAgICAgICAgICAgZWxzZSBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEt\ndW5rbm93bmlkIiwgbWV0YSkpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFu\nY2UodGhpcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSB3ZSBkb24ndCBhbHJlYWR5IGhhdmUgdGhlIGluc3RhbmNlIGNhY2hl\nZAogICAgICAgICAgICBjaGVja0ZvckR1cGxpY2F0ZUlkKGlkLCBvYmopOwoK\nICAgICAgICAgICAgLy8gaWYgaGFkIGVtYmVkZGVkIHNtLCBudWxsIGl0CiAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGMu\ncGNSZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwoKICAgICAgICAgICAgLy8g\nY3JlYXRlIG5ldyBzbQogICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFn\nZXJJbXBsKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYg\nKGV4cGxpY2l0KQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUo\ncGMsIFBDU3RhdGUuUE5FVyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTkVX\nUFJPVklTSU9OQUwpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgIHNtLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5PTlRSQU5TTkVXKTsK\nICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FT\nQ0FERSkgIT0gMCkKICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0\nKGNhbGwpOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZW1wb3JhcmlseSBt\nYW5hZ2UgdGhlIGdpdmVuIGluc3RhbmNlIGluIG9yZGVyIHRvIGNhc2NhZGUg\ndGhlIGdpdmVuCiAgICAgKiBvcGVyYXRpb24gdGhyb3VnaCBpdC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGNhc2NhZGVUcmFuc2llbnQoaW50IG9wLCBP\nYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFN0cmluZyBl\ncnJPcCkgewogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IGFzc2Vy\ndFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopOwoKICAgICAgICAvLyBpZiB1c2lu\nZyBkZXRhY2hlZCBzdGF0ZSBtYW5hZ2VyLCBkb24ndCByZXBsYWNlCiAgICAg\nICAgaWYgKHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCBlcnJPcCk7\nCgogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFE\nYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwoU3Rh\ndGVNYW5hZ2VySWQuCiAgICAgICAgICAgIG5ld0luc3RhbmNlKHRoaXMpLCBt\nZXRhLCB0aGlzKTsKICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRl\nLlRMT0FERUQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAo\nb3ApIHsKICAgICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfUEVS\nU0lTVDoKICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChj\nYWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfREVMRVRFOgogICAgICAgICAgICAg\nICAgICAgIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tz\nLk9QX1JFRlJFU0g6CiAgICAgICAgICAgICAgICAgICAgc20uZ2F0aGVyQ2Fz\nY2FkZVJlZnJlc2goY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihv\ncCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBkZWxldGVBbGwoQ29sbGVjdGlvbiBvYmpz\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVP\ncGVyYXRpb24oKTsKCiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsK\nICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG9i\naiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUob2JqLCBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSksIGNhbGwpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvd05l\nc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZShPYmplY3Qgb2JqLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0\naW9uKCk7CiAgICAgICAgICAgIGRlbGV0ZShvYmosIGdldFN0YXRlTWFuYWdl\nckltcGwob2JqLCB0cnVlKSwgY2FsbCk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBkZWxldGUuCiAg\nICAgKi8KICAgIHZvaWQgZGVsZXRlKE9iamVjdCBvYmosIFN0YXRlTWFuYWdl\nckltcGwgc20sIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoIV9v\ncGVyYXRpbmcuYWRkKG9iaikpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5P\nUF9ERUxFVEUsIG9iaiwgc20sIGNhbGwpOwogICAgICAgIGlmIChhY3Rpb24g\nPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgLy8gQUNUX0NBU0NBREUKICAgICAgICBpZiAoKGFjdGlvbiAm\nIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApIHsKICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwpCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRl\nKGNhbGwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjYXNj\nYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tzLk9QX0RFTEVURSwgb2JqLCBjYWxs\nLCAiZGVsZXRlIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIC8vIEFDVF9SVU4KICAgICAgICBpZiAoc20gIT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAiZGVsZXRlIik7\nCiAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NB\nU0NBREUpICE9IDApCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRl\nKGNhbGwpOwogICAgICAgICAgICBzbS5kZWxldGUoKTsKICAgICAgICB9IGVs\nc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRh\nY2hlZCgpID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgdGhyb3cgbmV3\nRGV0YWNoZWRFeGNlcHRpb24ob2JqLCAiZGVsZXRlIik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24gaW5kaWNhdGluZyB0aGF0\nIHRoZSBjdXJyZW50IGFjdGlvbiBjYW4ndCBiZQogICAgICogcGVyZm9ybWVk\nIG9uIGEgZGV0YWNoZWQgb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIE9w\nZW5KUEFFeGNlcHRpb24gbmV3RGV0YWNoZWRFeGNlcHRpb24oT2JqZWN0IG9i\naiwKICAgICAgICBTdHJpbmcgb3BlcmF0aW9uKSB7CiAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kZXRhY2hlZC1vcCIs\nIG9wZXJhdGlvbiwKICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhv\nYmopKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVsZWFzZUFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgcmVsZWFzZShpdHIubmV4dCgpLCBjYWxsKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhy\nb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlKE9iamVjdCBvYmos\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAg\nICAgICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxs\nYmFja3MuT1BfUkVMRUFTRSwgb2JqLCBzbSwgY2FsbCk7CgogICAgICAgICAg\nICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSAh\nPSAwICYmIHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICBi\nb29sZWFuIHBlbmRpbmcgPSBzbS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCk7\nCiAgICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgICAg\nICAgICAgaWYgKHBlbmRpbmcpCiAgICAgICAgICAgICAgICAgICAgcmVtb3Zl\nRnJvbVBlbmRpbmdUcmFuc2FjdGlvbihzbSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGVtYmVkKE9iamVjdCBvYmosIE9iamVj\ndCBpZCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBWYWx1\nZU1ldGFEYXRhIG93bmVyTWV0YSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgb3JpZyA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsK\nICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgLy8gaWYgYWxyZWFkeSBlbWJlZGRlZCwgbm90aGluZyB0byBkbwogICAg\nICAgICAgICAgICAgaWYgKG9yaWcuZ2V0T3duZXIoKSA9PSBvd25lciAmJiBv\ncmlnLmdldE1ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RW1i\nZWRkaW5nTWV0YURhdGEoKSA9PSBvd25lck1ldGEpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG9yaWc7CgogICAgICAgICAgICAgICAgLy8gb3RoZXJ3\naXNlIG1ha2Ugc3VyZSBwYyBpcyBmdWxseSBsb2FkZWQgZm9yIHdoZW4gd2Ug\nY29weSBpdHMKICAgICAgICAgICAgICAgIC8vIGRhdGEgYmVsb3cKICAgICAg\nICAgICAgICAgIG9yaWcubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9B\nRF9BTEwsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gY3JlYXRlIG5ldyBzdGF0ZSBtYW5hZ2VyIHdpdGggZW1i\nZWRkZWQgbWV0YWRhdGEKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nID0gb3duZXJNZXRhLmdldEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICAg\nICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWVtYmVkIiwgb3du\nZXJNZXRhKSk7CgogICAgICAgICAgICBpZiAoaWQgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhp\ncyk7CgogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gbmV3IFN0\nYXRlTWFuYWdlckltcGwoaWQsIG1ldGEsIHRoaXMpOwogICAgICAgICAgICBz\nbS5zZXRPd25lcigoU3RhdGVNYW5hZ2VySW1wbCkgb3duZXIsIG93bmVyTWV0\nYSk7CgogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgY29weTsKICAg\nICAgICAgICAgUENTdGF0ZSBzdGF0ZTsKICAgICAgICAgICAgQ2xhc3MgdHlw\nZSA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBpZiAo\nb2JqICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGdpdmUgY29weSBh\nbmQgdGhlIG9yaWdpbmFsIGluc3RhbmNlIHRoZSBzYW1lIHN0YXRlIG1hbmFn\nZXIKICAgICAgICAgICAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIGNvcHkgZmll\nbGRzIGZyb20gb25lIHRvIHRoZSBvdGhlcgogICAgICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBjb3B5U007CiAgICAgICAgICAgICAgICBQZXJzaXN0\nZW5jZUNhcGFibGUgcGM7CiAgICAgICAgICAgICAgICBpZiAob3JpZyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY29weVNNID0gc207CiAgICAg\nICAgICAgICAgICAgICAgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUo\nb2JqKTsKICAgICAgICAgICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1h\nbmFnZXIoc20pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICBjb3B5U00gPSBvcmlnOwogICAgICAgICAgICAgICAgICAg\nIHBjID0gb3JpZy5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIC8vIGNvcHkgdGhlIGluc3RhbmNlLiAgd2UgZG8gdGhpcyBldmVu\nIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgIC8v\nIGhhdmUgYSBzdGF0ZSBtYW5hZ2VyIGluIGNhc2UgaXQgaXMgbGF0ZXIgYXNz\naWduZWQgdG8gYQogICAgICAgICAgICAgICAgICAgIC8vIFBDIGZpZWxkOyBh\ndCB0aGF0IHBvaW50IGl0J3MgdG9vIGxhdGUgdG8gY29weQogICAgICAgICAg\nICAgICAgICAgIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUs\nIGNvcHlTTSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGludFtdIGZp\nZWxkcyA9IG5ldyBpbnRbbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGhdOwogICAg\nICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0g\nPSBpOwogICAgICAgICAgICAgICAgICAgIGNvcHkucGNDb3B5RmllbGRzKHBj\nLCBmaWVsZHMpOwogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0\nZS5FQ09QWTsKICAgICAgICAgICAgICAgICAgICBjb3B5LnBjUmVwbGFjZVN0\nYXRlTWFuYWdlcihudWxsKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGluc3RhbmNlIGRpZG4n\ndCBoYXZlIGEgc3RhdGUgbWFuYWdlciB0byBzdGFydCwKICAgICAgICAgICAg\nICAgICAgICAvLyByZXZlcnQgaXQgdG8gYmVpbmcgdHJhbnNpZW50CiAgICAg\nICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgY29weSA9IFBDUmVnaXN0cnkubmV3SW5zdGFuY2UodHlwZSwg\nc20sIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpICE9IDAgJiYgIV9vcHRpbWlzdGljKQogICAgICAgICAgICAg\nICAgICAgIHN0YXRlID0gUENTdGF0ZS5FQ0xFQU47CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBQQ1N0YXRlLkVO\nT05UUkFOUzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc20uaW5pdGlh\nbGl6ZShjb3B5LCBzdGF0ZSk7CiAgICAgICAgICAgIHJldHVybiBzbTsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElm\nIG5vdCBhbHJlYWR5IGNhY2hlZCwgY3JlYXRlIGFuIGVtcHR5IGNvcHkgb2Yg\ndGhlIGdpdmVuIHN0YXRlCiAgICAgKiBtYW5hZ2VyIGluIHRoZSBnaXZlbiBz\ndGF0ZS4KICAgICAqLwogICAgT3BlbkpQQVN0YXRlTWFuYWdlciBjb3B5KE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgY29weSwgUENTdGF0ZSBzdGF0ZSkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgT2JqZWN0IG9pZCA9\nIGNvcHkuZmV0Y2hPYmplY3RJZCgpOwogICAgICAgICAgICBDbGFzcyB0eXBl\nID0gY29weS5nZXRNYW5hZ2VkSW5zdGFuY2UoKS5nZXRDbGFzcygpOwogICAg\nICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgLy8gY2Fj\naGVkIGluc3RhbmNlPwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nID0gbnVsbDsKICAgICAgICAgICAgaWYgKCFjb3B5LmlzRW1iZWRkZWQoKSkK\nICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQo\nb2lkLCB0cnVlKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9jb25m\nLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUlu\nc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEg\nPSByZXBvcy5nZXRNZXRhRGF0YSh0eXBlLCBfbG9hZGVyLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIC8vIGNvbnN0cnVjdCBhIG5ldyBzdGF0ZSBtYW5hZ2Vy\nIHdpdGggYWxsIGluZm8ga25vd24KICAgICAgICAgICAgICAgIHNtID0gbmV3\nIFN0YXRlTWFuYWdlckltcGwob2lkLCBtZXRhLCB0aGlzKTsKICAgICAgICAg\nICAgICAgIHNtLnNldE9iamVjdElkKG9pZCk7CiAgICAgICAgICAgICAgICBz\nbS5pbml0aWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlw\nZSgpLCBzdGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIHNtOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQg\ncmVmcmVzaEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsIHx8IG9ianMuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5vbnRy\nYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIAogICAg\nICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goaXRyLm5leHQoKSwg\nY2FsbCk7CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgCXJldHVybjsKICAgICAgICAgICAgaWYgKF9vcGVyYXRp\nbmcuc2l6ZSgpID09IDEpCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwo\nX29wZXJhdGluZy5pdGVyYXRvcigpLm5leHQoKSwgY2FsbCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgCXJlZnJlc2hJbnRlcm5hbChfb3BlcmF0\naW5nLCBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgcmVmcmVzaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAg\nICAgICAgICBnYXRoZXJDYXNjYWRlUmVmcmVzaChvYmosIGNhbGwpOwogICAg\nICAgICAgICBpZiAoX29wZXJhdGluZy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIAlyZXR1cm47CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLnNpemUoKSA9\nPSAxKQogICAgICAgICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcu\naXRlcmF0b3IoKS5uZXh0KCksIGNhbGwpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZywgY2FsbCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2F0aGVycyBh\nbGwgb2JqZWN0cyByZWFjaGFibGUgdGhyb3VnaCBjYXNjYWRlLXJlZnJlc2gg\ncmVsYXRpb25zCiAgICAgKiBpbnRvIHRoZSBvcGVyYXRpbmcgc2V0LgogICAg\nICovCiAgICB2b2lkIGdhdGhlckNhc2NhZGVSZWZyZXNoKE9iamVjdCBvYmos\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoIV9vcGVyYXRpbmcu\nYWRkKG9iaikpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCBmYWxz\nZSk7CiAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENh\nbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKTsKICAgICAgICBp\nZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSA9PSAwKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChzbSAhPSBudWxsKQog\nICAgICAgICAgICBzbS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxs\nYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBjYWxsLCAicmVmcmVzaCIpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdpdGgg\ndGhlIGZ1bGwgc2V0IG9mIG9iamVjdHMgcmVhY2hhYmxlIHZpYQogICAgICog\nY2FzY2FkZS1yZWZyZXNoIHJlbGF0aW9ucyBmcm9tIHRoZSB1c2VyLWdpdmVu\nIGluc3RhbmNlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVmcmVz\naEludGVybmFsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgCWlmIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkpCiAg\nICAJCXJldHVybjsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29sbGVjdCBpbnN0YW5jZXMgdGhh\ndCBuZWVkIGEgcmVmcmVzaAogICAgICAgICAgICBDb2xsZWN0aW9uIGxvYWQg\nPSBudWxsOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAg\nICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNr\ncy5PUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAg\nICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoc20uaXNEZXRhY2hlZCgpKSAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2gi\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc20uYmVmb3Jl\nUmVmcmVzaCh0cnVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAJaWYg\nKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgCQlsb2Fk\nID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2Vy\ndFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpCiAgICAg\nICAgICAgICAgICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2Jq\nLCAicmVmcmVzaCIpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZChleGNlcHMsIGtlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gcmVmcmVzaCBhbGwKICAgICAgICAgICAg\naWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29sbGVjdGlv\nbiBmYWlsZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLAogICAgICAg\nICAgICAgICAgICAgIFN0b3JlTWFuYWdlci5GT1JDRV9MT0FEX1JFRlJFU0gs\nIF9mYywgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51\nbGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2VwcywgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRp\nb24oZmFpbGVkKSk7CgogICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBwb3N0\nLXJlZnJlc2ggdHJhbnNpdGlvbnMgYW5kIG1ha2Ugc3VyZSBhbGwgZmV0Y2gK\nICAgICAgICAgICAgICAgIC8vIGdyb3VwIGZpZWxkcyBhcmUgbG9hZGVkCiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGxvYWQuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBz\nbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiBmYWlsZWQuY29udGFp\nbnMoc20uZ2V0SWQoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICBzbS5hZnRlclJlZnJlc2goKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9G\nR1MsIG51bGwsIG51bGwsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbm93IGludm9rZSBwb3N0UmVmcmVzaCBvbiBhbGwgdGhlIGluc3RhbmNlcwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKGl0\nci5uZXh0KCksIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChzbSAh\nPSBudWxsICYmICFzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdl\ndE1ldGFEYXRhKCksIExpZmVjeWNsZUV2ZW50LkFGVEVSX1JFRlJFU0gpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNl\ncHMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9wdGltaXphdGlv\nbiBmb3Igc2luZ2xlLW9iamVjdCByZWZyZXNoLgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCByZWZyZXNoSW50ZXJuYWwoT2JqZWN0IG9iaiwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1\nZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJh\nY2tzLk9QX1JFRlJFU0gsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAg\nICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAg\nICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZy\nZXNoIik7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChzbS5iZWZvcmVSZWZy\nZXNoKGZhbHNlKSkgewogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2Zj\nLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJSZWZyZXNoKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xl\nRXZlbnQoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsCiAgICAgICAg\nICAgICAgICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQu\nQUZURVJfUkVGUkVTSCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0\nUGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkKICAgICAg\nICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgCiAgICBwdWJsaWMg\ndm9pZCByZXRyaWV2ZUFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZGZn\nT25seSwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYg\nKG9ianMgPT0gbnVsbCB8fCBvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAg\nICAgICAgIHJldHJpZXZlKG9ianMuaXRlcmF0b3IoKS5uZXh0KCksIGRmZ09u\nbHksIGNhbGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgp\nOwoKICAgICAgICAgICAgLy8gY29sbGVjdCBhbGwgaG9sbG93IGluc3RhbmNl\ncyBmb3IgbG9hZAogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAg\nICBDb2xsZWN0aW9uIGxvYWQgPSBudWxsOwogICAgICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBDb2xsZWN0aW9uIHNtcyA9IG5l\ndyBBcnJheUxpc3Qob2Jqcy5zaXplKCkpOwogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENh\nbGxiYWNrcy5PUF9SRVRSSUVWRSwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQog\nICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJl\ndHJpZXZlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzbS5pc1Bl\ncnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc21z\nLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20u\nZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuSE9MTE9XKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2Fk\nLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRh\nY2hlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgID09IEJvb2xlYW4uVFJV\nRSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRF\neGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAg\nICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGxvYWQgYWxsIGhvbGxv\ndyBpbnN0YW5jZXMKICAgICAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQgPSBu\ndWxsOwogICAgICAgICAgICBpZiAobG9hZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBpbnQgbW9kZSA9IChkZmdPbmx5KSA/IF9zdG9yZS5GT1JDRV9M\nT0FEX0RGRwogICAgICAgICAgICAgICAgICAgIDogX3N0b3JlLkZPUkNFX0xP\nQURfQUxMOwogICAgICAgICAgICAgICAgZmFpbGVkID0gX3N0b3JlLmxvYWRB\nbGwobG9hZCwgbnVsbCwgbW9kZSwgX2ZjLCBudWxsKTsKICAgICAgICAgICAg\nICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBuZXdP\nYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gcmV0cmlldmUgYWxsIG5vbi1mYWlsZWQgaW5z\ndGFuY2VzCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBz\nbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5jb250YWlucyhz\nbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICBpbnQgbW9kZSA9IChkZmdPbmx5KSA/IFN0YXRlTWFu\nYWdlckltcGwuTE9BRF9GR1MKICAgICAgICAgICAgICAgICAgICA6IFN0YXRl\nTWFuYWdlckltcGwuTE9BRF9BTEw7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIHNtLmJlZm9yZVJlYWQoLTEpOwogICAgICAg\nICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2RlLCBudWxsLCBudWxsLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4\nY2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0ZWRFeGNl\ncHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJldHJpZXZlKE9iamVjdCBvYmosIGJvb2xlYW4gZGZnT25seSwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVu\ndChPcENhbGxiYWNrcy5PUF9SRVRSSUVWRSwgb2JqLCBzbSwgY2FsbCkKICAg\nICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAg\nICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNQ\nZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICBpbnQgbW9kZSA9\nIChkZmdPbmx5KSA/IFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MKICAgICAg\nICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxM\nOwogICAgICAgICAgICAgICAgICAgIHNtLmJlZm9yZVJlYWQoLTEpOwogICAg\nICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2RlLCBudWxsLCBudWxs\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFj\naGVkKCkKICAgICAgICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJl\ndHJpZXZlIik7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgZXZpY3RBbGwoT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyBldmljdCBhbGwgUENsZWFuIGFuZCBQTm9uVHJhbnMgb2Jq\nZWN0cwogICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSBnZXRNYW5hZ2VkU3Rh\ndGVzKCk7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5h\nZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChzbS5p\nc1BlcnNpc3RlbnQoKSAmJiAhc20uaXNEaXJ0eSgpKQogICAgICAgICAgICAg\nICAgICAgIGV2aWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBjYWxsKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGV2aWN0QWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIGV2aWN0KGl0ci5uZXh0KCksIGNhbGwpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAg\nICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoRXh0ZW50IGV4dGVudCwg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChleHRlbnQgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gZXZpY3Qg\nYWxsIFBDbGVhbiBhbmQgUE5vblRyYW5zIG9iamVjdHMgaW4gZXh0ZW50CiAg\nICAgICAgICAgIENvbGxlY3Rpb24gYyA9IGdldE1hbmFnZWRTdGF0ZXMoKTsK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAg\nQ2xhc3MgY2xzOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkgJiYgIXNtLmlzRGlydHko\nKSkgewogICAgICAgICAgICAgICAgICAgIGNscyA9IHNtLmdldE1ldGFEYXRh\nKCkuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChjbHMgPT0gZXh0ZW50LmdldEVsZW1lbnRUeXBlKCkKICAgICAgICAgICAg\nICAgICAgICAgICAgfHwgKGV4dGVudC5oYXNTdWJjbGFzc2VzKCkKICAgICAg\nICAgICAgICAgICAgICAgICAgJiYgZXh0ZW50LmdldEVsZW1lbnRUeXBlKCku\naXNBc3NpZ25hYmxlRnJvbShjbHMpKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZXZpY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIGNhbGwpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0KE9iamVjdCBvYmosIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAg\nIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0VWSUNULCBv\nYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5B\nQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIHNtLmV2aWN0KCk7CiAgICAgICAgICAgIGlmIChfZXZp\nY3REYXRhQ2FjaGUgJiYgc20uZ2V0T2JqZWN0SWQoKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBzbS5nZXRNZXRhRGF0\nYSgpLmdldERhdGFDYWNoZSgpOwogICAgICAgICAgICAgICAgaWYgKGNhY2hl\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlKHNt\nLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGRl\ndGFjaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBjYWxsID0gX2Nh\nbGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNoTWFuYWdlcih0aGlz\nLCBmYWxzZSwgY2FsbCkuZGV0YWNoKG9iaik7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdFtdIGRldGFjaEFsbChD\nb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAob2JqcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBF\nTVBUWV9PQkpFQ1RTOwogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAgICAg\nICAgICAgIGNhbGwgPSBfY2FsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBE\nZXRhY2hNYW5hZ2VyKHRoaXMsIGZhbHNlLCBjYWxsKS5kZXRhY2hBbGwob2Jq\ncyk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBk\nZXRhY2hBbGwoY2FsbCwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNhbGwsIGJvb2xlYW4gZmx1c2gpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyBJZiBhIGZsdXNoIGlzIGRlc2lyZWQgKGJhc2VkIG9u\nIGlucHV0IHBhcm0pLCB0aGVuIGNoZWNrIGlmIHRoZQogICAgICAgICAgICAv\nLyAgICJkaXJ0eSIgZmxhZyBpcyBzZXQgYmVmb3JlIGNhbGxpbmcgZmx1c2go\nKS4KICAgICAgICAgICAgaWYgKChmbHVzaCkgJiYgKChfZmxhZ3MgJiBGTEFH\nX0ZMVVNIX1JFUVVJUkVEKSAhPSAwKSkKICAgICAgICAgICAgICAgIGZsdXNo\nKCk7CiAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKGNhbGwpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBk\nZXRhY2hBbGxJbnRlcm5hbChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\nQ29sbGVjdGlvbiBzdGF0ZXMgPSBnZXRNYW5hZ2VkU3RhdGVzKCk7CiAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgp\nOwogICAgICAgICAgICBpZiAoIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAg\nICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICBlbHNlIGlmICgh\nc20uZ2V0TWV0YURhdGEoKS5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAg\nICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICAgICAgICAgIGl0ci5y\nZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAo\nc3RhdGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBjYWxsID0gX2NhbGw7\nCiAgICAgICAgbmV3IERldGFjaE1hbmFnZXIodGhpcywgdHJ1ZSwgY2FsbCku\nZGV0YWNoQWxsCiAgICAgICAgICAgIChuZXcgTWFuYWdlZE9iamVjdENvbGxl\nY3Rpb24oc3RhdGVzKSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBhdHRh\nY2goT2JqZWN0IG9iaiwgYm9vbGVhbiBjb3B5TmV3LCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG5vdCB0byB0\ncnkgdG8gc2V0IHJvbGxiYWNrIG9ubHkgaWYgdGhpcyBmYWlscwogICAgICAg\nICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2hNYW5hZ2VyKHRo\naXMsIGNvcHlOZXcsIGNhbGwpLmF0dGFjaChvYmopOwogICAgICAgICAgICB9\nIGNhdGNoIChPcHRpbWlzdGljRXhjZXB0aW9uIG9lKSB7CiAgICAgICAgICAg\nICAgICBzZXRSb2xsYmFja09ubHkob2UpOwogICAgICAgICAgICAgICAgdGhy\nb3cgb2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihy\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0W10gYXR0YWNoQWxsKENvbGxlY3Rpb24gb2Jq\ncywgYm9vbGVhbiBjb3B5TmV3LAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybiBFTVBUWV9PQkpFQ1RTOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBtYWtl\nIHN1cmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sgb25seSBpZiB0aGlz\nIGZhaWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEF0\ndGFjaE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCkuYXR0YWNoQWxsKG9i\nanMpOwogICAgICAgICAgICB9IGNhdGNoIChPcHRpbWlzdGljRXhjZXB0aW9u\nIG9lKSB7CiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHkob2UpOwog\nICAgICAgICAgICAgICAgdGhyb3cgb2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBub250cmFuc2Fj\ndGlvbmFsQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIG5vbnRyYW5zYWN0aW9uYWwoaXRyLm5leHQoKSwgY2FsbCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAg\nICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRo\ncm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9udHJhbnNhY3Rpb25hbChP\nYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9i\naiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwg\ndHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX05PTlRSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNhbGwpCiAg\nICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgc20ubm9udHJhbnNhY3Rpb25hbCgpOwog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nTWFrZSB0aGUgZ2l2ZW4gaW5zdGFuY2VzIHRyYW5zYWN0aW9uYWwuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHRyYW5zYWN0aW9uYWxBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBib29sZWFuIHVwZGF0ZVZlcnNpb24sCiAgICAgICAgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAx\nKSB7CiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwob2Jqcy5pdGVyYXRvcigp\nLm5leHQoKSwgdXBkYXRlVmVyc2lvbiwgY2FsbCk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbGxlY3QgYWxsIGhv\nbGxvdyBpbnN0YW5jZXMgZm9yIGxvYWQsIGFuZCBtYWtlIHVubWFuYW5nZWQK\nICAgICAgICAgICAgLy8gaW5zdGFuY2VzIHRyYW5zaWVudC10cmFuc2FjdGlv\nbmFsCiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9IG51bGw7CiAgICAg\nICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc207CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAg\nICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcgTGlua2VkSGFzaFNldChvYmpz\nLnNpemUoKSk7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChwcm9j\nZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfVFJBTlNBQ1RJT05BTCwgb2Jq\nLCBzbSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbCkgJiBPcENhbGxi\nYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFuYWdlIHRyYW5zaWVu\ndCBpbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhID0gX2Nv\nbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygp\nLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHNt\nID0gbmV3IFN0YXRlTWFuYWdlckltcGwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIChTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKSwgbWV0\nYSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxp\nemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBQQ1N0YXRlLlRDTEVBTik7CiAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigp\nOwogICAgICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0\nYXRlLkhPTExPVykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2FkID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZC5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNp\nb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGRhdGVW\nZXJzaW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0VXBk\nYXRlVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hlY2sv\ndXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAg\nICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbG9hZCBhbGwgaG9sbG93IGluc3RhbmNlcwogICAgICAgICAgICBDb2xsZWN0\naW9uIGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChsb2FkICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxs\nKGxvYWQsIG51bGwsIF9zdG9yZS5GT1JDRV9MT0FEX05PTkUsCiAgICAgICAg\nICAgICAgICAgICAgX2ZjLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChm\nYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAogICAgICAgICAgICAg\nICAgICAgICAgICBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQp\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbFN0\nYXRlc0FsbChzbXMsIGZhaWxlZCwgZXhjZXBzKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdpdmVu\nIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCB0cmFuc2FjdGlvbmFsKE9iamVjdCBvYmosIGJvb2xlYW4gdXBkYXRl\nVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBs\nKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50\nKE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNhbGwp\nCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAg\nICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgICAg\nIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIHNtLmxvYWQo\nX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNpb24odHJ1\nZSk7CiAgICAgICAgICAgICAgICBpZiAodXBkYXRlVmVyc2lvbikKICAgICAg\nICAgICAgICAgICAgICBzbS5zZXRVcGRhdGVWZXJzaW9uKHRydWUpOwogICAg\nICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8v\nIHZlcnNpb24gY2hlY2svdXAKICAgICAgICAgICAgfSBlbHNlIGlmIChzbSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtYW5hZ2UgdHJhbnNpZW50\nIGluc3RhbmNlCiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEg\nPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAg\nICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygpLCBf\nbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIE9iamVjdCBpZCA9IFN0\nYXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwogICAgICAgICAgICAg\nICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhpcyk7\nCiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2VydFBlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAgICAgICAgICAgIFBDU3RhdGUu\nVENMRUFOKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9uIHRo\nZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0byB0cmFuc2FjdGlvbmFsLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNhY3Rpb25hbFN0YXRlc0FsbChD\nb2xsZWN0aW9uIHNtcywgQ29sbGVjdGlvbiBmYWlsZWQsCiAgICAgICAgTGlz\ndCBleGNlcHMpIHsKICAgICAgICAvLyBtYWtlIGluc3RhbmNlcyB0cmFuc2Fj\ndGlvbmFsIGFuZCBtYWtlIHN1cmUgdGhleSBhcmUgbG9hZGVkCiAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRhaW5z\nKHNtLmdldElkKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25h\nbCgpOwogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdl\nckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNl\ncHMsIGZhbHNlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAg\nLy8gRXh0ZW50LCBRdWVyeQogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1\nYmNsYXNzZXMpIHsKICAgICAgICByZXR1cm4gbmV3RXh0ZW50KHR5cGUsIHN1\nYmNsYXNzZXMsIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgRXh0ZW50IG5l\nd0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgRXh0\nZW50SW1wbCBleHRlbnQgPSBuZXcgRXh0ZW50SW1wbCh0aGlzLCB0eXBlLCBz\ndWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgICAgIGlmIChfZXh0ZW50cyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX2V4dGVudHMgPSBuZXcgUmVmZXJl\nbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwogICAgICAgICAg\nICBfZXh0ZW50cy5hZGQoZXh0ZW50KTsKCiAgICAgICAgICAgIHJldHVybiBl\neHRlbnQ7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIEl0ZXJhdG9yIGV4dGVudEl0ZXJhdG9yKENsYXNzIHR5cGUsIGJvb2xl\nYW4gc3ViY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGJvb2xlYW4gaWdub3JlQ2hhbmdlcykgewogICAgICAgIEV4dGVudCBl\neHRlbnQgPSBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3NlcywgZmV0Y2gpOwog\nICAgICAgIGV4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKGlnbm9yZUNoYW5nZXMp\nOwogICAgICAgIHJldHVybiBleHRlbnQuaXRlcmF0b3IoKTsKICAgIH0KCiAg\nICBwdWJsaWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIENsYXNzIGNs\ncywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgUXVlcnkgcSA9IG5ld1F1ZXJ5\nKGxhbmcsIHF1ZXJ5KTsKICAgICAgICBxLnNldENhbmRpZGF0ZVR5cGUoY2xz\nLCB0cnVlKTsKICAgICAgICByZXR1cm4gcTsKICAgIH0KCiAgICBwdWJsaWMg\nUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIE9iamVjdCBxdWVyeSkgewog\nICAgICAgIC8vIGNvbW1vbiBtaXN0YWtlcwogICAgICAgIGlmIChxdWVyeSBp\nbnN0YW5jZW9mIEV4dGVudCB8fCBxdWVyeSBpbnN0YW5jZW9mIENsYXNzKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLW5ldy1xdWVyeSIpKTsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0b3JlUXVlcnkgc3Eg\nPSBfc3RvcmUubmV3UXVlcnkobGFuZyk7CiAgICAgICAgICAgIGlmIChzcSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBFeHByZXNzaW9uUGFyc2VyIGVw\nID0gUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZyk7CiAg\nICAgICAgICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBzcSA9IG5ldyBFeHByZXNzaW9uU3RvcmVRdWVyeShlcCk7CiAgICAg\nICAgICAgICAgICBlbHNlIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX01FVEhP\nRFFMLmVxdWFscyhsYW5nKSkKICAgICAgICAgICAgICAgICAgICBzcSA9IG5l\ndyBNZXRob2RTdG9yZVF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKGxhbmcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBRdWVyeSBx\nID0gbmV3UXVlcnlJbXBsKGxhbmcsIHNxKTsKICAgICAgICAgICAgcS5zZXRJ\nZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAgICAgICAgaWYg\nKHF1ZXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBxLnNldFF1ZXJ5KHF1\nZXJ5KTsKCiAgICAgICAgICAgIC8vIHRyYWNrIHF1ZXJpZXMKICAgICAgICAg\nICAgaWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgICAgICBfcXVl\ncmllcyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQu\nV0VBSyk7CiAgICAgICAgICAgIF9xdWVyaWVzLmFkZChxKTsKICAgICAgICAg\nICAgcmV0dXJuIHE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBRdWVyeUltcGwgbmV3UXVlcnlJbXBsKFN0cmluZyBsYW5n\nLCBTdG9yZVF1ZXJ5IHNxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUlt\ncGwodGhpcywgbGFuZywgc3EpOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0\nSWRlbnRpdHlTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UobWV0YSwgbnVsbCk7CiAgICB9\nCgogICAgcHVibGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UoZm1k\nLmdldERlZmluaW5nTWV0YURhdGEoKSwgZm1kKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHNlcXVlbmNlIGZvciB0aGUgZ2l2ZW4gY2xhc3Mg\nYW5kIG9wdGlvbmFsIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIFNlcSBn\nZXRTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEsIEZpZWxkTWV0YURhdGEg\nZm1kKSB7CiAgICAgICAgLy8gZ2V0IHNlcXVlbmNlIHN0cmF0ZWd5IGZyb20g\nbWV0YWRhdGEKICAgICAgICBpbnQgc3RyYXRlZ3k7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKQogICAgICAgICAgICBzdHJhdGVneSA9IG1ldGEuZ2V0SWRl\nbnRpdHlTdHJhdGVneSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Ry\nYXRlZ3kgPSBmbWQuZ2V0VmFsdWVTdHJhdGVneSgpOwoKICAgICAgICAvLyB3\nZSBjYW4gaGFuZGxlIG5vbi1uYXRpdmUgc3RyYXRlZ2llcyB3aXRob3V0IHRo\nZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkgewog\nICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDoKICAg\nICAgICAgICAgICAgIHJldHVybiBVVUlESGV4U2VxLmdldEluc3RhbmNlKCk7\nCiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RSSU5H\nOgogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURTdHJpbmdTZXEuZ2V0SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJ\nRF9UWVBFNF9IRVg6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJRFR5cGU0\nSGV4U2VxLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVT\ndHJhdGVnaWVzLlVVSURfVFlQRTRfU1RSSU5HOgogICAgICAgICAgICAgICAg\ncmV0dXJuIFVVSURUeXBlNFN0cmluZ1NlcS5nZXRJbnN0YW5jZSgpOwogICAg\nICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRToKICAgICAg\nICAgICAgICAgIFNlcXVlbmNlTWV0YURhdGEgc21kID0gKGZtZCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgID8gbWV0YS5nZXRJZGVudGl0eVNlcXVl\nbmNlTWV0YURhdGEoKQogICAgICAgICAgICAgICAgICAgIDogZm1kLmdldFZh\nbHVlU2VxdWVuY2VNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHNtZC5nZXRJbnN0YW5jZShfbG9hZGVyKTsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIC8vIHVzZSBzdG9yZSBtYW5hZ2VyIGZvciBu\nYXRpdmUgc2VxdWVuY2UKICAgICAgICAgICAgICAgIGlmIChmbWQgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCByZXR1cm4g\nYSBzZXF1ZW5jZSBldmVuIGZvciBhcHAgaWQgY2xhc3NlcywKICAgICAgICAg\nICAgICAgICAgICAvLyB3aGljaCBpcyB3aGF0IHdlIHdhbnQgZm9yIGJhY2t3\nYXJkcy1jb21wYXRpYmlsaXR5CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIF9zdG9yZS5nZXREYXRhU3RvcmVJZFNlcXVlbmNlKG1ldGEpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5nZXRW\nYWx1ZVNlcXVlbmNlKGZtZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8v\nLy8vLy8vCiAgICAvLyBMb2NraW5nCiAgICAvLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyB2b2lkIGxvY2soT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsgLy8gaGF2ZSB0byBz\neW5jIG9yIGxvY2sgbGV2ZWwgYWx3YXlzIE5PTkUKICAgICAgICB0cnkgewog\nICAgICAgICAgICBsb2NrKG9iaiwgX2ZjLmdldFdyaXRlTG9ja0xldmVsKCks\nIF9mYy5nZXRMb2NrVGltZW91dCgpLCBjYWxsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgbG9jayhPYmplY3Qgb2JqLCBpbnQgbGV2\nZWwsIGludCB0aW1lb3V0LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmos\nIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENh\nbGxiYWNrcy5PUF9MT0NLLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAg\nICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCB8fCAhc20u\naXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAg\nICAgICAgICBfbG0ubG9jayhzbSwgbGV2ZWwsIHRpbWVvdXQsIG51bGwpOwog\nICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBsZXZlbCk7IC8vIHVz\nZSBzYW1lIGxldmVsIGZvciBmdXR1cmUgd3JpdGUKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrQWxsKENvbGxl\nY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChv\nYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsgLy8gaGF2ZSB0byBzeW5jIG9yIGxvY2sg\nbGV2ZWwgYWx3YXlzIE5PTkUKICAgICAgICB0cnkgewogICAgICAgICAgICBs\nb2NrQWxsKG9ianMsIF9mYy5nZXRXcml0ZUxvY2tMZXZlbCgpLCBfZmMuZ2V0\nTG9ja1RpbWVvdXQoKSwKICAgICAgICAgICAgICAgIGNhbGwpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrQWxsKENvbGxlY3Rp\nb24gb2JqcywgaW50IGxldmVsLCBpbnQgdGltZW91dCwKICAgICAgICBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKG9ianMuc2l6ZSgpID09\nIDEpIHsKICAgICAgICAgICAgbG9jayhvYmpzLml0ZXJhdG9yKCkubmV4dCgp\nLCBsZXZlbCwgdGltZW91dCwgY2FsbCk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9u\nKCk7CgogICAgICAgICAgICBDb2xsZWN0aW9uIHNtcyA9IG5ldyBMaW5rZWRI\nYXNoU2V0KG9ianMuc2l6ZSgpKTsKICAgICAgICAgICAgT2JqZWN0IG9iajsK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICAgICAgaWYg\nKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTE9DSywgb2JqLCBz\nbSwgY2FsbCkKICAgICAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFD\nVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgX2xtLmxvY2tBbGwoc21zLCBsZXZlbCwg\ndGltZW91dCwgbnVsbCk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gc21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpKS5yZWFkTG9j\na2VkKGxldmVsLCBsZXZlbCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbm5lY3Rpb24KICAg\nIC8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gY2FuY2VsQWxs\nKCkgewogICAgICAgIC8vIHRoaXMgbWV0aG9kIGRvZXMgbm90IGxvY2ssIHNp\nbmNlIHdlIHdhbnQgdG8gYWxsb3cgYSBkaWZmZXJlbnQKICAgICAgICAvLyB0\naHJlYWQgdG8gYmUgYWJsZSB0byBjYW5jZWwgb24gYSBsb2NrZWQtdXAgcGVy\nc2lzdGVuY2UgbWFuYWdlcgoKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgd2UncmUgZmx1c2hpbmcsIGhh\ndmUgdG8gc2V0IHJvbGxiYWNrIG9ubHkgLS0gZG8gdGhpcyBiZWZvcmUgd2UK\nICAgICAgICAgICAgLy8gYXR0ZW1wdCB0byBjYW5jZWwsIGJlY2F1c2Ugb3Ro\nZXJ3aXNlIHRoZSBjYW5jZWwgbWlnaHQgY2FzZSB0aGUKICAgICAgICAgICAg\nLy8gdHJhbnNhY3Rpb24gdG8gY29tcGxldGUgYmVmb3JlIHdlIGhhdmUgYSBj\naGFuY2UgdG8gc2V0IHRoZQogICAgICAgICAgICAvLyByb2xsYmFjayBvbmx5\nIGZsYWcKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0ZM\nVVNISU5HKSAhPSAwKQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5\nSW50ZXJuYWwobmV3IFVzZXJFeGNlcHRpb24oKSk7CiAgICAgICAgICAgIHJl\ndHVybiBfc3RvcmUuY2FuY2VsQWxsKCk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Q29ubmVjdGlvbigpIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKCFfY29uZi5zdXBwb3J0\nZWRPcHRpb25zKCkuY29udGFpbnMKICAgICAgICAgICAgKF9jb25mLk9QVElP\nTl9EQVRBU1RPUkVfQ09OTkVDVElPTikpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiY29ubi1ub3Qtc3Vw\ncG9ydGVkIikpOwoKICAgICAgICByZXR1cm4gX3N0b3JlLmdldENsaWVudENv\nbm5lY3Rpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNDb25u\nZWN0aW9uKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1\ncm4gKF9mbGFncyAmIEZMQUdfUkVUQUlORURfQ09OTikgIT0gMDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRlbGwgc3RvcmUgdG8gcmV0YWluIGNvbm5lY3Rp\nb24gaWYgd2UgaGF2ZW4ndCBhbHJlYWR5LgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcmV0YWluQ29ubmVjdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfUkVUQUlORURfQ09OTikgPT0gMCkgewogICAgICAgICAgICBf\nc3RvcmUucmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRlbGwgc3RvcmUgdG8gcmVsZWFzZSBjb25uZWN0aW9uIGlm\nIHdlIGhhdmUgcmV0YWluZWQgb25lLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVsZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1JFVEFJTkVEX0NPTk4pICE9IDApIHsKICAgICAgICAgICAgX3N0\nb3JlLnJlbGVhc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAv\nLy8vLy8vLy8KICAgIC8vIENhY2hlCiAgICAvLy8vLy8vLy8KCiAgICBwdWJs\naWMgQ29sbGVjdGlvbiBnZXRNYW5hZ2VkT2JqZWN0cygpIHsKICAgICAgICBi\nZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRNYW5h\nZ2VkU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nQ29sbGVjdGlvbiBnZXRUcmFuc2FjdGlvbmFsT2JqZWN0cygpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRU\ncmFuc2FjdGlvbmFsU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbE9i\namVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVj\ndENvbGxlY3Rpb24KICAgICAgICAgICAgICAgIChnZXRQZW5kaW5nVHJhbnNh\nY3Rpb25hbFN0YXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENvbGxlY3Rpb24gZ2V0RGlydHlPYmplY3RzKCkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdldERpcnR5\nU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBnZXRPcmRlckRpcnR5T2JqZWN0cygpIHsKICAgICAgICByZXR1cm4g\nX29yZGVyRGlydHk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T3JkZXJE\naXJ0eU9iamVjdHMoYm9vbGVhbiBvcmRlcikgewogICAgICAgIF9vcmRlckRp\ncnR5ID0gb3JkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBj\nb3B5IG9mIGFsbCBtYW5hZ2VkIHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRNYW5hZ2VkU3RhdGVzKCkgewog\nICAgICAgIHJldHVybiBfY2FjaGUuY29weSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0\nZSBtYW5hZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24g\nZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpIHsKICAgICAgICBpZiAoIWhhc1Ry\nYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAgICAgICAgIHJldHVybiBDb2xs\nZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgcmV0dXJuIF90cmFuc0NhY2hl\nLmNvcHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90\nIHRoZXJlIGFyZSBhbnkgdHJhbnNhY3Rpb25hbCBvYmplY3RzIGluIHRoZSBj\ndXJyZW50CiAgICAgKiBwZXJzaXN0ZW5jZSBjb250ZXh0LiBJZiB0aGVyZSBh\ncmUgYW55IGluc3RhbmNlcyB3aXRoIHVudHJhY2tlZCBzdGF0ZSwKICAgICAq\nIHRoaXMgbWV0aG9kIHdpbGwgY2F1c2UgdGhvc2UgaW5zdGFuY2VzIHRvIGJl\nIHNjYW5uZWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNUcmFu\nc2FjdGlvbmFsT2JqZWN0cygpIHsKICAgICAgICBfY2FjaGUuZGlydHlDaGVj\naygpOwogICAgICAgIHJldHVybiBfdHJhbnNDYWNoZSAhPSBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgZGlydHkg\nc3RhdGUgbWFuYWdlcnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0\naW9uIGdldERpcnR5U3RhdGVzKCkgewogICAgICAgIGlmICghaGFzVHJhbnNh\nY3Rpb25hbE9iamVjdHMoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLkVNUFRZX1NFVDsKCiAgICAgICAgcmV0dXJuIF90cmFuc0NhY2hlLmNv\ncHlEaXJ0eSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY29w\neSBvZiBhbGwgc3RhdGUgbWFuYWdlcnMgd2hpY2ggd2lsbCBiZWNvbWUKICAg\nICAqIHRyYW5zYWN0aW9uYWwgdXBvbiB0aGUgbmV4dCB0cmFuc2FjdGlvbi4K\nICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0UGVuZGluZ1Ry\nYW5zYWN0aW9uYWxTdGF0ZXMoKSB7CiAgICAgICAgaWYgKF9wZW5kaW5nID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9T\nRVQ7CiAgICAgICAgcmV0dXJuIG5ldyBMaW5rZWRIYXNoU2V0KF9wZW5kaW5n\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY2FjaGVkIFN0YXRl\nTWFuYWdlciBmb3IgdGhlIGluc3RhbmNlIHRoYXQgaGFkIHRoZSBnaXZlbiBv\naWQuCiAgICAgKiBUaGlzIG1ldGhvZCBtdXN0IG5vdCBiZSBjYWxsZWQgbXVs\ndGlwbGUgdGltZXMgZm9yIG5ldyBpbnN0YW5jZXMuCiAgICAgKgogICAgICog\nQHBhcmFtIGlkIHRoZSBpZCBwcmV2aW91c2x5IHVzZWQgYnkgdGhlIGluc3Rh\nbmNlCiAgICAgKiBAcGFyYW0gc20gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRo\nZSBpbnN0YW5jZTsgaWYgdGhlIHN0YXRlCiAgICAgKiBtYW5hZ2VyIGlzIHRy\nYW5zaWVudCwgd2UnbGwgc3RvcCBtYW5hZ2luZyB0aGUgaW5zdGFuY2U7CiAg\nICAgKiBpZiBpdCBoYXMgdXBkYXRlZCBpdHMgb2lkLCB3ZSdsbCByZS1jYWNo\nZSB1bmRlciB0aGUgbmV3IG9pZAogICAgICogQHBhcmFtIHN0YXR1cyBvbmUg\nb2Ygb3VyIFNUQVRVUyBjb25zdGFudHMgZGVzY3JpYmluZyB3aHkgd2UncmUK\nICAgICAqIHNldHRpbmcgdGhlIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAg\ndm9pZCBzZXRTdGF0ZU1hbmFnZXIoT2JqZWN0IGlkLCBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtLCBpbnQgc3RhdHVzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAg\nICAgICAgICBjYXNlIFNUQVRVU19JTklUOgogICAgICAgICAgICAgICAgICAg\nIF9jYWNoZS5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfVFJBTlNJRU5UOgogICAgICAg\nICAgICAgICAgICAgIF9jYWNoZS5yZW1vdmUoaWQsIHNtKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVT\nX09JRF9BU1NJR046CiAgICAgICAgICAgICAgICAgICAgYXNzaWduT2JqZWN0\nSWQoX2NhY2hlLCBpZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfQ09NTUlUX05FVzoKICAg\nICAgICAgICAgICAgICAgICBfY2FjaGUuY29tbWl0TmV3KGlkLCBzbSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIGJyb2tlciB0aGF0IHRoZSBn\naXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgYWRkZWQgdG8g\ndGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4gdGhlIGN1cnJlbnQg\ndHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgYWRkVG9UcmFuc2FjdGlv\nbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgLy8gd2Ugb25seSBh\nZGQgY2xlYW4gaW5zdGFuY2VzIG5vdzsgZGlydHkgaW5zdGFuY2VzIGFyZSBh\nZGRlZCBpbgogICAgICAgIC8vIHRoZSBzZXREaXJ0eSBjYWxsYmFjawogICAg\nICAgIGlmIChzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\naGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkKICAgICAgICAgICAgICAgIF90\ncmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZShfb3JkZXJEaXJ0\neSk7CiAgICAgICAgICAgIF90cmFuc0NhY2hlLmFkZENsZWFuKHNtKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIHBlcnNpc3Rl\nbmNlIG1hbmFnZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91\nbGQKICAgICAqIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2V0IG9mIGluc3RhbmNl\ncyBpbnZvbHZlZCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbi4KICAgICAq\nLwogICAgdm9pZCByZW1vdmVGcm9tVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoX3RyYW5zQ2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIC8vIGludGVudGlvbmFsIGRpcmVjdCBhY2Nlc3M7IHdlIGRvbid0IHdh\nbnQgdG8gcmVjb21wdXRlCiAgICAgICAgICAgICAgICAvLyBkaXJ0aW5lc3Mg\nd2hpbGUgcmVtb3ZpbmcgaW5zdGFuY2VzIGZyb20gdGhlIHRyYW5zYWN0aW9u\nCiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZS5yZW1vdmUoc20pOwogICAg\nICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhc20uaXNQZXJz\naXN0ZW50KCkpCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5yZW1vdmUo\nc20pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmaWNhdGlv\nbiB0aGF0IHRoZSBnaXZlbiBpbnN0YW5jZSBoYXMgYmVlbiBkaXJ0aWVkLiBU\naGlzCiAgICAgKiBub3RpZmljYXRpb24gaXMgZ2l2ZW4gd2hlbiBhbiBvYmpl\nY3QgZmlyc3QgdHJhbnNpdGlvbnMgdG8gYSBkaXJ0eSBzdGF0ZSwKICAgICAq\nIGFuZCBldmVyeSB0aW1lIHRoZSBvYmplY3QgaXMgbW9kaWZpZWQgYnkgdGhl\nIHVzZXIgdGhlcmVhZnRlci4KICAgICAqLwogICAgdm9pZCBzZXREaXJ0eShT\ndGF0ZU1hbmFnZXJJbXBsIHNtLCBib29sZWFuIGZpcnN0RGlydHkpIHsKICAg\nICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgIF9mbGFn\ncyB8PSBGTEFHX0ZMVVNIX1JFUVVJUkVEOwoKICAgICAgICBpZiAoX3NhdmVw\nb2ludHMgIT0gbnVsbCAmJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgIGlmIChfc2F2ZXBvaW50Q2FjaGUgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9IG5ldyBIYXNoU2V0KCk7CiAg\nICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZS5hZGQoc20pOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKGZpcnN0RGlydHkgJiYgc20uaXNUcmFuc2FjdGlvbmFs\nKCkpIHsKICAgICAgICAgICAgbG9jaygpOwogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgLy8gY2FjaGUgZGlydHkgaW5zdGFuY2UKICAgICAg\nICAgICAgICAgIGlmICghaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkKICAg\nICAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5ldyBUcmFuc2FjdGlv\nbmFsQ2FjaGUoX29yZGVyRGlydHkpOwogICAgICAgICAgICAgICAgX3RyYW5z\nQ2FjaGUuYWRkRGlydHkoc20pOwoKICAgICAgICAgICAgICAgIC8vIGFsc28g\ncmVjb3JkIHRoYXQgdGhlIGNsYXNzIGlzIGRpcnR5CiAgICAgICAgICAgICAg\nICBpZiAoc20uaXNOZXcoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChf\ncGVyc2lzdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBfcGVyc2lzdGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAg\nICAgICAgICAgX3BlcnNpc3RlZENsc3MuYWRkKHNtLmdldE1ldGFEYXRhKCku\nZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAoc20uaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nX2RlbGV0ZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIF9kZWxldGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAg\nICAgICAgX2RlbGV0ZWRDbHNzLmFkZChzbS5nZXRNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIGlmIChfdXBkYXRlZENsc3MgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZWRDbHNzID0gbmV3IEhhc2hT\nZXQoKTsKICAgICAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3MuYWRkKHNt\nLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBpZiB0cmFja2luZyBjaGFu\nZ2VzIGFuZCB0aGlzIGluc3RhbmNlIHdhc24ndCBhbHJlYWR5IGRpcnR5LAog\nICAgICAgICAgICAgICAgLy8gYWRkIHRvIGNoYW5nZWQgc2V0OyB3ZSB1c2Ug\ndGhpcyBmb3IgZGV0ZWN0aW5nIGluc3RhbmNlcyB0aGF0CiAgICAgICAgICAg\nICAgICAvLyBlbnRlciB0aGUgdHJhbnNhY3Rpb24gZHVyaW5nIHByZSBzdG9y\nZQogICAgICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJ\nTkcpICE9IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX3RyYW5zQWRk\naXRpb25zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIF90cmFu\nc0FkZGl0aW9ucyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICAg\nICAgX3RyYW5zQWRkaXRpb25zLmFkZChzbSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIE5vdGlmeSB0aGUgYnJva2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRl\nIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSBhZGRlZCB0byB0aGUgc2V0IG9m\nIGluc3RhbmNlcyB0aGF0IHdpbGwgYmVjb21lIHRyYW5zYWN0aW9uYWwKICAg\nICAqIG9uIHRoZSBuZXh0IHRyYW5zYWN0aW9uCiAgICAgKi8KICAgIHZvaWQg\nYWRkVG9QZW5kaW5nVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoX3BlbmRpbmcgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wZW5kaW5n\nID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3BlbmRpbmcuYWRkKHNt\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIHBl\ncnNpc3RlbmNlIG1hbmFnZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdl\nciBzaG91bGQKICAgICAqIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2V0IG9mIGlu\nc3RhbmNlcyBpbnZvbHZlZCBpbiB0aGUgbmV4dCB0cmFuc2FjdGlvbi4KICAg\nICAqLwogICAgdm9pZCByZW1vdmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKFN0\nYXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKF9wZW5kaW5nICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfcGVuZGluZy5yZW1vdmUoc20pOwogICAgICAgICAgICBp\nZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhc20uaXNQZXJzaXN0ZW50KCkp\nCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5yZW1vdmUoc20pOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIGRlcmVmZXJlbmNlZCBk\nZXBlbmRlbnQgb2JqZWN0IHRvIHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyJ3Mg\nY2FjaGUuCiAgICAgKiBPbiBmbHVzaCwgdGhlc2Ugb2JqZWN0cyB3aWxsIGJl\nIGRlbGV0ZWQuCiAgICAgKi8KICAgIHZvaWQgYWRkRGVyZWZlcmVuY2VkRGVw\nZW5kZW50KFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgd2UncmUgaW4gdGhl\nIG1pZGRsZSBvZiBmbHVzaCBhbmQgaW50cm9kdWNpbmcgbW9yZSBkZXJlZnMK\nICAgICAgICAgICAgLy8gdmlhIGluc3RhbmNlIGNhbGxiYWNrcywgYWRkIHRo\nZW0gdG8gdGhlIHNwZWNpYWwgYWRkaXRpb25zIHNldAogICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfREVSRUZERUxFVElORykgIT0gMCkgewogICAg\nICAgICAgICAgICAgaWYgKF9kZXJlZkFkZGl0aW9ucyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9kZXJlZkFkZGl0aW9ucyA9IG5ldyBIYXNoU2V0\nKCk7CiAgICAgICAgICAgICAgICBfZGVyZWZBZGRpdGlvbnMuYWRkKHNtKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChfZGVy\nZWZDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9kZXJlZkNh\nY2hlID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgIF9kZXJlZkNh\nY2hlLmFkZChzbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gcHJldmlvdXNs\neSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50IG9iamVjdCBmcm9tIHRoZQogICAg\nICogY2FjaGUuIEl0IGlzIG5vdyByZWZlcmVuY2VkLgogICAgICovCiAgICB2\nb2lkIHJlbW92ZURlcmVmZXJlbmNlZERlcGVuZGVudChTdGF0ZU1hbmFnZXJJ\nbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICBp\nZiAoX2RlcmVmQWRkaXRpb25zICE9IG51bGwpCiAgICAgICAgICAgICAgICBy\nZW1vdmVkID0gX2RlcmVmQWRkaXRpb25zLnJlbW92ZShzbSk7CiAgICAgICAg\nICAgIGlmICghcmVtb3ZlZCAmJiAoX2RlcmVmQ2FjaGUgPT0gbnVsbCB8fCAh\nX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKSkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZGVy\nZWZlZCIsCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmlu\nZyhzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS4KICAgICAgICAgICAgICAg\nICAgICBzZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkp\nLgogICAgICAgICAgICAgICAgICAgIHNldEZhdGFsKHRydWUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkaXJ0eVR5cGUoQ2xhc3MgY2xzKSB7\nCiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoX3VwZGF0ZWRDbHNzID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfdXBkYXRlZENsc3MgPSBuZXcgSGFzaFNldCgpOwogICAg\nICAgICAgICBfdXBkYXRlZENsc3MuYWRkKGNscyk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFBlcnNpc3RlZFR5cGVz\nKCkgewogICAgICAgIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBudWxsIHx8IF9w\nZXJzaXN0ZWRDbHNzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICByZXR1cm4gQ29sbGVjdGlv\nbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfcGVyc2lzdGVkQ2xzcyk7CiAg\nICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VXBkYXRlZFR5cGVzKCkg\newogICAgICAgIGlmIChfdXBkYXRlZENsc3MgPT0gbnVsbCB8fCBfdXBkYXRl\nZENsc3MuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlv\nbnMuRU1QVFlfU0VUOwogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1v\nZGlmaWFibGVDb2xsZWN0aW9uKF91cGRhdGVkQ2xzcyk7CiAgICB9CgogICAg\ncHVibGljIENvbGxlY3Rpb24gZ2V0RGVsZXRlZFR5cGVzKCkgewogICAgICAg\nIGlmIChfZGVsZXRlZENsc3MgPT0gbnVsbCB8fCBfZGVsZXRlZENsc3MuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlf\nU0VUOwogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVD\nb2xsZWN0aW9uKF9kZWxldGVkQ2xzcyk7CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8KICAgIC8vIENsb3NpbmcKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIGJvb2xlYW4gaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIF9jbG9zZWQ7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNDbG9zZUludm9rZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9jbG9zZWQgfHwgKF9mbGFncyAmIEZMQUdfQ0xP\nU0VfSU5WT0tFRCkgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9z\nZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGNs\nb3NpbmcgaW4gYW4gYWN0aXZlIGxvY2FsIHRyYW5zCiAgICAgICAgICAgIGlm\nICghX21hbmFnZWQgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgiYWN0aXZlIikpOwoKICAgICAgICAgICAgLy8gb25seSBj\nbG9zZSBpZiBub3QgYWN0aXZlOyBpZiBhY3RpdmUgbWFuYWdlZCB0cmFucyB3\nYWl0CiAgICAgICAgICAgIC8vIGZvciBjb21wbGV0aW9uCiAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX0NMT1NFX0lOVk9LRUQ7CgogICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAg\nICAgZnJlZSgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEZyZWUgdGhlIHJlc291cmNlcyB1c2VkIGJ5IHRoaXMgcGVyc2lzdGVuY2Ug\nbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZnJlZSgpIHsK\nICAgICAgICBSdW50aW1lRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAg\naWYgKChfYXV0b0RldGFjaCAmIERFVEFDSF9DTE9TRSkgIT0gMCkgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJu\nYWwoX2NhbGwpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgICAgICBlcnIgPSByZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgX3N5bmMgPSBudWxsOwogICAgICAg\nIF91c2VyT2JqZWN0cyA9IG51bGw7CiAgICAgICAgX2NhY2hlLmNsZWFyKCk7\nCiAgICAgICAgX3RyYW5zQ2FjaGUgPSBudWxsOwogICAgICAgIF9wZXJzaXN0\nZWRDbHNzID0gbnVsbDsKICAgICAgICBfdXBkYXRlZENsc3MgPSBudWxsOwog\nICAgICAgIF9kZWxldGVkQ2xzcyA9IG51bGw7CiAgICAgICAgX2RlcmVmQ2Fj\naGUgPSBudWxsOwogICAgICAgIF9wZW5kaW5nID0gbnVsbDsKICAgICAgICBf\nbG9hZGVyID0gbnVsbDsKICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIgPSBu\ndWxsOwogICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyID0gbnVsbDsKCiAgICAg\nICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOwogICAgICAgIHdoaWxlIChfc2F2\nZXBvaW50cyAhPSBudWxsICYmICFfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgc2F2ZSA9CiAgICAgICAgICAgICAgICAoT3BlbkpQQVNh\ndmVwb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKF9zYXZlcG9pbnRzLnNpemUo\nKSAtIDEpOwogICAgICAgICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAg\nICAgIH0KICAgICAgICBfc2F2ZXBvaW50cyA9IG51bGw7CiAgICAgICAgX3Nh\ndmVwb2ludENhY2hlID0gbnVsbDsKCiAgICAgICAgaWYgKF9xdWVyaWVzICE9\nIG51bGwpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfcXVl\ncmllcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAoKFF1ZXJ5KSBpdHIu\nbmV4dCgpKS5jbG9zZVJlc291cmNlcygpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9xdWVyaWVzID0gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIGlmIChfZXh0ZW50cyAhPSBudWxsKSB7CiAg\nICAgICAgICAgIEV4dGVudCBlOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9leHRlbnRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICBlID0gKEV4dGVudCkgaXRyLm5leHQoKTsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZS5jbG9z\nZUFsbCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF9leHRlbnRzID0gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIHRyeSB7IHJlbGVhc2VDb25uZWN0aW9uKCk7IH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHt9CgogICAgICAgIF9sbS5jbG9zZSgpOwogICAgICAg\nIF9zdG9yZS5jbG9zZSgpOwogICAgICAgIF9mbGFncyA9IDA7CiAgICAgICAg\nX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJs\nZWQoKSkKICAgICAgICAgICAgX2Nsb3NlZEV4Y2VwdGlvbiA9IG5ldyBJbGxl\nZ2FsU3RhdGVFeGNlcHRpb24oKTsKCiAgICAgICAgX2ZhY3RvcnkucmVsZWFz\nZUJyb2tlcih0aGlzKTsKCiAgICAgICAgaWYgKGVyciAhPSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBlcnI7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gU3luY2hyb25pemF0aW9uCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAo\nX2xvY2sgIT0gbnVsbCkKICAgICAgICAgICAgX2xvY2subG9jaygpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xv\nY2sgIT0gbnVsbCkKICAgICAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFN0YXRlIG1hbmFn\nZW1lbnQKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9i\namVjdCBuZXdJbnN0YW5jZShDbGFzcyBjbHMpIHsKICAgICAgICBhc3NlcnRP\ncGVuKCk7CgogICAgICAgIGlmICghY2xzLmlzSW50ZXJmYWNlKCkgJiYgTW9k\naWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24o\nX2xvYy5nZXQKICAgICAgICAgICAgICAgICgibmV3LWFic3RyYWN0IiwgY2xz\nKS5nZXRNZXNzYWdlKCkpOwoKICAgICAgICAvLyAxLjUgZG9lc24ndCBpbml0\naWFsaXplIGNsYXNzZXMgd2l0aG91dCBhIHRydWUgQ2xhc3MuZm9yTmFtZQog\nICAgICAgIGlmICghUENSZWdpc3RyeS5pc1JlZ2lzdGVyZWQoY2xzKSkgewog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFt\nZShjbHMuZ2V0TmFtZSgpLCB0cnVlLCAKICAgICAgICAgICAgICAgICAgICAo\nQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFz\nc0xvYWRlckFjdGlvbihjbHMpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRo\ncm93YWJsZSB0KSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIGlmIChfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLmdl\ndE1ldGFEYXRhKGNscywKICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoKSwg\nZmFsc2UpID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24oCiAgICAgICAgICAgICAgICBfbG9jLmdldCgi\nbm8taW50ZXJmYWNlLW1ldGFkYXRhIiwgY2xzLmdldE5hbWUoKSkuZ2V0TWVz\nc2FnZSgpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIFBD\nUmVnaXN0cnkubmV3SW5zdGFuY2UoY2xzLCBudWxsLCBmYWxzZSk7CiAgICAg\nICAgfSBjYXRjaCAoSWxsZWdhbFN0YXRlRXhjZXB0aW9uIGlzZSkgewogICAg\nICAgICAgICBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWFlID0KICAgICAg\nICAgICAgICAgIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oaXNlLmdl\ndE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlhZS5zZXRTdGFja1RyYWNlKGlz\nZS5nZXRTdGFja1RyYWNlKCkpOwogICAgICAgICAgICB0aHJvdyBpYWU7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0SWQo\nT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBp\nZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAg\ncmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwg\nX2NvbmYpKQogICAgICAgICAgICAgICAgLnBjRmV0Y2hPYmplY3RJZCgpOwog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nTG9ja0xldmVsKE9iamVjdCBvKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgIGlmIChvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORTsKCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSA9IGdldFN0YXRlTWFuYWdlcihvKTsKICAgICAgICBpZiAoc20gPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIExvY2tMZXZlbHMuTE9DS19OT05F\nOwogICAgICAgIHJldHVybiBnZXRMb2NrTWFuYWdlcigpLmdldExvY2tMZXZl\nbChzbSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRWZXJzaW9uKE9i\namVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYg\nKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJl\ndHVybiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9j\nb25mKSkucGNHZXRWZXJzaW9uKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eShPYmplY3Qgb2JqKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlYWJsZShvYmopKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUo\nb2JqLCBfY29uZik7CiAgICAgICAgICAgIHJldHVybiBwYy5wY0lzRGlydHko\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzVHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxI\nZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpCiAgICAg\nICAgICAgICAgICAucGNJc1RyYW5zYWN0aW9uYWwoKTsKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQZXJzaXN0\nZW50KE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAg\nICAgIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShv\nYmosIF9jb25mKSkucGNJc1BlcnNpc3RlbnQoKTsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNOZXcoT2JqZWN0\nIG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1w\nbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJu\nIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYp\nKS5wY0lzTmV3KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzRGVsZXRlZChPYmplY3Qgb2JqKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFu\nYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIu\ndG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNEZWxldGVk\nKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRGV0YWNoZWQoT2JqZWN0IG9iaikgewogICAgICAgIGlmICgh\nKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9\nIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7\nCiAgICAgICAgQm9vbGVhbiBkZXRhY2hlZCA9IHBjLnBjSXNEZXRhY2hlZCgp\nOwogICAgICAgIGlmIChkZXRhY2hlZCAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZGV0YWNoZWQuYm9vbGVhblZhbHVlKCk7CgogICAgICAgIC8vIGxh\nc3QgcmVzb3J0OiBpbnN0YW5jZSBpcyBkZXRhY2hlZCBpZiBpdCBoYXMgYSBz\ndG9yZSByZWNvcmQKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29u\nZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAg\nICBnZXRNZXRhRGF0YShJbXBsSGVscGVyLmdldE1hbmFnZWRJbnN0YW5jZShw\nYykuZ2V0Q2xhc3MoKSwKICAgICAgICAgICAgICAgIF9sb2FkZXIsIHRydWUp\nOwogICAgICAgIE9iamVjdCBvaWQgPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUo\ncGMsIG1ldGEpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBmaW5kKG9pZCwgbnVs\nbCwgRVhDTFVERV9BTEwsIG51bGwsIDApICE9IG51bGw7CiAgICB9CgogICAg\ncHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0U3RhdGVNYW5hZ2VyKE9i\namVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0\ndXJuIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCBmYWxzZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRo\nZSBnaXZlbiBpbnN0YW5jZSwgb3IgbnVsbC4KICAgICAqCiAgICAgKiBAcGFy\nYW0gYXNzZXJ0VGhpc0NvbnRleHQgaWYgdHJ1ZSwgdGhvdyBhbiBleGNlcHRp\nb24gaWYgdGhlIGdpdmVuCiAgICAgKiBvYmplY3QgaXMgbWFuYWdlZCBieSBh\nbm90aGVyIGJyb2tlcgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5h\nZ2VySW1wbCBnZXRTdGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvYmosCiAgICAg\nICAgYm9vbGVhbiBhc3NlcnRUaGlzQ29udGV4dCkgewogICAgICAgIGlmIChJ\nbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKSB7CiAgICAgICAgICAgIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5j\nZUNhcGFibGUob2JqLCBfY29uZik7CiAgICAgICAgICAgIGlmIChwYy5wY0dl\ndEdlbmVyaWNDb250ZXh0KCkgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJl\ndHVybiAoU3RhdGVNYW5hZ2VySW1wbCkgcGMucGNHZXRTdGF0ZU1hbmFnZXIo\nKTsKICAgICAgICAgICAgaWYgKGFzc2VydFRoaXNDb250ZXh0ICYmIHBjLnBj\nR2V0R2VuZXJpY0NvbnRleHQoKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5hZ2Vk\nIiwKICAgICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9i\naikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBvaWQuCiAgICAgKgogICAg\nICogQHBhcmFtIGFsbG93TmV3IGlmIHRydWUsIG9iamVjdHMgbWFkZSBwZXJz\naXN0ZW50IGluIHRoZSBjdXJyZW50CiAgICAgKiB0cmFuc2FjdGlvbiB3aWxs\nIGJlIGluY2x1ZGVkIGluIHRoZSBzZWFyY2g7IGlmCiAgICAgKiBtdWx0aXBs\nZSBuZXcgb2JqZWN0cyBtYXRjaCB0aGUgZ2l2ZW4gb2lkLCBpdCBpcwogICAg\nICogdW5kZWZpbmVkIHdoaWNoIHdpbGwgYmUgcmV0dXJuZWQKICAgICAqLwog\nICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbEJ5SWQoT2JqZWN0IG9pZCwKICAgICAgICBib29sZWFuIGFsbG93TmV3\nKSB7CiAgICAgICAgcmV0dXJuIF9jYWNoZS5nZXRCeUlkKG9pZCwgYWxsb3dO\nZXcpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBnaXZlbiBp\nbnN0YW5jZSBhcyBhIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGV9LgogICAg\nICogSWYgdGhlIGluc3RhbmNlIGlzIG5vdCBtYW5hZ2VhYmxlIHRocm93IHRo\nZSBwcm9wZXIgZXhjZXB0aW9uLgogICAgICovCiAgICBwcm90ZWN0ZWQgUGVy\nc2lzdGVuY2VDYXBhYmxlIGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShPYmpl\nY3Qgb2JqKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFn\nZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIudG9Q\nZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7CgogICAgICAgIC8vIGNo\nZWNrIGZvciBkaWZmZXJlbnQgaW5zdGFuY2VzIG9mIHRoZSBQZXJzaXN0ZW5j\nZUNhcGFibGUgaW50ZXJmYWNlCiAgICAgICAgLy8gYW5kIHRocm93IGEgYmV0\ndGVyIGVycm9yIHRoYXQgbWVudGlvbnMgdGhlIGNsYXNzIGxvYWRlcnMKICAg\nICAgICBDbGFzc1tdIGludGZzID0gb2JqLmdldENsYXNzKCkuZ2V0SW50ZXJm\nYWNlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpbnRmcyAhPSBudWxs\nICYmIGkgPCBpbnRmcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\naW50ZnNbaV0uZ2V0TmFtZSgpLmVxdWFscyhQZXJzaXN0ZW5jZUNhcGFibGUu\nY2xhc3MuZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBjLWxvYWRlci1kaWZmZXJlbnQi\nLAogICAgICAgICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2Jq\nKSwKICAgICAgICAgICAgICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbigKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFz\ncykpLAogICAgICAgICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGludGZz\nW2ldKSkpKQogICAgICAgICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3Qo\nb2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90\nIGVuaGFuY2VkCiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoInBjLWNhc3QiLAogICAgICAgICAgICBFeGNlcHRpb25zLnRvU3Ry\naW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8KICAgIC8vIFV0aWxzCiAgICAvLy8vLy8vLy8KICAgIC8qKgog\nICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBjb250ZXh0IGlzIGNs\nb3NlZC4gIFRoZSBleGFjdCBtZXNzYWdlIGFuZAogICAgICogY29udGVudCBv\nZiB0aGUgZXhjZXB0aW9uIHZhcmllcyB3aGV0aGVyIFRSQUNFIGlzIGVuYWJs\nZWQgb3Igbm90LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRPcGVu\nKCkgewogICAgICAgIGlmIChfY2xvc2VkKSB7CiAgICAgICAgICAgIGlmIChf\nY2xvc2VkRXhjZXB0aW9uID09IG51bGwpICAvLyBUUkFDRSBub3QgZW5hYmxl\nZAogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiY2xvc2VkLW5vdHJhY2UiKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFFeGNlcHRpb24gZSA9IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgX2xv\nYy5nZXQoImNsb3NlZCIpLCBfY2xvc2VkRXhjZXB0aW9uKS5zZXRGYXRhbCh0\ncnVlKTsKICAgICAgICAgICAgICAgIGUuc2V0Q2F1c2UoX2Nsb3NlZEV4Y2Vw\ndGlvbik7CiAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydEFjdGl2\nZVRyYW5zYWN0aW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0\naW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0aXZlIikpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhyb3cgZXhjZXB0aW9uIGlmIGEgdHJhbnNhY3Rp\nb24tcmVsYXRlZCBvcGVyYXRpb24gaXMgYXR0ZW1wdGVkIGFuZAogICAgICog\nbm8gdHJhbnNhY3Rpb24gaXMgYWN0aXZlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKSB7CiAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLWFjdGl2ZSIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb250\ncmFuc2FjdGlvbmFsUmVhZCgpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSA9PSAwICYmICFfbm9udHJhbnNSZWFkKQogICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb24tdHJhbnMtcmVhZCIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3Nl\ncnRXcml0ZU9wZXJhdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSA9PSAwICYmICghX25vbnRyYW5zV3JpdGUKICAgICAgICAg\nICAgfHwgKF9hdXRvRGV0YWNoICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJ3cml0ZS1vcGVyYXRpb24iKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYW4gb2JqZWN0IG5vdCBmb3VuZCBleGNlcHRpb24g\nY29udGFpbmluZyBuZXN0ZWQgZXhjZXB0aW9ucwogICAgICogZm9yIGFsbCBv\nZiB0aGUgZ2l2ZW4gZmFpbGVkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG5ld09iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uCiAgICAgICAgKENvbGxlY3Rpb24gZmFpbGVkKSB7\nCiAgICAgICAgVGhyb3dhYmxlW10gdCA9IG5ldyBUaHJvd2FibGVbZmFpbGVk\nLnNpemUoKV07CiAgICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTsgaWR4KyspCiAgICAgICAgICAgIHRbaWR4XSA9IG5ldyBPYmplY3ROb3RG\nb3VuZEV4Y2VwdGlvbihpdHIubmV4dCgpKTsKICAgICAgICByZXR1cm4gbmV3\nIE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCwgdCk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZp\nbmRDYWxsYmFja3MgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBwcm9jZXNz\nQXJndW1lbnQoT2JqZWN0IG9pZCkgewogICAgICAgIHJldHVybiBvaWQ7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBwcm9jZXNzUmV0dXJuKE9iamVjdCBv\naWQsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICByZXR1cm4g\nKHNtID09IG51bGwpID8gbnVsbCA6IHNtLmdldE1hbmFnZWRJbnN0YW5jZSgp\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdChPYmplY3RP\ndXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKGlzQWN0aXZlKCkpIHsKICAgICAgICAgICAgICAg\nIGlmICghZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIF9sb2MuZ2V0KCJjYW50LXNlcmlhbGl6ZS1wZXNzaW1pc3Rp\nYy1icm9rZXIiKSk7CiAgICAgICAgICAgICAgICBpZiAoaGFzRmx1c2hlZCgp\nKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJj\nYW50LXNlcmlhbGl6ZS1mbHVzaGVkLWJyb2tlciIpKTsKICAgICAgICAgICAg\nICAgIGlmIChoYXNDb25uZWN0aW9uKCkpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgICAgICAgICAgX2xvYy5nZXQoImNhbnQtc2VyaWFsaXplLWNvbm5lY3Rl\nZC1icm9rZXIiKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBfaXNTZXJpYWxpemluZyA9IHRydWU7CiAgICAg\nICAgICAgICAgICBvdXQud3JpdGVPYmplY3QoX2ZhY3RvcnkuZ2V0UG9vbEtl\neSgpKTsKICAgICAgICAgICAgICAgIG91dC5kZWZhdWx0V3JpdGVPYmplY3Qo\nKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9p\nc1NlcmlhbGl6aW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlYWRPYmplY3QoT2JqZWN0SW5wdXRT\ndHJlYW0gaW4pCiAgICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRp\nb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3QgZmFjdG9yeUtleSA9\nIGluLnJlYWRPYmplY3QoKTsKICAgICAgICBBYnN0cmFjdEJyb2tlckZhY3Rv\ncnkgZmFjdG9yeSA9CiAgICAgICAgICAgIEFic3RyYWN0QnJva2VyRmFjdG9y\neS5nZXRQb29sZWRGYWN0b3J5Rm9yS2V5KGZhY3RvcnlLZXkpOwoKICAgICAg\nICAvLyB0aGlzIG5lZWRzIHRvIGhhcHBlbiBiZWZvcmUgZGVmYXVsdFJlYWRP\nYmplY3Qgc28gdGhhdCBpdCdzCiAgICAgICAgLy8gYXZhaWxhYmxlIGZvciBj\nYWxscyB0byBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpIGR1cmluZwogICAg\nICAgIC8vIFN0YXRlTWFuYWdlciBkZXNlcmlhbGl6YXRpb24KICAgICAgICBf\nY29uZiA9IGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIAog\nICAgICAgIGluLmRlZmF1bHRSZWFkT2JqZWN0KCk7CiAgICAgICAgZmFjdG9y\neS5pbml0aWFsaXplQnJva2VyKF9tYW5hZ2VkLCBfY29ublJldGFpbk1vZGUs\nIHRoaXMsIHRydWUpOwoKICAgICAgICAvLyByZS1pbml0aWFsaXplIHRoZSBs\nb2NrIGlmIG5lZWRlZC4KICAgICAgICBzZXRNdWx0aXRocmVhZGVkKF9tdWx0\naXRocmVhZGVkKTsKCiAgICAgICAgaWYgKGlzQWN0aXZlKCkgJiYgX3J1bnRp\nbWUgaW5zdGFuY2VvZiBMb2NhbE1hbmFnZWRSdW50aW1lKQogICAgICAgICAg\nICAoKExvY2FsTWFuYWdlZFJ1bnRpbWUpIF9ydW50aW1lKS5iZWdpbigpOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBvciBub3QgdGhpcyBicm9r\nZXIgaXMgaW4gdGhlIG1pZHN0IG9mIGJlaW5nIHNlcmlhbGl6ZWQuCiAgICAg\nKgogICAgICogQHNpbmNlIDEuMS4wIAogICAgICovCiAgICBib29sZWFuIGlz\nU2VyaWFsaXppbmcoKSB7CiAgICAgICAgcmV0dXJuIF9pc1NlcmlhbGl6aW5n\nOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNhY3Rpb25hbCBjYWNoZSB0\naGF0IGhvbGRzIHNvZnQgcmVmcyB0byBjbGVhbiBpbnN0YW5jZXMuCiAgICAg\nKi8KICAgIHN0YXRpYyBjbGFzcyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAgICAg\nICBpbXBsZW1lbnRzIFNldCwgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBib29sZWFuIF9vcmRlckRpcnR5OwogICAgICAgIHByaXZh\ndGUgU2V0IF9kaXJ0eSA9IG51bGw7CiAgICAgICAgcHJpdmF0ZSBTZXQgX2Ns\nZWFuID0gbnVsbDsKCiAgICAgICAgcHVibGljIFRyYW5zYWN0aW9uYWxDYWNo\nZShib29sZWFuIG9yZGVyRGlydHkpIHsKICAgICAgICAgICAgX29yZGVyRGly\ndHkgPSBvcmRlckRpcnR5OwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0\nZSBtYW5hZ2Vycy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBjb3B5KCkgewogICAgICAgICAgICBpZiAoaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKCiAg\nICAgICAgICAgIC8vIHNpemUgbWF5IG5vdCBiZSBlbnRpcmVseSBhY2N1cmF0\nZSBkdWUgdG8gcmVmcyBleHBpcmluZywgc28KICAgICAgICAgICAgLy8gbWFu\ndWFsbHkgY29weSBlYWNoIG9iamVjdDsgZG9lc24ndCBtYXR0ZXIgdGhpcyB3\nYXkgaWYgc2l6ZSB0b28KICAgICAgICAgICAgLy8gYmlnIGJ5IHNvbWUKICAg\nICAgICAgICAgU2V0IGNvcHkgPSBuZXcgTGlua2VkSGFzaFNldChzaXplKCkp\nOwogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9kaXJ0eS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBjb3B5LmFkZChp\ndHIubmV4dCgpKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxsKQog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfY2xlYW4uaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAg\nY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIHJldHVybiBjb3B5\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEg\nY29weSBvZiBhbGwgZGlydHkgc3RhdGUgbWFuYWdlcnMuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24gY29weURpcnR5KCkgewogICAg\nICAgICAgICBpZiAoX2RpcnR5ID09IG51bGwgfHwgX2RpcnR5LmlzRW1wdHko\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9T\nRVQ7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGlua2VkSGFzaFNldChfZGly\ndHkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNm\nZXIgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gdGhlIGRpcnR5IGNhY2hlIHRv\nIHRoZSBjbGVhbiBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCBmbHVzaGVkKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAg\nICAgaWYgKHNtLmlzRGlydHkoKSAmJiBfZGlydHkgIT0gbnVsbCAmJiBfZGly\ndHkucmVtb3ZlKHNtKSkKICAgICAgICAgICAgICAgIGFkZENsZWFuSW50ZXJu\nYWwoc20pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQWRk\nIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGUgY2xlYW4gY2FjaGUuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkQ2xlYW4oU3RhdGVNYW5h\nZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoYWRkQ2xlYW5JbnRlcm5h\nbChzbSkgJiYgX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGly\ndHkucmVtb3ZlKHNtKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgYm9v\nbGVhbiBhZGRDbGVhbkludGVybmFsKFN0YXRlTWFuYWdlckltcGwgc20pIHsK\nICAgICAgICAgICAgaWYgKF9jbGVhbiA9PSBudWxsKQogICAgICAgICAgICAg\nICAgX2NsZWFuID0gbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFz\naFNldC5TT0ZUKTsKICAgICAgICAgICAgcmV0dXJuIF9jbGVhbi5hZGQoc20p\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIHRoZSBn\naXZlbiBpbnN0YW5jZSB0byB0aGUgZGlydHkgY2FjaGUuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIHZvaWQgYWRkRGlydHkoU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgICAgICBpZiAoX2RpcnR5ID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGlmIChfb3JkZXJEaXJ0eSkKICAgICAgICAgICAgICAg\nICAgICBfZGlydHkgPSBNYXBCYWNrZWRTZXQuZGVjb3JhdGUobmV3IExpbmtl\nZE1hcCgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBfZGlydHkgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChfZGlydHkuYWRkKHNtKSkKICAgICAgICAgICAgICAg\nIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20pOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogUmVtb3ZlIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9t\nIHRoZSBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgYm9vbGVh\nbiByZW1vdmUoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBy\nZXR1cm4gcmVtb3ZlQ2xlYW5JbnRlcm5hbChzbSkKICAgICAgICAgICAgICAg\nIHx8IChfZGlydHkgIT0gbnVsbCAmJiBfZGlydHkucmVtb3ZlKHNtKSk7CiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIGJvb2xlYW4gcmVtb3ZlQ2xlYW5J\nbnRlcm5hbChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfY2xlYW4gIT0gbnVsbCAmJiBfY2xlYW4ucmVtb3ZlKHNtKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsK\nICAgICAgICAgICAgSXRlcmF0b3JDaGFpbiBjaGFpbiA9IG5ldyBJdGVyYXRv\nckNoYWluKCk7CiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCAmJiAh\nX2RpcnR5LmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGNoYWluLmFkZEl0\nZXJhdG9yKF9kaXJ0eS5pdGVyYXRvcigpKTsKICAgICAgICAgICAgaWYgKF9j\nbGVhbiAhPSBudWxsICYmICFfY2xlYW4uaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgY2hhaW4uYWRkSXRlcmF0b3IoX2NsZWFuLml0ZXJhdG9yKCkpOwog\nICAgICAgICAgICByZXR1cm4gY2hhaW47CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3Qgb2JqKSB7CiAgICAgICAg\nICAgIHJldHVybiAoX2RpcnR5ICE9IG51bGwgJiYgX2RpcnR5LmNvbnRhaW5z\nKG9iaikpCiAgICAgICAgICAgICAgICB8fCAoX2NsZWFuICE9IG51bGwgJiYg\nX2NsZWFuLmNvbnRhaW5zKG9iaikpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gY29udGFpbnNBbGwoQ29sbGVjdGlvbiBjb2xsKSB7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgIGlmICghY29udGFp\nbnMoaXRyLm5leHQoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgICAgICBpZiAoX2Rp\ncnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGlydHkgPSBudWxsOwog\nICAgICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfY2xlYW4gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIChfZGlydHkg\nPT0gbnVsbCB8fCBfZGlydHkuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\nJiYgKF9jbGVhbiA9PSBudWxsIHx8IF9jbGVhbi5pc0VtcHR5KCkpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAg\nICBpbnQgc2l6ZSA9IDA7CiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHNpemUgKz0gX2RpcnR5LnNpemUoKTsKICAg\nICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxsKQogICAgICAgICAgICAgICAg\nc2l6ZSArPSBfY2xlYW4uc2l6ZSgpOwogICAgICAgICAgICByZXR1cm4gc2l6\nZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZChPYmpl\nY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9w\nZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gYWRkQWxsKENvbGxlY3Rpb24gY29sbCkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZShPYmpl\nY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9w\nZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gcmVtb3ZlQWxsKENvbGxlY3Rpb24gY29sbCkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24o\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJldGFpbkFs\nbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheShPYmplY3Rb\nXSBhcnIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3Bl\ncmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVW5pcXVlIGlkIGZvciBzdGF0ZSBtYW5hZ2VycyBvZiBuZXcgZGF0\nYXN0b3JlIGluc3RhbmNlcyB3aXRob3V0IGFzc2lnbmVkCiAgICAgKiBvYmpl\nY3QgaWRzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTdGF0\nZU1hbmFnZXJJZAogICAgICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsK\nCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU1RSSU5HX1BS\nRUZJWCA9ICJvcGVuanBhc206IjsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMg\nbG9uZyBfZ2VuZXJhdG9yID0gMDsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBp\nbnQgX2JoYXNoOwogICAgICAgIHByaXZhdGUgZmluYWwgbG9uZyBfaWQ7Cgog\nICAgICAgIHB1YmxpYyBzdGF0aWMgU3RhdGVNYW5hZ2VySWQgbmV3SW5zdGFu\nY2UoQnJva2VyIGIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0ZU1h\nbmFnZXJJZChTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZShiKSwgX2dlbmVyYXRv\ncisrKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgU3RhdGVNYW5hZ2Vy\nSWQoaW50IGJoYXNoLCBsb25nIGlkKSB7CiAgICAgICAgICAgIF9iaGFzaCA9\nIGJoYXNoOwogICAgICAgICAgICBfaWQgPSBpZDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBTdGF0ZU1hbmFnZXJJZChTdHJpbmcgc3RyKSB7CiAgICAg\nICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoU1RSSU5HX1BSRUZJWC5sZW5n\ndGgoKSk7CiAgICAgICAgICAgIGludCBpZHggPSBzdHIuaW5kZXhPZignOicp\nOwogICAgICAgICAgICBfYmhhc2ggPSBJbnRlZ2VyLnBhcnNlSW50KHN0ci5z\ndWJzdHJpbmcoMCwgaWR4KSk7CiAgICAgICAgICAgIF9pZCA9IExvbmcucGFy\nc2VMb25nKHN0ci5zdWJzdHJpbmcoaWR4ICsgMSkpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewog\nICAgICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIShvdGhlciBpbnN0YW5j\nZW9mIFN0YXRlTWFuYWdlcklkKSkKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySWQgc2lkID0gKFN0YXRl\nTWFuYWdlcklkKSBvdGhlcjsKICAgICAgICAgICAgcmV0dXJuIF9iaGFzaCA9\nPSBzaWQuX2JoYXNoICYmIF9pZCA9PSBzaWQuX2lkOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIChpbnQpIChfaWQgXiAoX2lkID4+PiAzMikpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAg\ncmV0dXJuIFNUUklOR19QUkVGSVggKyBfYmhhc2ggKyAiOiIgKyBfaWQ7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29sbGVjdGlvbiB0eXBl\nIHRoYXQgaG9sZHMgc3RhdGUgbWFuYWdlcnMgYnV0IHdob3NlIGludGVyZmFj\nZSBkZWFscwogICAgICogd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtYW5hZ2Vk\nIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE1h\nbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAgICAgICAgZXh0ZW5kcyBBYnN0cmFj\ndENvbGxlY3Rpb24gewoKICAgICAgICBwcml2YXRlIGZpbmFsIENvbGxlY3Rp\nb24gX3N0YXRlczsKCiAgICAgICAgcHVibGljIE1hbmFnZWRPYmplY3RDb2xs\nZWN0aW9uKENvbGxlY3Rpb24gc3RhdGVzKSB7CiAgICAgICAgICAgIF9zdGF0\nZXMgPSBzdGF0ZXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBnZXRTdGF0ZU1hbmFnZXJzKCkgewogICAgICAgICAgICByZXR1cm4g\nX3N0YXRlczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZXMuc2l6ZSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9yIGl0ZXJhdG9yKCkgewogICAg\nICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yKCkgewogICAgICAgICAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBJdGVyYXRvciBfaXRyID0gX3N0YXRlcy5pdGVy\nYXRvcigpOwoKICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhhc05l\neHQoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9pdHIuaGFzTmV4\ndCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1Ymxp\nYyBPYmplY3QgbmV4dCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBfaXRyLm5leHQoKSkuCiAgICAgICAg\nICAgICAgICAgICAgICAgIGdldE1hbmFnZWRJbnN0YW5jZSgpOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJlbW92\nZSgpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NpZ24gdGhl\nIG9iamVjdCBpZCB0byB0aGUgY2FjaGUuIEV4Y2VwdGlvbiB3aWxsIGJlCiAg\nICAgKiB0aHJvd24gaWYgdGhlIGlkIGFscmVhZHkgZXhpc3RzIGluIHRoZSBj\nYWNoZS4gCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFzc2lnbk9iamVj\ndElkKE9iamVjdCBjYWNoZSwgT2JqZWN0IGlkLCAKICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgKChNYW5hZ2VkQ2FjaGUpIGNhY2hl\nKS5hc3NpZ25PYmplY3RJZChpZCwgc20pOyAKICAgIH0KCiAgICAvKiogCiAg\nICAgKiBUaGlzIG1ldGhvZCBtYWtlcyBzdXJlIHdlIGRvbid0IGFscmVhZHkg\naGF2ZSB0aGUgaW5zdGFuY2UgY2FjaGVkCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGNoZWNrRm9yRHVwbGljYXRlSWQoT2JqZWN0IGlkLCBPYmplY3Qg\nb2JqKSB7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBvdGhlciA9IGdldFN0\nYXRlTWFuYWdlckltcGxCeUlkKGlkLCBmYWxzZSk7CiAgICAgICAgaWYgKG90\naGVyICE9IG51bGwgJiYgIW90aGVyLmlzRGVsZXRlZCgpICYmICFvdGhlci5p\nc05ldygpKQogICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJjYWNoZS1leGlzdHMiLAogICAgICAgICAgICAg\nICAgb2JqLmdldENsYXNzKCkuZ2V0TmFtZSgpLCBpZCkpLnNldEZhaWxlZE9i\namVjdChvYmopOwogICAgfQp9Cg==\n","encoding":"base64"}

