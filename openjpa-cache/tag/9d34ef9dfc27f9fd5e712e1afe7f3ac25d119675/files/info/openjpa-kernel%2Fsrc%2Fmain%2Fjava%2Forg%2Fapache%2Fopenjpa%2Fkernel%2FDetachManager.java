{"sha":"8a8afefd9b1a7409bec05da63b4ee17080f7aba2","node_id":"MDQ6QmxvYjIwNjM2NDo4YThhZmVmZDliMWE3NDA5YmVjMDVkYTYzYjRlZTE3MDgwZjdhYmEy","size":30462,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8a8afefd9b1a7409bec05da63b4ee17080f7aba2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuQ29tcGF0aWJpbGl0eTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5jb25mLkRldGFjaE9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuQ2FsbGJhY2tNb2RlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNhbGxiYWNrRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5TWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRp\nb247CgovKioKICogSGFuZGxlcyBkZXRhY2hpbmcgaW5zdGFuY2VzLgogKgog\nKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogKiBAbm9qYXZhZG9jCiAq\nLwpwdWJsaWMgY2xhc3MgRGV0YWNoTWFuYWdlcgogICAgaW1wbGVtZW50cyBE\nZXRhY2hTdGF0ZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgTG9jYWxpemVyIF9s\nb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZShEZXRhY2hNYW5hZ2VyLmNsYXNz\nKTsKCiAgICBwcml2YXRlIGZpbmFsIEJyb2tlckltcGwgX2Jyb2tlcjsKICAg\nIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfY29weTsKICAgIHByaXZhdGUgZmlu\nYWwgYm9vbGVhbiBfZnVsbDsKICAgIHByaXZhdGUgZmluYWwgUHJveHlNYW5h\nZ2VyIF9wcm94eTsKICAgIHByaXZhdGUgZmluYWwgRGV0YWNoT3B0aW9ucyBf\nb3B0czsKICAgIHByaXZhdGUgZmluYWwgT3BDYWxsYmFja3MgX2NhbGw7CiAg\nICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX2ZhaWxGYXN0OwogICAgcHJpdmF0\nZSBib29sZWFuIF9mbHVzaGVkID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX2ZsdXNoQmVmb3JlRGV0YWNoOwogICAgcHJpdmF0ZSBib29sZWFuIF9y\nZWxvYWRPbkRldGFjaDsKCiAgICAvLyBpZiB3ZSdyZSBub3QgZGV0YWNoaW5n\nIGZ1bGwsIHdlIG5lZWQgdG8gdHJhY2sgYWxsIGRldGFjaGVkIG9iamVjdHM7\nCiAgICAvLyBpZiB3ZSBhcmUsIHRoZW4gd2UgdXNlIGEgc3BlY2lhbCBmaWVs\nZCBtYW5hZ2VyIGZvciBtb3JlIGVmZmljaWVudAogICAgLy8gZGV0YWNobWVu\ndCB0aGFuIHRoZSBzdGFuZGFyZCBvbmUKICAgIHByaXZhdGUgZmluYWwgSWRl\nbnRpdHlNYXAgX2RldGFjaGVkOwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hG\naWVsZE1hbmFnZXIgX2Z1bGxGTTsKCiAgICAvKioKICAgICAqIFVzZWQgdG8g\ncHJlcGFyZSBhIGRldGFjaGFibGUgaW5zdGFuY2UgdGhhdCBkb2VzIG5vdCBl\neHRlcm5hbGl6ZQogICAgICogZGV0YWNoZWQgc3RhdGUuCiAgICAgKi8KICAg\nIHN0YXRpYyBib29sZWFuIHByZVNlcmlhbGl6ZShTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoc20uZ2V0QnJva2Vy\nKCkuZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5j\nZSgpCiAgICAgICAgICAgICAgICAuZ2V0Rmx1c2hCZWZvcmVEZXRhY2goKSkg\newogICAgICAgICAgICBmbHVzaERpcnR5KHNtKTsKICAgICAgICB9CgogICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAg\nICAgICAgYm9vbGVhbiBzZXRTdGF0ZSA9IG1ldGEuZ2V0RGV0YWNoZWRTdGF0\nZSgpICE9IG51bGwKICAgICAgICAgICAgJiYgIUNsYXNzTWV0YURhdGEuU1lO\nVEhFVElDLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUoKSk7CiAgICAg\nICAgQml0U2V0IGlkeHMgPSAoc2V0U3RhdGUpID8gbmV3IEJpdFNldChtZXRh\nLmdldEZpZWxkcygpLmxlbmd0aCkgOiBudWxsOwogICAgICAgIHByZURldGFj\naChzbS5nZXRCcm9rZXIoKSwgc20sIGlkeHMsIGZhbHNlLCB0cnVlKTsKCiAg\nICAgICAgaWYgKHNldFN0YXRlKSB7CiAgICAgICAgICAgIHNtLmdldFBlcnNp\nc3RlbmNlQ2FwYWJsZSgpLnBjU2V0RGV0YWNoZWRTdGF0ZShnZXREZXRhY2hl\nZFN0YXRlCiAgICAgICAgICAgICAgICAoc20sIGlkeHMpKTsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOyAvLyBkb24ndCBudWxsIHN0YXRlCiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICog\nVXNlZCBieSBjbGFzc2VzIHRoYXQgZXh0ZXJuYWxpemUgZGV0YWNoZWQgc3Rh\ndGUuCiAgICAgKgogICAgICogQHJldHVybiB3aGV0aGVyIHRvIHVzZSBhIGRl\ndGFjaGVkIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgc3RhdGljIGJvb2xl\nYW4gd3JpdGVEZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwgc20sIE9i\namVjdE91dHB1dCBvdXQsCiAgICAgICAgQml0U2V0IGlkeHMpCiAgICAgICAg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXNtLmlzUGVyc2lz\ndGVudCgpKSB7CiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsg\nLy8gc3RhdGUKICAgICAgICAgICAgb3V0LndyaXRlT2JqZWN0KG51bGwpOyAv\nLyBzbQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAg\nICAgICAvLyBkaXJ0eSBzdGF0ZSBjYXVzZXMgZmx1c2gKICAgICAgICBmbHVz\naERpcnR5KHNtKTsKCiAgICAgICAgQnJva2VyIGJyb2tlciA9IHNtLmdldEJy\nb2tlcigpOwogICAgICAgIHByZURldGFjaChicm9rZXIsIHNtLCBpZHhzLCBm\nYWxzZSwgdHJ1ZSk7CgogICAgICAgIC8vIHdyaXRlIGRldGFjaGVkIHN0YXRl\nIG9iamVjdCBhbmQgc3RhdGUgbWFuYWdlcgogICAgICAgIERldGFjaE9wdGlv\nbnMgb3B0cyA9IGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAg\nICAgIGdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBpZiAoIW9w\ndHMuZ2V0RGV0YWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAgICB8fCAh\ndXNlRGV0YWNoZWRTdGF0ZU1hbmFnZXIoc20sIG9wdHMpKSB7CiAgICAgICAg\nICAgIG91dC53cml0ZU9iamVjdChnZXREZXRhY2hlZFN0YXRlKHNtLCBpZHhz\nKSk7CiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBvdXQud3Jp\ndGVPYmplY3QobnVsbCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG5ldyBE\nZXRhY2hlZFN0YXRlTWFuYWdlcihzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUo\nKSwKICAgICAgICAgICAgc20sIGlkeHMsIG9wdHMuZ2V0QWNjZXNzVW5sb2Fk\nZWQoKSwgYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSkpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZHkgdGhlIG9i\namVjdCBmb3IgZGV0YWNobWVudCwgaW5jbHVkaW5nIGxvYWRpbmcgdGhlIGZp\nZWxkcyB0byBiZQogICAgICogZGV0YWNoZWQgYW5kIHVwZGF0aW5nIHZlcnNp\nb24gaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGlkeHMgdGhl\nIGluZGV4ZXMgb2YgZmllbGRzIHRvIGRldGFjaCB3aWxsIGJlIHNldCBhcyBh\nIHNpZGUKICAgICAqIGVmZmVjdCBvZiB0aGlzIG1ldGhvZAogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyB2b2lkIHByZURldGFjaChCcm9rZXIgYnJva2Vy\nLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIEJpdFNldCBpZHhzLCBi\nb29sZWFuIGZ1bGwsIAogICAgICAgIGJvb2xlYW4gcmVsb2FkT25EZXRhY2gp\nIHsKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGV4aXN0aW5nIG9iamVjdCBo\nYXMgdGhlIHJpZ2h0IGZpZWxkcyBmZXRjaGVkOyBjYWxsCiAgICAgICAgLy8g\nZXZlbiBpZiB1c2luZyBjdXJyZW50bHktbG9hZGVkIGZpZWxkcyBmb3IgZGV0\nYWNoIHRvIG1ha2Ugc3VyZQogICAgICAgIC8vIHZlcnNpb24gaXMgc2V0CiAg\nICAgICAgaW50IGRldGFjaE1vZGUgPSBicm9rZXIuZ2V0RGV0YWNoU3RhdGUo\nKTsKICAgICAgICBpbnQgbG9hZE1vZGUgPSBTdGF0ZU1hbmFnZXJJbXBsLkxP\nQURfRkdTOwogICAgICAgIEJpdFNldCBleGNsdWRlID0gbnVsbDsKICAgICAg\nICBpZiAoZGV0YWNoTW9kZSA9PSBERVRBQ0hfTE9BREVEKQogICAgICAgICAg\nICBleGNsdWRlID0gU3RvcmVDb250ZXh0LkVYQ0xVREVfQUxMOwogICAgICAg\nIGVsc2UgaWYgKGRldGFjaE1vZGUgPT0gREVUQUNIX0FMTCkKICAgICAgICAg\nICAgbG9hZE1vZGUgPSBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxMOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChkZXRhY2hNb2RlICE9IERFVEFD\nSF9MT0FERUQgfHwgCiAgICAgICAgICAgICAgICAgICAgcmVsb2FkT25EZXRh\nY2ggfHwKICAgICAgICAgICAgICAgICAgICAoIXJlbG9hZE9uRGV0YWNoICYm\nICFmdWxsKSkgewogICAgICAgICAgICAgICAgc20ubG9hZChicm9rZXIuZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCksIGxvYWRNb2RlLCBleGNsdWRlLAogICAg\nICAgICAgICAgICAgICAgIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUp\nIHsKICAgICAgICAgICAgLy8gY29uc3VtZSB0aGUgZXhjZXB0aW9uCiAgICAg\nICAgfQoKICAgICAgICAvLyBjcmVhdGUgYml0c2V0IG9mIGZpZWxkcyB0byBk\nZXRhY2g7IGlmIG1vZGUgaXMgYWxsIHdlIGNhbiB1c2UKICAgICAgICAvLyBj\ndXJyZW50bHkgbG9hZGVkIGJpdHNldCBjbG9uZSwgc2luY2Ugd2Uga25vdyBh\nbGwgZmllbGRzIGFyZSBsb2FkZWQKICAgICAgICBpZiAoaWR4cyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChkZXRhY2hNb2RlID09IERFVEFDSF9GRVRD\nSF9HUk9VUFMpCiAgICAgICAgICAgICAgICBzZXRGZXRjaEdyb3VwRmllbGRz\nKGJyb2tlciwgc20sIGlkeHMpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBpZHhzLm9yKHNtLmdldExvYWRlZCgpKTsKCiAgICAgICAgICAg\nIC8vIGNsZWFyIGxycyBmaWVsZHMKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKQogICAgICAg\nICAgICAgICAgICAgIGlkeHMuY2xlYXIoaSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2VuZXJhdGUgdGhlIGRldGFjaGVkIHN0YXRlIGZv\nciB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIE9iamVjdCBnZXREZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwg\nc20sIEJpdFNldCBmaWVsZHMpIHsKICAgICAgICAvLyBpZiBkYXRhc3RvcmUs\nIHN0b3JlIGlkIGluIGZpcnN0IGVsZW1lbnQKICAgICAgICBpbnQgb2Zmc2V0\nID0gKHNtLmdldE1ldGFEYXRhKCkuZ2V0SWRlbnRpdHlUeXBlKCkgPT0KICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpID8gMSA6IDA7\nCgogICAgICAgIC8vIG1ha2UgdmVyc2lvbiBzdGF0ZSBhcnJheSBvbmUgbGFy\nZ2VyIGZvciBuZXcgaW5zdGFuY2VzOyBtYXJrcyBuZXcKICAgICAgICAvLyBp\nbnN0YW5jZXMgd2l0aG91dCBhZmZlY3Rpbmcgc2VyaWFsaXphdGlvbiBzaXpl\nIG11Y2gKICAgICAgICBPYmplY3RbXSBzdGF0ZTsKICAgICAgICBpZiAoc20u\naXNOZXcoKSkKICAgICAgICAgICAgc3RhdGUgPSBuZXcgT2JqZWN0WzMgKyBv\nZmZzZXRdOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RhdGUgPSBuZXcg\nT2JqZWN0WzIgKyBvZmZzZXRdOwoKICAgICAgICBpZiAob2Zmc2V0ID4gMCkg\newogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGlmIChzbS5p\nc0VtYmVkZGVkKCkgfHwgc20uZ2V0T2JqZWN0SWQoKSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgaWQgPSBzbS5nZXRJZCgpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBpZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAg\nICAgICAgIHN0YXRlWzBdID0gaWQudG9TdHJpbmcoKTsKICAgICAgICB9CiAg\nICAgICAgc3RhdGVbb2Zmc2V0XSA9IHNtLmdldFZlcnNpb24oKTsKICAgICAg\nICBzdGF0ZVtvZmZzZXQgKyAxXSA9IGZpZWxkczsKICAgICAgICByZXR1cm4g\nc3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCBvciBpbnZva2Ug\ncHJlLXN0b3JlIGNhbGxiYWNrcyBvbiB0aGUgZ2l2ZW4gYnJva2VyIGlmCiAg\nICAgKiBuZWVkZWQuIFJldHVybiB0cnVlIGlmIGZsdXNoZWQvc3RvcmVkLCBm\nYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJv\nb2xlYW4gZmx1c2hEaXJ0eShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAg\nICAgaWYgKCFzbS5pc0RpcnR5KCkgfHwgIXNtLmdldEJyb2tlcigpLmlzQWN0\naXZlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8g\nb25seSBmbHVzaCBpZiB0aGVyZSBhcmUgYWN0dWFsbHkgYW55IGRpcnR5IG5v\nbi1mbHVzaGVkIGZpZWxkcwogICAgICAgIEJpdFNldCBkaXJ0eUZpZWxkcyA9\nIHNtLmdldERpcnR5KCk7CiAgICAgICAgQml0U2V0IGZsdXNoZWRGaWVsZHMg\nPSBzbS5nZXRGbHVzaGVkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBkaXJ0eUZpZWxkcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBpZiAo\nZGlydHlGaWVsZHMuZ2V0KGkpICYmICFmbHVzaGVkRmllbGRzLmdldChpKSkg\newogICAgICAgICAgICAgICAgaWYgKHNtLmdldEJyb2tlcigpLmdldFJvbGxi\nYWNrT25seSgpKQogICAgICAgICAgICAgICAgICAgIHNtLmdldEJyb2tlcigp\nLnByZUZsdXNoKCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgc20uZ2V0QnJva2VyKCkuZmx1c2goKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIGJpdCBzZXQgZm9yIHRoZSBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgZmV0\nY2ggZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNl\ndEZldGNoR3JvdXBGaWVsZHMoQnJva2VyIGJyb2tlciwKICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtLCBCaXRTZXQgaWR4cykgewogICAgICAgIEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdl\ndE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChm\nbWRzW2ldLmlzUHJpbWFyeUtleSgpIHx8IGZldGNoLnJlcXVpcmVzRmV0Y2go\nZm1kc1tpXSkKICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJhdGlv\nbi5GRVRDSF9OT05FKQogICAgICAgICAgICAgICAgaWR4cy5zZXQoaSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAg\nICAgKgogICAgICogQHBhcmFtIGJyb2tlciBvd25pbmcgYnJva2VyCiAgICAg\nKiBAcGFyYW0gZnVsbCB3aGV0aGVyIHRoZSBlbnRpcmUgYnJva2VyIGNhY2hl\nIGlzIGJlaW5nIGRldGFjaGVkOyBpZgogICAgICogdGhpcyBpcyB0aGUgY2Fz\nZSwgd2UgYXNzdW1lIHRoZSBicm9rZXIgaGFzIGFscmVhZHkKICAgICAqIGZs\ndXNoZWQgaWYgbmVlZGVkLCBhbmQgdGhhdCB3ZSdyZSBkZXRhY2hpbmcgaW4t\ncGxhY2UKICAgICAqLwogICAgcHVibGljIERldGFjaE1hbmFnZXIoQnJva2Vy\nSW1wbCBicm9rZXIsIGJvb2xlYW4gZnVsbCwgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAgICAgICAgX3Byb3h5ID0g\nYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRQcm94eU1hbmFnZXJJbnN0\nYW5jZSgpOwogICAgICAgIF9vcHRzID0gYnJva2VyLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCk7CiAgICAgICAgX2NvcHkg\nPSAhZnVsbDsKICAgICAgICBfZmx1c2hlZCA9IGZ1bGw7CiAgICAgICAgX2Nh\nbGwgPSBjYWxsOwogICAgICAgIF9mYWlsRmFzdCA9IChicm9rZXIuZ2V0Q29u\nZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCku\nCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRz\nKCkuZ2V0Q2FsbGJhY2tNb2RlKCkKICAgICAgICAgICAgJiBDYWxsYmFja01v\nZGVzLkNBTExCQUNLX0ZBSUxfRkFTVCkgIT0gMDsKCiAgICAgICAgLy8gd2Ug\nY2FuIG9ubHkgcmVseSBvbiBvdXIgImFsbCIgc2hvcnRjdXRzIGlmIHdlIGtu\nb3cgd2Ugd29uJ3QgYmUKICAgICAgICAvLyBsb2FkaW5nIGFueSBtb3JlIGRh\ndGEKICAgICAgICBfZnVsbCA9IGZ1bGwgJiYgYnJva2VyLmdldERldGFjaFN0\nYXRlKCkgPT0gRGV0YWNoU3RhdGUuREVUQUNIX0xPQURFRDsKICAgICAgICBp\nZiAoX2Z1bGwpIHsKICAgICAgICAgICAgX2RldGFjaGVkID0gbnVsbDsKICAg\nICAgICAgICAgX2Z1bGxGTSA9IG5ldyBEZXRhY2hGaWVsZE1hbmFnZXIoKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfZGV0YWNoZWQgPSBuZXcg\nSWRlbnRpdHlNYXAoKTsKICAgICAgICAgICAgX2Z1bGxGTSA9IG51bGw7CiAg\nICAgICAgfQogICAgICAgIENvbXBhdGliaWxpdHkgY29tcGF0aWJpbGl0eSA9\nIAogICAgICAgICAgICBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldENv\nbXBhdGliaWxpdHlJbnN0YW5jZSgpOwogICAgICAgIF9mbHVzaEJlZm9yZURl\ndGFjaCA9IGNvbXBhdGliaWxpdHkuZ2V0Rmx1c2hCZWZvcmVEZXRhY2goKTsK\nICAgICAgICBfcmVsb2FkT25EZXRhY2ggPSBjb21wYXRpYmlsaXR5LmdldFJl\nbG9hZE9uRGV0YWNoKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYSBkZXRhY2hlZCB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHVibGljIE9iamVjdCBkZXRhY2goT2JqZWN0IHRvRGV0YWNo\nKSB7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHJldHVybiBkZXRhY2hJbnRlcm5hbCh0b0RldGFjaCk7\nCiAgICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2UpIHsKICAg\nICAgICAgICAgZXhjZXBzID0gbmV3IEFycmF5TGlzdCgxKTsKICAgICAgICAg\nICAgZXhjZXBzLmFkZChjZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOyAv\nLyB3b24ndCBiZSByZWFjaGVkIGFzIGV4Y2VwdGlvbiB3aWxsIGJlIHJldGhy\nb3duCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGV4Y2Vw\ncyA9PSBudWxsIHx8ICFfZmFpbEZhc3QpCiAgICAgICAgICAgICAgICBleGNl\ncHMgPSBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9ucy5zaW5nbGV0b24o\ndG9EZXRhY2gpLAogICAgICAgICAgICAgICAgICAgIGV4Y2Vwcyk7CiAgICAg\nICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9kZXRhY2hlZC5jbGVhcigpOwogICAgICAgICAgICB0aHJvd0V4Y2VwdGlv\nbnMoZXhjZXBzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gZGV0YWNoZWQgdmVyc2lvbnMgb2YgYWxsIHRoZSBnaXZlbiBpbnN0\nYW5jZXMuIElmIG5vdCBjb3B5aW5nLAogICAgICogbnVsbCB3aWxsIGJlIHJl\ndHVybmVkLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0YWNoQWxs\nKENvbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgTGlzdCBleGNlcHMg\nPSBudWxsOwogICAgICAgIExpc3QgZGV0YWNoZWQgPSBudWxsOwogICAgICAg\nIGlmIChfY29weSkKICAgICAgICAgICAgZGV0YWNoZWQgPSBuZXcgQXJyYXlM\naXN0KGluc3RhbmNlcy5zaXplKCkpOwoKICAgICAgICBib29sZWFuIGZhaWxG\nYXN0ID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgT2JqZWN0\nIGRldGFjaDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBpbnN0\nYW5jZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIGRldGFjaCA9IGRldGFjaEludGVybmFsKGl0ci5uZXh0KCkpOwog\nICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAgICAg\nIGRldGFjaGVkLmFkZChkZXRhY2gpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIGlmIChyZSBpbnN0YW5jZW9mIENhbGxiYWNrRXhjZXB0aW9uICYm\nIF9mYWlsRmFzdCkKICAgICAgICAgICAgICAgIGZhaWxGYXN0ID0gdHJ1ZTsK\nICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICghZmFpbEZhc3QpCiAgICAg\nICAgICAgICAgICBleGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChpbnN0YW5j\nZXMsIGV4Y2Vwcyk7CiAgICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAgICAg\nIH0KICAgICAgICB0aHJvd0V4Y2VwdGlvbnMoZXhjZXBzKTsKCiAgICAgICAg\naWYgKF9jb3B5KQogICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQudG9BcnJh\neSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogSW52b2tlIHBvc3REZXRhY2goKSBvbiBhbnkgZGV0YWNoZWQgaW5zdGFu\nY2VzIHRoYXQgaW1wbGVtZW50CiAgICAgKiBQb3N0RGV0YWNoQ2FsbGJhY2su\nIFRoaXMgd2lsbCBiZSBkb25lIGFmdGVyIHRoZSBlbnRpcmUgZ3JhcGggaGFz\nCiAgICAgKiBiZWVuIGRldGFjaGVkLiBUaGlzIG1ldGhvZCBoYXMgdGhlIHNp\nZGUtZWZmZWN0IG9mIGFsc28gY2xlYXJpbmcKICAgICAqIG91dCB0aGUgbWFw\nIG9mIGFsbCBkZXRhY2hlZCBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgTGlzdCBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9uIG9ianMsIExp\nc3QgZXhjZXBzKSB7CiAgICAgICAgSXRlcmF0b3IgaXRyID0gKF9mdWxsKSA/\nIG9ianMuaXRlcmF0b3IoKQogICAgICAgICAgICA6IF9kZXRhY2hlZC5lbnRy\neVNldCgpLml0ZXJhdG9yKCk7CgogICAgICAgIE9iamVjdCBvcmlnLCBkZXRh\nY2hlZDsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgd2hpbGUg\nKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgaWYgKF9mdWxsKSB7CiAg\nICAgICAgICAgICAgICBvcmlnID0gaXRyLm5leHQoKTsKICAgICAgICAgICAg\nICAgIGRldGFjaGVkID0gb3JpZzsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgICAgIG9yaWcgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAg\nICAgICAgICAgIGRldGFjaGVkID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IF9i\ncm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbChvcmlnLCB0cnVlKTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50\nKGRldGFjaGVkLCBvcmlnLAogICAgICAgICAgICAgICAgICAgICAgICBzbS5n\nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9ERVRBQ0gpOwog\nICAgICAgICAgICB9IGNhdGNoIChDYWxsYmFja0V4Y2VwdGlvbiBjZSkgewog\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgY2UpOwogICAg\nICAgICAgICAgICAgaWYgKF9mYWlsRmFzdCkKICAgICAgICAgICAgICAgICAg\nICBicmVhazsgLy8gZG9uJ3QgY29udGludWUgcHJvY2Vzc2luZwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGNlcHM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXhjZXB0aW9uIHRvIHRoZSBsaXN0\nLgogICAgICovCiAgICBwcml2YXRlIExpc3QgYWRkKExpc3QgZXhjZXBzLCBS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9PSBu\ndWxsKQogICAgICAgICAgICBleGNlcHMgPSBuZXcgTGlua2VkTGlzdCgpOwog\nICAgICAgIGV4Y2Vwcy5hZGQocmUpOwogICAgICAgIHJldHVybiBleGNlcHM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBhbGwgZ2F0aGVyZWQgZXhj\nZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRocm93RXhjZXB0\naW9ucyhMaXN0IGV4Y2VwcykgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoZXhjZXBzLnNp\nemUoKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4Y2VwdGlv\nbikgZXhjZXBzLmdldCgwKTsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKS4KICAgICAgICAgICAg\nc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10pIGV4Y2Vwcy50b0Fy\ncmF5CiAgICAgICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMuc2l6\nZSgpXSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0YWNoLgogICAgICov\nCiAgICBwcml2YXRlIE9iamVjdCBkZXRhY2hJbnRlcm5hbChPYmplY3QgdG9E\nZXRhY2gpIHsKICAgICAgICBpZiAodG9EZXRhY2ggPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGFscmVhZHkgZGV0YWNo\nZWQ/CiAgICAgICAgaWYgKF9kZXRhY2hlZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIE9iamVjdCBkZXRhY2hlZCA9IF9kZXRhY2hlZC5nZXQodG9EZXRhY2gp\nOwogICAgICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBkZXRhY2hlZDsKICAgICAgICB9CgogICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc20gPSBfYnJva2VyLmdldFN0YXRlTWFuYWdlcklt\ncGwodG9EZXRhY2gsIHRydWUpOwogICAgICAgIGlmIChfY2FsbCAhPSBudWxs\nICYmIChfY2FsbC5wcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfREVU\nQUNILAogICAgICAgICAgICB0b0RldGFjaCwgc20pICYgT3BDYWxsYmFja3Mu\nQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRvRGV0YWNoOwog\nICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdG9E\nZXRhY2g7CgogICAgICAgIC8vIENhbGwgUHJlRGV0YWNoIGZpcnN0IGFzIHdl\nIGNhbid0IHRlbGwgaWYgdGhlIG5ldyBzeXN0ZW0KICAgICAgICAvLyBmaXJl\nZCBhbiBldmVudCBvciBqdXN0IGRpZCBub3QgZmFpbC4KICAgICAgICBfYnJv\na2VyLmZpcmVMaWZlY3ljbGVFdmVudCh0b0RldGFjaCwgbnVsbCwgc20uZ2V0\nTWV0YURhdGEoKSwKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnQuQkVGT1JF\nX0RFVEFDSCk7CgogICAgICAgIGlmKCEgX2ZsdXNoZWQpICB7CiAgICAgICAg\nICAgIGlmKF9mbHVzaEJlZm9yZURldGFjaCkgewogICAgICAgICAgICAgICAg\nLy8gYW55IGRpcnR5IGluc3RhbmNlcyBjYXVzZSBhIGZsdXNoIHRvIG9jY3Vy\nCiAgICAgICAgICAgICAgICBmbHVzaERpcnR5KHNtKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBfZmx1c2hlZCA9IHRydWU7CiAgICAgICAgfQogICAg\nICAgIAogICAgICAgIEJpdFNldCBmaWVsZHMgPSBuZXcgQml0U2V0KCk7CiAg\nICAgICAgcHJlRGV0YWNoKF9icm9rZXIsIHNtLCBmaWVsZHMsIF9mdWxsLCAK\nICAgICAgICAgICAgX3JlbG9hZE9uRGV0YWNoKTsKCiAgICAgICAgLy8gY3Jl\nYXRlIGFuZCBzdG9yZSBuZXcgb2JqZWN0IGJlZm9yZSBjb3B5IHRvIGF2b2lk\nIGVuZGxlc3MgcmVjdXJzaW9uCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIGRldGFjaGVkUEM7CiAgICAgICAgaWYgKF9jb3B5\nKQogICAgICAgICAgICBkZXRhY2hlZFBDID0gcGMucGNOZXdJbnN0YW5jZShu\ndWxsLCB0cnVlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRldGFjaGVk\nUEMgPSBwYzsKICAgICAgICBpZiAoX2RldGFjaGVkICE9IG51bGwpCiAgICAg\nICAgICAgIF9kZXRhY2hlZC5wdXQodG9EZXRhY2gsIGRldGFjaGVkUEMpOwoK\nICAgICAgICAvLyBkZXRhY2ggZmllbGRzIGFuZCBzZXQgZGV0YWNoZWQgdmFy\naWFibGVzCiAgICAgICAgRGV0YWNoZWRTdGF0ZU1hbmFnZXIgZGV0U00gPSBu\ndWxsOwogICAgICAgIGlmIChfb3B0cy5nZXREZXRhY2hlZFN0YXRlTWFuYWdl\ncigpCiAgICAgICAgICAgICYmIHVzZURldGFjaGVkU3RhdGVNYW5hZ2VyKHNt\nLCBfb3B0cykpCiAgICAgICAgICAgIGRldFNNID0gbmV3IERldGFjaGVkU3Rh\ndGVNYW5hZ2VyKGRldGFjaGVkUEMsIHNtLCBmaWVsZHMsCiAgICAgICAgICAg\nICAgICBfb3B0cy5nZXRBY2Nlc3NVbmxvYWRlZCgpLCBfYnJva2VyLmdldE11\nbHRpdGhyZWFkZWQoKSk7CiAgICAgICAgaWYgKF9mdWxsKSB7CiAgICAgICAg\nICAgIF9mdWxsRk0uc2V0U3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICAgICAg\naWYgKF9jb3B5IHx8IF9yZWxvYWRPbkRldGFjaCkgewogICAgICAgICAgICAg\nICAgX2Z1bGxGTS5kZXRhY2hWZXJzaW9uKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgX2Z1bGxGTS5yZXByb3h5KGRldFNNKTsKICAgICAgICAgICAg\nX2Z1bGxGTS5zZXRTdGF0ZU1hbmFnZXIobnVsbCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIgZm0g\nPSBuZXcgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIKICAgICAgICAgICAg\nICAgIChkZXRhY2hlZFBDLCBkZXRTTSk7CiAgICAgICAgICAgIGZtLnNldFN0\nYXRlTWFuYWdlcihzbSk7CiAgICAgICAgICAgIGZtLmRldGFjaEZpZWxkcyhm\naWVsZHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFCb29sZWFuLkZBTFNF\nLmVxdWFscyhzbS5nZXRNZXRhRGF0YSgpLnVzZXNEZXRhY2hlZFN0YXRlKCkp\nKQogICAgICAgICAgICBkZXRhY2hlZFBDLnBjU2V0RGV0YWNoZWRTdGF0ZShn\nZXREZXRhY2hlZFN0YXRlKHNtLCBmaWVsZHMpKTsKICAgICAgICBpZiAoIV9j\nb3B5KQogICAgICAgICAgICBzbS5yZWxlYXNlKGZhbHNlLCAhX2NvcHkpOwog\nICAgICAgIGlmIChkZXRTTSAhPSBudWxsKQogICAgICAgICAgICBkZXRhY2hl\nZFBDLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihkZXRTTSk7CiAgICAgICAgcmV0\ndXJuIGRldGFjaGVkUEM7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiB1c2VEZXRhY2hlZFN0YXRlTWFuYWdlcihTdGF0ZU1hbmFnZXJJbXBs\nIHNtLAogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cykgewogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAg\ncmV0dXJuICFCb29sZWFuLkZBTFNFLmVxdWFscyhtZXRhLnVzZXNEZXRhY2hl\nZFN0YXRlKCkpICYmCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEuU1lOVEhF\nVElDLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUoKSkgJiYKICAgICAg\nICAgICAgb3B0cy5nZXREZXRhY2hlZFN0YXRlTWFuYWdlcigpOwogICAgfQoK\nICAgIC8qKgogICAgICogQmFzZSBkZXRhY2ggZmllbGQgbWFuYWdlci4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRGV0YWNoRmllbGRNYW5h\nZ2VyCiAgICAgICAgZXh0ZW5kcyBUcmFuc2ZlckZpZWxkTWFuYWdlciB7Cgog\nICAgICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIHNtOwoKICAgICAg\nICAvKioKICAgICAgICAgKiBTZXQgdGhlIHNvdXJjZSBzdGF0ZSBtYW5hZ2Vy\nLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFN0YXRlTWFu\nYWdlcihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIHRoaXMu\nc20gPSBzbTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFRy\nYW5zZmVyIHRoZSBjdXJyZW50IHZlcnNpb24gb2JqZWN0IGZyb20gdGhlIHN0\nYXRlIG1hbmFnZXIgdG8gdGhlCiAgICAgICAgICogZGV0YWNoZWQgaW5zdGFu\nY2UuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZGV0YWNoVmVy\nc2lvbigpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbS5n\nZXRNZXRhRGF0YSgpLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgICAgICBp\nZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAg\nICAgICAgICBPYmplY3QgdmFsID0gSmF2YVR5cGVzLmNvbnZlcnQoc20uZ2V0\nVmVyc2lvbigpLAogICAgICAgICAgICAgICAgZm1kLmdldFR5cGVDb2RlKCkp\nOwogICAgICAgICAgICB2YWwgPSBmbWQuZ2V0RmllbGRWYWx1ZSh2YWwsIHNt\nLmdldEJyb2tlcigpKTsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBsb25ndmFsID0gKHZh\nbCA9PSBudWxsKSA/IDBMIDogKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9B\nVDoKICAgICAgICAgICAgICAgIGRibHZhbCA9ICh2YWwgPT0gbnVsbCkgPyAw\nRCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIG9ianZhbCA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBz\nbS5yZXBsYWNlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUo\nKSwgdGhpcywKICAgICAgICAgICAgICAgIGZtZC5nZXRJbmRleCgpKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFVucHJveGllcyBzZWNv\nbmQgY2xhc3Mgb2JqZWN0IGZpZWxkcy4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgdm9pZCByZXByb3h5KERldGFjaGVkU3RhdGVNYW5hZ2VyIGRzbSkg\newogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAg\nICAgICAvLyBscnMgcHJveGllcyBub3QgZGV0YWNoZWQKICAgICAgICAgICAg\nICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIG9ianZhbCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLnJlcGxhY2VGaWVsZChnZXREZXRhY2hlZFBlcnNpc3RlbmNlQ2Fw\nYWJsZSgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMsIGkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgICAgICBz\nbS5wcm92aWRlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUo\nKSwgdGhpcywgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9ianZhbCBp\nbnN0YW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBy\nb3h5IHByb3h5ID0gKFByb3h5KSBvYmp2YWw7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChwcm94eS5nZXRDaGFuZ2VUcmFja2VyKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5LmdldENoYW5nZVRy\nYWNrZXIoKS5zdG9wVHJhY2tpbmcoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgcHJveHkuc2V0T3duZXIoZHNtLCAoZHNtID09IG51bGwpID8gLTEgOiBp\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYXIoKTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5zdGFuY2UgYmVp\nbmcgZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVkIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBnZXREZXRhY2hlZFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHNtLmdldFBlcnNpc3RlbmNlQ2Fw\nYWJsZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZpZWxk\nTWFuYWdlciB0aGF0IGNhbiBjb3B5IGFsbCB0aGUgZmllbGRzIGZyb20gb25l\nCiAgICAgKiBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFuY2UgdG8gYW5vdGhl\nci4gT25lIG9mIHRoZQogICAgICogaW5zdGFuY2VzIG11c3QgYmUgbWFuYWdl\nZCBieSBhIFN0YXRlTWFuYWdlciwgYW5kIHRoZQogICAgICogb3RoZXIgbXVz\ndCBiZSB1bm1hbmFnZWQuCiAgICAgKgogICAgICogQGF1dGhvciBNYXJjIFBy\ndWQnaG9tbWVhdXgKICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBJbnN0YW5j\nZURldGFjaEZpZWxkTWFuYWdlcgogICAgICAgIGV4dGVuZHMgRGV0YWNoRmll\nbGRNYW5hZ2VyIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBQZXJzaXN0ZW5j\nZUNhcGFibGUgX3RvOwogICAgICAgIHByaXZhdGUgZmluYWwgRGV0YWNoZWRT\ndGF0ZU1hbmFnZXIgX2RldFNNOwoKICAgICAgICAvKioKICAgICAgICAgKiBD\nb25zdHJ1Y3Rvci4gU3VwcGx5IGluc3RhbmNlIHRvIHRvIGNvcHkgdG8uCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIEluc3RhbmNlRGV0YWNoRmllbGRN\nYW5hZ2VyKFBlcnNpc3RlbmNlQ2FwYWJsZSB0bywKICAgICAgICAgICAgRGV0\nYWNoZWRTdGF0ZU1hbmFnZXIgZGV0U00pIHsKICAgICAgICAgICAgX3RvID0g\ndG87CiAgICAgICAgICAgIF9kZXRTTSA9IGRldFNNOwogICAgICAgIH0KCiAg\nICAgICAgcHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXREZXRhY2hl\nZFBlcnNpc3RlbmNlQ2FwYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF90\nbzsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIERldGFjaCB0\naGUgZmllbGRzIG9mIHRoZSBzdGF0ZSBtYW5hZ2VyIGdpdmVuIG9uIGNvbnN0\ncnVjdGlvbiB0bwogICAgICAgICAqIHRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxl\nIGdpdmVuIG9uIGNvbnN0cnVjdGlvbi4KICAgICAgICAgKiBPbmx5IHRoZSBm\naWVsZHMgaW4gdGhlIGdpdmVuIGJpdCBzZXQgd2lsbCBiZSBjb3BpZWQuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZGV0YWNoRmllbGRzKEJp\ndFNldCBmZ2ZpZWxkcykgewogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFi\nbGUgZnJvbSA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gc20uZ2V0TWV0YURhdGEoKS5n\nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKCiAg\nICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgIF90by5wY1Jl\ncGxhY2VTdGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgLy8gd2Ugc3RhcnQgd2l0aCBwayBmaWVsZHM6IG9iamVj\ndHMgbWlnaHQgcmVseSBvbiBwayBmaWVsZHMgZm9yCiAgICAgICAgICAgICAg\nICAvLyBlcXVhbHMgYW5kIGhhc2hDb2RlIG1ldGhvZHMsIGFuZCB0aGlzIGVu\nc3VyZXMgdGhhdCBwayBmaWVsZHMKICAgICAgICAgICAgICAgIC8vIGFyZSBz\nZXQgcHJvcGVybHkgaWYgd2UgcmV0dXJuIGFueSBwYXJ0aWFsbHktZGV0YWNo\nZWQgb2JqZWN0cwogICAgICAgICAgICAgICAgLy8gZHVlIHRvIHJlZW50cmFu\ndCBjYWxscyB3aGVuIHRyYXZlcnNpbmcgcmVsYXRpb25zCiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgICAgICBkZXRhY2hGaWVsZChmcm9tLCBwa3NbaV0uZ2V0\nSW5kZXgoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBkZXRhY2hWZXJzaW9u\nKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbWRzW2ld\nLmlzUHJpbWFyeUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lvbigpKSAKICAg\nICAgICAgICAgICAgICAgICAgICAgZGV0YWNoRmllbGQoZnJvbSwgaSwgZmdm\naWVsZHMuZ2V0KGkpKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIC8vIGNsZWFyIHRoZSBTdGF0ZU1hbmFnZXIgZnJvbSB0aGUg\ndGFyZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAg\nICAgICAgICAgICAgICAgIF90by5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIobnVs\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIERldGFjaCAob3IgY2xlYXIpIHRoZSBnaXZlbiBmaWVsZCBpbmRl\neC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgZGV0YWNoRmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIGZyb20sIGludCBpLCBib29sZWFuIGZn\nKSB7CiAgICAgICAgICAgIC8vIHRlbGwgdGhlIHN0YXRlIG1hbmFnZXIgdG8g\ncHJvdmlkZSB0aGUgZmllbGRzIGZyb20gdGhlIHNvdXJjZSB0bwogICAgICAg\nICAgICAvLyB0aGlzIGZpZWxkIG1hbmFnZXIsIHdoaWNoIHdpbGwgdGhlbiBy\nZXBsYWNlIHRoZSBmaWVsZCB3aXRoIGEKICAgICAgICAgICAgLy8gZGV0YWNo\nZWQgdmVyc2lvbgogICAgICAgICAgICBpZiAoZmcpCiAgICAgICAgICAgICAg\nICBzbS5wcm92aWRlRmllbGQoZnJvbSwgdGhpcywgaSk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKCFfY29weSkgewogICAgICAgICAgICAgICAgLy8gaWYgbm90\nIGNvcHlpbmcgYW5kIGZpZWxkIHNob3VsZCBub3QgYmUgZGV0YWNoZWQsIGNs\nZWFyIGl0CiAgICAgICAgICAgICAgICBjbGVhcigpOwogICAgICAgICAgICAg\nICAgc20ucmVwbGFjZUZpZWxkKF90bywgdGhpcywgaSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQm9vbGVh\nbkZpZWxkKGludCBmaWVsZCwgYm9vbGVhbiBjdXJWYWwpIHsKICAgICAgICAg\nICAgc3VwZXIuc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQnl0ZUZpZWxk\nKGludCBmaWVsZCwgYnl0ZSBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIu\nc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNt\nLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxkKGludCBmaWVsZCwg\nY2hhciBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVDaGFyRmll\nbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVs\nZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlRG91YmxlRmllbGQoaW50IGZpZWxkLCBkb3VibGUgY3Vy\nVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlRG91YmxlRmllbGQoZmll\nbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8s\nIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0IGN1clZhbCkgewog\nICAgICAgICAgICBzdXBlci5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGN1clZh\nbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZp\nZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50\nRmllbGQoaW50IGZpZWxkLCBpbnQgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1\ncGVyLnN0b3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAg\nIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlTG9uZ0ZpZWxkKGludCBmaWVs\nZCwgbG9uZyBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVMb25n\nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VG\naWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNob3J0IGN1\nclZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZVNob3J0RmllbGQoZmll\nbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8s\nIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHN0b3JlU3RyaW5nRmllbGQoaW50IGZpZWxkLCBTdHJpbmcgY3VyVmFsKSB7\nCiAgICAgICAgICAgIHN1cGVyLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIGN1\nclZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMs\nIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3Jl\nT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgY3VyVmFsKSB7CiAgICAg\nICAgICAgIHN1cGVyLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIGRldGFjaEZp\nZWxkKGN1clZhbCwgZmllbGQpKTsKICAgICAgICAgICAgc20ucmVwbGFjZUZp\nZWxkKF90bywgdGhpcywgZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogU2V0IHRoZSBvd25lciBvZiB0aGUgZmllbGQncyBwcm94\neSB0byB0aGUgZGV0YWNoZWQgc3RhdGUgbWFuYWdlci4KICAgICAgICAgKi8K\nICAgICAgICBwcml2YXRlIE9iamVjdCByZXByb3h5KE9iamVjdCBvYmosIGlu\ndCBmaWVsZCkgewogICAgICAgICAgICBpZiAob2JqICE9IG51bGwgJiYgX2Rl\ndFNNICE9IG51bGwgJiYgb2JqIGluc3RhbmNlb2YgUHJveHkpCiAgICAgICAg\nICAgICAgICAoKFByb3h5KSBvYmopLnNldE93bmVyKF9kZXRTTSwgZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogRGV0YWNoIHRoZSBnaXZlbiB2YWx1ZSBpZiBuZWVk\nZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgZGV0YWNo\nRmllbGQoT2JqZWN0IGN1clZhbCwgaW50IGZpZWxkKSB7CiAgICAgICAgICAg\nIGlmIChjdXJWYWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbS5nZXRN\nZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgT2JqZWN0\nIG5ld1ZhbCA9IG51bGw7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5BUlJBWToKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAg\nICAgICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUFycmF5KGN1clZhbCk7\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbmV3\nVmFsID0gY3VyVmFsOwogICAgICAgICAgICAgICAgZGV0YWNoQXJyYXkobmV3\nVmFsLCBmbWQpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbDsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIGlmIChfY29weSkgewogICAgICAgICAgICAgICAgICAgIGlmIChf\nZGV0U00gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdW\nYWwgPSBfcHJveHkubmV3Q29sbGVjdGlvblByb3h5KGZtZC5nZXRQcm94eVR5\ncGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVt\nZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0YW5jZW9mIENvbXBh\ncmF0b3IgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKENvbXBhcmF0\nb3IpIGZtZC5nZXRJbml0aWFsaXplcigpIDogbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICgoQ29sbGVjdGlvbikgbmV3VmFsKS5hZGRBbGwoKENv\nbGxlY3Rpb24pIGN1clZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IF9wcm94eS5jb3B5\nQ29sbGVjdGlvbigoQ29sbGVjdGlvbikgY3VyVmFsKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IGN1clZh\nbDsKICAgICAgICAgICAgICAgIGRldGFjaENvbGxlY3Rpb24oKENvbGxlY3Rp\nb24pIG5ld1ZhbCwgKENvbGxlY3Rpb24pIGN1clZhbCwgZm1kKTsKICAgICAg\nICAgICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBp\nZiAoX2NvcHkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2RldFNNICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3By\nb3h5Lm5ld01hcFByb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5\ncGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVt\nZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0YW5jZW9mIENvbXBh\ncmF0b3IgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChDb21w\nYXJhdG9yKSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSA6IG51bGwpOwogICAgICAg\nICAgICAgICAgICAgICAgICAoKE1hcCkgbmV3VmFsKS5wdXRBbGwoKE1hcCkg\nY3VyVmFsKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5LmNvcHlNYXAoKE1hcCkg\nY3VyVmFsKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAg\nICAgICAgIG5ld1ZhbCA9IGN1clZhbDsKICAgICAgICAgICAgICAgIGRldGFj\naE1hcCgoTWFwKSBuZXdWYWwsIChNYXApIGN1clZhbCwgZm1kKTsKICAgICAg\nICAgICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAg\nICAgIG5ld1ZhbCA9IChfY29weSkgPyBfcHJveHkuY29weUNhbGVuZGFyKChD\nYWxlbmRhcikgY3VyVmFsKSA6CiAgICAgICAgICAgICAgICAgICAgY3VyVmFs\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHkobmV3VmFsLCBmaWVs\nZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAg\nICAgICAgICBuZXdWYWwgPSAoX2NvcHkpID8gX3Byb3h5LmNvcHlEYXRlKChE\nYXRlKSBjdXJWYWwpIDogY3VyVmFsOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHJlcHJveHkobmV3VmFsLCBmaWVsZCk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAg\nICAgICAgICAgICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUN1c3RvbShj\ndXJWYWwpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHkoKG5ld1Zh\nbCA9PSBudWxsKSA/IGN1clZhbCA6IG5ld1ZhbCwgZmllbGQpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIHJldHVybiBkZXRh\nY2hJbnRlcm5hbChjdXJWYWwpOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuIGN1clZhbDsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTWFrZSBzdXJlIGFsbCB0\naGUgdmFsdWVzIGluIHRoZSBnaXZlbiBhcnJheSBhcmUgZGV0YWNoZWQuCiAg\nICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFycmF5KE9i\namVjdCBhcnJheSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAgICAg\naWYgKCFmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAg\nICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGludCBsZW4gPSBB\ncnJheS5nZXRMZW5ndGgoYXJyYXkpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICAgICAgQXJyYXkuc2V0\nKGFycmF5LCBpLCBkZXRhY2hJbnRlcm5hbChBcnJheS5nZXQoYXJyYXksIGkp\nKSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBNYWtlIHN1\ncmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIGNvbGxlY3Rpb24gYXJl\nIGRldGFjaGVkLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBk\nZXRhY2hDb2xsZWN0aW9uKENvbGxlY3Rpb24gY29sbCwgQ29sbGVjdGlvbiBv\ncmlnLAogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAg\nICAgICAvLyBjb2xsIGNhbiBiZSBudWxsIGlmIG5vdCBjb3B5YWJsZQogICAg\nICAgICAgICBpZiAoX2NvcHkgJiYgY29sbCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1j\nb3B5YWJsZSIsIGZtZCkpOwogICAgICAgICAgICBpZiAoIWZtZC5nZXRFbGVt\nZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAgICAgLy8gdW5mb3J0dW5hdGVseSB3ZSBoYXZlIHRv\nIGNsZWFyIHRoZSBvcmlnaW5hbCBhbmQgcmUtYWRkIHRvIGNvcHkKICAgICAg\nICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAgY29sbC5jbGVhcigp\nOwogICAgICAgICAgICBPYmplY3QgZGV0YWNoZWQ7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gb3JpZy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgZGV0YWNoZWQgPSBkZXRhY2hJbnRl\ncm5hbChpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgIGlmIChfY29weSkK\nICAgICAgICAgICAgICAgICAgICBjb2xsLmFkZChkZXRhY2hlZCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIE1h\na2Ugc3VyZSBhbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gbWFwIGFyZSBk\nZXRhY2hlZC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgZGV0\nYWNoTWFwKE1hcCBtYXAsIE1hcCBvcmlnLCBGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgICAgICAvLyBtYXAgY2FuIGJlIG51bGwgaWYgbm90IGNvcHlh\nYmxlCiAgICAgICAgICAgIGlmIChfY29weSAmJiBtYXAgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICAgICAgYm9vbGVhbiBr\nZXlQQyA9IGZtZC5nZXRLZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAg\nICAgICAgIGJvb2xlYW4gdmFsUEMgPSBmbWQuZ2V0RWxlbWVudCgpLmlzRGVj\nbGFyZWRUeXBlUEMoKTsKICAgICAgICAgICAgaWYgKCFrZXlQQyAmJiAhdmFs\nUEMpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAvLyBp\nZiB3ZSBoYXZlIHRvIGNvcHkga2V5cywganVzdCBjbGVhciBhbmQgcmUtYWRk\nOyBvdGhlcndpc2UKICAgICAgICAgICAgLy8gd2UgY2FuIHVzZSB0aGUgZW50\ncnkgc2V0IHRvIHJlc2V0IHRoZSB2YWx1ZXMgb25seQogICAgICAgICAgICBN\nYXAuRW50cnkgZW50cnk7CiAgICAgICAgICAgIGlmICghX2NvcHkgfHwga2V5\nUEMpIHsKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAg\nICAgICAgICBtYXAuY2xlYXIoKTsKICAgICAgICAgICAgICAgIE9iamVjdCBr\nZXksIHZhbDsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nb3JpZy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KXsK\nICAgICAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICAgICAga2V5ID0gZW50cnkuZ2V0S2V5\nKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleVBDKQogICAgICAgICAg\nICAgICAgICAgICAgICBrZXkgPSBkZXRhY2hJbnRlcm5hbChrZXkpOwogICAg\nICAgICAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHZhbFBDKQogICAgICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBkZXRhY2hJbnRlcm5hbCh2YWwpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICAgICAgbWFw\nLnB1dChrZXksIHZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIu\nbmV4dCAoKTsKCQkJCQllbnRyeS5zZXRWYWx1ZSAoZGV0YWNoSW50ZXJuYWwg\nKGVudHJ5LmdldFZhbHVlICgpKSk7CgkJCQl9CgkJCX0KCQl9Cgl9Cn0K\n","encoding":"base64"}

