{"sha":"a6527f7c91c76763b1754e69e965e0a9fbd73503","node_id":"MDQ6QmxvYjIwNjM2NDphNjUyN2Y3YzkxYzc2NzYzYjE3NTRlNjllOTY1ZTBhOWZiZDczNTAz","size":10863,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a6527f7c91c76763b1754e69e965e0a9fbd73503","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5p\nby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Owpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0\nIGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJl\nbmNlSGFzaFNldDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4\nY2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRl\ncm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVzZXJFeGNlcHRpb247CgovKioKICogQ2FjaGUgb2YgbWFuYWdlZCBvYmpl\nY3RzLiBNdXN0IGJlIHN0YXRpYyBmb3Igc2VyaWFsaXphdGlvbiByZWFzb25z\nLgogKi8KY2xhc3MgTWFuYWdlZENhY2hlIGltcGxlbWVudHMgU2VyaWFsaXph\nYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9CiAgICAgICAgTG9jYWxpemVyLmZvclBhY2thZ2UoTWFuYWdlZENhY2hl\nLmNsYXNzKTsKCiAgICBwcml2YXRlIE1hcCBfbWFpbjsgLy8gb2lkIC0+IHNt\nCiAgICBwcml2YXRlIE1hcCBfY29uZmxpY3RzID0gbnVsbDsgLy8gY29uZmxp\nY3Qgb2lkIC0+IG5ldyBzbQogICAgcHJpdmF0ZSBNYXAgX25ld3MgPSBudWxs\nOyAvLyB0bXAgaWQgLT4gbmV3IHNtCiAgICBwcml2YXRlIENvbGxlY3Rpb24g\nX2VtYmVkcyA9IG51bGw7IC8vIGVtYmVkZGVkL25vbi1wZXJzaXN0ZW50IHNt\ncwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIF91bnRyYWNrZWQgPSBudWxsOyAv\nLyBoYXJkIHJlZnMgdG8gdW50cmFja2VkIHNtcwogICAgcHJpdmF0ZSBCcm9r\nZXJJbXBsIGJyb2tlcjsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBz\ndXBwbHkgcHJpbWFyeSBjYWNoZSBtYXAuCiAgICAgKi8KICAgIE1hbmFnZWRD\nYWNoZShCcm9rZXJJbXBsIGJyb2tlcikgewogICAgICAgIHRoaXMuYnJva2Vy\nID0gYnJva2VyOwogICAgICAgIF9tYWluID0gYnJva2VyLm5ld01hbmFnZWRP\nYmplY3RDYWNoZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIG9pZCwgb3B0aW9uYWxseSBhbGxv\nd2luZwogICAgICogbmV3IGluc3RhbmNlcy4KICAgICAqLwogICAgcHVibGlj\nIFN0YXRlTWFuYWdlckltcGwgZ2V0QnlJZChPYmplY3Qgb2lkLCBib29sZWFu\nIGFsbG93TmV3KSB7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgbWFpbiBjYWNo\nZSBmb3Igb2lkCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IChTdGF0\nZU1hbmFnZXJJbXBsKSBfbWFpbi5nZXQob2lkKTsKICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtMjsKICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBpZiBpdCdzIGEgbmV3IGluc3RhbmNlLCB3ZSBrbm93IGl0\nJ3MgdGhlIG9ubHkgbWF0Y2gsIGJlY2F1c2UKICAgICAgICAgICAgLy8gb3Ro\nZXIgcGVycyBpbnN0YW5jZXMgb3ZlcnJpZGUgbmV3IGluc3RhbmNlcyBpbiBf\nY2FjaGUKICAgICAgICAgICAgaWYgKHNtLmlzTmV3KCkgJiYgIXNtLmlzRGVs\nZXRlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIChhbGxvd05ldykgPyBz\nbSA6IG51bGw7CiAgICAgICAgICAgIGlmICghYWxsb3dOZXcgfHwgIXNtLmlz\nRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIHNtOwoKICAgICAg\nICAgICAgLy8gc20gaXMgZGVsZXRlZDsgY2hlY2sgY29uZmxpY3QgY2FjaGUK\nICAgICAgICAgICAgaWYgKF9jb25mbGljdHMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgc20yID0gKFN0YXRlTWFuYWdlckltcGwpIF9jb25mbGljdHMu\nZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBpZiAoc20yICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHNtMjsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gYXQgdGhpcyBwb2ludCBzbSBpcyBudWxs\nIG9yIGRlbGV0ZWQ7IGNoZWNrIHRoZSBuZXcgY2FjaGUgZm9yCiAgICAgICAg\nLy8gYW55IG1hdGNoZXMuIHRoaXMgYWxsb3dzIHVzIHRvIG1hdGNoIGFwcCBp\nZCBvYmplY3RzIHRvIG5ldwogICAgICAgIC8vIGluc3RhbmNlcyB3aXRob3V0\nIHBlcm1hbmFudCBvaWRzCiAgICAgICAgaWYgKGFsbG93TmV3ICYmIF9uZXdz\nICE9IG51bGwgJiYgIV9uZXdzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBz\nbTIgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX25ld3MuZ2V0KG9pZCk7CiAgICAg\nICAgICAgIGlmIChzbTIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBzbTI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzbTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENhbGwgdGhpcyBtZXRob2Qgd2hlbiBhIG5ldyBzdGF0\nZSBtYW5hZ2VyIGluaXRpYWxpemVzIGl0c2VsZi4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgYWRkKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBp\nZiAoIXNtLmlzSW50ZXJjZXB0aW5nKCkpIHsKICAgICAgICAgICAgaWYgKF91\nbnRyYWNrZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91bnRyYWNrZWQg\nPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfdW50cmFja2VkLmFkZChz\nbSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNtLmlzUGVyc2lzdGVudCgp\nIHx8IHNtLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICBpZiAoX2VtYmVk\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2VtYmVkcyA9IG5ldyBSZWZl\ncmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7CiAgICAgICAg\nICAgIF9lbWJlZHMuYWRkKHNtKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgLy8gaW5pdGlhbGl6aW5nIG5ldyBpbnN0YW5jZTsg\ncHV0IGluIG5ldyBjYWNoZSBiZWNhdXNlIHdvbid0IGhhdmUKICAgICAgICAv\nLyBwZXJtYW5lbnQgb2lkIHlldAogICAgICAgIGlmIChzbS5pc05ldygpKSB7\nCiAgICAgICAgICAgIGlmIChfbmV3cyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgX25ld3MgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICBfbmV3cy5w\ndXQoc20uZ2V0SWQoKSwgc20pOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICAvLyBpbml0aWFsaXppbmcgcGVyc2lzdGVudCBpbnN0\nYW5jZTsgcHV0IGluIG1haW4gY2FjaGUKICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX21haW4ucHV0CiAgICAg\nICAgICAgIChzbS5nZXRPYmplY3RJZCgpLCBzbSk7CiAgICAgICAgaWYgKG9y\naWcgIT0gbnVsbCkgewogICAgICAgICAgICBfbWFpbi5wdXQoc20uZ2V0T2Jq\nZWN0SWQoKSwgb3JpZyk7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJkdXAtbG9hZCIsIHNtLmdldE9iamVjdElkKCks\nCiAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9yaWcuZ2V0\nTWFuYWdlZEluc3RhbmNlKCkpKSkKICAgICAgICAgICAgICAgIC5zZXRGYWls\nZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gc3RhdGUg\nbWFuYWdlciBmcm9tIHRoZSBjYWNoZSB3aGVuIGl0IHRyYW5zaXRpb25zCiAg\nICAgKiB0byB0cmFuc2llbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJl\nbW92ZShPYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICAvLyBpZiBpdCBoYXMgYSBwZXJtYW5lbnQgb2lkLCByZW1vdmUgZnJvbSBt\nYWluIC8gY29uZmxpY3QgY2FjaGUsCiAgICAgICAgLy8gZWxzZSByZW1vdmUg\nZnJvbSBlbWJlZGRlZC9ub250cmFucyBjYWNoZSwgYW5kIGlmIG5vdCB0aGVy\nZQogICAgICAgIC8vIHJlbW92ZSBmcm9tIG5ldyBjYWNoZQogICAgICAgIE9i\namVjdCBvcmlnOwogICAgICAgIGlmIChzbS5nZXRPYmplY3RJZCgpICE9IG51\nbGwpIHsKICAgICAgICAgICAgb3JpZyA9IF9tYWluLnJlbW92ZShpZCk7CiAg\nICAgICAgICAgIGlmIChvcmlnICE9IHNtKSB7CiAgICAgICAgICAgICAgICBp\nZiAob3JpZyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9tYWluLnB1\ndChpZCwgb3JpZyk7IC8vIHB1dCBiYWNrCiAgICAgICAgICAgICAgICBpZiAo\nX2NvbmZsaWN0cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgb3Jp\nZyA9IF9jb25mbGljdHMucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAob3JpZyAhPSBudWxsICYmIG9yaWcgIT0gc20pCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9jb25mbGljdHMucHV0KGlkLCBvcmlnKTsgLy8gcHV0\nIGJhY2sKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSBpZiAoKF9lbWJlZHMgPT0gbnVsbCB8fCAhX2VtYmVkcy5yZW1v\ndmUoc20pKQogICAgICAgICAgICAmJiBfbmV3cyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIG9yaWcgPSBfbmV3cy5yZW1vdmUoaWQpOwogICAgICAgICAgICBp\nZiAob3JpZyAhPSBudWxsICYmIG9yaWcgIT0gc20pCiAgICAgICAgICAgICAg\nICBfbmV3cy5wdXQoaWQsIG9yaWcpOyAvLyBwdXQgYmFjawogICAgICAgIH0K\nCiAgICAgICAgaWYgKF91bnRyYWNrZWQgIT0gbnVsbCkKICAgICAgICAgICAg\nX3VudHJhY2tlZC5yZW1vdmUoc20pOwogICAgfQoKICAgIC8qKgogICAgICog\nQW4gZW1iZWRkZWQgb3Igbm9ucGVyc2lzdGVudCBtYW5hZ2VkIGluc3RhbmNl\nIGhhcyBiZWVuIHBlcnNpc3RlZC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\ncGVyc2lzdChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaWYgKF9l\nbWJlZHMgIT0gbnVsbCkKICAgICAgICAgICAgX2VtYmVkcy5yZW1vdmUoc20p\nOwogICAgfQoKICAgIC8qKgogICAgICogQSBuZXcgaW5zdGFuY2UgaGFzIGp1\nc3QgYmVlbiBhc3NpZ25lZCBhIHBlcm1hbmVudCBvaWQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFzc2lnbk9iamVjdElkKE9iamVjdCBpZCwgU3RhdGVN\nYW5hZ2VySW1wbCBzbSkgewogICAgICAgIC8vIGlmIGFzc2lnbmluZyBvaWQs\nIHJlbW92ZSBmcm9tIG5ldyBjYWNoZSBhbmQgcHV0IGluIHByaW1hcnk7IG1h\neQogICAgICAgIC8vIG5vdCBiZSBpbiBuZXcgY2FjaGUgaWYgYW5vdGhlciBu\nZXcgaW5zdGFuY2UgaGFkIHNhbWUgaWQKICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIG9yaWcgPSBudWxsOwogICAgICAgIGlmIChfbmV3cyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX25ld3Mu\ncmVtb3ZlKGlkKTsKICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCAmJiBv\ncmlnICE9IHNtKQogICAgICAgICAgICAgICAgX25ld3MucHV0KGlkLCBvcmln\nKTsgLy8gcHV0IGJhY2sKICAgICAgICB9CgogICAgICAgIC8vIHB1dCBpbiBt\nYWluIGNhY2hlLCBidXQgbWFrZSBzdXJlIHdlIGRvbid0IHJlcGxhY2UgYW5v\ndGhlcgogICAgICAgIC8vIGluc3RhbmNlIHdpdGggdGhlIHNhbWUgb2lkCiAg\nICAgICAgb3JpZyA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbWFpbi5wdXQoc20u\nZ2V0T2JqZWN0SWQoKSwgc20pOwogICAgICAgIGlmIChvcmlnICE9IG51bGwp\nIHsKICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIG9y\naWcpOwogICAgICAgICAgICBpZiAoIW9yaWcuaXNEZWxldGVkKCkpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nZHVwLW9pZC1hc3NpZ24iLAogICAgICAgICAgICAgICAgICAgIHNtLmdldE9i\namVjdElkKCksCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0\ncmluZyhzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKQogICAgICAgICAgICAg\nICAgICAgIC5zZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCkpOwoKICAgICAgICAgICAgLy8gc2FtZSBvaWQgYXMgZGVsZXRlZCBpbnN0\nYW5jZTsgcHV0IGluIGNvbmZsaWN0IGNhY2hlCiAgICAgICAgICAgIGlmIChf\nY29uZmxpY3RzID09IG51bGwpCiAgICAgICAgICAgICAgICBfY29uZmxpY3Rz\nID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgX2NvbmZsaWN0cy5wdXQo\nc20uZ2V0T2JqZWN0SWQoKSwgc20pOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEEgbmV3IGluc3RhbmNlIGhhcyBjb21taXR0ZWQ7IHJlY2Fj\naGUgdW5kZXIgcGVybWFuZW50IG9pZC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgY29tbWl0TmV3KE9iamVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgIC8vIGlmIHRoZSBpZCBkaWRuJ3QgY2hhbmdlLCB0aGUgaW5z\ndGFuY2Ugd2FzIGFscmVhZHkgYXNzaWduZWQgYW4KICAgICAgICAvLyBpZCwg\nYnV0IGl0IGNvdWxkIGhhdmUgYmVlbiBpbiBjb25mbGljdCBjYWNoZQogICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgb3JpZzsKICAgICAgICBpZiAoc20uZ2V0\nT2JqZWN0SWQoKSA9PSBpZCkgewogICAgICAgICAgICBvcmlnID0gKF9jb25m\nbGljdHMgPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAgICAgICA6IChTdGF0\nZU1hbmFnZXJJbXBsKSBfY29uZmxpY3RzLnJlbW92ZShpZCk7CiAgICAgICAg\nICAgIGlmIChvcmlnID09IHNtKSB7CiAgICAgICAgICAgICAgICBvcmlnID0g\nKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLnB1dChpZCwgc20pOwogICAgICAg\nICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCAmJiAhb3JpZy5pc0RlbGV0ZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgIF9tYWluLnB1dChzbS5nZXRPYmpl\nY3RJZCgpLCBvcmlnKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZHVwLW9pZC1hc3NpZ24iLAogICAg\nICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBFeGNlcHRp\nb25zLnRvU3RyaW5nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgLnNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgLnNldEZhdGFsKHRydWUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIC8vIG9pZCBjaGFuZ2VkLCBzbyBpdCBt\ndXN0IHByZXZpb3VzbHkgaGF2ZSBiZWVuIGEgbmV3IGluc3RhbmNlCiAgICAg\nICAgLy8gd2l0aG91dCBhbiBhc3NpZ25lZCBvaWQuICByZW1vdmUgaXQgZnJv\nbSB0aGUgbmV3IGNhY2hlOyBvayBpZgogICAgICAgIC8vIHdlIGVuZCB1cCBy\nZW1vdmluZyBhbm90aGVyIGluc3RhbmNlIHdpdGggc2FtZSBpZAogICAgICAg\nIGlmIChfbmV3cyAhPSBudWxsKQogICAgICAgICAgICBfbmV3cy5yZW1vdmUo\naWQpOwoKICAgICAgICAvLyBhbmQgcHV0IGludG8gbWFpbiBjYWNoZSBub3cg\ndGhhdCBpZCBpcyBhc3NzaWduZWQKICAgICAgICBvcmlnID0gKFN0YXRlTWFu\nYWdlckltcGwpIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgpLCBzbSk7CiAg\nICAgICAgaWYgKG9yaWcgIT0gbnVsbCAmJiBvcmlnICE9IHNtICYmICFvcmln\nLmlzRGVsZXRlZCgpKSB7CiAgICAgICAgICAgIC8vIHB1dCBiYWNrIG9yaWcg\nYW5kIHRocm93IGVycm9yCiAgICAgICAgICAgIF9tYWluLnB1dChzbS5nZXRP\nYmplY3RJZCgpLCBvcmlnKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoImR1cC1vaWQtYXNzaWduIiwKICAgICAgICAg\nICAgICAgIHNtLmdldE9iamVjdElkKCksIEV4Y2VwdGlvbnMudG9TdHJpbmco\nc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkKICAgICAgICAgICAgICAgICAg\nICAuc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKS5z\nZXRGYXRhbCh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBjYWNoZWQgcGVyc2lzdGVudCBvYmpl\nY3RzLgogICAgICovCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBjb3B5KCkgewog\nICAgICAgIC8vIHByb3hpZXMgbm90IGluY2x1ZGVkIGhlcmUgYmVjYXVzZSB0\naGUgc3RhdGUgbWFuYWdlciBpcyBhbHdheXMKICAgICAgICAvLyBwcmVzZW50\nIGluIG90aGVyIGNhY2hlcyB0b28KCiAgICAgICAgaW50IHNpemUgPSBfbWFp\nbi5zaXplKCk7CiAgICAgICAgaWYgKF9jb25mbGljdHMgIT0gbnVsbCkKICAg\nICAgICAgICAgc2l6ZSArPSBfY29uZmxpY3RzLnNpemUoKTsKICAgICAgICBp\nZiAoX25ld3MgIT0gbnVsbCkKICAgICAgICAgICAgc2l6ZSArPSBfbmV3cy5z\naXplKCk7CiAgICAgICAgaWYgKF9lbWJlZHMgIT0gbnVsbCkKICAgICAgICAg\nICAgc2l6ZSArPSBfZW1iZWRzLnNpemUoKTsKICAgICAgICBpZiAoc2l6ZSA9\nPSAwKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElT\nVDsKCiAgICAgICAgTGlzdCBjb3B5ID0gbmV3IEFycmF5TGlzdChzaXplKTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9tYWluLnZhbHVlcygpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICBjb3B5LmFk\nZChpdHIubmV4dCgpKTsKICAgICAgICBpZiAoX2NvbmZsaWN0cyAhPSBudWxs\nICYmICFfY29uZmxpY3RzLmlzRW1wdHkoKSkKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBfY29uZmxpY3RzLnZhbHVlcygpLml0ZXJhdG9yKCk7\nCiAgICAgICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAg\nICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAgIGlmIChfbmV3cyAh\nPSBudWxsICYmICFfbmV3cy5pc0VtcHR5KCkpCiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX25ld3MudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4\ndCgpKTsKICAgICAgICBpZiAoX2VtYmVkcyAhPSBudWxsICYmICFfZW1iZWRz\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBf\nZW1iZWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgcmV0dXJuIGNv\ncHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciB0aGUgY2FjaGUuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgIF9tYWlu\nID0gYnJva2VyLm5ld01hbmFnZWRPYmplY3RDYWNoZSgpOwogICAgICAgIGlm\nIChfY29uZmxpY3RzICE9IG51bGwpCiAgICAgICAgICAgIF9jb25mbGljdHMg\nPSBudWxsOwogICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAgICAgICAg\nICBfbmV3cyA9IG51bGw7CiAgICAgICAgaWYgKF9lbWJlZHMgIT0gbnVsbCkK\nICAgICAgICAgICAgX2VtYmVkcyA9IG51bGw7CiAgICAgICAgaWYgKF91bnRy\nYWNrZWQgIT0gbnVsbCkKICAgICAgICAgICAgX3VudHJhY2tlZCA9IG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBuZXcgaW5zdGFuY2VzIHdp\ndGhvdXQgcGVybWFuZW50IG9pZHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGNsZWFyTmV3KCkgewogICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAg\nICAgICAgICBfbmV3cyA9IG51bGw7CiAgICB9CgogICAgdm9pZCBkaXJ0eUNo\nZWNrKCkgewogICAgICAgIGlmIChfdW50cmFja2VkID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0g\nX3VudHJhY2tlZC5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgKQogICAg\nICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ZXIubmV4dCgpKS5kaXJ0\neUNoZWNrKCk7CiAgICB9Cn0K\n","encoding":"base64"}

