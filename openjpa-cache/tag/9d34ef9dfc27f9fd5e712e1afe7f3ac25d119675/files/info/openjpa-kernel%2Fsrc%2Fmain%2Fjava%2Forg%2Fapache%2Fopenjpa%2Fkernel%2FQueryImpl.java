{"sha":"5f7faa86a0ee8bbfab330f78f33d3acb377051aa","node_id":"MDQ6QmxvYjIwNjM2NDo1ZjdmYWE4NmEwZWU4YmJmYWIzMzBmNzhmMzNkM2FjYjM3NzA1MWFh","size":70002,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5f7faa86a0ee8bbfab330f78f33d3acb377051aa","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdEl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLk9iamVjdFV0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNl\nQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5MaXRlcmFsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFsOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5yb3AuRWFnZXJSZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5yb3AuTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SYW5nZVJl\nc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5yb3AuUmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VIYXNoU2V0\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50\nTG9jazsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5\ncGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFS\nZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2Vu\nZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludmFsaWRTdGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk5vblVuaXF1ZVJlc3VsdEV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk5vUmVzdWx0RXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxI\nZWxwZXI7CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKaW1wb3J0IHNlcnAu\ndXRpbC5TdHJpbmdzOwoKLyoqCiAqIEltcGxlbWVudGF0aW9uIG9mIHRoZSB7\nQGxpbmsgUXVlcnl9IGludGVyZmFjZS4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIFF1ZXJ5SW1wbAog\nICAgaW1wbGVtZW50cyBRdWVyeSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZShRdWVy\neUltcGwuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9sYW5n\ndWFnZTsKICAgIHByaXZhdGUgZmluYWwgU3RvcmVRdWVyeSBfc3RvcmVRdWVy\neTsKICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIEJyb2tlckltcGwgX2Jy\nb2tlcjsKICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIExvZyBfbG9nOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgQ2xhc3NMb2FkZXIgX2xvYWRlciA9IG51\nbGw7CgogICAgLy8gcXVlcnkgaGFzIGl0cyBvd24gaW50ZXJuYWwgbG9jawog\nICAgcHJpdmF0ZSBmaW5hbCBSZWVudHJhbnRMb2NrIF9sb2NrOwoKICAgIC8v\nIHVucGFyc2VkIHN0YXRlCiAgICBwcml2YXRlIENsYXNzIF9jbGFzcyA9IG51\nbGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX3N1YmNsYXNzZXMgPSB0cnVlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9yZWFkT25seSA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBTdHJpbmcgX3F1ZXJ5ID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5n\nIF9wYXJhbXMgPSBudWxsOwoKICAgIC8vIHBhcnNlZCBzdGF0ZQogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgQ29tcGlsYXRpb24gX2NvbXBpbGVkID0gbnVsbDsK\nICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX2NvbXBpbGluZyA9IGZh\nbHNlOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVzdWx0UGFja2VyIF9wYWNr\nZXIgPSBudWxsOwoKICAgIC8vIGNhbmRpZGF0ZXMKICAgIHByaXZhdGUgdHJh\nbnNpZW50IENvbGxlY3Rpb24gX2NvbGxlY3Rpb24gPSBudWxsOwogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgRXh0ZW50IF9leHRlbnQgPSBudWxsOwoKICAgIC8v\nIGxpc3RlbmVycwogICAgcHJpdmF0ZSBNYXAgX2ZpbHRMaXN0ZW5lcnMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBNYXAgX2FnZ0xpc3RlbmVycyA9IG51bGw7Cgog\nICAgLy8gY29uZmlndXJhdGlvbiBmb3IgbG9hZGluZyBvYmplY3RzCiAgICBw\ncml2YXRlIEZldGNoQ29uZmlndXJhdGlvbiBfZmMgPSBudWxsOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9pZ25vcmVDaGFuZ2VzID0gZmFsc2U7CiAgICBwcml2\nYXRlIENsYXNzIF9yZXN1bHRNYXBwaW5nU2NvcGUgPSBudWxsOwogICAgcHJp\ndmF0ZSBTdHJpbmcgX3Jlc3VsdE1hcHBpbmdOYW1lID0gbnVsbDsKCiAgICAv\nLyB0aGVzZSBmaWVsZHMgc2hvdWxkIG9ubHkgYmUgdXNlZCBkaXJlY3RseSBh\nZnRlciB3ZSBoYXZlIGEgY29tcGlsYXRpb24sCiAgICAvLyBiZWNhdXNlIHRo\nZWlyIHZhbHVlcyBtYXkgYmUgZW5jb2RlZCBpbiB0aGUgcXVlcnkgc3RyaW5n\nCiAgICBwcml2YXRlIEJvb2xlYW4gX3VuaXF1ZSA9IG51bGw7CiAgICBwcml2\nYXRlIENsYXNzIF9yZXN1bHRDbGFzcyA9IG51bGw7CiAgICBwcml2YXRlIHRy\nYW5zaWVudCBsb25nIF9zdGFydElkeCA9IDA7CiAgICBwcml2YXRlIHRyYW5z\naWVudCBsb25nIF9lbmRJZHggPSBMb25nLk1BWF9WQUxVRTsKICAgIHByaXZh\ndGUgdHJhbnNpZW50IGJvb2xlYW4gX3JhbmdlU2V0ID0gZmFsc2U7CgogICAg\nLy8gcmVtZW1iZXIgdGhlIGxpc3Qgb2YgYWxsIHRoZSByZXN1bHRzIHdlIGhh\ndmUgcmV0dXJuZWQgc28gd2UKICAgIC8vIGNhbiBmcmVlIHRoZWlyIHJlc291\ncmNlcyB3aGVuIGNsb3NlIG9yIGNsb3NlQWxsIGlzIGNhbGxlZAogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgZmluYWwgQ29sbGVjdGlvbiBfcmVzdWx0TGlzdHMg\nPSBuZXcgUmVmZXJlbmNlSGFzaFNldAogICAgICAgIChSZWZlcmVuY2VIYXNo\nU2V0LldFQUspOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0IGEgcXVlcnkg\nbWFuYWdlZCBieSB0aGUgZ2l2ZW4gYnJva2VyLgogICAgICovCiAgICBwdWJs\naWMgUXVlcnlJbXBsKEJyb2tlciBicm9rZXIsIFN0cmluZyBsYW5ndWFnZSwg\nU3RvcmVRdWVyeSBzdG9yZVF1ZXJ5KSB7CiAgICAgICAgX2Jyb2tlciA9IChC\ncm9rZXJJbXBsKSBicm9rZXI7CiAgICAgICAgX2xhbmd1YWdlID0gbGFuZ3Vh\nZ2U7CiAgICAgICAgX3N0b3JlUXVlcnkgPSBzdG9yZVF1ZXJ5OwogICAgICAg\nIF9mYyA9IChGZXRjaENvbmZpZ3VyYXRpb24pIGJyb2tlci5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKS5jbG9uZSgpOwogICAgICAgIF9sb2cgPSBicm9rZXIu\nZ2V0Q29uZmlndXJhdGlvbigpLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlv\nbi5MT0dfUVVFUlkpOwogICAgICAgIF9zdG9yZVF1ZXJ5LnNldENvbnRleHQo\ndGhpcyk7CgogICAgICAgIGlmIChfYnJva2VyICE9IG51bGwgJiYgX2Jyb2tl\nci5nZXRNdWx0aXRocmVhZGVkKCkpCiAgICAgICAgICAgIF9sb2NrID0gbmV3\nIFJlZW50cmFudExvY2soKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9s\nb2NrID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIHN0\nb3JlIHF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBnZXRT\ndG9yZVF1ZXJ5KCkgewogICAgICAgIHJldHVybiBfc3RvcmVRdWVyeTsKICAg\nIH0KCiAgICBwdWJsaWMgQnJva2VyIGdldEJyb2tlcigpIHsKICAgICAgICBy\nZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgUXVlcnkgZ2V0UXVl\ncnkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGlj\nIFN0b3JlQ29udGV4dCBnZXRTdG9yZUNvbnRleHQoKSB7CiAgICAgICAgcmV0\ndXJuIF9icm9rZXI7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRMYW5n\ndWFnZSgpIHsKICAgICAgICByZXR1cm4gX2xhbmd1YWdlOwogICAgfQoKICAg\nIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCkgewogICAgICAgIHJldHVybiBfZmM7CiAgICB9CgogICAgcHVibGlj\nIFN0cmluZyBnZXRRdWVyeVN0cmluZygpIHsKICAgICAgICByZXR1cm4gX3F1\nZXJ5OwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldElnbm9yZUNoYW5n\nZXMoKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBf\naWdub3JlQ2hhbmdlczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25v\ncmVDaGFuZ2VzKGJvb2xlYW4gZmxhZykgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nICAgIC8vIGFsbG93ZWQgbW9kaWZpY2F0aW9uOiBubyByZWFkLW9ubHkgY2hl\nY2sKICAgICAgICAgICAgX2lnbm9yZUNoYW5nZXMgPSBmbGFnOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1JlYWRPbmx5KCkgewogICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gX3JlYWRPbmx5Owog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlYWRPbmx5KGJvb2xlYW4gZmxh\nZykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIF9yZWFkT25seSA9IGZsYWc7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZEZpbHRlckxpc3Rl\nbmVyKEZpbHRlckxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgaWYg\nKF9maWx0TGlzdGVuZXJzID09IG51bGwpCiAgICAgICAgICAgICAgICBfZmls\ndExpc3RlbmVycyA9IG5ldyBIYXNoTWFwKDUpOwogICAgICAgICAgICBfZmls\ndExpc3RlbmVycy5wdXQobGlzdGVuZXIuZ2V0VGFnKCksIGxpc3RlbmVyKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlRmlsdGVyTGlz\ndGVuZXIoRmlsdGVyTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgICAgICBhc3NlcnROb3RSZWFkT25seSgpOwogICAgICAgICAgICBp\nZiAoX2ZpbHRMaXN0ZW5lcnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9m\naWx0TGlzdGVuZXJzLnJlbW92ZShsaXN0ZW5lci5nZXRUYWcoKSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldEZpbHRlckxpc3Rl\nbmVycygpIHsKICAgICAgICByZXR1cm4gKF9maWx0TGlzdGVuZXJzID09IG51\nbGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVAogICAgICAgICAgICA6IF9m\naWx0TGlzdGVuZXJzLnZhbHVlcygpOwogICAgfQoKICAgIHB1YmxpYyBGaWx0\nZXJMaXN0ZW5lciBnZXRGaWx0ZXJMaXN0ZW5lcihTdHJpbmcgdGFnKSB7CiAg\nICAgICAgLy8gZmlyc3QgY2hlY2sgbGlzdGVuZXJzIGZvciB0aGlzIHF1ZXJ5\nCiAgICAgICAgaWYgKF9maWx0TGlzdGVuZXJzICE9IG51bGwpIHsKICAgICAg\nICAgICAgRmlsdGVyTGlzdGVuZXIgbGlzdGVuID0gKEZpbHRlckxpc3RlbmVy\nKSBfZmlsdExpc3RlbmVycy5nZXQodGFnKTsKICAgICAgICAgICAgaWYgKGxp\nc3RlbiAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGxpc3RlbjsK\nICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIHVzZXItZGVmaW5lZCBsaXN0\nZW5lcnMgZnJvbSBjb25maWd1cmF0aW9uCiAgICAgICAgRmlsdGVyTGlzdGVu\nZXJbXSBjb25mTGlzdGVuZXJzID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9u\nKCkuCiAgICAgICAgICAgIGdldEZpbHRlckxpc3RlbmVySW5zdGFuY2VzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25mTGlzdGVuZXJzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoY29uZkxpc3RlbmVyc1tpXS5n\nZXRUYWcoKS5lcXVhbHModGFnKSkKICAgICAgICAgICAgICAgIHJldHVybiBj\nb25mTGlzdGVuZXJzW2ldOwoKICAgICAgICAvLyBjaGVjayBzdG9yZSBsaXN0\nZW5lcnMKICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnkuZ2V0RmlsdGVyTGlz\ndGVuZXIodGFnKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRBZ2dyZWdh\ndGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0ZW5lciBsaXN0ZW5lcikgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CiAgICAg\nICAgICAgIGlmIChfYWdnTGlzdGVuZXJzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfYWdnTGlzdGVuZXJzID0gbmV3IEhhc2hNYXAoNSk7CiAgICAgICAg\nICAgIF9hZ2dMaXN0ZW5lcnMucHV0KGxpc3RlbmVyLmdldFRhZygpLCBsaXN0\nZW5lcik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZUFn\nZ3JlZ2F0ZUxpc3RlbmVyKEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsK\nICAgICAgICAgICAgaWYgKF9hZ2dMaXN0ZW5lcnMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9hZ2dMaXN0ZW5lcnMucmVtb3ZlKGxpc3RlbmVyLmdldFRh\nZygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nQWdncmVnYXRlTGlzdGVuZXJzKCkgewogICAgICAgIHJldHVybiAoX2FnZ0xp\nc3RlbmVycyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QKICAg\nICAgICAgICAgOiBfYWdnTGlzdGVuZXJzLnZhbHVlcygpOwogICAgfQoKICAg\nIHB1YmxpYyBBZ2dyZWdhdGVMaXN0ZW5lciBnZXRBZ2dyZWdhdGVMaXN0ZW5l\ncihTdHJpbmcgdGFnKSB7CiAgICAgICAgLy8gZmlyc3QgY2hlY2sgbGlzdGVu\nZXJzIGZvciB0aGlzIHF1ZXJ5CiAgICAgICAgaWYgKF9hZ2dMaXN0ZW5lcnMg\nIT0gbnVsbCkgewogICAgICAgICAgICBBZ2dyZWdhdGVMaXN0ZW5lciBsaXN0\nZW4gPSAoQWdncmVnYXRlTGlzdGVuZXIpIF9hZ2dMaXN0ZW5lcnMuCiAgICAg\nICAgICAgICAgICBnZXQodGFnKTsKICAgICAgICAgICAgaWYgKGxpc3RlbiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGxpc3RlbjsKICAgICAg\nICB9CgogICAgICAgIC8vIGNoZWNrIHVzZXItZGVmaW5lZCBsaXN0ZW5lcnMg\nZnJvbSBjb25maWd1cmF0aW9uCiAgICAgICAgQWdncmVnYXRlTGlzdGVuZXJb\nXSBjb25mTGlzdGVuZXJzID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCku\nCiAgICAgICAgICAgIGdldEFnZ3JlZ2F0ZUxpc3RlbmVySW5zdGFuY2VzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25mTGlzdGVuZXJzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoY29uZkxpc3RlbmVyc1tpXS5n\nZXRUYWcoKS5lcXVhbHModGFnKSkKICAgICAgICAgICAgICAgIHJldHVybiBj\nb25mTGlzdGVuZXJzW2ldOwoKICAgICAgICAvLyBjaGVjayBzdG9yZSBsaXN0\nZW5lcnMKICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnkuZ2V0QWdncmVnYXRl\nTGlzdGVuZXIodGFnKTsKICAgIH0KCiAgICBwdWJsaWMgRXh0ZW50IGdldENh\nbmRpZGF0ZUV4dGVudCgpIHsKICAgICAgICAvLyBpZiBqdXN0IHRoZSBjbGFz\ncyBpcyBzZXQsIGZldGNoIHRoZSBjb3JyZXNwb25kaW5nIGV4dGVudDsgaWYg\ndGhlCiAgICAgICAgLy8gZXh0ZW50IGlzIGFscmVhZHkgc2V0IGJ1dCBpdHMg\naWdub3JlIGNhY2hlIHNldHRpbmcgaXMgd3JvbmcsCiAgICAgICAgLy8gZ2V0\nIGEgbmV3IGV4dGVudCB3aXRoIHRoZSBjb3JyZWN0IHNldHRpbmcgKGRvbid0\nIG1vZGlmeSBvcmlnIGV4dGVudAogICAgICAgIC8vIGluIGNhc2UgdGhlIHVz\nZXIgaGFzIGEgcmVmZXJlbmNlIHRvIGl0IGFuZCBtaWdodCB1c2UgaXQpCiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNz\nIGNscyA9IGdldENhbmRpZGF0ZVR5cGUoKTsKICAgICAgICAgICAgaWYgKF9l\neHRlbnQgPT0gbnVsbCAmJiBfY29sbGVjdGlvbiA9PSBudWxsICYmIF9icm9r\nZXIgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgY2xzICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIF9leHRlbnQgPSBfYnJva2VyLm5ld0V4dGVudChj\nbHMsIF9zdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAgIF9leHRlbnQuc2V0\nSWdub3JlQ2hhbmdlcyhfaWdub3JlQ2hhbmdlcyk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoX2V4dGVudCAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBf\nZXh0ZW50LmdldElnbm9yZUNoYW5nZXMoKSAhPSBfaWdub3JlQ2hhbmdlcyAm\nJiBjbHMgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gX2Jy\nb2tlci5uZXdFeHRlbnQoY2xzLCBfZXh0ZW50Lmhhc1N1YmNsYXNzZXMoKSk7\nCiAgICAgICAgICAgICAgICBfZXh0ZW50LnNldElnbm9yZUNoYW5nZXMoX2ln\nbm9yZUNoYW5nZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiBfZXh0ZW50OwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRD\nYW5kaWRhdGVFeHRlbnQoRXh0ZW50IGNhbmRpZGF0ZUV4dGVudCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CgogICAg\nICAgICAgICBpZiAoY2FuZGlkYXRlRXh0ZW50ID09IF9leHRlbnQpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChjYW5kaWRhdGVF\neHRlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2V4dGVudCA9IG51\nbGw7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIGlmIGV4dGVudCB0aGVuIG5vdCBjb2xsZWN0aW9uCiAg\nICAgICAgICAgIF9leHRlbnQgPSBjYW5kaWRhdGVFeHRlbnQ7CiAgICAgICAg\nICAgIF9jb2xsZWN0aW9uID0gbnVsbDsKCiAgICAgICAgICAgIGJvb2xlYW4g\naW52YWxpZGF0ZSA9IGZhbHNlOwogICAgICAgICAgICBpZiAoX2V4dGVudC5n\nZXRFbGVtZW50VHlwZSgpICE9IF9jbGFzcykgewogICAgICAgICAgICAgICAg\nX2NsYXNzID0gX2V4dGVudC5nZXRFbGVtZW50VHlwZSgpOwogICAgICAgICAg\nICAgICAgX2xvYWRlciA9IG51bGw7CiAgICAgICAgICAgICAgICBpbnZhbGlk\nYXRlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX2V4\ndGVudC5oYXNTdWJjbGFzc2VzKCkgIT0gX3N1YmNsYXNzZXMpIHsKICAgICAg\nICAgICAgICAgIF9zdWJjbGFzc2VzID0gX2V4dGVudC5oYXNTdWJjbGFzc2Vz\nKCk7CiAgICAgICAgICAgICAgICBpbnZhbGlkYXRlID0gdHJ1ZTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoaW52YWxpZGF0ZSkKICAgICAgICAg\nICAgICAgIGludmFsaWRhdGVDb21waWxhdGlvbigpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRDYW5kaWRhdGVDb2xsZWN0aW9u\nKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gX2Nv\nbGxlY3Rpb247CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2FuZGlkYXRl\nQ29sbGVjdGlvbihDb2xsZWN0aW9uIGNhbmRpZGF0ZUNvbGxlY3Rpb24pIHsK\nICAgICAgICBpZiAoIV9zdG9yZVF1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVj\ndXRpb24oKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJxdWVyeS1ub3N1cHBvcnQiLAogICAgICAgICAg\nICAgICAgX2xhbmd1YWdlKSk7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICAv\nLyBpZiBjb2xsZWN0aW9uIHRoZW4gbm90IGV4dGVudAogICAgICAgICAgICBf\nY29sbGVjdGlvbiA9IGNhbmRpZGF0ZUNvbGxlY3Rpb247CiAgICAgICAgICAg\nIGlmIChfY29sbGVjdGlvbiAhPSBudWxsKQogICAgICAgICAgICAgICAgX2V4\ndGVudCA9IG51bGw7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBn\nZXRDYW5kaWRhdGVUeXBlKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlm\nIChfY2xhc3MgIT0gbnVsbCB8fCBfY29tcGlsZWQgIT0gbnVsbCB8fCBfcXVl\ncnkgPT0gbnVsbAogICAgICAgICAgICAgICAgfHwgX2Jyb2tlciA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIF9jbGFzczsKCiAgICAgICAgICAg\nIC8vIGNoZWNrIGFnYWluIGFmdGVyIGNvbXBpbGF0aW9uOyBtYXliZSBlbmNv\nZGVkIGluIHN0cmluZwogICAgICAgICAgICBjb21waWxlRm9yQ29tcGlsYXRp\nb24oKTsKICAgICAgICAgICAgcmV0dXJuIF9jbGFzczsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Q2FuZGlkYXRlVHlwZShDbGFzcyBjYW5k\naWRhdGVDbGFzcywgYm9vbGVhbiBzdWJzKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgX2NsYXNz\nID0gY2FuZGlkYXRlQ2xhc3M7CiAgICAgICAgICAgIF9zdWJjbGFzc2VzID0g\nc3ViczsKICAgICAgICAgICAgX2xvYWRlciA9IG51bGw7CiAgICAgICAgICAg\nIGludmFsaWRhdGVDb21waWxhdGlvbigpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNTdWJjbGFzc2VzKCkgewogICAgICAgIHJldHVy\nbiBfc3ViY2xhc3NlczsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFJl\nc3VsdE1hcHBpbmdOYW1lKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICByZXR1cm4gX3Jlc3VsdE1hcHBpbmdOYW1lOwogICAgfQoKICAgIHB1\nYmxpYyBDbGFzcyBnZXRSZXN1bHRNYXBwaW5nU2NvcGUoKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBfcmVzdWx0TWFwcGluZ1Nj\nb3BlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlc3VsdE1hcHBpbmco\nQ2xhc3Mgc2NvcGUsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgX3Jlc3VsdE1hcHBpbmdTY29wZSA9IHNjb3BlOwogICAgICAgICAg\nICBfcmVzdWx0TWFwcGluZ05hbWUgPSBuYW1lOwogICAgICAgICAgICBfcGFj\na2VyID0gbnVsbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNVbmlxdWUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgaWYgKF91bmlx\ndWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBfdW5pcXVlLmJv\nb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICBpZiAoX3F1ZXJ5ID09IG51bGwg\nfHwgX2NvbXBpbGluZyB8fCBfYnJva2VyID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAvLyBjaGVjayBhZ2Fp\nbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcK\nICAgICAgICAgICAgaWYgKF9jb21waWxlZCA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAg\nICAgIGlmIChfdW5pcXVlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIF91bmlxdWUuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIG5vIGV4cGxpY2l0IHNldHRpbmc7IGRlZmF1bHQK\nICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVG\nb3JFeGVjdXRvcigpOwogICAgICAgICAgICBpZiAoIWV4LmlzQWdncmVnYXRl\nKF9zdG9yZVF1ZXJ5KSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgcmV0dXJuICFleC5oYXNHcm91cGluZyhfc3RvcmVRdWVy\neSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFVuaXF1ZShi\nb29sZWFuIHVuaXF1ZSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2Vy\ndE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAgIF91bmlxdWUgPSAodW5pcXVl\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRSZXN1bHRUeXBlKCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgICAgIGlmIChfcmVzdWx0Q2xhc3MgIT0gbnVsbCB8fCBf\nY29tcGlsZWQgIT0gbnVsbCB8fCBfcXVlcnkgPT0gbnVsbAogICAgICAgICAg\nICAgICAgfHwgX2Jyb2tlciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIF9yZXN1bHRDbGFzczsKCiAgICAgICAgICAgIC8vIGNoZWNrIGFnYWlu\nIGFmdGVyIGNvbXBpbGF0aW9uOyBtYXliZSBlbmNvZGVkIGluIHN0cmluZwog\nICAgICAgICAgICBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXN1bHRDbGFzczsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0UmVzdWx0VHlwZShDbGFzcyBjbHMpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgICAgICAvLyBhbGxvd2VkIG1vZGlmaWNhdGlvbjogbm8gcmVh\nZC1vbmx5IGNoZWNrCiAgICAgICAgICAgIF9yZXN1bHRDbGFzcyA9IGNsczsK\nICAgICAgICAgICAgX3BhY2tlciA9IG51bGw7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBsb25nIGdldFN0YXJ0UmFuZ2UoKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIHJldHVybiBfc3RhcnRJZHg7CiAgICB9CgogICAg\ncHVibGljIGxvbmcgZ2V0RW5kUmFuZ2UoKSB7CiAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgIHJldHVybiBfZW5kSWR4OwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFJhbmdlKGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAg\nICAgaWYgKHN0YXJ0IDwgMCB8fCBlbmQgPCAwKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC1yYW5nZSIs\nCiAgICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihzdGFydCksIFN0cmlu\nZy52YWx1ZU9mKGVuZCkpKTsKCiAgICAgICAgaWYgKGVuZCAtIHN0YXJ0ID4g\nSW50ZWdlci5NQVhfVkFMVUUgJiYgZW5kICE9IExvbmcuTUFYX1ZBTFVFKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\ncmFuZ2UtdG9vLWJpZyIsCiAgICAgICAgICAgICAgICBTdHJpbmcudmFsdWVP\nZihzdGFydCksIFN0cmluZy52YWx1ZU9mKGVuZCkpKTsKCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICAgICAgLy8gYWxsb3dlZCBtb2RpZmljYXRpb246IG5vIHJlYWQt\nb25seSBjaGVjawogICAgICAgICAgICBfc3RhcnRJZHggPSBzdGFydDsKICAg\nICAgICAgICAgX2VuZElkeCA9IGVuZDsKICAgICAgICAgICAgX3JhbmdlU2V0\nID0gdHJ1ZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRQ\nYXJhbWV0ZXJEZWNsYXJhdGlvbigpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAg\nICBpZiAoX3BhcmFtcyAhPSBudWxsIHx8IF9jb21waWxlZCAhPSBudWxsIHx8\nIF9jb21waWxpbmcKICAgICAgICAgICAgICAgIHx8IF9icm9rZXIgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBfcGFyYW1zOwoKICAgICAgICAg\nICAgLy8gY2hlY2sgYWdhaW4gYWZ0ZXIgY29tcGlsYXRpb247IG1heWJlIGVu\nY29kZWQgaW4gc3RyaW5nCiAgICAgICAgICAgIGNvbXBpbGVGb3JDb21waWxh\ndGlvbigpOwogICAgICAgICAgICByZXR1cm4gX3BhcmFtczsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgZGVjbGFyZVBhcmFtZXRlcnMoU3RyaW5n\nIHBhcmFtcykgewogICAgICAgIGlmICghX3N0b3JlUXVlcnkuc3VwcG9ydHNQ\nYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJxdWVyeS1ub3N1cHBv\ncnQiLAogICAgICAgICAgICAgICAgX2xhbmd1YWdlKSk7CgogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAg\nIF9wYXJhbXMgPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKHBhcmFtcyk7CiAg\nICAgICAgICAgIGludmFsaWRhdGVDb21waWxhdGlvbigpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBjb21waWxlKCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgICAgIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXggPSBjb21waWxlRm9y\nRXhlY3V0b3IoKTsKICAgICAgICAgICAgZ2V0UmVzdWx0UGFja2VyKF9zdG9y\nZVF1ZXJ5LCBleCk7CiAgICAgICAgICAgIGV4LnZhbGlkYXRlKF9zdG9yZVF1\nZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRDb21w\naWxhdGlvbigpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JDb21waWxhdGlvbigpLnN0b3Jl\nRGF0YTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21waWxlIHF1\nZXJ5IHByb3BlcnRpZXMuCiAgICAgKi8KICAgIHByaXZhdGUgQ29tcGlsYXRp\nb24gY29tcGlsZUZvckNvbXBpbGF0aW9uKCkgewogICAgICAgIGlmIChfY29t\ncGlsZWQgIT0gbnVsbCB8fCBfY29tcGlsaW5nKQogICAgICAgICAgICByZXR1\ncm4gX2NvbXBpbGVkOwoKICAgICAgICBhc3NlcnROb3RTZXJpYWxpemVkKCk7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICBib29sZWFuIHJlYWRP\nbmx5ID0gX3JlYWRPbmx5OwogICAgICAgIF9yZWFkT25seSA9IGZhbHNlOwog\nICAgICAgIF9jb21waWxpbmcgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF9jb21waWxlZCA9IGNvbXBpbGF0aW9uRnJvbUNhY2hlKCk7CiAg\nICAgICAgICAgIHJldHVybiBfY29tcGlsZWQ7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBfY29tcGlsaW5nID0gZmFsc2U7\nCiAgICAgICAgICAgIF9yZWFkT25seSA9IHJlYWRPbmx5OwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIGNhY2hlZCBjb21waWxh\ndGlvbiBmb3IgdGhlIGN1cnJlbnQgcXVlcnksIGNyZWF0aW5nIG9uZSBpZiBp\ndAogICAgICogZG9lcyBub3QgZXhpc3QuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBDb21waWxhdGlvbiBjb21waWxhdGlvbkZyb21DYWNoZSgpIHsKICAgICAg\nICBNYXAgY29tcENhY2hlID0KICAgICAgICAgICAgX2Jyb2tlci5nZXRDb25m\naWd1cmF0aW9uKCkuZ2V0UXVlcnlDb21waWxhdGlvbkNhY2hlSW5zdGFuY2Uo\nKTsKICAgICAgICBpZiAoY29tcENhY2hlID09IG51bGwpIHsKICAgICAgICAg\nICAgcmV0dXJuIG5ld0NvbXBpbGF0aW9uKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgQ29tcGlsYXRpb25LZXkga2V5ID0gbmV3IENvbXBpbGF0\naW9uS2V5KCk7CiAgICAgICAgICAgIGtleS5xdWVyeVR5cGUgPSBfc3RvcmVR\ndWVyeS5nZXRDbGFzcygpOwogICAgICAgICAgICBrZXkuY2FuZGlkYXRlVHlw\nZSA9IGdldENhbmRpZGF0ZVR5cGUoKTsKICAgICAgICAgICAga2V5LnN1YmNs\nYXNzZXMgPSBoYXNTdWJjbGFzc2VzKCk7CiAgICAgICAgICAgIGtleS5xdWVy\neSA9IGdldFF1ZXJ5U3RyaW5nKCk7CiAgICAgICAgICAgIGtleS5sYW5ndWFn\nZSA9IGdldExhbmd1YWdlKCk7CiAgICAgICAgICAgIGtleS5zdG9yZUtleSA9\nIF9zdG9yZVF1ZXJ5Lm5ld0NvbXBpbGF0aW9uS2V5KCk7CiAgICAgICAgICAg\nIENvbXBpbGF0aW9uIGNvbXAgPSAoQ29tcGlsYXRpb24pIGNvbXBDYWNoZS5n\nZXQoa2V5KTsKCiAgICAgICAgICAgIC8vIHBhcnNlIGRlY2xhcmF0aW9ucyBp\nZiBuZWVkZWQKICAgICAgICAgICAgYm9vbGVhbiBjYWNoZSA9IGZhbHNlOwog\nICAgICAgICAgICBpZiAoY29tcCA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBjb21wID0gbmV3Q29tcGlsYXRpb24oKTsKICAgICAgICAgICAgICAgIC8v\nIG9ubHkgY2FjaGUgdGhvc2UgcXVlcmllcyB0aGF0IGNhbiBiZSBjb21waWxl\nZAogICAgICAgICAgICAgICAgY2FjaGUgPSBjb21wLnN0b3JlRGF0YSAhPSBu\ndWxsOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIF9zdG9y\nZVF1ZXJ5LnBvcHVsYXRlRnJvbUNvbXBpbGF0aW9uKGNvbXAuc3RvcmVEYXRh\nKTsKCiAgICAgICAgICAgIC8vIGNhY2hlIHBhcnNlZCBzdGF0ZSBpZiBuZWVk\nZWQKICAgICAgICAgICAgaWYgKGNhY2hlKQogICAgICAgICAgICAgICAgY29t\ncENhY2hlLnB1dChrZXksIGNvbXApOwogICAgICAgICAgICByZXR1cm4gY29t\ncDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRl\nIGFuZCBwb3B1bGF0ZSBhIG5ldyBjb21waWxhdGlvbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBDb21waWxhdGlvbiBuZXdDb21waWxhdGlvbigpIHsKICAgICAg\nICBDb21waWxhdGlvbiBjb21wID0gbmV3IENvbXBpbGF0aW9uKCk7CiAgICAg\nICAgY29tcC5zdG9yZURhdGEgPSBfc3RvcmVRdWVyeS5uZXdDb21waWxhdGlv\nbigpOwogICAgICAgIF9zdG9yZVF1ZXJ5LnBvcHVsYXRlRnJvbUNvbXBpbGF0\naW9uKGNvbXAuc3RvcmVEYXRhKTsKICAgICAgICByZXR1cm4gY29tcDsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbXBpbGUgZm9yIGV4ZWN1dGlvbiwgY2hv\nb3NpbmcgYmV0d2VlbiBkYXRhc3RvcmUgYW5kIGluLW1lbQogICAgICogY29t\ncGlsYXRpb24gYmFzZWQgb24gd2hhdCB3ZSBzdXBwb3J0IGFuZCBvdXIgc2V0\ndGluZ3MuCiAgICAgKi8KICAgIHByaXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRv\nciBjb21waWxlRm9yRXhlY3V0b3IoKSB7CiAgICAgICAgQ29tcGlsYXRpb24g\nY29tcCA9IGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgIGlmIChf\nY29sbGVjdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChjb21wLmRh\ndGFzdG9yZSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbXAu\nZGF0YXN0b3JlOwogICAgICAgICAgICBpZiAoY29tcC5tZW1vcnkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBjb21wLm1lbW9yeTsKICAgICAg\nICAgICAgaWYgKF9zdG9yZVF1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0\naW9uKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckRhdGFT\ndG9yZShjb21wKTsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JJbk1l\nbW9yeShjb21wKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb21wLm1lbW9y\neSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY29tcC5tZW1vcnk7CiAg\nICAgICAgaWYgKGNvbXAuZGF0YXN0b3JlICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBjb21wLmRhdGFzdG9yZTsKICAgICAgICBpZiAoX3N0b3JlUXVl\ncnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpKQogICAgICAgICAgICBy\nZXR1cm4gY29tcGlsZUZvckluTWVtb3J5KGNvbXApOwogICAgICAgIHJldHVy\nbiBjb21waWxlRm9yRGF0YVN0b3JlKGNvbXApOwogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGFuIGV4cHJlc3Npb24gdHJlZSBmb3IgZGF0YXN0b3Jl\nIGV4ZWN1dGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdG9yZVF1ZXJ5LkV4\nZWN1dG9yIGNvbXBpbGVGb3JEYXRhU3RvcmUoQ29tcGlsYXRpb24gY29tcCkg\newogICAgICAgIGlmIChjb21wLmRhdGFzdG9yZSA9PSBudWxsKQogICAgICAg\nICAgICBjb21wLmRhdGFzdG9yZSA9IGNyZWF0ZUV4ZWN1dG9yKGZhbHNlKTsK\nICAgICAgICByZXR1cm4gY29tcC5kYXRhc3RvcmU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYW4gZXhwcmVzc2lvbiB0cmVlIGZvciBpbi1tZW1v\ncnkgZXhlY3V0aW9uLgogICAgICovCiAgICBwcml2YXRlIFN0b3JlUXVlcnku\nRXhlY3V0b3IgY29tcGlsZUZvckluTWVtb3J5KENvbXBpbGF0aW9uIGNvbXAp\nIHsKICAgICAgICBpZiAoY29tcC5tZW1vcnkgPT0gbnVsbCkKICAgICAgICAg\nICAgY29tcC5tZW1vcnkgPSBjcmVhdGVFeGVjdXRvcih0cnVlKTsKICAgICAg\nICByZXR1cm4gY29tcC5tZW1vcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBxdWVyeSBleGVjdXRvciBvZiB0aGUgcHJvcGVyIHR5cGUuCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRvciBjcmVhdGVF\neGVjdXRvcihib29sZWFuIGluTWVtKSB7CiAgICAgICAgYXNzZXJ0Q2FuZGlk\nYXRlVHlwZSgpOwoKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3Mg\nPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0\nTWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShfY2xhc3MsCiAgICAg\nICAgICAgIF9icm9rZXIuZ2V0Q2xhc3NMb2FkZXIoKSwgZmFsc2UpOwoKICAg\nICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXM7CiAgICAgICAgaWYgKF9jbGFz\ncyA9PSBudWxsIHx8IF9zdG9yZVF1ZXJ5LnN1cHBvcnRzQWJzdHJhY3RFeGVj\ndXRvcnMoKSkKICAgICAgICAgICAgbWV0YXMgPSBuZXcgQ2xhc3NNZXRhRGF0\nYVtdeyBtZXRhIH07CiAgICAgICAgZWxzZSBpZiAoX3N1YmNsYXNzZXMgJiYg\nKG1ldGEgPT0gbnVsbCB8fCBtZXRhLmlzTWFuYWdlZEludGVyZmFjZSgpKSkK\nICAgICAgICAgICAgbWV0YXMgPSByZXBvcy5nZXRJbXBsZW1lbnRvck1ldGFE\nYXRhcyhfY2xhc3MsCiAgICAgICAgICAgICAgICBfYnJva2VyLmdldENsYXNz\nTG9hZGVyKCksIHRydWUpOwogICAgICAgIGVsc2UgaWYgKG1ldGEgIT0gbnVs\nbCAmJiAoX3N1YmNsYXNzZXMgfHwgbWV0YS5pc01hcHBlZCgpKSkKICAgICAg\nICAgICAgbWV0YXMgPSBuZXcgQ2xhc3NNZXRhRGF0YVtdeyBtZXRhIH07CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBtZXRhcyA9IFN0b3JlUXVlcnkuRU1Q\nVFlfTUVUQVM7CgogICAgICAgIGlmIChtZXRhcy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLWltcGxzIiwgX2NsYXNzKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKG1ldGFzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAo\naW5NZW0pCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9zdG9yZVF1ZXJ5\nLm5ld0luTWVtb3J5RXhlY3V0b3IobWV0YXNbMF0sCiAgICAgICAgICAgICAg\nICAgICAgICAgIF9zdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBfc3RvcmVRdWVyeS5uZXdEYXRhU3RvcmVFeGVjdXRvcihtZXRhc1swXSwg\nX3N1YmNsYXNzZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBt\ndWx0aXBsZSBpbXBsZW1lbnRvcnMKICAgICAgICAgICAgU3RvcmVRdWVyeS5F\neGVjdXRvcltdIGVzID0gbmV3IFN0b3JlUXVlcnkuRXhlY3V0b3JbbWV0YXMu\nbGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGluTWVtKQogICAg\nICAgICAgICAgICAgICAgIGVzW2ldID0gX3N0b3JlUXVlcnkubmV3SW5NZW1v\ncnlFeGVjdXRvcihtZXRhc1tpXSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgZXNbaV0gPSBfc3RvcmVRdWVyeS5u\nZXdEYXRhU3RvcmVFeGVjdXRvcihtZXRhc1tpXSwgdHJ1ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBNZXJnZWRFeGVjdXRvcihl\ncyk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbGVhciBhbnkgY29tcGlsYXRpb24sIGZvcmNpbmcgdGhpcyBxdWVyeSB0\nbyBiZSByZWNvbXBpbGVkCiAgICAgKiBuZXh0IHRpbWUgaXQncyBleGVjdXRl\nZC4gVGhpcyBzaG91bGQgYmUgaW52b2tlZCB3aGVuZXZlciBhbnkKICAgICAq\nIHN0YXRlIGNoYW5nZXMgdGhhdCB3b3VsZCBjYXVzZSB0aGUgdW5kZXJseWlu\nZyBxdWVyeQogICAgICogcmVwcmVzZW50YXRpb24gdG8gY2hhbmdlLgogICAg\nICoKICAgICAqIEBzaW5jZSAwLjMuMAogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCkgewogICAgICAgIGlmIChf\nY29tcGlsaW5nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nX3N0b3JlUXVlcnkuaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAgICAg\nX2NvbXBpbGVkID0gbnVsbDsKICAgICAgICBfcGFja2VyID0gbnVsbDsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGV4\nZWN1dGUoKSB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGUoKE9iamVjdFtdKSBu\ndWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGV4ZWN1dGUoT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGUoT1BfU0VMRUNU\nLCBwYXJhbXMpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZXhlY3V0ZShN\nYXAgcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGUoT1BfU0VMRUNU\nLCBwYXJhbXMpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGV4ZWN1dGUo\naW50IG9wZXJhdGlvbiwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgaWYg\nKHBhcmFtcyA9PSBudWxsKQogICAgICAgICAgICBwYXJhbXMgPSBTdG9yZVF1\nZXJ5LkVNUFRZX09CSkVDVFM7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnROb3RTZXJpYWxpemVkKCk7CiAgICAg\nICAgICAgIF9icm9rZXIuYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgICAgICAgICBfYnJva2VyLmFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFk\nKCk7CgogICAgICAgICAgICAgICAgLy8gZ2V0IGV4ZWN1dG9yCiAgICAgICAg\nICAgICAgICBDb21waWxhdGlvbiBjb21wID0gY29tcGlsZUZvckNvbXBpbGF0\naW9uKCk7CiAgICAgICAgICAgICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4\nID0gKGlzSW5NZW1vcnkob3BlcmF0aW9uKSkKICAgICAgICAgICAgICAgICAg\nICA/IGNvbXBpbGVGb3JJbk1lbW9yeShjb21wKSA6IGNvbXBpbGVGb3JEYXRh\nU3RvcmUoY29tcCk7CgogICAgICAgICAgICAgICAgYXNzZXJ0UGFyYW1ldGVy\ncyhfc3RvcmVRdWVyeSwgZXgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBp\nZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nIGxvZ0V4ZWN1dGlvbihvcGVyYXRpb24sIGV4LmdldFBhcmFtZXRlclR5cGVz\nKF9zdG9yZVF1ZXJ5KSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1z\nKTsKCiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09IE9QX1NFTEVD\nVCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhlY3V0ZShfc3RvcmVR\ndWVyeSwgZXgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBpZiAob3BlcmF0\naW9uID09IE9QX0RFTEVURSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZGVsZXRlKF9zdG9yZVF1ZXJ5LCBleCwgcGFyYW1zKTsKICAgICAgICAgICAg\nICAgIGlmIChvcGVyYXRpb24gPT0gT1BfVVBEQVRFKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiB1cGRhdGUoX3N0b3JlUXVlcnksIGV4LCBwYXJhbXMp\nOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICBfYnJva2VyLmVuZE9wZXJhdGlvbigpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBP\nYmplY3QgZXhlY3V0ZShpbnQgb3BlcmF0aW9uLCBNYXAgcGFyYW1zKSB7CiAg\nICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKQogICAgICAgICAgICBwYXJhbXMg\nPSBDb2xsZWN0aW9ucy5FTVBUWV9NQVA7CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBfYnJva2VyLmJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXNz\nZXJ0Tm90U2VyaWFsaXplZCgpOwogICAgICAgICAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgICAgICAgICAgX2Jyb2tlci5hc3NlcnROb250cmFuc2Fj\ndGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgICAgIC8vIGdldCBleGVjdXRv\ncgogICAgICAgICAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9IGNvbXBpbGVG\nb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICAgICAgU3RvcmVRdWVyeS5F\neGVjdXRvciBleCA9IChpc0luTWVtb3J5KG9wZXJhdGlvbikpCiAgICAgICAg\nICAgICAgICAgICAgPyBjb21waWxlRm9ySW5NZW1vcnkoY29tcCkgOiBjb21w\naWxlRm9yRGF0YVN0b3JlKGNvbXApOwoKICAgICAgICAgICAgICAgIE9iamVj\ndFtdIGFyciA9IChwYXJhbXMuaXNFbXB0eSgpKSA/IFN0b3JlUXVlcnkuRU1Q\nVFlfT0JKRUNUUyA6CiAgICAgICAgICAgICAgICAgICAgdG9QYXJhbWV0ZXJB\ncnJheShleC5nZXRQYXJhbWV0ZXJUeXBlcyhfc3RvcmVRdWVyeSksIHBhcmFt\ncyk7CiAgICAgICAgICAgICAgICBhc3NlcnRQYXJhbWV0ZXJzKF9zdG9yZVF1\nZXJ5LCBleCwgYXJyKTsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nRXhlY3V0aW9u\nKG9wZXJhdGlvbiwgcGFyYW1zKTsKCiAgICAgICAgICAgICAgICBpZiAob3Bl\ncmF0aW9uID09IE9QX1NFTEVDVCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZXhlY3V0ZShfc3RvcmVRdWVyeSwgZXgsIGFycik7CiAgICAgICAgICAg\nICAgICBpZiAob3BlcmF0aW9uID09IE9QX0RFTEVURSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZGVsZXRlKF9zdG9yZVF1ZXJ5LCBleCwgYXJyKTsK\nICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT0gT1BfVVBEQVRFKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGUoX3N0b3JlUXVlcnks\nIGV4LCBhcnIpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICBfYnJva2VyLmVuZE9wZXJhdGlv\nbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGxvbmcgZGVsZXRlQWxsKCkgewogICAgICAgIHJldHVybiBkZWxl\ndGVBbGwoKE9iamVjdFtdKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgbG9u\nZyBkZWxldGVBbGwoT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJu\nICgoTnVtYmVyKSBleGVjdXRlKE9QX0RFTEVURSwgcGFyYW1zKSkubG9uZ1Zh\nbHVlKCk7CiAgICB9CgogICAgcHVibGljIGxvbmcgZGVsZXRlQWxsKE1hcCBw\nYXJhbXMpIHsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGV4ZWN1dGUoT1Bf\nREVMRVRFLCBwYXJhbXMpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJs\naWMgbG9uZyB1cGRhdGVBbGwoKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZUFs\nbCgoT2JqZWN0W10pIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIHVw\nZGF0ZUFsbChPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gKChO\ndW1iZXIpIGV4ZWN1dGUoT1BfVVBEQVRFLCBwYXJhbXMpKS5sb25nVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyB1cGRhdGVBbGwoTWFwIHBhcmFt\ncykgewogICAgICAgIHJldHVybiAoKE51bWJlcikgZXhlY3V0ZShPUF9VUERB\nVEUsIHBhcmFtcykpLmxvbmdWYWx1ZSgpOwogICAgfQoKICAgIHByaXZhdGUg\nT2JqZWN0W10gdG9QYXJhbWV0ZXJBcnJheShMaW5rZWRNYXAgcGFyYW1UeXBl\ncywgTWFwIHBhcmFtcykgewogICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCB8\nfCBwYXJhbXMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gU3RvcmVR\ndWVyeS5FTVBUWV9PQkpFQ1RTOwoKICAgICAgICBPYmplY3RbXSBhcnIgPSBu\nZXcgT2JqZWN0W3BhcmFtcy5zaXplKCldOwogICAgICAgIE1hcC5FbnRyeSBl\nbnRyeTsKICAgICAgICBPYmplY3Qga2V5OwogICAgICAgIGludCBpZHg7CiAg\nICAgICAgaW50IGJhc2UgPSAtMTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHBhcmFtcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAgICAg\nICAgICAgIGlkeCA9IChwYXJhbVR5cGVzID09IG51bGwpID8gLTEgOiBwYXJh\nbVR5cGVzLmluZGV4T2Yoa2V5KTsKCiAgICAgICAgICAgIC8vIGFsbG93IHBv\nc2l0aW9uYWwgcGFyYW1ldGVycyBhbmQgbmF0dXJhbCBvcmRlciBwYXJhbWV0\nZXJzCiAgICAgICAgICAgIGlmIChpZHggIT0gLTEpCiAgICAgICAgICAgICAg\nICBhcnJbaWR4XSA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKGtleSBpbnN0YW5jZW9mIE51bWJlcikgewogICAgICAgICAgICAg\nICAgaWYgKGJhc2UgPT0gLTEpCiAgICAgICAgICAgICAgICAgICAgYmFzZSA9\nIHBvc2l0aW9uYWxQYXJhbWV0ZXJCYXNlKHBhcmFtcy5rZXlTZXQoKSk7CiAg\nICAgICAgICAgICAgICBhcnJbKChOdW1iZXIpIGtleSkuaW50VmFsdWUoKSAt\nIGJhc2VdID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLXBhcmFtLW5hbWUiLCBrZXkpKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGFycjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgYmFzZSAoZ2VuZXJhbGx5IDAgb3IgMSkgdG8gdXNlIGZvciBwb3NpdGlv\nbmFsIHBhcmFtZXRlcnMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGlu\ndCBwb3NpdGlvbmFsUGFyYW1ldGVyQmFzZShDb2xsZWN0aW9uIHBhcmFtcykg\newogICAgICAgIGludCBsb3cgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgICAg\nICBPYmplY3Qgb2JqOwogICAgICAgIGludCB2YWw7CiAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBwYXJhbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgaWYgKCEob2JqIGluc3RhbmNlb2YgTnVtYmVyKSkKICAgICAgICAgICAg\nICAgIHJldHVybiAwOyAvLyB1c2UgMCBiYXNlIHdoZW4gcGFyYW1zIGFyZSBt\naXhlZCB0eXBlcwoKICAgICAgICAgICAgdmFsID0gKChOdW1iZXIpIG9iaiku\naW50VmFsdWUoKTsKICAgICAgICAgICAgaWYgKHZhbCA9PSAwKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgaWYgKHZhbCA8IGxv\ndykKICAgICAgICAgICAgICAgIGxvdyA9IHZhbDsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGxvdzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3\naGV0aGVyIHdlIHNob3VsZCBleGVjdXRlIHRoaXMgcXVlcnkgaW4gbWVtb3J5\nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNJbk1lbW9yeShpbnQg\nb3BlcmF0aW9uKSB7CiAgICAgICAgLy8gaWYgdGhlcmUgYXJlIGFueSBkaXJ0\neSBpbnN0YW5jZXMgaW4gdGhlIGN1cnJlbnQgdHJhbnMgdGhhdCBhcmUKICAg\nICAgICAvLyBpbnZvbHZlZCBpbiB0aGlzIHF1ZXJ5LCB3ZSBoYXZlIHRvIGV4\nZWN1dGUgaW4gbWVtb3J5IG9yIGZsdXNoCiAgICAgICAgYm9vbGVhbiBpbk1l\nbSA9ICFfc3RvcmVRdWVyeS5zdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigp\nCiAgICAgICAgICAgIHx8IF9jb2xsZWN0aW9uICE9IG51bGw7CiAgICAgICAg\naWYgKCFpbk1lbSAmJiAoIV9pZ25vcmVDaGFuZ2VzIHx8IG9wZXJhdGlvbiAh\nPSBPUF9TRUxFQ1QpCiAgICAgICAgICAgICYmIF9icm9rZXIuaXNBY3RpdmUo\nKSAmJiBpc0FjY2Vzc1BhdGhEaXJ0eSgpKSB7CiAgICAgICAgICAgIGludCBm\nbHVzaCA9IF9mYy5nZXRGbHVzaEJlZm9yZVF1ZXJpZXMoKTsKICAgICAgICAg\nICAgaWYgKChmbHVzaCA9PSBGTFVTSF9UUlVFCiAgICAgICAgICAgICAgICB8\nfCAoZmx1c2ggPT0gRkxVU0hfV0lUSF9DT05ORUNUSU9OICYmIF9icm9rZXIu\naGFzQ29ubmVjdGlvbigpKQogICAgICAgICAgICAgICAgfHwgb3BlcmF0aW9u\nICE9IE9QX1NFTEVDVAogICAgICAgICAgICAgICAgfHwgIV9zdG9yZVF1ZXJ5\nLnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkKICAgICAgICAgICAgICAg\nICYmIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRlZE9wdGlv\nbnMoKS4KICAgICAgICAgICAgICAgIGNvbnRhaW5zKE9wZW5KUEFDb25maWd1\ncmF0aW9uLk9QVElPTl9JTkNfRkxVU0gpKSB7CiAgICAgICAgICAgICAgICBf\nYnJva2VyLmZsdXNoKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBpZiAoX2xvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJmb3JjZS1pbi1tZW0iLCBf\nY2xhc3MpKTsKICAgICAgICAgICAgICAgIGluTWVtID0gdHJ1ZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGluTWVtICYmICFfc3Rv\ncmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nImNhbnQtZXhlYy1pbm1lbSIsCiAgICAgICAgICAgICAgICBfbGFuZ3VhZ2Up\nKTsKICAgICAgICByZXR1cm4gaW5NZW07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBFeGVjdXRlIHRoZSBxdWVyeSB1c2luZyB0aGUgZ2l2ZW4gY29tcGlsYXRp\nb24sIGV4ZWN1dG9yLCBhbmQgcGFyYW1ldGVyCiAgICAgKiB2YWx1ZXMuIEFs\nbCBvdGhlciBleGVjdXRlIG1ldGhvZHMgZGVsZWdhdGUgdG8gdGhpcyBvbmUg\nb3IgdG8KICAgICAqIHtAbGluayAjZXhlY3V0ZShTdG9yZVF1ZXJ5LkV4ZWN1\ndG9yLE1hcCl9IGFmdGVyIHZhbGlkYXRpb24gYW5kIGxvY2tpbmcuCiAgICAg\nKi8KICAgIHByaXZhdGUgT2JqZWN0IGV4ZWN1dGUoU3RvcmVRdWVyeSBxLCBT\ndG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4LCAKICAgICAgICBPYmplY3RbXSBwYXJh\nbXMpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYg\ndGhpcyBpcyBhbiBpbXBvc3NpYmxlIHJlc3VsdCByYW5nZSwgcmV0dXJuIG51\nbGwgLyBlbXB0eSBsaXN0CiAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5n\nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdlKF9zdGFydElkeCwgX2VuZElkeCk7\nCiAgICAgICAgaWYgKCFfcmFuZ2VTZXQpCiAgICAgICAgICAgIGV4LmdldFJh\nbmdlKHEsIHBhcmFtcywgcmFuZ2UpOwogICAgICAgIGlmIChyYW5nZS5zdGFy\ndCA+PSByYW5nZS5lbmQpCiAgICAgICAgICAgIHJldHVybiBlbXB0eVJlc3Vs\ndChxLCBleCk7CgogICAgICAgIC8vIGV4ZWN1dGU7IGlmIHdlIGhhdmUgYSBy\nZXN1bHQgY2xhc3Mgb3Igd2UgaGF2ZSBvbmx5IG9uZSByZXN1bHQKICAgICAg\nICAvLyBhbmQgc28gbmVlZCB0byByZW1vdmUgaXQgZnJvbSBpdHMgYXJyYXks\nIHdyYXAgaW4gYSBwYWNraW5nIHJvcAogICAgICAgIHJhbmdlLmxycyA9IGlz\nTFJTKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpOwogICAgICAgIFJlc3VsdE9i\namVjdFByb3ZpZGVyIHJvcCA9IGV4LmV4ZWN1dGVRdWVyeShxLCBwYXJhbXMs\nIHJhbmdlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gdG9S\nZXN1bHQocSwgZXgsIHJvcCwgcmFuZ2UpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChyb3AgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRyeSB7IHJvcC5jbG9zZSgpOyB9IGNhdGNoIChFeGNl\ncHRpb24gZTIpIHt9CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogRGVsZXRlIHRoZSBxdWVyeSB1c2luZyB0\naGUgZ2l2ZW4gZXhlY3V0b3IsIGFuZCBwYXJhbWV0ZXIKICAgICAqIHZhbHVl\ncy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0aG9kcyBkZWxlZ2F0ZSB0byB0aGlz\nIG9uZSBvciB0bwogICAgICoge0BsaW5rICNkZWxldGUoU3RvcmVRdWVyeS5F\neGVjdXRvcixNYXApfSBhZnRlciB2YWxpZGF0aW9uIGFuZCBsb2NraW5nLgog\nICAgICogVGhlIHJldHVybiB2YWx1ZSB3aWxsIGJlIGEgTnVtYmVyIGluZGlj\nYXRpbmcgdGhlIG51bWJlciBvZgogICAgICogaW5zdGFuY2VzIGRlbGV0ZWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgTnVtYmVyIGRlbGV0ZShTdG9yZVF1ZXJ5\nIHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIE9iamVjdFtdIHBhcmFtcykK\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRCdWxr\nTW9kaWZ5KHEsIGV4LCBwYXJhbXMpOwogICAgICAgIHJldHVybiBleC5leGVj\ndXRlRGVsZXRlKHEsIHBhcmFtcyk7CiAgICB9CgogICAgcHVibGljIE51bWJl\nciBkZWxldGVJbk1lbW9yeShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhl\nY3V0b3IgZXhlY3V0b3IsCiAgICAgICAgT2JqZWN0W10gcGFyYW1zKSB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgT2JqZWN0IG8gPSBleGVjdXRlKHEs\nIGV4ZWN1dG9yLCBwYXJhbXMpOwogICAgICAgICAgICBpZiAoIShvIGluc3Rh\nbmNlb2YgQ29sbGVjdGlvbikpCiAgICAgICAgICAgICAgICBvID0gQ29sbGVj\ndGlvbnMuc2luZ2xldG9uKG8pOwoKICAgICAgICAgICAgaW50IHNpemUgPSAw\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSAoKENvbGxlY3Rpb24p\nIG8pLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOyBzaXplKyspCiAgICAgICAg\nICAgICAgICBfYnJva2VyLmRlbGV0ZShpLm5leHQoKSwgbnVsbCk7CiAgICAg\nICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2Yoc2l6ZSk7CiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihlKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIHF1ZXJ5IHVzaW5n\nIHRoZSBnaXZlbiBjb21waWxhdGlvbiwgZXhlY3V0b3IsIGFuZCBwYXJhbWV0\nZXIKICAgICAqIHZhbHVlcy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0aG9kcyBk\nZWxlZ2F0ZSB0byB0aGlzIG9uZSBvciB0bwogICAgICoge0BsaW5rICN1cGRh\ndGUoU3RvcmVRdWVyeS5FeGVjdXRvcixNYXApfSBhZnRlciB2YWxpZGF0aW9u\nIGFuZCBsb2NraW5nLgogICAgICogVGhlIHJldHVybiB2YWx1ZSB3aWxsIGJl\nIGEgTnVtYmVyIGluZGljYXRpbmcgdGhlIG51bWJlciBvZgogICAgICogaW5z\ndGFuY2VzIHVwZGF0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgTnVtYmVyIHVw\nZGF0ZShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIE9i\namVjdFtdIHBhcmFtcykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBhc3NlcnRCdWxrTW9kaWZ5KHEsIGV4LCBwYXJhbXMpOwogICAgICAg\nIHJldHVybiBleC5leGVjdXRlVXBkYXRlKHEsIHBhcmFtcyk7CiAgICB9Cgog\nICAgcHVibGljIE51bWJlciB1cGRhdGVJbk1lbW9yeShTdG9yZVF1ZXJ5IHEs\nIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXhlY3V0b3IsCiAgICAgICAgT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgT2JqZWN0\nIG8gPSBleGVjdXRlKHEsIGV4ZWN1dG9yLCBwYXJhbXMpOwogICAgICAgICAg\nICBpZiAoIShvIGluc3RhbmNlb2YgQ29sbGVjdGlvbikpCiAgICAgICAgICAg\nICAgICBvID0gQ29sbGVjdGlvbnMuc2luZ2xldG9uKG8pOwoKICAgICAgICAg\nICAgaW50IHNpemUgPSAwOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGkg\nPSAoKENvbGxlY3Rpb24pIG8pLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOyBz\naXplKyspCiAgICAgICAgICAgICAgICB1cGRhdGVJbk1lbW9yeShpLm5leHQo\nKSwgcGFyYW1zLCBxKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFs\ndWVPZihzaXplKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgdmFsdWVzIGZvciB0aGUgdXBkYXRlcyBpbiBtZW1vcnkuCiAgICAg\nKgogICAgICogQHBhcmFtIG9iIHRoZSBwZXJzaXN0ZW50IGluc3RhbmNlIHRv\nIGNoYW5nZQogICAgICogQHBhcmFtIHBhcmFtcyB0aGUgcGFyYW1ldGVycyBw\nYXNzZWQgdG8gdGhlIHF1ZXJ5CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1\ncGRhdGVJbk1lbW9yeShPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywgU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdCA9IGdldFVw\nZGF0ZXMoKS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgIGl0\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IGUgPSAoTWFw\nLkVudHJ5KSBpdC5uZXh0KCk7CiAgICAgICAgICAgIFBhdGggcGF0aCA9IChQ\nYXRoKSBlLmdldEtleSgpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IChGaWVsZE1ldGFEYXRhKSBwYXRoLmxhc3QoKTsKICAgICAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IF9icm9rZXIuZ2V0U3RhdGVNYW5h\nZ2VyKG9iKTsKCiAgICAgICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAgICAg\nIE9iamVjdCB2YWx1ZSA9IGUuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYg\nKHZhbHVlIGluc3RhbmNlb2YgVmFsKSB7CiAgICAgICAgICAgICAgICB2YWwg\nPSAoKFZhbCkgdmFsdWUpLgogICAgICAgICAgICAgICAgICAgIGV2YWx1YXRl\nKG9iLCBudWxsLCBnZXRTdG9yZUNvbnRleHQoKSwgcGFyYW1zKTsKICAgICAg\nICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExpdGVyYWwpIHsK\nICAgICAgICAgICAgICAgIHZhbCA9ICgoTGl0ZXJhbCkgdmFsdWUpLmdldFZh\nbHVlKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2Vv\nZiBDb25zdGFudCkgewogICAgICAgICAgICAgICAgdmFsID0gKChDb25zdGFu\ndCkgdmFsdWUpLmdldFZhbHVlKHBhcmFtcyk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHZhbCA9IHEuZXZhbHVhdGUodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFVuc3VwcG9ydGVkRXhjZXB0aW9uIGUx\nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoImZhaWwtdG8tZ2V0LXVwZGF0ZS12YWx1ZSIpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50\nIGkgPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIGludG8gPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxl\nKG9iLAogICAgICAgICAgICAgICAgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9u\nKCkpOwoKICAgICAgICAgICAgLy8gc2V0IHRoZSBhY3R1YWwgZmllbGQgaW4g\ndGhlIGluc3RhbmNlCiAgICAgICAgICAgIGludCBzZXQgPSBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyLlNFVF9VU0VSOwogICAgICAgICAgICBzd2l0Y2ggKGZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICAgICAgc20uc2V0\ndGluZ0Jvb2xlYW5GaWVsZChpbnRvLCBpLCBzbS5mZXRjaEJvb2xlYW5GaWVs\nZChpKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyBm\nYWxzZSA6ICgoQm9vbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0KTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAg\nICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0J5dGVGaWVsZChpbnRvLCBp\nLCBzbS5mZXRjaEJ5dGVGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCkuYnl0ZVZhbHVl\nKCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAg\nICAgIHNtLnNldHRpbmdDaGFyRmllbGQoaW50bywgaSwgc20uZmV0Y2hDaGFy\nRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxs\nID8gMCA6IHZhbC50b1N0cmluZygpLmNoYXJBdCgwKSwgc2V0KTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5n\nRG91YmxlRmllbGQoaW50bywgaSwgc20uZmV0Y2hEb3VibGVGaWVsZChpKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChO\ndW1iZXIpIHZhbCkuZG91YmxlVmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdGbG9hdEZp\nZWxkKGludG8sIGksIHNtLmZldGNoRmxvYXRGaWVsZChpKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZh\nbCkuZmxvYXRWYWx1ZSgpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAg\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdJbnRGaWVsZChpbnRvLCBpLCBz\nbS5mZXRjaEludEZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2\nYWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpLCBz\nZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgICAgICBz\nbS5zZXR0aW5nTG9uZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoTG9uZ0ZpZWxk\nKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAg\nOiAoKE51bWJlcikgdmFsKS5sb25nVmFsdWUoKSwgc2V0KTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTaG9y\ndEZpZWxkKGludG8sIGksIHNtLmZldGNoU2hvcnRGaWVsZChpKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIp\nIHZhbCkuc2hvcnRWYWx1ZSgpLCBzZXQpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5H\nOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTdHJpbmdGaWVsZChp\nbnRvLCBpLCBzbS5mZXRjaFN0cmluZ0ZpZWxkKGkpLAogICAgICAgICAgICAg\nICAgICAgICAgICB2YWwgPT0gbnVsbCA/IG51bGwgOiB2YWwudG9TdHJpbmco\nKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nT1VCTEVfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVRfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09C\nSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGlu\nZ09iamVjdEZpZWxkKGludG8sIGksIHNtLmZldGNoT2JqZWN0RmllbGQoaSks\nIHZhbCwKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm9ubHktdXBkYXRlLXByaW1pdGl2ZXMiKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFjZSBsb2cg\ndGhhdCB0aGUgcXVlcnkgaXMgZXhlY3V0aW5nLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgbG9nRXhlY3V0aW9uKGludCBvcCwgTGlua2VkTWFwIHR5cGVz\nLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICBNYXAgcG1hcCA9IENvbGxl\nY3Rpb25zLkVNUFRZX01BUDsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA+\nIDApIHsKICAgICAgICAgICAgcG1hcCA9IG5ldyBIYXNoTWFwKChpbnQpIChw\nYXJhbXMubGVuZ3RoICogMS4zMyArIDEpKTsKICAgICAgICAgICAgaWYgKHR5\ncGVzICE9IG51bGwgJiYgdHlwZXMuc2l6ZSgpID09IHBhcmFtcy5sZW5ndGgp\nIHsKICAgICAgICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gdHlwZXMua2V5U2V0KCkuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgcG1hcC5w\ndXQoaXRyLm5leHQoKSwgcGFyYW1zW2krK10pOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJh\nbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgcG1hcC5wdXQo\nU3RyaW5nLnZhbHVlT2YoaSksIHBhcmFtc1tpXSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgbG9nRXhlY3V0aW9uKG9wLCBwbWFwKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRyYWNlIGxvZyB0aGF0IHRoZSBxdWVyeSBp\ncyBleGVjdXRpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBsb2dFeGVj\ndXRpb24oaW50IG9wLCBNYXAgcGFyYW1zKSB7CiAgICAgICAgU3RyaW5nIHMg\nPSBfcXVlcnk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocykp\nCiAgICAgICAgICAgIHMgPSB0b1N0cmluZygpOwoKICAgICAgICBTdHJpbmcg\nbXNnID0gImV4ZWN1dGluZy1xdWVyeSI7CiAgICAgICAgaWYgKCFwYXJhbXMu\naXNFbXB0eSgpKQogICAgICAgICAgICBtc2cgKz0gIi13aXRoLXBhcmFtcyI7\nCgogICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQobXNnLCBzLCBwYXJhbXMp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoaXMg\nc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBwb3RlbnRpYWwgbGFyZ2UgcmVzdWx0\nIHNldC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzTFJTKGxvbmcg\nc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgbG9uZyByYW5nZSA9IGVuZCAt\nIHN0YXJ0OwogICAgICAgIHJldHVybiBfZmMuZ2V0RmV0Y2hCYXRjaFNpemUo\nKSA+PSAwCiAgICAgICAgICAgICYmICEocmFuZ2UgPD0gX2ZjLmdldEZldGNo\nQmF0Y2hTaXplKCkKICAgICAgICAgICAgfHwgKF9mYy5nZXRGZXRjaEJhdGNo\nU2l6ZSgpID09IDAgJiYgcmFuZ2UgPD0gNTApKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgcXVlcnkgcmVzdWx0IGZvciB0aGUgZ2l2ZW4g\ncmVzdWx0IG9iamVjdCBwcm92aWRlci4KICAgICAqLwogICAgcHJvdGVjdGVk\nIE9iamVjdCB0b1Jlc3VsdChTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhl\nY3V0b3IgZXgsIAogICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyIHJvcCwg\nU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkKICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAvLyBwYWNrIHByb2plY3Rpb25zIGlmIG5lY2Vzc2Fy\neQogICAgICAgIFN0cmluZ1tdIGFsaWFzZXMgPSBleC5nZXRQcm9qZWN0aW9u\nQWxpYXNlcyhxKTsKICAgICAgICBpZiAoIWV4LmlzUGFja2luZyhxKSkgewog\nICAgICAgICAgICBSZXN1bHRQYWNrZXIgcGFja2VyID0gZ2V0UmVzdWx0UGFj\na2VyKHEsIGV4KTsKICAgICAgICAgICAgaWYgKHBhY2tlciAhPSBudWxsIHx8\nIGFsaWFzZXMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICByb3AgPSBu\nZXcgUGFja2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKHJvcCwgcGFja2VyLAog\nICAgICAgICAgICAgICAgICAgIGFsaWFzZXMubGVuZ3RoKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGlmIHNpbmdsZSByZXN1bHQsIGV4dHJhY3QgaXQKICAg\nICAgICBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUgfHwgKGFsaWFzZXMu\nbGVuZ3RoID4gMAogICAgICAgICAgICAmJiAhZXguaGFzR3JvdXBpbmcocSkg\nJiYgZXguaXNBZ2dyZWdhdGUocSkpKQogICAgICAgICAgICByZXR1cm4gc2lu\nZ2xlUmVzdWx0KHJvcCwgcmFuZ2UpOwoKICAgICAgICAvLyBub3cgdGhhdCB3\nZSd2ZSBleGVjdXRlZCB0aGUgcXVlcnksIHdlIGNhbiBjYWxsIGlzQWdncmVn\nYXRlIGFuZAogICAgICAgIC8vIGhhc0dyb3VwaW5nIGVmZmljaWVudGx5CiAg\nICAgICAgYm9vbGVhbiBkZXRhY2ggPSAoX2Jyb2tlci5nZXRBdXRvRGV0YWNo\nKCkgJgogICAgICAgICAgICBBdXRvRGV0YWNoLkRFVEFDSF9OT05UWFJFQUQp\nID4gMCAmJiAhX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAgICAgIGJvb2xlYW4g\nbHJzID0gcmFuZ2UubHJzICYmICFleC5pc0FnZ3JlZ2F0ZShxKSAmJiAhZXgu\naGFzR3JvdXBpbmcocSk7CiAgICAgICAgUmVzdWx0TGlzdCByZXMgPSAoIWRl\ndGFjaCAmJiBscnMpID8gX2ZjLm5ld1Jlc3VsdExpc3Qocm9wKQogICAgICAg\nICAgICA6IG5ldyBFYWdlclJlc3VsdExpc3Qocm9wKTsKCiAgICAgICAgX3Jl\nc3VsdExpc3RzLmFkZChkZWNvcmF0ZVJlc3VsdExpc3QocmVzKSk7CiAgICAg\nICAgcmV0dXJuIHJlczsKICAgIH0KCiAgICAvKioKICAgICAqIE9wdGlvbmFs\nbHkgZGVjb3JhdGUgdGhlIG5hdGl2ZSByZXN1bHQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBSZXN1bHRMaXN0IGRlY29yYXRlUmVzdWx0TGlzdChSZXN1bHRM\naXN0IHJlcykgewogICAgICAgIHJldHVybiBuZXcgUmVtb3ZlT25DbG9zZVJl\nc3VsdExpc3QocmVzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIHJlc3VsdCBwYWNrZXIgZm9yIHRoaXMgcHJvamVjdGlvbiwgb3IgbnVsbC4K\nICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHRQYWNrZXIgZ2V0UmVzdWx0UGFj\na2VyKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCkgewog\nICAgICAgIGlmIChfcGFja2VyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBfcGFja2VyOwoKICAgICAgICBDbGFzcyByZXN1bHRDbGFzcyA9IChfcmVz\ndWx0Q2xhc3MgIT0gbnVsbCkgPyBfcmVzdWx0Q2xhc3MKICAgICAgICAgICAg\nOiBleC5nZXRSZXN1bHRDbGFzcyhxKTsKICAgICAgICBpZiAocmVzdWx0Q2xh\nc3MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIFN0cmluZ1tdIGFsaWFzZXMgPSBleC5nZXRQcm9qZWN0aW9uQWxpYXNlcyhx\nKTsKICAgICAgICBpZiAoYWxpYXNlcy5sZW5ndGggPT0gMCkgewogICAgICAg\nICAgICAvLyByZXN1bHQgY2xhc3MgYnV0IG5vIHJlc3VsdDsgbWVhbnMgY2Fu\nZGlkYXRlIGlzIGJlaW5nIHNldAogICAgICAgICAgICAvLyBpbnRvIHNvbWUg\ncmVzdWx0IGNsYXNzCiAgICAgICAgICAgIF9wYWNrZXIgPSBuZXcgUmVzdWx0\nUGFja2VyKF9jbGFzcywgZ2V0QWxpYXMoKSwgcmVzdWx0Q2xhc3MpOwogICAg\nICAgIH0gZWxzZSBpZiAocmVzdWx0Q2xhc3MgIT0gbnVsbCkgewogICAgICAg\nICAgICAvLyBwcm9qZWN0aW9uCiAgICAgICAgICAgIENsYXNzW10gdHlwZXMg\nPSBleC5nZXRQcm9qZWN0aW9uVHlwZXMocSk7CiAgICAgICAgICAgIF9wYWNr\nZXIgPSBuZXcgUmVzdWx0UGFja2VyKHR5cGVzLCBhbGlhc2VzLCByZXN1bHRD\nbGFzcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcGFja2VyOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGVtcHR5IHJlc3VsdCBmb3Ig\ndGhpcyBxdWVyeS4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZW1wdHlS\nZXN1bHQoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4KSB7\nCiAgICAgICAgaWYgKF91bmlxdWUgPT0gQm9vbGVhbi5UUlVFIHx8IChfdW5p\ncXVlID09IG51bGwKICAgICAgICAgICAgJiYgIWV4Lmhhc0dyb3VwaW5nKHEp\nICYmIGV4LmlzQWdncmVnYXRlKHEpKSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBFeHRyYWN0IGFuIGV4cGVjdGVkIHNpbmds\nZSByZXN1bHQgZnJvbSB0aGUgZ2l2ZW4gcHJvdmlkZXIuIFVzZWQgd2hlbgog\nICAgICogdGhlIHJlc3VsdCBpcyBhbiB1bmdyb3VwZWQgYWdncmVnYXRlIG9y\nIHRoZSB1bmlxdWUgZmxhZyBpcyBzZXQgdG8gdHJ1ZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBPYmplY3Qgc2luZ2xlUmVzdWx0KFJlc3VsdE9iamVjdFByb3Zp\nZGVyIHJvcCwgCiAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkKICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICByb3Aub3BlbigpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIG1vdmUgdG8gZXhwZWN0ZWQg\ncmVzdWx0CiAgICAgICAgICAgIGJvb2xlYW4gbmV4dCA9IHJvcC5uZXh0KCk7\nCgogICAgICAgICAgICAvLyBleHRyYWN0IHNpbmdsZSByZXN1bHQ7IHRocm93\nIGFuIGV4Y2VwdGlvbiBpZiBtdWx0aXBsZSByZXN1bHRzCiAgICAgICAgICAg\nIC8vIG1hdGNoIGFuZCBub3QgY29uc3RyYWludGVkIGJ5IHJhbmdlLCBvciBp\nZiBhIHVuaXF1ZSBxdWVyeSB3aXRoCiAgICAgICAgICAgIC8vIG5vIHJlc3Vs\ndHMKICAgICAgICAgICAgT2JqZWN0IHNpbmdsZSA9IG51bGw7CiAgICAgICAg\nICAgIGlmIChuZXh0KSB7CiAgICAgICAgICAgICAgICBzaW5nbGUgPSByb3Au\nZ2V0UmVzdWx0T2JqZWN0KCk7CiAgICAgICAgICAgICAgICBpZiAocmFuZ2Uu\nZW5kICE9IHJhbmdlLnN0YXJ0ICsgMSAmJiByb3AubmV4dCgpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBOb25VbmlxdWVSZXN1bHRFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vdC11bmlxdWUiLAogICAgICAgICAgICAgICAgICAg\nICAgICBfY2xhc3MsIF9xdWVyeSkpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKF91bmlxdWUgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQi\nLCAKICAgICAgICAgICAgICAgICAgICBfY2xhc3MsIF9xdWVyeSkpOwoKICAg\nICAgICAgICAgLy8gaWYgdW5pcXVlIHNldCB0byBmYWxzZSwgdXNlIGNvbGxl\nY3Rpb24KICAgICAgICAgICAgaWYgKF91bmlxdWUgPT0gQm9vbGVhbi5GQUxT\nRSkgewogICAgICAgICAgICAgICAgaWYgKCFuZXh0KQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgICAg\nICAgICAgICAgLy8gQ29sbGVjdGlvbnMuc2luZ2xldG9uTGlzdCBpcyBKREsg\nMS4zLCBzby4uLgogICAgICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xp\nc3QobmV3IE9iamVjdFtdeyBzaW5nbGUgfSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgCiAgICAgICAgICAgIC8vIHJldHVybiBzaW5nbGUgcmVzdWx0\nCiAgICAgICAgICAgIHJldHVybiBzaW5nbGU7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgcm9wLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ2FsY3VsYXRlcyB3aGV0aGVyIHRoZSBhY2Nlc3Mg\ncGF0aCBvZiB0aGlzIHF1ZXJ5IGludGVyc2VjdHMgd2l0aAogICAgICogYW55\nIGRpcnR5IG9iamVjdHMgaW4gdGhlIHRyYW5zYWN0aW9uLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNBY2Nlc3NQYXRoRGlydHkoKSB7CiAgICAg\nICAgcmV0dXJuIGlzQWNjZXNzUGF0aERpcnR5KF9icm9rZXIsIGdldEFjY2Vz\nc1BhdGhNZXRhRGF0YXMoKSk7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBi\nb29sZWFuIGlzQWNjZXNzUGF0aERpcnR5KEJyb2tlciBicm9rZXIsCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YVtdIGFjY2Vzc01ldGFzKSB7CiAgICAgICAgQ29s\nbGVjdGlvbiBwZXJzaXN0ZWQgPSBicm9rZXIuZ2V0UGVyc2lzdGVkVHlwZXMo\nKTsKICAgICAgICBDb2xsZWN0aW9uIHVwZGF0ZWQgPSBicm9rZXIuZ2V0VXBk\nYXRlZFR5cGVzKCk7CiAgICAgICAgQ29sbGVjdGlvbiBkZWxldGVkID0gYnJv\na2VyLmdldERlbGV0ZWRUeXBlcygpOwogICAgICAgIGlmIChwZXJzaXN0ZWQu\naXNFbXB0eSgpICYmIHVwZGF0ZWQuaXNFbXB0eSgpICYmIGRlbGV0ZWQuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8v\nIGlmIG5vIGFjY2VzcyBtZXRhcywgYXNzdW1lIGV2ZXJ5IGRpcnR5IG9iamVj\ndCBhZmZlY3RzIHBhdGgganVzdAogICAgICAgIC8vIHRvIGJlIHNhZmUKICAg\nICAgICBpZiAoYWNjZXNzTWV0YXMubGVuZ3RoID09IDApCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBjb21wYXJlIGRpcnR5IGNsYXNz\nZXMgdG8gdGhlIGFjY2VzcyBwYXRoIGNsYXNzZXMKICAgICAgICBDbGFzcyBh\nY2NDbGFzczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFjY2Vzc01l\ndGFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIHNob3J0Y3V0IGlm\nIGFjdHVhbCBjbGFzcyBpcyBkaXJ0eQogICAgICAgICAgICBhY2NDbGFzcyA9\nIGFjY2Vzc01ldGFzW2ldLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAg\nICAgaWYgKHBlcnNpc3RlZC5jb250YWlucyhhY2NDbGFzcykgfHwgdXBkYXRl\nZC5jb250YWlucyhhY2NDbGFzcykKICAgICAgICAgICAgICAgIHx8IGRlbGV0\nZWQuY29udGFpbnMoYWNjQ2xhc3MpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CgogICAgICAgICAgICAvLyBjaGVjayBmb3IgZGlydHkgc3ViY2xh\nc3MKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBkaXJ0eSA9IHBlcnNpc3Rl\nZC5pdGVyYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgaWYgKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZyb20oKENsYXNzKSBkaXJ0\neS5uZXh0KCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gdXBkYXRlZC5pdGVy\nYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgaWYg\nKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZyb20oKENsYXNzKSBkaXJ0eS5uZXh0\nKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gZGVsZXRlZC5pdGVyYXRvcigp\nOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgaWYgKGFjY0Ns\nYXNzLmlzQXNzaWduYWJsZUZyb20oKENsYXNzKSBkaXJ0eS5uZXh0KCkpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gbm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlQWxsKCkgewogICAgICAg\nIGNsb3NlUmVzdWx0cyh0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBj\nbG9zZVJlc291cmNlcygpIHsKICAgICAgICBjbG9zZVJlc3VsdHMoZmFsc2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2Ugb3BlbiByZXN1bHRzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgY2xvc2VSZXN1bHRzKGJvb2xlYW4g\nZm9yY2UpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgUmVtb3ZlT25DbG9z\nZVJlc3VsdExpc3QgcmVzOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IF9yZXN1bHRMaXN0cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgcmVzID0gKFJlbW92ZU9uQ2xvc2VSZXN1bHRM\naXN0KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGZvcmNlIHx8\nIHJlcy5pc1Byb3ZpZGVyT3BlbigpKQogICAgICAgICAgICAgICAgICAgIHJl\ncy5jbG9zZShmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3Jl\nc3VsdExpc3RzLmNsZWFyKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKE1hcCBwYXJhbXMpIHsKICAg\nICAgICBpZiAocGFyYW1zID09IG51bGwpCiAgICAgICAgICAgIHBhcmFtcyA9\nIENvbGxlY3Rpb25zLkVNUFRZX01BUDsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5vdFNlcmlhbGl6ZWQoKTsK\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgU3RvcmVR\ndWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAg\nICAgICAgICBPYmplY3RbXSBhcnIgPSB0b1BhcmFtZXRlckFycmF5KGV4Lmdl\ndFBhcmFtZXRlclR5cGVzKF9zdG9yZVF1ZXJ5KSwKICAgICAgICAgICAgICAg\nIHBhcmFtcyk7CiAgICAgICAgICAgIGFzc2VydFBhcmFtZXRlcnMoX3N0b3Jl\nUXVlcnksIGV4LCBhcnIpOwogICAgICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdl\nIHJhbmdlID0gbmV3IFN0b3JlUXVlcnkuUmFuZ2UoX3N0YXJ0SWR4LCBfZW5k\nSWR4KTsKICAgICAgICAgICAgaWYgKCFfcmFuZ2VTZXQpCiAgICAgICAgICAg\nICAgICBleC5nZXRSYW5nZShfc3RvcmVRdWVyeSwgYXJyLCByYW5nZSk7CiAg\nICAgICAgICAgIHJldHVybiBleC5nZXREYXRhU3RvcmVBY3Rpb25zKF9zdG9y\nZVF1ZXJ5LCBhcnIsIHJhbmdlKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBzZXRRdWVyeShPYmplY3QgcXVlcnkpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgICAgICBhc3NlcnROb3RSZWFkT25seSgpOwoKICAgICAgICAgICAg\naWYgKHF1ZXJ5ID09IG51bGwgfHwgcXVlcnkgaW5zdGFuY2VvZiBTdHJpbmcp\nIHsKICAgICAgICAgICAgICAgIGludmFsaWRhdGVDb21waWxhdGlvbigpOwog\nICAgICAgICAgICAgICAgX3F1ZXJ5ID0gKFN0cmluZykgcXVlcnk7CiAgICAg\nICAgICAgICAgICBpZiAoX3F1ZXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgX3F1ZXJ5ID0gX3F1ZXJ5LnRyaW0oKTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgh\nKHF1ZXJ5IGluc3RhbmNlb2YgUXVlcnlJbXBsKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBfc3RvcmVRdWVyeS5zZXRRdWVyeShxdWVyeSk7CgogICAgICAg\nICAgICAvLyBjb3B5IGFsbCBub24tdHJhbnNpZW50IHN0YXRlIGZyb20gdGhl\nIGdpdmVuIHF1ZXJ5CiAgICAgICAgICAgIGludmFsaWRhdGVDb21waWxhdGlv\nbigpOwogICAgICAgICAgICBRdWVyeUltcGwgcSA9IChRdWVyeUltcGwpIHF1\nZXJ5OwogICAgICAgICAgICBfY2xhc3MgPSBxLl9jbGFzczsKICAgICAgICAg\nICAgX3N1YmNsYXNzZXMgPSBxLl9zdWJjbGFzc2VzOwogICAgICAgICAgICBf\ncXVlcnkgPSBxLl9xdWVyeTsKICAgICAgICAgICAgX2lnbm9yZUNoYW5nZXMg\nPSBxLl9pZ25vcmVDaGFuZ2VzOwogICAgICAgICAgICBfdW5pcXVlID0gcS5f\ndW5pcXVlOwogICAgICAgICAgICBfcmVzdWx0Q2xhc3MgPSBxLl9yZXN1bHRD\nbGFzczsKICAgICAgICAgICAgX3BhcmFtcyA9IHEuX3BhcmFtczsKICAgICAg\nICAgICAgX3Jlc3VsdE1hcHBpbmdTY29wZSA9IHEuX3Jlc3VsdE1hcHBpbmdT\nY29wZTsKICAgICAgICAgICAgX3Jlc3VsdE1hcHBpbmdOYW1lID0gcS5fcmVz\ndWx0TWFwcGluZ05hbWU7CiAgICAgICAgICAgIF9yZWFkT25seSA9IHEuX3Jl\nYWRPbmx5OwoKICAgICAgICAgICAgLy8gZG9uJ3Qgc2hhcmUgbXV0YWJsZSBv\nYmplY3RzCiAgICAgICAgICAgIF9mYy5jb3B5KHEuX2ZjKTsKICAgICAgICAg\nICAgaWYgKHEuX2ZpbHRMaXN0ZW5lcnMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9maWx0TGlzdGVuZXJzID0gbmV3IEhhc2hNYXAocS5fZmlsdExpc3Rl\nbmVycyk7CiAgICAgICAgICAgIGlmIChxLl9hZ2dMaXN0ZW5lcnMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9hZ2dMaXN0ZW5lcnMgPSBuZXcgSGFzaE1h\ncChxLl9hZ2dMaXN0ZW5lcnMpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRBbGlhcygpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3Ry\naW5nIGFsaWFzID0gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0QWxpYXMoX3N0\nb3JlUXVlcnkpOwogICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGFsaWFzID0gU3RyaW5ncy5nZXRDbGFzc05hbWUoX2Ns\nYXNzKTsKICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0UHJvamVjdGlvbkFsaWFzZXMoKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRQcm9qZWN0aW9uQWxpYXNl\ncyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDbGFz\nc1tdIGdldFByb2plY3Rpb25UeXBlcygpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVj\ndXRvcigpLmdldFByb2plY3Rpb25UeXBlcyhfc3RvcmVRdWVyeSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0T3BlcmF0aW9uKCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0T3BlcmF0aW9uKF9zdG9yZVF1ZXJ5\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNBZ2dyZWdh\ndGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5pc0FnZ3JlZ2F0ZShf\nc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGhhc0dyb3VwaW5nKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuaGFz\nR3JvdXBpbmcoX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgQ2xhc3NNZXRhRGF0YVtdIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENs\nYXNzTWV0YURhdGFbXSBtZXRhcyA9IGNvbXBpbGVGb3JFeGVjdXRvcigpLgog\nICAgICAgICAgICAgICAgZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhfc3RvcmVR\ndWVyeSk7CiAgICAgICAgICAgIHJldHVybiAobWV0YXMgPT0gbnVsbCkgPyBT\ndG9yZVF1ZXJ5LkVNUFRZX01FVEFTIDogbWV0YXM7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBMaW5rZWRNYXAgZ2V0UGFyYW1ldGVyVHlwZXMoKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVy\nbiBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRQYXJhbWV0ZXJUeXBlcyhfc3Rv\ncmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBNYXAgZ2V0VXBk\nYXRlcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmdldFVwZGF0ZXMo\nX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBs\nb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQogICAgICAgICAg\nICBfbG9jay5sb2NrKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdW5sb2Nr\nKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsICYmIF9sb2NrLmlzTG9j\na2VkKCkpCiAgICAgICAgICAgIF9sb2NrLnVubG9jaygpOwogICAgfQoKICAg\nIC8vLy8vLy8vLwogICAgLy8gVXRpbHMKICAgIC8vLy8vLy8vLwoKICAgIHB1\nYmxpYyBDbGFzcyBjbGFzc0Zvck5hbWUoU3RyaW5nIG5hbWUsIFN0cmluZ1td\nIGltcG9ydHMpIHsKICAgICAgICAvLyBmdWxsIGNsYXNzIG5hbWUgb3IgcHJp\nbWl0aXZlIHR5cGU/CiAgICAgICAgQ2xhc3MgdHlwZSA9IHRvQ2xhc3MobmFt\nZSk7CiAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHR5cGU7CgogICAgICAgIC8vIGZpcnN0IGNoZWNrIHRoZSBhbGlhc2Vz\nIG1hcCBpbiB0aGUgTWV0YURhdGFSZXBvc2l0b3J5CiAgICAgICAgQ2xhc3NM\nb2FkZXIgbG9hZGVyID0gKF9jbGFzcyA9PSBudWxsKSA/IF9sb2FkZXIKICAg\nICAgICAgICAgOiAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nQ2xhc3NMb2FkZXJBY3Rpb24oX2NsYXNzKSk7IAogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAg\nICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLmdldE1l\ndGFEYXRhKG5hbWUsIGxvYWRlciwgZmFsc2UpOwogICAgICAgIGlmIChtZXRh\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKTsKCiAgICAgICAgLy8gdHJ5IHRoZSBuYW1lIGluIHRoZSBwYWNr\nYWdlIG9mIHRoZSBjYW5kaWRhdGUgY2xhc3MKICAgICAgICBpZiAoX2NsYXNz\nICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nIGZ1bGxOYW1lID0gX2Ns\nYXNzLmdldE5hbWUoKS5zdWJzdHJpbmcKICAgICAgICAgICAgICAgICgwLCBf\nY2xhc3MuZ2V0TmFtZSgpLmxhc3RJbmRleE9mKCcuJykgKyAxKSArIG5hbWU7\nCiAgICAgICAgICAgIHR5cGUgPSB0b0NsYXNzKGZ1bGxOYW1lKTsKICAgICAg\nICAgICAgaWYgKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiB0eXBlOwogICAgICAgIH0KCiAgICAgICAgLy8gdHJ5IGphdmEubGFuZwog\nICAgICAgIHR5cGUgPSB0b0NsYXNzKCJqYXZhLmxhbmcuIiArIG5hbWUpOwog\nICAgICAgIGlmICh0eXBlICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0\neXBlOwoKICAgICAgICAvLyB0cnkgZWFjaCBpbXBvcnQKICAgICAgICBpZiAo\naW1wb3J0cyAhPSBudWxsICYmIGltcG9ydHMubGVuZ3RoID4gMCkgewogICAg\nICAgICAgICBTdHJpbmcgZG90TmFtZSA9ICIuIiArIG5hbWU7CiAgICAgICAg\nICAgIFN0cmluZyBpbXBvcnROYW1lOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGltcG9ydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIGltcG9ydE5hbWUgPSBpbXBvcnRzW2ldOwoKICAgICAgICAgICAgICAg\nIC8vIGZ1bGwgY2xhc3MgbmFtZSBpbXBvcnQKICAgICAgICAgICAgICAgIGlm\nIChpbXBvcnROYW1lLmVuZHNXaXRoKGRvdE5hbWUpKQogICAgICAgICAgICAg\nICAgICAgIHR5cGUgPSB0b0NsYXNzKGltcG9ydE5hbWUpOwogICAgICAgICAg\nICAgICAgICAgIC8vIHdpbGRjYXJkOyBzdHJpcCB0byBwYWNrYWdlCiAgICAg\nICAgICAgICAgICBlbHNlIGlmIChpbXBvcnROYW1lLmVuZHNXaXRoKCIuKiIp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaW1wb3J0TmFtZSA9IGltcG9ydE5h\nbWUuc3Vic3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICgwLCBpbXBv\ncnROYW1lLmxlbmd0aCgpIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgdHlw\nZSA9IHRvQ2xhc3MoaW1wb3J0TmFtZSArIG5hbWUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gdHlwZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUge0BsaW5rIENsYXNzfSBmb3IgdGhlIGdpdmVuIG5h\nbWUsIG9yIG51bGwgaWYgbmFtZSBub3QgdmFsaWQuCiAgICAgKi8KICAgIHBy\naXZhdGUgQ2xhc3MgdG9DbGFzcyhTdHJpbmcgbmFtZSkgewogICAgICAgIGlm\nIChfbG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIF9sb2FkZXIgPSBfYnJv\na2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRDbGFzc1Jlc29sdmVySW5zdGFu\nY2UoKS4KICAgICAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKF9jbGFzcywg\nX2Jyb2tlci5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gU3RyaW5ncy50b0NsYXNzKG5hbWUsIF9sb2FkZXIp\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICB9IGNhdGNoIChOb0NsYXNzRGVmRm91bmRFcnJvciBuY2RmZSkgewog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBhc3NlcnRPcGVuKCkgewogICAgICAgIGlmIChfYnJva2VyICE9\nIG51bGwpCiAgICAgICAgICAgIF9icm9rZXIuYXNzZXJ0T3BlbigpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydE5vdFJlYWRPbmx5KCkgewogICAg\nICAgIGlmIChfcmVhZE9ubHkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlYWQtb25seSIpKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb3RTZXJpYWxpemVkKCkgewog\nICAgICAgIGlmIChfYnJva2VyID09IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInNlcmlhbGl6\nZWQiKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0aGF0IGEgY2Fu\nZGlkYXRlIGNsYXNzIGhhcyBiZWVuIHNldCBmb3IgdGhlIHF1ZXJ5LgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0Q2FuZGlkYXRlVHlwZSgpIHsK\nICAgICAgICBpZiAoX2NsYXNzID09IG51bGwgJiYgX3N0b3JlUXVlcnkucmVx\ndWlyZXNDYW5kaWRhdGVUeXBlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWNsYXNzIikpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgdGhhdCB3ZSBhcmUgaW4gYSBz\ndGF0ZSB0byBiZSBhYmxlIHRvIHBlcmZvcm0gYSBidWxrIG9wZXJhdGlvbjsK\nICAgICAqIGFsc28gZmx1c2ggdGhlIGN1cnJlbnQgbW9kZmljYXRpb25zIGlm\nIGFueSBlbGVtZW50cyBhcmUgY3VycmVudGx5IGRpcnR5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYXNzZXJ0QnVsa01vZGlmeShTdG9yZVF1ZXJ5IHEs\nIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIAogICAgICAgIE9iamVjdFtdIHBh\ncmFtcykgewogICAgICAgIF9icm9rZXIuYXNzZXJ0QWN0aXZlVHJhbnNhY3Rp\nb24oKTsKICAgICAgICBpZiAoX3N0YXJ0SWR4ICE9IDAgfHwgX2VuZElkeCAh\nPSBMb25nLk1BWF9WQUxVRSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLW1vZGlmeS1yYW5nZSIpKTsKICAgICAg\nICBpZiAoX3Jlc3VsdENsYXNzICE9IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tb2RpZnktcmVzdWx0\nY2xhc3MiKSk7CiAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSA9IG5l\ndyBTdG9yZVF1ZXJ5LlJhbmdlKCk7CiAgICAgICAgZXguZ2V0UmFuZ2UocSwg\ncGFyYW1zLCByYW5nZSk7CiAgICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IDAg\nfHwgcmFuZ2UuZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbW9kaWZ5LXJh\nbmdlIikpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2tzIHRoYXQgdGhl\nIHBhc3NlZCBwYXJhbWV0ZXJzIG1hdGNoIHRoZSBkZWNsYXJhdGlvbnMuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFzc2VydFBhcmFtZXRlcnMoU3Rv\ncmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4LCAKICAgICAgICBP\nYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICBpZiAoIXEucmVxdWlyZXNQYXJh\nbWV0ZXJEZWNsYXJhdGlvbnMoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBMaW5rZWRNYXAgcGFyYW1UeXBlcyA9IGV4LmdldFBhcmFtZXRlclR5\ncGVzKHEpOwogICAgICAgIGludCB0eXBlQ291bnQgPSBwYXJhbVR5cGVzLnNp\nemUoKTsKICAgICAgICBpZiAodHlwZUNvdW50ID4gcGFyYW1zLmxlbmd0aCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nInVuYm91bmQtcGFyYW1zIiwKICAgICAgICAgICAgICAgIHBhcmFtVHlwZXMu\na2V5U2V0KCkpKTsKCiAgICAgICAgSXRlcmF0b3IgaXRyID0gcGFyYW1UeXBl\ncy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgTWFwLkVudHJ5IGVu\ndHJ5OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpdHIuaGFzTmV4dCgpOyBp\nKyspIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4\ndCgpOwogICAgICAgICAgICBpZiAoKChDbGFzcykgZW50cnkuZ2V0VmFsdWUo\nKSkuaXNQcmltaXRpdmUoKSAmJiBwYXJhbXNbaV0gPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\ndWxsLXByaW1pdGl2ZS1wYXJhbSIsCiAgICAgICAgICAgICAgICAgICAgZW50\ncnkuZ2V0S2V5KCkpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0\ncmluZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0g\nbmV3IFN0cmluZ0J1ZmZlcig2NCk7CiAgICAgICAgYnVmLmFwcGVuZCgiUXVl\ncnk6ICIpLmFwcGVuZChzdXBlci50b1N0cmluZygpKTsKICAgICAgICBidWYu\nYXBwZW5kKCI7IGNhbmRpZGF0ZSBjbGFzczogIikuYXBwZW5kKF9jbGFzcyk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiOyBxdWVyeTogIikuYXBwZW5kKF9xdWVy\neSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAg\nIC8qKgogICAgICogU3RydWN0IG9mIGNvbXBpbGVkIHF1ZXJ5IHByb3BlcnRp\nZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgQ29tcGls\nYXRpb24KICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAg\nICAgIHB1YmxpYyBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIG1lbW9yeSA9IG51bGw7\nCiAgICAgICAgcHVibGljIFN0b3JlUXVlcnkuRXhlY3V0b3IgZGF0YXN0b3Jl\nID0gbnVsbDsKICAgICAgICBwdWJsaWMgT2JqZWN0IHN0b3JlRGF0YSA9IG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJ1Y3QgdG8gaG9sZCB0aGUg\ndW5wYXJzZWQgcHJvcGVydGllcyBhc3NvY2lhdGVkIHdpdGggYSBxdWVyeS4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ29tcGlsYXRpb25L\nZXkKICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAg\nIHB1YmxpYyBDbGFzcyBxdWVyeVR5cGUgPSBudWxsOwogICAgICAgIHB1Ymxp\nYyBDbGFzcyBjYW5kaWRhdGVUeXBlID0gbnVsbDsKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBzdWJjbGFzc2VzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgU3Ry\naW5nIHF1ZXJ5ID0gbnVsbDsKICAgICAgICBwdWJsaWMgU3RyaW5nIGxhbmd1\nYWdlID0gbnVsbDsKICAgICAgICBwdWJsaWMgT2JqZWN0IHN0b3JlS2V5ID0g\nbnVsbDsKCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAg\nICAgICAgaW50IHJzID0gMTc7CiAgICAgICAgICAgIHJzID0gMzcgKiBycyAr\nICgocXVlcnlUeXBlID09IG51bGwpID8gMCA6IHF1ZXJ5VHlwZS5oYXNoQ29k\nZSgpKTsKICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChxdWVyeSA9PSBu\ndWxsKSA/IDAgOiBxdWVyeS5oYXNoQ29kZSgpKTsKICAgICAgICAgICAgcnMg\nPSAzNyAqIHJzICsgKChsYW5ndWFnZSA9PSBudWxsKSA/IDAgOiBsYW5ndWFn\nZS5oYXNoQ29kZSgpKTsKICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChz\ndG9yZUtleSA9PSBudWxsKSA/IDAgOiBzdG9yZUtleS5oYXNoQ29kZSgpKTsK\nICAgICAgICAgICAgaWYgKHN1YmNsYXNzZXMpCiAgICAgICAgICAgICAgcnMr\nKzsKICAgICAgICAgICAgcmV0dXJuIHJzOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAg\nICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgICAgICBpZiAob3RoZXIgPT0gbnVsbCB8fCBvdGhl\nci5nZXRDbGFzcygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgICAgICBDb21waWxhdGlvbktleSBrZXkg\nPSAoQ29tcGlsYXRpb25LZXkpIG90aGVyOwogICAgICAgICAgICBpZiAoa2V5\nLnF1ZXJ5VHlwZSAhPSBxdWVyeVR5cGUKICAgICAgICAgICAgICAgIHx8ICFT\ndHJpbmdVdGlscy5lcXVhbHMoa2V5LnF1ZXJ5LCBxdWVyeSkKICAgICAgICAg\nICAgICAgIHx8ICFTdHJpbmdVdGlscy5lcXVhbHMoa2V5Lmxhbmd1YWdlLCBs\nYW5ndWFnZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgIGlmIChrZXkuc3ViY2xhc3NlcyAhPSBzdWJjbGFzc2VzKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoIU9i\namVjdFV0aWxzLmVxdWFscyhrZXkuc3RvcmVLZXksIHN0b3JlS2V5KSkKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIGFs\nbG93IGVpdGhlciBjYW5kaWRhdGUgdHlwZSB0byBiZSBudWxsIGJlY2F1c2Ug\naXQgbWlnaHQgYmUKICAgICAgICAgICAgLy8gZW5jb2RlZCBpbiB0aGUgcXVl\ncnkgc3RyaW5nLCBidXQgaWYgYm90aCBhcmUgc2V0IHRoZW4gdGhleQogICAg\nICAgICAgICAvLyBtdXN0IGJlIGVxdWFsCiAgICAgICAgICAgIHJldHVybiBr\nZXkuY2FuZGlkYXRlVHlwZSA9PSBudWxsIHx8IGNhbmRpZGF0ZVR5cGUgPT0g\nbnVsbAogICAgICAgICAgICAgICAgfHwga2V5LmNhbmRpZGF0ZVR5cGUgPT0g\nY2FuZGlkYXRlVHlwZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBIG1lcmdlZCBleGVjdXRvciBleGVjdXRlcyBtdWx0aXBsZSBRdWVyaWVz\nIGFuZCByZXR1cm5zCiAgICAgKiBhIG1lcmdlZCByZXN1bHQgbGlzdCB3aXRo\nIHRoZSBhcHByb3ByaWF0ZSBvcmRlcmluZyAoaWYgbW9yZSB0aGFuCiAgICAg\nKiBvbmUgcXVlcnkgbmVlZHMgdG8gYmUgZXhlY3V0ZWQpLiBUaGlzIGV4ZWN1\ndG9yIGhhcyB0aGUgZm9sbG93aW5nCiAgICAgKiBsaW1pdGF0aW9uczoKICAg\nICAqIDx1bD4KICAgICAqIDxsaT5JdCBjYW5ub3QgY29tYmluZSBhZ2dyZWdh\ndGVzLgogICAgICogPGxpPkl0IGNhbm5vdCBjb2xsYXRlIHRoZSByZXN1bHQg\nbGlzdHMgaWYgb3JkZXJpbmcgaXMgc3BlY2lmaWVkIGFuZAogICAgICogYSBy\nZXN1bHQgc3RyaW5nIGlzIGdpdmVuLCBidXQgZG9lcyBub3QgaW5jbHVkZSB0\naGUgb3JkZXJpbmcKICAgICAqIGNyaXRlcmlhLjwvbGk+CiAgICAgKiA8bGk+\nSXQgY2Fubm90IGZpbHRlciBkdXBsaWNhdGUgcmVzdWx0cyBmcm9tIGRpZmZl\ncmVudCByZXN1bHQgbGlzdHMgaWYKICAgICAqIHRoZSByZXN1bHQgaXMgbWFy\na2VkIGRpc3RpbmN0LiBUaGlzIHdvdWxkIHJlcXVpcmUgdHJhY2tpbmcgYWxs\nCiAgICAgKiBwcmV2aW91cyByZXN1bHRzLCB3aGljaCB3b3VsZCBpbnRlcmZl\ncmUgd2l0aCBsYXJnZSByZXN1bHQgc2V0CiAgICAgKiBoYW5kbGluZy48L2xp\nPgogICAgICogPC91bD4KICAgICAqCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1\nZCdob21tZWF1eAogICAgICogQG5vamF2YWRvYwogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBjbGFzcyBNZXJnZWRFeGVjdXRvcgogICAgICAgIGltcGxl\nbWVudHMgU3RvcmVRdWVyeS5FeGVjdXRvciB7CgogICAgICAgIHByaXZhdGUg\nZmluYWwgU3RvcmVRdWVyeS5FeGVjdXRvcltdIF9leGVjdXRvcnM7CgogICAg\nICAgIHB1YmxpYyBNZXJnZWRFeGVjdXRvcihTdG9yZVF1ZXJ5LkV4ZWN1dG9y\nW10gZXhlY3V0b3JzKSB7CiAgICAgICAgICAgIF9leGVjdXRvcnMgPSBleGVj\ndXRvcnM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUmVzdWx0T2JqZWN0\nUHJvdmlkZXIgZXhlY3V0ZVF1ZXJ5KFN0b3JlUXVlcnkgcSwKICAgICAgICAg\nICAgT2JqZWN0W10gcGFyYW1zLCBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKSB7\nCiAgICAgICAgICAgIGlmIChfZXhlY3V0b3JzLmxlbmd0aCA9PSAxKQogICAg\nICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZXhlY3V0ZVF1ZXJ5\nKHEsIHBhcmFtcywgcmFuZ2UpOwoKICAgICAgICAgICAgLy8gdXNlIGxycyBz\nZXR0aW5ncyBpZiB3ZSBjb3VsZG4ndCB0YWtlIGFkdmFudGFnZSBvZiB0aGUg\nc3RhcnQgaW5kZXgKICAgICAgICAgICAgLy8gc28gdGhhdCBob3BlZnVsbHkg\ndGhlIHNraXAgdG8gdGhlIHN0YXJ0IHdpbGwgYmUgZWZmaWNpZW50CiAgICAg\nICAgICAgIFN0b3JlUXVlcnkuUmFuZ2Ugcm9wUmFuZ2UgPSBuZXcgU3RvcmVR\ndWVyeS5SYW5nZSgwLCByYW5nZS5lbmQpOwogICAgICAgICAgICByb3BSYW5n\nZS5scnMgPSByYW5nZS5scnMgfHwgKHJhbmdlLnN0YXJ0ID4gMCAmJiBxLmdl\ndENvbnRleHQoKS4KICAgICAgICAgICAgICAgIGdldEZldGNoQ29uZmlndXJh\ndGlvbigpLmdldEZldGNoQmF0Y2hTaXplKCkgPj0gMCk7CgogICAgICAgICAg\nICAvLyBleGVjdXRlIHRoZSBxdWVyeTsgd2UgY2Fubm90IHVzZSB0aGUgbG93\nZXIgYm91bmQgb2YgdGhlIHJlc3VsdAogICAgICAgICAgICAvLyByYW5nZSwg\nYnV0IHdlIGNhbiB0YWtlIGFkdmFudGFnZSBvZiB0aGUgdXBwZXIgYm91bmQK\nICAgICAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0KICAg\nICAgICAgICAgICAgIG5ldyBSZXN1bHRPYmplY3RQcm92aWRlcltfZXhlY3V0\nb3JzLmxlbmd0aF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIHJvcHNb\naV0gPSBfZXhlY3V0b3JzW2ldLmV4ZWN1dGVRdWVyeShxLCBwYXJhbXMsIHJv\ncFJhbmdlKTsKCiAgICAgICAgICAgIGJvb2xlYW5bXSBhc2MgPSBfZXhlY3V0\nb3JzWzBdLmdldEFzY2VuZGluZyhxKTsKICAgICAgICAgICAgUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIgcm9wOwogICAgICAgICAgICBpZiAoYXNjLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICAgICAgcm9wID0gbmV3IE1lcmdlZFJlc3VsdE9i\namVjdFByb3ZpZGVyKHJvcHMpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICByb3AgPSBuZXcgT3JkZXJpbmdNZXJnZWRSZXN1bHRPYmplY3RQ\ncm92aWRlcihyb3BzLCBhc2MsCiAgICAgICAgICAgICAgICAgICAgX2V4ZWN1\ndG9ycywgcSwgcGFyYW1zKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlz\nIGEgbG93ZXIgYm91bmQsIHdyYXAgaW4gcmFuZ2Ugcm9wCiAgICAgICAgICAg\nIGlmIChyYW5nZS5zdGFydCAhPSAwKQogICAgICAgICAgICAgICAgcm9wID0g\nbmV3IFJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wLCByYW5nZS5zdGFy\ndCwgCiAgICAgICAgICAgICAgICAgICAgcmFuZ2UuZW5kKTsKICAgICAgICAg\nICAgcmV0dXJuIHJvcDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOdW1i\nZXIgZXhlY3V0ZURlbGV0ZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFt\ncykgewogICAgICAgICAgICBsb25nIG51bSA9IDA7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgIG51bSArPSBfZXhlY3V0b3JzW2ldLmV4ZWN1dGVEZWxl\ndGUocSwgcGFyYW1zKS5sb25nVmFsdWUoKTsKICAgICAgICAgICAgcmV0dXJu\nIE51bWJlcnMudmFsdWVPZihudW0pOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIE51bWJlciBleGVjdXRlVXBkYXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgICAgIGxvbmcgbnVtID0gMDsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgbnVtICs9IF9leGVjdXRvcnNbaV0uZXhl\nY3V0ZVVwZGF0ZShxLCBwYXJhbXMpLmxvbmdWYWx1ZSgpOwogICAgICAgICAg\nICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKG51bSk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhTdG9y\nZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgU3RvcmVR\ndWVyeS5SYW5nZSByYW5nZSkgewogICAgICAgICAgICBpZiAoX2V4ZWN1dG9y\ncy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiBfZXhlY3V0\nb3JzWzBdLmdldERhdGFTdG9yZUFjdGlvbnMocSwgcGFyYW1zLCByYW5nZSk7\nCgogICAgICAgICAgICBMaXN0IHJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0KF9l\neGVjdXRvcnMubGVuZ3RoKTsKICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5n\nZSByb3BSYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdlKDBMLCByYW5nZS5l\nbmQpOwogICAgICAgICAgICBTdHJpbmdbXSBhY3Rpb25zOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGFjdGlvbnMgPSBfZXhlY3V0b3JzW2ldLmdl\ndERhdGFTdG9yZUFjdGlvbnMocSwgcGFyYW1zLHJvcFJhbmdlKTsKICAgICAg\nICAgICAgICAgIGlmIChhY3Rpb25zICE9IG51bGwgJiYgYWN0aW9ucy5sZW5n\ndGggPiAwKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYWRkQWxsKEFy\ncmF5cy5hc0xpc3QoYWN0aW9ucykpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybiAoU3RyaW5nW10pIHJlc3VsdHMudG9BcnJheShuZXcgU3Ry\naW5nW3Jlc3VsdHMuc2l6ZSgpXSk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCB2YWxpZGF0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAg\nX2V4ZWN1dG9yc1swXS52YWxpZGF0ZShxKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGdldFJhbmdlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10g\ncGFyYW1zLCAKICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkg\newogICAgICAgICAgICBfZXhlY3V0b3JzWzBdLmdldFJhbmdlKHEsIHBhcmFt\ncywgcmFuZ2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBn\nZXRPcmRlcmluZ1ZhbHVlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1z\nLAogICAgICAgICAgICBPYmplY3QgcmVzdWx0T2JqZWN0LCBpbnQgaWR4KSB7\nCiAgICAgICAgICAgIC8vIHVuZm9ydHVuYXRlbHksIGF0IHRoaXMgcG9pbnQg\nKG11c3QgYmUgYSBtZXJnZWQgcm9wIGNvbnRhaW5pbmcKICAgICAgICAgICAg\nLy8gb3RoZXIgbWVyZ2VkIHJvcHMpIHdlIGhhdmUgbm8gaWRlYSB3aGljaCBl\neGVjdXRvciB0byBleHRyYWN0CiAgICAgICAgICAgIC8vIHRoZSB2YWx1ZSBm\ncm9tCiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldE9yZGVy\naW5nVmFsdWUocSwgcGFyYW1zLCByZXN1bHRPYmplY3QsIGlkeCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbltdIGdldEFzY2VuZGluZyhT\ndG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNb\nMF0uZ2V0QXNjZW5kaW5nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFN0cmluZyBnZXRBbGlhcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0QWxpYXMocSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0UHJvamVjdGlvbkFsaWFzZXMo\nU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3Jz\nWzBdLmdldFByb2plY3Rpb25BbGlhc2VzKHEpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIENsYXNzIGdldFJlc3VsdENsYXNzKFN0b3JlUXVlcnkgcSkg\newogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRSZXN1bHRD\nbGFzcyhxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBDbGFzc1tdIGdl\ndFByb2plY3Rpb25UeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0UHJvamVjdGlvblR5cGVzKHEpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNQYWNraW5nKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1sw\nXS5pc1BhY2tpbmcocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ2xh\nc3NNZXRhRGF0YVtdIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIGlmIChfZXhlY3V0b3JzLmxlbmd0aCA9PSAx\nKQogICAgICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0QWNj\nZXNzUGF0aE1ldGFEYXRhcyhxKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBz\nZXQgb2YgYmFzZSBjbGFzcyBtZXRhZGF0YXMgaW4gYWNjZXNzIHBhdGgKICAg\nICAgICAgICAgTGlzdCBtZXRhcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIG1ldGFzID0gRmlsdGVycy5hZGRBY2Nlc3NQYXRoTWV0YURh\ndGFzKG1ldGFzLCBfZXhlY3V0b3JzW2ldLgogICAgICAgICAgICAgICAgICAg\nIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMocSkpOwogICAgICAgICAgICBpZiAo\nbWV0YXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBTdG9yZVF1\nZXJ5LkVNUFRZX01FVEFTOwogICAgICAgICAgICByZXR1cm4gKENsYXNzTWV0\nYURhdGFbXSkgbWV0YXMudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBD\nbGFzc01ldGFEYXRhW21ldGFzLnNpemUoKV0pOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaXNBZ2dyZWdhdGUoU3RvcmVRdWVyeSBxKSB7\nCiAgICAgICAgICAgIGlmICghX2V4ZWN1dG9yc1swXS5pc0FnZ3JlZ2F0ZShx\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAg\nIC8vIHdlIGNhbid0IG1lcmdlIGFnZ3JlZ2F0ZXMKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXJnZWQt\nYWdncmVnYXRlIiwKICAgICAgICAgICAgICAgIHEuZ2V0Q29udGV4dCgpLmdl\ndENhbmRpZGF0ZVR5cGUoKSwKICAgICAgICAgICAgICAgIHEuZ2V0Q29udGV4\ndCgpLmdldFF1ZXJ5U3RyaW5nKCkpKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgZ2V0T3BlcmF0aW9uKFN0b3JlUXVlcnkgcSkgewogICAgICAg\nICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRPcGVyYXRpb24ocSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNHcm91cGluZyhT\ndG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNb\nMF0uaGFzR3JvdXBpbmcocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nTGlua2VkTWFwIGdldFBhcmFtZXRlclR5cGVzKFN0b3JlUXVlcnkgcSkgewog\nICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRQYXJhbWV0ZXJU\neXBlcyhxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBNYXAgZ2V0VXBk\nYXRlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVj\ndXRvcnNbMF0uZ2V0VXBkYXRlcyhxKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXN1bHQgb2JqZWN0IHByb3ZpZGVyIHRoYXQgcGFja3Mg\ncmVzdWx0cyBiZWZvcmUgcmV0dXJuaW5nIHRoZW0uCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIFBhY2tpbmdSZXN1bHRPYmplY3RQcm92aWRl\ncgogICAgICAgIGltcGxlbWVudHMgUmVzdWx0T2JqZWN0UHJvdmlkZXIgewoK\nICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdE9iamVjdFByb3ZpZGVyIF9k\nZWxlZ2F0ZTsKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdFBhY2tlciBf\ncGFja2VyOwogICAgICAgIHByaXZhdGUgZmluYWwgaW50IF9sZW47CgogICAg\nICAgIHB1YmxpYyBQYWNraW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoUmVzdWx0\nT2JqZWN0UHJvdmlkZXIgZGVsZWdhdGUsCiAgICAgICAgICAgIFJlc3VsdFBh\nY2tlciBwYWNrZXIsIGludCByZXN1bHRMZW5ndGgpIHsKICAgICAgICAgICAg\nX2RlbGVnYXRlID0gZGVsZWdhdGU7CiAgICAgICAgICAgIF9wYWNrZXIgPSBw\nYWNrZXI7CiAgICAgICAgICAgIF9sZW4gPSByZXN1bHRMZW5ndGg7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFj\nY2VzcygpIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5zdXBwb3J0\nc1JhbmRvbUFjY2VzcygpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgb3BlbigpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBfZGVsZWdhdGUub3BlbigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIE9iamVjdCBnZXRSZXN1bHRPYmplY3QoKQogICAgICAgICAgICB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgT2JqZWN0IG9iID0gX2Rl\nbGVnYXRlLmdldFJlc3VsdE9iamVjdCgpOwogICAgICAgICAgICBpZiAoX3Bh\nY2tlciA9PSBudWxsICYmIF9sZW4gPT0gMSkKICAgICAgICAgICAgICAgIHJl\ndHVybiAoKE9iamVjdFtdKSBvYilbMF07CiAgICAgICAgICAgIGlmIChfcGFj\na2VyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gb2I7CiAgICAg\nICAgICAgIGlmIChfbGVuID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4g\nX3BhY2tlci5wYWNrKG9iKTsKICAgICAgICAgICAgcmV0dXJuIF9wYWNrZXIu\ncGFjaygoT2JqZWN0W10pIG9iKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIG5leHQoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5uZXh0KCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhYnNvbHV0ZShpbnQgcG9z\nKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIF9kZWxlZ2F0ZS5hYnNvbHV0ZShwb3MpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBzaXplKCkKICAgICAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBfZGVsZWdhdGUuc2l6ZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVzZXQoKQogICAg\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgX2RlbGVn\nYXRlLnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBj\nbG9zZSgpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBfZGVsZWdhdGUuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGhhbmRsZUNoZWNrZWRFeGNlcHRpb24oRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgX2RlbGVnYXRlLmhhbmRsZUNoZWNrZWRFeGNlcHRp\nb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVzdWx0\nIGxpc3QgdGhhdCByZW1vdmVzIGl0c2VsZiBmcm9tIHRoZSBxdWVyeSdzIG9w\nZW4gcmVzdWx0IGxpc3QKICAgICAqIHdoZW4gaXQgaXMgY2xvc2VkLiBQdWJs\naWMgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBjbGFzcyBSZW1v\ndmVPbkNsb3NlUmVzdWx0TGlzdAogICAgICAgIGltcGxlbWVudHMgUmVzdWx0\nTGlzdCB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0TGlzdCBfcmVz\nOwoKICAgICAgICBwdWJsaWMgUmVtb3ZlT25DbG9zZVJlc3VsdExpc3QoUmVz\ndWx0TGlzdCByZXMpIHsKICAgICAgICAgICAgX3JlcyA9IHJlczsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBSZXN1bHRMaXN0IGdldERlbGVnYXRlKCkg\newogICAgICAgICAgICByZXR1cm4gX3JlczsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIGlzUHJvdmlkZXJPcGVuKCkgewogICAgICAgICAg\nICByZXR1cm4gX3Jlcy5pc1Byb3ZpZGVyT3BlbigpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gaXNDbG9zZWQoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfcmVzLmlzQ2xvc2VkKCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICAgICAgY2xvc2UodHJ1ZSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZShib29sZWFu\nIHJlbW92ZSkgewogICAgICAgICAgICBpZiAoaXNDbG9zZWQoKSkKICAgICAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIF9yZXMuY2xvc2UoKTsK\nICAgICAgICAgICAgaWYgKCFyZW1vdmUpCiAgICAgICAgICAgICAgICByZXR1\ncm47CgogICAgICAgICAgICBsb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAvLyBkb24ndCB1c2Ugc3RhbmRhcmQgX3Jlc3VsdExp\nc3RzLnJlbW92ZSBtZXRob2QgYi9jIHJlbGllcyBvbgogICAgICAgICAgICAg\nICAgLy8gY29sbGVjdGlvbiBlcXVhbGl0eSwgd2hpY2ggcmVsaWVzIG9uIGVs\nZW1lbnQgZXF1YWxpdHksIHdoaWNoCiAgICAgICAgICAgICAgICAvLyBtZWFu\ncyB3ZSBlbmQgdXAgdHJhdmVyc2luZyBlbnRpcmUgcmVzdWx0IGxpc3RzIQog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfcmVzdWx0TGlz\ndHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXRyLm5leHQoKSA9PSB0aGlzKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMu\nc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNF\nbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuaXNFbXB0eSgpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2Jq\nZWN0IG8pIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuY29udGFpbnMobyk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSXRlcmF0b3IgaXRlcmF0b3Io\nKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLml0ZXJhdG9yKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9yZXMudG9BcnJheSgpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE9iamVjdFtdIHRvQXJyYXkoT2JqZWN0W10gYSkgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy50b0FycmF5KGEpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkKE9iamVjdCBvKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcmVzLmFkZChvKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZShPYmplY3QgbykgewogICAgICAgICAg\nICByZXR1cm4gX3Jlcy5yZW1vdmUobyk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBjb250YWluc0FsbChDb2xsZWN0aW9uIGMpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9yZXMuY29udGFpbnNBbGwoYyk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGRBbGwoQ29sbGVjdGlvbiBj\nKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmFkZEFsbChjKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChpbnQgaWR4LCBD\nb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuYWRkQWxs\nKGlkeCwgYyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBy\nZW1vdmVBbGwoQ29sbGVjdGlvbiBjKSB7CiAgICAgICAgICAgIHJldHVybiBf\ncmVzLnJlbW92ZUFsbChjKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9yZXMucmV0YWluQWxsKGMpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgICAgIF9yZXMuY2xlYXIo\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGludCBp\nZHgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuZ2V0KGlkeCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHNldChpbnQgaWR4LCBPYmpl\nY3QgbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5zZXQoaWR4LCBvKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGFkZChpbnQgaWR4LCBP\nYmplY3QgbykgewogICAgICAgICAgICBfcmVzLmFkZChpZHgsIG8pOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCByZW1vdmUoaW50IGlkeCkg\newogICAgICAgICAgICByZXR1cm4gX3Jlcy5yZW1vdmUoaWR4KTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBpbnQgaW5kZXhPZihPYmplY3Qgbykgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5pbmRleE9mKG8pOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBsYXN0SW5kZXhPZihPYmplY3Qgbykgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5sYXN0SW5kZXhPZihvKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBMaXN0SXRlcmF0b3IgbGlzdEl0ZXJhdG9y\nKCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5saXN0SXRlcmF0b3IoKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBMaXN0SXRlcmF0b3IgbGlzdEl0\nZXJhdG9yKGludCBpZHgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMubGlz\ndEl0ZXJhdG9yKGlkeCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTGlz\ndCBzdWJMaXN0KGludCBzdGFydCwgaW50IGVuZCkgewogICAgICAgICAgICBy\nZXR1cm4gX3Jlcy5zdWJMaXN0KHN0YXJ0LCBlbmQpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcmVzLmVxdWFscyhvKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcmVzLmhhc2hDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIHRvU3RyaW5nICgpCgkJewoJCQlyZXR1cm4gX3Jlcy50b1N0cmlu\nZyAoKTsKCQl9CgoJCXB1YmxpYyBPYmplY3Qgd3JpdGVSZXBsYWNlICgpCgkJ\newoJCQlyZXR1cm4gX3JlczsKCQl9Cgl9Cn0K\n","encoding":"base64"}

