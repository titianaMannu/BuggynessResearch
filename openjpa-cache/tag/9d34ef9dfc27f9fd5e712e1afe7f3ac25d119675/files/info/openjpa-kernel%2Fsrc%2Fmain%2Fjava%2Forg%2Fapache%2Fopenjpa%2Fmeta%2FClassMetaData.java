{"sha":"94c52263689ffeda3e6c1297361cbcf3082ebaed","node_id":"MDQ6QmxvYjIwNjM2NDo5NGM1MjI2MzY4OWZmZWRhM2U2YzEyOTczNjFjYmNmMzA4MmViYWVk","size":88258,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/94c52263689ffeda3e6c1297361cbcf3082ebaed","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5BYnN0cmFjdERhdGFDYWNoZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3Ry\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNv\nbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmNvbmYuVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmNvbmYuVmFsdWVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbWV0YS5Tb3VyY2VUcmFja2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi54bWwuQ29tbWVudGFibGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5CaWdEZWNpbWFsSWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5CaWdJbnRlZ2VySWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5CeXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5DaGFySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5EYXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Eb3Vi\nbGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50SWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0SWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TaG9ydElkOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RyaW5nSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBz\nZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBDb250YWlucyBtZXRhZGF0YSBh\nYm91dCBhIHBlcnNpc3RlbnQgdHlwZS4KICogVGhpcyBtZXRhZGF0YSBpcyBh\ndmFpbGFibGUgYm90aCBhdCBlbmhhbmNlbWVudCB0aW1lIGFuZCBydW50aW1l\nLgogKiAgTm90ZSB0aGF0IHRoaXMgY2xhc3MgZW1wbG95cyBhZ2dyZXNzaXZl\nIGNhY2hpbmcsIGFuZCB0aGVyZWZvcmUgaXQgaXMKICogaW1wb3J0YW50IHRv\nIGZpbmFsaXplIHRoZSBjb25maWd1cmF0aW9uIG9mIGZpZWxkIG1ldGFkYXRh\ncyBiZWZvcmUgaW52b2tpbmcKICogbWV0aG9kcyB0aGF0IGRlcGVuZCBvbiB0\naGF0IGNvbmZpZ3VyYXRpb24sIHN1Y2ggYXMKICoge0BsaW5rICNnZXRQcmlt\nYXJ5S2V5RmllbGRzfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1\nYmxpYyBjbGFzcyBDbGFzc01ldGFEYXRhCiAgICBleHRlbmRzIEV4dGVuc2lv\nbnMKICAgIGltcGxlbWVudHMgQ29tcGFyYWJsZSwgU291cmNlVHJhY2tlciwg\nTWV0YURhdGFDb250ZXh0LCBNZXRhRGF0YU1vZGVzLAogICAgQ29tbWVudGFi\nbGUsIFZhbHVlTGlzdGVuZXIgewoKICAgIC8qKgogICAgICogVW5rb253biBp\nZGVudGl0eSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBJRF9VTktOT1dOID0gMDsKCiAgICAvKioKICAgICAqIERhdGFzdG9y\nZSBpZGVudGl0eSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBJRF9EQVRBU1RPUkUgPSAxOwoKICAgIC8qKgogICAgICogQXBw\nbGljYXRpb24gaWRlbnRpdHkgdHlwZS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgSURfQVBQTElDQVRJT04gPSAyOwoKICAgIC8qKgog\nICAgICogVW5rbm93biBhY2Nlc3MgdHlwZS4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgQUNDRVNTX1VOS05PV04gPSAwOwoKICAgIC8q\nKgogICAgICogUGVyc2lzdGVudCBhdHRyaWJ1dGVzIGFyZSBhY2Nlc3NlZCB2\naWEgZGlyZWN0IGZpZWxkIGFjY2Vzcy4gQml0IGZsYWcuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFDQ0VTU19GSUVMRCA9IDIgPDwg\nMDsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBhcmUg\nYWNjZXNzZWQgdmlhIHNldHRlcnMgYW5kIGdldHRlcnMuIEJpdCBmbGFnLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1NfUFJP\nUEVSVFkgPSAyIDw8IDE7CgogICAgLyoqCiAgICAgKiBWYWx1ZSBmb3IgdXNp\nbmcgYSBzeW50aGV0aWMgZGV0YWNoZWQgc3RhdGUgZmllbGQsIHdoaWNoIGlz\nIHRoZSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIFN0cmluZyBTWU5USEVUSUMgPSAiYHN5biI7CgogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgREVGQVVMVF9TVFJJTkcgPSAiYCI7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6\nZXIuZm9yUGFja2FnZQogICAgICAgIChDbGFzc01ldGFEYXRhLmNsYXNzKTsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBGZXRjaEdyb3VwW10gRU1QVFlf\nRkVUQ0hfR1JPVVBfQVJSQVkKICAgICAgICA9IG5ldyBGZXRjaEdyb3VwWzBd\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nW10gRU1QVFlfU1RS\nSU5HX0FSUkFZID0gbmV3IFN0cmluZ1swXTsKCiAgICBwcml2YXRlIE1ldGFE\nYXRhUmVwb3NpdG9yeSBfcmVwb3M7CiAgICBwcml2YXRlIHRyYW5zaWVudCBD\nbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsKCiAgICBwcml2YXRlIGZpbmFs\nIFZhbHVlTWV0YURhdGEgX293bmVyOwogICAgcHJpdmF0ZSBmaW5hbCBMaWZl\nY3ljbGVNZXRhRGF0YSBfbGlmZU1ldGEgPSBuZXcgTGlmZWN5Y2xlTWV0YURh\ndGEodGhpcyk7CiAgICBwcml2YXRlIEZpbGUgX3NyY0ZpbGUgPSBudWxsOwog\nICAgcHJpdmF0ZSBpbnQgX3NyY1R5cGUgPSBTUkNfT1RIRVI7CiAgICBwcml2\nYXRlIGludCBfbGluZU51bSA9IDA7ICAKICAgIHByaXZhdGUgaW50IF9jb2xO\ndW0gPSAwOyAgCiAgICBwcml2YXRlIFN0cmluZ1tdIF9jb21tZW50cyA9IG51\nbGw7CiAgICBwcml2YXRlIGludCBfbGlzdEluZGV4ID0gLTE7CiAgICBwcml2\nYXRlIGludCBfc3JjTW9kZSA9IE1PREVfTUVUQSB8IE1PREVfTUFQUElORzsK\nICAgIHByaXZhdGUgaW50IF9yZXNNb2RlID0gTU9ERV9OT05FOwoKICAgIHBy\naXZhdGUgQ2xhc3MgX3R5cGUgPSBPYmplY3QuY2xhc3M7CiAgICBwcml2YXRl\nIGZpbmFsIE1hcCBfZmllbGRNYXAgPSBuZXcgVHJlZU1hcCgpOwogICAgcHJp\ndmF0ZSBNYXAgX3N1cEZpZWxkTWFwID0gbnVsbDsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfZGVmU3VwRmllbGRzID0gZmFsc2U7CiAgICBwcml2YXRlIENvbGxl\nY3Rpb24gX3N0YXRpY0ZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIGludFtd\nIF9maWVsZERhdGFUYWJsZSA9IG51bGw7CiAgICBwcml2YXRlIE1hcCBfZmdN\nYXAgPSBudWxsOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAv\nLyBOb3RlOiBpZiB5b3UgYWRkIGFkZGl0aW9uYWwgc3RhdGUsIG1ha2Ugc3Vy\nZSB0byBhZGQgaXQgdG8gY29weSgpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHByaXZhdGUgQ2xhc3MgX29iamVjdElkID0gbnVsbDsKICAg\nIHByaXZhdGUgQm9vbGVhbiBfb2JqZWN0SWRTaGFyZWQgPSBudWxsOwogICAg\ncHJpdmF0ZSBCb29sZWFuIF9vcGVuanBhSWQgPSBudWxsOwogICAgcHJpdmF0\nZSBCb29sZWFuIF9leHRlbnQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFu\nIF9lbWJlZGRlZCA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX2ludGVy\nZmFjZSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzIF9pbXBsID0gbnVsbDsK\nICAgIHByaXZhdGUgTGlzdCBfaW50ZXJmYWNlcyA9IG51bGw7CiAgICBwcml2\nYXRlIGZpbmFsIE1hcCBfaWZhY2VNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAg\ncHJpdmF0ZSBpbnQgX2lkZW50aXR5ID0gSURfVU5LTk9XTjsKICAgIHByaXZh\ndGUgaW50IF9pZFN0cmF0ZWd5ID0gVmFsdWVTdHJhdGVnaWVzLk5PTkU7CiAg\nICBwcml2YXRlIGludCBfYWNjZXNzVHlwZSA9IEFDQ0VTU19VTktOT1dOOwoK\nICAgIHByaXZhdGUgU3RyaW5nIF9zZXFOYW1lID0gREVGQVVMVF9TVFJJTkc7\nCiAgICBwcml2YXRlIFNlcXVlbmNlTWV0YURhdGEgX3NlcU1ldGEgPSBudWxs\nOwogICAgcHJpdmF0ZSBTdHJpbmcgX2NhY2hlTmFtZSA9IERFRkFVTFRfU1RS\nSU5HOwogICAgcHJpdmF0ZSBpbnQgX2NhY2hlVGltZW91dCA9IEludGVnZXIu\nTUlOX1ZBTFVFOwogICAgcHJpdmF0ZSBCb29sZWFuIF9kZXRhY2hhYmxlID0g\nbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9kZXRhY2hTdGF0ZSA9IERFRkFV\nTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBTdHJpbmcgX2FsaWFzID0gbnVsbDsK\nICAgIHByaXZhdGUgaW50IF92ZXJzaW9uSWR4ID0gSW50ZWdlci5NSU5fVkFM\nVUU7CgogICAgcHJpdmF0ZSBDbGFzcyBfc3VwZXIgPSBudWxsOwogICAgcHJp\ndmF0ZSBDbGFzc01ldGFEYXRhIF9zdXBlck1ldGEgPSBudWxsOwogICAgcHJp\ndmF0ZSBDbGFzc1tdIF9zdWJzID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NN\nZXRhRGF0YVtdIF9zdWJNZXRhcyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNz\nTWV0YURhdGFbXSBfbWFwU3ViTWV0YXMgPSBudWxsOwoKICAgIHByaXZhdGUg\nRmllbGRNZXRhRGF0YVtdIF9maWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBG\naWVsZE1ldGFEYXRhW10gX3VubWdkRmllbGRzID0gbnVsbDsKICAgIHByaXZh\ndGUgRmllbGRNZXRhRGF0YVtdIF9hbGxGaWVsZHMgPSBudWxsOwogICAgcHJp\ndmF0ZSBGaWVsZE1ldGFEYXRhW10gX2FsbFBLRmllbGRzID0gbnVsbDsKICAg\nIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxERkdGaWVsZHMgPSBudWxs\nOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2RlZmluZWRGaWVsZHMg\nPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2xpc3RpbmdG\naWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2Fs\nbExpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGZXRjaEdyb3Vw\nW10gX2ZncyA9IG51bGw7CiAgICBwcml2YXRlIEZldGNoR3JvdXBbXSBfY3Vz\ndG9tRkdzID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaW50ZXJjZXB0\naW5nID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Fic3RyYWN0ID0g\nZmFsc2U7CiAgICBwcml2YXRlIEJvb2xlYW4gX2hhc0Fic3RyYWN0UEtGaWVs\nZCA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX2hhc1BLRmllbGRzRnJv\nbUFic3RyYWN0Q2xhc3MgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9p\nc0NhY2hlYWJsZSA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rv\nci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCByZXBvc2l0b3J5LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YShDbGFzcyB0eXBlLCBN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBfcmVwb3MgPSBy\nZXBvczsKICAgICAgICBfb3duZXIgPSBudWxsOwogICAgICAgIHNldERlc2Ny\naWJlZFR5cGUodHlwZSk7CiAgICAgICAgcmVnaXN0ZXJGb3JWYWx1ZVVwZGF0\nZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8qKgogICAgICog\nRW1iZWRkZWQgY29uc3RydWN0b3IuIFN1cHBseSBlbWJlZGRpbmcgdmFsdWUu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhKFZhbHVlTWV0\nYURhdGEgb3duZXIpIHsKICAgICAgICBfb3duZXIgPSBvd25lcjsKICAgICAg\nICBfcmVwb3MgPSBvd25lci5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgc2V0\nRW52Q2xhc3NMb2FkZXIob3duZXIuZ2V0RmllbGRNZXRhRGF0YSgpLmdldERl\nZmluaW5nTWV0YURhdGEoKS4KICAgICAgICAgICAgZ2V0RW52Q2xhc3NMb2Fk\nZXIoKSk7CiAgICAgICAgcmVnaXN0ZXJGb3JWYWx1ZVVwZGF0ZSgiRGF0YUNh\nY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGljIE1ldGFE\nYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCkgewogICAgICAgIHJldHVy\nbiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGlzIG1ldGFk\nYXRhIGlzIGZvciBhbiBlbWJlZGRlZCBvYmplY3QsIHJldHVybmluZyB0aGUg\nb3duaW5nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgVmFsdWVNZXRhRGF0\nYSBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX293\nbmVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNpc3RlbmNlIGNh\ncGFibGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRoaXMgbWV0YWRhdGEuCiAgICAg\nKi8KICAgIHB1YmxpYyBDbGFzcyBnZXREZXNjcmliZWRUeXBlKCkgewogICAg\nICAgIHJldHVybiBfdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgY2xhc3MgZGVzY2liZWQgYnkgdGhpcyBtZXRhZGF0YS4gVGhlIHR5cGUg\nbWF5IGJlIHJlc2V0IHdoZW4KICAgICAqIGFuIGVtYmVkZGVkIHZhbHVlIGNo\nYW5nZXMgaXRzIGRlY2xhcmVkIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHNldERlc2NyaWJlZFR5cGUoQ2xhc3MgdHlwZSkgewogICAgICAg\nIGlmICh0eXBlLmdldFN1cGVyY2xhc3MoKSAhPSBudWxsICYmICJqYXZhLmxh\nbmcuRW51bSIuZXF1YWxzCiAgICAgICAgICAgICh0eXBlLmdldFN1cGVyY2xh\nc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImVudW0iLCB0eXBlKSk7CiAgICAgICAg\nX3R5cGUgPSB0eXBlOwogICAgICAgIGlmIChQZXJzaXN0ZW5jZUNhcGFibGUu\nY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgc2V0\nSW50ZXJjZXB0aW5nKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIGVudmlyb25tZW50YWwgbG9hZGVyIHVzZWQgd2hlbiBsb2FkaW5nIHRoaXMg\nbWV0YWRhdGEuCiAgICAgKiBUaGUgY2xhc3MgbWV0YWRhdGEgc2hvdWxkIHVz\nZSB0aGlzIGxvYWRlciB3aGVuIGxvYWRpbmcgbWV0YWRhdGEgZm9yCiAgICAg\nKiBpdHMgc3VwZXJjbGFzcyBhbmQgZmllbGQgdHlwZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigpIHsKICAg\nICAgICByZXR1cm4gX2xvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBjbGFzcyBlbnZpcm9ubWVudGFsIGxvYWRlciB1c2VkIHdoZW4gbG9hZGlu\nZyB0aGlzIG1ldGFkYXRhLgogICAgICogVGhlIGNsYXNzIG1ldGFkYXRhIHNo\nb3VsZCB1c2UgdGhpcyBsb2FkZXIgd2hlbiBsb2FkaW5nIG1ldGFkYXRhIGZv\ncgogICAgICogaXRzIHN1cGVyY2xhc3MgYW5kIGZpZWxkIHR5cGVzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbnZDbGFzc0xvYWRlcihDbGFzc0xv\nYWRlciBsb2FkZXIpIHsKICAgICAgICBfbG9hZGVyID0gbG9hZGVyOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgc3Vw\nZXJjbGFzcyBvZiB0aGUgZGVzY3JpYmVkIHR5cGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBDbGFzcyBnZXRQQ1N1cGVyY2xhc3MoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdXBlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwZXJzaXN0ZW5j\nZSBjYXBhYmxlIHN1cGVyY2xhc3Mgb2YgdGhlIGRlc2NyaWJlZCB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQQ1N1cGVyY2xhc3MoQ2xhc3Mg\ncGMpIHsKICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBf\nc3VwZXIgPSBwYzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0\nYSBmb3IgdGhpcyBjbGFzcycgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHVi\nbGljIENsYXNzTWV0YURhdGEgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSB7\nCiAgICAgICAgaWYgKF9zdXBlck1ldGEgPT0gbnVsbCAmJiBfc3VwZXIgIT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX293bmVyICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIF9zdXBlck1ldGEgPSBfcmVwb3MubmV3RW1iZWRkZWRD\nbGFzc01ldGFEYXRhKF9vd25lcik7CiAgICAgICAgICAgICAgICBfc3VwZXJN\nZXRhLnNldERlc2NyaWJlZFR5cGUoX3N1cGVyKTsKICAgICAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgICAgICBfc3VwZXJNZXRhID0gX3JlcG9zLmdldE1l\ndGFEYXRhKF9zdXBlciwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfc3VwZXJNZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIG1ldGFkYXRhIGZvciB0aGlzIGNsYXNzJyBzdXBlcmNsYXNzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBjbGVhckFsbEZpZWxkQ2Fj\naGUoKTsKICAgICAgICBfc3VwZXJNZXRhID0gbWV0YTsKICAgICAgICBpZiAo\nbWV0YSAhPSBudWxsKQogICAgICAgICAgICBzZXRQQ1N1cGVyY2xhc3MobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGlzIGNsYXNzIGlzIG1hcHBlZCB0byB0aGUgZGF0YXN0b3Jl\nLiBCeSBkZWZhdWx0LCBvbmx5CiAgICAgKiByZXR1cm5zIGZhbHNlIGlmIGNs\nYXNzIGlzIGVtYmVkZGVkLW9ubHksIGJ1dCBzdWJjbGFzc2VzIG1pZ2h0IG92\nZXJyaWRlCiAgICAgKiB0byBhbGxvdyB1bm1hcHBlZCBvdGhlciB0eXBlcy4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNNYXBwZWQoKSB7CiAgICAg\nICAgcmV0dXJuIF9lbWJlZGRlZCAhPSBCb29sZWFuLlRSVUU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsb3Nlc3QgbWFwcGVkIHN1cGVy\nY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldE1h\ncHBlZFBDU3VwZXJjbGFzc01ldGFEYXRhKCkgewogICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAg\nICBpZiAoc3VwID09IG51bGwgfHwgc3VwLmlzTWFwcGVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBzdXA7CiAgICAgICAgcmV0dXJuIHN1cC5nZXRNYXBwZWRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBrbm93biBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1YmNsYXNz\nZXMgb2YgdGhlIGRlc2NyaWJlZCB0eXBlLAogICAgICogb3IgZW1wdHkgYXJy\nYXkgaWYgbm9uZSBvciBpZiB0aGlzIGlzIGVtYmVkZGVkIG1ldGFkYXRhLgog\nICAgICovCiAgICBwdWJsaWMgQ2xhc3NbXSBnZXRQQ1N1YmNsYXNzZXMoKSB7\nCiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gX3JlcG9zLkVNUFRZX0NMQVNTRVM7CgogICAgICAgIF9yZXBvcy5wcm9j\nZXNzUmVnaXN0ZXJlZENsYXNzZXMoX2xvYWRlcik7CiAgICAgICAgaWYgKF9z\ndWJzID09IG51bGwpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiBzdWJzID0g\nX3JlcG9zLmdldFBDU3ViY2xhc3NlcyhfdHlwZSk7CiAgICAgICAgICAgIF9z\ndWJzID0gKENsYXNzW10pIHN1YnMudG9BcnJheShuZXcgQ2xhc3Nbc3Vicy5z\naXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zdWJzOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhl\nIGtub3duIHBlcnNpc3RlbmNlIGNhcGFibGUgc3ViY2xhc3NlcyBvZgogICAg\nICogdGhlIGRlc2NyaWJlZCB0eXBlLCBvciBlbXB0eSBhcnJheSBpZiBub25l\nIG9yIGlmIHRoaXMgaXMgZW1iZWRkZWQKICAgICAqIG1ldGFkYXRhLgogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldFBDU3ViY2xhc3NN\nZXRhRGF0YXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX3JlcG9zLkVNUFRZX01FVEFTOwoKICAgICAgICBD\nbGFzc1tdIHN1YnMgPSBnZXRQQ1N1YmNsYXNzZXMoKTsgLy8gY2hlY2tzIGZv\nciBuZXcKICAgICAgICBpZiAoX3N1Yk1ldGFzID09IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICBf\nc3ViTWV0YXMgPSBfcmVwb3MuRU1QVFlfTUVUQVM7CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0g\nX3JlcG9zLm5ld0NsYXNzTWV0YURhdGFBcnJheQogICAgICAgICAgICAgICAg\nICAgIChzdWJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAg\nICAgbWV0YXNbaV0gPSBfcmVwb3MuZ2V0TWV0YURhdGEoc3Vic1tpXSwgX2xv\nYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBfc3ViTWV0YXMgPSBtZXRh\nczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX3N1\nYk1ldGFzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBtYXBw\nZWQgc3ViY2xhc3Nlcy4KICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURh\ndGFbXSBnZXRNYXBwZWRQQ1N1YmNsYXNzTWV0YURhdGFzKCkgewogICAgICAg\nIGlmIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9yZXBv\ncy5FTVBUWV9NRVRBUzsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIHN1YnMg\nPSBnZXRQQ1N1YmNsYXNzTWV0YURhdGFzKCk7IC8vIGNoZWNrcyBmb3IgbmV3\nCiAgICAgICAgaWYgKF9tYXBTdWJNZXRhcyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIGlmIChzdWJzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgX21h\ncFN1Yk1ldGFzID0gc3ViczsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgICAgICBMaXN0IG1hcHBlZCA9IG5ldyBBcnJheUxpc3Qoc3Vicy5sZW5n\ndGgpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdWJz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChzdWJzW2ld\nLmlzTWFwcGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZC5h\nZGQoc3Vic1tpXSk7CiAgICAgICAgICAgICAgICBfbWFwU3ViTWV0YXMgPSAo\nQ2xhc3NNZXRhRGF0YVtdKSBtYXBwZWQudG9BcnJheQogICAgICAgICAgICAg\nICAgICAgIChfcmVwb3MubmV3Q2xhc3NNZXRhRGF0YUFycmF5KG1hcHBlZC5z\naXplKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX21hcFN1Yk1ldGFzOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHR5\ncGUgb2YgaWRlbnRpdHkgYmVpbmcgdXNlZC4gVGhpcyB3aWxsIGJlIG9uZSBv\nZjoKICAgICAqIDx1bD4KICAgICAqIDxsaT57QGxpbmsgI0lEX1VOS05PV059\nOiB1bmtub3duIGlkZW50aXR5IHR5cGU8L2xpPgogICAgICogPGxpPntAbGlu\nayAjSURfREFUQVNUT1JFfTogaWRlbnRpdHkgbWFuYWdlZCBieSB0aGUgZGF0\nYSBzdG9yZSBhbmQKICAgICAqIGluZGVwZW5kZW50CW9mIHRoZSBmaWVsZHMg\nb2YgdGhlIGluc3RhbmNlPC9saT4KICAgICAqIDxsaT57QGxpbmsgI0lEX0FQ\nUExJQ0FUSU9OfTogaWRlbnRpdHkgbWFuYWdlZCBieSB0aGUgYXBwbGljYXRp\nb24gYW5kCiAgICAgKiBkZWZpbmVkIGJ5IG9uZSBvciBtb3JlIGZpZWxkcyBv\nZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICogPC91bD4gSWYgdW5zcGVjaWZp\nZWQsIGRlZmF1bHRzIHRvIHtAbGluayAjSURfREFUQVNUT1JFfSBpZiB0aGVy\nZSBhcmUgbm8KICAgICAqIHByaW1hcnkga2V5IGZpZWxkcywgYW5kIHtAbGlu\nayAjSURfQVBQTElDQVRJT059IG90aGVyd2lzZS4KICAgICAqLwogICAgcHVi\nbGljIGludCBnZXRJZGVudGl0eVR5cGUoKSB7CiAgICAgICAgaWYgKF9pZGVu\ndGl0eSA9PSBJRF9VTktOT1dOKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAg\nICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAh\nPSBJRF9VTktOT1dOKQogICAgICAgICAgICAgICAgX2lkZW50aXR5ID0gc3Vw\nLmdldElkZW50aXR5VHlwZSgpOwogICAgICAgICAgICBlbHNlIGlmIChnZXRQ\ncmltYXJ5S2V5RmllbGRzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAg\nIF9pZGVudGl0eSA9IElEX0FQUExJQ0FUSU9OOwogICAgICAgICAgICBlbHNl\nIGlmIChpc01hcHBlZCgpKQogICAgICAgICAgICAgICAgX2lkZW50aXR5ID0g\nSURfREFUQVNUT1JFOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfaWRlbnRpdHkgPSBfcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0\nRGVmYXVsdHMoKS4KICAgICAgICAgICAgICAgICAgICBnZXREZWZhdWx0SWRl\nbnRpdHlUeXBlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfaWRlbnRp\ndHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiBpZGVudGl0\neSBiZWluZyB1c2VkLiBUaGlzIHdpbGwgYmUgb25lIG9mOgogICAgICogPHVs\nPgogICAgICogPGxpPntAbGluayAjSURfVU5LTk9XTn06IHVua25vd24gaWRl\nbnRpdHkgdHlwZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9EQVRBU1RP\nUkV9OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBkYXRhIHN0b3JlIGFuZAog\nICAgICogaW5kZXBlbmRlbnQJb2YgdGhlIGZpZWxkcyBvZiB0aGUgaW5zdGFu\nY2U8L2xpPgogICAgICogPGxpPntAbGluayAjSURfQVBQTElDQVRJT059OiBp\nZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiBhbmQKICAgICAq\nIGRlZmluZWQgYnkgb25lIG9yIG1vcmUgZmllbGRzIG9mIHRoZSBpbnN0YW5j\nZTwvbGk+CiAgICAgKiA8L3VsPiBJZiB1bnNwZWNpZmllZCwgZGVmYXVsdHMg\ndG8ge0BsaW5rICNJRF9EQVRBU1RPUkV9IGlmIHRoZXJlIGFyZSBubwogICAg\nICogcHJpbWFyeSBrZXkgZmllbGRzLCBhbmQge0BsaW5rICNJRF9BUFBMSUNB\nVElPTn0gb3RoZXJ3aXNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJ\nZGVudGl0eVR5cGUoaW50IHR5cGUpIHsKICAgICAgICBfaWRlbnRpdHkgPSB0\neXBlOwogICAgICAgIGlmICh0eXBlICE9IElEX0FQUExJQ0FUSU9OKSB7CiAg\nICAgICAgICAgIF9vYmplY3RJZCA9IG51bGw7CiAgICAgICAgICAgIF9vcGVu\nanBhSWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBtZXRhZGF0YS1zcGVjaWZpZWQgY2xhc3MgdG8gdXNlIGZvciB0aGUg\nb2JqZWN0IElELgogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0T2JqZWN0\nSWRUeXBlKCkgewogICAgICAgIGlmIChfb2JqZWN0SWQgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIF9vYmplY3RJZDsKICAgICAgICBpZiAoZ2V0SWRl\nbnRpdHlUeXBlKCkgIT0gSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwg\nJiYgc3VwLmdldElkZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04pIHsKICAg\nICAgICAgICAgX29iamVjdElkID0gc3VwLmdldE9iamVjdElkVHlwZSgpOwog\nICAgICAgICAgICByZXR1cm4gX29iamVjdElkOwogICAgICAgIH0KCiAgICAg\nICAgLy8gZmlndXJlIG91dCBvcGVuanBhIGlkZW50aXR5IHR5cGUgYmFzZWQg\nb24gcHJpbWFyeSBrZXkgZmllbGQKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\ncGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIGlmIChwa3Mu\nbGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIHN3aXRjaCAocGtzWzBdLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgX29i\namVjdElkID0gQnl0ZUlkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgX29i\namVjdElkID0gQ2hhcklkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAg\nIF9vYmplY3RJZCA9IERvdWJsZUlkLmNsYXNzOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAg\nICAgICBfb2JqZWN0SWQgPSBGbG9hdElkLmNsYXNzOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAg\nICAgIF9vYmplY3RJZCA9IEludElkLmNsYXNzOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAg\nICAgX29iamVjdElkID0gTG9uZ0lkLmNsYXNzOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAg\nICAgICBfb2JqZWN0SWQgPSBTaG9ydElkLmNsYXNzOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoK\nICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IFN0cmluZ0lkLmNsYXNzOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRBVEU6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBEYXRlSWQu\nY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nQkpFQ1Q6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBPYmplY3RJZC5j\nbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAgICAgICAgX29iamVj\ndElkID0gQmlnRGVjaW1hbElkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAg\nICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBCaWdJbnRlZ2VySWQuY2xhc3M7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9vYmplY3RJZDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YS1zcGVjaWZpZWQgY2xhc3MgdG8gdXNlIGZvciB0aGUgb2JqZWN0IElE\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3RJZFR5cGUoQ2xh\nc3MgY2xzLCBib29sZWFuIHNoYXJlZCkgewogICAgICAgIF9vYmplY3RJZCA9\nIG51bGw7CiAgICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgX29i\namVjdElkU2hhcmVkID0gbnVsbDsKICAgICAgICBpZiAoY2xzICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbGV0IHBlb3BsZSBhc3NpZ24gT3Bl\nbkpQQUlkIHR5cGVzOyBzYWZlciB0byBjYWxjdWxhdGUgaXQKICAgICAgICAg\nICAgLy8gb3Vyc2VsdmVzCiAgICAgICAgICAgIHNldElkZW50aXR5VHlwZShJ\nRF9BUFBMSUNBVElPTik7CiAgICAgICAgICAgIGlmICghT3BlbkpQQUlkLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkgewogICAgICAgICAgICAgICAg\nX29iamVjdElkID0gY2xzOwogICAgICAgICAgICAgICAgX29iamVjdElkU2hh\ncmVkID0gKHNoYXJlZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGlzIHR5cGUgdXNlcyBhbiBhcHBsaWNhdGlvbiBpZGVu\ndGl0eSBjbGFzcyB0aGF0IGlzIHNoYXJlZAogICAgICogd2l0aCBvdGhlciBj\nbGFzc2VzLCBhbmQgaXMgdGhlcmVmb3JlIHdyYXBwZWQgaW4gYW4ge0BsaW5r\nIE9iamVjdElkfS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNPYmpl\nY3RJZFR5cGVTaGFyZWQoKSB7CiAgICAgICAgaWYgKF9vYmplY3RJZFNoYXJl\nZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX29iamVjdElkU2hhcmVk\nLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\naXNPYmplY3RJZFR5cGVTaGFyZWQoKTsKICAgICAgICByZXR1cm4gaXNPcGVu\nSlBBSWRlbnRpdHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhpcyB0eXBlIHVzZXMgT3BlbkpQQSBpZGVudGl0eS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNPcGVuSlBBSWRlbnRpdHkoKSB7CiAgICAgICAg\naWYgKF9vcGVuanBhSWQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBj\nbHMgPSBnZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAgaWYgKGNscyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBfb3BlbmpwYUlkID0gKE9wZW5KUEFJZC5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKGNscykpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICA6\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb3Bl\nbmpwYUlkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHN0cmF0ZWd5IHRvIHVzZSBmb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdl\nbmVyYXRpb24uCiAgICAgKiBPbmUgb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtA\nbGluayBWYWx1ZVN0cmF0ZWdpZXN9LgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldElkZW50aXR5U3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKGdldElkZW50\naXR5VHlwZSgpID09IElEX0RBVEFTVE9SRQogICAgICAgICAgICAmJiBfaWRT\ndHJhdGVneSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkgewogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRl\nbnRpdHlUeXBlKCkgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIF9p\nZFN0cmF0ZWd5ID0gc3VwLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kgPSBWYWx1\nZVN0cmF0ZWdpZXMuTkFUSVZFOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2lkU3RyYXRlZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRl\nZ3kgdG8gdXNlIGZvciBkYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJhdGlvbi4K\nICAgICAqIE9uZSBvZiB0aGUgY29uc3RhbnRzIGZyb20ge0BsaW5rIFZhbHVl\nU3RyYXRlZ2llc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElkZW50\naXR5U3RyYXRlZ3koaW50IHN0cmF0ZWd5KSB7CiAgICAgICAgX2lkU3RyYXRl\nZ3kgPSBzdHJhdGVneTsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gVmFsdWVT\ndHJhdGVnaWVzLlNFUVVFTkNFKQogICAgICAgICAgICBzZXRJZGVudGl0eVNl\ncXVlbmNlTmFtZShudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBk\nYXRhc3RvcmUgaWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBmb3Ig\nbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJZGVudGl0eVNl\ncXVlbmNlTmFtZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1\nYWxzKF9zZXFOYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfc2VxTmFtZSA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX3NlcU5hbWUgPSBudWxsOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX3NlcU5hbWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNlIG5h\nbWUsIG9yIG51bGwgZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldElkZW50aXR5U2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1lKSB7CiAg\nICAgICAgX3NlcU5hbWUgPSBzZXFOYW1lOwogICAgICAgIF9zZXFNZXRhID0g\nbnVsbDsKICAgICAgICBpZiAoc2VxTmFtZSAhPSBudWxsKQogICAgICAgICAg\nICBzZXRJZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5D\nRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBmb3IgdGhlIGRh\ndGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5jZS4KICAgICAqLwogICAgcHVibGlj\nIFNlcXVlbmNlTWV0YURhdGEgZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRh\nKCkgewogICAgICAgIGlmIChfc2VxTWV0YSA9PSBudWxsICYmIGdldElkZW50\naXR5U2VxdWVuY2VOYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAgX3NlcU1l\ndGEgPSBfcmVwb3MuZ2V0U2VxdWVuY2VNZXRhRGF0YSh0aGlzLAogICAgICAg\nICAgICAgICAgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSwgdHJ1ZSk7CiAg\nICAgICAgcmV0dXJuIF9zZXFNZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nSW5mb3JtYXRpb24gYWJvdXQgbGlmZWN5Y2xlIGNhbGxiYWNrcyBmb3IgdGhp\ncyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZU1ldGFEYXRh\nIGdldExpZmVjeWNsZU1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbGlm\nZU1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBhbGlh\ncyBmb3IgdGhlIGRlc2NyaWJlZCB0eXBlLCBvciA8Y29kZT5udWxsPC9jb2Rl\nPiBpZiBub25lCiAgICAgKiBoYXMgYmVlbiBzZXQuCiAgICAgKiAKICAgICAq\nIEBzZWUgI3NldFR5cGVBbGlhcwogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFR5cGVBbGlhcygpIHsKICAgICAgICBpZiAoX2FsaWFzID09IG51bGwp\nCiAgICAgICAgICAgIF9hbGlhcyA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKF90\neXBlKTsKICAgICAgICByZXR1cm4gX2FsaWFzOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0cyB0aGUgYWxpYXMgZm9yIHRoZSBkZXNjcmliZWQgdHlwZS4g\nVGhlIGFsaWFzIGNhbiBiZQogICAgICogYW55IGFyYml0cmFyeSBzdHJpbmcg\ndGhhdCB0aGUgaW1wbGVtZW50YXRpb24gY2FuIGxhdGVyIHVzZSB0bwogICAg\nICogcmVmZXIgdG8gdGhlIGNsYXNzLiBOb3RlIHRoYXQgYXQgcnVudGltZSwg\nb25seSB0aGUgYWxpYXMKICAgICAqIGNvbXB1dGVkIHdoZW4gdGhlIHBlcnNp\nc3RlbnQgdHlwZSB3YXMgZW5oYW5jZWQgaXMgdXNlZC4KICAgICAqCiAgICAg\nKiBAcGFyYW0gYWxpYXMgdGhlIGFsaWFzIG5hbWUgdG8gYXBwbHkgdG8gdGhl\nIGRlc2NyaWJlZCB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFR5\ncGVBbGlhcyhTdHJpbmcgYWxpYXMpIHsKICAgICAgICBfYWxpYXMgPSBhbGlh\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2Vk\nIGJ5IHRoaXMgY2xhc3MuIEVpdGhlciB7QGxpbmsgI0FDQ0VTU19GSUVMRH0K\nICAgICAqIG9yIHtAbGluayAjQUNDRVNTX1BST1BFUlRZfS4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRBY2Nlc3NUeXBlKCkgewogICAgICAgIGlmIChf\nYWNjZXNzVHlwZSA9PSBBQ0NFU1NfVU5LTk9XTikgewogICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7\nCiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXAuZ2V0QWNjZXNzVHlwZSgpOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRSZXBvc2l0b3J5KCkuZ2V0\nTWV0YURhdGFGYWN0b3J5KCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVm\nYXVsdHMoKS5nZXREZWZhdWx0QWNjZXNzVHlwZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWNjZXNzVHlwZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2VkIGJ5IHRoaXMg\nY2xhc3MuIE11c3QgYmUgZWl0aGVyCiAgICAgKiB7QGxpbmsgI0FDQ0VTU19G\nSUVMRH0gb3Ige0BsaW5rICNBQ0NFU1NfUFJPUEVSVFl9LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRBY2Nlc3NUeXBlKGludCB0eXBlKSB7CiAgICAg\nICAgX2FjY2Vzc1R5cGUgPSB0eXBlOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSByZXF1aXJlcyBleHRlbnQgbWFuYWdlbWVudC4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0UmVxdWlyZXNFeHRlbnQo\nKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsIHx8IGlzRW1iZWRkZWRP\nbmx5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYg\nKF9leHRlbnQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRh\nIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAg\nIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9leHRlbnQgPSAo\nc3VwLmdldFJlcXVpcmVzRXh0ZW50KCkpID8gQm9vbGVhbi5UUlVFCiAgICAg\nICAgICAgICAgICAgICAgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gQm9vbGVhbi5UUlVFOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2V4dGVudC5ib29sZWFuVmFsdWUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgcmVx\ndWlyZXMgZXh0ZW50IG1hbmFnZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldFJlcXVpcmVzRXh0ZW50KGJvb2xlYW4gcmVxKSB7CiAgICAgICAg\nX2V4dGVudCA9IChyZXEpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgY2Fu\nIG9ubHkgYmUgdXNlZCBhcyBhbiBlbWJlZGRlZCBvYmplY3QuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkZWRPbmx5KCkgewogICAgICAg\nIGlmIChfZW1iZWRkZWQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9lbWJl\nZGRlZCA9IChzdXAuaXNFbWJlZGRlZE9ubHkoKSkgPyBCb29sZWFuLlRSVUUK\nICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZW1iZWRkZWQuYm9v\nbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\nZSB0eXBlIGNhbiBvbmx5IGJlIHVzZWQgYXMgYW4gZW1iZWRkZWQgb2JqZWN0\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbWJlZGRlZE9ubHkoYm9v\nbGVhbiBlbWJlZCkgewogICAgICAgIF9lbWJlZGRlZCA9IChlbWJlZCkgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGUgdHlwZSdzIGZpZWxkcyBhcmUgYWN0aXZlbHkg\naW50ZXJjZXB0ZWQsIGVpdGhlciBieQogICAgICogcmVkZWZpbml0aW9uIG9y\nIGVuaGFuY2VtZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0lu\ndGVyY2VwdGluZygpIHsKICAgICAgICByZXR1cm4gX2ludGVyY2VwdGluZzsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUncyBmaWVs\nZHMgYXJlIGFjdGl2ZWx5IGludGVyY2VwdGVkLCBlaXRoZXIgYnkKICAgICAq\nIHJlZGVmaW5pdGlvbiBvciBlbmhhbmNlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0SW50ZXJjZXB0aW5nKGJvb2xlYW4gaW50ZXJjZXB0aW5n\nKSB7CiAgICAgICAgX2ludGVyY2VwdGluZyA9IGludGVyY2VwdGluZzsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgaXMgYSBtYW5h\nZ2VkIGludGVyZmFjZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNN\nYW5hZ2VkSW50ZXJmYWNlKCkgewogICAgICAgIGlmICghX3R5cGUuaXNJbnRl\ncmZhY2UoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJl\ndHVybiBfaW50ZXJmYWNlID09IG51bGwgPyBmYWxzZSA6IF9pbnRlcmZhY2Uu\nYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRoZSB0eXBlIGlzIGEgbWFuYWdlZCBpbnRlcmZhY2UKICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0TWFuYWdlZEludGVyZmFjZShib29sZWFuIG1hbmFn\nZWRJbnRlcmZhY2UpIHsKICAgICAgICBpZiAoIV90eXBlLmlzSW50ZXJmYWNl\nKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm90LWludGVyZmFjZSIsIF90eXBlKSk7CiAgICAgICAgX2lu\ndGVyZmFjZSA9IG1hbmFnZWRJbnRlcmZhY2UgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBtYW5hZ2VkIGludGVyZmFjZXMg\nYWx3YXlzIGRvIHByb3BlciBpbnRlcmNlcHRpb247IE9wZW5KUEEgZ2VuZXJh\ndGVzCiAgICAgICAgLy8gdGhlIGltcGxlbWVudGF0aW9ucy4KICAgICAgICBp\nZiAoaXNNYW5hZ2VkSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHNldEludGVy\nY2VwdGluZyh0cnVlKTsKCiAgICAgICAgLy8gbWFuYWdlZCBpbnRlcmZhY2Vz\nIGFsd2F5cyB1c2UgcHJvcGVydHkgYWNjZXNzLgogICAgICAgIHNldEFjY2Vz\nc1R5cGUoQUNDRVNTX1BST1BFUlRZKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbWFuYWdlZCBpbnRlcmZhY2UgaW1wbGVtZW50b3IgaWYg\nYW55LgogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0SW50ZXJmYWNlSW1w\nbCgpIHsKICAgICAgICByZXR1cm4gX2ltcGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIG1hbmFnZWQgaW50ZXJmYWNlIGltcGxlbWVudG9yIGNs\nYXNzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmZhY2VJbXBs\nKENsYXNzIGltcGwpIHsKICAgICAgICBfaW1wbCA9IGltcGw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGV4cGxpY2l0bHkgZGVjbGFyZWQg\naW50ZXJmYWNlcyB0aGlzIGNsYXNzIGltcGxlbWVudHMuCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc1tdIGdldERlY2xhcmVkSW50ZXJmYWNlcygpIHsKICAg\nICAgICBpZiAoX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIE1ldGFEYXRhUmVwb3NpdG9yeS5FTVBUWV9DTEFTU0VTOwogICAgICAg\nIHJldHVybiAoQ2xhc3NbXSkgX2ludGVyZmFjZXMudG9BcnJheShuZXcgQ2xh\nc3NbX2ludGVyZmFjZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBFeHBsaWNpdGx5IGRlY2xhcmUgdGhlIGdpdmVuIGludGVyZmFjZSBhbW9u\nZyB0aGUgb25lcyB0aGlzCiAgICAgKiBjbGFzcyBpbXBsZW1lbnRzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZShDbGFz\ncyBpZmFjZSkgewogICAgICAgIGlmIChpZmFjZSA9PSBudWxsIHx8ICFpZmFj\nZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImRlY2xhcmUtbm9uLWludGVyZmFjZSIs\nCiAgICAgICAgICAgICAgICB0aGlzLCBpZmFjZSkpOwogICAgICAgIGlmIChf\naW50ZXJmYWNlcyA9PSBudWxsKQogICAgICAgICAgICBfaW50ZXJmYWNlcyA9\nIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBfaW50ZXJmYWNlcy5hZGQoaWZh\nY2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBp\nbnRlcmZhY2UgZnJvbSB0aGUgZGVjbGFyZWQgbGlzdC4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFyZWRJbnRlcmZhY2UoQ2xhc3Mg\naWZhY2UpIHsKICAgICAgICBpZiAoX2ludGVyZmFjZXMgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfaW50ZXJm\nYWNlcy5yZW1vdmUoaWZhY2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxp\nYXMgcHJvcGVydGllcyBmcm9tIHRoZSBnaXZlbiBpbnRlcmZhY2UgZHVyaW5n\nICBxdWVyaWVzIHRvCiAgICAgKiB0aGUgbG9jYWwgZmllbGQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldEludGVyZmFjZVByb3BlcnR5QWxpYXMoQ2xh\nc3MgaWZhY2UsIFN0cmluZyBvcmlnLCAKICAgICAgICBTdHJpbmcgbG9jYWwp\nIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9pZmFjZU1hcCkgewogICAgICAg\nICAgICBNYXAgZmllbGRzID0gKE1hcCkgX2lmYWNlTWFwLmdldChpZmFjZSk7\nCiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgZmllbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAg\nIF9pZmFjZU1hcC5wdXQoaWZhY2UsIGZpZWxkcyk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKGZpZWxkcy5jb250YWluc0tleShvcmlnKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiZHVwbGljYXRlLWlmYWNlLWFsaWFzIiwgCiAgICAgICAgICAgICAg\nICAgICAgdGhpcywgb3JpZywgbG9jYWwpKTsKICAgICAgICAgICAgZmllbGRz\nLnB1dChvcmlnLCBsb2NhbCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEdldCBsb2NhbCBmaWVsZCBhbGlhcyBmb3IgdGhlIGdpdmVu\nIGludGVyZmFjZSBwcm9wZXJ0eS4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZyBnZXRJbnRlcmZhY2VQcm9wZXJ0eUFsaWFzKENsYXNzIGlmYWNlLCBTdHJp\nbmcgb3JpZykgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7\nCiAgICAgICAgICAgIE1hcCBmaWVsZHMgPSAoTWFwKSBfaWZhY2VNYXAuZ2V0\nKGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiAo\nU3RyaW5nKSBmaWVsZHMuZ2V0KG9yaWcpOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGFsaWFzZXMgcHJvcGVydHkg\nbmFtZWQgZm9yIHRoZSBnaXZlbiBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmdbXSBnZXRJbnRlcmZhY2VBbGlhc2VkUHJvcGVydGllcyhD\nbGFzcyBpZmFjZSkgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFw\nKSB7CiAgICAgICAgICAgIE1hcCBmaWVsZHMgPSAoTWFwKSBfaWZhY2VNYXAu\nZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZX1NUUklOR19BUlJBWTsKICAg\nICAgICAgICAgcmV0dXJuIChTdHJpbmdbXSkgZmllbGRzLmtleVNldCgpLnRv\nQXJyYXkoCiAgICAgICAgICAgICAgICBuZXcgU3RyaW5nW2ZpZWxkcy5zaXpl\nKCldKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBudW1iZXIgb2YgZmllbGRzIHRoYXQgdXNlIGltcGwgb3IgaW50\nZXJtZWRpYXRlIGRhdGEsIGluCiAgICAgKiBvcmRlciB0byBjcmVhdGUgYSBj\nb21wYWN0ZWQgYXJyYXkgZm9yIHN0b3JhZ2Ugb2Ygc2FpZCBkYXRhLgogICAg\nICovCiAgICBwdWJsaWMgaW50IGdldEV4dHJhRmllbGREYXRhTGVuZ3RoKCkg\newogICAgICAgIGludFtdIHRhYmxlID0gZ2V0RXh0cmFGaWVsZERhdGFUYWJs\nZSgpOwogICAgICAgIGZvciAoaW50IGkgPSB0YWJsZS5sZW5ndGggLSAxOyBp\nID49IDA7IGktLSkKICAgICAgICAgICAgaWYgKHRhYmxlW2ldICE9IC0xKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHRhYmxlW2ldICsgMTsKICAgICAgICBy\nZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgaW1w\nbCAvIGludGVybWVkaWF0ZSBmaWVsZCBkYXRhIGluZGV4IG9mIHRoZSBnaXZl\nbiBmaWVsZAogICAgICogaW4gdGhlIGNvbXBhY3RlZCBhcnJheSwgb3IgLTEg\naWYgdGhlIGZpZWxkIGRvZXMgbm90IHVzZSBleHRyYSBkYXRhLgogICAgICoK\nICAgICAqIEBzZWUgI2dldEV4dHJhRmllbGREYXRhTGVuZ3RoCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0RXh0cmFGaWVsZERhdGFJbmRleChpbnQgZmll\nbGQpIHsKICAgICAgICByZXR1cm4gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgp\nW2ZpZWxkXTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYSB0YWJs\nZSBtYXBwaW5nIGVhY2ggZmllbGQgaW5kZXggdG8gaXRzIGV4dHJhIGRhdGEg\naW5kZXguCiAgICAgKi8KICAgIHByaXZhdGUgaW50W10gZ2V0RXh0cmFGaWVs\nZERhdGFUYWJsZSgpIHsKICAgICAgICBpZiAoX2ZpZWxkRGF0YVRhYmxlID09\nIG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBn\nZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50W10gdGFibGUgPSBuZXcgaW50\nW2ZtZHMubGVuZ3RoXTsKICAgICAgICAgICAgaW50IGlkeCA9IDA7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgaWYgKGZtZHNbaV0udXNlc0ludGVybWVkaWF0\nZSgpCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kc1tpXS51c2VzSW1wbERh\ndGEoKSAhPSBCb29sZWFuLkZBTFNFKQogICAgICAgICAgICAgICAgICAgIHRh\nYmxlW2ldID0gaWR4Kys7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgdGFibGVbaV0gPSAtMTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBfZmllbGREYXRhVGFibGUgPSB0YWJsZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9maWVsZERhdGFUYWJsZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBuYW1lIHJlcHJlc2Vu\ndHMgYSBtYW5hZ2VkIG9yIHN0YXRpYyBmaWVsZCBvZgogICAgICogdGhpcyBj\nbGFzcywgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0FjY2Vzc2libGVGaWVsZChTdHJpbmcgZmll\nbGQpIHsKICAgICAgICBpZiAoZ2V0RGVjbGFyZWRGaWVsZChmaWVsZCkgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9z\ndGF0aWNGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZFtdIGZp\nZWxkcyA9IChGaWVsZFtdKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVk\nRmllbGRzQWN0aW9uKF90eXBlKSk7IAogICAgICAgICAgICBTZXQgbmFtZXMg\nPSBuZXcgSGFzaFNldCgoaW50KSAoZmllbGRzLmxlbmd0aCAqIDEuMzMgKyAx\nKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzU3Rh\ndGljKGZpZWxkc1tpXS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAg\nICAgICAgbmFtZXMuYWRkKGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAg\nICAgICBfc3RhdGljRmllbGRzID0gbmFtZXM7CiAgICAgICAgfQogICAgICAg\nIGlmIChfc3RhdGljRmllbGRzLmNvbnRhaW5zKGZpZWxkKSkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5p\nc0FjY2Vzc2libGVGaWVsZChmaWVsZCk7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmaWVsZCBtZXRh\nZGF0YXMsIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAqLwog\nICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRGaWVsZHMoKSB7CiAgICAg\nICAgaWYgKF9hbGxGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\nX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWxsRmllbGRzID0g\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBz\ndXBGaWVsZHMgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLgogICAgICAg\nICAgICAgICAgICAgIGdldEZpZWxkcygpOwoKICAgICAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBhbGxGaWVsZHMgPSBfcmVwb3MubmV3RmllbGRNZXRh\nRGF0YUFycmF5CiAgICAgICAgICAgICAgICAgICAgKGZpZWxkcy5sZW5ndGgg\nKyBzdXBGaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIFN5c3RlbS5h\ncnJheWNvcHkoc3VwRmllbGRzLCAwLCBhbGxGaWVsZHMsIDAsIHN1cEZpZWxk\ncy5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmVwbGFjZURlZmluZWRTdXBl\ncmNsYXNzRmllbGRzKGFsbEZpZWxkcywgc3VwRmllbGRzLmxlbmd0aCk7Cgog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0uc2V0\nSW5kZXgoc3VwRmllbGRzLmxlbmd0aCArIGkpOwogICAgICAgICAgICAgICAg\nICAgIGFsbEZpZWxkc1tzdXBGaWVsZHMubGVuZ3RoICsgaV0gPSBmaWVsZHNb\naV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfYWxsRmll\nbGRzID0gYWxsRmllbGRzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfYWxsRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVwbGFjZSBzdXBlcmNsYXNzIGZpZWxkcyB0aGF0IHdlIGRlZmluZSB3aXRo\nIG91ciB2ZXJzaW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVwbGFj\nZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKEZpZWxkTWV0YURhdGFbXSBmaWVs\nZHMsCiAgICAgICAgaW50IGxlbikgewogICAgICAgIGlmIChfc3VwRmllbGRN\nYXAgPT0gbnVsbCB8fCAhX2RlZlN1cEZpZWxkcykKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAvLyBkb24ndCBhc3N1bWUgZmllbGRzIGFyZSBpbiBv\ncmRlcjsgdGhpcyBtZXRob2QgaXMgdXNlZCBmb3IKICAgICAgICAvLyBsaXN0\naW5nIG9yZGVyIGFzIHdlbGwKICAgICAgICBGaWVsZE1ldGFEYXRhIHN1cEZp\nZWxkOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsK\nICAgICAgICAgICAgc3VwRmllbGQgPSAoRmllbGRNZXRhRGF0YSkgX3N1cEZp\nZWxkTWFwLmdldChmaWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\naWYgKHN1cEZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpZWxk\nc1tpXSA9IHN1cEZpZWxkOwogICAgICAgICAgICAgICAgc3VwRmllbGQuc2V0\nSW5kZXgoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN1cGVyY2xhc3MgY29weSBvZiB0aGUg\nZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZE1ldGFE\nYXRhIGdldFN1cGVyY2xhc3NGaWVsZChGaWVsZE1ldGFEYXRhIHN1cEZpZWxk\nKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzbSA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbSA9\nPSBudWxsID8gbnVsbCA6IHNtLmdldEZpZWxkKHN1cEZpZWxkLmdldE5hbWUo\nKSk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsIHx8IGZtZC5nZXRNYW5hZ2Vt\nZW50KCkgIT0gZm1kLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVubWFuYWdl\nZC1zdXAtZmllbGQiLAogICAgICAgICAgICAgICAgc3VwRmllbGQsIHRoaXMp\nKTsKICAgICAgICByZXR1cm4gZm1kOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIG9ubHkgdGhlIGZpZWxkcyBmb3IgdGhpcyBjbGFzcywgd2l0aG91\ndCBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIEZpZWxk\nTWV0YURhdGFbXSBnZXREZWNsYXJlZEZpZWxkcygpIHsKICAgICAgICBpZiAo\nX2ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIExpc3QgZmllbGRzID0g\nbmV3IEFycmF5TGlzdChfZmllbGRNYXAuc2l6ZSgpKTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQ7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBmbWQgPSAoRmllbGRNZXRhRGF0\nYSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0TWFu\nYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX05PTkUpIHsKICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0RGVjbGFyZWRJbmRleChmaWVsZHMu\nc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0SW5kZXgoZm1k\nLmdldERlY2xhcmVkSW5kZXgoKSk7CiAgICAgICAgICAgICAgICAgICAgZmll\nbGRzLmFkZChmbWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIF9maWVsZHMgPSAoRmllbGRNZXRhRGF0YVtdKSBmaWVs\nZHMudG9BcnJheQogICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdGaWVsZE1l\ndGFEYXRhQXJyYXkoZmllbGRzLnNpemUoKSkpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX2ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBwcmltYXJ5IGtleSBmaWVsZHMsIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUu\nIFRoZSBvcmRlcgogICAgICogaW4gd2hpY2ggdGhlIGtleXMgYXJlIHJldHVy\nbmVkIHdpbGwgYmUgdGhlIG9yZGVyIGluIHdoaWNoCiAgICAgKiB0aGUgZmll\nbGRzIGFyZSBkZWNsYXJlZCwgc3RhcnRpbmcgYXQgdGhlIGxlYXN0LWRlcml2\nZWQgc3VwZXJjbGFzcwogICAgICogYW5kIGVuZGluZyB3aXRoIHRoZSBwcmlt\nYXJ5IGtleSBmaWVsZHMgb2YgdGhlIG1vc3QtZGVyaXZlZCBzdWJjbGFzcy4K\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRQcmltYXJ5\nS2V5RmllbGRzKCkgewogICAgICAgIC8vIGNoZWNrIGZvciBwayBmaWVsZHMg\nZXZlbiBpZiBub3Qgc2V0IHRvIElEX0FQUExJQ0FUSU9OIHNvIHRoYXQKICAg\nICAgICAvLyBhcHAgaWQgdG9vbCBzZWVzIHRoZW0gZXZlbiB3aGVuIHVzZXIg\nZG9lc24ndCBkZWNsYXJlIGFwcCBpZAogICAgICAgIGlmIChfYWxsUEtGaWVs\nZHMgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmll\nbGRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGludCBudW0gPSAwOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNQcmltYXJ5\nS2V5KCkpCiAgICAgICAgICAgICAgICAgICAgbnVtKys7CgogICAgICAgICAg\nICBpZiAobnVtID09IDApCiAgICAgICAgICAgICAgICBfYWxsUEtGaWVsZHMg\nPSBfcmVwb3MuRU1QVFlfRklFTERTOwogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBfcmVwb3MubmV3\nRmllbGRNZXRhRGF0YUFycmF5KG51bSk7CiAgICAgICAgICAgICAgICBudW0g\nPSAwOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVs\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmll\nbGRzW2ldLmlzUHJpbWFyeUtleSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGZpZWxkc1tpXS5zZXRQcmltYXJ5S2V5SW5kZXgobnVtKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcGtzW251bV0gPSBmaWVsZHNbaV07CiAgICAg\nICAgICAgICAgICAgICAgICAgIG51bSsrOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9hbGxQS0Zp\nZWxkcyA9IHBrczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX2FsbFBLRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBsaXN0IG9mIGZpZWxkcyBpbiB0aGUgZGVmYXVsdCBmZXRjaCBn\ncm91cCwKICAgICAqIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcywgb3Ig\nYW4gZW1wdHkgYXJyYXkgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkTWV0YURhdGFbXSBnZXREZWZhdWx0RmV0Y2hHcm91cEZpZWxkcygpIHsK\nICAgICAgICBpZiAoX2FsbERGR0ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAg\nICAgICAgICAgaW50IG51bSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\naWYgKGZpZWxkc1tpXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAg\nICAgICAgICAgICAgICBudW0rKzsKCiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBkZmdzID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheShudW0p\nOwogICAgICAgICAgICBudW0gPSAwOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nIGlmIChmaWVsZHNbaV0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAg\nICAgICAgICAgICAgICAgZGZnc1tudW0rK10gPSBmaWVsZHNbaV07CiAgICAg\nICAgICAgIF9hbGxERkdGaWVsZHMgPSBkZmdzOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX2FsbERGR0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgdmVyc2lvbiBmaWVsZCBmb3IgdGhpcyBjbGFzcywgaWYg\nYW55LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRWZXJz\naW9uRmllbGQoKSB7CiAgICAgICAgaWYgKF92ZXJzaW9uSWR4ID09IEludGVn\nZXIuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\naWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IGlkeCA9IC0x\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc1Zl\ncnNpb24oKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpZHggIT0gLTEp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKCJtdWx0LXZlcnMtZmllbGRzIiwgdGhpcywgZmllbGRzW2lkeF0sIGZpZWxk\nc1tpXSkpOwogICAgICAgICAgICAgICAgICAgIGlkeCA9IGk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3ZlcnNpb25J\nZHggPSBpZHg7CiAgICAgICAgfQogICAgICAgIGlmIChfdmVyc2lvbklkeCA9\nPSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJu\nIGdldEZpZWxkcygpW192ZXJzaW9uSWR4XTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBwZXJzaXN0ZW50IG9y\nIHRyYW5zYWN0aW9uYWwgZmllbGQgd2l0aAogICAgICogdGhlIGdpdmVuIGFi\nc29sdXRlIGluZGV4LgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpZWxk\nJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldEZpZWxkKGludCBpbmRleCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsK\nICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGZpZWxkcy5sZW5n\ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBm\naWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25h\nbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gcmVsYXRpdmUgaW5kZXgu\nCiAgICAgKgogICAgICogQHJldHVybiB0aGUgZmllbGQncyBtZXRhZGF0YSwg\nb3IgbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwogICAgcHVibGljIEZpZWxk\nTWV0YURhdGEgZ2V0RGVjbGFyZWRGaWVsZChpbnQgaW5kZXgpIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMo\nKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGZpZWxkcy5s\nZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVy\nbiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rp\nb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gbmFtZS4KICAgICAq\nCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxs\nIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0\nYSBnZXRGaWVsZChTdHJpbmcgbmFtZSkgewogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gZ2V0RGVjbGFyZWRGaWVsZChuYW1lKTsKICAgICAgICBpZiAo\nZm1kICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmbWQ7CiAgICAgICAg\naWYgKF9zdXBGaWVsZE1hcCAhPSBudWxsICYmIF9kZWZTdXBGaWVsZHMpIHsK\nICAgICAgICAgICAgZm1kID0gKEZpZWxkTWV0YURhdGEpIF9zdXBGaWVsZE1h\ncC5nZXQobmFtZSk7CiAgICAgICAgICAgIGlmIChmbWQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBmbWQ7CiAgICAgICAgfQogICAgICAgIGlm\nIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkuZ2V0RmllbGQobmFtZSk7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1l\ndGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZp\nZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBuYW1lLCB3aXRob3V0IGluY2x1\nZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAog\nICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXREZWNsYXJlZEZp\nZWxkKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVs\nZCA9IChGaWVsZE1ldGFEYXRhKSBfZmllbGRNYXAuZ2V0KG5hbWUpOwogICAg\nICAgIGlmIChmaWVsZCA9PSBudWxsIHx8IGZpZWxkLmdldE1hbmFnZW1lbnQo\nKSA9PSBmaWVsZC5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIGZpZWxkOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGFueSBmaWVsZHMgdGhhdCB3ZXJlIGFkZGVkIGFzIG5vbi1t\nYW5hZ2VkLgogICAgICogQWxsIG90aGVyIG1ldGhvZHMgdG8gZ2V0IGZpZWxk\ncyByZXR1cm4gb25seSB0aG9zZSB0aGF0IGFyZSBtYW5hZ2VkLgogICAgICov\nCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlY2xhcmVkVW5tYW5h\nZ2VkRmllbGRzKCkgewogICAgICAgIGlmIChfdW5tZ2RGaWVsZHMgPT0gbnVs\nbCkgewogICAgICAgICAgICBDb2xsZWN0aW9uIHVubWFuYWdlZCA9IG5ldyBB\ncnJheUxpc3QoMyk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQ7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2ZpZWxkTWFwLnZh\nbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICBmaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdldE1hbmFnZW1lbnQoKSA9PSBG\naWVsZE1ldGFEYXRhLk1BTkFHRV9OT05FKQogICAgICAgICAgICAgICAgICAg\nIHVubWFuYWdlZC5hZGQoZmllbGQpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIF91bm1nZEZpZWxkcyA9IChGaWVsZE1ldGFEYXRhW10pIHVubWFuYWdl\nZC50b0FycmF5CiAgICAgICAgICAgICAgICAoX3JlcG9zLm5ld0ZpZWxkTWV0\nYURhdGFBcnJheSh1bm1hbmFnZWQuc2l6ZSgpKSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfdW5tZ2RGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgYSBuZXcgZmllbGQgbWV0YWRhdGEgdG8gdGhpcyBjbGFzcy4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgYWRkRGVjbGFyZWRGaWVs\nZChTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSkgewogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGEobmFtZSwgdHlw\nZSwgdGhpcyk7CiAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7CiAgICAgICAg\nX2ZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAgICAgIHJldHVybiBmbWQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIGZpZWxk\nIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUg\naWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxzZSBvdGhlcndpc2UKICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFyZWRGaWVsZChG\naWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAgaWYgKGZpZWxkICE9IG51\nbGwgJiYgX2ZpZWxkTWFwLnJlbW92ZShmaWVsZC5nZXROYW1lKCkpICE9IG51\nbGwpIHsKICAgICAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRlZmluZWQg\nc3VwZXJjbGFzcyBmaWVsZCB3aXRoIHRoZSBnaXZlbiBuYW1lLCBvciBudWxs\nIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdl\ndERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIHJldHVybiAoRmllbGRNZXRhRGF0YSkgX3N1cEZp\nZWxkTWFwLmdldChuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBh\nIG5ldyBkZWZpbmVkIHN1cGVyY2xhc3MgZmllbGQgbWV0YWRhdGEgdG8gdGhp\ncyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgYWRk\nRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChTdHJpbmcgbmFtZSwgQ2xhc3MgdHlw\nZSwKICAgICAgICBDbGFzcyBzdXApIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhKG5hbWUsIHR5cGUsIHRo\naXMpOwogICAgICAgIGZtZC5zZXREZWNsYXJpbmdUeXBlKHN1cCk7CiAgICAg\nICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX2RlZlN1cEZpZWxk\ncyA9IGZhbHNlOwogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbCkK\nICAgICAgICAgICAgX3N1cEZpZWxkTWFwID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICBfc3VwRmllbGRNYXAucHV0KG5hbWUsIGZtZCk7CiAgICAgICAgcmV0\ndXJuIGZtZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2\nZW4gZmllbGQgZnJvbSBtYW5hZ2VtZW50LgogICAgICoKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiB0aGUgZmllbGQgd2FzIHJlbW92ZWQsIGZhbHNlIG90aGVy\nd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVEZWZpbmVk\nU3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURhdGEgZmllbGQpIHsKICAgICAg\nICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfc3VwRmllbGRNYXAgIT0gbnVsbAog\nICAgICAgICAgICAmJiBfc3VwRmllbGRNYXAucmVtb3ZlKGZpZWxkLmdldE5h\nbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBjbGVhckFsbEZpZWxkQ2Fj\naGUoKTsKICAgICAgICAgICAgX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogSW5jb3Jwb3JhdGUgc3Vw\nZXJjbGFzcyBmaWVsZHMgcmVkZWZpbmVkIGluIHRoaXMgc3ViY2xhc3MgaW50\nbyB0aGlzCiAgICAgKiBtZXRhZGF0YS4gVGhpcyBtZXRob2QgaXMgZ2VuZXJh\nbGx5IGNhbGxlZCBhZnRlciBtZXRhZGF0YSBpcyByZXNvbHZlZAogICAgICog\nYW5kIG1hcHBpbmcgaW5mb3JtYXRpb24gaXMgbG9hZGVkLCBidXQgYmVmb3Jl\nIG1hcHBpbmcgcmVzb2x2ZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZm9yY2Ug\nd2hldGhlciB0byBmb3JjZSByZS1tYXBwaW5nIG9mIGV2ZW4gbWFwcGVkIHN1\ncGVyY2xhc3MgZmllbGRzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGRlZmlu\nZVN1cGVyY2xhc3NGaWVsZHMoYm9vbGVhbiBmb3JjZSkgewogICAgICAgIGlm\nIChfZGVmU3VwRmllbGRzKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICBpZiAoaXNNYXBwZWQoKSAmJiBzdXAgIT0gbnVsbCkgewog\nICAgICAgICAgICAvLyByZWRlZmluZSBhbGwgdW5tYXBwZWQgc3VwZXJjbGFz\ncyBmaWVsZHMKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1cHMgPSBz\ndXAuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKChm\nb3JjZSB8fCAhc3Vwc1tpXS5nZXREZWZpbmluZ01ldGFEYXRhKCkuaXNNYXBw\nZWQoKSkKICAgICAgICAgICAgICAgICAgICAmJiBnZXREZWZpbmVkU3VwZXJj\nbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChzdXBz\nW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tp\nXS5nZXREZWNsYXJlZFR5cGUoKSwgc3Vwc1tpXS5nZXREZWNsYXJpbmdUeXBl\nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJlc29sdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcygpOwoK\nICAgICAgICAvLyB0aGlzIGVuc3VyZXMgdGhhdCBhbGwgZmllbGQgaW5kZXhl\ncyBnZXQgc2V0IHdoZW4gZmllbGRzIGFyZSBjYWNoZWQuCiAgICAgICAgLy8g\nSSBkb24ndCBsaWtlIGRvaW5nIHRoaXMgdHdpY2UgKGl0J3MgYWxzbyBkb25l\nIGluIHJlc29sdmVNZXRhKSwgYnV0CiAgICAgICAgLy8gd2UgaGF2ZSB0byBy\nZS1jYWNoZSBpbiBjYXNlIHRoaXMgY2xhc3Mgb3IgYW55IHN1cGVyY2xhc3Mg\ncmVwbGFjZWQKICAgICAgICAvLyBzb21lIGZpZWxkcyB3aXRoIHJlZGVmaW5l\nZCB2ZXJzaW9ucywgYW5kIEkgZG9uJ3Qgd2FudCBvdXRzaWRlIGNvZGUKICAg\nICAgICAvLyB0byBoYXZlIHRvIGNhbGwgdGhpcyBtZXRob2QgYWZ0ZXIgcmVz\nb2x2ZSBqdXN0IHRvIGdldCBmaWVsZCBpbmRleGVzLAogICAgICAgIC8vIGV0\nYyBzZXQgY29ycmVjdGx5CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7\nCiAgICAgICAgY2FjaGVGaWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlc29sdmUgc3VwZXJjbGFzcyBmaWVsZHMgd2UndmUgcmVkZWZpbmVkLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZURlZmluZWRTdXBlcmNs\nYXNzRmllbGRzKCkgewogICAgICAgIF9kZWZTdXBGaWVsZHMgPSB0cnVlOwog\nICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZDsKICAgICAgICBG\naWVsZE1ldGFEYXRhIHN1cDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIF9zdXBGaWVsZE1hcC52YWx1ZXMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBmbWQgPSAoRmllbGRNZXRhRGF0YSkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgc3VwID0gZ2V0U3VwZXJjbGFzc0ZpZWxk\nKGZtZCk7CgogICAgICAgICAgICAvLyBqcGEgbWV0YWRhdGEgZG9lc24ndCBx\ndWFsaWZ5IHN1cGVyY2xhc3MgZmllbGQgbmFtZXMsIHNvIHdlCiAgICAgICAg\nICAgIC8vIG1pZ2h0IG5vdCBrbm93IHRoZSBkZWNsYXJpbmcgdHlwZSB1bnRp\nbCBub3cKICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJpbmdUeXBlKCkg\nPT0gT2JqZWN0LmNsYXNzKSB7CiAgICAgICAgICAgICAgICBmbWQuc2V0RGVj\nbGFyaW5nVHlwZShzdXAuZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAg\nICAgICAgIGZtZC5iYWNraW5nTWVtYmVyKGdldFJlcG9zaXRvcnkoKS5nZXRN\nZXRhRGF0YUZhY3RvcnkoKS4KICAgICAgICAgICAgICAgICAgICBnZXREZWZh\ndWx0cygpLmdldEJhY2tpbmdNZW1iZXIoZm1kKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgZm1kLmNvcHkoc3VwKTsKICAgICAgICAgICAgZm1kLnJl\nc29sdmUoTU9ERV9NRVRBKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIGFsbCB0aGUgZmllbGRzIGRlZmlu\nZWQgYnkgdGhpcyBjbGFzcy4KICAgICAqIFRoaXMgaW5jbHVkZXMgbWFwcGVk\nIGRlY2xhcmVkIGZpZWxkcyBhbmQgYW55IGNvbmNyZXRlIG1hcHBpbmcgb2YK\nICAgICAqIHVubWFwcGVkIHN1cGVyY2xhc3MgZmllbGRzIHBlcmZvcm1lZCBi\neSB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0\nYVtdIGdldERlZmluZWRGaWVsZHMoKSB7CiAgICAgICAgaWYgKF9kZWZpbmVk\nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBMaXN0IGRlZmlu\nZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc01hcHBlZCgpCiAgICAg\nICAgICAgICAgICAgICAgJiYgZmllbGRzW2ldLmdldERlZmluaW5nTWV0YURh\ndGEoKSA9PSB0aGlzKQogICAgICAgICAgICAgICAgICAgIGRlZmluZWQuYWRk\nKGZpZWxkc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2RlZmlu\nZWRGaWVsZHMgPSAoRmllbGRNZXRhRGF0YVtdKSBkZWZpbmVkLnRvQXJyYXkK\nICAgICAgICAgICAgICAgIChfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5\nKGRlZmluZWQuc2l6ZSgpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nZGVmaW5lZEZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\nYWxsIGZpZWxkcyBpbiB0aGUgb3JkZXIgdGhleSBhcmUgbGlzdGVkIGluIHRo\nZSBtZXRhZGF0YQogICAgICogZmlsZS4gVW5saXN0ZWQgZmllbGRzIGFyZSBw\nbGFjZWQgYWZ0ZXIgbGlzdGVkIG9uZXMuCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1ldGFEYXRhW10gZ2V0RmllbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAg\nICAgICAgaWYgKF9hbGxMaXN0aW5nRmllbGRzID09IG51bGwpIHsKICAgICAg\nICAgICAgLy8gY29tYmluZSBkZWNsYXJlZCBhbmQgdW5tYW5hZ2VkIGZpZWxk\ncyBpbnRvIGxpc3Rpbmcgb3JkZXIgYXJyYXkKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGRlYyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9IGdldERlY2xhcmVkVW5tYW5h\nZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBkZWNM\naXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAg\nICAgICAgICAgKGRlYy5sZW5ndGggKyB1bm1nZC5sZW5ndGgpOwogICAgICAg\nICAgICBTeXN0ZW0uYXJyYXljb3B5KGRlYywgMCwgZGVjTGlzdGluZywgMCwg\nZGVjLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkodW5t\nZ2QsIDAsIGRlY0xpc3RpbmcsIGRlYy5sZW5ndGgsIHVubWdkLmxlbmd0aCk7\nCiAgICAgICAgICAgIEFycmF5cy5zb3J0KGRlY0xpc3RpbmcsIExpc3RpbmdP\ncmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2UoKSk7CgogICAgICAgICAgICBp\nZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWxsTGlzdGlu\nZ0ZpZWxkcyA9IGRlY0xpc3Rpbmc7CiAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgLy8gcGxhY2Ugc3VwZXJjbGFzcyBmaWVsZHMgaW4gbGlz\ndGluZyBvcmRlciBiZWZvcmUgb3VyCiAgICAgICAgICAgICAgICAvLyBsaXN0\naW5nLW9yZGVyIGRlY2xhcmVkIGZpZWxkcwogICAgICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGRzSW5MaXN0aW5nT3JkZXIo\nKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBsaXN0aW5nID0g\nX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAgICAgICAgICAg\nICAgIChzdXAubGVuZ3RoICsgZGVjTGlzdGluZy5sZW5ndGgpOwogICAgICAg\nICAgICAgICAgU3lzdGVtLmFycmF5Y29weShzdXAsIDAsIGxpc3RpbmcsIDAs\nIHN1cC5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmVwbGFjZURlZmluZWRT\ndXBlcmNsYXNzRmllbGRzKGxpc3RpbmcsIHN1cC5sZW5ndGgpOwogICAgICAg\nICAgICAgICAgU3lzdGVtLmFycmF5Y29weShkZWNMaXN0aW5nLCAwLCBsaXN0\naW5nLCBzdXAubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGRlY0xpc3Rp\nbmcubGVuZ3RoKTsKICAgICAgICAgICAgICAgIF9hbGxMaXN0aW5nRmllbGRz\nID0gbGlzdGluZzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX2FsbExpc3RpbmdGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIGFsbCBmaWVsZHMgZGVmaW5lZCBieSB0aGlzIGNsYXNzIGlu\nIHRoZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQKICAgICAqIGluIHRoZSBtZXRh\nZGF0YSBmaWxlLiBVbmxpc3RlZCBmaWVsZHMgYXJlIHBsYWNlZCBhZnRlciBs\naXN0ZWQgb25lcy4KICAgICAqIFRoaXMgYXJyYXkgaW5jbHVkZXMgZGVjbGFy\nZWQgdHJhbnNhY3Rpb25hbCBhbmQgdW5tYW5hZ2VkIGZpZWxkcy4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZpbmVkRmllbGRz\nSW5MaXN0aW5nT3JkZXIoKSB7CiAgICAgICAgaWYgKF9saXN0aW5nRmllbGRz\nID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxk\ncyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBMaXN0IGRlZmluZWQgPSBu\nZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIGlmIChmaWVsZHNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpID09\nIHRoaXMpCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZC5hZGQoZmllbGRz\nW2ldKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHVubWdkID0gZ2V0\nRGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFy\ncmF5CiAgICAgICAgICAgICAgICAoZGVmaW5lZC5zaXplKCkgKyB1bm1nZC5s\nZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGRlZmlu\nZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAgICBsaXN0aW5nW2ldID0g\nKEZpZWxkTWV0YURhdGEpIGRlZmluZWQuZ2V0KGkpOwogICAgICAgICAgICBT\neXN0ZW0uYXJyYXljb3B5KHVubWdkLCAwLCBsaXN0aW5nLCBkZWZpbmVkLnNp\nemUoKSwgdW5tZ2QubGVuZ3RoKTsKICAgICAgICAgICAgQXJyYXlzLnNvcnQo\nbGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFyYXRvci5nZXRJbnN0YW5jZSgp\nKTsKICAgICAgICAgICAgX2xpc3RpbmdGaWVsZHMgPSBsaXN0aW5nOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2xpc3RpbmdGaWVsZHM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YWNhY2hlIHRvIHVz\nZSBmb3IgdGhpcyBjbGFzcy4gSWYgdGhpcyBjbGFzcyBpcyBub3QKICAgICAq\nIGVsaWdpYmxlIGZvciBjYWNoaW5nIGJhc2VkIGl0cyBhbm5vdGF0aW9uIG9y\nIHRoZSBjYWNoZSBjb25maWd1cmF0aW9uCiAgICAgKiBudWxsIHdpbGwgYmUg\ncmV0dXJuZWQuCiAgICAgKiAKICAgICAqIEByZXR1cm4gVGhlIGNhY2hlIG5h\nbWUsIG9yIG51bGwgaWYgdGhpcyB0eXBlIHNob3VsZCBub3QgYmUgY2FjaGVk\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldERhdGFDYWNoZU5hbWUo\nKSB7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVxdWFscyhfY2FjaGVO\nYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBE\nYXRhQ2FjaGUuTkFNRV9ERUZBVUxUOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmKCFpc0NhY2hlYWJsZSgpKSB7IAogICAgICAgICAgICAgICBfY2Fj\naGVOYW1lID0gbnVsbDsgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9jYWNoZU5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGNhY2hlIG5hbWUgZm9yIHRoaXMgY2xhc3MuIFNldCB0byBudWxs\nIHRvIGRpc2FibGUgY2FjaGluZy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0RGF0YUNhY2hlTmFtZShTdHJpbmcgbmFtZSkgewogICAgICAgIF9jYWNo\nZU5hbWUgPSBuYW1lOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGNhY2hl\nIHRpbWVvdXQgZm9yIHRoaXMgY2xhc3MuIC0xIGluZGljYXRlcyBubyB0aW1l\nb3V0LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldERhdGFDYWNoZVRpbWVv\ndXQoKSB7CiAgICAgICAgaWYgKF9jYWNoZVRpbWVvdXQgPT0gSW50ZWdlci5N\nSU5fVkFMVUUpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YUNhY2hl\nVGltZW91dCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBf\nY2FjaGVUaW1lb3V0ID0gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS4KICAg\nICAgICAgICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfY2FjaGVUaW1lb3V0OwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIGNhY2hlIHRpbWVvdXQgZm9yIHRoaXMgY2xhc3Mu\nIC0xIGluZGljYXRlcyBubyB0aW1lb3V0LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXREYXRhQ2FjaGVUaW1lb3V0KGludCB0aW1lb3V0KSB7CiAgICAg\nICAgX2NhY2hlVGltZW91dCA9IHRpbWVvdXQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGRhdGEgY2FjaGUgZm9yIHRoaXMgY2xhc3MsIG9y\nIG51bGwgaWYgaXQgaXMgbm90IGNhY2hhYmxlLgogICAgICovCiAgICBwdWJs\naWMgRGF0YUNhY2hlIGdldERhdGFDYWNoZSgpIHsKICAgICAgICBTdHJpbmcg\nbmFtZSA9IGdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAobmFtZSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5nZXREYXRhQ2FjaGVNYW5h\nZ2VySW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0RGF0YUNhY2hlKG5hbWUs\nIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBpbnN0YW5j\nZXMgYXJlIGRldGFjaGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzRGV0YWNoYWJsZSgpIHsKICAgICAgICBpZiAoX2RldGFjaGFibGUgPT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfZGV0YWNoYWJsZSA9IChnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpLmlzRGV0YWNoYWJsZSgpKQogICAgICAgICAgICAgICAgICAgID8g\nQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgX2RldGFjaGFibGUgPSBCb29sZWFuLkZBTFNF\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2RldGFjaGFibGUuYm9vbGVh\nblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGluc3Rh\nbmNlcyBhcmUgZGV0YWNoYWJsZS4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0RGV0YWNoYWJsZShib29sZWFuIGRldGFjaGFibGUpIHsKICAgICAgICBf\nZGV0YWNoYWJsZSA9IChkZXRhY2hhYmxlKSA/IEJvb2xlYW4uVFJVRSA6IEJv\nb2xlYW4uRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBv\nZiB0aGUgZGV0YWNoIHN0YXRlIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0RGV0YWNoZWRTdGF0ZSgpIHsK\nICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9kZXRhY2hTdGF0\nZSkpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51\nbGwgJiYgc3VwLmlzRGV0YWNoYWJsZSgpID09IGlzRGV0YWNoYWJsZSgpKQog\nICAgICAgICAgICAgICAgX2RldGFjaFN0YXRlID0gc3VwLmdldERldGFjaGVk\nU3RhdGUoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBC\nb29sZWFuIHVzZSA9IHVzZXNEZXRhY2hlZFN0YXRlKFNZTlRIRVRJQywgdHJ1\nZSk7CiAgICAgICAgICAgICAgICBfZGV0YWNoU3RhdGUgPSAoQm9vbGVhbi5G\nQUxTRS5lcXVhbHModXNlKSkgPyBudWxsIDogU1lOVEhFVElDOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZGV0YWNoU3RhdGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgZGV0YWNo\nIHN0YXRlIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldERldGFjaGVkU3RhdGUoU3RyaW5nIGZpZWxkKSB7CiAg\nICAgICAgX2RldGFjaFN0YXRlID0gZmllbGQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGRldGFjaCBzdGF0ZSBmaWVsZCwgb3IgbnVsbCBp\nZiBub25lLgogICAgICovCiAgICBwdWJsaWMgRmllbGQgZ2V0RGV0YWNoZWRT\ndGF0ZUZpZWxkKCkgewogICAgICAgIC8vIG5vIGNhY2hpbmc7IG9ubHkgdXNl\nZCBhdCBlbmhhbmNlbWVudAogICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSBn\nZXREZXRhY2hlZFN0YXRlKCk7CiAgICAgICAgaWYgKGZpZWxkTmFtZSA9PSBu\ndWxsIHx8IFNZTlRIRVRJQy5lcXVhbHMoZmllbGROYW1lKSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxkIGYgPSBSZWZsZWN0aW9u\nLmZpbmRGaWVsZChfdHlwZSwgZmllbGROYW1lLCBmYWxzZSk7CiAgICAgICAg\naWYgKGYgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGY7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nCiAgICAgICAgICAgICAgICBfbG9jLmdldCgibm8tZGV0YWNoLXN0YXRlIiwg\nZmllbGROYW1lLCBfdHlwZSkpOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciBhbiBpbnN0YW5jZSBvZiB0aGlzIHR5cGUgaGFzIGRldGFjaGVkIHN0\nYXRlLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhIGRldGFjaGVk\nIGluc3RhbmNlIG11c3QgaGF2ZSBkZXRhY2hlZCBzdGF0ZSwgZmFsc2UKICAg\nICAqIGlmIGl0IGRvZXMgbm90LCBhbmQgbnVsbCBpZiBpdCBtYXkgdXNlIGEK\nICAgICAqIG1hbnVhbGx5LWNvbnN0cnVjdGVkIGluc3RhbmNlIHdpdGhvdXQg\nZGV0YWNoZWQgc3RhdGUKICAgICAqLwogICAgcHVibGljIEJvb2xlYW4gdXNl\nc0RldGFjaGVkU3RhdGUoKSB7CiAgICAgICAgLy8gbm8gbmVlZCB0byBsZXQg\nY29uZiBkaXNhbGxvdyBiZWNhdXNlIGl0J3MgdGFrZW4gaW50byBhY2NvdW50\nIGluCiAgICAgICAgLy8gZ2V0RGV0YWNoZWRTdGF0ZSgpIGNhbGwKICAgICAg\nICByZXR1cm4gdXNlc0RldGFjaGVkU3RhdGUoZ2V0RGV0YWNoZWRTdGF0ZSgp\nLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGFuIGlu\nc3RhbmNlIG9mIHRoaXMgdHlwZSBoYXMgZGV0YWNoZWQgc3RhdGUsIGFzc3Vt\naW5nIHRoZSBnaXZlbgogICAgICogZGV0YWNoZWQgc3RhdGUgZmllbGQuCiAg\nICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIGEgZGV0YWNoZWQgaW5zdGFu\nY2UgbXVzdCBoYXZlIGRldGFjaGVkIHN0YXRlLCBmYWxzZQogICAgICogaWYg\naXQgZG9lcyBub3QsIGFuZCBudWxsIGlmIGl0IG1heSB1c2UgYQogICAgICog\nbWFudWFsbHktY29uc3RydWN0ZWQgaW5zdGFuY2Ugd2l0aG91dCBkZXRhY2hl\nZCBzdGF0ZQogICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gdXNlc0RldGFj\naGVkU3RhdGUoU3RyaW5nIGRldGFjaGVkRmllbGQsCiAgICAgICAgYm9vbGVh\nbiBjb25mRGlzYWxsb3dzKSB7CiAgICAgICAgaWYgKCFpc0RldGFjaGFibGUo\nKSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CgogICAgICAg\nIC8vIGlmIHdlIGRlY2xhcmUgYSBkZXRhY2hlZCBzdGF0ZSBmaWVsZCwgaGF2\nZSB0byB1c2UgaXQKICAgICAgICBpZiAoZGV0YWNoZWRGaWVsZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICBp\nZiAoIVNZTlRIRVRJQy5lcXVhbHMoZGV0YWNoZWRGaWVsZCkpCiAgICAgICAg\nICAgIHJldHVybiBCb29sZWFuLlRSVUU7CgogICAgICAgIC8vIGFsbG93IGNv\nbmYgdG8gZGlzYWxsb3cKICAgICAgICBpZiAoY29uZkRpc2FsbG93cyAmJiAh\nX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0RGV0\nYWNoU3RhdGVJbnN0YW5jZSgpLmdldERldGFjaGVkU3RhdGVGaWVsZCgpKQog\nICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgLy8g\naGF2ZSB0byB1c2UgZGV0YWNoZWQgc3RhdGUgdG8gc3RvcmUgZGF0YXN0b3Jl\nIGlkCiAgICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgpID09IElEX0RBVEFT\nVE9SRSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKCiAgICAg\nICAgLy8gYWxsb3cgZGV0YWNoZWQgc3RhdGUgdXNlLCBidXQgZG9uJ3QgcmVx\ndWlyZQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2xlYXIgY2FjaGVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGNsZWFyQWxsRmllbGRDYWNoZSgpIHsKICAgICAgICBfYWxs\nRmllbGRzID0gbnVsbDsKICAgICAgICBfYWxsREZHRmllbGRzID0gbnVsbDsK\nICAgICAgICBfYWxsUEtGaWVsZHMgPSBudWxsOwogICAgICAgIF9kZWZpbmVk\nRmllbGRzID0gbnVsbDsKICAgICAgICBfbGlzdGluZ0ZpZWxkcyA9IG51bGw7\nCiAgICAgICAgX2FsbExpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgICAgIF9m\naWVsZERhdGFUYWJsZSA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nbGVhciBkZWZpbmVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGNsZWFyRGVmaW5lZEZpZWxkQ2FjaGUoKSB7CiAgICAgICAgX2Rl\nZmluZWRGaWVsZHMgPSBudWxsOwogICAgICAgIF9saXN0aW5nRmllbGRzID0g\nbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlZCBmaWVs\nZCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckZpZWxk\nQ2FjaGUoKSB7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAg\nICAgX2ZpZWxkcyA9IG51bGw7CiAgICAgICAgX3VubWdkRmllbGRzID0gbnVs\nbDsKICAgICAgICBfdmVyc2lvbklkeCA9IEludGVnZXIuTUlOX1ZBTFVFOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVkIHN1YmNsYXNzIGRh\ndGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyU3ViY2xhc3ND\nYWNoZSgpIHsKICAgICAgICBfc3VicyA9IG51bGw7CiAgICAgICAgX3N1Yk1l\ndGFzID0gbnVsbDsKICAgICAgICBfbWFwU3ViTWV0YXMgPSBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogQ2xlYXIgaW1wbCBkYXRhIGFuZCBpbnRlcm1l\nZGlhdGUgZGF0YSB0YWJsZS4KICAgICAqLwogICAgdm9pZCBjbGVhckV4dHJh\nRmllbGREYXRhVGFibGUoKSB7CiAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0g\nbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENhY2hlIGZpZWxkIGFycmF5\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNhY2hlRmllbGRzKCkgewog\nICAgICAgIGdldEZpZWxkcygpOwogICAgICAgIGdldFByaW1hcnlLZXlGaWVs\nZHMoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAg\nICAgIHJldHVybiBfdHlwZS5nZXROYW1lKCkuaGFzaENvZGUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAg\nICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgQ2xhc3NNZXRh\nRGF0YSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1\ncm4gX3R5cGUgPT0gKChDbGFzc01ldGFEYXRhKSBvdGhlcikuZ2V0RGVzY3Jp\nYmVkVHlwZSgpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgY29tcGFyZVRvKE9i\namVjdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAg\nICAgICAgICByZXR1cm4gMDsKICAgICAgICByZXR1cm4gX3R5cGUuZ2V0TmFt\nZSgpLmNvbXBhcmVUbygoKENsYXNzTWV0YURhdGEpIG90aGVyKS4KICAgICAg\nICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSk7CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4g\nZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlc29sdmUgYW5kIHZhbGlk\nYXRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAg\nICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMgbWV0YWRhdGEuCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgZ2V0UmVzb2x2ZSgpIHsKICAgICAgICByZXR1\ncm4gX3Jlc01vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcmVzb2x2\nZSBtb2RlIGZvciB0aGlzIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRSZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgX3Jlc01vZGUg\nPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHJlc29sdmUgbW9k\nZSBmb3IgdGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0UmVzb2x2ZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlm\nIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX3Jlc01vZGUgPSBt\nb2RlOwogICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfcmVzTW9k\nZSB8PSBtb2RlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3Jlc01vZGUg\nJj0gfm1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIGFuZCB2\nYWxpZGF0ZSBtZXRhZGF0YS4gUmV0dXJuIHRydWUgaWYgYWxyZWFkeSByZXNv\nbHZlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVzb2x2ZShpbnQg\nbW9kZSkgewogICAgICAgIGlmICgoX3Jlc01vZGUgJiBtb2RlKSA9PSBtb2Rl\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpbnQgY3VyID0g\nX3Jlc01vZGU7CiAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKCiAgICAgICAg\naW50IHZhbCA9IF9yZXBvcy5nZXRWYWxpZGF0ZSgpOwogICAgICAgIGJvb2xl\nYW4gcnVudGltZSA9ICh2YWwgJiBfcmVwb3MuVkFMSURBVEVfUlVOVElNRSkg\nIT0gMDsKICAgICAgICBib29sZWFuIHZhbGlkYXRlID0KICAgICAgICAgICAg\nIUltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRSZXBvc2l0b3J5KCkuZ2V0\nQ29uZmlndXJhdGlvbigpLCBfdHlwZSkKICAgICAgICAgICAgfHwgKHZhbCAm\nIE1ldGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9VTkVOSEFOQ0VEKSA9PSAw\nOwoKICAgICAgICAvLyB3ZSBvbmx5IGRvIGFueSBhY3Rpb25zIGZvciBtZXRh\nZGF0YSBtb2RlCiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NRVRBKSAhPSAw\nICYmIChjdXIgJiBNT0RFX01FVEEpID09IDApIHsKICAgICAgICAgICAgcmVz\nb2x2ZU1ldGEocnVudGltZSk7CiAgICAgICAgICAgIGlmICh2YWxpZGF0ZSAm\nJiAodmFsICYgX3JlcG9zLlZBTElEQVRFX01FVEEpICE9IDApCiAgICAgICAg\nICAgICAgICB2YWxpZGF0ZU1ldGEocnVudGltZSk7CiAgICAgICAgfQogICAg\nICAgIGlmICgobW9kZSAmIE1PREVfTUFQUElORykgIT0gMCAmJiAoY3VyICYg\nTU9ERV9NQVBQSU5HKSA9PSAwKSB7CiAgICAgICAgICAgIHJlc29sdmVNYXBw\naW5nKHJ1bnRpbWUpOwogICAgICAgICAgICBpZiAodmFsaWRhdGUgJiYgKHZh\nbCAmIF9yZXBvcy5WQUxJREFURV9NQVBQSU5HKSAhPSAwKQogICAgICAgICAg\nICAgICAgdmFsaWRhdGVNYXBwaW5nKHJ1bnRpbWUpOwogICAgICAgIH0KICAg\nICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkdfSU5JVCkgIT0gMCAmJiAo\nY3VyICYgTU9ERV9NQVBQSU5HX0lOSVQpID09IDApCiAgICAgICAgICAgIGlu\naXRpYWxpemVNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1ldGEoYm9vbGVhbiBydW50aW1l\nKSB7CiAgICAgICAgYm9vbGVhbiBlbWJlZCA9IF9vd25lciAhPSBudWxsICYm\nIF9vd25lci5nZXREZWNsYXJlZFR5cGUoKSA9PSBfdHlwZTsKICAgICAgICBM\nb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0\nKChlbWJlZCkgPyAicmVzb2x2ZS1lbWJlZC1tZXRhIiA6ICJyZXNvbHZlLW1l\ndGEiLAogICAgICAgICAgICAgICAgdGhpcyArICJAIiArIFN5c3RlbS5pZGVu\ndGl0eUhhc2hDb2RlKHRoaXMpKSk7CgogICAgICAgIGlmIChydW50aW1lICYm\nICFfdHlwZS5pc0ludGVyZmFjZSgpICYmCiAgICAgICAgICAgICFJbXBsSGVs\ncGVyLmlzTWFuYWdlZFR5cGUoZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZpZ3Vy\nYXRpb24oKSxfdHlwZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVuaGFuY2VkIiwgX3R5cGUpKTsK\nCiAgICAgICAgLy8gYXJlIHdlIHRoZSB0YXJnZXQgb2YgYW4gZW1iZWRkZWQg\ndmFsdWU/CiAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAgIGlmIChf\nb3duZXIuZ2V0RmllbGRNZXRhRGF0YSgpLmdldERlZmluaW5nTWV0YURhdGEo\nKS4KICAgICAgICAgICAgICAgIGdldERlc2NyaWJlZFR5cGUoKS5pc0Fzc2ln\nbmFibGVGcm9tKF90eXBlKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVjdXJzZS1lbWJlZCIsIF9v\nd25lcikpOwoKICAgICAgICAgICAgLy8gY29weSBpbmZvIGZyb20gdGhlICJy\nZWFsIiBtZXRhZGF0YSBmb3IgdGhpcyB0eXBlCiAgICAgICAgICAgIENsYXNz\nTWV0YURhdGEgbWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YShfdHlwZSwgX2xv\nYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIG1ldGEucmVzb2x2ZShNT0RFX01F\nVEEpOwogICAgICAgICAgICBjb3B5KHRoaXMsIG1ldGEpOwogICAgICAgICAg\nICBfZW1iZWRkZWQgPSBCb29sZWFuLkZBTFNFOyAvLyBlbWJlZGRlZCBpbnN0\nYW5jZSBpc24ndCBlbWJlZGRlZC1vbmx5CiAgICAgICAgfQoKICAgICAgICAv\nLyBtYWtlIHN1cmUgc3VwZXJjbGFzcyBpcyByZXNvbHZlZAogICAgICAgIENs\nYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICBpZiAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgc3VwLnJl\nc29sdmUoTU9ERV9NRVRBKTsKICAgICAgICAgICAgaWYgKGVtYmVkKSB7CiAg\nICAgICAgICAgICAgICAvLyBlbWJlZGRlZCBpbnN0YW5jZSBhbHdheXMgcmVk\nZWZpbmUgYWxsIHN1cGVyY2xhc3MgZmllbGRzCiAgICAgICAgICAgICAgICBG\naWVsZE1ldGFEYXRhW10gc3VwcyA9IHN1cC5nZXRGaWVsZHMoKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0g\nbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB8fCAhX3N1cEZpZWxkTWFw\nLmNvbnRhaW5zS2V5KHN1cHNbaV0uZ2V0TmFtZSgpKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBhZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNb\naV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vw\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHN1cHNbaV0uZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIHJlc29sdmUgZmllbGRzIGFuZCByZW1v\ndmUgaW52YWxpZHMKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZDsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9maWVsZE1hcC52YWx1ZXMoKS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAvLyBvbmx5\nIHBhc3Mgb24gbWV0YWRhdGEgcmVzb2x2ZSBtb2RlIHNvIHRoYXQgbWV0YWRh\ndGEgaXMgYWx3YXlzCiAgICAgICAgICAgIC8vIHJlc29sdmVkIGJlZm9yZSBh\nbnkgb3RoZXIgcmVzb2x2ZSBtb2RlcyBvdXIgc3ViY2xhc3NlcyBwYXNzIGFs\nb25nCiAgICAgICAgICAgIGZtZCA9IChGaWVsZE1ldGFEYXRhKSBpdHIubmV4\ndCgpOwogICAgICAgICAgICBmbWQucmVzb2x2ZShNT0RFX01FVEEpOwoKICAg\nICAgICAgICAgaWYgKCFmbWQuaXNFeHBsaWNpdCgpCiAgICAgICAgICAgICAg\nICAmJiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nT0JKRUNUCiAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQ19VTlRZUEVECiAgICAgICAgICAgICAg\nICB8fCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nQVJSQVkKICAgICAgICAgICAgICAgICYmIGZtZC5nZXRFbGVtZW50KCkuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpCiAgICAgICAgICAgICAgICA9PSBKYXZhVHlw\nZXMuT0JKRUNUKSkpIHsKICAgICAgICAgICAgICAgIF9yZXBvcy5nZXRMb2co\nKS53YXJuKF9sb2MuZ2V0KCJybS1maWVsZCIsIGZtZCkpOwogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXRMaXN0aW5nSW5kZXgoKSAhPSAtMSkKICAgICAg\nICAgICAgICAgICAgICBmbWQuc2V0TWFuYWdlbWVudChmbWQuTUFOQUdFX05P\nTkUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIGNsZWFyRmllbGRDYWNo\nZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBlbWJl\nZGRlZCBpbnN0YW5jZXMgbXVzdCBlbWJlZCBhbGwgc3VwZXJjbGFzcyBmaWVs\nZHMgdG9vCiAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAgIGNsZWFy\nQWxsRmllbGRDYWNoZSgpOwogICAgICAgICAgICByZXNvbHZlRGVmaW5lZFN1\ncGVyY2xhc3NGaWVsZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIHRoaXMg\nZW5zdXJlcyB0aGF0IGFsbCBmaWVsZCBpbmRleGVzIGdldCBzZXQgd2hlbiBm\naWVsZHMgYXJlIGNhY2hlZAogICAgICAgIGNhY2hlRmllbGRzKCk7CgogICAg\nICAgIC8vIHJlc29sdmUgbGlmZWN5Y2xlIG1ldGFkYXRhIG5vdyB0byBwcmV2\nZW50IGxhenkgdGhyZWFkaW5nIHByb2JsZW1zCiAgICAgICAgX2xpZmVNZXRh\nLnJlc29sdmUoKTsKCiAgICAgICAgLy8gcmVjb3JkIGltcGxlbWVudHMgaW4g\ndGhlIHJlcG9zaXRvcnkKICAgICAgICBpZiAoX2ludGVyZmFjZXMgIT0gbnVs\nbCkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ID0gX2ludGVyZmFj\nZXMuaXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nIF9yZXBvcy5hZGREZWNsYXJlZEludGVyZmFjZUltcGwodGhpcywgKENsYXNz\nKSBpdC5uZXh0KCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzb2x2ZSBm\nZXRjaCBncm91cHMKICAgICAgICBpZiAoX2ZnTWFwICE9IG51bGwpCiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2ZnTWFwLnZhbHVlcygpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgKChG\nZXRjaEdyb3VwKSBpdHIubmV4dCgpKS5yZXNvbHZlKCk7CgogICAgICAgIGlm\nICghZW1iZWQgJiYgX3R5cGUuaXNJbnRlcmZhY2UoKSkgewogICAgICAgICAg\nICBpZiAoX2ludGVyZmFjZSAhPSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImlu\ndGVyZmFjZSIsIF90eXBlKSk7CgogICAgICAgICAgICBpZiAocnVudGltZSkg\newogICAgICAgICAgICAgICAgX2ltcGwgPSBfcmVwb3MuZ2V0SW1wbEdlbmVy\nYXRvcigpLmNyZWF0ZUltcGwodGhpcyk7CiAgICAgICAgICAgICAgICBfcmVw\nb3Muc2V0SW50ZXJmYWNlSW1wbCh0aGlzLCBfaW1wbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgaXMgcnVudGltZSwg\nY3JlYXRlIGEgcGMgaW5zdGFuY2UgYW5kIHNjYW4gaXQgZm9yIGNvbXBhcmF0\nb3JzCiAgICAgICAgaWYgKHJ1bnRpbWUgJiYgIU1vZGlmaWVyLmlzQWJzdHJh\nY3QoX3R5cGUuZ2V0TW9kaWZpZXJzKCkpKSB7CiAgICAgICAgICAgIFByb3h5\nU2V0dXBTdGF0ZU1hbmFnZXIgc20gPSBuZXcgUHJveHlTZXR1cFN0YXRlTWFu\nYWdlcigpOwogICAgICAgICAgICBzbS5zZXRQcm94eURhdGEoUENSZWdpc3Ry\neS5uZXdJbnN0YW5jZShfdHlwZSwgc20sIGZhbHNlKSwgdGhpcyk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgcmVzb2x2ZWQg\nbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHZhbGlkYXRl\nTWV0YShib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICB2YWxpZGF0ZURhdGFD\nYWNoZSgpOwogICAgICAgIHZhbGlkYXRlRGV0YWNoYWJsZSgpOwogICAgICAg\nIHZhbGlkYXRlRXh0ZW5zaW9uS2V5cygpOwogICAgICAgIHZhbGlkYXRlSWRl\nbnRpdHkoKTsKICAgICAgICB2YWxpZGF0ZUFjY2Vzc1R5cGUoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlc29sdmUgbWFwcGluZyBkYXRhLiBMb2dzIHJl\nc29sdmUgbWVzc2FnZSBhbmQgcmVzb2x2ZXMgc3VwZXIgYnkgZGVmYXVsdC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1hcHBpbmcoYm9v\nbGVhbiBydW50aW1lKSB7CiAgICAgICAgTG9nIGxvZyA9IF9yZXBvcy5nZXRM\nb2coKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgicmVzb2x2ZS1tYXBwaW5nIiwg\ndGhpcyArICJAIgogICAgICAgICAgICAgICAgKyBTeXN0ZW0uaWRlbnRpdHlI\nYXNoQ29kZSh0aGlzKSkpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgc3VwZXJj\nbGFzcyBpcyByZXNvbHZlZCBmaXJzdAogICAgICAgIENsYXNzTWV0YURhdGEg\nc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAo\nc3VwICE9IG51bGwpCiAgICAgICAgICAgIHN1cC5yZXNvbHZlKE1PREVfTUFQ\nUElORyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBtYXBwaW5n\nIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHZhbGlkYXRlTWFw\ncGluZyhib29sZWFuIHJ1bnRpbWUpIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIEluaXRpYWxpemUgbWFwcGluZy4gTG9ncyBpbml0IG1lc3NhZ2UgYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgaW5pdGlhbGl6ZU1h\ncHBpbmcoKSB7CiAgICAgICAgTG9nIGxvZyA9IF9yZXBvcy5nZXRMb2coKTsK\nICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nIGxvZy50cmFjZShfbG9jLmdldCgiaW5pdC1tYXBwaW5nIiwgdGhpcyArICJA\nIgogICAgICAgICAgICAgICAgKyBTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0\naGlzKSkpOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgZGF0YSBj\nYWNoZSBzZXR0aW5ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlk\nYXRlRGF0YUNhY2hlKCkgewogICAgICAgIGludCB0aW1lb3V0ID0gZ2V0RGF0\nYUNhY2hlVGltZW91dCgpOwogICAgICAgIGlmICh0aW1lb3V0IDwgLTEgfHwg\ndGltZW91dCA9PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImNhY2hlLXRpbWVvdXQtaW52YWxpZCIsCiAg\nICAgICAgICAgICAgICBfdHlwZSwgU3RyaW5nLnZhbHVlT2YodGltZW91dCkp\nKTsKCiAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgU3RyaW5nIGNhY2hlID0gZ2V0RGF0YUNhY2hlTmFt\nZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIFN0cmluZyBzdXBlckNhY2hlID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKS5nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5lcXVhbHMoY2FjaGUsIHN1cGVyQ2FjaGUpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImNhY2hlLW5hbWVzIiwgbmV3IE9iamVjdFtdCiAgICAgICAgICAgICAg\nICB7IF90eXBlLCBjYWNoZSwgX3N1cGVyLCBzdXBlckNhY2hlIH0pKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSBpZGVudGl0eSBo\nYW5kbGluZyBmb3IgdGhpcyBjbGFzcyBpcyB2YWxpZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHZhbGlkYXRlSWRlbnRpdHkoKSB7CiAgICAgICAgLy8g\nbWFrZSBzdXJlIGlkZW50aXR5IHR5cGVzIGFyZSBjb25zaXN0ZW50CiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgICAgIGludCBpZCA9IGdldElkZW50aXR5VHlwZSgpOwogICAg\nICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBlKCkg\nIT0gSURfVU5LTk9XTgogICAgICAgICAgICAmJiBzdXAuZ2V0SWRlbnRpdHlU\neXBlKCkgIT0gaWQpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiaWQtdHlwZXMiLCBfdHlwZSkpOwoKICAgICAg\nICAvLyBjaGVjayBmb3IgdGhpbmdzIHRoZSBkYXRhIHN0b3JlIGRvZXNuJ3Qg\nc3VwcG9ydAogICAgICAgIENvbGxlY3Rpb24gb3B0cyA9IF9yZXBvcy5nZXRD\nb25maWd1cmF0aW9uKCkuc3VwcG9ydGVkT3B0aW9ucygpOwogICAgICAgIGlm\nIChpZCA9PSBJRF9BUFBMSUNBVElPTgogICAgICAgICAgICAmJiAhb3B0cy5j\nb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fSURfQVBQTElD\nQVRJT04pKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldCgiYXBwaWQtbm90LXN1cHBvcnRlZCIsCiAgICAg\nICAgICAgICAgICBfdHlwZSkpOwogICAgICAgIH0KICAgICAgICBpZiAoaWQg\nPT0gSURfREFUQVNUT1JFCiAgICAgICAgICAgICYmICFvcHRzLmNvbnRhaW5z\nKE9wZW5KUEFDb25maWd1cmF0aW9uLk9QVElPTl9JRF9EQVRBU1RPUkUpKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihf\nbG9jLmdldAogICAgICAgICAgICAgICAgKCJkYXRhc3RvcmVpZC1ub3Qtc3Vw\ncG9ydGVkIiwgX3R5cGUpKTsKICAgICAgICB9CgogICAgICAgIGlmIChpZCA9\nPSBJRF9BUFBMSUNBVElPTikgewogICAgICAgICAgICBpZiAoX2lkU3RyYXRl\nZ3kgIT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImFwcGlkLXN0\ncmF0ZWd5IiwgX3R5cGUpKTsKICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENs\nYXNzKCk7CiAgICAgICAgfSBlbHNlIGlmIChpZCAhPSBJRF9VTktOT1dOKQog\nICAgICAgICAgICB2YWxpZGF0ZU5vUEtGaWVsZHMoKTsKCiAgICAgICAgaW50\nIHN0cmF0ZWd5ID0gZ2V0SWRlbnRpdHlTdHJhdGVneSgpOwogICAgICAgIGlm\nIChzdHJhdGVneSA9PSBWYWx1ZVN0cmF0ZWdpZXMuU0VRVUVOQ0UKICAgICAg\nICAgICAgJiYgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSA9PSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLXNlcS1uYW1lIiwgX3R5cGUpKTsKCiAgICAgICAgVmFsdWVTdHJh\ndGVnaWVzLmFzc2VydFN1cHBvcnRlZChzdHJhdGVneSwgdGhpcywKICAgICAg\nICAgICAgImRhdGFzdG9yZSBpZGVudGl0eSBzdHJhdGVneSIpOwogICAgfQoK\nICAgIC8qKgogICAgICogTWFrZSBzdXJlIHRoZSBhcHBsaWNhdGlvbiBpZGVu\ndGl0eSBjbGFzcyBpcyB2YWxpZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHZhbGlkYXRlQXBwSWRDbGFzcygpIHsKICAgICAgICAvLyBiYXNlIHR5cGVz\nIG11c3QgZGVjbGFyZSBhbiBvaWQgY2xhc3MgaWYgbm90IHNpbmdsZS1maWVs\nZCBpZGVudGl0eQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBnZXRQ\ncmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgaWYgKGdldE9iamVjdElkVHlw\nZSgpID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHBrcy5sZW5ndGggPT0g\nMSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgidW5zdXBwb3J0ZWQtaWQtdHlwZSIsCiAgICAgICAgICAg\nICAgICAgICAgX3R5cGUsIHBrc1swXS5nZXROYW1lKCksCiAgICAgICAgICAg\nICAgICAgICAgcGtzWzBdLmdldERlY2xhcmVkVHlwZSgpLmdldE5hbWUoKSkp\nOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLWlkLWNsYXNzIiwgX3R5cGUpKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKF9vYmplY3RJZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGlmIChpc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAg\nICAgIGlmIChwa3NbMF0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFU\neXBlcy5PSUQpIHsKICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgZW1i\nZWQgPSBwa3NbMF0uZ2V0RW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAgICAg\nICAgICAgdmFsaWRhdGVBcHBJZENsYXNzTWV0aG9kcyhlbWJlZC5nZXREZXNj\ncmliZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENs\nYXNzUEtzKGVtYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSwKICAgICAgICAgICAg\nICAgICAgICBlbWJlZC5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlm\nIChfc3VwZXIgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBjb25jcmV0ZSBz\ndXBlcmNsYXNzIG9pZHMgbXVzdCBtYXRjaCBvciBiZSBwYXJlbnQgb2Ygb3Vy\ncwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CgogICAgICAgICAgICBDbGFzcyBvYmplY3RJZFR5\ncGUgPSBzdXAuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgICAgIGlmIChv\nYmplY3RJZFR5cGUgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAgICFv\nYmplY3RJZFR5cGUuaXNBc3NpZ25hYmxlRnJvbShfb2JqZWN0SWQpKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImlkLWNsYXNzZXMiLAogICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgX3R5cGUsIF9vYmplY3RJZCwgX3N1cGVyLAogICAgICAgICAg\nICAgICAgICAgICAgICBzdXAuZ2V0T2JqZWN0SWRUeXBlKCkgfSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyB2YWxpZGF0\nZSB0aGF0IG5vIG90aGVyIHBrcyBhcmUgZGVjbGFyZWQgaWYgd2UgaGF2ZSBh\nCiAgICAgICAgICAgIC8vIGNvbmNyZXRlIFBDIHN1cGVyY2xhc3MKICAgICAg\nICAgICAgaWYgKGhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCkpCiAgICAgICAg\nICAgICAgICB2YWxpZGF0ZU5vUEtGaWVsZHMoKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGlmIHRoaXMgY2xhc3MgaGFzIGl0cyBvd24gb2lkIGNsYXNzLCBk\nbyBzb21lIG1vcmUgdmFsaWRhdGlvbgogICAgICAgIGlmIChfc3VwZXIgPT0g\nbnVsbAogICAgICAgICAgICB8fCBfb2JqZWN0SWQgIT0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKS5nZXRPYmplY3RJZFR5cGUoKSkgewogICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgbm9uLWFic3RyYWN0IG9pZCBjbGFzc2VzIG92ZXJy\naWRlIHRoZSBwcm9wZXIgbWV0aG9kcwogICAgICAgICAgICBpZiAoIU1vZGlm\naWVyLmlzQWJzdHJhY3QoX29iamVjdElkLmdldE1vZGlmaWVycygpKSkKICAg\nICAgICAgICAgICAgIHZhbGlkYXRlQXBwSWRDbGFzc01ldGhvZHMoX29iamVj\ndElkKTsKCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgYXBwIGlkIGNs\nYXNzIGhhcyBhbGwgcGsgZmllbGRzCiAgICAgICAgICAgIHZhbGlkYXRlQXBw\nSWRDbGFzc1BLcyh0aGlzLCBwa3MsIF9vYmplY3RJZCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhpcyBjbGFz\ncyBoYXMgYSBjb25jcmV0ZSBwZXJzaXN0ZW50IHN1cGVyY2xhc3MuCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNDb25jcmV0ZVBDU3VwZXJjbGFz\ncygpIHsKICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJh\nY3QoX3N1cGVyLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCkuaGFzQ29uY3JldGVQQ1N1cGVyY2xhc3MoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEVuc3VyZSB0aGF0IHRoZSB1c2VyIGhhcyBvdmVycmlkZGVuIHRo\nZSBlcXVhbHMgYW5kIGhhc2hDb2RlIG1ldGhvZHMsCiAgICAgKiBhbmQgaGFz\nIHRoZSBwcm9wZXIgY29uc3RydWN0b3JzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgdmFsaWRhdGVBcHBJZENsYXNzTWV0aG9kcyhDbGFzcyBvaWQpIHsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBvaWQuZ2V0Q29uc3RydWN0b3Io\nKENsYXNzW10pIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibnVsbC1jb25zIiwgX3R5cGUpKS4KICAgICAgICAgICAgICAg\nIHNldENhdXNlKGUpOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgZm9y\nIGVxdWFscyBhbmQgaGFzaGNvZGUgb3ZlcnJpZGVzOyBkb24ndCBlbmZvcmNl\nIGl0CiAgICAgICAgLy8gZm9yIGFic3RyYWN0IGFwcCBpZCBjbGFzc2VzLCBz\naW5jZSB0aGV5IG1heSBub3QgbmVjZXNzYXJpbHkKICAgICAgICAvLyBkZWNs\nYXJlIHByaW1hcnkga2V5IGZpZWxkcwogICAgICAgIE1ldGhvZCBtZXRob2Q7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0aG9kID0gb2lkLmdldE1l\ndGhvZCgiZXF1YWxzIiwgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKS5zZXRGYXRhbCh0cnVlKTsK\nICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gYWJzID0gTW9kaWZpZXIuaXNB\nYnN0cmFjdChfdHlwZS5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgaWYgKCFh\nYnMgJiYgbWV0aG9kLmdldERlY2xhcmluZ0NsYXNzKCkgPT0gT2JqZWN0LmNs\nYXNzKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImVxLW1ldGhvZCIsIF90eXBlKSk7CgogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIG1ldGhvZCA9IG9pZC5nZXRNZXRob2QoImhhc2hDb2Rl\nIiwgKENsYXNzW10pIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKGUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoIWFi\ncyAmJiBtZXRob2QuZ2V0RGVjbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xh\nc3MpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiaGMtbWV0aG9kIiwgX3R5cGUpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIHByaW1hcnkga2V5IGNsYXNzIGhh\ncyBhbGwgcGsgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFs\naWRhdGVBcHBJZENsYXNzUEtzKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcywgQ2xhc3Mgb2lkKSB7CiAgICAgICAg\naWYgKGZtZHMubGVuZ3RoID09IDAgJiYgIU1vZGlmaWVyLmlzQWJzdHJhY3Qo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuCiAgICAgICAgICAgIGdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1wayIsIF90eXBlKSk7CgogICAgICAgIC8vIGNo\nZWNrIHRoYXQgdGhlIG9pZCB0eXBlIGNvbnRhaW5zIGFsbCBwayBmaWVsZHMK\nICAgICAgICBGaWVsZCBmOwogICAgICAgIE1ldGhvZCBtOwogICAgICAgIENs\nYXNzIGM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGMgPSBmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpLmdldENvbXBvbmVudFR5cGUoKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoYyA9PSBieXRlLmNsYXNzIHx8IGMgPT0gQnl0ZS5j\nbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBjID09IGNoYXIuY2xh\nc3MgfHwgYyA9PSBDaGFyYWN0ZXIuY2xhc3MpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJyZWFrCiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk9JRDogLy8gd2UncmUgdmFsaWRhdGluZyBlbWJlZGRl\nZCBmaWVsZHMKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1way10eXBlIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgZm1kc1tpXSkpOwogICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICBjID0gZm1kc1tpXS5nZXRPYmpl\nY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQUNDRVNTX0ZJRUxEKSB7CiAg\nICAgICAgICAgICAgICBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkLCBm\nbWRzW2ldLmdldE5hbWUoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYg\nKGYgPT0gbnVsbCB8fCAhZi5nZXRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShj\nKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImludmFsaWQtaWQiLAogICAgICAgICAgICAgICAg\nICAgICAgICBfdHlwZSwgZm1kc1tpXS5nZXROYW1lKCkpKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBBQ0NFU1Nf\nUFJPUEVSVFkpIHsKICAgICAgICAgICAgICAgIG0gPSBSZWZsZWN0aW9uLmZp\nbmRHZXR0ZXIob2lkLCBmbWRzW2ldLmdldE5hbWUoKSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCB8fCAhbS5nZXRSZXR1cm5UeXBl\nKCkuaXNBc3NpZ25hYmxlRnJvbShjKSkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQt\naWQiLAogICAgICAgICAgICAgICAgICAgICAgICBfdHlwZSwgZm1kc1tpXS5n\nZXROYW1lKCkpKTsKICAgICAgICAgICAgICAgIG0gPSBSZWZsZWN0aW9uLmZp\nbmRTZXR0ZXIob2lkLCBmbWRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgICAgICBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlKCksIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIGlmIChtID09IG51bGwgfHwgbS5nZXRSZXR1\ncm5UeXBlKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQt\naWQiLAogICAgICAgICAgICAgICAgICAgICAgICBfdHlwZSwgZm1kc1tpXS5n\nZXROYW1lKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhpcyBjbGFzcyBkb2Vzbid0\nIGRlY2xhcmUgYW55IHByaW1hcnkga2V5IGZpZWxkcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHZhbGlkYXRlTm9QS0ZpZWxkcygpIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc1ByaW1hcnlLZXkoKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLXBrIiwgZmllbGRzW2ldKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBc3NlcnQgdGhhdCB0aGlzIGNsYXNzJyBhY2Nlc3MgdHlwZSBp\ncyBhbGxvd2VkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVB\nY2Nlc3NUeXBlKCkgewogICAgICAgIGlmIChfYWNjZXNzVHlwZSA9PSBBQ0NF\nU1NfVU5LTk9XTikKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIENsYXNz\nTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldEFjY2Vzc1R5cGUoKSAh\nPSBBQ0NFU1NfVU5LTk9XTgogICAgICAgICAgICAmJiBzdXAuZ2V0QWNjZXNz\nVHlwZSgpICE9IF9hY2Nlc3NUeXBlICYmCiAgICAgICAgICAgIGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkuZ2V0RmllbGRzKCkubGVuZ3RoID4gMCkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImluY29uc2lzdGVudC1hY2Nlc3MiLAogICAgICAgICAgICAgICAgdGhp\ncywgc3VwKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXNz\nZXJ0IHRoYXQgZGV0YWNobWVudCBjb25maWd1cmF0aW9uIGlzIHZhbGlkLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVEZXRhY2hhYmxlKCkg\newogICAgICAgIGJvb2xlYW4gZmlyc3QgPSB0cnVlOwogICAgICAgIGZvciAo\nQ2xhc3NNZXRhRGF0YSBwYXJlbnQgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgICAgICAgICBmaXJzdCAmJiBwYXJlbnQgIT0gbnVsbDsgcGFy\nZW50ID0gcGFyZW50LmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpCiAgICAg\nICAgewogICAgICAgICAgICBpZiAocGFyZW50LmlzRGV0YWNoYWJsZSgpKQog\nICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIEZpZWxkIGZpZWxkID0gZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCk7CiAg\nICAgICAgaWYgKGZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKCFm\naXJzdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgicGFyZW50LWRldGFjaC1zdGF0ZSIsCiAgICAgICAg\nICAgICAgICAgICAgX3R5cGUpKTsKICAgICAgICAgICAgaWYgKGdldEZpZWxk\nKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibWFuYWdlZC1k\nZXRhY2gtc3RhdGUiLAogICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldE5h\nbWUoKSwgX3R5cGUpKTsKICAgICAgICAgICAgaWYgKGZpZWxkLmdldFR5cGUo\nKSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kZXRhY2gtc3RhdGUi\nLAogICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldE5hbWUoKSwgX3R5cGUp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vCiAgICAv\nLyBGZXRjaCBHcm91cAogICAgLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGZldGNoIGdyb3VwcyBkZWNsYXJlZCBleHBsaWNp\ndGx5IGluIHRoaXMgdHlwZS4KICAgICAqLwogICAgcHVibGljIEZldGNoR3Jv\ndXBbXSBnZXREZWNsYXJlZEZldGNoR3JvdXBzKCkgewogICAgICAgIGlmIChf\nZmdzID09IG51bGwpCiAgICAgICAgICAgIF9mZ3MgPSAoX2ZnTWFwID09IG51\nbGwpID8gRU1QVFlfRkVUQ0hfR1JPVVBfQVJSQVkgOiAoRmV0Y2hHcm91cFtd\nKQogICAgICAgICAgICAgICAgX2ZnTWFwLnZhbHVlcygpLnRvQXJyYXkobmV3\nIEZldGNoR3JvdXBbX2ZnTWFwLnNpemUoKV0pOyAKICAgICAgICByZXR1cm4g\nX2ZnczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgZmV0Y2gg\nZ3JvdXBzIGZvciB0aGlzIHR5cGUsIGluY2x1ZGluZyBzdXBlcmNsYXNzIGdy\nb3Vwcy4KICAgICAqLwogICAgcHVibGljIEZldGNoR3JvdXBbXSBnZXRDdXN0\nb21GZXRjaEdyb3VwcygpIHsKICAgICAgICBpZiAoX2N1c3RvbUZHcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIC8vIG1hcCBmZ3MgdG8gbmFtZXMsIGFsbG93\naW5nIG91ciBmZ3MgdG8gb3ZlcnJpZGUgc3VwZXJzCiAgICAgICAgICAgIE1h\ncCBmZ3MgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAg\nICAgICAgRmV0Y2hHcm91cFtdIHN1cEZHcyA9IHN1cC5nZXRDdXN0b21GZXRj\naEdyb3VwcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzdXBGR3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZmdz\nLnB1dChzdXBGR3NbaV0uZ2V0TmFtZSgpLCBzdXBGR3NbaV0pOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIEZldGNoR3JvdXBbXSBkZWNzID0gZ2V0RGVj\nbGFyZWRGZXRjaEdyb3VwcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGRlY3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBmZ3Mu\ncHV0KGRlY3NbaV0uZ2V0TmFtZSgpLCBkZWNzW2ldKTsKICAgICAgICAgICAg\nCiAgICAgICAgICAgIC8vIHJlbW92ZSBzdGQgZ3JvdXBzCiAgICAgICAgICAg\nIGZncy5yZW1vdmUoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQpOwogICAgICAg\nICAgICBmZ3MucmVtb3ZlKEZldGNoR3JvdXAuTkFNRV9BTEwpOwoKICAgICAg\nICAgICAgX2N1c3RvbUZHcyA9IChGZXRjaEdyb3VwW10pIGZncy52YWx1ZXMo\nKS50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IEZldGNoR3JvdXBbZmdz\nLnNpemUoKV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2N1c3RvbUZH\nczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgYSBuYW1lZCBmZWN0aCBn\ncm91cC4gSWYgbm90IGF2YWlsYWJsZSBpbiB0aGlzIHJlY2VpdmVyIHRoZW4g\nbG9va3MKICAgICAqIHVwIHRoZSBpbmhlcml0ZW5jZSBoaWVyYXJjaHkuIAog\nICAgICoKICAgICAqIEBwYXJhbSBuYW1lIG5hbWUgb2YgYSBmZXRjaCBncm91\ncC4KICAgICAqIEByZXR1cm4gYW4gZXhpc3RpbmcgZmVjdGggZ3JvdXAgb2Yg\ndGhlIGdpdmVuIG5hbWUgaWYga25vd24gdG8gdGhpcyAKICAgICAqIHJlY2Vp\ndmVyIG9yIGFueSBvZiBpdHMgc3VwZXJjbGFzc2VzLiBPdGhlcndpc2UgbnVs\nbC4KICAgICAqLwogICAgcHVibGljIEZldGNoR3JvdXAgZ2V0RmV0Y2hHcm91\ncChTdHJpbmcgbmFtZSkgewogICAgICAgIEZldGNoR3JvdXAgZmcgPSAoX2Zn\nTWFwID09IG51bGwpID8gbnVsbCA6IChGZXRjaEdyb3VwKSBfZmdNYXAuZ2V0\nKG5hbWUpOwogICAgICAgIGlmIChmZyAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmc7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIHN1cC5nZXRGZXRjaEdyb3VwKG5hbWUpOwog\nICAgICAgIGlmIChGZXRjaEdyb3VwLk5BTUVfREVGQVVMVC5lcXVhbHMobmFt\nZSkpCiAgICAgICAgICAgIHJldHVybiBGZXRjaEdyb3VwLkRFRkFVTFQ7CiAg\nICAgICAgaWYgKEZldGNoR3JvdXAuTkFNRV9BTEwuZXF1YWxzKG5hbWUpKQog\nICAgICAgICAgICByZXR1cm4gRmV0Y2hHcm91cC5BTEw7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGZldGNoIGdy\nb3VwIG9mIHRoZSBnaXZlbiBuYW1lLCBvciByZXR1cm5zIGV4aXN0aW5nIGlu\nc3RhbmNlLgogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIGEgbm9uLW51bGws\nIG5vbi1lbXB0eSBuYW1lLiBNdXN0IGJlIHVuaXF1ZSB3aXRoaW4gdGhpcwog\nICAgICogcmVjZWl2ZXIncyBzY29wZS4gVGhlIHN1cGVyIGNsYXNzIDxlbT5t\nYXk8L2VtPiBoYXZlIGEgZ3JvdXAgd2l0aAogICAgICogdGhlIHNhbWUgbmFt\nZS4KICAgICAqLwogICAgcHVibGljIEZldGNoR3JvdXAgYWRkRGVjbGFyZWRG\nZXRjaEdyb3VwKFN0cmluZyBuYW1lKSB7CiAgICAJaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkobmFtZSkpCiAgICAJCXRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgiZW1wdHktZmctbmFtZSIsIHRoaXMpKTsKICAgICAg\nICBpZiAoX2ZnTWFwID09IG51bGwpCiAgICAgICAgICAgIF9mZ01hcCA9IG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IChGZXRjaEdy\nb3VwKSBfZmdNYXAuZ2V0KG5hbWUpOwogICAgICAgIGlmIChmZyA9PSBudWxs\nKSB7CiAgICAgICAgCWZnID0gbmV3IEZldGNoR3JvdXAodGhpcywgbmFtZSk7\nCiAgICAgICAgCV9mZ01hcC5wdXQobmFtZSwgZmcpOwogICAgICAgICAgICBf\nZmdzID0gbnVsbDsKICAgICAgICAgICAgX2N1c3RvbUZHcyA9IG51bGw7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBmZzsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbW92ZSBhIGRlY2xhcmVkIGZldGNoIGdyb3VwLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiByZW1vdmVEZWNsYXJlZEZldGNoR3JvdXAoRmV0\nY2hHcm91cCBmZykgewogICAgICAgIGlmIChmZyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9mZ01hcC5yZW1vdmUo\nZmcuZ2V0TmFtZSgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIF9mZ3MgPSBu\ndWxsOwogICAgICAgICAgICBfY3VzdG9tRkdzID0gbnVsbDsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU291cmNl\nVHJhY2tlcgogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgRmls\nZSBnZXRTb3VyY2VGaWxlKCkgewogICAgICAgIHJldHVybiBfc3JjRmlsZTsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFNvdXJjZVNjb3BlKCkgewog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nU291cmNlVHlwZSgpIHsKICAgICAgICByZXR1cm4gX3NyY1R5cGU7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0U291cmNlKEZpbGUgZmlsZSwgaW50IHNy\nY1R5cGUpIHsKICAgICAgICBfc3JjRmlsZSA9IGZpbGU7CiAgICAgICAgX3Ny\nY1R5cGUgPSBzcmNUeXBlOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nUmVzb3VyY2VOYW1lKCkgewogICAgICAgIHJldHVybiBfdHlwZS5nZXROYW1l\nKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBpbnQgZ2V0TGluZU51bWJlcigp\nIHsKICAgICAgICByZXR1cm4gX2xpbmVOdW07CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0TGluZU51bWJlcihpbnQgbGluZU51bSkgewogICAgICAgIF9s\naW5lTnVtID0gbGluZU51bTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENv\nbE51bWJlcigpIHsKICAgICAgICByZXR1cm4gX2NvbE51bTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDb2xOdW1iZXIoaW50IGNvbE51bSkgewogICAg\nICAgIF9jb2xOdW0gPSBjb2xOdW07CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgc291cmNlIG1vZGUgdGhpcyBtZXRhZGF0YSBoYXMgYmVlbiBsb2FkZWQg\ndW5kZXIuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0U291cmNlTW9kZSgp\nIHsKICAgICAgICByZXR1cm4gX3NyY01vZGU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgc291cmNlIG1vZGUgdGhpcyBtZXRhZGF0YSBoYXMgYmVlbiBs\nb2FkZWQgdW5kZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJj\nZU1vZGUoaW50IG1vZGUpIHsKICAgICAgICBfc3JjTW9kZSA9IG1vZGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgdGhpcyBtZXRh\nZGF0YSBoYXMgYmVlbiBsb2FkZWQgdW5kZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFNvdXJjZU1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsK\nICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIF9z\ncmNNb2RlID0gbW9kZTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAg\nICAgX3NyY01vZGUgfD0gbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9zcmNNb2RlICY9IH5tb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIGluZGV4IGluIHdoaWNoIHRoaXMgY2xhc3Mgd2FzIGxpc3RlZCBpbiB0aGUg\nbWV0YWRhdGEuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT4tMTwvY29kZT4g\naWYgdGhpcyBjbGFzcyB3YXMgbm90IGxpc3RlZCBpbiB0aGUgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0TGlzdGluZ0luZGV4KCkgewog\nICAgICAgIHJldHVybiBfbGlzdEluZGV4OwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIGluZGV4IGluIHdoaWNoIHRoaXMgZmllbGQgd2FzIGxpc3RlZCBp\nbiB0aGUgbWV0YWRhdGEuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT4tMTwv\nY29kZT4gaWYgdGhpcyBjbGFzcyB3YXMgbm90IGxpc3RlZCBpbiB0aGUgbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExpc3RpbmdJbmRl\neChpbnQgaW5kZXgpIHsKICAgICAgICBfbGlzdEluZGV4ID0gaW5kZXg7CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb21tZW50YWJsZQog\nICAgLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIFN0cmluZ1tdIGdldENv\nbW1lbnRzKCkgewogICAgICAgIHJldHVybiAoX2NvbW1lbnRzID09IG51bGwp\nID8gRU1QVFlfQ09NTUVOVFMgOiBfY29tbWVudHM7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0Q29tbWVudHMoU3RyaW5nW10gY29tbWVudHMpIHsKICAg\nICAgICBfY29tbWVudHMgPSBjb21tZW50czsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLwogICAgLy8gU3RhdGUgY29weQogICAgLy8vLy8vLy8vLy8vLy8K\nCiAgICAvKioKICAgICAqIENvcHkgdGhlIG1ldGFkYXRhIGZyb20gdGhlIGdp\ndmVuIGluc3RhbmNlIHRvIHRoaXMgb25lLiBEbyBub3QKICAgICAqIGNvcHkg\nbWFwcGluZyBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nY29weShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkgIT0gX3R5cGUpCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIHN1cGVyLmNvcHko\nbWV0YSk7CgogICAgICAgIC8vIGNvcHkgY2xhc3MtbGV2ZWwgaW5mbzsgdXNl\nIGdldCBtZXRob2RzIHRvIGZvcmNlIHJlc29sdXRpb24gb2YKICAgICAgICAv\nLyBsYXp5IGRhdGEKICAgICAgICBfc3VwZXIgPSBtZXRhLmdldFBDU3VwZXJj\nbGFzcygpOwogICAgICAgIF9vYmplY3RJZCA9IG1ldGEuZ2V0T2JqZWN0SWRU\neXBlKCk7CiAgICAgICAgX2V4dGVudCA9IChtZXRhLmdldFJlcXVpcmVzRXh0\nZW50KCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAg\nICBfZW1iZWRkZWQgPSAobWV0YS5pc0VtYmVkZGVkT25seSgpKSA/IEJvb2xl\nYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgX2ludGVyZmFjZSA9\nIChtZXRhLmlzTWFuYWdlZEludGVyZmFjZSgpKSA/IEJvb2xlYW4uVFJVRSA6\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgc2V0SW50ZXJjZXB0aW5nKG1ldGEu\naXNJbnRlcmNlcHRpbmcoKSk7CiAgICAgICAgX2ltcGwgPSBtZXRhLmdldElu\ndGVyZmFjZUltcGwoKTsKICAgICAgICBfaWRlbnRpdHkgPSBtZXRhLmdldElk\nZW50aXR5VHlwZSgpOwogICAgICAgIF9pZFN0cmF0ZWd5ID0gbWV0YS5nZXRJ\nZGVudGl0eVN0cmF0ZWd5KCk7CiAgICAgICAgX3NlcU5hbWUgPSBtZXRhLmdl\ndElkZW50aXR5U2VxdWVuY2VOYW1lKCk7CiAgICAgICAgX3NlcU1ldGEgPSBu\ndWxsOwogICAgICAgIF9hbGlhcyA9IG1ldGEuZ2V0VHlwZUFsaWFzKCk7CiAg\nICAgICAgX2FjY2Vzc1R5cGUgPSBtZXRhLmdldEFjY2Vzc1R5cGUoKTsKCiAg\nICAgICAgLy8gb25seSBjb3B5IHRoaXMgaW5mb3JtYXRpb24gaWYgaXQgd2Fz\nbid0IHNldCBleHBsaWNpdGx5IGZvciB0aGlzCiAgICAgICAgLy8gaW5zdGFu\nY2UKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9jYWNoZU5h\nbWUpKQogICAgICAgICAgICBfY2FjaGVOYW1lID0gbWV0YS5nZXREYXRhQ2Fj\naGVOYW1lKCk7CiAgICAgICAgaWYgKF9jYWNoZVRpbWVvdXQgPT0gSW50ZWdl\nci5NSU5fVkFMVUUpCiAgICAgICAgICAgIF9jYWNoZVRpbWVvdXQgPSBtZXRh\nLmdldERhdGFDYWNoZVRpbWVvdXQoKTsKICAgICAgICBpZiAoX2RldGFjaGFi\nbGUgPT0gbnVsbCkKICAgICAgICAgICAgX2RldGFjaGFibGUgPSBtZXRhLl9k\nZXRhY2hhYmxlOwogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMo\nX2RldGFjaFN0YXRlKSkKICAgICAgICAgICAgX2RldGFjaFN0YXRlID0gbWV0\nYS5nZXREZXRhY2hlZFN0YXRlKCk7CgogICAgICAgIC8vIHN5bmNoIGZpZWxk\nIGluZm9ybWF0aW9uOyBmaXJzdCByZW1vdmUgZXh0cmEgZmllbGRzCiAgICAg\nICAgY2xlYXJGaWVsZENhY2hlKCk7CiAgICAgICAgX2ZpZWxkTWFwLmtleVNl\ndCgpLnJldGFpbkFsbChtZXRhLl9maWVsZE1hcC5rZXlTZXQoKSk7CgogICAg\nICAgIC8vIGFkZCBjb3BpZXMgb2YgZGVjbGFyZWQgZmllbGRzOyBvdGhlciBk\nZWZpbmVkIGZpZWxkcyBhbHJlYWR5IGNvcGllZAogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmaWVsZHMgPSBtZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBm\naWVsZCA9IGdldERlY2xhcmVkRmllbGQoZmllbGRzW2ldLmdldE5hbWUoKSk7\nCiAgICAgICAgICAgIGlmIChmaWVsZCA9PSBudWxsKQogICAgICAgICAgICAg\nICAgZmllbGQgPSBhZGREZWNsYXJlZEZpZWxkKGZpZWxkc1tpXS5nZXROYW1l\nKCksCiAgICAgICAgICAgICAgICAgICAgZmllbGRzW2ldLmdldERlY2xhcmVk\nVHlwZSgpKTsKICAgICAgICAgICAgZmllbGQuc2V0RGVjbGFyZWRJbmRleCgt\nMSk7CiAgICAgICAgICAgIGZpZWxkLnNldEluZGV4KC0xKTsKICAgICAgICAg\nICAgZmllbGQuY29weShmaWVsZHNbaV0pOwogICAgICAgIH0KCiAgICAgICAg\nLy8gY29weSBmZXRjaCBncm91cHMKICAgICAgICBGZXRjaEdyb3VwW10gZmdz\nID0gbWV0YS5nZXREZWNsYXJlZEZldGNoR3JvdXBzKCk7CiAgICAgICAgRmV0\nY2hHcm91cCBmZzsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZncy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBmZyA9IGFkZERlY2xhcmVkRmV0\nY2hHcm91cChmZ3NbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZmcuY29w\neShmZ3NbaV0pOyAKICAgICAgICB9CgogICAgICAgIC8vIGNvcHkgaWZhY2Ug\ncmUtbWFwcGluZwogICAgICAgIF9pZmFjZU1hcC5jbGVhcigpOwogICAgICAg\nIF9pZmFjZU1hcC5wdXRBbGwobWV0YS5faWZhY2VNYXApOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVjdXJzaXZlIGhlbHBlciB0byBjb3B5IGVtYmVkZGVk\nIG1ldGFkYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGNv\ncHkoQ2xhc3NNZXRhRGF0YSBlbWJlZCwgQ2xhc3NNZXRhRGF0YSBkZWMpIHsK\nICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGRlYy5nZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAg\nICAgICAgICBlbWJlZC5zZXRQQ1N1cGVyY2xhc3Moc3VwLmdldERlc2NyaWJl\nZFR5cGUoKSk7CiAgICAgICAgICAgIGNvcHkoZW1iZWQuZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKSwgc3VwKTsKICAgICAgICB9CiAgICAgICAgZW1iZWQu\nY29weShkZWMpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZEV4dGVu\nc2lvbktleXMoQ29sbGVjdGlvbiBleHRzKSB7CiAgICAgICAgX3JlcG9zLmdl\ndE1ldGFEYXRhRmFjdG9yeSgpLmFkZENsYXNzRXh0ZW5zaW9uS2V5cyhleHRz\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbXBhcmF0b3IgdXNlZCB0byBw\ndXQgZmllbGQgbWV0YWRhdGFzIGludG8gbGlzdGluZyBvcmRlci4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTGlzdGluZ09yZGVyQ29tcGFy\nYXRvcgogICAgICAgIGltcGxlbWVudHMgQ29tcGFyYXRvciB7CgogICAgICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExpc3RpbmdPcmRlckNvbXBhcmF0b3Ig\nX2luc3RhbmNlCiAgICAgICAgICAgID0gbmV3IExpc3RpbmdPcmRlckNvbXBh\ncmF0b3IoKTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQWNjZXNzIHNpbmds\nZXRvbiBpbnN0YW5jZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgc3Rh\ndGljIExpc3RpbmdPcmRlckNvbXBhcmF0b3IgZ2V0SW5zdGFuY2UoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfaW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IGNvbXBhcmUoT2JqZWN0IG8xLCBPYmplY3QgbzIpIHsK\nICAgICAgICAgICAgaWYgKG8xID09IG8yKQogICAgICAgICAgICAgICAgcmV0\ndXJuIDA7CiAgICAgICAgICAgIGlmIChvMSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIGlmIChvMiA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YSBmMSA9IChGaWVsZE1ldGFEYXRhKSBvMTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmMiA9IChGaWVsZE1ldGFEYXRhKSBvMjsKICAgICAg\nICAgICAgaWYgKGYxLmdldExpc3RpbmdJbmRleCgpID09IGYyLmdldExpc3Rp\nbmdJbmRleCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoZjEuZ2V0SW5kZXgo\nKSA9PSBmMi5nZXRJbmRleCgpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmMS5nZXRGdWxsTmFtZShmYWxzZSkuY29tcGFyZVRvCiAgICAgICAgICAg\nICAgICAgICAgICAgIChmMi5nZXRGdWxsTmFtZShmYWxzZSkpOwoJCQkJaWYg\nKGYxLmdldEluZGV4ICgpID09IC0xKQoJCQkJCXJldHVybiAxOwoJCQkJaWYg\nKGYyLmdldEluZGV4ICgpID09IC0xKQoJCQkJCXJldHVybiAtMTsKCQkJCXJl\ndHVybiBmMS5nZXRJbmRleCAoKSAtIGYyLmdldEluZGV4ICgpOwoJCQl9CQoJ\nCQlpZiAoZjEuZ2V0TGlzdGluZ0luZGV4ICgpID09IC0xKQoJCQkJcmV0dXJu\nIDE7CgkJCWlmIChmMi5nZXRMaXN0aW5nSW5kZXggKCkgPT0gLTEpCgkJCQly\nZXR1cm4gLTE7CgkJCXJldHVybiBmMS5nZXRMaXN0aW5nSW5kZXggKCkgLSBm\nMi5nZXRMaXN0aW5nSW5kZXggKCk7CgkJfQoJfQogICAgCiAgICBwdWJsaWMg\ndm9pZCByZWdpc3RlckZvclZhbHVlVXBkYXRlKFN0cmluZy4uLnZhbHVlcykg\newogICAgCWlmICh2YWx1ZXMgPT0gbnVsbCkKICAgIAkJcmV0dXJuOwogICAg\nCWZvciAoU3RyaW5nIGtleSA6IHZhbHVlcykgewogICAgCQlWYWx1ZSB2YWx1\nZSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkKICAgIAkJ\nCS5nZXRWYWx1ZShrZXkpOwogICAgCQlpZiAodmFsdWUgIT0gbnVsbCkKICAg\nIAkJCXZhbHVlLmFkZExpc3RlbmVyKHRoaXMpOwogICAgCX0KICAgIH0KICAg\nIAogICAgcHVibGljIHZvaWQgdmFsdWVDaGFuZ2VkKFZhbHVlIHZhbCkgewog\nICAgCWlmICh2YWwgPT0gIG51bGwpCiAgICAJCXJldHVybjsKICAgIAlTdHJp\nbmcga2V5ID0gdmFsLmdldFByb3BlcnR5KCk7CiAgICAJaWYgKCJEYXRhQ2Fj\naGVUaW1lb3V0Ii5lcXVhbHMoa2V5KSkgewogICAgCQlfY2FjaGVUaW1lb3V0\nID0gSW50ZWdlci5NSU5fVkFMVUU7CiAgICAJfQogICAgfQogICAgCiAgICAv\nKioKICAgICAqIERldGVybWluZSB3aGV0aGVyIHRoaXMgVHlwZSBzaG91bGQg\nYmUgaW5jbHVkZWQgaW4gdGhlIERhdGFDYWNoZSAoaWYgb25lCiAgICAgKiBp\ncyBwcm92aWRlZCkgYmFzZWQgb24gdGhlIERhdGFDYWNoZSdzIGNvbmZpZ3Vy\nYXRpb24uCiAgICAgKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgRGF0\nYUNhY2hlIHdpbGwgYWNjZXB0IHRoaXMgdHlwZSwgb3RoZXJ3aXNlIGZhbHNl\nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNDYWNoZWFibGUoKSB7\nCiAgICAJaWYgKF9pc0NhY2hlYWJsZSAhPSBudWxsKSB7CiAgICAJCXJldHVy\nbiBfaXNDYWNoZWFibGUuYm9vbGVhblZhbHVlKCk7CiAgICAJfQogICAgCSAg\nICAJCiAgICAJc2V0SXNDYWNoZWFibGUodHJ1ZSwgZmFsc2UpOwogICAgCXJl\ndHVybiBfaXNDYWNoZWFibGUuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiA8cD4KICAgICAqIFNldCB3aGV0aGVyIG9yIG5vdCB0aGUg\nY2xhc3MgcmVwcmVzZW50ZWQgYnkgdGhpcyBDbGFzc01ldGFEYXRhIG9iamVj\ndCBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIGRhdGFjYWNoZS4gVGhlCiAg\nICAgKiBhcmd1bWVudHMgcHJvdmlkZWQgYXJlICpoaW50cyogYXMgdG8gd2hl\ndGhlciB0aGUgY2xhc3Mgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBkYXRh\nY2FjaGUsIGFuZCBjYW4gYmUgb3ZlcnJpZGRlbgogICAgICogYnkgdGhlIGNv\nbmZpZ3VyYXRpb24gc2V0IGluIG9wZW5qcGEuRGF0YWNhY2hlLgogICAgICog\nPC9wPgogICAgICogCiAgICAgKiA8cD4KICAgICAqIFJ1bGVzIGZvciB0aGlz\nIGRldGVybWluYXRpb24gYXJlOgogICAgICogPC9wPgogICAgICogPG9sPgog\nICAgICogPGxpPklmIHRoZSBjbGFzcyBzaG93cyB1cCBpbiB0aGUgbGlzdCBv\nZiBleGNsdWRlZCB0eXBlcywgaXQgZG9lcyBub3QgZ2V0IGNhY2hlZCwgcGVy\naW9kLjwvbGk+CiAgICAgKiA8bGk+SWYgdGhlIGNsYXNzIGRvZXMgbm90IHNo\nb3cgdXAgaW4gdGhlIGV4Y2x1ZGVkIHR5cGVzLCBidXQgdGhlIGluY2x1ZGVk\nIHR5cGVzIGZpZWxkIGlzIHNldCAoaWUsIGhhcyBhdCBsZWFzdAogICAgICog\nb25lIGNsYXNzKSwgdGhlbjoKICAgICAqIDxvbD4KICAgICAqIDxsaT5JZiB0\naGUgY2xhc3MgaXMgbGlzdGVkIGluIHRoZSBpbmNsdWRlIGxpc3QsIHRoZW4g\naXQgZ2V0cyBjYWNoZWQ8L2xpPgogICAgICogPGxpPklmIHRoZSBjbGFzcyBp\ncyBzZXQgYXMgY2FjaGVhYmxlIGJ5IHRoZSBARGF0YWNhY2hlIGFubm90YXRp\nb24sIGl0IGdldHMgY2FjaGVkPC9saT4KICAgICAqIDxsaT5JZiBuZWl0aGVy\nIGEgb3IgYiBhcmUgdHJ1ZSwgdGhlbiB0aGUgY2xhc3MgZG9lcyBub3QgZ2V0\nIGNhY2hlZDwvbGk+CiAgICAgKiA8L29sPgogICAgICogPC9saT4KICAgICAq\nIDxsaT5JZiBuZWl0aGVyIHRoZSBpbmNsdWRlIG9yIGV4Y2x1ZGUgbGlzdHMg\nYXJlIGRlZmluZWQsIHRoZW4gZ28gYWxvbmcgd2l0aCB0aGUgdmFsdWUgcGFz\nc2VkIGludG8gdGhlIGFyZ3VtZW50LAogICAgICogd2hpY2ggaXMgZWl0aGVy\nIHRoZSBkZWZhdWx0IHZhbHVlICh0cnVlKSBvciB3aGF0ZXZlciB3YXMgc2V0\nIHdpdGggdGhlIEBEYXRhY2FjaGUgYW5ub3RhdGlvbjwvbGk+CiAgICAgKiA8\nL29sPgogICAgICogCiAgICAgKiBAcGFyYW0gaXNDYWNoZWFibGUKICAgICAq\nICAgICAgICAgICAgSGludCB3aGV0aGVyIHRoaXMgY2xhc3Mgc2hvdWxkIGJl\nIGluY2x1ZGVkIGluIHRoZSBkYXRhY2FjaGUuIERlZmF1bHQgYmVoYXZpb3Ig\naXMgeWVzLCB0aG91Z2ggdGhlCiAgICAgKiAgICAgICAgICAgIEBEYXRhY2Fj\naGUgYW5ub3RhdGlvbiBjYW4gc3BlY2lmeSBpZiBpdCBzaG91bGQgbm90IGJl\nIGNhY2hlZC4KICAgICAqIEBwYXJhbSBhbm5vdGF0aW9uT3ZlcnJpZGUKICAg\nICAqICAgICAgICAgICAgV2hldGhlciB0aGlzIGhpbnQgb3JpZ2luYXRlZCBm\ncm9tIHRoZSBARGF0YWNhY2hlIGFubm90YXRpb24gb3Igd2hldGhlciB0aGlz\nIGlzIHRoZSBkZWZhdWx0ICJ5ZXMiIGhpbnQuCiAgICAgKiAgICAgICAgICAg\nIFRoZSBvcmlnaW5hdGlvbiBvZiB0aGUgaGludCBpbmZsdWVuY2VzIHRoZSBk\nZWNpc2lvbiBtYWtpbmcgcHJvY2VzcyBpbiBydWxlICMyYi4KICAgICAqIAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJc0NhY2hlYWJsZShib29sZWFu\nIGlzQ2FjaGVhYmxlLCBib29sZWFuIGFubm90YXRpb25PdmVycmlkZSkgewog\nICAgCU9wdGlvbnMgZGF0YUNhY2hlT3B0aW9ucyA9IGdldERhdGFDYWNoZU9w\ndGlvbnMoKTsKICAgIAlTZXQgZXhjbHVkZWRUeXBlcyA9IGV4dHJhY3REYXRh\nQ2FjaGVDbGFzc0xpc3RpbmcoZGF0YUNhY2hlT3B0aW9ucy5nZXRQcm9wZXJ0\neSgiRXhjbHVkZWRUeXBlcyIsIG51bGwpKTsKICAgIAlTZXQgdHlwZXMgPSBl\neHRyYWN0RGF0YUNhY2hlQ2xhc3NMaXN0aW5nKGRhdGFDYWNoZU9wdGlvbnMu\nZ2V0UHJvcGVydHkoIlR5cGVzIiwgbnVsbCkpOwogICAgCQogICAgCVN0cmlu\nZyBjbGFzc05hbWUgPSBnZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpOwog\nICAgCWlmIChleGNsdWRlZFR5cGVzICE9IG51bGwgJiYgZXhjbHVkZWRUeXBl\ncy5jb250YWlucyhjbGFzc05hbWUpKSB7CiAgICAJCS8vIFJ1bGUgIzEKICAg\nIAkJX2lzQ2FjaGVhYmxlID0gQm9vbGVhbi5GQUxTRTsKICAgIAl9IGVsc2Ug\naWYgKHR5cGVzICE9IG51bGwpIHsKICAgIAkJLy8gUnVsZSAjMgogICAgCQlp\nZiAoKGFubm90YXRpb25PdmVycmlkZSAmJiBpc0NhY2hlYWJsZSkgfHwgKHR5\ncGVzLmNvbnRhaW5zKGNsYXNzTmFtZSkpKSB7CiAgICAJCQlfaXNDYWNoZWFi\nbGUgPSBCb29sZWFuLlRSVUU7CiAgICAJCX0gZWxzZSB7CiAgICAJCQlfaXND\nYWNoZWFibGUgPSBCb29sZWFuLkZBTFNFOwogICAgCQl9CiAgICAJfSBlbHNl\nIHsKICAgIAkJLy8gUnVsZSAjMwogICAgCQlfaXNDYWNoZWFibGUgPSBpc0Nh\nY2hlYWJsZSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAJ\nfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEV4dHJhY3QgYWxsIG9mIHRo\nZSBEYXRhQ2FjaGUgcGx1Z2luIG9wdGlvbnMgZnJvbSB0aGUgY29uZmlndXJh\ndGlvbgogICAgICogCiAgICAgKi8KICAgIHByaXZhdGUgT3B0aW9ucyBnZXRE\nYXRhQ2FjaGVPcHRpb25zKCkgewogICAgCVN0cmluZyBkYXRhQ2FjaGVDb25m\naWcgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLmdldERh\ndGFDYWNoZSgpOwogICAgCU9wdGlvbnMgZGF0YUNhY2hlT3B0aW9ucyA9IAog\nICAgCQlDb25maWd1cmF0aW9ucy5wYXJzZVByb3BlcnRpZXMoQ29uZmlndXJh\ndGlvbnMuZ2V0UHJvcGVydGllcyhkYXRhQ2FjaGVDb25maWcpKTsKICAgIAly\nZXR1cm4gZGF0YUNhY2hlT3B0aW9uczsgICAgCiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogVG9vbCB0byBleHRyYWN0IGNsYXNzZXMgZGVmaW5lZCBpbiB0\naGUgZGF0YWNhY2hlIGluY2x1ZGUgYW5kIGV4Y2x1ZGUgbGlzdCBpbnRvCiAg\nICAgKiBpbmRpdmlkdWFsIGVudHJpZXMgaW4gYSBTZXQuCiAgICAgKiAKICAg\nICAqLwogICAgcHJpdmF0ZSBmaW5hbCBTZXQgZXh0cmFjdERhdGFDYWNoZUNs\nYXNzTGlzdGluZyhTdHJpbmcgY2xhc3NMaXN0KSB7CiAgICAJaWYgKGNsYXNz\nTGlzdCA9PSBudWxsIHx8IGNsYXNzTGlzdC5sZW5ndGgoKSA9PSAwKQogICAg\nCQlyZXR1cm4gbnVsbDsKICAgIAkKICAgIAlIYXNoU2V0IHJldHVyblNldCA9\nIG5ldyBIYXNoU2V0KCk7CiAgICAJU3RyaW5nW10gZW50cmllcyA9IGNsYXNz\nTGlzdC5zcGxpdCgiOyIpOwogICAgCWZvciAoaW50IGluZGV4ID0gMDsgaW5k\nZXggPCBlbnRyaWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgCQlyZXR1cm5T\nZXQuYWRkKGVudHJpZXNbaW5kZXhdKTsKICAgIAl9CiAgICAJCiAgICAJcmV0\ndXJuIHJldHVyblNldDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRydWUgaWYgdGhlIHBjVHlwZSBtb2RlbGVkIGJ5IHRoaXMgQ2xhc3NN\nZXRhRGF0YQogICAgICogb2JqZWN0IGlzIGFic3RyYWN0IChpZSwgYSBNYXBw\nZWRTdXBlcmNsYXNzIGluIEpQQSB0ZXJtcy4pCiAgICAgKgogICAgICogQHJl\ndHVybgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Fic3RyYWN0KCkg\newogICAgICAgIHJldHVybiBfYWJzdHJhY3Q7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXRzIHRoZSB2YWx1ZSBkZXRlcm1pbmluZyBpZiB0aGUgcGNUeXBl\nIG1vZGVsZWQgYnkgdGhpcwogICAgICogQ2xhc3NNZXRhRGF0YSBvYmplY3Qg\naXMgYWJzdHJhY3QgKGllLCBhIE1hcHBlZFN1cGVyY2xhc3MgaW4gSlBBIHRl\ncm1zLikKICAgICAqCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEFic3RyYWN0KGJvb2xlYW4gZmxhZykgewogICAgICAgIF9h\nYnN0cmFjdCA9IGZsYWc7CiAgICAgICAgX2hhc0Fic3RyYWN0UEtGaWVsZCA9\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRo\nb2QgdG8gZGV0ZXJtaW5lIGlmIHRoZSBwY1R5cGUgbW9kZWxlZCBieQogICAg\nICogdGhpcyBDbGFzc01ldGFEYXRhIG9iamVjdCBpcyBib3RoIGFic3RyYWN0\nIGFuZCBkZWNsYXJlcyBQS0ZpZWxkcy4gVGhpcwogICAgICogbWV0aG9kIGlz\nIHVzZWQgYnkgdGhlIFBDRW5oYW5jZXIgdG8gZGV0ZXJtaW5lIGlmIHNwZWNp\nYWwgaGFuZGxpbmcgaXMKICAgICAqIHJlcXVpcmVkLgogICAgICoKICAgICAq\nIEByZXR1cm4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaGFzQWJzdHJh\nY3RQS0ZpZWxkKCkgewogICAgICAgIGlmIChfaGFzQWJzdHJhY3RQS0ZpZWxk\nICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIF9oYXNBYnN0cmFjdFBL\nRmllbGQuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBE\nZWZhdWx0IHRvIGZhbHNlLCBzZXQgdG8gdHJ1ZSBvbmx5IGlmIHRoaXMgdHlw\nZSBpcyBhYnN0cmFjdCBhbmQKICAgICAgICAvLyBkZWNsYXJlcyBhIFBLRmll\nbGQuCiAgICAgICAgX2hhc0Fic3RyYWN0UEtGaWVsZCA9IEJvb2xlYW4uRkFM\nU0U7CgogICAgICAgIGlmIChpc0Fic3RyYWN0KCkgPT0gdHJ1ZSkgewogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZGVjbGFyZWRGaWVsZHMgPSBnZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgICAgICBpZiAoZGVjbGFyZWRGaWVs\nZHMgIT0gbnVsbCAmJiBkZWNsYXJlZEZpZWxkcy5sZW5ndGggIT0gMCkgewog\nICAgICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IGRlY2xh\ncmVkRmllbGRzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZtZC5pc1By\naW1hcnlLZXkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfaGFzQWJz\ndHJhY3RQS0ZpZWxkID0gQm9vbGVhbi5UUlVFOwogICAgICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJl\ndHVybiBfaGFzQWJzdHJhY3RQS0ZpZWxkLmJvb2xlYW5WYWx1ZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIGRldGVy\nbWluZSBpZiB0aGlzIHR5cGUgaXMgYSBkaXJlY3QKICAgICAqIGRlY2VuZGVu\ndCBvZiBhbiBhYnN0cmFjdCB0eXBlIGRlY2xhcmluZyBQS0ZpZWxkcy4gUmV0\ndXJucyB0cnVlIGlmIHRoZXJlCiAgICAgKiBhcmUgbm8gcGNUeXBlcyBtYXBw\nZWQgdG8gYSB0YWJsZSBiZXR3ZWVuIHRoaXMgdHlwZSBhbmQgYW4gYWJzdHJh\nY3QgcGNUeXBlCiAgICAgKiBkZWNsYXJpbmcgUEtGaWVsZHMuIFJldHVybnMg\nZmFsc2UgaWYgdGhlcmUgbm8gc3VjaCBhYnN0cmFjdCBwY1R5cGVzIGluCiAg\nICAgKiB0aGUgaW5oZXJpdGFuY2UgaGllcmFyY2h5IG9yIGlmIHRoZXJlIGFy\nZSBhbnkgcGNUeXBlcyBtYXBwZWQgdG8gdGFibGVzIGluCiAgICAgKiBiZXR3\nZWVuIHRoZSB0eXBlIHJlcHJlc2VudGVkIGJ5IHRoaXMgQ2xhc3NNZXRhRGF0\nYSBvYmplY3QgYW5kIHRoZQogICAgICogYWJzdHJhY3QgcGNUeXBlIGRlY2xh\ncmluZyBQS0ZpZWxkcy4KICAgICAqCiAgICAgKiBAcmV0dXJuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGhhc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xh\nc3MoKSB7CiAgICAgICAgaWYgKF9oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENs\nYXNzICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIF9oYXNQS0ZpZWxk\nc0Zyb21BYnN0cmFjdENsYXNzLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gRGVmYXVsdCB0byBGQUxTRSwgdW50aWwgcHJvdmVuIHRy\ndWUuCiAgICAgICAgX2hhc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3MgPSBC\nb29sZWFuLkZBTFNFOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtGaWVs\nZHMgPSBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgZm9yIChGaWVs\nZE1ldGFEYXRhIGZtZCA6IHBrRmllbGRzKSB7CiAgICAgICAgICAgIENsYXNz\nTWV0YURhdGEgZm1kRE1EQSA9IGZtZC5nZXREZWNsYXJpbmdNZXRhRGF0YSgp\nOwogICAgICAgICAgICBpZiAoZm1kRE1EQS5pc0Fic3RyYWN0KCkpIHsKICAg\nICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHdoaWxlIChjbWQgIT0g\nZm1kRE1EQSkgewogICAgICAgICAgICAgICAgICAgIGlmIChmbWRETURBLmlz\nQWJzdHJhY3QoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbWQgPSBj\nbWQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBpZiAoY21kID09IGZtZERNREEpIHsKICAgICAgICAgICAg\nICAgICAgICBfaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFzcyA9IEJvb2xl\nYW4uVFJVRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0\ndXJuIF9oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNzLmJvb2xlYW5WYWx1\nZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

