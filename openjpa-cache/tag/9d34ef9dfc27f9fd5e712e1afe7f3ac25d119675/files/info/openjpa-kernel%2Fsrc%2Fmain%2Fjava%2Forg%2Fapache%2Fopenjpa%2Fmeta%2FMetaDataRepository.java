{"sha":"559b1ab16f4634149f4ece394b9c7fd4c62cf807","node_id":"MDQ6QmxvYjIwNjM2NDo1NTliMWFiMTZmNDYzNDE0OWY0ZWNlMzk0YjljN2ZkNGM2MmNmODA3","size":92587,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/559b1ab16f4634149f4ece394b9c7fd4c62cf807","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLlRyZWVTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkR5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3Ry\neS5SZWdpc3RlckNsYXNzTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3NlYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTXVsdGlDbGFz\nc0xvYWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlN0\ncmluZ0Rpc3RhbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklu\ndGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5PcGVuSlBBSWQ7CgppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7\nCgovKioKICogUmVwb3NpdG9yeSBvZiBhbmQgZmFjdG9yeSBmb3IgcGVyc2lz\ndGVudCBtZXRhZGF0YS4KICoKICogQHNpbmNlIDAuMy4wCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RldmUgS2ltIChxdWVyeSBtZXRhZGF0\nYSkKICovCnB1YmxpYyBjbGFzcyBNZXRhRGF0YVJlcG9zaXRvcnkKICAgIGlt\ncGxlbWVudHMgUENSZWdpc3RyeS5SZWdpc3RlckNsYXNzTGlzdGVuZXIsIENv\nbmZpZ3VyYWJsZSwgQ2xvc2VhYmxlLCAKICAgIE1ldGFEYXRhTW9kZXMsIFNl\ncmlhbGl6YWJsZSB7CiAgICAKICAgIHByb3RlY3RlZCBib29sZWFuIF9sb2Nr\naW5nID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIENvbnN0YW50IHRvIG5vdCB2\nYWxpZGF0ZSBhbnkgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IFZBTElEQVRFX05PTkUgPSAwOwoKICAgIC8qKgogICAg\nICogQml0IGZsYWcgdG8gdmFsaWRhdGUgbWV0YWRhdGEuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZBTElEQVRFX01FVEEgPSAxOwoK\nICAgIC8qKgogICAgICogQml0IGZsYWcgdG8gdmFsaWRhdGUgbWFwcGluZ3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZBTElEQVRF\nX01BUFBJTkcgPSAyOwoKICAgIC8qKgogICAgICogQml0IGZsYWcgdG8gdmFs\naWRhdGUgdW5lbmhhbmNlZCBtZXRhZGF0YSBvbmx5LgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9VTkVOSEFOQ0VEID0g\nNDsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIGZvciBydW50aW1lIHZhbGlk\nYXRpb24uIFJlcXVpcmVzIHRoYXQgYWxsIGNsYXNzZXMgYXJlCiAgICAgKiBl\nbmhhbmNlZCwgYW5kIHBlcmZvcm1zIGV4dHJhIGZpZWxkIHJlc29sdXRpb24g\nc3RlcHMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZB\nTElEQVRFX1JVTlRJTUUgPSA4OwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgQ2xhc3NbXSBFTVBUWV9DTEFTU0VTID0gbmV3IENsYXNzWzBdOwogICAg\ncHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBOb25QZXJzaXN0ZW50TWV0YURhdGFb\nXSBFTVBUWV9OT05fUEVSU0lTVEVOVCA9IAogICAgCW5ldyBOb25QZXJzaXN0\nZW50TWV0YURhdGFbMF07CiAgICBwcm90ZWN0ZWQgZmluYWwgQ2xhc3NNZXRh\nRGF0YVtdIEVNUFRZX01FVEFTOwogICAgcHJvdGVjdGVkIGZpbmFsIEZpZWxk\nTWV0YURhdGFbXSBFTVBUWV9GSUVMRFM7CiAgICBwcm90ZWN0ZWQgZmluYWwg\nT3JkZXJbXSBFTVBUWV9PUkRFUlM7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAg\nICAgIChNZXRhRGF0YVJlcG9zaXRvcnkuY2xhc3MpOwoKICAgIC8vIHN5c3Rl\nbSBzZXF1ZW5jZQogICAgcHJpdmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIF9zeXNT\nZXEgPSBudWxsOwoKICAgIC8vIGNhY2hlIG9mIHBhcnNlZCBtZXRhZGF0YSwg\nb2lkIGNsYXNzIHRvIGNsYXNzLCBhbmQgaW50ZXJmYWNlIGNsYXNzCiAgICAv\nLyB0byBtZXRhZGF0YXMKCXByaXZhdGUgTWFwIF9tZXRhcyA9IG5ldyBIYXNo\nTWFwKCk7Cglwcml2YXRlIE1hcCBfb2lkcyA9IENvbGxlY3Rpb25zLnN5bmNo\ncm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKCXByaXZhdGUgTWFwIF9pbXBs\ncyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgp\nKTsKCXByaXZhdGUgTWFwIF9pZmFjZXMgPSBDb2xsZWN0aW9ucy5zeW5jaHJv\nbml6ZWRNYXAobmV3IEhhc2hNYXAoKSk7Cglwcml2YXRlIE1hcCBfcXVlcmll\ncyA9IG5ldyBIYXNoTWFwKCk7Cglwcml2YXRlIE1hcCBfc2VxcyA9IG5ldyBI\nYXNoTWFwKCk7Cglwcml2YXRlIE1hcCBfYWxpYXNlcyA9IENvbGxlY3Rpb25z\nLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKCXByaXZhdGUgTWFw\nIF9wYXdhcmVzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBI\nYXNoTWFwKCkpOwoJcHJpdmF0ZSBNYXAgX25vbk1hcHBlZCA9IENvbGxlY3Rp\nb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKICAgIAogICAg\nLy8gbWFwIG9mIGNsYXNzZXMgdG8gbGlzdHMgb2YgdGhlaXIgc3ViY2xhc3Nl\ncwoJcHJpdmF0ZSBNYXAgX3N1YnMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6\nZWRNYXAobmV3IEhhc2hNYXAoKSk7CgogICAgLy8geG1sIG1hcHBpbmcKICAg\nIHByb3RlY3RlZCBmaW5hbCBYTUxNZXRhRGF0YVtdIEVNUFRZX1hNTE1FVEFT\nOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX3htbG1ldGFzID0gbmV3IEhhc2hN\nYXAoKTsKCiAgICBwcml2YXRlIHRyYW5zaWVudCBPcGVuSlBBQ29uZmlndXJh\ndGlvbiBfY29uZiA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBMb2cg\nX2xvZyA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBJbnRlcmZhY2VJ\nbXBsR2VuZXJhdG9yIF9pbXBsR2VuID0gbnVsbDsKICAgIHByaXZhdGUgdHJh\nbnNpZW50IE1ldGFEYXRhRmFjdG9yeSBfZmFjdG9yeSA9IG51bGw7CgogICAg\ncHJpdmF0ZSBpbnQgX3Jlc01vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJ\nTkc7CiAgICBwcml2YXRlIGludCBfc291cmNlTW9kZSA9IE1PREVfTUVUQSB8\nIE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk7CiAgICBwcml2YXRlIGludCBf\ndmFsaWRhdGUgPSBWQUxJREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNF\nRDsKCiAgICAvLyB3ZSBidWZmZXIgdXAgYW55IGNsYXNzZXMgdGhhdCByZWdp\nc3RlciB0aGVtc2VsdmVzIHRvIHByZXZlbnQKICAgIC8vIHJlZW50cmFuY3kg\nZXJyb3JzIGlmIGNsYXNzZXMgcmVnaXN0ZXIgZHVyaW5nIGEgY3VycmVudCBw\nYXJzZSAoY29tbW9uKQogICAgcHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uIF9y\nZWdpc3RlcmVkID0gbmV3IEhhc2hTZXQoKTsKCiAgICAvLyBzZXQgb2YgbWV0\nYWRhdGFzIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmluZwogICAg\ncHJpdmF0ZSBmaW5hbCBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxpc3Qg\nX3Jlc29sdmluZyA9CiAgICAgICAgbmV3IEluaGVyaXRhbmNlT3JkZXJlZE1l\ndGFEYXRhTGlzdCgpOwogICAgcHJpdmF0ZSBmaW5hbCBJbmhlcml0YW5jZU9y\nZGVyZWRNZXRhRGF0YUxpc3QgX21hcHBpbmcgPQogICAgICAgIG5ldyBJbmhl\ncml0YW5jZU9yZGVyZWRNZXRhRGF0YUxpc3QoKTsKICAgIHByaXZhdGUgZmlu\nYWwgTGlzdCBfZXJycyA9IG5ldyBMaW5rZWRMaXN0KCk7CgogICAgLy8gc3lz\ndGVtIGxpc3RlbmVycwogICAgcHJpdmF0ZSBMaWZlY3ljbGVFdmVudE1hbmFn\nZXIuTGlzdGVuZXJMaXN0IF9saXN0ZW5lcnMgPQogICAgICAgIG5ldyBMaWZl\nY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KDMpOwoKICAgIHByaXZh\ndGUgYm9vbGVhbiBfcmVvcmRlck1ldGFEYXRhUmVzb2x1dGlvbiA9IGZhbHNl\nOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gX3ByZWxvYWQgPSBmYWxzZTsKICAg\nIHByb3RlY3RlZCBib29sZWFuIF9wcmVsb2FkQ29tcGxldGUgPSBmYWxzZTsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBQUkVMT0FEX1NUUiA9\nICJQcmVsb2FkIjsKICAgIAogICAgLyoqCiAgICAgKiBEZWZhdWx0IGNvbnN0\ncnVjdG9yLiAgQ29uZmlndXJlIHZpYSB7QGxpbmsgQ29uZmlndXJhYmxlfS4K\nICAgICAqLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSgpIHsKICAg\nICAgICBFTVBUWV9NRVRBUyA9IG5ld0NsYXNzTWV0YURhdGFBcnJheSgwKTsK\nICAgICAgICBFTVBUWV9GSUVMRFMgPSBuZXdGaWVsZE1ldGFEYXRhQXJyYXko\nMCk7CiAgICAgICAgRU1QVFlfT1JERVJTID0gbmV3T3JkZXJBcnJheSgwKTsK\nICAgICAgICBFTVBUWV9YTUxNRVRBUyA9IG5ld1hNTENsYXNzTWV0YURhdGFB\ncnJheSgwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29u\nZmlndXJhdGlvbiBmb3IgdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkg\newogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbWV0YWRhdGEgbG9nLgogICAgICovCiAgICBwdWJsaWMg\nTG9nIGdldExvZygpIHsKICAgICAgICByZXR1cm4gX2xvZzsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBJL08gdXNlZCB0byBsb2FkIG1ldGFkYXRhLgog\nICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFGYWN0b3J5IGdldE1ldGFEYXRh\nRmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2ZhY3Rvcnk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgSS9PIHVzZWQgdG8gbG9hZCBtZXRhZGF0YS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWV0YURhdGFGYWN0b3J5KE1l\ndGFEYXRhRmFjdG9yeSBmYWN0b3J5KSB7CiAgICAgICAgZmFjdG9yeS5zZXRS\nZXBvc2l0b3J5KHRoaXMpOwogICAgICAgIF9mYWN0b3J5ID0gZmFjdG9yeTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSB2YWxpZGF0aW9u\nIGxldmVsLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+VkFMSURBVEVfTUVU\nQSB8IFZBTElEQVRFX1VORU5IQU5DRUQ8L2NvZGU+LgogICAgICovCiAgICBw\ndWJsaWMgaW50IGdldFZhbGlkYXRlKCkgewogICAgICAgIHJldHVybiBfdmFs\naWRhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgdmFs\naWRhdGlvbiBsZXZlbC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPlZBTElE\nQVRFX01FVEEgfCBWQUxJREFURV9VTkVOSEFOQ0VEPC9jb2RlPi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0VmFsaWRhdGUoaW50IHZhbGlkYXRlKSB7\nCiAgICAgICAgX3ZhbGlkYXRlID0gdmFsaWRhdGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgbWV0YWRhdGEgdmFsaWRhdGlvbiBsZXZlbC4gRGVmYXVs\ndHMgdG8KICAgICAqIDxjb2RlPlZBTElEQVRFX01FVEEgfCBWQUxJREFURV9N\nQVBQSU5HIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFZhbGlkYXRlKGludCB2YWxpZGF0ZSwgYm9v\nbGVhbiBvbikgewogICAgICAgIGlmICh2YWxpZGF0ZSA9PSBWQUxJREFURV9O\nT05FKQogICAgICAgICAgICBfdmFsaWRhdGUgPSB2YWxpZGF0ZTsKICAgICAg\nICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX3ZhbGlkYXRlIHw9IHZhbGlk\nYXRlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3ZhbGlkYXRlICY9IH52\nYWxpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSBy\nZXNvbHV0aW9uIG1vZGUuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT5NT0RF\nX01FVEEgfCBNT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNNb2Rl\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHJlc29sdXRp\nb24gbW9kZS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8\nIE1PREVfTUFQUElORzwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFJlc29sdmUoaW50IG1vZGUpIHsKICAgICAgICBfcmVzTW9kZSA9IG1v\nZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgcmVzb2x1\ndGlvbiBtb2RlLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+TU9ERV9NRVRB\nIHwgTU9ERV9NQVBQSU5HPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0UmVzb2x2ZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAg\nIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX3Jlc01vZGUg\nPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfcmVz\nTW9kZSB8PSBtb2RlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3Jlc01v\nZGUgJj0gfm1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNl\nIG1vZGUgZGV0ZXJtaW5pbmcgd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZh\ndWx0cyB0bwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5H\nIHwgTU9ERV9RVUVSWTwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0U291cmNlTW9kZSgpIHsKICAgICAgICByZXR1cm4gX3NvdXJjZU1vZGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZGV0ZXJt\naW5pbmcgd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0bwogICAg\nICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVS\nWTwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZU1v\nZGUoaW50IG1vZGUpIHsKICAgICAgICBfc291cmNlTW9kZSA9IG1vZGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZGV0ZXJtaW5p\nbmcgd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0bwogICAgICog\nPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVSWTwv\nY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZU1vZGUo\naW50IG1vZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBN\nT0RFX05PTkUpCiAgICAgICAgICAgIF9zb3VyY2VNb2RlID0gbW9kZTsKICAg\nICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX3NvdXJjZU1vZGUgfD0g\nbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zb3VyY2VNb2RlICY9\nIH5tb2RlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB3aGV0aGVyIHRo\naXMgcmVwb3NpdG9yeSB3aWxsIGxvYWQgYWxsIE1ldGFEYXRhIGZvciBhbGwg\na25vd24gcGVyc2lzdGVudCBjbGFzc2VzIGF0CiAgICAgKiBpbml0aWFsaXph\ndGlvbiBhbmQgcmVtb3ZlIGFsbCBsb2NraW5nLiBEZWZhdWx0cyB0byBmYWxz\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJlbG9hZChib29sZWFu\nIHApIHsKICAgICAgICBfcHJlbG9hZCA9IHA7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhp\ncyByZXBvc2l0b3J5IHdpbGwgbG9hZCBhbGwgTWV0YURhdGEgZm9yIGFsbCBr\nbm93bgogICAgICogcGVyc2lzdGVudCBjbGFzc2VzIGF0IGluaXRpYWxpemF0\naW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRQcmVsb2FkKCkg\newogICAgICAgIHJldHVybiBfcHJlbG9hZDsKICAgIH0gICAKICAgIAogICAg\nIC8qKgogICAgICogSWYgdGhlIG9wZW5qcGEuTWV0YURhdGFSZXBvc2l0b3J5\nIHBsdWdpbiB2YWx1ZSBQcmVsb2FkPXRydWUgaXMgc2V0LCB0aGlzIG1ldGhv\nZCB3aWxsIGxvYWQgYWxsCiAgICAgKiBNZXRhRGF0YSBmb3IgYWxsIHBlcnNp\nc3RlbnQgY2xhc3NlcyBhbmQgd2lsbCByZW1vdmUgbG9ja2luZyBmcm9tIHRo\naXMgY2xhc3MuCiAgICAgKiA8cD4KICAgICAqIAogICAgICovCiAgICBwdWJs\naWMgc3luY2hyb25pemVkIHZvaWQgcHJlbG9hZCgpIHsKICAgICAgICBpZiAo\nX3ByZWxvYWQgPT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICAvLyBJZiBwb29saW5nIEVNRnMsIHRoaXMgbWV0aG9k\nIG1heSBiZSBpbnZva2VkIG1vcmUgdGhhbiBvbmNlLiBPbmx5IHBlcmZvcm0g\ndGhpcyB3b3JrIG9uY2UuCiAgICAgICAgaWYgKF9wcmVsb2FkQ29tcGxldGUg\nPT0gdHJ1ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBNdWx0aUNsYXNzTG9hZGVyIG11bHRpID0gQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIubmV3TXVsdGlDbGFzc0xv\nYWRlckFjdGlvbigpKTsKICAgICAgICBtdWx0aS5hZGRDbGFzc0xvYWRlcihB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5n\nZXRDb250ZXh0Q2xhc3NMb2FkZXJBY3Rpb24oKSkpOwogICAgICAgIG11bHRp\nLmFkZENsYXNzTG9hZGVyKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgIC5nZXRDbGFzc0xvYWRlckFj\ndGlvbihNZXRhRGF0YVJlcG9zaXRvcnkuY2xhc3MpKSk7CgogICAgICAgIFNl\ndDxTdHJpbmc+IGNsYXNzZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZh\nbHNlLCBtdWx0aSk7CiAgICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCB8fCBj\nbGFzc2VzLnNpemUoKSA9PSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6ZUVh\nZ2VyLW5vbmUiKSk7CiAgICAgICAgfQogICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkgPT0gdHJ1ZSkgewogICAgICAgICAgICBfbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJyZXBvcy1pbml0aWFsaXplRWFnZXItZm91bmQiLCBjbGFz\nc2VzKSk7CiAgICAgICAgfQoKICAgICAgICBMaXN0PENsYXNzPiBsb2FkZWQg\nPSBuZXcgQXJyYXlMaXN0PENsYXNzPigpOwogICAgICAgIGZvciAoU3RyaW5n\nIGMgOiBjbGFzc2VzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBDbGFzczw/PiBjbHMgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgoSjJEb1ByaXZIZWxwZXIuZ2V0Rm9yTmFtZUFjdGlvbihjLCB0cnVl\nLCBtdWx0aSkpKTsKICAgICAgICAgICAgICAgIGxvYWRlZC5hZGQoY2xzKTsK\nICAgICAgICAgICAgICAgIC8vIFRoaXMgY2FsbCBtYXkgYmUgdW5uZWNlc3Nh\ncnk/CiAgICAgICAgICAgICAgICBfZmFjdG9yeS5sb2FkKGNscywgTU9ERV9B\nTEwsIG11bHRpKTsKICAgICAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6\nZUVhZ2VyLWVycm9yIiksIHBhZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmVzb2x2ZUFsbChtdWx0aSk7CiAgICAgICAgCiAgICAgICAg\nLy8gSG9vayBpbiB0aGlzIGNsYXNzIGFzIGEgbGlzdGVuZXIgYW5kIHByb2Nl\nc3MgcmVnaXN0ZXJlZCBjbGFzc2VzIGxpc3QgdG8gcG9wdWxhdGUgX2FsaWFz\nZXMgbGlzdC4KICAgICAgICBQQ1JlZ2lzdHJ5LmFkZFJlZ2lzdGVyQ2xhc3NM\naXN0ZW5lcih0aGlzKTsKICAgICAgICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNz\nZXMobXVsdGkpOwogICAgICAgIF9sb2NraW5nID0gZmFsc2U7CiAgICAgICAg\nX3ByZWxvYWRDb21wbGV0ZSA9IHRydWU7CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNz\nLgogICAgICoKICAgICAqIEBwYXJhbSBjbHMgdGhlIGNsYXNzIHRvIHJldHJp\nZXZlIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlciB0aGUg\nZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlmIGFueQogICAgICogQHBh\ncmFtIG11c3RFeGlzdCBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURh\ndGFFeGNlcHRpb259CiAgICAgKiBpZiBubyBtZXRhZGF0YSBpcyBmb3VuZAog\nICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YShD\nbGFzcyBjbHMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0\nRXhpc3QpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAg\ncmV0dXJuIGdldE1ldGFEYXRhTG9ja2luZyhjbHMsIGVudkxvYWRlciwgbXVz\ndEV4aXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4g\nZ2V0TWV0YURhdGFJbnRlcm5hbChjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0\nKTsKICAgICAgICB9CiAgICB9CiAgICBwcml2YXRlIHN5bmNocm9uaXplZCBD\nbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhTG9ja2luZyhDbGFzcyBjbHMsIENs\nYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAg\nICAgICByZXR1cm4gZ2V0TWV0YURhdGFJbnRlcm5hbChjbHMsIGVudkxvYWRl\nciwgbXVzdEV4aXN0KTsKICAgIH0KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0\nYSBnZXRNZXRhRGF0YUludGVybmFsKENsYXNzIGNscywKICAgICAgICBDbGFz\nc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAg\nICAgaWYgKGNscyAhPSBudWxsICYmCiAgICAgICAgICAgIER5bmFtaWNQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQog\nICAgICAgICAgICBjbHMgPSBjbHMuZ2V0U3VwZXJjbGFzcygpOwoKICAgICAg\nICAvLyBpZiBjbHMgaXMgYSBnZW5lcmF0ZWQgaW50ZXJmYWNlLCB1c2UgdGhl\nIHVzZXIgaW50ZXJmYWNlCiAgICAgICAgLy8gdG8gbG9jYXRlIG1ldGFkYXRh\nCiAgICAgICAgaWYgKGNscyAhPSBudWxsICYmIF9pbXBsR2VuLmlzSW1wbFR5\ncGUoY2xzKSkKICAgICAgICAgICAgY2xzID0gX2ltcGxHZW4udG9NYW5hZ2Vk\nSW50ZXJmYWNlKGNscyk7CgogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIGdldE1ldGFEYXRhSW50ZXJuYWwoY2xzLCBlbnZMb2FkZXIpOwogICAgICAg\nIGlmIChtZXRhID09IG51bGwgJiYgbXVzdEV4aXN0KSB7CiAgICAgICAgICAg\nIGlmIChjbHMgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgIUltcGxIZWxw\nZXIuaXNNYW5hZ2VkVHlwZShfY29uZiwgY2xzKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0\nYS1ub3RwYyIsIGNscykpLgogICAgICAgICAgICAgICAgICAgIHNldEZhdGFs\nKGZhbHNlKTsKCiAgICAgICAgICAgIFNldCBwY05hbWVzID0gZ2V0UGVyc2lz\ndGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICAgICAg\naWYgKHBjTmFtZXMgIT0gbnVsbCAmJiBwY05hbWVzLnNpemUoKSA+IDApCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLW1ldGEtdHlwZXMiLAogICAgICAgICAgICAgICAgICAgIGNs\ncywgcGNOYW1lcykpOwoKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhIiwgY2xzKSk7CiAgICAgICAg\nfQogICAgICAgIHJlc29sdmUobWV0YSk7CiAgICAgICAgcmV0dXJuIG1ldGE7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZv\nciB0aGUgZ2l2ZW4gYWxpYXMgbmFtZS4KICAgICAqCiAgICAgKiBAcGFyYW0g\nYWxpYXMgdGhlIGFsaWFzIHRvIGNsYXNzIHRvIHJldHJpZXZlIG1ldGFkYXRh\nIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlciB0aGUgZW52aXJvbm1lbnRh\nbCBjbGFzcyBsb2FkZXIsIGlmIGFueQogICAgICogQHBhcmFtIG11c3RFeGlz\ndCBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259\nCiAgICAgKiBpZiBubyBtZXRhZGF0YSBpcyBmb3VuZAogICAgICogQHNlZSBD\nbGFzc01ldGFEYXRhI2dldFR5cGVBbGlhcwogICAgICovCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YShTdHJpbmcgYWxpYXMsIENsYXNz\nTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBib29sZWFuIG11c3RFeGlzdCkg\newogICAgICAgIGlmIChhbGlhcyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsCiAgICAgICAgICAgICAgICBfYWxp\nYXNlcykpOwogICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAg\nICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAg\nICBMaXN0IGNsYXNzTGlzdCA9IChMaXN0KSBfYWxpYXNlcy5nZXQoYWxpYXMp\nOwoKICAgICAgICAvLyBtdWx0aXBsZSBjbGFzc2VzIG1heSBoYXZlIGJlZW4g\nZGVmaW5lZCB3aXRoIHRoZSBzYW1lIGFsaWFzOiB3ZQogICAgICAgIC8vIHdp\nbGwgZmlsdGVyIGJ5IGNoZWNraW5nIGFnYWluc3QgdGhlIGN1cnJlbnQgbGlz\ndCBvZiB0aGUKICAgICAgICAvLyBwZXJzaXN0ZW50IHR5cGVzIGFuZCBmaWx0\nZXIgYmFzZWQgb24gd2hpY2ggY2xhc3NlcyBhcmUgbG9hZGFibGUKICAgICAg\nICAvLyB2aWEgdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQncyBDbGFzc0xvYWRl\ncgogICAgICAgIFNldCBwY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1l\ncyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICBDbGFzcyBjbHMgPSBudWxs\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBjbGFzc0xpc3QgIT0gbnVsbCAm\nJiBpIDwgY2xhc3NMaXN0LnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIENs\nYXNzIGMgPSAoQ2xhc3MpIGNsYXNzTGlzdC5nZXQoaSk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAvLyByZS1sb2FkIHRoZSBjbGFzcyBp\nbiB0aGUgY3VycmVudCBlbnZpcm9ubWVudCBsb2FkZXIgc28KICAgICAgICAg\nICAgICAgIC8vIHRoYXQgd2UgY2FuIGhhbmRsZSByZWRlcGxveW1lbnQgb2Yg\ndGhlIHNhbWUgY2xhc3MgbmFtZQogICAgICAgICAgICAgICAgQ2xhc3MgbmMg\nPSBDbGFzcy5mb3JOYW1lKGMuZ2V0TmFtZSgpLCBmYWxzZSwgZW52TG9hZGVy\nKTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHNwZWNpZmllZCBh\nIGxpc3Qgb2YgcGVyc2lzdGVudCBjbGFzZXMsCiAgICAgICAgICAgICAgICAv\nLyBhbHNvIGNoZWNrIHRvIGVuc3VyZSB0aGF0IHRoZSBjbGFzcyBpcyBpbiB0\naGF0IGxpc3QKICAgICAgICAgICAgICAgIGlmIChwY05hbWVzID09IG51bGwg\nfHwgcGNOYW1lcy5zaXplKCkgPT0gMCAKICAgICAgICAgICAgICAgICAgICB8\nfCBwY05hbWVzLmNvbnRhaW5zKG5jLmdldE5hbWUoKSkpIHsKICAgICAgICAg\nICAgICAgICAgICBjbHMgPSBuYzsKICAgICAgICAgICAgICAgICAgICBpZiAo\nIWNsYXNzTGlzdC5jb250YWlucyhjbHMpKQogICAgICAgICAgICAgICAgICAg\nICAgICBjbGFzc0xpc3QuYWRkKGNscyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzIGhhcHBl\nbnMgd2hlbiB0aGUgY2xhc3MgaXMgbm90IGxvYWRhYmxlIGJ5CiAgICAgICAg\nICAgICAgICAvLyB0aGUgZW52aXJvbm1lbnQgY2xhc3MgbG9hZGVyLCBzbyBp\ndCB3YXMgcHJvYmFibHkKICAgICAgICAgICAgICAgIC8vIGxpc3RlZCBlbHNl\nd2hlcmU7IGFsc28gaWdub3JlIGxpbmthZ2UgZmFpbHVyZXMgYW5kCiAgICAg\nICAgICAgICAgICAvLyBvdGhlciBjbGFzcyBsb2FkaW5nIHByb2JsZW1zCiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNscyAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2Fk\nZXIsIG11c3RFeGlzdCk7CgogICAgICAgIC8vIG1heWJlIHRoaXMgaXMgc29t\nZSB0eXBlIHdlJ3ZlIHNlZW4gYnV0IGp1c3QgaXNuJ3QgdmFsaWQKICAgICAg\nICBpZiAoX2FsaWFzZXMuY29udGFpbnNLZXkoYWxpYXMpKSB7CiAgICAgICAg\nICAgIGlmIChtdXN0RXhpc3QpCiAgICAgICAgICAgICAgICB0aHJvd05vUmVn\naXN0ZXJlZEFsaWFzKGFsaWFzKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyByZWNvcmQgdGhhdCB0aGlzIGlzIGFu\nIGludmFsaWQgdHlwZQogICAgICAgIF9hbGlhc2VzLnB1dChhbGlhcywgbnVs\nbCk7CgogICAgICAgIGlmICghbXVzdEV4aXN0KQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICByZXR1cm4gdGhyb3dOb1JlZ2lzdGVyZWRBbGlh\ncyhhbGlhcyk7CiAgICB9CgogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIHRo\ncm93Tm9SZWdpc3RlcmVkQWxpYXMoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAg\nU3RyaW5nIGNsb3NlID0gZ2V0Q2xvc2VzdEFsaWFzTmFtZShhbGlhcyk7CiAg\nICAgICAgaWYgKGNsb3NlICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgIF9sb2MuZ2V0\nKCJuby1hbGlhcy1tZXRhLWhpbnQiLCBhbGlhcywgX2FsaWFzZXMsIGNsb3Nl\nKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oCiAgICAgICAgICAgICAgICBfbG9jLmdldCgibm8tYWxp\nYXMtbWV0YSIsIGFsaWFzLCBfYWxpYXNlcykpOwogICAgfQoKICAgIC8qKgog\nICAgICogQHJldHVybiB0aGUgbmVhcmVzdCBtYXRjaCB0byB0aGUgc3BlY2lm\naWVkIGFsaWFzIG5hbWUKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldENsb3Nlc3RBbGlhc05hbWUoU3RyaW5nIGFs\naWFzKSB7CiAgICAgICAgQ29sbGVjdGlvbiBhbGlhc2VzID0gZ2V0QWxpYXNO\nYW1lcygpOwogICAgICAgIHJldHVybiBTdHJpbmdEaXN0YW5jZS5nZXRDbG9z\nZXN0TGV2ZW5zaHRlaW5EaXN0YW5jZShhbGlhcywgYWxpYXNlcyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSByZWdpc3RlcmVkIGFsaWFz\nIG5hbWVzCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVibGlj\nIENvbGxlY3Rpb24gZ2V0QWxpYXNOYW1lcygpIHsKICAgICAgICBpZiAoX2xv\nY2tpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIGdldEFsaWFzTmFtZXNMb2Nr\naW5nKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdl\ndEFsaWFzTmFtZXNJbnRlcm5hbCgpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIENvbGxlY3Rpb24gZ2V0QWxpYXNOYW1lc0xvY2tpbmcoKSB7CiAg\nICAgICAgc3luY2hyb25pemVkIChfYWxpYXNlcykgewogICAgICAgICAgICBy\nZXR1cm4gZ2V0QWxpYXNOYW1lc0ludGVybmFsKCk7CiAgICAgICAgfQogICAg\nfQogICAgcHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uIGdldEFsaWFzTmFtZXNJ\nbnRlcm5hbCgpIHsKICAgICAgICBDb2xsZWN0aW9uIGFsaWFzZXMgPSBuZXcg\nSGFzaFNldCgpOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IF9hbGlh\nc2VzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIE1hcC5FbnRyeSBlID0gKE1hcC5FbnRyeSkgaXRlci5u\nZXh0KCk7CiAgICAgICAgICAgIGlmIChlLmdldFZhbHVlKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGFsaWFzZXMuYWRkKGUuZ2V0S2V5KCkpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gYWxpYXNlczsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludGVybmFsIG1ldGhvZCB0byBnZXQgdGhlIG1ldGFkYXRhIGZv\nciB0aGUgZ2l2ZW4gY2xhc3MsIHdpdGhvdXQKICAgICAqIHJlc29sdmluZyBp\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIGdldE1ldGFE\nYXRhSW50ZXJuYWwoQ2xhc3MgY2xzLAogICAgICAgIENsYXNzTG9hZGVyIGVu\ndkxvYWRlcikgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGNoZWNrIGNhY2hlIGZvciBl\neGlzdGluZyBtZXRhZGF0YSwgb3IgZ2l2ZSB1cCBpZiBubyBtZXRhZGF0YSBh\nbmQKICAgICAgICAvLyBvdXIgbGlzdCBvZiBjb25maWd1cmVkIHBlcnNpc3Rl\nbnQgdHlwZXMgZG9lc24ndCBpbmNsdWRlIHRoZSBjbGFzcwogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBfbWV0YXMuZ2V0\nKGNscyk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCAmJiAoKG1ldGEuZ2V0\nU291cmNlTW9kZSgpICYgTU9ERV9NRVRBKSAhPSAwCiAgICAgICAgICAgIHx8\nIChfc291cmNlTW9kZSAmIE1PREVfTUVUQSkgPT0gMCkpCiAgICAgICAgICAg\nIHJldHVybiBtZXRhOwoKICAgICAgICAvLyBpZiBydW50aW1lLCBjdXQgb2Zm\nIHNlYXJjaCBpZiBub3QgaW4gcGMgbGlzdC4gIHdlIGRvbid0IGRvIHRoaXMg\nYXQKICAgICAgICAvLyBkZXYgdGltZSBzbyB0aGF0IHVzZXIgY2FuIG1hbmlw\ndWxhdGUgcGVyc2lzdGVudCBjbGFzc2VzIGhlJ3Mgd3JpdGluZwogICAgICAg\nIC8vIGJlZm9yZSBhZGRpbmcgdGhlbSB0byB0aGUgbGlzdAogICAgICAgIGlm\nICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0gMCkgewogICAg\nICAgICAgICBTZXQgcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMo\nZmFsc2UsIGVudkxvYWRlcik7CiAgICAgICAgICAgIGlmIChwY05hbWVzICE9\nIG51bGwgJiYgIXBjTmFtZXMuY29udGFpbnMoY2xzLmdldE5hbWUoKSkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgICAgICB9CgogICAgICAg\nIGlmIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgLy8gY2hlY2sgdG8g\nc2VlIGlmIG1heWJlIHdlIGtub3cgdGhpcyBjbGFzcyBoYXMgbm8gbWV0YWRh\ndGEKICAgICAgICAgICAgaWYgKF9tZXRhcy5jb250YWluc0tleShjbHMpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICAvLyBt\nYWtlIHN1cmUgdGhpcyBpc24ndCBhbiBvYnZpb3VzbHkgYmFkIGNsYXNzCiAg\nICAgICAgICAgIGlmIChjbHMuaXNQcmltaXRpdmUoKSB8fCBjbHMuZ2V0TmFt\nZSgpLnN0YXJ0c1dpdGgoImphdmEuIikKICAgICAgICAgICAgICAgIHx8IGNs\ncyA9PSBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8vIGRlc2lnbmVkIHRvIGdl\ndCBhcm91bmQgamlrZXMgMS4xNyAvIEpESzEuNSBpc3N1ZSB3aGVyZSBzdGF0\naWMKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZXJzIGFyZSBub3QgaW52b2tl\nZCB3aGVuIGEgY2xhc3MgaXMgcmVmZXJlbmNlZCwgc28gdGhlCiAgICAgICAg\nICAgIC8vIGNsYXNzIG5ldmVyIHJlZ2lzdGVycyBpdHNlbGYgd2l0aCB0aGUg\nc3lzdGVtCiAgICAgICAgICAgIGlmICgoX3ZhbGlkYXRlICYgVkFMSURBVEVf\nUlVOVElNRSkgIT0gMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNscy5nZXROYW1lKCksIHRy\ndWUsCiAgICAgICAgICAgICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlv\nbihjbHMpKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUg\ndCkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICAvLyBub3QgaW4gY2FjaGU6IGxvYWQgbWV0YWRhdGEgb3Ig\nbWFwcGluZ3MgZGVwZW5kaW5nIG9uIHNvdXJjZSBtb2RlLgogICAgICAgIC8v\nIGxvYWRpbmcgbWV0YWRhdGEgbWlnaHQgYWxzbyBsb2FkIG1hcHBpbmdzLCBi\ndXQgZG9lc24ndCBoYXZlIHRvCiAgICAgICAgaW50IG1vZGUgPSAwOwogICAg\nICAgIGlmICgoX3NvdXJjZU1vZGUgJiBNT0RFX01FVEEpICE9IDApCiAgICAg\nICAgICAgIG1vZGUgPSBfc291cmNlTW9kZSAmIH5NT0RFX01BUFBJTkc7CiAg\nICAgICAgZWxzZSBpZiAoKF9zb3VyY2VNb2RlICYgTU9ERV9NQVBQSU5HKSA9\nPSAwKQogICAgICAgICAgICBtb2RlID0gX3NvdXJjZU1vZGU7CiAgICAgICAg\naWYgKG1vZGUgIT0gTU9ERV9OT05FKSB7CiAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJsb2FkLWNscyIsIGNscywgdG9Nb2RlU3RyaW5nKG1vZGUp\nKSk7CiAgICAgICAgICAgIF9mYWN0b3J5LmxvYWQoY2xzLCBtb2RlLCBlbnZM\nb2FkZXIpOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgY2FjaGUgYWdh\naW4KICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICBtZXRh\nID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAgICAgICBp\nZiAobWV0YSAhPSBudWxsICYmICgobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBN\nT0RFX01FVEEpICE9IDAKICAgICAgICAgICAgfHwgKF9zb3VyY2VNb2RlICYg\nTU9ERV9NRVRBKSA9PSAwKSkKICAgICAgICAgICAgcmV0dXJuIG1ldGE7Cgog\nICAgICAgIC8vIHJlY29yZCB0aGF0IHRoaXMgY2xhc3MgaGFzIG5vIG1ldGFk\nYXRhOyBjaGVja2luZyBmb3IgdGhpcyBsYXRlcgogICAgICAgIC8vIHNwZWVk\ncyB0aGluZ3MgdXAgaW4gZW52aXJvbm1lbnRzIHdpdGggc2xvdyBjbGFzcyBs\nb2FkaW5nCiAgICAgICAgLy8gbGlrZSBhcHBzZXJ2ZXJzCiAgICAgICAgaWYg\nKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmVtb3ZlTWV0YURhdGEobWV0\nYSk7CiAgICAgICAgX21ldGFzLnB1dChjbHMsIG51bGwpOwogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc3Ry\naW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBtb2RlIGZsYWdzLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgdG9Nb2RlU3RyaW5n\nKGludCBtb2RlKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWZmZXIoMzEpOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfTUVU\nQSkgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiW01FVEFdIik7CiAg\nICAgICAgaWYgKChtb2RlICYgTU9ERV9RVUVSWSkgIT0gMCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiW1FVRVJZXSIpOwogICAgICAgIGlmICgobW9kZSAm\nIE1PREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nW01BUFBJTkddIik7CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NQVBQSU5H\nX0lOSVQpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltNQVBQSU5H\nX0lOSVRdIik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIC8qKgogICAgICogUHJlcGFyZSBtZXRhZGF0YSBmb3IgbWFwcGlu\nZyByZXNvbHV0aW9uLiBUaGlzIG1ldGhvZCBtaWdodCBtYXAgcGFydHMKICAg\nICAqIG9mIHRoZSBtZXRhZGF0YSB0aGF0IGRvbid0IHJlbHkgb24gb3RoZXIg\nY2xhc3NlcyBiZWluZyBtYXBwZWQsIGJ1dCB0aGF0CiAgICAgKiBvdGhlciBj\nbGFzc2VzIG1pZ2h0IHJlbHkgb24gZHVyaW5nIHRoZWlyIG93biBtYXBwaW5n\nIChmb3IgZXhhbXBsZSwKICAgICAqIHByaW1hcnkga2V5IGZpZWxkcykuIEJ5\nIGRlZmF1bHQsIHRoaXMgbWV0aG9kIG9ubHkgY2FsbHMKICAgICAqIHtAbGlu\nayBDbGFzc01ldGFEYXRhI2RlZmluZVN1cGVyY2xhc3NGaWVsZHN9LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwcmVwYXJlTWFwcGluZyhDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBtZXRhLmRlZmluZVN1cGVyY2xhc3NG\naWVsZHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSB0\naGUgZ2l2ZW4gbWV0YWRhdGEgaWYgbmVlZGVkLiBUaGVyZSBhcmUgdGhyZWUg\nZ29hbHM6CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+TWFrZSBzdXJlIG5vIHVu\ncmVzb2x2ZWQgbWV0YWRhdGEgZ2V0cyBiYWNrIHRvIHRoZSBjbGllbnQuPC9s\naT4KICAgICAqIDxsaT5Bdm9pZCBpbmZpbml0ZSByZWVudHJhbnQgY2FsbHMg\nZm9yIG11dHVhbGx5LWRlcGVuZGVudCBtZXRhZGF0YXMgYnkKICAgICAqIGFs\nbG93aW5nIHVucmVzb2x2ZWQgbWV0YWRhdGEgdG8gYmUgcmV0dXJuZWQgdG8g\nb3RoZXIgbWV0YWRhdGFzLjwvbGk+CiAgICAgKiA8bGk+QWx3YXlzIG1ha2Ug\nc3VyZSB0aGUgc3VwZXJjbGFzcyBtZXRhZGF0YSBpcyByZXNvbHZlZCBiZWZv\ncmUgdGhlCiAgICAgKiBzdWJjbGFzcyBtZXRhZGF0YSBzbyB0aGF0IHRoZSBz\ndWJjbGFzcyBjYW4gYWNjZXNzIHRoZSBzdXBlcidzIGxpc3QKICAgICAqIG9m\nIGZpZWxkcy48L2xpPgogICAgICogPC9vbD4gTm90ZSB0aGF0IHRoZSBjb2Rl\nIGNhbGxpbmcgdGhpcyBtZXRob2QgaXMgc3luY2hyb25pemVkLCBzbyB0aGlz\nCiAgICAgKiBtZXRob2QgZG9lc24ndCBoYXZlIHRvIGJlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcmVzb2x2ZShDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICAvLyByZXR1cm4gYW55dGhpbmcgdGhhdCBoYXMgaXRzIG1ldGFk\nYXRhIHJlc29sdmVkLCBiZWNhdXNlIHRoYXQgbWVhbnMKICAgICAgICAvLyBp\ndCBpcyBlaXRoZXIgZnVsbHkgcmVzb2x2ZWQgb3IgbXVzdCBhdCBsZWFzdCBi\nZSBpbiB0aGUgcHJvY2VzcyBvZgogICAgICAgIC8vIHJlc29sdmluZyBtYXBw\naW5nLCBldGMgc2luY2Ugd2UgZG8gdGhhdCByaWdodCBhZnRlciBtZXRhIHJl\nc29sdmUKICAgICAgICBpZiAobWV0YSA9PSBudWxsIHx8IF9yZXNNb2RlID09\nIE1PREVfTk9ORQogICAgICAgICAgICB8fCAobWV0YS5nZXRSZXNvbHZlKCkg\nJiBNT0RFX01FVEEpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gcmVzb2x2ZSBtZXRhZGF0YQogICAgICAgIExpc3QgcmVzb2x2ZWQg\nPSByZXNvbHZlTWV0YShtZXRhKTsKICAgICAgICBpZiAocmVzb2x2ZWQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBsb2FkIG1h\ncHBpbmcgZGF0YQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVzb2x2\nZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIGxvYWRNYXBwaW5nKChDbGFz\nc01ldGFEYXRhKSByZXNvbHZlZC5nZXQoaSkpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgcmVzb2x2ZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAg\nIHByZU1hcHBpbmcoKENsYXNzTWV0YURhdGEpIHJlc29sdmVkLmdldChpKSk7\nCgogICAgICAgIC8vIHJlc29sdmUgbWFwcGluZ3MKICAgICAgICBib29sZWFu\nIGVyciA9IHRydWU7CiAgICAgICAgaWYgKChfcmVzTW9kZSAmIE1PREVfTUFQ\nUElORykgIT0gMCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBy\nZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgIGVyciAmPSBy\nZXNvbHZlTWFwcGluZygoQ2xhc3NNZXRhRGF0YSkgcmVzb2x2ZWQuZ2V0KGkp\nKTsKCiAgICAgICAgLy8gdGhyb3cgZXJyb3JzIGVuY291bnRlcmVkCiAgICAg\nICAgaWYgKGVyciAmJiAhX2VycnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAg\nIFJ1bnRpbWVFeGNlcHRpb24gcmU7CiAgICAgICAgICAgIGlmIChfZXJycy5z\naXplKCkgPT0gMSkKICAgICAgICAgICAgICAgIHJlID0gKFJ1bnRpbWVFeGNl\ncHRpb24pIF9lcnJzLmdldCgwKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgcmUgPSBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nInJlc29sdmUtZXJycyIpKS4KICAgICAgICAgICAgICAgICAgICBzZXROZXN0\nZWRUaHJvd2FibGVzKChUaHJvd2FibGVbXSkgX2VycnMudG9BcnJheQogICAg\nICAgICAgICAgICAgICAgICAgICAobmV3IEV4Y2VwdGlvbltfZXJycy5zaXpl\nKCldKSk7CiAgICAgICAgICAgIF9lcnJzLmNsZWFyKCk7CiAgICAgICAgICAg\nIHRocm93IHJlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\nc29sdmUgbWV0YWRhdGEgbW9kZSwgcmV0dXJuaW5nIGxpc3Qgb2YgcHJvY2Vz\nc2VkIG1ldGFkYWRhdGFzLCBvciBudWxsCiAgICAgKiBpZiB3ZSdyZSBzdGls\nbCBpbiB0aGUgcHJvY2VzcyBvZiByZXNvbHZpbmcgb3RoZXIgbWV0YWRhdGFz\nLgogICAgICovCiAgICBwcml2YXRlIExpc3QgcmVzb2x2ZU1ldGEoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0UENTdXBlcmNs\nYXNzKCkgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBzZXQgc3VwZXJjbGFz\ncwogICAgICAgICAgICBDbGFzcyBzdXAgPSBtZXRhLmdldERlc2NyaWJlZFR5\ncGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwTWV0YTsKICAgICAgICAgICAgd2hpbGUgKHN1cCAhPSBudWxsICYm\nIHN1cCAhPSBPYmplY3QuY2xhc3MpIHsKICAgICAgICAgICAgICAgIHN1cE1l\ndGEgPSBnZXRNZXRhRGF0YShzdXAsIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIo\nKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKHN1cE1ldGEgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0UENTdXBlcmNsYXNz\nKHN1cCk7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YShzdXBNZXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAg\nIHN1cCA9IHN1cC5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJm\nYWNlKCkpIHsKICAgICAgICAgICAgICAgIENsYXNzW10gc3VwcyA9IG1ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpLmdldEludGVyZmFjZXMoKTsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgICAgIHN1cE1ldGEgPSBnZXRNZXRhRGF0YShz\ndXBzW2ldLCBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIAogICAgICAgICAg\nICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHN1cE1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBt\nZXRhLnNldFBDU3VwZXJjbGFzcyhzdXApOwogICAgICAgICAgICAgICAgICAg\nICAgICBtZXRhLnNldFBDU3VwZXJjbGFzc01ldGFEYXRhKHN1cE1ldGEpOwog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImFzc2lnbmVkLXN1cCIsIG1ldGEs\nCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSkp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzb2x2ZSByZWxhdGlvbiBwcmlt\nYXJ5IGtleSBmaWVsZHMgZm9yIG1hcHBpbmcgZGVwZW5kZW5jaWVzCiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRhLmdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1ByaW1hcnlLZXko\nKSkKICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlKCksIAogICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0RW52\nQ2xhc3NMb2FkZXIoKSwgZmFsc2UpOwoKICAgICAgICAvLyByZXNvbHZlIG1l\ndGFkYXRhOyBpZiB3ZSdyZSBub3QgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2\naW5nCiAgICAgICAgLy8gb3RoZXJzLCB0aGlzIHdpbGwgcmV0dXJuIHRoZSBz\nZXQgb2YgaW50ZXJyZWxhdGVkIG1ldGFzIHRoYXQKICAgICAgICAvLyByZXNv\nbHZlZAogICAgICAgIHJldHVybiBwcm9jZXNzQnVmZmVyKG1ldGEsIF9yZXNv\nbHZpbmcsIE1PREVfTUVUQSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nTG9hZCBtYXBwaW5nIGluZm9ybWF0aW9uIGZvciB0aGUgZ2l2ZW4gbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBsb2FkTWFwcGluZyhDbGFz\nc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAoKG1ldGEuZ2V0UmVzb2x2\nZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIC8vIGxvYWQgbWFwcGluZyBpbmZvcm1hdGlvbgogICAgICAg\nIGlmICgobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01BUFBJTkcpID09\nIDAKICAgICAgICAgICAgJiYgKF9zb3VyY2VNb2RlICYgTU9ERV9NQVBQSU5H\nKSAhPSAwKSB7CiAgICAgICAgICAgIC8vIGVtYmVkZGVkLW9ubHkgbWV0YWRh\ndGEgZG9lc24ndCBoYXZlIG1hcHBpbmcsIHNvIGFsd2F5cyBsb2FkZWQKICAg\nICAgICAgICAgaWYgKG1ldGEuaXNFbWJlZGRlZE9ubHkoKSkKICAgICAgICAg\nICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01BUFBJTkcsIHRydWUp\nOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGxvYWQg\nbWFwcGluZyBkYXRhCiAgICAgICAgICAgICAgICBpbnQgbW9kZSA9IF9zb3Vy\nY2VNb2RlICYgfk1PREVfTUVUQTsKICAgICAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgibG9hZC1tYXBwaW5nIiwgbWV0YSwKICAgICAgICAg\nICAgICAgICAgICAgICAgdG9Nb2RlU3RyaW5nKG1vZGUpKSk7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIF9mYWN0b3J5Lmxv\nYWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIG1vZGUsCiAgICAgICAgICAg\nICAgICAgICAgICAgIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmVtb3ZlTWV0YURhdGEobWV0YSk7CiAgICAg\nICAgICAgICAgICAgICAgX2VycnMuYWRkKHJlKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFByZS1tYXBwaW5nIHByZXBhcmF0aW9uLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcHJlTWFwcGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAoKG1ldGEuZ2V0UmVzb2x2ZSgpICYgTU9ERV9NQVBQSU5HKSAh\nPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHByZXBhcmUg\nbWFwcGluZ3MgZm9yIHJlc29sdmU7IGlmIG5vdCByZXNvbHZpbmcgbWFwcGlu\nZ3MsIHRoZW4KICAgICAgICAvLyBtYWtlIHN1cmUgYW55IHN1cGVyY2xhc3Mg\nZmllbGRzIGRlZmluZWQgaW4gbWV0YWRhdGEgYXJlIHJlc29sdmVkCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfcmVzTW9kZSAmIE1PREVfTUFQ\nUElORykgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJwcmVwLW1hcHBpbmciLCBtZXRhKSk7CiAgICAgICAgICAgICAg\nICBwcmVwYXJlTWFwcGluZyhtZXRhKTsKICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICBtZXRhLmRlZmluZVN1cGVyY2xhc3NGaWVsZHMoZmFs\nc2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgcmVtb3ZlTWV0YURhdGEobWV0YSk7CiAgICAgICAgICAg\nIF9lcnJzLmFkZChyZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVzb2x2ZSBhbmQgaW5pdGlhbGl6ZSBtYXBwaW5nLgogICAgICoKICAg\nICAqIEByZXR1cm4gZmFsc2UgaWYgd2UncmUgc3RpbGwgaW4gdGhlIHByb2Nl\nc3Mgb2YgcmVzb2x2aW5nIG1hcHBpbmdzCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiByZXNvbHZlTWFwcGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBMaXN0IG1hcHBlZCA9IHByb2Nlc3NCdWZmZXIobWV0YSwgX21h\ncHBpbmcsIE1PREVfTUFQUElORyk7CiAgICAgICAgaWYgKG1hcHBlZCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGlu\naXRpYWxpemUgbWFwcGluZyBmb3IgcnVudGltZSB1c2UKICAgICAgICBpZiAo\nKF9yZXNNb2RlICYgTU9ERV9NQVBQSU5HX0lOSVQpICE9IDApIHsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwZWQuc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgbWFw\ncGVkLmdldChpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgbWV0YS5yZXNvbHZlKE1PREVfTUFQUElOR19JTklUKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAg\nICAgICAgICAgICAgICAgICBfZXJycy5hZGQocmUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogUHJvY2VzcyB0aGUgZ2l2ZW4g\nbWV0YWRhdGEgYW5kIHRoZSBhc3NvY2lhdGVkIGJ1ZmZlci4KICAgICAqLwog\nICAgcHJpdmF0ZSBMaXN0IHByb2Nlc3NCdWZmZXIoQ2xhc3NNZXRhRGF0YSBt\nZXRhLAogICAgICAgIEluaGVyaXRhbmNlT3JkZXJlZE1ldGFEYXRhTGlzdCBi\ndWZmZXIsIGludCBtb2RlKSB7CiAgICAgICAgLy8gaWYgd2UncmUgYWxyZWFk\neSBwcm9jZXNzaW5nIGEgbWV0YWRhdGEsIGp1c3QgYnVmZmVyIHRoaXMgb25l\nOyB3aGVuCiAgICAgICAgLy8gdGhlIGluaXRpYWwgbWV0YWRhdGEgZmluaXNo\nZXMgcHJvY2Vzc2luZywgd2UgdHJhdmVyc2UgdGhlIGJ1ZmZlcgogICAgICAg\nIC8vIGFuZCBwcm9jZXNzIGFsbCB0aGUgb3RoZXJzIHRoYXQgd2VyZSBpbnRy\nb2R1Y2VkIGR1cmluZyByZWVudHJhbnQKICAgICAgICAvLyBjYWxscwogICAg\nICAgIGlmICghYnVmZmVyLmFkZChtZXRhKSB8fCBidWZmZXIuc2l6ZSgpICE9\nIDEpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjb250\naW51YWxseSBwb3AgYSBtZXRhZGF0YSBhbmQgcHJvY2VzcyBpdCB1bnRpbCB3\nZSBydW4gb3V0OyBub3RlCiAgICAgICAgLy8gdGhhdCBlYWNoIHByb2Nlc3Np\nbmcgY2FsbCBtaWdodCBwbGFjZSBtb3JlIG1ldGFzIGluIHRoZSBidWZmZXIg\nYXMKICAgICAgICAvLyBvbmUgY2xhc3MgdHJpZXMgdG8gYWNjZXNzIG1ldGFk\nYXRhIGZvciBhbm90aGVyOyBhbHNvIG5vdGUgdGhhdCB0aGUKICAgICAgICAv\nLyBidWZmZXIgb3JkZXJzIGl0c2VsZiBmcm9tIGxlYXN0IHRvIG1vc3QgZGVy\naXZlZAogICAgICAgIENsYXNzTWV0YURhdGEgYnVmZmVyZWQ7CiAgICAgICAg\nTGlzdCBwcm9jZXNzZWQgPSBuZXcgQXJyYXlMaXN0KDUpOwogICAgICAgIHdo\naWxlICghYnVmZmVyLmlzRW1wdHkoKSkgewogICAgICAgICAgICBidWZmZXJl\nZCA9IGJ1ZmZlci5wZWVrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBidWZmZXJlZC5yZXNvbHZlKG1vZGUpOwogICAgICAgICAgICAg\nICAgcHJvY2Vzc2VkLmFkZChidWZmZXJlZCk7CiAgICAgICAgICAgICAgICBi\ndWZmZXIucmVtb3ZlKGJ1ZmZlcmVkKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgX2VycnMu\nYWRkKHJlKTsKCiAgICAgICAgICAgICAgICAvLyBhbnkgZXhjZXB0aW9uIGR1\ncmluZyByZXNvbHV0aW9uIG9mIG9uZSB0eXBlIG1lYW5zIHdlIGNhbid0CiAg\nICAgICAgICAgICAgICAvLyByZXNvbHZlIGFueSBvZiB0aGUgcmVsYXRlZCB0\neXBlcywgc28gY2xlYXIgYnVmZmVyLiAgdGhpcyBhbHNvCiAgICAgICAgICAg\nICAgICAvLyBlbnN1cmVzIHRoYXQgaWYgdHdvIHR5cGVzIHJlbGF0ZSB0byBl\nYWNoIG90aGVyIGFuZCBvbmUKICAgICAgICAgICAgICAgIC8vIGRpZXMsIHdl\nIGRvbid0IGdldCBpbnRvIGluZmluaXRlIGN5Y2xlcwogICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBidWZmZXIuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBtZXRhID0gKENs\nYXNzTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAg\ncmVtb3ZlTWV0YURhdGEobWV0YSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG1ldGEgIT0gYnVmZmVyZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nX2VycnMuYWRkKG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKCJwcmV2LWVycnMiLCBtZXRhLCBi\ndWZmZXJlZCkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBidWZmZXIuY2xlYXIoKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDaGVjayBp\nZiBwcm9jZXNzIGJ1ZmZlciByZW9yZGVyaW5nIGZvciBQQ1R5cGVzIHRoYXQg\naGF2ZSByZWxhdGlvbnNoaXBzIHRvIG90aGVyIFBDVHlwZXMgaW4gdGhlaXIg\naWRlbnRpdHkgCiAgICAgICAgLy8gc2hvdWxkIGJlIHBlcmZvcm1lZC4KICAg\nICAgICBpZiAoX3Jlb3JkZXJNZXRhRGF0YVJlc29sdXRpb24pIHsKICAgICAg\nICAJcHJvY2Vzc2VkID0gcmVzb2x2ZUZLSW5QS0RlcGVuZGVuY2llc09yZGVy\naW5nKHByb2Nlc3NlZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcm9j\nZXNzZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIHRoZSBt\nZXRhZGF0YSBpbnN0YW5jZXMgY3VycmVudGx5IGluIHRoZSByZXBvc2l0b3J5\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldE1ldGFE\nYXRhcygpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAg\ncmV0dXJuIGdldE1ldGFEYXRhc0xvY2tpbmcoKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGFzSW50ZXJuYWwoKTsK\nICAgICAgICB9CiAgICB9CiAgICBwcml2YXRlIHN5bmNocm9uaXplZCBDbGFz\nc01ldGFEYXRhW10gZ2V0TWV0YURhdGFzTG9ja2luZygpIHsKICAgICAgICBy\nZXR1cm4gZ2V0TWV0YURhdGFzSW50ZXJuYWwoKTsKICAgIH0KICAgIHByaXZh\ndGUgQ2xhc3NNZXRhRGF0YVtdIGdldE1ldGFEYXRhc0ludGVybmFsKCkgewog\nICAgICAgIC8vIHByZXZlbnQgY29uY3VycmVudCBtb2QgZXJyb3JzIHdoZW4g\ncmVzb2x2aW5nIG9uZSBtZXRhZGF0YQogICAgICAgIC8vIGludHJvZHVjZXMg\nb3RoZXJzCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0gKENsYXNz\nTWV0YURhdGFbXSkgX21ldGFzLnZhbHVlcygpLgogICAgICAgICAgICB0b0Fy\ncmF5KG5ldyBDbGFzc01ldGFEYXRhW19tZXRhcy5zaXplKCldKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBpZiAobWV0YXNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGdldE1ldGFEYXRhKG1ldGFzW2ldLmdldERlc2NyaWJlZFR5cGUoKSwKICAg\nICAgICAgICAgICAgICAgICBtZXRhc1tpXS5nZXRFbnZDbGFzc0xvYWRlcigp\nLCB0cnVlKTsKCiAgICAgICAgTGlzdCByZXNvbHZlZCA9IG5ldyBBcnJheUxp\nc3QoX21ldGFzLnNpemUoKSk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX21ldGFzLnZhbHVlcygp\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIG1l\ndGEgPSAoQ2xhc3NNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\naWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJlc29sdmVkLmFk\nZChtZXRhKTsKICAgICAgICB9CiAgICAgICAgbWV0YXMgPSAoQ2xhc3NNZXRh\nRGF0YVtdKSByZXNvbHZlZC50b0FycmF5CiAgICAgICAgICAgIChuZXdDbGFz\nc01ldGFEYXRhQXJyYXkocmVzb2x2ZWQuc2l6ZSgpKSk7CiAgICAgICAgQXJy\nYXlzLnNvcnQobWV0YXMpOwogICAgICAgIHJldHVybiBtZXRhczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIG1ldGFkYXRhIGZv\nciB0aGUgZ2l2ZW4gY2xhc3MsIHdpdGhvdXQgYW55IHJlc29sdXRpb24uCiAg\nICAgKiBSZXR1cm4gbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRDYWNoZWRNZXRhRGF0YShDbGFzcyBjbHMpIHsK\nICAgICAgICByZXR1cm4gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xz\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0\nYWRhdGEsIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVsdCBpbmZvcm1hdGlvbiwg\nYWRkIGl0IHRvCiAgICAgKiB0aGUgcmVwb3NpdG9yeSwgYW5kIHJldHVybiBp\ndC4gVXNlIHRoZSBkZWZhdWx0IGFjY2VzcyB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgQ2xhc3NNZXRhRGF0YSBhZGRNZXRhRGF0YShDbGFzcyBjbHMpIHsK\nICAgICAgICByZXR1cm4gYWRkTWV0YURhdGEoY2xzLCBDbGFzc01ldGFEYXRh\nLkFDQ0VTU19VTktOT1dOKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBtZXRhZGF0YSwgcG9wdWxhdGUgaXQgd2l0aCBkZWZhdWx0IGlu\nZm9ybWF0aW9uLCBhZGQgaXQgdG8KICAgICAqIHRoZSByZXBvc2l0b3J5LCBh\nbmQgcmV0dXJuIGl0LgogICAgICoKICAgICAqIEBwYXJhbSBhY2Nlc3MgdGhl\nIGFjY2VzcyB0eXBlIHRvIHVzZSBpbiBwb3B1bGF0aW5nIG1ldGFkYXRhCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGFkZE1ldGFEYXRhKENs\nYXNzIGNscywgaW50IGFjY2VzcykgewogICAgICAgIGlmIChjbHMgPT0gbnVs\nbCB8fCBjbHMuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG5ld0NsYXNzTWV0\nYURhdGEoY2xzKTsKICAgICAgICBfZmFjdG9yeS5nZXREZWZhdWx0cygpLnBv\ncHVsYXRlKG1ldGEsIGFjY2Vzcyk7CgogICAgICAgIC8vIHN5bmNocm9uaXpl\nIG9uIHRoaXMgcmF0aGVyIHRoYW4gdGhlIG1hcCwgYmVjYXVzZSBhbGwgb3Ro\nZXIgbWV0aG9kcwogICAgICAgIC8vIHRoYXQgYWNjZXNzIF9tZXRhcyBhcmUg\nc3luY2hyb25pemVkIG9uIHRoaXMKICAgICAgICBpZiAoX2xvY2tpbmcpIHsK\nICAgICAgICAgICAgbWV0YXNQdXRMb2NraW5nKGNscywgbWV0YSk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgbWV0YXNQdXRJbnRlcm5hbChjbHMs\nIG1ldGEpOwogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJu\nIG1ldGE7CiAgICB9CiAgICBwcml2YXRlIHN5bmNocm9uaXplZCB2b2lkIG1l\ndGFzUHV0TG9ja2luZyhDbGFzcyBjbHMsIENsYXNzTWV0YURhdGEgbWV0YSl7\nCiAgICAgICAgbWV0YXNQdXRJbnRlcm5hbChjbHMsIG1ldGEpOwogICAgfQog\nICAgcHJpdmF0ZSB2b2lkIG1ldGFzUHV0SW50ZXJuYWwoQ2xhc3MgY2xzLCBD\nbGFzc01ldGFEYXRhIG1ldGEpewogICAgICAgIGlmIChfcGF3YXJlcy5jb250\nYWluc0tleShjbHMpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoInBjLWFuZC1hd2FyZSIsIGNscykpOwogICAg\nICAgIF9tZXRhcy5wdXQoY2xzLCBtZXRhKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgY2xhc3MgbWV0YWRhdGEgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIG5ld0NsYXNz\nTWV0YURhdGEoQ2xhc3MgdHlwZSkgewogICAgICAgIHJldHVybiBuZXcgQ2xh\nc3NNZXRhRGF0YSh0eXBlLCB0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyBhcnJheSBvZiB0aGUgcHJvcGVyIGNsYXNzIG1ldGFk\nYXRhIHN1YmNsYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRh\nRGF0YVtdIG5ld0NsYXNzTWV0YURhdGFBcnJheShpbnQgbGVuZ3RoKSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBDbGFzc01ldGFEYXRhW2xlbmd0aF07CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgZmllbGQgbWV0YWRhdGEg\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRh\nIG5ld0ZpZWxkTWV0YURhdGEoU3RyaW5nIG5hbWUsIENsYXNzIHR5cGUsCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBvd25lcikgewogICAgICAgIHJldHVybiBu\nZXcgRmllbGRNZXRhRGF0YShuYW1lLCB0eXBlLCBvd25lcik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgYXJyYXkgb2YgdGhlIHByb3Bl\nciBmaWVsZCBtZXRhZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIEZpZWxkTWV0YURhdGFbXSBuZXdGaWVsZE1ldGFEYXRhQXJyYXkoaW50\nIGxlbmd0aCkgewogICAgICAgIHJldHVybiBuZXcgRmllbGRNZXRhRGF0YVts\nZW5ndGhdOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGFy\ncmF5IG9mIHRoZSBwcm9wZXIgeG1sIGNsYXNzIG1ldGFkYXRhIHN1YmNsYXNz\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgWE1MTWV0YURhdGFbXSBuZXdYTUxD\nbGFzc01ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkgewogICAgICAgIHJldHVy\nbiBuZXcgWE1MQ2xhc3NNZXRhRGF0YVtsZW5ndGhdOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IGVtYmVkZGVkIGNsYXNzIG1ldGFkYXRh\nIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0\nYSBuZXdFbWJlZGRlZENsYXNzTWV0YURhdGEoVmFsdWVNZXRhRGF0YSBvd25l\ncikgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YShvd25lcik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgdmFsdWUgbWV0\nYWRhdGEgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZU1l\ndGFEYXRhIG5ld1ZhbHVlTWV0YURhdGEoRmllbGRNZXRhRGF0YSBvd25lcikg\newogICAgICAgIHJldHVybiBuZXcgVmFsdWVNZXRhRGF0YUltcGwob3duZXIp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIHtAbGluayBPcmRl\ncn0gZm9yIHRoZSBnaXZlbiBmaWVsZCBhbmQgZGVjbGFyYXRpb24uIFRoaXMK\nICAgICAqIG1ldGhvZCBkZWxlZ2F0ZXMgdG8ge0BsaW5rICNuZXdSZWxhdGVk\nRmllbGRPcmRlcn0gYW5kCiAgICAgKiB7QGxpbmsgI25ld1ZhbHVlRmllbGRP\ncmRlcn0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVy\nIG5ld09yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsIFN0cmluZyBuYW1lLCBi\nb29sZWFuIGFzYykgewogICAgICAgIC8vIHBhdGhzIGNhbiBzdGFydCB3aXRo\nIChvciBlcXVhbCkgJyNlbGVtZW50JwogICAgICAgIGlmIChuYW1lLnN0YXJ0\nc1dpdGgoT3JkZXIuRUxFTUVOVCkpCiAgICAgICAgICAgIG5hbWUgPSBuYW1l\nLnN1YnN0cmluZyhPcmRlci5FTEVNRU5ULmxlbmd0aCgpKTsKICAgICAgICBp\nZiAobmFtZS5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gbmV3\nVmFsdWVPcmRlcihvd25lciwgYXNjKTsKCiAgICAgICAgLy8gbmV4dCB0b2tl\nbiBzaG91bGQgYmUgJy4nCiAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApID09\nICcuJykKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwoK\nICAgICAgICAvLyByZWxhdGVkIGZpZWxkCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gb3duZXIuZ2V0RWxlbWVudCgpLmdldFR5cGVNZXRhRGF0YSgp\nOwogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm9ucGMtZmllbGQt\nb3JkZXJhYmxlIiwKICAgICAgICAgICAgICAgIG93bmVyLCBuYW1lKSk7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSByZWwgPSBtZXRhLmdldEZpZWxkKG5hbWUp\nOwogICAgICAgIGlmIChyZWwgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmllbGQtb3Jk\nZXJhYmxlIiwKICAgICAgICAgICAgICAgIG93bmVyLCBuYW1lKSk7CiAgICAg\nICAgcmV0dXJuIG5ld1JlbGF0ZWRGaWVsZE9yZGVyKG93bmVyLCByZWwsIGFz\nYyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcmRlciBieSB0aGUgZmllbGQg\ndmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRlciBuZXdWYWx1ZU9y\nZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsIGJvb2xlYW4gYXNjKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBJbk1lbW9yeVZhbHVlT3JkZXIoYXNjLCBnZXRDb25m\naWd1cmF0aW9uKCkpOwogICAgfQoKICAgIC8qKgogICAgICogT3JkZXIgYnkg\nYSBmaWVsZCBvZiB0aGUgcmVsYXRlZCB0eXBlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgT3JkZXIgbmV3UmVsYXRlZEZpZWxkT3JkZXIoRmllbGRNZXRhRGF0\nYSBvd25lciwKICAgICAgICBGaWVsZE1ldGFEYXRhIHJlbCwgYm9vbGVhbiBh\nc2MpIHsKICAgICAgICByZXR1cm4gbmV3IEluTWVtb3J5UmVsYXRlZEZpZWxk\nT3JkZXIocmVsLCBhc2MsIGdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gYXJyYXkgb2Ygb3JkZXJzIG9mIHRo\nZSBnaXZlbiBzaXplLgogICAgICovCiAgICBwcm90ZWN0ZWQgT3JkZXJbXSBu\nZXdPcmRlckFycmF5KGludCBzaXplKSB7CiAgICAgICAgcmV0dXJuIG5ldyBP\ncmRlcltzaXplXTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIG1l\ndGFkYXRhIGluc3RhbmNlIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92ZWQsIGZhbHNlIGlmIG5vdCBp\nbiB0aGlzIHJlcG9zaXRvcnkKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\ncmVtb3ZlTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIHJldHVybiByZW1vdmVNZXRhRGF0YShtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBtZXRh\nZGF0YSBpbnN0YW5jZSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAgICoKICAg\nICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4g\ndGhpcyByZXBvc2l0b3J5CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZU1ldGFEYXRhKENsYXNzIGNscykgewogICAgICAgIGlmKF9sb2NraW5n\nKXsKICAgICAgICAgICAgcmV0dXJuIHJlbW92ZU1ldGFEYXRhTG9ja2luZyhj\nbHMpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4gcmVtb3Zl\nTWV0YURhdGFJbnRlcm5hbChjbHMpOwogICAgICAgIH0KICAgIH0KICAgIHBy\naXZhdGUgc3luY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlTWV0YURhdGFMb2Nr\naW5nKENsYXNzIGNscykgewogICAgICAgIHJldHVybiByZW1vdmVNZXRhRGF0\nYUludGVybmFsKGNscyk7CiAgICB9CiAgICBwcml2YXRlIGJvb2xlYW4gcmVt\nb3ZlTWV0YURhdGFJbnRlcm5hbChDbGFzcyBjbHMpIHsKICAgICAgICBpZiAo\nY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBpZiAoX21ldGFzLnJlbW92ZShjbHMpICE9IG51bGwpIHsKICAgICAgICAg\nICAgQ2xhc3MgaW1wbCA9IChDbGFzcykgX2lmYWNlcy5yZW1vdmUoY2xzKTsK\nICAgICAgICAgICAgaWYgKGltcGwgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9tZXRhcy5yZW1vdmUoaW1wbCk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIG1ldGFkYXRhIGFzIGRlY2xhcmVk\nIGludGVyZmFjZSBpbXBsZW1lbnRhdGlvbi4KICAgICAqLwogICAgdm9pZCBh\nZGREZWNsYXJlZEludGVyZmFjZUltcGwoQ2xhc3NNZXRhRGF0YSBtZXRhLCBD\nbGFzcyBpZmFjZSkgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAg\nICAgICBhZGREZWNsYXJlZEludGVyZmFjZUltcGxMb2NraW5nKG1ldGEsIGlm\nYWNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhZGREZWNsYXJl\nZEludGVyZmFjZUltcGxJbnRlcm5hbChtZXRhLCBpZmFjZSk7CiAgICAgICAg\nfQogICAgfQogICAgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZUltcGxMb2Nr\naW5nKENsYXNzTWV0YURhdGEgbWV0YSwgQ2xhc3MgaWZhY2UpIHsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKF9pbXBscykgewogICAgICAgICAgICBhZGREZWNs\nYXJlZEludGVyZmFjZUltcGxJbnRlcm5hbChtZXRhLCBpZmFjZSk7CiAgICAg\nICAgfQogICAgfQogICAgcHJpdmF0ZSB2b2lkIGFkZERlY2xhcmVkSW50ZXJm\nYWNlSW1wbEludGVybmFsKENsYXNzTWV0YURhdGEgbWV0YSwgQ2xhc3MgaWZh\nY2UpIHsKICAgICAgICBDb2xsZWN0aW9uIHZhbHMgPSAoQ29sbGVjdGlvbikg\nX2ltcGxzLmdldChpZmFjZSk7CiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlm\nIHRoZSBzdXBlcmNsYXNzIGFscmVhZHkgZGVjbGFyZXMgdG8gYXZvaWQgZHVw\ncwogICAgICAgIGlmICh2YWxzICE9IG51bGwpIHsKICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBzdXAgPSBtZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgICAgIGZvciAoOyBzdXAgIT0gbnVsbDsgc3VwID0gc3Vw\nLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpCiAgICAgICAgICAgICAgICBp\nZiAodmFscy5jb250YWlucyhzdXAuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGFk\nZFRvQ29sbGVjdGlvbihfaW1wbHMsIGlmYWNlLCBtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwgZmFsc2UpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIGltcGxlbWVudGF0aW9uIGZvciB0aGUgZ2l2ZW4gbWFuYWdlZCBpbnRlcmZh\nY2UuCiAgICAgKi8KICAgIHZvaWQgc2V0SW50ZXJmYWNlSW1wbChDbGFzc01l\ndGFEYXRhIG1ldGEsIENsYXNzIGltcGwpIHsKICAgICAgICBpZihfbG9ja2lu\nZyl7CiAgICAgICAgICAgIHNldEludGVyZmFjZUltcGxMb2NraW5nKG1ldGEs\nIGltcGwpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBzZXRJbnRlcmZh\nY2VJbXBsSW50ZXJuYWwobWV0YSwgaW1wbCk7CiAgICAgICAgfQogICAgfQog\nICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgdm9pZCBzZXRJbnRlcmZhY2VJbXBs\nTG9ja2luZyhDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNzIGltcGwpIHsKICAg\nICAgICBzZXRJbnRlcmZhY2VJbXBsSW50ZXJuYWwobWV0YSwgaW1wbCk7CiAg\nICB9CiAgICBwcml2YXRlIHZvaWQgc2V0SW50ZXJmYWNlSW1wbEludGVybmFs\nKENsYXNzTWV0YURhdGEgbWV0YSwgQ2xhc3MgaW1wbCkgewogICAgICAgIGlm\nICghbWV0YS5pc01hbmFnZWRJbnRlcmZhY2UoKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtbWFuYWdl\nZC1pbnRlcmZhY2UiLCAKICAgICAgICAgICAgICAgIG1ldGEsIGltcGwpKTsK\nICAgICAgICBfaWZhY2VzLnB1dChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwg\naW1wbCk7CiAgICAgICAgYWRkRGVjbGFyZWRJbnRlcmZhY2VJbXBsKG1ldGEs\nIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICBDbGFzc01ldGFE\nYXRhIHN1cCA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICB3aGlsZSAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gcmVj\nb3JkIHN1cGVyY2xhc3MgaW50ZXJmYWNlIGluZm8gd2hpbGUgd2UgY2FuIGFz\nIHdlbGwgYXMgd2UKICAgICAgICAgICAgLy8gd2lsbCBvbmx5IHJlZ2lzdGVy\nIGNvbmNyZXRlIHN1cGVyY2xhc3MgaW4gUENSZWdpc3RyeQogICAgICAgICAg\nICBzdXAuY2xlYXJTdWJjbGFzc0NhY2hlKCk7CiAgICAgICAgICAgIGFkZFRv\nQ29sbGVjdGlvbihfc3Vicywgc3VwLmdldERlc2NyaWJlZFR5cGUoKSwgaW1w\nbCwgdHJ1ZSk7CiAgICAgICAgICAgIHN1cCA9IChDbGFzc01ldGFEYXRhKSBz\ndXAuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICB9CiAgICB9\nCiAgICAKICAgIEludGVyZmFjZUltcGxHZW5lcmF0b3IgZ2V0SW1wbEdlbmVy\nYXRvcigpIHsKICAgICAgICByZXR1cm4gX2ltcGxHZW47CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxlYXN0LWRlcml2ZWQgY2xhc3MgbWV0\nYWRhdGEgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbgogICAgICogaWRlbnRp\ndHkgb2JqZWN0LgogICAgICoKICAgICAqIEBwYXJhbSBvaWQgdGhlIG9pZCB0\nbyBnZXQgdGhlIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRl\nciB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlmIGFueQogICAg\nICogQHBhcmFtIG11c3RFeGlzdCBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsg\nTWV0YURhdGFFeGNlcHRpb259CiAgICAgKiBpZiBubyBtZXRhZGF0YSBpcyBm\nb3VuZAogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRh\nRGF0YShPYmplY3Qgb2lkLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsCiAgICAg\nICAgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBpZiAob2lkID09IG51\nbGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW9pZC1tZXRhIiwgb2lkLCAiPyIs\nCiAgICAgICAgICAgICAgICBfb2lkcy50b1N0cmluZygpKSk7CiAgICAgICAg\naWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgaWYgKG9pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgewogICAgICAg\nICAgICBDbGFzcyBjbHMgPSAoKE9wZW5KUEFJZCkgb2lkKS5nZXRUeXBlKCk7\nCiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRl\nciwgbXVzdEV4aXN0KTsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGNh\nY2hlCiAgICAgICAgcHJvY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKGVudkxvYWRl\ncik7CiAgICAgICAgQ2xhc3MgY2xzID0gKENsYXNzKSBfb2lkcy5nZXQob2lk\nLmdldENsYXNzKCkpOwogICAgICAgIGlmIChjbHMgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0\nRXhpc3QpOwoKICAgICAgICAvLyBtYXliZSB0aGlzIGlzIHNvbWUgdHlwZSB3\nZSd2ZSBzZWVuIGJ1dCBqdXN0IGlzbid0IHZhbGlkCiAgICAgICAgaWYgKF9v\naWRzLmNvbnRhaW5zS2V5KG9pZC5nZXRDbGFzcygpKSkgewogICAgICAgICAg\nICBpZiAobXVzdEV4aXN0KQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9pZCwK\nICAgICAgICAgICAgICAgICAgICBvaWQuZ2V0Q2xhc3MoKSwgX29pZHMpKTsK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAv\nLyBpZiBzdGlsbCBub3QgbWF0Y2gsIHJlZ2lzdGVyIGFueSBjbGFzc2VzIHRo\nYXQgbG9vayBzaW1pbGFyIHRvIHRoZQogICAgICAgIC8vIG9pZCBjbGFzcyBh\nbmQgY2hlY2sgYWdhaW4KICAgICAgICByZXNvbHZlSWRlbnRpdHlDbGFzcyhv\naWQpOwogICAgICAgIGlmIChwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoZW52\nTG9hZGVyKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNscyA9IChDbGFz\ncykgX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAgICAgICAgaWYg\nKGNscyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGdldE1ldGFE\nYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBhbiBpbnZhbGlkIHR5cGUK\nICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNzKCksIG51bGwpOwoKICAg\nICAgICBpZiAoIW11c3RFeGlzdCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1vaWQtbWV0YSIsIG9pZCwKICAgICAgICAgICAgb2lkLmdldENsYXNz\nKCksIF9vaWRzKSkuc2V0RmFpbGVkT2JqZWN0KG9pZCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYWtlIHNvbWUgZ3Vlc3NlcyBhYm91dCB0aGUgbmFtZSBv\nZiBhIHRhcmdldCBjbGFzcyBmb3IgYW4KICAgICAqIHVua25vd24gYXBwbGlj\nYXRpb24gaWRlbnRpdHkgY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCByZXNvbHZlSWRlbnRpdHlDbGFzcyhPYmplY3Qgb2lkKSB7CiAgICAgICAg\naWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIENsYXNzIG9pZENsYXNzID0gb2lkLmdldENsYXNzKCk7CiAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgicmVzb2x2ZS1pZGVudGl0eSIsIG9pZENsYXNzKSk7Cgog\nICAgICAgIENsYXNzTG9hZGVyIGNsID0gKENsYXNzTG9hZGVyKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24ob2lkQ2xhc3MpKTsgCiAgICAg\nICAgU3RyaW5nIGNsYXNzTmFtZTsKICAgICAgICB3aGlsZSAob2lkQ2xhc3Mg\nIT0gbnVsbCAmJiBvaWRDbGFzcyAhPSBPYmplY3QuY2xhc3MpIHsKICAgICAg\nICAgICAgY2xhc3NOYW1lID0gb2lkQ2xhc3MuZ2V0TmFtZSgpOwoKICAgICAg\nICAgICAgLy8gd2UgdGFrZSBhIGJydXRlLWZvcmNlIGFwcHJvYWNoOiB0cnkg\ndG8gbG9hZCBhbGwgdGhlIGNsYXNzJwogICAgICAgICAgICAvLyBzdWJzdHJp\nbmdzLiB0aGlzIHdpbGwgaGFuZGxlIHRoZSBmb2xsb3dpbmcgY29tbW9uIG5h\nbWluZyBjYXNlczoKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICBj\nb20uY29tcGFueS5NeUNsYXNzJElECS0+IGNvbS5jb21wYW55Lk15Q2xhc3MK\nICAgICAgICAgICAgLy8gICBjb20uY29tcGFueS5NeUNsYXNzSWQJLT4gY29t\nLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAgICAvLyAgIGNvbS5jb21wYW55\nLk15Q2xhc3NPaWQJLT4gY29tLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAg\nICAvLyAgIGNvbS5jb21wYW55Lk15Q2xhc3NQSwktPiBjb20uY29tcGFueS5N\neUNsYXNzCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIHRoaXMgaXNu\nJ3QgdGhlIGZhc3Rlc3QgdGhpbmcgcG9zc2libGUsIGJ1dCB0aGlzIG1ldGhv\nZCB3aWxsCiAgICAgICAgICAgIC8vIG9ubHkgYmUgY2FsbGVkIG9uY2UgcGVy\nIEpWTSBwZXIgdW5rbm93biBhcHAgaWQgY2xhc3MKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IGNsYXNzTmFtZS5sZW5ndGgoKTsgaSA+IDE7IGktLSkgewog\nICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZS5jaGFyQXQoaSAtIDEpID09\nICcuJykKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUo\nY2xhc3NOYW1lLnN1YnN0cmluZygwLCBpKSwgdHJ1ZSwgY2wpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIH0gLy8gY29uc3VtZSBhbGwgZXhjZXB0aW9ucwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBtb3ZlIHVwIHRoZSBPSUQgaGllcmFyY2h5CiAg\nICAgICAgICAgIG9pZENsYXNzID0gb2lkQ2xhc3MuZ2V0U3VwZXJjbGFzcygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwg\nbGVhc3QtZGVyaXZlZCBtZXRhZGF0YXMgd2l0aCBzb21lIG1hcHBlZCBhc3Np\nZ25hYmxlIHR5cGUgdGhhdAogICAgICogaW1wbGVtZW50IHRoZSBnaXZlbiBj\nbGFzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gY2xzIHRoZSBjbGFzcyBvciBp\nbnRlcmZhY2UgdG8gcmV0cmlldmUgaW1wbGVtZW50b3JzIGZvcgogICAgICog\nQHBhcmFtIGVudkxvYWRlciB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2Fk\nZXIsIGlmIGFueQogICAgICogQHBhcmFtIG11c3RFeGlzdCBpZiB0cnVlLCB0\naHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259CiAgICAgKiBpZiBu\nbyBtZXRhZGF0YSBpcyBmb3VuZAogICAgICovCiAgICBwdWJsaWMgQ2xhc3NN\nZXRhRGF0YVtdIGdldEltcGxlbWVudG9yTWV0YURhdGFzKENsYXNzIGNscywK\nICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4\naXN0KSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsICYmIG11c3RFeGlzdCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1tZXRhIiwgY2xzKSk7CiAgICAgICAgaWYgKGNscyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gRU1QVFlfTUVUQVM7CgogICAgICAgIC8v\nIGdldCBpbXBscyBvZiBnaXZlbiBpbnRlcmZhY2UgLyBhYnN0cmFjdCBjbGFz\ncwogICAgICAgIGxvYWRSZWdpc3RlcmVkQ2xhc3NNZXRhRGF0YShlbnZMb2Fk\nZXIpOwogICAgICAgIENvbGxlY3Rpb24gdmFscyA9IChDb2xsZWN0aW9uKSBf\naW1wbHMuZ2V0KGNscyk7CiAgICAgICAgQ29sbGVjdGlvbiBtYXBwZWQgPSBu\ndWxsOwogICAgICAgIGlmICh2YWxzICE9IG51bGwpIHsKICAgICAgICAgICAg\naWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgICAgICBtYXBwZWQgPSBnZXRJ\nbXBsZW1lbnRvck1ldGFEYXRhc0xvY2tpbmcodmFscywgZW52TG9hZGVyLCBt\ndXN0RXhpc3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgbWFwcGVkID0gZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXNJbnRlcm5hbCh2\nYWxzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGlmIChtYXBwZWQgPT0gbnVsbCAmJiBtdXN0RXhp\nc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tbWV0YSIsIGNscykpOwogICAgICAgIGlmIChtYXBwZWQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX01FVEFTOwogICAg\nICAgIHJldHVybiAoQ2xhc3NNZXRhRGF0YVtdKSBtYXBwZWQudG9BcnJheShu\nZXdDbGFzc01ldGFEYXRhQXJyYXkKICAgICAgICAgICAgKG1hcHBlZC5zaXpl\nKCkpKTsKICAgIH0KICAgIHByaXZhdGUgQ29sbGVjdGlvbiBnZXRJbXBsZW1l\nbnRvck1ldGFEYXRhc0xvY2tpbmcoQ29sbGVjdGlvbjxDbGFzcz4gY2xhc3Nl\ncywgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkg\newogICAgICAgIHN5bmNocm9uaXplZCAoY2xhc3NlcykgewogICAgICAgICAg\nICByZXR1cm4gZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXNJbnRlcm5hbChjbGFz\nc2VzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQogICAgfQog\nICAgcHJpdmF0ZSBDb2xsZWN0aW9uIGdldEltcGxlbWVudG9yTWV0YURhdGFz\nSW50ZXJuYWwoQ29sbGVjdGlvbjxDbGFzcz4gY2xhc3NlcywgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIENv\nbGxlY3Rpb24gbWFwcGVkID0gbmV3IEFycmF5TGlzdChjbGFzc2VzLnNpemUo\nKSk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbnVsbDsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNsYXNzZXMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgbWV0YSA9IGdldE1ldGFEYXRh\nKChDbGFzcykgaXRyLm5leHQoKSwgZW52TG9hZGVyLCB0cnVlKTsKICAgICAg\nICAgICAgaWYgKG1ldGEuaXNNYXBwZWQoKSB8fCBtZXRhLmdldE1hcHBlZFBD\nU3ViY2xhc3NNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAg\nICAgICBtYXBwZWQuYWRkKG1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBtYXBwZWQ7CiAgICB9CiAgICAgCiAgICAvKioK\nICAgICAqIEdldHMgdGhlIG1ldGFkYXRhIGNvcnJlc3BvbmRpbmcgdG8gdGhl\nIGdpdmVuIHBlcnNpc3RlbmNlLWF3YXJlIGNsYXNzLiAKICAgICAqIFJldHVy\nbnMgbnVsbCwgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIG5vdCByZWdpc3RlcmVk\nIGFzIAogICAgICogcGVyc2lzdGVuY2UtYXdhcmUuCiAgICAgKi8KICAgIHB1\nYmxpYyBOb25QZXJzaXN0ZW50TWV0YURhdGEgZ2V0UGVyc2lzdGVuY2VBd2Fy\nZShDbGFzcyBjbHMpIHsKICAgIAlyZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRh\nRGF0YSlfcGF3YXJlcy5nZXQoY2xzKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBHZXRzIGFsbCB0aGUgbWV0YWRhdGFzIGZvciBwZXJzaXN0ZW5jZS1h\nd2FyZSBjbGFzc2VzCiAgICAgKiAKICAgICAqIEByZXR1cm4gZW1wdHkgYXJy\nYXkgaWYgbm8gY2xhc3MgaGFzIGJlZW4gcmVnaXN0ZXJlZCBhcyBwZXJzLWF3\nYXJlCiAgICAgKi8KICAgIHB1YmxpYyBOb25QZXJzaXN0ZW50TWV0YURhdGFb\nXSBnZXRQZXJzaXN0ZW5jZUF3YXJlcygpIHsKICAgICAgICBpZiAoX2xvY2tp\nbmcpIHsKICAgICAgICAgICAgcmV0dXJuIGdldFBlcnNpc3RlbmNlQXdhcmVz\nTG9ja2luZygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVy\nbiBnZXRQZXJzaXN0ZW5jZUF3YXJlc0ludGVybmFsKCk7CiAgICAgICAgfQog\nICAgfQogICAgcHJpdmF0ZSBOb25QZXJzaXN0ZW50TWV0YURhdGFbXSBnZXRQ\nZXJzaXN0ZW5jZUF3YXJlc0xvY2tpbmcoKSB7CiAgICAgICAgc3luY2hyb25p\nemVkIChfcGF3YXJlcykgewogICAgICAgICAgICByZXR1cm4gZ2V0UGVyc2lz\ndGVuY2VBd2FyZXNJbnRlcm5hbCgpOwogICAgICAgIH0KICAgIH0KICAgIHBy\naXZhdGUgTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gZ2V0UGVyc2lzdGVuY2VB\nd2FyZXNJbnRlcm5hbCgpIHsKICAgICAgICAgICAgaWYgKF9wYXdhcmVzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBUWV9OT05fUEVS\nU0lTVEVOVDsKICAgICAgICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0\nYVtdKSBfcGF3YXJlcy52YWx1ZXMoKS50b0FycmF5KG5ldyBOb25QZXJzaXN0\nZW50TWV0YURhdGFbX3Bhd2FyZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNsYXNzIGFzIHBlcnNpc3RlbmNlLWF3\nYXJlLgogICAgICogCiAgICAgKiBAcGFyYW0gY2xzIG5vbi1udWxsIGFuZCBt\ndXN0IG5vdCBhbHJlYWRkeSBiZSBhZGRlZCBhcyBwZXJzaXRlbmNlLWNhcGFi\nbGUKICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBh\nZGRQZXJzaXN0ZW5jZUF3YXJlKENsYXNzIGNscykgewogICAgCWlmIChjbHMg\nPT0gbnVsbCkKICAgIAkJcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKF9sb2Nr\naW5nKSB7CiAgICAgICAgICAgIHJldHVybiBhZGRQZXJzaXN0ZW5jZUF3YXJl\nTG9ja2luZyhjbHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJl\ndHVybiBhZGRQZXJzaXN0ZW5jZUF3YXJlSW50ZXJuYWwoY2xzKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgTm9uUGVyc2lz\ndGVudE1ldGFEYXRhIGFkZFBlcnNpc3RlbmNlQXdhcmVMb2NraW5nKENsYXNz\nIGNscykgewogICAgICAgIHJldHVybiBhZGRQZXJzaXN0ZW5jZUF3YXJlSW50\nZXJuYWwoY2xzKTsKICAgIH0KCiAgICBwcml2YXRlIE5vblBlcnNpc3RlbnRN\nZXRhRGF0YSBhZGRQZXJzaXN0ZW5jZUF3YXJlSW50ZXJuYWwoQ2xhc3MgY2xz\nKSB7CiAgICAgICAgICAgIGlmIChfcGF3YXJlcy5jb250YWluc0tleShjbHMp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURh\ndGEpX3Bhd2FyZXMuZ2V0KGNscyk7CiAgICAgICAgICAgIGlmIChnZXRDYWNo\nZWRNZXRhRGF0YShjbHMpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInBjLWFuZC1hd2Fy\nZSIsIGNscykpOwogICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBtZXRh\nID0gbmV3IE5vblBlcnNpc3RlbnRNZXRhRGF0YShjbHMsIHRoaXMsIE5vblBl\ncnNpc3RlbnRNZXRhRGF0YS5UWVBFX1BFUlNJU1RFTkNFX0FXQVJFKTsKICAg\nICAgICAgICAgX3Bhd2FyZXMucHV0KGNscywgbWV0YSk7CiAgICAgICAgICAg\nIHJldHVybiBtZXRhOwogICAgCX0KCiAgICAvKioKICAgICAqIFJlbW92ZSBh\nIHBlcnNpdGVuY2UtYXdhcmUgY2xhc3MgZnJvbSB0aGUgcmVwb3NpdG9yeQog\nICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZAogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVQZXJzaXN0ZW5jZUF3YXJlKENs\nYXNzIGNscykgewogICAgCXJldHVybiBfcGF3YXJlcy5yZW1vdmUoY2xzKSAh\nPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgbWV0YWRh\ndGEgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gbm9uLW1hcHBlZCBpbnRl\ncmZhY2UuCiAgICAgKiBSZXR1cm5zIG51bGwsIGlmIHRoZSBnaXZlbiBpbnRl\ncmZhY2UgaXMgbm90IHJlZ2lzdGVyZWQgYXMgCiAgICAgKiBwZXJzaXN0ZW5j\nZS1hd2FyZS4KICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRh\nRGF0YSBnZXROb25NYXBwZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAg\nIAlyZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSlfbm9uTWFwcGVkLmdl\ndChpZmFjZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0aGUg\nY29ycmVzcG9uZGluZyBtZXRhZGF0YXMgZm9yIGFsbCByZWdpc3RlcmVkLCBu\nb24tbWFwcGVkCiAgICAgKiBpbnRlcmZhY2VzCiAgICAgKiAKICAgICAqIEBy\nZXR1cm4gZW1wdHkgYXJyYXkgaWYgbm8gbm9uLW1hcHBlZCBpbnRlcmZhY2Ug\naGFzIGJlZW4gcmVnaXN0ZXJlZC4KICAgICAqLwogICAgcHVibGljIE5vblBl\ncnNpc3RlbnRNZXRhRGF0YVtdIGdldE5vbk1hcHBlZEludGVyZmFjZXMoKSB7\nCiAgICAgICAgaWYoX2xvY2tpbmcpewogICAgICAgICAgICByZXR1cm4gZ2V0\nTm9uTWFwcGVkSW50ZXJmYWNlc0xvY2tpbmcoKTsgICAKICAgICAgICB9ZWxz\nZXsKICAgICAgICAgICAgcmV0dXJuIGdldE5vbk1hcHBlZEludGVyZmFjZXNJ\nbnRlcm5hbCgpOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhW10gZ2V0Tm9uTWFwcGVkSW50ZXJmYWNlc0xvY2tp\nbmcoKSB7CiAgICAgICAgc3luY2hyb25pemVkIChfbm9uTWFwcGVkKSB7CiAg\nICAgICAgICAgIHJldHVybiBnZXROb25NYXBwZWRJbnRlcmZhY2VzSW50ZXJu\nYWwoKTsKICAgICAgICB9CiAgICB9CiAgICBwcml2YXRlIE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YVtdIGdldE5vbk1hcHBlZEludGVyZmFjZXNJbnRlcm5hbCgp\nIHsKICAgICAgICAgICAgaWYgKF9ub25NYXBwZWQuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX05PTl9QRVJTSVNURU5UOwogICAg\nICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhW10pIF9ub25NYXBw\nZWQudmFsdWVzKCkudG9BcnJheShuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRh\nW19ub25NYXBwZWQuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgdGhlIGdpdmVuIG5vbi1tYXBwZWQgaW50ZXJmYWNlIHRvIHRoZSByZXBv\nc2l0b3J5LgogICAgICogCiAgICAgKiBAcGFyYW0gaWZhY2UgdGhlIG5vbi1t\nYXBwZWQgaW50ZXJmYWNlCiAgICAgKi8KICAgIHB1YmxpYyBOb25QZXJzaXN0\nZW50TWV0YURhdGEgYWRkTm9uTWFwcGVkSW50ZXJmYWNlKENsYXNzIGlmYWNl\nKSB7CiAgICAJaWYgKGlmYWNlID09IG51bGwpCiAgICAJCXJldHVybiBudWxs\nOwogICAgICAgIGlmICghaWZhY2UuaXNJbnRlcmZhY2UoKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qt\nbm9uLW1hcHBlZCIsIGlmYWNlKSk7CiAgICAgICAgaWYoX2xvY2tpbmcpewog\nICAgICAgICAgICByZXR1cm4gYWRkTm9uTWFwcGVkSW50ZXJmYWNlTG9ja2lu\nZyhpZmFjZSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiBh\nZGROb25NYXBwZWRJbnRlcmZhY2VJbnRlcm5hbChpZmFjZSk7IAogICAgICAg\nIH0KICAgIH0KICAgIHByaXZhdGUgc3luY2hyb25pemVkIE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YSBhZGROb25NYXBwZWRJbnRlcmZhY2VMb2NraW5nKENsYXNz\nIGlmYWNlKSB7CiAgICAgICAgcmV0dXJuIGFkZE5vbk1hcHBlZEludGVyZmFj\nZUludGVybmFsKGlmYWNlKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBOb25Q\nZXJzaXN0ZW50TWV0YURhdGEgYWRkTm9uTWFwcGVkSW50ZXJmYWNlSW50ZXJu\nYWwoQ2xhc3MgaWZhY2UpIHsKICAgICAgICAgICAgaWYgKF9ub25NYXBwZWQu\nY29udGFpbnNLZXkoaWZhY2UpKQogICAgICAgICAgICAgICAgcmV0dXJuIChO\nb25QZXJzaXN0ZW50TWV0YURhdGEpX25vbk1hcHBlZC5nZXQoaWZhY2UpOwog\nICAgICAgICAgICBpZiAoZ2V0Q2FjaGVkTWV0YURhdGEoaWZhY2UpICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vbi1tYXBwZWQtcGMiLCBpZmFjZSkpOwogICAgICAg\nICAgICBOb25QZXJzaXN0ZW50TWV0YURhdGEgbWV0YSA9IG5ldyBOb25QZXJz\naXN0ZW50TWV0YURhdGEoaWZhY2UsIHRoaXMsCiAgICAgICAgICAgICAgICBO\nb25QZXJzaXN0ZW50TWV0YURhdGEuVFlQRV9OT05fTUFQUEVEX0lOVEVSRkFD\nRSk7CiAgICAgICAgICAgIF9ub25NYXBwZWQucHV0KGlmYWNlLCBtZXRhKTsK\nICAgICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICAJfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIGEgbm9uLW1hcHBlZCBpbnRlcmZhY2UgZnJvbSB0aGUgcmVw\nb3NpdG9yeQogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3Zl\nZAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVOb25NYXBwZWRJ\nbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgIAlyZXR1cm4gX25vbk1hcHBl\nZC5yZW1vdmUoaWZhY2UpICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbGVhciB0aGUgY2FjaGUgb2YgcGFyc2VkIG1ldGFkYXRhLiBUaGlzIG1l\ndGhvZCBhbHNvIGNsZWFycyB0aGUKICAgICAqIGludGVybmFsIHtAbGluayBN\nZXRhRGF0YUZhY3RvcnkgTWV0YURhdGFGYWN0b3J5fSdzIGNhY2hlLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJjbGVhci1yZXBvcyIsIHRoaXMpKTsKICAgICAgICAKICAgICAg\nICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgY2xlYXJMb2NraW5nKCk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2xlYXJJbnRlcm5hbCgp\nOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgc3luY2hyb25pemVkIHZv\naWQgY2xlYXJMb2NraW5nKCl7CiAgICAgICAgY2xlYXJJbnRlcm5hbCgpOwog\nICAgfQogICAgcHJpdmF0ZSB2b2lkIGNsZWFySW50ZXJuYWwoKXsKICAgICAg\nICAvLyBSZWNyZWF0aW5nIHRoZXNlIGRhdGFzdHJ1Y3R1cmVzIGlzIHByb2Jh\nYmx5IGZhc3RlciB0aGFuIGNhbGxpbmcgY2xlYXIuIEZ1dHVyZSBjaGFuZ2U/\nCiAgICAgICAgX21ldGFzLmNsZWFyKCk7CiAgICAgICAgX29pZHMuY2xlYXIo\nKTsKICAgICAgICBfc3Vicy5jbGVhcigpOwogICAgICAgIF9pbXBscy5jbGVh\ncigpOwogICAgICAgIF9xdWVyaWVzLmNsZWFyKCk7CiAgICAgICAgX3NlcXMu\nY2xlYXIoKTsKICAgICAgICBfcmVnaXN0ZXJlZC5jbGVhcigpOwogICAgICAg\nIF9mYWN0b3J5LmNsZWFyKCk7CiAgICAgICAgX2FsaWFzZXMuY2xlYXIoKTsK\nICAgICAgICBfcGF3YXJlcy5jbGVhcigpOwogICAgICAgIF9ub25NYXBwZWQu\nY2xlYXIoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXQg\nb2YgY29uZmlndXJlZCBwZXJzaXN0ZW50IGNsYXNzZXMsIG9yIG51bGwgaWYg\ndGhlIHVzZXIKICAgICAqIGRpZCBub3QgY29uZmlndXJlIGFueS4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZGV2cGF0aCBpZiB0cnVlLCBzZWFyY2ggZm9yIG1l\ndGFkYXRhIGZpbGVzIGluIGRpcmVjdG9yaWVzCiAgICAgKiBpbiB0aGUgY2xh\nc3NwYXRoIGlmIG5vIGNsYXNzZXMgYXJlIGNvbmZpZ3VyZWQgZXhwbGljaXRs\neQogICAgICogQHBhcmFtIGVudkxvYWRlciB0aGUgY2xhc3MgbG9hZGVyIHRv\nIHVzZSwgb3IgbnVsbCBmb3IgZGVmYXVsdAogICAgICovCiAgICBwdWJsaWMg\nU2V0IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoYm9vbGVhbiBkZXZwYXRoLAog\nICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChf\nbG9ja2luZykgewogICAgICAgICAgICByZXR1cm4gZ2V0UGVyc2lzdGVudFR5\ncGVOYW1lc0xvY2tpbmcoZGV2cGF0aCwgZW52TG9hZGVyKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0UGVyc2lzdGVudFR5cGVO\nYW1lc0ludGVybmFsKGRldnBhdGgsIGVudkxvYWRlcik7CiAgICAgICAgfQog\nICAgfQogICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgU2V0IGdldFBlcnNpc3Rl\nbnRUeXBlTmFtZXNMb2NraW5nKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyKSB7CiAgICAgICAgcmV0dXJuIGdldFBlcnNpc3RlbnRU\neXBlTmFtZXNJbnRlcm5hbChkZXZwYXRoLCBlbnZMb2FkZXIpOwogICAgfQog\nICAgcHJpdmF0ZSBTZXQgZ2V0UGVyc2lzdGVudFR5cGVOYW1lc0ludGVybmFs\nKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAg\nICAgICAgcmV0dXJuIF9mYWN0b3J5LmdldFBlcnNpc3RlbnRUeXBlTmFtZXMo\nZGV2cGF0aCwgZW52TG9hZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIExv\nYWQgdGhlIHBlcnNpc3RlbnQgY2xhc3NlcyBuYW1lZCBpbiBjb25maWd1cmF0\naW9uLgogICAgICogVGhpcyBlbnN1cmVzIHRoYXQgYWxsIHN1YmNsYXNzZXMg\nYW5kIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzZXMgb2YKICAgICAqIGVh\nY2ggdHlwZSBhcmUga25vd24gaW4gYWR2YW5jZSwgd2l0aG91dCBoYXZpbmcg\ndG8gcmVseSBvbiB0aGUKICAgICAqIGFwcGxpY2F0aW9uIGxvYWRpbmcgdGhl\nIGNsYXNzZXMgYmVmb3JlIHBlcmZvcm1pbmcgb3BlcmF0aW9ucyB0aGF0CiAg\nICAgKiBtaWdodCBpbnZvbHZlIHRoZW0uCiAgICAgKgogICAgICogQHBhcmFt\nIGRldnBhdGggaWYgdHJ1ZSwgc2VhcmNoIGZvciBtZXRhZGF0YSBmaWxlcyBp\nbiBkaXJlY3RvcmllcwogICAgICogaW4gdGhlIGNsYXNzcGF0aCBpZiB0aGUg\nbm8gY2xhc3NlcyBhcmUgY29uZmlndXJlZCBleHBsaWNpdGx5CiAgICAgKiBA\ncGFyYW0gZW52TG9hZGVyIHRoZSBjbGFzcyBsb2FkZXIgdG8gdXNlLCBvciBu\ndWxsIGZvciBkZWZhdWx0CiAgICAgKiBAcmV0dXJuIHRoZSBsb2FkZWQgY2xh\nc3Nlcywgb3IgZW1wdHkgY29sbGVjdGlvbiBpZiBub25lCiAgICAgKi8KICAg\nIHB1YmxpYyBDb2xsZWN0aW9uIGxvYWRQZXJzaXN0ZW50VHlwZXMoYm9vbGVh\nbiBkZXZwYXRoLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewog\nICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICByZXR1cm4gbG9h\nZFBlcnNpc3RlbnRUeXBlc0xvY2tpbmcoZGV2cGF0aCwgZW52TG9hZGVyKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbG9hZFBlcnNp\nc3RlbnRUeXBlc0ludGVybmFsKGRldnBhdGgsIGVudkxvYWRlcik7CiAgICAg\nICAgfQogICAgfQoKICAgIHByaXZhdGUgc3luY2hyb25pemVkIENvbGxlY3Rp\nb24gbG9hZFBlcnNpc3RlbnRUeXBlc0xvY2tpbmcoYm9vbGVhbiBkZXZwYXRo\nLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICByZXR1cm4gbG9h\nZFBlcnNpc3RlbnRUeXBlc0ludGVybmFsKGRldnBhdGgsIGVudkxvYWRlcik7\nCiAgICB9CgogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIGxvYWRQZXJzaXN0ZW50\nVHlwZXNJbnRlcm5hbChib29sZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVu\ndkxvYWRlcikgewogICAgICAgIFNldCBuYW1lcyA9IGdldFBlcnNpc3RlbnRU\neXBlTmFtZXMoZGV2cGF0aCwgZW52TG9hZGVyKTsKICAgICAgICBpZiAobmFt\nZXMgPT0gbnVsbCB8fCBuYW1lcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICAvLyBhdHRl\nbXB0IHRvIGxvYWQgY2xhc3NlcyBzbyB0aGF0IHRoZXkgZ2V0IHByb2Nlc3Nl\nZAogICAgICAgIENsYXNzTG9hZGVyIGNsc0xvYWRlciA9IF9jb25mLmdldENs\nYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLmdldENsYXNzTG9hZGVyKGdldENsYXNz\nKCksIGVudkxvYWRlcik7CiAgICAgICAgTGlzdCBjbGFzc2VzID0gbmV3IEFy\ncmF5TGlzdChuYW1lcy5zaXplKCkpOwogICAgICAgIENsYXNzIGNsczsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG5hbWVzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGNscyA9IGNsYXNzRm9yTmFt\nZSgoU3RyaW5nKSBpdHIubmV4dCgpLCBjbHNMb2FkZXIpOwogICAgICAgICAg\nICBpZiAoY2xzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGNsYXNzZXMu\nYWRkKGNscyk7CgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIGNsYXNzIGlz\nIGFuIGludGVyZmFjZSwgbG9hZCBpdHMgbWV0YWRhdGEgdG8ga2ljawogICAg\nICAgICAgICAgICAgLy8gb2ZmIHRoZSBpbXBsIGdlbmVyYXRvcgogICAgICAg\nICAgICAgICAgaWYgKGNscy5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICAg\nICAgICAgIGdldE1ldGFEYXRhKGNscywgY2xzTG9hZGVyLCBmYWxzZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNsYXNzZXM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsYXNzIGZvciB0\naGUgZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZiBub3QgbG9hZGFibGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgQ2xhc3MgY2xhc3NGb3JOYW1lKFN0cmluZyBuYW1l\nLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gQ2xhc3MuZm9yTmFtZShuYW1lLCB0cnVlLCBsb2FkZXIp\nOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIGlmICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0gMCkgewog\nICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLWRpc2Nv\ndmVyLWNsYXNzIiwgbmFtZSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9s\nb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy5pbmZv\nKF9sb2MuZ2V0KCJiYWQtZGlzY292ZXItY2xhc3MiLCBuYW1lKSk7CiAgICAg\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKGUpOwogICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEVycm9yIG5zbWUpIHsKICAgICAgICAgICAgaWYgKG5zbWUuZ2V0TWVz\nc2FnZSgpLmluZGV4T2YoIi5wYyIpID09IC0xKQogICAgICAgICAgICAgICAg\ndGhyb3cgbnNtZTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBlcnJvciBpcyBh\nYm91dCBhIG1ldGhvZCB0aGF0IHVzZXMgdGhlIFBlcnNpc3RlbmNlQ2FwYWJs\nZQogICAgICAgICAgICAvLyAncGMnIG1ldGhvZCBwcmVmaXgsIHBlcmZvcm0g\nc29tZSBsb2dnaW5nIGFuZCBjb250aW51ZS4gVGhpcwogICAgICAgICAgICAv\nLyBwcm9iYWJseSBqdXN0IG1lYW5zIHRoYXQgdGhlIGNsYXNzIGlzIG5vdCB5\nZXQgZW5oYW5jZWQuCiAgICAgICAgICAgIGlmICgoX3ZhbGlkYXRlICYgVkFM\nSURBVEVfUlVOVElNRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9s\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cu\nd2FybihfbG9jLmdldCgiYmFkLWRpc2NvdmVyLWNsYXNzIiwgbmFtZSkpOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKF9sb2cuaXNJbmZvRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJiYWQtZGlzY292\nZXItY2xhc3MiLCBuYW1lKSk7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKG5zbWUp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhbGwga25vd24gc3ViY2xhc3NlcyBmb3IgdGhl\nIGdpdmVuIGNsYXNzIG1hcHBpbmcuIE5vdGUKICAgICAqIHRoYXQgdGhpcyBt\nZXRob2Qgb25seSB3b3JrcyBkdXJpbmcgcnVudGltZSB3aGVuIHRoZSByZXBv\nc2l0b3J5IGlzCiAgICAgKiByZWdpc3RlcmVkIGFzIGEge0BsaW5rIFJlZ2lz\ndGVyQ2xhc3NMaXN0ZW5lcn0uCiAgICAgKi8KICAgIENvbGxlY3Rpb24gZ2V0\nUENTdWJjbGFzc2VzKENsYXNzIGNscykgewogICAgICAgIENvbGxlY3Rpb24g\nc3VicyA9IChDb2xsZWN0aW9uKSBfc3Vicy5nZXQoY2xzKTsKICAgICAgICBp\nZiAoc3VicyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlv\nbnMuRU1QVFlfTElTVDsKICAgICAgICByZXR1cm4gc3ViczsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBSZWdpc3RlckNsYXNzTGlzdGVuZXIgaW1wbGVtZW50YXRpb24KICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICBwdWJsaWMgdm9pZCByZWdpc3RlcihDbGFzcyBjbHMpIHsKICAgICAgICAv\nLyBidWZmZXIgcmVnaXN0ZXJlZCBjbGFzc2VzIHVudGlsIGFuIG9pZCBtZXRh\nZGF0YSByZXF1ZXN0IGlzIG1hZGUsCiAgICAgICAgLy8gYXQgd2hpY2ggcG9p\nbnQgd2UnbGwgcGFyc2UgZXZlcnl0aGluZyBpbiB0aGUgYnVmZmVyCiAgICAg\nICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgc3luY2hyb25pemVkIChfcmVn\naXN0ZXJlZCkgewogICAgICAgICAgICAgICAgX3JlZ2lzdGVyZWQuYWRkKGNs\ncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBfcmVnaXN0ZXJlZC5hZGQoY2xzKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZXMgdGhlIG1ldGFkYXRhIGZvciBhbGwgcmVnaXN0\nZXJlZCBjbGFzc2VzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbG9hZFJl\nZ2lzdGVyZWRDbGFzc01ldGFEYXRhKENsYXNzTG9hZGVyIGVudkxvYWRlcikg\newogICAgICAgIENsYXNzW10gcmVnID0gcHJvY2Vzc1JlZ2lzdGVyZWRDbGFz\nc2VzKGVudkxvYWRlcik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBy\nZWcubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGdldE1ldGFEYXRhKHJlZ1tpXSwgZW52TG9hZGVyLCBmYWxzZSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKE1ldGFEYXRhRXhjZXB0aW9uIG1lKSB7\nCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKG1lKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgb3Vy\nIGRhdGFzdHJ1Y3R1cmVzIHdpdGggdGhlIGxhdGVzdCByZWdpc3RlcmVkIGNs\nYXNzZXMuCiAgICAgKi8KICAgIENsYXNzW10gcHJvY2Vzc1JlZ2lzdGVyZWRD\nbGFzc2VzKENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChf\ncmVnaXN0ZXJlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBFTVBU\nWV9DTEFTU0VTOwoKICAgICAgICAvLyBjb3B5IGludG8gbmV3IGNvbGxlY3Rp\nb24gdG8gYXZvaWQgY29uY3VycmVudCBtb2QgZXJyb3JzIG9uIHJlZW50cmFu\ndAogICAgICAgIC8vIHJlZ2lzdHJhdGlvbnMKICAgICAgICBDbGFzc1tdIHJl\nZzsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChfcmVnaXN0ZXJlZCkgewogICAgICAgICAgICAgICAgcmVnID0g\nKENsYXNzW10pIF9yZWdpc3RlcmVkLnRvQXJyYXkobmV3IENsYXNzW19yZWdp\nc3RlcmVkLnNpemUoKV0pOwogICAgICAgICAgICAgICAgX3JlZ2lzdGVyZWQu\nY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHJlZyA9IChDbGFzc1tdKSBfcmVnaXN0ZXJlZC50b0FycmF5KG5l\ndyBDbGFzc1tfcmVnaXN0ZXJlZC5zaXplKCldKTsKICAgICAgICAgICAgX3Jl\nZ2lzdGVyZWQuY2xlYXIoKTsKICAgICAgICB9CgogICAgICAgIENvbGxlY3Rp\nb24gcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVu\ndkxvYWRlcik7CiAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQgPSBudWxsOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVnLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIC8vIGRvbid0IHByb2Nlc3MgdHlwZXMgdGhhdCBhcmVu\nJ3QgbGlzdGVkIGJ5IHRoZSB1c2VyOyBtYXkgYmVsb25nCiAgICAgICAgICAg\nIC8vIHRvIGEgZGlmZmVyZW50IHBlcnNpc3RlbmNlIHVuaXQKICAgICAgICAg\nICAgaWYgKHBjTmFtZXMgIT0gbnVsbCAmJiAhcGNOYW1lcy5pc0VtcHR5KCkK\nICAgICAgICAgICAgICAgICYmICFwY05hbWVzLmNvbnRhaW5zKHJlZ1tpXS5n\nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcHJvY2Vzc1JlZ2lzdGVyZWRD\nbGFzcyhyZWdbaV0pOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUg\ndCkgewogICAgICAgICAgICAgICAgaWYgKCFfY29uZi5nZXRSZXRyeUNsYXNz\nUmVnaXN0cmF0aW9uKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlcnJvci1yZWdpc3RlcmVk\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVnW2ldKSwgdCk7CgogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZmFpbGVkLXJlZ2lz\ndGVyZWQiLCByZWdbaV0pLCB0KTsKICAgICAgICAgICAgICAgIGlmIChmYWls\nZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmYWlsZWQgPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICBmYWlsZWQuYWRkKHJlZ1tp\nXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZhaWxl\nZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmKF9sb2NraW5nKXsKICAgICAg\nICAgICAgICAgIHN5bmNocm9uaXplZCAoX3JlZ2lzdGVyZWQpIHsKICAgICAg\nICAgICAgICAgICAgICBfcmVnaXN0ZXJlZC5hZGRBbGwoZmFpbGVkKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAg\nICAgICBfcmVnaXN0ZXJlZC5hZGRBbGwoZmFpbGVkKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVnOwogICAgfQoKICAgIC8q\nKgogICAgICogVXBkYXRlcyBvdXIgZGF0YXN0cnVjdHVyZXMgd2l0aCB0aGUg\nZ2l2ZW4gcmVnaXN0ZXJlZCBjbGFzcy4KICAgICAqIFJlbGllcyBvbiB0aGUg\nZmFjdCB0aGF0IGEgY2hpbGQgY2xhc3MgY2Fubm90IHJlZ2lzdGVyIGl0c2Vs\nZiB3aXRob3V0CiAgICAgKiBhbHNvIHJlZ2lzdGVyaW5nIGl0cyBwYXJlbnQg\nY2xhc3MgYnkgc3BlY2lmeWluZyBpdHMgcGVyc2lzdGVuY2UKICAgICAqIGNh\ncGFibGUgc3VwZXJjbGFzcyBpbiB0aGUgcmVnaXN0cmF0aW9uIGV2ZW50Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJvY2Vzc1JlZ2lzdGVyZWRDbGFz\ncyhDbGFzcyBjbHMpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwcm9jZXNz\nLXJlZ2lzdGVyZWQiLCBjbHMpKTsKCiAgICAgICAgLy8gdXBkYXRlIHN1YmNs\nYXNzIGxpc3RzOyBzeW5jaHJvbml6ZSBvbiB0aGlzIGJlY2F1c2UgYWNjZXNz\naW5nIF9tZXRhcwogICAgICAgIC8vIHJlcXVpcmVzIGl0CiAgICAgICAgQ2xh\nc3MgbGVhc3REZXJpdmVkID0gY2xzOwogICAgICAgIGlmIChfbG9ja2luZykg\newogICAgICAgIAlsZWFzdERlcml2ZWQgPSBjYWxjdWFsdGVMZWFzdERlcml2\nZWRMb2NraW5nKGNscyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nbGVhc3REZXJpdmVkID0gY2FsY3VhbHRlTGVhc3REZXJpdmVkSW50ZXJuYWwo\nY2xzKTsKICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSBvaWQgbWFwcGlu\nZ3MgaWYgdGhpcyBpcyBhIGJhc2UgY29uY3JldGUgY2xhc3MKICAgICAgICBP\nYmplY3Qgb2lkID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBv\naWQgPSBQQ1JlZ2lzdHJ5Lm5ld09iamVjdElkKGNscyk7CiAgICAgICAgfSBj\nYXRjaCAoSW50ZXJuYWxFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgLy8g\ndGhyb3duIGZvciBzaW5nbGUgZmllbGQgaWRlbnRpdHkgd2l0aCBudWxsIHBr\nIGZpZWxkIHZhbHVlCiAgICAgICAgfQogICAgICAgIGlmIChvaWQgIT0gbnVs\nbCkgewogICAgICAgICAgICBDbGFzcyBleGlzdGluZyA9IChDbGFzcykgX29p\nZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAgICAgICAgaWYgKGV4aXN0\naW5nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlz\nIGFscmVhZHkgYSBjbGFzcyBmb3IgdGhpcyBPSUQsIHRoZW4gd2Uga25vdwog\nICAgICAgICAgICAgICAgLy8gdGhhdCBtdWx0aXBsZSBjbGFzc2VzIGFyZSB1\nc2luZyB0aGUgc2FtZSBPSUQ6IHRoZXJlZm9yZSwKICAgICAgICAgICAgICAg\nIC8vIHB1dCB0aGUgbGVhc3QgZGVyaXZlZCBQQyBzdXBlcmNsYXNzIGludG8g\ndGhlIG1hcC4gVGhpcwogICAgICAgICAgICAgICAgLy8gZ2V0cyBhcm91bmQg\ndGhlIHByb2JsZW0gb2YgYW4gYWJzdHJhY3QgUEMgc3VwZXJjbGFzcwogICAg\nICAgICAgICAgICAgLy8gdXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHkgKHNp\nbmNlIG5ld09iamVjdElkCiAgICAgICAgICAgICAgICAvLyB3aWxsIHJldHVy\nbiBudWxsIGZvciBhYnN0cmFjdCBjbGFzc2VzKS4KICAgICAgICAgICAgICAg\nIENsYXNzIHN1cCA9IGNsczsKICAgICAgICAgICAgICAgIHdoaWxlIChQQ1Jl\nZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKHN1cCkgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBzdXAgPSBQQ1JlZ2lzdHJ5LmdldFBlcnNp\nc3RlbnRTdXBlcmNsYXNzKHN1cCk7CgogICAgICAgICAgICAgICAgX29pZHMu\ncHV0KG9pZC5nZXRDbGFzcygpLCBzdXApOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKGV4aXN0aW5nID09IG51bGwgfHwgY2xzLmlzQXNzaWduYWJsZUZyb20o\nZXhpc3RpbmcpKQogICAgICAgICAgICAgICAgX29pZHMucHV0KG9pZC5nZXRD\nbGFzcygpLCBjbHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gdXBkYXRlIG1h\ncHBpbmdzIGZyb20gaW50ZXJmYWNlcyBhbmQgbm9uLXBjIHN1cGVyY2xhc3Nl\ncyB0bwogICAgICAgIC8vIHBjIGltcGxlbWVudGluZyB0eXBlcwogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKF9p\nbXBscykgewogICAgICAgICAgICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFz\ndERlcml2ZWQsIGNscyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICB1cGRhdGVJbXBscyhjbHMsIGxlYXN0RGVyaXZlZCwg\nY2xzKTsKICAgICAgICB9CgogICAgICAgIC8vIHNldCBhbGlhcyBmb3IgY2xh\nc3MKICAgICAgICBTdHJpbmcgYWxpYXMgPSBQQ1JlZ2lzdHJ5LmdldFR5cGVB\nbGlhcyhjbHMpOwogICAgICAgIGlmIChhbGlhcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGlmKF9sb2NraW5nKXsKICAgICAgICAgICAgICAgIHNldEFsaWFz\nRm9yQ2xhc3NMb2NraW5nKGFsaWFzLCBjbHMpOwogICAgICAgICAgICB9ZWxz\nZXsKICAgICAgICAgICAgICAgIHNldEFsaWFzRm9yQ2xhc3NJbnRlcm5hbChh\nbGlhcywgY2xzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAg\nIC8qKgogICAgICogUHJpdmF0ZSB3b3JrZXIgbWV0aG9kIGZvciB1c2UgYnkg\ncHJvY2Vzc1JlZ2lzdGVyQ2xhc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHNldEFsaWFzRm9yQ2xhc3NMb2NraW5nKFN0cmluZyBhbGlhcywgQ2xh\nc3MgY2xzKXsKICAgICAgICBzeW5jaHJvbml6ZWQoX2FsaWFzZXMpewogICAg\nICAgICAgICBzZXRBbGlhc0ZvckNsYXNzSW50ZXJuYWwoYWxpYXMsIGNscyk7\nCiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBQcml2YXRlIHdvcmtl\nciBtZXRob2QgZm9yIHVzZSBieSBwcm9jZXNzUmVnaXN0ZXJDbGFzc2VzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0QWxpYXNGb3JDbGFzc0ludGVy\nbmFsKFN0cmluZyBhbGlhcywgQ2xhc3MgY2xzKXsKICAgICAgICBMaXN0IGNs\nYXNzTGlzdCA9IChMaXN0KSBfYWxpYXNlcy5nZXQoYWxpYXMpOwogICAgICAg\nIGlmIChjbGFzc0xpc3QgPT0gbnVsbCkgewogICAgICAgICAgICBjbGFzc0xp\nc3QgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAgICBfYWxpYXNlcy5w\ndXQoYWxpYXMsIGNsYXNzTGlzdCk7CiAgICAgICAgfQogICAgICAgIGlmICgh\nY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpCiAgICAgICAgICAgIGNsYXNzTGlz\ndC5hZGQoY2xzKTsKICAgIH0KICAgIC8qKgogICAgICogUHJpdmF0ZSB3b3Jr\nZXIgbWV0aG9kIGZvciB1c2UgYnkgcHJvY2Vzc1JlZ2lzdGVyQ2xhc3Nlcy4K\nICAgICAqLwogICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgQ2xhc3MgY2FsY3Vh\nbHRlTGVhc3REZXJpdmVkTG9ja2luZyhDbGFzcyBjbHMpewogICAgICAgIHJl\ndHVybiBjYWxjdWFsdGVMZWFzdERlcml2ZWRJbnRlcm5hbChjbHMpOwogICAg\nfQogICAgLyoqCiAgICAgKiBQcml2YXRlIHdvcmtlciBtZXRob2QgZm9yIHVz\nZSBieSBwcm9jZXNzUmVnaXN0ZXJDbGFzc2VzLgogICAgICovCiAgICBwcml2\nYXRlIENsYXNzIGNhbGN1YWx0ZUxlYXN0RGVyaXZlZEludGVybmFsKENsYXNz\nIGNscyl7CiAgICAgICAgQ2xhc3MgbGVhc3REZXJpdmVkID0gY2xzOwogICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICBmb3IgKENsYXNzIGFu\nYyA9IGNsczsgKGFuYyA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVy\nY2xhc3MoYW5jKSkgIT0gbnVsbDspIHsKICAgICAgICAgICAgYWRkVG9Db2xs\nZWN0aW9uKF9zdWJzLCBhbmMsIGNscywgdHJ1ZSk7CiAgICAgICAgICAgIG1l\ndGEgPSAoQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdldChhbmMpOwogICAgICAg\nICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICAgICAgbWV0YS5j\nbGVhclN1YmNsYXNzQ2FjaGUoKTsKICAgICAgICAgICAgbGVhc3REZXJpdmVk\nID0gYW5jOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gbGVh\nc3REZXJpdmVkOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFVwZGF0ZSB0\naGUgbGlzdCBvZiBpbXBsZW1lbnRhdGlvbnMgb2YgYmFzZSBjbGFzc2VzIGFu\nZCBpbnRlcmZhY2VzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdXBkYXRl\nSW1wbHMoQ2xhc3MgY2xzLCBDbGFzcyBsZWFzdERlcml2ZWQsIENsYXNzIGNo\nZWNrKSB7CiAgICAgICAgLy8gYWxsb3cgdXNlcnMgdG8gcXVlcnkgb24gY29t\nbW9uIG5vbi1wYyBzdXBlcmNsYXNzZXMKICAgICAgICBDbGFzcyBzdXAgPSBj\naGVjay5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKGxlYXN0RGVyaXZl\nZCA9PSBjbHMgJiYgc3VwICE9IG51bGwgJiYgc3VwICE9IE9iamVjdC5jbGFz\ncykgewogICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX2ltcGxzLCBzdXAs\nIGNscywgZmFsc2UpOwogICAgICAgICAgICB1cGRhdGVJbXBscyhjbHMsIGxl\nYXN0RGVyaXZlZCwgc3VwKTsKICAgICAgICB9CgogICAgICAgIC8vIGFsbG93\nIHVzZXJzIHRvIHF1ZXJ5IG9uIGFueSBpbXBsZW1lbnRlZCBpbnRlcmZhY2Vz\nIHVubGVzcyBkZWZhdWx0cyAKICAgICAgICAvLyBzYXkgdGhlIHVzZXIgbXVz\ndCBpbXBsZW1lbnQgcGVyc2lzdGVudCBpbnRlcmZhY2VzIGV4cGxpY2l0bHkg\naW4gbWV0YQogICAgICAgIGlmICghX2ZhY3RvcnkuZ2V0RGVmYXVsdHMoKS5p\nc0RlY2xhcmVkSW50ZXJmYWNlUGVyc2lzdGVudCgpKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgQ2xhc3NbXSBpbnRzID0gY2hlY2suZ2V0SW50ZXJm\nYWNlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW50cy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAvLyBkb24ndCBtYXAgamF2YS1zdGFu\nZGFyZCBpbnRlcmZhY2VzCiAgICAgICAgICAgIGlmIChpbnRzW2ldLmdldE5h\nbWUoKS5zdGFydHNXaXRoKCJqYXZhLiIpKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAvLyBvbmx5IG1hcCBsZWFzdC1kZXJpdmVk\nIGludGVyZmFjZSBpbXBsZW1lbnRvcnMKICAgICAgICAgICAgaWYgKGxlYXN0\nRGVyaXZlZCA9PSBjbHMgfHwgaXNMZWFzdERlcml2ZWRJbXBsKGludHNbaV0s\nIGNscykpIHsKICAgICAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfaW1w\nbHMsIGludHNbaV0sIGNscywgZmFsc2UpOwogICAgICAgICAgICAgICAgdXBk\nYXRlSW1wbHMoY2xzLCBsZWFzdERlcml2ZWQsIGludHNbaV0pOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRydWUgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIHRoZSBsZWFzdC1kZXJpdmVk\nIHBlcnNpc3RlbnQKICAgICAqIGltcGxlbWVudG9yIG9mIHRoZSBnaXZlbiBp\nbnRlcmZhY2UsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGlzTGVhc3REZXJpdmVkSW1wbChDbGFzcyBpbnRlciwgQ2xh\nc3MgY2xzKSB7CiAgICAgICAgQ2xhc3MgcGFyZW50ID0gUENSZWdpc3RyeS5n\nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhjbHMpOwogICAgICAgIHdoaWxlIChw\nYXJlbnQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoQXJyYXlzLmFzTGlz\ndChwYXJlbnQuZ2V0SW50ZXJmYWNlcygpKS5jb250YWlucyhpbnRlcikpCiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHBhcmVu\ndCA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3MocGFyZW50\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBjb2xsZWN0\naW9uIGNhY2hlZCBpbiB0aGUgZ2l2ZW4gbWFwIHVuZGVyCiAgICAgKiB0aGUg\nZ2l2ZW4ga2V5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkVG9Db2xs\nZWN0aW9uKE1hcCBtYXAsIENsYXNzIGtleSwgQ2xhc3MgdmFsdWUsCiAgICAg\nICAgYm9vbGVhbiBpbmhlcml0YW5jZSkgewogICAgICAgIGlmKF9sb2NraW5n\nKXsKICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uTG9ja2luZyhtYXAsIGtl\neSwgdmFsdWUsIGluaGVyaXRhbmNlKTsKICAgICAgICB9ZWxzZXsKICAgICAg\nICAgICAgYWRkVG9Db2xsZWN0aW9uSW50ZXJuYWwobWFwLCBrZXksIHZhbHVl\nLCBpbmhlcml0YW5jZSk7CiAgICAgICAgfQogICAgfQogICAgcHJpdmF0ZSB2\nb2lkIGFkZFRvQ29sbGVjdGlvbkxvY2tpbmcoTWFwIG1hcCwgQ2xhc3Mga2V5\nLCBDbGFzcyB2YWx1ZSwgYm9vbGVhbiBpbmhlcml0YW5jZSkgewogICAgICAg\nIHN5bmNocm9uaXplZCAobWFwKSB7CiAgICAgICAgICAgIGFkZFRvQ29sbGVj\ndGlvbkludGVybmFsKG1hcCwga2V5LCB2YWx1ZSwgaW5oZXJpdGFuY2UpOwog\nICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgdm9pZCBhZGRUb0NvbGxlY3Rp\nb25JbnRlcm5hbChNYXAgbWFwLCBDbGFzcyBrZXksIENsYXNzIHZhbHVlLCBi\nb29sZWFuIGluaGVyaXRhbmNlKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24g\nY29sbCA9IChDb2xsZWN0aW9uKSBtYXAuZ2V0KGtleSk7CiAgICAgICAgICAg\nIGlmIChjb2xsID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChpbmhl\ncml0YW5jZSkgewogICAgICAgICAgICAgICAgICAgIEluaGVyaXRhbmNlQ29t\ncGFyYXRvciBjb21wID0gbmV3IEluaGVyaXRhbmNlQ29tcGFyYXRvcigpOwog\nICAgICAgICAgICAgICAgICAgIGNvbXAuc2V0QmFzZShrZXkpOwogICAgICAg\nICAgICAgICAgICAgIGNvbGwgPSBuZXcgVHJlZVNldChjb21wKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIGNvbGwgPSBu\nZXcgTGlua2VkTGlzdCgpOwogICAgICAgICAgICAgICAgbWFwLnB1dChrZXks\nIGNvbGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbGwuYWRkKHZh\nbHVlKTsKICAgICAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gQ29uZmlndXJhYmxlIGltcGxlbWVudGF0aW9uCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYpIHsK\nICAgICAgICBfY29uZiA9IChPcGVuSlBBQ29uZmlndXJhdGlvbikgY29uZjsK\nICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0\naW9uLkxPR19NRVRBREFUQSk7CiAgICAgICAgX3Jlb3JkZXJNZXRhRGF0YVJl\nc29sdXRpb24gPSBfY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5n\nZXRSZW9yZGVyTWV0YURhdGFSZXNvbHV0aW9uKCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RhcnRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgaW5pdGlh\nbGl6ZU1ldGFEYXRhRmFjdG9yeSgpOwogICAgICAgIGlmIChfaW1wbEdlbiA9\nPSBudWxsKQogICAgICAgICAgICBfaW1wbEdlbiA9IG5ldyBJbnRlcmZhY2VJ\nbXBsR2VuZXJhdG9yKHRoaXMpOwogICAgICAgIGlmIChfcHJlbG9hZCA9PSB0\ncnVlKSB7CiAgICAgICAgICAgIF9vaWRzID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICAgICAgX2ltcGxzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAg\nX2lmYWNlcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIF9hbGlhc2Vz\nID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgX3Bhd2FyZXMgPSBuZXcg\nSGFzaE1hcCgpOwogICAgICAgICAgICBfbm9uTWFwcGVkID0gbmV3IEhhc2hN\nYXAoKTsKICAgICAgICAgICAgX3N1YnMgPSBuZXcgSGFzaE1hcCgpOwogICAg\nICAgICAgICAvLyBXYWl0IHRpbGwgd2UncmUgZG9uZSBsb2FkaW5nIE1ldGFE\nYXRhIHRvIHJlbW92ZSBsb2NrLgogICAgICAgIH0gICAgICAgICAgICAKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgaW5pdGlhbGl6ZU1ldGFEYXRhRmFjdG9y\neSgpIHsKICAgICAgICBpZiAoX2ZhY3RvcnkgPT0gbnVsbCkgewogICAgICAg\nICAgICBNZXRhRGF0YUZhY3RvcnkgbWRmID0gX2NvbmYubmV3TWV0YURhdGFG\nYWN0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKG1kZiA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1tZXRhZGF0YWZhY3RvcnkiKSk7CiAgICAgICAgICAg\nIHNldE1ldGFEYXRhRmFjdG9yeShtZGYpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFF1ZXJ5IG1ldGFkYXRhCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVybiBx\ndWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzLCBuYW1lLCBhbmQg\nY2xhc3Nsb2FkZXIuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeU1ldGFEYXRh\nIGdldFF1ZXJ5TWV0YURhdGEoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSwKICAg\nICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0\nKSB7CiAgICAgICAgaWYoX2xvY2tpbmcpewogICAgICAgICAgICByZXR1cm4g\nZ2V0UXVlcnlNZXRhRGF0YUxvY2tpbmcoY2xzLCBuYW1lLCBlbnZMb2FkZXIs\nIG11c3RFeGlzdCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVy\nbiBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2Fk\nZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQogICAgfQogICAgcHJpdmF0ZSBz\neW5jaHJvbml6ZWQgUXVlcnlNZXRhRGF0YSBnZXRRdWVyeU1ldGFEYXRhTG9j\na2luZyhDbGFzcyBjbHMsIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBlbnZM\nb2FkZXIsCiAgICAgICAgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBy\nZXR1cm4gZ2V0UXVlcnlNZXRhRGF0YUludGVybmFsKGNscywgbmFtZSwgZW52\nTG9hZGVyLCBtdXN0RXhpc3QpOwogICAgfQoKICAgIHByaXZhdGUgUXVlcnlN\nZXRhRGF0YSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoQ2xhc3MgY2xzLCBT\ndHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11\nc3RFeGlzdCkgewogICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IGdldFF1\nZXJ5TWV0YURhdGFJbnRlcm5hbChjbHMsIG5hbWUsIGVudkxvYWRlcik7CiAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBsb2Fk\nIGFsbCB0aGUgbWV0YWRhdGFzIGZvciBhbGwgdGhlIGtub3duIGNsYXNzZXMg\nc28gdGhhdAogICAgICAgICAgICAvLyBxdWVyeSBuYW1lcyBhcmUgc2VlbiBh\nbmQgcmVnaXN0ZXJlZAogICAgICAgICAgICByZXNvbHZlQWxsKGVudkxvYWRl\ncik7CiAgICAgICAgICAgIG1ldGEgPSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJu\nYWwoY2xzLCBuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhpc3QpIHsKICAgICAgICAgICAg\naWYgKGNscyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hbWVkLXF1ZXJ5LW51\nbGwtY2xhc3MiLCBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAg\nICAgICAgICAgICAgICAgIGVudkxvYWRlciksIG5hbWUpKTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmFtZWQtcXVlcnkiLCBjbHMsIG5h\nbWUpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIG1ldGE7CiAgICB9CgogICAgLyoqIAogICAgICogUmVzb2x2ZSBhbGwga25v\nd24gbWV0YWRhdGEgY2xhc3Nlcy4gCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCByZXNvbHZlQWxsKENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAg\nIENvbGxlY3Rpb24gdHlwZXMgPSBsb2FkUGVyc2lzdGVudFR5cGVzKGZhbHNl\nLCBlbnZMb2FkZXIpOwogICAgICAgIGZvciAoSXRlcmF0b3IgaSA9IHR5cGVz\nLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOyApIHsKICAgICAgICAgICAgQ2xh\nc3MgYyA9IChDbGFzcykgaS5uZXh0KCk7CiAgICAgICAgICAgIGdldE1ldGFE\nYXRhKGMsIGVudkxvYWRlciwgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBxdWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdp\ndmVuIGNsYXNzLCBuYW1lLCBhbmQgY2xhc3Nsb2FkZXIuCiAgICAgKi8KICAg\nIHByaXZhdGUgUXVlcnlNZXRhRGF0YSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJu\nYWwoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSwKICAgICAgICBDbGFzc0xvYWRl\nciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUK\nICAgICAgICBPYmplY3Qga2V5ID0gZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKTsK\nICAgICAgICBRdWVyeU1ldGFEYXRhIHFtID0gKFF1ZXJ5TWV0YURhdGEpIF9x\ndWVyaWVzLmdldChrZXkpOwogICAgICAgIGlmIChxbSAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gcW07CgogICAgICAgIC8vIGdldCBtZXRhZGF0YSBm\nb3IgY2xhc3MsIHdoaWNoIHdpbGwgZmluZCBxdWVyaWVzIGluIG1ldGFkYXRh\nIGZpbGUKICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgZ2V0TWV0YURhdGEo\nY2xzLCBlbnZMb2FkZXIsIGZhbHNlKSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHFtID0gKFF1ZXJ5TWV0YURhdGEpIF9xdWVyaWVzLmdldChrZXkpOwogICAg\nICAgICAgICBpZiAocW0gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBxbTsKICAgICAgICB9CiAgICAgICAgaWYgKChfc291cmNlTW9kZSAmIE1P\nREVfUVVFUlkpID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICAvLyBzZWUgaWYgZmFjdG9yeSBjYW4gZmlndXJlIG91dCBhIHNjb3Bl\nIGZvciB0aGlzIHF1ZXJ5CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAg\nICAgICAgICBjbHMgPSBfZmFjdG9yeS5nZXRRdWVyeVNjb3BlKG5hbWUsIGVu\ndkxvYWRlcik7CgogICAgICAgIC8vIG5vdCBpbiBjYWNoZTsgbG9hZAogICAg\nICAgIF9mYWN0b3J5LmxvYWQoY2xzLCBNT0RFX1FVRVJZLCBlbnZMb2FkZXIp\nOwogICAgICAgIHJldHVybiAoUXVlcnlNZXRhRGF0YSkgX3F1ZXJpZXMuZ2V0\nKGtleSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hl\nZCBxdWVyeSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0\nYURhdGFbXSBnZXRRdWVyeU1ldGFEYXRhcygpIHsKICAgICAgICBpZiAoX2xv\nY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURhdGFbXSkgX3F1ZXJp\nZXMudmFsdWVzKCkudG9BcnJheShuZXcgUXVlcnlNZXRhRGF0YVtfcXVlcmll\ncy5zaXplKCldKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIHJldHVybiAoUXVlcnlNZXRhRGF0YVtdKSBfcXVlcmllcy52\nYWx1ZXMoKS50b0FycmF5KG5ldyBRdWVyeU1ldGFEYXRhW19xdWVyaWVzLnNp\nemUoKV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFt\nZS4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURhdGEgZ2V0Q2FjaGVk\nUXVlcnlNZXRhRGF0YShDbGFzcyBjbHMsCiAgICAgICAgU3RyaW5nIG5hbWUp\nIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hy\nb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKFF1ZXJ5\nTWV0YURhdGEpIF9xdWVyaWVzLmdldChnZXRRdWVyeUtleShjbHMsIG5hbWUp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIHJldHVybiAoUXVlcnlNZXRhRGF0YSkgX3F1ZXJpZXMuZ2V0KGdldFF1ZXJ5\nS2V5KGNscywgbmFtZSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBhIG5ldyBxdWVyeSBtZXRhZGF0YSB0byB0aGUgcmVwb3NpdG9y\neSBhbmQgcmV0dXJuIGl0LgogICAgICovCiAgICBwdWJsaWMgUXVlcnlNZXRh\nRGF0YSBhZGRRdWVyeU1ldGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5hbWUp\nIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hy\nb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBRdWVyeU1ldGFEYXRh\nIG1ldGEgPSBuZXdRdWVyeU1ldGFEYXRhKGNscywgbmFtZSk7CiAgICAgICAg\nICAgICAgICBfcXVlcmllcy5wdXQoZ2V0UXVlcnlLZXkobWV0YSksIG1ldGEp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICAgICAgICAgIH0K\nICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRh\nID0gbmV3UXVlcnlNZXRhRGF0YShjbHMsIG5hbWUpOwogICAgICAgICAgICBf\ncXVlcmllcy5wdXQoZ2V0UXVlcnlLZXkobWV0YSksIG1ldGEpOwogICAgICAg\nICAgICByZXR1cm4gbWV0YTsgICAKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkgbWV0YWRhdGEgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBRdWVyeU1ldGFEYXRhIG5ld1F1ZXJ5\nTWV0YURhdGEoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSkgewogICAgICAgIFF1\nZXJ5TWV0YURhdGEgbWV0YSA9IG5ldyBRdWVyeU1ldGFEYXRhKG5hbWUpOwog\nICAgICAgIG1ldGEuc2V0RGVmaW5pbmdUeXBlKGNscyk7CiAgICAgICAgcmV0\ndXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdp\ndmVuIHF1ZXJ5IG1ldGFkYXRhIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAg\nKi8KICAgIHB1YmxpYyAgYm9vbGVhbiByZW1vdmVRdWVyeU1ldGFEYXRhKFF1\nZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmKF9sb2NraW5nKXsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBfcXVlcmllcy5yZW1v\ndmUoZ2V0UXVlcnlLZXkobWV0YSkpICE9IG51bGw7CiAgICAgICAgICAgIH0K\nICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0\ndXJuIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtleShtZXRhKSkgIT0gbnVs\nbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgcXVl\ncnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGlmIGluIHRo\nZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1v\ndmVRdWVyeU1ldGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAg\nICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nICAgIHJldHVybiBfcXVlcmllcy5yZW1vdmUoZ2V0UXVlcnlLZXkoY2xzLCBu\nYW1lKSkgIT0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmllcy5y\nZW1vdmUoZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5\nIGZvciBhIGdpdmVuIFF1ZXJ5TWV0YURhdGEuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIE9iamVjdCBnZXRRdWVyeUtleShRdWVyeU1ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0UXVlcnlLZXkobWV0YS5n\nZXREZWZpbmluZ1R5cGUoKSwgbWV0YS5nZXROYW1lKCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgdW5pcXVlIGtleSBmb3IgYSBnaXZlbiBj\nbGFzcyAvIG5hbWUuIFRoZSBjbGFzcwogICAgICogYXJndW1lbnQgY2FuIGJl\nIG51bGwuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgT2JqZWN0IGdl\ndFF1ZXJ5S2V5KENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBp\nZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuYW1lOwogICAg\nICAgIFF1ZXJ5S2V5IGtleSA9IG5ldyBRdWVyeUtleSgpOwogICAgICAgIGtl\neS5jbHNOYW1lID0gY2xzLmdldE5hbWUoKTsKICAgICAgICBrZXkubmFtZSA9\nIG5hbWU7CiAgICAgICAgcmV0dXJuIGtleTsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KICAgIC8vIFNlcXVlbmNlIG1ldGFkYXRhCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVybiBz\nZXF1ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5hbWUgYW5kIGNsYXNz\nbG9hZGVyLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBn\nZXRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lLAogICAgICAgIENsYXNz\nTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAg\nICBpZihfbG9ja2luZyl7CiAgICAgICAgICAgIHJldHVybiBnZXRTZXF1ZW5j\nZU1ldGFEYXRhTG9ja2luZyhuYW1lLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7\nCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiBnZXRTZXF1ZW5j\nZU1ldGFEYXRhSW50ZXJuYWwobmFtZSwgZW52TG9hZGVyLCBtdXN0RXhpc3Qp\nOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgc3luY2hyb25pemVkIFNl\ncXVlbmNlTWV0YURhdGEgZ2V0U2VxdWVuY2VNZXRhRGF0YUxvY2tpbmcoU3Ry\naW5nIG5hbWUsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29s\nZWFuIG11c3RFeGlzdCkgewogICAgICAgIHJldHVybiBnZXRTZXF1ZW5jZU1l\ndGFEYXRhSW50ZXJuYWwobmFtZSwgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwog\nICAgfQogICAgcHJpdmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIGdldFNlcXVlbmNl\nTWV0YURhdGFJbnRlcm5hbChTdHJpbmcgbmFtZSwKICAgICAgICBDbGFzc0xv\nYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAg\nU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gZ2V0U2VxdWVuY2VNZXRhRGF0YUlu\ndGVybmFsKG5hbWUsIGVudkxvYWRlcik7CiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCAmJiBTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVNLmVxdWFscyhu\nYW1lKSkgewogICAgICAgICAgICBpZiAoX3N5c1NlcSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgX3N5c1NlcSA9IG5ld1NlcXVlbmNlTWV0YURhdGEobmFt\nZSk7CiAgICAgICAgICAgIHJldHVybiBfc3lzU2VxOwogICAgICAgIH0KICAg\nICAgICBpZiAobWV0YSA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1u\nYW1lZC1zZXF1ZW5jZSIsIG5hbWUpKTsKICAgICAgICByZXR1cm4gbWV0YTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFVzZWQgaW50ZXJuYWxseSBieSBtZXRh\nZGF0YSB0byByZXRyaWV2ZSBzZXF1ZW5jZSBtZXRhZGF0YXMgYmFzZWQgb24K\nICAgICAqIHBvc3NpYmx5LXVucXVhbGlmaWVkIHNlcXVlbmNlIG5hbWUuCiAg\nICAgKi8KICAgIFNlcXVlbmNlTWV0YURhdGEgZ2V0U2VxdWVuY2VNZXRhRGF0\nYShDbGFzc01ldGFEYXRhIGNvbnRleHQsIFN0cmluZyBuYW1lLAogICAgICAg\nIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgLy8gdHJ5IHdpdGggZ2l2\nZW4gbmFtZQogICAgICAgIE1ldGFEYXRhRXhjZXB0aW9uIGUgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNlcXVlbmNlTWV0YURhdGEgc2Vx\nID0gZ2V0U2VxdWVuY2VNZXRhRGF0YShuYW1lLAogICAgICAgICAgICAgICAg\nY29udGV4dC5nZXRFbnZDbGFzc0xvYWRlcigpLCBtdXN0RXhpc3QpOwogICAg\nICAgICAgICBpZiAoc2VxICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gc2VxOwogICAgICAgIH0gY2F0Y2ggKE1ldGFEYXRhRXhjZXB0aW9uIG1k\nZSkgewogICAgICAgICAgICBlID0gbWRlOwogICAgICAgIH0KCiAgICAgICAg\nLy8gaWYgZ2l2ZW4gbmFtZSBhbHJlYWR5IGZ1bGx5IHF1YWxpZmllZCwgZ2l2\nZSB1cAogICAgICAgIGlmIChuYW1lLmluZGV4T2YoJy4nKSAhPSAtMSkgewog\nICAgICAgICAgICBpZiAoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhy\nb3cgZTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAg\nICAgICAvLyB0cnkgd2l0aCBxdWFsaWZpZWQgbmFtZQogICAgICAgIG5hbWUg\nPSBTdHJpbmdzLmdldFBhY2thZ2VOYW1lKGNvbnRleHQuZ2V0RGVzY3JpYmVk\nVHlwZSgpKQogICAgICAgICAgICArICIuIiArIG5hbWU7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNlTWV0YURhdGEobmFt\nZSwgY29udGV4dC5nZXRFbnZDbGFzc0xvYWRlcigpLAogICAgICAgICAgICAg\nICAgbXVzdEV4aXN0KTsKICAgICAgICB9IGNhdGNoIChNZXRhRGF0YUV4Y2Vw\ndGlvbiBtZGUpIHsKICAgICAgICAgICAgLy8gdGhyb3cgb3JpZ2luYWwgZXhj\nZXB0aW9uCiAgICAgICAgICAgIGlmIChlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICB0aHJvdyBlOwogICAgICAgICAgICB0aHJvdyBtZGU7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHNlcXVlbmNlIG1ldGFk\nYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZSBhbmQgY2xhc3Nsb2FkZXIuCiAgICAg\nKi8KICAgIHByaXZhdGUgU2VxdWVuY2VNZXRhRGF0YSBnZXRTZXF1ZW5jZU1l\ndGFEYXRhSW50ZXJuYWwoU3RyaW5nIG5hbWUsCiAgICAgICAgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGNoZWNrIGNhY2hl\nCiAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gKFNlcXVlbmNlTWV0\nYURhdGEpIF9zZXFzLmdldChuYW1lKTsKICAgICAgICBpZiAobWV0YSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIC8vIGxvYWQgbWV0YWRhdGEgZm9yIHJlZ2lz\ndGVyZWQgY2xhc3NlcyB0byBob3BlZnVsbHkgZmluZCBzZXF1ZW5jZQogICAg\nICAgICAgICAvLyBkZWZpbml0aW9uCiAgICAgICAgICAgIGxvYWRSZWdpc3Rl\ncmVkQ2xhc3NNZXRhRGF0YShlbnZMb2FkZXIpOwogICAgICAgICAgICBtZXRh\nID0gKFNlcXVlbmNlTWV0YURhdGEpIF9zZXFzLmdldChuYW1lKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGNhY2hlZCBzZXF1ZW5jZSBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHVibGljIFNlcXVlbmNlTWV0YURhdGFbXSBnZXRTZXF1ZW5jZU1l\ndGFEYXRhcygpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gKFNlcXVlbmNlTWV0YURhdGFbXSkgX3NlcXMudmFsdWVzKCkudG9BcnJh\neShuZXcgU2VxdWVuY2VNZXRhRGF0YVtfc2Vxcy5zaXplKCldKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAo\nU2VxdWVuY2VNZXRhRGF0YVtdKSBfc2Vxcy52YWx1ZXMoKS50b0FycmF5KG5l\ndyBTZXF1ZW5jZU1ldGFEYXRhW19zZXFzLnNpemUoKV0pOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIGEgc2Vx\ndWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgICovCiAg\nICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBnZXRDYWNoZWRTZXF1ZW5jZU1l\ndGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAg\nICAgICAgcmV0dXJuIChTZXF1ZW5jZU1ldGFEYXRhKSBfc2Vxcy5nZXQobmFt\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICByZXR1cm4gKFNlcXVlbmNlTWV0YURhdGEpIF9zZXFzLmdldChuYW1lKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgc2Vx\ndWVuY2UgbWV0YWRhdGEgdG8gdGhlIHJlcG9zaXRvcnkgYW5kIHJldHVybiBp\ndC4KICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlTWV0YURhdGEgYWRkU2Vx\ndWVuY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfbG9j\na2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAg\nICAgICAgICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IG5ld1NlcXVl\nbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAgICAgICAgICBfc2Vxcy5wdXQo\nbmFtZSwgbWV0YSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWV0YTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFNlcXVl\nbmNlTWV0YURhdGEgbWV0YSA9IG5ld1NlcXVlbmNlTWV0YURhdGEobmFtZSk7\nCiAgICAgICAgICAgIF9zZXFzLnB1dChuYW1lLCBtZXRhKTsKICAgICAgICAg\nICAgcmV0dXJuIG1ldGE7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHNlcXVlbmNlIG1ldGFkYXRhIGluc3RhbmNlLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgU2VxdWVuY2VNZXRhRGF0YSBuZXdTZXF1\nZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBTZXF1ZW5jZU1ldGFEYXRhKG5hbWUsIHRoaXMpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzZXF1ZW5jZSBtZXRhZGF0YSBm\ncm9tIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiByZW1vdmVTZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5j\naHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmIChtZXRhID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICAgICAgcmV0dXJuIF9zZXFzLnJlbW92ZShtZXRhLmdldE5hbWUo\nKSkgIT0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBfc2Vxcy5yZW1vdmUo\nbWV0YS5nZXROYW1lKCkpICE9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmVtb3ZlIHNlcXVlbmNlIG1ldGFkYXRhIGZvciB0aGUg\nbmFtZSBpZiBpbiB0aGUgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gcmVtb3ZlU2VxdWVuY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkg\newogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmIChuYW1lID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICAgICAgcmV0dXJuIF9zZXFzLnJlbW92ZShuYW1lKSAhPSBudWxsOwog\nICAgICAgICAgICB9CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGlmIChu\nYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIHJldHVybiBfc2Vxcy5yZW1vdmUobmFtZSkgIT0gbnVsbDsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIHN5c3RlbSBsaWZlY3ljbGUgbGlzdGVuZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGFkZFN5c3RlbUxpc3RlbmVyKE9iamVjdCBsaXN0ZW5lcikgewog\nICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIC8vIGNvcHkgdG8gYXZvaWQg\naXNzdWVzIHdpdGggTGlzdGVuZXJMaXN0IGFuZCBhdm9pZCB1bm5jZXNzYXJ5\nCiAgICAgICAgICAgICAgICAvLyBsb2NraW5nIG9uIHRoZSBsaXN0IGR1cmlu\nZyBydW50aW1lCiAgICAgICAgICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFn\nZXIuTGlzdGVuZXJMaXN0IGxpc3RlbmVycyA9IG5ldyBMaWZlY3ljbGVFdmVu\ndE1hbmFnZXIuTGlzdGVuZXJMaXN0KF9saXN0ZW5lcnMpOwogICAgICAgICAg\nICAgICAgbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7CiAgICAgICAgICAgICAg\nICBfbGlzdGVuZXJzID0gbGlzdGVuZXJzOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2Vy\nLkxpc3RlbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcgTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyLkxpc3RlbmVyTGlzdChfbGlzdGVuZXJzKTsKICAgICAgICAgICAg\nbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7CiAgICAgICAgICAgIF9saXN0ZW5l\ncnMgPSBsaXN0ZW5lcnM7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIHRoZSBnaXZlbiBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVy\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVTeXN0ZW1MaXN0\nZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAgICBpZiAoX2xvY2tpbmcp\nIHsKICAgICAgICAgICAgcmV0dXJuIHJlbW92ZVN5c3RlbUxpc3RlbmVyTG9j\na2luZyhsaXN0ZW5lcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\ncmV0dXJuIHJlbW92ZVN5c3RlbUxpc3RlbmVySW50ZXJuYWwobGlzdGVuZXIp\nOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgc3luY2hyb25pemVkIGJv\nb2xlYW4gcmVtb3ZlU3lzdGVtTGlzdGVuZXJMb2NraW5nKE9iamVjdCBsaXN0\nZW5lcikgewogICAgICAgIHJldHVybiByZW1vdmVTeXN0ZW1MaXN0ZW5lcklu\ndGVybmFsKGxpc3RlbmVyKTsKICAgIH0KICAgIHByaXZhdGUgYm9vbGVhbiBy\nZW1vdmVTeXN0ZW1MaXN0ZW5lckludGVybmFsKE9iamVjdCBsaXN0ZW5lcikg\newogICAgICAgIGlmICghX2xpc3RlbmVycy5jb250YWlucyhsaXN0ZW5lcikp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gY29weSB0\nbyBhdm9pZCBpc3N1ZXMgd2l0aCBMaXN0ZW5lckxpc3QgYW5kIGF2b2lkIHVu\nbmNlc3NhcnkKICAgICAgICAvLyBsb2NraW5nIG9uIHRoZSBsaXN0IGR1cmlu\nZyBydW50aW1lCiAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3Rl\nbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcgTGlmZWN5Y2xlRXZlbnRNYW5hZ2Vy\nLkxpc3RlbmVyTGlzdChfbGlzdGVuZXJzKTsKICAgICAgICBsaXN0ZW5lcnMu\ncmVtb3ZlKGxpc3RlbmVyKTsKICAgICAgICBfbGlzdGVuZXJzID0gbGlzdGVu\nZXJzOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVycwogICAg\nICovCiAgICBwdWJsaWMgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVy\nTGlzdCBnZXRTeXN0ZW1MaXN0ZW5lcnMoKSB7CiAgICAgICAgcmV0dXJuIF9s\naXN0ZW5lcnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBGcmVlIHRoZSByZXNv\ndXJjZXMgdXNlZCBieSB0aGlzIHJlcG9zaXRvcnkuIENsb3NlcyBhbGwgdXNl\nciBzZXF1ZW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkg\newogICAgICAgIGlmKF9sb2NraW5nKXsKICAgICAgICAgICAgY2xvc2VMb2Nr\naW5nKCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGNsb3NlSW50ZXJu\nYWwoKTsKICAgICAgICB9CiAgICB9CiAgICBwcml2YXRlIHN5bmNocm9uaXpl\nZCB2b2lkIGNsb3NlTG9ja2luZygpIHsKICAgICAgICBjbG9zZUludGVybmFs\nKCk7CiAgICB9CiAgICBwcml2YXRlIHZvaWQgY2xvc2VJbnRlcm5hbCgpIHsK\nICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhW10gc21kcyA9IGdldFNlcXVlbmNl\nTWV0YURhdGFzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzbWRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBzbWRzW2ldLmNsb3NlKCk7CiAg\nICAgICAgY2xlYXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFF1ZXJ5IGtl\neSBzdHJ1Y3QuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFF1\nZXJ5S2V5CiAgICAgICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAg\nICAgICBwdWJsaWMgU3RyaW5nIGNsc05hbWU7CiAgICAgICAgcHVibGljIFN0\ncmluZyBuYW1lOwoKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewog\nICAgICAgICAgICBpbnQgY2xzSGFzaCA9IChjbHNOYW1lID09IG51bGwpID8g\nMCA6IGNsc05hbWUuaGFzaENvZGUoKTsKICAgICAgICAgICAgaW50IG5hbWVI\nYXNoID0gKG5hbWUgPT0gbnVsbCkgPyAwIDogbmFtZS5oYXNoQ29kZSgpOwog\nICAgICAgICAgICByZXR1cm4gY2xzSGFzaCArIG5hbWVIYXNoOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvYmop\nCgkJewoJCQlpZiAob2JqID09IHRoaXMpCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJ\naWYgKCEob2JqIGluc3RhbmNlb2YgUXVlcnlLZXkpKQoJCQkJcmV0dXJuIGZh\nbHNlOwoJCQoJCQlRdWVyeUtleSBxayA9IChRdWVyeUtleSkgb2JqOwoJCQly\nZXR1cm4gU3RyaW5nVXRpbHMuZXF1YWxzIChjbHNOYW1lLCBxay5jbHNOYW1l\nKQoJCQkJJiYgU3RyaW5nVXRpbHMuZXF1YWxzIChuYW1lLCBxay5uYW1lKTsJ\nCgkJfQoJfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiBYTUwgbWV0YWRh\ndGEgZm9yIGEgZ2l2ZW4gZmllbGQgbWV0YWRhdGEKICAgICAqIEBwYXJhbSBm\nbWQKICAgICAqIEByZXR1cm4gWE1MIG1ldGFkYXRhCiAgICAgKi8KICAgIHB1\nYmxpYyBYTUxNZXRhRGF0YSBnZXRYTUxNZXRhRGF0YShGaWVsZE1ldGFEYXRh\nIGZtZCkgewogICAgICAgIGlmKF9sb2NraW5nKXsKICAgICAgICAgICAgcmV0\ndXJuIGdldFhNTE1ldGFEYXRhTG9ja2luZyhmbWQpOwogICAgICAgIH1lbHNl\newogICAgICAgICAgICByZXR1cm4gZ2V0WE1MTWV0YURhdGFJbnRlcm5hbChm\nbWQpOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgc3luY2hyb25pemVk\nIFhNTE1ldGFEYXRhIGdldFhNTE1ldGFEYXRhTG9ja2luZyhGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIHJldHVybiBnZXRYTUxNZXRhRGF0YUludGVy\nbmFsKGZtZCk7CiAgICB9CiAgICBwcml2YXRlIFhNTE1ldGFEYXRhIGdldFhN\nTE1ldGFEYXRhSW50ZXJuYWwoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICBDbGFzcyBjbHMgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAg\nLy8gY2hlY2sgaWYgY2FjaGVkIGJlZm9yZQogICAgICAgIFhNTE1ldGFEYXRh\nIHhtbG1ldGEgPSAoWE1MQ2xhc3NNZXRhRGF0YSkgX3htbG1ldGFzLmdldChj\nbHMpOwogICAgICAgIGlmICh4bWxtZXRhICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiB4bWxtZXRhOwogICAgICAgIAogICAgICAgIC8vIGxvYWQgSkFY\nQiBYTUwgbWV0YWRhdGEKICAgICAgICBfZmFjdG9yeS5sb2FkWE1MTWV0YURh\ndGEoZm1kKTsKICAgICAgICAKICAgICAgICB4bWxtZXRhID0gKFhNTENsYXNz\nTWV0YURhdGEpIF94bWxtZXRhcy5nZXQoY2xzKTsKCiAgICAgICAgcmV0dXJu\nIHhtbG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVsdCBpbmZvcm1hdGlv\nbiwgYWRkIGl0IHRvCiAgICAgKiB0aGUgcmVwb3NpdG9yeSwgYW5kIHJldHVy\nbiBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0gYWNjZXNzIHRoZSBhY2Nlc3Mg\ndHlwZSB0byB1c2UgaW4gcG9wdWxhdGluZyBtZXRhZGF0YQogICAgICovCiAg\nICBwdWJsaWMgWE1MQ2xhc3NNZXRhRGF0YSBhZGRYTUxNZXRhRGF0YShDbGFz\ncyB0eXBlLCBTdHJpbmcgbmFtZSkgewogICAgICAgIFhNTENsYXNzTWV0YURh\ndGEgbWV0YSA9IG5ld1hNTENsYXNzTWV0YURhdGEodHlwZSwgbmFtZSk7CiAg\nICAgICAgCiAgICAgICAgLy8gc3luY2hyb25pemUgb24gdGhpcyByYXRoZXIg\ndGhhbiB0aGUgbWFwLCBiZWNhdXNlIGFsbCBvdGhlciBtZXRob2RzCiAgICAg\nICAgLy8gdGhhdCBhY2Nlc3MgX3htbG1ldGFzIGFyZSBzeW5jaHJvbml6ZWQg\nb24gdGhpcwogICAgICAgIGlmKF9sb2NraW5nKXsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgICAgICBfeG1sbWV0YXMu\ncHV0KHR5cGUsIG1ldGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgIH1l\nbHNlewogICAgICAgICAgICBfeG1sbWV0YXMucHV0KHR5cGUsIG1ldGEpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgY2FjaGVkIFhNTENsYXNzTWV0YURhdGEgZm9y\nIHRoZSBnaXZlbiBjbGFzcwogICAgICogUmV0dXJuIG51bGwgaWYgbm9uZS4K\nICAgICAqLwogICAgcHVibGljIFhNTE1ldGFEYXRhIGdldENhY2hlZFhNTE1l\ndGFEYXRhKENsYXNzIGNscykgewogICAgICAgIHJldHVybiAoWE1MTWV0YURh\ndGEpIF94bWxtZXRhcy5nZXQoY2xzKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgeG1sIGNsYXNzIG1ldGFkYXRhCiAgICAgKiBA\ncGFyYW0gdHlwZQogICAgICogQHBhcmFtIG5hbWUKICAgICAqIEByZXR1cm4g\nYSBYTUxDbGFzc01ldGFEYXRhCiAgICAgKi8KICAgIHByb3RlY3RlZCBYTUxD\nbGFzc01ldGFEYXRhIG5ld1hNTENsYXNzTWV0YURhdGEoQ2xhc3MgdHlwZSwg\nU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFhNTENsYXNzTWV0\nYURhdGEodHlwZSwgbmFtZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgbmV3IHhtbCBmaWVsZCBtZXRhLCBhZGQgaXQgdG8gdGhlIGZp\nZWxkTWFwIGluIHRoZSBnaXZlbiAKICAgICAqICAgICB4bWwgY2xhc3MgbWV0\nYWRhdGEKICAgICAqIEBwYXJhbSB0eXBlCiAgICAgKiBAcGFyYW0gbmFtZQog\nICAgICogQHBhcmFtIG1ldGEKICAgICAqIEByZXR1cm4gYSBYTUxGaWVsZE1l\ndGFEYXRhCiAgICAgKi8KICAgIHB1YmxpYyBYTUxGaWVsZE1ldGFEYXRhIG5l\nd1hNTEZpZWxkTWV0YURhdGEoQ2xhc3MgdHlwZSwgU3RyaW5nIG5hbWUpIHsK\nICAgICAgICByZXR1cm4gbmV3IFhNTEZpZWxkTWV0YURhdGEodHlwZSwgbmFt\nZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBoZWxwZXIgbWV0\naG9kIHJldHVybnMgdHJ1ZSBpZiBPcHRpb25zIHBhcmFtYXRlciBoYXMgdGhl\nIHByb3BlcnR5IFByZWxvYWQKICAgICAqIHNldCB0byB0cnVlLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gbmVlZHNQcmVsb2FkKE9wdGlv\nbnMgbykgewogICAgICAgIGlmIChvLmdldEJvb2xlYW5Qcm9wZXJ0eShQUkVM\nT0FEX1NUUikgPT0gdHJ1ZSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8q\nKgogICAgICogQW5hbHl6ZXMgdGhlIGxpc3Qgb2YgQ2xhc3NNZXRhRGF0YSBp\nbiB0aGUgc3VwcGxpZWQgbGlzdCBmb3IgYW55IHdoaWNoIGhhcyBmb3JlaWdu\nIGtleXMgdG8gb3RoZXIgQ2xhc3NNZXRhRGF0YSAKICAgICAqIGluc3RhbmNl\ncyBpbiBpdHMgaWRlbnRpdHkgKGluIG90aGVyIHdvcmRzLCBQQ1R5cGVzIHdo\naWNoIGhhdmUgcHJpbWFyeSBrZXlzIHRoYXQgYXJlIGZvcmVpZ24ga2V5cyB0\nbyBvdGhlcgogICAgICogdGFibGVzKSwgYW5kIHJldHVybnMgYSBsaXN0IGFy\ncmFuZ2VkIHNvIHRoYXQgYSBDbGFzc01ldGFEYXRhIHRoYXQgZGVwZW5kcyBv\nbiBhbm90aGVyIENsYXNzTWV0YURhdGEgYXBwZWFycwogICAgICogYWZ0ZXIg\naXQgaW4gdGhlIGxpc3QuCiAgICAgKgogICAgICogQHBhcmFtIGNtZExpc3Qg\nLSBMaXN0IG9mIENsYXNzTWV0YURhdGEgdG8gZXhhbWluZQogICAgICogQHJl\ndHVybiAtIExpc3Qgb2YgQ2xhc3NNZXRhRGF0YSwgd2l0aCBDbGFzc01ldGFE\nYXRhIGRlcGVuZGVlcyBtb3ZlZCBhZnRlciB0aGUgbGFzdCBpZGVudGlmaWVk\nIGRlcGVuZGVudCAKICAgICAqICAgICAgICAgICBDbGFzc01ldGFEYXRhLCBp\nZiBhbnkgbW92ZSBpcyBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHByaXZhdGUg\nTGlzdDxDbGFzc01ldGFEYXRhPiByZXNvbHZlRktJblBLRGVwZW5kZW5jaWVz\nT3JkZXJpbmcoTGlzdDxDbGFzc01ldGFEYXRhPiBjbWRMaXN0KSB7CiAgICAg\nICAgSGFzaE1hcDxDbGFzc01ldGFEYXRhLCBDTUREZXBlbmRlbmN5Tm9kZT4g\nbm9kZU1hcCA9IG5ldyBIYXNoTWFwPENsYXNzTWV0YURhdGEsIENNRERlcGVu\nZGVuY3lOb2RlPigpOwogICAgICAgIEhhc2hTZXQ8Q01ERGVwZW5kZW5jeU5v\nZGU+IG5vZGVzV2l0aERlcGVuZGVuY2llc1NldCA9IG5ldyBIYXNoU2V0PENN\nRERlcGVuZGVuY3lOb2RlPigpOwogICAgICAgIEFycmF5TGlzdDxDTUREZXBl\nbmRlbmN5Tm9kZT4gbm9kZUxpc3QgPSBuZXcgQXJyYXlMaXN0PENNRERlcGVu\nZGVuY3lOb2RlPihjbWRMaXN0LnNpemUoKSk7CiAgICAgICAgCiAgICAgICAg\nLy8gSW5pdGlhbCBhbmFseXNpcyBvZiBDbGFzc01ldGFEYXRhIG9iamVjdHMg\nLS0gUG9wdWxhdGUgdGhlIGxpbmtlZCBsaXN0IHdpdGggb2JqZWN0cyBpbiB0\naGUgc2FtZSBvcmRlciBvZiAKICAgICAgICAvLyBhcHBlYXJhbmNlIGluIHRo\nZSBvcmlnaW5hbCBsaXN0LiBJZGVudGlmeSBDTURzIHdob3NlIGlkZW50aXRp\nZXMgaGF2ZSBhIEZLIHRvIGFub3RoZXIgQ01ELCBhbmQgY2F0YWxvZyB0aGF0\nIAogICAgICAgIC8vIGRlcGVuZGVuY3kuCiAgICAgICAgZm9yIChDbGFzc01l\ndGFEYXRhIGNtZCA6IGNtZExpc3QpIHsKICAgICAgICAgICAgLy8gQWRkIHRo\naXMgbm9kZSB0byB0aGUgbGlzdAogICAgICAgICAgICBDTUREZXBlbmRlbmN5\nTm9kZSBub2RlID0gbm9kZU1hcC5nZXQoY21kKTsKICAgICAgICAgICAgaWYg\nKG5vZGUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbm9kZSA9IG5ldyBD\nTUREZXBlbmRlbmN5Tm9kZShjbWQpOwogICAgICAgICAgICAgICAgbm9kZU1h\ncC5wdXQoY21kLCBub2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBu\nb2RlTGlzdC5hZGQobm9kZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAv\nLyBFeGFtaW5lIGl0cyBwcmltYXJ5IGtleSBmaWVsZHMsIGZsYWcgYW55IHJl\nZmVyZW5jZXMgdG8gYW5vdGhlciBQQ1R5cGUgdGhhdCBpcyBkZWZpbmVkIGlu\nIGNtZExpc3QgYXMgYSAKICAgICAgICAgICAgLy8gZGVwZW5kZW5jeQogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kQXJyID0gY21kLmdldFByaW1h\ncnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRh\nIGZtZCA6IGZtZEFycikgewogICAgICAgICAgICAgICAgVmFsdWVNZXRhRGF0\nYSB2bWQgPSBmbWQuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmICh2\nbWQuaXNUeXBlUEMoKSkgewogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgdGFyZ2V0Q01EID0gdm1kLmdldERlY2xhcmVkVHlwZU1ldGFEYXRh\nKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgcHJvY2VzcyBlbnRy\naWVzIHdoaWNoIGFyZSBpbiB0aGUgY21kTGlzdCwgYXMgd2UgZG9uJ3Qgd2Fu\ndCB0byBiZSBhZGRpbmcgYW55dGhpbmcgbmV3LgogICAgICAgICAgICAgICAg\nICAgIGlmICghY21kTGlzdC5jb250YWlucyh0YXJnZXRDTUQpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGRl\ncGVuZGVuY3kKICAgICAgICAgICAgICAgICAgICBDTUREZXBlbmRlbmN5Tm9k\nZSB0YXJnZXROb2RlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAo\nKHRhcmdldE5vZGUgPSBub2RlTWFwLmdldCh0YXJnZXRDTUQpKSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldE5vZGUgPSBuZXcg\nQ01ERGVwZW5kZW5jeU5vZGUodGFyZ2V0Q01EKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgbm9kZU1hcC5wdXQodGFyZ2V0Q01ELCB0YXJnZXROb2RlKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9k\nZS5yZWdpc3RlckRlcGVuZGVudE5vZGUodGFyZ2V0Tm9kZSk7CiAgICAgICAg\nICAgICAgICAgICAgbm9kZXNXaXRoRGVwZW5kZW5jaWVzU2V0LmFkZChub2Rl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICAKICAgICAgICAvLyBBbmFseXNpcyBpcyBjb21wbGV0ZS4gRm9y\nIGVhY2ggQ01EIHRoYXQgaGFzIGFuIGlkZW50aXR5IGZvcmVpZ24ga2V5IGRl\ncGVuZGVuY3kgb24gYW5vdGhlciBDTUQsIGVuc3VyZSB0aGF0IGl0CiAgICAg\nICAgLy8gYXBwZWFycyBsYXRlciBpbiB0aGUgbGlzdCB0aGVuIHRoZSBDTUQg\naXQgaXMgZGVwZW5kZW50IG9uLiBJZiBpdCBhcHBlYXJzIGVhcmxpZXIsIG1v\ndmUgaXQgaW1tZWRpYXRlbHkgYWZ0ZXIgCiAgICAgICAgLy8gdGhlIENNRC4g\nSWYgdGhlcmUgYXJlIG11bHRpcGxlIENNRHMgdGhlIGlkZW50aXR5IGlzIGRl\ncGVuZGVudCBvbiwgbW92ZSBpdCBhZnRlciB0aGUgbGFzdCBkZXBlbmRlbmN5\nIGluCiAgICAgICAgLy8gdGhlIGxpbmtlZCBsaXN0LgogICAgICAgIGZvciAo\nQ01ERGVwZW5kZW5jeU5vZGUgbm9kZSA6IG5vZGVzV2l0aERlcGVuZGVuY2ll\nc1NldCkgewogICAgICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBhIGN5\nY2xlIChkZXBlbmRlbmNpZXMgb3Igc3ViZGVwZW5kZW5jaWVzIHRoYXQgY3Jl\nYXRlIGEgY3ljbGUgaW4gdGhlIGdyYXBoLiBJZiBvbmUgaXMgCiAgICAgICAg\nICAgIC8vIGRldGVjdGVkLCB0aGVuIHRoaXMgYWxnb3JpdGhtIGNhbm5vdCBi\nZSB1c2VkIHRvIHJlb3JkZXIgdGhlIENNRCBsaXN0LiAgRW1pdCBhIHdhcm5p\nbmcsIGFuZCByZXR1cm4gdGhlIAogICAgICAgICAgICAvLyBvcmlnaW5hbCBs\naXN0LgogICAgICAgICAgICBpZiAobm9kZS5jaGVja0ZvckN5Y2xlKCkpIHsK\nICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkgewog\nICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiY21kLWRp\nc2NvdmVyLWN5Y2xlIiwgbm9kZS5nZXRDbWQoKS5nZXRSZXNvdXJjZU5hbWUo\nKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJu\nIGNtZExpc3Q7CiAgICAgICAgICAgIH0KIAogICAgICAgICAgICBpbnQgbm9k\nZUluZGV4ID0gbm9kZUxpc3QuaW5kZXhPZihub2RlKTsKICAgICAgICAgICAg\nU2V0PENNRERlcGVuZGVuY3lOb2RlPiBkZXBlbmRlbmNpZXMgPSBub2RlLmdl\ndERlcGVuZHNPblNldCgpOyAgICAgICAKICAgICAgICAgICAgCiAgICAgICAg\nICAgIC8vIElmIHRoZSBjdXJyZW50IG5vZGUgaGFzIGEgZGVwZW5kZW5jeSB0\naGF0IGFwcGVhcnMgbGF0ZXIgaW4gdGhlIGxpc3QsIHRoZW4gdGhpcyBub2Rl\nIG5lZWRzCiAgICAgICAgICAgIC8vIHRvIGJlIG1vdmVkIHRvIHRoZSBwb2lu\ndCBpbW1lZGlhdGVseSBhZnRlciB0aGF0IGRlcGVuZGVuY3kuCiAgICAgICAg\nICAgIENNRERlcGVuZGVuY3lOb2RlIG1vdmVBZnRlciA9IG51bGw7CiAgICAg\nICAgICAgIGludCBtb3ZlQWZ0ZXJJbmRleCA9IC0xOwogICAgICAgICAgICBm\nb3IgKENNRERlcGVuZGVuY3lOb2RlIGRlcE5vZGUgOiBkZXBlbmRlbmNpZXMp\nIHsgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGludCBkZXBlbmRl\nbmN5SW5kZXggPSBub2RlTGlzdC5pbmRleE9mKGRlcE5vZGUpOwogICAgICAg\nICAgICAgICAgaWYgKChub2RlSW5kZXggPCBkZXBlbmRlbmN5SW5kZXgpICYm\nIChtb3ZlQWZ0ZXJJbmRleCA8IGRlcGVuZGVuY3lJbmRleCkpIHsKICAgICAg\nICAgICAgICAgICAgICBtb3ZlQWZ0ZXIgPSBkZXBOb2RlOwogICAgICAgICAg\nICAgICAgICAgIG1vdmVBZnRlckluZGV4ID0gZGVwZW5kZW5jeUluZGV4Owog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChtb3ZlQWZ0ZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgbm9kZUxp\nc3QucmVtb3ZlKG5vZGVJbmRleCk7CiAgICAgICAgICAgICAgICBub2RlTGlz\ndC5hZGQobm9kZUxpc3QuaW5kZXhPZihtb3ZlQWZ0ZXIpICsgMSwgbm9kZSk7\nCiAgICAgICAgICAgIH0gICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgLy8gU29ydGluZyBpcyBjb21wbGV0ZSwgYnVpbGQgdGhlIHJldHVybiBs\naXN0LiAgQ2xlYXIgdGhlIGRlcGVuZHNPblNldCBmb3IgdGhlIEdDLgogICAg\nICAgIEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPiByZXR1cm5MaXN0ID0gbmV3\nIEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPigpOwogICAgICAgIGZvciAoQ01E\nRGVwZW5kZW5jeU5vZGUgY3VycmVudCA6IG5vZGVMaXN0KSB7CiAgICAgICAg\nICAgIHJldHVybkxpc3QuYWRkKGN1cnJlbnQuZ2V0Q21kKCkpOwogICAgICAg\nICAgICBjdXJyZW50LmdldERlcGVuZHNPblNldCgpLmNsZWFyKCk7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByZXR1cm5MaXN0OwogICAg\nfQoKICAgIC8qKgogICAgICogTGlua2VkIGxpc3Qgbm9kZSBjbGFzcyBmb3Ig\nbWFuYWdpbmcgYW55IGZvcmVpZ24ga2V5cyBpbiB0aGUgaWRlbnRpdHkgb2Yg\nYSBDbGFzc01ldGFEYXRhIGluc3RhbmNlLgogICAgICogCiAgICAgKi8KICAg\nIHByaXZhdGUgY2xhc3MgQ01ERGVwZW5kZW5jeU5vZGUgewogICAgICAgIHBy\naXZhdGUgQ2xhc3NNZXRhRGF0YSBjbWQ7CgogICAgICAgIC8vIE1hcmtlciBm\nb3IgcXVpY2sgZGV0ZXJtaW5hdGlvbiBpZiB0aGlzIG5vZGUgaGFzIGRlcGVu\nZGVuY2llcwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBoYXNEZXBlbmRlbmNp\nZXMgPSBmYWxzZTsKCiAgICAgICAgLy8gTGlzdCBvZiBDbGFzc01ldGFEYXRh\nIG9iamVjdHMgdGhpcyBDbGFzc01ldGFEYXRhIGRlcGVuZHMgb24KICAgICAg\nICBwcml2YXRlIEhhc2hTZXQ8Q01ERGVwZW5kZW5jeU5vZGU+IGRlcGVuZHNP\nblNldCA9IG5ldyBIYXNoU2V0PENNRERlcGVuZGVuY3lOb2RlPigpOwoKICAg\nICAgICAvKioKICAgICAgICAgKiBJbm5lciBjbGFzcyBjb25zdHJ1Y3Rvcgog\nICAgICAgICAqLwogICAgICAgIENNRERlcGVuZGVuY3lOb2RlKENsYXNzTWV0\nYURhdGEgY21kKSB7CiAgICAgICAgICAgIHRoaXMuY21kID0gY21kOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgQ2xh\nc3NNZXRhRGF0YSBpbnN0YW5jZSByZWZlcmVuY2VkIGJ5IHRoaXMgbm9kZS4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRD\nbWQoKSB7CiAgICAgICAgICAgIHJldHVybiBjbWQ7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiAKICAgICAgICAgKiBAcmV0dXJuIHRydWUg\naWYgdGhpcyBub2RlJ3MgQ2xhc3NNZXRhRGF0YSBoYXMgYSBGSyBpbiBpdHMg\naWRlbnRpdHkgdGhhdCByZWZlcnMgdG8gYW5vdGhlciBDbGFzc01ldGFEYXRh\nOyAKICAgICAgICAgKiAgICAgICAgIGZhbHNlIGlmIGl0IGRvZXMgbm90Lgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyBib29sZWFuIGdldEhhc0RlcGVu\nZGVuY2llcygpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc0RlcGVuZGVuY2ll\nczsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlZ2lzdGVy\ncyBhIENsYXNzTWV0YURhdGEgbW9kZWxsZWQgYnkgYSBDTUREZXBlbmRlbmN5\nTm9kZSBhcyBhIGRlcGVuZGVuY3kgb2YgdGhpcyBDbGFzc01ldGFEYXRhLgog\nICAgICAgICAqIAogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHJl\nZ2lzdGVyRGVwZW5kZW50Tm9kZShDTUREZXBlbmRlbmN5Tm9kZSBub2RlKSB7\nCiAgICAgICAgICAgIGdldERlcGVuZHNPblNldCgpLmFkZChub2RlKTsKICAg\nICAgICAgICAgaGFzRGVwZW5kZW5jaWVzID0gdHJ1ZTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgYSBTZXQgY29udGFpbmlu\nZyBhbGwgb2YgdGhlIENNRERlcGVuZGVuY3lOb2RlIGluc3RhbmNlcyB0aGF0\nIHRoaXMgbm9kZSBoYXMgYSBGSyBpbiBpZGVudGl0eSAKICAgICAgICAgKiBk\nZXBlbmRlbmN5IG9uLgogICAgICAgICAqIAogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBTZXQ8Q01ERGVwZW5kZW5jeU5vZGU+IGdldERlcGVuZHNPblNl\ndCgpIHsKICAgICAgICAgICAgcmV0dXJuIGRlcGVuZHNPblNldDsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBhbGwgZGVwZW5k\nZW5jaWVzLCBhbmQgc3ViLWRlcGVuZGVuY2llcywgZm9yIGFueSBjeWNsZXMg\naW4gdGhlIGRlcGVuZGVuY3kgZ3JhcGguCiAgICAgICAgICogCiAgICAgICAg\nICogQHJldHVybiB0cnVlIGlmIGEgY3ljbGUgd2FzIGRpc2NvdmVyZWQsIGZh\nbHNlIGlmIG5vdC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBjaGVja0ZvckN5Y2xlKCkgewogICAgICAgICAgICBqYXZhLnV0aWwuU3Rh\nY2s8Q01ERGVwZW5kZW5jeU5vZGU+IHZpc2l0U3RhY2sgPSBuZXcgamF2YS51\ndGlsLlN0YWNrPENNRERlcGVuZGVuY3lOb2RlPigpOwogICAgICAgICAgICBy\nZXR1cm4gaW50ZXJuYWxDaGVja0ZvckN5Y2xlKHZpc2l0U3RhY2spOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSW50ZXJuYWwgaW1wbGVt\nZW50YXRpb24gb2YgdGhlIGN5Y2xlIGRldGVjdGlvbi4KICAgICAgICAgKiAK\nICAgICAgICAgKiBAcGFyYW0gdmlzaXRTdGFjawogICAgICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiBhIGN5Y2xlIGlzIGRldGVjdGVkLCBmYWxzZSBpZiBubyBj\neWNsZSB3YXMgZGV0ZWN0ZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0\nZSBib29sZWFuIGludGVybmFsQ2hlY2tGb3JDeWNsZShqYXZhLnV0aWwuU3Rh\nY2s8Q01ERGVwZW5kZW5jeU5vZGU+IHZpc2l0U3RhY2spIHsKICAgICAgICAg\nICAgaWYgKHZpc2l0U3RhY2suY29udGFpbnModGhpcykpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHZpc2l0U3RhY2sucHVzaCh0aGlzKTsKCiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBmb3IgKENNRERlcGVuZGVuY3lOb2RlIG5vZGUgOiBk\nZXBlbmRzT25TZXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5n\nZXRIYXNEZXBlbmRlbmNpZXMoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAobm9kZS5pbnRlcm5hbENoZWNrRm9yQ3ljbGUodmlzaXRTdGFjaykg\nPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICB2aXNpdFN0YWNrLnBvcCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

