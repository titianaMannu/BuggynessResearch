{"sha":"a305b59d6e26332ad8faae53fe971f874880d0c6","node_id":"MDQ6QmxvYjIwNjM2NDphMzA1YjU5ZDZlMjYzMzJhZDhmYWFlNTNmZTk3MWY4NzQ4ODBkMGM2","size":12376,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a305b59d6e26332ad8faae53fe971f874880d0c6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5o\nYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmVuaGFuY2UuU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmVuaGFuY2UuTWFuYWdlZEluc3RhbmNlUHJvdmlkZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5SZWZsZWN0aW5nUGVy\nc2lzdGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuUnVudGltZVVuZW5oYW5jZWRDbGFzc3Nlc01vZGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3Rh\ndGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Q\nQ1N0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9y\nZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0\nb3JlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5DbG9zZWFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuUmVmZXJlbmNlTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLlVVSURHZW5lcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50UmVmZXJlbmNlSGFz\naE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5\ncGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVl\nU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9w\nZW5KUEFDb25maWd1cmF0aW9uOwoKLyoqCiAqIEhlbHBlciBmb3IgT3BlbkpQ\nQSBiYWNrLWVuZHMuCiAqCiAqIEBzaW5jZSAwLjMuMAogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgSW1wbEhl\nbHBlciB7CgogICAgLy8gQ2FjaGUgZm9yIGZyb20vdG8gdHlwZSBhc3NpZ25t\nZW50cwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwIF9hc3NpZ25hYmxl\nVHlwZXMgPQogICAgICAgIG5ldyBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1h\ncChSZWZlcmVuY2VNYXAuV0VBSywgUmVmZXJlbmNlTWFwLkhBUkQpOwoKICAg\nIC8vIG1hcCBvZiBhbGwgbmV3IHVuZW5oYW5jZWQgaW5zdGFuY2VzIGFjdGl2\nZSBpbiB0aGlzIGNsYXNzbG9hZGVyCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIE1hcCBfdW5lbmhhbmNlZEluc3RhbmNlTWFwID0KICAgICAgICBuZXcgQ29u\nY3VycmVudFJlZmVyZW5jZUhhc2hNYXAoUmVmZXJlbmNlTWFwLldFQUssIFJl\nZmVyZW5jZU1hcC5IQVJEKSB7CgogICAgICAgICAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBlcShPYmplY3QgeCwgT2JqZWN0IHkpIHsKICAgICAgICAgICAgICAg\nIC8vIHRoZSBFbnRyaWVzIGluIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFw\nIGRlbGVnYXRlIGJhY2sgdG8KICAgICAgICAgICAgICAgIC8vIGVxKCkgaW4g\ndGhlaXIgZXF1YWxzKCkgaW1wbHMKICAgICAgICAgICAgICAgIGlmICh4IGlu\nc3RhbmNlb2YgTWFwLkVudHJ5KQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBzdXBlci5lcSh4LCB5KTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4geCA9PSB5OwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwcm90ZWN0ZWQgaW50IGhjKE9iamVjdCBvKSB7CiAgICAg\nICAgICAgICAgICAvLyB0aGUgRW50cmllcyBpbiBDb25jdXJyZW50UmVmZXJl\nbmNlSGFzaE1hcCBkZWxlZ2F0ZSBiYWNrIHRvCiAgICAgICAgICAgICAgICAv\nLyBoYygpIGluIHRoZWlyIGhhc2hDb2RlKCkgaW1wbHMKICAgICAgICAgICAg\nICAgIGlmIChvIGluc3RhbmNlb2YgTWFwLkVudHJ5KQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBlci5oYyhvKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3lzdGVtLmlkZW50aXR5\nSGFzaENvZGUobyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgIC8q\nKgogICAgICogSGVscGVyIGZvciBzdG9yZSBtYW5hZ2VyIGltcGxlbWVudGF0\naW9ucy4gVGhpcyBtZXRob2Qgc2ltcGx5IGRlbGVnYXRlcwogICAgICogdG8g\ndGhlIHByb3BlciBzaW5ndWxhciBtZXRob2QgZm9yIGVhY2ggc3RhdGUgbWFu\nYWdlci4KICAgICAqCiAgICAgKiBAc2VlIFN0b3JlTWFuYWdlciNsb2FkQWxs\nCiAgICAgKiBAc2luY2UgMC40LjAKICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBDb2xsZWN0aW9uIGxvYWRBbGwoQ29sbGVjdGlvbiBzbXMsIFN0b3JlTWFu\nYWdlciBzdG9yZSwKICAgICAgICBQQ1N0YXRlIHN0YXRlLCBpbnQgbG9hZCwg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4dCkgewog\nICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gbnVsbDsKICAgICAgICBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtOwogICAgICAgIExvY2tNYW5hZ2VyIGxtOwog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoIXN0b3JlLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgY29udGV4\ndCkpCiAgICAgICAgICAgICAgICAgICAgZmFpbGVkID0gYWRkRmFpbGVkSWQo\nc20sIGZhaWxlZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobG9hZCAhPSBT\ndG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FCiAgICAgICAgICAgICAgICB8\nfCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsKICAgICAg\nICAgICAgICAgIGxtID0gc20uZ2V0Q29udGV4dCgpLmdldExvY2tNYW5hZ2Vy\nKCk7CiAgICAgICAgICAgICAgICBpZiAoIXN0b3JlLmxvYWQoc20sIHNtLmdl\ndFVubG9hZGVkKGZldGNoKSwgZmV0Y2gsIAogICAgICAgICAgICAgICAgICAg\nIGxtLmdldExvY2tMZXZlbChzbSksIGNvbnRleHQpKQogICAgICAgICAgICAg\nICAgICAgIGZhaWxlZCA9IGFkZEZhaWxlZElkKHNtLCBmYWlsZWQpOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKCFzdG9yZS5leGlzdHMoc20sIGNvbnRleHQp\nKQogICAgICAgICAgICAgICAgZmFpbGVkID0gYWRkRmFpbGVkSWQoc20sIGZh\naWxlZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoZmFpbGVkID09IG51\nbGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6IGZhaWxlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBpZGVudGl0eSBvZiBnaXZlbiBpbnN0YW5j\nZSB0byBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBD\nb2xsZWN0aW9uIGFkZEZhaWxlZElkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nCiAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQpIHsKICAgICAgICBpZiAoZmFp\nbGVkID09IG51bGwpCiAgICAgICAgICAgIGZhaWxlZCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICBmYWlsZWQuYWRkKHNtLmdldElkKCkpOwogICAgICAg\nIHJldHVybiBmYWlsZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSBhIHZhbHVlIGZvciB0aGUgZ2l2ZW4gbWV0YWRhdGEsIG9yIHJldHVybiBu\ndWxsLiBHZW5lcmF0ZXMKICAgICAqIHZhbHVlcyBmb3IgaHRlIGZvbGxvd2lu\nZyBzdHJhdGVnaWVzOiB7QGxpbmsgVmFsdWVTdHJhdGVnaWVzI1NFUVVFTkNF\nfSwKICAgICAqIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXMjVVVJRF9TVFJJTkd9\nLCB7QGxpbmsgVmFsdWVTdHJhdGVnaWVzI1VVSURfSEVYfQogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIE9iamVjdCBnZW5lcmF0ZUlkZW50aXR5VmFsdWUo\nU3RvcmVDb250ZXh0IGN0eCwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEs\nIGludCB0eXBlQ29kZSkgewogICAgICAgIHJldHVybiBnZW5lcmF0ZVZhbHVl\nKGN0eCwgbWV0YSwgbnVsbCwgdHlwZUNvZGUpOwogICAgfQoKICAgIC8qKgog\nICAgICogR2VuZXJhdGUgYSB2YWx1ZSBmb3IgdGhlIGdpdmVuIG1ldGFkYXRh\nLCBvciByZXR1cm4gbnVsbC4gR2VuZXJhdGVzCiAgICAgKiB2YWx1ZXMgZm9y\nIGh0ZSBmb2xsb3dpbmcgc3RyYXRlZ2llczoge0BsaW5rIFZhbHVlU3RyYXRl\nZ2llcyNTRVFVRU5DRX0sCiAgICAgKiB7QGxpbmsgVmFsdWVTdHJhdGVnaWVz\nI1VVSURfU1RSSU5HfSwge0BsaW5rIFZhbHVlU3RyYXRlZ2llcyNVVUlEX0hF\nWH0KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZ2VuZXJhdGVG\naWVsZFZhbHVlKFN0b3JlQ29udGV4dCBjdHgsCiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4gZ2VuZXJhdGVWYWx1ZShjdHgs\nIGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCksIGZtZCwgCiAgICAgICAgICAg\nIGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogR2VuZXJhdGUgYSB2YWx1ZSBmb3IgdGhlIGdpdmVuIG1ldGFkYWEu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBnZW5lcmF0ZVZh\nbHVlKFN0b3JlQ29udGV4dCBjdHgsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhLCBGaWVsZE1ldGFEYXRhIGZtZCwgaW50IHR5cGVDb2RlKSB7CiAgICAg\nICAgaW50IHN0cmF0ZWd5ID0gKGZtZCA9PSBudWxsKSA/IG1ldGEuZ2V0SWRl\nbnRpdHlTdHJhdGVneSgpCiAgICAgICAgICAgIDogZm1kLmdldFZhbHVlU3Ry\nYXRlZ3koKTsKICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7CiAgICAgICAg\nICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFOgogICAgICAgICAg\nICAgICAgU2VxdWVuY2VNZXRhRGF0YSBzbWQgPSAoZm1kID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgPyBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VN\nZXRhRGF0YSgpCiAgICAgICAgICAgICAgICAgICAgOiBmbWQuZ2V0VmFsdWVT\nZXF1ZW5jZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gSmF2\nYVR5cGVzLmNvbnZlcnQoc21kLmdldEluc3RhbmNlKGN0eC5nZXRDbGFzc0xv\nYWRlcigpKS4KICAgICAgICAgICAgICAgICAgICBuZXh0KGN0eCwgbWV0YSks\nIHR5cGVDb2RlKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMu\nVVVJRF9TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJREdlbmVy\nYXRvci5uZXh0U3RyaW5nKFVVSURHZW5lcmF0b3IuVFlQRTEpOwogICAgICAg\nICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDoKICAgICAgICAg\nICAgICAgIHJldHVybiBVVUlER2VuZXJhdG9yLm5leHRIZXgoVVVJREdlbmVy\nYXRvci5UWVBFMSk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVz\nLlVVSURfVFlQRTRfU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIFVV\nSURHZW5lcmF0b3IubmV4dFN0cmluZyhVVUlER2VuZXJhdG9yLlRZUEU0KTsK\nICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9UWVBFNF9I\nRVg6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJREdlbmVyYXRvci5uZXh0\nSGV4KFVVSURHZW5lcmF0b3IuVFlQRTQpOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZmllbGRzIG9mIHRoZSBz\ndGF0ZSB0aGF0IHJlcXVpcmUgYW4gdXBkYXRlLgogICAgICoKICAgICAqIEBw\nYXJhbSAgc20gIHRoZSBzdGF0ZSB0byBjaGVjawogICAgICogQHJldHVybiB0\naGUgQml0U2V0IG9mIGZpZWxkcyB0aGF0IG5lZWQgdXBkYXRlLCBvciBudWxs\nIGlmIG5vbmUKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBCaXRTZXQgZ2V0\nVXBkYXRlRmllbGRzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAg\nICBpZiAoKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBESVJUWQogICAg\nICAgICAgICAmJiAoIXNtLmlzRmx1c2hlZCgpIHx8IHNtLmlzRmx1c2hlZERp\ncnR5KCkpKQogICAgICAgICAgICB8fCAoc20uZ2V0UENTdGF0ZSgpID09IFBD\nU3RhdGUuUE5FVyAmJiBzbS5pc0ZsdXNoZWREaXJ0eSgpKSkgewogICAgICAg\nICAgICBCaXRTZXQgZGlydHkgPSBzbS5nZXREaXJ0eSgpOwogICAgICAgICAg\nICBpZiAoc20uaXNGbHVzaGVkKCkpIHsKICAgICAgICAgICAgICAgIGRpcnR5\nID0gKEJpdFNldCkgZGlydHkuY2xvbmUoKTsKICAgICAgICAgICAgICAgIGRp\ncnR5LmFuZE5vdChzbS5nZXRGbHVzaGVkKCkpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChkaXJ0eS5sZW5ndGgoKSA+IDApCiAgICAgICAgICAg\nICAgICByZXR1cm4gZGlydHk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2UgdGhlIGdpdmVuIHJl\nc291cmNlLiBUaGUgcmVzb3VyY2UgY2FuIGJlIGFuIGV4dGVudCBpdGVyYXRv\nciwKICAgICAqIHF1ZXJ5IHJlc3VsdCwgbGFyZ2UgcmVzdWx0IHNldCByZWxh\ndGlvbiwgb3IgYW55IGNsb3NlYWJsZSBPcGVuSlBBCiAgICAgKiBjb21wb25l\nbnQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjbG9zZShPYmpl\nY3QgbykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChvIGluc3Rh\nbmNlb2YgQ2xvc2VhYmxlKQogICAgICAgICAgICAgICAgKChDbG9zZWFibGUp\nIG8pLmNsb3NlKCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyByZTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRydWUgaWYgdGhlIHNwZWNpZmllZCBjbGFzcyBpcyBhIHR5\ncGUgdGhhdCBjYW4gYmUgbWFuYWdlZCBieQogICAgICogT3BlbkpQQS4KICAg\nICAqCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgY2xhc3MgdG8gdGVzdAogICAg\nICogQHJldHVybiB0cnVlIGlmIHRoZSBjbGFzcyBpcyBtYW5hZ2VhYmxlLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGJvb2xlYW4gaXNNYW5hZ2VkVHlwZShPcGVuSlBBQ29uZmlndXJh\ndGlvbiBjb25mLCBDbGFzcyB0eXBlKSB7CiAgICAgICAgcmV0dXJuIChQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKQog\nICAgICAgICAgICB8fCAodHlwZSAhPSBudWxsCiAgICAgICAgICAgICAgICAm\nJiAoY29uZiA9PSBudWxsIHx8IGNvbmYuZ2V0UnVudGltZVVuZW5oYW5jZWRD\nbGFzc2VzQ29uc3RhbnQoKQogICAgICAgICAgICAgICAgICAgID09IFJ1bnRp\nbWVVbmVuaGFuY2VkQ2xhc3NzZXNNb2Rlcy5TVVBQT1JURUQpCiAgICAgICAg\nICAgICAgICAmJiBQQ1JlZ2lzdHJ5LmlzUmVnaXN0ZXJlZCh0eXBlKSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBzcGVj\naWZpZWQgaW5zdGFuY2UgaXMgbWFuYWdlYWJsZS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gaW5zdGFuY2UgdGhlIG9iamVjdCB0byBjaGVjawogICAgICogQHJl\ndHVybiB0cnVlIGlmIHRoZSBpbnN0YW5jZSBpcyBhIHBlcnNpc3RlbnQgdHlw\nZSwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nYm9vbGVhbiBpc01hbmFnZWFibGUoT2JqZWN0IGluc3RhbmNlKSB7CiAgICAg\nICAgcmV0dXJuIGluc3RhbmNlIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBh\nYmxlCiAgICAgICAgICAgIHx8IGluc3RhbmNlICE9IG51bGwgJiYgUENSZWdp\nc3RyeS5pc1JlZ2lzdGVyZWQoaW5zdGFuY2UuZ2V0Q2xhc3MoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5j\nZWQgInRvIiBjbGFzcyBpcyBhc3NpZ25hYmxlIHRvIHRoZSAiZnJvbSIKICAg\nICAqIGNsYXNzLiAgVGhpcyBoZWxwZXIgbWV0aG9kIHV0aWxpemVzIGEgY2Fj\naGUgdG8gaGVscCBhdm9pZCB0aGUgb3ZlcmhlYWQKICAgICAqIG9mIHRoZSBD\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKCkgbWV0aG9kLgogICAgICoKICAgICAq\nIEBwYXJhbSBmcm9tIHRhcmdldCBjbGFzcyBpbnN0YW5jZSB0byBiZSBjaGVj\na2VkIGZvciBhc3NpZ25hYmlsaXR5CiAgICAgKiBAcGFyYW0gdG8gc2Vjb25k\nIGNsYXNzIGluc3RhbmNlIHRvIGJlIGNoZWNrZWQgZm9yIGFzc2lnbmFiaWxp\ndHkKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgInRvIiBjbGFzcyBpcyBh\nc3NpZ25hYmxlIHRvIHRoZSAiZnJvbSIgY2xhc3MKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBib29sZWFuIGlzQXNzaWduYWJsZShDbGFzcyBmcm9tLCBD\nbGFzcyB0bykgewogICAgICAgIGlmIChmcm9tID09IG51bGwgfHwgdG8gPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBCb29s\nZWFuIGlzQXNzaWduYWJsZSA9IG51bGw7CiAgICAgICAgTWFwIGFzc2lnbmFi\nbGVUbyA9IChNYXApIF9hc3NpZ25hYmxlVHlwZXMuZ2V0KGZyb20pOwogICAg\nICAgIGlmIChhc3NpZ25hYmxlVG8gPT0gbnVsbCkgeyAvLyAidG8iIGNhY2hl\nIGRvZXNuJ3QgZXhpc3QsIHNvIGNyZWF0ZSBpdC4uLgogICAgICAgICAgICBh\nc3NpZ25hYmxlVG8gPSBuZXcgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAo\nUmVmZXJlbmNlTWFwLldFQUssCiAgICAgICAgICAgICAgICAgICAgUmVmZXJl\nbmNlTWFwLkhBUkQpOwogICAgICAgICAgICBfYXNzaWduYWJsZVR5cGVzLnB1\ndChmcm9tLCBhc3NpZ25hYmxlVG8pOwogICAgICAgIH0gZWxzZSB7IC8vICJ0\nbyIgY2FjaGUgZXhpc3RzLi4uCiAgICAgICAgICAgIGlzQXNzaWduYWJsZSA9\nIChCb29sZWFuKSBhc3NpZ25hYmxlVG8uZ2V0KHRvKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChpc0Fzc2lnbmFibGUgPT0gbnVsbCkgey8vIHdlIGRvbid0\nIGhhdmUgYSByZWNvcmQgb2YgdGhpcyBwYWlyLi4uCiAgICAgICAgICAgIGlz\nQXNzaWduYWJsZSA9IEJvb2xlYW4udmFsdWVPZihmcm9tLmlzQXNzaWduYWJs\nZUZyb20odG8pKTsKICAgICAgICAgICAgYXNzaWduYWJsZVRvLnB1dCh0bywg\naXNBc3NpZ25hYmxlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpc0Fz\nc2lnbmFibGUuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBAcmV0dXJuIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGluc3RhbmNlIHJl\nc3BvbnNpYmxlIGZvciBtYW5hZ2luZwogICAgICogPGNvZGU+bzwvY29kZT4s\nIG9yIDxjb2RlPm51bGw8L2NvZGU+IGlmIDxjb2RlPm88L2NvZGU+IGlzIG5v\ndCBtYW5hZ2VhYmxlLgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgUGVyc2lzdGVuY2VDYXBhYmxlIHRvUGVyc2lzdGVu\nY2VDYXBhYmxlKE9iamVjdCBvLCBPYmplY3QgY3R4KXsKICAgICAgICBpZiAo\nbyBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJsZSkKICAgICAgICAgICAg\ncmV0dXJuIChQZXJzaXN0ZW5jZUNhcGFibGUpIG87CgogICAgICAgIE9wZW5K\nUEFDb25maWd1cmF0aW9uIGNvbmYgPSBudWxsOwogICAgICAgIGlmIChjdHgg\naW5zdGFuY2VvZiBPcGVuSlBBQ29uZmlndXJhdGlvbikKICAgICAgICAgICAg\nY29uZiA9IChPcGVuSlBBQ29uZmlndXJhdGlvbikgY3R4OwogICAgICAgIGVs\nc2UgaWYgKGN0eCBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcgogICAgICAgICAg\nICAmJiAoKFN0YXRlTWFuYWdlcikgY3R4KS5nZXRHZW5lcmljQ29udGV4dCgp\nIGluc3RhbmNlb2YgU3RvcmVDb250ZXh0KQogICAgICAgICAgICBjb25mID0g\nKChTdG9yZUNvbnRleHQpICgoU3RhdGVNYW5hZ2VyKSBjdHgpLmdldEdlbmVy\naWNDb250ZXh0KCkpCiAgICAgICAgICAgICAgICAuZ2V0Q29uZmlndXJhdGlv\nbigpOwoKICAgICAgICBpZiAoIWlzTWFuYWdlYWJsZShvKSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGlmIHdlIGhhZCBhIHB1dElm\nQWJzZW50KCkgbWV0aG9kLCB3ZSB3b3VsZG4ndCBuZWVkIHRvIHN5bmMgaGVy\nZQogICAgICAgIHN5bmNocm9uaXplZCAobykgewogICAgICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKQogICAg\nICAgICAgICAgICAgX3VuZW5oYW5jZWRJbnN0YW5jZU1hcC5nZXQobyk7Cgog\nICAgICAgICAgICBpZiAocGMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBwYzsKCiAgICAgICAgICAgIC8vIGlmIHdlIGRvbid0IGhhdmUgYSBj\nb25mIHBhc3NlZCBpbiwgdGhlbiB3ZSBjYW4ndCBjcmVhdGUgYSBuZXcKICAg\nICAgICAgICAgLy8gUmVmbGVjdGluZ1BDOyB0aGlzIHdpbGwgb25seSBiZSB0\naGUgY2FzZSB3aGVuIGludm9rZWQgZnJvbSBhCiAgICAgICAgICAgIC8vIGNv\nbnRleHQgb3V0c2lkZSBvZiBPcGVuSlBBLgogICAgICAgICAgICBpZiAoY29u\nZiA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgICAgICBwYyA9IG5ldyBSZWZsZWN0aW5nUGVyc2lzdGVuY2VDYXBhYmxl\nKG8sIGNvbmYpOwogICAgICAgICAgICBfdW5lbmhhbmNlZEluc3RhbmNlTWFw\nLnB1dChvLCBwYyk7CiAgICAgICAgICAgIHJldHVybiBwYzsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHN0YXRpYyB2b2lkIHJlZ2lzdGVyUGVyc2lz\ndGVuY2VDYXBhYmxlKAogICAgICAgIFJlZmxlY3RpbmdQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMpIHsKICAgICAgICBfdW5lbmhhbmNlZEluc3RhbmNlTWFwLnB1\ndChwYy5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgcGMpOwogICAgfQoKICAgIC8q\nKgogICAgICogQHJldHVybiB0aGUgdXNlci12aXNpYmxlIHJlcHJlc2VudGF0\naW9uIG9mIDxjb2RlPm88L2NvZGU+LgogICAgICogQHNpbmNlIDEuMC4wCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGdldE1hbmFnZWRJbnN0\nYW5jZShPYmplY3QgbykgewogICAgICAgIGlmIChvIGluc3RhbmNlb2YgTWFu\nYWdlZEluc3RhbmNlUHJvdmlkZXIpCiAgICAgICAgICAgIHJldHVybiAoKE1h\nbmFnZWRJbnN0YW5jZVByb3ZpZGVyKSBvKS5nZXRNYW5hZ2VkSW5zdGFuY2Uo\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBvOwogICAgfQp9\nCg==\n","encoding":"base64"}

