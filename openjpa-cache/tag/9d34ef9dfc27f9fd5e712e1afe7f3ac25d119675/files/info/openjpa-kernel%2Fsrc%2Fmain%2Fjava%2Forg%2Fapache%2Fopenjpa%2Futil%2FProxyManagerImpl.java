{"sha":"3f9e0713b9c1430ccf348f299d7c0b9ade40c850","node_id":"MDQ6QmxvYjIwNjM2NDozZjllMDcxM2I5YzE0MzBjY2YzNDhmMjk5ZDdjMGI5YWRlNDBjODUw","size":61508,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3f9e0713b9c1430ccf348f299d7c0b9ade40c850","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQg\namF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb247CmltcG9ydCBqYXZhLmxh\nbmcucmVmbGVjdC5BcnJheTsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkNv\nbnN0cnVjdG9yOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZh\nLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnNlY3Vy\naXR5LlByaXZpbGVnZWRBY3Rpb247CmltcG9ydCBqYXZhLnNlY3VyaXR5LlBy\naXZpbGVnZWRBY3Rpb25FeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5UaW1l\nc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRhcjsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEu\ndXRpbC5HcmVnb3JpYW5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQg\namF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZFNl\ndDsKaW1wb3J0IGphdmEudXRpbC5UaW1lWm9uZTsKaW1wb3J0IGphdmEudXRp\nbC5UcmVlTWFwOwppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuUXVldWU7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxh\nbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuSmF2YVZlcnNpb25zOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLmNvbmN1cnJlbnQuTnVsbFNhZmVDb25j\ndXJyZW50SGFzaE1hcDsKCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5D\nb25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFz\nczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0\nIHNlcnAuYnl0ZWNvZGUuUHJvamVjdDsKaW1wb3J0IHNlcnAudXRpbC5TdHJp\nbmdzOwoKLyoqCiAqIERlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIHtA\nbGluayBQcm94eU1hbmFnZXJ9IGludGVyZmFjZS4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBQcm94eU1hbmFnZXJJbXBsCiAg\nICBpbXBsZW1lbnRzIFByb3h5TWFuYWdlciB7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgU3RyaW5nIFBST1hZX1NVRkZJWCA9ICIkcHJveHkiOwoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxp\nemVyLmZvclBhY2thZ2UKICAgICAgICAoUHJveHlNYW5hZ2VySW1wbC5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgbG9uZyBfcHJveHlJZCA9IDBMOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwIF9zdGRDb2xsZWN0aW9ucyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBNYXAg\nX3N0ZE1hcHMgPSBuZXcgSGFzaE1hcCgpOwogICAgc3RhdGljIHsKICAgICAg\nICBfc3RkQ29sbGVjdGlvbnMucHV0KENvbGxlY3Rpb24uY2xhc3MsIEFycmF5\nTGlzdC5jbGFzcyk7CiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChTZXQu\nY2xhc3MsIEhhc2hTZXQuY2xhc3MpOwogICAgICAgIF9zdGRDb2xsZWN0aW9u\ncy5wdXQoU29ydGVkU2V0LmNsYXNzLCBUcmVlU2V0LmNsYXNzKTsKICAgICAg\nICBfc3RkQ29sbGVjdGlvbnMucHV0KExpc3QuY2xhc3MsIEFycmF5TGlzdC5j\nbGFzcyk7CiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChRdWV1ZS5jbGFz\ncywgTGlua2VkTGlzdC5jbGFzcyk7CiAgICAgICAgX3N0ZE1hcHMucHV0KE1h\ncC5jbGFzcywgSGFzaE1hcC5jbGFzcyk7CiAgICAgICAgX3N0ZE1hcHMucHV0\nKFNvcnRlZE1hcC5jbGFzcywgVHJlZU1hcC5jbGFzcyk7CiAgICB9CgogICAg\ncHJpdmF0ZSBmaW5hbCBTZXQgX3VucHJveHlhYmxlID0gbmV3IEhhc2hTZXQo\nKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9wcm94aWVzID0gbmV3IE51bGxT\nYWZlQ29uY3VycmVudEhhc2hNYXAoKTsKICAgIHByaXZhdGUgYm9vbGVhbiBf\ndHJhY2tDaGFuZ2VzID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfYXNz\nZXJ0VHlwZSA9IGZhbHNlOwoKICAgIHB1YmxpYyBQcm94eU1hbmFnZXJJbXBs\nKCkgewogICAgICAgIF91bnByb3h5YWJsZS5hZGQoVGltZVpvbmUuY2xhc3Mu\nZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgcHJv\neGllcyBwcm9kdWNlZCBieSB0aGlzIGZhY3Rvcnkgd2lsbCB1c2Uge0BsaW5r\nIENoYW5nZVRyYWNrZXJ9cwogICAgICogdG8gdHJ5IHRvIGN1dCBkb3duIG9u\nIGRhdGEgc3RvcmUgb3BlcmF0aW9ucyBhdCB0aGUgY29zdCBvZiBzb21lIGV4\ndHJhCiAgICAgKiBib29ra2VlcGluZyBvdmVyaGVhZC4gRGVmYXVsdHMgdG8g\ndHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0VHJhY2tDaGFu\nZ2VzKCkgewogICAgICAgIHJldHVybiBfdHJhY2tDaGFuZ2VzOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciBwcm94aWVzIHByb2R1Y2VkIGJ5IHRo\naXMgZmFjdG9yeSB3aWxsIHVzZSB7QGxpbmsgQ2hhbmdlVHJhY2tlcn1zCiAg\nICAgKiB0byB0cnkgdG8gY3V0IGRvd24gb24gZGF0YSBzdG9yZSBvcGVyYXRp\nb25zIGF0IHRoZSBjb3N0IG9mIHNvbWUgZXh0cmEKICAgICAqIGJvb2trZWVw\naW5nIG92ZXJoZWFkLiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRUcmFja0NoYW5nZXMoYm9vbGVhbiB0cmFjaykgewog\nICAgICAgIF90cmFja0NoYW5nZXMgPSB0cmFjazsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gcGVyZm9ybSBydW50aW1lIGNoZWNrcyB0byBl\nbnN1cmUgdGhhdCBhbGwgZWxlbWVudHMKICAgICAqIGFkZGVkIHRvIGNvbGxl\nY3Rpb24gYW5kIG1hcCBwcm94aWVzIGFyZSB0aGUgcHJvcGVyIGVsZW1lbnQv\na2V5L3ZhbHVlCiAgICAgKiB0eXBlIGFzIGRlZmluZWQgYnkgdGhlIG1ldGFk\nYXRhLiBEZWZhdWx0cyB0byBmYWxzZS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZ2V0QXNzZXJ0QWxsb3dlZFR5cGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9hc3NlcnRUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0\nbyBwZXJmb3JtIHJ1bnRpbWUgY2hlY2tzIHRvIGVuc3VyZSB0aGF0IGFsbCBl\nbGVtZW50cwogICAgICogYWRkZWQgdG8gY29sbGVjdGlvbiBhbmQgbWFwIHBy\nb3hpZXMgYXJlIHRoZSBwcm9wZXIgZWxlbWVudC9rZXkvdmFsdWUKICAgICAq\nIHR5cGUgYXMgZGVmaW5lZCBieSB0aGUgbWV0YWRhdGEuIERlZmF1bHRzIHRv\nIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBc3NlcnRBbGxv\nd2VkVHlwZShib29sZWFuIGFzc2VydFR5cGUpIHsKICAgICAgICBfYXNzZXJ0\nVHlwZSA9IGFzc2VydFR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBtdXRhYmxlIHZpZXcgb2YgY2xhc3MgbmFtZXMgd2Uga25vdyBjYW5u\nb3QgYmUgcHJveGllZCAgCiAgICAgKiBjb3JyZWN0bHkgYnkgdGhpcyBtYW5h\nZ2VyLgogICAgICovCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRVbnByb3h5\nYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3VucHJveHlhYmxlOwogICAgfQoK\nICAgIC8qKgogICAgICogUHJvdmlkZWQgZm9yIGF1dG8tY29uZmlndXJhdGlv\nbi4gIEFkZCB0aGUgZ2l2ZW4gc2VtaWNvbG9uLXNlcGFyYXRlZAogICAgICog\nY2xhc3MgbmFtZXMgdG8gdGhlIHNldCBvZiBjbGFzcyBuYW1lcyB3ZSBrbm93\nIGNhbm5vdCBiZSBwcm94aWVkIGNvcnJlY3RseQogICAgICogYnkgdGhpcyBt\nYW5hZ2VyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRVbnByb3h5YWJs\nZShTdHJpbmcgY2xzTmFtZXMpIHsKICAgICAgICBpZiAoY2xzTmFtZXMgIT0g\nbnVsbCkKICAgICAgICAgICAgX3VucHJveHlhYmxlLmFkZEFsbChBcnJheXMu\nYXNMaXN0KFN0cmluZ3Muc3BsaXQoY2xzTmFtZXMsICI7IiwgMCkpKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGNvcHlBcnJheShPYmplY3Qgb3JpZykg\newogICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgbGVuZ3Ro\nID0gQXJyYXkuZ2V0TGVuZ3RoKG9yaWcpOwogICAgICAgICAgICBPYmplY3Qg\nYXJyYXkgPSBBcnJheS5uZXdJbnN0YW5jZShvcmlnLmdldENsYXNzKCkuCiAg\nICAgICAgICAgICAgICBnZXRDb21wb25lbnRUeXBlKCksIGxlbmd0aCk7Cgog\nICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KG9yaWcsIDAsIGFycmF5LCAw\nLCBsZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtYXJyYXkiLAog\nICAgICAgICAgICAgICAgZS5nZXRNZXNzYWdlKCkpLCBlKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gY29weUNvbGxlY3Rpb24o\nQ29sbGVjdGlvbiBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcgaW5z\ndGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgcmV0dXJuIChDb2xsZWN0aW9u\nKSAoKFByb3h5KSBvcmlnKS5jb3B5KG9yaWcpOwoKICAgICAgICBQcm94eUNv\nbGxlY3Rpb24gcHJveHkgPSBnZXRGYWN0b3J5UHJveHlDb2xsZWN0aW9uKG9y\naWcuZ2V0Q2xhc3MoKSk7CiAgICAgICAgcmV0dXJuIChDb2xsZWN0aW9uKSBw\ncm94eS5jb3B5KG9yaWcpOwogICAgfQoKICAgIHB1YmxpYyBQcm94eSBuZXdD\nb2xsZWN0aW9uUHJveHkoQ2xhc3MgdHlwZSwgQ2xhc3MgZWxlbWVudFR5cGUs\nCiAgICAgICAgQ29tcGFyYXRvciBjb21wYXJlKSB7CiAgICAgICAgdHlwZSA9\nIHRvUHJveHlhYmxlQ29sbGVjdGlvblR5cGUodHlwZSk7CiAgICAgICAgUHJv\neHlDb2xsZWN0aW9uIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5Q29sbGVjdGlv\nbih0eXBlKTsKICAgICAgICByZXR1cm4gcHJveHkubmV3SW5zdGFuY2UoKF9h\nc3NlcnRUeXBlKSA/IGVsZW1lbnRUeXBlIDogbnVsbCwgY29tcGFyZSwKICAg\nICAgICAgICAgX3RyYWNrQ2hhbmdlcyk7CiAgICB9CgogICAgcHVibGljIE1h\ncCBjb3B5TWFwKE1hcCBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcg\naW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgcmV0dXJuIChNYXApICgo\nUHJveHkpIG9yaWcpLmNvcHkob3JpZyk7CgogICAgICAgIFByb3h5TWFwIHBy\nb3h5ID0gZ2V0RmFjdG9yeVByb3h5TWFwKG9yaWcuZ2V0Q2xhc3MoKSk7CiAg\nICAgICAgcmV0dXJuIChNYXApIHByb3h5LmNvcHkob3JpZyk7CiAgICB9Cgog\nICAgcHVibGljIFByb3h5IG5ld01hcFByb3h5KENsYXNzIHR5cGUsIENsYXNz\nIGtleVR5cGUsIAogICAgICAgIENsYXNzIGVsZW1lbnRUeXBlLCBDb21wYXJh\ndG9yIGNvbXBhcmUpIHsKICAgICAgICB0eXBlID0gdG9Qcm94eWFibGVNYXBU\neXBlKHR5cGUpOwogICAgICAgIFByb3h5TWFwIHByb3h5ID0gZ2V0RmFjdG9y\neVByb3h5TWFwKHR5cGUpOwogICAgICAgIHJldHVybiBwcm94eS5uZXdJbnN0\nYW5jZSgoX2Fzc2VydFR5cGUpID8ga2V5VHlwZSA6IG51bGwsIAogICAgICAg\nICAgICAoX2Fzc2VydFR5cGUpID8gZWxlbWVudFR5cGUgOiBudWxsLCBjb21w\nYXJlLCBfdHJhY2tDaGFuZ2VzKTsKICAgIH0KCiAgICBwdWJsaWMgRGF0ZSBj\nb3B5RGF0ZShEYXRlIG9yaWcpIHsKICAgICAgICBpZiAob3JpZyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAob3JpZyBp\nbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICByZXR1cm4gKERhdGUpICgo\nUHJveHkpIG9yaWcpLmNvcHkob3JpZyk7CgogICAgICAgIFByb3h5RGF0ZSBw\ncm94eSA9IGdldEZhY3RvcnlQcm94eURhdGUob3JpZy5nZXRDbGFzcygpKTsK\nICAgICAgICByZXR1cm4gKERhdGUpIHByb3h5LmNvcHkob3JpZyk7CiAgICB9\nCgogICAgcHVibGljIFByb3h5IG5ld0RhdGVQcm94eShDbGFzcyB0eXBlKSB7\nCiAgICAgICAgUHJveHlEYXRlIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5RGF0\nZSh0eXBlKTsKICAgICAgICByZXR1cm4gcHJveHkubmV3SW5zdGFuY2UoKTsK\nICAgIH0KCiAgICBwdWJsaWMgQ2FsZW5kYXIgY29weUNhbGVuZGFyKENhbGVu\nZGFyIG9yaWcpIHsKICAgICAgICBpZiAob3JpZyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9m\nIFByb3h5KQogICAgICAgICAgICByZXR1cm4gKENhbGVuZGFyKSAoKFByb3h5\nKSBvcmlnKS5jb3B5KG9yaWcpOwoKICAgICAgICBQcm94eUNhbGVuZGFyIHBy\nb3h5ID0gZ2V0RmFjdG9yeVByb3h5Q2FsZW5kYXIob3JpZy5nZXRDbGFzcygp\nKTsKICAgICAgICByZXR1cm4gKENhbGVuZGFyKSBwcm94eS5jb3B5KG9yaWcp\nOwogICAgfQoKICAgIHB1YmxpYyBQcm94eSBuZXdDYWxlbmRhclByb3h5KENs\nYXNzIHR5cGUsIFRpbWVab25lIHpvbmUpIHsKICAgICAgICBpZiAodHlwZSA9\nPSBDYWxlbmRhci5jbGFzcykKICAgICAgICAgICAgdHlwZSA9IEdyZWdvcmlh\nbkNhbGVuZGFyLmNsYXNzOwogICAgICAgIFByb3h5Q2FsZW5kYXIgcHJveHkg\nPSBnZXRGYWN0b3J5UHJveHlDYWxlbmRhcih0eXBlKTsKICAgICAgICBQcm94\neUNhbGVuZGFyIGNhbCA9IHByb3h5Lm5ld0luc3RhbmNlKCk7CiAgICAgICAg\naWYgKHpvbmUgIT0gbnVsbCkKICAgICAgICAgICAgKChDYWxlbmRhcikgY2Fs\nKS5zZXRUaW1lWm9uZSh6b25lKTsKICAgICAgICByZXR1cm4gY2FsOwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgY29weUN1c3RvbShPYmplY3Qgb3JpZykg\newogICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgUHJveHkpCiAg\nICAgICAgICAgIHJldHVybiAoKFByb3h5KSBvcmlnKS5jb3B5KG9yaWcpOwog\nICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvcmlnKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcgaW5zdGFu\nY2VvZiBDb2xsZWN0aW9uKQogICAgICAgICAgICByZXR1cm4gY29weUNvbGxl\nY3Rpb24oKENvbGxlY3Rpb24pIG9yaWcpOwogICAgICAgIGlmIChvcmlnIGlu\nc3RhbmNlb2YgTWFwKQogICAgICAgICAgICByZXR1cm4gY29weU1hcCgoTWFw\nKSBvcmlnKTsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIERhdGUpCiAg\nICAgICAgICAgIHJldHVybiBjb3B5RGF0ZSgoRGF0ZSkgb3JpZyk7CiAgICAg\nICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBDYWxlbmRhcikKICAgICAgICAgICAg\ncmV0dXJuIGNvcHlDYWxlbmRhcigoQ2FsZW5kYXIpIG9yaWcpOwogICAgICAg\nIFByb3h5QmVhbiBwcm94eSA9IGdldEZhY3RvcnlQcm94eUJlYW4ob3JpZyk7\nCiAgICAgICAgcmV0dXJuIChwcm94eSA9PSBudWxsKSA/IG51bGwgOiBwcm94\neS5jb3B5KG9yaWcpOyAKICAgIH0KCiAgICBwdWJsaWMgUHJveHkgbmV3Q3Vz\ndG9tUHJveHkoT2JqZWN0IG9yaWcpIHsKICAgICAgICBpZiAob3JpZyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAob3Jp\nZyBpbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICByZXR1cm4gKFByb3h5\nKSBvcmlnOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\ncmlnKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9y\naWcgaW5zdGFuY2VvZiBDb2xsZWN0aW9uKSB7CiAgICAgICAgICAgIENvbXBh\ncmF0b3IgY29tcCA9IChvcmlnIGluc3RhbmNlb2YgU29ydGVkU2V0KSAKICAg\nICAgICAgICAgICAgID8gKChTb3J0ZWRTZXQpIG9yaWcpLmNvbXBhcmF0b3Io\nKSA6IG51bGw7CiAgICAgICAgICAgIENvbGxlY3Rpb24gYyA9IChDb2xsZWN0\naW9uKSBuZXdDb2xsZWN0aW9uUHJveHkob3JpZy5nZXRDbGFzcygpLCAKICAg\nICAgICAgICAgICAgIG51bGwsIGNvbXApOyAKICAgICAgICAgICAgYy5hZGRB\nbGwoKENvbGxlY3Rpb24pIG9yaWcpOwogICAgICAgICAgICByZXR1cm4gKFBy\nb3h5KSBjOwogICAgICAgIH0KICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9m\nIE1hcCkgewogICAgICAgICAgICBDb21wYXJhdG9yIGNvbXAgPSAob3JpZyBp\nbnN0YW5jZW9mIFNvcnRlZE1hcCkgCiAgICAgICAgICAgICAgICA/ICgoU29y\ndGVkTWFwKSBvcmlnKS5jb21wYXJhdG9yKCkgOiBudWxsOwogICAgICAgICAg\nICBNYXAgbSA9IChNYXApIG5ld01hcFByb3h5KG9yaWcuZ2V0Q2xhc3MoKSwg\nbnVsbCwgbnVsbCwgY29tcCk7CiAgICAgICAgICAgIG0ucHV0QWxsKChNYXAp\nIG9yaWcpOwogICAgICAgICAgICByZXR1cm4gKFByb3h5KSBtOwogICAgICAg\nIH0KICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIERhdGUpIHsKICAgICAg\nICAgICAgRGF0ZSBkID0gKERhdGUpIG5ld0RhdGVQcm94eShvcmlnLmdldENs\nYXNzKCkpOwogICAgICAgICAgICBkLnNldFRpbWUoKChEYXRlKSBvcmlnKS5n\nZXRUaW1lKCkpOwogICAgICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIFRp\nbWVzdGFtcCkKICAgICAgICAgICAgICAgICgoVGltZXN0YW1wKSBkKS5zZXRO\nYW5vcygoKFRpbWVzdGFtcCkgb3JpZykuZ2V0TmFub3MoKSk7CiAgICAgICAg\nICAgIHJldHVybiAoUHJveHkpIGQ7CiAgICAgICAgfQogICAgICAgIGlmIChv\ncmlnIGluc3RhbmNlb2YgQ2FsZW5kYXIpIHsKICAgICAgICAgICAgQ2FsZW5k\nYXIgYyA9IChDYWxlbmRhcikgbmV3Q2FsZW5kYXJQcm94eShvcmlnLmdldENs\nYXNzKCksCiAgICAgICAgICAgICAgICAoKENhbGVuZGFyKSBvcmlnKS5nZXRU\naW1lWm9uZSgpKTsKICAgICAgICAgICAgYy5zZXRUaW1lSW5NaWxsaXMoKChD\nYWxlbmRhcikgb3JpZykuZ2V0VGltZUluTWlsbGlzKCkpOwogICAgICAgICAg\nICByZXR1cm4gKFByb3h5KSBjOwogICAgICAgIH0KCiAgICAgICAgUHJveHlC\nZWFuIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5QmVhbihvcmlnKTsKICAgICAg\nICByZXR1cm4gKHByb3h5ID09IG51bGwpID8gbnVsbCA6IHByb3h5Lm5ld0lu\nc3RhbmNlKG9yaWcpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBjb25jcmV0ZSB0eXBlIGZvciBwcm94eWluZy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIENsYXNzIHRvUHJveHlhYmxlQ29sbGVjdGlvblR5cGUoQ2xhc3Mg\ndHlwZSkgewogICAgICAgIGlmICh0eXBlLmdldE5hbWUoKS5lbmRzV2l0aChQ\nUk9YWV9TVUZGSVgpKQogICAgICAgICAgICB0eXBlID0gdHlwZS5nZXRTdXBl\ncmNsYXNzKCk7CiAgICAgICAgZWxzZSBpZiAodHlwZS5pc0ludGVyZmFjZSgp\nKSB7CiAgICAgICAgICAgIHR5cGUgPSB0b0NvbmNyZXRlVHlwZSh0eXBlLCBf\nc3RkQ29sbGVjdGlvbnMpOwogICAgICAgICAgICBpZiAodHlwZSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1wcm94eS1pbnRmIiwgdHlwZSkpOwogICAgICAg\nIH0gZWxzZSBpZiAoTW9kaWZpZXIuaXNBYnN0cmFjdCh0eXBlLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1wcm94eS1hYnN0cmFjdCIsIHR5cGUpKTsK\nICAgICAgICByZXR1cm4gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgY29uY3JldGUgdHlwZSBmb3IgcHJveHlpbmcuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBDbGFzcyB0b1Byb3h5YWJsZU1hcFR5cGUoQ2xhc3Mg\ndHlwZSkgewogICAgICAgIGlmICh0eXBlLmdldE5hbWUoKS5lbmRzV2l0aChQ\nUk9YWV9TVUZGSVgpKQogICAgICAgICAgICB0eXBlID0gdHlwZS5nZXRTdXBl\ncmNsYXNzKCk7CiAgICAgICAgZWxzZSBpZiAodHlwZS5pc0ludGVyZmFjZSgp\nKSB7CiAgICAgICAgICAgIHR5cGUgPSB0b0NvbmNyZXRlVHlwZSh0eXBlLCBf\nc3RkTWFwcyk7CiAgICAgICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLXByb3h5LWludGYiLCB0eXBlKSk7CiAgICAgICAgfSBlbHNl\nIGlmIChNb2RpZmllci5pc0Fic3RyYWN0KHR5cGUuZ2V0TW9kaWZpZXJzKCkp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLXByb3h5LWFic3RyYWN0IiwgdHlwZSkpOwogICAgICAg\nIHJldHVybiB0eXBlOwogICAgfQoKICAgIC8qKgogICAgICogTG9jYXRlIGEg\nY29uY3JldGUgdHlwZSB0byBwcm94eSBmb3IgdGhlIGdpdmVuIGNvbGxlY3Rp\nb24gaW50ZXJmYWNlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFz\ncyB0b0NvbmNyZXRlVHlwZShDbGFzcyBpbnRmLCBNYXAgY29uY3JldGVzKSB7\nCiAgICAgICAgQ2xhc3MgY29uY3JldGUgPSAoQ2xhc3MpIGNvbmNyZXRlcy5n\nZXQoaW50Zik7CiAgICAgICAgaWYgKGNvbmNyZXRlICE9IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBjb25jcmV0ZTsKICAgICAgICBDbGFzc1tdIGludGZz\nID0gaW50Zi5nZXRJbnRlcmZhY2VzKCk7ICAgICAgICAgCiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBpbnRmcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBjb25jcmV0ZSA9IHRvQ29uY3JldGVUeXBlKGludGZzW2ldLCBjb25j\ncmV0ZXMpOwogICAgICAgICAgICBpZiAoY29uY3JldGUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBjb25jcmV0ZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG51bGw7IAogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjYWNoZWQgZmFjdG9yeSBwcm94eSBmb3IgdGhlIGdpdmVuIGNvbGxl\nY3Rpb24gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBQcm94eUNvbGxlY3Rp\nb24gZ2V0RmFjdG9yeVByb3h5Q29sbGVjdGlvbihDbGFzcyB0eXBlKSB7CiAg\nICAgICAgLy8gd2UgZG9uJ3QgbG9jayBoZXJlOyBvayBpZiB0d28gcHJveGll\ncyBnZXQgZ2VuZXJhdGVkIGZvciBzYW1lIHR5cGUKICAgICAgICBQcm94eUNv\nbGxlY3Rpb24gcHJveHkgPSAoUHJveHlDb2xsZWN0aW9uKSBfcHJveGllcy5n\nZXQodHlwZSk7CiAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsKICAgICAg\nICAgICAgQ2xhc3NMb2FkZXIgbCA9IEdlbmVyYXRlZENsYXNzZXMuZ2V0TW9z\ndERlcml2ZWRMb2FkZXIodHlwZSwKICAgICAgICAgICAgICAgIFByb3h5Q29s\nbGVjdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIENsYXNzIHBjbHMgPSBsb2Fk\nQnVpbGRUaW1lUHJveHkodHlwZSwgbCk7CiAgICAgICAgICAgIGlmIChwY2xz\nID09IG51bGwpCiAgICAgICAgICAgICAgICBwY2xzID0gR2VuZXJhdGVkQ2xh\nc3Nlcy5sb2FkQkNDbGFzcygKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0\nZVByb3h5Q29sbGVjdGlvbkJ5dGVjb2RlKHR5cGUsIHRydWUpLCBsKTsKICAg\nICAgICAgICAgcHJveHkgPSAoUHJveHlDb2xsZWN0aW9uKSBpbnN0YW50aWF0\nZVByb3h5KHBjbHMsIG51bGwsIG51bGwpOwogICAgICAgICAgICBfcHJveGll\ncy5wdXQodHlwZSwgcHJveHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\ncHJveHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hl\nZCBmYWN0b3J5IHByb3h5IGZvciB0aGUgZ2l2ZW4gbWFwIHR5cGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgUHJveHlNYXAgZ2V0RmFjdG9yeVByb3h5TWFwKENs\nYXNzIHR5cGUpIHsKICAgICAgICAvLyB3ZSBkb24ndCBsb2NrIGhlcmU7IG9r\nIGlmIHR3byBwcm94aWVzIGdldCBnZW5lcmF0ZWQgZm9yIHNhbWUgdHlwZQog\nICAgICAgIFByb3h5TWFwIHByb3h5ID0gKFByb3h5TWFwKSBfcHJveGllcy5n\nZXQodHlwZSk7CiAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsKICAgICAg\nICAgICAgQ2xhc3NMb2FkZXIgbCA9IEdlbmVyYXRlZENsYXNzZXMuZ2V0TW9z\ndERlcml2ZWRMb2FkZXIodHlwZSwKICAgICAgICAgICAgICAgIFByb3h5TWFw\nLmNsYXNzKTsKICAgICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRp\nbWVQcm94eSh0eXBlLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHBjbHMgPSBHZW5lcmF0ZWRDbGFzc2VzLmxv\nYWRCQ0NsYXNzKAogICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlUHJveHlN\nYXBCeXRlY29kZSh0eXBlLCB0cnVlKSwgbCk7CiAgICAgICAgICAgIHByb3h5\nID0gKFByb3h5TWFwKSBpbnN0YW50aWF0ZVByb3h5KHBjbHMsIG51bGwsIG51\nbGwpOwogICAgICAgICAgICBfcHJveGllcy5wdXQodHlwZSwgcHJveHkpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gcHJveHk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBmYWN0b3J5IHByb3h5IGZvciB0\naGUgZ2l2ZW4gZGF0ZSB0eXBlLgogICAgICovCiAgICBwcml2YXRlIFByb3h5\nRGF0ZSBnZXRGYWN0b3J5UHJveHlEYXRlKENsYXNzIHR5cGUpIHsKICAgICAg\nICAvLyB3ZSBkb24ndCBsb2NrIGhlcmU7IG9rIGlmIHR3byBwcm94aWVzIGdl\ndCBnZW5lcmF0ZWQgZm9yIHNhbWUgdHlwZQogICAgICAgIFByb3h5RGF0ZSBw\ncm94eSA9IChQcm94eURhdGUpIF9wcm94aWVzLmdldCh0eXBlKTsKICAgICAg\nICBpZiAocHJveHkgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc0xvYWRl\nciBsID0gR2VuZXJhdGVkQ2xhc3Nlcy5nZXRNb3N0RGVyaXZlZExvYWRlcih0\neXBlLAogICAgICAgICAgICAgICAgUHJveHlEYXRlLmNsYXNzKTsKICAgICAg\nICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRpbWVQcm94eSh0eXBlLCBs\nKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHBjbHMgPSBHZW5lcmF0ZWRDbGFzc2VzLmxvYWRCQ0NsYXNzKAogICAg\nICAgICAgICAgICAgICAgIGdlbmVyYXRlUHJveHlEYXRlQnl0ZWNvZGUodHlw\nZSwgdHJ1ZSksIGwpOwogICAgICAgICAgICBwcm94eSA9IChQcm94eURhdGUp\nIGluc3RhbnRpYXRlUHJveHkocGNscywgbnVsbCwgbnVsbCk7CiAgICAgICAg\nICAgIF9wcm94aWVzLnB1dCh0eXBlLCBwcm94eSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBwcm94eTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY2FjaGVkIGZhY3RvcnkgcHJveHkgZm9yIHRoZSBnaXZlbiBjYWxl\nbmRhciB0eXBlLgogICAgICovCiAgICBwcml2YXRlIFByb3h5Q2FsZW5kYXIg\nZ2V0RmFjdG9yeVByb3h5Q2FsZW5kYXIoQ2xhc3MgdHlwZSkgewogICAgICAg\nIC8vIHdlIGRvbid0IGxvY2sgaGVyZTsgb2sgaWYgdHdvIHByb3hpZXMgZ2V0\nIGdlbmVyYXRlZCBmb3Igc2FtZSB0eXBlCiAgICAgICAgUHJveHlDYWxlbmRh\nciBwcm94eSA9IChQcm94eUNhbGVuZGFyKSBfcHJveGllcy5nZXQodHlwZSk7\nCiAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsKICAgICAgICAgICAgQ2xh\nc3NMb2FkZXIgbCA9IEdlbmVyYXRlZENsYXNzZXMuZ2V0TW9zdERlcml2ZWRM\nb2FkZXIodHlwZSwKICAgICAgICAgICAgICAgIFByb3h5Q2FsZW5kYXIuY2xh\nc3MpOwogICAgICAgICAgICBDbGFzcyBwY2xzID0gbG9hZEJ1aWxkVGltZVBy\nb3h5KHR5cGUsIGwpOwogICAgICAgICAgICBpZiAocGNscyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcGNscyA9IEdlbmVyYXRlZENsYXNzZXMubG9hZEJD\nQ2xhc3MoCiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVQcm94eUNhbGVu\nZGFyQnl0ZWNvZGUodHlwZSwgdHJ1ZSksIGwpOwogICAgICAgICAgICBwcm94\neSA9IChQcm94eUNhbGVuZGFyKSBpbnN0YW50aWF0ZVByb3h5KHBjbHMsIG51\nbGwsIG51bGwpOwogICAgICAgICAgICBfcHJveGllcy5wdXQodHlwZSwgcHJv\neHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJveHk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBmYWN0b3J5IHByb3h5\nIGZvciB0aGUgZ2l2ZW4gYmVhbiB0eXBlLgogICAgICovCiAgICBwcml2YXRl\nIFByb3h5QmVhbiBnZXRGYWN0b3J5UHJveHlCZWFuKE9iamVjdCBvcmlnKSB7\nCiAgICAgICAgZmluYWwgQ2xhc3MgdHlwZSA9IG9yaWcuZ2V0Q2xhc3MoKTsK\nICAgICAgICBpZiAoaXNVbnByb3h5YWJsZSh0eXBlKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIC8vIHdlIGRvbid0IGxvY2sgaGVyZTsg\nb2sgaWYgdHdvIHByb3hpZXMgZ2V0IGdlbmVyYXRlZCBmb3Igc2FtZSB0eXBl\nCiAgICAgICAgUHJveHlCZWFuIHByb3h5ID0gKFByb3h5QmVhbikgX3Byb3hp\nZXMuZ2V0KHR5cGUpOwogICAgICAgIGlmIChwcm94eSA9PSBudWxsICYmICFf\ncHJveGllcy5jb250YWluc0tleSh0eXBlKSkgewogICAgICAgICAgICBDbGFz\nc0xvYWRlciBsID0gR2VuZXJhdGVkQ2xhc3Nlcy5nZXRNb3N0RGVyaXZlZExv\nYWRlcih0eXBlLAogICAgICAgICAgICAgICAgUHJveHlCZWFuLmNsYXNzKTsK\nICAgICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRpbWVQcm94eSh0\neXBlLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgQkNDbGFzcyBiYyA9IChCQ0NsYXNzKSBBY2Nlc3NDb250\ncm9sbGVyCiAgICAgICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChuZXcg\nUHJpdmlsZWdlZEFjdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncHVibGljIE9iamVjdCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZ2VuZXJhdGVQcm94eUJlYW5CeXRlY29kZSh0eXBlLCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKGJjICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgcGNscyA9IEdlbmVyYXRlZENsYXNzZXMubG9h\nZEJDQ2xhc3MoYmMsIGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChwY2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICBwcm94eSA9IChQcm94\neUJlYW4pIGluc3RhbnRpYXRlUHJveHkocGNscywKICAgICAgICAgICAgICAg\nICAgICBmaW5kQ29weUNvbnN0cnVjdG9yKHR5cGUpLCBuZXcgT2JqZWN0W10g\ne29yaWd9KTsKICAgICAgICAgICAgX3Byb3hpZXMucHV0KHR5cGUsIHByb3h5\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb3h5OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHR5cGUgaXMg\na25vd24gdG8gYmUgdW5wcm94eWFibGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzVW5wcm94eWFibGUoQ2xhc3MgdHlwZSkgewogICAgICAg\nIGZvciAoOyB0eXBlICE9IG51bGwgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3M7\nIAogICAgICAgICAgICB0eXBlID0gdHlwZS5nZXRTdXBlcmNsYXNzKCkpIHsK\nICAgICAgICAgICAgaWYgKF91bnByb3h5YWJsZS5jb250YWlucyh0eXBlLmdl\ndE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogTG9hZCB0aGUgcHJveHkgY2xhc3MgZ2VuZXJhdGVkIGF0IGJ1aWxkIHRp\nbWUgZm9yIHRoZSBnaXZlbiB0eXBlLAogICAgICogcmV0dXJuaW5nIG51bGwg\naWYgbm9uZSBleGlzdHMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzcyBs\nb2FkQnVpbGRUaW1lUHJveHkoQ2xhc3MgdHlwZSwgQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNz\nLmZvck5hbWUoZ2V0UHJveHlDbGFzc05hbWUodHlwZSwgZmFsc2UpLCB0cnVl\nLCBsb2FkZXIpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBnaXZlbiBwcm94eSBjbGFzcy4K\nICAgICAqLwogICAgcHJpdmF0ZSBQcm94eSBpbnN0YW50aWF0ZVByb3h5KENs\nYXNzIGNscywgQ29uc3RydWN0b3IgY29ucywgT2JqZWN0W10gYXJncykgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb25zICE9IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gKFByb3h5KSBjbHMuZ2V0Q29uc3RydWN0\nb3IoY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpKS4KICAgICAgICAgICAgICAg\nICAgICBuZXdJbnN0YW5jZShhcmdzKTsKICAgICAgICAgICAgcmV0dXJuIChQ\ncm94eSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjbHMp\nKTsKICAgICAgICB9IGNhdGNoIChJbnN0YW50aWF0aW9uRXhjZXB0aW9uIGll\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbihfbG9jLmdldCgiY2FudC1uZXdpbnN0YW5jZSIsCiAgICAgICAgICAgICAg\nICBjbHMuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpOwogICAgICAgIH0g\nY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24gcGFlKSB7CiAgICAg\nICAgICAgIEV4Y2VwdGlvbiBlID0gcGFlLmdldEV4Y2VwdGlvbigpOwogICAg\nICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEluc3RhbnRpYXRpb25FeGNlcHRp\nb24pCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNl\ncHRpb24oX2xvYy5nZXQoImNhbnQtbmV3aW5zdGFuY2UiLAogICAgICAgICAg\nICAgICAgICAgIGNscy5nZXRTdXBlcmNsYXNzKCkuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGNscy5nZXROYW1lKCkpLnNldENhdXNlKGUpOwogICAg\nICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKGNscy5nZXROYW1lKCkpLnNldENhdXNl\nKHQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRl\nIHRoZSBieXRlY29kZSBmb3IgYSBjb2xsZWN0aW9uIHByb3h5IGZvciB0aGUg\nZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEJDQ2xhc3MgZ2Vu\nZXJhdGVQcm94eUNvbGxlY3Rpb25CeXRlY29kZShDbGFzcyB0eXBlLCAKICAg\nICAgICBib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBhc3NlcnROb3RGaW5h\nbCh0eXBlKTsKICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVj\ndCgpOyAKICAgICAgICBCQ0NsYXNzIGJjID0gKEJDQ2xhc3MpIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAg\nICAgIC5sb2FkUHJvamVjdENsYXNzQWN0aW9uKHByb2plY3QsIGdldFByb3h5\nQ2xhc3NOYW1lKHR5cGUsIHJ1bnRpbWUpKSk7IAogICAgICAgIGJjLnNldFN1\ncGVyY2xhc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFyZUludGVyZmFjZShQ\ncm94eUNvbGxlY3Rpb24uY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25z\ndHJ1Y3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhi\nYywgZmFsc2UpOwogICAgICAgIGFkZFByb3h5Q29sbGVjdGlvbk1ldGhvZHMo\nYmMsIHR5cGUpOwogICAgICAgIHByb3h5UmVjb2duaXplZE1ldGhvZHMoYmMs\nIHR5cGUsIFByb3h5Q29sbGVjdGlvbnMuY2xhc3MsIAogICAgICAgICAgICBQ\ncm94eUNvbGxlY3Rpb24uY2xhc3MpOwogICAgICAgIHByb3h5U2V0dGVycyhi\nYywgdHlwZSk7CiAgICAgICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9kKGJjLCBy\ndW50aW1lKTsKICAgICAgICByZXR1cm4gYmM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIHByb3h5IGNsYXNzIHRvIGdl\nbmVyYXRlIGZvciB0aGUgZ2l2ZW4gdHlwZS4gICAKICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgU3RyaW5nIGdldFByb3h5Q2xhc3NOYW1lKENsYXNzIHR5\ncGUsIGJvb2xlYW4gcnVudGltZSkgewogICAgICAgIFN0cmluZyBpZCA9IChy\ndW50aW1lKSA/ICIkIiArIG5leHRQcm94eUlkKCkgOiAiIjsKICAgICAgICBy\nZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShQcm94eU1hbmFnZXJJbXBs\nLmNsYXNzKSArICIuIiAKICAgICAgICAgICAgKyB0eXBlLmdldE5hbWUoKS5y\nZXBsYWNlKCcuJywgJyQnKSArIGlkICsgUFJPWFlfU1VGRklYOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhyb3cgYXBwcm9wcmlhdGUgZXhjZXB0aW9uIGlm\nIHRoZSBnaXZlbiB0eXBlIGlzIGZpbmFsLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyB2b2lkIGFzc2VydE5vdEZpbmFsKENsYXNzIHR5cGUpIHsKICAg\nICAgICBpZiAoTW9kaWZpZXIuaXNGaW5hbCh0eXBlLmdldE1vZGlmaWVycygp\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1wcm94eS1maW5hbCIsIHR5cGUpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3IgYSBtYXAg\ncHJveHkgZm9yIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgQkNDbGFzcyBnZW5lcmF0ZVByb3h5TWFwQnl0ZWNvZGUoQ2xhc3MgdHlw\nZSwgYm9vbGVhbiBydW50aW1lKSB7CiAgICAgICAgYXNzZXJ0Tm90RmluYWwo\ndHlwZSk7CiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3Qo\nKTsgCiAgICAgICAgQkNDbGFzcyBiYyA9IChCQ0NsYXNzKSBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAg\nICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihwcm9qZWN0LCBnZXRQcm94eUNs\nYXNzTmFtZSh0eXBlLCBydW50aW1lKSkpOyAKICAgICAgICBiYy5zZXRTdXBl\ncmNsYXNzKHR5cGUpOwogICAgICAgIGJjLmRlY2xhcmVJbnRlcmZhY2UoUHJv\neHlNYXAuY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1Y3RvcnMo\nYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywgZmFsc2Up\nOwogICAgICAgIGFkZFByb3h5TWFwTWV0aG9kcyhiYywgdHlwZSk7CiAgICAg\nICAgcHJveHlSZWNvZ25pemVkTWV0aG9kcyhiYywgdHlwZSwgUHJveHlNYXBz\nLmNsYXNzLCBQcm94eU1hcC5jbGFzcyk7CiAgICAgICAgcHJveHlTZXR0ZXJz\nKGJjLCB0eXBlKTsKICAgICAgICBhZGRXcml0ZVJlcGxhY2VNZXRob2QoYmMs\nIHJ1bnRpbWUpOwogICAgICAgIHJldHVybiBiYzsKICAgIH0KCiAgICAvKioK\nICAgICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3IgYSBkYXRlIHByb3h5\nIGZvciB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEJD\nQ2xhc3MgZ2VuZXJhdGVQcm94eURhdGVCeXRlY29kZShDbGFzcyB0eXBlLCBi\nb29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBhc3NlcnROb3RGaW5hbCh0eXBl\nKTsKICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgpOyAK\nICAgICAgICBCQ0NsYXNzIGJjID0gKEJDQ2xhc3MpIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgIC5s\nb2FkUHJvamVjdENsYXNzQWN0aW9uKHByb2plY3QsIGdldFByb3h5Q2xhc3NO\nYW1lKHR5cGUsIHJ1bnRpbWUpKSk7IAogICAgICAgIGJjLnNldFN1cGVyY2xh\nc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFyZUludGVyZmFjZShQcm94eURh\ndGUuY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1Y3RvcnMoYmMs\nIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywgdHJ1ZSk7CiAg\nICAgICAgYWRkUHJveHlEYXRlTWV0aG9kcyhiYywgdHlwZSk7CiAgICAgICAg\ncHJveHlTZXR0ZXJzKGJjLCB0eXBlKTsKICAgICAgICBhZGRXcml0ZVJlcGxh\nY2VNZXRob2QoYmMsIHJ1bnRpbWUpOwogICAgICAgIHJldHVybiBiYzsKICAg\nIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3Ig\nYSBjYWxlbmRhciBwcm94eSBmb3IgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdlbmVyYXRlUHJveHlDYWxlbmRhckJ5\ndGVjb2RlKENsYXNzIHR5cGUsIAogICAgICAgIGJvb2xlYW4gcnVudGltZSkg\newogICAgICAgIGFzc2VydE5vdEZpbmFsKHR5cGUpOwogICAgICAgIFByb2pl\nY3QgcHJvamVjdCA9IG5ldyBQcm9qZWN0KCk7IAogICAgICAgIEJDQ2xhc3Mg\nYmMgPSAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgLmxvYWRQcm9qZWN0Q2xhc3NB\nY3Rpb24ocHJvamVjdCwgZ2V0UHJveHlDbGFzc05hbWUodHlwZSwgcnVudGlt\nZSkpKTsgCiAgICAgICAgYmMuc2V0U3VwZXJjbGFzcyh0eXBlKTsKICAgICAg\nICBiYy5kZWNsYXJlSW50ZXJmYWNlKFByb3h5Q2FsZW5kYXIuY2xhc3MpOwog\nCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1Y3RvcnMoYmMsIHR5cGUpOwogICAg\nICAgIGFkZFByb3h5TWV0aG9kcyhiYywgdHJ1ZSk7CiAgICAgICAgYWRkUHJv\neHlDYWxlbmRhck1ldGhvZHMoYmMsIHR5cGUpOwogICAgICAgIHByb3h5U2V0\ndGVycyhiYywgdHlwZSk7CiAgICAgICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9k\nKGJjLCBydW50aW1lKTsKICAgICAgICByZXR1cm4gYmM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgYnl0ZWNvZGUgZm9yIGEgYmVhbiBw\ncm94eSBmb3IgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBCQ0NsYXNzIGdlbmVyYXRlUHJveHlCZWFuQnl0ZWNvZGUoQ2xhc3MgdHlw\nZSwgYm9vbGVhbiBydW50aW1lKSB7CiAgICAgICAgaWYgKE1vZGlmaWVyLmlz\nRmluYWwodHlwZS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUo\nbnVsbCwgdHlwZSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAvLyB3ZSBjYW4gb25seSBnZW5lcmF0ZSBhIHZhbGlkIHByb3h5IGlmIHRo\nZXJlIGlzIGEgY29weSBjb25zdHJ1Y3RvcgogICAgICAgIC8vIG9yIGEgZGVm\nYXVsdCBjb25zdHJ1Y3RvcgogICAgICAgIENvbnN0cnVjdG9yIGNvbnMgPSBm\naW5kQ29weUNvbnN0cnVjdG9yKHR5cGUpOwogICAgICAgIGlmIChjb25zID09\nIG51bGwpIHsKICAgICAgICAgICAgQ29uc3RydWN0b3JbXSBjcyA9IHR5cGUu\nZ2V0Q29uc3RydWN0b3JzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBjb25zID09IG51bGwgJiYgaSA8IGNzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAgICBpZiAoY3NbaV0uZ2V0UGFyYW1ldGVyVHlwZXMoKS5sZW5ndGgg\nPT0gMCkKICAgICAgICAgICAgICAgICAgICBjb25zID0gY3NbaV07IAogICAg\nICAgICAgICBpZiAoY29ucyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBQcm9qZWN0IHByb2plY3Qg\nPSBuZXcgUHJvamVjdCgpOyAKICAgICAgICBCQ0NsYXNzIGJjID0gKEJDQ2xh\nc3MpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVs\ncGVyCiAgICAgICAgICAgIC5sb2FkUHJvamVjdENsYXNzQWN0aW9uKHByb2pl\nY3QsIGdldFByb3h5Q2xhc3NOYW1lKHR5cGUsIHJ1bnRpbWUpKSk7IAogICAg\nICAgIGJjLnNldFN1cGVyY2xhc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFy\nZUludGVyZmFjZShQcm94eUJlYW4uY2xhc3MpOwogCiAgICAgICAgZGVsZWdh\ndGVDb25zdHJ1Y3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0\naG9kcyhiYywgdHJ1ZSk7CiAgICAgICAgYWRkUHJveHlCZWFuTWV0aG9kcyhi\nYywgdHlwZSwgY29ucyk7CiAgICAgICAgaWYgKCFwcm94eVNldHRlcnMoYmMs\nIHR5cGUpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBhZGRX\ncml0ZVJlcGxhY2VNZXRob2QoYmMsIHJ1bnRpbWUpOwogICAgICAgIHJldHVy\nbiBiYzsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBwYXNzLXRocm91\nZ2ggY29uc3RydWN0b3JzIHRvIGJhc2UgdHlwZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGRlbGVnYXRlQ29uc3RydWN0b3JzKEJDQ2xhc3MgYmMsIENs\nYXNzIHR5cGUpIHsKICAgICAgICBDb25zdHJ1Y3RvcltdIGNvbnMgPSB0eXBl\nLmdldENvbnN0cnVjdG9ycygpOwogICAgICAgIENsYXNzW10gcGFyYW1zOwog\nICAgICAgIEJDTWV0aG9kIG07CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29ucy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBwYXJhbXMgPSBjb25zW2ldLmdldFBhcmFtZXRlclR5cGVzKCk7\nCiAgICAgICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCI8aW5pdD4iLCB2\nb2lkLmNsYXNzLCBwYXJhbXMpOyAKICAgICAgICAgICAgbS5tYWtlUHVibGlj\nKCk7CgogICAgICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBm\nb3IgKGludCBqID0gMDsgaiA8IHBhcmFtcy5sZW5ndGg7IGorKykKICAgICAg\nICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShqKS5zZXRUeXBlKHBh\ncmFtc1tqXSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZChjb25zW2ldKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7\nCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIG1ldGhvZHMgaW4g\ndGhlIHtAbGluayBQcm94eX0gaW50ZXJmYWNlLCB3aXRoIHRoZSBleGNlcHRp\nb24KICAgICAqIG9mIHtAbGluayBQcm94eSNjb3B5fS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gY2hhbmdlVHJhY2tlciB3aGV0aGVyIHRvIGltcGxlbWVudCBh\nIG51bGwgY2hhbmdlIHRyYWNrZXI7IGlmIGZhbHNlCiAgICAgKiB0aGUgY2hh\nbmdlIHRyYWNrZXIgbWV0aG9kIGlzIGxlZnQgdW5pbXBsZW1lbnRlZAogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkUHJveHlNZXRob2RzKEJDQ2xhc3Mg\nYmMsIGJvb2xlYW4gY2hhbmdlVHJhY2tlcikgewogICAgICAgIEJDRmllbGQg\nc20gPSBiYy5kZWNsYXJlRmllbGQoInNtIiwgT3BlbkpQQVN0YXRlTWFuYWdl\nci5jbGFzcyk7CiAgICAgICAgc20uc2V0VHJhbnNpZW50KHRydWUpOwogICAg\nICAgIEJDRmllbGQgZmllbGQgPSBiYy5kZWNsYXJlRmllbGQoImZpZWxkIiwg\naW50LmNsYXNzKTsKICAgICAgICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7\nCgogICAgICAgIEJDTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJzZXRP\nd25lciIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywgaW50LmNsYXNzIH0pOwogICAg\nICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2Rl\nLnB1dGZpZWxkKCkuc2V0RmllbGQoc20pOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDEp\nOwogICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCgogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRPd25lciIsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwogICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoc20pOwogICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBtID0gYmMuZGVj\nbGFyZU1ldGhvZCgiZ2V0T3duZXJGaWVsZCIsIGludC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgY29kZS5pcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7Cgog\nICAgICAgIC8qIAogICAgICAgICAqIGNsb25lIChyZXR1cm4gZGV0YWNoZWQg\ncHJveHkgb2JqZWN0KQogICAgICAgICAqIE5vdGU6ICBUaGlzIG1ldGhvZCBp\ncyBvbmx5IGJlaW5nIHByb3ZpZGVkIHRvIHNhdGlzZnkgYSBxdWlyayB3aXRo\nCiAgICAgICAgICogdGhlIElCTSBKREsgLS0gd2hpbGUgY29tcGFyaW5nIENh\nbGVuZGFyIG9iamVjdHMsIHRoZSBjbG9uZSgpIG1ldGhvZAogICAgICAgICAq\nIHdhcyBpbnZva2VkLiAgU28sIHdlIGFyZSBub3cgb3ZlcnJpZGluZyB0aGUg\nY2xvbmUoKSBtZXRob2Qgc28gYXMgdG8KICAgICAgICAgKiBwcm92aWRlIGEg\nZGV0YWNoZWQgcHJveHkgb2JqZWN0IChudWxsIG91dCB0aGUgU3RhdGVNYW5h\nZ2VyKS4KICAgICAgICAgKi8KICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhv\nZCgiY2xvbmUiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoYmMuZ2V0U3VwZXJjbGFzc1R5cGUo\nKSwgImNsb25lIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVs\nbCk7ICAKICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoUHJveHku\nY2xhc3MpOyAgCiAgICAgICAgaW50IG90aGVyID0gY29kZS5nZXROZXh0TG9j\nYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKG90\naGVyKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob3RoZXIpOwog\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKDApOwogICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKFByb3h5LmNsYXNzLCAic2V0T3duZXIi\nLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBP\ncGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLCBpbnQuY2xhc3MgfSk7CiAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG90aGVyKTsKICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAK\nICAgICAgICBpZiAoY2hhbmdlVHJhY2tlcikgewogICAgICAgICAgICBtID0g\nYmMuZGVjbGFyZU1ldGhvZCgiZ2V0Q2hhbmdlVHJhY2tlciIsIENoYW5nZVRy\nYWNrZXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBtLm1ha2VQdWJsaWMo\nKTsKICAgICAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQg\ndGhlIG1ldGhvZHMgaW4gdGhlIHtAbGluayBQcm94eUNvbGxlY3Rpb259IGlu\ndGVyZmFjZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3h5Q29s\nbGVjdGlvbk1ldGhvZHMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSkgewogICAg\nICAgIC8vIGNoYW5nZSB0cmFja2VyCiAgICAgICAgQkNGaWVsZCBjaGFuZ2VU\ncmFja2VyID0gYmMuZGVjbGFyZUZpZWxkKCJjaGFuZ2VUcmFja2VyIiwgCiAg\nICAgICAgICAgIENvbGxlY3Rpb25DaGFuZ2VUcmFja2VyLmNsYXNzKTsKICAg\nICAgICBjaGFuZ2VUcmFja2VyLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAg\nICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0Q2hhbmdlVHJh\nY2tlciIsIENoYW5nZVRyYWNrZXIuY2xhc3MsIAogICAgICAgICAgICBudWxs\nKTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRo\naXMoKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoY2hhbmdl\nVHJhY2tlcik7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIGNvbGxlY3Rpb24gY29weQogICAg\nICAgIENvbnN0cnVjdG9yIGNvbnMgPSBmaW5kQ29weUNvbnN0cnVjdG9yKHR5\ncGUpOwogICAgICAgIGlmIChjb25zID09IG51bGwgJiYgU29ydGVkU2V0LmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgIGNvbnMg\nPSBmaW5kQ29tcGFyYXRvckNvbnN0cnVjdG9yKHR5cGUpOwogICAgICAgIENs\nYXNzW10gcGFyYW1zID0gKGNvbnMgPT0gbnVsbCkgPyBuZXcgQ2xhc3NbMF0g\nCiAgICAgICAgICAgIDogY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpOwoKICAg\nICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiY29weSIsIE9iamVjdC5jbGFz\ncywgbmV3IENsYXNzW10ge09iamVjdC5jbGFzc30pOwogICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgaWYgKHBhcmFtc1swXSA9PSBDb21wYXJhdG9yLmNsYXNzKSB7CiAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU29ydGVkU2V0\nLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKFNvcnRlZFNldC5jbGFzcywgImNvbXBhcmF0b3IiLCAK\nICAgICAgICAgICAgICAgICAgICBDb21wYXJhdG9yLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsKICAgICAgICB9CiAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4i\nLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwogICAgICAgIGlmIChwYXJhbXMubGVu\nZ3RoID09IDAgfHwgcGFyYW1zWzBdID09IENvbXBhcmF0b3IuY2xhc3MpIHsK\nICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoQ29sbGVjdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAiYWRkQWxsIiwgYm9v\nbGVhbi5jbGFzcywgCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IENv\nbGxlY3Rpb24uY2xhc3MgfSk7CiAgICAgICAgICAgIGNvZGUucG9wKCk7CiAg\nICAgICAgfQogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwoKICAgICAgICAvLyBlbGVtZW50IHR5cGUKICAgICAgICBC\nQ0ZpZWxkIGVsZW1lbnRUeXBlID0gYmMuZGVjbGFyZUZpZWxkKCJlbGVtZW50\nVHlwZSIsIENsYXNzLmNsYXNzKTsKICAgICAgICBlbGVtZW50VHlwZS5zZXRU\ncmFuc2llbnQodHJ1ZSk7CiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2Qo\nImdldEVsZW1lbnRUeXBlIiwgQ2xhc3MuY2xhc3MsIG51bGwpOwogICAgICAg\nIG0ubWFrZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZWxlbWVudFR5cGUpOwogICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAg\nICAgICAvLyBuZXcgaW5zdGFuY2UgZmFjdG9yeQogICAgICAgIG0gPSBiYy5k\nZWNsYXJlTWV0aG9kKCJuZXdJbnN0YW5jZSIsIFByb3h5Q29sbGVjdGlvbi5j\nbGFzcywgCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3Ms\nIENvbXBhcmF0b3IuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAg\nbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShiYyk7IAogICAgICAg\nIGNvZGUuZHVwKCk7CiAgICAgICAgY29ucyA9IGZpbmRDb21wYXJhdG9yQ29u\nc3RydWN0b3IodHlwZSk7CiAgICAgICAgcGFyYW1zID0gKGNvbnMgPT0gbnVs\nbCkgPyBuZXcgQ2xhc3NbMF0gOiBjb25zLmdldFBhcmFtZXRlclR5cGVzKCk7\nCiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgcGFy\nYW1zKTsKICAgICAgICBpbnQgcmV0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5k\nZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKHJldCk7Cgog\nICAgICAgIC8vIHNldCBlbGVtZW50IHR5cGUKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwocmV0KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGVsZW1l\nbnRUeXBlKTsKCiAgICAgICAgLy8gY3JlYXRlIGNoYW5nZSB0cmFja2VyIGFu\nZCBzZXQgaXQKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMik7CiAg\nICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZmVxKCk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHJldCk7CiAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZShDb2xsZWN0aW9uQ2hhbmdlVHJhY2tlckltcGwu\nY2xhc3MpOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKHJldCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGFsbG93c0R1cGxpY2F0ZXModHlwZSkpOwogICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZShpc09yZGVyZWQodHlwZSkpOwogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChDb2xsZWN0aW9uQ2hh\nbmdlVHJhY2tlckltcGwuY2xhc3MsIAogICAgICAgICAgICAiPGluaXQ+Iiwg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBDb2xsZWN0aW9uLmNsYXNzLCAK\nICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsK\nICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoY2hhbmdlVHJhY2tl\ncik7CgogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwocmV0KSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nd2hldGhlciB0aGUgZ2l2ZW4gY29sbGVjdGlvbiB0eXBlIGFsbG93cyBkdXBs\naWNhdGVzLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBhbGxvd3NE\ndXBsaWNhdGVzKENsYXNzIHR5cGUpIHsKICAgICAgICByZXR1cm4gIVNldC5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIGNvbGxlY3Rpb24gdHlw\nZSBtYWludGFpbnMgYW4gYXJ0aWZpY2lhbCAKICAgICAqIG9yZGVyaW5nLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc09yZGVyZWQoQ2xhc3Mg\ndHlwZSkgewogICAgICAgIHJldHVybiBMaXN0LmNsYXNzLmlzQXNzaWduYWJs\nZUZyb20odHlwZSkKICAgICAgICAgICAgfHwgImphdmEudXRpbC5MaW5rZWRI\nYXNoU2V0Ii5lcXVhbHModHlwZS5nZXROYW1lKCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW1wbGVtZW50IHRoZSBtZXRob2RzIGluIHRoZSB7QGxpbmsg\nUHJveHlNYXB9IGludGVyZmFjZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFByb3h5TWFwTWV0aG9kcyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlKSB7\nCiAgICAgICAgLy8gY2hhbmdlIHRyYWNrZXIKICAgICAgICBCQ0ZpZWxkIGNo\nYW5nZVRyYWNrZXIgPSBiYy5kZWNsYXJlRmllbGQoImNoYW5nZVRyYWNrZXIi\nLCAKICAgICAgICAgICAgTWFwQ2hhbmdlVHJhY2tlci5jbGFzcyk7CiAgICAg\nICAgY2hhbmdlVHJhY2tlci5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAg\nQkNNZXRob2QgbSA9IGJjLmRlY2xhcmVNZXRob2QoImdldENoYW5nZVRyYWNr\nZXIiLCBDaGFuZ2VUcmFja2VyLmNsYXNzLCAKICAgICAgICAgICAgbnVsbCk7\nCiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGNoYW5nZVRy\nYWNrZXIpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwoKICAgICAgICAvLyBtYXAgY29weQogICAgICAgIENvbnN0\ncnVjdG9yIGNvbnMgPSBmaW5kQ29weUNvbnN0cnVjdG9yKHR5cGUpOwogICAg\nICAgIGlmIChjb25zID09IG51bGwgJiYgU29ydGVkTWFwLmNsYXNzLmlzQXNz\naWduYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgIGNvbnMgPSBmaW5kQ29t\ncGFyYXRvckNvbnN0cnVjdG9yKHR5cGUpOwogICAgICAgIENsYXNzW10gcGFy\nYW1zID0gKGNvbnMgPT0gbnVsbCkgPyBuZXcgQ2xhc3NbMF0gCiAgICAgICAg\nICAgIDogY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpOwoKICAgICAgICBtID0g\nYmMuZGVjbGFyZU1ldGhvZCgiY29weSIsIE9iamVjdC5jbGFzcywgbmV3IENs\nYXNzW10ge09iamVjdC5jbGFzc30pOwogICAgICAgIG0ubWFrZVB1YmxpYygp\nOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CgogICAgICAgIGNv\nZGUuYW5ldygpLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgaWYgKHBh\ncmFtc1swXSA9PSBDb21wYXJhdG9yLmNsYXNzKSB7CiAgICAgICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU29ydGVkTWFwLmNsYXNzKTsK\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0\naG9kKFNvcnRlZE1hcC5jbGFzcywgImNvbXBhcmF0b3IiLCAKICAgICAgICAg\nICAgICAgICAgICBDb21wYXJhdG9yLmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgfSBlbHNlIAogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKHBhcmFtc1swXSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5j\nbGFzcywgcGFyYW1zKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAw\nIHx8IHBhcmFtc1swXSA9PSBDb21wYXJhdG9yLmNsYXNzKSB7CiAgICAgICAg\nICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKE1hcC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZCh0eXBlLCAicHV0QWxsIiwgdm9pZC5jbGFzcywgCiAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE1hcC5jbGFzcyB9KTsKICAgICAg\nICB9CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIC8vIGtleSB0eXBlCiAgICAgICAgQkNGaWVsZCBr\nZXlUeXBlID0gYmMuZGVjbGFyZUZpZWxkKCJrZXlUeXBlIiwgQ2xhc3MuY2xh\nc3MpOwogICAgICAgIGtleVR5cGUuc2V0VHJhbnNpZW50KHRydWUpOwogICAg\nICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRLZXlUeXBlIiwgQ2xhc3Mu\nY2xhc3MsIG51bGwpOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAg\nIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\na2V5VHlwZSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHZhbHVlIHR5cGUKICAgICAgICBC\nQ0ZpZWxkIHZhbHVlVHlwZSA9IGJjLmRlY2xhcmVGaWVsZCgidmFsdWVUeXBl\nIiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIHZhbHVlVHlwZS5zZXRUcmFuc2ll\nbnQodHJ1ZSk7CiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoImdldFZh\nbHVlVHlwZSIsIENsYXNzLmNsYXNzLCBudWxsKTsKICAgICAgICBtLm1ha2VQ\ndWJsaWMoKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5nZXRm\naWVsZCgpLnNldEZpZWxkKHZhbHVlVHlwZSk7CiAgICAgICAgY29kZS5hcmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIG5l\ndyBpbnN0YW5jZSBmYWN0b3J5CiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRo\nb2QoIm5ld0luc3RhbmNlIiwgUHJveHlNYXAuY2xhc3MsIAogICAgICAgICAg\nICBuZXcgQ2xhc3NbXSB7IENsYXNzLmNsYXNzLCBDbGFzcy5jbGFzcywgQ29t\ncGFyYXRvci5jbGFzcywgCiAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MgfSk7\nCiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShiYyk7\nIAogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgY29ucyA9IGZpbmRDb21w\nYXJhdG9yQ29uc3RydWN0b3IodHlwZSk7CiAgICAgICAgcGFyYW1zID0gKGNv\nbnMgPT0gbnVsbCkgPyBuZXcgQ2xhc3NbMF0gOiBjb25zLmdldFBhcmFtZXRl\nclR5cGVzKCk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMSkKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDIpOwogICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5j\nbGFzcywgcGFyYW1zKTsKICAgICAgICBpbnQgcmV0ID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2Fs\nKHJldCk7CgogICAgICAgIC8vIHNldCBrZXkgYW5kIHZhbHVlIHR5cGVzCiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHJldCk7CiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUucHV0ZmllbGQo\nKS5zZXRGaWVsZChrZXlUeXBlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwocmV0KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7\nCiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKHZhbHVlVHlwZSk7\nCgogICAgICAgIC8vIGNyZWF0ZSBjaGFuZ2UgdHJhY2tlciBhbmQgc2V0IGl0\nCiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDMpOwogICAgICAgIEp1\nbXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpOwogICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUoTWFwQ2hhbmdlVHJhY2tlckltcGwuY2xhc3MpOwogICAgICAg\nIGNvZGUuZHVwKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHJl\ndCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKE1h\ncENoYW5nZVRyYWNrZXJJbXBsLmNsYXNzLCAKICAgICAgICAgICAgIjxpbml0\nPiIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgTWFwLmNsYXNzIH0pOwog\nICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChjaGFuZ2VUcmFja2Vy\nKTsKCiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChyZXQpKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVu\ndCB0aGUgbWV0aG9kcyBpbiB0aGUge0BsaW5rIFByb3h5RGF0ZX0gaW50ZXJm\nYWNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUHJveHlEYXRlTWV0\naG9kcyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlKSB7CiAgICAgICAgYm9vbGVh\nbiBoYXNEZWZhdWx0Q29ucyA9IGJjLmdldERlY2xhcmVkTWV0aG9kKCI8aW5p\ndD4iLCAKICAgICAgICAgICAgKENsYXNzW10pIG51bGwpICE9IG51bGw7CiAg\nICAgICAgYm9vbGVhbiBoYXNNaWxsaXNDb25zID0gYmMuZ2V0RGVjbGFyZWRN\nZXRob2QoIjxpbml0PiIsIAogICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IGxv\nbmcuY2xhc3MgfSkgIT0gbnVsbDsKICAgICAgICBpZiAoIWhhc0RlZmF1bHRD\nb25zICYmICFoYXNNaWxsaXNDb25zKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWRhdGUtY29ucyIs\nIHR5cGUpKTsKCiAgICAgICAgLy8gYWRkIGEgZGVmYXVsdCBjb25zdHJ1Y3Rv\nciB0aGF0IGRlbGVnYXRlcyB0byB0aGUgbWlsbGlzIGNvbnN0cnVjdG9yCiAg\nICAgICAgQkNNZXRob2QgbTsKICAgICAgICBDb2RlIGNvZGU7CiAgICAgICAg\naWYgKCFoYXNEZWZhdWx0Q29ucykgewogICAgICAgICAgICBtID0gYmMuZGVj\nbGFyZU1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgICAgICBjb2RlID0gbS5n\nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChTeXN0ZW0uY2xhc3MsICJjdXJyZW50VGltZU1pbGxpcyIsCiAgICAgICAg\nICAgICAgICBsb25nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLCB2b2lk\nLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBsb25nLmNs\nYXNzIH0pOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOyAgICAgICAgICAgCiAgICAg\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBkYXRlIGNvcHkKICAgICAgICBDb25zdHJ1Y3RvciBjb25z\nID0gZmluZENvcHlDb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBDbGFzc1td\nIHBhcmFtczsKICAgICAgICBpZiAoY29ucyAhPSBudWxsKQogICAgICAgICAg\nICBwYXJhbXMgPSBjb25zLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAg\nZWxzZSBpZiAoaGFzTWlsbGlzQ29ucykKICAgICAgICAgICAgcGFyYW1zID0g\nbmV3IENsYXNzW10geyBsb25nLmNsYXNzIH07CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBwYXJhbXMgPSBuZXcgQ2xhc3NbMF07CgogICAgICAgIG0gPSBi\nYy5kZWNsYXJlTWV0aG9kKCJjb3B5IiwgT2JqZWN0LmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7T2JqZWN0LmNsYXNzfSk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7\nCiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwog\nICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAg\naWYgKHBhcmFtc1swXSA9PSBsb25nLmNsYXNzKSB7CiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRGF0ZS5jbGFzcyk7CiAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRGF0ZS5j\nbGFzcywgImdldFRpbWUiLCAKICAgICAgICAgICAgICAgICAgICBsb25nLmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwYXJhbXNbMF0pOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywgcGFyYW1z\nKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAwKSB7CiAgICAgICAg\nICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKERhdGUuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoRGF0ZS5jbGFzcywgImdldFRpbWUiLCBsb25nLmNsYXNz\nLCAKICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QodHlwZSwgInNldFRpbWUiLCB2b2lk\nLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBsb25nLmNs\nYXNzIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoKHBhcmFtcy5sZW5ndGgg\nPT0gMCB8fCBwYXJhbXNbMF0gPT0gbG9uZy5jbGFzcykgCiAgICAgICAgICAg\nICYmIFRpbWVzdGFtcC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKSB7\nCiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKFRpbWVzdGFtcC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChUaW1lc3RhbXAuY2xhc3MsICJn\nZXROYW5vcyIsIAogICAgICAgICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5\ncGUsICJzZXROYW5vcyIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXSB7IGludC5jbGFzcyB9KTsKICAgICAgICB9CiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIC8vIG5ldyBpbnN0YW5jZSBmYWN0b3J5CiAgICAgICAgbSA9IGJjLmRl\nY2xhcmVNZXRob2QoIm5ld0luc3RhbmNlIiwgUHJveHlEYXRlLmNsYXNzLCBu\ndWxsKTsgCiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9\nIG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKGJjKTsgCiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51\nbGwpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRoZSBt\nZXRob2RzIGluIHRoZSB7QGxpbmsgUHJveHlDYWxlbmRhcn0gaW50ZXJmYWNl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUHJveHlDYWxlbmRhck1l\ndGhvZHMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSkgewogICAgICAgIC8vIGNh\nbGVuZGFyIGNvcHkKICAgICAgICBDb25zdHJ1Y3RvciBjb25zID0gZmluZENv\ncHlDb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9\nIChjb25zID09IG51bGwpID8gbmV3IENsYXNzWzBdIAogICAgICAgICAgICA6\nIGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsKCiAgICAgICAgQkNNZXRob2Qg\nbSA9IGJjLmRlY2xhcmVNZXRob2QoImNvcHkiLCBPYmplY3QuY2xhc3MsIAog\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7T2JqZWN0LmNsYXNzfSk7CiAgICAg\nICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbS5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUp\nOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5n\ndGggPT0gMSkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwYXJh\nbXNbMF0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QodHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBhcmFt\ncyk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMCkgewogICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShDYWxlbmRhci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChDYWxlbmRhci5jbGFzcywgImdldFRpbWVJbk1p\nbGxpcyIsIAogICAgICAgICAgICAgICAgbG9uZy5jbGFzcywgbnVsbCk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBl\nLCAic2V0VGltZUluTWlsbGlzIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdIHsgbG9uZy5jbGFzcyB9KTsKCiAgICAgICAgICAg\nIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENh\nbGVuZGFyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKENhbGVuZGFyLmNsYXNzLCAiaXNMZW5pZW50IiwgCiAg\nICAgICAgICAgICAgICBib29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJzZXRM\nZW5pZW50Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdIHsgYm9vbGVhbi5jbGFzcyB9KTsKCiAgICAgICAgICAgIGNvZGUuZHVw\nKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENhbGVuZGFyLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKENhbGVuZGFyLmNsYXNzLCAiZ2V0Rmlyc3REYXlPZldlZWsiLCAKICAg\nICAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0Rmlyc3RE\nYXlPZldlZWsiLCAKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdIHsgaW50LmNsYXNzIH0pOwoKICAgICAgICAgICAgY29kZS5kdXAo\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ2FsZW5kYXIuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoQ2FsZW5kYXIuY2xhc3MsIAogICAgICAgICAgICAgICAgImdldE1pbmlt\nYWxEYXlzSW5GaXJzdFdlZWsiLCBpbnQuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QodHlwZSwgInNl\ndE1pbmltYWxEYXlzSW5GaXJzdFdlZWsiLCAKICAgICAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgaW50LmNsYXNzIH0pOwoKICAgICAg\nICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoQ2FsZW5kYXIuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoQ2FsZW5kYXIuY2xhc3MsICJnZXRUaW1lWm9u\nZSIsIAogICAgICAgICAgICAgICAgVGltZVpvbmUuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QodHlw\nZSwgInNldFRpbWVab25lIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAg\nIG5ldyBDbGFzc1tdIHsgVGltZVpvbmUuY2xhc3MgfSk7CiAgICAgICAgfQog\nICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwoKICAgICAgICAvLyBuZXcgaW5zdGFuY2UgZmFjdG9yeQogICAgICAgIG0g\nPSBiYy5kZWNsYXJlTWV0aG9kKCJuZXdJbnN0YW5jZSIsIFByb3h5Q2FsZW5k\nYXIuY2xhc3MsIG51bGwpOyAKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAg\nICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYW5l\ndygpLnNldFR5cGUoYmMpOyAKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9p\nZC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHByb3h5IHRoZSBwcm90\nZWN0ZWQgY29tcHV0ZUZpZWxkcyBtZXRob2QgYi9jIGl0IGlzIGNhbGxlZCBv\nbgogICAgICAgIC8vIG11dGF0ZSwgYW5kIHNvbWUgc2V0dGVycyBhcmUgZmlu\nYWwgYW5kIHRoZXJlZm9yZSBub3QgcHJveHlhYmxlCiAgICAgICAgbSA9IGJj\nLmRlY2xhcmVNZXRob2QoImNvbXB1dGVGaWVsZHMiLCB2b2lkLmNsYXNzLCBu\ndWxsKTsKICAgICAgICBtLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBjb2Rl\nID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRU\naGlzKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUp\nOwogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFByb3hp\nZXMuY2xhc3MsICJkaXJ0eSIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5l\ndyBDbGFzc1tdIHsgUHJveHkuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgImNvbXB1dGVGaWVsZHMi\nLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEltcGxlbWVudCB0aGUgbWV0aG9kcyBpbiB0aGUge0BsaW5rIFByb3h5QmVh\nbn0gaW50ZXJmYWNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUHJv\neHlCZWFuTWV0aG9kcyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlLCBDb25zdHJ1\nY3RvciBjb25zKSB7CiAgICAgICAgLy8gYmVhbiBjb3B5CiAgICAgICAgQkNN\nZXRob2QgbSA9IGJjLmRlY2xhcmVNZXRob2QoImNvcHkiLCBPYmplY3QuY2xh\nc3MsIAogICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcyB9\nKTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtLmdldENvZGUodHJ1ZSk7CgogICAgICAgIGNvZGUuYW5ldygpLnNldFR5\ncGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBDbGFzc1td\nIHBhcmFtcyA9IGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICBp\nZiAocGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKHBhcmFtc1swXSk7CiAgICAgICAgfQogICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChjb25zKTsKICAgICAgICBpZiAo\ncGFyYW1zLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBjb3B5UHJvcGVydGll\ncyh0eXBlLCBjb2RlKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gbmV3IGluc3RhbmNlIGZh\nY3RvcnkKICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgibmV3SW5zdGFu\nY2UiLCBQcm94eUJlYW4uY2xhc3MsIAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXSB7IE9iamVjdC5jbGFzcyB9KTsgCiAgICAgICAgbS5tYWtlUHVibGljKCk7\nCiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2Rl\nLmFuZXcoKS5zZXRUeXBlKGJjKTsgCiAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKHBhcmFtc1swXSk7CiAgICAgICAgfQogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9p\nZC5jbGFzcywgcGFyYW1zKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICBjb3B5UHJvcGVydGllcyh0eXBlLCBjb2RlKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgYmVhbiBwcm9wZXJ0aWVz\nLiAgQ2FsbGVkIHdpdGggdGhlIGNvcHkgb2JqZWN0IG9uIHRoZSBzdGFjay4g\nIE11c3QKICAgICAqIHJldHVybiB3aXRoIHRoZSBjb3B5IG9iamVjdCBvbiB0\naGUgc3RhY2suCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjb3B5UHJvcGVy\ndGllcyhDbGFzcyB0eXBlLCBDb2RlIGNvZGUpIHsKICAgICAgICBpbnQgY29w\neSA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5h\nc3RvcmUoKS5zZXRMb2NhbChjb3B5KTsKICAgICAgICAKICAgICAgICBNZXRo\nb2RbXSBtZXRocyA9IHR5cGUuZ2V0TWV0aG9kcygpOwogICAgICAgIE1ldGhv\nZCBnZXR0ZXI7CiAgICAgICAgaW50IG1vZHM7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBtZXRocy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBt\nb2RzID0gbWV0aHNbaV0uZ2V0TW9kaWZpZXJzKCk7IAogICAgICAgICAgICBp\nZiAoIU1vZGlmaWVyLmlzUHVibGljKG1vZHMpIHx8IE1vZGlmaWVyLmlzU3Rh\ndGljKG1vZHMpKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIGlmICghc3RhcnRzV2l0aChtZXRoc1tpXS5nZXROYW1lKCksICJzZXQi\nKQogICAgICAgICAgICAgICAgfHwgbWV0aHNbaV0uZ2V0UGFyYW1ldGVyVHlw\nZXMoKS5sZW5ndGggIT0gMSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICBnZXR0ZXIgPSBmaW5kR2V0dGVyKHR5cGUsIG1ldGhzW2ld\nKTsKICAgICAgICAgICAgaWYgKGdldHRlciA9PSBudWxsKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBjb3B5LnNldFhYWChv\ncmlnLmdldFhYWCgpKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKGNvcHkpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBl\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKGdldHRlcik7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChtZXRoc1tpXSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChjb3B5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFBy\nb3h5IHJlY29nbml6ZWQgbWV0aG9kcyB0byBpbnZva2UgaGVscGVycyBpbiBn\naXZlbiBoZWxwZXIgY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\ncm94eVJlY29nbml6ZWRNZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUs\nIENsYXNzIGhlbHBlciwKICAgICAgICBDbGFzcyBwcm94eVR5cGUpIHsKICAg\nICAgICBNZXRob2RbXSBtZXRocyA9IHR5cGUuZ2V0TWV0aG9kcygpOwogICAg\nICAgIENsYXNzW10gcGFyYW1zOwogICAgICAgIENsYXNzW10gYWZ0ZXJQYXJh\nbXM7CiAgICAgICAgTWV0aG9kIG1hdGNoOwogICAgICAgIE1ldGhvZCBhZnRl\ncjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGhzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIHBhcmFtcyA9IHRvSGVscGVyUGFyYW1ldGVy\ncyhtZXRoc1tpXS5nZXRQYXJhbWV0ZXJUeXBlcygpLCAKICAgICAgICAgICAg\nICAgIHByb3h5VHlwZSk7CgogICAgICAgICAgICAvLyBmaXJzdCBjaGVjayBm\nb3Igb3ZlcnJpZGluZyBtZXRob2QgCiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBtYXRjaCA9IGhlbHBlci5nZXRNZXRob2QobWV0aHNbaV0u\nZ2V0TmFtZSgpLCBwYXJhbXMpOyAKICAgICAgICAgICAgICAgIHByb3h5T3Zl\ncnJpZGVNZXRob2QoYmMsIG1ldGhzW2ldLCBtYXRjaCwgcGFyYW1zKTsKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGNhdGNoIChO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGNoZWNrIGZvciBiZWZvcmUgYW5kIGFmdGVyIG1ldGhvZHMsIGVp\ndGhlciBvZiB3aGljaCBtYXkgbm90CiAgICAgICAgICAgIC8vIGV4aXN0CiAg\nICAgICAgICAgIG1hdGNoID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIG1hdGNoID0gaGVscGVyLmdldE1ldGhvZCgiYmVmb3Jl\nIiAKICAgICAgICAgICAgICAgICAgICArIFN0cmluZ1V0aWxzLmNhcGl0YWxp\nemUobWV0aHNbaV0uZ2V0TmFtZSgpKSwgcGFyYW1zKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGFmdGVyID0gbnVsbDsKICAgICAgICAgICAgYWZ0ZXJQ\nYXJhbXMgPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgYWZ0ZXJQYXJhbXMgPSB0b0hlbHBlckFmdGVyUGFyYW1ldGVycyhwYXJh\nbXMsIAogICAgICAgICAgICAgICAgICAgIG1ldGhzW2ldLmdldFJldHVyblR5\ncGUoKSwgKG1hdGNoID09IG51bGwpIAogICAgICAgICAgICAgICAgICAgID8g\ndm9pZC5jbGFzcyA6IG1hdGNoLmdldFJldHVyblR5cGUoKSk7CiAgICAgICAg\nICAgICAgICBhZnRlciA9IGhlbHBlci5nZXRNZXRob2QoImFmdGVyIiAKICAg\nICAgICAgICAgICAgICAgICArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUobWV0\naHNbaV0uZ2V0TmFtZSgpKSwgYWZ0ZXJQYXJhbXMpOwogICAgICAgICAgICB9\nIGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKG1hdGNoICE9IG51bGwgfHwgYWZ0ZXIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHByb3h5QmVmb3JlQWZ0ZXJNZXRob2QoYmMs\nIHR5cGUsIG1ldGhzW2ldLCBtYXRjaCwgcGFyYW1zLCBhZnRlciwKICAgICAg\nICAgICAgICAgICAgICBhZnRlclBhcmFtcyk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwYXJhbWV0ZXIgdHlwZXMgdG8g\ndGhlIGNvcnJlc3BvbmRpbmcgaGVscGVyIGNsYXNzIG1ldGhvZC4KICAgICAq\nLyAKICAgIHByaXZhdGUgc3RhdGljIENsYXNzW10gdG9IZWxwZXJQYXJhbWV0\nZXJzKENsYXNzW10gY2xzLCBDbGFzcyBoZWxwZXIpIHsKICAgICAgICBDbGFz\nc1tdIHBhcmFtcyA9IG5ldyBDbGFzc1tjbHMubGVuZ3RoICsgMV07CiAgICAg\nICAgcGFyYW1zWzBdID0gaGVscGVyOwogICAgICAgIFN5c3RlbS5hcnJheWNv\ncHkoY2xzLCAwLCBwYXJhbXMsIDEsIGNscy5sZW5ndGgpOyAKICAgICAgICBy\nZXR1cm4gcGFyYW1zOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBwYXJhbWV0ZXIgdHlwZXMgdG8gdGhlIGNvcnJlc3BvbmRpbmcgaGVscGVy\nIGNsYXNzICJhZnRlciIgICAgIAogICAgICogbWV0aG9kLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBDbGFzc1tdIHRvSGVscGVyQWZ0ZXJQYXJhbWV0\nZXJzKENsYXNzW10gY2xzLCBDbGFzcyByZXQsCiAgICAgICAgQ2xhc3MgYmVm\nb3JlUmV0KSB7CiAgICAgICAgaWYgKHJldCA9PSB2b2lkLmNsYXNzICYmIGJl\nZm9yZVJldCA9PSB2b2lkLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gY2xz\nOwogICAgICAgIGludCBsZW4gPSBjbHMubGVuZ3RoOwogICAgICAgIGlmIChy\nZXQgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgbGVuKys7CiAgICAgICAg\naWYgKGJlZm9yZVJldCAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBsZW4r\nKzsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IG5ldyBDbGFzc1tsZW5dOwog\nICAgICAgIFN5c3RlbS5hcnJheWNvcHkoY2xzLCAwLCBwYXJhbXMsIDAsIGNs\ncy5sZW5ndGgpOwogICAgICAgIGludCBwb3MgPSBjbHMubGVuZ3RoOwogICAg\nICAgIGlmIChyZXQgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgcGFyYW1z\nW3BvcysrXSA9IHJldDsKICAgICAgICBpZiAoYmVmb3JlUmV0ICE9IHZvaWQu\nY2xhc3MpCiAgICAgICAgICAgIHBhcmFtc1twb3MrK10gPSBiZWZvcmVSZXQ7\nCiAgICAgICAgcmV0dXJuIHBhcmFtczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFByb3h5IHNldHRlciBtZXRob2RzIG9mIHRoZSBnaXZlbiB0eXBlLgogICAg\nICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgd2UgZmluZCBhbnkgc2V0dGVy\ncywgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBwcm94eVNldHRlcnMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSkgewogICAg\nICAgIE1ldGhvZFtdIG1ldGhzID0gdHlwZS5nZXRNZXRob2RzKCk7CiAgICAg\nICAgaW50IHNldHRlcnMgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbWV0aHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGlzU2V0\ndGVyKG1ldGhzW2ldKSAmJiAhTW9kaWZpZXIuaXNGaW5hbChtZXRoc1tpXS5n\nZXRNb2RpZmllcnMoKSkKICAgICAgICAgICAgICAgICYmIGJjLmdldERlY2xh\ncmVkTWV0aG9kKG1ldGhzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nIG1ldGhzW2ldLmdldFBhcmFtZXRlclR5cGVzKCkpID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIHNldHRlcnMrKzsKICAgICAgICAgICAgICAgIHByb3h5\nU2V0dGVyKGJjLCB0eXBlLCBtZXRoc1tpXSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IAogICAgICAgIHJldHVybiBzZXR0ZXJzID4gMDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFByb3h5IHRoZSBnaXZlbiBtZXRob2Qgd2l0aCBvbmUg\ndGhhdCBvdmVycmlkZXMgaXQgYnkgY2FsbGluZyBpbnRvIHRoZQogICAgICog\nZ2l2ZW4gaGVscGVyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJveHlP\ndmVycmlkZU1ldGhvZChCQ0NsYXNzIGJjLCBNZXRob2QgbWV0aCwgCiAgICAg\nICAgTWV0aG9kIGhlbHBlciwgQ2xhc3NbXSBwYXJhbXMpIHsKICAgICAgICBC\nQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZChtZXRoLmdldE5hbWUoKSwg\nbWV0aC5nZXRSZXR1cm5UeXBlKCksCiAgICAgICAgICAgIG1ldGguZ2V0UGFy\nYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwoKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGZvciAoaW50IGkgPSAxOyBp\nIDwgcGFyYW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2Fk\nKCkuc2V0UGFyYW0oaSAtIDEpLnNldFR5cGUocGFyYW1zW2ldKTsKICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChoZWxwZXIpOwogICAg\nICAgIGNvZGUueHJldHVybigpLnNldFR5cGUobWV0aC5nZXRSZXR1cm5UeXBl\nKCkpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFByb3h5IHRoZSBnaXZlbiBtZXRob2Qgd2l0aCBvbmUgdGhhdCBv\ndmVycmlkZXMgaXQgYnkgY2FsbGluZyBpbnRvIHRoZQogICAgICogZ2l2ZW4g\naGVscGVyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJveHlCZWZvcmVB\nZnRlck1ldGhvZChCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlLCBNZXRob2QgbWV0\naCwgCiAgICAgICAgTWV0aG9kIGJlZm9yZSwgQ2xhc3NbXSBwYXJhbXMsIE1l\ndGhvZCBhZnRlciwgQ2xhc3NbXSBhZnRlclBhcmFtcykgewogICAgICAgIEJD\nTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKG1ldGguZ2V0TmFtZSgpLCBt\nZXRoLmdldFJldHVyblR5cGUoKSwKICAgICAgICAgICAgbWV0aC5nZXRQYXJh\nbWV0ZXJUeXBlcygpKTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAg\nICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlu\ndm9rZSBiZWZvcmUKICAgICAgICBpbnQgYmVmb3JlUmV0ID0gLTE7CiAgICAg\nICAgaWYgKGJlZm9yZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAxOyBp\nIDwgcGFyYW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgY29kZS54\nbG9hZCgpLnNldFBhcmFtKGkgLSAxKS5zZXRUeXBlKHBhcmFtc1tpXSk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKGJlZm9y\nZSk7CiAgICAgICAgICAgIGlmIChhZnRlciAhPSBudWxsICYmIGJlZm9yZS5n\nZXRSZXR1cm5UeXBlKCkgIT0gdm9pZC5jbGFzcykgewogICAgICAgICAgICAg\nICAgYmVmb3JlUmV0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICAgICAgICAgIGNvZGUueHN0b3JlKCkuc2V0TG9jYWwoYmVmb3JlUmV0\nKS4KICAgICAgICAgICAgICAgICAgICBzZXRUeXBlKGJlZm9yZS5nZXRSZXR1\ncm5UeXBlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nLyBpbnZva2Ugc3VwZXIKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDwgcGFyYW1zLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSAtIDEp\nLnNldFR5cGUocGFyYW1zW2ldKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QodHlwZSwgbWV0aC5nZXROYW1lKCksIAogICAgICAg\nICAgICBtZXRoLmdldFJldHVyblR5cGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJU\neXBlcygpKTsKCiAgICAgICAgLy8gaW52b2tlIGFmdGVyIAogICAgICAgIGlm\nIChhZnRlciAhPSBudWxsKSB7CiAgICAgICAgICAgIGludCByZXQgPSAtMTsK\nICAgICAgICAgICAgaWYgKG1ldGguZ2V0UmV0dXJuVHlwZSgpICE9IHZvaWQu\nY2xhc3MpIHsKICAgICAgICAgICAgICAgIHJldCA9IGNvZGUuZ2V0TmV4dExv\nY2Fsc0luZGV4KCk7CiAgICAgICAgICAgICAgICBjb2RlLnhzdG9yZSgpLnNl\ndExvY2FsKHJldCkuc2V0VHlwZShtZXRoLmdldFJldHVyblR5cGUoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCBwYXJhbXMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFy\nYW0oaSAtIDEpLnNldFR5cGUocGFyYW1zW2ldKTsKICAgICAgICAgICAgaWYg\nKHJldCAhPSAtMSkKICAgICAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRM\nb2NhbChyZXQpLnNldFR5cGUobWV0aC5nZXRSZXR1cm5UeXBlKCkpOwogICAg\nICAgICAgICBpZiAoYmVmb3JlUmV0ICE9IC0xKQogICAgICAgICAgICAgICAg\nY29kZS54bG9hZCgpLnNldExvY2FsKGJlZm9yZVJldCkuCiAgICAgICAgICAg\nICAgICAgICAgc2V0VHlwZShiZWZvcmUuZ2V0UmV0dXJuVHlwZSgpKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoYWZ0ZXIp\nOwogICAgICAgIH0KICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKG1l\ndGguZ2V0UmV0dXJuVHlwZSgpKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2\nZW4gbWV0aG9kIGlzIGEgc2V0dGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBpc1NldHRlcihNZXRob2QgbWV0aCkgewogICAgICAgIHJldHVy\nbiBzdGFydHNXaXRoKG1ldGguZ2V0TmFtZSgpLCAic2V0IikKICAgICAgICAg\nICAgfHwgc3RhcnRzV2l0aChtZXRoLmdldE5hbWUoKSwgImFkZCIpCiAgICAg\nICAgICAgIHx8IHN0YXJ0c1dpdGgobWV0aC5nZXROYW1lKCksICJyZW1vdmUi\nKQogICAgICAgICAgICB8fCBzdGFydHNXaXRoKG1ldGguZ2V0TmFtZSgpLCAi\naW5zZXJ0IikKICAgICAgICAgICAgfHwgc3RhcnRzV2l0aChtZXRoLmdldE5h\nbWUoKSwgImNsZWFyIikKICAgICAgICAgICAgfHwgc3RhcnRzV2l0aChtZXRo\nLmdldE5hbWUoKSwgInJvbGwiKTsgLy8gdXNlZCBieSBDYWxlbmRhcgogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBnZXR0ZXIgY29ycmVzcG9u\nZGluZyB0byB0aGUgZ2l2ZW4gc2V0dGVyLCBvciBudWxsLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgTWV0aG9kIGZpbmRHZXR0ZXIoQ2xhc3MgdHlwZSwgTWV0\naG9kIHNldHRlcikgewogICAgICAgIFN0cmluZyBuYW1lID0gc2V0dGVyLmdl\ndE5hbWUoKS5zdWJzdHJpbmcoMyk7CiAgICAgICAgQ2xhc3MgcGFyYW0gPSBz\nZXR0ZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKVswXTsKICAgICAgICBNZXRob2Qg\nZ2V0dGVyOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGdldHRlciA9IHR5\ncGUuZ2V0TWV0aG9kKCJnZXQiICsgbmFtZSwgKENsYXNzW10pIG51bGwpOyAg\nIAogICAgICAgICAgICBpZiAoZ2V0dGVyLmdldFJldHVyblR5cGUoKS5pc0Fz\nc2lnbmFibGVGcm9tKHBhcmFtKQogICAgICAgICAgICAgICAgfHwgcGFyYW0u\naXNBc3NpZ25hYmxlRnJvbShnZXR0ZXIuZ2V0UmV0dXJuVHlwZSgpKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXR0ZXI7CiAgICAgICAgfSBjYXRjaCAo\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CgogICAgICAgIGlmIChwYXJhbSA9\nPSBib29sZWFuLmNsYXNzIHx8IHBhcmFtID09IEJvb2xlYW4uY2xhc3MpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdldHRlciA9IHR5\ncGUuZ2V0TWV0aG9kKCJpcyIgKyBuYW1lLCAoQ2xhc3NbXSkgbnVsbCk7ICAg\nCiAgICAgICAgICAgICAgICBpZiAoZ2V0dGVyLmdldFJldHVyblR5cGUoKS5p\nc0Fzc2lnbmFibGVGcm9tKHBhcmFtKQogICAgICAgICAgICAgICAgICAgIHx8\nIHBhcmFtLmlzQXNzaWduYWJsZUZyb20oZ2V0dGVyLmdldFJldHVyblR5cGUo\nKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldHRlcjsKICAgICAg\nICAgICAgfSBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIG5zbWUpIHsK\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIHRhcmdldCBzdHJp\nbmcgc3RhcnMgd2l0aCB0aGUgZ2l2ZW4gdG9rZW4uCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGJvb2xlYW4gc3RhcnRzV2l0aChTdHJpbmcgc3RyLCBT\ndHJpbmcgdG9rZW4pIHsKICAgICAgICByZXR1cm4gc3RyLnN0YXJ0c1dpdGgo\ndG9rZW4pCiAgICAgICAgICAgICYmIChzdHIubGVuZ3RoKCkgPT0gdG9rZW4u\nbGVuZ3RoKCkgCiAgICAgICAgICAgIHx8IENoYXJhY3Rlci5pc1VwcGVyQ2Fz\nZShzdHIuY2hhckF0KHRva2VuLmxlbmd0aCgpKSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUHJveHkgdGhlIGdpdmVuIHNldHRlciBtZXRob2QgdG8gZGly\ndHkgdGhlIHByb3h5IG93bmVyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncHJveHlTZXR0ZXIoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSwgTWV0aG9kIG1l\ndGgpIHsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IG1ldGguZ2V0UGFyYW1l\ndGVyVHlwZXMoKTsKICAgICAgICBDbGFzcyByZXQgPSBtZXRoLmdldFJldHVy\nblR5cGUoKTsKICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhv\nZChtZXRoLmdldE5hbWUoKSwgcmV0LCBwYXJhbXMpOwogICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChQcm94aWVzLmNsYXNzLCAiZGlydHki\nLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IFByb3h5\nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJh\nbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQ\nYXJhbShpKS5zZXRUeXBlKHBhcmFtc1tpXSk7CiAgICAgICAgY29kZS5pbnZv\na2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsIG1ldGguZ2V0TmFtZSgpLCBy\nZXQsIHBhcmFtcyk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShy\nZXQpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIGEgd3JpdGVSZXBsYWNlIGltcGxlbWVudGF0aW9uIHRoYXQg\nc2VyaWFsaXplcyB0byBhIG5vbi1wcm94eSB0eXBlCiAgICAgKiB1bmxlc3Mg\nZGV0YWNoZWQgYW5kIHRoaXMgaXMgYSBidWlsZC10aW1lIGdlbmVyYXRlZCBj\nbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFdyaXRlUmVwbGFj\nZU1ldGhvZChCQ0NsYXNzIGJjLCBib29sZWFuIHJ1bnRpbWUpIHsKICAgICAg\nICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgid3JpdGVSZXBsYWNl\nIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBtLm1ha2VQcm90ZWN0\nZWQoKTsKICAgICAgICBtLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0\naW9uKE9iamVjdFN0cmVhbUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKCFydW50aW1lKTsKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1l\ndGhvZChQcm94aWVzLmNsYXNzLCAid3JpdGVSZXBsYWNlIiwgCiAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbmV3IENsYXNzW10geyBQcm94eS5jbGFzcywg\nYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIHVuaXF1ZSBpZCB0byBhdm9pZCBwcm94eSBjbGFzcyBuYW1lIGNv\nbmZsaWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgc3luY2hyb25p\nemVkIGxvbmcgbmV4dFByb3h5SWQoKSB7CiAgICAgICAgcmV0dXJuIF9wcm94\neUlkKys7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIGFuIGFwcHJvcHJp\nYXRlIGNvcHkgY29uc3RydWN0b3IgZm9yIHRoZSBnaXZlbiB0eXBlLCBvciBy\nZXR1cm4gbnVsbAogICAgICogaWYgbm9uZS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIENvbnN0cnVjdG9yIGZpbmRDb3B5Q29uc3RydWN0b3IoQ2xhc3MgY2xz\nKSB7CiAgICAgICAgQ29uc3RydWN0b3JbXSBjb25zID0gY2xzLmdldENvbnN0\ncnVjdG9ycygpOwogICAgICAgIENvbnN0cnVjdG9yIG1hdGNoID0gbnVsbDsK\nICAgICAgICBDbGFzcyBtYXRjaFBhcmFtID0gbnVsbDsKICAgICAgICBDbGFz\nc1tdIHBhcmFtczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbnMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcGFyYW1zID0gY29uc1tpXS5n\nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgICAgICBpZiAocGFyYW1zLmxl\nbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICAvLyBxdWl0IGltbWVkaWF0ZWx5IG9uIGV4YWN0IG1hdGNoCiAgICAg\nICAgICAgIGlmIChwYXJhbXNbMF0gPT0gY2xzKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGNvbnNbaV07CgogICAgICAgICAgICBpZiAocGFyYW1zWzBdLmlz\nQXNzaWduYWJsZUZyb20oY2xzKSAmJiAobWF0Y2hQYXJhbSA9PSBudWxsCiAg\nICAgICAgICAgICAgICB8fCBtYXRjaFBhcmFtLmlzQXNzaWduYWJsZUZyb20o\ncGFyYW1zWzBdKSkpIHsKICAgICAgICAgICAgICAgICAvLyB0cmFjayBtb3N0\nIGRlcml2ZWQgY29sbGVjdGlvbiBjb25zdHJ1Y3RvcgogICAgICAgICAgICAg\nICAgbWF0Y2ggPSBjb25zW2ldOwogICAgICAgICAgICAgICAgbWF0Y2hQYXJh\nbSA9IHBhcmFtc1swXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gbWF0Y2g7IAogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjb25zdHJ1Y3RvciB0aGF0IHRha2VzIGEgY29tcGFyYXRvciBmb3Ig\ndGhlIGdpdmVuIHR5cGUsIG9yCiAgICAgKiBudWxsIGlmIG5vbmUuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIENvbnN0cnVjdG9yIGZpbmRDb21wYXJh\ndG9yQ29uc3RydWN0b3IoQ2xhc3MgY2xzKSB7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIGNscy5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3Nb\nXSB7IENvbXBhcmF0b3IuY2xhc3MgfSk7CiAgICAgICAgfSBjYXRjaCAoTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwucHJveHkuUHJveHlNYW5hZ2VySW1wbCBbb3B0aW9u\nXSoKICAgICAqICZsdDtjbGFzcyBuYW1lJmd0Oys8YnIgLz4KICAgICAqIFdo\nZXJlIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgcmVjb2duaXplZDoKICAg\nICAqIDx1bD4gCiAgICAgKiA8bGk+PGk+LXV0aWxzLy11ICZsdDtudW1iZXIm\nZ3Q7PC9pPjogR2VuZXJhdGUgcHJveGllcyBmb3IgdGhlIHN0YW5kYXJkCiAg\nICAgKiBqYXZhLnV0aWwgY29sbGVjdGlvbiwgbWFwLCBkYXRlLCBhbmQgY2Fs\nZW5kYXIgY2xhc3NlcyBvZiB0aGUgZ2l2ZW4gSmF2YQogICAgICogdmVyc2lv\nbi4gIFVzZSA0IGZvciBKYXZhIDEuNCwgNSBmb3IgSmF2YSA1LCBldGMuPC9s\naT4KICAgICAqIDwvdWw+CiAgICAgKgogICAgICogVGhlIG1haW4gbWV0aG9k\nIGdlbmVyYXRlcyAuY2xhc3MgZmlsZXMgZm9yIHRoZSBwcm94aWVzIHRvIHRo\nZSBjbGFzc2VzICAgIAogICAgICogZ2l2ZW4gb24gdGhlIGNvbW1hbmQgbGlu\nZS4gIEl0IHdyaXRlcyB0aGUgZ2VuZXJhdGVkIGNsYXNzZXMgdG8gYmVzaWRl\nIHRoZQogICAgICogUHJveHlNYW5hZ2VySW1wbC5jbGFzcyBmaWxlIGlmIHBv\nc3NpYmxlOyBvdGhlcndpc2UgaXQgd3JpdGVzIHRvIHRoZSAKICAgICAqIGN1\ncnJlbnQgZGlyZWN0b3J5LiAgVGhlIHByb3h5IG1hbmFnZXIgbG9va3MgZm9y\nIHRoZXNlIGNsYXNzZXMgCiAgICAgKiBiZWZvcmUgZ2VuZXJhdGluZyBpdHMg\nb3duIHByb3hpZXMgYXQgcnVudGltZS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgCiAgICAgICAgdGhyb3dz\nIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAg\nICBGaWxlIGRpciA9IEZpbGVzLmdldENsYXNzRmlsZShQcm94eU1hbmFnZXJJ\nbXBsLmNsYXNzKTsKICAgICAgICBkaXIgPSAoZGlyID09IG51bGwpID8gbmV3\nIEZpbGUoKFN0cmluZykgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldFByb3BlcnR5QWN0aW9u\nKCJ1c2VyLmRpciIpKSkKICAgICAgICAgICAgOiBkaXIuZ2V0UGFyZW50Rmls\nZSgpOwoKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwog\nICAgICAgIGFyZ3MgPSBvcHRzLnNldEZyb21DbWRMaW5lKGFyZ3MpOwoKICAg\nICAgICBMaXN0IHR5cGVzID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgIHR5\ncGVzLmFkZEFsbChBcnJheXMuYXNMaXN0KGFyZ3MpKTsKICAgICAgICBpbnQg\ndXRpbHMgPSBvcHRzLnJlbW92ZUludFByb3BlcnR5KCJ1dGlscyIsICJ1Iiwg\nMCk7CiAgICAgICAgaWYgKHV0aWxzID49IDQpIHsKICAgICAgICAgICAgdHlw\nZXMuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdIHsKICAgICAg\nICAgICAgICAgIGphdmEuc3FsLkRhdGUuY2xhc3MuZ2V0TmFtZSgpLAogICAg\nICAgICAgICAgICAgamF2YS5zcWwuVGltZS5jbGFzcy5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICBqYXZhLnNxbC5UaW1lc3RhbXAuY2xhc3MuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgamF2YS51dGlsLkFycmF5TGlzdC5jbGFz\ncy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBqYXZhLnV0aWwuRGF0ZS5j\nbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBqYXZhLnV0aWwuR3Jl\nZ29yaWFuQ2FsZW5kYXIuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgamF2YS51dGlsLkhhc2hNYXAuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgamF2YS51dGlsLkhhc2hTZXQuY2xhc3MuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgamF2YS51dGlsLkhhc2h0YWJsZS5jbGFzcy5nZXRO\nYW1lKCksCiAgICAgICAgICAgICAgICBqYXZhLnV0aWwuTGlua2VkTGlzdC5j\nbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBqYXZhLnV0aWwuUHJv\ncGVydGllcy5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBqYXZh\nLnV0aWwuVHJlZU1hcC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAg\nICBqYXZhLnV0aWwuVHJlZVNldC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICBqYXZhLnV0aWwuVmVjdG9yLmNsYXNzLmdldE5hbWUoKSwKICAg\nICAgICAgICAgfSkpOyAKICAgICAgICB9CiAgICAgICAgaWYgKHV0aWxzID49\nIDUpIHsKICAgICAgICAgICAgdHlwZXMuYWRkQWxsKEFycmF5cy5hc0xpc3Qo\nbmV3IFN0cmluZ1tdIHsKICAgICAgICAgICAgICAgICJqYXZhLnV0aWwuRW51\nbU1hcCIsCiAgICAgICAgICAgICAgICAiamF2YS51dGlsLklkZW50aXR5SGFz\naE1hcCIsCiAgICAgICAgICAgICAgICAiamF2YS51dGlsLkxpbmtlZEhhc2hN\nYXAiLAogICAgICAgICAgICAgICAgImphdmEudXRpbC5MaW5rZWRIYXNoU2V0\nIiwKICAgICAgICAgICAgICAgICJqYXZhLnV0aWwuUHJpb3JpdHlRdWV1ZSIs\nCiAgICAgICAgICAgIH0pKTsgCiAgICAgICAgfQoKICAgICAgICBmaW5hbCBQ\ncm94eU1hbmFnZXJJbXBsIG1nciA9IG5ldyBQcm94eU1hbmFnZXJJbXBsKCk7\nCiAgICAgICAgQ2xhc3MgY2xzOwogICAgICAgIEJDQ2xhc3MgYmM7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0eXBlcy5zaXplKCk7IGkrKykgewog\nICAgICAgICAgICBjbHMgPSBDbGFzcy5mb3JOYW1lKChTdHJpbmcpIHR5cGVz\nLmdldChpKSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBp\nZiAoQ2xhc3MuZm9yTmFtZShnZXRQcm94eUNsYXNzTmFtZShjbHMsIGZhbHNl\nKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBHZW5lcmF0ZWRDbGFzc2Vz\nLmdldE1vc3REZXJpdmVkTG9hZGVyKGNscywgUHJveHkuY2xhc3MpKQogICAg\nICAgICAgICAgICAgICAgICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7\nCiAgICAgICAgICAgICAgICAvLyBleHBlY3RlZCBpZiB0aGUgY2xhc3MgaGFz\nbid0IGJlZW4gZ2VuZXJhdGVkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChDb2xsZWN0aW9uLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkK\nICAgICAgICAgICAgICAgIGJjID0gbWdyLmdlbmVyYXRlUHJveHlDb2xsZWN0\naW9uQnl0ZWNvZGUoY2xzLCBmYWxzZSk7ICAgICAgICAgCiAgICAgICAgICAg\nIGVsc2UgaWYgKE1hcC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykpCiAg\nICAgICAgICAgICAgICBiYyA9IG1nci5nZW5lcmF0ZVByb3h5TWFwQnl0ZWNv\nZGUoY2xzLCBmYWxzZSk7ICAgICAgICAgCiAgICAgICAgICAgIGVsc2UgaWYg\nKERhdGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAg\nICAgICAgYmMgPSBtZ3IuZ2VuZXJhdGVQcm94eURhdGVCeXRlY29kZShjbHMs\nIGZhbHNlKTsKICAgICAgICAgICAgZWxzZSBpZiAoQ2FsZW5kYXIuY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAgICAgICAgYmMgPSBt\nZ3IuZ2VuZXJhdGVQcm94eUNhbGVuZGFyQnl0ZWNvZGUoY2xzLCBmYWxzZSk7\nCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZmluYWwgQ2xh\nc3MgZkNscyA9IGNsczsKICAgICAgICAgICAgICAgIGJjID0gKEJDQ2xhc3Mp\nIEFjY2Vzc0NvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICAuZG9Qcml2\naWxlZ2VkKG5ldyBQcml2aWxlZ2VkQWN0aW9uKCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBwdWJsaWMgT2JqZWN0IHJ1bigpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBtZ3IuZ2VuZXJhdGVQcm94eUJlYW5C\neXRlY29kZShmQ2xzLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKGJjLmdldE5hbWUoKSk7CiAg\nICAgICAgICAgIGJjLndyaXRlKG5ldyBGaWxlKGRpciwgYmMuZ2V0Q2xhc3NO\nYW1lKCkgKyAiLmNsYXNzIikpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

