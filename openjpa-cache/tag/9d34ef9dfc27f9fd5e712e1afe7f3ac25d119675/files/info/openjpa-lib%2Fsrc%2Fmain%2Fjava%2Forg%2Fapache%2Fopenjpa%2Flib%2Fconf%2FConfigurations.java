{"sha":"c61b2bcc5a3eb5ba46f1c6f8f44825977b778595","node_id":"MDQ6QmxvYjIwNjM2NDpjNjFiMmJjYzVhM2ViNWJhNDZmMWM2ZjhmNDQ4MjU5NzdiNzc4NTk1","size":27474,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c61b2bcc5a3eb5ba46f1c6f8f44825977b778595","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmY7CgppbXBvcnQg\namF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5NaXNzaW5nUmVzb3VyY2VFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwu\nUHJvcGVydGllczsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwppbXBvcnQg\namF2YXgubmFtaW5nLkNvbnRleHQ7CmltcG9ydCBqYXZheC5uYW1pbmcuSW5p\ndGlhbENvbnRleHQ7CmltcG9ydCBqYXZheC5uYW1pbmcuTmFtaW5nRXhjZXB0\naW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0\naWxzOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuZXhjZXB0aW9u\nLk5lc3RhYmxlUnVudGltZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5QYXJzZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5TdHJpbmdEaXN0YW5jZTsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFwOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLmNvbmN1cnJlbnQuQ29u\nY3VycmVudFJlZmVyZW5jZUhhc2hNYXA7CmltcG9ydCBzZXJwLnV0aWwuU3Ry\naW5nczsKCi8qKgogKiBVdGlsaXR5IG1ldGhvZHMgZGVhbGluZyB3aXRoIGNv\nbmZpZ3VyYXRpb24uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2ph\ndmFkb2MKICovCnB1YmxpYyBjbGFzcyBDb25maWd1cmF0aW9ucyB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6\nZXIuZm9yUGFja2FnZQogICAgICAgIChDb25maWd1cmF0aW9ucy5jbGFzcyk7\nCiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENvbmN1cnJlbnRSZWZl\ncmVuY2VIYXNoTWFwIF9sb2FkZXJzID0gbmV3CiAgICAgICAgQ29uY3VycmVu\ndFJlZmVyZW5jZUhhc2hNYXAoQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAu\nV0VBSywgCiAgICAgICAgICAgICAgICBDb25jdXJyZW50UmVmZXJlbmNlSGFz\naE1hcC5IQVJEKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Qg\nTlVMTF9MT0FERVIgPSAibnVsbC1sb2FkZXIiOwoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBjbGFzcyBuYW1lIGZyb20gdGhlIGdpdmVuIHBsdWdpbiBz\ndHJpbmcsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBTdHJpbmcgZ2V0Q2xhc3NOYW1lKFN0cmluZyBwbHVnaW4pIHsKICAg\nICAgICByZXR1cm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdpbiwgdHJ1ZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlcnRpZXMg\ncGFydCBvZiB0aGUgZ2l2ZW4gcGx1Z2luIHN0cmluZywgb3IgbnVsbCBpZiBu\nb25lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRQcm9w\nZXJ0aWVzKFN0cmluZyBwbHVnaW4pIHsKICAgICAgICByZXR1cm4gZ2V0UGx1\nZ2luQ29tcG9uZW50KHBsdWdpbiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGVpdGhlciB0aGUgY2xhc3MgbmFtZSBvciBwcm9wZXJ0\naWVzIHN0cmluZyBmcm9tIGEgcGx1Z2luIHN0cmluZy4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFBsdWdpbkNvbXBvbmVudChTdHJp\nbmcgcGx1Z2luLCBib29sZWFuIGNsc05hbWUpIHsKICAgICAgICBpZiAocGx1\nZ2luICE9IG51bGwpCiAgICAgICAgICAgIHBsdWdpbiA9IHBsdWdpbi50cmlt\nKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocGx1Z2luKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGludCBvcGVuUGFy\nZW4gPSAtMTsKICAgICAgICBpZiAocGx1Z2luLmNoYXJBdChwbHVnaW4ubGVu\nZ3RoKCkgLSAxKSA9PSAnKScpCiAgICAgICAgICAgIG9wZW5QYXJlbiA9IHBs\ndWdpbi5pbmRleE9mKCcoJyk7CiAgICAgICAgaWYgKG9wZW5QYXJlbiA9PSAt\nMSkgewogICAgICAgICAgICBpbnQgZXEgPSBwbHVnaW4uaW5kZXhPZignPScp\nOwogICAgICAgICAgICBpZiAoZXEgPT0gLTEpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gKGNsc05hbWUpID8gcGx1Z2luIDogbnVsbDsKICAgICAgICAgICAg\ncmV0dXJuIChjbHNOYW1lKSA/IG51bGwgOiBwbHVnaW47CiAgICAgICAgfQoK\nICAgICAgICAvLyBjbHNOYW1lKHByb3BzKSBmb3JtCiAgICAgICAgaWYgKGNs\nc05hbWUpCiAgICAgICAgICAgIHJldHVybiBwbHVnaW4uc3Vic3RyaW5nKDAs\nIG9wZW5QYXJlbikudHJpbSgpOwogICAgICAgIFN0cmluZyBwcm9wID0gcGx1\nZ2luLnN1YnN0cmluZyhvcGVuUGFyZW4gKyAxLAogICAgICAgICAgICBwbHVn\naW4ubGVuZ3RoKCkgLSAxKS50cmltKCk7CiAgICAgICAgcmV0dXJuIChwcm9w\nLmxlbmd0aCgpID09IDApID8gbnVsbCA6IHByb3A7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGFuZCBwcm9w\nZXJ0aWVzIGludG8gYSBwbHVnaW4gc3RyaW5nLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIFN0cmluZyBnZXRQbHVnaW4oU3RyaW5nIGNsc05hbWUsIFN0\ncmluZyBwcm9wcykgewogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5\nKGNsc05hbWUpKQogICAgICAgICAgICByZXR1cm4gcHJvcHM7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcHMpKQogICAgICAgICAgICBy\nZXR1cm4gY2xzTmFtZTsKICAgICAgICByZXR1cm4gY2xzTmFtZSArICIoIiAr\nIHByb3BzICsgIikiOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\ncGx1Z2luIHN0cmluZyB0aGF0IGNvbWJpbmVzIHRoZSBwcm9wZXJ0aWVzIG9m\nIHRoZSBnaXZlbiBwbHVnaW4KICAgICAqIHN0cmluZ3MsIHdoZXJlIHByb3Bl\ncnRpZXMgb2YgPGNvZGU+b3ZlcnJpZGU8L2NvZGU+IHdpbGwgb3ZlcnJpZGUg\ndGhlCiAgICAgKiBzYW1lIHByb3BlcnRpZXMgb2YgPGNvZGU+b3JpZzwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGNvbWJpbmVQ\nbHVnaW5zKFN0cmluZyBvcmlnLCBTdHJpbmcgb3ZlcnJpZGUpIHsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnKSkKICAgICAgICAgICAg\ncmV0dXJuIG92ZXJyaWRlOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KG92ZXJyaWRlKSkKICAgICAgICAgICAgcmV0dXJuIG9yaWc7CgogICAg\nICAgIFN0cmluZyBvcmlnQ2xzID0gZ2V0Q2xhc3NOYW1lKG9yaWcpOwogICAg\nICAgIFN0cmluZyBvdmVycmlkZUNscyA9IGdldENsYXNzTmFtZShvdmVycmlk\nZSk7CiAgICAgICAgU3RyaW5nIGNsczsKICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShvcmlnQ2xzKSkKICAgICAgICAgICAgY2xzID0gb3ZlcnJp\nZGVDbHM7CiAgICAgICAgZWxzZSBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShv\ndmVycmlkZUNscykpCiAgICAgICAgICAgIGNscyA9IG9yaWdDbHM7CiAgICAg\nICAgZWxzZSBpZiAoIW9yaWdDbHMuZXF1YWxzKG92ZXJyaWRlQ2xzKSkKICAg\nICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOyAvLyBjb21wbGV0ZWx5IGRpZmZl\ncmVudCBwbHVnaW4KICAgICAgICBlbHNlCiAgICAgICAgICAgIGNscyA9IG9y\naWdDbHM7CgogICAgICAgIFN0cmluZyBvcmlnUHJvcHMgPSBnZXRQcm9wZXJ0\naWVzKG9yaWcpOwogICAgICAgIFN0cmluZyBvdmVycmlkZVByb3BzID0gZ2V0\nUHJvcGVydGllcyhvdmVycmlkZSk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkob3JpZ1Byb3BzKSkKICAgICAgICAgICAgcmV0dXJuIGdldFBs\ndWdpbihjbHMsIG92ZXJyaWRlUHJvcHMpOwogICAgICAgIGlmIChTdHJpbmdV\ndGlscy5pc0VtcHR5KG92ZXJyaWRlUHJvcHMpKQogICAgICAgICAgICByZXR1\ncm4gZ2V0UGx1Z2luKGNscywgb3JpZ1Byb3BzKTsKCiAgICAgICAgUHJvcGVy\ndGllcyBwcm9wcyA9IHBhcnNlUHJvcGVydGllcyhvcmlnUHJvcHMpOwogICAg\nICAgIHByb3BzLnB1dEFsbChwYXJzZVByb3BlcnRpZXMob3ZlcnJpZGVQcm9w\ncykpOwogICAgICAgIHJldHVybiBnZXRQbHVnaW4oY2xzLCBzZXJpYWxpemVQ\ncm9wZXJ0aWVzKHByb3BzKSk7IAogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIHRoZSBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiBjbGFzcyBuYW1lLCB1\nc2luZyB0aGUgZ2l2ZW4KICAgICAqIGNsYXNzIGxvYWRlci4gTm8gY29uZmln\ndXJhdGlvbiBvZiB0aGUgaW5zdGFuY2UgaXMgcGVyZm9ybWVkIGJ5CiAgICAg\nKiB0aGlzIG1ldGhvZC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmpl\nY3QgbmV3SW5zdGFuY2UoU3RyaW5nIGNsc05hbWUsIENsYXNzTG9hZGVyIGxv\nYWRlcikgewogICAgICAgIHJldHVybiBuZXdJbnN0YW5jZShjbHNOYW1lLCBu\ndWxsLCBudWxsLCBsb2FkZXIsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGFuZCBjb25maWd1cmUgYW4gaW5zdGFuY2Ugd2l0aCB0aGUg\nZ2l2ZW4gY2xhc3MgbmFtZSBhbmQKICAgICAqIHByb3BlcnRpZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmlu\nZyBjbHNOYW1lLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5n\nIHByb3BzLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBPYmplY3Qg\nb2JqID0gbmV3SW5zdGFuY2UoY2xzTmFtZSwgbnVsbCwgY29uZiwgbG9hZGVy\nLCB0cnVlKTsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYs\nIHByb3BzKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIC8qKgog\nICAgICogSGVscGVyIG1ldGhvZCB1c2VkIGJ5IG1lbWJlcnMgb2YgdGhpcyBw\nYWNrYWdlIHRvIGluc3RhbnRpYXRlIHBsdWdpbgogICAgICogdmFsdWVzLgog\nICAgICovCiAgICBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBj\nbHNOYW1lLCBWYWx1ZSB2YWwsIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAg\nICBDbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4gZmF0YWwpIHsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjbHNOYW1lKSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzIGNscyA9IG51bGw7IAoK\nICAgICAgICB3aGlsZSAoY2xzID09IG51bGwpIHsKICAgICAgICAgICAgLy8g\nY2FuJ3QgaGF2ZSBhIG51bGwgcmVmZXJlbmNlIGluIHRoZSBtYXAsIHNvIHVz\nZSBzeW1ib2xpYwogICAgICAgICAgICAvLyBjb25zdGFudCBhcyBrZXkKICAg\nICAgICAgICAgT2JqZWN0IGtleSA9IGxvYWRlciA9PSBudWxsID8gTlVMTF9M\nT0FERVIgOiBsb2FkZXI7CiAgICAgICAgICAgIE1hcCBsb2FkZXJDYWNoZSA9\nIChNYXApIF9sb2FkZXJzLmdldChrZXkpOwogICAgICAgICAgICBpZiAobG9h\nZGVyQ2FjaGUgPT0gbnVsbCkgeyAvLyBXZSBkb24ndCBoYXZlIGEgY2FjaGUg\nZm9yIHRoaXMgbG9hZGVyLgogICAgICAgICAgICAgICAgbG9hZGVyQ2FjaGUg\nPSBuZXcgQ29uY3VycmVudEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9s\nb2FkZXJzLnB1dChrZXksIGxvYWRlckNhY2hlKTsKICAgICAgICAgICAgfSBl\nbHNlIHsgIC8vIFdlIGhhdmUgYSBjYWNoZSBmb3IgdGhpcyBsb2FkZXIuCiAg\nICAgICAgICAgICAgICBjbHMgPSAoQ2xhc3MpIGxvYWRlckNhY2hlLmdldChj\nbHNOYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNscyA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIGNscyA9IFN0cmluZ3MudG9DbGFzcyhjbHNOYW1lLCBmaW5kRGVy\naXZlZExvYWRlcihjb25mLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbG9hZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgbG9hZGVyQ2FjaGUucHV0\nKGNsc05hbWUsIGNscyk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxv\nYWRlciAhPSBudWxsKSAgLy8gVHJ5IG9uZSBtb3JlIHRpbWUgd2l0aCBsb2Fk\nZXI9bnVsbAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXIgPSBudWxs\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZSA9IGdldENyZWF0ZUV4Y2VwdGlvbihjbHNOYW1lLCB2YWws\nIHJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhdGFsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAg\nICAgICAgICAgICAgIExvZyBsb2cgPSAoY29uZiA9PSBudWxsKSA/IG51bGwg\nOiBjb25mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENv\nbmZpZ3VyYXRpb25Mb2coKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvZyAhPSBudWxsICYmIGxvZy5pc0Vycm9yRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKF9sb2MKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldCgicGx1Z2luLWNyZWF0\naW9uLWV4Y2VwdGlvbiIsIHZhbCksIHJlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICB0cnkgewogICAgICAgICAgICByZXR1cm4gQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5u\nZXdJbnN0YW5jZUFjdGlvbihjbHMpKTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZp\nbGVnZWRBY3Rpb25FeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIGUgPSAo\nKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigp\nOyAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIFJ1bnRpbWVFeGNlcHRp\nb24gcmUgPSBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKF9sb2MuZ2V0\nCiAgICAgICAgICAgICAgICAoIm9iai1jcmVhdGUiLCBjbHMpLmdldE1lc3Nh\nZ2UoKSwgZSk7CiAgICAgICAgICAgIGlmIChmYXRhbCkKICAgICAgICAgICAg\nICAgIHRocm93IHJlOwogICAgICAgICAgICBMb2cgbG9nID0gKGNvbmYgPT0g\nbnVsbCkgPyBudWxsIDogY29uZi5nZXRDb25maWd1cmF0aW9uTG9nKCk7CiAg\nICAgICAgICAgIGlmIChsb2cgIT0gbnVsbCAmJiBsb2cuaXNFcnJvckVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIGxvZy5lcnJvcihfbG9jLmdldCgicGx1\nZ2luLWNyZWF0aW9uLWV4Y2VwdGlvbiIsIHZhbCksIHJlKTsKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQXR0ZW1wdCB0byBmaW5kIGEgZGVyaXZlZCBsb2FkZXIgdGhhdCBkZWxl\nZ2F0ZXMgdG8gb3VyIHRhcmdldCBsb2FkZXIuCiAgICAgKiBUaGlzIGFsbG93\ncyBhcHBsaWNhdGlvbiBsb2FkZXJzIHRoYXQgZGVsZWdhdGUgYXBwcm9wcmlh\ndGVseSBmb3Iga25vd24KICAgICAqIGNsYXNzZXMgZmlyc3QgY3JhY2sgYXQg\nY2xhc3MgbmFtZXMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNz\nTG9hZGVyIGZpbmREZXJpdmVkTG9hZGVyKENvbmZpZ3VyYXRpb24gY29uZiwK\nICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICAvLyB3ZSBh\nbHdheXMgcHJlZmVyIHRoZSB0aHJlYWQgbG9hZGVyLCBiZWNhdXNlIGl0J3Mg\ndGhlIG9ubHkgdGhpbmcgd2UKICAgICAgICAvLyBjYW4gYWNjZXNzIHRoYXQg\naXNuJ3QgYm91bmQgdG8gdGhlIE9wZW5KUEEgY2xhc3Nsb2FkZXIsIHVubGVz\ncwogICAgICAgIC8vIHRoZSBjb25mIG9iamVjdCBpcyBvZiBhIGN1c3RvbSBj\nbGFzcwogICAgICAgIENsYXNzTG9hZGVyIGN0eExvYWRlciA9IChDbGFzc0xv\nYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldENvbnRleHRDbGFzc0xvYWRlckFjdGlv\nbigpKTsKICAgICAgICBpZiAobG9hZGVyID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKGN0eExvYWRlciAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGN0eExvYWRlcjsKICAgICAgICAgICAgaWYgKGNvbmYgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNvbmYuZ2V0Q2xh\nc3MoKSkpOyAKICAgICAgICAgICAgcmV0dXJuIENvbmZpZ3VyYXRpb25zLmNs\nYXNzLmdldENsYXNzTG9hZGVyKCk7CiAgICAgICAgfQoKICAgICAgICBmb3Ig\nKENsYXNzTG9hZGVyIHBhcmVudCA9IGN0eExvYWRlcjsgcGFyZW50ICE9IG51\nbGw7IAogICAgICAgICAgICBwYXJlbnQgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0UGFyZW50QWN0aW9uKHBhcmVudCkpKSB7CiAgICAg\nICAgICAgIGlmIChwYXJlbnQgPT0gbG9hZGVyKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGN0eExvYWRlcjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbmYg\nIT0gbnVsbCkgewogICAgICAgICAgICBmb3IgKENsYXNzTG9hZGVyIHBhcmVu\ndCA9IChDbGFzc0xvYWRlcikKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNvbmYuZ2V0Q2xhc3Mo\nKSkpOyAKICAgICAgICAgICAgICAgIHBhcmVudCAhPSBudWxsOyAKICAgICAg\nICAgICAgICAgIHBhcmVudCA9IChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0UGFyZW50QWN0aW9uKHBhcmVudCkpKSB7CiAgICAgICAg\nICAgICAgICBpZiAocGFyZW50ID09IGxvYWRlcikKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY29uZi5nZXRDbGFzcygpKSk7\nIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBsb2Fk\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBMaXN0PFN0cmlu\nZz4gb2YgYWxsIHRoZSBmdWxseS1xdWFsaWZpZWQgYW5jaG9ycyBzcGVjaWZp\nZWQgaW4gdGhlCiAgICAgKiBwcm9wZXJ0aWVzIGxvY2F0aW9uIGxpc3RlZCBp\nbiA8Y29kZT5vcHRzPC9jb2RlPi4gSWYgbm8gcHJvcGVydGllcwogICAgICog\nbG9jYXRpb24gaXMgbGlzdGVkIGluIDxjb2RlPm9wdHM8L2NvZGU+LCB0aGlz\nIHJldHVybnMgd2hhdGV2ZXIgdGhlCiAgICAgKiBwcm9kdWN0IGRlcml2YXRp\nb25zIGNhbiBmaW5kIGluIHRoZWlyIGRlZmF1bHQgY29uZmlndXJhdGlvbnMu\nCiAgICAgKiBJZiB0aGUgcHJvcGVydGllcyBsb2NhdGlvbiBzcGVjaWZpZWQg\naW4gPGNvZGU+b3B0czwvY29kZT4gYWxyZWFkeQogICAgICogY29udGFpbnMg\nYW4gYW5jaG9yIHNwZWMsIHRoaXMgcmV0dXJucyB0aGF0IGFuY2hvci4gTm90\nZSB0aGF0IGluIHRoaXMKICAgICAqIGZ1bGx5LXF1YWxpZmllZC1pbnB1dCBj\nYXNlLCB0aGUgbG9naWMgaW52b2x2aW5nIHByb2R1Y3QgZGVyaXZhdGlvbnMK\nICAgICAqIGFuZCByZXNvdXJjZSBwYXJzaW5nIGlzIHNob3J0LWNpcmN1aXRl\nZCwgc28gdGhpcyBtZXRob2QKICAgICAqIHNob3VsZCBub3QgYmUgdXNlZCBh\ncyBhIG1lYW5zIHRvIHRlc3QgdGhhdCBhIHBhcnRpY3VsYXIgYW5jaG9yIGlz\nCiAgICAgKiBkZWZpbmVkIGluIGEgZ2l2ZW4gbG9jYXRpb24gYnkgaW52b2tp\nbmcgd2l0aCBhIGZ1bGx5LXF1YWxpZmllZCBhbmNob3IuCiAgICAgKgogICAg\nICogVGhpcyBkb2VzIG5vdCBtdXRhdGUgPGNvZGU+b3B0czwvY29kZT4uCiAg\nICAgKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgTGlzdCBnZXRGdWxseVF1YWxpZmllZEFuY2hvcnNJblByb3BlcnRp\nZXNMb2NhdGlvbigKICAgICAgICBPcHRpb25zIG9wdHMpIHsKICAgICAgICBT\ndHJpbmcgcHJvcHMgPSBvcHRzLmdldFByb3BlcnR5KCJwcm9wZXJ0aWVzIiwg\nInAiLCBudWxsKTsKICAgICAgICBpZiAocHJvcHMgIT0gbnVsbCkgewogICAg\nICAgICAgICBpbnQgYW5jaG9yUG9zaXRpb24gPSBwcm9wcy5pbmRleE9mKCIj\nIik7CiAgICAgICAgICAgIGlmIChhbmNob3JQb3NpdGlvbiA+IC0xKQogICAg\nICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1td\nIHsgcHJvcHMgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gUHJvZHVj\ndERlcml2YXRpb25zLmdldEZ1bGx5UXVhbGlmaWVkQW5jaG9yc0luUHJvcGVy\ndGllc0xvY2F0aW9uKAogICAgICAgICAgICBwcm9wcyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHtAbGluayBDb25maWd1cmF0aW9u\nfSBpbnN0YW5jZSBmcm9tIHRoZSBjb21tYW5kIGxpbmUKICAgICAqIG9wdGlv\nbnMgcHJvdmlkZWQuIEFsbCBwcm9wZXJ0eSBuYW1lcyBvZiB0aGUgZ2l2ZW4g\nY29uZmlndXJhdGlvbiBhcmUKICAgICAqIHJlY29nbml6ZWQ7IGFkZGl0aW9u\nYWxseSwgaWYgYSA8Y29kZT5wcm9wZXJ0aWVzPC9jb2RlPiBvcgogICAgICog\nPGNvZGU+cDwvY29kZT4gYXJndW1lbnQgZXhpc3RzLCB0aGUgcmVzb3VyY2Ug\naXQKICAgICAqIHBvaW50cyB0byB3aWxsIGJlIGxvYWRlZCBhbmQgc2V0IGlu\ndG8gdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gaW5zdGFuY2UuCiAgICAgKiBJ\ndCBjYW4gcG9pbnQgdG8gZWl0aGVyIGEgZmlsZSBvciBhIHJlc291cmNlIG5h\nbWUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBwb3B1bGF0ZUNv\nbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbiBjb25mLCBPcHRpb25zIG9wdHMp\nIHsKICAgICAgICBTdHJpbmcgcHJvcHMgPSBvcHRzLnJlbW92ZVByb3BlcnR5\nKCJwcm9wZXJ0aWVzIiwgInAiLCBudWxsKTsKICAgICAgICBDb25maWd1cmF0\naW9uUHJvdmlkZXIgcHJvdmlkZXI7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KHByb3BzKSkgewogICAgICAgICAgICBTdHJpbmcgcGF0aCA9\nIHByb3BzOwogICAgICAgICAgICBTdHJpbmcgYW5jaG9yID0gbnVsbDsKICAg\nICAgICAgICAgaW50IGlkeCA9IHBhdGgubGFzdEluZGV4T2YoJyMnKTsKICAg\nICAgICAgICAgaWYgKGlkeCAhPSAtMSkgewogICAgICAgICAgICAgICAgaWYg\nKGlkeCA8IHBhdGgubGVuZ3RoKCkgLSAxKQogICAgICAgICAgICAgICAgICAg\nIGFuY2hvciA9IHBhdGguc3Vic3RyaW5nKGlkeCArIDEpOwogICAgICAgICAg\nICAgICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDAsIGlkeCk7CiAgICAgICAg\nICAgICAgICBpZiAocGF0aC5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNaXNzaW5nUmVzb3VyY2VFeGNlcHRpb24oX2xv\nYy5nZXQoImFuY2hvci1vbmx5IiwKICAgICAgICAgICAgICAgICAgICAgICAg\ncHJvcHMpLmdldE1lc3NhZ2UoKSwgQ29uZmlndXJhdGlvbnMuY2xhc3MuZ2V0\nTmFtZSgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHMpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBGaWxlIGZpbGUgPSBuZXcgRmlsZShw\nYXRoKTsKICAgICAgICAgICAgaWYgKCgoQm9vbGVhbikgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAg\nICAgIC5pc0ZpbGVBY3Rpb24oZmlsZSkpKS5ib29sZWFuVmFsdWUoKSkKICAg\nICAgICAgICAgICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxv\nYWQoZmlsZSwgYW5jaG9yLCBudWxsKTsKICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICBmaWxlID0gbmV3IEZpbGUoIk1FVEEtSU5GIiArIEZp\nbGUuc2VwYXJhdG9yQ2hhciArIHBhdGgpOwogICAgICAgICAgICAgICAgaWYg\nKCgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAgICAuaXNGaWxlQWN0aW9u\nKGZpbGUpKSkuYm9vbGVhblZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAg\ncHJvdmlkZXIgPSBQcm9kdWN0RGVyaXZhdGlvbnMubG9hZChmaWxlLCBhbmNo\nb3IsIG51bGwpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxvYWQocGF0\naCwgYW5jaG9yLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAocHJvdmlkZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHByb3ZpZGVy\nLnNldEludG8oY29uZik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNaXNzaW5nUmVzb3VyY2VFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLXByb3ZpZGVyIiwKICAgICAgICAgICAgICAgICAgICBwcm9wcyku\nZ2V0TWVzc2FnZSgpLCBDb25maWd1cmF0aW9ucy5jbGFzcy5nZXROYW1lKCks\nIAogICAgICAgICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBwcm92aWRlciA9IFByb2R1Y3REZXJpdmF0aW9ucy5s\nb2FkRGVmYXVsdHMobnVsbCk7CiAgICAgICAgICAgIGlmIChwcm92aWRlciAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcHJvdmlkZXIuc2V0SW50byhjb25m\nKTsKICAgICAgICB9CiAgICAgICAgb3B0cy5zZXRJbnRvKGNvbmYpOwogICAg\nfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byB0aHJvdyBhbiBp\nbmZvcm1hdGl2ZSBkZXNjcmlwdGlvbiBvbiBpbnN0YW50aWF0aW9uIGVycm9y\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBSdW50aW1lRXhjZXB0aW9u\nIGdldENyZWF0ZUV4Y2VwdGlvbihTdHJpbmcgY2xzTmFtZSwKICAgICAgICBW\nYWx1ZSB2YWwsIEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgLy8gcmUtdGhyb3cg\ndGhlIGV4Y2VwdGlvbiB3aXRoIHNvbWUgYmV0dGVyIGluZm9ybWF0aW9uCiAg\nICAgICAgZmluYWwgU3RyaW5nIG1zZzsKICAgICAgICBmaW5hbCBPYmplY3Rb\nXSBwYXJhbXM7CgogICAgICAgIFN0cmluZyBhbGlhcyA9IHZhbC5hbGlhcyhj\nbHNOYW1lKTsKICAgICAgICBTdHJpbmdbXSBhbGlhc2VzID0gdmFsLmdldEFs\naWFzZXMoKTsKICAgICAgICBTdHJpbmdbXSBrZXlzOwogICAgICAgIGlmIChh\nbGlhc2VzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBrZXlzID0gYWxpYXNl\nczsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAga2V5cyA9IG5ldyBTdHJp\nbmdbYWxpYXNlcy5sZW5ndGggLyAyXTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBhbGlhc2VzLmxlbmd0aDsgaSArPSAyKQogICAgICAgICAg\nICAgICAga2V5c1tpIC8gMl0gPSBhbGlhc2VzW2ldOwogICAgICAgIH0KCiAg\nICAgICAgU3RyaW5nIGNsb3Nlc3Q7CiAgICAgICAgaWYgKGtleXMubGVuZ3Ro\nID09IDApIHsKICAgICAgICAgICAgbXNnID0gImludmFsaWQtcGx1Z2luIjsK\nICAgICAgICAgICAgcGFyYW1zID0gbmV3IE9iamVjdFtdeyB2YWwuZ2V0UHJv\ncGVydHkoKSwgYWxpYXMsIGUudG9TdHJpbmcoKSwgfTsKICAgICAgICB9IGVs\nc2UgaWYgKChjbG9zZXN0ID0gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExl\ndmVuc2h0ZWluRGlzdGFuY2UKICAgICAgICAgICAgKGFsaWFzLCBrZXlzLCAw\nLjVmKSkgPT0gbnVsbCkgewogICAgICAgICAgICBtc2cgPSAiaW52YWxpZC1w\nbHVnaW4tYWxpYXNlcyI7CiAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBPYmpl\nY3RbXXsKICAgICAgICAgICAgICAgIHZhbC5nZXRQcm9wZXJ0eSgpLCBhbGlh\ncywgZS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgbmV3IFRyZWVTZXQo\nQXJyYXlzLmFzTGlzdChrZXlzKSksIH07CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgbXNnID0gImludmFsaWQtcGx1Z2luLWFsaWFzZXMtaGludCI7\nCiAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBPYmplY3RbXXsKICAgICAgICAg\nICAgICAgIHZhbC5nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0cmluZygp\nLAogICAgICAgICAgICAgICAgbmV3IFRyZWVTZXQoQXJyYXlzLmFzTGlzdChr\nZXlzKSksIGNsb3Nlc3QsIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\nZXcgUGFyc2VFeGNlcHRpb24oX2xvYy5nZXQobXNnLCBwYXJhbXMpLCBlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdpdmVuIG9i\namVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAgKiBtYXRj\naGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVjdCdzIHNl\ndHRlcgogICAgICogbWV0aG9kcy4gVGhlIHByb3BlcnRpZXMgc3RyaW5nIHNo\nb3VsZCBiZSBpbiB0aGUgZm9ybQogICAgICogInByb3AxPXZhbDEsIHByb3Ay\nPXZhbDIgLi4uIi4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0ZXIKICAg\nICAqIG1ldGhvZHMgZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgogICAgICoK\nICAgICAqIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0\naW9uIGVycm9yCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25m\naWd1cmVJbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9uIGNvbmYs\nCiAgICAgICAgU3RyaW5nIHByb3BlcnRpZXMpIHsKICAgICAgICBjb25maWd1\ncmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51bGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0\nIHdpdGggdGhlIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1hdGNoaW5n\nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVy\nCiAgICAgKiBtZXRob2RzLiBUaGUgcHJvcGVydGllcyBzdHJpbmcgc2hvdWxk\nIGJlIGluIHRoZSBmb3JtCiAgICAgKiAicHJvcDE9dmFsMSwgcHJvcDI9dmFs\nMiAuLi4iLiBWYWxpZGF0ZXMgdGhhdCBzZXR0ZXIgbWV0aG9kcwogICAgICog\nZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEB0aHJv\nd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVycm9yCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJbnN0YW5j\nZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgU3Ry\naW5nIHByb3BlcnRpZXMsIFN0cmluZyBjb25maWd1cmF0aW9uTmFtZSkgewog\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBQcm9wZXJ0aWVzIHByb3BzID0gbnVsbDsKICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcGVydGllcykpCiAgICAgICAgICAg\nIHByb3BzID0gcGFyc2VQcm9wZXJ0aWVzKHByb3BlcnRpZXMpOwogICAgICAg\nIGNvbmZpZ3VyZUluc3RhbmNlKG9iaiwgY29uZiwgcHJvcHMsIGNvbmZpZ3Vy\nYXRpb25OYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyZXMg\ndGhlIGdpdmVuIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5\nCiAgICAgKiBtYXRjaGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcgdG8gdGhl\nIG9iamVjdCdzIHNldHRlcgogICAgICogbWV0aG9kcy4gRG9lcyBub3QgdmFs\naWRhdGUgdGhhdCBzZXR0ZXIgbWV0aG9kcyBleGlzdCBmb3IgdGhlIHByb3Bl\ncnRpZXMuCiAgICAgKgogICAgICogQHRocm93cyBSdW50aW1lRXhjZXB0aW9u\nIG9uIGNvbmZpZ3VyYXRpb24gZXJyb3IKICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyB2b2lkIGNvbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmosIENvbmZp\nZ3VyYXRpb24gY29uZiwKICAgICAgICBQcm9wZXJ0aWVzIHByb3BlcnRpZXMp\nIHsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3Bl\ncnRpZXMsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlndXJl\ncyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3BlcnRpZXMg\nYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0\naGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBtZXRob2RzLiBJZiA8Y29kZT5j\nb25maWd1cmF0aW9uTmFtZTwvY29kZT4gaXMKICAgICAqIG5vbi08Y29kZT5u\ndWxsPC9jb2RlPiwgdmFsaWRhdGVzIHRoYXQgc2V0dGVyIG1ldGhvZHMgZXhp\nc3QgZm9yCiAgICAgKiB0aGUgcHJvcGVydGllcy4KICAgICAqCiAgICAgKiBA\ndGhyb3dzIFJ1bnRpbWVFeGNlcHRpb24gb24gY29uZmlndXJhdGlvbiBlcnJv\ncgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY29uZmlndXJlSW5z\ndGFuY2UoT2JqZWN0IG9iaiwgQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAg\nIFByb3BlcnRpZXMgcHJvcGVydGllcywgU3RyaW5nIGNvbmZpZ3VyYXRpb25O\nYW1lKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIE9wdGlvbnMgb3B0czsKICAgICAgICBpZiAocHJv\ncGVydGllcyBpbnN0YW5jZW9mIE9wdGlvbnMpCiAgICAgICAgICAgIG9wdHMg\nPSAoT3B0aW9ucykgcHJvcGVydGllczsKICAgICAgICBlbHNlIHsgCiAgICAg\nICAgICAgIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgICAgICBpZiAo\ncHJvcGVydGllcyAhPSBudWxsKQogICAgICAgICAgICAgICAgb3B0cy5wdXRB\nbGwocHJvcGVydGllcyk7CiAgICAgICAgfQoKICAgICAgICBDb25maWd1cmFi\nbGUgY29uZmlndXJhYmxlID0gbnVsbDsKICAgICAgICBpZiAoY29uZiAhPSBu\ndWxsICYmIG9iaiBpbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkKICAgICAgICAg\nICAgY29uZmlndXJhYmxlID0gKENvbmZpZ3VyYWJsZSkgb2JqOwoKICAgICAg\nICBpZiAoY29uZmlndXJhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgY29u\nZmlndXJhYmxlLnNldENvbmZpZ3VyYXRpb24oY29uZik7CiAgICAgICAgICAg\nIGNvbmZpZ3VyYWJsZS5zdGFydENvbmZpZ3VyYXRpb24oKTsKICAgICAgICB9\nCiAgICAgICAgT3B0aW9ucyBpbnZhbGlkRW50cmllcyA9IG9wdHMuc2V0SW50\nbyhvYmopOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBHZW5lcmljQ29u\nZmlndXJhYmxlKQogICAgICAgICAgICAoKEdlbmVyaWNDb25maWd1cmFibGUp\nIG9iaikuc2V0SW50byhpbnZhbGlkRW50cmllcyk7CgoJCWlmICghaW52YWxp\nZEVudHJpZXMuaXNFbXB0eSgpICYmIGNvbmZpZ3VyYXRpb25OYW1lICE9IG51\nbGwpIHsKCQkJTG9jYWxpemVyLk1lc3NhZ2UgbXNnID0gbnVsbDsKCQkJU3Ry\naW5nIGZpcnN0ID0gKFN0cmluZykgaW52YWxpZEVudHJpZXMua2V5U2V0KCku\naXRlcmF0b3IoKS5uZXh0KCk7CgkJCWlmIChpbnZhbGlkRW50cmllcy5rZXlT\nZXQoKS5zaXplKCkgPT0gMSAmJgoJCQkJZmlyc3QuaW5kZXhPZignLicpID09\nIC0xKSB7CgkJCQkvLyBpZiB0aGVyZSdzIGp1c3Qgb25lIG1pc3NwZWxsaW5n\nIGFuZCB0aGlzIGlzIG5vdCBhCgkJCQkvLyBwYXRoIHRyYXZlcnNhbCwgY2hl\nY2sgZm9yIG5lYXIgbWlzc2VzLgoJCQkJQ29sbGVjdGlvbiBvcHRpb25zID0g\nZmluZE9wdGlvbnNGb3Iob2JqLmdldENsYXNzKCkpOwoJCQkJU3RyaW5nIGNs\nb3NlID0gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0ZWluRGlz\ndGFuY2UKCQkJCQkoZmlyc3QsIG9wdGlvbnMsIDAuNzVmKTsKCQkJCWlmIChj\nbG9zZSAhPSBudWxsKQoJCQkJCW1zZyA9IF9sb2MuZ2V0KCJpbnZhbGlkLWNv\nbmZpZy1wYXJhbS1oaW50IiwgbmV3IE9iamVjdFtdewoJCQkJCQljb25maWd1\ncmF0aW9uTmFtZSwgb2JqLmdldENsYXNzKCksIGZpcnN0LCBjbG9zZSwKCQkJ\nCQkJb3B0aW9ucywgfSk7CgkJCX0KCiAgICAgICAgICAgIGlmIChtc2cgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgbXNnID0gX2xvYy5nZXQoImludmFs\naWQtY29uZmlnLXBhcmFtcyIsIG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAg\nICAgICAgICBjb25maWd1cmF0aW9uTmFtZSwgb2JqLmdldENsYXNzKCkuZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgICAgIGludmFsaWRFbnRyaWVzLmtl\neVNldCgpLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgZmluZE9w\ndGlvbnNGb3Iob2JqLmdldENsYXNzKCkpLnRvU3RyaW5nKCksIH0pOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBQYXJzZUV4Y2VwdGlv\nbihtc2cpOwogICAgICAgIH0KICAgICAgICBpZiAoY29uZmlndXJhYmxlICE9\nIG51bGwpCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZS5lbmRDb25maWd1cmF0\naW9uKCk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgQ29sbGVjdGlvbiBm\naW5kT3B0aW9uc0ZvcihDbGFzcyBjbHMpIHsKICAgICAgICBDb2xsZWN0aW9u\nIGMgPSBPcHRpb25zLmZpbmRPcHRpb25zRm9yKGNscyk7CiAgICAgICAgCiAg\nICAgICAgLy8gcmVtb3ZlIENvbmZpZ3VyYWJsZS5zZXRDb25maWd1cmF0aW9u\nKCkgYW5kIAogICAgICAgIC8vIEdlbmVyaWNDb25maWd1cmFibGUuc2V0SW50\nbygpIGZyb20gdGhlIHNldCwgaWYgYXBwbGljYWJsZS4KICAgICAgICBpZiAo\nQ29uZmlndXJhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkKICAg\nICAgICAgICAgYy5yZW1vdmUoIkNvbmZpZ3VyYXRpb24iKTsKICAgICAgICBp\nZiAoR2VuZXJpY0NvbmZpZ3VyYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9t\nKGNscykpCiAgICAgICAgICAgIGMucmVtb3ZlKCJJbnRvIik7CiAgICAgICAg\nCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUdXJu\nIGEgc2V0IG9mIHByb3BlcnRpZXMgaW50byBhIGNvbW1hLXNlcGFyYXRlZCBz\ndHJpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIHNlcmlh\nbGl6ZVByb3BlcnRpZXMoTWFwIG1hcCkgewogICAgICAgIGlmIChtYXAgPT0g\nbnVsbCB8fCBtYXAuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZm\nZXIoKTsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgU3RyaW5n\nIHZhbDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\naWYgKGJ1Zi5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCIsICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGVudHJ5LmdldEtl\neSgpKS5hcHBlbmQoJz0nKTsKICAgICAgICAgICAgdmFsID0gU3RyaW5nLnZh\nbHVlT2YoZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIGlmICh2YWwu\naW5kZXhPZignLCcpICE9IC0xKQogICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZCgnIicpLmFwcGVuZCh2YWwpLmFwcGVuZCgnIicpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKHZhbCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIGEgc2V0IG9mIHByb3BlcnRpZXMgZnJvbSBhIGNv\nbW1hLXNlcGFyYXRlZCBzdHJpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgT3B0aW9ucyBwYXJzZVByb3BlcnRpZXMoU3RyaW5nIHByb3BlcnRpZXMp\nIHsKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAg\nICAgIHByb3BlcnRpZXMgPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKHByb3Bl\ncnRpZXMpOwogICAgICAgIGlmIChwcm9wZXJ0aWVzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBvcHRzOwoKICAgICAgICB0cnkgewogICAgICAgICAg\nICBTdHJpbmdbXSBwcm9wcyA9IFN0cmluZ3Muc3BsaXQocHJvcGVydGllcywg\nIiwiLCAwKTsKICAgICAgICAgICAgaW50IGlkeDsKICAgICAgICAgICAgY2hh\nciBxdW90ZTsKICAgICAgICAgICAgU3RyaW5nIHByb3A7CiAgICAgICAgICAg\nIFN0cmluZyB2YWw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\ncHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlkeCA9IHBy\nb3BzW2ldLmluZGV4T2YoJz0nKTsKICAgICAgICAgICAgICAgIGlmIChpZHgg\nPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUga2V5IGlz\nIG5vdCBhc3NpZ25lZCB0byBhbnkgdmFsdWUsIHNldCB0aGUKICAgICAgICAg\nICAgICAgICAgICAvLyB2YWx1ZSB0byB0aGUgc2FtZSB0aGluZyBhcyB0aGUg\na2V5LCBhbmQgY29udGludWUuCiAgICAgICAgICAgICAgICAgICAgLy8gVGhp\ncyBwZXJtaXRzIEdlbmVyaWNDb25maWd1cmFibGUgaW5zdGFuY2VzIHRvCiAg\nICAgICAgICAgICAgICAgICAgLy8gYmVoYXZlIG1lYW5pbmdmdWxseS4gV2Ug\nbWlnaHQgY29uc2lkZXIgc2V0dGluZyB0aGUKICAgICAgICAgICAgICAgICAg\nICAvLyB2YWx1ZSB0byBzb21lIHdlbGwta25vd24gInZhbHVlIHdhcyBub3Qg\nc2V0LCBidXQKICAgICAgICAgICAgICAgICAgICAvLyBrZXkgaXMgcHJlc2Vu\ndCIgc3RyaW5nIHNvIHRoYXQgaW5zdGFuY2VzIGdldHRpbmcKICAgICAgICAg\nICAgICAgICAgICAvLyB2YWx1ZXMgaW5qZWN0ZWQgY2FuIGRpZmZlcmVudGlh\ndGUgYmV0d2VlbiBhIG1lbnRpb25lZAogICAgICAgICAgICAgICAgICAgIC8v\nIHByb3BlcnR5IGFuZCBvbmUgc2V0IHRvIGEgcGFydGljdWxhciB2YWx1ZS4K\nICAgICAgICAgICAgICAgICAgICBwcm9wID0gcHJvcHNbaV07CiAgICAgICAg\nICAgICAgICAgICAgdmFsID0gcHJvcDsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgcHJvcCA9IHByb3BzW2ldLnN1YnN0\ncmluZygwLCBpZHgpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICB2YWwg\nPSBwcm9wc1tpXS5zdWJzdHJpbmcoaWR4ICsgMSkudHJpbSgpOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB2YWx1ZSBp\ncyBxdW90ZWQsIHJlYWQgdW50aWwgdGhlIGVuZCBxdW90ZQogICAgICAgICAg\nICAgICAgaWYgKCgodmFsLnN0YXJ0c1dpdGgoIlwiIikgJiYgdmFsLmVuZHNX\naXRoKCJcIiIpKQogICAgICAgICAgICAgICAgICAgIHx8ICh2YWwuc3RhcnRz\nV2l0aCgiJyIpICYmIHZhbC5lbmRzV2l0aCgiJyIpKSkKICAgICAgICAgICAg\nICAgICAgICAmJiB2YWwubGVuZ3RoKCkgPiAxKQogICAgICAgICAgICAgICAg\nICAgIHZhbCA9IHZhbC5zdWJzdHJpbmcoMSwgdmFsLmxlbmd0aCgpIC0gMSk7\nCiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWwuc3RhcnRzV2l0aCgiXCIi\nKSB8fCB2YWwuc3RhcnRzV2l0aCgiJyIpKSB7CiAgICAgICAgICAgICAgICAg\nICAgcXVvdGUgPSB2YWwuY2hhckF0KDApOwogICAgICAgICAgICAgICAgICAg\nIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKHZhbC5zdWJz\ndHJpbmcoMSkpOwogICAgICAgICAgICAgICAgICAgIGludCBxdW90SWR4Owog\nICAgICAgICAgICAgICAgICAgIHdoaWxlICgrK2kgPCBwcm9wcy5sZW5ndGgp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCIpOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgcXVvdElkeCA9IHByb3BzW2ldLmlu\nZGV4T2YocXVvdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVv\ndElkeCAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChwcm9wc1tpXS5zdWJzdHJpbmcoMCwgcXVvdElkeCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1b3RJZHggKyAxIDwgcHJv\ncHNbaV0ubGVuZ3RoKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChwcm9wc1tpXS5zdWJzdHJpbmcocXVvdElkeCArIDEp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQocHJvcHNbaV0pOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB2YWwgPSBidWYudG9TdHJpbmco\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9wdHMucHV0\nKHByb3AsIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIG9wdHM7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgUGFyc2VFeGNlcHRpb24oX2xvYy5n\nZXQoInByb3AtcGFyc2UiLCBwcm9wZXJ0aWVzKSwgcmUpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIExvb2tzIHVwIHRoZSBnaXZlbiBuYW1l\nIGluIEpOREkuIElmIHRoZSBuYW1lIGlzIG51bGwsIG51bGwgaXMgcmV0dXJu\nZWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGxvb2t1cChT\ndHJpbmcgbmFtZSwgU3RyaW5nIHVzZXJLZXksIExvZyBsb2cpIHsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIENvbnRleHQgY3R4ID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBjdHggPSBuZXcgSW5pdGlhbENvbnRl\neHQoKTsKICAgICAgICAgICAgT2JqZWN0IHJlc3VsdCA9IGN0eC5sb29rdXAo\nbmFtZSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCAmJiBsb2cg\nIT0gbnVsbCAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAJ\nbG9nLndhcm4oX2xvYy5nZXQoImpuZGktbG9va3VwLWZhaWxlZCIsIHVzZXJL\nZXksIG5hbWUpKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAg\nICB9IGNhdGNoIChOYW1pbmdFeGNlcHRpb24gbmUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IE5lc3RhYmxlUnVudGltZUV4Y2VwdGlvbigKICAgICAgICAg\nICAgICAgIF9sb2MuZ2V0KCJuYW1pbmctZXJyIiwgbmFtZSkuZ2V0TWVzc2Fn\nZSgpLCBuZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKGN0eCAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY3R4LmNsb3Nl\nKCk7IH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7fQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFRlc3Qgd2hldGhlciB0aGUgbWFwIGNvbnRhaW5z\nIHRoZSBnaXZlbiBwYXJ0aWFsIGtleSwgcHJlZml4ZWQgd2l0aCBhbnkKICAg\nICAqIHBvc3NpYmxlIGNvbmZpZ3VyYXRpb24gcHJlZml4LgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gY29udGFpbnNQcm9wZXJ0eShTdHJp\nbmcgcGFydGlhbEtleSwgTWFwIHByb3BzKSB7CiAgICAgICAgaWYgKHBhcnRp\nYWxLZXkgPT0gbnVsbCB8fCBwcm9wcyA9PSBudWxsIHx8IHByb3BzLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgcmV0dXJuIHByb3BzLmNvbnRhaW5zS2V5KAogICAgICAg\nICAgICAgICAgUHJvZHVjdERlcml2YXRpb25zLmdldENvbmZpZ3VyYXRpb25L\nZXkocGFydGlhbEtleSwgcHJvcHMpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEdldCB0aGUgcHJvcGVydHkgdW5kZXIgdGhlIGdpdmVuIHBhcnRpYWwga2V5\nLCBwcmVmaXhlZCB3aXRoIGFueSBwb3NzaWJsZQogICAgICogY29uZmlndXJh\ndGlvbiBwcmVmaXguCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0\nIGdldFByb3BlcnR5KFN0cmluZyBwYXJ0aWFsS2V5LCBNYXAgbSkgewogICAg\nICAgIGlmIChwYXJ0aWFsS2V5ID09IG51bGwgfHwgbSA9PSBudWxsIHx8IG0u\naXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBl\nbHNlIAogICAgICAgICAgICByZXR1cm4gbS5nZXQoUHJvZHVjdERlcml2YXRp\nb25zLmdldENvbmZpZ3VyYXRpb25LZXkocGFydGlhbEtleSwgbSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBwcm9wZXJ0eSB1bmRlciB0\naGUgZ2l2ZW4gcGFydGlhbCBrZXksIHByZWZpeGVkIHdpdGggYW55CiAgICAg\nKiBwb3NzaWJsZSBjb25maWd1cmF0aW9uIHByZWZpeC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBPYmplY3QgcmVtb3ZlUHJvcGVydHkoU3RyaW5nIHBh\ncnRpYWxLZXksIE1hcCBwcm9wcykgewogICAgICAgIGlmIChwYXJ0aWFsS2V5\nID09IG51bGwgfHwgcHJvcHMgPT0gbnVsbCB8fCBwcm9wcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChjb250YWlu\nc1Byb3BlcnR5KHBhcnRpYWxLZXksIHByb3BzKSkKICAgICAgICAgICAgcmV0\ndXJuIHByb3BzLnJlbW92ZShQcm9kdWN0RGVyaXZhdGlvbnMuZ2V0Q29uZmln\ndXJhdGlvbktleSgKICAgICAgICAgICAgICAgIHBhcnRpYWxLZXksIHByb3Bz\nKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJ1bnMgPGNvZGU+cnVubmFibGU8L2NvZGU+\nIGFnYWluc3QgYWxsIHRoZSBhbmNob3JzIGluIHRoZSBjb25maWd1cmF0aW9u\nCiAgICAgKiBwb2ludGVkIHRvIGJ5IDxjb2RlPm9wdHM8L2NvZGU+LiBFYWNo\nIGludm9jYXRpb24gZ2V0cyBhIGZyZXNoIGNsb25lIG9mIAogICAgICogPGNv\nZGU+b3B0czwvY29kZT4gd2l0aCB0aGUgPGNvZGU+cHJvcGVydGllczwvY29k\nZT4gb3B0aW9uIHNldAogICAgICogYXBwcm9wcmlhdGVseS4KICAgICAqCiAg\nICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBi\nb29sZWFuIHJ1bkFnYWluc3RBbGxBbmNob3JzKE9wdGlvbnMgb3B0cywKICAg\nICAgICBDb25maWd1cmF0aW9ucy5SdW5uYWJsZSBydW5uYWJsZSkgewogICAg\nICAgIGlmIChvcHRzLmNvbnRhaW5zS2V5KCJoZWxwIikgfHwgb3B0cy5jb250\nYWluc0tleSgiLWhlbHAiKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQogICAgICAgIExpc3QgYW5jaG9ycyA9CiAgICAgICAgICAg\nIENvbmZpZ3VyYXRpb25zLmdldEZ1bGx5UXVhbGlmaWVkQW5jaG9yc0luUHJv\ncGVydGllc0xvY2F0aW9uKG9wdHMpOwoKICAgICAgICAvLyBXZSB1c2UgJ3By\nb3BlcnRpZXMnIGJlbG93OyBnZXQgcmlkIG9mICdwJyB0byBhdm9pZCBjb25m\nbGljdHMuIFRoaXMKICAgICAgICAvLyByZWxpZXMgb24ga25vd2luZyB3aGF0\nIGdldEZ1bGx5UXVhbGlmaWVkQW5jaG9yc0luUHJvcGVydGllc0xvY2F0aW9u\nCiAgICAgICAgLy8gbG9va3MgZm9yLgogICAgICAgIGlmIChvcHRzLmNvbnRh\naW5zS2V5KCJwIikpCiAgICAgICAgICAgIG9wdHMucmVtb3ZlKCJwIik7Cgog\nICAgICAgIGJvb2xlYW4gcmV0ID0gdHJ1ZTsKICAgICAgICBpZiAoYW5jaG9y\ncy5zaXplKCkgPT0gMCkgewogICAgICAgICAgICByZXQgPSBsYXVuY2hSdW5u\nYWJsZShvcHRzLCBydW5uYWJsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0gYW5jaG9ycy5pdGVyYXRvcigp\nOyBpdGVyLmhhc05leHQoKTsgKSB7IAogICAgICAgICAgICAgICAgT3B0aW9u\ncyBjbG9uZWRPcHRpb25zID0gKE9wdGlvbnMpIG9wdHMuY2xvbmUoKTsKICAg\nICAgICAgICAgICAgIGNsb25lZE9wdGlvbnMuc2V0UHJvcGVydHkoInByb3Bl\ncnRpZXMiLCBpdGVyLm5leHQoKS50b1N0cmluZygpKTsKICAgICAgICAgICAg\nICAgIHJldCAmPSBsYXVuY2hSdW5uYWJsZShjbG9uZWRPcHRpb25zLCBydW5u\nYWJsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHJldDsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGxhdW5j\naFJ1bm5hYmxlKE9wdGlvbnMgb3B0cywKICAgICAgICBDb25maWd1cmF0aW9u\ncy5SdW5uYWJsZSBydW5uYWJsZSkgewogICAgICAgIGJvb2xlYW4gcmV0ID0g\ndHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXQgPSBydW5uYWJs\nZS5ydW4ob3B0cyk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIFJ1bnRpbWVFeGNlcHRp\nb24pKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRp\nb24oZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93\nIChSdW50aW1lRXhjZXB0aW9uKSBlOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcmV0OwogICAgfQoKICAgIHB1YmxpYyBpbnRlcmZhY2UgUnVubmFibGUg\newogICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bihPcHRpb25zIG9wdHMpIHRo\ncm93cyBFeGNlcHRpb247CiAgICB9Cn0K\n","encoding":"base64"}

