{"sha":"f1f5001cf0da8c0c7d9a01cd62bb96df94a7f054","node_id":"MDQ6QmxvYjIwNjM2NDpmMWY1MDAxY2YwZGE4YzBjN2Q5YTAxY2Q2MmJiOTZkZjk0YTdmMDU0","size":12646,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f1f5001cf0da8c0c7d9a01cd62bb96df94a7f054","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuZ3JhcGg7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKCmltcG9ydCBq\nYXZhLnV0aWwuQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsK\naW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGls\nLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0Owpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKCi8qKgogKiA8cD5QZXJmb3JtcyBhIGRl\ncHRoLWZpcnN0IGFuYWx5c2lzIG9mIGEgZ2l2ZW4ge0BsaW5rIEdyYXBofSwg\nY2FjaGluZwogKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgZ3JhcGgncyBub2Rl\ncyBhbmQgZWRnZXMuICBTZWUgdGhlIERGUyBhbGdvcml0aG0KICogaW4gdGhl\nIGJvb2sgJ0ludHJvZHVjdGlvbiB0byBBbGdvcml0aG1zJyBieSBDb3JtZW4s\nIExlaXNlcnNvbiwgYW5kCiAqIFJpdmVzdC4gIFRoZSBhbGdvcml0aG0gaGFz\nIGJlZW4gbW9kaWZpZWQgdG8gZ3JvdXAgc2libGluZyBub2RlcyB3aXRob3V0\nCiAqIGNvbm5lY3Rpb25zIHRvZ2V0aGVyIGR1cmluZyB0aGUgdG9wb2xvZ2lj\nYWwgc29ydC48L3A+CiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBzaW5j\nZSAxLjAuMAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRGVwdGhG\naXJzdEFuYWx5c2lzIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2Nh\nbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKERl\ncHRoRmlyc3RBbmFseXNpcy5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBH\ncmFwaCBfZ3JhcGg7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfbm9kZUluZm8g\nPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBDb21wYXJhdG9yIF9jb21w\nOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuICBQZXJmb3JtcyB0aGUg\nYW5hbHlzaXMgb24gdGhlIGdpdmVuIGdyYXBoIGFuZCBjYWNoZXMKICAgICAq\nIHRoZSByZXN1bHRpbmcgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1Ymxp\nYyBEZXB0aEZpcnN0QW5hbHlzaXMoR3JhcGggZ3JhcGgpIHsKICAgICAgICBf\nZ3JhcGggPSBncmFwaDsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBub2RlIGlu\nZm9zCiAgICAgICAgQ29sbGVjdGlvbiBub2RlcyA9IGdyYXBoLmdldE5vZGVz\nKCk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBub2Rlcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgX25vZGVJbmZvLnB1\ndChpdHIubmV4dCgpLCBuZXcgTm9kZUluZm8oKSk7CgogICAgICAgIC8vIHZp\nc2l0IGFsbCBub2RlcyAtLSBzZWUgaW50cm8gdG8gYWxnbydzIGJvb2sKICAg\nICAgICBOb2RlSW5mbyBpbmZvOwogICAgICAgIE9iamVjdCBub2RlOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbm9kZXMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgbm9kZSA9IGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIGluZm8gPSAoTm9kZUluZm8pIF9ub2RlSW5mby5nZXQo\nbm9kZSk7CiAgICAgICAgICAgIGlmIChpbmZvLmNvbG9yID09IE5vZGVJbmZv\nLkNPTE9SX1dISVRFKQogICAgICAgICAgICAgICAgdmlzaXQoZ3JhcGgsIG5v\nZGUsIGluZm8sIDAsIG5ldyBMaW5rZWRMaXN0KCkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFZpc2l0IGEgbm9kZS4gIFNlZSBJbnRyb2R1\nY3Rpb24gdG8gQWxnb3JpdGhtcyBib29rIGZvciBkZXRhaWxzLgogICAgICov\nCiAgICBwcml2YXRlIGludCB2aXNpdChHcmFwaCBncmFwaCwgT2JqZWN0IG5v\nZGUsIE5vZGVJbmZvIGluZm8sIGludCB0aW1lLCAKICAgICAgICBMaXN0IHBh\ndGgpIHsKICAgICAgICAvLyBkaXNjb3ZlciBub2RlCiAgICAgICAgaW5mby5j\nb2xvciA9IE5vZGVJbmZvLkNPTE9SX0dSQVk7CgogICAgICAgIC8vIGV4cGxv\ncmUgYWxsIHZlcnRpY2VzIGZyb20gdGhhdCBub2RlIGRlcHRoIGZpcnN0CiAg\nICAgICAgQ29sbGVjdGlvbiBlZGdlcyA9IGdyYXBoLmdldEVkZ2VzRnJvbShu\nb2RlKTsKICAgICAgICBFZGdlIGVkZ2U7CiAgICAgICAgT2JqZWN0IG90aGVy\nOwogICAgICAgIE5vZGVJbmZvIG90aGVySW5mbzsKICAgICAgICBpbnQgbWF4\nQ2hpbGRUaW1lID0gdGltZSAtIDE7CiAgICAgICAgaW50IGNoaWxkVGltZTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGVkZ2VzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVkZ2UgPSAoRWRnZSkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgb3RoZXIgPSBlZGdlLmdldE90aGVy\nKG5vZGUpOwogICAgICAgICAgICBvdGhlckluZm8gPSAoTm9kZUluZm8pIF9u\nb2RlSW5mby5nZXQob3RoZXIpOwogICAgICAgICAgICBpZiAob3RoZXJJbmZv\nLmNvbG9yID09IE5vZGVJbmZvLkNPTE9SX1dISVRFKSB7CiAgICAgICAgICAg\nICAgICAvLyB1bmRpc2NvdmVyZWQgbm9kZTsgcmVjdXJzZSBpbnRvIGl0CiAg\nICAgICAgICAgICAgICBwYXRoLmFkZChlZGdlKTsKICAgICAgICAgICAgICAg\nIGNoaWxkVGltZSA9IHZpc2l0KGdyYXBoLCBvdGhlciwgb3RoZXJJbmZvLCB0\naW1lLCBwYXRoKTsKICAgICAgICAgICAgICAgIHBhdGgucmVtb3ZlKGVkZ2Up\nOwogICAgICAgICAgICAgICAgZWRnZS5zZXRUeXBlKEVkZ2UuVFlQRV9UUkVF\nKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvdGhlckluZm8uY29sb3IgPT0g\nTm9kZUluZm8uQ09MT1JfR1JBWSkgewogICAgICAgICAgICAgICAgY2hpbGRU\naW1lID0gLTE7CiAgICAgICAgICAgICAgICBlZGdlLnNldFR5cGUoRWRnZS5U\nWVBFX0JBQ0spOwogICAgICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBj\neWNsZSBpbmNsdWRpbmcgdGhpcyBlZGdlCiAgICAgICAgICAgICAgICBlZGdl\nLnNldEN5Y2xlKGN5Y2xlRm9yQmFja0VkZ2UoZWRnZSwgcGF0aCkpOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2hpbGRUaW1lID0g\nb3RoZXJJbmZvLmZpbmlzaGVkOwogICAgICAgICAgICAgICAgZWRnZS5zZXRU\neXBlKEVkZ2UuVFlQRV9GT1JXQVJEKTsKICAgICAgICAgICAgICAgIC8vIGZp\nbmQgdGhlIGN5Y2xlIGluY2x1ZGluZyB0aGlzIGVkZ2UKICAgICAgICAgICAg\nICAgIExpc3QgY3ljbGUgPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAgICAg\nICAgICAgY3ljbGUuYWRkKGVkZ2UpOwogICAgICAgICAgICAgICAgaWYgKGN5\nY2xlRm9yRm9yd2FyZEVkZ2UoZ3JhcGgsIG90aGVyLCBub2RlLCBjeWNsZSkp\nIHsKICAgICAgICAgICAgICAgICAgICBlZGdlLnNldEN5Y2xlKGN5Y2xlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBt\nYXhDaGlsZFRpbWUgPSBNYXRoLm1heChtYXhDaGlsZFRpbWUsIGNoaWxkVGlt\nZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBmaW5pc2hlZCB3aXRoIG5vZGUK\nICAgICAgICBpbmZvLmNvbG9yID0gTm9kZUluZm8uQ09MT1JfQkxBQ0s7CiAg\nICAgICAgaW5mby5maW5pc2hlZCA9IG1heENoaWxkVGltZSArIDE7CiAgICAg\nICAgcmV0dXJuIGluZm8uZmluaXNoZWQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGNvbXBhcmF0b3IgdGhhdCBzaG91bGQgYmUgdXNlZCBmb3Ig\nb3JkZXJpbmcgZ3JvdXBzIG9mIG5vZGVzCiAgICAgKiB3aXRoIHRoZSBzYW1l\nIGRlcGVuZGVuY2llcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Tm9k\nZUNvbXBhcmF0b3IoQ29tcGFyYXRvciBjb21wKSB7CiAgICAgICAgX2NvbXAg\nPSBjb21wOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBub2Rl\ncyBpbiB0b3BvbG9naWNhbGx5LXNvcnRlZCBvcmRlci4gIFRoaXMgaXMgb2Z0\nZW4gdXNlZAogICAgICogdG8gb3JkZXIgZGVwZW5kZW5jaWVzLiAgSWYgZWFj\naCBncmFwaCBlZGdlICh1LCB2KSByZXByZXNlbnRzIGEKICAgICAqIGRlcGVu\nZGVuY3kgb2YgdiBvbiB1LCB0aGVuIHRoaXMgbWV0aG9kIHdpbGwgcmV0dXJu\nIHRoZSBub2RlcyBpbiB0aGUKICAgICAqIG9yZGVyIHRoYXQgdGhleSBzaG91\nbGQgYmUgZXZhbHVhdGVkIHRvIHNhdGlzZnkgYWxsIGRlcGVuZGVuY2llcy4g\nIE9mCiAgICAgKiBjb3Vyc2UsIGlmIHRoZSBncmFwaCBpcyBjeWNsaWMgKGhh\ncyBiYWNrIGVkZ2VzKSwgdGhlbiBubyBzdWNoIG9yZGVyaW5nCiAgICAgKiBp\ncyBwb3NzaWJsZSwgdGhvdWdoIHRoaXMgbWV0aG9kIHdpbGwgc3RpbGwgcmV0\ndXJuIHRoZSBjb3JyZWN0IG9yZGVyCiAgICAgKiBhcyBpZiBlZGdlcyBjcmVh\ndGluZyB0aGUgY3ljbGVzIGRpZCBub3QgZXhpc3QuCiAgICAgKi8KICAgIHB1\nYmxpYyBMaXN0IGdldFNvcnRlZE5vZGVzKCkgewogICAgICAgIE1hcC5FbnRy\neVtdIGVudHJpZXMgPSAoTWFwLkVudHJ5W10pIF9ub2RlSW5mby5lbnRyeVNl\ndCgpLgogICAgICAgICAgICB0b0FycmF5KG5ldyBNYXAuRW50cnlbX25vZGVJ\nbmZvLnNpemUoKV0pOwogICAgICAgIEFycmF5cy5zb3J0KGVudHJpZXMsIG5l\ndyBOb2RlSW5mb0NvbXBhcmF0b3IoX2NvbXApKTsKICAgICAgICByZXR1cm4g\nbmV3IE5vZGVMaXN0KGVudHJpZXMpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGFsbCBlZGdlcyBvZiB0aGUgZ2l2ZW4gdHlwZS4gIFRoaXMgbWV0\naG9kIGNhbiBiZSB1c2VkIHRvCiAgICAgKiBkaXNjb3ZlciBhbGwgZWRnZXMg\ndGhhdCBjYXVzZSBjeWNsZXMgaW4gdGhlIGdyYXBoIGJ5IHBhc3NpbmcgaXQK\nICAgICAqIHRoZSB7QGxpbmsgRWRnZSNUWVBFX0JBQ0t9IG9yIHtAbGluayBF\nZGdlI1RZUEVfRk9SV0FSRH0gZWRnZSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgQ29sbGVjdGlvbiBnZXRFZGdlcyhpbnQgdHlwZSkgewogICAgICAgIENv\nbGxlY3Rpb24gdHlwZWQgPSBudWxsOwogICAgICAgIEVkZ2UgZWRnZTsKICAg\nICAgICBPYmplY3Qgbm9kZTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIG5vZGVz\nID0gX2dyYXBoLmdldE5vZGVzKCkuaXRlcmF0b3IoKTsgbm9kZXMuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBub2RlID0gbm9kZXMubmV4dCgpOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9ncmFwaC5nZXRFZGdlc0Zy\nb20obm9kZSkuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlZGdlID0gKEVkZ2UpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoZWRnZS5nZXRUeXBlKCkgPT0g\ndHlwZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlZCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlZCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgICAgICAgICB0eXBlZC5hZGQoZWRnZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuICh0eXBlZCA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZ\nX0xJU1QgOiB0eXBlZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbG9naWNhbCB0aW1lIHRoYXQgdGhlIGdpdmVuIG5vZGUgd2FzIGZpbmlz\naGVkIGluCiAgICAgKiB0aGUgZ3JhcGggd2Fsaywgb3IgLTEgaWYgdGhlIG5v\nZGUgaXMgbm90IHBhcnQgb2YgdGhlIGdyYXBoLgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldEZpbmlzaGVkVGltZShPYmplY3Qgbm9kZSkgewogICAgICAg\nIE5vZGVJbmZvIGluZm8gPSAoTm9kZUluZm8pIF9ub2RlSW5mby5nZXQobm9k\nZSk7CiAgICAgICAgaWYgKGluZm8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIC0xOwogICAgICAgIHJldHVybiBpbmZvLmZpbmlzaGVkOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyBhIGxpc3Qgb2YgZ3JhcGggZWRnZXMg\nZm9ybWluZyBhIGN5Y2xlLiBUaGUgY3ljbGUgYmVnaW5zIAogICAgICogd2l0\naCBhIHR5cGUge0BsaW5rIEVkZ2UjVFlQRV9CQUNLfSBlZGdlLgogICAgICog\nQHBhcmFtIGJhY2tFZGdlICJTdGFydGluZyIgZWRnZSBvZiB0aGUgY3ljbGUK\nICAgICAqIEBwYXJhbSBwYXRoIENvbnRpbnVvdXMgbGlzdCBvZiBncmFwaCBl\nZGdlcywgbWF5IGJlIG51bGwKICAgICAqIEBwYXJhbSBwb3MgSW5kZXggb2Yg\ndGhlIGZpcnN0IGVkZ2UgaW4gcGF0aCBjb250aW51aW5nIHRoZSBjeWNsZQog\nICAgICogQHJldHVybiBDeWNsZSBzdGFydGluZyB3aXRoIGEgdHlwZSB7QGxp\nbmsgRWRnZSNUWVBFX0JBQ0t9IGVkZ2UKICAgICAqLwogICAgcHJpdmF0ZSBM\naXN0IGJ1aWxkQ3ljbGUoRWRnZSBiYWNrRWRnZSwgTGlzdCBwYXRoLCBpbnQg\ncG9zKSB7CiAgICAgICAgaW50IGxlbmd0aCA9IHBhdGggIT0gbnVsbCA/IHBh\ndGguc2l6ZSgpIC0gcG9zIDogMDsKICAgICAgICBMaXN0IGN5Y2xlID0gbmV3\nIEFycmF5TGlzdChsZW5ndGggKyAxKTsKICAgICAgICBjeWNsZS5hZGQoMCwg\nYmFja0VkZ2UpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgY3ljbGUuYWRkKGkgKyAxLCBwYXRoLmdl\ndChwb3MgKyBpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjeWNsZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSBsaXN0IG9mIGVk\nZ2VzIGZvcm1pbmcgYSBjeWNsZS4gVGhlIGN5Y2xlIGFsd2F5cyBleGlzdHMg\nZm9yCiAgICAgKiBhIHR5cGUge0BsaW5rIEVkZ2UjVFlQRV9CQUNLfSBlZGdl\nLiBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWQgCiAgICAgKiBm\nb3IgdHlwZSB7QGxpbmsgRWRnZSNUWVBFX0JBQ0t9IGVkZ2VzLiAKICAgICAq\nIEBwYXJhbSBlZGdlIEVkZ2Ugd2hlcmUgdGhlIGN5Y2xlIHdhcyBkZXRlY3Rl\nZAogICAgICogQHBhcmFtIHBhdGggUGF0aCBjb25zaXN0aW5nIG9mIGVkZ2Vz\nIHRvIHRoZSBlZGdlJ3Mgc3RhcnRpbmcgbm9kZQogICAgICogQHJldHVybiBD\neWNsZSBzdGFydGluZyB3aXRoIGEgdHlwZSB7QGxpbmsgRWRnZSNUWVBFX0JB\nQ0t9IGVkZ2UKICAgICAqLwogICAgcHJpdmF0ZSBMaXN0IGN5Y2xlRm9yQmFj\na0VkZ2UoRWRnZSBlZGdlLCBMaXN0IHBhdGgpIHsKICAgICAgICBpZiAoZWRn\nZS5nZXRUeXBlKCkgIT0gRWRnZS5UWVBFX0JBQ0spIHsKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIExpc3Qg\nY3ljbGU7CiAgICAgICAgaW50IHBvcyA9IDA7CiAgICAgICAgaWYgKHBhdGgg\nIT0gbnVsbCAmJiAhZWRnZS5nZXRGcm9tKCkuZXF1YWxzKGVkZ2UuZ2V0VG8o\nKSkpIHsKICAgICAgICAgICAgLy8gTm90IGEgc2luZ2xlIGVkZ2UgbG9vcAog\nICAgICAgICAgICBwb3MgPSBmaW5kTm9kZUluUGF0aChlZGdlLmdldFRvKCks\nIHBhdGgpOwogICAgICAgICAgICBhc3NlcnQgKHBvcyA+PSAwKTogX2xvYy5n\nZXQoIm5vZGUtbm90LW9uLXBhdGgiLCBlZGdlLCBlZGdlLmdldFRvKCkpOyAK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhc3NlcnQgKGVkZ2UuZ2V0\nRnJvbSgpLmVxdWFscyhlZGdlLmdldFRvKCkpKTogCiAgICAgICAgICAgICAg\nICBfbG9jLmdldCgiZWRnZS1uby1sb29wIiwgZWRnZSkuZ2V0TWVzc2FnZSgp\nOwogICAgICAgICAgICBwYXRoID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\nY3ljbGUgPSBidWlsZEN5Y2xlKGVkZ2UsIHBhdGgsIHBvcyk7IAogICAgICAg\nIGFzc2VydCAoY3ljbGUgIT0gbnVsbCk6IF9sb2MuZ2V0KCJjeWNsZS1udWxs\nIiwgZWRnZSkuZ2V0TWVzc2FnZSgpOwogICAgICAgIHJldHVybiBjeWNsZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSBjeWNsZSBvZiBl\nZGdlcyBpbmNsdWRpbmcgbm9kZSBjeWNsZVRvLiBUaGUgY3ljbGUgbXVzdCBu\nb3QgCiAgICAgKiBuZWNlc3NhcmlseSBleGlzdC4gVGhpcyBtZXRob2Qgc2hv\ndWxkIG9ubHkgYmUgY2FsbGVkIGZvciB0eXBlIAogICAgICoge0BsaW5rIEVk\nZ2UjVFlQRV9GT1JXQVJEfSBlZGdlcy4KICAgICAqIEBwYXJhbSBncmFwaCBH\ncmFwaAogICAgICogQHBhcmFtIG5vZGUgQ3VycmVudCBub2RlCiAgICAgKiBA\ncGFyYW0gY3ljbGVUbyBFbmQgbm9kZSBmb3IgbG9vcAogICAgICogQHBhcmFt\nIHBhdGggUGF0aCBmcm9tIGxvb3AgZW5kIG5vZGUgdG8gY3VycmVudCBub2Rl\nCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYSBjeWNsZSBoYXMgYmVlbiBmb3Vu\nZC4gVGhlIGN5Y2xlIHdpbGwgYmUgY29udGFpbmVkIGluCiAgICAgKiB0aGUg\nPGNvZGU+cGF0aDwvY29kZT4gcGFyYW1ldGVyLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gY3ljbGVGb3JGb3J3YXJkRWRnZShHcmFwaCBncmFwaCwg\nT2JqZWN0IG5vZGUsCiAgICAgICAgT2JqZWN0IGN5Y2xlVG8sIExpc3QgcGF0\naCkgeyAgICAgICAgICAgICAgICAgICAKICAgICAgICBib29sZWFuIGZvdW5k\nID0gZmFsc2U7CiAgICAgICAgQ29sbGVjdGlvbiBlZGdlcyA9IGdyYXBoLmdl\ndEVkZ2VzRnJvbShub2RlKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGVkZ2VzLml0ZXJhdG9yKCk7ICFmb3VuZCAmJiBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBFZGdlIGVkZ2UgPSAoRWRnZSkgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgT2JqZWN0IG90aGVyID0gZWRnZS5nZXRPdGhlcihub2Rl\nKTsKICAgICAgICAgICAgLy8gU2luZ2xlIGVkZ2UgbG9vcHMgYXJlIGlnbm9y\nZWQKICAgICAgICAgICAgaWYgKCFub2RlLmVxdWFscyhvdGhlcikpIHsKICAg\nICAgICAgICAgICAgIGlmIChvdGhlci5lcXVhbHMoY3ljbGVUbykpIHsKICAg\nICAgICAgICAgICAgICAgICAvLyBDeWNsZSBjb21wbGV0ZQogICAgICAgICAg\nICAgICAgICAgIHBhdGguYWRkKGVkZ2UpOwogICAgICAgICAgICAgICAgICAg\nIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXBh\ndGguY29udGFpbnMoZWRnZSkpewogICAgICAgICAgICAgICAgICAgIC8vIFdh\nbGsgdGhpcyBlZGdlCiAgICAgICAgICAgICAgICAgICAgcGF0aC5hZGQoZWRn\nZSk7CiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBjeWNsZUZvckZvcndh\ncmRFZGdlKGdyYXBoLCBvdGhlciwgY3ljbGVUbywgcGF0aCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBSZW1vdmUgZWRnZSBhZ2FpbgogICAgICAgICAgICAgICAgICAg\nICAgICBwYXRoLnJlbW92ZShlZGdlKTsgICAgICAgICAgICAgICAgICAgIAog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZm91bmQ7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogRmluZHMgdGhlIHBvc2l0aW9uIG9mIHRo\nZSBlZGdlIHN0YXJ0aW5nIGZyb20gYSBwYXJ0aWN1bGFyIG5vZGUgaW4gdGhl\nIAogICAgICogY29udGludW91cyBsaXN0IG9mIGVkZ2VzLgogICAgICogQHBh\ncmFtIG5vZGUgTm9kZSBvbiB0aGUgY3ljbGUuCiAgICAgKiBAcGFyYW0gcGF0\naCBDb250aW51b3VzIGxpc3Qgb2YgZ3JhcGggZWRnZXMuCiAgICAgKiBAcmV0\ndXJuIEVkZ2UgaW5kZXggaWYgZm91bmQsIC0xIG90aGVyd2lzZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBpbnQgZmluZE5vZGVJblBhdGgoT2JqZWN0IG5vZGUs\nIExpc3QgcGF0aCkgewogICAgICAgIGludCBwb3MgPSAtMTsKICAgICAgICBp\nZiAocGF0aCAhPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgcGF0aC5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKCgoRWRnZSlwYXRoLmdldChpKSkuZ2V0RnJvbSgpLmVxdWFscyhub2RlKSkg\newogICAgICAgICAgICAgICAgICAgIHBvcyA9IGk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBv\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QsIGlmIHRoZSBhbmFseXNp\ncyBkaWRuJ3QgZmluZCBjeWNsZXMuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGhhc05vQ3ljbGVzKCkgewogICAgICAgIC8vIGEpIHRoZXJlIG11c3Qg\nbm90IGJlIGFueSBiYWNrIGVkZ2VzCiAgICAgICAgaWYgKCFnZXRFZGdlcyhF\nZGdlLlRZUEVfQkFDSykuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gYikgdGhlcmUgbWlnaHQg\nYmUgZm9yd2FyZCBlZGdlcwogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGVzZSBk\nb24ndCBpbmRpY2F0ZSBjeWNsZXMKICAgICAgICBDb2xsZWN0aW9uIGVkZ2Vz\nID0gZ2V0RWRnZXMoRWRnZS5UWVBFX0ZPUldBUkQpOwogICAgICAgIGlmICgh\nZWRnZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gZWRnZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgICAgIEVkZ2UgZWRnZSA9IChFZGdlKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgaWYgKGVkZ2UuZ2V0Q3ljbGUoKSAhPSBudWxsKSAg\newogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDb21wYXJhdG9y\nIGZvciB0b3Bsb2dpY2FsbHkgc29ydGluZyBlbnRyaWVzIGluIHRoZSBub2Rl\nIGluZm8gbWFwLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBO\nb2RlSW5mb0NvbXBhcmF0b3IKICAgICAgICBpbXBsZW1lbnRzIENvbXBhcmF0\nb3IgewoKICAgICAgICBwcml2YXRlIGZpbmFsIENvbXBhcmF0b3IgX3N1YkNv\nbXA7CgogICAgICAgIHB1YmxpYyBOb2RlSW5mb0NvbXBhcmF0b3IoQ29tcGFy\nYXRvciBzdWJDb21wKSB7CiAgICAgICAgICAgIF9zdWJDb21wID0gc3ViQ29t\ncDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmpl\nY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBNYXAuRW50cnkgZTEg\nPSAoTWFwLkVudHJ5KSBvMTsKICAgICAgICAgICAgTWFwLkVudHJ5IGUyID0g\nKE1hcC5FbnRyeSkgbzI7CiAgICAgICAgICAgIE5vZGVJbmZvIG4xID0gKE5v\nZGVJbmZvKSBlMS5nZXRWYWx1ZSgpOwogICAgICAgICAgICBOb2RlSW5mbyBu\nMiA9IChOb2RlSW5mbykgZTIuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgIC8v\nIHNvcnQgYnkgZmluaXNoZWQgb3JkZXIKICAgICAgICAgICAgaW50IHJldCA9\nIG4xLmZpbmlzaGVkIC0gbjIuZmluaXNoZWQ7CiAgICAgICAgICAgIGlmIChy\nZXQgPT0gMCAmJiBfc3ViQ29tcCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0ID0gX3N1YkNvbXAuY29tcGFyZShlMS5nZXRLZXkoKSwgZTIuZ2V0S2V5\nKCkpOwogICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqCUxpc3Qgb2Ygbm9kZS10by1ub2RlaW5mbyBlbnRy\naWVzIHRoYXQgZXhwb3NlcyBqdXN0IHRoZSBub2Rlcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgY2xhc3MgTm9kZUxpc3QKICAgICAgICBleHRlbmRz\nIEFic3RyYWN0TGlzdCB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWFwLkVu\ndHJ5W10gX2VudHJpZXM7CgogICAgICAgIHB1YmxpYyBOb2RlTGlzdChNYXAu\nRW50cnlbXSBlbnRyaWVzKSB7CiAgICAgICAgICAgIF9lbnRyaWVzID0gZW50\ncmllczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGlu\ndCBpZHgpIHsKICAgICAgICAgICAgcmV0dXJuIF9lbnRyaWVzW2lkeF0uZ2V0\nS2V5KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7\nCiAgICAgICAgICAgIHJldHVybiBfZW50cmllcy5sZW5ndGg7CgkJfQoJfQp9\nCg==\n","encoding":"base64"}

