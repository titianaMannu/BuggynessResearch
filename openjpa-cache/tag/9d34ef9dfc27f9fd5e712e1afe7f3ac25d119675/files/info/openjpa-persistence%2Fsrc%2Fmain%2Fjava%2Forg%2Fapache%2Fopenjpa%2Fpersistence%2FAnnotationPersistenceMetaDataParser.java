{"sha":"f4691b5bf69239fd4385eca071956a19be4e8c22","node_id":"MDQ6QmxvYjIwNjM2NDpmNDY5MWI1YmY2OTIzOWZkNDM4NWVjYTA3MTk1NmExOWJlNGU4YzIy","size":63931,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f4691b5bf69239fd4385eca071956a19be4e8c22","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9k\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBq\nYXZhLm5ldC5VUklTeW50YXhFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5V\nUkw7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJl\nZVNldDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkJhc2ljOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRl\nZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVuZXJzOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3VwZXJjbGFzc0xpc3RlbmVy\nczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZldGNoVHlwZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwppbXBvcnQgc3RhdGljIGphdmF4\nLnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlLkFVVE87CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5JZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLklk\nQ2xhc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Mb2I7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTWFwS2V5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwcGVkU3VwZXJj\nbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncmllczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJpZXM7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJ5OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PcmRl\nckJ5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdExvYWQ7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5Qb3N0UGVyc2lzdDsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlBvc3RSZW1vdmU7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5Qb3N0VXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJl\nUGVyc2lzdDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVJlbW92ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVVwZGF0ZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVmVyc2lvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LkJlYW5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lk1ldGhvZExpZmVjeWNs\nZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLmpwcWwuSlBRTFBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdjVIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLkRlbGVnYXRpbmdNZXRhRGF0YUZhY3Rvcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rv\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1v\nZGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFS\nZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuT3Jk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0\nZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuTWV0YURhdGFEZWZhdWx0czsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hl\nLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuKjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhj\nZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2Vy\ncC51dGlsLlN0cmluZ3M7CgovKioKICogUGVyc2lzdGVuY2UgYW5ub3RhdGlv\nbiBtZXRhZGF0YSBwYXJzZXIuIEN1cnJlbnRseSBkb2VzIG5vdCBwYXJzZQog\nKiBkZXBsb3ltZW50IGRlc2NyaXB0b3JzLgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJz\nZXIKICAgIGltcGxlbWVudHMgTWV0YURhdGFNb2RlcyB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0\nYVBhcnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFw\nPENsYXNzLCBNZXRhRGF0YVRhZz4gX3RhZ3MgPQogICAgICAgIG5ldyBIYXNo\nTWFwPENsYXNzLCBNZXRhRGF0YVRhZz4oKTsKCiAgICBzdGF0aWMgewogICAg\nICAgIF90YWdzLnB1dChFbWJlZGRlZElkLmNsYXNzLCBFTUJFRERFRF9JRCk7\nCiAgICAgICAgX3RhZ3MucHV0KEVudGl0eUxpc3RlbmVycy5jbGFzcywgRU5U\nSVRZX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4Y2x1ZGVEZWZh\ndWx0TGlzdGVuZXJzLmNsYXNzLCBFWENMVURFX0RFRkFVTFRfTElTVEVORVJT\nKTsKICAgICAgICBfdGFncy5wdXQoRXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5l\ncnMuY2xhc3MsCiAgICAgICAgICAgIEVYQ0xVREVfU1VQRVJDTEFTU19MSVNU\nRU5FUlMpOwogICAgICAgIF90YWdzLnB1dChGbHVzaE1vZGVUeXBlLmNsYXNz\nLCBGTFVTSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoR2VuZXJhdGVkVmFs\ndWUuY2xhc3MsIEdFTkVSQVRFRF9WQUxVRSk7CiAgICAgICAgX3RhZ3MucHV0\nKElkLmNsYXNzLCBJRCk7CiAgICAgICAgX3RhZ3MucHV0KElkQ2xhc3MuY2xh\nc3MsIElEX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5LmNsYXNz\nLCBNQVBfS0VZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVy\naWVzLmNsYXNzLCBOQVRJVkVfUVVFUklFUyk7CiAgICAgICAgX3RhZ3MucHV0\nKE5hbWVkTmF0aXZlUXVlcnkuY2xhc3MsIE5BVElWRV9RVUVSWSk7CiAgICAg\nICAgX3RhZ3MucHV0KE5hbWVkUXVlcmllcy5jbGFzcywgUVVFUklFUyk7CiAg\nICAgICAgX3RhZ3MucHV0KE5hbWVkUXVlcnkuY2xhc3MsIFFVRVJZKTsKICAg\nICAgICBfdGFncy5wdXQoT3JkZXJCeS5jbGFzcywgT1JERVJfQlkpOwogICAg\nICAgIF90YWdzLnB1dChQb3N0TG9hZC5jbGFzcywgUE9TVF9MT0FEKTsKICAg\nICAgICBfdGFncy5wdXQoUG9zdFBlcnNpc3QuY2xhc3MsIFBPU1RfUEVSU0lT\nVCk7CiAgICAgICAgX3RhZ3MucHV0KFBvc3RSZW1vdmUuY2xhc3MsIFBPU1Rf\nUkVNT1ZFKTsKICAgICAgICBfdGFncy5wdXQoUG9zdFVwZGF0ZS5jbGFzcywg\nUE9TVF9VUERBVEUpOwogICAgICAgIF90YWdzLnB1dChQcmVQZXJzaXN0LmNs\nYXNzLCBQUkVfUEVSU0lTVCk7CiAgICAgICAgX3RhZ3MucHV0KFByZVJlbW92\nZS5jbGFzcywgUFJFX1JFTU9WRSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVVw\nZGF0ZS5jbGFzcywgUFJFX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFNl\ncXVlbmNlR2VuZXJhdG9yLmNsYXNzLCBTRVFfR0VORVJBVE9SKTsKICAgICAg\nICBfdGFncy5wdXQoVmVyc2lvbi5jbGFzcywgVkVSU0lPTik7CiAgICAgICAg\nX3RhZ3MucHV0KERhdGFDYWNoZS5jbGFzcywgREFUQV9DQUNIRSk7CiAgICAg\nICAgX3RhZ3MucHV0KERhdGFTdG9yZUlkLmNsYXNzLCBEQVRBU1RPUkVfSUQp\nOwogICAgICAgIF90YWdzLnB1dChEZXBlbmRlbnQuY2xhc3MsIERFUEVOREVO\nVCk7CiAgICAgICAgX3RhZ3MucHV0KERldGFjaGVkU3RhdGUuY2xhc3MsIERF\nVEFDSEVEX1NUQVRFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudERlcGVu\nZGVudC5jbGFzcywgRUxFTV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1\ndChFbGVtZW50VHlwZS5jbGFzcywgRUxFTV9UWVBFKTsKICAgICAgICBfdGFn\ncy5wdXQoRXh0ZXJuYWxWYWx1ZXMuY2xhc3MsIEVYVEVSTkFMX1ZBTFMpOwog\nICAgICAgIF90YWdzLnB1dChFeHRlcm5hbGl6ZXIuY2xhc3MsIEVYVEVSTkFM\nSVpFUik7CiAgICAgICAgX3RhZ3MucHV0KEZhY3RvcnkuY2xhc3MsIEZBQ1RP\nUlkpOwogICAgICAgIF90YWdzLnB1dChGZXRjaEdyb3VwLmNsYXNzLCBGRVRD\nSF9HUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXBzLmNsYXNz\nLCBGRVRDSF9HUk9VUFMpOwogICAgICAgIF90YWdzLnB1dChJbnZlcnNlTG9n\naWNhbC5jbGFzcywgSU5WRVJTRV9MT0dJQ0FMKTsKICAgICAgICBfdGFncy5w\ndXQoS2V5RGVwZW5kZW50LmNsYXNzLCBLRVlfREVQRU5ERU5UKTsKICAgICAg\nICBfdGFncy5wdXQoS2V5VHlwZS5jbGFzcywgS0VZX1RZUEUpOwogICAgICAg\nIF90YWdzLnB1dChMb2FkRmV0Y2hHcm91cC5jbGFzcywgTE9BRF9GRVRDSF9H\nUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KExSUy5jbGFzcywgTFJTKTsKICAg\nICAgICBfdGFncy5wdXQoTWFuYWdlZEludGVyZmFjZS5jbGFzcywgTUFOQUdF\nRF9JTlRFUkZBQ0UpOwogICAgICAgIF90YWdzLnB1dChSZWFkT25seS5jbGFz\ncywgUkVBRF9PTkxZKTsKICAgICAgICBfdGFncy5wdXQoVHlwZS5jbGFzcywg\nVFlQRSk7CiAgICB9CgogICAgcHJpdmF0ZSBmaW5hbCBPcGVuSlBBQ29uZmln\ndXJhdGlvbiBfY29uZjsKICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAg\nICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSBfcmVwb3MgPSBudWxsOwog\nICAgcHJpdmF0ZSBDbGFzc0xvYWRlciBfZW52TG9hZGVyID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfb3ZlcnJpZGUgPSBmYWxzZTsKICAgIHByaXZh\ndGUgaW50IF9tb2RlID0gTU9ERV9OT05FOwoKICAgIC8vIHBhY2thZ2VzIGFu\nZCB0aGVpciBwYXJzZSBtb2RlcwogICAgcHJpdmF0ZSBmaW5hbCBNYXA8UGFj\na2FnZSwgSW50ZWdlcj4gX3BrZ3MgPSBuZXcgSGFzaE1hcDxQYWNrYWdlLCBJ\nbnRlZ2VyPigpOwoKICAgIC8vIHRoZSBjbGFzcyB3ZSB3ZXJlIGludm9rZWQg\ndG8gcGFyc2UKICAgIHByaXZhdGUgQ2xhc3MgX2NscyA9IG51bGw7CiAgICBw\ncml2YXRlIEZpbGUgX2ZpbGUgPSBudWxsOwoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3I7IHN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIoT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29u\nZjsKICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24uTE9HX01FVEFEQVRBKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbmZpZ3VyYXRpb24gc3VwcGxpZWQgb24gY29uc3RydWN0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJh\ndGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNZXRhZGF0YSBsb2cuCiAgICAgKi8KICAgIHB1YmxpYyBMb2cg\nZ2V0TG9nKCkgewogICAgICAgIHJldHVybiBfbG9nOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0aGUgcmVwb3NpdG9yeSBmb3IgdGhpcyBwYXJz\nZXIuIElmIG5vbmUgaGFzIGJlZW4gc2V0LAogICAgICogY3JlYXRlIGEgbmV3\nIHJlcG9zaXRvcnkgYW5kIHNldHMgaXQuCiAgICAgKi8KICAgIHB1YmxpYyBN\nZXRhRGF0YVJlcG9zaXRvcnkgZ2V0UmVwb3NpdG9yeSgpIHsKICAgICAgICBp\nZiAoX3JlcG9zID09IG51bGwpIHsKICAgICAgICAgICAgTWV0YURhdGFSZXBv\nc2l0b3J5IHJlcG9zID0gX2NvbmYubmV3TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgTWV0YURhdGFGYWN0b3J5IG1kZiA9IHJl\ncG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpOwogICAgICAgICAgICBpZiAobWRm\nIGluc3RhbmNlb2YgRGVsZWdhdGluZ01ldGFEYXRhRmFjdG9yeSkKICAgICAg\nICAgICAgICAgIG1kZiA9ICgoRGVsZWdhdGluZ01ldGFEYXRhRmFjdG9yeSkg\nbWRmKS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgICAgICAgICBpZiAo\nbWRmIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VNZXRhRGF0YUZhY3RvcnkpCiAg\nICAgICAgICAgICAgICAoKFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5KSBt\nZGYpLnNldEFubm90YXRpb25QYXJzZXIodGhpcyk7CiAgICAgICAgICAgIF9y\nZXBvcyA9IHJlcG9zOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3JlcG9z\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtZXRhZGF0YSByZXBv\nc2l0b3J5IGZvciB0aGlzIHBhcnNlci4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0UmVwb3NpdG9yeShNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsK\nICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIgdG8gcGFz\ncyBvbiB0byBwYXJzZWQKICAgICAqIG1ldGFkYXRhIGluc3RhbmNlcy4KICAg\nICAqLwogICAgcHVibGljIENsYXNzTG9hZGVyIGdldEVudkNsYXNzTG9hZGVy\nKCkgewogICAgICAgIHJldHVybiBfZW52TG9hZGVyOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciB0\nbyBwYXNzIG9uIHRvIHBhcnNlZAogICAgICogbWV0YWRhdGEgaW5zdGFuY2Vz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbnZDbGFzc0xvYWRlcihD\nbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfZW52TG9hZGVyID0gbG9h\nZGVyOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBs\nYXRlciBwYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlvbiB0byBvdmVycmlk\nZQogICAgICogZWFybGllciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNhbWUgY2xh\nc3MuIERlZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAgICAqIHdoZW4gYSB0\nb29sIGlzIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBhbm5vdGF0aW9uIHBh\ncnRpYWwgbWFwcGluZwogICAgICogaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQg\nZXZlbiB3aGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4gYW5vdGhlcgogICAg\nICogbG9jYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldE1h\ncHBpbmdPdmVycmlkZSgpIHsKICAgICAgICByZXR1cm4gX292ZXJyaWRlOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBsYXRlciBw\nYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlvbiB0byBvdmVycmlkZQogICAg\nICogZWFybGllciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNhbWUgY2xhc3MuIERl\nZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAgICAqIHdoZW4gYSB0b29sIGlz\nIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBhbm5vdGF0aW9uIHBhcnRpYWwg\nbWFwcGluZwogICAgICogaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQgZXZlbiB3\naGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4gYW5vdGhlcgogICAgICogbG9j\nYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1hcHBpbmdPdmVy\ncmlkZShib29sZWFuIG92ZXJyaWRlKSB7CiAgICAgICAgX292ZXJyaWRlID0g\nb3ZlcnJpZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9k\nZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRNb2RlKCkgewogICAgICAg\nIHJldHVybiBfbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwYXJz\nZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGludCBt\nb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9O\nT05FKQogICAgICAgICAgICBfbW9kZSA9IE1PREVfTk9ORTsKICAgICAgICBl\nbHNlIGlmIChvbikKICAgICAgICAgICAgX21vZGUgfD0gbW9kZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9tb2RlICY9IH5tb2RlOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldE1vZGUoaW50IG1vZGUpIHsKICAgICAgICBfbW9kZSA9IG1v\nZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2Qg\nZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01ldGFEYXRhTW9kZSgpIHsKICAgICAg\nICByZXR1cm4gKF9tb2RlICYgTU9ERV9NRVRBKSAhPSAwOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRp\nbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaXNRdWVyeU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9kZSAm\nIE1PREVfUVVFUlkpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZW5pZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1v\nZGV9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01hcHBpbmdN\nb2RlKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX01BUFBJTkcp\nICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYg\nd2UncmUgaW4gbWFwcGluZyBtb2RlIG9yIGluIG1ldGFkYXRhIG1vZGUgd2l0\naAogICAgICogbWFwcGluZyBvdmVyaWRlIGVuYWJsZWQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBib29sZWFuIGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpIHsK\nICAgICAgICByZXR1cm4gaXNNYXBwaW5nTW9kZSgpIHx8IChfb3ZlcnJpZGUg\nJiYgaXNNZXRhRGF0YU1vZGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nbGVhciBjYWNoZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkg\newogICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgIF9maWxlID0gbnVsbDsK\nICAgICAgICBfcGtncy5jbGVhcigpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgcGVyc2lzdGVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFz\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcGFyc2UoQ2xhc3MgY2xzKSB7\nCiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtY2xhc3MiLCBjbHMuZ2V0\nTmFtZSgpKSk7CgogICAgICAgIF9jbHMgPSBjbHM7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcGFyc2VQYWNrYWdlQW5ub3RhdGlvbnMoKTsKICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcGFyc2VDbGFzc0Fubm90YXRp\nb25zKCk7CiAgICAgICAgICAgIHVwZGF0ZVNvdXJjZU1vZGUobWV0YSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2NscyA9IG51bGw7CiAg\nICAgICAgICAgIF9maWxlID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBVcGRhdGUgdGhlIHNvdXJjZSBtb2RlIHRvIHRoZSBjbGFz\ncyBwYWNrYWdlIGFuZCBjbGFzcyB0byBpbmRpY2F0ZSB0aGF0CiAgICAgKiB3\nZSd2ZSBmdWxseSBwYXJzZWQgdGhlbS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHVwZGF0ZVNvdXJjZU1vZGUoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKF9jbHMuZ2V0UGFja2FnZSgpICE9IG51bGwpCiAgICAgICAg\nICAgIGFkZFNvdXJjZU1vZGUoX2Nscy5nZXRQYWNrYWdlKCksIF9tb2RlKTsK\nICAgICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICBtZXRhLnNl\ndFNvdXJjZU1vZGUoX21vZGUsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgaW5mb3JtYXRpb24gaW4gcGFja2FnZS1sZXZlbCBjbGFzcyBh\nbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGFj\na2FnZUFubm90YXRpb25zKCkgewogICAgICAgIFBhY2thZ2UgcGtnID0gX2Ns\ncy5nZXRQYWNrYWdlKCk7CiAgICAgICAgaWYgKHBrZyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGludCBwa2dNb2RlID0gZ2V0U291\ncmNlTW9kZShwa2cpOwogICAgICAgIGlmIChwa2dNb2RlID09IDAgJiYgX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJwYXJzZS1wYWNrYWdlIiwgX2Nscy5nZXROYW1lKCkpKTsKICAg\nICAgICBpZiAoKHBrZ01vZGUgJiBfbW9kZSkgPT0gX21vZGUpIC8vIGFscmVh\nZHkgdmlzaXRlZAogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1ldGFE\nYXRhVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90YXRpb24gYW5ubyA6IHBr\nZy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFn\nID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAg\nICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxl\nVW5rbm93blBhY2thZ2VBbm5vdGF0aW9uKHBrZywgYW5ubyk7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2UgTkFUSVZFX1FV\nRVJJRVM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkg\nJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhwa2csCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoKE5hbWVkTmF0aXZlUXVlcmllcykg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSWToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVf\nUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFt\nZWROYXRpdmVRdWVyaWVzKHBrZywgKE5hbWVkTmF0aXZlUXVlcnkpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBRVUVSSUVTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5\nTW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMocGtnLCAoKE5h\nbWVkUXVlcmllcykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFVRVJZOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYg\nTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFy\nc2VOYW1lZFF1ZXJpZXMocGtnLCAoTmFtZWRRdWVyeSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNF\nUV9HRU5FUkFUT1I6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGlu\nZ092ZXJyaWRlTW9kZSgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChw\na2dNb2RlICYgTU9ERV9NQVBQSU5HKSA9PSAwKQogICAgICAgICAgICAgICAg\nICAgICAgICBwYXJzZVNlcXVlbmNlR2VuZXJhdG9yKHBrZywgKFNlcXVlbmNl\nR2VuZXJhdG9yKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1\ncHBvcnRlZCIsIHBrZywKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50\nb1N0cmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIGFsd2F5cyBwYXJzZSBtYXBwaW5nIHN0dWZmIGFmdGVyIG1ldGFkYXRh\nIHN0dWZmLCBpbiBjYXNlIHRoZXJlIGFyZQogICAgICAgIC8vIGRlcGVuZGVu\nY2llcyBvbiBtZXRhZGF0YQogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlk\nZU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfTUFQUElORykgPT0gMCkKICAg\nICAgICAgICAgcGFyc2VQYWNrYWdlTWFwcGluZ0Fubm90YXRpb25zKHBrZyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBwYWNrYWdlIG1hcHBpbmcg\nYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNl\nUGFja2FnZU1hcHBpbmdBbm5vdGF0aW9ucyhQYWNrYWdlIHBrZykgewogICAg\nfQoKICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUg\ndW5rbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaGFuZGxlVW5rbm93blBhY2thZ2VBbm5vdGF0aW9uKFBhY2thZ2Ug\ncGtnLAogICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9k\nZSBmb3IgdGhlIGdpdmVuIHBhY2thZ2UuCiAgICAgKi8KICAgIHByaXZhdGUg\naW50IGdldFNvdXJjZU1vZGUoUGFja2FnZSBwa2cpIHsKICAgICAgICBOdW1i\nZXIgbnVtID0gX3BrZ3MuZ2V0KHBrZyk7CiAgICAgICAgcmV0dXJuIChudW0g\nPT0gbnVsbCkgPyAwIDogbnVtLmludFZhbHVlKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgdG8gdGhlIHNvdXJjZSBtb2RlIGZvciB0aGUgZ2l2ZW4g\ncGFja2FnZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNvdXJjZU1v\nZGUoUGFja2FnZSBwa2csIGludCBtb2RlKSB7CiAgICAgICAgSW50ZWdlciBu\ndW0gPSBfcGtncy5nZXQocGtnKTsKICAgICAgICBpZiAobnVtID09IG51bGwp\nCiAgICAgICAgICAgIG51bSA9IE51bWJlcnMudmFsdWVPZihtb2RlKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIG51bSA9IE51bWJlcnMudmFsdWVPZihu\ndW0uaW50VmFsdWUoKSB8IG1vZGUpOwogICAgICAgIF9wa2dzLnB1dChwa2cs\nIG51bSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIGFubm90YXRpb25z\nIGZvciB0aGUgY3VycmVudCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIENs\nYXNzTWV0YURhdGEgcGFyc2VDbGFzc0Fubm90YXRpb25zKCkgewogICAgICAg\nIC8vIGNoZWNrIGltbWVkaWF0ZWx5IHdoZXRoZXIgdGhlIHVzZXIgaXMgdXNp\nbmcgYW55IGFubm90YXRpb25zLAogICAgICAgIC8vIHJlZ2FyZGxlc3Mgb2Yg\nbW9kZS4gIHRoaXMgcHJldmVudHMgYWRkaW5nIG5vbi1lbnRpdHkgY2xhc3Nl\ncyB0bwogICAgICAgIC8vIHJlcG9zaXRvcnkgaWYgd2UncmUgaWdub3Jpbmcg\ndGhlc2UgYW5ub3RhdGlvbnMgaW4gbWFwcGluZyBtb2RlCiAgICAgICAgaWYg\nKCEoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoy\nRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAuaXNBbm5vdGF0aW9uUHJlc2Vu\ndEFjdGlvbihfY2xzLCBFbnRpdHkuY2xhc3MpKSkuYm9vbGVhblZhbHVlKCkK\nICAgICAgICAgICAgJiYgISgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoSjJEb1ByaXY1SGVscGVyCiAgICAgICAgICAgICAgICAu\naXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihfY2xzLCBFbWJlZGRhYmxlLmNs\nYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkKICAgICAg\nICAgICAgJiYgISgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoSjJEb1ByaXY1SGVscGVyCiAgICAgICAgICAgICAgICAuaXNBbm5v\ndGF0aW9uUHJlc2VudEFjdGlvbihfY2xzLCBNYXBwZWRTdXBlcmNsYXNzLmNs\nYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBmaW5kIC8gY3JlYXRl\nIG1ldGFkYXRhCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0TWV0\nYURhdGEoKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgRW50aXR5IGVudGl0eSA9IChFbnRp\ndHkpIF9jbHMuZ2V0QW5ub3RhdGlvbihFbnRpdHkuY2xhc3MpOwogICAgICAg\nIE1hcHBlZFN1cGVyY2xhc3MgbWFwcGVkID0gKE1hcHBlZFN1cGVyY2xhc3Mp\nCiAgICAgICAgX2Nscy5nZXRBbm5vdGF0aW9uKE1hcHBlZFN1cGVyY2xhc3Mu\nY2xhc3MpOwogICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKSB7CiAgICAg\nICAgICAgIG1ldGEuc2V0QWJzdHJhY3QobWFwcGVkICE9IG51bGwpOwogICAg\nICAgICAgICAvLyB3aGlsZSB0aGUgc3BlYyBvbmx5IHByb3ZpZGVzIGZvciBl\nbWJlZGRlZCBleGNsdXNpdmUsIGl0IGRvZXNuJ3QKICAgICAgICAgICAgLy8g\nc2VlbSBoYXJkIHRvIHN1cHBvcnQgb3RoZXJ3aXNlCiAgICAgICAgICAgIGlm\nIChlbnRpdHkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RW1i\nZWRkZWRPbmx5KHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIG1ldGEuc2V0RW1iZWRkZWRPbmx5KGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShlbnRpdHkubmFtZSgp\nKSkKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFR5cGVBbGlhcyhlbnRp\ndHkubmFtZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gdHJhY2sgZmV0Y2ggZ3JvdXBzIHRvIHBhcnNlIHRoZW0gYWZ0ZXIgZmll\nbGRzLCBzaW5jZSB0aGV5CiAgICAgICAgLy8gcmVseSBvbiBmaWVsZCBtZXRh\nZGF0YQogICAgICAgIEZldGNoR3JvdXBbXSBmZ3MgPSBudWxsOwogICAgICAg\nIERldGFjaGVkU3RhdGUgZGV0YWNoZWQgPSBudWxsOwoKICAgICAgICAvLyB0\ncmFjayBsaXN0ZW5lcnMgc2luY2Ugd2UgbmVlZCB0byBtZXJnZSB0aGVtIHdp\ndGggZW50aXR5IGNhbGxiYWNrcwogICAgICAgIENvbGxlY3Rpb248TGlmZWN5\nY2xlQ2FsbGJhY2tzPltdIGxpc3RlbmVycyA9IG51bGw7CiAgICAgICAgTWV0\nYURhdGFUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDog\nX2Nscy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAg\ndGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAg\nICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFu\nZGxlVW5rbm93bkNsYXNzQW5ub3RhdGlvbihtZXRhLCBhbm5vKTsKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBFTlRJVFlf\nTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnMgPSBw\nYXJzZUVudGl0eUxpc3RlbmVycyhtZXRhLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKEVudGl0eUxpc3RlbmVycykgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYQ0xVREVf\nREVGQVVMVF9MSVNURU5FUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEu\nZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLnNldElnbm9yZVN5c3RlbUxpc3RlbmVycyh0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhD\nTFVERV9TVVBFUkNMQVNTX0xJU1RFTkVSUzoKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgbWV0YS5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpLnNldElnbm9yZVN1cGVy\nY2xhc3NDYWxsYmFja3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChM\naWZlY3ljbGVNZXRhRGF0YS5JR05PUkVfSElHSCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUobWV0YSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIElEX0NMQVNTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhLnNldE9iamVj\ndElkVHlwZSgoKElkQ2xhc3MpIGFubm8pLnZhbHVlKCksIHRydWUpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBO\nQVRJVkVfUVVFUklFUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVy\neU1vZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZ\nKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0\naXZlUXVlcmllcyhfY2xzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKChOYW1lZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBOQVRJ\nVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2Rl\nKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9RVUVSWSkgPT0g\nMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZE5hdGl2ZVF1\nZXJpZXMoX2NscywgKE5hbWVkTmF0aXZlUXVlcnkpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBRVUVS\nSUVTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYm\nIChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfUVVFUlkpID09IDApCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKF9jbHMs\nICgoTmFtZWRRdWVyaWVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUlk6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKG1ldGEu\nZ2V0U291cmNlTW9kZSgpICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAg\nICAgICAgICAgICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMoX2NscywgKE5hbWVk\nUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihfY2xzLCAo\nU2VxdWVuY2VHZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBEQVRBX0NBQ0hFOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBwYXJzZURhdGFDYWNoZShtZXRhLCAoRGF0YUNh\nY2hlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgREFUQVNUT1JFX0lEOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBwYXJzZURhdGFTdG9yZUlkKG1ldGEsIChEYXRhU3RvcmVJZCkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIERFVEFDSEVEX1NUQVRFOgogICAgICAgICAgICAgICAgICAgIGRl\ndGFjaGVkID0gKERldGFjaGVkU3RhdGUpIGFubm87CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZFVENIX0dST1VQ\nOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBmZ3MgPSBuZXcgRmV0Y2hHcm91cFtd\neyAoRmV0Y2hHcm91cCkgYW5ubyB9OwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGRVRDSF9HUk9VUFM6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZncyA9ICgoRmV0Y2hHcm91cHMpIGFubm8pLnZh\nbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIE1BTkFHRURfSU5URVJGQUNFOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBwYXJzZU1hbmFnZWRJbnRlcmZhY2UobWV0YSwgKE1hbmFnZWRJbnRl\ncmZhY2UpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9y\ndGVkIiwgX2NscywKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0\ncmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKSB7CiAgICAgICAgICAgIHBhcnNlRGV0YWNo\nZWRTdGF0ZShtZXRhLCBkZXRhY2hlZCk7CgogICAgICAgICAgICAvLyBtZXJn\nZSBjYWxsYmFjayBtZXRob2RzIHdpdGggZGVjbGFyZWQgbGlzdGVuZXJzCiAg\nICAgICAgICAgIGludFtdIGhpZ2hzID0gbnVsbDsKICAgICAgICAgICAgaWYg\nKGxpc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBoaWdocyA9\nIG5ldyBpbnRbbGlzdGVuZXJzLmxlbmd0aF07CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzW2ldICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzW2ldID0gbGlzdGVuZXJzW2ld\nLnNpemUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWNvcmRDYWxs\nYmFja3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2NscywgbGlzdGVu\nZXJzLCBmYWxzZSwKICAgICAgICAgICAgICAgIGZhbHNlLCBnZXRSZXBvc2l0\nb3J5KCkpLCBoaWdocywgZmFsc2UpOwoKICAgICAgICAgICAgLy8gc2NhbiBw\nb3NzaWJseSBub24tUEMgaGllcmFyY2h5IGZvciBjYWxsYmFja3MuCiAgICAg\nICAgICAgIC8vIHJlZHVuZGFudCBmb3IgUEMgc3VwZXJjbGFzcyBidXQgd2Ug\nZG9uJ3Qga25vdyB0aGF0IHlldAogICAgICAgICAgICAvLyBzbyBsZXQgTGlm\nZWN5Y2xlTWV0YURhdGEgZGV0ZXJtaW5lIHRoYXQKICAgICAgICAgICAgaWYg\nKF9jbHMuZ2V0U3VwZXJjbGFzcygpICE9IG51bGwgJiYKICAgICAgICAgICAg\nICAgICFPYmplY3QuY2xhc3MuZXF1YWxzKF9jbHMuZ2V0U3VwZXJjbGFzcygp\nKSkgewogICAgICAgICAgICAgICAgcmVjb3JkQ2FsbGJhY2tzKG1ldGEsIHBh\ncnNlQ2FsbGJhY2tNZXRob2RzKF9jbHMuZ2V0U3VwZXJjbGFzcygpLAogICAg\nICAgICAgICAgICAgICAgIG51bGwsIHRydWUsIGZhbHNlLCBnZXRSZXBvc2l0\nb3J5KCkpLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RGVj\nbGFyZWRGaWVsZHMoKSkKICAgICAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2Vt\nZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAg\nICAgICAgICAgICAgIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMoZm1kKTsKICAg\nICAgICAvLyBwYXJzZSBmZXRjaCBncm91cHMgYWZ0ZXIgZmllbGRzCiAgICAg\nICAgaWYgKGZncyAhPSBudWxsKQogICAgICAgICAgICBwYXJzZUZldGNoR3Jv\ndXBzKG1ldGEsIGZncyk7CgogICAgICAgIC8vIGFsd2F5cyBwYXJzZSBtYXBw\naW5nIGFmdGVyIG1ldGFkYXRhIGluIGNhc2UgdGhlcmUgYXJlIGRlcGVuZGVu\nY2llcwogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkgewog\nICAgICAgICAgICBwYXJzZUNsYXNzTWFwcGluZ0Fubm90YXRpb25zKG1ldGEp\nOwogICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogbWV0YS5n\nZXREZWNsYXJlZEZpZWxkcygpKQogICAgICAgICAgICAgICAgaWYgKGZtZC5n\nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkKICAgICAgICAgICAgICAgICAgICBwYXJzZU1lbWJlck1hcHBpbmdB\nbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0\nYTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNsYXNzIG1hcHBpbmcg\nYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNl\nQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbnMoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhh\nbmRsZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0\nZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duQ2xhc3NBbm5vdGF0aW9uKENsYXNz\nTWV0YURhdGEgbWV0YSwKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5k\nIG9yIGNyZWF0ZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUuIE1heSBy\nZXR1cm4gbnVsbCBpZgogICAgICogdGhpcyBjbGFzcyBoYXMgYWxyZWFkeSBi\nZWVuIHBhcnNlZCBmdWxseS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01l\ndGFEYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRNZXRhRGF0YShfY2xz\nKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsICYmCiAgICAgICAgICAgICgo\naXNNZXRhRGF0YU1vZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBN\nT0RFX01FVEEpICE9IDApIHx8CiAgICAgICAgICAgICAgICAoaXNNYXBwaW5n\nTW9kZSgpICYmCiAgICAgICAgICAgICAgICAgICAgKG1ldGEuZ2V0U291cmNl\nTW9kZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwKSkpIHsKICAgICAgICAgICAg\naWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkdXAtbWV0YWRhdGEiLCBfY2xzLmdldE5hbWUo\nKSkpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIGlmIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgbWV0YSA9IGdl\ndFJlcG9zaXRvcnkoKS5hZGRNZXRhRGF0YShfY2xzKTsKICAgICAgICAgICAg\nbWV0YS5zZXRFbnZDbGFzc0xvYWRlcihfZW52TG9hZGVyKTsKICAgICAgICAg\nICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTk9ORSk7CiAgICAgICAgICAg\nIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgbWV0YS5TUkNfQU5O\nT1RBVElPTlMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgc291cmNlIGZpbGUg\nd2UncmUgcGFyc2luZy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpbGUgZ2V0\nU291cmNlRmlsZSgpIHsKICAgICAgICBpZiAoX2ZpbGUgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIF9maWxlOwoKICAgICAgICBDbGFzcyBjbHMgPSBf\nY2xzOwogICAgICAgIHdoaWxlIChjbHMuZ2V0RW5jbG9zaW5nQ2xhc3MoKSAh\nPSBudWxsKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0RW5jbG9zaW5nQ2xh\nc3MoKTsKCiAgICAgICAgU3RyaW5nIHJzcmMgPSBTdHJpbmdVdGlscy5yZXBs\nYWNlKGNscy5nZXROYW1lKCksICIuIiwgIi8iKTsKICAgICAgICBDbGFzc0xv\nYWRlciBsb2FkZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdjVIZWxwZXIuZ2V0\nQ2xhc3NMb2FkZXJBY3Rpb24oY2xzKSk7IAogICAgICAgIGlmIChsb2FkZXIg\nPT0gbnVsbCkKICAgICAgICAgICAgbG9hZGVyID0gKENsYXNzTG9hZGVyKSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAg\nIEoyRG9Qcml2NUhlbHBlci5nZXRTeXN0ZW1DbGFzc0xvYWRlckFjdGlvbigp\nKTsgCiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBVUkwgdXJsID0gKFVSTCkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2NUhl\nbHBlci5nZXRSZXNvdXJjZUFjdGlvbihsb2FkZXIsIHJzcmMgKyAiLmphdmEi\nKSk7IAogICAgICAgIGlmICh1cmwgPT0gbnVsbCkgewogICAgICAgICAgICB1\ncmwgPSAoVVJMKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgIEoyRG9Qcml2NUhlbHBlci5nZXRSZXNvdXJjZUFjdGlv\nbihsb2FkZXIsIHJzcmMgKyAiLmNsYXNzIikpOyAKICAgICAgICAgICAgaWYg\nKHVybCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9maWxlID0gbmV3\nIEZpbGUodXJsLnRvVVJJKCkpOwogICAgICAgIH0gY2F0Y2ggKFVSSVN5bnRh\neEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgfSBjYXRjaCAoSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uIGlhZSkgewogICAgICAgICAgICAvLyB0aGlzIGlzIHRo\ncm93biB3aGVuIHRoZSBVUkkgaXMgbm9uLWhpZXJhcmNoaWNhbCAoYWthIEpC\nb3NzKQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpbGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBARGF0YVN0b3JlSWQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwYXJzZURhdGFTdG9yZUlkKENsYXNzTWV0YURhdGEg\nbWV0YSwgRGF0YVN0b3JlSWQgaWQpIHsKICAgICAgICBtZXRhLnNldElkZW50\naXR5VHlwZShDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSk7CgogICAgICAg\nIGludCBzdHJhdCA9IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3kobWV0YSwg\naWQuc3RyYXRlZ3koKSwKICAgICAgICAgICAgaWQuZ2VuZXJhdG9yKCkpOwog\nICAgICAgIGlmIChzdHJhdCAhPSAtMSkKICAgICAgICAgICAgbWV0YS5zZXRJ\nZGVudGl0eVN0cmF0ZWd5KHN0cmF0KTsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgc3dpdGNoIChpZC5zdHJhdGVneSgpKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgY2FzZSBTRVFVRU5DRToK\nICAgICAgICAgICAgICAgICAgICAvLyB0ZWNobmljYWxseSB3ZSBzaG91bGQg\naGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5kCiAgICAgICAgICAgICAg\nICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywgYnV0IGl0J3MgZWFzaWVy\nIHRvIGp1c3QgcmVseSBvbgogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBz\neXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVlbmNlIHNldHRpbmcgZm9y\nIGJvdGgKICAgICAgICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShpZC5nZW5lcmF0b3IoKSkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVNKTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoaWQuZ2VuZXJhdG9y\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBBVVRPOgogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0SWRl\nbnRpdHlTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSURF\nTlRJVFk6CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0\ncmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKGlkLnN0cmF0ZWd5KCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXYXJuIHRoYXQgQEZs\ndXNoTW9kZSBpcyBub3Qgc3VwcG9ydGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgd2FybkZsdXNoTW9kZShPYmplY3QgY29udGV4dCkgewogICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy53\nYXJuKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsICJGbHVzaE1vZGUiLCBjb250\nZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARGF0YUNhY2hl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEYXRhQ2FjaGUoQ2xh\nc3NNZXRhRGF0YSBtZXRhLCBEYXRhQ2FjaGUgY2FjaGUpIHsKICAgICAgICBp\nZiAoY2FjaGUudGltZW91dCgpICE9IEludGVnZXIuTUlOX1ZBTFVFKQogICAg\nICAgICAgICBtZXRhLnNldERhdGFDYWNoZVRpbWVvdXQoY2FjaGUudGltZW91\ndCgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoY2FjaGUu\nbmFtZSgpKSkKICAgICAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVOYW1lKGNh\nY2hlLm5hbWUoKSk7CiAgICAgICAgZWxzZSBpZiAoY2FjaGUuZW5hYmxlZCgp\nKQogICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZU5hbWUoCiAgICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRhdGFDYWNo\nZS5OQU1FX0RFRkFVTFQpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbWV0\nYS5zZXREYXRhQ2FjaGVOYW1lKG51bGwpOwogICAgICAgIAogICAgICAgIG1l\ndGEuc2V0SXNDYWNoZWFibGUoY2FjaGUuZW5hYmxlZCgpLCB0cnVlKTsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYW5hZ2VkSW50ZXJmYWNlKENs\nYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBNYW5hZ2VkSW50ZXJmYWNlIGlm\nYWNlKSB7CiAgICAgICAgbWV0YS5zZXRNYW5hZ2VkSW50ZXJmYWNlKHRydWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQERldGFjaGVkU3RhdGUu\nIFRoZSBhbm5vdGF0aW9uIG1heSBiZSBudWxsLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VEZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEgbWV0\nYSwKICAgICAgICBEZXRhY2hlZFN0YXRlIGRldGFjaGVkKSB7CiAgICAgICAg\naWYgKGRldGFjaGVkICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKCFkZXRh\nY2hlZC5lbmFibGVkKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldERldGFj\naGVkU3RhdGUobnVsbCk7CiAgICAgICAgICAgIGVsc2UgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkoZGV0YWNoZWQuZmllbGROYW1lKCkpKQogICAgICAgICAg\nICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEuU1lO\nVEhFVElDKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWV0\nYS5zZXREZXRhY2hlZFN0YXRlKGRldGFjaGVkLmZpZWxkTmFtZSgpKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICBGaWVsZFtdIGZpZWxkcyA9IChG\naWVsZFtdKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgIEoyRG9Qcml2NUhlbHBlci5nZXREZWNsYXJlZEZpZWxkc0Fj\ndGlvbigKICAgICAgICAgICAgICAgICAgICBtZXRhLmdldERlc2NyaWJlZFR5\ncGUoKSkpOyAKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVs\nZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoKChCb29sZWFu\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdjVIZWxw\nZXIKICAgICAgICAgICAgICAgICAgICAuaXNBbm5vdGF0aW9uUHJlc2VudEFj\ndGlvbihmaWVsZHNbaV0sIERldGFjaGVkU3RhdGUuY2xhc3MpKSkKICAgICAg\nICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkpCiAgICAgICAgICAgICAg\nICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKGZpZWxkc1tpXS5nZXROYW1l\nKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBF\nbnRpdHlMaXN0ZW5lcnMKICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9u\nPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBwYXJzZUVudGl0eUxpc3RlbmVycwog\nICAgICAgIChDbGFzc01ldGFEYXRhIG1ldGEsIEVudGl0eUxpc3RlbmVycyBs\naXN0ZW5lcnMpIHsKICAgICAgICBDbGFzc1tdIGNsYXNzZXMgPSBsaXN0ZW5l\ncnMudmFsdWUoKTsKICAgICAgICBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxi\nYWNrcz5bXSBwYXJzZWQgPSBudWxsOwogICAgICAgIGZvciAoQ2xhc3MgY2xz\nIDogY2xhc3NlcykKICAgICAgICAgICAgcGFyc2VkID0gcGFyc2VDYWxsYmFj\na01ldGhvZHMoY2xzLCBwYXJzZWQsIHRydWUsIHRydWUsIAogICAgICAgICAg\nICAgICAgZ2V0UmVwb3NpdG9yeSgpKTsKICAgICAgICByZXR1cm4gcGFyc2Vk\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgY2FsbGJhY2sgbWV0aG9k\ncyBpbnRvIHRoZSBnaXZlbiBhcnJheSwgYW5kIHJldHVybiB0aGF0IGFycmF5\nLAogICAgICogY3JlYXRpbmcgb25lIGlmIG51bGwuIEVhY2ggaW5kZXggaW50\nbyB0aGUgYXJyYXkgaXMgYSBjb2xsZWN0aW9uIG9mCiAgICAgKiBjYWxsYmFj\nayBhZGFwdGVycyBmb3IgdGhhdCBudW1lcmljIGV2ZW50IHR5cGUuCiAgICAg\nKgogICAgICogQHBhcmFtIHN1cHMgd2hldGhlciB0byBzY2FuIHN1cGVyY2xh\nc3NlcwogICAgICogQHBhcmFtIGxpc3RlbmVyIHdoZXRoZXIgdGhpcyBpcyBh\nIGxpc3RlbmVyIG9yIG5vdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIENv\nbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIHBhcnNlQ2FsbGJhY2tN\nZXRob2RzCiAgICAgICAgKENsYXNzIGNscywgQ29sbGVjdGlvbjxMaWZlY3lj\nbGVDYWxsYmFja3M+W10gY2FsbGJhY2tzLCBib29sZWFuIHN1cHMsCiAgICAg\nICAgYm9vbGVhbiBsaXN0ZW5lciwgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nKSB7CgogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiY2xzIGNhbm5vdCBi\nZSBudWxsIik7CgogICAgICAgIC8vIGZpcnN0IHNvcnQgLyBmaWx0ZXIgYmFz\nZWQgb24gaW5oZXJpdGFuY2UKICAgICAgICBTZXQ8TWV0aG9kPiBtZXRob2Rz\nID0gbmV3IFRyZWVTZXQ8TWV0aG9kPihNZXRob2RDb21wYXJhdG9yLgogICAg\nICAgICAgICBnZXRJbnN0YW5jZSgpKTsKCiAgICAgICAgaW50IG1vZHM7CiAg\nICAgICAgQ2xhc3Mgc3VwID0gY2xzOwogICAgICAgIE1ldGhvZEtleSBrZXk7\nCiAgICAgICAgU2V0PE1ldGhvZEtleT4gc2VlbiA9IG5ldyBIYXNoU2V0PE1l\ndGhvZEtleT4oKTsKICAgICAgICBkbyB7CiAgICAgICAgICAgIGZvciAoTWV0\naG9kIG0gOiAoTWV0aG9kW10pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXY1SGVscGVyLmdldERlY2xh\ncmVkTWV0aG9kc0FjdGlvbihzdXApKSkgewogICAgICAgICAgICAgICAgbW9k\ncyA9IG0uZ2V0TW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICBpZiAoTW9k\naWZpZXIuaXNTdGF0aWMobW9kcykgfHwgTW9kaWZpZXIuaXNGaW5hbChtb2Rz\nKSB8fAogICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcy5lcXVhbHMo\nbS5nZXREZWNsYXJpbmdDbGFzcygpKSkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICBrZXkgPSBuZXcgTWV0aG9kS2V5\nKG0pOwogICAgICAgICAgICAgICAgaWYgKCFzZWVuLmNvbnRhaW5zKGtleSkp\nIHsKICAgICAgICAgICAgICAgICAgICBtZXRob2RzLmFkZChtKTsKICAgICAg\nICAgICAgICAgICAgICBzZWVuLmFkZChrZXkpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1cCA9IHN1cC5nZXRTdXBl\ncmNsYXNzKCk7CiAgICAgICAgfSB3aGlsZSAoc3VwcyAmJiAhT2JqZWN0LmNs\nYXNzLmVxdWFscyhzdXApKTsKCiAgICAgICAgTWV0YURhdGFEZWZhdWx0cyBk\nZWYgPSByZXBvcy5nZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygp\nOwogICAgICAgIGZvciAoTWV0aG9kIG0gOiBtZXRob2RzKSB7CiAgICAgICAg\nICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogKEFubm90YXRpb25bXSkgQWNj\nZXNzQ29udHJvbGxlcgogICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChK\nMkRvUHJpdjVIZWxwZXIKICAgICAgICAgICAgICAgICAgICAuZ2V0RGVjbGFy\nZWRBbm5vdGF0aW9uc0FjdGlvbihtKSkpIHsKICAgICAgICAgICAgICAgIE1l\ndGFEYXRhVGFnIHRhZyA9IF90YWdzLmdldChhbm5vLmFubm90YXRpb25UeXBl\nKCkpOwogICAgICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaW50W10g\nZXZlbnRzID0gTWV0YURhdGFQYXJzZXJzLmdldEV2ZW50VHlwZXModGFnKTsK\nICAgICAgICAgICAgICAgIGlmIChldmVudHMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBpZiAoY2Fs\nbGJhY2tzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tz\nID0gKENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdKQogICAgICAg\nICAgICAgICAgICAgICAgICBuZXcgQ29sbGVjdGlvbltMaWZlY3ljbGVFdmVu\ndC5BTExfRVZFTlRTLmxlbmd0aF07CgogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICBpbnQgZSA9IGV2ZW50c1tpXTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoY2FsbGJhY2tzW2VdID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNhbGxiYWNrc1tlXSA9IG5ldyBBcnJheUxpc3QoMyk7CiAg\nICAgICAgICAgICAgICAgICAgTWV0YURhdGFQYXJzZXJzLnZhbGlkYXRlTWV0\naG9kc0ZvclNhbWVDYWxsYmFjayhjbHMsIAogICAgICAgICAgICAgICAgICAg\nICAgICBjYWxsYmFja3NbZV0sIG0sIHRhZywgZGVmLCByZXBvcy5nZXRMb2co\nKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RlbmVyKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tlXS5hZGQobmV3IEJlYW5M\naWZlY3ljbGVDYWxsYmFja3MoY2xzLCBtLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZmFsc2UpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbZV0uYWRkKG5l\ndyBNZXRob2RMaWZlY3ljbGVDYWxsYmFja3MobSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBjYWxsYmFja3M7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogU3RvcmUgbGlmZWN5Y2xlIG1ldGFkYXRhLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVjb3JkQ2FsbGJhY2tzKENsYXNzTWV0YURhdGEgY2xzLAog\nICAgICAgIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIGNhbGxi\nYWNrcywgaW50W10gaGlnaHMsCiAgICAgICAgYm9vbGVhbiBzdXBlckNsYXNz\nKSB7CiAgICAgICAgaWYgKGNhbGxiYWNrcyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgTGlmZWN5Y2xlTWV0YURhdGEgbWV0YSA9IGNs\ncy5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpOwogICAgICAgIExpZmVjeWNsZUNh\nbGxiYWNrc1tdIGFycmF5OwogICAgICAgIGZvciAoaW50IGV2ZW50IDogTGlm\nZWN5Y2xlRXZlbnQuQUxMX0VWRU5UUykgewogICAgICAgICAgICBpZiAoY2Fs\nbGJhY2tzW2V2ZW50XSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIGFycmF5ID0gY2FsbGJhY2tzW2V2ZW50XS50b0Fy\ncmF5CiAgICAgICAgICAgICAgICAobmV3IExpZmVjeWNsZUNhbGxiYWNrc1tj\nYWxsYmFja3NbZXZlbnRdLnNpemUoKV0pOwoKICAgICAgICAgICAgaWYgKHN1\ncGVyQ2xhc3MpIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0Tm9uUENTdXBl\ncmNsYXNzQ2FsbGJhY2tzKGV2ZW50LCBhcnJheSwKICAgICAgICAgICAgICAg\nICAgICAoaGlnaHMgPT0gbnVsbCkgPyAwIDogaGlnaHNbZXZlbnRdKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGVj\nbGFyZWRDYWxsYmFja3MoZXZlbnQsIGFycmF5LAogICAgICAgICAgICAgICAg\nICAgIChoaWdocyA9PSBudWxsKSA/IDAgOiBoaWdoc1tldmVudF0pOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGZldGNoIGdyb3Vwcy4KICAgICAqIElmIEZldGNoR3JvdXAgQSBpbmNs\ndWRlcyBGZXRjaEdyb3VwIEIsIHRoZW4gYSBiaS1saW5rIGlzIHNldCBiZXR3\nZWVuCiAgICAgKiBBIGFuZCBCLiBCb3RoIEEgYW5kIEIgbXVzdCBiZSBkZWNs\nYXJlZCBpbiB0aGUgc2FtZSBDbGFzcy4gCiAgICAgKiA8YnI+CiAgICAgKiBD\nYWxsIHtAbGluayAjcGFyc2VGZXRjaEF0dHJpYnV0ZShDbGFzc01ldGFEYXRh\nLCAKICAgICAqIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXAs\nIEZldGNoQXR0cmlidXRlKSBvbmx5IGFmdGVyIHRoZQogICAgICogYmktbGlu\na3MgaGF2ZSBiZWVuIGVzdGFibGlzaGVkLCBiZWNhdXNlIGEgZmllbGQgZiB3\naWxsIG5vdCBvbmx5IGFkZCB0aGUKICAgICAqIGZldGNoIGdyb3VwIEEgd2hp\nY2ggZXhwbGljdGx5IGluY2x1ZGVzIGYgdG8gaXRzIGN1c3RvbSBmZXRjaCBn\ncm91cHMgYnV0IAogICAgICogYWxzbyB3aWxsIGFsc28gYWRkIGFueSBmZXRj\naCBncm91cCBCIHRoYXQgaW5jbHVkZXMgQS4gIAogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VGZXRjaEdyb3VwcyhDbGFzc01ldGFEYXRhIG1ldGEs\nIEZldGNoR3JvdXAuLi4gZ3JvdXBzKSB7CiAgICAgICAgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmV0Y2hHcm91cCBmZzsKICAgICAgICBmb3IgKEZldGNo\nR3JvdXAgZ3JvdXAgOiBncm91cHMpIHsKICAgICAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkoZ3JvdXAubmFtZSgpKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5uYW1l\nZC1mZyIsIG1ldGEpKTsKCiAgICAgICAgICAgIGZnID0gbWV0YS5hZGREZWNs\nYXJlZEZldGNoR3JvdXAoZ3JvdXAubmFtZSgpKTsKICAgICAgICAgICAgaWYg\nKGdyb3VwLnBvc3RMb2FkKCkpCiAgICAgICAgICAgICAgICBmZy5zZXRQb3N0\nTG9hZCh0cnVlKTsgCiAgICAgICAgICAgIGZvciAoU3RyaW5nIHMgOiBncm91\ncC5mZXRjaEdyb3VwcygpKSB7CiAgICAgICAgICAgICAgICBmZy5hZGREZWNs\nYXJlZEluY2x1ZGUocyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgLy8gQWRkIHRoZSBwYXJlbnQtY2hpbGQgc3R5bGUgYmktbGlua3MgYmV0\nd2VlbiBmZXRjaCBncm91cHMgaW4gYSAKICAgICAgICAvLyBzZXBhcmF0ZSBw\nYXNzLiAKICAgICAgICBmb3IgKEZldGNoR3JvdXAgZ3JvdXA6Z3JvdXBzKSB7\nCiAgICAgICAgCWZnID0gbWV0YS5nZXRGZXRjaEdyb3VwKGdyb3VwLm5hbWUo\nKSk7CiAgICAgICAgCVN0cmluZ1tdIGluY2x1ZGVkRmV0Y2hHcm9wTmFtZXMg\nPSBmZy5nZXREZWNsYXJlZEluY2x1ZGVzKCk7CiAgICAgICAgCWZvciAoU3Ry\naW5nIGluY2x1ZGVkRmVjdGNoR3JvdXBOYW1lOmluY2x1ZGVkRmV0Y2hHcm9w\nTmFtZXMpIHsKICAgICAgICAJCW9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZl\ndGNoR3JvdXAgY2hpbGQgPQogICAgICAgIAkgICAgbWV0YS5nZXRGZXRjaEdy\nb3VwKGluY2x1ZGVkRmVjdGNoR3JvdXBOYW1lKTsKICAgICAgICAJCWlmIChj\naGlsZCA9PSBudWxsKSAKICAgICAgICAJCQl0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibWlzc2luZy1pbmNsdWRlZC1mZyIsIAogICAgICAg\nIAkJCQltZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCksIGZnLmdl\ndE5hbWUoKSwKICAgICAgICAJCQkJaW5jbHVkZWRGZWN0Y2hHcm91cE5hbWUp\nKTsKICAgICAgICAJCWNoaWxkLmFkZENvbnRhaW5lZEJ5KGZnKTsKICAgICAg\nICAJfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgKEZldGNoR3Jv\ndXAgZ3JvdXAgOiBncm91cHMpIHsKICAgICAgICAgICAgZmcgPSBtZXRhLmdl\ndEZldGNoR3JvdXAoZ3JvdXAubmFtZSgpKTsKICAgICAgICAgICAgZm9yIChG\nZXRjaEF0dHJpYnV0ZSBhdHRyIDogZ3JvdXAuYXR0cmlidXRlcygpKQogICAg\nICAgICAgICAgICAgcGFyc2VGZXRjaEF0dHJpYnV0ZShtZXRhLCBmZywgYXR0\ncik7CiAgICAgICAgfQogICAgfQogICAgCgogICAgLyoqCiAgICAgKiBTZXQg\nYSBmaWVsZCdzIGZldGNoIGdyb3VwLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VGZXRjaEF0dHJpYnV0ZShDbGFzc01ldGFEYXRhIG1ldGEsIAog\nICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXAgZmcs\nIEZldGNoQXR0cmlidXRlIGF0dHIpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZpZWxkID0gbWV0YS5nZXREZWNsYXJlZEZpZWxkKGF0dHIubmFtZSgpKTsK\nICAgICAgICBpZiAoZmllbGQgPT0gbnVsbAogICAgICAgICAgICB8fCBmaWVs\nZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVS\nU0lTVEVOVCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtZmctZmllbGQiLCBmZy5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICBtZXRhLCBhdHRyLm5hbWUoKSkpOwoKICAgICAgICBm\naWVsZC5zZXRJbkZldGNoR3JvdXAoZmcuZ2V0TmFtZSgpLCB0cnVlKTsKICAg\nICAgICBTZXQgcGFyZW50RmV0Y2hHcm91cHMgPSBmZy5nZXRDb250YWluZWRC\neSgpOwogICAgICAgIGZvciAoT2JqZWN0IHBhcmVudEZldGNoR3JvdXA6cGFy\nZW50RmV0Y2hHcm91cHMpCiAgICAgICAgCWZpZWxkLnNldEluRmV0Y2hHcm91\ncChwYXJlbnRGZXRjaEdyb3VwLnRvU3RyaW5nKCksIHRydWUpOwogICAgICAg\nIGlmIChhdHRyLnJlY3Vyc2lvbkRlcHRoKCkgIT0gSW50ZWdlci5NSU5fVkFM\nVUUpCiAgICAgICAgICAgIGZnLnNldFJlY3Vyc2lvbkRlcHRoKGZpZWxkLCBh\ndHRyLnJlY3Vyc2lvbkRlcHRoKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVhZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGdpdmVuIG1lbWJlci4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMoRmll\nbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBsb29rIGZvciBwZXJzaXN0\nZW5jZSBzdHJhdGVneSBpbiBhbm5vdGF0aW9uIHRhYmxlCiAgICAgICAgTWVt\nYmVyIG1lbWJlciA9IGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3Rv\ncnkoKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICBnZXRCYWNraW5nTWVt\nYmVyKGZtZCk7CiAgICAgICAgUGVyc2lzdGVuY2VTdHJhdGVneSBwc3RyYXQg\nPSBQZXJzaXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMuCiAgICAgICAgICAgIGdl\ndFBlcnNpc3RlbmNlU3RyYXRlZ3koZm1kLCBtZW1iZXIpOwogICAgICAgIGlm\nIChwc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIGZtZC5zZXRFeHBsaWNpdCh0cnVlKTsKCiAgICAgICAgQW5ub3RhdGVkRWxl\nbWVudCBlbCA9IChBbm5vdGF0ZWRFbGVtZW50KSBtZW1iZXI7CiAgICAgICAg\nYm9vbGVhbiBsb2IgPSAoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAuaXNBbm5v\ndGF0aW9uUHJlc2VudEFjdGlvbihlbCwgTG9iLmNsYXNzKSkpLmJvb2xlYW5W\nYWx1ZSgpOwogICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKSB7CiAgICAg\nICAgICAgIHN3aXRjaCAocHN0cmF0KSB7CiAgICAgICAgICAgICAgICBjYXNl\nIEJBU0lDOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQmFzaWMoZm1kLCAo\nQmFzaWMpIGVsLmdldEFubm90YXRpb24oQmFzaWMuY2xhc3MpLCBsb2IpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBNQU5ZX09ORToKICAgICAgICAgICAgICAgICAgICBwYXJzZU1hbnlUb09u\nZShmbWQsIChNYW55VG9PbmUpIGVsLmdldEFubm90YXRpb24KICAgICAgICAg\nICAgICAgICAgICAgICAgKE1hbnlUb09uZS5jbGFzcykpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPTkVfT05F\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlT25lVG9PbmUoZm1kLCAoT25l\nVG9PbmUpIGVsLmdldEFubm90YXRpb24KICAgICAgICAgICAgICAgICAgICAg\nICAgKE9uZVRvT25lLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVNQkVEREVEOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlRW1iZWRkZWQoZm1kLCAoRW1iZWRkZWQpIGVsLmdl\ndEFubm90YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgKEVtYmVkZGVk\nLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIE9ORV9NQU5ZOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlT25lVG9NYW55KGZtZCwgKE9uZVRvTWFueSkgZWwuZ2V0QW5ub3RhdGlv\nbgogICAgICAgICAgICAgICAgICAgICAgICAoT25lVG9NYW55LmNsYXNzKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIE1BTllfTUFOWToKICAgICAgICAgICAgICAgICAgICBwYXJzZU1hbnlU\nb01hbnkoZm1kLCAoTWFueVRvTWFueSkgZWwuZ2V0QW5ub3RhdGlvbgogICAg\nICAgICAgICAgICAgICAgICAgICAoTWFueVRvTWFueS5jbGFzcykpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQ\nRVJTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUGVyc2lzdGVudChmbWQs\nIChQZXJzaXN0ZW50KSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAg\nICAgICAgICAgIChQZXJzaXN0ZW50LmNsYXNzKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBFUlNfQ09MTDoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZVBlcnNpc3RlbnRDb2xsZWN0aW9u\nKGZtZCwgKFBlcnNpc3RlbnRDb2xsZWN0aW9uKQogICAgICAgICAgICAgICAg\nICAgICAgICBlbC5nZXRBbm5vdGF0aW9uKFBlcnNpc3RlbnRDb2xsZWN0aW9u\nLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFBFUlNfTUFQOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlUGVyc2lzdGVudE1hcChmbWQsIChQZXJzaXN0ZW50TWFwKQogICAgICAg\nICAgICAgICAgICAgICAgICBlbC5nZXRBbm5vdGF0aW9uKFBlcnNpc3RlbnRN\nYXAuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgVFJBTlNJRU5UOgogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJy\naWRlTW9kZSgpICYmIGxvYikKICAgICAgICAgICAgcGFyc2VMb2JNYXBwaW5n\nKGZtZCk7CgogICAgICAgIC8vIGV4dGVuc2lvbnMKICAgICAgICBNZXRhRGF0\nYVRhZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBlbC5n\nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFnID0g\nX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAg\nIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxlVW5r\nbm93bk1lbWJlckFubm90YXRpb24oZm1kLCBhbm5vKTsKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0\nY2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBGTFVTSF9NT0RFOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICB3YXJuRmx1c2hNb2RlKGZtZCk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEdF\nTkVSQVRFRF9WQUxVRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBw\naW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlR2VuZXJhdGVkVmFsdWUoZm1kLCAoR2VuZXJhdGVkVmFsdWUpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBJRDoKICAgICAgICAgICAgICAgIGNhc2UgRU1CRURERURfSUQ6CiAg\nICAgICAgICAgICAgICAgICAgZm1kLnNldFByaW1hcnlLZXkodHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIE1BUF9LRVk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGluZ092\nZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZU1h\ncEtleShmbWQsIChNYXBLZXkpIGFubm8pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPUkRFUl9CWToKICAgICAg\nICAgICAgICAgICAgICBwYXJzZU9yZGVyQnkoZm1kLAogICAgICAgICAgICAg\nICAgICAgICAgICAoT3JkZXJCeSkgZWwuZ2V0QW5ub3RhdGlvbihPcmRlckJ5\nLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFNFUV9HRU5FUkFUT1I6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZVNlcXVlbmNlR2VuZXJhdG9yKGVsLCAoU2VxdWVu\nY2VHZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBWRVJTSU9OOgogICAgICAgICAgICAg\nICAgICAgIGZtZC5zZXRWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBERVBFTkRFTlQ6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkgJiYgKChE\nZXBlbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9BVVRPKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgRUxFTV9ERVBFTkRFTlQ6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWV0YURhdGFNb2RlKCkgJiYgKChFbGVtZW50RGVwZW5kZW50\nKSBhbm5vKS52YWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nZ2V0RWxlbWVudCgpLnNldENhc2NhZGVEZWxldGUKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEVMRU1fVFlQRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEVsZW1l\nbnQoKS5zZXRUeXBlT3ZlcnJpZGUodG9PdmVycmlkZVR5cGUKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICgoKEVsZW1lbnRUeXBlKSBhbm5vKS52YWx1\nZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEVYVEVSTkFMX1ZBTFM6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRFeHRlcm5hbFZhbHVlcyhTdHJpbmdzLmpvaW4oKChFeHRlcm5h\nbFZhbHVlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFubm8pLnZh\nbHVlKCksICIsIikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBFWFRFUk5BTElaRVI6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZtZC5zZXRFeHRlcm5hbGl6ZXIoKChFeHRlcm5hbGl6ZXIpIGFu\nbm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBGQUNUT1JZOgogICAgICAgICAgICAgICAgICAg\nIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAg\nICBmbWQuc2V0RmFjdG9yeSgoKEZhY3RvcnkpIGFubm8pLnZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBJTlZFUlNFX0xPR0lDQUw6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5z\nZXRJbnZlcnNlKCgoSW52ZXJzZUxvZ2ljYWwpIGFubm8pLnZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBLRVlfREVQRU5ERU5UOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01l\ndGFEYXRhTW9kZSgpICYmICgoS2V5RGVwZW5kZW50KSBhbm5vKS52YWx1ZSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5KCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVl\nTWV0YURhdGEuQ0FTQ0FERV9BVVRPKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX1RZUEU6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRUeXBlT3ZlcnJpZGUodG9P\ndmVycmlkZVR5cGUoKChLZXlUeXBlKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMT0FEX0ZFVENIX0dST1VQOgog\nICAgICAgICAgICAgICAgCWlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAg\nICAgICAgICAgCQlmbWQuc2V0TG9hZEZldGNoR3JvdXAoKChMb2FkRmV0Y2hH\ncm91cCkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAJYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIExSUzoKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZm1kLnNldExSUygoKExSUykgYW5ubykudmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFJFQURf\nT05MWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VSZWFkT25seShmbWQs\nIChSZWFkT25seSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFRZUEU6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZC5zZXRUeXBlT3ZlcnJpZGUodG9PdmVycmlkZVR5cGUoKChUeXBl\nKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIGZtZCwK\nICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBtZW1iZXIgbWFwcGluZyBjb21wb25lbnRzLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBwYXJzZU1lbWJlck1hcHBpbmdBbm5vdGF0aW9ucyhG\naWVsZE1ldGFEYXRhIGZtZCkgewogICAgfQoKICAgIC8qKgogICAgICogQWxs\nb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93biBhbm5vdGF0aW9ucy4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFuZGxlVW5rbm93bk1l\nbWJlckFubm90YXRpb24oRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgQW5u\nb3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgZ2l2ZW4gY2xhc3MgdG8gaXRz\nIE9wZW5KUEEgdHlwZSBvdmVycmlkZSBlcXVpdmFsZW50LgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBDbGFzcyB0b092ZXJyaWRlVHlwZShDbGFzcyBj\nbHMpIHsKICAgICAgICByZXR1cm4gKGNscyA9PSBFbnRpdHkuY2xhc3MpCiAg\nICAgICAgICAgID8gb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lz\ndGVuY2VDYXBhYmxlLmNsYXNzIDogY2xzOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQFJlYWRPbmx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VSZWFkT25seShGaWVsZE1ldGFEYXRhIGZtZCwgUmVhZE9ubHkgcm8p\nIHsKICAgICAgICBpZiAocm8udmFsdWUoKSA9PSBVcGRhdGVBY3Rpb24uUkVT\nVFJJQ1QpCiAgICAgICAgICAgIGZtZC5zZXRVcGRhdGVTdHJhdGVneShVcGRh\ndGVTdHJhdGVnaWVzLlJFU1RSSUNUKTsKICAgICAgICBlbHNlIGlmIChyby52\nYWx1ZSgpID09IFVwZGF0ZUFjdGlvbi5JR05PUkUpCiAgICAgICAgICAgIGZt\nZC5zZXRVcGRhdGVTdHJhdGVneShVcGRhdGVTdHJhdGVnaWVzLklHTk9SRSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgdmFsdWUg\nZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIGZpZWxkLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VHZW5lcmF0ZWRWYWx1ZShG\naWVsZE1ldGFEYXRhIGZtZCwgR2VuZXJhdGVkVmFsdWUgZ2VuKSB7CiAgICAg\nICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3kgPSBnZW4uc3RyYXRlZ3koKTsK\nICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yID0gZ2VuLmdlbmVyYXRvcigpOwog\nICAgICAgIHBhcnNlR2VuZXJhdGVkVmFsdWUoZm1kLCBzdHJhdGVneSwgZ2Vu\nZXJhdG9yKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgdmFsdWUgZ2Vu\nZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAg\nICovCiAgICBzdGF0aWMgdm9pZCBwYXJzZUdlbmVyYXRlZFZhbHVlKEZpZWxk\nTWV0YURhdGEgZm1kLCBHZW5lcmF0aW9uVHlwZSBzdHJhdGVneSwKICAgICAg\nICBTdHJpbmcgZ2VuZXJhdG9yKSB7CiAgICAgICAgaW50IHN0cmF0ID0gZ2V0\nR2VuZXJhdGVkVmFsdWVTdHJhdGVneShmbWQsIHN0cmF0ZWd5LCBnZW5lcmF0\nb3IpOwogICAgICAgIGlmIChzdHJhdCAhPSAtMSkKICAgICAgICAgICAgZm1k\nLnNldFZhbHVlU3RyYXRlZ3koc3RyYXQpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7CiAgICAgICAgICAgICAgICBj\nYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgY2FzZSBTRVFVRU5DRToKICAg\nICAgICAgICAgICAgICAgICAvLyB0ZWNobmljYWxseSB3ZSBzaG91bGQgaGF2\nZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5kCiAgICAgICAgICAgICAgICAg\nICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywgYnV0IGl0J3MgZWFzaWVyIHRv\nIGp1c3QgcmVseSBvbgogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzeXN0\nZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVlbmNlIHNldHRpbmcgZm9yIGJv\ndGgKICAgICAgICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShnZW5lcmF0b3IpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0\nVmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RF\nTSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoZ2VuZXJhdG9yKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgQVVUTzoKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1\nZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElE\nRU5USVRZOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVN0cmF0\nZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKHN0cmF0ZWd5LnRvU3RyaW5nKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBzdHJh\ndGVneSBmb3IgdGhlIGdpdmVuIGdlbmVyYXRvciwgb3IgLTEgaWYgdGhlCiAg\nICAgKiBzdHJhdGVneSBkZXBlbmRzIG9uIHRoZSA8Y29kZT5HZW5lcmF0aW9u\nVHlwZTwvY29kZT4gcmF0aGVyIHRoYW4gdGhlCiAgICAgKiBnZW5lcmF0b3Ig\nbmFtZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IGdldEdlbmVy\nYXRlZFZhbHVlU3RyYXRlZ3koT2JqZWN0IGNvbnRleHQsCiAgICAgICAgR2Vu\nZXJhdGlvblR5cGUgc3RyYXRlZ3ksIFN0cmluZyBnZW5lcmF0b3IpIHsKICAg\nICAgICBpZiAoc3RyYXRlZ3kgIT0gQVVUTyB8fCBTdHJpbmdVdGlscy5pc0Vt\ncHR5KGdlbmVyYXRvcikpCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAgICAg\nICAgaWYgKEdlbmVyYXRvci5VVUlEX0hFWC5lcXVhbHMoZ2VuZXJhdG9yKSkK\nICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDsK\nICAgICAgICBpZiAoR2VuZXJhdG9yLlVVSURfU1RSSU5HLmVxdWFscyhnZW5l\ncmF0b3IpKQogICAgICAgICAgICByZXR1cm4gVmFsdWVTdHJhdGVnaWVzLlVV\nSURfU1RSSU5HOwogICAgICAgIGlmIChHZW5lcmF0b3IuVVVJRF9UWVBFNF9I\nRVguZXF1YWxzKGdlbmVyYXRvcikpCiAgICAgICAgICAgIHJldHVybiBWYWx1\nZVN0cmF0ZWdpZXMuVVVJRF9UWVBFNF9IRVg7CiAgICAgICAgaWYgKEdlbmVy\nYXRvci5VVUlEX1RZUEU0X1NUUklORy5lcXVhbHMoZ2VuZXJhdG9yKSkKICAg\nICAgICAgICAgcmV0dXJuIFZhbHVlU3RyYXRlZ2llcy5VVUlEX1RZUEU0X1NU\nUklORzsKICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImdlbmVyYXRvci1iYWQtc3RyYXRlZ3kiLAogICAgICAgICAgICBj\nb250ZXh0LCBnZW5lcmF0b3IpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBCYXNpYy4gR2l2ZW4gYW5ub3RhdGlvbiBtYXkgYmUgbnVsbC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlQmFzaWMoRmllbGRNZXRhRGF0\nYSBmbWQsIEJhc2ljIGFubm8sIGJvb2xlYW4gbG9iKSB7CiAgICAgICAgQ2xh\nc3MgdHlwZSA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAo\nbG9iICYmIHR5cGUgIT0gU3RyaW5nLmNsYXNzCiAgICAgICAgICAgICYmIHR5\ncGUgIT0gY2hhcltdLmNsYXNzICYmIHR5cGUgIT0gQ2hhcmFjdGVyW10uY2xh\nc3MKICAgICAgICAgICAgJiYgdHlwZSAhPSBieXRlW10uY2xhc3MgJiYgdHlw\nZSAhPSBCeXRlW10uY2xhc3MpCiAgICAgICAgICAgIGZtZC5zZXRTZXJpYWxp\nemVkKHRydWUpOwogICAgICAgIGVsc2UgaWYgKCFsb2IpIHsKICAgICAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKEVudW0uY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBl\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgLy8gZWxzZSBubyBicmVhawogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlBDOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBF\nRDoKICAgICAgICAgICAgICAgICAgICBpZiAoU2VyaWFsaXphYmxlLmNsYXNz\nLmlzQXNzaWduYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZtZCwgIkJhc2ljIikpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUg\nPT0gY2hhcltdLmNsYXNzIHx8IHR5cGUgPT0gQ2hhcmFjdGVyW10uY2xhc3MK\nICAgICAgICAgICAgICAgICAgICAgICAgfHwgdHlwZSA9PSBieXRlW10uY2xh\nc3MgfHwgdHlwZSA9PSBCeXRlW10uY2xhc3MpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGlmIChTZXJpYWxp\nemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbQogICAgICAgICAgICAgICAg\nICAgICAgICAodHlwZS5nZXRDb21wb25lbnRUeXBlKCkpKQogICAgICAgICAg\nICAgICAgICAgICAgICBmbWQuc2V0U2VyaWFsaXplZCh0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEt\nYW5ubyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQsICJCYXNp\nYyIpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKGFubm8gPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdy\nb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAg\nIGlmICghYW5uby5vcHRpb25hbCgpKQogICAgICAgICAgICBmbWQuc2V0TnVs\nbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04pOwogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgQE1hbnlUb09uZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRvT25lKEZpZWxkTWV0YURhdGEgZm1k\nLCBNYW55VG9PbmUgYW5ubykgewogICAgICAgIGlmICghSmF2YVR5cGVzLm1h\neWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBm\nbWQsCiAgICAgICAgICAgICAgICAiTWFueVRvT25lIikpOwoKICAgICAgICAv\nLyBkb24ndCBzcGVjaWZpY2FsbHkgZXhjbHVkZSByZWxhdGlvbiBmcm9tIERG\nRyBiL2MgdGhhdCB3aWxsIHByZXZlbnQKICAgICAgICAvLyB1cyBmcm9tIGV2\nZW4gcmVhZGluZyB0aGUgZmsgd2hlbiByZWFkaW5nIGZyb20gdGhlIHByaW1h\ncnkgdGFibGUsCiAgICAgICAgLy8gd2hpY2ggaXMgbm90IHdoYXQgbW9zdCB1\nc2VycyB3aWxsIHdhbnQKICAgICAgICBpZiAoYW5uby5mZXRjaCgpID09IEZl\ndGNoVHlwZS5FQUdFUikKICAgICAgICAgICAgZm1kLnNldEluRGVmYXVsdEZl\ndGNoR3JvdXAodHJ1ZSk7CiAgICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkp\nCiAgICAgICAgICAgIGZtZC5zZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5O\nVUxMX0VYQ0VQVElPTik7CiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5\nKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVy\ncmlkZShhbm5vLnRhcmdldEVudGl0eSgpKTsKICAgICAgICBzZXRDYXNjYWRl\ncyhmbWQsIGFubm8uY2FzY2FkZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIEBPbmVUb09uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlT25lVG9PbmUoRmllbGRNZXRhRGF0YSBmbWQsIE9uZVRvT25lIGFubm8p\nIHsKICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1\nZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAg\nICAgIk9uZVRvT25lIikpOwoKICAgICAgICAvLyBkb24ndCBzcGVjaWZpY2Fs\nbHkgZXhjbHVkZSByZWxhdGlvbiBmcm9tIERGRyBiL2MgdGhhdCB3aWxsIHBy\nZXZlbnQKICAgICAgICAvLyB1cyBmcm9tIGV2ZW4gcmVhZGluZyB0aGUgZmsg\nd2hlbiByZWFkaW5nIGZyb20gdGhlIHByaW1hcnkgdGFibGUsCiAgICAgICAg\nLy8gd2hpY2ggaXMgbm90IHdoYXQgbW9zdCB1c2VycyB3aWxsIHdhbnQKICAg\nICAgICBpZiAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUikKICAg\nICAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAg\nICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAgIGZtZC5z\nZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7Cgog\nICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJiAhU3RyaW5n\nVXRpbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBm\nbWQuc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBpZiAo\nYW5uby50YXJnZXRFbnRpdHkoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAg\nICBmbWQuc2V0VHlwZU92ZXJyaWRlKGFubm8udGFyZ2V0RW50aXR5KCkpOwog\nICAgICAgIHNldENhc2NhZGVzKGZtZCwgYW5uby5jYXNjYWRlKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQEVtYmVkZGVkLiBHaXZlbiBhbm5v\ndGF0aW9uIG1heSBiZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VFbWJlZGRlZChGaWVsZE1ldGFEYXRhIGZtZCwgRW1iZWRkZWQgYW5u\nbykgewogICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZh\nbHVlKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAg\nICAgICAiRW1iZWRkZWQiKSk7CgogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRG\nZXRjaEdyb3VwKHRydWUpOwogICAgICAgIGZtZC5zZXRFbWJlZGRlZCh0cnVl\nKTsKICAgICAgICBpZiAoZm1kLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBu\ndWxsKQogICAgICAgICAgICBmbWQuYWRkRW1iZWRkZWRNZXRhRGF0YSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9uZVRvTWFueS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlT25lVG9NYW55KEZpZWxkTWV0YURh\ndGEgZm1kLCBPbmVUb01hbnkgYW5ubykgewogICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09M\nTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRFbGVt\nZW50KCkpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAi\nT25lVG9NYW55IikpOwogICAgICAgIH0KCiAgICAgICAgZm1kLnNldEluRGVm\nYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdF\nUik7CiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYmICFT\ndHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAg\nICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAg\nIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAg\nICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8u\ndGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRF\nbGVtZW50KCksIGFubm8uY2FzY2FkZSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBNYW55VG9NYW55LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VNYW55VG9NYW55KEZpZWxkTWV0YURhdGEgZm1kLCBNYW55VG9N\nYW55IGFubm8pIHsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGlm\nIChKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0RWxlbWVudCgpKSkKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFu\nbm8iLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgIk9uZVRvTWFueSIpKTsK\nICAgICAgICB9CgogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3Vw\nKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlm\nIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJiAhU3RyaW5nVXRpbHMuaXNF\nbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQuc2V0TWFw\ncGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBpZiAoYW5uby50YXJn\nZXRFbnRpdHkoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0\nRWxlbWVudCgpLnNldERlY2xhcmVkVHlwZShhbm5vLnRhcmdldEVudGl0eSgp\nKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5v\nLmNhc2NhZGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATWFw\nS2V5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYXBLZXkoRmll\nbGRNZXRhRGF0YSBmbWQsIE1hcEtleSBhbm5vKSB7CiAgICAgICAgU3RyaW5n\nIG5hbWUgPSBhbm5vLm5hbWUoKTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgZm1kLmdldEtleSgpLnNldFZh\nbHVlTWFwcGVkQnkoVmFsdWVNZXRhRGF0YS5NQVBQRURfQllfUEspOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgZm1kLmdldEtleSgpLnNldFZhbHVlTWFw\ncGVkQnkobmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXR1cCB0aGUg\nZmllbGQgYXMgYSBMT0IgbWFwcGluZy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgcGFyc2VMb2JNYXBwaW5nKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAT3JkZXJCeS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlT3JkZXJCeShGaWVsZE1ldGFEYXRhIGZt\nZCwgT3JkZXJCeSBhbm5vKSB7CiAgICAgICAgU3RyaW5nIGRlYyA9IGFubm8u\ndmFsdWUoKTsKICAgICAgICBpZiAoZGVjLmxlbmd0aCgpID09IDApCiAgICAg\nICAgICAgIGRlYyA9IE9yZGVyLkVMRU1FTlQgKyAiIGFzYyI7CiAgICAgICAg\nZm1kLnNldE9yZGVyRGVjbGFyYXRpb24oZGVjKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIEBQZXJzaXN0ZW50LgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VQZXJzaXN0ZW50KEZpZWxkTWV0YURhdGEgZm1kLCBQZXJz\naXN0ZW50IGFubm8pIHsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJS\nQVk6CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgp\nID09IGJ5dGVbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSA9PSBCeXRlW10uY2xhc3MKICAgICAgICAgICAg\nICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNs\nYXNzCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlw\nZSgpID09IENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1k\nLAogICAgICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50IikpOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFw\ncGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1h\ncHBlZEJ5KCkpOwogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3Vw\nKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlm\nICghYW5uby5vcHRpb25hbCgpKQogICAgICAgICAgICBmbWQuc2V0TnVsbFZh\nbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04pOwogICAgICAgIHNl\ndENhc2NhZGVzKGZtZCwgYW5uby5jYXNjYWRlKCkpOwogICAgICAgIGlmIChh\nbm5vLmVtYmVkZGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMu\nbWF5YmVQQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFu\nbm8iLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnQoZW1i\nZWRkZWQ9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZtZC5zZXRFbWJlZGRlZCh0\ncnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRFbWJlZGRlZE1ldGFEYXRh\nKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGZtZC5hZGRFbWJlZGRlZE1l\ndGFEYXRhKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQFBlcnNpc3RlbnRDb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VQZXJzaXN0ZW50Q29sbGVjdGlvbihGaWVsZE1ldGFEYXRh\nIGZtZCwKICAgICAgICBQZXJzaXN0ZW50Q29sbGVjdGlvbiBhbm5vKSB7CiAg\nICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5\ncGVzLkFSUkFZCiAgICAgICAgICAgICYmIGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgIT0gSmF2YVR5cGVzLkNPTExFQ1RJT04pCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEt\nYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50Q29sbGVj\ndGlvbiIpKTsKCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFu\nbm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShh\nbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRj\naEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAg\nICAgIGlmIChhbm5vLmVsZW1lbnRUeXBlKCkgIT0gdm9pZC5jbGFzcykKICAg\nICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNsYXJlZFR5cGUoYW5u\nby5lbGVtZW50VHlwZSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0\nRWxlbWVudCgpLCBhbm5vLmVsZW1lbnRDYXNjYWRlKCkpOwogICAgICAgIGlm\nIChhbm5vLmVsZW1lbnRFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgIGlmICgh\nSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgIlBl\ncnNpc3RlbnRDb2xsZWN0aW9uKGVtYmVkZGVkRWxlbWVudD10cnVlKSIpKTsK\nICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRFbWJlZGRlZCh0cnVl\nKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuZ2V0RW1iZWRk\nZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBmbWQuZ2V0\nRWxlbWVudCgpLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudE1hcC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudE1hcChGaWVs\nZE1ldGFEYXRhIGZtZCwgUGVyc2lzdGVudE1hcCBhbm5vKSB7CiAgICAgICAg\naWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLk1B\nUCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAg\nIlBlcnNpc3RlbnRNYXAiKSk7CgogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRG\nZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwog\nICAgICAgIGlmIChhbm5vLmtleVR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAg\nICAgICAgICBmbWQuZ2V0S2V5KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8ua2V5\nVHlwZSgpKTsKICAgICAgICBpZiAoYW5uby5lbGVtZW50VHlwZSgpICE9IHZv\naWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVj\nbGFyZWRUeXBlKGFubm8uZWxlbWVudFR5cGUoKSk7CiAgICAgICAgc2V0Q2Fz\nY2FkZXMoZm1kLmdldEtleSgpLCBhbm5vLmtleUNhc2NhZGUoKSk7CiAgICAg\nICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5lbGVtZW50\nQ2FzY2FkZSgpKTsKICAgICAgICBpZiAoYW5uby5rZXlFbWJlZGRlZCgpKSB7\nCiAgICAgICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEtl\neSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAg\nICAgICAgICAgICAiUGVyc2lzdGVudE1hcChlbWJlZGRlZEtleT10cnVlKSIp\nKTsKICAgICAgICAgICAgZm1kLmdldEtleSgpLnNldEVtYmVkZGVkKHRydWUp\nOwogICAgICAgICAgICBpZiAoZm1kLmdldEtleSgpLmdldEVtYmVkZGVkTWV0\nYURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgZm1kLmdldEtleSgp\nLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKGFubm8uZWxlbWVudEVtYmVkZGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFK\nYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0RWxlbWVudCgpKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVy\nc2lzdGVudE1hcChlbWJlZGRlZFZhbHVlPXRydWUpIikpOwogICAgICAgICAg\nICBmbWQuZ2V0RWxlbWVudCgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAg\nICAgICBpZiAoZm1kLmdldEVsZW1lbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRh\nKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCku\nYWRkRW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCBjYXNjYWRlcyBvbiByZWxhdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHNldENhc2NhZGVzKFZhbHVlTWV0YURhdGEgdm1k\nLCBDYXNjYWRlVHlwZVtdIGNhc2NhZGVzKSB7CiAgICAgICAgZm9yIChDYXNj\nYWRlVHlwZSBjYXNjYWRlIDogY2FzY2FkZXMpIHsKICAgICAgICAgICAgaWYg\nKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2Fz\nY2FkZVR5cGUuUkVNT1ZFKQogICAgICAgICAgICAgICAgdm1kLnNldENhc2Nh\nZGVEZWxldGUoVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAg\nICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBj\nYXNjYWRlID09IENhc2NhZGVUeXBlLlBFUlNJU1QpCiAgICAgICAgICAgICAg\nICB2bWQuc2V0Q2FzY2FkZVBlcnNpc3QoVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX0lNTUVESUFURSk7CiAgICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2Nh\nZGVUeXBlLkFMTCB8fCBjYXNjYWRlID09IENhc2NhZGVUeXBlLk1FUkdFKQog\nICAgICAgICAgICAgICAgdm1kLnNldENhc2NhZGVBdHRhY2goVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAgICAgICAgICAgIGlmIChjYXNj\nYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBjYXNjYWRlID09IENhc2NhZGVU\neXBlLlJFRlJFU0gpCiAgICAgICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZVJl\nZnJlc2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFNlcXVlbmNlR2Vu\nZXJhdG9yLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VTZXF1ZW5j\nZUdlbmVyYXRvcihBbm5vdGF0ZWRFbGVtZW50IGVsLAogICAgICAgIFNlcXVl\nbmNlR2VuZXJhdG9yIGdlbikgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2Vu\nLm5hbWUoKTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1l\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1zZXEtbmFtZSIsIGVsKSk7CgogICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoInBhcnNlLXNlcXVlbmNlIiwgbmFtZSkpOwoKICAgICAgICBTZXF1\nZW5jZU1ldGFEYXRhIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q2FjaGVk\nU2VxdWVuY2VNZXRhRGF0YQogICAgICAgICAgICAobmFtZSk7CiAgICAgICAg\naWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoImR1cC1zZXF1ZW5jZSIsIG5hbWUsIGVsKSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBuZXcgc2VxdWVu\nY2UKICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFkZFNlcXVlbmNl\nTWV0YURhdGEobmFtZSk7CiAgICAgICAgU3RyaW5nIHNlcSA9IGdlbi5zZXF1\nZW5jZU5hbWUoKTsKICAgICAgICBpbnQgaW5pdGlhbCA9IGdlbi5pbml0aWFs\nVmFsdWUoKTsKICAgICAgICBpbnQgYWxsb2NhdGUgPSBnZW4uYWxsb2NhdGlv\nblNpemUoKTsKICAgICAgICAvLyBkb24ndCBhbGxvdyBpbml0aWFsIG9mIDAg\nYi9jIGxvb2tzIGxpa2UgZGVmIHZhbHVlCiAgICAgICAgaWYgKGluaXRpYWwg\nPT0gMCkKICAgICAgICAgICAgaW5pdGlhbCA9IDE7CgogICAgICAgIC8vIGNy\nZWF0ZSBwbHVnaW4gc3RyaW5nIGZyb20gaW5mbwogICAgICAgIFN0cmluZyBj\nbHNOYW1lLCBwcm9wczsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShzZXEpKSB7CiAgICAgICAgICAgIGNsc05hbWUgPSBTZXF1ZW5jZU1ldGFE\nYXRhLklNUExfTkFUSVZFOwogICAgICAgICAgICBwcm9wcyA9IG51bGw7CiAg\nICAgICAgfSBlbHNlIGlmIChzZXEuaW5kZXhPZignKCcpICE9IC0xKSAvLyBw\nbHVnaW4KICAgICAgICB7CiAgICAgICAgICAgIGNsc05hbWUgPSBDb25maWd1\ncmF0aW9ucy5nZXRDbGFzc05hbWUoc2VxKTsKICAgICAgICAgICAgcHJvcHMg\nPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKHNlcSk7CiAgICAgICAg\nICAgIHNlcSA9IG51bGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nY2xzTmFtZSA9IFNlcXVlbmNlTWV0YURhdGEuSU1QTF9OQVRJVkU7CiAgICAg\nICAgICAgIHByb3BzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIG1ldGEu\nc2V0U2VxdWVuY2VQbHVnaW4oQ29uZmlndXJhdGlvbnMuZ2V0UGx1Z2luKGNs\nc05hbWUsIHByb3BzKSk7CiAgICAgICAgbWV0YS5zZXRTZXF1ZW5jZShzZXEp\nOwogICAgICAgIG1ldGEuc2V0SW5pdGlhbFZhbHVlKGluaXRpYWwpOwogICAg\nICAgIG1ldGEuc2V0QWxsb2NhdGUoYWxsb2NhdGUpOwogICAgICAgIG1ldGEu\nc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGluc3RhbmNlb2YgQ2xh\nc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICBtZXRhLlNSQ19BTk5PVEFU\nSU9OUyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATmFtZWRRdWVy\neS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTmFtZWRRdWVyaWVz\nKEFubm90YXRlZEVsZW1lbnQgZWwsIE5hbWVkUXVlcnkuLi4gcXVlcmllcykg\newogICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YTsKICAgICAgICBmb3IgKE5h\nbWVkUXVlcnkgcXVlcnkgOiBxdWVyaWVzKSB7CiAgICAgICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5Lm5hbWUoKSkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXF1ZXJ5LW5hbWUiLCBlbCkpOwogICAgICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShxdWVyeS5xdWVyeSgpKSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tcXVlcnkt\nc3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICBxdWVyeS5uYW1lKCksIGVs\nKSk7CgogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtcXVl\ncnkiLCBxdWVyeS5uYW1lKCkpKTsKCiAgICAgICAgICAgIG1ldGEgPSBnZXRS\nZXBvc2l0b3J5KCkuZ2V0Q2FjaGVkUXVlcnlNZXRhRGF0YShudWxsLCBxdWVy\neS5uYW1lKCkpOwogICAgICAgICAgICBpZiAobWV0YSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkdXAtcXVlcnki\nLCBxdWVyeS5uYW1lKCksIGVsKSk7CiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWV0YSA9IGdldFJlcG9z\naXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRhKG51bGwsIHF1ZXJ5Lm5hbWUoKSk7\nCiAgICAgICAgICAgIG1ldGEuc2V0UXVlcnlTdHJpbmcocXVlcnkucXVlcnko\nKSk7CiAgICAgICAgICAgIG1ldGEuc2V0TGFuZ3VhZ2UoSlBRTFBhcnNlci5M\nQU5HX0pQUUwpOwogICAgICAgICAgICBmb3IgKFF1ZXJ5SGludCBoaW50IDog\ncXVlcnkuaGludHMoKSkKICAgICAgICAgICAgICAgIG1ldGEuYWRkSGludCho\naW50Lm5hbWUoKSwgaGludC52YWx1ZSgpKTsKCiAgICAgICAgICAgIG1ldGEu\nc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGluc3RhbmNlb2YgQ2xh\nc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICAgICAgbWV0YS5TUkNfQU5O\nT1RBVElPTlMpOwogICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkK\nICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01FVEEp\nOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAg\nICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQSU5HKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3Vy\nY2VNb2RlKE1PREVfUVVFUlkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIEBOYW1lZE5hdGl2ZVF1ZXJ5LgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJpZXMoQW5ub3RhdGVk\nRWxlbWVudCBlbCwKICAgICAgICBOYW1lZE5hdGl2ZVF1ZXJ5Li4uIHF1ZXJp\nZXMpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7CiAgICAgICAgZm9y\nIChOYW1lZE5hdGl2ZVF1ZXJ5IHF1ZXJ5IDogcXVlcmllcykgewogICAgICAg\nICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVyeS5uYW1lKCkpKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1uYXRpdmUtcXVlcnktbmFtZSIsCiAgICAgICAgICAgICAg\nICAgICAgZWwpKTsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1w\ndHkocXVlcnkucXVlcnkoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hdGl2ZS1xdWVyeS1z\ndHJpbmciLAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5Lm5hbWUoKSwgZWwp\nKTsKCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1uYXRp\ndmUtcXVlcnkiLCBxdWVyeS5uYW1lKCkpKTsKCiAgICAgICAgICAgIG1ldGEg\nPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q2FjaGVkUXVlcnlNZXRhRGF0YShudWxs\nLCBxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBpZiAobWV0YSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkdXAt\ncXVlcnkiLCBxdWVyeS5uYW1lKCksIGVsKSk7CiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWV0YSA9IGdl\ndFJlcG9zaXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRhKG51bGwsIHF1ZXJ5Lm5h\nbWUoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0UXVlcnlTdHJpbmcocXVlcnku\ncXVlcnkoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0TGFuZ3VhZ2UoUXVlcnlM\nYW5ndWFnZXMuTEFOR19TUUwpOwogICAgICAgICAgICBDbGFzcyByZXMgPSBx\ndWVyeS5yZXN1bHRDbGFzcygpOwogICAgICAgICAgICBpZiAoSW1wbEhlbHBl\nci5pc01hbmFnZWRUeXBlKGdldENvbmZpZ3VyYXRpb24oKSwgcmVzKSkKICAg\nICAgICAgICAgICAgIG1ldGEuc2V0Q2FuZGlkYXRlVHlwZShyZXMpOwogICAg\nICAgICAgICBlbHNlIGlmICghdm9pZC5jbGFzcy5lcXVhbHMocmVzKSkKICAg\nICAgICAgICAgICAgIG1ldGEuc2V0UmVzdWx0VHlwZShyZXMpOwoKICAgICAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnJlc3VsdFNl\ndE1hcHBpbmcoKSkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFJlc3VsdFNl\ndE1hcHBpbmdOYW1lKHF1ZXJ5LnJlc3VsdFNldE1hcHBpbmcoKSk7CgogICAg\nICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBp\nbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgICAg\nIG1ldGEuU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1v\nZGUoTU9ERV9NRVRBKTsKICAgICAgICAgICAgZWxzZSBpZiAoaXNNYXBwaW5n\nTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1P\nREVfTUFQUElORyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX1FVRVJZKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWV0aG9kS2V5IHsKCiAg\nICAgICAgcHJpdmF0ZSBmaW5hbCBNZXRob2QgX21ldGhvZDsKCiAgICAgICAg\ncHVibGljIE1ldGhvZEtleShNZXRob2QgbSkgewogICAgICAgICAgICBfbWV0\naG9kID0gbTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENv\nZGUoKSB7CiAgICAgICAgICAgIGludCBjb2RlID0gNDYgKiAxMiArIF9tZXRo\nb2QuZ2V0TmFtZSgpLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIGZvciAoQ2xh\nc3MgcGFyYW0gOiBfbWV0aG9kLmdldFBhcmFtZXRlclR5cGVzKCkpCiAgICAg\nICAgICAgICAgICBjb2RlID0gNDYgKiBjb2RlICsgcGFyYW0uaGFzaENvZGUo\nKTsKICAgICAgICAgICAgcmV0dXJuIGNvZGU7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAg\nICAgaWYgKCEobyBpbnN0YW5jZW9mIE1ldGhvZEtleSkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIE1ldGhvZCBvdGhlciA9\nICgoTWV0aG9kS2V5KSBvKS5fbWV0aG9kOwogICAgICAgICAgICBpZiAoIV9t\nZXRob2QuZ2V0TmFtZSgpLmVxdWFscyhvdGhlci5nZXROYW1lKCkpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4g\nQXJyYXlzLmVxdWFscyhfbWV0aG9kLmdldFBhcmFtZXRlclR5cGVzKCksCiAg\nICAgICAgICAgICAgICBvdGhlci5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWV0aG9k\nQ29tcGFyYXRvciBpbXBsZW1lbnRzIENvbXBhcmF0b3IgewoKICAgICAgICBw\ncml2YXRlIHN0YXRpYyBNZXRob2RDb21wYXJhdG9yIElOU1RBTkNFID0gbnVs\nbDsKCiAgICAgICAgcHVibGljIHN0YXRpYyBNZXRob2RDb21wYXJhdG9yIGdl\ndEluc3RhbmNlKCkgewogICAgICAgICAgICBpZiAoSU5TVEFOQ0UgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIElOU1RBTkNFID0gbmV3IE1ldGhvZENvbXBh\ncmF0b3IoKTsKICAgICAgICAgICAgcmV0dXJuIElOU1RBTkNFOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBjb21wYXJlKE9iamVjdCBvMSwgT2Jq\nZWN0IG8yKSB7CiAgICAgICAgICAgIE1ldGhvZCBtMSA9IChNZXRob2QpIG8x\nOwogICAgICAgICAgICBNZXRob2QgbTIgPSAoTWV0aG9kKSBvMjsKCiAgICAg\nICAgICAgIENsYXNzIGMxID0gbTEuZ2V0RGVjbGFyaW5nQ2xhc3MoKTsKICAg\nICAgICAgICAgQ2xhc3MgYzIgPSBtMi5nZXREZWNsYXJpbmdDbGFzcygpOwog\nICAgICAgICAgICBpZiAoIWMxLmVxdWFscyhjMikpIHsKICAgICAgICAgICAg\nICAgIGlmIChjMS5pc0Fzc2lnbmFibGVGcm9tKGMyKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICBlbHNlCgkJCQkJ\ncmV0dXJuIDE7CgkJCX0KCQkJaW50IGNvbXBhcmUgPSBtMS5nZXROYW1lICgp\nLmNvbXBhcmVUbyAobTIuZ2V0TmFtZSAoKSk7CgkJCWlmIChjb21wYXJlID09\nIDApCgkJCQlyZXR1cm4gbTEuaGFzaENvZGUgKCkgLSBtMi5oYXNoQ29kZSAo\nKTsKCQkJcmV0dXJuIGNvbXBhcmU7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

