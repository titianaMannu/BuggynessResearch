{"sha":"767ecb20846f00a800c7911bb2f0d5b66e2a6bd3","node_id":"MDQ6QmxvYjIwNjM2NDo3NjdlY2IyMDg0NmYwMGE4MDBjNzkxMWJiMmYwZDViNjZlMmE2YmQz","size":4735,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/767ecb20846f00a800c7911bb2f0d5b66e2a6bd3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuZGF0YWNh\nY2hlOwoKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk5vU3VjaEVsZW1l\nbnRFeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFj\nYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0\nYWNhY2hlLlF1ZXJ5Q2FjaGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZGF0YWNhY2hlLlF1ZXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmRhdGFjYWNoZS5EYXRhQ2FjaGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkJyb2tlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLlF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLmNvbW1vbi51dGlscy5BYnN0cmFjdFRlc3RDYXNl\nOwoKY2xhc3MgQ2FjaGVUZXN0SGVscGVyIHsKCiAgICBzdGF0aWMgdm9pZCBj\naGVja0NhY2hlKEFic3RyYWN0VGVzdENhc2UgdGMsIERhdGFDYWNoZSBjYWNo\nZSwgT2JqZWN0W10gaWRzLAogICAgICAgIGJvb2xlYW5bXSBzdGF0aSkgewog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGlmIChzdGF0aVtpXSkKICAgICAgICAgICAgICAgIHRj\nLmFzc2VydFRydWUoImlkICIgKyBpICsgIiAoIiArIGlkc1tpXQogICAgICAg\nICAgICAgICAgICAgICsgIikgd2FzIG5vdCBpbiBjYWNoZTsgc2hvdWxkIGhh\ndmUgYmVlbiIsCiAgICAgICAgICAgICAgICAgICAgY2FjaGUuY29udGFpbnMo\naWRzW2ldKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRj\nLmFzc2VydEZhbHNlKCJpZCAiICsgaSArICIgKCIgKyBpZHNbaV0KICAgICAg\nICAgICAgICAgICAgICArICIpIHdhcyBpbiBjYWNoZTsgc2hvdWxkIG5vdCBo\nYXZlIGJlZW4iLAogICAgICAgICAgICAgICAgICAgIGNhY2hlLmNvbnRhaW5z\nKGlkc1tpXSkpOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgdm9pZCBh\nc3NlcnRJbkNhY2hlKEFic3RyYWN0VGVzdENhc2UgdGMsIFF1ZXJ5IHEsIEJv\nb2xlYW4gaW5DYWNoZSkgewogICAgICAgIGFzc2VydEluQ2FjaGUodGMsIHEs\nIGluQ2FjaGUsIG5ldyBPYmplY3RbMF0pOwogICAgfQoKICAgIC8qKgogICAg\nICogVGVzdCB3aGV0aGVyIHRoZSBnaXZlbiBxdWVyeSBoYXMgdmFsaWQgY2Fj\naGVkIHJlc3VsdHMuCiAgICAgKgogICAgICogQHBhcmFtIGluQ2FjaGUgaWYg\ne0BsaW5rIEJvb2xlYW4jVFJVRX0sIHRoZSBxdWVyeSBtdXN0IGhhdmUgdmFs\naWQKICAgICAqIGNhY2hlZCByZXN1bHRzOyBpZiB7QGxpbmsgQm9vbGVhbiNG\nQUxTRX0gdGhlIHF1ZXJ5CiAgICAgKiBtdXN0IG5vdCBoYXZlIGFueSBjYWNo\nZWQgcmVzdWx0czsgaWYgbnVsbCB0aGUKICAgICAqIHF1ZXJ5IG1heSBoYXZl\nIGNhY2hlZCByZXN1bHRzLCBidXQgdGhleSBjYW5ub3QgYmUKICAgICAqIHZh\nbGlkIChpLmUuIHRoZXkgY2FuJ3QgYmUgcmV0dXJuZWQgdG8gdGhlIHVzZXIp\nCiAgICAgKi8KICAgIHN0YXRpYyB2b2lkIGFzc2VydEluQ2FjaGUoQWJzdHJh\nY3RUZXN0Q2FzZSB0YywgUXVlcnkgcXVlcnksIEJvb2xlYW4gaW5DYWNoZSwK\nICAgICAgICBPYmplY3RbXSBhcmdzKSB7CiAgICAgICAgUXVlcnlLZXkgcWsg\nPSBRdWVyeUtleS5uZXdJbnN0YW5jZShxdWVyeSwgYXJncyk7CiAgICAgICAg\nQnJva2VyIGJyb2tlciA9IHF1ZXJ5LmdldEJyb2tlcigpOwogICAgICAgIEJy\nb2tlckZhY3RvcnkgZmFjdG9yeSA9IGJyb2tlci5nZXRCcm9rZXJGYWN0b3J5\nKCk7CgogICAgICAgIFF1ZXJ5Q2FjaGUgcWMgPSBjYWNoZU1hbmFnZXIoZmFj\ndG9yeSkuZ2V0U3lzdGVtUXVlcnlDYWNoZSgpOwogICAgICAgIGlmIChpbkNh\nY2hlID09IEJvb2xlYW4uRkFMU0UgJiYgcWMuZ2V0KHFrKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIHRjLmZhaWwoInF1ZXJ5IHNob3VsZCBub3QgYmUgaW4g\nY2FjaGU7IHdhcy4iKTsKICAgICAgICB9IGVsc2UgaWYgKGluQ2FjaGUgPT0g\nQm9vbGVhbi5UUlVFIHx8IChpbkNhY2hlID09IG51bGwKICAgICAgICAgICAg\nJiYgcWMuZ2V0KHFrKSAhPSBudWxsKSkgewogICAgICAgICAgICBPYmplY3Qg\ncmVzID0gKGFyZ3MgPT0gbnVsbCkgPyBxdWVyeS5leGVjdXRlKCkKICAgICAg\nICAgICAgICAgIDogcXVlcnkuZXhlY3V0ZShhcmdzKTsKICAgICAgICAgICAg\naWYgKGluQ2FjaGUgPT0gQm9vbGVhbi5UUlVFICYmCiAgICAgICAgICAgICAg\nICAhaXNDYWNoZWRSZXN1bHQocmVzLCBpbkNhY2hlLCBxdWVyeS5nZXRCcm9r\nZXIoKSkpCiAgICAgICAgICAgICAgICB0Yy5mYWlsKCJxdWVyeSBzaG91bGQg\nYmUgaW4gY2FjaGU7IHdhcyBub3QuIik7CiAgICAgICAgICAgIGVsc2UgaWYg\nKGluQ2FjaGUgPT0gbnVsbCAmJgogICAgICAgICAgICAgICAgaXNDYWNoZWRS\nZXN1bHQocmVzLCBpbkNhY2hlLCBxdWVyeS5nZXRCcm9rZXIoKSkpCiAgICAg\nICAgICAgICAgICB0Yy5mYWlsKCJxdWVyeSBzaG91bGQgbm90IGJlIHJldHVy\nbmVkIHRvIHVzZXI7IHdhcy4iKTsKICAgICAgICAgICAgcXVlcnkuY2xvc2VB\nbGwoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiBpc0NhY2hlZFJlc3VsdChPYmplY3QgcmVzLCBCb29sZWFuIGV4cGVj\ndGVkLAogICAgICAgIEJyb2tlciBicm9rZXIpIHsKICAgICAgICAvLyB3ZSBj\nYW4gb25seSBjaGVjayBmb3IgYSBDYWNoZWRRdWVyeVJlc3VsdCBpZiB0aGUK\nICAgICAgICAvLyBCcm9rZXIgd2FzIGNvbmZpZ3VyZWQgdG8gYmUgYSBDYWNo\nZVRlc3RCcm9rZXIKICAgICAgICBpZiAoIShicm9rZXIgaW5zdGFuY2VvZiBD\nYWNoZVRlc3RCcm9rZXIpKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uKCJCcm9rZXIgd2FzIG5vdCBzZXQgdG8gYmUg\nIgogICAgICAgICAgICAgICAgKyAiYSBDYWNoZVRlc3RCcm9rZXIsIG1ha2lu\nZyBpdCBpbXBvc3NpYmxlIHRvIHZlcmlmeSAiCiAgICAgICAgICAgICAgICAr\nICJpZiBxdWVyeSByZXN1bHQgaXMgY2FjaGVkIik7CgogICAgICAgIGlmIChy\nZXMgaW5zdGFuY2VvZiBDb2xsZWN0aW9uKQogICAgICAgICAgICByZXR1cm4g\ncmVzIGluc3RhbmNlb2YgQ2FjaGVUZXN0QnJva2VyLkNhY2hlZFF1ZXJ5UmVz\ndWx0OwogICAgICAgIC8vIG5vIHdheSB0byB0ZWxsIGlmIHVuaXF1ZSByZXN1\nbHRzIGZyb20gY2FjaGUKICAgICAgICByZXR1cm4gZXhwZWN0ZWQuYm9vbGVh\nblZhbHVlKCk7CiAgICB9CgogICAgc3RhdGljIHZvaWQgaXRlcmF0ZShDb2xs\nZWN0aW9uIGMpIHsKICAgICAgICAvLyBpdGVyYXRlIHRocm91Z2ggdGhlIGNv\nbGxlY3Rpb24gc28gdGhhdCB0aGUgcmVzdWx0cyBoYXZlIGFuCiAgICAgICAg\nLy8gb3Bwb3J0dW5pdHkgdG8gcmVnaXN0ZXIgdGhlbXNlbHZlcyB3aXRoIHRo\nZSBQTS4KICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRlciA9IGMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb3VudCsrOwog\nICAgICAgICAgICAgICAgaXRlci5uZXh0KCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKE5vU3VjaEVsZW1lbnRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICBzdGF0aWMgRGF0YUNhY2hlTWFuYWdlciBjYWNoZU1hbmFnZXIoQnJva2Vy\nRmFjdG9yeSBmYWN0b3J5KSB7CiAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0\nQ29uZmlndXJhdGlvbigpLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgp\nOwogICAgfQp9Cg==\n","encoding":"base64"}

