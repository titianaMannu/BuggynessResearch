{"sha":"3d392eae3128b21bc8a9c623ee56d54e0633bd60","node_id":"MDQ6QmxvYjIwNjM2NDozZDM5MmVhZTMxMjhiMjFiYzhhOWM2MjNlZTU2ZDU0ZTA2MzNiZDYw","size":11204,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3d392eae3128b21bc8a9c623ee56d54e0633bd60","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuZGF0YWNh\nY2hlOwoKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuRW50aXR5TWFuYWdlckZhY3Rvcnk7CgoKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMu\nQ2FjaGVPYmplY3RBQ2hpbGQxOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnBlcnNpc3RlbmNlLmNvbW1vbi51dGlscy5BYnN0cmFjdFRlc3RDYXNlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuQnJva2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXJGYWN0b3J5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuanBxbC5KUFFMUGFyc2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLkpQQUZhY2Fk\nZUhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5j\nZS5PcGVuSlBBRW50aXR5TWFuYWdlckZhY3Rvcnk7CgovKioKICogVGVzdCB0\naGF0IHdlIG1hcnNoYWxsIGFuZCB1bm1hcnNoYWxsIHJlc3VsdCB0eXBlcyBh\ncHByb3ByaWF0ZWx5LgogKi8KcHVibGljIGNsYXNzIFRlc3RSZXN1bHRTaGFw\nZXMgZXh0ZW5kcyBBYnN0cmFjdFRlc3RDYXNlIHsKCiAgICBwdWJsaWMgVGVz\ndFJlc3VsdFNoYXBlcyhTdHJpbmcgdGVzdCkgewogICAgICAgIHN1cGVyKHRl\nc3QsICJkYXRhY2FjaGVjYWN0dXNhcHAiKTsKICAgIH0KCiAgICBwcml2YXRl\nIEJyb2tlciBfYnJva2VyOwoKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgewog\nICAgICAgIGRlbGV0ZUFsbChDYWNoZU9iamVjdEFDaGlsZDEuY2xhc3MpOwoK\nICAgICAgICBNYXAgcHJvcHNNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAg\nIHByb3BzTWFwLnB1dCgib3BlbmpwYS5EYXRhQ2FjaGUiLCAidHJ1ZSIpOwog\nICAgICAgIHByb3BzTWFwLnB1dCgib3BlbmpwYS5SZW1vdGVDb21taXRQcm92\naWRlciIsICJzanZtIik7CiAgICAgICAgRW50aXR5TWFuYWdlckZhY3Rvcnkg\nZW1mID0gZ2V0RW1mKHByb3BzTWFwKTsKICAgICAgICBCcm9rZXJGYWN0b3J5\nIGZhY3RvcnkgPSBKUEFGYWNhZGVIZWxwZXIudG9Ccm9rZXJGYWN0b3J5KGVt\nZik7CgogICAgICAgIEJyb2tlciBicm9rZXIgPSBmYWN0b3J5Lm5ld0Jyb2tl\ncigpOwogICAgICAgIGJyb2tlci5iZWdpbigpOwogICAgICAgIGJyb2tlci5w\nZXJzaXN0KG5ldyBDYWNoZU9iamVjdEFDaGlsZDEoImZvbyIsICJmb28iLCAw\nKSwgbnVsbCk7CiAgICAgICAgYnJva2VyLnBlcnNpc3QobmV3IENhY2hlT2Jq\nZWN0QUNoaWxkMSgiYmFyIiwgImJhciIsIDEpLCBudWxsKTsKICAgICAgICBi\ncm9rZXIuY29tbWl0KCk7CiAgICAgICAgYnJva2VyLmNsb3NlKCk7CgogICAg\nICAgIF9icm9rZXIgPSBmYWN0b3J5Lm5ld0Jyb2tlcigpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgX2Jyb2tlci5jbG9zZSgpOwoKICAgICAgICBzdXBlci50ZWFyRG93\nbigpOwogICAgfQoKICAgIC8vIEZJWE1FIFNlZXRoYSBOb3YgMywyMDA2CiAg\nICAvLyBuZWVkIHRvIGtub3cgYWJvdXQgdGhlICd0aGlzJyBwYXJhbWV0ZXIK\nCi8vCXB1YmxpYyB2b2lkIHRlc3RDb2xsZWN0aW9uT2ZDYW5kaWRhdGVDbGFz\ncygpIAovLwl7IAovLwkJQ29sbGVjdGlvbjxTdHJpbmc+IGFjID0gbmV3IEFy\ncmF5TGlzdDxTdHJpbmc+KCk7Ci8vCQlhYy5hZGQoInRoaXMiKTsKLy8KLy8J\nCUNvbGxlY3Rpb248Q2xhc3M+IGJkID0gbmV3IEFycmF5TGlzdDxDbGFzcz4o\nKTsKLy8JCWJkLmFkZChDYWNoZU9iamVjdEFDaGlsZDEuY2xhc3MpOwovLwkJ\nCi8vCQlhcnJheUhlbHBlcihmYWxzZSwgYmQsIG51bGwsIHRydWUpOyAKLy8J\nCW1hcEhlbHBlcihmYWxzZSwgYmQsIGFjLCB0cnVlKTsKLy8JCXJhd0hlbHBl\ncihmYWxzZSwgQ2FjaGVPYmplY3RBQ2hpbGQxLmNsYXNzLCBudWxsLCB0cnVl\nKTsgCi8vCX0KLy8JCi8vCXB1YmxpYyB2b2lkIHRlc3RVbmlxdWVDYW5kaWRh\ndGVDbGFzcygpIAovLwl7IAovLwkJQ29sbGVjdGlvbjxTdHJpbmc+IGFjID0g\nbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7Ci8vCQlhYy5hZGQoInRoaXMiKTsK\nLy8KLy8JCUNvbGxlY3Rpb248Q2xhc3M+IGJkID0gbmV3IEFycmF5TGlzdDxD\nbGFzcz4oKTsKLy8JCWJkLmFkZChDYWNoZU9iamVjdEFDaGlsZDEuY2xhc3Mp\nOwovLwkJCi8vCQlhcnJheUhlbHBlcih0cnVlLCBiZCwgbnVsbCwgdHJ1ZSk7\nIAovLwkJbWFwSGVscGVyKHRydWUsIGJkLCBhYywgdHJ1ZSk7Ci8vCQlyYXdI\nZWxwZXIodHJ1ZSwgQ2FjaGVPYmplY3RBQ2hpbGQxLmNsYXNzLCBudWxsLCB0\ncnVlKTsgCi8vCX0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q29sbGVjdGlvbk9m\nU2luZ2xlVmFsdWVkUHJvamVjdGlvbigpIHsKCiAgICAgICAgQ29sbGVjdGlv\nbjxTdHJpbmc+IGFjID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAg\nICAgYWMuYWRkKCJhZ2UiKTsKCiAgICAgICAgQ29sbGVjdGlvbjxDbGFzcz4g\nYmQgPSBuZXcgQXJyYXlMaXN0PENsYXNzPigpOwogICAgICAgIGJkLmFkZChM\nb25nLmNsYXNzKTsKCiAgICAgICAgYXJyYXlIZWxwZXIoZmFsc2UsIGJkLCBh\nYywgdHJ1ZSk7CiAgICAgICAgbWFwSGVscGVyKGZhbHNlLCBiZCwgYWMsIHRy\ndWUpOwogICAgICAgIHJhd0hlbHBlcihmYWxzZSwgTG9uZy5jbGFzcywgImFn\nZSIsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RVbmlxdWVT\naW5nbGVWYWx1ZWRQcm9qZWN0aW9uKCkgewogICAgICAgIENvbGxlY3Rpb248\nU3RyaW5nPiBhYyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAg\nIGFjLmFkZCgiYWdlIik7CgogICAgICAgIENvbGxlY3Rpb248Q2xhc3M+IGJk\nID0gbmV3IEFycmF5TGlzdDxDbGFzcz4oKTsKICAgICAgICBiZC5hZGQoTG9u\nZy5jbGFzcyk7CgogICAgICAgIGFycmF5SGVscGVyKHRydWUsIGJkLCBhYywg\ndHJ1ZSk7CiAgICAgICAgbWFwSGVscGVyKHRydWUsIGJkLCBhYywgdHJ1ZSk7\nCiAgICAgICAgcmF3SGVscGVyKHRydWUsIExvbmcuY2xhc3MsICJhZ2UiLCB0\ncnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q29sbGVjdGlvbk9m\nTXVsdGlWYWx1ZWRQcm9qZWN0aW9uKCkgewogICAgICAgIENvbGxlY3Rpb248\nU3RyaW5nPiBhYyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAg\nIGFjLmFkZCgiYWdlIik7CiAgICAgICAgYWMuYWRkKCJuYW1lIik7CgogICAg\nICAgIENvbGxlY3Rpb248Q2xhc3M+IGJkID0gbmV3IEFycmF5TGlzdDxDbGFz\ncz4oKTsKICAgICAgICBiZC5hZGQoTG9uZy5jbGFzcyk7CiAgICAgICAgYmQu\nYWRkKFN0cmluZy5jbGFzcyk7CgogICAgICAgIGFycmF5SGVscGVyKGZhbHNl\nLCBiZCwgYWMsIHRydWUpOwoKICAgICAgICBtYXBIZWxwZXIoZmFsc2UsIGJk\nLCBhYywgdHJ1ZSk7CiAgICAgICAgLy8gd2UgcHV0IGJvdGgKICAgICAgICAv\nLyBwcm9qZWN0aW9ucyBpbiBzaW5nbGUgc2xvdCBpbiBhcnJheSBiZWNhdXNl\nIHRoaXMgaXMgYQogICAgICAgIC8vIHNpbmdsZSByZXN1bHQgdGhhdCB3ZSdy\nZQogICAgICAgIC8vIGxvb2tpbmcKICAgICAgICAvLyBmb3IuIEl0IGp1c3Qg\naGFwcGVucyB0aGF0IHRoZSAvLyBzaW5nbGUgcmVzdWx0IGZvcm1hdCB3ZSBl\neHBlY3QgaXMKICAgICAgICAvLyBhbiBPYmplY3RbXS4gcmF3SGVscGVyKGZh\nbHNlLCBPYmplY3RbXS5jbGFzcywgImFnZSwgbmFtZSIsIHRydWUpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RVbmlxdWVNdWx0aVZhbHVlZFByb2pl\nY3Rpb24oKSB7CiAgICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IGFjID0gbmV3\nIEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgYWMuYWRkKCJhZ2UiKTsK\nICAgICAgICBhYy5hZGQoIm5hbWUiKTsKCiAgICAgICAgQ29sbGVjdGlvbjxD\nbGFzcz4gYmQgPSBuZXcgQXJyYXlMaXN0PENsYXNzPigpOwogICAgICAgIGJk\nLmFkZChMb25nLmNsYXNzKTsKICAgICAgICBiZC5hZGQoU3RyaW5nLmNsYXNz\nKTsKCiAgICAgICAgYXJyYXlIZWxwZXIodHJ1ZSwgYmQsIGFjLCB0cnVlKTsK\nICAgICAgICBtYXBIZWxwZXIodHJ1ZSwgYmQsIGFjLCB0cnVlKTsKICAgICAg\nICAvLyB3ZSBwdXQKICAgICAgICAvLyBib3RoCiAgICAgICAgLy8gcHJvamVj\ndGlvbnMgaW4gc2luZ2xlIHNsb3QgaW4gYXJyYXkgYmVjYXVzZSB0aGlzIGlz\nIGEKICAgICAgICAvLyBzaW5nbGUgcmVzdWx0IHRoYXQKICAgICAgICAvLyB3\nZSdyZSBsb29raW5nCiAgICAgICAgLy8gZm9yLglJdCBqdXN0IGhhcHBlbnMg\ndGhhdCB0aGUgLy8gc2luZ2xlIHJlc3VsdCBmb3JtYXQgd2UKICAgICAgICAv\nLyBleHBlY3QgaXMgYW4JT2JqZWN0W10uIHJhd0hlbHBlcih0cnVlLCBPYmpl\nY3RbXS5jbGFzcywgImFnZSwgbmFtZSIsIHRydWUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHRlc3RVbmNhY2hlZFF1ZXJ5SGFzQ29ycmVjdFNoYXBlKCkg\newogICAgICAgIENvbGxlY3Rpb248U3RyaW5nPiBhYyA9IG5ldyBBcnJheUxp\nc3Q8U3RyaW5nPigpOwogICAgICAgIGFjLmFkZCgiYWdlIik7CiAgICAgICAg\nYWMuYWRkKCJuYW1lIik7CgogICAgICAgIENvbGxlY3Rpb248Q2xhc3M+IGJk\nID0gbmV3IEFycmF5TGlzdDxDbGFzcz4oKTsKICAgICAgICBiZC5hZGQoTG9u\nZy5jbGFzcyk7CiAgICAgICAgYmQuYWRkKFN0cmluZy5jbGFzcyk7CgogICAg\nICAgIF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuc2V0UXVlcnlD\nYWNoZUVuYWJsZWQoZmFsc2UpOwoKICAgICAgICBhcnJheUhlbHBlcihmYWxz\nZSwgYmQsIGFjLCBmYWxzZSk7CiAgICAgICAgbWFwSGVscGVyKGZhbHNlLCBi\nZCwgYWMsIGZhbHNlKTsKICAgICAgICByYXdIZWxwZXIoZmFsc2UsIE9iamVj\ndFtdLmNsYXNzLCAiYWdlLCBhLm5hbWUiLCBmYWxzZSk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGFycmF5SGVscGVyKGJvb2xlYW4gdW5pcXVlLCBDb2xs\nZWN0aW9uIHJlY29yZENsYXNzZXMsCiAgICAgICAgQ29sbGVjdGlvbiByZXN1\nbHRzLCBib29sZWFuIGluQ2FjaGUpIHsKICAgICAgICBRdWVyeSBxID0gc2V0\nVXBRdWVyeSh1bmlxdWUsIHJlc3VsdHMpOwogICAgICAgIHEuc2V0UmVzdWx0\nVHlwZShPYmplY3RbXS5jbGFzcyk7CiAgICAgICAgaWYgKHVuaXF1ZSkgewog\nICAgICAgICAgICBhcnJheVJlc3VsdEhlbHBlcihxLmV4ZWN1dGUoKSwgcmVj\nb3JkQ2xhc3NlcywgaW5DYWNoZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0gKChMaXN0KSBxLmV4ZWN1dGUo\nKSkuaXRlcmF0b3IoKTsgaXRlcgogICAgICAgICAgICAgICAgLmhhc05leHQo\nKTspCiAgICAgICAgICAgICAgICBhcnJheVJlc3VsdEhlbHBlcihpdGVyLm5l\neHQoKSwgcmVjb3JkQ2xhc3NlcywgaW5DYWNoZSk7CiAgICAgICAgfQoKICAg\nICAgICBDYWNoZVRlc3RIZWxwZXIuYXNzZXJ0SW5DYWNoZSh0aGlzLCBxLCBu\nZXcgQm9vbGVhbihpbkNhY2hlKSk7CgogICAgICAgIGlmICh1bmlxdWUpIHsK\nICAgICAgICAgICAgYXJyYXlSZXN1bHRIZWxwZXIocS5leGVjdXRlKCksIHJl\nY29yZENsYXNzZXMsIGluQ2FjaGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9ICgoTGlzdCkgcS5leGVjdXRl\nKCkpLml0ZXJhdG9yKCk7IGl0ZXIKICAgICAgICAgICAgICAgIC5oYXNOZXh0\nKCk7KQogICAgICAgICAgICAgICAgYXJyYXlSZXN1bHRIZWxwZXIoaXRlci5u\nZXh0KCksIHJlY29yZENsYXNzZXMsIGluQ2FjaGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgYXJyYXlSZXN1bHRIZWxwZXIoT2JqZWN0\nIHJlc3VsdCwgQ29sbGVjdGlvbiByZWNvcmRDbGFzc2VzLAogICAgICAgIGJv\nb2xlYW4gaW5DYWNoZSkgewogICAgICAgIGFzc2VydEVxdWFscyhPYmplY3Rb\nXS5jbGFzcywgcmVzdWx0LmdldENsYXNzKCkpOwogICAgICAgIE9iamVjdFtd\nIG9zID0gKE9iamVjdFtdKSByZXN1bHQ7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKHJlY29yZENsYXNzZXMuc2l6ZSgpLCBvcy5sZW5ndGgpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgcmVjb3JkQ2xhc3Nlcy5zaXplKCk7IGkrKykK\nICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCgoQXJyYXlMaXN0KSByZWNvcmRD\nbGFzc2VzKS5nZXQoaSksIG9zW2ldLmdldENsYXNzKCkpOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBtYXBIZWxwZXIoYm9vbGVhbiB1bmlxdWUsIENvbGxl\nY3Rpb24gcmVjb3JkQ2xhc3NlcywKICAgICAgICBDb2xsZWN0aW9uIHJlc3Vs\ndHMsIGJvb2xlYW4gaW5DYWNoZSkgewogICAgICAgIFF1ZXJ5IHEgPSBzZXRV\ncFF1ZXJ5KHVuaXF1ZSwgcmVzdWx0cyk7CiAgICAgICAgU3lzdGVtLm91dC5w\ncmludGxuKCJRdWVyeSBTdHJpbmcgIiArIHEuZ2V0UXVlcnlTdHJpbmcoKSk7\nCiAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gbnVsbDsKICAgICAgICBpZiAo\ncS5leGVjdXRlKCkgIT0gbnVsbCAmJiAocS5leGVjdXRlKCkgaW5zdGFuY2Vv\nZiBDb2xsZWN0aW9uKSkgewogICAgICAgICAgICBjb2xsID0gKENvbGxlY3Rp\nb24pIHEuZXhlY3V0ZSgpOwogICAgICAgIH0KICAgICAgICBTeXN0ZW0ub3V0\nLnByaW50bG4oIlR5cGUgb2YgcS5leGVjdXRlIGlzIDogIiArIHEuZXhlY3V0\nZSgpLmdldENsYXNzKCkpOwoKICAgICAgICBJdGVyYXRvciBpdCA9IGNvbGwu\naXRlcmF0b3IoKTsKICAgICAgICB3aGlsZSAoaXQuaGFzTmV4dCgpKQogICAg\nICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlF1ZXJ5IHJlc3VsdCBpcyAi\nICsgaXQubmV4dCgpLmdldENsYXNzKCkpOwoKICAgICAgICBxLnNldFJlc3Vs\ndFR5cGUoSGFzaE1hcC5jbGFzcyk7CgogICAgICAgIGlmICh1bmlxdWUpIHsK\nICAgICAgICAgICAgbWFwUmVzdWx0SGVscGVyKHEuZXhlY3V0ZSgpLCByZWNv\ncmRDbGFzc2VzLCByZXN1bHRzLCBpbkNhY2hlKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSAoKENvbGxlY3Rp\nb24pIHEuZXhlY3V0ZSgpKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAg\naXRlci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgbWFwUmVzdWx0SGVs\ncGVyKGl0ZXIubmV4dCgpLCByZWNvcmRDbGFzc2VzLCByZXN1bHRzLCBpbkNh\nY2hlKTsKICAgICAgICB9CgogICAgICAgIENhY2hlVGVzdEhlbHBlci5hc3Nl\ncnRJbkNhY2hlKHRoaXMsIHEsIG5ldyBCb29sZWFuKGluQ2FjaGUpKTsKCiAg\nICAgICAgaWYgKHVuaXF1ZSkgewogICAgICAgICAgICBtYXBSZXN1bHRIZWxw\nZXIocS5leGVjdXRlKCksIHJlY29yZENsYXNzZXMsIHJlc3VsdHMsIGluQ2Fj\naGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRlciA9ICgoTGlzdCkgcS5leGVjdXRlKCkpLml0ZXJhdG9yKCk7IGl0\nZXIKICAgICAgICAgICAgICAgIC5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgbWFwUmVzdWx0SGVscGVyKGl0ZXIubmV4dCgpLCByZWNvcmRDbGFzc2Vz\nLCByZXN1bHRzLCBpbkNhY2hlKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIG1hcFJlc3VsdEhlbHBlcihPYmplY3QgcmVzdWx0LCBDb2xs\nZWN0aW9uIHJlY29yZENsYXNzZXMsCiAgICAgICAgQ29sbGVjdGlvbiByZXN1\nbHRzLCBib29sZWFuIGluQ2FjaGUpIHsKICAgICAgICBhc3NlcnRFcXVhbHMo\nSGFzaE1hcC5jbGFzcywgcmVzdWx0LmdldENsYXNzKCkpOwogICAgICAgIEhh\nc2hNYXAgbSA9IChIYXNoTWFwKSByZXN1bHQ7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKHJlY29yZENsYXNzZXMuc2l6ZSgpLCBtLnNpemUoKSk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCByZWNvcmRDbGFzc2VzLnNpemUoKTsgaSsr\nKQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoIk1hcCBDb250ZW50cyAiICsg\nbS50b1N0cmluZygpICsgIiByZXN1bHQ6ICIgKyByZXN1bHQKICAgICAgICAg\nICAgICAgICsgIiBsb29wIHNpemU6ICIgKyByZWNvcmRDbGFzc2VzLnNpemUo\nKQogICAgICAgICAgICAgICAgKyAiVmFsdWUgb2YgbS5nZXQocmVzdWx0c1tp\nXSkgIgogICAgICAgICAgICAgICAgKyBtLmdldCgoKEFycmF5TGlzdCkgcmVz\ndWx0cykuZ2V0KGkpLmdldENsYXNzKCkpLAogICAgICAgICAgICAgICAgKChB\ncnJheUxpc3QpIHJlY29yZENsYXNzZXMpLmdldChpKSwKICAgICAgICAgICAg\nICAgIG0uZ2V0KCJqcHFsYWxpYXMiICsgKGkgKyAxKSkuZ2V0Q2xhc3MoKSk7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJhd0hlbHBlcihib29sZWFuIHVu\naXF1ZSwgQ2xhc3MgcmVjb3JkQ2xhc3MsIFN0cmluZyByZXN1bHQsCiAgICAg\nICAgYm9vbGVhbiBpbkNhY2hlKSB7CiAgICAgICAgQXJyYXlMaXN0PFN0cmlu\nZz4gbCA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgIGwuYWRk\nKHJlc3VsdCk7CiAgICAgICAgQ29sbGVjdGlvbiByZXMgPSAocmVzdWx0ID09\nIG51bGwpID8gbnVsbCA6IGw7CiAgICAgICAgUXVlcnkgcSA9IHNldFVwUXVl\ncnkodW5pcXVlLCByZXMpOwogICAgICAgIGlmICh1bmlxdWUpCiAgICAgICAg\nICAgIGFzc2VydEVxdWFscyhyZWNvcmRDbGFzcywgcS5leGVjdXRlKCkuZ2V0\nQ2xhc3MoKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHEuc2V0VW5p\ncXVlKHVuaXF1ZSk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9\nICgoTGlzdCkgcS5leGVjdXRlKCkpLml0ZXJhdG9yKCk7IGl0ZXIKICAgICAg\nICAgICAgICAgIC5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKHJlY29yZENsYXNzLCBpdGVyLm5leHQoKS5nZXRDbGFzcygpKTsK\nICAgICAgICB9CgogICAgICAgIENhY2hlVGVzdEhlbHBlci5hc3NlcnRJbkNh\nY2hlKHRoaXMsIHEsIG5ldyBCb29sZWFuKGluQ2FjaGUpKTsKCiAgICAgICAg\naWYgKHVuaXF1ZSkgewogICAgICAgICAgICBhc3NlcnRFcXVhbHMocmVjb3Jk\nQ2xhc3MsIHEuZXhlY3V0ZSgpLmdldENsYXNzKCkpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9ICgoTGlzdCkg\ncS5leGVjdXRlKCkpLml0ZXJhdG9yKCk7IGl0ZXIKICAgICAgICAgICAgICAg\nIC5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKHJl\nY29yZENsYXNzLCBpdGVyLm5leHQoKS5nZXRDbGFzcygpKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBRdWVyeSBzZXRVcFF1ZXJ5KGJvb2xlYW4g\ndW5pcXVlLCBDb2xsZWN0aW9uIHJlc3VsdHMpIHsKICAgICAgICBTdHJpbmcg\nZmlsdGVyID0gInNlbGVjdCI7CiAgICAgICAgQXJyYXlMaXN0IHJlc3VsdHNs\nID0gKEFycmF5TGlzdCkgcmVzdWx0czsKICAgICAgICBpZiAocmVzdWx0cyAh\nPSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyByZXN1bHRTdHJpbmcgPSAi\nIjsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXN1bHRzbC5z\naXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgcmVzdWx0U3RyaW5nICs9\nICJhLiIgKyByZXN1bHRzbC5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAo\naSA8IHJlc3VsdHMuc2l6ZSgpIC0gMSkKICAgICAgICAgICAgICAgICAgICBy\nZXN1bHRTdHJpbmcgKz0gIiwgIjsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBmaWx0ZXIgKz0gIiAiICsgcmVzdWx0U3RyaW5nOwogICAgICAgICAgICBm\naWx0ZXIgKz0gIiAiICsgImZyb20gIgogICAgICAgICAgICAgICAgKyBDYWNo\nZU9iamVjdEFDaGlsZDEuY2xhc3MuZ2V0U3VwZXJjbGFzcygpLmdldFNpbXBs\nZU5hbWUoKQogICAgICAgICAgICAgICAgKyAiIGEiOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIGZpbHRlciArPSAiICIgKyAiYSBmcm9tICIKICAg\nICAgICAgICAgICAgICsgQ2FjaGVPYmplY3RBQ2hpbGQxLmNsYXNzLmdldFN1\ncGVyY2xhc3MoKS5nZXRTaW1wbGVOYW1lKCkKICAgICAgICAgICAgICAgICsg\nIiBhIjsKICAgICAgICB9CgogICAgICAgIGlmICh1bmlxdWUpCiAgICAgICAg\nICAgIGZpbHRlciArPSAiIHdoZXJlIGEuYWdlID0gMCI7CiAgICAgICAgU3lz\ndGVtLm91dC5wcmludGxuKCIqKioqUXVlcnk6ICIgKyBmaWx0ZXIpOwogICAg\nICAgIFF1ZXJ5IHEgPSBfYnJva2VyLm5ld1F1ZXJ5KEpQUUxQYXJzZXIuTEFO\nR19KUFFMLCBmaWx0ZXIpOwogICAgICAgIHEuc2V0VW5pcXVlKHVuaXF1ZSk7\nCiAgICAgICAgcS5zZXRDYW5kaWRhdGVUeXBlKENhY2hlT2JqZWN0QUNoaWxk\nMS5jbGFzcywgZmFsc2UpOwoKICAgICAgICByZXR1cm4gcTsKICAgIH0KfQo=\n","encoding":"base64"}

