{"sha":"530824ad412bf8e6e5d1e80ce23c7ed0aa8c999f","node_id":"MDQ6QmxvYjIwNjM2NDo1MzA4MjRhZDQxMmJmOGU2ZTVkMWU4MGNlMjNjN2VkMGFhOGM5OTlm","size":5259,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/530824ad412bf8e6e5d1e80ce23c7ed0aa8c999f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5qZGJjLmFubm90\nYXRpb25zOwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudGl0eU1hbmFn\nZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBLZXk7CgppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5G\naWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5SZWxhdGlvbk1hcEludmVyc2VLZXlGaWVsZFN0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuT3BlbkpQQUVudGl0eU1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UudGVzdC5T\naW5nbGVFTUZUZXN0Q2FzZTsKCi8qKgogKiA8cD5UZXN0IHRoZSB1c2Ugb2Yg\ndGhlIHtAbGluayBNYXBLZXl9IGFubm90YXRpb24uICBOb3RlIHRoYXQgd2Ug\naGF2ZQogKiBtb3JlIHRob3JvdWdoIEtvZG8gY29yZSB0ZXN0cyBmb3IgdGhl\nIG1hcHBpbmdzIHRoZW1zZWx2ZXMuICBTZWUKICoge0BsaW5rIGtvZG8uamRi\nYy5tZXRhLlRlc3RNYXBwZWRCeUtleU1hcHN9LgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFRlc3RNYXBLZXkKICAgIGV4dGVu\nZHMgU2luZ2xlRU1GVGVzdENhc2UgewoKICAgIHB1YmxpYyB2b2lkIHNldFVw\nKCkgewogICAgICAgIHNldFVwKEZsYXQxLmNsYXNzLCBBbm5vVGVzdDEuY2xh\nc3MsIEFubm9UZXN0Mi5jbGFzcywgQ0xFQVJfVEFCTEVTKTsKCiAgICB9Cgog\nICAgcHVibGljIHZvaWQgdGVzdERlZmF1bHRNYXBLZXlNYXBwaW5nKCkgewog\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKChKREJDQ29uZmlndXJh\ndGlvbikgZW1mLmdldENvbmZpZ3VyYXRpb24oKSkKICAgICAgICAgICAgLmdl\ndE1hcHBpbmdSZXBvc2l0b3J5SW5zdGFuY2UoKS5nZXRNYXBwaW5nKEFubm9U\nZXN0MS5jbGFzcywKICAgICAgICAgICAgICAgIG51bGwsIHRydWUpOwogICAg\nICAgIEZpZWxkTWFwcGluZyBmbSA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5n\nKCJkZWZhdWx0TWFwS2V5Iik7CiAgICAgICAgYXNzZXJ0VHJ1ZShmbS5nZXRT\ndHJhdGVneSgpIGluc3RhbmNlb2YgUmVsYXRpb25NYXBUYWJsZUZpZWxkU3Ry\nYXRlZ3kpOwogICAgICAgIGFzc2VydEVxdWFscygicGsiLCBmbS5nZXRLZXko\nKS5nZXRWYWx1ZU1hcHBlZEJ5KCkpOwogICAgICAgIGFzc2VydEVxdWFscyht\nYXBwaW5nLmdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YShGbGF0MS5jbGFz\ncywgbnVsbCwKICAgICAgICAgICAgdHJ1ZSkuZ2V0RmllbGQoInBrIiksIGZt\nLmdldEtleSgpLmdldFZhbHVlTWFwcGVkQnlNZXRhRGF0YSgpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0TmFtZWRNYXBLZXlNYXBwaW5nKCkgewog\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKChKREJDQ29uZmlndXJh\ndGlvbikgZW1mLmdldENvbmZpZ3VyYXRpb24oKSkKICAgICAgICAgICAgLmdl\ndE1hcHBpbmdSZXBvc2l0b3J5SW5zdGFuY2UoKS5nZXRNYXBwaW5nKEFubm9U\nZXN0MS5jbGFzcywKICAgICAgICAgICAgICAgIG51bGwsIHRydWUpOwogICAg\nICAgIEZpZWxkTWFwcGluZyBmbSA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5n\nKCJuYW1lZE1hcEtleSIpOwogICAgICAgIGFzc2VydFRydWUoZm0uZ2V0U3Ry\nYXRlZ3koKSBpbnN0YW5jZW9mIFJlbGF0aW9uTWFwVGFibGVGaWVsZFN0cmF0\nZWd5KTsKICAgICAgICBhc3NlcnRFcXVhbHMoImJhc2ljIiwgZm0uZ2V0S2V5\nKCkuZ2V0VmFsdWVNYXBwZWRCeSgpKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nbWFwcGluZy5nZXRSZXBvc2l0b3J5KCkuZ2V0TWV0YURhdGEoRmxhdDEuY2xh\nc3MsIG51bGwsCiAgICAgICAgICAgIHRydWUpLmdldEZpZWxkKCJiYXNpYyIp\nLCBmbS5nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5TWV0YURhdGEoKSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgdGVzdEludmVyc2VPd25lck1hcEtleU1h\ncHBpbmcoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoKEpE\nQkNDb25maWd1cmF0aW9uKSBlbWYuZ2V0Q29uZmlndXJhdGlvbigpKQogICAg\nICAgICAgICAuZ2V0TWFwcGluZ1JlcG9zaXRvcnlJbnN0YW5jZSgpLmdldE1h\ncHBpbmcoQW5ub1Rlc3QxLmNsYXNzLAogICAgICAgICAgICAgICAgbnVsbCwg\ndHJ1ZSk7CiAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gbWFwcGluZy5nZXRG\naWVsZE1hcHBpbmcoImludmVyc2VPd25lck1hcEtleSIpOwogICAgICAgIGFz\nc2VydFRydWUoZm0uZ2V0U3RyYXRlZ3koKSBpbnN0YW5jZW9mCiAgICAgICAg\nICAgIFJlbGF0aW9uTWFwSW52ZXJzZUtleUZpZWxkU3RyYXRlZ3kpOwogICAg\nICAgIGFzc2VydEVxdWFscygiYmFzaWMiLCBmbS5nZXRLZXkoKS5nZXRWYWx1\nZU1hcHBlZEJ5KCkpOwogICAgICAgIGFzc2VydEVxdWFscyhtYXBwaW5nLmdl\ndFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YShBbm5vVGVzdDIuY2xhc3MsCiAg\nICAgICAgICAgIG51bGwsIHRydWUpLmdldEZpZWxkKCJiYXNpYyIpLCBmbS5n\nZXRLZXkoKS4KICAgICAgICAgICAgZ2V0VmFsdWVNYXBwZWRCeU1ldGFEYXRh\nKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RJbnNlcnRBbmRSZXRy\naWV2ZSgpIHsKICAgICAgICBGbGF0MSBmMSA9IG5ldyBGbGF0MSgxKTsKICAg\nICAgICBmMS5zZXRCYXNpYygxMDApOwogICAgICAgIEZsYXQxIGYyID0gbmV3\nIEZsYXQxKDIpOwogICAgICAgIGYyLnNldEJhc2ljKDIwMCk7CiAgICAgICAg\nQW5ub1Rlc3QyIGExID0gbmV3IEFubm9UZXN0MigxTCwgIjEiKTsKICAgICAg\nICBhMS5zZXRCYXNpYygiMTAwIik7CiAgICAgICAgQW5ub1Rlc3QyIGEyID0g\nbmV3IEFubm9UZXN0MigyTCwgIjIiKTsKICAgICAgICBhMi5zZXRCYXNpYygi\nMjAwIik7CgogICAgICAgIEFubm9UZXN0MSBwYyA9IG5ldyBBbm5vVGVzdDEo\nMUwpOwogICAgICAgIHBjLmdldERlZmF1bHRNYXBLZXkoKS5wdXQoZjEuZ2V0\nUGsoKSwgZjEpOwogICAgICAgIHBjLmdldERlZmF1bHRNYXBLZXkoKS5wdXQo\nZjIuZ2V0UGsoKSwgZjIpOwogICAgICAgIHBjLmdldE5hbWVkTWFwS2V5KCku\ncHV0KGYxLmdldEJhc2ljKCksIGYxKTsKICAgICAgICBwYy5nZXROYW1lZE1h\ncEtleSgpLnB1dChmMi5nZXRCYXNpYygpLCBmMik7CiAgICAgICAgcGMuZ2V0\nSW52ZXJzZU93bmVyTWFwS2V5KCkucHV0KGExLmdldEJhc2ljKCksIGExKTsK\nICAgICAgICBwYy5nZXRJbnZlcnNlT3duZXJNYXBLZXkoKS5wdXQoYTIuZ2V0\nQmFzaWMoKSwgYTIpOwogICAgICAgIGExLnNldE9uZU1hbnlPd25lcihwYyk7\nCiAgICAgICAgYTIuc2V0T25lTWFueU93bmVyKHBjKTsKCiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdl\ncigpOwogICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAg\nICAgICBlbS5wZXJzaXN0QWxsKG5ldyBPYmplY3RbXXsgcGMsIGYxLCBmMiwg\nYTEsIGEyIH0pOwogICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0\nKCk7CiAgICAgICAgZW0uY2xvc2UoKTsKCiAgICAgICAgZW0gPSBlbWYuY3Jl\nYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIHBjID0gZW0uZmluZChBbm5v\nVGVzdDEuY2xhc3MsIG5ldyBMb25nKDEpKTsKICAgICAgICBhc3NlcnRFcXVh\nbHMoMiwgcGMuZ2V0RGVmYXVsdE1hcEtleSgpLnNpemUoKSk7CiAgICAgICAg\nYXNzZXJ0RXF1YWxzKDEsIHBjLmdldERlZmF1bHRNYXBLZXkoKS5nZXQoMSku\nZ2V0UGsoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDIsIHBjLmdldERlZmF1\nbHRNYXBLZXkoKS5nZXQoMikuZ2V0UGsoKSk7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKDIsIHBjLmdldE5hbWVkTWFwS2V5KCkuc2l6ZSgpKTsKICAgICAgICBh\nc3NlcnRFcXVhbHMoMTAwLCBwYy5nZXROYW1lZE1hcEtleSgpLmdldCgxMDAp\nLmdldEJhc2ljKCkpOwogICAgICAgIGFzc2VydEVxdWFscygyMDAsIHBjLmdl\ndE5hbWVkTWFwS2V5KCkuZ2V0KDIwMCkuZ2V0QmFzaWMoKSk7CiAgICAgICAg\nYXNzZXJ0RXF1YWxzKDIsIHBjLmdldEludmVyc2VPd25lck1hcEtleSgpLnNp\nemUoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCIxMDAiLCBwYy5nZXRJbnZl\ncnNlT3duZXJNYXBLZXkoKS5nZXQoIjEwMCIpLgogICAgICAgICAgICBnZXRC\nYXNpYygpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIjIwMCIsIHBjLmdldElu\ndmVyc2VPd25lck1hcEtleSgpLmdldCgiMjAwIikuCiAgICAgICAgICAgIGdl\ndEJhc2ljKCkpOwogICAgICAgIGVtLmNsb3NlKCk7CiAgICB9Cn0K\n","encoding":"base64"}

