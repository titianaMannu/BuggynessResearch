{"sha":"a598c93fe4c74261ab065ad48de439d897e33aa9","node_id":"MDQ6QmxvYjIwNjM2NDphNTk4YzkzZmU0Yzc0MjYxYWIwNjVhZDQ4ZGU0MzlkODk3ZTMzYWE5","size":19123,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a598c93fe4c74261ab065ad48de439d897e33aa9","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2Uua2VybmVs\nOwoKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLmtlcm5lbC5jb21tb24uYXBwcy5E\nZXBlbmRlbnRGaWVsZHNQQzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5w\nZXJzaXN0ZW5jZS5FeHRlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ncGVyc2lzdGVuY2UuT3BlbkpQQUVudGl0eU1hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuT3BlbkpQQVBlcnNpc3RlbmNl\nOwoKcHVibGljIGNsYXNzIFRlc3REZXBlbmRlbnRGaWVsZHMyIGV4dGVuZHMg\nQmFzZUtlcm5lbFRlc3QgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlu\ndCBDT01NSVQgPSAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFJP\nTExCQUNLID0gMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBQUkVT\nVE9SRSA9IDI7CgogICAgcHJpdmF0ZSBPYmplY3QgX3Jvb3QgPSBudWxsOwog\nICAgcHJpdmF0ZSBPYmplY3QgX3JlbCA9IG51bGw7CiAgICBwcml2YXRlIE9i\namVjdCBfZGVwUmVsID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0IF9kZWVw\nID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0IF9jb2xsID0gbnVsbDsKICAg\nIHByaXZhdGUgT2JqZWN0IF9kZXBDb2xsID0gbnVsbDsKICAgIHByaXZhdGUg\nT2JqZWN0IF9tYXAgPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2RlcE1h\ncCA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfcmVwZWF0ID0gbnVsbDsK\nCiAgICBwdWJsaWMgVGVzdERlcGVuZGVudEZpZWxkczIoU3RyaW5nIGNhc2Vu\nYW1lKSB7CiAgICAgICAgc3VwZXIoY2FzZW5hbWUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nZGVsZXRlQWxsKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzKTsKCiAgICAgICAg\nRGVwZW5kZW50RmllbGRzUEMgcm9vdCA9IG5ldyBEZXBlbmRlbnRGaWVsZHNQ\nQygpOwogICAgICAgIHJvb3Quc2V0UmVsYXRpb24obmV3IERlcGVuZGVudEZp\nZWxkc1BDKCkpOwogICAgICAgIHJvb3QuZ2V0TGlzdCgpLmFkZChuZXcgRGVw\nZW5kZW50RmllbGRzUEMoKSk7CiAgICAgICAgcm9vdC5nZXRNYXAoKS5wdXQo\nImtleSIsIG5ldyBEZXBlbmRlbnRGaWVsZHNQQygpKTsKICAgICAgICByb290\nLnNldERlcGVuZGVudFJlbGF0aW9uKG5ldyBEZXBlbmRlbnRGaWVsZHNQQygp\nKTsKICAgICAgICByb290LmdldERlcGVuZGVudFJlbGF0aW9uKCkuc2V0RGVw\nZW5kZW50UmVsYXRpb24KICAgICAgICAgICAgKG5ldyBEZXBlbmRlbnRGaWVs\nZHNQQygpKTsKICAgICAgICByb290LmdldERlcGVuZGVudExpc3QoKS5hZGQo\nbmV3IERlcGVuZGVudEZpZWxkc1BDKCkpOwogICAgICAgIHJvb3QuZ2V0RGVw\nZW5kZW50TWFwKCkucHV0KCJrZXkiLCBuZXcgRGVwZW5kZW50RmllbGRzUEMo\nKSk7CgogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIHJlcGVhdCA9IG5ldyBE\nZXBlbmRlbnRGaWVsZHNQQygpOwogICAgICAgIHJvb3QuZ2V0RGVwZW5kZW50\nTGlzdCgpLmFkZChyZXBlYXQpOwogICAgICAgIHJvb3QuZ2V0RGVwZW5kZW50\nTWFwKCkucHV0KCJyZXBlYXQiLCByZXBlYXQpOwoKICAgICAgICBPcGVuSlBB\nRW50aXR5TWFuYWdlciBwbSA9CiAgICAgICAgICAgIChPcGVuSlBBRW50aXR5\nTWFuYWdlcikgY3VycmVudEVudGl0eU1hbmFnZXIoKTsKICAgICAgICBzdGFy\ndFR4KHBtKTsKICAgICAgICBwbS5wZXJzaXN0KHJvb3QpOwogICAgICAgIGVu\nZFR4KHBtKTsKCiAgICAgICAgX3Jvb3QgPSBwbS5nZXRPYmplY3RJZChyb290\nKTsKICAgICAgICBhc3NlcnROb3ROdWxsKF9yb290KTsKICAgICAgICBfcmVs\nID0gcG0uZ2V0T2JqZWN0SWQocm9vdC5nZXRSZWxhdGlvbigpKTsKICAgICAg\nICBfZGVwUmVsID0gcG0uZ2V0T2JqZWN0SWQocm9vdC5nZXREZXBlbmRlbnRS\nZWxhdGlvbigpKTsKICAgICAgICBfZGVlcCA9IHBtLmdldE9iamVjdElkKHJv\nb3QuZ2V0RGVwZW5kZW50UmVsYXRpb24oKS4KICAgICAgICAgICAgZ2V0RGVw\nZW5kZW50UmVsYXRpb24oKSk7CiAgICAgICAgX2NvbGwgPSBwbS5nZXRPYmpl\nY3RJZChyb290LmdldExpc3QoKS5pdGVyYXRvcigpLm5leHQoKSk7CiAgICAg\nICAgSXRlcmF0b3IgaXRyID0gcm9vdC5nZXREZXBlbmRlbnRMaXN0KCkuaXRl\ncmF0b3IoKTsKICAgICAgICBfZGVwQ29sbCA9IHBtLmdldE9iamVjdElkKGl0\nci5uZXh0KCkpOwogICAgICAgIF9yZXBlYXQgPSBwbS5nZXRPYmplY3RJZChp\ndHIubmV4dCgpKTsKICAgICAgICBfbWFwID0gcG0uZ2V0T2JqZWN0SWQocm9v\ndC5nZXRNYXAoKS5nZXQoImtleSIpKTsKICAgICAgICBfZGVwTWFwID0gcG0u\nZ2V0T2JqZWN0SWQocm9vdC5nZXREZXBlbmRlbnRNYXAoKS5nZXQoImtleSIp\nKTsKCiAgICAgICAgZW5kRW0ocG0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHRlc3REZXBlbmRlbnRGaWVsZHNMb2FkZWQoKSB7CiAgICAgICAgZGVsZXRl\nKHRydWUsIENPTU1JVCk7CiAgICAgICAgY2hlY2tGaWVsZHMoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0RGVwZW5kZW50RmllbGRzTG9hZGVkV2l0\naFJvbGxiYWNrKCkgewogICAgICAgIGRlbGV0ZSh0cnVlLCBST0xMQkFDSyk7\nCiAgICAgICAgY2hlY2tGaWVsZHMoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0RGVwZW5kZW50RmllbGRzTG9hZGVkV2l0aFByZVN0b3JlKCkgewog\nICAgICAgIGRlbGV0ZSh0cnVlLCBQUkVTVE9SRSk7CiAgICAgICAgY2hlY2tG\naWVsZHMoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0RGVwZW5kZW50\nRmllbGRzVW5sb2FkZWQoKSB7CiAgICAgICAgZGVsZXRlKGZhbHNlLCBDT01N\nSVQpOwogICAgICAgIGNoZWNrRmllbGRzKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgdGVzdERlcGVuZGVudEZpZWxkc1VubG9hZGVkV2l0aFJvbGxiYWNr\nKCkgewogICAgICAgIGRlbGV0ZShmYWxzZSwgUk9MTEJBQ0spOwogICAgICAg\nIGNoZWNrRmllbGRzKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdERl\ncGVuZGVudEZpZWxkc1VubG9hZGVkV2l0aFByZVN0b3JlKCkgewogICAgICAg\nIGRlbGV0ZShmYWxzZSwgUFJFU1RPUkUpOwogICAgICAgIGNoZWNrRmllbGRz\nKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGRlbGV0ZShib29sZWFuIGxv\nYWQsIGludCBhY3Rpb24pIHsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdl\nciBwbSA9IGdldFBNKHRydWUsIHRydWUpOwogICAgICAgIERlcGVuZGVudEZp\nZWxkc1BDIHJvb3Q7CiAgICAgICAgT2JqZWN0IHJlbCA9IG51bGw7CiAgICAg\nICAgT2JqZWN0IGRlcFJlbCA9IG51bGw7CiAgICAgICAgT2JqZWN0IGNvbGwg\nPSBudWxsOwogICAgICAgIE9iamVjdCBkZXBDb2xsID0gbnVsbDsKICAgICAg\nICBPYmplY3QgbWFwID0gbnVsbDsKICAgICAgICBPYmplY3QgZGVwTWFwID0g\nbnVsbDsKICAgICAgICBPYmplY3QgcmVwZWF0ID0gbnVsbDsKICAgICAgICBP\nYmplY3QgZGVlcCA9IG51bGw7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAg\nICAgICAgICAgc3RhcnRUeChwbSk7CiAgICAgICAgICAgIHJvb3QgPSAoRGVw\nZW5kZW50RmllbGRzUEMpIHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xh\nc3MsIF9yb290KTsKICAgICAgICAgICAgaWYgKGxvYWQpIHsKICAgICAgICAg\nICAgICAgIHJlbCA9IHJvb3QuZ2V0UmVsYXRpb24oKTsKICAgICAgICAgICAg\nICAgIGFzc2VydE5vdE51bGwocmVsKTsKICAgICAgICAgICAgICAgIGRlcFJl\nbCA9IHJvb3QuZ2V0RGVwZW5kZW50UmVsYXRpb24oKTsKICAgICAgICAgICAg\nICAgIGFzc2VydE5vdE51bGwoZGVwUmVsKTsKICAgICAgICAgICAgICAgIGRl\nZXAgPSAoKERlcGVuZGVudEZpZWxkc1BDKSBkZXBSZWwpLmdldERlcGVuZGVu\ndFJlbGF0aW9uKCk7CiAgICAgICAgICAgICAgICBhc3NlcnROb3ROdWxsKGRl\nZXApOwogICAgICAgICAgICAgICAgY29sbCA9IHJvb3QuZ2V0TGlzdCgpLml0\nZXJhdG9yKCkubmV4dCgpOwogICAgICAgICAgICAgICAgYXNzZXJ0Tm90TnVs\nbChjb2xsKTsKICAgICAgICAgICAgICAgIEl0ZXJhdG9yIGl0ciA9IHJvb3Qu\nZ2V0RGVwZW5kZW50TGlzdCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAg\nICBkZXBDb2xsID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIHJlcGVh\ndCA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBhc3NlcnROb3ROdWxs\nKGRlcENvbGwpOwogICAgICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChyZXBl\nYXQpOwogICAgICAgICAgICAgICAgbWFwID0gcm9vdC5nZXRNYXAoKS5nZXQo\nImtleSIpOwogICAgICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChtYXApOwog\nICAgICAgICAgICAgICAgZGVwTWFwID0gcm9vdC5nZXREZXBlbmRlbnRNYXAo\nKS5nZXQoImtleSIpOwogICAgICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChk\nZXBNYXApOwoKICAgICAgICAgICAgICAgIC8vIHBjbDogdGVzdCBib3RoIGRl\ncENvbGwgYW5kIHJlcGVhdCwgc2luY2UgdGhleSBtaWdodAogICAgICAgICAg\nICAgICAgLy8gaGF2ZSBiZWVuIG91dCBvZiBvcmRlciBhYm92ZS4KICAgICAg\nICAgICAgICAgIE9iamVjdCBvID0gcm9vdC5nZXREZXBlbmRlbnRNYXAoKS5n\nZXQoInJlcGVhdCIpOwogICAgICAgICAgICAgICAgaWYgKG8gIT0gcmVwZWF0\nKQogICAgICAgICAgICAgICAgICAgIGZhaWwoImRlcGVuZGVudCBtYXAgZG9l\ncyBub3QgY29udGFpbiAncmVwZWF0JyIpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHBtLnJlbW92ZShyb290KTsKCiAgICAgICAgICAgIGlmIChhY3Rp\nb24gPT0gUk9MTEJBQ0spIHsKICAgICAgICAgICAgICAgIHJvbGxiYWNrVHgo\ncG0pOwogICAgICAgICAgICAgICAgYWN0aW9uID0gQ09NTUlUOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PSBDT01NSVQpIHsKICAgICAgICAg\nICAgICAgIGVuZFR4KHBtKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG0ucHJlRmx1c2go\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBpZiAobG9hZCkgewogICAgICAgICAgICBpZiAoYWN0\naW9uID09IFBSRVNUT1JFKSB7CiAgICAgICAgICAgICAgICBhc3NlcnRGYWxz\nZShwbS5pc1JlbW92ZWQocmVsKSk7CiAgICAgICAgICAgICAgICBhc3NlcnRG\nYWxzZShwbS5pc1JlbW92ZWQoY29sbCkpOwogICAgICAgICAgICAgICAgYXNz\nZXJ0RmFsc2UocG0uaXNSZW1vdmVkKG1hcCkpOwogICAgICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZShwbS5pc1JlbW92ZWQoZGVwUmVsKSk7CiAgICAgICAgICAg\nICAgICBhc3NlcnRUcnVlKHBtLmlzUmVtb3ZlZChkZWVwKSk7CiAgICAgICAg\nICAgICAgICBhc3NlcnRUcnVlKHBtLmlzUmVtb3ZlZChkZXBDb2xsKSk7CiAg\nICAgICAgICAgICAgICBhc3NlcnRUcnVlKHBtLmlzUmVtb3ZlZChkZXBNYXAp\nKTsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUocG0uaXNSZW1vdmVkKHJl\ncGVhdCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nYXNzZXJ0Tm90TnVsbChPcGVuSlBBUGVyc2lzdGVuY2UuZ2V0RW50aXR5TWFu\nYWdlcihyZWwpKTsKICAgICAgICAgICAgICAgIGFzc2VydE5vdE51bGwoT3Bl\nbkpQQVBlcnNpc3RlbmNlLmdldEVudGl0eU1hbmFnZXIoY29sbCkpOwogICAg\nICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChPcGVuSlBBUGVyc2lzdGVuY2Uu\nZ2V0RW50aXR5TWFuYWdlcihtYXApKTsKICAgICAgICAgICAgICAgIGFzc2Vy\ndE51bGwoT3BlbkpQQVBlcnNpc3RlbmNlLmdldEVudGl0eU1hbmFnZXIoZGVw\nUmVsKSk7CiAgICAgICAgICAgICAgICBhc3NlcnROdWxsKE9wZW5KUEFQZXJz\naXN0ZW5jZS5nZXRFbnRpdHlNYW5hZ2VyKGRlZXApKTsKICAgICAgICAgICAg\nICAgIGFzc2VydE51bGwoT3BlbkpQQVBlcnNpc3RlbmNlLmdldEVudGl0eU1h\nbmFnZXIoZGVwQ29sbCkpOwogICAgICAgICAgICAgICAgYXNzZXJ0TnVsbChP\ncGVuSlBBUGVyc2lzdGVuY2UuZ2V0RW50aXR5TWFuYWdlcihkZXBNYXApKTsK\nICAgICAgICAgICAgICAgIGFzc2VydE51bGwoT3BlbkpQQVBlcnNpc3RlbmNl\nLmdldEVudGl0eU1hbmFnZXIocmVwZWF0KSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGlmIChhY3Rpb24gPT0gUFJFU1RPUkUpCiAgICAg\nICAgICAgIGVuZFR4KHBtKTsKICAgICAgICBlbmRFbShwbSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIGNoZWNrRmllbGRzKCkgewogICAgICAgIE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyIHBtID0gZ2V0UE0odHJ1ZSwgdHJ1ZSk7CiAgICAg\nICAgYXNzZXJ0Tm90TnVsbChwbS5maW5kKERlcGVuZGVudEZpZWxkc1BDLmNs\nYXNzLCBfcmVsKSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChwbS5maW5kKERl\ncGVuZGVudEZpZWxkc1BDLmNsYXNzLCBfY29sbCkpOwogICAgICAgIGFzc2Vy\ndE5vdE51bGwocG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX21h\ncCkpOwogICAgICAgIGFzc2VydE51bGwocG0uZmluZChEZXBlbmRlbnRGaWVs\nZHNQQy5jbGFzcywgX2RlcFJlbCkpOwogICAgICAgIGFzc2VydE51bGwocG0u\nZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX2RlZXApKTsKICAgICAg\nICBhc3NlcnROdWxsKHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xhc3Ms\nIF9kZXBDb2xsKSk7CiAgICAgICAgYXNzZXJ0TnVsbChwbS5maW5kKERlcGVu\nZGVudEZpZWxkc1BDLmNsYXNzLCBfZGVwTWFwKSk7CgogICAgICAgIGVuZEVt\nKHBtKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0TnVsbERlbGV0ZXNE\nZXBlbmRlbnQoKSB7CiAgICAgICAgbnVsbERlbGV0ZXNEZXBlbmRlbnQoQ09N\nTUlUKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0TnVsbERlbGV0ZXNE\nZXBlbmRlbnRXaXRoUm9sbGJhY2soKSB7CiAgICAgICAgbnVsbERlbGV0ZXNE\nZXBlbmRlbnQoUk9MTEJBQ0spOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRl\nc3ROdWxsRGVsZXRlc0RlcGVuZGVudFdpdGhQcmVTdG9yZSgpIHsKICAgICAg\nICBudWxsRGVsZXRlc0RlcGVuZGVudChQUkVTVE9SRSk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIG51bGxEZWxldGVzRGVwZW5kZW50KGludCBhY3Rpb24p\nIHsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBwbSA9CiAgICAgICAg\nICAgIChPcGVuSlBBRW50aXR5TWFuYWdlcikgY3VycmVudEVudGl0eU1hbmFn\nZXIoKTsKICAgICAgICBEZXBlbmRlbnRGaWVsZHNQQyBwYzsKICAgICAgICBE\nZXBlbmRlbnRGaWVsZHNQQyBkZXBSZWw7CiAgICAgICAgd2hpbGUgKHRydWUp\nIHsKICAgICAgICAgICAgc3RhcnRUeChwbSk7CiAgICAgICAgICAgIHBjID0g\nKERlcGVuZGVudEZpZWxkc1BDKSBwbS5maW5kKERlcGVuZGVudEZpZWxkc1BD\nLmNsYXNzLCBfcm9vdCk7CiAgICAgICAgICAgIGRlcFJlbCA9IHBjLmdldERl\ncGVuZGVudFJlbGF0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyhf\nZGVwUmVsLCBwbS5nZXRPYmplY3RJZChkZXBSZWwpKTsKICAgICAgICAgICAg\ncGMuc2V0RGVwZW5kZW50UmVsYXRpb24obnVsbCk7CiAgICAgICAgICAgIGlm\nIChhY3Rpb24gPT0gUk9MTEJBQ0spIHsKICAgICAgICAgICAgICAgIHJvbGxi\nYWNrVHgocG0pOwogICAgICAgICAgICAgICAgYWN0aW9uID0gQ09NTUlUOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PSBDT01NSVQpIHsKICAg\nICAgICAgICAgICAgIGVuZFR4KHBtKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG0ucHJl\nRmx1c2goKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAoYWN0aW9uID09IFBSRVNUT1JFKSB7\nCiAgICAgICAgICAgIGFzc2VydFRydWUocG0uaXNSZW1vdmVkKGRlcFJlbCkp\nOwogICAgICAgICAgICBlbmRUeChwbSk7CiAgICAgICAgfQoKICAgICAgICBh\nc3NlcnRUcnVlKCFwbS5pc1BlcnNpc3RlbnQoZGVwUmVsKSk7CiAgICAgICAg\nYXNzZXJ0TnVsbChwbS5maW5kKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBf\nZGVwUmVsKSk7CiAgICAgICAgZW5kRW0ocG0pOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RSZW1vdmVEZWxldGVzRGVwZW5kZW50KCkgewogICAgICAg\nIHJlbW92ZURlbGV0ZXNEZXBlbmRlbnQoQ09NTUlUKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0UmVtb3ZlRGVsZXRlc0RlcGVuZGVudFdpdGhSb2xs\nYmFjaygpIHsKICAgICAgICByZW1vdmVEZWxldGVzRGVwZW5kZW50KFJPTExC\nQUNLKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVtb3ZlRGVsZXRl\nc0RlcGVuZGVudFdpdGhQcmVTdG9yZSgpIHsKICAgICAgICByZW1vdmVEZWxl\ndGVzRGVwZW5kZW50KFBSRVNUT1JFKTsKICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgcmVtb3ZlRGVsZXRlc0RlcGVuZGVudChpbnQgYWN0aW9uKSB7CiAgICAg\nICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgcG0gPQogICAgICAgICAgICAoT3Bl\nbkpQQUVudGl0eU1hbmFnZXIpIGN1cnJlbnRFbnRpdHlNYW5hZ2VyKCk7CiAg\nICAgICAgRGVwZW5kZW50RmllbGRzUEMgcGM7CiAgICAgICAgRGVwZW5kZW50\nRmllbGRzUEMgZGVwQ29sbDsKICAgICAgICBEZXBlbmRlbnRGaWVsZHNQQyBk\nZXBNYXA7CiAgICAgICAgTGlzdCBsaXN0OwogICAgICAgIE1hcCBtYXA7CiAg\nICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgc3RhcnRUeChwbSk7\nCiAgICAgICAgICAgIHBjID0gKERlcGVuZGVudEZpZWxkc1BDKSBwbS5maW5k\nKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBfcm9vdCk7CiAgICAgICAgICAg\nIGxpc3QgPSBwYy5nZXREZXBlbmRlbnRMaXN0KCk7CiAgICAgICAgICAgIGFz\nc2VydEVxdWFscygibGlzdCBzaXplID0hIDIiLCAyLCBsaXN0LnNpemUoKSk7\nCiAgICAgICAgICAgIGRlcENvbGwgPSAoRGVwZW5kZW50RmllbGRzUEMpIGxp\nc3QucmVtb3ZlKDApOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoIl9kZXBD\nb2xsIGlzIG5vdCBwbS5nZXRPYmplY3RJZChkZXBDb2xsKSIsIF9kZXBDb2xs\nLAogICAgICAgICAgICAgICAgcG0uZ2V0T2JqZWN0SWQoZGVwQ29sbCkpOwoK\nICAgICAgICAgICAgbWFwID0gcGMuZ2V0RGVwZW5kZW50TWFwKCk7CiAgICAg\nICAgICAgIGFzc2VydEVxdWFscygibWFwIHNpemUgPSEgMiIsIDIsIG1hcC5z\naXplKCkpOwogICAgICAgICAgICBkZXBNYXAgPSAoRGVwZW5kZW50RmllbGRz\nUEMpIG1hcC5yZW1vdmUoImtleSIpOwogICAgICAgICAgICBhc3NlcnRFcXVh\nbHMoIl9kZXBNYXAgaXMgbm90IHBtLmdldE9iamVjdElkKGRlcE1hcCkiLCBf\nZGVwTWFwLAogICAgICAgICAgICAgICAgcG0uZ2V0T2JqZWN0SWQoZGVwTWFw\nKSk7CgogICAgICAgICAgICBpZiAoYWN0aW9uID09IFJPTExCQUNLKSB7CiAg\nICAgICAgICAgICAgICByb2xsYmFja1R4KHBtKTsKICAgICAgICAgICAgICAg\nIGFjdGlvbiA9IENPTU1JVDsKICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rp\nb24gPT0gQ09NTUlUKSB7CiAgICAgICAgICAgICAgICBlbmRUeChwbSk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIHBtLnByZUZsdXNoKCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGFj\ndGlvbiA9PSBQUkVTVE9SRSkgewogICAgICAgICAgICBhc3NlcnRUcnVlKHBt\nLmlzUmVtb3ZlZChkZXBDb2xsKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUo\ncG0uaXNSZW1vdmVkKGRlcE1hcCkpOwogICAgICAgICAgICBlbmRUeChwbSk7\nCiAgICAgICAgfQoKLy8gICAgICAgIGFzc2VydFRydWUoImRlcGNvbGwgaXMg\ncGVyc2lzdGVuY2UiLCAhcG0uaXNQZXJzaXN0ZW50KGRlcENvbGwpKTsKICAg\nICAgICBhc3NlcnROdWxsKHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xh\nc3MsIF9kZXBDb2xsKSk7CgovLyAgICAgICAgYXNzZXJ0VHJ1ZSgiZGVwTWFw\nIGlzIHBlcnNpc3RlbmNlIiwgIXBtLmlzUGVyc2lzdGVudChkZXBNYXApKTsK\nICAgICAgICBhc3NlcnROdWxsKHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMu\nY2xhc3MsIF9kZXBNYXApKTsKCiAgICAgICAgYXNzZXJ0Tm90TnVsbCgicmVw\nZWF0IGlzIG51bGwiLAogICAgICAgICAgICBwbS5maW5kKERlcGVuZGVudEZp\nZWxkc1BDLmNsYXNzLCBfcmVwZWF0KSk7CiAgICAgICAgZW5kRW0ocG0pOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RNb3ZlRGVwZW5kZW50SW5Db250\nYWluZXIoKSB7CiAgICAgICAgbW92ZURlcGVuZGVudEluQ29udGFpbmVyKENP\nTU1JVCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdE1vdmVEZXBlbmRl\nbnRJbkNvbnRhaW5lcldpdGhSb2xsYmFjaygpIHsKICAgICAgICBtb3ZlRGVw\nZW5kZW50SW5Db250YWluZXIoUk9MTEJBQ0spOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RNb3ZlRGVwZW5kZW50SW5Db250YWluZXJXaXRoUHJlU3Rv\ncmUoKSB7CiAgICAgICAgbW92ZURlcGVuZGVudEluQ29udGFpbmVyKFBSRVNU\nT1JFKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgbW92ZURlcGVuZGVudElu\nQ29udGFpbmVyKGludCBhY3Rpb24pIHsKICAgICAgICBPcGVuSlBBRW50aXR5\nTWFuYWdlciBwbSA9CiAgICAgICAgICAgIChPcGVuSlBBRW50aXR5TWFuYWdl\ncikgY3VycmVudEVudGl0eU1hbmFnZXIoKTsKICAgICAgICBEZXBlbmRlbnRG\naWVsZHNQQyBwYzsKICAgICAgICBEZXBlbmRlbnRGaWVsZHNQQyBkZXBDb2xs\nOwogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIGRlcE1hcDsKICAgICAgICBM\naXN0IGxpc3Q7CiAgICAgICAgTWFwIG1hcDsKICAgICAgICB3aGlsZSAodHJ1\nZSkgewogICAgICAgICAgICBzdGFydFR4KHBtKTsKICAgICAgICAgICAgcGMg\nPSAoRGVwZW5kZW50RmllbGRzUEMpIHBtLmZpbmQoRGVwZW5kZW50RmllbGRz\nUEMuY2xhc3MsIF9yb290KTsKICAgICAgICAgICAgbGlzdCA9IHBjLmdldERl\ncGVuZGVudExpc3QoKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDIsIGxp\nc3Quc2l6ZSgpKTsKICAgICAgICAgICAgZGVwQ29sbCA9IChEZXBlbmRlbnRG\naWVsZHNQQykgbGlzdC5nZXQoMCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFs\ncyhfZGVwQ29sbCwgcG0uZ2V0T2JqZWN0SWQoZGVwQ29sbCkpOwogICAgICAg\nICAgICBsaXN0LnJlbW92ZSgwKTsKICAgICAgICAgICAgbGlzdC5hZGQoZGVw\nQ29sbCk7CgogICAgICAgICAgICBtYXAgPSBwYy5nZXREZXBlbmRlbnRNYXAo\nKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDIsIG1hcC5zaXplKCkpOwog\nICAgICAgICAgICBkZXBNYXAgPSAoRGVwZW5kZW50RmllbGRzUEMpIG1hcC5n\nZXQoImtleSIpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoX2RlcE1hcCwg\ncG0uZ2V0T2JqZWN0SWQoZGVwTWFwKSk7CiAgICAgICAgICAgIG1hcC5yZW1v\ndmUoImtleSIpOwogICAgICAgICAgICBtYXAucHV0KCJuZXdrZXkiLCBkZXBN\nYXApOwoKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSBST0xMQkFDSykgewog\nICAgICAgICAgICAgICAgcm9sbGJhY2tUeChwbSk7CiAgICAgICAgICAgICAg\nICBhY3Rpb24gPSBDT01NSVQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0\naW9uID09IENPTU1JVCkgewogICAgICAgICAgICAgICAgZW5kVHgocG0pOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBwbS5wcmVGbHVzaCgpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChh\nY3Rpb24gPT0gUFJFU1RPUkUpIHsKICAgICAgICAgICAgYXNzZXJ0RmFsc2Uo\ncG0uaXNSZW1vdmVkKGRlcENvbGwpKTsKICAgICAgICAgICAgYXNzZXJ0RmFs\nc2UocG0uaXNSZW1vdmVkKGRlcE1hcCkpOwogICAgICAgICAgICBlbmRUeChw\nbSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRUcnVlKHBtLmlzUGVyc2lz\ndGVudChkZXBDb2xsKSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChwbS5maW5k\nKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBfZGVwQ29sbCkpOwogICAgICAg\nIGFzc2VydFRydWUocG0uaXNQZXJzaXN0ZW50KGRlcE1hcCkpOwogICAgICAg\nIGFzc2VydE5vdE51bGwocG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFz\ncywgX2RlcE1hcCkpOwogICAgICAgIGFzc2VydE5vdE51bGwocG0uZmluZChE\nZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX3JlcGVhdCkpOwogICAgICAgIGVu\nZEVtKHBtKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVmZWREZXBl\nbmRlbnROb3REZWxldGVkKCkgewogICAgICAgIHJlZmVkRGVwZW5kZW50Tm90\nRGVsZXRlZChDT01NSVQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RS\nZWZlZERlcGVuZGVudE5vdERlbGV0ZWRXaXRoUm9sbGJhY2soKSB7CiAgICAg\nICAgcmVmZWREZXBlbmRlbnROb3REZWxldGVkKFJPTExCQUNLKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVmZWREZXBlbmRlbnROb3REZWxldGVk\nV2l0aFByZVN0b3JlKCkgewogICAgICAgIHJlZmVkRGVwZW5kZW50Tm90RGVs\nZXRlZChQUkVTVE9SRSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlZmVk\nRGVwZW5kZW50Tm90RGVsZXRlZChpbnQgYWN0aW9uKSB7CiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgcG0gPQogICAgICAgICAgICAoT3BlbkpQQUVu\ndGl0eU1hbmFnZXIpIGN1cnJlbnRFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAg\nRGVwZW5kZW50RmllbGRzUEMgcGM7CiAgICAgICAgRGVwZW5kZW50RmllbGRz\nUEMgbmV3UEMgPSBudWxsOwogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIGRl\ncFJlbDsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBzdGFy\ndFR4KHBtKTsKICAgICAgICAgICAgcGMgPSAoRGVwZW5kZW50RmllbGRzUEMp\nIHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xhc3MsIF9yb290KTsKICAg\nICAgICAgICAgaWYgKG5ld1BDID09IG51bGwpCiAgICAgICAgICAgICAgICBu\nZXdQQyA9IG5ldyBEZXBlbmRlbnRGaWVsZHNQQygpOwogICAgICAgICAgICBk\nZXBSZWwgPSBwYy5nZXREZXBlbmRlbnRSZWxhdGlvbigpOwogICAgICAgICAg\nICBuZXdQQy5zZXREZXBlbmRlbnRSZWxhdGlvbihkZXBSZWwpOwogICAgICAg\nICAgICBwYy5zZXREZXBlbmRlbnRSZWxhdGlvbihudWxsKTsKICAgICAgICAg\nICAgcG0ucGVyc2lzdChuZXdQQyk7CgogICAgICAgICAgICBpZiAoYWN0aW9u\nID09IFJPTExCQUNLKSB7CiAgICAgICAgICAgICAgICByb2xsYmFja1R4KHBt\nKTsKICAgICAgICAgICAgICAgIGFjdGlvbiA9IENPTU1JVDsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChhY3Rpb24gPT0gQ09NTUlUKSB7CiAgICAgICAgICAg\nICAgICBlbmRUeChwbSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBtLnByZUZsdXNoKCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgaWYgKGFjdGlvbiA9PSBQUkVTVE9SRSkgewogICAgICAg\nICAgICBhc3NlcnRGYWxzZShwbS5pc1JlbW92ZWQoZGVwUmVsKSk7CiAgICAg\nICAgICAgIGVuZFR4KHBtKTsKICAgICAgICB9CgogICAgICAgIGFzc2VydFRy\ndWUocG0uaXNQZXJzaXN0ZW50KGRlcFJlbCkpOwogICAgICAgIGFzc2VydE5v\ndE51bGwocG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX2RlcFJl\nbCkpOwogICAgICAgIGVuZEVtKHBtKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0TnVsbFNoYXJlZERlcGVuZGVudCgpIHsKICAgICAgICBudWxsU2hh\ncmVkRGVwZW5kZW50KENPTU1JVCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndGVzdE51bGxTaGFyZWREZXBlbmRlbnRXaXRoUm9sbGJhY2soKSB7CiAgICAg\nICAgbnVsbFNoYXJlZERlcGVuZGVudChST0xMQkFDSyk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgdGVzdE51bGxTaGFyZWREZXBlbmRlbnRXaXRoUHJlU3Rv\ncmUoKSB7CiAgICAgICAgbnVsbFNoYXJlZERlcGVuZGVudChQUkVTVE9SRSk7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIG51bGxTaGFyZWREZXBlbmRlbnQo\naW50IGFjdGlvbikgewogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIHBt\nID0KICAgICAgICAgICAgKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBjdXJyZW50\nRW50aXR5TWFuYWdlcigpOwogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIHBj\nOwogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIHJlcGVhdDsKICAgICAgICBM\naXN0IGxpc3Q7CiAgICAgICAgTWFwIG1hcDsKICAgICAgICB3aGlsZSAodHJ1\nZSkgewogICAgICAgICAgICBzdGFydFR4KHBtKTsKICAgICAgICAgICAgcGMg\nPSAoRGVwZW5kZW50RmllbGRzUEMpIHBtLmZpbmQoRGVwZW5kZW50RmllbGRz\nUEMuY2xhc3MsIF9yb290KTsKICAgICAgICAgICAgbGlzdCA9IHBjLmdldERl\ncGVuZGVudExpc3QoKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDIsIGxp\nc3Quc2l6ZSgpKTsKICAgICAgICAgICAgcmVwZWF0ID0gKERlcGVuZGVudEZp\nZWxkc1BDKSBsaXN0LmdldCgxKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxz\nKF9yZXBlYXQsIHBtLmdldE9iamVjdElkKHJlcGVhdCkpOwogICAgICAgICAg\nICBsaXN0LnJlbW92ZSgxKTsKCiAgICAgICAgICAgIG1hcCA9IHBjLmdldERl\ncGVuZGVudE1hcCgpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoMiwgbWFw\nLnNpemUoKSk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyhyZXBlYXQsIChE\nZXBlbmRlbnRGaWVsZHNQQykgbWFwLnJlbW92ZSgicmVwZWF0IikpOwoKICAg\nICAgICAgICAgaWYgKGFjdGlvbiA9PSBQUkVTVE9SRSkKICAgICAgICAgICAg\nICAgIHBtLnByZUZsdXNoKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIHBtLmZsdXNoKCk7CiAgICAgICAgICAgIGFzc2VydFRydWUocG0u\naXNSZW1vdmVkKHJlcGVhdCkpOwoKICAgICAgICAgICAgLy8gbm93IGFmdGVy\nIGRlbGV0aW5nIG9uIGZsdXNoLCBhc3NpZ25pbmcgdG8gYW5vdGhlciBmaWVs\nZCBhbmQKICAgICAgICAgICAgLy8gYXR0ZW1wdGluZyB0byBjb21taXQgc2hv\ndWxkIHRocm93IGFuIGVycm9yIC0tIGNhbid0IHVuZGVsZXRlIGFuCiAgICAg\nICAgICAgIC8vIG9iamVjdAogICAgICAgICAgICBwYy5nZXRMaXN0KCkuYWRk\nKHJlcGVhdCk7CgogICAgICAgICAgICBpZiAoYWN0aW9uID09IFJPTExCQUNL\nKSB7CiAgICAgICAgICAgICAgICByb2xsYmFja1R4KHBtKTsKICAgICAgICAg\nICAgICAgIGFjdGlvbiA9IENPTU1JVDsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcG0u\nZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICAgICAgICAgICAg\nICBmYWlsKCJDb21taXR0ZWQgd2l0aCByZWYgdG8gZGVsZXRlZCBkZXBlbmRl\nbnQgb2JqZWN0Iik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gamUpIHsKICAgICAgICAgICAgICAgICAgICByb2xsYmFja1R4KHBtKTsK\nICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgZW5kRW0ocG0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHRlc3RDbGVhck1hcHBlZERlcGVuZGVudE9mRGV0YWNoZWQoKSB7CiAgICAg\nICAgY2xlYXJEZXBlbmRlbnRPZkRldGFjaGVkVGVzdCh0cnVlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q2xlYXJJbnZlcnNlS2V5RGVwZW5kZW50\nT2ZEZXRhY2hlZCgpIHsKICAgICAgICBjbGVhckRlcGVuZGVudE9mRGV0YWNo\nZWRUZXN0KGZhbHNlKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY2xlYXJE\nZXBlbmRlbnRPZkRldGFjaGVkVGVzdChib29sZWFuIG1hcHBlZCkgewogICAg\nICAgIGRlbGV0ZUFsbChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcyk7CgogICAg\nICAgIERlcGVuZGVudEZpZWxkc1BDIG93bmVyID0gbmV3IERlcGVuZGVudEZp\nZWxkc1BDKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAyOyBpKysp\nIHsKICAgICAgICAgICAgRGVwZW5kZW50RmllbGRzUEMgY2hpbGQgPSBuZXcg\nRGVwZW5kZW50RmllbGRzUEMoKTsKICAgICAgICAgICAgaWYgKG1hcHBlZCkg\newogICAgICAgICAgICAgICAgb3duZXIuZ2V0RGVwZW5kZW50TWFwcGVkTGlz\ndCgpLmFkZChjaGlsZCk7CiAgICAgICAgICAgICAgICBjaGlsZC5zZXRPd25l\ncihvd25lcik7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nb3duZXIuZ2V0RGVwZW5kZW50SW52ZXJzZUtleUxpc3QoKS5hZGQoY2hpbGQp\nOwogICAgICAgIH0KCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgcG0g\nPQogICAgICAgICAgICAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGN1cnJlbnRF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgc3RhcnRUeChwbSk7CiAgICAgICAg\ncG0ucGVyc2lzdChvd25lcik7CiAgICAgICAgZW5kVHgocG0pOwogICAgICAg\nIE9iamVjdCBvaWQgPSBwbS5nZXRPYmplY3RJZChvd25lcik7CiAgICAgICAg\nYXNzZXJ0RXF1YWxzKDMsCiAgICAgICAgICAgICgoRXh0ZW50KSBwbS5jcmVh\ndGVFeHRlbnQoRGVwZW5kZW50RmllbGRzUEMuY2xhc3MsIHRydWUpKQogICAg\nICAgICAgICAgICAgLmxpc3QoKS5zaXplKCkpOwogICAgICAgIGVuZEVtKHBt\nKTsKCiAgICAgICAgcG0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGN1cnJl\nbnRFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgb3duZXIgPSAoRGVwZW5kZW50\nRmllbGRzUEMpIHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xhc3MsIG9p\nZCk7CiAgICAgICAgaWYgKG1hcHBlZCkKICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKDIsIG93bmVyLmdldERlcGVuZGVudE1hcHBlZExpc3QoKS5zaXplKCkp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDIsIG93\nbmVyLmdldERlcGVuZGVudEludmVyc2VLZXlMaXN0KCkuc2l6ZSgpKTsKICAg\nICAgICBEZXBlbmRlbnRGaWVsZHNQQyBkZXRhY2hlZCA9IChEZXBlbmRlbnRG\naWVsZHNQQykgcG0uZGV0YWNoKG93bmVyKTsKICAgICAgICBlbmRFbShwbSk7\nCgogICAgICAgIGlmIChtYXBwZWQpIHsKICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKDIsIGRldGFjaGVkLmdldERlcGVuZGVudE1hcHBlZExpc3QoKS5zaXpl\nKCkpOwogICAgICAgICAgICBkZXRhY2hlZC5nZXREZXBlbmRlbnRNYXBwZWRM\naXN0KCkuY2xlYXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBh\nc3NlcnRFcXVhbHMoMiwgZGV0YWNoZWQuZ2V0RGVwZW5kZW50SW52ZXJzZUtl\neUxpc3QoKS5zaXplKCkpOwogICAgICAgICAgICBkZXRhY2hlZC5nZXREZXBl\nbmRlbnRJbnZlcnNlS2V5TGlzdCgpLmNsZWFyKCk7CiAgICAgICAgfQoKICAg\nICAgICBwbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgY3VycmVudEVudGl0\neU1hbmFnZXIoKTsKICAgICAgICBzdGFydFR4KHBtKTsKICAgICAgICBvd25l\nciA9IChEZXBlbmRlbnRGaWVsZHNQQykgcG0ubWVyZ2UoZGV0YWNoZWQpOwog\nICAgICAgIGlmIChtYXBwZWQpCiAgICAgICAgICAgIGFzc2VydEVxdWFscygw\nLCBvd25lci5nZXREZXBlbmRlbnRNYXBwZWRMaXN0KCkuc2l6ZSgpKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGFzc2VydEVxdWFscygwLCBvd25lci5n\nZXREZXBlbmRlbnRJbnZlcnNlS2V5TGlzdCgpLnNpemUoKSk7CiAgICAgICAg\nZW5kVHgocG0pOwogICAgICAgIGFzc2VydEVxdWFscygxLAogICAgICAgICAg\nICAoKEV4dGVudCkgcG0uY3JlYXRlRXh0ZW50KERlcGVuZGVudEZpZWxkc1BD\nLmNsYXNzLCB0cnVlKSkuCiAgICAgICAgICAgICAgICBsaXN0KCkuc2l6ZSgp\nKTsKICAgICAgICBlbmRFbShwbSk7CgogICAgICAgIHBtID0gKE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyKSBjdXJyZW50RW50aXR5TWFuYWdlcigpOwogICAgICAg\nIG93bmVyID0gKERlcGVuZGVudEZpZWxkc1BDKSBwbS5maW5kKERlcGVuZGVu\ndEZpZWxkc1BDLmNsYXNzLCBvaWQpOwogICAgICAgIGlmIChtYXBwZWQpCiAg\nICAgICAgICAgIGFzc2VydEVxdWFscygwLCBvd25lci5nZXREZXBlbmRlbnRN\nYXBwZWRMaXN0KCkuc2l6ZSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIGFzc2VydEVxdWFscygwLCBvd25lci5nZXREZXBlbmRlbnRJbnZlcnNlS2V5\nTGlzdCgpLnNpemUoKSk7CiAgICAgICAgZW5kRW0ocG0pOwogICAgfQp9Cg==\n","encoding":"base64"}

