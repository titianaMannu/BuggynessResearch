{"sha":"bf527d0b217df2bd218e1f500bf86639a3c9852d","node_id":"MDQ6QmxvYjIwNjM2NDpiZjUyN2QwYjIxN2RmMmJkMjE4ZTFmNTAwYmY4NjYzOWEzYzk4NTJk","size":13837,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/bf527d0b217df2bd218e1f500bf86639a3c9852d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlNRTEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwoKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWlu\nYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmll\nbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5TdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuVmVyc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TUUxFeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRpbWlzdGljRXhjZXB0aW9u\nOwoKLyoqCiAqIEJhc2UgdXBkYXRlIG1hbmFnZXIgd2l0aCBjb21tb24gZnVu\nY3Rpb25hbGl0eS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1Ymxp\nYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFVwZGF0ZU1hbmFnZXIKICAgIGlt\ncGxlbWVudHMgVXBkYXRlTWFuYWdlciwgQ29uZmlndXJhYmxlIHsKCiAgICBw\ncm90ZWN0ZWQgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiA9IG51bGw7CiAgICBw\ncm90ZWN0ZWQgREJEaWN0aW9uYXJ5IGRpY3QgPSBudWxsOwoKICAgIHB1Ymxp\nYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbiBjb25mKSB7\nCiAgICAgICAgdGhpcy5jb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBjb25m\nOwogICAgICAgIGRpY3QgPSB0aGlzLmNvbmYuZ2V0REJEaWN0aW9uYXJ5SW5z\ndGFuY2UoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3Vy\nYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJh\ndGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBmbHVzaChD\nb2xsZWN0aW9uIHN0YXRlcywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gc3RvcmUuZ2V0Q29ubmVjdGlvbigpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50TWFuYWdl\nciBwc01nciA9IG5ld1ByZXBhcmVkU3RhdGVtZW50TWFuYWdlcihzdG9yZSwK\nICAgICAgICAgICAgICAgIGNvbm4pOwogICAgICAgICAgICByZXR1cm4gZmx1\nc2goc3RhdGVzLCBzdG9yZSwgcHNNZ3IpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7fQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIENvbGxlY3Rpb24gZmx1c2goQ29sbGVjdGlvbiBzdGF0ZXMsIEpEQkNTdG9y\nZSBzdG9yZSwKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudE1hbmFnZXIgcHNN\nZ3IpIHsKICAgICAgICAvLyBydW4gdGhyb3VnaCBhbGwgdGhlIHN0YXRlcyBh\nbmQgdXBkYXRlIHRoZW0gYXMgbmVjZXNzYXJ5CiAgICAgICAgUm93TWFuYWdl\nciByb3dNZ3IgPSBuZXdSb3dNYW5hZ2VyKCk7CiAgICAgICAgQ29sbGVjdGlv\nbiBjdXN0b21zID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBDb2xsZWN0\naW9uIGV4Y2VwcyA9IG51bGw7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBzdGF0ZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAg\nICAgIGV4Y2VwcyA9IHBvcHVsYXRlUm93TWFuYWdlcigoT3BlbkpQQVN0YXRl\nTWFuYWdlcikgaXRyLm5leHQoKSwKICAgICAgICAgICAgICAgIHJvd01nciwg\nc3RvcmUsIGV4Y2VwcywgY3VzdG9tcyk7CgogICAgICAgIC8vIGZsdXNoIHJv\nd3MKICAgICAgICBleGNlcHMgPSBmbHVzaChyb3dNZ3IsIHBzTWdyLCBleGNl\ncHMpOwoKICAgICAgICAvLyBub3cgZG8gYW55IGN1c3RvbSBtYXBwaW5ncwog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY3VzdG9tcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgKChDdXN0b21NYXBwaW5nKSBpdHIubmV4dCgpKS5leGVjdXRl\nKHN0b3JlKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGRFeGNlcHRpb24oZXhj\nZXBzLCBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBkaWN0KSk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgICAgIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIGtlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmV0dXJuIGFs\nbCBleGNlcHRpb25zCiAgICAgICAgQ29sbGVjdGlvbiBwc0V4Y2VwcyA9IHBz\nTWdyLmdldEV4Y2VwdGlvbnMoKTsKICAgICAgICBpZiAoZXhjZXBzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBwc0V4Y2VwczsKICAgICAgICBpZiAo\ncHNFeGNlcHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGV4Y2VwczsK\nICAgICAgICBleGNlcHMuYWRkQWxsKHBzRXhjZXBzKTsKICAgICAgICByZXR1\ncm4gZXhjZXBzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3\nIHtAbGluayBSb3dNYW5hZ2VyfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFi\nc3RyYWN0IFJvd01hbmFnZXIgbmV3Um93TWFuYWdlcigpOwoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgbmV3IHtAbGluayBQcmVwYXJlZFN0YXRlbWVudE1h\nbmFnZXJ9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgUHJlcGFy\nZWRTdGF0ZW1lbnRNYW5hZ2VyIG5ld1ByZXBhcmVkU3RhdGVtZW50TWFuYWdl\ncigKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIENvbm5lY3Rpb24gY29ubik7\nCgogICAgLyoqCiAgICAgKiBGbHVzaCBhbGwgcm93cyBvZiB0aGUgZ2l2ZW4g\ncm93IG1hbmFnZXIuIEFkZCBleGNlcHRpb25zIHRvCiAgICAgKiA8Y29kZT5l\neGNlcHM8L2NvZGU+ICh3aGljaCBtYXkgc3RhcnQgYXMgbnVsbCkgdXNpbmcK\nICAgICAqIHtAbGluayAjYWRkRXhjZXB0aW9ufS4gUmV0dXJuIDxjb2RlPmV4\nY2VwczwvY29kZT4uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBD\nb2xsZWN0aW9uIGZsdXNoKFJvd01hbmFnZXIgcm93TWdyLAogICAgICAgIFBy\nZXBhcmVkU3RhdGVtZW50TWFuYWdlciBwc01nciwgQ29sbGVjdGlvbiBleGNl\ncHMpOwoKICAgIC8qKgogICAgICogUG9wdWxhdGUgdGhlIHJvdyBtYW5hZ2Vy\nIHdpdGggcm93cyB0byBiZSBmbHVzaGVkIGZvciB0aGUgZ2l2ZW4gc3RhdGUu\nCiAgICAgKgogICAgICogQHBhcmFtIGV4Y2VwcyBleGNlcHRpb25zIGVuY291\nbnRlcmVkIHdoZW4gZmx1c2hpbmcgd2lsbCBiZSBhZGRlZCB0bwogICAgICog\ndGhpcyBsaXN0IGFuZCByZXR1cm5lZDsgdGhlIGxpc3QgbWF5IGJlIG51bGwg\naW5pdGlhbGx5CiAgICAgKiBAcGFyYW0gY3VzdG9tcyBidWZmZXIgY3VzdG9t\nIG1hcHBpbmdzCiAgICAgKiBAcmV0dXJuIHRoZSBleGNlcHRpb25zIGxpc3QK\nICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gcG9wdWxhdGVSb3dN\nYW5hZ2VyKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgUm93TWFu\nYWdlciByb3dNZ3IsIEpEQkNTdG9yZSBzdG9yZSwgQ29sbGVjdGlvbiBleGNl\ncHMsCiAgICAgICAgQ29sbGVjdGlvbiBjdXN0b21zKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgQml0U2V0IGRpcnR5OwogICAgICAgICAgICBpZiAo\nc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUE5FVyAmJiAhc20uaXNGbHVz\naGVkKCkpIHsKICAgICAgICAgICAgICAgIGluc2VydChzbSwgKENsYXNzTWFw\ncGluZykgc20uZ2V0TWV0YURhdGEoKSwgcm93TWdyLCBzdG9yZSwKICAgICAg\nICAgICAgICAgICAgICBjdXN0b21zKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVXRkxVU0hFRERFTEVU\nRUQKICAgICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0\nYXRlLlBERUxFVEVEKSB7CiAgICAgICAgICAgICAgICBkZWxldGUoc20sIChD\nbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCksIHJvd01nciwgc3RvcmUs\nCiAgICAgICAgICAgICAgICAgICAgY3VzdG9tcyk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoKGRpcnR5ID0gSW1wbEhlbHBlci5nZXRVcGRhdGVGaWVsZHMo\nc20pKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB1cGRhdGUoc20sIGRp\ncnR5LCAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpLCByb3dNZ3Is\nCiAgICAgICAgICAgICAgICAgICAgc3RvcmUsIGN1c3RvbXMpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHNtLmlzVmVyc2lvblVwZGF0ZVJlcXVpcmVkKCkp\nIHsKICAgICAgICAgICAgICAgIHVwZGF0ZUluZGljYXRvcnMoc20sIChDbGFz\nc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCksIHJvd01nciwKICAgICAgICAg\nICAgICAgICAgICBzdG9yZSwgY3VzdG9tcywgdHJ1ZSk7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoc20uaXNWZXJzaW9uQ2hlY2tSZXF1aXJlZCgpKSB7CiAg\nICAgICAgICAgICAgICBpZiAoISgoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRh\nRGF0YSgpKS5nZXRWZXJzaW9uKCkuCiAgICAgICAgICAgICAgICAgICAgY2hl\nY2tWZXJzaW9uKHNtLCBzdG9yZSwgZmFsc2UpKQogICAgICAgICAgICAgICAg\nICAgIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIG5ldyBPcHRpbWlz\ndGljRXhjZXB0aW9uKHNtLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRN\nYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZEV4Y2VwdGlvbihleGNlcHMsIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUo\nc2UsIGRpY3QpKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNl\ncHMsIGtlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4Y2VwczsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gZXhjZXB0aW9uIHRv\nIHRoZSBnaXZlbiBsaXN0LCB3aGljaCBtYXkgc3RhcnQgb3V0IGFzIG51bGwu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGFkZEV4Y2VwdGlv\nbihDb2xsZWN0aW9uIGV4Y2VwcywgRXhjZXB0aW9uIGVycikgewogICAgICAg\nIGlmIChleGNlcHMgPT0gbnVsbCkKICAgICAgICAgICAgZXhjZXBzID0gbmV3\nIExpbmtlZExpc3QoKTsKICAgICAgICBleGNlcHMuYWRkKGVycik7CiAgICAg\nICAgcmV0dXJuIGV4Y2VwczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vy\nc2l2ZSBtZXRob2QgdG8gaW5zZXJ0IHRoZSBnaXZlbiBpbnN0YW5jZSwgYmFz\nZSBjbGFzcyBmaXJzdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgaW5z\nZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIENsYXNzTWFwcGluZyBtYXBw\naW5nLAogICAgICAgIFJvd01hbmFnZXIgcm93TWdyLCBKREJDU3RvcmUgc3Rv\ncmUsIENvbGxlY3Rpb24gY3VzdG9tcykKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9IG1hcHBpbmcuaXND\ndXN0b21JbnNlcnQoc20sIHN0b3JlKTsKICAgICAgICBpZiAoIUJvb2xlYW4u\nRkFMU0UuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAgICAgIG1hcHBpbmcuY3Vz\ndG9tSW5zZXJ0KHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKEJvb2xlYW4uVFJV\nRS5lcXVhbHMoY3VzdG9tKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3Vw\nZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAg\nICAgICAgICAgIGluc2VydChzbSwgc3VwLCByb3dNZ3IsIHN0b3JlLCBjdXN0\nb21zKTsKCiAgICAgICAgbWFwcGluZy5pbnNlcnQoc20sIHN0b3JlLCByb3dN\nZ3IpOwogICAgICAgIEZpZWxkTWFwcGluZ1tdIGZpZWxkcyA9IG1hcHBpbmcu\nZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBCaXRTZXQgZGly\ndHkgPSBzbS5nZXREaXJ0eSgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkaXJ0\neS5nZXQoZmllbGRzW2ldLmdldEluZGV4KCkpCiAgICAgICAgICAgICAgICAm\nJiAhYnVmZmVyQ3VzdG9tSW5zZXJ0KGZpZWxkc1tpXSwgc20sIHN0b3JlLCBj\ndXN0b21zKSkKICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5pbnNlcnQoc20s\nIHN0b3JlLCByb3dNZ3IpOwogICAgICAgIH0KICAgICAgICBpZiAoc3VwID09\nIG51bGwpIHsKICAgICAgICAgICAgVmVyc2lvbiB2ZXJzID0gbWFwcGluZy5n\nZXRWZXJzaW9uKCk7CiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tSW5z\nZXJ0KHZlcnMsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAgICAgICAg\nICB2ZXJzLmluc2VydChzbSwgc3RvcmUsIHJvd01ncik7CiAgICAgICAgICAg\nIERpc2NyaW1pbmF0b3IgZHNjID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9y\nKCk7CiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tSW5zZXJ0KGRzYywg\nc20sIHN0b3JlLCBjdXN0b21zKSkKICAgICAgICAgICAgICAgIGRzYy5pbnNl\ncnQoc20sIHN0b3JlLCByb3dNZ3IpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIElmIHRoZSBnaXZlbiBtYXBwaW5nIHVzZXMgYSBjdXN0b20g\naW5zZXJ0LCBwbGFjZXMgYQogICAgICoge0BsaW5rIEN1c3RvbU1hcHBpbmd9\nIHN0cnVjdCBmb3IgaXQgaW4gdGhlIGdpdmVuIGNvbGxlY3Rpb24gYW5kCiAg\nICAgKiByZXR1cm5zIHRydWUsIGVsc2UgcmV0dXJucyBmYWxzZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGJ1ZmZlckN1c3RvbUluc2VydChTdHJh\ndGVneSBzdHJhdCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBK\nREJDU3RvcmUgc3RvcmUsIENvbGxlY3Rpb24gY3VzdG9tcykgewogICAgICAg\nIEJvb2xlYW4gY3VzdG9tID0gc3RyYXQuaXNDdXN0b21JbnNlcnQoc20sIHN0\nb3JlKTsKICAgICAgICBpZiAoIUJvb2xlYW4uRkFMU0UuZXF1YWxzKGN1c3Rv\nbSkpCiAgICAgICAgICAgIGN1c3RvbXMuYWRkKG5ldyBDdXN0b21NYXBwaW5n\nKEN1c3RvbU1hcHBpbmcuSU5TRVJULCBzbSwgc3RyYXQpKTsKICAgICAgICBy\nZXR1cm4gQm9vbGVhbi5UUlVFLmVxdWFscyhjdXN0b20pOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVjdXJzaXZlIG1ldGhvZCB0byBkZWxldGUgdGhlIGdp\ndmVuIGluc3RhbmNlLCBiYXNlIGNsYXNzIGxhc3QuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGRlbGV0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBD\nbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBSb3dNYW5hZ2VyIHJvd01n\nciwgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0aW9uIGN1c3RvbXMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQm9vbGVhbiBjdXN0\nb20gPSBtYXBwaW5nLmlzQ3VzdG9tRGVsZXRlKHNtLCBzdG9yZSk7CiAgICAg\nICAgaWYgKCFCb29sZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAg\nICAgICBtYXBwaW5nLmN1c3RvbURlbGV0ZShzbSwgc3RvcmUpOwogICAgICAg\nIGlmIChCb29sZWFuLlRSVUUuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgRmllbGRNYXBwaW5nW10gZmllbGRzID0gbWFw\ncGluZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICBpZiAoIWJ1ZmZlckN1c3RvbURlbGV0ZShmaWVsZHNbaV0sIHNtLCBzdG9y\nZSwgY3VzdG9tcykpCiAgICAgICAgICAgICAgICBmaWVsZHNbaV0uZGVsZXRl\nKHNtLCBzdG9yZSwgcm93TWdyKTsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1\ncCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7\nCiAgICAgICAgaWYgKHN1cCA9PSBudWxsKSB7CiAgICAgICAgICAgIFZlcnNp\nb24gdmVycyA9IG1hcHBpbmcuZ2V0VmVyc2lvbigpOwogICAgICAgICAgICBp\nZiAoIWJ1ZmZlckN1c3RvbURlbGV0ZSh2ZXJzLCBzbSwgc3RvcmUsIGN1c3Rv\nbXMpKQogICAgICAgICAgICAgICAgdmVycy5kZWxldGUoc20sIHN0b3JlLCBy\nb3dNZ3IpOwogICAgICAgICAgICBEaXNjcmltaW5hdG9yIGRzYyA9IG1hcHBp\nbmcuZ2V0RGlzY3JpbWluYXRvcigpOwogICAgICAgICAgICBpZiAoIWJ1ZmZl\nckN1c3RvbURlbGV0ZShkc2MsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAg\nICAgICAgICAgICBkc2MuZGVsZXRlKHNtLCBzdG9yZSwgcm93TWdyKTsKICAg\nICAgICB9CiAgICAgICAgbWFwcGluZy5kZWxldGUoc20sIHN0b3JlLCByb3dN\nZ3IpOwoKICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgIGRl\nbGV0ZShzbSwgc3VwLCByb3dNZ3IsIHN0b3JlLCBjdXN0b21zKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEBzZWUgI2J1ZmZlckN1c3RvbUluc2VydAogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gYnVmZmVyQ3VzdG9tRGVsZXRlKFN0\ncmF0ZWd5IHN0cmF0LCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgQ29sbGVjdGlvbiBjdXN0b21zKSB7CiAgICAg\nICAgQm9vbGVhbiBjdXN0b20gPSBzdHJhdC5pc0N1c3RvbURlbGV0ZShzbSwg\nc3RvcmUpOwogICAgICAgIGlmICghQm9vbGVhbi5GQUxTRS5lcXVhbHMoY3Vz\ndG9tKSkKICAgICAgICAgICAgY3VzdG9tcy5hZGQobmV3IEN1c3RvbU1hcHBp\nbmcoQ3VzdG9tTWFwcGluZy5ERUxFVEUsIHNtLCBzdHJhdCkpOwogICAgICAg\nIHJldHVybiBCb29sZWFuLlRSVUUuZXF1YWxzKGN1c3RvbSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgbWV0aG9kIHRvIHVwZGF0ZSB0aGUg\nZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHVw\nZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZGlydHksCiAg\nICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFJvd01hbmFnZXIgcm93TWdy\nLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgQ29sbGVjdGlvbiBjdXN0b21z\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBCb29sZWFuIGN1c3Rv\nbSA9IG1hcHBpbmcuaXNDdXN0b21VcGRhdGUoc20sIHN0b3JlKTsKICAgICAg\nICBpZiAoIUJvb2xlYW4uRkFMU0UuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAg\nICAgIG1hcHBpbmcuY3VzdG9tVXBkYXRlKHNtLCBzdG9yZSk7CiAgICAgICAg\naWYgKEJvb2xlYW4uVFJVRS5lcXVhbHMoY3VzdG9tKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICAvLyB1cGRhdGUgYWxsIGZpZWxkcyBiZWZvcmUg\nYWxsIG1hcHBpbmdzIHNvIHRoYXQgdGhlIG1hcHBpbmdzIGNhbgogICAgICAg\nIC8vIGRldGVjdCB3aGV0aGVyIGFueSBmaWVsZHMgaW4gdGhlaXIgcm93cyBo\nYXZlIGJlZW4gbW9kaWZpZWQKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVs\nZHMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGRpcnR5LmdldChmaWVsZHNbaV0uZ2V0SW5kZXgo\nKSkKICAgICAgICAgICAgICAgICYmICFidWZmZXJDdXN0b21VcGRhdGUoZmll\nbGRzW2ldLCBzbSwgc3RvcmUsIGN1c3RvbXMpKQogICAgICAgICAgICAgICAg\nZmllbGRzW2ldLnVwZGF0ZShzbSwgc3RvcmUsIHJvd01ncik7CiAgICAgICAg\nfQoKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRKb2lu\nYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwID09\nIG51bGwpCiAgICAgICAgICAgIHVwZGF0ZUluZGljYXRvcnMoc20sIG1hcHBp\nbmcsIHJvd01nciwgc3RvcmUsIGN1c3RvbXMsIGZhbHNlKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHVwZGF0ZShzbSwgZGlydHksIHN1cCwgcm93TWdy\nLCBzdG9yZSwgY3VzdG9tcyk7CiAgICAgICAgbWFwcGluZy51cGRhdGUoc20s\nIHN0b3JlLCByb3dNZ3IpOwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRl\nIHZlcnNpb24gYW5kIGRpc2NyaW1pbmF0b3IgaW5kaWNhdG9ycy4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgdXBkYXRlSW5kaWNhdG9ycyhPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAg\nICBSb3dNYW5hZ2VyIHJvd01nciwgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0\naW9uIGN1c3RvbXMsCiAgICAgICAgYm9vbGVhbiB2ZXJzaW9uVXBkYXRlT25s\neSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hpbGUgKG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CgogICAgICAgIFZlcnNpb24gdmVycyA9IG1h\ncHBpbmcuZ2V0VmVyc2lvbigpOwogICAgICAgIGlmICghYnVmZmVyQ3VzdG9t\nVXBkYXRlKHZlcnMsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAgICAg\nIHZlcnMudXBkYXRlKHNtLCBzdG9yZSwgcm93TWdyKTsKCiAgICAgICAgaWYg\nKHZlcnNpb25VcGRhdGVPbmx5KSB7CiAgICAgICAgICAgIC8vIGlmIHdlIGFy\nZSBvbmx5IHVwZGF0aW5nIHRoZSB2ZXJzaW9uIGNvbHVtbiwgd2UgbmVlZCB0\nbyBhZGQKICAgICAgICAgICAgLy8gaW4gdGhlIHByaW1hcnkga2V5IHNlbGVj\ndAogICAgICAgICAgICBtYXBwaW5nLnVwZGF0ZShzbSwgc3RvcmUsIHJvd01n\ncik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gb3RoZXJ3aXNl\nIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHdlIHVwZGF0ZSB0aGUgZGlzY3JpbWlu\nYXRvciB0b28KICAgICAgICAgICAgRGlzY3JpbWluYXRvciBkc2MgPSBtYXBw\naW5nLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICAgICAgaWYgKCFidWZm\nZXJDdXN0b21VcGRhdGUoZHNjLCBzbSwgc3RvcmUsIGN1c3RvbXMpKQogICAg\nICAgICAgICAgICAgZHNjLnVwZGF0ZShzbSwgc3RvcmUsIHJvd01ncik7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjYnVmZmVyQ3Vz\ndG9tSW5zZXJ0CiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBidWZmZXJD\ndXN0b21VcGRhdGUoU3RyYXRlZ3kgc3RyYXQsIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0aW9uIGN1\nc3RvbXMpIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9IHN0cmF0LmlzQ3Vz\ndG9tVXBkYXRlKHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKCFCb29sZWFuLkZB\nTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAgICAgICBjdXN0b21zLmFkZChu\nZXcgQ3VzdG9tTWFwcGluZyhDdXN0b21NYXBwaW5nLlVQREFURSwgc20sIHN0\ncmF0KSk7CiAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRS5lcXVhbHMoY3Vz\ndG9tKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIGN1c3RvbWl6\nZWQgbWFwcGluZyB1cGRhdGVzLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGNsYXNzIEN1c3RvbU1hcHBpbmcgewoKICAgICAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBJTlNFUlQgPSAwOwogICAgICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IFVQREFURSA9IDE7CiAgICAgICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgREVMRVRFID0gMzsKCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBpbnQgX2FjdGlvbjsKICAgICAgICBwcml2YXRlIGZpbmFsIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgX3NtOwogICAgICAgIHByaXZhdGUgZmluYWwgU3RyYXRl\nZ3kgX3N0cmF0OwoKICAgICAgICBwdWJsaWMgQ3VzdG9tTWFwcGluZyhpbnQg\nYWN0aW9uLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBTdHJhdGVneSBzdHJh\ndCkgewogICAgICAgICAgICBfYWN0aW9uID0gYWN0aW9uOwogICAgICAgICAg\nICBfc20gPSBzbTsKICAgICAgICAgICAgX3N0cmF0ID0gc3RyYXQ7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBleGVjdXRlKEpEQkNTdG9yZSBz\ndG9yZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHN3aXRj\naCAoX2FjdGlvbikgewogICAgICAgICAgICBjYXNlIElOU0VSVDoKICAgICAg\nICAgICAgICAgIF9zdHJhdC5jdXN0b21JbnNlcnQoX3NtLCBzdG9yZSk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBVUERBVEU6\nCiAgICAgICAgICAgICAgICBfc3RyYXQuY3VzdG9tVXBkYXRlKF9zbSwgc3Rv\ncmUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nREVMRVRFOgogICAgICAgICAgICAgICAgX3N0cmF0LmN1c3RvbURlbGV0ZShf\nc20sIHN0b3JlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

