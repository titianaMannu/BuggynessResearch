{"sha":"003f70d4ac14f5d2b72b6c0e851ee6a7e90fd572","node_id":"MDQ6QmxvYjIwNjM2NDowMDNmNzBkNGFjMTRmNWQyYjcyYjZjMGU4NTFlZTZhN2U5MGZkNTcy","size":53271,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/003f70d4ac14f5d2b72b6c0e851ee6a7e90fd572","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3Rh\ndGVtZW50OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLlNldDsKaW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5PcnBoYW5lZEtleUFj\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRC\nQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5TeW50YXhlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMRXhjZXB0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxGYWN0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVj\ndXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Vbmlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5M\nb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nQ29ubmVjdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nUHJl\ncGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmpkYmMuRGVsZWdhdGluZ1N0YXRlbWVudDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0\nUHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xh\nc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZp\nZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5K\nYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1\nZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5B\ncHBsaWNhdGlvbklkczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3Jl\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNl\nckV4Y2VwdGlvbjsKCi8qKgogKiBTdG9yZU1hbmFnZXIgcGx1Z2luIHRoYXQg\ndXNlcyBKREJDIHRvIHN0b3JlIHBlcnNpc3RlbnQgZGF0YSBpbiBhCiAqIHJl\nbGF0aW9uYWwgZGF0YSBzdG9yZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUK\nICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpEQkNTdG9yZU1hbmFn\nZXIgCiAgICBpbXBsZW1lbnRzIFN0b3JlTWFuYWdlciwgSkRCQ1N0b3JlIHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEpEQkNTdG9yZU1hbmFnZXIu\nY2xhc3MpOwoKICAgIHByaXZhdGUgU3RvcmVDb250ZXh0IF9jdHggPSBudWxs\nOwogICAgcHJpdmF0ZSBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7\nCiAgICBwcml2YXRlIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CiAgICBw\ncml2YXRlIFNRTEZhY3RvcnkgX3NxbCA9IG51bGw7CiAgICBwcml2YXRlIEpE\nQkNMb2NrTWFuYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhU291\ncmNlIF9kcyA9IG51bGw7CiAgICBwcml2YXRlIFJlZkNvdW50Q29ubmVjdGlv\nbiBfY29ubiA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2FjdGl2ZSA9\nIGZhbHNlOwoKICAgIC8vIHRyYWNrIHRoZSBwZW5kaW5nIHN0YXRlbWVudHMg\nc28gd2UgY2FuIGNhbmNlbCB0aGVtCiAgICBwcml2YXRlIFNldCBfc3RtbnRz\nID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkU2V0KG5ldyBIYXNoU2V0KCkp\nOwoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQgZ2V0Q29udGV4dCgpIHsKICAg\nICAgICByZXR1cm4gX2N0eDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRD\nb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBzZXRDb250ZXh0\nKGN0eCwgKEpEQkNDb25maWd1cmF0aW9uKSBjdHguZ2V0Q29uZmlndXJhdGlv\nbigpKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChT\ndG9yZUNvbnRleHQgY3R4LCBKREJDQ29uZmlndXJhdGlvbiBjb25mKSB7CiAg\nICAgICAgX2N0eCA9IGN0eDsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAg\nICAgX2RpY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwog\nICAgICAgIF9zcWwgPSBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKTsK\nCiAgICAgICAgTG9ja01hbmFnZXIgbG0gPSBjdHguZ2V0TG9ja01hbmFnZXIo\nKTsKICAgICAgICBpZiAobG0gaW5zdGFuY2VvZiBKREJDTG9ja01hbmFnZXIp\nCiAgICAgICAgICAgIF9sbSA9IChKREJDTG9ja01hbmFnZXIpIGxtOwoKICAg\nICAgICBpZiAoIWN0eC5pc01hbmFnZWQoKSAmJiBfY29uZi5pc0Nvbm5lY3Rp\nb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkKICAgICAgICAgICAgX2RzID0gX2Nv\nbmYuZ2V0RGF0YVNvdXJjZTIoY3R4KTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIF9kcyA9IF9jb25mLmdldERhdGFTb3VyY2UoY3R4KTsKCiAgICAgICAg\naWYgKF9jb25mLmdldFVwZGF0ZU1hbmFnZXJJbnN0YW5jZSgpLm9yZGVyRGly\ndHkoKSkKICAgICAgICAgICAgY3R4LnNldE9yZGVyRGlydHlPYmplY3RzKHRy\ndWUpOwogICAgfQoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBnZXRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0K\nCiAgICBwdWJsaWMgREJEaWN0aW9uYXJ5IGdldERCRGljdGlvbmFyeSgpIHsK\nICAgICAgICByZXR1cm4gX2RpY3Q7CiAgICB9CgogICAgcHVibGljIFNRTEZh\nY3RvcnkgZ2V0U1FMRmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX3NxbDsK\nICAgIH0KCiAgICBwdWJsaWMgSkRCQ0xvY2tNYW5hZ2VyIGdldExvY2tNYW5h\nZ2VyKCkgewogICAgICAgIHJldHVybiBfbG07CiAgICB9CgogICAgcHVibGlj\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9u\nKCkgewogICAgICAgIHJldHVybiAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikg\nX2N0eC5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBiZWdpbk9wdGltaXN0aWMoKSB7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcm9sbGJhY2tPcHRpbWlzdGljKCkgewogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGJlZ2luKCkgewogICAgICAgIF9hY3RpdmUgPSB0cnVlOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoIV9jdHguaXNNYW5hZ2VkKCkg\nfHwgIV9jb25mLmlzQ29ubmVjdGlvbkZhY3RvcnlNb2RlTWFuYWdlZCgpKQog\nICAgICAgICAgICAgICAgJiYgX2Nvbm4uZ2V0QXV0b0NvbW1pdCgpKQogICAg\nICAgICAgICAgICAgX2Nvbm4uc2V0QXV0b0NvbW1pdChmYWxzZSk7CiAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIF9h\nY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9u\ncy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBjb21taXQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKCFfY3R4LmlzTWFuYWdlZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rp\nb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkKICAgICAgICAgICAgICAgIF9jb25u\nLmNvbW1pdCgpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX2Nvbm4ucm9s\nbGJhY2soKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nMikgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2Vw\ndGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKCkgewogICAgICAgIC8vIGFs\ncmVhZHkgcm9sbGVkIGJhY2sgb3Vyc2VsdmVzPwogICAgICAgIGlmICghX2Fj\ndGl2ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoX2Nvbm4gIT0gbnVsbAogICAgICAgICAgICAgICAgJiYg\nKCFfY3R4LmlzTWFuYWdlZCgpIHx8ICFfY29uZgogICAgICAgICAgICAgICAg\nICAgIC5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkpCiAgICAg\nICAgICAgICAgICBfY29ubi5yb2xsYmFjaygpOwogICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNl\ncHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgX2FjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCByZXRhaW5Db25uZWN0aW9uKCkgewogICAg\nICAgIGNvbm5lY3QoZmFsc2UpOwogICAgICAgIF9jb25uLnNldFJldGFpbih0\ncnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlQ29ubmVjdGlv\nbigpIHsKICAgICAgICBpZiAoX2Nvbm4gIT0gbnVsbCkKICAgICAgICAgICAg\nX2Nvbm4uc2V0UmV0YWluKGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldENsaWVudENvbm5lY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBDbGllbnRDb25uZWN0aW9uKGdldENvbm5lY3Rpb24oKSk7CiAgICB9Cgog\nICAgcHVibGljIENvbm5lY3Rpb24gZ2V0Q29ubmVjdGlvbigpIHsKICAgICAg\nICBjb25uZWN0KHRydWUpOwogICAgICAgIHJldHVybiBfY29ubjsKICAgIH0K\nICAgIAogICAgcHJvdGVjdGVkIERhdGFTb3VyY2UgZ2V0RGF0YVNvdXJjZSgp\nIHsKICAgIAlyZXR1cm4gX2RzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGV4aXN0cyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgY29udGV4\ndCkgewogICAgICAgIC8vIGFkZCB3aGVyZSBjb25kaXRpb25zIG9uIGJhc2Ug\nY2xhc3MgdG8gYXZvaWQgam9pbnMgaWYgc3ViY2xhc3MKICAgICAgICAvLyBk\nb2Vzbid0IHVzZSBvaWQgYXMgaWRlbnRpZmllcgogICAgICAgIENsYXNzTWFw\ncGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEo\nKTsKICAgICAgICByZXR1cm4gZXhpc3RzKG1hcHBpbmcsIHNtLmdldE9iamVj\ndElkKCksIGNvbnRleHQpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBl\neGlzdHMoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9iamVjdCBvaWQsIE9iamVj\ndCBjb250ZXh0KSB7CiAgICAgICAgLy8gYWRkIHdoZXJlIGNvbmRpdGlvbnMg\nb24gYmFzZSBjbGFzcyB0byBhdm9pZCBqb2lucyBpZiBzdWJjbGFzcwogICAg\nICAgIC8vIGRvZXNuJ3QgdXNlIG9pZCBhcyBpZGVudGlmaWVyCiAgICAgICAg\nU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgd2hpbGUg\nKG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmcuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CgogICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkob2lkLCBtYXBwaW5nLCB0aGlzKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICByZXR1cm4gc2VsLmdldENvdW50KHRoaXMpICE9IDA7CiAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3luY1ZlcnNpb24o\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgT2JqZWN0IGNvbnRleHQpIHsKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNt\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmNoZWNrVmVyc2lvbihzbSwgdGhp\ncywgdHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2Us\nIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBjb21w\nYXJlVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHN0YXRlLCBPYmplY3Qg\ndjEsIE9iamVjdCB2MikgewogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5n\nID0gKENsYXNzTWFwcGluZykgc3RhdGUuZ2V0TWV0YURhdGEoKTsKICAgICAg\nICByZXR1cm4gbWFwcGluZy5nZXRWZXJzaW9uKCkuY29tcGFyZVZlcnNpb24o\ndjEsIHYyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpbml0aWFsaXpl\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3RhdGUgc3RhdGUsCiAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4dCkg\newogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSAoQ29ubmVjdGlvbklu\nZm8pIGNvbnRleHQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJu\nIGluaXRpYWxpemVTdGF0ZShzbSwgc3RhdGUsIChKREJDRmV0Y2hDb25maWd1\ncmF0aW9uKSBmZXRjaCwgCiAgICAgICAgICAgICAgICBpbmZvKTsKICAgICAg\nICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oY25mZSk7CiAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRo\ncm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGEgbmV3bHkt\nbG9hZGVkIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBpbml0aWFsaXplU3RhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgUENT\ndGF0ZSBzdGF0ZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBDb25uZWN0aW9uSW5mbyBpbmZvKQogICAgICAgIHRocm93cyBDbGFz\nc05vdEZvdW5kRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewogICAgICAgIE9i\namVjdCBvaWQgPSBzbS5nZXRPYmplY3RJZCgpOwogICAgICAgIENsYXNzTWFw\ncGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEo\nKTsKICAgICAgICBSZXN1bHQgcmVzID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoaW5mbyAhPSBudWxsICYmIGluZm8ucmVzdWx0ICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHJlcyA9IGluZm8ucmVzdWx0Owog\nICAgICAgICAgICAgICAgaW5mby5zbSA9IHNtOwogICAgICAgICAgICAgICAg\naWYgKGluZm8ubWFwcGluZyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGluZm8ubWFwcGluZyA9IG1hcHBpbmc7CiAgICAgICAgICAgICAgICBtYXBw\naW5nID0gaW5mby5tYXBwaW5nOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9p\nZCBpbnN0YW5jZW9mIE9wZW5KUEFJZAogICAgICAgICAgICAgICAgJiYgISgo\nT3BlbkpQQUlkKSBvaWQpLmhhc1N1YmNsYXNzZXMoKSkgewogICAgICAgICAg\nICAgICAgQm9vbGVhbiBjdXN0b20gPSBjdXN0b21Mb2FkKHNtLCBtYXBwaW5n\nLCBzdGF0ZSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYgKGN1c3RvbSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0b20uYm9v\nbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICByZXMgPSBnZXRJbml0aWFs\naXplU3RhdGVSZXN1bHQoc20sIG1hcHBpbmcsIGZldGNoLAogICAgICAgICAg\nICAgICAgICAgIFNlbGVjdC5TVUJTX0VYQUNUKTsKICAgICAgICAgICAgICAg\nIGlmIChyZXMgPT0gbnVsbCAmJiAhc2VsZWN0UHJpbWFyeUtleShzbSwgbWFw\ncGluZywgZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgICAgIGlmIChpc0VtcHR5UmVzdWx0KHJlcykpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nW10gbWFwcGlu\nZ3MgPSBtYXBwaW5nLgogICAgICAgICAgICAgICAgICAgIGdldEluZGVwZW5k\nZW50QXNzaWduYWJsZU1hcHBpbmdzKCk7CiAgICAgICAgICAgICAgICBpZiAo\nbWFwcGluZ3MubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgICAgICBt\nYXBwaW5nID0gbWFwcGluZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgQm9v\nbGVhbiBjdXN0b20gPSBjdXN0b21Mb2FkKHNtLCBtYXBwaW5nLCBzdGF0ZSwg\nZmV0Y2gpOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXN0b20gIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1c3RvbS5ib29s\nZWFuVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICByZXMgPSBnZXRJbml0\naWFsaXplU3RhdGVSZXN1bHQoc20sIG1hcHBpbmcsIGZldGNoLAogICAgICAg\nICAgICAgICAgICAgICAgICBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEUpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChyZXMgPT0gbnVsbCAmJiAhc2VsZWN0\nUHJpbWFyeUtleShzbSwgbWFwcGluZywgZmV0Y2gpKQogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICByZXMgPSBnZXRJbml0aWFsaXplU3Rh\ndGVVbmlvblJlc3VsdChzbSwgbWFwcGluZywgbWFwcGluZ3MsCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZldGNoKTsKICAgICAgICAgICAgICAgIGlmIChp\nc0VtcHR5UmVzdWx0KHJlcykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBmaWd1cmUg\nb3V0IHdoYXQgdHlwZSBvZiBvYmplY3QgdGhpcyBpczsgdGhlIHN0YXRlIG1h\nbmFnZXIKICAgICAgICAgICAgLy8gb25seSBndWFyYW50ZWVzIHRvIHByb3Zp\nZGUgYSBiYXNlIGNsYXNzCiAgICAgICAgICAgIENsYXNzIHR5cGU7CiAgICAg\nICAgICAgIGlmICgodHlwZSA9IGdldFR5cGUocmVzLCBtYXBwaW5nKSkgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHJlcy5nZXRCYXNlTWFwcGlu\nZygpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWFwcGluZyA9IHJl\ncy5nZXRCYXNlTWFwcGluZygpOwogICAgICAgICAgICAgICAgcmVzLnN0YXJ0\nRGF0YVJlcXVlc3QobWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkpOwogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB0eXBlID0g\nbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0Q2xhc3ModGhpcywgbWFw\ncGluZywKICAgICAgICAgICAgICAgICAgICAgICAgcmVzKTsKICAgICAgICAg\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLmVu\nZERhdGFSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHN0YXRlIG1hbmFn\nZXI7IHRoaXMgbWF5IGNoYW5nZSB0aGUgbWFwcGluZwogICAgICAgICAgICAv\nLyBhbmQgdGhlIG9iamVjdCBpZCBpbnN0YW5jZSBpZiB0aGUgdHlwZSBhcyBk\nZXRlcm1pbmVkCiAgICAgICAgICAgIC8vIGZyb20gdGhlIGluZGljYXRvciBp\ncyBhIHN1YmNsYXNzIG9mIGV4cGVjdGVkIHR5cGUKICAgICAgICAgICAgc20u\naW5pdGlhbGl6ZSh0eXBlLCBzdGF0ZSk7CgogICAgICAgICAgICAvLyBsb2Fk\nIHRoZSBzZWxlY3RlZCBtYXBwaW5ncyBpbnRvIHRoZSBnaXZlbiBzdGF0ZSBt\nYW5hZ2VyCiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgLy8gcmUtZ2V0IHRoZSBtYXBwaW5nIGluIGNhc2UgdGhlIGlu\nc3RhbmNlIHdhcyBhIHN1YmNsYXNzCiAgICAgICAgICAgICAgICBtYXBwaW5n\nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICAg\nICAgICAgIGxvYWQobWFwcGluZywgc20sIGZldGNoLCByZXMpOwogICAgICAg\nICAgICAgICAgZ2V0VmVyc2lvbihtYXBwaW5nLCBzbSwgcmVzKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBpZiAocmVzICE9IG51bGwgJiYgKGluZm8g\nPT0gbnVsbCB8fCByZXMgIT0gaW5mby5yZXN1bHQpKQogICAgICAgICAgICAg\nICAgcmVzLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9y\nIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9u\nIG9mIGdldHRpbmcgdmVyc2lvbiBmcm9tIHRoZSByZXN1bHQgc2V0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBnZXRWZXJzaW9uKENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIFJl\nc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIG1hcHBp\nbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBv\ndmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1w\nbGVtZW50YXRpb24gb2YgY2hlY2tpbmcgd2hldGhlciB0aGUgcmVzdWx0IHNl\ndCBpcyBlbXB0eSBvciBub3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29s\nZWFuIGlzRW1wdHlSZXN1bHQoUmVzdWx0IHJlcykgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHJlcyAhPSBudWxsICYmICFyZXMubmV4dCgp\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMg\ndG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtl\nIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyB0eXBlIGZyb20g\ndGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzcyBn\nZXRUeXBlKFJlc3VsdCByZXMsIENsYXNzTWFwcGluZyBtYXBwaW5nKXsKICAg\nICAgICBpZiAocmVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtYXBw\naW5nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHRoZSBtYXBwaW5nIHRvIGN1\nc3RvbSBsb2FkIGRhdGEuIFJldHVybiBudWxsIGlmIHRoZSBtYXBwaW5nCiAg\nICAgKiBkb2VzIG5vdCB1c2UgY3VzdG9tIGxvYWRpbmcuCiAgICAgKi8KICAg\nIHByaXZhdGUgQm9vbGVhbiBjdXN0b21Mb2FkKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIFBDU3RhdGUg\nc3RhdGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAg\ndGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBtYXBwaW5nIHRha2Vz\nIGNhcmUgb2YgaW5pdGlhbGl6YXRpb24KICAgICAgICBpZiAoIW1hcHBpbmcu\nY3VzdG9tTG9hZChzbSwgdGhpcywgc3RhdGUsIGZldGNoKSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHNtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgbWFwcGluZy5nZXRWZXJz\naW9uKCkuYWZ0ZXJMb2FkKHNtLCB0aGlzKTsKICAgICAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uVFJVRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGRh\ndGEgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSBhbmQgcmV0dXJuIHRoZSByZXN1\nbHQuIFJldHVybgogICAgICogbnVsbCBpZiB0aGVyZSBpcyBubyBkYXRhIGlu\nIHRoZSBjdXJyZW50IGZldGNoIGdyb3VwcyB0byBzZWxlY3QuCiAgICAgKi8K\nICAgIHByaXZhdGUgUmVzdWx0IGdldEluaXRpYWxpemVTdGF0ZVJlc3VsdChP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgc3Vi\ncykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTZWxl\nY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICBpZiAoIXNlbGVj\ndChzZWwsIG1hcHBpbmcsIHN1YnMsIHNtLCBudWxsLCBmZXRjaCwKICAgICAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOLCB0cnVl\nLCBmYWxzZSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHNl\nbC53aGVyZVByaW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZywg\ndGhpcyk7CiAgICAgICAgc2VsLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwg\nZmFsc2UpOwogICAgICAgIHJldHVybiBzZWwuZXhlY3V0ZSh0aGlzLCBmZXRj\naCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgYSB1bmlvbiBvZiB0\naGUgZGF0YSBmb3IgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gcG9zc2libGUg\nY29uY3JldGUKICAgICAqIG1hcHBpbmdzIGFuZCByZXR1cm4gdGhlIHJlc3Vs\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHQgZ2V0SW5pdGlhbGl6ZVN0\nYXRlVW5pb25SZXN1bHQoZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwK\nICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgZmluYWwgQ2xhc3NNYXBw\naW5nW10gbWFwcGluZ3MsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nZmluYWwgSkRCQ1N0b3JlTWFuYWdlciBzdG9yZSA9IHRoaXM7CiAgICAgICAg\nZmluYWwgaW50IGVhZ2VyID0gTWF0aC5taW4oZmV0Y2guZ2V0RWFnZXJGZXRj\naE1vZGUoKSwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5F\nQUdFUl9KT0lOKTsKCiAgICAgICAgVW5pb24gdW5pb24gPSBfc3FsLm5ld1Vu\naW9uKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgdW5pb24uc2V0RXhwZWN0\nZWRSZXN1bHRDb3VudCgxLCBmYWxzZSk7CiAgICAgICAgaWYgKGZldGNoLmdl\ndFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGZldGNoLkVBR0VSX0pP\nSU4pCiAgICAgICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAgICB1\nbmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGkpIHsKICAg\nICAgICAgICAgICAgIHNlbC5zZWxlY3QobWFwcGluZ3NbaV0sIFNlbGVjdC5T\nVUJTX0FOWV9KT0lOQUJMRSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICAg\nICAgICAgIGVhZ2VyKTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZVByaW1h\ncnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZ3NbaV0sIHN0b3JlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB1bmlv\nbi5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlbGVjdCBwcmltYXJ5IGtleSBkYXRhIHRvIG1ha2Ugc3VyZSB0aGUgZ2l2\nZW4gaW5zdGFuY2UgZXhpc3RzLCBsb2NraW5nCiAgICAgKiBpZiBuZWVkZWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3RQcmltYXJ5S2V5\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gc2VsZWN0IHBr\ncyBmcm9tIGJhc2UgY2xhc3MgcmVjb3JkIHRvIGVuc3VyZSBpdCBleGlzdHMg\nYW5kIGxvY2sKICAgICAgICAvLyBpdCBpZiBuZWVkZWQKICAgICAgICBDbGFz\nc01hcHBpbmcgYmFzZSA9IG1hcHBpbmc7CiAgICAgICAgd2hpbGUgKGJhc2Uu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgYmFzZSA9IGJhc2UuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCk7CgogICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1NlbGVj\ndCgpOwogICAgICAgIHNlbC5zZWxlY3QoYmFzZS5nZXRQcmltYXJ5S2V5Q29s\ndW1ucygpKTsKICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9i\namVjdElkKCksIGJhc2UsIHRoaXMpOwogICAgICAgIFJlc3VsdCBleGlzdHMg\nPSBzZWwuZXhlY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKGlzRW1wdHlSZXN1bHQoZXhpc3RzKSkKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHJlY29yZCBs\nb2NrZWQ/CiAgICAgICAgICAgIGlmIChfYWN0aXZlICYmIF9sbSAhPSBudWxs\nICYmIGV4aXN0cy5pc0xvY2tpbmcoKSkKICAgICAgICAgICAgICAgIF9sbS5s\nb2FkZWRGb3JVcGRhdGUoc20pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBleGlzdHMuY2xvc2Uo\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9hZChP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAg\nIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGpmZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRjaDsKCiAg\nICAgICAgLy8gZ2V0IGEgY29ubmVjdGlvbiwgb3IgcmV1c2UgY3VycmVudCBv\nbmUKICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0gKENvbm5lY3Rpb25J\nbmZvKSBjb250ZXh0OwogICAgICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAg\nICAgIGlmIChpbmZvICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgaW5p\ndGlhbGl6ZSgpIGZhaWxzIHRvIGxvYWQgcmVxdWlyZWQgZmllbGRzLCB0aGVu\nIHRoaXMgbWV0aG9kCiAgICAgICAgICAgIC8vIGlzIGNhbGxlZDsgbWFrZSBz\ndXJlIG5vdCB0byB0cnkgdG8gdXNlIHRoZSBnaXZlbiByZXN1bHQgaWYgaXQn\ncwogICAgICAgICAgICAvLyB0aGUgc2FtZSBvbmUgd2UganVzdCBmYWlsZWQg\ndG8gY29tcGxldGVseSBpbml0aWFsaXplKCkgd2l0aAogICAgICAgICAgICBp\nZiAoaW5mby5zbSAhPSBzbSkKICAgICAgICAgICAgICAgIHJlcyA9IGluZm8u\ncmVzdWx0OwogICAgICAgICAgICBpbmZvLnNtID0gbnVsbDsKICAgICAgICB9\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhbiBl\neGlzdGluZyByZXN1bHQsIGxvYWQgYWxsIHdlIGNhbiBmcm9tIGl0CiAgICAg\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykg\nc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gs\nIHJlcyk7CiAgICAgICAgICAgICAgICByZW1vdmVMb2FkZWRGaWVsZHMoc20s\nIGZpZWxkcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHRo\nZSBpbnN0YW5jZSBpcyBob2xsb3cgYW5kIHRoZXJlJ3MgYSBjdXN0b21pemVk\nCiAgICAgICAgICAgIC8vIGdldCBieSBpZCBtZXRob2QsIHVzZSBpdAogICAg\nICAgICAgICBpZiAoc20uZ2V0TG9hZGVkKCkubGVuZ3RoKCkgPT0gMCAKICAg\nICAgICAgICAgICAgICYmIG1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywg\nbnVsbCwgamZldGNoKSkKICAgICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZp\nZWxkcyhzbSwgZmllbGRzKTsKCiAgICAgICAgICAgIC8vIyMjIHNlbGVjdCBp\ncyBraW5kIG9mIGEgYmlnIG9iamVjdCwgYW5kIGluIHNvbWUgY2FzZXMgd2Ug\nZG9uJ3QKICAgICAgICAgICAgLy8jIyMgdXNlIGl0Li4uIHdvdWxkIGl0IGJl\nIHdvcnRoIGl0IHRvIGhhdmUgYSBzbWFsbCBzaGVsbCBzZWxlY3QKICAgICAg\nICAgICAgLy8jIyMgb2JqZWN0IHRoYXQgb25seSBjcmVhdGVzIGEgcmVhbCBz\nZWxlY3Qgd2hlbiBhY3R1YWxseSB1c2VkPwoKICAgICAgICAgICAgU2VsZWN0\nIHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIGlmIChzZWxl\nY3Qoc2VsLCBtYXBwaW5nLCBTZWxlY3QuU1VCU19FWEFDVCwgc20sIGZpZWxk\ncywgamZldGNoLAogICAgICAgICAgICAgICAgRWFnZXJGZXRjaE1vZGVzLkVB\nR0VSX0pPSU4sIHRydWUsIGZhbHNlKSkgewogICAgICAgICAgICAgICAgc2Vs\nLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0\naGlzKTsKICAgICAgICAgICAgICAgIHJlcyA9IHNlbC5leGVjdXRlKHRoaXMs\nIGpmZXRjaCwgbG9ja0xldmVsKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgCWlmIChpc0VtcHR5UmVzdWx0KHJlcykpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gsIHJlcyk7CiAgICAg\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIHJl\ncy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBub3cgYWxsb3cgdGhlIGZpZWxkcyB0byBsb2FkIHRo\nZW1zZWx2ZXMgaW5kaXZpZHVhbGx5IHRvbwogICAgICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldEZpZWxkTWFwcGluZ3MoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSAmJiAhc20uZ2V0\nTG9hZGVkKCkuZ2V0KGkpKQogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5s\nb2FkKHNtLCB0aGlzLCBqZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSkpOwog\nICAgICAgICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5hZnRlckxvYWQoc20s\nIHRoaXMpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNh\ndGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBT\nUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbGlzdCBmb3JtZWQgYnkg\ncmVtb3ZpbmcgYWxsIGxvYWRlZCBmaWVsZHMgZnJvbSB0aGUgZ2l2ZW4gb25l\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlTG9hZGVkRmllbGRz\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMpIHsKICAg\nICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gZmllbGRzLmxlbmd0aCgpOyBp\nIDwgbGVuOyBpKyspCiAgICAgICAgICAgIGlmIChmaWVsZHMuZ2V0KGkpICYm\nIHNtLmdldExvYWRlZCgpLmdldChpKSkKICAgICAgICAgICAgICAgIGZpZWxk\ncy5jbGVhcihpKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBsb2Fk\nQWxsKENvbGxlY3Rpb24gc21zLCBQQ1N0YXRlIHN0YXRlLCBpbnQgbG9hZCwK\nICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250\nZXh0KSB7CiAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIubG9hZEFsbChzbXMs\nIHRoaXMsIHN0YXRlLCBsb2FkLCBmZXRjaCwgY29udGV4dCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYmVmb3JlU3RhdGVDaGFuZ2UoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgUENTdGF0ZSBmcm9tU3RhdGUsCiAgICAgICAgUENTdGF0\nZSB0b1N0YXRlKSB7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZmx1\nc2goQ29sbGVjdGlvbiBzbXMpIHsKICAgICAgICByZXR1cm4gX2NvbmYuZ2V0\nVXBkYXRlTWFuYWdlckluc3RhbmNlKCkuZmx1c2goc21zLCB0aGlzKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5jZWxBbGwoKSB7CiAgICAgICAg\nLy8gbm90ZSB0aGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IGxvY2sgdGhlIGNv\nbnRleHQsIHNpbmNlCiAgICAgICAgLy8gd2Ugd2FudCB0byBhbGxvdyBhIGRp\nZmZlcmVudCB0aHJlYWQgdG8gYmUgYWJsZSB0byBjYW5jZWwgdGhlCiAgICAg\nICAgLy8gb3V0c3RhbmRpbmcgc3RhdGVtZW50IG9uIGEgZGlmZmVyZW50IGNv\nbnRleHQKCiAgICAgICAgQ29sbGVjdGlvbiBzdG1udHM7CiAgICAgICAgc3lu\nY2hyb25pemVkIChfc3RtbnRzKSB7CiAgICAgICAgICAgIGlmIChfc3RtbnRz\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgc3RtbnRzID0gbmV3IEFycmF5TGlzdChfc3RtbnRzKTsKICAg\nICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gc3RtbnRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQog\nICAgICAgICAgICAgICAgKChTdGF0ZW1lbnQpIGl0ci5uZXh0KCkpLmNhbmNl\nbCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhj\nZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25PYmplY3RJZChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBib29sZWFuIHByZUZsdXNoKSB7CiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBp\nZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklE\nX0FQUExJQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4gQXBwbGljYXRpb25J\nZHMuYXNzaWduKHNtLCB0aGlzLCBwcmVGbHVzaCk7CgogICAgICAgIC8vIGRh\ndGFzdG9yZSBpZGVudGl0eQogICAgICAgIE9iamVjdCB2YWwgPSBJbXBsSGVs\ncGVyLmdlbmVyYXRlSWRlbnRpdHlWYWx1ZShfY3R4LCBtZXRhLAogICAgICAg\nICAgICBKYXZhVHlwZXMuTE9ORyk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxs\nICYmIG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpICE9IFZhbHVlU3RyYXRl\nZ2llcy5OQVRJVkUpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHZhbCA9IGdldERhdGFT\ndG9yZUlkU2VxdWVuY2UobWV0YSkubmV4dChfY3R4LCBtZXRhKTsKICAgICAg\nICBzbS5zZXRPYmplY3RJZChuZXdEYXRhU3RvcmVJZCh2YWwsIG1ldGEpKTsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBhc3NpZ25GaWVsZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBpbnQgZmll\nbGQsCiAgICAgICAgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgT2JqZWN0IHZhbCA9IEltcGxIZWxwZXIuZ2VuZXJhdGVG\naWVsZFZhbHVlKF9jdHgsIGZtZCk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc20uc3RvcmUo\nZmllbGQsIHZhbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\ncHVibGljIENsYXNzIGdldE1hbmFnZWRUeXBlKE9iamVjdCBvaWQpIHsKICAg\nICAgICBpZiAob2lkIGluc3RhbmNlb2YgSWQpCiAgICAgICAgICAgIHJldHVy\nbiAoKElkKSBvaWQpLmdldFR5cGUoKTsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0RGF0YVN0b3JlSWRUeXBlKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBJZC5jbGFzczsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGNvcHlEYXRhU3RvcmVJZChPYmpl\nY3Qgb2lkLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBJZCBpZCA9\nIChJZCkgb2lkOwogICAgICAgIHJldHVybiBuZXcgSWQobWV0YS5nZXREZXNj\ncmliZWRUeXBlKCksIGlkLmdldElkKCksIGlkLmhhc1N1YmNsYXNzZXMoKSk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdEYXRhU3RvcmVJZChPYmpl\nY3QgdmFsLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4g\nSWQubmV3SW5zdGFuY2UobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIHZhbCk7\nCiAgICB9CgogICAgcHVibGljIElkIG5ld0RhdGFTdG9yZUlkKGxvbmcgaWQs\nIENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIHN1YnMpIHsKICAgICAg\nICByZXR1cm4gbmV3IElkKG1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpLCBp\nZCwgc3Vicyk7CiAgICB9CgogICAgcHVibGljIFJlc3VsdE9iamVjdFByb3Zp\nZGVyIGV4ZWN1dGVFeHRlbnQoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAg\nIGZpbmFsIGJvb2xlYW4gc3ViY2xhc3NlcywgRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xh\nc3NNYXBwaW5nKSBtZXRhOwogICAgICAgIGZpbmFsIENsYXNzTWFwcGluZ1td\nIG1hcHBpbmdzOwogICAgICAgIGlmIChzdWJjbGFzc2VzKQogICAgICAgICAg\nICBtYXBwaW5ncyA9IG1hcHBpbmcuZ2V0SW5kZXBlbmRlbnRBc3NpZ25hYmxl\nTWFwcGluZ3MoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG1hcHBpbmdz\nID0gbmV3IENsYXNzTWFwcGluZ1tdIHsgbWFwcGluZyB9OwoKICAgICAgICBS\nZXN1bHRPYmplY3RQcm92aWRlcltdIHJvcHMgPSBudWxsOwogICAgICAgIGZp\nbmFsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gamZldGNoID0gKEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24pIGZldGNoOwogICAgICAgIGlmIChqZmV0Y2guZ2V0\nU3ViY2xhc3NGZXRjaE1vZGUobWFwcGluZykgIT0gamZldGNoLkVBR0VSX0pP\nSU4pCiAgICAgICAgICAgIHJvcHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlk\nZXJbbWFwcGluZ3MubGVuZ3RoXTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gY2hlY2sgZm9yIGN1c3RvbSBsb2FkcwogICAgICAgICAgICBSZXN1\nbHRPYmplY3RQcm92aWRlciByb3A7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIHJvcCA9IG1hcHBpbmdzW2ldLmN1c3RvbUxvYWQodGhpcywgc3ViY2xh\nc3NlcywgamZldGNoLCAwLAogICAgICAgICAgICAgICAgICAgIExvbmcuTUFY\nX1ZBTFVFKTsKICAgICAgICAgICAgICAgIGlmIChyb3AgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChyb3BzID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJvcHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlk\nZXJbbWFwcGluZ3MubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICByb3Bz\nW2ldID0gcm9wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBpZiB3ZSdyZSBzZWxlY3RpbmcgaW5kZXBlbmRlbnQg\nbWFwcGluZ3Mgc2VwYXJhdGVseSBvciBoYXZlCiAgICAgICAgICAgIC8vIGN1\nc3RvbSBsb2FkcywgZG8gaW5kaXZpZHVhbCBzZWxlY3RzIGZvciBlYWNoIGNs\nYXNzCiAgICAgICAgICAgIHJvcCA9IG51bGw7CiAgICAgICAgICAgIGlmIChy\nb3BzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAocm9wc1tpXSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0IHNl\nbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgc2Vs\nLnNldExSUyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBCaXRTZXQgcGFn\nZWQgPSBzZWxlY3RFeHRlbnQoc2VsLCBtYXBwaW5nc1tpXSwgamZldGNoLAog\nICAgICAgICAgICAgICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgcm9wc1tpXSA9IG5ldyBJbnN0YW5jZVJlc3VsdE9iamVjdFBy\nb3ZpZGVyKHNlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBp\nbmdzW2ldLCB0aGlzLCBqZmV0Y2gpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgcm9wc1tpXSA9IG5ldyBQYWdp\nbmdSZXN1bHRPYmplY3RQcm92aWRlcihzZWwsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBtYXBwaW5nc1tpXSwgdGhpcywgamZldGNoLCBwYWdlZCwg\nTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKHJvcHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHJvcHNbMF07CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIE1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyKHJvcHMpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBwZXJmb3JtIGEgdW5pb24gb24gYWxsIGlu\nZGVwZW5kZW50IGNsYXNzZXMKICAgICAgICAgICAgVW5pb24gdW5pb24gPSBf\nc3FsLm5ld1VuaW9uKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgICAgIHVu\naW9uLnNldExSUyh0cnVlKTsKICAgICAgICAgICAgZmluYWwgQml0U2V0W10g\ncGFnZWQgPSBuZXcgQml0U2V0W21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAg\nICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50\nIGlkeCkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VkW2lkeF0gPSBzZWxl\nY3RFeHRlbnQoc2VsLCBtYXBwaW5nc1tpZHhdLCBqZmV0Y2gsCiAgICAgICAg\nICAgICAgICAgICAgICAgIHN1YmNsYXNzZXMpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIHVzaW5nIHBhZ2lu\nZyByb3AgaWYgYW55IHVuaW9uIGVsZW1lbnQgaGFzIHBhZ2VkIGZpZWxkcwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBhZ2VkLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGFnZWRbaV0gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBhZ2luZ1Jlc3VsdE9i\namVjdFByb3ZpZGVyKHVuaW9uLCBtYXBwaW5ncywKICAgICAgICAgICAgICAg\nICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBqZmV0Y2gsIHBhZ2Vk\nLCBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIG5ldyBJbnN0YW5jZVJlc3VsdE9iamVjdFByb3ZpZGVyKHVuaW9u\nLCBtYXBwaW5nc1swXSwgdGhpcywKICAgICAgICAgICAgICAgIGpmZXRjaCk7\nCiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAg\nICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdp\ndmVuIG1hcHBpbmcgZm9yIHVzZSBpbiBhbiBleHRlbnQsIHJldHVybmluZyBw\nYWdlZCBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgQml0U2V0IHNlbGVj\ndEV4dGVudChTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29sZWFuIHN1\nYmNsYXNzZXMpIHsKICAgICAgICBpbnQgc3VicyA9IChzdWJjbGFzc2VzKSA/\nIFNlbGVjdC5TVUJTX0pPSU5BQkxFIDogU2VsZWN0LlNVQlNfTk9ORTsKICAg\nICAgICAvLyBkZWNpZGUgYmV0d2VlbiBwYWdpbmcgYW5kIHN0YW5kYXJkIGl0\nZXJhdGlvbgogICAgICAgIEJpdFNldCBwYWdlZCA9IFBhZ2luZ1Jlc3VsdE9i\namVjdFByb3ZpZGVyLmdldFBhZ2VkRmllbGRzKHNlbCwgbWFwcGluZywKICAg\nICAgICAgICAgdGhpcywgZmV0Y2gsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24u\nRUFHRVJfUEFSQUxMRUwsCiAgICAgICAgICAgIExvbmcuTUFYX1ZBTFVFKTsK\nICAgICAgICBpZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAgc2VsLnNl\nbGVjdElkZW50aWZpZXIobWFwcGluZywgc3VicywgdGhpcywgZmV0Y2gsCiAg\nICAgICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BB\nUkFMTEVMKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNlbC5zZWxlY3RJ\nZGVudGlmaWVyKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAogICAgICAg\nICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKTsK\nICAgICAgICByZXR1cm4gcGFnZWQ7CiAgICB9CgogICAgcHVibGljIFN0b3Jl\nUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmd1YWdlKSB7CiAgICAgICAgRXhw\ncmVzc2lvblBhcnNlciBlcCA9IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNlckZvckxh\nbmd1YWdlKGxhbmd1YWdlKTsKICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBKREJDU3RvcmVRdWVyeSh0aGlzLCBlcCk7\nCiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhs\nYW5ndWFnZSkpCiAgICAgICAgICAgIHJldHVybiBuZXcgU1FMU3RvcmVRdWVy\neSh0aGlzKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJs\naWMgRmV0Y2hDb25maWd1cmF0aW9uIG5ld0ZldGNoQ29uZmlndXJhdGlvbigp\nIHsKICAgICAgICByZXR1cm4gbmV3IEpEQkNGZXRjaENvbmZpZ3VyYXRpb25J\nbXBsKCk7CiAgICB9CgogICAgcHVibGljIFNlcSBnZXREYXRhU3RvcmVJZFNl\ncXVlbmNlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRh\nLmdldElkZW50aXR5U3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTkFU\nSVZFCiAgICAgICAgICAgIHx8IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgp\nID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICByZXR1cm4g\nX2NvbmYuZ2V0U2VxdWVuY2VJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0VmFsdWVTZXF1ZW5jZShG\naWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGlmIChfY29u\nbiAhPSBudWxsKQogICAgICAgICAgICBfY29ubi5mcmVlKCk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8vLy8v\nLy8vLy8vCgogICAgLyoqCiAgICAgKiBDb25uZWN0IHRvIHRoZSBkYi4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGNvbm5lY3QoYm9vbGVhbiByZWYpIHsK\nICAgICAgICBfY3R4LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICAvLyBjb25uZWN0IGlmIHRoZSBjb25uZWN0aW9uIGlzIGN1cnJlbnRseSBu\ndWxsLCBvciBpZgogICAgICAgICAgICAvLyB0aGUgY29ubmVjdGlvbiBoYXMg\nYmVlbiBjbG9zZWQgb3V0IGZyb20gdW5kZXIgdXMKICAgICAgICAgICAgaWYg\nKF9jb25uID09IG51bGwpCiAgICAgICAgICAgICAgICBfY29ubiA9IGNvbm5l\nY3RJbnRlcm5hbCgpOwogICAgICAgICAgICBpZiAocmVmKQogICAgICAgICAg\nICAgICAgX2Nvbm4ucmVmKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0\nU3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBfY3R4LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENvbm5lY3QgdG8gdGhlIGRhdGFiYXNlLiBUaGlzIG1ldGhvZCBp\ncyBzZXBhcmF0ZWQgb3V0IHNvIHRoYXQgaXQKICAgICAqIGNhbiBiZSBvdmVy\ncmlkZGVuLgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVmQ291bnRDb25uZWN0\naW9uIGNvbm5lY3RJbnRlcm5hbCgpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBuZXcgUmVmQ291bnRDb25uZWN0aW9uKF9kcy5nZXRD\nb25uZWN0aW9uKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUg\nb2JqZWN0IHdpdGggdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAgcHVibGlj\nIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIFZhbHVlTWFwcGluZyB2bSwgCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgT2JqZWN0IHBjID0gX2N0eC5maW5kKG9pZCwgZmV0Y2gsIG51bGws\nIG51bGwsIDApOwogICAgICAgIGlmIChwYyA9PSBudWxsICYmIHZtICE9IG51\nbGwpIHsKICAgICAgICAgICAgT3JwaGFuZWRLZXlBY3Rpb24gYWN0aW9uID0g\nX2NvbmYuZ2V0T3JwaGFuZWRLZXlBY3Rpb25JbnN0YW5jZSgpOwogICAgICAg\nICAgICBwYyA9IGFjdGlvbi5vcnBoYW4ob2lkLCBudWxsLCB2bSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBwYzsKICAgIH0KCiAgICAvKioKICAgICAq\nIExvYWQgdGhlIG9iamVjdCBpbiB0aGUgY3VycmVudCByb3cgb2YgdGhlIGdp\ndmVuIHJlc3VsdC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBsb2FkKENs\nYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBSZXN1bHQgcmVzdWx0KSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIW1hcHBpbmcuaXNN\nYXBwZWQoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgidmlydHVhbC1tYXBwaW5nIiwgCiAgICAgICAg\nICAgICAgICBtYXBwaW5nKSk7CgogICAgICAgIC8vIGdldCB0aGUgb2JqZWN0\nIGlkIGZvciB0aGUgcm93OyBiYXNlIGNsYXNzIHNlbGVjdHMgcGsgY29sdW1u\ncwogICAgICAgIENsYXNzTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAgICAg\nICB3aGlsZSAoYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKSAhPSBudWxsKQogICAgICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2luYWJs\nZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBPYmplY3Qgb2lkID0g\nYmFzZS5nZXRPYmplY3RJZCh0aGlzLCByZXN1bHQsIG51bGwsIHRydWUsIG51\nbGwpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSBuZXcg\nQ29ubmVjdGlvbkluZm8oKTsKICAgICAgICBpbmZvLnJlc3VsdCA9IHJlc3Vs\ndDsKICAgICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgIHJl\ndHVybiBfY3R4LmZpbmQob2lkLCBmZXRjaCwgZXhjbHVkZSwgaW5mbywgMCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBzdGF0ZSBt\nYW5hZ2VyIHdpdGggZGF0YSBmcm9tIHRoZSByZXN1bHQgc2V0LiBPbmx5CiAg\nICAgKiBtYXBwaW5ncyBvcmlnaW5hbGx5IHNlbGVjdGVkIHdpbGwgYmUgbG9h\nZGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbG9hZChDbGFzc01hcHBp\nbmcgbWFwcGluZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBGaWVsZE1hcHBpbmcgZWFnZXJU\nb01hbnkgPSBsb2FkKG1hcHBpbmcsIHNtLCBmZXRjaCwgcmVzLCBudWxsKTsK\nICAgICAgICBpZiAoZWFnZXJUb01hbnkgIT0gbnVsbCkKICAgICAgICAgICAg\nZWFnZXJUb01hbnkubG9hZEVhZ2VySm9pbihzbSwgdGhpcywgZmV0Y2gudHJh\ndmVyc2VKREJDKGVhZ2VyVG9NYW55KSwKICAgICAgICAgICAgICAgIHJlcyk7\nCiAgICAgICAgaWYgKF9hY3RpdmUgJiYgX2xtICE9IG51bGwgJiYgcmVzLmlz\nTG9ja2luZygpKQogICAgICAgICAgICBfbG0ubG9hZGVkRm9yVXBkYXRlKHNt\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGZpZWxkcyBvZiB0\naGUgZ2l2ZW4gbWFwcGluZy4gUmV0dXJuIGFueSB0by1tYW55IGVhZ2VyIGZp\nZWxkCiAgICAgKiB3aXRob3V0IGxvYWRpbmcgaXQuCiAgICAgKi8KICAgIHBy\naXZhdGUgRmllbGRNYXBwaW5nIGxvYWQoQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgRmllbGRNYXBwaW5nIGVh\nZ2VyVG9NYW55KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChtYXBwaW5nLmN1c3RvbUxvYWQoc20sIHRoaXMsIGZldGNoLCBy\nZXMpKQogICAgICAgICAgICByZXR1cm4gZWFnZXJUb01hbnk7CgogICAgICAg\nIC8vIGxvYWQgc3VwZXJjbGFzcyBkYXRhOyBiYXNlIGNsYXNzIGxvYWRzIHZl\ncnNpb24KICAgICAgICBDbGFzc01hcHBpbmcgcGFyZW50ID0gbWFwcGluZy5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAo\ncGFyZW50ICE9IG51bGwpCiAgICAgICAgICAgIGVhZ2VyVG9NYW55ID0gbG9h\nZChwYXJlbnQsIHNtLCBmZXRjaCwgcmVzLCBlYWdlclRvTWFueSk7CiAgICAg\nICAgZWxzZSBpZiAoc20uZ2V0VmVyc2lvbigpID09IG51bGwpCiAgICAgICAg\nICAgIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmxvYWQoc20sIHRoaXMsIHJlcyk7\nCgogICAgICAgIC8vIGxvYWQgdW5sb2FkZWQgZmllbGRzCiAgICAgICAgRmll\nbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXREZWZpbmVkRmllbGRNYXBw\naW5ncygpOwogICAgICAgIE9iamVjdCBlcmVzLCBwcm9jZXNzZWQ7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGZtc1tpXS5pc1ByaW1hcnlLZXkoKSB8fCBzbS5nZXRM\nb2FkZWQoKS5nZXQoZm1zW2ldLmdldEluZGV4KCkpKQogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjaGVj\nayBmb3IgZWFnZXIgcmVzdWx0LCBhbmQgaWYgbm90IHByZXNlbnQgZG8gc3Rh\nbmRhcmQgbG9hZAogICAgICAgICAgICBlcmVzID0gcmVzLmdldEVhZ2VyKGZt\nc1tpXSk7CiAgICAgICAgICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KGZtc1tp\nXSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgIGlmIChlcmVz\nID09IHJlcykgewogICAgICAgICAgICAgICAgICAgIGlmIChlYWdlclRvTWFu\neSA9PSBudWxsICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGVhZ2VyVG9NYW55ID0gZm1zW2ldOwog\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgZm1zW2ldLmxvYWRFYWdlckpvaW4oc20sIHRoaXMsIAogICAgICAgICAg\nICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIHJl\ncyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVyZXMgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZCA9IGZtc1tpXS5sb2Fk\nRWFnZXJQYXJhbGxlbChzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAg\nCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBlcmVzKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocHJvY2Vzc2VkICE9IGVyZXMpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJlcy5wdXRFYWdlcihmbXNbaV0sIHByb2Nlc3NlZCk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBm\nbXNbaV0ubG9hZChzbSwgdGhpcywgZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tp\nXSksIHJlcyk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICByZXMuZW5kRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZWFnZXJUb01hbnk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGb3IgaW1wbGVtZW50YXRpb24gdXNlIG9ubHkuCiAgICAg\nKiBSZXR1cm4gYSBzZWxlY3QgZm9yIHRoZSBwcm9wZXIgbWFwcGluZ3MuIFJl\ndHVybiBudWxsIGlmIG5vIHNlbGVjdCBpcwogICAgICogbmVlZGVkLiBUaGUg\nbWV0aG9kIGlzIGRlc2lnbmVkIHRvIGJlIGNvbXBsZW1lbnRhcnkgdG8gdGhl\nIGxvYWQgbWV0aG9kcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHNlbGVj\ndCB0byBidWlsZCBvbgogICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIG1hcHBp\nbmcgZm9yIHRoZSBiYXNlIHR5cGUgdG8gc2VsZWN0IGZvcgogICAgICogQHBh\ncmFtIHN1YnMgd2hldGhlciB0aGUgc2VsZWN0IG1pZ2h0IGluY2x1ZGUgc3Vi\nY2xhc3NlcyBvZiB0aGUKICAgICAqIGdpdmVuIG1hcHBpbmcKICAgICAqIEBw\nYXJhbSBzbSBzdGF0ZSBtYW5hZ2VyIGlmIGFuIGluc3RhbmNlIGlzIGJlaW5n\nIGxvYWRlZCBvcgogICAgICogaW5pdGlhbGl6ZWQsIGVsc2UgbnVsbAogICAg\nICogQHBhcmFtIGZpZWxkcyBpZiBhIHN0YXRlIG1hbmFnZXIgaXMgYmVpbmcg\nbG9hZGVkLCB0aGUgc2V0IG9mCiAgICAgKiBmaWVsZHMgdGhhdCBtdXN0IGJl\nIGxvYWRlZCBpbiBvcmRlciwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0gZmV0\nY2ggdGhlIGZldGNoIGNvbmZpZ3VyYXRpb247IHVzZWQgaWYgbm8gc3BlY2lm\naWMgZmllbGRzCiAgICAgKiBtdXN0IGJlIGxvYWRlZCwgYW5kIHVzZWQgd2hl\nbiBzZWxlY3RpbmcgcmVsYXRpb25zCiAgICAgKiBAcGFyYW0gZWFnZXIgZWFn\nZXIgZmV0Y2ggbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBpZGVudCB3aGV0\naGVyIHRvIHNlbGVjdCBwcmltYXJ5IGtleSBjb2x1bW5zIGFzIGRpc3RpbmN0\nCiAgICAgKiBpZGVudGlmaWVycwogICAgICogQHBhcmFtIG91dGVyIHdoZXRo\nZXIgd2UncmUgb3V0ZXItam9pbmluZyB0byB0aGlzIHR5cGUKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiB0aGUgc2VsZWN0IGlzIHJlcXVpcmVkLCBmYWxzZSBv\ndGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFNl\nbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3VicywKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIGludCBlYWdl\nciwgYm9vbGVhbiBpZGVudCwgYm9vbGVhbiBvdXRlcikgewogICAgICAgIC8v\nIGFkZCBjbGFzcyBjb25kaXRpb25zIHNvIHRoYXQgdGhleSdyZSBjbG9uZWQg\nZm9yIGFueSBiYXRjaGVkIHNlbGVjdHMKICAgICAgICBib29sZWFuIGpvaW5l\nZFN1cGVycyA9IGZhbHNlOwogICAgICAgIGlmICgoc20gPT0gbnVsbCB8fCBz\nbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5UUkFOU0lFTlQpCiAgICAgICAg\nICAgICYmIChzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFIHx8IHN1YnMg\nPT0gU2VsZWN0LlNVQlNfTk9ORSkpIHsKICAgICAgICAgICAgbG9hZFN1YmNs\nYXNzZXMobWFwcGluZyk7IAogICAgICAgICAgICBKb2lucyBqb2lucyA9IChv\ndXRlcikgPyBzZWwubmV3T3V0ZXJKb2lucygpIDogbnVsbDsKICAgICAgICAg\nICAgam9pbmVkU3VwZXJzID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCku\nYWRkQ2xhc3NDb25kaXRpb25zKHNlbCwKICAgICAgICAgICAgICAgIHN1YnMg\nPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUsIGpvaW5zKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGNyZWF0ZSBhbGwgb3VyIGVhZ2VyIHNlbGVjdHMgc28gdGhh\ndCB0aG9zZSBmaWVsZHMgYXJlIHJlc2VydmVkCiAgICAgICAgLy8gYW5kIGNh\nbm5vdCBiZSByZXVzZWQgZHVyaW5nIHRoZSBhY3R1YWwgZWFnZXIgc2VsZWN0\nIHByb2Nlc3MsCiAgICAgICAgLy8gcHJldmVudGluZyBpbmZpbml0ZSByZWN1\ncnNpb24KICAgICAgICBlYWdlciA9IE1hdGgubWluKGVhZ2VyLCBmZXRjaC5n\nZXRFYWdlckZldGNoTW9kZSgpKTsKICAgICAgICBGaWVsZE1hcHBpbmcgZWFn\nZXJUb01hbnkgPSBjcmVhdGVFYWdlclNlbGVjdHMoc2VsLCBtYXBwaW5nLCBz\nbSwgZmllbGRzLAogICAgICAgICAgICBmZXRjaCwgZWFnZXIpOwoKICAgICAg\nICAvLyBzZWxlY3QgYWxsIGJhc2UgY2xhc3MgbWFwcGluZ3M7IGRvIHRoaXMg\nYWZ0ZXIgYmF0Y2hpbmcgc28gdGhhdAogICAgICAgIC8vIHRoZSBqb2lucyBu\nZWVkZWQgYnkgdGhlc2Ugc2VsZWN0cyBkb24ndCBnZXQgaW4gdGhlIFdIRVJF\nIGNsYXVzZQogICAgICAgIC8vIG9mIHRoZSBiYXRjaGVkIHNlbGVjdHMKICAg\nICAgICBpbnQgc2VsZCA9IHNlbGVjdEJhc2VNYXBwaW5ncyhzZWwsIG1hcHBp\nbmcsIG1hcHBpbmcsIHNtLCBmaWVsZHMsCiAgICAgICAgICAgIGZldGNoLCBl\nYWdlciwgZWFnZXJUb01hbnksIGlkZW50LCBqb2luZWRTdXBlcnMpOwoKICAg\nICAgICAvLyBzZWxlY3QgZWFnZXIgdG8tbWFueSByZWxhdGlvbnMgbGFzdCBi\nZWNhdXNlIGR1cmluZyBsb2FkIHRoZXkKICAgICAgICAvLyBhZHZhbmNlIHRo\nZSByZXN1bHQgc2V0IGFuZCBjb3VsZCBleGhhdXN0IGl0LCBzbyBubyBvdGhl\nciBtYXBwaW5ncwogICAgICAgIC8vIGNhbiBsb2FkIGFmdGVyd29yZHMKICAg\nICAgICBpZiAoZWFnZXJUb01hbnkgIT0gbnVsbCkKICAgICAgICAgICAgZWFn\nZXJUb01hbnkuc2VsZWN0RWFnZXJKb2luKHNlbCwgc20sIHRoaXMsIAogICAg\nICAgICAgICAgICAgZmV0Y2gudHJhdmVyc2VKREJDKGVhZ2VyVG9NYW55KSwg\nZWFnZXIpOwoKICAgICAgICAvLyBvcHRpb25hbGx5IHNlbGVjdCBzdWJjbGFz\ncyBtYXBwaW5ncwogICAgICAgIGlmIChzdWJzID09IFNlbGVjdC5TVUJTX0pP\nSU5BQkxFIHx8IHN1YnMgPT0gU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxFKQog\nICAgICAgICAgICBzZWxlY3RTdWJjbGFzc01hcHBpbmdzKHNlbCwgbWFwcGlu\nZywgc20sIGZldGNoKTsKICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAg\nICAgICAgc2VsLnNldERpc3RpbmN0KGZhbHNlKTsKICAgICAgICByZXR1cm4g\nc2VsZCA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoZSBmaWVs\nZHMgb2YgdGhpcyBtYXBwaW5nIGFzIHJlc2VydmVkIHNvIHRoYXQgZWFnZXIg\nZmV0Y2hlcyBjYW4ndAogICAgICogZ2V0IGludG8gaW5maW5pdGUgcmVjdXJz\naXZlIHNpdHVhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgRmllbGRNYXBw\naW5nIGNyZWF0ZUVhZ2VyU2VsZWN0cyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBp\nbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBC\naXRTZXQgZmllbGRzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAog\nICAgICAgIGludCBlYWdlcikgewogICAgICAgIGlmIChtYXBwaW5nID09IG51\nbGwgfHwgZWFnZXIgPT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9O\nT05FKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRmllbGRN\nYXBwaW5nIGVhZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxlY3RzKHNlbCwg\nCiAgICAgICAgICAgIG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCksIHNtLCBmaWVsZHMsIGZldGNoLCBlYWdlcik7CgogICAgICAg\nIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICBib29sZWFuIGluRWFnZXJKb2luID0gc2Vs\nLmhhc0VhZ2VySm9pbihmYWxzZSk7CiAgICAgICAgaW50IHNlbHM7CiAgICAg\nICAgaW50IGp0eXBlOwogICAgICAgIGludCBtb2RlOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIG1vZGUgPSBmbXNbaV0uZ2V0RWFnZXJGZXRjaE1vZGUoKTsKICAgICAgICAg\nICAgaWYgKG1vZGUgPT0gZmV0Y2guRUFHRVJfTk9ORSkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoIXJlcXVpcmVzU2VsZWN0\nKGZtc1tpXSwgc20sIGZpZWxkcywgZmV0Y2gpKQogICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICAvLyB0cnkgdG8gc2VsZWN0IHdpdGgg\nam9pbiBmaXJzdAogICAgICAgICAgICBqdHlwZSA9IChmbXNbaV0uZ2V0TnVs\nbFZhbHVlKCkgPT0gZm1zW2ldLk5VTExfRVhDRVBUSU9OKSAKICAgICAgICAg\nICAgICAgID8gc2VsLkVBR0VSX0lOTkVSIDogc2VsLkVBR0VSX09VVEVSOwog\nICAgICAgICAgICBpZiAobW9kZSAhPSBmZXRjaC5FQUdFUl9QQVJBTExFTCAm\nJiAhZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKQogICAgICAgICAgICAg\nICAgJiYgZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwganR5cGUsIHNtLCB0\naGlzLCBmZXRjaCkgPiAwCiAgICAgICAgICAgICAgICAmJiBzZWwuZWFnZXJD\nbG9uZShmbXNbaV0sIGp0eXBlLCBmYWxzZSwgMSkgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgYm9vbGVhbiBoYXNK\nb2luID0gZmV0Y2guaGFzSm9pbihmbXNbaV0uZ2V0RnVsbE5hbWUoZmFsc2Up\nKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBkZWNsYXJlcyBhIHBy\nZWZlcnJlZCBzZWxlY3QgbW9kZSBvZiBqb2luIG9yIGRvZXMgbm90CiAgICAg\nICAgICAgIC8vIGhhdmUgYSBwcmVmZXJyZWQgbW9kZSBhbmQgd2UncmUgZG9p\nbmcgYSBieS1pZCBsb29rdXAsIHRyeQogICAgICAgICAgICAvLyB0byB1c2Ug\nYSB0by1tYW55IGpvaW4gYWxzby4gIGN1cnJlbnRseSB3ZSBsaW1pdCBlYWdl\ncgogICAgICAgICAgICAvLyBvdXRlciBqb2lucyB0byBub24tTFJTLCBub24t\ncmFuZ2VkIHNlbGVjdHMgdGhhdCBkb24ndCBhbHJlYWR5CiAgICAgICAgICAg\nIC8vIGhhdmUgYW4gZWFnZXIgdG8tbWFueSBqb2luCiAgICAgICAgICAgIGlm\nICgoaGFzSm9pbiB8fCBtb2RlID09IGZldGNoLkVBR0VSX0pPSU4gCiAgICAg\nICAgICAgICAgICB8fCAobW9kZSA9PSBmZXRjaC5ERUZBVUxUICYmIHNtICE9\nIG51bGwpKQogICAgICAgICAgICAgICAgJiYgZm1zW2ldLmlzRWFnZXJTZWxl\nY3RUb01hbnkoKQogICAgICAgICAgICAgICAgJiYgIWluRWFnZXJKb2luCiAg\nICAgICAgICAgICAgICAmJiAhc2VsLmhhc0VhZ2VySm9pbih0cnVlKQogICAg\nICAgICAgICAgICAgJiYgKCFzZWwuZ2V0QXV0b0Rpc3RpbmN0KCkgfHwgKCFz\nZWwuaXNMUlMoKQogICAgICAgICAgICAgICAgJiYgc2VsLmdldFN0YXJ0SW5k\nZXgoKSA9PSAwIAogICAgICAgICAgICAgICAgJiYgc2VsLmdldEVuZEluZGV4\nKCkgPT0gTG9uZy5NQVhfVkFMVUUpKQogICAgICAgICAgICAgICAgJiYgZm1z\nW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwganR5cGUsIHNtLCB0aGlzLCBmZXRj\naCkgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsLmVhZ2VyQ2xvbmUo\nZm1zW2ldLCBqdHlwZSwgdHJ1ZSwgMSkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBlYWdlclRvTWFueSA9IGZtc1tpXTsKICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gZmluYWxseSwgdHJ5IHBhcmFsbGVsCiAg\nICAgICAgICAgIGlmIChlYWdlciA9PSBmZXRjaC5FQUdFUl9QQVJBTExFTAog\nICAgICAgICAgICAgICAgJiYgKHNlbHMgPSBmbXNbaV0uc3VwcG9ydHNTZWxl\nY3Qoc2VsLCBzZWwuRUFHRVJfUEFSQUxMRUwsIHNtLAogICAgICAgICAgICAg\nICAgdGhpcywgZmV0Y2gpKSAhPSAwKQogICAgICAgICAgICAgICAgc2VsLmVh\nZ2VyQ2xvbmUoZm1zW2ldLCBTZWxlY3QuRUFHRVJfUEFSQUxMRUwsIAogICAg\nICAgICAgICAgICAgICAgIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCks\nIHNlbHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZWFnZXJUb01hbnk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGdpdmVu\nIGZpZWxkIG5lZWRzIHRvIGJlIHNlbGVjdGVkLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBib29sZWFuIHJlcXVpcmVzU2VsZWN0KEZpZWxkTWFwcGlu\nZyBmbSwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQg\nZmllbGRzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgaWYgKGZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmll\nbGRzLmdldChmbS5nZXRJbmRleCgpKTsKICAgICAgICBpZiAoc20gIT0gbnVs\nbCAmJiBzbS5nZXRQQ1N0YXRlKCkgIT0gUENTdGF0ZS5UUkFOU0lFTlQKICAg\nICAgICAgICAgJiYgc20uZ2V0TG9hZGVkKCkuZ2V0KGZtLmdldEluZGV4KCkp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIGZl\ndGNoLnJlcXVpcmVzRmV0Y2goZm0pID09IEZldGNoQ29uZmlndXJhdGlvbi5G\nRVRDSF9MT0FEOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBm\naWVsZCBtYXBwaW5ncyBvZiB0aGUgZ2l2ZW4gY2xhc3MgYW5kIGFsbCBpdHMg\nc3VwZXJjbGFzc2VzLgogICAgICoKICAgICAqIEBwYXJhbSBzZWwgdGhlIHNl\nbGVjdCB0byB1c2UKICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtb3N0LWRl\ncml2ZWQgdHlwZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gb3JpZyB0\naGUgb3JpZ2luYWwgbWFwcGluZyB0eXBlIHNlbGVjdGVkCiAgICAgKiBAcGFy\nYW0gc20gdGhlIGluc3RhbmNlIGJlaW5nIHNlbGVjdGVkIGZvciwgb3IgbnVs\nbCBpZiBub25lCiAgICAgKiBAcGFyYW0gZmllbGRzIHRoZSBmaWVsZHMgdG8g\nbG9hZAogICAgICogQHBhcmFtIGZldGNoIGZldGNoIGNvbmZpZ3VyYXRpb24g\ndG8gdXNlIGZvciBsb2FkaW5nIHJlbGF0aW9ucwogICAgICogQHBhcmFtIGVh\nZ2VyIHRoZSBlYWdlciBmZXRjaCBtb2RlIHRvIHVzZQogICAgICogQHBhcmFt\nIGpvaW5lZCB3aGV0aGVyIHRoZSBjbGFzcyBoYXMgYWxyZWFkeSBiZWVuIGpv\naW5lZCBkb3duIHRvCiAgICAgKiBpdHMgYmFzZSBjbGFzcwogICAgICogQHJl\ndHVybiAmZ3Q7IDAgaWYgdGhlIHNlbGVjdCBpcyByZXF1aXJlZCwgMCBpZiBk\nYXRhIHdhcwogICAgICogc2VsZWN0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZCwg\nYW5kICZsdDsgMCBpZiBub3RoaW5nIHdhcyBzZWxlY3RlZAogICAgICovCiAg\nICBwcml2YXRlIGludCBzZWxlY3RCYXNlTWFwcGluZ3MoU2VsZWN0IHNlbCwg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG9y\naWcsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nLCBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnksCiAgICAgICAgYm9vbGVhbiBp\nZGVudCwgYm9vbGVhbiBqb2luZWQpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\ncGFyZW50ID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKTsKICAgICAgICBpZiAocGFyZW50ID09IG51bGwgJiYgIW1hcHBpbmcu\naXNNYXBwZWQoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgidmlydHVhbC1tYXBwaW5nIiwgbWFwcGlu\nZy4KICAgICAgICAgICAgICAgIGdldERlc2NyaWJlZFR5cGUoKSkpOwoKICAg\nICAgICBpbnQgc2VsZCA9IC0xOwogICAgICAgIGludCBwc2VsZCA9IC0xOwoK\nICAgICAgICAvLyBiYXNlIGNsYXNzIHNlbGVjdHMgcGtzLCBldGMKICAgICAg\nICBpZiAocGFyZW50ID09IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgbm8g\naW5zdGFuY2UsIHNlbGVjdCBwa3MKICAgICAgICAgICAgaWYgKHNtID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGlmIChpZGVudCkKICAgICAgICAgICAg\nICAgICAgICBzZWwuc2VsZWN0SWRlbnRpZmllcihtYXBwaW5nLmdldFByaW1h\ncnlLZXlDb2x1bW5zKCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHNlbC5zZWxlY3QobWFwcGluZy5nZXRQcmltYXJ5S2V5\nQ29sdW1ucygpKTsKICAgICAgICAgICAgICAgIHNlbGQgPSAxOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBpZiBubyBpbnN0YW5jZSBvciBub3Qg\naW5pdGlhbGl6ZWQgYW5kIG5vdCBleGFjdCBvaWQsIHNlbGVjdCB0eXBlCiAg\nICAgICAgICAgIGlmICgoc20gPT0gbnVsbCB8fCAoc20uZ2V0UENTdGF0ZSgp\nID09IFBDU3RhdGUuVFJBTlNJRU5UIAogICAgICAgICAgICAgICAgJiYgKCEo\nc20uZ2V0T2JqZWN0SWQoKSBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgCiAgICAg\nICAgICAgICAgICB8fCAoKE9wZW5KUEFJZCkgc20uZ2V0T2JqZWN0SWQoKSku\naGFzU3ViY2xhc3NlcygpKSkpCiAgICAgICAgICAgICAgICAmJiBtYXBwaW5n\nLmdldERpc2NyaW1pbmF0b3IoKS5zZWxlY3Qoc2VsLCBvcmlnKSkKICAgICAg\nICAgICAgICAgIHNlbGQgPSAxOwoKICAgICAgICAgICAgLy8gaWYgbm8gaW5z\ndGFuY2Ugb3Igbm8gdmVyc2lvbiwgc2VsZWN0IHZlcnNpb24KICAgICAgICAg\nICAgaWYgKChzbSA9PSBudWxsIHx8IHNtLmdldFZlcnNpb24oKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXRWZXJzaW9uKCkuc2Vs\nZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWN1cnNlIG9uIHBhcmVu\ndAogICAgICAgICAgICBwc2VsZCA9IHNlbGVjdEJhc2VNYXBwaW5ncyhzZWws\nIHBhcmVudCwgb3JpZywgc20sIGZpZWxkcywKICAgICAgICAgICAgICAgIGZl\ndGNoLCBlYWdlciwgZWFnZXJUb01hbnksIGlkZW50LCBqb2luZWQpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gc2VsZWN0IHRoZSBtYXBwaW5ncyBpbiB0aGUg\nZ2l2ZW4gZmllbGRzIHNldCwgb3IgYmFzZWQgb24gZmV0Y2gKICAgICAgICAv\nLyBjb25maWd1cmF0aW9uIGlmIG5vIGZpZWxkcyBnaXZlbgogICAgICAgIEZp\nZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICBTZWxlY3RFeGVjdXRvciBlc2VsOwogICAgICAg\nIGludCBmc2VsZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBza2lwIGVhZ2VyIHRvLW1h\nbnkgc2VsZWN0OyB3ZSBkbyB0aGF0IHNlcGFyYXRlbHkgaW4gY2FsbGluZwog\nICAgICAgICAgICAvLyBtZXRob2QKICAgICAgICAgICAgaWYgKGZtc1tpXSA9\nPSBlYWdlclRvTWFueSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgLy8gY2hlY2sgZm9yIGVhZ2VyIHNlbGVjdAogICAgICAgICAg\nICBlc2VsID0gc2VsLmdldEVhZ2VyKGZtc1tpXSk7CiAgICAgICAgICAgIGlm\nIChlc2VsICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChlc2VsID09\nIHNlbCkKICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJK\nb2luKHNlbCwgc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAgIAlmZXRj\naC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5zZWxlY3RFYWdl\nclBhcmFsbGVsKGVzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAg\nICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAg\nICAgICAgICAgIHNlbGQgPSBNYXRoLm1heCgwLCBzZWxkKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChyZXF1aXJlc1NlbGVjdChmbXNbaV0sIHNtLCBmaWVs\nZHMsIGZldGNoKSkgewogICAgICAgICAgICAgICAgZnNlbGQgPSBmbXNbaV0u\nc2VsZWN0KHNlbCwgc20sIHRoaXMsIAogICAgICAgICAgICAgICAgCWZldGNo\nLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAg\nICBzZWxkID0gTWF0aC5tYXgoZnNlbGQsIHNlbGQpOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKG9wdFNlbGVjdChmbXNbaV0sIHNlbCwgc20sIGZldGNoKSkg\newogICAgICAgICAgICAgICAgZnNlbGQgPSBmbXNbaV0uc2VsZWN0KHNlbCwg\nc20sIHRoaXMsIAogICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRC\nQyhmbXNbaV0pLCBmZXRjaC5FQUdFUl9OT05FKTsKCiAgICAgICAgICAgICAg\nICAvLyBkb24ndCB1cGdyYWRlIHNlbGQgdG8gPiAwIGJhc2VkIG9uIHRoZXNl\nIGZpZWxkcywgc2luY2UKICAgICAgICAgICAgICAgIC8vIHRoZXkncmUgbm90\nIGluIHRoZSBjYWxjdWxhdGVkIGZpZWxkIHNldAogICAgICAgICAgICAgICAg\naWYgKGZzZWxkID49IDAgJiYgc2VsZCA8IDApCiAgICAgICAgICAgICAgICAg\nICAgc2VsZCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIGpvaW4gdG8gcGFyZW50IHRhYmxlIGlmIHRoZSBwYXJlbnQgLyBhbnkg\nYW5jZXN0b3JzIGhhdmUgc2VsZWN0ZWQKICAgICAgICAvLyBhbnl0aGluZwog\nICAgICAgIGlmICgham9pbmVkICYmIHBzZWxkID49IDAgJiYgcGFyZW50Lmdl\ndFRhYmxlKCkgIT0gbWFwcGluZy5nZXRUYWJsZSgpKQogICAgICAgICAgICBz\nZWwud2hlcmUobWFwcGluZy5qb2luU3VwZXJjbGFzcyhzZWwubmV3Sm9pbnMo\nKSwgZmFsc2UpKTsKCiAgICAgICAgLy8gcmV0dXJuIHRoZSBoaWdoZXN0IHZh\nbHVlCiAgICAgICAgcmV0dXJuIE1hdGgubWF4KHBzZWxkLCBzZWxkKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZW4gc2VsZWN0aW5nIGZpZWxkZXMsIGEg\nc3BlY2lhbCBjYXNlIGlzIG1hZGUgZm9yIG1hcHBpbmdzIHRoYXQgdXNlCiAg\nICAgKiAyLXBhcnQgc2VsZWN0cyB0aGF0IGFyZW4ndCBleHBsaWNpdGx5ICpu\nb3QqIGluIHRoZSBkZmcgc28gdGhhdCB0aGV5CiAgICAgKiBjYW4gZ2V0IHRo\nZWlyIHByaW1hcnkgdGFibGUgZGF0YS4gVGhpcyBtZXRob2QgdGVzdHMgZm9y\nIHRoYXQgc3BlY2lhbAogICAgICogY2FzZSBhcyBhbiBvcHRpbWl6YXRpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBvcHRTZWxlY3QoRmllbGRN\nYXBwaW5nIGZtLCBTZWxlY3Qgc2VsLAogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAg\nICAgICByZXR1cm4gIWZtLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAg\nICAgICAgICAmJiAhZm0uaXNEZWZhdWx0RmV0Y2hHcm91cEV4cGxpY2l0KCkK\nICAgICAgICAgICAgJiYgKHNtID09IG51bGwgfHwgc20uZ2V0UENTdGF0ZSgp\nID09IFBDU3RhdGUuVFJBTlNJRU5UIAogICAgICAgICAgICB8fCAhc20uZ2V0\nTG9hZGVkKCkuZ2V0KGZtLmdldEluZGV4KCkpKQogICAgICAgICAgICAmJiBm\nbS5zdXBwb3J0c1NlbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwg\ndGhpcywgZmV0Y2gpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVj\ndCBmaWVsZCBtYXBwaW5ncyB0aGF0IG1hdGNoIHRoZSBnaXZlbiBmZXRjaCBj\nb25maWd1cmF0aW9uIGZvcgogICAgICogc3ViY2xhc3NlcyBvZiB0aGUgZ2l2\nZW4gdHlwZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3Qg\ndG8gdXNlCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgdHlwZSB3aG9zZSBz\ndWJjbGFzc2VzIHRvIHNlbGVjdAogICAgICogQHBhcmFtIHNtIHRoZSBpbnN0\nYW5jZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYgbm9uZQogICAg\nICogQHBhcmFtIGZldGNoIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBzZWxlY3RTdWJjbGFzc01hcHBpbmdzKFNl\nbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICBsb2FkU3ViY2xhc3NlcyhtYXBwaW5nKTsKICAgICAg\nICBDbGFzc01hcHBpbmdbXSBzdWJNYXBwaW5ncyA9IG1hcHBpbmcuZ2V0Sm9p\nbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsKICAgICAgICBpZiAoc3ViTWFw\ncGluZ3MubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gc2VsZWN0IGFsbCBzdWJjbGFzcyBtYXBwaW5ncyB0aGF0IG1hdGNo\nIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uCiAgICAgICAgLy8gYW5kIHdob3Nl\nIHRhYmxlIGlzIGluIHRoZSBsaXN0IG9mIHRob3NlIHNlbGVjdGVkIHNvIGZh\ncjsgdGhpcwogICAgICAgIC8vIHdheSB3ZSBzZWxlY3QgdGhlIG1heCBwb3Nz\naWJsZSB3aXRob3V0IHNlbGVjdGluZyBhbnkgdGFibGVzIHRoYXQKICAgICAg\nICAvLyBhcmVuJ3QgcHJlc2VudCBpbiBhbGwgcG9zc2libGUgcXVlcnkgbWF0\nY2hlczsgYSBzcGVjaWFsIGNhc2UKICAgICAgICAvLyBpcyBtYWRlIGZvciBt\nYXBwaW5ncyB0aGF0IHVzZSAyLXBhcnQgc2VsZWN0cyB0aGF0IGFyZW4ndAog\nICAgICAgIC8vIGV4cGxpY2l0bHkgKm5vdCogaW4gdGhlIGRlZmF1bHQgc28g\ndGhhdCB0aGV5IGNhbiBnZXQgdGhlaXIKICAgICAgICAvLyBwcmltYXJ5IHRh\nYmxlIGRhdGEKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXM7CiAgICAgICAg\nYm9vbGVhbiBqb2luZWQ7CiAgICAgICAgYm9vbGVhbiBjYW5Kb2luID0gX2Rp\nY3Quam9pblN5bnRheCAhPSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElP\nTkFMCiAgICAgICAgICAgICYmIGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2Rl\nKG1hcHBpbmcpICE9IGZldGNoLkVBR0VSX05PTkU7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdWJNYXBwaW5ncy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoIXN1Yk1hcHBpbmdzW2ldLnN1cHBvcnRzRWFnZXJTZWxl\nY3Qoc2VsLCBzbSwgdGhpcywgbWFwcGluZywKICAgICAgICAgICAgICAgIGZl\ndGNoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nLy8gaW5pdGlhbGl6ZSBzbyB0aGF0IGlmIHdlIGNhbid0IGpvaW4sIHdlIHBy\nZXRlbmQgd2UgYWxyZWFkeSBoYXZlCiAgICAgICAgICAgIGpvaW5lZCA9ICFj\nYW5Kb2luOwogICAgICAgICAgICBmbXMgPSBzdWJNYXBwaW5nc1tpXS5nZXRE\nZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBq\nID0gMDsgaiA8IGZtcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIGluIG9uZSBvZiBjb25maWd1cmVkIGZldGNoIGdyb3Vw\ncwogICAgICAgICAgICAJaWYgKGZldGNoLnJlcXVpcmVzRmV0Y2goZm1zW2pd\nKSAhPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTE9BRAogICAgICAgICAg\nICAgICAgICAgICYmICgoIWZtc1tqXS5pc0luRGVmYXVsdEZldGNoR3JvdXAo\nKSAKICAgICAgICAgICAgICAgICAgICAmJiBmbXNbal0uaXNEZWZhdWx0RmV0\nY2hHcm91cEV4cGxpY2l0KCkpCiAgICAgICAgICAgICAgICAgICAgfHwgZm1z\nW2pdLnN1cHBvcnRzU2VsZWN0KHNlbCwgc2VsLlRZUEVfVFdPX1BBUlQsIHNt\nLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICBmZXRjaCkgPD0gMCkpIAog\nICAgICAgICAgICAJCWNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIC8vIGlm\nIHdlIGNhbiBqb2luIHRvIHRoZSBzdWJjbGFzcywgZG8gc287IG11Y2ggYmV0\ndGVyIGNoYW5jZQogICAgICAgICAgICAgICAgLy8gdGhhdCB0aGUgZmllbGQg\nd2lsbCBiZSBhYmxlIHRvIHNlbGVjdCBpdHNlbGYgd2l0aG91dCBqb2lucwog\nICAgICAgICAgICAgICAgaWYgKCFqb2luZWQpIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBtYXJrIGpvaW5lZCB3aGV0aGVyIG9yIG5vdCB3ZSBqb2luLCBz\nbyB3ZSBkb24ndCBoYXZlIHRvCiAgICAgICAgICAgICAgICAgICAgLy8gdGVz\ndCBjb25kaXRpb25zIGFnYWluIGZvciB0aGlzIHN1YmNsYXNzCiAgICAgICAg\nICAgICAgICAgICAgam9pbmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAg\nICBzZWwud2hlcmUoam9pblN1YmNsYXNzKHNlbCwgbWFwcGluZywgc3ViTWFw\ncGluZ3NbaV0sIG51bGwpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAvLyBpZiBjYW4gc2VsZWN0IHdpdGggdGFibGVzIGFscmVhZHkg\nc2VsZWN0ZWQsIGRvIGl0CiAgICAgICAgICAgICAgICBpZiAoZm1zW2pdLnN1\ncHBvcnRzU2VsZWN0KHNlbCwgc2VsLlRZUEVfSk9JTkxFU1MsIHNtLCB0aGlz\nLAogICAgICAgICAgICAgICAgICAgIGZldGNoKSA+IDApCiAgICAgICAgICAg\nICAgICAgICAgZm1zW2pdLnNlbGVjdChzZWwsIG51bGwsIHRoaXMsIGZldGNo\nLnRyYXZlcnNlSkRCQyhmbXNbal0pLAogICAgICAgICAgICAgICAgICAgICAg\nICBmZXRjaC5FQUdFUl9OT05FKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gam9pbiBm\ncm9tIGNsYXNzIHRvIGl0cyBzdWJjbGFzcy4gUmVjdXJzaXZlIHRvIGFsbG93\nCiAgICAgKiBmb3IgbXVsdGlwbGUgaG9wcywgc3RhcnRpbmcgZnJvbSB0aGUg\nYmFzZSBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSm9pbnMg\nam9pblN1YmNsYXNzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBiYXNlLAog\nICAgICAgIENsYXNzTWFwcGluZyBzdWIsIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgaWYgKHN1YiA9PSBiYXNlIHx8IHN1Yi5nZXRUYWJsZSgpID09IGJhc2Uu\nZ2V0VGFibGUoKQogICAgICAgICAgICB8fCBzZWwuaXNTZWxlY3RlZChzdWIu\nZ2V0VGFibGUoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAvLyByZWN1cnNlIGZpcnN0IHNvIHdlIGdvIGxlYXN0LT5tb3N0IGRlcml2\nZWQKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gc3ViLmdldEpvaW5hYmxl\nUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGpvaW5zID0gam9pblN1\nYmNsYXNzKHNlbCwgYmFzZSwgc3VwLCBqb2lucyk7CiAgICAgICAgaWYgKGpv\naW5zID09IG51bGwpCiAgICAgICAgICAgIGpvaW5zID0gc2VsLm5ld0pvaW5z\nKCk7CiAgICAgICAgcmV0dXJuIHN1Yi5qb2luU3VwZXJjbGFzcyhqb2lucywg\ndHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlcyBzdXJlIGFsbCBz\ndWJjbGFzc2VzIG9mIHRoZSBnaXZlbiB0eXBlIGFyZSBsb2FkZWQgaW4gdGhl\nIEpWTS4KICAgICAqIFRoaXMgaXMgdXN1YWxseSBkb25lIGF1dG9tYXRpY2Fs\nbHkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGxvYWRTdWJjbGFzc2VzKENs\nYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgRGlzY3JpbWluYXRvciBk\nc2MgPSBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICBpZiAo\nZHNjLmdldFN1YmNsYXNzZXNMb2FkZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyBpZiB0aGUgc3ViY2xhc3MgbGlzdCBpcyBzZXQsIG5v\nIG5lZWQgdG8gbG9hZCBzdWJzCiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0UmVw\nb3NpdG9yeSgpLmdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsCiAgICAg\nICAgICAgIF9jdHguZ2V0Q2xhc3NMb2FkZXIoKSkgIT0gbnVsbCkgewogICAg\nICAgICAgICBkc2Muc2V0U3ViY2xhc3Nlc0xvYWRlZCh0cnVlKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZHNjLmxvYWRTdWJjbGFzc2VzKHRoaXMpOwogICAgICAgIH0gY2F0\nY2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNR\nTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHRoZSBzdGF0ZW1lbnQgYSBjYW5k\naWRhdGUgZm9yIGNhbmNlbGxhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB7\nCiAgICAgICAgX3N0bW50cy5hZGQoc3RtbnQpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIHRoZSBzdGF0ZW1lbnQgZnJvbSB0aGUgY2FuY2VsbGFi\nbGUgc2V0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWZ0ZXJFeGVjdXRl\nU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIF9zdG1udHMu\ncmVtb3ZlKHN0bW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbm5lY3Rp\nb24gcmV0dXJuZWQgdG8gY2xpZW50IGNvZGUuIE1ha2VzIHN1cmUgaXRzIHdy\nYXBwZWQgY29ubmVjdGlvbgogICAgICogcmVmIGNvdW50IGlzIGRlY3JlbWVu\ndGVkIG9uIGZpbmFsaXplLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBDbGllbnRDb25uZWN0aW9uIGV4dGVuZHMgRGVsZWdhdGluZ0Nvbm5l\nY3Rpb24gewoKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX2Nsb3NlZCA9IGZh\nbHNlOwoKICAgICAgICBwdWJsaWMgQ2xpZW50Q29ubmVjdGlvbihDb25uZWN0\naW9uIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICBfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAg\nICAgc3VwZXIuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCB2b2lkIGZpbmFsaXplKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIGlmICghX2Nsb3NlZCkKICAgICAgICAgICAgICAgIGNsb3NlKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiB3\ncmFwcGVyIHRoYXQga2VlcHMgYW4gaW50ZXJuYWwgcmVmIGNvdW50IHNvIHRo\nYXQgaXQga25vd3MKICAgICAqIHdoZW4gdG8gcmVhbGx5IGNsb3NlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgY2xhc3MgUmVmQ291bnRDb25uZWN0aW9uIGV4\ndGVuZHMgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gewoKICAgICAgICBwcml2YXRl\nIGJvb2xlYW4gX3JldGFpbiA9IGZhbHNlOwogICAgICAgIHByaXZhdGUgaW50\nIF9yZWZzID0gMDsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX2ZyZWVkID0g\nZmFsc2U7CgogICAgICAgIHB1YmxpYyBSZWZDb3VudENvbm5lY3Rpb24oQ29u\nbmVjdGlvbiBjb25uKSB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4pOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZ2V0UmV0YWluKCkgewog\nICAgICAgICAgICByZXR1cm4gX3JldGFpbjsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHNldFJldGFpbihib29sZWFuIHJldGFpbikgewogICAg\nICAgICAgICBpZiAoX3JldGFpbiAmJiAhcmV0YWluICYmIF9yZWZzIDw9IDAp\nCiAgICAgICAgICAgICAgICBmcmVlKCk7CiAgICAgICAgICAgIF9yZXRhaW4g\nPSByZXRhaW47CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByZWYo\nKSB7CiAgICAgICAgICAgIC8vIGRvbid0IGhhdmUgdG8gbG9jazsgY2FsbGVk\nIGZyb20gY29ubmVjdCgpLCB3aGljaCBpcyBsb2NrZWQKICAgICAgICAgICAg\nX3JlZnMrKzsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsb3Nl\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIC8vIGxvY2sg\nYXQgYnJva2VyIGxldmVsIHRvIGF2b2lkIGRlYWRsb2NrcwogICAgICAgICAg\nICBfY3R4LmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIF9yZWZzLS07CiAgICAgICAgICAgICAgICBpZiAoX3JlZnMgPD0gMCAm\nJiAhX3JldGFpbikKICAgICAgICAgICAgICAgICAgICBmcmVlKCk7CiAgICAg\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBfY3R4LnVubG9j\naygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBmcmVlKCkgewogICAgICAgICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBk\nbyBub3QgY2xvc2UgdGhlIHVuZGVybHlpbmcgY29ubmVjdGlvbgogICAgICAg\nICAgICAvLyBtdWx0aXBsZSB0aW1lczsgdGhpcyBjb3VsZCBoYXBwZW4gaWYg\nc29tZW9uZSAoZS5nLiwgYW4KICAgICAgICAgICAgLy8gRXh0ZW50KSBob2xk\ncyBhIFJlZkNvbm5lY3Rpb24sIGFuZCB0aGVuIGNsb3NlcyBpdCAoZS5nLiwg\naW4KICAgICAgICAgICAgLy8gdGhlIGZpbmFsaXplcikgYWZ0ZXIgdGhlIFN0\nb3JlTWFuYWdlciBoYXMgYWxyZWFkeSBiZWVuIGNsb3NlZC4KICAgICAgICAg\nICAgaWYgKF9mcmVlZCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnZXREZWxlZ2F0ZSgpLmNs\nb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB9CiAgICAgICAgICAgIF9mcmVlZCA9IHRydWU7CiAg\nICAgICAgICAgIF9jb25uID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGJvb2xlYW4gd3Jh\ncCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgQ2FuY2VsU3RhdGVtZW50KHN1cGVyLmNyZWF0ZVN0YXRlbWVudChmYWxz\nZSksCiAgICAgICAgICAgICAgICBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7\nCiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0\nZVN0YXRlbWVudChpbnQgcnNUeXBlLCBpbnQgcnNDb25jdXIsCiAgICAgICAg\nICAgIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHJldHVybiBuZXcgQ2FuY2VsU3RhdGVtZW50KHN1cGVyLmNyZWF0\nZVN0YXRlbWVudChyc1R5cGUsIHJzQ29uY3VyLAogICAgICAgICAgICAgICAg\nZmFsc2UpLCBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0\nYXRlbWVudChTdHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3\nIENhbmNlbFByZXBhcmVkU3RhdGVtZW50KHN1cGVyLnByZXBhcmVTdGF0ZW1l\nbnQoc3FsLAogICAgICAgICAgICAgICAgZmFsc2UpLCBSZWZDb3VudENvbm5l\nY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUHJl\ncGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLCBp\nbnQgcnNUeXBlLAogICAgICAgICAgICBpbnQgcnNDb25jdXIsIGJvb2xlYW4g\nd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVy\nbiBuZXcgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQoc3VwZXIucHJlcGFyZVN0\nYXRlbWVudChzcWwsCiAgICAgICAgICAgICAgICByc1R5cGUsIHJzQ29uY3Vy\nLCBmYWxzZSksIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdGF0ZW1lbnQgdHlwZSB0aGF0IGFk\nZHMgYW5kIHJlbW92ZXMgaXRzZWxmIGZyb20gdGhlIHNldCBvZiBhY3RpdmUK\nICAgICAqIHN0YXRlbWVudHMgc28gdGhhdCBpdCBjYW4gYmUgY2FuY2VsZWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgQ2FuY2VsU3RhdGVtZW50IGV4\ndGVuZHMgRGVsZWdhdGluZ1N0YXRlbWVudCB7CgogICAgICAgIHB1YmxpYyBD\nYW5jZWxTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50LCBDb25uZWN0aW9uIGNv\nbm4pIHsKICAgICAgICAgICAgc3VwZXIoc3RtbnQsIGNvbm4pOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBz\ncWwpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVF\neGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoc3FsKTsK\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVy\nRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnko\nU3RyaW5nIHNxbCwgYm9vbGVhbiB3cmFwKQogICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRl\nbWVudCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBlci5leGVjdXRlUXVlcnkoc3FsLCB3cmFwKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0\nZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFN0YXRlbWVudCB0eXBlIHRoYXQgYWRkcyBh\nbmQgcmVtb3ZlcyBpdHNlbGYgZnJvbSB0aGUgc2V0IG9mIGFjdGl2ZQogICAg\nICogc3RhdGVtZW50cyBzbyB0aGF0IGl0IGNhbiBiZSBjYW5jZWxlZC4KICAg\nICAqLwogICAgcHJpdmF0ZSBjbGFzcyBDYW5jZWxQcmVwYXJlZFN0YXRlbWVu\ndCBleHRlbmRzIERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudCB7CgogICAg\nICAgIHB1YmxpYyBDYW5jZWxQcmVwYXJlZFN0YXRlbWVudChQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgCiAgICAgICAgICAgIENvbm5lY3Rpb24gY29ubikg\newogICAgICAgICAgICBzdXBlcihzdG1udCwgY29ubik7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IGV4ZWN1dGVVcGRhdGUoKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVu\ndCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5leGVjdXRlVXBkYXRlKCk7CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQo\ndGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KGJvb2xlYW4gd3JhcCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVT\ndGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVF1ZXJ5KHdyYXApOwogICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRl\nU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgaW50W10gZXhlY3V0ZUJhdGNoKCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQo\ndGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZXhlY3V0ZUJhdGNoKCk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhp\ncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

