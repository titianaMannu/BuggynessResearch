{"sha":"8e1f589678156437bf53c4567d6e0f917f71263c","node_id":"MDQ6QmxvYjIwNjM2NDo4ZTFmNTg5Njc4MTU2NDM3YmY1M2M0NTY3ZDZlMGY5MTdmNzEyNjNj","size":27722,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8e1f589678156437bf53c4567d6e0f917f71263c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuRXhwQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5leHBzLkdldENvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNFeHByZXNzaW9uRmFjdG9y\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkpEQkNTdHJpbmdDb250YWluczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNXaWxkY2FyZE1hdGNoOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuUXVlcnlFeHBy\nZXNzaW9uc1N0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLmV4cHMuU1FMRW1iZWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5TUUxFeHByZXNzaW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuU1FMVmFsdWU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGlu\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5z\ndHJhdHMuVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlVuaW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3JkZXJpbmdNZXJn\nZWRSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuUXVlcnlIaW50czsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uRmFjdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uUGFyc2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkZpbHRl\nckxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLlF1ZXJ5RXhwcmVzc2lvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5NZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJhbmdlUmVzdWx0T2JqZWN0\nUHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5S\nZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVt\nYmVyczsKCi8qKgogKiBKREJDIHF1ZXJ5IGltcGxlbWVudGF0aW9uLgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMg\nY2xhc3MgSkRCQ1N0b3JlUXVlcnkgCiAgICBleHRlbmRzIEV4cHJlc3Npb25T\ndG9yZVF1ZXJ5IHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBUYWJsZSBJ\nTlZBTElEID0gbmV3IFRhYmxlKCk7CgogICAgLy8gYWRkIGFsbCBzdGFuZGFy\nZCBmaWx0ZXIgYW5kIGFnZ3JlZ2F0ZSBsaXN0ZW5lcnMgdG8gdGhlc2UgbWFw\ncwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwIF9saXN0ZW5lcnMgPSBu\nZXcgSGFzaE1hcCgpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgLy8gZGVwcmVj\nYXRlZCBleHRlbnNpb25zCiAgICAgICAgX2xpc3RlbmVycy5wdXQoSkRCQ1N0\ncmluZ0NvbnRhaW5zLlRBRywgbmV3IEpEQkNTdHJpbmdDb250YWlucygpKTsK\nICAgICAgICBfbGlzdGVuZXJzLnB1dChKREJDV2lsZGNhcmRNYXRjaC5UQUcs\nIG5ldyBKREJDV2lsZGNhcmRNYXRjaCgpKTsKICAgICAgICBfbGlzdGVuZXJz\nLnB1dChTUUxFeHByZXNzaW9uLlRBRywgbmV3IFNRTEV4cHJlc3Npb24oKSk7\nCiAgICAgICAgX2xpc3RlbmVycy5wdXQoU1FMVmFsdWUuVEFHLCBuZXcgU1FM\nVmFsdWUoKSk7CgogICAgICAgIC8vIGpkYmMtc3BlY2lmaWMgZXh0ZW5zaW9u\ncwogICAgICAgIF9saXN0ZW5lcnMucHV0KEdldENvbHVtbi5UQUcsIG5ldyBH\nZXRDb2x1bW4oKSk7CiAgICAgICAgX2xpc3RlbmVycy5wdXQoU1FMRW1iZWQu\nVEFHLCBuZXcgU1FMRW1iZWQoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBmaW5h\nbCB0cmFuc2llbnQgSkRCQ1N0b3JlIF9zdG9yZTsKCiAgICAvKioKICAgICAq\nIENvbnN0cnVjdG9yLiBTdXBwbHkgc3RvcmUgbWFuYWdlci4KICAgICAqLwog\nICAgcHVibGljIEpEQkNTdG9yZVF1ZXJ5KEpEQkNTdG9yZSBzdG9yZSwgRXhw\ncmVzc2lvblBhcnNlciBwYXJzZXIpIHsKICAgICAgICBzdXBlcihwYXJzZXIp\nOwogICAgICAgIF9zdG9yZSA9IHN0b3JlOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBzdG9yZS4KICAgICAqLwogICAgcHVibGljIEpEQkNT\ndG9yZSBnZXRTdG9yZSgpIHsKICAgICAgICByZXR1cm4gX3N0b3JlOwogICAg\nfQoKICAgIHB1YmxpYyBGaWx0ZXJMaXN0ZW5lciBnZXRGaWx0ZXJMaXN0ZW5l\ncihTdHJpbmcgdGFnKSB7CiAgICAgICAgcmV0dXJuIChGaWx0ZXJMaXN0ZW5l\ncikgX2xpc3RlbmVycy5nZXQodGFnKTsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IG5ld0NvbXBpbGF0aW9uS2V5KCkgewogICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2ggPSAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikg\nY3R4CiAgICAgICAgICAgIC5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAg\nICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZldGNoLmdldEpvaW5TeW50\nYXgoKSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNEYXRh\nU3RvcmVFeGVjdXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGFbXSBnZXRJbmRlcGVuZGVu\ndEV4cHJlc3Npb25DYW5kaWRhdGVzKAogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSwgYm9vbGVhbiBzdWJjbGFzc2VzKSB7CiAgICAgICAgaWYgKCFzdWJj\nbGFzc2VzKQogICAgICAgICAgICByZXR1cm4gbmV3IENsYXNzTWFwcGluZ1td\nIHsgKENsYXNzTWFwcGluZykgbWV0YSB9OwogICAgICAgIHJldHVybiAoKENs\nYXNzTWFwcGluZykgbWV0YSkuZ2V0SW5kZXBlbmRlbnRBc3NpZ25hYmxlTWFw\ncGluZ3MoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRXhwcmVzc2lvbkZhY3Rv\ncnkgZ2V0RXhwcmVzc2lvbkZhY3RvcnkoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBKREJDRXhwcmVzc2lvbkZhY3RvcnkoKENs\nYXNzTWFwcGluZykgbWV0YSk7CiAgICB9CgogICAgcHJvdGVjdGVkIFJlc3Vs\ndE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVRdWVyeShFeGVjdXRvciBleCwKICAg\nICAgICBDbGFzc01ldGFEYXRhIGJhc2UsIENsYXNzTWV0YURhdGFbXSBtZXRh\ncywgYm9vbGVhbiBzdWJjbGFzc2VzLAogICAgICAgIEV4cHJlc3Npb25GYWN0\nb3J5W10gZmFjdHMsIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLCBPYmplY3Rb\nXSBwYXJhbXMsCiAgICAgICAgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICBpZiAo\nbWV0YXMubGVuZ3RoID4gMSAmJiBleHBzWzBdLmlzQWdncmVnYXRlKCkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKExvY2FsaXplci5m\nb3JQYWNrYWdlKEpEQkNTdG9yZVF1ZXJ5LmNsYXNzKS4KICAgICAgICAgICAg\nICAgIGdldCgibXVsdC1tYXBwaW5nLWFnZ3JlZ2F0ZSIsIEFycmF5cy5hc0xp\nc3QobWV0YXMpKSk7CgogICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdz\nID0gKENsYXNzTWFwcGluZ1tdKSBtZXRhczsKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24p\nIAogICAgICAgICAgICBjdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgaWYgKGV4cHNbMF0uZmV0Y2hQYXRocyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGZldGNoLmFkZEZpZWxkcyhBcnJheXMuYXNMaXN0KGV4cHNbMF0u\nZmV0Y2hQYXRocykpOwogICAgICAgICAgICBmZXRjaC5hZGRKb2lucyhBcnJh\neXMuYXNMaXN0KGV4cHNbMF0uZmV0Y2hQYXRocykpOwogICAgICAgIH0KICAg\nICAgICBpZiAoZXhwc1swXS5mZXRjaElubmVyUGF0aHMgIT0gbnVsbCkKICAg\nICAgICAgICAgZmV0Y2guYWRkRmV0Y2hJbm5lckpvaW5zKEFycmF5cy5hc0xp\nc3QoZXhwc1swXS5mZXRjaElubmVyUGF0aHMpKTsKCiAgICAgICAgaW50IGVh\nZ2VyID0gY2FsY3VsYXRlRWFnZXJNb2RlKGV4cHNbMF0sIHJhbmdlLnN0YXJ0\nLCByYW5nZS5lbmQpOwogICAgICAgIGludCBzdWJjbGFzc01vZGUgPSBmZXRj\naC5nZXRTdWJjbGFzc0ZldGNoTW9kZSgoQ2xhc3NNYXBwaW5nKSBiYXNlKTsK\nICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9zdG9yZS5nZXREQkRpY3Rp\nb25hcnkoKTsKICAgICAgICBsb25nIHN0YXJ0ID0gKG1hcHBpbmdzLmxlbmd0\naCA9PSAxICYmIGRpY3Quc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4KSAKICAg\nICAgICAgICAgPyByYW5nZS5zdGFydCA6IDBMOwogICAgICAgIGxvbmcgZW5k\nID0gKGRpY3Quc3VwcG9ydHNTZWxlY3RFbmRJbmRleCkgPyByYW5nZS5lbmQg\nOiBMb25nLk1BWF9WQUxVRTsKCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0\nYXRlW10gc3RhdGVzID0gbmV3IFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtleHBz\nLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGF0ZXMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHN0YXRlc1tpXSA9IG5ldyBRdWVy\neUV4cHJlc3Npb25zU3RhdGUoKTsKICAgICAgICBFeHBDb250ZXh0IGN0eCA9\nIG5ldyBFeHBDb250ZXh0KF9zdG9yZSwgcGFyYW1zLCBmZXRjaCk7CgogICAg\nICAgIC8vIGFkZCBzZWxlY3RzIHdpdGggcG9wdWxhdGUgV0hFUkUgY29uZGl0\naW9ucyB0byBsaXN0CiAgICAgICAgTGlzdCBzZWxzID0gbmV3IEFycmF5TGlz\ndChtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgIExpc3Qgc2VsTWFwcGluZ3Mg\nPSBuZXcgQXJyYXlMaXN0KG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgQml0\nU2V0IHN1YmNsYXNzQml0cyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICBCaXRT\nZXQgbmV4dEJpdHMgPSBuZXcgQml0U2V0KCk7CiAgICAgICAgYm9vbGVhbiB1\nbmlvbmFibGUgPSBjcmVhdGVXaGVyZVNlbGVjdHMoc2VscywgbWFwcGluZ3Ms\nIHNlbE1hcHBpbmdzLAogICAgICAgICAgICBzdWJjbGFzc2VzLCBzdWJjbGFz\nc0JpdHMsIG5leHRCaXRzLCBmYWN0cywgZXhwcywgc3RhdGVzLCBjdHgsCiAg\nICAgICAgICAgIHN1YmNsYXNzTW9kZSkKICAgICAgICAgICAgJiYgc3ViY2xh\nc3NNb2RlID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTgog\nICAgICAgICAgICAmJiBzdGFydCA9PSAwCiAgICAgICAgICAgICYmIGVuZCA9\nPSBMb25nLk1BWF9WQUxVRTsKCiAgICAgICAgLy8gd2UgbWlnaHQgd2FudCB0\nbyB1c2UgbHJzIHNldHRpbmdzIGlmIHdlIGNhbid0IHVzZSB0aGUgcmFuZ2UK\nICAgICAgICBpZiAoc2Vscy5zaXplKCkgPiAxKQogICAgICAgICAgICBzdGFy\ndCA9IDBMOwogICAgICAgIGJvb2xlYW4gbHJzID0gcmFuZ2UubHJzIHx8IChm\nZXRjaC5nZXRGZXRjaEJhdGNoU2l6ZSgpID49IDAgCiAgICAgICAgICAgICYm\nIChzdGFydCAhPSByYW5nZS5zdGFydCB8fCBlbmQgIT0gcmFuZ2UuZW5kKSk7\nCgogICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyW10gcm9wcyA9IG51bGw7\nCiAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wID0gbnVsbDsKICAg\nICAgICBpZiAodW5pb25hYmxlKSB7CiAgICAgICAgICAgIFVuaW9uIHVuaW9u\nID0gX3N0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdVbmlvbigKICAgICAgICAg\nICAgICAgIChTZWxlY3RbXSkgc2Vscy50b0FycmF5KG5ldyBTZWxlY3Rbc2Vs\ncy5zaXplKCldKSk7CiAgICAgICAgICAgIEJpdFNldFtdIHBhZ2VkID0gcG9w\ndWxhdGVVbmlvbih1bmlvbiwgbWFwcGluZ3MsIHN1YmNsYXNzZXMsIGZhY3Rz\nLAogICAgICAgICAgICAgICAgZXhwcywgc3RhdGVzLCBjdHgsIGxycywgZWFn\nZXIsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICB1bmlvbi5zZXRMUlMobHJz\nKTsKICAgICAgICAgICAgcm9wID0gZXhlY3V0ZVVuaW9uKHVuaW9uLCBtYXBw\naW5ncywgZXhwcywgc3RhdGVzLCBjdHgsIHBhZ2VkKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBpZiAoc2Vscy5zaXplKCkgPiAxKQogICAgICAg\nICAgICAgICAgcm9wcyA9IG5ldyBSZXN1bHRPYmplY3RQcm92aWRlcltzZWxz\nLnNpemUoKV07CgogICAgICAgICAgICBTZWxlY3Qgc2VsOwogICAgICAgICAg\nICBCaXRTZXQgcGFnZWQ7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBp\nZHggPSAwOyBpIDwgc2Vscy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAg\nICAgc2VsID0gKFNlbGVjdCkgc2Vscy5nZXQoaSk7CiAgICAgICAgICAgICAg\nICBwYWdlZCA9IHBvcHVsYXRlU2VsZWN0KHNlbCwgKENsYXNzTWFwcGluZykg\nc2VsTWFwcGluZ3MuZ2V0KGkpLAogICAgICAgICAgICAgICAgICAgIHN1YmNs\nYXNzQml0cy5nZXQoaSksIChKREJDRXhwcmVzc2lvbkZhY3RvcnkpIGZhY3Rz\nW2lkeF0sCiAgICAgICAgICAgICAgICAgICAgZXhwc1tpZHhdLCBzdGF0ZXNb\naWR4XSwgY3R4LCBscnMsIGVhZ2VyLCBzdGFydCwgZW5kKTsKCiAgICAgICAg\nICAgICAgICByb3AgPSBleGVjdXRlU2VsZWN0KHNlbCwgKENsYXNzTWFwcGlu\nZykgc2VsTWFwcGluZ3MuZ2V0KGkpLAogICAgICAgICAgICAgICAgICAgIGV4\ncHNbaWR4XSwgc3RhdGVzW2lkeF0sIGN0eCwgcGFnZWQsIHN0YXJ0LCBlbmQp\nOwogICAgICAgICAgICAgICAgaWYgKHJvcHMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICByb3BzW2ldID0gcm9wOwoKICAgICAgICAgICAgICAgIGlm\nIChuZXh0Qml0cy5nZXQoaSkpCiAgICAgICAgICAgICAgICAgICAgaWR4Kys7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChyb3BzICE9\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKGV4cHNbMF0uYXNjZW5kaW5nLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcm9wID0gbmV3IE1lcmdlZFJl\nc3VsdE9iamVjdFByb3ZpZGVyKHJvcHMpOwogICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgIHJvcCA9IG5ldyBPcmRlcmluZ01lcmdlZFJlc3Vs\ndE9iamVjdFByb3ZpZGVyKHJvcHMsCiAgICAgICAgICAgICAgICAgICAgZXhw\nc1swXS5hc2NlbmRpbmcsIGV4LCB0aGlzLCBwYXJhbXMpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBuZWVkIHRvIGZha2UgcmVzdWx0\nIHJhbmdlPwogICAgICAgIGlmICgocm9wcyAhPSBudWxsICYmIHJhbmdlLmVu\nZCAhPSBMb25nLk1BWF9WQUxVRSkgCiAgICAgICAgICAgIHx8IHN0YXJ0ICE9\nIHJhbmdlLnN0YXJ0IHx8IGVuZCAhPSByYW5nZS5lbmQpCiAgICAgICAgICAg\nIHJvcCA9IG5ldyBSYW5nZVJlc3VsdE9iamVjdFByb3ZpZGVyKHJvcCwgcmFu\nZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7CiAgICAgICAgcmV0dXJuIHJvcDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBkYXRhIGZvciB0aGUgZ2l2ZW4g\ndW5pb24sIHJldHVybmluZyBwYWdlZCBmaWVsZHMuCiAgICAgKi8KICAgIHBy\naXZhdGUgQml0U2V0W10gcG9wdWxhdGVVbmlvbihVbmlvbiB1bmlvbiwgZmlu\nYWwgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3MsCiAgICAgICAgZmluYWwgYm9v\nbGVhbiBzdWJjbGFzc2VzLCBmaW5hbCBFeHByZXNzaW9uRmFjdG9yeVtdIGZh\nY3RzLAogICAgICAgIGZpbmFsIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLCBm\naW5hbCBRdWVyeUV4cHJlc3Npb25zU3RhdGVbXSBzdGF0ZXMsCiAgICAgICAg\nZmluYWwgRXhwQ29udGV4dCBjdHgsIGZpbmFsIGJvb2xlYW4gbHJzLCBmaW5h\nbCBpbnQgZWFnZXIsCiAgICAgICAgZmluYWwgbG9uZyBzdGFydCwgZmluYWwg\nbG9uZyBlbmQpIHsKICAgICAgICBmaW5hbCBCaXRTZXRbXSBwYWdlZCA9IChl\neHBzWzBdLnByb2plY3Rpb25zLmxlbmd0aCA+IDApID8gbnVsbAogICAgICAg\nICAgICA6IG5ldyBCaXRTZXRbbWFwcGluZ3MubGVuZ3RoXTsKICAgICAgICB1\nbmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGlkeCkgewog\nICAgICAgICAgICAgICAgQml0U2V0IGJpdHMgPSBwb3B1bGF0ZVNlbGVjdChz\nZWwsIG1hcHBpbmdzW2lkeF0sIHN1YmNsYXNzZXMsCiAgICAgICAgICAgICAg\nICAgICAgKEpEQkNFeHByZXNzaW9uRmFjdG9yeSkgZmFjdHNbaWR4XSwgZXhw\nc1tpZHhdLCBzdGF0ZXNbaWR4XSwKICAgICAgICAgICAgICAgICAgICBjdHgs\nICBscnMsIGVhZ2VyLCBzdGFydCwgZW5kKTsKICAgICAgICAgICAgICAgIGlm\nIChwYWdlZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHBhZ2VkW2lk\neF0gPSBiaXRzOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAg\ncmV0dXJuIHBhZ2VkOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGRh\ndGEgZm9yIHRoZSBnaXZlbiBzZWxlY3QsIHJldHVybmluZyBwYWdlZCBmaWVs\nZHMuCiAgICAgKi8KICAgIHByaXZhdGUgQml0U2V0IHBvcHVsYXRlU2VsZWN0\nKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIGJv\nb2xlYW4gc3ViY2xhc3NlcywgSkRCQ0V4cHJlc3Npb25GYWN0b3J5IGZhY3Qs\nIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcywKICAgICAgICBRdWVyeUV4cHJlc3Np\nb25zU3RhdGUgc3RhdGUsIEV4cENvbnRleHQgY3R4LCBib29sZWFuIGxycywg\naW50IGVhZ2VyLAogICAgICAgIGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAg\nICAgICAgc2VsLnNldExSUyhscnMpOwogICAgICAgIHNlbC5zZXRSYW5nZShz\ndGFydCwgZW5kKTsKCiAgICAgICAgQml0U2V0IHBhZ2VkID0gbnVsbDsKICAg\nICAgICBpZiAoZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGggPT0gMCkgewogICAg\nICAgICAgICBwYWdlZCA9IFBhZ2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyLmdl\ndFBhZ2VkRmllbGRzKHNlbCwgbWFwcGluZywKICAgICAgICAgICAgICAgIF9z\ndG9yZSwgY3R4LmZldGNoLCBlYWdlciwgZW5kIC0gc3RhcnQpOwogICAgICAg\nICAgICBpZiAocGFnZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGVhZ2Vy\nID0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOOwogICAgICAg\nIH0KCiAgICAgICAgZmFjdC5nZXRTZWxlY3RDb25zdHJ1Y3RvcigpLnNlbGVj\ndChzZWwsIGN0eCwgbWFwcGluZywgc3ViY2xhc3NlcywgZXhwcywKICAgICAg\nICAgICAgc3RhdGUsIGVhZ2VyKTsKICAgICAgICByZXR1cm4gcGFnZWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIHRoZSBnaXZlbiB1bmlvbi4K\nICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHRPYmplY3RQcm92aWRlciBleGVj\ndXRlVW5pb24oVW5pb24gdW5pb24sCiAgICAgICAgQ2xhc3NNYXBwaW5nW10g\nbWFwcGluZ3MsIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLCAKICAgICAgICBR\ndWVyeUV4cHJlc3Npb25zU3RhdGVbXSBzdGF0ZXMsIEV4cENvbnRleHQgY3R4\nLCBCaXRTZXRbXSBwYWdlZCkgewogICAgICAgIGlmIChleHBzWzBdLnByb2pl\nY3Rpb25zLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJv\namVjdGlvblJlc3VsdE9iamVjdFByb3ZpZGVyKHVuaW9uLCBleHBzLCBzdGF0\nZXMsIGN0eCk7CgogICAgICAgIGlmIChwYWdlZCAhPSBudWxsKQogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBhZ2VkLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgaWYgKHBhZ2VkW2ldICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWdpbmdSZXN1bHRPYmplY3RQcm92\naWRlcih1bmlvbiwgbWFwcGluZ3MsCiAgICAgICAgICAgICAgICAgICAgICAg\nIF9zdG9yZSwgY3R4LmZldGNoLCBwYWdlZCwgTG9uZy5NQVhfVkFMVUUpOwoK\nICAgICAgICByZXR1cm4gbmV3IEluc3RhbmNlUmVzdWx0T2JqZWN0UHJvdmlk\nZXIodW5pb24sIG1hcHBpbmdzWzBdLCBfc3RvcmUsCiAgICAgICAgICAgIGN0\neC5mZXRjaCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIHRoZSBn\naXZlbiBzZWxlY3QuCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0T2JqZWN0\nUHJvdmlkZXIgZXhlY3V0ZVNlbGVjdChTZWxlY3Qgc2VsLCBDbGFzc01hcHBp\nbmcgbWFwcGluZywKICAgICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMsIFF1\nZXJ5RXhwcmVzc2lvbnNTdGF0ZSBzdGF0ZSwgRXhwQ29udGV4dCBjdHgsIAog\nICAgICAgIEJpdFNldCBwYWdlZCwgbG9uZyBzdGFydCwgbG9uZyBlbmQpIHsK\nICAgICAgICBpZiAoZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGggPiAwKQogICAg\nICAgICAgICByZXR1cm4gbmV3IFByb2plY3Rpb25SZXN1bHRPYmplY3RQcm92\naWRlcihzZWwsIGV4cHMsIHN0YXRlLCBjdHgpOwogICAgICAgIGlmIChwYWdl\nZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFBhZ2luZ1Jlc3Vs\ndE9iamVjdFByb3ZpZGVyKHNlbCwgbWFwcGluZywgX3N0b3JlLCAKICAgICAg\nICAgICAgICAgIGN0eC5mZXRjaCwgcGFnZWQsIGVuZCAtIHN0YXJ0KTsKICAg\nICAgICByZXR1cm4gbmV3IEluc3RhbmNlUmVzdWx0T2JqZWN0UHJvdmlkZXIo\nc2VsLCBtYXBwaW5nLCBfc3RvcmUsIAogICAgICAgICAgICBjdHguZmV0Y2gp\nOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgdGhlIHNlbGVjdHMg\nd2l0aCBXSEVSRSBjb25kaXRpb25zIG5lZWRlZCB0byBleGVjdXRlIHRoZSBx\ndWVyeQogICAgICogZm9yIHRoZSBnaXZlbiBtYXBwaW5ncy4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGNyZWF0ZVdoZXJlU2VsZWN0cyhMaXN0IHNl\nbHMsIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzLAogICAgICAgIExpc3Qgc2Vs\nTWFwcGluZ3MsIGJvb2xlYW4gc3ViY2xhc3NlcywgQml0U2V0IHN1YmNsYXNz\nQml0cywKICAgICAgICBCaXRTZXQgbmV4dEJpdHMsIEV4cHJlc3Npb25GYWN0\nb3J5W10gZmFjdHMsIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLAogICAgICAg\nIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtdIHN0YXRlcywgRXhwQ29udGV4dCBj\ndHgsIGludCBzdWJjbGFzc01vZGUpIHsKICAgICAgICBOdW1iZXIgb3B0SGlu\ndCA9IChOdW1iZXIpIGN0eC5mZXRjaC5nZXRIaW50CiAgICAgICAgICAgIChR\ndWVyeUhpbnRzLkhJTlRfUkVTVUxUX0NPVU5UKTsKICAgICAgICBDbGFzc01h\ncHBpbmdbXSB2ZXJ0czsKICAgICAgICBib29sZWFuIHVuaW9uYWJsZSA9IHRy\ndWU7CiAgICAgICAgU2VsZWN0IHNlbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8v\nIGRldGVybWluZSB2ZXJ0aWNhbCBtYXBwaW5ncyB0byBzZWxlY3Qgc2VwYXJh\ndGVseQogICAgICAgICAgICB2ZXJ0cyA9IGdldFZlcnRpY2FsTWFwcGluZ3Mo\nbWFwcGluZ3NbaV0sIHN1YmNsYXNzZXMsIGV4cHNbaV0sCiAgICAgICAgICAg\nICAgICBzdWJjbGFzc01vZGUpOwogICAgICAgICAgICBpZiAodmVydHMubGVu\nZ3RoID09IDEgJiYgc3ViY2xhc3NlcykKICAgICAgICAgICAgICAgIHN1YmNs\nYXNzQml0cy5zZXQoc2Vscy5zaXplKCkpOwoKICAgICAgICAgICAgLy8gY3Jl\nYXRlIGNyaXRlcmlhIHNlbGVjdCBhbmQgY2xvbmUgZm9yIGVhY2ggdmVydCBt\nYXBwaW5nCiAgICAgICAgICAgIHNlbCA9ICgoSkRCQ0V4cHJlc3Npb25GYWN0\nb3J5KSBmYWN0c1tpXSkuZ2V0U2VsZWN0Q29uc3RydWN0b3IoKS4KICAgICAg\nICAgICAgICAgIGV2YWx1YXRlKGN0eCwgbnVsbCwgbnVsbCwgZXhwc1tpXSwg\nc3RhdGVzW2ldKTsKICAgICAgICAgICAgaWYgKG9wdEhpbnQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgc2VsLnNldEV4cGVjdGVkUmVzdWx0Q291bnQob3B0\nSGludC5pbnRWYWx1ZSgpLCB0cnVlKTsKICAgICAgICAgICAgZWxzZSBpZiAo\ndGhpcy5jdHguaXNVbmlxdWUoKSkKICAgICAgICAgICAgICAgIHNlbC5zZXRF\neHBlY3RlZFJlc3VsdENvdW50KDEsIGZhbHNlKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaiA9IDA7IGogPCB2ZXJ0cy5sZW5ndGg7IGorKykgewogICAgICAg\nICAgICAgICAgc2VsTWFwcGluZ3MuYWRkKHZlcnRzW2pdKTsKICAgICAgICAg\nICAgICAgIGlmIChqID09IHZlcnRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAg\nICAgICAgICAgICBuZXh0Qml0cy5zZXQoc2Vscy5zaXplKCkpOwogICAgICAg\nICAgICAgICAgICAgIHNlbHMuYWRkKHNlbCk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZWxzLmFkZChzZWwuZnVsbENs\nb25lKDEpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gdHVybiBv\nZmYgdW5pb25pbmcgaWYgYSBnaXZlbiBpbmRlcGVuZGVudCBtYXBwaW5nIHJl\ncXVpcmVzCiAgICAgICAgICAgIC8vIG11bHRpcGxlIHNlbGVjdHMsIG9yIGlm\nIHdlJ3JlIHVzaW5nIEZST00gc2VsZWN0cwogICAgICAgICAgICBpZiAodmVy\ndHMubGVuZ3RoID4gMSB8fCBzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwp\nCiAgICAgICAgICAgICAgICB1bmlvbmFibGUgPSBmYWxzZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHVuaW9uYWJsZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhbGwgdGhlIHZlcnRpY2FsIG1hcHBpbmdzIHRvIHNlbGVj\ndCBzZXBhcmF0ZWx5LiBEZXBlbmRzIG9uCiAgICAgKiBzdWJjbGFzcyBmZXRj\naCBtb2RlIGFuZCB0aGUgdHlwZSBvZiBxdWVyeS4KICAgICAqLwogICAgcHJp\ndmF0ZSBDbGFzc01hcHBpbmdbXSBnZXRWZXJ0aWNhbE1hcHBpbmdzKENsYXNz\nTWFwcGluZyBtYXBwaW5nLAogICAgICAgIGJvb2xlYW4gc3ViY2xhc3Nlcywg\nUXVlcnlFeHByZXNzaW9ucyBleHBzLCBpbnQgc3ViY2xhc3NNb2RlKSB7CiAg\nICAgICAgaWYgKCFzdWJjbGFzc2VzIHx8IGV4cHMucHJvamVjdGlvbnMubGVu\nZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01hcHBpbmdb\nXSB7IG1hcHBpbmcgfTsKCiAgICAgICAgaWYgKHN1YmNsYXNzTW9kZSAhPSBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BBUkFMTEVMCiAgICAgICAg\nICAgIHx8ICFoYXNWZXJ0aWNhbFN1YmNsYXNzZXMobWFwcGluZykpCiAgICAg\nICAgICAgIHJldHVybiBuZXcgQ2xhc3NNYXBwaW5nW10geyBtYXBwaW5nIH07\nCgogICAgICAgIExpc3Qgc3VicyA9IG5ldyBBcnJheUxpc3QoNCk7CiAgICAg\nICAgYWRkU3ViY2xhc3NlcyhtYXBwaW5nLCBzdWJzKTsKICAgICAgICByZXR1\ncm4gKENsYXNzTWFwcGluZ1tdKSBzdWJzLnRvQXJyYXkobmV3IENsYXNzTWFw\ncGluZ1tzdWJzLnNpemUoKV0pOwogICAgfQoKICAgIC8qKgogICAgICogUmVj\ndXJzaXZlIGhlbHBlciB0byBhZGQgbWFwcGluZ3MgZm9yIHN1YmNsYXNzZXMg\ndG8gdGhlIGdpdmVuIGxpc3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRTdWJjbGFzc2VzKENsYXNzTWFwcGluZyBtYXBwaW5nLCBDb2xsZWN0aW9u\nIHN1YnMpIHsKICAgICAgICAvLyBwb3NzaWJsZSBmdXR1cmUgb3B0aW1pemF0\naW9uczoKICAgICAgICAvLyAtIGlmIG5vIGZpZWxkcyBpbiBtZXRhIG9yIGl0\ncyBzdWJjbGFzc2VzIChhbmQgbm90IGluIGFuCiAgICAgICAgLy8gICBhbHJl\nYWR5LXNlbGVjdGVkIHRhYmxlKSBhcmUgaW4gdGhlIGN1cnJlbnQgZmV0Y2gK\nICAgICAgICAvLyAgIGNvbmZpZ3VyYXRpb24sIHN0b3AgY3JlYXRpbmcgbmV3\nIGV4ZWN1dG9ycwogICAgICAgIC8vIC0gYWxsb3cgYW4gZXhlY3V0b3IgdG8g\nc2VsZWN0IGEgcmFuZ2Ugb2Ygc3ViY2xhc3NlcywgcmF0aGVyCiAgICAgICAg\nLy8gICB0aGFuIGp1c3QgYWxsIHN1YmNsYXNzZXMgLyBubyBzdWJjbGFzc2Vz\nOyB0aGlzIHdvdWxkCiAgICAgICAgLy8gICBhbGxvdyB1cyB0byBkbyBqdXN0\nIG9uZSBxdWVyeSBwZXIgYWN0dWFsIHZlcnRpY2FsbHktbWFwcGVkCiAgICAg\nICAgLy8gICBzdWJjbGFzcywgcmF0aGVyIHRoYW4gb25lIHBlciBtYXBwZWQg\nc3ViY2xhc3MsIGFzIGlzIGhhcHBlbmluZyBub3cKCiAgICAgICAgc3Vicy5h\nZGQobWFwcGluZyk7CiAgICAgICAgaWYgKCFoYXNWZXJ0aWNhbFN1YmNsYXNz\nZXMobWFwcGluZykpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\ncmVjdXJzZSBvbiBpbW1lZGlhdGUgc3ViY2xhc3NlcwogICAgICAgIENsYXNz\nTWFwcGluZ1tdIHN1Yk1hcHBpbmdzID0gbWFwcGluZy5nZXRKb2luYWJsZVBD\nU3ViY2xhc3NNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgc3ViTWFwcGluZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChz\ndWJNYXBwaW5nc1tpXS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKSA9PSBtYXBwaW5nKQogICAgICAgICAgICAgICAgYWRkU3ViY2xhc3Nlcyhz\ndWJNYXBwaW5nc1tpXSwgc3Vicyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gY2xhc3MgaGFzIGFueSB2ZXJ0aWNh\nbCBzdWJjbGFzc2VzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29s\nZWFuIGhhc1ZlcnRpY2FsU3ViY2xhc3NlcyhDbGFzc01hcHBpbmcgbWFwcGlu\nZykgewogICAgICAgIENsYXNzTWFwcGluZ1tdIHN1YnMgPSBtYXBwaW5nLmdl\ndEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdWJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoc3Vic1tpXS5nZXRTdHJhdGVneSgpIGluc3RhbmNlb2YgVmVydGljYWxD\nbGFzc1N0cmF0ZWd5KQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIGVhZ2VyIG1vZGUgZGVwZW5kcyBvbiB0aGUgdW5pcXVlIHNldHRpbmcgYW5k\nIHJhbmdlLiBJZiB0aGUgcmFuZ2UKICAgICAqIHByb2R1Y2VzIDAgcmVzdWx0\ncywgdXNlIGVhZ2VyIHNldHRpbmcgb2Ygbm9uZS4gSWYgaXQgcHJvZHVjZXMg\nMSByZXN1bHQKICAgICAqIG9yIHRoZSBxdWVyeSBpcyB1bmlxdWUsIHVzZSBh\nbiBlYWdlciBzZXR0aW5nIG9mIHNpbmdsZS4gT3RoZXJ3aXNlIHVzZQogICAg\nICogYW4gZWFnZXIgbW9kZSBvZiBtdWx0aXBsZS4KICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgY2FsY3VsYXRlRWFnZXJNb2RlKFF1ZXJ5RXhwcmVzc2lvbnMg\nZXhwcywgbG9uZyBzdGFydCwKICAgICAgICBsb25nIGVuZCkgewogICAgICAg\nIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA+IDAgfHwgc3RhcnQgPj0g\nZW5kKQogICAgICAgICAgICByZXR1cm4gRWFnZXJGZXRjaE1vZGVzLkVBR0VS\nX05PTkU7CiAgICAgICAgaWYgKGVuZCAtIHN0YXJ0ID09IDEgfHwgY3R4Lmlz\nVW5pcXVlKCkpCiAgICAgICAgICAgIHJldHVybiBFYWdlckZldGNoTW9kZXMu\nRUFHRVJfSk9JTjsKICAgICAgICByZXR1cm4gRWFnZXJGZXRjaE1vZGVzLkVB\nR0VSX1BBUkFMTEVMOwogICAgfQoKICAgIHByb3RlY3RlZCBOdW1iZXIgZXhl\nY3V0ZURlbGV0ZShFeGVjdXRvciBleCwgQ2xhc3NNZXRhRGF0YSBiYXNlLAog\nICAgICAgIENsYXNzTWV0YURhdGFbXSBtZXRhcywgYm9vbGVhbiBzdWJjbGFz\nc2VzLCBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLAogICAgICAgIFF1ZXJ5\nRXhwcmVzc2lvbnNbXSBleHBzLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAg\nICByZXR1cm4gZXhlY3V0ZUJ1bGtPcGVyYXRpb24obWV0YXMsIHN1YmNsYXNz\nZXMsIGZhY3RzLCBleHBzLAogICAgICAgICAgICBwYXJhbXMsIG51bGwpOwog\nICAgfQoKICAgIHByb3RlY3RlZCBOdW1iZXIgZXhlY3V0ZVVwZGF0ZShFeGVj\ndXRvciBleCwgQ2xhc3NNZXRhRGF0YSBiYXNlLAogICAgICAgIENsYXNzTWV0\nYURhdGFbXSBtZXRhcywgYm9vbGVhbiBzdWJjbGFzc2VzLCBFeHByZXNzaW9u\nRmFjdG9yeVtdIGZhY3RzLAogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNbXSBl\neHBzLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gZXhlY3V0\nZUJ1bGtPcGVyYXRpb24obWV0YXMsIHN1YmNsYXNzZXMsIGZhY3RzLCBleHBz\nLAogICAgICAgICAgICBwYXJhbXMsIGV4cHNbMF0udXBkYXRlcyk7CiAgICB9\nCgogICAgcHJpdmF0ZSBOdW1iZXIgZXhlY3V0ZUJ1bGtPcGVyYXRpb24oQ2xh\nc3NNZXRhRGF0YVtdIG1ldGFzLAogICAgICAgIGJvb2xlYW4gc3ViY2xhc3Nl\ncywgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0cywgUXVlcnlFeHByZXNzaW9u\nc1tdIGV4cHMsCiAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBNYXAgdXBkYXRl\ncykgewogICAgICAgIC8vIHdlIGNhbm5vdCBleGVjdXRlIGEgYnVsayBkZWxl\ndGUgc3RhdGVtZW50IHdoZW4gaGF2ZSBtYXBwaW5ncyBpbgogICAgICAgIC8v\nIG11bHRpcGxlIHRhYmxlcywgc28gaW5kaWNhdGUgd2Ugd2FudCB0byB1c2Ug\naW4tbWVtb3J5IHdpdGggbnVsbAogICAgICAgIENsYXNzTWFwcGluZ1tdIG1h\ncHBpbmdzID0gKENsYXNzTWFwcGluZ1tdKSBtZXRhczsKCiAgICAgICAgLy8g\nc3BlY2lmaWNhdGlvbiBvZiB0aGUgInVwZGF0ZXMiIG1hcCBpbmRpY2F0ZXMg\ndGhhdCB0aGlzIGlzCiAgICAgICAgLy8gYW4gdXBkYXRlIHF1ZXJ5OyBvdGhl\ncndpc2UsIHRoaXMgaXMgYSBkZWxldGUgc3RhdGVtZW50CiAgICAgICAgYm9v\nbGVhbiBpc1VwZGF0ZSA9IHVwZGF0ZXMgIT0gbnVsbCAmJiB1cGRhdGVzLnNp\nemUoKSA+IDA7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGlu\nZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFpc1NpbmdsZVRh\nYmxlTWFwcGluZyhtYXBwaW5nc1tpXSwgc3ViY2xhc3NlcykgJiYgIWlzVXBk\nYXRlKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAg\nICBpZiAoIWlzVXBkYXRlKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGVy\nZSBhcmUgYW55IGRlbGV0ZSBjYWxsYmFja3MsIHdlIG5lZWQgdG8KICAgICAg\nICAgICAgICAgIC8vIGV4ZWN1dGUgaW4tbWVtb3J5IHNvIHRoZSBjYWxsYmFj\na3MgYXJlIGludm9rZWQKICAgICAgICAgICAgICAgIExpZmVjeWNsZUV2ZW50\nTWFuYWdlciBtZ3IgPSBjdHguZ2V0U3RvcmVDb250ZXh0KCkuZ2V0QnJva2Vy\nKCkKICAgICAgICAgICAgICAgICAgICAuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyKCk7CiAgICAgICAgICAgICAgICBpZiAobWdyLmhhc0RlbGV0ZUxpc3Rl\nbmVycyhudWxsLCBtYXBwaW5nc1tpXSkpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSAoSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbikgCiAgICAgICAgICAgIGN0eC5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKICAgICAgICBFeHBDb250ZXh0IGN0eCA9IG5ldyBFeHBDb250\nZXh0KF9zdG9yZSwgcGFyYW1zLCBmZXRjaCk7CiAgICAgICAgREJEaWN0aW9u\nYXJ5IGRpY3QgPSBfc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCk7CiAgICAgICAg\nUXVlcnlFeHByZXNzaW9uc1N0YXRlW10gc3RhdGUgPSBuZXcgUXVlcnlFeHBy\nZXNzaW9uc1N0YXRlW2V4cHMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHN0YXRlLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBzdGF0\nZVtpXSA9IG5ldyBRdWVyeUV4cHJlc3Npb25zU3RhdGUoKTsKCiAgICAgICAg\nU1FMQnVmZmVyW10gc3FsID0gbmV3IFNRTEJ1ZmZlclttYXBwaW5ncy5sZW5n\ndGhdOwogICAgICAgIEpEQkNFeHByZXNzaW9uRmFjdG9yeSBqZGJjRmFjdG9y\neTsKICAgICAgICBTZWxlY3Qgc2VsOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgamRi\nY0ZhY3RvcnkgPSAoSkRCQ0V4cHJlc3Npb25GYWN0b3J5KSBmYWN0c1tpXTsK\nICAgICAgICAgICAgc2VsID0gamRiY0ZhY3RvcnkuZ2V0U2VsZWN0Q29uc3Ry\ndWN0b3IoKS5ldmFsdWF0ZShjdHgsIG51bGwsIG51bGwsCiAgICAgICAgICAg\nICAgICBleHBzW2ldLCBzdGF0ZVtpXSk7CiAgICAgICAgICAgIGpkYmNGYWN0\nb3J5LmdldFNlbGVjdENvbnN0cnVjdG9yKCkuc2VsZWN0KHNlbCwgY3R4LCBt\nYXBwaW5nc1tpXSwgCiAgICAgICAgICAgICAgICBzdWJjbGFzc2VzLCBleHBz\nW2ldLCBzdGF0ZVtpXSwgCiAgICAgICAgICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uLkVBR0VSX05PTkUpOwoKICAgICAgICAgICAgLy8gVGhlIGJ1\nbGsgb3BlcmF0aW9uIHdpbGwgcmV0dXJuIG51bGwgdG8gaW5kaWNhdGUgdGhh\ndCB0aGUgZGF0YWJhc2UKICAgICAgICAgICAgLy8gZG9lcyBub3Qgc3VwcG9y\ndCB0aGUgcmVxdWVzdCBidWxrIGRlbGV0ZSBvcGVyYXRpb247IGluCiAgICAg\nICAgICAgIC8vIHRoaXMgY2FzZSwgd2UgbmVlZCB0byBwZXJmb3JtIHRoZSBx\ndWVyeSBpbi1tZW1vcnkgYW5kCiAgICAgICAgICAgIC8vIG1hbnVhbGx5IGRl\nbGV0ZSB0aGUgaW5zdGFuY2VzCiAgICAgICAgICAgIGlmICghaXNVcGRhdGUp\nCiAgICAgICAgICAgICAgICBzcWxbaV0gPSBkaWN0LnRvRGVsZXRlKG1hcHBp\nbmdzW2ldLCBzZWwsIHBhcmFtcyk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIHNxbFtpXSA9IGRpY3QudG9VcGRhdGUobWFwcGluZ3NbaV0s\nIHNlbCwgX3N0b3JlLCBwYXJhbXMsCiAgICAgICAgICAgICAgICAgICAgdXBk\nYXRlcyk7CgogICAgICAgICAgICBpZiAoc3FsW2ldID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8v\nIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHdlIGhhdmUgYW4gYWN0aXZlIHN0b3Jl\nIGNvbm5lY3Rpb24KICAgICAgICBfc3RvcmUuZ2V0Q29udGV4dCgpLmJlZ2lu\nU3RvcmUoKTsKCiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gX3N0b3JlLmdl\ndENvbm5lY3Rpb24oKTsKICAgICAgICBsb25nIGNvdW50ID0gMDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udDsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzcWwubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIHN0bW50ID0gbnVsbDsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc3RtbnQgPSBwcmVw\nYXJlU3RhdGVtZW50KGNvbm4sIHNxbFtpXSk7CiAgICAgICAgICAgICAgICAg\nICAgY291bnQgKz0gZXhlY3V0ZVVwZGF0ZShjb25uLCBzdG1udCwgc3FsW2ld\nLCBpc1VwZGF0ZSk7ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIHNxbFtp\nXS5nZXRTUUwoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIF9zdG9yZS5n\nZXREQkRpY3Rpb25hcnkoKSk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0\ncnkgeyBjb25uLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\ne30KICAgICAgICB9CiAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihj\nb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBnaXZl\nbiBtYXBwaW5nIG9jY3VwaWVzIG9ubHkgb25lIHRhYmxlLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNTaW5nbGVUYWJsZU1hcHBpbmcoQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgYm9vbGVhbiBzdWJjbGFzc2VzKSB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHJvb3QgPSBtYXBwaW5nOwogICAgICAg\nIHdoaWxlIChyb290LmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nICE9IG51bGwpCiAgICAgICAgICAgIHJvb3QgPSByb290LmdldEpvaW5hYmxl\nUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChoYXNWZXJ0aWNh\nbFN1YmNsYXNzZXMocm9vdCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgLy8gd2UgY2Fubm90IGV4ZWN1dGUgYSBidWxrIGRlbGV0ZSBp\nZiBhbnkgb2YgdGhlCiAgICAgICAgLy8gZmllbGQgbWFwcGluZ3MgZm9yIHRo\nZSBjYW5kaWRhdGVzIGhhdmUgY29sdW1ucwogICAgICAgIC8vIGluIGFueSBv\ndGhlciB0YWJsZSwgc2luY2UgYnVsayBkZWxldGluZyBqdXN0IGZyb20gdGhl\nCiAgICAgICAgLy8gY2xhc3Mgd2lsbCBsZWF2ZSBkYW5nbGluZyByZWxhdGlv\nbnM7IHdlIG1pZ2h0IGJlIGFibGUKICAgICAgICAvLyB0byBpc3N1ZSBidWxr\nIGRlbGV0ZXMgc2VwYXJhdGVseSBmb3IgdGhlIGpvaW5zIChwb3NzaWJseQog\nICAgICAgIC8vIHVzaW5nIGEgdGVtcG9yYXJ5IHRhYmxlIHRvIHNlbGVjdCB0\naGUgcHJpbWFyeSBrZXlzIGZvcgogICAgICAgIC8vIGFsbCB0aGUgcmVsYXRl\nZCB0YWJsZXMgYW5kIHRoZW4gaXNzaW5nIGEgZGVsZXRlIGFnYWluc3QgdGhv\nc2UKICAgICAgICAvLyBrZXlzKSwgYnV0IHRoYXQgbG9naWMgaXMgbm90IGN1\ncnJlbnRseSBpbXBsZW1lbnRlZAogICAgICAgIFRhYmxlIHRhYmxlID0gZ2V0\nVGFibGUobWFwcGluZy5nZXRGaWVsZE1hcHBpbmdzKCksIG51bGwpOwogICAg\nICAgIGlmICh0YWJsZSA9PSBJTlZBTElEKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIGlmIChzdWJjbGFzc2VzKSB7CiAgICAgICAgICAg\nIC8vIGlmIHdlIGFyZSBpbmNsdWRpbmcgc3ViY2xhc3Nlcywgd2UgYWxzbyBu\nZWVkIHRvIGdhdGhlcgogICAgICAgICAgICAvLyBhbGwgdGhlIG1hcHBpbmdz\nIGZvciBhbGwga25vd24gc3ViY2xhc3NlcwogICAgICAgICAgICBDbGFzc01h\ncHBpbmdbXSBzdWJzID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3ViY2xhc3NN\nYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgc3VicyAh\nPSBudWxsICYmIGkgPCBzdWJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICB0YWJsZSA9IGdldFRhYmxlKHN1YnNbaV0uZ2V0RGVmaW5lZEZpZWxk\nTWFwcGluZ3MoKSwgdGFibGUpOwogICAgICAgICAgICAgICAgaWYgKHRhYmxl\nID09IElOVkFMSUQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzaW5nbGUgdGFi\nbGUgZm9yIHRoZSBnaXZlbiBmaWVsZHMsIG9yIElOVkFMSUQgaWYgdGhleQog\nICAgICogdXNlIG11bHRpcGxlIHRhYmxlcy4KICAgICAqLwogICAgcHJpdmF0\nZSBUYWJsZSBnZXRUYWJsZShGaWVsZE1hcHBpbmdbXSBmaWVsZHMsIFRhYmxl\nIHRhYmxlKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFibGUgPSBnZXRUYWJsZShm\naWVsZHNbaV0sIHRhYmxlKTsKICAgICAgICAgICAgaWYgKHRhYmxlID09IElO\nVkFMSUQpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSB0YWJsZSBmb3IgdGhlIGZpZWxkIGlmIHRoZSBnaXZlbiB0YWJsZSBo\nYXNuJ3QgYmVlbiBzZXQKICAgICAqIHlldCwgb3IgaWYgdGhlIHRhYmxlcyBt\nYXRjaC4gSWYgdGhlIGZpZWxkIHVzZXMgYSBkaWZmZXJlbnQgdGFibGUsCiAg\nICAgKiByZXR1cm5zIElOVkFMSUQuIEFsc28gcmV0dXJucyBJTlZBTElEIGlm\nIGZpZWxkIGlzIGRlcGVuZGVudC4KICAgICAqLwogICAgcHJpdmF0ZSBUYWJs\nZSBnZXRUYWJsZShGaWVsZE1hcHBpbmcgZm0sIFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgaWYgKGZtLmdldENhc2NhZGVEZWxldGUoKSAhPSBWYWx1ZU1ldGFE\nYXRhLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAgcmV0dXJuIElOVkFMSUQ7\nCgogICAgICAgIENvbHVtbltdIGNvbHVtbnMgPSBmbS5nZXRDb2x1bW5zKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbHVtbnMgIT0gbnVsbCAmJiBp\nIDwgY29sdW1ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodGFi\nbGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRhYmxlID0gY29sdW1uc1tp\nXS5nZXRUYWJsZSgpOwogICAgICAgICAgICBlbHNlIGlmICh0YWJsZSAhPSBj\nb2x1bW5zW2ldLmdldFRhYmxlKCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nSU5WQUxJRDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhYmxlOwogICAg\nfQoKICAgIHByb3RlY3RlZCBOdW1iZXIgZXhlY3V0ZVVwZGF0ZShDbGFzc01l\ndGFEYXRhIGJhc2UsIENsYXNzTWV0YURhdGFbXSBtZXRhcywKICAgICAgICBi\nb29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMs\nCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIHBhcnNlZCwgT2JqZWN0W10g\ncGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHJv\ndGVjdGVkIFN0cmluZ1tdIGdldERhdGFTdG9yZUFjdGlvbnMoQ2xhc3NNZXRh\nRGF0YSBiYXNlLAogICAgICAgIENsYXNzTWV0YURhdGFbXSBtZXRhcywgYm9v\nbGVhbiBzdWJjbGFzc2VzLCBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLAog\nICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLCBPYmplY3RbXSBwYXJh\nbXMsIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gbWFw\ncGluZ3MgPSAoQ2xhc3NNYXBwaW5nW10pIG1ldGFzOwogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSAoSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbikgY3R4LgogICAgICAgICAgICBnZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICBpZiAoZXhwc1swXS5mZXRjaFBhdGhzICE9IG51bGwpIHsK\nICAgICAgICAgICAgZmV0Y2guYWRkRmllbGRzKEFycmF5cy5hc0xpc3QoZXhw\nc1swXS5mZXRjaFBhdGhzKSk7CiAgICAgICAgICAgIGZldGNoLmFkZEpvaW5z\nKEFycmF5cy5hc0xpc3QoZXhwc1swXS5mZXRjaFBhdGhzKSk7CiAgICAgICAg\nfQogICAgICAgIGlmIChleHBzWzBdLmZldGNoSW5uZXJQYXRocyAhPSBudWxs\nKQogICAgICAgICAgICBmZXRjaC5hZGRGZXRjaElubmVySm9pbnMoQXJyYXlz\nLmFzTGlzdChleHBzWzBdLmZldGNoSW5uZXJQYXRocykpOwoKICAgICAgICBp\nbnQgZWFnZXIgPSBjYWxjdWxhdGVFYWdlck1vZGUoZXhwc1swXSwgcmFuZ2Uu\nc3RhcnQsIHJhbmdlLmVuZCk7CiAgICAgICAgZWFnZXIgPSBNYXRoLm1pbihl\nYWdlciwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKTsKICAg\nICAgICBpbnQgc3ViY2xhc3NNb2RlID0gZmV0Y2guZ2V0U3ViY2xhc3NGZXRj\naE1vZGUoKENsYXNzTWFwcGluZykgYmFzZSk7CiAgICAgICAgREJEaWN0aW9u\nYXJ5IGRpY3QgPSBfc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCk7CiAgICAgICAg\nbG9uZyBzdGFydCA9IChtYXBwaW5ncy5sZW5ndGggPT0gMSAmJiBkaWN0LnN1\ncHBvcnRzU2VsZWN0U3RhcnRJbmRleCkgCiAgICAgICAgICAgID8gcmFuZ2Uu\nc3RhcnQgOiAwTDsKICAgICAgICBsb25nIGVuZCA9IChkaWN0LnN1cHBvcnRz\nU2VsZWN0RW5kSW5kZXgpID8gcmFuZ2UuZW5kIDogTG9uZy5NQVhfVkFMVUU7\nCgogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtdIHN0YXRlcyA9IG5l\ndyBRdWVyeUV4cHJlc3Npb25zU3RhdGVbZXhwcy5sZW5ndGhdOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBzdGF0ZXNbaV0gPSBuZXcgUXVlcnlFeHByZXNzaW9uc1N0YXRl\nKCk7CiAgICAgICAgRXhwQ29udGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChf\nc3RvcmUsIHBhcmFtcywgZmV0Y2gpOwoKICAgICAgICAvLyBhZGQgc2VsZWN0\ncyB3aXRoIHBvcHVsYXRlIFdIRVJFIGNvbmRpdGlvbnMgdG8gbGlzdAogICAg\nICAgIExpc3Qgc2VscyA9IG5ldyBBcnJheUxpc3QobWFwcGluZ3MubGVuZ3Ro\nKTsKICAgICAgICBMaXN0IHNlbE1hcHBpbmdzID0gbmV3IEFycmF5TGlzdCht\nYXBwaW5ncy5sZW5ndGgpOwogICAgICAgIEJpdFNldCBzdWJjbGFzc0JpdHMg\nPSBuZXcgQml0U2V0KCk7CiAgICAgICAgQml0U2V0IG5leHRCaXRzID0gbmV3\nIEJpdFNldCgpOwogICAgICAgIGJvb2xlYW4gdW5pb25hYmxlID0gY3JlYXRl\nV2hlcmVTZWxlY3RzKHNlbHMsIG1hcHBpbmdzLCBzZWxNYXBwaW5ncywKICAg\nICAgICAgICAgc3ViY2xhc3Nlcywgc3ViY2xhc3NCaXRzLCBuZXh0Qml0cywg\nZmFjdHMsIGV4cHMsIHN0YXRlcywgY3R4LCAKICAgICAgICAgICAgc3ViY2xh\nc3NNb2RlKSAmJiBzdWJjbGFzc01vZGUgPT0gSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbi5FQUdFUl9KT0lOOwogICAgICAgIGlmIChzZWxzLnNpemUoKSA+IDEp\nCiAgICAgICAgICAgIHN0YXJ0ID0gMEw7CgogICAgICAgIGlmICh1bmlvbmFi\nbGUpIHsKICAgICAgICAgICAgVW5pb24gdW5pb24gPSBfc3RvcmUuZ2V0U1FM\nRmFjdG9yeSgpLm5ld1VuaW9uKAogICAgICAgICAgICAgICAgKFNlbGVjdFtd\nKSBzZWxzLnRvQXJyYXkobmV3IFNlbGVjdFtzZWxzLnNpemUoKV0pKTsKICAg\nICAgICAgICAgcG9wdWxhdGVVbmlvbih1bmlvbiwgbWFwcGluZ3MsIHN1YmNs\nYXNzZXMsIGZhY3RzLCBleHBzLCBzdGF0ZXMsIGN0eCwKICAgICAgICAgICAg\nICAgIGZhbHNlLCBlYWdlciwgc3RhcnQsIGVuZCk7CiAgICAgICAgICAgIGlm\nICh1bmlvbi5pc1VuaW9uKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIFN0cmluZ1tdIHt1bmlvbi50b1NlbGVjdChmYWxzZSwgZmV0Y2gpLmdldFNR\nTCh0cnVlKX07CiAgICAgICAgICAgIHNlbHMgPSBBcnJheXMuYXNMaXN0KHVu\naW9uLmdldFNlbGVjdHMoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgU2VsZWN0IHNlbDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGlk\neCA9IDA7IGkgPCBzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBzZWwgPSAoU2VsZWN0KSBzZWxzLmdldChpKTsKICAgICAgICAgICAgICAg\nIHBvcHVsYXRlU2VsZWN0KHNlbCwgKENsYXNzTWFwcGluZykgc2VsTWFwcGlu\nZ3MuZ2V0KGkpLAogICAgICAgICAgICAgICAgICAgIHN1YmNsYXNzQml0cy5n\nZXQoaSksIChKREJDRXhwcmVzc2lvbkZhY3RvcnkpIGZhY3RzW2lkeF0sCiAg\nICAgICAgICAgICAgICAgICAgZXhwc1tpZHhdLCBzdGF0ZXNbaWR4XSwgY3R4\nLCBmYWxzZSwgZWFnZXIsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICAgICAg\naWYgKG5leHRCaXRzLmdldChpKSkKICAgICAgICAgICAgICAgICAgICBpZHgr\nKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgU3RyaW5nW10g\nc3FsID0gbmV3IFN0cmluZ1tzZWxzLnNpemUoKV07CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzZWxzLnNpemUoKTsgaSsrKQogICAgICAgICAgICBz\ncWxbaV0gPSAoKFNlbGVjdCkgc2Vscy5nZXQoaSkpLnRvU2VsZWN0KGZhbHNl\nLCBmZXRjaCkuZ2V0U1FMKHRydWUpOwogICAgICAgIHJldHVybiBzcWw7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJv\ndmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAg\nICogaW1wbGVtZW50YXRpb24gb2YgZXhlY3V0aW5nIHVwZGF0ZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGludCBleGVjdXRlVXBkYXRlKENvbm5lY3Rpb24g\nY29ubiwgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgIFNRTEJ1\nZmZlciBzcWxCdWYsIGJvb2xlYW4gaXNVcGRhdGUpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlVXBkYXRlKCk7\nCiAgICB9CiAgICAgICAgICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhv\nZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJD\nLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3Rh\ndGVtZW50LgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1l\nbnQgcHJlcGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4sIFNRTEJ1ZmZl\nciBzcWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4pOwogICAgfSAgICAK\nfQo=\n","encoding":"base64"}

