{"sha":"a47794298025826ae84f2f42e893488aa257d9bc","node_id":"MDQ6QmxvYjIwNjM2NDphNDc3OTQyOTgwMjU4MjZhZTg0ZjJmNDJlODkzNDg4YWEyNTdkOWJj","size":7340,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a47794298025826ae84f2f42e893488aa257d9bc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSmF2YVNRTFR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nQ29udGFpbmVyRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkxSU01hcEZpZWxkU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxh\ndGlvblN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkZpbHRlcnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5D\nbGFzc01ldGFEYXRhOwoKLyoqCiAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRo\nZSBnaXZlbiBtYXAncyBrZXkuCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hv\nbW1lYXV4CiAqLwpjbGFzcyBHZXRNYXBWYWx1ZQogICAgZXh0ZW5kcyBBYnN0\ncmFjdFZhbCB7CgogICAgcHJpdmF0ZSBmaW5hbCBWYWwgX21hcDsKICAgIHBy\naXZhdGUgZmluYWwgVmFsIF9rZXk7CiAgICBwcml2YXRlIGZpbmFsIFN0cmlu\nZyBfYWxpYXM7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgX21ldGEgPSBu\ndWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfY2FzdCA9IG51bGw7CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3Rvci4gUHJvdmlkZSB0aGUgbWFwIGFuZCBrZXkg\ndG8gb3BlcmF0ZSBvbi4KICAgICAqLwogICAgcHVibGljIEdldE1hcFZhbHVl\nKFZhbCBtYXAsIFZhbCBrZXksIFN0cmluZyBhbGlhcykgewogICAgICAgIF9t\nYXAgPSBtYXA7CiAgICAgICAgX2tleSA9IGtleTsKICAgICAgICBfYWxpYXMg\nPSBhbGlhczsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRN\nZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0TWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgX21ldGEgPSBtZXRhOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzVmFyaWFibGUoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKCkgewogICAgICAgIGlmIChf\nY2FzdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2Nhc3Q7CiAgICAg\nICAgcmV0dXJuIF9tYXAuZ2V0VHlwZSgpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEltcGxpY2l0VHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAgX2Nh\nc3QgPSB0eXBlOwogICAgfQoKICAgIHB1YmxpYyBFeHBTdGF0ZSBpbml0aWFs\naXplKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBpbnQgZmxhZ3MpIHsK\nICAgICAgICBFeHBTdGF0ZSBtYXBTdGF0ZSA9IF9tYXAuaW5pdGlhbGl6ZShz\nZWwsIGN0eCwgMCk7CiAgICAgICAgRXhwU3RhdGUga2V5U3RhdGUgPSBfa2V5\nLmluaXRpYWxpemUoc2VsLCBjdHgsIDApOwogICAgICAgIHJldHVybiBuZXcg\nR2V0TWFwVmFsdWVFeHBTdGF0ZShzZWwuYW5kKG1hcFN0YXRlLmpvaW5zLCBr\nZXlTdGF0ZS5qb2lucyksCiAgICAgICAgICAgIG1hcFN0YXRlLCBrZXlTdGF0\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHByZXNzaW9uIHN0YXRlLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBHZXRNYXBWYWx1ZUV4\ncFN0YXRlCiAgICAgICAgZXh0ZW5kcyBFeHBTdGF0ZSB7CgogICAgICAgIHB1\nYmxpYyBmaW5hbCBFeHBTdGF0ZSBtYXBTdGF0ZTsKICAgICAgICBwdWJsaWMg\nZmluYWwgRXhwU3RhdGUga2V5U3RhdGU7CgogICAgICAgIHB1YmxpYyBHZXRN\nYXBWYWx1ZUV4cFN0YXRlKEpvaW5zIGpvaW5zLCBFeHBTdGF0ZSBtYXBTdGF0\nZSwgCiAgICAgICAgICAgIEV4cFN0YXRlIGtleVN0YXRlKSB7CiAgICAgICAg\nICAgIHN1cGVyKGpvaW5zKTsKICAgICAgICAgICAgdGhpcy5tYXBTdGF0ZSA9\nIG1hcFN0YXRlOwogICAgICAgICAgICB0aGlzLmtleVN0YXRlID0ga2V5U3Rh\ndGU7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9EYXRh\nU3RvcmVWYWx1ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3Rh\ndGUgc3RhdGUsIAogICAgICAgIE9iamVjdCB2YWwpIHsKICAgICAgICBHZXRN\nYXBWYWx1ZUV4cFN0YXRlIGdzdGF0ZSA9IChHZXRNYXBWYWx1ZUV4cFN0YXRl\nKSBzdGF0ZTsKICAgICAgICByZXR1cm4gX21hcC50b0RhdGFTdG9yZVZhbHVl\nKHNlbCwgY3R4LCBnc3RhdGUubWFwU3RhdGUsIHZhbCk7CiAgICB9CgoKICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0\neCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gcGtzKSB7CiAg\nICAgICAgc2VsLnNlbGVjdChuZXdTUUxCdWZmZXIoc2VsLCBjdHgsIHN0YXRl\nKS5hcHBlbmQoIiBBUyAiKS5hcHBlbmQoX2FsaWFzKSwKICAgICAgICAgICAg\ndGhpcyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0Q29sdW1ucyhT\nZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsCiAg\nICAgICAgYm9vbGVhbiBwa3MpIHsKICAgICAgICBHZXRNYXBWYWx1ZUV4cFN0\nYXRlIGdzdGF0ZSA9IChHZXRNYXBWYWx1ZUV4cFN0YXRlKSBzdGF0ZTsKICAg\nICAgICBfbWFwLnNlbGVjdENvbHVtbnMoc2VsLCBjdHgsIGdzdGF0ZS5tYXBT\ndGF0ZSwgdHJ1ZSk7CiAgICAgICAgX2tleS5zZWxlY3RDb2x1bW5zKHNlbCwg\nY3R4LCBnc3RhdGUua2V5U3RhdGUsIHRydWUpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4\ncFN0YXRlIHN0YXRlKSB7CiAgICAgICAgc2VsLmdyb3VwQnkobmV3U1FMQnVm\nZmVyKHNlbCwgY3R4LCBzdGF0ZSkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIG9yZGVyQnkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRl\nIHN0YXRlLCAKICAgICAgICBib29sZWFuIGFzYykgewogICAgICAgIHNlbC5v\ncmRlckJ5KF9hbGlhcywgYXNjLCBmYWxzZSk7CiAgICB9CgogICAgcHJpdmF0\nZSBTUUxCdWZmZXIgbmV3U1FMQnVmZmVyKFNlbGVjdCBzZWwsIEV4cENvbnRl\neHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSkgewogICAgICAgIGNhbGN1bGF0ZVZh\nbHVlKHNlbCwgY3R4LCBzdGF0ZSwgbnVsbCwgbnVsbCk7CiAgICAgICAgU1FM\nQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIoY3R4LnN0b3JlLmdldERCRGlj\ndGlvbmFyeSgpKTsKICAgICAgICBhcHBlbmRUbyhzZWwsIGN0eCwgc3RhdGUs\nIGJ1ZiwgMCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGxvYWQoRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRl\nLCBSZXN1bHQgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBGaWx0ZXJzLmNvbnZlcnQocmVzLmdldE9iamVjdCh0\naGlzLAogICAgICAgICAgICBKYXZhU1FMVHlwZXMuSkRCQ19ERUZBVUxULCBu\ndWxsKSwgZ2V0VHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjYWxj\ndWxhdGVWYWx1ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3Rh\ndGUgc3RhdGUsIAogICAgICAgIFZhbCBvdGhlciwgRXhwU3RhdGUgb3RoZXJT\ndGF0ZSkgewogICAgICAgIEdldE1hcFZhbHVlRXhwU3RhdGUgZ3N0YXRlID0g\nKEdldE1hcFZhbHVlRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIF9tYXAuY2Fs\nY3VsYXRlVmFsdWUoc2VsLCBjdHgsIGdzdGF0ZS5tYXBTdGF0ZSwgbnVsbCwg\nbnVsbCk7CiAgICAgICAgX2tleS5jYWxjdWxhdGVWYWx1ZShzZWwsIGN0eCwg\nZ3N0YXRlLmtleVN0YXRlLCBudWxsLCBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgaW50IGxlbmd0aChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhw\nU3RhdGUgc3RhdGUpIHsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBhcHBlbmRUbyhTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0\neCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwsIGlu\ndCBpbmRleCkgewogICAgICAgIGlmICghKF9tYXAgaW5zdGFuY2VvZiBQQ1Bh\ndGgpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRp\nb25FeGNlcHRpb24oKTsKICAgICAgICBpZiAoIShfa2V5IGluc3RhbmNlb2Yg\nQ29uc3QpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVy\nYXRpb25FeGNlcHRpb24oKTsKCiAgICAgICAgR2V0TWFwVmFsdWVFeHBTdGF0\nZSBnc3RhdGUgPSAoR2V0TWFwVmFsdWVFeHBTdGF0ZSkgc3RhdGU7CiAgICAg\nICAgUENQYXRoIG1hcCA9IChQQ1BhdGgpIF9tYXA7CiAgICAgICAgT2JqZWN0\nIGtleSA9ICgoQ29uc3QpIF9rZXkpLmdldFZhbHVlKGN0eCwgZ3N0YXRlLmtl\neVN0YXRlKTsKICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQgPSBtYXAuZ2V0\nRmllbGRNYXBwaW5nKGdzdGF0ZS5tYXBTdGF0ZSk7CiAgICAgICAgaWYgKCEo\nZmllbGQuZ2V0U3RyYXRlZ3koKSBpbnN0YW5jZW9mIExSU01hcEZpZWxkU3Ry\nYXRlZ3kpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVy\nYXRpb25FeGNlcHRpb24oKTsKCiAgICAgICAgTFJTTWFwRmllbGRTdHJhdGVn\neSBzdHJhdCA9IChMUlNNYXBGaWVsZFN0cmF0ZWd5KSBmaWVsZC5nZXRTdHJh\ndGVneSgpOwogICAgICAgIENsYXNzTWFwcGluZ1tdIGNsc3MgPSBzdHJhdC5n\nZXRJbmRlcGVuZGVudFZhbHVlTWFwcGluZ3ModHJ1ZSk7CiAgICAgICAgaWYg\nKGNsc3MgIT0gbnVsbCAmJiBjbHNzLmxlbmd0aCA+IDEpCiAgICAgICAgICAg\nIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmpvaW5hYmxlKGZpZWxkKTsK\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IChjbHNzLmxlbmd0aCA9PSAw\nKSA/IG51bGwgOiBjbHNzWzBdOwogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBz\ndHJhdC5nZXRKb2luRm9yZWlnbktleShjbHMpOwoKICAgICAgICAvLyBtYW51\nYWxseSBjcmVhdGUgYSBzdWJzZWxlY3QgZm9yIHRoZSBNYXAncyB2YWx1ZQog\nICAgICAgIHNxbC5hcHBlbmQoIihTRUxFQ1QgIik7CiAgICAgICAgQ29sdW1u\nW10gdmFsdWVzID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB2YWx1ZXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGkgPiAwKQogICAgICAgICAg\nICAgICAgc3FsLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgc3FsLmFwcGVu\nZCh2YWx1ZXNbaV0uZ2V0RnVsbE5hbWUoKSk7CiAgICAgICAgfQogICAgICAg\nIHNxbC5hcHBlbmQoIiBGUk9NICIpLmFwcGVuZCh2YWx1ZXNbMF0uZ2V0VGFi\nbGUoKS5nZXRGdWxsTmFtZSgpKS4KICAgICAgICAgICAgYXBwZW5kKCIgV0hF\nUkUgIik7CgogICAgICAgIC8vIGFkZCBpbiB0aGUgam9pbnMKICAgICAgICBD\nb250YWluZXJGaWVsZFN0cmF0ZWd5LmFwcGVuZFVuYWxpYXNlZEpvaW4oc3Fs\nLCBzZWwsIG51bGwsIAogICAgICAgICAgICBjdHguc3RvcmUuZ2V0REJEaWN0\naW9uYXJ5KCksIGZpZWxkLCBmayk7CiAgICAgICAgc3FsLmFwcGVuZCgiIEFO\nRCAiKTsKCiAgICAgICAga2V5ID0gc3RyYXQudG9LZXlEYXRhU3RvcmVWYWx1\nZShrZXksIGN0eC5zdG9yZSk7CiAgICAgICAgQ29sdW1uW10gY29scyA9IHN0\ncmF0LmdldEtleUNvbHVtbnMoY2xzKTsKICAgICAgICBPYmplY3RbXSB2YWxz\nID0gKGNvbHMubGVuZ3RoID09IDEpID8gbnVsbCA6IChPYmplY3RbXSkga2V5\nOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgc3FsLmFwcGVuZChjb2xzW2ldLmdldEZ1bGxO\nYW1lKCkpOwogICAgICAgICAgICBpZiAodmFscyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgc3FsLmFwcGVuZCgoa2V5ID09IG51bGwpID8gIiBJUyAiIDog\nIiA9ICIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZFZhbHVlKGtleSwg\nY29sc1tpXSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNx\nbC5hcHBlbmQoKHZhbHNbaV0gPT0gbnVsbCkgPyAiIElTICIgOiAiID0gIiku\nCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kVmFsdWUodmFsc1tpXSwgY29s\nc1tpXSk7CiAgICAgICAgfQogICAgICAgIHNxbC5hcHBlbmQoIikiKTsKICAg\nIH0KfQo=\n","encoding":"base64"}

