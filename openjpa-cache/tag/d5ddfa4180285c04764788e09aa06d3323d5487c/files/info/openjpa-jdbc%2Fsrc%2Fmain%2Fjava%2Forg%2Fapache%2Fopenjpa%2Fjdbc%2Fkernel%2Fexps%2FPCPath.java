{"sha":"0cff107e4814d26fe0dfa7604b791eb216f35b4c","node_id":"MDQ6QmxvYjIwNjM2NDowY2ZmMTA3ZTQ4MTRkMjZmZTBkZmE3NjA0Yjc5MWViMjE2ZjM1YjRj","size":29273,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0cff107e4814d26fe0dfa7604b791eb216f35b4c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc3Fs\nLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3RJdGVyYXRvcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5P\nYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWdu\nS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNj\naGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9p\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEJ1ZmZl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5YTUxNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247Cgov\nKioKICogQSBwYXRoIHJlcHJlc2VudHMgYSB0cmF2ZXJzYWwgaW50byBmaWVs\nZHMgb2YgYSBjYW5kaWRhdGUgb2JqZWN0LgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKi8KcHVibGljIGNsYXNzIFBDUGF0aAogICAgZXh0ZW5kcyBBYnN0\ncmFjdFZhbAogICAgaW1wbGVtZW50cyBKREJDUGF0aCB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IFBBVEggPSAwOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEJPVU5EX1ZBUiA9IDE7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgVU5CT1VORF9WQVIgPSAyOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFVOQUNDRVNTRURfVkFSID0gMzsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBYUEFUSCA9IDQ7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZShQQ1BhdGguY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NNYXBw\naW5nIF9jYW5kaWRhdGU7CiAgICBwcml2YXRlIENsYXNzTWFwcGluZyBfY2xh\nc3MgPSBudWxsOwogICAgcHJpdmF0ZSBMaW5rZWRMaXN0IF9hY3Rpb25zID0g\nbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfa2V5ID0gZmFsc2U7CiAgICBw\ncml2YXRlIGludCBfdHlwZSA9IFBBVEg7CiAgICBwcml2YXRlIFN0cmluZyBf\ndmFyTmFtZSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzIF9jYXN0ID0gbnVs\nbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2lkID0gZmFsc2U7CiAgICBwcml2\nYXRlIEZpZWxkTWV0YURhdGEgX3htbGZpZWxkID0gbnVsbDsKCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHBhdGggc3RhcnRpbmcgd2l0aCB0aGUgJ3RoaXMn\nIHB0ci4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFzc01hcHBpbmcg\ndHlwZSkgewogICAgICAgIF9jYW5kaWRhdGUgPSB0eXBlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBmcm9tIHRoZSBn\naXZlbiB2YXJpYWJsZS4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFz\nc01hcHBpbmcgY2FuZGlkYXRlLCBWYXJpYWJsZSB2YXIpIHsKICAgICAgICBf\nY2FuZGlkYXRlID0gY2FuZGlkYXRlOwogICAgICAgIF9hY3Rpb25zID0gbmV3\nIExpbmtlZExpc3QoKTsKCiAgICAgICAgUENQYXRoIG90aGVyID0gdmFyLmdl\ndFBDUGF0aCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9u\nKCk7CiAgICAgICAgaWYgKG90aGVyID09IG51bGwpIHsKICAgICAgICAgICAg\nX3R5cGUgPSBVTkJPVU5EX1ZBUjsKICAgICAgICAgICAgYWN0aW9uLm9wID0g\nQWN0aW9uLlVOQk9VTkRfVkFSOwogICAgICAgICAgICBhY3Rpb24uZGF0YSA9\nIHZhcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBib3VuZCB2\nYXJpYWJsZTsgY29weSBwYXRoCiAgICAgICAgICAgIF90eXBlID0gVU5BQ0NF\nU1NFRF9WQVI7CiAgICAgICAgICAgIF9hY3Rpb25zLmFkZEFsbChvdGhlci5f\nYWN0aW9ucyk7CiAgICAgICAgICAgIF9rZXkgPSBvdGhlci5fa2V5OwoKICAg\nICAgICAgICAgYWN0aW9uLm9wID0gQWN0aW9uLlZBUjsKICAgICAgICAgICAg\nYWN0aW9uLmRhdGEgPSB2YXIuZ2V0TmFtZSgpOwogICAgICAgIH0KICAgICAg\nICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IHZhci5n\nZXRUeXBlKCk7IC8vIGluaXRpYWwgdHlwZSBpcyB2YXIgdHlwZQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBmcm9tIHRo\nZSBnaXZlbiBzdWJxdWVyeS4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChT\ndWJRIHN1YikgewogICAgICAgIF9jYW5kaWRhdGUgPSBzdWIuZ2V0Q2FuZGlk\nYXRlKCk7CiAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2VkTGlzdCgpOwoK\nICAgICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwogICAgICAg\nIGFjdGlvbi5vcCA9IEFjdGlvbi5TVUJRVUVSWTsKICAgICAgICBhY3Rpb24u\nZGF0YSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAgICAgIF9hY3Rp\nb25zLmFkZChhY3Rpb24pOwogICAgICAgIF9jYXN0ID0gc3ViLmdldFR5cGUo\nKTsgLy8gaW5pdGlhbCB0eXBlIGlzIHN1YnF1ZXJ5IHR5cGUKICAgICAgICBf\ndmFyTmFtZSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBwYXRoIGFzIGEgYmluZGluZyBvZiB0aGUg\nZ2l2ZW4gdmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZFZh\ncmlhYmxlQWN0aW9uKFZhcmlhYmxlIHZhcikgewogICAgICAgIF92YXJOYW1l\nID0gdmFyLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0cnVlIGlmIHRoaXMgaXMgYSBib3VuZCB2YXJpYWJsZSB0aGF0IGhhcyBu\nb3QgYmVlbiBhY2Nlc3NlZAogICAgICogYWZ0ZXIgYmluZGluZy4gVXNlZnVs\nIGZvciBmaWx0ZXJzIGxpa2UKICAgICAqICJjb2xsLmNvbnRhaW5zICh2YXIp\nICZhbXA7JmFtcDsgdmFyID09IG51bGwiLCB3aGljaCBzaG91bGQgcmVhbGx5\nCiAgICAgKiBqdXN0IGFjdCBsaWtlICJjb2xsLmNvbnRhaW5zIChudWxsKSIu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVW5hY2Nlc3NlZFZhcmlh\nYmxlKCkgewogICAgICAgIHJldHVybiBfdHlwZSA9PSBVTkFDQ0VTU0VEX1ZB\nUjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoaXMg\naXMgYSBwYXRoIGludm9sdmluZyBhIHZhcmlhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1ZhcmlhYmxlUGF0aCgpIHsKICAgICAgICByZXR1\ncm4gX3R5cGUgIT0gUEFUSDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRo\naXMgcGF0aCBpcyBwYXJ0IG9mIGEgY29udGFpbnMgY2xhdXNlLCB0aGVuIGFs\naWFzIGl0IHRvIHRoZQogICAgICogcHJvcGVyIGNvbnRhaW5zIGlkIGJlZm9y\nZSBpbml0aWFsaXphdGlvbi4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9u\naXplZCB2b2lkIHNldENvbnRhaW5zSWQoU3RyaW5nIGlkKSB7CiAgICAgICAg\naWYgKF9jaWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gdHJl\nYXQgaXQganVzdCBsaWtlIGEgdW5pcXVlIHZhcmlhYmxlCiAgICAgICAgQWN0\naW9uIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBhY3Rpb24ub3Ag\nPSBBY3Rpb24uVkFSOwogICAgICAgIGFjdGlvbi5kYXRhID0gaWQ7CiAgICAg\nICAgaWYgKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIF9hY3Rpb25z\nID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBfYWN0aW9ucy5hZGQoYWN0\naW9uKTsKICAgICAgICBfY2lkID0gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4g\nX2NsYXNzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1ldGFEYXRhKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9jbGFzcyA9IChDbGFzc01h\ncHBpbmcpIG1ldGE7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNLZXko\nKSB7CiAgICAgICAgcmV0dXJuIF9rZXk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBib29sZWFuIGlzWFBhdGgoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlID09\nIFhQQVRIOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIGdldFhQYXRo\nKCkgewogICAgICAgIFN0cmluZ0J1ZmZlciB4cGF0aCA9IG5ldyBTdHJpbmdC\ndWZmZXIoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uOwogICAgICAgIEl0ZXJh\ndG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7CiAgICAgICAgCiAgICAg\nICAgLy8gU2tpcCB2YXJpYWJsZSBhY3Rpb25zIHNpbmNlIHRoZXkgYXJlIG5v\ndCBwYXJ0IG9mIHRoZSB4cGF0aAogICAgICAgIC8vIHVudGlsIHdlIHJlYWNo\nIHRoZSBmaXJzdCB4cGF0aCBhY3Rpb24uCiAgICAgICAgLy8gVGhlIGZpcnN0\nIHhwYXRoIGFjdGlvbiBtYXBzIHRvIHRoZSByb290IG9mIGFuIHhtbCBkb2N1\nbWVudC4KICAgICAgICBkbyAKICAgICAgICAgICAgYWN0aW9uID0gKEFjdGlv\nbikgaXRyLm5leHQoKTsgCiAgICAgICAgd2hpbGUgKGFjdGlvbi5vcCAhPSBB\nY3Rpb24uR0VUX1hQQVRIKTsKICAgICAgICAKICAgICAgICAvLyBTa2lwIFht\nbFJvb3RFbGVtZW50OgogICAgICAgIC8vIFdlIGNhbid0IHJlbHkgb24gdGhl\nIGFjY3VyYWN5IG9mIHRoZSBuYW1lIG9mIHRoZSByb290IGVsZW1lbnQsCiAg\nICAgICAgLy8gYmVjYXVzZSBpdCBjb3VsZCBiZSBzZXQgdG8gc29tZSBkZWZh\ndWx0IGJ5IEpBWEIgWE1MIEJpbmRpbmcuCiAgICAgICAgLy8gVGhlIGNhbGxl\ncihEQkRpY3Rpb25hcnkpIHNob3VsZCBzdGFydCB3aXRoICIvKiIgb3IgIi8q\nLyIsCiAgICAgICAgLy8gd2UgYnVpbGQgdGhlIHJlbWFpbmluZyB4cGF0aCB0\naGF0IGZvbGxvd3MgdGhlIHJvb3QgZWxlbWVudC4KICAgICAgICB3aGlsZSAo\naXRyLmhhc05leHQoKSkgewogICAgICAgICAgICBhY3Rpb24gPSAoQWN0aW9u\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoKChYTUxNZXRhRGF0YSkg\nYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSAhPSBudWxsKSAgICAgICAgICAg\nICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aC5hcHBlbmQoKChYTUxNZXRh\nRGF0YSkgYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIHhwYXRoLmFwcGVuZCgiKiIpOwogICAg\nICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIHhw\nYXRoLmFwcGVuZCgiLyIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4geHBh\ndGgudG9TdHJpbmcoKTsKICAgIH0KICAgIAogICAgcHVibGljIFN0cmluZyBn\nZXRQYXRoKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gKF92YXJOYW1lID09IG51bGwpID8gIiIgOiBfdmFy\nTmFtZSArICIuIjsKCiAgICAgICAgU3RyaW5nQnVmZmVyIHBhdGggPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGFjdGlvbiA9IChBY3Rpb24p\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0\naW9uLlZBUiB8fCBhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQogICAg\nICAgICAgICAgICAgcGF0aC5hcHBlbmQoYWN0aW9uLmRhdGEpOwogICAgICAg\nICAgICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlVOQk9VTkRfVkFS\nKQogICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoKChWYXJpYWJsZSkgYWN0\naW9uLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGVsc2UgCiAgICAg\nICAgICAgICAgICBwYXRoLmFwcGVuZCgoKEZpZWxkTWFwcGluZykgYWN0aW9u\nLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHBhdGguYXBwZW5kKCcu\nJyk7CiAgICAgICAgfQogICAgICAgIGlmIChfdmFyTmFtZSAhPSBudWxsKQog\nICAgICAgICAgICBwYXRoLmFwcGVuZChfdmFyTmFtZSkuYXBwZW5kKCcuJyk7\nCiAgICAgICAgcmV0dXJuIHBhdGgudG9TdHJpbmcoKTsKICAgIH0KCiAgICBw\ndWJsaWMgQ2xhc3NNYXBwaW5nIGdldENsYXNzTWFwcGluZyhFeHBTdGF0ZSBz\ndGF0ZSkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4\ncFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBfY2xhc3M7CiAgICAgICAgaWYgKF9r\nZXkpIHsKICAgICAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRLZXkoKS5n\nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAg\nIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFR5cGVN\nYXBwaW5nKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBz\ndGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFR5cGVNYXBwaW5n\nKCk7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVs\nZC5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RmllbGRNYXBwaW5nKEV4\ncFN0YXRlIHN0YXRlKSB7CiAgICAgICAgcmV0dXJuICgoUGF0aEV4cFN0YXRl\nKSBzdGF0ZSkuZmllbGQ7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdl\ndENvbHVtbnMoRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICBQYXRoRXhwU3Rh\ndGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAgaWYg\nKHBzdGF0ZS5jb2xzID09IG51bGwpCiAgICAgICAgICAgIHBzdGF0ZS5jb2xz\nID0gY2FsY3VsYXRlQ29sdW1ucyhwc3RhdGUpOwogICAgICAgIHJldHVybiBw\nc3RhdGUuY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBjb2x1bW5z\nIHVzZWQgYnkgdGhpcyBwYXRoLgogICAgICovCiAgICBwcml2YXRlIENvbHVt\nbltdIGNhbGN1bGF0ZUNvbHVtbnMoUGF0aEV4cFN0YXRlIHBzdGF0ZSkgewog\nICAgICAgIGlmIChfa2V5KSB7CiAgICAgICAgICAgIGlmICghcHN0YXRlLmpv\naW5lZFJlbCAKICAgICAgICAgICAgICAgICYmIHBzdGF0ZS5maWVsZC5nZXRL\nZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGpvaW5SZWxhdGlvbihwc3RhdGUsIF9rZXksIGZhbHNlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKHBzdGF0ZS5qb2luZWRSZWwgCiAgICAg\nICAgICAgICAgICAmJiBwc3RhdGUuZmllbGQuZ2V0S2V5KCkuZ2V0VHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICByZXR1cm4g\ncHN0YXRlLmZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRUeXBlTWFwcGluZygp\nLgogICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlDb2x1bW5zKCk7\nCiAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGlu\nZygpLmdldENvbHVtbnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHBzdGF0\nZS5maWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN3aXRjaCAocHN0YXRl\nLmZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkFSUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9\nIHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChwc3RhdGUuam9pbmVkUmVsICYmIGVsZW0uZ2V0VHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBlbGVtLmdldFR5cGVNYXBwaW5nKCkuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbS5nZXRD\nb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGVsZW0uZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29sdW1ucygpOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAg\naWYgKHBzdGF0ZS5qb2luZWRSZWwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlwZU1hcHBpbmcoKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlDb2x1bW5zKCk7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRD\nb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29sdW1ucygpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoX2NsYXNz\nID09IG51bGwpID8gU2NoZW1hcy5FTVBUWV9DT0xVTU5TCiAgICAgICAgICAg\nIDogX2NsYXNzLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNWYXJpYWJsZSgpIHsKICAgICAgICBpZiAoX2Fj\ndGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIEFjdGlvbiBhY3Rpb24gPSAoQWN0aW9uKSBfYWN0aW9ucy5nZXRMYXN0\nKCk7CiAgICAgICAgcmV0dXJuIGFjdGlvbi5vcCA9PSBBY3Rpb24uVU5CT1VO\nRF9WQVIgfHwgYWN0aW9uLm9wID09IEFjdGlvbi5WQVI7IAogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdldChGaWVsZE1ldGFEYXRhIGZpZWxkLCBib29sZWFu\nIG51bGxUcmF2ZXJzYWwpIHsKICAgICAgICBpZiAoX2FjdGlvbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2VkTGlzdCgpOwog\nICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7CiAgICAgICAg\nYWN0aW9uLm9wID0gKG51bGxUcmF2ZXJzYWwpID8gQWN0aW9uLkdFVF9PVVRF\nUiA6IEFjdGlvbi5HRVQ7CiAgICAgICAgYWN0aW9uLmRhdGEgPSBmaWVsZDsK\nICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBpZiAoX3R5\ncGUgPT0gVU5BQ0NFU1NFRF9WQVIpCiAgICAgICAgICAgIF90eXBlID0gQk9V\nTkRfVkFSOwogICAgICAgIF9jYXN0ID0gbnVsbDsKICAgICAgICBfa2V5ID0g\nZmFsc2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGdldChGaWVsZE1l\ndGFEYXRhIGZtZCwgWE1MTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChf\nYWN0aW9ucyA9PSBudWxsKQogICAgICAgICAgICBfYWN0aW9ucyA9IG5ldyBM\naW5rZWRMaXN0KCk7CiAgICAgICAgQWN0aW9uIGFjdGlvbiA9IG5ldyBBY3Rp\nb24oKTsKICAgICAgICBhY3Rpb24ub3AgPSBBY3Rpb24uR0VUX1hQQVRIOwog\nICAgICAgIGFjdGlvbi5kYXRhID0gbWV0YTsKICAgICAgICBfYWN0aW9ucy5h\nZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tl\neSA9IGZhbHNlOwogICAgICAgIF90eXBlID0gWFBBVEg7CiAgICAgICAgX3ht\nbGZpZWxkID0gZm1kOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBnZXQo\nWE1MTWV0YURhdGEgbWV0YSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICBBY3Rp\nb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwogICAgICAgIGFjdGlvbi5vcCA9\nIEFjdGlvbi5HRVRfWFBBVEg7CiAgICAgICAgYWN0aW9uLmRhdGEgPSBtZXRh\nLmdldEZpZWxkTWFwcGluZyhuYW1lKTsKICAgICAgICBfYWN0aW9ucy5hZGQo\nYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tleSA9\nIGZhbHNlOwogICAgICAgIF90eXBlID0gWFBBVEg7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBYTUxNZXRhRGF0YSBnZXRYbWxNYXBwaW5nKCkgewogICAgICAg\nIEFjdGlvbiBhY3QgPSAoQWN0aW9uKSBfYWN0aW9ucy5nZXRMYXN0KCk7CiAg\nICAgICAgaWYgKGFjdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKFhN\nTE1ldGFEYXRhKSBhY3QuZGF0YTsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgZ2V0S2V5KCkgewog\nICAgICAgIGlmIChfY2lkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIGNoYW5nZSB0aGUgbGFzdCBhY3Rpb24gdG8gYSBnZXQga2V5CiAgICAg\nICAgQWN0aW9uIGFjdGlvbiA9IChBY3Rpb24pIF9hY3Rpb25zLmdldExhc3Qo\nKTsKICAgICAgICBhY3Rpb24ub3AgPSBBY3Rpb24uR0VUX0tFWTsKICAgICAg\nICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tleSA9IHRydWU7CiAgICB9Cgog\nICAgcHVibGljIEZpZWxkTWV0YURhdGEgbGFzdCgpIHsKICAgICAgICBBY3Rp\nb24gYWN0ID0gbGFzdEZpZWxkQWN0aW9uKCk7CiAgICAgICAgcmV0dXJuIChh\nY3QgPT0gbnVsbCkgPyBudWxsIDogaXNYUGF0aCgpID8gX3htbGZpZWxkIDoK\nICAgICAgICAgICAgKEZpZWxkTWV0YURhdGEpIGFjdC5kYXRhOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsYXN0IGFjdGlvbiB0aGF0IGdl\ndHMgYSBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBBY3Rpb24gbGFzdEZp\nZWxkQWN0aW9uKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKGlzWFBhdGgo\nKSkKICAgICAgICAgICAgcmV0dXJuIChBY3Rpb24pIF9hY3Rpb25zLmdldExh\nc3QoKTsKICAgICAgICAKICAgICAgICBMaXN0SXRlcmF0b3IgaXRyID0gX2Fj\ndGlvbnMubGlzdEl0ZXJhdG9yKF9hY3Rpb25zLnNpemUoKSk7CiAgICAgICAg\nQWN0aW9uIHByZXY7CiAgICAgICAgd2hpbGUgKGl0ci5oYXNQcmV2aW91cygp\nKSB7CiAgICAgICAgICAgIHByZXYgPSAoQWN0aW9uKSBpdHIucHJldmlvdXMo\nKTsKICAgICAgICAgICAgaWYgKHByZXYub3AgPT0gQWN0aW9uLkdFVCB8fCBw\ncmV2Lm9wID09IEFjdGlvbi5HRVRfT1VURVIKICAgICAgICAgICAgICAgIHx8\nIHByZXYub3AgPT0gQWN0aW9uLkdFVF9LRVkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gcHJldjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHVibGljIENsYXNzIGdldFR5cGUoKSB7CiAgICAgICAgaWYg\nKF9jYXN0ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FzdDsKICAg\nICAgICBBY3Rpb24gYWN0ID0gbGFzdEZpZWxkQWN0aW9uKCk7CiAgICAgICAg\naWYgKGFjdCAhPSBudWxsICYmIGFjdC5vcCA9PSBBY3Rpb24uR0VUX1hQQVRI\nKQogICAgICAgICAgICByZXR1cm4gKChYTUxNZXRhRGF0YSkgYWN0LmRhdGEp\nLmdldFR5cGUoKTsKICAgICAgICAKICAgICAgICBGaWVsZE1ldGFEYXRhIGZs\nZCA9IChhY3QgPT0gbnVsbCkgPyBudWxsIDogKEZpZWxkTWV0YURhdGEpIGFj\ndC5kYXRhOwogICAgICAgIGJvb2xlYW4ga2V5ID0gYWN0ICE9IG51bGwgJiYg\nYWN0Lm9wID09IEFjdGlvbi5HRVRfS0VZOwogICAgICAgIGlmIChmbGQgIT0g\nbnVsbCkgewogICAgICAgICAgICBzd2l0Y2ggKGZsZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFS\nUkFZOgogICAgICAgICAgICAgICAgICAgIGlmIChmbGQuZ2V0RGVjbGFyZWRU\neXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgICAg\nIHx8IGZsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBCeXRlW10uY2xhc3MKICAg\nICAgICAgICAgICAgICAgICAgICAgfHwgZmxkLmdldERlY2xhcmVkVHlwZSgp\nID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBm\nbGQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGQuZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRFbGVt\nZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRLZXkoKS5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmxkLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGZsZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmbGQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9jbGFzcyAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gX2NsYXNzLmdldERlc2NyaWJlZFR5cGUoKTsK\nICAgICAgICByZXR1cm4gT2JqZWN0LmNsYXNzOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldEltcGxpY2l0VHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAg\nX2Nhc3QgPSB0eXBlOwogICAgfQoKICAgIHB1YmxpYyBFeHBTdGF0ZSBpbml0\naWFsaXplKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBpbnQgZmxhZ3Mp\nIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gbmV3IFBhdGhFeHBT\ndGF0ZShzZWwubmV3Sm9pbnMoKSk7CiAgICAgICAgYm9vbGVhbiBrZXkgPSBm\nYWxzZTsKICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIgPSBmYWxzZTsKICAg\nICAgICBDbGFzc01hcHBpbmcgcmVsID0gX2NhbmRpZGF0ZTsKCiAgICAgICAg\nLy8gaXRlcmF0ZSB0byB0aGUgZmluYWwgZmllbGQKICAgICAgICBDbGFzc01h\ncHBpbmcgb3duZXI7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGZyb20sIHRvOwog\nICAgICAgIEFjdGlvbiBhY3Rpb247CiAgICAgICAgVmFyaWFibGUgdmFyOwog\nICAgICAgIEl0ZXJhdG9yIGl0ciA9IChfYWN0aW9ucyA9PSBudWxsKSA/IG51\nbGwgOiBfYWN0aW9ucy5pdGVyYXRvcigpOwogICAgICAgIEZpZWxkTWFwcGlu\nZyBmaWVsZDsKICAgICAgICB3aGlsZSAoaXRyICE9IG51bGwgJiYgaXRyLmhh\nc05leHQoKSkgewogICAgICAgICAgICBhY3Rpb24gPSAoQWN0aW9uKSBpdHIu\nbmV4dCgpOwoKICAgICAgICAgICAgLy8gdHJlYXQgc3VicXVlcmllcyBsaWtl\nIHZhcmlhYmxlcyBmb3IgYWxpYXMgZ2VuZXJhdGlvbiBwdXJwb3NlcwogICAg\nICAgICAgICBpZiAoYWN0aW9uLm9wID09IEFjdGlvbi5WQVIpCiAgICAgICAg\nICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0VmFyaWFi\nbGUoKFN0cmluZykgYWN0aW9uLmRhdGEpOwogICAgICAgICAgICBlbHNlIGlm\nIChhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQogICAgICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFN1YnNlbGVjdCgo\nU3RyaW5nKSBhY3Rpb24uZGF0YSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGFj\ndGlvbi5vcCA9PSBBY3Rpb24uVU5CT1VORF9WQVIpIHsKICAgICAgICAgICAg\nICAgIC8vIHVuYm91bmQgdmFycyBhcmUgY3Jvc3Mtam9pbmVkIHRvIHRoZSBj\nYW5kaWRhdGUgdGFibGUKICAgICAgICAgICAgICAgIHZhciA9IChWYXJpYWJs\nZSkgYWN0aW9uLmRhdGE7CiAgICAgICAgICAgICAgICByZWwgPSAoQ2xhc3NN\nYXBwaW5nKSB2YXIuZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHBz\ndGF0ZS5qb2lucyA9IHBzdGF0ZS5qb2lucy5zZXRWYXJpYWJsZSh2YXIuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0\nZS5qb2lucy5jcm9zc0pvaW4oX2NhbmRpZGF0ZS5nZXRUYWJsZSgpLCAKICAg\nICAgICAgICAgICAgICAgICByZWwuZ2V0VGFibGUoKSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBtb3ZlIHBhc3QgdGhlIHBy\nZXZpb3VzIGZpZWxkLCBpZiBhbnkKICAgICAgICAgICAgICAgIGZpZWxkID0g\nKGFjdGlvbi5vcCA9PSBBY3Rpb24uR0VUX1hQQVRIKSA/IChGaWVsZE1hcHBp\nbmcpIF94bWxmaWVsZCA6CiAgICAgICAgICAgICAgICAgICAgKEZpZWxkTWFw\ncGluZykgYWN0aW9uLmRhdGE7CiAgICAgICAgICAgICAgICBpZiAocHN0YXRl\nLmZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0\naGlzIGlzIHRoZSBzZWNvbmQtdG8tbGFzdCBmaWVsZCBhbmQgdGhlIGxhc3Qg\naXMKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcmVsYXRlZCBmaWVsZCB0\naGlzIGZpZWxkIGpvaW5zIHRvLCBubyBuZWVkIHRvCiAgICAgICAgICAgICAg\nICAgICAgLy8gdHJhdmVyc2U6IGp1c3QgdXNlIHRoaXMgZmllbGQncyBmayBj\nb2x1bW5zCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdHIuaGFzTmV4dCgp\nICYmIChmbGFncyAmIEpPSU5fUkVMKSA9PSAwCiAgICAgICAgICAgICAgICAg\nICAgICAgICYmIGlzSm9pbmVkRmllbGQocHN0YXRlLmZpZWxkLCBrZXksIGZp\nZWxkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwc3RhdGUuY21wZmll\nbGQgPSBmaWVsZDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlbCA9\nIHRyYXZlcnNlRmllbGQocHN0YXRlLCBrZXksIGZvcmNlT3V0ZXIsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBtYXJr\nIGlmIHRoZSBuZXh0IHRyYXZlcnNhbCBzaG91bGQgZ28gdGhyb3VnaAogICAg\nICAgICAgICAgICAgLy8gdGhlIGtleSByYXRoZXIgdGhhbiB2YWx1ZQogICAg\nICAgICAgICAgICAga2V5ID0gYWN0aW9uLm9wID09IEFjdGlvbi5HRVRfS0VZ\nOwogICAgICAgICAgICAgICAgZm9yY2VPdXRlciB8PSBhY3Rpb24ub3AgPT0g\nQWN0aW9uLkdFVF9PVVRFUjsKCiAgICAgICAgICAgICAgICAvLyBnZXQgbWFw\ncGluZyBmb3IgdGhlIGN1cnJlbnQgZmllbGQKICAgICAgICAgICAgICAgIHBz\ndGF0ZS5maWVsZCA9IGZpZWxkOwogICAgICAgICAgICAgICAgb3duZXIgPSBw\nc3RhdGUuZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCk7CiAgICAgICAgICAg\nICAgICBpZiAocHN0YXRlLmZpZWxkLmdldE1hbmFnZW1lbnQoKSAKICAgICAg\nICAgICAgICAgICAgICAhPSBGaWVsZE1hcHBpbmcuTUFOQUdFX1BFUlNJU1RF\nTlQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vbi1wZXJzLWZpZWxkIiwgCiAgICAgICAgICAgICAg\nICAgICAgICAgIHBzdGF0ZS5maWVsZCkpOwoKICAgICAgICAgICAgICAgIC8v\nIGZpbmQgdGhlIG1vc3QtZGVyaXZlZCB0eXBlIGJldHdlZW4gdGhlIGRlY2xh\ncmVkIHJlbGF0aW9uCiAgICAgICAgICAgICAgICAvLyB0eXBlIGFuZCB0aGUg\nZmllbGQncyBvd25lciwgYW5kIGpvaW4gZnJvbSB0aGF0IHR5cGUgdG8KICAg\nICAgICAgICAgICAgIC8vIHRoZSBsZXNzZXIgZGVyaXZlZCB0eXBlCiAgICAg\nICAgICAgICAgICBpZiAocmVsICE9IG93bmVyICYmIHJlbCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbC5nZXREZXNjcmliZWRUeXBl\nKCkuaXNBc3NpZ25hYmxlRnJvbQogICAgICAgICAgICAgICAgICAgICAgICAo\nb3duZXIuZ2V0RGVzY3JpYmVkVHlwZSgpKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBmcm9tID0gb3duZXI7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHRvID0gcmVsOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZyb20gPSByZWw7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHRvID0gb3duZXI7CiAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgICAgICBmb3IgKDsgZnJvbSAhPSBudWxsICYmIGZy\nb20gIT0gdG87CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBmcm9t\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpKQogICAgICAgICAg\nICAgICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBmcm9tLmpvaW5TdXBlcmNs\nYXNzKHBzdGF0ZS5qb2lucywgZmFsc2UpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgLy8gbm90aGluZyBtb3JlIHRvIGRvIGZyb20gaGVy\nZSBvbiBhcyB3ZSBlbmNvdW50ZXJlZCBhbiB4cGF0aCBhY3Rpb24KICAgICAg\nICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLkdFVF9YUEFUSCkK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBpZiAoX3Zhck5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFZhcmlhYmxlKF92\nYXJOYW1lKTsKCiAgICAgICAgLy8gaWYgd2UncmUgbm90IGNvbXBhcmluZyB0\nbyBudWxsIG9yIGRvaW5nIGFuIGlzRW1wdHksIHRoZW4KICAgICAgICAvLyBq\nb2luIGludG8gdGhlIGRhdGEgb24gdGhlIGZpbmFsIGZpZWxkOyBvYnZpb3Vz\nbHkgd2UgY2FuJ3QgZG8gdGhlc2UKICAgICAgICAvLyBqb2lucyB3aGVuIGNv\nbXBhcmluZyB0byBudWxsIGIvYyB0aGUgd2hvbGUgcHVycG9zZSBpcyB0byBz\nZWUKICAgICAgICAvLyB3aGV0aGVyIHRoZSBqb2lucyBldmVuIGV4aXN0CiAg\nICAgICAgaWYgKChmbGFncyAmIE5VTExfQ01QKSA9PSAwKQogICAgICAgICAg\nICB0cmF2ZXJzZUZpZWxkKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVyLCB0cnVl\nKTsKICAgICAgICBwc3RhdGUuam9pbmVkUmVsID0gZmFsc2U7CiAgICAgICAg\naWYgKChmbGFncyAmIEpPSU5fUkVMKSAhPSAwKQogICAgICAgICAgICBqb2lu\nUmVsYXRpb24ocHN0YXRlLCBrZXksIGZvcmNlT3V0ZXIgfHwgKGZsYWdzICYg\nRk9SQ0VfT1VURVIpICE9IDAsCiAgICAgICAgICAgICAgICBmYWxzZSk7CiAg\nICAgICAgcmV0dXJuIHBzdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB3aGV0aGVyIHRoZSBnaXZlbiBzb3VyY2UgZmllbGQgam9pbnMgdG8g\ndGhlIGdpdmVuIHRhcmdldCBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBpc0pvaW5lZEZpZWxkKEZpZWxkTWFwcGluZyBzcmMs\nIGJvb2xlYW4ga2V5LCAKICAgICAgICBGaWVsZE1hcHBpbmcgdGFyZ2V0KSB7\nCiAgICAgICAgVmFsdWVNYXBwaW5nIHZtOwogICAgICAgIHN3aXRjaCAoc3Jj\nLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQVJSQVk6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgICAgICB2bSA9IHNyYy5nZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIHZtID0gKGtleSkgPyBzcmMu\nZ2V0S2V5TWFwcGluZygpIDogc3JjLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHZtID0gc3JjOwogICAgICAgIH0KICAgICAgICBpZiAo\ndm0uZ2V0Sm9pbkRpcmVjdGlvbigpICE9IFZhbHVlTWFwcGluZy5KT0lOX0ZP\nUldBUkQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBGb3Jl\naWduS2V5IGZrID0gdm0uZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIGlmIChm\nayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7IAogICAgICAg\nIAogICAgICAgIC8vIGZvcmVpZ24ga2V5IG11c3Qgam9pbiB0byB0YXJnZXQg\nY29sdW1ucwogICAgICAgIENvbHVtbltdIHJlbHMgPSBmay5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgQ29sdW1uW10gcGtzID0gdGFyZ2V0LmdldENvbHVtbnMo\nKTsgCiAgICAgICAgaWYgKHJlbHMubGVuZ3RoICE9IHBrcy5sZW5ndGgpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHJlbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmay5n\nZXRQcmltYXJ5S2V5Q29sdW1uKHJlbHNbaV0pICE9IHBrc1tpXSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEV4cHJlc3Npb24gc3RhdGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgUGF0aEV4cFN0YXRlCiAgICAg\nICAgZXh0ZW5kcyBFeHBTdGF0ZSB7CgogICAgICAgIHB1YmxpYyBGaWVsZE1h\ncHBpbmcgZmllbGQgPSBudWxsOwogICAgICAgIHB1YmxpYyBGaWVsZE1hcHBp\nbmcgY21wZmllbGQgPSBudWxsOwogICAgICAgIHB1YmxpYyBDb2x1bW5bXSBj\nb2xzID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBqb2luZWRSZWwg\nPSBmYWxzZTsKCiAgICAgICAgcHVibGljIFBhdGhFeHBTdGF0ZShKb2lucyBq\nb2lucykgewogICAgICAgICAgICBzdXBlcihqb2lucyk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogVHJhdmVyc2UgaW50byB0aGUgcHJldmlv\ndXMgZmllbGQgb2YgYSByZWxhdGlvbiBwYXRoLgogICAgICoKICAgICAqIEBw\nYXJhbSBsYXN0IHdoZXRoZXIgdGhpcyBpcyB0aGUgbGFzdCBmaWVsZCBpbiB0\naGUgcGF0aAogICAgICogQHJldHVybiB0aGUgbWFwcGluZyBvZiB0aGUgcmVs\nYXRlZCB0eXBlLCBvciBudWxsCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NN\nYXBwaW5nIHRyYXZlcnNlRmllbGQoUGF0aEV4cFN0YXRlIHBzdGF0ZSwgYm9v\nbGVhbiBrZXksIAogICAgICAgIGJvb2xlYW4gZm9yY2VPdXRlciwgYm9vbGVh\nbiBsYXN0KSB7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gdHJhdmVyc2Ug\naW50byBmaWVsZCB2YWx1ZQogICAgICAgIGlmIChrZXkpCiAgICAgICAgICAg\nIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5maWVsZC5qb2luS2V5KHBzdGF0ZS5q\nb2lucywgZm9yY2VPdXRlcik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBw\nc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pbihwc3RhdGUuam9pbnMs\nIGZvcmNlT3V0ZXIpOwoKICAgICAgICAvLyBpZiB0aGlzIGlzbid0IHRoZSBs\nYXN0IGZpZWxkLCB0cmF2ZXJzZSBpbnRvIHRoZSByZWxhdGlvbgogICAgICAg\nIGlmICghbGFzdCkKICAgICAgICAgICAgam9pblJlbGF0aW9uKHBzdGF0ZSwg\na2V5LCBmb3JjZU91dGVyLCB0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJuIHRo\nZSBtYXBpbmcgb2YgdGhlIHJlbGF0ZWQgdHlwZSwgaWYgYW55CiAgICAgICAg\naWYgKGtleSkKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRL\nZXlNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAocHN0\nYXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlQ29kZSgpID09IEphdmFU\neXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgcmV0\ndXJuIHBzdGF0ZS5maWVsZC5nZXRUeXBlTWFwcGluZygpOwogICAgfQoKICAg\nIC8qKgogICAgICogSm9pbiBpbnRvIHRoZSByZWxhdGlvbiByZXByZXNlbnRl\nZCBieSB0aGUgY3VycmVudCBmaWVsZCwgaWYgYW55LgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgam9pblJlbGF0aW9uKFBhdGhFeHBTdGF0ZSBwc3RhdGUs\nIGJvb2xlYW4ga2V5LCAKICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIsIGJv\nb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoa2V5KQog\nICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pbktl\neVJlbGF0aW9uKHBzdGF0ZS5qb2lucywgCiAgICAgICAgICAgICAgICBmb3Jj\nZU91dGVyLCB0cmF2ZXJzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBw\nc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pblJlbGF0aW9uKHBzdGF0\nZS5qb2lucywgZm9yY2VPdXRlciwKICAgICAgICAgICAgICAgIHRyYXZlcnNl\nKTsKICAgICAgICBwc3RhdGUuam9pbmVkUmVsID0gdHJ1ZTsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0b3JlVmFsdWUoU2VsZWN0IHNlbCwg\nRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBPYmpl\nY3QgdmFsKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRo\nRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZCA9\nIChwc3RhdGUuY21wZmllbGQgIT0gbnVsbCkgPyBwc3RhdGUuY21wZmllbGQg\nCiAgICAgICAgICAgIDogcHN0YXRlLmZpZWxkOwogICAgICAgIGlmIChpc1hQ\nYXRoKCkpCiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgaWYgKGZp\nZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9rZXkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gZmllbGQudG9LZXlEYXRhU3RvcmVWYWx1ZSh2YWws\nIGN0eC5zdG9yZSk7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRFbGVtZW50\nKCkuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5PQkpFQ1Qp\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQudG9EYXRhU3RvcmVWYWx1\nZSh2YWwsIGN0eC5zdG9yZSk7CgogICAgICAgICAgICB2YWwgPSBmaWVsZC5n\nZXRFeHRlcm5hbFZhbHVlKHZhbCwgY3R4LnN0b3JlLmdldENvbnRleHQoKSk7\nCiAgICAgICAgICAgIHJldHVybiBmaWVsZC50b0RhdGFTdG9yZVZhbHVlKHZh\nbCwgY3R4LnN0b3JlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jbGFz\ncy50b0RhdGFTdG9yZVZhbHVlKHZhbCwgX2NsYXNzLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCksCiAgICAgICAgICAgIGN0eC5zdG9yZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4\nLCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgYm9vbGVhbiBwa3MpIHsKICAg\nICAgICBzZWxlY3RDb2x1bW5zKHNlbCwgY3R4LCBzdGF0ZSwgcGtzKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RDb2x1bW5zKFNlbGVjdCBzZWws\nIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgYm9v\nbGVhbiBwa3MpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IGdl\ndENsYXNzTWFwcGluZyhzdGF0ZSk7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBz\ndGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChtYXBw\naW5nID09IG51bGwgfHwgIXBzdGF0ZS5qb2luZWRSZWwpCiAgICAgICAgICAg\nIHNlbC5zZWxlY3QoZ2V0Q29sdW1ucyhzdGF0ZSksIHBzdGF0ZS5qb2lucyk7\nCiAgICAgICAgZWxzZSBpZiAocGtzKQogICAgICAgICAgICBzZWwuc2VsZWN0\nKG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSwgcHN0YXRlLmpvaW5z\nKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gc2VsZWN0IHRoZSBt\nYXBwaW5nOyBhbGxvdyBhbnkgc3VicyBiZWNhdXNlIHdlIGtub3cgdGhpcyBt\ndXN0CiAgICAgICAgICAgIC8vIGJlIGVpdGhlciBhIHJlbGF0aW9uLCBpbiB3\naGljaCBjYXNlIGl0IHdpbGwgYWxyZWFkeSBiZQogICAgICAgICAgICAvLyBj\nb25zdHJhaW5lZCBieSB0aGUgam9pbnMsIG9yICd0aGlzJywgaW4gd2hpY2gg\nY2FzZSB0aGUKICAgICAgICAgICAgLy8gSkRCQ0V4cHJlc3Npb25GYWN0b3J5\nIHRha2VzIGNhcmUgb2YgYWRkaW5nIGNsYXNzIGNvbmRpdGlvbnMgZm9yCiAg\nICAgICAgICAgIC8vIHRoZSBjYW5kaWRhdGUgY2xhc3Mgb24gdGhlIHNlbGVj\ndAogICAgICAgICAgICBpbnQgc3VicyA9IChfdHlwZSA9PSBVTkJPVU5EX1ZB\nUikgPyBTZWxlY3QuU1VCU19KT0lOQUJMRQogICAgICAgICAgICAgICAgOiBT\nZWxlY3QuU1VCU19BTllfSk9JTkFCTEU7CiAgICAgICAgICAgIHNlbC5zZWxl\nY3QobWFwcGluZywgc3VicywgY3R4LnN0b3JlLCBjdHguZmV0Y2gsCiAgICAg\nICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX05PTkUs\nIHNlbC5vdXRlcihwc3RhdGUuam9pbnMpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgZ3JvdXBCeShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0\nIGN0eCwgRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZyA9IGdldENsYXNzTWFwcGluZyhzdGF0ZSk7CiAgICAgICAgUGF0\naEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAg\nICAgIGlmIChtYXBwaW5nID09IG51bGwgfHwgIXBzdGF0ZS5qb2luZWRSZWwp\nCiAgICAgICAgICAgIHNlbC5ncm91cEJ5KGdldENvbHVtbnMoc3RhdGUpLCBz\nZWwub3V0ZXIocHN0YXRlLmpvaW5zKSk7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIGludCBzdWJzID0gKF90eXBlID09IFVOQk9VTkRfVkFSKSA/IFNl\nbGVjdC5TVUJTX0pPSU5BQkxFCiAgICAgICAgICAgICAgICA6IFNlbGVjdC5T\nVUJTX0FOWV9KT0lOQUJMRTsKICAgICAgICAgICAgc2VsLmdyb3VwQnkobWFw\ncGluZywgc3VicywgY3R4LnN0b3JlLCBjdHguZmV0Y2gsIAogICAgICAgICAg\nICAgICAgc2VsLm91dGVyKHBzdGF0ZS5qb2lucykpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBvcmRlckJ5KFNlbGVjdCBzZWwsIEV4cENv\nbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgYm9vbGVhbiBh\nc2MpIHsKICAgICAgICBzZWwub3JkZXJCeShnZXRDb2x1bW5zKHN0YXRlKSwg\nYXNjLCBzZWwub3V0ZXIoc3RhdGUuam9pbnMpLCBmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBsb2FkKEV4cENvbnRleHQgY3R4LCBFeHBTdGF0\nZSBzdGF0ZSwgUmVzdWx0IHJlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gbG9hZChjdHgsIHN0YXRlLCByZXMsIGZh\nbHNlKTsKICAgIH0KCiAgICBPYmplY3QgbG9hZChFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUsIFJlc3VsdCByZXMsIGJvb2xlYW4gcGtzKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENsYXNzTWFwcGlu\nZyBtYXBwaW5nID0gZ2V0Q2xhc3NNYXBwaW5nKHN0YXRlKTsKICAgICAgICBQ\nYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAg\nICAgICAgaWYgKG1hcHBpbmcgIT0gbnVsbCAmJiAocHN0YXRlLmZpZWxkID09\nIG51bGwgCiAgICAgICAgICAgIHx8ICFwc3RhdGUuZmllbGQuaXNFbWJlZGRl\nZCgpKSkgewogICAgICAgICAgICBpZiAocGtzKQogICAgICAgICAgICAgICAg\ncmV0dXJuIG1hcHBpbmcuZ2V0T2JqZWN0SWQoY3R4LnN0b3JlLCByZXMsIG51\nbGwsIHRydWUsIAogICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyk7\nCiAgICAgICAgICAgIHJldHVybiByZXMubG9hZChtYXBwaW5nLCBjdHguc3Rv\ncmUsIGN0eC5mZXRjaCwgcHN0YXRlLmpvaW5zKTsKICAgICAgICB9CgogICAg\nICAgIE9iamVjdCByZXQ7CiAgICAgICAgaWYgKF9rZXkpCiAgICAgICAgICAg\nIHJldCA9IHBzdGF0ZS5maWVsZC5sb2FkS2V5UHJvamVjdGlvbihjdHguc3Rv\ncmUsIGN0eC5mZXRjaCwgcmVzLCAKICAgICAgICAgICAgICAgIHBzdGF0ZS5q\nb2lucyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXQgPSBwc3RhdGUu\nZmllbGQubG9hZFByb2plY3Rpb24oY3R4LnN0b3JlLCBjdHguZmV0Y2gsIHJl\ncywgCiAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMpOwogICAgICAgIGlm\nIChfY2FzdCAhPSBudWxsKQogICAgICAgICAgICByZXQgPSBGaWx0ZXJzLmNv\nbnZlcnQocmV0LCBfY2FzdCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBjYWxjdWxhdGVWYWx1ZShTZWxlY3Qgc2VsLCBF\neHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFZhbCBv\ndGhlciwgRXhwU3RhdGUgb3RoZXJTdGF0ZSkgewogICAgICAgIC8vIHdlIGRv\nbid0IGNyZWF0ZSB0aGUgU1FMIGIvYyBpdCBmb3JjZXMgdGhlIFNlbGVjdCB0\nbyBjYWNoZSBhbGlhc2VzCiAgICAgICAgLy8gZm9yIHRoZSB0YWJsZXMgd2Ug\ndXNlLCBhbmQgdGhlc2UgYWxpYXNlcyBtaWdodCBub3QgZXZlciBiZSB1c2Vk\nIGlmCiAgICAgICAgLy8gd2UgZXZlbnR1YWxseSBjYWxsIGFwcGVuZElzRW1w\ndHkgb3IgYXBwZW5kSXNOdWxsIHJhdGhlciB0aGFuIGFwcGVuZFRvCiAgICB9\nCgogICAgcHVibGljIGludCBsZW5ndGgoU2VsZWN0IHNlbCwgRXhwQ29udGV4\ndCBjdHgsIEV4cFN0YXRlIHN0YXRlKSB7CiAgICAgICAgcmV0dXJuIGdldENv\nbHVtbnMoc3RhdGUpLmxlbmd0aDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBh\ncHBlbmRUbyhTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUg\nc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwsIGludCBpbmRleCkgewog\nICAgICAgIENvbHVtbiBjb2wgPSBnZXRDb2x1bW5zKHN0YXRlKVtpbmRleF07\nCgogICAgICAgIC8vIGlmIHNlbGVjdCBpcyBudWxsLCBpdCBtZWFucyB3ZSBh\ncmUgbm90IGFsaWFzaW5nIGNvbHVtbnMKICAgICAgICAvLyAoZS5nLiwgZHVy\naW5nIGEgYnVsayB1cGRhdGUpCiAgICAgICAgaWYgKHNlbCA9PSBudWxsKQog\nICAgICAgICAgICBzcWwuYXBwZW5kKGNvbC5nZXROYW1lKCkpOwogICAgICAg\nIGVsc2UgaWYgKF90eXBlID09IFhQQVRIKQogICAgICAgICAgICAvLyBpZiB0\naGlzIGlzIGFuIHhwYXRoLCBhcHBlbmQgeHBhdGggc3RyaW5nCiAgICAgICAg\nICAgIHNxbC5hcHBlbmQoZ2V0WFBhdGgoKSk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhjb2wsIHN0\nYXRlLmpvaW5zKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNF\nbXB0eShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3Rh\ndGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICBQYXRoRXhw\nU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAg\naWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAgICAgICBzcWwuYXBw\nZW5kKEZBTFNFKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHBzdGF0ZS5m\naWVsZC5hcHBlbmRJc0VtcHR5KHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90RW1wdHkoU2VsZWN0\nIHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAg\nICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0\nZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChwc3RhdGUu\nZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFwcGVuZChGQUxTRSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmllbGQuYXBwZW5k\nSXNOb3RFbXB0eShzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBhcHBlbmRTaXplKFNlbGVjdCBzZWwsIEV4cENvbnRl\neHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgU1FMQnVmZmVyIHNx\nbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0\nYXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09IG51bGwp\nCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIjEiKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRTaXplKHNxbCwgc2VsLCBw\nc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElz\nTnVsbChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3Rh\ndGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICBQYXRoRXhw\nU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAg\naWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAgICAgICBzcWwuYXBw\nZW5kKEZBTFNFKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHBzdGF0ZS5m\naWVsZC5hcHBlbmRJc051bGwoc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNOb3ROdWxsKFNlbGVjdCBz\nZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAg\nU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUg\nPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoVFJVRSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmllbGQuYXBwZW5kSXNO\nb3ROdWxsKHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgaWYgKF9hY3Rpb25zID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FuZGlkYXRlLmhhc2hDb2Rl\nKCk7CiAgICAgICAgcmV0dXJuIF9jYW5kaWRhdGUuaGFzaENvZGUoKSBeIF9h\nY3Rpb25zLmhhc2hDb2RlKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSB0\naGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIShv\ndGhlciBpbnN0YW5jZW9mIFBDUGF0aCkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICBQQ1BhdGggcGF0aCA9IChQQ1BhdGgpIG90aGVyOwog\nICAgICAgIHJldHVybiBPYmplY3RVdGlscy5lcXVhbHMoX2NhbmRpZGF0ZSwg\ncGF0aC5fY2FuZGlkYXRlKQogICAgICAgICAgICAmJiBPYmplY3RVdGlscy5l\ncXVhbHMoX2FjdGlvbnMsIHBhdGguX2FjdGlvbnMpOwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIGNsYXNzIHJlcHJlc2VudGluZyBhbiBhY3Rpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEFjdGlvbgogICAg\nICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgR0VUID0gMDsKICAgICAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBHRVRfT1VURVIgPSAxOwogICAgICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IEdFVF9LRVkgPSAyOwogICAgICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IFZBUiA9IDM7CiAgICAgICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgU1VCUVVFUlkgPSA0OwogICAgICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IFVOQk9VTkRfVkFSID0gNTsKICAgICAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBDQVNUID0gNjsKICAgICAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBHRVRfWFBBVEggPSA3OwoKICAgICAgICBwdWJsaWMg\naW50IG9wID0gLTE7CiAgICAgICAgcHVibGljIE9iamVjdCBkYXRhID0gbnVs\nbDsKCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAg\nICAgICAgcmV0dXJuIG9wICsgInwiICsgZGF0YTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIGlmIChk\nYXRhID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gb3A7CiAgICAg\nICAgICAgIHJldHVybiBvcCBeIGRhdGEuaGFzaENvZGUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIp\nIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgQWN0aW9uIGEgPSAoQWN0\naW9uKSBvdGhlcjsKICAgICAgICAgICAgcmV0dXJuIG9wID09IGEub3AKICAg\nICAgICAgICAgICAgICYmIE9iamVjdFV0aWxzLmVxdWFscyhkYXRhLCBhLmRh\ndGEpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

