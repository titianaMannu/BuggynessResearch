{"sha":"9172ff63a3d1d15d5e64805a3ec68bdbe881c167","node_id":"MDQ6QmxvYjIwNjM2NDo5MTcyZmY2M2EzZDFkMTVkNWU2NDgwNWEzZWM2OGJkYmU4ODFjMTY3","size":66312,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9172ff63a3d1d15d5e64805a3ec68bdbe881c167","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVt\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5G\nb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlNjaGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUNvbnRleHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEJhc2UgY2xhc3Mgc3Rvcmlu\nZyByYXcgbWFwcGluZyBpbmZvcm1hdGlvbjsgZGVmaW5lcyB1dGlsaXR5IG1l\ndGhvZHMgZm9yCiAqIGNvbnZlcnRpbmcgcmF3IG1hcHBpbmcgaW5mb3JtYXRp\nb24gdG8gZnVsbCBtYXBwaW5nIHRvIHRoZSBzY2hlbWEuCiAqCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgTWFwcGlu\nZ0luZm8KICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBKT0lOX05PTkUgPSAwOwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgSk9JTl9GT1JXQVJEID0gMTsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEpPSU5fSU5WRVJTRSA9IDI7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBuZXcgT2JqZWN0KCk7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChNYXBwaW5nSW5mby5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBTdHJpbmcgX3N0cmF0ZWd5ID0gbnVsbDsKICAg\nIHByaXZhdGUgTGlzdCBfY29scyA9IG51bGw7CiAgICBwcml2YXRlIEluZGV4\nIF9pZHggPSBudWxsOwogICAgcHJpdmF0ZSBVbmlxdWUgX3VucSA9IG51bGw7\nCiAgICBwcml2YXRlIEZvcmVpZ25LZXkgX2ZrID0gbnVsbDsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfY2FuSWR4ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfY2FuVW5xID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2FuRksg\nPSB0cnVlOwogICAgcHJpdmF0ZSBpbnQgX2pvaW4gPSBKT0lOX05PTkU7CiAg\nICBwcml2YXRlIENvbHVtbklPIF9pbyA9IG51bGw7CgogICAgLyoqCiAgICAg\nKiBNYXBwaW5nIHN0cmF0ZWd5IG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0U3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9zdHJhdGVn\neTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcHBpbmcgc3RyYXRlZ3kgbmFt\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3RyYXRlZ3koU3RyaW5n\nIHN0cmF0ZWd5KSB7CiAgICAgICAgX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSYXcgY29sdW1uIGRhdGEuCiAgICAgKi8K\nICAgIHB1YmxpYyBMaXN0IGdldENvbHVtbnMoKSB7CiAgICAgICAgcmV0dXJu\nIChfY29scyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QgOiBf\nY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBjb2x1bW4gZGF0YS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q29sdW1ucyhMaXN0IGNvbHMp\nIHsKICAgICAgICBfY29scyA9IGNvbHM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSYXcgaW5kZXguCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleCBnZXRJbmRl\neCgpIHsKICAgICAgICByZXR1cm4gX2lkeDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJhdyBpbmRleC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW5k\nZXgoSW5kZXggaWR4KSB7CiAgICAgICAgX2lkeCA9IGlkeDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMgYXMgZXhw\nbGljaXRseSBub24taW5kZXhhYmxlLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBjYW5JbmRleCgpIHsKICAgICAgICByZXR1cm4gX2NhbklkeDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMg\nYXMgZXhwbGljaXRseSBub24taW5kZXhhYmxlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRDYW5JbmRleChib29sZWFuIGluZGV4YWJsZSkgewogICAg\nICAgIF9jYW5JZHggPSBpbmRleGFibGU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSYXcgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1\nYmxpYyBGb3JlaWduS2V5IGdldEZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0\ndXJuIF9mazsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBmb3JlaWduIGtl\neSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Rm9y\nZWlnbktleShGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgX2ZrID0gZms7CiAg\nICAgICAgaWYgKGZrICE9IG51bGwgJiYgX2pvaW4gPT0gSk9JTl9OT05FKQog\nICAgICAgICAgICBfam9pbiA9IEpPSU5fRk9SV0FSRDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMgYXMgZXhwbGlj\naXRseSBub3QgaGF2aW5nIGEgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGNhbkZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJu\nIF9jYW5GSzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBt\nYXJrIGNvbHVtbnMgYXMgZXhwbGljaXRseSBub3QgaGF2aW5nIGEgZm9yZWln\nbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENhbkZvcmVpZ25L\nZXkoYm9vbGVhbiBma2FibGUpIHsKICAgICAgICBfY2FuRksgPSBma2FibGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSYXcgdW5pcXVlIGNvbnN0cmFpbnQg\naW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBVbmlxdWUgZ2V0VW5p\ncXVlKCkgewogICAgICAgIHJldHVybiBfdW5xOwogICAgfQoKICAgIC8qKgog\nICAgICogUmF3IHVuaXF1ZSBjb25zdHJhaW50IGluZm9ybWF0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRVbmlxdWUoVW5pcXVlIHVucSkgewog\nICAgICAgIF91bnEgPSB1bnE7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\ndXNlciBjYW4gbWFyayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm90IGhhdmlu\nZyBhIHVuaXF1ZSBjb25zdHJhaW50LgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBjYW5VbmlxdWUoKSB7CiAgICAgICAgcmV0dXJuIF9jYW5VbnE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBjYW4gbWFyayBjb2x1bW5z\nIGFzIGV4cGxpY2l0bHkgbm90IGhhdmluZyBhIHVuaXF1ZSBjb25zdHJhaW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDYW5VbmlxdWUoYm9vbGVh\nbiB1bmlxdWFibGUpIHsKICAgICAgICBfY2FuVW5xID0gdW5pcXVhYmxlOwog\nICAgfQoKICAgIC8qKgogICAgICogSS9PIGZvciB0aGUgY29sdW1ucyBjcmVh\ndGVkIGJ5IHRoZSBsYXN0IGNhbGwgdG8ge0BsaW5rICNjcmVhdGVDb2x1bW5z\nfSwKICAgICAqIG9yIGZvciB0aGUgZm9yZWlnbiBrZXkgY3JlYXRlZCBieSB0\naGUgbGFzdCBjYWxsIHRvCiAgICAgKiB7QGxpbmsgI2NyZWF0ZUZvcmVpZ25L\nZXl9LiBUaGlzIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNvcnJlY3Rs\neQogICAgICogcHJpb3IgdG8gY2FsbHMgdG8ge0BsaW5rICNzeW5jQ29sdW1u\nc30gYW5kIHtAbGluayAjc3luY0ZvcmVpZ25LZXl9LgogICAgICovCiAgICBw\ndWJsaWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAgICAgcmV0dXJu\nIF9pbzsKICAgIH0KCiAgICAvKioKICAgICAqIEkvTyBmb3IgdGhlIGNvbHVt\nbnMgY3JlYXRlZCBieSB0aGUgbGFzdCBjYWxsIHRvIHtAbGluayAjY3JlYXRl\nQ29sdW1uc30sCiAgICAgKiBvciBmb3IgdGhlIGZvcmVpZ24ga2V5IGNyZWF0\nZWQgYnkgdGhlIGxhc3QgY2FsbCB0bwogICAgICoge0BsaW5rICNjcmVhdGVG\nb3JlaWduS2V5fS4gVGhpcyBpcyBhbHNvIGV4cGVjdGVkIHRvIGJlIHNldCBj\nb3JyZWN0bHkKICAgICAqIHByaW9yIHRvIGNhbGxzIHRvIHtAbGluayAjc3lu\nY0NvbHVtbnN9IGFuZCB7QGxpbmsgI3N5bmNGb3JlaWduS2V5fS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0Q29sdW1uSU8oQ29sdW1uSU8gaW8pIHsK\nICAgICAgICBfaW8gPSBpbzsKICAgIH0KCiAgICAvKioKICAgICAqIERpcmVj\ndGlvbiBvZiB0aGUgam9pbiB0aGF0IHRoZSBjb2x1bW5zIG9mIHRoaXMgbWFw\ncGluZyBpbmZvIGZvcm0uIFRoaXMKICAgICAqIGlzIHVzdWFsbHkgYXV0b21h\ndGljYWxseSBzZXQgYnkge0BsaW5rICNjcmVhdGVGb3JlaWduS2V5fS4gVGhp\ncyBmbGFnCiAgICAgKiBpcyBhbHNvIGV4cGVjdGVkIHRvIGJlIHNldCBjb3Jy\nZWN0bHkgcHJpb3IgdG8gY2FsbHMgdG8KICAgICAqIHtAbGluayAjc3luY0Zv\ncmVpZ25LZXl9IGlmIHRoZSBqb2luIGlzIGludmVyc2VkLgogICAgICovCiAg\nICBwdWJsaWMgaW50IGdldEpvaW5EaXJlY3Rpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF9qb2luOwogICAgfQoKICAgIC8qKgogICAgICogRGlyZWN0aW9uIG9m\nIHRoZSBqb2luIHRoYXQgdGhlIGNvbHVtbnMgb2YgdGhpcyBtYXBwaW5nIGlu\nZm8gZm9ybS4gVGhpcwogICAgICogaXMgdXN1YWxseSBhdXRvbWF0aWNhbGx5\nIHNldCBieSB7QGxpbmsgI2NyZWF0ZUZvcmVpZ25LZXl9LiBUaGlzIGZsYWcK\nICAgICAqIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNvcnJlY3RseSBw\ncmlvciB0byBjYWxscyB0bwogICAgICoge0BsaW5rICNzeW5jRm9yZWlnbktl\neX0gaWYgdGhlIGpvaW4gaXMgaW52ZXJzZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEpvaW5EaXJlY3Rpb24oaW50IGpvaW4pIHsKICAgICAgICBf\nam9pbiA9IGpvaW47CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwg\nbWFwcGluZyBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7CiAgICAgICAgY2xlYXIodHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDbGVhciBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICoKICAg\nICAqIEBwYXJhbSBjYW5GbGFncyB3aGV0aGVyIHRvIGNsZWFyIGluZm9ybWF0\naW9uIGFib3V0IHdoZXRoZXIgd2UKICAgICAqIGNhbiBwbGFjZSBpbmRleGVk\nLCBmb3JlaWduIGtleXMsIGV0YyBvbiB0aGlzIG1hcHBpbmcKICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgY2xlYXIoYm9vbGVhbiBjYW5GbGFncykgewog\nICAgICAgIF9zdHJhdGVneSA9IG51bGw7CiAgICAgICAgX2NvbHMgPSBudWxs\nOwogICAgICAgIF9pbyA9IG51bGw7CiAgICAgICAgX2lkeCA9IG51bGw7CiAg\nICAgICAgX3VucSA9IG51bGw7CiAgICAgICAgX2ZrID0gbnVsbDsKICAgICAg\nICBfam9pbiA9IEpPSU5fTk9ORTsKICAgICAgICBpZiAoY2FuRmxhZ3MpIHsK\nICAgICAgICAgICAgX2NhbklkeCA9IHRydWU7CiAgICAgICAgICAgIF9jYW5G\nSyA9IHRydWU7CiAgICAgICAgICAgIF9jYW5VbnEgPSB0cnVlOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgbWlzc2luZyBpbmZvIGZy\nb20gdGhlIGluc3RhbmNlIHRvIHRoaXMgb25lLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjb3B5KE1hcHBpbmdJbmZvIGluZm8pIHsKICAgICAgICBpZiAo\nX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgIF9zdHJhdGVneSA9IGlu\nZm8uZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAoX2NhbklkeCAmJiBfaWR4\nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKGluZm8uZ2V0SW5kZXgoKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2lkeCA9IGluZm8uZ2V0SW5kZXgo\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2NhbklkeCA9\nIGluZm8uY2FuSW5kZXgoKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9jYW5V\nbnEgJiYgX3VucSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbmZvLmdl\ndFVuaXF1ZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBfdW5xID0gaW5m\nby5nZXRVbmlxdWUoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgX2NhblVucSA9IGluZm8uY2FuVW5pcXVlKCk7CiAgICAgICAgfQogICAg\nICAgIGlmIChfY2FuRksgJiYgX2ZrID09IG51bGwpIHsKICAgICAgICAgICAg\naWYgKGluZm8uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfZmsgPSBpbmZvLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgX2NhbkZLID0gaW5mby5jYW5Gb3JlaWdu\nS2V5KCk7CiAgICAgICAgfQoKICAgICAgICBMaXN0IGNvbHMgPSBnZXRDb2x1\nbW5zKCk7CiAgICAgICAgTGlzdCBpY29scyA9IGluZm8uZ2V0Q29sdW1ucygp\nOwogICAgICAgIGlmICghaWNvbHMuaXNFbXB0eSgpICYmIChjb2xzLmlzRW1w\ndHkoKQogICAgICAgICAgICB8fCBjb2xzLnNpemUoKSA9PSBpY29scy5zaXpl\nKCkpKSB7CiAgICAgICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIGNvbHMgPSBuZXcgQXJyYXlMaXN0KGljb2xzLnNpemUoKSk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWNvbHMuc2l6ZSgp\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChjb2xzLnNpemUoKSA9PSBp\nKQogICAgICAgICAgICAgICAgICAgIGNvbHMuYWRkKG5ldyBDb2x1bW4oKSk7\nCiAgICAgICAgICAgICAgICAoKENvbHVtbikgY29scy5nZXQoaSkpLmNvcHko\nKENvbHVtbikgaWNvbHMuZ2V0KGkpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBzZXRDb2x1bW5zKGNvbHMpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoaXMgaW5mbyBoYXMgY29sdW1u\ncywgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24sIGluZGV4CiAgICAgKiBpbmZv\ncm1hdGlvbiwgZXRjLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNT\nY2hlbWFDb21wb25lbnRzKCkgewogICAgICAgIHJldHVybiAoX2NvbHMgIT0g\nbnVsbCAmJiAhX2NvbHMuaXNFbXB0eSgpKQogICAgICAgICAgICB8fCBfaWR4\nICE9IG51bGwKICAgICAgICAgICAgfHwgX3VucSAhPSBudWxsCiAgICAgICAg\nICAgIHx8IF9mayAhPSBudWxsCiAgICAgICAgICAgIHx8ICFfY2FuSWR4CiAg\nICAgICAgICAgIHx8ICFfY2FuRksKICAgICAgICAgICAgfHwgIV9jYW5VbnE7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgdXNlciBk\naWQgbm90IHN1cHBseSBhbnkgY29sdW1ucywgaW5kZXgsIHVuaXF1ZQogICAg\nICogY29uc3RyYWludCwgb3IgZm9yZWlnbiBrZXkgZm9yIHRoaXMgbWFwcGlu\nZy4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm9TY2hlbWFDb21w\nb25lbnRzKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBib29sZWFuIGRpZSkg\newogICAgICAgIGlmIChfY29scyA9PSBudWxsIHx8IF9jb2xzLmlzRW1wdHko\nKSkgewogICAgICAgICAgICBhc3NlcnROb0luZGV4KGNvbnRleHQsIGRpZSk7\nCiAgICAgICAgICAgIGFzc2VydE5vVW5pcXVlKGNvbnRleHQsIGRpZSk7CiAg\nICAgICAgICAgIGFzc2VydE5vRm9yZWlnbktleShjb250ZXh0LCBkaWUpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNZXNzYWdl\nIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLWNvbHMiLCBjb250ZXh0KTsK\nICAgICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRv\ncnkoKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGlzIGluZm8gaGFzIHRoZSBnaXZlbiBzdHJhdGVn\neSBvciBubyBzdHJhdGVneS4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNz\nZXJ0U3RyYXRlZ3koTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIE9iamVjdCBj\nb250ZXh0U3RyYXQsCiAgICAgICAgT2JqZWN0IGV4cGVjdGVkLCBib29sZWFu\nIGRpZSkgewogICAgICAgIGlmIChjb250ZXh0U3RyYXQgPT0gZXhwZWN0ZWQp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHN0cmF0Owog\nICAgICAgIGlmIChjb250ZXh0U3RyYXQgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGlmIChfc3RyYXRlZ3kuZXF1YWxzKGV4cGVjdGVk\nLmdldENsYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgaWYgKGV4cGVjdGVkIGluc3RhbmNlb2YgU3RyYXRl\nZ3kKICAgICAgICAgICAgICAgICYmIF9zdHJhdGVneS5lcXVhbHMoKChTdHJh\ndGVneSkgZXhwZWN0ZWQpLmdldEFsaWFzKCkpKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICBzdHJhdCA9IF9zdHJhdGVneTsKICAgICAg\nICB9IGVsc2UgaWYgKGNvbnRleHRTdHJhdCBpbnN0YW5jZW9mIFN0cmF0ZWd5\nKQogICAgICAgICAgICBzdHJhdCA9ICgoU3RyYXRlZ3kpIGNvbnRleHRTdHJh\ndCkuZ2V0QWxpYXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0cmF0\nID0gY29udGV4dFN0cmF0LmdldENsYXNzKCkuZ2V0TmFtZSgpOwoKICAgICAg\nICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLXN0cmF0ZWd5\nIiwgY29udGV4dCwgZXhwZWN0ZWQsCiAgICAgICAgICAgIHN0cmF0KTsKICAg\nICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRvcnko\nKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nc3NlcnQgdGhhdCB0aGUgdXNlciBkaWQgbm90IHRyeSB0byBwbGFjZSBhbiBp\nbmRleCBvbiB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFzc2VydE5vSW5kZXgoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIGJvb2xl\nYW4gZGllKSB7CiAgICAgICAgaWYgKF9pZHggPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1\nbmV4cGVjdGVkLWluZGV4IiwgY29udGV4dCk7CiAgICAgICAgaWYgKGRpZSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7\nCiAgICAgICAgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fy\nbihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhl\nIHVzZXIgZGlkIG5vdCB0cnkgdG8gcGxhY2UgYSB1bmlxdWUgY29uc3RyYWlu\ndCBvbiB0aGlzCiAgICAgKiBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhc3NlcnROb1VuaXF1ZShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwg\nYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX3VucSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5n\nZXQoInVuZXhwZWN0ZWQtdW5pcXVlIiwgY29udGV4dCk7CiAgICAgICAgaWYg\nKGRpZSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKG1zZyk7CiAgICAgICAgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9n\nKCkud2Fybihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRo\nYXQgdGhlIHVzZXIgZGlkIG5vdCB0cnkgdG8gcGxhY2UgYSBmb3JlaWduIGtl\neSBvbiB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFz\nc2VydE5vRm9yZWlnbktleShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgYm9v\nbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX2ZrID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgi\ndW5leHBlY3RlZC1mayIsIGNvbnRleHQpOwogICAgICAgIGlmIChkaWUpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihtc2cpOwog\nICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpLndhcm4o\nbXNnKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSB1\nc2VyIGRpZCBub3QgdHJ5IHRvIGpvaW4uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGFzc2VydE5vSm9pbihNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgYm9v\nbGVhbiBkaWUpIHsKICAgICAgICBib29sZWFuIGpvaW4gPSBmYWxzZTsKICAg\nICAgICBpZiAoX2NvbHMgIT0gbnVsbCkgewogICAgICAgICAgICBDb2x1bW4g\nY29sOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgIWpvaW4gJiYgaSA8\nIF9jb2xzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb2wgPSAo\nQ29sdW1uKSBfY29scy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoY29s\nLmdldFRhcmdldCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgam9p\nbiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKCFqb2luKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQoInVuZXhwZWN0ZWQtam9pbiIsIGNvbnRleHQpOwog\nICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZpbmQgb3IgZ2VuZXJhdGUgYSB0YWJsZSBmb3IgYSBtYXBwaW5nLgogICAg\nICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHRoYXQgdXNl\ncyB0aGUgdGFibGUKICAgICAqIEBwYXJhbSBkZWYgZGVmYXVsdCB0YWJsZSBu\nYW1lIHByb3ZpZGVyCiAgICAgKiBAcGFyYW0gc2NoZW1hTmFtZSBkZWZhdWx0\nIHNjaGVtYSBpZiBrbm93biwgb3IgbnVsbAogICAgICogQHBhcmFtIGdpdmVu\nIGdpdmVuIHRhYmxlIG5hbWUKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVy\nIHdlIGNhbiBhbHRlciB0aGUgc2NoZW1hIG9yIG1hcHBpbmdzCiAgICAgKi8K\nICAgIHB1YmxpYyBUYWJsZSBjcmVhdGVUYWJsZShNZXRhRGF0YUNvbnRleHQg\nY29udGV4dCwgVGFibGVEZWZhdWx0cyBkZWYsCiAgICAgICAgU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyBnaXZlbiwgYm9vbGVhbiBhZGFwdCkgewogICAg\nICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0\nb3J5KSBjb250ZXh0LmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBpZiAoZ2l2\nZW4gPT0gbnVsbCAmJiAoZGVmID09IG51bGwgfHwgKCFhZGFwdAogICAgICAg\nICAgICAmJiAhcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1p\nc3NpbmdJbmZvKCkpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby10YWJsZSIsIGNvbnRleHQpKTsKCiAg\nICAgICAgaWYgKHNjaGVtYU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgc2No\nZW1hTmFtZSA9IFNjaGVtYXMuZ2V0TmV3VGFibGVTY2hlbWEoKEpEQkNDb25m\naWd1cmF0aW9uKQogICAgICAgICAgICAgICAgcmVwb3MuZ2V0Q29uZmlndXJh\ndGlvbigpKTsKCiAgICAgICAgLy8gaWYgbm8gZ2l2ZW4gYW5kIGFkYXB0aW5n\nIG9yIGRlZmF1bHRpbmcgbWlzc2luZyBpbmZvLCB1c2UgdGVtcGxhdGUKICAg\nICAgICBTY2hlbWFHcm91cCBncm91cCA9IHJlcG9zLmdldFNjaGVtYUdyb3Vw\nKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IG51bGw7CiAgICAgICAgaWYg\nKGdpdmVuID09IG51bGwpIHsKICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAu\nZ2V0U2NoZW1hKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBpZiAoc2NoZW1h\nID09IG51bGwpCiAgICAgICAgICAgICAgICBzY2hlbWEgPSBncm91cC5hZGRT\nY2hlbWEoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGdpdmVuID0gZGVmLmdl\ndChzY2hlbWEpOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGZ1bGxOYW1l\nOwogICAgICAgIGludCBkb3RJZHggPSBnaXZlbi5sYXN0SW5kZXhPZignLicp\nOwogICAgICAgIGlmIChkb3RJZHggPT0gLTEpCiAgICAgICAgICAgIGZ1bGxO\nYW1lID0gKHNjaGVtYU5hbWUgPT0gbnVsbCkgPyBnaXZlbiA6IHNjaGVtYU5h\nbWUgKyAiLiIgKyBnaXZlbjsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nZnVsbE5hbWUgPSBnaXZlbjsKICAgICAgICAgICAgc2NoZW1hID0gbnVsbDsK\nICAgICAgICAgICAgc2NoZW1hTmFtZSA9IGdpdmVuLnN1YnN0cmluZygwLCBk\nb3RJZHgpOwogICAgICAgICAgICBnaXZlbiA9IGdpdmVuLnN1YnN0cmluZyhk\nb3RJZHggKyAxKTsKICAgICAgICB9CgogICAgICAgIC8vIGxvb2sgZm9yIG5h\nbWVkIHRhYmxlIHVzaW5nIGZ1bGwgbmFtZSBhbmQgZmluZFRhYmxlLCB3aGlj\naCBhbGxvd3MKICAgICAgICAvLyB0aGUgZHluYW1pYyBzY2hlbWEgZmFjdG9y\neSB0byBjcmVhdGUgdGhlIHRhYmxlIGlmIG5lZWRlZAogICAgICAgIFRhYmxl\nIHRhYmxlID0gZ3JvdXAuZmluZFRhYmxlKGZ1bGxOYW1lKTsKICAgICAgICBp\nZiAodGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRhYmxlOwog\nICAgICAgIGlmICghYWRhcHQpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXRhYmxlIiwgZ2l2ZW4sIGNv\nbnRleHQpKTsKCiAgICAgICAgLy8gbmFtZWQgdGFibGUgZG9lc24ndCBleGlz\ndDsgY3JlYXRlIGl0CiAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFOYW1l\nKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgc2NoZW1hID0gZ3JvdXAuYWRkU2NoZW1hKHNjaGVtYU5hbWUpOwog\nICAgICAgIH0KICAgICAgICB0YWJsZSA9IHNjaGVtYS5nZXRUYWJsZShnaXZl\nbik7CiAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgIHRh\nYmxlID0gc2NoZW1hLmFkZFRhYmxlKGdpdmVuKTsKICAgICAgICByZXR1cm4g\ndGFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXRyaWV2ZS9jcmVhdGUg\nY29sdW1ucyBvbiB0aGUgZ2l2ZW4gdGFibGUgYnkgbWVyZ2luZyB0aGUgZ2l2\nZW4KICAgICAqIHRlbXBsYXRlIGluZm9ybWF0aW9uIHdpdGggYW55IHVzZXIt\ncHJvdmlkZWQgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGNv\nbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBjb2x1bW5zIGZv\ncgogICAgICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJyb3IgbWVzc2Fn\nZSBrZXkgcHJlZml4CiAgICAgKiBAcGFyYW0gdG1wbGF0ZXMgdGVtcGxhdGUg\nY29sdW1ucwogICAgICogQHBhcmFtIHRhYmxlIHRoZSB0YWJsZSBmb3IgdGhl\nIGNvbHVtbnMKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBt\nb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBDb2x1bW5bXSBjcmVhdGVDb2x1bW5zKE1ldGFEYXRh\nQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgcHJlZml4LAogICAgICAgIENvbHVt\nbltdIHRtcGxhdGVzLCBUYWJsZSB0YWJsZSwgYm9vbGVhbiBhZGFwdCkgewog\nICAgICAgIGFzc2VydFRhYmxlKGNvbnRleHQsIHRhYmxlKTsKICAgICAgICBp\nZiAocHJlZml4ID09IG51bGwpCiAgICAgICAgICAgIHByZWZpeCA9ICJnZW5l\ncmljIjsKCiAgICAgICAgLy8gdGhlIHVzZXIgaGFzIHRvIGdpdmUgdGhlIHJp\nZ2h0IG51bWJlciBvZiBleHBlY3RlZCBjb2x1bW5zIGZvciB0aGlzCiAgICAg\nICAgLy8gbWFwcGluZywgb3Igbm9uZSBhdCBhbGwgaWYgd2UncmUgYWRhcHRp\nbmcuICBjYW4ndCBqdXN0IGdpdmVuIG9uZSBvZgogICAgICAgIC8vIG4gY29s\ndW1ucyBiZWNhdXNlIHdlIGRvbid0IGtub3cgd2hpY2ggb2YgdGhlIG4gY29s\ndW1ucyB0aGUgaW5mbwogICAgICAgIC8vIGFwcGxpZXMgdG8KICAgICAgICBM\naXN0IGdpdmVuID0gZ2V0Q29sdW1ucygpOwogICAgICAgIGJvb2xlYW4gZmls\nbCA9ICgoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpKS4KICAgICAgICAgICAgZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVs\ndE1pc3NpbmdJbmZvKCk7CiAgICAgICAgaWYgKCghZ2l2ZW4uaXNFbXB0eSgp\nIHx8ICghYWRhcHQgJiYgIWZpbGwpKQogICAgICAgICAgICAmJiBnaXZlbi5z\naXplKCkgIT0gdG1wbGF0ZXMubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1udW0t\nY29scyIsCiAgICAgICAgICAgICAgICBjb250ZXh0LCBTdHJpbmcudmFsdWVP\nZih0bXBsYXRlcy5sZW5ndGgpLAogICAgICAgICAgICAgICAgU3RyaW5nLnZh\nbHVlT2YoZ2l2ZW4uc2l6ZSgpKSkpOwoKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gbmV3IENvbHVtblt0bXBsYXRlcy5sZW5ndGhdOwogICAgICAgIF9pbyA9\nIG51bGw7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHRtcGxhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGNvbCA9IChnaXZlbi5pc0VtcHR5KCkpID8gbnVsbCA6IChDb2x1bW4pIGdp\ndmVuLmdldChpKTsKICAgICAgICAgICAgY29sc1tpXSA9IG1lcmdlQ29sdW1u\nKGNvbnRleHQsIHByZWZpeCwgdG1wbGF0ZXNbaV0sIHRydWUsIGNvbCwKICAg\nICAgICAgICAgICAgIHRhYmxlLCBhZGFwdCwgZmlsbCk7CiAgICAgICAgICAg\nIHNldElPRnJvbUNvbHVtbkZsYWdzKGNvbCwgaSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBjb2xzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBwcm9wZXIgaW50ZXJuYWwgY29sdW1uIEkvTyBtZXRhZGF0YSBmb3IgdGhl\nIGdpdmVuIGNvbHVtbidzIGZsYWdzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgc2V0SU9Gcm9tQ29sdW1uRmxhZ3MoQ29sdW1uIGNvbCwgaW50IGkpIHsK\nICAgICAgICBpZiAoY29sID09IG51bGwgfHwgKCFjb2wuZ2V0RmxhZyhDb2x1\nbW4uRkxBR19VTklOU0VSVEFCTEUpCiAgICAgICAgICAgICYmICFjb2wuZ2V0\nRmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGlmIChfaW8gPT0gbnVsbCkKICAgICAgICAgICAg\nX2lvID0gbmV3IENvbHVtbklPKCk7CiAgICAgICAgX2lvLnNldEluc2VydGFi\nbGUoaSwgIWNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkp\nOwogICAgICAgIF9pby5zZXRVcGRhdGFibGUoaSwgIWNvbC5nZXRGbGFnKENv\nbHVtbi5GTEFHX1VOVVBEQVRBQkxFKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGUgZ2l2ZW4gdGFibGUgaXMgbm9uLW51bGwuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYXNzZXJ0VGFibGUoTWV0\nYURhdGFDb250ZXh0IGNvbnRleHQsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAg\naWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5tYXBwZWQiLCBjb250ZXh0KSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNZXJnZSB0aGUgZ2l2ZW4gY29sdW1u\ncyBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0\naGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2aW5nIGNvbHVtbnMgZm9yCiAgICAg\nKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBw\ncmVmaXgKICAgICAqIEBwYXJhbSB0bXBsYXRlIHRlbXBsYXRlIGZvciBleHBl\nY3RlZCBjb2x1bW4gaW5mb3JtYXRpb24KICAgICAqIEBwYXJhbSBjb21wYXQg\nd2hldGhlciB0aGUgZXhpc3RpbmcgY29sdW1uIHR5cGUgbXVzdCBiZSBjb21w\nYXRpYmxlCiAgICAgKiB3aXRoIHRoZSB0eXBlIG9mIHRoZSB0ZW1wbGF0ZSBj\nb2x1bW4KICAgICAqIEBwYXJhbSBnaXZlbiB0aGUgZ2l2ZW4gY29sdW1uIGlu\nZm9ybWF0aW9uIGZyb20gbWFwcGluZyBpbmZvCiAgICAgKiBAcGFyYW0gdGFi\nbGUgdGhlIHRhYmxlIGZvciB0aGUgY29sdW1ucwogICAgICogQHBhcmFtIGFk\nYXB0IHdoZXRoZXIgd2UgY2FuIG1vZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGlu\nZyBvciBzY2hlbWEKICAgICAqIEBwYXJhbSBmaWxsIHdoZXRoZXIgdG8gZGVm\nYXVsdCBtaXNzaW5nIGNvbHVtbiBpbmZvcm1hdGlvbgogICAgICovCiAgICBw\ncm90ZWN0ZWQgc3RhdGljIENvbHVtbiBtZXJnZUNvbHVtbihNZXRhRGF0YUNv\nbnRleHQgY29udGV4dCwgU3RyaW5nIHByZWZpeCwKICAgICAgICBDb2x1bW4g\ndG1wbGF0ZSwgYm9vbGVhbiBjb21wYXQsIENvbHVtbiBnaXZlbiwgVGFibGUg\ndGFibGUsCiAgICAgICAgYm9vbGVhbiBhZGFwdCwgYm9vbGVhbiBmaWxsKSB7\nCiAgICAgICAgYXNzZXJ0VGFibGUoY29udGV4dCwgdGFibGUpOwoKICAgICAg\nICAvLyBpZiBub3QgYWRhcHRpbmcgbXVzdCBwcm92aWRlIGNvbHVtbiBuYW1l\nIGF0IGEgbWluaW11bQogICAgICAgIFN0cmluZyBjb2xOYW1lID0gKGdpdmVu\nID09IG51bGwpID8gbnVsbCA6IGdpdmVuLmdldE5hbWUoKTsKICAgICAgICBp\nZiAoY29sTmFtZSA9PSBudWxsICYmICFhZGFwdCAmJiAhZmlsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHBy\nZWZpeCArICItbm8tY29sLW5hbWUiLAogICAgICAgICAgICAgICAgY29udGV4\ndCkpOwoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGNvbHVtbiBuYW1lIGJh\nc2VkIG9uIGdpdmVuIGluZm8sIG9yIHRlbXBsYXRlIGlmIG5vbmU7CiAgICAg\nICAgLy8gYWxzbyBtYWtlIHN1cmUgdGhhdCBpZiB0aGUgdXNlciBnYXZlIGEg\nY29sdW1uIG5hbWUsIGhlIGRpZG4ndCB0cnkKICAgICAgICAvLyB0byBwdXQg\ndGhlIGNvbHVtbiBpbiBhbiB1bmV4cGVjdGVkIHRhYmxlCiAgICAgICAgaWYg\nKGNvbE5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgY29sTmFtZSA9IHRtcGxh\ndGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBkb3RJZHggPSBjb2xOYW1lLmxh\nc3RJbmRleE9mKCcuJyk7CiAgICAgICAgaWYgKGRvdElkeCA9PSAwKQogICAg\nICAgICAgICBjb2xOYW1lID0gY29sTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAg\nICAgZWxzZSBpZiAoZG90SWR4ICE9IC0xKSB7CiAgICAgICAgICAgIGZpbmRU\nYWJsZShjb250ZXh0LCBjb2xOYW1lLnN1YnN0cmluZygwLCBkb3RJZHgpLCB0\nYWJsZSwKICAgICAgICAgICAgICAgIG51bGwsIG51bGwpOwogICAgICAgICAg\nICBjb2xOYW1lID0gY29sTmFtZS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBmaW5kIGV4aXN0aW5nIGNvbHVtbgogICAg\nICAgIENvbHVtbiBjb2wgPSB0YWJsZS5nZXRDb2x1bW4oY29sTmFtZSk7CiAg\nICAgICAgaWYgKGNvbCA9PSBudWxsICYmICFhZGFwdCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCAr\nICItYmFkLWNvbC1uYW1lIiwKICAgICAgICAgICAgICAgIGNvbnRleHQsIGNv\nbE5hbWUsIHRhYmxlKSk7CgogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJl\ncG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBjb250ZXh0LmdldFJlcG9zaXRv\ncnkoKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IHJlcG9zLmdldERC\nRGljdGlvbmFyeSgpOwoKICAgICAgICAvLyB1c2UgaW5mb3JtYXRpb24gZnJv\nbSB0ZW1wbGF0ZSBjb2x1bW4gYnkgZGVmYXVsdCwgYWxsb3dpbmcgYW55CiAg\nICAgICAgLy8gdXNlci1naXZlbiBzcGVjaWZpY3MgdG8gb3ZlcnJpZGUgaXQK\nICAgICAgICBpbnQgdHlwZSA9IHRtcGxhdGUuZ2V0VHlwZSgpOwogICAgICAg\nIGludCBzaXplID0gdG1wbGF0ZS5nZXRTaXplKCk7CiAgICAgICAgaWYgKHR5\ncGUgPT0gVHlwZXMuT1RIRVIpCiAgICAgICAgICAgIHR5cGUgPSBkaWN0Lmdl\ndEpEQkNUeXBlKHRtcGxhdGUuZ2V0SmF2YVR5cGUoKSwgc2l6ZSA9PSAtMSk7\nCiAgICAgICAgYm9vbGVhbiB0dHlwZSA9IHRydWU7CiAgICAgICAgaW50IG90\neXBlID0gdHlwZTsKICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSB0bXBsYXRl\nLmdldFR5cGVOYW1lKCk7CiAgICAgICAgQm9vbGVhbiBub3ROdWxsID0gbnVs\nbDsKICAgICAgICBpZiAodG1wbGF0ZS5pc05vdE51bGxFeHBsaWNpdCgpKQog\nICAgICAgICAgICBub3ROdWxsID0gKHRtcGxhdGUuaXNOb3ROdWxsKCkpID8g\nQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBpbnQgZGVj\naW1hbHMgPSB0bXBsYXRlLmdldERlY2ltYWxEaWdpdHMoKTsKICAgICAgICBT\ndHJpbmcgZGVmU3RyID0gdG1wbGF0ZS5nZXREZWZhdWx0U3RyaW5nKCk7CiAg\nICAgICAgYm9vbGVhbiBhdXRvQXNzaWduID0gdG1wbGF0ZS5pc0F1dG9Bc3Np\nZ25lZCgpOwogICAgICAgIGJvb2xlYW4gcmVsYXRpb25JZCA9IHRtcGxhdGUu\naXNSZWxhdGlvbklkKCk7CiAgICAgICAgU3RyaW5nIHRhcmdldEZpZWxkID0g\ndG1wbGF0ZS5nZXRUYXJnZXRGaWVsZCgpOwogICAgICAgIGlmIChnaXZlbiAh\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIHVzZSBnaXZlbiB0eXBlIGlmIHBy\nb3ZpZGVkLCBidXQgd2FybiBpZiBpdCBpc24ndCBjb21wYXRpYmxlIHdpdGgK\nICAgICAgICAgICAgLy8gdGhlIGV4cGVjdGVkIGNvbHVtbiB0eXBlCiAgICAg\nICAgICAgIGlmIChnaXZlbi5nZXRUeXBlKCkgIT0gVHlwZXMuT1RIRVIpIHsK\nICAgICAgICAgICAgICAgIHR0eXBlID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICBpZiAoY29tcGF0ICYmICFnaXZlbi5pc0NvbXBhdGlibGUodHlwZSwgdHlw\nZU5hbWUsIHNpemUsIAogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzKSkg\newogICAgICAgICAgICAgICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2co\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQo\ncHJlZml4ICsgIi1pbmNvbXBhdC1jb2wiLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGV4dCwgY29sTmFtZSwgU2NoZW1hcy5nZXRKREJDTmFt\nZSh0eXBlKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nb3R5cGUgPSBnaXZlbi5nZXRUeXBlKCk7CiAgICAgICAgICAgICAgICB0eXBl\nID0gZGljdC5nZXRQcmVmZXJyZWRUeXBlKG90eXBlKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICB0eXBlTmFtZSA9IGdpdmVuLmdldFR5cGVOYW1lKCk7\nCiAgICAgICAgICAgIHNpemUgPSBnaXZlbi5nZXRTaXplKCk7CiAgICAgICAg\nICAgIGRlY2ltYWxzID0gZ2l2ZW4uZ2V0RGVjaW1hbERpZ2l0cygpOwoKICAg\nICAgICAgICAgLy8gbGVhdmUgdGhpcyBpbmZvIGFzIHRoZSB0ZW1wbGF0ZSBk\nZWZhdWx0cyB1bmxlc3MgdGhlIHVzZXIKICAgICAgICAgICAgLy8gZXhwbGlj\naXRseSB0dXJucyBpdCBvbiBpbiB0aGUgZ2l2ZW4gY29sdW1uCiAgICAgICAg\nICAgIGlmIChnaXZlbi5pc05vdE51bGxFeHBsaWNpdCgpKQogICAgICAgICAg\nICAgICAgbm90TnVsbCA9IChnaXZlbi5pc05vdE51bGwoKSkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBpZiAoZ2l2ZW4u\nZ2V0RGVmYXVsdFN0cmluZygpICE9IG51bGwpCiAgICAgICAgICAgICAgICBk\nZWZTdHIgPSBnaXZlbi5nZXREZWZhdWx0U3RyaW5nKCk7CiAgICAgICAgICAg\nIGlmIChnaXZlbi5pc0F1dG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAg\nYXV0b0Fzc2lnbiA9IHRydWU7CiAgICAgICAgICAgIGlmIChnaXZlbi5pc1Jl\nbGF0aW9uSWQoKSkKICAgICAgICAgICAgICAgIHJlbGF0aW9uSWQgPSB0cnVl\nOwogICAgICAgIH0KCiAgICAgICAgLy8gZGVmYXVsdCBjaGFyIGNvbHVtbiBz\naXplIGlmIG9yaWdpbmFsIHR5cGUgaXMgY2hhciAodGVzdCBvcmlnaW5hbAog\nICAgICAgIC8vIHR5cGUgcmF0aGVyIHRoYW4gZmluYWwgdHlwZSBiZWNhdXNl\nIG9yaWcgbWlnaHQgYmUgY2xvYiwgdHJhbnNsYXRlZAogICAgICAgIC8vIHRv\nIGFuIHVuc2l6ZWQgdmFyY2hhciwgd2hpY2ggaXMgc3VwcG9ydGVkIGJ5IHNv\nbWUgZGJzKQogICAgICAgIGlmIChzaXplID09IDAgJiYgKG90eXBlID09IFR5\ncGVzLlZBUkNIQVIgfHwgb3R5cGUgPT0gVHlwZXMuQ0hBUikpCiAgICAgICAg\nICAgIHNpemUgPSBkaWN0LmNoYXJhY3RlckNvbHVtblNpemU7CgogICAgICAg\nIC8vIGNyZWF0ZSBjb2x1bW4sIG9yIG1ha2Ugc3VyZSBleGlzdGluZyBjb2x1\nbW4gbWF0Y2hlcyBleHBlY3RlZCB0eXBlCiAgICAgICAgaWYgKGNvbCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGNvbCA9IHRhYmxlLmFkZENvbHVtbihjb2xO\nYW1lKTsKICAgICAgICAgICAgY29sLnNldFR5cGUodHlwZSk7CiAgICAgICAg\nfSBlbHNlIGlmICgoY29tcGF0IHx8ICF0dHlwZSkgJiYgIWNvbC5pc0NvbXBh\ndGlibGUodHlwZSwgdHlwZU5hbWUsIAogICAgICAgICAgICBzaXplLCBkZWNp\nbWFscykpIHsKICAgICAgICAgICAgLy8gaWYgZXhpc3RpbmcgY29sdW1uIGlz\nbid0IGNvbXBhdGlibGUgd2l0aCBkZXNpcmVkIHR5cGUsIGRpZSBpZgogICAg\nICAgICAgICAvLyBjYW4ndCBhZGFwdCwgZWxzZSB3YXJuIGFuZCBjaGFuZ2Ug\ndGhlIGV4aXN0aW5nIGNvbHVtbiB0eXBlCiAgICAgICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQocHJlZml4ICsgIi1iYWQtY29sIiwgY29udGV4dCwK\nICAgICAgICAgICAgICAgIFNjaGVtYXMuZ2V0SkRCQ05hbWUodHlwZSksIGNv\nbC5nZXREZXNjcmlwdGlvbigpKTsKICAgICAgICAgICAgaWYgKCFhZGFwdCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbiht\nc2cpOwogICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAg\nICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgbG9nLndhcm4obXNnKTsKCiAgICAgICAgICAgIGNvbC5zZXRUeXBl\nKHR5cGUpOwogICAgICAgIH0gZWxzZSBpZiAoZ2l2ZW4gIT0gbnVsbCAmJiBn\naXZlbi5nZXRUeXBlKCkgIT0gVHlwZXMuT1RIRVIpIHsKICAgICAgICAgICAg\nLy8gYXMgbG9uZyBhcyB0eXBlcyBhcmUgY29tcGF0aWJsZSwgc2V0IGNvbHVt\nbiB0byBleHBlY3RlZCB0eXBlCiAgICAgICAgICAgIGNvbC5zZXRUeXBlKHR5\ncGUpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWx3YXlzIHNldCB0aGUgamF2\nYSB0eXBlIGFuZCBhdXRvYXNzaWduIHRvIGV4cGVjdGVkIHZhbHVlcywgZXZl\nbiBvbgogICAgICAgIC8vIGFuIGV4aXN0aW5nIGNvbHVtbiwgc2luY2Ugd2Ug\nZG9uJ3QgZ2V0IHRoaXMgZnJvbSB0aGUgREIKICAgICAgICBpZiAoY29tcGF0\nKQogICAgICAgICAgICBjb2wuc2V0SmF2YVR5cGUodG1wbGF0ZS5nZXRKYXZh\nVHlwZSgpKTsKICAgICAgICBlbHNlIGlmIChjb2wuZ2V0SmF2YVR5cGUoKSA9\nPSBKYXZhVHlwZXMuT0JKRUNUKSB7CiAgICAgICAgICAgIGlmIChnaXZlbiAh\nPSBudWxsICYmIGdpdmVuLmdldEphdmFUeXBlKCkgIT0gSmF2YVR5cGVzLk9C\nSkVDVCkKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShnaXZlbi5n\nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgY29sLnNldEphdmFUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29kZQogICAg\nICAgICAgICAgICAgICAgIChTY2hlbWFzLmdldEphdmFUeXBlKGNvbC5nZXRU\neXBlKCksIGNvbC5nZXRTaXplKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpKSk7CiAgICAgICAgfQogICAgICAg\nIGNvbC5zZXRBdXRvQXNzaWduZWQoYXV0b0Fzc2lnbik7CiAgICAgICAgY29s\nLnNldFJlbGF0aW9uSWQocmVsYXRpb25JZCk7CiAgICAgICAgY29sLnNldFRh\ncmdldEZpZWxkKHRhcmdldEZpZWxkKTsKCiAgICAgICAgLy8gd2UgbmVlZCB0\naGlzIGZvciBydW50aW1lLCBhbmQgdGhlIGR5bmFtaWMgc2NoZW1hIGZhY3Rv\ncnkgbWlnaHQKICAgICAgICAvLyBub3Qga25vdyBpdCwgc28gc2V0IGl0IGV2\nZW4gaWYgbm90IGFkYXB0aW5nCiAgICAgICAgaWYgKGRlZlN0ciAhPSBudWxs\nKQogICAgICAgICAgICBjb2wuc2V0RGVmYXVsdFN0cmluZyhkZWZTdHIpOwog\nICAgICAgIGlmIChub3ROdWxsICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5z\nZXROb3ROdWxsKG5vdE51bGwuYm9vbGVhblZhbHVlKCkpOwoKICAgICAgICAv\nLyBhZGQgb3RoZXIgZGV0YWlscyBpZiBhZGFwdGluZwogICAgICAgIGlmIChh\nZGFwdCkgewogICAgICAgICAgICBpZiAodHlwZU5hbWUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZSh0eXBlTmFtZSk7CiAgICAg\nICAgICAgIGlmIChzaXplICE9IDApCiAgICAgICAgICAgICAgICBjb2wuc2V0\nU2l6ZShzaXplKTsKICAgICAgICAgICAgaWYgKGRlY2ltYWxzICE9IDApCiAg\nICAgICAgICAgICAgICBjb2wuc2V0RGVjaW1hbERpZ2l0cyhkZWNpbWFscyk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAodG1wbGF0ZS5oYXNDb21tZW50KCkp\nCiAgICAgICAgICAgIGNvbC5zZXRDb21tZW50KHRtcGxhdGUuZ2V0Q29tbWVu\ndCgpKTsKICAgICAgICByZXR1cm4gY29sOwogICAgfQoKICAgIC8qKgogICAg\nICogRmluZCB0aGUgdGFibGUgbmFtZWQgYnkgYSBjb2x1bW4gb3IgdGFyZ2V0\nLgogICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0IGNvbnRleHQgZm9yIGVy\ncm9yIG1lc3NhZ2VzLCBldGMuCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFi\nbGUgbmFtZSwgcG9zc2libHkgaW5jbHVkaW5nIHNjaGVtYQogICAgICogQHBh\ncmFtIGV4cGVjdGVkIHRoZSBleHBlY3RlZCB0YWJsZTsgbWF5IGJlIG51bGwK\nICAgICAqIEBwYXJhbSBpbnZlcnNlIHRoZSBwb3NzaWJsZSBpbnZlcnNlIHRh\nYmxlOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHJlbCBpZiB3ZSdyZSBm\naW5kaW5nIHRoZSB0YXJnZXQgdGFibGUgb2YgYSBqb2luLCB0aGUKICAgICAq\nIGpvaW5lZC10byB0eXBlOyBhbGxvd3MgdXMgdG8gYWxzbyBsb29rIGluIGl0\ncyBzdXBlcmNsYXNzIHRhYmxlcwogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBUYWJsZSBmaW5kVGFibGUoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFN0\ncmluZyBuYW1lLAogICAgICAgIFRhYmxlIGV4cGVjdGVkLCBUYWJsZSBpbnZl\ncnNlLCBDbGFzc01hcHBpbmcgcmVsKSB7CiAgICAgICAgLy8gaXMgdGhpcyB0\naGUgZXhwZWN0ZWQgdGFibGU/CiAgICAgICAgaWYgKGV4cGVjdGVkID09IG51\nbGwgJiYgcmVsICE9IG51bGwpCiAgICAgICAgICAgIGV4cGVjdGVkID0gcmVs\nLmdldFRhYmxlKCk7CiAgICAgICAgaWYgKGV4cGVjdGVkICE9IG51bGwgJiYg\naXNUYWJsZU5hbWUobmFtZSwgZXhwZWN0ZWQpKQogICAgICAgICAgICByZXR1\ncm4gZXhwZWN0ZWQ7CgogICAgICAgIC8vIGNoZWNrIGZvciBpbnZlcnNlCiAg\nICAgICAgaWYgKGludmVyc2UgIT0gbnVsbCAmJiBpc1RhYmxlTmFtZShuYW1l\nLCBpbnZlcnNlKSkKICAgICAgICAgICAgcmV0dXJuIGludmVyc2U7CgogICAg\nICAgIC8vIHN1cGVyY2xhc3MgdGFibGU/CiAgICAgICAgaWYgKHJlbCAhPSBu\ndWxsKQogICAgICAgICAgICByZWwgPSByZWwuZ2V0Sm9pbmFibGVQQ1N1cGVy\nY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgd2hpbGUgKHJlbCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGlmIChpc1RhYmxlTmFtZShuYW1lLCByZWwuZ2V0VGFi\nbGUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gcmVsLmdldFRhYmxlKCk7\nCiAgICAgICAgICAgIHJlbCA9IHJlbC5nZXRKb2luYWJsZVBDU3VwZXJjbGFz\nc01hcHBpbmcoKTsKICAgICAgICB9CgogICAgICAgIC8vIG5vbmUgb2YgdGhl\nIHBvc3NpYmxlIHRhYmxlcwogICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiY29sLXdyb25nLXRhYmxlIiwgY29udGV4dCwK\nICAgICAgICAgICAgZXhwZWN0ZWQsIG5hbWUpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBuYW1lIG1hdGNoZXMg\ndGhlIGdpdmVuIHRhYmxlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBi\nb29sZWFuIGlzVGFibGVOYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSkg\newogICAgICAgIHJldHVybiBuYW1lLmVxdWFsc0lnbm9yZUNhc2UodGFibGUu\nZ2V0TmFtZSgpKQogICAgICAgICAgICB8fCBuYW1lLmVxdWFsc0lnbm9yZUNh\nc2UodGFibGUuZ2V0RnVsbE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXRyaWV2ZS9jcmVhdGUgYW4gaW5kZXggb24gdGhlIGdpdmVuIGNvbHVt\nbnMgYnkgbWVyZ2luZyB0aGUgZ2l2ZW4KICAgICAqIHRlbXBsYXRlIGluZm9y\nbWF0aW9uIHdpdGggYW55IHVzZXItcHJvdmlkZWQgaW5mb3JtYXRpb24uCiAg\nICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2UncmUg\ncmV0cmlldmluZyBhbiBpbmRleCBmb3IKICAgICAqIEBwYXJhbSBwcmVmaXgg\nbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICogQHBh\ncmFtIHRtcGxhdGUgdGVtcGxhdGUgZm9yIGV4cGVjdGVkIGluZGV4IGluZm9y\nbWF0aW9uCiAgICAgKiBAcGFyYW0gY29scyB0aGUgaW5kZXhlZCBjb2x1bW5z\nCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRo\nZSBleGlzdGluZyBtYXBwaW5nIG9yIHNjaGVtYQogICAgICovCiAgICBwcm90\nZWN0ZWQgSW5kZXggY3JlYXRlSW5kZXgoTWV0YURhdGFDb250ZXh0IGNvbnRl\neHQsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgSW5kZXggdG1wbGF0ZSwgQ29s\ndW1uW10gY29scywgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChwcmVm\naXggPT0gbnVsbCkKICAgICAgICAgICAgcHJlZml4ID0gImdlbmVyaWMiOwoK\nICAgICAgICAvLyBjYW4ndCBjcmVhdGUgYW4gaW5kZXggaWYgdGhlcmUgYXJl\nIG5vIGNvbHMKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVu\nZ3RoID09IDApIHsKICAgICAgICAgICAgaWYgKF9pZHggIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICItbm8taW5kZXgt\nY29scyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQoKICAgICAgICAvLyBsb29rIGZvciBhbiBleGlzdGluZyBpbmRl\neCBvbiB0aGVzZSBjb2x1bW5zCiAgICAgICAgVGFibGUgdGFibGUgPSBjb2xz\nWzBdLmdldFRhYmxlKCk7CiAgICAgICAgSW5kZXhbXSBpZHhzID0gdGFibGUu\nZ2V0SW5kZXhlcygpOwogICAgICAgIEluZGV4IGV4aXN0ID0gbnVsbDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlkeHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGlkeHNbaV0uY29sdW1uc01hdGNoKGNvbHMpKSB7\nCiAgICAgICAgICAgICAgICBleGlzdCA9IGlkeHNbaV07CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gcmVtb3ZlIGV4aXN0aW5nIGluZGV4PwogICAgICAgIGlmICghX2Nhbklk\neCkgewogICAgICAgICAgICBpZiAoZXhpc3QgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoIWFkYXB0KQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KHByZWZpeCArICItaW5kZXgtZXhpc3RzIiwKICAgICAgICAgICAg\nICAgICAgICBjb250ZXh0KSk7CiAgICAgICAgICAgIHRhYmxlLnJlbW92ZUlu\nZGV4KGV4aXN0KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiB3ZSBoYXZlIGFuIGV4aXN0aW5nIGluZGV4LCBt\nZXJnZSBnaXZlbiBpbmZvIGludG8gaXQKICAgICAgICBpZiAoZXhpc3QgIT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX2lkeCAhPSBudWxsICYmIF9pZHgu\naXNVbmlxdWUoKSAmJiAhZXhpc3QuaXNVbmlxdWUoKSkgewogICAgICAgICAg\nICAgICAgaWYgKCFhZGFwdCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAg\nICAgICAgICAgICAgICAgICsgIi1pbmRleC1ub3QtdW5pcXVlIiwgY29udGV4\ndCkpOwogICAgICAgICAgICAgICAgZXhpc3Quc2V0VW5pcXVlKHRydWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBleGlzdDsKICAgICAg\nICB9CgogICAgICAgIC8vIGlmIG5vIGRlZmF1bHRzIHJldHVybiBudWxsCiAg\nICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9z\naXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIGJvb2xl\nYW4gZmlsbCA9IHJlcG9zLmdldE1hcHBpbmdEZWZhdWx0cygpLmRlZmF1bHRN\naXNzaW5nSW5mbygpOwogICAgICAgIGlmIChfaWR4ID09IG51bGwgJiYgKHRt\ncGxhdGUgPT0gbnVsbCB8fCAoIWFkYXB0ICYmICFmaWxsKSkpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgbmFtZSA9IG51bGw7\nCiAgICAgICAgYm9vbGVhbiB1bnE7CiAgICAgICAgaWYgKF9pZHggIT0gbnVs\nbCkgewogICAgICAgICAgICBuYW1lID0gX2lkeC5nZXROYW1lKCk7CiAgICAg\nICAgICAgIHVucSA9IF9pZHguaXNVbmlxdWUoKTsKICAgICAgICAgICAgLy8g\ncHJlc2VydmUgbXVsdGlwbGUgY29sdW1ucyBpZiB0aGV5IGFyZSBzcGVjaWZp\nZWQgaW4gdGhlIGluZGV4CiAgICAgICAgICAgIGlmIChfaWR4LmdldENvbHVt\nbnMoKSAhPSBudWxsICYmIF9pZHguZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDEp\nCiAgICAgICAgICAgICAgICBjb2xzID0gX2lkeC5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgIHVucSA9IHRtcGxhdGUuaXNVbmlx\ndWUoKTsKCiAgICAgICAgLy8gaWYgbm8gbmFtZSBwcm92aWRlZCBieSB1c2Vy\nIGluZm8sIG1ha2Ugb25lCiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAodG1wbGF0ZSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgbmFtZSA9IHRtcGxhdGUuZ2V0TmFtZSgpOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBjb2xzWzBdLmdldE5hbWUoKTsK\nICAgICAgICAgICAgICAgIG5hbWUgPSByZXBvcy5nZXREQkRpY3Rpb25hcnko\nKS5nZXRWYWxpZEluZGV4TmFtZShuYW1lLCB0YWJsZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIEluZGV4IGlkeCA9IHRhYmxlLmFkZElu\nZGV4KG5hbWUpOwogICAgICAgIGlkeC5zZXRVbmlxdWUodW5xKTsKICAgICAg\nICBpZHguc2V0Q29sdW1ucyhjb2xzKTsKICAgICAgICByZXR1cm4gaWR4Owog\nICAgfQoKICAgIC8qKgogICAgICogUmV0cmlldmUvY3JlYXRlIGEgdW5pcXVl\nIGNvbnN0cmFpbnQgb24gdGhlIGdpdmVuIGNvbHVtbnMgYnkgbWVyZ2luZyB0\naGUKICAgICAqIGdpdmVuIHRlbXBsYXRlIGluZm9ybWF0aW9uIHdpdGggYW55\nIHVzZXItcHJvdmlkZWQgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBh\ncmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBhIGNv\nbnN0cmFpbnQgZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBl\ncnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSB0bXBsYXRl\nIHRlbXBsYXRlIGZvciBleHBlY3RlZCB1bmlxdWUgaW5mb3JtYXRpb24KICAg\nICAqIEBwYXJhbSBjb2xzIHRoZSBjb25zdHJhaW50IGNvbHVtbnMKICAgICAq\nIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBtb2RpZnkgdGhlIGV4aXN0\naW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKi8KICAgIHByb3RlY3RlZCBV\nbmlxdWUgY3JlYXRlVW5pcXVlKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBT\ndHJpbmcgcHJlZml4LAogICAgICAgIFVuaXF1ZSB0bXBsYXRlLCBDb2x1bW5b\nXSBjb2xzLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKHByZWZpeCA9\nPSBudWxsKQogICAgICAgICAgICBwcmVmaXggPSAiZ2VuZXJpYyI7CgogICAg\nICAgIC8vIGNhbid0IGNyZWF0ZSBhIGNvbnN0cmFpbnQgaWYgdGhlcmUgYXJl\nIG5vIGNvbHMKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVu\nZ3RoID09IDApIHsKICAgICAgICAgICAgaWYgKF91bnEgIT0gbnVsbCB8fCB0\nbXBsYXRlICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAg\nICAgICAgKyAiLW5vLXVuaXF1ZS1jb2xzIiwgY29udGV4dCkpOwogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGxvb2sg\nZm9yIGFuIGV4aXN0aW5nIGNvbnN0cmFpbnQgb24gdGhlc2UgY29sdW1ucwog\nICAgICAgIFRhYmxlIHRhYmxlID0gY29sc1swXS5nZXRUYWJsZSgpOwogICAg\nICAgIFVuaXF1ZVtdIHVucXMgPSB0YWJsZS5nZXRVbmlxdWVzKCk7CiAgICAg\nICAgVW5pcXVlIGV4aXN0ID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHVucXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHVu\ncXNbaV0uY29sdW1uc01hdGNoKGNvbHMpKSB7CiAgICAgICAgICAgICAgICBl\neGlzdCA9IHVucXNbaV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGV4aXN0aW5n\nIHVuaXF1ZT8KICAgICAgICBpZiAoIV9jYW5VbnEpIHsKICAgICAgICAgICAg\naWYgKGV4aXN0ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgaWYgKCFhZGFwdCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAg\nICAgICAgICAgICAgICAgICArICItdW5pcXVlLWV4aXN0cyIsIGNvbnRleHQp\nKTsKICAgICAgICAgICAgdGFibGUucmVtb3ZlVW5pcXVlKGV4aXN0KTsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBu\nbyBkZWZhdWx0czsgcmV0dXJuIGV4aXN0aW5nIGNvbnN0cmFpbnQgKGlmIGFu\neSkKICAgICAgICBpZiAodG1wbGF0ZSA9PSBudWxsICYmIF91bnEgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGV4aXN0OwoKICAgICAgICBNYXBwaW5n\nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4\ndC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgaWYgKGV4aXN0ICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKF91bnEgIT0gbnVsbCAmJiBfdW5xLmlzRGVm\nZXJyZWQoKSAmJiAhZXhpc3QuaXNEZWZlcnJlZCgpKSB7CiAgICAgICAgICAg\nICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgICAgICAg\nICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldChwcmVmaXggKyAiLWRlZmVyLXVuaXF1ZSIs\nIGNvbnRleHQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nZXhpc3Q7CiAgICAgICAgfQoKICAgICAgICAvLyBkaWN0IGNhbid0IGhhbmRs\nZSB1bmlxdWUgY29uc3RyYWludHM/CiAgICAgICAgREJEaWN0aW9uYXJ5IGRp\nY3QgPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICBpZiAoX3Vu\ncSAhPSBudWxsICYmICFkaWN0LnN1cHBvcnRzVW5pcXVlQ29uc3RyYWludHMp\nIHsKICAgICAgICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCArICItdW5pcXVlLXN1cHBv\ncnQiLCBjb250ZXh0KSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIH0KCiAgICAgICAgYm9vbGVhbiBmaWxsID0gcmVwb3MuZ2V0TWFwcGlu\nZ0RlZmF1bHRzKCkuZGVmYXVsdE1pc3NpbmdJbmZvKCk7CiAgICAgICAgaWYg\nKCFhZGFwdCAmJiAhZmlsbCAmJiBfdW5xID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBi\nb29sZWFuIGRlZmVycmVkOwogICAgICAgIGlmIChfdW5xICE9IG51bGwpIHsK\nICAgICAgICAgICAgbmFtZSA9IF91bnEuZ2V0TmFtZSgpOwogICAgICAgICAg\nICBkZWZlcnJlZCA9IF91bnEuaXNEZWZlcnJlZCgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIG5hbWUgPSB0bXBsYXRlLmdldE5hbWUoKTsKICAg\nICAgICAgICAgZGVmZXJyZWQgPSB0bXBsYXRlLmlzRGVmZXJyZWQoKTsKICAg\nICAgICB9CgogICAgICAgIGlmIChkZWZlcnJlZCAmJiAhZGljdC5zdXBwb3J0\nc0RlZmVycmVkQ29uc3RyYWludHMpIHsKICAgICAgICAgICAgTG9nIGxvZyA9\nIHJlcG9zLmdldExvZygpOwogICAgICAgICAgICBpZiAobG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KHBy\nZWZpeCArICItY3JlYXRlLWRlZmVyLXVuaXF1ZSIsCiAgICAgICAgICAgICAg\nICAgICAgY29udGV4dCwgZGljdC5wbGF0Zm9ybSkpOwogICAgICAgICAgICBk\nZWZlcnJlZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgVW5pcXVlIHVu\ncSA9IHRhYmxlLmFkZFVuaXF1ZShuYW1lKTsKICAgICAgICB1bnEuc2V0RGVm\nZXJyZWQoZGVmZXJyZWQpOwogICAgICAgIHVucS5zZXRDb2x1bW5zKGNvbHMp\nOwogICAgICAgIHJldHVybiB1bnE7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXRyaWV2ZS9jcmVhdGUgYSBmb3JlaWduIGtleSAocG9zc2libHkgbG9naWNh\nbCkgb24gdGhlIGdpdmVuIGNvbHVtbnMKICAgICAqIGJ5IG1lcmdpbmcgdGhl\nIGdpdmVuIHRlbXBsYXRlIGluZm9ybWF0aW9uIHdpdGggYW55IHVzZXItcHJv\ndmlkZWQKICAgICAqIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIEBwYXJh\nbSBjb250ZXh0IHRoZSBtYXBwaW5nIHdlJ3JlIHJldHJpZXZpbmcgYSBrZXkg\nZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNz\nYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSBnaXZlbiB0aGUgY29sdW1u\ncyBnaXZlbiBieSB0aGUgdXNlcgogICAgICogQHBhcmFtIGRlZiBkZWZhdWx0\ncyBwcm92aWRlcgogICAgICogQHBhcmFtIHRhYmxlIHRoZSB0YWJsZSBmb3Ig\ndGhlIGtleQogICAgICogQHBhcmFtIGNscyB0eXBlIHdlJ3JlIGpvaW5pbmcg\nZnJvbQogICAgICogQHBhcmFtIHJlbCB0YXJnZXQgdHlwZSB3ZSdyZSBqb2lu\naW5nIHRvCiAgICAgKiBAcGFyYW0gaW52ZXJzYWJsZSB3aGV0aGVyIHRoZSBm\nb3JlaWduIGtleSBjYW4gYmUgaW52ZXJzZWQKICAgICAqIEBwYXJhbSBhZGFw\ndCB3aGV0aGVyIHdlIGNhbiBtb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcg\nb3Igc2NoZW1hCiAgICAgKi8KICAgIHByb3RlY3RlZCBGb3JlaWduS2V5IGNy\nZWF0ZUZvcmVpZ25LZXkoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsCiAgICAg\nICAgU3RyaW5nIHByZWZpeCwgTGlzdCBnaXZlbiwgRm9yZWlnbktleURlZmF1\nbHRzIGRlZiwgVGFibGUgdGFibGUsCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNs\ncywgQ2xhc3NNYXBwaW5nIHJlbCwgYm9vbGVhbiBpbnZlcnNhYmxlLCBib29s\nZWFuIGFkYXB0KSB7CiAgICAgICAgYXNzZXJ0VGFibGUoY29udGV4dCwgdGFi\nbGUpOwogICAgICAgIGlmIChwcmVmaXggPT0gbnVsbCkKICAgICAgICAgICAg\ncHJlZml4ID0gImdlbmVyaWMiOwoKICAgICAgICAvLyBjb2xsZWN0IHRoZSBm\nb3JlaWduIGtleSBjb2x1bW5zIGFuZCB0aGVpciB0YXJnZXRzCiAgICAgICAg\nT2JqZWN0W11bXSBqb2lucyA9IGNyZWF0ZUpvaW5zKGNvbnRleHQsIHByZWZp\neCwgdGFibGUsIGNscywgcmVsLAogICAgICAgICAgICBnaXZlbiwgZGVmLCBp\nbnZlcnNhYmxlLCBhZGFwdCk7CiAgICAgICAgX2pvaW4gPSBKT0lOX0ZPUldB\nUkQ7CgogICAgICAgIC8vIGVzdGFibGlzaCBsb2NhbCB0YWJsZSB1c2luZyBh\nbnkgam9pbiBiZXR3ZWVuIHR3byBjb2x1bW5zOyBpZiB3ZSBvbmx5CiAgICAg\nICAgLy8gZmluZCBjb25zdGFudCBqb2lucywgdGhlbiBrZWVwIGRlZmF1bHQg\nbG9jYWwgdGFibGUgKGRpcmVjdGlvbmxlc3MpCiAgICAgICAgVGFibGUgbG9j\nYWwgPSB0YWJsZTsKICAgICAgICBUYWJsZSBmb3JlaWduID0gcmVsLmdldFRh\nYmxlKCk7CiAgICAgICAgVGFibGUgdG1wOwogICAgICAgIGJvb2xlYW4gY29u\nc3RhbnQgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGxvY2FsU2V0ID0gZmFs\nc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoam9pbnNbaV1bMV1pbnN0YW5jZW9m\nIENvbHVtbikgewogICAgICAgICAgICAgICAgdG1wID0gKChDb2x1bW4pIGpv\naW5zW2ldWzBdKS5nZXRUYWJsZSgpOwogICAgICAgICAgICAgICAgaWYgKCFs\nb2NhbFNldCkgewogICAgICAgICAgICAgICAgICAgIGxvY2FsID0gdG1wOwog\nICAgICAgICAgICAgICAgICAgIGxvY2FsU2V0ID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAodG1wICE9IGxvY2FsKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChw\ncmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgKyAiLW11bHQtZmstdGFi\nbGVzIiwgY29udGV4dCwgbG9jYWwsIHRtcCkpOwogICAgICAgICAgICAgICAg\nZm9yZWlnbiA9ICgoQ29sdW1uKSBqb2luc1tpXVsxXSkuZ2V0VGFibGUoKTsK\nCiAgICAgICAgICAgICAgICBpZiAoam9pbnNbaV1bMl0gPT0gQm9vbGVhbi5U\nUlVFKQogICAgICAgICAgICAgICAgICAgIF9qb2luID0gSk9JTl9JTlZFUlNF\nOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGNvbnN0YW50\nID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgaXMgbm90\nIGEgY29uc3RhbnQgam9pbiwgbG9vayBmb3IgZXhpc3RpbmcgZm9yZWlnbiBr\nZXkKICAgICAgICAvLyBvbiBsb2NhbCBjb2x1bW5zCiAgICAgICAgRm9yZWln\nbktleSBleGlzdCA9IG51bGw7CiAgICAgICAgaWYgKCFjb25zdGFudCAmJiBs\nb2NhbC5nZXRGb3JlaWduS2V5cygpLmxlbmd0aCA+IDApIHsKICAgICAgICAg\nICAgQ29sdW1uW10gY29scyA9IG5ldyBDb2x1bW5bam9pbnMubGVuZ3RoXTsK\nICAgICAgICAgICAgQ29sdW1uW10gcGtzID0gbmV3IENvbHVtbltqb2lucy5s\nZW5ndGhdOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpvaW5z\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb2xzW2ldID0gKENv\nbHVtbikgam9pbnNbaV1bMF07CiAgICAgICAgICAgICAgICBwa3NbaV0gPSAo\nQ29sdW1uKSBqb2luc1tpXVsxXTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgRm9yZWlnbktleVtdIGZrcyA9IGxvY2FsLmdldEZvcmVpZ25LZXlzKCk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZmtzW2ldLmdldENvbnN0YW50\nQ29sdW1ucygpLmxlbmd0aCA9PSAwCiAgICAgICAgICAgICAgICAgICAgJiYg\nZmtzW2ldLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKS5sZW5ndGgg\nPT0gMAogICAgICAgICAgICAgICAgICAgICYmIGZrc1tpXS5jb2x1bW5zTWF0\nY2goY29scywgcGtzKSkgewogICAgICAgICAgICAgICAgICAgIGV4aXN0ID0g\nZmtzW2ldOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBNYXBw\naW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgY29u\ndGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRp\nY3QgPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICBpZiAoZXhp\nc3QgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBtYWtlIGV4aXN0aW5nIGtl\neSBsb2dpY2FsPwogICAgICAgICAgICBpZiAoIV9jYW5GSykgewogICAgICAg\nICAgICAgICAgaWYgKGV4aXN0LmdldERlbGV0ZUFjdGlvbigpICE9IGV4aXN0\nLkFDVElPTl9OT05FICYmICFhZGFwdCkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAg\nICAgICAgICAgICAgICAgICAgICAgICsgIi1may1leGlzdHMiLCBjb250ZXh0\nKSk7CiAgICAgICAgICAgICAgICBleGlzdC5zZXREZWxldGVBY3Rpb24oZXhp\nc3QuQUNUSU9OX05PTkUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAoX2ZrICE9IG51bGwgJiYgX2ZrLmlzRGVmZXJyZWQoKSAmJiAhZXhpc3Qu\naXNEZWZlcnJlZCgpKSB7CiAgICAgICAgICAgICAgICBMb2cgbG9nID0gcmVw\nb3MuZ2V0TG9nKCk7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdl\ndChwcmVmaXggKyAiLWRlZmVyLWZrIiwgY29udGV4dCkpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBhbGxvdyB1c2VyLWdpdmVuIGluZm8gdG8g\nb3ZlcnJpZGUgZXhpc3Rpbmcga2V5IGlmIHdlJ3JlIGFkYXB0aW5nOwogICAg\nICAgICAgICAvLyB0ZW1wbGF0ZSBpbmZvIGNhbm5vdCBvdmVycmlkZSBleGlz\ndGluZyBrZXkKICAgICAgICAgICAgaWYgKGFkYXB0ICYmIF9mayAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoX2ZrLmdldFVwZGF0ZUFjdGlvbigp\nICE9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAgICAgICAg\nICAgZXhpc3Quc2V0VXBkYXRlQWN0aW9uKF9may5nZXRVcGRhdGVBY3Rpb24o\nKSk7CiAgICAgICAgICAgICAgICBpZiAoX2ZrLmdldERlbGV0ZUFjdGlvbigp\nICE9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAgICAgICAg\nICAgZXhpc3Quc2V0RGVsZXRlQWN0aW9uKF9may5nZXREZWxldGVBY3Rpb24o\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0SU9Gcm9tSm9pbnMo\nZXhpc3QsIGpvaW5zKTsKICAgICAgICAgICAgcmV0dXJuIGV4aXN0OwogICAg\nICAgIH0KCiAgICAgICAgU3RyaW5nIG5hbWUgPSBudWxsOwogICAgICAgIGlu\ndCBkZWxBY3Rpb24gPSBGb3JlaWduS2V5LkFDVElPTl9OT05FOwogICAgICAg\nIGludCB1cEFjdGlvbiA9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAgICAg\nICAgYm9vbGVhbiBkZWZlcnJlZCA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4g\nZmlsbCA9IHJlcG9zLmdldE1hcHBpbmdEZWZhdWx0cygpLmRlZmF1bHRNaXNz\naW5nSW5mbygpOwogICAgICAgIEZvcmVpZ25LZXkgdG1wbGF0ZSA9IChkZWYg\nPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAgIDogZGVmLmdldChsb2NhbCwg\nZm9yZWlnbiwgX2pvaW4gPT0gSk9JTl9JTlZFUlNFKTsKICAgICAgICBpZiAo\nX2ZrICE9IG51bGwgJiYgKHRtcGxhdGUgPT0gbnVsbCB8fCAoIWFkYXB0ICYm\nICFmaWxsKSkpIHsKICAgICAgICAgICAgLy8gaWYgbm90IGFkYXB0aW5nIG9y\nIG5vIHRlbXBsYXRlIGluZm8gdXNlIGdpdmVuIGRhdGEKICAgICAgICAgICAg\nbmFtZSA9IF9may5nZXROYW1lKCk7CiAgICAgICAgICAgIGRlbEFjdGlvbiA9\nIF9may5nZXREZWxldGVBY3Rpb24oKTsKICAgICAgICAgICAgdXBBY3Rpb24g\nPSBfZmsuZ2V0VXBkYXRlQWN0aW9uKCk7CiAgICAgICAgICAgIGRlZmVycmVk\nID0gX2ZrLmlzRGVmZXJyZWQoKTsKICAgICAgICB9IGVsc2UgaWYgKF9jYW5G\nSyAmJiAoYWRhcHQgfHwgZmlsbCkpIHsKICAgICAgICAgICAgaWYgKF9mayA9\nPSBudWxsICYmIHRtcGxhdGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nLy8gbm8gdXNlciBnaXZlbiBpbmZvOyB1c2UgdGVtcGxhdGUgZGF0YQogICAg\nICAgICAgICAgICAgbmFtZSA9IHRtcGxhdGUuZ2V0TmFtZSgpOwogICAgICAg\nICAgICAgICAgZGVsQWN0aW9uID0gdG1wbGF0ZS5nZXREZWxldGVBY3Rpb24o\nKTsKICAgICAgICAgICAgICAgIHVwQWN0aW9uID0gdG1wbGF0ZS5nZXRVcGRh\ndGVBY3Rpb24oKTsKICAgICAgICAgICAgICAgIGRlZmVycmVkID0gdG1wbGF0\nZS5pc0RlZmVycmVkKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX2ZrICE9\nIG51bGwgJiYgdG1wbGF0ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAv\nLyBtZXJnZSB1c2VyIGFuZCB0ZW1wbGF0ZSBkYXRhLCBhbHdheXMgbGV0dGlu\nZyB1c2VyIGluZm8gd2luCiAgICAgICAgICAgICAgICBuYW1lID0gX2ZrLmdl\ndE5hbWUoKTsKICAgICAgICAgICAgICAgIGlmIChuYW1lID09IG51bGwgJiYg\ndG1wbGF0ZS5nZXROYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBuYW1lID0gdG1wbGF0ZS5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICBk\nZWxBY3Rpb24gPSBfZmsuZ2V0RGVsZXRlQWN0aW9uKCk7CiAgICAgICAgICAg\nICAgICBpZiAoZGVsQWN0aW9uID09IEZvcmVpZ25LZXkuQUNUSU9OX05PTkUp\nCiAgICAgICAgICAgICAgICAgICAgZGVsQWN0aW9uID0gdG1wbGF0ZS5nZXRE\nZWxldGVBY3Rpb24oKTsKICAgICAgICAgICAgICAgIHVwQWN0aW9uID0gX2Zr\nLmdldFVwZGF0ZUFjdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKHVwQWN0\naW9uID09IEZvcmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAgICAg\nICAgICAgdXBBY3Rpb24gPSB0bXBsYXRlLmdldFVwZGF0ZUFjdGlvbigpOwog\nICAgICAgICAgICAgICAgZGVmZXJyZWQgPSBfZmsuaXNEZWZlcnJlZCgpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIWRpY3Quc3Vw\ncG9ydHNEZWxldGVBY3Rpb24oZGVsQWN0aW9uKQogICAgICAgICAgICB8fCAh\nZGljdC5zdXBwb3J0c1VwZGF0ZUFjdGlvbih1cEFjdGlvbikpIHsKICAgICAg\nICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAgICAgICAgICBp\nZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53\nYXJuKF9sb2MuZ2V0KHByZWZpeCArICItdW5zdXBwb3J0ZWQtZmstYWN0aW9u\nIiwgY29udGV4dCkpOwogICAgICAgICAgICBkZWxBY3Rpb24gPSBGb3JlaWdu\nS2V5LkFDVElPTl9OT05FOwogICAgICAgICAgICB1cEFjdGlvbiA9IEZvcmVp\nZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAgfQogICAgICAgIGlmIChkZWZl\ncnJlZCAmJiAhZGljdC5zdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMpIHsK\nICAgICAgICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAgICAg\nICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCArICItY3JlYXRlLWRlZmVyLWZr\nIiwKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LCBkaWN0LnBsYXRmb3Jt\nKSk7CiAgICAgICAgICAgIGRlZmVycmVkID0gZmFsc2U7CiAgICAgICAgfQoK\nICAgICAgICAvLyBjcmVhdGUgZm9yZWlnbiBrZXkgd2l0aCBtZXJnZWQgaW5m\nbwogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBsb2NhbC5hZGRGb3JlaWduS2V5\nKG5hbWUpOwogICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihkZWxBY3Rpb24p\nOwogICAgICAgIGZrLnNldFVwZGF0ZUFjdGlvbih1cEFjdGlvbik7CiAgICAg\nICAgZmsuc2V0RGVmZXJyZWQoZGVmZXJyZWQpOwoKICAgICAgICAvLyBhZGQg\nam9pbnMgdG8ga2V5CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGNvbCA9IChDb2x1bW4pIGpvaW5zW2ldWzBdOwogICAgICAgICAgICBp\nZiAoam9pbnNbaV1bMV1pbnN0YW5jZW9mIENvbHVtbikKICAgICAgICAgICAg\nICAgIGZrLmpvaW4oY29sLCAoQ29sdW1uKSBqb2luc1tpXVsxXSk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKChqb2luc1tpXVsyXSA9PSBCb29sZWFuLlRSVUUp\nICE9IChfam9pbiA9PSBKT0lOX0lOVkVSU0UpKQogICAgICAgICAgICAgICAg\nZmsuam9pbkNvbnN0YW50KGpvaW5zW2ldWzFdLCBjb2wpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBmay5qb2luQ29uc3RhbnQoY29sLCBq\nb2luc1tpXVsxXSk7CiAgICAgICAgfQogICAgICAgIHNldElPRnJvbUpvaW5z\nKGZrLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZrOwogICAgfQoKICAgIC8q\nKgogICAgICogVXNlIHRoZSBqb2luIGluZm9ybWF0aW9uIHRvIHBvcHVsYXRl\nIG91ciBpbnRlcm5hbCBjb2x1bW4gSS9PIGRhdGEuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBzZXRJT0Zyb21Kb2lucyhGb3JlaWduS2V5IGZrLCBPYmpl\nY3RbXVtdIGpvaW5zKSB7CiAgICAgICAgTGlzdCBjb2xzID0gZ2V0Q29sdW1u\ncygpOwogICAgICAgIF9pbyA9IG51bGw7CiAgICAgICAgaWYgKGNvbHMuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGludCBjb25z\ndElkeCA9IDA7CiAgICAgICAgaW50IGlkeDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8v\nIGNvbnN0IGNvbHVtbnMgYXJlIGluZGV4ZWQgYWZ0ZXIgc3RkIGpvaW4gY29s\ndW1ucyBpbiBmayBJTwogICAgICAgICAgICBpZiAoam9pbnNbaV1bMV1pbnN0\nYW5jZW9mIENvbHVtbikKICAgICAgICAgICAgICAgIGlkeCA9IGkgLSBjb25z\ndElkeDsKICAgICAgICAgICAgZWxzZSBpZiAoKGpvaW5zW2ldWzJdID09IEJv\nb2xlYW4uVFJVRSkgPT0gKF9qb2luID09IEpPSU5fSU5WRVJTRSkpCiAgICAg\nICAgICAgICAgICBpZHggPSBmay5nZXRDb2x1bW5zKCkubGVuZ3RoICsgY29u\nc3RJZHgrKzsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIHNldElPRnJvbUNvbHVtbkZsYWdzKChDb2x1\nbW4pIGNvbHMuZ2V0KGkpLCBpZHgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBvciByZXRyaWV2ZSB0aGUgZm9yZWlnbiBrZXkg\nam9pbnMuCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBp\nbmcgd2UncmUgcmV0cmlldmluZyBhIGtleSBmb3IKICAgICAqIEBwYXJhbSBw\ncmVmaXggbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAg\nICogQHBhcmFtIHRhYmxlIHRoZSB0YWJsZSBmb3IgdGhlIGtleQogICAgICog\nQHBhcmFtIGNscyB0eXBlIHdlJ3JlIGpvaW5pbmcgZnJvbSwgaWYgYXBwbGlj\nYWJsZQogICAgICogQHBhcmFtIHJlbCB0YXJnZXQgdHlwZSB3ZSdyZSBqb2lu\naW5nIHRvCiAgICAgKiBAcGFyYW0gZ2l2ZW4gdGhlIGNvbHVtbnMgZ2l2ZW4g\nYnkgdGhlIHVzZXIKICAgICAqIEBwYXJhbSBkZWYgZm9yZWlnbiBrZXkgZGVm\nYXVsdHMgcHJvdmlkZXIKICAgICAqIEBwYXJhbSBpbnZlcnNhYmxlIHdoZXRo\nZXIgdGhlIGZvcmVpZ24ga2V5IGNhbiBiZSBpbnZlcnNlZAogICAgICogQHBh\ncmFtIGFkYXB0IHdoZXRoZXIgd2UgY2FuIG1vZGlmeSB0aGUgZXhpc3Rpbmcg\nbWFwcGluZyBvciBzY2hlbWEKICAgICAqIEByZXR1cm4gYXJyYXkgb2YgdHVw\nbGVzIHdoZXJlIHRoZSBmaXJzdCBlbGVtZW50IGlzIHRoZQogICAgICogbG9j\nYWwgY29sdW1uIChvciBpbiB0aGUgY2FzZSBvZiBhIGNvbnN0YW50IGpvaW4g\ndGhlCiAgICAgKiBzb2xlIGNvbHVtbiksIHRoZSBzZWNvbmQgaXMgdGhlIHRh\ncmdldCBjb2x1bW4gKG9yCiAgICAgKiBjb25zdGFudCksIGFuZCB0aGUgdGhp\ncmQgaXMge0BsaW5rIEJvb2xlYW4jVFJVRX0gaWYKICAgICAqIHRoaXMgaXMg\nYW4gaW52ZXJzZSBqb2luCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0W11b\nXSBjcmVhdGVKb2lucyhNZXRhRGF0YUNvbnRleHQgY29udGV4dCwKICAgICAg\nICBTdHJpbmcgcHJlZml4LCBUYWJsZSB0YWJsZSwgQ2xhc3NNYXBwaW5nIGNs\ncywgQ2xhc3NNYXBwaW5nIHJlbCwKICAgICAgICBMaXN0IGdpdmVuLCBGb3Jl\naWduS2V5RGVmYXVsdHMgZGVmLCBib29sZWFuIGludmVyc2FibGUsIGJvb2xl\nYW4gYWRhcHQpIHsKICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9\nIChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7\nCiAgICAgICAgYm9vbGVhbiBmaWxsID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1\nbHRzKCkuZGVmYXVsdE1pc3NpbmdJbmZvKCk7CiAgICAgICAgT2JqZWN0W11b\nXSBqb2luczsKCiAgICAgICAgLy8gaWYgbm8gY29sdW1ucyBnaXZlbiwganVz\ndCBjcmVhdGUgbWlycm9ycyBvZiB0YXJnZXQgY29sdW1ucwogICAgICAgIGlm\nIChnaXZlbi5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgaWYgKCFhZGFwdCAm\nJiAhZmlsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldChwcmVmaXggKyAiLW5vLWZrLWNvbHMiLAogICAg\nICAgICAgICAgICAgICAgIGNvbnRleHQpKTsKCiAgICAgICAgICAgIENvbHVt\nbltdIHRhcmdldHMgPSByZWwuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAg\nICAgICAgICAgam9pbnMgPSBuZXcgT2JqZWN0W3RhcmdldHMubGVuZ3RoXVsz\nXTsKICAgICAgICAgICAgQ29sdW1uIHRtcGxhdGU7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgdGFyZ2V0cy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgdG1wbGF0ZSA9IG5ldyBDb2x1bW4oKTsKICAgICAgICAg\nICAgICAgIHRtcGxhdGUuc2V0TmFtZSh0YXJnZXRzW2ldLmdldE5hbWUoKSk7\nCiAgICAgICAgICAgICAgICB0bXBsYXRlLnNldEphdmFUeXBlKHRhcmdldHNb\naV0uZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAgICAgICAgICB0bXBsYXRlLnNl\ndFR5cGUodGFyZ2V0c1tpXS5nZXRUeXBlKCkpOwogICAgICAgICAgICAgICAg\ndG1wbGF0ZS5zZXRUeXBlTmFtZSh0YXJnZXRzW2ldLmdldFR5cGVOYW1lKCkp\nOwogICAgICAgICAgICAgICAgdG1wbGF0ZS5zZXRTaXplKHRhcmdldHNbaV0u\nZ2V0U2l6ZSgpKTsKICAgICAgICAgICAgICAgIHRtcGxhdGUuc2V0RGVjaW1h\nbERpZ2l0cyh0YXJnZXRzW2ldLmdldERlY2ltYWxEaWdpdHMoKSk7CgogICAg\nICAgICAgICAgICAgaWYgKGRlZiAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIGRlZi5wb3B1bGF0ZSh0YWJsZSwgcmVsLmdldFRhYmxlKCksIHRtcGxh\ndGUsIHRhcmdldHNbaV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNl\nLCBpLCB0YXJnZXRzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBqb2luc1tp\nXVswXSA9IG1lcmdlQ29sdW1uKGNvbnRleHQsIHByZWZpeCwgdG1wbGF0ZSwg\ndHJ1ZSwKICAgICAgICAgICAgICAgICAgICBudWxsLCB0YWJsZSwgYWRhcHQs\nIGZpbGwpOwogICAgICAgICAgICAgICAgam9pbnNbaV1bMV0gPSB0YXJnZXRz\nW2ldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBqb2luczsK\nICAgICAgICB9CgogICAgICAgIC8vIHVzZSBnaXZlbiBjb2x1bW5zIHRvIGNy\nZWF0ZSBqb2luLiAgd2UgZG9uJ3QgdHJ5IHRvIHVzZSBhbnkgb2YgdGhlCiAg\nICAgICAgLy8gdGVtcGxhdGUgY29sdW1ucywgZXZlbiBpZiB0aGUgdXNlciBk\nb2Vzbid0IGdpdmUgYSBjb2x1bW4gbGlua2luZyB0bwogICAgICAgIC8vIGV2\nZXJ5IHByaW1hcnkga2V5IG9mIHRoZSB0YXJnZXQgdHlwZSAtLSB1c2VycyBh\ncmUgYWxsb3dlZCB0byBjcmVhdGUKICAgICAgICAvLyBwYXJ0aWFsIGpvaW5z\nLiAgdGhpcyBtZWFucywgdGhvdWdoLCB0aGF0IGlmIGEgdXNlciB3YW50cyB0\nbyBzcGVjaWZ5CiAgICAgICAgLy8gaW5mbyBmb3Igb25lIGpvaW4gY29sdW1u\nLCBoZSBoYXMgdG8gYXQgbGVhc3QgY3JlYXRlIGVsZW1lbnRzIGZvcgogICAg\nICAgIC8vIGFsbCBvZiB0aGVtCgogICAgICAgIGpvaW5zID0gbmV3IE9iamVj\ndFtnaXZlbi5zaXplKCldWzNdOwogICAgICAgIENvbHVtbiBjb2w7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBjb2wgPSAoQ29sdW1uKSBnaXZlbi5nZXQoaSk7CiAgICAg\nICAgICAgIG1lcmdlSm9pbkNvbHVtbihjb250ZXh0LCBwcmVmaXgsIGNvbCwg\nam9pbnMsIGksIHRhYmxlLCBjbHMsIHJlbCwKICAgICAgICAgICAgICAgIGRl\nZiwgaW52ZXJzYWJsZSAmJiAhY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfUEtf\nSk9JTiksIGFkYXB0LAogICAgICAgICAgICAgICAgZmlsbCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBqb2luczsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBvciByZXRyaWV2ZSBhIGZvcmVpZ24ga2V5IGNvbHVtbiBmb3Ig\nYSBqb2luLgogICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBw\naW5nIHdlJ3JlIHJldHJpZXZpbmcgYSBrZXkgZm9yCiAgICAgKiBAcGFyYW0g\ncHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAg\nICAqIEBwYXJhbSBnaXZlbiB0aGUgZ2l2ZW4gbG9jYWwgZm9yZWlnbiBrZXkg\nY29sdW1uCiAgICAgKiBAcGFyYW0gam9pbnMgYXJyYXkgb2Ygam9pbnMKICAg\nICAqIEBwYXJhbSBpZHggaW5kZXggb2YgdGhlIGpvaW4gYXJyYXkgdG8gcG9w\ndWxhdGUKICAgICAqIEBwYXJhbSB0YWJsZSB0aGUgdGFibGUgZm9yIHRoZSBr\nZXkKICAgICAqIEBwYXJhbSBjbHMgdGhlIHR5cGUgd2UncmUgam9pbmluZyBm\ncm9tCiAgICAgKiBAcGFyYW0gcmVsIHRhcmdldCB0eXBlIHdlJ3JlIGpvaW5p\nbmcgdG8KICAgICAqIEBwYXJhbSBkZWYgZm9yZWlnbiBrZXkgZGVmYXVsdHMg\ncHJvdmlkZXI7CiAgICAgKiB1c2UgbnVsbCB0byBtaXJyb3IgdGFyZ2V0IGNv\nbHVtbiBuYW1lcwogICAgICogQHBhcmFtIGludmVyc2FibGUgd2hldGhlciB0\naGUgZm9yZWlnbiBrZXkgY2FuIGJlIGludmVyc2VkCiAgICAgKiBAcGFyYW0g\nYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBw\naW5nIG9yIHNjaGVtYQogICAgICogQHBhcmFtIGZpbGwgd2hldGhlciB0byBk\nZWZhdWx0IG1pc3NpbmcgY29sdW1uIGluZm9ybWF0aW9uCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBtZXJnZUpvaW5Db2x1bW4oTWV0YURhdGFDb250ZXh0\nIGNvbnRleHQsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgQ29sdW1uIGdpdmVu\nLCBPYmplY3RbXVtdIGpvaW5zLCBpbnQgaWR4LCBUYWJsZSB0YWJsZSwgQ2xh\nc3NNYXBwaW5nIGNscywKICAgICAgICBDbGFzc01hcHBpbmcgcmVsLCBGb3Jl\naWduS2V5RGVmYXVsdHMgZGVmLCBib29sZWFuIGludmVyc2FibGUsCiAgICAg\nICAgYm9vbGVhbiBhZGFwdCwgYm9vbGVhbiBmaWxsKSB7CiAgICAgICAgLy8g\nZGVmYXVsdCB0byB0aGUgcHJpbWFyeSBrZXkgY29sdW1uIG5hbWUgaWYgdGhp\ncyBpcyBhIHBrIGpvaW4KICAgICAgICBTdHJpbmcgbmFtZSA9IGdpdmVuLmdl\ndE5hbWUoKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsICYmIGdpdmVuICE9\nIG51bGwKICAgICAgICAgICAgJiYgZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxB\nR19QS19KT0lOKSAmJiBjbHMgIT0gbnVsbCkgewogICAgICAgICAgICBDb2x1\nbW5bXSBwa3MgPSBjbHMuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAg\nICAgICAgaWYgKHBrcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgIG5h\nbWUgPSBwa3NbMF0uZ2V0TmFtZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8g\naWYgd2UgY2FuJ3QgYWRhcHQsIHRoZW4gdGhlIHVzZXIgbXVzdCBhdCBsZWFz\ndCBnaXZlIGEgY29sdW1uIG5hbWUKICAgICAgICBpZiAobmFtZSA9PSBudWxs\nICYmICFhZGFwdCAmJiAhZmlsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCArICItbm8tZmtjb2wt\nbmFtZSIsCiAgICAgICAgICAgICAgICBjb250ZXh0KSk7CgogICAgICAgIC8v\nIGNoZWNrIHRvIHNlZSBpZiB0aGUgY29sdW1uIGlzbid0IGluIHRoZSBleHBl\nY3RlZCB0YWJsZTsgaXQgbWlnaHQKICAgICAgICAvLyBiZSBhbiBpbnZlcnNl\nIGpvaW4gb3IgYSBqb2luIHRvIGEgYmFzZSBjbGFzcyBvZiB0aGUgdGFyZ2V0\nIHR5cGUKICAgICAgICBUYWJsZSBsb2NhbCA9IHRhYmxlOwogICAgICAgIFRh\nYmxlIGZvcmVpZ24gPSByZWwuZ2V0VGFibGUoKTsKICAgICAgICBib29sZWFu\nIGZ1bGxOYW1lID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBpbnZlcnNlID0g\nZmFsc2U7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCkgewogICAgICAgICAg\nICBpbnQgZG90SWR4ID0gbmFtZS5sYXN0SW5kZXhPZignLicpOwogICAgICAg\nICAgICBpZiAoZG90SWR4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAvLyBh\nbGxvdyB1c2Ugb2YgJy4nIHdpdGhvdXQgcHJlZml4IHRvIG1lYW4gInVzZSBl\neHBlY3RlZAogICAgICAgICAgICAgICAgLy8gZm9yZWlnbiB0YWJsZSIKICAg\nICAgICAgICAgICAgIGlmIChkb3RJZHggPT0gMCkKICAgICAgICAgICAgICAg\nICAgICBsb2NhbCA9IGZvcmVpZ247CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgbG9jYWwgPSBmaW5kVGFibGUoY29udGV4dCwg\nbmFtZS5zdWJzdHJpbmcoMCwgZG90SWR4KSwKICAgICAgICAgICAgICAgICAg\nICAgICAgbG9jYWwsIGZvcmVpZ24sIG51bGwpOwogICAgICAgICAgICAgICAg\nZnVsbE5hbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUu\nc3Vic3RyaW5nKGRvdElkeCArIDEpOwoKICAgICAgICAgICAgICAgIC8vIGlm\nIGludmVyc2Ugam9pbiwgdGhlbiBzd2FwIGxvY2FsIGFuZCBmb3JlaWduIHRh\nYmxlcwogICAgICAgICAgICAgICAgaWYgKGxvY2FsICE9IHRhYmxlKSB7CiAg\nICAgICAgICAgICAgICAgICAgZm9yZWlnbiA9IHRhYmxlOwogICAgICAgICAg\nICAgICAgICAgIGludmVyc2UgPSB0cnVlOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJvb2xlYW4gZm9yY2VJ\nbnZlcnNlID0gIWZ1bGxOYW1lICYmIF9qb2luID09IEpPSU5fSU5WRVJTRTsK\nICAgICAgICBpZiAoZm9yY2VJbnZlcnNlKSB7CiAgICAgICAgICAgIGxvY2Fs\nID0gZm9yZWlnbjsKICAgICAgICAgICAgZm9yZWlnbiA9IHRhYmxlOwogICAg\nICAgICAgICBpbnZlcnNlID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8v\nIGRldGVybWluZSB0YXJnZXQKICAgICAgICBTdHJpbmcgdGFyZ2V0TmFtZSA9\nIGdpdmVuLmdldFRhcmdldCgpOwogICAgICAgIE9iamVjdCB0YXJnZXQgPSBu\ndWxsOwogICAgICAgIFRhYmxlIHR0YWJsZSA9IG51bGw7CiAgICAgICAgYm9v\nbGVhbiBjb25zdGFudCA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gZnVsbFRh\ncmdldCA9IGZhbHNlOwogICAgICAgIGlmICh0YXJnZXROYW1lID09IG51bGwg\nJiYgZ2l2ZW4uZ2V0VGFyZ2V0RmllbGQoKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIENsYXNzTWFwcGluZyB0Y2xzID0gKGludmVyc2UpID8gY2xzIDogcmVs\nOwogICAgICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gZ2l2ZW4uZ2V0VGFy\nZ2V0RmllbGQoKTsKICAgICAgICAgICAgaW50IGRvdElkeCA9IGZpZWxkTmFt\nZS5sYXN0SW5kZXhPZignLicpOwogICAgICAgICAgICBmdWxsVGFyZ2V0ID0g\nZG90SWR4ICE9IC0xOwoKICAgICAgICAgICAgaWYgKGRvdElkeCA9PSAwKSB7\nCiAgICAgICAgICAgICAgICAvLyBhbGxvdyB1c2Ugb2YgJy4nIHdpdGhvdXQg\ncHJlZml4IHRvIG1lYW4gInVzZSBleHBlY3RlZCBsb2NhbAogICAgICAgICAg\nICAgICAgLy8gY2xzIjsgYnV0IGlmIHdlIGFscmVhZHkgaW52ZXJzZWQgbm8g\nbmVlZCB0byBzd2l0Y2ggYWdhaW4KICAgICAgICAgICAgICAgIGlmICghaW52\nZXJzZSkKICAgICAgICAgICAgICAgICAgICB0Y2xzID0gY2xzOwogICAgICAg\nICAgICAgICAgZmllbGROYW1lID0gZmllbGROYW1lLnN1YnN0cmluZygxKTsK\nICAgICAgICAgICAgfSBlbHNlIGlmIChkb3RJZHggPiAwKSB7CiAgICAgICAg\nICAgICAgICAvLyBtdXN0IGJlIGNsYXNzICsgZmllbGQgbmFtZQogICAgICAg\nICAgICAgICAgdGNscyA9IGZpbmRDbGFzc01hcHBpbmcoY29udGV4dCwgZmll\nbGROYW1lLnN1YnN0cmluZwogICAgICAgICAgICAgICAgICAgICgwLCBkb3RJ\nZHgpLCBjbHMsIHJlbCk7CiAgICAgICAgICAgICAgICBmaWVsZE5hbWUgPSBm\naWVsZE5hbWUuc3Vic3RyaW5nKGRvdElkeCArIDEpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmICh0Y2xzID09IG51bGwpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4\nCiAgICAgICAgICAgICAgICAgICAgKyAiLWJhZC1ma3RhcmdldGNscyIsIGNv\nbnRleHQsIGZpZWxkTmFtZSwgbmFtZSkpOwoKICAgICAgICAgICAgRmllbGRN\nYXBwaW5nIGZpZWxkID0gdGNscy5nZXRGaWVsZE1hcHBpbmcoZmllbGROYW1l\nKTsKICAgICAgICAgICAgaWYgKGZpZWxkID09IG51bGwpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJl\nZml4CiAgICAgICAgICAgICAgICAgICAgKyAiLWJhZC1ma3RhcmdldGZpZWxk\nIiwgbmV3IE9iamVjdFtdeyBjb250ZXh0LCBmaWVsZE5hbWUsCiAgICAgICAg\nICAgICAgICAgICAgbmFtZSwgdGNscyB9KSk7CiAgICAgICAgICAgIGlmIChm\naWVsZC5nZXRDb2x1bW5zKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4\nCiAgICAgICAgICAgICAgICAgICAgKyAiLWZrdGFyZ2V0ZmllbGQtY29scyIs\nIGNvbnRleHQsIGZpZWxkTmFtZSwgbmFtZSkpOwogICAgICAgICAgICB0dGFi\nbGUgPSAoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSAhPSBudWxsKSA/IGZp\nZWxkLmdldFRhYmxlKCkKICAgICAgICAgICAgICAgIDogZmllbGQuZ2V0RGVm\naW5pbmdNYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgICAgICAgICAgdGFyZ2V0\nTmFtZSA9IGZpZWxkLmdldENvbHVtbnMoKVswXS5nZXROYW1lKCk7CiAgICAg\nICAgfSBlbHNlIGlmICh0YXJnZXROYW1lICE9IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKHRhcmdldE5hbWUuY2hhckF0KDApID09ICdcJycpIHsKICAgICAg\nICAgICAgICAgIGNvbnN0YW50ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRh\ncmdldCA9IHRhcmdldE5hbWUuc3Vic3RyaW5nKDEsIHRhcmdldE5hbWUubGVu\nZ3RoKCkgLSAxKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXROYW1l\nLmNoYXJBdCgwKSA9PSAnLScKICAgICAgICAgICAgICAgIHx8IHRhcmdldE5h\nbWUuY2hhckF0KDApID09ICcuJwogICAgICAgICAgICAgICAgfHwgQ2hhcmFj\ndGVyLmlzRGlnaXQodGFyZ2V0TmFtZS5jaGFyQXQoMCkpKSB7CiAgICAgICAg\nICAgICAgICBjb25zdGFudCA9IHRydWU7CiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXROYW1lLmluZGV4T2Yo\nJy4nKSA9PSAtMSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0g\nbmV3IEludGVnZXIodGFyZ2V0TmFtZSk7CiAgICAgICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSBuZXcgRG91\nYmxlKHRhcmdldE5hbWUpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiLWJhZC1ma2NvbnN0IiwgY29udGV4dCwg\ndGFyZ2V0TmFtZSwgbmFtZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9IGVsc2UgaWYgKCJudWxsIi5lcXVhbHNJZ25vcmVDYXNlKHRhcmdl\ndE5hbWUpKQogICAgICAgICAgICAgICAgY29uc3RhbnQgPSB0cnVlOwogICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGludCBkb3RJZHggPSB0\nYXJnZXROYW1lLmxhc3RJbmRleE9mKCcuJyk7CiAgICAgICAgICAgICAgICBm\ndWxsVGFyZ2V0ID0gZG90SWR4ICE9IC0xOwogICAgICAgICAgICAgICAgaWYg\nKGRvdElkeCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gYWxsb3cg\ndXNlIG9mICcuJyB3aXRob3V0IHByZWZpeCB0byBtZWFuICJ1c2UgZXhwZWN0\nZWQKICAgICAgICAgICAgICAgICAgICAvLyBsb2NhbCB0YWJsZSIsIGJ1dCBp\nZ25vcmUgaWYgd2UncmUgYWxyZWFkeSBpbnZlcnNlZAogICAgICAgICAgICAg\nICAgICAgIGlmICghaW52ZXJzZSkKICAgICAgICAgICAgICAgICAgICAgICAg\ndHRhYmxlID0gbG9jYWw7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFt\nZSA9IHRhcmdldE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChkb3RJZHggIT0gLTEpIHsKICAgICAgICAgICAgICAgICAg\nICB0dGFibGUgPSBmaW5kVGFibGUoY29udGV4dCwgdGFyZ2V0TmFtZS5zdWJz\ndHJpbmcoMCwKICAgICAgICAgICAgICAgICAgICAgICAgZG90SWR4KSwgZm9y\nZWlnbiwgbG9jYWwsIChpbnZlcnNlKSA/IGNscyA6IHJlbCk7CiAgICAgICAg\nICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IHRhcmdldE5hbWUuc3Vic3RyaW5n\nKGRvdElkeCArIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyB1c2UgZXhwbGljaXQgdGFyZ2V0IHRh\nYmxlIGlmIGF2YWlsYWJsZQogICAgICAgIGlmICh0dGFibGUgPT0gbG9jYWwg\nJiYgbG9jYWwgIT0gZm9yZWlnbikgewogICAgICAgICAgICAvLyBzd2FwLCB1\nbmxlc3MgdXNlciBnYXZlIGluY29tcGF0aWJsZSB0YWJsZSBpbiBjb2x1bW4g\nbmFtZQogICAgICAgICAgICBpZiAoZnVsbE5hbWUpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4\nCiAgICAgICAgICAgICAgICAgICAgKyAiLWJhZC1ma3RhcmdldC1pbnZlcnNl\nIiwgbmV3IE9iamVjdFtdeyBjb250ZXh0LCBuYW1lLAogICAgICAgICAgICAg\nICAgICAgIGZvcmVpZ24sIHR0YWJsZSB9KSk7CiAgICAgICAgICAgIGxvY2Fs\nID0gZm9yZWlnbjsKICAgICAgICAgICAgZm9yZWlnbiA9IHR0YWJsZTsKICAg\nICAgICB9IGVsc2UgaWYgKHR0YWJsZSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIC8vIHR0YWJsZSBtaWdodCBiZSBhIHRhYmxlIG9mIGEgYmFzZSBjbGFzcyBv\nZiB0aGUgdGFyZ2V0CiAgICAgICAgICAgIGZvcmVpZ24gPSB0dGFibGU7CiAg\nICAgICAgfQoKICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgd2UgaW52ZXJz\nZWQ7IGlmIHRoaXMgaXMgYSBzYW1lLXRhYmxlIGpvaW4sIHRoZW4KICAgICAg\nICAvLyBjb25zaWRlciBpdCBhbiBpbXBsaWNpdCBpbnZlcnNlIGlmIHRoZSB1\nc2VyIGluY2x1ZGVzIHRoZSB0YWJsZSBuYW1lCiAgICAgICAgLy8gaW4gdGhl\nIGNvbHVtbiBuYW1lLCBidXQgbm90IGluIHRoZSBjb2x1bW4gdGFyZ2V0LCBv\nciBpZiB0aGUgdXNlcgogICAgICAgIC8vIGdpdmVzIG5vIGNvbHVtbiBuYW1l\nIGJ1dCBhIGZ1bGwgdGFyZ2V0IG5hbWUKICAgICAgICBpbnZlcnNlID0gaW52\nZXJzZSB8fCBsb2NhbCAhPSB0YWJsZSB8fCAobG9jYWwgPT0gZm9yZWlnbgog\nICAgICAgICAgICAmJiAoKGZ1bGxOYW1lICYmICFmdWxsVGFyZ2V0KSB8fCAo\nbmFtZSA9PSBudWxsICYmIGZ1bGxUYXJnZXQpKSk7CiAgICAgICAgaWYgKCFp\nbnZlcnNhYmxlICYmICFjb25zdGFudCAmJiBpbnZlcnNlKSB7CiAgICAgICAg\nICAgIGlmIChsb2NhbCA9PSBmb3JlaWduKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAg\nICAgICAgICAgICAgICAgICsgIi1iYWQtZmstc2VsZi1pbnZlcnNlIiwgY29u\ndGV4dCwgbG9jYWwpKTsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCArICItYmFkLWZrLWludmVyc2Ui\nLAogICAgICAgICAgICAgICAgY29udGV4dCwgbG9jYWwsIHRhYmxlKSk7CiAg\nICAgICAgfQogICAgICAgIGlmIChuYW1lID09IG51bGwgJiYgY29uc3RhbnQp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICsgIi1uby1ma2NvbC1uYW1l\nLWFkYXB0IiwgY29udGV4dCkpOwoKICAgICAgICBpZiAobmFtZSA9PSBudWxs\nICYmIHRhcmdldE5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiBu\nbyBuYW1lIG9yIHRhcmdldCBpcyBwcm92aWRlZCBhbmQgdGhlcmUncyBtb3Jl\nIHRoYW4gb25lIGxpa2VseQogICAgICAgICAgICAvLyBqb2luIHBvc3NpYmls\naXR5LCB0b28gYW1iaWd1b3VzCiAgICAgICAgICAgIFByaW1hcnlLZXkgcGsg\nPSBmb3JlaWduLmdldFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgaWYgKGpv\naW5zLmxlbmd0aCAhPSAxIHx8IHBrID09IG51bGwgfHwgcGsuZ2V0Q29sdW1u\ncygpLmxlbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAg\nICAgICAgICsgIi1uby1ma2NvbC1uYW1lLWFkYXB0IiwgY29udGV4dCkpOwoK\nICAgICAgICAgICAgLy8gYXNzdW1lIHRhcmdldCBpcyBwayBjb2x1bW4KICAg\nICAgICAgICAgdGFyZ2V0TmFtZSA9IHBrLmdldENvbHVtbnMoKVswXS5nZXRO\nYW1lKCk7CiAgICAgICAgfSBlbHNlIGlmIChuYW1lICE9IG51bGwgJiYgdGFy\nZ2V0TmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG9uZSBwcmlt\nYXJ5IGtleSBjb2x1bW4gdXNlIGl0IGZvciB0YXJnZXQ7IGlmIG11bHRpcGxl\nIGpvaW5zCiAgICAgICAgICAgIC8vIGxvb2sgZm9yIGEgZm9yZWlnbiBjb2x1\nbW4gd2l0aCBzYW1lIG5hbWUgYXMgbG9jYWwgY29sdW1uCiAgICAgICAgICAg\nIFByaW1hcnlLZXkgcGsgPSBmb3JlaWduLmdldFByaW1hcnlLZXkoKTsKICAg\nICAgICAgICAgaWYgKGpvaW5zLmxlbmd0aCA9PSAxICYmIHBrICE9IG51bGwg\nJiYgcGsuZ2V0Q29sdW1ucygpLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAg\nICAgdGFyZ2V0TmFtZSA9IHBrLmdldENvbHVtbnMoKVswXS5nZXROYW1lKCk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKGZvcmVpZ24uZ2V0Q29sdW1uKG5hbWUp\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0YXJnZXROYW1lID0gbmFtZTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAg\nICAgICAgICsgIi1uby1ma2NvbC10YXJnZXQtYWRhcHQiLCBjb250ZXh0LCBu\nYW1lKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBmaW5kIHRoZSB0YXJnZXQg\nY29sdW1uLCBhbmQgY3JlYXRlIHRlbXBsYXRlIGZvciBsb2NhbCBjb2x1bW4g\nYmFzZWQKICAgICAgICAvLyBvbiBpdAogICAgICAgIENvbHVtbiB0bXBsYXRl\nID0gbmV3IENvbHVtbigpOwogICAgICAgIHRtcGxhdGUuc2V0TmFtZShuYW1l\nKTsKICAgICAgICBpZiAoIWNvbnN0YW50KSB7CiAgICAgICAgICAgIENvbHVt\nbiB0Y29sID0gZm9yZWlnbi5nZXRDb2x1bW4odGFyZ2V0TmFtZSk7CiAgICAg\nICAgICAgIGlmICh0Y29sID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1i\nYWQtZmt0YXJnZXQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgY29udGV4dCwgdGFyZ2V0TmFtZSwgbmFtZSwgZm9yZWlnbiB9KSk7Cgog\nICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICAgICAg\ndG1wbGF0ZS5zZXROYW1lKHRjb2wuZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\ndG1wbGF0ZS5zZXRKYXZhVHlwZSh0Y29sLmdldEphdmFUeXBlKCkpOwogICAg\nICAgICAgICB0bXBsYXRlLnNldFR5cGUodGNvbC5nZXRUeXBlKCkpOwogICAg\nICAgICAgICB0bXBsYXRlLnNldFR5cGVOYW1lKHRjb2wuZ2V0VHlwZU5hbWUo\nKSk7CiAgICAgICAgICAgIHRtcGxhdGUuc2V0U2l6ZSh0Y29sLmdldFNpemUo\nKSk7CiAgICAgICAgICAgIHRtcGxhdGUuc2V0RGVjaW1hbERpZ2l0cyh0Y29s\nLmdldERlY2ltYWxEaWdpdHMoKSk7CiAgICAgICAgICAgIHRhcmdldCA9IHRj\nb2w7CiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBTdHJp\nbmcpCiAgICAgICAgICAgIHRtcGxhdGUuc2V0SmF2YVR5cGUoSmF2YVR5cGVz\nLlNUUklORyk7CiAgICAgICAgZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2Yg\nSW50ZWdlcikKICAgICAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZh\nVHlwZXMuSU5UKTsKICAgICAgICBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2Vv\nZiBEb3VibGUpCiAgICAgICAgICAgIHRtcGxhdGUuc2V0SmF2YVR5cGUoSmF2\nYVR5cGVzLkRPVUJMRSk7CgogICAgICAgIC8vIHBvcHVsYXRlIHRlbXBsYXRl\nLCBidXQgbGV0IHVzZXItZ2l2ZW4gbmFtZSBvdmVycmlkZSBkZWZhdWx0IG5h\nbWUKICAgICAgICBpZiAoZGVmICE9IG51bGwpCiAgICAgICAgICAgIGRlZi5w\nb3B1bGF0ZShsb2NhbCwgZm9yZWlnbiwgdG1wbGF0ZSwgdGFyZ2V0LCBpbnZl\ncnNlLCBpZHgsCiAgICAgICAgICAgICAgICBqb2lucy5sZW5ndGgpOwogICAg\nICAgIGlmIChuYW1lICE9IG51bGwpCiAgICAgICAgICAgIHRtcGxhdGUuc2V0\nTmFtZShuYW1lKTsKCiAgICAgICAgLy8gY3JlYXRlIG9yIG1lcmdlIGxvY2Fs\nIGNvbHVtbgogICAgICAgIENvbHVtbiBjb2wgPSBtZXJnZUNvbHVtbihjb250\nZXh0LCBwcmVmaXgsIHRtcGxhdGUsIHRydWUsIGdpdmVuLCBsb2NhbCwKICAg\nICAgICAgICAgYWRhcHQsIGZpbGwpOwoKICAgICAgICBqb2luc1tpZHhdWzBd\nID0gY29sOwogICAgICAgIGpvaW5zW2lkeF1bMV0gPSB0YXJnZXQ7CiAgICAg\nICAgaWYgKGludmVyc2UpCiAgICAgICAgICAgIGpvaW5zW2lkeF1bMl0gPSBC\nb29sZWFuLlRSVUU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSB0\nYXJnZXQgY2xhc3MgbWFwcGluZyBnaXZlbiB0aGUgdXNlcidzIGNsYXNzIG5h\nbWUuCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgZm9yIGVycm9yIG1l\nc3NhZ2VzCiAgICAgKiBAcGFyYW0gY2xzTmFtZSBjbGFzcyBuYW1lIGdpdmVu\nIGJ5IHVzZXIKICAgICAqIEBwYXJhbSBjbHMgb3JpZ2luYWwgc291cmNlIG1h\ncHBpbmcKICAgICAqIEBwYXJhbSByZWwgb3JpZ2luYWwgdGFyZ2V0IG1hcHBp\nbmcKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3NNYXBwaW5nIGZp\nbmRDbGFzc01hcHBpbmcoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsCiAgICAg\nICAgU3RyaW5nIGNsc05hbWUsIENsYXNzTWFwcGluZyBjbHMsIENsYXNzTWFw\ncGluZyByZWwpIHsKICAgICAgICBpZiAoaXNDbGFzc01hcHBpbmdOYW1lKGNs\nc05hbWUsIGNscykpCiAgICAgICAgICAgIHJldHVybiBjbHM7CiAgICAgICAg\naWYgKGlzQ2xhc3NNYXBwaW5nTmFtZShjbHNOYW1lLCByZWwpKQogICAgICAg\nICAgICByZXR1cm4gcmVsOwogICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgidGFyZ2V0LXdyb25nLWNscyIsIG5ldyBPYmpl\nY3RbXQogICAgICAgICAgICB7IGNvbnRleHQsIGNsc05hbWUsIGNscywgcmVs\nIH0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRo\nZSBnaXZlbiBuYW1lIG1hdGNoZXMgdGhlIGdpdmVuIG1hcHBpbmcuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNDbGFzc01hcHBpbmdO\nYW1lKFN0cmluZyBuYW1lLCBDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAg\naWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgaWYgKG5hbWUuZXF1YWxzKGNscy5nZXREZXNjcmliZWRUeXBlKCku\nZ2V0TmFtZSgpKQogICAgICAgICAgICB8fCBuYW1lLmVxdWFscyhTdHJpbmdz\nLmdldENsYXNzTmFtZShjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpKSkpCiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBpc0NsYXNzTWFw\ncGluZ05hbWUobmFtZSwgY2xzLmdldFBDU3VwZXJjbGFzc01hcHBpbmcoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIGludGVybmFsIGNvbHVtbiBp\nbmZvcm1hdGlvbiB0byBtYXRjaCB0aGUgZ2l2ZW4gbWFwcGVkIGNvbHVtbnMu\nCiAgICAgKgogICAgICogQHBhcmFtIGZvcmNlSkRCQ1R5cGUgd2hldGhlciB0\nbyBmb3JjZSB0aGUgamRiYy10eXBlIG9mIHRoZSBjb2x1bW5zCiAgICAgKiB0\nbyBiZSBzZXQsIGV2ZW4gd2hlbiBpdCBtYXRjaGVzIHRoZSBkZWZhdWx0IGZv\nciB0aGUgY29sdW1ucycgamF2YSB0eXBlCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHN5bmNDb2x1bW5zKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBD\nb2x1bW5bXSBjb2xzLAogICAgICAgIGJvb2xlYW4gZm9yY2VKREJDVHlwZSkg\newogICAgICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgX2NvbHMgPSBudWxsOwogICAgICAgIGVsc2Ugewog\nICAgICAgICAgICBfY29scyA9IG5ldyBBcnJheUxpc3QoY29scy5sZW5ndGgp\nOwogICAgICAgICAgICBDb2x1bW4gY29sOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIGNvbCA9IHN5bmNDb2x1bW4oY29udGV4dCwgY29sc1tpXSwgY29scy5s\nZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgZm9yY2VKREJDVHlwZSwgY29s\nc1tpXS5nZXRUYWJsZSgpLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICBzZXRDb2x1bW5GbGFnc0Zyb21JTyhjb2wsIGkpOwogICAgICAg\nICAgICAgICAgX2NvbHMuYWRkKGNvbCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgSS9PIGZsYWdzIG9uIHRo\nZSBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRDb2x1bW5G\nbGFnc0Zyb21JTyhDb2x1bW4gY29sLCBpbnQgaSkgewogICAgICAgIGlmIChf\naW8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbC5z\nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhX2lvLmlzVXBkYXRh\nYmxlKGksIGZhbHNlKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZM\nQUdfVU5JTlNFUlRBQkxFLCAhX2lvLmlzSW5zZXJ0YWJsZShpLCBmYWxzZSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyBpbnRlcm5hbCBpbmRleCBp\nbmZvcm1hdGlvbiB0byBtYXRjaCBnaXZlbiBtYXBwZWQgaW5kZXguCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHN5bmNJbmRleChNZXRhRGF0YUNvbnRl\neHQgY29udGV4dCwgSW5kZXggaWR4KSB7CiAgICAgICAgaWYgKGlkeCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIF9pZHggPSBudWxsOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfY2FuSWR4ID0gdHJ1ZTsKICAg\nICAgICBfaWR4ID0gbmV3IEluZGV4KCk7CiAgICAgICAgX2lkeC5zZXROYW1l\nKGlkeC5nZXROYW1lKCkpOwogICAgICAgIF9pZHguc2V0VW5pcXVlKGlkeC5p\nc1VuaXF1ZSgpKTsKICAgICAgICBpZiAoaWR4LmdldENvbHVtbnMoKSAhPSBu\ndWxsICYmIGlkeC5nZXRDb2x1bW5zKCkubGVuZ3RoID4gMSkKICAgICAgICAg\nICAgX2lkeC5zZXRDb2x1bW5zKGlkeC5nZXRDb2x1bW5zKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0cyBpbnRlcm5hbCBjb25zdHJhaW50IGluZm9y\nbWF0aW9uIHRvIG1hdGNoIGdpdmVuIG1hcHBlZCBjb25zdHJhaW50LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzeW5jVW5pcXVlKE1ldGFEYXRhQ29u\ndGV4dCBjb250ZXh0LCBVbmlxdWUgdW5xKSB7CiAgICAgICAgaWYgKHVucSA9\nPSBudWxsKSB7CiAgICAgICAgICAgIF91bnEgPSBudWxsOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfY2FuVW5xID0gdHJ1ZTsK\nICAgICAgICBfdW5xID0gbmV3IFVuaXF1ZSgpOwogICAgICAgIF91bnEuc2V0\nTmFtZSh1bnEuZ2V0TmFtZSgpKTsKICAgICAgICBfdW5xLnNldERlZmVycmVk\nKHVucS5pc0RlZmVycmVkKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\ncyBpbnRlcm5hbCBjb25zdHJhaW50IGFuZCBjb2x1bW4gaW5mb3JtYXRpb24g\ndG8gbWF0Y2ggZ2l2ZW4gbWFwcGVkCiAgICAgKiBjb25zdHJhaW50LgogICAg\nICoKICAgICAqIEBwYXJhbSBsb2NhbCBkZWZhdWx0IGxvY2FsIHRhYmxlCiAg\nICAgKiBAcGFyYW0gdGFyZ2V0IGRlZmF1bHQgdGFyZ2V0IHRhYmxlCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHN5bmNGb3JlaWduS2V5KE1ldGFEYXRh\nQ29udGV4dCBjb250ZXh0LCBGb3JlaWduS2V5IGZrLAogICAgICAgIFRhYmxl\nIGxvY2FsLCBUYWJsZSB0YXJnZXQpIHsKICAgICAgICBpZiAoZmsgPT0gbnVs\nbCkgewogICAgICAgICAgICBfZmsgPSBudWxsOwogICAgICAgICAgICBfY29s\ncyA9IG51bGw7CiAgICAgICAgICAgIF9qb2luID0gSk9JTl9OT05FOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChfam9pbiA9\nPSBKT0lOX05PTkUpCiAgICAgICAgICAgIF9qb2luID0gSk9JTl9GT1JXQVJE\nOwoKICAgICAgICBpZiAoZmsuaXNMb2dpY2FsKCkpCiAgICAgICAgICAgIF9m\nayA9IG51bGw7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9jYW5GSyA9\nIHRydWU7CiAgICAgICAgICAgIF9mayA9IG5ldyBGb3JlaWduS2V5KCk7CiAg\nICAgICAgICAgIF9may5zZXROYW1lKGZrLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgIF9may5zZXREZWxldGVBY3Rpb24oZmsuZ2V0RGVsZXRlQWN0aW9uKCkp\nOwogICAgICAgICAgICBfZmsuc2V0VXBkYXRlQWN0aW9uKGZrLmdldFVwZGF0\nZUFjdGlvbigpKTsKICAgICAgICAgICAgX2ZrLnNldERlZmVycmVkKGZrLmlz\nRGVmZXJyZWQoKSk7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHBrQ29scyA9\nIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10g\nY2NvbHMgPSBmay5nZXRDb25zdGFudENvbHVtbnMoKTsKICAgICAgICBPYmpl\nY3RbXSBjcyA9IGZrLmdldENvbnN0YW50cygpOwogICAgICAgIENvbHVtbltd\nIGNwa0NvbHMgPSBmay5nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCk7\nCiAgICAgICAgT2JqZWN0W10gY3BrcyA9IGZrLmdldFByaW1hcnlLZXlDb25z\ndGFudHMoKTsKCiAgICAgICAgaW50IHNpemUgPSBjb2xzLmxlbmd0aCArIGNj\nb2xzLmxlbmd0aCArIGNwa0NvbHMubGVuZ3RoOwogICAgICAgIF9jb2xzID0g\nbmV3IEFycmF5TGlzdChzaXplKTsKICAgICAgICBDb2x1bW4gY29sOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBjb2wgPSBzeW5jQ29sdW1uKGNvbnRleHQsIGNvbHNbaV0s\nIHNpemUsIGZhbHNlLCBsb2NhbCwKICAgICAgICAgICAgICAgIHRhcmdldCwg\ncGtDb2xzW2ldLCBfam9pbiA9PSBKT0lOX0lOVkVSU0UpOwogICAgICAgICAg\nICBzZXRDb2x1bW5GbGFnc0Zyb21JTyhjb2wsIGkpOwogICAgICAgICAgICBf\nY29scy5hZGQoY29sKTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0IGNvbnN0\nYW50OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2NvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgY29uc3RhbnQgPSAoY3NbaV0gPT0gbnVs\nbCkgPyBOVUxMIDogY3NbaV07CiAgICAgICAgICAgIGNvbCA9IHN5bmNDb2x1\nbW4oY29udGV4dCwgY2NvbHNbaV0sIHNpemUsIGZhbHNlLCBsb2NhbCwKICAg\nICAgICAgICAgICAgIHRhcmdldCwgY29uc3RhbnQsIF9qb2luID09IEpPSU5f\nSU5WRVJTRSk7CiAgICAgICAgICAgIHNldENvbHVtbkZsYWdzRnJvbUlPKGNv\nbCwgY29scy5sZW5ndGggKyBpKTsKICAgICAgICAgICAgX2NvbHMuYWRkKGNv\nbCk7CiAgICAgICAgfQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY3Br\nQ29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdGFudCA9IChj\ncGtzW2ldID09IG51bGwpID8gTlVMTCA6IGNwa3NbaV07CiAgICAgICAgICAg\nIF9jb2xzLmFkZChzeW5jQ29sdW1uKGNvbnRleHQsIGNwa0NvbHNbaV0sIHNp\nemUsIGZhbHNlLCB0YXJnZXQsCiAgICAgICAgICAgICAgICBsb2NhbCwgY29u\nc3RhbnQsIF9qb2luICE9IEpPSU5fSU5WRVJTRSkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGdpdmVu\nIGNvbHVtbiB3aXRoIHRoZSByYXcgbWFwcGluZyBpbmZvcm1hdGlvbgogICAg\nICogc2V0IGNvcnJlY3RseSwgYW5kIHdpdGhvdXQgc2V0dGluZ3MgdGhhdCBt\nYXRjaCBkZWZhdWx0cy4KICAgICAqCiAgICAgKiBAcGFyYW0gbnVtIHRoZSBu\ndW1iZXIgb2YgY29sdW1ucyBmb3IgdGhpcyBtYXBwaW5nCiAgICAgKiBAcGFy\nYW0gZm9yY2VKREJDVHlwZSB3aGV0aGVyIHRoZSBqZGJjLXR5cGUgb2YgdGhl\nIGNyZWF0ZWQgY29sdW1uCiAgICAgKiBzaG91bGQgYmUgc2V0LCBldmVuIGlm\nIGl0IG1hdGNoZXMgdGhlIGRlZmF1bHQKICAgICAqIGZvciB0aGUgZ2l2ZW4g\nY29sdW1uJ3MgamF2YSB0eXBlCiAgICAgKiBAcGFyYW0gY29sVGFibGUgZXhw\nZWN0ZWQgdGFibGUgZm9yIHRoZSBjb2x1bW4KICAgICAqIEBwYXJhbSB0YXJn\nZXRUYWJsZSBleHBlY3RlZCB0YXJnZXQgdGFibGUgZm9yIGpvaW4gY29sdW1u\nCiAgICAgKiBAcGFyYW0gdGFyZ2V0IHRhcmdldCBjb2x1bW4gb3Igb2JqZWN0\nIGZvciBqb2luIGNvbHVtbjsgZm9yIGEKICAgICAqIGNvbnN0YW50IG51bGwg\ndGFyZ2V0LCB1c2Uge0BsaW5rICNOVUxMfQogICAgICogQHBhcmFtIGludmVy\nc2Ugd2hldGhlciBqb2luIGNvbHVtbiBpcyBmb3IgaW52ZXJzZSBqb2luCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgQ29sdW1uIHN5bmNDb2x1bW4o\nTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIENvbHVtbiBjb2wsCiAgICAgICAg\naW50IG51bSwgYm9vbGVhbiBmb3JjZUpEQkNUeXBlLCBUYWJsZSBjb2xUYWJs\nZSwgVGFibGUgdGFyZ2V0VGFibGUsCiAgICAgICAgT2JqZWN0IHRhcmdldCwg\nYm9vbGVhbiBpbnZlcnNlKSB7CiAgICAgICAgLy8gdXNlIGZ1bGwgbmFtZSBm\nb3IgY29scyB0aGF0IGFyZW4ndCBpbiB0aGUgZXhwZWN0ZWQgdGFibGUsIG9y\nIHRoYXQKICAgICAgICAvLyBhcmUgaW52ZXJzZSBqb2lucwogICAgICAgIERC\nRGljdGlvbmFyeSBkaWN0ID0gKChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4\ndC5nZXRSZXBvc2l0b3J5KCkpLgogICAgICAgICAgICBnZXREQkRpY3Rpb25h\ncnkoKTsKICAgICAgICBDb2x1bW4gY29weSA9IG5ldyBDb2x1bW4oKTsKICAg\nICAgICBpZiAoY29sLmdldFRhYmxlKCkgIT0gY29sVGFibGUgfHwgaW52ZXJz\nZSkKICAgICAgICAgICAgY29weS5zZXROYW1lKGRpY3QuZ2V0RnVsbE5hbWUo\nY29sLmdldFRhYmxlKCksIHRydWUpCiAgICAgICAgICAgICAgICArICIuIiAr\nIGNvbC5nZXROYW1lKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29w\neS5zZXROYW1lKGNvbC5nZXROYW1lKCkpOwoKICAgICAgICAvLyBzZXQgdGFy\nZ2V0IGlmIG5vdCBkZWZhdWx0CiAgICAgICAgaWYgKHRhcmdldCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmICh0YXJnZXQgPT0gTlVMTCkKICAgICAgICAg\nICAgICAgIGNvcHkuc2V0VGFyZ2V0KCJudWxsIik7CiAgICAgICAgICAgIGVs\nc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIENvbHVtbikgewogICAgICAgICAg\nICAgICAgQ29sdW1uIHRjb2wgPSAoQ29sdW1uKSB0YXJnZXQ7CiAgICAgICAg\nICAgICAgICBpZiAoKCFpbnZlcnNlICYmIHRjb2wuZ2V0VGFibGUoKSAhPSB0\nYXJnZXRUYWJsZSkKICAgICAgICAgICAgICAgICAgICB8fCAoaW52ZXJzZSAm\nJiB0Y29sLmdldFRhYmxlKCkgIT0gY29sVGFibGUpKQogICAgICAgICAgICAg\nICAgICAgIGNvcHkuc2V0VGFyZ2V0KGRpY3QuZ2V0RnVsbE5hbWUodGNvbC5n\nZXRUYWJsZSgpLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICArICIu\nIiArIHRjb2wuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKCFkZWZhdWx0VGFyZ2V0KGNvbCwgdGNvbCwgbnVtKSkKICAgICAgICAgICAg\nICAgICAgICBjb3B5LnNldFRhcmdldCh0Y29sLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgTnVtYmVyKQog\nICAgICAgICAgICAgICAgY29weS5zZXRUYXJnZXQodGFyZ2V0LnRvU3RyaW5n\nKCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb3B5LnNl\ndFRhcmdldCgiJyIgKyB0YXJnZXQgKyAiJyIpOwogICAgICAgIH0gZWxzZSBp\nZiAobnVtID4gMSkKICAgICAgICAgICAgY29weS5zZXRUYXJnZXRGaWVsZChj\nb2wuZ2V0VGFyZ2V0RmllbGQoKSk7CgogICAgICAgIGlmIChjb2wuZ2V0U2l6\nZSgpICE9IDAgJiYgY29sLmdldFNpemUoKSAhPSBkaWN0LmNoYXJhY3RlckNv\nbHVtblNpemUKICAgICAgICAgICAgJiYgKGNvbC5nZXRTaXplKCkgIT0gLTEg\nfHwgIWNvbC5pc0xvYigpKSkKICAgICAgICAgICAgY29weS5zZXRTaXplKGNv\nbC5nZXRTaXplKCkpOwogICAgICAgIGlmIChjb2wuZ2V0RGVjaW1hbERpZ2l0\ncygpICE9IDApCiAgICAgICAgICAgIGNvcHkuc2V0RGVjaW1hbERpZ2l0cyhj\nb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAgICAgICBpZiAoY29sLmdldERl\nZmF1bHRTdHJpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBjb3B5LnNldERl\nZmF1bHRTdHJpbmcoY29sLmdldERlZmF1bHRTdHJpbmcoKSk7CiAgICAgICAg\naWYgKGNvbC5pc05vdE51bGwoKSAmJiAhY29sLmlzUHJpbWFyeUtleSgpCiAg\nICAgICAgICAgICYmICghaXNQcmltaXRpdmUoY29sLmdldEphdmFUeXBlKCkp\nIHx8IGlzRm9yZWlnbktleShjb2wpKSkKICAgICAgICAgICAgY29weS5zZXRO\nb3ROdWxsKHRydWUpOwoKICAgICAgICAvLyBzZXQgdHlwZSBuYW1lIGlmIG5v\ndCBkZWZhdWx0CiAgICAgICAgU3RyaW5nIHR5cGVOYW1lID0gY29sLmdldFR5\ncGVOYW1lKCk7CiAgICAgICAgaWYgKHR5cGVOYW1lICE9IG51bGwgfHwgY29w\neS5nZXRTaXplKCkgIT0gMAogICAgICAgICAgICB8fCBjb3B5LmdldERlY2lt\nYWxEaWdpdHMoKSAhPSAwKSB7CiAgICAgICAgICAgIC8vIGlzIHRoaXMgdGhl\nIGRpY3QgZGVmYXVsdCB0eXBlPyBoYXZlIHRvIGVuc3VyZSBqZGJjLXR5cGUg\nc2V0CiAgICAgICAgICAgIC8vIHByaW9yIHRvIGZpbmRpbmcgZGljdCBkZWZh\ndWx0CiAgICAgICAgICAgIGNvcHkuc2V0VHlwZShjb2wuZ2V0VHlwZSgpKTsK\nICAgICAgICAgICAgU3RyaW5nIGRlZk5hbWUgPSBkaWN0LmdldFR5cGVOYW1l\nKGNvcHkpOwogICAgICAgICAgICBjb3B5LnNldFR5cGUoVHlwZXMuT1RIRVIp\nOwoKICAgICAgICAgICAgLy8gY29weSBzaG91bGQgbm90IGhhdmUgc2l6ZSBp\nbmZvIHNldCBpZiBpdCBpc24ndCB1c2VkIGluIHR5cGUgbmFtZQogICAgICAg\nICAgICBib29sZWFuIGRlZlNpemVkID0gZGVmTmFtZS5pbmRleE9mKCcoJykg\nIT0gLTE7CiAgICAgICAgICAgIGlmICghZGVmU2l6ZWQpIHsKICAgICAgICAg\nICAgICAgIGlmIChjb3B5LmdldFNpemUoKSA+IDApCiAgICAgICAgICAgICAg\nICAgICAgY29weS5zZXRTaXplKDApOwogICAgICAgICAgICAgICAgY29weS5z\nZXREZWNpbWFsRGlnaXRzKDApOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAodHlwZU5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIHRvIHN0cmlwIHNpemUgZm9yIGNvbXBhcmlzb24KICAgICAg\nICAgICAgICAgIGlmICh0eXBlTmFtZS5pbmRleE9mKCcoJykgPT0gLTEgJiYg\nZGVmU2l6ZWQpCiAgICAgICAgICAgICAgICAgICAgZGVmTmFtZSA9IGRlZk5h\nbWUuc3Vic3RyaW5nKDAsIGRlZk5hbWUuaW5kZXhPZignKCcpKTsKICAgICAg\nICAgICAgICAgIGlmICghdHlwZU5hbWUuZXF1YWxzSWdub3JlQ2FzZShkZWZO\nYW1lKSkKICAgICAgICAgICAgICAgICAgICBjb3B5LnNldFR5cGVOYW1lKHR5\ncGVOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nc2V0IGpkYmMtdHlwZSBpZiBub3QgZGVmYXVsdCBvciBpZiBmb3JjZWQKICAg\nICAgICBpZiAoZm9yY2VKREJDVHlwZQogICAgICAgICAgICB8fCAodGFyZ2V0\nICE9IG51bGwgJiYgISh0YXJnZXQgaW5zdGFuY2VvZiBDb2x1bW4pCiAgICAg\nICAgICAgICYmIGNvbC5nZXRUeXBlKCkgIT0gVHlwZXMuVkFSQ0hBUikKICAg\nICAgICAgICAgfHwgZGljdC5nZXRKREJDVHlwZShjb2wuZ2V0SmF2YVR5cGUo\nKSwgZmFsc2UpICE9IGNvbC5nZXRUeXBlKCkpCiAgICAgICAgICAgIGNvcHku\nc2V0VHlwZShjb2wuZ2V0VHlwZSgpKTsKCiAgICAgICAgcmV0dXJuIGNvcHk7\nCiAgICB9CgogICAgLyoqIAogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdp\ndmVuIGNvbHVtbiBiZWxvbmdzIHRvIGEgZm9yZWlnbiBrZXkuCiAgICAgKi8g\nCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzRm9yZWlnbktleShDb2x1\nbW4gY29sKSAKICAgIHsgICAgICAgCiAgICAgICAgaWYgKGNvbC5nZXRUYWJs\nZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBGb3JlaWduS2V5W10gZmtzID0gY29sLmdldFRhYmxlKCkuZ2V0Rm9yZWln\nbktleXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZrcy5sZW5n\ndGg7IGkrKykgCiAgICAgICAgICAgIGlmIChma3NbaV0uY29udGFpbnNDb2x1\nbW4oY29sKSAKICAgICAgICAgICAgICAgIHx8IGZrc1tpXS5jb250YWluc0Nv\nbnN0YW50Q29sdW1uKGNvbCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdHlwZSBjb2RlIHJlcHJlc2Vu\ndHMgYSBwcmltaXRpdmUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJv\nb2xlYW4gaXNQcmltaXRpdmUoaW50IHR5cGUpIHsKICAgICAgICBzd2l0Y2gg\nKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlm\nIHRoZSBnaXZlbiB0YXJnZXQgY29sdW1uIG1hdGNoZXMgdGhlIGRlZmF1bHQu\nCiAgICAgKiBJZiB0aGVyZSBpcyBvbmx5IG9uZSBjb2x1bW4gaW52b2x2ZWQg\naW4gdGhlIGpvaW4gYW5kIGl0IGxpbmtzIHRvIHRoZQogICAgICogc2luZ2xl\nIHRhcmdldCB0YWJsZSBwayBjb2x1bW4sIG9yIGlmIHRoZSBjb2x1bW4gbmFt\nZSBpcyB0aGUgc2FtZSBhcwogICAgICogdGhlIHRhcmdldCBjb2x1bW4gbmFt\nZSwgdGhlbiB0aGUgdGFyZ2V0IGlzIHRoZSBkZWZhdWx0LgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGRlZmF1bHRUYXJnZXQoQ29sdW1u\nIGNvbCwgQ29sdW1uIHRhcmdldENvbCwKICAgICAgICBpbnQgbnVtKSB7CiAg\nICAgICAgaWYgKGNvbC5nZXROYW1lKCkuZXF1YWxzKHRhcmdldENvbC5nZXRO\nYW1lKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nbnVtID4gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBQ\ncmltYXJ5S2V5IHBrID0gdGFyZ2V0Q29sLmdldFRhYmxlKCkuZ2V0UHJpbWFy\neUtleSgpOwogICAgICAgIGlmIChwayA9PSBudWxsIHx8IHBrLmdldENvbHVt\nbnMoKS5sZW5ndGggIT0gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIHJldHVybiB0YXJnZXRDb2wgPT0gcGsuZ2V0Q29sdW1ucygpWzBd\nOwogICAgfQoKICAgIC8qKgogICAgICogU3VwcGxpZXMgZGVmYXVsdCB0YWJs\nZSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBpbnRl\ncmZhY2UgVGFibGVEZWZhdWx0cyB7CgogICAgICAgIC8qKgogICAgICAgICAq\nIFJldHVybiB0aGUgZGVmYXVsdCB0YWJsZSBuYW1lLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0KFNjaGVtYSBzY2hlbWEpOwogICAg\nfQoKICAgIC8qKgogICAgICogU3VwcGxpZXMgZGVmYXVsdCBmb3JlaWduIGtl\neSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBpbnRl\ncmZhY2UgRm9yZWlnbktleURlZmF1bHRzIHsKCiAgICAgICAgLyoqCiAgICAg\nICAgICogUmV0dXJuIGEgZGVmYXVsdCBmb3JlaWduIGtleSBmb3IgdGhlIGdp\ndmVuIHRhYmxlcywgb3IgbnVsbCB0bwogICAgICAgICAqIGNyZWF0ZSBhIGxv\nZ2ljYWwgZm9yZWlnbiBrZXkgb25seS4gRG8gbm90IGZpbGwgaW4gdGhlIGNv\nbHVtbnMgb2YKICAgICAgICAgKiB0aGUgZm9yZWlnbiBrZXksIG9ubHkgYXR0\ncmlidXRlcyBsaWtlIGl0cyBuYW1lLCBkZWxldGUgYWN0aW9uLCBldGMuCiAg\nICAgICAgICogRG8gbm90IGFkZCB0aGUgZm9yZWlnbiBrZXkgdG8gdGhlIHRh\nYmxlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBGb3JlaWduS2V5IGdl\ndChUYWJsZSBsb2NhbCwgVGFibGUgZm9yZWlnbiwgYm9vbGVhbiBpbnZlcnNl\nKTsKCiAgICAgICAgLyoqCiAgICAgICAgICogUG9wdWxhdGUgdGhlIGdpdmVu\nIGZvcmVpZ24ga2V5IGNvbHVtbiB3aXRoIGRlZmF1bHRzLgogICAgICAgICAq\nCiAgICAgICAgICogQHBhcmFtIHRhcmdldCB0aGUgdGFyZ2V0IGNvbHVtbiBv\nciBjb25zdGFudCB2YWx1ZQogICAgICAgICAqIEBwYXJhbSBwb3MgdGhlIGlu\nZGV4IG9mIHRoaXMgY29sdW1uIGluIHRoZSBmb3JlaWduIGtleQogICAgICAg\nICAqIEBwYXJhbSBjb2xzIHRoZSBudW1iZXIgb2YgY29sdW1ucyBpbiB0aGUg\nZm9yZWlnbiBrZXkKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBw\nb3B1bGF0ZShUYWJsZSBsb2NhbCwgVGFibGUgZm9yZWlnbiwgQ29sdW1uIGNv\nbCwKICAgICAgICAgICAgT2JqZWN0IHRhcmdldCwgYm9vbGVhbiBpbnZlcnNl\nLCBpbnQgcG9zLCBpbnQgY29scyk7Cgl9Cn0K\n","encoding":"base64"}

