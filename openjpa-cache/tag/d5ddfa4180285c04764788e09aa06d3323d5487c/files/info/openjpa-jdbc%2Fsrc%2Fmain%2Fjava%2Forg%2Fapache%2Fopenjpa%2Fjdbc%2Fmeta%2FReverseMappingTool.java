{"sha":"c418bcebfbe8c5a71f05f220bee62691b321a593","node_id":"MDQ6QmxvYjIwNjM2NDpjNDE4YmNlYmZiZThjNWE3MWYwNWYyMjBiZWU2MjY5MWIzMjFhNTkz","size":80384,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c418bcebfbe8c5a71f05f220bee62691b321a593","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uQnVmZmVyZWRSZWFkZXI7CmltcG9ydCBqYXZhLmlvLkZpbGU7\nCmltcG9ydCBqYXZhLmlvLkZpbGVJbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEu\naW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5JT0V4\nY2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW07CmltcG9ydCBq\nYXZhLmlvLklucHV0U3RyZWFtUmVhZGVyOwppbXBvcnQgamF2YS5pby5TdHJp\nbmdXcml0ZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xs\nZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNl\ncHRpb247CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBq\nYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwppbXBvcnQgamF2YS51dGls\nLlNldDsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5BcHBsaWNhdGlvbklkVG9v\nbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkNvZGVHZW5l\ncmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpE\nQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5GdWxsQ2xhc3NTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRz\nLkhhbmRsZXJGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuTWF4RW1iZWRkZWRCbG9iRmllbGRTdHJh\ndGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3Ry\nYXRzLk1heEVtYmVkZGVkQ2xvYkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lRGlzY3JpbWlu\nYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuUHJpbWl0aXZlRmllbGRTdHJhdGVneTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlJlbGF0aW9uQ29s\nbGVjdGlvbkludmVyc2VLZXlGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuUmVsYXRpb25Db2xsZWN0\naW9uVGFibGVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuUmVsYXRpb25GaWVsZFN0cmF0ZWd5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3Rh\ndGVDb21wYXJpc29uVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3RyaW5nRmllbGRTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRz\nLlN1YmNsYXNzSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1cGVyY2xhc3NE\naXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5TdXBlcmNsYXNzVmVyc2lvblN0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdlbmVyYXRvcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFH\ncm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5T\nY2hlbWFQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuU2NoZW1hczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuWE1MU2NoZW1hUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuQ29kZUZvcm1hdDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5GaWxlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuT3B0aW9uczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFGYWN0b3J5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFNb2RlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk5vbmVNZXRhRGF0YUZhY3Rvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFs\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0\nYURhdGFFeGNlcHRpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3M7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3NMb2FkZXI7CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5n\nczsKCi8qKgogKiBSZXZlcnNlLW1hcHMgYSBzY2hlbWEgaW50byBjbGFzcyBt\nYXBwaW5ncyBhbmQgdGhlIGFzc2ljaWF0ZWQgamF2YQogKiBjb2RlLiBHZW5l\ncmF0ZXMgYSBKYXZhIGNvZGUgZmlsZXMgZm9yIHBlcnNpc3RlbnQgY2xhc3Nl\ncyBhbmQgYXNzb2NpYXRlZAogKiBpZGVudGl0eSBjbGFzc2VzIGFuZCBtZXRh\nZGF0YS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBjbGFz\ncyBSZXZlcnNlTWFwcGluZ1Rvb2wKICAgIGltcGxlbWVudHMgTWV0YURhdGFN\nb2RlcywgQ2xvbmVhYmxlIHsKCiAgICAvKioKICAgICAqIFVubWFwcGVkIHRh\nYmxlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBUQUJM\nRV9OT05FID0gMDsKCiAgICAvKioKICAgICAqIFByaW1hcnkgdGFibGUgZm9y\nIGEgbmV3IGJhc2UgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IFRBQkxFX0JBU0UgPSAxOwoKICAgIC8qKgogICAgICogU2Vj\nb25kYXJ5IHRhYmxlIG9mIGFuIGV4aXN0aW5nIGNsYXNzLiBUaGVyZSBpcyBl\neGFjdGx5IG9uZSByb3cgaW4KICAgICAqIHRoaXMgdGFibGUgZm9yIGVhY2gg\ncm93IGluIHRoZSBwcmltYXJ5IHRhYmxlLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBUQUJMRV9TRUNPTkRBUlkgPSAyOwoKICAgIC8q\nKgogICAgICogU2Vjb25kYXJ5IHRhYmxlIG9mIGFuIGV4aXN0aW5nIGNsYXNz\nLiBUaGVyZSBpcyB6ZXJvIG9yIG9uZSByb3cgaW4KICAgICAqIHRoaXMgdGFi\nbGUgZm9yIGVhY2ggcm93IGluIHRoZSBwcmltYXJ5IHRhYmxlLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBUQUJMRV9TRUNPTkRBUllf\nT1VURVIgPSAzOwoKICAgIC8qKgogICAgICogQXNzb2NpYXRpb24gdGFibGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRBQkxFX0FT\nU09DSUFUSU9OID0gNDsKCiAgICAvKioKICAgICAqIFN1YmNsYXNzIHRhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBUQUJMRV9T\nVUJDTEFTUyA9IDU7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nTEVWRUxfTk9ORSA9ICJub25lIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIExFVkVMX1BBQ0tBR0UgPSAicGFja2FnZSI7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIFN0cmluZyBMRVZFTF9DTEFTUyA9ICJjbGFzcyI7Cgog\nICAgLyoqCiAgICAgKiBBY2Nlc3MgdHlwZSBmb3IgZ2VuZXJhdGVkIHNvdXJj\nZSwgZGVmYXVsdHMgdG8gZmllbGQtYmFzZWQgYWNjZXNzLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ0NFU1NfVFlQRV9GSUVM\nRCA9ICJmaWVsZCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBB\nQ0NFU1NfVFlQRV9QUk9QRVJUWSA9ICJwcm9wZXJ0eSI7CgogICAgcHJpdmF0\nZSBzdGF0aWMgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChSZXZlcnNlTWFwcGluZ1Rvb2wuY2xhc3MpOwoKICAgIC8v\nIG1hcCBqYXZhIGtleXdvcmRzIHRvIHJlbGF0ZWQgd29yZHMgdG8gdXNlIGlu\nIHRoZWlyIHBsYWNlCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBNYXAgX2ph\ndmFLZXl3b3JkcyA9IG5ldyBIYXNoTWFwKCk7CgogICAgc3RhdGljIHsKICAg\nICAgICBJbnB1dFN0cmVhbSBpbiA9IFJldmVyc2VNYXBwaW5nVG9vbC5jbGFz\ncy5nZXRSZXNvdXJjZUFzU3RyZWFtCiAgICAgICAgICAgICgiamF2YS1rZXl3\nb3Jkcy5yc3JjIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5n\nW10ga2V5d29yZHMgPSBTdHJpbmdzLnNwbGl0KG5ldyBCdWZmZXJlZFJlYWRl\ncgogICAgICAgICAgICAgICAgKG5ldyBJbnB1dFN0cmVhbVJlYWRlcihpbikp\nLnJlYWRMaW5lKCksICIsIiwgMCk7CgogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGtleXdvcmRzLmxlbmd0aDsgaSArPSAyKQogICAgICAgICAg\nICAgICAgX2phdmFLZXl3b3Jkcy5wdXQoa2V5d29yZHNbaV0sIGtleXdvcmRz\nW2kgKyAxXSk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihpb2Up\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBpbi5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJ\nT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSBmaW5hbCBKREJDQ29uZmlndXJhdGlvbiBfY29uZjsK\nICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAgICBwcml2YXRlIGZpbmFs\nIE1hcCBfdGFibGVzID0gbmV3IEhhc2hNYXAoKTsKICAgIHByaXZhdGUgZmlu\nYWwgUHJvamVjdCBfcHJvamVjdCA9IG5ldyBQcm9qZWN0KCk7CiAgICBwcml2\nYXRlIGZpbmFsIEJDQ2xhc3NMb2FkZXIgX2xvYWRlciA9IChCQ0NsYXNzTG9h\nZGVyKSBBY2Nlc3NDb250cm9sbGVyCiAgICAgICAgLmRvUHJpdmlsZWdlZChK\nMkRvUHJpdkhlbHBlci5uZXdCQ0NsYXNzTG9hZGVyQWN0aW9uKF9wcm9qZWN0\nKSk7CiAgICBwcml2YXRlIFN0cmF0ZWd5SW5zdGFsbGVyIF9zdHJhdCA9IG51\nbGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFja2FnZSA9IG51bGw7CiAgICBw\ncml2YXRlIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2YXRlIE1hcHBpbmdS\nZXBvc2l0b3J5IF9yZXBvcyA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdy\nb3VwIF9zY2hlbWEgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9udWxs\nQXNPYmogPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfYmxvYkFzT2Jq\nID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3VzZUdlbmVyaWNDb2xs\nID0gZmFsc2U7CiAgICBwcml2YXRlIFByb3BlcnRpZXMgX3R5cGVNYXAgPSBu\ndWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF91c2VGSyA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF91c2VTY2hlbWEgPSBmYWxzZTsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfcGtPbkpvaW4gPSBmYWxzZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfZGF0YXN0b3JlID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX2J1aWx0aW4gPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9pbm5lciA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBTdHJpbmcgX2lkU3VmZml4ID0gIklkIjsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfaW52ZXJzZSA9IHRydWU7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX2RldGFjaGFibGUgPSBmYWxzZTsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfZ2VuQW5ub3RhdGlvbnMgPSBmYWxzZTsKICAgIHByaXZhdGUg\nU3RyaW5nIF9hY2Nlc3NUeXBlID0gQUNDRVNTX1RZUEVfRklFTEQ7CiAgICBw\ncml2YXRlIENvZGVGb3JtYXQgX2Zvcm1hdCA9IG51bGw7CiAgICBwcml2YXRl\nIFJldmVyc2VDdXN0b21pemVyIF9jdXN0b20gPSBudWxsOwogICAgcHJpdmF0\nZSBTdHJpbmcgX2Rpc2NTdHJhdCA9IG51bGw7CiAgICBwcml2YXRlIFN0cmlu\nZyBfdmVyc1N0cmF0ID0gbnVsbDsKCiAgICAvLyB3ZSBoYXZlIHRvIHRyYWNr\nIGZpZWxkIG5hbWVzIHRoYXQgd2VyZSBjcmVhdGVkIGJ1dCB0aGVuIGFiYW5k\nb25lZCBieQogICAgLy8gdGhlIGN1c3RvbWl6ZXIgc28gdGhhdCB3ZSBkb24n\ndCBhdHRlbXB0IHRvIHVzZSB0aGVtIGFnYWluOyBkb2luZyBzbyBjYW4KICAg\nIC8vIG1lc3MgdXAgY2VydGFpbiBjdXN0b21pemVycyAoYnVnIDg4MSkKICAg\nIHByaXZhdGUgU2V0IF9hYmFuZG9uZWRGaWVsZE5hbWVzID0gbnVsbDsKCiAg\nICAvLyBnZW5lcmF0ZWQgYW5ub3RhdGlvbnMsIGtleSA9IG1ldGFkYXRhLCB2\nYWwgPSBsaXN0IG9mIGFubm90YXRpb25zCiAgICBwcml2YXRlIE1hcCBfYW5u\nb3MgPSBudWxsOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgUmV2ZXJzZU1h\ncHBpbmdUb29sKEpEQkNDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICBf\nY29uZiA9IGNvbmY7CiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKEpEQkND\nb25maWd1cmF0aW9uLkxPR19NRVRBREFUQSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGludGVybmFsIHN0cmF0ZWd5IGluc3RhbGxlci4K\nICAgICAqLwogICAgcHJpdmF0ZSBTdHJhdGVneUluc3RhbGxlciBnZXRTdHJh\ndGVneUluc3RhbGxlcigpIHsKICAgICAgICBpZiAoX3N0cmF0ID09IG51bGwp\nCiAgICAgICAgICAgIF9zdHJhdCA9IG5ldyBSZXZlcnNlU3RyYXRlZ3lJbnN0\nYWxsZXIoZ2V0UmVwb3NpdG9yeSgpKTsKICAgICAgICByZXR1cm4gX3N0cmF0\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25maWd1cmF0\naW9uIHByb3ZpZGVkIG9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVi\nbGljIEpEQkNDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBsb2cgdG8gd3JpdGUgdG8uCiAgICAgKi8KICAgIHB1YmxpYyBM\nb2cgZ2V0TG9nKCkgewogICAgICAgIHJldHVybiBfbG9nOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWZhdWx0IHBhY2thZ2UgZm9yIHRo\nZSBnZW5lcmF0ZWQgY2xhc3Nlcywgb3IgbnVsbCBpZiB1bnNldC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRQYWNrYWdlTmFtZSgpIHsKICAgICAg\nICByZXR1cm4gX3BhY2thZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIGRlZmF1bHQgcGFja2FnZSBmb3IgdGhlIGdlbmVyYXRlZCBjbGFzc2Vz\nOyB1c2UgbnVsbCB0bwogICAgICogaW5kaWNhdGUgbm8gcGFja2FnZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0UGFja2FnZU5hbWUoU3RyaW5nIHBh\nY2thZ2VOYW1lKSB7CiAgICAgICAgX3BhY2thZ2UgPSBTdHJpbmdVdGlscy50\ncmltVG9OdWxsKHBhY2thZ2VOYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBmaWxlIHRvIG91dHB1dCB0aGUgZ2VuZXJhdGVkIGNvZGUgdG8sIG9y\nIG51bGwgZm9yCiAgICAgKiB0aGUgY3VycmVudCBkaXJlY3RvcnkuIElmIHRo\nZSBkaXJlY3RvcnkgbWF0Y2hlcyB0aGUgcGFja2FnZSwgaXQgd2lsbAogICAg\nICogYmUgdXNlZC4gT3RoZXJ3aXNlLCB0aGUgcGFja2FnZSBzdHJ1Y3R1cmUg\nd2lsbCBiZSBjcmVhdGVkIHVuZGVyCiAgICAgKiB0aGlzIGRpcmVjdG9yeS4K\nICAgICAqLwogICAgcHVibGljIEZpbGUgZ2V0RGlyZWN0b3J5KCkgewogICAg\nICAgIHJldHVybiBfZGlyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGZp\nbGUgdG8gb3V0cHV0IHRoZSBnZW5lcmF0ZWQgY29kZSB0bywgb3IgbnVsbCBm\nb3IKICAgICAqIHRoZSBjdXJyZW50IGRpcmVjdG9yeS4gSWYgdGhlIGRpcmVj\ndG9yeSBtYXRjaGVzIHRoZSBwYWNrYWdlLCBpdCB3aWxsCiAgICAgKiBiZSB1\nc2VkLiBPdGhlcndpc2UsIHRoZSBwYWNrYWdlIHN0cnVjdHVyZSB3aWxsIGJl\nIGNyZWF0ZWQgdW5kZXIKICAgICAqIHRoaXMgZGlyZWN0b3J5LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXREaXJlY3RvcnkoRmlsZSBkaXIpIHsKICAg\nICAgICBfZGlyID0gZGlyOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRydWUgaWYgdGhlIHNjaGVtYSBuYW1lIHdpbGwgYmUgaW5jbHVkZWQgaW4g\ndGhlIGdlbmVyYXRlZAogICAgICogY2xhc3MgbmFtZSBmb3IgZWFjaCB0YWJs\nZS4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGdldFVzZVNjaGVtYU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF91c2VT\nY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgd2hldGhlciB0aGUg\nc2NoZW1hIG5hbWUgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVk\nCiAgICAgKiBjbGFzcyBuYW1lIGZvciBlYWNoIHRhYmxlLiBEZWZhdWx0cyB0\nbyBmYWxzZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VXNlU2NoZW1h\nTmFtZShib29sZWFuIHVzZVNjaGVtYSkgewogICAgICAgIF91c2VTY2hlbWEg\nPSB1c2VTY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGUgZm9yZWlnbiBrZXkgbmFtZSB3aWxsIGJlIHVzZWQgdG8gZ2Vu\nZXJhdGUKICAgICAqIHJlbGF0aW9uIG5hbWVzLiBEZWZhdWx0cyB0byBmYWxz\nZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0VXNlRm9yZWlnbktl\neU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF91c2VGSzsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB3aGV0aGVyIHRoZSBmb3JlaWduIGtleSBuYW1lIHdp\nbGwgYmUgdXNlZCB0byBnZW5lcmF0ZQogICAgICogcmVsYXRpb24gbmFtZXMu\nIERlZmF1bHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRVc2VGb3JlaWduS2V5TmFtZShib29sZWFuIHVzZUZLKSB7CiAgICAgICAg\nX3VzZUZLID0gdXNlRks7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nd2hldGhlciBldmVuIG51bGxhYmxlIGNvbHVtbnMgd2lsbCBiZSBtYXBwZWQg\ndG8gd3JhcHBlcnMKICAgICAqIHJhdGhlciB0aGFuIHByaW1pdGl2ZXMuIERl\nZmF1bHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXROdWxsYWJsZUFzT2JqZWN0KCkgewogICAgICAgIHJldHVybiBfbnVsbEFz\nT2JqOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHdoZXRoZXIgZXZlbiBu\ndWxsYWJsZSBjb2x1bW5zIHdpbGwgYmUgbWFwcGVkIHRvIHdyYXBwZXJzCiAg\nICAgKiByYXRoZXIgdGhhbiBwcmltaXRpdmVzLiBEZWZhdWx0cyB0byBmYWxz\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TnVsbGFibGVBc09iamVj\ndChib29sZWFuIG51bGxBc09iaikgewogICAgICAgIF9udWxsQXNPYmogPSBu\ndWxsQXNPYmo7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHJl\ndmVyc2UtbWFwIGJsb2IgY29sdW1ucyBhcyBjb250YWluaW5nIHNlcmlhbGl6\nZWQgSmF2YQogICAgICogb2JqZWN0cywgcmF0aGVyIHRoYW4gdGhlIGRlZmF1\nbHQgb2YgdXNpbmcgYSBieXRlW10gZmllbGQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGdldEJsb2JBc09iamVjdCgpIHsKICAgICAgICByZXR1cm4g\nX2Jsb2JBc09iajsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8g\ncmV2ZXJzZS1tYXAgYmxvYiBjb2x1bW5zIGFzIGNvbnRhaW5pbmcgc2VyaWFs\naXplZCBKYXZhCiAgICAgKiBvYmplY3RzLCByYXRoZXIgdGhhbiB0aGUgZGVm\nYXVsdCBvZiB1c2luZyBhIGJ5dGVbXSBmaWVsZC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0QmxvYkFzT2JqZWN0KGJvb2xlYW4gYmxvYkFzT2JqKSB7\nCiAgICAgICAgX2Jsb2JBc09iaiA9IGJsb2JBc09iajsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIGdlbmVyaWMgY29sbGVjdGlvbnMg\nb24gb25lLXRvLW1hbnkgYW5kIG1hbnktdG8tbWFueQogICAgICogcmVsYXRp\nb25zIGluc3RlYWQgb2YgdW50eXBlZCBjb2xsZWN0aW9ucy4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gZ2V0VXNlR2VuZXJpY0NvbGxlY3Rpb25zKCkg\newogICAgICAgIHJldHVybiBfdXNlR2VuZXJpY0NvbGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBnZW5lcmljIGNvbGxlY3Rpb25z\nIG9uIG9uZS10by1tYW55IGFuZCBtYW55LXRvLW1hbnkKICAgICAqIHJlbGF0\naW9ucyBpbnN0ZWFkIG9mIHVudHlwZWQgY29sbGVjdGlvbnMuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFVzZUdlbmVyaWNDb2xsZWN0aW9ucyhib29s\nZWFuIHVzZUdlbmVyaWNDb2xsZWN0aW9ucykgewogICAgICAgIF91c2VHZW5l\ncmljQ29sbCA9IHVzZUdlbmVyaWNDb2xsZWN0aW9uczsgCiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYXAgb2YgSkRCQy1uYW1lIHRvIEphdmEtdHlwZS1uYW1l\nIGVudHJpZXMgdGhhdCBhbGxvd3MgY3VzdG9taXphdGlvbgogICAgICogb2Yg\ncmV2ZXJzZSBtYXBwaW5nIGNvbHVtbnMgdG8gZmllbGQgdHlwZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBQcm9wZXJ0aWVzIGdldFR5cGVNYXAoKSB7CiAgICAg\nICAgcmV0dXJuIF90eXBlTWFwOwogICAgfQoKICAgIC8qKgogICAgICogTWFw\nIG9mIEpEQkMtbmFtZSB0byBKYXZhLXR5cGUtbmFtZSBlbnRyaWVzIHRoYXQg\nYWxsb3dzIGN1c3RvbWl6YXRpb24KICAgICAqIG9mIHJldmVyc2UgbWFwcGlu\nZyBjb2x1bW5zIHRvIGZpZWxkIHR5cGVzLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRUeXBlTWFwKFByb3BlcnRpZXMgdHlwZU1hcCkgewogICAgICAg\nIF90eXBlTWFwID0gdHlwZU1hcDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0cnVlIGlmIGpvaW4gdGFibGVzIGFyZSBhbGxvd2VkIHRvIGhhdmUg\ncHJpbWFyeSBrZXlzLCBmYWxzZQogICAgICogaWYgYWxsIHByaW1hcnkga2V5\nIHRhYmxlcyB3aWxsIGJlIG1hcHBlZCBhcyBwZXJzaXN0ZW50IGNsYXNzZXMu\nCiAgICAgKiBEZWZhdWx0cyB0byBmYWxzZS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gZ2V0UHJpbWFyeUtleU9uSm9pbigpIHsKICAgICAgICByZXR1\ncm4gX3BrT25Kb2luOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRvIHRy\ndWUgaWYgam9pbiB0YWJsZXMgYXJlIGFsbG93ZWQgdG8gaGF2ZSBwcmltYXJ5\nIGtleXMsIGZhbHNlCiAgICAgKiBpZiBhbGwgcHJpbWFyeSBrZXkgdGFibGVz\nIHdpbGwgYmUgbWFwcGVkIGFzIHBlcnNpc3RlbnQgY2xhc3Nlcy4KICAgICAq\nIERlZmF1bHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRQcmltYXJ5S2V5T25Kb2luKGJvb2xlYW4gcGtPbkpvaW4pIHsKICAgICAg\nICBfcGtPbkpvaW4gPSBwa09uSm9pbjsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdG8gdXNlIGRhdGFzdG9yZSBpZGVudGl0eSB3aGVuIHBvc3Np\nYmxlLiBEZWZhdWx0cyB0byBmYWxzZS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZ2V0VXNlRGF0YVN0b3JlSWRlbnRpdHkoKSB7CiAgICAgICAgcmV0\ndXJuIF9kYXRhc3RvcmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRvIHVzZSBkYXRhc3RvcmUgaWRlbnRpdHkgd2hlbiBwb3NzaWJsZS4gRGVm\nYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFVz\nZURhdGFTdG9yZUlkZW50aXR5KGJvb2xlYW4gZGF0YXN0b3JlKSB7CiAgICAg\nICAgX2RhdGFzdG9yZSA9IGRhdGFzdG9yZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdG8gdXNlIGJ1aWx0IGluIGlkZW50aXR5IGNsYXNzZXMg\nd2hlbiBwb3NzaWJsZS4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gZ2V0VXNlQnVpbHRpbklkZW50aXR5Q2xhc3MoKSB7\nCiAgICAgICAgcmV0dXJuIF9idWlsdGluOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0byB1c2UgYnVpbHQgaW4gaWRlbnRpdHkgY2xhc3NlcyB3\naGVuIHBvc3NpYmxlLiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRVc2VCdWlsdGluSWRlbnRpdHlDbGFzcyhib29sZWFu\nIGJ1aWx0aW4pIHsKICAgICAgICBfYnVpbHRpbiA9IGJ1aWx0aW47CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0byBnZW5lcmF0ZSBp\nbm5lciBjbGFzc2VzIHdoZW4gY3JlYXRpbmcgYXBwbGljYXRpb24KICAgICAq\nIGlkZW50aXR5IGNsYXNzZXMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGdldElubmVySWRlbnRpdHlDbGFzc2VzKCkgewogICAgICAgIHJldHVybiBf\naW5uZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0\nbyBnZW5lcmF0ZSBpbm5lciBjbGFzc2VzIHdoZW4gY3JlYXRpbmcgYXBwbGlj\nYXRpb24KICAgICAqIGlkZW50aXR5IGNsYXNzZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldElubmVySWRlbnRpdHlDbGFzc2VzKGJvb2xlYW4gaW5u\nZXIpIHsKICAgICAgICBfaW5uZXIgPSBpbm5lcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFN1ZmZpeCB1c2VkIHRvIGNyZWF0ZSBhcHBsaWNhdGlvbiBpZGVu\ndGl0eSBjbGFzcyBuYW1lIGZyb20gYSBjbGFzcyBuYW1lLAogICAgICogb3Ig\naW4gdGhlIGNhc2Ugb2YgaW5uZXIgaWRlbnRpdHkgY2xhc3NlcywgdGhlIGlu\nbmVyIGNsYXNzIG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nSWRlbnRpdHlDbGFzc1N1ZmZpeCgpIHsKICAgICAgICByZXR1cm4gX2lkU3Vm\nZml4OwogICAgfQoKICAgIC8qKgogICAgICogU3VmZml4IHVzZWQgdG8gY3Jl\nYXRlIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIG5hbWUgZnJvbSBhIGNs\nYXNzIG5hbWUsCiAgICAgKiBvciBpbiB0aGUgY2FzZSBvZiBpbm5lciBpZGVu\ndGl0eSBjbGFzc2VzLCB0aGUgaW5uZXIgY2xhc3MgbmFtZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0SWRlbnRpdHlDbGFzc1N1ZmZpeChTdHJpbmcg\nc3VmZml4KSB7CiAgICAgICAgX2lkU3VmZml4ID0gc3VmZml4OwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0byBnZW5lcmF0ZSBpbnZlcnNlIDEt\nbWFueS8xLTEgcmVsYXRpb25zIGZvciBhbGwgbWFueS0xLzEtMQogICAgICog\ncmVsYXRpb25zLiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRJbnZlcnNlUmVsYXRpb25zKCkgewogICAgICAgIHJl\ndHVybiBfaW52ZXJzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndG8gZ2VuZXJhdGUgaW52ZXJzZSAxLW1hbnkvMS0xIHJlbGF0aW9ucyBmb3Ig\nYWxsIG1hbnktMS8xLTEKICAgICAqIHJlbGF0aW9ucy4gRGVmYXVsdHMgdG8g\ndHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW52ZXJzZVJlbGF0\naW9ucyhib29sZWFuIGludmVyc2UpIHsKICAgICAgICBfaW52ZXJzZSA9IGlu\ndmVyc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIG1ha2Ug\nZ2VuZXJhdGVkIGNsYXNzZXMgZGV0YWNoYWJsZS4gRGVmYXVsdHMgdG8gZmFs\nc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldERldGFjaGFibGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9kZXRhY2hhYmxlOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0byBtYWtlIGdlbmVyYXRlZCBjbGFzc2VzIGRl\ndGFjaGFibGUuIERlZmF1bHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXREZXRhY2hhYmxlKGJvb2xlYW4gZGV0YWNoYWJsZSkgewog\nICAgICAgIF9kZXRhY2hhYmxlID0gZGV0YWNoYWJsZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIERlZmF1bHQgZGlzY3JpbWluYXRvciBzdHJhdGVneSBmb3Ig\nYmFzZSBjbGFzcyBtYXBwaW5ncy4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZyBnZXREaXNjcmltaW5hdG9yU3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJu\nIF9kaXNjU3RyYXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWZhdWx0IGRp\nc2NyaW1pbmF0b3Igc3RyYXRlZ3kgZm9yIGJhc2UgY2xhc3MgbWFwcGluZ3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERpc2NyaW1pbmF0b3JTdHJh\ndGVneShTdHJpbmcgZGlzY1N0cmF0KSB7CiAgICAgICAgX2Rpc2NTdHJhdCA9\nIGRpc2NTdHJhdDsKICAgIH0KCiAgICAvKioKICAgICAqIERlZmF1bHQgdmVy\nc2lvbiBzdHJhdGVneSBmb3IgYmFzZSBjbGFzcyBtYXBwaW5ncy4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRWZXJzaW9uU3RyYXRlZ3koKSB7CiAg\nICAgICAgcmV0dXJuIF92ZXJzU3RyYXQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEZWZhdWx0IHZlcnNpb24gc3RyYXRlZ3kgZm9yIGJhc2UgY2xhc3MgbWFw\ncGluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFZlcnNpb25TdHJh\ndGVneShTdHJpbmcgdmVyc2lvblN0cmF0KSB7CiAgICAgICAgX3ZlcnNTdHJh\ndCA9IHZlcnNpb25TdHJhdDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdG8gZ2VuZXJhdGUgYW5ub3RhdGlvbnMgYWxvbmcgd2l0aCBnZW5lcmF0\nZWQgY29kZS4gRGVmYXVsdHMKICAgICAqIHRvIGZhbHNlLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBnZXRHZW5lcmF0ZUFubm90YXRpb25zKCkgewog\nICAgICAgIHJldHVybiBfZ2VuQW5ub3RhdGlvbnM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIGFubm90YXRpb25zIGFsb25n\nIHdpdGggZ2VuZXJhdGVkIGNvZGUuIERlZmF1bHRzCiAgICAgKiB0byBmYWxz\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0R2VuZXJhdGVBbm5vdGF0\naW9ucyhib29sZWFuIGdlbkFubm90YXRpb25zKSB7CiAgICAgICAgX2dlbkFu\nbm90YXRpb25zID0gZ2VuQW5ub3RhdGlvbnM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHRvIHVzZSBmaWVsZCBvciBwcm9wZXJ0eS1iYXNlZCBh\nY2Nlc3Mgb24gZ2VuZXJhdGVkIGNvZGUuCiAgICAgKiBEZWZhdWx0cyB0byBm\naWVsZC1iYXNlZCBhY2Nlc3MuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0QWNjZXNzVHlwZSgpIHsKICAgICAgICByZXR1cm4gX2FjY2Vzc1R5cGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBmaWVsZCBv\nciBwcm9wZXJ0eS1iYXNlZCBhY2Nlc3Mgb24gZ2VuZXJhdGVkIGNvZGUuCiAg\nICAgKiBEZWZhdWx0cyB0byBmaWVsZC1iYXNlZCBhY2Nlc3MuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldEFjY2Vzc1R5cGUoU3RyaW5nIGFjY2Vzc1R5\ncGUpIHsKICAgICAgICB0aGlzLl9hY2Nlc3NUeXBlID0gQUNDRVNTX1RZUEVf\nUFJPUEVSVFkuZXF1YWxzSWdub3JlQ2FzZShhY2Nlc3NUeXBlKSA/CiAgICAg\nICAgICAgIEFDQ0VTU19UWVBFX1BST1BFUlRZIDogQUNDRVNTX1RZUEVfRklF\nTEQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY29kZSBmb3JtYXR0ZXIg\nZm9yIHRoZSBnZW5lcmF0ZWQgSmF2YSBjb2RlLgogICAgICovCiAgICBwdWJs\naWMgQ29kZUZvcm1hdCBnZXRDb2RlRm9ybWF0KCkgewogICAgICAgIHJldHVy\nbiBfZm9ybWF0OwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBjb2Rl\nIGZvcm1hdHRlciBmb3IgdGhlIGdlbmVyYXRlZCBKYXZhIGNvZGUuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldENvZGVGb3JtYXQoQ29kZUZvcm1hdCBm\nb3JtYXQpIHsKICAgICAgICBfZm9ybWF0ID0gZm9ybWF0OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBjdXN0b21pemVyIGluIHVzZSwgb3Ig\nbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgUmV2ZXJzZUN1c3Rv\nbWl6ZXIgZ2V0Q3VzdG9taXplcigpIHsKICAgICAgICByZXR1cm4gX2N1c3Rv\nbTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY3VzdG9taXplci4g\nVGhlIGNvbmZpZ3VyYXRpb24gb24gdGhlIGN1c3RvbWl6ZXIsIGlmIGFueSwK\nICAgICAqIHNob3VsZCBhbHJlYWR5IGJlIHNldC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0Q3VzdG9taXplcihSZXZlcnNlQ3VzdG9taXplciBjdXN0\nb21pemVyKSB7CiAgICAgICAgaWYgKGN1c3RvbWl6ZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgY3VzdG9taXplci5zZXRUb29sKHRoaXMpOwogICAgICAgIF9j\ndXN0b20gPSBjdXN0b21pemVyOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBtYXBwaW5nIHJlcG9zaXRvcnkgdXNlZCB0byBob2xkIGdlbmVy\nYXRlZCBtYXBwaW5ncy4gWW91CiAgICAgKiBjYW4gYWxzbyB1c2UgdGhlIHJl\ncG9zaXRvcnkgdG8gc2VlZCB0aGUgc2NoZW1hIGdyb3VwIHRvIGdlbmVyYXRl\nCiAgICAgKiBjbGFzc2VzIGZyb20uCiAgICAgKi8KICAgIHB1YmxpYyBNYXBw\naW5nUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCkgewogICAgICAgIGlmIChf\ncmVwb3MgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBjcmVhdGUgZW1wdHkg\ncmVwb3NpdG9yeQogICAgICAgICAgICBfcmVwb3MgPSBfY29uZi5uZXdNYXBw\naW5nUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIF9yZXBvcy5z\nZXRNZXRhRGF0YUZhY3RvcnkoTm9uZU1ldGFEYXRhRmFjdG9yeS5nZXRJbnN0\nYW5jZSgpKTsKICAgICAgICAgICAgX3JlcG9zLnNldE1hcHBpbmdEZWZhdWx0\ncyhOb25lTWFwcGluZ0RlZmF1bHRzLmdldEluc3RhbmNlKCkpOwogICAgICAg\nICAgICBfcmVwb3Muc2V0UmVzb2x2ZShNT0RFX05PTkUpOwogICAgICAgICAg\nICBfcmVwb3Muc2V0VmFsaWRhdGUoX3JlcG9zLlZBTElEQVRFX05PTkUpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX3JlcG9zOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSByZXBvc2l0b3J5IHRvIHVzZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0UmVwb3NpdG9yeShNYXBwaW5nUmVwb3NpdG9y\neSByZXBvcykgewogICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBzY2hlbWEgZ3JvdXAgdG8gcmV2ZXJz\nZSBtYXAuIElmIG5vbmUgaGFzIGJlZW4gc2V0LCB0aGUKICAgICAqIHNjaGVt\nYSB3aWxsIGJlIGdlbmVyYXRlZCBmcm9tIHRoZSBkYXRhYmFzZS4KICAgICAq\nLwogICAgcHVibGljIFNjaGVtYUdyb3VwIGdldFNjaGVtYUdyb3VwKCkgewog\nICAgICAgIGlmIChfc2NoZW1hID09IG51bGwpIHsKICAgICAgICAgICAgU2No\nZW1hR2VuZXJhdG9yIGdlbiA9IG5ldyBTY2hlbWFHZW5lcmF0b3IoX2NvbmYp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZ2VuLmdlbmVy\nYXRlU2NoZW1hcygpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHsKICAgICAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsCiAgICAgICAgICAgICAgICAgICAgX2NvbmYuZ2V0REJE\naWN0aW9uYXJ5SW5zdGFuY2UoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgX3NjaGVtYSA9IGdlbi5nZXRTY2hlbWFHcm91cCgpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX3NjaGVtYTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgc2NoZW1hIHRvIHJldmVyc2UgbWFwLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRTY2hlbWFHcm91cChTY2hlbWFHcm91cCBzY2hlbWEp\nIHsKICAgICAgICBfc2NoZW1hID0gc2NoZW1hOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBnZW5lcmF0ZWQgbWFwcGluZ3MuCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzc01hcHBpbmdbXSBnZXRNYXBwaW5ncygpIHsKICAg\nICAgICByZXR1cm4gZ2V0UmVwb3NpdG9yeSgpLmdldE1hcHBpbmdzKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBtYXBwaW5ncyBhbmQgY2xh\nc3MgY29kZSBmb3IgdGhlIGN1cnJlbnQgc2NoZW1hIGdyb3VwLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgLy8gbWFwIGJhc2Ug\nY2xhc3NlcyBmaXJzdAogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSBnZXRT\nY2hlbWFHcm91cCgpLmdldFNjaGVtYXMoKTsKICAgICAgICBUYWJsZVtdIHRh\nYmxlczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFibGVzID0gc2NoZW1hc1tpXS5n\nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0\nYWJsZXMubGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAgICBpZiAoaXNCYXNl\nVGFibGUodGFibGVzW2pdKSkKICAgICAgICAgICAgICAgICAgICBtYXBCYXNl\nQ2xhc3ModGFibGVzW2pdKTsKICAgICAgICB9CgogICAgICAgIC8vIG1hcCB2\nZXJ0aWNhbCBzdWJjbGFzc2VzCiAgICAgICAgU2V0IHN1YnMgPSBudWxsOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICB0YWJsZXMgPSBzY2hlbWFzW2ldLmdldFRhYmxl\ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYmxlcy5s\nZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKCFfdGFibGVzLmNv\nbnRhaW5zS2V5KHRhYmxlc1tqXSkKICAgICAgICAgICAgICAgICAgICAmJiBn\nZXRTZWNvbmRhcnlUeXBlKHRhYmxlc1tqXSwgZmFsc2UpID09IFRBQkxFX1NV\nQkNMQVNTKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgc3VicyA9IG5ldyBIYXNoU2V0\nKCk7CiAgICAgICAgICAgICAgICAgICAgc3Vicy5hZGQodGFibGVzW2pdKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoc3VicyAhPSBudWxsKQogICAgICAgICAgICBtYXBTdWJjbGFz\nc2VzKHN1YnMpOwoKICAgICAgICAvLyBtYXAgZmllbGRzIGluIHRoZSBwcmlt\nYXJ5IHRhYmxlcyBvZiB0aGUgY2xhc3NlcwogICAgICAgIENsYXNzTWFwcGlu\nZyBjbHM7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfdGFibGVzLnZh\nbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIGNscyA9IChDbGFzc01hcHBpbmcpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIG1hcENvbHVtbnMoY2xzLCBjbHMuZ2V0VGFibGUoKSwgbnVsbCwgZmFs\nc2UpOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFwIGFzc29jaWF0aW9uIHRh\nYmxlcywgam9pbiB0YWJsZXMsIGFuZCBzZWNvbmRhcnkgdGFibGVzCiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHRhYmxlcyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7\nCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFibGVzLmxlbmd0\naDsgaisrKQogICAgICAgICAgICAgICAgaWYgKCFfdGFibGVzLmNvbnRhaW5z\nS2V5KHRhYmxlc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgbWFwVGFibGUo\ndGFibGVzW2pdLCBnZXRTZWNvbmRhcnlUeXBlKHRhYmxlc1tqXSwgZmFsc2Up\nKTsKICAgICAgICB9CgogICAgICAgIC8vIG1hcCBkaXNjcmltaW5hdG9ycyBh\nbmQgdmVyc2lvbnMsIG1ha2Ugc3VyZSBpZGVudGl0eSB0eXBlIGlzIGNvcnJl\nY3QsCiAgICAgICAgLy8gc2V0IHNpbXBsZSBmaWVsZCBjb2x1bW4gamF2YSB0\neXBlcywgYW5kIHJlZiBzY2hlbWEgY29tcG9uZW50cyBzbwogICAgICAgIC8v\nIHdlIGNhbiB0ZWxsIHdoYXQgaXMgdW5tYXBwZWQKICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmaWVsZHM7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBf\ndGFibGVzLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGNscyA9IChDbGFzc01hcHBpbmcpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIGNscy5yZWZTY2hlbWFDb21wb25lbnRzKCk7CiAgICAg\nICAgICAgIGlmIChjbHMuZ2V0RGlzY3JpbWluYXRvcigpLmdldFN0cmF0ZWd5\nKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGdldFN0cmF0ZWd5SW5zdGFs\nbGVyKCkuaW5zdGFsbFN0cmF0ZWd5CiAgICAgICAgICAgICAgICAgICAgKGNs\ncy5nZXREaXNjcmltaW5hdG9yKCkpOwogICAgICAgICAgICBjbHMuZ2V0RGlz\nY3JpbWluYXRvcigpLnJlZlNjaGVtYUNvbXBvbmVudHMoKTsKICAgICAgICAg\nICAgaWYgKGNscy5nZXRWZXJzaW9uKCkuZ2V0U3RyYXRlZ3koKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pbnN0\nYWxsU3RyYXRlZ3koY2xzLmdldFZlcnNpb24oKSk7CiAgICAgICAgICAgIGNs\ncy5nZXRWZXJzaW9uKCkucmVmU2NoZW1hQ29tcG9uZW50cygpOwoKICAgICAg\nICAgICAgLy8gZG91YmxlLWNoZWNrIGlkZW50aXR5IHR5cGU7IGlmIGl0IHdh\ncyBzZXQgZm9yIGJ1aWx0aW4gaWRlbnRpdHkKICAgICAgICAgICAgLy8gaXQg\nbWlnaHQgaGF2ZSB0byBzd2l0Y2ggdG8gc3RkIGFwcGxpY2F0aW9uIGlkZW50\naXR5IGlmIHBrIGZpZWxkCiAgICAgICAgICAgIC8vIG5vdCBjb21wYXRpYmxl\nCiAgICAgICAgICAgIGlmIChjbHMuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVs\nbAogICAgICAgICAgICAgICAgJiYgY2xzLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWFwcGluZy5JRF9BUFBMSUNBVElPTikgewogICAgICAgICAgICAg\nICAgaWYgKGNscy5nZXRQcmltYXJ5S2V5RmllbGRzKCkubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1way1maWVsZHMiLCBjbHMpKTsKICAgICAgICAg\nICAgICAgIGlmIChjbHMuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gbnVsbAogICAg\nICAgICAgICAgICAgICAgIHx8IChjbHMuaXNPcGVuSlBBSWRlbnRpdHkoKSAm\nJiAhaXNCdWlsdGluSWRlbnRpdHkoY2xzKSkpCiAgICAgICAgICAgICAgICAg\nICAgc2V0T2JqZWN0SWRUeXBlKGNscyk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoY2xzLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5JRF9E\nQVRBU1RPUkUpCiAgICAgICAgICAgICAgICBjbHMuZ2V0UHJpbWFyeUtleUNv\nbHVtbnMoKVswXS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuTE9ORyk7CgogICAg\nICAgICAgICAvLyBzZXQgamF2YSB0eXBlcyBmb3Igc2ltcGxlIGZpZWxkczsK\nICAgICAgICAgICAgZmllbGRzID0gY2xzLmdldERlY2xhcmVkRmllbGRNYXBw\naW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxk\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZmllbGRzW2ldLnJl\nZlNjaGVtYUNvbXBvbmVudHMoKTsKICAgICAgICAgICAgICAgIHNldENvbHVt\nbkphdmFUeXBlKGZpZWxkc1tpXSk7CiAgICAgICAgICAgICAgICBzZXRDb2x1\nbW5KYXZhVHlwZShmaWVsZHNbaV0uZ2V0RWxlbWVudE1hcHBpbmcoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHNldCB0aGUgamF2\nYSB0eXBlcyBvZiBmb3JlaWduIGtleSBjb2x1bW5zOyB3ZSBjb3VsZG4ndCBk\nbyB0aGlzCiAgICAgICAgLy8gZWFybGllciBiZWNhdXNlIHdlIHJlbHkgb24g\ndGhlIGxpbmtlZC10byBjb2x1bW5zIHRvIGRvIGl0CiAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBfdGFibGVzLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGNscyA9IChDbGFzc01hcHBp\nbmcpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHNldEZvcmVpZ25LZXlKYXZh\nVHlwZShjbHMuZ2V0Sm9pbkZvcmVpZ25LZXkoKSk7CgogICAgICAgICAgICBm\naWVsZHMgPSBjbHMuZ2V0RGVjbGFyZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBzZXRGb3JlaWduS2V5SmF2YVR5cGUoZmll\nbGRzW2ldLmdldEpvaW5Gb3JlaWduS2V5KCkpOwogICAgICAgICAgICAgICAg\nc2V0Rm9yZWlnbktleUphdmFUeXBlKGZpZWxkc1tpXS5nZXRGb3JlaWduS2V5\nKCkpOwogICAgICAgICAgICAgICAgc2V0Rm9yZWlnbktleUphdmFUeXBlKGZp\nZWxkc1tpXS5nZXRFbGVtZW50TWFwcGluZygpLgogICAgICAgICAgICAgICAg\nICAgIGdldEZvcmVpZ25LZXkoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8vIGFsbG93IGN1c3RvbWl6ZXIgdG8gbWFwIHVubWFwcGVk\nIHRhYmxlcywgYW5kIHdhcm4gYWJvdXQgYW55dGhpbmcKICAgICAgICAvLyB0\naGF0IGVuZHMgdXAgdW5tYXBwZWQKICAgICAgICBDb2x1bW5bXSBjb2xzOwog\nICAgICAgIENvbGxlY3Rpb24gdW5tYXBwZWRDb2xzID0gbmV3IEFycmF5TGlz\ndCg1KTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFibGVzID0gc2NoZW1hc1tpXS5n\nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0\nYWJsZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIHVubWFwcGVk\nQ29scy5jbGVhcigpOwogICAgICAgICAgICAgICAgY29scyA9IHRhYmxlc1tq\nXS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBrID0g\nMDsgayA8IGNvbHMubGVuZ3RoOyBrKyspCiAgICAgICAgICAgICAgICAgICAg\naWYgKGNvbHNba10uZ2V0UmVmQ291bnQoKSA9PSAwKQogICAgICAgICAgICAg\nICAgICAgICAgICB1bm1hcHBlZENvbHMuYWRkKGNvbHNba10pOwoKICAgICAg\nICAgICAgICAgIGlmICh1bm1hcHBlZENvbHMuc2l6ZSgpID09IGNvbHMubGVu\nZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jdXN0b20gPT0gbnVs\nbCB8fCAhX2N1c3RvbS51bm1hcHBlZFRhYmxlKHRhYmxlc1tqXSkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgidW5tYXAt\ndGFibGUiLCB0YWJsZXNbal0pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAodW5tYXBwZWRDb2xzLnNpemUoKSA+IDApCiAgICAgICAgICAgICAgICAg\nICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJ1bm1hcC1jb2xzIiwgdGFibGVzW2pd\nLCB1bm1hcHBlZENvbHMpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoX2N1c3RvbSAhPSBudWxsKQogICAgICAgICAgICBfY3VzdG9t\nLmNsb3NlKCk7CgogICAgICAgIC8vIHJlc29sdmUgbWFwcGluZ3MKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF90YWJsZXMudmFsdWVzKCkuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICgoQ2xhc3NNYXBw\naW5nKSBpdHIubmV4dCgpKS5yZXNvbHZlKE1PREVfTUVUQSB8IE1PREVfTUFQ\nUElORyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgdGhlIHRhYmxlIG9m\nIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbWFw\nVGFibGUoVGFibGUgdGFibGUsIGludCB0eXBlKSB7CiAgICAgICAgc3dpdGNo\nICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2UgVEFCTEVfU0VDT05EQVJZOgog\nICAgICAgICAgICBjYXNlIFRBQkxFX1NFQ09OREFSWV9PVVRFUjoKICAgICAg\nICAgICAgICAgIG1hcFNlY29uZGFyeVRhYmxlKHRhYmxlLCB0eXBlICE9IFRB\nQkxFX1NFQ09OREFSWSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBUQUJMRV9BU1NPQ0lBVElPTjoKICAgICAgICAgICAgICAg\nIG1hcEFzc29jaWF0aW9uVGFibGUodGFibGUpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRydWUgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIGNvbXBhdGlibGUgd2l0aCBi\ndWlsdGluIGlkZW50aXR5LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBi\nb29sZWFuIGlzQnVpbHRpbklkZW50aXR5KENsYXNzTWFwcGluZyBjbHMpIHsK\nICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBjbHMuZ2V0UHJpbWFy\neUtleUZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBpZiAoZmllbGRzLmxlbmd0\naCAhPSAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc3dp\ndGNoIChmaWVsZHNbMF0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nSEFSX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PSUQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBKYXZhIHR5cGUgb2YgdGhlIGNvbHVtbiBmb3IgdGhlIGdpdmVu\nIHZhbHVlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldENv\nbHVtbkphdmFUeXBlKFZhbHVlTWFwcGluZyB2bSkgewogICAgICAgIENvbHVt\nbltdIGNvbHMgPSB2bS5nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNvbHMu\nbGVuZ3RoID09IDEpCiAgICAgICAgICAgIGNvbHNbMF0uc2V0SmF2YVR5cGUo\ndm0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgSmF2YSB0eXBlIG9mIHRoZSBmb3JlaWduIGtleSBjb2x1\nbW5zLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldEZvcmVp\nZ25LZXlKYXZhVHlwZShGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgaWYgKGZr\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBDb2x1bW5b\nXSBjb2xzID0gZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHBr\ncyA9IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoY29sc1tpXS5nZXRKYXZhVHlwZSgpID09IEphdmFUeXBlcy5PQkpFQ1Qp\nCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldEphdmFUeXBlKHBrc1tpXS5n\nZXRKYXZhVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVzZXMge0Bs\naW5rIENvZGVHZW5lcmF0b3J9cyB0byB3cml0ZSB0aGUgSmF2YSBjb2RlIGZv\nciB0aGUgZ2VuZXJhdGVkCiAgICAgKiBtYXBwaW5ncyB0byB0aGUgcHJvcGVy\nIHBhY2thZ2VzLgogICAgICoKICAgICAqIEByZXR1cm4gYSBsaXN0IG9mIHtA\nbGluayBGaWxlfSBpbnN0YW5jZXMgdGhhdCB3ZXJlIHdyaXR0ZW4KICAgICAq\nLwogICAgcHVibGljIExpc3QgcmVjb3JkQ29kZSgpCiAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcmVjb3JkQ29kZShudWxs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBjb2RlIGZvciB0\naGUgdG9vbC4KICAgICAqCiAgICAgKiBAcGFyYW0gb3V0cHV0IGlmIG51bGws\nIHRoZW4gcGVyZm9ybSB0aGUgd3JpdGUgZGlyZWN0bHkKICAgICAqIHRvIHRo\nZSBmaWxlc3lzdGVtOyBvdGhlcndpc2UsIHBvcHVsYXRlIHRoZQogICAgICog\nc3BlY2lmaWVkIG1hcCB3aXRoIGtleXMgYXMgdGhlIGdlbmVyYXRlZAogICAg\nICoge0BsaW5rIENsYXNzTWFwcGluZ30gYW5kIHZhbHVlcyBhcyBhCiAgICAg\nKiB7QGxpbmsgU3RyaW5nfSB0aGF0IGNvbnRhaW5zIHRoZSBnZW5lcmF0ZWQg\nY29kZQogICAgICogQHJldHVybiBhIGxpc3Qgb2Yge0BsaW5rIEZpbGV9IGlu\nc3RhbmNlcyB0aGF0IHdlcmUgd3JpdHRlbgogICAgICovCiAgICBwdWJsaWMg\nTGlzdCByZWNvcmRDb2RlKE1hcCBvdXRwdXQpCiAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBMaXN0IHdyaXR0ZW4gPSBuZXcgTGlua2Vk\nTGlzdCgpOwoKICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IGdl\ndE1hcHBpbmdzKCk7CiAgICAgICAgUmV2ZXJzZUNvZGVHZW5lcmF0b3IgZ2Vu\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNJbmZvRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJjbGFzcy1j\nb2RlIiwgbWFwcGluZ3NbaV0pKTsKCiAgICAgICAgICAgIEFwcGxpY2F0aW9u\nSWRUb29sIGFpZCA9IG5ld0FwcGxpY2F0aW9uSWRUb29sKG1hcHBpbmdzW2ld\nKTsKICAgICAgICAgICAgaWYgKGdldEdlbmVyYXRlQW5ub3RhdGlvbnMoKSkK\nICAgICAgICAgICAgICAgIGdlbiA9IG5ldyBBbm5vdGF0ZWRDb2RlR2VuZXJh\ndG9yKG1hcHBpbmdzW2ldLCBhaWQpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBnZW4gPSBuZXcgUmV2ZXJzZUNvZGVHZW5lcmF0b3IobWFw\ncGluZ3NbaV0sIGFpZCk7CgogICAgICAgICAgICBnZW4uZ2VuZXJhdGVDb2Rl\nKCk7CgogICAgICAgICAgICBpZiAob3V0cHV0ID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGdlbi53cml0ZUNvZGUoKTsKICAgICAgICAgICAgICAgIHdy\naXR0ZW4uYWRkKGdlbi5nZXRGaWxlKCkpOwogICAgICAgICAgICAgICAgaWYg\nKGFpZCAhPSBudWxsICYmICFhaWQuaXNJbm5lckNsYXNzKCkpCiAgICAgICAg\nICAgICAgICAgICAgYWlkLnJlY29yZCgpOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgU3RyaW5nV3JpdGVyIHdyaXRlciA9IG5ldyBT\ndHJpbmdXcml0ZXIoKTsKICAgICAgICAgICAgICAgIGdlbi53cml0ZUNvZGUo\nd3JpdGVyKTsKICAgICAgICAgICAgICAgIG91dHB1dC5wdXQobWFwcGluZ3Nb\naV0uZ2V0RGVzY3JpYmVkVHlwZSgpLCB3cml0ZXIudG9TdHJpbmcoKSk7Cgog\nICAgICAgICAgICAgICAgaWYgKGFpZCAhPSBudWxsICYmICFhaWQuaXNJbm5l\nckNsYXNzKCkpIHsKICAgICAgICAgICAgICAgICAgICB3cml0ZXIgPSBuZXcg\nU3RyaW5nV3JpdGVyKCk7CiAgICAgICAgICAgICAgICAgICAgYWlkLnNldFdy\naXRlcih3cml0ZXIpOwogICAgICAgICAgICAgICAgICAgIGFpZC5yZWNvcmQo\nKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHV0KG1hcHBpbmdzW2ld\nLmdldE9iamVjdElkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB3\ncml0ZXIudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdyaXR0ZW47CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXcml0ZSB0aGUgZ2VuZXJhdGVkIG1ldGFkYXRh\nIHRvIHRoZSBwcm9wZXIgcGFja2FnZXMuCiAgICAgKgogICAgICogQHJldHVy\nbiB0aGUgc2V0IG9mIG1ldGFkYXRhIHtAbGluayBGaWxlfXMgdGhhdCB3ZXJl\nIHdyaXR0ZW4KICAgICAqLwogICAgcHVibGljIENvbGxlY3Rpb24gcmVjb3Jk\nTWV0YURhdGEoYm9vbGVhbiBwZXJDbGFzcykKICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHJldHVybiByZWNvcmRNZXRhRGF0YShwZXJD\nbGFzcywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB0aGUg\nY29kZSBmb3IgdGhlIHRvb2wuCiAgICAgKgogICAgICogQHBhcmFtIG91dHB1\ndCBpZiBudWxsLCB0aGVuIHBlcmZvcm0gdGhlIHdyaXRlIGRpcmVjdGx5CiAg\nICAgKiB0byB0aGUgZmlsZXN5c3RlbTsgb3RoZXJ3aXNlLCBwb3B1bGF0ZSB0\naGUKICAgICAqIHNwZWNpZmllZCBtYXAgd2l0aCBrZXlzIGFzIHRoZSBnZW5l\ncmF0ZWQKICAgICAqIHtAbGluayBDbGFzc01hcHBpbmd9IGFuZCB2YWx1ZXMg\nYXMgYQogICAgICoge0BsaW5rIFN0cmluZ30gdGhhdCBjb250YWlucyB0aGUg\nZ2VuZXJhdGVkIGNvZGUKICAgICAqIEByZXR1cm4gdGhlIHNldCBvZiBtZXRh\nZGF0YSB7QGxpbmsgRmlsZX1zIHRoYXQgd2VyZSB3cml0dGVuCiAgICAgKi8K\nICAgIHB1YmxpYyBDb2xsZWN0aW9uIHJlY29yZE1ldGFEYXRhKGJvb2xlYW4g\ncGVyQ2xhc3MsIE1hcCBvdXRwdXQpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICAvLyBwcmV0ZW5kIG1hcHBpbmdzIGFyZSBhbGwgcmVz\nb2x2ZWQKICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IGdldE1h\ncHBpbmdzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5n\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgbWFwcGluZ3NbaV0uc2V0UmVz\nb2x2ZShNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcsIHRydWUpOwoKICAgICAg\nICAvLyBzdG9yZSBpbiB1c2VyJ3MgY29uZmlndXJlZCBJTwogICAgICAgIE1l\ndGFEYXRhRmFjdG9yeSBtZGYgPSBfY29uZi5uZXdNZXRhRGF0YUZhY3RvcnlJ\nbnN0YW5jZSgpOwogICAgICAgIG1kZi5zZXRSZXBvc2l0b3J5KGdldFJlcG9z\naXRvcnkoKSk7CiAgICAgICAgbWRmLnNldFN0b3JlRGlyZWN0b3J5KF9kaXIp\nOwogICAgICAgIGlmIChwZXJDbGFzcykKICAgICAgICAgICAgbWRmLnNldFN0\nb3JlTW9kZShNZXRhRGF0YUZhY3RvcnkuU1RPUkVfUEVSX0NMQVNTKTsKICAg\nICAgICBtZGYuc3RvcmUobWFwcGluZ3MsIG5ldyBRdWVyeU1ldGFEYXRhWzBd\nLCBuZXcgU2VxdWVuY2VNZXRhRGF0YVswXSwKICAgICAgICAgICAgTU9ERV9N\nRVRBIHwgTU9ERV9NQVBQSU5HLCBvdXRwdXQpOwoKICAgICAgICBTZXQgZmls\nZXMgPSBuZXcgVHJlZVNldCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChtYXBw\naW5nc1tpXS5nZXRTb3VyY2VGaWxlKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGZpbGVzLmFkZChtYXBwaW5nc1tpXS5nZXRTb3VyY2VGaWxlKCkpOwog\nICAgICAgIHJldHVybiBmaWxlczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBi\ndWlsZEFubm90YXRpb25zKCkgewogICAgICAgIE1hcCBvdXRwdXQgPSBuZXcg\nSGFzaE1hcCgpOwogICAgICAgIC8vIHByZXRlbmQgbWFwcGluZ3MgYXJlIGFs\nbCByZXNvbHZlZAogICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzID0g\nZ2V0TWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1h\ncHBpbmdzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBtYXBwaW5nc1tpXS5z\nZXRSZXNvbHZlKE1PREVfTUVUQSB8IE1PREVfTUFQUElORywgdHJ1ZSk7Cgog\nICAgICAgIC8vIHN0b3JlIGluIHVzZXIncyBjb25maWd1cmVkIElPCiAgICAg\nICAgTWV0YURhdGFGYWN0b3J5IG1kZiA9IF9jb25mLm5ld01ldGFEYXRhRmFj\ndG9yeUluc3RhbmNlKCk7CiAgICAgICAgbWRmLnNldFJlcG9zaXRvcnkoZ2V0\nUmVwb3NpdG9yeSgpKTsKICAgICAgICBtZGYuc2V0U3RvcmVEaXJlY3Rvcnko\nX2Rpcik7CiAgICAgICAgbWRmLnN0b3JlKG1hcHBpbmdzLCBuZXcgUXVlcnlN\nZXRhRGF0YVswXSwgbmV3IFNlcXVlbmNlTWV0YURhdGFbMF0sCiAgICAgICAg\nICAgIE1PREVfTUVUQSB8IE1PREVfTUFQUElORyB8IE1PREVfQU5OX01BUFBJ\nTkcsIG91dHB1dCk7CiAgICAgICAgX2Fubm9zID0gb3V0cHV0OwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyBhIGxpc3Qgb2Ygc3RyaW5naWZpZWQg\nYW5ub3RhdGlvbnMgZm9yIHNwZWNpZmllZCBtZXRhLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgTGlzdCBnZXRBbm5vdGF0aW9uc0Zvck1ldGEoT2JqZWN0IG1l\ndGEpIHsKICAgICAgICBpZiAobnVsbCA9PSBfYW5ub3MpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoTGlzdCkgX2Fubm9zLmdl\ndChtZXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGFuZCB3\ncml0ZSB0aGUgYXBwbGljYXRpb24gaWRlbnRpdHkgY29kZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBBcHBsaWNhdGlvbklkVG9vbCBuZXdBcHBsaWNhdGlvbklk\nVG9vbChDbGFzc01hcHBpbmcgbWFwcGluZykgewogICAgICAgIEFwcGxpY2F0\naW9uSWRUb29sIHRvb2w7CiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0FQUExJQ0FUSU9OCiAgICAg\nICAgICAgICYmICFtYXBwaW5nLmlzT3BlbkpQQUlkZW50aXR5KCkKICAgICAg\nICAgICAgJiYgbWFwcGluZy5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIHRvb2wgPSBuZXcgQXBwbGljYXRpb25JZFRvb2woX2Nv\nbmYsIG1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAg\nICAgbWFwcGluZyk7CiAgICAgICAgICAgIHRvb2wuc2V0RGlyZWN0b3J5KF9k\naXIpOwogICAgICAgICAgICB0b29sLnNldENvZGVGb3JtYXQoX2Zvcm1hdCk7\nCiAgICAgICAgICAgIGlmICghdG9vbC5ydW4oKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gdG9vbDsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTWV0aG9kcyBmb3Ig\nY3VzdG9taXplcnMgdG8gdXNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsYXNz\nIG1hcHBpbmcgZm9yIHRoZSBnaXZlbiB0YWJsZSwgb3IgbnVsbCBpZiBub25l\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldENsYXNzTWFw\ncGluZyhUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBw\naW5nKSBfdGFibGVzLmdldCh0YWJsZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgY2xhc3MgdG8gYmUgbWFwcGVkIHRvIGEgdGFibGUu\nIFRoZSBjbGFzcyB3aWxsIHN0YXJ0IG91dAogICAgICogd2l0aCBhIGRlZmF1\nbHQgYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3Mgc2V0LgogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3NNYXBwaW5nIG5ld0NsYXNzTWFwcGluZyhDbGFzcyBj\nbHMsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcgPSAoQ2xhc3NNYXBwaW5nKSBnZXRSZXBvc2l0b3J5KCkuYWRkTWV0YURh\ndGEoY2xzKTsKICAgICAgICBDbGFzcyBzdXAgPSBtYXBwaW5nLmdldERlc2Ny\naWJlZFR5cGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKHN1cCA9\nPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHNldE9iamVjdElkVHlwZSht\nYXBwaW5nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG1hcHBpbmcuc2V0\nUENTdXBlcmNsYXNzKHN1cCk7CiAgICAgICAgbWFwcGluZy5zZXRUYWJsZSh0\nYWJsZSk7CiAgICAgICAgaWYgKF9kZXRhY2hhYmxlKQogICAgICAgICAgICBt\nYXBwaW5nLnNldERldGFjaGFibGUodHJ1ZSk7CiAgICAgICAgX3RhYmxlcy5w\ndXQodGFibGUsIG1hcHBpbmcpOwogICAgICAgIHJldHVybiBtYXBwaW5nOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiBjbGFzcycgb2Jq\nZWN0aWQtY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRPYmpl\nY3RJZFR5cGUoQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIFN0cmluZyBu\nYW1lID0gY2xzLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCk7CiAgICAg\nICAgaWYgKF9pbm5lcikKICAgICAgICAgICAgbmFtZSArPSAiJCI7CiAgICAg\nICAgbmFtZSArPSBfaWRTdWZmaXg7CiAgICAgICAgY2xzLnNldE9iamVjdElk\nVHlwZShnZW5lcmF0ZUNsYXNzKG5hbWUsIG51bGwpLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIG5ldyBjbGFzcyB3aXRoIHRo\nZSBnaXZlbiBuYW1lLiBJZiBhIG5vbi1udWxsIHBhcmVudCBjbGFzcwogICAg\nICogaXMgZ2l2ZW4sIGl0IHdpbGwgYmUgc2V0IGFzIHRoZSBzdXBlcmNsYXNz\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2VuZXJhdGVDbGFzcyhTdHJp\nbmcgbmFtZSwgQ2xhc3MgcGFyZW50KSB7CiAgICAgICAgQkNDbGFzcyBiYyA9\nIF9wcm9qZWN0LmxvYWRDbGFzcyhuYW1lLCBudWxsKTsKICAgICAgICBpZiAo\ncGFyZW50ICE9IG51bGwpCiAgICAgICAgICAgIGJjLnNldFN1cGVyY2xhc3Mo\ncGFyZW50KTsKICAgICAgICBiYy5hZGREZWZhdWx0Q29uc3RydWN0b3IoKTsK\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNzLmZvck5h\nbWUobmFtZSwgZmFsc2UsIF9sb2FkZXIpOwogICAgICAgIH0gY2F0Y2ggKENs\nYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oY25mZS50b1N0cmluZygpLCBjbmZl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgaXMgdW5pcXVlLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1VuaXF1ZShGb3JlaWduS2V5IGZrKSB7\nCiAgICAgICAgUHJpbWFyeUtleSBwayA9IGZrLmdldFRhYmxlKCkuZ2V0UHJp\nbWFyeUtleSgpOwogICAgICAgIGlmIChwayAhPSBudWxsICYmIHBrLmNvbHVt\nbnNNYXRjaChmay5nZXRDb2x1bW5zKCkpKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICBJbmRleFtdIGlkeCA9IGZrLmdldFRhYmxlKCkuZ2V0\nSW5kZXhlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWR4Lmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoaWR4W2ldLmlzVW5pcXVlKCkg\nJiYgaWR4W2ldLmNvbHVtbnNNYXRjaChmay5nZXRDb2x1bW5zKCkpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgVW5pcXVlW10gdW5x\nID0gZmsuZ2V0VGFibGUoKS5nZXRVbmlxdWVzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCB1bnEubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlm\nICh1bnFbaV0uY29sdW1uc01hdGNoKGZrLmdldENvbHVtbnMoKSkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUgZ2l2ZW4gdGFibGUgaGFz\nIGEgc2luZ2xlIHVuaXF1ZSBmb3JlaWduIGtleSBvciBhIGZvcmVpZ24KICAg\nICAqIGtleSB0aGF0IG1hdGNoZXMgdGhlIHByaW1hcnkga2V5LCByZXR1cm4g\naXQuIEVsc2UgcmV0dXJuIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBGb3Jl\naWduS2V5IGdldFVuaXF1ZUZvcmVpZ25LZXkoVGFibGUgdGFibGUpIHsKICAg\nICAgICBGb3JlaWduS2V5W10gZmtzID0gdGFibGUuZ2V0Rm9yZWlnbktleXMo\nKTsKICAgICAgICBQcmltYXJ5S2V5IHBrID0gdGFibGUuZ2V0UHJpbWFyeUtl\neSgpOwogICAgICAgIEZvcmVpZ25LZXkgdW5xID0gbnVsbDsKICAgICAgICBp\nbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmtz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwayAhPSBudWxsICYm\nIHBrLmNvbHVtbnNNYXRjaChma3NbaV0uZ2V0Q29sdW1ucygpKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBma3NbaV07CiAgICAgICAgICAgIGlmICghaXNV\nbmlxdWUoZmtzW2ldKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgaWYgKHVucSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdW5xID0gZmtzW2ldOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gKGNvdW50ID09IDEpID8gdW5xIDogbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBleGlzdGluZyB1bmlxdWUgY29uc3RyYWlu\ndHMgYW5kIGluZGV4ZXMgdG8gdGhlIGdpdmVuIGZpZWxkJ3Mgam9pbi4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgYWRkSm9pbkNvbnN0cmFpbnRzKEZpZWxk\nTWFwcGluZyBmaWVsZCkgewogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVs\nZC5nZXRKb2luRm9yZWlnbktleSgpOwogICAgICAgIGlmIChmayA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIEluZGV4IGlkeCA9IGZp\nbmRJbmRleChmay5nZXRDb2x1bW5zKCkpOwogICAgICAgIGlmIChpZHggIT0g\nbnVsbCkKICAgICAgICAgICAgZmllbGQuc2V0Sm9pbkluZGV4KGlkeCk7CiAg\nICAgICAgVW5pcXVlIHVucSA9IGZpbmRVbmlxdWUoZmsuZ2V0Q29sdW1ucygp\nKTsKICAgICAgICBpZiAodW5xICE9IG51bGwpCiAgICAgICAgICAgIGZpZWxk\nLnNldEpvaW5VbmlxdWUodW5xKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCBleGlzdGluZyB1bmlxdWUgY29uc3RyYWludHMgYW5kIGluZGV4ZXMgdG8g\ndGhlIGdpdmVuIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRD\nb25zdHJhaW50cyhWYWx1ZU1hcHBpbmcgdm0pIHsKICAgICAgICBDb2x1bW5b\nXSBjb2xzID0gKHZtLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKQogICAgICAg\nICAgICA/IHZtLmdldEZvcmVpZ25LZXkoKS5nZXRDb2x1bW5zKCkgOiB2bS5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgSW5kZXggaWR4ID0gZmluZEluZGV4KGNv\nbHMpOwogICAgICAgIGlmIChpZHggIT0gbnVsbCkKICAgICAgICAgICAgdm0u\nc2V0VmFsdWVJbmRleChpZHgpOwogICAgICAgIFVuaXF1ZSB1bnEgPSBmaW5k\nVW5pcXVlKGNvbHMpOwogICAgICAgIGlmICh1bnEgIT0gbnVsbCkKICAgICAg\nICAgICAgdm0uc2V0VmFsdWVVbmlxdWUodW5xKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgaW5kZXggd2l0aCB0aGUgZ2l2ZW4gY29sdW1u\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBJbmRleCBmaW5kSW5kZXgoQ29sdW1u\nW10gY29scykgewogICAgICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIFRhYmxlIHRhYmxlID0gY29sc1swXS5nZXRUYWJsZSgpOwogICAgICAgIElu\nZGV4W10gaWR4cyA9IHRhYmxlLmdldEluZGV4ZXMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGlkeHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGlmIChpZHhzW2ldLmNvbHVtbnNNYXRjaChjb2xzKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBpZHhzW2ldOwogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB1bmlxdWUgY29uc3RyaWFu\ndCB3aXRoIHRoZSBnaXZlbiBjb2x1bW5zLgogICAgICovCiAgICBwcml2YXRl\nIFVuaXF1ZSBmaW5kVW5pcXVlKENvbHVtbltdIGNvbHMpIHsKICAgICAgICBp\nZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBUYWJsZSB0YWJsZSA9IGNvbHNb\nMF0uZ2V0VGFibGUoKTsKICAgICAgICBVbmlxdWVbXSB1bnFzID0gdGFibGUu\nZ2V0VW5pcXVlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdW5x\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHVucXNbaV0uY29sdW1u\nc01hdGNoKGNvbHMpKQogICAgICAgICAgICAgICAgcmV0dXJuIHVucXNbaV07\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8vCgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gdGFibGUgaXMgYSBi\nYXNlIGNsYXNzIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0Jhc2VUYWJsZShUYWJsZSB0YWJsZSkgewogICAgICAgIGlmICh0YWJsZS5n\nZXRQcmltYXJ5S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGludCB0eXBlID0gZ2V0U2Vjb25kYXJ5VHlwZSh0YWJs\nZSwgdHJ1ZSk7CiAgICAgICAgaWYgKHR5cGUgIT0gLTEpCiAgICAgICAgICAg\nIHJldHVybiB0eXBlID09IFRBQkxFX0JBU0U7CiAgICAgICAgaWYgKF9jdXN0\nb20gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9jdXN0b20uZ2V0VGFi\nbGVUeXBlKHRhYmxlLCBUQUJMRV9CQVNFKSA9PSBUQUJMRV9CQVNFOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3Vs\nYXRlIHRoZSB0eXBlIG9mIHRoZSBzZWNvbmRhcnkgZ2l2ZW4gdGFibGUuCiAg\nICAgKi8KICAgIHByaXZhdGUgaW50IGdldFNlY29uZGFyeVR5cGUoVGFibGUg\ndGFibGUsIGJvb2xlYW4gbWF5YmVCYXNlKSB7CiAgICAgICAgaW50IHR5cGU7\nCiAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlLmdldEZvcmVpZ25L\nZXlzKCk7CiAgICAgICAgaWYgKGZrcy5sZW5ndGggPT0gMgogICAgICAgICAg\nICAmJiAodGFibGUuZ2V0UHJpbWFyeUtleSgpID09IG51bGwgfHwgX3BrT25K\nb2luKQogICAgICAgICAgICAmJiBma3NbMF0uZ2V0Q29sdW1ucygpLmxlbmd0\naCArIGZrc1sxXS5nZXRDb2x1bW5zKCkubGVuZ3RoCiAgICAgICAgICAgID09\nIHRhYmxlLmdldENvbHVtbnMoKS5sZW5ndGgKICAgICAgICAgICAgJiYgKCFp\nc1VuaXF1ZShma3NbMF0pIHx8ICFpc1VuaXF1ZShma3NbMV0pKSkKICAgICAg\nICAgICAgdHlwZSA9IFRBQkxFX0FTU09DSUFUSU9OOwogICAgICAgIGVsc2Ug\naWYgKG1heWJlQmFzZSAmJiB0YWJsZS5nZXRQcmltYXJ5S2V5KCkgIT0gbnVs\nbCkKICAgICAgICAgICAgdHlwZSA9IC0xOwogICAgICAgIGVsc2UgaWYgKGdl\ndFVuaXF1ZUZvcmVpZ25LZXkodGFibGUpICE9IG51bGwpCiAgICAgICAgICAg\nIHR5cGUgPSBUQUJMRV9TRUNPTkRBUlk7CiAgICAgICAgZWxzZSBpZiAoZmtz\nLmxlbmd0aCA9PSAxKQogICAgICAgICAgICB0eXBlID0gVEFCTEVfTk9ORTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHR5cGUgPSAtMTsKCiAgICAgICAg\naWYgKF9jdXN0b20gIT0gbnVsbCAmJiB0eXBlICE9IC0xKQogICAgICAgICAg\nICB0eXBlID0gX2N1c3RvbS5nZXRUYWJsZVR5cGUodGFibGUsIHR5cGUpOwog\nICAgICAgIHJldHVybiB0eXBlOwogICAgfQoKICAgIC8qKgogICAgICogQXR0\nZW1wdCB0byBjcmVhdGUgYSBiYXNlIGNsYXNzIGZyb20gdGhlIGdpdmVuIHRh\nYmxlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbWFwQmFzZUNsYXNzKFRh\nYmxlIHRhYmxlKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IG5ld0Ns\nYXNzTWFwcGluZyh0YWJsZSwgbnVsbCk7CiAgICAgICAgaWYgKGNscyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGNoZWNrIGZv\nciBkYXRhc3RvcmUgaWRlbnRpdHkgYW5kIGJ1aWx0aW4gaWRlbnRpdHk7IGZv\nciBub3cKICAgICAgICAvLyB3ZSBhc3N1bWUgdGhhdCBhbnkgbm9uLWRhdGFz\ndG9yZSBzaW5nbGUgcHJpbWFyeSBrZXkgY29sdW1uIHdpbGwgdXNlCiAgICAg\nICAgLy8gYnVpbHRpbiBpZGVudGl0eTsgaWYgd2UgZGlzY292ZXIgdGhhdCB0\naGUgcHJpbWFyeSBrZXkgZmllbGQgaXMKICAgICAgICAvLyBub3QgY29tcGF0\naWJsZSB3aXRoIGJ1aWx0aW4gaWRlbnRpdHkgbGF0ZXIsIHRoZW4gd2UnbGwg\nYXNzaWduCiAgICAgICAgLy8gYW4gYXBwbGljYXRpb24gaWRlbnRpdHkgY2xh\nc3MKICAgICAgICBDb2x1bW5bXSBwa3MgPSB0YWJsZS5nZXRQcmltYXJ5S2V5\nKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGNscy5zZXRQcmltYXJ5S2V5Q29s\ndW1ucyhwa3MpOwogICAgICAgIGlmIChwa3MubGVuZ3RoID09IDEgJiYgX2Rh\ndGFzdG9yZQogICAgICAgICAgICAmJiBwa3NbMF0uaXNDb21wYXRpYmxlKFR5\ncGVzLkJJR0lOVCwgbnVsbCwgMCwgMCkpIHsKICAgICAgICAgICAgY2xzLnNl\ndE9iamVjdElkVHlwZShudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIGNscy5z\nZXRJZGVudGl0eVR5cGUoQ2xhc3NNYXBwaW5nLklEX0RBVEFTVE9SRSk7CiAg\nICAgICAgfSBlbHNlIGlmIChwa3MubGVuZ3RoID09IDEgJiYgX2J1aWx0aW4p\nCiAgICAgICAgICAgIGNscy5zZXRPYmplY3RJZFR5cGUobnVsbCwgZmFsc2Up\nOwogICAgICAgIGNscy5zZXRTdHJhdGVneShuZXcgRnVsbENsYXNzU3RyYXRl\nZ3koKSwgbnVsbCk7CiAgICAgICAgaWYgKF9jdXN0b20gIT0gbnVsbCkKICAg\nICAgICAgICAgX2N1c3RvbS5jdXN0b21pemUoY2xzKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEF0dGVtcHQgdG8gY3JlYXRlIGEgdmVydGljYWwgc3ViY2xh\nc3NlcyBmcm9tIHRoZSBnaXZlbiB0YWJsZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBtYXBTdWJjbGFzc2VzKFNldCB0YWJsZXMpIHsKICAgICAgICAv\nLyBsb29wIHRocm91Z2ggdGFibGVzIHVudGlsIGVpdGhlciBhbGwgYXJlIG1h\ncHBlZCBvciBub25lIGxpbmsgdG8KICAgICAgICAvLyBhIG1hcHBlZCBiYXNl\nIGNsYXNzIHRhYmxlCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2UsIHN1YjsK\nICAgICAgICBUYWJsZSB0YWJsZSA9IG51bGw7CiAgICAgICAgRm9yZWlnbktl\neSBmayA9IG51bGw7CiAgICAgICAgd2hpbGUgKCF0YWJsZXMuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIC8vIGZpbmQgYSB0YWJsZSB3aXRoIGEgZm9yZWln\nbiBrZXkgbGlua2luZyB0byBhIG1hcHBlZCB0YWJsZQogICAgICAgICAgICBi\nYXNlID0gbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0\nYWJsZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHRhYmxlID0gKFRhYmxlKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgZmsgPSBnZXRVbmlxdWVGb3JlaWduS2V5KHRhYmxlKTsKICAgICAg\nICAgICAgICAgIGlmIChmayA9PSBudWxsICYmIHRhYmxlLmdldEZvcmVpZ25L\nZXlzKCkubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICAgICAgZmsgPSB0\nYWJsZS5nZXRGb3JlaWduS2V5cygpWzBdOwogICAgICAgICAgICAgICAgZWxz\nZSBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpdHIucmVt\nb3ZlKCk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBiYXNlID0gKENsYXNzTWFwcGluZykgX3RhYmxlcy5nZXQoZmsuZ2V0\nUHJpbWFyeUtleVRhYmxlKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChi\nYXNlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRyLnJl\nbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgLy8gaWYgbm8gdGFibGVzIGxpbmsgdG8gYSBiYXNl\nIHRhYmxlLCBub3RoaW5nIGxlZnQgdG8gZG8KICAgICAgICAgICAgaWYgKGJh\nc2UgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nICAgIHN1YiA9IG5ld0NsYXNzTWFwcGluZyh0YWJsZSwgYmFzZS5nZXREZXNj\ncmliZWRUeXBlKCkpOwogICAgICAgICAgICBzdWIuc2V0Sm9pbkZvcmVpZ25L\nZXkoZmspOwogICAgICAgICAgICBzdWIuc2V0UHJpbWFyeUtleUNvbHVtbnMo\nZmsuZ2V0Q29sdW1ucygpKTsKICAgICAgICAgICAgc3ViLnNldElkZW50aXR5\nVHlwZShiYXNlLmdldElkZW50aXR5VHlwZSgpKTsKICAgICAgICAgICAgc3Vi\nLnNldFN0cmF0ZWd5KG5ldyBWZXJ0aWNhbENsYXNzU3RyYXRlZ3koKSwgbnVs\nbCk7CiAgICAgICAgICAgIGlmIChfY3VzdG9tICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBfY3VzdG9tLmN1c3RvbWl6ZShzdWIpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEF0dGVtcHQgdG8gcmV2ZXJzZSBtYXAgdGhl\nIGdpdmVuIHRhYmxlIGFzIGFuIGFzc29jaWF0aW9uIHRhYmxlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgbWFwQXNzb2NpYXRpb25UYWJsZShUYWJsZSB0\nYWJsZSkgewogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSB0YWJsZS5nZXRG\nb3JlaWduS2V5cygpOwogICAgICAgIGlmIChma3MubGVuZ3RoICE9IDIpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNsczEg\nPSAoQ2xhc3NNYXBwaW5nKSBfdGFibGVzLmdldAogICAgICAgICAgICAoZmtz\nWzBdLmdldFByaW1hcnlLZXlUYWJsZSgpKTsKICAgICAgICBDbGFzc01hcHBp\nbmcgY2xzMiA9IChDbGFzc01hcHBpbmcpIF90YWJsZXMuZ2V0CiAgICAgICAg\nICAgIChma3NbMV0uZ2V0UHJpbWFyeUtleVRhYmxlKCkpOwogICAgICAgIGlm\nIChjbHMxID09IG51bGwgfHwgY2xzMiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIC8vIGFkZCBhIHJlbGF0aW9uIGZyb20gZWFjaCBj\nbGFzcyB0byB0aGUgb3RoZXIgdGhyb3VnaCB0aGUKICAgICAgICAvLyBhc3Nv\nY2lhdGlvbiB0YWJsZQogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0UmVsYXRp\nb25OYW1lKGNsczIuZ2V0RGVzY3JpYmVkVHlwZSgpLCB0cnVlLCBma3NbMV0s\nCiAgICAgICAgICAgIGZhbHNlLCBjbHMxKTsKICAgICAgICBGaWVsZE1hcHBp\nbmcgZmllbGQxID0gbmV3RmllbGRNYXBwaW5nKG5hbWUsIFNldC5jbGFzcywg\nbnVsbCwgZmtzWzFdLAogICAgICAgICAgICBjbHMxKTsKICAgICAgICBpZiAo\nZmllbGQxICE9IG51bGwpIHsKICAgICAgICAgICAgZmllbGQxLnNldEpvaW5G\nb3JlaWduS2V5KGZrc1swXSk7CiAgICAgICAgICAgIGFkZEpvaW5Db25zdHJh\naW50cyhmaWVsZDEpOwogICAgICAgICAgICBWYWx1ZU1hcHBpbmcgdm0gPSBm\naWVsZDEuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAgdm0uc2V0\nRGVjbGFyZWRUeXBlKGNsczIuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAg\nICAgICAgdm0uc2V0Rm9yZWlnbktleShma3NbMV0pOwogICAgICAgICAgICBh\nZGRDb25zdHJhaW50cyh2bSk7CiAgICAgICAgICAgIGZpZWxkMS5zZXRTdHJh\ndGVneShuZXcgUmVsYXRpb25Db2xsZWN0aW9uVGFibGVGaWVsZFN0cmF0ZWd5\nKCksCiAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgaWYgKF9j\ndXN0b20gIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9jdXN0b20uY3VzdG9t\naXplKGZpZWxkMSk7CiAgICAgICAgfQoKICAgICAgICBuYW1lID0gZ2V0UmVs\nYXRpb25OYW1lKGNsczEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB0cnVlLCBma3Nb\nMF0sCiAgICAgICAgICAgIGZhbHNlLCBjbHMyKTsKICAgICAgICBGaWVsZE1h\ncHBpbmcgZmllbGQyID0gbmV3RmllbGRNYXBwaW5nKG5hbWUsIFNldC5jbGFz\ncywgbnVsbCwgZmtzWzBdLAogICAgICAgICAgICBjbHMyKTsKICAgICAgICBp\nZiAoZmllbGQyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgZmllbGQyLnNldEpvaW5Gb3JlaWduS2V5KGZrc1sxXSk7CiAgICAgICAg\nYWRkSm9pbkNvbnN0cmFpbnRzKGZpZWxkMik7CiAgICAgICAgVmFsdWVNYXBw\naW5nIHZtID0gZmllbGQyLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAg\ndm0uc2V0RGVjbGFyZWRUeXBlKGNsczEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nICAgICAgICB2bS5zZXRGb3JlaWduS2V5KGZrc1swXSk7CiAgICAgICAgYWRk\nQ29uc3RyYWludHModm0pOwogICAgICAgIGlmIChmaWVsZDEgIT0gbnVsbCAm\nJiBmaWVsZDEuZ2V0TWFwcGVkQnkoKSA9PSBudWxsKQogICAgICAgICAgICBm\naWVsZDIuc2V0TWFwcGVkQnkoZmllbGQxLmdldE5hbWUoKSk7CiAgICAgICAg\nZmllbGQyLnNldFN0cmF0ZWd5KG5ldyBSZWxhdGlvbkNvbGxlY3Rpb25UYWJs\nZUZpZWxkU3RyYXRlZ3koKSwgbnVsbCk7CiAgICAgICAgaWYgKF9jdXN0b20g\nIT0gbnVsbCkKICAgICAgICAgICAgX2N1c3RvbS5jdXN0b21pemUoZmllbGQy\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEF0dGVtcHQgdG8gcmV2ZXJzZSBt\nYXAgdGhlIGdpdmVuIHRhYmxlIGFzIGEgc2Vjb25kYXJ5IHRhYmxlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgbWFwU2Vjb25kYXJ5VGFibGUoVGFibGUg\ndGFibGUsIGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICBGb3JlaWduS2V5IGZr\nID0gZ2V0VW5pcXVlRm9yZWlnbktleSh0YWJsZSk7CiAgICAgICAgaWYgKGZr\nID09IG51bGwgJiYgdGFibGUuZ2V0Rm9yZWlnbktleXMoKS5sZW5ndGggPT0g\nMSkKICAgICAgICAgICAgZmsgPSB0YWJsZS5nZXRGb3JlaWduS2V5cygpWzBd\nOwogICAgICAgIGVsc2UgaWYgKGZrID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gKENsYXNzTWFwcGlu\nZykgX3RhYmxlcy5nZXQoZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCkpOwogICAg\nICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIG1hcENvbHVtbnMoY2xzLCB0YWJsZSwgZmssIG91dGVyKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1hcCB0aGUgY29sdW1ucyBvZiB0aGUgZ2l2ZW4g\ndGFibGUgdG8gZmllbGRzIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgbWFwQ29sdW1ucyhDbGFzc01hcHBpbmcgY2xzLCBU\nYWJsZSB0YWJsZSwgRm9yZWlnbktleSBqb2luLAogICAgICAgIGJvb2xlYW4g\nb3V0ZXIpIHsKICAgICAgICAvLyBmaXJzdCBtYXAgZm9yZWlnbiBrZXlzIHRv\nIHJlbGF0aW9ucwogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSB0YWJsZS5n\nZXRGb3JlaWduS2V5cygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZmtzW2ldICE9IGpv\naW4gJiYgZmtzW2ldICE9IGNscy5nZXRKb2luRm9yZWlnbktleSgpKQogICAg\nICAgICAgICAgICAgbWFwRm9yZWlnbktleShjbHMsIGZrc1tpXSwgam9pbiwg\nb3V0ZXIpOwoKICAgICAgICAvLyBtYXAgYW55IGNvbHVtbnMgbm90IGNvbnRy\nb2xsZWQgYnkgZm9yZWlnbiBrZXlzOyBhbHNvIGZvcmNlIHByaW1hcnkKICAg\nICAgICAvLyBrZXkgY29scyB0byBnZXQgbWFwcGVkIHRvIHNpbXBsZSBmaWVs\nZHMgZXZlbiBpZiB0aGUgY29sdW1ucyBhcmUKICAgICAgICAvLyBhbHNvIGZv\ncmVpZ24ga2V5IGNvbHVtbnMKICAgICAgICBQcmltYXJ5S2V5IHBrID0gKGpv\naW4gIT0gbnVsbCkgPyBudWxsIDogdGFibGUuZ2V0UHJpbWFyeUtleSgpOwog\nICAgICAgIGJvb2xlYW4gcGtjb2w7CiAgICAgICAgQ29sdW1uW10gY29scyA9\nIHRhYmxlLmdldENvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcGtjb2wgPSBw\nayAhPSBudWxsICYmIHBrLmNvbnRhaW5zQ29sdW1uKGNvbHNbaV0pOwogICAg\nICAgICAgICBpZiAocGtjb2wgJiYgY2xzLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWFwcGluZy5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgaWYgKChjbHMuZ2V0UENTdXBlcmNsYXNz\nKCkgPT0gbnVsbCAmJiBwa2NvbCkKICAgICAgICAgICAgICAgIHx8ICFpc0Zv\ncmVpZ25LZXlDb2x1bW4oY29sc1tpXSkpCiAgICAgICAgICAgICAgICBtYXBD\nb2x1bW4oY2xzLCBjb2xzW2ldLCBqb2luLCBvdXRlcik7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZ2l2ZW4gY29sdW1u\nIGFwcGVhcnMgaW4gYW55IGZvcmVpZ24ga2V5cy4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0ZvcmVpZ25LZXlDb2x1bW4oQ29sdW1u\nIGNvbCkgewogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSBjb2wuZ2V0VGFi\nbGUoKS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZmtzW2ld\nLmNvbnRhaW5zQ29sdW1uKGNvbCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYXAgYSBmb3JlaWduIGtleSB0byBhIHJlbGF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgbWFwRm9yZWlnbktleShDbGFzc01hcHBpbmcg\nY2xzLCBGb3JlaWduS2V5IGZrLAogICAgICAgIEZvcmVpZ25LZXkgam9pbiwg\nYm9vbGVhbiBvdXRlcikgewogICAgICAgIENsYXNzTWFwcGluZyByZWwgPSAo\nQ2xhc3NNYXBwaW5nKSBfdGFibGVzLmdldChmay5nZXRQcmltYXJ5S2V5VGFi\nbGUoKSk7CiAgICAgICAgaWYgKHJlbCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0UmVsYXRpb25OYW1l\nKHJlbC5nZXREZXNjcmliZWRUeXBlKCksIGZhbHNlLCBmaywKICAgICAgICAg\nICAgZmFsc2UsIGNscyk7CiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkMSA9\nIG5ld0ZpZWxkTWFwcGluZyhuYW1lLCByZWwuZ2V0RGVzY3JpYmVkVHlwZSgp\nLAogICAgICAgICAgICBudWxsLCBmaywgY2xzKTsKICAgICAgICBpZiAoZmll\nbGQxICE9IG51bGwpIHsKICAgICAgICAgICAgZmllbGQxLnNldEpvaW5Gb3Jl\naWduS2V5KGpvaW4pOwogICAgICAgICAgICBmaWVsZDEuc2V0Sm9pbk91dGVy\nKG91dGVyKTsKICAgICAgICAgICAgYWRkSm9pbkNvbnN0cmFpbnRzKGZpZWxk\nMSk7CiAgICAgICAgICAgIGZpZWxkMS5zZXRGb3JlaWduS2V5KGZrKTsKICAg\nICAgICAgICAgYWRkQ29uc3RyYWludHMoZmllbGQxKTsKICAgICAgICAgICAg\nZmllbGQxLnNldFN0cmF0ZWd5KG5ldyBSZWxhdGlvbkZpZWxkU3RyYXRlZ3ko\nKSwgbnVsbCk7CiAgICAgICAgICAgIGlmIChfY3VzdG9tICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfY3VzdG9tLmN1c3RvbWl6ZShmaWVsZDEpOwogICAg\nICAgIH0KICAgICAgICBpZiAoIV9pbnZlcnNlIHx8IGpvaW4gIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBjcmVhdGUgaW52ZXJz\nZSByZWxhdGlvbgogICAgICAgIGJvb2xlYW4gdW5xID0gaXNVbmlxdWUoZmsp\nOwogICAgICAgIG5hbWUgPSBnZXRSZWxhdGlvbk5hbWUoY2xzLmdldERlc2Ny\naWJlZFR5cGUoKSwgIXVucSwgZmssIHRydWUsIHJlbCk7CiAgICAgICAgQ2xh\nc3MgdHlwZSA9ICh1bnEpID8gY2xzLmdldERlc2NyaWJlZFR5cGUoKSA6IFNl\ndC5jbGFzczsKICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQyID0gbmV3Rmll\nbGRNYXBwaW5nKG5hbWUsIHR5cGUsIG51bGwsIGZrLCByZWwpOwogICAgICAg\nIGlmIChmaWVsZDIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIGlmIChmaWVsZDEgIT0gbnVsbCkKICAgICAgICAgICAgZmllbGQyLnNl\ndE1hcHBlZEJ5KGZpZWxkMS5nZXROYW1lKCkpOwogICAgICAgIGlmICh1bnEp\nIHsKICAgICAgICAgICAgZmllbGQyLnNldEZvcmVpZ25LZXkoZmspOwogICAg\nICAgICAgICBmaWVsZDIuc2V0Sm9pbkRpcmVjdGlvbihmaWVsZDIuSk9JTl9J\nTlZFUlNFKTsKICAgICAgICAgICAgZmllbGQyLnNldFN0cmF0ZWd5KG5ldyBS\nZWxhdGlvbkZpZWxkU3RyYXRlZ3koKSwgbnVsbCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgVmFsdWVNYXBwaW5nIHZtID0gZmllbGQyLmdldEVs\nZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgICAgIHZtLnNldERlY2xhcmVkVHlw\nZShjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgdm0uc2V0\nRm9yZWlnbktleShmayk7CiAgICAgICAgICAgIHZtLnNldEpvaW5EaXJlY3Rp\nb24odm0uSk9JTl9FWFBFQ1RFRF9JTlZFUlNFKTsKICAgICAgICAgICAgZmll\nbGQyLnNldFN0cmF0ZWd5KG5ldyBSZWxhdGlvbkNvbGxlY3Rpb25JbnZlcnNl\nS2V5RmllbGRTdHJhdGVneSgpLAogICAgICAgICAgICAgICAgbnVsbCk7CiAg\nICAgICAgfQogICAgICAgIGlmIChfY3VzdG9tICE9IG51bGwpCiAgICAgICAg\nICAgIF9jdXN0b20uY3VzdG9taXplKGZpZWxkMik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYXAgYSBjb2x1bW4gdG8gYSBzaW1wbGUgZmllbGQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBtYXBDb2x1bW4oQ2xhc3NNYXBwaW5nIGNs\ncywgQ29sdW1uIGNvbCwgRm9yZWlnbktleSBqb2luLAogICAgICAgIGJvb2xl\nYW4gb3V0ZXIpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGdldEZpZWxkTmFt\nZShjb2wuZ2V0TmFtZSgpLCBjbHMpOwogICAgICAgIENsYXNzIHR5cGUgPSBn\nZXRGaWVsZFR5cGUoY29sLCBmYWxzZSk7CiAgICAgICAgRmllbGRNYXBwaW5n\nIGZpZWxkID0gbmV3RmllbGRNYXBwaW5nKG5hbWUsIHR5cGUsIGNvbCwgbnVs\nbCwgY2xzKTsKICAgICAgICBmaWVsZC5zZXRTZXJpYWxpemVkKHR5cGUgPT0g\nT2JqZWN0LmNsYXNzKTsKICAgICAgICBmaWVsZC5zZXRKb2luRm9yZWlnbktl\neShqb2luKTsKICAgICAgICBmaWVsZC5zZXRKb2luT3V0ZXIob3V0ZXIpOwog\nICAgICAgIGFkZEpvaW5Db25zdHJhaW50cyhmaWVsZCk7CiAgICAgICAgZmll\nbGQuc2V0Q29sdW1ucyhuZXcgQ29sdW1uW117IGNvbCB9KTsKICAgICAgICBh\nZGRDb25zdHJhaW50cyhmaWVsZCk7CiAgICAgICAgaWYgKGNvbC5pc1ByaW1h\ncnlLZXkoKQogICAgICAgICAgICAmJiBjbHMuZ2V0SWRlbnRpdHlUeXBlKCkg\nIT0gQ2xhc3NNYXBwaW5nLklEX0RBVEFTVE9SRSkKICAgICAgICAgICAgZmll\nbGQuc2V0UHJpbWFyeUtleSh0cnVlKTsKCiAgICAgICAgRmllbGRTdHJhdGVn\neSBzdHJhdDsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQogICAg\nICAgICAgICBzdHJhdCA9IG5ldyBQcmltaXRpdmVGaWVsZFN0cmF0ZWd5KCk7\nCiAgICAgICAgZWxzZSBpZiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9C\nCiAgICAgICAgICAgICYmIF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNl\nKCkubWF4RW1iZWRkZWRDbG9iU2l6ZSAhPSAtMSkKICAgICAgICAgICAgc3Ry\nYXQgPSBuZXcgTWF4RW1iZWRkZWRDbG9iRmllbGRTdHJhdGVneSgpOwogICAg\nICAgIGVsc2UgaWYgKGNvbC5pc0xvYigpCiAgICAgICAgICAgICYmIF9jb25m\nLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCkubWF4RW1iZWRkZWRCbG9iU2l6\nZSAhPSAtMSkKICAgICAgICAgICAgc3RyYXQgPSBuZXcgTWF4RW1iZWRkZWRC\nbG9iRmllbGRTdHJhdGVneSgpOwogICAgICAgIGVsc2UgaWYgKHR5cGUgPT0g\nU3RyaW5nLmNsYXNzKQogICAgICAgICAgICBzdHJhdCA9IG5ldyBTdHJpbmdG\naWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdHJh\ndCA9IG5ldyBIYW5kbGVyRmllbGRTdHJhdGVneSgpOwogICAgICAgIGZpZWxk\nLnNldFN0cmF0ZWd5KHN0cmF0LCBudWxsKTsKICAgICAgICBpZiAoX2N1c3Rv\nbSAhPSBudWxsKQogICAgICAgICAgICBfY3VzdG9tLmN1c3RvbWl6ZShmaWVs\nZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBjbGFzcyBtYXBw\naW5nIGZvciB0aGUgZ2l2ZW4gdGFibGUsIG9yIHJldHVybiBudWxsIGlmCiAg\nICAgKiBjdXN0b21pemVyIHJlamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUg\nQ2xhc3NNYXBwaW5nIG5ld0NsYXNzTWFwcGluZyhUYWJsZSB0YWJsZSwgQ2xh\nc3MgcGFyZW50KSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBnZXRDbGFzc05h\nbWUodGFibGUpOwogICAgICAgIGlmIChfY3VzdG9tICE9IG51bGwpCiAgICAg\nICAgICAgIG5hbWUgPSBfY3VzdG9tLmdldENsYXNzTmFtZSh0YWJsZSwgbmFt\nZSk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgcmV0dXJuIG5ld0NsYXNzTWFwcGluZyhnZW5l\ncmF0ZUNsYXNzKG5hbWUsIHBhcmVudCksIHRhYmxlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIGZpZWxkIG1hcHBpbmcgZm9yIHRoZSBnaXZl\nbiBpbmZvLCBvciByZXR1cm4gbnVsbCBpZgogICAgICogY3VzdG9taXplciBy\nZWplY3RzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIG5ld0Zp\nZWxkTWFwcGluZyhTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSwgQ29sdW1uIGNv\nbCwKICAgICAgICBGb3JlaWduS2V5IGZrLCBDbGFzc01hcHBpbmcgZGVjKSB7\nCiAgICAgICAgaWYgKF9jdXN0b20gIT0gbnVsbCkgewogICAgICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gKGZrID09IG51bGwpID8gbmV3IENvbHVtbltdeyBj\nb2wgfQogICAgICAgICAgICAgICAgOiBmay5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgICAgIFN0cmluZyBuZXdOYW1lID0gX2N1c3RvbS5nZXRGaWVsZE5hbWUo\nZGVjLCBjb2xzLCBmaywgbmFtZSk7CiAgICAgICAgICAgIGlmIChuZXdOYW1l\nID09IG51bGwgfHwgIW5ld05hbWUuZXF1YWxzKG5hbWUpKSB7CiAgICAgICAg\nICAgICAgICBpZiAoX2FiYW5kb25lZEZpZWxkTmFtZXMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBfYWJhbmRvbmVkRmllbGROYW1lcyA9IG5ldyBI\nYXNoU2V0KCk7CiAgICAgICAgICAgICAgICBfYWJhbmRvbmVkRmllbGROYW1l\ncy5hZGQoZGVjLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkKICAgICAg\nICAgICAgICAgICAgICArICIuIiArIG5hbWUpOwogICAgICAgICAgICAgICAg\naWYgKG5ld05hbWUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICAgICAgICAgIG5hbWUgPSBuZXdOYW1lOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBGaWVsZE1hcHBpbmcgZmll\nbGQgPSBkZWMuYWRkRGVjbGFyZWRGaWVsZE1hcHBpbmcobmFtZSwgdHlwZSk7\nCiAgICAgICAgZmllbGQuc2V0RXhwbGljaXQodHJ1ZSk7CiAgICAgICAgcmV0\ndXJuIGZpZWxkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgSmF2\nYSBpZGVudGlmaWVyLWZvcm1hdHRlZCBuYW1lIGZvciB0aGUgZ2l2ZW4gdGFi\nbGUKICAgICAqIG5hbWUsIHVzaW5nIHRoZSBkZWZhdWx0IHBhY2thZ2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENsYXNzTmFtZShUYWJsZSB0\nYWJsZSkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5n\nQnVmZmVyKCk7CiAgICAgICAgaWYgKGdldFBhY2thZ2VOYW1lKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXRQYWNrYWdlTmFtZSgpKS5h\ncHBlbmQoIi4iKTsKCiAgICAgICAgU3RyaW5nW10gc3ViczsKICAgICAgICBT\ndHJpbmcgbmFtZSA9IHJlcGxhY2VJbnZhbGlkQ2hhcmFjdGVycyh0YWJsZS5n\nZXRTY2hlbWFOYW1lKCkpOwogICAgICAgIGlmIChfdXNlU2NoZW1hICYmIG5h\nbWUgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoYWxsVXBwZXJDYXNlKG5h\nbWUpKQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2Uo\nKTsKICAgICAgICAgICAgc3VicyA9IFN0cmluZ3Muc3BsaXQobmFtZSwgIl8i\nLCAwKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdWJzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChTdHJpbmdV\ndGlscy5jYXBpdGFsaXNlKHN1YnNbaV0pKTsKICAgICAgICB9CgogICAgICAg\nIG5hbWUgPSByZXBsYWNlSW52YWxpZENoYXJhY3RlcnModGFibGUuZ2V0TmFt\nZSgpKTsKICAgICAgICBpZiAoYWxsVXBwZXJDYXNlKG5hbWUpKQogICAgICAg\nICAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHN1YnMg\nPSBTdHJpbmdzLnNwbGl0KG5hbWUsICJfIiwgMCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdWJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIC8vIG1ha2Ugc3VyZSB0aGUgbmFtZSBjYW4ndCBjb25mbGljdCB3aXRoIGdl\nbmVyYXRlZCBpZCBjbGFzcyBuYW1lczsKICAgICAgICAgICAgLy8gaWYgdGhl\nIG5hbWUgd291bGQgZW5kIGluICdJZCcsIG1ha2UgaXQgZW5kIGluICdJZGVu\ndCcKICAgICAgICAgICAgaWYgKGkgPT0gc3Vicy5sZW5ndGggLSAxICYmIHN1\nYnNbaV0uZXF1YWxzSWdub3JlQ2FzZSgiaWQiKSkKICAgICAgICAgICAgICAg\nIHN1YnNbaV0gPSAiaWRlbnQiOwogICAgICAgICAgICBidWYuYXBwZW5kKFN0\ncmluZ1V0aWxzLmNhcGl0YWxpc2Uoc3Vic1tpXSkpOwogICAgICAgIH0KCiAg\nICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgZGVmYXVsdCBKYXZhIGlkZW50aWZpZXItZm9ybWF0\ndGVkIG5hbWUgZm9yIHRoZSBnaXZlbgogICAgICogY29sdW1uL3RhYmxlIG5h\nbWUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0RmllbGROYW1lKFN0\ncmluZyBuYW1lLCBDbGFzc01hcHBpbmcgZGVjKSB7CiAgICAgICAgbmFtZSA9\nIHJlcGxhY2VJbnZhbGlkQ2hhcmFjdGVycyhuYW1lKTsKICAgICAgICBpZiAo\nYWxsVXBwZXJDYXNlKG5hbWUpKQogICAgICAgICAgICBuYW1lID0gbmFtZS50\nb0xvd2VyQ2FzZSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbmFtZSA9\nIENoYXJhY3Rlci50b0xvd2VyQ2FzZShuYW1lLmNoYXJBdCgwKSkgKyBuYW1l\nLnN1YnN0cmluZygxKTsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5l\ndyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBTdHJpbmdbXSBzdWJzID0gU3Ry\naW5ncy5zcGxpdChuYW1lLCAiXyIsIDApOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\naSA+IDApCiAgICAgICAgICAgICAgICBzdWJzW2ldID0gU3RyaW5nVXRpbHMu\nY2FwaXRhbGlzZShzdWJzW2ldKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChz\ndWJzW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGdldFVuaXF1ZU5h\nbWUoYnVmLnRvU3RyaW5nKCksIGRlYyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBkZWZhdWx0IGphdmEgaWRlbnRpZmllci1mb3JtYXR0ZWQg\nZmllbGQgcmVsYXRpb24gbmFtZQogICAgICogZm9yIHRoZSBnaXZlbiBjbGFz\ncyBuYW1lLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBnZXRSZWxhdGlv\nbk5hbWUoQ2xhc3MgZmllbGRUeXBlLCBib29sZWFuIGNvbGwsCiAgICAgICAg\nRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBDbGFzc01hcHBpbmcg\nZGVjKSB7CiAgICAgICAgaWYgKF91c2VGSyAmJiBmay5nZXROYW1lKCkgIT0g\nbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgbmFtZSA9IGdldEZpZWxkTmFt\nZShmay5nZXROYW1lKCksIGRlYyk7CiAgICAgICAgICAgIGlmIChpbnZlcnNl\nICYmIGNvbGwpCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZSArICJJbnZl\ncnNlcyI7CiAgICAgICAgICAgIGVsc2UgaWYgKGludmVyc2UpCiAgICAgICAg\nICAgICAgICBuYW1lID0gbmFtZSArICJJbnZlcnNlIjsKICAgICAgICAgICAg\ncmV0dXJuIGdldFVuaXF1ZU5hbWUobmFtZSwgZGVjKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGdldCBqdXN0IHRoZSBjbGFzcyBuYW1lLCB3L28gcGFja2Fn\nZQogICAgICAgIFN0cmluZyBuYW1lID0gZmllbGRUeXBlLmdldE5hbWUoKTsK\nICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcobmFtZS5sYXN0SW5kZXhP\nZignLicpICsgMSk7CgogICAgICAgIC8vIG1ha2UgdGhlIGZpcnN0IGNoYXJh\nY3RlciBsb3dlcmNhc2UgYW5kIHBsdXJhbGl6ZSBpZiBhIGNvbGxlY3Rpb24K\nICAgICAgICBuYW1lID0gQ2hhcmFjdGVyLnRvTG93ZXJDYXNlKG5hbWUuY2hh\nckF0KDApKSArIG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIGlmIChjb2xs\nICYmICFuYW1lLmVuZHNXaXRoKCJzIikpCiAgICAgICAgICAgIG5hbWUgKz0g\nInMiOwoKICAgICAgICByZXR1cm4gZ2V0VW5pcXVlTmFtZShuYW1lLCBkZWMp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdp\ndmVuIHN0cmluZyBpcyBhbGwgdXBwZXJjYXNlIGxldHRlcnMuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gYWxsVXBwZXJDYXNlKFN0cmlu\nZyBzdHIpIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0ci5sZW5n\ndGgoKTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChDaGFyYWN0ZXIuaXNMZXR0\nZXIoc3RyLmNoYXJBdChpKSkKICAgICAgICAgICAgICAgICYmICFDaGFyYWN0\nZXIuaXNVcHBlckNhc2Uoc3RyLmNoYXJBdChpKSkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSBjaGFyYWN0ZXJzIG5v\ndCBhbGxvd2VkIGluIEphdmEgbmFtZXMgd2l0aCBhbiB1bmRlcnNjb3JlOwog\nICAgICogcGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgogICAgICovCiAg\nICBzdGF0aWMgU3RyaW5nIHJlcGxhY2VJbnZhbGlkQ2hhcmFjdGVycyhTdHJp\nbmcgc3RyKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3Ry\nKSkKICAgICAgICAgICAgcmV0dXJuIHN0cjsKCiAgICAgICAgU3RyaW5nQnVm\nZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoc3RyKTsKICAgICAgICBjaGFy\nIGM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBidWYubGVuZ3RoKCk7\nIGkrKykgewogICAgICAgICAgICBjID0gYnVmLmNoYXJBdChpKTsKICAgICAg\nICAgICAgaWYgKGMgPT0gJyQnIHx8ICFDaGFyYWN0ZXIuaXNKYXZhSWRlbnRp\nZmllclBhcnQoc3RyLmNoYXJBdChpKSkpCiAgICAgICAgICAgICAgICBidWYu\nc2V0Q2hhckF0KGksICdfJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBzdHJp\ncCBsZWFkaW5nIGFuZCB0cmFpbGluZyB1bmRlcnNjb3JlcwogICAgICAgIGlu\ndCBzdGFydCA9IDA7CiAgICAgICAgd2hpbGUgKHN0YXJ0IDwgYnVmLmxlbmd0\naCgpICYmIGJ1Zi5jaGFyQXQoc3RhcnQpID09ICdfJykKICAgICAgICAgICAg\nc3RhcnQrKzsKICAgICAgICBpbnQgZW5kID0gYnVmLmxlbmd0aCgpIC0gMTsK\nICAgICAgICB3aGlsZSAoZW5kID49IDAgJiYgYnVmLmNoYXJBdChlbmQpID09\nICdfJykKICAgICAgICAgICAgZW5kLS07CgogICAgICAgIC8vIHBvc3NpYmxl\nIHRoYXQgYWxsIGNoYXJzIGluIG5hbWUgYXJlIGludmFsaWQKICAgICAgICBp\nZiAoc3RhcnQgPiBlbmQpCiAgICAgICAgICAgIHJldHVybiAieCI7CiAgICAg\nICAgcmV0dXJuIGJ1Zi5zdWJzdHJpbmcoc3RhcnQsIGVuZCArIDEpOwogICAg\nfQoKICAgIC8qKgogICAgICogTW9kaWZpZXMgdGhlIGdpdmVuIG5hbWUgYXMg\nbmVjZXNzYXJ5IHRvIGVuc3VyZSB0aGF0IGl0IGlzbid0IGFscmVhZHkKICAg\nICAqIHRha2VuIGJ5IGEgZmllbGQgaW4gdGhlIGdpdmVuIHBhcmVudC4KICAg\nICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0VW5pcXVlTmFtZShTdHJpbmcg\nbmFtZSwgQ2xhc3NNYXBwaW5nIGRlYykgewogICAgICAgIC8vIG1ha2Ugc3Vy\nZSB0aGUgbmFtZSBpc24ndCBhIGtleXdvcmQKICAgICAgICBpZiAoX2phdmFL\nZXl3b3Jkcy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAgICAgbmFtZSA9\nIChTdHJpbmcpIF9qYXZhS2V5d29yZHMuZ2V0KG5hbWUpOwoKICAgICAgICAv\nLyB0aGlzIGlzIHRoZSBzYW1lIGFsZ29yaXRobSB1c2VkIGluIERCRGljdGlv\nbmFyeSB0byBnZXQgdW5pcXVlIG5hbWVzCiAgICAgICAgU3RyaW5nIHByZWZp\neCA9IGRlYy5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpICsgIi4iOwog\nICAgICAgIGZvciAoaW50IHZlcnNpb24gPSAyLCBjaGFycyA9IDE7CiAgICAg\nICAgICAgIGRlYy5nZXREZWNsYXJlZEZpZWxkKG5hbWUpICE9IG51bGwKICAg\nICAgICAgICAgICAgIHx8IChfYWJhbmRvbmVkRmllbGROYW1lcyAhPSBudWxs\nCiAgICAgICAgICAgICAgICAmJiBfYWJhbmRvbmVkRmllbGROYW1lcy5jb250\nYWlucyhwcmVmaXggKyBuYW1lKSk7IHZlcnNpb24rKykgewogICAgICAgICAg\nICBpZiAodmVyc2lvbiA+IDIpCiAgICAgICAgICAgICAgICBuYW1lID0gbmFt\nZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGgoKSAtIGNoYXJzKTsKICAgICAg\nICAgICAgaWYgKHZlcnNpb24gPj0gTWF0aC5wb3coMTAsIGNoYXJzKSkKICAg\nICAgICAgICAgICAgIGNoYXJzKys7CiAgICAgICAgICAgIG5hbWUgPSBuYW1l\nICsgdmVyc2lvbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hbWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRlZmF1bHQgZmllbGQg\ndHlwZSBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzIGdldEZpZWxkVHlwZShDb2x1bW4gY29sLCBib29sZWFuIGZvcmNl\nT2JqZWN0KSB7CiAgICAgICAgLy8gY2hlY2sgdGhlIGN1c3RvbSB0eXBlIG1h\ncCB0byBzZWUgaWYgd2UndmUgb3ZlcnJpZGRlbiB0aGUKICAgICAgICAvLyBk\nZWZhdWx0IHR5cGUgdG8gY3JlYXRlIGZvciBhIHJhdyBTUUwgdHlwZSBuYW1l\nCiAgICAgICAgQ2xhc3MgdHlwZSA9IG51bGw7CiAgICAgICAgaWYgKF90eXBl\nTWFwICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gZmlyc3QgdHJ5ICJUWVBF\nKFNJWkUsREVDSU1BTFMpIiwgdGhlbiAiVFlQRShTSVpFKSwgdGhlbiAiVFlQ\nRSIKICAgICAgICAgICAgU3RyaW5nW10gcHJvcE5hbWVzID0gbmV3IFN0cmlu\nZ1tdewogICAgICAgICAgICAgICAgY29sLmdldFR5cGVOYW1lKCkgKyAiKCIg\nKyBjb2wuZ2V0U2l6ZSgpICsgIiwiCiAgICAgICAgICAgICAgICAgICAgKyBj\nb2wuZ2V0RGVjaW1hbERpZ2l0cygpICsgIikiLAogICAgICAgICAgICAgICAg\nY29sLmdldFR5cGVOYW1lKCkgKyAiKCIgKyBjb2wuZ2V0U2l6ZSgpICsgIiki\nLAogICAgICAgICAgICAgICAgY29sLmdldFR5cGVOYW1lKCkKICAgICAgICAg\nICAgfTsKCiAgICAgICAgICAgIFN0cmluZyB0eXBlTmFtZSA9IG51bGw7CiAg\nICAgICAgICAgIFN0cmluZyB0eXBlU3BlYyA9IG51bGw7CiAgICAgICAgICAg\nIGludCBuYW1lSWR4ID0gMDsKICAgICAgICAgICAgZm9yICg7IHR5cGVTcGVj\nID09IG51bGwgJiYgbmFtZUlkeCA8IHByb3BOYW1lcy5sZW5ndGg7IG5hbWVJ\nZHgrKykgewogICAgICAgICAgICAgICAgaWYgKHByb3BOYW1lc1tuYW1lSWR4\nXSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgIHR5cGVTcGVjID0gU3RyaW5nVXRpbHMudHJpbVRvTnVs\nbChfdHlwZU1hcC5nZXRQcm9wZXJ0eQogICAgICAgICAgICAgICAgICAgIChw\ncm9wTmFtZXNbbmFtZUlkeF0pKTsKICAgICAgICAgICAgICAgIGlmICh0eXBl\nU3BlYyAhPSBudWxsKSAKICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZSA9\nIHByb3BOYW1lc1tuYW1lSWR4XTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAodHlwZVNwZWMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9sb2cu\naW5mbyhfbG9jLmdldCgicmV2ZXJzZS10eXBlIiwgdHlwZU5hbWUsIHR5cGVT\ncGVjKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoIm5vLXJldmVyc2UtdHlwZSIsCiAgICAgICAgICAg\nICAgICAgICAgcHJvcE5hbWVzW3Byb3BOYW1lcy5sZW5ndGggLSAxXSkpOwoK\nICAgICAgICAgICAgaWYgKHR5cGVTcGVjICE9IG51bGwpCiAgICAgICAgICAg\nICAgICB0eXBlID0gU3RyaW5ncy50b0NsYXNzKHR5cGVTcGVjLCBfY29uZi4K\nICAgICAgICAgICAgICAgICAgICBnZXRDbGFzc1Jlc29sdmVySW5zdGFuY2Uo\nKS5nZXRDbGFzc0xvYWRlcgogICAgICAgICAgICAgICAgICAgIChSZXZlcnNl\nTWFwcGluZ1Rvb2wuY2xhc3MsIG51bGwpKTsKICAgICAgICB9CgogICAgICAg\nIGlmICh0eXBlID09IG51bGwpCiAgICAgICAgICAgIHR5cGUgPSBTY2hlbWFz\nLmdldEphdmFUeXBlKGNvbC5nZXRUeXBlKCksIGNvbC5nZXRTaXplKCksCiAg\nICAgICAgICAgICAgICBjb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAgICAg\nICBpZiAodHlwZSA9PSBPYmplY3QuY2xhc3MpIHsKICAgICAgICAgICAgaWYg\nKCFfYmxvYkFzT2JqKQogICAgICAgICAgICAgICAgcmV0dXJuIGJ5dGVbXS5j\nbGFzczsKICAgICAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAgICAgfQoKICAg\nICAgICAvLyB0cmVhdCBjaGFycyBzcGVjaWFsbHk7IGlmIHRoZSBkaWN0aW9u\nYXJ5IGhhcyBzdG9yZUNoYXJzQXNOdW1iZXJzCiAgICAgICAgLy8gc2V0LCB0\naGVuIHdlIGNhbid0IHJldmVyc2UgbWFwIGludG8gYSBjaGFyOyB1c2UgYSBz\ndHJpbmcgYW5kIHRlbGwKICAgICAgICAvLyB0aGUgdXNlciB3aHkgd2UgYXJl\nIGRvaW5nIHNvCiAgICAgICAgaWYgKHR5cGUgPT0gY2hhci5jbGFzcwogICAg\nICAgICAgICAmJiBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpLnN0\nb3JlQ2hhcnNBc051bWJlcnMpIHsKICAgICAgICAgICAgdHlwZSA9IFN0cmlu\nZy5jbGFzczsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJjYW50LXVz\nZS1jaGFyIiwgY29sLmdldEZ1bGxOYW1lKCkpKTsKICAgICAgICB9CgogICAg\nICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICByZXR1\ncm4gdHlwZTsKICAgICAgICBpZiAoIWZvcmNlT2JqZWN0ICYmIChjb2wuaXNO\nb3ROdWxsKCkgfHwgIV9udWxsQXNPYmopKQogICAgICAgICAgICByZXR1cm4g\ndHlwZTsKCiAgICAgICAgLy8gY29udmVydCB0aGUgdHlwZSBpbnRvIHRoZSBh\ncHByb3ByaWF0ZSB3cmFwcGVyIGNsYXNzCiAgICAgICAgc3dpdGNoICh0eXBl\nLmdldE5hbWUoKS5jaGFyQXQoMCkpIHsKICAgICAgICAgICAgY2FzZSdiJzoK\nICAgICAgICAgICAgICAgIGlmICh0eXBlID09IGJvb2xlYW4uY2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uY2xhc3M7CiAgICAg\nICAgICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAgICAgY2Fz\nZSdjJzoKICAgICAgICAgICAgICAgIHJldHVybiBDaGFyYWN0ZXIuY2xhc3M7\nCiAgICAgICAgICAgIGNhc2UnZCc6CiAgICAgICAgICAgICAgICByZXR1cm4g\nRG91YmxlLmNsYXNzOwogICAgICAgICAgICBjYXNlJ2YnOgogICAgICAgICAg\nICAgICAgcmV0dXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlJ2kn\nOgogICAgICAgICAgICAgICAgcmV0dXJuIEludGVnZXIuY2xhc3M7CiAgICAg\nICAgICAgIGNhc2UnbCc6CiAgICAgICAgICAgICAgICByZXR1cm4gTG9uZy5j\nbGFzczsKICAgICAgICAgICAgY2FzZSdzJzoKICAgICAgICAgICAgICAgIHJl\ndHVybiBTaG9ydC5jbGFzczsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyB0b29s\nIHdpdGggdGhlIHNhbWUgc2V0dGluZ3MgYXMgdGhpcyBvbmUuIFVzZWQgaW4g\nd29ya2JlbmNoLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkg\newogICAgICAgIFJldmVyc2VNYXBwaW5nVG9vbCB0b29sID0gbmV3IFJldmVy\nc2VNYXBwaW5nVG9vbChfY29uZik7CiAgICAgICAgdG9vbC5zZXRTY2hlbWFH\ncm91cChnZXRTY2hlbWFHcm91cCgpKTsKICAgICAgICB0b29sLnNldFBhY2th\nZ2VOYW1lKGdldFBhY2thZ2VOYW1lKCkpOwogICAgICAgIHRvb2wuc2V0RGly\nZWN0b3J5KGdldERpcmVjdG9yeSgpKTsKICAgICAgICB0b29sLnNldFVzZVNj\naGVtYU5hbWUoZ2V0VXNlU2NoZW1hTmFtZSgpKTsKICAgICAgICB0b29sLnNl\ndFVzZUZvcmVpZ25LZXlOYW1lKGdldFVzZUZvcmVpZ25LZXlOYW1lKCkpOwog\nICAgICAgIHRvb2wuc2V0TnVsbGFibGVBc09iamVjdChnZXROdWxsYWJsZUFz\nT2JqZWN0KCkpOwogICAgICAgIHRvb2wuc2V0QmxvYkFzT2JqZWN0KGdldEJs\nb2JBc09iamVjdCgpKTsKICAgICAgICB0b29sLnNldFVzZUdlbmVyaWNDb2xs\nZWN0aW9ucyhnZXRVc2VHZW5lcmljQ29sbGVjdGlvbnMoKSk7CiAgICAgICAg\ndG9vbC5zZXRQcmltYXJ5S2V5T25Kb2luKGdldFByaW1hcnlLZXlPbkpvaW4o\nKSk7CiAgICAgICAgdG9vbC5zZXRVc2VEYXRhU3RvcmVJZGVudGl0eShnZXRV\nc2VEYXRhU3RvcmVJZGVudGl0eSgpKTsKICAgICAgICB0b29sLnNldFVzZUJ1\naWx0aW5JZGVudGl0eUNsYXNzKGdldFVzZUJ1aWx0aW5JZGVudGl0eUNsYXNz\nKCkpOwogICAgICAgIHRvb2wuc2V0SW5uZXJJZGVudGl0eUNsYXNzZXMoZ2V0\nSW5uZXJJZGVudGl0eUNsYXNzZXMoKSk7CiAgICAgICAgdG9vbC5zZXRJZGVu\ndGl0eUNsYXNzU3VmZml4KGdldElkZW50aXR5Q2xhc3NTdWZmaXgoKSk7CiAg\nICAgICAgdG9vbC5zZXRJbnZlcnNlUmVsYXRpb25zKGdldEludmVyc2VSZWxh\ndGlvbnMoKSk7CiAgICAgICAgdG9vbC5zZXREZXRhY2hhYmxlKGdldERldGFj\naGFibGUoKSk7CiAgICAgICAgdG9vbC5zZXRHZW5lcmF0ZUFubm90YXRpb25z\nKGdldEdlbmVyYXRlQW5ub3RhdGlvbnMoKSk7CiAgICAgICAgdG9vbC5zZXRD\ndXN0b21pemVyKGdldEN1c3RvbWl6ZXIoKSk7CiAgICAgICAgdG9vbC5zZXRD\nb2RlRm9ybWF0KGdldENvZGVGb3JtYXQoKSk7CiAgICAgICAgcmV0dXJuIHRv\nb2w7CiAgICB9CgogICAgLy8vLy8vLy8KICAgIC8vIE1haW4KICAgIC8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLlJldmVyc2VNYXBwaW5nVG9vbAogICAgICogW29w\ndGlvbl0qICZsdDsuc2NoZW1hIGZpbGUgb3IgcmVzb3VyY2UmZ3Q7KgogICAg\nICogIFdoZXJlIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgcmVjb2duaXpl\nZC4KICAgICAqIDx1bD4KICAgICAqIDxsaT48aT4tcHJvcGVydGllcy8tcCAm\nbHQ7cHJvcGVydGllcyBmaWxlIG9yIHJlc291cmNlJmd0OzwvaT46IFRoZQog\nICAgICogcGF0aCBvciByZXNvdXJjZSBuYW1lIG9mIGEgT3BlbkpQQSBwcm9w\nZXJ0aWVzIGZpbGUgY29udGFpbmluZwogICAgICogaW5mb3JtYXRpb24gc3Vj\naCBhcyB0aGUgbGljZW5zZSBrZXkJZGF0YSBhcyBvdXRsaW5lZCBpbgogICAg\nICoge0BsaW5rIE9wZW5KUEFDb25maWd1cmF0aW9ufS4gT3B0aW9uYWwuPC9s\naT4KICAgICAqIDxsaT48aT4tJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7ICZsdDtw\ncm9wZXJ0eSB2YWx1ZSZndDs8L2k+OiBBbGwgYmVhbgogICAgICogcHJvcGVy\ndGllcyBvZiB0aGUgT3BlbkpQQSB7QGxpbmsgSkRCQ0NvbmZpZ3VyYXRpb259\nIGNhbiBiZSBzZXQgYnkKICAgICAqIHVzaW5nIHRoZWlyCW5hbWVzIGFuZCBz\ndXBwbHlpbmcgYSB2YWx1ZS4gRm9yIGV4YW1wbGU6CiAgICAgKiA8Y29kZT4t\nbGljZW5zZUtleSBhZHNsZmphODNyM2xrYWRmPC9jb2RlPjwvbGk+CiAgICAg\nKiA8bGk+PGk+LXNjaGVtYXMvLXMgJmx0O3NjaGVtYXMgYW5kIHRhYmxlcyZn\ndDs8L2k+OiBDb21tYS1zZXBhcmF0ZWQKICAgICAqIGxpc3Qgb2Ygc2NoZW1h\ncyBhbmQgdGFibGVzIHRvIHJldmVyc2UtbWFwLjwvbGk+CiAgICAgKiA8bGk+\nPGk+LXBhY2thZ2UvLXBrZyAmbHQ7cGFja2FnZSBuYW1lJmd0OzwvaT46IFRo\nZSBuYW1lIG9mIHRoZSBwYWNrYWdlCiAgICAgKiBmb3IgYWxsIGdlbmVyYXRl\nZCBjbGFzc2VzLiBEZWZhdWx0cyB0byBubyBwYWNrYWdlLjwvbGk+CiAgICAg\nKiA8bGk+PGk+LWRpcmVjdG9yeS8tZCAmbHQ7b3V0cHV0IGRpcmVjdG9yeSZn\ndDs8L2k+OiBUaGUgZGlyZWN0b3J5IHdoZXJlCiAgICAgKiBhbGwgZ2VuZXJh\ndGVkIGNvZGUgc2hvdWxkIGJlIHBsYWNlZC4gRGVmYXVsdHMgdG8gdGhlIGN1\ncnJlbnQKICAgICAqIGRpcmVjdG9yeS48L2xpPgogICAgICogPGxpPjxpPi11\nc2VTY2hlbWFOYW1lLy1zbiAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+\nOiBTZXQgdGhpcyBmbGFnIHRvCiAgICAgKiB0cnVlIHRvIGluY2x1ZGUgdGhl\nIHNjaGVtYSBuYW1lIGFzIHBhcnQgb2YgdGhlIGdlbmVyYXRlZCBjbGFzcyBu\nYW1lCiAgICAgKiBmb3IgZWFjaCB0YWJsZS48L2xpPgogICAgICogPGxpPjxp\nPi11c2VGb3JlaWduS2V5TmFtZS8tZmtuICZsdDt0cnVlL3QgfCBmYWxzZS9m\nJmd0OzwvaT46IFNldCB0aGlzCiAgICAgKiBmbGFnIHRvIHRydWUgdG8gdXNl\nIHRoZSBmb3JlaWduIGtleSBuYW1lIHRvIGdlbmVyYXRlIGZpZWxkcwogICAg\nICogcmVwcmVzZW50aW5nIHJlbGF0aW9ucyBiZXR3ZWVuIGNsYXNzZXMuPC9s\naT4KICAgICAqIDxsaT48aT4tbnVsbGFibGVBc09iamVjdC8tbm8gJmx0O3Ry\ndWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogU2V0IHRvIHRydWUKICAgICAqIHRv\nIG1ha2UgYWxsIG51bGxhYmxlIGNvbHVtbnMgbWFwIHRvIG9iamVjdCB0eXBl\nczsgY29sdW1ucyB0aGF0IHdvdWxkCiAgICAgKiBub3JtYWxseSBtYXAgdG8g\nYSBwcmltaXRpdmUgd2lsbCBtYXAgdG8gdGhlIGFwcHJvcHJpYXRlIHdyYXBw\nZXIKICAgICAqIHR5cGUgaW5zdGVhZC48L2xpPgogICAgICogPGxpPjxpPi1i\nbG9iQXNPYmplY3QvLWJvICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46\nIFNldCB0byB0cnVlCiAgICAgKiB0byBtYWtlIGFsbCBiaW5hcnkgY29sdW1u\ncyBtYXAgdG8gT2JqZWN0IHJhdGhlciB0aGFuIGJ5dGVbXS48L2xpPgogICAg\nICogPGxpPjxpPi11c2VHZW5lcmljQ29sbGVjdGlvbnMvLWdjICZsdDt0cnVl\nL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0bwogICAgICogdHJ1ZSB0byB1\nc2UgZ2VuZXJpYyBjb2xsZWN0aW9ucyBvbiBPbmVUb01hbnkgYW5kIE1hbnlU\nb01hbnkgcmVsYXRpb25zCiAgICAgKiAocmVxdWlyZXMgSkRLIDEuNSBvciBo\naWdoZXIpLjwvbGk+CiAgICAgKiA8bGk+PGk+LXR5cGVNYXAvLXR5cCAmbHQ7\ndHlwZXMmZ3Q7PC9pPjogRGVmYXVsdCBtYXBwaW5nIG9mIFNRTCB0eXBlCiAg\nICAgKiBuYW1lcyB0byBKYXZhIGNsYXNzZXMuPC9saT4KICAgICAqIDxsaT48\naT4tcHJpbWFyeUtleU9uSm9pbi8tcGtqICZsdDt0cnVlL3QgfCBmYWxzZS9m\nJmd0OzwvaT46IFNldCB0byB0cnVlCiAgICAgKiB0byBhbGxvdyBwcmltYXJ5\nIGtleXMgb24gam9pbiB0YWJsZXMuPC9saT4KICAgICAqIDxsaT48aT4tdXNl\nRGF0YXN0b3JlSWRlbnRpdHkvLWRzICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0\nOzwvaT46IFNldCB0bwogICAgICogdHJ1ZSB0byB1c2UgZGF0YXN0b3JlIGlk\nZW50aXR5IHdoZXJlIHBvc3NpYmxlLjwvbGk+CiAgICAgKiA8bGk+PGk+LXVz\nZUJ1aWx0aW5JZGVudGl0eUNsYXNzLy1iaWMgJmx0O3RydWUvdCB8IGZhbHNl\nL2YmZ3Q7PC9pPjogU2V0CiAgICAgKiB0byBmYWxzZSB0byBuZXZlciB1c2Ug\nT3BlbkpQQSdzIGJ1aWx0aW4gYXBwbGljYXRpb24gaWRlbnRpdHkKICAgICAq\nIGNsYXNzZXMuPC9saT4KICAgICAqIDxsaT48aT4taW5uZXJJZGVudGl0eUNs\nYXNzZXMvLWlubiAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBTZXQg\ndG8KICAgICAqIHRydWUgdG8gZ2VuZXJhdGUgdGhlIGFwcGxpY2F0aW9uIGlk\nZW50aXR5IGNsYXNzZXMgYXMgaW5uZXIgY2xhc3Nlcy48L2xpPgogICAgICog\nPGxpPjxpPi1pZGVudGl0eUNsYXNzU3VmZml4Ly1pcyAmbHQ7c3VmZml4Jmd0\nOzwvaT46IFN1ZmZpeCB0byBhcHBlbmQKICAgICAqIHRvIGNsYXNzIG5hbWVz\nIHRvIGNyZWF0ZSBpZGVudGl0eSBjbGFzcyBuYW1lLCBvciBmb3IgaW5uZXIg\naWRlbnRpdHkKICAgICAqIGNsYXNzZXMsIHRoZSBpbm5lciBjbGFzcyBuYW1l\nLjwvbGk+CiAgICAgKiA8bGk+PGk+LWludmVyc2VSZWxhdGlvbnMvLWlyICZs\ndDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0bwogICAgICogZmFs\nc2UgdG8gcHJldmVudCB0aGUgY3JlYXRpb24gb2YgaW52ZXJzZSAxLW1hbnkv\nMS0xIHJlbGF0aW9ucyBmb3IKICAgICAqIGVhY2ggZW5jb3VudGVyZWQgbWFu\neS0xLzEtMSByZWxhdGlvbi48L2xpPgogICAgICogPGxpPjxpPi1kZXRhY2hh\nYmxlLy1kZXQgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogU2V0IHRv\nCiAgICAgKiB0cnVlIHRvIG1ha2UgZ2VuZXJhdGVkIGNsYXNzZXMgZGV0YWNo\nYWJsZS48L2xpPgogICAgICogPGxpPjxpPi1kaXNjcmltaW5hdG9yU3RyYXRl\nZ3kvLWRzICZsdDtzdHJhdGVneSZndDs8L2k+OiBUaGUgZGVmYXVsdAogICAg\nICogZGlzY3JpbWluYXRvciBzdHJhdGVneSB0byBwbGFjZSBvbiBiYXNlIGNs\nYXNzZXMuPC9saT4KICAgICAqIDxsaT48aT4tdmVyc2lvblN0cmF0ZWd5Ly12\ncyAmbHQ7c3RyYXRlZ3kmZ3Q7PC9pPjogVGhlIGRlZmF1bHQKICAgICAqIHZl\ncnNpb24gc3RyYXRlZ3kgdG8gcGxhY2Ugb24gYmFzZSBjbGFzc2VzLjwvbGk+\nCiAgICAgKiA8bGk+PGk+LW1ldGFkYXRhLy1tZCAmbHQ7Y2xhc3MgfCBwYWNr\nYWdlIHwgbm9uZSZndDs8L2k+OiBTcGVjaWZ5IHRoZQogICAgICogbGV2ZWwg\ndGhlIG1ldGFkYXRhIHNob3VsZCBiZSBnZW5lcmF0ZWQgYXQuIERlZmF1bHRz\nIHRvIGdlbmVyYXRpbmcgYQogICAgICogc2luZ2xlIHBhY2thZ2UtbGV2ZWwg\nbWV0YWRhdGEgZmlsZS48L2xpPgogICAgICogPGxpPjxpPi1hbm5vdGF0aW9u\ncy8tYW5uICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0byB0\ncnVlIHRvCiAgICAgKiBnZW5lcmF0ZSBKUEEgYW5ub3RhdGlvbnMgaW4gZ2Vu\nZXJhdGVkIGNvZGUuPC9saT4KICAgICAqIDxsaT48aT4tYWNjZXNzVHlwZS8t\nYWNjZXNzICZsdDtmaWVsZCB8IHByb3BlcnR5Jmd0OzwvaT46IENoYW5nZSBh\nY2Nlc3MKICAgICAqIHR5cGUgZm9yIGdlbmVyYXRlZCBhbm5vdGF0aW9ucy4g\nRGVmYXVsdHMgdG8gZmllbGQgYWNjZXNzLjwvbGk+CiAgICAgKiA8bGk+PGk+\nLWN1c3RvbWl6ZXJDbGFzcy8tY2MgJmx0O2NsYXNzIG5hbWUmZ3Q7PC9pPjog\nVGhlIGZ1bGwgY2xhc3MKICAgICAqIG5hbWUgb2YgYSB7QGxpbmsgUmV2ZXJz\nZUN1c3RvbWl6ZXJ9IGltcGxlbWVudGF0aW9uIHRvIHVzZSB0bwogICAgICog\nY3VzdG9taXplIHRoZSByZXZlcnNlIG1hcHBpbmcgcHJvY2Vzcy4gT3B0aW9u\nYWwuPC9saT4KICAgICAqIDxsaT48aT4tY3VzdG9taXplclByb3BlcnRpZXMv\nLWNwICZsdDtwcm9wZXJ0aWVzIGZpbGUgb3IgcmVzb3VyY2UmZ3Q7PC9pPgog\nICAgICogOiBUaGUgcGF0aCBvciByZXNvdXJjZSBuYW1lIG9mIGEgcHJvcGVy\ndGllcyBmaWxlIHRoYXQgd2lsbCBiZQogICAgICogcGFzc2VkIHRvIHRoZSBy\nZXZlcnNlIGN1c3RvbWl6ZXIgb24gaW5pdGlhbGl6YXRpb24uIE9wdGlvbmFs\nLjwvbGk+CiAgICAgKiA8bGk+PGk+LWN1c3RvbWl6ZXIvLWMuJmx0O3Byb3Bl\ncnR5IG5hbWUmZ3Q7ICZsdDsgcHJvcGVydHkgdmFsdWUmZ3Q7PC9pPgogICAg\nICogOiBBcmd1bWVudHMgbGlrZSB0aGlzIHdpbGwgYmUgdXNlZCB0byBjb25m\naWd1cmUgdGhlIGJlYW4KICAgICAqIHByb3BlcnRpZXMgb2YgdGhlIHtAbGlu\nayBSZXZlcnNlQ3VzdG9taXplcn0uPC9saT4KICAgICAqIDxsaT48aT4tY29k\nZUZvcm1hdC8tY2YuJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7ICZsdDsgcHJvcGVy\ndHkgdmFsdWUmZ3Q7PC9pPgogICAgICogOiBBcmd1bWVudHMgbGlrZSB0aGlz\nIHdpbGwgYmUgdXNlZCB0byBjb25maWd1cmUgdGhlIGJlYW4KICAgICAqIHBy\nb3BlcnRpZXMgb2YgdGhlIGludGVybmFsIHtAbGluayBDb2RlRm9ybWF0fS48\nL2xpPgogICAgICogPC91bD4KICAgICAqICBFYWNoIHNjaGVtYSBnaXZlbiBh\ncyBhbiBhcmd1bWVudCB3aWxsIGJlIHJldmVyc2UtbWFwcGVkIGludG8KICAg\nICAqIHBlcnNpc3RlbnQgY2xhc3NlcyBhbmQgYXNzb2NpYXRlZCBtZXRhZGF0\nYS4gSWYgbm8gYXJndW1lbnRzIGFyZSBnaXZlbiwKICAgICAqIHRoZSBkYXRh\nYmFzZSBzY2hlbWFzIGRlZmluZWQgYnkgdGhlIHN5c3RlbSBjb25maWd1cmF0\naW9uIHdpbGwgYmUKICAgICAqIHJldmVyc2UtbWFwcGVkLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIGZpbmFs\nIFN0cmluZ1tdIGFyZ3VtZW50cyA9IG9wdHMuc2V0RnJvbUNtZExpbmUoYXJn\ncyk7CiAgICAgICAgYm9vbGVhbiByZXQgPSBDb25maWd1cmF0aW9ucy5ydW5B\nZ2FpbnN0QWxsQW5jaG9ycyhvcHRzLAogICAgICAgICAgICBuZXcgQ29uZmln\ndXJhdGlvbnMuUnVubmFibGUoKSB7CiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIHJ1bihPcHRpb25zIG9wdHMpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBKREJD\nQ29uZmlndXJhdGlvbkltcGwoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIFJldmVyc2VNYXBwaW5nVG9vbC5y\ndW4oY29uZiwgYXJndW1lbnRzLCBvcHRzKTsKICAgICAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgY29uZi5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAg\nICAgICAgaWYgKCFyZXQpCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRs\nbihfbG9jLmdldCgicmV2dG9vbC11c2FnZSIpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlk\nIG9wdGlvbnMgd2VyZSBnaXZlbi4KICAgICAqCiAgICAgKiBAc2VlICNtYWlu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oSkRCQ0Nv\nbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAgICBPcHRp\nb25zIG9wdHMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBTUUxFeGNl\ncHRpb24gewogICAgICAgIC8vIGZsYWdzCiAgICAgICAgRmxhZ3MgZmxhZ3Mg\nPSBuZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5wYWNrYWdlTmFtZSA9IG9w\ndHMucmVtb3ZlUHJvcGVydHkKICAgICAgICAgICAgKCJwYWNrYWdlIiwgInBr\nZyIsIGZsYWdzLnBhY2thZ2VOYW1lKTsKICAgICAgICBmbGFncy5kaXJlY3Rv\ncnkgPSBGaWxlcy5nZXRGaWxlCiAgICAgICAgICAgIChvcHRzLnJlbW92ZVBy\nb3BlcnR5KCJkaXJlY3RvcnkiLCAiZCIsIG51bGwpLCBudWxsKTsKICAgICAg\nICBmbGFncy51c2VTY2hlbWFOYW1lID0gb3B0cy5yZW1vdmVCb29sZWFuUHJv\ncGVydHkKICAgICAgICAgICAgKCJ1c2VTY2hlbWFOYW1lIiwgInNuIiwgZmxh\nZ3MudXNlU2NoZW1hTmFtZSk7CiAgICAgICAgZmxhZ3MudXNlRm9yZWlnbktl\neU5hbWUgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAg\nICAoInVzZUZvcmVpZ25LZXlOYW1lIiwgImZrbiIsIGZsYWdzLnVzZUZvcmVp\nZ25LZXlOYW1lKTsKICAgICAgICBmbGFncy5udWxsYWJsZUFzT2JqZWN0ID0g\nb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJudWxs\nYWJsZUFzT2JqZWN0IiwgIm5vIiwgZmxhZ3MubnVsbGFibGVBc09iamVjdCk7\nCiAgICAgICAgZmxhZ3MuYmxvYkFzT2JqZWN0ID0gb3B0cy5yZW1vdmVCb29s\nZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJibG9iQXNPYmplY3QiLCAiYm8i\nLCBmbGFncy5ibG9iQXNPYmplY3QpOwogICAgICAgIGZsYWdzLnVzZUdlbmVy\naWNDb2xsZWN0aW9ucyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAg\nICAgICAgICAgICgidXNlR2VuZXJpY0NvbGxlY3Rpb25zIiwgImdjIiwgZmxh\nZ3MudXNlR2VuZXJpY0NvbGxlY3Rpb25zKTsKICAgICAgICBmbGFncy5wcmlt\nYXJ5S2V5T25Kb2luID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAg\nICAgICAgICAgKCJwcmltYXJ5S2V5T25Kb2luIiwgInBraiIsIGZsYWdzLnBy\naW1hcnlLZXlPbkpvaW4pOwogICAgICAgIGZsYWdzLnVzZURhdGFTdG9yZUlk\nZW50aXR5ID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAg\nICAgKCJ1c2VEYXRhc3RvcmVJZGVudGl0eSIsICJkcyIsIGZsYWdzLnVzZURh\ndGFTdG9yZUlkZW50aXR5KTsKICAgICAgICBmbGFncy51c2VCdWlsdGluSWRl\nbnRpdHlDbGFzcyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAg\nICAgICAgICgidXNlQnVpbHRpbklkZW50aXR5Q2xhc3MiLCAiYmljIiwgZmxh\nZ3MudXNlQnVpbHRpbklkZW50aXR5Q2xhc3MpOwogICAgICAgIGZsYWdzLmlu\nbmVySWRlbnRpdHlDbGFzc2VzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVy\ndHkKICAgICAgICAgICAgKCJpbm5lcklkZW50aXR5Q2xhc3NlcyIsICJpbm4i\nLCBmbGFncy5pbm5lcklkZW50aXR5Q2xhc3Nlcyk7CiAgICAgICAgZmxhZ3Mu\naWRlbnRpdHlDbGFzc1N1ZmZpeCA9IG9wdHMucmVtb3ZlUHJvcGVydHkKICAg\nICAgICAgICAgKCJpZGVudGl0eUNsYXNzU3VmZml4IiwgImlzIiwgZmxhZ3Mu\naWRlbnRpdHlDbGFzc1N1ZmZpeCk7CiAgICAgICAgZmxhZ3MuaW52ZXJzZVJl\nbGF0aW9ucyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAg\nICAgICgiaW52ZXJzZVJlbGF0aW9ucyIsICJpciIsIGZsYWdzLmludmVyc2VS\nZWxhdGlvbnMpOwogICAgICAgIGZsYWdzLmRldGFjaGFibGUgPSBvcHRzLnJl\nbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImRldGFjaGFibGUi\nLCAiZGV0IiwgZmxhZ3MuZGV0YWNoYWJsZSk7CiAgICAgICAgZmxhZ3MuZGlz\nY3JpbWluYXRvclN0cmF0ZWd5ID0gb3B0cy5yZW1vdmVQcm9wZXJ0eQogICAg\nICAgICAgICAoImRpc2NyaW1pbmF0b3JTdHJhdGVneSIsICJkcyIsIGZsYWdz\nLmRpc2NyaW1pbmF0b3JTdHJhdGVneSk7CiAgICAgICAgZmxhZ3MudmVyc2lv\nblN0cmF0ZWd5ID0gb3B0cy5yZW1vdmVQcm9wZXJ0eQogICAgICAgICAgICAo\nInZlcnNpb25TdHJhdGVneSIsICJ2cyIsIGZsYWdzLnZlcnNpb25TdHJhdGVn\neSk7CiAgICAgICAgZmxhZ3MubWV0YURhdGFMZXZlbCA9IG9wdHMucmVtb3Zl\nUHJvcGVydHkKICAgICAgICAgICAgKCJtZXRhZGF0YSIsICJtZCIsIGZsYWdz\nLm1ldGFEYXRhTGV2ZWwpOyAgICAgICAgCiAgICAgICAgZmxhZ3MuZ2VuZXJh\ndGVBbm5vdGF0aW9ucyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAg\nICAgICAgICAgICgiYW5ub3RhdGlvbnMiLCAiYW5uIiwgZmxhZ3MuZ2VuZXJh\ndGVBbm5vdGF0aW9ucyk7CiAgICAgICAgZmxhZ3MuYWNjZXNzVHlwZSA9IG9w\ndHMucmVtb3ZlUHJvcGVydHkKICAgICAgICAgICAgKCJhY2Nlc3NUeXBlIiwg\nImFjY2VzcyIsIGZsYWdzLmFjY2Vzc1R5cGUpOwoKICAgICAgICBTdHJpbmcg\ndHlwZU1hcCA9IG9wdHMucmVtb3ZlUHJvcGVydHkoInR5cGVNYXAiLCAidHlw\nIiwgbnVsbCk7CiAgICAgICAgaWYgKHR5cGVNYXAgIT0gbnVsbCkKICAgICAg\nICAgICAgZmxhZ3MudHlwZU1hcCA9IENvbmZpZ3VyYXRpb25zLnBhcnNlUHJv\ncGVydGllcyh0eXBlTWFwKTsKCiAgICAgICAgLy8gcmVtYXAgdGhlIC1zIHNo\nb3J0Y3V0IHRvIHRoZSAic2NoZW1hcyIgcHJvcGVydHkgbmFtZSBzbyB0aGF0\nIGl0CiAgICAgICAgLy8gZ2V0cyBzZXQgaW50byB0aGUgY29uZmlndXJhdGlv\nbgogICAgICAgIGlmIChvcHRzLmNvbnRhaW5zS2V5KCJzIikpCiAgICAgICAg\nICAgIG9wdHMucHV0KCJzY2hlbWFzIiwgb3B0cy5nZXQoInMiKSk7CgogICAg\nICAgIC8vIGN1c3RvbWl6ZXIKICAgICAgICBTdHJpbmcgY3VzdG9tQ2xzID0g\nb3B0cy5yZW1vdmVQcm9wZXJ0eSgiY3VzdG9taXplckNsYXNzIiwgImNjIiwK\nICAgICAgICAgICAgUHJvcGVydGllc1JldmVyc2VDdXN0b21pemVyLmNsYXNz\nLmdldE5hbWUoKSk7CiAgICAgICAgRmlsZSBjdXN0b21GaWxlID0gRmlsZXMu\nZ2V0RmlsZQogICAgICAgICAgICAob3B0cy5yZW1vdmVQcm9wZXJ0eSgiY3Vz\ndG9taXplclByb3BlcnRpZXMiLCAiY3AiLCBudWxsKSwgbnVsbCk7CiAgICAg\nICAgUHJvcGVydGllcyBjdXN0b21Qcm9wcyA9IG5ldyBQcm9wZXJ0aWVzKCk7\nCiAgICAgICAgaWYgKGN1c3RvbUZpbGUgIT0gbnVsbCAmJiAoKEJvb2xlYW4p\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5leGlzdHNBY3Rpb24oY3VzdG9tRmlsZSkpKS5ib29s\nZWFuVmFsdWUoKSkgewogICAgICAgICAgICBGaWxlSW5wdXRTdHJlYW0gZmlz\nID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZp\ncyA9IChGaWxlSW5wdXRTdHJlYW0pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5l\nd0ZpbGVJbnB1dFN0cmVhbUFjdGlvbihjdXN0b21GaWxlKSk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24gcGFlKSB7\nCiAgICAgICAgICAgICAgICAgdGhyb3cgKEZpbGVOb3RGb3VuZEV4Y2VwdGlv\nbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGN1c3RvbVByb3BzLmxvYWQoZmlzKTsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgLy8gc2VwYXJhdGUgdGhlIHByb3BlcnRpZXMgZm9yIHRoZSBj\ndXN0b21pemVyIGFuZCBjb2RlIGZvcm1hdAogICAgICAgIE9wdGlvbnMgY3Vz\ndG9tT3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgT3B0aW9ucyBmb3Jt\nYXRPcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBNYXAuRW50cnkgZW50\ncnk7CiAgICAgICAgU3RyaW5nIGtleTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IG9wdHMuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIGtleSA9IChTdHJpbmcpIGVudHJ5LmdldEtl\neSgpOwogICAgICAgICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgoImN1c3RvbWl6\nZXIuIikpIHsKICAgICAgICAgICAgICAgIGN1c3RvbU9wdHMucHV0KGtleS5z\ndWJzdHJpbmcoMTEpLCBlbnRyeS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAg\nICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChrZXku\nc3RhcnRzV2l0aCgiYy4iKSkgewogICAgICAgICAgICAgICAgY3VzdG9tT3B0\ncy5wdXQoa2V5LnN1YnN0cmluZygyKSwgZW50cnkuZ2V0VmFsdWUoKSk7CiAg\nICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoa2V5LnN0YXJ0c1dpdGgoImNvZGVGb3JtYXQuIikpIHsKICAgICAg\nICAgICAgICAgIGZvcm1hdE9wdHMucHV0KGtleS5zdWJzdHJpbmcoMTEpLCBl\nbnRyeS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGl0ci5yZW1vdmUo\nKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkuc3RhcnRzV2l0aCgiY2Yu\nIikpIHsKICAgICAgICAgICAgICAgIGZvcm1hdE9wdHMucHV0KGtleS5zdWJz\ndHJpbmcoMyksIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAgICAgICAg\naXRyLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyBjb2RlIGZvcm1hdAogICAgICAgIGlmICghZm9ybWF0T3B0cy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgZmxhZ3MuZm9ybWF0ID0gbmV3IENvZGVG\nb3JtYXQoKTsKICAgICAgICAgICAgZm9ybWF0T3B0cy5zZXRJbnRvKGZsYWdz\nLmZvcm1hdCk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZXR1cCBhIGNvbmZp\nZ3VyYXRpb24gaW5zdGFuY2Ugd2l0aCBjbWQtbGluZSBpbmZvCiAgICAgICAg\nQ29uZmlndXJhdGlvbnMucG9wdWxhdGVDb25maWd1cmF0aW9uKGNvbmYsIG9w\ndHMpOwogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IGNvbmYuZ2V0Q2xh\nc3NSZXNvbHZlckluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldENsYXNzTG9h\nZGVyKFJldmVyc2VNYXBwaW5nVG9vbC5jbGFzcywgbnVsbCk7CgogICAgICAg\nIC8vIGN1c3RvbWl6ZXIKICAgICAgICBmbGFncy5jdXN0b21pemVyID0gKFJl\ndmVyc2VDdXN0b21pemVyKSBDb25maWd1cmF0aW9ucy4KICAgICAgICAgICAg\nbmV3SW5zdGFuY2UoY3VzdG9tQ2xzLCBsb2FkZXIpOwogICAgICAgIGlmIChm\nbGFncy5jdXN0b21pemVyICE9IG51bGwpIHsKICAgICAgICAgICAgQ29uZmln\ndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2UoZmxhZ3MuY3VzdG9taXplciwg\nY29uZiwKICAgICAgICAgICAgICAgIGN1c3RvbU9wdHMpOwogICAgICAgICAg\nICBmbGFncy5jdXN0b21pemVyLnNldENvbmZpZ3VyYXRpb24oY3VzdG9tUHJv\ncHMpOwogICAgICAgIH0KCiAgICAgICAgcnVuKGNvbmYsIGFyZ3MsIGZsYWdz\nLCBsb2FkZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogUnVuIHRoZSB0b29sLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgcnVuKEpEQkNDb25maWd1cmF0aW9uIGNvbmYsIFN0cmluZ1td\nIGFyZ3MsCiAgICAgICAgRmxhZ3MgZmxhZ3MsIENsYXNzTG9hZGVyIGxvYWRl\ncikKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gcGFyc2UgdGhlIHNjaGVtYSB0byByZXZlcnNlLW1hcAog\nICAgICAgIExvZyBsb2cgPSBjb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJh\ndGlvbi5MT0dfVE9PTCk7CiAgICAgICAgU2NoZW1hR3JvdXAgc2NoZW1hOwog\nICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGxv\nZy5pbmZvKF9sb2MuZ2V0KCJyZXZ0b29sLXJ1bm5pbmciKSk7CiAgICAgICAg\nICAgIFNjaGVtYUdlbmVyYXRvciBnZW4gPSBuZXcgU2NoZW1hR2VuZXJhdG9y\nKGNvbmYpOwogICAgICAgICAgICBnZW4uZ2VuZXJhdGVTY2hlbWFzKCk7CiAg\nICAgICAgICAgIHNjaGVtYSA9IGdlbi5nZXRTY2hlbWFHcm91cCgpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFNjaGVtYVBhcnNlciBwYXJzZXIg\nPSBuZXcgWE1MU2NoZW1hUGFyc2VyKGNvbmYpOwogICAgICAgICAgICBGaWxl\nIGZpbGU7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZmlsZSA9IEZpbGVzLmdl\ndEZpbGUoYXJnc1tpXSwgbG9hZGVyKTsKICAgICAgICAgICAgICAgIGxvZy5p\nbmZvKF9sb2MuZ2V0KCJyZXZ0b29sLXJ1bm5pbmctZmlsZSIsIGZpbGUpKTsK\nICAgICAgICAgICAgICAgIHBhcnNlci5wYXJzZShmaWxlKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBzY2hlbWEgPSBwYXJzZXIuZ2V0U2NoZW1hR3Jv\ndXAoKTsKICAgICAgICB9CgogICAgICAgIC8vIGZsYWdzCiAgICAgICAgUmV2\nZXJzZU1hcHBpbmdUb29sIHRvb2wgPSBuZXcgUmV2ZXJzZU1hcHBpbmdUb29s\nKGNvbmYpOwogICAgICAgIHRvb2wuc2V0U2NoZW1hR3JvdXAoc2NoZW1hKTsK\nICAgICAgICB0b29sLnNldFBhY2thZ2VOYW1lKGZsYWdzLnBhY2thZ2VOYW1l\nKTsKICAgICAgICB0b29sLnNldERpcmVjdG9yeShmbGFncy5kaXJlY3Rvcnkp\nOwogICAgICAgIHRvb2wuc2V0VXNlU2NoZW1hTmFtZShmbGFncy51c2VTY2hl\nbWFOYW1lKTsKICAgICAgICB0b29sLnNldFVzZUZvcmVpZ25LZXlOYW1lKGZs\nYWdzLnVzZUZvcmVpZ25LZXlOYW1lKTsKICAgICAgICB0b29sLnNldE51bGxh\nYmxlQXNPYmplY3QoZmxhZ3MubnVsbGFibGVBc09iamVjdCk7CiAgICAgICAg\ndG9vbC5zZXRCbG9iQXNPYmplY3QoZmxhZ3MuYmxvYkFzT2JqZWN0KTsKICAg\nICAgICB0b29sLnNldFVzZUdlbmVyaWNDb2xsZWN0aW9ucyhmbGFncy51c2VH\nZW5lcmljQ29sbGVjdGlvbnMpOwogICAgICAgIHRvb2wuc2V0VHlwZU1hcChm\nbGFncy50eXBlTWFwKTsKICAgICAgICB0b29sLnNldFByaW1hcnlLZXlPbkpv\naW4oZmxhZ3MucHJpbWFyeUtleU9uSm9pbik7CiAgICAgICAgdG9vbC5zZXRV\nc2VEYXRhU3RvcmVJZGVudGl0eShmbGFncy51c2VEYXRhU3RvcmVJZGVudGl0\neSk7CiAgICAgICAgdG9vbC5zZXRVc2VCdWlsdGluSWRlbnRpdHlDbGFzcyhm\nbGFncy51c2VCdWlsdGluSWRlbnRpdHlDbGFzcyk7CiAgICAgICAgdG9vbC5z\nZXRJbm5lcklkZW50aXR5Q2xhc3NlcyhmbGFncy5pbm5lcklkZW50aXR5Q2xh\nc3Nlcyk7CiAgICAgICAgdG9vbC5zZXRJZGVudGl0eUNsYXNzU3VmZml4KGZs\nYWdzLmlkZW50aXR5Q2xhc3NTdWZmaXgpOwogICAgICAgIHRvb2wuc2V0SW52\nZXJzZVJlbGF0aW9ucyhmbGFncy5pbnZlcnNlUmVsYXRpb25zKTsKICAgICAg\nICB0b29sLnNldERldGFjaGFibGUoZmxhZ3MuZGV0YWNoYWJsZSk7CiAgICAg\nICAgdG9vbC5zZXRHZW5lcmF0ZUFubm90YXRpb25zKGZsYWdzLmdlbmVyYXRl\nQW5ub3RhdGlvbnMpOwogICAgICAgIHRvb2wuc2V0QWNjZXNzVHlwZShmbGFn\ncy5hY2Nlc3NUeXBlKTsKICAgICAgICB0b29sLnNldEN1c3RvbWl6ZXIoZmxh\nZ3MuY3VzdG9taXplcik7CiAgICAgICAgdG9vbC5zZXRDb2RlRm9ybWF0KGZs\nYWdzLmZvcm1hdCk7CgogICAgICAgIC8vIHJ1bgogICAgICAgIGxvZy5pbmZv\nKF9sb2MuZ2V0KCJyZXZ0b29sLW1hcCIpKTsKICAgICAgICB0b29sLnJ1bigp\nOwogICAgICAgIGlmIChmbGFncy5nZW5lcmF0ZUFubm90YXRpb25zKSB7CiAg\nICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJyZXZ0b29sLWdlbi1hbm5v\ncyIpKTsKICAgICAgICAgICAgdG9vbC5idWlsZEFubm90YXRpb25zKCk7CiAg\nICAgICAgfQogICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJyZXZ0b29sLXdy\naXRlLWNvZGUiKSk7CiAgICAgICAgdG9vbC5yZWNvcmRDb2RlKCk7CiAgICAg\nICAgaWYgKCFMRVZFTF9OT05FLmVxdWFscyhmbGFncy5tZXRhRGF0YUxldmVs\nKSkgewogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgicmV2dG9vbC13\ncml0ZS1tZXRhZGF0YSIpKTsKICAgICAgICAgICAgdG9vbC5yZWNvcmRNZXRh\nRGF0YShMRVZFTF9DTEFTUy5lcXVhbHMoZmxhZ3MubWV0YURhdGFMZXZlbCkp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhvbGRlciBmb3Ig\ncnVuIGZsYWdzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEZs\nYWdzIHsKCiAgICAgICAgcHVibGljIFN0cmluZyBwYWNrYWdlTmFtZSA9IG51\nbGw7CiAgICAgICAgcHVibGljIEZpbGUgZGlyZWN0b3J5ID0gbnVsbDsKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiB1c2VTY2hlbWFOYW1lID0gZmFsc2U7CiAg\nICAgICAgcHVibGljIGJvb2xlYW4gdXNlRm9yZWlnbktleU5hbWUgPSBmYWxz\nZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBudWxsYWJsZUFzT2JqZWN0ID0g\nZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xlYW4gYmxvYkFzT2JqZWN0ID0g\nZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdXNlR2VuZXJpY0NvbGxl\nY3Rpb25zID0gZmFsc2U7CiAgICAgICAgcHVibGljIFByb3BlcnRpZXMgdHlw\nZU1hcCA9IG51bGw7CiAgICAgICAgcHVibGljIGJvb2xlYW4gcHJpbWFyeUtl\neU9uSm9pbiA9IGZhbHNlOwogICAgICAgIHB1YmxpYyBib29sZWFuIHVzZURh\ndGFTdG9yZUlkZW50aXR5ID0gZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xl\nYW4gdXNlQnVpbHRpbklkZW50aXR5Q2xhc3MgPSB0cnVlOwogICAgICAgIHB1\nYmxpYyBib29sZWFuIGlubmVySWRlbnRpdHlDbGFzc2VzID0gZmFsc2U7CiAg\nICAgICAgcHVibGljIFN0cmluZyBpZGVudGl0eUNsYXNzU3VmZml4ID0gIklk\nIjsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpbnZlcnNlUmVsYXRpb25zID0g\ndHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBkZXRhY2hhYmxlID0gZmFs\nc2U7CiAgICAgICAgcHVibGljIGJvb2xlYW4gZ2VuZXJhdGVBbm5vdGF0aW9u\ncyA9IGZhbHNlOwogICAgICAgIHB1YmxpYyBTdHJpbmcgYWNjZXNzVHlwZSA9\nIEFDQ0VTU19UWVBFX0ZJRUxEOwogICAgICAgIHB1YmxpYyBTdHJpbmcgbWV0\nYURhdGFMZXZlbCA9IExFVkVMX1BBQ0tBR0U7CiAgICAgICAgcHVibGljIFN0\ncmluZyBkaXNjcmltaW5hdG9yU3RyYXRlZ3kgPSBudWxsOwogICAgICAgIHB1\nYmxpYyBTdHJpbmcgdmVyc2lvblN0cmF0ZWd5ID0gbnVsbDsKICAgICAgICBw\ndWJsaWMgUmV2ZXJzZUN1c3RvbWl6ZXIgY3VzdG9taXplciA9IG51bGw7CiAg\nICAgICAgcHVibGljIENvZGVGb3JtYXQgZm9ybWF0ID0gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFVzZWQgdG8gaW5zdGFsbCBkaXNjcmltaW5hdG9y\nIGFuZCB2ZXJzaW9uIHN0cmF0ZWdpZXMgb24KICAgICAqIHJldmVyc2UtbWFw\ncGVkIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgUmV2ZXJz\nZVN0cmF0ZWd5SW5zdGFsbGVyCiAgICAgICAgZXh0ZW5kcyBTdHJhdGVneUlu\nc3RhbGxlciB7CgogICAgICAgIHB1YmxpYyBSZXZlcnNlU3RyYXRlZ3lJbnN0\nYWxsZXIoTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICAgICAg\nc3VwZXIocmVwb3MpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\naW5zdGFsbFN0cmF0ZWd5KENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBpbnN0YWxsU3RyYXRlZ3koRmllbGRNYXBw\naW5nIGZpZWxkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgaW5z\ndGFsbFN0cmF0ZWd5KFZlcnNpb24gdmVyc2lvbikgewogICAgICAgICAgICBD\nbGFzc01hcHBpbmcgY2xzID0gdmVyc2lvbi5nZXRDbGFzc01hcHBpbmcoKTsK\nICAgICAgICAgICAgaWYgKGNscy5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdmVyc2lvbi5zZXRTdHJhdGVneShuZXcgU3Vw\nZXJjbGFzc1ZlcnNpb25TdHJhdGVneSgpLCBudWxsKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoX3ZlcnNTdHJhdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBWZXJzaW9uU3RyYXRlZ3kgc3RyYXQgPSByZXBvcy5pbnN0YW50aWF0ZVZl\ncnNpb25TdHJhdGVneQogICAgICAgICAgICAgICAgICAgIChfdmVyc1N0cmF0\nLCB2ZXJzaW9uKTsKICAgICAgICAgICAgICAgIHZlcnNpb24uc2V0U3RyYXRl\nZ3koc3RyYXQsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgICAgIHZlcnNpb24uc2V0U3RyYXRlZ3kobmV3IFN0YXRlQ29tcGFyaXNv\nblZlcnNpb25TdHJhdGVneSgpLAogICAgICAgICAgICAgICAgICAgIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgaW5zdGFsbFN0cmF0\nZWd5KERpc2NyaW1pbmF0b3IgZGlzY3JpbSkgewogICAgICAgICAgICBDbGFz\nc01hcHBpbmcgY2xzID0gZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKTsKICAg\nICAgICAgICAgaWYgKGNscy5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBkaXNjcmltLnNldFN0cmF0ZWd5KG5ldyBTdXBl\ncmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5KCksCiAgICAgICAgICAgICAg\nICAgICAgbnVsbCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWhhc1N1YmNs\nYXNzZXMoY2xzKSkgewogICAgICAgICAgICAgICAgZGlzY3JpbS5zZXRTdHJh\ndGVneShOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5LmdldEluc3RhbmNlKCks\nCiAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoX2Rpc2NTdHJhdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBE\naXNjcmltaW5hdG9yU3RyYXRlZ3kgc3RyYXQgPSByZXBvcy4KICAgICAgICAg\nICAgICAgICAgICBpbnN0YW50aWF0ZURpc2NyaW1pbmF0b3JTdHJhdGVneShf\nZGlzY1N0cmF0LCBkaXNjcmltKTsKICAgICAgICAgICAgICAgIGRpc2NyaW0u\nc2V0U3RyYXRlZ3koc3RyYXQsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgICAgIGRpc2NyaW0uc2V0U3RyYXRlZ3kobmV3IFN1YmNs\nYXNzSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneSgpLAogICAgICAgICAgICAg\nICAgICAgIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIGNsYXNzIGhhcyBhbnkgbWFw\ncGVkIHBlcnNpc3RlbnQgc3ViY2xhc3Nlcy4KICAgICAgICAgKi8KICAgICAg\nICBwcml2YXRlIGJvb2xlYW4gaGFzU3ViY2xhc3NlcyhDbGFzc01hcHBpbmcg\nY2xzKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGFbXSBtZXRhcyA9IHJl\ncG9zLmdldE1ldGFEYXRhcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYg\nKG1ldGFzW2ldLmdldFBDU3VwZXJjbGFzcygpID09IGNscy5nZXREZXNjcmli\nZWRUeXBlKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBFeHRlbnNpb24gb2YgdGhlIHtAbGluayBDb2RlR2VuZXJh\ndG9yfSB0byBhbGxvdyB1c2VycyB0byBjdXN0b21pemUKICAgICAqIHRoZSBm\nb3JtYXR0aW5nIG9mIHRoZWlyIGdlbmVyYXRlZCBjbGFzc2VzLgogICAgICov\nCiAgICBwcml2YXRlIGNsYXNzIFJldmVyc2VDb2RlR2VuZXJhdG9yCiAgICAg\nICAgZXh0ZW5kcyBDb2RlR2VuZXJhdG9yIHsKCiAgICAgICAgcHJvdGVjdGVk\nIGZpbmFsIENsYXNzTWFwcGluZyBfbWFwcGluZzsKICAgICAgICBwcm90ZWN0\nZWQgZmluYWwgQXBwbGljYXRpb25JZFRvb2wgX2FwcGlkOwoKICAgICAgICBw\ndWJsaWMgUmV2ZXJzZUNvZGVHZW5lcmF0b3IoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsCiAgICAgICAgICAgIEFwcGxpY2F0aW9uSWRUb29sIGFpZCkgewogICAg\nICAgICAgICBzdXBlcihtYXBwaW5nKTsKICAgICAgICAgICAgc3VwZXIuc2V0\nRGlyZWN0b3J5KF9kaXIpOwogICAgICAgICAgICBzdXBlci5zZXRDb2RlRm9y\nbWF0KF9mb3JtYXQpOwoKICAgICAgICAgICAgX21hcHBpbmcgPSBtYXBwaW5n\nOwogICAgICAgICAgICBpZiAoYWlkICE9IG51bGwgJiYgYWlkLmlzSW5uZXJD\nbGFzcygpKQogICAgICAgICAgICAgICAgX2FwcGlkID0gYWlkOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBfYXBwaWQgPSBudWxsOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSWYgdGhlcmUgaXMgYW4g\naW5uZXIgYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3MsIHRoZW4KICAgICAg\nICAgKiBhZGQgaXQgdG8gdGhlIGJvdHRvbSBvZiB0aGUgY2xhc3MgY29kZS4K\nICAgICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQgdm9pZCBjbG9zZUNsYXNz\nQnJhY2UoQ29kZUZvcm1hdCBjb2RlKSB7CiAgICAgICAgICAgIGlmIChfYXBw\naWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29kZS5hZnRlclNlY3Rp\nb24oKTsKICAgICAgICAgICAgICAgIGNvZGUuYXBwZW5kKF9hcHBpZC5nZXRD\nb2RlKCkpOwogICAgICAgICAgICAgICAgY29kZS5lbmRsKCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHN1cGVyLmNsb3NlQ2xhc3NCcmFjZShjb2Rl\nKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEFkZCB0aGUg\nbGlzdCBvZiBpbXBvcnRzIGZvciBhbnkgaW5uZXIgYXBwIGlkIGNsYXNzZXMK\nICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4KICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgU2V0IGdldEltcG9ydFBhY2thZ2VzKCkgewogICAgICAg\nICAgICBTZXQgcGtncyA9IHN1cGVyLmdldEltcG9ydFBhY2thZ2VzKCk7CiAg\nICAgICAgICAgIGlmIChfYXBwaWQgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHBrZ3MuYWRkQWxsKF9hcHBpZC5nZXRJbXBvcnRQYWNrYWdlcygpKTsKICAg\nICAgICAgICAgcmV0dXJuIHBrZ3M7CiAgICAgICAgfQoKICAgICAgICBwcm90\nZWN0ZWQgU3RyaW5nIGdldENsYXNzQ29kZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIChfY3VzdG9tID09IG51bGwpID8gbnVsbCA6IF9jdXN0b20uZ2V0Q2xh\nc3NDb2RlKF9tYXBwaW5nKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBTdHJpbmcgZ2V0SW5pdGlhbFZhbHVlKEZpZWxkTWV0YURhdGEgZmllbGQp\nIHsKICAgICAgICAgICAgaWYgKF9jdXN0b20gPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gX2N1c3Rv\nbS5nZXRJbml0aWFsVmFsdWUoKEZpZWxkTWFwcGluZykgZmllbGQpOwogICAg\nICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0cmluZyBnZXREZWNsYXJhdGlv\nbihGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAgICAgIGlmIChfY3Vz\ndG9tID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICAgICAgcmV0dXJuIF9jdXN0b20uZ2V0RGVjbGFyYXRpb24oKEZpZWxk\nTWFwcGluZykgZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVk\nIFN0cmluZyBnZXRGaWVsZENvZGUoRmllbGRNZXRhRGF0YSBmaWVsZCkgewog\nICAgICAgICAgICBpZiAoX2N1c3RvbSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBfY3VzdG9tLmdl\ndEZpZWxkQ29kZSgoRmllbGRNYXBwaW5nKSBmaWVsZCk7CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiB1c2VHZW5lcmljQ29sbGVjdGlv\nbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBfdXNlR2VuZXJpY0NvbGw7CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQW5ub3RhdGVkQ29k\nZUdlbmVyYXRvcgogICAgICAgIGV4dGVuZHMgUmV2ZXJzZUNvZGVHZW5lcmF0\nb3IgewoKICAgICAgICBwdWJsaWMgQW5ub3RhdGVkQ29kZUdlbmVyYXRvciAo\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgICAgIEFwcGxpY2F0aW9u\nSWRUb29sIGFpZCkgewogICAgICAgICAgICBzdXBlciAobWFwcGluZywgYWlk\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTZXQgZ2V0SW1wb3J0UGFj\na2FnZXMoKSB7CiAgICAgICAgICAgIFNldCBwa2dzID0gc3VwZXIuZ2V0SW1w\nb3J0UGFja2FnZXMoKTsKICAgICAgICAgICAgcGtncy5hZGQoImphdmF4LnBl\ncnNpc3RlbmNlIik7CiAgICAgICAgICAgIHJldHVybiBwa2dzOwogICAgICAg\nIH0KCiAgICAgICAgcHJvdGVjdGVkIExpc3QgZ2V0Q2xhc3NBbm5vdGF0aW9u\ncygpIHsKICAgICAgICAgICAgcmV0dXJuIGdldEFubm90YXRpb25zRm9yTWV0\nYShfbWFwcGluZyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgTGlz\ndCBnZXRGaWVsZEFubm90YXRpb25zKEZpZWxkTWV0YURhdGEgZmllbGQpIHsK\nICAgICAgICAgICAgcmV0dXJuIGdldEFubm90YXRpb25zRm9yTWV0YShmaWVs\nZCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiB1c2VQ\ncm9wZXJ0eUJhc2VkQWNjZXNzICgpIHsKICAgICAgICAgICAgcmV0dXJuIEFD\nQ0VTU19UWVBFX1BST1BFUlRZLmVxdWFscyhfYWNjZXNzVHlwZSk7CiAgICAg\nICAgfQoKICAgIH0KfQo=\n","encoding":"base64"}

