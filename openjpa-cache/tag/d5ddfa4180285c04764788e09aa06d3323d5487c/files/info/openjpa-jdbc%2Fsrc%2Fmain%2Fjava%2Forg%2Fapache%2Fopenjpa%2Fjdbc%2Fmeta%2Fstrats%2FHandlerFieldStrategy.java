{"sha":"a36c1ed2d16a9cb742ec7be6f6378e1bf07ccbe1","node_id":"MDQ6QmxvYjIwNjM2NDphMzZjMWVkMmQxNmE5Y2I3NDJlYzdiZTZmNjM3OGUxYmYwN2NjYmUx","size":14433,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a36c1ed2d16a9cb742ec7be6f6378e1bf07ccbe1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRC\nQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5F\nbWJlZGRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5WYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwoKLyoqCiAqIE1hcHBpbmcgZm9yIGEgc2luZ2xlLXZhbHVlZCBmaWVsZCB0\naGF0IGRlbGVnYXRlcyB0byBhIHtAbGluayBWYWx1ZUhhbmRsZXJ9LgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAc2luY2UgMC40LjAKICovCnB1Ymxp\nYyBjbGFzcyBIYW5kbGVyRmllbGRTdHJhdGVneQogICAgZXh0ZW5kcyBBYnN0\ncmFjdEZpZWxkU3RyYXRlZ3kKICAgIGltcGxlbWVudHMgSm9pbmFibGUsIEVt\nYmVkZGFibGUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdCBO\nVUxMID0gbmV3IE9iamVjdCgpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAg\nICAoSGFuZGxlckZpZWxkU3RyYXRlZ3kuY2xhc3MpOwoKICAgIHByaXZhdGUg\nQ29sdW1uW10gX2NvbHMgPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5JTyBf\naW8gPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfYXJncyA9IG51bGw7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2xvYWQgPSBmYWxzZTsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfbG9iID0gZmFsc2U7CgogICAgcHVibGljIHZvaWQgbWFw\nKGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBpZiAoZmllbGQuZ2V0SGFuZGxl\ncigpID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibm8taGFuZGxlciIsIGZpZWxkKSk7CiAgICAg\nICAgYXNzZXJ0Tm90TWFwcGVkQnkoKTsKCiAgICAgICAgLy8gbWFwIGpvaW4g\na2V5IChpZiBhbnkpCiAgICAgICAgZmllbGQubWFwSm9pbihhZGFwdCwgZmFs\nc2UpOwogICAgICAgIGZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRWYWx1ZUlu\nZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBvbmVudHMKICAgICAgICAgICAgKGZp\nZWxkLmdldEtleSgpLCAhYWRhcHQpOwogICAgICAgIGZpZWxkLmdldEVsZW1l\nbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21w\nb25lbnRzCiAgICAgICAgICAgIChmaWVsZC5nZXRFbGVtZW50KCksICFhZGFw\ndCk7CgogICAgICAgIF9pbyA9IG5ldyBDb2x1bW5JTygpOwogICAgICAgIF9j\nb2xzID0gSGFuZGxlclN0cmF0ZWdpZXMubWFwKGZpZWxkLCBmaWVsZC5nZXRO\nYW1lKCksIF9pbywgYWRhcHQpOwogICAgICAgIGlmIChmaWVsZC5nZXRWYWx1\nZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLkFVVE9BU1NJR04pIHsK\nICAgICAgICAgICAgLy8gZmlyc3Qgc2VlIGlmIGFueSBjb2x1bW5zIGFscmVh\nZHkgbWFya2VkIGF1dG9hc3NpZ247IGlmIG5vdCBtYXJrCiAgICAgICAgICAg\nIC8vIHRoZW0gYWxsCiAgICAgICAgICAgIGJvb2xlYW4gbWFya2VkID0gZmFs\nc2U7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyAhbWFya2VkICYmIGkg\nPCBfY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChfY29s\nc1tpXS5pc0F1dG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAgICAgIG1h\ncmtlZCA9IHRydWU7CiAgICAgICAgICAgIGlmICghbWFya2VkKQogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBfY29sc1tpXS5zZXRBdXRvQXNzaWdu\nZWQodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgcHJpbWFyeSBr\nZXkgY29sdW1ucyB0byB0YWJsZSBwayBpZiBsb2dpY2FsCiAgICAgICAgZmll\nbGQubWFwUHJpbWFyeUtleShhZGFwdCk7CiAgICAgICAgUHJpbWFyeUtleSBw\nayA9IGZpZWxkLmdldFRhYmxlKCkuZ2V0UHJpbWFyeUtleSgpOwogICAgICAg\nIGlmIChmaWVsZC5pc1ByaW1hcnlLZXkoKSAmJiBwayAhPSBudWxsICYmIChh\nZGFwdCB8fCBway5pc0xvZ2ljYWwoKSkpCiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgX2NvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBway5hZGRDb2x1bW4oX2NvbHNbaV0pOwoKICAgICAgICAvLyBzZXQgam9p\nbmFibGUKICAgICAgICBpZiAoIWZpZWxkLmdldEhhbmRsZXIoKS5vYmplY3RW\nYWx1ZVJlcXVpcmVzTG9hZChmaWVsZCkpCiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgX2NvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKS5zZXRKb2luYWJsZShfY29s\nc1tpXSwgdGhpcyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6\nZSgpIHsKICAgICAgICBfbG9hZCA9IGZpZWxkLmdldEhhbmRsZXIoKS5vYmpl\nY3RWYWx1ZVJlcXVpcmVzTG9hZChmaWVsZCk7CiAgICAgICAgaWYgKF9sb2Fk\nKQogICAgICAgICAgICBmaWVsZC5zZXRVc2VzSW50ZXJtZWRpYXRlKHRydWUp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyAhX2xvYiAmJiBpIDwgX2NvbHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIF9sb2IgPSBfY29sc1tpXS5pc0xv\nYigpOwoKICAgICAgICBPYmplY3QgYXJncyA9IGZpZWxkLmdldEhhbmRsZXIo\nKS5nZXRSZXN1bHRBcmd1bWVudChmaWVsZCk7CiAgICAgICAgaWYgKGFyZ3Mg\nPT0gbnVsbCkKICAgICAgICAgICAgX2FyZ3MgPSBudWxsOwogICAgICAgIGVs\nc2UgaWYgKF9jb2xzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICBfYXJncyA9\nIG5ldyBPYmplY3RbXXsgYXJncyB9OwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX2FyZ3MgPSAoT2JqZWN0W10pIGFyZ3M7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9y\nZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBSb3cgcm93ID0gZmllbGQuZ2V0Um93KHNtLCBz\ndG9yZSwgcm0sIFJvdy5BQ1RJT05fSU5TRVJUKTsKICAgICAgICBpZiAocm93\nICE9IG51bGwpCiAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLnNldChm\naWVsZCwgc20uZmV0Y2goZmllbGQuZ2V0SW5kZXgoKSksIHN0b3JlLAogICAg\nICAgICAgICAgICAgcm93LCBfY29scywgX2lvLCBmaWVsZC5nZXROdWxsVmFs\ndWUoKSA9PQogICAgICAgICAgICAgICAgRmllbGRNYXBwaW5nLk5VTExfTk9O\nRSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdXBkYXRlKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBSb3cgcm93\nID0gZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJvdy5BQ1RJT05fVVBE\nQVRFKTsKICAgICAgICBpZiAocm93ICE9IG51bGwpCiAgICAgICAgICAgIEhh\nbmRsZXJTdHJhdGVnaWVzLnNldChmaWVsZCwgc20uZmV0Y2goZmllbGQuZ2V0\nSW5kZXgoKSksIHN0b3JlLAogICAgICAgICAgICAgICAgcm93LCBfY29scywg\nX2lvLCBmaWVsZC5nZXROdWxsVmFsdWUoKSA9PQogICAgICAgICAgICAgICAg\nRmllbGRNYXBwaW5nLk5VTExfTk9ORSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgZGVsZXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBz\ndG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBmaWVsZC5kZWxldGVSb3coc20sIHN0b3JlLCBybSk7\nCiAgICB9CgogICAgcHVibGljIGludCBzdXBwb3J0c1NlbGVjdChTZWxlY3Qg\nc2VsLCBpbnQgdHlwZSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAg\nICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICBpZiAoKHR5cGUgPT0gU2VsZWN0LlRZUEVfSk9JTkxF\nU1MgJiYgc2VsLmlzU2VsZWN0ZWQoZmllbGQuZ2V0VGFibGUoKSkpCiAgICAg\nICAgICAgIHx8IChfbG9hZCAmJiB0eXBlID09IHNlbC5UWVBFX1RXT19QQVJU\nKSkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgcmV0dXJuIDA7CiAg\nICB9CgogICAgcHVibGljIGludCBzZWxlY3QoU2VsZWN0IHNlbCwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlck1vZGUpIHsK\nICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJl\ndHVybiAtMTsKCiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uZ2V0SW50\nZXJtZWRpYXRlKGZpZWxkLmdldEluZGV4KCkpICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiAtMTsKICAgICAgICBpZiAoX2xvYiAmJiAhZmllbGQuaXNQ\ncmltYXJ5S2V5KCkgJiYgKHNlbC5pc0Rpc3RpbmN0KCkgfHwKICAgICAgICAg\nICAgICAgIGVhZ2VyTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVB\nR0VSX05PTkUpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgc2Vs\nLnNlbGVjdChfY29scywgZmllbGQuam9pbihzZWwpKTsKICAgICAgICByZXR1\ncm4gMTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChfY29scy5sZW5ndGgg\nPT0gMCB8fCAhcmVzLmNvbnRhaW5zQWxsKF9jb2xzKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBPYmplY3QgdmFsID0gSGFuZGxlclN0cmF0ZWdp\nZXMubG9hZERhdGFTdG9yZShmaWVsZCwgcmVzLCBudWxsLCBfY29scyk7CiAg\nICAgICAgaWYgKCFfbG9hZCkKICAgICAgICAgICAgc20uc3RvcmUoZmllbGQu\nZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAg\nICAgdG9PYmplY3RWYWx1ZShmaWVsZCwgdmFsKSk7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHZhbCA9IE5VTEw7CiAgICAgICAgICAgIHNtLnNldEludGVybWVkaWF0ZShm\naWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNT\ndG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8v\nIGV2ZW4gaWYgbm8gY29sdW1ucywgYWxsb3cgYSBoYW5kbGVyIHRvIGxvYWQg\nYSBnZW5lcmF0ZWQgdmFsdWUKICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID09\nIDApIHsKICAgICAgICAgICAgaWYgKF9sb2FkKQogICAgICAgICAgICAgICAg\nc20uc3RvcmUoZmllbGQuZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigp\nLgogICAgICAgICAgICAgICAgICAgIHRvT2JqZWN0VmFsdWUoZmllbGQsIG51\nbGwsIHNtLCBzdG9yZSwgZmV0Y2gpKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgc20uc3RvcmUoZmllbGQuZ2V0SW5kZXgoKSwgZmllbGQu\nZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgICAgIHRvT2JqZWN0VmFs\ndWUoZmllbGQsIG51bGwpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgLy8gbG9hZCBjYWNoZWQgaW50ZXJtZWRpYXRlIHZhbHVl\nPwogICAgICAgIGlmIChfbG9hZCkgewogICAgICAgICAgICBPYmplY3QgZHMg\nPSBzbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAg\nICAgICAgIGlmIChkcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nZHMgPT0gTlVMTCkKICAgICAgICAgICAgICAgICAgICBkcyA9IG51bGw7CiAg\nICAgICAgICAgICAgICBzbS5zdG9yZShmaWVsZC5nZXRJbmRleCgpLCBmaWVs\nZC5nZXRIYW5kbGVyKCkuCiAgICAgICAgICAgICAgICAgICAgdG9PYmplY3RW\nYWx1ZShmaWVsZCwgZHMsIHNtLCBzdG9yZSwgZmV0Y2gpKTsKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgU2VsZWN0IHNlbCA9IHN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdTZWxl\nY3QoKTsKICAgICAgICBzZWwuc2VsZWN0KF9jb2xzKTsKICAgICAgICBmaWVs\nZC53aGVyZVByaW1hcnlLZXkoc2VsLCBzbSwgc3RvcmUpOwoKICAgICAgICBS\nZXN1bHQgcmVzID0gc2VsLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsKICAgICAg\nICBPYmplY3QgdmFsID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAocmVzLm5leHQoKSkKICAgICAgICAgICAgICAgIHZhbCA9IEhhbmRs\nZXJTdHJhdGVnaWVzLmxvYWREYXRhU3RvcmUoZmllbGQsIHJlcywgbnVsbCwg\nX2NvbHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJlcy5j\nbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgbG9hZEVtYmVkZGVkKHNtLCBz\ndG9yZSwgZmV0Y2gsIHZhbCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB0\nb0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkg\newogICAgICAgIHJldHVybiBIYW5kbGVyU3RyYXRlZ2llcy50b0RhdGFTdG9y\nZVZhbHVlKGZpZWxkLCB2YWwsIF9jb2xzLCBzdG9yZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYXBwZW5kSXNOdWxsKFNRTEJ1ZmZlciBzcWwsIFNlbGVj\ndCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBqb2luKGpv\naW5zLCBmYWxzZSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29s\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaSA+IDApCiAgICAg\nICAgICAgICAgICBzcWwuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBz\ncWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhfY29sc1tpXSwgam9pbnMp\nKS5hcHBlbmQoIiBJUyAiKS4KICAgICAgICAgICAgICAgIGFwcGVuZFZhbHVl\nKG51bGwsIF9jb2xzW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYXBwZW5kSXNOb3ROdWxsKFNRTEJ1ZmZlciBzcWwsIFNlbGVjdCBz\nZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBqb2luKGpvaW5z\nLCBmYWxzZSk7CiAgICAgICAgaWYgKF9jb2xzLmxlbmd0aCA+IDEpCiAgICAg\nICAgICAgIHNxbC5hcHBlbmQoIigiKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChp\nID4gMCkKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBPUiAiKTsKICAg\nICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoX2NvbHNb\naV0sIGpvaW5zKSkuCiAgICAgICAgICAgICAgICBhcHBlbmQoIiBJUyBOT1Qg\nIikuYXBwZW5kVmFsdWUobnVsbCwgX2NvbHNbaV0pOwogICAgICAgIH0KICAg\nICAgICBpZiAoX2NvbHMubGVuZ3RoID4gMSkKICAgICAgICAgICAgc3FsLmFw\ncGVuZCgiKSIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luKEpvaW5z\nIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIpIHsKICAgICAgICByZXR1cm4g\nZmllbGQuam9pbihqb2lucywgZm9yY2VPdXRlciwgZmFsc2UpOwogICAgfQoK\nICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oSm9pbnMgam9pbnMsIGJv\nb2xlYW4gZm9yY2VPdXRlciwKICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7\nCiAgICAgICAgaWYgKHRyYXZlcnNlKQogICAgICAgICAgICBIYW5kbGVyU3Ry\nYXRlZ2llcy5hc3NlcnRKb2luYWJsZShmaWVsZCk7CiAgICAgICAgcmV0dXJu\nIGpvaW5zOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZFByb2plY3Rp\nb24oSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBIYW5kbGVy\nU3RyYXRlZ2llcy5sb2FkT2JqZWN0KGZpZWxkLCBudWxsLCBzdG9yZSwgZmV0\nY2gsIHJlcywKICAgICAgICAgICAgam9pbnMsIF9jb2xzLCBfbG9hZCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uYWJsZSgpIHsKICAg\nICAgICByZXR1cm4gIV9sb2IgJiYgIWZpZWxkLmlzSm9pbk91dGVyKCkKICAg\nICAgICAgICAgJiYgZmllbGQuZ2V0SGFuZGxlcigpLmlzVmVyc2lvbmFibGUo\nZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBy\nbSwKICAgICAgICBPYmplY3QgcHJldlZhbHVlKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIFJvdyByb3cgPSBmaWVsZC5nZXRSb3co\nc20sIHN0b3JlLCBybSwgUm93LkFDVElPTl9VUERBVEUpOwogICAgICAgIGlm\nIChyb3cgIT0gbnVsbCkKICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMu\nd2hlcmUoZmllbGQsIHByZXZWYWx1ZSwgc3RvcmUsIHJvdywgX2NvbHMpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nSm9pbmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBpbnQgZ2V0RmllbGRJbmRleCgpIHsK\nICAgICAgICByZXR1cm4gZmllbGQuZ2V0SW5kZXgoKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldFByaW1hcnlLZXlWYWx1ZShSZXN1bHQgcmVzLCBD\nb2x1bW5bXSBjb2xzLCBGb3JlaWduS2V5IGZrLAogICAgICAgIEpEQkNTdG9y\nZSBzdG9yZSwgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBPYmplY3QgdmFs\nID0gbnVsbDsKICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMSkgewogICAg\nICAgICAgICBjb2wgPSBjb2xzWzBdOwogICAgICAgICAgICBpZiAoZmsgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGNvbCA9IGZrLmdldENvbHVtbihjb2wp\nOwogICAgICAgICAgICB2YWwgPSByZXMuZ2V0T2JqZWN0KGNvbCwgZmllbGQu\nZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgZ2V0UmVzdWx0QXJndW1l\nbnQoZmllbGQpLCBqb2lucyk7CiAgICAgICAgfSBlbHNlIGlmIChjb2xzLmxl\nbmd0aCA+IDEpIHsKICAgICAgICAgICAgT2JqZWN0W10gdmFscyA9IG5ldyBP\nYmplY3RbY29scy5sZW5ndGhdOwogICAgICAgICAgICBPYmplY3RbXSBhcmdz\nID0gKE9iamVjdFtdKSBmaWVsZC5nZXRIYW5kbGVyKCkuCiAgICAgICAgICAg\nICAgICBnZXRSZXN1bHRBcmd1bWVudChmaWVsZCk7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgdmFscy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgY29sID0gY29sc1tpXTsKICAgICAgICAgICAgICAgIGlmIChm\nayAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbCA9IGZrLmdldENv\nbHVtbihjb2wpOwogICAgICAgICAgICAgICAgdmFsc1tpXSA9IHJlcy5nZXRP\nYmplY3QoY29sLCAoYXJncyA9PSBudWxsKSA/IG51bGwgOiBhcmdzW2ldLAog\nICAgICAgICAgICAgICAgICAgIGpvaW5zKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICB2YWwgPSB2YWxzOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nZmllbGQuZ2V0SGFuZGxlcigpLnRvT2JqZWN0VmFsdWUoZmllbGQsIHZhbCk7\nCiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoKSB7CiAg\nICAgICAgcmV0dXJuIF9jb2xzOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Rb\nXSBnZXRSZXN1bHRBcmd1bWVudHMoKSB7CiAgICAgICAgcmV0dXJuIF9hcmdz\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Sm9pblZhbHVlKE9iamVj\ndCBmaWVsZFZhbCwgQ29sdW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAg\nICAgICAgT2JqZWN0IHZhbCA9IEhhbmRsZXJTdHJhdGVnaWVzLnRvRGF0YVN0\nb3JlVmFsdWUoZmllbGQsIGZpZWxkVmFsLAogICAgICAgICAgICBfY29scywg\nc3RvcmUpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCB8fCBfY29scy5sZW5n\ndGggPCAyKQogICAgICAgICAgICByZXR1cm4gdmFsOwoKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICBpZiAoX2NvbHNbaV0gPT0gY29sKQogICAgICAgICAgICAgICAgcmV0dXJu\nICgoT2JqZWN0W10pIHZhbClbaV07CiAgICAgICAgdGhyb3cgbmV3IEludGVy\nbmFsRXhjZXB0aW9uKCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRK\nb2luVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ29sdW1uIGNvbCwK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1cm4gZ2V0\nSm9pblZhbHVlKHNtLmZldGNoKGZpZWxkLmdldEluZGV4KCkpLCBjb2wsIHN0\nb3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQXNzaWduZWRW\nYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgQ29sdW1uIGNvbCwgT2JqZWN0IGF1dG9JbmMpIHsKICAgICAg\nICBPYmplY3QgZGF0YTsKICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID09IDEp\nCiAgICAgICAgICAgIGRhdGEgPSBKYXZhVHlwZXMuY29udmVydChhdXRvSW5j\nLCBjb2wuZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIG11bHRpcGxlIGNvbHVtbnM7IGhhdmUgdG8gZ2V0IGN1cnJlbnQg\ndmFsdWUsIHJlcGxhY2UgdGhpcyBjb2wncwogICAgICAgICAgICAvLyB2YWx1\nZSB3aXRoIHRoZSBnaXZlbiBvbmUsIGFuZCByZXNldAogICAgICAgICAgICBk\nYXRhID0gZmllbGQuZ2V0SGFuZGxlcigpLnRvRGF0YVN0b3JlVmFsdWUoZmll\nbGQsCiAgICAgICAgICAgICAgICBzbS5mZXRjaChmaWVsZC5nZXRJbmRleCgp\nKSwgc3RvcmUpOwogICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgZGF0YSA9IG5ldyBPYmplY3RbX2NvbHMubGVuZ3RoXTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9jb2xzW2ldID09IGNvbCkg\newogICAgICAgICAgICAgICAgICAgICgoT2JqZWN0W10pIGRhdGEpW2ldID0g\nSmF2YVR5cGVzLmNvbnZlcnQoYXV0b0luYywgCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbC5nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgT2JqZWN0IHZhbCA9IGZpZWxkLmdldEhhbmRsZXIo\nKS50b09iamVjdFZhbHVlKGZpZWxkLCBkYXRhKTsKICAgICAgICBzbS5zdG9y\nZShmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFbWJlZGRhYmxlIGltcGxl\nbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIHB1YmxpYyBDb2x1bW5JTyBnZXRDb2x1bW5JTygpIHsKICAgICAgICBy\nZXR1cm4gX2lvOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9FbWJlZGRl\nZERhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkg\newogICAgICAgIC8vIGRvbid0IHVzZSBIYW5kbGVyU3RyYXRlZ2llcy50b0Rh\ndGFTdG9yZVZhbHVlIGIvYyB3ZSB3YW50IHJlbGF0aW9uIGlkcwogICAgICAg\nIC8vIHRvIGJlIHJlcHJlc2VudGVkIGJ5IHN0YXRlIG1hbmFnZXJzLCBub3Qg\ndGhlIHNlcmlhbGl6ZWQgaWQgdmFsdWUKICAgICAgICB2YWwgPSBmaWVsZC5n\nZXRIYW5kbGVyKCkudG9EYXRhU3RvcmVWYWx1ZShmaWVsZCwgdmFsLCBzdG9y\nZSk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsICYmIF9jb2xzLmxlbmd0aCA+\nIDEpCiAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0W19jb2xzLmxlbmd0\naF07CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IHRvRW1iZWRkZWRPYmplY3RWYWx1ZShPYmplY3QgdmFsKSB7CiAgICAg\nICAgaWYgKCFfbG9hZCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmdldEhh\nbmRsZXIoKS50b09iamVjdFZhbHVlKGZpZWxkLCB2YWwpOwogICAgICAgIHJl\ndHVybiBVTlNVUFBPUlRFRDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2Fk\nRW1iZWRkZWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0\nb3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9i\namVjdCB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKHZhbCA9PSBudWxsICYmIF9jb2xzLmxlbmd0aCA+IDEpCiAgICAg\nICAgICAgIHZhbCA9IG5ldyBPYmplY3RbX2NvbHMubGVuZ3RoXTsKICAgICAg\nICBpZiAoX2xvYWQpCiAgICAgICAgICAgIHNtLnN0b3JlKGZpZWxkLmdldElu\nZGV4KCksIGZpZWxkLmdldEhhbmRsZXIoKS4KICAgICAgICAgICAgICAgIHRv\nT2JqZWN0VmFsdWUoZmllbGQsIHZhbCwgc20sIHN0b3JlLCBmZXRjaCkpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc20uc3RvcmUoZmllbGQuZ2V0SW5k\nZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgdG9P\nYmplY3RWYWx1ZShmaWVsZCwgdmFsKSk7CiAgICB9Cn0K\n","encoding":"base64"}

