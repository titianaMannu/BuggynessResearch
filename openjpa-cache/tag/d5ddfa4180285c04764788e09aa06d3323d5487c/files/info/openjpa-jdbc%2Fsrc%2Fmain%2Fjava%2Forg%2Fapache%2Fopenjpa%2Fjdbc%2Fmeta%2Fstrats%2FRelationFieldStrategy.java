{"sha":"1436431282a037f7cda92e95aa1a0ccb9efd3af5","node_id":"MDQ6QmxvYjIwNjM2NDoxNDM2NDMxMjgyYTAzN2Y3Y2RhOTJlOTVhYTFhMGNjYjllZmQzYWY1","size":34788,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1436431282a037f7cda92e95aa1a0ccb9efd3af5","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkVtYmVkZGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuSm9pbmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLk1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZ0luZm87Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklP\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVp\nZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlJvdzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNR\nTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5T\nZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2Vs\nZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9w\nZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBw\nbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGlsLk51\nbWJlcnM7CgovKioKICogTWFwcGluZyBmb3IgYSBzaW5nbGUtdmFsdWVkIHJl\nbGF0aW9uIHRvIGFub3RoZXIgZW50aXR5LgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAc2luY2UgMC40LjAKICovCnB1YmxpYyBjbGFzcyBSZWxhdGlv\nbkZpZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgQWJzdHJhY3RGaWVsZFN0cmF0\nZWd5CiAgICBpbXBsZW1lbnRzIEpvaW5hYmxlLCBFbWJlZGRhYmxlIHsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKFJlbGF0aW9uRmllbGRTdHJhdGVn\neS5jbGFzcyk7CgogICAgcHJpdmF0ZSBCb29sZWFuIF9ma09pZCA9IG51bGw7\nCgogICAgcHVibGljIHZvaWQgbWFwKGJvb2xlYW4gYWRhcHQpIHsKICAgICAg\nICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuUEMgfHwg\nZmllbGQuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LXJlbGF0aW9uIiwgZmll\nbGQpKTsKCiAgICAgICAgZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFZhbHVl\nSW5mbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cwogICAgICAgICAgICAo\nZmllbGQuZ2V0S2V5KCksICFhZGFwdCk7CiAgICAgICAgZmllbGQuZ2V0RWxl\nbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5hc3NlcnROb1NjaGVtYUNv\nbXBvbmVudHMKICAgICAgICAgICAgKGZpZWxkLmdldEVsZW1lbnQoKSwgIWFk\nYXB0KTsKICAgICAgICBib29sZWFuIGNyaXRlcmlhID0gZmllbGQuZ2V0VmFs\ndWVJbmZvKCkuZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpOwoKICAgICAgICAvLyBj\naGVjayBmb3IgbmFtZWQgaW52ZXJzZQogICAgICAgIEZpZWxkTWFwcGluZyBt\nYXBwZWQgPSBmaWVsZC5nZXRNYXBwZWRCeU1hcHBpbmcoKTsKICAgICAgICBp\nZiAobWFwcGVkICE9IG51bGwpIHsKICAgICAgICAgICAgZmllbGQuZ2V0TWFw\ncGluZ0luZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBvbmVudHMoZmllbGQsICFh\nZGFwdCk7CiAgICAgICAgICAgIGZpZWxkLmdldFZhbHVlSW5mbygpLmFzc2Vy\ndE5vU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsKICAgICAgICAg\nICAgbWFwcGVkLnJlc29sdmUobWFwcGVkLk1PREVfTUVUQSB8IG1hcHBlZC5N\nT0RFX01BUFBJTkcpOwoKICAgICAgICAgICAgaWYgKCFtYXBwZWQuaXNNYXBw\nZWQoKSB8fCBtYXBwZWQuaXNTZXJpYWxpemVkKCkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm1hcHBl\nZC1ieS11bm1hcHBlZCIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQsIG1h\ncHBlZCkpOwoKICAgICAgICAgICAgaWYgKG1hcHBlZC5nZXRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAgICAgaWYgKG1hcHBl\nZC5nZXRKb2luRGlyZWN0aW9uKCkgPT0gbWFwcGVkLkpPSU5fRk9SV0FSRCkg\newogICAgICAgICAgICAgICAgICAgIGZpZWxkLnNldEpvaW5EaXJlY3Rpb24o\nZmllbGQuSk9JTl9JTlZFUlNFKTsKICAgICAgICAgICAgICAgICAgICBmaWVs\nZC5zZXRDb2x1bW5zKG1hcHBlZC5nZXREZWZpbmluZ01hcHBpbmcoKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzVHlwZVVuam9pbmVkU3Vi\nY2xhc3MobWFwcGVkKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAgICAgKCJtYXBwZWQtaW52ZXJzZS11bmpvaW5lZCIsIGZpZWxkLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldERl\nZmluaW5nTWFwcGluZygpLCBtYXBwZWQpKTsKCiAgICAgICAgICAgICAgICBm\naWVsZC5zZXRGb3JlaWduS2V5KG1hcHBlZC5nZXRGb3JlaWduS2V5CiAgICAg\nICAgICAgICAgICAgICAgKGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpKSk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAobWFwcGVkLmdldEVsZW1lbnQoKS5n\nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAg\nICAgaWYgKGlzVHlwZVVuam9pbmVkU3ViY2xhc3MobWFwcGVkLmdldEVsZW1l\nbnRNYXBwaW5nKCkpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAg\nICAgICAoIm1hcHBlZC1pbnZlcnNlLXVuam9pbmVkIiwgZmllbGQuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0RGVm\naW5pbmdNYXBwaW5nKCksIG1hcHBlZCkpOwoKICAgICAgICAgICAgICAgIC8v\nIHdhcm4gdGhlIHVzZXIgYWJvdXQgbWFraW5nIHRoZSBjb2xsZWN0aW9uIHNp\nZGUgdGhlIG93bmVyCiAgICAgICAgICAgICAgICBMb2cgbG9nID0gZmllbGQu\nZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpOwogICAgICAgICAgICAgICAgaWYg\nKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9n\nLmluZm8oX2xvYy5nZXQoImNvbGwtb3duZXIiLCBmaWVsZCwgbWFwcGVkKSk7\nCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRGb3JlaWduS2V5KG1hcHBlZC5n\nZXRFbGVtZW50TWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdldEZv\ncmVpZ25LZXkoKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qt\naW52LXJlbGF0aW9uIiwKICAgICAgICAgICAgICAgICAgICBmaWVsZCwgbWFw\ncGVkKSk7CgogICAgICAgICAgICBmaWVsZC5zZXRVc2VDbGFzc0NyaXRlcmlh\nKGNyaXRlcmlhKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdGhpcyBpcyBuZWNlc3NhcnkgdG8gc3VwcG9ydCBvcGVuanBh\nIDMgbWFwcGluZ3MsIHdoaWNoIGRpZG4ndAogICAgICAgIC8vIGRpZmZlcmVu\ndGlhdGUgYmV0d2VlbiBzZWNvbmRhcnkgdGFibGUgam9pbnMgYW5kIHJlbGF0\naW9ucyBidWlsdAogICAgICAgIC8vIGFyb3VuZCBhbiBpbnZlcnNlIGtleTog\nY2hlY2sgdG8gc2VlIGlmIHdlJ3JlIG1hcHBlZCBhcyBhIHNlY29uZGFyeQog\nICAgICAgIC8vIHRhYmxlIGpvaW4gYnV0IHdlJ3JlIGluIHRoZSB0YWJsZSBv\nZiB0aGUgcmVsYXRlZCB0eXBlLCBhbmQgaWYgc28KICAgICAgICAvLyBzd2l0\nY2ggb3VyIGpvaW4gbWFwcGluZyBpbmZvIHRvIG91ciB2YWx1ZSBtYXBwaW5n\nIGluZm8KICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0gZmllbGQuZ2V0TWFw\ncGluZ0luZm8oKS5nZXRUYWJsZU5hbWUoKTsKICAgICAgICBUYWJsZSB0YWJs\nZSA9IGZpZWxkLmdldFR5cGVNYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgICAg\nICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZvID0gZmllbGQuZ2V0VmFsdWVJbmZv\nKCk7CiAgICAgICAgaWYgKHRhYmxlTmFtZSAhPSBudWxsICYmIHRhYmxlICE9\nIG51bGwKICAgICAgICAgICAgJiYgKHRhYmxlTmFtZS5lcXVhbHNJZ25vcmVD\nYXNlKHRhYmxlLmdldE5hbWUoKSkKICAgICAgICAgICAgfHwgdGFibGVOYW1l\nLmVxdWFsc0lnbm9yZUNhc2UodGFibGUuZ2V0RnVsbE5hbWUoKSkpKSB7CiAg\nICAgICAgICAgIHZpbmZvLnNldEpvaW5EaXJlY3Rpb24oTWFwcGluZ0luZm8u\nSk9JTl9JTlZFUlNFKTsKICAgICAgICAgICAgdmluZm8uc2V0Q29sdW1ucyhm\naWVsZC5nZXRNYXBwaW5nSW5mbygpLmdldENvbHVtbnMoKSk7CiAgICAgICAg\nICAgIGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVOYW1lKG51bGwp\nOwogICAgICAgICAgICBmaWVsZC5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVt\nbnMobnVsbCk7CiAgICAgICAgfQoKICAgICAgICBmaWVsZC5tYXBKb2luKGFk\nYXB0LCBmYWxzZSk7CiAgICAgICAgaWYgKGZpZWxkLmdldFR5cGVNYXBwaW5n\nKCkuaXNNYXBwZWQoKSkgewogICAgICAgICAgICBGb3JlaWduS2V5IGZrID0g\ndmluZm8uZ2V0VHlwZUpvaW4oZmllbGQsIGZpZWxkLmdldE5hbWUoKSwgdHJ1\nZSwKICAgICAgICAgICAgICAgIGFkYXB0KTsKICAgICAgICAgICAgZmllbGQu\nc2V0Rm9yZWlnbktleShmayk7CiAgICAgICAgICAgIGZpZWxkLnNldENvbHVt\nbklPKHZpbmZvLmdldENvbHVtbklPKCkpOwogICAgICAgICAgICBpZiAodmlu\nZm8uZ2V0Sm9pbkRpcmVjdGlvbigpID09IHZpbmZvLkpPSU5fSU5WRVJTRSkK\nICAgICAgICAgICAgICAgIGZpZWxkLnNldEpvaW5EaXJlY3Rpb24oZmllbGQu\nSk9JTl9JTlZFUlNFKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgUmVs\nYXRpb25TdHJhdGVnaWVzLm1hcFJlbGF0aW9uVG9Vbm1hcHBlZFBDKGZpZWxk\nLCBmaWVsZC5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBhZGFwdCk7Cgog\nICAgICAgIGZpZWxkLnNldFVzZUNsYXNzQ3JpdGVyaWEoY3JpdGVyaWEpOwog\nICAgICAgIGZpZWxkLm1hcFByaW1hcnlLZXkoYWRhcHQpOwogICAgICAgIFBy\naW1hcnlLZXkgcGsgPSBmaWVsZC5nZXRUYWJsZSgpLmdldFByaW1hcnlLZXko\nKTsKICAgICAgICBpZiAoZmllbGQuaXNQcmltYXJ5S2V5KCkpIHsKICAgICAg\nICAgICAgQ29sdW1uW10gY29scyA9IGZpZWxkLmdldENvbHVtbnMoKTsKICAg\nICAgICAgICAgaWYgKHBrICE9IG51bGwgJiYgKGFkYXB0IHx8IHBrLmlzTG9n\naWNhbCgpKSkKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBway5hZGRD\nb2x1bW4oY29sc1tpXSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZpZWxkLmdl\ndERlZmluaW5nTWFwcGluZygpLnNldEpvaW5hYmxlKGNvbHNbaV0sIHRoaXMp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFwIGNvbnN0cmFpbnRzIGFmdGVy\nIHBrIHNvIHdlIGRvbid0IHJlLWluZGV4IC8gcmUtdW5pcXVlIHBrIGNvbAog\nICAgICAgIGZpZWxkLm1hcENvbnN0cmFpbnRzKGZpZWxkLmdldE5hbWUoKSwg\nYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIg\nb3VyIGRlZmluaW5nIG1hcHBpbmcgaXMgYW4gdW5qb2luZWQgc3ViY2xhc3Mg\nb2YKICAgICAqIHRoZSB0eXBlIG9mIHRoZSBnaXZlbiB2YWx1ZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGlzVHlwZVVuam9pbmVkU3ViY2xhc3Mo\nVmFsdWVNYXBwaW5nIG1hcHBlZCkgewogICAgICAgIENsYXNzTWFwcGluZyBk\nZWYgPSBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKTsKICAgICAgICBmb3Ig\nKDsgZGVmICE9IG51bGw7IGRlZiA9IGRlZi5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKSkKICAgICAgICAgICAgaWYgKGRlZiA9PSBtYXBwZWQu\nZ2V0VHlwZU1hcHBpbmcoKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBpbml0aWFsaXplKCkgewogICAgICAgIGZpZWxkLnNldFVzZXNJbnRlcm1l\nZGlhdGUodHJ1ZSk7CgogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5n\nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAg\nICAgICAgIF9ma09pZCA9IEJvb2xlYW4uVFJVRTsKICAgICAgICBlbHNlIGlm\nIChmaWVsZC5nZXRKb2luRGlyZWN0aW9uKCkgIT0gRmllbGRNYXBwaW5nLkpP\nSU5fSU5WRVJTRSkKICAgICAgICAgICAgX2ZrT2lkID0gZmllbGQuZ2V0VHlw\nZU1hcHBpbmcoKS5pc0ZvcmVpZ25LZXlPYmplY3RJZChmayk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGVk\nQnkoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgcmVsID0gUmVsYXRpb25TdHJhdGVnaWVzLmdl\ndFN0YXRlTWFuYWdlcgogICAgICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVs\nZChmaWVsZC5nZXRJbmRleCgpKSwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAg\nICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxkLkpP\nSU5fSU5WRVJTRSkKICAgICAgICAgICAgdXBkYXRlSW52ZXJzZShzbSwgcmVs\nLCBzdG9yZSwgcm0pOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBSb3cg\ncm93ID0gZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJvdy5BQ1RJT05f\nSU5TRVJUKTsKICAgICAgICAgICAgaWYgKHJvdyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgZmllbGQuc2V0Rm9yZWlnbktleShyb3csIHJlbCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZp\nZWxkLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHJlbCA9IFJlbGF0aW9u\nU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgKHNtLmZl\ndGNoT2JqZWN0RmllbGQoZmllbGQuZ2V0SW5kZXgoKSksIHN0b3JlLmdldENv\nbnRleHQoKSk7CgogICAgICAgIGlmIChmaWVsZC5nZXRKb2luRGlyZWN0aW9u\nKCkgPT0gZmllbGQuSk9JTl9JTlZFUlNFKSB7CiAgICAgICAgICAgIG51bGxJ\nbnZlcnNlKHNtLCBybSk7CiAgICAgICAgICAgIHVwZGF0ZUludmVyc2Uoc20s\nIHJlbCwgc3RvcmUsIHJtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBSb3cgcm93ID0gZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJvdy5B\nQ1RJT05fVVBEQVRFKTsKICAgICAgICAgICAgaWYgKHJvdyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgZmllbGQuc2V0Rm9yZWlnbktleShyb3csIHJlbCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZShPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFn\nZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigp\nID09IGZpZWxkLkpPSU5fSU5WRVJTRSkgewogICAgICAgICAgICBpZiAoc20u\nZ2V0TG9hZGVkKCkuZ2V0KGZpZWxkLmdldEluZGV4KCkpKSB7CiAgICAgICAg\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHJlbCA9IFJlbGF0aW9uU3Ry\nYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIoc20uCiAgICAgICAgICAgICAgICAg\nICAgZmV0Y2hPYmplY3RGaWVsZChmaWVsZC5nZXRJbmRleCgpKSwgc3RvcmUu\nZ2V0Q29udGV4dCgpKTsKICAgICAgICAgICAgICAgIHVwZGF0ZUludmVyc2Uo\nc20sIHJlbCwgc3RvcmUsIHJtKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICBudWxsSW52ZXJzZShzbSwgcm0pOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIGZpZWxkLmRlbGV0ZVJvdyhzbSwgc3RvcmUsIHJt\nKTsKCiAgICAgICAgICAgIC8vIGlmIG91ciBmb3JlaWduIGtleSBoYXMgYSBk\nZWxldGUgYWN0aW9uLCB3ZSBuZWVkIHRvIHNldCB0aGUKICAgICAgICAgICAg\nLy8gcmVsYXRlZCBvYmplY3Qgc28gY29uc3RyYWludHMgY2FuIGJlIGV2YWx1\nYXRlZAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHJlbCA9IFJl\nbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAgICAg\nICAgIChzbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkLmdldEluZGV4KCkpLCBz\ndG9yZS5nZXRDb250ZXh0KCkpOwogICAgICAgICAgICBpZiAocmVsICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5n\nZXRGb3JlaWduS2V5KChDbGFzc01hcHBpbmcpCiAgICAgICAgICAgICAgICAg\nICAgcmVsLmdldE1ldGFEYXRhKCkpOwogICAgICAgICAgICAgICAgaWYgKGZr\nLmdldERlbGV0ZUFjdGlvbigpID09IEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RS\nSUNUKSB7CiAgICAgICAgICAgICAgICAgICAgUm93IHJvdyA9IGZpZWxkLmdl\ndFJvdyhzbSwgc3RvcmUsIHJtLCBSb3cuQUNUSU9OX0RFTEVURSk7CiAgICAg\nICAgICAgICAgICAgICAgcm93LnNldEZvcmVpZ25LZXkoZmssIG51bGwsIHJl\nbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBOdWxsIGludmVyc2UgcmVsYXRpb25z\nIHRoYXQgcmVmZXJlbmNlIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBudWxsSW52ZXJzZShPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChmaWVsZC5nZXRVc2VDbGFzc0NyaXRlcmlhKCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRm9yZWlnbktleSBmayA9\nIGZpZWxkLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBDb2x1bW5JTyBpbyA9\nIGZpZWxkLmdldENvbHVtbklPKCk7CiAgICAgICAgaWYgKCFpby5pc0FueVVw\nZGF0YWJsZShmaywgdHJ1ZSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gbnVsbCBpbnZlcnNlIGlmIG5vdCBhbHJlYWR5IGVuZm9yY2VkIGJ5\nIGZrCiAgICAgICAgaWYgKGZpZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBp\nbmdzKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9u\nU3RyYXRlZ2llcy51bmludmVyc2FibGUoZmllbGQpOwogICAgICAgIFJvdyBy\nb3cgPSBybS5nZXRBbGxSb3dzKGZrLmdldFRhYmxlKCksIFJvdy5BQ1RJT05f\nVVBEQVRFKTsKICAgICAgICByb3cuc2V0Rm9yZWlnbktleShmaywgaW8sIG51\nbGwpOwogICAgICAgIHJvdy53aGVyZUZvcmVpZ25LZXkoZmssIHNtKTsKICAg\nICAgICBybS5mbHVzaEFsbFJvd3Mocm93KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIHVwZGF0ZXMgdGhlIGludmVyc2UgY29sdW1ucyBv\nZiBvdXIgcmVsYXRpb24KICAgICAqIHdpdGggdGhlIGdpdmVuIG9iamVjdC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUludmVyc2UoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgT3BlbkpQQVN0YXRlTWFuYWdlciByZWwsCiAg\nICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChyZWwgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGb3JlaWduS2V5IGZr\nID0gZmllbGQuZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIENvbHVtbklPIGlv\nID0gZmllbGQuZ2V0Q29sdW1uSU8oKTsKCiAgICAgICAgaW50IGFjdGlvbjsK\nICAgICAgICBpZiAocmVsLmlzTmV3KCkgJiYgIXJlbC5pc0ZsdXNoZWQoKSkg\newogICAgICAgICAgICBpZiAoc20uaXNEZWxldGVkKCkgfHwgIWlvLmlzQW55\nSW5zZXJ0YWJsZShmaywgZmFsc2UpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBhY3Rpb24gPSBSb3cuQUNUSU9OX0lOU0VSVDsKICAg\nICAgICB9IGVsc2UgaWYgKHJlbC5pc0RlbGV0ZWQoKSkgewogICAgICAgICAg\nICBpZiAocmVsLmlzRmx1c2hlZCgpIHx8ICFzbS5pc0RlbGV0ZWQoKSkKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYWN0aW9uID0gUm93\nLkFDVElPTl9ERUxFVEU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\naWYgKHNtLmlzRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgc20gPSBudWxs\nOwogICAgICAgICAgICBpZiAoIWlvLmlzQW55VXBkYXRhYmxlKGZrLCBzbSA9\nPSBudWxsKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nYWN0aW9uID0gUm93LkFDVElPTl9VUERBVEU7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoZmllbGQuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKS5sZW5n\ndGggIT0gMSkKICAgICAgICAgICAgdGhyb3cgUmVsYXRpb25TdHJhdGVnaWVz\nLnVuaW52ZXJzYWJsZShmaWVsZCk7CgogICAgICAgIC8vIGdldCB0aGUgcm93\nIGZvciB0aGUgaW52ZXJzZSBvYmplY3Q7IHRoZSByb3cgbWlnaHQgYmUgaW4g\nYSBzZWNvbmRhcnkKICAgICAgICAvLyB0YWJsZSBpZiB0aGVyZSBpcyBhIGZp\nZWxkIGNvbnRyb2xsaW5nIHRoZSBmb3JlaWduIGtleQogICAgICAgIFJvdyBy\nb3cgPSBudWxsOwogICAgICAgIEZpZWxkTWFwcGluZ1tdIGludnMgPSBmaWVs\nZC5nZXRJbnZlcnNlTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGludnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGlu\ndnNbaV0uZ2V0TWFwcGVkQnlNZXRhRGF0YSgpID09IGZpZWxkCiAgICAgICAg\nICAgICAgICAmJiBpbnZzW2ldLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDKSB7CiAgICAgICAgICAgICAgICByb3cgPSBpbnZzW2ldLmdldFJvdyhy\nZWwsIHN0b3JlLCBybSwgYWN0aW9uKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENsYXNzTWFwcGlu\nZyByZWxNYXBwaW5nID0gZmllbGQuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAg\nICBpZiAocm93ID09IG51bGwpCiAgICAgICAgICAgIHJvdyA9IHJtLmdldFJv\ndyhyZWxNYXBwaW5nLmdldFRhYmxlKCksIGFjdGlvbiwgcmVsLCB0cnVlKTsK\nCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhbiB1cGRhdGUsIHRoaXMgbWlnaHQg\nYmUgdGhlIG9ubHkgbW9kIHRvIHRoZSByb3csIHNvCiAgICAgICAgLy8gbWFr\nZSBzdXJlIHRoZSB3aGVyZSBjb25kaXRpb24gaXMgc2V0CiAgICAgICAgaWYg\nKGFjdGlvbiA9PSBSb3cuQUNUSU9OX1VQREFURQogICAgICAgICAgICAmJiBy\nb3cuZ2V0VGFibGUoKSA9PSByZWxNYXBwaW5nLmdldFRhYmxlKCkpCiAgICAg\nICAgICAgIHJvdy53aGVyZVByaW1hcnlLZXkocmVsKTsKCiAgICAgICAgLy8g\ndXBkYXRlIHRoZSBpbnZlcnNlIHBvaW50ZXIgd2l0aCBvdXIgb2lkIHZhbHVl\nCiAgICAgICAgcm93LnNldEZvcmVpZ25LZXkoZmssIGlvLCBzbSk7CiAgICB9\nCgogICAgcHVibGljIGludCBzdXBwb3J0c1NlbGVjdChTZWxlY3Qgc2VsLCBp\nbnQgdHlwZSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsK\nICAgICAgICBpZiAodHlwZSA9PSBTZWxlY3QuVFlQRV9KT0lOTEVTUykKICAg\nICAgICAgICAgcmV0dXJuIChmaWVsZC5nZXRKb2luRGlyZWN0aW9uKCkgIT0g\nZmllbGQuSk9JTl9JTlZFUlNFCiAgICAgICAgICAgICAgICAmJiBzZWwuaXNT\nZWxlY3RlZChmaWVsZC5nZXRUYWJsZSgpKSkgPyAxIDogMDsKICAgICAgICBp\nZiAodHlwZSA9PSBTZWxlY3QuVFlQRV9UV09fUEFSVCkKICAgICAgICAgICAg\ncmV0dXJuIDE7CgogICAgICAgIC8vIGFscmVhZHkgY2FjaGVkPwogICAgICAg\nIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBz\nbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgIGlmIChzdG9yZS5nZXRDb250ZXh0KCkuZmluZENhY2hlZChvaWQsIG51\nbGwpICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAg\nICB9CgogICAgICAgIENsYXNzTWFwcGluZ1tdIGNsc3MgPSBmaWVsZC5nZXRJ\nbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOwogICAgICAgIHN3aXRjaCAodHlw\nZSkgewogICAgICAgICAgICBjYXNlIFNlbGVjdC5FQUdFUl9QQVJBTExFTDoK\nICAgICAgICAgICAgICAgIHJldHVybiBjbHNzLmxlbmd0aDsKICAgICAgICAg\nICAgY2FzZSBTZWxlY3QuRUFHRVJfT1VURVI6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gKGNsc3MubGVuZ3RoID09IDEgJiYgc3RvcmUuZ2V0REJEaWN0aW9u\nYXJ5KCkuY2FuT3V0ZXJKb2luCiAgICAgICAgICAgICAgICAgICAgKHNlbC5n\nZXRKb2luU3ludGF4KCksIGZpZWxkLmdldEZvcmVpZ25LZXkoY2xzc1swXSkp\nKSA/IDEgOgogICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgIGNh\nc2UgU2VsZWN0LkVBR0VSX0lOTkVSOgogICAgICAgICAgICAgICAgcmV0dXJu\nIChjbHNzLmxlbmd0aCA9PSAxKSA/IDEgOiAwOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdEVhZ2VyUGFyYWxsZWwoU2VsZWN0\nRXhlY3V0b3Igc2VsLAogICAgICAgIGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIGZpbmFsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBmaW5hbCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBmaW5hbCBpbnQgZWFnZXJN\nb2RlKSB7CiAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5nW10gY2xzcyA9IGZp\nZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICAgICAgaWYg\nKCEoc2VsIGluc3RhbmNlb2YgVW5pb24pKQogICAgICAgICAgICBzZWxlY3RF\nYWdlclBhcmFsbGVsKChTZWxlY3QpIHNlbCwgY2xzc1swXSwgc3RvcmUsIGZl\ndGNoLCBlYWdlck1vZGUpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBV\nbmlvbiB1bmlvbiA9IChVbmlvbikgc2VsOwogICAgICAgICAgICBpZiAoZmV0\nY2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUgKGZpZWxkLmdldFR5cGVNYXBwaW5n\nKCkpIAogICAgICAgICAgICAgICAgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbi5FQUdFUl9KT0lOKQogICAgICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlv\nbigpOwogICAgICAgICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVj\ndG9yKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNl\nbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICBzZWxl\nY3RFYWdlclBhcmFsbGVsKHNlbCwgY2xzc1tpZHhdLCBzdG9yZSwgZmV0Y2gs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGVhZ2VyTW9kZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFBlcmZvcm0gYW4gZWFnZXIgcGFyYWxsZWwgc2VsZWN0\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VsZWN0RWFnZXJQYXJhbGxl\nbChTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgY2xzLAogICAgICAgIEpEQkNT\ndG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50\nIGVhZ2VyTW9kZSkgewogICAgICAgIHNlbC5zZWxlY3RQcmltYXJ5S2V5KGZp\nZWxkLmdldERlZmluaW5nTWFwcGluZygpKTsKICAgICAgICAvLyBzZXQgYSB2\nYXJpYWJsZSBuYW1lIHRoYXQgZG9lcyBub3QgY29uZmxpY3Qgd2l0aCBhbnkg\naW4gdGhlIHF1ZXJ5OwogICAgICAgIC8vIHVzaW5nIGEgdmFyaWFibGUgZ3Vh\ncmFudGVlcyB0aGF0IHRoZSBzZWxlY3RlZCBkYXRhIHdpbGwgdXNlIGRpZmZl\ncmVudAogICAgICAgIC8vIGFsaWFzZXMgYW5kIGpvaW5zIHRoYW4gYW55IGV4\naXN0aW5nIFdIRVJFIGNvbmRpdGlvbnMgb24gdGhpcyBmaWVsZAogICAgICAg\nIC8vIHRoYXQgbWlnaHQgb3RoZXJ3aXNlIGxpbWl0IHRoZSByZWxhdGlvbnMg\ndGhhdCBtYXRjaAogICAgICAgIEpvaW5zIGpvaW5zID0gc2VsLm5ld0pvaW5z\nKCkuc2V0VmFyaWFibGUoIioiKTsKICAgICAgICBlYWdlckpvaW4oam9pbnMs\nIGNscywgdHJ1ZSk7CiAgICAgICAgc2VsLnNlbGVjdChjbHMsIGZpZWxkLmdl\ndFNlbGVjdFN1YmNsYXNzZXMoKSwgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUs\nIAogICAgICAgICAgICBqb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2VsZWN0RWFnZXJKb2luKFNlbGVjdCBzZWwsIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlKSB7CiAgICAgICAgLy8g\nbGltaXQgdGhlIGVhZ2VyIG1vZGUgdG8gc2luZ2xlIG9uIHJlY3Vyc2l2ZSBl\nYWdlciBmZXRjaGluZyBiL2MKICAgICAgICAvLyBhdCB0aGlzIHBvaW50IHRo\nZSBzZWxlY3QgaGFzIGJlZW4gbW9kaWZpZWQgYW5kIGFuIGF0dGVtcHQgdG8K\nICAgICAgICAvLyBjbG9uZSBpdCBmb3IgYSB0by1tYW55IGVhZ2VyIHNlbGVj\ndCBjYW4gcmVzdWx0IGluIGEgY2xvbmUgdGhhdAogICAgICAgIC8vIHByb2R1\nY2VzIGludmFsaWQgU1FMCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IGZp\nZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKClbMF07CiAgICAgICAg\nYm9vbGVhbiBmb3JjZUlubmVyID0gZmV0Y2guaGFzRmV0Y2hJbm5lckpvaW4o\nZmllbGQuZ2V0RnVsbE5hbWUoZmFsc2UpKSA/CiAgICAgICAgICAgICAgICB0\ncnVlIDogZmFsc2U7CiAgICAgICAgc2VsLnNlbGVjdChjbHMsIGZpZWxkLmdl\ndFNlbGVjdFN1YmNsYXNzZXMoKSwgc3RvcmUsIGZldGNoLAogICAgICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sCiAgICAgICAg\nICAgIGVhZ2VySm9pbihzZWwubmV3Sm9pbnMoKSwgY2xzLCBmb3JjZUlubmVy\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGpvaW5zIG5lZWRl\nZCB0byBzZWxlY3QvbG9hZCBlYWdlciBkYXRhLgogICAgICovCiAgICBwcml2\nYXRlIEpvaW5zIGVhZ2VySm9pbihKb2lucyBqb2lucywgQ2xhc3NNYXBwaW5n\nIGNscywgYm9vbGVhbiBmb3JjZUlubmVyKSB7CiAgICAgICAgYm9vbGVhbiBp\nbnZlcnNlID0gZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxkLkpP\nSU5fSU5WRVJTRTsKICAgICAgICBpZiAoIWludmVyc2UpIHsKICAgICAgICAg\nICAgam9pbnMgPSBqb2luKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIGpv\naW5zID0gc2V0RW1iZWRkZWRWYXJpYWJsZShqb2lucyk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBhbmQgam9pbiBpbnRvIHJlbGF0aW9uCiAgICAgICAgRm9y\nZWlnbktleSBmayA9IGZpZWxkLmdldEZvcmVpZ25LZXkoY2xzKTsKICAgICAg\nICBpZiAoIWZvcmNlSW5uZXIgJiYgZmllbGQuZ2V0TnVsbFZhbHVlKCkgIT0g\nRmllbGRNYXBwaW5nLk5VTExfRVhDRVBUSU9OKQogICAgICAgICAgICByZXR1\ncm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLCBm\naywgZmllbGQuCiAgICAgICAgICAgICAgICBnZXRUeXBlTWFwcGluZygpLCBm\naWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIGludmVyc2UsIGZhbHNlKTsK\nICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5h\nbWUoKSwgZmssIGZpZWxkLmdldFR5cGVNYXBwaW5nKCksIAogICAgICAgICAg\nICBmaWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIGludmVyc2UsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIGpvaW5pbmcgZnJvbSBhbiBl\nbWJlZGRlZCBvd25lciwgdXNlIHZhcmlhYmxlIHRvIGNyZWF0ZSBhIHVuaXF1\nZQogICAgICogYWxpYXMgaW4gY2FzZSBvd25lciBjb250YWlucyBvdGhlciBz\nYW1lLXR5cGVkIGVtYmVkZGVkIHJlbGF0aW9ucy4KICAgICAqLwogICAgcHJp\ndmF0ZSBKb2lucyBzZXRFbWJlZGRlZFZhcmlhYmxlKEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgaWYgKGZpZWxkLmdldERlZmluaW5nTWV0YURhdGEoKS5nZXRF\nbWJlZGRpbmdNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBqb2luczsKICAgICAgICByZXR1cm4gam9pbnMuc2V0VmFyaWFibGUoZmll\nbGQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLgogICAgICAgICAgICBnZXRFbWJl\nZGRpbmdNZXRhRGF0YSgpLmdldEZpZWxkTWV0YURhdGEoKS5nZXROYW1lKCkp\nOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0KFNlbGVjdCBzZWwsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2Rl\nKSB7CiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5EaXJlY3Rpb24oKSA9PSBm\naWVsZC5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAg\nICAgICAvLyBhbHJlYWR5IGNhY2hlZCBvaWQ/CiAgICAgICAgaWYgKHNtICE9\nIG51bGwgJiYgc20uZ2V0SW50ZXJtZWRpYXRlKGZpZWxkLmdldEluZGV4KCkp\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBpZiAo\nIUJvb2xlYW4uVFJVRS5lcXVhbHMoX2ZrT2lkKSkKICAgICAgICAgICAgcmV0\ndXJuIC0xOwogICAgICAgIHNlbC5zZWxlY3QoZmllbGQuZ2V0Q29sdW1ucygp\nLCBmaWVsZC5qb2luKHNlbCkpOwogICAgICAgIHJldHVybiAwOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgbG9hZEVhZ2VyUGFyYWxsZWwoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCByZXMpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHJvY2VzcyBiYXRj\naGVkIHJlc3VsdHMgaWYgd2UgaGF2ZW4ndCBhbHJlYWR5CiAgICAgICAgTWFw\nIHJlbHM7CiAgICAgICAgaWYgKHJlcyBpbnN0YW5jZW9mIFJlc3VsdCkKICAg\nICAgICAgICAgcmVscyA9IHByb2Nlc3NFYWdlclBhcmFsbGVsUmVzdWx0KHNt\nLCBzdG9yZSwgZmV0Y2gsIChSZXN1bHQpIHJlcyk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICByZWxzID0gKE1hcCkgcmVzOwoKICAgICAgICAvLyBzdG9y\nZSBvYmplY3QgZm9yIHRoaXMgb2lkIGluIGluc3RhbmNlCiAgICAgICAgc20u\nc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSwgcmVscy5yZW1vdmUoc20u\nZ2V0T2JqZWN0SWQoKSkpOwogICAgICAgIHJldHVybiByZWxzOwogICAgfQoK\nICAgIC8qKgogICAgICogUHJvY2VzcyB0aGUgZ2l2ZW4gYmF0Y2hlZCByZXN1\nbHQuCiAgICAgKi8KICAgIHByaXZhdGUgTWFwIHByb2Nlc3NFYWdlclBhcmFs\nbGVsUmVzdWx0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRC\nQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBS\nZXN1bHQgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIC8vIGRvIHNhbWUgam9pbnMgYXMgZm9yIGxvYWQKICAgICAgICAvLyMj\nIyBjaGVhdDogd2Uga25vdyB0eXBpY2FsIHJlc3VsdCBqb2lucyBvbmx5IGNh\ncmUgYWJvdXQgdGhlIHJlbGF0aW9uCiAgICAgICAgLy8jIyMgcGF0aDsgdGh1\ncyB3ZSBjYW4gaWdub3JlIGRpZmZlcmVudCBtYXBwaW5ncwogICAgICAgIENs\nYXNzTWFwcGluZ1tdIGNsc3MgPSBmaWVsZC5nZXRJbmRlcGVuZGVudFR5cGVN\nYXBwaW5ncygpOwogICAgICAgIEpvaW5zIGpvaW5zID0gcmVzLm5ld0pvaW5z\nKCkuc2V0VmFyaWFibGUoIioiKTsKICAgICAgICBlYWdlckpvaW4oam9pbnMs\nIGNsc3NbMF0sIHRydWUpOwoKICAgICAgICBNYXAgcmVscyA9IG5ldyBIYXNo\nTWFwKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG93bmVyID0gZmllbGQuZ2V0\nRGVmaW5pbmdNYXBwaW5nKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGNsczsK\nICAgICAgICBPYmplY3Qgb2lkOwogICAgICAgIHdoaWxlIChyZXMubmV4dCgp\nKSB7CiAgICAgICAgICAgIGNscyA9IHJlcy5nZXRCYXNlTWFwcGluZygpOwog\nICAgICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgICAgICBj\nbHMgPSBjbHNzWzBdOwogICAgICAgICAgICBvaWQgPSBvd25lci5nZXRPYmpl\nY3RJZChzdG9yZSwgcmVzLCBudWxsLCB0cnVlLCBudWxsKTsKICAgICAgICAg\nICAgcmVscy5wdXQob2lkLCByZXMubG9hZChjbHMsIHN0b3JlLCBmZXRjaCwg\nam9pbnMpKTsKICAgICAgICB9CiAgICAgICAgcmVzLmNsb3NlKCk7CgogICAg\nICAgIHJldHVybiByZWxzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWRF\nYWdlckpvaW4oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0\nb3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJl\nc3VsdCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIGNscyA9IGZpZWxkLmdldEluZGVwZW5kZW50VHlw\nZU1hcHBpbmdzKClbMF07CiAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQu\nZ2V0SW5kZXgoKSwgcmVzLmxvYWQoY2xzLCBzdG9yZSwgZmV0Y2gsCiAgICAg\nICAgICAgIGVhZ2VySm9pbihyZXMubmV3Sm9pbnMoKSwgY2xzLCBmYWxzZSkp\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRKb2luRGly\nZWN0aW9uKCkgPT0gZmllbGQuSk9JTl9JTlZFUlNFKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgLy8gY2FjaGVkIG9pZD8KICAgICAgICBpZiAoc20g\nIT0gbnVsbCAmJiBzbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgo\nKSkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICgh\nQm9vbGVhbi5UUlVFLmVxdWFscyhfZmtPaWQpKQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgaWYgKCFyZXMuY29udGFpbnNBbGwoZmllbGQuZ2V0Q29s\ndW1ucygpKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBnZXQg\ndGhlIHJlbGF0ZWQgb2JqZWN0J3Mgb2lkCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHJlbE1hcHBpbmcgPSBmaWVsZC5nZXRUeXBlTWFwcGluZygpOwogICAgICAg\nIE9iamVjdCBvaWQgPSBudWxsOwogICAgICAgIGlmIChyZWxNYXBwaW5nLmlz\nTWFwcGVkKCkpIHsKICAgICAgICAgICAgb2lkID0gcmVsTWFwcGluZy5nZXRP\nYmplY3RJZChzdG9yZSwgcmVzLCBmaWVsZC5nZXRGb3JlaWduS2V5KCksCiAg\nICAgICAgICAgICAgICBmaWVsZC5nZXRQb2x5bW9ycGhpYygpICE9IFZhbHVl\nTWFwcGluZy5QT0xZX0ZBTFNFLCBudWxsKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gZmllbGQuZ2V0Q29sdW1ucygp\nOwogICAgICAgICAgICBpZiAocmVsTWFwcGluZy5nZXRJZGVudGl0eVR5cGUo\nKSA9PSBDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAg\nICAgICBsb25nIGlkID0gcmVzLmdldExvbmcoY29sc1swXSk7CiAgICAgICAg\nICAgICAgICBpZiAoIXJlcy53YXNOdWxsKCkpCiAgICAgICAgICAgICAgICAg\nICAgb2lkID0gc3RvcmUubmV3RGF0YVN0b3JlSWQoaWQsIHJlbE1hcHBpbmcs\nIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgICAg\nIC8vIGFwcGxpY2F0aW9uIGlkCiAgICAgICAgICAgICAgICBpZiAoY29scy5s\nZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdCB2YWwg\nPSByZXMuZ2V0T2JqZWN0KGNvbHNbMF0sIG51bGwsIG51bGwpOwogICAgICAg\nICAgICAgICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgb2lkID0gQXBwbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKG5l\ndyBPYmplY3RbXXsgdmFsIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZWxNYXBwaW5nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgT2JqZWN0W10gdmFscyA9IG5ldyBPYmplY3RbY29s\ncy5sZW5ndGhdOwogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAg\nICAgICB2YWxzW2ldID0gcmVzLmdldE9iamVjdChjb2xzW2ldLCBudWxsLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHNbaV0gPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSBjb2xzLmxlbmd0aCAtIDEp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvaWQgPSBBcHBsaWNhdGlv\nbklkcy5mcm9tUEtWYWx1ZXModmFscywgcmVsTWFwcGluZyk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAg\nICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIG51bGwpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc20uc2V0SW50ZXJtZWRpYXRlKGZp\nZWxkLmdldEluZGV4KCksIG9pZCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nbG9hZChmaW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBmaW5hbCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBjaGVjayBmb3IgY2FjaGVkIG9pZCB2YWx1ZSwgb3IgbG9hZCBv\naWQgaWYgbm8gd2F5IHRvIGpvaW4KICAgICAgICBpZiAoQm9vbGVhbi5UUlVF\nLmVxdWFscyhfZmtPaWQpKSB7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBz\nbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgIGlmIChvaWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgT2JqZWN0\nIHZhbCA9IHN0b3JlLmZpbmQob2lkLCBmaWVsZCwgZmV0Y2gpOwogICAgICAg\nICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSwgdmFs\nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5nW10gcmVscyA9IGZp\nZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICAgICAgZmlu\nYWwgaW50IHN1YnMgPSBmaWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCk7CiAg\nICAgICAgZmluYWwgSm9pbnNbXSByZXNKb2lucyA9IG5ldyBKb2luc1tyZWxz\nLmxlbmd0aF07CgogICAgICAgIC8vIHNlbGVjdCByZWxhdGVkIG1hcHBpbmcg\nY29sdW1uczsgam9pbmluZyBmcm9tIHRoZSByZWxhdGVkIHR5cGUKICAgICAg\nICAvLyBiYWNrIHRvIG91ciBmayB0YWJsZSBpZiBub3QgYW4gaW52ZXJzZSBt\nYXBwaW5nIChpbiB3aGljaCBjYXNlIHdlCiAgICAgICAgLy8gY2FuIGp1c3Qg\nbWFrZSBzdXJlIHRoZSBpbnZlcnNlIGNvbHMgPT0gb3VyIHBrIHZhbHVlcykK\nICAgICAgICBVbmlvbiB1bmlvbiA9IHN0b3JlLmdldFNRTEZhY3RvcnkoKS5u\nZXdVbmlvbihyZWxzLmxlbmd0aCk7CiAgICAgICAgdW5pb24uc2V0RXhwZWN0\nZWRSZXN1bHRDb3VudCgxLCBmYWxzZSk7CiAgICAgICAgaWYgKGZldGNoLmdl\ndFN1YmNsYXNzRmV0Y2hNb2RlKGZpZWxkLmdldFR5cGVNYXBwaW5nKCkpCiAg\nICAgICAgICAgICE9IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9J\nTikKICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlvbigpOwogICAgICAgIHVu\naW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAg\nICAgICAgICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09\nIGZpZWxkLkpPSU5fSU5WRVJTRSkKICAgICAgICAgICAgICAgICAgICBzZWwu\nd2hlcmVGb3JlaWduS2V5KGZpZWxkLmdldEZvcmVpZ25LZXkocmVsc1tpZHhd\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwg\nZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCksIHN0b3JlKTsKICAgICAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlc0pvaW5zW2lk\neF0gPSBzZWwubmV3Sm9pbnMoKS5qb2luUmVsYXRpb24oZmllbGQuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5nZXRGb3JlaWdu\nS2V5KHJlbHNbaWR4XSksIHJlbHNbaWR4XSwKICAgICAgICAgICAgICAgICAg\nICAgICAgZmllbGQuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCBmYWxzZSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLndoZXJlUHJpbWFyeUtl\neShzZWwsIHNtLCBzdG9yZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBzZWwuc2VsZWN0KHJlbHNbaWR4XSwgc3Vicywgc3RvcmUsIGZl\ndGNoLCBmZXRjaC5FQUdFUl9KT0lOLCAKICAgICAgICAgICAgICAgICAgICBy\nZXNKb2luc1tpZHhdKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAg\nICAgICBSZXN1bHQgcmVzID0gdW5pb24uZXhlY3V0ZShzdG9yZSwgZmV0Y2gp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBudWxs\nOwogICAgICAgICAgICBpZiAocmVzLm5leHQoKSkKICAgICAgICAgICAgICAg\nIHZhbCA9IHJlcy5sb2FkKHJlbHNbcmVzLmluZGV4T2YoKV0sIHN0b3JlLCBm\nZXRjaCwKICAgICAgICAgICAgICAgICAgICByZXNKb2luc1tyZXMuaW5kZXhP\nZigpXSk7CiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldElu\nZGV4KCksIHZhbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ncmVzLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgdG9EYXRhU3RvcmVWYWx1ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3Rv\ncmUpIHsKICAgICAgICByZXR1cm4gUmVsYXRpb25TdHJhdGVnaWVzLnRvRGF0\nYVN0b3JlVmFsdWUoZmllbGQsIHZhbCwgc3RvcmUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGFwcGVuZElzTnVsbChTUUxCdWZmZXIgc3FsLCBTZWxlY3Qg\nc2VsLCBKb2lucyBqb2lucykgewogICAgICAgIC8vIGlmIG5vIGludmVyc2Us\nIGp1c3Qgam9pbiB0byBtYXBwaW5nJ3MgdGFibGUgKHVzdWFsbHkgYSBuby1v\ncAogICAgICAgIC8vIGJlY2F1c2UgaXQnbGwgYmUgaW4gdGhlIHByaW1hcnkg\ndGFibGUpIGFuZCBzZWUgaWYgZmsgY29scyBhcmUgbnVsbDsKICAgICAgICAv\nLyBpZiBpbnZlcnNlLCB0aGVuIHdlIGhhdmUgdG8gZG8gYSBzdWItc2VsZWN0\nIHRvIHNlZSBpZiBhbnkgaW52ZXJzZQogICAgICAgIC8vIG9iamVjdHMgcG9p\nbnQgYmFjayB0byB0aGlzIGZpZWxkJ3Mgb3duZXIKICAgICAgICBpZiAoZmll\nbGQuZ2V0Sm9pbkRpcmVjdGlvbigpICE9IGZpZWxkLkpPSU5fSU5WRVJTRSkg\newogICAgICAgICAgICAvLyMjIyBwcm9iYWJseSBuZWVkIHNvbWUgc29ydCBv\nZiBzdWJzZWxlY3QgaGVyZSBvbiBmayBjb25zdGFudHMKICAgICAgICAgICAg\nam9pbnMgPSBqb2luKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIENvbHVt\nbltdIGNvbHMgPSBmaWVsZC5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIGlm\nIChjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgc3FsLmFwcGVu\nZCgiMSA8PiAxIik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIHNxbC5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbMF0sIGpvaW5z\nKSkuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCIgSVMgIikuYXBwZW5k\nVmFsdWUobnVsbCwgY29sc1swXSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgIHRlc3RJbnZlcnNlTnVsbChzcWwsIHNlbCwgam9pbnMsIHRydWUpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90TnVsbChTUUxCdWZm\nZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lucykgewogICAgICAgIC8v\nIGlmIG5vIGludmVyc2UsIGp1c3Qgam9pbiB0byBtYXBwaW5nJ3MgdGFibGUg\nKHVzdWFsbHkgYSBuby1vcAogICAgICAgIC8vIGJlY2F1c2UgaXQnbGwgYmUg\naW4gdGhlIHByaW1hcnkgdGFibGUpIGFuZCBzZWUgaWYgZmsgY29scyBhcmVu\nJ3QKICAgICAgICAvLyBudWxsOyBpZiBpbnZlcnNlLCB0aGVuIHdlIGhhdmUg\ndG8gZG8gYSBzdWItc2VsZWN0IHRvIHNlZSBpZiBhbnkKICAgICAgICAvLyBp\nbnZlcnNlIG9iamVjdHMgcG9pbnQgYmFjayB0byB0aGlzIGZpZWxkJ3Mgb3du\nZXIKICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpICE9IGZp\nZWxkLkpPSU5fSU5WRVJTRSkgewogICAgICAgICAgICAvLyMjIyBwcm9iYWJs\neSBuZWVkIHNvbWUgc29ydCBvZiBzdWJzZWxlY3QgaGVyZSBvbiBmayBjb25z\ndGFudHMKICAgICAgICAgICAgam9pbnMgPSBqb2luKGpvaW5zLCBmYWxzZSk7\nCiAgICAgICAgICAgIENvbHVtbltdIGNvbHMgPSBmaWVsZC5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgICAgIGlmIChjb2xzLmxlbmd0aCA9PSAwKQogICAgICAg\nICAgICAgICAgc3FsLmFwcGVuZCgiMSA9IDEiKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxp\nYXMoY29sc1swXSwgam9pbnMpKS4KICAgICAgICAgICAgICAgICAgICBhcHBl\nbmQoIiBJUyBOT1QgIikuYXBwZW5kVmFsdWUobnVsbCwgY29sc1swXSk7CiAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRlc3RJbnZlcnNlTnVsbChzcWws\nIHNlbCwgam9pbnMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFw\ncGVuZCBTUUwgZm9yIGEgc3ViLXNlbGVjdCB0ZXN0aW5nIHdoZXRoZXIgYW4g\naW52ZXJzZSBvYmplY3QgZXhpc3RzCiAgICAgKiBmb3IgdGhpcyByZWxhdGlv\nbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRlc3RJbnZlcnNlTnVsbChT\nUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lucywKICAgICAg\nICBib29sZWFuIGVtcHR5KSB7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3Qg\nPSBmaWVsZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldERCRGljdGlvbmFy\neSgpOwogICAgICAgIGRpY3QuYXNzZXJ0U3VwcG9ydChkaWN0LnN1cHBvcnRz\nU3Vic2VsZWN0LCAiU3VwcG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAgaWYg\nKGZpZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCkubGVuZ3RoICE9\nIDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmlu\ndmVyc2FibGUoZmllbGQpOwoKICAgICAgICBpZiAoZW1wdHkpCiAgICAgICAg\nICAgIHNxbC5hcHBlbmQoIjAgPSAiKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHNxbC5hcHBlbmQoIjAgPCAiKTsKCiAgICAgICAgRm9yZWlnbktleSBm\nayA9IGZpZWxkLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBDb250YWluZXJG\naWVsZFN0cmF0ZWd5LmFwcGVuZEpvaW5Db3VudChzcWwsIHNlbCwgam9pbnMs\nIGRpY3QsIGZpZWxkLAogICAgICAgICAgICBmayk7CiAgICB9CgogICAgcHVi\nbGljIEpvaW5zIGpvaW4oSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRl\ncikgewogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBpbiBhbiBpbnZlcnNlIG9i\namVjdCB0YWJsZSBqb2luIG5vcm1hbGx5LCBvdGhlcndpc2UKICAgICAgICAv\nLyBhbHJlYWR5IHRyYXZlcnNlZCB0aGUgcmVsYXRpb247IGp1c3Qgam9pbiBi\nYWNrIHRvIG93bmVyIHRhYmxlCiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5E\naXJlY3Rpb24oKSAhPSBmaWVsZC5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAg\nIHJldHVybiBmaWVsZC5qb2luKGpvaW5zLCBmb3JjZU91dGVyLCBmYWxzZSk7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nW10gY2xzcyA9IGZpZWxkLmdldEluZGVw\nZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICAgICAgaWYgKGNsc3MubGVuZ3Ro\nICE9IDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51\nbmludmVyc2FibGUoZmllbGQpOwogICAgICAgIGlmIChmb3JjZU91dGVyKQog\nICAgICAgICAgICByZXR1cm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmll\nbGQuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgZmllbGQuZ2V0Rm9yZWln\nbktleSgpLCBjbHNzWzBdLCBmaWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCks\nIAogICAgICAgICAgICAgICAgdHJ1ZSwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiBqb2lucy5qb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLCBmaWVsZC5n\nZXRGb3JlaWduS2V5KCksCiAgICAgICAgICAgIGNsc3NbMF0sIGZpZWxkLmdl\ndFNlbGVjdFN1YmNsYXNzZXMoKSwgdHJ1ZSwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oSm9pbnMgam9pbnMsIGJvb2xl\nYW4gZm9yY2VPdXRlciwKICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7CiAg\nICAgICAgLy8gaWYgdGhpcyBpcyBhbiBpbnZlcnNlIG1hcHBpbmcgaXQncyBh\nbHJlYWR5IGpvaW5lZCB0byB0aGUgcmVsYXRpb24KICAgICAgICBpZiAoZmll\nbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxkLkpPSU5fSU5WRVJTRSkK\nICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwogICAgICAgIENsYXNzTWFwcGlu\nZ1tdIGNsc3MgPSBmaWVsZC5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygp\nOwogICAgICAgIGlmIChjbHNzLmxlbmd0aCAhPSAxKSB7CiAgICAgICAgICAg\nIGlmICh0cmF2ZXJzZSkKICAgICAgICAgICAgICAgIHRocm93IFJlbGF0aW9u\nU3RyYXRlZ2llcy51bmpvaW5hYmxlKGZpZWxkKTsKICAgICAgICAgICAgcmV0\ndXJuIGpvaW5zOwogICAgICAgIH0KCiAgICAgICAgam9pbnMgPSBzZXRFbWJl\nZGRlZFZhcmlhYmxlKGpvaW5zKTsKICAgICAgICBpZiAoZm9yY2VPdXRlcikK\nICAgICAgICAgICAgcmV0dXJuIGpvaW5zLm91dGVySm9pblJlbGF0aW9uKGZp\nZWxkLmdldE5hbWUoKSwgCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRGb3Jl\naWduS2V5KGNsc3NbMF0pLCBjbHNzWzBdLCAKICAgICAgICAgICAgICAgIGZp\nZWxkLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAg\nICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUo\nKSwgZmllbGQuZ2V0Rm9yZWlnbktleShjbHNzWzBdKSwKICAgICAgICAgICAg\nY2xzc1swXSwgZmllbGQuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCBmYWxzZSwg\nZmFsc2UpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gSm9pbmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBpbnQgZ2V0RmllbGRJ\nbmRleCgpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0SW5kZXgoKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFByaW1hcnlLZXlWYWx1ZShSZXN1\nbHQgcmVzLCBDb2x1bW5bXSBjb2xzLCBGb3JlaWduS2V5IGZrLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbG1hcHBp\nbmcgPSBmaWVsZC5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIGlmIChyZWxt\nYXBwaW5nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5JRF9E\nQVRBU1RPUkUpIHsKICAgICAgICAgICAgQ29sdW1uIGNvbCA9IGNvbHNbMF07\nCiAgICAgICAgICAgIGlmIChmayAhPSBudWxsKQogICAgICAgICAgICAgICAg\nY29sID0gZmsuZ2V0Q29sdW1uKGNvbCk7ICAgCiAgICAgICAgICAgIGxvbmcg\naWQgPSByZXMuZ2V0TG9uZyhjb2wsIGpvaW5zKTsKICAgICAgICAgICAgaWYg\nKGZpZWxkLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpID09IEphdmFUeXBl\ncy5MT05HKQogICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVP\nZihpZCk7CiAgICAgICAgICAgIHJldHVybiBzdG9yZS5uZXdEYXRhU3RvcmVJ\nZChpZCwgcmVsbWFwcGluZywgZmllbGQuZ2V0UG9seW1vcnBoaWMoKSAKICAg\nICAgICAgICAgICAgICE9IFZhbHVlTWFwcGluZy5QT0xZX0ZBTFNFKTsKICAg\nICAgICB9CgogICAgICAgIGlmIChyZWxtYXBwaW5nLmlzT3BlbkpQQUlkZW50\naXR5KCkpCiAgICAgICAgICAgIHJldHVybiAoKEpvaW5hYmxlKSByZWxtYXBw\naW5nLmdldFByaW1hcnlLZXlGaWVsZE1hcHBpbmdzKClbMF0uCiAgICAgICAg\nICAgICAgICBnZXRTdHJhdGVneSgpKS5nZXRQcmltYXJ5S2V5VmFsdWUocmVz\nLCBjb2xzLCBmaywgc3RvcmUsIGpvaW5zKTsKCiAgICAgICAgaWYgKGNvbHMg\nPT0gZ2V0Q29sdW1ucygpICYmIGZrID09IG51bGwpCiAgICAgICAgICAgIGZr\nID0gZmllbGQuZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgZmsgPSBjcmVhdGVUcmFuc2xhdGluZ0ZvcmVpZ25LZXkocmVsbWFw\ncGluZywgY29scywgZmspOyAKICAgICAgICByZXR1cm4gcmVsbWFwcGluZy5n\nZXRPYmplY3RJZChzdG9yZSwgcmVzLCBmaywKICAgICAgICAgICAgZmllbGQu\nZ2V0UG9seW1vcnBoaWMoKSAhPSBWYWx1ZU1hcHBpbmcuUE9MWV9GQUxTRSwg\nam9pbnMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgZmF1eCBm\nb3JlaWduIGtleSB0aGF0IHRyYW5zbGF0ZXMgYmV0d2VlbiB0aGUgY29sdW1u\ncyB0byBwdWxsCiAgICAgKiB0aGUgZGF0YSBmcm9tIGFuZCBvdXIgcmVsYXRl\nZCB0eXBlJ3MgcHJpbWFyeSBrZXkgY29sdW1ucy4KICAgICAqLwogICAgcHJp\ndmF0ZSBGb3JlaWduS2V5IGNyZWF0ZVRyYW5zbGF0aW5nRm9yZWlnbktleShD\nbGFzc01hcHBpbmcgcmVsbWFwcGluZywKICAgICAgICBDb2x1bW5bXSBnY29s\ncywgRm9yZWlnbktleSBnZmspIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0g\nZmllbGQuZ2V0Rm9yZWlnbktleSgpOyAKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gZmsuZ2V0Q29sdW1ucygpOwoKICAgICAgICBGb3JlaWduS2V5IHRmayA9\nIG51bGw7CiAgICAgICAgQ29sdW1uIHRjb2w7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBnY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0\nY29sID0gZ2NvbHNbaV07CiAgICAgICAgICAgIGlmIChnZmsgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRjb2wgPSBnZmsuZ2V0Q29sdW1uKHRjb2wpOwog\nICAgICAgICAgICBpZiAodGZrID09IG51bGwpCiAgICAgICAgICAgICAgICB0\nZmsgPSBuZXcgRm9yZWlnbktleShudWxsLCB0Y29sLmdldFRhYmxlKCkpOwog\nICAgICAgICAgICB0Zmsuam9pbih0Y29sLCBmay5nZXRQcmltYXJ5S2V5Q29s\ndW1uKGNvbHNbaV0pKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRmazsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEpvaW5WYWx1ZShPYmplY3Qg\nZmllbGRWYWwsIENvbHVtbiBjb2wsIEpEQkNTdG9yZSBzdG9yZSkgewogICAg\nICAgIE9iamVjdCBvID0gZmllbGQuZ2V0Rm9yZWlnbktleSgpLmdldENvbnN0\nYW50KGNvbCk7CiAgICAgICAgaWYgKG8gIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG87CiAgICAgICAgY29sID0gZmllbGQuZ2V0Rm9yZWlnbktleSgp\nLmdldFByaW1hcnlLZXlDb2x1bW4oY29sKTsKICAgICAgICBpZiAoY29sID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbigpOwoKICAgICAgICBDbGFzc01hcHBpbmcgcmVsbWFwcGluZyA9IGZpZWxk\nLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgSm9pbmFibGUgaiA9IGZpZWxk\nLmdldFR5cGVNYXBwaW5nKCkuYXNzZXJ0Sm9pbmFibGUoY29sKTsKICAgICAg\nICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUoZmllbGRWYWwpKQogICAg\nICAgICAgICBmaWVsZFZhbCA9IHN0b3JlLmdldENvbnRleHQoKS5nZXRPYmpl\nY3RJZChmaWVsZFZhbCk7CiAgICAgICAgaWYgKGZpZWxkVmFsIGluc3RhbmNl\nb2YgT3BlbkpQQUlkKQogICAgICAgICAgICBmaWVsZFZhbCA9ICgoT3BlbkpQ\nQUlkKSBmaWVsZFZhbCkuZ2V0SWRPYmplY3QoKTsKICAgICAgICBlbHNlIGlm\nIChyZWxtYXBwaW5nLmdldE9iamVjdElkVHlwZSgpICE9IG51bGwKICAgICAg\nICAgICAgJiYgcmVsbWFwcGluZy5nZXRPYmplY3RJZFR5cGUoKS5pc0luc3Rh\nbmNlKGZpZWxkVmFsKSkgewogICAgICAgICAgICBPYmplY3RbXSBwa3MgPSBB\ncHBsaWNhdGlvbklkcy50b1BLVmFsdWVzKGZpZWxkVmFsLCByZWxtYXBwaW5n\nKTsKICAgICAgICAgICAgZmllbGRWYWwgPSBwa3NbcmVsbWFwcGluZy5nZXRG\naWVsZChqLmdldEZpZWxkSW5kZXgoKSkuCiAgICAgICAgICAgICAgICBnZXRQ\ncmltYXJ5S2V5SW5kZXgoKV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBq\nLmdldEpvaW5WYWx1ZShmaWVsZFZhbCwgY29sLCBzdG9yZSk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBnZXRKb2luVmFsdWUoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgQ29sdW1uIGNvbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUp\nIHsKICAgICAgICByZXR1cm4gZ2V0Sm9pblZhbHVlKHNtLmZldGNoKGZpZWxk\nLmdldEluZGV4KCkpLCBjb2wsIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRBdXRvQXNzaWduZWRWYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgQ29sdW1uIGNvbCwgT2Jq\nZWN0IGF1dG9JbmMpIHsKICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gRW1iZWRkYWJsZSBpbXBsZW1lbnRhdGlvbgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgQ29s\ndW1uW10gZ2V0Q29sdW1ucygpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0\nQ29sdW1ucygpOwogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5JTyBnZXRDb2x1\nbW5JTygpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0Q29sdW1uSU8oKTsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZ2V0UmVzdWx0QXJndW1lbnRz\nKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgdG9FbWJlZGRlZERhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpE\nQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiB0b0RhdGFTdG9yZVZh\nbHVlKHZhbCwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9F\nbWJlZGRlZE9iamVjdFZhbHVlKE9iamVjdCB2YWwpIHsKICAgICAgICByZXR1\ncm4gVU5TVVBQT1JURUQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZEVt\nYmVkZGVkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9y\nZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmpl\nY3QgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIENsYXNzTWFwcGluZyByZWxNYXBwaW5nID0gZmllbGQuZ2V0VHlwZU1hcHBp\nbmcoKTsKICAgICAgICBPYmplY3Qgb2lkOwogICAgICAgIGlmICh2YWwgPT0g\nbnVsbCkKICAgICAgICAgICAgb2lkID0gbnVsbDsKICAgICAgICBlbHNlIGlm\nIChyZWxNYXBwaW5nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGlu\nZy5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgIG9pZCA9IHN0b3JlLm5ld0Rh\ndGFTdG9yZUlkKCgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpLCByZWxNYXBw\naW5nLAogICAgICAgICAgICAgICAgZmllbGQuZ2V0UG9seW1vcnBoaWMoKSAh\nPSBWYWx1ZU1hcHBpbmcuUE9MWV9GQUxTRSk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIE9iamVjdFtdIHBrcyA9IChnZXRDb2x1bW5zKCkubGVuZ3Ro\nID09IDEpID8gbmV3IE9iamVjdFtdeyB2YWwgfQogICAgICAgICAgICAgICAg\nOiAoT2JqZWN0W10pIHZhbDsKICAgICAgICAgICAgYm9vbGVhbiBudWxscyA9\nIHRydWU7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBudWxscyAmJiBp\nIDwgcGtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgbnVsbHMgPSBw\na3NbaV0gPT0gbnVsbDsKICAgICAgICAgICAgaWYgKG51bGxzKQogICAgICAg\nICAgICAgICAgb2lkID0gbnVsbDsKICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBvaWQgPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXMo\ncGtzLCByZWxNYXBwaW5nKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZC5n\nZXRQb2x5bW9ycGhpYygpID09IFZhbHVlTWFwcGluZy5QT0xZX0ZBTFNFCiAg\nICAgICAgICAgICAgICAgICAgJiYgb2lkIGluc3RhbmNlb2YgT3BlbkpQQUlk\nKSB7CiAgICAgICAgICAgICAgICAgICAgKChPcGVuSlBBSWQpIG9pZCkuc2V0\nTWFuYWdlZEluc3RhbmNlVHlwZShyZWxNYXBwaW5nLgogICAgICAgICAgICAg\nICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAob2lk\nID09IG51bGwpCiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdl\ndEluZGV4KCksIG51bGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc20u\nc2V0SW50ZXJtZWRpYXRlKGZpZWxkLmdldEluZGV4KCksIG9pZCk7CiAgICB9\nCn0K\n","encoding":"base64"}

