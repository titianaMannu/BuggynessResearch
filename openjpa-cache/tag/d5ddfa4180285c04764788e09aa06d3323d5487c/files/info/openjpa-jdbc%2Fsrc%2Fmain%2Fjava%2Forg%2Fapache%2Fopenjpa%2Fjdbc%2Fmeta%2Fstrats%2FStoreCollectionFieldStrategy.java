{"sha":"20bf4d29732fd360f5e352e883cec427746e559c","node_id":"MDQ6QmxvYjIwNjM2NDoyMGJmNGQyOTczMmZkMzYwZjVlMzUyZTg4M2NlYzQyNzc0NmU1NTlj","size":20507,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/20bf4d29732fd360f5e352e883cec427746e559c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5NYXA7\nCgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNG\nZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdEV4ZWN1dG9yOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlVuaW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhbmdlVHJhY2tl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHk7CgovKioKICogQmFzZSBj\nbGFzcyBmb3Igc3RyYXRlZ2llcyB0aGF0IGFyZSBzdG9yZWQgYXMgYSBjb2xs\nZWN0aW9uLCBldmVuIGlmCiAqIHRoZWlyIGZpZWxkIHZhbHVlIGlzIHNvbWV0\naGluZyBlbHNlLiBIYW5kbGVzIGRhdGEgbG9hZGluZyBhbmQgYmFzaWMgcXVl\ncnkKICogZnVuY3Rpb25hbGl0eS4gU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVu\ndCBhYnN0cmFjdCBtZXRob2RzIGFuZAogKiBpbnNlcnQvdXBkYXRlL2RlbGV0\nZSBiZWhhdmlvciBhcyB3ZWxsIGFzIG92ZXJyaWRpbmcKICoge0BsaW5rIEZp\nZWxkU3RyYXRlZ3kjdG9EYXRhU3RvcmVWYWx1ZX0sIHtAbGluayBGaWVsZFN0\ncmF0ZWd5I2pvaW59LCBhbmQKICoge0BsaW5rIEZpZWxkU3RyYXRlZ3kjam9p\nblJlbGF0aW9ufSBpZiBuZWNlc3NhcnkuCiAqCiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgU3RvcmVDb2xsZWN0aW9u\nRmllbGRTdHJhdGVneQogICAgZXh0ZW5kcyBDb250YWluZXJGaWVsZFN0cmF0\nZWd5IHsKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZm9yZWlnbiBrZXkg\ndXNlZCB0byBqb2luIHRvIHRoZSBvd25pbmcgZmllbGQgZm9yIHRoZSBnaXZl\nbgogICAgICogZWxlbWVudCBtYXBwaW5nIGZyb20ge0BsaW5rICNnZXRJbmRl\ncGVuZGVudEVsZW1lbnRNYXBwaW5nc30gKG9yIG51bGwpLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3QgRm9yZWlnbktleSBnZXRKb2luRm9yZWln\nbktleShDbGFzc01hcHBpbmcgZWxlbSk7CgogICAgLyoqCiAgICAgKiBJbXBs\nZW1lbnQgdGhpcyBtZXRob2QgdG8gc2VsZWN0IHRoZSBlbGVtZW50cyBvZiB0\naGlzIGZpZWxkIGZvciB0aGUKICAgICAqIGdpdmVuIGVsZW1lbnQgbWFwcGlu\nZyBmcm9tIHtAbGluayAjZ2V0SW5kZXBlbmRlbnRFbGVtZW50TWFwcGluZ3N9\nCiAgICAgKiAob3IgbnVsbCkuIEVsZW1lbnRzIG9mIHRoZSByZXN1bHQgd2ls\nbCBiZSBsb2FkZWQgd2l0aAogICAgICoge0BsaW5rICNsb2FkRWxlbWVudH0u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIHNlbGVjdEVs\nZW1lbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGVsZW0sCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBpbnQgZWFnZXJNb2RlLAogICAgICAgIEpvaW5zIGpvaW5zKTsKCiAgICAv\nKioKICAgICAqIExvYWQgYW4gZWxlbWVudCBvZiB0aGUgY29sbGVjdGlvbi4g\nVGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgbWlnaHQgYmUKICAgICAqIG51bGwg\naWYgdGhlIGxvYWQgaXMgZm9yIGEgcHJvamVjdGlvbiBvciBmb3IgcHJvY2Vz\nc2luZyBlYWdlciBwYXJhbGxlbAogICAgICogcmVzdWx0cy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGFic3RyYWN0IE9iamVjdCBsb2FkRWxlbWVudChPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9p\nbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbjsKCiAgICAv\nKioKICAgICAqIEpvaW4gdGhpcyB2YWx1ZSdzIHRhYmxlIHRvIHRoZSB0YWJs\nZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbWFwcGluZwogICAgICogZnJvbSB7\nQGxpbmsgI2dldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzfSAob3IgbnVs\nbCkuCiAgICAgKgogICAgICogQHNlZSBGaWVsZE1hcHBpbmcjam9pblJlbGF0\naW9uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBKb2lucyBqb2lu\nRWxlbWVudFJlbGF0aW9uKEpvaW5zIGpvaW5zLAogICAgICAgIENsYXNzTWFw\ncGluZyBlbGVtKTsKCiAgICAvKioKICAgICAqIEpvaW4gdG8gdGhlIG93bmlu\nZyBmaWVsZCB0YWJsZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbWFwcGluZyBm\ncm9tCiAgICAgKiB7QGxpbmsgI2dldEluZGVwZW5kZW50RWxlbWVudE1hcHBp\nbmdzfSAob3IgbnVsbCkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcgZWxlbSk7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBsYXJnZSByZXN1bHQgc2V0IHBy\nb3h5IGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3QgUHJveHkgbmV3TFJTUHJveHkoKTsKCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIGZpZWxkIHZhbHVlIHRvIGEgY29sbGVjdGlvbi4gSGFuZGxl\ncyBjb2xsZWN0aW9ucyBhbmQKICAgICAqIGFycmF5cyBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiB0b0NvbGxlY3Rpb24o\nT2JqZWN0IHZhbCkgewogICAgICAgIGlmIChmaWVsZC5nZXRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5DT0xMRUNUSU9OKQogICAgICAgICAgICByZXR1cm4g\nKENvbGxlY3Rpb24pIHZhbDsKICAgICAgICByZXR1cm4gSmF2YVR5cGVzLnRv\nTGlzdCh2YWwsIGZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlKCksIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBpdGVtIHRvIHRoZSBk\nYXRhIHN0cnVjdHVyZSByZXByZXNlbnRpbmcgYSBmaWVsZCB2YWx1ZS4KICAg\nICAqIEJ5IGRlZmF1bHQsIGFzc3VtZXMgdGhlIHN0cnVjdHVyZSBpcyBhIGNv\nbGxlY3Rpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZChKREJD\nU3RvcmUgc3RvcmUsIE9iamVjdCBjb2xsLCBPYmplY3Qgb2JqKSB7CiAgICAg\nICAgKChDb2xsZWN0aW9uKSBjb2xsKS5hZGQob2JqKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgdGhlIGZpcnN0IGluZGVwZW5kZW50IGVsZW1l\nbnQgbWFwcGluZywgb3IgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFz\nc01hcHBpbmcgZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5nKGJvb2xlYW4gdHJh\ndmVyc2UpIHsKICAgICAgICBDbGFzc01hcHBpbmdbXSBlbGVtcyA9IGdldElu\nZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRyYXZlcnNlKTsKICAgICAgICBy\nZXR1cm4gKGVsZW1zLmxlbmd0aCA9PSAwKSA/IG51bGwgOiBlbGVtc1swXTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IHN1cHBvcnRzU2VsZWN0KFNlbGVjdCBz\nZWwsIGludCB0eXBlLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIGlmIChmaWVsZC5pc0xSUygpKQogICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICBpZiAodHlwZSA9PSBTZWxlY3QuRUFHRVJfUEFS\nQUxMRUwpCiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCgxLCBnZXRJbmRl\ncGVuZGVudEVsZW1lbnRNYXBwaW5ncyh0cnVlKS5sZW5ndGgpOwogICAgICAg\nIGlmICh0eXBlICE9IFNlbGVjdC5FQUdFUl9JTk5FUiAmJiB0eXBlICE9IFNl\nbGVjdC5FQUdFUl9PVVRFUikKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAg\nICAgaWYgKGdldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRydWUpLmxl\nbmd0aCA+IDEpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVy\nbiAodHlwZSA9PSBTZWxlY3QuRUFHRVJfSU5ORVIgfHwgc3RvcmUuZ2V0REJE\naWN0aW9uYXJ5KCkuCiAgICAgICAgICAgIGNhbk91dGVySm9pbihzZWwuZ2V0\nSm9pblN5bnRheCgpLCBnZXRKb2luRm9yZWlnbktleQogICAgICAgICAgICAg\nICAgKGdldERlZmF1bHRFbGVtZW50TWFwcGluZyhmYWxzZSkpKSkgPyAxIDog\nMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RFYWdlclBhcmFsbGVs\nKFNlbGVjdEV4ZWN1dG9yIHNlbCwKICAgICAgICBmaW5hbCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBmaW5hbCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAg\nZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgZmluYWwgaW50\nIGVhZ2VyTW9kZSkgewogICAgICAgIGlmICghKHNlbCBpbnN0YW5jZW9mIFVu\naW9uKSkKICAgICAgICAgICAgc2VsZWN0RWFnZXIoKFNlbGVjdCkgc2VsLCBn\nZXREZWZhdWx0RWxlbWVudE1hcHBpbmcodHJ1ZSksIHNtLAogICAgICAgICAg\nICAgICAgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIHRydWUsIGZhbHNlKTsK\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5n\nW10gZWxlbXMgPSBnZXRJbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5ncyh0cnVl\nKTsKICAgICAgICAgICAgVW5pb24gdW5pb24gPSAoVW5pb24pIHNlbDsKICAg\nICAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCkuCiAgICAgICAgICAgICAgICBnZXRUeXBl\nTWFwcGluZygpKSAhPSBmZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAgICAg\nICAgdW5pb24uYWJvcnRVbmlvbigpOwogICAgICAgICAgICB1bmlvbi5zZWxl\nY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAg\nICAgICAgICAgICAgICBzZWxlY3RFYWdlcihzZWwsIGVsZW1zW2lkeF0sIHNt\nLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSwgCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRydWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\nbGVjdEVhZ2VySm9pbihTZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIC8vIHdl\nIGxpbWl0IGZ1cnRoZXIgZWFnZXIgZmV0Y2hlcyB0byBqb2lucywgYmVjYXVz\nZSBhZnRlciB0aGlzIHBvaW50CiAgICAgICAgLy8gdGhlIHNlbGVjdCBoYXMg\nYmVlbiBtb2RpZmllZCBzdWNoIHRoYXQgcGFyYWxsZWwgY2xvbmVzIG1heSBw\ncm9kdWNlCiAgICAgICAgLy8gaW52YWxpZCBzcWwKICAgICAgICBib29sZWFu\nIG91dGVyID0gZmllbGQuZ2V0TnVsbFZhbHVlKCkgIT0gRmllbGRNYXBwaW5n\nLk5VTExfRVhDRVBUSU9OOwogICAgICAgIC8vIGZvcmNlIGlubmVyIGpvaW4g\nZm9yIGlubmVyIGpvaW4gZmV0Y2ggCiAgICAgICAgaWYgKGZldGNoLmhhc0Zl\ndGNoSW5uZXJKb2luKGZpZWxkLmdldEZ1bGxOYW1lKGZhbHNlKSkpCiAgICAg\nICAgICAgIG91dGVyID0gZmFsc2U7CiAgICAgICAgc2VsZWN0RWFnZXIoc2Vs\nLCBnZXREZWZhdWx0RWxlbWVudE1hcHBpbmcodHJ1ZSksIHNtLCBzdG9yZSwg\nZmV0Y2gsIAogICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVB\nR0VSX0pPSU4sIGZhbHNlLAogICAgICAgICAgICBvdXRlcik7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNFYWdlclNlbGVjdFRvTWFueSgpIHsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVj\ndCBvdXIgZGF0YSBlYWdlcmx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nc2VsZWN0RWFnZXIoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGVsZW0sCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3Jl\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIGludCBl\nYWdlck1vZGUsIGJvb2xlYW4gc2VsZWN0T2lkLCBib29sZWFuIG91dGVyKSB7\nCiAgICAgICAgLy8gZm9yY2UgZGlzdGluY3QgaWYgdGhlcmUgd2FzIGEgdG8t\nbWFueSBqb2luIHRvIGF2b2lkIGR1cHMsIGJ1dAogICAgICAgIC8vIGlmIHRo\naXMgaXMgYSBwYXJhbGxlbCBzZWxlY3QgZG9uJ3QgbWFrZSBkaXN0aW5jdCBi\nYXNlZCBvbiB0aGUKICAgICAgICAvLyBlYWdlciBqb2lucyBhbG9uZSBpZiB0\naGUgb3JpZ2luYWwgd2Fzbid0IGRpc3RpbmN0CiAgICAgICAgaWYgKGVhZ2Vy\nTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BBUkFMTEVM\nKSB7CiAgICAgICAgICAgIGlmIChzZWwuaGFzSm9pbih0cnVlKSkKICAgICAg\nICAgICAgICAgIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoIXNlbC5pc0Rpc3RpbmN0KCkpCiAgICAgICAgICAgICAgICBz\nZWwuc2V0RGlzdGluY3QoZmFsc2UpOyAvLyBzZXQgZXhwbGljaXRseSBzbyBy\nZW1lbWJlcmVkCiAgICAgICAgfQoKICAgICAgICAvLyBzZXQgYSB2YXJpYWJs\nZSBuYW1lIHRoYXQgZG9lcyBub3QgY29uZmxpY3Qgd2l0aCBhbnkgaW4gdGhl\nIHF1ZXJ5OwogICAgICAgIC8vIHVzaW5nIGEgdmFyaWFibGUgZ3VhcmFudGVl\ncyB0aGF0IHRoZSBzZWxlY3RlZCBkYXRhIHdpbGwgdXNlIGRpZmZlcmVudAog\nICAgICAgIC8vIGFsaWFzZXMgYW5kIGpvaW5zIHRoYW4gYW55IGV4aXN0aW5n\nIFdIRVJFIGNvbmRpdGlvbnMgb24gdGhpcyBmaWVsZAogICAgICAgIC8vIHRo\nYXQgbWlnaHQgb3RoZXJ3aXNlIGxpbWl0IHRoZSBlbGVtZW50cyBvZiB0aGUg\nZmllbGQgdGhhdCBtYXRjaAogICAgICAgIGlmIChzZWxlY3RPaWQpCiAgICAg\nICAgICAgIHNlbC5vcmRlckJ5UHJpbWFyeUtleShmaWVsZC5nZXREZWZpbmlu\nZ01hcHBpbmcoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgSm9pbnMgam9pbnMg\nPSBzZWwubmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgIGpv\naW5zID0gam9pbihqb2lucywgZWxlbSk7CgogICAgICAgIC8vIG9yZGVyLCBy\nZWYgY29scwogICAgICAgIGlmIChmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9\nIG51bGwgfHwgZmllbGQuZ2V0T3JkZXJzKCkubGVuZ3RoID4gMAogICAgICAg\nICAgICB8fCAhc2VsZWN0T2lkKSB7CiAgICAgICAgICAgIGlmIChvdXRlcikK\nICAgICAgICAgICAgICAgIGpvaW5zID0gc2VsLm91dGVyKGpvaW5zKTsKICAg\nICAgICAgICAgaWYgKCFzZWxlY3RPaWQpIHsKICAgICAgICAgICAgICAgIENv\nbHVtbltdIHJlZnMgPSBnZXRKb2luRm9yZWlnbktleShlbGVtKS5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgICAgICAgICBzZWwub3JkZXJCeShyZWZzLCB0cnVl\nLCBqb2lucywgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmll\nbGQub3JkZXJMb2NhbChzZWwsIGVsZW0sIGpvaW5zKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIHNlbGVjdCBkYXRhCiAgICAgICAgam9pbnMgPSBqb2luRWxl\nbWVudFJlbGF0aW9uKGpvaW5zLCBlbGVtKTsKICAgICAgICBpZiAob3V0ZXIp\nCiAgICAgICAgICAgIGpvaW5zID0gc2VsLm91dGVyKGpvaW5zKTsKICAgICAg\nICBmaWVsZC5vcmRlclJlbGF0aW9uKHNlbCwgZWxlbSwgam9pbnMpOwogICAg\nICAgIHNlbGVjdEVsZW1lbnQoc2VsLCBlbGVtLCBzdG9yZSwgZmV0Y2gsIGVh\nZ2VyTW9kZSwgam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9h\nZEVhZ2VyUGFyYWxsZWwoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0\nb3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIE9iamVjdCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gcHJvY2VzcyBiYXRjaGVkIHJlc3VsdHMgaWYgd2UgaGF2\nZW4ndCBhbHJlYWR5CiAgICAgICAgTWFwIHJlbHM7CiAgICAgICAgaWYgKHJl\ncyBpbnN0YW5jZW9mIFJlc3VsdCkKICAgICAgICAgICAgcmVscyA9IHByb2Nl\nc3NFYWdlclBhcmFsbGVsUmVzdWx0KHNtLCBzdG9yZSwgZmV0Y2gsIChSZXN1\nbHQpIHJlcyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZWxzID0gKE1h\ncCkgcmVzOwoKICAgICAgICAvLyBsb29rIHVwIHRoZSBjb2xsZWN0aW9uIGZv\nciB0aGlzIG9pZCwgYW5kIHN0b3JlIGluIGluc3RhbmNlCiAgICAgICAgT2Jq\nZWN0IGNvbGwgPSByZWxzLnJlbW92ZShzbS5nZXRPYmplY3RJZCgpKTsKICAg\nICAgICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJS\nQVkpCiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4\nKCksIEphdmFUeXBlcy50b0FycmF5CiAgICAgICAgICAgICAgICAoKENvbGxl\nY3Rpb24pIGNvbGwsIGZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlKCkpKTsK\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKGNvbGwgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGNvbGwgPSBzbS5uZXdQcm94eShmaWVsZC5nZXRJ\nbmRleCgpKTsKICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0\nSW5kZXgoKSwgY29sbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWxz\nOwogICAgfQoKICAgIC8qKgogICAgICogUHJvY2VzcyB0aGUgZ2l2ZW4gYmF0\nY2hlZCByZXN1bHQuCiAgICAgKi8KICAgIHByaXZhdGUgTWFwIHByb2Nlc3NF\nYWdlclBhcmFsbGVsUmVzdWx0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAg\nICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLCBSZXN1bHQgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIC8vIGRvIHNhbWUgam9pbnMgYXMgZm9yIGxvYWQKICAg\nICAgICAvLyMjIyBjaGVhdDogd2Uga25vdyB0eXBpY2FsIHJlc3VsdCBqb2lu\ncyBvbmx5IGNhcmUgYWJvdXQgdGhlIHJlbGF0aW9uCiAgICAgICAgLy8jIyMg\ncGF0aDsgdGh1cyB3ZSBjYW4gaWdub3JlIGRpZmZlcmVudCBtYXBwaW5ncwog\nICAgICAgIENsYXNzTWFwcGluZyBlbGVtID0gZ2V0RGVmYXVsdEVsZW1lbnRN\nYXBwaW5nKHRydWUpOwogICAgICAgIEpvaW5zIGRhdGFKb2lucyA9IHJlcy5u\nZXdKb2lucygpLnNldFZhcmlhYmxlKCIqIik7CiAgICAgICAgZGF0YUpvaW5z\nID0gam9pbihkYXRhSm9pbnMsIGVsZW0pOwogICAgICAgIGRhdGFKb2lucyA9\nIGpvaW5FbGVtZW50UmVsYXRpb24oZGF0YUpvaW5zLCBlbGVtKTsKICAgICAg\nICBKb2lucyBvcmRlckpvaW5zID0gbnVsbDsKICAgICAgICBpZiAoZmllbGQu\nZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKSB7CiAgICAgICAgICAgIG9yZGVy\nSm9pbnMgPSByZXMubmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAg\nICAgICAgICBvcmRlckpvaW5zID0gam9pbihvcmRlckpvaW5zLCBlbGVtKTsK\nICAgICAgICB9CgogICAgICAgIE1hcCByZWxzID0gbmV3IEhhc2hNYXAoKTsK\nICAgICAgICBDbGFzc01hcHBpbmcgb3duZXJNYXBwaW5nID0gZmllbGQuZ2V0\nRGVmaW5pbmdNYXBwaW5nKCk7CiAgICAgICAgT2JqZWN0IG5leHRPaWQsIG9p\nZCA9IG51bGw7CiAgICAgICAgT2JqZWN0IGNvbGwgPSBudWxsOwogICAgICAg\nIGludCBzZXEgPSAwOwogICAgICAgIHdoaWxlIChyZXMubmV4dCgpKSB7CiAg\nICAgICAgICAgIC8vIGV4dHJhY3QgdGhlIG93bmVyIGlkIHZhbHVlCiAgICAg\nICAgICAgIG5leHRPaWQgPSBnZXROZXh0T2JqZWN0SWQob3duZXJNYXBwaW5n\nLCBzdG9yZSwgcmVzLCBvaWQpOwogICAgICAgICAgICBpZiAobmV4dE9pZCAh\nPSBvaWQpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBvbGQgY29sbCB3\nYXMgYW4gb3JkZXJlZCB0cmFja2luZyBwcm94eSwgc2V0CiAgICAgICAgICAg\nICAgICAvLyBpdHMgc2VxIHZhbHVlIHRvIHRoZSBsYXN0IG9yZGVyIHZhbCB3\nZSByZWFkCiAgICAgICAgICAgICAgICBpZiAoc2VxICE9IDAgJiYgY29sbCBp\nbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICAgICAgICAgICgoUHJveHkp\nIGNvbGwpLmdldENoYW5nZVRyYWNrZXIoKS5zZXROZXh0U2VxdWVuY2Uoc2Vx\nKTsKCiAgICAgICAgICAgICAgICAvLyBzdGFydCBhIG5ldyBjb2xsZWN0aW9u\nCiAgICAgICAgICAgICAgICBvaWQgPSBuZXh0T2lkOwogICAgICAgICAgICAg\nICAgc2VxID0gMDsKICAgICAgICAgICAgICAgIGlmIChmaWVsZC5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWSkKICAgICAgICAgICAgICAgICAg\nICBjb2xsID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIGNvbGwgPSBzbS5uZXdQcm94eShmaWVs\nZC5nZXRJbmRleCgpKTsKICAgICAgICAgICAgICAgIHJlbHMucHV0KG9pZCwg\nY29sbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZC5n\nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXEg\nPSByZXMuZ2V0SW50KGZpZWxkLmdldE9yZGVyQ29sdW1uKCksIG9yZGVySm9p\nbnMpICsgMTsKICAgICAgICAgICAgYWRkKHN0b3JlLCBjb2xsLCBsb2FkRWxl\nbWVudChudWxsLCBzdG9yZSwgZmV0Y2gsIHJlcywgZGF0YUpvaW5zKSk7CiAg\nICAgICAgfQogICAgICAgIHJlcy5jbG9zZSgpOwoKICAgICAgICByZXR1cm4g\ncmVsczsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3QgdGhlIG9pZCB2\nYWx1ZSBmcm9tIHRoZSBnaXZlbiByZXN1bHQuIElmIHRoZSBuZXh0IG9pZCBp\ncyB0aGUKICAgICAqIHNhbWUgYXMgdGhlIGdpdmVuIG9uZSwgcmV0dXJucyB0\naGUgZ2l2ZW4gSlZNIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIE9i\namVjdCBnZXROZXh0T2JqZWN0SWQoQ2xhc3NNYXBwaW5nIG93bmVyLCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgUmVzdWx0IHJlcywgT2JqZWN0IG9pZCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiB0\naGlzIGlzIGEgZGF0YXN0b3JlIGlkIGNsYXNzIHdlIGNhbiBhdm9pZCBjcmVh\ndGluZyBhIG5ldyBvaWQKICAgICAgICAvLyBvYmplY3QgZm9yIHRoZSBjb21t\nb24gY2FzZQogICAgICAgIGlmIChvaWQgIT0gbnVsbCAmJiBvd25lci5nZXRJ\nZGVudGl0eVR5cGUoKSA9PSBDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFCiAg\nICAgICAgICAgICYmIG93bmVyLmlzUHJpbWFyeUtleU9iamVjdElkKHRydWUp\nKSB7CiAgICAgICAgICAgIGxvbmcgbmlkID0gcmVzLmdldExvbmcob3duZXIu\nZ2V0UHJpbWFyeUtleUNvbHVtbnMoKVswXSk7CiAgICAgICAgICAgIGxvbmcg\naWQgPSAoKElkKSBvaWQpLmdldElkKCk7CiAgICAgICAgICAgIHJldHVybiAo\nbmlkID09IGlkKSA/IG9pZCA6IHN0b3JlLm5ld0RhdGFTdG9yZUlkKG5pZCwg\nb3duZXIsIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG5vaWQg\nPSBvd25lci5nZXRPYmplY3RJZChzdG9yZSwgcmVzLCBudWxsLCB0cnVlLCBu\ndWxsKTsKICAgICAgICBpZiAobm9pZCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKG5vaWQuZXF1YWxzKG9pZCkp\nID8gb2lkIDogbm9pZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkRWFn\nZXJKb2luKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9y\nZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1\nbHQgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIC8vIGluaXRpYWxpemUgZmllbGQgdmFsdWUKICAgICAgICBPYmplY3QgY29s\nbDsKICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuQVJSQVkpCiAgICAgICAgICAgIGNvbGwgPSBuZXcgQXJyYXlMaXN0KCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2xsID0gc20ubmV3UHJveHko\nZmllbGQuZ2V0SW5kZXgoKSk7CgogICAgICAgIEpvaW5zIGRhdGFKb2lucyA9\nIG51bGw7CiAgICAgICAgSm9pbnMgcmVmSm9pbnMgPSByZXMubmV3Sm9pbnMo\nKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgIGpvaW4ocmVmSm9pbnMsIGZh\nbHNlKTsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIG93bmVyTWFwcGluZyA9IGZp\nZWxkLmdldERlZmluaW5nTWFwcGluZygpOwogICAgICAgIE9iamVjdCByZWYg\nPSBudWxsOwogICAgICAgIGludCBzZXEgPSAwOwogICAgICAgIGludCB0eXBl\nSWR4ID0gcmVzLmluZGV4T2YoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\ndHJ1ZTsgaSsrKSB7CiAgICAgICAgICAgIC8vIGV4dHJhY3QgdGhlIG93bmVy\nIGlkIHZhbHVlCiAgICAgICAgICAgIHJlZiA9IGdldE5leHRSZWYob3duZXJN\nYXBwaW5nLCBzdG9yZSwgcmVzLCByZWYsIHJlZkpvaW5zKTsKICAgICAgICAg\nICAgaWYgKHJlZiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0\naGUgb2xkIGNvbGwgd2FzIGFuIG9yZGVyZWQgdHJhY2tpbmcgcHJveHksIHNl\ndAogICAgICAgICAgICAgICAgLy8gaXRzIHNlcSB2YWx1ZSB0byB0aGUgbGFz\ndCBvcmRlciB2YWwgd2UgcmVhZAogICAgICAgICAgICAgICAgaWYgKHNlcSAh\nPSAwICYmIGNvbGwgaW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgICAg\nICAgICAoKFByb3h5KSBjb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCkuc2V0TmV4\ndFNlcXVlbmNlKHNlcSk7CiAgICAgICAgICAgICAgICBpZiAoaSAhPSAwKQog\nICAgICAgICAgICAgICAgICAgIHJlcy5wdXNoQmFjaygpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRv\nIHNhbWUgam9pbnMgYXMgZm9yIGxvYWQKICAgICAgICAgICAgaWYgKGRhdGFK\nb2lucyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRhSm9pbnMgPSBy\nZXMubmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgICAgICAg\nICAgZGF0YUpvaW5zID0gam9pbihkYXRhSm9pbnMsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGRhdGFKb2lucyA9IGpvaW5SZWxhdGlvbihkYXRhSm9pbnMs\nIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlm\nIChmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBzZXEgPSByZXMuZ2V0SW50KGZpZWxkLmdldE9yZGVyQ29sdW1uKCks\nIHJlZkpvaW5zKSArIDE7CiAgICAgICAgICAgIHJlcy5zZXRCYXNlTWFwcGlu\nZyhudWxsKTsKICAgICAgICAgICAgYWRkKHN0b3JlLCBjb2xsLCBsb2FkRWxl\nbWVudChzbSwgc3RvcmUsIGZldGNoLCByZXMsIGRhdGFKb2lucykpOwogICAg\nICAgICAgICBpZiAoIXJlcy5uZXh0KCkgfHwgcmVzLmluZGV4T2YoKSAhPSB0\neXBlSWR4KSB7CiAgICAgICAgICAgICAgICByZXMucHVzaEJhY2soKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBsb2FkIHRoZSBjb2xsZWN0aW9uIGludG8gdGhlIG9iamVj\ndAogICAgICAgIGlmIChmaWVsZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBl\ncy5BUlJBWSkKICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0\nSW5kZXgoKSwgSmF2YVR5cGVzLnRvQXJyYXkKICAgICAgICAgICAgICAgICgo\nQ29sbGVjdGlvbikgY29sbCwgZmllbGQuZ2V0RWxlbWVudCgpLmdldFR5cGUo\nKSkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc20uc3RvcmVPYmplY3Qo\nZmllbGQuZ2V0SW5kZXgoKSwgY29sbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBFeHRyYWN0IHRoZSByZWZlcmVuY2UgY29sdW1uIHZhbHVlKHMpIGZyb20g\ndGhlIGdpdmVuIHJlc3VsdC4gSWYgdGhlCiAgICAgKiBleHRyYWN0ZWQgcmVz\ndWx0IGlzIHRoZSBzYW1lIGFzIHRoZSBjdXJyZW50IG9uZSBvciB0aGUgY3Vy\ncmVudAogICAgICogb25lIGlzIG51bGwsIHJldHVybnMgdGhlIGV4dHJhY3Rl\nZCByZXN1bHQuIEVsc2UgcmV0dXJucyBudWxsLgogICAgICovCiAgICBwcml2\nYXRlIE9iamVjdCBnZXROZXh0UmVmKENsYXNzTWFwcGluZyBtYXBwaW5nLCBK\nREJDU3RvcmUgc3RvcmUsCiAgICAgICAgUmVzdWx0IHJlcywgT2JqZWN0IHJl\nZiwgSm9pbnMgcmVmSm9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IGdldEpvaW5Gb3JlaWduS2V5\nKGdldERlZmF1bHRFbGVtZW50TWFwcGluZyhmYWxzZSkpLgogICAgICAgICAg\nICBnZXRDb2x1bW5zKCk7CiAgICAgICAgT2JqZWN0IHZhbDsKICAgICAgICBp\nZiAoY29scy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICB2YWwgPSByZXMu\nZ2V0T2JqZWN0KGNvbHNbMF0sIG51bGwsIHJlZkpvaW5zKTsKICAgICAgICAg\nICAgaWYgKHZhbCA9PSBudWxsIHx8IChyZWYgIT0gbnVsbCAmJiAhdmFsLmVx\ndWFscyhyZWYpKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0\nW10gcmVmcyA9IChPYmplY3RbXSkgcmVmOwogICAgICAgIGlmIChyZWZzID09\nIG51bGwpCiAgICAgICAgICAgIHJlZnMgPSBuZXcgT2JqZWN0W2NvbHMubGVu\nZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgdmFsID0gcmVzLmdldE9iamVjdChjb2xz\nW2ldLCBudWxsLCByZWZKb2lucyk7CiAgICAgICAgICAgIGlmICh2YWwgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICBpZiAocmVmc1tpXSAhPSBudWxsICYmICF2YWwuZXF1YWxzKHJlZnNbaV0p\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJl\nZnNbaV0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWZzOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQoZmluYWwgT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgZmluYWwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIGZp\nbmFsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZpZWxkLmlzTFJTKCkp\nIHsKICAgICAgICAgICAgUHJveHkgY29sbCA9IG5ld0xSU1Byb3h5KCk7Cgog\nICAgICAgICAgICAvLyBpZiB0aGlzIGlzIG9yZGVyZWQgd2UgbmVlZCB0byBr\nbm93IHRoZSBuZXh0IHNlcSB0byB1c2UgaW4gY2FzZQogICAgICAgICAgICAv\nLyBvYmplY3RzIGFyZSBhZGRlZCB0byB0aGUgY29sbGVjdGlvbgogICAgICAg\nICAgICBpZiAoZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAvLyB3ZSBkb24ndCBhbGxvdyBvcmRlcmluZyB0YWJs\nZSBwZXIgY2xhc3Mgb25lLW1hbnkncywgc28KICAgICAgICAgICAgICAgIC8v\nIHdlIGtub3cgd2UgZG9uJ3QgbmVlZCBhIHVuaW9uCiAgICAgICAgICAgICAg\nICBTZWxlY3Qgc2VsID0gc3RvcmUuZ2V0U1FMRmFjdG9yeSgpLm5ld1NlbGVj\ndCgpOwogICAgICAgICAgICAgICAgc2VsLnNldEFnZ3JlZ2F0ZSh0cnVlKTsK\nICAgICAgICAgICAgICAgIFN0cmluZ0J1ZmZlciBzcWwgPSBuZXcgU3RyaW5n\nQnVmZmVyKCk7CiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCJNQVgoIiku\nCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlh\ncyhmaWVsZC5nZXRPcmRlckNvbHVtbigpKSkuCiAgICAgICAgICAgICAgICAg\nICAgYXBwZW5kKCIpIik7CiAgICAgICAgICAgICAgICBzZWwuc2VsZWN0KHNx\nbC50b1N0cmluZygpLCBmaWVsZCk7CiAgICAgICAgICAgICAgICBDbGFzc01h\ncHBpbmcgcmVsID0gZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5nKGZhbHNlKTsK\nICAgICAgICAgICAgICAgIHNlbC53aGVyZUZvcmVpZ25LZXkoZ2V0Sm9pbkZv\ncmVpZ25LZXkocmVsKSwKICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmpl\nY3RJZCgpLCBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSwgc3RvcmUpOwoK\nICAgICAgICAgICAgICAgIFJlc3VsdCByZXMgPSBzZWwuZXhlY3V0ZShzdG9y\nZSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICByZXMubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGNvbGwu\nZ2V0Q2hhbmdlVHJhY2tlcigpLnNldE5leHRTZXF1ZW5jZQogICAgICAgICAg\nICAgICAgICAgICAgICAocmVzLmdldEludChmaWVsZCkgKyAxKTsKICAgICAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgc20uc3RvcmVPYmplY3RGaWVsZChmaWVsZC5nZXRJbmRleCgp\nLCBjb2xsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gc2VsZWN0IGRhdGEgZm9yIHRoaXMgc20KICAgICAgICBmaW5hbCBD\nbGFzc01hcHBpbmdbXSBlbGVtcyA9IGdldEluZGVwZW5kZW50RWxlbWVudE1h\ncHBpbmdzKHRydWUpOwogICAgICAgIGZpbmFsIEpvaW5zW10gcmVzSm9pbnMg\nPSBuZXcgSm9pbnNbTWF0aC5tYXgoMSwgZWxlbXMubGVuZ3RoKV07CiAgICAg\nICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3VW5p\nb24KICAgICAgICAgICAgKE1hdGgubWF4KDEsIGVsZW1zLmxlbmd0aCkpOwog\nICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQg\naWR4KSB7CiAgICAgICAgICAgICAgICBDbGFzc01hcHBpbmcgZWxlbSA9IChl\nbGVtcy5sZW5ndGggPT0gMCkgPyBudWxsIDogZWxlbXNbaWR4XTsKICAgICAg\nICAgICAgICAgIHJlc0pvaW5zW2lkeF0gPSBzZWxlY3RBbGwoc2VsLCBlbGVt\nLCBzbSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICAgICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFSQUxMRUwpOwogICAgICAgICAg\nICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIGNyZWF0ZSBwcm94eQogICAg\nICAgIE9iamVjdCBjb2xsOwogICAgICAgIENoYW5nZVRyYWNrZXIgY3QgPSBu\ndWxsOwogICAgICAgIGlmIChmaWVsZC5nZXRUeXBlQ29kZSgpID09IEphdmFU\neXBlcy5BUlJBWSkKICAgICAgICAgICAgY29sbCA9IG5ldyBBcnJheUxpc3Qo\nKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29sbCA9IHNtLm5ld1By\nb3h5KGZpZWxkLmdldEluZGV4KCkpOwogICAgICAgICAgICBpZiAoY29sbCBp\nbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICAgICAgY3QgPSAoKFByb3h5\nKSBjb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBsb2FkIHZhbHVlcwogICAgICAgIFJlc3VsdCByZXMgPSB1bmlvbi5l\neGVjdXRlKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaW50IHNlcSA9IC0xOwogICAgICAgICAgICB3aGlsZSAocmVzLm5leHQo\nKSkgewogICAgICAgICAgICAgICAgaWYgKGN0ICE9IG51bGwgJiYgZmllbGQu\nZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHNlcSA9IHJlcy5nZXRJbnQoZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSk7CiAg\nICAgICAgICAgICAgICBhZGQoc3RvcmUsIGNvbGwsIGxvYWRFbGVtZW50KHNt\nLCBzdG9yZSwgZmV0Y2gsIHJlcywKICAgICAgICAgICAgICAgICAgICByZXNK\nb2luc1tyZXMuaW5kZXhPZigpXSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChjdCAhPSBudWxsICYmIGZpZWxkLmdldE9yZGVyQ29sdW1uKCkg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGN0LnNldE5leHRTZXF1ZW5jZShz\nZXEgKyAxKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICByZXMu\nY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIC8vIHNldCBpbnRvIHNtCiAg\nICAgICAgaWYgKGZpZWxkLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLkFS\nUkFZKQogICAgICAgICAgICBzbS5zdG9yZU9iamVjdChmaWVsZC5nZXRJbmRl\neCgpLCBKYXZhVHlwZXMudG9BcnJheQogICAgICAgICAgICAgICAgKChDb2xs\nZWN0aW9uKSBjb2xsLCBmaWVsZC5nZXRFbGVtZW50KCkuZ2V0VHlwZSgpKSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzbS5zdG9yZU9iamVjdChmaWVs\nZC5nZXRJbmRleCgpLCBjb2xsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\nbGVjdCBkYXRhIGZvciBsb2FkaW5nLCBzdGFydGluZyBpbiBmaWVsZCB0YWJs\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEpvaW5zIHNlbGVjdEFsbChTZWxl\nY3Qgc2VsLCBDbGFzc01hcHBpbmcgZWxlbSwKICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyTW9kZSkgewogICAg\nICAgIHNlbC53aGVyZUZvcmVpZ25LZXkoZ2V0Sm9pbkZvcmVpZ25LZXkoZWxl\nbSksIHNtLmdldE9iamVjdElkKCksCiAgICAgICAgICAgIGZpZWxkLmdldERl\nZmluaW5nTWFwcGluZygpLCBzdG9yZSk7CgogICAgICAgIC8vIG9yZGVyIGZp\ncnN0LCB0aGVuIHNlbGVjdCBzbyB0aGF0IGlmIHRoZSBwcm9qZWN0aW9uIGlu\ndHJvZHVjZXMKICAgICAgICAvLyBhZGRpdGlvbmFsIG9yZGVyaW5nLCBpdCB3\naWxsIGJlIGFmdGVyIG91ciByZXF1aXJlZCBvcmRlcmluZwogICAgICAgIGZp\nZWxkLm9yZGVyTG9jYWwoc2VsLCBlbGVtLCBudWxsKTsKICAgICAgICBKb2lu\ncyBqb2lucyA9IGpvaW5FbGVtZW50UmVsYXRpb24oc2VsLm5ld0pvaW5zKCks\nIGVsZW0pOwogICAgICAgIGZpZWxkLm9yZGVyUmVsYXRpb24oc2VsLCBlbGVt\nLCBqb2lucyk7CiAgICAgICAgc2VsZWN0RWxlbWVudChzZWwsIGVsZW0sIHN0\nb3JlLCBmZXRjaCwgZWFnZXJNb2RlLCBqb2lucyk7CiAgICAgICAgcmV0dXJu\nIGpvaW5zOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZFByb2plY3Rp\nb24oSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBsb2FkRWxl\nbWVudChudWxsLCBzdG9yZSwgZmV0Y2gsIHJlcywgam9pbnMpOwogICAgfQoK\nICAgIHByb3RlY3RlZCBGb3JlaWduS2V5IGdldEpvaW5Gb3JlaWduS2V5KCkg\newogICAgICAgIHJldHVybiBnZXRKb2luRm9yZWlnbktleShnZXREZWZhdWx0\nRWxlbWVudE1hcHBpbmcoZmFsc2UpKTsKICAgIH0KfQo=\n","encoding":"base64"}

