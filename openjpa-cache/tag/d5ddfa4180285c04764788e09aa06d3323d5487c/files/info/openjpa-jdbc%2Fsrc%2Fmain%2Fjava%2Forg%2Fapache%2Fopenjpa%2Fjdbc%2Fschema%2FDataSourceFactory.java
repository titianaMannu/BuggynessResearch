{"sha":"a807f847d37a6ae6388d3e789aceb82e2fc48836","node_id":"MDQ6QmxvYjIwNjM2NDphODA3Zjg0N2QzN2E2YWU2Mzg4ZDNlNzg5YWNlYjgyZTJmYzQ4ODM2","size":11590,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a807f847d37a6ae6388d3e789aceb82e2fc48836","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2\nYS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRyaXZlcjsKaW1w\nb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2\nYS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9y\ndCBqYXZheC5zcWwuRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkNvbmZpZ3VyaW5n\nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuamRiYy5Db25uZWN0aW9uRGVjb3JhdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlY29yYXRpbmdEYXRhU291cmNlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdE\nYXRhU291cmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJj\nLkpEQkNFdmVudENvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmpkYmMuSkRCQ0xpc3RlbmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkxvZ2dpbmdDb25uZWN0aW9uRGVj\nb3JhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhl\nbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9y\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVz\nZXJFeGNlcHRpb247CgovKioKICogRmFjdG9yeSBmb3Ige0BsaW5rIERhdGFT\nb3VyY2V9IG9iamVjdHMuIFRoZSBmYWN0b3J5IHVzZXMgdGhlIHN1cHBsaWVk\nCiAqIGNvbmZpZ3VyYXRpb24gdG8gb2J0YWluIGEgM3JkLXBhcnR5IGRhdGFz\nb3VyY2Ugb3IgdG8gY3JlYXRlIG9uZSwgYW5kCiAqIHRvIHNldHVwIHByZXBh\ncmVkIHN0YXRlbWVudCBjYWNoaW5nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRGF0YVNvdXJjZUZh\nY3RvcnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoRGF0YVNvdXJj\nZUZhY3RvcnkuY2xhc3MpOwoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgZGF0\nYXNvdXJjZSB1c2luZyB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbi4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBEYXRhU291cmNlIG5ld0RhdGFTb3VyY2Uo\nSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBib29sZWFuIGZhY3Rv\ncnkyKSB7CiAgICAgICAgU3RyaW5nIGRyaXZlciA9IChmYWN0b3J5MikgPyBj\nb25mLmdldENvbm5lY3Rpb24yRHJpdmVyTmFtZSgpCiAgICAgICAgICAgIDog\nY29uZi5nZXRDb25uZWN0aW9uRHJpdmVyTmFtZSgpOwogICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KGRyaXZlcikpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1kcml2ZXIiLCBkcml2\nZXIpKS4KICAgICAgICAgICAgICAgIHNldEZhdGFsKHRydWUpOwoKICAgICAg\nICBDbGFzc0xvYWRlciBsb2FkZXIgPSBjb25mLmdldENsYXNzUmVzb2x2ZXJJ\nbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihEYXRhU291\ncmNlRmFjdG9yeS5jbGFzcywgbnVsbCk7CiAgICAgICAgU3RyaW5nIHByb3Bz\nID0gKGZhY3RvcnkyKSA/IGNvbmYuZ2V0Q29ubmVjdGlvbjJQcm9wZXJ0aWVz\nKCkKICAgICAgICAgICAgOiBjb25mLmdldENvbm5lY3Rpb25Qcm9wZXJ0aWVz\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3MgZHJpdmVyQ2xh\nc3M7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkcml2ZXJD\nbGFzcyA9IENsYXNzLmZvck5hbWUoZHJpdmVyLCB0cnVlLCBsb2FkZXIpOwog\nICAgICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNu\nZmUpIHsKICAgICAgICAgICAgICAgIC8vIHRyeSB3aXRoIHRoZSBjb3JlIGNs\nYXNzIGxvYWRlcgogICAgICAgICAgICAgICAgZHJpdmVyQ2xhc3MgPSBDbGFz\ncy5mb3JOYW1lKGRyaXZlcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChEcml2ZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShkcml2ZXJDbGFz\ncykpIHsKICAgICAgICAgICAgICAgIERyaXZlckRhdGFTb3VyY2UgZHMgPSBj\nb25mLm5ld0RyaXZlckRhdGFTb3VyY2VJbnN0YW5jZSgpOwogICAgICAgICAg\nICAgICAgZHMuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAgICAgICAg\nICAgIGRzLnNldENvbm5lY3Rpb25Ecml2ZXJOYW1lKGRyaXZlcik7CiAgICAg\nICAgICAgICAgICBkcy5zZXRDb25uZWN0aW9uUHJvcGVydGllcyhDb25maWd1\ncmF0aW9ucy4KICAgICAgICAgICAgICAgICAgICBwYXJzZVByb3BlcnRpZXMo\ncHJvcHMpKTsKCiAgICAgICAgICAgICAgICBpZiAoIWZhY3RvcnkyKSB7CiAg\nICAgICAgICAgICAgICAgICAgZHMuc2V0Q29ubmVjdGlvbkZhY3RvcnlQcm9w\nZXJ0aWVzKENvbmZpZ3VyYXRpb25zLgogICAgICAgICAgICAgICAgICAgICAg\nICBwYXJzZVByb3BlcnRpZXMoY29uZi5nZXRDb25uZWN0aW9uRmFjdG9yeVBy\nb3BlcnRpZXMoKSkpOwogICAgICAgICAgICAgICAgICAgIGRzLnNldENvbm5l\nY3Rpb25VUkwoY29uZi5nZXRDb25uZWN0aW9uVVJMKCkpOwogICAgICAgICAg\nICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25Vc2VyTmFtZShjb25mLmdldENv\nbm5lY3Rpb25Vc2VyTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICBkcy5z\nZXRDb25uZWN0aW9uUGFzc3dvcmQoY29uZi5nZXRDb25uZWN0aW9uUGFzc3dv\ncmQoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIGRzLnNldENvbm5lY3Rpb25GYWN0b3J5UHJvcGVydGllcwogICAg\nICAgICAgICAgICAgICAgICAgICAoQ29uZmlndXJhdGlvbnMucGFyc2VQcm9w\nZXJ0aWVzKGNvbmYuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvbm5l\nY3Rpb25GYWN0b3J5MlByb3BlcnRpZXMoKSkpOwogICAgICAgICAgICAgICAg\nICAgIGRzLnNldENvbm5lY3Rpb25VUkwoY29uZi5nZXRDb25uZWN0aW9uMlVS\nTCgpKTsKICAgICAgICAgICAgICAgICAgICBkcy5zZXRDb25uZWN0aW9uVXNl\nck5hbWUoY29uZi5nZXRDb25uZWN0aW9uMlVzZXJOYW1lKCkpOwogICAgICAg\nICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25QYXNzd29yZChjb25mLmdl\ndENvbm5lY3Rpb24yUGFzc3dvcmQoKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm4gZHM7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHNlZSBpZiB0aGVpciBkcml2ZXIgbmFtZSBpcyBhY3R1YWxs\neSBhIGRhdGEgc291cmNlCiAgICAgICAgICAgIGlmIChEYXRhU291cmNlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oZHJpdmVyQ2xhc3MpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gKERhdGFTb3VyY2UpIENvbmZpZ3VyYXRpb25zLm5l\nd0luc3RhbmNlKGRyaXZlciwKICAgICAgICAgICAgICAgICAgICBjb25mLCBw\ncm9wcywgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBEYXRhU291cmNlLmNsYXNzKSkpOyAKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24o\nZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBub3Qg\nYSBkcml2ZXIgb3IgYSBkYXRhIHNvdXJjZTsgZGllCiAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kcml2ZXIiLCBkcml2\nZXIpKS5zZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIElu\nc3RhbGwgbGlzdGVuZXJzIGFuZCBiYXNlIGRlY29yYXRvcnMuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgRGVjb3JhdGluZ0RhdGFTb3VyY2UgZGVjb3Jh\ndGVEYXRhU291cmNlKERhdGFTb3VyY2UgZHMsCiAgICAgICAgSkRCQ0NvbmZp\nZ3VyYXRpb24gY29uZiwgYm9vbGVhbiBmYWN0b3J5MikgewogICAgICAgIE9w\ndGlvbnMgb3B0cyA9IENvbmZpZ3VyYXRpb25zLnBhcnNlUHJvcGVydGllcygo\nZmFjdG9yeTIpCiAgICAgICAgICAgID8gY29uZi5nZXRDb25uZWN0aW9uRmFj\ndG9yeTJQcm9wZXJ0aWVzKCkKICAgICAgICAgICAgOiBjb25mLmdldENvbm5l\nY3Rpb25GYWN0b3J5UHJvcGVydGllcygpKTsKICAgICAgICBMb2cgamRiY0xv\nZyA9IGNvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsK\nICAgICAgICBMb2cgc3FsTG9nID0gY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3Vy\nYXRpb24uTE9HX1NRTCk7CgogICAgICAgIERlY29yYXRpbmdEYXRhU291cmNl\nIGRkcyA9IG5ldyBEZWNvcmF0aW5nRGF0YVNvdXJjZShkcyk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gYWRkIHVzZXItZGVmaW5lZCBkZWNvcmF0\nb3JzCiAgICAgICAgICAgIExpc3QgZGVjb3JhdG9ycyA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgZGVjb3JhdG9ycy5hZGRBbGwoQXJyYXlzLmFz\nTGlzdChjb25mLgogICAgICAgICAgICAgICAgZ2V0Q29ubmVjdGlvbkRlY29y\nYXRvckluc3RhbmNlcygpKSk7CgogICAgICAgICAgICAvLyBhZGQgamRiYyBl\ndmVudHMgZGVjb3JhdG9yCiAgICAgICAgICAgIEpEQkNFdmVudENvbm5lY3Rp\nb25EZWNvcmF0b3IgZWNkID0KICAgICAgICAgICAgICAgIG5ldyBKREJDRXZl\nbnRDb25uZWN0aW9uRGVjb3JhdG9yKCk7CiAgICAgICAgICAgIENvbmZpZ3Vy\nYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKGVjZCwgY29uZiwgb3B0cyk7CiAg\nICAgICAgICAgIEpEQkNMaXN0ZW5lcltdIGxpc3RlbmVycyA9IGNvbmYuZ2V0\nSkRCQ0xpc3RlbmVySW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgZWNkLmFkZExpc3RlbmVyKGxpc3RlbmVyc1tpXSk7CiAgICAgICAg\nICAgIGRlY29yYXRvcnMuYWRkKGVjZCk7CgogICAgICAgICAgICAvLyBhc2sg\ndGhlIERyaXZlckRhdGFTb3VyY2UgdG8gcHJvdmlkZSBhbnkgYWRkaXRpb25h\nbCBkZWNvcmF0b3JzCiAgICAgICAgICAgIGlmIChkcyBpbnN0YW5jZW9mIERy\naXZlckRhdGFTb3VyY2UpIHsKICAgICAgICAgICAgICAgIExpc3QgZGVjcyA9\nICgoRHJpdmVyRGF0YVNvdXJjZSkgZHMpLgogICAgICAgICAgICAgICAgICAg\nIGNyZWF0ZUNvbm5lY3Rpb25EZWNvcmF0b3JzKCk7CiAgICAgICAgICAgICAg\nICBpZiAoZGVjcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGRlY29y\nYXRvcnMuYWRkQWxsKGRlY3MpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBsb2dnaW5nIGRlY29yYXRvcgogICAgICAgICAgICBMb2dnaW5nQ29u\nbmVjdGlvbkRlY29yYXRvciBsY2QgPQogICAgICAgICAgICAgICAgbmV3IExv\nZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yKCk7CiAgICAgICAgICAgIENvbmZp\nZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKGxjZCwgY29uZiwgb3B0cyk7\nCiAgICAgICAgICAgIGxjZC5nZXRMb2dzKCkuc2V0SkRCQ0xvZyhqZGJjTG9n\nKTsKICAgICAgICAgICAgbGNkLmdldExvZ3MoKS5zZXRTUUxMb2coc3FsTG9n\nKTsKICAgICAgICAgICAgZGVjb3JhdG9ycy5hZGQobGNkKTsKCiAgICAgICAg\nICAgIGRkcy5hZGREZWNvcmF0b3JzKGRlY29yYXRvcnMpOwogICAgICAgICAg\nICByZXR1cm4gZGRzOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3Jl\nRXhjZXB0aW9uKGUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEluc3RhbGwgdGhpbmdzIGRlZmVycmVkIHVudGls\nIHRoZSBEQkRpY3Rpb25hcnkgaW5zdGFuY2UgaXMgYXZhaWxhYmxlLgogICAg\nICoKICAgICAqIEBhdXRob3IgU3RldmUgS2ltCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgRGVjb3JhdGluZ0RhdGFTb3VyY2UgaW5zdGFsbERCRGljdGlv\nbmFyeShEQkRpY3Rpb25hcnkgZGljdCwKICAgICAgICBEZWNvcmF0aW5nRGF0\nYVNvdXJjZSBkcywgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwKICAg\nICAgICBib29sZWFuIGZhY3RvcnkyKSB7CiAgICAgICAgRGF0YVNvdXJjZSBp\nbm5lciA9IGRzLmdldElubmVybW9zdERlbGVnYXRlKCk7CiAgICAgICAgaWYg\nKGlubmVyIGluc3RhbmNlb2YgRHJpdmVyRGF0YVNvdXJjZSkKICAgICAgICAg\nICAgKChEcml2ZXJEYXRhU291cmNlKSBpbm5lcikuaW5pdERCRGljdGlvbmFy\neShkaWN0KTsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBudWxsOwoKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBhZGQgdGhlIGRpY3Rpb25hcnkg\nYXMgYSB3YXJuaW5nIGhhbmRsZXIgb24gdGhlIGxvZ2dpbmcKICAgICAgICAg\nICAgLy8gZGVjb3JhdG9yCiAgICAgICAgICAgIENvbm5lY3Rpb25EZWNvcmF0\nb3IgY2Q7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZHMuZ2V0\nRGVjb3JhdG9ycygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBjZCA9IChDb25uZWN0aW9uRGVjb3JhdG9yKSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGNkIGluc3RhbmNlb2YgTG9n\nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IpCiAgICAgICAgICAgICAgICAgICAg\nKChMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcikgY2QpLnNldFdhcm5pbmdI\nYW5kbGVyKGRpY3QpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBt\naXNjIGNvbmZpZ3VyYXRpb24gY29ubmVjdGlvbiBkZWNvcmF0b3IgKHN0YXRl\nbWVudCB0aW1lb3V0cywKICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb24gaXNv\nbGF0aW9uLCBldGMpCiAgICAgICAgICAgIENvbmZpZ3VyaW5nQ29ubmVjdGlv\nbkRlY29yYXRvciBjY2QgPQogICAgICAgICAgICAgICAgbmV3IENvbmZpZ3Vy\naW5nQ29ubmVjdGlvbkRlY29yYXRvcigpOwogICAgICAgICAgICBjY2Quc2V0\nVHJhbnNhY3Rpb25Jc29sYXRpb24oY29uZi5nZXRUcmFuc2FjdGlvbklzb2xh\ndGlvbkNvbnN0YW50KCkpOwogICAgICAgICAgICBpZiAoZmFjdG9yeTIgfHwg\nIWNvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkpIHsKICAg\nICAgICAgICAgICAgIGlmICghZGljdC5zdXBwb3J0c011bHRpcGxlTm9udHJh\nbnNhY3Rpb25hbFJlc3VsdFNldHMpCiAgICAgICAgICAgICAgICAgICAgY2Nk\nLnNldEF1dG9Db21taXQoQm9vbGVhbi5GQUxTRSk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2NkLnNldEF1dG9Db21taXQo\nQm9vbGVhbi5UUlVFKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBPcHRp\nb25zIG9wdHMgPSBDb25maWd1cmF0aW9ucy5wYXJzZVByb3BlcnRpZXMoKGZh\nY3RvcnkyKQogICAgICAgICAgICAgICAgPyBjb25mLmdldENvbm5lY3Rpb25G\nYWN0b3J5MlByb3BlcnRpZXMoKQogICAgICAgICAgICAgICAgOiBjb25mLmdl\ndENvbm5lY3Rpb25GYWN0b3J5UHJvcGVydGllcygpKTsKICAgICAgICAgICAg\nQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2UoY2NkLCBjb25mLCBv\ncHRzKTsKICAgICAgICAgICAgZHMuYWRkRGVjb3JhdG9yKGNjZCk7CgogICAg\nICAgICAgICAvLyBhbGxvdyB0aGUgZGJkaWN0aW9uYXJ5IHRvIGRlY29yYXRl\nIHRoZSBjb25uZWN0aW9uIGZ1cnRoZXIKICAgICAgICAgICAgZHMuYWRkRGVj\nb3JhdG9yKGRpY3QpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gZW5z\ndXJlIGRiZGljdGlvbmFyeSB0byBwcm9jZXNzIGNvbm5lY3RlZENvbmZpZ3Vy\nYXRpb24oKQogICAgICAgICAgICBpZiAoIWZhY3RvcnkyKQogICAgICAgICAg\nICAgICAgY29ubiA9IGRzLmdldENvbm5lY3Rpb24oY29uZi5nZXRDb25uZWN0\naW9uVXNlck5hbWUoKSwgY29uZgogICAgICAgICAgICAgICAgICAgICAgICAu\nZ2V0Q29ubmVjdGlvblBhc3N3b3JkKCkpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBjb25uID0gZHMuZ2V0Q29ubmVjdGlvbihjb25mLmdl\ndENvbm5lY3Rpb24yVXNlck5hbWUoKSwgY29uZgogICAgICAgICAgICAgICAg\nICAgICAgICAuZ2V0Q29ubmVjdGlvbjJQYXNzd29yZCgpKTsKCiAgICAgICAg\nICAgIHJldHVybiBkczsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSkuc2V0\nRmF0YWwodHJ1ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKGNvbm4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gaWdub3JlIGFueSBleGNlcHRpb24gc2luY2UgdGhlIGNvbm5lY3Rp\nb24gaXMgbm90IGdvaW5nCiAgICAgICAgICAgICAgICAgICAgLy8gdG8gYmUg\ndXNlZCBhbnl3YXkKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBkYXRhIHNvdXJjZSB3aXRoIHRo\nZSBnaXZlbiB1c2VyIG5hbWUgYW5kIHBhc3N3b3JkCiAgICAgKiBwcmUtY29u\nZmlndXJlZCBhcyB0aGUgZGVmYXVsdHMgd2hlbiB7QGxpbmsgRGF0YVNvdXJj\nZSNnZXRDb25uZWN0aW9ufQogICAgICogaXMgY2FsbGVkLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIERhdGFTb3VyY2UgZGVmYXVsdHNEYXRhU291cmNl\nKERhdGFTb3VyY2UgZHMsCiAgICAgICAgU3RyaW5nIHVzZXIsIFN0cmluZyBw\nYXNzKSB7CiAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCAmJiBwYXNzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBkczsKICAgICAgICAvLyBhbHNvIGNo\nZWNrIGlmIHRoZXkgYXJlIGJvdGggYmxhbmsgc3RyaW5ncwogICAgICAgIGlm\nICgiIi5lcXVhbHModXNlcikgJiYgIiIuZXF1YWxzKHBhc3MpKQogICAgICAg\nICAgICByZXR1cm4gZHM7CiAgICAgICAgcmV0dXJuIG5ldyBEZWZhdWx0c0Rh\ndGFTb3VyY2UoZHMsIHVzZXIsIHBhc3MpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2xvc2UgdGhlIGdpdmVuIGRhdGEgc291cmNlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIHZvaWQgY2xvc2VEYXRhU291cmNlKERhdGFTb3VyY2Ug\nZHMpIHsKICAgICAgICBpZiAoZHMgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nRGF0\nYVNvdXJjZSkKICAgICAgICAgICAgZHMgPSAoKERlbGVnYXRpbmdEYXRhU291\ncmNlKSBkcykuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICBJbXBs\nSGVscGVyLmNsb3NlKGRzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEEgZGF0\nYSBzb3VyY2Ugd2l0aCBwcmUtY29uZmlndXJlZCBkZWZhdWx0IHVzZXIgbmFt\nZSBhbmQgcGFzc3dvcmQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNs\nYXNzIERlZmF1bHRzRGF0YVNvdXJjZQogICAgICAgIGV4dGVuZHMgRGVsZWdh\ndGluZ0RhdGFTb3VyY2UgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmlu\nZyBfdXNlcjsKICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBfcGFzczsK\nCiAgICAgICAgcHVibGljIERlZmF1bHRzRGF0YVNvdXJjZShEYXRhU291cmNl\nIGRzLCBTdHJpbmcgdXNlciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICAgICAg\nc3VwZXIoZHMpOwogICAgICAgICAgICBfdXNlciA9IHVzZXI7CiAgICAgICAg\nICAgIF9wYXNzID0gcGFzczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBD\nb25uZWN0aW9uIGdldENvbm5lY3Rpb24oKQogICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENv\nbm5lY3Rpb24oX3VzZXIsIF9wYXNzKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBDb25uZWN0aW9uIGdldENvbm5lY3Rpb24oU3RyaW5nIHVzZXIsIFN0\ncmluZyBwYXNzKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENvbm5lY3Rpb24odXNlciwg\ncGFzcyk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

