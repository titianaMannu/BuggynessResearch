{"sha":"37b99b2ddcbc1db145d4e663513e33f77db6032a","node_id":"MDQ6QmxvYjIwNjM2NDozN2I5OWIyZGRjYmMxZGIxNDVkNGU2NjM1MTNlMzNmNzdkYjYwMzJh","size":54408,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/37b99b2ddcbc1db145d4e663513e33f77db6032a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uUHJpbnRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLldy\naXRlcjsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZh\nLnNxbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuU1FMRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29u\nZmlndXJhdGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogVGhlIFNj\naGVtYVRvb2wgaXMgdXNlZCB0byBtYW5hZ2UgdGhlIGRhdGFiYXNlIHNjaGVt\nYS4gTm90ZSB0aGF0IHRoZQogKiB0b29sIG5ldmVyIGFkZHMgb3IgZHJvcHMg\ndW5pcXVlIGNvbnN0cmFpbnRzIGZyb20gZXhpc3RpbmcgdGFibGVzLCBiZWNh\ndXNlCiAqIEpEQkMge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9IGRvZXMgbm90\nIGluY2x1ZGUgaW5mb3JtYXRpb24gb24gdGhlc2UKICogY29uc3RyYWludHMu\nCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGF0cmljayBM\naW5za2V5CiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hVG9vbCB7CgogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0FERCA9ICJhZGQiOwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0RST1AgPSAi\nZHJvcCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nUkVUQUlOID0gInJldGFpbiI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fUkVGUkVTSCA9ICJyZWZyZXNoIjsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9CVUlMRCA9ICJidWlsZCI7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fUkVGTEVDVCA9\nICJyZWZsZWN0IjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFD\nVElPTl9DUkVBVEVEQiA9ICJjcmVhdGVEQiI7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBBQ1RJT05fRFJPUERCID0gImRyb3BEQiI7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fSU1QT1JUID0gImlt\ncG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nRVhQT1JUID0gImV4cG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTID0gCiAgICAgICAg\nImRlbGV0ZVRhYmxlQ29udGVudHMiOwoKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgU3RyaW5nW10gQUNUSU9OUyA9IG5ldyBTdHJpbmdbXXsKICAgICAgICBB\nQ1RJT05fQURELAogICAgICAgIEFDVElPTl9EUk9QLAogICAgICAgIEFDVElP\nTl9SRVRBSU4sCiAgICAgICAgQUNUSU9OX1JFRlJFU0gsCiAgICAgICAgQUNU\nSU9OX0JVSUxELAogICAgICAgIEFDVElPTl9SRUZMRUNULAogICAgICAgIEFD\nVElPTl9DUkVBVEVEQiwKICAgICAgICBBQ1RJT05fRFJPUERCLAogICAgICAg\nIEFDVElPTl9JTVBPUlQsCiAgICAgICAgQUNUSU9OX0VYUE9SVCwKICAgICAg\nICBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTLAogICAgfTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKFNjaGVtYVRvb2wuY2xhc3MpOwoKICAg\nIHByaXZhdGUgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBw\ncml2YXRlIGZpbmFsIERhdGFTb3VyY2UgX2RzOwogICAgcHJpdmF0ZSBmaW5h\nbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9k\naWN0OwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX2FjdGlvbjsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaWdub3JlRXJycyA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9vcGVuanBhVGFibGVzID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2Ryb3BUYWJsZXMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9kcm9wU2VxcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3Br\ncyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2luZGV4ZXMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zZXFzID0gdHJ1ZTsKICAgIHByaXZhdGUgUHJpbnRXcml0\nZXIgX3dyaXRlciA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9n\ncm91cCA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9kYiA9IG51\nbGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Z1bGxEQiA9IGZhbHNlOwoKICAg\nIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gVG9vbHMgY29uc3Ry\ndWN0ZWQgdGhpcyB3YXkgd2lsbCBub3QgaGF2ZSBhbgogICAgICogYWN0aW9u\nLCBzbyB0aGUge0BsaW5rICNydW4oKX0gbWV0aG9kIHdpbGwgYmUgYSBuby1v\ncC4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRvb2woSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZikgewogICAgICAgIHRoaXMoY29uZiwgbnVsbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB0b29sIHRvIHBlcmZvcm0g\ndGhlIGdpdmVuIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRv\nb2woSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nIGFjdGlvbikgewog\nICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiAhQXJyYXlzLmFzTGlzdChB\nQ1RJT05TKS5jb250YWlucyhhY3Rpb24pKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJhY3Rpb24gPT0gIiArIGFj\ndGlvbik7CgogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBfYWN0aW9u\nID0gYWN0aW9uOwogICAgICAgIF9kcyA9IGNvbmYuZ2V0RGF0YVNvdXJjZTIo\nbnVsbCk7CiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKEpEQkNDb25maWd1\ncmF0aW9uLkxPR19TQ0hFTUEpOwoKICAgICAgICAvLyBpbml0aWFsaXplIHRo\naXMgdXAtZnJvbnQ7IG90aGVyd2lzZSB0aGUgZGJkaWN0aW9uYXJ5ZmFjdG9y\neSBtaWdodAogICAgICAgIC8vIHRyeSB0byB0YWtlIGEgY29ubmVjdGlvbiB0\nbyBpbml0aWFsaXplIHdoZW4gd2UndmUgYWxyZWFkeSBnb3Qgb25lOgogICAg\nICAgIC8vIGJhZCBuZXdzIGlmIHRoZSBtYXggcG9vbCBpcyAxCiAgICAgICAg\nX2RpY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGFjdGlvbiBzdXBwbGllZCBvbiBjb25z\ndHJ1Y3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0QWN0aW9u\nKCkgewogICAgICAgIHJldHVybiBfYWN0aW9uOwogICAgfQoKICAgIC8qKgog\nICAgICogSWYgdHJ1ZSwgU1FMRXhjZXB0aW9ucyB0aHJvd24gZHVyaW5nIHNj\naGVtYSBtYW5pcHVsYXRpb24gd2lsbCBiZQogICAgICogcHJpbnRlZCBidXQg\naWdub3JlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3Jl\nRXJyb3JzKCkgewogICAgICAgIHJldHVybiBfaWdub3JlRXJyczsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHRydWUsIFNRTEV4Y2VwdGlvbnMgdGhyb3du\nIGR1cmluZyBzY2hlbWEgbWFuaXB1bGF0aW9uIHdpbGwgYmUKICAgICAqIHBy\naW50ZWQgYnV0IGlnbm9yZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndElnbm9yZUVycm9ycyhib29sZWFuIGlnbm9yZUVycnMpIHsKICAgICAgICBf\naWdub3JlRXJycyA9IGlnbm9yZUVycnM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRvIGFjdCBvbiBzcGVjaWFsIHRhYmxlcyB1c2VkIGJ5IE9w\nZW5KUEEgY29tcG9uZW50cwogICAgICogZm9yIGJvb2trZWVwaW5nLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcGVuSlBBVGFibGVzKCkgewog\nICAgICAgIHJldHVybiBfb3BlbmpwYVRhYmxlczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gYWN0IG9uIHNwZWNpYWwgdGFibGVzIHVzZWQg\nYnkgT3BlbkpQQSBjb21wb25lbnRzCiAgICAgKiBmb3IgYm9va2tlZXBpbmcu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9wZW5KUEFUYWJsZXMoYm9v\nbGVhbiBvcGVuanBhVGFibGVzKSB7CiAgICAgICAgX29wZW5qcGFUYWJsZXMg\nPSBvcGVuanBhVGFibGVzOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdHJ1\nZSwgdGFibGVzIHRoYXQgYXBwZWFyIHRvIGJlIHVudXNlZCB3aWxsIGJlIGRy\nb3BwZWQuIERlZmF1bHRzIHRvCiAgICAgKiB0cnVlLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXREcm9wVGFibGVzKCkgewogICAgICAgIHJldHVy\nbiBfZHJvcFRhYmxlczsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRydWUs\nIHRhYmxlcyB0aGF0IGFwcGVhciB0byBiZSB1bnVzZWQgd2lsbCBiZSBkcm9w\ncGVkLiBEZWZhdWx0cyB0bwogICAgICogdHJ1ZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RHJvcFRhYmxlcyhib29sZWFuIGRyb3BUYWJsZXMpIHsK\nICAgICAgICBfZHJvcFRhYmxlcyA9IGRyb3BUYWJsZXM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJZiB0cnVlLCBzZXF1ZW5jZXMgdGhhdCBhcHBlYXIgdG8g\nYmUgdW51c2VkIHdpbGwgYmUgZHJvcHBlZC4gRGVmYXVsdHMKICAgICAqIHRv\nIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldERyb3BTZXF1\nZW5jZXMoKSB7CiAgICAgICAgcmV0dXJuIF9kcm9wU2VxczsKICAgIH0KCiAg\nICAvKioKICAgICAqIElmIHRydWUsIHNlcXVlbmNlcyB0aGF0IGFwcGVhciB0\nbyBiZSB1bnVzZWQgd2lsbCBiZSBkcm9wcGVkLiBEZWZhdWx0cwogICAgICog\ndG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RHJvcFNlcXVl\nbmNlcyhib29sZWFuIGRyb3BTZXFzKSB7CiAgICAgICAgX2Ryb3BTZXFzID0g\nZHJvcFNlcXM7CiAgICAgICAgaWYgKGRyb3BTZXFzKQogICAgICAgICAgICBz\nZXRTZXF1ZW5jZXModHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuIERlZmF1bHRz\nIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFNlcXVl\nbmNlcygpIHsKICAgICAgICByZXR1cm4gX3NlcXM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFNlcXVlbmNlcyhib29sZWFuIHNlcXMpIHsKICAgICAgICBfc2VxcyA9\nIHNlcXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGluZGV4ZXMg\nb24gZXhpc3RpbmcgdGFibGVzIHNob3VsZCBiZSBtYW5pcHVsYXRlZC4KICAg\nICAqIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGdldEluZGV4ZXMoKSB7CiAgICAgICAgcmV0dXJuIF9pbmRleGVzOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBpbmRleGVzIG9uIGV4aXN0\naW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAgICAgKiBEZWZh\ndWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbmRl\neGVzKGJvb2xlYW4gaW5kZXhlcykgewogICAgICAgIF9pbmRleGVzID0gaW5k\nZXhlczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBr\nZXlzIG9uIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQu\nCiAgICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRGb3JlaWduS2V5cygpIHsKICAgICAgICByZXR1cm4gX2Zr\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBrZXlz\nIG9uIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAg\nICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRGb3JlaWduS2V5cyhib29sZWFuIGZrcykgewogICAgICAgIF9ma3Mg\nPSBma3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkg\na2V5cyBvbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVk\nLgogICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gZ2V0UHJpbWFyeUtleXMoKSB7CiAgICAgICAgcmV0dXJuIF9w\na3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkga2V5\ncyBvbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgog\nICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0UHJpbWFyeUtleXMoYm9vbGVhbiBwa3MpIHsKICAgICAgICBfcGtz\nID0gcGtzOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmVhbSB0byB3\ncml0ZSB0byBmb3IgdGhlIGNyZWF0aW9uIG9mIFNRTCBzY3JpcHRzLiBJZiB0\naGUKICAgICAqIHN0cmVhbSBpcyBub24tbnVsbCwgYWxsIFNRTCB3aWxsIGJl\nIHdyaXR0ZW4gdG8gdGhpcyBzdHJlYW0gcmF0aGVyIHRoYW4KICAgICAqIGV4\nZWN1dGVkIGFnYWluc3QgdGhlIGRhdGFiYXNlLgogICAgICovCiAgICBwdWJs\naWMgV3JpdGVyIGdldFdyaXRlcigpIHsKICAgICAgICByZXR1cm4gX3dyaXRl\ncjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJlYW0gdG8gd3JpdGUg\ndG8gZm9yIHRoZSBjcmVhdGlvbiBvZiBTUUwgc2NyaXB0cy4gSWYgdGhlCiAg\nICAgKiBzdHJlYW0gaXMgbm9uLW51bGwsIGFsbCBTUUwgd2lsbCBiZSB3cml0\ndGVuIHRvIHRoaXMgc3RyZWFtIHJhdGhlciB0aGFuCiAgICAgKiBleGVjdXRl\nZCBhZ2FpbnN0IHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0V3JpdGVyKFdyaXRlciB3cml0ZXIpIHsKICAgICAgICBpZiAod3Jp\ndGVyID09IG51bGwpCiAgICAgICAgICAgIF93cml0ZXIgPSBudWxsOwogICAg\nICAgIGVsc2UgaWYgKHdyaXRlciBpbnN0YW5jZW9mIFByaW50V3JpdGVyKQog\nICAgICAgICAgICBfd3JpdGVyID0gKFByaW50V3JpdGVyKSB3cml0ZXI7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfd3JpdGVyID0gbmV3IFByaW50V3Jp\ndGVyKHdyaXRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHNjaGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAqLwog\nICAgcHVibGljIFNjaGVtYUdyb3VwIGdldFNjaGVtYUdyb3VwKCkgewogICAg\nICAgIHJldHVybiBfZ3JvdXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIHNjaGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U2NoZW1hR3JvdXAoU2NoZW1hR3JvdXAg\nZ3JvdXApIHsKICAgICAgICBfZ3JvdXAgPSBncm91cDsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLwogICAgLy8gQWN0aW9ucwogICAgLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIFJ1biB0aGUgdG9vbCBhY3Rpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHJ1bigpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKF9hY3Rpb24gPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoQUNUSU9OX0FERC5lcXVhbHMoX2FjdGlv\nbikpCiAgICAgICAgICAgIGFkZCgpOwogICAgICAgIGVsc2UgaWYgKEFDVElP\nTl9EUk9QLmVxdWFscyhfYWN0aW9uKSkKICAgICAgICAgICAgZHJvcCgpOwog\nICAgICAgIGVsc2UgaWYgKEFDVElPTl9SRVRBSU4uZXF1YWxzKF9hY3Rpb24p\nKQogICAgICAgICAgICByZXRhaW4oKTsKICAgICAgICBlbHNlIGlmIChBQ1RJ\nT05fUkVGUkVTSC5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIHJlZnJl\nc2goKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05fQlVJTEQuZXF1YWxzKF9h\nY3Rpb24pKQogICAgICAgICAgICBidWlsZCgpOwogICAgICAgIGVsc2UgaWYg\nKEFDVElPTl9DUkVBVEVEQi5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAg\nIGNyZWF0ZURCKCk7CiAgICAgICAgZWxzZSBpZiAoQUNUSU9OX0RST1BEQi5l\ncXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIGRyb3BEQigpOwogICAgICAg\nIGVsc2UgaWYgKEFDVElPTl9ERUxFVEVfVEFCTEVfQ09OVEVOVFMuZXF1YWxz\nKF9hY3Rpb24pKQogICAgICAgICAgICBkZWxldGVUYWJsZUNvbnRlbnRzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFueSBjb21wb25lbnRzIHBy\nZXNlbnQgaW4gdGhlIHNjaGVtYSByZXBvc2l0b3J5IGJ1dCBhYnNlbnQgZnJv\nbQogICAgICogdGhlIGRhdGFiYXNlLiBQYWNrYWdlLXByaXZhdGUgZm9yIHRl\nc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgYWRkKCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBhZGQoZ2V0REJTY2hlbWFHcm91cChm\nYWxzZSksIGFzc2VydFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogRHJvcHMgYWxsIHNjaGVtYSBjb21wb25lbnRzIGluIHRoZSBzY2hl\nbWEgcmVwb3NpdG9yeSB0aGF0IGFsc28gZXhpc3QKICAgICAqIGluIHRoZSBk\nYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgogICAgICov\nCiAgICB2b2lkIGRyb3AoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGRyb3AoZ2V0REJTY2hlbWFHcm91cChmYWxzZSksIGFzc2Vy\ndFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcHMg\nZGF0YWJhc2UgY29tcG9uZW50cyB0aGF0IGFyZSBub3QgbWVudGlvbmVkIGlu\nIHRoZSBzY2hlbWEKICAgICAqIHJlcG9zaXRvcnkuIFBhY2thZ2UtcHJpdmF0\nZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAgdm9pZCByZXRhaW4oKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldGFpbihnZXRE\nQlNjaGVtYUdyb3VwKHRydWUpLCBhc3NlcnRTY2hlbWFHcm91cCgpLAogICAg\nICAgICAgICBnZXREcm9wVGFibGVzKCksIGdldERyb3BTZXF1ZW5jZXMoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFueSBjb21wb25lbnRzIHBy\nZXNlbnQgaW4gdGhlIHNjaGVtYSByZXBvc2l0b3J5IGJ1dCBhYnNlbnQgZnJv\nbQogICAgICogdGhlIGRhdGFiYXNlLCBhbmQgZHJvcHMgdW51c2VkIGRhdGFi\nYXNlIGNvbXBvbmVudHMuCiAgICAgKiBQYWNrYWdlLXByaXZhdGUgZm9yIHRl\nc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgcmVmcmVzaCgpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2NoZW1hR3JvdXAgbG9jYWwg\nPSBhc3NlcnRTY2hlbWFHcm91cCgpOwogICAgICAgIFNjaGVtYUdyb3VwIGRi\nID0gZ2V0REJTY2hlbWFHcm91cCh0cnVlKTsKICAgICAgICByZXRhaW4oZGIs\nIGxvY2FsLCBnZXREcm9wVGFibGVzKCksIGdldERyb3BTZXF1ZW5jZXMoKSk7\nCiAgICAgICAgYWRkKGRiLCBsb2NhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZS1leGVjdXRlIGFsbCBTUUwgdXNlZCBmb3IgdGhlIGNyZWF0aW9uIG9m\nIHRoZSBjdXJyZW50IGRhdGFiYXNlOwogICAgICogdGhpcyBhY3Rpb24gaXMg\ndXN1YWxseSB1c2VkIHdoZW4gY3JlYXRpbmcgU1FMIHNjcmlwdHMuCiAgICAg\nKiBQYWNrYWdlLXByaXZhdGUgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHZv\naWQgY3JlYXRlREIoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gbmV3IFNjaGVtYUdyb3VwKCk7\nCiAgICAgICAgZ3JvdXAuYWRkU2NoZW1hKCk7CiAgICAgICAgYWRkKGdyb3Vw\nLCBnZXREQlNjaGVtYUdyb3VwKHRydWUpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlLWV4ZWN1dGUgYWxsIFNRTCB1c2VkIGZvciB0aGUgY3JlYXRpb24g\nb2YgdGhlIGN1cnJlbnQgZGF0YWJhc2U7CiAgICAgKiB0aGlzIGFjdGlvbiBp\ncyB1c3VhbGx5IHVzZWQgd2hlbiBjcmVhdGluZyBTUUwgc2NyaXB0cy4KICAg\nICAqIFBhY2thZ2UtcHJpdmF0ZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAg\ndm9pZCBidWlsZCgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgU2NoZW1hR3JvdXAgZ3JvdXAgPSBuZXcgU2NoZW1hR3JvdXAoKTsK\nICAgICAgICBncm91cC5hZGRTY2hlbWEoKTsKICAgICAgICBhZGQoZ3JvdXAs\nIGFzc2VydFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRHJvcCB0aGUgY3VycmVudCBkYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZv\nciB0ZXN0aW5nLgogICAgICovCiAgICB2b2lkIGRyb3BEQigpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0YWluKGdldERCU2No\nZW1hR3JvdXAodHJ1ZSksIG5ldyBTY2hlbWFHcm91cCgpLCB0cnVlLCB0cnVl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIElzc3VlIERFTEVURSBzdGF0ZW1l\nbnQgYWdhaW5zdCBhbGwga25vd24gdGFibGVzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZGVsZXRlVGFibGVDb250ZW50cygpIAogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0g\nZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0g\nZ3JvdXAuZ2V0U2NoZW1hcygpOwogICAgICAgIENvbGxlY3Rpb24gdGFibGVz\nID0gbmV3IExpbmtlZEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgVGFi\nbGVbXSB0cyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgdHMubGVuZ3RoOyBqKyspCiAgICAgICAg\nICAgICAgICB0YWJsZXMuYWRkKHRzW2pdKTsKICAgICAgICB9CiAgICAgICAg\nVGFibGVbXSB0YWJsZUFycmF5ID0gKFRhYmxlW10pIHRhYmxlcy50b0FycmF5\nKG5ldyBUYWJsZVt0YWJsZXMuc2l6ZSgpXSk7CiAgICAgICAgU3RyaW5nW10g\nc3FsID0gX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKQogICAgICAg\nICAgICAuZ2V0RGVsZXRlVGFibGVDb250ZW50c1NRTCh0YWJsZUFycmF5KTsK\nICAgICAgICBpZiAoIWV4ZWN1dGVTUUwoc3FsKSkKICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkZWxldGUtdGFibGUtY29udGVudHMiKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIGNoYW5nZXMgbWFkZSB0\nbyB0aGUgREIgaW4gdGhlIGN1cnJlbnQge0BsaW5rIFNjaGVtYUZhY3Rvcnl9\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWNvcmQoKSB7CiAgICAgICAg\naWYgKF9kYiAhPSBudWxsICYmIF93cml0ZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgX2NvbmYuZ2V0U2NoZW1hRmFjdG9yeUluc3RhbmNlKCkuc3RvcmVTY2hl\nbWEoX2RiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxsIGRhdGFi\nYXNlIGNvbXBvbmVudHMgaW4gdGhlIHJlcG9zaXRvcnkgc2NoZW1hIHRoYXQg\nYXJlIG5vdAogICAgICogcHJlc2VudCBpbiB0aGUgZ2l2ZW4gZGF0YWJhc2Ug\nc2NoZW1hIHRvIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZChTY2hlbWFHcm91cCBkYiwgU2NoZW1hR3JvdXAgcmVwb3MpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWRkIHNl\ncXVlbmNlcwogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSByZXBvcy5nZXRT\nY2hlbWFzKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAgICBpZiAo\nX3NlcXMpIHsKICAgICAgICAgICAgU2VxdWVuY2VbXSBzZXFzOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHNlcXMgPSBzY2hlbWFzW2ldLmdldFNlcXVl\nbmNlcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBz\nZXFzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRi\nLmZpbmRTZXF1ZW5jZShzY2hlbWFzW2ldLCBzZXFzW2pdLmdldEZ1bGxOYW1l\nKCkpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY3JlYXRlU2VxdWVuY2Uoc2Vx\nc1tqXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hID0gZGIu\nZ2V0U2NoZW1hKHNlcXNbal0uZ2V0U2NoZW1hTmFtZSgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgc2NoZW1hID0gZGIuYWRkU2NoZW1hKHNlcXNb\nal0uZ2V0U2NoZW1hTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2NoZW1hLmltcG9ydFNlcXVlbmNlKHNlcXNbal0pOwogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImFkZC1zZXEiLCBzZXFzW2pdKSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG9y\nZGVyIGlzIGltcG9ydGFudCBpbiB0aGlzIG1ldGhvZDsgc3RhcnQgd2l0aCBj\nb2x1bW5zCiAgICAgICAgVGFibGVbXSB0YWJzOwogICAgICAgIFRhYmxlIGRi\nVGFibGU7CiAgICAgICAgQ29sdW1uW10gY29sczsKICAgICAgICBDb2x1bW4g\nY29sOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRU\nYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJz\nLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBjb2xzID0gdGFic1tq\nXS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBkYlRhYmxlID0gZGIu\nZmluZFRhYmxlKHNjaGVtYXNbaV0sIHRhYnNbal0uZ2V0RnVsbE5hbWUoKSk7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGNvbHMubGVu\nZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IGRiVGFi\nbGUuZ2V0Q29sdW1uKGNvbHNba10uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGNvbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoYWRkQ29sdW1uKGNvbHNba10pKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUuaW1wb3J0Q29sdW1u\nKGNvbHNba10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgiYWRkLWNvbCIsIGNvbHNba10sCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIGlmICghY29sc1trXS5lcXVhbHNDb2x1bW4oY29sKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJiYWQtY29sIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbCwgZGJUYWJsZSwgY29sLmdldERlc2NyaXB0\naW9uKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sc1tr\nXS5nZXREZXNjcmlwdGlvbigpIH0pKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcHJpbWFyeSBr\nZXlzCiAgICAgICAgaWYgKF9wa3MpIHsKICAgICAgICAgICAgUHJpbWFyeUtl\neSBwazsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWJzID0gc2NoZW1h\nc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAg\nICAgIHBrID0gdGFic1tqXS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgICAg\nICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJsZShzY2hlbWFzW2ldLCB0\nYWJzW2pdLmdldEZ1bGxOYW1lKCkpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwayAhPSBudWxsICYmICFway5pc0xvZ2ljYWwoKSAmJiBkYlRhYmxlICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRiVGFibGUu\nZ2V0UHJpbWFyeUtleSgpID09IG51bGwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICYmIGFkZFByaW1hcnlLZXkocGspKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRQcmltYXJ5S2V5KHBrKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZGJUYWJsZS5nZXRQcmlt\nYXJ5S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9sb2cud2FybihfbG9jLmdldCgiYWRkLXBrIiwgcGssIHRhYnNbal0pKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXBrLmVxdWFsc1By\naW1hcnlLZXkoZGJUYWJsZS5nZXRQcmltYXJ5S2V5KCkpKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJiYWQtcGsi\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUuZ2V0\nUHJpbWFyeUtleSgpLCBkYlRhYmxlKSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyB0YWJsZXMKICAgICAgICBTZXQgbmV3VGFibGVzID0gbmV3\nIEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVt\nYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNb\naV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBq\nIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKGRi\nLmZpbmRUYWJsZShzY2hlbWFzW2ldLCB0YWJzW2pdLmdldEZ1bGxOYW1lKCkp\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICAgICAgaWYgKGNyZWF0ZVRhYmxlKHRhYnNbal0pKSB7CiAgICAg\nICAgICAgICAgICAgICAgbmV3VGFibGVzLmFkZCh0YWJzW2pdKTsKICAgICAg\nICAgICAgICAgICAgICBzY2hlbWEgPSBkYi5nZXRTY2hlbWEodGFic1tqXS5n\nZXRTY2hlbWFOYW1lKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChzY2hl\nbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hID0g\nZGIuYWRkU2NoZW1hKHRhYnNbal0uZ2V0U2NoZW1hTmFtZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBzY2hlbWEuaW1wb3J0VGFibGUodGFic1tqXSk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBfbG9n\nLndhcm4oX2xvYy5nZXQoImFkZC10YWJsZSIsIHRhYnNbal0pKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaW5kZXhlcwogICAgICAg\nIEluZGV4W10gaWR4czsKICAgICAgICBJbmRleCBpZHg7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAg\nICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsK\nICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBpbmRleGVzIG9uIG5ldyB0YWJs\nZXMgZXZlbiBpZiBpbmRleGVzCiAgICAgICAgICAgICAgICAvLyBoYXZlIGJl\nZW4gdHVybmVkIG9mZgogICAgICAgICAgICAgICAgaWYgKCFfaW5kZXhlcyAm\nJiAhbmV3VGFibGVzLmNvbnRhaW5zKHRhYnNbal0pKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlkeHMgPSB0YWJz\nW2pdLmdldEluZGV4ZXMoKTsKICAgICAgICAgICAgICAgIGRiVGFibGUgPSBk\nYi5maW5kVGFibGUoc2NoZW1hc1tpXSwgdGFic1tqXS5nZXRGdWxsTmFtZSgp\nKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgaWR4cy5s\nZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxl\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gZmlu\nZEluZGV4KGRiVGFibGUsIGlkeHNba10pOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoaWR4ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChjcmVhdGVJbmRleChpZHhzW2tdLCBkYlRhYmxlKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYlRhYmxlLmltcG9ydElu\nZGV4KGlkeHNba10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiYWRkLWluZGV4IiwgaWR4c1trXSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdGFic1tqXSkpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKCFpZHhzW2tdLmVxdWFsc0luZGV4KGlk\neCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xv\nYy5nZXQoImJhZC1pbmRleCIsIGlkeCwgZGJUYWJsZSkpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gVW5pcXVlIENvbnN0cmFpbnRzIG9uIGdy\nb3VwIG9mIGNvbHVtbnMKICAgICAgICBVbmlxdWVbXSB1bmlxdWVzOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsg\naisrKSB7CiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdW5pcXVlIGNvbnN0\ncmFpbnRzIG9ubHkgb24gbmV3IHRhYmxlcyAKICAgICAgICAgICAgICAgIGlm\nICghbmV3VGFibGVzLmNvbnRhaW5zKHRhYnNbal0pKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHVuaXF1ZXMgPSB0\nYWJzW2pdLmdldFVuaXF1ZXMoKTsKICAgICAgICAgICAgICAgIGlmICh1bmlx\ndWVzID09IG51bGwgfHwgdW5pcXVlcy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGRiVGFibGUg\nPSBkYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICBpZiAo\nZGJUYWJsZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCB1bmlxdWVz\nLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5p\nbXBvcnRVbmlxdWUodW5pcXVlc1trXSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gZm9y\nZWlnbiBrZXlzCiAgICAgICAgRm9yZWlnbktleVtdIGZrczsKICAgICAgICBG\nb3JlaWduS2V5IGZrOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2No\nZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJzID0gc2NoZW1h\nc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAvLyBj\ncmVhdGUgZm9yZWlnbiBrZXlzIG9uIG5ldyB0YWJsZXMgZXZlbiBpZiBma3MK\nICAgICAgICAgICAgICAgIC8vIGhhdmUgYmVlbiB0dXJuZWQgb2ZmCiAgICAg\nICAgICAgICAgICBpZiAoIV9ma3MgJiYgIW5ld1RhYmxlcy5jb250YWlucyh0\nYWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICBma3MgPSB0YWJzW2pdLmdldEZvcmVpZ25LZXlzKCk7CiAg\nICAgICAgICAgICAgICBkYlRhYmxlID0gZGIuZmluZFRhYmxlKHNjaGVtYXNb\naV0sdGFic1tqXS5nZXRGdWxsTmFtZSgpKTsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGsgPSAwOyBrIDwgZmtzLmxlbmd0aDsgaysrKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFma3Nba10uaXNMb2dpY2FsKCkgJiYgZGJUYWJs\nZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZrID0gZmlu\nZEZvcmVpZ25LZXkoZGJUYWJsZSwgZmtzW2tdKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGZrID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChhZGRGb3JlaWduS2V5KGZrc1trXSkpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRGb3JlaWdu\nS2V5KGZrc1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJhZGQtZmsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBma3Nba10sIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIGlmICghZmtzW2tdLmVxdWFsc0ZvcmVpZ25LZXkoZmsp\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJiYWQtZmsiLCBmaywgZGJUYWJsZSkpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIERyb3BzIGFsbCBkYXRhYmFzZSBj\nb21wb25lbnRzIHRoYXQgYXJlIGluIHRoZSBnaXZlbiBkYXRhYmFzZSBzY2hl\nbWEKICAgICAqIGJ1dCBub3QgaW4gdGhlIHJlcG9zaXRvcnkgc2NoZW1hLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmV0YWluKFNjaGVtYUdyb3VwIGRi\nLCBTY2hlbWFHcm91cCByZXBvcywgYm9vbGVhbiB0YWJsZXMsCiAgICAgICAg\nYm9vbGVhbiBzZXF1ZW5jZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgU2NoZW1hW10gc2NoZW1hcyA9IGRiLmdldFNjaGVtYXMo\nKTsKICAgICAgICBpZiAoX3NlcXMgJiYgc2VxdWVuY2VzKSB7CiAgICAgICAg\nICAgIFNlcXVlbmNlW10gc2VxczsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBzZXFzID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZXMoKTsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgc2Vxcy5sZW5ndGg7IGorKykg\newogICAgICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUoc2Vxc1tq\nXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgICAgIGlmIChyZXBvcy5maW5kU2VxdWVuY2Uoc2Vxc1tqXSkg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJvcFNl\ncXVlbmNlKHNlcXNbal0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc2NoZW1hc1tpXS5yZW1vdmVTZXF1ZW5jZShzZXFzW2pdKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLXNlcSIsIHNlcXNbal0pKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG9yZGVyIGlzIGltcG9y\ndGFudCBpbiB0aGlzIG1ldGhvZDsgc3RhcnQgd2l0aCBmb3JlaWduIGtleXMK\nICAgICAgICBUYWJsZVtdIHRhYnM7CiAgICAgICAgVGFibGUgcmVwb3NUYWJs\nZTsKICAgICAgICBpZiAoX2ZrcykgewogICAgICAgICAgICBGb3JlaWduS2V5\nW10gZmtzOwogICAgICAgICAgICBGb3JlaWduS2V5IGZrOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygp\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxl\nbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3Bw\nYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgICAgICAgICAgZmtzID0gdGFic1tqXS5nZXRGb3Jl\naWduS2V5cygpOwogICAgICAgICAgICAgICAgICAgIHJlcG9zVGFibGUgPSBy\nZXBvcy5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKCF0YWJsZXMgJiYgcmVwb3NUYWJsZSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAg\nZm9yIChpbnQgayA9IDA7IGsgPCBma3MubGVuZ3RoOyBrKyspIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGZrc1trXS5pc0xvZ2ljYWwoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgICAgICAgICAgZmsgPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAocmVwb3NUYWJsZSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZmsgPSBmaW5kRm9yZWlnbktleShyZXBvc1RhYmxlLCBm\na3Nba10pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVwb3NUYWJs\nZSA9PSBudWxsIHx8IGZrID09IG51bGwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHx8ICFma3Nba10uZXF1YWxzRm9yZWlnbktleShmaykpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9wRm9yZWlnbktleShm\na3Nba10pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNb\nal0ucmVtb3ZlRm9yZWlnbktleShma3Nba10pOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1mayIsIGZrc1trXSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFic1tqXSkpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBwcmltYXJ5IGtleXMKICAgICAgICBpZiAoX3Brcykgewog\nICAgICAgICAgICBQcmltYXJ5S2V5IHBrOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisr\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3BwYWJsZSh0YWJz\nW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgICAgICAgICAgcGsgPSB0YWJzW2pdLmdldFByaW1hcnlLZXkoKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocGsgIT0gbnVsbCAmJiBway5pc0xv\nZ2ljYWwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICAgICAgICAgIHJlcG9zVGFibGUgPSByZXBvcy5maW5kVGFi\nbGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrICE9IG51\nbGwgJiYgcmVwb3NUYWJsZSAhPSBudWxsCiAgICAgICAgICAgICAgICAgICAg\nICAgICYmIChyZXBvc1RhYmxlLmdldFByaW1hcnlLZXkoKSA9PSBudWxsCiAg\nICAgICAgICAgICAgICAgICAgICAgIHx8ICFway5lcXVhbHNQcmltYXJ5S2V5\nKHJlcG9zVGFibGUuZ2V0UHJpbWFyeUtleSgpKSkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGRyb3BQcmltYXJ5S2V5KHBrKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHRhYnNbal0ucmVtb3ZlUHJpbWFyeUtleSgp\nOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImRyb3AtcGsiLCBw\naywgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nY29sdW1ucwogICAgICAgIENvbHVtbltdIGNvbHM7CiAgICAgICAgQ29sdW1u\nIGNvbDsKICAgICAgICBDb2xsZWN0aW9uIGRyb3BzID0gbmV3IExpbmtlZExp\nc3QoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0\nVGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFi\ncy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3Bw\nYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgICAgIGNvbHMgPSB0YWJzW2pdLmdldENvbHVtbnMoKTsK\nICAgICAgICAgICAgICAgIHJlcG9zVGFibGUgPSByZXBvcy5maW5kVGFibGUo\ndGFic1tqXSk7CiAgICAgICAgICAgICAgICBpZiAocmVwb3NUYWJsZSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsg\nPCBjb2xzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbCA9IHJlcG9zVGFibGUuZ2V0Q29sdW1uKGNvbHNba10uZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCA9PSBudWxsIHx8\nICFjb2xzW2tdLmVxdWFsc0NvbHVtbihjb2wpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAodGFic1tqXS5nZXRDb2x1bW5zKCkubGVuZ3Ro\nID09IDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHMu\nYWRkKHRhYnNbal0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxz\nZSBpZiAoZHJvcENvbHVtbihjb2xzW2tdKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0YWJzW2pdLnJlbW92ZUNvbHVtbihjb2xzW2tdKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImRyb3At\nY29sIiwgY29sc1trXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBub3cgdGFibGVzCiAgICAg\nICAgaWYgKHRhYmxlcykgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRh\nYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKQogICAgICAg\nICAgICAgICAgICAgIGlmICghIWlzRHJvcHBhYmxlKHRhYnNbal0pCiAgICAg\nICAgICAgICAgICAgICAgICAgICYmIHJlcG9zLmZpbmRUYWJsZSh0YWJzW2pd\nKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBkcm9wcy5hZGQo\ndGFic1tqXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZHJv\ncFRhYmxlcyhkcm9wcywgZGIpOwogICAgfQoKICAgIC8qKgogICAgICogRHJv\ncHMgYWxsIGRhdGFiYXNlIGNvbXBvbmVudHMgaW4gdGhlIGdpdmVuIHJlcG9z\naXRvcnkgc2NoZW1hLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZHJvcChT\nY2hlbWFHcm91cCBkYiwgU2NoZW1hR3JvdXAgcmVwb3MpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZHJvcCBzZXF1ZW5jZXMK\nICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0gcmVwb3MuZ2V0U2NoZW1hcygp\nOwogICAgICAgIGlmIChfc2VxcykgewogICAgICAgICAgICBTZXF1ZW5jZVtd\nIHNlcXM7CiAgICAgICAgICAgIFNlcXVlbmNlIGRiU2VxOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIHNlcXMgPSBzY2hlbWFzW2ldLmdldFNlcXVlbmNl\ncygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBzZXFz\nLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ry\nb3BwYWJsZShzZXFzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICAgICAgZGJTZXEgPSBkYi5maW5kU2Vx\ndWVuY2Uoc2Vxc1tqXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRiU2Vx\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3BT\nZXF1ZW5jZShzZXFzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGRiU2VxLmdldFNjaGVtYSgpLnJlbW92ZVNlcXVlbmNlKGRiU2VxKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLXNlcSIsIHNlcXNb\nal0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNhbGN1bGF0\nZSB0YWJsZXMgdG8gZHJvcDsgd2UgY2FuIG9ubHkgZHJvcCB0YWJsZXMgaWYg\nd2UncmUgc3VyZQogICAgICAgIC8vIHRoZSB1c2VyIGxpc3RlZCB0aGUgZW50\naXJlIHRhYmxlIGRlZmluaXRpb24gaW4gdGhlIHN0dWZmIHRoZXkgd2FudAog\nICAgICAgIC8vIGRyb3BwZWQ7IGVsc2UgdGhleSBtaWdodCBqdXN0IHdhbnQg\ndG8gZHJvcCBhIGZldyBjb2x1bW5zCiAgICAgICAgQ29sbGVjdGlvbiBkcm9w\ncyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgVGFibGVbXSB0YWJzOwog\nICAgICAgIFRhYmxlIGRiVGFibGU7CiAgICAgICAgQ29sdW1uW10gZGJDb2xz\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJs\nZXMoKTsKICAgICAgICAgICAgdGFibGVzOgogICAgICAgICAgICBmb3IgKGlu\ndCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAg\nICAgIGlmICghaXNEcm9wcGFibGUodGFic1tqXSkpCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBkYlRhYmxlID0gZGIu\nZmluZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAgaWYgKGRiVGFi\nbGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICBkYkNvbHMgPSBkYlRhYmxlLmdldENvbHVtbnMoKTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgZGJDb2xzLmxl\nbmd0aDsgaysrKQogICAgICAgICAgICAgICAgICAgIGlmICh0YWJzW2pdLmdl\ndENvbHVtbihkYkNvbHNba10uZ2V0TmFtZSgpKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZSB0YWJsZXM7CgogICAgICAgICAg\nICAgICAgZHJvcHMuYWRkKHRhYnNbal0pOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBvcmRlciBpcyBpbXBvcnRhbnQgaW4gdGhpcyBt\nZXRob2Q7IHN0YXJ0IHdpdGggZm9yZWlnbiBrZXlzIG1lbnRpb25lZAogICAg\nICAgIC8vIGluIHRoZSBkcm9wIHNjaGVtYQogICAgICAgIGlmIChfZmtzKSB7\nCiAgICAgICAgICAgIEZvcmVpZ25LZXlbXSBma3M7CiAgICAgICAgICAgIEZv\ncmVpZ25LZXkgZms7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGFicyA9\nIHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoIWlzRHJvcHBhYmxlKHRhYnNbal0pKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAg\nICBma3MgPSB0YWJzW2pdLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAg\nICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsKICAg\nICAgICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGZrcy5sZW5n\ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmtzW2td\nLmlzTG9naWNhbCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICBmayA9IG51bGw7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmayA9IGZpbmRGb3JlaWduS2V5\nKGRiVGFibGUsIGZrc1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChkYlRhYmxlID09IG51bGwgfHwgZmsgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGRyb3BGb3JlaWduS2V5KGZrc1trXSkpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUucmVtb3ZlRm9yZWln\nbktleShmayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJkcm9wLWZrIiwgZmtzW2tdLCB0YWJzW2pdKSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBhbHNvIGRyb3AgaW1wb3J0ZWQgZm9yZWlnbiBrZXlz\nIGZvciB0YWJsZXMgdGhhdCB3aWxsIGJlIGRyb3BwZWQKICAgICAgICAgICAg\nVGFibGUgdGFiOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGRy\nb3BzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICB0YWIgPSAoVGFibGUpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICBkYlRhYmxlID0gZGIuZmluZFRhYmxlKHRhYik7CiAgICAgICAgICAgICAg\nICBpZiAoZGJUYWJsZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgICAgIGZrcyA9IGRiLmZpbmRFeHBvcnRl\nZEZvcmVpZ25LZXlzKGRiVGFibGUuZ2V0UHJpbWFyeUtleSgpKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3BGb3JlaWduS2V5KGZr\nc1tpXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUucmVtb3Zl\nRm9yZWlnbktleShma3NbaV0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJk\ncm9wLWZrIiwgZmtzW2ldLCBkYlRhYmxlKSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGRyb3AgdGhl\nIHRhYmxlcyB3ZSBjYWxjdWxhdGVkIGFib3ZlCiAgICAgICAgZHJvcFRhYmxl\ncyhkcm9wcywgZGIpOwoKICAgICAgICAvLyBjb2x1bW5zCiAgICAgICAgQ29s\ndW1uW10gY29sczsKICAgICAgICBDb2x1bW4gY29sOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoIWlzRHJvcHBhYmxlKHRhYnNbal0pKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29s\ncyA9IHRhYnNbal0uZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAgZGJU\nYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGsgPSAwOyBrIDwgY29scy5sZW5ndGg7IGsrKykgewogICAg\nICAgICAgICAgICAgICAgIGNvbCA9IG51bGw7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGRiVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgY29sID0gZGJUYWJsZS5nZXRDb2x1bW4oY29sc1trXS5nZXROYW1lKCkp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlID09IG51bGwgfHwg\nY29sID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZHJvcENvbHVtbihjb2xzW2td\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5yZW1v\ndmVDb2x1bW4oY29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJkcm9wLWNvbCIsIGNvbHNba10sIHRhYnNbal0pKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0\naGUgdGFibGUgaXMgZHJvcHBhYmxlLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gaXNEcm9wcGFibGUoVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1\ncm4gX29wZW5qcGFUYWJsZXMKICAgICAgICAgICAgfHwgKCF0YWJsZS5nZXRO\nYW1lKCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJPUEVOSlBBXyIpCiAg\nICAgICAgICAgICYmICF0YWJsZS5nZXROYW1lKCkudG9VcHBlckNhc2UoKS5z\ndGFydHNXaXRoKCJKRE9fIikpOyAvLyBsZWdhY3kKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBzZXF1ZW5jZSBpcyBkcm9wcGFi\nbGUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0Ryb3BwYWJsZShT\nZXF1ZW5jZSBzZXEpIHsKICAgICAgICByZXR1cm4gX29wZW5qcGFUYWJsZXMK\nICAgICAgICAgICAgfHwgKCFzZXEuZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCku\nc3RhcnRzV2l0aCgiT1BFTkpQQV8iKQogICAgICAgICAgICAmJiAhc2VxLmdl\ndE5hbWUoKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIkpET18iKSk7IC8v\nIGxlZ2FjeQogICAgfQoKICAgIC8qKgogICAgICogRmluZCBhbiBpbmRleCBp\nbiB0aGUgZ2l2ZW4gdGFibGUgdGhhdCBtYXRjaGVzIHRoZSBnaXZlbiBvbmUu\nCiAgICAgKi8KICAgIHByaXZhdGUgSW5kZXggZmluZEluZGV4KFRhYmxlIGRi\nVGFibGUsIEluZGV4IGlkeCkgewogICAgICAgIEluZGV4W10gaWR4cyA9IGRi\nVGFibGUuZ2V0SW5kZXhlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgaWR4cy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGlkeC5jb2x1\nbW5zTWF0Y2goaWR4c1tpXS5nZXRDb2x1bW5zKCkpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGlkeHNbaV07CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGaW5kIGEgZm9yZWlnbiBrZXkgaW4gdGhlIGdp\ndmVuIHRhYmxlIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gb25lLgogICAgICov\nCiAgICBwcml2YXRlIEZvcmVpZ25LZXkgZmluZEZvcmVpZ25LZXkoVGFibGUg\nZGJUYWJsZSwgRm9yZWlnbktleSBmaykgewogICAgICAgIGlmIChmay5nZXRD\nb25zdGFudENvbHVtbnMoKS5sZW5ndGggPiAwCiAgICAgICAgICAgIHx8IGZr\nLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKS5sZW5ndGggPiAwKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBGb3JlaWduS2V5W10g\nZmtzID0gZGJUYWJsZS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoZmsuY29sdW1uc01hdGNoKGZrc1tpXS5nZXRDb2x1bW5zKCksCiAgICAg\nICAgICAgICAgICBma3NbaV0uZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gZmtzW2ldOwogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBj\nb2xsZWN0aW9uIG9mIHRhYmxlcyBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEu\nIE9yZGVycwogICAgICogdGhlIHJlbW92YWxzIGFjY29yZGluZyB0byBmb3Jl\naWduIGtleSBjb25zdHJhaW50cyBvbiB0aGUgdGFibGVzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgZHJvcFRhYmxlcyhDb2xsZWN0aW9uIHRhYmxlcywg\nU2NoZW1hR3JvdXAgY2hhbmdlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICh0YWJsZXMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIFRhYmxlIHRhYmxlOwogICAgICAgIFRhYmxl\nIGNoYW5nZVRhYmxlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdGFi\nbGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nIHRhYmxlID0gKFRhYmxlKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\nZHJvcFRhYmxlKHRhYmxlKSkgewogICAgICAgICAgICAgICAgY2hhbmdlVGFi\nbGUgPSBjaGFuZ2UuZmluZFRhYmxlKHRhYmxlKTsKICAgICAgICAgICAgICAg\nIGlmIChjaGFuZ2VUYWJsZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGNoYW5nZVRhYmxlLmdldFNjaGVtYSgpLnJlbW92ZVRhYmxlKGNoYW5nZVRh\nYmxlKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfbG9n\nLndhcm4oX2xvYy5nZXQoImRyb3AtdGFibGUiLCB0YWJsZSkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gdGFibGUg\ndG8gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ug\nb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNyZWF0ZVRh\nYmxlKFRhYmxlIHRhYmxlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldENyZWF0ZVRh\nYmxlU1FMKHRhYmxlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wIHRo\nZSBnaXZlbiB0YWJsZSBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAg\nKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1\nY2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBkcm9wVGFibGUoVGFibGUgdGFibGUpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2Rp\nY3QuZ2V0RHJvcFRhYmxlU1FMKHRhYmxlKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGdpdmVuIHNlcXVlbmNlIHRvIHRoZSBkYXRhYmFzZSBz\nY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVy\nYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVTZXF1ZW5jZShTZXF1ZW5jZSBz\nZXEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGV4ZWN1dGVTUUwoX2RpY3QuZ2V0Q3JlYXRlU2VxdWVuY2VTUUwoc2Vx\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wIHRoZSBnaXZlbiBzZXF1\nZW5jZSBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICog\nQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWws\nIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBk\ncm9wU2VxdWVuY2UoU2VxdWVuY2Ugc2VxKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0Lmdl\ndERyb3BTZXF1ZW5jZVNRTChzZXEpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCB0aGUgZ2l2ZW4gaW5kZXggdG8gdGhlIGRhdGFiYXNlIHNjaGVtYS4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3\nYXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGNyZWF0ZUluZGV4KEluZGV4IGlkeCwgVGFibGUgdGFi\nbGUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaW50\nIG1heCA9IF9kaWN0Lm1heEluZGV4ZXNQZXJUYWJsZTsKCiAgICAgICAgaW50\nIGxlbiA9IHRhYmxlLmdldEluZGV4ZXMoKS5sZW5ndGg7CiAgICAgICAgaWYg\nKHRhYmxlLmdldFByaW1hcnlLZXkoKSAhPSBudWxsKQogICAgICAgICAgICBs\nZW4gKz0gdGFibGUuZ2V0UHJpbWFyeUtleSgpLmdldENvbHVtbnMoKS5sZW5n\ndGg7CgogICAgICAgIGlmIChsZW4gPj0gbWF4KSB7CiAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgidG9vLW1hbnktaW5kZXhlcyIsIGlkeCwgdGFi\nbGUsIG1heCArICIiKSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CgogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldENy\nZWF0ZUluZGV4U1FMKGlkeCkpOwogICAgfQoKICAgIC8qKgogICAgICogRHJv\ncCB0aGUgZ2l2ZW4gaW5kZXggZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgog\nICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdh\ncyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gZHJvcEluZGV4KEluZGV4IGlkeCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChf\nZGljdC5nZXREcm9wSW5kZXhTUUwoaWR4KSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGdpdmVuIGNvbHVtbiB0byB0aGUgZGF0YWJhc2Ugc2No\nZW1hLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0\naW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gYWRkQ29sdW1uKENvbHVtbiBjb2wpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1\ndGVTUUwoX2RpY3QuZ2V0QWRkQ29sdW1uU1FMKGNvbCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4gY29sdW1uIGZyb20gdGhlIGRh\ndGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYg\ndGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNl\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGRyb3BDb2x1bW4oQ29sdW1u\nIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXREcm9wQ29sdW1uU1FMKGNvbCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBwcmltYXJ5\nIGtleSB0byB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBm\nYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gYWRk\nUHJpbWFyeUtleShQcmltYXJ5S2V5IHBrKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0Lmdl\ndEFkZFByaW1hcnlLZXlTUUwocGspKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERyb3AgdGhlIGdpdmVuIHByaW1hcnkga2V5IGZyb20gdGhlIGRhdGFiYXNl\nIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9w\nZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGRyb3BQcmltYXJ5S2V5KFByaW1hcnlL\nZXkgcGspCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIGV4ZWN1dGVTUUwoX2RpY3QuZ2V0RHJvcFByaW1hcnlLZXlTUUwo\ncGspKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gZm9y\nZWlnbiBrZXkgdG8gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1\nbCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGFkZEZvcmVpZ25LZXkoRm9yZWlnbktleSBmaykKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGlj\ndC5nZXRBZGRGb3JlaWduS2V5U1FMKGZrKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEcm9wIHRoZSBnaXZlbiBmb3JlaWduIGtleSBmcm9tIHRoZSBkYXRh\nYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRo\nZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBkcm9wRm9yZWlnbktleShGb3Jl\naWduS2V5IGZrKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldERyb3BGb3JlaWduS2V5\nU1FMKGZrKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRh\ndGFiYXNlIHNjaGVtYS4KICAgICAqLwogICAgcHVibGljIFNjaGVtYUdyb3Vw\nIGdldERCU2NoZW1hR3JvdXAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgcmV0dXJuIGdldERCU2NoZW1hR3JvdXAodHJ1ZSk7CiAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNR\nTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGRhdGFiYXNlIHNjaGVtYS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0REJTY2hlbWFHcm91cChTY2hl\nbWFHcm91cCBkYikgewogICAgICAgIF9kYiA9IGRiOwogICAgICAgIGlmIChk\nYiAhPSBudWxsKQogICAgICAgICAgICBfZnVsbERCID0gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGF0YWJhc2Ugc2NoZW1hLgog\nICAgICoKICAgICAqIEBwYXJhbSBmdWxsIGlmIGZhbHNlLCBvbmx5IHRoZSB0\nYWJsZXMgbmFtZWQgaW4gdGhlIHNldCBzY2hlbWEKICAgICAqIHJlcG9zaXRv\ncnkgd2lsbCBiZSBnZW5lcmF0ZWQKICAgICAqLwogICAgcHJpdmF0ZSBTY2hl\nbWFHcm91cCBnZXREQlNjaGVtYUdyb3VwKGJvb2xlYW4gZnVsbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2RiID09IG51\nbGwgfHwgKGZ1bGwgJiYgIV9mdWxsREIpKSB7CiAgICAgICAgICAgIFNjaGVt\nYUdlbmVyYXRvciBnZW4gPSBuZXcgU2NoZW1hR2VuZXJhdG9yKF9jb25mKTsK\nICAgICAgICAgICAgZ2VuLnNldFByaW1hcnlLZXlzKF9wa3MpOwogICAgICAg\nICAgICBnZW4uc2V0Rm9yZWlnbktleXMoX2Zrcyk7CiAgICAgICAgICAgIGdl\nbi5zZXRJbmRleGVzKF9pbmRleGVzKTsKICAgICAgICAgICAgaWYgKGZ1bGwp\nCiAgICAgICAgICAgICAgICBnZW4uZ2VuZXJhdGVTY2hlbWFzKCk7CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gZ2VuZXJhdGUgb25s\neSB0aGUgdGFibGVzIGluIHRoZSBnaXZlbiByZXBvc2l0b3J5CiAgICAgICAg\nICAgICAgICAvLyBncm91cDsgc29tZSBtYXkgbm90IGV4aXN0IHlldCwgd2hp\nY2ggaXMgT0s7IHdlIGp1c3QgbmVlZAogICAgICAgICAgICAgICAgLy8gdG8g\nbWFrZSBzdXJlIHdlIGNhbiBkZXRlY3QgdGhlIGNoYW5nZXMgdG8gdGhlIG9u\nZXMgdGhhdAogICAgICAgICAgICAgICAgLy8gZG8gZXhpc3QKICAgICAgICAg\nICAgICAgIENvbGxlY3Rpb24gdGFibGVzID0gbmV3IExpbmtlZExpc3QoKTsK\nICAgICAgICAgICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gYXNzZXJ0U2No\nZW1hR3JvdXAoKTsKICAgICAgICAgICAgICAgIFNjaGVtYVtdIHNjaGVtYXMg\nPSBncm91cC5nZXRTY2hlbWFzKCk7CiAgICAgICAgICAgICAgICBUYWJsZVtd\nIHRhYnM7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNj\naGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0YWJz\nID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgICAg\nICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYnNbal0uZ2V0U2NoZW1hTmFt\nZSgpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJs\nZXMuYWRkKCIuIiArIHRhYnNbal0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndGFibGVzLmFkZCh0YWJzW2pdLmdldEZ1bGxOYW1lKCkpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGlmICghdGFibGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBn\nZW4uZ2VuZXJhdGVTY2hlbWFzKChTdHJpbmdbXSkgdGFibGVzLnRvQXJyYXkK\nICAgICAgICAgICAgICAgICAgICAgICAgKG5ldyBTdHJpbmdbdGFibGVzLnNp\nemUoKV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfZGIgPSBnZW4u\nZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9k\nYjsKICAgIH0KCiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIGFzc2VydFNjaGVt\nYUdyb3VwKCkgewogICAgICAgIFNjaGVtYUdyb3VwIGxvY2FsID0gZ2V0U2No\nZW1hR3JvdXAoKTsKICAgICAgICBpZiAobG9jYWwgPT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndCgidG9vbC1ub3JlcG9zIikpOwogICAgICAgIHJldHVybiBsb2NhbDsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRpZXMKICAgIC8v\nLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIHRoZSBnaXZl\nbiBhcnJheSBvZiBub24tc2VsZWN0aW5nIFNRTCBzdGF0ZW1lbnRzLCBjb3Jy\nZWN0bHkKICAgICAqIGxvZ2dpbmcgdGhlIFNRTCBjYWxscyBhbmQgb3B0aW9u\nYWxseSBpZ25vcmluZyBlcnJvcnMuCiAgICAgKgogICAgICogQHJldHVybiB0\ncnVlIGlmIHRoZXJlIHdhcyBTUUwgdG8gZXhlY3V0ZSBhbmQgdGhlIGNhbGxz\nIHdlcmUKICAgICAqIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gZXhlY3V0ZVNRTChTdHJpbmdbXSBz\ncWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\naWYgbm8gc3FsLCBwcm9iYWJseSBiL2MgZGljdGlvbmFyeSBkb2Vzbid0IHN1\ncHBvcnQgb3BlcmF0aW9uCiAgICAgICAgaWYgKHNxbC5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBib29sZWFuIGVy\nciA9IGZhbHNlOwogICAgICAgIGlmIChfd3JpdGVyID09IG51bGwpIHsKICAg\nICAgICAgICAgLy8gdGhpcyBpcyBvdXRzaWRlIHRoZSB0cnktY2F0Y2ggYmVj\nYXVzZSBhIGZhaWx1cmUgaGVyZSBpcwogICAgICAgICAgICAvLyByZWFsbHkg\nYmFkLCBhbmQgc2hvdWxkIG5vdCBiZSBpZ25vcmVkLgogICAgICAgICAgICBD\nb25uZWN0aW9uIGNvbm4gPSBfZHMuZ2V0Q29ubmVjdGlvbigpOwogICAgICAg\nICAgICBTdGF0ZW1lbnQgc3RhdGVtZW50ID0gbnVsbDsKICAgICAgICAgICAg\nYm9vbGVhbiB3YXNBdXRvID0gdHJ1ZTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIHdhc0F1dG8gPSBjb25uLmdldEF1dG9Db21taXQoKTsK\nICAgICAgICAgICAgICAgIGlmICghd2FzQXV0bykKICAgICAgICAgICAgICAg\nICAgICBjb25uLnNldEF1dG9Db21taXQodHJ1ZSk7CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNxbC5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIHNvbWUgY29ubmVjdGlvbnMgcmVxdWlyZSB0aGF0IHJvbGxiYWNrIGJl\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGxlZCBvbiB0aGUgY29u\nbmVjdGlvbiBiZWZvcmUgYW55IERETCBzdGF0ZW1lbnRzCiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIGNhbiBiZSBydW4gb24gaXQsIGV2ZW4gd2hlbiBh\ndXRvY29tbWl0IGlzIG9uLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBU\naGlzIGlzIHNvbWV0aW1lcyBiZWNhdXNlIHRoZSBjb25uZWN0aW9uIGRvZXMg\nbm90CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsbG93IERETCBzdGF0\nZW1lbnRzIHdoZW4gdGhlcmUgYXJlIG11bHRpcGxlCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGNvbW1hbmRzIGlzc3VlZCBvbiB0aGUgY29ubmVjdGlv\nbiwgYW5kIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25uZWN0\naW9uIHBvb2wgbWF5IGhhdmUgaXNzdWVkIHNvbWUgdmFsaWRhdGlvbiBTUUwu\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjb25uLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRl\nbWVudCA9IGNvbm4uY3JlYXRlU3RhdGVtZW50KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHN0YXRlbWVudC5leGVjdXRlVXBkYXRlKHNxbFtpXSk7Cgog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBzb21lIGNvbm5lY3Rpb25zIHNl\nZW0gdG8gcmVxdWlyZSBhbiBleHBsaWNpdAogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBjb21taXQgZm9yIERETCBzdGF0ZW1lbnRzLCBldmVuIHdoZW4g\nYXV0b2NvbW1pdAogICAgICAgICAgICAgICAgICAgICAgICAvLyBpcyBvbi4g\nVGhlIERhdGFEaXJlY3QgZHJpdmVycyBzZWVtIHRvIHN1ZmZlciBmcm9tCiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgbGltaXRhdGlvbi4KICAg\nICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbm4uY29tbWl0KCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBlcnIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAg\nICBoYW5kbGVFeGNlcHRpb24oc2UpOwogICAgICAgICAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZW1l\nbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVtZW50LmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nICAgICBpZiAoIXdhc0F1dG8pCiAgICAgICAgICAgICAgICAgICAgY29ubi5z\nZXRBdXRvQ29tbWl0KGZhbHNlKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNxbC5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIF93cml0ZXIucHJpbnRsbihzcWxbaV0gKyAiOyIpOwogICAg\nICAgICAgICBfd3JpdGVyLmZsdXNoKCk7CiAgICAgICAgfQoKICAgICAgICBy\nZXR1cm4gIWVycjsKICAgIH0KCiAgICAvKioKICAgICAqIEhhbmRsZSB0aGUg\nZ2l2ZW4gZXhjZXB0aW9uLCBsb2dnaW5nIGl0IGFuZCBvcHRpb25hbGx5IGln\nbm9yaW5nIGl0LAogICAgICogZGVwZW5kaW5nIG9uIHRoZSBmbGFncyB0aGlz\nIFNjaGVtYVRvb2wgd2FzIGNyZWF0ZWQgd2l0aC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGhhbmRsZUV4Y2VwdGlvbihTUUxFeGNlcHRpb24gc3FsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghX2ln\nbm9yZUVycnMpCiAgICAgICAgICAgIHRocm93IHNxbDsKICAgICAgICBfbG9n\nLndhcm4oc3FsLmdldE1lc3NhZ2UoKSwgc3FsKTsKICAgIH0KCiAgICAvLy8v\nLy8vLwogICAgLy8gTWFpbgogICAgLy8vLy8vLy8KCiAgICAvKioKICAgICAq\nIFVzYWdlOiBqYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5T\nY2hlbWFUb29sIFtvcHRpb25dKgogICAgICogWy1hY3Rpb24vLWEgJmx0O2Fk\nZCB8IHJldGFpbiB8IGRyb3AgfCByZWZyZXNoIHwgY3JlYXRlREIgfCBkcm9w\nREIKICAgICAqIHwgYnVpbGQgfCByZWZsZWN0IHwgaW1wb3J0IHwgZXhwb3J0\nJmd0O10KICAgICAqICZsdDsuc2NoZW1hIGZpbGUgb3IgcmVzb3VyY2UmZ3Q7\nKgogICAgICogIFdoZXJlIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgcmVj\nb2duaXplZC4KICAgICAqIDx1bD4KICAgICAqIDxsaT48aT4tcHJvcGVydGll\ncy8tcCAmbHQ7cHJvcGVydGllcyBmaWxlIG9yIHJlc291cmNlJmd0OzwvaT46\nIFRoZQogICAgICogcGF0aCBvciByZXNvdXJjZSBuYW1lIG9mIGEgT3BlbkpQ\nQSBwcm9wZXJ0aWVzIGZpbGUgY29udGFpbmluZwogICAgICogaW5mb3JtYXRp\nb24gc3VjaCBhcyB0aGUgbGljZW5zZSBrZXkJYW5kIGNvbm5lY3Rpb24gZGF0\nYSBhcwogICAgICogb3V0bGluZWQgaW4ge0BsaW5rIEpEQkNDb25maWd1cmF0\naW9ufS4gT3B0aW9uYWwuPC9saT4KICAgICAqIDxsaT48aT4tJmx0O3Byb3Bl\ncnR5IG5hbWUmZ3Q7ICZsdDtwcm9wZXJ0eSB2YWx1ZSZndDs8L2k+OiBBbGwg\nYmVhbgogICAgICogcHJvcGVydGllcyBvZiB0aGUgT3BlbkpQQSB7QGxpbmsg\nSkRCQ0NvbmZpZ3VyYXRpb259IGNhbiBiZSBzZXQgYnkKICAgICAqIHVzaW5n\nIHRoZWlyCW5hbWVzIGFuZCBzdXBwbHlpbmcgYSB2YWx1ZS4gRm9yIGV4YW1w\nbGU6CiAgICAgKiA8Y29kZT4tbGljZW5zZUtleSBhZHNsZmphODNyM2xrYWRm\nPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGk+LWlnbm9yZUVycm9ycy8taSAm\nbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBJZiBmYWxzZSwgYW4KICAg\nICAqIGV4Y2VwdGlvbiB3aWxsIHdpbGwgYmUgdGhyb3duIGlmIHRoZSB0b29s\nIGVuY291bnRlcnMgYW55IGRhdGFiYXNlCiAgICAgKiBleGNlcHRpb25zOyBk\nZWZhdWx0cyB0byA8Y29kZT5mYWxzZTwvY29kZT4uPC9saT4KICAgICAqIDxs\naT48aT4tZmlsZS8tZiAmbHQ7c3Rkb3V0IHwgb3V0cHV0IGZpbGUgb3IgcmVz\nb3VyY2UmZ3Q7PC9pPjogVXNlIHRoaXMKICAgICAqIG9wdGlvbiB0byB3cml0\nZSBhIFNRTCBzY3JpcHQgZm9yIHRoZSBwbGFubmVkIHNjaGVtYSBtb2RpZmlj\nYXRpb25zLAogICAgICogcmF0aGVyIHRoYW4gY29tbWl0dGluZyB0aGVtIHRv\nIHRoZSBkYXRhYmFzZS4gVGhpcyBvcHRpb24gYWxzbwogICAgICogYXBwbGll\ncyB0byB0aGUgPGNvZGU+ZXhwb3J0PC9jb2RlPiBhbmQgPGNvZGU+cmVmbGVj\ndDwvY29kZT4gYWN0aW9ucy48L2xpPgogICAgICogPGxpPjxpPi1vcGVuanBh\nVGFibGVzLy1rdCAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBVbmRl\nciB0aGUKICAgICAqIDxjb2RlPnJlZmxlY3Q8L2NvZGU+IGFjdGlvbiwgd2hl\ndGhlciB0byByZWZsZWN0IG9uIHRhYmxlcyB3aXRoCiAgICAgKiB0aGUgbmFt\nZSA8Y29kZT5PUEVOSlBBXyo8L2NvZGU+LiBVbmRlciBvdGhlciBhY3Rpb25z\nLCB3aGV0aGVyIHRvCiAgICAgKiBkcm9wIHN1Y2ggdGFibGVzLiBEZWZhdWx0\ncyB0byA8Y29kZT5mYWxzZTwvY29kZT4uPC9saT4KICAgICAqIDxsaT48aT4t\nZHJvcFRhYmxlcy8tZHQgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjog\nU2V0IHRoaXMgb3B0aW9uIHRvCiAgICAgKiB0cnVlIHRvIGRyb3AgdGFibGVz\nIHRoYXQgYXBwZWFyIHRvIGJlIHVudXNlZCBkdXJpbmcKICAgICAqIDxjb2Rl\nPnJldGFpbjwvY29kZT4JYW5kIDxjb2RlPnJlZnJlc2g8L2NvZGU+IGFjdGlv\nbnMuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT50cnVlPC9jb2RlPi48L2xp\nPgogICAgICogPGxpPjxpPi1kcm9wU2VxdWVuY2VzLy1kc3EgJmx0O3RydWUv\ndCB8IGZhbHNlL2YmZ3Q7PC9pPjogU2V0IHRoaXMgb3B0aW9uCiAgICAgKiB0\nbyB0cnVlIHRvIGRyb3Agc2VxdWVuY2VzIHRoYXQgYXBwZWFyIHRvIGJlIHVu\ndXNlZCBkdXJpbmcKICAgICAqIDxjb2RlPnJldGFpbjwvY29kZT4JYW5kIDxj\nb2RlPnJlZnJlc2g8L2NvZGU+IGFjdGlvbnMuIERlZmF1bHRzIHRvCiAgICAg\nKiA8Y29kZT50cnVlPC9jb2RlPi48L2xpPgogICAgICogPGxpPjxpPi1wcmlt\nYXJ5S2V5cy8tcGsgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogV2hl\ndGhlciBwcmltYXJ5CiAgICAgKiBrZXlzIG9uIGV4aXN0aW5nIHRhYmxlcyBh\ncmUgbWFuaXB1bGF0ZWQuIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAq\nIDxsaT48aT4tZm9yZWlnbktleXMvLWZrICZsdDt0cnVlL3QgfCBmYWxzZS9m\nJmd0OzwvaT46IFdoZXRoZXIgZm9yZWlnbgogICAgICoga2V5cyBvbiBleGlz\ndGluZyB0YWJsZXMgYXJlIG1hbmlwdWxhdGVkLiBEZWZhdWx0cyB0byB0cnVl\nLjwvbGk+CiAgICAgKiA8bGk+PGk+LWluZGV4ZXMvLWl4ICZsdDt0cnVlL3Qg\nfCBmYWxzZS9mJmd0OzwvaT46IFdoZXRoZXIgaW5kZXhlcwogICAgICogb24g\nZXhpc3RpbmcgdGFibGVzIGFyZSBtYW5pcHVsYXRlZC4gRGVmYXVsdHMgdG8g\ndHJ1ZS48L2xpPgogICAgICogPGxpPjxpPi1zZXF1ZW5jZXMvLXNxICZsdDt0\ncnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFdoZXRoZXIgdG8KICAgICAqIG1h\nbmlwdWxhdGUgc2VxdWVuY2VzLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+CiAg\nICAgKiA8bGk+PGk+LXJlY29yZC8tciAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZn\ndDs8L2k+OiBTZXQgdGhpcyBvcHRpb24gdG8KICAgICAqIDxjb2RlPmZhbHNl\nPC9jb2RlPiB0byBwcmV2ZW50IHdyaXRpbmcgdGhlIHNjaGVtYSBjaGFuZ2Vz\nIHRvIHRoZQogICAgICogY3VycmVudCB7QGxpbmsgU2NoZW1hRmFjdG9yeX0u\nPC9saT4KICAgICAqIDwvdWw+CiAgICAgKiAgQWN0aW9ucyBjYW4gYmUgY29t\ncG9zZWQgaW4gYSBjb21tYS1zZXBhcmF0ZWQgbGlzdC4gVGhlIHZhcmlvdXMg\nYWN0aW9ucyAKICAgICAqICBhcmUgYXMgZm9sbG93cy4KICAgICAqIDx1bD4K\nICAgICAqIDxsaT48aT5hZGQ8L2k+OiBCcmluZyB0aGUgc2NoZW1hIHVwLXRv\nLWRhdGUgd2l0aCB0aGUgbGF0ZXN0CiAgICAgKiBjaGFuZ2VzIHRvIHRoZSBz\nY2hlbWEgWE1MIGRhdGEgYnkgYWRkaW5nIHRhYmxlcywgY29sdW1ucywKICAg\nICAqIGluZGV4ZXMsIGV0Yy4gVGhpcyBhY3Rpb24gbmV2ZXIgZHJvcHMgYW55\nIGRhdGEuIFRoaXMgaXMgdGhlCiAgICAgKiBkZWZhdWx0IGFjdGlvbi48L2xp\nPgogICAgICogPGxpPjxpPnJldGFpbjwvaT46IEtlZXAgYWxsIHNjaGVtYSBj\nb21wb25lbnRzIGluIHRoZSBzY2hlbWEgWE1MLCBidXQKICAgICAqIGRyb3Ag\ndGhlIHJlc3QgZnJvbSB0aGUgZGF0YWJhc2UuIFRoaXMgYWN0aW9uIG5ldmVy\nIGFkZHMgYW55IGRhdGEuPC9saT4KICAgICAqIDxsaT48aT5kcm9wPC9pPjog\nRHJvcCBhbGwgdGhlIHNjaGVtYSBjb21wb25lbnRzIGluIHRoZSBzY2hlbWEg\nWE1MLjwvbGk+CiAgICAgKiA8bGk+PGk+cmVmcmVzaDwvaT46IEVxdWl2YWxl\nbnQgdG8gcmV0YWluLCB0aGVuIGFkZC48L2xpPgogICAgICogPGxpPjxpPmNy\nZWF0ZURCPC9pPjogRXhlY3V0ZSBTUUwgdG8gcmUtY3JlYXRlIHRoZSBjdXJy\nZW50IGRhdGFiYXNlLgogICAgICogVGhpcyBhY3Rpb24gaXMgdHlwaWNhbGx5\nIHVzZWQgaW4gY29uanVjdGlvbiB3aXRoIHRoZQogICAgICogPGNvZGU+Zmls\nZTwvY29kZT4gb3B0aW9uLjwvbGk+CiAgICAgKiA8bGk+PGk+YnVpbGQ8L2k+\nOiBFeGVjdXRlIFNRTCB0byBidWlsZCB0aGUgc2NoZW1hIGRlZmluZWQgaW4g\ndGhlIFhNTC4KICAgICAqIEJlY2F1c2UgaXQgZG9lc24ndCB0YWtlIHRoZSBj\ndXJyZW50IGRhdGFiYXNlIHNjaGVtYSBpbnRvIGFjY291bnQsCiAgICAgKiB0\naGlzIGFjdGlvbiBpcyB0eXBpY2FsbHkgdXNlZCBpbiBjb25qdWN0aW9uIHdp\ndGggdGhlCiAgICAgKiA8Y29kZT5maWxlPC9jb2RlPiBvcHRpb24uPC9saT4K\nICAgICAqIDxsaT48aT5yZWZsZWN0PC9pPjogUmVmbGVjdCBvbiB0aGUgY3Vy\ncmVudCBkYXRhYmFzZSBzY2hlbWEuIFdyaXRlIHRoZQogICAgICogc2NoZW1h\nJ3MgWE1MIHJlcHJlc2VudGF0aW9uIHRvIHRoZSBmaWxlIHNwZWNpZmllZCB3\naXRoIHRoZQogICAgICogPGNvZGU+ZmlsZTwvY29kZT4gb3B0aW9uLCBvciB0\nbyBzdGRvdXQgaWYgbm8gZmlsZSBpcyBnaXZlbi48L2xpPgogICAgICogPGxp\nPjxpPmRyb3BEQjwvaT46IEV4ZWN1dGUgU1FMIHRvIGRyb3AgdGhlIGN1cnJl\nbnQgZGF0YWJhc2UuIFRoaXMKICAgICAqIGFjdGlvbiBpbXBsaWVzIDxjb2Rl\nPmRyb3BUYWJsZXM8L2NvZGU+LjwvbGk+CiAgICAgKiA8bGk+PGk+ZGVsZXRl\nVGFibGVDb250ZW50czwvaT46IEV4ZWN1dGUgU1FMIHRvIGRlbGV0ZSBhbGwg\ncm93cyBmcm9tIAogICAgICogYWxsIHRhYmxlcyB0aGF0IE9wZW5KUEEga25v\nd3MgYWJvdXQuPC9saT4KICAgICAqIDxsaT48aT5pbXBvcnQ8L2k+OiBJbXBv\ncnQgdGhlIGdpdmVuIFhNTCBzY2hlbWEgZGVmaW5pdGlvbiBpbnRvIHRoZQog\nICAgICogY3VycmVudCB7QGxpbmsgU2NoZW1hRmFjdG9yeX0uPC9saT4KICAg\nICAqIDxsaT48aT5leHBvcnQ8L2k+OiBFeHBvcnQgdGhlIGN1cnJlbnQge0Bs\naW5rIFNjaGVtYUZhY3Rvcnl9J3MgcmVjb3JkZWQKICAgICAqIHNjaGVtYSB0\nbyBhbiBYTUwgc2NoZW1hIGRlZmluaXRpb24gZmlsZS48L2xpPgogICAgICog\nPC91bD4KICAgICAqICBFeGFtcGxlczoKICAgICAqIDx1bD4KICAgICAqIDxs\naT5Xcml0ZSBhIHNjcmlwdCB0byBzdGRvdXQgdG8gcmUtY3JlYXRlIHRoZSBj\ndXJyZW50IGRhdGFiYXNlCiAgICAgKiBzY2hlbWE6PGJyIC8+CiAgICAgKiA8\nY29kZT5qYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hl\nbWFUb29sIC1mIHN0ZG91dCAKICAgICAqIC1hIGNyZWF0ZURCPC9jb2RlPjwv\nbGk+CiAgICAgKiA8bGk+RHJvcCB0aGUgY3VycmVudCBkYXRhYmFzZSBzY2hl\nbWE6PGJyIC8+CiAgICAgKiA8Y29kZT5qYXZhIG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TY2hlbWFUb29sIAogICAgICogLWEgZHJvcERCPC9j\nb2RlPjwvbGk+CiAgICAgKiA8bGk+UmVmcmVzaCB0aGUgc2NoZW1hIGFuZCBk\nZWxldGUgYWxsIHJlY29yZHMgaW4gYWxsIHRhYmxlczo8YnIgLz4KICAgICAq\nIDxjb2RlPmphdmEgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNj\naGVtYVRvb2wgCiAgICAgKiAtYSByZWZyZXNoLGRlbGV0ZVRhYmxlQ29udGVu\ndHM8L2NvZGU+PC9saT4KICAgICAqIDxsaT5DcmVhdGUgYSBzY2hlbWEgYmFz\nZWQgb24gYW4gWE1MIHNjaGVtYSBkZWZpbml0aW9uIGZpbGU6PGJyIC8+CiAg\nICAgKiA8Y29kZT5qYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5TY2hlbWFUb29sIAogICAgICogbXlzY2hlbWEueG1sPC9jb2RlPjwvbGk+\nCiAgICAgKiA8L3VsPgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQg\nbWFpbihTdHJpbmdbXSBhcmdzKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlv\nbiwgU1FMRXhjZXB0aW9uIHsKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcg\nT3B0aW9ucygpOwogICAgICAgIGZpbmFsIFN0cmluZ1tdIGFyZ3VtZW50cyA9\nIG9wdHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CiAgICAgICAgYm9vbGVhbiBy\nZXQgPSBDb25maWd1cmF0aW9ucy5ydW5BZ2FpbnN0QWxsQW5jaG9ycyhvcHRz\nLAogICAgICAgICAgICBuZXcgQ29uZmlndXJhdGlvbnMuUnVubmFibGUoKSB7\nCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bihPcHRpb25zIG9wdHMp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICAgICAgSkRCQ0NvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ldyBKREJDQ29uZmlndXJhdGlvbkltcGwoKTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIFNjaGVtYVRvb2wucnVuKGNvbmYsIGFyZ3VtZW50cywgb3B0cyk7CiAg\nICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAg\nIGNvbmYuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0pOwogICAgICAgIGlmICghcmV0KQogICAgICAgICAgICBT\neXN0ZW0ub3V0LnByaW50bG4oX2xvYy5nZXQoInRvb2wtdXNhZ2UiKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybnMgZmFs\nc2UgaWYgYW55IGludmFsaWQgb3B0aW9ucyB3ZXJlIGdpdmVuLgogICAgICoK\nICAgICAqIEBzZWUgI21haW4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBi\nb29sZWFuIHJ1bihKREJDQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBh\ncmdzLAogICAgICAgIE9wdGlvbnMgb3B0cykKICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRmxhZ3MgZmxhZ3Mg\nPSBuZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5kcm9wVGFibGVzID0gb3B0\ncy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJkcm9wVGFi\nbGVzIiwgImR0IiwgZmxhZ3MuZHJvcFRhYmxlcyk7CiAgICAgICAgZmxhZ3Mu\nZHJvcFNlcXVlbmNlcyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAg\nICAgICAgICAgICgiZHJvcFNlcXVlbmNlcyIsICJkc3EiLCBmbGFncy5kcm9w\nU2VxdWVuY2VzKTsKICAgICAgICBmbGFncy5pZ25vcmVFcnJvcnMgPSBvcHRz\nLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImlnbm9yZUVy\ncm9ycyIsICJpIiwgZmxhZ3MuaWdub3JlRXJyb3JzKTsKICAgICAgICBmbGFn\ncy5vcGVuanBhVGFibGVzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkK\nICAgICAgICAgICAgKCJvcGVuanBhVGFibGVzIiwgIm90IiwgZmxhZ3Mub3Bl\nbmpwYVRhYmxlcyk7CiAgICAgICAgZmxhZ3MucHJpbWFyeUtleXMgPSBvcHRz\nLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInByaW1hcnlL\nZXlzIiwgInBrIiwgZmxhZ3MucHJpbWFyeUtleXMpOwogICAgICAgIGZsYWdz\nLmZvcmVpZ25LZXlzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAg\nICAgICAgICAgKCJmb3JlaWduS2V5cyIsICJma3MiLCBmbGFncy5mb3JlaWdu\nS2V5cyk7CiAgICAgICAgZmxhZ3MuaW5kZXhlcyA9IG9wdHMucmVtb3ZlQm9v\nbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiaW5kZXhlcyIsICJpeCIsIGZs\nYWdzLmluZGV4ZXMpOwogICAgICAgIGZsYWdzLnNlcXVlbmNlcyA9IG9wdHMu\ncmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgic2VxdWVuY2Vz\nIiwgInNxIiwgZmxhZ3Muc2VxdWVuY2VzKTsKICAgICAgICBmbGFncy5yZWNv\ncmQgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eSgicmVjb3JkIiwgInIi\nLCBmbGFncy5yZWNvcmQpOwogICAgICAgIFN0cmluZyBmaWxlTmFtZSA9IG9w\ndHMucmVtb3ZlUHJvcGVydHkoImZpbGUiLCAiZiIsIG51bGwpOwogICAgICAg\nIFN0cmluZyBzY2hlbWFzID0gb3B0cy5yZW1vdmVQcm9wZXJ0eSgicyIpOwog\nICAgICAgIGlmIChzY2hlbWFzICE9IG51bGwpCiAgICAgICAgICAgIG9wdHMu\nc2V0UHJvcGVydHkoInNjaGVtYXMiLCBzY2hlbWFzKTsKCiAgICAgICAgU3Ry\naW5nW10gYWN0aW9ucyA9IG9wdHMucmVtb3ZlUHJvcGVydHkoImFjdGlvbiIs\nICJhIiwgZmxhZ3MuYWN0aW9uKQogICAgICAgICAgICAuc3BsaXQoIiwiKTsK\nICAgICAgICAKICAgICAgICAvLyBzZXR1cCBhIGNvbmZpZ3VyYXRpb24gaW5z\ndGFuY2Ugd2l0aCBjbWQtbGluZSBpbmZvCiAgICAgICAgQ29uZmlndXJhdGlv\nbnMucG9wdWxhdGVDb25maWd1cmF0aW9uKGNvbmYsIG9wdHMpOwoKICAgICAg\nICAvLyBjcmVhdGUgc2NyaXB0IHdyaXRlcgogICAgICAgIENsYXNzTG9hZGVy\nIGxvYWRlciA9IGNvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNlKCkuCiAg\nICAgICAgICAgIGdldENsYXNzTG9hZGVyKFNjaGVtYVRvb2wuY2xhc3MsIG51\nbGwpOwogICAgICAgIGZsYWdzLndyaXRlciA9IEZpbGVzLmdldFdyaXRlcihm\naWxlTmFtZSwgbG9hZGVyKTsKCiAgICAgICAgYm9vbGVhbiByZXR1cm5WYWx1\nZSA9IHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhY3Rpb25z\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZsYWdzLmFjdGlvbiA9IGFj\ndGlvbnNbaV07CiAgICAgICAgICAgIHJldHVyblZhbHVlICY9IHJ1bihjb25m\nLCBhcmdzLCBmbGFncywgbG9hZGVyKTsKICAgICAgICB9CiAgICAgICAgCiAg\nICAgICAgcmV0dXJuIHJldHVyblZhbHVlOwogICAgfQoKICAgIC8qKgogICAg\nICogUnVuIHRoZSB0b29sLiBSZXR1cm4gZmFsc2UgaWYgaW52YWxpZCBvcHRp\nb25zIHdlcmUgZ2l2ZW4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9v\nbGVhbiBydW4oSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJn\ncywKICAgICAgICBGbGFncyBmbGFncywgQ2xhc3NMb2FkZXIgbG9hZGVyKQog\nICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRp\nb24uTE9HX1RPT0wpOwogICAgICAgIGlmIChBQ1RJT05fUkVGTEVDVC5lcXVh\nbHMoZmxhZ3MuYWN0aW9uKSkgewogICAgICAgICAgICBpZiAoYXJncy5sZW5n\ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBpZiAoZmxhZ3Mud3JpdGVyID09IG51bGwpCiAgICAgICAgICAgICAg\nICBmbGFncy53cml0ZXIgPSBuZXcgUHJpbnRXcml0ZXIoU3lzdGVtLm91dCk7\nCgogICAgICAgICAgICBTY2hlbWFHZW5lcmF0b3IgZ2VuID0gbmV3IFNjaGVt\nYUdlbmVyYXRvcihjb25mKTsKICAgICAgICAgICAgZ2VuLnNldFByaW1hcnlL\nZXlzKGZsYWdzLnByaW1hcnlLZXlzKTsKICAgICAgICAgICAgZ2VuLnNldElu\nZGV4ZXMoZmxhZ3MuaW5kZXhlcyk7CiAgICAgICAgICAgIGdlbi5zZXRGb3Jl\naWduS2V5cyhmbGFncy5mb3JlaWduS2V5cyk7CiAgICAgICAgICAgIGdlbi5z\nZXRTZXF1ZW5jZXMoZmxhZ3Muc2VxdWVuY2VzKTsKICAgICAgICAgICAgZ2Vu\nLnNldE9wZW5KUEFUYWJsZXMoZmxhZ3Mub3BlbmpwYVRhYmxlcyk7CgogICAg\nICAgICAgICBTdHJpbmcgc2NoZW1hcyA9IGNvbmYuZ2V0U2NoZW1hcygpOwog\nICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzY2hlbWFzKSkK\nICAgICAgICAgICAgICAgIHNjaGVtYXMgPSAiYWxsIjsKICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoInNjaC1yZWZsZWN0Iiwgc2NoZW1hcykpOwog\nICAgICAgICAgICBnZW4uZ2VuZXJhdGVTY2hlbWFzKCk7CgogICAgICAgICAg\nICAvLyByZWNvcmQgdGhlIHNjaGVtYQogICAgICAgICAgICBsb2cuaW5mbyhf\nbG9jLmdldCgic2NoLXJlZmxlY3Qtd3JpdGUiKSk7CiAgICAgICAgICAgIFNj\naGVtYVNlcmlhbGl6ZXIgc2VyID0gbmV3IFhNTFNjaGVtYVNlcmlhbGl6ZXIo\nY29uZik7CiAgICAgICAgICAgIHNlci5hZGRBbGwoZ2VuLmdldFNjaGVtYUdy\nb3VwKCkpOwogICAgICAgICAgICBzZXIuc2VyaWFsaXplKGZsYWdzLndyaXRl\nciwgc2VyLlBSRVRUWSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDAKICAgICAgICAg\nICAgJiYgIUFDVElPTl9DUkVBVEVEQi5lcXVhbHMoZmxhZ3MuYWN0aW9uKQog\nICAgICAgICAgICAmJiAhQUNUSU9OX0RST1BEQi5lcXVhbHMoZmxhZ3MuYWN0\naW9uKQogICAgICAgICAgICAmJiAhQUNUSU9OX0VYUE9SVC5lcXVhbHMoZmxh\nZ3MuYWN0aW9uKQogICAgICAgICAgICAmJiAhQUNUSU9OX0RFTEVURV9UQUJM\nRV9DT05URU5UUy5lcXVhbHMoZmxhZ3MuYWN0aW9uKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBwYXJzZSBpbiB0aGUgYXJndW1l\nbnRzCiAgICAgICAgU2NoZW1hUGFyc2VyIHBhcnNlciA9IG5ldyBYTUxTY2hl\nbWFQYXJzZXIoY29uZik7CiAgICAgICAgcGFyc2VyLnNldERlbGF5Q29uc3Ry\nYWludFJlc29sdmUodHJ1ZSk7CiAgICAgICAgRmlsZSBmaWxlOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBmaWxlID0gRmlsZXMuZ2V0RmlsZShhcmdzW2ldLCBsb2FkZXIp\nOwogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgidG9vbC1ydW5uaW5n\nIiwgZmlsZSkpOwogICAgICAgICAgICBwYXJzZXIucGFyc2UoZmlsZSk7CiAg\nICAgICAgfQogICAgICAgIHBhcnNlci5yZXNvbHZlQ29uc3RyYWludHMoKTsK\nCiAgICAgICAgaWYgKEFDVElPTl9JTVBPUlQuZXF1YWxzKGZsYWdzLmFjdGlv\nbikpIHsKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtaW1w\nb3J0LXN0b3JlIikpOwogICAgICAgICAgICBTY2hlbWFHcm91cCBzY2hlbWEg\nPSBwYXJzZXIuZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICAgICAgY29uZi5n\nZXRTY2hlbWFGYWN0b3J5SW5zdGFuY2UoKS5zdG9yZVNjaGVtYShzY2hlbWEp\nOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAg\naWYgKEFDVElPTl9FWFBPUlQuZXF1YWxzKGZsYWdzLmFjdGlvbikpIHsKICAg\nICAgICAgICAgaWYgKGZsYWdzLndyaXRlciA9PSBudWxsKQogICAgICAgICAg\nICAgICAgZmxhZ3Mud3JpdGVyID0gbmV3IFByaW50V3JpdGVyKFN5c3RlbS5v\ndXQpOwoKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtZXhw\nb3J0LWdlbiIpKTsKICAgICAgICAgICAgU2NoZW1hR3JvdXAgc2NoZW1hID0g\nY29uZi5nZXRTY2hlbWFGYWN0b3J5SW5zdGFuY2UoKS5yZWFkU2NoZW1hKCk7\nCgogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgidG9vbC1leHBvcnQt\nd3JpdGUiKSk7CiAgICAgICAgICAgIFNjaGVtYVNlcmlhbGl6ZXIgc2VyID0g\nbmV3IFhNTFNjaGVtYVNlcmlhbGl6ZXIoY29uZik7CiAgICAgICAgICAgIHNl\nci5hZGRBbGwoc2NoZW1hKTsKICAgICAgICAgICAgc2VyLnNlcmlhbGl6ZShm\nbGFncy53cml0ZXIsIHNlci5QUkVUVFkpOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CgogICAgICAgIFNjaGVtYVRvb2wgdG9vbCA9IG5l\ndyBTY2hlbWFUb29sKGNvbmYsIGZsYWdzLmFjdGlvbik7CiAgICAgICAgdG9v\nbC5zZXRJZ25vcmVFcnJvcnMoZmxhZ3MuaWdub3JlRXJyb3JzKTsKICAgICAg\nICB0b29sLnNldERyb3BUYWJsZXMoZmxhZ3MuZHJvcFRhYmxlcyk7CiAgICAg\nICAgdG9vbC5zZXRTZXF1ZW5jZXMoZmxhZ3Muc2VxdWVuY2VzKTsgLy8gc2V0\nIGJlZm9yZSBkcm9wc2VxcwogICAgICAgIHRvb2wuc2V0RHJvcFNlcXVlbmNl\ncyhmbGFncy5kcm9wU2VxdWVuY2VzKTsKICAgICAgICB0b29sLnNldFByaW1h\ncnlLZXlzKGZsYWdzLnByaW1hcnlLZXlzKTsKICAgICAgICB0b29sLnNldEZv\ncmVpZ25LZXlzKGZsYWdzLmZvcmVpZ25LZXlzKTsKICAgICAgICB0b29sLnNl\ndEluZGV4ZXMoZmxhZ3MuaW5kZXhlcyk7CiAgICAgICAgdG9vbC5zZXRPcGVu\nSlBBVGFibGVzKGZsYWdzLm9wZW5qcGFUYWJsZXMpOwogICAgICAgIGlmIChh\ncmdzLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHRvb2wuc2V0U2NoZW1hR3Jv\ndXAocGFyc2VyLmdldFNjaGVtYUdyb3VwKCkpOwogICAgICAgIGlmIChmbGFn\ncy53cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgdG9vbC5zZXRXcml0ZXIo\nZmxhZ3Mud3JpdGVyKTsKCiAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRv\nb2wtYWN0aW9uIiwgZmxhZ3MuYWN0aW9uKSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgdG9vbC5ydW4oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBpZiAoZmxhZ3MucmVjb3JkKSB7CiAgICAgICAgICAgICAgICBs\nb2cuaW5mbyhfbG9jLmdldCgidG9vbC1yZWNvcmQiKSk7CiAgICAgICAgICAg\nICAgICB0b29sLnJlY29yZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGlmIChmbGFncy53cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nZmxhZ3Mud3JpdGVyLmZsdXNoKCk7CgogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIC8qKgogICAgICogUnVuIGZsYWdzLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGNsYXNzIEZsYWdzIHsKCiAgICAgICAgcHVibGljIFN0\ncmluZyBhY3Rpb24gPSBBQ1RJT05fQUREOwogICAgICAgIHB1YmxpYyBXcml0\nZXIgd3JpdGVyID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBkcm9w\nVGFibGVzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBkcm9wU2Vx\ndWVuY2VzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpZ25vcmVF\ncnJvcnMgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBvcGVuanBh\nVGFibGVzID0gZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xlYW4gcHJpbWFy\neUtleXMgPSB0cnVlOwogICAgICAgIHB1YmxpYyBib29sZWFuIGZvcmVpZ25L\nZXlzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpbmRleGVzID0g\ndHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBzZXF1ZW5jZXMgPSB0cnVl\nOwogICAgICAgIHB1YmxpYyBib29sZWFuIHJlY29yZCA9IHRydWU7CiAgICB9\nCn0K\n","encoding":"base64"}

