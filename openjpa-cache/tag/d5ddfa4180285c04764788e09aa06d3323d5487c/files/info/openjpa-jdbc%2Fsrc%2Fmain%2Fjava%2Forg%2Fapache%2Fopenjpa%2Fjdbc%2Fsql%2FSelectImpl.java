{"sha":"6d0da80711acc39198c8961e9fec5e529aaec5e2","node_id":"MDQ6QmxvYjIwNjM2NDo2ZDBkYTgwNzExYWNjMzkxOThjODk2MWU5ZmVjNWU1MjlhYWVjNWUy","size":95167,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6d0da80711acc39198c8961e9fec5e529aaec5e2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5pdGVyYXRvcnMuRW1wdHlJ\ndGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDTG9j\na01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLkpEQkNTdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2luYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogU3RhbmRhcmQge0BsaW5r\nIFNlbGVjdH0gaW1wbGVtZW50YXRpb24uIFVzYWdlIG5vdGU6IHRob3VnaCB0\naGlzIGNsYXNzCiAqIGltcGxlbWVudHMge0BsaW5rIEpvaW5zfSwgaXQgc2hv\ndWxkIG5vdCBiZSB1c2VkIGZvciBqb2luaW5nIGRpcmVjdGx5LgogKiBJbnN0\nZWFkLCB1c2UgdGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgI25ld0pvaW5z\nfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFNlbGVjdEltcGwKICAgIGltcGxlbWVudHMgU2VsZWN0\nLCBQYXRoSm9pbnMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBO\nT05BVVRPX0RJU1RJTkNUID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IERJU1RJTkNUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE5PVF9ESVNUSU5DVCA9IDIgPDwgMjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBJTVBMSUNJVF9ESVNUSU5DVCA9IDIgPDwg\nMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT19NQU5ZID0gMiA8\nPCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFHR1JFR0FURSA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMT0IgPSAy\nIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1VURVIgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTFJTID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX09O\nRSA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBFQUdF\nUl9UT19NQU5ZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBSRUNPUkRfT1JERVJFRCA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgR1JPVVBJTkcgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZPUkNFX0NPVU5UID0gMiA8PCAxMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBUQUJMRV9BTElBU0VT\nID0gbmV3IFN0cmluZ1sxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndHJpbmdbXSBPUkRFUl9BTElBU0VTID0gbmV3IFN0cmluZ1sxNl07CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBOVUxMX0lEUyA9IG5ldyBP\nYmplY3RbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nUExBQ0VIT0xERVJTID0gbmV3IE9iamVjdFs1MF07CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShTZWxlY3QuY2xhc3MpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBUQUJMRV9BTElBU0VTLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBUQUJMRV9BTElBU0VTW2ldID0gInQiICsgaTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IE9SREVSX0FMSUFTRVMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE9SREVSX0FMSUFTRVNbaV0gPSAibyIgKyBpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTlVMTF9JRFMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE5VTExfSURTW2ldID0gbmV3IE51bGxJZCgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUExBQ0VIT0xERVJTLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBQTEFDRUhPTERFUlNbaV0gPSBuZXcgUGxh\nY2Vob2xkZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEpEQkNDb25m\naWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25h\ncnkgX2RpY3Q7CgogICAgLy8gbWFwIG9mIHZhcmlhYmxlICsgcmVsYXRpb24g\ncGF0aCArIHRhYmxlIGtleXMgdG8gdGhlIGNvcnJlY3QgYWxpYXMgaW5kZXg6\nCiAgICAvLyBlYWNoIHJlbGF0aW9uIHBhdGgvdGFibGUgY29tYmluYXRpb24g\nc2hvdWxkIGhhdmUgYSB1bmlxdWUgYWxpYXMgYmVjYXVzZQogICAgLy8gaXQg\ncmVwcmVzZW50cyBhIHNlcGFyYXRlIG9iamVjdDsgZm9yIGV4YW1wbGUsIGlm\nIGEgUGVyc29uIGNsYXNzIGhhcyBhCiAgICAvLyAncGFyZW50JyBmaWVsZCBy\nZXByZXNlbnRpbmcgYW5vdGhlciBQZXJzb24gYW5kIGFsc28gaGFzIGFuICdh\nZGRyZXNzJwogICAgLy8gZmllbGQgb2YgdHlwZSBBZGRyZXNzOgogICAgLy8g\nJ2FkZHJlc3Muc3RyZWV0JyBzaG91bGQgbWFwIHRvIGEgZGlmZmVyZW50IHRh\nYmxlIGFsaWFzIHRoYW4KICAgIC8vICdwYXJlbnQuYWRkcmVzcy5zdHJlZXQn\nIGZvciB0aGUgcHVycG9zZXMgb2YgY29tcGFyaXNvbnMKICAgIHByaXZhdGUg\nTWFwIF9hbGlhc2VzID0gbnVsbDsKCiAgICAvLyBtYXAgb2YgaW5kZXhlcyB0\nbyB0YWJsZSBhbGlhc2VzIGxpa2UgJ1RBQkxFTkFNRSB0MCcKICAgIHByaXZh\ndGUgU29ydGVkTWFwIF90YWJsZXMgPSBudWxsOwoKICAgIC8vIGNvbWJpbmVk\nIGxpc3Qgb2Ygc2VsZWN0ZWQgaWRzIGFuZCBtYXAgb2YgZWFjaCBpZCB0byBp\ndHMgYWxpYXMKICAgIHByb3RlY3RlZCBmaW5hbCBTZWxlY3RzIF9zZWxlY3Rz\nID0gbmV3U2VsZWN0cygpOwogICAgcHJpdmF0ZSBMaXN0IF9vcmRlcmVkID0g\nbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfZ3JvdXBlZCA9IG51bGw7CgogICAg\nLy8gZmxhZ3MKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2\nYXRlIGludCBfam9pblN5bnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5N\nQVhfVkFMVUU7CiAgICBwcml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBw\ncml2YXRlIGludCBfb3JkZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFj\nZWhvbGRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0\nQ291bnQgPSAwOwoKICAgIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vcmRlcmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBfd2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dy\nb3VwaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcg\nPSBudWxsOwoKICAgIC8vIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91\nciB3aGVyZSBjbGF1c2UsIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAv\nLyBhbGwgc2VsZWN0cyAoc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhv\nZCkKICAgIHByaXZhdGUgU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAg\nb2Ygam9pbnMra2V5cyB0byBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0\nIG9mIGVhZ2VyIGtleXM7IHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUg\ndXNlZCBtb3JlIHRoYW4gb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAg\nIC8vIHN1YnNlbGVjdCBzdXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAg\nIC8vIGZyb20gc2VsZWN0IGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBh\nIHRtcCB0YWJsZSBjcmVhdGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2Vs\nZWN0SW1wbCBfZnJvbSA9IG51bGw7CiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1w\nbCBfb3V0ZXIgPSBudWxsOwogICAgCiAgICAvLyBiaXRTZXQgaW5kaWNhdGlu\nZyBpZiBhbiBhbGlhcyBpcyByZW1vdmVkIGZyb20gcGFyZW50IHNlbGVjdAog\nICAgLy8gYml0IDAgOiBjb3JyZXNwb25kIHRvIGFsaWFzIDAKICAgIC8vIGJp\ndCAxIDogY29ycmVzcG9uZCB0byBhbGlhcyAxLCBldGMuCiAgICAvLyBpZiB0\naGUgYml0IGlzIHNldCwgdGhlIGNvcnJlc3BvbmRpbmcgYWxpYXMgaGFzIGJl\nZW4gcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgLy8gYW5kIHJlY29yZGVkIHVu\nZGVyIHN1YnNlbGVjdC4KICAgIHByaXZhdGUgQml0U2V0IF9yZW1vdmVkQWxp\nYXNGcm9tUGFyZW50ID0gbmV3IEJpdFNldCgxNik7CiAgICAgCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgdGFi\nbGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBhbGlhcyBpbmRleC4KICAgICAqLwog\nICAgc3RhdGljIFN0cmluZyB0b0FsaWFzKGludCBpbmRleCkgewogICAgICAg\nIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKGluZGV4IDwgVEFCTEVfQUxJQVNFUy5sZW5ndGgpCiAgICAg\nICAgICAgIHJldHVybiBUQUJMRV9BTElBU0VTW2luZGV4XTsKICAgICAgICBy\nZXR1cm4gInQiICsgaW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHJldHVybiB0aGUgcHJvcGVyIG9yZGVyIGFsaWFzIGZv\nciB0aGUgZ2l2ZW4gb3JkZXIKICAgICAqIGNvbHVtbiBpbmRleC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgdG9PcmRlckFsaWFzKGludCBp\nbmRleCkgewogICAgICAgIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGluZGV4IDwgT1JERVJfQUxJQVNF\nUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBPUkRFUl9BTElBU0VTW2lu\nZGV4XTsKICAgICAgICByZXR1cm4gIm8iICsgaW5kZXg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyBTZWxlY3RJbXBsKEpEQkNDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2Rp\nY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAg\nIF9qb2luU3ludGF4ID0gX2RpY3Quam9pblN5bnRheDsKICAgICAgICBfc2Vs\nZWN0cy5fZGljdCA9IF9kaWN0OwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0RXhlY3V0b3IgaW1w\nbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KGJvb2xlYW4gZm9yVXBkYXRlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJu\nIF9kaWN0LnRvU2VsZWN0KHRoaXMsIGZvclVwZGF0ZSwgZmV0Y2gpOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3RDb3VudCgpIHsKICAg\nICAgICByZXR1cm4gX2RpY3QudG9TZWxlY3RDb3VudCh0aGlzKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBdXRvRGlzdGluY3QoKSB7CiAgICAg\nICAgcmV0dXJuIChfZmxhZ3MgJiBOT05BVVRPX0RJU1RJTkNUKSA9PSAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EaXN0aW5jdChib29sZWFu\nIHZhbCkgewogICAgICAgIGlmICh2YWwpCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9mbGFncyB8PSBOT05BVVRPX0RJU1RJTkNUOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzRGlzdGluY3QoKSB7CiAgICAgICAgcmV0dXJuIChfZmxh\nZ3MgJiBOT1RfRElTVElOQ1QpID09IDAgJiYgKChfZmxhZ3MgJiBESVNUSU5D\nVCkgIT0gMAogICAgICAgICAgICB8fCAoKF9mbGFncyAmIE5PTkFVVE9fRElT\nVElOQ1QpID09IDAKICAgICAgICAgICAgJiYgKF9mbGFncyAmIElNUExJQ0lU\nX0RJU1RJTkNUKSAhPSAwKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRGlzdGluY3QoYm9vbGVhbiBkaXN0aW5jdCkgewogICAgICAgIC8vIG5lZWQg\ndHdvIGZsYWdzIGluIGNhc2Ugc2V0IG5vdF9kaXN0aW5jdCwgdGhlbiBhIHRv\nLW1hbnkgam9pbiBoYXBwZW5zCiAgICAgICAgLy8gYW5kIGRpc3RpbmN0IGZs\nYWcgZ2V0cyBzZXQgYXV0b21hdGljYWxseQogICAgICAgIGlmIChkaXN0aW5j\ndCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+Tk9UX0RJU1RJTkNUOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIF9mbGFncyB8PSBOT1RfRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RElTVElOQ1Q7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzTFJTKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgTFJTKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExS\nUyhib29sZWFuIGxycykgewogICAgICAgIGlmIChscnMpCiAgICAgICAgICAg\nIF9mbGFncyB8PSBMUlM7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkxSUzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEV4cGVjdGVk\nUmVzdWx0Q291bnQoKSB7CiAgICAgICAgLy8gaWYgdGhlIGNvdW50IGlzbid0\nIGZvcmNlZCBhbmQgd2UgaGF2ZSB0by1tYW55IGVhZ2VyIGpvaW5zIHRoYXQg\nY291bGQKICAgICAgICAvLyB0aHJvdyB0aGUgY291bnQgb2ZmLCBkb24ndCBw\nYXkgYXR0ZW50aW9uIHRvIGl0CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGT1JD\nRV9DT1VOVCkgPT0gMCAmJiBoYXNFYWdlckpvaW4odHJ1ZSkpCiAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiBfZXhwZWN0ZWRSZXN1bHRD\nb3VudDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFeHBlY3RlZFJlc3Vs\ndENvdW50KGludCBleHBlY3RlZFJlc3VsdENvdW50LCBib29sZWFuIGZvcmNl\nKSB7CiAgICAgICAgX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBleHBlY3RlZFJl\nc3VsdENvdW50OwogICAgICAgIGlmIChmb3JjZSkKICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZPUkNFX0NPVU5UOwogICAgICAgIGVsc2UgCiAgICAgICAgICAg\nIF9mbGFncyAmPSB+Rk9SQ0VfQ09VTlQ7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRKb2luU3ludGF4KCkgewogICAgICAgIHJldHVybiBfam9pblN5bnRh\neDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luU3ludGF4KGludCBq\nb2luU3ludGF4KSB7CiAgICAgICAgX2pvaW5TeW50YXggPSBqb2luU3ludGF4\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNj\nZXNzKGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0\nLnN1cHBvcnRzUmFuZG9tQWNjZXNzUmVzdWx0U2V0KHRoaXMsIGZvclVwZGF0\nZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5n\nKCkgewogICAgICAgIHJldHVybiBfZGljdC5zdXBwb3J0c0xvY2tpbmcodGhp\ncyk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb3VudChKREJDU3RvcmUg\nc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCA9IG51bGw7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBTUUxCdWZmZXIgc3FsID0g\ndG9TZWxlY3RDb3VudCgpOwogICAgICAgICAgICBjb25uID0gc3RvcmUuZ2V0\nQ29ubmVjdGlvbigpOwogICAgICAgICAgICBzdG1udCA9IHByZXBhcmVTdGF0\nZW1lbnQoY29ubiwgc3FsLCBudWxsLCAKICAgICAgICAgICAgICAgIFJlc3Vs\ndFNldC5UWVBFX0ZPUldBUkRfT05MWSwgCiAgICAgICAgICAgICAgICBSZXN1\nbHRTZXQuQ09OQ1VSX1JFQURfT05MWSwgZmFsc2UpOwogICAgICAgICAgICBy\ncyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1udCwgc3FsLCBmYWxzZSwgc3Rv\ncmUpOwogICAgICAgICAgICByZXR1cm4gZ2V0Q291bnQocnMpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgdHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgaWYgKGNvbm4gIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UoKTsgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgUmVzdWx0IGV4ZWN1dGUoSkRCQ1N0b3JlIHN0b3JlLCBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAg\nICAgICBmZXRjaCA9IHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwog\nICAgICAgIHJldHVybiBleGVjdXRlKHN0b3JlLmdldENvbnRleHQoKSwgc3Rv\ncmUsIGZldGNoLAogICAgICAgICAgICBmZXRjaC5nZXRSZWFkTG9ja0xldmVs\nKCkpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAg\nICAgaW50IGxvY2tMZXZlbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgZmV0\nY2ggPSBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBy\nZXR1cm4gZXhlY3V0ZShzdG9yZS5nZXRDb250ZXh0KCksIHN0b3JlLCBmZXRj\naCwgbG9ja0xldmVsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUg\ndGhpcyBzZWxlY3QgaW4gdGhlIGNvbnRleHQgb2YgdGhlIGdpdmVuIHN0b3Jl\nIG1hbmFnZXIuIFRoZQogICAgICogY29udGV4dCBpcyBwYXNzZWQgaW4gc2Vw\nYXJhdGVseSBmb3IgcHJvZmlsaW5nIHB1cnBvc2VzLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgUmVzdWx0IGV4ZWN1dGUoU3RvcmVDb250ZXh0IGN0eCwgSkRC\nQ1N0b3JlIHN0b3JlLCAKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLCBpbnQgbG9ja0xldmVsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlID0gZmFsc2U7CiAg\nICAgICAgaWYgKCFpc0FnZ3JlZ2F0ZSgpICYmIF9ncm91cGluZyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIEpEQkNMb2NrTWFuYWdlciBsbSA9IHN0b3JlLmdl\ndExvY2tNYW5hZ2VyKCk7CiAgICAgICAgICAgIGlmIChsbSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgZm9yVXBkYXRlID0gbG0uc2VsZWN0Rm9yVXBkYXRl\nKHRoaXMsIGxvY2tMZXZlbCk7CiAgICAgICAgfQoKICAgICAgICBTUUxCdWZm\nZXIgc3FsID0gdG9TZWxlY3QoZm9yVXBkYXRlLCBmZXRjaCk7CiAgICAgICAg\nYm9vbGVhbiBpc0xSUyA9IGlzTFJTKCk7CiAgICAgICAgaW50IHJzVHlwZSA9\nIChpc0xSUyAmJiBzdXBwb3J0c1JhbmRvbUFjY2Vzcyhmb3JVcGRhdGUpKQog\nICAgICAgICAgICA/IC0xIDogUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZ\nOwogICAgICAgIENvbm5lY3Rpb24gY29ubiA9IHN0b3JlLmdldENvbm5lY3Rp\nb24oKTsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51bGw7\nCiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoaXNMUlMpIAogICAgICAgICAgICAgICAgc3RtbnQg\nPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIHNxbCwgZmV0Y2gsIHJzVHlwZSwg\nLTEsIHRydWUpOyAKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIHNxbCwgbnVsbCwgcnNU\neXBlLCAtMSwgZmFsc2UpOwogICAgICAgICAgICAKICAgICAgICAgICAgc2V0\nVGltZW91dChzdG1udCwgZm9yVXBkYXRlLCBmZXRjaCk7CiAgICAgICAgICAg\nIAogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1udCwg\nc3FsLCBpc0xSUywgc3RvcmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICAvLyBjbGVhbiB1cCBzdGF0ZW1lbnQK\nICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAgICAgICAgICAgICAg\nICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UyKSB7fQogICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlKCk7IH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAgICAgIHRocm93IHNl\nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGdldEVhZ2VyUmVzdWx0KGNv\nbm4sIHN0bW50LCBycywgc3RvcmUsIGZldGNoLCBmb3JVcGRhdGUsIAogICAg\nICAgICAgICBzcWwuZ2V0U1FMKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRXhlY3V0ZSBvdXIgZWFnZXIgc2VsZWN0cywgYWRkaW5nIHRoZSByZXN1bHRz\nIHVuZGVyIHRoZSBzYW1lIGtleXMKICAgICAqIHRvIHRoZSBnaXZlbiByZXN1\nbHQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYWRkRWFnZXJS\nZXN1bHRzKFNlbGVjdFJlc3VsdCByZXMsIFNlbGVjdEltcGwgc2VsLAogICAg\nICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoc2VsLl9lYWdlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIC8vIGV4ZWN1dGUgZWFnZXIgc2VsZWN0cwogICAgICAgIE1hcC5F\nbnRyeSBlbnRyeTsKICAgICAgICBSZXN1bHQgZXJlczsKICAgICAgICBNYXAg\nZWFnZXI7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzZWwuX2VhZ2Vy\nLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwoKICAg\nICAgICAgICAgLy8gc2ltdWxhdGVkIGJhdGNoZWQgc2VsZWN0cyBmb3IgaW5u\nZXIvb3V0ZXIgam9pbnM7IGZvciBzZXBhcmF0ZQogICAgICAgICAgICAvLyBz\nZWxlY3RzLCBkb24ndCBwYXNzIG9uIGxvY2sgbGV2ZWwsIGJlY2F1c2UgdGhl\neSdyZSBwcm9iYWJseQogICAgICAgICAgICAvLyBmb3IgcmVsYXRpb25zIGFu\nZCB0aGVyZWZvcmUgc2hvdWxkIHVzZSBkZWZhdWx0IGxldmVsCiAgICAgICAg\nICAgIGlmIChlbnRyeS5nZXRWYWx1ZSgpID09IHNlbCkKICAgICAgICAgICAg\nICAgIGVyZXMgPSByZXM7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGVyZXMgPSAoKFNlbGVjdEV4ZWN1dG9yKSBlbnRyeS5nZXRWYWx1ZSgp\nKS5leGVjdXRlKHN0b3JlLAogICAgICAgICAgICAgICAgICAgIGZldGNoKTsK\nCiAgICAgICAgICAgIGVhZ2VyID0gcmVzLmdldEVhZ2VyTWFwKGZhbHNlKTsK\nICAgICAgICAgICAgaWYgKGVhZ2VyID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGVhZ2VyID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHJl\ncy5zZXRFYWdlck1hcChlYWdlcik7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZWFnZXIucHV0KGVudHJ5LmdldEtleSgpLCBlcmVzKTsKICAgICAgICB9\nCiAgICB9CgoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJv\ndmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAg\nICogaW1wbGVtZW50YXRpb24gb2YgcHJlcGFyaW5nIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVT\ndGF0ZW1lbnQoQ29ubmVjdGlvbiBjb25uLCAKICAgICAgICBTUUxCdWZmZXIg\nc3FsLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgcnNUeXBl\nLCAKICAgICAgICBpbnQgcnNDb25jdXIsIGJvb2xlYW4gaXNMUlMpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwg\ncnNUeXBlLCByc0NvbmN1cik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBy\nZXR1cm4gc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwgZmV0Y2gsIHJzVHlw\nZSwgLTEpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMt\nbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHNldHRpbmcgcXVlcnkg\ndGltZW91dC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0VGltZW91\ndChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgYm9vbGVhbiBmb3JVcGRhdGUs\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGxvY2tp\nbmcgc2VsZWN0IGFuZCB0aGUgbG9jayB0aW1lb3V0IGlzIGdyZWF0ZXIgdGhh\nbgogICAgICAgIC8vIHRoZSBjb25maWd1cmVkIHF1ZXJ5IHRpbWVvdXQsIHVz\nZSB0aGUgbG9jayB0aW1lb3V0CiAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiBf\nZGljdC5zdXBwb3J0c1F1ZXJ5VGltZW91dCAmJiBmZXRjaCAhPSBudWxsIAog\nICAgICAgICAgICAmJiBmZXRjaC5nZXRMb2NrVGltZW91dCgpID4gc3RtbnQu\nZ2V0UXVlcnlUaW1lb3V0KCkgKiAxMDAwKSB7CiAgICAgICAgICAgIGludCB0\naW1lb3V0ID0gZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKTsKICAgICAgICAgICAg\naWYgKHRpbWVvdXQgPCAxMDAwKSB7CiAgICAgICAgICAgICAgICB0aW1lb3V0\nID0gMTAwMDsgCiAgICAgICAgICAgICAgICBMb2cgbG9nID0gX2NvbmYuZ2V0\nTG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJtaWxsaXMtcXVlcnktdGltZW91dCIp\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdG1udC5zZXRRdWVyeVRp\nbWVvdXQodGltZW91dCAvIDEwMDApOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUg\nZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0\naW9uIG9mIGV4ZWN1dGluZyBxdWVyeS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoQ29ubmVjdGlvbiBjb25uLCBQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwg\nYm9vbGVhbiBpc0xSUywgSkRCQ1N0b3JlIHN0b3JlKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8g\ncHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAog\nICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyBjb3VudCBmcm9tIHRo\nZSByZXN1bHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgaW50IGdldENv\ndW50KFJlc3VsdFNldCBycykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgcnMubmV4dCgpOwogICAgICAgIHJldHVybiBycy5nZXRJbnQoMSk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJv\ndmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAg\nICogaW1wbGVtZW50YXRpb24gb2YgZXhlY3V0aW5nIGVhZ2VyIHNlbGVjdHMu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHQgZ2V0RWFnZXJSZXN1bHQo\nQ29ubmVjdGlvbiBjb25uLCAKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgUmVzdWx0U2V0IHJzLCBKREJDU3RvcmUgc3RvcmUsIAogICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJvb2xlYW4gZm9yVXBk\nYXRlLCBTdHJpbmcgc3FsU3RyKSAKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBTZWxlY3RSZXN1bHQgcmVzID0gbmV3IFNlbGVjdFJl\nc3VsdChjb25uLCBzdG1udCwgcnMsIF9kaWN0KTsKICAgICAgICByZXMuc2V0\nU2VsZWN0KHRoaXMpOwogICAgICAgIHJlcy5zZXRTdG9yZShzdG9yZSk7CiAg\nICAgICAgcmVzLnNldExvY2tpbmcoZm9yVXBkYXRlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhZGRFYWdlclJlc3VsdHMocmVzLCB0aGlzLCBzdG9y\nZSwgZmV0Y2gpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICAgICAgdGhyb3cg\nc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0IGltcGxl\nbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\ncHVibGljIGludCBpbmRleE9mKCkgewogICAgICAgIHJldHVybiAwOwogICAg\nfQoKICAgIHB1YmxpYyBMaXN0IGdldFN1YnNlbGVjdHMoKSB7CiAgICAgICAg\ncmV0dXJuIChfc3Vic2VscyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZ\nX0xJU1QgOiBfc3Vic2VsczsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0IGdl\ndFBhcmVudCgpIHsKICAgICAgICByZXR1cm4gX3BhcmVudDsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFN1YnNlbGVjdFBhdGgoKSB7CiAgICAgICAg\ncmV0dXJuIF9zdWJQYXRoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFBh\ncmVudChTZWxlY3QgcGFyZW50LCBTdHJpbmcgcGF0aCkgewogICAgICAgIGlm\nIChwYXRoICE9IG51bGwpCiAgICAgICAgICAgIF9zdWJQYXRoID0gcGF0aCAr\nICc6JzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zdWJQYXRoID0gbnVs\nbDsKCiAgICAgICAgaWYgKHBhcmVudCA9PSBfcGFyZW50KQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCkKICAgICAg\nICAgICAgX3BhcmVudC5fc3Vic2Vscy5yZW1vdmUodGhpcyk7CgogICAgICAg\nIC8vIyMjIHJpZ2h0IG5vdyB3ZSBjYW4ndCB1c2Ugc3FsOTIgam9pbnMgd2l0\naCBzdWJzZWxlY3RzLCBjYXVzZQogICAgICAgIC8vIyMjIEkgY2FuJ3QgZmln\ndXJlIG91dCB3aGF0IHRvIGRvIHdoZW4gdGhlIHN1YnNlbGVjdCBoYXMgYSBq\nb2luCiAgICAgICAgLy8jIyMgd2l0aCBhbiBhbGlhcyBhbHNvIHByZXNlbnQg\naW4gdGhlIG91dGVyIHNlbGVjdC4uLiB5b3UgZG9uJ3Qgd2FudAogICAgICAg\nIC8vIyMjIHRoZSBqb2luIHRvIGFwcGVhciBpbiB0aGUgRlJPTSBjbGF1c2Ug\nb2YgdGhlIHN1YnNlbGVjdCBjYXVzZQogICAgICAgIC8vIyMjIHRoZW4gaXQg\ncmUtYWxpYXNlcyBib3RoIHRhYmxlcyBpbiB0aGUgc2NvcGUgb2YgdGhlIHN1\nYnNlbGVjdAogICAgICAgIC8vIyMjIGFuZCB0aGUgY29ycmVsYXRpb24gd2l0\naCB0aGUgb3V0ZXIgc2VsZWN0IGlzIGxvc3QKICAgICAgICBfcGFyZW50ID0g\nKFNlbGVjdEltcGwpIHBhcmVudDsKICAgICAgICBpZiAoX3BhcmVudCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChfcGFyZW50Ll9zdWJzZWxzID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzID0gbmV3IEFy\ncmF5TGlzdCgyKTsKICAgICAgICAgICAgX3BhcmVudC5fc3Vic2Vscy5hZGQo\ndGhpcyk7CiAgICAgICAgICAgIGlmIChfcGFyZW50Ll9qb2luU3ludGF4ID09\nIEpvaW5TeW50YXhlcy5TWU5UQVhfU1FMOTIpCiAgICAgICAgICAgICAgICBf\nam9pblN5bnRheCA9IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUw7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9qb2luU3ludGF4\nID0gX3BhcmVudC5fam9pblN5bnRheDsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIFNlbGVjdCBnZXRGcm9tU2VsZWN0KCkgewogICAgICAgIHJldHVy\nbiBfZnJvbTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGcm9tU2VsZWN0\nKFNlbGVjdCBzZWwpIHsKICAgICAgICBfZnJvbSA9IChTZWxlY3RJbXBsKSBz\nZWw7CiAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpCiAgICAgICAgICAgIF9m\ncm9tLl9vdXRlciA9IHRoaXM7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naGFzRWFnZXJKb2luKGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgaWYgKHRv\nTWFueSkKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBFQUdFUl9UT19N\nQU5ZKSAhPSAwOwogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRUFHRVJfVE9f\nT05FKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0pvaW4o\nYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICBpZiAodG9NYW55KQogICAgICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIFRPX01BTlkpICE9IDA7CiAgICAgICAg\ncmV0dXJuIF90YWJsZXMgIT0gbnVsbCAmJiBfdGFibGVzLnNpemUoKSA+IDE7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNTZWxlY3RlZChUYWJsZSB0\nYWJsZSkgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKG51bGws\nIGZhbHNlKTsKICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9mcm9tLmdldFRhYmxlSW5kZXgodGFibGUsIHBqLCBmYWxz\nZSkgIT0gLTE7CiAgICAgICAgcmV0dXJuIGdldFRhYmxlSW5kZXgodGFibGUs\nIHBqLCBmYWxzZSkgIT0gLTE7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rp\nb24gZ2V0VGFibGVBbGlhc2VzKCkgewogICAgICAgIHJldHVybiAoX3RhYmxl\ncyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX1NFVCA6IF90YWJsZXMu\ndmFsdWVzKCk7CiAgICB9CgogICAgcHVibGljIExpc3QgZ2V0U2VsZWN0cygp\nIHsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlz\ndChfc2VsZWN0cyk7CiAgICB9CgogICAgcHVibGljIExpc3QgZ2V0U2VsZWN0\nQWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gX3NlbGVjdHMuZ2V0QWxpYXNl\ncyhmYWxzZSwgX291dGVyICE9IG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBM\naXN0IGdldElkZW50aWZpZXJBbGlhc2VzKCkgewogICAgICAgIHJldHVybiBf\nc2VsZWN0cy5nZXRBbGlhc2VzKHRydWUsIF9vdXRlciAhPSBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldE9yZGVyaW5nKCkgewogICAg\nICAgIHJldHVybiBfb3JkZXJpbmc7CiAgICB9CgogICAgcHVibGljIFNRTEJ1\nZmZlciBnZXRHcm91cGluZygpIHsKICAgICAgICByZXR1cm4gX2dyb3VwaW5n\nOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0V2hlcmUoKSB7CiAg\nICAgICAgcmV0dXJuIF93aGVyZTsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVm\nZmVyIGdldEhhdmluZygpIHsKICAgICAgICByZXR1cm4gX2hhdmluZzsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRKb2luQ2xhc3NDb25kaXRpb25zKCkg\newogICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuam9pbnMo\nKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGpv\naW4gc2V0IGl0ZXJhdG9yIGFsbG93cyBjb25jdXJyZW50IG1vZGlmaWNhdGlv\nbgogICAgICAgIEpvaW4gajsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIF9qb2lucy5qb2lucygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGogPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgaWYgKGouZ2V0UmVsYXRpb25UYXJnZXQoKSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBqLmdldFJlbGF0aW9uVGFyZ2V0KCkuZ2V0RGlzY3JpbWlu\nYXRvcigpLmFkZENsYXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAg\nICh0aGlzLCBqLmdldFN1YmNsYXNzZXMoKSA9PSBTVUJTX0pPSU5BQkxFLCAK\nICAgICAgICAgICAgICAgICAgICBqLmdldFJlbGF0aW9uSm9pbnMoKSk7CiAg\nICAgICAgICAgICAgICBqLnNldFJlbGF0aW9uKG51bGwsIDAsIG51bGwpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBKb2lu\ncyBnZXRKb2lucygpIHsKICAgICAgICByZXR1cm4gX2pvaW5zOwogICAgfQoK\nICAgIHB1YmxpYyBJdGVyYXRvciBnZXRKb2luSXRlcmF0b3IoKSB7CiAgICAg\nICAgaWYgKF9qb2lucyA9PSBudWxsIHx8IF9qb2lucy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybiBFbXB0eUl0ZXJhdG9yLklOU1RBTkNFOwogICAg\nICAgIHJldHVybiBfam9pbnMuam9pbnMoKS5qb2luSXRlcmF0b3IoKTsKICAg\nIH0KCiAgICBwdWJsaWMgbG9uZyBnZXRTdGFydEluZGV4KCkgewogICAgICAg\nIHJldHVybiBfc3RhcnRJZHg7CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0\nRW5kSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9lbmRJZHg7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0UmFuZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQp\nIHsKICAgICAgICBfc3RhcnRJZHggPSBzdGFydDsKICAgICAgICBfZW5kSWR4\nID0gZW5kOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxp\nYXMoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlh\ncyhjb2wsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sLCBKb2lucyBqb2lucykgewog\nICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIGdldEpvaW5zKGpv\naW5zLCBmYWxzZSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAgcHJp\ndmF0ZSBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCwgUGF0aEpv\naW5zIHBqKSB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbC5n\nZXROYW1lKCksIGNvbC5nZXRUYWJsZSgpLCBwaik7CiAgICB9CgogICAgcHVi\nbGljIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhTdHJpbmcgY29sLCBUYWJsZSB0\nYWJsZSkgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIHRh\nYmxlLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFibGUgdGFibGUsIEpvaW5z\nIGpvaW5zKSB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbCwg\ndGFibGUsIGdldEpvaW5zKGpvaW5zLCBmYWxzZSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGNvbHVt\nbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMo\nU3RyaW5nIGNvbCwgVGFibGUgdGFibGUsIFBhdGhKb2lucyBwaikgewogICAg\nICAgIGlmIChfZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBh\nbGlhcyA9IHRvQWxpYXMoX2Zyb20uZ2V0VGFibGVJbmRleCh0YWJsZSwgcGos\nIHRydWUpKTsKICAgICAgICAgICAgaWYgKF9kaWN0LnJlcXVpcmVzQWxpYXNG\nb3JTdWJzZWxlY3QpCiAgICAgICAgICAgICAgICByZXR1cm4gRlJPTV9TRUxF\nQ1RfQUxJQVMgKyAiLiIgKyBhbGlhcyArICJfIiArIGNvbDsKICAgICAgICAg\nICAgcmV0dXJuIGFsaWFzICsgIl8iICsgY29sOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdG9BbGlhcyhnZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1\nZSkpICsgIi4iICsgY29sOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nQWdncmVnYXRlKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgQUdHUkVH\nQVRFKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEFnZ3JlZ2F0\nZShib29sZWFuIGFnZykgewogICAgICAgIGlmIChhZ2cpCiAgICAgICAgICAg\nIF9mbGFncyB8PSBBR0dSRUdBVEU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkFHR1JFR0FURTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0xvYigpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIExPQikg\nIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMb2IoYm9vbGVhbiBs\nb2IpIHsKICAgICAgICBpZiAobG9iKQogICAgICAgICAgICBfZmxhZ3MgfD0g\nTE9COwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5MT0I7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXJTZWxlY3RzKCkgewogICAg\nICAgIF9zZWxlY3RzLmNsZWFyKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gc2VsZWN0KFNRTEJ1ZmZlciBzcWwsIE9iamVjdCBpZCkgewogICAgICAg\nIHJldHVybiBzZWxlY3Qoc3FsLCBpZCwgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc2VsZWN0KFNRTEJ1ZmZlciBzcWwsIE9iamVjdCBpZCwg\nSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoIWlzR3JvdXBpbmcoKSkKICAg\nICAgICAgICAgcmV0dXJuIHNlbGVjdCgoT2JqZWN0KSBzcWwsIGlkLCBqb2lu\ncyk7CiAgICAgICAgZ3JvdXBCeShzcWwsIGpvaW5zKTsKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIHNl\nbGVjdCBvZiB0aGUgZ2l2ZW4gU1FMIGJ1ZmZlciBvciBzdHJpbmcuCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3QoT2JqZWN0IHNxbCwgT2Jq\nZWN0IGlkLCBKb2lucyBqb2lucykgewogICAgICAgIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKTsKICAgICAgICBib29sZWFuIGNvbnRhaW5zOwogICAgICAgIGlm\nIChpZCA9PSBudWxsKSB7CiAgICAgICAgICAgIGludCBpZHggPSBfc2VsZWN0\ncy5pbmRleE9mQWxpYXMoc3FsKTsKICAgICAgICAgICAgY29udGFpbnMgPSBp\nZHggIT0gLTE7CiAgICAgICAgICAgIGlmIChjb250YWlucykKICAgICAgICAg\nICAgICAgIGlkID0gX3NlbGVjdHMuZ2V0KGlkeCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGlkID0gbnVsbElkKCk7CiAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgIGNvbnRhaW5zID0gX3NlbGVjdHMuY29udGFpbnMo\naWQpOwoKICAgICAgICBpZiAoY29udGFpbnMpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBfc2VsZWN0cy5zZXRBbGlhcyhpZCwgc3FsLCBm\nYWxzZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIGEgdW5pcXVlIGlkIGZvciBhIFNRTCBzdHJpbmcgd2hv\nc2UgZ2l2ZW4gaWQgaXMgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSBPYmpl\nY3QgbnVsbElkKCkgewogICAgICAgIGlmIChfbnVsbElkcyA+PSBOVUxMX0lE\nUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBuZXcgTnVsbElkKCk7CiAg\nICAgICAgcmV0dXJuIE5VTExfSURTW19udWxsSWRzKytdOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIHNlbGVjdChTdHJpbmcgc3FsLCBPYmplY3QgaWQp\nIHsKICAgICAgICByZXR1cm4gc2VsZWN0KHNxbCwgaWQsIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTdHJpbmcgc3FsLCBPYmpl\nY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dyb3VwaW5n\nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoKE9iamVjdCkgc3FsLCBp\nZCwgam9pbnMpOwogICAgICAgIGdyb3VwQnkoc3FsLCBqb2lucyk7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0\nUGxhY2Vob2xkZXIoU3RyaW5nIHNxbCkgewogICAgICAgIE9iamVjdCBob2xk\nZXIgPSAoX3BsYWNlaG9sZGVycyA+PSBQTEFDRUhPTERFUlMubGVuZ3RoKQog\nICAgICAgICAgICA/IG5ldyBQbGFjZWhvbGRlcigpIDogUExBQ0VIT0xERVJT\nW19wbGFjZWhvbGRlcnMrK107CiAgICAgICAgc2VsZWN0KHNxbCwgaG9sZGVy\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc2VydCBhIHBsYWNlaG9sZGVy\nIGF0IHRoZSBnaXZlbiBpbmRleDsgdXNlIGEgbmVnYXRpdmUgaW5kZXgKICAg\nICAqIHRvIGNvdW50IGZyb20gdGhlIGJhY2sgb2YgdGhlIHNlbGVjdCBsaXN0\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBpbnNlcnRQbGFjZWhvbGRlcihT\ndHJpbmcgc3FsLCBpbnQgcG9zKSB7CiAgICAgICAgT2JqZWN0IGhvbGRlciA9\nIChfcGxhY2Vob2xkZXJzID49IFBMQUNFSE9MREVSUy5sZW5ndGgpCiAgICAg\nICAgICAgID8gbmV3IFBsYWNlaG9sZGVyKCkgOiBQTEFDRUhPTERFUlNbX3Bs\nYWNlaG9sZGVycysrXTsKICAgICAgICBfc2VsZWN0cy5pbnNlcnRBbGlhcyhw\nb3MsIGhvbGRlciwgc3FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFy\nIHNlbGVjdGVkIHBsYWNlaG9sZGVycywgYW5kIHJldHVybiByZW1vdmVkIHNl\nbGVjdCBpbmRleGVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhclBs\nYWNlaG9sZGVyU2VsZWN0cygpIHsKICAgICAgICBfc2VsZWN0cy5jbGVhclBs\nYWNlaG9sZGVycygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVj\ndChDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdChjb2wsIChK\nb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0\nKENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dy\nb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoY29sLCBnZXRK\nb2lucyhqb2lucywgdHJ1ZSksIGZhbHNlKTsKICAgICAgICBncm91cEJ5KGNv\nbCwgam9pbnMpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IHNlbGVjdChDb2x1bW5bXSBjb2xzKSB7CiAgICAgICAgcmV0\ndXJuIHNlbGVjdChjb2xzLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIHNlbGVjdChDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lucykgewogICAgICAg\nIGlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKGlzR3JvdXBpbmcoKSkgewog\nICAgICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsKICAgICAgICAgICAg\ncmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIFBhdGhKb2lucyBwaiA9IGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoc2VsZWN0KGNvbHNbaV0sIHBqLCBmYWxzZSkpCiAg\nICAgICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAgICAgICByZXR1cm4g\nc2VsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZ2l2ZW4g\nY29sdW1uIGFmdGVyIG1ha2luZyB0aGUgZ2l2ZW4gam9pbnMuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCwgUGF0aEpv\naW5zIHBqLCBib29sZWFuIGlkZW50KSB7CiAgICAgICAgLy8gd2UgY2FjaGUg\nb24gY29sdW1uIG9iamVjdCBpZiB0aGVyZSBhcmUgbm8gam9pbnMgc28gdGhh\ndCB3aGVuCiAgICAgICAgLy8gbG9va2luZyB1cCBjb2x1bW5zIGluIHRoZSBy\nZXN1bHQgd2UgZG9uJ3QgaGF2ZSB0byBjcmVhdGUgYSBzdHJpbmcKICAgICAg\nICAvLyBidWZmZXIgZm9yIHRoZSB0YWJsZSArIGNvbHVtbiBhbGlhczsgaWYg\ndGhlcmUgYXJlIGpvaW5zLCB0aGVuCiAgICAgICAgLy8gd2Uga2V5IG9uIHRo\nZSBhbGlhcwogICAgICAgIFN0cmluZyBhbGlhcyA9IGdldENvbHVtbkFsaWFz\nKGNvbCwgcGopOwogICAgICAgIE9iamVjdCBpZDsKICAgICAgICBpZiAocGog\nPT0gbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgaWQg\nPSBjb2w7CiAgICAgICAgZWxzZQogICAgICAgICAgICBpZCA9IGFsaWFzOwog\nICAgICAgIGlmIChfc2VsZWN0cy5jb250YWlucyhpZCkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKGNvbC5nZXRUeXBlKCkgPT0g\nVHlwZXMuQkxPQiB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkNMT0IpCiAg\nICAgICAgICAgIHNldExvYih0cnVlKTsKICAgICAgICBfc2VsZWN0cy5zZXRB\nbGlhcyhpZCwgYWxpYXMsIGlkZW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyKSB7\nCiAgICAgICAgc2VsZWN0KG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBm\nZXRjaCwgZWFnZXIsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\nbGVjdChDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAg\nICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMgam9pbnMpIHsKICAg\nICAgICBzZWxlY3QodGhpcywgbWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUs\nIGZldGNoLCBlYWdlciwgam9pbnMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNlbGVjdCB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwogICAg\ndm9pZCBzZWxlY3QoU2VsZWN0IHdyYXBwZXIsIENsYXNzTWFwcGluZyBtYXBw\naW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJDU3RvcmUgc3RvcmUs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwKICAg\nICAgICBKb2lucyBqb2lucywgYm9vbGVhbiBpZGVudCkgewogICAgICAgIC8v\nIG5vdGUgdGhhdCB0aGlzIGlzIG9uZSBjYXNlIHdoZXJlIHdlIGRvbid0IHdh\nbnQgdG8gdXNlIHRoZSByZXN1bHQKICAgICAgICAvLyBvZiBnZXRKb2lucygp\nOyBqdXN0IHVzZSB0aGUgZ2l2ZW4gam9pbnMsIHdoaWNoIHdpbGwgZWl0aGVy\nIGJlIGNsZWFuCiAgICAgICAgLy8gb3IgdGhlIHJlc3VsdCBvZiBwcmV2aW91\ncyBwcmUtam9pbnMuIHRoaXMgd2F5IHdlIGRvbid0IHB1c2ggZXh0cmEKICAg\nICAgICAvLyBzdGFjayBzdHVmZiB3aGVuIG5vIGFjdHVhbCBuZXcgam9pbnMg\naGF2ZSBiZWVuIG1hZGUsIGFuZCB3ZSBkb24ndAogICAgICAgIC8vIHRoaW5r\nIHRoZSB1c2VyIHdhbnRzIG91dGVyIGpvaW5zIHdoZW4gYWN0dWFsbHkgb25s\neSB0aGUgcHJldmlvdXMKICAgICAgICAvLyBqb2lucyB3ZXJlIG91dGVyLiAg\nd2UgZG8gaW52b2tlIGdldEpvaW5zKCksIHRob3VnaCwgdG8gYWRkIHRoZXNl\nCiAgICAgICAgLy8gam9pbnMgKGlmIGFueSkgdG8gb3VyIHRvcC1sZXZlbCBq\nb2luczsgb3RoZXJ3aXNlIGl0J2QgYmUgcG9zc2libGUKICAgICAgICAvLyBm\nb3IgdGhlIHVzZXIgdG8gaW1tZWRpYXRlbHkgZG8gYW5vdGhlciBqb2luIGFu\nZCBzZWxlY3Qgc29tZXRoaW5nLAogICAgICAgIC8vIGFuZCBpZiB3ZSdyZSBp\nbiBvdXRlciBtb2RlIGFsbCB0aGVzZSBqb2lucyB3aWxsIGdldCBzd2l0Y2hl\nZCB0byBvdXRlcgogICAgICAgIC8vIGpvaW5zLiAgY2FjaGluZyB0aGVtIGFz\nIHRoZWlyIG9yaWdpbmFsIGpvaW4gdHlwZSBwcmV2ZW50cyB0aGF0CiAgICAg\nICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwoKICAgICAgICBQYXRoSm9pbnMg\ncGogPSAoUGF0aEpvaW5zKSBqb2luczsKICAgICAgICBib29sZWFuIGhhc0pv\naW5zID0gcGogIT0gbnVsbCAmJiBwai5pc0RpcnR5KCk7CiAgICAgICAgaWYg\nKGhhc0pvaW5zKSB7CiAgICAgICAgICAgIGlmIChfcHJlSm9pbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9wcmVKb2lucyA9IG5ldyBTdGFjaygpOwog\nICAgICAgICAgICBfcHJlSm9pbnMucHVzaChwaik7CiAgICAgICAgfQoKICAg\nICAgICAvLyBpZiB0aGV5IGFyZSBzZWxlY3RpbmcgdGhpcyBtYXBwaW5nIHdp\ndGggb3V0ZXIgam9pbnMsIHRoZW4gYWxsIGpvaW5zCiAgICAgICAgLy8gZnJv\nbSB0aGlzIG1hcHBpbmcgc2hvdWxkIGFsc28gYmUgb3V0ZXIKICAgICAgICBi\nb29sZWFuIHdhc091dGVyID0gKF9mbGFncyAmIE9VVEVSKSAhPSAwOwogICAg\nICAgIGlmIChoYXNKb2lucyAmJiAhd2FzT3V0ZXIgJiYgcGouaXNPdXRlcigp\nKQogICAgICAgICAgICBfZmxhZ3MgfD0gT1VURVI7CgogICAgICAgIC8vIGRl\nbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIgdG8gc2VsZWN0IGluIHNhbWUgb3Jk\nZXIgaXQgbG9hZHMgcmVzdWx0CiAgICAgICAgKChKREJDU3RvcmVNYW5hZ2Vy\nKSBzdG9yZSkuc2VsZWN0KHdyYXBwZXIsIG1hcHBpbmcsIHN1YmNsYXNzZXMs\nIG51bGwsCiAgICAgICAgICAgIG51bGwsIGZldGNoLCBlYWdlciwgaWRlbnQs\nIChfZmxhZ3MgJiBPVVRFUikgIT0gMCk7CgogICAgICAgIC8vIHJlc2V0CiAg\nICAgICAgaWYgKGhhc0pvaW5zKQogICAgICAgICAgICBfcHJlSm9pbnMucG9w\nKCk7CiAgICAgICAgaWYgKCF3YXNPdXRlciAmJiAoX2ZsYWdzICYgT1VURVIp\nICE9IDApCiAgICAgICAgICAgIF9mbGFncyAmPSB+T1VURVI7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gc2VsZWN0SWRlbnRpZmllcihDb2x1bW4gY29s\nKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdElkZW50aWZpZXIoY29sLCAoSm9p\nbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdElk\nZW50aWZpZXIoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBp\nZiAoIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdChj\nb2wsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgdHJ1ZSk7CiAgICAgICAgZ3Jv\ndXBCeShjb2wsIGpvaW5zKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCgogICAgcHVibGljIGludCBzZWxlY3RJZGVudGlmaWVyKENvbHVtbltdIGNv\nbHMpIHsKICAgICAgICByZXR1cm4gc2VsZWN0SWRlbnRpZmllcihjb2xzLCBu\ndWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdElkZW50aWZpZXIo\nQ29sdW1uW10gY29scywgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoY29s\ncyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJl\ndHVybiAwOwogICAgICAgIGlmIChpc0dyb3VwaW5nKCkpIHsKICAgICAgICAg\nICAgZ3JvdXBCeShjb2xzLCBqb2lucyk7CiAgICAgICAgICAgIHJldHVybiAw\nOwogICAgICAgIH0KICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhq\nb2lucywgdHJ1ZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgaWYgKHNlbGVjdChjb2xzW2ldLCBwaiwgdHJ1ZSkpCiAgICAgICAgICAg\nICAgICBzZWxkIHw9IDIgPDwgaTsKICAgICAgICByZXR1cm4gc2VsZDsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RJZGVudGlmaWVyKENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBl\nYWdlcikgewogICAgICAgIHNlbGVjdElkZW50aWZpZXIobWFwcGluZywgc3Vi\nY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdlciwgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2VsZWN0SWRlbnRpZmllcihDbGFzc01hcHBpbmcg\nbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0\nb3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIs\nCiAgICAgICAgSm9pbnMgam9pbnMpIHsKICAgICAgICBzZWxlY3QodGhpcywg\nbWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdlciwgam9p\nbnMsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0UHJpbWFy\neUtleShDbGFzc01hcHBpbmcgbWFwcGluZykgewogICAgICAgIHJldHVybiBz\nZWxlY3RQcmltYXJ5S2V5KG1hcHBpbmcsIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgc2VsZWN0UHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGlu\nZywgSm9pbnMgam9pbnMpIHsKICAgICAgICByZXR1cm4gcHJpbWFyeUtleU9w\nZXJhdGlvbihtYXBwaW5nLCB0cnVlLCBudWxsLCBqb2lucywgZmFsc2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogT3BlcmF0ZSBvbiBwcmltYXJ5IGtleSBk\nYXRhLiBSZXR1cm4gYSBiaXQgbWFzayBvZiBzZWxlY3RlZCBjb2x1bW5zLgog\nICAgICovCiAgICBwcml2YXRlIGludCBwcmltYXJ5S2V5T3BlcmF0aW9uKENs\nYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIHNlbCwKICAgICAgICBCb29s\nZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gYWxpYXNPcmRlcikgewog\nICAgICAgIGlmICghc2VsICYmIGFzYyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gMDsKCiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nIGNhbid0IHNl\nbGVjdCB0aGUgZnVsbCBwayB2YWx1ZXMsIHRoZW4gam9pbiB0bwogICAgICAg\nIC8vIHN1cGVyIGFuZCByZWN1cnNlCiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1\ncDsKICAgICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQo\ndHJ1ZSkpIHsKICAgICAgICAgICAgc3VwID0gbWFwcGluZy5nZXRKb2luYWJs\nZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgaWYgKGpvaW5z\nID09IG51bGwpCiAgICAgICAgICAgICAgICBqb2lucyA9IG5ld0pvaW5zKCk7\nCiAgICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5qb2luU3VwZXJjbGFzcyhq\nb2lucywgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gcHJpbWFyeUtleU9w\nZXJhdGlvbihzdXAsIHNlbCwgYXNjLCBqb2lucywgYWxpYXNPcmRlcik7CiAg\nICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gbWFwcGluZy5nZXRQ\ncmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGlmIChpc0dyb3VwaW5nKCkp\nIHsKICAgICAgICAgICAgZ3JvdXBCeShjb2xzLCBqb2lucyk7CiAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgUGF0aEpvaW5zIHBq\nID0gZ2V0Sm9pbnMoam9pbnMsIGZhbHNlKTsKICAgICAgICBpbnQgc2VsZCA9\nIDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICBpZiAoY29sdW1uT3BlcmF0aW9uKGNvbHNbaV0s\nIHNlbCwgYXNjLCBwaiwgYWxpYXNPcmRlcikpCiAgICAgICAgICAgICAgICBz\nZWxkIHw9IDIgPDwgaTsKCiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nIGhh\ncyBub3QgYmVlbiB1c2VkIGluIHRoZSBzZWxlY3QgeWV0IChhbmQgdGhlcmVm\nb3JlCiAgICAgICAgLy8gaXMgbm90IGpvaW5lZCB0byBhbnl0aGluZyksIGJ1\ndCBoYXMgYW4gb3RoZXItdGFibGUgc3VwZXJjbGFzcyB0aGF0CiAgICAgICAg\nLy8gaGFzIGJlZW4gdXNlZCwgbWFrZSBzdXJlIHRvIGpvaW4gdG8gaXQKICAg\nICAgICBib29sZWFuIGpvaW5lZCA9IGZhbHNlOwogICAgICAgIGZvciAoc3Vw\nID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsg\nc3VwICE9IG51bGw7CiAgICAgICAgICAgIG1hcHBpbmcgPSBzdXAsIHN1cCA9\nIG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkpIHsK\nICAgICAgICAgICAgaWYgKHN1cC5nZXRUYWJsZSgpID09IG1hcHBpbmcuZ2V0\nVGFibGUoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgaWYgKG1hcHBpbmcuZ2V0VGFibGUoKSAhPSBzdXAuZ2V0VGFibGUoKQog\nICAgICAgICAgICAgICAgJiYgZ2V0VGFibGVJbmRleChtYXBwaW5nLmdldFRh\nYmxlKCksIHBqLCBmYWxzZSkgPT0gLTEKICAgICAgICAgICAgICAgICYmIGdl\ndFRhYmxlSW5kZXgoc3VwLmdldFRhYmxlKCksIHBqLCBmYWxzZSkgIT0gLTEp\nIHsKICAgICAgICAgICAgICAgIGlmIChwaiA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgbmV3Sm9pbnMoKTsKICAgICAg\nICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgbWFwcGluZy5qb2luU3VwZXJj\nbGFzcyhwaiwgZmFsc2UpOwogICAgICAgICAgICAgICAgam9pbmVkID0gdHJ1\nZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICB9CiAgICAgICAgaWYgKGpvaW5lZCkKICAgICAgICAgICAgd2hl\ncmUocGopOwoKICAgICAgICByZXR1cm4gc2VsZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBlcmZvcm0gYW4gb3BlcmF0aW9uIG9uIGEgY29sdW1uLgogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gY29sdW1uT3BlcmF0aW9uKENvbHVt\nbiBjb2wsIGJvb2xlYW4gc2VsLCBCb29sZWFuIGFzYywKICAgICAgICBQYXRo\nSm9pbnMgcGosIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIFN0cmlu\nZyBhcyA9IG51bGw7CiAgICAgICAgaWYgKGFzYyAhPSBudWxsICYmIChhbGlh\nc09yZGVyIHx8IChfZmxhZ3MgJiBSRUNPUkRfT1JERVJFRCkgIT0gMCkpIHsK\nICAgICAgICAgICAgT2JqZWN0IGlkOwogICAgICAgICAgICBpZiAocGogPT0g\nbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGlk\nID0gY29sOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZCA9\nIGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAwKSB7CiAgICAgICAgICAgICAg\nICBpZiAoX29yZGVyZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\nb3JkZXJlZCA9IG5ldyBBcnJheUxpc3QoNSk7CiAgICAgICAgICAgICAgICBf\nb3JkZXJlZC5hZGQoaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChhbGlhc09yZGVyKSB7CiAgICAgICAgICAgICAgICBhcyA9IHRvT3JkZXJB\nbGlhcyhfb3JkZXJzKyspOwogICAgICAgICAgICAgICAgX3NlbGVjdHMuc2V0\nU2VsZWN0QXMoaWQsIGFzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgYm9vbGVhbiBzZWxkID0gc2VsICYmIHNlbGVjdChjb2wsIHBqLCBm\nYWxzZSk7CiAgICAgICAgaWYgKGFzYyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIFN0cmluZyBhbGlhcyA9IChhcyAhPSBudWxsKSA/IGFzIDogZ2V0Q29sdW1u\nQWxpYXMoY29sLCBwaik7CiAgICAgICAgICAgIGFwcGVuZE9yZGVyaW5nKGFs\naWFzLCBhc2MuYm9vbGVhblZhbHVlKCkpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gc2VsZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBvcmRl\ncmluZyBpbmZvcm1hdGlvbiB0byBvdXIgaW50ZXJuYWwgYnVmZmVyLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYXBwZW5kT3JkZXJpbmcoT2JqZWN0IG9y\nZGVyQnksIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgaWYgKF9vcmRlcmluZyA9\nPSBudWxsKQogICAgICAgICAgICBfb3JkZXJpbmcgPSBuZXcgU1FMQnVmZmVy\nKF9kaWN0KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmluZy5h\ncHBlbmQoIiwgIik7CgogICAgICAgIGlmIChvcmRlckJ5IGluc3RhbmNlb2Yg\nU1FMQnVmZmVyKQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKChTUUxC\ndWZmZXIpIG9yZGVyQnkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX29y\nZGVyaW5nLmFwcGVuZCgoU3RyaW5nKSBvcmRlckJ5KTsKICAgICAgICBpZiAo\nYXNjKQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIgQVNDIik7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIgREVT\nQyIpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJCeVByaW1hcnlLZXko\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gYXNjLAogICAgICAgIGJv\nb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnlQcmltYXJ5S2V5\nKG1hcHBpbmcsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBi\nb29sZWFuIGFzYywKICAgICAgICBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwp\nIHsKICAgICAgICByZXR1cm4gb3JkZXJCeVByaW1hcnlLZXkobWFwcGluZywg\nYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1u\ncy4KICAgICAqLwogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFyeUtleShD\nbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAgICAgSm9p\nbnMgam9pbnMsIGJvb2xlYW4gc2VsLCBib29sZWFuIGFsaWFzT3JkZXIpIHsK\nICAgICAgICByZXR1cm4gcHJpbWFyeUtleU9wZXJhdGlvbihtYXBwaW5nLCBz\nZWwsCiAgICAgICAgICAgIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRSwgam9pbnMsIGFsaWFzT3JkZXIpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9vbGVhbiBhc2MsIGJv\nb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoY29sLCBhc2Ms\nIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJC\neShDb2x1bW4gY29sLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xl\nYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoY29sLCBhc2MsIGpv\naW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93\nIHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5zLgogICAg\nICovCiAgICBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9vbGVhbiBh\nc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAgICAgICBib29sZWFu\nIGFsaWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4gY29sdW1uT3BlcmF0aW9u\nKGNvbCwgc2VsLCAoYXNjKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFM\nU0UsCiAgICAgICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgYWxpYXNP\ncmRlcik7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5KENvbHVtbltd\nIGNvbHMsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAgICAgIHJl\ndHVybiBvcmRlckJ5KGNvbHMsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IG9yZGVyQnkoQ29sdW1uW10gY29scywgYm9vbGVhbiBh\nc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVy\nbiBvcmRlckJ5KGNvbHMsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2Vz\nIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGludCBvcmRlckJ5KENv\nbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVh\nbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAg\nUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAg\nIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNv\nbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb2x1bW5PcGVyYXRp\nb24oY29sc1tpXSwgc2VsLAogICAgICAgICAgICAgICAgKGFzYykgPyBCb29s\nZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLCBwaiwgYWxpYXNPcmRlcikpCiAg\nICAgICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAgICAgICByZXR1cm4g\nc2VsZDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFNRTEJ1\nZmZlciBzcWwsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCAoSm9pbnMpIG51bGwsIHNlbCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIg\nc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsCiAgICAgICAgYm9vbGVh\nbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgam9p\nbnMsIHNlbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cg\ndW5pb25zIHRvIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAg\nKi8KICAgIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIgc3FsLCBib29sZWFu\nIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xl\nYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVybiBvcmRlckJ5KChPYmpl\nY3QpIHNxbCwgYXNjLCBqb2lucywgc2VsLCBhbGlhc09yZGVyKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE9yZGVyIG9uIGEgU1FMIGJ1ZmZlciBvciBzdHJp\nbmcuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBvcmRlckJ5KE9iamVj\ndCBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWws\nCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgT2JqZWN0\nIG9yZGVyID0gc3FsOwogICAgICAgIGlmIChhbGlhc09yZGVyKSB7CiAgICAg\nICAgICAgIG9yZGVyID0gdG9PcmRlckFsaWFzKF9vcmRlcnMrKyk7CiAgICAg\nICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKHNxbCwgKFN0cmluZykgb3Jk\nZXIpOwogICAgICAgIH0KICAgICAgICBpZiAoKF9mbGFncyAmIFJFQ09SRF9P\nUkRFUkVEKSAhPSAwKSB7CiAgICAgICAgICAgIGlmIChfb3JkZXJlZCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX29yZGVyZWQgPSBuZXcgQXJyYXlMaXN0\nKDUpOwogICAgICAgICAgICBfb3JkZXJlZC5hZGQoc3FsKTsKICAgICAgICB9\nCgogICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBhcHBl\nbmRPcmRlcmluZyhvcmRlciwgYXNjKTsKICAgICAgICBpZiAoc2VsKSB7CiAg\nICAgICAgICAgIGludCBpZHggPSBfc2VsZWN0cy5pbmRleE9mQWxpYXMoc3Fs\nKTsKICAgICAgICAgICAgaWYgKGlkeCA9PSAtMSkgewogICAgICAgICAgICAg\nICAgX3NlbGVjdHMuc2V0QWxpYXMobnVsbElkKCksIHNxbCwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNxbCwgYm9vbGVhbiBhc2MsIGJv\nb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoc3FsLCBhc2Ms\nIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJC\neShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xl\nYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoc3FsLCBhc2MsIGpv\naW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93\nIHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5zLgogICAg\nICovCiAgICBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNxbCwgYm9vbGVhbiBh\nc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAgICAgICBib29sZWFu\nIGFsaWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeSgoT2JqZWN0\nKSBzcWwsIGFzYywgam9pbnMsIHNlbCwgYWxpYXNPcmRlcik7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY2xlYXJPcmRlcmluZygpIHsKICAgICAgICBfb3Jk\nZXJpbmcgPSBudWxsOwogICAgICAgIF9vcmRlcnMgPSAwOwogICAgfQoKICAg\nIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHJlY29yZCB0aGUgc2VsZWN0\nIGxpc3QgaW5kZXhlcyBvZiBpdGVtcyB3ZSBvcmRlciBieS4KICAgICAqLwog\nICAgdm9pZCBzZXRSZWNvcmRPcmRlcmVkSW5kZXhlcyhib29sZWFuIHJlY29y\nZCkgewogICAgICAgIGlmIChyZWNvcmQpCiAgICAgICAgICAgIF9mbGFncyB8\nPSBSRUNPUkRfT1JERVJFRDsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nX29yZGVyZWQgPSBudWxsOwogICAgICAgICAgICBfZmxhZ3MgJj0gflJFQ09S\nRF9PUkRFUkVEOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgaW5kZXhlcyBpbiB0aGUgc2VsZWN0IGxpc3Qgb2YgYWxsIGl0\nZW1zIHdlJ3JlIG9yZGVyaW5nCiAgICAgKiBieSwgb3IgbnVsbCBpZiBub25l\nLiBGb3IgdXNlIHdpdGggdW5pb25zLgogICAgICovCiAgICBMaXN0IGdldE9y\nZGVyZWRJbmRleGVzKCkgewogICAgICAgIGlmIChfb3JkZXJlZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBMaXN0IGlkeHMg\nPSBuZXcgQXJyYXlMaXN0KF9vcmRlcmVkLnNpemUoKSk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBfb3JkZXJlZC5zaXplKCk7IGkrKykKICAgICAg\nICAgICAgaWR4cy5hZGQoTnVtYmVycy52YWx1ZU9mKF9zZWxlY3RzLmluZGV4\nT2YoX29yZGVyZWQuZ2V0KGkpKSkpOwogICAgICAgIHJldHVybiBpZHhzOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlUHJpbWFyeUtleShPYmplY3Qg\nb2lkLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBKREJDU3RvcmUg\nc3RvcmUpIHsKICAgICAgICB3aGVyZVByaW1hcnlLZXkob2lkLCBtYXBwaW5n\nLCBudWxsLCBzdG9yZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgd2hl\ncmUgY29uZGl0aW9ucyBzZXR0aW5nIHRoZSBtYXBwaW5nJ3MgcHJpbWFyeSBr\nZXkgdG8gdGhlIGdpdmVuCiAgICAgKiBvaWQgdmFsdWVzLiBJZiB0aGUgZ2l2\nZW4gbWFwcGluZyBkb2VzIG5vdCB1c2Ugb2lkIHZhbHVlcyBmb3IgaXRzCiAg\nICAgKiBwcmltYXJ5IGtleSwgd2Ugd2lsbCByZWN1cnNpdmVseSBqb2luIHRv\nIGl0cyBzdXBlcmNsYXNzIHVudGlsIHdlIGZpbmQKICAgICAqIGFuIGFuY2Vz\ndG9yIHRoYXQgZG9lcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJl\nUHJpbWFyeUtleShPYmplY3Qgb2lkLCBDbGFzc01hcHBpbmcgbWFwcGluZywg\nSm9pbnMgam9pbnMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAg\nICAgLy8gaWYgdGhpcyBtYXBwaW5nJ3MgaWRlbnRpZmllcnMgaW5jbHVkZSBz\nb21ldGhpbmcgb3RoZXIgdGhhbgogICAgICAgIC8vIHRoZSBwayB2YWx1ZXMs\nIGpvaW4gdG8gc3VwZXIgYW5kIHJlY3Vyc2UKICAgICAgICBpZiAoIW1hcHBp\nbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQoZmFsc2UpKSB7CiAgICAgICAgICAg\nIENsYXNzTWFwcGluZyBzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpOwogICAgICAgICAgICBpZiAoam9pbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3Sm9pbnMoKTsKICAgICAg\nICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNsYXNzKGpvaW5zLCBm\nYWxzZSk7CiAgICAgICAgICAgIHdoZXJlUHJpbWFyeUtleShvaWQsIHN1cCwg\nam9pbnMsIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgQ29sdW1uW10gY29scyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICB3aGVyZShvaWQsIG1hcHBpbmcsIGNvbHMs\nIGNvbHMsIG51bGwsIG51bGwsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwKICAg\nICAgICAgICAgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJl\nRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPYmplY3Qgb2lkLAogICAgICAg\nIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDU3RvcmUgc3RvcmUpIHsKICAg\nICAgICB3aGVyZUZvcmVpZ25LZXkoZmssIG9pZCwgbWFwcGluZywgbnVsbCwg\nc3RvcmUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHdoZXJlIGNvbmRp\ndGlvbnMgc2V0dGluZyB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgdG8gdGhlIGdp\ndmVuCiAgICAgKiBvaWQgdmFsdWVzLgogICAgICoKICAgICAqIEBzZWUgI3do\nZXJlUHJpbWFyeUtleQogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hlcmVG\nb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9iamVjdCBvaWQsCiAgICAgICAg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5zLCBKREJDU3RvcmUg\nc3RvcmUpIHsKICAgICAgICAvLyBpZiB0aGlzIG1hcHBpbmcncyBpZGVudGlm\naWVycyBpbmNsdWRlIHNvbWV0aGluZyBvdGhlciB0aGFuCiAgICAgICAgLy8g\ndGhlIHBrIHZhbHVlcywgb3IgaWYgdGhpcyBmb3JlaWduIGtleSBkb2Vzbid0\nIGxpbmsgdG8gb25seQogICAgICAgIC8vIGlkZW50aWZpZXJzLCBqb2luIHRv\nIHRhYmxlIGFuZCBkbyBhIGdldFByaW1hcnlLZXkKICAgICAgICBpZiAoIW1h\ncHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQoZmFsc2UpIHx8ICFjb250YWlu\nc0FsbAogICAgICAgICAgICAobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1u\ncygpLCBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKSkgewogICAgICAgICAg\nICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpvaW5zID0g\nbmV3Sm9pbnMoKTsKICAgICAgICAgICAgLy8gdHJhdmVyc2UgdG8gZm9yZWln\nbiBrZXkgdGFyZ2V0IG1hcHBpbmcKICAgICAgICAgICAgd2hpbGUgKG1hcHBp\nbmcuZ2V0VGFibGUoKSAhPSBmay5nZXRQcmltYXJ5S2V5VGFibGUoKSkgewog\nICAgICAgICAgICAgICAgaWYgKGpvaW5zID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICAgICAg\nam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNsYXNzKGpvaW5zLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICBtYXBwaW5nID0gbWFwcGluZy5nZXRKb2luYWJs\nZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgICAgIGlmICht\nYXBwaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgam9pbnMgPSBqb2lucy5qb2luKGZrLCBmYWxzZSwgZmFsc2UpOwogICAg\nICAgICAgICB3aGVyZVByaW1hcnlLZXkob2lkLCBtYXBwaW5nLCBqb2lucywg\nc3RvcmUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICBDb2x1bW5bXSBmcm9tQ29scyA9IGZrLmdldENvbHVtbnMoKTsKICAgICAg\nICBDb2x1bW5bXSB0b0NvbHMgPSBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nOwogICAgICAgIENvbHVtbltdIGNvbnN0Q29scyA9IGZrLmdldENvbnN0YW50\nQ29sdW1ucygpOwogICAgICAgIE9iamVjdFtdIGNvbnN0cyA9IGZrLmdldENv\nbnN0YW50cygpOwogICAgICAgIHdoZXJlKG9pZCwgbWFwcGluZywgdG9Db2xz\nLCBmcm9tQ29scywgY29uc3RzLCBjb25zdENvbHMsCiAgICAgICAgICAgIGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKSwgc3RvcmUpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGZsdXNoIHRoZSBvaWQgdmFsdWVz\nIGFzIHdoZXJlIGNvbmRpdGlvbnMgdG8gdGhlCiAgICAgKiBnaXZlbiBjb2x1\nbW5zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hlcmUoT2JqZWN0IG9p\nZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIENvbHVtbltdIHRvQ29scywKICAg\nICAgICBDb2x1bW5bXSBmcm9tQ29scywgT2JqZWN0W10gdmFscywgQ29sdW1u\nW10gY29uc3RDb2xzLCBQYXRoSm9pbnMgcGosCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVtYmVkID0gbWFwcGlu\nZy5nZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVtYmVkICE9\nIG51bGwpIHsKICAgICAgICAgICAgd2hlcmUob2lkLCBlbWJlZC5nZXRGaWVs\nZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBpbmcoKSwKICAgICAgICAgICAg\nICAgIHRvQ29scywgZnJvbUNvbHMsIHZhbHMsIGNvbnN0Q29scywgcGosIHN0\nb3JlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nLy8gb25seSBib3RoZXIgdG8gcGFjayBwayB2YWx1ZXMgaW50byBhcnJheSBp\nZiBhcHAgaWQKICAgICAgICBPYmplY3RbXSBwa3MgPSBudWxsOwogICAgICAg\nIGlmIChtYXBwaW5nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGlu\nZy5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgcGtzID0gQXBwbGljYXRp\nb25JZHMudG9QS1ZhbHVlcyhvaWQsIG1hcHBpbmcpOwoKICAgICAgICBTUUxC\ndWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgSm9p\nbmFibGUgam9pbjsKICAgICAgICBPYmplY3QgdmFsOwogICAgICAgIGludCBj\nb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0b0NvbHMu\nbGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAgICAgICAgICAgaWYgKHBrcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgdmFsID0gKG9pZCA9PSBudWxsKSA/\nIG51bGwgOiBOdW1iZXJzLnZhbHVlT2YoKChJZCkgb2lkKS5nZXRJZCgpKTsK\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBtdXN0IGJl\nIGFwcCBpZGVudGl0eTsgdXNlIHBrIGluZGV4IHRvIGdldCBjb3JyZWN0IHBr\nIHZhbHVlCiAgICAgICAgICAgICAgICBqb2luID0gbWFwcGluZy5hc3NlcnRK\nb2luYWJsZSh0b0NvbHNbaV0pOwogICAgICAgICAgICAgICAgdmFsID0gcGtz\nW21hcHBpbmcuZ2V0RmllbGQoam9pbi5nZXRGaWVsZEluZGV4KCkpLgogICAg\nICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlJbmRleCgpXTsKICAgICAg\nICAgICAgICAgIHZhbCA9IGpvaW4uZ2V0Sm9pblZhbHVlKHZhbCwgdG9Db2xz\nW2ldLCBzdG9yZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChj\nb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgICAgICBidWYuYXBwZW5kKGdldENvbHVtbkFsaWFzKGZyb21D\nb2xzW2ldLCBwaikpOwogICAgICAgICAgICBpZiAodmFsID09IG51bGwpCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAg\nICAgICAgICBidWYuYXBwZW5kVmFsdWUodmFsLCBmcm9tQ29sc1tpXSk7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoY29uc3RDb2xzICE9IG51bGwgJiYgY29u\nc3RDb2xzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb25zdENvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAg\nICAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29uc3RDb2xzW2ldLCBwaikpOwoKICAg\nICAgICAgICAgICAgIGlmICh2YWxzW2ldID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiIElTICIpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKHZhbHNbaV0sIGNvbnN0\nQ29sc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHdo\nZXJlKGJ1ZiwgcGopOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0byBz\nZWUgaWYgdGhlIGdpdmVuIHNldCBvZiBjb2x1bW5zIGNvbnRhaW5zIGFsbCB0\naGUKICAgICAqIGNvbHVtbnMgaW4gdGhlIGdpdmVuIHBvdGVudGlhbCBzdWJz\nZXQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gY29udGFp\nbnNBbGwoQ29sdW1uW10gc2V0LCBDb2x1bW5bXSBzdWIpIHsKICAgICAgICBp\nZiAoc3ViLmxlbmd0aCA+IHNldC5sZW5ndGgpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgLy8gdGhpcyBpcyBvYnZpb3VzbHkgbl4yLCBi\ndXQgdGhlIG51bWJlciBvZiBjb2x1bW5zIHNob3VsZCBiZSBpbgogICAgICAg\nIC8vIHRoZSAxLTIgcmFuZ2UsIHNvIG5vIGJpZ2dpZQogICAgICAgIGJvb2xl\nYW4gZm91bmQgPSB0cnVlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc3ViLmxlbmd0aCAmJiBmb3VuZDsgaSsrKSB7CiAgICAgICAgICAgIGZvdW5k\nID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgc2V0\nLmxlbmd0aCAmJiAhZm91bmQ7IGorKykKICAgICAgICAgICAgICAgIGZvdW5k\nID0gc3ViW2ldID09IHNldFtqXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGZvdW5kOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKEpvaW5zIGpv\naW5zKSB7CiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAgICAgICAg\nIHdoZXJlKChTdHJpbmcpIG51bGwsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgd2hlcmUo\nc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdo\nZXJlKFNRTEJ1ZmZlciBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgd2hl\ncmUoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhlIFdIRVJF\nIGNsYXVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlKFNRTEJ1\nZmZlciBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQg\ndG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKHNxbCA9PSBudWxsIHx8IHNx\nbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYg\nKF93aGVyZSA9PSBudWxsKQogICAgICAgICAgICBfd2hlcmUgPSBuZXcgU1FM\nQnVmZmVyKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICghX3doZXJlLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgX3doZXJlLmFwcGVuZCgiIEFORCAiKTsKICAg\nICAgICBfd2hlcmUuYXBwZW5kKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgd2hlcmUoU3RyaW5nIHNxbCkgewogICAgICAgIHdoZXJlKHNxbCwgKEpv\naW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShTdHJp\nbmcgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIHdoZXJlKHNxbCwgZ2V0\nSm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBXSEVSRSBjbGF1c2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZShTdHJpbmcgc3FsLCBQYXRo\nSm9pbnMgcGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4u\nLgogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNxbCkpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF93aGVyZSA9PSBudWxsKQog\nICAgICAgICAgICBfd2hlcmUgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAg\nICAgICBlbHNlIGlmICghX3doZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAg\nX3doZXJlLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBfd2hlcmUuYXBwZW5k\nKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFNRTEJ1ZmZl\nciBzcWwpIHsKICAgICAgICBoYXZpbmcoc3FsLCAoSm9pbnMpIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTUUxCdWZmZXIgc3FsLCBK\nb2lucyBqb2lucykgewogICAgICAgIGhhdmluZyhzcWwsIGdldEpvaW5zKGpv\naW5zLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdp\ndmVuIGNvbmRpdGlvbiB0byB0aGUgSEFWSU5HIGNsYXVzZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGhhdmluZyhTUUxCdWZmZXIgc3FsLCBQYXRoSm9p\nbnMgcGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4uLgog\nICAgICAgIGlmIChzcWwgPT0gbnVsbCB8fCBzcWwuaXNFbXB0eSgpKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChfaGF2aW5nID09IG51bGwp\nCiAgICAgICAgICAgIF9oYXZpbmcgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsK\nICAgICAgICBlbHNlIGlmICghX2hhdmluZy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIF9oYXZpbmcuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF9oYXZpbmcu\nYXBwZW5kKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFN0\ncmluZyBzcWwpIHsKICAgICAgICBoYXZpbmcoc3FsLCAoSm9pbnMpIG51bGwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTdHJpbmcgc3FsLCBK\nb2lucyBqb2lucykgewogICAgICAgIGhhdmluZyhzcWwsIGdldEpvaW5zKGpv\naW5zLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdp\ndmVuIGNvbmRpdGlvbiB0byB0aGUgSEFWSU5HIGNsYXVzZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGhhdmluZyhTdHJpbmcgc3FsLCBQYXRoSm9pbnMg\ncGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4uLgogICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNxbCkpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgaWYgKF9oYXZpbmcgPT0gbnVsbCkKICAgICAg\nICAgICAgX2hhdmluZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAg\nIGVsc2UgaWYgKCFfaGF2aW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAgX2hh\ndmluZy5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgX2hhdmluZy5hcHBlbmQo\nc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFNRTEJ1ZmZl\nciBzcWwpIHsKICAgICAgICBncm91cEJ5KHNxbCwgKEpvaW5zKSBudWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFNRTEJ1ZmZlciBzcWws\nIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nOwogICAgICAgIGdyb3VwQnlBcHBlbmQoc3FsLmdldFNRTCgpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KFN0cmluZyBzcWwpIHsKICAgICAg\nICBncm91cEJ5KHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBncm91cEJ5KFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGdyb3VwQnlB\ncHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENv\nbHVtbiBjb2wpIHsKICAgICAgICBncm91cEJ5KGNvbCwgbnVsbCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW4gY29sLCBKb2lucyBq\nb2lucykgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5z\nLCB0cnVlKTsKICAgICAgICBncm91cEJ5QXBwZW5kKGdldENvbHVtbkFsaWFz\nKGNvbCwgcGopKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENv\nbHVtbltdIGNvbHMpIHsKICAgICAgICBncm91cEJ5KGNvbHMsIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uW10gY29scywg\nSm9pbnMgam9pbnMpIHsKICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lu\ncyhqb2lucywgdHJ1ZSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdyb3VwQnlBcHBlbmQo\nZ2V0Q29sdW1uQWxpYXMoY29sc1tpXSwgcGopKTsKICAgICAgICB9CiAgICB9\nCiAgICAKICAgIHByaXZhdGUgdm9pZCBncm91cEJ5QXBwZW5kKFN0cmluZyBz\ncWwpIHsKICAgICAgICBpZiAoX2dyb3VwZWQgPT0gbnVsbCB8fCAhX2dyb3Vw\nZWQuY29udGFpbnMoc3FsKSkgewogICAgICAgICAgICBpZiAoX2dyb3VwaW5n\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIF9ncm91cGluZyA9IG5ldyBT\nUUxCdWZmZXIoX2RpY3QpOwogICAgICAgICAgICAgICAgX2dyb3VwZWQgPSBu\nZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgX2dyb3VwaW5nLmFwcGVuZCgiLCAiKTsKCiAgICAgICAgICAgIF9n\ncm91cGluZy5hcHBlbmQoc3FsKTsKICAgICAgICAgICAgX2dyb3VwZWQuYWRk\nKHNxbCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3Vw\nQnkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIGdyb3VwQnkobWFwcGluZywgc3ViY2xhc3Nlcywg\nc3RvcmUsIGZldGNoLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBn\ncm91cEJ5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3Nlcywg\nSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgLy8gd2UgaW1wbGVt\nZW50IHRoaXMgYnkgcHV0dGluZyBvdXJzZWx2ZXMgaW50byBncm91cGluZyBt\nb2RlLCB3aGVyZQogICAgICAgIC8vIGFsbCBzZWxlY3QgaW52b2NhdGlvbnMg\nYXJlIHJlLXJvdXRlZCB0byBncm91cC1ieSBpbnZvY2F0aW9ucyBpbnN0ZWFk\nLgogICAgICAgIC8vIHRoaXMgYWxsb3dzIHVzIHRvIHV0aWxpemUgdGhlIHNh\nbWUgc2VsZWN0IEFQSXMgb2YgdGhlIHN0b3JlIG1hbmFnZXIKICAgICAgICAv\nLyBhbmQgYWxsIHRoZSBtYXBwaW5nIHN0cmF0ZWdpZXMsIHJhdGhlciB0aGFu\nIGhhdmluZyB0byBjcmVhdGUgCiAgICAgICAgLy8gZXF1aXZhbGVudCBBUElz\nIGFuZCBkdXBsaWNhdGUgbG9naWMgZm9yIGdyb3VwaW5nCiAgICAgICAgYm9v\nbGVhbiB3YXNHcm91cGluZyA9IGlzR3JvdXBpbmcoKTsKICAgICAgICBfZmxh\nZ3MgfD0gR1JPVVBJTkc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2Vs\nZWN0KG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgCiAgICAg\nICAgICAgICAgICBFYWdlckZldGNoTW9kZXMuRUFHRVJfTk9ORSwgam9pbnMp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICghd2FzR3Jv\ndXBpbmcpCiAgICAgICAgICAgICAgICBfZmxhZ3MgJj0gfkdST1VQSU5HOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgd2UncmUg\naW4gZ3JvdXAgbW9kZSwgd2hlcmUgYW55IHNlbGVjdCBpcyBjaGFuZ2VkIHRv\nIGEgZ3JvdXAtYnkKICAgICAqIGNhbGwuCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiBpc0dyb3VwaW5nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdz\nICYgR1JPVVBJTkcpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGpvaW5zIHRvIHVzZSBmb3IgY29sdW1uIGFsaWFzZXMsIGV0Yy4K\nICAgICAqCiAgICAgKiBAcGFyYW0gam9pbnMgam9pbnMgZ2l2ZW4gYnkgdGhl\nIHVzZXIKICAgICAqIEByZXR1cm4gdGhlIGpvaW5zIHRvIHVzZSBmb3IgYWxp\nYXNlcywgZXRjCiAgICAgKi8KICAgIHByaXZhdGUgUGF0aEpvaW5zIGdldEpv\naW5zKEpvaW5zIGpvaW5zLCBib29sZWFuIHJlY29yZCkgewogICAgICAgIFBh\ndGhKb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwogICAgICAgIGJvb2xl\nYW4gcHJlID0gKHBqID09IG51bGwgfHwgIXBqLmlzRGlydHkoKSkKICAgICAg\nICAgICAgJiYgX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVKb2lucy5pc0Vt\ncHR5KCk7CiAgICAgICAgaWYgKHByZSkKICAgICAgICAgICAgcGogPSAoUGF0\naEpvaW5zKSBfcHJlSm9pbnMucGVlaygpOwoKICAgICAgICBpZiAocGogPT0g\nbnVsbCB8fCAhcGouaXNEaXJ0eSgpKQogICAgICAgICAgICBwaiA9IF9qb2lu\nczsKICAgICAgICBlbHNlIGlmICghcHJlKSB7CiAgICAgICAgICAgIGlmICgo\nX2ZsYWdzICYgT1VURVIpICE9IDApCiAgICAgICAgICAgICAgICBwaiA9IChQ\nYXRoSm9pbnMpIG91dGVyKHBqKTsKICAgICAgICAgICAgaWYgKHJlY29yZCkg\newogICAgICAgICAgICAgICAgaWYgKCFwai5pc0VtcHR5KCkpCiAgICAgICAg\nICAgICAgICAgICAgcmVtb3ZlUGFyZW50Sm9pbnMocGopOwogICAgICAgICAg\nICAgICAgaWYgKCFwai5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAg\nICByZW1vdmVKb2luc0Zyb21TdWJzZWxlY3RzKHBqKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9qb2lucyA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoX2pvaW5zLmpvaW5zKCkgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgX2pvaW5zLnNldEpvaW5zKG5ldyBKb2lu\nU2V0KHBqLmpvaW5zKCkpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9qb2lucy5qb2lucygpLmFkZEFsbChw\nai5qb2lucygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gcGo7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZW1vdmUgYW55IGpvaW5zIGFscmVhZHkgaW4gb3VyIHBhcmVudCBz\nZWxlY3QgZnJvbSB0aGUgZ2l2ZW4gbm9uLWVtcHR5CiAgICAgKiBqb2luIHNl\ndC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZVBhcmVudEpvaW5z\nKFBhdGhKb2lucyBwaikgewogICAgICAgIGlmIChfcGFyZW50ID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX3BhcmVudC5fam9p\nbnMgIT0gbnVsbCAmJiAhX3BhcmVudC5fam9pbnMuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9IGZhbHNlOwogICAgICAgICAg\nICBpZiAoIV9yZW1vdmVkQWxpYXNGcm9tUGFyZW50LmlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgIHJlbW92ZWQgPSBfcGFyZW50Ll9qb2lucy5qb2lucygp\nLnJlbW92ZUFsbChwai5qb2lucygpKTsKICAgICAgICAgICAgaWYgKCFyZW1v\ndmVkKQogICAgICAgICAgICAgICAgcGouam9pbnMoKS5yZW1vdmVBbGwoX3Bh\ncmVudC5fam9pbnMuam9pbnMoKSk7CiAgICAgICAgfQogICAgICAgIGlmICgh\ncGouaXNFbXB0eSgpKQogICAgICAgICAgICBfcGFyZW50LnJlbW92ZVBhcmVu\ndEpvaW5zKHBqKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUg\nZ2l2ZW4gbm9uLWVtcHR5IGpvaW5zIGZyb20gdGhlIGpvaW5zIG9mIG91ciBz\ndWJzZWxlY3RzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlSm9p\nbnNGcm9tU3Vic2VsZWN0cyhQYXRoSm9pbnMgcGopIHsKICAgICAgICBpZiAo\nX3N1YnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIFNlbGVjdEltcGwgc3ViOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgc3ViID0gKFNl\nbGVjdEltcGwpIF9zdWJzZWxzLmdldChpKTsKICAgICAgICAgICAgaWYgKHN1\nYi5fam9pbnMgIT0gbnVsbCAmJiAhc3ViLl9qb2lucy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICBzdWIuX2pvaW5zLmpvaW5zKCkucmVtb3ZlQWxsKHBq\nLmpvaW5zKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0\nRXhlY3V0b3Igd2hlcmVDbG9uZShpbnQgc2VscykgewogICAgICAgIGlmIChz\nZWxzIDwgMSkKICAgICAgICAgICAgc2VscyA9IDE7CgogICAgICAgIFNlbGVj\ndFtdIGNsb25lcyA9IG51bGw7CiAgICAgICAgU2VsZWN0SW1wbCBzZWw7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZWxzOyBpKyspIHsKICAgICAg\nICAgICAgc2VsID0gKFNlbGVjdEltcGwpIF9jb25mLmdldFNRTEZhY3RvcnlJ\nbnN0YW5jZSgpLm5ld1NlbGVjdCgpOwogICAgICAgICAgICBzZWwuX2ZsYWdz\nID0gX2ZsYWdzOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5BR0dSRUdB\nVEU7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfk9VVEVSOwogICAgICAg\nICAgICBzZWwuX2ZsYWdzICY9IH5MUlM7CiAgICAgICAgICAgIHNlbC5fZmxh\nZ3MgJj0gfkVBR0VSX1RPX09ORTsKICAgICAgICAgICAgc2VsLl9mbGFncyAm\nPSB+RUFHRVJfVE9fTUFOWTsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+\nRk9SQ0VfQ09VTlQ7CiAgICAgICAgICAgIHNlbC5fam9pblN5bnRheCA9IF9q\nb2luU3ludGF4OwogICAgICAgICAgICBpZiAoX2FsaWFzZXMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHNlbC5fYWxpYXNlcyA9IG5ldyBIYXNoTWFwKF9h\nbGlhc2VzKTsKICAgICAgICAgICAgaWYgKF90YWJsZXMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHNlbC5fdGFibGVzID0gbmV3IFRyZWVNYXAoX3RhYmxl\ncyk7CiAgICAgICAgICAgIGlmIChfam9pbnMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHNlbC5fam9pbnMgPSBfam9pbnMuY2xvbmUoc2VsKTsKICAgICAg\nICAgICAgaWYgKF93aGVyZSAhPSBudWxsKQogICAgICAgICAgICAgICAgc2Vs\nLl93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX3doZXJlKTsKICAgICAgICAgICAg\naWYgKF9mcm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbC5fZnJv\nbSA9IChTZWxlY3RJbXBsKSBfZnJvbS53aGVyZUNsb25lKDEpOwogICAgICAg\nICAgICAgICAgc2VsLl9mcm9tLl9vdXRlciA9IHNlbDsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoX3N1YnNlbHMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgc2VsLl9zdWJzZWxzID0gbmV3IEFycmF5TGlzdChfc3Vic2Vs\ncy5zaXplKCkpOwogICAgICAgICAgICAgICAgU2VsZWN0SW1wbCBzdWIsIHNl\nbFN1YjsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgX3N1\nYnNlbHMuc2l6ZSgpOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBzdWIg\nPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0KGopOwogICAgICAgICAgICAg\nICAgICAgIHNlbFN1YiA9IChTZWxlY3RJbXBsKSBzdWIuZnVsbENsb25lKDEp\nOwogICAgICAgICAgICAgICAgICAgIHNlbFN1Yi5fcGFyZW50ID0gc2VsOwog\nICAgICAgICAgICAgICAgICAgIHNlbFN1Yi5fc3ViUGF0aCA9IHN1Yi5fc3Vi\nUGF0aDsKICAgICAgICAgICAgICAgICAgICBzZWwuX3N1YnNlbHMuYWRkKHNl\nbFN1Yik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbC5fd2hlcmUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsLl93aGVyZS5yZXBs\nYWNlKHN1Yiwgc2VsU3ViKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKHNlbHMgPT0gMSkKICAgICAgICAgICAg\nICAgIHJldHVybiBzZWw7CiAgICAgICAgICAgIGlmIChjbG9uZXMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGNsb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107\nCiAgICAgICAgICAgIGNsb25lc1tpXSA9IHNlbDsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1Vu\naW9uKGNsb25lcyk7CiAgICB9CgogICAgcHVibGljIFNlbGVjdEV4ZWN1dG9y\nIGZ1bGxDbG9uZShpbnQgc2VscykgewogICAgICAgIGlmIChzZWxzIDwgMSkK\nICAgICAgICAgICAgc2VscyA9IDE7CgogICAgICAgIFNlbGVjdFtdIGNsb25l\ncyA9IG51bGw7CiAgICAgICAgU2VsZWN0SW1wbCBzZWw7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzZWxzOyBpKyspIHsKICAgICAgICAgICAgc2Vs\nID0gKFNlbGVjdEltcGwpIHdoZXJlQ2xvbmUoMSk7CiAgICAgICAgICAgIHNl\nbC5fZmxhZ3MgPSBfZmxhZ3M7CiAgICAgICAgICAgIHNlbC5fZXhwZWN0ZWRS\nZXN1bHRDb3VudCA9IF9leHBlY3RlZFJlc3VsdENvdW50OwogICAgICAgICAg\nICBzZWwuX3NlbGVjdHMuYWRkQWxsKF9zZWxlY3RzKTsKICAgICAgICAgICAg\naWYgKF9vcmRlcmluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2VsLl9v\ncmRlcmluZyA9IG5ldyBTUUxCdWZmZXIoX29yZGVyaW5nKTsKICAgICAgICAg\nICAgc2VsLl9vcmRlcnMgPSBfb3JkZXJzOwogICAgICAgICAgICBpZiAoX2dy\nb3VwaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2dyb3VwaW5n\nID0gbmV3IFNRTEJ1ZmZlcihfZ3JvdXBpbmcpOwogICAgICAgICAgICBpZiAo\nX2hhdmluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2VsLl9oYXZpbmcg\nPSBuZXcgU1FMQnVmZmVyKF9oYXZpbmcpOwogICAgICAgICAgICBpZiAoX2Zy\nb20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsLl9mcm9tID0gKFNl\nbGVjdEltcGwpIF9mcm9tLmZ1bGxDbG9uZSgxKTsKICAgICAgICAgICAgICAg\nIHNlbC5fZnJvbS5fb3V0ZXIgPSBzZWw7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGlmIChzZWxzID09IDEpCiAgICAgICAgICAgICAgICByZXR1cm4g\nc2VsOwogICAgICAgICAgICBpZiAoY2xvbmVzID09IG51bGwpCiAgICAgICAg\nICAgICAgICBjbG9uZXMgPSBuZXcgU2VsZWN0W3NlbHNdOwogICAgICAgICAg\nICBjbG9uZXNbaV0gPSBzZWw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdVbmlvbihjbG9uZXMp\nOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRvciBlYWdlckNsb25l\nKEZpZWxkTWFwcGluZyBrZXksIGludCBlYWdlclR5cGUsCiAgICAgICAgYm9v\nbGVhbiB0b01hbnksIGludCBzZWxzKSB7CiAgICAgICAgaWYgKGVhZ2VyVHlw\nZSA9PSBFQUdFUl9PVVRFUgogICAgICAgICAgICAmJiBfam9pblN5bnRheCA9\nPSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoX2VhZ2VyS2V5cyAhPSBudWxs\nICYmIF9lYWdlcktleXMuY29udGFpbnMoa2V5KSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIC8vIGdsb2JhbCBzZXQgb2YgZWFnZXIga2V5\ncwogICAgICAgIGlmIChfZWFnZXJLZXlzID09IG51bGwpCiAgICAgICAgICAg\nIF9lYWdlcktleXMgPSBuZXcgSGFzaFNldCgpOwogICAgICAgIF9lYWdlcktl\neXMuYWRkKGtleSk7CgogICAgICAgIFNlbGVjdEV4ZWN1dG9yIHNlbDsKICAg\nICAgICBpZiAoZWFnZXJUeXBlICE9IEVBR0VSX1BBUkFMTEVMKSB7CiAgICAg\nICAgICAgIGlmICh0b01hbnkpCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0g\nRUFHRVJfVE9fTUFOWTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgX2ZsYWdzIHw9IEVBR0VSX1RPX09ORTsKICAgICAgICAgICAgc2VsID0g\ndGhpczsKICAgICAgICB9IGVsc2UgaWYgKHNlbHMgPCAyKQogICAgICAgICAg\nICBzZWwgPSBwYXJhbGxlbENsb25lKCk7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIFNlbGVjdFtdIGNsb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2xvbmVzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgY2xvbmVzW2ldID0gcGFyYWxsZWxDbG9u\nZSgpOwogICAgICAgICAgICBzZWwgPSBfY29uZi5nZXRTUUxGYWN0b3J5SW5z\ndGFuY2UoKS5uZXdVbmlvbihjbG9uZXMpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKF9lYWdlciA9PSBudWxsKQogICAgICAgICAgICBfZWFnZXIgPSBuZXcg\nSGFzaE1hcCgpOwogICAgICAgIF9lYWdlci5wdXQodG9FYWdlcktleShrZXks\nIGdldEpvaW5zKG51bGwsIGZhbHNlKSksIHNlbCk7CiAgICAgICAgcmV0dXJu\nIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNsb25lIG9m\nIHRoaXMgc2VsZWN0IGZvciB1c2UgaW4gZWFnZXIgcGFyYWxsZWwgc2VsZWN0\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIHBhcmFsbGVsQ2xv\nbmUoKSB7CiAgICAgICAgU2VsZWN0SW1wbCBzZWwgPSAoU2VsZWN0SW1wbCkg\nd2hlcmVDbG9uZSgxKTsKICAgICAgICBzZWwuX2ZsYWdzICY9IH5OT05BVVRP\nX0RJU1RJTkNUOwogICAgICAgIHNlbC5fZWFnZXJLZXlzID0gX2VhZ2VyS2V5\nczsKICAgICAgICBpZiAoX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVKb2lu\ncy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgc2VsLl9wcmVKb2lucyA9IG5l\ndyBTdGFjaygpOwogICAgICAgICAgICBzZWwuX3ByZUpvaW5zLnB1c2goKChT\nZWxlY3RKb2lucykgX3ByZUpvaW5zLnBlZWsoKSkuCiAgICAgICAgICAgICAg\nICBjbG9uZShzZWwpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB2aWV3IG9mIGVhZ2VyIHNl\nbGVjdHMuIE1heSBiZSBudWxsLgogICAgICovCiAgICBwdWJsaWMgTWFwIGdl\ndEVhZ2VyTWFwKCkgewogICAgICAgIHJldHVybiBfZWFnZXI7CiAgICB9Cgog\nICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIGdldEVhZ2VyKEZpZWxkTWFwcGlu\nZyBrZXkpIHsKICAgICAgICBpZiAoX2VhZ2VyID09IG51bGwgfHwgIV9lYWdl\ncktleXMuY29udGFpbnMoa2V5KSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgcmV0dXJuIChTZWxlY3RFeGVjdXRvcikgX2VhZ2VyLmdldCh0\nb0VhZ2VyS2V5KGtleSwgZ2V0Sm9pbnMobnVsbCwKICAgICAgICAgICAgZmFs\nc2UpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVhZ2Vy\nIGtleSB0byB1c2UgZm9yIHRoZSB1c2VyLWdpdmVuIGtleS4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IHRvRWFnZXJLZXkoRmllbGRNYXBw\naW5nIGtleSwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYgKHBqID09IG51\nbGwgfHwgcGoucGF0aCgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBr\nZXk7CiAgICAgICAgcmV0dXJuIG5ldyBLZXkocGoucGF0aCgpLnRvU3RyaW5n\nKCksIGtleSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG5ld0pvaW5zKCkg\newogICAgICAgIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5z\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBTZWxlY3RKb2lucyBzaiA9IChT\nZWxlY3RKb2lucykgX3ByZUpvaW5zLnBlZWsoKTsKICAgICAgICAgICAgcmV0\ndXJuIHNqLmNsb25lKHRoaXMpOwogICAgICAgIH0KICAgICAgICAvLyByZXR1\ncm4gdGhpcyBmb3IgZWZmaWNpZW5jeSBpbiBjYXNlIG5vIGpvaW5zIGVuZCB1\ncCBiZWluZyBtYWRlCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAg\ncHVibGljIEpvaW5zIG5ld091dGVySm9pbnMoKSB7CiAgICAgICAgcmV0dXJu\nICgoUGF0aEpvaW5zKSBuZXdKb2lucygpKS5zZXRPdXRlcih0cnVlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmQoU1FMQnVmZmVyIGJ1ZiwgSm9p\nbnMgam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCB8fCBqb2lu\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYg\nKCFidWYuaXNFbXB0eSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5E\nICIpOwogICAgICAgIEpvaW4gam9pbiA9IG51bGw7CiAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSAoKFBhdGhKb2lucykgam9pbnMpLmpvaW5zKCkuam9p\nbkl0ZXJhdG9yKCk7CiAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgc3dpdGNoIChfam9pblN5bnRheCkgewogICAgICAgICAgICAgICAgY2Fz\nZSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMOgogICAgICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoX2RpY3QudG9UcmFkaXRpb25hbEpvaW4o\nam9pbikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKb2luU3ludGF4ZXMuU1lOVEFYX0RBVEFCQVNFOgogICAg\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2RpY3QudG9OYXRpdmVKb2lu\nKGpvaW4pKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIEFORCAiKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEpv\naW5zIGFuZChKb2lucyBqb2luczEsIEpvaW5zIGpvaW5zMikgewogICAgICAg\nIHJldHVybiBhbmQoKFBhdGhKb2lucykgam9pbnMxLCAoUGF0aEpvaW5zKSBq\nb2luczIsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tYmluZSB0\naGUgZ2l2ZW4gam9pbnMuCiAgICAgKi8KICAgIHByaXZhdGUgU2VsZWN0Sm9p\nbnMgYW5kKFBhdGhKb2lucyBqMSwgUGF0aEpvaW5zIGoyLCBib29sZWFuIG51\nbGxKb2lucykgewogICAgICAgIGlmICgoajEgPT0gbnVsbCB8fCBqMS5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICYmIChqMiA9PSBudWxsIHx8IGoyLmlzRW1w\ndHkoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTZWxl\nY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKICAgICAgICBp\nZiAoajEgPT0gbnVsbCB8fCBqMS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\naWYgKG51bGxKb2lucykKICAgICAgICAgICAgICAgIHNqLnNldEpvaW5zKGoy\nLmpvaW5zKCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBz\nai5zZXRKb2lucyhuZXcgSm9pblNldChqMi5qb2lucygpKSk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgSm9pblNldCBzZXQ7CiAgICAgICAgICAg\nIGlmIChudWxsSm9pbnMpCiAgICAgICAgICAgICAgICBzZXQgPSBqMS5qb2lu\ncygpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXQgPSBu\nZXcgSm9pblNldChqMS5qb2lucygpKTsKCiAgICAgICAgICAgIGlmIChqMiAh\nPSBudWxsICYmICFqMi5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBzZXQu\nYWRkQWxsKGoyLmpvaW5zKCkpOwogICAgICAgICAgICBzai5zZXRKb2lucyhz\nZXQpOwogICAgICAgIH0KCiAgICAgICAgLy8gbnVsbCBwcmV2aW91cyBqb2lu\nczsgYWxsIGFyZSBjb21iaW5lZCBpbnRvIHRoaXMgb25lCiAgICAgICAgaWYg\nKG51bGxKb2lucyAmJiBqMSAhPSBudWxsKQogICAgICAgICAgICBqMS5udWxs\nSm9pbnMoKTsKICAgICAgICBpZiAobnVsbEpvaW5zICYmIGoyICE9IG51bGwp\nCiAgICAgICAgICAgIGoyLm51bGxKb2lucygpOwoKICAgICAgICByZXR1cm4g\nc2o7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG9yKEpvaW5zIGpvaW5zMSwg\nSm9pbnMgam9pbnMyKSB7CiAgICAgICAgUGF0aEpvaW5zIGoxID0gKFBhdGhK\nb2lucykgam9pbnMxOwogICAgICAgIFBhdGhKb2lucyBqMiA9IChQYXRoSm9p\nbnMpIGpvaW5zMjsKCiAgICAgICAgLy8gaWYgbm8gY29tbW9uIGpvaW5zLCBy\nZXR1cm4gbnVsbDsgaWYgb25lIHNpZGUgb2YgdGhlIG9yIGNsYXVzZSBoYXMK\nICAgICAgICAvLyBkaWZmZXJlbnQgam9pbnMgdGhhbiB0aGUgb3RoZXIsIHRo\nZW4gd2UgbmVlZCB0byB1c2UgZGlzdGluY3QKICAgICAgICBib29sZWFuIGox\nRW1wdHkgPSBqMSA9PSBudWxsIHx8IGoxLmlzRW1wdHkoKTsKICAgICAgICBi\nb29sZWFuIGoyRW1wdHkgPSBqMiA9PSBudWxsIHx8IGoyLmlzRW1wdHkoKTsK\nICAgICAgICBpZiAoajFFbXB0eSB8fCBqMkVtcHR5KSB7CiAgICAgICAgICAg\nIGlmIChqMUVtcHR5ICYmICFqMkVtcHR5KSB7CiAgICAgICAgICAgICAgICBj\nb2xsZWN0T3V0ZXJKb2lucyhqMik7CiAgICAgICAgICAgICAgICBpZiAoIWoy\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gSU1Q\nTElDSVRfRElTVElOQ1Q7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoajJFbXB0\neSAmJiAhajFFbXB0eSkgewogICAgICAgICAgICAgICAgY29sbGVjdE91dGVy\nSm9pbnMoajEpOwogICAgICAgICAgICAgICAgaWYgKCFqMS5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJ\nTkNUOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgYWxsIGNvbW1vbiBqb2lucywgbW92\nZSBhbGwgam9pbnMgdG8gcmV0dXJuZWQgaW5zdGFuY2UKICAgICAgICBTZWxl\nY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKICAgICAgICBp\nZiAoajEuam9pbnMoKS5lcXVhbHMoajIuam9pbnMoKSkpIHsKICAgICAgICAg\nICAgc2ouc2V0Sm9pbnMoajEuam9pbnMoKSk7CiAgICAgICAgICAgIGoxLm51\nbGxKb2lucygpOwogICAgICAgICAgICBqMi5udWxsSm9pbnMoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBKb2luU2V0IGNvbW1vbkpvaW5zID0g\nbmV3IEpvaW5TZXQoajEuam9pbnMoKSk7CiAgICAgICAgICAgIGNvbW1vbkpv\naW5zLnJldGFpbkFsbChqMi5qb2lucygpKTsKICAgICAgICAgICAgaWYgKCFj\nb21tb25Kb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIC8vIHB1\ndCBjb21tb24gam9pbnMgaW4gcmV0dXJuZWQgaW5zdGFuY2U7IHJlbW92ZSB0\naGVtIGZyb20KICAgICAgICAgICAgICAgIC8vIGVhY2ggZ2l2ZW4gaW5zdGFu\nY2UKICAgICAgICAgICAgICAgIHNqLnNldEpvaW5zKGNvbW1vbkpvaW5zKTsK\nICAgICAgICAgICAgICAgIGoxLmpvaW5zKCkucmVtb3ZlQWxsKGNvbW1vbkpv\naW5zKTsKICAgICAgICAgICAgICAgIGoyLmpvaW5zKCkucmVtb3ZlQWxsKGNv\nbW1vbkpvaW5zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2xsZWN0\nT3V0ZXJKb2lucyhqMSk7CiAgICAgICAgICAgIGNvbGxlY3RPdXRlckpvaW5z\nKGoyKTsKCiAgICAgICAgICAgIC8vIGlmIG9uZSBzaWRlIG9mIHRoZSBvciBj\nbGF1c2UgaGFzIGRpZmZlcmVudCBqb2lucyB0aGFuIHRoZSBvdGhlciwKICAg\nICAgICAgICAgLy8gdGhlbiB3ZSBuZWVkIHRvIHVzZSBkaXN0aW5jdAogICAg\nICAgICAgICBpZiAoIWoxLmlzRW1wdHkoKSB8fCAhajIuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gc2o7CiAgICB9CgogICAgcHVibGlj\nIEpvaW5zIG91dGVyKEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKF9qb2lu\nU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwgfHwg\nam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwoKICAg\nICAgICAvLyByZWNvcmQgdGhhdCB0aGlzIGlzIGFuIG91dGVyIGpvaW4gc2V0\nLCBldmVuIGlmIGl0J3MgZW1wdHkKICAgICAgICBQYXRoSm9pbnMgcGogPSAo\nKFBhdGhKb2lucykgam9pbnMpLnNldE91dGVyKHRydWUpOwogICAgICAgIGlm\nIChwai5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBwajsKCiAgICAg\nICAgSm9pbiBqb2luOwogICAgICAgIEpvaW4gcmVjOwogICAgICAgIGJvb2xl\nYW4gaGFzSm9pbnMgPSBfam9pbnMgIT0gbnVsbCAmJiBfam9pbnMuam9pbnMo\nKSAhPSBudWxsOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGouam9p\nbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChq\nb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpIHsKICAgICAgICAg\nICAgICAgIGlmICghaGFzSm9pbnMpCiAgICAgICAgICAgICAgICAgICAgam9p\nbi5zZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICByZWMgPSBfam9pbnMuam9pbnMo\nKS5nZXRSZWNvcmRlZEpvaW4oam9pbik7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHJlYyA9PSBudWxsIHx8IHJlYy5nZXRUeXBlKCkgPT0gSm9pbi5UWVBF\nX09VVEVSKQogICAgICAgICAgICAgICAgICAgICAgICBqb2luLnNldFR5cGUo\nSm9pbi5UWVBFX09VVEVSKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gam9pbnM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNb3ZlcyB0aGUgam9pbnMgZnJvbSB0aGUgZ2l2ZW4g\naW5zdGFuY2UgaW50byBvdXIgb3V0ZXIgam9pbnMgc2V0LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgY29sbGVjdE91dGVySm9pbnMoUGF0aEpvaW5zIHBq\nKSB7CiAgICAgICAgaWYgKF9qb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5T\nWU5UQVhfVFJBRElUSU9OQUwgfHwgcGogPT0gbnVsbAogICAgICAgICAgICB8\nfCBwai5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICBfam9pbnMgPSBuZXcg\nU2VsZWN0Sm9pbnModGhpcyk7CgogICAgICAgIGJvb2xlYW4gYWRkID0gdHJ1\nZTsKICAgICAgICBpZiAoX2pvaW5zLmpvaW5zKCkgPT0gbnVsbCkgewogICAg\nICAgICAgICBfam9pbnMuc2V0Sm9pbnMocGouam9pbnMoKSk7CiAgICAgICAg\nICAgIGFkZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgSm9pbiBqb2lu\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGouam9pbnMoKS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2luID0g\nKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChqb2luLmdldFR5\ncGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpIHsKICAgICAgICAgICAgICAgIGlm\nIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsCiAgICAgICAgICAgICAg\nICAgICAgJiYgIV9kaWN0LmNhbk91dGVySm9pbihfam9pblN5bnRheCwgam9p\nbi5nZXRGb3JlaWduS2V5KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgTG9n\nIGxvZyA9IF9jb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfSkRC\nQyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0\nKCJjYW50LW91dGVyLWZrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGpvaW4uZ2V0Rm9yZWlnbktleSgpKSk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICBqb2luLnNldFR5cGUoSm9pbi5UWVBF\nX09VVEVSKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWRkKQog\nICAgICAgICAgICAgICAgX2pvaW5zLmpvaW5zKCkuYWRkKGpvaW4pOwogICAg\nICAgIH0KICAgICAgICBwai5udWxsSm9pbnMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiB0YWJsZSB1\nbmRlciB0aGUgZ2l2ZW4gam9pbnMuCiAgICAgKiBOT1RFOiBXRSBSRUxZIE9O\nIFRIRVNFIElOREVYRVMgQkVJTkcgTU9OT1RPTklDQUxMWSBJTkNSRUFTSU5H\nIEZST00gMAogICAgICovCiAgICBwcml2YXRlIGludCBnZXRUYWJsZUluZGV4\nKFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGosIGJvb2xlYW4gY3JlYXRlKSB7\nCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBhIGZyb20gc2VsZWN0LCB0aGVuIHRo\nZXJlIGFyZSBubyB0YWJsZSBhbGlhc2VzCiAgICAgICAgaWYgKF9mcm9tICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgT2JqZWN0\nIGtleSA9IHRhYmxlLmdldEZ1bGxOYW1lKCk7CiAgICAgICAgaWYgKHBqICE9\nIG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgIGtleSA9\nIG5ldyBLZXkocGoucGF0aCgpLnRvU3RyaW5nKCksIGtleSk7CgogICAgICAg\nIC8vIGNoZWNrIG91dCBleGlzdGluZyBhbGlhc2VzCiAgICAgICAgSW50ZWdl\nciBpID0gZmluZEFsaWFzKHRhYmxlLCBrZXksIGZhbHNlLCBudWxsKTsKICAg\nICAgICBpZiAoaSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gaS5pbnRW\nYWx1ZSgpOwogICAgICAgIGlmICghY3JlYXRlKQogICAgICAgICAgICByZXR1\ncm4gLTE7CgogICAgICAgIC8vIG5vdCBmb3VuZDsgY3JlYXRlIGFsaWFzCiAg\nICAgICAgaSA9IE51bWJlcnMudmFsdWVPZihhbGlhc1NpemUoKSk7CiAgICAg\nICAgcmVjb3JkVGFibGVBbGlhcyh0YWJsZSwga2V5LCBpKTsKICAgICAgICBy\nZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQXR0\nZW1wdCB0byBmaW5kIHRoZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGtleS4KICAg\nICAqCiAgICAgKiBAcGFyYW0gZnJvbVBhcmVudCB3aGV0aGVyIGEgcGFyZW50\nIGlzIGNoZWNraW5nIGl0cyBzdWJzZWxlY3RzCiAgICAgKiBAcGFyYW0gZnJv\nbVN1YiB0aGUgc3Vic2VsZWN0IGNoZWNraW5nIGl0cyBwYXJlbnQKICAgICAq\nLwogICAgcHJpdmF0ZSBJbnRlZ2VyIGZpbmRBbGlhcyhUYWJsZSB0YWJsZSwg\nT2JqZWN0IGtleSwgYm9vbGVhbiBmcm9tUGFyZW50LAogICAgICAgIFNlbGVj\ndEltcGwgZnJvbVN1YikgewogICAgICAgIEludGVnZXIgYWxpYXMgPSBudWxs\nOwogICAgICAgIGlmIChfYWxpYXNlcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGFsaWFzID0gKEludGVnZXIpICgoZnJvbVBhcmVudCkgPyBfYWxpYXNlcy5y\nZW1vdmUoa2V5KQogICAgICAgICAgICAgICAgOiBfYWxpYXNlcy5nZXQoa2V5\nKSk7CiAgICAgICAgICAgIGlmIChhbGlhcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBpZiAoZnJvbVBhcmVudCkKICAgICAgICAgICAgICAgICAgICBf\ndGFibGVzLnJlbW92ZShhbGlhcyk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nYWxpYXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFm\ncm9tUGFyZW50ICYmIF9wYXJlbnQgIT0gbnVsbCkgewogICAgICAgICAgICBi\nb29sZWFuIHJlbW92ZUFsaWFzRnJvbVBhcmVudCA9IGtleS50b1N0cmluZygp\nLmluZGV4T2YoIjoiKSAhPSAtMTsKICAgICAgICAgICAgYWxpYXMgPSBfcGFy\nZW50LmZpbmRBbGlhcyh0YWJsZSwga2V5LCByZW1vdmVBbGlhc0Zyb21QYXJl\nbnQsIHRoaXMpOwogICAgICAgICAgICBpZiAoYWxpYXMgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKHJlbW92ZUFsaWFzRnJvbVBhcmVudCkgewog\nICAgICAgICAgICAgICAgICAgIHJlY29yZFRhYmxlQWxpYXModGFibGUsIGtl\neSwgYWxpYXMpOwogICAgICAgICAgICAgICAgICAgIF9yZW1vdmVkQWxpYXNG\ncm9tUGFyZW50LnNldChhbGlhcy5pbnRWYWx1ZSgpKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBhbGlhczsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBpZiAoX3N1YnNlbHMgIT0gbnVsbCkg\newogICAgICAgICAgICBTZWxlY3RJbXBsIHN1YjsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBfc3Vic2Vscy5zaXplKCk7IGkrKykgewogICAg\nICAgICAgICAgICAgc3ViID0gKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChp\nKTsKICAgICAgICAgICAgICAgIGlmIChzdWIgPT0gZnJvbVN1YikKICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChh\nbGlhcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN1Yi5f\nYWxpYXNlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzdWIu\nX2FsaWFzZXMucmVtb3ZlKGtleSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHN1Yi5fdGFibGVzICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHN1Yi5fdGFibGVzLnJlbW92ZShhbGlhcyk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChrZXkgaW5zdGFuY2Vv\nZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxpYXMgPSBz\ndWIuZmluZEFsaWFzKHRhYmxlLCBrZXksIHRydWUsIG51bGwpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoIWZyb21QYXJlbnQgJiYgYWxpYXMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZFRhYmxl\nQWxpYXModGFibGUsIGtleSwgYWxpYXMpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gYWxpYXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWNvcmQgdGhlIG1hcHBpbmcgb2YgdGhlIGdpdmVuIGtleSB0byB0aGUgZ2l2\nZW4gYWxpYXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWNvcmRUYWJs\nZUFsaWFzKFRhYmxlIHRhYmxlLCBPYmplY3Qga2V5LCBJbnRlZ2VyIGFsaWFz\nKSB7CiAgICAgICAgaWYgKF9hbGlhc2VzID09IG51bGwpCiAgICAgICAgICAg\nIF9hbGlhc2VzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfYWxpYXNlcy5w\ndXQoa2V5LCBhbGlhcyk7CgogICAgICAgIFN0cmluZyB0YWJsZVN0cmluZyA9\nIF9kaWN0LmdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSkgKyAiICIKICAgICAg\nICAgICAgKyB0b0FsaWFzKGFsaWFzLmludFZhbHVlKCkpOwogICAgICAgIGlm\nIChfdGFibGVzID09IG51bGwpCiAgICAgICAgICAgIF90YWJsZXMgPSBuZXcg\nVHJlZU1hcCgpOwogICAgICAgIF90YWJsZXMucHV0KGFsaWFzLCB0YWJsZVN0\ncmluZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdG90YWwg\nbnVtYmVyIG9mIGFsaWFzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGFs\naWFzU2l6ZSgpIHsKICAgICAgICByZXR1cm4gYWxpYXNTaXplKGZhbHNlLCBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0b3RhbCBu\ndW1iZXIgb2YgYWxpYXNlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVBh\ncmVudCB3aGV0aGVyIGEgcGFyZW50IGlzIGNoZWNraW5nIGl0cyBzdWJzZWxl\nY3RzCiAgICAgKiBAcGFyYW0gZnJvbVN1YiB0aGUgc3Vic2VsZWN0IGNoZWNr\naW5nIGl0cyBwYXJlbnQKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgYWxpYXNT\naXplKGJvb2xlYW4gZnJvbVBhcmVudCwgU2VsZWN0SW1wbCBmcm9tU3ViKSB7\nCiAgICAgICAgaW50IGFsaWFzZXMgPSAoZnJvbVBhcmVudCB8fCBfcGFyZW50\nID09IG51bGwpID8gMAogICAgICAgICAgICA6IF9wYXJlbnQuYWxpYXNTaXpl\nKGZhbHNlLCB0aGlzKTsKICAgICAgICBhbGlhc2VzICs9IChfYWxpYXNlcyA9\nPSBudWxsKSA/IDAgOiBfYWxpYXNlcy5zaXplKCk7CiAgICAgICAgaWYgKF9z\ndWJzZWxzICE9IG51bGwpIHsKICAgICAgICAgICAgU2VsZWN0SW1wbCBzdWI7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3N1YnNlbHMuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIHN1YiA9IChTZWxlY3RJbXBs\nKSBfc3Vic2Vscy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoc3ViICE9\nIGZyb21TdWIpCiAgICAgICAgICAgICAgICAgICAgYWxpYXNlcyArPSBzdWIu\nYWxpYXNTaXplKHRydWUsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBhbGlhc2VzOwogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRvU2VsZWN0KGZh\nbHNlLCBudWxsKS5nZXRTUUwoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQYXRoSm9pbnMgaW1wbGVtZW50YXRp\nb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4g\nb3V0ZXIpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nLnNldE91dGVyKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nRGlydHkoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1\nYmxpYyBTdHJpbmdCdWZmZXIgcGF0aCgpIHsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICBwdWJsaWMgSm9pblNldCBqb2lucygpIHsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGpvaW5Db3Vu\ndCgpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBudWxsSm9pbnMoKSB7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNF\nbXB0eSgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJs\naWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2FsVGFibGUsIFRhYmxlIGZv\ncmVpZ25UYWJsZSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnMo\ndGhpcykuY3Jvc3NKb2luKGxvY2FsVGFibGUsIGZvcmVpZ25UYWJsZSk7CiAg\nICB9CgogICAgcHVibGljIEpvaW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgIHJldHVy\nbiBuZXcgU2VsZWN0Sm9pbnModGhpcykuam9pbihmaywgaW52ZXJzZSwgdG9N\nYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVp\nZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLm91dGVySm9p\nbihmaywgaW52ZXJzZSwgdG9NYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9p\nbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCBD\nbGFzc01hcHBpbmcgdGFyZ2V0LAogICAgICAgIGludCBzdWJzLCBib29sZWFu\nIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBTZWxlY3RKb2lucyh0aGlzKS5qb2luUmVsYXRpb24obmFtZSwgZmssIHRh\ncmdldCwgc3VicywgCiAgICAgICAgICAgIGludmVyc2UsIHRvTWFueSk7CiAg\nICB9CgogICAgcHVibGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmlu\nZyBuYW1lLCBGb3JlaWduS2V5IGZrLCAKICAgICAgICBDbGFzc01hcHBpbmcg\ndGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRv\nTWFueSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcyku\nb3V0ZXJKb2luUmVsYXRpb24obmFtZSwgZmssIHRhcmdldCwgc3VicywgCiAg\nICAgICAgICAgIGludmVyc2UsIHRvTWFueSk7CiAgICB9CgogICAgcHVibGlj\nIEpvaW5zIHNldFZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICBpZiAo\ndmFyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuc2V0VmFyaWFibGUodmFy\nKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0cmlu\nZyBhbGlhcykgewogICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpv\naW5zKHRoaXMpLnNldFN1YnNlbGVjdChhbGlhcyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXByZXNlbnRzIGEgU1FMIHN0cmluZyBzZWxlY3RlZCB3aXRo\nIG51bGwgaWQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE51\nbGxJZCB7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIGEgcGxh\nY2Vob2xkZXIgU1FMIHN0cmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgUGxhY2Vob2xkZXIgewogICAgfQoKICAgIC8qKgogICAgICog\nS2V5IHR5cGUgdXNlZCBmb3IgYWxpYXNlcy4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgY2xhc3MgS2V5IHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBT\ndHJpbmcgX3BhdGg7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBPYmplY3QgX2tl\neTsKCiAgICAgICAgcHVibGljIEtleShTdHJpbmcgcGF0aCwgT2JqZWN0IGtl\neSkgewogICAgICAgICAgICBfcGF0aCA9IHBhdGg7CiAgICAgICAgICAgIF9r\nZXkgPSBrZXk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGhhc2hD\nb2RlKCkgewogICAgICAgICAgICByZXR1cm4gX3BhdGguaGFzaENvZGUoKSBe\nIF9rZXkuaGFzaENvZGUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICAgICAgaWYg\nKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKG90aGVyLmdldENsYXNzKCkgIT0gZ2V0Q2xhc3Mo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nS2V5IGsgPSAoS2V5KSBvdGhlcjsKICAgICAgICAgICAgcmV0dXJuIGsuX3Bh\ndGguZXF1YWxzKF9wYXRoKSAmJiBrLl9rZXkuZXF1YWxzKF9rZXkpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9wYXRoICsgInwiICsgX2tleTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBIHtAbGluayBSZXN1bHR9IGltcGxl\nbWVudGF0aW9uIHdyYXBwZWQgYXJvdW5kIHRoaXMgc2VsZWN0LgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFNlbGVjdFJlc3VsdAogICAgICAg\nIGV4dGVuZHMgUmVzdWx0U2V0UmVzdWx0CiAgICAgICAgaW1wbGVtZW50cyBQ\nYXRoSm9pbnMgewoKICAgICAgICBwcml2YXRlIFNlbGVjdEltcGwgX3NlbCA9\nIG51bGw7CgogICAgICAgIC8vIHBvc2l0aW9uIGluIHNlbGVjdGVkIGNvbHVt\nbnMgbGlzdCB3aGVyZSB3ZSBleHBlY3QgdGhlIG5leHQgbG9hZAogICAgICAg\nIHByaXZhdGUgaW50IF9wb3MgPSAwOwogICAgICAgIHByaXZhdGUgU3RhY2sg\nX3ByZUpvaW5zID0gbnVsbDsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ29u\nc3RydWN0b3IuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIFNlbGVjdFJl\nc3VsdChDb25uZWN0aW9uIGNvbm4sIFN0YXRlbWVudCBzdG1udCwgUmVzdWx0\nU2V0IHJzLAogICAgICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCkgewogICAg\nICAgICAgICBzdXBlcihjb25uLCBzdG1udCwgcnMsIGRpY3QpOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2VsZWN0IGZvciB0aGlzIHJl\nc3VsdC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgU2VsZWN0SW1wbCBn\nZXRTZWxlY3QoKSB7CiAgICAgICAgICAgIHJldHVybiBfc2VsOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2VsZWN0IGZvciB0aGlzIHJl\nc3VsdC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBzZXRTZWxl\nY3QoU2VsZWN0SW1wbCBzZWwpIHsKICAgICAgICAgICAgX3NlbCA9IHNlbDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0RWFnZXIoRmll\nbGRNYXBwaW5nIGtleSkgewogICAgICAgICAgICAvLyBkb24ndCBib3RoZXIg\nY3JlYXRpbmcga2V5IGlmIHdlIGtub3cgd2UgZG9uJ3QgaGF2ZSBhbnkKICAg\nICAgICAgICAgLy8gZWFnZXIgcmVzdWx0cwogICAgICAgICAgICBpZiAoX3Nl\nbC5fZWFnZXIgPT0gbnVsbCB8fCAhX3NlbC5fZWFnZXJLZXlzLmNvbnRhaW5z\nKGtleSkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAg\nICAgTWFwIG1hcCA9IFNlbGVjdFJlc3VsdC50aGlzLmdldEVhZ2VyTWFwKHRy\ndWUpOwogICAgICAgICAgICBpZiAobWFwID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQo\nX3NlbC50b0VhZ2VyS2V5KGtleSwgZ2V0Sm9pbnMobnVsbCkpKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHB1dEVhZ2VyKEZpZWxkTWFwcGlu\nZyBrZXksIE9iamVjdCByZXMpIHsKICAgICAgICAgICAgTWFwIG1hcCA9IFNl\nbGVjdFJlc3VsdC50aGlzLmdldEVhZ2VyTWFwKHRydWUpOwogICAgICAgICAg\nICBpZiAobWFwID09IG51bGwpIHsKICAgICAgICAgICAgICAgIG1hcCA9IG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAgICBzZXRFYWdlck1hcChtYXAp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hcC5wdXQoX3NlbC50b0Vh\nZ2VyS2V5KGtleSwgZ2V0Sm9pbnMobnVsbCkpLCByZXMpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIE9iamVjdCBsb2FkKENsYXNzTWFwcGluZyBtYXBw\naW5nLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIEpvaW5zIGpvaW5zKQogICAgICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYm9vbGVhbiBoYXNK\nb2lucyA9IGpvaW5zICE9IG51bGwKICAgICAgICAgICAgICAgICYmICgoUGF0\naEpvaW5zKSBqb2lucykucGF0aCgpICE9IG51bGw7CiAgICAgICAgICAgIGlm\nIChoYXNKb2lucykgewogICAgICAgICAgICAgICAgaWYgKF9wcmVKb2lucyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9wcmVKb2lucyA9IG5ldyBT\ndGFjaygpOwogICAgICAgICAgICAgICAgX3ByZUpvaW5zLnB1c2goam9pbnMp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBPYmplY3Qgb2JqID0gc3Vw\nZXIubG9hZChtYXBwaW5nLCBzdG9yZSwgZmV0Y2gsIGpvaW5zKTsKCiAgICAg\nICAgICAgIC8vIHJlc2V0CiAgICAgICAgICAgIGlmIChoYXNKb2lucykKICAg\nICAgICAgICAgICAgIF9wcmVKb2lucy5wb3AoKTsKICAgICAgICAgICAgcmV0\ndXJuIG9iajsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBuZXdK\nb2lucygpIHsKICAgICAgICAgICAgUGF0aEpvaW5zIHByZSA9IGdldFByZUpv\naW5zKCk7CiAgICAgICAgICAgIGlmIChwcmUgPT0gbnVsbCB8fCBwcmUucGF0\naCgpID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKCiAg\nICAgICAgICAgIFBhdGhKb2luc0ltcGwgcGogPSBuZXcgUGF0aEpvaW5zSW1w\nbCgpOwogICAgICAgICAgICBwai5wYXRoID0gbmV3IFN0cmluZ0J1ZmZlcihw\ncmUucGF0aCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICByZXR1cm4gcGo7\nCiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjb250YWlu\nc0ludGVybmFsKE9iamVjdCBvYmosIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\nICAgIC8vIHdlIGtleSBkaXJlY3RseSBvbiBvYmpzIGFuZCBqb2luLWxlc3Mg\nY29scywgb3Igb24gdGhlIGFsaWFzCiAgICAgICAgICAgIC8vIGZvciBjb2xz\nIHdpdGggam9pbnMKICAgICAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9p\nbnMoam9pbnMpOwogICAgICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBwai5w\nYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIG9iaiA9IGdldENvbHVt\nbkFsaWFzKChDb2x1bW4pIG9iaiwgcGopOwogICAgICAgICAgICByZXR1cm4g\nb2JqICE9IG51bGwgJiYgX3NlbC5fc2VsZWN0cy5jb250YWlucyhvYmopOwog\nICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gY29udGFpbnNB\nbGxJbnRlcm5hbChPYmplY3RbXSBvYmpzLCBKb2lucyBqb2lucykKICAgICAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIFBhdGhK\nb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAgICAgT2JqZWN0\nIG9iajsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBvYmpzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGogIT0gbnVsbCAm\nJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBvYmog\nPSBnZXRDb2x1bW5BbGlhcygoQ29sdW1uKSBvYmpzW2ldLCBwaik7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgb2JqID0gb2Jq\nc1tpXTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCB8fCAhX3Nl\nbC5fc2VsZWN0cy5jb250YWlucyhvYmopKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHB1c2hC\nYWNrKCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIF9wb3MgPSAwOwogICAgICAgICAgICBzdXBlci5wdXNoQmFjaygp\nOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gYWJzb2x1\ndGVJbnRlcm5hbChpbnQgcm93KQogICAgICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5hYnNvbHV0ZUludGVybmFsKHJvdyk7CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBuZXh0SW50ZXJuYWwoKQogICAg\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3Bv\ncyA9IDA7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5uZXh0SW50ZXJuYWwo\nKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBpbnQgZmluZE9iamVj\ndChPYmplY3Qgb2JqLCBKb2lucyBqb2lucykKICAgICAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfcG9zID09IF9zZWwu\nX3NlbGVjdHMuc2l6ZSgpKQogICAgICAgICAgICAgICAgX3BvcyA9IDA7Cgog\nICAgICAgICAgICAvLyB3ZSBrZXkgZGlyZWN0bHkgb24gb2JqcyBhbmQgam9p\nbi1sZXNzIGNvbHMsIG9yIG9uIHRoZSBhbGlhcwogICAgICAgICAgICAvLyBm\nb3IgY29scyB3aXRoIGpvaW5zCiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9\nIGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAgICAgQm9vbGVhbiBwayA9IG51\nbGw7CiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDb2x1bW4gY29sID0gKENvbHVt\nbikgb2JqOwogICAgICAgICAgICAgICAgcGsgPSAoY29sLmlzUHJpbWFyeUtl\neSgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nICAgICAgICBvYmogPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAg\nICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGNvbC5nZXRUYWJsZSgpICsgIjog\nIgogICAgICAgICAgICAgICAgICAgICAgICArIHBqLnBhdGgoKSArICIgKCIg\nKyBfc2VsLl9hbGlhc2VzICsgIikiKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gd2UgbG9hZCBpbiB0aGUgc2FtZSBvcmRlciB3ZSBzZWxlY3Qs\nIG1vcmUgb3IgbGVzcy4uLgogICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0\ncy5nZXQoX3BvcykuZXF1YWxzKG9iaikpCiAgICAgICAgICAgICAgICByZXR1\ncm4gKytfcG9zOwoKICAgICAgICAgICAgLy8gaWYgd2UncmUgbG9va2luZyBm\nb3IgYSBwcmltYXJ5IGtleSwgdHJ5IGJhY2sgYSBjb3VwbGUgcGxhY2VzLAog\nICAgICAgICAgICAvLyBzaW5jZSBwa3MgbWlnaHQgYmUgc2VsZWN0ZWQgaW4g\nYSBzbGlnaHRseSBkaWZmZXJlbnQgb3JkZXIgdGhhbgogICAgICAgICAgICAv\nLyB0aGV5IGFyZSBsb2FkZWQgYmFjazsgZG9uJ3QgY2hhbmdlIHRoZSBtYXJr\nZXIgcG9zaXRpb24KICAgICAgICAgICAgaWYgKHBrID09IG51bGwpCiAgICAg\nICAgICAgICAgICBwayA9IChvYmogaW5zdGFuY2VvZiBDb2x1bW4gJiYgKChD\nb2x1bW4pIG9iaikuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICAg\nICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAg\nICBpZiAocGsuYm9vbGVhblZhbHVlKCkpIHsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGkgPSBfcG9zIC0gMTsgaSA+PSAwICYmIGkgPj0gX3BvcyAtIDM7\nIGktLSkKICAgICAgICAgICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0cy5n\nZXQoaSkuZXF1YWxzKG9iaikpCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBpICsgMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gc2Vh\ncmNoIGZvcndhcmQgb24gdGhlIGFzc3VtcHRpb24gdGhhdCB3ZSBtaWdodCBi\nZSBza2lwcGluZwogICAgICAgICAgICAvLyBzZWxlY3RzIGZvciBzaWJsaW5n\nIGNsYXNzZXM7IGFkdmFuY2UgdGhlIHBvc2l0aW9uIGlmIHdlIGZpbmQKICAg\nICAgICAgICAgLy8gc29tZXRoaW5nIGZvcndhcmQKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IF9wb3MgKyAxOyBpIDwgX3NlbC5fc2VsZWN0cy5zaXplKCk7\nIGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9zZWwuX3NlbGVjdHMuZ2V0\nKGkpLmVxdWFscyhvYmopKSB7CiAgICAgICAgICAgICAgICAgICAgX3BvcyA9\nIGk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICsrX3BvczsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWF5\nYmUgdGhlIGNvbHVtbiB3YXMgc2VsZWN0ZWQgYnkgMiBkaWZmZXJlbnQgbWFw\ncGluZ3MsIHNvIGl0J3MKICAgICAgICAgICAgLy8gc29tZXdoZXJlIHByaW9y\nIHRvIHRoZSBjdXJyZW50IHBvc2l0aW9uOyBpbiB0aGlzIGNhc2UgbGVhdmUg\ndGhlCiAgICAgICAgICAgIC8vIHBvc2l0aW9uIG1hcmtlciBhdCBpdHMgY3Vy\ncmVudCBwbGFjZSBjYXVzZSBzdWJzZXF1ZW50IGxvYWRzIHdpbGwKICAgICAg\nICAgICAgLy8gc3RpbGwgcHJvYmFibHkgc3RhcnQgZnJvbSB0aGVyZQogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9wb3M7IGkrKykKICAgICAg\nICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3RzLmdldChpKS5lcXVhbHMob2Jq\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSArIDE7CgogICAgICAg\nICAgICAvLyBzb21ldGhpbmdzJ3Mgd3JvbmcuLi4KICAgICAgICAgICAgdGhy\nb3cgbmV3IFNRTEV4Y2VwdGlvbihvYmoudG9TdHJpbmcoKSk7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGpvaW5zIHRv\nIHVzZSB0byBmaW5kIGNvbHVtbiBkYXRhLgogICAgICAgICAqLwogICAgICAg\nIHByaXZhdGUgUGF0aEpvaW5zIGdldEpvaW5zKEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgICAgIFBhdGhKb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwog\nICAgICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBwajsKICAgICAgICAgICAgcmV0\ndXJuIGdldFByZUpvaW5zKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBSZXR1cm4gdGhlIHByZSBqb2lucyBmb3IgdGhlIHJlc3VsdCwg\nb3IgbnVsbCBpZiBub25lLiBOb3RlIHRoYXQKICAgICAgICAgKiB3ZSBoYXZl\nIHRvIHRha2UgdGhlIFNlbGVjdCdzIHByZSBqb2lucyBpbnRvIGFjY291bnQg\ndG9vLCBzaW5jZQogICAgICAgICAqIGJhdGNoZWQgc2VsZWN0cyBjYW4gaGF2\nZSBhZGRpdGlvbmFsIHByZSBqb2lucyBvbiB0aGUgc3RhY2sgZXZlbgogICAg\nICAgICAqIG9uIGV4ZWN1dGlvbi4KICAgICAgICAgKi8KICAgICAgICBwcml2\nYXRlIFBhdGhKb2lucyBnZXRQcmVKb2lucygpIHsKICAgICAgICAgICAgaWYg\nKF9wcmVKb2lucyAhPSBudWxsICYmICFfcHJlSm9pbnMuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIChQYXRoSm9pbnMpIF9wcmVKb2lucy5w\nZWVrKCk7CiAgICAgICAgICAgIGlmIChfc2VsLl9wcmVKb2lucyAhPSBudWxs\nICYmICFfc2VsLl9wcmVKb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gKFBhdGhKb2lucykgX3NlbC5fcHJlSm9pbnMucGVlaygpOwog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIFJldHVybiB0aGUgYWxpYXMgdXNlZCB0byBrZXkgb24g\ndGhlIGNvbHVtbiBkYXRhLCBjb25zaWRlcmluZyB0aGUKICAgICAgICAgKiBn\naXZlbiBqb2lucy4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIFN0cmlu\nZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sLCBQYXRoSm9pbnMgcGopIHsK\nICAgICAgICAgICAgU3RyaW5nIGFsaWFzOwogICAgICAgICAgICBpZiAoX3Nl\nbC5fZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBhbGlhcyA9IF9z\nZWwudG9BbGlhcyhfc2VsLl9mcm9tLmdldFRhYmxlSW5kZXgKICAgICAgICAg\nICAgICAgICAgICAoY29sLmdldFRhYmxlKCksIHBqLCBmYWxzZSkpOwogICAg\nICAgICAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBpZiAoX3NlbC5f\nZGljdC5yZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBGUk9NX1NFTEVDVF9BTElBUyArICIuIiArIGFsaWFz\nICsgIl8iICsgY29sOwogICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFzICsg\nIl8iICsgY29sOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFsaWFzID0g\nX3NlbC50b0FsaWFzKF9zZWwuZ2V0VGFibGVJbmRleChjb2wuZ2V0VGFibGUo\nKSwgcGosIGZhbHNlKSk7CiAgICAgICAgICAgIHJldHVybiAoYWxpYXMgPT0g\nbnVsbCkgPyBudWxsIDogYWxpYXMgKyAiLiIgKyBjb2w7CiAgICAgICAgfQoK\nICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAg\nLy8gUGF0aEpvaW5zIGltcGxlbWVudGF0aW9uCiAgICAgICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBp\nc091dGVyKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4g\nb3V0ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Ry\naW5nQnVmZmVyIHBhdGgoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5TZXQgam9pbnMoKSB7CiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiAwOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2FsVGFibGUsIFRhYmxl\nIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luKEZvcmVpZ25LZXkg\nZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJz\nZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9u\nKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCAKICAgICAgICAgICAgQ2xh\nc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwg\nYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXRo\nSm9pbnNJbXBsKCkuam9pblJlbGF0aW9uKG5hbWUsIGZrLCB0YXJnZXQsIHN1\nYnMsIAogICAgICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW5SZWxhdGlvbihT\ndHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywKICAgICAgICAgICAgQ2xhc3NN\nYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9v\nbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXRoSm9p\nbnNJbXBsKCkub3V0ZXJKb2luUmVsYXRpb24obmFtZSwgZmssIHRhcmdldCwg\nc3VicywKICAgICAgICAgICAgICAgIGludmVyc2UsIHRvTWFueSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5n\nIHZhcikgewogICAgICAgICAgICBpZiAodmFyID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQ\nYXRoSm9pbnNJbXBsKCkuc2V0VmFyaWFibGUodmFyKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBKb2lucyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFz\nKSB7CiAgICAgICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIHJldHVybiBuZXcgUGF0\naEpvaW5zSW1wbCgpLnNldFN1YnNlbGVjdChhbGlhcyk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQmFzZSBqb2lucyBpbXBsZW1lbnRhdGlv\nbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUGF0aEpvaW5z\nSW1wbAogICAgICAgIGltcGxlbWVudHMgUGF0aEpvaW5zIHsKCiAgICAgICAg\ncHJvdGVjdGVkIFN0cmluZ0J1ZmZlciBwYXRoID0gbnVsbDsKICAgICAgICBw\ncm90ZWN0ZWQgU3RyaW5nIHZhciA9IG51bGw7CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIo\nYm9vbGVhbiBvdXRlcikgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAg\nICAgICAgICAgIHJldHVybiB2YXIgIT0gbnVsbCB8fCBwYXRoICE9IG51bGw7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgo\nKSB7CiAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5TZXQgam9pbnMoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBqb2luQ291\nbnQoKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIHNldFZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAg\nICAgICAgICAgdGhpcy52YXIgPSB2YXI7CiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldFN1YnNl\nbGVjdChTdHJpbmcgYWxpYXMpIHsKICAgICAgICAgICAgaWYgKCFhbGlhcy5l\nbmRzV2l0aCgiOiIpKQogICAgICAgICAgICAgICAgYWxpYXMgKz0gJzonOwog\nICAgICAgICAgICBhcHBlbmQoYWxpYXMpOwogICAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1w\ndHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRhYmxl\nLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAgYXBwZW5kKHZh\ncik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW4o\nRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFu\neSkgewogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAgICAgICAgdmFy\nID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmss\nIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAg\nICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBm\naywgCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJz\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAg\nICAgIGFwcGVuZChuYW1lKTsKICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAg\nICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pblJl\nbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLAogICAgICAgICAg\nICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZl\ncnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBhcHBlbmQobmFt\nZSk7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIg\nPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9Cgog\nICAgICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZChTdHJpbmcgc3RyKSB7CiAg\nICAgICAgICAgIGlmIChzdHIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\naWYgKHBhdGggPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwYXRoID0g\nbmV3IFN0cmluZ0J1ZmZlcihzdHIpOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIHBhdGguYXBwZW5kKCcuJykuYXBwZW5kKHN0\ncik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiAiUGF0aEpv\naW5zSW1wbDwiICsgaGFzaENvZGUoKSArICI+OiAiCiAgICAgICAgICAgICAg\nICArIFN0cmluZy52YWx1ZU9mKHBhdGgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEpvaW5zIGltcGxlbWVudGF0aW9uLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTZWxlY3RKb2lucwogICAgICAgIGV4\ndGVuZHMgUGF0aEpvaW5zSW1wbCAKICAgICAgICBpbXBsZW1lbnRzIENsb25l\nYWJsZSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgU2VsZWN0SW1wbCBfc2Vs\nOwogICAgICAgIHByaXZhdGUgSm9pblNldCBfam9pbnMgPSBudWxsOwogICAg\nICAgIHByaXZhdGUgYm9vbGVhbiBfb3V0ZXIgPSBmYWxzZTsKICAgICAgICBw\ncml2YXRlIGludCBfY291bnQgPSAwOwoKICAgICAgICBwdWJsaWMgU2VsZWN0\nSm9pbnMoU2VsZWN0SW1wbCBzZWwpIHsKICAgICAgICAgICAgX3NlbCA9IHNl\nbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfb3V0ZXI7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIp\nIHsKICAgICAgICAgICAgX291dGVyID0gb3V0ZXI7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNEaXJ0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmlzRGlydHko\nKSB8fCAhaXNFbXB0eSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpv\naW5TZXQgam9pbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBfam9pbnM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXRKb2lucyhKb2luU2V0\nIGpvaW5zKSB7CiAgICAgICAgICAgIF9qb2lucyA9IGpvaW5zOwogICAgICAg\nICAgICBfb3V0ZXIgPSBqb2lucyAhPSBudWxsICYmIGpvaW5zLmxhc3QoKSAh\nPSBudWxsCiAgICAgICAgICAgICAgICAmJiBqb2lucy5sYXN0KCkuZ2V0VHlw\nZSgpID09IEpvaW4uVFlQRV9PVVRFUjsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICBpZiAoX2pvaW5z\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvdW50OwogICAg\nICAgICAgICByZXR1cm4gTWF0aC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgp\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygp\nIHsKICAgICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2NvdW50ID0gTWF0aC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgp\nKTsKICAgICAgICAgICAgX2pvaW5zID0gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuaXNFbXB0eSgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBs\nb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAg\nLy8gY3Jvc3Mgam9pbnMgYXJlIGZvciB1bmJvdW5kIHZhcmlhYmxlczsgdW5m\nb3J0dW5hdGVseSB3ZSBoYXZlCiAgICAgICAgICAgIC8vIHRvIGFsd2F5cyBn\nbyBESVNUSU5DVCBmb3IgdW5ib3VuZCB2YXJzIGJlY2F1c2UgdGhlcmUgYXJl\nIGNlcnRhaW4KICAgICAgICAgICAgLy8gY2FzZXMgdGhhdCByZXF1aXJlIGl0\nLCBhbmQgd2UgY2FuJ3QgZGlmZmVyZW50aWF0ZSB0aGVtIGZyb20gdGhlCiAg\nICAgICAgICAgIC8vIGNhc2VzIHRoYXQgZG9uJ3QKICAgICAgICAgICAgX3Nl\nbC5fZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CgogICAgICAgICAgICBp\nZiAoX3NlbC5nZXRKb2luU3ludGF4KCkgIT0gSm9pblN5bnRheGVzLlNZTlRB\nWF9TUUw5MgogICAgICAgICAgICAgICAgfHwgX3NlbC5fZnJvbSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBkb24ndCBtYWtlIGFueSBqb2lucywg\nYnV0IHVwZGF0ZSB0aGUgcGF0aCBpZiBhIHZhcmlhYmxlCiAgICAgICAgICAg\nICAgICAvLyBoYXMgYmVlbiBzZXQKICAgICAgICAgICAgICAgIHRoaXMuYXBw\nZW5kKHRoaXMudmFyKTsKICAgICAgICAgICAgICAgIHRoaXMudmFyID0gbnVs\nbDsKICAgICAgICAgICAgICAgIF9vdXRlciA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIGRvbid0IGxldCB0aGUgZ2V0IGFsaWFzIG1ldGhvZHMgc2VlIHRoYXQg\nYSB2YXIgaGFzIGJlZW4gc2V0CiAgICAgICAgICAgIC8vIHVudGlsIHdlIGdl\ndCBwYXN0IHRoZSBsb2NhbCB0YWJsZQogICAgICAgICAgICBTdHJpbmcgdmFy\nID0gdGhpcy52YXI7CiAgICAgICAgICAgIHRoaXMudmFyID0gbnVsbDsKCiAg\nICAgICAgICAgIGludCBhbGlhczEgPSBfc2VsLmdldFRhYmxlSW5kZXgobG9j\nYWxUYWJsZSwgdGhpcywgdHJ1ZSk7CiAgICAgICAgICAgIHRoaXMuYXBwZW5k\nKHZhcik7CiAgICAgICAgICAgIGludCBhbGlhczIgPSBfc2VsLmdldFRhYmxl\nSW5kZXgoZm9yZWlnblRhYmxlLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAg\nSm9pbiBqID0gbmV3IEpvaW4obG9jYWxUYWJsZSwgYWxpYXMxLCBmb3JlaWdu\nVGFibGUsIGFsaWFzMiwKICAgICAgICAgICAgICAgIG51bGwsIGZhbHNlKTsK\nICAgICAgICAgICAgai5zZXRUeXBlKEpvaW4uVFlQRV9DUk9TUyk7CgogICAg\nICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBf\nam9pbnMgPSBuZXcgSm9pblNldCgpOwogICAgICAgICAgICBfam9pbnMuYWRk\nKGopOwogICAgICAgICAgICBfb3V0ZXIgPSBmYWxzZTsKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMg\nam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4g\ndG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBqb2luKG51bGwsIGZrLCBu\ndWxsLCAtMSwgaW52ZXJzZSwgdG9NYW55LCBmYWxzZSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmss\nIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAg\nICAgcmV0dXJuIGpvaW4obnVsbCwgZmssIG51bGwsIC0xLCBpbnZlcnNlLCB0\nb01hbnksIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5z\nIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAg\nICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29s\nZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJl\ndHVybiBqb2luKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIGludmVyc2UsIHRv\nTWFueSwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5z\nIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZr\nLAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3Vicywg\nYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAg\nICByZXR1cm4gam9pbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCBpbnZlcnNl\nLCB0b01hbnksIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBK\nb2lucyBqb2luKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCBDbGFzc01h\ncHBpbmcgdGFyZ2V0LAogICAgICAgICAgICBpbnQgc3VicywgYm9vbGVhbiBp\nbnZlcnNlLCBib29sZWFuIHRvTWFueSwgYm9vbGVhbiBvdXRlcikgewogICAg\nICAgICAgICAvLyBkb24ndCBsZXQgdGhlIGdldCBhbGlhcyBtZXRob2RzIHNl\nZSB0aGF0IGEgdmFyIGhhcyBiZWVuIHNldAogICAgICAgICAgICAvLyB1bnRp\nbCB3ZSBnZXQgcGFzdCB0aGUgbG9jYWwgdGFibGUKICAgICAgICAgICAgU3Ry\naW5nIHZhciA9IHRoaXMudmFyOwogICAgICAgICAgICB0aGlzLnZhciA9IG51\nbGw7CgogICAgICAgICAgICAvLyBnZXQgZmlyc3QgdGFibGUgYWxpYXMgYmVm\nb3JlIHVwZGF0aW5nIHBhdGg7IGlmIHRoZXJlIGlzIGEgZnJvbQogICAgICAg\nICAgICAvLyBzZWxlY3QgdGhlbiB3ZSBzaG91bGRuJ3QgYWN0dWFsbHkgY3Jl\nYXRlIGEgam9pbiBvYmplY3QsIHNpbmNlCiAgICAgICAgICAgIC8vIHRoZSBq\nb2lucyB3aWxsIGFsbCBiZSBkb25lIGluIHRoZSBmcm9tIHNlbGVjdAogICAg\nICAgICAgICBib29sZWFuIGNyZWF0ZUpvaW4gPSBfc2VsLl9mcm9tID09IG51\nbGw7CiAgICAgICAgICAgIFRhYmxlIHRhYmxlMSA9IG51bGw7CiAgICAgICAg\nICAgIGludCBhbGlhczEgPSAtMTsKICAgICAgICAgICAgaWYgKGNyZWF0ZUpv\naW4pIHsKICAgICAgICAgICAgICAgIHRhYmxlMSA9IChpbnZlcnNlKSA/IGZr\nLmdldFByaW1hcnlLZXlUYWJsZSgpIDogZmsuZ2V0VGFibGUoKTsKICAgICAg\nICAgICAgICAgIGFsaWFzMSA9IF9zZWwuZ2V0VGFibGVJbmRleCh0YWJsZTEs\nIHRoaXMsIHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB1\ncGRhdGUgdGhlIHBhdGggd2l0aCB0aGUgcmVsYXRpb24gbmFtZSBiZWZvcmUg\nZ2V0dGluZyBwayBhbGlhcwogICAgICAgICAgICB0aGlzLmFwcGVuZChuYW1l\nKTsKICAgICAgICAgICAgdGhpcy5hcHBlbmQodmFyKTsKICAgICAgICAgICAg\naWYgKHRvTWFueSkgewogICAgICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0g\nSU1QTElDSVRfRElTVElOQ1Q7CiAgICAgICAgICAgICAgICBfc2VsLl9mbGFn\ncyB8PSBUT19NQU5ZOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9vdXRl\nciA9IG91dGVyOwoKICAgICAgICAgICAgaWYgKGNyZWF0ZUpvaW4pIHsKICAg\nICAgICAgICAgICAgIFRhYmxlIHRhYmxlMiA9IChpbnZlcnNlKSA/IGZrLmdl\ndFRhYmxlKCkgCiAgICAgICAgICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5\nS2V5VGFibGUoKTsKICAgICAgICAgICAgICAgIGludCBhbGlhczIgPSBfc2Vs\nLmdldFRhYmxlSW5kZXgodGFibGUyLCB0aGlzLCB0cnVlKTsKICAgICAgICAg\nICAgICAgIEpvaW4gaiA9IG5ldyBKb2luKHRhYmxlMSwgYWxpYXMxLCB0YWJs\nZTIsIGFsaWFzMiwgZmssIGludmVyc2UpOwogICAgICAgICAgICAgICAgai5z\nZXRUeXBlKChvdXRlcikgPyBKb2luLlRZUEVfT1VURVIgOiBKb2luLlRZUEVf\nSU5ORVIpOwoKICAgICAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBfam9pbnMgPSBuZXcgSm9pblNldCgpOwog\nICAgICAgICAgICAgICAgaWYgKF9qb2lucy5hZGQoaikgJiYgKHN1YnMgPT0g\nU2VsZWN0LlNVQlNfSk9JTkFCTEUgCiAgICAgICAgICAgICAgICAgICAgfHwg\nc3VicyA9PSBTZWxlY3QuU1VCU19OT05FKSkKICAgICAgICAgICAgICAgICAg\nICBqLnNldFJlbGF0aW9uKHRhcmdldCwgc3VicywgY2xvbmUoX3NlbCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFNlbGVjdEpvaW5zIGNsb25lKFNlbGVjdElt\ncGwgc2VsKSB7CiAgICAgICAgICAgIFNlbGVjdEpvaW5zIHNqID0gbmV3IFNl\nbGVjdEpvaW5zKHNlbCk7CiAgICAgICAgICAgIHNqLnZhciA9IHZhcjsKICAg\nICAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNq\nLnBhdGggPSBuZXcgU3RyaW5nQnVmZmVyKHBhdGgudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgIGlmIChfam9pbnMgIT0gbnVsbCAmJiAhX2pvaW5zLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgICAgIHNqLl9qb2lucyA9IG5ldyBKb2luU2V0\nKF9qb2lucyk7CiAgICAgICAgICAgIHNqLl9vdXRlciA9IF9vdXRlcjsKICAg\nICAgICAgICAgcmV0dXJuIHNqOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLnRvU3RyaW5nKCkgKyAiICgiICsgX291dGVyICsgIik6ICIgKyBfam9pbnM7\nCiAgICAgICAgfQogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgU2VsZWN0cyBu\nZXdTZWxlY3RzKCkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0cygpOwog\nICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHRvIHRyYWNrIHNl\nbGVjdGVkIGNvbHVtbnMsIHdpdGggZmFzdCBjb250YWlucyBtZXRob2QuCiAg\nICAgKiBBY3RzIGFzIGEgbGlzdCBvZiBzZWxlY3QgaWRzLCB3aXRoIGFkZGl0\naW9uYWwgbWV0aG9kcyB0byBtYW5pcHVsYXRlCiAgICAgKiB0aGUgYWxpYXMg\nb2YgZWFjaCBzZWxlY3RlZCBpZC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBjbGFzcyBTZWxlY3RzCiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdExp\nc3QgewoKICAgICAgICBwcm90ZWN0ZWQgTGlzdCBfaWRzID0gbnVsbDsKICAg\nICAgICBwcm90ZWN0ZWQgTGlzdCBfaWRlbnRzID0gbnVsbDsKICAgICAgICBw\ncm90ZWN0ZWQgTWFwIF9hbGlhc2VzID0gbnVsbDsKICAgICAgICBwcm90ZWN0\nZWQgTWFwIF9zZWxlY3RBcyA9IG51bGw7CiAgICAgICAgcHJvdGVjdGVkIERC\nRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CgogICAgICAgIC8qKgogICAgICAg\nICAqIEFkZCBhbGwgYWxpYXNlcyBmcm9tIGFub3RoZXIgaW5zdGFuY2UuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkQWxsKFNlbGVjdHMg\nc2VscykgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxsICYmIHNlbHMu\nX2lkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2lkcyA9IG5ldyBBcnJh\neUxpc3Qoc2Vscy5faWRzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vscy5f\naWRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfaWRzLmFkZEFsbChzZWxz\nLl9pZHMpOwoKICAgICAgICAgICAgaWYgKF9pZGVudHMgPT0gbnVsbCAmJiBz\nZWxzLl9pZGVudHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9pZGVudHMg\nPSBuZXcgQXJyYXlMaXN0KHNlbHMuX2lkZW50cyk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKHNlbHMuX2lkZW50cyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2lkZW50cy5hZGRBbGwoc2Vscy5faWRlbnRzKTsKCiAgICAgICAgICAgIGlm\nIChfYWxpYXNlcyA9PSBudWxsICYmIHNlbHMuX2FsaWFzZXMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhhc2hNYXAoc2Vscy5f\nYWxpYXNlcyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHNlbHMuX2FsaWFzZXMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hbGlhc2VzLnB1dEFsbChzZWxz\nLl9hbGlhc2VzKTsKCiAgICAgICAgICAgIGlmIChfc2VsZWN0QXMgPT0gbnVs\nbCAmJiBzZWxzLl9zZWxlY3RBcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX3NlbGVjdEFzID0gbmV3IEhhc2hNYXAoc2Vscy5fc2VsZWN0QXMpOwogICAg\nICAgICAgICBlbHNlIGlmIChzZWxzLl9zZWxlY3RBcyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX3NlbGVjdEFzLnB1dEFsbChzZWxzLl9zZWxlY3RBcyk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRo\nZSBhbGlhcyBvZiBhIGdpdmVuIGlkLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyBPYmplY3QgZ2V0QWxpYXMoT2JqZWN0IGlkKSB7CiAgICAgICAgICAg\nIHJldHVybiAoX2FsaWFzZXMgPT0gbnVsbCkgPyBudWxsIDogX2FsaWFzZXMu\nZ2V0KGlkKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNl\ndCBhbiBhbGlhcyBmb3IgYSBnaXZlbiBpZC4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgaW50IHNldEFsaWFzKE9iamVjdCBpZCwgT2JqZWN0IGFsaWFz\nLCBib29sZWFuIGlkZW50KSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIF9pZHMgPSBuZXcgQXJyYXlMaXN0KCk7\nCiAgICAgICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFwKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGludCBpZHg7CiAgICAgICAgICAg\nIGlmIChfYWxpYXNlcy5wdXQoaWQsIGFsaWFzKSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgaWR4ID0gX2lkcy5pbmRleE9mKGlkKTsKICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICBfaWRzLmFkZChpZCk7CiAgICAgICAg\nICAgICAgICBpZHggPSBfaWRzLnNpemUoKSAtIDE7CgogICAgICAgICAgICAg\nICAgaWYgKGlkZW50KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9pZGVu\ndHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2lkZW50cyA9\nIG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgICAgICAgICAgX2lkZW50\ncy5hZGQoaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBpZHg7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBTZXQgYW4gYWxpYXMgZm9yIGEgZ2l2ZW4gaW5kZXguCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0QWxpYXMoaW50IGlk\neCwgT2JqZWN0IGFsaWFzKSB7CiAgICAgICAgICAgIE9iamVjdCBpZCA9IF9p\nZHMuZ2V0KGlkeCk7CiAgICAgICAgICAgIF9hbGlhc2VzLnB1dChpZCwgYWxp\nYXMpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSW5zZXJ0\nIGFuIGFsaWFzIGJlZm9yZSB0aGUgZ2l2ZW4gaW5kZXgsIHVzaW5nIG5lZ2F0\naXZlIGluZGV4ZXMKICAgICAgICAgKiB0byBjb3VudCBiYWNrd2FyZHMuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgaW5zZXJ0QWxpYXMoaW50\nIGlkeCwgT2JqZWN0IGlkLCBPYmplY3QgYWxpYXMpIHsKICAgICAgICAgICAg\nX2FsaWFzZXMucHV0KGlkLCBhbGlhcyk7CiAgICAgICAgICAgIGlmIChpZHgg\nPj0gMCkKICAgICAgICAgICAgICAgIF9pZHMuYWRkKGlkeCwgaWQpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfaWRzLmFkZChfaWRzLnNp\nemUoKSArIGlkeCwgaWQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogUmV0dXJuIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4gYWxpYXMuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIGludCBpbmRleE9mQWxpYXMoT2Jq\nZWN0IGFsaWFzKSB7CiAgICAgICAgICAgIGlmIChfYWxpYXNlcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IF9pZHMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAg\nICAgICBpZiAoYWxpYXMuZXF1YWxzKF9hbGlhc2VzLmdldChfaWRzLmdldChp\nKSkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAg\nICByZXR1cm4gLTE7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBBIGxpc3QgcmVwcmVzZW50YXRpb24gb2YgdGhlIGFsaWFzZXMsIGluIHNl\nbGVjdCBvcmRlciwgd2l0aAogICAgICAgICAqIEFTIGFsaWFzZXMgcHJlc2Vu\ndC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgTGlzdCBnZXRBbGlhc2Vz\nKGZpbmFsIGJvb2xlYW4gaWRlbnQsIGZpbmFsIGJvb2xlYW4gaW5uZXIpIHsK\nICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBBYnN0cmFjdExpc3QoKSB7CiAgICAgICAgICAgICAgICBw\ndWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIChpZGVudCAmJiBfaWRlbnRzICE9IG51bGwpID8gX2lkZW50cy5zaXplKCkK\nICAgICAgICAgICAgICAgICAgICAgICAgOiBfaWRzLnNpemUoKTsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMgT2JqZWN0IGdl\ndChpbnQgaSkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdCBpZCA9IChp\nZGVudCAmJiBfaWRlbnRzICE9IG51bGwpID8gX2lkZW50cy5nZXQoaSkKICAg\nICAgICAgICAgICAgICAgICAgICAgOiBfaWRzLmdldChpKTsKICAgICAgICAg\nICAgICAgICAgICBPYmplY3QgYWxpYXMgPSBfYWxpYXNlcy5nZXQoaWQpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChpZCBpbnN0YW5jZW9mIENvbHVtbiAm\nJiAoKENvbHVtbikgaWQpLmlzWE1MKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGFsaWFzID0gYWxpYXMgKyBfZGljdC5nZXRTdHJpbmdWYWw7CiAgICAg\nICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIFN0cmlu\nZyBhcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlubmVyKQog\nICAgICAgICAgICAgICAgICAgICAgICBhcyA9ICgoU3RyaW5nKSBhbGlhcyku\ncmVwbGFjZSgnLicsICdfJyk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBp\nZiAoX3NlbGVjdEFzICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGFzID0gKFN0cmluZykgX3NlbGVjdEFzLmdldChpZCk7CgogICAgICAgICAg\nICAgICAgICAgIGlmIChhcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChpZGVudCAmJiBfaWRlbnRzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXM7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChhbGlhcyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWFzID0gbmV3IFNRTEJ1ZmZl\ncigoU1FMQnVmZmVyKSBhbGlhcykuCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYXBwZW5kKCIgQVMgIikuYXBwZW5kKGFzKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYWxpYXMgPSBhbGlhcyArICIgQVMgIiArIGFzOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBTZXQgdGhhdCBhIGdpdmVuIGlkJ3MgYWxp\nYXMgaGFzIGFuIEFTIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIHNldFNlbGVjdEFzKE9iamVjdCBpZCwgU3RyaW5nIGFzKSB7CiAg\nICAgICAgICAgIGlmIChfc2VsZWN0QXMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9zZWxlY3RBcyA9IG5ldyBIYXNoTWFwKChpbnQpICg1ICogMS4zMyAr\nIDEpKTsKICAgICAgICAgICAgX3NlbGVjdEFzLnB1dChpZCwgYXMpOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXIgYWxsIHBsYWNl\naG9sZGVycyBhbmQgc2VsZWN0IEFTIGNsYXVzZXMuCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIHZvaWQgY2xlYXJQbGFjZWhvbGRlcnMoKSB7CiAgICAg\nICAgICAgIGlmIChfaWRzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CgogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgaWQgPSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgaWYgKGlkIGluc3RhbmNlb2YgUGxhY2Vob2xkZXIpIHsKICAg\nICAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgICAg\nICAgICAgX2FsaWFzZXMucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gY29udGFpbnMoT2JqZWN0IGlkKSB7CiAgICAgICAgICAgIHJldHVybiBf\nYWxpYXNlcyAhPSBudWxsICYmIF9hbGlhc2VzLmNvbnRhaW5zS2V5KGlkKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGludCBpKSB7\nCiAgICAgICAgICAgIGlmIChfaWRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgIHJldHVybiBfaWRzLmdldChpKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIChfaWRzID09IG51bGwpID8gMCA6IF9pZHMuc2l6ZSgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgICAgIF9p\nZHMgPSBudWxsOwogICAgICAgICAgICBfYWxpYXNlcyA9IG51bGw7CiAgICAg\nICAgICAgIF9zZWxlY3RBcyA9IG51bGw7CiAgICAgICAgICAgIF9pZGVudHMg\nPSBudWxsOwogICAgICAgIH0KICAgIH0KfQoKLyoqCiAqIENvbW1vbiBqb2lu\ncyBpbnRlcmZhY2UgdXNlZCBpbnRlcm5hbGx5LiBDYW5ub3QgYmUgbWFkZSBh\nbiBpbm5lciBjbGFzcwogKiBiZWNhdXNlIHRoZSBvdXRlciBjbGFzcyAoU2Vs\nZWN0KSBoYXMgdG8gaW1wbGVtZW50IGl0LgogKi8KaW50ZXJmYWNlIFBhdGhK\nb2lucwogICAgZXh0ZW5kcyBKb2lucyB7CgogICAgLyoqCiAgICAgKiBNYXJr\nIHRoaXMgYXMgYW4gb3V0ZXIgam9pbnMgc2V0LgogICAgICovCiAgICBwdWJs\naWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpOwoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhpcyBpbnN0YW5jZSBoYXMgYSBw\nYXRoLCBhbnkgam9pbnMsIG9yIGEgdmFyaWFibGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzRGlydHkoKTsKCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgcmVsYXRpb24gcGF0aCB0cmF2ZXJzZWQgYnkgdGhlc2Ugam9pbnMs\nIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZ0J1\nZmZlciBwYXRoKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNldCBv\nZiB7QGxpbmsgSm9pbn0gZWxlbWVudHMsIG9yIG51bGwgaWYgbm9uZS4KICAg\nICAqLwogICAgcHVibGljIEpvaW5TZXQgam9pbnMoKTsKCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWF4aW11bSBudW1iZXIgb2Ygam9pbnMgY29udGFp\nbmVkIGluIHRoaXMgaW5zdGFuY2UgYXQgYW55CiAgICAgKiB0aW1lLgogICAg\nICovCiAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpOwoKICAgIC8qKgogICAg\nICogTnVsbCB0aGUgc2V0IG9mIHtAbGluayBKb2lufSBlbGVtZW50cy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCk7Cn0KCg==\n","encoding":"base64"}

