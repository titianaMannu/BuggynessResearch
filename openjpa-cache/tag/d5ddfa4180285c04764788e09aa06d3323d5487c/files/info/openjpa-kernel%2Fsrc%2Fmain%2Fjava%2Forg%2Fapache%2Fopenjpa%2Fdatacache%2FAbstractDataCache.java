{"sha":"9e7c732b14e56a491e1ce784e2fd07db134cc72b","node_id":"MDQ6QmxvYjIwNjM2NDo5ZTdjNzMyYjE0ZTU2YTQ5MWUxY2U3ODRlMmZkMDdkYjEzNGNjNzJi","size":14365,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9e7c732b14e56a491e1ce784e2fd07db134cc72b","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\nZGF0YWNhY2hlOw0KDQppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsNCmlt\ncG9ydCBqYXZhLnV0aWwuQml0U2V0Ow0KaW1wb3J0IGphdmEudXRpbC5Db2xs\nZWN0aW9uOw0KaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOw0KaW1wb3J0IGph\ndmEudXRpbC5JdGVyYXRvcjsNCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsNCmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOw0KDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNvbW1pdEV2ZW50Ow0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5SZW1vdGVDb21taXRMaXN0ZW5l\ncjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmln\ndXJhYmxlOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5D\nb25maWd1cmF0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbG9nLkxvZzsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5jb25jdXJyZW50LkFic3RyYWN0Q29uY3VycmVudEV2ZW50TWFuYWdlcjsN\nCg0KLyoqDQogKiBBYnN0cmFjdCB7QGxpbmsgRGF0YUNhY2hlfSBpbXBsZW1l\nbnRhdGlvbiB0aGF0IHByb3ZpZGVzIHZhcmlvdXMNCiAqIHN0YXRpc3RpY3Ms\nIGxvZ2dpbmcsIGFuZCB0aW1lb3V0IGZ1bmN0aW9uYWxpdHkgY29tbW9uIGFj\ncm9zcyBjYWNoZQ0KICogaW1wbGVtZW50YXRpb25zLg0KICoNCiAqIEBhdXRo\nb3IgUGF0cmljayBMaW5za2V5DQogKiBAYXV0aG9yIEFiZSBXaGl0ZQ0KICov\nDQpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3REYXRhQ2FjaGUNCiAg\nICBleHRlbmRzIEFic3RyYWN0Q29uY3VycmVudEV2ZW50TWFuYWdlcg0KICAg\nIGltcGxlbWVudHMgRGF0YUNhY2hlLCBDb25maWd1cmFibGUgew0KDQogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgQml0U2V0IEVNUFRZX0JJVFNFVCA9IG5l\ndyBCaXRTZXQoMCk7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2Nh\nbGl6ZXIgc19sb2MgPQ0KICAgICAgICBMb2NhbGl6ZXIuZm9yUGFja2FnZShB\nYnN0cmFjdERhdGFDYWNoZS5jbGFzcyk7DQoNCiAgICAvKioNCiAgICAgKiBU\naGUgY29uZmlndXJhdGlvbiBzZXQgYnkgdGhlIHN5c3RlbS4NCiAgICAgKi8N\nCiAgICBwcm90ZWN0ZWQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZjsNCg0K\nICAgIC8qKg0KICAgICAqIFRoZSBsb2cgdG8gdXNlLg0KICAgICAqLw0KICAg\nIHByb3RlY3RlZCBMb2cgbG9nOw0KDQogICAgcHJpdmF0ZSBTdHJpbmcgX25h\nbWUgPSBudWxsOw0KICAgIHByaXZhdGUgYm9vbGVhbiBfY2xvc2VkID0gZmFs\nc2U7DQogICAgcHJpdmF0ZSBTdHJpbmcgX3NjaGVkdWxlID0gbnVsbDsNCg0K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0TmFtZSgpIHsNCiAgICAgICAgcmV0dXJu\nIF9uYW1lOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldE5hbWUoU3Ry\naW5nIG5hbWUpIHsNCiAgICAgICAgX25hbWUgPSBuYW1lOw0KICAgIH0NCg0K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0RXZpY3Rpb25TY2hlZHVsZSgpIHsNCiAg\nICAgICAgcmV0dXJuIF9zY2hlZHVsZTsNCiAgICB9DQoNCiAgICBwdWJsaWMg\ndm9pZCBzZXRFdmljdGlvblNjaGVkdWxlKFN0cmluZyBzKSB7DQogICAgICAg\nIF9zY2hlZHVsZSA9IHM7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgaW5p\ndGlhbGl6ZShEYXRhQ2FjaGVNYW5hZ2VyIG1hbmFnZXIpIHsNCiAgICAgICAg\naWYgKF9zY2hlZHVsZSAhPSBudWxsICYmICEiIi5lcXVhbHMoX3NjaGVkdWxl\nKSkgew0KICAgICAgICAgICAgRGF0YUNhY2hlU2NoZWR1bGVyIHNjaGVkdWxl\nciA9IG1hbmFnZXIuZ2V0RGF0YUNhY2hlU2NoZWR1bGVyKCk7DQogICAgICAg\nICAgICBpZiAoc2NoZWR1bGVyICE9IG51bGwpDQogICAgICAgICAgICAgICAg\nc2NoZWR1bGVyLnNjaGVkdWxlRXZpY3Rpb24odGhpcywgX3NjaGVkdWxlKTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGNvbW1pdChD\nb2xsZWN0aW9uIGFkZGl0aW9ucywgQ29sbGVjdGlvbiBuZXdVcGRhdGVzLA0K\nICAgICAgICBDb2xsZWN0aW9uIGV4aXN0aW5nVXBkYXRlcywgQ29sbGVjdGlv\nbiBkZWxldGVzKSB7DQogICAgICAgIC8vIHJlbW92ZSBhbGwgb2JqZWN0cyBp\nbiBkZWxldGVzIGxpc3QNCiAgICAgICAgcmVtb3ZlQWxsSW50ZXJuYWwoZGVs\nZXRlcyk7DQoNCiAgICAgICAgLy8gbmV4dCwgYWRkIGFsbCB0aGUgbmV3IGFk\nZGl0aW9ucw0KICAgICAgICBwdXRBbGxJbnRlcm5hbChhZGRpdGlvbnMpOw0K\nICAgICAgICBwdXRBbGxJbnRlcm5hbChuZXdVcGRhdGVzKTsNCg0KICAgICAg\nICAvLyBwb3NzaWJseSBhZGQgdGhlIGV4aXN0aW5nIHVwZGF0ZXMsIGRlcGVu\nZGluZyBvbiB0aGUNCiAgICAgICAgLy8gc2VtYW50aWNzIG9mIHRoZSBjYWNo\nZSwgYXMgZGljdGF0ZWQgYnkgcmVjYWNoZVVwZGF0ZXMoKQ0KICAgICAgICBp\nZiAocmVjYWNoZVVwZGF0ZXMoKSkNCiAgICAgICAgICAgIHB1dEFsbEludGVy\nbmFsKGV4aXN0aW5nVXBkYXRlcyk7DQoNCiAgICAgICAgaWYgKGxvZy5pc1Ry\nYWNlRW5hYmxlZCgpKSB7DQogICAgICAgICAgICBDb2xsZWN0aW9uIGFkZElk\ncyA9IG5ldyBBcnJheUxpc3QoYWRkaXRpb25zLnNpemUoKSk7DQogICAgICAg\nICAgICBDb2xsZWN0aW9uIHVwSWRzID0gbmV3IEFycmF5TGlzdChuZXdVcGRh\ndGVzLnNpemUoKSk7DQogICAgICAgICAgICBDb2xsZWN0aW9uIGV4SWRzID0g\nbmV3IEFycmF5TGlzdChleGlzdGluZ1VwZGF0ZXMuc2l6ZSgpKTsNCg0KICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0gYWRkaXRpb25zLml0ZXJh\ndG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykNCiAgICAgICAgICAgICAgICBhZGRJ\nZHMuYWRkKCgoRGF0YUNhY2hlUENEYXRhKSBpdGVyLm5leHQoKSkuZ2V0SWQo\nKSk7DQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBuZXdVcGRh\ndGVzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykNCiAgICAgICAgICAg\nICAgICB1cElkcy5hZGQoKChEYXRhQ2FjaGVQQ0RhdGEpIGl0ZXIubmV4dCgp\nKS5nZXRJZCgpKTsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9\nIGV4aXN0aW5nVXBkYXRlcy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsp\nDQogICAgICAgICAgICAgICAgZXhJZHMuYWRkKCgoRGF0YUNhY2hlUENEYXRh\nKSBpdGVyLm5leHQoKSkuZ2V0SWQoKSk7DQoNCiAgICAgICAgICAgIGxvZy50\ncmFjZShzX2xvYy5nZXQoImNhY2hlLWNvbW1pdCIsDQogICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBhZGRJZHMsIHVwSWRzLCBleElkcywgZGVsZXRl\ncyB9KSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVh\nbiBjb250YWlucyhPYmplY3Qga2V5KSB7DQogICAgICAgIERhdGFDYWNoZVBD\nRGF0YSBvID0gZ2V0SW50ZXJuYWwoa2V5KTsNCiAgICAgICAgaWYgKG8gIT0g\nbnVsbCAmJiBvLmlzVGltZWRPdXQoKSkgew0KICAgICAgICAgICAgbyA9IG51\nbGw7DQogICAgICAgICAgICByZW1vdmVJbnRlcm5hbChrZXkpOw0KICAgICAg\nICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAgICAg\nICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXRpbWVvdXQiLCBrZXkp\nKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbyAhPSBudWxsOw0KICAg\nIH0NCg0KICAgIHB1YmxpYyBCaXRTZXQgY29udGFpbnNBbGwoQ29sbGVjdGlv\nbiBrZXlzKSB7DQogICAgICAgIGlmIChrZXlzLmlzRW1wdHkoKSkNCiAgICAg\nICAgICAgIHJldHVybiBFTVBUWV9CSVRTRVQ7DQoNCiAgICAgICAgQml0U2V0\nIHNldCA9IG5ldyBCaXRTZXQoa2V5cy5zaXplKCkpOw0KICAgICAgICBpbnQg\naSA9IDA7DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IGtleXMuaXRl\ncmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7IGkrKykNCiAgICAgICAgICAgIGlm\nIChjb250YWlucyhpdGVyLm5leHQoKSkpDQogICAgICAgICAgICAgICAgc2V0\nLnNldChpKTsNCiAgICAgICAgcmV0dXJuIHNldDsNCiAgICB9DQoNCiAgICBw\ndWJsaWMgRGF0YUNhY2hlUENEYXRhIGdldChPYmplY3Qga2V5KSB7DQogICAg\nICAgIERhdGFDYWNoZVBDRGF0YSBvID0gZ2V0SW50ZXJuYWwoa2V5KTsNCiAg\nICAgICAgaWYgKG8gIT0gbnVsbCAmJiBvLmlzVGltZWRPdXQoKSkgew0KICAg\nICAgICAgICAgbyA9IG51bGw7DQogICAgICAgICAgICByZW1vdmVJbnRlcm5h\nbChrZXkpOw0KICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQ0KICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hl\nLXRpbWVvdXQiLCBrZXkpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChs\nb2cuaXNUcmFjZUVuYWJsZWQoKSkgew0KICAgICAgICAgICAgaWYgKG8gPT0g\nbnVsbCkNCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJj\nYWNoZS1taXNzIiwga2V5KSk7DQogICAgICAgICAgICBlbHNlDQogICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtaGl0Iiwga2V5\nKSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbzsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgRGF0YUNhY2hlUENEYXRhIHB1dChEYXRhQ2FjaGVQQ0Rh\ndGEgZGF0YSkgew0KICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgbyA9IHB1dElu\ndGVybmFsKGRhdGEuZ2V0SWQoKSwgZGF0YSk7DQogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAgIGxvZy50cmFjZShzX2xv\nYy5nZXQoImNhY2hlLXB1dCIsIGRhdGEuZ2V0SWQoKSkpOw0KICAgICAgICBy\nZXR1cm4gKG8gPT0gbnVsbCB8fCBvLmlzVGltZWRPdXQoKSkgPyBudWxsIDog\nbzsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB1cGRhdGUoRGF0YUNhY2hl\nUENEYXRhIGRhdGEpIHsNCiAgICAgICAgaWYgKHJlY2FjaGVVcGRhdGVzKCkp\nDQogICAgICAgICAgICBwdXRJbnRlcm5hbChkYXRhLmdldElkKCksIGRhdGEp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBEYXRhQ2FjaGVQQ0RhdGEgcmVtb3Zl\nKE9iamVjdCBrZXkpIHsNCiAgICAgICAgRGF0YUNhY2hlUENEYXRhIG8gPSBy\nZW1vdmVJbnRlcm5hbChrZXkpOw0KICAgICAgICBpZiAobyAhPSBudWxsICYm\nIG8uaXNUaW1lZE91dCgpKQ0KICAgICAgICAgICAgbyA9IG51bGw7DQogICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkgew0KICAgICAgICAgICAg\naWYgKG8gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uoc19s\nb2MuZ2V0KCJjYWNoZS1yZW1vdmUtbWlzcyIsIGtleSkpOw0KICAgICAgICAg\nICAgZWxzZQ0KICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQo\nImNhY2hlLXJlbW92ZS1oaXQiLCBrZXkpKTsNCiAgICAgICAgfQ0KICAgICAg\nICByZXR1cm4gbzsNCiAgICB9DQoNCiAgICBwdWJsaWMgQml0U2V0IHJlbW92\nZUFsbChDb2xsZWN0aW9uIGtleXMpIHsNCiAgICAgICAgaWYgKGtleXMuaXNF\nbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0JJVFNFVDsNCg0K\nICAgICAgICBCaXRTZXQgc2V0ID0gbmV3IEJpdFNldChrZXlzLnNpemUoKSk7\nDQogICAgICAgIGludCBpID0gMDsNCiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndGVyID0ga2V5cy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgaSsrKQ0K\nICAgICAgICAgICAgaWYgKHJlbW92ZShpdGVyLm5leHQoKSkgIT0gbnVsbCkN\nCiAgICAgICAgICAgICAgICBzZXQuc2V0KGkpOw0KICAgICAgICByZXR1cm4g\nc2V0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSB0aGUgb2Jq\nZWN0cyBvZiB0aGUgZ2l2ZW4gY2xhc3MgZnJvbSB0aGUgY2FjaGUuDQogICAg\nICovDQogICAgcHVibGljIHZvaWQgcmVtb3ZlQWxsKENsYXNzIGNscywgYm9v\nbGVhbiBzdWJDbGFzc2VzKSB7DQogICAgICAgIHJlbW92ZUFsbEludGVybmFs\nKGNscywgc3ViQ2xhc3Nlcyk7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xl\nYW4gcGluKE9iamVjdCBrZXkpIHsNCiAgICAgICAgYm9vbGVhbiBib29sID0g\ncGluSW50ZXJuYWwoa2V5KTsNCiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5h\nYmxlZCgpKSB7DQogICAgICAgICAgICBpZiAoYm9vbCkNCiAgICAgICAgICAg\nICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1waW4taGl0Iiwga2V5\nKSk7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKHNfbG9jLmdldCgiY2FjaGUtcGluLW1pc3MiLCBrZXkpKTsNCiAgICAg\nICAgfQ0KICAgICAgICByZXR1cm4gYm9vbDsNCiAgICB9DQoNCiAgICBwdWJs\naWMgQml0U2V0IHBpbkFsbChDb2xsZWN0aW9uIGtleXMpIHsNCiAgICAgICAg\naWYgKGtleXMuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuIEVNUFRZ\nX0JJVFNFVDsNCg0KICAgICAgICBCaXRTZXQgc2V0ID0gbmV3IEJpdFNldChr\nZXlzLnNpemUoKSk7DQogICAgICAgIGludCBpID0gMDsNCiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdGVyID0ga2V5cy5pdGVyYXRvcigpOyBpdGVyLmhhc05l\neHQoKTsgaSsrKQ0KICAgICAgICAgICAgaWYgKHBpbihpdGVyLm5leHQoKSkp\nDQogICAgICAgICAgICAgICAgc2V0LnNldChpKTsNCiAgICAgICAgcmV0dXJu\nIHNldDsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBwaW5BbGwoQ2xhc3Mg\nY2xzLCBib29sZWFuIHN1YnMpIHsNCiAgICAgICAgaWYgKGxvZy5pc1dhcm5F\nbmFibGVkKCkpDQogICAgICAgICAgICBsb2cud2FybihzX2xvYy5nZXQoImNh\nY2hlLWNsYXNzLXBpbiIsIGdldE5hbWUoKSkpOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBib29sZWFuIHVucGluKE9iamVjdCBrZXkpIHsNCiAgICAgICAgYm9v\nbGVhbiBib29sID0gdW5waW5JbnRlcm5hbChrZXkpOw0KICAgICAgICBpZiAo\nbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsNCiAgICAgICAgICAgIGlmIChib29s\nKQ0KICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hl\nLXVucGluLWhpdCIsIGtleSkpOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAg\nICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXVucGluLW1p\nc3MiLCBrZXkpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYm9vbDsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgQml0U2V0IHVucGluQWxsKENvbGxlY3Rp\nb24ga2V5cykgew0KICAgICAgICBpZiAoa2V5cy5pc0VtcHR5KCkpDQogICAg\nICAgICAgICByZXR1cm4gRU1QVFlfQklUU0VUOw0KDQogICAgICAgIEJpdFNl\ndCBzZXQgPSBuZXcgQml0U2V0KGtleXMuc2l6ZSgpKTsNCiAgICAgICAgaW50\nIGkgPSAwOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBrZXlzLml0\nZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyBpKyspDQogICAgICAgICAgICBp\nZiAodW5waW4oaXRlci5uZXh0KCkpKQ0KICAgICAgICAgICAgICAgIHNldC5z\nZXQoaSk7DQogICAgICAgIHJldHVybiBzZXQ7DQogICAgfQ0KDQogICAgcHVi\nbGljIHZvaWQgdW5waW5BbGwoQ2xhc3MgY2xzLCBib29sZWFuIHN1YnMpIHsN\nCiAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpDQogICAgICAgICAg\nICBsb2cud2FybihzX2xvYy5nZXQoImNhY2hlLWNsYXNzLXVucGluIiwgZ2V0\nTmFtZSgpKSk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgY2xlYXIoKSB7\nDQogICAgICAgIGNsZWFySW50ZXJuYWwoKTsNCiAgICAgICAgaWYgKGxvZy5p\nc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9j\nLmdldCgiY2FjaGUtY2xlYXIiLCBnZXROYW1lKCkpKTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsNCiAgICAgICAgY2xvc2UodHJ1ZSk7\nDQogICAgfQ0KDQogICAgcHJvdGVjdGVkIHZvaWQgY2xvc2UoYm9vbGVhbiBj\nbGVhcikgew0KICAgICAgICBpZiAoIV9jbG9zZWQpIHsNCiAgICAgICAgICAg\nIGlmIChjbGVhcikNCiAgICAgICAgICAgICAgICBjbGVhckludGVybmFsKCk7\nDQogICAgICAgICAgICBfY2xvc2VkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAg\nIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2VkKCkgew0KICAgICAg\nICByZXR1cm4gX2Nsb3NlZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBh\nZGRFeHBpcmF0aW9uTGlzdGVuZXIoRXhwaXJhdGlvbkxpc3RlbmVyIGxpc3Rl\nbikgew0KICAgICAgICBhZGRMaXN0ZW5lcihsaXN0ZW4pOw0KICAgIH0NCg0K\nICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZUV4cGlyYXRpb25MaXN0ZW5lcihF\neHBpcmF0aW9uTGlzdGVuZXIgbGlzdGVuKSB7DQogICAgICAgIHJldHVybiBy\nZW1vdmVMaXN0ZW5lcihsaXN0ZW4pOw0KICAgIH0NCg0KICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7DQogICAgICAgIHJldHVybiAiWyIgKyBzdXBl\nci50b1N0cmluZygpICsgIjoiICsgX25hbWUgKyAiXSI7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgcGFydCBvZiB0aGUge0Bs\naW5rIFJlbW90ZUNvbW1pdExpc3RlbmVyfSBpbnRlcmZhY2UuIElmDQogICAg\nICogeW91ciBjYWNoZSBzdWJjbGFzcyByZWxpZXMgb24gT3BlbkpQQSBmb3Ig\nY2x1c3RlcmluZyBzdXBwb3J0LCBtYWtlIGl0DQogICAgICogaW1wbGVtZW50\nIDxjb2RlPlJlbW90ZUNvbW1pdExpc3RlbmVyPC9jb2RlPi4gVGhpcyBtZXRo\nb2Qgd2lsbCB0YWtlDQogICAgICogY2FyZSBvZiBpbnZhbGlkYXRpbmcgZW50\ncmllcyBmcm9tIHJlbW90ZSBjb21taXRzLg0KICAgICAqLw0KICAgIHB1Ymxp\nYyB2b2lkIGFmdGVyQ29tbWl0KFJlbW90ZUNvbW1pdEV2ZW50IGV2ZW50KSB7\nDQogICAgICAgIGlmIChfY2xvc2VkKQ0KICAgICAgICAgICAgcmV0dXJuOw0K\nDQogICAgICAgIGlmIChldmVudC5nZXRQYXlsb2FkVHlwZSgpID09IFJlbW90\nZUNvbW1pdEV2ZW50LlBBWUxPQURfRVhURU5UUykgew0KICAgICAgICAgICAg\ncmVtb3ZlQWxsVHlwZU5hbWVzSW50ZXJuYWwoZXZlbnQuZ2V0VXBkYXRlZFR5\ncGVOYW1lcygpKTsNCiAgICAgICAgICAgIHJlbW92ZUFsbFR5cGVOYW1lc0lu\ndGVybmFsKGV2ZW50LmdldERlbGV0ZWRUeXBlTmFtZXMoKSk7DQogICAgICAg\nIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBkcm9wIGFsbCB0aGUgY29tbWl0\ndGVkIE9JRHMsIGV4Y2VwdGluZyBicmFuZA0KICAgICAgICAgICAgLy8gbmV3\nIE9JRHMuIGJyYW5kIG5ldyBPSURzIGVpdGhlciB3b24ndCBiZSBpbg0KICAg\nICAgICAgICAgLy8gdGhlIGNhY2hlLCBvciBpZiB0aGV5IGFyZSwgd2lsbCBi\nZSBtb3JlIHVwIHRvIGRhdGUNCiAgICAgICAgICAgIHJlbW92ZUFsbEludGVy\nbmFsKGV2ZW50LmdldFVwZGF0ZWRPYmplY3RJZHMoKSk7DQogICAgICAgICAg\nICByZW1vdmVBbGxJbnRlcm5hbChldmVudC5nZXREZWxldGVkT2JqZWN0SWRz\nKCkpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW52\nb2tlIHdoZW4gYSBrZXkgaXMgcmVtb3ZlZCBmcm9tIHRoaXMgY2FjaGUuIFBy\nb3BhZ2F0ZXMgdGhlDQogICAgICogZXhwaXJhdGlvbiBldmVudCBvbiB0byBh\nbGwgZXhwaXJhdGlvbiBsaXN0ZW5lcnMgcmVnaXN0ZXJlZA0KICAgICAqIHdp\ndGggdGhpcyBjbGFzcy4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgdm9pZCBr\nZXlSZW1vdmVkKE9iamVjdCBrZXksIGJvb2xlYW4gZXhwaXJlZCkgew0KICAg\nICAgICAvLyBOb3RpZnkgYW55IGV4cGlyYXRpb24gbGlzdGVuZXJzIG9mIHRo\nZSBleHBpcmF0aW9uLg0KICAgICAgICBpZiAoaGFzTGlzdGVuZXJzKCkpDQog\nICAgICAgICAgICBmaXJlRXZlbnQobmV3IEV4cGlyYXRpb25FdmVudCh0aGlz\nLCBrZXksIGV4cGlyZWQpKTsNCg0KICAgICAgICBpZiAoZXhwaXJlZCAmJiBs\nb2cuaXNUcmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAgIGxvZy50cmFjZShz\nX2xvYy5nZXQoImNhY2hlLWV4cGlyZWQiLCBrZXkpKTsNCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBSZXR1cm4gPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdXBk\nYXRlcyB0byBkYXRhIGFscmVhZHkgaW4gdGhlDQogICAgICogY2FjaGUgKGVp\ndGhlciBpbiB7QGxpbmsgI2NvbW1pdH0gb3IgdGhlIHtAbGluayAjdXBkYXRl\nfSkNCiAgICAgKiBzaG91bGQgYmUgcHV0IGJhY2sgaW50byB0aGUgY2FjaGUu\nIFJldHVybnMgZmFsc2UgYnkgZGVmYXVsdC4NCiAgICAgKi8NCiAgICBwcm90\nZWN0ZWQgYm9vbGVhbiByZWNhY2hlVXBkYXRlcygpIHsNCiAgICAgICAgcmV0\ndXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0\naGUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gb2lkLg0KICAgICAqLw0KICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBEYXRhQ2FjaGVQQ0RhdGEgZ2V0SW50ZXJuYWwo\nT2JqZWN0IG9pZCk7DQoNCiAgICAvKioNCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIG9iamVjdCB0byB0aGUgY2FjaGUsIHJldHVybmluZyB0aGUgb2xkIG9iamVj\ndCB1bmRlciB0aGUNCiAgICAgKiBnaXZlbiBvaWQuDQogICAgICovDQogICAg\ncHJvdGVjdGVkIGFic3RyYWN0IERhdGFDYWNoZVBDRGF0YSBwdXRJbnRlcm5h\nbChPYmplY3Qgb2lkLA0KICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgcGMpOw0K\nDQogICAgLyoqDQogICAgICogQWxsIGFsbCBvZiB0aGUgZ2l2ZW4gb2JqZWN0\ncyB0byB0aGUgY2FjaGUuDQogICAgICovDQogICAgcHJvdGVjdGVkIHZvaWQg\ncHV0QWxsSW50ZXJuYWwoQ29sbGVjdGlvbiBwY3MpIHsNCiAgICAgICAgRGF0\nYUNhY2hlUENEYXRhIHBjOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIg\nPSBwY3MuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KSB7DQogICAgICAg\nICAgICBwYyA9IChEYXRhQ2FjaGVQQ0RhdGEpIGl0ZXIubmV4dCgpOw0KICAg\nICAgICAgICAgcHV0SW50ZXJuYWwocGMuZ2V0SWQoKSwgcGMpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlIHRoZSBvYmpl\nY3QgdW5kZXIgdGhlIGdpdmVuIG9pZCBmcm9tIHRoZSBjYWNoZS4NCiAgICAg\nKi8NCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRGF0YUNhY2hlUENEYXRhIHJl\nbW92ZUludGVybmFsKE9iamVjdCBvaWQpOw0KDQogICAgLyoqDQogICAgICog\nRXZpY3Qgb2JqZWN0cyBpbiBjYWNoZSBieSBjbGFzcy4NCiAgICAgKi8NCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCByZW1vdmVBbGxJbnRlcm5hbChD\nbGFzcyBjbHMsIGJvb2xlYW4gc3ViY2xhc3Nlcyk7DQoNCiAgICAvKioNCiAg\nICAgKiBSZW1vdmUgYWxsIG9iamVjdHMgdW5kZXIgdGhlIGdpdmVuIG9pZHMg\nZnJvbSB0aGUgY2FjaGUuDQogICAgICovDQogICAgcHJvdGVjdGVkIHZvaWQg\ncmVtb3ZlQWxsSW50ZXJuYWwoQ29sbGVjdGlvbiBvaWRzKSB7DQogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRlciA9IG9pZHMuaXRlcmF0b3IoKTsgaXRlci5o\nYXNOZXh0KCk7KQ0KICAgICAgICAgICAgcmVtb3ZlSW50ZXJuYWwoaXRlci5u\nZXh0KCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSBhbGwg\nb2JqZWN0cyBvZiB0aGUgZ2l2ZW4gY2xhc3MgbmFtZXMgZnJvbSB0aGUgY2Fj\naGUuDQogICAgICovDQogICAgcHJvdGVjdGVkIHZvaWQgcmVtb3ZlQWxsVHlw\nZU5hbWVzSW50ZXJuYWwoQ29sbGVjdGlvbiBjbGFzc05hbWVzKSB7DQogICAg\nICAgIENvbGxlY3Rpb24gY2xhc3NlcyA9IENhY2hlcy5hZGRUeXBlc0J5TmFt\nZShjb25mLCBjbGFzc05hbWVzLCBudWxsKTsNCiAgICAgICAgaWYgKGNsYXNz\nZXMgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICBD\nbGFzcyBjbHM7DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IGNsYXNz\nZXMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAg\nICBjbHMgPSAoQ2xhc3MpIGl0ZXIubmV4dCgpOw0KICAgICAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShzX2xvYy5nZXQoImNhY2hlLXJlbW92ZWNsYXNzIiwgY2xzLmdldE5h\nbWUoKSkpOw0KICAgICAgICAgICAgcmVtb3ZlQWxsSW50ZXJuYWwoY2xzLCBm\nYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBD\nbGVhciB0aGUgY2FjaGUuDQogICAgICovDQogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IHZvaWQgY2xlYXJJbnRlcm5hbCgpOw0KDQogICAgLyoqDQogICAgICog\nUGluIGFuIG9iamVjdCB0byB0aGUgY2FjaGUuDQogICAgICovDQogICAgcHJv\ndGVjdGVkIGFic3RyYWN0IGJvb2xlYW4gcGluSW50ZXJuYWwoT2JqZWN0IG9p\nZCk7DQoNCiAgICAvKioNCiAgICAgKiBVbnBpbiBhbiBvYmplY3QgZnJvbSB0\naGUgY2FjaGUuDQogICAgICovDQogICAgcHJvdGVjdGVkIGFic3RyYWN0IGJv\nb2xlYW4gdW5waW5JbnRlcm5hbChPYmplY3Qgb2lkKTsNCg0KICAgIC8vIC0t\nLS0tLS0tLS0gQ29uZmlndXJhYmxlIGltcGxlbWVudGF0aW9uIC0tLS0tLS0t\nLS0NCg0KICAgIHB1YmxpYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29uZmln\ndXJhdGlvbiBjb25mKSB7DQogICAgICAgIHRoaXMuY29uZiA9IChPcGVuSlBB\nQ29uZmlndXJhdGlvbikgY29uZjsNCiAgICAgICAgdGhpcy5sb2cgPSBjb25m\nLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfREFUQUNBQ0hFKTsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3VyYXRpb24o\nKSB7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJhdGlv\nbigpIHsNCiAgICAgICAgaWYgKF9uYW1lID09IG51bGwpDQogICAgICAgICAg\nICBzZXROYW1lKE5BTUVfREVGQVVMVCk7DQogICAgfQ0KDQogICAgLy8gLS0t\nLS0tLS0tLSBBYnN0cmFjdEV2ZW50TWFuYWdlciBpbXBsZW1lbnRhdGlvbiAt\nLS0tLS0tLS0tDQoNCiAgICBwcm90ZWN0ZWQgdm9pZCBmaXJlRXZlbnQoT2Jq\nZWN0IGV2ZW50LCBPYmplY3QgbGlzdGVuZXIpIHsNCiAgICAgICAgRXhwaXJh\ndGlvbkxpc3RlbmVyIGxpc3RlbiA9IChFeHBpcmF0aW9uTGlzdGVuZXIpIGxp\nc3RlbmVyOw0KICAgICAgICBFeHBpcmF0aW9uRXZlbnQgZXYgPSAoRXhwaXJh\ndGlvbkV2ZW50KSBldmVudDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAg\nIGxpc3Rlbi5vbkV4cGlyZShldik7DQogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7DQogICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQo\nKSkNCiAgICAgICAgICAgICAgICBsb2cud2FybihzX2xvYy5nZXQoImV4cC1s\naXN0ZW5lci1leCIpLCBlKTsNCgkJfQ0KCX0NCg0KICAgIC8qKg0KICAgICAq\nIFJldHVybnMgdGhlIG9iamVjdHMgZm9yIHRoZSBnaXZlbiBrZXkgTGlzdC4N\nCiAgICAgKi8NCiAgICBwdWJsaWMgTWFwIGdldEFsbChMaXN0IGtleXMpIHsN\nCiAgICAgICAgTWFwIHJlc3VsdE1hcCA9IG5ldyBIYXNoTWFwKGtleXMuc2l6\nZSgpKTsNCiAgICAgICAgZm9yKGludCBpPTA7IGk8a2V5cy5zaXplKCk7IGkr\nKykNCiAgICAgICAgICAgIHJlc3VsdE1hcC5wdXQoa2V5cy5nZXQoaSksIGdl\ndChrZXlzLmdldChpKSkpOw0KICAgICAgICByZXR1cm4gcmVzdWx0TWFwOw0K\nICAgIH0NCn0NCg==\n","encoding":"base64"}

