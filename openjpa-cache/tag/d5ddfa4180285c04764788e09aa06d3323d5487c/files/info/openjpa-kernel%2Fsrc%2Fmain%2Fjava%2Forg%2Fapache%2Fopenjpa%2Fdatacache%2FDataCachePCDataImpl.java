{"sha":"130e97fa41df7d209e6c9feb67c3cbc906351eea","node_id":"MDQ6QmxvYjIwNjM2NDoxMzBlOTdmYTQxZGY3ZDIwOWU2YzlmZWI2N2MzY2JjOTA2MzUxZWVh","size":6832,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/130e97fa41df7d209e6c9feb67c3cbc906351eea","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5CaXRTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5BYnN0cmFjdFBDRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuUENEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5QQ0RhdGFJbXBsOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CgovKioKICogU3BlY2lhbGl6\nZWQge0BsaW5rIFBDRGF0YX0gaW1wbGVtZW50YXRpb24gZm9yIGRhdGEgY2Fj\naGluZy4gVGhpcwogKiBpbXBsZW1lbnRhdGlvbiBpcyBwcm9wZXJseSBzeW5j\naHJvbml6ZWQuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqLwpw\ndWJsaWMgY2xhc3MgRGF0YUNhY2hlUENEYXRhSW1wbAogICAgZXh0ZW5kcyBQ\nQ0RhdGFJbXBsCiAgICBpbXBsZW1lbnRzIERhdGFDYWNoZVBDRGF0YSB7Cgog\nICAgcHJpdmF0ZSBmaW5hbCBsb25nIF9leHA7CgogICAgLyoqCiAgICAgKiBD\nb25zdHJ1Y3Rvci4KICAgICAqLwogICAgcHVibGljIERhdGFDYWNoZVBDRGF0\nYUltcGwoT2JqZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgc3VwZXIob2lkLCBtZXRhKTsKCiAgICAgICAgaW50IHRpbWVvdXQgPSBt\nZXRhLmdldERhdGFDYWNoZVRpbWVvdXQoKTsKICAgICAgICBpZiAodGltZW91\ndCA+IDApCiAgICAgICAgICAgIF9leHAgPSBTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKSArIHRpbWVvdXQ7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\nZXhwID0gLTE7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUaW1lZE91\ndCgpIHsKICAgICAgICByZXR1cm4gX2V4cCAhPSAtMSAmJiBfZXhwIDwgU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICB9CgogICAgcHVibGljIHN5\nbmNocm9uaXplZCBPYmplY3QgZ2V0RGF0YShpbnQgaW5kZXgpIHsKICAgICAg\nICByZXR1cm4gc3VwZXIuZ2V0RGF0YShpbmRleCk7CiAgICB9CgogICAgcHVi\nbGljIHN5bmNocm9uaXplZCB2b2lkIHNldERhdGEoaW50IGluZGV4LCBPYmpl\nY3QgdmFsKSB7CiAgICAgICAgc3VwZXIuc2V0RGF0YShpbmRleCwgdmFsKTsK\nICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgY2xlYXJEYXRh\nKGludCBpbmRleCkgewogICAgICAgIHN1cGVyLmNsZWFyRGF0YShpbmRleCk7\nCiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCBPYmplY3QgZ2V0SW1w\nbERhdGEoKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmdldEltcGxEYXRhKCk7\nCiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIHNldEltcGxE\nYXRhKE9iamVjdCB2YWwpIHsKICAgICAgICBzdXBlci5zZXRJbXBsRGF0YSh2\nYWwpOwogICAgfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IGdl\ndEltcGxEYXRhKGludCBpbmRleCkgewogICAgICAgIHJldHVybiBzdXBlci5n\nZXRJbXBsRGF0YShpbmRleCk7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9u\naXplZCB2b2lkIHNldEltcGxEYXRhKGludCBpbmRleCwgT2JqZWN0IHZhbCkg\newogICAgICAgIHN1cGVyLnNldEltcGxEYXRhKGluZGV4LCB2YWwpOwogICAg\nfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IGdldEludGVybWVk\naWF0ZShpbnQgaW5kZXgpIHsKICAgICAgICByZXR1cm4gc3VwZXIuZ2V0SW50\nZXJtZWRpYXRlKGluZGV4KTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIHZvaWQgc2V0SW50ZXJtZWRpYXRlKGludCBpbmRleCwgT2JqZWN0IHZh\nbCkgewogICAgICAgIHN1cGVyLnNldEludGVybWVkaWF0ZShpbmRleCwgdmFs\nKTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gaXNM\nb2FkZWQoaW50IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmlzTG9h\nZGVkKGluZGV4KTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZv\naWQgc2V0TG9hZGVkKGludCBpbmRleCwgYm9vbGVhbiBsb2FkZWQpIHsKICAg\nICAgICBzdXBlci5zZXRMb2FkZWQoaW5kZXgsIGxvYWRlZCk7CiAgICB9Cgog\nICAgcHVibGljIHN5bmNocm9uaXplZCBPYmplY3QgZ2V0VmVyc2lvbigpIHsK\nICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VmVyc2lvbigpOwogICAgfQoKICAg\nIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBzZXRWZXJzaW9uKE9iamVjdCB2\nZXJzaW9uKSB7CiAgICAgICAgc3VwZXIuc2V0VmVyc2lvbih2ZXJzaW9uKTsK\nICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgc3RvcmUoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIHN1cGVyLnN0b3JlKHNt\nKTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgc3RvcmUo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcykgewogICAg\nICAgIHN1cGVyLnN0b3JlKHNtLCBmaWVsZHMpOwogICAgfQoKICAgIC8qKgog\nICAgICogU3RvcmUgZmllbGQtbGV2ZWwgaW5mb3JtYXRpb24gZnJvbSB0aGUg\nZ2l2ZW4gc3RhdGUgbWFuYWdlci4KICAgICAqIFNwZWNpYWwgcHJvY2VzcyBv\nZiBjaGVja2luZyBpZiB0aGUgY2FjaGVkIGNvbGxlY3Rpb24gZGF0YSBpcyBv\ndXQgb2Ygb3JkZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHN0b3Jl\nRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBm\nbWQpIHsKICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBmbWQu\nTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICBpbnQgaW5kZXggPSBmbWQuZ2V0SW5kZXgoKTsKCiAgICAgICAgLy8gaWYg\ndGhlIGZpZWxkIGlzIGEgY29sbGVjdGlvbiBhbmQgaGFzICJvcmRlciBieSIg\nc2V0LCBkb24ndCBjYWNoZQogICAgICAgIC8vIGl0IGlmIHRoaXMgc3RvcmUg\naXMgY29taW5nIGZyb20gYSBjcmVhdGUgb3IgdXBkYXRlIChpLmUuLCBvbmx5\nCiAgICAgICAgLy8gZW5saXN0IGluIGNhY2hlIGlmIHRoaXMgaXMgY29taW5n\nIGZyb20gYSBkYXRhYmFzZSByZWFkKS4KICAgICAgICBpZiAoZm1kLmdldE9y\nZGVycygpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaWYgKHNtLmdldFBD\nU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVcpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0\nZS5QRElSVFkpIHsKICAgICAgICAgICAgICAgIGNsZWFyRGF0YShpbmRleCk7\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHN1cGVyLnN0b3JlRmllbGQoc20sIGZtZCk7CgogICAg\nICAgIC8vIElmIHRoaXMgZmllbGQgaXMgdXNlZCBpbiAib3JkZXIgYnkiLCB3\nZSBuZWVkIHRvIGludmFsaWRhdGUgY2FjaGUKICAgICAgICAvLyBmb3IgdGhl\nIGNvbGxlY3Rpb24gdGhhdCByZWZlciB0byB0aGlzIGZpZWxkLgogICAgICAg\nIGlmICgoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUERJUlRZKSAmJiBm\nbWQuaXNVc2VkSW5PcmRlckJ5KCkpIHsKICAgICAgICAgICAgY2xlYXJJbnZl\ncnNlUmVsYXRpb25DYWNoZShzbSwgZm1kKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGlzIGZpZWxkIGlzIGluIHVzZSBv\nZiAib3JkZXIgYnkiIGJ5IG90aGVyIGZpZWxkIGNvbGxlY3Rpb25zCiAgICAg\nKiBpbiBpbnZlcnNlIHJlbGF0aW9uLiBJZiBpdCBpcywgY2xlYXIgdGhlIG90\naGVyIGZpZWxkIGNhY2hlIGJlY2F1c2UgaXQKICAgICAqIGNvdWxkIGJlIG91\ndCBvZiBvcmRlci4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJJ\nbnZlcnNlUmVsYXRpb25DYWNoZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBjbWQgPSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmaWVsZHMgPSBjbWQuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGludmVyc2VzID0gZmllbGRzW2ldLmdl\ndEludmVyc2VNZXRhRGF0YXMoKTsKICAgICAgICAgICAgaWYgKGludmVyc2Vz\nLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgaW52ZXJzZXMubGVuZ3RoOyBq\nKyspIHsKICAgICAgICAgICAgICAgIGlmIChpbnZlcnNlc1tqXS5nZXRPcmRl\nckRlY2xhcmF0aW9uKCkKICAgICAgICAgICAgICAgICAgICAuaW5kZXhPZihm\nbWQuZ2V0TmFtZSgpKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIERh\ndGFDYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hl\nKCk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IG9pZCA9IHNtLmdldENv\nbnRleHQoKS5nZXRPYmplY3RJZChzbS5mZXRjaChpKSk7CiAgICAgICAgICAg\nICAgICAgICAgRGF0YUNhY2hlUENEYXRhIGRhdGEgPSBjYWNoZSA9PSBudWxs\nID8gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICA6IGNhY2hlLmdldChv\naWQpOwogICAgICAgICAgICAgICAgICAgIGlmICgoZGF0YSAhPSBudWxsKSAm\nJgogICAgICAgICAgICAgICAgICAgICAgICAoZGF0YSBpbnN0YW5jZW9mIERh\ndGFDYWNoZVBDRGF0YUltcGwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICgoRGF0YUNhY2hlUENEYXRhSW1wbCkgZGF0YSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC5jbGVhckRhdGEoaW52ZXJzZXNbal0uZ2V0SW5kZXgo\nKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBP\nYmplY3QgdG9EYXRhKEZpZWxkTWV0YURhdGEgZm1kLCBPYmplY3QgdmFsLCBT\ndG9yZUNvbnRleHQgY3R4KSB7CiAgICAgICAgLy8gYXZvaWQgY2FjaGluZyBs\nYXJnZSByZXN1bHQgc2V0IGZpZWxkcwogICAgICAgIGlmIChmbWQuaXNMUlMo\nKSB8fCBmbWQuaXNTdHJlYW0oKSkKICAgICAgICAgICAgcmV0dXJuIE5VTEw7\nCiAgICAgICAgcmV0dXJuIHN1cGVyLnRvRGF0YShmbWQsIHZhbCwgY3R4KTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvTmVzdGVkRGF0YShWYWx1\nZU1ldGFEYXRhIHZtZCwgT2JqZWN0IHZhbCwKICAgICAgICBTdG9yZUNvbnRl\neHQgY3R4KSB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gZG9uJ3QgdHJ5IHRvIGNhY2hl\nIG5lc3RlZCBjb250YWluZXJzCiAgICAgICAgc3dpdGNoICh2bWQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAg\nICAgICByZXR1cm4gTlVMTDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHJldHVybiBzdXBlci50b05lc3RlZERhdGEodm1kLCB2YWws\nIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBBYnN0cmFjdFBD\nRGF0YSBuZXdFbWJlZGRlZFBDRGF0YShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRhQ2FjaGVQQ0RhdGFJbXBsKHNt\nLmdldElkKCksIHNtLmdldE1ldGFEYXRhKCkpOwogICAgfQp9Cg==\n","encoding":"base64"}

