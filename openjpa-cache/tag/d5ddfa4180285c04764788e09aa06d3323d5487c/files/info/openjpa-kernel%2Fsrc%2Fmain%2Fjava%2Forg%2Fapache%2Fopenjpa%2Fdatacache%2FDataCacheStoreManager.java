{"sha":"c3c7dbe1230846327e72482c51c371138ca91622","node_id":"MDQ6QmxvYjIwNjM2NDpjM2M3ZGJlMTIzMDg0NjMyN2U3MjQ4MmM1MWMzNzExMzhjYTkxNjIy","size":27223,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c3c7dbe1230846327e72482c51c371138ca91622","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0RhdGFHZW5lcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdTdG9yZU1h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZldGNo\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuTG9ja0xldmVsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CgovKioK\nICogU3RvcmVNYW5hZ2VyIHByb3h5IHRoYXQgZGVsZWdhdGVzIHRvIGEgZGF0\nYSBjYWNoZSB3aGVuIHBvc3NpYmxlLgogKgogKiBAYXV0aG9yIFBhdHJpY2sg\nTGluc2tleQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRGF0YUNh\nY2hlU3RvcmVNYW5hZ2VyCiAgICBleHRlbmRzIERlbGVnYXRpbmdTdG9yZU1h\nbmFnZXIgewoKICAgIC8vIGFsbCB0aGUgc3RhdGUgbWFuYWdlcnMgY2hhbmdl\nZCBpbiB0aGlzIHRyYW5zYWN0aW9uCiAgICBwcml2YXRlIENvbGxlY3Rpb24g\nX2luc2VydHMgPSBudWxsOyAvLyBzdGF0ZW1hbmFnZXJzCiAgICBwcml2YXRl\nIE1hcCBfdXBkYXRlcyA9IG51bGw7IC8vIHN0YXRlbWFuYWdlciAtPiBmbWQg\nc2V0CiAgICBwcml2YXRlIENvbGxlY3Rpb24gX2RlbGV0ZXMgPSBudWxsOyAv\nLyBzdGF0ZW1hbmFnZXJzCgogICAgLy8gdGhlIG93bmluZyBjb250ZXh0CiAg\nICBwcml2YXRlIFN0b3JlQ29udGV4dCBfY3R4ID0gbnVsbDsKCiAgICAvLyBw\nYyBkYXRhIGdlbmVyYXRvcgogICAgcHJpdmF0ZSBQQ0RhdGFHZW5lcmF0b3Ig\nX2dlbiA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAg\nICAqCiAgICAgKiBAcGFyYW0gc20gdGhlIHN0b3JlIG1hbmFnZXIgdG8gZGVs\nZWdhdGUgdG8KICAgICAqLwogICAgcHVibGljIERhdGFDYWNoZVN0b3JlTWFu\nYWdlcihTdG9yZU1hbmFnZXIgc20pIHsKICAgICAgICBzdXBlcihzbSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQg\nY3R4KSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAgICAgICBfZ2VuID0gY3R4\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFu\nY2UoKS4KICAgICAgICAgICAgZ2V0UENEYXRhR2VuZXJhdG9yKCk7CiAgICAg\nICAgc3VwZXIuc2V0Q29udGV4dChjdHgpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGJlZ2luKCkgewogICAgICAgIHN1cGVyLmJlZ2luKCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHN1cGVyLmNvbW1pdCgpOwogICAgICAgICAgICB1cGRhdGVDYWNo\nZXMoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaW5zZXJ0\ncyA9IG51bGw7CiAgICAgICAgICAgIF91cGRhdGVzID0gbnVsbDsKICAgICAg\nICAgICAgX2RlbGV0ZXMgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByb2xsYmFjaygpIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBzdXBlci5yb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIF9pbnNlcnRzID0gbnVsbDsKICAgICAgICAgICAgX3VwZGF0\nZXMgPSBudWxsOwogICAgICAgICAgICBfZGVsZXRlcyA9IG51bGw7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogRXZpY3QgYWxsIG1lbWJlcnMg\nb2YgdGhlIGdpdmVuIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBldmljdFR5cGVzKENvbGxlY3Rpb24gY2xhc3NlcykgewogICAgICAgIGlm\nIChjbGFzc2VzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgbWRyID0gX2N0eC5nZXRDb25maWd1\ncmF0aW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUlu\nc3RhbmNlKCk7CiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gX2N0eC5n\nZXRDbGFzc0xvYWRlcigpOwoKICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAg\nRGF0YUNhY2hlIGNhY2hlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nY2xhc3Nlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBjbHMgPSAoQ2xhc3MpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGNh\nY2hlID0gbWRyLmdldE1ldGFEYXRhKGNscywgbG9hZGVyLCBmYWxzZSkuZ2V0\nRGF0YUNhY2hlKCk7CiAgICAgICAgICAgIGlmIChjYWNoZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlQWxsKGNscywgZmFsc2UpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgY2Fj\naGVzIHdpdGggdGhlIGNvbW1pdHRlZCBpbnNlcnRzLCB1cGRhdGVzLCBhbmQg\nZGVsZXRlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUNhY2hl\ncygpIHsKICAgICAgICAvLyBtYXAgZWFjaCBkYXRhIGNhY2hlIHRvIHRoZSBt\nb2RpZmljYXRpb25zIHdlIG5lZWQgdG8gcGVyZm9ybQogICAgICAgIE1hcCBt\nb2RNYXAgPSBudWxsOwogICAgICAgIE1vZGlmaWNhdGlvbnMgbW9kczsKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtOwogICAgICAgIERhdGFDYWNo\nZVBDRGF0YSBkYXRhOwogICAgICAgIERhdGFDYWNoZSBjYWNoZTsKCiAgICAg\nICAgLy8gY3JlYXRlIHBjIGRhdGFzIGZvciBpbnNlcnRzCiAgICAgICAgaWYg\nKF9jdHguZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSAmJiBfaW5zZXJ0cyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2luc2Vy\ndHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0\nYUNhY2hlKCk7CiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAg\nICBpZiAobW9kTWFwID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbW9k\nTWFwID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIG1vZHMgPSBn\nZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwogICAgICAgICAgICAg\nICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgICAgICBkYXRh\nLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgIG1vZHMuYWRkaXRpb25zLmFk\nZChuZXcgUENEYXRhSG9sZGVyKGRhdGEsIHNtKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSBwY2RhdGFzIGZvciB1cGRh\ndGVzCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIGlmIChfdXBk\nYXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIEJpdFNldCBmaWVsZHM7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3VwZGF0ZXMuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIpIGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgZmllbGRz\nID0gKEJpdFNldCkgZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgICAg\nICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAg\nICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpdCdzIG9r\nIG5vdCB0byBjbG9uZSB0aGUgb2JqZWN0IHRoYXQgd2UgZ2V0IGZyb20gdGhl\nIGNhY2hlLAogICAgICAgICAgICAgICAgLy8gc2luY2Ugd2UncmUgaW5zaWRl\nIHRoZSBjb21taXQoKSBtZXRob2QsIHNvIGFueSBtb2RpZmljYXRpb25zCiAg\nICAgICAgICAgICAgICAvLyB0byB0aGUgdW5kZXJseWluZyBjYWNoZSBhcmUg\ndmFsaWQuIElmIHRoZSBjb21taXQgaGFkIG5vdAogICAgICAgICAgICAgICAg\nLy8gYWxyZWFkeSBzdWNjZWVkZWQsIHRoZW4gd2UnZCB3YW50IHRvIGNsb25l\nIHRoZSByZXRyaWV2ZWQKICAgICAgICAgICAgICAgIC8vIG9iamVjdC4KICAg\nICAgICAgICAgICAgIGlmIChtb2RNYXAgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBtb2RNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAg\nICAgZGF0YSA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAg\nICAgICAgICAgIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2Fj\naGUpOwoKICAgICAgICAgICAgICAgIC8vIGRhdGEgc2hvdWxkIGFsd2F5cyBi\nZSBub24tbnVsbCwgc2luY2UgdGhlIG9iamVjdCBpcwogICAgICAgICAgICAg\nICAgLy8gZGlydHksIGJ1dCBtYXliZSBpdCBnb3QgZHJvcHBlZCBmcm9tIHRo\nZSBjYWNoZSBpbiB0aGUKICAgICAgICAgICAgICAgIC8vIGludGVyaW0KICAg\nICAgICAgICAgICAgIGlmIChkYXRhID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBkYXRhID0gbmV3UENEYXRhKHNtKTsKICAgICAgICAgICAgICAg\nICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgICAgICBtb2Rz\nLm5ld1VwZGF0ZXMuYWRkKG5ldyBQQ0RhdGFIb2xkZXIoZGF0YSwgc20pKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nZGF0YS5zdG9yZShzbSwgZmllbGRzKTsKICAgICAgICAgICAgICAgICAgICBt\nb2RzLmV4aXN0aW5nVXBkYXRlcy5hZGQobmV3IFBDRGF0YUhvbGRlcihkYXRh\nLCBzbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyByZW1vdmUgcGNkYXRhcyBmb3IgZGVsZXRlcwog\nICAgICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gX2RlbGV0ZXMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBjYWNoZSA9\nIHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAg\nICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICBpZiAobW9kTWFwID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgbW9kTWFwID0gbmV3IEhhc2hNYXAoKTsK\nICAgICAgICAgICAgICAgIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1vZE1h\ncCwgY2FjaGUpOwogICAgICAgICAgICAgICAgbW9kcy5kZWxldGVzLmFkZChz\nbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gbm90aWZ5IHRoZSBjYWNoZXMgb2YgdGhlIGNoYW5nZXMKICAg\nICAgICBpZiAobW9kTWFwICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBtb2RNYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFw\nLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgY2FjaGUgPSAo\nRGF0YUNhY2hlKSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIG1v\nZHMgPSAoTW9kaWZpY2F0aW9ucykgZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAg\nICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UncmUgbm90IGNhY2hpbmcgb2xk\nIHZlcnNpb25zCiAgICAgICAgICAgICAgICBjYWNoZS53cml0ZUxvY2soKTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdHJh\nbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoY2FjaGUsIG1vZHMuYWRkaXRp\nb25zKTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25T\nYWZlUENEYXRhcyhjYWNoZSwgbW9kcy5uZXdVcGRhdGVzKTsKICAgICAgICAg\nICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25TYWZlUENEYXRhcyhjYWNo\nZSwgbW9kcy5leGlzdGluZ1VwZGF0ZXMpOwogICAgICAgICAgICAgICAgICAg\nIGNhY2hlLmNvbW1pdChtb2RzLmFkZGl0aW9ucywgbW9kcy5uZXdVcGRhdGVz\nLAogICAgICAgICAgICAgICAgICAgICAgICBtb2RzLmV4aXN0aW5nVXBkYXRl\ncywgbW9kcy5kZWxldGVzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgd2Ugd2VyZSBpbiBsYXJnZVRyYW5zYWN0aW9uIG1vZGUsIHRo\nZW4gd2UgaGF2ZSByZWNvcmRlZAogICAgICAgIC8vIHRoZSBjbGFzc2VzIG9m\nIHVwZGF0ZWQvZGVsZXRlZCBvYmplY3RzIGFuZCB0aGVzZSBub3cgbmVlZCB0\nbyBiZQogICAgICAgIC8vIGV2aWN0ZWQKICAgICAgICBpZiAoX2N0eC5pc1Ry\nYWNrQ2hhbmdlc0J5VHlwZSgpKSB7CiAgICAgICAgICAgIGV2aWN0VHlwZXMo\nX2N0eC5nZXREZWxldGVkVHlwZXMoKSk7CiAgICAgICAgICAgIGV2aWN0VHlw\nZXMoX2N0eC5nZXRVcGRhdGVkVHlwZXMoKSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBhbmQgbm90aWZ5IHRoZSBxdWVyeSBjYWNoZS4gIG5vdGlmeSBpbiBv\nbmUgYmF0Y2ggdG8gcmVkdWNlIHN5bmNoCiAgICAgICAgUXVlcnlDYWNoZSBx\ndWVyeUNhY2hlID0gX2N0eC5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAg\nICAgIGdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLmdldFN5c3RlbVF1\nZXJ5Q2FjaGUoKTsKICAgICAgICBpZiAocXVlcnlDYWNoZSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIENvbGxlY3Rpb24gcGVycyA9IF9jdHguZ2V0UGVyc2lz\ndGVkVHlwZXMoKTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBkZWwgPSBfY3R4\nLmdldERlbGV0ZWRUeXBlcygpOwogICAgICAgICAgICBDb2xsZWN0aW9uIHVw\nID0gX2N0eC5nZXRVcGRhdGVkVHlwZXMoKTsKICAgICAgICAgICAgaW50IHNp\nemUgPSBwZXJzLnNpemUoKSArIGRlbC5zaXplKCkgKyB1cC5zaXplKCk7CiAg\nICAgICAgICAgIGlmIChzaXplID4gMCkgewogICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbiB0eXBlcyA9IG5ldyBBcnJheUxpc3Qoc2l6ZSk7CiAgICAgICAg\nICAgICAgICB0eXBlcy5hZGRBbGwocGVycyk7CiAgICAgICAgICAgICAgICB0\neXBlcy5hZGRBbGwoZGVsKTsKICAgICAgICAgICAgICAgIHR5cGVzLmFkZEFs\nbCh1cCk7CiAgICAgICAgICAgICAgICBxdWVyeUNhY2hlLm9uVHlwZXNDaGFu\nZ2VkKG5ldyBUeXBlc0NoYW5nZWRFdmVudCh0aGlzLCB0eXBlcykpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJh\nbnNmb3JtcyBhIGNvbGxlY3Rpb24gb2Yge0BsaW5rIFBDRGF0YUhvbGRlcn1z\nIHRoYXQgbWlnaHQgY29udGFpbgogICAgICogc3RhbGUgaW5zdGFuY2VzIGlu\ndG8gYSBjb2xsZWN0aW9uIG9mIHVwLXRvLWRhdGUge0BsaW5rIERhdGFDYWNo\nZVBDRGF0YX1zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNmb3Jt\nVG9WZXJzaW9uU2FmZVBDRGF0YXMoRGF0YUNhY2hlIGNhY2hlLAogICAgICAg\nIExpc3QgaG9sZGVycykgewoKICAgICAgICBNYXA8T2JqZWN0LEludGVnZXI+\nIGlkcyA9IG5ldyBIYXNoTWFwPE9iamVjdCxJbnRlZ2VyPihob2xkZXJzLnNp\nemUoKSk7CiAgICAgICAgLy8gdGhpcyBsaXN0IGNvdWxkIGJlIHJlbW92ZWQg\naWYgRGF0YUNhY2hlLmdldEFsbCgpIHRvb2sgYSBDb2xsZWN0aW9uCiAgICAg\nICAgTGlzdCBpZExpc3QgPSBuZXcgQXJyYXlMaXN0KGhvbGRlcnMuc2l6ZSgp\nKTsKICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChQQ0RhdGFIb2xk\nZXIgaG9sZGVyIDogKExpc3Q8UENEYXRhSG9sZGVyPikgaG9sZGVycykgewog\nICAgICAgICAgICBpZHMucHV0KGhvbGRlci5zbS5nZXRPYmplY3RJZCgpLCBp\nKyspOwogICAgICAgICAgICBpZExpc3QuYWRkKGhvbGRlci5zbS5nZXRPYmpl\nY3RJZCgpKTsKICAgICAgICB9CgogICAgICAgIE1hcDxPYmplY3QsRGF0YUNh\nY2hlUENEYXRhPiBwY2RhdGFzID0gY2FjaGUuZ2V0QWxsKGlkTGlzdCk7CiAg\nICAgICAgZm9yIChFbnRyeTxPYmplY3QsRGF0YUNhY2hlUENEYXRhPiBlbnRy\neSA6IHBjZGF0YXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBJbnRlZ2Vy\nIGluZGV4ID0gaWRzLmdldChlbnRyeS5nZXRLZXkoKSk7CiAgICAgICAgICAg\nIERhdGFDYWNoZVBDRGF0YSBvbGRwYyA9IGVudHJ5LmdldFZhbHVlKCk7CiAg\nICAgICAgICAgIFBDRGF0YUhvbGRlciBob2xkZXIgPSAoUENEYXRhSG9sZGVy\nKSBob2xkZXJzLmdldChpbmRleCk7CiAgICAgICAgICAgIGlmIChvbGRwYyAh\nPSBudWxsICYmIGNvbXBhcmVWZXJzaW9uKGhvbGRlci5zbSwKICAgICAgICAg\nICAgICAgIGhvbGRlci5zbS5nZXRWZXJzaW9uKCksIG9sZHBjLmdldFZlcnNp\nb24oKSkgPT0gVkVSU0lPTl9FQVJMSUVSKQogICAgICAgICAgICAgICAgaG9s\nZGVycy5yZW1vdmUoaW5kZXgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBob2xkZXJzLnNldChpbmRleCwgaG9sZGVyLnBjZGF0YSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEge0BsaW5r\nIE1vZGlmaWNhdGlvbnN9IGluc3RhbmNlIHRvIHRyYWNrIG1vZGlmaWNhdGlv\nbnMKICAgICAqIHRvIHRoZSBnaXZlbiBjYWNoZSwgY3JlYXRpbmcgYW5kIGNh\nY2hpbmcgdGhlIGluc3RhbmNlIGlmIGl0IGRvZXMKICAgICAqIG5vdCBhbHJl\nYWR5IGV4aXN0IGluIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIE1vZGlmaWNhdGlvbnMgZ2V0TW9kaWZpY2F0aW9ucyhNYXAg\nbW9kTWFwLCBEYXRhQ2FjaGUgY2FjaGUpIHsKICAgICAgICBNb2RpZmljYXRp\nb25zIG1vZHMgPSAoTW9kaWZpY2F0aW9ucykgbW9kTWFwLmdldChjYWNoZSk7\nCiAgICAgICAgaWYgKG1vZHMgPT0gbnVsbCkgewogICAgICAgICAgICBtb2Rz\nID0gbmV3IE1vZGlmaWNhdGlvbnMoKTsKICAgICAgICAgICAgbW9kTWFwLnB1\ndChjYWNoZSwgbW9kcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtb2Rz\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGV4aXN0cyhPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAgICAgICBEYXRhQ2Fj\naGUgY2FjaGUgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwog\nICAgICAgIGlmIChjYWNoZSAhPSBudWxsICYmICFpc0xvY2tpbmcobnVsbCkK\nICAgICAgICAgICAgJiYgY2FjaGUuY29udGFpbnMoc20uZ2V0T2JqZWN0SWQo\nKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBz\ndXBlci5leGlzdHMoc20sIGVkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBzeW5jVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmpl\nY3QgZWRhdGEpIHsKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBzbS5nZXRN\nZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAgICAgIGlmIChjYWNoZSA9\nPSBudWxsIHx8IHNtLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLnN5bmNWZXJzaW9uKHNtLCBlZGF0YSk7CgogICAgICAgIERhdGFD\nYWNoZVBDRGF0YSBkYXRhOwogICAgICAgIE9iamVjdCB2ZXJzaW9uID0gbnVs\nbDsKICAgICAgICBkYXRhID0gY2FjaGUuZ2V0KHNtLmdldE9iamVjdElkKCkp\nOwogICAgICAgIGlmICghaXNMb2NraW5nKG51bGwpICYmIGRhdGEgIT0gbnVs\nbCkKICAgICAgICAgICAgdmVyc2lvbiA9IGRhdGEuZ2V0VmVyc2lvbigpOwoK\nICAgICAgICAvLyBpZiB3ZSBoYXZlIGEgY2FjaGVkIHZlcnNpb24gdXBkYXRl\nIGZyb20gdGhlcmUKICAgICAgICBpZiAodmVyc2lvbiAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmICghdmVyc2lvbi5lcXVhbHMoc20uZ2V0VmVyc2lvbigp\nKSkgewogICAgICAgICAgICAgICAgc20uc2V0VmVyc2lvbih2ZXJzaW9uKTsK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8v\nIHVzZSBkYXRhIHN0b3JlIHZlcnNpb24KICAgICAgICByZXR1cm4gc3VwZXIu\nc3luY1ZlcnNpb24oc20sIGVkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpbml0aWFsaXplKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3Rh\ndGUgc3RhdGUsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBP\nYmplY3QgZWRhdGEpIHsKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBzbS5n\nZXRNZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAgICAgIGlmIChjYWNo\nZSA9PSBudWxsIHx8IHNtLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEp\nOwoKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9IGNhY2hlLmdldChz\nbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBpZiAoZGF0YSAhPSBudWxsICYm\nICFpc0xvY2tpbmcoZmV0Y2gpKSB7CiAgICAgICAgICAgIC8vIyMjIHRoZSAn\nZGF0YS50eXBlJyBhY2Nlc3MgaGVyZSBwcm9iYWJseSBuZWVkcyB0byBiZQog\nICAgICAgICAgICAvLyMjIyBhZGRyZXNzZWQgZm9yIGJ1ZyA1MTEKICAgICAg\nICAgICAgc20uaW5pdGlhbGl6ZShkYXRhLmdldFR5cGUoKSwgc3RhdGUpOwog\nICAgICAgICAgICBkYXRhLmxvYWQoc20sIGZldGNoLCBlZGF0YSk7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gaW5p\ndGlhbGl6ZSBmcm9tIHN0b3JlIG1hbmFnZXIKICAgICAgICBpZiAoIXN1cGVy\nLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFfY3R4LmdldFBvcHVs\nYXRlRGF0YUNhY2hlKCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAg\nICAgICAvLyBtYWtlIHN1cmUgdGhhdCB3ZSdyZSBub3QgdHJ5aW5nIHRvIGNh\nY2hlIGFuIG9sZCB2ZXJzaW9uCiAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZGF0YSA9IGNhY2hlLmdldChz\nbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVs\nbCAmJiBjb21wYXJlVmVyc2lvbihzbSwgc20uZ2V0VmVyc2lvbigpLAogICAg\nICAgICAgICAgICAgZGF0YS5nZXRWZXJzaW9uKCkpID09IFZFUlNJT05fRUFS\nTElFUikKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAg\nICAgLy8gY2FjaGUgbmV3bHkgbG9hZGVkIGluZm8uIEl0IGlzIHNhZmUgdG8g\nY2FjaGUgZGF0YSBmcm9ybQogICAgICAgICAgICAvLyBpbml0aWFsaXplKCkg\nYmVjYXVzZSB0aGlzIG1ldGhvZCBpcyBvbmx5IGNhbGxlZCB1cG9uCiAgICAg\nICAgICAgIC8vIGluaXRpYWwgbG9hZCBvZiB0aGUgZGF0YS4KICAgICAgICAg\nICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGRhdGEgPSBu\nZXdQQ0RhdGEoc20pOwogICAgICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAg\nICAgICAgICAgY2FjaGUucHV0KGRhdGEpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywK\nICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2NrTGV2\nZWwsIE9iamVjdCBlZGF0YSkgewogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9\nIHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgaWYg\nKGNhY2hlID09IG51bGwgfHwgc20uaXNFbWJlZGRlZCgpKQogICAgICAgICAg\nICByZXR1cm4gc3VwZXIubG9hZChzbSwgZmllbGRzLCBmZXRjaCwgbG9ja0xl\ndmVsLCBlZGF0YSk7CgogICAgICAgIERhdGFDYWNoZVBDRGF0YSBkYXRhID0g\nY2FjaGUuZ2V0KHNtLmdldE9iamVjdElkKCkpOwogICAgICAgIGlmIChsb2Nr\nTGV2ZWwgPT0gTG9ja0xldmVscy5MT0NLX05PTkUgJiYgIWlzTG9ja2luZyhm\nZXRjaCkKICAgICAgICAgICAgJiYgZGF0YSAhPSBudWxsKQogICAgICAgICAg\nICBkYXRhLmxvYWQoc20sIGZpZWxkcywgZmV0Y2gsIGVkYXRhKTsKICAgICAg\nICBpZiAoZmllbGRzLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwoKICAgICAgICAvLyBsb2FkIGZyb20gc3RvcmUgbWFuYWdlcjsg\nY2xvbmUgdGhlIHNldCBvZiBzdGlsbC11bmxvYWRlZCBmaWVsZHMKICAgICAg\nICAvLyBzbyB0aGF0IGlmIHRoZSBzdG9yZSBtYW5hZ2VyIGRlY2lkZXMgdG8g\nbW9kaWZ5IGl0IGl0IHdvbid0IGFmZmVjdCB1cwogICAgICAgIGlmICghc3Vw\nZXIubG9hZChzbSwgKEJpdFNldCkgZmllbGRzLmNsb25lKCksIGZldGNoLCBs\nb2NrTGV2ZWwsIGVkYXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmICghX2N0eC5nZXRQb3B1bGF0ZURhdGFDYWNoZSgpKQogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAvLyBEbyBub3QgbG9hZCBj\naGFuZ2VzIGludG8gY2FjaGUgaWYgdGhlIGluc3RhbmNlIGhhcyBiZWVuIGZs\ndXNoZWQKICAgICAgICBpZiAoc20uaXNGbHVzaGVkKCkpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB3ZSdy\nZSBub3QgdHJ5aW5nIHRvIGNhY2hlIGFuIG9sZCB2ZXJzaW9uCiAgICAgICAg\nY2FjaGUud3JpdGVMb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nZGF0YSA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAg\nICAgaWYgKGRhdGEgIT0gbnVsbCAmJiBjb21wYXJlVmVyc2lvbihzbSwgc20u\nZ2V0VmVyc2lvbigpLAogICAgICAgICAgICAgICAgZGF0YS5nZXRWZXJzaW9u\nKCkpID09IFZFUlNJT05fRUFSTElFUikKICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwoKICAgICAgICAgICAgLy8gY2FjaGUgbmV3bHkgbG9hZGVkIGlu\nZm8KICAgICAgICAgICAgYm9vbGVhbiBpc05ldyA9IGRhdGEgPT0gbnVsbDsK\nICAgICAgICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICAgICAgZGF0YSA9\nIG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgIGRhdGEuc3RvcmUoc20sIGZp\nZWxkcyk7CiAgICAgICAgICAgIGlmIChpc05ldykKICAgICAgICAgICAgICAg\nIGNhY2hlLnB1dChkYXRhKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgY2FjaGUudXBkYXRlKGRhdGEpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0\naW9uIGxvYWRBbGwoQ29sbGVjdGlvbiBzbXMsIFBDU3RhdGUgc3RhdGUsIGlu\ndCBsb2FkLAogICAgCQlGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVj\ndCBlZGF0YSkgewogICAgICAgIGlmIChpc0xvY2tpbmcoZmV0Y2gpKQogICAg\nICAgICAgICByZXR1cm4gc3VwZXIubG9hZEFsbChzbXMsIHN0YXRlLCBsb2Fk\nLCBmZXRjaCwgZWRhdGEpOwoKICAgICAgICBNYXAgdW5sb2FkZWQgPSBudWxs\nOwogICAgICAgIExpc3Qgc21MaXN0ID0gbnVsbDsKICAgICAgICBNYXAgY2Fj\naGVzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtOwogICAgICAgIERhdGFDYWNoZSBjYWNoZTsKICAgICAgICBEYXRh\nQ2FjaGVQQ0RhdGEgZGF0YTsKICAgICAgICBCaXRTZXQgZmllbGRzOwoKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBzbSA9IChPcGVuSlBBU3RhdGVN\nYW5hZ2VyKSBpdHIubmV4dCgpOwogICAgICAgICAgICBjYWNoZSA9IHNtLmdl\ndE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAgIGlmIChj\nYWNoZSA9PSBudWxsIHx8IHNtLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAg\nICAgICAgdW5sb2FkZWQgPSBhZGRVbmxvYWRlZChzbSwgbnVsbCwgdW5sb2Fk\nZWQpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmIChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSA9PSBu\ndWxsCiAgICAgICAgICAgICAgICB8fCBsb2FkICE9IEZPUkNFX0xPQURfTk9O\nRQogICAgICAgICAgICAgICAgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBDU3Rh\ndGUuSE9MTE9XKSB7CiAgICAgICAgICAgICAgICBzbUxpc3QgPSAoTGlzdCkg\nY2FjaGVzLmdldChjYWNoZSk7CiAgICAgICAgICAgICAgICBpZiAoc21MaXN0\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBzbUxpc3QgPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgY2FjaGVzLnB1dChj\nYWNoZSwgc21MaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHNtTGlzdC5hZGQoc20pOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFj\nYWNoZS5jb250YWlucyhzbS5nZXRPYmplY3RJZCgpKSkKICAgICAgICAgICAg\nICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51bGwsIHVubG9hZGVk\nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBjYWNoZXMua2V5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgY2FjaGUgPSAoRGF0YUNhY2hlKSBpdHIubmV4\ndCgpOwogICAgICAgICAgICBzbUxpc3QgPSAoTGlzdCkgY2FjaGVzLmdldChj\nYWNoZSk7CiAgICAgICAgICAgIExpc3Qgb2lkTGlzdCA9IG5ldyBBcnJheUxp\nc3Qoc21MaXN0LnNpemUoKSk7CgogICAgICAgICAgICBmb3IgKGl0cj1zbUxp\nc3QuaXRlcmF0b3IoKTtpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgaXRyLm5leHQoKTsKICAg\nICAgICAgICAgICAgIG9pZExpc3QuYWRkKChPcGVuSlBBSWQpIHNtLmdldE9i\namVjdElkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAg\nICAgICBNYXAgZGF0YU1hcCA9IGNhY2hlLmdldEFsbChvaWRMaXN0KTsKCiAg\nICAgICAgICAgIGZvciAoaXRyPXNtTGlzdC5pdGVyYXRvcigpO2l0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IChPcGVuSlBBU3RhdGVN\nYW5hZ2VyKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgZGF0YSA9IChE\nYXRhQ2FjaGVQQ0RhdGEpIGRhdGFNYXAuZ2V0KAogICAgICAgICAgICAgICAg\nICAgICAgICAoT3BlbkpQQUlkKSBzbS5nZXRPYmplY3RJZCgpKTsKCiAgICAg\nICAgICAgICAgICBpZiAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgLy8jIyMgdGhlICdkYXRhLnR5cGUn\nIGFjY2VzcyBoZXJlIHByb2JhYmx5IG5lZWRzCiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIyMjIHRvIGJlIGFkZHJlc3NlZCBmb3IgYnVnIDUxMQogICAg\nICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGRhdGEuZ2V0VHlw\nZSgpLCBzdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubG9h\nZChzbSwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2FkZWQgPSBhZGRVbmxv\nYWRlZChzbSwgbnVsbCwgdW5sb2FkZWQpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIGlmIChsb2FkICE9IEZPUkNFX0xPQURfTk9ORQogICAgICAgICAgICAg\nICAgICAgICAgICB8fCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xM\nT1cpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gY2FjaGUuZ2V0KHNt\nLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRh\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9hZCB1\nbmxvYWRlZCBmaWVsZHMKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRz\nID0gc20uZ2V0VW5sb2FkZWQoZmV0Y2gpOwogICAgICAgICAgICAgICAgICAg\nICAgICBkYXRhLmxvYWQoc20sIGZpZWxkcywgZmV0Y2gsIGVkYXRhKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGgoKSA+IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxvYWRlZCA9IGFkZFVu\nbG9hZGVkKHNtLCBmaWVsZHMsIHVubG9hZGVkKTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2FkZWQg\nPSBhZGRVbmxvYWRlZChzbSwgbnVsbCwgdW5sb2FkZWQpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\ndW5sb2FkZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLkVNUFRZX0xJU1Q7CgogICAgICAgIC8vIGxvYWQgd2l0aCBkZWxlZ2F0\nZQogICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gc3VwZXIubG9hZEFsbCh1\nbmxvYWRlZC5rZXlTZXQoKSwgc3RhdGUsIGxvYWQsCiAgICAgICAgICAgIGZl\ndGNoLCBlZGF0YSk7CiAgICAgICAgaWYgKCFfY3R4LmdldFBvcHVsYXRlRGF0\nYUNhY2hlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWlsZWQ7CgogICAgICAg\nIC8vIGZvciBlYWNoIGxvYWRlZCBpbnN0YW5jZSwgbWVyZ2UgbG9hZGVkIHN0\nYXRlIGludG8gY2FjaGVkIGRhdGEKICAgICAgICBNYXAuRW50cnkgZW50cnk7\nCiAgICAgICAgYm9vbGVhbiBpc05ldzsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHVubG9hZGVkLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBp\ndHIubmV4dCgpOwogICAgICAgICAgICBzbSA9IChPcGVuSlBBU3RhdGVNYW5h\nZ2VyKSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgZmllbGRzID0gKEJp\ndFNldCkgZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgIGNhY2hlID0g\nc20uZ2V0TWV0YURhdGEoKS5nZXREYXRhQ2FjaGUoKTsKICAgICAgICAgICAg\naWYgKGNhY2hlID09IG51bGwgfHwgc20uaXNFbWJlZGRlZCgpIHx8IChmYWls\nZWQgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgZmFpbGVkLmNvbnRhaW5z\nKHNtLmdldElkKCkpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgd2UncmUgbm90IHRyeWluZyB0\nbyBjYWNoZSBhbiBvbGQgdmVyc2lvbgogICAgICAgICAgICBjYWNoZS53cml0\nZUxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRh\ndGEgPSBjYWNoZS5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgICAg\nICAgICBpZiAoZGF0YSAhPSBudWxsICYmIGNvbXBhcmVWZXJzaW9uKHNtLCBz\nbS5nZXRWZXJzaW9uKCksCiAgICAgICAgICAgICAgICAgICAgZGF0YS5nZXRW\nZXJzaW9uKCkpID09IFZFUlNJT05fRUFSTElFUikKICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBpc05ldyA9IGRhdGEg\nPT0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChpc05ldykKICAgICAgICAg\nICAgICAgICAgICBkYXRhID0gbmV3UENEYXRhKHNtKTsKICAgICAgICAgICAg\nICAgIGlmIChmaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBk\nYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICBkYXRhLnN0b3JlKHNtLCBmaWVsZHMpOwogICAgICAgICAg\nICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICAgICAgICAgIGNhY2hlLnB1\ndChkYXRhKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBjYWNoZS51cGRhdGUoZGF0YSk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBjYWNoZS53cml0ZVVubG9jaygpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWlsZWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBhbiB1\nbmxvYWRlZCBpbnN0YW5jZSB0byB0aGUgZ2l2ZW4gbWFwLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBNYXAgYWRkVW5sb2FkZWQoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywKICAgICAgICBNYXAgdW5sb2Fk\nZWQpIHsKICAgICAgICBpZiAodW5sb2FkZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgdW5sb2FkZWQgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIHVubG9hZGVk\nLnB1dChzbSwgZmllbGRzKTsKICAgICAgICByZXR1cm4gdW5sb2FkZWQ7CiAg\nICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZmx1c2goQ29sbGVjdGlvbiBz\ndGF0ZXMpIHsKICAgICAgICBDb2xsZWN0aW9uIGV4Y2VwcyA9IHN1cGVyLmZs\ndXNoKHN0YXRlcyk7CgogICAgICAgIC8vIGlmIHRoZXJlIHdlcmUgZXJyb3Jz\nIGV2aWN0IGJhZCBpbnN0YW5jZXMgYW5kIGRvbid0IHJlY29yZCBjaGFuZ2Vz\nCiAgICAgICAgaWYgKCFleGNlcHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRlciA9IGV4Y2Vwcy5pdGVyYXRvcigpOyBpdGVy\nLmhhc05leHQoKTsgKSB7CiAgICAgICAgICAgICAgICBFeGNlcHRpb24gZSA9\nIChFeGNlcHRpb24pIGl0ZXIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYg\nKGUgaW5zdGFuY2VvZiBPcHRpbWlzdGljRXhjZXB0aW9uKQogICAgICAgICAg\nICAgICAgICAgIG5vdGlmeU9wdGltaXN0aWNMb2NrRmFpbHVyZSgoT3B0aW1p\nc3RpY0V4Y2VwdGlvbikgZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIGV4Y2VwczsKICAgICAgICB9CgogICAgICAgIC8vIGlmIGxhcmdl\nIHRyYW5zYWN0aW9uIG1vZGUgZG9uJ3QgcmVjb3JkIGluZGl2aWR1YWwgY2hh\nbmdlcwogICAgICAgIGlmIChfY3R4LmlzVHJhY2tDaGFuZ2VzQnlUeXBlKCkp\nCiAgICAgICAgICAgIHJldHVybiBleGNlcHM7CgogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc207CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBz\ndGF0ZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgaXRyLm5leHQoKTsKCiAg\nICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVX\nICYmICFzbS5pc0ZsdXNoZWQoKSkgewogICAgICAgICAgICAgICAgaWYgKF9p\nbnNlcnRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2luc2VydHMg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICBfaW5zZXJ0cy5h\nZGQoc20pOwoKICAgICAgICAgICAgICAgIC8vIG1heSBoYXZlIGJlZW4gcmUt\ncGVyc2lzdGVkCiAgICAgICAgICAgICAgICBpZiAoX2RlbGV0ZXMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBfZGVsZXRlcy5yZW1vdmUoc20pOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKF9pbnNlcnRzICE9IG51bGwgCiAgICAg\nICAgICAgICAgICAmJiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUE5F\nV0RFTEVURUQgCiAgICAgICAgICAgICAgICB8fCBzbS5nZXRQQ1N0YXRlKCkg\nPT0gUENTdGF0ZS5QTkVXRkxVU0hFRERFTEVURUQpKQogICAgICAgICAgICAg\nICAgX2luc2VydHMucmVtb3ZlKHNtKTsKICAgICAgICAgICAgZWxzZSBpZiAo\nc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUERJUlRZKSB7CiAgICAgICAg\nICAgICAgICBpZiAoX3VwZGF0ZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBfdXBkYXRlcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAg\nICBfdXBkYXRlcy5wdXQoc20sIHNtLmdldERpcnR5KCkpOwogICAgICAgICAg\nICB9IGVsc2UgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBERUxF\nVEVEKSB7CiAgICAgICAgICAgICAgICBpZiAoX2RlbGV0ZXMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBfZGVsZXRlcyA9IG5ldyBIYXNoU2V0KCk7\nCiAgICAgICAgICAgICAgICBfZGVsZXRlcy5hZGQoc20pOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBU\nWV9MSVNUOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSBsb2NhbCBzdGFs\nZW5lc3MgZGV0ZWN0aW9uIGV2ZW50cyBmcm9tIHRoZSBjYWNoZSB0aGUgT0lE\nIChpZgogICAgICogYXZhaWxhYmxlKSB0aGF0IHJlc3VsdGVkIGluIGFuIG9w\ndGltaXN0aWMgbG9jayBleGNlcHRpb24gaWZmIHRoZQogICAgICogdmVyc2lv\nbiBpbmZvcm1hdGlvbiBpbiB0aGUgY2FjaGUgbWF0Y2hlcyB0aGUgdmVyc2lv\nbiBpbmZvcm1hdGlvbgogICAgICogaW4gdGhlIHN0YXRlIG1hbmFnZXIgZm9y\nIHRoZSBmYWlsZWQgaW5zdGFuY2UuIFRoaXMgbWVhbnMgdGhhdCB3ZQogICAg\nICogd2lsbCBldmljdCBkYXRhIGZyb20gdGhlIGNhY2hlIGZvciByZWNvcmRz\nIHRoYXQgc2hvdWxkIGhhdmUKICAgICAqIHN1Y2Nlc3NmdWxseSBjb21taXR0\nZWQgYWNjb3JkaW5nIHRvIHRoZSBkYXRhIGNhY2hlIGJ1dAogICAgICogZGlk\nIG5vdC4gVGhlIG9ubHkgcHJlZGljdGFibGUgcmVhc29uIHRoYXQgY291bGQg\nY2F1c2UgdGhpcyBiZWhhdmlvcgogICAgICogaXMgYSBjb25jdXJyZW50IG91\ndC1vZi1iYW5kIG1vZGlmaWNhdGlvbiB0byB0aGUgZGF0YWJhc2UgdGhhdCB3\nYXMgbm90IAogICAgICogY29tbXVuaWNhdGVkIHRvIHRoZSBjYWNoZS4gVGhp\ncyBsb2dpYyBtYWtlcyBPcGVuSlBBJ3MgZGF0YSBjYWNoZSAKICAgICAqIHNv\nbWV3aGF0IHRvbGVyYW50IG9mIHN1Y2ggYmVoYXZpb3IsIGluIHRoYXQgdGhl\nIGNhY2hlIHdpbGwgYmUgY2xlYW5lZCAKICAgICAqIHVwIGFzIGZhaWx1cmVz\nIG9jY3VyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbm90aWZ5T3B0aW1p\nc3RpY0xvY2tGYWlsdXJlKE9wdGltaXN0aWNFeGNlcHRpb24gZSkgewogICAg\nICAgIE9iamVjdCBvID0gZS5nZXRGYWlsZWRPYmplY3QoKTsKICAgICAgICBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gX2N0eC5nZXRTdGF0ZU1hbmFnZXIo\nbyk7CiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0SWQoKTsKICAgICAgICBi\nb29sZWFuIHJlbW92ZTsKCiAgICAgICAgLy8gdGhpcyBsb2dpYyBjb3VsZCBi\nZSBtb3JlIGVmZmljaWVudCAtLSB3ZSBjb3VsZCBhZ2dyZWdhdGUKICAgICAg\nICAvLyBhbGwgdGhlIGNhY2hlLT5vaWQgY2hhbmdlcywgYW5kIHRoZW4gdXNl\nIERhdGFDYWNoZS5yZW1vdmVBbGwoKSAKICAgICAgICAvLyBhbmQgbGVzcyB3\ncml0ZSBsb2NrcyB0byBkbyB0aGUgbXV0YXRpb24uCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBEYXRh\nQ2FjaGUgY2FjaGUgPSBtZXRhLmdldERhdGFDYWNoZSgpOwogICAgICAgIGlm\nIChjYWNoZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGNhY2hlLndyaXRlTG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIERhdGFDYWNoZVBDRGF0YSBkYXRhID0gY2FjaGUuZ2V0KG9pZCk7CiAgICAg\nICAgICAgIGlmIChkYXRhID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CgogICAgICAgICAgICBzd2l0Y2ggKGNvbXBhcmVWZXJzaW9uKHNtLCBz\nbS5nZXRWZXJzaW9uKCksIGRhdGEuZ2V0VmVyc2lvbigpKSkgewogICAgICAg\nICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIuVkVSU0lPTl9MQVRFUjoKICAg\nICAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2VyLlZFUlNJT05fU0FNRToK\nICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHR4J3MgY3VycmVudCB2ZXJz\naW9uIGlzIGxhdGVyIHRoYW4gb3IgdGhlIHNhbWUgYXMgCiAgICAgICAgICAg\nICAgICAgICAgLy8gdGhlIGRhdGEgY2FjaGUgdmVyc2lvbi4gSW4gdGhpcyBj\nYXNlLCB0aGUgY29tbWl0IHNob3VsZCAKICAgICAgICAgICAgICAgICAgICAv\nLyBoYXZlIHN1Y2NlZWRlZCBmcm9tIHRoZSBzdGFuZHBvaW50IG9mIHRoZSBj\nYWNoZS4gUmVtb3ZlIAogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBpbnN0\nYW5jZSBmcm9tIGNhY2hlIGluIHRoZSBob3BlcyB0aGF0IHRoZSBjYWNoZSBp\ncyAKICAgICAgICAgICAgICAgICAgICAvLyBvdXQgb2Ygc3luYy4KICAgICAg\nICAgICAgICAgICAgICByZW1vdmUgPSB0cnVlOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIu\nVkVSU0lPTl9FQVJMSUVSOgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMg\ndHgncyBjdXJyZW50IHZlcnNpb24gaXMgZWFybGllciB0aGFuIHRoZSBkYXRh\nIAogICAgICAgICAgICAgICAgICAgIC8vIGNhY2hlIHZlcnNpb24uIFRoaXMg\naXMgYSBub3JtYWwgb3B0aW1pc3RpYyBsb2NrIGZhaWx1cmUuIAogICAgICAg\nICAgICAgICAgICAgIC8vIERvIG5vdCBjbGVhbiB1cCB0aGUgY2FjaGU7IGl0\nIHByb2JhYmx5IGFscmVhZHkgaGFzIHRoZSAKICAgICAgICAgICAgICAgICAg\nICAvLyByaWdodCB2YWx1ZXMsIGFuZCBpZiBub3QsIGl0J2xsIGdldCBjbGVh\nbmVkIHVwIGJ5IGEgdHgKICAgICAgICAgICAgICAgICAgICAvLyB0aGF0IGZh\naWxzIGluIG9uZSBvZiB0aGUgb3RoZXIgY2FzZSBzdGF0ZW1lbnRzLgogICAg\nICAgICAgICAgICAgICAgIHJlbW92ZSA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFn\nZXIuVkVSU0lPTl9ESUZGRVJFTlQ6CiAgICAgICAgICAgICAgICAgICAgLy8g\nVGhlIHZlcnNpb24gc3RyYXRlZ3kgZm9yIHRoZSBmYWlsZWQgb2JqZWN0IGRv\nZXMgbm90CiAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgZW5vdWdoIGlu\nZm9ybWF0aW9uIHRvIG9wdGltaXplIGZvciBleHBlY3RlZAogICAgICAgICAg\nICAgICAgICAgIC8vIGZhaWx1cmVzLiBDbGVhbiB1cCB0aGUgY2FjaGUuCiAg\nICAgICAgICAgICAgICAgICAgcmVtb3ZlID0gdHJ1ZTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAgICAgLy8gVW5leHBlY3RlZCByZXR1cm4gdmFsdWUuIFJl\nbW92ZSB0byBiZSBmdXR1cmUtcHJvb2YuCiAgICAgICAgICAgICAgICAgICAg\ncmVtb3ZlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVtb3ZlKQogICAgICAgICAg\nICAgICAgLy8gcmVtb3ZlIGRpcmVjdGx5IGluc3RlYWQgb2YgdmlhIHRoZSBS\nZW1vdGVDb21taXRMaXN0ZW5lcgogICAgICAgICAgICAgICAgLy8gc2luY2Ug\nd2UgaGF2ZSBhIHdyaXRlIGxvY2sgaGVyZSBhbHJlYWR5LCBzbyB0aGlzIGlz\nIG1vcmUKICAgICAgICAgICAgICAgIC8vIGVmZmljaWVudCB0aGFuIHJlYWQt\nbG9ja2luZyBhbmQgdGhlbiB3cml0ZS1sb2NraW5nIGxhdGVyLgogICAgICAg\nICAgICAgICAgY2FjaGUucmVtb3ZlKHNtLmdldElkKCkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBmaXJlIG9mZiBhIHJlbW90ZSBjb21taXQg\nc3RhbGVuZXNzcyBkZXRlY3Rpb24gZXZlbnQuCiAgICAgICAgX2N0eC5nZXRD\nb25maWd1cmF0aW9uKCkuZ2V0UmVtb3RlQ29tbWl0RXZlbnRNYW5hZ2VyKCkK\nICAgICAgICAgICAgLmZpcmVMb2NhbFN0YWxlTm90aWZpY2F0aW9uKG9pZCk7\nCiAgICB9CgogICAgcHVibGljIFN0b3JlUXVlcnkgbmV3UXVlcnkoU3RyaW5n\nIGxhbmd1YWdlKSB7CiAgICAgICAgU3RvcmVRdWVyeSBxID0gc3VwZXIubmV3\nUXVlcnkobGFuZ3VhZ2UpOwoKICAgICAgICAvLyBpZiB0aGUgcXVlcnkgY2Fu\nJ3QgYmUgcGFyc2VkIG9yIGl0J3MgdXNpbmcgYSBub24tcGFyc2VkIGxhbmd1\nYWdlCiAgICAgICAgLy8gKG9uZSBmb3Igd2hpY2ggdGhlcmUgaXMgbm8gRXhw\ncmVzc2lvblBhcnNlciksIHdlIGNhbid0IGNhY2hlIGl0LgogICAgICAgIGlm\nIChxID09IG51bGwgfHwgUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3Vh\nZ2UobGFuZ3VhZ2UpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBxOwoK\nICAgICAgICBRdWVyeUNhY2hlIHF1ZXJ5Q2FjaGUgPSBfY3R4LmdldENvbmZp\nZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0RGF0YUNhY2hlTWFuYWdlcklu\nc3RhbmNlKCkuZ2V0U3lzdGVtUXVlcnlDYWNoZSgpOwogICAgICAgIGlmIChx\ndWVyeUNhY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBxOwoKICAg\nICAgICByZXR1cm4gbmV3IFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KHEsIHF1ZXJ5\nQ2FjaGUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNh\nY2hlYWJsZSBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIu\nCiAgICAgKi8KICAgIHByaXZhdGUgRGF0YUNhY2hlUENEYXRhIG5ld1BDRGF0\nYShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBpZiAoX2dl\nbiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKERhdGFDYWNoZVBDRGF0\nYSkgX2dlbi5nZW5lcmF0ZVBDRGF0YQogICAgICAgICAgICAgICAgKHNtLmdl\ndE9iamVjdElkKCksIG1ldGEpOwogICAgICAgIHJldHVybiBuZXcgRGF0YUNh\nY2hlUENEYXRhSW1wbChzbS5mZXRjaE9iamVjdElkKCksIG1ldGEpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGNvbnRleHQg\naXMgbG9ja2luZyBsb2FkZWQgZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGlzTG9ja2luZyhGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsK\nICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2gg\nPSBfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVy\nbiBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkgPiBMb2NrTGV2ZWxzLkxPQ0tf\nTk9ORTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0cnVjdHVyZSB1c2VkIGR1\ncmluZyB0aGUgY29tbWl0IHByb2Nlc3MgdG8gdHJhY2sgY2FjaGUgbW9kaWZp\nY2F0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTW9k\naWZpY2F0aW9ucyB7CgogICAgICAgIHB1YmxpYyBmaW5hbCBMaXN0IGFkZGl0\naW9ucyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBwdWJsaWMgZmluYWwg\nTGlzdCBuZXdVcGRhdGVzID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgIHB1\nYmxpYyBmaW5hbCBMaXN0IGV4aXN0aW5nVXBkYXRlcyA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICBwdWJsaWMgZmluYWwgTGlzdCBkZWxldGVzID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIFBDRGF0YUhvbGRlciB7CgogICAgICAgIHB1YmxpYyBmaW5hbCBEYXRhQ2Fj\naGVQQ0RhdGEgcGNkYXRhOwogICAgICAgIHB1YmxpYyBmaW5hbCBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtOwoKICAgICAgICBwdWJsaWMgUENEYXRhSG9sZGVy\nKERhdGFDYWNoZVBDRGF0YSBwY2RhdGEsCiAgICAgICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICAgICAgdGhpcy5wY2RhdGEgPSBw\nY2RhdGE7CiAgICAgICAgICAgIHRoaXMuc20gPSBzbTsKCQl9Cgl9Cn0KCg==\n","encoding":"base64"}

