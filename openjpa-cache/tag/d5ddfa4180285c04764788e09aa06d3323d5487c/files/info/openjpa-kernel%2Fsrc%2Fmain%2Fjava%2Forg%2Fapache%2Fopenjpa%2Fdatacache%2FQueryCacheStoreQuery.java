{"sha":"da65baa92cfdd6288c061eefdfdf33f746c3a05d","node_id":"MDQ6QmxvYjIwNjM2NDpkYTY1YmFhOTJjZmRkNjI4OGMwNjFlZWZkZmRmMzNmNzQ2YzNhMDVk","size":21538,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/da65baa92cfdd6288c061eefdfdf33f746c3a05d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2NrTGV2ZWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNvbnRleHQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVRdWVyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BZ2dyZWdh\ndGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIucm9wLkxpc3RSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3Np\ndG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7Cgov\nKioKICogQSB7QGxpbmsgU3RvcmVRdWVyeX0gaW1wbGVtZW50YXRpb24gdGhh\ndCBjYWNoZXMgdGhlIE9JRHMgaW52b2x2ZWQgaW4KICogdGhlIHF1ZXJ5LCBh\nbmQgY2FuIGRldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0aGUgcXVlcnkgaGFz\nIGJlZW4gZGlydGllZC4KICoKICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkK\nICogQHNpbmNlIDAuMi41LjAKICovCnB1YmxpYyBjbGFzcyBRdWVyeUNhY2hl\nU3RvcmVRdWVyeQogICAgaW1wbGVtZW50cyBTdG9yZVF1ZXJ5IHsKCiAgICBw\ncml2YXRlIGZpbmFsIFN0b3JlUXVlcnkgX3F1ZXJ5OwogICAgcHJpdmF0ZSBm\naW5hbCBRdWVyeUNhY2hlIF9jYWNoZTsKICAgIHByaXZhdGUgU3RvcmVDb250\nZXh0IF9zY3R4OwogICAgcHJpdmF0ZSBNZXRhRGF0YVJlcG9zaXRvcnkgX3Jl\ncG9zOwoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIHRo\nYXQgZGVsZWdhdGVzIHRvIDxjb2RlPnF1ZXJ5PC9jb2RlPiBpZiBubwogICAg\nICogY2FjaGVkIHJlc3VsdHMgYXJlIGF2YWlsYWJsZS4KICAgICAqLwogICAg\ncHVibGljIFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KFN0b3JlUXVlcnkgcXVlcnks\nIFF1ZXJ5Q2FjaGUgY2FjaGUpIHsKICAgICAgICBfcXVlcnkgPSBxdWVyeTsK\nICAgICAgICBfY2FjaGUgPSBjYWNoZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUge0BsaW5rIFF1ZXJ5Q2FjaGV9IHRoYXQgdGhpcyBvYmpl\nY3QgaXMgYXNzb2NpYXRlZCB3aXRoLgogICAgICovCiAgICBwdWJsaWMgUXVl\ncnlDYWNoZSBnZXRDYWNoZSgpIHsKICAgICAgICByZXR1cm4gX2NhY2hlOwog\nICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdG9yZVF1ZXJ5IGdldERlbGVnYXRlKCkgewogICAgICAgIHJldHVy\nbiBfcXVlcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb29rIGluIHRoZSBx\ndWVyeSBjYWNoZSBmb3IgYSByZXN1bHQgZm9yIHRoZSBnaXZlbiBxdWVyeQog\nICAgICoga2V5LiBPbmx5IGxvb2sgaWYgdGhpcyBxdWVyeSBpcyBiZWluZyBl\neGVjdXRlZCBvdXRzaWRlIGEKICAgICAqIHRyYW5zYWN0aW9uIG9yIGluIGEg\ndHJhbnNhY3Rpb24gd2l0aCBJZ25vcmVDaGFuZ2VzIHNldCB0byB0cnVlCiAg\nICAgKiBvciBpbiBhIHRyYW5zYWN0aW9uIHdpdGggSWdub3JlQ2hhbmdlcyBz\nZXQgdG8gZmFsc2UgYnV0IGluIHdoaWNoCiAgICAgKiBub25lIG9mIHRoZSBj\nbGFzc2VzIGludm9sdmVkIGluIHRoaXMgcXVlcnkgaGF2ZSBiZWVuIHRvdWNo\nZWQuCiAgICAgKiAgQ2FjaGluZyBpcyBub3QgdXNlZCB3aGVuIHVzaW5nIG9i\namVjdCBsb2NraW5nLgogICAgICogVGhpcyBpcyBiZWNhdXNlIHdlIG11c3Qg\nb2J0YWluIGxvY2tzIG9uIHRoZQogICAgICogZGF0YSwgYW5kIGl0IGlzIGxp\na2VseSB0aGF0IG1ha2luZyBuIHRyaXBzIHRvIHRoZSBkYXRhYmFzZSB0bwog\nICAgICogbWFrZSB0aGUgbG9ja3Mgd2lsbCBiZSBzbG93ZXIgdGhhbiBydW5u\naW5nIHRoZSBxdWVyeSBhZ2FpbnN0CiAgICAgKiB0aGUgZGF0YWJhc2UuCiAg\nICAgKiAgSWYgdGhlIGZldGNoIGNvbmZpZ3VyYXRpb24gaGFzIHF1ZXJ5IGNh\nY2hpbmcgZGlzYWJsZWQsCiAgICAgKiB0aGVuIHRoaXMgbWV0aG9kIHJldHVy\nbnMgPGNvZGU+bnVsbDwvY29kZT4uCiAgICAgKiAgUmV0dXJuIHRoZSBsaXN0\nIGlmIHdlIG1lZXQgdGhlIGFib3ZlIGNyaXRlcmlhIGFuZCBpZiBhIGxpc3QK\nICAgICAqIGlzIGZvdW5kIGZvciA8Y29kZT5xazwvY29kZT4uIEVsc2UsIHJl\ndHVybgogICAgICogPGNvZGU+bnVsbDwvY29kZT4uCiAgICAgKiAgVGhpcyBp\nbXBsZW1lbnRhdGlvbiBtZWFucyB0aGF0IHF1ZXJpZXMgYWdhaW5zdCB0aGUg\nY2FjaGUKICAgICAqIGFyZSBvZiBSRUFEX0NPTU1JVFRFRCBpc29sYXRpb24g\nbGV2ZWwuIEl0J2QgYmUgbmljZSB0byBzdXBwb3J0CiAgICAgKiBSRUFEX1NF\nUklBTElaQUJMRSAtLSB0byBkbyBzbywgd2UnZCBqdXN0IHJldHVybiBmYWxz\nZSB3aGVuIGluCiAgICAgKiBhIHRyYW5zYWN0aW9uLgogICAgICovCiAgICBw\ncml2YXRlIExpc3QgY2hlY2tDYWNoZShRdWVyeUtleSBxaykgewogICAgICAg\nIGlmIChxayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBnZXRDb250ZXh0KCku\nZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKCFmZXRjaC5n\nZXRRdWVyeUNhY2hlRW5hYmxlZCgpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpZiAoZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpID4gTG9j\na0xldmVscy5MT0NLX05PTkUpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICAvLyBnZXQgdGhlIGNhY2hlZCBkYXRhCiAgICAgICAgUXVlcnlS\nZXN1bHQgcmVzID0gX2NhY2hlLmdldChxayk7CiAgICAgICAgaWYgKHJlcyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\ncmVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25z\nLkVNUFRZX0xJU1Q7CgogICAgICAgIGludCBwcm9qcyA9IGdldENvbnRleHQo\nKS5nZXRQcm9qZWN0aW9uQWxpYXNlcygpLmxlbmd0aDsKICAgICAgICBpZiAo\ncHJvanMgPT0gMCkgewogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGRh\ndGEgY2FjaGUgY29udGFpbnMgdGhlIG9pZHMgZm9yIHRoZSBxdWVyeSByZXN1\nbHQ7CiAgICAgICAgICAgIC8vIGlmIGl0IGRvZXNuJ3QsIHRoZW4gdXNpbmcg\ndGhlIHJlc3VsdCBjb3VsZCBiZSBzbG93ZXIgdGhhbiBub3QKICAgICAgICAg\nICAgLy8gdXNpbmcgaXQgYmVjYXVzZSBvZiB0aGUgaW5kaXZpZHVhbCBieS1v\naWQgbG9va3VwcwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBf\ncmVwb3MuZ2V0TWV0YURhdGEoZ2V0Q29udGV4dCgpLgogICAgICAgICAgICAg\nICAgZ2V0Q2FuZGlkYXRlVHlwZSgpLCBfc2N0eC5nZXRDbGFzc0xvYWRlcigp\nLCB0cnVlKTsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0RGF0YUNhY2hlKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAgICAgQml0U2V0IGlkeHMgPSBtZXRhLmdldERhdGFDYWNoZSgpLmNvbnRh\naW5zQWxsKHJlcyk7CgogICAgICAgICAgICAvLyBldmVudHVhbGx5IHdlIHNo\nb3VsZCBvcHRpbWl6ZSB0aGlzIHRvIGZpZ3VyZSBvdXQgaG93IG1hbnkgb2Jq\nZWN0cwogICAgICAgICAgICAvLyB0aGUgY2FjaGUgaXMgbWlzc2luZyBhbmQg\naWYgb25seSBhIGZldyBkbyBhIGJ1bGsgZmV0Y2ggZm9yIHRoZW0KICAgICAg\nICAgICAgaW50IGxlbiA9IGlkeHMubGVuZ3RoKCk7CiAgICAgICAgICAgIGlm\nIChsZW4gPCByZXMuc2l6ZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuOyBpKysp\nCiAgICAgICAgICAgICAgICBpZiAoIWlkeHMuZ2V0KGkpKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbmV3IENhY2hlZExpc3QocmVzLCBwcm9qcyAhPSAwLCBfc2N0eCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXcmFwIHRoZSByZXN1bHQgb2JqZWN0IHBy\nb3ZpZGVyIHJldHVybmVkIGJ5IG91ciBkZWxlZ2F0ZSBpbiBhCiAgICAgKiBj\nYWNoaW5nIHByb3ZpZGVyLgogICAgICovCiAgICBwcml2YXRlIFJlc3VsdE9i\namVjdFByb3ZpZGVyIHdyYXBSZXN1bHQoUmVzdWx0T2JqZWN0UHJvdmlkZXIg\ncm9wLAogICAgICAgIFF1ZXJ5S2V5IGtleSkgewogICAgICAgIGlmIChrZXkg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJvcDsKICAgICAgICByZXR1\ncm4gbmV3IENhY2hpbmdSZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIGdldENv\nbnRleHQoKS4KICAgICAgICAgICAgZ2V0UHJvamVjdGlvbkFsaWFzZXMoKS5s\nZW5ndGggPiAwLCBrZXkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29weSBh\nIHByb2plY3Rpb24gZWxlbWVudCBmb3IgY2FjaGluZyAvIHJldHVybmluZy4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGNvcHlQcm9qZWN0\naW9uKE9iamVjdCBvYmosIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIHN3aXRjaCAoSmF2YVR5cGVzLmdldFR5cGVDb2RlKG9iai5nZXRDbGFz\ncygpKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nT0lEOgogICAgICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiAo\nKERhdGUpIG9iaikuY2xvbmUoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9DQUxFOgogICAgICAgICAgICAgICAgcmV0dXJuICgoTG9jYWxlKSBv\nYmopLmNsb25lKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICBpZiAob2JqIGluc3RhbmNlb2YgQ2FjaGVkT2JqZWN0SWQpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZyb21PYmplY3RJZCgoKENhY2hlZE9i\namVjdElkKSBvYmopLm9pZCwgY3R4KTsKICAgICAgICAgICAgICAgIE9iamVj\ndCBvaWQgPSBjdHguZ2V0T2JqZWN0SWQob2JqKTsKICAgICAgICAgICAgICAg\nIGlmIChvaWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IENhY2hlZE9iamVjdElkKG9pZCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gb2JqOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgcmVzdWx0IG9iamVjdCBiYXNlZCBvbiBpdHMgY2FjaGVkIG9pZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGZyb21PYmplY3RJ\nZChPYmplY3Qgb2lkLCBTdG9yZUNvbnRleHQgc2N0eCkgewogICAgICAgIGlm\nIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIE9iamVjdCBvYmogPSBzY3R4LmZpbmQob2lkLCBudWxsLCBudWxsLCBu\ndWxsLCAwKTsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAg\nIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihvaWQpOwogICAg\nICAgIHJldHVybiBvYmo7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB3cml0\nZVJlcGxhY2UoKQogICAgICAgIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBfcXVlcnk7CiAgICB9CgogICAgcHVibGlj\nIFF1ZXJ5Q29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBf\ncXVlcnkuZ2V0Q29udGV4dCgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndENvbnRleHQoUXVlcnlDb250ZXh0IHFjdHgpIHsKICAgICAgICBfcXVlcnku\nc2V0Q29udGV4dChxY3R4KTsKICAgICAgICBfc2N0eCA9IHFjdHguZ2V0U3Rv\ncmVDb250ZXh0KCk7CiAgICAgICAgX3JlcG9zID0gX3NjdHguZ2V0Q29uZmln\ndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gc2V0UXVlcnkoT2JqZWN0IHF1ZXJ5\nKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zZXRRdWVyeShxdWVyeSk7CiAg\nICB9CgogICAgcHVibGljIEZpbHRlckxpc3RlbmVyIGdldEZpbHRlckxpc3Rl\nbmVyKFN0cmluZyB0YWcpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldEZp\nbHRlckxpc3RlbmVyKHRhZyk7CiAgICB9CgogICAgcHVibGljIEFnZ3JlZ2F0\nZUxpc3RlbmVyIGdldEFnZ3JlZ2F0ZUxpc3RlbmVyKFN0cmluZyB0YWcpIHsK\nICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldEFnZ3JlZ2F0ZUxpc3RlbmVyKHRh\nZyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdDb21waWxhdGlvbktl\neSgpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9uS2V5\nKCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdDb21waWxhdGlvbigp\nIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9uKCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcG9wdWxhdGVGcm9tQ29tcGlsYXRpb24o\nT2JqZWN0IGNvbXApIHsKICAgICAgICBfcXVlcnkucG9wdWxhdGVGcm9tQ29t\ncGlsYXRpb24oY29tcCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW52YWxp\nZGF0ZUNvbXBpbGF0aW9uKCkgewogICAgICAgIF9xdWVyeS5pbnZhbGlkYXRl\nQ29tcGlsYXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1\nZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpIHsK\nICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRp\nb24oKTsKICAgIH0KCiAgICBwdWJsaWMgRXhlY3V0b3IgbmV3SW5NZW1vcnlF\neGVjdXRvcihDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gc3Vicykgewog\nICAgICAgIHJldHVybiBfcXVlcnkubmV3SW5NZW1vcnlFeGVjdXRvcihtZXRh\nLCBzdWJzKTsKICAgIH0KCiAgICBwdWJsaWMgRXhlY3V0b3IgbmV3RGF0YVN0\nb3JlRXhlY3V0b3IoQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1YnMp\nIHsKICAgICAgICBFeGVjdXRvciBleCA9IF9xdWVyeS5uZXdEYXRhU3RvcmVF\neGVjdXRvcihtZXRhLCBzdWJzKTsKICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5\nQ2FjaGVFeGVjdXRvcihleCwgbWV0YSwgc3Vicyk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNBYnN0cmFjdEV4ZWN1dG9ycygpIHsKICAg\nICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzQWJzdHJhY3RFeGVjdXRvcnMo\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0NhbmRpZGF0\nZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5yZXF1aXJlc0NhbmRp\nZGF0ZVR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJl\nc1BhcmFtZXRlckRlY2xhcmF0aW9ucygpIHsKICAgICAgICByZXR1cm4gX3F1\nZXJ5LnJlcXVpcmVzUGFyYW1ldGVyRGVjbGFyYXRpb25zKCk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNQYXJhbWV0ZXJEZWNsYXJhdGlv\nbnMoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zdXBwb3J0c1BhcmFtZXRl\nckRlY2xhcmF0aW9ucygpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FjaGlu\nZyBleGVjdXRvci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nUXVlcnlDYWNoZUV4ZWN1dG9yCiAgICAgICAgaW1wbGVtZW50cyBFeGVjdXRv\nciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgRXhlY3V0b3IgX2V4OwogICAg\nICAgIHByaXZhdGUgZmluYWwgQ2xhc3MgX2NhbmRpZGF0ZTsKICAgICAgICBw\ncml2YXRlIGZpbmFsIGJvb2xlYW4gX3N1YnM7CgogICAgICAgIHB1YmxpYyBR\ndWVyeUNhY2hlRXhlY3V0b3IoRXhlY3V0b3IgZXgsIENsYXNzTWV0YURhdGEg\nbWV0YSwKICAgICAgICAgICAgYm9vbGVhbiBzdWJzKSB7CiAgICAgICAgICAg\nIF9leCA9IGV4OwogICAgICAgICAgICBfY2FuZGlkYXRlID0gKG1ldGEgPT0g\nbnVsbCkgPyBudWxsIDogbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAg\nICAgICAgIF9zdWJzID0gc3ViczsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRlUXVlcnkoU3RvcmVRdWVy\neSBxLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAgICAgIFJhbmdlIHJhbmdl\nKSB7CiAgICAgICAgICAgIFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5IGNxID0gKFF1\nZXJ5Q2FjaGVTdG9yZVF1ZXJ5KSBxOwogICAgICAgICAgICBRdWVyeUtleSBr\nZXkgPSBRdWVyeUtleS5uZXdJbnN0YW5jZShjcS5nZXRDb250ZXh0KCksCiAg\nICAgICAgICAgICAgICBfZXguaXNQYWNraW5nKHEpLCBwYXJhbXMsIF9jYW5k\naWRhdGUsIF9zdWJzLCByYW5nZS5zdGFydCwgCiAgICAgICAgICAgICAgICBy\nYW5nZS5lbmQpOwogICAgICAgICAgICBMaXN0IGNhY2hlZCA9IGNxLmNoZWNr\nQ2FjaGUoa2V5KTsKICAgICAgICAgICAgaWYgKGNhY2hlZCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0UmVzdWx0T2JqZWN0UHJv\ndmlkZXIoY2FjaGVkKTsKCiAgICAgICAgICAgIFJlc3VsdE9iamVjdFByb3Zp\nZGVyIHJvcCA9IF9leC5leGVjdXRlUXVlcnkoY3EuZ2V0RGVsZWdhdGUoKSwK\nICAgICAgICAgICAgICAgIHBhcmFtcywgcmFuZ2UpOwogICAgICAgICAgICBy\nZXR1cm4gY3Eud3JhcFJlc3VsdChyb3AsIGtleSk7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBDbGVhciB0aGUgY2FjaGVkIHF1ZXJpZXMg\nYXNzb2NpYXRlZCB3aXRoIHRoZSBhY2Nlc3MgcGF0aAogICAgICAgICAqIGNs\nYXNzZXMgaW4gdGhlIHF1ZXJ5LiBUaGlzIGlzIGRvbmUgd2hlbiBidWxrIG9w\nZXJhdGlvbnMKICAgICAgICAgKiAoc3VjaCBhcyBkZWxldGVzIG9yIHVwZGF0\nZXMpIGFyZSBwZXJmb3JtZWQgc28gdGhhdCB0aGUKICAgICAgICAgKiBjYWNo\nZSByZW1haW5zIHVwLXRvLWRhdGUuCiAgICAgICAgICovCiAgICAgICAgcHJp\ndmF0ZSB2b2lkIGNsZWFyQWNjZXNzUGF0aChTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgaWYgKHEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgICAgIENsYXNzTWV0YURhdGFbXSBjbWQgPSBnZXRBY2Nl\nc3NQYXRoTWV0YURhdGFzKHEpOwogICAgICAgICAgICBpZiAoY21kID09IG51\nbGwgfHwgY21kLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgTGlzdCBjbGFzc2VzID0gbmV3IEFycmF5TGlzdChj\nbWQubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nbWQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjbGFzc2VzLmFkZChj\nbWRbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpKTsKCiAgICAgICAgICAgIC8vIGV2\naWN0IGZyb20gdGhlIHF1ZXJ5IGNhY2hlCiAgICAgICAgICAgIFF1ZXJ5Q2Fj\naGVTdG9yZVF1ZXJ5IGNxID0gKFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KSBxOwog\nICAgICAgICAgICBjcS5nZXRDYWNoZSgpLm9uVHlwZXNDaGFuZ2VkKG5ldyBU\neXBlc0NoYW5nZWRFdmVudAogICAgICAgICAgICAgICAgKHEuZ2V0Q29udGV4\ndCgpLCBjbGFzc2VzKSk7CgogICAgICAgICAgICAvLyBldmljdCBmcm9tIHRo\nZSBkYXRhIGNhY2hlCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY21kLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoY21kW2ld\nLmdldERhdGFDYWNoZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nY21kW2ldLmdldERhdGFDYWNoZSgpLnJlbW92ZUFsbCgKICAgICAgICAgICAg\nICAgICAgICAgICAgY21kW2ldLmdldERlc2NyaWJlZFR5cGUoKSwgdHJ1ZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOdW1i\nZXIgZXhlY3V0ZURlbGV0ZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFt\ncykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIF9leC5leGVjdXRlRGVsZXRlKHVud3JhcChxKSwgcGFyYW1zKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGNsZWFyQWNjZXNz\nUGF0aChxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIE51bWJlciBleGVjdXRlVXBkYXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gX2V4LmV4ZWN1dGVVcGRhdGUodW53cmFwKHEpLCBwYXJhbXMp\nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgY2xl\nYXJBY2Nlc3NQYXRoKHEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhTdG9y\nZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgUmFuZ2Ug\ncmFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX1NUUklOR1M7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCB2YWxpZGF0ZShTdG9yZVF1\nZXJ5IHEpIHsKICAgICAgICAgICAgX2V4LnZhbGlkYXRlKHVud3JhcChxKSk7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyB2b2lkIGdldFJh\nbmdlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLCBSYW5nZSByYW5n\nZSkgewogICAgICAgICAgICBfZXguZ2V0UmFuZ2UocSwgcGFyYW1zLCByYW5n\nZSk7IAogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRl\ncmluZ1ZhbHVlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAg\nICAgICAgICBPYmplY3QgcmVzdWx0T2JqZWN0LCBpbnQgb3JkZXJJbmRleCkg\newogICAgICAgICAgICByZXR1cm4gX2V4LmdldE9yZGVyaW5nVmFsdWUodW53\ncmFwKHEpLCBwYXJhbXMsIHJlc3VsdE9iamVjdCwKICAgICAgICAgICAgICAg\nIG9yZGVySW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW5bXSBnZXRBc2NlbmRpbmcoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAg\nIHJldHVybiBfZXguZ2V0QXNjZW5kaW5nKHVud3JhcChxKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1BhY2tpbmcoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguaXNQYWNraW5nKHVud3Jh\ncChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldEFs\naWFzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4Lmdl\ndEFsaWFzKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nQ2xhc3MgZ2V0UmVzdWx0Q2xhc3MoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIHJldHVybiBfZXguZ2V0UmVzdWx0Q2xhc3ModW53cmFwKHEpKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRQcm9qZWN0aW9u\nQWxpYXNlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9l\neC5nZXRQcm9qZWN0aW9uQWxpYXNlcyh1bndyYXAocSkpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIENsYXNzW10gZ2V0UHJvamVjdGlvblR5cGVzKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldFByb2pl\nY3Rpb25UeXBlcyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIENsYXNzTWV0YURhdGFbXSBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldEFjY2Vz\nc1BhdGhNZXRhRGF0YXModW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgZ2V0T3BlcmF0aW9uKFN0b3JlUXVlcnkgcSkgewogICAg\nICAgICAgICByZXR1cm4gX2V4LmdldE9wZXJhdGlvbih1bndyYXAocSkpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNBZ2dyZWdhdGUo\nU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguaXNBZ2dy\nZWdhdGUodW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc0dyb3VwaW5nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gX2V4Lmhhc0dyb3VwaW5nKHVud3JhcChxKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgTGlua2VkTWFwIGdldFBhcmFtZXRlclR5cGVz\nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldFBh\ncmFtZXRlclR5cGVzKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgTWFwIGdldFVwZGF0ZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIHJldHVybiBfZXguZ2V0VXBkYXRlcyh1bndyYXAocSkpOwogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgU3RvcmVRdWVyeSB1bndyYXAo\nU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiAoKFF1ZXJ5Q2Fj\naGVTdG9yZVF1ZXJ5KSBxKS5nZXREZWxlZ2F0ZSgpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJlc3VsdCBsaXN0IGltcGxlbWVudGF0aW9u\nIGZvciBhIGNhY2hlZCBxdWVyeSByZXN1bHQuIFBhY2thZ2UtcHJvdGVjdGVk\nCiAgICAgKiBmb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBjbGFzcyBDYWNoZWRMaXN0CiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdExp\nc3QKICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAg\nIHByaXZhdGUgZmluYWwgUXVlcnlSZXN1bHQgX3JlczsKICAgICAgICBwcml2\nYXRlIGZpbmFsIGJvb2xlYW4gX3Byb2o7CiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBTdG9yZUNvbnRleHQgX3NjdHg7CgogICAgICAgIHB1YmxpYyBDYWNoZWRM\naXN0KFF1ZXJ5UmVzdWx0IHJlcywgYm9vbGVhbiBwcm9qLCBTdG9yZUNvbnRl\neHQgY3R4KSB7CiAgICAgICAgICAgIF9yZXMgPSByZXM7CiAgICAgICAgICAg\nIF9wcm9qID0gcHJvajsKICAgICAgICAgICAgX3NjdHggPSBjdHg7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaWR4KSB7CiAg\nICAgICAgICAgIGlmICghX3Byb2opCiAgICAgICAgICAgICAgICByZXR1cm4g\nZnJvbU9iamVjdElkKF9yZXMuZ2V0KGlkeCksIF9zY3R4KTsKCiAgICAgICAg\nICAgIE9iamVjdFtdIGNhY2hlZCA9IChPYmplY3RbXSkgX3Jlcy5nZXQoaWR4\nKTsKICAgICAgICAgICAgaWYgKGNhY2hlZCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIE9iamVjdFtdIHVuY2Fj\naGVkID0gbmV3IE9iamVjdFtjYWNoZWQubGVuZ3RoXTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjYWNoZWQubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICB1bmNhY2hlZFtpXSA9IGNvcHlQcm9qZWN0aW9uKGNhY2hl\nZFtpXSwgX3NjdHgpOwogICAgICAgICAgICByZXR1cm4gdW5jYWNoZWQ7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAg\nICAgIHJldHVybiBfcmVzLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBPYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICAgICAgdGhyb3dz\nIE9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgQXJyYXlMaXN0KHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEEgd3JhcHBlciBhcm91bmQgYSB7QGxpbmsgUmVzdWx0T2JqZWN0\nUHJvdmlkZXJ9IHRoYXQgYnVpbGRzIHVwIGEgbGlzdCBvZgogICAgICogYWxs\nIHRoZSBPSURzIGluIHRoaXMgbGlzdCBhbmQgcmVnaXN0ZXJzIHRoYXQgbGlz\ndCB3aXRoIHRoZQogICAgICogcXVlcnkgY2FjaGUuIEFiYW5kb25zIG1vbml0\nb3JpbmcgYW5kIHJlZ2lzdGVyaW5nIGlmIG9uZSBvZiB0aGUgY2xhc3Nlcwog\nICAgICogaW4gdGhlIGFjY2VzcyBwYXRoIGlzIG1vZGlmaWVkIHdoaWxlIHRo\nZSBxdWVyeSByZXN1bHRzIGFyZSBiZWluZyBsb2FkZWQuCiAgICAgKi8KICAg\nIHByaXZhdGUgY2xhc3MgQ2FjaGluZ1Jlc3VsdE9iamVjdFByb3ZpZGVyCiAg\nICAgICAgaW1wbGVtZW50cyBSZXN1bHRPYmplY3RQcm92aWRlciwgVHlwZXND\naGFuZ2VkTGlzdGVuZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3Vs\ndE9iamVjdFByb3ZpZGVyIF9yb3A7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBi\nb29sZWFuIF9wcm9qOwogICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlLZXkg\nX3FrOwogICAgICAgIHByaXZhdGUgZmluYWwgVHJlZU1hcCBfZGF0YSA9IG5l\ndyBUcmVlTWFwKCk7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9tYWludGFp\nbkNhY2hlID0gdHJ1ZTsKICAgICAgICBwcml2YXRlIGludCBfcG9zID0gLTE7\nCgogICAgICAgIC8vIHVzZWQgdG8gZGV0ZXJtaW5lIGxpc3Qgc2l6ZSB3aXRo\nb3V0IG5lY2Vzc2FyaWx5IGNhbGxpbmcgc2l6ZSgpLAogICAgICAgIC8vIHdo\naWNoIG1heSByZXF1aXJlIGEgREIgdHJpcCBvciByZXR1cm4gSW50ZWdlci5N\nQVhfVkFMVUUKICAgICAgICBwcml2YXRlIGludCBfbWF4ID0gLTE7CiAgICAg\nICAgcHJpdmF0ZSBpbnQgX3NpemUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKCiAg\nICAgICAgLyoqCiAgICAgICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBkZWxl\nZ2F0ZSByZXN1bHQgcHJvdmlkZXIgYW5kIG91ciBxdWVyeSBrZXkuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIENhY2hpbmdSZXN1bHRPYmplY3RQcm92\naWRlcihSZXN1bHRPYmplY3RQcm92aWRlciByb3AsCiAgICAgICAgICAgIGJv\nb2xlYW4gcHJvaiwgUXVlcnlLZXkga2V5KSB7CiAgICAgICAgICAgIF9yb3Ag\nPSByb3A7CiAgICAgICAgICAgIF9wcm9qID0gcHJvajsKICAgICAgICAgICAg\nX3FrID0ga2V5OwogICAgICAgICAgICBfY2FjaGUuYWRkVHlwZXNDaGFuZ2Vk\nTGlzdGVuZXIodGhpcyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBTdG9wIGNhY2hpbmcuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0\nZSB2b2lkIGFib3J0Q2FjaGluZygpIHsKICAgICAgICAgICAgaWYgKCFfbWFp\nbnRhaW5DYWNoZSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nICAgIC8vIHRoaXMgY2FuIGJlIGNhbGxlZCB2aWEgYW4gZXZlbnQgZnJvbSBh\nbm90aGVyIHRocmVhZAogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMp\nIHsKICAgICAgICAgICAgICAgIC8vIGl0J3MgaW1wb3J0YW50IHRoYXQgd2Ug\nc2V0IHRoaXMgZmxhZyBmaXJzdCBzbyB0aGF0IGFueQogICAgICAgICAgICAg\nICAgLy8gc3Vic2VxdWVudCBjYWxscyB0byB0aGlzIG9iamVjdCBhcmUgYnlw\nYXNzZWQuCiAgICAgICAgICAgICAgICBfbWFpbnRhaW5DYWNoZSA9IGZhbHNl\nOwogICAgICAgICAgICAgICAgX2NhY2hlLnJlbW92ZVR5cGVzQ2hhbmdlZExp\nc3RlbmVyKHRoaXMpOwogICAgICAgICAgICAgICAgX2RhdGEuY2xlYXIoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogQ2hlY2sgd2hldGhlciB3ZSd2ZSBidWZmZXJlZCBhbGwgcmVzdWx0cywg\nd2hpbGUgb3B0aW9uYWxseSBhZGRpbmcKICAgICAgICAgKiB0aGUgZ2l2ZW4g\ncmVzdWx0LgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBjaGVj\na0ZpbmlzaGVkKE9iamVjdCBvYmosIGJvb2xlYW4gcmVzdWx0KSB7CiAgICAg\nICAgICAgIC8vIHRoaXMgY2FuIGJlIGNhbGxlZCBhdCB0aGUgc2FtZSB0aW1l\nIGFzIGFib3J0Q2FjaGluZyB2aWEKICAgICAgICAgICAgLy8gYSB0eXBlcyBj\naGFuZ2VkIGV2ZW50CiAgICAgICAgICAgIGJvb2xlYW4gZmluaXNoZWQgPSBm\nYWxzZTsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAg\nICAgICAgICAgICBpZiAoX21haW50YWluQ2FjaGUpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIEludGVnZXIgaW5kZXggPSBOdW1iZXJzLnZhbHVlT2YoX3Bvcyk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmICghX2RhdGEuY29udGFpbnNLZXkoaW5k\nZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QgY2Fj\naGVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZCA9\nIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgh\nX3Byb2opCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVk\nID0gX3NjdHguZ2V0T2JqZWN0SWQob2JqKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIE9iamVjdFtdIGFyciA9IChPYmplY3RbXSkgb2JqOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFtdIGNwID0gbmV3IE9iamVj\ndFthcnIubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BbaV0gPSBjb3B5UHJv\namVjdGlvbihhcnJbaV0sIF9zY3R4KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjYWNoZWQgPSBjcDsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWNo\nZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBf\nZGF0YS5wdXQoaW5kZXgsIGNhY2hlZCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgZmluaXNoZWQgPSBfc2l6ZSA9PSBfZGF0YS5zaXplKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaW5p\nc2hlZCkgewogICAgICAgICAgICAgICAgLy8gYW4gYWJvcnRDYWNoaW5nIGNh\nbGwgY2FuIHNuZWFrIGluIGhlcmUgdmlhIG9uRXhwaXJlOyB0aGUKICAgICAg\nICAgICAgICAgIC8vIGNhY2hlIGlzIGxvY2tlZCBkdXJpbmcgZXZlbnQgZmly\naW5ncywgc28gdGhlIGxvY2sgaGVyZSB3aWxsCiAgICAgICAgICAgICAgICAv\nLyB3YWl0IGZvciBpdCAob3Igd2lsbCBmb3JjZSB0aGUgbmV4dCBmaXJpbmcg\ndG8gd2FpdCkKICAgICAgICAgICAgICAgIF9jYWNoZS53cml0ZUxvY2soKTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIHdlIGRpZG4ndCBhYm9ydAogICAgICAgICAgICAgICAgICAg\nIGlmIChfbWFpbnRhaW5DYWNoZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBRdWVyeVJlc3VsdCByZXMgPSBuZXcgUXVlcnlSZXN1bHQoX3FrLCBfZGF0\nYS52YWx1ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jYWNoZS5w\ndXQoX3FrLCByZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydENh\nY2hpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nICAgICBfY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gc3VwcG9ydHNSYW5kb21BY2Nlc3MoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcm9wLnN1cHBvcnRzUmFuZG9tQWNjZXNzKCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBvcGVuKCkKICAgICAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIF9yb3Aub3BlbigpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRSZXN1bHRPYmplY3QoKQogICAg\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgT2JqZWN0\nIG9iaiA9IF9yb3AuZ2V0UmVzdWx0T2JqZWN0KCk7CiAgICAgICAgICAgIGNo\nZWNrRmluaXNoZWQob2JqLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIG9i\najsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIG5leHQoKQog\nICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3Bv\ncysrOwogICAgICAgICAgICBib29sZWFuIG5leHQgPSBfcm9wLm5leHQoKTsK\nICAgICAgICAgICAgaWYgKCFuZXh0ICYmIF9wb3MgPT0gX21heCArIDEpIHsK\nICAgICAgICAgICAgICAgIF9zaXplID0gX3BvczsKICAgICAgICAgICAgICAg\nIGNoZWNrRmluaXNoZWQobnVsbCwgZmFsc2UpOwogICAgICAgICAgICB9IGVs\nc2UgaWYgKG5leHQgJiYgX3BvcyA+IF9tYXgpCiAgICAgICAgICAgICAgICBf\nbWF4ID0gX3BvczsKICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhYnNvbHV0ZShpbnQgcG9zKQog\nICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3Bv\ncyA9IHBvczsKICAgICAgICAgICAgYm9vbGVhbiB2YWxpZCA9IF9yb3AuYWJz\nb2x1dGUocG9zKTsKICAgICAgICAgICAgaWYgKCF2YWxpZCAmJiBfcG9zID09\nIF9tYXggKyAxKSB7CiAgICAgICAgICAgICAgICBfc2l6ZSA9IF9wb3M7CiAg\nICAgICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG51bGwsIGZhbHNlKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmICh2YWxpZCAmJiBfcG9zID4gX21heCkKICAg\nICAgICAgICAgICAgIF9tYXggPSBfcG9zOwogICAgICAgICAgICByZXR1cm4g\ndmFsaWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKQog\nICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYg\nKF9zaXplICE9IEludGVnZXIuTUFYX1ZBTFVFKQogICAgICAgICAgICAgICAg\ncmV0dXJuIF9zaXplOwogICAgICAgICAgICBpbnQgc2l6ZSA9IF9yb3Auc2l6\nZSgpOwogICAgICAgICAgICBfc2l6ZSA9IHNpemU7CiAgICAgICAgICAgIGNo\nZWNrRmluaXNoZWQobnVsbCwgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4g\nc2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlc2V0KCkK\nICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9y\nb3AucmVzZXQoKTsKICAgICAgICAgICAgX3BvcyA9IC0xOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKQogICAgICAgICAgICB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAg\nICAgICAgICAgIF9yb3AuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGhhbmRsZUNoZWNrZWRFeGNlcHRpb24oRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgX3JvcC5oYW5kbGVDaGVja2VkRXhjZXB0aW9uKGUp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb25UeXBlc0NoYW5n\nZWQoVHlwZXNDaGFuZ2VkRXZlbnQgZXYpIHsKICAgICAgICAgICAgaWYgKF9x\nay5jaGFuZ2VJbnZhbGlkYXRlc1F1ZXJ5KGV2LmdldFR5cGVzKCkpKQogICAg\nICAgICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU3RydWN0IHRvIHJlY29nbml6ZSBjYWNoZWQgb2lk\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ2FjaGVkT2Jq\nZWN0SWQgewoKICAgICAgICBwdWJsaWMgZmluYWwgT2JqZWN0IG9pZDsKCiAg\nICAgICAgcHVibGljIENhY2hlZE9iamVjdElkIChPYmplY3Qgb2lkKQoJCXsK\nCQkJdGhpcy5vaWQgPSBvaWQ7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

