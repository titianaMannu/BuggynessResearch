{"sha":"53cc3c137eb884e96b6ed48a0b9479bc522965b3","node_id":"MDQ6QmxvYjIwNjM2NDo1M2NjM2MxMzdlYjg4NGU5NmI2ZWQ0OGEwYjk0NzliYzUyMjk2NWIz","size":12874,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/53cc3c137eb884e96b6ed48a0b9479bc522965b3","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlOw0KDQppbXBvcnQgamF2YS5pby5GaWxlOw0KaW1wb3J0IGphdmEuaW8u\nSU9FeGNlcHRpb247DQppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsNCmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsNCmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbnM7DQppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7DQppbXBv\ncnQgamF2YS51dGlsLkhhc2hTZXQ7DQppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOw0KaW1wb3J0IGphdmEudXRpbC5MaXN0Ow0KaW1wb3J0IGphdmEudXRp\nbC5NYXA7DQppbXBvcnQgamF2YS51dGlsLlNldDsNCg0KaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOw0KaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsNCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQnl0ZWNvZGVXcml0ZXI7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkphdmFWZXJzaW9u\nczsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxp\nemVyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5GaWxl\nczsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxp\nemVyLk1lc3NhZ2U7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nQ2xhc3NNZXRhRGF0YTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5GaWVsZE1ldGFEYXRhOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5HZW5lcmF0ZWRDbGFzc2VzOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkltcGxIZWxwZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsNCmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkJDQ2xhc3M7DQoNCi8qKg0KICogUmVkZWZpbmVzIHRoZSBtZXRob2Qg\nYm9kaWVzIG9mIGV4aXN0aW5nIHVuZW5oYW5jZWQgY2xhc3NlcyB0byBtYWtl\nIHRoZW0NCiAqIG5vdGlmeSBzdGF0ZSBtYW5hZ2VycyBvZiBtdXRhdGlvbnMu\nDQogKg0KICogQHNpbmNlIDEuMC4wDQogKi8NCnB1YmxpYyBjbGFzcyBNYW5h\nZ2VkQ2xhc3NTdWJjbGFzc2VyIHsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKA0KICAg\nICAgICBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyLmNsYXNzKTsNCg0KICAgIC8q\nKg0KICAgICAqIEZvciBlYWNoIGVsZW1lbnQgaW4gPGNvZGU+Y2xhc3Nlczwv\nY29kZT4sIGNyZWF0ZXMgYW5kIHJlZ2lzdGVycyBhDQogICAgICogbmV3IHN1\nYmNsYXNzIHRoYXQgaW1wbGVtZW50cyB7QGxpbmsgUGVyc2lzdGVuY2VDYXBh\nYmxlfSwgYW5kIHByZXBhcmVzDQogICAgICogT3BlbkpQQSB0byBoYW5kbGUg\nbmV3IGluc3RhbmNlcyBvZiB0aGUgdW5lbmhhbmNlZCB0eXBlLiBJZiB0aGlz\nIGlzDQogICAgICogaW52b2tlZCBpbiBhIEphdmEgNiBlbnZpcm9ubWVudCwg\ndGhpcyBtZXRob2Qgd2lsbCByZWRlZmluZSB0aGUgbWV0aG9kcw0KICAgICAq\nIGZvciBlYWNoIGNsYXNzIGluIHRoZSBhcmd1bWVudCBsaXN0IHN1Y2ggdGhh\ndCBmaWVsZCBhY2Nlc3NlcyBhcmUNCiAgICAgKiBpbnRlcmNlcHRlZCBpbi1s\naW5lLiBJZiBpbnZva2VkIGluIGEgSmF2YSA1IGVudmlyb25tZW50LCB0aGlz\nDQogICAgICogcmVkZWZpbml0aW9uIGlzIG5vdCBwb3NzaWJsZTsgaW4gdGhl\nc2UgY29udGV4dHMsIHdoZW4gdXNpbmcgZmllbGQNCiAgICAgKiBhY2Nlc3Ms\nIE9wZW5KUEEgd2lsbCBuZWVkIHRvIGRvIHN0YXRlIGNvbXBhcmlzb25zIHRv\nIGRldGVjdCBhbnkgY2hhbmdlDQogICAgICogdG8gYW55IGluc3RhbmNlIGF0\nIGFueSB0aW1lLCBhbmQgd2hlbiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIE9w\nZW5KUEENCiAgICAgKiB3aWxsIG5lZWQgdG8gZG8gc3RhdGUgY29tcGFyaXNv\nbnMgdG8gZGV0ZWN0IGNoYW5nZXMgdG8gbmV3bHkgaW5zZXJ0ZWQNCiAgICAg\nKiBpbnN0YW5jZXMgYWZ0ZXIgYSBmbHVzaCBoYXMgYmVlbiBjYWxsZWQuDQog\nICAgICoNCiAgICAgKiBAcmV0dXJuIHRoZSBuZXcgc3ViY2xhc3Nlcywgb3Ig\nPGNvZGU+bnVsbDwvY29kZT4gaWYgPGNvZGU+Y2xhc3NlczwvY29kZT4NCiAg\nICAgKiBpcyA8Y29kZT5udWxsPC9jb2RlPi4NCiAgICAgKiBAdGhyb3dzIFVz\nZXJFeGNlcHRpb24gaWYgPGNvZGU+Y29uZjwvY29kZT4gcmVxdWlyZXMgYnVp\nbGQtdGltZQ0KICAgICAqIGVuaGFuY2VtZW50IGFuZCA8Y29kZT5jbGFzc2Vz\nPC9jb2RlPiBpbmNsdWRlcyB1bmVuaGFuY2VkIHR5cGVzLg0KICAgICAqDQog\nICAgICogQHNpbmNlIDEuMC4wDQogICAgICovDQogICAgcHVibGljIHN0YXRp\nYyBMaXN0PENsYXNzPiBwcmVwYXJlVW5lbmhhbmNlZENsYXNzZXMoDQogICAg\nICAgIGZpbmFsIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsDQogICAgICAg\nIGZpbmFsIENvbGxlY3Rpb248PyBleHRlbmRzIENsYXNzPiBjbGFzc2VzLA0K\nICAgICAgICBmaW5hbCBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsNCiAgICAg\nICAgaWYgKGNsYXNzZXMgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOw0KICAgICAgICBpZiAoY2xhc3Nlcy5zaXplKCkgPT0gMCkNCiAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0KDQogICAg\nICAgIExvZyBsb2cgPSBjb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlv\nbi5MT0dfRU5IQU5DRSk7DQogICAgICAgIGlmIChjb25mLmdldFJ1bnRpbWVV\nbmVuaGFuY2VkQ2xhc3Nlc0NvbnN0YW50KCkNCiAgICAgICAgICAgICE9IFJ1\nbnRpbWVVbmVuaGFuY2VkQ2xhc3NzZXNNb2Rlcy5TVVBQT1JURUQpIHsNCiAg\nICAgICAgICAgIENvbGxlY3Rpb24gdW5lbmhhbmNlZCA9IG5ldyBBcnJheUxp\nc3QoKTsNCiAgICAgICAgICAgIGZvciAoQ2xhc3MgY2xzIDogY2xhc3NlcykN\nCiAgICAgICAgICAgICAgICBpZiAoIVBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFz\ncy5pc0Fzc2lnbmFibGVGcm9tKGNscykpDQogICAgICAgICAgICAgICAgICAg\nIHVuZW5oYW5jZWQuYWRkKGNscyk7DQogICAgICAgICAgICBpZiAodW5lbmhh\nbmNlZC5zaXplKCkgPiAwKSB7DQogICAgICAgICAgICAgICAgTWVzc2FnZSBt\nc2cgPSBfbG9jLmdldCgicnVudGltZS1vcHRpbWl6YXRpb24tZGlzYWJsZWQi\nLA0KICAgICAgICAgICAgICAgICAgICB1bmVuaGFuY2VkKTsNCiAgICAgICAg\nICAgICAgICBpZiAoY29uZi5nZXRSdW50aW1lVW5lbmhhbmNlZENsYXNzZXND\nb25zdGFudCgpDQogICAgICAgICAgICAgICAgICAgID09IFJ1bnRpbWVVbmVu\naGFuY2VkQ2xhc3NzZXNNb2Rlcy5XQVJOKQ0KICAgICAgICAgICAgICAgICAg\nICBsb2cud2Fybihtc2cpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24obXNnKTsN\nCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAg\nICAgICB9DQoNCiAgICAgICAgYm9vbGVhbiByZWRlZmluZSA9IENsYXNzUmVk\nZWZpbmVyLmNhblJlZGVmaW5lQ2xhc3NlcygpOw0KICAgICAgICBpZiAocmVk\nZWZpbmUpDQogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgiZW5oYW5j\nZS1hbmQtc3ViY2xhc3MtYW5kLXJlZGVmLXN0YXJ0IiwNCiAgICAgICAgICAg\nICAgICBjbGFzc2VzKSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGxv\nZy5pbmZvKF9sb2MuZ2V0KCJlbmhhbmNlLWFuZC1zdWJjbGFzcy1uby1yZWRl\nZi1zdGFydCIsDQogICAgICAgICAgICAgICAgY2xhc3NlcykpOw0KDQogICAg\nICAgIGZpbmFsIE1hcDxDbGFzcywgYnl0ZVtdPiBtYXAgPSBuZXcgSGFzaE1h\ncDxDbGFzcywgYnl0ZVtdPigpOw0KICAgICAgICBmaW5hbCBMaXN0IHN1YnMg\nPSBuZXcgQXJyYXlMaXN0KGNsYXNzZXMuc2l6ZSgpKTsNCiAgICAgICAgZmlu\nYWwgTGlzdCBpbnRzID0gbmV3IEFycmF5TGlzdChjbGFzc2VzLnNpemUoKSk7\nDQogICAgICAgIFNldDxDbGFzcz4gdW5zcGVjaWZpZWQgPSBudWxsOw0KICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBjbGFzc2VzLml0ZXJhdG9yKCk7\nIGl0ZXIuaGFzTmV4dCgpOyApIHsNCiAgICAgICAgICAgIGZpbmFsIENsYXNz\nIGNscyA9IChDbGFzcykgaXRlci5uZXh0KCk7DQogICAgICAgICAgICBmaW5h\nbCBQQ0VuaGFuY2VyIGVuaGFuY2VyID0gbmV3IFBDRW5oYW5jZXIoY29uZiwg\nY2xzKTsgDQoNCiAgICAgICAgICAgIGVuaGFuY2VyLnNldEJ5dGVjb2RlV3Jp\ndGVyKG5ldyBCeXRlY29kZVdyaXRlcigpIHsNCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCB3cml0ZShCQ0NsYXNzIGJjKSB0aHJvd3MgSU9FeGNlcHRp\nb24gew0KICAgICAgICAgICAgICAgICAgICBNYW5hZ2VkQ2xhc3NTdWJjbGFz\nc2VyLndyaXRlKGJjLCBlbmhhbmNlciwgbWFwLA0KICAgICAgICAgICAgICAg\nICAgICAgICAgY2xzLCBzdWJzLCBpbnRzKTsNCiAgICAgICAgICAgICAgICB9\nDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmIChyZWRlZmluZSkN\nCiAgICAgICAgICAgICAgICBlbmhhbmNlci5zZXRSZWRlZmluZSh0cnVlKTsN\nCiAgICAgICAgICAgIGVuaGFuY2VyLnNldENyZWF0ZVN1YmNsYXNzKHRydWUp\nOw0KICAgICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVj\ndG9yKHRydWUpOw0KDQogICAgICAgICAgICAvLyBzZXQgdGhpcyBiZWZvcmUg\nZW5oYW5jZW1lbnQgYXMgd2VsbCBhcyBhZnRlciBzaW5jZSBlbmhhbmNlbWVu\ndA0KICAgICAgICAgICAgLy8gdXNlcyBhIGRpZmZlcmVudCBtZXRhZGF0YSBy\nZXBvc2l0b3J5LCBhbmQgdGhlIG1ldGFkYXRhIGNvbmZpZw0KICAgICAgICAg\nICAgLy8gbWF0dGVycyBpbiB0aGUgZW5oYW5jZW1lbnQgY29udHJhY3QuIERv\nbid0IGRvIGFueSB3YXJuaW5nIGhlcmUsDQogICAgICAgICAgICAvLyBzaW5j\nZSB3ZSdsbCBpc3N1ZSB3YXJuaW5ncyB3aGVuIHdlIGRvIHRoZSBmaW5hbCBt\nZXRhZGF0YQ0KICAgICAgICAgICAgLy8gcmVjb25maWd1cmF0aW9uIGF0IHRo\nZSBlbmQgb2YgdGhpcyBtZXRob2QuDQogICAgICAgICAgICBjb25maWd1cmVN\nZXRhRGF0YShlbmhhbmNlci5nZXRNZXRhRGF0YSgpLCBjb25mLCByZWRlZmlu\nZSwgZmFsc2UpOw0KDQogICAgICAgICAgICB1bnNwZWNpZmllZCA9IGNvbGxl\nY3RSZWxhdGVkVW5zcGVjaWZpZWRUeXBlcyhlbmhhbmNlci5nZXRNZXRhRGF0\nYSgpLA0KICAgICAgICAgICAgICAgIGNsYXNzZXMsIHVuc3BlY2lmaWVkKTsN\nCg0KICAgICAgICAgICAgaW50IHJ1blJlc3VsdCA9IGVuaGFuY2VyLnJ1bigp\nOw0KICAgICAgICAgICAgaWYgKHJ1blJlc3VsdCA9PSBQQ0VuaGFuY2VyLkVO\nSEFOQ0VfUEMpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgICAgICAgICBlbmhhbmNlci5yZWNvcmQoKTsNCiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICAgICAg\nICAgIC8vIG91ciBpbXBsIG9mIEJ5dGVjb2RlV3JpdGVyIGRvZXNuJ3QgdGhy\nb3cgSU9FeGNlcHRpb24NCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKGUpOw0KICAgICAgICAgICAgICAgIH0NCiAg\nICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh1bnNwZWNp\nZmllZCAhPSBudWxsICYmICF1bnNwZWNpZmllZC5pc0VtcHR5KCkpDQogICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgidW5z\ncGVjaWZpZWQtdW5lbmhhbmNlZC10eXBlcyIsDQogICAgICAgICAgICAgICAg\nY2xhc3NlcywgdW5zcGVjaWZpZWQpKTsNCg0KICAgICAgICBDbGFzc1JlZGVm\naW5lci5yZWRlZmluZUNsYXNzZXMoY29uZiwgbWFwKTsNCiAgICAgICAgZm9y\nIChDbGFzcyBjbHMgOiBtYXAua2V5U2V0KCkpIHsNCiAgICAgICAgICAgIHNl\ndEludGVyY2VwdGluZyhjb25mLCBlbnZMb2FkZXIsIGNscyk7DQogICAgICAg\nICAgICBjb25maWd1cmVNZXRhRGF0YShjb25mLCBlbnZMb2FkZXIsIGNscywg\ncmVkZWZpbmUpOw0KICAgICAgICB9DQogICAgICAgIGZvciAoQ2xhc3MgY2xz\nIDogKENvbGxlY3Rpb248Q2xhc3M+KSBzdWJzKQ0KICAgICAgICAgICAgY29u\nZmlndXJlTWV0YURhdGEoY29uZiwgZW52TG9hZGVyLCBjbHMsIHJlZGVmaW5l\nKTsNCiAgICAgICAgZm9yIChDbGFzcyBjbHMgOiAoQ29sbGVjdGlvbjxDbGFz\ncz4pIGludHMpDQogICAgICAgICAgICBzZXRJbnRlcmNlcHRpbmcoY29uZiwg\nZW52TG9hZGVyLCBjbHMpOw0KDQogICAgICAgIHJldHVybiBzdWJzOw0KICAg\nIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIFNldDxDbGFzcz4gY29sbGVjdFJl\nbGF0ZWRVbnNwZWNpZmllZFR5cGVzKENsYXNzTWV0YURhdGEgbWV0YSwNCiAg\nICAgICAgQ29sbGVjdGlvbjw/IGV4dGVuZHMgQ2xhc3M+IGNsYXNzZXMsIFNl\ndDxDbGFzcz4gdW5zcGVjaWZpZWQpIHsNCiAgICAgICAgdW5zcGVjaWZpZWQg\nPSBjb2xsZWN0VW5zcGVjaWZpZWRUeXBlKG1ldGEuZ2V0UENTdXBlcmNsYXNz\nKCksIGNsYXNzZXMsDQogICAgICAgICAgICB1bnNwZWNpZmllZCk7DQoNCiAg\nICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RmllbGRz\nKCkpIHsNCiAgICAgICAgICAgIGlmIChmbWQuaXNUcmFuc2llbnQoKSkNCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIGlmIChmbWQu\naXNUeXBlUEMoKSkNCiAgICAgICAgICAgICAgICB1bnNwZWNpZmllZCA9IGNv\nbGxlY3RVbnNwZWNpZmllZFR5cGUoZm1kLmdldFR5cGUoKSwgY2xhc3NlcywN\nCiAgICAgICAgICAgICAgICAgICAgdW5zcGVjaWZpZWQpOw0KICAgICAgICAg\nICAgaWYgKGZtZC5nZXRFbGVtZW50KCkgIT0gbnVsbCAmJiBmbWQuZ2V0RWxl\nbWVudCgpLmlzVHlwZVBDKCkpDQogICAgICAgICAgICAgICAgdW5zcGVjaWZp\nZWQgPSBjb2xsZWN0VW5zcGVjaWZpZWRUeXBlKGZtZC5nZXRFbGVtZW50KCku\nZ2V0VHlwZSgpLA0KICAgICAgICAgICAgICAgICAgICBjbGFzc2VzLCB1bnNw\nZWNpZmllZCk7DQogICAgICAgICAgICBpZiAoZm1kLmdldEtleSgpICE9IG51\nbGwgJiYgZm1kLmdldEtleSgpLmlzVHlwZVBDKCkpDQogICAgICAgICAgICAg\nICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5zcGVjaWZpZWRUeXBlKGZtZC5n\nZXRLZXkoKS5nZXRUeXBlKCksDQogICAgICAgICAgICAgICAgICAgIGNsYXNz\nZXMsIHVuc3BlY2lmaWVkKTsNCiAgICAgICAgICAgIGlmIChmbWQuZ2V0VmFs\ndWUoKSAhPSBudWxsICYmIGZtZC5nZXRWYWx1ZSgpLmlzVHlwZVBDKCkpDQog\nICAgICAgICAgICAgICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5zcGVjaWZp\nZWRUeXBlKGZtZC5nZXRWYWx1ZSgpLmdldFR5cGUoKSwNCiAgICAgICAgICAg\nICAgICAgICAgY2xhc3NlcywgdW5zcGVjaWZpZWQpOw0KICAgICAgICB9DQog\nICAgICAgIHJldHVybiB1bnNwZWNpZmllZDsNCiAgICB9DQoNCiAgICBwcml2\nYXRlIHN0YXRpYyBTZXQ8Q2xhc3M+IGNvbGxlY3RVbnNwZWNpZmllZFR5cGUo\nQ2xhc3MgY2xzLA0KICAgICAgICBDb2xsZWN0aW9uPD8gZXh0ZW5kcyBDbGFz\ncz4gY2xhc3NlcywgU2V0PENsYXNzPiB1bnNwZWNpZmllZCkgew0KICAgICAg\nICBpZiAoY2xzICE9IG51bGwgJiYgIWNsYXNzZXMuY29udGFpbnMoY2xzKQ0K\nICAgICAgICAgICAgJiYgIUltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShudWxs\nLCBjbHMpKSB7DQogICAgICAgICAgICBpZiAodW5zcGVjaWZpZWQgPT0gbnVs\nbCkNCiAgICAgICAgICAgICAgICB1bnNwZWNpZmllZCA9IG5ldyBIYXNoU2V0\nPENsYXNzPigpOw0KICAgICAgICAgICAgdW5zcGVjaWZpZWQuYWRkKGNscyk7\nDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHVuc3BlY2lmaWVkOw0KICAg\nIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgY29uZmlndXJlTWV0YURh\ndGEoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwNCiAgICAgICAgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyLCBDbGFzcyBjbHMsIGJvb2xlYW4gcmVkZWZpbmVB\ndmFpbGFibGUpIHsNCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gY29u\nZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpDQogICAgICAgICAg\nICAuZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIHRydWUpOw0KICAgICAg\nICBjb25maWd1cmVNZXRhRGF0YShtZXRhLCBjb25mLCByZWRlZmluZUF2YWls\nYWJsZSwgdHJ1ZSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgdm9p\nZCBjb25maWd1cmVNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEsDQogICAg\nICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIGJvb2xlYW4gcmVkZWZp\nbmVBdmFpbGFibGUsIGJvb2xlYW4gd2Fybikgew0KDQogICAgICAgIHNldERl\ndGFjaGVkU3RhdGUobWV0YSk7DQoNCiAgICAgICAgaWYgKHdhcm4gJiYgbWV0\nYS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklF\nTEQNCiAgICAgICAgICAgICYmICFyZWRlZmluZUF2YWlsYWJsZSkgew0KICAg\nICAgICAgICAgLy8gb25seSB3YXJuIGFib3V0IGRlY2xhcmVkIGZpZWxkczsg\nc3VwZXJjbGFzcyBmaWVsZHMgd2lsbCBiZQ0KICAgICAgICAgICAgLy8gd2Fy\nbmVkIGFib3V0IHdoZW4gdGhlIHN1cGVyY2xhc3MgaXMgaGFuZGxlZA0KICAg\nICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RGVj\nbGFyZWRGaWVsZHMoKSkgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1k\nLmdldFR5cGVDb2RlKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ09MTEVDVElPTjoNCiAgICAgICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTUFQOg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nd2UgY2FuIGxhemlseSBsb2FkIHRoZXNlLCBzaW5jZSB3ZSBvd24gdGhlDQog\nICAgICAgICAgICAgICAgICAgICAgICAvLyByZWxhdGlvbnNoaXAgY29udGFp\nbmVyDQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAg\nICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmICghZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpDQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgJiYgIShmbWQuaXNWZXJzaW9uKCkgfHwgZm1k\nLmlzUHJpbWFyeUtleSgpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIExvZyBsb2cgPSBjb25mLmdldExvZygNCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFO\nQ0UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9s\nb2MuZ2V0KCJzdWJjbGFzc2VyLWZldGNoLWdyb3VwLW92ZXJyaWRlIiwNCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXREZXNjcmli\nZWRUeXBlKCkuZ2V0TmFtZSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmbWQuZ2V0TmFtZSgpKSk7DQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7DQog\nICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0K\nICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHJpdmF0\nZSBzdGF0aWMgdm9pZCB3cml0ZShCQ0NsYXNzIGJjLCBQQ0VuaGFuY2VyIGVu\naGFuY2VyLA0KICAgICAgICBNYXA8Q2xhc3MsIGJ5dGVbXT4gbWFwLCBDbGFz\ncyBjbHMsIExpc3Qgc3VicywgTGlzdCBpbnRzKQ0KICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gew0KDQogICAgICAgIGlmIChiYyA9PSBlbmhhbmNlci5n\nZXRNYW5hZ2VkVHlwZUJ5dGVjb2RlKCkpIHsNCiAgICAgICAgICAgIC8vIGlm\nIGl0IHdhcyBhbHJlYWR5IGRlZmluZWQsIGRvbid0IHB1dCBpdCBpbiB0aGUg\nbWFwLA0KICAgICAgICAgICAgLy8gYnV0IGRvIHNldCB0aGUgbWV0YWRhdGEg\nYWNjb3JkaW5nbHkuDQogICAgICAgICAgICBpZiAoZW5oYW5jZXIuaXNBbHJl\nYWR5UmVkZWZpbmVkKCkpDQogICAgICAgICAgICAgICAgaW50cy5hZGQoYmMu\nZ2V0VHlwZSgpKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKEphdmFWZXJzaW9u\ncy5WRVJTSU9OID49IDUpIHsNCiAgICAgICAgICAgICAgICBtYXAucHV0KGJj\nLmdldFR5cGUoKSwgYmMudG9CeXRlQXJyYXkoKSk7DQogICAgICAgICAgICAg\nICAgZGVidWdCeXRlY29kZXMoYmMpOw0KICAgICAgICAgICAgfQ0KICAgICAg\nICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKCFlbmhhbmNlci5pc0FscmVh\nZHlTdWJjbGFzc2VkKCkpIHsNCiAgICAgICAgICAgICAgICBkZWJ1Z0J5dGVj\nb2RlcyhiYyk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAg\nLy8gdGhpcyBpcyB0aGUgbmV3IHN1YmNsYXNzDQogICAgICAgICAgICAgICAg\nQ2xhc3NMb2FkZXIgbG9hZGVyID0gR2VuZXJhdGVkQ2xhc3Nlcy5nZXRNb3N0\nRGVyaXZlZExvYWRlcigNCiAgICAgICAgICAgICAgICAgICAgY2xzLCBQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MpOw0KICAgICAgICAgICAgICAgIHN1YnMu\nYWRkKEdlbmVyYXRlZENsYXNzZXMubG9hZEJDQ2xhc3MoYmMsIGxvYWRlcikp\nOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHJp\ndmF0ZSBzdGF0aWMgdm9pZCBkZWJ1Z0J5dGVjb2RlcyhCQ0NsYXNzIGJjKSB0\naHJvd3MgSU9FeGNlcHRpb24gew0KICAgICAgICAvLyBXcml0ZSB0aGUgYnl0\nZWNvZGVzIHRvIGRpc2sgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlcy4NCiAgICAg\nICAgaWYgKCJ0cnVlIi5lcXVhbHMoU3lzdGVtLmdldFByb3BlcnR5KA0KICAg\nICAgICAgICAgTWFuYWdlZENsYXNzU3ViY2xhc3Nlci5jbGFzcy5nZXROYW1l\nKCkgKyAiLmR1bXBCeXRlY29kZXMiKSkpDQogICAgICAgIHsNCiAgICAgICAg\nICAgIEZpbGUgdG1wID0gbmV3IEZpbGUoU3lzdGVtLmdldFByb3BlcnR5KCJq\nYXZhLmlvLnRtcGRpciIpKTsNCiAgICAgICAgICAgIEZpbGUgZGlyID0gbmV3\nIEZpbGUodG1wLCAib3BlbmpwYSIpOw0KICAgICAgICAgICAgZGlyID0gbmV3\nIEZpbGUoZGlyLCAicGNzdWJjbGFzc2VzIik7DQogICAgICAgICAgICBkaXIu\nbWtkaXJzKCk7DQogICAgICAgICAgICBkaXIgPSBGaWxlcy5nZXRQYWNrYWdl\nRmlsZShkaXIsIGJjLmdldFBhY2thZ2VOYW1lKCksIHRydWUpOw0KICAgICAg\nICAgICAgRmlsZSBmID0gbmV3IEZpbGUoZGlyLCBiYy5nZXRDbGFzc05hbWUo\nKSArICIuY2xhc3MiKTsNCiAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRs\nbigiV3JpdGluZyB0byAiICsgZik7DQogICAgICAgICAgICBiYy53cml0ZShm\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIHZv\naWQgc2V0SW50ZXJjZXB0aW5nKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYs\nDQogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlciwgQ2xhc3MgY2xzKSB7\nDQogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGNvbmYuZ2V0TWV0YURh\ndGFSZXBvc2l0b3J5SW5zdGFuY2UoKQ0KICAgICAgICAgICAgLmdldE1ldGFE\nYXRhKGNscywgZW52TG9hZGVyLCB0cnVlKTsNCiAgICAgICAgbWV0YS5zZXRJ\nbnRlcmNlcHRpbmcodHJ1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nSWYgdGhlIG1ldGFkYXRhIGlzIGNvbmZpZ3VyZWQgdG8gdXNlIGEgc3ludGhl\ndGljDQogICAgICogZGV0YWNoZWQgc3RhdGUsIHJlc2V0IGl0IHRvIG5vdCB1\nc2UgYSBkZXRhY2hlZA0KICAgICAqIHN0YXRlIGZpZWxkLCBzaW5jZSB3ZSBj\nYW4ndCBhZGQgZmllbGRzIHdoZW4gcmVkZWZpbmluZy4NCiAgICAgKi8NCiAg\nICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldERldGFjaGVkU3RhdGUoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7DQogICAgICAgIGlmIChDbGFzc01ldGFEYXRhLlNZ\nTlRIRVRJQy5lcXVhbHMobWV0YS5nZXREZXRhY2hlZFN0YXRlKCkpKQ0KICAg\nICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKG51bGwpOw0KICAgIH0N\nCn0NCg==\n","encoding":"base64"}

