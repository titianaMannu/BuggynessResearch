{"sha":"8c189ee45efc67b140616a8e02a0d777eb65bb5f","node_id":"MDQ6QmxvYjIwNjM2NDo4YzE4OWVlNDVlZmM2N2IxNDA2MTZhOGUwMmEwZDc3N2ViNjViYjVm","size":42657,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8c189ee45efc67b140616a8e02a0d777eb65bb5f","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZTsNCg0KaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7DQppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb247DQppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOw0KaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0Ow0KaW1wb3J0IGph\ndmEudXRpbC5NYXA7DQoNCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29u\nZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkFic3RyYWN0UENEYXRhOw0KaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOw0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdl\ncjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDRGF0YTsN\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4\ndDsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsN\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1h\ncDsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0\nYURhdGE7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5\ncGVzOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFs\nRXhjZXB0aW9uOw0KaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFzczsNCmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLkJDRmllbGQ7DQppbXBvcnQgc2VycC5ieXRl\nY29kZS5CQ01ldGhvZDsNCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7DQpp\nbXBvcnQgc2VycC5ieXRlY29kZS5Db25zdGFudHM7DQppbXBvcnQgc2VycC5i\neXRlY29kZS5FeGNlcHRpb25IYW5kbGVyOw0KaW1wb3J0IHNlcnAuYnl0ZWNv\nZGUuSW5zdHJ1Y3Rpb247DQppbXBvcnQgc2VycC5ieXRlY29kZS5KdW1wSW5z\ndHJ1Y3Rpb247DQppbXBvcnQgc2VycC5ieXRlY29kZS5Mb29rdXBTd2l0Y2hJ\nbnN0cnVjdGlvbjsNCg0KLyoqDQogKiBHZW5lcmF0ZXMge0BsaW5rIFBDRGF0\nYX0gaW5zdGFuY2VzIHdoaWNoIGF2b2lkIHByaW1pdHZlIHdyYXBwZXJzDQog\nKiB0byBvcHRpbWl6ZSBtZW1vcnkgdXNlIGFuZCBwZXJmb3JtYW5jZSBhdCB0\naGUgY29zdCBvZiBzbGlnaHRseSBoaWdoZXINCiAqIHN0YXJ0dXAgdGltZS4N\nCiAqDQogKiBAYXV0aG9yIFN0ZXZlIEtpbQ0KICogQG5vamF2YWRvYw0KICog\nQHNpbmNlIDAuMy4yDQogKi8NCnB1YmxpYyBjbGFzcyBQQ0RhdGFHZW5lcmF0\nb3INCiAgICBleHRlbmRzIER5bmFtaWNTdG9yYWdlR2VuZXJhdG9yIHsNCg0K\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9j\nYWxpemVyLmZvclBhY2thZ2UNCiAgICAgICAgKFBDRGF0YUdlbmVyYXRvci5j\nbGFzcyk7DQoNCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIFN0cmluZyBQ\nT1NURklYID0gIiRvcGVuanBhcGNkYXRhIjsNCg0KICAgIHByaXZhdGUgZmlu\nYWwgTWFwIF9nZW5lcmF0ZWQgPSBuZXcgQ29uY3VycmVudEhhc2hNYXAoKTsN\nCiAgICBwcml2YXRlIGZpbmFsIE9wZW5KUEFDb25maWd1cmF0aW9uIF9jb25m\nOw0KICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7DQoNCiAgICBwdWJsaWMg\nUENEYXRhR2VuZXJhdG9yKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYpIHsN\nCiAgICAgICAgX2NvbmYgPSBjb25mOw0KICAgICAgICBfbG9nID0gX2NvbmYu\nZ2V0TG9nRmFjdG9yeSgpLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5M\nT0dfRU5IQU5DRSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJu\nIHRoZSBjb25maWd1cmF0aW9uLg0KICAgICAqLw0KICAgIHB1YmxpYyBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgew0KICAgICAg\nICByZXR1cm4gX2NvbmY7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0\ndXJuIGEge0BsaW5rIFBDRGF0YX0gaW5zdGFuY2UgZm9yIHRoZSBnaXZlbiBv\naWQgYW5kIG1ldGFkYXRhLg0KICAgICAqLw0KICAgIHB1YmxpYyBQQ0RhdGEg\nZ2VuZXJhdGVQQ0RhdGEoT2JqZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7DQogICAgICAgIGlmIChtZXRhID09IG51bGwpDQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsNCiAgICAgICAgQ2xhc3MgdHlwZSA9IG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpOw0KICAgICAgICBEeW5hbWljU3RvcmFnZSBzdG9yYWdl\nID0gKER5bmFtaWNTdG9yYWdlKSBfZ2VuZXJhdGVkLmdldCh0eXBlKTsNCiAg\nICAgICAgaWYgKHN0b3JhZ2UgPT0gbnVsbCkgew0KICAgICAgICAgICAgc3Rv\ncmFnZSA9IGdlbmVyYXRlU3RvcmFnZShtZXRhKTsNCiAgICAgICAgICAgIF9n\nZW5lcmF0ZWQucHV0KHR5cGUsIHN0b3JhZ2UpOw0KICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAgICAgICBfbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJwY2RhdGEtY3JlYXRlZCIsIHR5cGUuZ2V0TmFt\nZSgpLCBtZXRhKSk7DQogICAgICAgIH0NCiAgICAgICAgRHluYW1pY1BDRGF0\nYSBkYXRhID0gKER5bmFtaWNQQ0RhdGEpIHN0b3JhZ2UubmV3SW5zdGFuY2Uo\nKTsNCiAgICAgICAgZGF0YS5zZXRJZChvaWQpOw0KICAgICAgICBkYXRhLnNl\ndFN0b3JhZ2VHZW5lcmF0b3IodGhpcyk7DQogICAgICAgIGZpbmlzaChkYXRh\nLCBtZXRhKTsNCiAgICAgICAgcmV0dXJuIGRhdGE7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogQWN0dWFsbHkgZ2VuZXJhdGUgdGhlIGZhY3RvcnkgaW5z\ndGFuY2UuDQogICAgICovDQogICAgcHJpdmF0ZSBEeW5hbWljU3RvcmFnZSBn\nZW5lcmF0ZVN0b3JhZ2UoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7DQogICAgICAg\nIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpDQogICAgICAgICAgICBfbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJwY2RhdGEtZ2VuZXJhdGUiLCBtZXRhKSk7DQoN\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEuZ2V0Rmll\nbGRzKCk7DQogICAgICAgIGludFtdIHR5cGVzID0gbmV3IGludFtmaWVsZHMu\nbGVuZ3RoXTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0eXBlcy5s\nZW5ndGg7IGkrKykNCiAgICAgICAgICAgIHR5cGVzW2ldID0gcmVwbGFjZVR5\ncGUoZmllbGRzW2ldKTsNCiAgICAgICAgcmV0dXJuIGdlbmVyYXRlU3RvcmFn\nZSh0eXBlcywgbWV0YSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUGVy\nZm9ybSBhbnkgZmluYWwgYWN0aW9ucyBiZWZvcmUgdGhlIHBjZGF0YSBpcyBy\nZXR1cm5lZCB0byBjbGllbnQgY29kZS4NCiAgICAgKi8NCiAgICBwcm90ZWN0\nZWQgdm9pZCBmaW5pc2goRHluYW1pY1BDRGF0YSBkYXRhLCBDbGFzc01ldGFE\nYXRhIG1ldGEpIHsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgaW50IGdldENy\nZWF0ZUZpZWxkTWV0aG9kcyhpbnQgdHlwZUNvZGUpIHsNCiAgICAgICAgaWYg\nKHR5cGVDb2RlID49IEphdmFUeXBlcy5PQkpFQ1QpDQogICAgICAgICAgICBy\nZXR1cm4gUE9MSUNZX1NJTEVOVDsNCiAgICAgICAgLy8gZG9uJ3QgYm90aGVy\nIGNyZWF0aW5nIHNldC9nZXQ8UHJpbWl0aXZlPiBtZXRob2RzDQogICAgICAg\nIHJldHVybiBQT0xJQ1lfRU1QVFk7DQogICAgfQ0KDQogICAgcHJvdGVjdGVk\nIHZvaWQgZGVjbGFyZUNsYXNzZXMoQkNDbGFzcyBiYykgew0KICAgICAgICBz\ndXBlci5kZWNsYXJlQ2xhc3NlcyhiYyk7DQogICAgICAgIGJjLmRlY2xhcmVJ\nbnRlcmZhY2UoRHluYW1pY1BDRGF0YS5jbGFzcyk7DQogICAgICAgIGJjLnNl\ndFN1cGVyY2xhc3MoQWJzdHJhY3RQQ0RhdGEuY2xhc3MpOw0KICAgIH0NCg0K\nICAgIHByb3RlY3RlZCBmaW5hbCBTdHJpbmcgZ2V0Q2xhc3NOYW1lKE9iamVj\ndCBvYmopIHsNCiAgICAgICAgcmV0dXJuIGdldFVuaXF1ZU5hbWUoKChDbGFz\nc01ldGFEYXRhKSBvYmopLmdldERlc2NyaWJlZFR5cGUoKSk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBhIHVuaXF1ZSBuYW1lIGZvciB0\naGUgZ2l2ZW4gdHlwZSdzIHBjZGF0YSBpbXBsZW1lbnRhdGlvbi4NCiAgICAg\nKi8NCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFVuaXF1ZU5hbWUoQ2xhc3Mg\ndHlwZSkgew0KICAgICAgICByZXR1cm4gdHlwZS5nZXROYW1lKCkgKyAiJCIg\nKyBTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0eXBlKSArIFBPU1RGSVg7DQog\nICAgfQ0KDQogICAgcHJvdGVjdGVkIGZpbmFsIHZvaWQgZGVjb3JhdGUoT2Jq\nZWN0IG9iaiwgQkNDbGFzcyBiYywgaW50W10gdHlwZXMpIHsNCiAgICAgICAg\nc3VwZXIuZGVjb3JhdGUob2JqLCBiYywgdHlwZXMpOw0KICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgb2JqOw0KDQogICAg\nICAgIGVuaGFuY2VDb25zdHJ1Y3RvcihiYyk7DQogICAgICAgIGFkZEJhc2VG\naWVsZHMoYmMpOw0KICAgICAgICBhZGRJbXBsRGF0YU1ldGhvZHMoYmMsIG1l\ndGEpOw0KICAgICAgICBhZGRGaWVsZEltcGxEYXRhTWV0aG9kcyhiYywgbWV0\nYSk7DQogICAgICAgIGFkZFZlcnNpb25NZXRob2RzKGJjKTsNCiAgICAgICAg\nYWRkR2V0VHlwZShiYywgbWV0YSk7DQogICAgICAgIGFkZExvYWRNZXRob2Qo\nYmMsIG1ldGEpOw0KICAgICAgICBhZGRMb2FkV2l0aEZpZWxkc01ldGhvZChi\nYywgbWV0YSk7DQogICAgICAgIGFkZFN0b3JlTWV0aG9kcyhiYywgbWV0YSk7\nDQogICAgICAgIGFkZE5ld0VtYmVkZGVkKGJjKTsNCiAgICAgICAgYWRkR2V0\nRGF0YShiYyk7DQogICAgICAgIGRlY29yYXRlKGJjLCBtZXRhKTsNCiAgICB9\nDQoNCiAgICAvKioNCiAgICAgKiBBcHBseSBhZGRpdGlvbmFsIGRlY29yYXRp\nb24gdG8gZ2VuZXJhdGVkIGNsYXNzLg0KICAgICAqLw0KICAgIHByb3RlY3Rl\nZCB2b2lkIGRlY29yYXRlKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEgbWV0\nYSkgew0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuaGFuY2UgY29uc3Ry\ndWN0b3IgdG8gaW5pdGlhbGl6ZSBmaWVsZHMNCiAgICAgKi8NCiAgICBwcml2\nYXRlIHZvaWQgZW5oYW5jZUNvbnN0cnVjdG9yKEJDQ2xhc3MgYmMpIHsNCiAg\nICAgICAgQkNNZXRob2QgY29ucyA9IGJjLmdldERlY2xhcmVkTWV0aG9kKCI8\naW5pdD4iLCAoU3RyaW5nW10pIG51bGwpOw0KICAgICAgICBDb2RlIGNvZGUg\nPSBjb25zLmdldENvZGUoZmFsc2UpOw0KICAgICAgICBjb2RlLmFmdGVyTGFz\ndCgpOw0KICAgICAgICBjb2RlLnByZXZpb3VzKCk7DQoNCiAgICAgICAgLy8g\ncHJpdmF0ZSBCaXRTZXQgbG9hZGVkID0gbmV3IEJpdFNldCgpOw0KICAgICAg\nICBCQ0ZpZWxkIGxvYWRlZCA9IGFkZEJlYW5GaWVsZChiYywgImxvYWRlZCIs\nIEJpdFNldC5jbGFzcyk7DQogICAgICAgIGxvYWRlZC5zZXRGaW5hbCh0cnVl\nKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsNCiAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShCaXRTZXQuY2xhc3MpOw0KICAgICAgICBj\nb2RlLmR1cCgpOw0KICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nYmMuZ2V0RmllbGRzKCkubGVuZ3RoKTsNCiAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKEJpdFNldC5jbGFzcywgIjxpbml0PiIsIHZv\naWQuY2xhc3MsDQogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNz\nIH0pOw0KICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQobG9hZGVk\nKTsNCg0KICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7DQogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogSGF2ZSB0byBsb2FkIHRoZSB0eXBlIHNpbmNlIGl0IG1h\neSBub3QgYmUgYXZhaWxhYmxlIHRvIHRoZQ0KICAgICAqIHNhbWUgY2xhc3Ns\nb2FkZXIgKGkuZS4gcmFyIHZzLiBlYXIpLiBUaGUgY29udGV4dCBjbGFzc2xv\nYWRlcg0KICAgICAqIChpLmUuIHRoZSB1c2VyIGFwcCBjbGFzc2xvYWRlcikg\nc2hvdWxkIGJlIGZpbmUuDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGFk\nZEdldFR5cGUoQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7DQog\nICAgICAgIEJDRmllbGQgdHlwZSA9IGJjLmRlY2xhcmVGaWVsZCgidHlwZSIs\nIENsYXNzLmNsYXNzKTsNCiAgICAgICAgdHlwZS5zZXRTdGF0aWModHJ1ZSk7\nDQogICAgICAgIHR5cGUubWFrZVByaXZhdGUoKTsNCiAgICAgICAgLy8gcHVi\nbGljIENsYXNzIGdldFR5cGUoKSB7DQogICAgICAgIEJDTWV0aG9kIGdldHRl\nciA9IGJjLmRlY2xhcmVNZXRob2QoImdldFR5cGUiLCBDbGFzcy5jbGFzcywg\nbnVsbCk7DQogICAgICAgIGdldHRlci5tYWtlUHVibGljKCk7DQogICAgICAg\nIENvZGUgY29kZSA9IGdldHRlci5nZXRDb2RlKHRydWUpOw0KICAgICAgICAv\nLyBpZiAodHlwZSA9PSBudWxsKSB7DQogICAgICAgIC8vIAkJdHJ5IHsNCiAg\nICAgICAgLy8gCQkJdHlwZSA9IENsYXNzLmZvck5hbWUNCiAgICAgICAgLy8g\nCQkJCShtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCksIHRydWUs\nDQogICAgICAgIC8vIAkJCQlUaHJlYWQuY3VycmVudFRocmVhZCgpLmdldENv\nbnRleHRDbGFzc0xvYWRlcigpKTsNCiAgICAgICAgLy8gCQl9IGNhdGNoIChD\nbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsNCiAgICAgICAgLy8gCQkJ\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7DQogICAgICAgIC8vIAkJ\nfQ0KICAgICAgICAvLyB9DQogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQodHlwZSk7DQoNCiAgICAgICAgQ29sbGVjdGlvbiBqdW1wcyA9IG5l\ndyBMaW5rZWRMaXN0KCk7DQogICAgICAgIGp1bXBzLmFkZChjb2RlLmlmbm9u\nbnVsbCgpKTsNCiAgICAgICAgRXhjZXB0aW9uSGFuZGxlciBoYW5kbGVyID0g\nY29kZS5hZGRFeGNlcHRpb25IYW5kbGVyKCk7DQoNCiAgICAgICAgaGFuZGxl\nci5zZXRUcnlTdGFydChjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUNCiAgICAg\nICAgICAgIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpKTsN\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOw0KICAg\nICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChUaHJlYWQuY2xh\nc3MsICJjdXJyZW50VGhyZWFkIiwNCiAgICAgICAgICAgIFRocmVhZC5jbGFz\ncywgbnVsbCk7DQogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChUaHJlYWQuY2xhc3MsICJnZXRDb250ZXh0Q2xhc3NMb2FkZXIiLA0K\nICAgICAgICAgICAgQ2xhc3NMb2FkZXIuY2xhc3MsIG51bGwpOw0KICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChDbGFzcy5jbGFzcywg\nImZvck5hbWUiLCBDbGFzcy5jbGFzcywNCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MsIENsYXNzTG9hZGVy\nLmNsYXNzIH0pOw0KICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxk\nKHR5cGUpOw0KICAgICAgICBJbnN0cnVjdGlvbiBnbzIgPSBjb2RlLmdvMigp\nOw0KICAgICAgICBqdW1wcy5hZGQoZ28yKTsNCiAgICAgICAgaGFuZGxlci5z\nZXRUcnlFbmQoZ28yKTsNCiAgICAgICAgaGFuZGxlci5zZXRDYXRjaChDbGFz\nc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsNCiAgICAgICAgaGFuZGxlci5z\nZXRIYW5kbGVyU3RhcnQodGhyb3dFeGNlcHRpb24NCiAgICAgICAgICAgIChj\nb2RlLCBJbnRlcm5hbEV4Y2VwdGlvbi5jbGFzcykpOw0KICAgICAgICBzZXRU\nYXJnZXQoY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZCh0eXBlKSwganVtcHMp\nOw0KICAgICAgICBjb2RlLmFyZXR1cm4oKTsNCg0KICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRGVjbGFyZSBz\ndGFuZGFyZCBkeW5hbWljIHBjZGF0YSBmaWVsZHMuDQogICAgICovDQogICAg\ncHJpdmF0ZSB2b2lkIGFkZEJhc2VGaWVsZHMoQkNDbGFzcyBiYykgew0KICAg\nICAgICBhZGRCZWFuRmllbGQoYmMsICJpZCIsIE9iamVjdC5jbGFzcyk7DQog\nICAgICAgIEJDRmllbGQgZmllbGQgPSBhZGRCZWFuRmllbGQoYmMsICJzdG9y\nYWdlR2VuZXJhdG9yIiwNCiAgICAgICAgICAgIFBDRGF0YUdlbmVyYXRvci5j\nbGFzcyk7DQogICAgICAgIGZpZWxkLnNldEFjY2Vzc0ZsYWdzKGZpZWxkLmdl\ndEFjY2Vzc0ZsYWdzKCkNCiAgICAgICAgICAgIHwgQ29uc3RhbnRzLkFDQ0VT\nU19UUkFOU0lFTlQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFkZCBt\nZXRob2RzIGZvciBsb2FkaW5nIGFuZCBzdG9yaW5nIGNsYXNzLWxldmVsIGlt\ncGwgZGF0YS4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQgYWRkSW1wbERh\ndGFNZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEgbWV0YSkgew0K\nICAgICAgICAvLyB2b2lkIHN0b3JlSW1wbERhdGEoT3BlbkpQQVN0YXRlTWFu\nYWdlcik7DQogICAgICAgIEJDTWV0aG9kIG1ldGggPSBiYy5kZWNsYXJlTWV0\naG9kKCJzdG9yZUltcGxEYXRhIiwgdm9pZC5jbGFzcywNCiAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBPcGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzIH0pOw0K\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7DQoNCiAg\nICAgICAgQkNGaWVsZCBpbXBsID0gbnVsbDsNCiAgICAgICAgaWYgKCF1c2Vz\nSW1wbERhdGEobWV0YSkpDQogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsN\nCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBpZiAoc20uaXNJbXBs\nRGF0YUNhY2hlYWJsZSgpKQ0KICAgICAgICAgICAgLy8gCQlzZXRJbXBsRGF0\nYShzbS5nZXRJbXBsRGF0YSgpKTsNCiAgICAgICAgICAgIGltcGwgPSBhZGRC\nZWFuRmllbGQoYmMsICJpbXBsRGF0YSIsIE9iamVjdC5jbGFzcyk7DQogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyLmNsYXNzLA0KICAgICAgICAgICAgICAgICJpc0ltcGxEYXRh\nQ2FjaGVhYmxlIiwgYm9vbGVhbi5jbGFzcywgbnVsbCk7DQogICAgICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmZXEoKTsNCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nLmNsYXNzLA0KICAgICAgICAgICAgICAgICJnZXRJbXBsRGF0YSIsIE9iamVj\ndC5jbGFzcywgbnVsbCk7DQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoInNldEltcGxEYXRhIiwgdm9pZC5jbGFzcywNCiAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOw0K\nICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUudnJldHVybigpKTsN\nCiAgICAgICAgfQ0KICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nDQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7DQoNCiAgICAg\nICAgLy8gdm9pZCBsb2FkSW1wbERhdGEoT3BlbkpQQVN0YXRlTWFuYWdlcik7\nDQogICAgICAgIG1ldGggPSBiYy5kZWNsYXJlTWV0aG9kKCJsb2FkSW1wbERh\ndGEiLCB2b2lkLmNsYXNzLA0KICAgICAgICAgICAgbmV3IENsYXNzW117IE9w\nZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MgfSk7DQogICAgICAgIGNvZGUgPSBt\nZXRoLmdldENvZGUodHJ1ZSk7DQogICAgICAgIGlmICghdXNlc0ltcGxEYXRh\nKG1ldGEpKQ0KICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7DQogICAgICAg\nIGVsc2Ugew0KICAgICAgICAgICAgLy8gaWYgKHNtLmdldEltcGxEYXRhKCkg\nPT0gbnVsbCAmJiBpbXBsRGF0YSAhPSBudWxsKQ0KICAgICAgICAgICAgLy8g\nCQlzbS5zZXRJbXBsRGF0YShpbXBsLCB0cnVlKTsNCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFTdGF0ZU1hbmFnZXIu\nY2xhc3MsDQogICAgICAgICAgICAgICAgImdldEltcGxEYXRhIiwgT2JqZWN0\nLmNsYXNzLCBudWxsKTsNCiAgICAgICAgICAgIEp1bXBJbnN0cnVjdGlvbiBp\nZmlucyA9IGNvZGUuaWZub25udWxsKCk7DQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKGltcGwpOw0KICAgICAgICAgICAgSnVtcEluc3RydWN0aW9u\nIGlmaW5zMiA9IGNvZGUuaWZudWxsKCk7DQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOw0KICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKGltcGwpOw0KICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKHRydWUpOw0KICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywNCiAgICAg\nICAgICAgICAgICAic2V0SW1wbERhdGEiLCB2b2lkLmNsYXNzLA0KICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MsIGJvb2xlYW4u\nY2xhc3MgfSk7DQogICAgICAgICAgICBJbnN0cnVjdGlvbiBpbnMgPSBjb2Rl\nLnZyZXR1cm4oKTsNCiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChpbnMp\nOw0KICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdldChpbnMpOw0KICAgICAg\nICB9DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCiAgICB9DQoNCiAgICAv\nKioNCiAgICAgKiBBZGQgbWV0aG9kcyBmb3IgbG9hZGluZyBhbmQgc3Rvcmlu\nZyBjbGFzcy1sZXZlbCBpbXBsIGRhdGEuDQogICAgICovDQogICAgcHJpdmF0\nZSB2b2lkIGFkZEZpZWxkSW1wbERhdGFNZXRob2RzKEJDQ2xhc3MgYmMsIENs\nYXNzTWV0YURhdGEgbWV0YSkgew0KICAgICAgICAvLyBwdWJsaWMgdm9pZCBs\nb2FkSW1wbERhdGEoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50IGkpDQog\nICAgICAgIEJDTWV0aG9kIG1ldGggPSBiYy5kZWNsYXJlTWV0aG9kKCJsb2Fk\nSW1wbERhdGEiLCB2b2lkLmNsYXNzLA0KICAgICAgICAgICAgbmV3IENsYXNz\nW117IE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsIGludC5jbGFzcyB9KTsN\nCiAgICAgICAgbWV0aC5tYWtlUHJpdmF0ZSgpOw0KICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7DQoNCiAgICAgICAgaW50IGNvdW50\nID0gY291bnRJbXBsRGF0YUZpZWxkcyhtZXRhKTsNCiAgICAgICAgQkNGaWVs\nZCBpbXBsID0gbnVsbDsNCiAgICAgICAgaWYgKGNvdW50ID09IDApDQogICAg\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsNCiAgICAgICAgZWxzZSB7DQogICAg\nICAgICAgICAvLyBPYmplY3RbXSBmaWVsZEltcGwNCiAgICAgICAgICAgIGlt\ncGwgPSBiYy5kZWNsYXJlRmllbGQoImZpZWxkSW1wbCIsIE9iamVjdFtdLmNs\nYXNzKTsNCiAgICAgICAgICAgIGltcGwubWFrZVByaXZhdGUoKTsNCg0KICAg\nICAgICAgICAgLy8gaWYgKGZpZWxkSW1wbCAhPSBudWxsKQ0KICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsNCiAgICAgICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZChpbXBsKTsNCiAgICAgICAgICAgIEp1bXBJ\nbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7DQogICAgICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsNCg0KICAgICAgICAgICAgLy8gT2JqZWN0\nIG9iaiA9IG51bGw7DQogICAgICAgICAgICBpbnQgb2JqID0gY29kZS5nZXRO\nZXh0TG9jYWxzSW5kZXgoKTsNCiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdl\ndChjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpKTsNCiAgICAgICAgICAgIGNv\nZGUuYXN0b3JlKCkuc2V0TG9jYWwob2JqKTsNCg0KICAgICAgICAgICAgLy8g\nZXN0YWJsaXNoIHN3aXRjaCB0YXJnZXQsIHRoZW4gbW92ZSBiZWZvcmUgaXQN\nCiAgICAgICAgICAgIEluc3RydWN0aW9uIHRhcmdldCA9IGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvYmopOw0KICAgICAgICAgICAgY29kZS5wcmV2aW91cygp\nOw0KDQogICAgICAgICAgICAvLyBzd2l0Y2goaSkNCiAgICAgICAgICAgIGNv\nZGUuaWxvYWQoKS5zZXRQYXJhbSgxKTsNCiAgICAgICAgICAgIExvb2t1cFN3\naXRjaEluc3RydWN0aW9uIGxzd2l0Y2ggPSBjb2RlLmxvb2t1cHN3aXRjaCgp\nOw0KICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEu\nZ2V0RmllbGRzKCk7DQogICAgICAgICAgICBpbnQgY2FjaGVhYmxlID0gMDsN\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0\naDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKCF1c2VzSW1wbERhdGEo\nZmllbGRzW2ldKSkNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQog\nICAgICAgICAgICAgICAgLy8gY2FzZSB4OiBvYmogPSBmaWVsZEltcGxbeV07\nIGJyZWFrOw0KICAgICAgICAgICAgICAgIGxzd2l0Y2guYWRkQ2FzZShpLCBj\nb2RlLmFsb2FkKCkuc2V0VGhpcygpKTsNCiAgICAgICAgICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoaW1wbCk7DQogICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGNhY2hlYWJsZSsrKTsNCiAgICAg\nICAgICAgICAgICBjb2RlLmFhbG9hZCgpOw0KICAgICAgICAgICAgICAgIGNv\nZGUuYXN0b3JlKCkuc2V0TG9jYWwob2JqKTsNCiAgICAgICAgICAgICAgICBj\nb2RlLmdvMigpLnNldFRhcmdldCh0YXJnZXQpOw0KICAgICAgICAgICAgfQ0K\nICAgICAgICAgICAgbHN3aXRjaC5zZXREZWZhdWx0VGFyZ2V0KHRhcmdldCk7\nDQoNCiAgICAgICAgICAgIC8vIGlmIChvYmogIT0gbnVsbCkNCiAgICAgICAg\nICAgIGNvZGUubmV4dCgpOyAgICAvLyBqdW1wIGJhY2sgb3ZlciB0YXJnZXQN\nCiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsNCiAgICAg\nICAgICAgIGNvZGUudnJldHVybigpOw0KDQogICAgICAgICAgICAvLyBzbS5z\nZXRJbXBsRGF0YShpbmRleCwgaW1wbCk7DQogICAgICAgICAgICBpZmlucy5z\nZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldFBhcmFtKDApKTsNCiAgICAgICAg\nICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgxKTsNCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChvYmopOw0KICAgICAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdl\nci5jbGFzcywNCiAgICAgICAgICAgICAgICAic2V0SW1wbERhdGEiLCB2b2lk\nLmNsYXNzLA0KICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xh\nc3MsIE9iamVjdC5jbGFzcyB9KTsNCiAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOw0KICAgICAgICB9DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsNCg0K\nICAgICAgICAvLyB2b2lkIHN0b3JlSW1wbERhdGEoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgaW50IGluZGV4LCBib29sZWFuIGxvYWRlZCkNCiAgICAgICAg\nbWV0aCA9IGJjLmRlY2xhcmVNZXRob2QoInN0b3JlSW1wbERhdGEiLCB2b2lk\nLmNsYXNzLA0KICAgICAgICAgICAgbmV3IENsYXNzW117IE9wZW5KUEFTdGF0\nZU1hbmFnZXIuY2xhc3MsIGludC5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsN\nCiAgICAgICAgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsNCiAgICAgICAg\naWYgKGNvdW50ID09IDApDQogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsN\nCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBpbnQgYXJySWR4ID0g\nLTE7DQogICAgICAgICAgICAvLyBzd2l0Y2goaW5kZXgpDQogICAgICAgICAg\nICBpbnQgYXJySWR4ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsNCiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgtMSk7DQogICAg\nICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGFycklkeCk7DQogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMSk7DQogICAgICAgICAg\nICBMb29rdXBTd2l0Y2hJbnN0cnVjdGlvbiBsc3dpdGNoID0gY29kZS5sb29r\ndXBzd2l0Y2goKTsNCg0KICAgICAgICAgICAgLy8gZXN0YWJsaXNoIHN3aXRj\naCB0YXJnZXQsIHRoZW4gbW92ZSBiZWZvcmUgaXQNCiAgICAgICAgICAgIElu\nc3RydWN0aW9uIHN3aXRjaFRhcmdldCA9IGNvZGUuaWxvYWQoKS5zZXRMb2Nh\nbChhcnJJZHgpOw0KICAgICAgICAgICAgY29kZS5wcmV2aW91cygpOw0KDQog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gbWV0YS5nZXRG\naWVsZHMoKTsNCiAgICAgICAgICAgIGludCBjYWNoZWFibGUgPSAwOw0KICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBp\nKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoIXVzZXNJbXBsRGF0YShmaWVs\nZHNbaV0pKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAg\nICAgICAgICAgICAvLyBjYXNlIHg6IGFycklkeCA9IHk7IGJyZWFrOw0KICAg\nICAgICAgICAgICAgIGxzd2l0Y2guYWRkQ2FzZShpLCBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoY2FjaGVhYmxlKyspKTsNCiAgICAgICAgICAgICAgICBj\nb2RlLmlzdG9yZSgpLnNldExvY2FsKGFycklkeCk7DQogICAgICAgICAgICAg\nICAgY29kZS5nbzIoKS5zZXRUYXJnZXQoc3dpdGNoVGFyZ2V0KTsNCiAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgIGxzd2l0Y2guc2V0RGVmYXVsdFRhcmdl\ndChzd2l0Y2hUYXJnZXQpOw0KICAgICAgICAgICAgY29kZS5uZXh0KCk7ICAg\nIC8vIHN0ZXAgb3ZlciBzd2l0Y2ggdGFyZ2V0DQoNCiAgICAgICAgICAgIC8v\nIGlmIChhcnJJZHggIT0gLTEpDQogICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoLTEpOw0KICAgICAgICAgICAgSnVtcEluc3RydWN0aW9u\nIGlmaW5zID0gY29kZS5pZmljbXBuZSgpOw0KICAgICAgICAgICAgY29kZS52\ncmV0dXJuKCk7DQoNCiAgICAgICAgICAgIC8vIGNyZWF0ZSBudWxsIHRhcmdl\ndCwgdGhlbiBtb3ZlIGJlZm9yZSBpdA0KICAgICAgICAgICAgSW5zdHJ1Y3Rp\nb24gbnVsbFRhcmdldCA9IGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAg\nICAgICAgICBjb2RlLnByZXZpb3VzKCk7DQoNCiAgICAgICAgICAgIC8vIGlm\nIChsb2FkZWQpDQogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5p\nbG9hZCgpLnNldFBhcmFtKDIpKTsNCiAgICAgICAgICAgIGNvZGUuaWZlcSgp\nLnNldFRhcmdldChudWxsVGFyZ2V0KTsNCg0KICAgICAgICAgICAgLy8gT2Jq\nZWN0IG9iaiA9IHNtLmdldEltcGxEYXRhKGluZGV4KQ0KICAgICAgICAgICAg\naW50IG9iaiA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7DQogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAgICBj\nb2RlLmlsb2FkKCkuc2V0UGFyYW0oMSk7DQogICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nLmNsYXNzLA0KICAgICAgICAgICAgICAgICJnZXRJbXBsRGF0YSIsIE9iamVj\ndC5jbGFzcywgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsNCiAgICAgICAg\nICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwob2JqKTsNCg0KICAgICAgICAg\nICAgLy8gaWYgKG9iaiAhPSBudWxsKQ0KICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKG9iaik7DQogICAgICAgICAgICBjb2RlLmlmbnVsbCgp\nLnNldFRhcmdldChudWxsVGFyZ2V0KTsNCg0KICAgICAgICAgICAgLy8gaWYg\nKGZpZWxkSW1wbCA9PSBudWxsKQ0KICAgICAgICAgICAgLy8gCQlmaWVsZElt\ncGwgPSBuZXcgT2JqZWN0W2ZpZWxkc107DQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKGltcGwpOw0KICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlm\nbm9ubnVsbCgpOw0KICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMo\nKTsNCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShjb3Vu\ndCk7DQogICAgICAgICAgICBjb2RlLmFuZXdhcnJheSgpLnNldFR5cGUoT2Jq\nZWN0LmNsYXNzKTsNCiAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRG\naWVsZChpbXBsKTsNCg0KICAgICAgICAgICAgLy8gZmllbGRJbXBsW2Fycklk\neF0gPSBvYmo7DQogICAgICAgICAgICAvLyByZXR1cm47DQogICAgICAgICAg\nICBpZmlucy5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldFRoaXMoKSk7DQog\nICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoaW1wbCk7DQog\nICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoYXJySWR4KTsNCiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvYmopOw0KICAgICAg\nICAgICAgY29kZS5hYXN0b3JlKCk7DQogICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsNCg0KICAgICAgICAgICAgLy8gaWYgKGZpZWxkSW1wbCAhPSBudWxs\nKQ0KICAgICAgICAgICAgLy8gCQlmaWVsZEltcGxbaW5kZXhdID0gbnVsbDsN\nCiAgICAgICAgICAgIGNvZGUubmV4dCgpOyAvLyBzdGVwIG92ZXIgbnVsbFRh\ncmdldA0KICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGlt\ncGwpOw0KICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOw0K\nICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7DQogICAgICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldFRoaXMoKSk7DQogICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoaW1wbCk7DQogICAgICAg\nICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoYXJySWR4KTsNCiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7DQogICAgICAgICAgICBj\nb2RlLmFhc3RvcmUoKTsNCiAgICAgICAgICAgIGNvZGUudnJldHVybigpOw0K\nICAgICAgICB9DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsN\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBBZGQgbWV0aG9kcyBmb3IgbG9hZGluZyBhbmQg\nc3RvcmluZyB2ZXJzaW9uIGRhdGEuDQogICAgICovDQogICAgcHJvdGVjdGVk\nIHZvaWQgYWRkVmVyc2lvbk1ldGhvZHMoQkNDbGFzcyBiYykgew0KICAgICAg\nICAvLyB2b2lkIHN0b3JlVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nKTsNCiAgICAgICAgYWRkQmVhbkZpZWxkKGJjLCAidmVyc2lvbiIsIE9iamVj\ndC5jbGFzcyk7DQogICAgICAgIEJDTWV0aG9kIG1ldGggPSBiYy5kZWNsYXJl\nTWV0aG9kKCJzdG9yZVZlcnNpb24iLCB2b2lkLmNsYXNzLA0KICAgICAgICAg\nICAgbmV3IENsYXNzW117IE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MgfSk7\nDQogICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsNCg0K\nICAgICAgICAvLyB2ZXJzaW9uID0gc20uZ2V0VmVyc2lvbigpOw0KICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7DQogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkNCiAgICAgICAgICAgIC5zZXRNZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdl\nci5jbGFzcywgImdldFZlcnNpb24iLA0KICAgICAgICAgICAgICAgIE9iamVj\ndC5jbGFzcywgbnVsbCk7DQogICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRG\naWVsZCgidmVyc2lvbiIsIE9iamVjdC5jbGFzcyk7DQogICAgICAgIGNvZGUu\ndnJldHVybigpOw0KICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nDQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7DQoNCiAgICAg\nICAgLy8gdm9pZCBsb2FkVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nKQ0KICAgICAgICBtZXRoID0gYmMuZGVjbGFyZU1ldGhvZCgibG9hZFZlcnNp\nb24iLCB2b2lkLmNsYXNzLA0KICAgICAgICAgICAgbmV3IENsYXNzW117IE9w\nZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MgfSk7DQogICAgICAgIGNvZGUgPSBt\nZXRoLmdldENvZGUodHJ1ZSk7DQoNCiAgICAgICAgLy8gaWYgKHNtLmdldFZl\ncnNpb24oKSA9PSBudWxsKQ0KICAgICAgICAvLyAJCXNtLnNldFZlcnNpb24o\ndmVyc2lvbik7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsN\nCiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT3Bl\nbkpQQVN0YXRlTWFuYWdlci5jbGFzcywNCiAgICAgICAgICAgICJnZXRWZXJz\naW9uIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsNCiAgICAgICAgSnVtcEluc3Ry\ndWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsNCiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOw0KICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nInZlcnNpb24iLCBPYmplY3QuY2xhc3MpOw0KICAgICAgICBjb2RlLmludm9r\nZWludGVyZmFjZSgpDQogICAgICAgICAgICAuc2V0TWV0aG9kKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIuY2xhc3MsICJzZXRWZXJzaW9uIiwNCiAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0p\nOw0KICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS52cmV0dXJuKCkpOw0K\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7DQogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7DQogICAgfQ0KDQogICAgcHJpdmF0\nZSB2b2lkIGFkZExvYWRNZXRob2QoQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7DQogICAgICAgIC8vIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLA0K\nICAgICAgICAvLyAJCU9iamVjdCBjb250ZXh0KQ0KICAgICAgICBDb2RlIGNv\nZGUgPSBhZGRMb2FkTWV0aG9kKGJjLCBmYWxzZSk7DQogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gbWV0YS5nZXRGaWVsZHMoKTsNCiAgICAgICAg\nQ29sbGVjdGlvbiBqdW1wcyA9IG5ldyBMaW5rZWRMaXN0KCk7DQogICAgICAg\nIENvbGxlY3Rpb24ganVtcHMyOw0KCQkNCiAgICAgICAgaW50IGxvY2FsID0g\nY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsNCiAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldE51bGwoKTsNCiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRM\nb2NhbChsb2NhbCk7DQogICAgICAgIGludCBpbnRlciA9IGNvZGUuZ2V0TmV4\ndExvY2Fsc0luZGV4KCk7DQogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRO\ndWxsKCk7DQogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaW50ZXIp\nOw0KDQogICAgICAgIGludCBvYmplY3RDb3VudCA9IDA7DQogICAgICAgIGJv\nb2xlYW4gaW50ZXJtZWRpYXRlOw0KICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGp1bXBzMiA9\nIG5ldyBMaW5rZWRMaXN0KCk7DQogICAgICAgICAgICBpbnRlcm1lZGlhdGUg\nPSB1c2VzSW50ZXJtZWRpYXRlKGZtZHNbaV0pOw0KICAgICAgICAgICAgc2V0\nVGFyZ2V0KGNvZGUuYWxvYWQoKS5zZXRUaGlzKCksIGp1bXBzKTsNCiAgICAg\nICAgICAgIC8vIGlmIChsb2FkZWQuZ2V0KGkpKSBvciAoIWxvYWRlZC5nZXQo\naSkpIGRlcGVuZGluZyBvbiBpbnRlciByZXNwDQogICAgICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoImxvYWRlZCIsIEJpdFNldC5jbGFzcyk7\nDQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7DQog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQml0\nU2V0LmNsYXNzLCAiZ2V0IiwNCiAgICAgICAgICAgICAgICBib29sZWFuLmNs\nYXNzLCBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOw0KICAgICAgICAgICAg\nanVtcHMuYWRkKGNvZGUuaWZuZSgpKTsNCg0KICAgICAgICAgICAgaWYgKGlu\ndGVybWVkaWF0ZSkNCiAgICAgICAgICAgICAgICBhZGRMb2FkSW50ZXJtZWRp\nYXRlKGNvZGUsIGksIG9iamVjdENvdW50LCBqdW1wczIsIGludGVyKTsNCiAg\nICAgICAgICAgIGp1bXBzMi5hZGQoY29kZS5nbzIoKSk7DQoNCiAgICAgICAg\nICAgIC8vIGlmIChmZXRjaC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pIT1GZXRj\naENvbmZpZ3VyYXRpb24uRkVUQ0hfTk9ORSkNCiAgICAgICAgICAgIHNldFRh\ncmdldChjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSksIGp1bXBzKTsNCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAgICAg\nIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFTdGF0\nZU1hbmFnZXIuY2xhc3MsDQogICAgICAgICAgICAgICAgImdldE1ldGFEYXRh\nIiwgQ2xhc3NNZXRhRGF0YS5jbGFzcywgbnVsbCk7DQogICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kc1tpXS5nZXRJbmRleCgpKTsN\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChD\nbGFzc01ldGFEYXRhLmNsYXNzLA0KICAgICAgICAgICAgICAgICJnZXRGaWVs\nZCIsIEZpZWxkTWV0YURhdGEuY2xhc3MsIG5ldyBDbGFzc1tde2ludC5jbGFz\nc30pOw0KICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QgKEZldGNoQ29uZmlndXJhdGlvbi5jbGFzcywgDQogICAgICAgICAg\nICAgICAgInJlcXVpcmVzRmV0Y2giLCBpbnQuY2xhc3MsIG5ldyBDbGFzc1td\ne0ZpZWxkTWV0YURhdGEuY2xhc3N9KTsNCiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTk9O\nRSk7DQogICAgICAgICAgICBqdW1wczIuYWRkKGNvZGUuaWZpY21wZXEoKSk7\nDQogICAgICAgICAgICBhZGRMb2FkKGJjLCBjb2RlLCBmbWRzW2ldLCBvYmpl\nY3RDb3VudCwgbG9jYWwsIGZhbHNlKTsNCg0KICAgICAgICAgICAganVtcHMg\nPSBqdW1wczI7DQogICAgICAgICAgICBpZiAocmVwbGFjZVR5cGUoZm1kc1tp\nXSkgPj0gSmF2YVR5cGVzLk9CSkVDVCkNCiAgICAgICAgICAgICAgICBvYmpl\nY3RDb3VudCsrOw0KICAgICAgICB9DQogICAgICAgIHNldFRhcmdldChjb2Rl\nLnZyZXR1cm4oKSwganVtcHMpOw0KICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nDQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIGFkZExvYWRXaXRoRmllbGRz\nTWV0aG9kKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEgbWV0YSkgew0KICAg\nICAgICBDb2RlIGNvZGUgPSBhZGRMb2FkTWV0aG9kKGJjLCB0cnVlKTsNCiAg\nICAgICAgLy8gcHVibGljIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBCaXRTZXQgZmllbGRzLA0KICAgICAgICAvLyAJCUZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGNvbm4pDQogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gbWV0YS5nZXRGaWVsZHMoKTsNCiAgICAgICAgQ29s\nbGVjdGlvbiBqdW1wcyA9IG5ldyBMaW5rZWRMaXN0KCk7DQogICAgICAgIENv\nbGxlY3Rpb24ganVtcHMyOw0KICAgICAgICBpbnQgb2JqZWN0Q291bnQgPSAw\nOw0KICAgICAgICBib29sZWFuIGludGVybWVkaWF0ZTsNCiAgICAgICAgaW50\nIGxvY2FsID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsNCiAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsNCiAgICAgICAgY29kZS5hc3Rv\ncmUoKS5zZXRMb2NhbChsb2NhbCk7DQogICAgICAgIGludCBpbnRlciA9IGNv\nZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7DQogICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXROdWxsKCk7DQogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9j\nYWwoaW50ZXIpOw0KDQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAganVtcHMyID0gbmV3IExp\nbmtlZExpc3QoKTsNCiAgICAgICAgICAgIGludGVybWVkaWF0ZSA9IHVzZXNJ\nbnRlcm1lZGlhdGUoZm1kc1tpXSk7DQogICAgICAgICAgICAvLyBpZiAoZmll\nbGRzLmdldChpKSkNCiAgICAgICAgICAgIC8vIHsNCiAgICAgICAgICAgIC8v\nIAkJaWYgKGxvYWRlZC5nZXQoaSkpDQogICAgICAgICAgICBzZXRUYXJnZXQo\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpLCBqdW1wcyk7DQogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7DQogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQml0U2V0LmNsYXNzLCAi\nZ2V0IiwNCiAgICAgICAgICAgICAgICBib29sZWFuLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgaW50LmNsYXNzIH0pOw0KICAgICAgICAgICAganVtcHMyLmFkZChj\nb2RlLmlmZXEoKSk7DQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOw0KICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKCJs\nb2FkZWQiLCBCaXRTZXQuY2xhc3MpOw0KICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKGkpOw0KICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKEJpdFNldC5jbGFzcywgImdldCIsDQogICAg\nICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgbmV3IENsYXNzW117IGludC5j\nbGFzcyB9KTsNCiAgICAgICAgICAgIGlmIChpbnRlcm1lZGlhdGUpDQogICAg\nICAgICAgICAgICAganVtcHMuYWRkKGNvZGUuaWZlcSgpKTsNCiAgICAgICAg\nICAgIGVsc2UNCiAgICAgICAgICAgICAgICBqdW1wczIuYWRkKGNvZGUuaWZl\ncSgpKTsNCg0KICAgICAgICAgICAgYWRkTG9hZChiYywgY29kZSwgZm1kc1tp\nXSwgb2JqZWN0Q291bnQsIGxvY2FsLCB0cnVlKTsNCiAgICAgICAgICAgIGlm\nICh1c2VzSW1wbERhdGEoZm1kc1tpXSkpIHsNCiAgICAgICAgICAgICAgICAv\nLyBsb2FkSW1wbERhdGEoc20sIGkpOw0KICAgICAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZShpKTsNCiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoImxvYWRJbXBsRGF0YSIsIHZvaWQuY2xh\nc3MsDQogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPcGVuSlBB\nU3RhdGVNYW5hZ2VyLmNsYXNzLCBpbnQuY2xhc3MgfSk7DQogICAgICAgICAg\nICB9DQoNCiAgICAgICAgICAgIC8vIGZpZWxkcy5jbGVhcihpKTsNCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsNCiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsNCiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaXRTZXQuY2xhc3MsICJj\nbGVhciIsIHZvaWQuY2xhc3MsDQogICAgICAgICAgICAgICAgbmV3IENsYXNz\nW10geyBpbnQuY2xhc3MgfSk7DQoNCiAgICAgICAgICAgIGp1bXBzMi5hZGQo\nY29kZS5nbzIoKSk7DQoNCiAgICAgICAgICAgIGlmIChpbnRlcm1lZGlhdGUp\nDQogICAgICAgICAgICAgICAgc2V0VGFyZ2V0KGFkZExvYWRJbnRlcm1lZGlh\ndGUNCiAgICAgICAgICAgICAgICAgICAgKGNvZGUsIGksIG9iamVjdENvdW50\nLCBqdW1wczIsIGludGVyKSwganVtcHMpOw0KDQogICAgICAgICAgICBqdW1w\ncyA9IGp1bXBzMjsNCiAgICAgICAgICAgIGlmIChyZXBsYWNlVHlwZShmbWRz\nW2ldKSA+PSBKYXZhVHlwZXMuT0JKRUNUKQ0KICAgICAgICAgICAgICAgIG9i\namVjdENvdW50Kys7DQogICAgICAgIH0NCiAgICAgICAgc2V0VGFyZ2V0KGNv\nZGUudnJldHVybigpLCBqdW1wcyk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBEZWNsYXJlIGFuZCBzdGFy\ndCB0aGUgYmFzZSBsb2FkIG1ldGhvZC4NCiAgICAgKi8NCiAgICBwcml2YXRl\nIENvZGUgYWRkTG9hZE1ldGhvZChCQ0NsYXNzIGJjLCBib29sZWFuIGZpZWxk\ncykgew0KICAgICAgICBDbGFzc1tdIGFyZ3MgPSBudWxsOw0KICAgICAgICBp\nZiAoZmllbGRzKQ0KICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBP\ncGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLCBCaXRTZXQuY2xhc3MsDQogICAg\nICAgICAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uLmNsYXNzLCBPYmplY3Qu\nY2xhc3MgfTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgYXJncyA9IG5l\ndyBDbGFzc1tdeyBPcGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLA0KICAgICAg\nICAgICAgICAgIEZldGNoQ29uZmlndXJhdGlvbi5jbGFzcywgT2JqZWN0LmNs\nYXNzIH07DQogICAgICAgIEJDTWV0aG9kIGxvYWQgPSBiYy5kZWNsYXJlTWV0\naG9kKCJsb2FkIiwgdm9pZC5jbGFzcywgYXJncyk7DQogICAgICAgIENvZGUg\nY29kZSA9IGxvYWQuZ2V0Q29kZSh0cnVlKTsNCg0KICAgICAgICAvL2xvYWRW\nZXJzaW9uKHNtKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsN\nCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoImxvYWRWZXJzaW9uIiwg\ndm9pZC5jbGFzcywNCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPcGVuSlBB\nU3RhdGVNYW5hZ2VyLmNsYXNzIH0pOw0KDQogICAgICAgIC8vbG9hZEltcGxE\nYXRhKHNtKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsNCiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoImxvYWRJbXBsRGF0YSIsIHZv\naWQuY2xhc3MsDQogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0\nYXRlTWFuYWdlci5jbGFzcyB9KTsNCiAgICAgICAgcmV0dXJuIGNvZGU7DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogQWRkIHRoZSBmaWVsZCBsb2FkLg0K\nICAgICAqLw0KICAgIHByaXZhdGUgSW5zdHJ1Y3Rpb24gYWRkTG9hZChCQ0Ns\nYXNzIGJjLCBDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kLA0KICAgICAg\nICBpbnQgb2JqZWN0Q291bnQsIGludCBsb2NhbCwgYm9vbGVhbiBmaWVsZHMp\nIHsNCiAgICAgICAgaW50IGluZGV4ID0gZm1kLmdldEluZGV4KCk7DQogICAg\nICAgIGludCB0eXBlQ29kZSA9IHJlcGxhY2VUeXBlKGZtZCk7DQogICAgICAg\nIEluc3RydWN0aW9uIGZpcnN0Ow0KICAgICAgICBpZiAodHlwZUNvZGUgPCBK\nYXZhVHlwZXMuT0JKRUNUKSB7DQogICAgICAgICAgICAvLyBzbS5zdG9yZTx0\neXBlPihpLCBmaWVsZDxpPikNCiAgICAgICAgICAgIENsYXNzIHR5cGUgPSBm\nb3JUeXBlKGZtZC5nZXRUeXBlQ29kZSgpKTsNCiAgICAgICAgICAgIGZpcnN0\nID0gY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGluZGV4KTsNCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoZ2V0RmllbGROYW1lKGluZGV4KSwgdHlwZSk7DQog\nICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChP\ncGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLA0KICAgICAgICAgICAgICAgICJz\ndG9yZSIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKHR5cGUuZ2V0TmFtZSgp\nKSwNCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\naW50LmNsYXNzLCB0eXBlIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAg\nICAgICAgLy8gZm1kID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChpKTsN\nCiAgICAgICAgICAgIGludCBvZmZzZXQgPSBmaWVsZHMgPyAxIDogMDsNCiAg\nICAgICAgICAgIGZpcnN0ID0gY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0K\nICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2Qo\nT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywNCiAgICAgICAgICAgICAgICAi\nZ2V0TWV0YURhdGEiLCBDbGFzc01ldGFEYXRhLmNsYXNzLCBudWxsKTsNCiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5k\nZXgoKSk7DQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoQ2xhc3NNZXRhRGF0YS5jbGFzcywgImdldEZpZWxkIiwNCiAgICAg\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\naW50LmNsYXNzIH0pOw0KICAgICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRM\nb2NhbChsb2NhbCk7DQogICAgICAgICAgICAvLyBzbS5zdG9yZUZpZWxkKGks\nIHRvRmllbGQoc20sIGZtZCwgb2JqZWN0c1tvYmplY3RDb3VudF0sDQogICAg\nICAgICAgICAvLyAJCWZldGNoLCBjb250ZXh0KTsNCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7DQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOw0KICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKGxvY2FsKTsNCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7\nDQogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoIm9iamVj\ndHMiLCBPYmplY3RbXS5jbGFzcyk7DQogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUob2JqZWN0Q291bnQpOw0KICAgICAgICAgICAgY29k\nZS5hYWxvYWQoKTsNCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgxICsgb2Zmc2V0KTsNCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgyICsgb2Zmc2V0KTsNCiAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChiYy5nZXROYW1lKCksICJ0b0ZpZWxkIiwNCiAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCB0b1N0cmlu\nZ3MobmV3IENsYXNzW117IA0KICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIuY2xhc3MsIEZpZWxkTWV0YURhdGEuY2xhc3MsDQogICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLCBGZXRjaENvbmZpZ3VyYXRpb24uY2xh\nc3MsIE9iamVjdC5jbGFzcyB9KSk7DQogICAgICAgICAgICBjb2RlLmludm9r\nZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2VyLmNs\nYXNzLA0KICAgICAgICAgICAgICAgICJzdG9yZUZpZWxkIiwgdm9pZC5jbGFz\ncywNCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzLCBP\nYmplY3QuY2xhc3MgfSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZp\ncnN0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIExvYWQgaW50ZXJtZWRp\nYXRlIGRhdGEgaWYgcG9zc2libGUuDQogICAgICovDQogICAgcHJpdmF0ZSBJ\nbnN0cnVjdGlvbiBhZGRMb2FkSW50ZXJtZWRpYXRlKENvZGUgY29kZSwgaW50\nIGluZGV4LA0KICAgICAgICBpbnQgb2JqZWN0Q291bnQsIENvbGxlY3Rpb24g\nanVtcHMyLCBpbnQgaW50ZXIpIHsNCiAgICAgICAgLy8gew0KICAgICAgICAv\nLyAJCU9iamVjdCBpbnRlciA9IG9iamVjdHNbb2JqZWN0Q291bnRdOw0KICAg\nICAgICBJbnN0cnVjdGlvbiBmaXJzdCA9IGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7DQogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZCgib2JqZWN0\ncyIsIE9iamVjdFtdLmNsYXNzKTsNCiAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKG9iamVjdENvdW50KTsNCiAgICAgICAgY29kZS5hYWxvYWQo\nKTsNCiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnRlcik7DQog\nICAgICAgIC8vIAkJaWYgKGludGVyICE9IG51bGwgJiYgIXNtLmdldExvYWRl\nZCgpLmdldChpbmRleCkpDQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChpbnRlcik7DQogICAgICAgIGp1bXBzMi5hZGQoY29kZS5pZm51bGwoKSk7\nDQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT3BlbkpQQVN0YXRl\nTWFuYWdlci5jbGFzcywNCiAgICAgICAgICAgICJnZXRMb2FkZWQiLCBCaXRT\nZXQuY2xhc3MsIG51bGwpOw0KICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoaW5kZXgpOw0KICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoQml0U2V0LmNsYXNzLCAiZ2V0IiwNCiAgICAgICAgICAgIGJv\nb2xlYW4uY2xhc3MsIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7DQogICAg\nICAgIGp1bXBzMi5hZGQoY29kZS5pZm5lKCkpOw0KICAgICAgICAvLwkJCXNt\nLnNldEludGVybWVkaWF0ZShpbmRleCwgaW50ZXIpOw0KICAgICAgICAvLwl9\nICAvLyBlbmQgZWxzZQ0KICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCk7DQogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7\nDQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnRlcik7DQogICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIuY2xhc3MsDQogICAgICAgICAgICAic2V0SW50ZXJtZWRp\nYXRlIiwgdm9pZC5jbGFzcywNCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBp\nbnQuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsNCiAgICAgICAgcmV0dXJuIGZp\ncnN0Ow0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBhZGRTdG9yZU1ldGhv\nZHMoQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7DQogICAgICAg\nIC8vIGkuZS4gdm9pZCBzdG9yZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBC\naXRTZXQgZmllbGRzKTsNCiAgICAgICAgYWRkU3RvcmVNZXRob2QoYmMsIG1l\ndGEsIHRydWUpOw0KICAgICAgICAvLyBpLmUuIHZvaWQgc3RvcmUoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSk7DQogICAgICAgIGFkZFN0b3JlTWV0aG9kKGJj\nLCBtZXRhLCBmYWxzZSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIGFk\nZFN0b3JlTWV0aG9kKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEgbWV0YSwN\nCiAgICAgICAgYm9vbGVhbiBmaWVsZHMpIHsNCiAgICAgICAgQkNNZXRob2Qg\nc3RvcmU7DQogICAgICAgIGlmIChmaWVsZHMpDQogICAgICAgICAgICBzdG9y\nZSA9IGJjLmRlY2xhcmVNZXRob2QoInN0b3JlIiwgdm9pZC5jbGFzcywNCiAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFuYWdl\nci5jbGFzcywgQml0U2V0LmNsYXNzIH0pOw0KICAgICAgICBlbHNlDQogICAg\nICAgICAgICBzdG9yZSA9IGJjLmRlY2xhcmVNZXRob2QoInN0b3JlIiwgdm9p\nZC5jbGFzcywNCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT3BlbkpQ\nQVN0YXRlTWFuYWdlci5jbGFzcyB9KTsNCiAgICAgICAgQ29kZSBjb2RlID0g\nc3RvcmUuZ2V0Q29kZSh0cnVlKTsNCg0KICAgICAgICAvLyBpbml0aWFsaXpl\nKCk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCgiaW5pdGlhbGl6ZSIs\nIHZvaWQuY2xhc3MsIG51bGwpOw0KDQogICAgICAgIC8vIHN0b3JlVmVyc2lv\nbihzbSk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKCJzdG9yZVZlcnNpb24iLCB2b2lk\nLmNsYXNzLA0KICAgICAgICAgICAgbmV3IENsYXNzW117IE9wZW5KUEFTdGF0\nZU1hbmFnZXIuY2xhc3MgfSk7DQoNCiAgICAgICAgLy8gc3RvcmVJbXBsRGF0\nYShzbSk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKCJzdG9yZUltcGxEYXRhIiwgdm9p\nZC5jbGFzcywNCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyLmNsYXNzIH0pOw0KDQogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmbWRzID0gbWV0YS5nZXRGaWVsZHMoKTsNCiAgICAgICAgQ29sbGVjdGlv\nbiBqdW1wcyA9IG5ldyBMaW5rZWRMaXN0KCk7DQogICAgICAgIGludCBvYmpl\nY3RDb3VudCA9IDA7DQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGZpZWxkcykgew0K\nICAgICAgICAgICAgICAgIC8vICBpZiAoZmllbGRzICE9IG51bGwgJiYgZmll\nbGRzLmdldChpbmRleCkpDQogICAgICAgICAgICAgICAgc2V0VGFyZ2V0KGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgxKSwganVtcHMpOw0KICAgICAgICAgICAg\nICAgIGp1bXBzLmFkZChjb2RlLmlmbnVsbCgpKTsNCiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7DQogICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOw0KICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaXRTZXQuY2xhc3Ms\nICJnZXQiLA0KICAgICAgICAgICAgICAgICAgICBib29sZWFuLmNsYXNzLCBu\nZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOw0KICAgICAgICAgICAgICAgIGp1\nbXBzLmFkZChjb2RlLmlmZXEoKSk7DQogICAgICAgICAgICB9IGVsc2Ugew0K\nICAgICAgICAgICAgICAgIC8vIGlmIChzbS5nZXRMb2FkZWQoKS5nZXQoaW5k\nZXgpKSkNCiAgICAgICAgICAgICAgICBzZXRUYXJnZXQoY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApLCBqdW1wcyk7DQogICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdl\nci5jbGFzcywNCiAgICAgICAgICAgICAgICAgICAgImdldExvYWRlZCIsIEJp\ndFNldC5jbGFzcywgbnVsbCk7DQogICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKGkpOw0KICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChCaXRTZXQuY2xhc3MsICJnZXQiLA0K\nICAgICAgICAgICAgICAgICAgICBib29sZWFuLmNsYXNzLCBuZXcgQ2xhc3Nb\nXXsgaW50LmNsYXNzIH0pOw0KICAgICAgICAgICAgICAgIGp1bXBzLmFkZChj\nb2RlLmlmZXEoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhZGRT\ndG9yZShiYywgY29kZSwgZm1kc1tpXSwgb2JqZWN0Q291bnQpOw0KICAgICAg\nICAgICAgaWYgKHVzZXNJbnRlcm1lZGlhdGUoZm1kc1tpXSkpIHsNCiAgICAg\nICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZWxzZUlucyA9IGNvZGUuZ28y\nKCk7DQogICAgICAgICAgICAgICAgLy8gZWxzZSBpZiAoIWxvYWRlZC5nZXQo\naW5kZXgpKQ0KICAgICAgICAgICAgICAgIHNldFRhcmdldChjb2RlLmFsb2Fk\nKCkuc2V0VGhpcygpLCBqdW1wcyk7DQogICAgICAgICAgICAgICAganVtcHMu\nYWRkKGVsc2VJbnMpOw0KICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZCgibG9hZGVkIiwgQml0U2V0LmNsYXNzKTsNCiAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7DQogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEJpdFNl\ndC5jbGFzcywgImdldCIsDQogICAgICAgICAgICAgICAgICAgIGJvb2xlYW4u\nY2xhc3MsIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7DQogICAgICAgICAg\nICAgICAganVtcHMuYWRkKGNvZGUuaWZuZSgpKTsNCiAgICAgICAgICAgICAg\nICAvLyBPYmplY3QgdmFsID0gc20uZ2V0SW50ZXJtZWRpYXRlKGluZGV4KTsN\nCiAgICAgICAgICAgICAgICAvLyBpZiAodmFsICE9IG51bGwpDQogICAgICAg\nICAgICAgICAgLy8gCQlvYmplY3RzW29iamVjdENvdW50XSA9IHZhbDsNCiAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOw0KICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9k\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsDQogICAgICAgICAgICAgICAg\nICAgICJnZXRJbnRlcm1lZGlhdGUiLCBPYmplY3QuY2xhc3MsIG5ldyBDbGFz\nc1tdeyBpbnQuY2xhc3MgfSk7DQogICAgICAgICAgICAgICAgaW50IGxvY2Fs\nID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsNCiAgICAgICAgICAgICAg\nICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGxvY2FsKTsNCiAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwobG9jYWwpOw0KICAgICAgICAg\nICAgICAgIGp1bXBzLmFkZChjb2RlLmlmbnVsbCgpKTsNCiAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICAgICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZCgib2JqZWN0cyIsIE9iamVjdFtd\nLmNsYXNzKTsNCiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUob2JqZWN0Q291bnQpOw0KICAgICAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChsb2NhbCk7DQogICAgICAgICAgICAgICAgY29kZS5h\nYXN0b3JlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocmVw\nbGFjZVR5cGUoZm1kc1tpXSkgPj0gSmF2YVR5cGVzLk9CSkVDVCkNCiAgICAg\nICAgICAgICAgICBvYmplY3RDb3VudCsrOw0KICAgICAgICB9DQogICAgICAg\nIHNldFRhcmdldChjb2RlLnZyZXR1cm4oKSwganVtcHMpOw0KICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOw0KICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIGFk\nZFN0b3JlKEJDQ2xhc3MgYmMsIENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBm\nbWQsDQogICAgICAgIGludCBvYmplY3RDb3VudCkgew0KICAgICAgICBpbnQg\ndHlwZUNvZGUgPSByZXBsYWNlVHlwZShmbWQpOw0KICAgICAgICBpbnQgaW5k\nZXggPSBmbWQuZ2V0SW5kZXgoKTsNCiAgICAgICAgaWYgKHR5cGVDb2RlIDwg\nSmF2YVR5cGVzLk9CSkVDVCkgew0KICAgICAgICAgICAgQ2xhc3MgdHlwZSA9\nIGZvclR5cGUodHlwZUNvZGUpOw0KICAgICAgICAgICAgLy8gZmllbGQ8aT4g\nPSBzbS5mZXRjaDxUeXBlPihpbmRleCkNCiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCk7DQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7DQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoaW5kZXgpOw0KICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywNCiAgICAg\nICAgICAgICAgICAiZmV0Y2giICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZSh0\neXBlLmdldE5hbWUoKSksIHR5cGUsDQogICAgICAgICAgICAgICAgbmV3IENs\nYXNzW117IGludC5jbGFzcyB9KTsNCiAgICAgICAgICAgIGNvZGUucHV0Zmll\nbGQoKS5zZXRGaWVsZChnZXRGaWVsZE5hbWUoaW5kZXgpLCB0eXBlKTsNCiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoImxvYWRlZCIsIEJpdFNldC5j\nbGFzcyk7DQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\naW5kZXgpOw0KICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKEJpdFNldC5jbGFzcywgInNldCIsIHZvaWQuY2xhc3MsDQogICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsNCiAgICAg\nICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIE9iamVjdCB2YWwgPSB0b0Rh\ndGEoc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChpbmRleCksDQogICAgICAg\nICAgICAvLyAJCXNtLmZldGNoRmllbGQoaW5kZXgsIGZhbHNlKSwgc20uZ2V0\nQ29udGV4dCgpKTsNCiAgICAgICAgICAgIGludCBsb2NhbCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7DQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOw0KICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOw0KICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywNCiAgICAgICAgICAg\nICAgICAiZ2V0TWV0YURhdGEiLCBDbGFzc01ldGFEYXRhLmNsYXNzLCBudWxs\nKTsNCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQu\nZ2V0SW5kZXgoKSk7DQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoQ2xhc3NNZXRhRGF0YS5jbGFzcywNCiAgICAgICAgICAg\nICAgICAiZ2V0RmllbGQiLCBGaWVsZE1ldGFEYXRhLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgaW50LmNsYXNzIH0pOw0KICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGZtZC5nZXRJbmRleCgpKTsNCiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShmYWxzZSk7DQogICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nLmNsYXNzLA0KICAgICAgICAgICAgICAgICJmZXRjaEZpZWxkIiwgT2JqZWN0\nLmNsYXNzLCBuZXcgQ2xhc3NbXQ0KICAgICAgICAgICAgICAgIHsgaW50LmNs\nYXNzLCBib29sZWFuLmNsYXNzIH0pOw0KICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgY29kZS5pbnZva2VpbnRl\ncmZhY2UoKS5zZXRNZXRob2QoT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywN\nCiAgICAgICAgICAgICAgICAiZ2V0Q29udGV4dCIsIFN0b3JlQ29udGV4dC5j\nbGFzcywgbnVsbCk7DQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoYmMuZ2V0TmFtZSgpLCAidG9EYXRhIiwNCiAgICAgICAg\nICAgICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCB0b1N0cmluZ3MobmV3\nIENsYXNzIFtdew0KICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGEuY2xh\nc3MsIE9iamVjdC5jbGFzcywgU3RvcmVDb250ZXh0LmNsYXNzIH0pKTsNCiAg\nICAgICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwobG9jYWwpOw0KDQog\nICAgICAgICAgICAvLyBpZiAodmFsID09IE5VTEwpIHsNCiAgICAgICAgICAg\nIC8vIAkJdmFsID0gbnVsbDsNCiAgICAgICAgICAgIC8vIAkJbG9hZGVkLmNs\nZWFyKGluZGV4KTsNCiAgICAgICAgICAgIC8vIAl9IGVsc2UNCiAgICAgICAg\nICAgIC8vIAkJbG9hZGVkLnNldChpbmRleCk7DQogICAgICAgICAgICAvLyAJ\nb2JqZWN0c1tvYmplY3RDb3VudF0gPSB2YWw7DQogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwobG9jYWwpOw0KICAgICAgICAgICAgY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChBYnN0cmFjdFBDRGF0YS5jbGFzcywgIk5V\nTEwiLA0KICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcyk7DQogICAgICAg\nICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmYWNtcG5lKCk7\nDQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOw0KICAg\nICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChsb2NhbCk7DQogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKCJsb2FkZWQiLCBCaXRTZXQuY2xh\nc3MpOw0KICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGlu\nZGV4KTsNCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChCaXRTZXQuY2xhc3MsICJjbGVhciIsIHZvaWQuY2xhc3MsDQogICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsNCiAgICAg\nICAgICAgIEp1bXBJbnN0cnVjdGlvbiBnbzIgPSBjb2RlLmdvMigpOw0KICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCkpOw0KICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKCJs\nb2FkZWQiLCBCaXRTZXQuY2xhc3MpOw0KICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKGluZGV4KTsNCiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChCaXRTZXQuY2xhc3MsICJzZXQiLCB2\nb2lkLmNsYXNzLA0KICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQu\nY2xhc3MgfSk7DQogICAgICAgICAgICBnbzIuc2V0VGFyZ2V0KGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCkpOw0KICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKCJvYmplY3RzIiwgT2JqZWN0W10uY2xhc3MpOw0KICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG9iamVjdENvdW50KTsN\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChsb2NhbCk7DQog\nICAgICAgICAgICBjb2RlLmFhc3RvcmUoKTsNCiAgICAgICAgfQ0KICAgICAg\nICBpZiAoIXVzZXNJbXBsRGF0YShmbWQpKQ0KICAgICAgICAgICAgcmV0dXJu\nOw0KDQogICAgICAgIC8vIHN0b3JlSW1wbERhdGEoc20sIGksIGxvYWRlZC5n\nZXQoaSk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGluZGV4KTsNCiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsNCiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKCJsb2FkZWQiLCBCaXRTZXQuY2xhc3MpOw0KICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOw0KICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoQml0U2V0LmNsYXNzLCAiZ2V0IiwgYm9v\nbGVhbi5jbGFzcywNCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xh\nc3MgfSk7DQogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZCgic3RvcmVJbXBsRGF0YSIsIHZvaWQuY2xhc3MsDQogICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywgaW50LmNs\nYXNzLCBib29sZWFuLmNsYXNzIH0pOw0KICAgIH0NCg0KICAgIHByaXZhdGUg\ndm9pZCBhZGROZXdFbWJlZGRlZChCQ0NsYXNzIGJjKSB7DQogICAgICAgIC8v\nIHZvaWQgbmV3RW1iZWRkZWRQQ0RhdGEoT3BlbkpQQVN0YXRlTWFuYWdlciBl\nbWJlZGRlZCkNCiAgICAgICAgQkNNZXRob2QgbWV0aCA9IGJjLmRlY2xhcmVN\nZXRob2QoIm5ld0VtYmVkZGVkUENEYXRhIiwgUENEYXRhLmNsYXNzLA0KICAg\nICAgICAgICAgbmV3IENsYXNzW117IE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xh\nc3MgfSk7DQogICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVl\nKTsNCiAgICAgICAgLy8gcmV0dXJuIGdldFN0b3JhZ2VHZW5lcmF0b3IoKS5n\nZW5lcmF0ZVBDRGF0YQ0KICAgICAgICAvLyAJCShzbS5nZXRJZCgpLCBzbS5n\nZXRNZXRhRGF0YSgpKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMo\nKTsNCiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKCJzdG9yYWdl\nR2VuZXJhdG9yIiwgUENEYXRhR2VuZXJhdG9yLmNsYXNzKTsNCiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICBjb2RlLmludm9r\nZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3RhdGVNYW5hZ2VyLmNs\nYXNzLA0KICAgICAgICAgICAgImdldElkIiwgT2JqZWN0LmNsYXNzLCBudWxs\nKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyLmNsYXNzLA0KICAgICAgICAgICAgImdldE1ldGFEYXRhIiwg\nQ2xhc3NNZXRhRGF0YS5jbGFzcywgbnVsbCk7DQogICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChQQ0RhdGFHZW5lcmF0b3IuY2xhc3Ms\nDQogICAgICAgICAgICAiZ2VuZXJhdGVQQ0RhdGEiLCBQQ0RhdGEuY2xhc3Ms\nIG5ldyBDbGFzc1tdDQogICAgICAgICAgICB7IE9iamVjdC5jbGFzcywgQ2xh\nc3NNZXRhRGF0YS5jbGFzcyB9KTsNCiAgICAgICAgY29kZS5hcmV0dXJuKCk7\nDQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7DQogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICB9DQoNCiAgICBwcml2\nYXRlIHZvaWQgYWRkR2V0RGF0YShCQ0NsYXNzIGJjKSB7DQogICAgICAgIC8v\nIHJldHVybiBnZXRPYmplY3RGaWVsZChpKTsNCiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0RGF0YSIsIE9iamVjdC5j\nbGFzcywNCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7\nDQogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOw0K\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICBjb2Rl\nLmlsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZCgiZ2V0T2JqZWN0IiwgT2JqZWN0LmNsYXNzLA0K\nICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsNCiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsN\nCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vDQogICAgLy8gVXRpbGl0aWVz\nDQogICAgLy8vLy8vLy8vLy8vLw0KDQogICAgLyoqDQogICAgICogUmV0dXJu\nIGEgdmFsaWQge0BsaW5rIEphdmFUeXBlc30gY29uc3RhbnQgZm9yIHRoZSBn\naXZlbiBmaWVsZA0KICAgICAqLw0KICAgIHByb3RlY3RlZCBpbnQgcmVwbGFj\nZVR5cGUoRmllbGRNZXRhRGF0YSBmbWQpIHsNCiAgICAgICAgaWYgKHVzZXNJ\nbnRlcm1lZGlhdGUoZm1kKSkNCiAgICAgICAgICAgIHJldHVybiBKYXZhVHlw\nZXMuT0JKRUNUOw0KICAgICAgICByZXR1cm4gZm1kLmdldFR5cGVDb2RlKCk7\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogV2hldGhlciB0aGUgZ2l2ZW4g\nZmllbGQgdXNlcyBhIGNhY2hlYWJsZSBpbnRlcm1lZGlhdGUgdmFsdWUuDQog\nICAgICovDQogICAgcHJvdGVjdGVkIGJvb2xlYW4gdXNlc0ludGVybWVkaWF0\nZShGaWVsZE1ldGFEYXRhIGZtZCkgew0KICAgICAgICByZXR1cm4gZm1kLnVz\nZXNJbnRlcm1lZGlhdGUoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBX\naGV0aGVyIHRoZSBnaXZlbiB0eXBlIG1pZ2h0IGhhdmUgY2FjaGVhYmxlIGNs\nYXNzLWxldmVsIGltcGwgZGF0YS4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiB1c2VzSW1wbERhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7DQog\nICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIFdoZXRoZXIgdGhlIGdpdmVuIGZpZWxkIG1pZ2h0IGhhdmUgY2FjaGVhYmxl\nIGltcGwgZGF0YS4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiB1\nc2VzSW1wbERhdGEoRmllbGRNZXRhRGF0YSBmbWQpIHsNCiAgICAgICAgcmV0\ndXJuIGZtZC51c2VzSW1wbERhdGEoKSA9PSBudWxsOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFRoZSBudW1iZXIgb2YgZmllbGRzIHdpdGggY2FjaGVh\nYmxlIGltcGwgZGF0YS4NCiAgICAgKi8NCiAgICBwcml2YXRlIGludCBjb3Vu\ndEltcGxEYXRhRmllbGRzKENsYXNzTWV0YURhdGEgbWV0YSkgew0KICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RmllbGRzKCk7DQog\nICAgICAgIGludCBjb3VudCA9IDA7DQogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgIGlmICh1c2Vz\nSW1wbERhdGEoZm1kc1tpXSkpDQogICAgICAgICAgICAgICAgY291bnQrKzsN\nCiAgICAgICAgcmV0dXJuIGNvdW50Ow0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIEFkZCBtZXRob2Qgd2hpY2ggZGVmZXJzIHRvIEFic3RyYWN0UENEYXRh\nLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCB2b2lkIGNhbGxBYnN0cmFjdFBD\nRGF0YShCQ0NsYXNzIGJjLCBTdHJpbmcgbmFtZSwgQ2xhc3MgcmV0VHlwZSwN\nCiAgICAgICAgQ2xhc3NbXSBhcmdzKSB7DQogICAgICAgIEJDTWV0aG9kIG1l\ndGggPSBiYy5kZWNsYXJlTWV0aG9kKG5hbWUsIHJldFR5cGUsIGFyZ3MpOw0K\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7DQogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgIGNv\nZGUueGxvYWQoKS5zZXRQYXJhbShpKS5zZXRUeXBlKGFyZ3NbaV0pOw0KICAg\nICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQWJzdHJhY3RQ\nQ0RhdGEuY2xhc3MsIG5hbWUsIHJldFR5cGUsDQogICAgICAgICAgICBhcmdz\nKTsNCiAgICAgICAgaWYgKCF2b2lkLmNsYXNzLmVxdWFscyhyZXRUeXBlKSkN\nCiAgICAgICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUocmV0VHlwZSk7\nDQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7DQogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBTZXQgdGhlIGNvbGxlY3Rpb24gb2Yge0BsaW5rIEp1bXBJbnN0\ncnVjdGlvbn1zIHRvIHRoZSBnaXZlbiBpbnN0cnVjdGlvbiwNCiAgICAgKiBj\nbGVhcmluZyB0aGUgY29sbGVjdGlvbiBpbiB0aGUgcHJvY2Vzcy4NCiAgICAg\nKi8NCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRUYXJnZXQoSW5zdHJ1Y3Rpb24g\naW5zLCBDb2xsZWN0aW9uIGp1bXBzKSB7DQogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXQgPSBqdW1wcy5pdGVyYXRvcigpOyBpdC5oYXNOZXh0KCk7KQ0KICAg\nICAgICAgICAgKChKdW1wSW5zdHJ1Y3Rpb24pIGl0Lm5leHQoKSkuc2V0VGFy\nZ2V0KGlucyk7DQogICAgICAgIGp1bXBzLmNsZWFyKCk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogVHJhbnNmb3JtIHRoZSBnaXZlbiBhcnJheSBvZiBj\nbGFzc2VzIHRvIHN0cmluZ3MuDQogICAgICovDQogICAgcHJpdmF0ZSBzdGF0\naWMgU3RyaW5nW10gdG9TdHJpbmdzKENsYXNzW10gY2xzKSB7DQogICAgICAg\nIFN0cmluZ1tdIHN0cmluZ3MgPSBuZXcgU3RyaW5nW2Nscy5sZW5ndGhdOw0K\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0cmluZ3MubGVuZ3RoOyBp\nKyspDQogICAgICAgICAgICBzdHJpbmdzW2ldID0gY2xzW2ldLmdldE5hbWUo\nKTsNCiAgICAgICAgcmV0dXJuIHN0cmluZ3M7DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogRHluYW1pYyB7QGxpbmsgUENEYXRhfXMgZ2VuZXJhdGVkIHdp\nbGwgaW1wbGVtZW50IHRoaXMgaW50ZXJmYWNlDQogICAgICogdG8gc2ltcGxp\nZnkgaW5pdGlhbGl6YXRpb24uDQogICAgICovDQogICAgcHVibGljIHN0YXRp\nYyBpbnRlcmZhY2UgRHluYW1pY1BDRGF0YSBleHRlbmRzIFBDRGF0YSB7DQoN\nCiAgICAgICAgcHVibGljIHZvaWQgc2V0SWQoT2JqZWN0IG9pZCk7DQoNCiAg\nICAgICAgcHVibGljIFBDRGF0YUdlbmVyYXRvciBnZXRTdG9yYWdlR2VuZXJh\ndG9yKCk7DQoNCiAgICAgICAgcHVibGljIHZvaWQgc2V0U3RvcmFnZUdlbmVy\nYXRvciAoUENEYXRhR2VuZXJhdG9yIGdlbmVyYXRvcik7DQoJfQ0KfQ0K\n","encoding":"base64"}

