{"sha":"5b056f92864ff432639da4395de86ffa7504ae5d","node_id":"MDQ6QmxvYjIwNjM2NDo1YjA1NmY5Mjg2NGZmNDMyNjM5ZGE0Mzk1ZGU4NmZmYTc1MDRhZTVk","size":179380,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5b056f92864ff432639da4395de86ffa7504ae5d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xhc3NBcmdQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQnl0ZWNvZGVXcml0\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZI\nZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9w\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuU2Vy\ndmljZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkRhdGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkRvdWJsZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFz\nczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmll\nbGRJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJ\nbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0\nZWNvZGUuTG9hZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5N\nZXRob2RJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuUHJvamVj\ndDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuVGFibGVTd2l0Y2hJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ2xhc3NJbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51dGlsLlN0cmlu\nZ3M7CgovKioKICogQnl0ZWNvZGUgZW5oYW5jZXIgdXNlZCB0byBlbmhhbmNl\nIHBlcnNpc3RlbnQgY2xhc3NlcyBmcm9tIG1ldGFkYXRhLiBUaGUKICogZW5o\nYW5jZXIgbXVzdCBiZSBpbnZva2VkIG9uIGFsbCBwZXJzaXN0ZW5jZS1jYXBh\nYmxlIGFuZCBwZXJzaXN0ZW5jZSBhd2FyZQogKiBjbGFzc2VzLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFBDRW5oYW5jZXIg\newogICAgLy8gRGVzaWduYXRlcyBhIHZlcnNpb24gZm9yIG1haW50YWluaW5n\nIGNvbXBhdGJpbGl0eSB3aGVuIFBDRW5oYW5jZXIKICAgIC8vIG1vZGlmaWVz\nIGVuaGFuY2VtZW50IHRoYXQgY2FuIGJyZWFrIHNlcmlhbGl6YXRpb24gb3Ig\nb3RoZXIgY29udHJhY3RzCiAgICAvLyBFYWNoIGVuaGFuY2VkIGNsYXNzIHdp\nbGwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIHZpYQogICAgLy8g\ncHVibGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFUl9WRVJTSU9OID0g\nMjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX05PTkUg\nPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9BV0FS\nRSA9IDIgPDwgMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFO\nQ0VfSU5URVJGQUNFID0gMiA8PCAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRV9QQyA9IDIgPDwgMjsKCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBQUkUgPSAicGMiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgSVNERVRBQ0hFRFNUQVRFREVGSU5JVElWRSA9IFBSRSAK\nICAgICAgICArICJpc0RldGFjaGVkU3RhdGVEZWZpbml0aXZlIjsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBQQ1RZUEUgPSBQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU00gPSBQUkUgKyAiU3RhdGVNYW5hZ2VyIjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENsYXNzIFNNVFlQRSA9IFN0YXRlTWFuYWdlci5jbGFzczsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBJTkhFUklUID0gUFJF\nICsgIkluaGVyaXRlZEZpZWxkQ291bnQiOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIENPTlRFWFROQU1FID0gIkdlbmVyaWNDb250ZXh0IjsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFVTRVJFWENFUCA9IFVz\nZXJFeGNlcHRpb24uY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBD\nbGFzcyBJTlRFUk5FWENFUCA9IEludGVybmFsRXhjZXB0aW9uLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSEVMUEVSVFlQRSA9IFBD\nUmVnaXN0cnkuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU1VQRVIgPSBQUkUgKyAiUENTdXBlcmNsYXNzIjsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIENsYXNzIE9JREZTVFlQRSA9IEZpZWxkU3VwcGxpZXIu\nY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBPSURGQ1RZ\nUEUgPSBGaWVsZENvbnN1bWVyLmNsYXNzOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoUENFbmhhbmNlci5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgUkVERUZJTkVEX0FUVFJJQlVURQogICAgICAgID0g\nUENFbmhhbmNlci5jbGFzcy5nZXROYW1lKCkgKyAiI3JlZGVmaW5lZC10eXBl\nIjsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQXV4aWxpYXJ5RW5o\nYW5jZXJbXSBfYXV4RW5oYW5jZXJzOwogICAgc3RhdGljIHsKICAgICAgICBD\nbGFzc1tdIGNsYXNzZXMgPSBTZXJ2aWNlcy5nZXRJbXBsZW1lbnRvckNsYXNz\nZXMoCiAgICAgICAgICAgIEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzLAogICAg\nICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xh\nc3NMb2FkZXJBY3Rpb24oQXV4aWxpYXJ5RW5oYW5jZXIuY2xhc3MpKSk7CiAg\nICAgICAgTGlzdCBhdXhFbmhhbmNlcnMgPSBuZXcgQXJyYXlMaXN0KGNsYXNz\nZXMubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsYXNz\nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGF1eEVuaGFuY2Vycy5hZGQoQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nbmV3SW5zdGFuY2VBY3Rpb24oY2xhc3Nlc1tpXSkpKTsKCQkgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGF1eCBlbmhh\nbmNlciBtYXkgcmVseSBvbiBub24tZXhpc3RhbnQgc3BlYyBjbGFzc2VzLCBl\ndGMKCQkgICAgfQoJCX0KICAgIAlfYXV4RW5oYW5jZXJzID0gKEF1eGlsaWFy\neUVuaGFuY2VyW10pIGF1eEVuaGFuY2Vycy50b0FycmF5CiAgICAgICAgICAg\nIChuZXcgQXV4aWxpYXJ5RW5oYW5jZXJbYXV4RW5oYW5jZXJzLnNpemUoKV0p\nOwogICAgfQoKICAgIHByaXZhdGUgQkNDbGFzcyBfcGM7CiAgICBwcml2YXRl\nIGZpbmFsIEJDQ2xhc3MgX21hbmFnZWRUeXBlOwogICAgcHJpdmF0ZSBmaW5h\nbCBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSBmaW5h\nbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cg\nX2xvZzsKICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2RlZkNvbnMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9yZWRlZmluZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9zdWJjbGFzcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9m\nYWlsID0gZmFsc2U7CiAgICBwcml2YXRlIFNldCBfdmlvbGF0aW9ucyA9IG51\nbGw7CiAgICBwcml2YXRlIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2YXRl\nIEJ5dGVjb2RlV3JpdGVyIF93cml0ZXIgPSBudWxsOwogICAgcHJpdmF0ZSBN\nYXAgX2JhY2tpbmdGaWVsZHMgPSBudWxsOyAvLyBtYXAgb2Ygc2V0IC8gZ2V0\nIG5hbWVzID0+IGZpZWxkIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfYXR0cnNU\nb0ZpZWxkcyA9IG51bGw7IC8vIG1hcCBvZiBhdHRyIG5hbWVzID0+IGZpZWxk\nIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfZmllbGRzVG9BdHRycyA9IG51bGw7\nIC8vIG1hcCBvZiBmaWVsZCBuYW1lcyA9PiBhdHRyIG5hbWVzCiAgICBwcml2\nYXRlIGJvb2xlYW4gX2lzQWxyZWFkeVJlZGVmaW5lZCA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9pc0FscmVhZHlTdWJjbGFzc2VkID0gZmFsc2U7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2Jjc0NvbmZpZ3VyZWQgPSBmYWxzZTsK\nCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJh\ndGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLiBUaGlzIHdpbGwgbG9vawogICAg\nICogdXAgdGhlIG1ldGFkYXRhIGZvciA8Y29kZT50eXBlPC9jb2RlPiBmcm9t\nIDxjb2RlPmNvbmY8L2NvZGU+J3MKICAgICAqIHJlcG9zaXRvcnkuCiAgICAg\nKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYsIENsYXNzIHR5cGUpIHsKICAgICAgICB0aGlzKGNvbmYsIChCQ0Ns\nYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihuZXcg\nUHJvamVjdCgpLCB0eXBlKSksCiAgICAgICAgICAgIChNZXRhRGF0YVJlcG9z\naXRvcnkpIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0\nb3IuIFN1cHBseSBjb25maWd1cmF0aW9uIGFuZCB0eXBlIHRvIGVuaGFuY2Uu\nIFRoaXMgd2lsbCBsb29rCiAgICAgKiB1cCB0aGUgbWV0YWRhdGEgZm9yIDxj\nb2RlPm1ldGE8L2NvZGU+IGJ5IGNvbnZlcnRpbmcgYmFjayB0byBhIGNsYXNz\nCiAgICAgKiBhbmQgdGhlbiBsb2FkaW5nIGZyb20gPGNvZGU+Y29uZjwvY29k\nZT4ncyByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNl\ncihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFzc01ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICB0aGlzKGNvbmYsIChCQ0NsYXNzKSBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAg\nICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihuZXcgUHJvamVjdCgpLCBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSkpLAogICAgICAgICAgICBtZXRhLmdldFJl\ncG9zaXRvcnkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rv\nci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAgICAgKgogICAgICogQHBhcmFt\nIHR5cGUgdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBl\nIHRvCiAgICAgKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20g\nYW55IHN0cmVhbSBvciBmaWxlCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRh\nZGF0YSByZXBvc2l0b3J5IHRvIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAog\nICAgICogb3IgbnVsbCB0byBjcmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhl\nIHJlcG9zaXRvcnkKICAgICAqIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRp\nb24gaXNuJ3QgdXNlZCBieSBkZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBj\nb25maWd1cmF0aW9uIG1pZ2h0IGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlv\nbi1zcGVjaWZpYyBzdWJjbGFzcyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVx\ndWlyZWQgbW9yZSB0aGFuIGp1c3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAg\nICogQGRlcHJlY2F0ZWQgdXNlIHtAbGluayAjUENFbmhhbmNlcihPcGVuSlBB\nQ29uZmlndXJhdGlvbiwgQkNDbGFzcywKICAgICAgICBNZXRhRGF0YVJlcG9z\naXRvcnksIENsYXNzTG9hZGVyKX0gaW5zdGVhZC4gCiAgICAgKi8KICAgIHB1\nYmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJD\nQ2xhc3MgdHlwZSwKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3Mp\nIHsKICAgICAgICB0aGlzKGNvbmYsIHR5cGUsIHJlcG9zLCBudWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgYnl0ZWNv\nZGUgcmVwcmVzZW50YXRpb24gZm8gdGhlIHR5cGUgdG8KICAgICAqIGVuaGFu\nY2U7IHRoaXMgY2FuIGJlIGNyZWF0ZWQgZnJvbSBhbnkgc3RyZWFtIG9yIGZp\nbGUKICAgICAqIEBwYXJhbSByZXBvcyBhIG1ldGFkYXRhIHJlcG9zaXRvcnkg\ndG8gdXNlIGZvciBtZXRhZGF0YSBhY2Nlc3MsCiAgICAgKiBvciBudWxsIHRv\nIGNyZWF0ZSBhIG5ldyByZXBvcml0b3J5OyB0aGUgcmVwb3NpdG9yeQogICAg\nICogZnJvbSB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbiBpc24ndCB1c2VkIGJ5\nIGRlZmF1bHQKICAgICAqIGJlY2F1c2UgdGhlIGNvbmZpZ3VyYXRpb24gbWln\naHQgYmUgYW4KICAgICAqIGltcGxlbWVudGF0aW9uLXNwZWNpZmljIHN1YmNs\nYXNzIHdob3NlIG1ldGFkYXRhCiAgICAgKiByZXF1aXJlZCBtb3JlIHRoYW4g\nanVzdCBiYXNlIG1ldGFkYXRhIGZpbGVzCiAgICAgKiBAcGFyYW0gbG9hZGVy\nIHRoZSBlbnZpcm9ubWVudCBjbGFzc2xvYWRlciB0byB1c2UgZm9yIGxvYWRp\nbmcKICAgICAqIGNsYXNzZXMgYW5kIHJlc291cmNlcy4KICAgICAqLwogICAg\ncHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwg\nQkNDbGFzcyB0eXBlLAogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBv\ncywgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgX21hbmFnZWRUeXBl\nID0gdHlwZTsKICAgICAgICBfcGMgPSB0eXBlOwoKICAgICAgICBfbG9nID0g\nY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0Up\nOwoKICAgICAgICBpZiAocmVwb3MgPT0gbnVsbCkgewogICAgICAgICAgICBf\ncmVwb3MgPSBjb25mLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7\nCiAgICAgICAgICAgIF9yZXBvcy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVw\nb3NpdG9yeS5NT0RFX01FVEEpOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfbWV0YSA9IF9yZXBvcy5nZXRN\nZXRhRGF0YSh0eXBlLmdldFR5cGUoKSwgbG9hZGVyLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IHJlcG9zaXRv\ncnkuIFRoZSByZXBvc2l0b3J5J3MgY29uZmlndXJhdGlvbiB3aWxsCiAgICAg\nKiBiZSB1c2VkLCBhbmQgdGhlIG1ldGFkYXRhIHBhc3NlZCBpbiB3aWxsIGJl\nIHVzZWQgYXMtaXMgd2l0aG91dCBkb2luZwogICAgICogYW55IGFkZGl0aW9u\nYWwgbG9va3Vwcy4gVGhpcyBpcyB1c2VmdWwgd2hlbiBydW5uaW5nIHRoZSBl\nbmhhbmNlcgogICAgICogZHVyaW5nIG1ldGFkYXRhIGxvYWQuCiAgICAgKgog\nICAgICogQHBhcmFtIHJlcG9zIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1\nc2UgZm9yIG1ldGFkYXRhIGFjY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3Jl\nYXRlIGEgbmV3IHJlcG9yaXRvcnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBm\ncm9tIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVm\nYXVsdAogICAgICogYmVjYXVzZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBi\nZSBhbgogICAgICogaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mg\nd2hvc2UgbWV0YWRhdGEKICAgICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0\nIGJhc2UgbWV0YWRhdGEgZmlsZXMKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBi\neXRlY29kZSByZXByZXNlbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAgICog\nZW5oYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0g\nb3IgZmlsZQogICAgICogQHBhcmFtIG1ldGEgdGhlIG1ldGFkYXRhIHRvIHVz\nZSBmb3IgcHJvY2Vzc2luZyB0aGlzIHR5cGUuCiAgICAgKgogICAgICogQHNp\nbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE1ldGFE\nYXRhUmVwb3NpdG9yeSByZXBvcywgQkNDbGFzcyB0eXBlLAogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9tYW5hZ2VkVHlwZSA9IHR5\ncGU7CiAgICAgICAgX3BjID0gdHlwZTsKCiAgICAgICAgX2xvZyA9IHJlcG9z\nLmdldENvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuZ2V0TG9nKE9wZW5K\nUEFDb25maWd1cmF0aW9uLkxPR19FTkhBTkNFKTsKCiAgICAgICAgX3JlcG9z\nID0gcmVwb3M7CiAgICAgICAgX21ldGEgPSBtZXRhOwogICAgfQoKICAgIHN0\nYXRpYyBTdHJpbmcgdG9QQ1N1YmNsYXNzTmFtZShDbGFzcyBjbHMpIHsKICAg\nICAgICByZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShQQ0VuaGFuY2Vy\nLmNsYXNzKSArICIuIgogICAgICAgICAgICArIGNscy5nZXROYW1lKCkucmVw\nbGFjZSgnLicsICckJykgKyAiJHBjc3ViY2xhc3MiOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciBvciBub3QgPGNvZGU+Y2xhc3NOYW1lPC9jb2Rl\nPiBpcyB0aGUgbmFtZSBmb3IgYQogICAgICogZHluYW1pY2FsbHktY3JlYXRl\nZCBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAq\nIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xl\nYW4gaXNQQ1N1YmNsYXNzTmFtZShTdHJpbmcgY2xhc3NOYW1lKSB7CiAgICAg\nICAgcmV0dXJuIGNsYXNzTmFtZS5zdGFydHNXaXRoKFN0cmluZ3MuZ2V0UGFj\na2FnZU5hbWUoUENFbmhhbmNlci5jbGFzcykpCiAgICAgICAgICAgICYmIGNs\nYXNzTmFtZS5lbmRzV2l0aCgiJHBjc3ViY2xhc3MiKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIElmIDxjb2RlPmNsYXNzTmFtZTwvY29kZT4gaXMgYSBkeW5h\nbWljYWxseS1jcmVhdGVkIHBlcnNpc3RlbmNlLWNhcGFibGUKICAgICAqIHN1\nYmNsYXNzIG5hbWUsIHJldHVybnMgdGhlIG5hbWUgb2YgdGhlIGNsYXNzIHRo\nYXQgaXQgc3ViY2xhc3Nlcy4KICAgICAqIE90aGVyd2lzZSwgcmV0dXJucyA8\nY29kZT5jbGFzc05hbWU8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAx\nLjEuMAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b01hbmFn\nZWRUeXBlTmFtZShTdHJpbmcgY2xhc3NOYW1lKSB7CiAgICAgICAgaWYgKGlz\nUENTdWJjbGFzc05hbWUoY2xhc3NOYW1lKSkgewogICAgICAgICAgICBjbGFz\nc05hbWUgPSBjbGFzc05hbWUuc3Vic3RyaW5nKAogICAgICAgICAgICAgICAg\nU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShQQ0VuaGFuY2VyLmNsYXNzKS5sZW5n\ndGgoKSArIDEpOwogICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUu\nc3Vic3RyaW5nKDAsIGNsYXNzTmFtZS5sYXN0SW5kZXhPZigiJCIpKTsKICAg\nICAgICAgICAgLy8gdGhpcyBpcyBub3QgY29ycmVjdCBmb3IgbmVzdGVkIFBD\ncwogICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUucmVwbGFjZSgn\nJCcsICcuJyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBj\nbGFzc05hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4g\nU3VwcGx5IGNvbmZpZ3VyYXRpb24sIHR5cGUsIGFuZCBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIHRoaXMoY29uZiwgdHlwZSwgbWV0YS5nZXRSZXBv\nc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBi\neXRlY29kZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgcGVyc2lzdGVuY2UtY2Fw\nYWJsZSBjbGFzcwogICAgICogYmVpbmcgbWFuaXB1bGF0ZWQuCiAgICAgKi8K\nICAgIHB1YmxpYyBCQ0NsYXNzIGdldFBDQnl0ZWNvZGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9wYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hbmFnZWQgY2xhc3Mg\nYmVpbmcKICAgICAqIG1hbmlwdWxhdGVkLiBUaGlzIGlzIHVzdWFsbHkgdGhl\nIHNhbWUgYXMge0BsaW5rICNnZXRQQ0J5dGVjb2RlfSwKICAgICAqIGV4Y2Vw\ndCB3aGVuIHJ1bm5pbmcgdGhlIGVuaGFuY2VyIHRvIHJlZGVmaW5lIGFuZCBz\ndWJjbGFzcwogICAgICogZXhpc3RpbmcgcGVyc2lzdGVudCB0eXBlcy4KICAg\nICAqLwogICAgcHVibGljIEJDQ2xhc3MgZ2V0TWFuYWdlZFR5cGVCeXRlY29k\nZSgpIHsKICAgICAgICByZXR1cm4gX21hbmFnZWRUeXBlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGNsYXNz\nIGJlaW5nIG1hbmlwdWxhdGVkLCBvciBudWxsIGlmIG5vdAogICAgICogYSBw\nZXJzaXN0ZW50IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRo\nZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBj\nb25zdHJ1Y3RvciBpZiBvbmUgaXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0\naGUgY2xhc3MuIE9wZW5KUEEKICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1h\ncmcgY29uc3RydWN0b3IgKHdoZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGls\nZXIKICAgICAqIG9yIGJ5IHRoZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEFkZERlZmF1bHRDb25z\ndHJ1Y3RvcigpIHsKICAgICAgICByZXR1cm4gX2RlZkNvbnM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRo\nZSBlbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3Ry\ndWN0b3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNs\nYXNzLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNv\nbnN0cnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAg\nICAgKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRBZGREZWZhdWx0Q29uc3RydWN0b3Io\nYm9vbGVhbiBhZGREZWZhdWx0Q29uc3RydWN0b3IpIHsKICAgICAgICBfZGVm\nQ29ucyA9IGFkZERlZmF1bHRDb25zdHJ1Y3RvcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtdXRhdGUgaXRz\nIGFyZ3VtZW50cywgb3IganVzdCBydW4gdmFsaWRhdGlvbgogICAgICogYW5k\nIG9wdGlvbmFsIHN1YmNsYXNzaW5nIGxvZ2ljIG9uIHRoZW0uIFVzdWFsbHkg\ndXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoCiAgICAgKiA8Y29kZT5zZXRDcmVh\ndGVTdWJjbGFzcyh0cnVlKTwvY29kZT4uCiAgICAgKgogICAgICogQHNpbmNl\nIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFJlZGVmaW5l\nKCkgewogICAgICAgIHJldHVybiBfcmVkZWZpbmU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0\ncyBhcmd1bWVudHMsIG9yIGp1c3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFu\nZCBvcHRpb25hbCBzdWJjbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5\nIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3Jl\nYXRlU3ViY2xhc3ModHJ1ZSk8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5j\nZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZWRlZmluZShi\nb29sZWFuIHJlZGVmaW5lKSB7CiAgICAgICAgX3JlZGVmaW5lID0gcmVkZWZp\nbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRo\nYXQgdGhpcyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVl\nbgogICAgICogcmVkZWZpbmVkLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAu\nMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FscmVhZHlSZWRlZmlu\nZWQoKSB7CiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlSZWRlZmluZWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhp\ncyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAg\nICogc3ViY2xhc3NlZCBpbiB0aGlzIGluc3RhbmNlJ3MgZW52aXJvbm1lbnQg\nY2xhc3Nsb2FkZXIuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQWxyZWFkeVN1YmNsYXNzZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlTdWJjbGFzc2VkOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG1h\na2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAgICog\nb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRDcmVhdGVTdWJjbGFzcygpIHsKICAgICAgICByZXR1cm4g\nX3N1YmNsYXNzOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUg\nZW5oYW5jZXIgc2hvdWxkIG1ha2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5j\nZS1jYXBhYmxlLAogICAgICogb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1j\nYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDcmVhdGVTdWJjbGFzcyhib29s\nZWFuIHN1YmNsYXNzKSB7CiAgICAgICAgX3N1YmNsYXNzID0gc3ViY2xhc3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYgdGhl\nIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQKICAg\nICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJlIHZp\nb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyByZXN0\ncmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucygpIHsKICAgICAgICByZXR1cm4gX2Zh\naWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYg\ndGhlIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQK\nICAgICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJl\nIHZpb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyBy\nZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyhib29sZWFuIGZhaWwpIHsKICAgICAg\nICBfZmFpbCA9IGZhaWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhdGVk\nIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAgICAgKiBv\ndmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBudWxsLgog\nICAgICovCiAgICBwdWJsaWMgRmlsZSBnZXREaXJlY3RvcnkoKSB7CiAgICAg\nICAgcmV0dXJuIF9kaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhZWQg\nYmVuZWF0aCB0aGlzIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8KICAgICAqIG92\nZXJ3cml0aW5nIHRoZSBleGlzdGluZyBjbGFzcyBmaWxlIGlmIG51bGwuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERpcmVjdG9yeShGaWxlIGRpcikg\newogICAgICAgIF9kaXIgPSBkaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGN1cnJlbnQge0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3\ncml0ZSB0byBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBC\neXRlY29kZVdyaXRlciBnZXRCeXRlY29kZVdyaXRlcigpIHsKICAgICAgICBy\nZXR1cm4gX3dyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\ne0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3cml0ZSB0aGUgYnl0ZWNvZGUg\ndG8gb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCeXRlY29kZVdyaXRlcihCeXRlY29kZVdyaXRlciB3cml0ZXIpIHsKICAg\nICAgICBfd3JpdGVyID0gd3JpdGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nUGVyZm9ybSBieXRlY29kZSBlbmhhbmNlbWVudHMuCiAgICAgKgogICAgICog\nQHJldHVybiA8Y29kZT5FTkhBTkNFXyo8L2NvZGU+IGNvbnN0YW50CiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgcnVuKCkgewogICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoImVuaGFuY2Utc3RhcnQiLCBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIG1hbmFnZWQgaW50\nZXJmYWNlLCBza2lwCiAgICAgICAgICAgIGlmIChfcGMuaXNJbnRlcmZhY2Uo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNFX0lOVEVSRkFDRTsK\nCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGFscmVhZHkgZW5oYW5jZWQKICAg\nICAgICAgICAgQ2xhc3NbXSBpbnRlcmZhY2VzID0gX21hbmFnZWRUeXBlLmdl\ndERlY2xhcmVkSW50ZXJmYWNlVHlwZXMoKTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBpbnRlcmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoaW50ZXJmYWNlc1tpXS5nZXROYW1lKCkuZXF1YWxz\nKFBDVFlQRS5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgX2xvZy50cmFjZShfbG9jLmdldCgicGMtdHlwZSIsIF9tYW5hZ2VkVHlw\nZS5nZXRUeXBlKCkpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRU5I\nQU5DRV9OT05FOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBjb25maWd1cmVCQ3MoKTsKCiAgICAgICAgICAgIC8vIHZh\nbGlkYXRlIHByb3BlcnRpZXMgYmVmb3JlIHJlcGxhY2luZyBmaWVsZCBhY2Nl\nc3Mgc28gdGhhdAogICAgICAgICAgICAvLyB3ZSBidWlsZCB1cCBhIHJlY29y\nZCBvZiBiYWNraW5nIGZpZWxkcywgZXRjCiAgICAgICAgICAgIGlmIChfbWV0\nYSAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkpIHsKICAg\nICAgICAgICAgICAgIHZhbGlkYXRlUHJvcGVydGllcygpOwogICAgICAgICAg\nICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAgICAg\nICAgICAgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24oKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcygp\nOwogICAgICAgICAgICBwcm9jZXNzVmlvbGF0aW9ucygpOwoKICAgICAgICAg\nICAgaWYgKF9tZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGVuaGFu\nY2VDbGFzcygpOwogICAgICAgICAgICAgICAgYWRkRmllbGRzKCk7CiAgICAg\nICAgICAgICAgICBhZGRTdGF0aWNJbml0aWFsaXplcigpOwogICAgICAgICAg\nICAgICAgYWRkUENNZXRob2RzKCk7CiAgICAgICAgICAgICAgICBhZGRBY2Nl\nc3NvcnMoKTsKICAgICAgICAgICAgICAgIGFkZEF0dGFjaERldGFjaENvZGUo\nKTsKICAgICAgICAgICAgICAgIGFkZFNlcmlhbGl6YXRpb25Db2RlKCk7CiAg\nICAgICAgICAgICAgICBhZGRDbG9uaW5nQ29kZSgpOwogICAgICAgICAgICAg\nICAgcnVuQXV4aWxpYXJ5RW5oYW5jZXJzKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gRU5IQU5DRV9QQzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJwZXJzLWF3YXJlIiwgX21hbmFnZWRUeXBlLmdl\ndFR5cGUoKSkpOwogICAgICAgICAgICByZXR1cm4gRU5IQU5DRV9BV0FSRTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlbmhhbmNlLWVycm9yIiwKICAgICAgICAgICAgICAgIF9tYW5h\nZ2VkVHlwZS5nZXRUeXBlKCkuZ2V0TmFtZSgpLCBlLmdldE1lc3NhZ2UoKSks\nIGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY29uZmln\ndXJlQkNzKCkgewogICAgICAgIGlmICghX2Jjc0NvbmZpZ3VyZWQpIHsKICAg\nICAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAgICAg\nIGlmIChfbWFuYWdlZFR5cGUuZ2V0QXR0cmlidXRlKFJFREVGSU5FRF9BVFRS\nSUJVVEUpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX21hbmFnZWRU\neXBlLmFkZEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRFKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfaXNBbHJlYWR5\nUmVkZWZpbmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAgIFBD\nU3ViY2xhc3NWYWxpZGF0b3IgdmFsID0gbmV3IFBDU3ViY2xhc3NWYWxpZGF0\nb3IoCiAgICAgICAgICAgICAgICAgICAgX21ldGEsIF9tYW5hZ2VkVHlwZSwg\nX2xvZywgX2ZhaWwpOwogICAgICAgICAgICAgICAgdmFsLmFzc2VydENhblN1\nYmNsYXNzKCk7CgogICAgICAgICAgICAgICAgX3BjID0gX21hbmFnZWRUeXBl\nLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoCiAgICAgICAgICAgICAgICAgICAg\ndG9QQ1N1YmNsYXNzTmFtZShfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7CiAg\nICAgICAgICAgICAgICBpZiAoX3BjLmdldFN1cGVyY2xhc3NCQygpICE9IF9t\nYW5hZ2VkVHlwZSkgewogICAgICAgICAgICAgICAgICAgIF9wYy5zZXRTdXBl\ncmNsYXNzKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgX3Bj\nLnNldEFic3RyYWN0KF9tYW5hZ2VkVHlwZS5pc0Fic3RyYWN0KCkpOwogICAg\nICAgICAgICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKER5bmFtaWNQ\nZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBfaXNBbHJlYWR5U3ViY2xhc3Nl\nZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIF9iY3NDb25maWd1cmVkID0gdHJ1ZTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB0aGUgZ2VuZXJhdGVkIGJ5dGVj\nb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWNvcmQoKQogICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlw\nZSAhPSBfcGMgJiYgZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAgcmVjb3Jk\nKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgcmVjb3JkKF9wYyk7CiAgICAgICAg\naWYgKF9vaWRzICE9IG51bGwpCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX29pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICByZWNvcmQoKEJDQ2xhc3MpIGl0ci5uZXh0KCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIGdpdmVuIGNsYXNzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcmVjb3JkKEJDQ2xhc3MgYmMpCiAgICAg\nICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3dyaXRlciAh\nPSBudWxsKQogICAgICAgICAgICBfd3JpdGVyLndyaXRlKGJjKTsKICAgICAg\nICBlbHNlIGlmIChfZGlyID09IG51bGwpCiAgICAgICAgICAgIGJjLndyaXRl\nKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEZpbGUgZGlyID0gRmls\nZXMuZ2V0UGFja2FnZUZpbGUoX2RpciwgYmMuZ2V0UGFja2FnZU5hbWUoKSwg\ndHJ1ZSk7CiAgICAgICAgICAgIGJjLndyaXRlKG5ldyBGaWxlKGRpciwgYmMu\nZ2V0Q2xhc3NOYW1lKCkgKyAiLmNsYXNzIikpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIG1ldGhvZHMgaW4g\ndGhpcyBwcm9wZXJ0eS1hY2Nlc3MgaW5zdGFuY2UgYXJlCiAgICAgKiB3cml0\ndGVuIGNvcnJlY3RseS4gVGhpcyBtZXRob2QgYWxzbyBnYXRoZXJzIGluZm9y\nbWF0aW9uIG9uIGVhY2gKICAgICAqIHByb3BlcnR5J3MgYmFja2luZyBmaWVs\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlUHJvcGVydGll\ncygpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kczsKICAgICAgICBp\nZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAgZm1kcyA9IF9t\nZXRhLmdldEZpZWxkcygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZm1k\ncyA9IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgTWV0aG9k\nIG1ldGg7CiAgICAgICAgQkNNZXRob2QgZ2V0dGVyLCBzZXR0ZXI7CiAgICAg\nICAgQkNGaWVsZCByZXR1cm5lZCwgYXNzaWduZWQgPSBudWxsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoIShmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKSBpbnN0\nYW5jZW9mIE1ldGhvZCkpIHsKICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlv\nbigicHJvcGVydHktYmFkLW1lbWJlciIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdeyBmbWRzW2ldLCBmbWRzW2ldLmdldEJhY2tpbmdNZW1i\nZXIoKSB9LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1l\ndGggPSAoTWV0aG9kKSBmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKTsKICAg\nICAgICAgICAgLy8gIyMjIyMgdGhpcyB3aWxsIGZhaWwgaWYgd2Ugb3ZlcnJp\nZGUgYW5kIGRvbid0IGNhbGwgc3VwZXIuCiAgICAgICAgICAgIEJDQ2xhc3Mg\nZGVjbGFyaW5nVHlwZSA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkKICAg\nICAgICAgICAgICAgIC5sb2FkQ2xhc3MoZm1kc1tpXS5nZXREZWNsYXJpbmdU\neXBlKCkpOwogICAgICAgICAgICBnZXR0ZXIgPSBkZWNsYXJpbmdUeXBlLmdl\ndERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICAgICAgaWYg\nKGdldHRlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBhZGRWaW9sYXRp\nb24oInByb3BlcnR5LW5vLWdldHRlciIsIG5ldyBPYmplY3RbXXsgZm1kc1tp\nXSB9LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nZWQgPSBnZXRSZXR1cm5lZEZpZWxkKGdldHRlcik7CiAgICAgICAgICAgIGlm\nIChyZXR1cm5lZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcmVnaXN0ZXJC\nYWNraW5nRmllbGRJbmZvKGZtZHNbaV0sIGdldHRlciwgcmV0dXJuZWQpOwoK\nICAgICAgICAgICAgc2V0dGVyID0gZGVjbGFyaW5nVHlwZS5nZXREZWNsYXJl\nZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNbaV0pLAogICAgICAgICAgICAg\nICAgbmV3IENsYXNzW117IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkgfSk7\nCiAgICAgICAgICAgIGlmIChzZXR0ZXIgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgaWYgKHJldHVybmVkID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LW5vLXNldHRlciIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1kc1tpXSB9LCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBjcmVhdGUgc3ludGhldGljIHNldHRlcgogICAgICAg\nICAgICAgICAgICAgIHNldHRlciA9IF9tYW5hZ2VkVHlwZS5kZWNsYXJlTWV0\naG9kKGdldFNldHRlck5hbWUoZm1kc1tpXSksCiAgICAgICAgICAgICAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICAgICAgICAgIHNldHRlci5t\nYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICAgICAgICAgIENvZGUgY29kZSA9\nIHNldHRlci5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS54bG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUucHV0ZmllbGQoKS5zZXRGaWVsZChyZXR1cm5lZCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGFzc2lnbmVkID0gZ2V0QXNzaWduZWRGaWVs\nZChzZXR0ZXIpOwoKICAgICAgICAgICAgaWYgKGFzc2lnbmVkICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICByZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oZm1kc1tp\nXSwgc2V0dGVyLCBhc3NpZ25lZCk7CgogICAgICAgICAgICAgICAgaWYgKGFz\nc2lnbmVkICE9IHJldHVybmVkKQogICAgICAgICAgICAgICAgICAgIGFkZFZp\nb2xhdGlvbigicHJvcGVydHktc2V0dGVyLWdldHRlci1taXNtYXRjaCIsIG5l\ndyBPYmplY3RbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGZtZHNbaV0s\nIGFzc2lnbmVkLmdldE5hbWUoKSwgKHJldHVybmVkID09IG51bGwpIAogICAg\nICAgICAgICAgICAgICAgICAgICA/IG51bGwgOiByZXR1cm5lZC5nZXROYW1l\nKCkgfSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgdm9pZCByZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oRmll\nbGRNZXRhRGF0YSBmbWQsIEJDTWV0aG9kIG1ldGhvZCwKICAgICAgICBCQ0Zp\nZWxkIGZpZWxkKSB7CiAgICAgICAgaWYgKF9iYWNraW5nRmllbGRzID09IG51\nbGwpCiAgICAgICAgICAgIF9iYWNraW5nRmllbGRzID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICBfYmFja2luZ0ZpZWxkcy5wdXQobWV0aG9kLmdldE5hbWUo\nKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAgaWYgKF9hdHRyc1RvRmll\nbGRzID09IG51bGwpCiAgICAgICAgICAgIF9hdHRyc1RvRmllbGRzID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBfYXR0cnNUb0ZpZWxkcy5wdXQoZm1kLmdl\ndE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAgaWYgKF9maWVs\nZHNUb0F0dHJzID09IG51bGwpCiAgICAgICAgICAgIF9maWVsZHNUb0F0dHJz\nID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfZmllbGRzVG9BdHRycy5wdXQo\nZmllbGQuZ2V0TmFtZSgpLCBmbWQuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24oKSB7CiAgICAg\nICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoQXR0cmlidXRlVHJhbnNsYXRvci5j\nbGFzcyk7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgIkF0dHJpYnV0ZUluZGV4VG9GaWVsZE5hbWUiLAogICAg\nICAgICAgICBTdHJpbmcuY2xhc3MsIG5ldyBDbGFzc1tdIHsgaW50LmNsYXNz\nIH0pOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CgogICAgICAg\nIC8vIHN3aXRjaCAodmFsKQogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9\nIGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICB0YWJpbnMuc2V0TG93KDAp\nOwogICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7Cgog\nICAgICAgIC8vIGNhc2UgaToKICAgICAgICAvLyAgICAgcmV0dXJuIDxfYXR0\ncnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5nZXROYW1lKCkpPgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICB0YWJpbnMuYWRkVGFyZ2V0KGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgKICAgICAgICAgICAgICAgIF9hdHRyc1RvRmllbGRzLmdldChmbWRzW2ld\nLmdldE5hbWUoKSkpKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgdGFiaW5zLnNldERlZmF1\nbHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgKGNvZGUsIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nbmFtZSBvZiB0aGUgc2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxk\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgZ2V0U2V0dGVy\nTmFtZShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHJldHVybiAic2V0\nIiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kLmdldE5hbWUoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZpZWxkIHJldHVybmVk\nIGJ5IHRoZSBnaXZlbiBtZXRob2QsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nIFBhY2thZ2UtcHJvdGVjdGVkIGFuZCBzdGF0aWMgZm9yIHRlc3RpbmcuCiAg\nICAgKi8KICAgIHN0YXRpYyBCQ0ZpZWxkIGdldFJldHVybmVkRmllbGQoQkNN\nZXRob2QgbWV0aCkgewogICAgICAgIHJldHVybiBmaW5kRmllbGQobWV0aCwg\nKChDb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKSkueHJldHVy\nbigpCiAgICAgICAgICAgIC5zZXRUeXBlKG1ldGguZ2V0UmV0dXJuVHlwZSgp\nKSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBm\naWVsZCBhc3NpZ25lZCBpbiB0aGUgZ2l2ZW4gbWV0aG9kLCBvciBudWxsIGlm\nIG5vbmUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBhbmQgc3RhdGljIGZv\nciB0ZXN0aW5nLgogICAgICovCiAgICBzdGF0aWMgQkNGaWVsZCBnZXRBc3Np\nZ25lZEZpZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gZmlu\nZEZpZWxkKG1ldGgsICgoQ29kZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rp\nb24oKSkpLnB1dGZpZWxkKCksIHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBmaWVsZCByZXR1cm5lZCAvIGFzc2lnbmVkIGJ5IDxj\nb2RlPm1ldGg8L2NvZGU+LiBSZXR1cm5zCiAgICAgKiBudWxsIGlmIG5vbi1m\naWVsZHMgKG1ldGhvZHMsIGxpdGVyYWxzLCBwYXJhbWV0ZXJzLCB2YXJpYWJs\nZXMpIGFyZQogICAgICogcmV0dXJuZWQsIG9yIGlmIG5vbi1wYXJhbWV0ZXJz\nIGFyZSBhc3NpZ25lZCB0byBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIEJDRmllbGQgZmluZEZpZWxkKEJDTWV0aG9kIG1ldGgsIEluc3Ry\ndWN0aW9uIHRlbXBsYXRlLAogICAgICAgIGJvb2xlYW4gZmluZEFjY2Vzc2Vk\nKSB7CiAgICAgICAgLy8gaWdub3JlIGFueSBzdGF0aWMgbWV0aG9kcy4gT3Bl\nbkpQQSBvbmx5IGN1cnJlbnRseSBzdXBwb3J0cwogICAgICAgIC8vIG5vbi1z\ndGF0aWMgc2V0dGVycyBhbmQgZ2V0dGVycwogICAgICAgIGlmIChtZXRoLmlz\nU3RhdGljKCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRoLmdldENvZGUoZmFsc2UpOwogICAgICAgIGlmIChj\nb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgQkNGaWVsZCBmaWVsZCA9\nIG51bGwsIGN1cjsKICAgICAgICBJbnN0cnVjdGlvbiB0ZW1wbGF0ZUlucywg\ncHJldklucywgZWFybGllckluczsKICAgICAgICB3aGlsZSAoY29kZS5zZWFy\nY2hGb3J3YXJkKHRlbXBsYXRlKSkgewogICAgICAgICAgICBpbnQgYmFja3Vw\nQ291bnQgPSAzOwogICAgICAgICAgICB0ZW1wbGF0ZUlucyA9IGNvZGUucHJl\ndmlvdXMoKTsKICAgICAgICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcHJl\ndklucyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAgICAgIGlmIChwcmV2\nSW5zIGluc3RhbmNlb2YgQ2xhc3NJbnN0cnVjdGlvbgogICAgICAgICAgICAg\nICAgJiYgY29kZS5oYXNQcmV2aW91cygpKSB7CiAgICAgICAgICAgICAgICBw\ncmV2SW5zID0gY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICAgICAgYmFj\na3VwQ291bnQrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFj\nb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgZWFybGllcklucyA9IGNvZGUucHJldmlvdXMoKTsK\nCiAgICAgICAgICAgIC8vIGlmIHRoZSBvcGNvZGUgdHdvIGJlZm9yZSB0aGUg\ndGVtcGxhdGUgd2FzIGFuIGFsb2FkXzAsIGNoZWNrCiAgICAgICAgICAgIC8v\nIGFnYWluc3QgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiBiYXNlZCBvbiB3aGF0\nIHR5cGUgb2YgZmluZAogICAgICAgICAgICAvLyB3ZSdyZSBkb2luZwogICAg\nICAgICAgICBpZiAoIShlYXJsaWVySW5zIGluc3RhbmNlb2YgTG9hZEluc3Ry\ndWN0aW9uKQogICAgICAgICAgICAgICAgfHwgISgoTG9hZEluc3RydWN0aW9u\nKSBlYXJsaWVySW5zKS5pc1RoaXMoKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG1pZGRsZSBpbnN0cnVj\ndGlvbiB3YXMgYSBnZXRmaWVsZCwgdGhlbiBpdCdzIHRoZQogICAgICAgICAg\nICAvLyBmaWVsZCB0aGF0J3MgYmVpbmcgYWNjZXNzZWQKICAgICAgICAgICAg\naWYgKCFmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0YW5jZW9mIEdldEZp\nZWxkSW5zdHJ1Y3Rpb24pIHsKICAgICAgICAgICAgICAgIGZpbmFsIEZpZWxk\nSW5zdHJ1Y3Rpb24gZlByZXZJbnMgPSAoRmllbGRJbnN0cnVjdGlvbikgcHJl\ndkluczsKICAgICAgICAgICAgICAgIGN1ciA9IChCQ0ZpZWxkKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXRGaWVsZEluc3RydWN0aW9uRmllbGRBY3Rpb24o\nZlByZXZJbnMpKTsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBtaWRkbGUg\naW5zdHJ1Y3Rpb24gd2FzIGFuIHhsb2FkXzEsIHRoZW4gdGhlCiAgICAgICAg\nICAgICAgICAvLyBtYXRjaGVkIGluc3RydWN0aW9uIGlzIHRoZSBmaWVsZCB0\naGF0J3MgYmVpbmcgc2V0LgogICAgICAgICAgICB9IGVsc2UgaWYgKGZpbmRB\nY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3RhbmNlb2YgTG9hZEluc3RydWN0aW9u\nCiAgICAgICAgICAgICAgICAmJiAoKExvYWRJbnN0cnVjdGlvbikgcHJldklu\ncykuZ2V0UGFyYW0oKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBG\naWVsZEluc3RydWN0aW9uIGZUZW1wbGF0ZUlucyA9CiAgICAgICAgICAgICAg\nICAgICAgKEZpZWxkSW5zdHJ1Y3Rpb24pIHRlbXBsYXRlSW5zOwogICAgICAg\nICAgICAgICAgY3VyID0gKEJDRmllbGQpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAgICAg\nLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVsZEFjdGlvbihmVGVtcGxhdGVJbnMp\nKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgICAgIGlmIChmaWVsZCAhPSBudWxsICYmIGN1ciAh\nPSBmaWVsZCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nICAgICBmaWVsZCA9IGN1cjsKCiAgICAgICAgICAgIC8vIHJlYWR5IGZvciBu\nZXh0IHNlYXJjaCBpdGVyYXRpb24KICAgICAgICAgICAgd2hpbGUgKGJhY2t1\ncENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBiYWNrdXBDb3VudC0tOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBmaWVsZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlY29yZCBhIHZpb2xhdGlvbiBvZiB0aGUgcHJvcGVydHkgYWNj\nZXNzIHJlc3RyaWN0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZFZpb2xhdGlvbihTdHJpbmcga2V5LCBPYmplY3RbXSBhcmdzLCBib29sZWFu\nIGZhdGFsKSB7CiAgICAgICAgaWYgKF92aW9sYXRpb25zID09IG51bGwpCiAg\nICAgICAgICAgIF92aW9sYXRpb25zID0gbmV3IEhhc2hTZXQoKTsKICAgICAg\nICBfdmlvbGF0aW9ucy5hZGQoX2xvYy5nZXQoa2V5LCBhcmdzKSk7CiAgICAg\nICAgX2ZhaWwgfD0gZmF0YWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2cg\nLyB0aHJvdyByZWNvcmRlZCBwcm9wZXJ0eSBhY2Nlc3MgdmlvbGF0aW9ucy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb2Nlc3NWaW9sYXRpb25zKCkg\newogICAgICAgIGlmIChfdmlvbGF0aW9ucyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIFN0cmluZyBzZXAgPSBKMkRvUHJpdkhlbHBl\nci5nZXRMaW5lU2VwYXJhdG9yKCk7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF92aW9sYXRpb25zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoaXRyLm5leHQoKSk7CiAgICAg\nICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChzZXApOwogICAgICAgIH0KICAgICAgICBNZXNzYWdlIG1zZyA9\nIF9sb2MuZ2V0KCJwcm9wZXJ0eS12aW9sYXRpb25zIiwgYnVmKTsKCiAgICAg\nICAgaWYgKF9mYWlsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihtc2cpOwogICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkK\nICAgICAgICAgICAgX2xvZy53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXBsYWNlZCBhbGwgZGlyZWN0IGFjY2VzcyB0byBtYW5hZ2VkIGZp\nZWxkcyB3aXRoIHRoZSBhcHByb3ByaWF0ZQogICAgICogcGNHZXQvcGNTZXQg\nbWV0aG9kLiBOb3RlIHRoYXQgdGhpcyBpbmNsdWRlcyBhY2Nlc3MgdG8gZmll\nbGRzCiAgICAgKiBvd25lZCBieSBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3Nl\ncyBvdGhlciB0aGFuIHRoaXMgb25lLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKSB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBjcmVhdGUgdGVtcGxh\ndGUgcHV0ZmllbGQvZ2V0ZmllbGQgaW5zdHJ1Y3Rpb25zIHRvIHNlYXJjaCBm\nb3IKICAgICAgICBDb2RlIHRlbXBsYXRlID0gKENvZGUpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5uZXdDb2RlQWN0aW9uKCkpOwogICAgICAgIEluc3RydWN0aW9uIHB1dCA9\nIHRlbXBsYXRlLnB1dGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1Y3Rpb24gZ2V0\nID0gdGVtcGxhdGUuZ2V0ZmllbGQoKTsKICAgICAgICBJbnN0cnVjdGlvbiBz\ndGF0ID0gdGVtcGxhdGUuaW52b2tlc3RhdGljKCk7CgogICAgICAgIC8vIGxv\nb2sgdGhyb3VnaCBhbGwgbWV0aG9kczsgdGhpcyBpcyBkb25lIGJlZm9yZSBh\nbnkgbWV0aG9kcyBhcmUgYWRkZWQKICAgICAgICAvLyBzbyB3ZSBkb24ndCBu\nZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBzeW50aGV0aWMgbWV0aG9k\ncy4KICAgICAgICBCQ01ldGhvZFtdIG1ldGhvZHMgPSBfbWFuYWdlZFR5cGUu\nZ2V0RGVjbGFyZWRNZXRob2RzKCk7CiAgICAgICAgQ29kZSBjb2RlOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBjb2RlID0gbWV0aG9kc1tpXS5nZXRDb2RlKGZhbHNl\nKTsKCiAgICAgICAgICAgIC8vIGRvbid0IG1vZGlmeSB0aGUgbWV0aG9kcyBz\ncGVjaWZpZWQgYnkgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMKICAgICAgICAg\nICAgaWYgKGNvZGUgIT0gbnVsbCAmJiAhc2tpcEVuaGFuY2UobWV0aG9kc1tp\nXSkpIHsKICAgICAgICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxk\nQWNjZXNzKGNvZGUsIGdldCwgdHJ1ZSwgc3RhdCk7CiAgICAgICAgICAgICAg\nICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBwdXQsIGZh\nbHNlLCBzdGF0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJlcGxhY2VzIGFsbCBpbnN0cnVjdGlvbnMgbWF0Y2hp\nbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGluIHRoZSBnaXZlbgogICAgICogY29k\nZSBibG9jayB3aXRoIGNhbGxzIHRvIHRoZSBhcHByb3ByaWF0ZSBnZW5lcmF0\nZWQgZ2V0dGVyL3NldHRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gY29kZSB0\naGUgY29kZSBibG9jayB0byBtb2RpZnk7IHRoZSBjb2RlIGl0ZXJhdG9yIHdp\nbGwKICAgICAqIGJlIHBsYWNlZCBiZWZvcmUgdGhlIGZpcnN0IGluc3RydWN0\naW9uIG9uIG1ldGhvZCBzdGFydCwKICAgICAqIGFuZCB3aWxsIGJlIGFmdGVy\nIHRoZSBsYXN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBjb21wbGV0aW9uCiAg\nICAgKiBAcGFyYW0gaW5zIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlvbiB0byBz\nZWFyY2ggZm9yOyBlaXRoZXIgYQogICAgICogZ2V0ZmllbGQgb3IgcHV0Zmll\nbGQgaW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBnZXQgYm9vbGVhbiBpbmRp\nY2F0aW5nIGlmIHRoaXMgaXMgYSBnZXQgaW5zdHJ1Y3Rpb24KICAgICAqIEBw\nYXJhbSBzdGF0IHRlbXBsYXRlIGludm9rZXN0YXRpYyBpbnN0cnVjdGlvbiB0\nbyByZXBsYWNlIHdpdGgKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxh\nY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKENvZGUgY29kZSwgSW5zdHJ1Y3Rp\nb24gaW5zLAogICAgICAgIGJvb2xlYW4gZ2V0LCBJbnN0cnVjdGlvbiBzdGF0\nKSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBjb2Rl\nLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIEZpZWxkSW5zdHJ1Y3Rpb24gZmk7\nCiAgICAgICAgTWV0aG9kSW5zdHJ1Y3Rpb24gbWk7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBvd25lcjsKICAgICAgICBTdHJpbmcgbmFtZSwgdHlwZU5hbWUs\nIG1ldGhvZE5hbWU7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2Fy\nZChpbnMpKSB7CiAgICAgICAgICAgIC8vIGJhY2sgdXAgdG8gdGhlIG1hdGNo\nZWQgaW5zdHJ1Y3Rpb24KICAgICAgICAgICAgZmkgPSAoRmllbGRJbnN0cnVj\ndGlvbikgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICBuYW1lID0gZmku\nZ2V0RmllbGROYW1lKCk7CiAgICAgICAgICAgIHR5cGVOYW1lID0gZmkuZ2V0\nRmllbGRUeXBlTmFtZSgpOwogICAgICAgICAgICBvd25lciA9IGdldFBlcnNp\nc3RlbmNlQ2FwYWJsZU93bmVyKG5hbWUsIGZpLmdldEZpZWxkRGVjbGFyZXJU\neXBlKCkpOwoKICAgICAgICAgICAgaWYgKG93bmVyICE9IG51bGwKICAgICAg\nICAgICAgICAgICYmIG93bmVyLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkgewogICAgICAgICAgICAgICAgLy8g\naWYgd2UncmUgZGlyZWN0bHkgYWNjZXNzaW5nIGEgZmllbGQgaW4gYW5vdGhl\nciBjbGFzcwogICAgICAgICAgICAgICAgLy8gaGllcmFyY2h5IHRoYXQgdXNl\ncyBwcm9wZXJ0eSBhY2Nlc3MsIHNvbWV0aGluZyBpcyB3cm9uZwogICAgICAg\nICAgICAgICAgaWYgKG93bmVyICE9IF9tZXRhICYmIG93bmVyLmdldERlY2xh\ncmVkRmllbGQobmFtZSkgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAg\nIF9tZXRhICE9IG51bGwgJiYgIW93bmVyLmdldERlc2NyaWJlZFR5cGUoKQog\nICAgICAgICAgICAgICAgICAgICAgICAuaXNBc3NpZ25hYmxlRnJvbShfbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwcm9wZXJ0eS1maWVs\nZC1hY2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IF9tZXRhLCBvd25lciwgbmFtZSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpIH0pKTsKCiAgICAg\nICAgICAgICAgICAvLyBpZiB3ZSdyZSBkaXJlY3RseSBhY2Nlc3NpbmcgYSBw\ncm9wZXJ0eS1iYWNraW5nIGZpZWxkIG91dHNpZGUKICAgICAgICAgICAgICAg\nIC8vIHRoZSBwcm9wZXJ0eSBpbiBvdXIgb3duIGNsYXNzLCBub3RpZnkgdXNl\ncgogICAgICAgICAgICAgICAgaWYgKGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVy\nUHJvcGVydHkobmFtZSwgY29kZSkpCiAgICAgICAgICAgICAgICAgICAgYWRk\nVmlvbGF0aW9uKCJwcm9wZXJ0eS1maWVsZC1hY2Nlc3MiLCBuZXcgT2JqZWN0\nW117IF9tZXRhLAogICAgICAgICAgICAgICAgICAgICAgICBvd25lciwgbmFt\nZSwgY29kZS5nZXRNZXRob2QoKS5nZXROYW1lKCkgfSwgZmFsc2UpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAob3duZXIgPT0gbnVsbCB8fAog\nICAgICAgICAgICAgICAgb3duZXIuZ2V0RGVjbGFyZWRGaWVsZChmcm9tQmFj\na2luZ0ZpZWxkTmFtZShuYW1lKSkgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgLy8gbm90IHBlcnNpc3RlbnQgZmllbGQ/CiAgICAgICAgICAgICAgICBj\nb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKCFnZXRSZWRlZmluZSgpICYmICFnZXRDcmVhdGVT\ndWJjbGFzcygpCiAgICAgICAgICAgICAgICAmJiBvd25lci5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAg\nICAgICAgICAgIC8vIHJlcGxhY2UgdGhlIGluc3RydWN0aW9uIHdpdGggYSBj\nYWxsIHRvIHRoZSBnZW5lcmF0ZWQgYWNjZXNzCiAgICAgICAgICAgICAgICAv\nLyBtZXRob2QKICAgICAgICAgICAgICAgIG1pID0gKE1ldGhvZEluc3RydWN0\naW9uKSBjb2RlLnNldChzdGF0KTsKCiAgICAgICAgICAgICAgICAvLyBpbnZv\na2UgdGhlIHByb3BlciBhY2Nlc3MgbWV0aG9kLCB3aGV0aGVyIGdldHRlciBv\nciBzZXR0ZXIKICAgICAgICAgICAgICAgIFN0cmluZyBwcmVmaXggPSAoZ2V0\nKSA/IFBSRSArICJHZXQiIDogUFJFICsgIlNldCI7CiAgICAgICAgICAgICAg\nICBtZXRob2ROYW1lID0gcHJlZml4ICsgbmFtZTsKICAgICAgICAgICAgICAg\nIGlmIChnZXQpIHsKICAgICAgICAgICAgICAgICAgICBtaS5zZXRNZXRob2Qo\nZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAg\nICAgICBtZXRob2ROYW1lLCB0eXBlTmFtZSwgbmV3IFN0cmluZ1tdCiAgICAg\nICAgICAgICAgICAgICAgICAgIHsgZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgp\nIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBtaS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lLCAidm9pZCIsIG5l\ndyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGdldFR5cGUo\nb3duZXIpLmdldE5hbWUoKSwgdHlwZU5hbWUgfSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAgICBu\nYW1lID0gZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSk7CiAgICAgICAgICAg\nICAgICBpZiAoZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgYWRkTm90aWZ5\nQWNjZXNzKGNvZGUsIG93bmVyLmdldEZpZWxkKG5hbWUpKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0IHRoZSBzZXQgb3Bl\ncmF0aW9ucyBhZnRlciB0aGUgZmllbGQgbXV0YXRpb24sIGJ1dAogICAgICAg\nICAgICAgICAgICAgIC8vIGZpcnN0IGxvYWQgdGhlIG9sZCB2YWx1ZSBmb3Ig\ndXNlIGluIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIFN0YXRlTWFuYWdl\nci5zZXR0aW5nWFhYIG1ldGhvZC4KICAgICAgICAgICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAg\nICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZGaSA9IGZpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZCgKICAgICAg\nICAgICAgICAgICAgICAgICAgKEJDRmllbGQpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuZ2V0RmllbGRJbnN0cnVjdGlvbkZpZWxkQWN0aW9uKGZG\naSkpKTsKICAgICAgICAgICAgICAgICAgICBpbnQgdmFsID0gY29kZS5nZXRO\nZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLnhz\ndG9yZSgpLnNldExvY2FsKHZhbCkuc2V0VHlwZShmaS5nZXRGaWVsZFR5cGUo\nKSk7CgogICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgcGFzdCB0aGUgcHV0\nZmllbGQKICAgICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAg\nICAgICAgICAgICAgICBhZGROb3RpZnlNdXRhdGlvbihjb2RlLCBvd25lci5n\nZXRGaWVsZChuYW1lKSwgdmFsLCAtMSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2RlLm5leHQo\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGROb3Rp\nZnlBY2Nlc3MoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAg\nICAgIC8vIFBDSGVscGVyLmFjY2Vzc2luZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0\nZS1pbmRleD4pOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWRl\nZmluaXRpb25IZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICJhY2Nlc3NpbmdG\naWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsg\nT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MgfSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGlzIG11c3QgYmUgY2FsbGVkIGFmdGVyIHNldHRpbmcgdGhlIHZh\nbHVlIGluIHRoZSBvYmplY3QuCiAgICAgKiAKICAgICAqIEBwYXJhbSBjb2Rl\nCiAgICAgKiBAcGFyYW0gdmFsIHRoZSBwb3NpdGlvbiBpbiB0aGUgbG9jYWwg\ndmFyaWFibGUgdGFibGUgd2hlcmUgdGhlCiAgICAgKiBvbGQgdmFsdWUgaXMg\nc3RvcmVkCiAgICAgKiBAcGFyYW0gcGFyYW0gdGhlIHBhcmFtZXRlciBwb3Np\ndGlvbiBjb250YWluaW5nIHRoZSBuZXcgdmFsdWUsIG9yCiAgICAgKiAtMSBp\nZiB0aGUgbmV3IHZhbHVlIGlzIHVuYXZhaWxhYmxlIGFuZCBzaG91bGQgdGhl\ncmVmb3JlIGJlIGxvb2tlZAogICAgICogdXAuCiAgICAgKiBAdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkTm90aWZ5TXV0YXRpb24oQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZt\nZCwgaW50IHZhbCwKICAgICAgICBpbnQgcGFyYW0pCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gUENIZWxwZXIu\nc2V0dGluZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0ZS1pbmRleD4sIG9sZCwgbmV3\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAg\nICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAg\nICAvLyB3ZSBvbmx5IGhhdmUgc3BlY2lhbCBzaWduYXR1cmVzIGZvciBwcmlt\naXRpdmVzIGFuZCBTdHJpbmdzCiAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0\naXZlKCkgJiYgdHlwZSAhPSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgIHR5\ncGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS54bG9hZCgpLnNldExv\nY2FsKHZhbCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAocGFyYW0gPT0g\nLTEpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29k\nZSwgZm1kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2RlLnhs\nb2FkKCkuc2V0UGFyYW0ocGFyYW0pLnNldFR5cGUodHlwZSk7CiAgICAgICAg\nfQogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZGVm\naW5pdGlvbkhlbHBlci5jbGFzcywgInNldHRpbmdGaWVsZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAg\nIE9iamVjdC5jbGFzcywgaW50LmNsYXNzLCB0eXBlLCB0eXBlCiAgICAgICAg\nfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUg\nZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNzZXMgYSBmaWVsZCB0aGF0IGlzIGEg\nYmFja2luZwogICAgICogZmllbGQgb2YgYW5vdGhlciBwcm9wZXJ0eSBpbiB0\naGlzIHByb3BlcnR5LWFjY2VzcyBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJvcGVydHkoU3Ry\naW5nIG5hbWUsIENvZGUgY29kZSkgewogICAgICAgIFN0cmluZyBtZXRoTmFt\nZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpOwogICAgICAgIHJldHVy\nbiAhIjxpbml0PiIuZXF1YWxzKG1ldGhOYW1lKQogICAgICAgICAgICAmJiBf\nYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAgICAgICAgICAgICYmICFuYW1lLmVx\ndWFscyhfYmFja2luZ0ZpZWxkcy5nZXQobWV0aE5hbWUpKQogICAgICAgICAg\nICAmJiBfYmFja2luZ0ZpZWxkcy5jb250YWluc1ZhbHVlKG5hbWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhl\nIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3Mgb2YKICAgICAq\nIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGRO\nYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFtIG93bmVy\nIHRoZSBub21pbmFsIG93bmVyIG9mIHRoZSBmaWVsZAogICAgICogQHJldHVy\nbiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgdHlw\nZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0aGUgZmllbGQgKGFuZCB0aGVyZWZv\ncmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9kKSwgb3IgbnVsbCBpZiBub25lCiAg\nICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRQZXJzaXN0ZW5j\nZUNhcGFibGVPd25lcihTdHJpbmcgZmllbGROYW1lLAogICAgICAgIENsYXNz\nIG93bmVyKSB7CiAgICAgICAgLy8gZmluZCB0aGUgYWN0dWFsIGFuY2VzdG9y\nIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhlIGZpZWxkLCB0aGVuCiAgICAgICAg\nLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlzIHBlcnNpc3RlbnQsIGFuZCBpZiB0\naGUgZmllbGQgaXMgbWFuYWdlZAogICAgICAgIEZpZWxkIGYgPSBSZWZsZWN0\naW9uLmZpbmRGaWVsZChvd25lciwgZmllbGROYW1lLCBmYWxzZSk7CiAgICAg\nICAgaWYgKGYgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNlCiAgICAgICAgaWYgKF9tZXRh\nICE9IG51bGwgJiYgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJm\nYWNlKCkpCiAgICAgICAgICAgIHJldHVybiBfbWV0YTsKCiAgICAgICAgcmV0\ndXJuIF9yZXBvcy5nZXRNZXRhRGF0YShmLmdldERlY2xhcmluZ0NsYXNzKCks\nIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxs\nIHN5bnRoZXRpYyBtZXRob2RzIHRvIHRoZSBieXRlY29kZSBieSBkZWxlZ2F0\naW5nIHRvCiAgICAgKiB0aGUgdmFyaW91cyBhZGRYWFhNZXRob2RzICgpIGZ1\nbmN0aW9ucyBpbiB0aGlzIGNsYXNzLiBJbmNsdWRlcwogICAgICogYWxsIHN0\nYXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcy4KICAgICAqIE5vdGUgdGhhdCB0\naGUgJ3N0b2NrJyBtZXRob2RzIGxpa2UgPGNvZGU+cGNJc1RyYW5zYWN0aW9u\nYWw8L2NvZGU+LAogICAgICogPGNvZGU+cGNGZXRjaE9iamVjdElkPC9jb2Rl\nPiwgZXRjIGFyZSBkZWZpbmVkIG9ubHkgaW4gdGhlCiAgICAgKiBsZWFzdC1k\nZXJpdmVkIFBlcnNpc3RlbmNlQ2FwYWJsZSB0eXBlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkUENNZXRob2RzKCkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBhZGRDbGVhckZpZWxkc01l\ndGhvZCgpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKHRydWUpOwog\nICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAgICAgICBh\nZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhvZCgpOwogICAgICAgIGFkZFJlcGxh\nY2VGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRkUHJvdmlkZUZpZWxkc01l\ndGhvZHMoKTsKICAgICAgICBhZGRDb3B5RmllbGRzTWV0aG9kKCk7CgogICAg\nICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsIHx8IGdl\ndENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgYWRkU3RvY2tNZXRo\nb2RzKCk7CiAgICAgICAgICAgIGFkZEdldFZlcnNpb25NZXRob2QoKTsKICAg\nICAgICAgICAgYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1ldGhvZCgpOwoKICAg\nICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpICE9IENsYXNz\nTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAgICBhZGRO\nb09wQXBwbGljYXRpb25JZGVudGl0eU1ldGhvZHMoKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGFkZCB0aGUgYXBwIGlkIG1ldGhvZHMgdG8gZWFjaCBzdWJj\nbGFzcyByYXRoZXIKICAgICAgICAvLyB0aGFuIGp1c3QgdGhlIHN1cGVyY2xh\nc3MsIHNpbmNlIGl0IGlzIHBvc3NpYmxlIHRvIGhhdmUKICAgICAgICAvLyBh\nIHN1YmNsYXNzIHdpdGggYW4gYXBwIGlkIGhpZXJhcmNoeSB0aGF0IG1hdGNo\nZXMgdGhlCiAgICAgICAgLy8gcGVyc2lzdGVudCBjbGFzcyBpbmhlcml0YW5j\nZSBoaWVyYXJjaHkKICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTgogICAgICAgICAg\nICAmJiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRD\ncmVhdGVTdWJjbGFzcygpIHx8CiAgICAgICAgICAgICAgICBfbWV0YS5nZXRP\nYmplY3RJZFR5cGUoKSAhPQogICAgICAgICAgICAgICAgICAgIF9tZXRhLmdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0T2JqZWN0SWRUeXBlKCkpKSB7\nCiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElkTWV0aG9k\nKHRydWUpOwogICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzVG9PYmplY3RJ\nZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNG\ncm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7CiAgICAgICAgICAgIGFkZENvcHlL\nZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAgICAgICAg\nICBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKHRydWUpOwogICAgICAg\nICAgICBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBtZXRob2QgdG8g\nY2xlYXIgYWxsIHBlcnNpc3RlbnQgZmllbGRzOyB3ZSdsbCBjYWxsIHRoaXMg\nZnJvbQogICAgICogdGhlIG5ldyBpbnN0YW5jZSBtZXRob2QgdG8gZW5zdXJl\nIHRoYXQgdW5sb2FkZWQgZmllbGRzIGhhdmUKICAgICAqIGRlZmF1bHQgdmFs\ndWVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xlYXJGaWVsZHNN\nZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIC8vIHByb3RlY3RlZCB2b2lkIHBjQ2xlYXJGaWVsZHMgKCkK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBu\ndWxsKTsKICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAv\nLyBzdXBlci5wY0NsZWFyRmllbGRzICgpCiAgICAgICAgaWYgKF9tZXRhLmdl\ndFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNz\nKCkpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5\ncGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpKSwgUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywKICAg\nICAgICAgICAgICAgIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkgIT0g\nRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hB\nUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYWRkU2V0\nTWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9Cgog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNOZXdJ\nbnN0YW5jZTwvY29kZT4gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAq\nIFRoZXNlIG1ldGhvZHMgYXJlIHVzZWQgYnkgdGhlIGltcGwgaGVscGVyIHRv\nIGNyZWF0ZSBuZXcKICAgICAqIG1hbmFnZWQgaW5zdGFuY2VzIGVmZmljaWVu\ndGx5IHdpdGhvdXQgcmVmbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0g\nb2lkIHNldCB0byB0cnVlIHRvIG1pbWljIHRoZSBtZXRob2QgdmVyc2lvbiB0\naGF0IHRha2VzCiAgICAgKiBhbiBvaWQgdmFsdWUgYXMgd2VsbCBhcyBhIHN0\nYXRlIG1hbmFnZXIKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5ld0lu\nc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2lkKSB7CiAgICAgICAgLy8gcHVibGlj\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBwY05ld0luc3RhbmNlICguLi4pCiAgICAg\nICAgQ2xhc3NbXSBhcmdzID0KICAgICAgICAgICAgKG9pZCkgPyBuZXcgQ2xh\nc3NbXXsgU01UWVBFLCBPYmplY3QuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfQog\nICAgICAgICAgICAgICAgOiBuZXcgQ2xhc3NbXXsgU01UWVBFLCBib29sZWFu\nLmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIk5ld0luc3RhbmNlIiwgUENUWVBFLCBhcmdzKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgLy8gaWYgdGhlIHR5cGUgaXMgYWJzdHJhY3QsIHRocm93IGEgVXNl\nckV4Y2VwdGlvbgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKSB7CiAg\nICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIFVTRVJFWENFUCk7CiAg\nICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICAvLyBYWFggcGMgPSBuZXcgWFhYICgpOwogICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUoX3BjKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwg\ndm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IGluc3QgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0\nTG9jYWwoaW5zdCk7CgogICAgICAgIC8vIGlmIChjbGVhcikKICAgICAgICAv\nLyAgIHBjLnBjQ2xlYXJGaWVsZHMgKCk7CiAgICAgICAgY29kZS5pbG9hZCgp\nLnNldFBhcmFtKChvaWQpID8gMiA6IDEpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBub2NsZWFyID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNz\nLCBudWxsKTsKCiAgICAgICAgLy8gcGMucGNTdGF0ZU1hbmFnZXIgPSBzbTsK\nICAgICAgICBub2NsZWFyLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwoaW5zdCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCgogICAgICAgIC8vIGNvcHkga2V5IGZpZWxkcyBmcm9tIG9pZAogICAgICAg\nIGlmIChvaWQpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKGluc3QpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQ\nUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0p\nOwogICAgICAgIH0KCiAgICAgICAgLy8gcmV0dXJuIHBjOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wcm90ZWN0ZWQgc3RhdGljIGludCBw\nY0dldE1hbmFnZWRGaWVsZENvdW50ICgpPC9jb2RlPgogICAgICogbWV0aG9k\nIHRvIHRoZSBieXRlY29kZSwgcmV0dXJuaW5nIHRoZSBpbmhlcml0ZWQgZmll\nbGQgY291bnQgYWRkZWQKICAgICAqIHRvIHRoZSBudW1iZXIgb2YgbWFuYWdl\nZCBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgUGVyc2lzdGVuY2VDYXBhYmxlIGNs\nYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFuYWdlZEZpZWxk\nQ291bnRNZXRob2QoKSB7CiAgICAgICAgLy8gcHJvdGVjdGVkIHN0YXRpYyBp\nbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3VudCAoKQogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRNYW5hZ2Vk\nRmllbGRDb3VudCIsCiAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgbWV0aG9kLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBtZXRob2Qu\nbWFrZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyByZXR1cm4gPGZpZWxkcz4gKyBw\nY0luaGVyaXRlZEZpZWxkQ291bnQKICAgICAgICAvLyBhd2hpdGU6IHRoZSBh\nYm92ZSBzaG91bGQgd29yaywgYnV0IEknbSBzZWVpbmcgYSBtZXNzZWQgdXAg\nc2l0dWF0aW9uCiAgICAgICAgLy8gYWxsIG9mIGEgc3VkZGVuIHdoZXJlIHdo\nZW4gYSBzdWJjbGFzcyBjYWxscyB0aGlzIG1ldGhvZCwgaXQgc29tZWhvdwog\nICAgICAgIC8vIGhhcHBlbnMgYmVmb3JlIDxjbGluaXQ+IGlzIGV2ZXIgaW52\nb2tlZCwgYW5kIHNvIG91cgogICAgICAgIC8vIHBjSW5oZXJpdGVkRmllbGRD\nb3VudCBmaWVsZCBpc24ndCBpbml0aWFsaXplZCEgIHNvIGluc3RlYWQsCiAg\nICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgPHN1cGVyY2xhc3M+LnBjR2V0\nTWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKS5sZW5ndGgpOwog\nICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzIHN1cGVyQ2xhc3MgPSBnZXRUeXBlKF9tZXRh\nLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpOwogICAgICAgICAgICBTdHJp\nbmcgc3VwZXJOYW1lID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/CiAgICAgICAg\nICAgICAgICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoc3VwZXJDbGFz\ncykgOgogICAgICAgICAgICAgICAgc3VwZXJDbGFzcy5nZXROYW1lKCk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKHN1cGVy\nTmFtZSwKICAgICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmllbGRD\nb3VudCIsIGludC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAgICAg\nICBjb2RlLmlhZGQoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pcmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSNwY1Byb3ZpZGVGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsgUGVyc2lz\ndGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZpZWxkc30gbWV0aG9kcyB0byB0aGUg\nYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm92aWRl\nRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNQcm92aWRlRmll\nbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxkIiwgdm9p\nZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3aXRj\naCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0aG9k\nKFBSRSArICJQcm92aWRlRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8gaWYg\nbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRpb24K\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNs\nYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRh\nLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3\naXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsK\nICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFi\naW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIC8v\nIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5wcm92aWRlZDx0eXBlPkZpZWxk\nCiAgICAgICAgICAgIC8vICAgICAodGhpcywgZmllbGROdW1iZXIpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1k\nc1tpXSk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAgICAgICAg\nICAgICAgICAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgInByb3ZpZGVk\nIiwgZmFsc2UsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDog\ndGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAg\nICAgICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgog\nICAgICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbi5jbGFzcykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCgogICAgICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRo\nb2QpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBl\ncnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZH0gYW5kCiAgICAgKiB7\nQGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkc30gbWV0\naG9kcyB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQg\ncGNSZXBsYWNlRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVwbGFj\nZUZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117\nIGludC5jbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91\nZ2ggdGhlIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2lu\nU3dpdGNoTWV0aG9kKFBSRSArICJSZXBsYWNlRmllbGQiLCBjb2RlKTsKCiAg\nICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJv\ndyBleGNlcHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdl\ndENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAg\nICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYg\nKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9u\nKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAg\nICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAg\nICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFi\nbGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAg\nICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAg\nICAgICAgICAgIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNl\nPHR5cGU+RmllbGQKICAgICAgICAgICAgLy8gICh0aGlzLCBmaWVsZE51bWJl\ncik7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBhZGRTZXRN\nYW5hZ2VkVmFsdWVDb2RlIGNhbGwgYmVsb3cuCiAgICAgICAgICAgICAgICB0\nYWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpKTsKCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29k\nZS5pbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0\naG9kCiAgICAgICAgICAgICAgICAgICAgKGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlKCksICJyZXBsYWNlIiwgdHJ1ZSwgZmFsc2UpKTsKICAgICAgICAgICAg\nICAgIGlmICghZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKS5pc1ByaW1pdGl2\nZSgpKQogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAgICAgICAg\nICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwog\nICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAgdGFiaW5zLnNldERlZmF1\nbHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgICAgIChjb2Rl\nLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKICAgICAgICB9\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBhZGRNdWx0aXBs\nZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9kKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGND\nb3B5RmllbGRzfSBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkQ29weUZpZWxkc01ldGhvZCgpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVi\nbGljIHZvaWQgcGNDb3B5RmllbGQgKE9iamVjdCBwYywgaW50IGZpZWxkKQog\nICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJDb3B5RmllbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLmdldE5h\nbWUoKSwKICAgICAgICAgICAgbmV3IFN0cmluZ1tdeyBfbWFuYWdlZFR5cGUu\nZ2V0TmFtZSgpLCBpbnQuY2xhc3MuZ2V0TmFtZSgpIH0pOwogICAgICAgIG1l\ndGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZlcnl0aGlu\nZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVsTG9jYWwg\nPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAiQ29weUZpZWxkIiwgY29kZSk7\nCgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3Qg\ndGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAg\nICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAg\nIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvd0V4Y2Vw\ndGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAg\nICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAg\nICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2Rl\nLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7\nCiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7\nCgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBvdGhlci48\nZmllbGQ+OwogICAgICAgICAgICAgICAgLy8gb3Igc2V0PGZpZWxkPiAob3Ro\nZXIuZ2V0PGZpZWxkPik7CiAgICAgICAgICAgICAgICB0YWJpbnMuYWRkVGFy\nZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29k\nZShjb2RlLCBmbWRzW2ldKTsKCiAgICAgICAgICAgICAgICAvLyBicmVhazsK\nICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgICAgIHRhYmlucy5zZXREZWZh\ndWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoY29k\nZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAgICAgICAg\nfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgYWRkTXVsdGlw\nbGVGaWVsZHNNZXRob2RWZXJzaW9uKG1ldGhvZCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCB0aGUgY29kZSBjb21tb24g\ndG8gdGhlIGJlZ2lubmluZyBvZiBib3RoIHRoZQogICAgICogcGNSZXBsYWNl\nRmllbGQgbWV0aG9kIGFuZCB0aGUgcGNQcm92aWRlRmllbGQgbWV0aG9kLiBU\naGlzIGluY2x1ZGVzCiAgICAgKiBjYWxjdWxhdGluZyB0aGUgcmVsYXRpdmUg\nZmllbGQgbnVtYmVyIG9mIHRoZSBkZXNpcmVkIGZpZWxkIGFuZCBjYWxsaW5n\nCiAgICAgKiB0aGUgc3VwZXJjbGFzcyBpZiBuZWNlc3NhcnkuCiAgICAgKgog\nICAgICogQHJldHVybiB0aGUgaW5kZXggaW4gd2hpY2ggdGhlIGxvY2FsIHZh\ncmlhYmxlIGhvbGRpbmcgdGhlIHJlbGF0aXZlCiAgICAgKiBmaWVsZCBudW1i\nZXIgaXMgc3RvcmVkCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGJlZ2luU3dp\ndGNoTWV0aG9kKFN0cmluZyBuYW1lLCBDb2RlIGNvZGUpIHsKICAgICAgICBi\nb29sZWFuIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhuYW1l\nKTsKICAgICAgICBpbnQgZmllbGROdW1iZXIgPSAoY29weSkgPyAxIDogMDsK\nCiAgICAgICAgaW50IHJlbExvY2FsID0gY29kZS5nZXROZXh0TG9jYWxzSW5k\nZXgoKTsKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXIpOwog\nICAgICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKHJlbExvY2FsKTsK\nICAgICAgICAgICAgcmV0dXJuIHJlbExvY2FsOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaW50IHJlbCA9IGZpZWxkTnVtYmVyIC0gcGNJbmhlcml0ZWRGaWVs\nZENvdW50CiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVt\nYmVyKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVS\nSVQsIGludC5jbGFzcyk7CiAgICAgICAgY29kZS5pc3ViKCk7CiAgICAgICAg\nY29kZS5pc3RvcmUoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgY29k\nZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKCiAgICAgICAgLy8gc3Vw\nZXI6IGlmIChyZWwgPCAwKSBzdXBlci5wY1JlcGxhY2VGaWVsZCAoZmllbGRO\ndW1iZXIpOyByZXR1cm47CiAgICAgICAgLy8gbm8gc3VwZXI6IGlmIChyZWwg\nPCAwKSB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpOwog\nICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZnZSgpOwog\nICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBTdHJpbmdbXSBhcmdzOwogICAgICAgICAgICBpZiAo\nY29weSkgewogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBTdHJpbmdbXXsg\nZ2V0VHlwZShfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS4KICAg\nICAgICAgICAgICAgICAgICBnZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1l\nKCkgfTsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBhcmdzID0g\nbmV3IFN0cmluZ1tdeyBpbnQuY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAg\nICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcik7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBl\nKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKSkuZ2V0TmFtZSgpLCBuYW1lLCAKICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRocm93RXhjZXB0\naW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7Cgog\nICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICBy\nZXR1cm4gcmVsTG9jYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGhl\nbHBlciBtZXRob2QsIGdpdmVuIHRoZSBwY1JlcGxhY2VGaWVsZCBvciBwY1By\nb3ZpZGVGaWVsZAogICAgICogbWV0aG9kLCBhZGRzIHRoZSBieXRlY29kZSBm\nb3IgdGhlIGNvcnJlc3BvbmRpbmcgJ3BsdXJhbCcgdmVyc2lvbgogICAgICog\nb2YgdGhlIG1ldGhvZCAtLSB0aGUgdmVyc2lvbiB0aGF0IHRha2VzIGFuIGlu\ndFtdIG9mIGZpZWxkcyB0bwogICAgICogdG8gYWNjZXNzIHJhdGhlciB0aGFu\nIGEgc2luZ2xlIGZpZWxkLiBUaGUgbXVsdGlwbGUgZmllbGRzIHZlcnNpb24K\nICAgICAqIHNpbXBseSBsb29wcyB0aHJvdWdoIHRoZSBwcm92aWRlZCBpbmRl\neGVzIGFuZCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiBzaW5ndWxhciB2ZXJz\naW9uIGZvciBlYWNoIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihCQ01ldGhvZCBzaW5nbGUp\nIHsKICAgICAgICBib29sZWFuIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIp\nLmVxdWFscyhzaW5nbGUuZ2V0TmFtZSgpKTsKCiAgICAgICAgLy8gcHVibGlj\nIHZvaWQgPG1ldGhvZD5zIChpbnRbXSBmaWVsZHMpCiAgICAgICAgQ2xhc3Nb\nXSBhcmdzID0gKGNvcHkpID8gbmV3IENsYXNzW117IE9iamVjdC5jbGFzcywg\naW50W10uY2xhc3MgfQogICAgICAgICAgICA6IG5ldyBDbGFzc1tdeyBpbnRb\nXS5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKHNpbmdsZS5nZXROYW1lKCkgKyAicyIsCiAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICBpbnQgZmllbGROdW1iZXJzID0g\nMDsKICAgICAgICBpbnQgaW5zdCA9IDA7CiAgICAgICAgaWYgKGNvcHkpIHsK\nICAgICAgICAgICAgZmllbGROdW1iZXJzID0gMTsKCiAgICAgICAgICAgIGlm\nIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICAvLyBn\nZXQgdGhlIG1hbmFnZWQgaW5zdGFuY2UgaW50byB0aGUgbG9jYWwgdmFyaWFi\nbGUgdGFibGUKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0\nTWV0aG9kKEltcGxIZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nImdldE1hbmFnZWRJbnN0YW5jZSIsIE9iamVjdC5jbGFzcywKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShfbWFuYWdl\nZFR5cGUpOwogICAgICAgICAgICAgICAgaW5zdCA9IGNvZGUuZ2V0TmV4dExv\nY2Fsc0luZGV4KCk7CiAgICAgICAgICAgICAgICBjb2RlLmFzdG9yZSgpLnNl\ndExvY2FsKGluc3QpOwoKICAgICAgICAgICAgICAgIC8vIHRoZXJlIG1pZ2h0\nIGJlIGEgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBjbGFzc2VzIG9mICd0aGlz\nJwogICAgICAgICAgICAgICAgLy8gdnMgJ290aGVyJyBpbiB0aGlzIGNvbnRl\neHQ7IHVzZSB0aGUgUEMgbWV0aG9kcyB0byBnZXQgdGhlIFNNCiAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoSW1wbEhl\nbHBlci5jbGFzcywKICAgICAgICAgICAgICAgICAgICAidG9QZXJzaXN0ZW5j\nZUNhcGFibGUiLCBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAg\nICAgICAgICAgICAgICAgICAicGNHZXRTdGF0ZU1hbmFnZXIiLCBTdGF0ZU1h\nbmFnZXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgLy8gWFhYIG90aGVyID0gKFhYWCkgcGM7CiAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoX3BjKTsKICAgICAgICAg\nICAgICAgIGluc3QgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAg\nICAgICAgICAgICAgICAvLyBhY2Nlc3MgdGhlIG90aGVyJ3Mgc20gZmllbGQg\nZGlyZWN0bHkKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChpbnN0KTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRG\naWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gaWYgKG90aGVyLnBjU3RhdGVNYW5hZ2VyICE9IHBjU3RhdGVNYW5hZ2Vy\nKQogICAgICAgICAgICAvLwl0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uCgogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZp\nbnMgPSBjb2RlLmlmYWNtcGVxKCk7CiAgICAgICAgICAgIHRocm93RXhjZXB0\naW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKCiAgICAg\nICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxsKQogICAgICAg\nICAgICAvLyAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbgogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAg\nICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxTdGF0ZUV4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2Rl\nLm5vcCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIGZvciAoaW50IGkgPSAw\nOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAg\nICBpbnQgaWR4ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAg\nICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGlkeCk7CiAgICAgICAgSnVtcElu\nc3RydWN0aW9uIHRlc3RpbnMgPSBjb2RlLmdvMigpOwoKICAgICAgICAvLyA8\nbWV0aG9kPiAoZmllbGRzW2ldKTsKICAgICAgICBJbnN0cnVjdGlvbiBib2R5\naW5zID0gbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgaWYgKGNvcHkpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChpbnN0KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmllbGRO\ndW1iZXJzKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoaWR4KTsK\nICAgICAgICBjb2RlLmlhbG9hZCgpOwogICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChzaW5nbGUpOwoKICAgICAgICAvLyBpKys7CiAg\nICAgICAgY29kZS5paW5jKCkuc2V0SW5jcmVtZW50KDEpLnNldExvY2FsKGlk\neCk7CgogICAgICAgIC8vIGkgPCBmaWVsZHMubGVuZ3RoCiAgICAgICAgdGVz\ndGlucy5zZXRUYXJnZXQoY29kZS5pbG9hZCgpLnNldExvY2FsKGlkeCkpOwog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcnMpOwog\nICAgICAgIGNvZGUuYXJyYXlsZW5ndGgoKTsKICAgICAgICBjb2RlLmlmaWNt\ncGx0KCkuc2V0VGFyZ2V0KGJvZHlpbnMpOwogICAgICAgIGNvZGUudnJldHVy\nbigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgdGhlICdzdG9jaycgbWV0aG9kcyB0byB0aGUgYnl0ZWNv\nZGU7IHRoZXNlIGluY2x1ZGUgbWV0aG9kcwogICAgICogbGlrZSB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlI3BjRmV0Y2hPYmplY3RJZH0KICAgICAqIGFu\nZCB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjSXNUcmFuc2FjdGlvbmFs\nfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN0b2NrTWV0aG9kcygp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgLy8gcGNHZXRHZW5lcmljQ29udGV4dAog\nICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAog\nICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAg\nICAgIFNNVFlQRSwgImdldCIgKyBDT05URVhUTkFNRSwgKENsYXNzW10pIG51\nbGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjRmV0Y2hPYmpl\nY3RJZAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0\naG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIFNNVFlQRSwgImZldGNoT2JqZWN0SWQiLCAoQ2xhc3NbXSkg\nbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RlbGV0\nZWQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhv\nZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICBTTVRZUEUsICJpc0RlbGV0ZWQiLCAoQ2xhc3NbXSkgbnVsbCkp\nLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RpcnR5CiAgICAg\nICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAg\nICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRE\nZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nU01UWVBFLCAiaXNEaXJ0eSIsIChDbGFzc1tdKSBudWxsKSksIHRydWUpOwog\nICAgCiAgICAgICAgICAgIC8vIHBjSXNOZXcKICAgICAgICAgICAgdHJhbnNs\nYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChN\nZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9k\nQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJpc05l\ndyIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAg\nICAvLyBwY0lzUGVyc2lzdGVudAogICAgICAgICAgICB0cmFuc2xhdGVGcm9t\nU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24o\nCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzUGVyc2lzdGVu\ndCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAg\nICAvLyBwY0lzVHJhbnNhY3Rpb25hbAogICAgICAgICAgICB0cmFuc2xhdGVG\ncm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhv\nZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rp\nb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzVHJhbnNh\nY3Rpb25hbCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAg\nICAgICAgICAvLyBwY1NlcmlhbGl6aW5nCiAgICAgICAgICAgIHRyYW5zbGF0\nZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0\naG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFj\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAic2VyaWFs\naXppbmciLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAg\nICAgICAgLy8gcGNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3Rh\ndGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImRpcnR5IiwgbmV3IENs\nYXNzW117IFN0cmluZy5jbGFzcyB9KSksIGZhbHNlKTsKICAgIAogICAgICAg\nICAgICAvLyBwY0dldFN0YXRlTWFuYWdlcgogICAgICAgICAgICBCQ01ldGhv\nZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFN0YXRlTWFu\nYWdlciIsCiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00s\nIFN0YXRlTWFuYWdlci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVy\nbigpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAg\nICAgICAgICAgIHRocm93IChOb1N1Y2hNZXRob2RFeGNlcHRpb24pIHBhZS5n\nZXRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBhIHN0b2NrIG1ldGhvZCB0byB0aGUg\nYnl0ZWNvZGUuIEVhY2gKICAgICAqIHN0b2NrIG1ldGhvZCBzaW1wbHkgZGVs\nZWdhdGVzIHRvIGEgY29ycmVzcG9uZGluZyBTdGF0ZU1hbmFnZXIgbWV0aG9k\nLgogICAgICogR2l2ZW4gdGhlIFN0YXRlTWFuYWdlciBtZXRob2QsIHRoZW4s\nIHRoaXMgZnVuY3Rpb24gdHJhbnNsYXRlcyBpdCBpbnRvCiAgICAgKiB0aGUg\nd3JhcHBlciBtZXRob2QgdGhhdCBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIGJ5\ndGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNsYXRlRnJv\nbVN0YXRlTWFuYWdlck1ldGhvZChNZXRob2QgbSwKICAgICAgICBib29sZWFu\nIGlzRGlydHlDaGVja01ldGhvZCkgewogICAgICAgIC8vIGZvcm0gdGhlIG5h\nbWUgb2YgdGhlIG1ldGhvZCBieSBwcmVwZW5kaW5nICdwYycgdG8gdGhlIHNt\nIG1ldGhvZAogICAgICAgIFN0cmluZyBuYW1lID0gUFJFICsgU3RyaW5nVXRp\nbHMuY2FwaXRhbGl6ZShtLmdldE5hbWUoKSk7CiAgICAgICAgQ2xhc3NbXSBw\nYXJhbXMgPSBtLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgQ2xhc3Mg\ncmV0dXJuVHlwZSA9IG0uZ2V0UmV0dXJuVHlwZSgpOwoKICAgICAgICAvLyBh\nZGQgdGhlIG1ldGhvZCB0byB0aGUgcGMKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChuYW1lLCByZXR1cm5UeXBlLCBwYXJh\nbXMpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0\ndXJuIDxkZWZhdWx0PjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0g\nY29kZS5pZm5vbm51bGwoKTsKICAgICAgICBpZiAocmV0dXJuVHlwZS5lcXVh\nbHMoYm9vbGVhbi5jbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgZWxzZSBpZiAoIXJldHVyblR5\ncGUuZXF1YWxzKHZvaWQuY2xhc3MpKQogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5\ncGUocmV0dXJuVHlwZSk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGRp\ncnR5LWNoZWNrIG1ldGhvZCBhbmQgd2UncmUgc3ViY2xhc3NpbmcgYnV0IG5v\ndAogICAgICAgIC8vIHJlZGVmaW5pbmcsIGhvb2sgaW50byBQQ0hlbHBlciB0\nbyBkbyB0aGUgZGlydHkgY2hlY2sKICAgICAgICBpZiAoaXNEaXJ0eUNoZWNr\nTWV0aG9kICYmICFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIFJl\nZGVmaW5pdGlvbkhlbHBlci5kaXJ0eUNoZWNrKHNtKTsKICAgICAgICAgICAg\naWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgdGhl\nIHJldHVybiBzdGF0ZW1lbnQgYmVsb3cKICAgICAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNz\nLCAKICAgICAgICAgICAgICAgICJkaXJ0eUNoZWNrIiwgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW10geyBTTVRZUEUgfSk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIH0KICAgICAgICAKICAgICAg\nICAvLyByZXR1cm4gcGNTdGF0ZU1hbmFnZXIuPG1ldGhvZD4gKDxhcmdzPik7\nCiAgICAgICAgLy8gbWFuYWdlZCBpbnN0YW5jZSBsb2FkZWQgYWJvdmUgaW4g\naWYtZWxzZSBibG9jawogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFy\nYW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0\nUGFyYW0oaSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QobSk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1\ncm5UeXBlKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxl\nI3BjR2V0VmVyc2lvbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2QoKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRW\nZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJ\nbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRWZXJzaW9u\nRmllbGQoKTsKCiAgICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBudWxsKQog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAvLyByZXR1\ncm4gbnVsbDsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcmV0dXJu\nIDx2ZXJzaW9uRmllbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFwcGVyID0g\ndG9QcmltaXRpdmVXcmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAg\nIGlmICh3cmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUo\nKSkgewogICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh3cmFw\ncGVyKTsKICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\ndmVyc2lvbkZpZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVy\nc2lvbkZpZWxkLmdldERlY2xhcmVkVHlwZSgpKQogICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIsICI8aW5p\ndD4iLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyB2ZXJzaW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyByZXR1\ncm4gcGNTdGF0ZU1hbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChT\nTVRZUEUsICJnZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAg\nICBudWxsKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHZlcnNpb24gZmllbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFwcGVyLCBv\nciBudWxsIGlmCiAgICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBub3QgcHJp\nbWl0aXZlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJpbWl0aXZl\nV3JhcHBlcihGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIEJv\nb2xlYW4uY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBDaGFyYWN0ZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5j\nbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBTaG9y\ndC5jbGFzczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNs\nYXJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtA\nbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlU3RhdGVNYW5hZ2Vy\nfQogICAgICogbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRob2QoKSB7\nCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNSZXBsYWNlU3RhdGVNYW5hZ2Vy\nIChTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIi\nLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU01UWVBF\nIH0pOwogICAgICAgIG1ldGhvZC5zZXRTeW5jaHJvbml6ZWQodHJ1ZSk7CiAg\nICAgICAgbWV0aG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9u\nKFNlY3VyaXR5RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3Rh\ndGVNYW5hZ2VyICE9IG51bGwpCiAgICAgICAgLy8JcGNTdGF0ZU1hbmFnZXIg\nPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwoKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgInJlcGxhY2VTdGF0ZU1h\nbmFnZXIiLAogICAgICAgICAgICBTTVRZUEUsIG5ldyBDbGFzc1tdeyBTTVRZ\nUEUgfSk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBT\nZWN1cml0eU1hbmFnZXIgc2VjID0gU3lzdGVtLmdldFNlY3VyaXR5TWFuYWdl\nciAoKTsKICAgICAgICAvLyBpZiAoc2VjICE9IG51bGwpCiAgICAgICAgLy8J\nCXNlYy5jaGVja1Blcm1pc3Npb24gKFBlcm1pc3Npb24uU0VUX1NUQVRFX01B\nTkFHRVIpOwogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChTeXN0ZW0uY2xhc3MsCiAgICAgICAgICAgICJn\nZXRTZWN1cml0eU1hbmFnZXIiLCBTZWN1cml0eU1hbmFnZXIuY2xhc3MsIG51\nbGwpKTsKCiAgICAgICAgLy8gcGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAg\nICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgUGVyc2lzdGVu\nY2VDYXBhYmxlIG1ldGhvZHMgZGVhbGluZyB3aXRoIGFwcGxpY2F0aW9uCiAg\nICAgKiBpZGVudGl0eSBhbmQgZ2l2ZXMgdGhlbSBuby1vcCBpbXBsZW1lbnRh\ndGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROb09wQXBwbGlj\nYXRpb25JZGVudGl0eU1ldGhvZHMoKSB7CiAgICAgICAgLy8gcHVibGljIHZv\naWQgcGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1\ncHBsaWVyIGZzLAogICAgICAgIC8vIAlPYmplY3Qgb2lkKQogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBPSURGU1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVs\nZHNUb09iamVjdElkIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJ\nZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmpl\nY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBj\nQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1\nbWVyIGZjLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9k\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9t\nT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXXsgT0lERkNUWVBFLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAg\nIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAo\nT2JqZWN0IG9pZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7\nCiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJ\nZEluc3RhbmNlICgpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgp\nOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJ\nbnN0YW5jZSAoT2JqZWN0IG9iaikKICAgICAgICBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFz\ncyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc1Rv\nT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNp\nbmcgYXBwbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGRDb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChib29sZWFu\nIGZpZWxkTWFuYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVs\nZHNUb09iamVjdElkIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMsCiAgICAg\nICAgLy8JT2JqZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZp\nZWxkTWFuYWdlcikgPwogICAgICAgICAgICBuZXcgU3RyaW5nW117IE9JREZT\nVFlQRS5nZXROYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAg\nICAgICAgICA6IG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUo\nKSB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc2lu\nZ2xlIGZpZWxkIGlkZW50aXR5IGFsd2F5cyB0aHJvd3MgZXhjZXB0aW9uCiAg\nICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAg\nICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSU5URVJORVhDRVApOwogICAg\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAg\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwgdm9p\nZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gT2JqZWN0IGlkID0gb2lkOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIp\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nCiAgICAgICAgaWYgKF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsK\nICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0\nSWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gPG9pZCB0eXBlPiBpZCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAgICAgICAg\naW50IGlkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBD\nbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAg\nIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAvLyBpbnQg\naW5oZXJpdGVkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50OwogICAgICAgIGlu\ndCBpbmhlcml0ZWQgPSAwOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsK\nICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklU\nLCBpbnQuY2xhc3MpOwogICAgICAgICAgICBpbmhlcml0ZWQgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICBjb2RlLmlzdG9yZSgp\nLnNldExvY2FsKGluaGVyaXRlZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBp\nZC48ZmllbGQ+ID0gZnMuZmV0Y2g8dHlwZT5GaWVsZCAoPGluZGV4Pik7IG9y\nLi4uCiAgICAgICAgLy8gaWQuPGZpZWxkPiA9IHBjLjxmaWVsZD47CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygp\nID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIENsYXNzIHR5cGU7CiAgICAgICAg\nU3RyaW5nIG5hbWU7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgTWV0\naG9kIHNldHRlcjsKICAgICAgICBib29sZWFuIHJlZmxlY3Q7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaWQpOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0TmFt\nZSgpOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJZEZp\nZWxkVHlwZSgpOwogICAgICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlw\nZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAg\nICAgICAgICBzZXR0ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgZmllbGQg\nPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0cnVlKTsK\nICAgICAgICAgICAgICAgIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMo\nZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgICAgICAgICAgaWYgKHJl\nZmxlY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3Rh\nbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJl\nZmxlY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAiZmlu\nZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xh\nc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgYm9v\nbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDsKICAgICAg\nICAgICAgICAgIHNldHRlciA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWRU\neXBlLCBuYW1lLCB0eXBlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlZmxl\nY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMoc2V0dGVyLmdldE1vZGlmaWVycygp\nKTsKICAgICAgICAgICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlw\nZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25z\ndGFudCgpLnNldENsYXNzKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9u\nLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRTZXR0ZXIi\nLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgQ2xhc3MuY2xh\nc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsKICAg\nICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAg\nICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpbmhlcml0ZWQpOwog\nICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZAogICAgICAgICAgICAg\nICAgICAgIChnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKHR5cGUpKTsKCiAgICAg\nICAgICAgICAgICAvLyBpZiB0aGUgdHlwZSBvZiB0aGlzIGZpZWxkIG1ldGEg\nZGF0YSBpcwogICAgICAgICAgICAgICAgLy8gbm9uLXByaW1pdGl2ZSBhbmQg\nbm9uLXN0cmluZywgYmUgc3VyZSB0byBjYXN0CiAgICAgICAgICAgICAgICAv\nLyB0byB0aGUgYXBwcm9wcmlhdGUgdHlwZS4KICAgICAgICAgICAgICAgIGlm\nICghcmVmbGVjdCAmJiAhdHlwZS5pc1ByaW1pdGl2ZSgpCiAgICAgICAgICAg\nICAgICAgICAgJiYgIXR5cGUuZ2V0TmFtZSgpLmVxdWFscyhTdHJpbmcuY2xh\nc3MuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29k\nZSwgZm1kc1tpXSk7CgogICAgICAgICAgICAgICAgLy8gZ2V0IGlkL3BrIGZy\nb20gcGMgaW5zdGFuY2UKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAg\nICAgICAgICAgICAgYWRkRXh0cmFjdE9iamVjdElkRmllbGRWYWx1ZUNvZGUo\nY29kZSwgZm1kc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlm\nIChyZWZsZWN0ICYmIGZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xh\nc3MsICJzZXQiLCAKICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgRmllbGQuY2xhc3MsCiAgICAg\nICAgICAgICAgICAgICAgKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBlIDog\nT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlZmxl\nY3QpIHsgCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwgCiAgICAgICAgICAg\nICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBPYmplY3QuY2xh\nc3MsIE1ldGhvZC5jbGFzcywKICAgICAgICAgICAgICAgICAgICAodHlwZS5p\nc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAoZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChzZXR0ZXIpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgY29kZSB0byBleHRyYWN0IHRoZSBpZCBvZiB0aGUg\nZ2l2ZW4gcHJpbWFyeSBrZXkgcmVsYXRpb24gZmllbGQgZm9yCiAgICAgKiBz\nZXR0aW5nIGludG8gYW4gb2JqZWN0aWQgaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZhbHVlQ29k\nZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgcGspIHsKICAgICAgICAvLyBp\nZiAodmFsICE9IG51bGwpIAogICAgICAgIC8vICB2YWwgPSAoKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSkgdmFsKS5wY0ZldGNoT2JqZWN0SWQoKTsKICAgICAgICBp\nbnQgcGMgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNv\nZGUuYXN0b3JlKCkuc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChwYyk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmbnVs\nbDEgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChwYyk7CiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFBl\ncnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7IAogICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFz\ncywKICAgICAgICAgICAgUFJFICsgIkZldGNoT2JqZWN0SWQiLCBPYmplY3Qu\nY2xhc3MsIG51bGwpOwogICAgICAgIGludCBvaWQgPSBjb2RlLmdldE5leHRM\nb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwo\nb2lkKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZudWxsMiA9IGNvZGUuaWZudWxsKCk7\nIAoKICAgICAgICAvLyBmb3IgZGF0YXN0b3JlIC8gc2luZ2xlLWZpZWxkIGlk\nZW50aXR5OgogICAgICAgIC8vIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAv\nLyAgIHZhbCA9ICgoT3BlbkpQQUlkKSB2YWwpLmdldElkKCk7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBwa21ldGEgPSBway5nZXREZWNsYXJlZFR5cGVNZXRh\nRGF0YSgpOwogICAgICAgIGludCBwa2NvZGUgPSBway5nZXRPYmplY3RJZEZp\nZWxkVHlwZUNvZGUoKTsKICAgICAgICBDbGFzcyBwa3R5cGUgPSBway5nZXRP\nYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgIGlmIChwa21ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUgCiAg\nICAgICAgICAgICYmIHBrY29kZSA9PSBKYXZhVHlwZXMuTE9ORykgewogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKElkLmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKElkLmNsYXNz\nLCAiZ2V0SWQiLCAKICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwp\nOwogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgIH0gZWxzZSBp\nZiAocGttZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAg\nc3dpdGNoIChwa2NvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUoQnl0ZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQnl0ZUlkLmNs\nYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoQnl0ZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAg\nICAgICAgICAgICAgICBieXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5CWVRFX09CSikKICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0\nTWV0aG9kKEJ5dGUuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2J5dGUuY2xh\nc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUoQ2hhcmFjdGVyLmNsYXNzKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAg\nICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DSEFSOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShDaGFySWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDaGFySWQuY2xhc3Ms\nICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2\nYVR5cGVzLkNIQVJfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoQ2hhcmFjdGVyLmNsYXNzLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXSB7Y2hhci5jbGFzc30pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5z\nZXRUeXBlKERvdWJsZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEb3VibGVJ\nZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKERvdWJsZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBkb3VibGUuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkRPVUJM\nRV9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChEb3VibGUuY2xhc3MsICI8aW5pdD4iLCAKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tde2RvdWJsZS5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoRmxvYXQu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShGbG9hdElkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nRmxvYXRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgZmxvYXQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwa2NvZGUgPT0gSmF2YVR5cGVzLkZMT0FUX09CSikKICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEZs\nb2F0LmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtmbG9hdC5jbGFzc30pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFuZXcoKS5zZXRUeXBlKEludGVnZXIuY2xhc3MpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8g\nYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\nSW50SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChJbnRJZC5jbGFzcywgImdldElkIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5JTlRfT0JK\nKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoSW50ZWdlci5jbGFzcywgIjxpbml0PiIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\naW50LmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKExvbmcuY2xhc3MpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAg\nICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKExvbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKExvbmdJZC5jbGFz\ncywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9uZy5jbGFz\ncywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBK\nYXZhVHlwZXMuTE9OR19PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChMb25nLmNsYXNzLCAiPGlu\naXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdIHtsb25nLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZShTaG9ydC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAo\nKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFNob3J0SWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChTaG9ydElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAg\nICAgICAgICAgICBzaG9ydC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuU0hPUlRfT0JKKQogICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoU2hvcnQuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde3Nob3J0LmNs\nYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEYXRlSWQuY2xhc3MpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChEYXRlSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIERhdGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5H\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChv\naWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZShTdHJpbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZ0lkLmNsYXNzLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQmlnRGVjaW1h\nbElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoQmlnRGVjaW1hbElkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgICAgICAgICBCaWdEZWNpbWFsSWQuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQmlnSW50ZWdl\ncklkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoQmlnSW50ZWdlcklkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgICAgICAgICBCaWdJbnRlZ2VySWQuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmpl\nY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0g\nZWxzZSBpZiAocGttZXRhLmdldE9iamVjdElkVHlwZSgpICE9IG51bGwpIHsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwa3R5cGUpOwogICAg\nICAgIH0gZWxzZQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\nb2lkKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gY29kZS5nbzIo\nKTsKCiAgICAgICAgLy8gaWYgKHZhbCA9PSBudWxsKQogICAgICAgIC8vICAg\ndmFsID0gPGRlZmF1bHQ+OwogICAgICAgIEluc3RydWN0aW9uIGRlZjsKICAg\nICAgICBzd2l0Y2ggKHBrY29kZSkgewogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChieXRlKSAw\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKChjaGFyKSAwKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAg\nICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAg\nICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nRzoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBkZWYgPSBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKHNob3J0KSAwKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAg\nICB9CiAgICAgICAgaWZudWxsMS5zZXRUYXJnZXQoZGVmKTsKICAgICAgICBp\nZm51bGwyLnNldFRhcmdldChkZWYpOwogICAgICAgIGdvMi5zZXRUYXJnZXQo\nY29kZS5ub3AoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8\nY29kZT5wY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQ8L2NvZGU+IG1ldGhv\nZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGljYXRpb24gaWRlbnRp\ndHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5S2V5RmllbGRz\nRnJvbU9iamVjdElkTWV0aG9kKGJvb2xlYW4gZmllbGRNYW5hZ2VyKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8v\nIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2Jq\nZWN0SWRGaWVsZENvbnN1bWVyIGZjLAogICAgICAgIC8vCU9iamVjdCBvaWQp\nCiAgICAgICAgU3RyaW5nW10gYXJncyA9IChmaWVsZE1hbmFnZXIpIAogICAg\nICAgICAgICA/ICBuZXcgU3RyaW5nW117IE9JREZDVFlQRS5nZXROYW1lKCks\nIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6IG5ldyBT\ndHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5\nS2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFz\ncy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBjYWxsIHN1cGVyY2xhc3Mg\nbWV0aG9kCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9\nIG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShpKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21l\ndGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBQUkUgKyAiQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZCIsIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdz\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAg\nICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYmIF9tZXRhLmlz\nT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8gb2lkID0g\nKChPYmplY3RJZCkgaWQpLmdldElkICgpOwogICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xh\nc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51\nbGwpOwogICAgICAgIH0KCiAgICAgICAgLy8gPG9pZCB0eXBlPiBjYXN0ID0g\nKDxvaWQgdHlwZT4pIG9pZDsKICAgICAgICBpbnQgaWQgPSBjb2RlLmdldE5l\neHRMb2NhbHNJbmRleCgpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0\nYS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRM\nb2NhbChpZCk7CgogICAgICAgIC8vIGZzLnN0b3JlPHR5cGU+RmllbGQgKDxp\nbmRleD4sIGlkLjxmaWVsZD4pOyBvci4uLgogICAgICAgIC8vIHRoaXMuPGZp\nZWxkPiA9IGlkLjxmaWVsZD4KICAgICAgICAvLyBvciBmb3Igc2luZ2xlIGZp\nZWxkIGlkZW50aXR5OiBpZC5nZXRJZCAoKQogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZp\nZWxkcygpCiAgICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMo\nKTsKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBDbGFzcyB0eXBlOwog\nICAgICAgIENsYXNzIHVud3JhcHBlZDsKICAgICAgICBGaWVsZCBmaWVsZDsK\nICAgICAgICBNZXRob2QgZ2V0dGVyOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIWZt\nZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgIG5hbWUgPSBmbWRzW2ldLmdldE5hbWUoKTsKICAg\nICAgICAgICAgdHlwZSA9IGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUo\nKTsKICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFnZXIgCiAgICAgICAgICAg\nICAgICAmJiBmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZh\nVHlwZXMuUEMpIHsKICAgICAgICAgICAgICAgIC8vIHNtLmdldFBDUHJpbWFy\neUtleShvaWQsIGkgKyBwY0luaGVyaXRlZEZpZWxkQ291bnQpOyAKICAgICAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgY29kZS5kdXAoKTsgLy8gbGVhdmUgb3JpZyBvbiBz\ndGFjayB0byBzZXQgdmFsdWUgaW50bwogICAgICAgICAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgICAg\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNz\nKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU3RhdGVNYW5h\nZ2VyLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAiZ2V0UENQcmltYXJ5\nS2V5IiwgT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNsYXNzIH0pOwogICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICB9IGVsc2UgeyAKICAgICAg\nICAgICAgICAgIHVud3JhcHBlZCA9IChmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIAogICAgICAgICAgICAgICAgICAg\nID8gdHlwZSA6IHVud3JhcFNpbmdsZUZpZWxkSWRlbnRpdHkoZm1kc1tpXSk7\nCiAgICAgICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKSB7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElO\nSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5p\nYWRkKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKCiAgICAg\nICAgICAgICAgICBpZiAodW53cmFwcGVkICE9IHR5cGUpIHsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwogICAg\nICAgICAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAob2lkVHlwZSA9PSBPYmplY3RJZC5j\nbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgImdldElkIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRNYW5hZ2VyICYmIHR5cGUg\nIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2lkVHlw\nZSA9PSBEYXRlSWQuY2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJ\nZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRlLmNsYXNzLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFn\nZXIgJiYgdHlwZSAhPSBEYXRlLmNsYXNzKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHVud3JhcHBlZCwgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlwZSkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhv\nZCh0eXBlLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgdW53cmFwcGVkIH0pOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUND\nRVNTX0ZJRUxEKXsKICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IFJlZmxl\nY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUsIHRydWUpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1B1YmxpYyhmaWVsZC5nZXRN\nb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24u\nZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENs\nYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2Qo\nUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10geyAKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBTdHJpbmcu\nY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlvbkdldHRlck1ldGhvZCh0\neXBlLCBGaWVsZC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFz\ncykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdldHRl\nciA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWRUeXBlLCBuYW1lLCB0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNQdWJsaWMo\nZ2V0dGVyLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldHRlcik7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5maW5k\nR2V0dGVyKC4uLikpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNs\nYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5hbWUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAiZmluZEdldHRlciIsIE1ldGhvZC5jbGFz\ncywgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsK\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5z\nZXRNZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChnZXRSZWZs\nZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUsIE1ldGhvZC5jbGFzcykpOwogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAm\nJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChnZXRGaWVs\nZENvbnN1bWVyTWV0aG9kKHR5cGUpKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRz\nW2ldKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGlmIHRoZSBjbGFzcyB1c2VzIHRoZSBDbGFzcy9TdHJpbmcgY29uc3Ry\ndWN0b3IKICAgICAqIGluc3RlYWQgb2YganVzdCBTdHJpbmcuCiAgICAgKi8K\nICAgIHByaXZhdGUgQm9vbGVhbiB1c2VzQ2xhc3NTdHJpbmdJZENvbnN0cnVj\ndG9yKCkgewogICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSAh\nPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICBy\nZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgaWYgKF9tZXRhLmlzT3Bl\nbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKF9tZXRhLmdldE9i\namVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNzKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRS\nVUU7CiAgICAgICAgfQoKICAgICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEu\nZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xh\nc3MsIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uVFJVRTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAg\nICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBvaWRUeXBlLmdldENv\nbnN0cnVjdG9yKG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7CiAgICAg\nICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxs\nOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhlIGdpdmVuIGZpZWxkIGlz\nIGEgd3JhcHBlci10eXBlIHNpbmdsZSBmaWVsZCBpZGVudGl0eSBwcmltYXJ5\nIGtleSwKICAgICAqIHJldHVybiBpdHMgY29ycmVzcG9uZGluZyBwcmltaXRp\ndmUgY2xhc3MuIEVsc2UgcmV0dXJuIHRoZSBmaWVsZCB0eXBlLgogICAgICov\nCiAgICBwcml2YXRlIENsYXNzIHVud3JhcFNpbmdsZUZpZWxkSWRlbnRpdHko\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoIWZtZC5nZXREZWZp\nbmluZ01ldGFEYXRhKCkuaXNPcGVuSlBBSWRlbnRpdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKCiAgICAgICAgc3dp\ndGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGJ5dGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVJfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXIuY2xhc3M7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmxvYXQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9P\nQko6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50LmNsYXNzOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAg\nICByZXR1cm4gc2hvcnQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGxvbmcuY2xh\nc3M7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGdldHRlciBtZXRob2Qg\nb2YgdGhlIHtAbGluayBSZWZsZWN0aW9ufSBoZWxwZXIgZm9yCiAgICAgKiBh\nIGZpZWxkIG9yIGdldHRlciBtZXRob2Qgb2YgdGhlIGdpdmVuIHR5cGUuCiAg\nICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldFJlZmxlY3Rpb25HZXR0ZXJN\nZXRob2QoQ2xhc3MgdHlwZSwgQ2xhc3MgYXJnVHlwZSkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbmFt\nZSA9ICJnZXQiOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpCiAg\nICAgICAgICAgIG5hbWUgKz0gU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZSh0eXBl\nLmdldE5hbWUoKSk7CiAgICAgICAgcmV0dXJuIFJlZmxlY3Rpb24uY2xhc3Mu\nZ2V0TWV0aG9kKG5hbWUsIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCAK\nICAgICAgICAgICAgYXJnVHlwZSB9KTsgCiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHByb3BlciBmZXRjaCBtZXRob2Qgb2YgdGhlIE9iamVj\ndElkRmllbGRTdXBwbGllciBmb3IKICAgICAqIGEgZmllbGQgb2YgdGhlIGdp\ndmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldEZpZWxk\nU3VwcGxpZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0TWV0aG9k\nKE9JREZTVFlQRSwgdHlwZSwgImZldGNoIiwgdHJ1ZSwgZmFsc2UsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGZl\ndGNoIG1ldGhvZCBvZiB0aGUgT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZvcgog\nICAgICogYSBmaWVsZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBNZXRob2QgZ2V0RmllbGRDb25zdW1lck1ldGhvZChDbGFzcyB0\neXBlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBnZXRNZXRob2QoT0lERkNUWVBFLCB0eXBlLCAic3Rv\ncmUiLCBmYWxzZSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgdGhlIHBjTmV3T2JqZWN0SWRJbnN0YW5jZSBtZXRob2QgdG8g\nY2xhc3NlcyB1c2luZwogICAgICogYXBwbGljYXRpb24gaWRlbnRpdHkuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROZXdPYmplY3RJZEluc3RhbmNl\nTWV0aG9kKGJvb2xlYW4gb2JqKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdP\nYmplY3RJZEluc3RhbmNlICgpCiAgICAgICAgQ2xhc3NbXSBhcmdzID0gKG9i\naikgPyBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0gOiBudWxsOwogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJOZXdPYmplY3RJZEluc3RhbmNlIiwKICAgICAgICAgICAgT2JqZWN0LmNs\nYXNzLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29k\nZSh0cnVlKTsKCiAgICAgICAgQm9vbGVhbiB1c2VzQ2xzU3RyaW5nID0gdXNl\nc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3RvcigpOwogICAgICAgIENsYXNzIG9p\nZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBpZiAo\nb2JqICYmIHVzZXNDbHNTdHJpbmcgPT0gbnVsbCkgewogICAgICAgICAgICAv\nLyB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICguLi4pOwog\nICAgICAgICAgICBTdHJpbmcgbXNnID0gX2xvYy5nZXQoInN0ci1jb25zIiwg\nb2lkVHlwZSwKICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2NyaWJlZFR5\ncGUoKSkuZ2V0TWVzc2FnZSgpOwogICAgICAgICAgICBjb2RlLmFuZXcoKS5z\nZXRUeXBlKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShtc2cpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNz\nLAogICAgICAgICAgICAgICAgIjxpbml0PiIsIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIGNvZGUuYXRo\ncm93KCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlkZW50aXR5\nKCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewogICAgICAg\nICAgICAvLyBuZXcgT2JqZWN0SWQgKGNscywgb2lkKQogICAgICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50\nKCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gbmV3IDxvaWQgY2xhc3M+ICgpOwogICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAg\nICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSB8fCAob2JqICYmIHVz\nZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5UUlVFKSkKICAgICAgICAgICAgY29k\nZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwog\nICAgICAgIGlmIChvYmopIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICAgICAgaWYgKHVzZXNDbHNTdHJp\nbmcgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgYXJncyA9IG5l\ndyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzIH07CiAgICAg\nICAgICAgIGVsc2UgaWYgKHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5GQUxT\nRSkKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgU3RyaW5n\nLmNsYXNzIH07CiAgICAgICAgfSBlbHNlIGlmIChfbWV0YS5pc09wZW5KUEFJ\nZGVudGl0eSgpKSB7CiAgICAgICAgICAgIC8vIG5ldyA8dHlwZT5JZGVudGl0\neSAoWFhYLmNsYXNzLCA8cGs+KTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGEgcGsgPSBfbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKClbMF07CiAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGspOwogICAg\nICAgICAgICBpZiAocGsuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFU\neXBlcy5QQykKICAgICAgICAgICAgICAgIGFkZEV4dHJhY3RPYmplY3RJZEZp\nZWxkVmFsdWVDb2RlKGNvZGUsIHBrKTsKICAgICAgICAgICAgaWYgKF9tZXRh\nLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNzKQogICAgICAg\nICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgT2Jq\nZWN0LmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UgaWYgKF9tZXRhLmdldE9i\namVjdElkVHlwZSgpID09IERhdGUuY2xhc3MpCiAgICAgICAgICAgICAgICBh\ncmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBEYXRlLmNsYXNzIH07\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcg\nQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIHBrLmdldE9iamVjdElkRmllbGRUeXBl\nKCkgfTsKICAgICAgICB9CgogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChvaWRUeXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywgYXJn\ncyk7CiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYm\nIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywg\nIjxpbml0PiIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgQ2xhc3MuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGVuIGNvbW11bmljYXRpbmcgd2l0aCB0aGUg\nU3RhdGVNYW5hZ2VyLCBtYW55IG1ldGhvZHMgYXJlIHVzZWQKICAgICAqIGRl\ncGVuZGluZyBvbiB0aGUgY2xhc3Mgb2Ygc3RhdGUgYmVpbmcgcGFzc2VkLiBU\naGlzIG1ldGhvZCwKICAgICAqIGdpdmVuIHRoZSB0eXBlIG9mIGluZm9ybWF0\naW9uIGJlaW5nIHBhc3NlZCBhbmQgdGhlIHByZWZpeAogICAgICogKCdwcm92\naWRlZCcsICdyZXBsYWNlJywgZXRjKSBvZiB0aGUgbWV0aG9kIHRvCiAgICAg\nKiBjYWxsLCByZXR1cm5zIHRoZSBTdGF0ZU1hbmFnZXIgbWV0aG9kIHRoYXQg\nc2hvdWxkIGJlIHVzZWQuCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhl\nIHR5cGUgb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAgICAgKiBAcGFyYW0gcHJl\nZml4IHRoZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0byBjYWxsOyBhbGwgbWV0\naG9kcwogICAgICogZW5kIGluICdbc3RhdGUgdHlwZV1GaWVsZCc7IG9ubHkg\ndGhlIHByZWZpeCB2YXJpZXMKICAgICAqIEBwYXJhbSBnZXQgdHJ1ZSBpZiBy\nZWNlaXZpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUKICAgICAqIFN0YXRlTWFu\nYWdlciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0aGUgU00KICAgICAqIEBw\nYXJhbSBjdXJWYWx1ZSB0cnVlIGlmIHRoZSBjdXJyZW50IHN0YXRlIHZhbHVl\nIGlzIHBhc3NlZCB0bwogICAgICogdGhlIFN0YXRlTWFuYWdlciBhcyBhbiBl\neHRyYSBhcmd1bWVudAogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRT\ndGF0ZU1hbmFnZXJNZXRob2QoQ2xhc3MgdHlwZSwgU3RyaW5nIHByZWZpeCwK\nICAgICAgICBib29sZWFuIGdldCwgYm9vbGVhbiBjdXJWYWx1ZSkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gZ2V0TWV0aG9kKFNNVFlQRSwgdHlwZSwgcHJlZml4LCBnZXQsIHRydWUs\nIGN1clZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nbWV0aG9kIG9mIHRoZSBnaXZlbiBvd25lciB0eXBlIG1hdGNoaW5nIHRoZSBn\naXZlbiBjcml0ZXJpYS4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUg\ndHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNzZWQKICAgICAqIEBwYXJhbSBwcmVm\naXggdGhlIHByZWZpeCBvZiB0aGUgbWV0aG9kIHRvIGNhbGw7IGFsbCBtZXRo\nb2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0ZSB0eXBlXUZpZWxkJzsgb25seSB0\naGUgcHJlZml4IHZhcmllcwogICAgICogQHBhcmFtIGdldCB0cnVlIGlmIHJl\nY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9tIHRoZQogICAgICogb3duZXIsIGZh\nbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhlIG93bmVyCiAgICAgKiBAcGFyYW0g\naGFzcGMgdHJ1ZSBpZiB0aGUgcGMgaXMgcGFzc2VkIGFzIGFuIGV4dHJhIGFy\nZ3VtZW50CiAgICAgKiBAcGFyYW0gY3VyVmFsdWUgdHJ1ZSBpZiB0aGUgY3Vy\ncmVudCBzdGF0ZSB2YWx1ZSBpcyBwYXNzZWQgdG8KICAgICAqIHRoZSBvd25l\nciBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICovCiAgICBwcml2YXRlIE1l\ndGhvZCBnZXRNZXRob2QoQ2xhc3Mgb3duZXIsIENsYXNzIHR5cGUsIFN0cmlu\nZyBwcmVmaXgsCiAgICAgICAgYm9vbGVhbiBnZXQsIGJvb2xlYW4gaGFzcGMs\nIGJvb2xlYW4gY3VyVmFsdWUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWxsIG1ldGhvZHMgZW5kIGluIFtm\naWVsZCB0eXBlXUZpZWxkLCB3aGVyZSB0aGUgZmllbGQgdHlwZQogICAgICAg\nIC8vIGNhbiBiZSBhbnkgb2YgdGhlIHByaW1pdHZlIHR5cGVzIChidXQgY2Fw\naXRhbGl6ZWQpLCAnU3RyaW5nJywKICAgICAgICAvLyBvciAnT2JqZWN0Jzsg\nZmlndXJlIG91dCB3aGF0IHR5cGUgdG8gdXNlCiAgICAgICAgU3RyaW5nIHR5\ncGVOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgaWYgKHR5cGUuaXNQ\ncmltaXRpdmUoKSkKICAgICAgICAgICAgdHlwZU5hbWUgPSB0eXBlTmFtZS5z\ndWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAg\nKyB0eXBlTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgZWxzZSBpZiAodHlw\nZS5lcXVhbHMoU3RyaW5nLmNsYXNzKSkKICAgICAgICAgICAgdHlwZU5hbWUg\nPSAiU3RyaW5nIjsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHlwZU5h\nbWUgPSAiT2JqZWN0IjsKICAgICAgICAgICAgdHlwZSA9IE9iamVjdC5jbGFz\nczsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBmaWVsZCBpbmRleCBpcyBh\nbHdheXMgcGFzc2VkIGFzIGFuIGFyZzsgdGhlIHBjIGluc3RhbmNlIGFuZAog\nICAgICAgIC8vIHRoZSBjdXJyZW50IHZhbHVlIG1heSBiZSBwYXNzZWQ7IGlm\nIHNldHRpbmcgdGhlIG5ldyB2YWx1ZSBpcwogICAgICAgIC8vIGFsc28gcGFz\nc2VkCiAgICAgICAgTGlzdCBwbGlzdCA9IG5ldyBBcnJheUxpc3QoNCk7CiAg\nICAgICAgaWYgKGhhc3BjKQogICAgICAgICAgICBwbGlzdC5hZGQoUENUWVBF\nKTsKICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNzKTsKICAgICAgICBpZiAo\nIWdldCB8fCBjdXJWYWx1ZSkKICAgICAgICAgICAgcGxpc3QuYWRkKHR5cGUp\nOwogICAgICAgIGlmICghZ2V0ICYmIGN1clZhbHVlKSB7CiAgICAgICAgICAg\nIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICAgICAgcGxpc3QuYWRkKGludC5j\nbGFzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyB1c2UgcmVmbGVjdGlvbiB0\nbyByZXR1cm4gdGhlIHJpZ2h0IG1ldGhvZAogICAgICAgIFN0cmluZyBuYW1l\nID0gcHJlZml4ICsgdHlwZU5hbWUgKyAiRmllbGQiOwogICAgICAgIENsYXNz\nW10gcGFyYW1zID0gKENsYXNzW10pIHBsaXN0LnRvQXJyYXkobmV3IENsYXNz\nW3BsaXN0LnNpemUoKV0pOwogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERl\nY2xhcmVkTWV0aG9kQWN0aW9uKG93bmVyLCBuYW1lLCBwYXJhbXMpKTsKICAg\nICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBhZSkg\newogICAgICAgICAgICAgdGhyb3cgKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbikg\ncGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRoZSBjb2RlIG5lY2Vzc2Fy\neSB0byB0aHJvdyB0aGUgZ2l2ZW4KICAgICAqIGV4Y2VwdGlvbiB0eXBlLCBz\nYW5zIG1lc3NhZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1Y3Rpb24g\ndGhyb3dFeGNlcHRpb24oQ29kZSBjb2RlLCBDbGFzcyB0eXBlKSB7CiAgICAg\nICAgSW5zdHJ1Y3Rpb24gaW5zID0gY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBl\nKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgY29kZS5hdGhyb3coKTsKICAgICAgICByZXR1cm4g\naW5zOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgUGVyc2lzdGVu\nY2VDYXBhYmxlIGludGVyZmFjZSB0byB0aGUgY2xhc3MgYmVpbmcKICAgICAq\nIGVuaGFuY2VkLCBhbmQgYWRkcyBhIGRlZmF1bHQgY29uc3RydWN0b3IgZm9y\nIHVzZSBieSBPcGVuSlBBCiAgICAgKiBpZiBpdCBpcyBub3QgYWxyZWFkeSBw\ncmVzZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5oYW5jZUNsYXNz\nKCkgewogICAgICAgIC8vIG1ha2UgdGhlIGNsYXNzIGltcGxlbWVudCBQZXJz\naXN0ZW5jZUNhcGFibGUKICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFjZShQ\nQ1RZUEUpOwoKICAgICAgICAvLyBhZGQgYSB2ZXJzaW9uIHN0YW1wCiAgICAg\nICAgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb25NZXRob2QoKTsK\nCiAgICAgICAgLy8gZmluZCB0aGUgZGVmYXVsdCBjb25zdHJ1Y3RvcgogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgi\nPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKCiAgICAgICAgLy8gYSBkZWZh\ndWx0IGNvbnN0cnVjdG9yIGlzIHJlcXVpcmVkCiAgICAgICAgaWYgKG1ldGhv\nZCA9PSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBuYW1lID0gX3BjLmdl\ndE5hbWUoKTsKICAgICAgICAgICAgaWYgKCFfZGVmQ29ucykKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbmhh\nbmNlLWRlZmF1bHRjb25zdCIsIG5hbWUpKTsKCiAgICAgICAgICAgIG1ldGhv\nZCA9IF9wYy5hZGREZWZhdWx0Q29uc3RydWN0b3IoKTsKICAgICAgICAgICAg\nU3RyaW5nIGFjY2VzczsKICAgICAgICAgICAgaWYgKF9tZXRhLmlzRGV0YWNo\nYWJsZSgpKSB7CiAgICAgICAgICAgICAgICAvLyBleHRlcm5hbGl6YWJsZSBy\nZXF1aXJlcyB0aGF0IHRoZSBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgICAg\nLy8gYmUgcHVibGljLCBzbyBtYWtlIHRoZSBhZGRlZCBjb25zdHJ1Y3RvciBw\ndWJsaWMKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAg\nICAgICAgICAgICAgICBhY2Nlc3MgPSAicHVibGljIjsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChfcGMuaXNGaW5hbCgpKSB7CiAgICAgICAgICAgICAgICBt\nZXRob2QubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGFjY2VzcyA9\nICJwcml2YXRlIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgICAgICBh\nY2Nlc3MgPSAicHJvdGVjdGVkIjsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAoIShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZhY2Uo\nKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAgICAgJiYg\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImVuaGFuY2UtYWRkZGVmYXVsdGNvbnN0IiwgbmFtZSwg\nYWNjZXNzKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyB0aGUgZm9sbG93aW5nIGZpZWxkcyB0byB0aGUgUGVyc2lzdGVuY2VDYXBh\nYmxlIGluc3RhbmNlOgogICAgICogPHVsPgogICAgICogPGxpPjxjb2RlPnBy\naXZhdGUgc3RhdGljIGludCBwY0luaGVyaXRlZEZpZWxkQ291bnQ8L2NvZGU+\nPC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBDbGFzcyBw\nY1BDU3VwZXJjbGFzczwvY29kZT4KICAgICAqIDwvbGk+CiAgICAgKiA8bGk+\nPGNvZGU+cHJpdmF0ZSBzdGF0aWMgU3RyaW5nW10gcGNGaWVsZE5hbWVzPC9j\nb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgQ2xh\nc3NbXSBwY0ZpZWxkVHlwZXM8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29k\nZT5wcml2YXRlIHN0YXRpYyBieXRlW10gcGNGaWVsZEZsYWdzPC9jb2RlPjwv\nbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJvdGVjdGVkIHRyYW5zaWVudCBTdGF0\nZU1hbmFnZXIgcGNTdGF0ZU1hbmFnZXI8L2NvZGU+CiAgICAgKiBpZiBubyBQ\nZXJzaXN0ZW5jZUNhcGFibGUgc3VwZXJjbGFzcyBwcmVzZW50KTwvbGk+CiAg\nICAgKiA8L3VsPgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkRmllbGRz\nKCkgewogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoSU5IRVJJVCwgaW50LmNs\nYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVs\nZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKS5zZXRTdGF0\naWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQUkUgKyAiRmll\nbGRUeXBlcyIsIENsYXNzW10uY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsKICAg\nICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0\nZVtdLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xh\ncmVGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsK\nCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51bGwg\nfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBCQ0ZpZWxk\nIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICAgICAgZmllbGQubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICBmaWVs\nZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTW9kaWZpZXMgdGhlIGNsYXNzIGluaXRpYWxpemF0aW9uIG1l\ndGhvZCAoY3JlYXRpbmcgb25lIGlmIG5lY2Vzc2FyeSkKICAgICAqIHRvIGlu\naXRpYWxpemUgdGhlIHN0YXRpYyBmaWVsZHMgb2YgdGhlIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBpbnN0YW5jZSBhbmQKICAgICAqIHRvIHJlZ2lzdGVyIGl0IHdp\ndGggdGhlIGltcGwgaGVscGVyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkU3RhdGljSW5pdGlhbGl6ZXIoKSB7CiAgICAgICAgQ29kZSBjb2RlID0g\nZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKHRydWUpOwogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAgICBj\nb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBwY0lu\naGVyaXRlZEZpZWxkQ291bnQgPSA8c3VwZXJDbGFzcz4ucGNHZXRNYW5hZ2Vk\nRmllbGRDb3VudCgpCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAg\nICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFuYWdlZEZpZWxkQ291bnQi\nLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAgICAgICAg\nIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNz\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGNQQ1N1cGVyY2xh\nc3MgPSA8c3VwZXJDbGFzcz47CiAgICAgICAgICAgIC8vIHRoaXMgaW50ZW50\naW9uYWxseSBjYWxscyBnZXREZXNjcmliZWRUeXBlKCkgZGlyZWN0bHkKICAg\nICAgICAgICAgLy8gaW5zdGVhZCBvZiBQQ0VuaGFuY2VyLmdldFR5cGUoKQog\nICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcygKICAg\nICAgICAgICAgICAgIF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\nZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29kZS5wdXRzdGF0\naWMoKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gcGNGaWVsZE5hbWVzID0gbmV3IFN0cmluZ1tdIHsgIjxu\nYW1lMT4iLCAiPG5hbWUyPiIsIC4uLiB9OwogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAg\nICAgIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZShmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAg\nIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0\nYXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3RyaW5nW10u\nY2xhc3MpOwoKICAgICAgICAvLyBwY0ZpZWxkVHlwZXMgPSBuZXcgQ2xhc3Nb\nXSB7IDx0eXBlMT4uY2xhc3MsIDx0eXBlMj4uY2xhc3MsIC4uLiB9OwogICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAg\nICAgICAgY29kZS5hbmV3YXJyYXkoKS5zZXRUeXBlKENsYXNzLmNsYXNzKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNsYXNz\nY29uc3RhbnQoKS5zZXRDbGFzcyhmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgp\nKTsKICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAgICAgfQogICAg\nICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlw\nZXMiLCBDbGFzc1tdLmNsYXNzKTsKCiAgICAgICAgLy8gcGNGaWVsZEZsYWdz\nID0gbmV3IGJ5dGVbXSB7IDxmbGFnMT4sIDxmbGFnMj4sIC4uLiB9OwogICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAg\nICAgICAgY29kZS5uZXdhcnJheSgpLnNldFR5cGUoYnl0ZS5jbGFzcyk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGdldEZpZWxkRmxhZyhmbWRzW2ldKSk7CiAgICAgICAg\nICAgIGNvZGUuYmFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1\ndHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtd\nLmNsYXNzKTsKCiAgICAgICAgLy8gUENSZWdpc3RyeS5yZWdpc3RlciAoY2xz\nLAogICAgICAgIC8vCXBjRmllbGROYW1lcywgcGNGaWVsZFR5cGVzLCBwY0Zp\nZWxkRmxhZ3MsCiAgICAgICAgLy8gIHBjUENTdXBlcmNsYXNzLCBhbGlhcywg\nbmV3IFhYWCAoKSk7CiAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0\nQ2xhc3MoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3Ry\naW5nW10uY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsKICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdz\nIiwgYnl0ZVtdLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNl\ndEZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcyk7CiAgICAgICAgCiAgICAgICAg\naWYgKF9tZXRhLmlzTWFwcGVkKCkpCiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZShfbWV0YS5nZXRUeXBlQWxpYXMoKSk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwoK\nICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkKICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShfcGMpOwogICAgICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAg\nIH0KCiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoSEVM\nUEVSVFlQRSwgInJlZ2lzdGVyIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmdbXS5jbGFzcywgQ2xh\nc3NbXS5jbGFzcywKICAgICAgICAgICAgICAgIGJ5dGVbXS5jbGFzcywgQ2xh\nc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgUENUWVBFIH0pOwoKICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZsYWcgZm9y\nIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nYnl0ZSBnZXRGaWVsZEZsYWcoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1B\nTkFHRV9OT05FKQogICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAgIGJ5\ndGUgZmxhZ3MgPSAwOwogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCkuaXNQcmltaXRpdmUoKQogICAgICAgICAgICB8fCBTZXJpYWxpemFibGUu\nY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkp\nKQogICAgICAgICAgICBmbGFncyA9IFBlcnNpc3RlbmNlQ2FwYWJsZS5TRVJJ\nQUxJWkFCTEU7CgogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09\nIEZpZWxkTWV0YURhdGEuTUFOQUdFX1RSQU5TQUNUSU9OQUwpCiAgICAgICAg\nICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklURTsK\nICAgICAgICBlbHNlIGlmICghZm1kLmlzUHJpbWFyeUtleSgpICYmICFmbWQu\naXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgIGZsYWdzIHw9\nIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklURQogICAgICAgICAgICAg\nICAgfCBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfUkVBRDsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5N\nRURJQVRFX1dSSVRFCiAgICAgICAgICAgICAgICB8IFBlcnNpc3RlbmNlQ2Fw\nYWJsZS5NRURJQVRFX1JFQUQ7CiAgICAgICAgcmV0dXJuIGZsYWdzOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgY29kZSB0byBwcm9wZXJseSBo\nYW5kbGUgUGVyc2lzdGVuY2VDYXBhYmxlIHNlcmlhbGl6YXRpb24KICAgICAq\nIHRvIHRoZSBieXRlY29kZS4gVGhpcyBpbmNsdWRlcyBjcmVhdGluZyBhbmQg\naW5pdGlhbGl6aW5nIHRoZQogICAgICogc3RhdGljIDxjb2RlPnNlcmlhbFZl\ncnNpb25VSUQ8L2NvZGU+IGNvbnN0YW50IGlmIG5vdCBhbHJlYWR5IGRlZmlu\nZWQsCiAgICAgKiBhcyB3ZWxsIGFzIGNyZWF0aW5nIGEgY3VzdG9tIDxjb2Rl\nPndyaXRlT2JqZWN0PC9jb2RlPiBtZXRob2QgaWYgdGhlCiAgICAgKiBjbGFz\ncyBpcyBTZXJpYWxpemFibGUgYW5kIGRvZXMgbm90IGRlZmluZSB0aGVtLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2VyaWFsaXphdGlvbkNvZGUo\nKSB7CiAgICAgICAgaWYgKGV4dGVybmFsaXplRGV0YWNoZWQoKQogICAgICAg\nICAgICB8fCAhU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20o\nX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAg\nICAgICAvLyAjIyMjIyB3aGF0IHNob3VsZCBoYXBwZW4gaWYgYSB0eXBlIGlz\nIEV4dGVybmFsaXphYmxlPyBJdCBsb29rcwogICAgICAgICAgICAvLyAjIyMj\nIyBsaWtlIEV4dGVybmFsaXphYmxlIGNsYXNzZXMgd2lsbCBub3QgYmUgc2Vy\naWFsaXplZCBhcyBQQ3MKICAgICAgICAgICAgLy8gIyMjIyMgYmFzZWQgb24g\ndGhpcyBsb2dpYy4KICAgICAgICAgICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKAogICAgICAgICAgICAgICAgX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgICAgIGFkZFN1YmNs\nYXNzU2VyaWFsaXphdGlvbkNvZGUoKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm90IGFscmVhZHkgcHJlc2VudCwg\nYWRkIGEgc2VyaWFsVmVyc2lvblVJRCBmaWVsZDsgaWYgdGhlIGluc3RhbmNl\nCiAgICAgICAgLy8gaXMgZGV0YWNoYWJsZSBhbmQgdXNlcyBkZXRhY2hlZCBz\ndGF0ZSB3aXRob3V0IGEgZGVjbGFyZWQgZmllbGQsCiAgICAgICAgLy8gY2Fu\nJ3QgYWRkIGEgc2VyaWFsIHZlcnNpb24gVUlEIGJlY2F1c2Ugd2UnbGwgYmUg\nYWRkaW5nIGV4dHJhIGZpZWxkcwogICAgICAgIC8vIHRvIHRoZSBlbmhhbmNl\nZCB2ZXJzaW9uCiAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXREZWNs\nYXJlZEZpZWxkKCJzZXJpYWxWZXJzaW9uVUlEIik7CiAgICAgICAgaWYgKGZp\nZWxkID09IG51bGwpIHsKICAgICAgICAgICAgTG9uZyB1aWQgPSBudWxsOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdWlkID0gTnVtYmVy\ncy52YWx1ZU9mKE9iamVjdFN0cmVhbUNsYXNzLmxvb2t1cAogICAgICAgICAg\nICAgICAgICAgIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpLmdldFNlcmlh\nbFZlcnNpb25VSUQoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBsYXN0LWNoYW5jZSBjYXRjaCBm\nb3IgYnVnICMyODMgKHdoaWNoIGNhbiBoYXBwZW4KICAgICAgICAgICAgICAg\nIC8vIGluIGEgdmFyaWV0eSBvZiBDbGFzc0xvYWRpbmcgZW52aXJvbm1lbnRz\nKQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFu\nY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSwgdCk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJl\nbmhhbmNlLXVpZC1hY2Nlc3MiLCBfbWV0YSkpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBpZiB3ZSBjb3VsZG4ndCBhY2Nlc3MgdGhlIHNlcmlh\nbFZlcnNpb25VSUQsIHdlIHdpbGwgaGF2ZSB0bwogICAgICAgICAgICAvLyBz\na2lwIHRoZSBvdmVycmlkZSBvZiB0aGF0IGZpZWxkIGFuZCBub3QgYmUgc2Vy\naWFsaXphdGlvbgogICAgICAgICAgICAvLyBjb21wYXRpYmxlIHdpdGggbm9u\nLWVuaGFuY2VkIGNsYXNzZXMKICAgICAgICAgICAgaWYgKHVpZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQo\nInNlcmlhbFZlcnNpb25VSUQiLCBsb25nLmNsYXNzKTsKICAgICAgICAgICAg\nICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgICAgICBmaWVs\nZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRG\naW5hbCh0cnVlKTsKCiAgICAgICAgICAgICAgICBDb2RlIGNvZGUgPSBnZXRP\nckNyZWF0ZUNsYXNzSW5pdENvZGUoZmFsc2UpOwogICAgICAgICAgICAgICAg\nY29kZS5iZWZvcmVGaXJzdCgpOwogICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKHVpZC5sb25nVmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKGZpZWxkKTsKCiAgICAg\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFkZCB3cml0ZSBvYmplY3Qg\nbWV0aG9kCiAgICAgICAgQkNNZXRob2Qgd3JpdGUgPSBfcGMuZ2V0RGVjbGFy\nZWRNZXRob2QoIndyaXRlT2JqZWN0IiwKICAgICAgICAgICAgbmV3IENsYXNz\nW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICBib29s\nZWFuIGZ1bGwgPSB3cml0ZSA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7\nCiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdCAoT2Jq\nZWN0T3V0cHV0U3RyZWFtIG91dCkKICAgICAgICAgICAgd3JpdGUgPSBfcGMu\nZGVjbGFyZU1ldGhvZCgid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLAogICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5j\nbGFzcyB9KTsKICAgICAgICAgICAgd3JpdGUuZ2V0RXhjZXB0aW9ucyh0cnVl\nKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAg\nICB3cml0ZS5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2Rp\nZnlXcml0ZU9iamVjdE1ldGhvZCh3cml0ZSwgZnVsbCk7CgogICAgICAgIC8v\nIGFuZCByZWFkIG9iamVjdAogICAgICAgIEJDTWV0aG9kIHJlYWQgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRPYmplY3QiLAogICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAg\nICAgZnVsbCA9IHJlYWQgPT0gbnVsbDsKICAgICAgICBpZiAoZnVsbCkgewog\nICAgICAgICAgICAvLyBwcml2YXRlIHZvaWQgcmVhZE9iamVjdCAoT2JqZWN0\nSW5wdXRTdHJlYW0gaW4pCiAgICAgICAgICAgIHJlYWQgPSBfcGMuZGVjbGFy\nZU1ldGhvZCgicmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7\nCiAgICAgICAgICAgIHJlYWQuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNl\ncHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICByZWFkLmdl\ndEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAg\nICAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAg\nIHJlYWQubWFrZVByaXZhdGUoKTsKICAgICAgICB9CiAgICAgICAgbW9kaWZ5\nUmVhZE9iamVjdE1ldGhvZChyZWFkLCBmdWxsKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgYWRkU3ViY2xhc3NTZXJpYWxpemF0aW9uQ29kZSgpIHsKICAg\nICAgICAvLyBmb3IgZ2VuZXJhdGVkIHN1YmNsYXNzZXMsIHNlcmlhbGl6YXRp\nb24gbXVzdCB3cml0ZSBhbiBpbnN0YW5jZSBvZgogICAgICAgIC8vIHRoZSBz\ndXBlcmNsYXNzIGluc3RlYWQgb2YgdGhlIHN1YmNsYXNzLCBzbyB0aGF0IHRo\nZSBjbGllbnQgVk0gY2FuCiAgICAgICAgLy8gZGVzZXJpYWxpemUgc3VjY2Vz\nc2Z1bGx5LgoKICAgICAgICAvLyBwcml2YXRlIE9iamVjdCB3cml0ZVJlcGxh\nY2UoKSB0aHJvd3MgT2JqZWN0U3RyZWFtRXhjZXB0aW9uCiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoIndyaXRlUmVwbGFj\nZSIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLmdldEV4\nY2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKE9iamVjdFN0cmVhbUV4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIE9iamVjdCBvID0gbmV3IDxtYW5hZ2Vk\nLXR5cGU+KCkKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9tYW5hZ2Vk\nVHlwZSk7IC8vIGZvciByZXR1cm4KICAgICAgICBjb2RlLmR1cCgpOyAvLyBm\nb3IgcG9zdC08aW5pdD4gd29yawogICAgICAgIGNvZGUuZHVwKCk7IC8vIGZv\nciA8aW5pdD4KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwgIjxpbml0PiIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG51bGwpOwoKICAgICAgICAvLyBjb3B5IGFsbCB0\naGUgZmllbGRzLgogICAgICAgIC8vICMjIyMjIGxpbWl0aW5nIHRvIEpQQSBA\nVHJhbnNpZW50IGxpbWl0YXRpb25zCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKGZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICAvLyBvLjxmaWVsZD4gPSB0aGlzLjxmaWVsZD4g\nKG9yIHJlZmxlY3RpdmUgYW5hbG9nKQogICAgICAgICAgICBjb2RlLmR1cCgp\nOyAvLyBmb3IgcHV0ZmllbGQKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFRoaXMoKTsgLy8gZm9yIGdldGZpZWxkCiAgICAgICAgICAgIGdldGZpZWxk\nKGNvZGUsIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5nZXROYW1lKCkpOwogICAg\nICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUsIGZtZHNbaV0u\nZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJl\nZFR5cGUoKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmFyZXR1cm4oKS5z\nZXRUeXBlKE9iamVjdC5jbGFzcyk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgY2xhc3MgYmVp\nbmcgZW5oYW5jZWQgc2hvdWxkIGV4dGVybmFsaXplIHRvIGEgZGV0YWNoZWQK\nICAgICAqIGluc3RhbmNlIHJhdGhlciB0aGFuIHNlcmlhbGl6ZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGV4dGVybmFsaXplRGV0YWNoZWQoKSB7\nCiAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFs\ncyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkpCiAgICAgICAgICAgICYmIFNl\ncmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERl\nc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgJiYgIV9yZXBvcy5nZXRDb25m\naWd1cmF0aW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAg\nICAgICBpc0RldGFjaGVkU3RhdGVUcmFuc2llbnQoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgYSBjdXN0b20gd3JpdGVPYmplY3QgbWV0aG9kIHRo\nYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICoge0BsaW5rIE9iamVjdE91dHB1\ndFN0cmVhbSNkZWZhdWx0V3JpdGVPYmplY3R9IG1ldGhvZCwKICAgICAqIGJ1\ndCBvbmx5IGFmdGVyIGNhbGxpbmcgdGhlIGludGVybmFsIDxjb2RlPnBjU2Vy\naWFsaXppbmc8L2NvZGU+IG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIG1vZGlmeVdyaXRlT2JqZWN0TWV0aG9kKEJDTWV0aG9kIG1ldGhvZCwg\nYm9vbGVhbiBmdWxsKSB7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdl\ndENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAg\nICAgICAvLyBib29sIGNsZWFyID0gcGNTZXJpYWxpemluZyAoKTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNlcmlhbGl6\naW5nIiwKICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgbnVsbCk7CiAgICAg\nICAgaW50IGNsZWFyID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGNsZWFyKTsKCiAgICAgICAg\naWYgKGZ1bGwpIHsKICAgICAgICAgICAgLy8gb3V0LmRlZmF1bHRXcml0ZU9i\namVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzLAogICAgICAgICAgICAgICAgImRl\nZmF1bHRXcml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICB9CgogICAgICAgIEluc3Ry\ndWN0aW9uIHRtcGxhdGUgPSAoKENvZGUpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2Rl\nQWN0aW9uKCkpKS52cmV0dXJuKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9u\nIHRvcmV0OwogICAgICAgIEluc3RydWN0aW9uIHJldDsKICAgICAgICBjb2Rl\nLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9y\nd2FyZCh0bXBsYXRlKSkgewogICAgICAgICAgICByZXQgPSBjb2RlLnByZXZp\nb3VzKCk7CiAgICAgICAgICAgIC8vIGlmIChjbGVhcikgcGNTZXREZXRhY2hl\nZFN0YXRlIChudWxsKTsKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExv\nY2FsKGNsZWFyKTsKICAgICAgICAgICAgdG9yZXQgPSBjb2RlLmlmZXEoKTsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB0\nb3JldC5zZXRUYXJnZXQocmV0KTsKICAgICAgICAgICAgY29kZS5uZXh0KCk7\nIC8vIGp1bXAgb3ZlciByZXR1cm4KICAgICAgICB9CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgY3VzdG9t\nIHJlYWRPYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAg\nICoge0BsaW5rIE9iamVjdElucHV0U3RyZWFtI3JlYWRPYmplY3R9IG1ldGhv\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1vZGlmeVJlYWRPYmplY3RN\nZXRob2QoQkNNZXRob2QgbWV0aG9kLCBib29sZWFuIGZ1bGwpIHsKICAgICAg\nICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBj\nb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIC8vIGlmIHRoaXMgaW5zdGFu\nY2UgdXNlcyBzeW50aGV0aWMgZGV0YWNoZWQgc3RhdGUsIG5vdGUgdGhhdCBp\ndCBoYXMKICAgICAgICAvLyBiZWVuIGRlc2VyaWFsaXplZAogICAgICAgIGlm\nIChDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0\nYWNoZWRTdGF0ZSgpKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAg\nICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJT\nZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBpbi5kZWZhdWx0UmVh\nZE9iamVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAi\nZGVmYXVsdFJlYWRPYmplY3QiLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfQoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhl\nIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYW4gaW5z\ndGFuY2UKICAgICAqIGlzIGRldGFjaGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkSXNEZXRhY2hlZE1ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIGJvb2xl\nYW4gcGNJc0RldGFjaGVkKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiSXNEZXRhY2hlZCIsCiAgICAgICAg\nICAgIEJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtl\nUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgYm9vbGVhbiBuZWVkc0RlZmluaXRpdmVNZXRob2Qg\nPSB3cml0ZUlzRGV0YWNoZWRNZXRob2QoY29kZSk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICAgICAgaWYgKCFuZWVkc0RlZmluaXRpdmVNZXRob2Qp\nIAogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHByaXZhdGUgYm9v\nbGVhbiBwY0lzRGV0YWNoZWRTdGF0ZURlZmluaXRpdmUoKQogICAgICAgIC8v\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vIGF1eGlsbGlhcnkgZW5oYW5j\nZXJzIG1heSBjaGFuZ2UgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGlzIG1ldGhv\nZAogICAgICAgIC8vIGlmIHRoZWlyIHNwZWNzIGNvbnNpZGVyIGRldGFjaGVk\nIHN0YXRlIGRlZmluaXRpdmUKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFy\nZU1ldGhvZChJU0RFVEFDSEVEU1RBVEVERUZJTklUSVZFLCBib29sZWFuLmNs\nYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVBy\naXZhdGUoKTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAg\nICAgICBjb2RlLmlyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhlIGJvZHkgb2YgdGhl\nIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYW4KICAg\nICAqIGluc3RhbmNlIGlzIGRldGFjaGVkLgogICAgICoKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiB3ZSBuZWVkIGEgcGNJc0RldGFjaGVkU3RhdGVEZWZpbml0\naXZlIG1ldGhvZCwgZmFsc2UKICAgICAqIG90aGVyd2lzZQogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gd3JpdGVJc0RldGFjaGVkTWV0aG9kKENvZGUg\nY29kZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBub3QgZGV0YWNoYWJsZTogcmV0dXJuIEJvb2xlYW4uRkFM\nU0UKICAgICAgICBpZiAoIV9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAg\nICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFz\ncywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAvLwkJcmV0\ndXJuIChzbS5pc0RldGFjaGVkICgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUu\naWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0\naG9kKFNNVFlQRSwgImlzRGV0YWNoZWQiLAogICAgICAgICAgICBib29sZWFu\nLmNsYXNzLCBudWxsKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZmYWxz\nZSA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBpZmZhbHNlLnNldFRh\ncmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3Ms\nICJGQUxTRSIsCiAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpKTsKICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgLy8gaWYgd2UgdXNlIGRldGFj\naGVkIHN0YXRlOgogICAgICAgIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUg\nKCkgIT0gbnVsbAogICAgICAgIC8vICAgICAmJiBwY0dldERldGFjaGVkU3Rh\ndGUgIT0gREVTRVJJQUxJWkVEKQogICAgICAgIC8vICAgICByZXR1cm4gQm9v\nbGVhbi5UUlVFOwogICAgICAgIEJvb2xlYW4gc3RhdGUgPSBfbWV0YS51c2Vz\nRGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBub3Rk\nZXNlciA9IG51bGw7CiAgICAgICAgSW5zdHJ1Y3Rpb24gdGFyZ2V0OwogICAg\nICAgIGlmIChzdGF0ZSAhPSBCb29sZWFuLkZBTFNFKSB7CiAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAg\nICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBpZmlucyA9IGNv\nZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xh\nc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNs\nYXNzKTsKICAgICAgICAgICAgbm90ZGVzZXIgPSBjb2RlLmlmYWNtcGVxKCk7\nCiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CgogICAgICAgICAgICBpZiAoc3RhdGUgPT0gQm9v\nbGVhbi5UUlVFKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHRv\nIHVzZSBkZXRhY2hlZCBzdGF0ZToKICAgICAgICAgICAgICAgIC8vIHJldHVy\nbiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICAgICAgdGFyZ2V0ID0gY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0Ui\nLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpOwogICAgICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAg\nICAgICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVh\ndGUgYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJn\nZXQgPSBjb2RlLm5vcCgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJn\nZXQpOwogICAgICAgIGlmIChub3RkZXNlciAhPSBudWxsKQogICAgICAgICAg\nICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKCiAgICAgICAgLy8gYWxs\nb3cgdXNlcnMgd2l0aCB2ZXJzaW9uIG9yIGF1dG8tYXNzaWduZWQgcGsgZmll\nbGRzIHRvIG1hbnVhbGx5IAogICAgICAgIC8vIGNvbnN0cnVjdCBhICJkZXRh\nY2hlZCIgaW5zdGFuY2UsIHNvIGNoZWNrIHRoZXNlIGJlZm9yZSB0YWtpbmcg\naW50byAKICAgICAgICAvLyBhY2NvdW50IG5vbi1leGlzdGVudCBkZXRhY2hl\nZCBzdGF0ZQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hlZCBpZiB2ZXJz\naW9uIGlzIG5vbi1kZWZhdWx0CiAgICAgICAgRmllbGRNZXRhRGF0YSB2ZXJz\naW9uID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHN0\nYXRlICE9IEJvb2xlYW4uVFJVRSAmJiB2ZXJzaW9uICE9IG51bGwpIHsKICAg\nICAgICAgICAgLy8gaWYgKDx2ZXJzaW9uPiAhPSA8ZGVmYXVsdD4pCiAgICAg\nICAgICAgIC8vCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbik7CiAgICAgICAgICAgIGlm\naW5zID0gaWZEZWZhdWx0VmFsdWUoY29kZSwgdmVyc2lvbik7CiAgICAgICAg\nICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywg\nIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0\ndXJuKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAgICAg\nICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hlZCBpZiBhdXRvLWdlbm5l\nZCBwcmltYXJ5IGtleXMgYXJlIG5vbi1kZWZhdWx0CiAgICAgICAgaWZpbnMg\nPSBudWxsOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmluczIgPSBudWxs\nOwogICAgICAgIGJvb2xlYW4gaGFzQXV0b0Fzc2lnbmVkUEsgPSBmYWxzZTsK\nICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5UUlVFCiAgICAgICAgICAg\nICYmIF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEu\nSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAgLy8gZm9yIGVhY2ggcGsg\nZmllbGQ6CiAgICAgICAgICAgIC8vIGlmICg8cGs+ICE9IDxkZWZhdWx0PiBb\nJiYgISIiLmVxdWFscyAoPHBrPildKQogICAgICAgICAgICAvLwkJcmV0dXJu\nIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBr\ncyA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFsdWVTdHJhdGVneSgpID09IFZh\nbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgIHRhcmdldCA9IGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKGlmaW5z\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0\nKHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZiAoaWZpbnMyICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdldCh0YXJnZXQp\nOwogICAgICAgICAgICAgICAgaWZpbnMyID0gbnVsbDsKCiAgICAgICAgICAg\nICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAg\nICAgICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNvZGUsIHBr\nc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuU1RSSU5HKSB7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKCIiKTsKICAgICAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZy5jbGFzcywgImVxdWFscyIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG5ldyBD\nbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAg\naWZpbnMyID0gY29kZS5pZm5lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4u\nY2xhc3MsICJUUlVFIiwKICAgICAgICAgICAgICAgICAgICBCb29sZWFuLmNs\nYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYXJ0aWZpY2lh\nbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJnZXQgPSBjb2RlLm5v\ncCgpOwogICAgICAgIGlmIChpZmlucyAhPSBudWxsKQogICAgICAgICAgICBp\nZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICBpZiAoaWZpbnMyICE9\nIG51bGwpCiAgICAgICAgICAgIGlmaW5zMi5zZXRUYXJnZXQodGFyZ2V0KTsK\nCiAgICAgICAgLy8gaWYgaGFzIGF1dG8tYXNzaWduZWQgcGsgYW5kIHdlIGdl\ndCB0byB0aGlzIHBvaW50LCBtdXN0IGhhdmUgZGVmYXVsdAogICAgICAgIC8v\nIHZhbHVlLCBzbyBtdXN0IGJlIG5ldyBpbnN0YW5jZQogICAgICAgIGlmICho\nYXNBdXRvQXNzaWduZWRQSykgewogICAgICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4u\nY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgZGV0\nYWNoZWQgc3RhdGUgaXMgbm90IGRlZmluaXRpdmUsIGp1c3QgZ2l2ZSB1cCBu\nb3cgYW5kIHJldHVybgogICAgICAgIC8vIG51bGwgc28gdGhhdCB0aGUgcnVu\ndGltZSB3aWxsIHBlcmZvcm0gYSBEQiBsb29rdXAgdG8gZGV0ZXJtaW5lCiAg\nICAgICAgLy8gd2hldGhlciB3ZSdyZSBkZXRhY2hlZCBvciBuZXcKICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChJU0RFVEFDSEVEU1RBVEVERUZJTklUSVZF\nLCBib29sZWFuLmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBp\nZmlucyA9IGNvZGUuaWZuZSgpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoKICAgICAgICAvLyBubyBkZXRh\nY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0ZSBh\nbmQgaXQncyBub3QKICAgICAgICAvLyBzeW50aGV0aWMgb3IgdGhlIGluc3Rh\nbmNlIGlzIG5vdCBzZXJpYWxpemFibGUgb3IgdGhlIHN0YXRlIGlzbid0CiAg\nICAgICAgLy8gdHJhbnNpZW50LCBtdXN0IG5vdCBiZSBkZXRhY2hlZAogICAg\nICAgIGlmIChzdGF0ZSA9PSBudWxsCiAgICAgICAgICAgICYmICghQ2xhc3NN\nZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3Rh\ndGUoKSkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAg\nICAgICAgfHwgIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0YWNo\nU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBpc0RldGFjaGVkU3RhdGVU\ncmFuc2llbnQoKSkpIHsKICAgICAgICAgICAgLy8gcmV0dXJuIEJvb2xlYW4u\nRkFMU0UKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChC\nb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gZGV0YWNoZWQgc3RhdGU6IGlm\nIGluc3RhbmNlIHVzZXMgZGV0YWNoZWQgc3RhdGUgKGFuZCBtdXN0IGJlCiAg\nICAgICAgLy8gc3ludGhldGljIGFuZCB0cmFuc2llbnQgaW4gc2VyaWFsaXph\nYmxlIGluc3RhbmNlIGF0IHRoaXMgcG9pbnQpLAogICAgICAgIC8vIG5vdCBk\nZXRhY2hlZCBpZiBzdGF0ZSBub3Qgc2V0IHRvIERFU0VSSUFMSVpFRAogICAg\nICAgIGlmIChzdGF0ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIChw\nY0dldERldGFjaGVkU3RhdGUgKCkgPT0gbnVsbCkgLy8gaW5zdGVhZCBvZiBE\nRVNFUklBTElaRUQKICAgICAgICAgICAgLy8gICAgIHJldHVybiBCb29sZWFu\nLkZBTFNFOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlmaW5zID0g\nY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGdpdmUgdXA7IHdlIGp1c3QgZG9uJ3Qga25vdwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb21wYXJlIHRoZSBnaXZlbiBmaWVsZCB0byBpdHMgSmF2YSBkZWZhdWx0\nLCByZXR1cm5pbmcgdGhlCiAgICAgKiBjb21wYXJpc29uIGluc3RydWN0aW9u\nLiBUaGUgZmllbGQgdmFsdWUgd2lsbCBhbHJlYWR5IGJlIG9uIHRoZSBzdGFj\nay4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSnVtcEluc3RydWN0aW9u\nIGlmRGVmYXVsdFZhbHVlKENvZGUgY29kZSwKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFO\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgY29k\nZS5kY21wbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAg\nICAgICAgICBjb2RlLmZjbXBsKCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6\nCiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEwp\nOwogICAgICAgICAgICAgICAgY29kZS5sY21wKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZm51bGwoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGdldCB0\naGUgY29kZSBmb3IgdGhlIGNsYXNzIGluaXRpYWxpemVyIG1ldGhvZCwKICAg\nICAqIGNyZWF0aW5nIHRoZSBtZXRob2QgaWYgaXQgZG9lcyBub3QgYWxyZWFk\neSBleGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBDb2RlIGdldE9yQ3JlYXRl\nQ2xhc3NJbml0Q29kZShib29sZWFuIHJlcGxhY2VMYXN0KSB7CiAgICAgICAg\nQkNNZXRob2QgY2xpbml0ID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8Y2xp\nbml0PiIpOwogICAgICAgIENvZGUgY29kZTsKICAgICAgICBpZiAoY2xpbml0\nICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZSA9IGNsaW5pdC5nZXRDb2Rl\nKHRydWUpOwogICAgICAgICAgICBpZiAocmVwbGFjZUxhc3QpIHsKICAgICAg\nICAgICAgICAgIENvZGUgdGVtcGxhdGUgPSAoQ29kZSkgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAgICAgICAgICAgICAgIGNv\nZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZS52cmV0dXJuKCkpOwogICAgICAg\nICAgICAgICAgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICAgICAgY29k\nZS5zZXQodGVtcGxhdGUubm9wKCkpOwogICAgICAgICAgICAgICAgY29kZS5u\nZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvZGU7\nCiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgc3RhdGljIGluaXRpYWxpemVy\nIG1ldGhvZCBpZiBub24gZXhpc3RzCiAgICAgICAgY2xpbml0ID0gX3BjLmRl\nY2xhcmVNZXRob2QoIjxjbGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgY2xpbml0Lm1ha2VQYWNrYWdlKCk7CiAgICAgICAgY2xpbml0LnNl\ndFN0YXRpYyh0cnVlKTsKICAgICAgICBjbGluaXQuc2V0RmluYWwodHJ1ZSk7\nCgogICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICBpZiAoIXJlcGxhY2VMYXN0KSB7CiAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOwogICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBjb2RlOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyBieXRlY29kZSBtb2RpZnlpbmcgdGhlIGNsb25pbmcgYmVoYXZpb3Igb2Yg\ndGhlIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCB0byBjb3JyZWN0bHkg\ncmVwbGFjZSB0aGUgPGNvZGU+cGNTdGF0ZU1hbmFnZXI8L2NvZGU+IAogICAg\nICogaW5zdGFuY2UgZmllbGRzIG9mIGFueSBjbG9uZSBjcmVhdGVkIHdpdGgg\ndGhlaXIgZGVmYXVsdCB2YWx1ZXMuIAogICAgICogQWxzbywgaWYgdGhpcyBj\nbGFzcyBpcyB0aGUgYmFzZSBQQyB0eXBlIGFuZCBkb2VzIG5vdCBkZWNsYXJl\nZCAKICAgICAqIGEgY2xvbmUgbWV0aG9kLCBvbmUgd2lsbCBiZSBhZGRlZC4g\nQWxzbywgaWYgX3BjIGlzIGEgc3ludGhldGljCiAgICAgKiBzdWJjbGFzcywg\nY3JlYXRlIHRoZSBjbG9uZSgpIG1ldGhvZCB0aGF0IGNsZWFycyB0aGUgc3Rh\ndGUgbWFuYWdlcgogICAgICogdGhhdCBtYXkgaGF2ZSBiZWVuIGluaXRpYWxp\nemVkIGluIGEgc3VwZXIncyBjbG9uZSgpIG1ldGhvZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZENsb25pbmdDb2RlKCkgewogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVT\ndWJjbGFzcygpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGFk\nZCB0aGUgY2xvbmUgbWV0aG9kIGlmIG5lY2Vzc2FyeQogICAgICAgIEJDTWV0\naG9kIGNsb25lID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCJjbG9uZSIsIAog\nICAgICAgICAgICAoU3RyaW5nW10pIG51bGwpOwogICAgICAgIFN0cmluZyBz\ndXBlck5hbWUgPSBfbWFuYWdlZFR5cGUuZ2V0U3VwZXJjbGFzc05hbWUoKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBudWxsOwogICAgICAgIGlmIChjbG9uZSA9\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGFkZCBjbG9uZSBzdXBwb3J0IGZv\nciBiYXNlIGNsYXNzZXMKICAgICAgICAgICAgLy8gd2hpY2ggYWxzbyBpbXBs\nZW1lbnQgY2xvbmVhYmxlCiAgICAgICAgICAgIGJvb2xlYW4gaXNDbG9uZWFi\nbGUgPSBDbG9uZWFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgKICAgICAg\nICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpOwogICAgICAgICAg\nICBib29sZWFuIGV4dGVuZHNPYmplY3QgPQogICAgICAgICAgICAgICAgc3Vw\nZXJOYW1lLmVxdWFscyhPYmplY3QuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgaWYgKCFpc0Nsb25lYWJsZSB8fCAoIWV4dGVuZHNPYmplY3QgJiYg\nIWdldENyZWF0ZVN1YmNsYXNzKCkpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgaWYgKCFnZXRDcmVhdGVTdWJjbGFzcygpKQogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKAogICAgICAgICAgICAgICAgICAg\nICAgICBfbG9jLmdldCgiZW5oYW5jZS1jbG9uZWFibGUiLCBfbWFuYWdlZFR5\ncGUuZ2V0TmFtZSgpKSk7CgogICAgICAgICAgICAvLyBhZGQgY2xvbmUgbWV0\naG9kCiAgICAgICAgICAgIC8vIHByb3RlY3RlZCBPYmplY3QgY2xvbmUgKCkg\ndGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uCiAgICAgICAgICAg\nIGNsb25lID0gX3BjLmRlY2xhcmVNZXRob2QoImNsb25lIiwgT2JqZWN0LmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFzZXRWaXNpYmlsaXR5VG9T\ndXBlck1ldGhvZChjbG9uZSkpCiAgICAgICAgICAgICAgICBjbG9uZS5tYWtl\nUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGNsb25lLmdldEV4Y2VwdGlvbnMo\ndHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoQ2xvbmVOb3RT\ndXBwb3J0ZWRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBjb2RlID0g\nY2xvbmUuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgICAgIC8vIHJldHVybiBz\ndXBlci5jbG9uZSAoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9uZSIsCiAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgLy8gZ2V0IHRoZSBjbG9uZSBtZXRob2QgY29kZQogICAgICAgICAgICBj\nb2RlID0gY2xvbmUuZ2V0Q29kZShmYWxzZSk7CiAgICAgICAgICAgIGlmIChj\nb2RlID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgc3VwZXIuY2xvbmUgKCkg\naW5zdHJ1Y3Rpb24gdG8gbWF0Y2ggYWdhaW5zdAogICAgICAgIEluc3RydWN0\naW9uIHRlbXBsYXRlID0gKChDb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFj\ndGlvbigpKSkuaW52b2tlc3BlY2lhbCgpCiAgICAgICAgICAgIC5zZXRNZXRo\nb2Qoc3VwZXJOYW1lLCAiY2xvbmUiLCBPYmplY3QuY2xhc3MuZ2V0TmFtZSgp\nLCBudWxsKTsKCiAgICAgICAgLy8gZmluZCBjYWxscyB0byB0aGUgdGVtcGxh\ndGUgaW5zdHJ1Y3Rpb247IG9uIG1hdGNoCiAgICAgICAgLy8gY2xvbmUgd2ls\nbCBiZSBvbiBzdGFjawogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKICAg\nICAgICBpZiAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewogICAg\nICAgICAgICAvLyAoKDx0eXBlPikgY2xvbmUpLnBjU3RhdGVNYW5hZ2VyID0g\nbnVsbDsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgIGNvZGUucHV0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAgICAgICAgICAgIC8vIGlm\nIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nR2V0cyB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyByZWdpc3RlcmVkIGFzIHtA\nbGluayBTZXJ2aWNlcyBzZXJ2aWNlc30uCiAgICAgKi8KICAgIHB1YmxpYyBB\ndXhpbGlhcnlFbmhhbmNlcltdIGdldEF1eGlsaWFyeUVuaGFuY2VycygpIHsK\nCQlyZXR1cm4gX2F1eEVuaGFuY2VyczsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBBbGxvdyBhbnkgcmVnaXN0ZXJlZCBhdXhpbGlhcnkgY29kZSBnZW5l\ncmF0b3JzIHRvIHJ1bi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJ1bkF1\neGlsaWFyeUVuaGFuY2VycygpIHsKICAgIAlmb3IgKGludCBpID0gMDsgaSA8\nIF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCV9hdXhFbmhhbmNl\ncnNbaV0ucnVuKF9wYywgX21ldGEpOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIG1ldGhvZCBiZSBza2lwcGVkLgog\nICAgICogCiAgICAgKiBAcGFyYW0gbWV0aG9kIG1ldGhvZCB0byBiZSBza2lw\ncGVkIG9yIG5vdAogICAgICogQHJldHVybiB0cnVlIGlmIGFueSBvZiB0aGUg\nYXV4aWxpYXJ5IGVuaGFuY2VycyBza2lwcyB0aGUgZ2l2ZW4gbWV0aG9kLAog\nICAgICogb3IgaWYgdGhlIG1ldGhvZCBpcyBhIGNvbnN0cnVjdG9yCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBza2lwRW5oYW5jZShCQ01ldGhvZCBt\nZXRob2QpIHsKICAgICAgICBpZiAoIjxpbml0PiIuZXF1YWxzKG1ldGhvZC5n\nZXROYW1lKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVu\nZ3RoOyBpKyspCiAgICAJCWlmIChfYXV4RW5oYW5jZXJzW2ldLnNraXBFbmhh\nbmNlKG1ldGhvZCkpCiAgICAJCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHN5bnRoZXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcyB0aGF0IHdpbGwgcmVw\nbGFjZSBhbGwgZGlyZWN0CiAgICAgKiBmaWVsZCBhY2Nlc3Nlcy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEFjY2Vzc29ycygpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0\nRmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxk\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkg\newogICAgICAgICAgICAgICAgaWYgKCFnZXRSZWRlZmluZSgpCiAgICAgICAg\nICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNzVHlwZSgpICE9IENsYXNz\nTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgICAgICAgICAg\nYWRkU3ViY2xhc3NTZXRNZXRob2QoZm1kc1tpXSk7CiAgICAgICAgICAgICAg\nICAgICAgYWRkU3ViY2xhc3NHZXRNZXRob2QoZm1kc1tpXSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBhZGRHZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBh\nZGRTZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBz\nZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFu\nZAogICAgICogcGVyZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVsZCB0cmFja2lu\nZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzU2V0TWV0\naG9kKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hN\nZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNzIHByb3BUeXBlID0gZm1k\nLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIFN0cmluZyBzZXR0ZXJOYW1l\nID0gZ2V0U2V0dGVyTmFtZShmbWQpOwogICAgICAgIEJDTWV0aG9kIHNldHRl\nciA9IF9wYy5kZWNsYXJlTWV0aG9kKHNldHRlck5hbWUsIHZvaWQuY2xhc3Ms\nCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgcHJvcFR5cGUgfSk7CiAgICAg\nICAgc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2Qoc2V0dGVyKTsKICAgICAg\nICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gbm90IG5lY2Vzc2FyeSBpZiB3ZSdyZSBhbHJlYWR5IHRyYWNraW5nIGFj\nY2VzcyB2aWEgcmVkZWZpbml0aW9uCiAgICAgICAgaWYgKCFnZXRSZWRlZmlu\nZSgpKSB7CiAgICAgICAgICAgIC8vIGdldCB0aGUgb3JpZyB2YWx1ZSBvbnRv\nIHN0YWNrCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsK\nICAgICAgICAgICAgaW50IHZhbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgICAgIGNvZGUueHN0b3JlKCkuc2V0TG9jYWwodmFsKS5z\nZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGFk\nZE5vdGlmeU11dGF0aW9uKGNvZGUsIGZtZCwgdmFsLCAwKTsKICAgICAgICB9\nCgogICAgICAgIC8vICMjIyMjIHRlc3QgY2FzZTogQiBleHRlbmRzIEEuIE1l\ndGhvZHMgZGVmaW5lZCBpbiBBLiBXaGF0CiAgICAgICAgLy8gIyMjIyMgaGFw\ncGVucz8KICAgICAgICAvLyBzdXBlci5zZXRYWFgoLi4uKQogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS54bG9hZCgpLnNl\ndFBhcmFtKDApLnNldFR5cGUocHJvcFR5cGUpOwogICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgp\nLAogICAgICAgICAgICBzZXR0ZXJOYW1lLCB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7IHByb3BUeXBlIH0pOwoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICBwcml2YXRlIGJv\nb2xlYW4gc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2QoQkNNZXRob2QgbWV0\naG9kKSB7CiAgICAgICAgQkNNZXRob2RbXSBtZXRob2RzID0gX21hbmFnZWRU\neXBlLmdldE1ldGhvZHMobWV0aG9kLmdldE5hbWUoKSwKICAgICAgICAgICAg\nbWV0aG9kLmdldFBhcmFtVHlwZXMoKSk7CiAgICAgICAgaWYgKG1ldGhvZHMu\nbGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1hY2Nlc3NvciIsCiAgICAgICAgICAgICAgICBf\nbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBtZXRob2QuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgQkNNZXRob2Qgc3VwZXJNZXRoID0gbWV0aG9kc1swXTsKICAgICAg\nICBpZiAoc3VwZXJNZXRoLmlzUHJpdmF0ZSgpKSB7CiAgICAgICAgICAgIG1l\ndGhvZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1BhY2thZ2UoKSkgewog\nICAgICAgICAgICBtZXRob2QubWFrZVBhY2thZ2UoKTsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChzdXBlck1ldGguaXNQ\ncm90ZWN0ZWQoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVByb3RlY3Rl\nZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2Ug\naWYgKHN1cGVyTWV0aC5pc1B1YmxpYygpKSB7CiAgICAgICAgICAgIG1ldGhv\nZC5tYWtlUHVibGljKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBnZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMg\ndG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFuZAogICAgICogcGVyZm9ybXMgYW55\nIG5lY2Vzc2FyeSBmaWVsZCB0cmFja2luZy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZFN1YmNsYXNzR2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lID0gImdldCIgKyBTdHJpbmdV\ndGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkpOwogICAgICAgIGlmIChf\nbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRoTmFtZSwgbmV3IENsYXNzWzBd\nKS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgbWV0aE5hbWUgPSAiaXMiICsg\nU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0TmFtZSgpKTsKICAgICAg\nICBCQ01ldGhvZCBnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChtZXRoTmFt\nZSwgZm1kLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICBudWxsKTsK\nICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChnZXR0ZXIpOwog\nICAgICAgIGdldHRlci5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gZ2V0dGVyLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHdlJ3Jl\nIG5vdCBhbHJlYWR5IHRyYWNraW5nIGZpZWxkIGFjY2VzcyB2aWEgcmVmbGVj\ndGlvbiwgdGhlbiB3ZQogICAgICAgIC8vIG11c3QgbWFrZSB0aGUgZ2V0dGVy\nIGhvb2sgaW4gbGF6eSBsb2FkaW5nIGJlZm9yZSBhY2Nlc3NpbmcgdGhlIHN1\ncGVyCiAgICAgICAgLy8gbWV0aG9kLgogICAgICAgIGlmICghZ2V0UmVkZWZp\nbmUoKSkKICAgICAgICAgICAgYWRkTm90aWZ5QWNjZXNzKGNvZGUsIGZtZCk7\nCgogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5hZ2VkVHlwZS5nZXRU\neXBlKCksIG1ldGhOYW1lLAogICAgICAgICAgICBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCksIG51bGwpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUo\nZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBzdGF0aWMgZ2V0dGVy\nIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICogVGhlIGdlbmVy\nYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGggdGhlIGluc3RhbmNlIHN0YXRl\nIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdlciB0byBnZXQgdGhlIHZhbHVl\nIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0gaW5kZXggdGhl\nIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmllbGQKICAgICAqIEBwYXJhbSBm\nbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxkIHRvIGdldAogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkR2V0TWV0aG9kKGludCBpbmRleCwgRmllbGRN\nZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gY3JlYXRlR2V0TWV0\naG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIC8vIGlmIHJlYWRzIGFyZSBub3QgY2hlY2tlZCwg\nanVzdCByZXR1cm4gdGhlIHZhbHVlCiAgICAgICAgYnl0ZSBmaWVsZEZsYWcg\nPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAgICAgICBpZiAoKGZpZWxkRmxhZyAm\nIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFEKSA9PSAwCiAgICAgICAg\nICAgICYmIChmaWVsZEZsYWcgJiBQZXJzaXN0ZW5jZUNhcGFibGUuTUVESUFU\nRV9SRUFEKSA9PSAwKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgY29kZS54cmV0dXJuKCku\nc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFuYWdlciA9PSBu\ndWxsKSByZXR1cm4gaW5zdC48ZmllbGQ+OwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54cmV0dXJuKCku\nc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAvLyBp\nbnQgZmllbGQgPSBwY0luaGVyaXRlZEZpZWxkQ291bnQgKyA8ZmllbGRpbmRl\neD47CiAgICAgICAgaW50IGZpZWxkTG9jYWwgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcykpOwogICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7CiAgICAgICAgY29k\nZS5pYWRkKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChmaWVs\nZExvY2FsKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5hY2Nl\nc3NpbmdGaWVsZCAoZmllbGQpOwogICAgICAgIC8vIHJldHVybiBpbnN0Ljxm\naWVsZD47CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVl\nKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGZpZWxkTG9jYWwp\nOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNN\nVFlQRSwgImFjY2Vzc2luZ0ZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAg\nICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnhyZXR1cm4o\nKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIHN0\nYXRpYyBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAg\nKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMgd2l0aCB0aGUgaW5z\ndGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3RhdGVNYW5hZ2VyIHRvIHNl\ndCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJh\nbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRoZSBmaWVsZAogICAg\nICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUgZmllbGQgdG8gc2V0\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXRNZXRob2QoaW50IGlu\nZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBj\ncmVhdGVTZXRNZXRob2QoZm1kKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gUENFbmhhbmNlciB1c2Vz\nIHN0YXRpYyBtZXRob2RzOyBQQ1N1YmNsYXNzZXIgZG9lcyBub3QuCiAgICAg\nICAgaW50IGZpcnN0UGFyYW1PZmZzZXQgPSBnZXRBY2Nlc3NvclBhcmFtZXRl\nck9mZnNldCgpOwoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFuYWdl\nciA9PSBudWxsKSBpbnN0LjxmaWVsZD4gPSB2YWx1ZTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgY29kZS54\nbG9hZCgpLnNldFBhcmFtKGZpcnN0UGFyYW1PZmZzZXQpOwogICAgICAgIGFk\nZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5z\nZXR0aW5nPGZpZWxkVHlwZT5GaWVsZCAoaW5zdCwKICAgICAgICAvLyAgICAg\ncGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGluZGV4PiwgaW5zdC48ZmllbGQ+\nLCB2YWx1ZSwgMCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSkpOwogICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAgICAgIGNvZGUuaWFk\nZCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwog\nICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVN\nYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCksICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0dGFjaCAvIGRldGFjaCBt\nZXRob2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEF0\ndGFjaERldGFjaENvZGUoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIC8vIHNlZSBpZiBhbnkgc3VwZXJjbGFzc2Vz\nIGFyZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVhbiBwYXJlbnREZXRhY2hh\nYmxlID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIHBhcmVu\ndCA9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nICAgIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKSkgewogICAgICAgICAgICBpZiAocGFyZW50Lmlz\nRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBwYXJlbnREZXRhY2hh\nYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwYXJlbnQgbm90IGRldGFj\naGFibGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRhY2ggc3RhdGUgZmllbGRz\nIGFuZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhvZHMKICAgICAgICBpZiAo\nX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVT\ndWJjbGFzcygpCiAgICAgICAgICAgIHx8IHBhcmVudERldGFjaGFibGUgIT0g\nX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgYWRkSXNEZXRh\nY2hlZE1ldGhvZCgpOwogICAgICAgICAgICBhZGREZXRhY2hlZFN0YXRlTWV0\naG9kcyhfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpCiAgICAgICAgICAgICAg\nICAhPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHdlIGRldGFjaCBvbiBzZXJpYWxpemUsIHdlIGFsc28gbmVlZCB0byBpbXBs\nZW1lbnQgdGhlCiAgICAgICAgLy8gZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNl\nIHRvIHdyaXRlIGp1c3QgdGhlIHN0YXRlIGZvciB0aGUgZmllbGRzCiAgICAg\nICAgLy8gYmVpbmcgZGV0YWNoZWQKICAgICAgICBpZiAoZXh0ZXJuYWxpemVE\nZXRhY2hlZCgpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBhZGREZXRhY2hFeHRlcm5hbGl6ZShwYXJlbnREZXRhY2hhYmxlLAogICAg\nICAgICAgICAgICAgICAgIF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkgIT0g\nQm9vbGVhbi5GQUxTRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihuc21lKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZmllbGRzIHRv\nIGhvbGQgZGV0YWNoZWQgc3RhdGUgYW5kIHRoZWlyIGFjY2Vzc29yIG1ldGhv\nZHMuCiAgICAgKgogICAgICogQHBhcmFtIGltcGwgd2hldGhlciB0byBmdWxs\neSBpbXBsZW1lbnQgZGV0YWNoIHN0YXRlIGZ1bmN0aW9uYWxpdHkKICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaGVkU3RhdGVNZXRob2RzKGJv\nb2xlYW4gaW1wbCkgewogICAgICAgIEZpZWxkIGRldGFjaEZpZWxkID0gX21l\ndGEuZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCk7CiAgICAgICAgU3RyaW5nIG5h\nbWUgPSBudWxsOwogICAgICAgIFN0cmluZyBkZWNsYXJlciA9IG51bGw7CiAg\nICAgICAgaWYgKGltcGwgJiYgZGV0YWNoRmllbGQgPT0gbnVsbCkgewogICAg\nICAgICAgICBuYW1lID0gUFJFICsgIkRldGFjaGVkU3RhdGUiOwogICAgICAg\nICAgICBkZWNsYXJlciA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIEJD\nRmllbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKG5hbWUsIE9iamVjdC5j\nbGFzcyk7CiAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAg\nICAgICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9IGVs\nc2UgaWYgKGltcGwpIHsKICAgICAgICAgICAgbmFtZSA9IGRldGFjaEZpZWxk\nLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVjbGFyZXIgPSBkZXRhY2hGaWVs\nZC5nZXREZWNsYXJpbmdDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNHZXREZXRhY2hlZFN0YXRlICgp\nCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICBPYmplY3Qu\nY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0aWMoZmFsc2Up\nOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgaW50IGFj\nY2VzcyA9IG1ldGhvZC5nZXRBY2Nlc3NGbGFncygpOwoKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1w\nbCkgewogICAgICAgICAgICAvLyByZXR1cm4gcGNEZXRhY2hlZFN0YXRlOwog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLmdldFBy\nb2plY3QoKS5sb2FkQ2xhc3MoZGVjbGFyZXIpLAogICAgICAgICAgICAgICAg\nbmFtZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBj\nU2V0RGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0YXRlKQogICAgICAgIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRl\nIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzIFtdeyBPYmpl\nY3QuY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLnNldEFjY2Vzc0ZsYWdzKGFj\nY2Vzcyk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHBjRGV0YWNoZWRT\ndGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5\ncGUuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciksCiAgICAgICAg\nICAgICAgICBuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgIH0KICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4g\ndGhlIGluc3RydWN0aW9ucyB0byBnZXQgZmllbGQKICAgICAqIDxjb2RlPmF0\ndHJOYW1lPC9jb2RlPiBkZWNsYXJlZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVy\nPC9jb2RlPgogICAgICogb250byB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAg\nICAqCiAgICAgKiBUaGUgaW5zdGFuY2UgdG8gYWNjZXNzIG11c3QgYWxyZWFk\neSBiZSBvbiB0aGUgdG9wIG9mIHRoZQogICAgICogc3RhY2sgd2hlbiB0aGlz\nIGlzIGludm9rZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRmaWVs\nZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFt\nZSkgewogICAgICAgIGlmIChkZWNsYXJlciA9PSBudWxsKQogICAgICAgICAg\nICBkZWNsYXJlciA9IF9tYW5hZ2VkVHlwZTsKCiAgICAgICAgLy8gZmlyc3Qs\nIHNlZSBpZiB3ZSBjYW4gY29udmVydCB0aGUgYXR0cmlidXRlIG5hbWUgdG8g\nYSBmaWVsZCBuYW1lCiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IHRvQmFj\na2luZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAgICAgIC8vIG5leHQsIGZp\nbmQgdGhlIGZpZWxkIGluIHRoZSBtYW5hZ2VkIHR5cGUgaGllcmFyY2h5CiAg\nICAgICAgQkNGaWVsZCBmaWVsZCA9IG51bGw7CiAgICAgICAgb3V0ZXI6IGZv\nciAoQkNDbGFzcyBiYyA9IF9wYzsgYmMgIT0gbnVsbDsgYmMgPSBiYy5nZXRT\ndXBlcmNsYXNzQkMoKSkgewogICAgICAgICAgICBCQ0ZpZWxkW10gZmllbGRz\nID0gKEJDRmllbGRbXSkgQWNjZXNzQ29udHJvbGxlcgogICAgICAgICAgICAg\nICAgLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRCQ0NsYXNzRmll\nbGRzQWN0aW9uKGJjLAogICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZSkp\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZmllbGQgPSBmaWVsZHNbaV07\nCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSByZWFjaCBhIGZpZWxkIGRlY2xh\ncmVkIGluIHRoaXMgdHlwZSwgdGhlbiB0aGlzIGlzIHRoZQogICAgICAgICAg\nICAgICAgLy8gbW9zdC1tYXNraW5nIGZpZWxkLCBhbmQgaXMgdGhlIG9uZSB0\naGF0IHdlIHdhbnQuCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmdl\ndERlY2xhcmVyKCkgPT0gZGVjbGFyZXIpIHsKICAgICAgICAgICAgICAgICAg\nICBicmVhayBvdXRlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkg\nJiYgY29kZS5nZXRNZXRob2QoKS5nZXREZWNsYXJlcigpID09IF9wYwogICAg\nICAgICAgICAmJiAoZmllbGQgPT0gbnVsbCB8fCAhZmllbGQuaXNQdWJsaWMo\nKSkpIHsKICAgICAgICAgICAgLy8gd2UncmUgY3JlYXRpbmcgdGhlIHN1YmNs\nYXNzLCBub3QgcmVkZWZpbmluZyB0aGUgdXNlciB0eXBlLgoKICAgICAgICAg\nICAgLy8gUmVmbGVjdGlvbi5nZXRYWFgodGhpcywgUmVmbGVjdGlvbi5maW5k\nRmllbGQoLi4uKSk7CiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgp\nLnNldENsYXNzKGRlY2xhcmVyKTsKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGZpZWxkTmFtZSk7CiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAg\nICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNz\nW10gewogICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFz\ncywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9\nIF9tZXRhLmdldEZpZWxkKGF0dHJOYW1lKS5nZXREZWNsYXJlZFR5cGUoKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKAogICAgICAgICAgICAgICAgICAgIGdldFJl\nZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwgRmllbGQuY2xhc3MpKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIC8vIHNob3VsZCBuZXZlciBoYXBwZW4KICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihlKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUo\nKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZGVjbGFy\nZXIuZ2V0TmFtZSgpLCBmaWVsZE5hbWUsCiAgICAgICAgICAgICAgICBmaWVs\nZC5nZXRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRvIDxjb2RlPmNvZGU8L2NvZGU+IHRoZSBpbnN0\ncnVjdGlvbnMgdG8gc2V0IGZpZWxkCiAgICAgKiA8Y29kZT5hdHRyTmFtZTwv\nY29kZT4gZGVjbGFyZWQgaW4gdHlwZSA8Y29kZT5kZWNsYXJlcjwvY29kZT4K\nICAgICAqIHRvIHRoZSB2YWx1ZSBvZiB0eXBlIDxjb2RlPmZpZWxkVHlwZTwv\nY29kZT4gb24gdGhlIHRvcCBvZiB0aGUgc3RhY2suCiAgICAgKgogICAgICog\nV2hlbiB0aGlzIG1ldGhvZCBpcyBpbnZva2VkLCB0aGUgdmFsdWUgdG8gbG9h\nZCBtdXN0CiAgICAgKiBhbHJlYWR5IGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0\nYWNrIGluIDxjb2RlPmNvZGU8L2NvZGU+LAogICAgICogYW5kIHRoZSBpbnN0\nYW5jZSB0byBsb2FkIGludG8gbXVzdCBiZSBzZWNvbmQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwdXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVj\nbGFyZXIsIFN0cmluZyBhdHRyTmFtZSwKICAgICAgICBDbGFzcyBmaWVsZFR5\ncGUpIHsKICAgICAgICBpZiAoZGVjbGFyZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgZGVjbGFyZXIgPSBfbWFuYWdlZFR5cGU7CgogICAgICAgIFN0cmluZyBm\naWVsZE5hbWUgPSB0b0JhY2tpbmdGaWVsZE5hbWUoYXR0ck5hbWUpOwoKICAg\nICAgICBpZiAoZ2V0UmVkZWZpbmUoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uc2V0KHRoaXMsIFJlZmxl\nY3Rpb24uZmluZEZpZWxkKC4uLiksIHZhbHVlKTsKICAgICAgICAgICAgY29k\nZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZGVjbGFyZXIpOwogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmllbGROYW1lKTsKICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0\naW9uLmNsYXNzLAogICAgICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICBDbGFzcy5j\nbGFzcywgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAg\nICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9u\nLmNsYXNzLCAic2V0IiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsCiAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICAg\nICAgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICAgICAgICAgIGZpZWxkVHlw\nZS5pc1ByaW1pdGl2ZSgpID8gZmllbGRUeXBlIDogT2JqZWN0LmNsYXNzLCAK\nICAgICAgICAgICAgICAgICAgICBGaWVsZC5jbGFzcyB9KTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkKICAgICAgICAg\nICAgICAgIC5zZXRGaWVsZChkZWNsYXJlci5nZXROYW1lKCksIGZpZWxkTmFt\nZSwgZmllbGRUeXBlLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogSWYgdXNpbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYg\ndGhlcmUgaXMgYSBkaWZmZXJlbnQgYmFja2luZyBmaWVsZAogICAgICogbmFt\nZSBmb3IgdGhlIHBlcnNpc3RlbnQgYXR0cmlidXRlIDxjb2RlPm5hbWU8L2Nv\nZGU+LgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyB0b0JhY2tpbmdGaWVs\nZE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNj\nZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZCiAg\nICAgICAgICAgICYmIF9hdHRyc1RvRmllbGRzICE9IG51bGwgJiYgX2F0dHJz\nVG9GaWVsZHMuY29udGFpbnNLZXkobmFtZSkpCiAgICAgICAgICAgIG5hbWUg\nPSAoU3RyaW5nKSBfYXR0cnNUb0ZpZWxkcy5nZXQobmFtZSk7CiAgICAgICAg\ncmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB1c2luZyBw\ncm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBpcyBhIGRpZmZlcmVudCBw\nZXJzaXN0ZW50CiAgICAgKiBhdHRyaWJ1dGUgbmFtZSBmb3IgdGhlIGJhY2tp\nbmcgZmllbGQgPGNvZGU+bmFtZTwvY29kZT4uCiAgICAgKi8KICAgIHByaXZh\ndGUgU3RyaW5nIGZyb21CYWNraW5nRmllbGROYW1lKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgLy8gbWV0YSBpcyBudWxsIHdoZW4gZG9pbmcgcGVyc2lzdGVu\nY2UtYXdhcmUgZW5oYW5jZW1lbnQKICAgICAgICBpZiAoX21ldGEgIT0gbnVs\nbAogICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkKICAgICAgICAgICAgJiYgX2Zp\nZWxkc1RvQXR0cnMgIT0gbnVsbCAmJiBfZmllbGRzVG9BdHRycy5jb250YWlu\nc0tleShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIChTdHJpbmcpIF9maWVs\nZHNUb0F0dHJzLmdldChuYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHJldHVybiBuYW1lOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50\nIHRoZSBleHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UgdG8gZGV0YWNoIG9uIHNl\ncmlhbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaEV4\ndGVybmFsaXplKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBi\nb29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIGRl\nY2xhcmVkIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcHVibGljIAogICAgICAg\nIC8vIGZvciBleHRlcm5hbGl6YXRpb24KICAgICAgICBCQ01ldGhvZCBtZXRo\nID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8aW5pdD4iLCAoU3RyaW5nW10p\nIG51bGwpOwogICAgICAgIGlmICghbWV0aC5pc1B1YmxpYygpKSB7CiAgICAg\nICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS1kZWZjb25zLWV4dGVy\nbiIsIAogICAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkpKTsKICAgICAgICAgICAgbWV0aC5tYWtlUHVibGljKCk7CiAgICAgICAg\nfQogICAgICAgIC8vIGRlY2xhcmUgZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNl\nCiAgICAgICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAgICAg\nIF9wYy5kZWNsYXJlSW50ZXJmYWNlKEV4dGVybmFsaXphYmxlLmNsYXNzKTsK\nCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSB1c2VyIGRvZXNuJ3QgYWxyZWFk\neSBoYXZlIGN1c3RvbSBleHRlcm5hbGl6YXRpb24gb3IKICAgICAgICAvLyBz\nZXJpYWxpemF0aW9uIG1ldGhvZHMKICAgICAgICBDbGFzc1tdIGlucHV0ID0g\nbmV3IENsYXNzW117IE9iamVjdElucHV0U3RyZWFtLmNsYXNzIH07CiAgICAg\nICAgQ2xhc3NbXSBvdXRwdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0\nU3RyZWFtLmNsYXNzIH07CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXRE\nZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsIGlucHV0KSAhPSBudWxsCiAg\nICAgICAgICAgIHx8IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhvZCgi\nd3JpdGVPYmplY3QiLCBvdXRwdXQpICE9IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZXRhY2gtY3VzdG9t\nLXNlciIsIF9tZXRhKSk7CiAgICAgICAgaW5wdXRbMF0gPSBPYmplY3RJbnB1\ndC5jbGFzczsKICAgICAgICBvdXRwdXRbMF0gPSBPYmplY3RPdXRwdXQuY2xh\nc3M7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhv\nZCgicmVhZEV4dGVybmFsIiwgaW5wdXQpICE9IG51bGwKICAgICAgICAgICAg\nfHwgX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJ3cml0ZUV4dGVy\nbmFsIiwgb3V0cHV0KSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZGV0YWNoLWN1c3RvbS1leHRlcm4i\nLCBfbWV0YSkpOwoKICAgICAgICAvLyBjcmVhdGUgbGlzdCBvZiBhbGwgdW5t\nYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkW10g\nZmllbGRzID0gX21hbmFnZWRUeXBlLmdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgQ29sbGVjdGlvbiB1bm1nZCA9IG5ldyBBcnJheUxpc3QoZmllbGRz\nLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFmaWVsZHNbaV0uaXNU\ncmFuc2llbnQoKSAmJiAhZmllbGRzW2ldLmlzU3RhdGljKCkKICAgICAgICAg\nICAgICAgICYmICFmaWVsZHNbaV0uaXNGaW5hbCgpCiAgICAgICAgICAgICAg\nICAmJiAhZmllbGRzW2ldLmdldE5hbWUoKS5zdGFydHNXaXRoKFBSRSkKICAg\nICAgICAgICAgICAgICYmIF9tZXRhLmdldERlY2xhcmVkRmllbGQoZmllbGRz\nW2ldLmdldE5hbWUoKSkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHVubWdk\nLmFkZChmaWVsZHNbaV0pOwogICAgICAgIH0KCiAgICAgICAgYWRkUmVhZEV4\ndGVybmFsKHBhcmVudERldGFjaGFibGUsIGRldGFjaGVkU3RhdGUpOwogICAg\nICAgIGFkZFJlYWRVbm1hbmFnZWQodW5tZ2QsIHBhcmVudERldGFjaGFibGUp\nOwogICAgICAgIGFkZFdyaXRlRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJsZSwg\nZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkV3JpdGVVbm1hbmFnZWQodW5t\nZ2QsIHBhcmVudERldGFjaGFibGUpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIGN1c3RvbSByZWFkRXh0ZXJuYWwgbWV0aG9kLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkUmVhZEV4dGVybmFsKGJvb2xlYW4gcGFyZW50RGV0\nYWNoYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xh\nc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXQuY2xhc3Mg\nfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2Qo\nInJlYWRFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIGluYXJncyk7CiAgICAgICAg\nRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7\nCiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFz\ncyk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdl\ndENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLnJlYWRFeHRlcm5hbCAo\naW4pOwogICAgICAgIENsYXNzIHN1cCA9IF9tZXRhLmdldERlc2NyaWJlZFR5\ncGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKCFwYXJlbnREZXRh\nY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZy\nb20oc3VwKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2Qoc3VwLCAicmVhZEV4dGVybmFsIiwKICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIGluYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFkVW5t\nYW5hZ2VkIChpbik7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChnZXRUeXBl\nKF9tZXRhKSwKICAgICAgICAgICAgUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2\nb2lkLmNsYXNzLCBpbmFyZ3MpOwoKICAgICAgICBpZiAoZGV0YWNoZWRTdGF0\nZSkgewogICAgICAgICAgICAvLyBwY1NldERldGFjaGVkU3RhdGUgKGluLnJl\nYWRPYmplY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNl\ndE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRPYmplY3QiLAogICAg\nICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXREZXRh\nY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CgogICAgICAgICAgICAvLyBwY1Jl\ncGxhY2VTdGF0ZU1hbmFnZXIgKChTdGF0ZU1hbmFnZXIpIGluLnJlYWRPYmpl\nY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRPYmplY3QiLAogICAgICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKFN0YXRlTWFuYWdlci5jbGFzcyk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nUmVwbGFjZVN0YXRlTWFuYWdlciIsCiAgICAgICAgICAgICAgICB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXXsgU3RhdGVNYW5hZ2VyLmNsYXNzIH0pOwogICAg\nICAgIH0KCiAgICAgICAgLy8gcmVhZCBtYW5hZ2VkIGZpZWxkcwogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAg\nICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmbWRzW2ldLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZSgpLCBmbWRzW2ldKTsKCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFk\nIHVubWFuYWdlZCBmaWVsZHMgZnJvbSB0aGUgc3RyZWFtIChwY1JlYWRVbm1h\nbmFnZWQpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUmVhZFVubWFu\nYWdlZChDb2xsZWN0aW9uIHVubWdkLCBib29sZWFuIHBhcmVudERldGFjaGFi\nbGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5w\ndXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLAog\nICAgICAgICAgICBpbmFyZ3MpOwogICAgICAgIG1ldGgubWFrZVByb3RlY3Rl\nZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNl\ncHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9F\neGNlcHRpb24uY2xhc3MpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24o\nQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBj\nb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci5y\nZWFkVW5tYW5hZ2VkIChpbik7CiAgICAgICAgaWYgKHBhcmVudERldGFjaGFi\nbGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdl\ndFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpKSwgUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2b2lkLmNsYXNz\nLCAKICAgICAgICAgICAgICAgIGluYXJncyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyByZWFkIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJpYWxpemFibGUgZmll\nbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmaWVsZC5nZXROYW1lKCks\nIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZWFkIGEgZmllbGQg\nZnJvbSBhbiBleHRlcm5hbGl6YXRpb24gaW5wdXQgc3RyZWFtLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcmVhZEV4dGVybmFsKENvZGUgY29kZSwgU3Ry\naW5nIGZpZWxkTmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWU7CiAgICAgICAgaWYgKHR5cGUu\naXNQcmltaXRpdmUoKSkgewogICAgICAgICAgICBtZXRoTmFtZSA9IHR5cGUu\nZ2V0TmFtZSgpOwogICAgICAgICAgICBtZXRoTmFtZSA9IENoYXJhY3Rlci50\nb1VwcGVyQ2FzZShtZXRoTmFtZS5jaGFyQXQoMCkpCiAgICAgICAgICAgICAg\nICArIG1ldGhOYW1lLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgbWV0aE5h\nbWUgPSAicmVhZCIgKyBtZXRoTmFtZTsKICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgbWV0aE5hbWUgPSAicmVhZE9iamVjdCI7CgogICAgICAgIC8vIDxm\naWVsZD4gPSBpbi5yZWFkPHR5cGU+ICgpOwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICBDbGFzcyByZXQgPSAodHlwZS5pc1ByaW1p\ndGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXQuY2xhc3Ms\nIG1ldGhOYW1lLAogICAgICAgICAgICByZXQsIG51bGwpOwogICAgICAgIGlm\nICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNz\nKQogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7\nCiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBwdXRmaWVs\nZChjb2RlLCBudWxsLCBmaWVsZE5hbWUsIHR5cGUpOwogICAgICAgIGVsc2Ug\newogICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZt\nZCk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAgICAgICAgIC8vIGlmIChz\nbSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIC8vICAgc20ucHJveHlE\nZXRhY2hlZERlc2VyaWFsaXplZCAoPGluZGV4Pik7CiAgICAgICAgICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgICAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZp\nbnMgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgICAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1k\nLmdldEluZGV4KCkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwKICAgICAgICAgICAgICAg\nICAgICAgICAgInByb3h5RGV0YWNoZWREZXNlcmlhbGl6ZWQiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50\nLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgICAgIGlmaW5zLnNldFRhcmdl\ndChjb2RlLm5vcCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBjdXN0b20gd3JpdGVFeHRlcm5hbCBtZXRo\nb2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZUV4dGVybmFs\nKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFuIGRl\ndGFjaGVkU3RhdGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQ2xhc3NbXSBvdXRhcmdzID0gbmV3IENsYXNzW117\nIE9iamVjdE91dHB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGgg\nPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVFeHRlcm5hbCIsIHZvaWQuY2xh\nc3MsIG91dGFyZ3MpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0\naC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNl\ncHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIud3JpdGVF\neHRlcm5hbCAob3V0KTsKICAgICAgICBDbGFzcyBzdXAgPSBnZXRUeXBlKF9t\nZXRhKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKCFwYXJlbnREZXRh\nY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZy\nb20oc3VwKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2Qoc3VwLCAid3JpdGVFeHRlcm5hbCIsCiAgICAgICAgICAgICAgICB2b2lk\nLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHdyaXRl\nVW5tYW5hZ2VkIChvdXQpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0\nVHlwZShfbWV0YSksCiAgICAgICAgICAgIFBSRSArICJXcml0ZVVubWFuYWdl\nZCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwoKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gZ28yID0gbnVsbDsKICAgICAgICBpZiAoZGV0YWNoZWRTdGF0ZSkg\newogICAgICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAg\nLy8gICBpZiAoc20ud3JpdGVEZXRhY2hlZCAob3V0KSkKICAgICAgICAgICAg\nLy8gICAgICByZXR1cm47CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIElmSW5zdHJ1Y3Rp\nb24gaWZudWxsID0gY29kZS5pZm51bGwoKTsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJ3cml0ZURldGFj\naGVkIiwKICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG91dGFyZ3Mp\nOwogICAgICAgICAgICBnbzIgPSBjb2RlLmlmZXEoKTsKICAgICAgICAgICAg\nY29kZS52cmV0dXJuKCk7CgogICAgICAgICAgICAvLyBlbHNlCiAgICAgICAg\nICAgIC8vICAgb3V0LndyaXRlT2JqZWN0IChwY0dldERldGFjaGVkU3RhdGUg\nKCkpOwogICAgICAgICAgICBDbGFzc1tdIG9iamFyZ3MgPSBuZXcgQ2xhc3Nb\nXXsgT2JqZWN0LmNsYXNzIH07CiAgICAgICAgICAgIGlmbnVsbC5zZXRUYXJn\nZXQoY29kZS5hbG9hZCgpLnNldFBhcmFtKDApKTsKICAgICAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNo\nZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChPYmplY3RPdXRwdXQuY2xhc3MsCiAgICAgICAgICAgICAgICAid3JpdGVP\nYmplY3QiLCB2b2lkLmNsYXNzLCBvYmphcmdzKTsKICAgICAgICAgICAgLy8g\nICAgb3V0LndyaXRlT2JqZWN0IChudWxsKSAvLyBTdGF0ZU1hbmFnZXIKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKE9iamVjdCkgbnVsbCk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9i\namVjdE91dHB1dC5jbGFzcywKICAgICAgICAgICAgICAgICJ3cml0ZU9iamVj\ndCIsIHZvaWQuY2xhc3MsIG9iamFyZ3MpOwogICAgICAgIH0KICAgICAgICBp\nZiAoZ28yICE9IG51bGwpCiAgICAgICAgICAgIGdvMi5zZXRUYXJnZXQoY29k\nZS5ub3AoKSk7CgogICAgICAgIC8vIHdyaXRlIG1hbmFnZWQgZmllbGRzCiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1RyYW5zaWVudCgpKQog\nICAgICAgICAgICAgICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmbWRzW2ldLmdl\ndE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZSgpLCBmbWRzW2ldKTsKCiAgICAgICAgLy8gcmV0dXJuCiAgICAg\nICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB1bm1hbmFnZWQgZmllbGRzIHRv\nIHRoZSBzdHJlYW0gKHBjV3JpdGVVbm1hbmFnZWQpLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkV3JpdGVVbm1hbmFnZWQoQ29sbGVjdGlvbiB1bm1n\nZCwgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlKQogICAgICAgIHRocm93cyBO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNzW10gb3V0YXJn\ncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRwdXQuY2xhc3MgfTsKICAgICAg\nICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIldy\naXRlVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgb3V0YXJn\ncyk7CiAgICAgICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhj\nZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAg\nICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBzdXBlci53cml0ZVVubWFuYWdlZCAob3V0KTsKICAgICAgICBp\nZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAg\nIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiV3JpdGVVbm1h\nbmFnZWQiLCB2b2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIG91dGFyZ3Mp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gd3JpdGUgZGVjbGFyZWQgdW5tYW5h\nZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxk\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAoQkNG\naWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgd3JpdGVFeHRlcm5hbChj\nb2RlLCBmaWVsZC5nZXROYW1lKCksIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7\nCiAgICAgICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1l\ndGhvZCB0byB3cml0ZSBhIGZpZWxkIHRvIGFuIGV4dGVybmFsaXphdGlvbiBv\ndXRwdXQgc3RyZWFtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd3JpdGVF\neHRlcm5hbChDb2RlIGNvZGUsIFN0cmluZyBmaWVsZE5hbWUsIENsYXNzIHR5\ncGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1ldGhO\nYW1lOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpIHsKICAgICAg\nICAgICAgbWV0aE5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICAgICAg\nbWV0aE5hbWUgPSBDaGFyYWN0ZXIudG9VcHBlckNhc2UobWV0aE5hbWUuY2hh\nckF0KDApKQogICAgICAgICAgICAgICAgKyBtZXRoTmFtZS5zdWJzdHJpbmco\nMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gIndyaXRlIiArIG1ldGhOYW1l\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJ3cml0\nZU9iamVjdCI7CgogICAgICAgIC8vIG91dC53cml0ZTx0eXBlPiAoPGZpZWxk\nPik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVs\nbCwgZmllbGROYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBDbGFzc1td\nIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgdHlwZSB9OwogICAgICAgIGlmICh0eXBl\nID09IGJ5dGUuY2xhc3MgfHwgdHlwZSA9PSBjaGFyLmNsYXNzIHx8IHR5cGUg\nPT0gc2hvcnQuY2xhc3MpCiAgICAgICAgICAgIGFyZ3NbMF0gPSBpbnQuY2xh\nc3M7CiAgICAgICAgZWxzZSBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSkKICAg\nICAgICAgICAgYXJnc1swXSA9IE9iamVjdC5jbGFzczsKICAgICAgICBjb2Rl\nLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xh\nc3MsIG1ldGhOYW1lLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBhcmdzKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZhbHVlQ29k\nZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kLCB0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIExvYWQgdGhlIGZpZWxkIHZhbHVlIHNwZWNpZmllZCBieSA8Y29k\nZT5mbWQ8L2NvZGU+IG9udG8gdGhlIHN0YWNrLgogICAgICogQmVmb3JlIHRo\naXMgbWV0aG9kIGlzIGNhbGxlZCwgdGhlIG9iamVjdCB0aGF0IHRoZSBkYXRh\nIHNob3VsZCBiZSBsb2FkZWQKICAgICAqIGZyb20gd2lsbCBiZSBvbiB0aGUg\ndG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVNh\nbWVDbGFzcyBpZiA8Y29kZT50cnVlPC9jb2RlPiwgdGhlbiA8Y29kZT5mbWQ8\nL2NvZGU+IGlzCiAgICAgKiBiZWluZyBsb2FkZWQgZnJvbSBhbiBpbnN0YW5j\nZSBvZiB0aGUgc2FtZSBjbGFzcyBhcyB0aGUgY3VycmVudCBleGVjdXRpb24K\nICAgICAqIGNvbnRleHQuIElmIDxjb2RlPmZhbHNlPC9jb2RlPiwgdGhlbiB0\naGUgaW5zdGFuY2Ugb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sKICAgICAqIG1p\nZ2h0IGJlIGEgc3VwZXJjbGFzcyBvZiB0aGUgY3VycmVudCBleGVjdXRpb24g\nY29udGV4dCdzICd0aGlzJyBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVs\nZE1ldGFEYXRhIGZtZCwKICAgICAgICBib29sZWFuIGZyb21TYW1lQ2xhc3Mp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gaWYgcmVkZWZpbmluZywgdGhlbiB3ZSBtdXN0IGFsd2F5cyByZWZs\nZWN0IChvciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAgICAgLy8gZGlyZWN0bHkg\naWYgYWNjZXNzaWJsZSksIHNpbmNlIHRoZSByZWRlZmluZWQgbWV0aG9kcyB3\naWxsIGFsd2F5cwogICAgICAgIC8vIHRyaWdnZXIgbWV0aG9kIGNhbGxzIHRv\nIFN0YXRlTWFuYWdlciwgZXZlbiBmcm9tIGludGVybmFsIGRpcmVjdC0KICAg\nICAgICAvLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxkIHdvcmsgYXJvdW5kIHRo\naXMgYnkgbm90IHJlZGVmaW5pbmcsIGFuZAogICAgICAgIC8vIGp1c3QgZG8g\nYSBzdWJjbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBCdXQgdGhpcyBpcyBub3Qg\nYSBnb29kIG9wdGlvbiwKICAgICAgICAvLyBzaW5jZSBpdCB3b3VsZCBzYWNy\naWZpY2UgbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2llbnQgZGlydHkgdHJhY2tp\nbmcuCgogICAgICAgIGlmIChnZXRSZWRlZmluZSgpCiAgICAgICAgICAgIHx8\nIF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VT\nU19GSUVMRCkgewogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBudWxsLCBm\nbWQuZ2V0TmFtZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKGdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzLCBh\nbmQgd2UncmUgbm90IHJlZGVmaW5pbmcuIElmIHdlJ3JlIG9wZXJhdGluZwog\nICAgICAgICAgICAvLyBvbiBhbiBpbnN0YW5jZSB0aGF0IGlzIGRlZmluaXRl\nbHkgdGhlIHNhbWUgdHlwZSBhcyAndGhpcycsIHRoZW4KICAgICAgICAgICAg\nLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZCB0byBieXBhc3MgdHJhY2tpbmcu\nIE90aGVyd2lzZSwgcmVmbGVjdAogICAgICAgICAgICAvLyB0byBib3RoIGJ5\ncGFzcyB0cmFja2luZyBhbmQgYXZvaWQgY2xhc3MgdmVyaWZpY2F0aW9uIGVy\ncm9ycy4KICAgICAgICAgICAgaWYgKGZyb21TYW1lQ2xhc3MpIHsKICAgICAg\nICAgICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tp\nbmdNZW1iZXIoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChtZXRoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1l\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgLy8gcmVndWxhciBlbmhhbmNlbWVudCArIHByb3BlcnR5IGFjY2Vzcwog\nICAgICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNr\naW5nTWVtYmVyKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5\ncGVzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3Jl\nIHRoZSB2YWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjayBpbnRvIHRoZSBm\naWVsZCB2YWx1ZSBzcGVjaWZpZWQKICAgICAqIGJ5IDxjb2RlPmZtZDwvY29k\nZT4uIEJlZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBkYXRhIHRv\nIGxvYWQgd2lsbAogICAgICogYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sg\nYW5kIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9hZGVk\nCiAgICAgKiBpbnRvIHdpbGwgYmUgc2Vjb25kIGluIHRoZSBzdGFjay4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUo\nQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiByZWRlZmlu\naW5nLCB0aGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0\naGUgZmllbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwg\nc2luY2UgdGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlzCiAgICAg\nICAgLy8gdHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBl\ndmVuIGZyb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFjY2VzcyB1\nc2FnZS4gV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3QgcmVkZWZp\nbmluZywgYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNzIGFwcHJv\nYWNoIGluc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAog\nICAgICAgIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5IGxvYWRp\nbmcgYW5kIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAgICAgaWYg\nKGdldFJlZGVmaW5lKCkKICAgICAgICAgICAgfHwgX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAg\nICAgICAgIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCksIGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIHByb3BlcnR5IGFj\nY2VzcywgYW5kIHdlJ3JlIG5vdCByZWRlZmluaW5nLiBpbnZva2UgdGhlCiAg\nICAgICAgICAgIC8vIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFj\na2luZy4KICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBn\nZXRTZXR0ZXJOYW1lKGZtZCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2Vt\nZW50ICsgcHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyBnZXRTZXR0ZXJOYW1lKGZtZCks\nCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG9mZnNldCB0aGF0IHRoZSBmaXJzdCBt\nZWFuaW5nZnVsIGFjY2Vzc29yIHBhcmFtZXRlciBpcyBhdC4KICAgICAqLwog\nICAgcHJpdmF0ZSBpbnQgZ2V0QWNjZXNzb3JQYXJhbWV0ZXJPZmZzZXQoKSB7\nCiAgICAgICAgcmV0dXJuIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpID8gMSA6IDA7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgdGhlIHtAbGluayBJbnN0cnVjdGlvbn1zIHRvIGxv\nYWQgdGhlIGluc3RhbmNlIHRvIG1vZGlmeSBvbnRvIHRoZQogICAgICogc3Rh\nY2ssIGFuZCByZXR1cm4gaXQuIElmIDxjb2RlPmZvclN0YXRpYzwvY29kZT4g\naXMgc2V0LCB0aGVuCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiBpcyBpbiBh\nbiBhY2Nlc3NvciBtZXRob2Qgb3IgYW5vdGhlciBzdGF0aWMgbWV0aG9kOwog\nICAgICogb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2YgdGhlIFBDLXNwZWNp\nZmllZCBtZXRob2RzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpcnN0\nIGluc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+LgogICAg\nICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYykgewogICAgICAgIGlm\nIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NF\nU1NfRklFTEQgJiYgZm9yU3RhdGljKQogICAgICAgICAgICByZXR1cm4gY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIHJldHVybiBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIHRoZSBnZW5lcmF0ZWQgZ2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9yIDxj\nb2RlPmZtZDwvY29kZT4uIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9ubWVu\ndCB3aWxsIHRoZW4gcG9wdWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJsb2Nr\nLgogICAgICovCiAgICBwcml2YXRlIEJDTWV0aG9kIGNyZWF0ZUdldE1ldGhv\nZChGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIEJDTWV0aG9kIGdldHRl\ncjsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNz\nTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgIC8vIHN0YXRp\nYyA8ZmllbGR0eXBlPiBwY0dldDxmaWVsZD4gKFhYWCBpbnN0KQogICAgICAg\nICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERlY2xhcmVkRmllbGQoZm1k\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGdldHRlciA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArICJHZXQiICsgZm1kLmdldE5hbWUoKSwgZm1kLgogICAg\nICAgICAgICAgICAgZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0TmFtZSgpLCBuZXcg\nU3RyaW5nW117IF9wYy5nZXROYW1lKCkgfSk7CiAgICAgICAgICAgIGdldHRl\nci5zZXRBY2Nlc3NGbGFncyhmaWVsZC5nZXRBY2Nlc3NGbGFncygpCiAgICAg\nICAgICAgICAgICAmIH5Db25zdGFudHMuQUNDRVNTX1RSQU5TSUVOVCAmIH5D\nb25zdGFudHMuQUNDRVNTX1ZPTEFUSUxFKTsKICAgICAgICAgICAgZ2V0dGVy\nLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAgZ2V0dGVyLnNldEZpbmFs\nKHRydWUpOwogICAgICAgICAgICByZXR1cm4gZ2V0dGVyOwogICAgICAgIH0K\nCiAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzOgogICAgICAgIC8vIGNvcHkg\ndGhlIHVzZXIncyBnZXR0ZXIgbWV0aG9kIHRvIGEgbmV3IG5hbWU7IHdlIGNh\nbid0IGp1c3QgcmVzZXQKICAgICAgICAvLyB0aGUgbmFtZSwgYmVjYXVzZSB0\naGF0IHdpbGwgYWxzbyByZXNldCBhbGwgY2FsbHMgdG8gdGhlIG1ldGhvZAog\nICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tpbmdN\nZW1iZXIoKTsKICAgICAgICBnZXR0ZXIgPSBfcGMuZ2V0RGVjbGFyZWRNZXRo\nb2QobWV0aC5nZXROYW1lKCksCiAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1l\ndGVyVHlwZXMoKSk7CiAgICAgICAgQkNNZXRob2QgbmV3Z2V0dGVyID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgbWV0aC5nZXROYW1lKCksCiAgICAgICAg\nICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5\ncGVzKCkpOwogICAgICAgIG5ld2dldHRlci5zZXRBY2Nlc3NGbGFncyhnZXR0\nZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7CiAgICAgICAgbmV3Z2V0dGVyLm1ha2VQ\ncm90ZWN0ZWQoKTsgCiAgICAgICAgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhn\nZXR0ZXIsIG5ld2dldHRlcik7CiAgICAgICAgcmV0dXJuIGdldHRlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgZ2VuZXJhdGVkIHNldHRl\nciB7QGxpbmsgQkNNZXRob2R9IGZvciA8Y29kZT5mbWQ8L2NvZGU+LiBUaGUK\nICAgICAqIGNhbGxpbmcgZW52aXJvbm1lbnQgd2lsbCB0aGVuIHBvcHVsYXRl\nIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9jay4KICAgICAqLwogICAgcHJpdmF0\nZSBCQ01ldGhvZCBjcmVhdGVTZXRNZXRob2QoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBCQ01ldGhvZCBzZXR0ZXI7CiAgICAgICAgaWYgKF9tZXRh\nLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVM\nRCkgewogICAgICAgICAgICAvLyBzdGF0aWMgdm9pZCBwY1NldDxmaWVsZD4g\nKFhYWCBpbnN0LCA8ZmllbGR0eXBlPiB2YWx1ZSkKICAgICAgICAgICAgQkNG\naWVsZCBmaWVsZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKGZtZC5nZXROYW1l\nKCkpOwogICAgICAgICAgICBzZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiU2V0IiArIGZtZC5nZXROYW1lKCksIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZ2V0VHlwZShfbWV0YSksIGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAgICAgc2V0dGVyLnNldEFj\nY2Vzc0ZsYWdzKGZpZWxkLmdldEFjY2Vzc0ZsYWdzKCkKICAgICAgICAgICAg\nICAgICYgfkNvbnN0YW50cy5BQ0NFU1NfVFJBTlNJRU5UICYgfkNvbnN0YW50\ncy5BQ0NFU1NfVk9MQVRJTEUpOwogICAgICAgICAgICBzZXR0ZXIuc2V0U3Rh\ndGljKHRydWUpOwogICAgICAgICAgICBzZXR0ZXIuc2V0RmluYWwodHJ1ZSk7\nCiAgICAgICAgICAgIHJldHVybiBzZXR0ZXI7CiAgICAgICAgfQoKICAgICAg\nICAvLyBwcm9wZXJ0eSBhY2Nlc3M6CiAgICAgICAgLy8gY29weSB0aGUgdXNl\ncidzIGdldHRlciBtZXRob2QgdG8gYSBuZXcgbmFtZTsgd2UgY2FuJ3QganVz\ndCByZXNldAogICAgICAgIC8vIHRoZSBuYW1lLCBiZWNhdXNlIHRoYXQgd2ls\nbCBhbHNvIHJlc2V0IGFsbCBjYWxscyB0byB0aGUgbWV0aG9kCiAgICAgICAg\nc2V0dGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKGdldFNldHRlck5hbWUo\nZm1kKSwKICAgICAgICAgICAgbmV3IENsYXNzW117IGZtZC5nZXREZWNsYXJl\nZFR5cGUoKSB9KTsKICAgICAgICBCQ01ldGhvZCBuZXdzZXR0ZXIgPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyBzZXR0ZXIuZ2V0TmFtZSgpLAogICAgICAg\nICAgICBzZXR0ZXIuZ2V0UmV0dXJuTmFtZSgpLCBzZXR0ZXIuZ2V0UGFyYW1O\nYW1lcygpKTsKICAgICAgICBuZXdzZXR0ZXIuc2V0QWNjZXNzRmxhZ3Moc2V0\ndGVyLmdldEFjY2Vzc0ZsYWdzKCkpOwogICAgICAgIG5ld3NldHRlci5tYWtl\nUHJvdGVjdGVkKCk7CiAgICAgICAgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhz\nZXR0ZXIsIG5ld3NldHRlcik7CiAgICAgICAgcmV0dXJuIHNldHRlcjsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFj\ndFZlcnNpb25NZXRob2QoKSB7CiAgICAgICAgLy8gcHVibGljIGludCBnZXRF\nbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgCiAgICAgICAgICAg\nICAgICAiR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb24iLCBpbnQuY2xh\nc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKEVOSEFOQ0VSX1ZFUlNJT04pOwog\nICAgICAgIGNvZGUuaXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25jcmV0ZSB0\neXBlIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIGkuZS4gaW1wbCBmb3IgbWFuYWdl\nZAogICAgICogaW50ZXJmYWNlcwogICAgICovCiAgICBwdWJsaWMgQ2xhc3Mg\nZ2V0VHlwZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0\nYS5nZXRJbnRlcmZhY2VJbXBsKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIHJldHVybiBt\nZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1vdmUgY29kZS1yZWxhdGVkIGF0dHJpYnV0ZXMgZnJvbSBvbmUgbWV0aG9k\nIHRvIGFub3RoZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQg\ndHJhbnNmZXJDb2RlQXR0cmlidXRlcyhCQ01ldGhvZCBmcm9tLCBCQ01ldGhv\nZCB0bykgewogICAgICAgIENvZGUgY29kZSA9IGZyb20uZ2V0Q29kZShmYWxz\nZSk7CiAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCkgewogICAgICAgICAgICB0\nby5hZGRBdHRyaWJ1dGUoY29kZSk7CiAgICAgICAgICAgIGZyb20ucmVtb3Zl\nQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMg\nPSBmcm9tLmdldEV4Y2VwdGlvbnMoZmFsc2UpOwogICAgICAgIGlmIChleGNl\ncHMgIT0gbnVsbCkKICAgICAgICAgICAgdG8uYWRkQXR0cmlidXRlKGV4Y2Vw\ncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBh\nY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0VuaGFuY2VyIFtvcHRpb25dKgogICAg\nICogJmx0O2NsYXNzIG5hbWUgfCAuamF2YSBmaWxlIHwgLmNsYXNzIGZpbGUg\nfCAuamRvIGZpbGUmZ3Q7KwogICAgICogIFdoZXJlIHRoZSBmb2xsb3dpbmcg\nb3B0aW9ucyBhcmUgcmVjb2duaXplZC4KICAgICAqIDx1bD4KICAgICAqIDxs\naT48aT4tcHJvcGVydGllcy8tcCAmbHQ7cHJvcGVydGllcyBmaWxlJmd0Ozwv\naT46IFRoZSBwYXRoIHRvIGEgT3BlbkpQQQogICAgICogcHJvcGVydGllcyBm\naWxlIGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYXMgb3V0bGluZWQgaW4KICAg\nICAqIHtAbGluayBDb25maWd1cmF0aW9ufTsgb3B0aW9uYWwuPC9saT4KICAg\nICAqIDxsaT48aT4tJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7ICZsdDtwcm9wZXJ0\neSB2YWx1ZSZndDs8L2k+OiBBbGwgYmVhbgogICAgICogcHJvcGVydGllcyBv\nZiB0aGUgc3RhbmRhcmQgT3BlbkpQQSB7QGxpbmsgT3BlbkpQQUNvbmZpZ3Vy\nYXRpb259IGNhbiBiZQogICAgICogc2V0IGJ5IHVzaW5nIHRoZWlyIG5hbWVz\nIGFuZCBzdXBwbHlpbmcgYSB2YWx1ZTsgZm9yIGV4YW1wbGU6CiAgICAgKiA8\nbGk+PGk+LWRpcmVjdG9yeS8tZCAmbHQ7YnVpbGQgZGlyZWN0b3J5Jmd0Ozwv\naT46IFRoZSBwYXRoIHRvIHRoZSBiYXNlCiAgICAgKiBkaXJlY3Rvcnkgd2hl\ncmUgZW5oYW5jZWQgY2xhc3NlcyBhcmUgc3RvcmVkLiBCeSBkZWZhdWx0LCB0\naGUKICAgICAqIGVuaGFuY2VyIG92ZXJ3cml0ZXMgdGhlIG9yaWdpbmFsIC5j\nbGFzcyBmaWxlIHdpdGggdGhlIGVuaGFuY2VkCiAgICAgKiB2ZXJzaW9uLiBV\nc2UgdGhpcyBvcHRpb24gdG8gc3RvcmUgdGhlIGdlbmVyYXRlZCAuY2xhc3Mg\nZmlsZSBpbgogICAgICogYW5vdGhlciBkaXJlY3RvcnkuIFRoZSBwYWNrYWdl\nIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0aAogICAgICogdGhl\nIGdpdmVuIGRpcmVjdG9yeS48L2xpPgogICAgICogPGxpPjxpPi1hZGREZWZh\ndWx0Q29uc3RydWN0b3IvLWFkYyBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+OiBX\naGV0aGVyIHRvCiAgICAgKiBhZGQgYSBkZWZhdWx0IGNvbnN0cnVjdG9yIHRv\nIHBlcnNpc3RlbnQgY2xhc3NlcyBtaXNzaW5nIG9uZSwgYXMKICAgICAqIG9w\ncG9zZWQgdG8gdGhyb3dpbmcgYW4gZXhjZXB0aW9uLiBEZWZhdWx0cyB0byB0\ncnVlLjwvbGk+CiAgICAgKiA8bGk+PGk+LXRtcENsYXNzTG9hZGVyLy10Y2wg\nW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwogICAgICogbG9h\nZCB0aGUgcHJlLWVuaGFuY2VkIGNsYXNzZXMgdXNpbmcgYSB0ZW1wb3Jhcnkg\nY2xhc3MgbG9hZGVyLgogICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4gU2V0IHRo\naXMgdG8gZmFsc2Ugd2hlbiBhdHRlbXB0aW5nIHRvIGRlYnVnCiAgICAgKiBj\nbGFzcyBsb2FkaW5nIGVycm9ycy48L2xpPgogICAgICogPGxpPjxpPi1lbmZv\ncmNlUHJvcGVydHlSZXN0cmljdGlvbnMvLWVwciBbdHJ1ZS90IHwgZmFsc2Uv\nZl08L2k+OgogICAgICogV2hldGhlciB0byB0aHJvdyBhbiBleGNlcHRpb24g\naWYgYSBQUk9QRVJUWSBhY2Nlc3MgZW50aXR5IGFwcGVhcnMKICAgICAqIHRv\nIGJlIHZpb2xhdGluZyBzdGFuZGFyZCBwcm9wZXJ0eSByZXN0cmljdGlvbnMu\nIERlZmF1bHRzIHRvIGZhbHNlLjwvbGk+CiAgICAgKiA8L3VsPgogICAgICog\nIEVhY2ggYWRkaXRpb25hbCBhcmd1bWVudCBjYW4gYmUgZWl0aGVyIHRoZSBm\ndWxsIGNsYXNzIG5hbWUgb2YgdGhlCiAgICAgKiB0eXBlIHRvIGVuaGFuY2Us\nIHRoZSBwYXRoIHRvIHRoZSAuamF2YSBmaWxlIGZvciB0aGUgdHlwZSwgdGhl\nIHBhdGggdG8KICAgICAqIHRoZSAuY2xhc3MgZmlsZSBmb3IgdGhlIHR5cGUs\nIG9yIHRoZSBwYXRoIHRvIGEgLmpkbyBmaWxlIGxpc3Rpbmcgb25lCiAgICAg\nKiBvciBtb3JlIHR5cGVzIHRvIGVuaGFuY2UuCiAgICAgKiBJZiB0aGUgdHlw\nZSBiZWluZyBlbmhhbmNlZCBoYXMgbWV0YWRhdGEsIGl0IHdpbGwgYmUgZW5o\nYW5jZWQgYXMgYQogICAgICogcGVyc2lzdGVuY2UgY2FwYWJsZSBjbGFzcy4g\nSWYgbm90LCBpdCB3aWxsIGJlIGNvbnNpZGVyZWQgYSBwZXJzaXN0ZW5jZQog\nICAgICogYXdhcmUgY2xhc3MsIGFuZCBhbGwgYWNjZXNzIHRvIGZpZWxkcyBv\nZiBwZXJzaXN0ZW5jZSBjYXBhYmxlIGNsYXNzZXMKICAgICAqIHdpbGwgYmUg\ncmVwbGFjZWQgYnkgdGhlIGFwcHJvcHJpYXRlCWdldC9zZXQgbWV0aG9kLiBJ\nZiB0aGUgdHlwZQogICAgICogZXhwbGljaXRseSBkZWNsYXJlcyB0aGUgcGVy\nc2lzdGVuY2UtY2FwYWJsZSBpbnRlcmZhY2UsIGl0IHdpbGwKICAgICAqIG5v\ndCBiZSBlbmhhbmNlZC4gVGh1cywgaXQgaXMgc2FmZSB0byBpbnZva2UgdGhl\nIGVuaGFuY2VyIG9uIGNsYXNzZXMKICAgICAqIHRoYXQgYXJlIGFscmVhZHkg\nZW5oYW5jZWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWlu\nKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcg\nT3B0aW9ucygpOwogICAgICAgIGFyZ3MgPSBvcHRzLnNldEZyb21DbWRMaW5l\nKGFyZ3MpOwogICAgICAgIGlmICghcnVuKGFyZ3MsIG9wdHMpKQogICAgICAg\nICAgICBTeXN0ZW0uZXJyLnByaW50bG4oX2xvYy5nZXQoImVuaGFuY2UtdXNh\nZ2UiKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJl\ndHVybnMgZmFsc2UgaWYgaW52YWxpZCBvcHRpb25zIGdpdmVuLiBSdW5zIGFn\nYWluc3QgYWxsCiAgICAgKiB0aGUgcGVyc2lzdGVuY2UgdW5pdHMgZGVmaW5l\nZCBpbiB0aGUgcmVzb3VyY2UgdG8gcGFyc2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgYm9vbGVhbiBydW4oZmluYWwgU3RyaW5nW10gYXJncywgT3B0\naW9ucyBvcHRzKSB7CiAgICAgICAgcmV0dXJuIENvbmZpZ3VyYXRpb25zLnJ1\nbkFnYWluc3RBbGxBbmNob3JzKG9wdHMsCiAgICAgICAgICAgIG5ldyBDb25m\naWd1cmF0aW9ucy5SdW5uYWJsZSgpIHsKICAgICAgICAgICAgcHVibGljIGJv\nb2xlYW4gcnVuKE9wdGlvbnMgb3B0cykgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBu\nZXcgT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBsKCk7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQQ0VuaGFuY2Vy\nLnJ1bihjb25mLCBhcmdzLCBvcHRzKTsKICAgICAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICAgICAgY29uZi5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybnMgZmFsc2Ug\naWYgaW52YWxpZCBvcHRpb25zIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGJvb2xlYW4gcnVuKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYs\nIFN0cmluZ1tdIGFyZ3MsCiAgICAgICAgT3B0aW9ucyBvcHRzKQogICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmxhZ3MgZmxhZ3MgPSBu\nZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5kaXJlY3RvcnkgPSBGaWxlcy5n\nZXRGaWxlKG9wdHMucmVtb3ZlUHJvcGVydHkoImRpcmVjdG9yeSIsICJkIiwK\nICAgICAgICAgICAgbnVsbCksIG51bGwpOwogICAgICAgIGZsYWdzLmFkZERl\nZmF1bHRDb25zdHJ1Y3RvciA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5\nCiAgICAgICAgICAgICgiYWRkRGVmYXVsdENvbnN0cnVjdG9yIiwgImFkYyIs\nIGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgZmxhZ3Mu\ndG1wQ2xhc3NMb2FkZXIgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQog\nICAgICAgICAgICAoInRtcENsYXNzTG9hZGVyIiwgInRjbCIsIGZsYWdzLnRt\ncENsYXNzTG9hZGVyKTsKICAgICAgICBmbGFncy5lbmZvcmNlUHJvcGVydHlS\nZXN0cmljdGlvbnMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAg\nICAgICAgICAoImVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyIsICJlcHIi\nLAogICAgICAgICAgICAgICAgZmxhZ3MuZW5mb3JjZVByb3BlcnR5UmVzdHJp\nY3Rpb25zKTsKCiAgICAgICAgLy8gZm9yIHVuaXQgdGVzdGluZwogICAgICAg\nIEJ5dGVjb2RlV3JpdGVyIHdyaXRlciA9IChCeXRlY29kZVdyaXRlcikgb3B0\ncy5nZXQoCiAgICAgICAgICAgIFBDRW5oYW5jZXIuY2xhc3MuZ2V0TmFtZSgp\nICsgIiNieXRlY29kZVdyaXRlciIpOwoKICAgICAgICBDb25maWd1cmF0aW9u\ncy5wb3B1bGF0ZUNvbmZpZ3VyYXRpb24oY29uZiwgb3B0cyk7CiAgICAgICAg\ncmV0dXJuIHJ1bihjb25mLCBhcmdzLCBmbGFncywgbnVsbCwgd3JpdGVyLCBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuaGFuY2UgdGhlIGdpdmVu\nIGNsYXNzZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBy\ndW4oT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywK\nICAgICAgICBGbGFncyBmbGFncywgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nLCBCeXRlY29kZVdyaXRlciB3cml0ZXIsCiAgICAgICAgQ2xhc3NMb2FkZXIg\nbG9hZGVyKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAgICBsb2FkZXIgPSBjb25m\nLmdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAg\nZ2V0Q2xhc3NMb2FkZXIoUENFbmhhbmNlci5jbGFzcywgbnVsbCk7CiAgICAg\nICAgaWYgKGZsYWdzLnRtcENsYXNzTG9hZGVyKQogICAgICAgICAgICBsb2Fk\nZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAubmV3VGVtcG9y\nYXJ5Q2xhc3NMb2FkZXJBY3Rpb24obG9hZGVyKSk7CgogICAgICAgIGlmIChy\nZXBvcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJlcG9zID0gY29uZi5uZXdN\nZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICByZXBv\ncy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01FVEEp\nOwogICAgICAgIH0KCiAgICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9nKE9w\nZW5KUEFDb25maWd1cmF0aW9uLkxPR19UT09MKTsKICAgICAgICBDb2xsZWN0\naW9uIGNsYXNzZXM7CiAgICAgICAgaWYgKGFyZ3MgPT0gbnVsbCB8fCBhcmdz\nLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0\nKCJydW5uaW5nLWFsbC1jbGFzc2VzIikpOwogICAgICAgICAgICBjbGFzc2Vz\nID0gcmVwb3MuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyh0cnVlLCBsb2FkZXIp\nOwogICAgICAgICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIAlsb2cud2FybihfbG9jLmdldCgibm8tY2xhc3MtdG8tZW5oYW5jZSIp\nKTsKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENsYXNzQXJnUGFyc2VyIGNh\ncCA9IGNvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAg\nICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLm5ld0NsYXNzQXJn\nUGFyc2VyKCk7CiAgICAgICAgICAgIGNhcC5zZXRDbGFzc0xvYWRlcihsb2Fk\nZXIpOwogICAgICAgICAgICBjbGFzc2VzID0gbmV3IEhhc2hTZXQoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGRBbGwoQXJyYXlzLmFzTGlz\ndChjYXAucGFyc2VUeXBlcyhhcmdzW2ldKSkpOwogICAgICAgIH0KCiAgICAg\nICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsKICAgICAgICBC\nQ0NsYXNzIGJjOwogICAgICAgIFBDRW5oYW5jZXIgZW5oYW5jZXI7CiAgICAg\nICAgaW50IHN0YXR1czsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNs\nYXNzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgT2JqZWN0IG8gPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAobG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nX2xvYy5nZXQoImVuaGFuY2UtcnVubmluZyIsIG8pKTsKCiAgICAgICAgICAg\nIGlmIChvIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICAgICAgYmMg\nPSBwcm9qZWN0LmxvYWRDbGFzcygoU3RyaW5nKSBvLCBsb2FkZXIpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBiYyA9IHByb2plY3QubG9h\nZENsYXNzKChDbGFzcykgbyk7CiAgICAgICAgICAgIGVuaGFuY2VyID0gbmV3\nIFBDRW5oYW5jZXIoY29uZiwgYmMsIHJlcG9zLCBsb2FkZXIpOwogICAgICAg\nICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBlbmhh\nbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAgICAgICAgICBl\nbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsKICAgICAg\nICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGZsYWdz\nLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIHN0YXR1cyA9\nIGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAoc3RhdHVzID09IEVO\nSEFOQ0VfTk9ORSkgewogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9j\nLmdldCgiZW5oYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50ZXJmYWNlIikp\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX0FX\nQVJFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJl\nbmhhbmNlLWF3YXJlIikpOwogICAgICAgICAgICAgICAgZW5oYW5jZXIucmVj\nb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgZW5o\nYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIHByb2plY3QuY2xlYXIoKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3Rvcnkg\nPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERlZmF1bHRDb25z\ndHJ1Y3RvciA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdG1wQ2xh\nc3NMb2FkZXIgPSB0cnVlOwoJCXB1YmxpYyBib29sZWFuIGVuZm9yY2VQcm9w\nZXJ0eVJlc3RyaWN0aW9ucyA9IGZhbHNlOwoJfQoKCS8qKgogCSAqIFBsdWdp\nbiBpbnRlcmZhY2UgZm9yIGFkZGl0aW9uYWwgZW5oYW5jZW1lbnQuCgkgKi8K\nCXB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIEF1eGlsaWFyeUVuaGFuY2VyCgl7\nCgkJcHVibGljIHZvaWQgcnVuIChCQ0NsYXNzIGJjLCBDbGFzc01ldGFEYXRh\nIG1ldGEpOwoJCXB1YmxpYyBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0aG9k\nIG0pOwoJfQp9Cg==\n","encoding":"base64"}

