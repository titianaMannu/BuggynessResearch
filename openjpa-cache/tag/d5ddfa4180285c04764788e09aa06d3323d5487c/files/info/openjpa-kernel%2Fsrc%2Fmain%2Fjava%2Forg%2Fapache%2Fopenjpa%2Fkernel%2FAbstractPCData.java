{"sha":"12f98b6484a006416b7332bfa9a8b339daf5d8f1","node_id":"MDQ6QmxvYjIwNjM2NDoxMmY5OGI2NDg0YTAwNjQxNmI3MzMyYmZhOWE4YjMzOWRhZjVkOGYx","size":15054,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/12f98b6484a006416b7332bfa9a8b339daf5d8f1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsK\naW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eTsKCi8qKgogKiBBYnN0\ncmFjdCBiYXNlIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgY29yZSBQQ0RhdGEg\nYmVoYXZpb3IuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBhYnN0\ncmFjdCBjbGFzcyBBYnN0cmFjdFBDRGF0YQogICAgaW1wbGVtZW50cyBQQ0Rh\ndGEgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBu\nZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Rb\nXSBFTVBUWV9BUlJBWSA9IG5ldyBPYmplY3RbMF07CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGxvYWRlZCBmaWVsZCBtYXNrLgogICAgICovCiAgICBw\ndWJsaWMgYWJzdHJhY3QgQml0U2V0IGdldExvYWRlZCgpOwoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHBjZGF0YSBmb3IgaG9sZGluZyB0aGUgc3Rh\ndGUgb2YgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBhYnN0cmFjdCBBYnN0cmFjdFBDRGF0YSBuZXdFbWJlZGRlZFBDRGF0YShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtKTsKCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0xvYWRlZChpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0TG9hZGVk\nKCkuZ2V0KGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9y\nbSB0aGUgZ2l2ZW4gZGF0YSB2YWx1ZSBpbnRvIGl0cyBmaWVsZCB2YWx1ZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0ZpZWxkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIE9i\namVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgUHJveHlEYXRhTGlzdCBjID0g\nKFByb3h5RGF0YUxpc3QpIGRhdGE7CiAgICAgICAgICAgICAgICBDb2xsZWN0\naW9uIGMyID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdl\ndEluZGV4KCkpOwogICAgICAgICAgICAgICAgYzIgPSB0b05lc3RlZEZpZWxk\ncyhzbSwgZm1kLmdldEVsZW1lbnQoKSwgKENvbGxlY3Rpb24pIGRhdGEsCiAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgICAg\nICAgICAgaWYgKGMyIGluc3RhbmNlb2YgUHJveHkpIHsKICAgICAgICAgICAg\nICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gKChQcm94eSkgYzIpLmdldENo\nYW5nZVRyYWNrZXIoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY3Quc2V0TmV4dFNlcXVl\nbmNlKGMubmV4dFNlcXVlbmNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJldHVybiBjMjsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgTWFwIG0gPSAoTWFwKSBkYXRhOwog\nICAgICAgICAgICAgICAgTWFwIG0yID0gKE1hcCkgc20ubmV3RmllbGRQcm94\neShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9u\nIGtleXMgPSBuZXcgQXJyYXlMaXN0IChtLnNpemUoKSk7CiAgICAgICAgICAg\nICAgICBDb2xsZWN0aW9uIHZhbHVlcyA9IG5ldyBBcnJheUxpc3QobS5zaXpl\nKCkpOwogICAgICAgICAgICAgICAgTWFwLkVudHJ5IGU7CgogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvcjxNYXAuRW50cnk+IG1pID0gbS5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7IG1pLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgICAgICBlID0gbWkubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGtl\neXMuYWRkKGUuZ2V0S2V5KCkpOwogICAgICAgICAgICAgICAgICAgIHZhbHVl\ncy5hZGQoZS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIE9iamVjdFtdIGtleUFycmF5ID0ga2V5cy50b0FycmF5KCk7\nCiAgICAgICAgICAgICAgICBPYmplY3RbXSB2YWx1ZUFycmF5ID0gdG9OZXN0\nZWRGaWVsZHMoc20sIGZtZC5nZXRFbGVtZW50KCksCiAgICAgICAgICAgICAg\nICAgICAgdmFsdWVzLCBmZXRjaCwgY29udGV4dCkudG9BcnJheSgpOwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaWR4ID0gMDsgaWR4IDwga2V5QXJyYXku\nbGVuZ3RoOyBpZHgrKykgICAgCiAgICAgICAgICAgICAgICAgICAgbTIucHV0\nKGtleUFycmF5W2lkeF0sIHZhbHVlQXJyYXlbaWR4XSk7CgogICAgICAgICAg\nICAgICAgcmV0dXJuIG0yOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5B\nUlJBWToKICAgICAgICAgICAgICAgIGludCBsZW5ndGggPSBBcnJheS5nZXRM\nZW5ndGgoZGF0YSk7CiAgICAgICAgICAgICAgICBPYmplY3QgYSA9IEFycmF5\nLm5ld0luc3RhbmNlKGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBl\nKCksCiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoKTsKICAgICAgICAgICAg\nICAgIGlmIChsZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gYTsKCiAgICAgICAgICAgICAgICBpZiAoaXNJbW11dGFibGVUeXBlKGZt\nZC5nZXRFbGVtZW50KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgU3lzdGVt\nLmFycmF5Y29weShkYXRhLCAwLCBhLCAwLCBsZW5ndGgpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIEFycmF5LnNldChhLCBpLCB0b05lc3RlZEZpZWxkKHNtLCBmbWQuZ2V0\nRWxlbWVudCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXku\nZ2V0KGRhdGEsIGkpLCBmZXRjaCwgY29udGV4dCkpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiBhOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ncmV0dXJuIHRvTmVzdGVkRmllbGQoc20sIGZtZCwgZGF0YSwgZmV0Y2gsIGNv\nbnRleHQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5z\nZm9ybSB0aGUgZ2l2ZW4gZGF0YSB2YWx1ZSB0byBpdHMgZmllbGQgdmFsdWUu\nIFRoZSBkYXRhIHZhbHVlCiAgICAgKiBtYXkgYmUgYSBrZXksIHZhbHVlLCBv\nciBlbGVtZW50IG9mIGEgbWFwIG9yIGNvbGxlY3Rpb24uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBPYmplY3QgdG9OZXN0ZWRGaWVsZChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBWYWx1ZU1ldGFEYXRhIHZtZCwKICAgICAgICBPYmplY3Qg\nZGF0YSwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4\ndCkgewogICAgICAgIGlmIChkYXRhID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBzd2l0Y2ggKHZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToK\nICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIGRhdGEpLmNsb25lKCk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAg\nICAgICAgIHJldHVybiAoTG9jYWxlKSBkYXRhOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGlmICh2bWQuaXNFbWJl\nZGRlZCgpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0b0VtYmVkZGVk\nRmllbGQoc20sIHZtZCwgZGF0YSwgZmV0Y2gsIGNvbnRleHQpOwogICAgICAg\nICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIE9iamVjdCByZXQgPQog\nICAgICAgICAgICAgICAgICAgIHRvUmVsYXRpb25GaWVsZChzbSwgdm1kLCBk\nYXRhLCBmZXRjaCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICBpZiAocmV0\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAg\nICAgICAgICAgICAgIE9ycGhhbmVkS2V5QWN0aW9uIGFjdGlvbiA9IHNtLmdl\ndENvbnRleHQoKS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAg\nICAgICAgZ2V0T3JwaGFuZWRLZXlBY3Rpb25JbnN0YW5jZSgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGFjdGlvbi5vcnBoYW4oZGF0YSwgc20sIHZtZCk7\nCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZGF0YTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2Zv\ncm0gdGhlIGdpdmVuIGRhdGEgdmFsdWUgdG8gaXRzIGZpZWxkIHZhbHVlLiBU\naGUgZGF0YSB2YWx1ZQogICAgICogbWF5IGJlIGEga2V5LCB2YWx1ZSwgb3Ig\nZWxlbWVudCBvZiBhIG1hcCBvciBjb2xsZWN0aW9uLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgQ29sbGVjdGlvbiB0b05lc3RlZEZpZWxkcyhPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCAKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCwgQ29s\nbGVjdGlvbiBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAg\nICAgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBpZiAoZGF0YSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29sbGVjdGlv\nbiByZXQgPSBuZXcgQXJyYXlMaXN0KGRhdGEuc2l6ZSgpKTsKICAgICAgICBz\nd2l0Y2ggKHZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyPWRhdGEuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nCiAgICAgICAgICAgICAgICAgICAgcmV0LmFkZCgoKERhdGUpaXRyLm5leHQo\nKSkuY2xvbmUoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0OwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0cj1kYXRhLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KQogICAgICAgICAgICAgICAgICAgIHJldC5hZGQoKExvY2FsZSkg\naXRyLm5leHQoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0OwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGlm\nICh2bWQuaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyPWRhdGEuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5hZGQodG9FbWJlZGRlZEZp\nZWxkKHNtLCB2bWQsIGl0ci5uZXh0KCksIGZldGNoCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAsIGNvbnRleHQpKTsKICAgICAgICAgICAgICAgIC8v\nIG5vIGJyZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQ\nRUQ6CiAgICAgICAgICAgICAgICBPYmplY3RbXSByID0gdG9SZWxhdGlvbkZp\nZWxkcyhzbSwgZGF0YSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYgKHIg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHJbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJldC5hZGQocltpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICAgICByZXQuYWRkKHNtLmdldENv\nbnRleHQoKS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBnZXRPcnBoYW5lZEtleUFjdGlvbkluc3RhbmNlKCku\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcnBoYW4oZGF0YSwg\nc20sIHZtZCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBkYXRh\nOwogICAgICAgIH0KICAgIH0KCiAgICAKICAgIC8qKgogICAgICogVHJhbnNm\nb3JtIHRoZSBnaXZlbiBkYXRhIGludG8gYSByZWxhdGlvbiBmaWVsZCB2YWx1\nZS4gRGVmYXVsdAogICAgICogaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUg\nZGF0YSBpcyBhbiBvaWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3Qg\ndG9SZWxhdGlvbkZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFZhbHVl\nTWV0YURhdGEgdm1kLAogICAgICAgIE9iamVjdCBkYXRhLCBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgcmV0\ndXJuIHNtLmdldENvbnRleHQoKS5maW5kKGRhdGEsIGZldGNoLCBudWxsLCBu\ndWxsLCAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9ybSB0aGUg\nZ2l2ZW4gZGF0YSBpbnRvIHJlbGF0aW9uIGZpZWxkIHZhbHVlcy4gRGVmYXVs\ndAogICAgICogaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUgZGF0YSBpcyBh\nbiBvaWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3RbXSB0b1JlbGF0\naW9uRmllbGRzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgT2Jq\nZWN0IGRhdGEsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIHJldHVybiBzbS5nZXRDb250ZXh0KCkuZmluZEFsbCgoQ29sbGVjdGlvbikg\nZGF0YSwgZmV0Y2gsIG51bGwsIG51bGwsIDApOwogICAgfQoKICAgIC8qKgog\nICAgICogVHJhbnNmb3JtIHRoZSBnaXZlbiBkYXRhIGludG8gYW4gZW1iZWRk\nZWQgUEMgZmllbGQgdmFsdWUuIERlZmF1bHQKICAgICAqIGltcGxlbWVudGF0\naW9uIGFzc3VtZXMgdGhlIGRhdGEgaXMgYW4ge0BsaW5rIEFic3RyYWN0UENE\nYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0VtYmVkZGVk\nRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgVmFsdWVNZXRhRGF0YSB2\nbWQsCiAgICAgICAgT2JqZWN0IGRhdGEsIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBBYnN0cmFjdFBDRGF0\nYSBwY2RhdGEgPSAoQWJzdHJhY3RQQ0RhdGEpIGRhdGE7CiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBlbWJlZGRlZCA9IHNtLmdldENvbnRleHQoKS5l\nbWJlZChudWxsLAogICAgICAgICAgICBwY2RhdGEuZ2V0SWQoKSwgc20sIHZt\nZCk7CiAgICAgICAgcGNkYXRhLmxvYWQoZW1iZWRkZWQsIChCaXRTZXQpIHBj\nZGF0YS5nZXRMb2FkZWQoKS5jbG9uZSgpLAogICAgICAgICAgICBmZXRjaCwg\nY29udGV4dCk7CiAgICAgICAgcmV0dXJuIGVtYmVkZGVkLmdldE1hbmFnZWRJ\nbnN0YW5jZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRo\nZSBnaXZlbiBmaWVsZCB2YWx1ZSB0byBhIGRhdGEgdmFsdWUgZm9yIGNhY2hp\nbmcuIFJldHVybgogICAgICoge0BsaW5rICNOVUxMfSBpZiB1bmFibGUgdG8g\nY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9EYXRhKEZp\nZWxkTWV0YURhdGEgZm1kLCBPYmplY3QgdmFsLCBTdG9yZUNvbnRleHQgY3R4\nKSB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJ\nT046CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSAoQ29sbGVjdGlv\nbikgdmFsOwogICAgICAgICAgICAgICAgaWYgKGMuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBQcm94eURhdGFMaXN0LkVNUFRZX0xJ\nU1Q7CiAgICAgICAgICAgICAgICBQcm94eURhdGFMaXN0IGMyID0gbnVsbDsK\nICAgICAgICAgICAgICAgIGludCBzaXplOwogICAgICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBjaSA9IGMuaXRlcmF0b3IoKTsgY2kuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgICAgIHZhbCA9IHRvTmVzdGVkRGF0YShmbWQu\nZ2V0RWxlbWVudCgpLCBjaS5uZXh0KCksIGN0eCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHZhbCA9PSBOVUxMKQogICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gTlVMTDsKICAgICAgICAgICAgICAgICAgICBpZiAoYzIgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBzaXplID0gYy5zaXpl\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMyID0gbmV3IFByb3h5RGF0\nYUxpc3Qoc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjIGlu\nc3RhbmNlb2YgUHJveHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIENoYW5nZVRyYWNrZXIgY3QgPSAoKFByb3h5KSBjKS5nZXRDaGFuZ2VUcmFj\na2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMi5uZXh0\nU2VxdWVuY2UgPSBjdC5nZXROZXh0U2VxdWVuY2UoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjMi5uZXh0U2VxdWVuY2UgPSBzaXplOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICBjMi5hZGQodmFsKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjMjsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgTWFwIG0g\nPSAoTWFwKSB2YWw7CiAgICAgICAgICAgICAgICBpZiAobS5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZ\nX01BUDsKICAgICAgICAgICAgICAgIE1hcCBtMiA9IG51bGw7CiAgICAgICAg\nICAgICAgICBNYXAuRW50cnkgZTsKICAgICAgICAgICAgICAgIE9iamVjdCB2\nYWwyOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBtaSA9IG0uZW50\ncnlTZXQoKS5pdGVyYXRvcigpOyBtaS5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICAgICAgZSA9IChNYXAuRW50cnkpIG1pLm5leHQoKTsKICAgICAg\nICAgICAgICAgICAgICB2YWwgPSB0b05lc3RlZERhdGEoZm1kLmdldEtleSgp\nLCBlLmdldEtleSgpLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIGlmICh2\nYWwgPT0gTlVMTCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5V\nTEw7CiAgICAgICAgICAgICAgICAgICAgdmFsMiA9IHRvTmVzdGVkRGF0YShm\nbWQuZ2V0RWxlbWVudCgpLCBlLmdldFZhbHVlKCksIGN0eCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHZhbDIgPT0gTlVMTCkKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG0yID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIG0yID0gbmV3\nIEhhc2hNYXAobS5zaXplKCkpOwogICAgICAgICAgICAgICAgICAgIG0yLnB1\ndCh2YWwsIHZhbDIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgcmV0dXJuIG0yOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJB\nWToKICAgICAgICAgICAgICAgIGludCBsZW5ndGggPSBBcnJheS5nZXRMZW5n\ndGgodmFsKTsKICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPT0gMCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gRU1QVFlfQVJSQVk7CgogICAgICAg\nICAgICAgICAgT2JqZWN0IGE7CiAgICAgICAgICAgICAgICBpZiAoaXNJbW11\ndGFibGVUeXBlKGZtZC5nZXRFbGVtZW50KCkpKSB7CiAgICAgICAgICAgICAg\nICAgICAgYSA9IEFycmF5Lm5ld0luc3RhbmNlKGZtZC5nZXRFbGVtZW50KCku\nZ2V0RGVjbGFyZWRUeXBlKCksIAogICAgICAgICAgICAgICAgICAgICAgICBs\nZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHko\ndmFsLCAwLCBhLCAwLCBsZW5ndGgpOwogICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3RbXSBkYXRhID0gbmV3IE9i\namVjdFtsZW5ndGhdOwogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgZGF0YVtpXSA9IHRvTmVzdGVkRGF0YShmbWQuZ2V0RWxlbWVudCgpLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFycmF5LmdldCh2YWwsIGkp\nLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBhID0gZGF0YTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHJldHVybiBhOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIHRvTmVzdGVkRGF0YShmbWQsIHZhbCwgY3R4KTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0\naGUgZGVjbGFyZWQgdHlwZSBvZiB0aGUgZ2l2ZW4gdmFsdWUgaXMgaW1tdXRh\nYmxlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNJbW11dGFibGVU\neXBlKFZhbHVlTWV0YURhdGEgZWxlbWVudCkgewogICAgICAgIHN3aXRjaCAo\nZWxlbWVudC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5OVU1CRVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xF\nQU5fT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gbmVzdGVkIHZhbHVlIHRv\nIGEgY2FjaGFibGUgdmFsdWUuIFJldHVybgogICAgICoge0BsaW5rICNOVUxM\nfSBpZiB0aGUgdmFsdWUgY2Fubm90IGJlIGNhY2hlZC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIE9iamVjdCB0b05lc3RlZERhdGEoVmFsdWVNZXRhRGF0YSB2\nbWQsIE9iamVjdCB2YWwsCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCkgewog\nICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIHN3aXRjaCAodm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAg\nICAgICAgIGlmICh2bWQuaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB0b0VtYmVkZGVkRGF0YSh2YWwsIGN0eCk7CiAgICAgICAg\nICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgcmV0dXJuIHRvUmVsYXRp\nb25EYXRhKHZhbCwgY3R4KTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nREFURToKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQcm94\neSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChQcm94eSkgdmFsKS5j\nb3B5KHZhbCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuICgoRGF0ZSkgdmFsKS5jbG9uZSgpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAgICByZXR1\ncm4gKExvY2FsZSkgdmFsOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nQkpFQ1Q6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgUHJv\neHkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoUHJveHkpIHZhbCku\nY29weSh2YWwpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUgdG8gY2FjaGUgZm9yIHRoZSBn\naXZlbiBvYmplY3QuIENhY2hlcyBpdHMgb2lkIGJ5CiAgICAgKiBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvUmVsYXRpb25EYXRh\nKE9iamVjdCB2YWwsIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICByZXR1\ncm4gY3R4LmdldE9iamVjdElkKHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHZhbHVlIHRvIGNhY2hlIGZvciB0aGUgZ2l2ZW4gZW1i\nZWRkZWQgUEMuIENhY2hlcyBhCiAgICAgKiB7QGxpbmsgUENEYXRhfSBmcm9t\nIHtAbGluayAjbmV3RW1iZWRkZWRQQ0RhdGF9IGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9FbWJlZGRlZERhdGEoT2JqZWN0\nIHZhbCwgU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmIChjdHggPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE5VTEw7CgogICAgICAgIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20gPSBjdHguZ2V0U3RhdGVNYW5hZ2VyKHZhbCk7\nCiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBO\nVUxMOwoKICAgICAgICAvLyBoYXZlIHRvIGNhY2hlIGFsbCBkYXRhLCBzbyBt\nYWtlIHN1cmUgaXQncyBhbGwgbG9hZGVkCiAgICAgICAgLy8gIyMjIHByZXZl\nbnQgbG9hZGluZyBvZiB0aGluZ3MgdGhhdCBhcmVuJ3QgY2FjaGVkIChsb2Jz\nLCBscnMsIGV0YykKICAgICAgICBjdHgucmV0cmlldmUodmFsLCBmYWxzZSwg\nbnVsbCk7CgogICAgICAgIFBDRGF0YSBwY2RhdGEgPSBuZXdFbWJlZGRlZFBD\nRGF0YShzbSk7CiAgICAgICAgcGNkYXRhLnN0b3JlKHNtKTsKICAgICAgICBy\nZXR1cm4gcGNkYXRhOwogICAgfQoKICAgIC8qKgogICAgICogVHJhY2tzIHBy\nb3h5IGRhdGEgYWxvbmcgd2l0aCBsaXN0IGVsZW1lbnRzLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQcm94eURhdGFMaXN0CiAgICAgICAg\nZXh0ZW5kcyBBcnJheUxpc3QgewoKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIFByb3h5RGF0YUxpc3QgRU1QVFlfTElTVCA9IG5ldyBQcm94eURhdGFM\naXN0KDApOwoKICAgICAgICBwdWJsaWMgaW50IG5leHRTZXF1ZW5jZSA9IDA7\nCgogICAgICAgIHB1YmxpYyBQcm94eURhdGFMaXN0KGludCBzaXplKSB7CgkJ\nCXN1cGVyIChzaXplKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

