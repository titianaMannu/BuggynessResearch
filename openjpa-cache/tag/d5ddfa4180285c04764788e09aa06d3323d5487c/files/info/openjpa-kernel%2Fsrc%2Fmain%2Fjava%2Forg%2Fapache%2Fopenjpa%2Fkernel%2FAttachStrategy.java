{"sha":"fa9e0f2a78081749d78b1aadbce325014746b8f4","node_id":"MDQ6QmxvYjIwNjM2NDpmYTllMGYyYTc4MDgxNzQ5ZDc4YjFhYWRiY2UzMjUwMTQ3NDZiOGY0","size":20376,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fa9e0f2a78081749d78b1aadbce325014746b8f4","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOwoKLyoqCiAqIFN0cmF0ZWd5IGZvciBhdHRhY2hpbmcgb2JqZWN0cy4K\nICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhvciBT\ndGV2ZSBLaW0KICogQG5vamF2YWRvYwogKi8KYWJzdHJhY3QgY2xhc3MgQXR0\nYWNoU3RyYXRlZ3kKICAgIGV4dGVuZHMgVHJhbnNmZXJGaWVsZE1hbmFnZXIg\newoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQXR0YWNoU3RyYXRlZ3ku\nY2xhc3MpOwoKICAgIC8qKgogICAgICogQXR0YWNoLgogICAgICoKICAgICAq\nIEBwYXJhbSBtYW5hZ2VyIG1hbmFnZXIgaG9sZGluZyBjYWNoZSBvZiBhdHRh\nY2hlZCBpbnN0YW5jZXMKICAgICAqIEBwYXJhbSB0b0F0dGFjaCBkZXRhY2hl\nZCBpbnN0YW5jZQogICAgICogQHBhcmFtIG1ldGEgbWV0YWRhdGEgZm9yIHRo\nZSBpbnN0YW5jZSBiZWluZyBhdHRhY2hlZAogICAgICogQHBhcmFtIGludG8g\naW5zdGFuY2Ugd2UncmUgYXR0YWNoaW5nIGludG8KICAgICAqIEBwYXJhbSBv\nd25lciBzdGF0ZSBtYW5hZ2VyIGZvciA8Y29kZT5pbnRvPC9jb2RlPgogICAg\nICogQHBhcmFtIG93bmVyTWV0YSBmaWVsZCB3ZSB0cmF2ZXJzZWQgdG8gZmlu\nZCA8Y29kZT50b0F0dGFjaDwvY29kZT4KICAgICAqIEBwYXJhbSBleHBsaWNp\ndCB3aGV0aGVyIHRvIG1ha2UgbmV3IGluc3RhbmNlcyBleHBsaWNpdGx5IHBl\ncnNpc3RlbnQKICAgICAqLwogICAgcHVibGljIGFic3RyYWN0IE9iamVjdCBh\ndHRhY2goQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAgIE9iamVjdCB0\nb0F0dGFjaCwgQ2xhc3NNZXRhRGF0YSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFi\nbGUgaW50bywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBW\nYWx1ZU1ldGFEYXRhIG93bmVyTWV0YSwgYm9vbGVhbiBleHBsaWNpdCk7Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGlkZW50aXR5IG9mIHRoZSBnaXZl\nbiBkZXRhY2hlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFi\nc3RyYWN0IE9iamVjdCBnZXREZXRhY2hlZE9iamVjdElkKEF0dGFjaE1hbmFn\nZXIgbWFuYWdlciwKICAgICAgICBPYmplY3QgdG9BdHRhY2gpOwoKICAgIC8q\nKgogICAgICogUHJvdmlkZSB0aGUgZ2l2ZW4gZmllbGQgaW50byB0aGlzIGZp\nZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2\nb2lkIHByb3ZpZGVGaWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdl\nckltcGwgc20sCiAgICAgICAgaW50IGZpZWxkKTsKCiAgICAvKioKICAgICAq\nIFJldHVybiBhIFBOZXcvUE5ld1Byb3Zpc2lvbmFsIG1hbmFnZWQgb2JqZWN0\nIGZvciB0aGUgZ2l2ZW4gZGV0YWNoZWQgCiAgICAgKiBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgcGVyc2lzdChB\ndHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEsIE9iamVjdCBhcHBJZCwgCiAg\nICAgICAgYm9vbGVhbiBleHBsaWNpdCkgewogICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBuZXdJbnN0YW5jZTsKICAgICAgICBpZiAoIW1hbmFnZXIuZ2V0\nQ29weU5ldygpKQogICAgICAgICAgICBuZXdJbnN0YW5jZSA9IHBjOwogICAg\nICAgIGVsc2UgaWYgKGFwcElkID09IG51bGwpCiAgICAgICAgICAgIC8vIGRh\ndGFzdG9yZSBpZGVudGl0eSBvciBhcHBsaWNhdGlvbiBpZGVudGl0eSB3aXRo\nIGdlbmVyYXRlZCBrZXlzCiAgICAgICAgICAgIG5ld0luc3RhbmNlID0gcGMu\ncGNOZXdJbnN0YW5jZShudWxsLCBmYWxzZSk7CiAgICAgICAgZWxzZSAvLyBh\ncHBsaWNhdGlvbiBpZGVudGl0eTogdXNlIGV4aXN0aW5nIGZpZWxkcwogICAg\nICAgICAgICBuZXdJbnN0YW5jZSA9IHBjLnBjTmV3SW5zdGFuY2UobnVsbCwg\nYXBwSWQsIGZhbHNlKTsKCiAgICAgICAgcmV0dXJuIChTdGF0ZU1hbmFnZXJJ\nbXBsKSBtYW5hZ2VyLmdldEJyb2tlcigpLnBlcnNpc3QKICAgICAgICAgICAg\nKG5ld0luc3RhbmNlLCBhcHBJZCwgZXhwbGljaXQsIG1hbmFnZXIuZ2V0QmVo\nYXZpb3IoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggdGhlIGdp\ndmVuIGZpZWxkIGludG8gdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICoKICAg\nICAqIEBwYXJhbSB0b0F0dGFjaCB0aGUgZGV0YWNoZWQgcGVyc2lzdGVudCBp\nbnN0YW5jZQogICAgICogQHBhcmFtIHNtIHN0YXRlIG1hbmFnZXIgZm9yIHRo\nZSBtYW5hZ2VkIGluc3RhbmNlIHdlJ3JlIGNvcHlpbmcKICAgICAqIGludG87\nIDxjb2RlPnRvQXR0YWNoPC9jb2RlPiBhbHNvIHVzZXMgdGhpcyBzdGF0ZSBt\nYW5hZ2VyCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFkYXRhIG9uIHRoZSBmaWVs\nZCB3ZSdyZSBjb3B5aW5nCiAgICAgKiBAcGFyYW0gbnVsbExvYWRlZCBpZiBm\nYWxzZSwgbnVsbHMgd2lsbCBiZSBjb25zaWRlcmVkIHVubG9hZGVkIGFuZCB3\naWxsCiAgICAgKiBub3QgYmUgYXR0YWNoZWQKICAgICAqLwogICAgcHJvdGVj\ndGVkIGJvb2xlYW4gYXR0YWNoRmllbGQoQXR0YWNoTWFuYWdlciBtYW5hZ2Vy\nLCBPYmplY3QgdG9BdHRhY2gsCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSwgRmllbGRNZXRhRGF0YSBmbWQsIGJvb2xlYW4gbnVsbExvYWRlZCkgewog\nICAgICAgIGlmIChmbWQuaXNWZXJzaW9uKCkKICAgICAgICAgICAgfHwgZm1k\nLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJT\nSVNURU5UKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBpbnRvID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBh\nYmxlKCk7CiAgICAgICAgaW50IGkgPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAg\nICBwcm92aWRlRmllbGQodG9BdHRhY2gsIHNtLCBpKTsKCiAgICAgICAgaW50\nIHNldCA9IFN0YXRlTWFuYWdlci5TRVRfQVRUQUNIOwogICAgICAgIE9iamVj\ndCB2YWw7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAg\nICAgICAgICAgICAgICBzbS5zZXR0aW5nQm9vbGVhbkZpZWxkKGludG8sIGks\nIHNtLmZldGNoQm9vbGVhbkZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAg\nIGZldGNoQm9vbGVhbkZpZWxkKGkpLCBzZXQpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICBzbS5zZXR0aW5nQnl0ZUZpZWxkKGludG8sIGksIHNtLmZl\ndGNoQnl0ZUZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgIGZldGNoQnl0\nZUZpZWxkKGkpLCBzZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBz\nbS5zZXR0aW5nQ2hhckZpZWxkKGludG8sIGksIHNtLmZldGNoQ2hhckZpZWxk\nKGkpLAogICAgICAgICAgICAgICAgICAgIGZldGNoQ2hhckZpZWxkKGkpLCBz\nZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdE\nb3VibGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaERvdWJsZUZpZWxkKGkpLAog\nICAgICAgICAgICAgICAgICAgIGZldGNoRG91YmxlRmllbGQoaSksIHNldCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBzbS5zZXR0aW5nRmxvYXRG\naWVsZChpbnRvLCBpLCBzbS5mZXRjaEZsb2F0RmllbGQoaSksCiAgICAgICAg\nICAgICAgICAgICAgZmV0Y2hGbG9hdEZpZWxkKGkpLCBzZXQpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdJbnRGaWVsZChpbnRvLCBp\nLCBzbS5mZXRjaEludEZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgIGZl\ndGNoSW50RmllbGQoaSksIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nICAgIHNtLnNldHRpbmdMb25nRmllbGQoaW50bywgaSwgc20uZmV0Y2hMb25n\nRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hMb25nRmllbGQo\naSksIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBzbS5zZXR0\naW5nU2hvcnRGaWVsZChpbnRvLCBpLCBzbS5mZXRjaFNob3J0RmllbGQoaSks\nCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hTaG9ydEZpZWxkKGkpLCBzZXQp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIFN0cmluZyBzdmFsID0g\nZmV0Y2hTdHJpbmdGaWVsZChpKTsKICAgICAgICAgICAgICAgIGlmIChzdmFs\nID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgc20uc2V0dGluZ1N0cmlu\nZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoU3RyaW5nRmllbGQoaSksIHN2YWws\nCiAgICAgICAgICAgICAgICAgICAgc2V0KTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PSUQ6CiAgICAgICAgICAgICAgICB2YWwgPSBmZXRjaE9iamVjdEZpZWxk\nKGkpOwogICAgICAgICAgICAgICAgaWYgKHZhbCA9PSBudWxsICYmICFudWxs\nTG9hZGVkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCBz\nbS5mZXRjaE9iamVjdEZpZWxkKGkpLCB2YWwsCiAgICAgICAgICAgICAgICAg\nICAgc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIE9iamVjdCBmcm1wYyA9IGZl\ndGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAoZnJtcGMg\nPT0gbnVsbCAmJiAhbnVsbExvYWRlZCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHRvc20gPSBtYW5hZ2VyLmdldEJyb2tlcigpLmdldFN0YXRlTWFuYWdl\ncgogICAgICAgICAgICAgICAgICAgIChzbS5mZXRjaE9iamVjdEZpZWxkKGkp\nKTsKICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSB0b3BjID0g\nKHRvc20gPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAgICAgICAgICAgOiB0\nb3NtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgICAgICAgICAg\naWYgKGZybXBjICE9IG51bGwgfHwgdG9wYyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGZtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX05PTkUpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZybXBjID0gZ2V0UmVmZXJlbmNlKG1hbmFnZXIsIGZybXBjLCBzbSwg\nZm1kKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIGludG9wYyA9IHRvcGM7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm1kLmlzRW1iZWRkZWRQ\nQygpICYmIGZybXBjICE9IG51bGwgJiYgdG9wYyAhPSBudWxsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAmJiAhT2JqZWN0VXRpbHMuZXF1YWxzKHRv\ncGMucGNGZXRjaE9iamVjdElkKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBtYW5hZ2VyLmdldERldGFjaGVkT2JqZWN0SWQoZnJtcGMpKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50b3BjID0gbnVsbDsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBmcm1wYyA9IG1hbmFnZXIuYXR0YWNoKGZybXBjLCBpbnRvcGMsIHNtLCBm\nbWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGZybXBjICE9IHRvcGMpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCB0b3BjLCBm\ncm1wYywgc2V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9O\nOgogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBmcm1jID0gKENvbGxlY3Rp\nb24pIGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAo\nZnJtYyA9PSBudWxsICYmICFudWxsTG9hZGVkKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24g\ndG9jID0gKENvbGxlY3Rpb24pIHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAg\nICAgICAgICAgICAgICBpZiAoKHRvYyAhPSBudWxsICYmICF0b2MuaXNFbXB0\neSgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZybWMgIT0gbnVsbCAmJiAh\nZnJtYy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJt\nYyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5n\nT2JqZWN0RmllbGQoaW50bywgaSwgdG9jLCBudWxsLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKHRvYyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBp\nLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNoQ29s\nbGVjdGlvbihtYW5hZ2VyLCBmcm1jLCBzbSwgZm1kKSwgc2V0KTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvYyBpbnN0YW5jZW9mIFNldCAm\nJiBmcm1jIGluc3RhbmNlb2YgU2V0KQogICAgICAgICAgICAgICAgICAgICAg\nICByZXBsYWNlQ29sbGVjdGlvbihtYW5hZ2VyLCBmcm1jLCB0b2MsIHNtLCBm\nbWQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgdG9j\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUxpc3QobWFu\nYWdlciwgZnJtYywgdG9jLCBzbSwgZm1kKSwgc2V0KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAg\nICAgICAgICAgTWFwIGZybW0gPSAoTWFwKSBmZXRjaE9iamVjdEZpZWxkKGkp\nOwogICAgICAgICAgICAgICAgaWYgKGZybW0gPT0gbnVsbCAmJiAhbnVsbExv\nYWRlZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgICAgICBNYXAgdG9tID0gKE1hcCkgc20uZmV0Y2hPYmplY3RGaWVs\nZChpKTsKICAgICAgICAgICAgICAgIGlmICgodG9tICE9IG51bGwgJiYgIXRv\nbS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgfHwgKGZybW0gIT0g\nbnVsbCAmJiAhZnJtbS5pc0VtcHR5KCkpKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGZybW0gPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHRvbSwgbnVsbCwgc2V0\nKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b20gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ09iamVjdEZpZWxk\nKGludG8sIGksIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\ndHRhY2hNYXAobWFuYWdlciwgZnJtbSwgc20sIGZtZCksIHNldCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXBsYWNlTWFwKG1hbmFnZXIsIGZybW0sIHRvbSwgc20sIGZtZCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBPYmpl\nY3QgZnJtYSA9IGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAg\nICBpZiAoZnJtYSA9PSBudWxsICYmICFudWxsTG9hZGVkKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIE9iamVj\ndCB0b2EgPSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAg\nICAgaWYgKCh0b2EgIT0gbnVsbCAmJiBBcnJheS5nZXRMZW5ndGgodG9hKSA+\nIDApCiAgICAgICAgICAgICAgICAgICAgfHwgKGZybWEgIT0gbnVsbCAmJiBB\ncnJheS5nZXRMZW5ndGgoZnJtYSkgPiAwKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChmcm1hID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCB0b2EsIG51bGwsIHNl\ndCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgdG9hLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUFycmF5KG1hbmFn\nZXIsIGZybWEsIHRvYSwgc20sIGZtZCksIHNldCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbihmbWQudG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbWFuYWdlZCwg\ncG9zc2libHkgaG9sbG93IHJlZmVyZW5jZSBmb3IgdGhlIGdpdmVuIGRldGFj\naGVkCiAgICAgKiBvYmplY3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmpl\nY3QgZ2V0UmVmZXJlbmNlKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgT2JqZWN0\nIHRvQXR0YWNoLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFZh\nbHVlTWV0YURhdGEgdm1kKSB7CiAgICAgICAgaWYgKHRvQXR0YWNoID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAobWFu\nYWdlci5nZXRCcm9rZXIoKS5pc05ldyh0b0F0dGFjaCkKICAgICAgICAgICAg\nfHwgbWFuYWdlci5nZXRCcm9rZXIoKS5pc1BlcnNpc3RlbnQodG9BdHRhY2gp\nKSB7CiAgICAgICAgICAgIHJldHVybiB0b0F0dGFjaDsKICAgICAgICB9IGVs\nc2UgaWYgKG1hbmFnZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hlZCh0b0F0dGFj\naCkpIHsKICAgICAgICAgICAgT2JqZWN0IG9pZCA9IG1hbmFnZXIuZ2V0RGV0\nYWNoZWRPYmplY3RJZCh0b0F0dGFjaCk7CiAgICAgICAgICAgIGlmIChvaWQg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBtYW5hZ2VyLmdldEJy\nb2tlcigpLmZpbmQob2lkLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgfQogICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYW50LWNh\nc2NhZGUtYXR0YWNoIiwgdm1kKSkKICAgICAgICAgICAgLnNldEZhaWxlZE9i\namVjdCh0b0F0dGFjaCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNl\nIHRoZSBjb250ZW50cyBvZiA8Y29kZT50b2M8L2NvZGU+IHdpdGggdGhlIGNv\nbnRlbnRzIG9mCiAgICAgKiA8Y29kZT5mcm1jPC9jb2RlPi4gTmVpdGhlciBj\nb2xsZWN0aW9uIGlzIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBy\nZXBsYWNlQ29sbGVjdGlvbihBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIENvbGxl\nY3Rpb24gZnJtYywKICAgICAgICBDb2xsZWN0aW9uIHRvYywgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAv\nLyBpZiBmcm1jIGNvbGxlY3Rpb24gaXMgZW1wdHksIGp1c3QgY2xlYXIgdG9j\nCiAgICAgICAgaWYgKGZybWMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGlm\nICghdG9jLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRvYy5jbGVhcigp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBp\nZiB0aGlzIGlzIGEgcGMgY29sbGVjdGlvbiwgYXR0YWNoIGFsbCBpbnN0YW5j\nZXMKICAgICAgICBib29sZWFuIHBjID0gZm1kLmdldEVsZW1lbnQoKS5pc0Rl\nY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgaWYgKHBjKQogICAgICAgICAgICBm\ncm1jID0gYXR0YWNoQ29sbGVjdGlvbihtYW5hZ2VyLCBmcm1jLCBzbSwgZm1k\nKTsKCiAgICAgICAgLy8gcmVtb3ZlIGFsbCBlbGVtZW50cyBmcm9tIHRoZSB0\nb2MgY29sbGVjdGlvbiB0aGF0IGFyZW4ndCBpbiBmcm1jCiAgICAgICAgdG9j\nLnJldGFpbkFsbChmcm1jKTsKCiAgICAgICAgLy8gbm93IGFkZCBhbGwgZWxl\nbWVudHMgdGhhdCBhcmUgaW4gZnJtYyBidXQgbm90IHRvYwogICAgICAgIGlm\nIChmcm1jLnNpemUoKSAhPSB0b2Muc2l6ZSgpKSB7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaSA9IGZybWMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICBPYmplY3Qgb2IgPSBpLm5leHQoKTsKICAg\nICAgICAgICAgICAgIGlmICghdG9jLmNvbnRhaW5zKG9iKSkKICAgICAgICAg\nICAgICAgICAgICB0b2MuYWRkKG9iKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBjb2xsZWN0\naW9uIHdpdGggdGhlIGF0dGFjaGVkIGNvbnRlbnRzIG9mIHRoZSBnaXZlbiBv\nbmUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGF0dGFjaENv\nbGxlY3Rpb24oQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAgIENvbGxl\nY3Rpb24gb3JpZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICBDb2xsZWN0aW9uIGNvbGwgPSBjb3B5Q29s\nbGVjdGlvbihtYW5hZ2VyLCBvcmlnLCBmbWQpOwogICAgICAgIFZhbHVlTWV0\nYURhdGEgdm1kID0gZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICBpZiAoIXZt\nZC5pc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBjb2xs\nOwoKICAgICAgICAvLyB1bmZvcnR1bmF0ZWx5IHdlIGhhdmUgdG8gY2xlYXIg\ndGhlIG9yaWdpbmFsIGFuZCByZS1hZGQKICAgICAgICBjb2xsLmNsZWFyKCk7\nCiAgICAgICAgT2JqZWN0IGVsZW07CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBvcmlnLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgIGlmICh2bWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAgZWxlbSA9IGdl\ndFJlZmVyZW5jZShtYW5hZ2VyLCBpdHIubmV4dCgpLCBzbSwgdm1kKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZWxlbSA9IG1hbmFnZXIu\nYXR0YWNoKGl0ci5uZXh0KCksIG51bGwsIHNtLCB2bWQsIGZhbHNlKTsKICAg\nICAgICAgICAgY29sbC5hZGQoZWxlbSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBjb2xsOwogICAgfQoKICAgIC8qKgogICAgICogQ29waWVzIHRoZSBn\naXZlbiBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rp\nb24gY29weUNvbGxlY3Rpb24oQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBDb2xs\nZWN0aW9uIG9yaWcsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBDb2xsZWN0aW9uIGNvbGwgPSBtYW5hZ2VyLmdldFByb3h5TWFuYWdl\ncigpLmNvcHlDb2xsZWN0aW9uKG9yaWcpOwogICAgICAgIGlmIChjb2xsID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICByZXR1cm4g\nY29sbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXR0YWNo\nZWQgdmVyc2lvbiBvZiB0aGUgPGNvZGU+ZnJtbDwvY29kZT4KICAgICAqIGxp\nc3QgaWYgaXQgaXMgZGlmZmVyZW50IHRoYW4gPGNvZGU+dG9sPC9jb2RlPi4g\nSWYgdGhlIGxpc3RzCiAgICAgKiB3aWxsIGJlIGlkZW50aWNhbCwgcmV0dXJu\ncyA8Y29kZT50b2w8L2NvZGU+LiBOZWl0aGVyIGxpc3QgaXMgbnVsbC4KICAg\nICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIHJlcGxhY2VMaXN0KEF0dGFj\naE1hbmFnZXIgbWFuYWdlciwgQ29sbGVjdGlvbiBmcm1sLAogICAgICAgIENv\nbGxlY3Rpb24gdG9sLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgIGJvb2xlYW4gcGMgPSBmbWQuZ2V0RWxl\nbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAgICBpZiAocGMpCiAg\nICAgICAgICAgIGZybWwgPSBhdHRhY2hDb2xsZWN0aW9uKG1hbmFnZXIsIGZy\nbWwsIHNtLCBmbWQpOwoKICAgICAgICAvLyBpZiB0aGUgb25seSBkaWZmIGJl\ndHdlZW4gZnJtbCBhbmQgdG9sIGlzIHNvbWUgYWRkZWQgZWxlbWVudHMgYXQK\nICAgICAgICAvLyB0aGUgZW5kLCBtYWtlIHRoZSBjaGFuZ2VzIGRpcmVjdGx5\nIGluIHRvbAogICAgICAgIGlmIChmcm1sLnNpemUoKSA+PSB0b2wuc2l6ZSgp\nKSB7CiAgICAgICAgICAgIEl0ZXJhdG9yIGZybWkgPSBmcm1sLml0ZXJhdG9y\nKCk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgdG9pID0gdG9sLml0ZXJh\ndG9yKCk7IHRvaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAvLyBp\nZiB0aGVyZSdzIGFuIGluY29tcGF0aWJpbGl0eSwganVzdCByZXR1cm4gYSBj\nb3B5IG9mIGZybWwKICAgICAgICAgICAgICAgIC8vIChpdCdzIGFscmVhZHkg\nY29waWVkIGlmIHdlIGF0dGFjaGVkIGl0KQogICAgICAgICAgICAgICAgaWYg\nKCFlcXVhbHMoZnJtaS5uZXh0KCksIHRvaS5uZXh0KCksIHBjKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gKHBjKSA/IGZybWwgOiBjb3B5Q29sbGVj\ndGlvbihtYW5hZ2VyLCBmcm1sLCBmbWQpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBqdXN0IGFkZCB0aGUgZXh0cmEgZWxlbWVudHMgaW4gZnJt\nbCB0byB0b2wgYW5kIHJldHVybiB0b2wKICAgICAgICAgICAgd2hpbGUgKGZy\nbWkuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgdG9sLmFkZChmcm1pLm5l\neHQoKSk7CiAgICAgICAgICAgIHJldHVybiB0b2w7CiAgICAgICAgfQoKICAg\nICAgICAvLyB0aGUgbGlzdHMgYXJlIGRpZmZlcmVudDsganVzdCBtYWtlIHN1\ncmUgZnJtbCBpcyBjb3BpZWQgYW5kIHJldHVybiBpdAogICAgICAgIHJldHVy\nbiAocGMpID8gZnJtbCA6IGNvcHlDb2xsZWN0aW9uKG1hbmFnZXIsIGZybWws\nIGZtZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIHRoZSBjb250\nZW50cyBvZiA8Y29kZT50b208L2NvZGU+IHdpdGggdGhlIGNvbnRlbnRzIG9m\nCiAgICAgKiA8Y29kZT5mcm1tPC9jb2RlPi4gTmVpdGhlciBtYXAgaXMgbnVs\nbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VNYXAoQXR0YWNo\nTWFuYWdlciBtYW5hZ2VyLCBNYXAgZnJtbSwgTWFwIHRvbSwKICAgICAgICBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCkgewog\nICAgICAgIGlmIChmcm1tLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAo\nIXRvbS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICB0b20uY2xlYXIoKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYg\ndGhpcyBpcyBhIHBjIG1hcCwgYXR0YWNoIGFsbCBpbnN0YW5jZXMKICAgICAg\nICBib29sZWFuIGtleVBDID0gZm1kLmdldEtleSgpLmlzRGVjbGFyZWRUeXBl\nUEMoKTsKICAgICAgICBib29sZWFuIHZhbFBDID0gZm1kLmdldEVsZW1lbnQo\nKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgaWYgKGtleVBDIHx8IHZh\nbFBDKQogICAgICAgICAgICBmcm1tID0gYXR0YWNoTWFwKG1hbmFnZXIsIGZy\nbW0sIHNtLCBmbWQpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgYWxsIHRoZSBr\nZXlzIGluIHRoZSBmcm9tIG1hcCBhcmUgaW4gdGhlIHR3byBtYXAsIGFuZAog\nICAgICAgIC8vIHRoYXQgdGhleSBoYXZlIHRoZSBzYW1lIHZhbHVlcwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaSA9IGZybW0uZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IGVu\ndHJ5ID0gKE1hcC5FbnRyeSkgaS5uZXh0KCk7CiAgICAgICAgICAgIGlmICgh\ndG9tLmNvbnRhaW5zS2V5KGVudHJ5LmdldEtleSgpKQogICAgICAgICAgICAg\nICAgfHwgIWVxdWFscyh0b20uZ2V0KGVudHJ5LmdldEtleSgpKSwgZW50cnku\nZ2V0VmFsdWUoKSwgdmFsUEMpKSB7CiAgICAgICAgICAgICAgICB0b20ucHV0\nKGVudHJ5LmdldEtleSgpLCBlbnRyeS5nZXRWYWx1ZSgpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGFueSBrZXlzIGlu\nIHRoZSB0byBtYXAgdGhhdCBhcmVuJ3QgaW4gdGhlIGZyb20gbWFwCiAgICAg\nICAgaWYgKHRvbS5zaXplKCkgIT0gZnJtbS5zaXplKCkpIHsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpID0gdG9tLmtleVNldCgpLml0ZXJhdG9yKCk7\nIGkuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYgKCEoZnJtbS5j\nb250YWluc0tleShpLm5leHQoKSkpKQogICAgICAgICAgICAgICAgICAgIGku\ncmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdp\ndmVuIG1hcCBhcmUgYXR0YWNoZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBN\nYXAgYXR0YWNoTWFwKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgTWFwIG9yaWcs\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICBNYXAgbWFwID0gbWFuYWdlci5nZXRQcm94eU1h\nbmFnZXIoKS5jb3B5TWFwKG9yaWcpOwogICAgICAgIGlmIChtYXAgPT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vdC1jb3B5YWJsZSIsIGZtZCkpOwoKICAgICAgICBWYWx1ZU1ldGFE\nYXRhIGtleW1kID0gZm1kLmdldEtleSgpOwogICAgICAgIFZhbHVlTWV0YURh\ndGEgdmFsbWQgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAgIGlmICgha2V5\nbWQuaXNEZWNsYXJlZFR5cGVQQygpICYmICF2YWxtZC5pc0RlY2xhcmVkVHlw\nZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBtYXA7CgogICAgICAgIC8vIGlm\nIHdlIGhhdmUgdG8gcmVwbGFjZSBrZXlzLCBqdXN0IGNsZWFyIGFuZCByZS1h\nZGQ7IG90aGVyd2lzZQogICAgICAgIC8vIHdlIGNhbiB1c2UgdGhlIGVudHJ5\nIHNldCB0byByZXNldCB0aGUgdmFsdWVzIG9ubHkKICAgICAgICBNYXAuRW50\ncnkgZW50cnk7CiAgICAgICAgaWYgKGtleW1kLmlzRGVjbGFyZWRUeXBlUEMo\nKSkgewogICAgICAgICAgICBtYXAuY2xlYXIoKTsKICAgICAgICAgICAgT2Jq\nZWN0IGtleSwgdmFsOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIG9yaWcuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAg\nICAgICAgICAgICAgICBpZiAoa2V5bWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09\nIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAg\nICAgIGtleSA9IGdldFJlZmVyZW5jZShtYW5hZ2VyLCBrZXksIHNtLCBrZXlt\nZCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\na2V5ID0gbWFuYWdlci5hdHRhY2goa2V5LCBudWxsLCBzbSwga2V5bWQsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZhbHVlKCk7\nCiAgICAgICAgICAgICAgICBpZiAodmFsbWQuaXNEZWNsYXJlZFR5cGVQQygp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbG1kLmdldENhc2NhZGVB\ndHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORSkKICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsID0gZ2V0UmVmZXJlbmNlKG1hbmFnZXIs\nIHZhbCwgc20sIHZhbG1kKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IG1hbmFnZXIuYXR0YWNoKHZh\nbCwgbnVsbCwgc20sIHZhbG1kLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBtYXAucHV0KGtleSwgdmFsKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIE9iamVjdCB2YWw7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbWFwLmVudHJ5U2V0\nKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGlmICh2YWxtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFsdWVN\nZXRhRGF0YS5DQVNDQURFX05PTkUpCiAgICAgICAgICAgICAgICAgICAgdmFs\nID0gZ2V0UmVmZXJlbmNlKG1hbmFnZXIsIGVudHJ5LmdldFZhbHVlKCksIHNt\nLCB2YWxtZCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgdmFsID0gbWFuYWdlci5hdHRhY2goZW50cnkuZ2V0VmFsdWUoKSwg\nbnVsbCwgc20sIHZhbG1kLCAKICAgICAgICAgICAgICAgICAgICAgICAgZmFs\nc2UpOwogICAgICAgICAgICAgICAgZW50cnkuc2V0VmFsdWUodmFsKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbWFwOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhbiBhdHRhY2hlZCB2ZXJzaW9u\nIG9mIHRoZSA8Y29kZT5mcm1hPC9jb2RlPgogICAgICogYXJyYXkgaWYgaXQg\naXMgZGlmZmVyZW50IHRoYW4gPGNvZGU+dG9hPC9jb2RlPi4gSWYgdGhlIGFy\ncmF5cwogICAgICogd2lsbCBiZSBpZGVudGljYWwsIHJldHVybnMgPGNvZGU+\ndG9hPC9jb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgcmVwbGFj\nZUFycmF5KEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgT2JqZWN0IGZybWEsCiAg\nICAgICAgT2JqZWN0IHRvYSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmll\nbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpbnQgbGVuID0gQXJyYXkuZ2V0\nTGVuZ3RoKGZybWEpOwogICAgICAgIGJvb2xlYW4gZGlmZiA9IHRvYSA9PSBu\ndWxsIHx8IGxlbiAhPSBBcnJheS5nZXRMZW5ndGgodG9hKTsKCiAgICAgICAg\nLy8gcG9wdWxhdGUgYW4gYXJyYXkgY29weSBvbiB0aGUgaW5pdGlhbCBhc3N1\nbXB0aW9uIHRoYXQgdGhlIGFycmF5CiAgICAgICAgLy8gaXMgZGlydHkKICAg\nICAgICBPYmplY3QgbmV3YSA9IEFycmF5Lm5ld0luc3RhbmNlKGZtZC5nZXRF\nbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgIGxlbik7\nCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQgPSBmbWQuZ2V0RWxlbWVudCgp\nOwogICAgICAgIGJvb2xlYW4gcGMgPSB2bWQuaXNEZWNsYXJlZFR5cGVQQygp\nOwogICAgICAgIE9iamVjdCBlbGVtOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgZWxlbSA9IEFycmF5Lmdl\ndChmcm1hLCBpKTsKICAgICAgICAgICAgaWYgKHBjKSB7CiAgICAgICAgICAg\nICAgICBpZiAodm1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFE\nYXRhLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAgICAgICAgICBlbGVtID0g\nZ2V0UmVmZXJlbmNlKG1hbmFnZXIsIGVsZW0sIHNtLCB2bWQpOwogICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGVsZW0gPSBtYW5h\nZ2VyLmF0dGFjaChlbGVtLCBudWxsLCBzbSwgdm1kLCBmYWxzZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgZGlmZiA9IGRpZmYgfHwgIWVxdWFscyhl\nbGVtLCBBcnJheS5nZXQodG9hLCBpKSwgcGMpOwogICAgICAgICAgICBBcnJh\neS5zZXQobmV3YSwgaSwgZWxlbSk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiAoZGlmZikgPyBuZXdhIDogdG9hOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIG9iamVjdHMgYXJlIGVxdWFsLiBQ\nQ3MgYXJlIGNvbXBhcmVkIGZvcgogICAgICogb24gSlZNIGlkZW50aXR5Lgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGVxdWFscyhPYmpl\nY3QgYSwgT2JqZWN0IGIsIGJvb2xlYW4gcGMpIHsKICAgICAgICBpZiAoYSA9\nPSBiKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAocGMg\nfHwgYSA9PSBudWxsIHx8IGIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoJCXJldHVybiBhLmVxdWFscyAoYik7Cgl9Cn0K\n","encoding":"base64"}

