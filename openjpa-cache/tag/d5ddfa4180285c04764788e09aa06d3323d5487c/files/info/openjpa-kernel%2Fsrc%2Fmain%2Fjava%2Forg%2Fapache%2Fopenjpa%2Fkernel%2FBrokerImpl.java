{"sha":"4695a325d1735045cc9281aef9f106858c5215dd","node_id":"MDQ6QmxvYjIwNjM2NDo0Njk1YTMyNWQxNzM1MDQ1Y2M5MjgxYWVmOWYxMDY4NThjNTIxNWRk","size":165369,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4695a325d1735045cc9281aef9f106858c5215dd","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsOw0KDQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCmltcG9y\ndCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOw0KaW1wb3J0IGphdmEuaW8u\nT2JqZWN0T3V0cHV0U3RyZWFtOw0KaW1wb3J0IGphdmEuaW8uU2VyaWFsaXph\nYmxlOw0KaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOw0KaW1w\nb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsNCmltcG9ydCBq\nYXZhLnV0aWwuQWJzdHJhY3RDb2xsZWN0aW9uOw0KaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7DQppbXBvcnQgamF2YS51dGlsLkJpdFNldDsNCmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsNCmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7DQppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7DQppbXBvcnQg\namF2YS51dGlsLkhhc2hTZXQ7DQppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOw0KaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0Ow0KaW1wb3J0IGphdmEu\ndXRpbC5MaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5NYXA7DQppbXBvcnQgamF2\nYS51dGlsLlNldDsNCmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7\nDQppbXBvcnQgamF2YXgudHJhbnNhY3Rpb24uU3luY2hyb25pemF0aW9uOw0K\nDQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLml0ZXJh\ndG9ycy5JdGVyYXRvckNoYWluOw0KaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9u\ncy5jb2xsZWN0aW9ucy5tYXAuSWRlbnRpdHlNYXA7DQppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5MaW5rZWRNYXA7DQppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLnNldC5NYXBCYWNr\nZWRTZXQ7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuQ29tcGF0\naWJpbGl0eTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBQ29uZmlndXJhdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZGF0YWNhY2hlLkRhdGFDYWNoZTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZWUuTWFuYWdlZFJ1bnRpbWU7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUENSZWdpc3RyeTsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7DQppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50Ow0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFn\nZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNv\nbW1pdEV2ZW50TWFuYWdlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZXZlbnQuVHJhbnNhY3Rpb25FdmVudDsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuVHJhbnNhY3Rpb25FdmVudE1hbmFnZXI7DQppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25QYXJz\nZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhl\nbHBlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5S\nZWZlcmVuY2VIYXNoTWFwOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5SZWZlcmVuY2VIYXNoU2V0Ow0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VNYXA7DQppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50TG9jazsNCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOw0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5\nOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0\nYURhdGE7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVN\nZXRhRGF0YTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1\nZVN0cmF0ZWdpZXM7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nQXBwbGljYXRpb25JZHM7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuQ2FsbGJhY2tFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuRXhjZXB0aW9uczsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkltcGxIZWxwZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOw0KaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk5vVHJhbnNhY3Rpb25FeGNl\ncHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0\nRXhpc3RzRXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLk9iamVjdElkOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT3B0aW1pc3RpY0V4Y2VwdGlvbjsNCmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1lRXhjZXB0aW9uVHJh\nbnNsYXRvcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9y\nZUV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nbnN1cHBvcnRlZEV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5Vc2VyRXhjZXB0aW9uOw0KDQovKioNCiAqIENvbmNyZXRlIHtA\nbGluayBCcm9rZXJ9LiBUaGUgYnJva2VyIGhhbmRsZXMgb2JqZWN0LWxldmVs\nIGJlaGF2aW9yLA0KICogYnV0IGxlYXZlcyBhbGwgaW50ZXJhY3Rpb24gd2l0\naCB0aGUgZGF0YSBzdG9yZSB0byBhIHtAbGluayBTdG9yZU1hbmFnZXJ9DQog\nKiB0aGF0IG11c3QgYmUgc3VwcGxpZWQgYXQgaW5pdGlhbGl6YXRpb24uDQog\nKg0KICogQGF1dGhvciBBYmUgV2hpdGUNCiAqLw0KcHVibGljIGNsYXNzIEJy\nb2tlckltcGwNCiAgICBpbXBsZW1lbnRzIEJyb2tlciwgRmluZENhbGxiYWNr\ncywgQ2xvbmVhYmxlLCBTZXJpYWxpemFibGUgew0KDQogICAgLyoqDQogICAg\nICogSW5jcmVtZW50YWwgZmx1c2guDQogICAgICovDQogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfSU5DID0gMDsNCg0KICAgIC8qKg0K\nICAgICAqIEZsdXNoIGluIHByZXBhcmF0aW9uIG9mIGNvbW1pdC4NCiAgICAg\nKi8NCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9DT01N\nSVQgPSAxOw0KDQogICAgLyoqDQogICAgICogRmx1c2ggdG8gY2hlY2sgY29u\nc2lzdGVuY3kgb2YgY2FjaGUsIHRoZW4gaW1tZWRpYXRlbHkgcm9sbGJhY2sg\nY2hhbmdlcy4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBGTFVTSF9ST0xMQkFDSyA9IDI7DQoNCiAgICAvKioNCiAgICAgKiBS\ndW4gcGVyc2lzdGVuY2UtYnktcmVhY2hhYmlsaXR5IGFuZCBvdGhlciBmbHVz\naC10aW1lIG9wZXJhdGlvbnMgd2l0aG91dA0KICAgICAqIGFjY2Vzc2luZyB0\naGUgZGF0YWJhc2UuDQogICAgICovDQogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBpbnQgRkxVU0hfTE9HSUNBTCA9IDM7DQoNCiAgICBzdGF0aWMgZmlu\nYWwgaW50IFNUQVRVU19JTklUID0gMDsNCiAgICBzdGF0aWMgZmluYWwgaW50\nIFNUQVRVU19UUkFOU0lFTlQgPSAxOw0KICAgIHN0YXRpYyBmaW5hbCBpbnQg\nU1RBVFVTX09JRF9BU1NJR04gPSAyOw0KICAgIHN0YXRpYyBmaW5hbCBpbnQg\nU1RBVFVTX0NPTU1JVF9ORVcgPSAzOw0KDQogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfQUNUSVZFID0gMiA8PCAwOw0KICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX1NUT1JFX0FDVElWRSA9IDIgPDwgMTsN\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19DTE9TRV9JTlZP\nS0VEID0gMiA8PCAyOw0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1BSRVNUT1JJTkcgPSAyIDw8IDM7DQogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfREVSRUZERUxFVElORyA9IDIgPDwgNDsNCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSElORyA9IDIgPDwg\nNTsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9G\nTFVTSElORyA9IDIgPDwgNjsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19GTFVTSEVEID0gMiA8PCA3Ow0KICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8PCA4Ow0KICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1JFTU9URV9MSVNURU5F\nUiA9IDIgPDwgOTsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19SRVRBSU5FRF9DT05OID0gMiA8PCAxMDsNCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDExOw0KDQog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10gRU1QVFlfT0JKRUNU\nUyA9IG5ldyBPYmplY3RbMF07DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9DQogICAgICAgIExvY2FsaXplci5mb3JQYWNr\nYWdlKEJyb2tlckltcGwuY2xhc3MpOw0KDQogICAgLy8JdGhlIHN0b3JlIG1h\nbmFnZXIgaW4gdXNlOyB0aGlzIG1heSBiZSBhIGRlY29yYXRvciBzdWNoIGFz\nIGENCiAgICAvLwlkYXRhIGNhY2hlIHN0b3JlIG1hbmFnZXIgYXJvdW5kIHRo\nZSBuYXRpdmUgc3RvcmUgbWFuYWdlcg0KICAgIHByaXZhdGUgdHJhbnNpZW50\nIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIgX3N0b3JlID0gbnVsbDsNCg0KICAg\nIHByaXZhdGUgRmV0Y2hDb25maWd1cmF0aW9uIF9mYyA9IG51bGw7DQogICAg\ncHJpdmF0ZSBTdHJpbmcgX3VzZXIgPSBudWxsOw0KICAgIHByaXZhdGUgU3Ry\naW5nIF9wYXNzID0gbnVsbDsNCg0KICAgIC8vIHRoZXNlIG11c3QgYmUgcmVi\ndWlsdCBieSB0aGUgZmFjYWRlIGxheWVyIGR1cmluZyBpdHMgZGVzZXJpYWxp\nemF0aW9uDQogICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxs\nOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IENvbXBhdGliaWxpdHkgX2NvbXBh\ndCA9IG51bGw7DQogICAgcHJpdmF0ZSB0cmFuc2llbnQgTWFuYWdlZFJ1bnRp\nbWUgX3J1bnRpbWUgPSBudWxsOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IExv\nY2tNYW5hZ2VyIF9sbSA9IG51bGw7DQogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nSW52ZXJzZU1hbmFnZXIgX2ltID0gbnVsbDsNCiAgICBwcml2YXRlIHRyYW5z\naWVudCBSZWVudHJhbnRMb2NrIF9sb2NrID0gbnVsbDsNCiAgICBwcml2YXRl\nIHRyYW5zaWVudCBPcENhbGxiYWNrcyBfY2FsbCA9IG51bGw7DQogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgX2V4\ndHJhbnMgPSBudWxsOw0KDQogICAgLy8gcmVmIHRvIHByb2R1Y2luZyBmYWN0\nb3J5IGFuZCBjb25maWd1cmF0aW9uDQogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nQWJzdHJhY3RCcm9rZXJGYWN0b3J5IF9mYWN0b3J5ID0gbnVsbDsNCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9\nIG51bGw7DQoNCiAgICAvLyBjYWNoZSBjbGFzcyBsb2FkZXIgYXNzb2NpYXRl\nZCB3aXRoIHRoZSBicm9rZXINCiAgICBwcml2YXRlIHRyYW5zaWVudCBDbGFz\nc0xvYWRlciBfbG9hZGVyID0gbnVsbDsNCg0KICAgIC8vIHVzZXIgc3RhdGUN\nCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlvbiBfc3luYyA9IG51bGw7DQog\nICAgcHJpdmF0ZSBNYXAgX3VzZXJPYmplY3RzID0gbnVsbDsNCg0KICAgIC8v\nIG1hbmFnZWQgb2JqZWN0IGNhY2hlcw0KICAgIHByaXZhdGUgTWFuYWdlZENh\nY2hlIF9jYWNoZSA9IG51bGw7DQogICAgcHJpdmF0ZSBUcmFuc2FjdGlvbmFs\nQ2FjaGUgX3RyYW5zQ2FjaGUgPSBudWxsOw0KICAgIHByaXZhdGUgU2V0IF90\ncmFuc0FkZGl0aW9ucyA9IG51bGw7DQogICAgcHJpdmF0ZSBTZXQgX2RlcmVm\nQ2FjaGUgPSBudWxsOw0KICAgIHByaXZhdGUgU2V0IF9kZXJlZkFkZGl0aW9u\ncyA9IG51bGw7DQoNCiAgICAvLyB0aGVzZSBhcmUgdXNlZCBmb3IgbWV0aG9k\nLWludGVybmFsIHN0YXRlIG9ubHkNCiAgICBwcml2YXRlIHRyYW5zaWVudCBN\nYXAgX2xvYWRpbmcgPSBudWxsOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IFNl\ndCBfb3BlcmF0aW5nID0gbnVsbDsNCg0KICAgIHByaXZhdGUgU2V0IF9wZXJz\naXN0ZWRDbHNzID0gbnVsbDsNCiAgICBwcml2YXRlIFNldCBfdXBkYXRlZENs\nc3MgPSBudWxsOw0KICAgIHByaXZhdGUgU2V0IF9kZWxldGVkQ2xzcyA9IG51\nbGw7DQogICAgcHJpdmF0ZSBTZXQgX3BlbmRpbmcgPSBudWxsOw0KICAgIHBy\naXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7DQoNCiAgICAvLyB0cmFjayBp\nbnN0YW5jZXMgdGhhdCBiZWNvbWUgdHJhbnNhY3Rpb25hbCBhZnRlciB0aGUg\nZmlyc3Qgc2F2ZXBvaW50DQogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRoZSB0\ncmFuc2FjdGlvbmFsIGNhY2hlKQ0KICAgIHByaXZhdGUgU2V0IF9zYXZlcG9p\nbnRDYWNoZSA9IG51bGw7DQogICAgcHJpdmF0ZSBMaW5rZWRNYXAgX3NhdmVw\nb2ludHMgPSBudWxsOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IFNhdmVwb2lu\ndE1hbmFnZXIgX3NwbSA9IG51bGw7DQoNCiAgICAvLyB0cmFjayBvcGVuIHF1\nZXJpZXMgYW5kIGV4dGVudHMgc28gd2UgY2FuIGZyZWUgdGhlaXIgcmVzb3Vy\nY2VzIG9uIGNsb3NlDQogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVmZXJlbmNl\nSGFzaFNldCBfcXVlcmllcyA9IG51bGw7DQogICAgcHJpdmF0ZSB0cmFuc2ll\nbnQgUmVmZXJlbmNlSGFzaFNldCBfZXh0ZW50cyA9IG51bGw7DQoNCiAgICAv\nLyB0cmFjayBvcGVyYXRpb24gc3RhY2sgZGVwdGguIFRyYW5zaWVudCBiZWNh\ndXNlIG9wZXJhdGlvbnMgY2Fubm90DQogICAgLy8gc3BhbiBzZXJpYWxpemF0\naW9uLg0KICAgIHByaXZhdGUgdHJhbnNpZW50IGludCBfb3BlcmF0aW9uQ291\nbnQgPSAwOw0KDQogICAgLy8gb3B0aW9ucw0KICAgIHByaXZhdGUgYm9vbGVh\nbiBfbm9udHJhbnNSZWFkID0gZmFsc2U7DQogICAgcHJpdmF0ZSBib29sZWFu\nIF9ub250cmFuc1dyaXRlID0gZmFsc2U7DQogICAgcHJpdmF0ZSBib29sZWFu\nIF9yZXRhaW5TdGF0ZSA9IGZhbHNlOw0KICAgIHByaXZhdGUgaW50IF9hdXRv\nQ2xlYXIgPSBDTEVBUl9EQVRBU1RPUkU7DQogICAgcHJpdmF0ZSBpbnQgX3Jl\nc3RvcmVTdGF0ZSA9IFJFU1RPUkVfSU1NVVRBQkxFOw0KICAgIHByaXZhdGUg\nYm9vbGVhbiBfb3B0aW1pc3RpYyA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfaWdub3JlQ2hhbmdlcyA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfbXVsdGl0aHJlYWRlZCA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfbWFuYWdlZCA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9vbGVhbiBf\nc3luY01hbmFnZWQgPSBmYWxzZTsNCiAgICBwcml2YXRlIGludCBfY29ublJl\ndGFpbk1vZGUgPSBDT05OX1JFVEFJTl9ERU1BTkQ7DQogICAgcHJpdmF0ZSBi\nb29sZWFuIF9ldmljdERhdGFDYWNoZSA9IGZhbHNlOw0KICAgIHByaXZhdGUg\nYm9vbGVhbiBfcG9wdWxhdGVEYXRhQ2FjaGUgPSB0cnVlOw0KICAgIHByaXZh\ndGUgYm9vbGVhbiBfbGFyZ2VUcmFuc2FjdGlvbiA9IGZhbHNlOw0KICAgIHBy\naXZhdGUgaW50IF9hdXRvRGV0YWNoID0gMDsNCiAgICBwcml2YXRlIGludCBf\nZGV0YWNoU3RhdGUgPSBERVRBQ0hfTE9BREVEOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfZGV0YWNoZWROZXcgPSB0cnVlOw0KICAgIHByaXZhdGUgYm9vbGVh\nbiBfb3JkZXJEaXJ0eSA9IGZhbHNlOw0KDQogICAgLy8gc3RhdHVzDQogICAg\ncHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsNCg0KICAgIC8vIHRoaXMgaXMgbm90\nIGluIHN0YXR1cyBiZWNhdXNlIGl0IHNob3VsZCBub3QgYmUgc2VyaWFsaXpl\nZA0KICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX2lzU2VyaWFsaXpp\nbmcgPSBmYWxzZTsNCg0KICAgIC8vIHRyYW5zaWVudCBiZWNhdXNlIGNsb3Nl\nZCBicm9rZXJzIGNhbid0IGJlIHNlcmlhbGl6ZWQNCiAgICBwcml2YXRlIHRy\nYW5zaWVudCBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsNCiAgICBwcml2YXRl\nIHRyYW5zaWVudCBSdW50aW1lRXhjZXB0aW9uIF9jbG9zZWRFeGNlcHRpb24g\nPSBudWxsOw0KDQogICAgLy8gZXZlbnQgbWFuYWdlcnMNCiAgICBwcml2YXRl\nIFRyYW5zYWN0aW9uRXZlbnRNYW5hZ2VyIF90cmFuc0V2ZW50TWFuYWdlciA9\nIG51bGw7DQogICAgcHJpdmF0ZSBpbnQgX3RyYW5zQ2FsbGJhY2tNb2RlID0g\nMDsNCiAgICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFuYWdlciBfbGlmZUV2\nZW50TWFuYWdlciA9IG51bGw7DQogICAgcHJpdmF0ZSBpbnQgX2xpZmVDYWxs\nYmFja01vZGUgPSAwOw0KDQogICAgcHJpdmF0ZSB0cmFuc2llbnQgYm9vbGVh\nbiBfaW5pdGlhbGl6ZVdhc0ludm9rZWQgPSBmYWxzZTsNCiAgICBwcml2YXRl\nIExpbmtlZExpc3QgX2ZjczsNCg0KICAgIC8qKg0KICAgICAqIFNldCB0aGUg\ncGVyc2lzdGVuY2UgbWFuYWdlcidzIGF1dGhlbnRpY2F0aW9uLiBUaGlzIGlz\nIHRoZSBmaXJzdA0KICAgICAqIG1ldGhvZCBjYWxsZWQgYWZ0ZXIgY29uc3Ry\ndWN0aW9uLg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXIgdGhlIHVzZXJu\nYW1lIHRoaXMgYnJva2VyIHJlcHJlc2VudHM7IHVzZWQgd2hlbiBwb29saW5n\nDQogICAgICogYnJva2VycyB0byBtYWtlIHN1cmUgdGhhdCBhIHJlcXVlc3Qg\ndG8gdGhlIGZhY3RvcnkgZm9yDQogICAgICogYSBjb25uZWN0aW9uIHdpdGgg\nYW4gZXhwbGljaXQgdXNlciBpcyBkZWxlZ2F0ZWQgdG8gYSBzdWl0YWJsZSBi\ncm9rZXINCiAgICAgKiBAcGFyYW0gcGFzcyB0aGUgcGFzc3dvcmQgZm9yIHRo\nZSBhYm92ZSB1c2VyDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2V0QXV0\naGVudGljYXRpb24oU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzKSB7DQogICAg\nICAgIF91c2VyID0gdXNlcjsNCiAgICAgICAgX3Bhc3MgPSBwYXNzOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgdGhlIHBlcnNpc3Rl\nbmNlIG1hbmFnZXIuIFRoaXMgbWV0aG9kIGlzIGNhbGxlZA0KICAgICAqIGF1\ndG9tYXRpY2FsbHkgYnkgdGhlIGZhY3RvcnkgYmVmb3JlIHVzZS4NCiAgICAg\nKg0KICAgICAqIEBwYXJhbSBmYWN0b3J5IHRoZSBmYWN0b3J5IHVzZWQgdG8g\nY3JlYXRlIHRoaXMgYnJva2VyDQogICAgICogQHBhcmFtIHNtIGEgY29uY3Jl\ndGUgU3RvcmVNYW5hZ2VyIGltcGxlbWVudGF0aW9uIHRvDQogICAgICogaGFu\nZGxlIGludGVyYWN0aW9uIHdpdGggdGhlIGRhdGEgc3RvcmUNCiAgICAgKiBA\ncGFyYW0gbWFuYWdlZCB0aGUgdHJhbnNhY3Rpb24gbW9kZQ0KICAgICAqIEBw\nYXJhbSBjb25uTW9kZSB0aGUgY29ubmVjdGlvbiByZXRhaW4gbW9kZQ0KICAg\nICAqIEBwYXJhbSBmcm9tRGVzZXJpYWxpemF0aW9uIHdoZXRoZXIgdGhpcyBj\nYWxsIGhhcHBlbmVkIGJlY2F1c2Ugb2YgYQ0KICAgICAqIGRlc2VyaWFsaXph\ndGlvbiBvciBjcmVhdGlvbiBvZiBhIG5ldyBCcm9rZXJJbXBsLg0KICAgICAq\nLw0KICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoQWJzdHJhY3RCcm9rZXJG\nYWN0b3J5IGZhY3RvcnksDQogICAgICAgIERlbGVnYXRpbmdTdG9yZU1hbmFn\nZXIgc20sIGJvb2xlYW4gbWFuYWdlZCwgaW50IGNvbm5Nb2RlLA0KICAgICAg\nICBib29sZWFuIGZyb21EZXNlcmlhbGl6YXRpb24pIHsNCiAgICAgICAgX2lu\naXRpYWxpemVXYXNJbnZva2VkID0gdHJ1ZTsNCiAgICAgICAgX2xvYWRlciA9\nIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nDQogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xhc3NM\nb2FkZXJBY3Rpb24oKSk7DQogICAgICAgIGlmICghZnJvbURlc2VyaWFsaXph\ndGlvbikNCiAgICAgICAgICAgIF9jb25mID0gZmFjdG9yeS5nZXRDb25maWd1\ncmF0aW9uKCk7DQogICAgICAgIF9jb21wYXQgPSBfY29uZi5nZXRDb21wYXRp\nYmlsaXR5SW5zdGFuY2UoKTsNCiAgICAgICAgX2ZhY3RvcnkgPSBmYWN0b3J5\nOw0KICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1\ncmF0aW9uLkxPR19SVU5USU1FKTsNCiAgICAgICAgaWYgKCFmcm9tRGVzZXJp\nYWxpemF0aW9uKQ0KICAgICAgICAgICAgX2NhY2hlID0gbmV3IE1hbmFnZWRD\nYWNoZSh0aGlzKTsNCiAgICAgICAgaW5pdGlhbGl6ZU9wZXJhdGluZ1NldCgp\nOw0KICAgICAgICBfY29ublJldGFpbk1vZGUgPSBjb25uTW9kZTsNCiAgICAg\nICAgX21hbmFnZWQgPSBtYW5hZ2VkOw0KICAgICAgICBpZiAobWFuYWdlZCkN\nCiAgICAgICAgICAgIF9ydW50aW1lID0gX2NvbmYuZ2V0TWFuYWdlZFJ1bnRp\nbWVJbnN0YW5jZSgpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBfcnVu\ndGltZSA9IG5ldyBMb2NhbE1hbmFnZWRSdW50aW1lKHRoaXMpOw0KDQogICAg\nICAgIGlmICghZnJvbURlc2VyaWFsaXphdGlvbikgew0KICAgICAgICAgICAg\nX2xpZmVFdmVudE1hbmFnZXIgPSBuZXcgTGlmZWN5Y2xlRXZlbnRNYW5hZ2Vy\nKCk7DQogICAgICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIgPSBuZXcgVHJh\nbnNhY3Rpb25FdmVudE1hbmFnZXIoKTsNCiAgICAgICAgICAgIGludCBjbW9k\nZSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuDQog\nICAgICAgICAgICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVs\ndHMoKS5nZXRDYWxsYmFja01vZGUoKTsNCiAgICAgICAgICAgIHNldExpZmVj\neWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNtb2RlKTsNCiAgICAgICAgICAg\nIHNldFRyYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOw0K\nDQogICAgICAgICAgICAvLyBzZXR1cCBkZWZhdWx0IG9wdGlvbnMNCiAgICAg\nICAgICAgIF9mYWN0b3J5LmNvbmZpZ3VyZUJyb2tlcih0aGlzKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIC8vIG1ha2Ugc3VyZSB0byBkbyB0aGlzIGFmdGVy\nIGNvbmZpZ3VyaW5nIGJyb2tlciBzbyB0aGF0IHN0b3JlIG1hbmFnZXINCiAg\nICAgICAgLy8gY2FuIGxvb2sgdG8gYnJva2VyIGNvbmZpZ3VyYXRpb247IHdl\nIHNldCBib3RoIHN0b3JlIGFuZCBsb2NrIG1hbmFnZXJzDQogICAgICAgIC8v\nIGJlZm9yZSBpbml0aWFsaXppbmcgdGhlbSBiZWNhdXNlIHRoZXkgbWF5IGVh\nY2ggdHJ5IHRvIGFjY2VzcyB0aGUNCiAgICAgICAgLy8gb3RoZXIgaW4gdGhp\nZXIgaW5pdGlhbGl6YXRpb24NCiAgICAgICAgX3N0b3JlID0gc207DQogICAg\nICAgIF9sbSA9IF9jb25mLm5ld0xvY2tNYW5hZ2VySW5zdGFuY2UoKTsNCiAg\nICAgICAgX2ltID0gX2NvbmYubmV3SW52ZXJzZU1hbmFnZXJJbnN0YW5jZSgp\nOw0KICAgICAgICBfc3BtID0gX2NvbmYuZ2V0U2F2ZXBvaW50TWFuYWdlcklu\nc3RhbmNlKCk7DQogICAgICAgIF9zdG9yZS5zZXRDb250ZXh0KHRoaXMpOw0K\nICAgICAgICBfbG0uc2V0Q29udGV4dCh0aGlzKTsNCg0KICAgICAgICBpZiAo\nX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX0FMV0FZUykNCiAgICAg\nICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsNCiAgICAgICAgaWYgKCFmcm9t\nRGVzZXJpYWxpemF0aW9uKSB7DQogICAgICAgICAgICBfZmMgPSBfc3RvcmUu\nbmV3RmV0Y2hDb25maWd1cmF0aW9uKCk7DQogICAgICAgICAgICBfZmMuc2V0\nQ29udGV4dCh0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHN5bmNo\nIHdpdGggdGhlIGdsb2JhbCB0cmFuc2FjdGlvbiBpbiBwcm9ncmVzcywgaWYg\nYW55DQogICAgICAgIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFu\nc2FjdGlvbih0aGlzLCBmYWxzZSkpDQogICAgICAgICAgICBiZWdpbkludGVy\nbmFsKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemVP\ncGVyYXRpbmdTZXQoKSB7DQogICAgICAgIF9vcGVyYXRpbmcgPSBNYXBCYWNr\nZWRTZXQuZGVjb3JhdGUobmV3IElkZW50aXR5TWFwKCkpOw0KICAgIH0NCiAg\nICANCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSB1bm1vZGlmaWFibGUgc2V0\nIG9mIGluc3RhbmNlcyBiZWluZyBvcGVyYXRlZC4NCiAgICAgKi8NCiAgICBw\ncm90ZWN0ZWQgU2V0IGdldE9wZXJhdGluZ1NldCgpIHsNCiAgICAJcmV0dXJu\nIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZVNldChfb3BlcmF0aW5nKTsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkNCiAgICAgICAgdGhy\nb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsNCiAgICAgICAgaWYg\nKF9pbml0aWFsaXplV2FzSW52b2tlZCkNCiAgICAgICAgICAgIHRocm93IG5l\ndyBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbigpOw0KICAgICAgICBlbHNl\nIHsNCiAgICAgICAgICAgIHJldHVybiBzdXBlci5jbG9uZSgpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlIGEge0BsaW5r\nIE1hcH0gdG8gYmUgdXNlZCBmb3IgdGhlIHByaW1hcnkgbWFuYWdlZCBvYmpl\nY3QgY2FjaGUuDQogICAgICogTWFwcyBvaWRzIHRvIHN0YXRlIG1hbmFnZXJz\nLiBCeSBkZWZhdWx0LCB0aGlzIGNyZWF0ZXMgYQ0KICAgICAqIHtAbGluayBS\nZWZlcmVuY2VNYXB9IHdpdGggc29mdCB2YWx1ZXMuDQogICAgICovDQogICAg\ncHJvdGVjdGVkIE1hcCBuZXdNYW5hZ2VkT2JqZWN0Q2FjaGUoKSB7DQogICAg\nICAgIHJldHVybiBuZXcgUmVmZXJlbmNlSGFzaE1hcChSZWZlcmVuY2VNYXAu\nSEFSRCwgUmVmZXJlbmNlTWFwLlNPRlQpOw0KICAgIH0NCg0KICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBJbXBsZW1l\nbnRhdGlvbiBvZiBTdG9yZUNvbnRleHQNCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICBwdWJsaWMgQnJva2VyIGdldEJy\nb2tlcigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAg\nLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBQcm9wZXJ0aWVzDQogICAgLy8vLy8v\nLy8vLy8vLy8NCg0KICAgIHB1YmxpYyB2b2lkIHNldEltcGxpY2l0QmVoYXZp\nb3IoT3BDYWxsYmFja3MgY2FsbCwNCiAgICAgICAgUnVudGltZUV4Y2VwdGlv\nblRyYW5zbGF0b3IgZXgpIHsNCiAgICAgICAgaWYgKF9jYWxsID09IG51bGwp\nDQogICAgICAgICAgICBfY2FsbCA9IGNhbGw7DQogICAgICAgIGlmIChfZXh0\ncmFucyA9PSBudWxsKQ0KICAgICAgICAgICAgX2V4dHJhbnMgPSBleDsNCiAg\nICB9DQoNCiAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciBnZXRJbnN0\nYW5jZUV4Y2VwdGlvblRyYW5zbGF0b3IoKSB7DQogICAgICAgIHJldHVybiAo\nX29wZXJhdGlvbkNvdW50ID09IDApID8gX2V4dHJhbnMgOiBudWxsOw0KICAg\nIH0NCg0KICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5IGdldEJyb2tlckZhY3Rv\ncnkoKSB7DQogICAgICAgIHJldHVybiBfZmFjdG9yeTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlv\nbigpIHsNCiAgICAgICAgcmV0dXJuIF9jb25mOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9u\nKCkgew0KICAgICAgICByZXR1cm4gX2ZjOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyBGZXRjaENvbmZpZ3VyYXRpb24gcHVzaEZldGNoQ29uZmlndXJhdGlvbigp\nIHsNCiAgICAgICAgaWYgKF9mY3MgPT0gbnVsbCkNCiAgICAgICAgICAgIF9m\nY3MgPSBuZXcgTGlua2VkTGlzdCgpOw0KICAgICAgICBfZmNzLmFkZChfZmMp\nOw0KICAgICAgICBfZmMgPSAoRmV0Y2hDb25maWd1cmF0aW9uKSBfZmMuY2xv\nbmUoKTsNCiAgICAgICAgcmV0dXJuIF9mYzsNCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCBwb3BGZXRjaENvbmZpZ3VyYXRpb24oKSB7DQogICAgICAgIGlm\nIChfZmNzID09IG51bGwgfHwgX2Zjcy5pc0VtcHR5KCkpDQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZmV0Y2gtY29u\nZmlndXJhdGlvbi1zdGFjay1lbXB0eSIpKTsNCiAgICAgICAgX2ZjID0gKEZl\ndGNoQ29uZmlndXJhdGlvbikgX2Zjcy5yZW1vdmVMYXN0KCk7DQogICAgfQ0K\nDQogICAgcHVibGljIGludCBnZXRDb25uZWN0aW9uUmV0YWluTW9kZSgpIHsN\nCiAgICAgICAgcmV0dXJuIF9jb25uUmV0YWluTW9kZTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWQoKSB7DQogICAgICAgIHJldHVy\nbiBfbWFuYWdlZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgTWFuYWdlZFJ1bnRp\nbWUgZ2V0TWFuYWdlZFJ1bnRpbWUoKSB7DQogICAgICAgIHJldHVybiBfcnVu\ndGltZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0Q2xh\nc3NMb2FkZXIoKSB7DQogICAgICAgIHJldHVybiBfbG9hZGVyOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIGdldFN0b3Jl\nTWFuYWdlcigpIHsNCiAgICAgICAgcmV0dXJuIF9zdG9yZTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgTG9ja01hbmFnZXIgZ2V0TG9ja01hbmFnZXIoKSB7DQog\nICAgICAgIHJldHVybiBfbG07DQogICAgfQ0KDQogICAgcHVibGljIEludmVy\nc2VNYW5hZ2VyIGdldEludmVyc2VNYW5hZ2VyKCkgew0KICAgICAgICByZXR1\ncm4gX2ltOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ubmVj\ndGlvblVzZXJOYW1lKCkgew0KICAgICAgICByZXR1cm4gX3VzZXI7DQogICAg\nfQ0KDQogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uUGFzc3dvcmQo\nKSB7DQogICAgICAgIHJldHVybiBfcGFzczsNCiAgICB9DQoNCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRNdWx0aXRocmVhZGVkKCkgew0KICAgICAgICByZXR1\ncm4gX211bHRpdGhyZWFkZWQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQg\nc2V0TXVsdGl0aHJlYWRlZChib29sZWFuIG11bHRpdGhyZWFkZWQpIHsNCiAg\nICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBfbXVsdGl0aHJlYWRlZCA9\nIG11bHRpdGhyZWFkZWQ7DQogICAgICAgIGlmIChtdWx0aXRocmVhZGVkICYm\nIF9sb2NrID09IG51bGwpDQogICAgICAgICAgICBfbG9jayA9IG5ldyBSZWVu\ndHJhbnRMb2NrKCk7DQogICAgICAgIGVsc2UgaWYgKCFtdWx0aXRocmVhZGVk\nKQ0KICAgICAgICAgICAgX2xvY2sgPSBudWxsOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBib29sZWFuIGdldElnbm9yZUNoYW5nZXMoKSB7DQogICAgICAgIHJl\ndHVybiBfaWdub3JlQ2hhbmdlczsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9p\nZCBzZXRJZ25vcmVDaGFuZ2VzKGJvb2xlYW4gdmFsKSB7DQogICAgICAgIGFz\nc2VydE9wZW4oKTsNCiAgICAgICAgX2lnbm9yZUNoYW5nZXMgPSB2YWw7DQog\nICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJhbnNhY3Rpb25h\nbFJlYWQoKSB7DQogICAgICAgIHJldHVybiBfbm9udHJhbnNSZWFkOw0KICAg\nIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldE5vbnRyYW5zYWN0aW9uYWxSZWFk\nKGJvb2xlYW4gdmFsKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApDQogICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaWxs\nZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsNCg0KICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQNCiAgICAgICAgaWYgKHZhbCAm\nJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zDQogICAgICAg\nICAgICAoX2NvbmYuT1BUSU9OX05PTlRSQU5TX1JFQUQpKQ0KICAgICAgICAg\nICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0DQog\nICAgICAgICAgICAgICAgKCJub250cmFucy1yZWFkLW5vdC1zdXBwb3J0ZWQi\nKSk7DQoNCiAgICAgICAgX25vbnRyYW5zUmVhZCA9IHZhbDsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFsV3JpdGUo\nKSB7DQogICAgICAgIHJldHVybiBfbm9udHJhbnNXcml0ZTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsV3JpdGUoYm9v\nbGVhbiB2YWwpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkNCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbGxlZ2Fs\nLW9wLWluLXByZXN0b3JlIikpOw0KDQogICAgICAgIF9ub250cmFuc1dyaXRl\nID0gdmFsOw0KICAgIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGdldE9wdGlt\naXN0aWMoKSB7DQogICAgICAgIHJldHVybiBfb3B0aW1pc3RpYzsNCiAgICB9\nDQoNCiAgICBwdWJsaWMgdm9pZCBzZXRPcHRpbWlzdGljKGJvb2xlYW4gdmFs\nKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkNCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2\nZSIsDQogICAgICAgICAgICAgICAgIk9wdGltaXN0aWMiKSk7DQoNCiAgICAg\nICAgLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0DQogICAg\nICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250\nYWlucyhfY29uZi5PUFRJT05fT1BUSU1JU1RJQykpDQogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQNCiAgICAg\nICAgICAgICAgICAoIm9wdGltaXN0aWMtbm90LXN1cHBvcnRlZCIpKTsNCg0K\nICAgICAgICBfb3B0aW1pc3RpYyA9IHZhbDsNCiAgICB9DQoNCiAgICBwdWJs\naWMgaW50IGdldFJlc3RvcmVTdGF0ZSgpIHsNCiAgICAgICAgcmV0dXJuIF9y\nZXN0b3JlU3RhdGU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0UmVz\ndG9yZVN0YXRlKGludCB2YWwpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0K\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQ0KICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgidHJhbnMtYWN0aXZlIiwNCiAgICAgICAgICAgICAgICAiUmVzdG9y\nZSIpKTsNCg0KICAgICAgICBfcmVzdG9yZVN0YXRlID0gdmFsOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyBib29sZWFuIGdldFJldGFpblN0YXRlKCkgew0KICAg\nICAgICByZXR1cm4gX3JldGFpblN0YXRlOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIHNldFJldGFpblN0YXRlKGJvb2xlYW4gdmFsKSB7DQogICAgICAg\nIGFzc2VydE9wZW4oKTsNCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BS\nRVNUT1JJTkcpICE9IDApDQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsN\nCiAgICAgICAgX3JldGFpblN0YXRlID0gdmFsOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBpbnQgZ2V0QXV0b0NsZWFyKCkgew0KICAgICAgICByZXR1cm4gX2F1\ndG9DbGVhcjsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQ2xl\nYXIoaW50IHZhbCkgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAg\nIF9hdXRvQ2xlYXIgPSB2YWw7DQogICAgfQ0KDQogICAgcHVibGljIGludCBn\nZXRBdXRvRGV0YWNoKCkgew0KICAgICAgICByZXR1cm4gX2F1dG9EZXRhY2g7\nDQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFjaChpbnQg\nZGV0YWNoRmxhZ3MpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAg\nICBfYXV0b0RldGFjaCA9IGRldGFjaEZsYWdzOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyB2b2lkIHNldEF1dG9EZXRhY2goaW50IGRldGFjaEZsYWcsIGJvb2xl\nYW4gb24pIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBpZiAo\nb24pDQogICAgICAgICAgICBfYXV0b0RldGFjaCB8PSBkZXRhY2hGbGFnOw0K\nICAgICAgICBlbHNlDQogICAgICAgICAgICBfYXV0b0RldGFjaCAmPSB+ZGV0\nYWNoRmxhZzsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldERldGFjaFN0\nYXRlKCkgew0KICAgICAgICByZXR1cm4gX2RldGFjaFN0YXRlOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyB2b2lkIHNldERldGFjaFN0YXRlKGludCBtb2RlKSB7\nDQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgX2RldGFjaFN0YXRl\nID0gbW9kZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFj\naGVkTmV3KCkgew0KICAgICAgICByZXR1cm4gX2RldGFjaGVkTmV3Ow0KICAg\nIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldERldGFjaGVkTmV3KGJvb2xlYW4g\naXNOZXcpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBfZGV0\nYWNoZWROZXcgPSBpc05ldzsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRTeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoKSB7DQogICAgICAg\nIHJldHVybiBfc3luY01hbmFnZWQ7DQogICAgfQ0KDQogICAgcHVibGljIHZv\naWQgc2V0U3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb25zKGJvb2xlYW4gc3lu\nYykgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIF9zeW5jTWFu\nYWdlZCA9IHN5bmM7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gZ2V0\nRXZpY3RGcm9tRGF0YUNhY2hlKCkgew0KICAgICAgICByZXR1cm4gX2V2aWN0\nRGF0YUNhY2hlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldEV2aWN0\nRnJvbURhdGFDYWNoZShib29sZWFuIGV2aWN0KSB7DQogICAgICAgIGFzc2Vy\ndE9wZW4oKTsNCiAgICAgICAgX2V2aWN0RGF0YUNhY2hlID0gZXZpY3Q7DQog\nICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gZ2V0UG9wdWxhdGVEYXRhQ2Fj\naGUoKSB7DQogICAgICAgIHJldHVybiBfcG9wdWxhdGVEYXRhQ2FjaGU7DQog\nICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0UG9wdWxhdGVEYXRhQ2FjaGUo\nYm9vbGVhbiBjYWNoZSkgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAg\nICAgIF9wb3B1bGF0ZURhdGFDYWNoZSA9IGNhY2hlOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyBib29sZWFuIGlzVHJhY2tDaGFuZ2VzQnlUeXBlKCkgew0KICAg\nICAgICByZXR1cm4gX2xhcmdlVHJhbnNhY3Rpb247DQogICAgfQ0KDQogICAg\ncHVibGljIHZvaWQgc2V0VHJhY2tDaGFuZ2VzQnlUeXBlKGJvb2xlYW4gbGFy\nZ2VUcmFuc2FjdGlvbikgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAg\nICAgIF9sYXJnZVRyYW5zYWN0aW9uID0gbGFyZ2VUcmFuc2FjdGlvbjsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGdldFVzZXJPYmplY3QoT2JqZWN0\nIGtleSkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAg\nICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9\nPSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7DQogICAg\nICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgcHV0VXNl\nck9iamVjdChPYmplY3Qga2V5LCBPYmplY3QgdmFsKSB7DQogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAg\nICAgIGlmICh2YWwgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICByZXR1cm4g\nKF91c2VyT2JqZWN0cyA9PSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMu\ncmVtb3ZlKGtleSk7DQoNCiAgICAgICAgICAgIGlmIChfdXNlck9iamVjdHMg\nPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfdXNlck9iamVjdHMgPSBuZXcg\nSGFzaE1hcCgpOw0KICAgICAgICAgICAgcmV0dXJuIF91c2VyT2JqZWN0cy5w\ndXQoa2V5LCB2YWwpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAv\nLy8vLy8vLy8vDQogICAgLy8gRXZlbnRzDQogICAgLy8vLy8vLy8vLw0KDQog\nICAgcHVibGljIHZvaWQgYWRkTGlmZWN5Y2xlTGlzdGVuZXIoT2JqZWN0IGxp\nc3RlbmVyLCBDbGFzc1tdIGNsYXNzZXMpIHsNCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgX2xp\nZmVFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGNsYXNzZXMp\nOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBy\nZW1vdmVMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsNCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgX2xpZmVFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIo\nbGlzdGVuZXIpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJs\naWMgaW50IGdldExpZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgew0K\nICAgICAgICByZXR1cm4gX2xpZmVDYWxsYmFja01vZGU7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgc2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxsYmFja01v\nZGUoaW50IG1vZGUpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2Up\nOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgX2xpZmVDYWxsYmFja01v\nZGUgPSBtb2RlOw0KICAgICAgICAgICAgX2xpZmVFdmVudE1hbmFnZXIuc2V0\nRmFpbEZhc3QoKG1vZGUgJiBDQUxMQkFDS19GQUlMX0ZBU1QpICE9IDApOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHaXZl\nIHN0YXRlIG1hbmFnZXJzIGFjY2VzcyB0byB0aGUgbGlmZWN5Y2xlIGV2ZW50\nIG1hbmFnZXIuDQogICAgICovDQogICAgcHVibGljIExpZmVjeWNsZUV2ZW50\nTWFuYWdlciBnZXRMaWZlY3ljbGVFdmVudE1hbmFnZXIoKSB7DQogICAgICAg\nIHJldHVybiBfbGlmZUV2ZW50TWFuYWdlcjsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBGaXJlIGdpdmVuIGxpZmVjeWNsZSBldmVudCwgaGFuZGxpbmcg\nYW55IGV4Y2VwdGlvbnMgYXBwcm9wcmlhdGVseS4NCiAgICAgKg0KICAgICAq\nIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJlaW5nIHByb2Nlc3NlZCBh\ndCB0aGlzIHRpbWUNCiAgICAgKi8NCiAgICBib29sZWFuIGZpcmVMaWZlY3lj\nbGVFdmVudChPYmplY3Qgc3JjLCBPYmplY3QgcmVsYXRlZCwgQ2xhc3NNZXRh\nRGF0YSBtZXRhLA0KICAgICAgICBpbnQgZXZlbnRUeXBlKSB7DQogICAgICAg\nIGlmIChfbGlmZUV2ZW50TWFuYWdlciA9PSBudWxsKQ0KICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOw0KICAgICAgICBoYW5kbGVDYWxsYmFja0V4Y2VwdGlv\nbnMoX2xpZmVFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHNyYywgcmVsYXRlZCwg\nDQogICAgICAgICAgICBtZXRhLCBldmVudFR5cGUpLCBfbGlmZUNhbGxiYWNr\nTW9kZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIFRha2UgYWN0aW9ucyBvbiBjYWxsYmFjayBleGNlcHRpb25z\nIGRlcGVuZGluZyBvbiBjYWxsYmFjayBtb2RlLg0KICAgICAqLw0KICAgIHBy\naXZhdGUgdm9pZCBoYW5kbGVDYWxsYmFja0V4Y2VwdGlvbnMoRXhjZXB0aW9u\nW10gZXhjZXBzLCBpbnQgbW9kZSkgew0KICAgICAgICBpZiAoZXhjZXBzLmxl\nbmd0aCA9PSAwIHx8IChtb2RlICYgQ0FMTEJBQ0tfSUdOT1JFKSAhPSAwKQ0K\nICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIE9wZW5KUEFFeGNlcHRp\nb24gY2U7DQogICAgICAgIGlmIChleGNlcHMubGVuZ3RoID09IDEpDQogICAg\nICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihleGNlcHNbMF0p\nOw0KICAgICAgICBlbHNlIA0KICAgICAgICAgICAgY2UgPSBuZXcgQ2FsbGJh\nY2tFeGNlcHRpb24oX2xvYy5nZXQoImNhbGxiYWNrLWVyciIpKS4NCiAgICAg\nICAgICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKGV4Y2Vwcyk7DQogICAg\nICAgIGlmICgobW9kZSAmIENBTExCQUNLX1JPTExCQUNLKSAhPSAwICYmIChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkgew0KICAgICAgICAgICAgY2Uu\nc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJ\nbnRlcm5hbChjZSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChtb2RlICYg\nQ0FMTEJBQ0tfTE9HKSAhPSAwICYmIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQ0K\nICAgICAgICAgICAgX2xvZy53YXJuKGNlKTsNCiAgICAgICAgaWYgKChtb2Rl\nICYgQ0FMTEJBQ0tfUkVUSFJPVykgIT0gMCkNCiAgICAgICAgICAgIHRocm93\nIGNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGFkZFRyYW5zYWN0aW9u\nTGlzdGVuZXIoT2JqZWN0IHRsKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIF90cmFuc0V2\nZW50TWFuYWdlci5hZGRMaXN0ZW5lcih0bCk7DQogICAgICAgICAgICBpZiAo\ndGwgaW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1hbmFnZXIpDQogICAg\nICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVNT1RFX0xJU1RFTkVSOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVjdCB0bCkgew0KICAgICAgICBi\nZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAgICAg\nICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKHRs\nKQ0KICAgICAgICAgICAgICAgICYmICh0bCBpbnN0YW5jZW9mIFJlbW90ZUNv\nbW1pdEV2ZW50TWFuYWdlcikpDQogICAgICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX1JFTU9URV9MSVNURU5FUjsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIGludCBnZXRUcmFuc2FjdGlvbkxpc3RlbmVyQ2Fs\nbGJhY2tNb2RlKCkgew0KICAgICAgICByZXR1cm4gX3RyYW5zQ2FsbGJhY2tN\nb2RlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFRyYW5zYWN0aW9u\nTGlzdGVuZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsNCiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgX3RyYW5zQ2FsbGJhY2tNb2RlID0gbW9kZTsNCiAgICAgICAgICAgIF90\ncmFuc0V2ZW50TWFuYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENBTExCQUNL\nX0ZBSUxfRkFTVCkgIT0gMCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIEZpcmUgZ2l2ZW4gdHJhbnNhY3Rpb24gZXZlbnQs\nIGhhbmRsaW5nIGFueSBleGNlcHRpb25zIGFwcHJvcHJpYXRlbHkuDQogICAg\nICovDQogICAgcHJpdmF0ZSB2b2lkIGZpcmVUcmFuc2FjdGlvbkV2ZW50KFRy\nYW5zYWN0aW9uRXZlbnQgdHJhbnMpIHsNCiAgICAgICAgaWYgKF90cmFuc0V2\nZW50TWFuYWdlciAhPSBudWxsKQ0KICAgICAgICAgICAgaGFuZGxlQ2FsbGJh\nY2tFeGNlcHRpb25zKF90cmFuc0V2ZW50TWFuYWdlci5maXJlRXZlbnQodHJh\nbnMpLA0KICAgICAgICAgICAgICAgIF90cmFuc0NhbGxiYWNrTW9kZSk7DQog\nICAgfQ0KDQogICAgLy8vLy8vLy8vLy8NCiAgICAvLyBMb29rdXBzDQogICAg\nLy8vLy8vLy8vLy8NCg0KICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qg\nb2lkLCBib29sZWFuIHZhbGlkYXRlLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsN\nCiAgICAgICAgaW50IGZsYWdzID0gT0lEX0NPUFkgfCBPSURfQUxMT1dfTkVX\nIHwgT0lEX05PREVMRVRFRDsNCiAgICAgICAgaWYgKCF2YWxpZGF0ZSkNCiAg\nICAgICAgICAgIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOw0KICAgICAgICBy\nZXR1cm4gZmluZChvaWQsIF9mYywgbnVsbCwgbnVsbCwgZmxhZ3MsIGNhbGwp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qgb2lk\nLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBleGNsdWRlLA0K\nICAgICAgICBPYmplY3QgZWRhdGEsIGludCBmbGFncykgew0KICAgICAgICBy\nZXR1cm4gZmluZChvaWQsIGZldGNoLCBleGNsdWRlLCBlZGF0YSwgZmxhZ3Ms\nIG51bGwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEludGVybmFsIGZp\nbmRlci4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGZpbmQoT2Jq\nZWN0IG9pZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBCaXRTZXQgZXhj\nbHVkZSwNCiAgICAgICAgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MsIEZpbmRD\nYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQ0K\nICAgICAgICAgICAgY2FsbCA9IHRoaXM7DQogICAgICAgIG9pZCA9IGNhbGwu\ncHJvY2Vzc0FyZ3VtZW50KG9pZCk7DQogICAgICAgIGlmIChvaWQgPT0gbnVs\nbCkgew0KICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSA9PSAwKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RG\nb3VuZEV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1vaWQiKSk7DQogICAgICAg\nICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7DQog\nICAgICAgIH0NCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpDQogICAgICAg\nICAgICBmZXRjaCA9IF9mYzsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydE5vbnRy\nYW5zYWN0aW9uYWxSZWFkKCk7DQoNCiAgICAgICAgICAgIC8vIGNhY2hlZCBp\nbnN0YW5jZT8NCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsDQogICAgICAgICAgICAgICAg\nKGZsYWdzICYgT0lEX0FMTE9XX05FVykgIT0gMCB8fCBoYXNGbHVzaGVkKCkp\nOw0KICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsNCiAgICAgICAgICAg\nICAgICBpZiAoIXJlcXVpcmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRh\nLCBmbGFncykpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnBy\nb2Nlc3NSZXR1cm4ob2lkLCBzbSk7DQoNCiAgICAgICAgICAgICAgICBpZiAo\nIXNtLmlzTG9hZGluZygpKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSBhbGwgdGhlIGNvbmZpZ3VyZWQgZmllbGRzIGFyZSBsb2FkZWQ7\nIGRvIHRoaXMNCiAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgbWFraW5n\nIGluc3RhbmNlIHRyYW5zYWN0aW9uYWwgZm9yIGxvY2tpbmcNCiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB1c2VU\ncmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQ0KICAgICAgICAgICAgICAgICAg\nICAgICAgc20udHJhbnNhY3Rpb25hbCgpOw0KICAgICAgICAgICAgICAgICAg\nICBib29sZWFuIGxvYWRlZDsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsN\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZCA9IHNtLmxvYWQoZmV0\nY2gsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIA0KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGV4Y2x1ZGUsIGVkYXRhLCBmYWxzZSk7DQogICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0\naW9uIG9uZmUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZmxh\nZ3MgJiBPSURfTk9ERUxFVEVEKSAhPSAwDQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDApDQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsNCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4o\nb2lkLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAg\nICAgICAgICAgICAgIC8vIGlmIG5vIGRhdGEgbmVlZGVkIHRvIGJlIGxvYWRl\nZCBhbmQgdGhlIHVzZXIgd2FudHMgdG8NCiAgICAgICAgICAgICAgICAgICAg\nLy8gdmFsaWRhdGUsIGp1c3QgbWFrZSBzdXJlIHRoZSBvYmplY3QgZXhpc3Rz\nDQogICAgICAgICAgICAgICAgICAgIGlmICghbG9hZGVkICYmIChmbGFncyAm\nIE9JRF9OT1ZBTElEQVRFKSA9PSAwDQogICAgICAgICAgICAgICAgICAgICAg\nICAmJiBfY29tcGF0LmdldFZhbGlkYXRlVHJ1ZUNoZWNrc1N0b3JlKCkNCiAg\nICAgICAgICAgICAgICAgICAgICAgICYmICFzbS5pc1RyYW5zYWN0aW9uYWwo\nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgIV9zdG9yZS5leGlzdHMo\nc20sIGVkYXRhKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChm\nbGFncyAmIE9JRF9OT0RFTEVURUQpID09IDApDQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51\nbGwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVj\ndE5vdEZvdW5kRXhjZXB0aW9uKF9sb2MuZ2V0DQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKCJkZWwtaW5zdGFuY2UiLCBzbS5nZXRNYW5hZ2VkSW5z\ndGFuY2UoKSwgb2lkKSkuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsNCiAg\nICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAg\nICAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBvYmplY3Qgd2FzIGNhY2hlZCwg\nd2UgbWF5IG5lZWQgdG8gdXBncmFkZSBsb2NrDQogICAgICAgICAgICAgICAg\nLy8gaWYgY3VycmVudCBsZXZlbCBpcyBoaWdoZXIgdGhhbiBsZXZlbCBvZiBp\nbml0aWFsIGxvYWQNCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGludCBs\nZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKTsNCiAgICAgICAgICAg\nICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCBmZXRjaC5nZXRMb2NrVGlt\nZW91dCgpLCBlZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIHNtLnJlYWRM\nb2NrZWQobGV2ZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOw0KICAg\nICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5w\ncm9jZXNzUmV0dXJuKG9pZCwgc20pOw0KICAgICAgICAgICAgfQ0KDQogICAg\nICAgICAgICAvLyBpZiB0aGVyZSdzIG5vIGNhY2hlZCBzbSBmb3IgYSBuZXcv\ndHJhbnNpZW50IGlkIHR5cGUsIHdlDQogICAgICAgICAgICAvLyBpdCBkZWZp\nbml0ZWx5IGRvZXNuJ3QgZXhpc3QNCiAgICAgICAgICAgIGlmIChvaWQgaW5z\ndGFuY2VvZiBTdGF0ZU1hbmFnZXJJZCkNCiAgICAgICAgICAgICAgICByZXR1\ncm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7DQoNCiAgICAgICAg\nICAgIC8vIGluaXRpYWxpemUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3IgdGhl\nIGRhdGFzdG9yZSBpbnN0YW5jZQ0KICAgICAgICAgICAgc20gPSBuZXdTdGF0\nZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lEX0NPUFkpICE9IDApOw0K\nICAgICAgICAgICAgYm9vbGVhbiBsb2FkID0gcmVxdWlyZXNMb2FkKHNtLCBm\nYWxzZSwgZmV0Y2gsIGVkYXRhLCBmbGFncyk7DQogICAgICAgICAgICBzbSA9\nIGluaXRpYWxpemUoc20sIGxvYWQsIGZldGNoLCBlZGF0YSk7DQogICAgICAg\nICAgICBpZiAoc20gPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGlmICgo\nZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkNCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKG9pZCk7\nDQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihv\naWQsIG51bGwpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBt\nYWtlIHN1cmUgYWxsIGNvbmZpZ3VyZWQgZmllbGRzIHdlcmUgbG9hZGVkDQog\nICAgICAgICAgICBpZiAobG9hZCkgew0KICAgICAgICAgICAgICAgIHRyeSB7\nDQogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoZmV0Y2gsIFN0YXRlTWFu\nYWdlckltcGwuTE9BRF9GR1MsIGV4Y2x1ZGUsDQogICAgICAgICAgICAgICAg\nICAgICAgICBlZGF0YSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUpIHsNCiAgICAgICAg\nICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT0RFTEVURUQpICE9IDAN\nCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZB\nTElEQVRFKSAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nb25mZTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vz\nc1JldHVybihvaWQsIG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1\ncm4ob2lkLCBzbSk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7DQogICAgICAgIH0gZmluYWxs\neSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBuZXdseS1j\nb25zdHJ1Y3RlZCBzdGF0ZSBtYW5hZ2VyLg0KICAgICAqLw0KICAgIHByb3Rl\nY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGluaXRpYWxpemUoU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSwgYm9vbGVhbiBsb2FkLA0KICAgICAgICBGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgew0KICAgICAgICBpZiAoIWxv\nYWQpIHsNCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURh\ndGEoKS5nZXREZXNjcmliZWRUeXBlKCksDQogICAgICAgICAgICAgICAgUENT\ndGF0ZS5IT0xMT1cpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAg\nUENTdGF0ZSBzdGF0ZSA9ICh1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gp\nKQ0KICAgICAgICAgICAgICAgID8gUENTdGF0ZS5QQ0xFQU4gOiBQQ1N0YXRl\nLlBOT05UUkFOUzsNCiAgICAgICAgICAgIHNtLnNldExvYWRpbmcodHJ1ZSk7\nDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmICghX3N0\nb3JlLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQ0KICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0g\nZmluYWxseSB7DQogICAgICAgICAgICAgICAgc20uc2V0TG9hZGluZyhmYWxz\nZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJu\nIHNtOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENv\nbGxlY3Rpb24gb2lkcywgYm9vbGVhbiB2YWxpZGF0ZSwNCiAgICAgICAgRmlu\nZENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGludCBmbGFncyA9IE9JRF9D\nT1BZIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RFTEVURUQ7DQogICAgICAg\nIGlmICghdmFsaWRhdGUpDQogICAgICAgICAgICBmbGFncyB8PSBPSURfTk9W\nQUxJREFURTsNCiAgICAgICAgcmV0dXJuIGZpbmRBbGwob2lkcywgX2ZjLCBu\ndWxsLCBudWxsLCBmbGFncywgY2FsbCk7DQogICAgfQ0KDQogICAgcHVibGlj\nIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsDQogICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmpl\nY3QgZWRhdGEsIGludCBmbGFncykgew0KICAgICAgICByZXR1cm4gZmluZEFs\nbChvaWRzLCBmZXRjaCwgZXhjbHVkZSwgZWRhdGEsIGZsYWdzLCBudWxsKTsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbnRlcm5hbCBmaW5kZXIuDQog\nICAgICovDQogICAgcHJvdGVjdGVkIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVj\ndGlvbiBvaWRzLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsDQogICAgICAg\nIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFncywgRmlu\nZENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGZpbmRBbGxEZXB0aCArKzsN\nCg0KICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyBmb3IgbnVsbCBv\naWRzIHVwIGltbWVkaWF0ZWx5DQogICAgICAgIGlmIChvaWRzID09IG51bGwp\nDQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24o\nIm9pZHMgPT0gbnVsbCIpOw0KICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05P\nVkFMSURBVEUpICE9IDAgJiYgb2lkcy5jb250YWlucyhudWxsKSkNCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxs\nLW9pZHMiKSk7DQoNCiAgICAgICAgLy8gd2UgaGF2ZSB0byB1c2UgYSBtYXAg\nb2Ygb2lkLT5zbSByYXRoZXIgdGhhbiBhIHNpbXBsZQ0KICAgICAgICAvLyBh\ncnJheSwgc28gdGhhdCB3ZSBtYWtlIHN1cmUgbm90IHRvIGNyZWF0ZSBtdWx0\naXBsZSBzbXMgZm9yIGVxdWl2YWxlbnQNCiAgICAgICAgLy8gb2lkcyBpZiB0\naGUgdXNlciBoYXMgZHVwbGljYXRlcyBpbiB0aGUgZ2l2ZW4gYXJyYXkNCiAg\nICAgICAgaWYgKF9sb2FkaW5nID09IG51bGwpDQogICAgICAgICAgICBfbG9h\nZGluZyA9IG5ldyBIYXNoTWFwKChpbnQpIChvaWRzLnNpemUoKSAqIDEuMzMg\nKyAxKSk7DQoNCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkNCiAgICAgICAg\nICAgIGNhbGwgPSB0aGlzOw0KICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkN\nCiAgICAgICAgICAgIGZldGNoID0gX2ZjOw0KDQogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNz\nZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsNCg0KICAgICAgICAgICAgLy8g\nY29sbGVjdGlvbiBvZiBzdGF0ZSBtYW5hZ2VycyB0byBwYXNzIHRvIHN0b3Jl\nIG1hbmFnZXINCiAgICAgICAgICAgIExpc3QgbG9hZCA9IG51bGw7DQogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAgICAgICAgICAgYm9v\nbGVhbiBpbml0aWFsaXplZDsNCiAgICAgICAgICAgIGJvb2xlYW4gdHJhbnNT\ndGF0ZSA9IHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCk7DQogICAgICAg\nICAgICBPYmplY3Qgb2JqLCBvaWQ7DQogICAgICAgICAgICBpbnQgaWR4ID0g\nMDsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2lkcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykgew0KICAgICAgICAgICAg\nICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgc2VlbiB0aGlzIG9pZCwgc2tpcCBy\nZXBlYXRzDQogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsNCiAg\nICAgICAgICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1bWVudChvYmop\nOw0KICAgICAgICAgICAgICAgIGlmIChvaWQgPT0gbnVsbCB8fCBfbG9hZGlu\nZy5jb250YWluc0tleShvYmopKQ0KICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsNCg0KICAgICAgICAgICAgICAgIC8vIGlmIHdlIGRvbid0IGhhdmUg\nYSBjYWNoZWQgaW5zdGFuY2Ugb3IgaXQgaXMgbm90IHRyYW5zYWN0aW9uYWwN\nCiAgICAgICAgICAgICAgICAvLyBhbmQgaXMgaG9sbG93IG9yIHdlIG5lZWQg\ndG8gdmFsaWRhdGUsIGxvYWQgaXQNCiAgICAgICAgICAgICAgICBzbSA9IGdl\ndFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwgKGZsYWdzICYgT0lEX0FMTE9X\nX05FVykgIT0gMA0KICAgICAgICAgICAgICAgICAgICB8fCBoYXNGbHVzaGVk\nKCkpOw0KICAgICAgICAgICAgICAgIGluaXRpYWxpemVkID0gc20gIT0gbnVs\nbDsNCiAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxpemVkKQ0KICAgICAg\nICAgICAgICAgICAgICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCAo\nZmxhZ3MgJiBPSURfQ09QWSkgIT0gMCk7DQoNCiAgICAgICAgICAgICAgICBf\nbG9hZGluZy5wdXQob2JqLCBzbSk7DQogICAgICAgICAgICAgICAgaWYgKHJl\ncXVpcmVzTG9hZChzbSwgaW5pdGlhbGl6ZWQsIGZldGNoLCBlZGF0YSwgZmxh\nZ3MpKSB7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zU3RhdGUgPSB0cmFu\nc1N0YXRlIHx8IHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCk7DQogICAg\nICAgICAgICAgICAgICAgIGlmIChpbml0aWFsaXplZCAmJiAhc20uaXNUcmFu\nc2FjdGlvbmFsKCkgJiYgdHJhbnNTdGF0ZSkNCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsNCiAgICAgICAgICAgICAgICAg\nICAgaWYgKGxvYWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAg\nIGxvYWQgPSBuZXcgQXJyYXlMaXN0KG9pZHMuc2l6ZSgpIC0gaWR4KTsNCiAg\nICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20pOw0KICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAoIWluaXRpYWxpemVkKQ0KICAgICAgICAgICAgICAg\nICAgICBzbS5pbml0aWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgUENTdGF0ZS5I\nT0xMT1cpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBwYXNz\nIGFsbCBzdGF0ZSBtYW5hZ2VycyBpbiBuZWVkIG9mIGxvYWRpbmcgb3IgdmFs\naWRhdGlvbiB0byB0aGUNCiAgICAgICAgICAgIC8vIHN0b3JlIG1hbmFnZXIN\nCiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsNCiAgICAgICAgICAg\nICAgICBQQ1N0YXRlIHN0YXRlID0gKHRyYW5zU3RhdGUpID8gUENTdGF0ZS5Q\nQ0xFQU4NCiAgICAgICAgICAgICAgICAgICAgOiBQQ1N0YXRlLlBOT05UUkFO\nUzsNCiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IF9zdG9y\nZS5sb2FkQWxsKGxvYWQsIHN0YXRlLA0KICAgICAgICAgICAgICAgICAgICBT\ndG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FLCBmZXRjaCwgZWRhdGEpOw0K\nDQogICAgICAgICAgICAgICAgLy8gc2V0IGZhaWxlZCBpbnN0YW5jZXMgdG8g\nbnVsbA0KICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAh\nZmFpbGVkLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAo\nKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDApDQogICAgICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihm\nYWlsZWQpOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IGZhaWxlZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykNCiAgICAg\nICAgICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1dChpdHIubmV4dCgpLCBu\ndWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSByZXN1bHRzIGFycmF5OyBtYWtlIHN1cmUg\nYWxsIGNvbmZpZ3VyZWQgZmllbGRzIGFyZQ0KICAgICAgICAgICAgLy8gbG9h\nZGVkIGluIGVhY2ggaW5zdGFuY2UNCiAgICAgICAgICAgIE9iamVjdFtdIHJl\nc3VsdHMgPSBuZXcgT2JqZWN0W29pZHMuc2l6ZSgpXTsNCiAgICAgICAgICAg\nIGJvb2xlYW4gYWN0aXZlID0gKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAw\nOw0KICAgICAgICAgICAgaW50IGxldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tM\nZXZlbCgpOw0KICAgICAgICAgICAgaWR4ID0gMDsNCiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOyBpZHgrKykgew0KICAgICAgICAgICAgICAgIG9pZCA9IGl0ci5uZXh0\nKCk7DQogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkg\nX2xvYWRpbmcuZ2V0KG9pZCk7DQogICAgICAgICAgICAgICAgaWYgKHNtICE9\nIG51bGwgJiYgcmVxdWlyZXNMb2FkKHNtLCB0cnVlLCBmZXRjaCwgZWRhdGEs\nIGZsYWdzKSkgew0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2Vy\nSW1wbC5MT0FEX0ZHUywNCiAgICAgICAgICAgICAgICAgICAgICAgIAlleGNs\ndWRlLCBlZGF0YSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGFjdGl2ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9s\nbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRh\ndGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnJlYWRMb2Nr\nZWQobGV2ZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOw0KICAgICAg\nICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQog\nICAgICAgICAgICAgICAgICAgIGNhdGNoIChPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbiBvbmZlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGZs\nYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMA0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQ0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG9uZmU7DQogICAg\nICAgICAgICAgICAgICAgICAgICBzbSA9IG51bGw7DQogICAgICAgICAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAg\ncmVzdWx0c1tpZHhdID0gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOw0K\nICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7DQog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAg\nICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAg\nICBmaW5kQWxsRGVwdGgtLTsNCiAgICAgICAgICAgIGlmIChmaW5kQWxsRGVw\ndGggPT0gMCkNCiAgICAgICAgICAgICAgICBfbG9hZGluZyA9IG51bGw7DQog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNGbHVzaGVkKCkgew0KICAgICAg\nICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMDsNCiAgICB9\nDQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4g\naW5zdGFuY2UgbmVlZHMgbG9hZGluZyBiZWZvcmUgYmVpbmcgcmV0dXJuZWQN\nCiAgICAgKiB0byB0aGUgdXNlci4NCiAgICAgKi8NCiAgICBwcml2YXRlIGJv\nb2xlYW4gcmVxdWlyZXNMb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGJv\nb2xlYW4gaW5pdGlhbGl6ZWQsDQogICAgICAgIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MpIHsNCiAgICAgICAg\naWYgKCFmZXRjaC5yZXF1aXJlc0xvYWQoKSkNCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsNCiAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIGlm\nIChlZGF0YSAhPSBudWxsKSAvLyB0YWtlIGFkdmFudGFnZSBvZiBleGlzdGlu\nZyByZXN1bHQNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICBp\nZiAoaW5pdGlhbGl6ZWQgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUu\nSE9MTE9XKQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICBp\nZiAoIWluaXRpYWxpemVkICYmIHNtLmdldE1ldGFEYXRhKCkuZ2V0UENTdWJj\nbGFzc2VzKCkubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOw0KICAgICAgICByZXR1cm4gIV9jb21wYXQuZ2V0VmFsaWRhdGVGYWxzZVJl\ndHVybnNIb2xsb3coKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1\ncm4gd2hldGhlciB0byB1c2UgYSB0cmFuc2FjdGlvbmFsIHN0YXRlLg0KICAg\nICAqLw0KICAgIHByaXZhdGUgYm9vbGVhbiB1c2VUcmFuc2FjdGlvbmFsU3Rh\ndGUoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7DQogICAgICAgIHJldHVy\nbiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDAgJiYgKCFfb3B0aW1pc3Rp\nYw0KICAgICAgICAgICAgfHwgX2F1dG9DbGVhciA9PSBDTEVBUl9BTEwNCiAg\nICAgICAgICAgIHx8IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSAhPSBMT0NL\nX05PTkUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgZmluZENhY2hl\nZChPYmplY3Qgb2lkLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAg\naWYgKGNhbGwgPT0gbnVsbCkNCiAgICAgICAgICAgIGNhbGwgPSB0aGlzOw0K\nICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1bWVudChvaWQpOw0KICAg\nICAgICBpZiAob2lkID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gY2Fs\nbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7DQoNCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQo\nb2lkLCB0cnVlKTsNCiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NS\nZXR1cm4ob2lkLCBzbSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAg\nIHB1YmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5cGUoQ2xhc3MgY2xzKSB7DQog\nICAgICAgIGlmIChjbHMgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9j\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuDQogICAgICAg\nICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9hZGVyLCBmYWxzZSk7DQog\nICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsDQogICAgICAgICAgICAgICAg\nfHwgbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklE\nX1VOS05PV04pDQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAg\nICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLklEX0FQUExJQ0FUSU9OKQ0KICAgICAgICAgICAgICAgIHJldHVy\nbiBtZXRhLmdldE9iamVjdElkVHlwZSgpOw0KDQogICAgICAgICAgICByZXR1\ncm4gX3N0b3JlLmdldERhdGFTdG9yZUlkVHlwZShtZXRhKTsNCiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAg\ndGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIE9i\namVjdCBuZXdPYmplY3RJZChDbGFzcyBjbHMsIE9iamVjdCB2YWwpIHsNCiAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG51\nbGw7DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2Nv\nbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4NCiAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIHRydWUpOw0KICAg\nICAgICAgICAgc3dpdGNoIChtZXRhLmdldElkZW50aXR5VHlwZSgpKSB7DQog\nICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFOg0K\nICAgICAgICAgICAgICAgIC8vIGRlbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIg\nZm9yIGRhdGFzdG9yZSBpZHMNCiAgICAgICAgICAgICAgICBpZiAodmFsIGlu\nc3RhbmNlb2YgU3RyaW5nDQogICAgICAgICAgICAgICAgICAgICYmICgoU3Ry\naW5nKSB2YWwpLnN0YXJ0c1dpdGgoU3RhdGVNYW5hZ2VySWQuU1RSSU5HX1BS\nRUZJWCkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdGVN\nYW5hZ2VySWQoKFN0cmluZykgdmFsKTsNCiAgICAgICAgICAgICAgICByZXR1\ncm4gX3N0b3JlLm5ld0RhdGFTdG9yZUlkKHZhbCwgbWV0YSk7DQogICAgICAg\nICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT046DQogICAg\nICAgICAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNBc3NpZ25hYmxlKG1ldGEu\nZ2V0T2JqZWN0SWRUeXBlKCksIA0KICAgICAgICAgICAgICAgICAgICB2YWwu\nZ2V0Q2xhc3MoKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkgDQogICAgICAgICAgICAgICAgICAgICAg\nICAmJiBtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpDQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElkKGNscywgdmFsKTsN\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsNCiAgICAgICAgICAg\nICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBzdHJpbmdpZmllZCBhcHAg\naWQ/DQogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmlu\nZyANCiAgICAgICAgICAgICAgICAgICAgJiYgIV9jb25mLmdldENvbXBhdGli\naWxpdHlJbnN0YW5jZSgpLg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0\nU3RyaWN0SWRlbnRpdHlWYWx1ZXMoKQ0KICAgICAgICAgICAgICAgICAgICAm\nJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQ0K\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdPYmpl\nY3RJZChjbHMsIChTdHJpbmcpIHZhbCk7DQoNCiAgICAgICAgICAgICAgICBP\nYmplY3RbXSBhcnIgPSAodmFsIGluc3RhbmNlb2YgT2JqZWN0W10pID8gKE9i\namVjdFtdKSB2YWwNCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgT2JqZWN0\nW117IHZhbCB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlv\nbklkcy5mcm9tUEtWYWx1ZXMoYXJyLCBtZXRhKTsNCiAgICAgICAgICAgIGRl\nZmF1bHQ6DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgY2xzKSk7DQogICAgICAg\nICAgICB9DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChD\nbGFzc0Nhc3RFeGNlcHRpb24gY2NlKSB7DQogICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWlkLXZhbHVlIiwgdmFs\nLA0KICAgICAgICAgICAgICAgIHZhbC5nZXRDbGFzcygpLmdldE5hbWUoKSwg\nY2xzKSkuc2V0Q2F1c2UoY2NlKTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBDcmVhdGUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3Ig\ndGhlIGdpdmVuIG9pZC4NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0YXRlTWFu\nYWdlckltcGwgbmV3U3RhdGVNYW5hZ2VySW1wbChPYmplY3Qgb2lkLCBib29s\nZWFuIGNvcHkpIHsNCiAgICAgICAgLy8gc2VlIGlmIHdlJ3JlIGluIHRoZSBw\ncm9jZXNzIG9mIGxvYWRpbmcgdGhpcyBvaWQgaW4gYSBsb2FkQWxsIGNhbGwN\nCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsNCiAgICAgICAgaWYgKF9s\nb2FkaW5nICE9IG51bGwpIHsNCiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFu\nYWdlckltcGwpIF9sb2FkaW5nLmdldChvaWQpOw0KICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwgJiYgc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkgPT0g\nbnVsbCkNCiAgICAgICAgICAgICAgICByZXR1cm4gc207DQogICAgICAgIH0N\nCg0KICAgICAgICAvLyBmaW5kIG1ldGFkYXRhIGZvciB0aGUgb2lkDQogICAg\nICAgIENsYXNzIHBjVHlwZSA9IF9zdG9yZS5nZXRNYW5hZ2VkVHlwZShvaWQp\nOw0KICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29uZi5n\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOw0KICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGE7DQogICAgICAgIGlmIChwY1R5cGUgIT0gbnVsbCkN\nCiAgICAgICAgICAgIG1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShwY1R5cGUs\nIF9sb2FkZXIsIHRydWUpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBt\nZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEob2lkLCBfbG9hZGVyLCB0cnVlKTsN\nCg0KICAgICAgICAvLyBjb3B5IHRoZSBvaWQgaWYgbmVlZGVkDQogICAgICAg\nIGlmIChjb3B5ICYmIF9jb21wYXQuZ2V0Q29weU9iamVjdElkcygpKSB7DQog\nICAgICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFz\nc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQ0KICAgICAgICAgICAgICAgIG9p\nZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHkob2lkLCBtZXRhKTsNCiAgICAgICAg\nICAgIGVsc2UgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nZXRhRGF0YS5JRF9VTktOT1dOKQ0KICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25pZCIsIG1l\ndGEpKTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBvaWQg\nPSBfc3RvcmUuY29weURhdGFTdG9yZUlkKG9pZCwgbWV0YSk7DQogICAgICAg\nIH0NCg0KICAgICAgICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCBt\nZXRhKTsNCiAgICAgICAgc20uc2V0T2JqZWN0SWQob2lkKTsNCiAgICAgICAg\ncmV0dXJuIHNtOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZSBh\nIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBvaWQgYW5kIG1ldGFkYXRh\nLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIG5l\nd1N0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9pZCwNCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7DQogICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5h\nZ2VySW1wbChvaWQsIG1ldGEsIHRoaXMpOw0KICAgIH0NCg0KICAgIC8vLy8v\nLy8vLy8vLy8vLw0KICAgIC8vIFRyYW5zYWN0aW9uDQogICAgLy8vLy8vLy8v\nLy8vLy8vDQoNCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsNCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQ0KICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQoImFjdGl2ZSIpKTsNCiAgICAgICAgICAgIF9mYWN0b3J5LnN5bmNX\naXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIHRydWUpOw0KICAgICAgICAg\nICAgYmVnaW5JbnRlcm5hbCgpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBOb3RpZnkgdGhlIHN0b3JlIG1hbmFnZXIgb2Yg\nYSB0cmFuc2FjdGlvbi4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQgYmVn\naW5JbnRlcm5hbCgpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGJl\nZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oX29wdGltaXN0aWMpOw0KICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfQUNUSVZFOw0KDQogICAgICAgICAg\nICAvLyBzdGFydCBsb2NraW5nDQogICAgICAgICAgICBpZiAoIV9vcHRpbWlz\ndGljKSB7DQogICAgICAgICAgICAgICAgX2ZjLnNldFJlYWRMb2NrTGV2ZWwo\nX2NvbmYuZ2V0UmVhZExvY2tMZXZlbENvbnN0YW50KCkpOw0KICAgICAgICAg\nICAgICAgIF9mYy5zZXRXcml0ZUxvY2tMZXZlbChfY29uZi5nZXRXcml0ZUxv\nY2tMZXZlbENvbnN0YW50KCkpOw0KICAgICAgICAgICAgICAgIF9mYy5zZXRM\nb2NrVGltZW91dChfY29uZi5nZXRMb2NrVGltZW91dCgpKTsNCiAgICAgICAg\nICAgIH0NCiAgICAgICAgICAgIF9sbS5iZWdpblRyYW5zYWN0aW9uKCk7DQoN\nCiAgICAgICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIuaGFzQmVnaW5M\naXN0ZW5lcnMoKSkNCiAgICAgICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25F\ndmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLA0KICAgICAgICAgICAg\nICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0JFR0lOLCBudWxsLCBu\ndWxsLCBudWxsLCBudWxsKSk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIC8vIGlmIHdlIGFscmVhZHkg\nc3RhcnRlZCB0aGUgdHJhbnNhY3Rpb24sIGRvbid0IGxldCBpdCBjb21taXQN\nCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDAp\nDQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoa2Up\nOw0KICAgICAgICAgICAgdGhyb3cga2Uuc2V0RmF0YWwodHJ1ZSk7DQogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAg\nICAgIC8vIGlmIHdlIGFscmVhZHkgc3RhcnRlZCB0aGUgdHJhbnNhY3Rpb24s\nIGRvbid0IGxldCBpdCBjb21taXQNCiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpICE9IDApDQogICAgICAgICAgICAgICAgc2V0Um9s\nbGJhY2tPbmx5SW50ZXJuYWwocmUpOw0KICAgICAgICAgICAgdGhyb3cgbmV3\nIFN0b3JlRXhjZXB0aW9uKHJlKS5zZXRGYXRhbCh0cnVlKTsNCiAgICAgICAg\nfQ0KDQogICAgICAgIGlmIChfcGVuZGluZyAhPSBudWxsKSB7DQogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdCA9IF9wZW5kaW5nLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQo\nKTspIHsNCiAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBs\nKSBpdC5uZXh0KCk7DQogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25h\nbCgpOw0KICAgICAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkpDQogICAg\nICAgICAgICAgICAgICAgIHNldERpcnR5KHNtLCB0cnVlKTsNCiAgICAgICAg\nICAgIH0NCiAgICAgICAgICAgIF9wZW5kaW5nID0gbnVsbDsNCiAgICAgICAg\nfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGJlZ2luU3RvcmUoKSB7DQog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsNCiAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpID09\nIDApDQogICAgICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2Fj\ndGlvbihmYWxzZSk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJv\ndyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkg\new0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICAvKioNCiAgICAgKiBCZWdpbiBhIHN0b3JlIG1hbmFnZXIg\ndHJhbnNhY3Rpb24uDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGJlZ2lu\nU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oYm9vbGVhbiBvcHRpbWlzdGljKSB7\nDQogICAgICAgIGlmICghb3B0aW1pc3RpYykgew0KICAgICAgICAgICAgcmV0\nYWluQ29ubmVjdGlvbigpOw0KICAgICAgICAgICAgX3N0b3JlLmJlZ2luKCk7\nDQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19TVE9SRV9BQ1RJVkU7DQog\nICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoX2Nvbm5SZXRhaW5N\nb2RlID09IENPTk5fUkVUQUlOX1RSQU5TKQ0KICAgICAgICAgICAgICAgIHJl\ndGFpbkNvbm5lY3Rpb24oKTsNCiAgICAgICAgICAgIF9zdG9yZS5iZWdpbk9w\ndGltaXN0aWMoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIEVuZCB0aGUgY3VycmVudCBzdG9yZSBtYW5hZ2VyIHRyYW5zYWN0aW9u\nLiBUaHJvd3MgYW4NCiAgICAgKiBleGNlcHRpb24gdG8gc2lnbmFsIGEgZm9y\nY2VkIHJvbGxiYWNrIGFmdGVyIGZhaWxlZCBjb21taXQsIG90aGVyd2lzZQ0K\nICAgICAqIHJldHVybnMgYW55IGV4Y2VwdGlvbiBlbmNvdW50ZXJlZCBkdXJp\nbmcgdGhlIGVuZCBwcm9jZXNzLg0KICAgICAqLw0KICAgIHByaXZhdGUgUnVu\ndGltZUV4Y2VwdGlvbiBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihib29s\nZWFuIHJvbGxiYWNrKSB7DQogICAgICAgIGJvb2xlYW4gZm9yY2VkUm9sbGJh\nY2sgPSBmYWxzZTsNCiAgICAgICAgYm9vbGVhbiByZWxlYXNlQ29ubiA9IGZh\nbHNlOw0KICAgICAgICBSdW50aW1lRXhjZXB0aW9uIGVyciA9IG51bGw7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nU1RPUkVfQUNUSVZFKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgcmVsZWFz\nZUNvbm4gPSBfY29ublJldGFpbk1vZGUgIT0gQ09OTl9SRVRBSU5fQUxXQVlT\nOw0KICAgICAgICAgICAgICAgIGlmIChyb2xsYmFjaykNCiAgICAgICAgICAg\nICAgICAgICAgX3N0b3JlLnJvbGxiYWNrKCk7DQogICAgICAgICAgICAgICAg\nZWxzZQ0KICAgICAgICAgICAgICAgICAgICBfc3RvcmUuY29tbWl0KCk7DQog\nICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJlbGVhc2VD\nb25uID0gX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX1RSQU5TOw0K\nICAgICAgICAgICAgICAgIF9zdG9yZS5yb2xsYmFja09wdGltaXN0aWMoKTsN\nCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgaWYgKCFyb2xsYmFj\naykgew0KICAgICAgICAgICAgICAgIGZvcmNlZFJvbGxiYWNrID0gdHJ1ZTsN\nCiAgICAgICAgICAgICAgICB0cnkgeyBfc3RvcmUucm9sbGJhY2soKTsgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZTIpIHt9DQogICAgICAgICAgICB9\nDQogICAgICAgICAgICBlcnIgPSByZTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19TVE9SRV9BQ1RJVkU7DQog\nICAgICAgIH0NCg0KICAgICAgICBpZiAocmVsZWFzZUNvbm4pIHsNCiAgICAg\nICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcmVsZWFzZUNvbm5lY3Rp\nb24oKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgICAgICBpZiAoZXJyID09IG51bGwpDQogICAg\nICAgICAgICAgICAgICAgIGVyciA9IHJlOw0KICAgICAgICAgICAgfQ0KICAg\nICAgICB9DQoNCiAgICAgICAgaWYgKGZvcmNlZFJvbGxiYWNrKQ0KICAgICAg\nICAgICAgdGhyb3cgZXJyOw0KICAgICAgICByZXR1cm4gZXJyOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHsNCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsNCg0KICAgICAgICAgICAg\namF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQ0KICAgICAg\nICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdl\ndFRyYW5zYWN0aW9uKCk7DQogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVs\nbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikpOw0KDQogICAgICAgICAg\nICAvLyB0aGlzIGNvbW1pdCBvbiB0aGUgdHJhbnNhY3Rpb24gd2lsbCBjYXVz\nZSBvdXINCiAgICAgICAgICAgIC8vIGJlZm9yZUNvbXBsZXRpb24gbWV0aG9k\nIHRvIGJlIGludm9rZWQNCiAgICAgICAgICAgIHRyYW5zLmNvbW1pdCgpOw0K\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAg\nICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIp\nLCBrZSk7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpDQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9j\nLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGUpOw0KICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOw0KICAgICAgICB9IGZpbmFsbHkg\new0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsNCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsNCg0KICAgICAg\nICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQ0K\nICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdl\ncigpLmdldFRyYW5zYWN0aW9uKCk7DQogICAgICAgICAgICBpZiAodHJhbnMg\nIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0cmFucy5yb2xsYmFjaygpOw0K\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAg\nICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIp\nLCBrZSk7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpDQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9j\nLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGUpOw0KICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOw0KICAgICAgICB9IGZpbmFsbHkg\new0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jV2l0aE1hbmFnZWRUcmFu\nc2FjdGlvbigpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBs\nb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQ0KICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOw0KICAgICAgICAgICAgaWYgKCFfbWFuYWdlZCkNCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ0cmFucy1ub3QtbWFuYWdlZCIpKTsNCiAgICAgICAgICAgIGlmIChf\nZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbih0aGlzLCBmYWxz\nZSkpIHsNCiAgICAgICAgICAgICAgICBiZWdpbkludGVybmFsKCk7DQogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0gZmluYWxseSB7DQog\nICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAg\nIHB1YmxpYyB2b2lkIGNvbW1pdEFuZFJlc3VtZSgpIHsNCiAgICAgICAgZW5k\nQW5kUmVzdW1lKHRydWUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHJv\nbGxiYWNrQW5kUmVzdW1lKCkgew0KICAgICAgICBlbmRBbmRSZXN1bWUoZmFs\nc2UpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBlbmRBbmRSZXN1bWUo\nYm9vbGVhbiBjb21taXQpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKGNvbW1pdCkN\nCiAgICAgICAgICAgICAgICBjb21taXQoKTsNCiAgICAgICAgICAgIGVsc2UN\nCiAgICAgICAgICAgICAgICByb2xsYmFjaygpOw0KICAgICAgICAgICAgYmVn\naW4oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGJv\nb2xlYW4gZ2V0Um9sbGJhY2tPbmx5KCkgew0KICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApDQogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlv\nbi5UcmFuc2FjdGlvbiB0cmFucyA9DQogICAgICAgICAgICAgICAgX3J1bnRp\nbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsN\nCiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQ0KICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIHJldHVybiB0cmFucy5n\nZXRTdGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX01BUktFRF9ST0xMQkFDSzsN\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAg\nICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIFRo\ncm93YWJsZSBnZXRSb2xsYmFja0NhdXNlKCkgew0KICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlm\nICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApDQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0\naW9uLlRyYW5zYWN0aW9uIHRyYW5zID0NCiAgICAgICAgICAgICAgICBfcnVu\ndGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigp\nOw0KICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpDQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICBpZiAodHJhbnMuZ2V0\nU3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRVU19NQVJLRURfUk9MTEJBQ0spDQog\nICAgICAgICAgICAgICAgcmV0dXJuIF9ydW50aW1lLmdldFJvbGxiYWNrQ2F1\nc2UoKTsNCg0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRo\ncm93IGtlOw0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7DQogICAg\nICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFJvbGxi\nYWNrT25seSgpIHsNCiAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG5ldyBVc2Vy\nRXhjZXB0aW9uKCkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFJv\nbGxiYWNrT25seShUaHJvd2FibGUgY2F1c2UpIHsNCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBh\nc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOw0KICAgICAgICAgICAgc2V0\nUm9sbGJhY2tPbmx5SW50ZXJuYWwoY2F1c2UpOw0KICAgICAgICB9IGZpbmFs\nbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNYXJrIHRoZSBjdXJyZW50IHRy\nYW5zYWN0aW9uIGFzIHJvbGxiYWNrLW9ubHkuDQogICAgICovDQogICAgcHJp\ndmF0ZSB2b2lkIHNldFJvbGxiYWNrT25seUludGVybmFsKFRocm93YWJsZSBj\nYXVzZSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgamF2YXgudHJh\nbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQ0KICAgICAgICAgICAgICAg\nIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0\naW9uKCk7DQogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkNCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJudWxsLXRyYW5zIikpOw0KICAgICAgICAgICAgLy8gZW5zdXJl\nIHRyYW4gaXMgaW4gYSB2YWxpZCBzdGF0ZSB0byBhY2NlcHQgdGhlIHNldFJv\nbGxiYWNrT25seQ0KICAgICAgICAgICAgaW50IHRyYW5TdGF0dXMgPSB0cmFu\ncy5nZXRTdGF0dXMoKTsNCiAgICAgICAgICAgIGlmICgodHJhblN0YXR1cyAh\nPSBTdGF0dXMuU1RBVFVTX05PX1RSQU5TQUNUSU9OKQ0KICAgICAgICAgICAg\nICAgICAgICAmJiAodHJhblN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX1JPTExF\nREJBQ0spDQogICAgICAgICAgICAgICAgICAgICYmICh0cmFuU3RhdHVzICE9\nIFN0YXR1cy5TVEFUVVNfQ09NTUlUVEVEKSkNCiAgICAgICAgICAgICAgICBf\ncnVudGltZS5zZXRSb2xsYmFja09ubHkoY2F1c2UpOw0KICAgICAgICAgICAg\nZWxzZSBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImludmFsaWQtdHJhbi1zdGF0dXMi\nLCBuZXcgSW50ZWdlcigNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5T\ndGF0dXMpLCAic2V0Um9sbGJhY2tPbmx5IikpOw0KICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBr\nZTsNCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0U2F2ZXBvaW50KFN0cmlu\nZyBuYW1lKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rp\nb24oKTsNCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYm\nIF9zYXZlcG9pbnRzLmNvbnRhaW5zS2V5KG5hbWUpKQ0KICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJzYXZlcG9p\nbnQtZXhpc3RzIiwgbmFtZSkpOw0KDQogICAgICAgICAgICBpZiAoaGFzRmx1\nc2hlZCgpICYmICFfc3BtLnN1cHBvcnRzSW5jcmVtZW50YWxGbHVzaCgpKQ0K\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbihfbG9jLmdldA0KICAgICAgICAgICAgICAgICAgICAoInNhdmVwb2ludC1m\nbHVzaC1ub3Qtc3VwcG9ydGVkIikpOw0KDQogICAgICAgICAgICBPcGVuSlBB\nU2F2ZXBvaW50IHNhdmUgPSBfc3BtLm5ld1NhdmVwb2ludChuYW1lLCB0aGlz\nKTsNCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9z\nYXZlcG9pbnRzLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgIHNhdmUu\nc2F2ZShnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCkpOw0KICAgICAgICAgICAg\nICAgIF9zYXZlcG9pbnRzID0gbmV3IExpbmtlZE1hcCgpOw0KICAgICAgICAg\nICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoX3NhdmVwb2ludENh\nY2hlID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHNhdmUuc2F2ZShD\nb2xsZWN0aW9ucy5FTVBUWV9MSVNUKTsNCiAgICAgICAgICAgICAgICBlbHNl\nIHsNCiAgICAgICAgICAgICAgICAgICAgc2F2ZS5zYXZlKF9zYXZlcG9pbnRD\nYWNoZSk7DQogICAgICAgICAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZS5j\nbGVhcigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAg\nICAgICAgICAgIF9zYXZlcG9pbnRzLnB1dChuYW1lLCBzYXZlKTsNCiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAg\nICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nDQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsN\nCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgcmVs\nZWFzZVNhdmVwb2ludCgpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKF9zYXZlcG9p\nbnRzID09IG51bGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQ0KICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1sYXN0c2F2ZXBvaW50IikpOw0KICAgICAgICAgICAgcmVsZWFzZVNhdmVw\nb2ludCgoU3RyaW5nKSBfc2F2ZXBvaW50cy5nZXQNCiAgICAgICAgICAgICAg\nICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSkpOw0KICAgICAgICB9IGZpbmFs\nbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50KFN0\ncmluZyBzYXZlcG9pbnQpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsNCg0KICAgICAgICAgICAgaW50IGluZGV4ID0gKF9z\nYXZlcG9pbnRzID09IG51bGwpID8gLTENCiAgICAgICAgICAgICAgICA6IF9z\nYXZlcG9pbnRzLmluZGV4T2Yoc2F2ZXBvaW50KTsNCiAgICAgICAgICAgIGlm\nIChpbmRleCA8IDApDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLXNhdmVwb2ludCIsIHNhdmVwb2ludCkp\nOw0KDQogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4gcmV2ZXJzZQ0KICAg\nICAgICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOw0KICAgICAgICAgICAg\nd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUoKSA+IGluZGV4ICsgMSkgew0KICAg\nICAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVw\nb2ludHMucmVtb3ZlDQogICAgICAgICAgICAgICAgICAgIChfc2F2ZXBvaW50\ncy5zaXplKCkgLSAxKTsNCiAgICAgICAgICAgICAgICBzYXZlLnJlbGVhc2Uo\nZmFsc2UpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzYXZlID0g\nKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92ZShpbmRleCk7\nDQogICAgICAgICAgICBzYXZlLnJlbGVhc2UodHJ1ZSk7DQogICAgICAgICAg\nICBpZiAoX3NhdmVwb2ludENhY2hlICE9IG51bGwpDQogICAgICAgICAgICAg\nICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7DQogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtl\nOw0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7DQogICAgICAgIH0g\nZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrVG9TYXZl\ncG9pbnQoKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAg\nICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBu\ndWxsIHx8IF9zYXZlcG9pbnRzLmlzRW1wdHkoKSkNCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbGFzdHNh\ndmVwb2ludCIpKTsNCiAgICAgICAgICAgIHJvbGxiYWNrVG9TYXZlcG9pbnQo\nKFN0cmluZykgX3NhdmVwb2ludHMuZ2V0DQogICAgICAgICAgICAgICAgKF9z\nYXZlcG9pbnRzLnNpemUoKSAtIDEpKTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIHZvaWQgcm9sbGJhY2tUb1NhdmVwb2ludChTdHJp\nbmcgc2F2ZXBvaW50KSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRy\nYW5zYWN0aW9uKCk7DQoNCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2\nZXBvaW50cyA9PSBudWxsKSA/IC0xDQogICAgICAgICAgICAgICAgOiBfc2F2\nZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7DQogICAgICAgICAgICBpZiAo\naW5kZXggPCAwKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsN\nCg0KICAgICAgICAgICAgLy8gY2xlYXIgb2xkIGluIHJldmVyc2UNCiAgICAg\nICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZTsNCiAgICAgICAgICAgIHdo\naWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEpIHsNCiAgICAg\nICAgICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9p\nbnRzLnJlbW92ZQ0KICAgICAgICAgICAgICAgICAgICAoX3NhdmVwb2ludHMu\nc2l6ZSgpIC0gMSk7DQogICAgICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZh\nbHNlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2F2ZSA9IChP\ncGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgpOw0K\nICAgICAgICAgICAgQ29sbGVjdGlvbiBzYXZlZCA9IHNhdmUucm9sbGJhY2so\nX3NhdmVwb2ludHMudmFsdWVzKCkpOw0KICAgICAgICAgICAgaWYgKF9zYXZl\ncG9pbnRDYWNoZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIF9zYXZlcG9p\nbnRDYWNoZS5jbGVhcigpOw0KICAgICAgICAgICAgaWYgKGhhc1RyYW5zYWN0\naW9uYWxPYmplY3RzKCkpIHsNCiAgICAgICAgICAgICAgICAvLyBidWlsZCB1\ncCBhIG5ldyBjb2xsZWN0aW9uIG9mIHN0YXRlcw0KICAgICAgICAgICAgICAg\nIFRyYW5zYWN0aW9uYWxDYWNoZSBvbGRUcmFuc0NhY2hlID0gX3RyYW5zQ2Fj\naGU7DQogICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25hbENhY2hlIG5ld1Ry\nYW5zQ2FjaGUgPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlDQogICAgICAgICAg\nICAgICAgICAgIChfb3JkZXJEaXJ0eSk7DQogICAgICAgICAgICAgICAgX3Ry\nYW5zQ2FjaGUgPSBudWxsOw0KDQogICAgICAgICAgICAgICAgLy8gY3VycmVu\ndGx5IHRoZXJlIGlzIHRoZSBhc3N1bXB0aW9uIHRoYXQgaW5jcmVtZW50YWwN\nCiAgICAgICAgICAgICAgICAvLyBmbHVzaCBpcyBlaXRoZXIgYSkgbm90IGFs\nbG93ZWQsIG9yIGIpIHJlcXVpcmVkDQogICAgICAgICAgICAgICAgLy8gcHJl\nLXNhdmVwb2ludC4gIHRoaXMgc29sdmVzIGEgbnVtYmVyIG9mIGlzc3VlcyBp\nbmNsdWRpbmcNCiAgICAgICAgICAgICAgICAvLyBzdG9yaW5nIGZsdXNoZWQg\nc3RhdGVzIGFzIHdlbGwgYXMgT0lEIGhhbmRsaW5nLg0KICAgICAgICAgICAg\nICAgIC8vIGlmIGZ1dHVyZSBwbHVnaW5zIGRvIG5vdCBmb2xsb3cgdGhpcywg\nd2UgbmVlZCB0byBjYWNoZQ0KICAgICAgICAgICAgICAgIC8vIG1vcmUgaW5m\nbyBwZXIgc3RhdGUNCiAgICAgICAgICAgICAgICBTYXZlcG9pbnRGaWVsZE1h\nbmFnZXIgZm07DQogICAgICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbTsNCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNhdmVk\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAg\nICAgICAgIGZtID0gKFNhdmVwb2ludEZpZWxkTWFuYWdlcikgaXRyLm5leHQo\nKTsNCiAgICAgICAgICAgICAgICAgICAgc20gPSBmbS5nZXRTdGF0ZU1hbmFn\nZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgc20ucm9sbGJhY2tUb1NhdmVw\nb2ludChmbSk7DQogICAgICAgICAgICAgICAgICAgIG9sZFRyYW5zQ2FjaGUu\ncmVtb3ZlKHNtKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmlzRGly\ndHkoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RyYW5zQ2FjaGUu\nYWRkRGlydHkoc20pOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAg\nICAgICAgICAgICAgICAgICAgICBuZXdUcmFuc0NhY2hlLmFkZENsZWFuKHNt\nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBvbGRUcmFuc0NhY2hlLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAgICAgIHNtID0gKFN0YXRl\nTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAgICAg\nIHNtLnJvbGxiYWNrKCk7DQogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZy\nb21UcmFuc2FjdGlvbihzbSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgICAgIF90cmFuc0NhY2hlID0gbmV3VHJhbnNDYWNoZTsNCiAgICAg\nICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIHZvaWQgZmx1c2goKSB7DQogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nLy8gcmV0dXJuIHNpbGVudGx5IGlmIG5vIHRyYW5zIGlzIGFjdGl2ZSwgb3Ig\naWYgdGhpcyBpcyBhIHJlZW50cmFudA0KICAgICAgICAgICAgLy8gY2FsbCwg\nd2hpY2ggY2FuIGhhcHBlbiBpZiB0aGUgc3RvcmUgbWFuYWdlciB0cmllcyB0\nbyBnZXQgYW4NCiAgICAgICAgICAgIC8vIGF1dG8taW5jIG9pZCBkdXJpbmcg\nZmx1c2gNCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUp\nID09IDANCiAgICAgICAgICAgICAgICB8fCAoX2ZsYWdzICYgRkxBR19TVE9S\nRV9GTFVTSElORykgIT0gMCkNCiAgICAgICAgICAgICAgICByZXR1cm47DQoN\nCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0\ncyBpdA0KICAgICAgICAgICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25z\nKCkuY29udGFpbnMoX2NvbmYuT1BUSU9OX0lOQ19GTFVTSCkpDQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2Mu\nZ2V0DQogICAgICAgICAgICAgICAgICAgICgiaW5jcmVtZW50YWwtZmx1c2gt\nbm90LXN1cHBvcnRlZCIpKTsNCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50\ncyAhPSBudWxsICYmICFfc2F2ZXBvaW50cy5pc0VtcHR5KCkNCiAgICAgICAg\nICAgICAgICAmJiAhX3NwbS5zdXBwb3J0c0luY3JlbWVudGFsRmx1c2goKSkN\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRp\nb24oX2xvYy5nZXQNCiAgICAgICAgICAgICAgICAgICAgKCJzYXZlcG9pbnQt\nZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsNCg0KICAgICAgICAgICAgdHJ5IHsN\nCiAgICAgICAgICAgICAgICBmbHVzaFNhZmUoRkxVU0hfSU5DKTsNCiAgICAg\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEOw0KICAgICAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAg\nICAgICAgIC8vIHJvbGxiYWNrIG9uIGZsdXNoIGVycm9yOyBvYmplY3RzIG1h\neSBiZSBpbiBpbmNvbnNpc3RlbnQgc3RhdGUNCiAgICAgICAgICAgICAgICBz\nZXRSb2xsYmFja09ubHkoa2UpOw0KICAgICAgICAgICAgICAgIHRocm93IGtl\nLnNldEZhdGFsKHRydWUpOw0KICAgICAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNr\nIG9uIGZsdXNoIGVycm9yOyBvYmplY3RzIG1heSBiZSBpbiBpbmNvbnNpc3Rl\nbnQgc3RhdGUNCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHkocmUp\nOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihy\nZSkuc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0N\nCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHByZUZs\ndXNoKCkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDApDQogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX0xP\nR0lDQUwpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMg\ndm9pZCB2YWxpZGF0ZUNoYW5nZXMoKSB7DQogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgLy8gaWYg\nbm8gdHJhbnMsIGp1c3QgcmV0dXJuOyBpZiBhY3RpdmUgZGF0YXN0b3JlIHRy\nYW5zLCBmbHVzaA0KICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgPT0gMCkNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwKSB7\nDQogICAgICAgICAgICAgICAgZmx1c2goKTsNCiAgICAgICAgICAgICAgICBy\nZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0cyBpbmMgZmx1c2gNCiAgICAgICAg\nICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9j\nb25mLk9QVElPTl9JTkNfRkxVU0gpKQ0KICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldA0KICAgICAgICAg\nICAgICAgICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQi\nKSk7DQoNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgZmx1\nc2hTYWZlKEZMVVNIX1JPTExCQUNLKTsNCiAgICAgICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgICAgICB0aHJv\ndyBrZTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRp\nb24ocmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZp\nbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAg\nIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FjdGl2ZSgpIHsN\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7\nDQogICAgICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAh\nPSAwOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1N0b3JlQWN0aXZlKCkgew0KICAgICAgICAvLyB3ZSBuZWVkIHRv\nIGxvY2sgaGVyZSwgYmVjYXVzZSB3ZSBtaWdodCBiZSBpbiB0aGUgbWlkZGxl\nIG9mIGFuDQogICAgICAgIC8vIGF0b21pYyB0cmFuc2FjdGlvbiBwcm9jZXNz\nIChlLmcuLCBjb21taXRBbmRSZXN1bWUpDQogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0dXJu\nIChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMDsNCiAgICAgICAg\nfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAg\nICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIHdoZXRo\nZXIgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gaXMgZW5kaW5nLCBpLmUuIGlu\nIHRoZSAybmQgcGhhc2UNCiAgICAgKiBvZiBhIGNvbW1pdCBvciByb2xsYmFj\naw0KICAgICAqLw0KICAgIGJvb2xlYW4gaXNUcmFuc2FjdGlvbkVuZGluZygp\nIHsNCiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX1RSQU5TX0VORElO\nRykgIT0gMDsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBiZWdpbk9w\nZXJhdGlvbihib29sZWFuIHN5bmNUcmFucykgew0KICAgICAgICBsb2NrKCk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRPcGVuKCk7DQoN\nCiAgICAgICAgICAgIGlmIChzeW5jVHJhbnMgJiYgX29wZXJhdGlvbkNvdW50\nID09IDAgJiYgX3N5bmNNYW5hZ2VkDQogICAgICAgICAgICAgICAgJiYgKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQ0KICAgICAgICAgICAgICAgIHN5\nbmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKCk7DQogICAgICAgICAgICByZXR1\ncm4gX29wZXJhdGlvbkNvdW50KysgPT0gMTsNCiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdW5sb2NrKCk7\nDQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNYXJrIHRoZSBv\ncGVyYXRpb24gb3Zlci4gSWYgb3V0ZXJtb3N0IGNhbGxlciBvZiBzdGFjaywg\ncmV0dXJucyB0cnVlDQogICAgICogYW5kIHdpbGwgZGV0YWNoIG1hbmFnZWQg\naW5zdGFuY2VzIGlmIG5lY2Vzc2FyeS4NCiAgICAgKi8NCiAgICBwdWJsaWMg\nYm9vbGVhbiBlbmRPcGVyYXRpb24oKSB7DQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDEgJiYgKF9hdXRvRGV0\nYWNoICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMA0KICAgICAgICAgICAgICAg\nICYmIChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkgew0KICAgICAgICAg\nICAgICAgIGRldGFjaEFsbEludGVybmFsKG51bGwpOw0KICAgICAgICAgICAg\nfQ0KICAgICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA8IDEpDQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJtdWx0aS10aHJlYWRlZC1hY2Nlc3MiKSk7DQogICAgICAgICAgICBy\nZXR1cm4gX29wZXJhdGlvbkNvdW50ID09IDE7DQogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtl\nOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7DQog\nICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBfb3BlcmF0aW9uQ291\nbnQtLTsNCiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQgPT0gMCkN\nCiAgICAgICAgICAgICAgICBpbml0aWFsaXplT3BlcmF0aW5nU2V0KCk7DQog\nICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAg\nIHB1YmxpYyBTeW5jaHJvbml6YXRpb24gZ2V0U3luY2hyb25pemF0aW9uKCkg\new0KICAgICAgICByZXR1cm4gX3N5bmM7DQogICAgfQ0KDQogICAgcHVibGlj\nIHZvaWQgc2V0U3luY2hyb25pemF0aW9uKFN5bmNocm9uaXphdGlvbiBzeW5j\nKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgX3N5bmMgPSBz\neW5jOw0KICAgIH0NCg0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gSW1wbGVtZW50YXRpb24g\nb2YgU3luY2hyb25pemF0aW9uIGludGVyZmFjZQ0KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICBw\ndWJsaWMgdm9pZCBiZWZvcmVDb21wbGV0aW9uKCkgew0KICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAg\nICAvLyB1c2VyLXN1cHBsaWVkIHN5bmNocm9uaXphdGlvbg0KICAgICAgICAg\nICAgaWYgKF9zeW5jICE9IG51bGwpDQogICAgICAgICAgICAgICAgX3N5bmMu\nYmVmb3JlQ29tcGxldGlvbigpOw0KDQogICAgICAgICAgICBmbHVzaFNhZmUo\nRkxVU0hfQ09NTUlUKTsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgew0KICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJs\nZWQoKSkNCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJl\nbmQtdHJhbnMtZXJyb3IiKSwga2UpOw0KICAgICAgICAgICAgdGhyb3cgdHJh\nbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNlcHRpb24oa2UpOw0KICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAgICAgICAg\nIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCByZSk7\nDQogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlv\nbkV4Y2VwdGlvbihuZXcgU3RvcmVFeGNlcHRpb24ocmUpKTsNCiAgICAgICAg\nfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAg\nICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgYWZ0ZXJDb21wbGV0\naW9uKGludCBzdGF0dXMpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsNCg0KICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nVFJBTlNfRU5ESU5HOw0KICAgICAgICAgICAgZW5kVHJhbnNhY3Rpb24oc3Rh\ndHVzKTsNCiAgICAgICAgICAgIGlmIChfc3luYyAhPSBudWxsKQ0KICAgICAg\nICAgICAgICAgIF9zeW5jLmFmdGVyQ29tcGxldGlvbihzdGF0dXMpOw0KDQog\nICAgICAgICAgICBpZiAoKF9hdXRvRGV0YWNoICYgREVUQUNIX0NPTU1JVCkg\nIT0gMCkNCiAgICAgICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxs\nKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBTdGF0dXMuU1RB\nVFVTX1JPTExFREJBQ0sgDQogICAgICAgICAgICAgICAgJiYgKF9hdXRvRGV0\nYWNoICYgREVUQUNIX1JPTExCQUNLKSAhPSAwKSB7DQogICAgICAgICAgICAg\nICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7DQogICAgICAgICAgICB9DQoN\nCiAgICAgICAgICAgIC8vIGluIGFuIGVlIGNvbnRleHQsIGl0J3MgcG9zc2li\nbGUgdGhhdCB0aGUgdXNlciB0cmllZCB0byBjbG9zZQ0KICAgICAgICAgICAg\nLy8gdXMgYnV0IHdlIGRpZG4ndCBhY3R1YWxseSBjbG9zZSBiZWNhdXNlIHdl\nIHdlcmUgd2FpdGluZyBvbiB0aGlzDQogICAgICAgICAgICAvLyB0cmFuc2Fj\ndGlvbjsgaWYgdGhhdCdzIHRydWUsIHRoZW4gY2xvc2Ugbm93DQogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQ0xPU0VfSU5WT0tFRCkgIT0gMA0K\nICAgICAgICAgICAgICAgICYmIF9jb21wYXQuZ2V0Q2xvc2VPbk1hbmFnZWRD\nb21taXQoKSkNCiAgICAgICAgICAgICAgICBmcmVlKCk7DQogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpDQogICAgICAgICAgICAgICAgX2xv\nZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsNCiAg\nICAgICAgICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhj\nZXB0aW9uKGtlKTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgew0KICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkNCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQt\ndHJhbnMtZXJyb3IiKSwgcmUpOw0KICAgICAgICAgICAgdGhyb3cgdHJhbnNs\nYXRlTWFuYWdlZENvbXBsZXRpb25FeGNlcHRpb24obmV3IFN0b3JlRXhjZXB0\naW9uKHJlKSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfQUNUSVZFOw0KICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX0ZMVVNIRUQ7DQogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nVFJBTlNfRU5ESU5HOw0KDQogICAgICAgICAgICAvLyBldmVudCBtYW5hZ2Vy\nIG51bGxlZCBpZiBmcmVlZCBicm9rZXINCiAgICAgICAgICAgIGlmIChfdHJh\nbnNFdmVudE1hbmFnZXIgIT0gbnVsbCANCiAgICAgICAgICAgICAgICAmJiBf\ndHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpIHsNCiAgICAg\nICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rp\nb25FdmVudCh0aGlzLA0KICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPT0g\nU3RhdHVzLlNUQVRVU19DT01NSVRURUQNCiAgICAgICAgICAgICAgICAgICAg\nICAgID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9DT01NSVRfQ09NUExFVEUN\nCiAgICAgICAgICAgICAgICAgICAgICAgIDogVHJhbnNhY3Rpb25FdmVudC5B\nRlRFUl9ST0xMQkFDS19DT01QTEVURSwNCiAgICAgICAgICAgICAgICAgICAg\nbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCkpOw0KICAgICAgICAgICAgfQ0KDQog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIElmIHdlJ3JlIGluIGEgbWFuYWdlZCB0cmFu\nc2FjdGlvbiwgdXNlIG91ciBpbXBsaWNpdCBiZWhhdmlvciBleGNlcHRpb24N\nCiAgICAgKiB0cmFuc2xhdG9yIHRvIHRyYW5zbGF0ZSBiZWZvcmUvYWZ0ZXJD\nb21wbGV0aW9uIGNhbGxiYWNrIGVycm9ycy4NCiAgICAgKi8NCiAgICBwcml2\nYXRlIFJ1bnRpbWVFeGNlcHRpb24gdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRp\nb25FeGNlcHRpb24NCiAgICAgICAgKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsN\nCiAgICAgICAgcmV0dXJuICghX21hbmFnZWQgfHwgX2V4dHJhbnMgPT0gbnVs\nbCkgPyByZSA6IF9leHRyYW5zLnRyYW5zbGF0ZShyZSk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogRmx1c2ggc2FmZWx5LCBjYXRjaGluZyByZWVudHJh\nbnQgY2FsbHMuDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGZsdXNoU2Fm\nZShpbnQgcmVhc29uKSB7DQogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19G\nTFVTSElORykgIT0gMCkNCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlk\nU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlZW50cmFudC1mbHVzaCIpKTsN\nCg0KICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSElORzsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIGZsdXNoKHJlYXNvbik7DQogICAgICAgIH0g\nZmluYWxseSB7DQogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hJ\nTkc7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGbHVz\naCB0aGUgdHJhbnNhY3Rpb25hbCBzdGF0ZSB0byB0aGUgZGF0YSBzdG9yZS4g\nU3ViY2xhc3NlcyB0aGF0DQogICAgICogY3VzdG9taXplIGNvbW1pdCBiZWhh\ndmlvciBzaG91bGQgb3ZlcnJpZGUgdGhpcyBtZXRob2QuIFRoZSBtZXRob2QN\nCiAgICAgKiBhc3N1bWVzIHRoYXQgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIg\naXMgbG9ja2VkLCBpcyBub3QgY2xvc2VkLA0KICAgICAqIGFuZCBoYXMgYW4g\nYWN0aXZlIHRyYW5zYWN0aW9uLg0KICAgICAqDQogICAgICogQHBhcmFtIHJl\nYXNvbiBvbmUgb2Yge0BsaW5rICNGTFVTSF9JTkN9LCB7QGxpbmsgI0ZMVVNI\nX0NPTU1JVH0sDQogICAgICoge0BsaW5rICNGTFVTSF9ST0xMQkFDS30sIG9y\nIHtAbGluayAjRkxVU0hfTE9HSUNBTH0NCiAgICAgKiBAc2luY2UgMC4yLjUN\nCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgdm9pZCBmbHVzaChpbnQgcmVhc29u\nKSB7DQogICAgICAgIC8vIHRoaXMgd2lsbCBlbmxpc3QgcHJveGllZCBzdGF0\nZXMgYXMgbmVjZXNzYXJ5IHNvIHdlIGtub3cgd2hldGhlciB3ZQ0KICAgICAg\nICAvLyBoYXZlIGFueXRoaW5nIHRvIGZsdXNoDQogICAgICAgIENvbGxlY3Rp\nb24gdHJhbnNhY3Rpb25hbCA9IGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMoKTsN\nCg0KICAgICAgICAvLyBkbyB3ZSBhY3R1YWxseSBoYXZlIHRvIGZsdXNoPyAg\nb25seSBpZiBvdXIgZmxhZ3Mgc2F5IHNvLCBvciBpZg0KICAgICAgICAvLyB3\nZSBoYXZlIHRyYW5zYWN0aW9uIGxpc3RlbmVycyB0aGF0IG5lZWQgdG8gYmUg\naW52b2tlZCBmb3IgY29tbWl0DQogICAgICAgIC8vIChubyBuZWVkIHRvIGlu\ndm9rZSB0aGVtIG9uIGluYyBmbHVzaCBpZiBub3RoaW5nIGlzIGRpcnR5KS4g\nIHdlDQogICAgICAgIC8vIHNwZWNpYWwgY2FzZSB0aGUgcmVtb3RlIGNvbW1p\ndCBsaXN0ZW5lciB1c2VkIGJ5IHRoZSBkYXRhY2FjaGUgY2F1c2UNCiAgICAg\nICAgLy8gd2Uga25vdyBpdCBkb2Vzbid0IHJlcXVpcmUgdGhlIGNvbW1pdCBl\ndmVudCB3aGVuIG5vdGhpbmcgY2hhbmdlcw0KICAgICAgICBib29sZWFuIGZs\ndXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDA7DQog\nICAgICAgIGJvb2xlYW4gbGlzdGVuZXJzID0gKF90cmFuc0V2ZW50TWFuYWdl\nci5oYXNGbHVzaExpc3RlbmVycygpDQogICAgICAgICAgICB8fCBfdHJhbnNF\ndmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpDQogICAgICAgICAgICAm\nJiAoKF9mbGFncyAmIEZMQUdfUkVNT1RFX0xJU1RFTkVSKSA9PSAwDQogICAg\nICAgICAgICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuZ2V0TGlzdGVuZXJzKCku\nc2l6ZSgpID4gMSk7DQogICAgICAgIGlmICghZmx1c2ggJiYgKHJlYXNvbiAh\nPSBGTFVTSF9DT01NSVQgfHwgIWxpc3RlbmVycykpDQogICAgICAgICAgICBy\nZXR1cm47DQoNCiAgICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7DQog\nICAgICAgIF9mbGFncyB8PSBGTEFHX1BSRVNUT1JJTkc7DQogICAgICAgIHRy\neSB7DQogICAgICAgICAgICBpZiAoZmx1c2gpIHsNCiAgICAgICAgICAgICAg\nICAvLyBjYWxsIHByZSBzdG9yZSBvbiBhbGwgY3VycmVudGx5IHRyYW5zYWN0\naW9uYWwgb2Jqcw0KICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gdHJhbnNhY3Rpb25hbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykN\nCiAgICAgICAgICAgICAgICAgICAgKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIu\nbmV4dCgpKS5iZWZvcmVGbHVzaChyZWFzb24sIF9jYWxsKTsNCiAgICAgICAg\nICAgICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24p\nOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBob3BlZnVsbHkg\nbm93IGFsbCBkZXBlbmRlbnQgaW5zdGFuY2VzIHRoYXQgYXJlIGdvaW5nIHRv\nIGVuZA0KICAgICAgICAgICAgLy8gdXAgcmVmZXJlbmNlZCBoYXZlIGJlZW4g\nbWFya2VkIGFzIHN1Y2g7IGRlbGV0ZSB1bnJlZmVkDQogICAgICAgICAgICAv\nLyBkZXBlbmRlbnRzDQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19ERVJF\nRkRFTEVUSU5HOw0KICAgICAgICAgICAgaWYgKGZsdXNoICYmIF9kZXJlZkNh\nY2hlICE9IG51bGwgJiYgIV9kZXJlZkNhY2hlLmlzRW1wdHkoKSkgew0KICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2RlcmVmQ2FjaGUu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspDQogICAgICAgICAgICAgICAg\nICAgIGRlbGV0ZURlcmVmKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgp\nKTsNCiAgICAgICAgICAgICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2FjdGlv\nbmFsLCByZWFzb24pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBp\nZiAocmVhc29uICE9IEZMVVNIX0xPR0lDQUwpIHsNCiAgICAgICAgICAgICAg\nICAvLyBpZiBubyBkYXRhc3RvcmUgdHJhbnNhY3Rpb24sIHN0YXJ0IG9uZTsg\nZXZlbiBpZiB3ZSBkb24ndA0KICAgICAgICAgICAgICAgIC8vIHRoaW5rIHdl\nJ2xsIG5lZWQgdG8gZmx1c2ggYXQgdGhpcyBwb2ludCwgb3VyIHRyYW5zYWN0\naW9uDQogICAgICAgICAgICAgICAgLy8gbGlzdGVuZXJzIG1pZ2h0IGludHJv\nZHVjZSBzb21lIGRpcnR5IG9iamVjdHMgb3IgaW50ZXJhY3QNCiAgICAgICAg\nICAgICAgICAvLyBkaXJlY3RseSB3aXRoIHRoZSBkYXRhYmFzZQ0KICAgICAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpID09\nIDApDQogICAgICAgICAgICAgICAgICAgIGJlZ2luU3RvcmVNYW5hZ2VyVHJh\nbnNhY3Rpb24oZmFsc2UpOw0KDQogICAgICAgICAgICAgICAgaWYgKChfdHJh\nbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKQ0KICAgICAgICAg\nICAgICAgICAgICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVu\nZXJzKCkpDQogICAgICAgICAgICAgICAgICAgICYmIChmbHVzaCB8fCByZWFz\nb24gPT0gRkxVU0hfQ09NTUlUKSkgew0KICAgICAgICAgICAgICAgICAgICAv\nLyBmaXJlIGV2ZW50cw0KICAgICAgICAgICAgICAgICAgICBtb2JqcyA9IG5l\ndyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbih0cmFuc2FjdGlvbmFsKTsNCiAg\nICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9DT01NSVQN\nCiAgICAgICAgICAgICAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdl\nci5oYXNFbmRMaXN0ZW5lcnMoKSkgew0KICAgICAgICAgICAgICAgICAgICAg\nICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQo\ndGhpcywgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNhY3Rp\nb25FdmVudC5CRUZPUkVfQ09NTUlULCBtb2JqcywNCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBf\nZGVsZXRlZENsc3MpKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgZmx1\nc2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsNCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZsdXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hf\nUkVRVUlSRUQpICE9IDA7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAg\nICAgICAgICAgICAgICAgICBpZiAoZmx1c2ggJiYgX3RyYW5zRXZlbnRNYW5h\nZ2VyLmhhc0ZsdXNoTGlzdGVuZXJzKCkpIHsNCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2\nZW50KHRoaXMsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5z\nYWN0aW9uRXZlbnQuQkVGT1JFX0ZMVVNILCBtb2JqcywNCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNz\nLCBfZGVsZXRlZENsc3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZs\ndXNoQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7DQogICAgICAg\nICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAg\nICB9DQogICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfUFJFU1RPUklORzsNCiAgICAgICAgICAgIF9m\nbGFncyAmPSB+RkxBR19ERVJFRkRFTEVUSU5HOw0KICAgICAgICAgICAgX3Ry\nYW5zQWRkaXRpb25zID0gbnVsbDsNCiAgICAgICAgICAgIF9kZXJlZkFkZGl0\naW9ucyA9IG51bGw7DQoNCiAgICAgICAgICAgIC8vIGFsc28gY2xlYXIgZGVy\nZWZlZCBzZXQ7IHRoZSBkZWxldGVzIGhhdmUgYmVlbiByZWNvcmRlZA0KICAg\nICAgICAgICAgaWYgKF9kZXJlZkNhY2hlICE9IG51bGwpDQogICAgICAgICAg\nICAgICAgX2RlcmVmQ2FjaGUgPSBudWxsOw0KICAgICAgICB9DQoNCiAgICAg\nICAgLy8gZmx1c2ggdG8gc3RvcmUgbWFuYWdlcg0KICAgICAgICBMaXN0IGV4\nY2VwcyA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAo\nZmx1c2ggJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwpIHsNCiAgICAgICAg\nICAgICAgICBfZmxhZ3MgfD0gRkxBR19TVE9SRV9GTFVTSElORzsNCiAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLA0KICAgICAgICAgICAg\nICAgICAgICBuZXdGbHVzaEV4Y2VwdGlvbihfc3RvcmUuZmx1c2godHJhbnNh\nY3Rpb25hbCkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBmaW5hbGx5\nIHsNCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19TVE9SRV9GTFVTSElO\nRzsNCg0KICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9ST0xMQkFD\nSykNCiAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlbmRT\ndG9yZU1hbmFnZXJUcmFuc2FjdGlvbih0cnVlKSk7DQogICAgICAgICAgICBl\nbHNlIGlmIChyZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkNCiAgICAgICAgICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hfUkVRVUlSRUQ7DQoNCiAgICAg\nICAgICAgIC8vIG1hcmsgc3RhdGVzIGFzIGZsdXNoZWQNCiAgICAgICAgICAg\nIGlmIChmbHVzaCkgew0KICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc207DQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0\ncmFuc2FjdGlvbmFsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQog\nICAgICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0\nci5uZXh0KCk7DQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAg\nICAgICAgICAgICAgICAgICAvLyB0aGUgc3RhdGUgbWF5IGhhdmUgYmVjb21l\nIHRyYW5zaWVudCwgc3VjaCBhcyBpZg0KICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gaXQgaXMgZW1iZWRkZWQgYW5kIHRoZSBvd25lciBoYXMgYmVlbiBk\nZWxldGVkIGR1cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhp\ncyBmbHVzaCBwcm9jZXNzOyBidWcgIzExMDANCiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5UUkFOU0lF\nTlQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoN\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmFmdGVyRmx1c2gocmVhc29u\nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxV\nU0hfSU5DKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYg\nbm90IGFib3V0IHRvIGNsZWFyIHRyYW5zIGNhY2hlIGZvciBjb21taXQgDQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW55d2F5LCByZS1jYWNo\nZSBkaXJ0eSBvYmplY3RzIHdpdGggZGVmYXVsdCBzb2Z0DQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gcmVmczsgd2UgZG9uJ3QgbmVlZCBoYXJk\nIHJlZnMgbm93IHRoYXQgdGhlIA0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGNoYW5nZXMgaGF2ZSBiZWVuIGZsdXNoZWQNCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBzbS5wcm94eUZpZWxkcyh0cnVlLCBmYWxzZSk7\nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUuZmx1\nc2hlZChzbSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7DQogICAgICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlKTsNCiAg\nICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAg\nICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHRocm93IGFueSBl\neGNlcHRpb25zIHRvIHNob3J0Y3V0IGxpc3RlbmVycyBvbiBmYWlsDQogICAg\nICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOw0KDQog\nICAgICAgIGlmIChmbHVzaCAmJiByZWFzb24gIT0gRkxVU0hfUk9MTEJBQ0sg\nJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwNCiAgICAgICAgICAgICYmIF90\ncmFuc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpKSB7DQogICAg\nICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25F\ndmVudCh0aGlzLA0KICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQu\nQUZURVJfRkxVU0gsIG1vYmpzLCBfcGVyc2lzdGVkQ2xzcywNCiAgICAgICAg\nICAgICAgICBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRmx1c2ggbmV3bHktdHJh\nbnNhY3Rpb25hbCBvYmplY3RzLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9p\nZCBmbHVzaEFkZGl0aW9ucyhDb2xsZWN0aW9uIHRyYW5zYWN0aW9uYWwsIGlu\ndCByZWFzb24pIHsNCiAgICAgICAgYm9vbGVhbiBsb29wOw0KICAgICAgICBk\nbyB7DQogICAgICAgICAgICAvLyBmbHVzaCBuZXcgdHJhbnNhY3Rpb25hbCBp\nbnN0YW5jZXM7IG5vdGUgbG9naWNhbCBvcg0KICAgICAgICAgICAgbG9vcCA9\nIGZsdXNoVHJhbnNBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKQ0K\nICAgICAgICAgICAgICAgIHwgZGVsZXRlRGVyZWZBZGRpdGlvbnMoX2RlcmVm\nQ2FjaGUpOw0KICAgICAgICB9IHdoaWxlIChsb29wKTsNCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBGbHVzaCB0cmFuc2FjdGlvbmFsIGFkZGl0aW9ucy4N\nCiAgICAgKi8NCiAgICBwcml2YXRlIGJvb2xlYW4gZmx1c2hUcmFuc0FkZGl0\naW9ucyhDb2xsZWN0aW9uIHRyYW5zYWN0aW9uYWwsIGludCByZWFzb24pIHsN\nCiAgICAgICAgaWYgKF90cmFuc0FkZGl0aW9ucyA9PSBudWxsIHx8IF90cmFu\nc0FkZGl0aW9ucy5pc0VtcHR5KCkpDQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7DQoNCiAgICAgICAgLy8ga2VlcCBsb2NhbCB0cmFuc2FjdGlvbmFsIGxp\nc3QgY29weSB1cCB0byBkYXRlDQogICAgICAgIHRyYW5zYWN0aW9uYWwuYWRk\nQWxsKF90cmFuc0FkZGl0aW9ucyk7DQoNCiAgICAgICAgLy8gY29weSB0aGUg\nY2hhbmdlIHNldCwgdGhlbiBjbGVhciBpdCBmb3IgdGhlIG5leHQgaXRlcmF0\naW9uDQogICAgICAgIFN0YXRlTWFuYWdlckltcGxbXSBzdGF0ZXMgPSAoU3Rh\ndGVNYW5hZ2VySW1wbFtdKSBfdHJhbnNBZGRpdGlvbnMuDQogICAgICAgICAg\nICB0b0FycmF5KG5ldyBTdGF0ZU1hbmFnZXJJbXBsW190cmFuc0FkZGl0aW9u\ncy5zaXplKCldKTsNCiAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbnVsbDsN\nCg0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7\nIGkrKykNCiAgICAgICAgICAgIHN0YXRlc1tpXS5iZWZvcmVGbHVzaChyZWFz\nb24sIF9jYWxsKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogRGVsZXRlIG5ldyBkZXJlZmVyZW5jZWQgb2JqZWN0\ncy4NCiAgICAgKi8NCiAgICBwcml2YXRlIGJvb2xlYW4gZGVsZXRlRGVyZWZB\nZGRpdGlvbnMoQ29sbGVjdGlvbiBkZXJlZnMpIHsNCiAgICAgICAgaWYgKF9k\nZXJlZkFkZGl0aW9ucyA9PSBudWxsIHx8IF9kZXJlZkFkZGl0aW9ucy5pc0Vt\ncHR5KCkpDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAg\nLy8gcmVtZW1iZXIgdGhlc2UgYWRkaXRpb25zIGluIGNhc2Ugb25lIGJlY29t\nZXMgZGVyZWZlZCBhZ2FpbiBsYXRlcg0KICAgICAgICBkZXJlZnMuYWRkQWxs\nKF9kZXJlZkFkZGl0aW9ucyk7DQoNCiAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbFtdIHN0YXRlcyA9IChTdGF0ZU1hbmFnZXJJbXBsW10pIF9kZXJlZkFkZGl0\naW9ucy4NCiAgICAgICAgICAgIHRvQXJyYXkobmV3IFN0YXRlTWFuYWdlcklt\ncGxbX2RlcmVmQWRkaXRpb25zLnNpemUoKV0pOw0KICAgICAgICBfZGVyZWZB\nZGRpdGlvbnMgPSBudWxsOw0KDQogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgZGVsZXRlRGVy\nZWYoc3RhdGVzW2ldKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogRGVsZXRlIGEgZGVyZWZlcmVuY2VkIGRlcGVu\nZGVudC4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQgZGVsZXRlRGVyZWYo\nU3RhdGVNYW5hZ2VySW1wbCBzbSkgew0KICAgICAgICBpbnQgYWN0aW9uID0g\ncHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0RFTEVURSwNCiAgICAg\nICAgICAgIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBzbSwgbnVsbCk7DQog\nICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0g\nMCkNCiAgICAgICAgICAgIHNtLmRlbGV0ZSgpOw0KICAgICAgICBpZiAoKGFj\ndGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQ0KICAgICAg\nICAgICAgc20uY2FzY2FkZURlbGV0ZShfY2FsbCk7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogRGV0ZXJtaW5lIHRoZSBhY3Rpb24gdG8gdGFrZSBiYXNl\nZCBvbiB0aGUgdXNlcidzIGdpdmVuIGNhbGxiYWNrcyBhbmQNCiAgICAgKiBv\ndXIgaW1wbGljaXQgYmVoYXZpb3IuDQogICAgICovDQogICAgcHJpdmF0ZSBp\nbnQgcHJvY2Vzc0FyZ3VtZW50KGludCBvcCwgT2JqZWN0IG9iaiwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwNCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkg\new0KICAgICAgICBpZiAoY2FsbCAhPSBudWxsKQ0KICAgICAgICAgICAgcmV0\ndXJuIGNhbGwucHJvY2Vzc0FyZ3VtZW50KG9wLCBvYmosIHNtKTsNCiAgICAg\nICAgaWYgKF9jYWxsICE9IG51bGwpDQogICAgICAgICAgICByZXR1cm4gX2Nh\nbGwucHJvY2Vzc0FyZ3VtZW50KG9wLCBvYmosIHNtKTsNCiAgICAgICAgcmV0\ndXJuIE9wQ2FsbGJhY2tzLkFDVF9SVU4gfCBPcENhbGxiYWNrcy5BQ1RfQ0FT\nQ0FERTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaHJvdyB0aGUgcHJv\ncGVyIGV4Y2VwdGlvbiBiYXNlZCBvbiB0aGUgZ2l2ZW4gc2V0IG9mIGZsdXNo\nIGVycm9ycywgb3INCiAgICAgKiBkbyBub3RoaW5nIGlmIG5vIGVycm9ycyBv\nY2N1cnJlZC4NCiAgICAgKi8NCiAgICBwcml2YXRlIE9wZW5KUEFFeGNlcHRp\nb24gbmV3Rmx1c2hFeGNlcHRpb24oQ29sbGVjdGlvbiBleGNlcHMpIHsNCiAg\nICAgICAgaWYgKGV4Y2VwcyA9PSBudWxsIHx8IGV4Y2Vwcy5pc0VtcHR5KCkp\nDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICBUaHJvd2Fi\nbGVbXSB0ID0gKFRocm93YWJsZVtdKSBleGNlcHMudG9BcnJheQ0KICAgICAg\nICAgICAgKG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUoKV0pOw0KICAgICAg\nICBMaXN0IGZhaWxlZCA9IG5ldyBBcnJheUxpc3QodC5sZW5ndGgpOw0KDQog\nICAgICAgIC8vIGNyZWF0ZSBmYXRhbCBleGNlcHRpb24gd2l0aCBuZXN0ZWQg\nZXhjZXB0aW9ucyBmb3IgYWxsIHRoZSBmYWlsZWQNCiAgICAgICAgLy8gb2Jq\nZWN0czsgaWYgYWxsIE9MIGV4Y2VwdGlvbnMsIHRocm93IGEgdG9wLWxldmVs\nIE9MIGV4Y2VwdGlvbg0KICAgICAgICBib29sZWFuIG9wdCA9IHRydWU7DQog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBvcHQgJiYgaSA8IHQubGVuZ3RoOyBp\nKyspIHsNCiAgICAgICAgICAgIG9wdCA9IHRbaV0gaW5zdGFuY2VvZiBPcHRp\nbWlzdGljRXhjZXB0aW9uOw0KICAgICAgICAgICAgaWYgKG9wdCkgew0KICAg\nICAgICAgICAgICAgIE9iamVjdCBmID0gKChPcHRpbWlzdGljRXhjZXB0aW9u\nKSB0W2ldKS5nZXRGYWlsZWRPYmplY3QoKTsNCiAgICAgICAgICAgICAgICBp\nZiAoZiAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBmYWlsZWQuYWRk\nKGYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChv\ncHQgJiYgIWZhaWxlZC5pc0VtcHR5KCkpDQogICAgICAgICAgICByZXR1cm4g\nbmV3IE9wdGltaXN0aWNFeGNlcHRpb24oZmFpbGVkLCB0KTsNCiAgICAgICAg\naWYgKG9wdCkNCiAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4\nY2VwdGlvbih0KTsNCiAgICAgICAgcmV0dXJuIG5ldyBTdG9yZUV4Y2VwdGlv\nbihfbG9jLmdldCgicm9sbGVkLWJhY2siKSkuDQogICAgICAgICAgICBzZXRO\nZXN0ZWRUaHJvd2FibGVzKHQpLnNldEZhdGFsKHRydWUpOw0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIEVuZCB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiwg\nbWFraW5nIGFwcHJvcHJpYXRlIHN0YXRlIHRyYW5zaXRpb25zLg0KICAgICAq\nLw0KICAgIHByb3RlY3RlZCB2b2lkIGVuZFRyYW5zYWN0aW9uKGludCBzdGF0\ndXMpIHsNCiAgICAgICAgLy8gaWYgYSBkYXRhIHN0b3JlIHRyYW5zYWN0aW9u\nIHdhcyBpbiBwcm9ncmVzcywgZG8gdGhlDQogICAgICAgIC8vIGFwcHJvcHJp\nYXRlIHRyYW5zYWN0aW9uIGNoYW5nZQ0KICAgICAgICBib29sZWFuIHJvbGxi\nYWNrID0gc3RhdHVzICE9IFN0YXR1cy5TVEFUVVNfQ09NTUlUVEVEOw0KICAg\nICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7DQoNCiAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGVuZFN0b3JlTWFuYWdl\nclRyYW5zYWN0aW9uKHJvbGxiYWNrKSk7DQogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHJvbGxiYWNrID0g\ndHJ1ZTsNCiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsN\nCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGdvIGJhY2sgdG8gZGVmYXVsdCBu\nb25lIGxvY2sgbGV2ZWwNCiAgICAgICAgX2ZjLnNldFJlYWRMb2NrTGV2ZWwo\nTE9DS19OT05FKTsNCiAgICAgICAgX2ZjLnNldFdyaXRlTG9ja0xldmVsKExP\nQ0tfTk9ORSk7DQogICAgICAgIF9mYy5zZXRMb2NrVGltZW91dCgtMSk7DQoN\nCiAgICAgICAgQ29sbGVjdGlvbiB0cmFuc1N0YXRlczsNCiAgICAgICAgaWYg\nKGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpDQogICAgICAgICAgICB0cmFu\nc1N0YXRlcyA9IF90cmFuc0NhY2hlOw0KICAgICAgICBlbHNlDQogICAgICAg\nICAgICB0cmFuc1N0YXRlcyA9IENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7DQoN\nCiAgICAgICAgLy8gZmlyZSBhZnRlciByb2xsYmFjay9jb21taXQgZXZlbnQN\nCiAgICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7DQogICAgICAgIGlm\nIChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpIHsNCiAg\nICAgICAgICAgIG1vYmpzID0gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9u\nKHRyYW5zU3RhdGVzKTsNCiAgICAgICAgICAgIGludCBldmVudFR5cGUgPSAo\ncm9sbGJhY2spID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9ST0xMQkFDSw0K\nICAgICAgICAgICAgICAgIDogVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9DT01N\nSVQ7DQogICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJh\nbnNhY3Rpb25FdmVudCh0aGlzLCBldmVudFR5cGUsIG1vYmpzLCANCiAgICAg\nICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVs\nZXRlZENsc3MpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIG51bGwgdHJh\nbnNhY3Rpb25hbCBjYWNoZXMgbm93IHNvIHRoYXQgYWxsIHRoZSByZW1vdmVG\ncm9tVHJhbnNhY3Rpb24NCiAgICAgICAgLy8gY2FsbHMgYXMgd2UgdHJhbnNp\ndGlvbiBlYWNoIG9iamVjdCBkb24ndCBoYXZlIHRvIGRvIGFueSB3b3JrOyBk\nb24ndA0KICAgICAgICAvLyBjbGVhciB0cmFucyBjYWNoZSBvYmplY3QgYmVj\nYXVzZSB3ZSBzdGlsbCBuZWVkIHRoZSB0cmFuc1N0YXRlcw0KICAgICAgICAv\nLyByZWZlcmVuY2UgdG8gaXQgYmVsb3cNCiAgICAgICAgX3RyYW5zQ2FjaGUg\nPSBudWxsOw0KICAgICAgICBpZiAoX3BlcnNpc3RlZENsc3MgIT0gbnVsbCkN\nCiAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzID0gbnVsbDsNCiAgICAgICAg\naWYgKF91cGRhdGVkQ2xzcyAhPSBudWxsKQ0KICAgICAgICAgICAgX3VwZGF0\nZWRDbHNzID0gbnVsbDsNCiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyAhPSBu\ndWxsKQ0KICAgICAgICAgICAgX2RlbGV0ZWRDbHNzID0gbnVsbDsNCg0KICAg\nICAgICAvLyBuZXcgY2FjaGUgd291bGQgZ2V0IGNsZWFyZWQgYW55d2F5IGR1\ncmluZyB0cmFuc2l0aW9ucywgYnV0IGRvaW5nIHNvDQogICAgICAgIC8vIGlt\nbWVkaWF0ZWx5IHNhdmVzIHVzIHNvbWUgbG9va3Vwcw0KICAgICAgICBfY2Fj\naGUuY2xlYXJOZXcoKTsNCg0KICAgICAgICAvLyB0ZWxsIGFsbCBkZXJlZmVk\nIGluc3RhbmNlcyB0aGV5J3JlIG5vIGxvbmdlciBkZXJlZmVkOyB3ZSBjYW4n\ndA0KICAgICAgICAvLyByZWx5IG9uIHJvbGxiYWNrIGFuZCBjb21taXQgY2Fs\nbHMgYmVsb3cgY2F1c2Ugc29tZSBpbnN0YW5jZXMgbWlnaHQNCiAgICAgICAg\nLy8gbm90IGJlIHRyYW5zYWN0aW9uYWwNCiAgICAgICAgaWYgKF9kZXJlZkNh\nY2hlICE9IG51bGwgJiYgIV9kZXJlZkNhY2hlLmlzRW1wdHkoKSkgew0KICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGVyZWZDYWNoZS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykNCiAgICAgICAgICAgICAgICAoKFN0\nYXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCkpLnNldERlcmVmZXJlbmNlZERl\ncGVuZGVudA0KICAgICAgICAgICAgICAgICAgICAoZmFsc2UsIGZhbHNlKTsN\nCiAgICAgICAgICAgIF9kZXJlZkNhY2hlID0gbnVsbDsNCiAgICAgICAgfQ0K\nDQogICAgICAgIC8vIHBlZm9ybSBjb21taXQgb3Igcm9sbGJhY2sgc3RhdGUg\ndHJhbnNpdGlvbnMgb24gZWFjaCBpbnN0YW5jZQ0KICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRy\nYW5zU3RhdGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAg\nICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOw0K\nICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAocm9sbGJh\nY2spIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gdGVsbCBvYmplY3RzIHRo\nYXQgbWF5IGhhdmUgYmVlbiBkZXJlZmVkIHRoZW4gZmx1c2hlZA0KICAgICAg\nICAgICAgICAgICAgICAvLyAoYW5kIHRoZXJlZm9yZSBkZWxldGVkKSB0byB1\nbi1kZXJlZg0KICAgICAgICAgICAgICAgICAgICBzbS5zZXREZXJlZmVyZW5j\nZWREZXBlbmRlbnQoZmFsc2UsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAg\nICAgc20ucm9sbGJhY2soKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UNCiAg\nICAgICAgICAgICAgICAgICAgc20uY29tbWl0KCk7DQogICAgICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICAg\nICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOw0KICAgICAgICAgICAgfQ0K\nICAgICAgICB9DQoNCiAgICAgICAgLy8gbm90aWZ5IHRoZSBsb2NrIG1hbmFn\nZXIgdG8gY2xlYW4gdXAgYW5kIHJlbGVhc2UgcmVtYWluaW5nIGxvY2tzDQog\nICAgICAgIF9sbS5lbmRUcmFuc2FjdGlvbigpOw0KDQogICAgICAgIC8vIGNs\nZWFyIG9sZCBzYXZlcG9pbnRzIGluIHJldmVyc2UNCiAgICAgICAgT3BlbkpQ\nQVNhdmVwb2ludCBzYXZlOw0KICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMg\nIT0gbnVsbCAmJiBfc2F2ZXBvaW50cy5zaXplKCkgPiAwKSB7DQogICAgICAg\nICAgICBzYXZlID0NCiAgICAgICAgICAgICAgICAoT3BlbkpQQVNhdmVwb2lu\ndCkgX3NhdmVwb2ludHMucmVtb3ZlKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEp\nOw0KICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsNCiAgICAgICAg\nfQ0KICAgICAgICBfc2F2ZXBvaW50cyA9IG51bGw7DQogICAgICAgIF9zYXZl\ncG9pbnRDYWNoZSA9IG51bGw7DQoNCiAgICAgICAgLy8gZmlyZSBhZnRlciBz\ndGF0ZSBjaGFuZ2UgZXZlbnQNCiAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFu\nYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkNCiAgICAgICAgICAgIGZpcmVUcmFu\nc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsIFRyYW5z\nYWN0aW9uRXZlbnQuDQogICAgICAgICAgICAgICAgQUZURVJfU1RBVEVfVFJB\nTlNJVElPTlMsIG1vYmpzLCBudWxsLCBudWxsLCBudWxsKSk7DQoNCiAgICAg\nICAgLy8gbm93IGNsZWFyIHRyYW5zIGNhY2hlOyBrZWVwIGNsZWFyZWQgdmVy\nc2lvbiByYXRoZXIgdGhhbg0KICAgICAgICAvLyBudWxsIHRvIGF2b2lkIGhh\ndmluZyB0byByZS1jcmVhdGUgdGhlIHNldCBsYXRlcjsgbW9yZSBlZmZpY2ll\nbnQNCiAgICAgICAgaWYgKHRyYW5zU3RhdGVzICE9IENvbGxlY3Rpb25zLkVN\nUFRZX0xJU1QpIHsNCiAgICAgICAgICAgIF90cmFuc0NhY2hlID0gKFRyYW5z\nYWN0aW9uYWxDYWNoZSkgdHJhbnNTdGF0ZXM7DQogICAgICAgICAgICBfdHJh\nbnNDYWNoZS5jbGVhcigpOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhyb3dO\nZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgdHJ1ZSk7DQogICAgfQ0KDQogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBPYmplY3QgbGlmZWN5Y2xl\nDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIHB1YmxpYyB2b2lk\nIHBlcnNpc3QoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAg\nICAgICBwZXJzaXN0KG9iaiwgbnVsbCwgdHJ1ZSwgY2FsbCk7DQogICAgfQ0K\nDQogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgcGVyc2lzdChPYmpl\nY3Qgb2JqLCBPYmplY3QgaWQsDQogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsNCiAgICAgICAgcmV0dXJuIHBlcnNpc3Qob2JqLCBpZCwgdHJ1ZSwgY2Fs\nbCk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgcGVyc2lzdEFsbChDb2xs\nZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgcGVy\nc2lzdEFsbChvYmpzLCB0cnVlLCBjYWxsKTsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmplY3RzLiAgSW5kaWNhdGUg\nd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0DQogICAgICog\nKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVXUFJPVklTSU9O\nQUwpLg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3RBbGwoQ29s\nbGVjdGlvbiBvYmpzLCBib29sZWFuIGV4cGxpY2l0LCANCiAgICAgICAgT3BD\nYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkp\nDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7DQogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7\nDQoNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAgIHRy\neSB7DQogICAgICAgICAgICAgICAgICAgIHBlcnNpc3QoaXRyLm5leHQoKSwg\nZXhwbGljaXQsIGNhbGwpOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVz\nZXJFeGNlcHRpb24gdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2VwcywgdWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAg\nICAgICAgIH0NCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBJZiB0aGUgZ2l2ZW4gZWxlbWVudCBpcyBub3QgbnVsbCwgYWRk\nIGl0IHRvIHRoZSBnaXZlbiBsaXN0LA0KICAgICAqIGNyZWF0aW5nIHRoZSBs\naXN0IGlmIG5lY2Vzc2FyeS4NCiAgICAgKi8NCiAgICBwcml2YXRlIExpc3Qg\nYWRkKExpc3QgbCwgT2JqZWN0IG8pIHsNCiAgICAgICAgaWYgKG8gPT0gbnVs\nbCkNCiAgICAgICAgICAgIHJldHVybiBsOw0KICAgICAgICBpZiAobCA9PSBu\ndWxsKQ0KICAgICAgICAgICAgbCA9IG5ldyBMaW5rZWRMaXN0KCk7DQogICAg\nICAgIGwuYWRkKG8pOw0KICAgICAgICByZXR1cm4gbDsNCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24gd3JhcHBpbmcgdGhl\nIGdpdmVuIG5lc3RlZCBleGNlcHRpb25zLg0KICAgICAqLw0KICAgIHByaXZh\ndGUgdm9pZCB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoTGlzdCBleGNlcHMsIGJv\nb2xlYW4gZGF0YXN0b3JlKSB7DQogICAgICAgIGlmIChleGNlcHMgPT0gbnVs\nbCB8fCBleGNlcHMuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuOw0K\nICAgICAgICBpZiAoZGF0YXN0b3JlICYmIGV4Y2Vwcy5zaXplKCkgPT0gMSkN\nCiAgICAgICAgICAgIHRocm93IChSdW50aW1lRXhjZXB0aW9uKSBleGNlcHMu\nZ2V0KDApOw0KDQogICAgICAgIGJvb2xlYW4gZmF0YWwgPSBmYWxzZTsNCiAg\nICAgICAgVGhyb3dhYmxlW10gdCA9IChUaHJvd2FibGVbXSkgZXhjZXBzLnRv\nQXJyYXkNCiAgICAgICAgICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5zaXpl\nKCldKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0Lmxlbmd0aDsg\naSsrKSB7DQogICAgICAgICAgICBpZiAodFtpXSBpbnN0YW5jZW9mIE9wZW5K\nUEFFeGNlcHRpb24NCiAgICAgICAgICAgICAgICAmJiAoKE9wZW5KUEFFeGNl\ncHRpb24pIHRbaV0pLmlzRmF0YWwoKSkNCiAgICAgICAgICAgICAgICBmYXRh\nbCA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgT3BlbkpQQUV4Y2VwdGlv\nbiBlcnI7DQogICAgICAgIGlmIChkYXRhc3RvcmUpDQogICAgICAgICAgICBl\ncnIgPSBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5lc3RlZC1leGNl\ncHMiKSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGVyciA9IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhjZXBzIikpOw0KICAg\nICAgICB0aHJvdyBlcnIuc2V0TmVzdGVkVGhyb3dhYmxlcyh0KS5zZXRGYXRh\nbChmYXRhbCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUGVyc2lzdCB0\naGUgZ2l2ZW4gb2JqZWN0LiAgSW5kaWNhdGUgd2hldGhlciB0aGlzIHdhcyBh\nbiBleHBsaWNpdCBwZXJzaXN0DQogICAgICogKFBORVcpIG9yIGEgcHJvdmlz\nb25hbCBwZXJzaXN0IChQTkVXUFJPVklTSU9OQUwpDQogICAgICovDQogICAg\ncHVibGljIHZvaWQgcGVyc2lzdChPYmplY3Qgb2JqLCBib29sZWFuIGV4cGxp\nY2l0LCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIHBlcnNpc3Qob2Jq\nLCBudWxsLCBleHBsaWNpdCwgY2FsbCk7DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0LiAgSW5kaWNhdGUgd2hl\ndGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0DQogICAgICogKFBO\nRVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVXUFJPVklTSU9OQUwp\nLg0KICAgICAqIFNlZSB7QGxpbmsgQnJva2VyfSBmb3IgZGV0YWlscyBvbiB0\naGlzIG1ldGhvZC4NCiAgICAgKi8NCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRl\nTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVjdCBpZCwgYm9vbGVh\nbiBleHBsaWNpdCwNCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgew0KICAg\nICAgICBpZiAob2JqID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7DQoN\nCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1h\nbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7DQogICAgICAgICAgICBpZiAoIV9vcGVy\nYXRpbmcuYWRkKG9iaikpDQogICAgICAgICAgICAgICAgcmV0dXJuIHNtOw0K\nDQogICAgICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9w\nQ2FsbGJhY2tzLk9QX1BFUlNJU1QsIG9iaiwgc20sIGNhbGwpOw0KICAgICAg\nICAgICAgaWYgKGFjdGlvbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkNCiAg\nICAgICAgICAgICAgICByZXR1cm4gc207DQoNCiAgICAgICAgICAgIC8vIEFD\nVF9DQVNDQURFDQogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJh\nY2tzLkFDVF9SVU4pID09IDApIHsNCiAgICAgICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNp\nc3QoY2FsbCk7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAg\nICAgICAgICBjYXNjYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tzLk9QX1BFUlNJ\nU1QsIG9iaiwgY2FsbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICJwZXJz\naXN0Iik7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNtOw0KICAgICAgICAg\nICAgfQ0KDQogICAgICAgICAgICAvLyBBQ1RfUlVODQogICAgICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGM7DQogICAgICAgICAgICBpZiAoc20gIT0g\nbnVsbCkgew0KICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkp\nDQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3RFeGlzdHNF\neGNlcHRpb24oX2xvYy5nZXQNCiAgICAgICAgICAgICAgICAgICAgICAgICgi\ncGVyc2lzdC1kZXRhY2hlZCIsIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkp\nLg0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9i\naik7DQoNCiAgICAgICAgICAgICAgICBpZiAoIXNtLmlzRW1iZWRkZWQoKSkg\new0KICAgICAgICAgICAgICAgICAgICBzbS5wZXJzaXN0KCk7DQogICAgICAg\nICAgICAgICAgICAgIF9jYWNoZS5wZXJzaXN0KHNtKTsNCiAgICAgICAgICAg\nICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FE\nRSkgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQ\nZXJzaXN0KGNhbGwpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc207\nDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gYW4g\nZW1iZWRkZWQgZmllbGQ7IG5vdGlmeSB0aGUgb3duZXIgdGhhdCB0aGUgdmFs\ndWUgaGFzDQogICAgICAgICAgICAgICAgLy8gY2hhbmdlZCBieSBiZWNvbWlu\nZyBpbmRlcGVuZGVudGx5IHBlcnNpc3RlbnQNCiAgICAgICAgICAgICAgICBz\nbS5nZXRPd25lcigpLmRpcnR5KHNtLmdldE93bmVySW5kZXgoKSk7DQogICAg\nICAgICAgICAgICAgX2NhY2hlLnBlcnNpc3Qoc20pOw0KICAgICAgICAgICAg\nICAgIHBjID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7DQogICAgICAg\nICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHBjID0gYXNzZXJ0UGVy\nc2lzdGVuY2VDYXBhYmxlKG9iaik7DQogICAgICAgICAgICAgICAgaWYgKHBj\nLnBjSXNEZXRhY2hlZCgpID09IEJvb2xlYW4uVFJVRSkNCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9j\nLmdldA0KICAgICAgICAgICAgICAgICAgICAgICAgKCJwZXJzaXN0LWRldGFj\naGVkIiwgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSkuDQogICAgICAgICAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qob2JqKTsNCiAgICAgICAg\nICAgIH0NCg0KICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2Nv\nbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4NCiAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwg\ndHJ1ZSk7DQogICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQob2JqLCBu\ndWxsLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5CRUZPUkVfUEVSU0lTVCk7DQoN\nCiAgICAgICAgICAgIC8vIGNyZWF0ZSBpZCBmb3IgaW5zdGFuY2UNCiAgICAg\nICAgICAgIGlmIChpZCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgaWYg\nKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9B\nUFBMSUNBVElPTikNCiAgICAgICAgICAgICAgICAgICAgaWQgPSBBcHBsaWNh\ndGlvbklkcy5jcmVhdGUocGMsIG1ldGEpOw0KICAgICAgICAgICAgICAgIGVs\nc2UgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5JRF9VTktOT1dOKQ0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBtZXRh\nKSk7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAg\nICBpZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOw0KICAg\nICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgZG9u\nJ3QgYWxyZWFkeSBoYXZlIHRoZSBpbnN0YW5jZSBjYWNoZWQNCiAgICAgICAg\nICAgIGNoZWNrRm9yRHVwbGljYXRlSWQoaWQsIG9iaik7DQoNCiAgICAgICAg\nICAgIC8vIGlmIGhhZCBlbWJlZGRlZCBzbSwgbnVsbCBpdA0KICAgICAgICAg\nICAgaWYgKHNtICE9IG51bGwpDQogICAgICAgICAgICAgICAgcGMucGNSZXBs\nYWNlU3RhdGVNYW5hZ2VyKG51bGwpOw0KDQogICAgICAgICAgICAvLyBjcmVh\ndGUgbmV3IHNtDQogICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJ\nbXBsKGlkLCBtZXRhLCB0aGlzKTsNCiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpICE9IDApIHsNCiAgICAgICAgICAgICAgICBpZiAo\nZXhwbGljaXQpDQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUo\ncGMsIFBDU3RhdGUuUE5FVyk7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAg\nICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlBO\nRVdQUk9WSVNJT05BTCk7DQogICAgICAgICAgICB9IGVsc2UNCiAgICAgICAg\nICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlBOT05UUkFOU05F\nVyk7DQogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFD\nVF9DQVNDQURFKSAhPSAwKQ0KICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQ\nZXJzaXN0KGNhbGwpOw0KICAgICAgICAgICAgcmV0dXJuIHNtOw0KICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAg\nICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBUZW1wb3JhcmlseSBtYW5hZ2UgdGhlIGdpdmVuIGluc3RhbmNlIGlu\nIG9yZGVyIHRvIGNhc2NhZGUgdGhlIGdpdmVuDQogICAgICogb3BlcmF0aW9u\nIHRocm91Z2ggaXQuDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGNhc2Nh\nZGVUcmFuc2llbnQoaW50IG9wLCBPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBj\nYWxsLA0KICAgICAgICBTdHJpbmcgZXJyT3ApIHsNCiAgICAgICAgUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjID0gYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9i\naik7DQoNCiAgICAgICAgLy8gaWYgdXNpbmcgZGV0YWNoZWQgc3RhdGUgbWFu\nYWdlciwgZG9uJ3QgcmVwbGFjZQ0KICAgICAgICBpZiAocGMucGNHZXRTdGF0\nZU1hbmFnZXIoKSAhPSBudWxsKQ0KICAgICAgICAgICAgdGhyb3cgbmV3RGV0\nYWNoZWRFeGNlcHRpb24ob2JqLCBlcnJPcCk7DQoNCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKS4NCiAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFz\ncygpLCBfbG9hZGVyLCB0cnVlKTsNCiAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKFN0YXRlTWFuYWdlcklkLg0K\nICAgICAgICAgICAgbmV3SW5zdGFuY2UodGhpcyksIG1ldGEsIHRoaXMpOw0K\nICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlRMT0FERUQpOw0K\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgc3dpdGNoIChvcCkgew0KICAg\nICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfUEVSU0lTVDoNCiAg\nICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7DQog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNh\nc2UgT3BDYWxsYmFja3MuT1BfREVMRVRFOg0KICAgICAgICAgICAgICAgICAg\nICBzbS5jYXNjYWRlRGVsZXRlKGNhbGwpOw0KICAgICAgICAgICAgICAgICAg\nICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9Q\nX1JFRlJFU0g6DQogICAgICAgICAgICAgICAgICAgIHNtLmdhdGhlckNhc2Nh\nZGVSZWZyZXNoKGNhbGwpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsN\nCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2Yo\nb3ApKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmaW5h\nbGx5IHsNCiAgICAgICAgICAgIHNtLnJlbGVhc2UodHJ1ZSk7DQogICAgICAg\nIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBkZWxldGVBbGwoQ29sbGVj\ndGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsNCg0KICAgICAgICAgICAgTGlzdCBl\neGNlcHMgPSBudWxsOw0KICAgICAgICAgICAgT2JqZWN0IG9iajsNCiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAg\nICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7DQogICAgICAgICAg\nICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAg\nICAgICAgIGRlbGV0ZShvYmosIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0\ncnVlKSwgY2FsbCk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4\nY2VwdGlvbiB1ZSkgew0KICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBh\nZGQoZXhjZXBzLCB1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAg\nICAgfQ0KICAgICAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2Vw\ncywgZmFsc2UpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCBkZWxldGUoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkg\new0KICAgICAgICBpZiAob2JqID09IG51bGwpDQogICAgICAgICAgICByZXR1\ncm47DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOw0K\nICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0U3RhdGVNYW5hZ2VySW1wbChv\nYmosIHRydWUpLCBjYWxsKTsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW50ZXJuYWwgZGVsZXRl\nLg0KICAgICAqLw0KICAgIHZvaWQgZGVsZXRlKE9iamVjdCBvYmosIFN0YXRl\nTWFuYWdlckltcGwgc20sIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAg\naWYgKCFfb3BlcmF0aW5nLmFkZChvYmopKQ0KICAgICAgICAgICAgcmV0dXJu\nOw0KDQogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfREVMRVRFLCBvYmosIHNtLCBjYWxsKTsNCiAgICAgICAg\naWYgKGFjdGlvbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkNCiAgICAgICAg\nICAgIHJldHVybjsNCg0KICAgICAgICAvLyBBQ1RfQ0FTQ0FERQ0KICAgICAg\nICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApIHsN\nCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKQ0KICAgICAgICAgICAgICAg\nIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7DQogICAgICAgICAgICBlbHNlDQog\nICAgICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNrcy5P\nUF9ERUxFVEUsIG9iaiwgY2FsbCwgImRlbGV0ZSIpOw0KICAgICAgICAgICAg\ncmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQUNUX1JVTg0KICAg\nICAgICBpZiAoc20gIT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKHNtLmlz\nRGV0YWNoZWQoKSkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hl\nZEV4Y2VwdGlvbihvYmosICJkZWxldGUiKTsNCiAgICAgICAgICAgIGlmICgo\nYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApDQogICAg\nICAgICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxsKTsNCiAgICAgICAg\nICAgIHNtLmRlbGV0ZSgpOw0KICAgICAgICB9IGVsc2UgaWYgKGFzc2VydFBl\ncnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpID09IEJvb2xl\nYW4uVFJVRSkNCiAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0\naW9uKG9iaiwgImRlbGV0ZSIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIFRocm93IGFuIGV4Y2VwdGlvbiBpbmRpY2F0aW5nIHRoYXQgdGhlIGN1cnJl\nbnQgYWN0aW9uIGNhbid0IGJlDQogICAgICogcGVyZm9ybWVkIG9uIGEgZGV0\nYWNoZWQgb2JqZWN0Lg0KICAgICAqLw0KICAgIHByaXZhdGUgT3BlbkpQQUV4\nY2VwdGlvbiBuZXdEZXRhY2hlZEV4Y2VwdGlvbihPYmplY3Qgb2JqLA0KICAg\nICAgICBTdHJpbmcgb3BlcmF0aW9uKSB7DQogICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGV0YWNoZWQtb3AiLCBvcGVy\nYXRpb24sDQogICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikp\nKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsNCiAgICB9DQoNCiAgICBwdWJsaWMg\ndm9pZCByZWxlYXNlQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3Mg\nY2FsbCkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAg\nICAgIHRyeSB7DQogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7DQog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgICAgICAgICByZWxlYXNlKGl0ci5uZXh0KCksIGNhbGwp\nOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUp\nIHsNCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywg\ndWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAg\nICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsN\nCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgcmVs\nZWFzZShPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOw0KICAgICAgICAgICAgaW50IGFjdGlvbiA9\nIHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUxFQVNFLCBvYmos\nIHNtLCBjYWxsKTsNCg0KICAgICAgICAgICAgaWYgKHNtID09IG51bGwpDQog\nICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgaWYgKChhY3Rp\nb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSAhPSAwICYmIHNtLmlzUGVyc2lz\ndGVudCgpKSB7DQogICAgICAgICAgICAgICAgYm9vbGVhbiBwZW5kaW5nID0g\nc20uaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpOw0KICAgICAgICAgICAgICAg\nIHNtLnJlbGVhc2UodHJ1ZSk7DQogICAgICAgICAgICAgICAgaWYgKHBlbmRp\nbmcpDQogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21QZW5kaW5nVHJh\nbnNhY3Rpb24oc20pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAg\nICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAg\nICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMg\nT3BlbkpQQVN0YXRlTWFuYWdlciBlbWJlZChPYmplY3Qgb2JqLCBPYmplY3Qg\naWQsDQogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb3duZXIsIFZhbHVl\nTWV0YURhdGEgb3duZXJNZXRhKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBvcmlnID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUp\nOw0KICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkgew0KICAgICAgICAg\nICAgICAgIC8vIGlmIGFscmVhZHkgZW1iZWRkZWQsIG5vdGhpbmcgdG8gZG8N\nCiAgICAgICAgICAgICAgICBpZiAob3JpZy5nZXRPd25lcigpID09IG93bmVy\nICYmIG9yaWcuZ2V0TWV0YURhdGEoKS4NCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RW1iZWRkaW5nTWV0YURhdGEoKSA9PSBvd25lck1ldGEpDQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBvcmlnOw0KDQogICAgICAgICAgICAgICAg\nLy8gb3RoZXJ3aXNlIG1ha2Ugc3VyZSBwYyBpcyBmdWxseSBsb2FkZWQgZm9y\nIHdoZW4gd2UgY29weSBpdHMNCiAgICAgICAgICAgICAgICAvLyBkYXRhIGJl\nbG93DQogICAgICAgICAgICAgICAgb3JpZy5sb2FkKF9mYywgU3RhdGVNYW5h\nZ2VySW1wbC5MT0FEX0FMTCwgbnVsbCwgbnVsbCwgZmFsc2UpOw0KICAgICAg\nICAgICAgfQ0KDQogICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHN0YXRlIG1h\nbmFnZXIgd2l0aCBlbWJlZGRlZCBtZXRhZGF0YQ0KICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gb3duZXJNZXRhLmdldEVtYmVkZGVkTWV0YURh\ndGEoKTsNCiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwpDQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtZW1iZWQiLCBvd25lck1ldGEpKTsNCg0KICAgICAgICAgICAgaWYg\nKGlkID09IG51bGwpDQogICAgICAgICAgICAgICAgaWQgPSBTdGF0ZU1hbmFn\nZXJJZC5uZXdJbnN0YW5jZSh0aGlzKTsNCg0KICAgICAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKGlkLCBtZXRh\nLCB0aGlzKTsNCiAgICAgICAgICAgIHNtLnNldE93bmVyKChTdGF0ZU1hbmFn\nZXJJbXBsKSBvd25lciwgb3duZXJNZXRhKTsNCg0KICAgICAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIGNvcHk7DQogICAgICAgICAgICBQQ1N0YXRlIHN0\nYXRlOw0KICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpOw0KICAgICAgICAgICAgaWYgKG9iaiAhPSBudWxsKSB7DQog\nICAgICAgICAgICAgICAgLy8gZ2l2ZSBjb3B5IGFuZCB0aGUgb3JpZ2luYWwg\naW5zdGFuY2UgdGhlIHNhbWUgc3RhdGUgbWFuYWdlcg0KICAgICAgICAgICAg\nICAgIC8vIHNvIHRoYXQgd2UgY2FuIGNvcHkgZmllbGRzIGZyb20gb25lIHRv\nIHRoZSBvdGhlcg0KICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nY29weVNNOw0KICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYzsNCiAgICAgICAgICAgICAgICBpZiAob3JpZyA9PSBudWxsKSB7DQogICAg\nICAgICAgICAgICAgICAgIGNvcHlTTSA9IHNtOw0KICAgICAgICAgICAgICAg\nICAgICBwYyA9IGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopOw0KICAg\nICAgICAgICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIoc20p\nOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAg\nICAgIGNvcHlTTSA9IG9yaWc7DQogICAgICAgICAgICAgICAgICAgIHBjID0g\nb3JpZy5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsNCiAgICAgICAgICAgICAg\nICB9DQoNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAg\nICAgICAvLyBjb3B5IHRoZSBpbnN0YW5jZS4gIHdlIGRvIHRoaXMgZXZlbiBp\nZiBpdCBkb2Vzbid0IGFscmVhZHkNCiAgICAgICAgICAgICAgICAgICAgLy8g\naGF2ZSBhIHN0YXRlIG1hbmFnZXIgaW4gY2FzZSBpdCBpcyBsYXRlciBhc3Np\nZ25lZCB0byBhDQogICAgICAgICAgICAgICAgICAgIC8vIFBDIGZpZWxkOyBh\ndCB0aGF0IHBvaW50IGl0J3MgdG9vIGxhdGUgdG8gY29weQ0KICAgICAgICAg\nICAgICAgICAgICBjb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZSh0eXBl\nLCBjb3B5U00sIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgaW50W10g\nZmllbGRzID0gbmV3IGludFttZXRhLmdldEZpZWxkcygpLmxlbmd0aF07DQog\nICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRz\nLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRz\nW2ldID0gaTsNCiAgICAgICAgICAgICAgICAgICAgY29weS5wY0NvcHlGaWVs\nZHMocGMsIGZpZWxkcyk7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0g\nUENTdGF0ZS5FQ09QWTsNCiAgICAgICAgICAgICAgICAgICAgY29weS5wY1Jl\ncGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7DQogICAgICAgICAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGluc3Rh\nbmNlIGRpZG4ndCBoYXZlIGEgc3RhdGUgbWFuYWdlciB0byBzdGFydCwNCiAg\nICAgICAgICAgICAgICAgICAgLy8gcmV2ZXJ0IGl0IHRvIGJlaW5nIHRyYW5z\naWVudA0KICAgICAgICAgICAgICAgICAgICBpZiAob3JpZyA9PSBudWxsKQ0K\nICAgICAgICAgICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5h\nZ2VyKG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0g\nZWxzZSB7DQogICAgICAgICAgICAgICAgY29weSA9IFBDUmVnaXN0cnkubmV3\nSW5zdGFuY2UodHlwZSwgc20sIGZhbHNlKTsNCiAgICAgICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwICYmICFfb3B0aW1pc3Rp\nYykNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBQQ1N0YXRlLkVDTEVB\nTjsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAg\nIHN0YXRlID0gUENTdGF0ZS5FTk9OVFJBTlM7DQogICAgICAgICAgICB9DQoN\nCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoY29weSwgc3RhdGUpOw0KICAg\nICAgICAgICAgcmV0dXJuIHNtOw0KICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAgICAgICB9\nIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAg\nICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJZiBub3QgYWxyZWFk\neSBjYWNoZWQsIGNyZWF0ZSBhbiBlbXB0eSBjb3B5IG9mIHRoZSBnaXZlbiBz\ndGF0ZQ0KICAgICAqIG1hbmFnZXIgaW4gdGhlIGdpdmVuIHN0YXRlLg0KICAg\nICAqLw0KICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgY29weShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIGNvcHksIFBDU3RhdGUgc3RhdGUpIHsNCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAg\nICBhc3NlcnRPcGVuKCk7DQogICAgICAgICAgICBPYmplY3Qgb2lkID0gY29w\neS5mZXRjaE9iamVjdElkKCk7DQogICAgICAgICAgICBDbGFzcyB0eXBlID0g\nY29weS5nZXRNYW5hZ2VkSW5zdGFuY2UoKS5nZXRDbGFzcygpOw0KICAgICAg\nICAgICAgaWYgKG9pZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOw0KICAgICAgICAgICAgLy8gY2Fj\naGVkIGluc3RhbmNlPw0KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IG51bGw7DQogICAgICAgICAgICBpZiAoIWNvcHkuaXNFbWJlZGRlZCgp\nKQ0KICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5\nSWQob2lkLCB0cnVlKTsNCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7\nDQogICAgICAgICAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0g\nX2NvbmYuDQogICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3Np\ndG9yeUluc3RhbmNlKCk7DQogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEodHlwZSwgX2xvYWRlciwgdHJ1\nZSk7DQogICAgICAgICAgICAgICAgLy8gY29uc3RydWN0IGEgbmV3IHN0YXRl\nIG1hbmFnZXIgd2l0aCBhbGwgaW5mbyBrbm93bg0KICAgICAgICAgICAgICAg\nIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwob2lkLCBtZXRhLCB0aGlzKTsN\nCiAgICAgICAgICAgICAgICBzbS5zZXRPYmplY3RJZChvaWQpOw0KICAgICAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXRE\nZXNjcmliZWRUeXBlKCksIHN0YXRlKTsNCiAgICAgICAgICAgIH0NCiAgICAg\nICAgICAgIHJldHVybiBzbTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgcmVmcmVzaEFsbChDb2xsZWN0aW9uIG9ianMsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgp\nKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0\nTm9udHJhbnNhY3Rpb25hbFJlYWQoKTsNCg0KICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQ0KICAgICAgICAgICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKGl0ci5u\nZXh0KCksIGNhbGwpOw0KICAgICAgICAgICAgaWYgKF9vcGVyYXRpbmcuaXNF\nbXB0eSgpKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAg\nIGlmIChfb3BlcmF0aW5nLnNpemUoKSA9PSAxKQ0KICAgICAgICAgICAgICAg\nIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLml0ZXJhdG9yKCkubmV4dCgp\nLCBjYWxsKTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBy\nZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZywgY2FsbCk7DQogICAgICAgIH0g\nZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHJlZnJlc2goT2JqZWN0\nIG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAob2JqID09\nIG51bGwpDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBh\nc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOw0KDQogICAgICAgICAgICBn\nYXRoZXJDYXNjYWRlUmVmcmVzaChvYmosIGNhbGwpOw0KICAgICAgICAgICAg\naWYgKF9vcGVyYXRpbmcuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgICAgIHJl\ndHVybjsNCiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLnNpemUoKSA9PSAx\nKQ0KICAgICAgICAgICAgICAgIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5n\nLml0ZXJhdG9yKCkubmV4dCgpLCBjYWxsKTsNCiAgICAgICAgICAgIGVsc2UN\nCiAgICAgICAgICAgICAgICByZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZywg\nY2FsbCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIEdhdGhlcnMgYWxsIG9iamVjdHMgcmVhY2hhYmxlIHRocm91Z2ggY2Fz\nY2FkZS1yZWZyZXNoIHJlbGF0aW9ucw0KICAgICAqIGludG8gdGhlIG9wZXJh\ndGluZyBzZXQuDQogICAgICovDQogICAgdm9pZCBnYXRoZXJDYXNjYWRlUmVm\ncmVzaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAg\nICAgaWYgKCFfb3BlcmF0aW5nLmFkZChvYmopKQ0KICAgICAgICAgICAgcmV0\ndXJuOw0KDQogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2UpOw0KICAgICAgICBpbnQgYWN0aW9u\nID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9i\naiwgc20sIGNhbGwpOw0KICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJh\nY2tzLkFDVF9DQVNDQURFKSA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuOw0K\nDQogICAgICAgIGlmIChzbSAhPSBudWxsKQ0KICAgICAgICAgICAgc20uZ2F0\naGVyQ2FzY2FkZVJlZnJlc2goY2FsbCk7DQogICAgICAgIGVsc2UNCiAgICAg\nICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1BfUkVGUkVT\nSCwgb2JqLCBjYWxsLCAicmVmcmVzaCIpOw0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aXRoIHRoZSBmdWxsIHNl\ndCBvZiBvYmplY3RzIHJlYWNoYWJsZSB2aWENCiAgICAgKiBjYXNjYWRlLXJl\nZnJlc2ggcmVsYXRpb25zIGZyb20gdGhlIHVzZXItZ2l2ZW4gaW5zdGFuY2Vz\nLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRlcm5h\nbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAg\nICAgTGlzdCBleGNlcHMgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgLy8gY29sbGVjdCBpbnN0YW5jZXMgdGhhdCBuZWVkIGEgcmVmcmVz\naA0KICAgICAgICAgICAgQ29sbGVjdGlvbiBsb2FkID0gbnVsbDsNCiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207DQogICAgICAgICAgICBPYmpl\nY3Qgb2JqOw0KICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAg\nICAgb2JqID0gaXRyLm5leHQoKTsNCiAgICAgICAgICAgICAgICBpZiAob2Jq\nID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQog\nICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgc20g\nPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7DQogICAgICAgICAg\nICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9Q\nX1JFRlJFU0gsIG9iaiwgc20sIGNhbGwpDQogICAgICAgICAgICAgICAgICAg\nICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApDQogICAgICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAgICAgICAgICAgICAgICAg\nICBpZiAoc20gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHNtLmlzRGV0YWNoZWQoKSkNCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNo\nIik7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzbS5iZWZv\ncmVSZWZyZXNoKHRydWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGxvYWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxpc3Qob2Jqcy5zaXplKCkpOw0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsNCiAg\nICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lz\nRGV0YWNoZWQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgPT0gQm9vbGVh\nbi5UUlVFKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0\nYWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOw0KICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAg\nICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOw0KICAgICAg\nICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8g\ncmVmcmVzaCBhbGwNCiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsN\nCiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IF9zdG9yZS5s\nb2FkQWxsKGxvYWQsIG51bGwsDQogICAgICAgICAgICAgICAgICAgIFN0b3Jl\nTWFuYWdlci5GT1JDRV9MT0FEX1JFRlJFU0gsIF9mYywgbnVsbCk7DQogICAg\nICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmICFmYWlsZWQuaXNF\nbXB0eSgpKQ0KICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsNCg0K\nICAgICAgICAgICAgICAgIC8vIHBlcmZvcm0gcG9zdC1yZWZyZXNoIHRyYW5z\naXRpb25zIGFuZCBtYWtlIHN1cmUgYWxsIGZldGNoDQogICAgICAgICAgICAg\nICAgLy8gZ3JvdXAgZmllbGRzIGFyZSBsb2FkZWQNCiAgICAgICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGxvYWQuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICAgICAgc20gPSAoU3RhdGVN\nYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsNCiAgICAgICAgICAgICAgICAgICAg\naWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJ\nZCgpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQog\nICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAg\nICAgICBzbS5hZnRlclJlZnJlc2goKTsNCiAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBu\ndWxsLCBudWxsLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxz\nZSk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZChleGNlcHMsIGtlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAg\nICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAg\nLy8gbm93IGludm9rZSBwb3N0UmVmcmVzaCBvbiBhbGwgdGhlIGluc3RhbmNl\ncw0KICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKGl0ci5uZXh0KCksIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICBp\nZiAoc20gIT0gbnVsbCAmJiAhc20uaXNEZXRhY2hlZCgpKQ0KICAgICAgICAg\nICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpLCBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLmdldE1ldGFEYXRhKCksIExpZmVjeWNsZUV2ZW50LkFGVEVSX1JF\nRlJFU0gpOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2Vwcywga2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg\nIH0NCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0K\nICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfQ0KICAgICAgICB0aHJvd05l\nc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogT3B0aW1pemF0aW9uIGZvciBzaW5nbGUtb2JqZWN0IHJl\nZnJlc2guDQogICAgICovDQogICAgcHJvdGVjdGVkIHZvaWQgcmVmcmVzaElu\ndGVybmFsKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7DQogICAgICAgICAgICBp\nZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUZSRVNILCBv\nYmosIHNtLCBjYWxsKQ0KICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3Mu\nQUNUX1JVTikgPT0gMCkNCiAgICAgICAgICAgICAgICByZXR1cm47DQoNCiAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAg\naWYgKHNtLmlzRGV0YWNoZWQoKSkNCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOw0KICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKHNtLmJlZm9yZVJlZnJlc2goZmFsc2Up\nKSB7DQogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7DQogICAg\nICAgICAgICAgICAgICAgIHNtLmFmdGVyUmVmcmVzaCgpOw0KICAgICAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQo\nc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsDQogICAgICAgICAgICAg\nICAgICAgIHNtLmdldE1ldGFEYXRhKCksIExpZmVjeWNsZUV2ZW50LkFGVEVS\nX1JFRlJFU0gpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJz\naXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQ0KICAgICAgICAg\nICAgICAgID09IEJvb2xlYW4uVFJVRSkNCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7DQogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAg\nICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9p\nZCByZXRyaWV2ZUFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZGZnT25s\neSwNCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAo\nb2Jqcy5pc0VtcHR5KCkpDQogICAgICAgICAgICByZXR1cm47DQogICAgICAg\nIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7DQogICAgICAgICAgICByZXRyaWV2\nZShvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCBkZmdPbmx5LCBjYWxsKTsNCiAg\nICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIExpc3Qg\nZXhjZXBzID0gbnVsbDsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRPcGVuKCk7DQog\nICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOw0KDQog\nICAgICAgICAgICAvLyBjb2xsZWN0IGFsbCBob2xsb3cgaW5zdGFuY2VzIGZv\nciBsb2FkDQogICAgICAgICAgICBPYmplY3Qgb2JqOw0KICAgICAgICAgICAg\nQ29sbGVjdGlvbiBsb2FkID0gbnVsbDsNCiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc207DQogICAgICAgICAgICBDb2xsZWN0aW9uIHNtcyA9IG5l\ndyBBcnJheUxpc3Qob2Jqcy5zaXplKCkpOw0KICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7DQogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsNCiAgICAg\nICAgICAgICAgICBpZiAob2JqID09IG51bGwpDQogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAg\nICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwg\ndHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZFLCBvYmosIHNtLCBjYWxsKQ0K\nICAgICAgICAgICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVO\nKSA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoN\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsNCiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpDQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNl\ncHRpb24ob2JqLCAicmV0cmlldmUiKTsNCiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgew0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHNtcy5hZGQoc20pOw0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xM\nT1cpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxv\nYWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxvYWQgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsNCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQog\nICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVu\nY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkNCiAgICAgICAgICAgICAg\nICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkNCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJldHJp\nZXZlIik7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlv\nbiB1ZSkgew0KICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCB1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0K\nDQogICAgICAgICAgICAvLyBsb2FkIGFsbCBob2xsb3cgaW5zdGFuY2VzDQog\nICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IG51bGw7DQogICAgICAg\nICAgICBpZiAobG9hZCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgaW50\nIG1vZGUgPSAoZGZnT25seSkgPyBfc3RvcmUuRk9SQ0VfTE9BRF9ERkcNCiAg\nICAgICAgICAgICAgICAgICAgOiBfc3RvcmUuRk9SQ0VfTE9BRF9BTEw7DQog\nICAgICAgICAgICAgICAgZmFpbGVkID0gX3N0b3JlLmxvYWRBbGwobG9hZCwg\nbnVsbCwgbW9kZSwgX2ZjLCBudWxsKTsNCiAgICAgICAgICAgICAgICBpZiAo\nZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpDQogICAgICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIG5ld09iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uKGZhaWxlZCkpOw0KICAgICAgICAgICAgfQ0KDQog\nICAgICAgICAgICAvLyByZXRyaWV2ZSBhbGwgbm9uLWZhaWxlZCBpbnN0YW5j\nZXMNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAgc20g\nPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsNCiAgICAgICAgICAg\nICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRhaW5zKHNt\nLmdldElkKCkpKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0K\nICAgICAgICAgICAgICAgIGludCBtb2RlID0gKGRmZ09ubHkpID8gU3RhdGVN\nYW5hZ2VySW1wbC5MT0FEX0ZHUw0KICAgICAgICAgICAgICAgICAgICA6IFN0\nYXRlTWFuYWdlckltcGwuTE9BRF9BTEw7DQogICAgICAgICAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgICAgICAgICAgc20uYmVmb3JlUmVhZCgtMSk7DQog\nICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2RlLCBudWxsLCBu\ndWxsLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCBrZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkgew0K\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICAg\nICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOw0KICAg\nIH0NCg0KICAgIHB1YmxpYyB2b2lkIHJldHJpZXZlKE9iamVjdCBvYmosIGJv\nb2xlYW4gZGZnT25seSwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBp\nZiAob2JqID09IG51bGwpDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAg\nICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgICAgICBhc3NlcnROb250\ncmFuc2FjdGlvbmFsUmVhZCgpOw0KDQogICAgICAgICAgICBTdGF0ZU1hbmFn\nZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOw0K\nICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwpDQogICAgICAgICAgICAgICAg\nJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQ0KICAgICAgICAgICAgICAg\nIHJldHVybjsNCg0KICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsNCiAg\nICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQ0KICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJy\nZXRyaWV2ZSIpOw0KICAgICAgICAgICAgICAgIGlmIChzbS5pc1BlcnNpc3Rl\nbnQoKSkgew0KICAgICAgICAgICAgICAgICAgICBpbnQgbW9kZSA9IChkZmdP\nbmx5KSA/IFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MNCiAgICAgICAgICAg\nICAgICAgICAgICAgIDogU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsNCiAg\nICAgICAgICAgICAgICAgICAgc20uYmVmb3JlUmVhZCgtMSk7DQogICAgICAg\nICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2RlLCBudWxsLCBudWxsLCBm\nYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNl\nIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNo\nZWQoKQ0KICAgICAgICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkNCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJy\nZXRyaWV2ZSIpOw0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkg\new0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgdm9pZCBldmljdEFsbChPcENhbGxiYWNrcyBj\nYWxsKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIGV2aWN0IGFsbCBQQ2xlYW4gYW5k\nIFBOb25UcmFucyBvYmplY3RzDQogICAgICAgICAgICBDb2xsZWN0aW9uIGMg\nPSBnZXRNYW5hZ2VkU3RhdGVzKCk7DQogICAgICAgICAgICBTdGF0ZU1hbmFn\nZXJJbXBsIHNtOw0KICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBj\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAg\nICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsNCiAgICAg\nICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkgJiYgIXNtLmlzRGly\ndHkoKSkNCiAgICAgICAgICAgICAgICAgICAgZXZpY3Qoc20uZ2V0TWFuYWdl\nZEluc3RhbmNlKCksIGNhbGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9\nDQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBldmlj\ndEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAg\nICAgICAgTGlzdCBleGNlcHMgPSBudWxsOw0KICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAg\nICAgICBldmljdChpdHIubmV4dCgpLCBjYWxsKTsNCiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7DQogICAgICAgICAgICAg\nICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsNCiAgICAgICAgICAg\nICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZmluYWxseSB7DQog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgICAg\nICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7DQogICAg\nfQ0KDQogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoRXh0ZW50IGV4dGVudCwg\nT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAoZXh0ZW50ID09IG51\nbGwpDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgLy8g\nZXZpY3QgYWxsIFBDbGVhbiBhbmQgUE5vblRyYW5zIG9iamVjdHMgaW4gZXh0\nZW50DQogICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSBnZXRNYW5hZ2VkU3Rh\ndGVzKCk7DQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAg\nICAgICAgICAgQ2xhc3MgY2xzOw0KICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAg\nICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQo\nKTsNCiAgICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkgJiYg\nIXNtLmlzRGlydHkoKSkgew0KICAgICAgICAgICAgICAgICAgICBjbHMgPSBz\nbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKTsNCiAgICAgICAg\nICAgICAgICAgICAgaWYgKGNscyA9PSBleHRlbnQuZ2V0RWxlbWVudFR5cGUo\nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGV4dGVudC5oYXNTdWJj\nbGFzc2VzKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICYmIGV4dGVudC5n\nZXRFbGVtZW50VHlwZSgpLmlzQXNzaWduYWJsZUZyb20oY2xzKSkpDQogICAg\nICAgICAgICAgICAgICAgICAgICBldmljdChzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSwgY2FsbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAg\nfQ0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBl\ndmljdChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOw0KICAgICAgICAgICAgaWYgKChwcm9jZXNz\nQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfRVZJQ1QsIG9iaiwgc20sIGNhbGwp\nDQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAw\nKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIGlmIChz\nbSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAg\nICAgICAgc20uZXZpY3QoKTsNCiAgICAgICAgICAgIGlmIChfZXZpY3REYXRh\nQ2FjaGUgJiYgc20uZ2V0T2JqZWN0SWQoKSAhPSBudWxsKSB7DQogICAgICAg\nICAgICAgICAgRGF0YUNhY2hlIGNhY2hlID0gc20uZ2V0TWV0YURhdGEoKS5n\nZXREYXRhQ2FjaGUoKTsNCiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgIT0g\nbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlKHNtLmdl\ndE9iamVjdElkKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAg\nICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAg\nICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMg\nT2JqZWN0IGRldGFjaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7\nDQogICAgICAgIGlmIChvYmogPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOw0KICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQ0KICAgICAgICAg\nICAgY2FsbCA9IF9jYWxsOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRy\ndWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBE\nZXRhY2hNYW5hZ2VyKHRoaXMsIGZhbHNlLCBjYWxsKS5kZXRhY2gob2JqKTsN\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAg\nICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\ncHVibGljIE9iamVjdFtdIGRldGFjaEFsbChDb2xsZWN0aW9uIG9ianMsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9ianMgPT0gbnVsbCkN\nCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICBpZiAob2Jqcy5p\nc0VtcHR5KCkpDQogICAgICAgICAgICByZXR1cm4gRU1QVFlfT0JKRUNUUzsN\nCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkNCiAgICAgICAgICAgIGNhbGwg\nPSBfY2FsbDsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAg\nICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNoTWFu\nYWdlcih0aGlzLCBmYWxzZSwgY2FsbCkuZGV0YWNoQWxsKG9ianMpOw0KICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAg\nICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCBkZXRhY2hBbGwoT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAg\nICBkZXRhY2hBbGwoY2FsbCwgdHJ1ZSk7DQogICAgfQ0KDQogICAgcHVibGlj\nIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNhbGwsIGJvb2xlYW4gZmx1\nc2gpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICAvLyBJZiBhIGZsdXNoIGlzIGRlc2lyZWQg\nKGJhc2VkIG9uIGlucHV0IHBhcm0pLCB0aGVuIGNoZWNrIGlmIHRoZQ0KICAg\nICAgICAgICAgLy8gICAiZGlydHkiIGZsYWcgaXMgc2V0IGJlZm9yZSBjYWxs\naW5nIGZsdXNoKCkuDQogICAgICAgICAgICBpZiAoKGZsdXNoKSAmJiAoKF9m\nbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDApKQ0KICAgICAgICAg\nICAgICAgIGZsdXNoKCk7DQogICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5h\nbChjYWxsKTsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2gg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFsbEludGVybmFsKE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgQ29sbGVjdGlvbiBzdGF0ZXMgPSBn\nZXRNYW5hZ2VkU3RhdGVzKCk7DQogICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc3RhdGVzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICBzbSA9IChT\ndGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOw0KICAgICAgICAgICAgaWYg\nKCFzbS5pc1BlcnNpc3RlbnQoKSkNCiAgICAgICAgICAgICAgICBpdHIucmVt\nb3ZlKCk7DQogICAgICAgICAgICBlbHNlIGlmICghc20uZ2V0TWV0YURhdGEo\nKS5pc0RldGFjaGFibGUoKSkgew0KICAgICAgICAgICAgICAgIHNtLnJlbGVh\nc2UodHJ1ZSk7DQogICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOw0KICAg\nICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChzdGF0ZXMuaXNF\nbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIGlmIChj\nYWxsID09IG51bGwpDQogICAgICAgICAgICBjYWxsID0gX2NhbGw7DQogICAg\nICAgIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIHRydWUsIGNhbGwpLmRldGFj\naEFsbA0KICAgICAgICAgICAgKG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlv\nbihzdGF0ZXMpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGF0dGFj\naChPYmplY3Qgb2JqLCBib29sZWFuIGNvcHlOZXcsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsNCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAg\ncmV0dXJuIG51bGw7DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAvLyBtYWtlIHN1cmUgbm90\nIHRvIHRyeSB0byBzZXQgcm9sbGJhY2sgb25seSBpZiB0aGlzIGZhaWxzDQog\nICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOw0KICAgICAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFjaE1h\nbmFnZXIodGhpcywgY29weU5ldywgY2FsbCkuYXR0YWNoKG9iaik7DQogICAg\nICAgICAgICB9IGNhdGNoIChPcHRpbWlzdGljRXhjZXB0aW9uIG9lKSB7DQog\nICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG9lKTsNCiAgICAgICAg\nICAgICAgICB0aHJvdyBvZS5zZXRGYXRhbCh0cnVlKTsNCiAgICAgICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAg\nICAgICB0aHJvdyBrZTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0N\nCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3RbXSBh\ndHRhY2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIGNvcHlOZXcsDQog\nICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9ianMg\nPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICBp\nZiAob2Jqcy5pc0VtcHR5KCkpDQogICAgICAgICAgICByZXR1cm4gRU1QVFlf\nT0JKRUNUUzsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAg\nICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBub3QgdG8g\ndHJ5IHRvIHNldCByb2xsYmFjayBvbmx5IGlmIHRoaXMgZmFpbHMNCiAgICAg\nICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7DQogICAgICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNoTWFuYWdl\ncih0aGlzLCBjb3B5TmV3LCBjYWxsKS5hdHRhY2hBbGwob2Jqcyk7DQogICAg\nICAgICAgICB9IGNhdGNoIChPcHRpbWlzdGljRXhjZXB0aW9uIG9lKSB7DQog\nICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG9lKTsNCiAgICAgICAg\nICAgICAgICB0aHJvdyBvZS5zZXRGYXRhbCh0cnVlKTsNCiAgICAgICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAg\nICAgICB0aHJvdyBrZTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0N\nCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIG5vbnRy\nYW5zYWN0aW9uYWxBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBj\nYWxsKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOw0KICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgICAgICAgICAgbm9udHJhbnNhY3Rpb25hbChpdHIubmV4dCgp\nLCBjYWxsKTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0\naW9uIHVlKSB7DQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChl\neGNlcHMsIHVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9\nDQogICAgICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBm\nYWxzZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIG5vbnRyYW5zYWN0aW9uYWwoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3Mg\nY2FsbCkgew0KICAgICAgICBpZiAob2JqID09IG51bGwpDQogICAgICAgICAg\nICByZXR1cm47DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOw0KICAgICAgICAg\nICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTk9OVFJB\nTlNBQ1RJT05BTCwgb2JqLCBzbSwgY2FsbCkNCiAgICAgICAgICAgICAgICAm\nIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApDQogICAgICAgICAgICAgICAg\ncmV0dXJuOw0KICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpDQogICAgICAg\nICAgICAgICAgc20ubm9udHJhbnNhY3Rpb25hbCgpOw0KICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJv\ndyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\new0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBN\nYWtlIHRoZSBnaXZlbiBpbnN0YW5jZXMgdHJhbnNhY3Rpb25hbC4NCiAgICAg\nKi8NCiAgICBwdWJsaWMgdm9pZCB0cmFuc2FjdGlvbmFsQWxsKENvbGxlY3Rp\nb24gb2JqcywgYm9vbGVhbiB1cGRhdGVWZXJzaW9uLA0KICAgICAgICBPcENh\nbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkN\nCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgaWYgKG9ianMuc2l6ZSgp\nID09IDEpIHsNCiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwob2Jqcy5pdGVy\nYXRvcigpLm5leHQoKSwgdXBkYXRlVmVyc2lvbiwgY2FsbCk7DQogICAgICAg\nICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIGNv\nbGxlY3QgYWxsIGhvbGxvdyBpbnN0YW5jZXMgZm9yIGxvYWQsIGFuZCBtYWtl\nIHVubWFuYW5nZWQNCiAgICAgICAgICAgIC8vIGluc3RhbmNlcyB0cmFuc2ll\nbnQtdHJhbnNhY3Rpb25hbA0KICAgICAgICAgICAgQ29sbGVjdGlvbiBsb2Fk\nID0gbnVsbDsNCiAgICAgICAgICAgIE9iamVjdCBvYmo7DQogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhOw0KICAgICAgICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcg\nQXJyYXlMaXN0KG9ianMuc2l6ZSgpKTsNCiAgICAgICAgICAgIExpc3QgZXhj\nZXBzID0gbnVsbDsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAgICAg\nICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAgaWYg\nKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsN\nCg0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAg\nIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOw0KICAgICAg\nICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNr\ncy5PUF9UUkFOU0FDVElPTkFMLCBvYmosIHNtLA0KICAgICAgICAgICAgICAg\nICAgICAgICAgY2FsbCkgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQ0K\nICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAg\nICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsNCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIG1hbmFnZSB0cmFuc2llbnQgaW5zdGFuY2UNCiAgICAg\nICAgICAgICAgICAgICAgICAgIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJl\ncG9zaXRvcnlJbnN0YW5jZSgpLg0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVl\nKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVN\nYW5hZ2VySW1wbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChTdGF0\nZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKSwgbWV0YSwgdGhpcyk7DQog\nICAgICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2VydFBl\ncnNpc3RlbmNlQ2FwYWJsZShvYmopLA0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIFBDU3RhdGUuVENMRUFOKTsNCiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgew0KICAgICAgICAgICAg\nICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsNCiAgICAg\nICAgICAgICAgICAgICAgICAgIHNtcy5hZGQoc20pOw0KICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhP\nTExPVykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2Fk\nID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxv\nYWQgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9hZC5hZGQoc20pOw0KICAgICAgICAgICAgICAgICAgICAgICAg\nfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNp\nb24odHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBkYXRl\nVmVyc2lvbikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRV\ncGRhdGVWZXJzaW9uKHRydWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hl\nY2svdXANCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAg\nIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkg\new0KICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1\nZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAg\nICAgICAgICAvLyBsb2FkIGFsbCBob2xsb3cgaW5zdGFuY2VzDQogICAgICAg\nICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IG51bGw7DQogICAgICAgICAgICBp\nZiAobG9hZCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgZmFpbGVkID0g\nX3N0b3JlLmxvYWRBbGwobG9hZCwgbnVsbCwgX3N0b3JlLkZPUkNFX0xPQURf\nTk9ORSwNCiAgICAgICAgICAgICAgICAgICAgX2ZjLCBudWxsKTsNCiAgICAg\nICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0Vt\ncHR5KCkpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNl\ncHMsDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdPYmplY3ROb3RGb3Vu\nZEV4Y2VwdGlvbihmYWlsZWQpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAg\nICAgICAgdHJhbnNhY3Rpb25hbFN0YXRlc0FsbChzbXMsIGZhaWxlZCwgZXhj\nZXBzKTsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\new0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogTWFrZSB0aGUgZ2l2ZW4gaW5zdGFuY2VzIHRy\nYW5zYWN0aW9uYWwuDQogICAgICovDQogICAgcHVibGljIHZvaWQgdHJhbnNh\nY3Rpb25hbChPYmplY3Qgb2JqLCBib29sZWFuIHVwZGF0ZVZlcnNpb24sDQog\nICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9iaiA9\nPSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2Jq\nLCB0cnVlKTsNCiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9w\nQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNhbGwpDQog\nICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQ0K\nICAgICAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICAgICAgaWYgKHNt\nICE9IG51bGwgJiYgc20uaXNQZXJzaXN0ZW50KCkpIHsNCiAgICAgICAgICAg\nICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOw0KICAgICAgICAgICAg\nICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsNCiAgICAgICAgICAgICAgICBzbS5s\nb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywgbnVsbCwgbnVs\nbCwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIHNtLnNldENoZWNrVmVyc2lv\nbih0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAodXBkYXRlVmVyc2lvbikN\nCiAgICAgICAgICAgICAgICAgICAgc20uc2V0VXBkYXRlVmVyc2lvbih0cnVl\nKTsNCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSF9SRVFV\nSVJFRDsgLy8gdmVyc2lvbiBjaGVjay91cA0KICAgICAgICAgICAgfSBlbHNl\nIGlmIChzbSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgLy8gbWFuYWdl\nIHRyYW5zaWVudCBpbnN0YW5jZQ0KICAgICAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCkuDQogICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5n\nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBP\nYmplY3QgaWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKTsN\nCiAgICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKGlk\nLCBtZXRhLCB0aGlzKTsNCiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXpl\nKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLA0KICAgICAgICAgICAg\nICAgICAgICBQQ1N0YXRlLlRDTEVBTik7DQogICAgICAgICAgICB9DQogICAg\nICAgIH0NCiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsN\nCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIFRyYW5zaXRpb24gdGhlIGdpdmVuIHN0YXRlIG1h\nbmFnZXJzIHRvIHRyYW5zYWN0aW9uYWwuDQogICAgICovDQogICAgcHJpdmF0\nZSB2b2lkIHRyYW5zYWN0aW9uYWxTdGF0ZXNBbGwoQ29sbGVjdGlvbiBzbXMs\nIENvbGxlY3Rpb24gZmFpbGVkLA0KICAgICAgICBMaXN0IGV4Y2Vwcykgew0K\nICAgICAgICAvLyBtYWtlIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsIGFuZCBt\nYWtlIHN1cmUgdGhleSBhcmUgbG9hZGVkDQogICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc207DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICBzbSA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOw0KICAgICAgICAgICAg\naWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJ\nZCgpKSkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAgICAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7\nDQogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlcklt\ncGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsNCiAgICAgICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAg\nICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7DQogICAgICAgICAgICB9\nDQogICAgICAgIH0NCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4\nY2VwcywgZmFsc2UpOw0KICAgIH0NCg0KICAgIC8vLy8vLy8vLy8vLy8vLy8v\nDQogICAgLy8gRXh0ZW50LCBRdWVyeQ0KICAgIC8vLy8vLy8vLy8vLy8vLy8v\nDQoNCiAgICBwdWJsaWMgRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBi\nb29sZWFuIHN1YmNsYXNzZXMpIHsNCiAgICAgICAgcmV0dXJuIG5ld0V4dGVu\ndCh0eXBlLCBzdWJjbGFzc2VzLCBudWxsKTsNCiAgICB9DQoNCiAgICBwcml2\nYXRlIEV4dGVudCBuZXdFeHRlbnQoQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJj\nbGFzc2VzLA0KICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsN\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7\nDQogICAgICAgICAgICBFeHRlbnRJbXBsIGV4dGVudCA9IG5ldyBFeHRlbnRJ\nbXBsKHRoaXMsIHR5cGUsIHN1YmNsYXNzZXMsIGZldGNoKTsNCiAgICAgICAg\nICAgIGlmIChfZXh0ZW50cyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIF9l\neHRlbnRzID0gbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNl\ndC5XRUFLKTsNCiAgICAgICAgICAgIF9leHRlbnRzLmFkZChleHRlbnQpOw0K\nDQogICAgICAgICAgICByZXR1cm4gZXh0ZW50Ow0KICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBr\nZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0K\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgSXRlcmF0b3Ig\nZXh0ZW50SXRlcmF0b3IoQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFzc2Vz\nLA0KICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJvb2xlYW4g\naWdub3JlQ2hhbmdlcykgew0KICAgICAgICBFeHRlbnQgZXh0ZW50ID0gbmV3\nRXh0ZW50KHR5cGUsIHN1YmNsYXNzZXMsIGZldGNoKTsNCiAgICAgICAgZXh0\nZW50LnNldElnbm9yZUNoYW5nZXMoaWdub3JlQ2hhbmdlcyk7DQogICAgICAg\nIHJldHVybiBleHRlbnQuaXRlcmF0b3IoKTsNCiAgICB9DQoNCiAgICBwdWJs\naWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIENsYXNzIGNscywgT2Jq\nZWN0IHF1ZXJ5KSB7DQogICAgICAgIFF1ZXJ5IHEgPSBuZXdRdWVyeShsYW5n\nLCBxdWVyeSk7DQogICAgICAgIHEuc2V0Q2FuZGlkYXRlVHlwZShjbHMsIHRy\ndWUpOw0KICAgICAgICByZXR1cm4gcTsNCiAgICB9DQoNCiAgICBwdWJsaWMg\nUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIE9iamVjdCBxdWVyeSkgew0K\nICAgICAgICAvLyBjb21tb24gbWlzdGFrZXMNCiAgICAgICAgaWYgKHF1ZXJ5\nIGluc3RhbmNlb2YgRXh0ZW50IHx8IHF1ZXJ5IGluc3RhbmNlb2YgQ2xhc3Mp\nDQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW5ldy1xdWVyeSIpKTsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBTdG9yZVF1\nZXJ5IHNxID0gX3N0b3JlLm5ld1F1ZXJ5KGxhbmcpOw0KICAgICAgICAgICAg\naWYgKHNxID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBFeHByZXNzaW9u\nUGFyc2VyIGVwID0gUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2Uo\nbGFuZyk7DQogICAgICAgICAgICAgICAgaWYgKGVwICE9IG51bGwpDQogICAg\nICAgICAgICAgICAgICAgIHNxID0gbmV3IEV4cHJlc3Npb25TdG9yZVF1ZXJ5\nKGVwKTsNCiAgICAgICAgICAgICAgICBlbHNlIGlmIChRdWVyeUxhbmd1YWdl\ncy5MQU5HX01FVEhPRFFMLmVxdWFscyhsYW5nKSkNCiAgICAgICAgICAgICAg\nICAgICAgc3EgPSBuZXcgTWV0aG9kU3RvcmVRdWVyeSgpOw0KICAgICAgICAg\nICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKGxhbmcpOw0KICAgICAgICAgICAgfQ0KDQog\nICAgICAgICAgICBRdWVyeSBxID0gbmV3UXVlcnlJbXBsKGxhbmcsIHNxKTsN\nCiAgICAgICAgICAgIHEuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3JlQ2hhbmdl\ncyk7DQogICAgICAgICAgICBpZiAocXVlcnkgIT0gbnVsbCkNCiAgICAgICAg\nICAgICAgICBxLnNldFF1ZXJ5KHF1ZXJ5KTsNCg0KICAgICAgICAgICAgLy8g\ndHJhY2sgcXVlcmllcw0KICAgICAgICAgICAgaWYgKF9xdWVyaWVzID09IG51\nbGwpDQogICAgICAgICAgICAgICAgX3F1ZXJpZXMgPSBuZXcgUmVmZXJlbmNl\nSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOw0KICAgICAgICAgICAg\nX3F1ZXJpZXMuYWRkKHEpOw0KICAgICAgICAgICAgcmV0dXJuIHE7DQogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAg\nICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIENyZWF0ZSBhIG5ldyBxdWVyeS4NCiAgICAgKi8NCiAgICBwcm90\nZWN0ZWQgUXVlcnlJbXBsIG5ld1F1ZXJ5SW1wbChTdHJpbmcgbGFuZywgU3Rv\ncmVRdWVyeSBzcSkgew0KICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5SW1wbCh0\naGlzLCBsYW5nLCBzcSk7DQogICAgfQ0KDQogICAgcHVibGljIFNlcSBnZXRJ\nZGVudGl0eVNlcXVlbmNlKENsYXNzTWV0YURhdGEgbWV0YSkgew0KICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7\nDQogICAgICAgIHJldHVybiBnZXRTZXF1ZW5jZShtZXRhLCBudWxsKTsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgU2VxIGdldFZhbHVlU2VxdWVuY2UoRmllbGRN\nZXRhRGF0YSBmbWQpIHsNCiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQ0KICAg\nICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIHJldHVybiBnZXRTZXF1\nZW5jZShmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLCBmbWQpOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIHNlcXVlbmNlIGZvciB0aGUg\nZ2l2ZW4gY2xhc3MgYW5kIG9wdGlvbmFsIGZpZWxkLg0KICAgICAqLw0KICAg\nIHByaXZhdGUgU2VxIGdldFNlcXVlbmNlKENsYXNzTWV0YURhdGEgbWV0YSwg\nRmllbGRNZXRhRGF0YSBmbWQpIHsNCiAgICAgICAgLy8gZ2V0IHNlcXVlbmNl\nIHN0cmF0ZWd5IGZyb20gbWV0YWRhdGENCiAgICAgICAgaW50IHN0cmF0ZWd5\nOw0KICAgICAgICBpZiAoZm1kID09IG51bGwpDQogICAgICAgICAgICBzdHJh\ndGVneSA9IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpOw0KICAgICAgICBl\nbHNlDQogICAgICAgICAgICBzdHJhdGVneSA9IGZtZC5nZXRWYWx1ZVN0cmF0\nZWd5KCk7DQoNCiAgICAgICAgLy8gd2UgY2FuIGhhbmRsZSBub24tbmF0aXZl\nIHN0cmF0ZWdpZXMgd2l0aG91dCB0aGUgc3RvcmUgbWFuYWdlcg0KICAgICAg\nICBzd2l0Y2ggKHN0cmF0ZWd5KSB7DQogICAgICAgICAgICBjYXNlIFZhbHVl\nU3RyYXRlZ2llcy5VVUlEX0hFWDoNCiAgICAgICAgICAgICAgICByZXR1cm4g\nVVVJREhleFNlcS5nZXRJbnN0YW5jZSgpOw0KICAgICAgICAgICAgY2FzZSBW\nYWx1ZVN0cmF0ZWdpZXMuVVVJRF9TVFJJTkc6DQogICAgICAgICAgICAgICAg\ncmV0dXJuIFVVSURTdHJpbmdTZXEuZ2V0SW5zdGFuY2UoKTsNCiAgICAgICAg\nICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFOg0KICAgICAgICAg\nICAgICAgIFNlcXVlbmNlTWV0YURhdGEgc21kID0gKGZtZCA9PSBudWxsKQ0K\nICAgICAgICAgICAgICAgICAgICA/IG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5j\nZU1ldGFEYXRhKCkNCiAgICAgICAgICAgICAgICAgICAgOiBmbWQuZ2V0VmFs\ndWVTZXF1ZW5jZU1ldGFEYXRhKCk7DQogICAgICAgICAgICAgICAgcmV0dXJu\nIHNtZC5nZXRJbnN0YW5jZShfbG9hZGVyKTsNCiAgICAgICAgICAgIGRlZmF1\nbHQ6DQogICAgICAgICAgICAgICAgLy8gdXNlIHN0b3JlIG1hbmFnZXIgZm9y\nIG5hdGl2ZSBzZXF1ZW5jZQ0KICAgICAgICAgICAgICAgIGlmIChmbWQgPT0g\nbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIHdpbGwgcmV0\ndXJuIGEgc2VxdWVuY2UgZXZlbiBmb3IgYXBwIGlkIGNsYXNzZXMsDQogICAg\nICAgICAgICAgICAgICAgIC8vIHdoaWNoIGlzIHdoYXQgd2Ugd2FudCBmb3Ig\nYmFja3dhcmRzLWNvbXBhdGliaWxpdHkNCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIF9zdG9yZS5nZXREYXRhU3RvcmVJZFNlcXVlbmNlKG1ldGEpOw0K\nICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gX3N0\nb3JlLmdldFZhbHVlU2VxdWVuY2UoZm1kKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIC8vLy8vLy8vLy8vDQogICAgLy8gTG9ja2luZw0KICAgIC8vLy8v\nLy8vLy8vDQoNCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9iamVjdCBvYmosIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQ0K\nICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdheXMg\nTk9ORQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgbG9jayhvYmosIF9m\nYy5nZXRXcml0ZUxvY2tMZXZlbCgpLCBfZmMuZ2V0TG9ja1RpbWVvdXQoKSwg\nY2FsbCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIGxvY2soT2JqZWN0IG9iaiwgaW50IGxldmVsLCBpbnQgdGltZW91dCwg\nT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAob2JqID09IG51bGwp\nDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRB\nY3RpdmVUcmFuc2FjdGlvbigpOw0KDQogICAgICAgICAgICBTdGF0ZU1hbmFn\nZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOw0K\nICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfTE9DSywgb2JqLCBzbSwgY2FsbCkNCiAgICAgICAgICAgICAgICAmIE9w\nQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApDQogICAgICAgICAgICAgICAgcmV0\ndXJuOw0KICAgICAgICAgICAgaWYgKHNtID09IG51bGwgfHwgIXNtLmlzUGVy\nc2lzdGVudCgpKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAg\nICAgICAgX2xtLmxvY2soc20sIGxldmVsLCB0aW1lb3V0LCBudWxsKTsNCiAg\nICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsgLy8gdXNl\nIHNhbWUgbGV2ZWwgZm9yIGZ1dHVyZSB3cml0ZQ0KICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBr\nZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0K\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBsb2Nr\nQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgew0KICAg\nICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpDQogICAgICAgICAgICByZXR1cm47\nDQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7IC8vIGhhdmUgdG8g\nc3luYyBvciBsb2NrIGxldmVsIGFsd2F5cyBOT05FDQogICAgICAgIHRyeSB7\nDQogICAgICAgICAgICBsb2NrQWxsKG9ianMsIF9mYy5nZXRXcml0ZUxvY2tM\nZXZlbCgpLCBfZmMuZ2V0TG9ja1RpbWVvdXQoKSwNCiAgICAgICAgICAgICAg\nICBjYWxsKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGlj\nIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIGludCBsZXZlbCwgaW50\nIHRpbWVvdXQsDQogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAg\nICAgaWYgKG9ianMuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuOw0K\nICAgICAgICBpZiAob2Jqcy5zaXplKCkgPT0gMSkgew0KICAgICAgICAgICAg\nbG9jayhvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCBsZXZlbCwgdGltZW91dCwg\nY2FsbCk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7DQoNCiAgICAg\nICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3IEFycmF5TGlzdChvYmpzLnNp\nemUoKSk7DQogICAgICAgICAgICBPYmplY3Qgb2JqOw0KICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbTsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0K\nICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7DQogICAgICAgICAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsNCg0KICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOw0KICAgICAgICAgICAgICAgIGlmICgocHJv\nY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNh\nbGwpDQogICAgICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JV\nTikgPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAg\nICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uaXNQZXJzaXN0ZW50\nKCkpDQogICAgICAgICAgICAgICAgICAgIHNtcy5hZGQoc20pOw0KICAgICAg\nICAgICAgfQ0KDQogICAgICAgICAgICBfbG0ubG9ja0FsbChzbXMsIGxldmVs\nLCB0aW1lb3V0LCBudWxsKTsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gc21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQ0KICAgICAg\nICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkucmVh\nZExvY2tlZChsZXZlbCwgbGV2ZWwpOw0KICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAgICAg\nICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vLw0KICAgIC8v\nIENvbm5lY3Rpb24NCiAgICAvLy8vLy8vLy8vLy8vLw0KDQogICAgcHVibGlj\nIGJvb2xlYW4gY2FuY2VsQWxsKCkgew0KICAgICAgICAvLyB0aGlzIG1ldGhv\nZCBkb2VzIG5vdCBsb2NrLCBzaW5jZSB3ZSB3YW50IHRvIGFsbG93IGEgZGlm\nZmVyZW50DQogICAgICAgIC8vIHRocmVhZCB0byBiZSBhYmxlIHRvIGNhbmNl\nbCBvbiBhIGxvY2tlZC11cCBwZXJzaXN0ZW5jZSBtYW5hZ2VyDQoNCiAgICAg\nICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nLy8gaWYgd2UncmUgZmx1c2hpbmcsIGhhdmUgdG8gc2V0IHJvbGxiYWNrIG9u\nbHkgLS0gZG8gdGhpcyBiZWZvcmUgd2UNCiAgICAgICAgICAgIC8vIGF0dGVt\ncHQgdG8gY2FuY2VsLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgY2FuY2VsIG1p\nZ2h0IGNhc2UgdGhlDQogICAgICAgICAgICAvLyB0cmFuc2FjdGlvbiB0byBj\nb21wbGV0ZSBiZWZvcmUgd2UgaGF2ZSBhIGNoYW5jZSB0byBzZXQgdGhlDQog\nICAgICAgICAgICAvLyByb2xsYmFjayBvbmx5IGZsYWcNCiAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkNCiAg\nICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChuZXcgVXNl\nckV4Y2VwdGlvbigpKTsNCiAgICAgICAgICAgIHJldHVybiBfc3RvcmUuY2Fu\nY2VsQWxsKCk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24ocmUpOw0KICAgICAgICB9DQogICAgfQ0KDQog\nICAgcHVibGljIE9iamVjdCBnZXRDb25uZWN0aW9uKCkgew0KICAgICAgICBh\nc3NlcnRPcGVuKCk7DQogICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0\naW9ucygpLmNvbnRhaW5zDQogICAgICAgICAgICAoX2NvbmYuT1BUSU9OX0RB\nVEFTVE9SRV9DT05ORUNUSU9OKSkNCiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiY29ubi1ub3Qtc3VwcG9y\ndGVkIikpOw0KDQogICAgICAgIHJldHVybiBfc3RvcmUuZ2V0Q2xpZW50Q29u\nbmVjdGlvbigpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGhhc0Nv\nbm5lY3Rpb24oKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAg\ncmV0dXJuIChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVEX0NPTk4pICE9IDA7DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogVGVsbCBzdG9yZSB0byByZXRhaW4g\nY29ubmVjdGlvbiBpZiB3ZSBoYXZlbid0IGFscmVhZHkuDQogICAgICovDQog\nICAgcHJpdmF0ZSB2b2lkIHJldGFpbkNvbm5lY3Rpb24oKSB7DQogICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19SRVRBSU5FRF9DT05OKSA9PSAwKSB7DQog\nICAgICAgICAgICBfc3RvcmUucmV0YWluQ29ubmVjdGlvbigpOw0KICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVUQUlORURfQ09OTjsNCiAgICAgICAg\nfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRlbGwgc3RvcmUgdG8gcmVs\nZWFzZSBjb25uZWN0aW9uIGlmIHdlIGhhdmUgcmV0YWluZWQgb25lLg0KICAg\nICAqLw0KICAgIHByaXZhdGUgdm9pZCByZWxlYXNlQ29ubmVjdGlvbigpIHsN\nCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVEX0NPTk4pICE9\nIDApIHsNCiAgICAgICAgICAgIF9zdG9yZS5yZWxlYXNlQ29ubmVjdGlvbigp\nOw0KICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JFVEFJTkVEX0NPTk47\nDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8vLy8vLy8NCiAgICAvLyBD\nYWNoZQ0KICAgIC8vLy8vLy8vLw0KDQogICAgcHVibGljIENvbGxlY3Rpb24g\nZ2V0TWFuYWdlZE9iamVjdHMoKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBu\nZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0TWFuYWdlZFN0YXRlcygp\nKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIENvbGxl\nY3Rpb24gZ2V0VHJhbnNhY3Rpb25hbE9iamVjdHMoKSB7DQogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAg\nICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0VHJh\nbnNhY3Rpb25hbFN0YXRlcygpKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0K\nDQogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0UGVuZGluZ1RyYW5zYWN0aW9u\nYWxPYmplY3RzKCkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IE1hbmFn\nZWRPYmplY3RDb2xsZWN0aW9uDQogICAgICAgICAgICAgICAgKGdldFBlbmRp\nbmdUcmFuc2FjdGlvbmFsU3RhdGVzKCkpOw0KICAgICAgICB9IGZpbmFsbHkg\new0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXREaXJ0eU9iamVjdHMo\nKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENv\nbGxlY3Rpb24oZ2V0RGlydHlTdGF0ZXMoKSk7DQogICAgICAgIH0gZmluYWxs\neSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0K\nICAgIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGdldE9yZGVyRGlydHlPYmpl\nY3RzKCkgew0KICAgICAgICByZXR1cm4gX29yZGVyRGlydHk7DQogICAgfQ0K\nDQogICAgcHVibGljIHZvaWQgc2V0T3JkZXJEaXJ0eU9iamVjdHMoYm9vbGVh\nbiBvcmRlcikgew0KICAgICAgICBfb3JkZXJEaXJ0eSA9IG9yZGVyOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIG1h\nbmFnZWQgc3RhdGUgbWFuYWdlcnMuDQogICAgICovDQogICAgcHJvdGVjdGVk\nIENvbGxlY3Rpb24gZ2V0TWFuYWdlZFN0YXRlcygpIHsNCiAgICAgICAgcmV0\ndXJuIF9jYWNoZS5jb3B5KCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0ZSBtYW5h\nZ2Vycy4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRU\ncmFuc2FjdGlvbmFsU3RhdGVzKCkgew0KICAgICAgICBpZiAoIWhhc1RyYW5z\nYWN0aW9uYWxPYmplY3RzKCkpDQogICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuRU1QVFlfTElTVDsNCiAgICAgICAgcmV0dXJuIF90cmFuc0NhY2hl\nLmNvcHkoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBXaGV0aGVyIG9y\nIG5vdCB0aGVyZSBhcmUgYW55IHRyYW5zYWN0aW9uYWwgb2JqZWN0cyBpbiB0\naGUgY3VycmVudA0KICAgICAqIHBlcnNpc3RlbmNlIGNvbnRleHQuIElmIHRo\nZXJlIGFyZSBhbnkgaW5zdGFuY2VzIHdpdGggdW50cmFja2VkIHN0YXRlLA0K\nICAgICAqIHRoaXMgbWV0aG9kIHdpbGwgY2F1c2UgdGhvc2UgaW5zdGFuY2Vz\nIHRvIGJlIHNjYW5uZWQuDQogICAgICovDQogICAgcHJpdmF0ZSBib29sZWFu\nIGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgew0KICAgICAgICBfY2FjaGUu\nZGlydHlDaGVjaygpOw0KICAgICAgICByZXR1cm4gX3RyYW5zQ2FjaGUgIT0g\nbnVsbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gYSBjb3B5\nIG9mIGFsbCBkaXJ0eSBzdGF0ZSBtYW5hZ2Vycy4NCiAgICAgKi8NCiAgICBw\ncm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXREaXJ0eVN0YXRlcygpIHsNCiAgICAg\nICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQ0KICAgICAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7DQoNCiAgICAgICAg\ncmV0dXJuIF90cmFuc0NhY2hlLmNvcHlEaXJ0eSgpOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIHN0YXRlIG1hbmFn\nZXJzIHdoaWNoIHdpbGwgYmVjb21lDQogICAgICogdHJhbnNhY3Rpb25hbCB1\ncG9uIHRoZSBuZXh0IHRyYW5zYWN0aW9uLg0KICAgICAqLw0KICAgIHByb3Rl\nY3RlZCBDb2xsZWN0aW9uIGdldFBlbmRpbmdUcmFuc2FjdGlvbmFsU3RhdGVz\nKCkgew0KICAgICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkNCiAgICAgICAg\nICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0KICAgICAgICBy\nZXR1cm4gbmV3IEFycmF5TGlzdChfcGVuZGluZyk7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogU2V0IHRoZSBjYWNoZWQgU3RhdGVNYW5hZ2VyIGZvciB0\naGUgaW5zdGFuY2UgdGhhdCBoYWQgdGhlIGdpdmVuIG9pZC4NCiAgICAgKiBU\naGlzIG1ldGhvZCBtdXN0IG5vdCBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMg\nZm9yIG5ldyBpbnN0YW5jZXMuDQogICAgICoNCiAgICAgKiBAcGFyYW0gaWQg\ndGhlIGlkIHByZXZpb3VzbHkgdXNlZCBieSB0aGUgaW5zdGFuY2UNCiAgICAg\nKiBAcGFyYW0gc20gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBpbnN0YW5j\nZTsgaWYgdGhlIHN0YXRlDQogICAgICogbWFuYWdlciBpcyB0cmFuc2llbnQs\nIHdlJ2xsIHN0b3AgbWFuYWdpbmcgdGhlIGluc3RhbmNlOw0KICAgICAqIGlm\nIGl0IGhhcyB1cGRhdGVkIGl0cyBvaWQsIHdlJ2xsIHJlLWNhY2hlIHVuZGVy\nIHRoZSBuZXcgb2lkDQogICAgICogQHBhcmFtIHN0YXR1cyBvbmUgb2Ygb3Vy\nIFNUQVRVUyBjb25zdGFudHMgZGVzY3JpYmluZyB3aHkgd2UncmUNCiAgICAg\nKiBzZXR0aW5nIHRoZSBzdGF0ZSBtYW5hZ2VyDQogICAgICovDQogICAgdm9p\nZCBzZXRTdGF0ZU1hbmFnZXIoT2JqZWN0IGlkLCBTdGF0ZU1hbmFnZXJJbXBs\nIHNtLCBpbnQgc3RhdHVzKSB7DQogICAgICAgIGxvY2soKTsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7DQogICAgICAg\nICAgICAgICAgY2FzZSBTVEFUVVNfSU5JVDoNCiAgICAgICAgICAgICAgICAg\nICAgX2NhY2hlLmFkZChzbSk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOw0KICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTX1RSQU5TSUVOVDoNCiAg\nICAgICAgICAgICAgICAgICAgX2NhY2hlLnJlbW92ZShpZCwgc20pOw0KICAg\nICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNl\nIFNUQVRVU19PSURfQVNTSUdOOg0KICAgICAgICAgICAgICAgICAgICBhc3Np\nZ25PYmplY3RJZChfY2FjaGUsIGlkLCBzbSk7DQogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTX0NPTU1J\nVF9ORVc6DQogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5jb21taXROZXco\naWQsIHNtKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAg\nICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKCk7DQogICAgICAgICAgICB9DQogICAg\nICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICB1bmxvY2so\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIE5vdGlm\neSB0aGUgYnJva2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hv\ndWxkDQogICAgICogYmUgYWRkZWQgdG8gdGhlIHNldCBvZiBpbnN0YW5jZXMg\naW52b2x2ZWQgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24uDQogICAgICov\nDQogICAgdm9pZCBhZGRUb1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwg\nc20pIHsNCiAgICAgICAgLy8gd2Ugb25seSBhZGQgY2xlYW4gaW5zdGFuY2Vz\nIG5vdzsgZGlydHkgaW5zdGFuY2VzIGFyZSBhZGRlZCBpbg0KICAgICAgICAv\nLyB0aGUgc2V0RGlydHkgY2FsbGJhY2sNCiAgICAgICAgaWYgKHNtLmlzRGly\ndHkoKSkNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICBsb2NrKCk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoIWhhc1RyYW5zYWN0\naW9uYWxPYmplY3RzKCkpDQogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUg\nPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlKF9vcmRlckRpcnR5KTsNCiAgICAg\nICAgICAgIF90cmFuc0NhY2hlLmFkZENsZWFuKHNtKTsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5j\nZSBtYW5hZ2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxk\nDQogICAgICogYmUgcmVtb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2Vz\nIGludm9sdmVkIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uLg0KICAgICAq\nLw0KICAgIHZvaWQgcmVtb3ZlRnJvbVRyYW5zYWN0aW9uKFN0YXRlTWFuYWdl\nckltcGwgc20pIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgaWYgKF90cmFuc0NhY2hlICE9IG51bGwpDQogICAgICAg\nICAgICAgICAgLy8gaW50ZW50aW9uYWwgZGlyZWN0IGFjY2Vzczsgd2UgZG9u\nJ3Qgd2FudCB0byByZWNvbXB1dGUNCiAgICAgICAgICAgICAgICAvLyBkaXJ0\naW5lc3Mgd2hpbGUgcmVtb3ZpbmcgaW5zdGFuY2VzIGZyb20gdGhlIHRyYW5z\nYWN0aW9uDQogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUucmVtb3ZlKHNt\nKTsNCiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsICYmICFz\nbS5pc1BlcnNpc3RlbnQoKSkNCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNo\nZS5yZW1vdmUoc20pOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAg\nICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgZ2l2ZW4gaW5zdGFuY2UgaGFz\nIGJlZW4gZGlydGllZC4gVGhpcw0KICAgICAqIG5vdGlmaWNhdGlvbiBpcyBn\naXZlbiB3aGVuIGFuIG9iamVjdCBmaXJzdCB0cmFuc2l0aW9ucyB0byBhIGRp\ncnR5IHN0YXRlLA0KICAgICAqIGFuZCBldmVyeSB0aW1lIHRoZSBvYmplY3Qg\naXMgbW9kaWZpZWQgYnkgdGhlIHVzZXIgdGhlcmVhZnRlci4NCiAgICAgKi8N\nCiAgICB2b2lkIHNldERpcnR5KFN0YXRlTWFuYWdlckltcGwgc20sIGJvb2xl\nYW4gZmlyc3REaXJ0eSkgew0KICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50\nKCkpDQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSF9SRVFVSVJF\nRDsNCg0KICAgICAgICBpZiAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiAhX3Nh\ndmVwb2ludHMuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBpZiAoX3NhdmVw\nb2ludENhY2hlID09IG51bGwpDQogICAgICAgICAgICAgICAgX3NhdmVwb2lu\ndENhY2hlID0gbmV3IEhhc2hTZXQoKTsNCiAgICAgICAgICAgIF9zYXZlcG9p\nbnRDYWNoZS5hZGQoc20pOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGZp\ncnN0RGlydHkgJiYgc20uaXNUcmFuc2FjdGlvbmFsKCkpIHsNCiAgICAgICAg\nICAgIGxvY2soKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAg\nICAgLy8gY2FjaGUgZGlydHkgaW5zdGFuY2UNCiAgICAgICAgICAgICAgICBp\nZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpDQogICAgICAgICAgICAg\nICAgICAgIF90cmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZShf\nb3JkZXJEaXJ0eSk7DQogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUuYWRk\nRGlydHkoc20pOw0KDQogICAgICAgICAgICAgICAgLy8gYWxzbyByZWNvcmQg\ndGhhdCB0aGUgY2xhc3MgaXMgZGlydHkNCiAgICAgICAgICAgICAgICBpZiAo\nc20uaXNOZXcoKSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoX3BlcnNp\nc3RlZENsc3MgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIF9w\nZXJzaXN0ZWRDbHNzID0gbmV3IEhhc2hTZXQoKTsNCiAgICAgICAgICAgICAg\nICAgICAgX3BlcnNpc3RlZENsc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKHNtLmlzRGVsZXRlZCgpKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChf\nZGVsZXRlZENsc3MgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAg\nIF9kZWxldGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7DQogICAgICAgICAgICAg\nICAgICAgIF9kZWxldGVkQ2xzcy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXRE\nZXNjcmliZWRUeXBlKCkpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQog\nICAgICAgICAgICAgICAgICAgIGlmIChfdXBkYXRlZENsc3MgPT0gbnVsbCkN\nCiAgICAgICAgICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xzcyA9IG5ldyBI\nYXNoU2V0KCk7DQogICAgICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xzcy5h\nZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkpOw0KICAg\nICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIGlmIHRyYWNr\naW5nIGNoYW5nZXMgYW5kIHRoaXMgaW5zdGFuY2Ugd2Fzbid0IGFscmVhZHkg\nZGlydHksDQogICAgICAgICAgICAgICAgLy8gYWRkIHRvIGNoYW5nZWQgc2V0\nOyB3ZSB1c2UgdGhpcyBmb3IgZGV0ZWN0aW5nIGluc3RhbmNlcyB0aGF0DQog\nICAgICAgICAgICAgICAgLy8gZW50ZXIgdGhlIHRyYW5zYWN0aW9uIGR1cmlu\nZyBwcmUgc3RvcmUNCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfUFJFU1RPUklORykgIT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBp\nZiAoX3RyYW5zQWRkaXRpb25zID09IG51bGwpDQogICAgICAgICAgICAgICAg\nICAgICAgICBfdHJhbnNBZGRpdGlvbnMgPSBuZXcgSGFzaFNldCgpOw0KICAg\nICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMuYWRkKHNtKTsNCiAg\nICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGZpbmFsbHkgew0KICAg\nICAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICAgICAgfQ0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTm90aWZ5IHRoZSBicm9r\nZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQNCiAgICAg\nKiBiZSBhZGRlZCB0byB0aGUgc2V0IG9mIGluc3RhbmNlcyB0aGF0IHdpbGwg\nYmVjb21lIHRyYW5zYWN0aW9uYWwNCiAgICAgKiBvbiB0aGUgbmV4dCB0cmFu\nc2FjdGlvbg0KICAgICAqLw0KICAgIHZvaWQgYWRkVG9QZW5kaW5nVHJhbnNh\nY3Rpb24oU3RhdGVNYW5hZ2VySW1wbCBzbSkgew0KICAgICAgICBsb2NrKCk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoX3BlbmRpbmcgPT0g\nbnVsbCkNCiAgICAgICAgICAgICAgICBfcGVuZGluZyA9IG5ldyBIYXNoU2V0\nKCk7DQogICAgICAgICAgICBfcGVuZGluZy5hZGQoc20pOw0KICAgICAgICB9\nIGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBOb3RpZnkgdGhlIHBlcnNpc3Rl\nbmNlIG1hbmFnZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91\nbGQNCiAgICAgKiBiZSByZW1vdmVkIGZyb20gdGhlIHNldCBvZiBpbnN0YW5j\nZXMgaW52b2x2ZWQgaW4gdGhlIG5leHQgdHJhbnNhY3Rpb24uDQogICAgICov\nDQogICAgdm9pZCByZW1vdmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKFN0YXRl\nTWFuYWdlckltcGwgc20pIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgaWYgKF9wZW5kaW5nICE9IG51bGwpDQogICAg\nICAgICAgICAgICAgX3BlbmRpbmcucmVtb3ZlKHNtKTsNCiAgICAgICAgICAg\nIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsICYmICFzbS5pc1BlcnNpc3RlbnQo\nKSkNCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5yZW1vdmUoc20pOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYSBkZXJl\nZmVyZW5jZWQgZGVwZW5kZW50IG9iamVjdCB0byB0aGUgcGVyc2lzdGVuY2Ug\nbWFuYWdlcidzIGNhY2hlLg0KICAgICAqIE9uIGZsdXNoLCB0aGVzZSBvYmpl\nY3RzIHdpbGwgYmUgZGVsZXRlZC4NCiAgICAgKi8NCiAgICB2b2lkIGFkZERl\ncmVmZXJlbmNlZERlcGVuZGVudChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQog\nICAgICAgIGxvY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8v\nIGlmIHdlJ3JlIGluIHRoZSBtaWRkbGUgb2YgZmx1c2ggYW5kIGludHJvZHVj\naW5nIG1vcmUgZGVyZWZzDQogICAgICAgICAgICAvLyB2aWEgaW5zdGFuY2Ug\nY2FsbGJhY2tzLCBhZGQgdGhlbSB0byB0aGUgc3BlY2lhbCBhZGRpdGlvbnMg\nc2V0DQogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfREVSRUZERUxF\nVElORykgIT0gMCkgew0KICAgICAgICAgICAgICAgIGlmIChfZGVyZWZBZGRp\ndGlvbnMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgX2RlcmVmQWRk\naXRpb25zID0gbmV3IEhhc2hTZXQoKTsNCiAgICAgICAgICAgICAgICBfZGVy\nZWZBZGRpdGlvbnMuYWRkKHNtKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQog\nICAgICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hlID09IG51bGwpDQogICAg\nICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlID0gbmV3IEhhc2hTZXQoKTsN\nCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5hZGQoc20pOw0KICAgICAg\nICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAg\nICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIHByZXZpb3VzbHkgZGVyZWZlcmVu\nY2VkIGRlcGVuZGVudCBvYmplY3QgZnJvbSB0aGUNCiAgICAgKiBjYWNoZS4g\nSXQgaXMgbm93IHJlZmVyZW5jZWQuDQogICAgICovDQogICAgdm9pZCByZW1v\ndmVEZXJlZmVyZW5jZWREZXBlbmRlbnQoU3RhdGVNYW5hZ2VySW1wbCBzbSkg\new0KICAgICAgICBsb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAg\nICBib29sZWFuIHJlbW92ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIGlmIChf\nZGVyZWZBZGRpdGlvbnMgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICByZW1v\ndmVkID0gX2RlcmVmQWRkaXRpb25zLnJlbW92ZShzbSk7DQogICAgICAgICAg\nICBpZiAoIXJlbW92ZWQgJiYgKF9kZXJlZkNhY2hlID09IG51bGwgfHwgIV9k\nZXJlZkNhY2hlLnJlbW92ZShzbSkpKQ0KICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1kZXJl\nZmVkIiwNCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmlu\nZyhzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS4NCiAgICAgICAgICAgICAg\nICAgICAgc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgp\nKS4NCiAgICAgICAgICAgICAgICAgICAgc2V0RmF0YWwodHJ1ZSk7DQogICAg\nICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICB1bmxvY2soKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGRpcnR5VHlwZShDbGFz\ncyBjbHMpIHsNCiAgICAgICAgaWYgKGNscyA9PSBudWxsKQ0KICAgICAgICAg\nICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsN\nCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChfdXBkYXRlZENsc3Mg\nPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3MgPSBuZXcg\nSGFzaFNldCgpOw0KICAgICAgICAgICAgX3VwZGF0ZWRDbHNzLmFkZChjbHMp\nOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBnZXRQZXJzaXN0ZWRUeXBlcygpIHsNCiAgICAgICAgaWYgKF9wZXJz\naXN0ZWRDbHNzID09IG51bGwgfHwgX3BlcnNpc3RlZENsc3MuaXNFbXB0eSgp\nKQ0KICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7\nDQogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xs\nZWN0aW9uKF9wZXJzaXN0ZWRDbHNzKTsNCiAgICB9DQoNCiAgICBwdWJsaWMg\nQ29sbGVjdGlvbiBnZXRVcGRhdGVkVHlwZXMoKSB7DQogICAgICAgIGlmIChf\ndXBkYXRlZENsc3MgPT0gbnVsbCB8fCBfdXBkYXRlZENsc3MuaXNFbXB0eSgp\nKQ0KICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7\nDQogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xs\nZWN0aW9uKF91cGRhdGVkQ2xzcyk7DQogICAgfQ0KDQogICAgcHVibGljIENv\nbGxlY3Rpb24gZ2V0RGVsZXRlZFR5cGVzKCkgew0KICAgICAgICBpZiAoX2Rl\nbGV0ZWRDbHNzID09IG51bGwgfHwgX2RlbGV0ZWRDbHNzLmlzRW1wdHkoKSkN\nCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0K\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVj\ndGlvbihfZGVsZXRlZENsc3MpOw0KICAgIH0NCg0KICAgIC8vLy8vLy8vLy8v\nDQogICAgLy8gQ2xvc2luZw0KICAgIC8vLy8vLy8vLy8vDQoNCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsNCiAgICAgICAgcmV0dXJuIF9jbG9z\nZWQ7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gaXNDbG9zZUludm9r\nZWQoKSB7DQogICAgICAgIHJldHVybiBfY2xvc2VkIHx8IChfZmxhZ3MgJiBG\nTEFHX0NMT1NFX0lOVk9LRUQpICE9IDA7DQogICAgfQ0KDQogICAgcHVibGlj\nIHZvaWQgY2xvc2UoKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIHRocm93IGFuIGV4\nY2VwdGlvbiBpZiBjbG9zaW5nIGluIGFuIGFjdGl2ZSBsb2NhbCB0cmFucw0K\nICAgICAgICAgICAgaWYgKCFfbWFuYWdlZCAmJiAoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpICE9IDApDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiYWN0aXZlIikpOw0KDQogICAg\nICAgICAgICAvLyBvbmx5IGNsb3NlIGlmIG5vdCBhY3RpdmU7IGlmIGFjdGl2\nZSBtYW5hZ2VkIHRyYW5zIHdhaXQNCiAgICAgICAgICAgIC8vIGZvciBjb21w\nbGV0aW9uDQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19DTE9TRV9JTlZP\nS0VEOw0KDQogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZF\nKSA9PSAwKQ0KICAgICAgICAgICAgICAgIGZyZWUoKTsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRnJlZSB0aGUgcmVzb3Vy\nY2VzIHVzZWQgYnkgdGhpcyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLg0KICAgICAq\nLw0KICAgIHByb3RlY3RlZCB2b2lkIGZyZWUoKSB7DQogICAgICAgIFJ1bnRp\nbWVFeGNlcHRpb24gZXJyID0gbnVsbDsNCiAgICAgICAgaWYgKChfYXV0b0Rl\ndGFjaCAmIERFVEFDSF9DTE9TRSkgIT0gMCkgew0KICAgICAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChfY2FsbCk7\nDQogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nDQogICAgICAgICAgICAgICAgZXJyID0gcmU7DQogICAgICAgICAgICB9DQog\nICAgICAgIH0NCg0KICAgICAgICBfc3luYyA9IG51bGw7DQogICAgICAgIF91\nc2VyT2JqZWN0cyA9IG51bGw7DQogICAgICAgIF9jYWNoZS5jbGVhcigpOw0K\nICAgICAgICBfdHJhbnNDYWNoZSA9IG51bGw7DQogICAgICAgIF9wZXJzaXN0\nZWRDbHNzID0gbnVsbDsNCiAgICAgICAgX3VwZGF0ZWRDbHNzID0gbnVsbDsN\nCiAgICAgICAgX2RlbGV0ZWRDbHNzID0gbnVsbDsNCiAgICAgICAgX2RlcmVm\nQ2FjaGUgPSBudWxsOw0KICAgICAgICBfcGVuZGluZyA9IG51bGw7DQogICAg\nICAgIF9sb2FkZXIgPSBudWxsOw0KICAgICAgICBfdHJhbnNFdmVudE1hbmFn\nZXIgPSBudWxsOw0KICAgICAgICBfbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7\nDQoNCiAgICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOw0KICAgICAgICB3\naGlsZSAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiAhX3NhdmVwb2ludHMuaXNF\nbXB0eSgpKSB7DQogICAgICAgICAgICBzYXZlID0NCiAgICAgICAgICAgICAg\nICAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKF9zYXZl\ncG9pbnRzLnNpemUoKSAtIDEpOw0KICAgICAgICAgICAgc2F2ZS5yZWxlYXNl\nKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgICAgICBfc2F2ZXBvaW50cyA9IG51\nbGw7DQogICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9IG51bGw7DQoNCiAgICAg\nICAgaWYgKF9xdWVyaWVzICE9IG51bGwpIHsNCiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX3F1ZXJpZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nICAgICAgICAoKFF1ZXJ5KSBpdHIubmV4dCgpKS5jbG9zZVJlc291cmNlcygp\nOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAg\nICAgICAgICBfcXVlcmllcyA9IG51bGw7DQogICAgICAgIH0NCg0KICAgICAg\nICBpZiAoX2V4dGVudHMgIT0gbnVsbCkgew0KICAgICAgICAgICAgRXh0ZW50\nIGU7DQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9leHRlbnRz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAg\nICAgZSA9IChFeHRlbnQpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgZS5jbG9zZUFsbCgpOw0KICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsN\nCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAg\nICBfZXh0ZW50cyA9IG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICB0cnkg\neyByZWxlYXNlQ29ubmVjdGlvbigpOyB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7fQ0KDQogICAgICAgIF9sbS5jbG9zZSgpOw0KICAgICAgICBf\nc3RvcmUuY2xvc2UoKTsNCiAgICAgICAgX2ZsYWdzID0gMDsNCiAgICAgICAg\nX2Nsb3NlZCA9IHRydWU7DQogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpDQogICAgICAgICAgICBfY2xvc2VkRXhjZXB0aW9uID0gbmV3IEls\nbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOw0KDQogICAgICAgIF9mYWN0b3J5LnJl\nbGVhc2VCcm9rZXIodGhpcyk7DQoNCiAgICAgICAgaWYgKGVyciAhPSBudWxs\nKQ0KICAgICAgICAgICAgdGhyb3cgZXJyOw0KICAgIH0NCg0KICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBTeW5jaHJvbml6YXRpb24NCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICBwdWJsaWMgdm9pZCBsb2NrKCkg\new0KICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkNCiAgICAgICAgICAgIF9s\nb2NrLmxvY2soKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB1bmxvY2so\nKSB7DQogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQ0KICAgICAgICAgICAg\nX2xvY2sudW5sb2NrKCk7DQogICAgfQ0KDQogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8NCiAgICAvLyBTdGF0ZSBtYW5hZ2VtZW50DQogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8NCg0KICAgIHB1YmxpYyBPYmplY3QgbmV3SW5zdGFuY2Uo\nQ2xhc3MgY2xzKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCg0KICAgICAg\nICBpZiAoIWNscy5pc0ludGVyZmFjZSgpICYmIE1vZGlmaWVyLmlzQWJzdHJh\nY3QoY2xzLmdldE1vZGlmaWVycygpKSkNCiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbihfbG9jLmdldA0KICAg\nICAgICAgICAgICAgICgibmV3LWFic3RyYWN0IiwgY2xzKS5nZXRNZXNzYWdl\nKCkpOw0KDQogICAgICAgIC8vIDEuNSBkb2Vzbid0IGluaXRpYWxpemUgY2xh\nc3NlcyB3aXRob3V0IGEgdHJ1ZSBDbGFzcy5mb3JOYW1lDQogICAgICAgIGlm\nICghUENSZWdpc3RyeS5pc1JlZ2lzdGVyZWQoY2xzKSkgew0KICAgICAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNscy5n\nZXROYW1lKCksIHRydWUsIA0KICAgICAgICAgICAgICAgICAgICAoQ2xhc3NM\nb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKA0KICAgICAg\nICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2Fk\nZXJBY3Rpb24oY2xzKSkpOw0KICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dh\nYmxlIHQpIHsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAg\nIGlmIChfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLmdl\ndE1ldGFEYXRhKGNscywNCiAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKCks\nIGZhbHNlKSA9PSBudWxsKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgICBfbG9jLmdl\ndCgibm8taW50ZXJmYWNlLW1ldGFkYXRhIiwgY2xzLmdldE5hbWUoKSkuZ2V0\nTWVzc2FnZSgpKTsNCg0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0\ndXJuIFBDUmVnaXN0cnkubmV3SW5zdGFuY2UoY2xzLCBudWxsLCBmYWxzZSk7\nDQogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBpc2Up\nIHsNCiAgICAgICAgICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpYWUg\nPQ0KICAgICAgICAgICAgICAgIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24oaXNlLmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICBpYWUuc2V0U3Rh\nY2tUcmFjZShpc2UuZ2V0U3RhY2tUcmFjZSgpKTsNCiAgICAgICAgICAgIHRo\ncm93IGlhZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0T2JqZWN0SWQoT2JqZWN0IG9iaikgew0KICAgICAgICBhc3NlcnRP\ncGVuKCk7DQogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\nYmopKQ0KICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lz\ndGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKQ0KICAgICAgICAgICAgICAgIC5w\nY0ZldGNoT2JqZWN0SWQoKTsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAg\nfQ0KDQogICAgcHVibGljIGludCBnZXRMb2NrTGV2ZWwoT2JqZWN0IG8pIHsN\nCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBpZiAobyA9PSBudWxs\nKQ0KICAgICAgICAgICAgcmV0dXJuIExvY2tMZXZlbHMuTE9DS19OT05FOw0K\nDQogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBnZXRTdGF0ZU1h\nbmFnZXIobyk7DQogICAgICAgIGlmIChzbSA9PSBudWxsKQ0KICAgICAgICAg\nICAgcmV0dXJuIExvY2tMZXZlbHMuTE9DS19OT05FOw0KICAgICAgICByZXR1\ncm4gZ2V0TG9ja01hbmFnZXIoKS5nZXRMb2NrTGV2ZWwoc20pOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyBPYmplY3QgZ2V0VmVyc2lvbihPYmplY3Qgb2JqKSB7\nDQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgaWYgKEltcGxIZWxw\nZXIuaXNNYW5hZ2VhYmxlKG9iaikpDQogICAgICAgICAgICByZXR1cm4gKElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBj\nR2V0VmVyc2lvbigpOw0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KE9iamVjdCBvYmopIHsNCiAg\nICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBpZiAoSW1wbEhlbHBlci5p\nc01hbmFnZWFibGUob2JqKSkgew0KICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShv\nYmosIF9jb25mKTsNCiAgICAgICAgICAgIHJldHVybiBwYy5wY0lzRGlydHko\nKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0K\nDQogICAgcHVibGljIGJvb2xlYW4gaXNUcmFuc2FjdGlvbmFsKE9iamVjdCBv\nYmopIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBpZiAoSW1w\nbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkNCiAgICAgICAgICAgIHJldHVy\nbiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25m\nKSkNCiAgICAgICAgICAgICAgICAucGNJc1RyYW5zYWN0aW9uYWwoKTsNCiAg\nICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBib29s\nZWFuIGlzUGVyc2lzdGVudChPYmplY3Qgb2JqKSB7DQogICAgICAgIGFzc2Vy\ndE9wZW4oKTsNCiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxl\nKG9iaikpDQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJz\naXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNQZXJzaXN0ZW50KCk7\nDQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc05ldyhPYmplY3Qgb2JqKSB7DQogICAgICAgIGFzc2VydE9w\nZW4oKTsNCiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9i\naikpDQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0\nZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNOZXcoKTsNCiAgICAgICAg\ncmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGlz\nRGVsZXRlZChPYmplY3Qgb2JqKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsN\nCiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpDQog\nICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNh\ncGFibGUob2JqLCBfY29uZikpLnBjSXNEZWxldGVkKCk7DQogICAgICAgIHJl\ndHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Rl\ndGFjaGVkKE9iamVjdCBvYmopIHsNCiAgICAgICAgaWYgKCEoSW1wbEhlbHBl\nci5pc01hbmFnZWFibGUob2JqKSkpDQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7DQoNCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhl\nbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKTsNCiAgICAg\nICAgQm9vbGVhbiBkZXRhY2hlZCA9IHBjLnBjSXNEZXRhY2hlZCgpOw0KICAg\nICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVy\nbiBkZXRhY2hlZC5ib29sZWFuVmFsdWUoKTsNCg0KICAgICAgICAvLyBsYXN0\nIHJlc29ydDogaW5zdGFuY2UgaXMgZGV0YWNoZWQgaWYgaXQgaGFzIGEgc3Rv\ncmUgcmVjb3JkDQogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25m\nLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuDQogICAgICAgICAg\nICBnZXRNZXRhRGF0YShJbXBsSGVscGVyLmdldE1hbmFnZWRJbnN0YW5jZShw\nYykuZ2V0Q2xhc3MoKSwNCiAgICAgICAgICAgICAgICBfbG9hZGVyLCB0cnVl\nKTsNCiAgICAgICAgT2JqZWN0IG9pZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0\nZShwYywgbWV0YSk7DQogICAgICAgIGlmIChvaWQgPT0gbnVsbCkNCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgcmV0dXJuIGZpbmQob2lk\nLCBudWxsLCBFWENMVURFX0FMTCwgbnVsbCwgMCkgIT0gbnVsbDsNCiAgICB9\nDQoNCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdlciBnZXRTdGF0ZU1h\nbmFnZXIoT2JqZWN0IG9iaikgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQog\nICAgICAgIHJldHVybiBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2Up\nOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0aGUgc3RhdGUg\nbWFuYWdlciBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLCBvciBudWxsLg0KICAg\nICAqDQogICAgICogQHBhcmFtIGFzc2VydFRoaXNDb250ZXh0IGlmIHRydWUs\nIHRob3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBnaXZlbg0KICAgICAqIG9iamVj\ndCBpcyBtYW5hZ2VkIGJ5IGFub3RoZXIgYnJva2VyDQogICAgICovDQogICAg\ncHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgZ2V0U3RhdGVNYW5hZ2VySW1w\nbChPYmplY3Qgb2JqLA0KICAgICAgICBib29sZWFuIGFzc2VydFRoaXNDb250\nZXh0KSB7DQogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\nYmopKSB7DQogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJ\nbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOw0K\nICAgICAgICAgICAgaWYgKHBjLnBjR2V0R2VuZXJpY0NvbnRleHQoKSA9PSB0\naGlzKQ0KICAgICAgICAgICAgICAgIHJldHVybiAoU3RhdGVNYW5hZ2VySW1w\nbCkgcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsNCiAgICAgICAgICAgIGlmIChh\nc3NlcnRUaGlzQ29udGV4dCAmJiBwYy5wY0dldEdlbmVyaWNDb250ZXh0KCkg\nIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibm90LW1hbmFnZWQiLA0KICAgICAgICAgICAgICAg\nICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRPYmpl\nY3Qob2JqKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAg\nICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1hbmFn\nZXIgZm9yIHRoZSBnaXZlbiBvaWQuDQogICAgICoNCiAgICAgKiBAcGFyYW0g\nYWxsb3dOZXcgaWYgdHJ1ZSwgb2JqZWN0cyBtYWRlIHBlcnNpc3RlbnQgaW4g\ndGhlIGN1cnJlbnQNCiAgICAgKiB0cmFuc2FjdGlvbiB3aWxsIGJlIGluY2x1\nZGVkIGluIHRoZSBzZWFyY2g7IGlmDQogICAgICogbXVsdGlwbGUgbmV3IG9i\namVjdHMgbWF0Y2ggdGhlIGdpdmVuIG9pZCwgaXQgaXMNCiAgICAgKiB1bmRl\nZmluZWQgd2hpY2ggd2lsbCBiZSByZXR1cm5lZA0KICAgICAqLw0KICAgIHBy\nb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGdldFN0YXRlTWFuYWdlckltcGxC\neUlkKE9iamVjdCBvaWQsDQogICAgICAgIGJvb2xlYW4gYWxsb3dOZXcpIHsN\nCiAgICAgICAgcmV0dXJuIF9jYWNoZS5nZXRCeUlkKG9pZCwgYWxsb3dOZXcp\nOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0aGUgZ2l2ZW4g\naW5zdGFuY2UgYXMgYSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlfS4NCiAg\nICAgKiBJZiB0aGUgaW5zdGFuY2UgaXMgbm90IG1hbmFnZWFibGUgdGhyb3cg\ndGhlIHByb3BlciBleGNlcHRpb24uDQogICAgICovDQogICAgcHJvdGVjdGVk\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUo\nT2JqZWN0IG9iaikgew0KICAgICAgICBpZiAob2JqID09IG51bGwpDQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKEltcGxIZWxwZXIu\naXNNYW5hZ2VhYmxlKG9iaikpDQogICAgICAgICAgICByZXR1cm4gSW1wbEhl\nbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKTsNCg0KICAg\nICAgICAvLyBjaGVjayBmb3IgZGlmZmVyZW50IGluc3RhbmNlcyBvZiB0aGUg\nUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZQ0KICAgICAgICAvLyBhbmQg\ndGhyb3cgYSBiZXR0ZXIgZXJyb3IgdGhhdCBtZW50aW9ucyB0aGUgY2xhc3Mg\nbG9hZGVycw0KICAgICAgICBDbGFzc1tdIGludGZzID0gb2JqLmdldENsYXNz\nKCkuZ2V0SW50ZXJmYWNlcygpOw0KICAgICAgICBmb3IgKGludCBpID0gMDsg\naW50ZnMgIT0gbnVsbCAmJiBpIDwgaW50ZnMubGVuZ3RoOyBpKyspIHsNCiAg\nICAgICAgICAgIGlmIChpbnRmc1tpXS5nZXROYW1lKCkuZXF1YWxzKFBlcnNp\nc3RlbmNlQ2FwYWJsZS5jbGFzcy5nZXROYW1lKCkpKSB7DQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBjLWxv\nYWRlci1kaWZmZXJlbnQiLA0KICAgICAgICAgICAgICAgICAgICBFeGNlcHRp\nb25zLnRvU3RyaW5nKG9iaiksDQogICAgICAgICAgICAgICAgICAgIChDbGFz\nc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoDQogICAg\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xv\nYWRlckFjdGlvbigNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MpKSwNCiAgICAgICAgICAgICAgICAgICAg\nKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgN\nCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGludGZzW2ldKSkpKQ0KICAgICAgICAgICAgICAg\nICAgICAuc2V0RmFpbGVkT2JqZWN0KG9iaik7DQogICAgICAgICAgICB9DQog\nICAgICAgIH0NCg0KICAgICAgICAvLyBub3QgZW5oYW5jZWQNCiAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBjLWNhc3QiLA0K\nICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSkuc2V0RmFp\nbGVkT2JqZWN0KG9iaik7DQogICAgfQ0KDQogICAgLy8vLy8vLy8vDQogICAg\nLy8gVXRpbHMNCiAgICAvLy8vLy8vLy8NCiAgICAvKioNCiAgICAgKiBUaHJv\ndyBhbiBleGNlcHRpb24gaWYgdGhlIGNvbnRleHQgaXMgY2xvc2VkLiAgVGhl\nIGV4YWN0IG1lc3NhZ2UgYW5kDQogICAgICogY29udGVudCBvZiB0aGUgZXhj\nZXB0aW9uIHZhcmllcyB3aGV0aGVyIFRSQUNFIGlzIGVuYWJsZWQgb3Igbm90\nLg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIGFzc2VydE9wZW4oKSB7DQog\nICAgICAgIGlmIChfY2xvc2VkKSB7DQogICAgICAgICAgICBpZiAoX2Nsb3Nl\nZEV4Y2VwdGlvbiA9PSBudWxsKSAgLy8gVFJBQ0Ugbm90IGVuYWJsZWQNCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJjbG9zZWQtbm90cmFjZSIpKQ0KICAgICAgICAgICAgICAg\nICAgICAgICAgLnNldEZhdGFsKHRydWUpOw0KICAgICAgICAgICAgZWxzZSB7\nDQogICAgICAgICAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBlID0gbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgICAgICAgX2xv\nYy5nZXQoImNsb3NlZCIpLCBfY2xvc2VkRXhjZXB0aW9uKS5zZXRGYXRhbCh0\ncnVlKTsNCiAgICAgICAgICAgICAgICBlLnNldENhdXNlKF9jbG9zZWRFeGNl\ncHRpb24pOw0KICAgICAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgICAg\nICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBhc3Nl\ncnRBY3RpdmVUcmFuc2FjdGlvbigpIHsNCiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgPT0gMCkNCiAgICAgICAgICAgIHRocm93IG5ldyBO\nb1RyYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0aXZlIikp\nOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRocm93IGV4Y2VwdGlvbiBp\nZiBhIHRyYW5zYWN0aW9uLXJlbGF0ZWQgb3BlcmF0aW9uIGlzIGF0dGVtcHRl\nZCBhbmQNCiAgICAgKiBubyB0cmFuc2FjdGlvbiBpcyBhY3RpdmUuDQogICAg\nICovDQogICAgcHJpdmF0ZSB2b2lkIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0\naW9uKCkgew0KICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm90LWFjdGl2ZSIpKTsNCiAgICB9DQoNCiAgICBw\ndWJsaWMgdm9pZCBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpIHsNCiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCAmJiAhX25v\nbnRyYW5zUmVhZCkNCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vbi10cmFucy1yZWFkIikpOw0KICAg\nIH0NCg0KICAgIHB1YmxpYyB2b2lkIGFzc2VydFdyaXRlT3BlcmF0aW9uKCkg\new0KICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwICYm\nICghX25vbnRyYW5zV3JpdGUNCiAgICAgICAgICAgIHx8IChfYXV0b0RldGFj\naCAmIERFVEFDSF9OT05UWFJFQUQpICE9IDApKQ0KICAgICAgICAgICAgdGhy\nb3cgbmV3IE5vVHJhbnNhY3Rpb25FeGNlcHRpb24oX2xvYy5nZXQoIndyaXRl\nLW9wZXJhdGlvbiIpKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1\ncm4gYW4gb2JqZWN0IG5vdCBmb3VuZCBleGNlcHRpb24gY29udGFpbmluZyBu\nZXN0ZWQgZXhjZXB0aW9ucw0KICAgICAqIGZvciBhbGwgb2YgdGhlIGdpdmVu\nIGZhaWxlZCBvYmplY3RzLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGlj\nIE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG5ld09iamVjdE5vdEZvdW5kRXhj\nZXB0aW9uDQogICAgICAgIChDb2xsZWN0aW9uIGZhaWxlZCkgew0KICAgICAg\nICBUaHJvd2FibGVbXSB0ID0gbmV3IFRocm93YWJsZVtmYWlsZWQuc2l6ZSgp\nXTsNCiAgICAgICAgaW50IGlkeCA9IDA7DQogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gZmFpbGVkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGlk\neCsrKQ0KICAgICAgICAgICAgdFtpZHhdID0gbmV3IE9iamVjdE5vdEZvdW5k\nRXhjZXB0aW9uKGl0ci5uZXh0KCkpOw0KICAgICAgICByZXR1cm4gbmV3IE9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCwgdCk7DQogICAgfQ0KDQog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBG\naW5kQ2FsbGJhY2tzIGltcGxlbWVudGF0aW9uDQogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIHB1YmxpYyBPYmplY3QgcHJv\nY2Vzc0FyZ3VtZW50KE9iamVjdCBvaWQpIHsNCiAgICAgICAgcmV0dXJuIG9p\nZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IHByb2Nlc3NSZXR1cm4o\nT2JqZWN0IG9pZCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgew0KICAgICAg\nICByZXR1cm4gKHNtID09IG51bGwpID8gbnVsbCA6IHNtLmdldE1hbmFnZWRJ\nbnN0YW5jZSgpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCB3cml0ZU9i\namVjdChPYmplY3RPdXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRp\nb24gew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIGxvY2soKTsN\nCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChpc0FjdGl2ZSgpKSB7\nDQogICAgICAgICAgICAgICAgaWYgKCFnZXRPcHRpbWlzdGljKCkpDQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oDQogICAgICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiY2FudC1z\nZXJpYWxpemUtcGVzc2ltaXN0aWMtYnJva2VyIikpOw0KICAgICAgICAgICAg\nICAgIGlmIChoYXNGbHVzaGVkKCkpDQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oDQogICAgICAgICAgICAg\nICAgICAgICAgICBfbG9jLmdldCgiY2FudC1zZXJpYWxpemUtZmx1c2hlZC1i\ncm9rZXIiKSk7DQogICAgICAgICAgICAgICAgaWYgKGhhc0Nvbm5lY3Rpb24o\nKSkNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0\nKCJjYW50LXNlcmlhbGl6ZS1jb25uZWN0ZWQtYnJva2VyIikpOw0KICAgICAg\nICAgICAgfQ0KDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAg\nIF9pc1NlcmlhbGl6aW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBvdXQu\nd3JpdGVPYmplY3QoX2ZhY3RvcnkuZ2V0UG9vbEtleSgpKTsNCiAgICAgICAg\nICAgICAgICBvdXQuZGVmYXVsdFdyaXRlT2JqZWN0KCk7DQogICAgICAgICAg\nICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgIF9pc1NlcmlhbGl6aW5n\nID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZmluYWxseSB7\nDQogICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0K\nICAgIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0KE9iamVjdElucHV0U3RyZWFt\nIGluKQ0KICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwg\nSU9FeGNlcHRpb24gew0KICAgICAgICBPYmplY3QgZmFjdG9yeUtleSA9IGlu\nLnJlYWRPYmplY3QoKTsNCiAgICAgICAgQWJzdHJhY3RCcm9rZXJGYWN0b3J5\nIGZhY3RvcnkgPQ0KICAgICAgICAgICAgQWJzdHJhY3RCcm9rZXJGYWN0b3J5\nLmdldFBvb2xlZEZhY3RvcnlGb3JLZXkoZmFjdG9yeUtleSk7DQoNCiAgICAg\nICAgLy8gdGhpcyBuZWVkcyB0byBoYXBwZW4gYmVmb3JlIGRlZmF1bHRSZWFk\nT2JqZWN0IHNvIHRoYXQgaXQncw0KICAgICAgICAvLyBhdmFpbGFibGUgZm9y\nIGNhbGxzIHRvIGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkgZHVyaW5nDQog\nICAgICAgIC8vIFN0YXRlTWFuYWdlciBkZXNlcmlhbGl6YXRpb24NCiAgICAg\nICAgX2NvbmYgPSBmYWN0b3J5LmdldENvbmZpZ3VyYXRpb24oKTsNCiAgICAg\nICAgDQogICAgICAgIGluLmRlZmF1bHRSZWFkT2JqZWN0KCk7DQogICAgICAg\nIGZhY3RvcnkuaW5pdGlhbGl6ZUJyb2tlcihfbWFuYWdlZCwgX2Nvbm5SZXRh\naW5Nb2RlLCB0aGlzLCB0cnVlKTsNCg0KICAgICAgICAvLyByZS1pbml0aWFs\naXplIHRoZSBsb2NrIGlmIG5lZWRlZC4NCiAgICAgICAgc2V0TXVsdGl0aHJl\nYWRlZChfbXVsdGl0aHJlYWRlZCk7DQoNCiAgICAgICAgaWYgKGlzQWN0aXZl\nKCkgJiYgX3J1bnRpbWUgaW5zdGFuY2VvZiBMb2NhbE1hbmFnZWRSdW50aW1l\nKQ0KICAgICAgICAgICAgKChMb2NhbE1hbmFnZWRSdW50aW1lKSBfcnVudGlt\nZSkuYmVnaW4oKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBXaGV0aGVy\nIG9yIG5vdCB0aGlzIGJyb2tlciBpcyBpbiB0aGUgbWlkc3Qgb2YgYmVpbmcg\nc2VyaWFsaXplZC4NCiAgICAgKg0KICAgICAqIEBzaW5jZSAxLjEuMCANCiAg\nICAgKi8NCiAgICBib29sZWFuIGlzU2VyaWFsaXppbmcoKSB7DQogICAgICAg\nIHJldHVybiBfaXNTZXJpYWxpemluZzsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBUcmFuc2FjdGlvbmFsIGNhY2hlIHRoYXQgaG9sZHMgc29mdCByZWZz\nIHRvIGNsZWFuIGluc3RhbmNlcy4NCiAgICAgKi8NCiAgICBzdGF0aWMgY2xh\nc3MgVHJhbnNhY3Rpb25hbENhY2hlDQogICAgICAgIGltcGxlbWVudHMgU2V0\nLCBTZXJpYWxpemFibGUgew0KDQogICAgICAgIHByaXZhdGUgZmluYWwgYm9v\nbGVhbiBfb3JkZXJEaXJ0eTsNCiAgICAgICAgcHJpdmF0ZSBTZXQgX2RpcnR5\nID0gbnVsbDsNCiAgICAgICAgcHJpdmF0ZSBTZXQgX2NsZWFuID0gbnVsbDsN\nCg0KICAgICAgICBwdWJsaWMgVHJhbnNhY3Rpb25hbENhY2hlKGJvb2xlYW4g\nb3JkZXJEaXJ0eSkgew0KICAgICAgICAgICAgX29yZGVyRGlydHkgPSBvcmRl\nckRpcnR5Ow0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAq\nIFJldHVybiBhIGNvcHkgb2YgYWxsIHRyYW5zYWN0aW9uYWwgc3RhdGUgbWFu\nYWdlcnMuDQogICAgICAgICAqLw0KICAgICAgICBwdWJsaWMgQ29sbGVjdGlv\nbiBjb3B5KCkgew0KICAgICAgICAgICAgaWYgKGlzRW1wdHkoKSkNCiAgICAg\nICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsNCg0K\nICAgICAgICAgICAgLy8gc2l6ZSBtYXkgbm90IGJlIGVudGlyZWx5IGFjY3Vy\nYXRlIGR1ZSB0byByZWZzIGV4cGlyaW5nLCBzbw0KICAgICAgICAgICAgLy8g\nbWFudWFsbHkgY29weSBlYWNoIG9iamVjdDsgZG9lc24ndCBtYXR0ZXIgdGhp\ncyB3YXkgaWYgc2l6ZSB0b28NCiAgICAgICAgICAgIC8vIGJpZyBieSBzb21l\nDQogICAgICAgICAgICBMaXN0IGNvcHkgPSBuZXcgQXJyYXlMaXN0KHNpemUo\nKSk7DQogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwpDQogICAgICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGlydHkuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspDQogICAgICAgICAgICAgICAgICAgIGNvcHku\nYWRkKGl0ci5uZXh0KCkpOw0KICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBu\ndWxsKQ0KICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2Ns\nZWFuLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQ0KICAgICAgICAgICAg\nICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsNCiAgICAgICAgICAgIHJl\ndHVybiBjb3B5Ow0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAg\nICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJz\nLg0KICAgICAgICAgKi8NCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24gY29w\neURpcnR5KCkgew0KICAgICAgICAgICAgaWYgKF9kaXJ0eSA9PSBudWxsIHx8\nIF9kaXJ0eS5pc0VtcHR5KCkpDQogICAgICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1Q7DQogICAgICAgICAgICByZXR1cm4gbmV3\nIEFycmF5TGlzdChfZGlydHkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoq\nDQogICAgICAgICAqIFRyYW5zZmVyIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9t\nIHRoZSBkaXJ0eSBjYWNoZSB0byB0aGUgY2xlYW4gY2FjaGUuDQogICAgICAg\nICAqLw0KICAgICAgICBwdWJsaWMgdm9pZCBmbHVzaGVkKFN0YXRlTWFuYWdl\nckltcGwgc20pIHsNCiAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkgJiYg\nX2RpcnR5ICE9IG51bGwgJiYgX2RpcnR5LnJlbW92ZShzbSkpDQogICAgICAg\nICAgICAgICAgYWRkQ2xlYW5JbnRlcm5hbChzbSk7DQogICAgICAgIH0NCg0K\nICAgICAgICAvKioNCiAgICAgICAgICogQWRkIHRoZSBnaXZlbiBpbnN0YW5j\nZSB0byB0aGUgY2xlYW4gY2FjaGUuDQogICAgICAgICAqLw0KICAgICAgICBw\ndWJsaWMgdm9pZCBhZGRDbGVhbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQog\nICAgICAgICAgICBpZiAoYWRkQ2xlYW5JbnRlcm5hbChzbSkgJiYgX2RpcnR5\nICE9IG51bGwpDQogICAgICAgICAgICAgICAgX2RpcnR5LnJlbW92ZShzbSk7\nDQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGJvb2xlYW4gYWRkQ2xl\nYW5JbnRlcm5hbChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgICAg\nICBpZiAoX2NsZWFuID09IG51bGwpDQogICAgICAgICAgICAgICAgX2NsZWFu\nID0gbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNldC5TT0ZU\nKTsNCiAgICAgICAgICAgIHJldHVybiBfY2xlYW4uYWRkKHNtKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBZGQgdGhlIGdpdmVu\nIGluc3RhbmNlIHRvIHRoZSBkaXJ0eSBjYWNoZS4NCiAgICAgICAgICovDQog\nICAgICAgIHB1YmxpYyB2b2lkIGFkZERpcnR5KFN0YXRlTWFuYWdlckltcGwg\nc20pIHsNCiAgICAgICAgICAgIGlmIChfZGlydHkgPT0gbnVsbCkgew0KICAg\nICAgICAgICAgICAgIGlmIChfb3JkZXJEaXJ0eSkNCiAgICAgICAgICAgICAg\nICAgICAgX2RpcnR5ID0gTWFwQmFja2VkU2V0LmRlY29yYXRlKG5ldyBMaW5r\nZWRNYXAoKSk7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAg\nICAgICAgICBfZGlydHkgPSBuZXcgSGFzaFNldCgpOw0KICAgICAgICAgICAg\nfQ0KICAgICAgICAgICAgaWYgKF9kaXJ0eS5hZGQoc20pKQ0KICAgICAgICAg\nICAgICAgIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20pOw0KICAgICAgICB9DQoN\nCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gaW5z\ndGFuY2UgZnJvbSB0aGUgY2FjaGUuDQogICAgICAgICAqLw0KICAgICAgICBw\ndWJsaWMgYm9vbGVhbiByZW1vdmUoU3RhdGVNYW5hZ2VySW1wbCBzbSkgew0K\nICAgICAgICAgICAgcmV0dXJuIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20pDQog\nICAgICAgICAgICAgICAgfHwgKF9kaXJ0eSAhPSBudWxsICYmIF9kaXJ0eS5y\nZW1vdmUoc20pKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9v\nbGVhbiByZW1vdmVDbGVhbkludGVybmFsKFN0YXRlTWFuYWdlckltcGwgc20p\nIHsNCiAgICAgICAgICAgIHJldHVybiBfY2xlYW4gIT0gbnVsbCAmJiBfY2xl\nYW4ucmVtb3ZlKHNtKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBJ\ndGVyYXRvciBpdGVyYXRvcigpIHsNCiAgICAgICAgICAgIEl0ZXJhdG9yQ2hh\naW4gY2hhaW4gPSBuZXcgSXRlcmF0b3JDaGFpbigpOw0KICAgICAgICAgICAg\naWYgKF9kaXJ0eSAhPSBudWxsICYmICFfZGlydHkuaXNFbXB0eSgpKQ0KICAg\nICAgICAgICAgICAgIGNoYWluLmFkZEl0ZXJhdG9yKF9kaXJ0eS5pdGVyYXRv\ncigpKTsNCiAgICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCAmJiAhX2Ns\nZWFuLmlzRW1wdHkoKSkNCiAgICAgICAgICAgICAgICBjaGFpbi5hZGRJdGVy\nYXRvcihfY2xlYW4uaXRlcmF0b3IoKSk7DQogICAgICAgICAgICByZXR1cm4g\nY2hhaW47DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgYm9vbGVhbiBj\nb250YWlucyhPYmplY3Qgb2JqKSB7DQogICAgICAgICAgICByZXR1cm4gKF9k\naXJ0eSAhPSBudWxsICYmIF9kaXJ0eS5jb250YWlucyhvYmopKQ0KICAgICAg\nICAgICAgICAgIHx8IChfY2xlYW4gIT0gbnVsbCAmJiBfY2xlYW4uY29udGFp\nbnMob2JqKSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBjb250YWluc0FsbChDb2xsZWN0aW9uIGNvbGwpIHsNCiAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykNCiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5zKGl0ci5u\nZXh0KCkpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAg\nIHB1YmxpYyB2b2lkIGNsZWFyKCkgew0KICAgICAgICAgICAgaWYgKF9kaXJ0\neSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIF9kaXJ0eSA9IG51bGw7DQog\nICAgICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwpDQogICAgICAgICAgICAg\nICAgX2NsZWFuID0gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGlzRW1wdHkoKSB7DQogICAgICAgICAgICByZXR1cm4gKF9k\naXJ0eSA9PSBudWxsIHx8IF9kaXJ0eS5pc0VtcHR5KCkpDQogICAgICAgICAg\nICAgICAgJiYgKF9jbGVhbiA9PSBudWxsIHx8IF9jbGVhbi5pc0VtcHR5KCkp\nOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBzaXplKCkgew0K\nICAgICAgICAgICAgaW50IHNpemUgPSAwOw0KICAgICAgICAgICAgaWYgKF9k\naXJ0eSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHNpemUgKz0gX2RpcnR5\nLnNpemUoKTsNCiAgICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICBzaXplICs9IF9jbGVhbi5zaXplKCk7DQogICAgICAg\nICAgICByZXR1cm4gc2l6ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGFkZChPYmplY3Qgb2JqKSB7DQogICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChDb2xsZWN0\naW9uIGNvbGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZE9wZXJhdGlvbkV4Y2VwdGlvbigpOw0KICAgICAgICB9DQoNCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBvYmopIHsNCiAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigp\nOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3Zl\nQWxsKENvbGxlY3Rpb24gY29sbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7DQogICAgICAgIH0N\nCg0KICAgICAgICBwdWJsaWMgYm9vbGVhbiByZXRhaW5BbGwoQ29sbGVjdGlv\nbiBjKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVy\nYXRpb25FeGNlcHRpb24oKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1Ymxp\nYyBPYmplY3RbXSB0b0FycmF5KCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7DQogICAgICAgIH0N\nCg0KICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheShPYmplY3RbXSBh\ncnIpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJh\ndGlvbkV4Y2VwdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogVW5pcXVlIGlkIGZvciBzdGF0ZSBtYW5hZ2VycyBvZiBuZXcg\nZGF0YXN0b3JlIGluc3RhbmNlcyB3aXRob3V0IGFzc2lnbmVkDQogICAgICog\nb2JqZWN0IGlkcy4NCiAgICAgKi8NCiAgICBwcml2YXRlIHN0YXRpYyBjbGFz\ncyBTdGF0ZU1hbmFnZXJJZA0KICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6\nYWJsZSB7DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nU1RSSU5HX1BSRUZJWCA9ICJvcGVuanBhc206IjsNCg0KICAgICAgICBwcml2\nYXRlIHN0YXRpYyBsb25nIF9nZW5lcmF0b3IgPSAwOw0KDQogICAgICAgIHBy\naXZhdGUgZmluYWwgaW50IF9iaGFzaDsNCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBsb25nIF9pZDsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIFN0YXRlTWFu\nYWdlcklkIG5ld0luc3RhbmNlKEJyb2tlciBiKSB7DQogICAgICAgICAgICBy\nZXR1cm4gbmV3IFN0YXRlTWFuYWdlcklkKFN5c3RlbS5pZGVudGl0eUhhc2hD\nb2RlKGIpLCBfZ2VuZXJhdG9yKyspOw0KICAgICAgICB9DQoNCiAgICAgICAg\ncHJpdmF0ZSBTdGF0ZU1hbmFnZXJJZChpbnQgYmhhc2gsIGxvbmcgaWQpIHsN\nCiAgICAgICAgICAgIF9iaGFzaCA9IGJoYXNoOw0KICAgICAgICAgICAgX2lk\nID0gaWQ7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgU3RhdGVNYW5h\nZ2VySWQoU3RyaW5nIHN0cikgew0KICAgICAgICAgICAgc3RyID0gc3RyLnN1\nYnN0cmluZyhTVFJJTkdfUFJFRklYLmxlbmd0aCgpKTsNCiAgICAgICAgICAg\nIGludCBpZHggPSBzdHIuaW5kZXhPZignOicpOw0KICAgICAgICAgICAgX2Jo\nYXNoID0gSW50ZWdlci5wYXJzZUludChzdHIuc3Vic3RyaW5nKDAsIGlkeCkp\nOw0KICAgICAgICAgICAgX2lkID0gTG9uZy5wYXJzZUxvbmcoc3RyLnN1YnN0\ncmluZyhpZHggKyAxKSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7DQogICAgICAgICAgICBp\nZiAob3RoZXIgPT0gdGhpcykNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsNCiAgICAgICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgU3RhdGVN\nYW5hZ2VySWQpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAg\nICAgICAgICAgIFN0YXRlTWFuYWdlcklkIHNpZCA9IChTdGF0ZU1hbmFnZXJJ\nZCkgb3RoZXI7DQogICAgICAgICAgICByZXR1cm4gX2JoYXNoID09IHNpZC5f\nYmhhc2ggJiYgX2lkID09IHNpZC5faWQ7DQogICAgICAgIH0NCg0KICAgICAg\nICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgew0KICAgICAgICAgICAgcmV0dXJu\nIChpbnQpIChfaWQgXiAoX2lkID4+PiAzMikpOw0KICAgICAgICB9DQoNCiAg\nICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsNCiAgICAgICAgICAg\nIHJldHVybiBTVFJJTkdfUFJFRklYICsgX2JoYXNoICsgIjoiICsgX2lkOw0K\nICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29sbGVjdGlv\nbiB0eXBlIHRoYXQgaG9sZHMgc3RhdGUgbWFuYWdlcnMgYnV0IHdob3NlIGlu\ndGVyZmFjZSBkZWFscw0KICAgICAqIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcg\nbWFuYWdlZCBvYmplY3RzLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uDQogICAgICAgIGV4dGVu\nZHMgQWJzdHJhY3RDb2xsZWN0aW9uIHsNCg0KICAgICAgICBwcml2YXRlIGZp\nbmFsIENvbGxlY3Rpb24gX3N0YXRlczsNCg0KICAgICAgICBwdWJsaWMgTWFu\nYWdlZE9iamVjdENvbGxlY3Rpb24oQ29sbGVjdGlvbiBzdGF0ZXMpIHsNCiAg\nICAgICAgICAgIF9zdGF0ZXMgPSBzdGF0ZXM7DQogICAgICAgIH0NCg0KICAg\nICAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRTdGF0ZU1hbmFnZXJzKCkgew0K\nICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZXM7DQogICAgICAgIH0NCg0KICAg\nICAgICBwdWJsaWMgaW50IHNpemUoKSB7DQogICAgICAgICAgICByZXR1cm4g\nX3N0YXRlcy5zaXplKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMg\nSXRlcmF0b3IgaXRlcmF0b3IoKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3\nIEl0ZXJhdG9yKCkgew0KICAgICAgICAgICAgICAgIHByaXZhdGUgZmluYWwg\nSXRlcmF0b3IgX2l0ciA9IF9zdGF0ZXMuaXRlcmF0b3IoKTsNCg0KICAgICAg\nICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7DQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBfaXRyLmhhc05leHQoKTsNCiAgICAgICAg\nICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBwdWJsaWMgT2JqZWN0IG5l\neHQoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIpIF9pdHIubmV4dCgpKS4NCiAgICAgICAgICAgICAgICAg\nICAgICAgIGdldE1hbmFnZWRJbnN0YW5jZSgpOw0KICAgICAgICAgICAgICAg\nIH0NCg0KICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZSgpIHsN\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFzc2lnbiB0\naGUgb2JqZWN0IGlkIHRvIHRoZSBjYWNoZS4gRXhjZXB0aW9uIHdpbGwgYmUN\nCiAgICAgKiB0aHJvd24gaWYgdGhlIGlkIGFscmVhZHkgZXhpc3RzIGluIHRo\nZSBjYWNoZS4gDQogICAgICovDQogICAgcHJvdGVjdGVkIHZvaWQgYXNzaWdu\nT2JqZWN0SWQoT2JqZWN0IGNhY2hlLCBPYmplY3QgaWQsIA0KICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgICgoTWFuYWdlZENhY2hl\nKSBjYWNoZSkuYXNzaWduT2JqZWN0SWQoaWQsIHNtKTsgDQogICAgfQ0KDQog\nICAgLyoqIA0KICAgICAqIFRoaXMgbWV0aG9kIG1ha2VzIHN1cmUgd2UgZG9u\nJ3QgYWxyZWFkeSBoYXZlIHRoZSBpbnN0YW5jZSBjYWNoZWQNCiAgICAgKi8N\nCiAgICBwcm90ZWN0ZWQgdm9pZCBjaGVja0ZvckR1cGxpY2F0ZUlkKE9iamVj\ndCBpZCwgT2JqZWN0IG9iaikgew0KICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIG90aGVyID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQoaWQsIGZhbHNlKTsN\nCiAgICAgICAgaWYgKG90aGVyICE9IG51bGwgJiYgIW90aGVyLmlzRGVsZXRl\nZCgpICYmICFvdGhlci5pc05ldygpKQ0KICAgICAgICAgICAgdGhyb3cgbmV3\nIE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdldCgiY2FjaGUtZXhpc3Rz\nIiwNCiAgICAgICAgICAgICAgICBvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCks\nIGlkKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7DQogICAgfQ0KfQ0K\n","encoding":"base64"}

