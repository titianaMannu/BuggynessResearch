{"sha":"b821825c8b4aa5e713249658d476416517d7f007","node_id":"MDQ6QmxvYjIwNjM2NDpiODIxODI1YzhiNGFhNWU3MTMyNDk2NThkNDc2NDE2NTE3ZDdmMDA3","size":29964,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b821825c8b4aa5e713249658d476416517d7f007","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuRGV0YWNoT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5DYWxsYmFja01vZGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHlNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBIYW5kbGVzIGRldGFjaGluZyBpbnN0YW5jZXMuCiAqCiAq\nIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBub2phdmFkb2MKICov\nCnB1YmxpYyBjbGFzcyBEZXRhY2hNYW5hZ2VyCiAgICBpbXBsZW1lbnRzIERl\ndGFjaFN0YXRlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKERldGFjaE1hbmFnZXIuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgZmluYWwgQnJva2VySW1wbCBfYnJva2VyOwogICAg\ncHJpdmF0ZSBmaW5hbCBib29sZWFuIF9jb3B5OwogICAgcHJpdmF0ZSBmaW5h\nbCBib29sZWFuIF9mdWxsOwogICAgcHJpdmF0ZSBmaW5hbCBQcm94eU1hbmFn\nZXIgX3Byb3h5OwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hPcHRpb25zIF9v\ncHRzOwogICAgcHJpdmF0ZSBmaW5hbCBPcENhbGxiYWNrcyBfY2FsbDsKICAg\nIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfZmFpbEZhc3Q7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2ZsdXNoZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfZmx1c2hCZWZvcmVEZXRhY2g7CgogICAgLy8gaWYgd2UncmUgbm90IGRl\ndGFjaGluZyBmdWxsLCB3ZSBuZWVkIHRvIHRyYWNrIGFsbCBkZXRhY2hlZCBv\nYmplY3RzOwogICAgLy8gaWYgd2UgYXJlLCB0aGVuIHdlIHVzZSBhIHNwZWNp\nYWwgZmllbGQgbWFuYWdlciBmb3IgbW9yZSBlZmZpY2llbnQKICAgIC8vIGRl\ndGFjaG1lbnQgdGhhbiB0aGUgc3RhbmRhcmQgb25lCiAgICBwcml2YXRlIGZp\nbmFsIElkZW50aXR5TWFwIF9kZXRhY2hlZDsKICAgIHByaXZhdGUgZmluYWwg\nRGV0YWNoRmllbGRNYW5hZ2VyIF9mdWxsRk07CgogICAgLyoqCiAgICAgKiBV\nc2VkIHRvIHByZXBhcmUgYSBkZXRhY2hhYmxlIGluc3RhbmNlIHRoYXQgZG9l\ncyBub3QgZXh0ZXJuYWxpemUKICAgICAqIGRldGFjaGVkIHN0YXRlLgogICAg\nICovCiAgICBzdGF0aWMgYm9vbGVhbiBwcmVTZXJpYWxpemUoU3RhdGVNYW5h\nZ2VySW1wbCBzbSkgewogICAgICAgIGlmICghc20uaXNQZXJzaXN0ZW50KCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKHNtLmdl\ndEJyb2tlcigpLmdldENvbmZpZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5\nSW5zdGFuY2UoKQogICAgICAgICAgICAgICAgLmdldEZsdXNoQmVmb3JlRGV0\nYWNoKCkpIHsKICAgICAgICAgICAgZmx1c2hEaXJ0eShzbSk7CiAgICAgICAg\nfQoKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBzbS5nZXRNZXRhRGF0\nYSgpOwogICAgICAgIGJvb2xlYW4gc2V0U3RhdGUgPSBtZXRhLmdldERldGFj\naGVkU3RhdGUoKSAhPSBudWxsCiAgICAgICAgICAgICYmICFDbGFzc01ldGFE\nYXRhLlNZTlRIRVRJQy5lcXVhbHMobWV0YS5nZXREZXRhY2hlZFN0YXRlKCkp\nOwogICAgICAgIEJpdFNldCBpZHhzID0gKHNldFN0YXRlKSA/IG5ldyBCaXRT\nZXQobWV0YS5nZXRGaWVsZHMoKS5sZW5ndGgpIDogbnVsbDsKICAgICAgICBw\ncmVEZXRhY2goc20uZ2V0QnJva2VyKCksIHNtLCBpZHhzKTsKCiAgICAgICAg\naWYgKHNldFN0YXRlKSB7CiAgICAgICAgICAgIHNtLmdldFBlcnNpc3RlbmNl\nQ2FwYWJsZSgpLnBjU2V0RGV0YWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0YXRl\nCiAgICAgICAgICAgICAgICAoc20sIGlkeHMpKTsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOyAvLyBkb24ndCBudWxsIHN0YXRlCiAgICAgICAgfQogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVXNlZCBi\neSBjbGFzc2VzIHRoYXQgZXh0ZXJuYWxpemUgZGV0YWNoZWQgc3RhdGUuCiAg\nICAgKgogICAgICogQHJldHVybiB3aGV0aGVyIHRvIHVzZSBhIGRldGFjaGVk\nIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgc3RhdGljIGJvb2xlYW4gd3Jp\ndGVEZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwgc20sIE9iamVjdE91\ndHB1dCBvdXQsCiAgICAgICAgQml0U2V0IGlkeHMpCiAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXNtLmlzUGVyc2lzdGVudCgp\nKSB7CiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsgLy8gc3Rh\ndGUKICAgICAgICAgICAgb3V0LndyaXRlT2JqZWN0KG51bGwpOyAvLyBzbQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAv\nLyBkaXJ0eSBzdGF0ZSBjYXVzZXMgZmx1c2gKICAgICAgICBmbHVzaERpcnR5\nKHNtKTsKCiAgICAgICAgQnJva2VyIGJyb2tlciA9IHNtLmdldEJyb2tlcigp\nOwogICAgICAgIHByZURldGFjaChicm9rZXIsIHNtLCBpZHhzKTsKCiAgICAg\nICAgLy8gd3JpdGUgZGV0YWNoZWQgc3RhdGUgb2JqZWN0IGFuZCBzdGF0ZSBt\nYW5hZ2VyCiAgICAgICAgRGV0YWNoT3B0aW9ucyBvcHRzID0gYnJva2VyLmdl\ndENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0RGV0YWNoU3RhdGVJ\nbnN0YW5jZSgpOwogICAgICAgIGlmICghb3B0cy5nZXREZXRhY2hlZFN0YXRl\nTWFuYWdlcigpCiAgICAgICAgICAgIHx8ICF1c2VEZXRhY2hlZFN0YXRlTWFu\nYWdlcihzbSwgb3B0cykpIHsKICAgICAgICAgICAgb3V0LndyaXRlT2JqZWN0\nKGdldERldGFjaGVkU3RhdGUoc20sIGlkeHMpKTsKICAgICAgICAgICAgb3V0\nLndyaXRlT2JqZWN0KG51bGwpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQogICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsKICAg\nICAgICBvdXQud3JpdGVPYmplY3QobmV3IERldGFjaGVkU3RhdGVNYW5hZ2Vy\nKHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpLAogICAgICAgICAgICBzbSwg\naWR4cywgb3B0cy5nZXRBY2Nlc3NVbmxvYWRlZCgpLCBicm9rZXIuZ2V0TXVs\ndGl0aHJlYWRlZCgpKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWFkeSB0aGUgb2JqZWN0IGZvciBkZXRhY2htZW50\nLCBpbmNsdWRpbmcgbG9hZGluZyB0aGUgZmllbGRzIHRvIGJlCiAgICAgKiBk\nZXRhY2hlZCBhbmQgdXBkYXRpbmcgdmVyc2lvbiBpbmZvcm1hdGlvbi4KICAg\nICAqCiAgICAgKiBAcGFyYW0gaWR4cyB0aGUgaW5kZXhlcyBvZiBmaWVsZHMg\ndG8gZGV0YWNoIHdpbGwgYmUgc2V0IGFzIGEgc2lkZQogICAgICogZWZmZWN0\nIG9mIHRoaXMgbWV0aG9kCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZv\naWQgcHJlRGV0YWNoKEJyb2tlciBicm9rZXIsIFN0YXRlTWFuYWdlckltcGwg\nc20sCiAgICAgICAgQml0U2V0IGlkeHMpIHsKICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIGV4aXN0aW5nIG9iamVjdCBoYXMgdGhlIHJpZ2h0IGZpZWxkcyBm\nZXRjaGVkOyBjYWxsCiAgICAgICAgLy8gZXZlbiBpZiB1c2luZyBjdXJyZW50\nbHktbG9hZGVkIGZpZWxkcyBmb3IgZGV0YWNoIHRvIG1ha2Ugc3VyZQogICAg\nICAgIC8vIHZlcnNpb24gaXMgc2V0CiAgICAgICAgaW50IGRldGFjaE1vZGUg\nPSBicm9rZXIuZ2V0RGV0YWNoU3RhdGUoKTsKICAgICAgICBpbnQgbG9hZE1v\nZGUgPSBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTOwogICAgICAgIEJpdFNl\ndCBleGNsdWRlID0gbnVsbDsKICAgICAgICBpZiAoZGV0YWNoTW9kZSA9PSBE\nRVRBQ0hfTE9BREVEKQogICAgICAgICAgICBleGNsdWRlID0gU3RvcmVDb250\nZXh0LkVYQ0xVREVfQUxMOwogICAgICAgIGVsc2UgaWYgKGRldGFjaE1vZGUg\nPT0gREVUQUNIX0FMTCkKICAgICAgICAgICAgbG9hZE1vZGUgPSBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfQUxMOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHNtLmxvYWQoYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpLCBsb2Fk\nTW9kZSwgZXhjbHVkZSwgbnVsbCwgCiAgICAgICAgICAgICAgICBmYWxzZSk7\nCiAgICAgICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25m\nZSkgewogICAgICAgICAgICAvLyBjb25zdW1lIHRoZSBleGNlcHRpb24KICAg\nICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBiaXRzZXQgb2YgZmllbGRzIHRv\nIGRldGFjaDsgaWYgbW9kZSBpcyBhbGwgd2UgY2FuIHVzZQogICAgICAgIC8v\nIGN1cnJlbnRseSBsb2FkZWQgYml0c2V0IGNsb25lLCBzaW5jZSB3ZSBrbm93\nIGFsbCBmaWVsZHMgYXJlIGxvYWRlZAogICAgICAgIGlmIChpZHhzICE9IG51\nbGwpIHsKICAgICAgICAgICAgaWYgKGRldGFjaE1vZGUgPT0gREVUQUNIX0ZF\nVENIX0dST1VQUykKICAgICAgICAgICAgICAgIHNldEZldGNoR3JvdXBGaWVs\nZHMoYnJva2VyLCBzbSwgaWR4cyk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGlkeHMub3Ioc20uZ2V0TG9hZGVkKCkpOwoKICAgICAgICAg\nICAgLy8gY2xlYXIgbHJzIGZpZWxkcwogICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLmlzTFJTKCkpCiAgICAg\nICAgICAgICAgICAgICAgaWR4cy5jbGVhcihpKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgZGV0YWNoZWQgc3RhdGUg\nZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgT2JqZWN0IGdldERldGFjaGVkU3RhdGUoU3RhdGVNYW5hZ2VySW1w\nbCBzbSwgQml0U2V0IGZpZWxkcykgewogICAgICAgIC8vIGlmIGRhdGFzdG9y\nZSwgc3RvcmUgaWQgaW4gZmlyc3QgZWxlbWVudAogICAgICAgIGludCBvZmZz\nZXQgPSAoc20uZ2V0TWV0YURhdGEoKS5nZXRJZGVudGl0eVR5cGUoKSA9PQog\nICAgICAgICAgICBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSkgPyAxIDog\nMDsKCiAgICAgICAgLy8gbWFrZSB2ZXJzaW9uIHN0YXRlIGFycmF5IG9uZSBs\nYXJnZXIgZm9yIG5ldyBpbnN0YW5jZXM7IG1hcmtzIG5ldwogICAgICAgIC8v\nIGluc3RhbmNlcyB3aXRob3V0IGFmZmVjdGluZyBzZXJpYWxpemF0aW9uIHNp\nemUgbXVjaAogICAgICAgIE9iamVjdFtdIHN0YXRlOwogICAgICAgIGlmIChz\nbS5pc05ldygpKQogICAgICAgICAgICBzdGF0ZSA9IG5ldyBPYmplY3RbMyAr\nIG9mZnNldF07CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdGF0ZSA9IG5l\ndyBPYmplY3RbMiArIG9mZnNldF07CgogICAgICAgIGlmIChvZmZzZXQgPiAw\nKSB7CiAgICAgICAgICAgIE9iamVjdCBpZDsKICAgICAgICAgICAgaWYgKHNt\nLmlzRW1iZWRkZWQoKSB8fCBzbS5nZXRPYmplY3RJZCgpID09IG51bGwpCiAg\nICAgICAgICAgICAgICBpZCA9IHNtLmdldElkKCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGlkID0gc20uZ2V0T2JqZWN0SWQoKTsKICAg\nICAgICAgICAgc3RhdGVbMF0gPSBpZC50b1N0cmluZygpOwogICAgICAgIH0K\nICAgICAgICBzdGF0ZVtvZmZzZXRdID0gc20uZ2V0VmVyc2lvbigpOwogICAg\nICAgIHN0YXRlW29mZnNldCArIDFdID0gZmllbGRzOwogICAgICAgIHJldHVy\nbiBzdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIG9yIGludm9r\nZSBwcmUtc3RvcmUgY2FsbGJhY2tzIG9uIHRoZSBnaXZlbiBicm9rZXIgaWYK\nICAgICAqIG5lZWRlZC4gUmV0dXJuIHRydWUgaWYgZmx1c2hlZC9zdG9yZWQs\nIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiBmbHVzaERpcnR5KFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAg\nICAgICBpZiAoIXNtLmlzRGlydHkoKSB8fCAhc20uZ2V0QnJva2VyKCkuaXNB\nY3RpdmUoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAv\nLyBvbmx5IGZsdXNoIGlmIHRoZXJlIGFyZSBhY3R1YWxseSBhbnkgZGlydHkg\nbm9uLWZsdXNoZWQgZmllbGRzCiAgICAgICAgQml0U2V0IGRpcnR5RmllbGRz\nID0gc20uZ2V0RGlydHkoKTsKICAgICAgICBCaXRTZXQgZmx1c2hlZEZpZWxk\ncyA9IHNtLmdldEZsdXNoZWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGRpcnR5RmllbGRzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIGlm\nIChkaXJ0eUZpZWxkcy5nZXQoaSkgJiYgIWZsdXNoZWRGaWVsZHMuZ2V0KGkp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoc20uZ2V0QnJva2VyKCkuZ2V0Um9s\nbGJhY2tPbmx5KCkpCiAgICAgICAgICAgICAgICAgICAgc20uZ2V0QnJva2Vy\nKCkucHJlRmx1c2goKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICBzbS5nZXRCcm9rZXIoKS5mbHVzaCgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgYml0IHNldCBmb3IgdGhlIGZpZWxkcyBpbiB0aGUgY3VycmVudCBm\nZXRjaCBncm91cHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQg\nc2V0RmV0Y2hHcm91cEZpZWxkcyhCcm9rZXIgYnJva2VyLAogICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc20sIEJpdFNldCBpZHhzKSB7CiAgICAgICAgRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoID0gYnJva2VyLmdldEZldGNoQ29uZmln\ndXJhdGlvbigpOwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gc20u\nZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKGZtZHNbaV0uaXNQcmltYXJ5S2V5KCkgfHwgZmV0Y2gucmVxdWlyZXNGZXRj\naChmbWRzW2ldKQogICAgICAgICAgICAgICAgIT0gRmV0Y2hDb25maWd1cmF0\naW9uLkZFVENIX05PTkUpCiAgICAgICAgICAgICAgICBpZHhzLnNldChpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4K\nICAgICAqCiAgICAgKiBAcGFyYW0gYnJva2VyIG93bmluZyBicm9rZXIKICAg\nICAqIEBwYXJhbSBmdWxsIHdoZXRoZXIgdGhlIGVudGlyZSBicm9rZXIgY2Fj\naGUgaXMgYmVpbmcgZGV0YWNoZWQ7IGlmCiAgICAgKiB0aGlzIGlzIHRoZSBj\nYXNlLCB3ZSBhc3N1bWUgdGhlIGJyb2tlciBoYXMgYWxyZWFkeQogICAgICog\nZmx1c2hlZCBpZiBuZWVkZWQsIGFuZCB0aGF0IHdlJ3JlIGRldGFjaGluZyBp\nbi1wbGFjZQogICAgICovCiAgICBwdWJsaWMgRGV0YWNoTWFuYWdlcihCcm9r\nZXJJbXBsIGJyb2tlciwgYm9vbGVhbiBmdWxsLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAgICBfcHJveHkg\nPSBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldFByb3h5TWFuYWdlcklu\nc3RhbmNlKCk7CiAgICAgICAgX29wdHMgPSBicm9rZXIuZ2V0Q29uZmlndXJh\ndGlvbigpLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBfY29w\neSA9ICFmdWxsOwogICAgICAgIF9mbHVzaGVkID0gZnVsbDsKICAgICAgICBf\nY2FsbCA9IGNhbGw7CiAgICAgICAgX2ZhaWxGYXN0ID0gKGJyb2tlci5nZXRD\nb25maWd1cmF0aW9uKCkuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2Uo\nKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVs\ndHMoKS5nZXRDYWxsYmFja01vZGUoKQogICAgICAgICAgICAmIENhbGxiYWNr\nTW9kZXMuQ0FMTEJBQ0tfRkFJTF9GQVNUKSAhPSAwOwoKICAgICAgICAvLyB3\nZSBjYW4gb25seSByZWx5IG9uIG91ciAiYWxsIiBzaG9ydGN1dHMgaWYgd2Ug\na25vdyB3ZSB3b24ndCBiZQogICAgICAgIC8vIGxvYWRpbmcgYW55IG1vcmUg\nZGF0YQogICAgICAgIF9mdWxsID0gZnVsbCAmJiBicm9rZXIuZ2V0RGV0YWNo\nU3RhdGUoKSA9PSBEZXRhY2hTdGF0ZS5ERVRBQ0hfTE9BREVEOwogICAgICAg\nIGlmIChfZnVsbCkgewogICAgICAgICAgICBfZGV0YWNoZWQgPSBudWxsOwog\nICAgICAgICAgICBfZnVsbEZNID0gbmV3IERldGFjaEZpZWxkTWFuYWdlcigp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9kZXRhY2hlZCA9IG5l\ndyBJZGVudGl0eU1hcCgpOwogICAgICAgICAgICBfZnVsbEZNID0gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgX2ZsdXNoQmVmb3JlRGV0YWNoID0KICAgICAg\nICAgICAgICAgIGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0\naWJpbGl0eUluc3RhbmNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmdl\ndEZsdXNoQmVmb3JlRGV0YWNoKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBkZXRhY2hlZCB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBpbnN0YW5j\nZS4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBkZXRhY2goT2JqZWN0IHRv\nRGV0YWNoKSB7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBkZXRhY2hJbnRlcm5hbCh0b0Rl\ndGFjaCk7CiAgICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2Up\nIHsKICAgICAgICAgICAgZXhjZXBzID0gbmV3IEFycmF5TGlzdCgxKTsKICAg\nICAgICAgICAgZXhjZXBzLmFkZChjZSk7CiAgICAgICAgICAgIHJldHVybiBu\ndWxsOyAvLyB3b24ndCBiZSByZWFjaGVkIGFzIGV4Y2VwdGlvbiB3aWxsIGJl\nIHJldGhyb3duCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKGV4Y2VwcyA9PSBudWxsIHx8ICFfZmFpbEZhc3QpCiAgICAgICAgICAgICAg\nICBleGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9ucy5zaW5n\nbGV0b24odG9EZXRhY2gpLAogICAgICAgICAgICAgICAgICAgIGV4Y2Vwcyk7\nCiAgICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAgICAgICAgICB0aHJvd0V4\nY2VwdGlvbnMoZXhjZXBzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gZGV0YWNoZWQgdmVyc2lvbnMgb2YgYWxsIHRoZSBnaXZl\nbiBpbnN0YW5jZXMuIElmIG5vdCBjb3B5aW5nLAogICAgICogbnVsbCB3aWxs\nIGJlIHJldHVybmVkLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0\nYWNoQWxsKENvbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgTGlzdCBl\neGNlcHMgPSBudWxsOwogICAgICAgIExpc3QgZGV0YWNoZWQgPSBudWxsOwog\nICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgZGV0YWNoZWQgPSBuZXcg\nQXJyYXlMaXN0KGluc3RhbmNlcy5zaXplKCkpOwoKICAgICAgICBib29sZWFu\nIGZhaWxGYXN0ID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nT2JqZWN0IGRldGFjaDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBpbnN0YW5jZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgICAgIGRldGFjaCA9IGRldGFjaEludGVybmFsKGl0ci5uZXh0\nKCkpOwogICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAg\nICAgICAgIGRldGFjaGVkLmFkZChkZXRhY2gpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIGlmIChyZSBpbnN0YW5jZW9mIENhbGxiYWNrRXhjZXB0\naW9uICYmIF9mYWlsRmFzdCkKICAgICAgICAgICAgICAgIGZhaWxGYXN0ID0g\ndHJ1ZTsKICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICghZmFpbEZhc3Qp\nCiAgICAgICAgICAgICAgICBleGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChp\nbnN0YW5jZXMsIGV4Y2Vwcyk7CiAgICAgICAgICAgIGlmIChfZGV0YWNoZWQg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hlZC5jbGVhcigpOwog\nICAgICAgIH0KICAgICAgICB0aHJvd0V4Y2VwdGlvbnMoZXhjZXBzKTsKCiAg\nICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQu\ndG9BcnJheSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogSW52b2tlIHBvc3REZXRhY2goKSBvbiBhbnkgZGV0YWNoZWQg\naW5zdGFuY2VzIHRoYXQgaW1wbGVtZW50CiAgICAgKiBQb3N0RGV0YWNoQ2Fs\nbGJhY2suIFRoaXMgd2lsbCBiZSBkb25lIGFmdGVyIHRoZSBlbnRpcmUgZ3Jh\ncGggaGFzCiAgICAgKiBiZWVuIGRldGFjaGVkLiBUaGlzIG1ldGhvZCBoYXMg\ndGhlIHNpZGUtZWZmZWN0IG9mIGFsc28gY2xlYXJpbmcKICAgICAqIG91dCB0\naGUgbWFwIG9mIGFsbCBkZXRhY2hlZCBpbnN0YW5jZXMuCiAgICAgKi8KICAg\nIHByaXZhdGUgTGlzdCBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9uIG9i\nanMsIExpc3QgZXhjZXBzKSB7CiAgICAgICAgSXRlcmF0b3IgaXRyID0gKF9m\ndWxsKSA/IG9ianMuaXRlcmF0b3IoKQogICAgICAgICAgICA6IF9kZXRhY2hl\nZC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CgogICAgICAgIE9iamVjdCBvcmln\nLCBkZXRhY2hlZDsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAg\nd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgaWYgKF9mdWxs\nKSB7CiAgICAgICAgICAgICAgICBvcmlnID0gaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGRldGFjaGVkID0gb3JpZzsKICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgICAgIG9yaWcgPSBlbnRyeS5nZXRLZXkoKTsK\nICAgICAgICAgICAgICAgIGRldGFjaGVkID0gZW50cnkuZ2V0VmFsdWUoKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbChvcmlnLCB0cnVlKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNs\nZUV2ZW50KGRldGFjaGVkLCBvcmlnLAogICAgICAgICAgICAgICAgICAgICAg\nICBzbS5nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9ERVRB\nQ0gpOwogICAgICAgICAgICB9IGNhdGNoIChDYWxsYmFja0V4Y2VwdGlvbiBj\nZSkgewogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgY2Up\nOwogICAgICAgICAgICAgICAgaWYgKF9mYWlsRmFzdCkKICAgICAgICAgICAg\nICAgICAgICBicmVhazsgLy8gZG9uJ3QgY29udGludWUgcHJvY2Vzc2luZwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGNlcHM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXhjZXB0aW9uIHRvIHRo\nZSBsaXN0LgogICAgICovCiAgICBwcml2YXRlIExpc3QgYWRkKExpc3QgZXhj\nZXBzLCBSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgaWYgKGV4Y2Vw\ncyA9PSBudWxsKQogICAgICAgICAgICBleGNlcHMgPSBuZXcgTGlua2VkTGlz\ndCgpOwogICAgICAgIGV4Y2Vwcy5hZGQocmUpOwogICAgICAgIHJldHVybiBl\neGNlcHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBhbGwgZ2F0aGVy\nZWQgZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRocm93\nRXhjZXB0aW9ucyhMaXN0IGV4Y2VwcykgewogICAgICAgIGlmIChleGNlcHMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoZXhj\nZXBzLnNpemUoKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4\nY2VwdGlvbikgZXhjZXBzLmdldCgwKTsKICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKS4KICAgICAg\nICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10pIGV4Y2Vw\ncy50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNl\ncHMuc2l6ZSgpXSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0YWNoLgog\nICAgICovCiAgICBwcml2YXRlIE9iamVjdCBkZXRhY2hJbnRlcm5hbChPYmpl\nY3QgdG9EZXRhY2gpIHsKICAgICAgICBpZiAodG9EZXRhY2ggPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGFscmVhZHkg\nZGV0YWNoZWQ/CiAgICAgICAgaWYgKF9kZXRhY2hlZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIE9iamVjdCBkZXRhY2hlZCA9IF9kZXRhY2hlZC5nZXQodG9E\nZXRhY2gpOwogICAgICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBkZXRhY2hlZDsKICAgICAgICB9CgogICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBfYnJva2VyLmdldFN0YXRlTWFu\nYWdlckltcGwodG9EZXRhY2gsIHRydWUpOwogICAgICAgIGlmIChfY2FsbCAh\nPSBudWxsICYmIChfY2FsbC5wcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfREVUQUNILAogICAgICAgICAgICB0b0RldGFjaCwgc20pICYgT3BDYWxs\nYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRvRGV0\nYWNoOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gdG9EZXRhY2g7CgogICAgICAgIC8vIENhbGwgUHJlRGV0YWNoIGZpcnN0\nIGFzIHdlIGNhbid0IHRlbGwgaWYgdGhlIG5ldyBzeXN0ZW0KICAgICAgICAv\nLyBmaXJlZCBhbiBldmVudCBvciBqdXN0IGRpZCBub3QgZmFpbC4KICAgICAg\nICBfYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudCh0b0RldGFjaCwgbnVsbCwg\nc20uZ2V0TWV0YURhdGEoKSwKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnQu\nQkVGT1JFX0RFVEFDSCk7CgogICAgICAgIGlmKCEgX2ZsdXNoZWQpICB7CiAg\nICAgICAgICAgIGlmKF9mbHVzaEJlZm9yZURldGFjaCkgewogICAgICAgICAg\nICAgICAgLy8gYW55IGRpcnR5IGluc3RhbmNlcyBjYXVzZSBhIGZsdXNoIHRv\nIG9jY3VyCiAgICAgICAgICAgICAgICBmbHVzaERpcnR5KHNtKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBfZmx1c2hlZCA9IHRydWU7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIEJpdFNldCBmaWVsZHMgPSBuZXcgQml0U2V0\nKCk7CiAgICAgICAgcHJlRGV0YWNoKF9icm9rZXIsIHNtLCBmaWVsZHMpOwoK\nICAgICAgICAvLyBjcmVhdGUgYW5kIHN0b3JlIG5ldyBvYmplY3QgYmVmb3Jl\nIGNvcHkgdG8gYXZvaWQgZW5kbGVzcyByZWN1cnNpb24KICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUgcGMgPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUo\nKTsKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgZGV0YWNoZWRQQzsKICAg\nICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgIGRldGFjaGVkUEMgPSBwYy5w\nY05ld0luc3RhbmNlKG51bGwsIHRydWUpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgZGV0YWNoZWRQQyA9IHBjOwogICAgICAgIGlmIChfZGV0YWNoZWQg\nIT0gbnVsbCkKICAgICAgICAgICAgX2RldGFjaGVkLnB1dCh0b0RldGFjaCwg\nZGV0YWNoZWRQQyk7CgogICAgICAgIC8vIGRldGFjaCBmaWVsZHMgYW5kIHNl\ndCBkZXRhY2hlZCB2YXJpYWJsZXMKICAgICAgICBEZXRhY2hlZFN0YXRlTWFu\nYWdlciBkZXRTTSA9IG51bGw7CiAgICAgICAgaWYgKF9vcHRzLmdldERldGFj\naGVkU3RhdGVNYW5hZ2VyKCkKICAgICAgICAgICAgJiYgdXNlRGV0YWNoZWRT\ndGF0ZU1hbmFnZXIoc20sIF9vcHRzKSkKICAgICAgICAgICAgZGV0U00gPSBu\nZXcgRGV0YWNoZWRTdGF0ZU1hbmFnZXIoZGV0YWNoZWRQQywgc20sIGZpZWxk\ncywKICAgICAgICAgICAgICAgIF9vcHRzLmdldEFjY2Vzc1VubG9hZGVkKCks\nIF9icm9rZXIuZ2V0TXVsdGl0aHJlYWRlZCgpKTsKICAgICAgICBpZiAoX2Z1\nbGwpIHsKICAgICAgICAgICAgX2Z1bGxGTS5zZXRTdGF0ZU1hbmFnZXIoc20p\nOwogICAgICAgICAgICBfZnVsbEZNLmRldGFjaFZlcnNpb24oKTsKICAgICAg\nICAgICAgX2Z1bGxGTS5yZXByb3h5KGRldFNNKTsKICAgICAgICAgICAgX2Z1\nbGxGTS5zZXRTdGF0ZU1hbmFnZXIobnVsbCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIgZm0gPSBu\nZXcgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIKICAgICAgICAgICAgICAg\nIChkZXRhY2hlZFBDLCBkZXRTTSk7CiAgICAgICAgICAgIGZtLnNldFN0YXRl\nTWFuYWdlcihzbSk7CiAgICAgICAgICAgIGZtLmRldGFjaEZpZWxkcyhmaWVs\nZHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFCb29sZWFuLkZBTFNFLmVx\ndWFscyhzbS5nZXRNZXRhRGF0YSgpLnVzZXNEZXRhY2hlZFN0YXRlKCkpKQog\nICAgICAgICAgICBkZXRhY2hlZFBDLnBjU2V0RGV0YWNoZWRTdGF0ZShnZXRE\nZXRhY2hlZFN0YXRlKHNtLCBmaWVsZHMpKTsKICAgICAgICBpZiAoIV9jb3B5\nKQogICAgICAgICAgICBzbS5yZWxlYXNlKGZhbHNlLCAhX2NvcHkpOwogICAg\nICAgIGlmIChkZXRTTSAhPSBudWxsKQogICAgICAgICAgICBkZXRhY2hlZFBD\nLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihkZXRTTSk7CiAgICAgICAgcmV0dXJu\nIGRldGFjaGVkUEM7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVh\nbiB1c2VEZXRhY2hlZFN0YXRlTWFuYWdlcihTdGF0ZU1hbmFnZXJJbXBsIHNt\nLAogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cykgewogICAgICAgIENsYXNz\nTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgcmV0\ndXJuICFCb29sZWFuLkZBTFNFLmVxdWFscyhtZXRhLnVzZXNEZXRhY2hlZFN0\nYXRlKCkpICYmCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEuU1lOVEhFVElD\nLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUoKSkgJiYKICAgICAgICAg\nICAgb3B0cy5nZXREZXRhY2hlZFN0YXRlTWFuYWdlcigpOwogICAgfQoKICAg\nIC8qKgogICAgICogQmFzZSBkZXRhY2ggZmllbGQgbWFuYWdlci4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRGV0YWNoRmllbGRNYW5hZ2Vy\nCiAgICAgICAgZXh0ZW5kcyBUcmFuc2ZlckZpZWxkTWFuYWdlciB7CgogICAg\nICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIHNtOwoKICAgICAgICAv\nKioKICAgICAgICAgKiBTZXQgdGhlIHNvdXJjZSBzdGF0ZSBtYW5hZ2VyLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFN0YXRlTWFuYWdl\ncihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIHRoaXMuc20g\nPSBzbTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFRyYW5z\nZmVyIHRoZSBjdXJyZW50IHZlcnNpb24gb2JqZWN0IGZyb20gdGhlIHN0YXRl\nIG1hbmFnZXIgdG8gdGhlCiAgICAgICAgICogZGV0YWNoZWQgaW5zdGFuY2Uu\nCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZGV0YWNoVmVyc2lv\nbigpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbS5nZXRN\nZXRhRGF0YSgpLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgICAgICBpZiAo\nZm1kID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAg\nICAgICBPYmplY3QgdmFsID0gSmF2YVR5cGVzLmNvbnZlcnQoc20uZ2V0VmVy\nc2lvbigpLAogICAgICAgICAgICAgICAgZm1kLmdldFR5cGVDb2RlKCkpOwog\nICAgICAgICAgICB2YWwgPSBmbWQuZ2V0RmllbGRWYWx1ZSh2YWwsIHNtLmdl\ndEJyb2tlcigpKTsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxP\nTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBsb25ndmFsID0gKHZhbCA9\nPSBudWxsKSA/IDBMIDogKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgICAgIGRibHZhbCA9ICh2YWwgPT0gbnVsbCkgPyAwRCA6\nICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIG9ianZhbCA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzbS5y\nZXBsYWNlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUoKSwg\ndGhpcywKICAgICAgICAgICAgICAgIGZtZC5nZXRJbmRleCgpKTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFVucHJveGllcyBzZWNvbmQg\nY2xhc3Mgb2JqZWN0IGZpZWxkcy4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgdm9pZCByZXByb3h5KERldGFjaGVkU3RhdGVNYW5hZ2VyIGRzbSkgewog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1ldGFE\nYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgc3dp\ndGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgICAg\nICAvLyBscnMgcHJveGllcyBub3QgZGV0YWNoZWQKICAgICAgICAgICAgICAg\nICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIG9ianZhbCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLnJlcGxhY2VGaWVsZChnZXREZXRhY2hlZFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMsIGkpOwog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgICAgICBzbS5w\ncm92aWRlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUoKSwg\ndGhpcywgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9ianZhbCBpbnN0\nYW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFByb3h5\nIHByb3h5ID0gKFByb3h5KSBvYmp2YWw7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChwcm94eS5nZXRDaGFuZ2VUcmFja2VyKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5LmdldENoYW5nZVRyYWNr\nZXIoKS5zdG9wVHJhY2tpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\ncHJveHkuc2V0T3duZXIoZHNtLCAoZHNtID09IG51bGwpID8gLTEgOiBpKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgY2xlYXIoKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5zdGFuY2UgYmVpbmcg\nZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVkIFBlcnNp\nc3RlbmNlQ2FwYWJsZSBnZXREZXRhY2hlZFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZpZWxkTWFu\nYWdlciB0aGF0IGNhbiBjb3B5IGFsbCB0aGUgZmllbGRzIGZyb20gb25lCiAg\nICAgKiBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFuY2UgdG8gYW5vdGhlci4g\nT25lIG9mIHRoZQogICAgICogaW5zdGFuY2VzIG11c3QgYmUgbWFuYWdlZCBi\neSBhIFN0YXRlTWFuYWdlciwgYW5kIHRoZQogICAgICogb3RoZXIgbXVzdCBi\nZSB1bm1hbmFnZWQuCiAgICAgKgogICAgICogQGF1dGhvciBNYXJjIFBydWQn\naG9tbWVhdXgKICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBJbnN0YW5jZURl\ndGFjaEZpZWxkTWFuYWdlcgogICAgICAgIGV4dGVuZHMgRGV0YWNoRmllbGRN\nYW5hZ2VyIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBQZXJzaXN0ZW5jZUNh\ncGFibGUgX3RvOwogICAgICAgIHByaXZhdGUgZmluYWwgRGV0YWNoZWRTdGF0\nZU1hbmFnZXIgX2RldFNNOwoKICAgICAgICAvKioKICAgICAgICAgKiBDb25z\ndHJ1Y3Rvci4gU3VwcGx5IGluc3RhbmNlIHRvIHRvIGNvcHkgdG8uCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIEluc3RhbmNlRGV0YWNoRmllbGRNYW5h\nZ2VyKFBlcnNpc3RlbmNlQ2FwYWJsZSB0bywKICAgICAgICAgICAgRGV0YWNo\nZWRTdGF0ZU1hbmFnZXIgZGV0U00pIHsKICAgICAgICAgICAgX3RvID0gdG87\nCiAgICAgICAgICAgIF9kZXRTTSA9IGRldFNNOwogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXREZXRhY2hlZFBl\ncnNpc3RlbmNlQ2FwYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF90bzsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIERldGFjaCB0aGUg\nZmllbGRzIG9mIHRoZSBzdGF0ZSBtYW5hZ2VyIGdpdmVuIG9uIGNvbnN0cnVj\ndGlvbiB0bwogICAgICAgICAqIHRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIGdp\ndmVuIG9uIGNvbnN0cnVjdGlvbi4KICAgICAgICAgKiBPbmx5IHRoZSBmaWVs\nZHMgaW4gdGhlIGdpdmVuIGJpdCBzZXQgd2lsbCBiZSBjb3BpZWQuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZGV0YWNoRmllbGRzKEJpdFNl\ndCBmZ2ZpZWxkcykgewogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUg\nZnJvbSA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gcGtzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRQ\ncmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKCiAgICAg\nICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgIF90by5wY1JlcGxh\nY2VTdGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgLy8gd2Ugc3RhcnQgd2l0aCBwayBmaWVsZHM6IG9iamVjdHMg\nbWlnaHQgcmVseSBvbiBwayBmaWVsZHMgZm9yCiAgICAgICAgICAgICAgICAv\nLyBlcXVhbHMgYW5kIGhhc2hDb2RlIG1ldGhvZHMsIGFuZCB0aGlzIGVuc3Vy\nZXMgdGhhdCBwayBmaWVsZHMKICAgICAgICAgICAgICAgIC8vIGFyZSBzZXQg\ncHJvcGVybHkgaWYgd2UgcmV0dXJuIGFueSBwYXJ0aWFsbHktZGV0YWNoZWQg\nb2JqZWN0cwogICAgICAgICAgICAgICAgLy8gZHVlIHRvIHJlZW50cmFudCBj\nYWxscyB3aGVuIHRyYXZlcnNpbmcgcmVsYXRpb25zCiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgICAgICBkZXRhY2hGaWVsZChmcm9tLCBwa3NbaV0uZ2V0SW5k\nZXgoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBkZXRhY2hWZXJzaW9uKCk7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlz\nUHJpbWFyeUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lvbigpKSAKICAgICAg\nICAgICAgICAgICAgICAgICAgZGV0YWNoRmllbGQoZnJvbSwgaSwgZmdmaWVs\nZHMuZ2V0KGkpKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgIC8vIGNsZWFyIHRoZSBTdGF0ZU1hbmFnZXIgZnJvbSB0aGUgdGFy\nZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAg\nICAgICAgICAgICAgIF90by5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIERldGFjaCAob3IgY2xlYXIpIHRoZSBnaXZlbiBmaWVsZCBpbmRleC4K\nICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgZGV0YWNoRmllbGQo\nUGVyc2lzdGVuY2VDYXBhYmxlIGZyb20sIGludCBpLCBib29sZWFuIGZnKSB7\nCiAgICAgICAgICAgIC8vIHRlbGwgdGhlIHN0YXRlIG1hbmFnZXIgdG8gcHJv\ndmlkZSB0aGUgZmllbGRzIGZyb20gdGhlIHNvdXJjZSB0bwogICAgICAgICAg\nICAvLyB0aGlzIGZpZWxkIG1hbmFnZXIsIHdoaWNoIHdpbGwgdGhlbiByZXBs\nYWNlIHRoZSBmaWVsZCB3aXRoIGEKICAgICAgICAgICAgLy8gZGV0YWNoZWQg\ndmVyc2lvbgogICAgICAgICAgICBpZiAoZmcpCiAgICAgICAgICAgICAgICBz\nbS5wcm92aWRlRmllbGQoZnJvbSwgdGhpcywgaSk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKCFfY29weSkgewogICAgICAgICAgICAgICAgLy8gaWYgbm90IGNv\ncHlpbmcgYW5kIGZpZWxkIHNob3VsZCBub3QgYmUgZGV0YWNoZWQsIGNsZWFy\nIGl0CiAgICAgICAgICAgICAgICBjbGVhcigpOwogICAgICAgICAgICAgICAg\nc20ucmVwbGFjZUZpZWxkKF90bywgdGhpcywgaSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQm9vbGVhbkZp\nZWxkKGludCBmaWVsZCwgYm9vbGVhbiBjdXJWYWwpIHsKICAgICAgICAgICAg\nc3VwZXIuc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAg\nICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQnl0ZUZpZWxkKGlu\ndCBmaWVsZCwgYnl0ZSBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3Rv\ncmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJl\ncGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxkKGludCBmaWVsZCwgY2hh\nciBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVDaGFyRmllbGQo\nZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChf\ndG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHN0b3JlRG91YmxlRmllbGQoaW50IGZpZWxkLCBkb3VibGUgY3VyVmFs\nKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlRG91YmxlRmllbGQoZmllbGQs\nIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRo\naXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0\nb3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0IGN1clZhbCkgewogICAg\nICAgICAgICBzdXBlci5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGN1clZhbCk7\nCiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxk\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50Rmll\nbGQoaW50IGZpZWxkLCBpbnQgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVy\nLnN0b3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNt\nLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlTG9uZ0ZpZWxkKGludCBmaWVsZCwg\nbG9uZyBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVMb25nRmll\nbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVs\nZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNob3J0IGN1clZh\nbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZVNob3J0RmllbGQoZmllbGQs\nIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRo\naXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0\nb3JlU3RyaW5nRmllbGQoaW50IGZpZWxkLCBTdHJpbmcgY3VyVmFsKSB7CiAg\nICAgICAgICAgIHN1cGVyLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIGN1clZh\nbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZp\nZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlT2Jq\nZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgY3VyVmFsKSB7CiAgICAgICAg\nICAgIHN1cGVyLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIGRldGFjaEZpZWxk\nKGN1clZhbCwgZmllbGQpKTsKICAgICAgICAgICAgc20ucmVwbGFjZUZpZWxk\nKF90bywgdGhpcywgZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogU2V0IHRoZSBvd25lciBvZiB0aGUgZmllbGQncyBwcm94eSB0\nbyB0aGUgZGV0YWNoZWQgc3RhdGUgbWFuYWdlci4KICAgICAgICAgKi8KICAg\nICAgICBwcml2YXRlIE9iamVjdCByZXByb3h5KE9iamVjdCBvYmosIGludCBm\naWVsZCkgewogICAgICAgICAgICBpZiAob2JqICE9IG51bGwgJiYgX2RldFNN\nICE9IG51bGwgJiYgb2JqIGluc3RhbmNlb2YgUHJveHkpCiAgICAgICAgICAg\nICAgICAoKFByb3h5KSBvYmopLnNldE93bmVyKF9kZXRTTSwgZmllbGQpOwog\nICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogRGV0YWNoIHRoZSBnaXZlbiB2YWx1ZSBpZiBuZWVkZWQu\nCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgZGV0YWNoRmll\nbGQoT2JqZWN0IGN1clZhbCwgaW50IGZpZWxkKSB7CiAgICAgICAgICAgIGlm\nIChjdXJWYWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBzbS5nZXRNZXRh\nRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgT2JqZWN0IG5l\nd1ZhbCA9IG51bGw7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5B\nUlJBWToKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAg\nICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUFycmF5KGN1clZhbCk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbmV3VmFs\nID0gY3VyVmFsOwogICAgICAgICAgICAgICAgZGV0YWNoQXJyYXkobmV3VmFs\nLCBmbWQpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbDsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAg\nICAgIGlmIChfY29weSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfZGV0\nU00gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdWYWwg\nPSBfcHJveHkubmV3Q29sbGVjdGlvblByb3h5KGZtZC5nZXRQcm94eVR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50\nKCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0YW5jZW9mIENvbXBhcmF0\nb3IgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKENvbXBhcmF0b3Ip\nIGZtZC5nZXRJbml0aWFsaXplcigpIDogbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICgoQ29sbGVjdGlvbikgbmV3VmFsKS5hZGRBbGwoKENvbGxl\nY3Rpb24pIGN1clZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IF9wcm94eS5jb3B5Q29s\nbGVjdGlvbigoQ29sbGVjdGlvbikgY3VyVmFsKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IGN1clZhbDsK\nICAgICAgICAgICAgICAgIGRldGFjaENvbGxlY3Rpb24oKENvbGxlY3Rpb24p\nIG5ld1ZhbCwgKENvbGxlY3Rpb24pIGN1clZhbCwgZm1kKTsKICAgICAgICAg\nICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBpZiAo\nX2NvcHkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2RldFNNICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5\nLm5ld01hcFByb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50\nKCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0YW5jZW9mIENvbXBhcmF0\nb3IgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChDb21wYXJh\ndG9yKSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSA6IG51bGwpOwogICAgICAgICAg\nICAgICAgICAgICAgICAoKE1hcCkgbmV3VmFsKS5wdXRBbGwoKE1hcCkgY3Vy\nVmFsKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5LmNvcHlNYXAoKE1hcCkgY3Vy\nVmFsKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgIG5ld1ZhbCA9IGN1clZhbDsKICAgICAgICAgICAgICAgIGRldGFjaE1h\ncCgoTWFwKSBuZXdWYWwsIChNYXApIGN1clZhbCwgZm1kKTsKICAgICAgICAg\nICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAg\nIG5ld1ZhbCA9IChfY29weSkgPyBfcHJveHkuY29weUNhbGVuZGFyKChDYWxl\nbmRhcikgY3VyVmFsKSA6CiAgICAgICAgICAgICAgICAgICAgY3VyVmFsOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHkobmV3VmFsLCBmaWVsZCk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICBuZXdWYWwgPSAoX2NvcHkpID8gX3Byb3h5LmNvcHlEYXRlKChEYXRl\nKSBjdXJWYWwpIDogY3VyVmFsOwogICAgICAgICAgICAgICAgcmV0dXJuIHJl\ncHJveHkobmV3VmFsLCBmaWVsZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAg\nICAgICAgICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUN1c3RvbShjdXJW\nYWwpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHkoKG5ld1ZhbCA9\nPSBudWxsKSA/IGN1clZhbCA6IG5ld1ZhbCwgZmllbGQpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIHJldHVybiBkZXRhY2hJ\nbnRlcm5hbChjdXJWYWwpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgcmV0dXJuIGN1clZhbDsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTWFrZSBzdXJlIGFsbCB0aGUg\ndmFsdWVzIGluIHRoZSBnaXZlbiBhcnJheSBhcmUgZGV0YWNoZWQuCiAgICAg\nICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFycmF5KE9iamVj\ndCBhcnJheSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAgICAgaWYg\nKCFmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGludCBsZW4gPSBBcnJh\neS5nZXRMZW5ndGgoYXJyYXkpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICAgICAgQXJyYXkuc2V0KGFy\ncmF5LCBpLCBkZXRhY2hJbnRlcm5hbChBcnJheS5nZXQoYXJyYXksIGkpKSk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBNYWtlIHN1cmUg\nYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIGNvbGxlY3Rpb24gYXJlIGRl\ndGFjaGVkLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBkZXRh\nY2hDb2xsZWN0aW9uKENvbGxlY3Rpb24gY29sbCwgQ29sbGVjdGlvbiBvcmln\nLAogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgICAg\nICAvLyBjb2xsIGNhbiBiZSBudWxsIGlmIG5vdCBjb3B5YWJsZQogICAgICAg\nICAgICBpZiAoX2NvcHkgJiYgY29sbCA9PSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1jb3B5\nYWJsZSIsIGZtZCkpOwogICAgICAgICAgICBpZiAoIWZtZC5nZXRFbGVtZW50\nKCkuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgLy8gdW5mb3J0dW5hdGVseSB3ZSBoYXZlIHRvIGNs\nZWFyIHRoZSBvcmlnaW5hbCBhbmQgcmUtYWRkIHRvIGNvcHkKICAgICAgICAg\nICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAgY29sbC5jbGVhcigpOwog\nICAgICAgICAgICBPYmplY3QgZGV0YWNoZWQ7CiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gb3JpZy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgZGV0YWNoZWQgPSBkZXRhY2hJbnRlcm5h\nbChpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAg\nICAgICAgICAgICAgICAgICBjb2xsLmFkZChkZXRhY2hlZCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIE1ha2Ug\nc3VyZSBhbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gbWFwIGFyZSBkZXRh\nY2hlZC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgZGV0YWNo\nTWFwKE1hcCBtYXAsIE1hcCBvcmlnLCBGaWVsZE1ldGFEYXRhIGZtZCkgewog\nICAgICAgICAgICAvLyBtYXAgY2FuIGJlIG51bGwgaWYgbm90IGNvcHlhYmxl\nCiAgICAgICAgICAgIGlmIChfY29weSAmJiBtYXAgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICAgICAgYm9vbGVhbiBrZXlQ\nQyA9IGZtZC5nZXRLZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAg\nICAgIGJvb2xlYW4gdmFsUEMgPSBmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFy\nZWRUeXBlUEMoKTsKICAgICAgICAgICAgaWYgKCFrZXlQQyAmJiAhdmFsUEMp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAvLyBpZiB3\nZSBoYXZlIHRvIGNvcHkga2V5cywganVzdCBjbGVhciBhbmQgcmUtYWRkOyBv\ndGhlcndpc2UKICAgICAgICAgICAgLy8gd2UgY2FuIHVzZSB0aGUgZW50cnkg\nc2V0IHRvIHJlc2V0IHRoZSB2YWx1ZXMgb25seQogICAgICAgICAgICBNYXAu\nRW50cnkgZW50cnk7CiAgICAgICAgICAgIGlmICghX2NvcHkgfHwga2V5UEMp\nIHsKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAg\nICAgICBtYXAuY2xlYXIoKTsKICAgICAgICAgICAgICAgIE9iamVjdCBrZXks\nIHZhbDsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb3Jp\nZy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KXsKICAg\nICAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICAgICAga2V5ID0gZW50cnkuZ2V0S2V5KCk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGtleVBDKQogICAgICAgICAgICAg\nICAgICAgICAgICBrZXkgPSBkZXRhY2hJbnRlcm5hbChrZXkpOwogICAgICAg\nICAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHZhbFBDKQogICAgICAgICAgICAgICAgICAgICAg\nICB2YWwgPSBkZXRhY2hJbnRlcm5hbCh2YWwpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICAgICAgbWFwLnB1\ndChrZXksIHZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1h\ncC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4\ndCAoKTsKCQkJCQllbnRyeS5zZXRWYWx1ZSAoZGV0YWNoSW50ZXJuYWwgKGVu\ndHJ5LmdldFZhbHVlICgpKSk7CgkJCQl9CgkJCX0KCQl9Cgl9Cn0K\n","encoding":"base64"}

