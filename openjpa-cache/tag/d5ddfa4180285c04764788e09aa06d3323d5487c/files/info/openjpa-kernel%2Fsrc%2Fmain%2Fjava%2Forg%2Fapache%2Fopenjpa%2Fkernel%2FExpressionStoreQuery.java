{"sha":"e67abfb14544a32fce9f5fc64a3a8ab6d460512c","node_id":"MDQ6QmxvYjIwNjM2NDplNjdhYmZiMTQ1NDRhMzJmY2U5ZjVmYzY0YTNhOGFiNmQ0NjA1MTJj","size":28444,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e67abfb14544a32fce9f5fc64a3a8ab6d460512c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQWJzdHJhY3RFeHByZXNzaW9u\nVmlzaXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uRmFjdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uUGFyc2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkZpbHRl\nckxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLkluTWVtb3J5RXhwcmVzc2lvbkZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUGF0aDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5RdWVyeUV4cHJlc3Npb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlJlc29sdmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlN0cmluZ0Nv\nbnRhaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBz\nLlZhbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5W\nYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5X\naWxkY2FyZE1hdGNoOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5y\nb3AuTGlzdFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5yb3AuUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVj\ndFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNs\nYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5G\naWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1w\nbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFs\naWRTdGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBJbXBsZW1lbnRh\ndGlvbiBvZiBhbiBleHByZXNzaW9uLWJhc2VkIHF1ZXJ5LCB3aGljaCBjYW4g\naGFuZGxlCiAqIFN0cmluZy1iYXNlZCBxdWVyeSBleHByZXNzaW9ucyBzdWNo\nIGFzIEpQUUwgYW5kIEpET1FMLgogKiBUaGlzIGltcGxlbWVudGF0aW9uIGlz\nIHN1aXRhYmxlIGZvciBpbi1tZW1vcnkgb3BlcmF0aW9uLgogKiBPdmVycmlk\nZSB0aGUgZm9sbG93aW5nIG1ldGhvZHMgdG8gYWxzbyBzdXBwb3J0IGRhdGFz\ndG9yZSBvcGVyYXRpb246CiAqIDx1bD4KICogPGxpPk92ZXJyaWRlIHtAbGlu\nayAjc3VwcG9ydHNEYXRhU3RvcmVFeGVjdXRpb259IHRvIHJldHVybgogKiA8\nY29kZT50cnVlPC9jb2RlPi48L2xpPgogKiA8bGk+T3ZlcnJpZGUge0BsaW5r\nICNleGVjdXRlUXVlcnl9LCB7QGxpbmsgI2V4ZWN1dGVEZWxldGV9LCBhbmQK\nICoge0BsaW5rICNleGVjdXRlVXBkYXRlfSB0byBleGVjdXRlIHRoZSBxdWVy\neSBhZ2FpbnN0IHRoZSBkYXRhIHN0b3JlLgogKiBLZWVwIGluIG1pbmQgdGhh\ndCB0aGUgcGFyYW1ldGVycyBwYXNzZWQgdG8gdGhpcyBtZXRob2QgbWlnaHQg\nYmUgaW4gdXNlCiAqIGJ5IHNldmVyYWwgdGhyZWFkcyBpbiBkaWZmZXJlbnQg\ncXVlcnkgaW5zdGFuY2VzLiBUaHVzIGNvbXBvbmVudHMgbGlrZQogKiB0aGUg\nZXhwcmVzc2lvbiBmYWN0b3J5IG11c3QgZWl0aGVyIGJlIHRocmVhZCBzYWZl\nLCBvciB0aGlzIG1ldGhvZCBtdXN0CiAqIHN5bmNocm9uaXplIG9uIHRoZW0u\nPC9saT4KICogPGxpPk92ZXJyaWRlIHtAbGluayAjZ2V0RGF0YVN0b3JlQWN0\naW9uc30gdG8gcmV0dXJuIGEgcmVwcmVzZW50YXRpb24gb2YKICogdGhlIGFj\ndGlvbnMgdGhhdCB3aWxsIGJlIHRha2VuIG9uIHRoZSBkYXRhIHN0b3JlLiBG\nb3IgdXNlIGluIHZpc3VhbAogKiB0b29scy48L2xpPgogKiA8bGk+T3ZlcnJp\nZGUge0BsaW5rICNnZXRFeHByZXNzaW9uRmFjdG9yeX0gdG8gcmV0dXJuIGEg\nZmFjdG9yeSBmb3IgY3JlYXRpbmcKICogZXhwcmVzc2lvbnMgaW4gdGhlIGRh\ndGFzdG9yZSdzIGxhbmd1YWdlLiBUaGUgZmFjdG9yeSBtdXN0IGJlIGNhY2hh\nYmxlLjwvbGk+CiAqIDwvdWw+CiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpwdWJsaWMgY2xhc3MgRXhwcmVzc2lvblN0b3JlUXVlcnkKICAgIGV4dGVu\nZHMgQWJzdHJhY3RTdG9yZVF1ZXJ5IHsKCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAg\nICAgICAgKEV4cHJlc3Npb25TdG9yZVF1ZXJ5LmNsYXNzKTsKCiAgICAvLyBt\nYWludGFpbiBzdXBwb3J0IGZvciBhIGNvdXBsZSBvZiBkZXByZWNhdGVkIGV4\ndGVuc2lvbnMKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEZpbHRlckxpc3Rl\nbmVyW10gX2xpc3RlbmVycyA9IG5ldyBGaWx0ZXJMaXN0ZW5lcltdewogICAg\nICAgIG5ldyBTdHJpbmdDb250YWlucygpLCBuZXcgV2lsZGNhcmRNYXRjaCgp\nLAogICAgfTsKCiAgICBwcml2YXRlIGZpbmFsIEV4cHJlc3Npb25QYXJzZXIg\nX3BhcnNlcjsKICAgIHByaXZhdGUgdHJhbnNpZW50IE9iamVjdCBfcGFyc2Vk\nOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0IGEgcXVlcnkgd2l0aCBhIHBh\ncnNlciBmb3IgdGhlIGxhbmd1YWdlLgogICAgICovCiAgICBwdWJsaWMgRXhw\ncmVzc2lvblN0b3JlUXVlcnkoRXhwcmVzc2lvblBhcnNlciBwYXJzZXIpIHsK\nICAgICAgICBfcGFyc2VyID0gcGFyc2VyOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVzb2x2ZXIgdXNlZCBpbiBwYXJzaW5nLgogICAgICovCiAgICBwdWJs\naWMgUmVzb2x2ZXIgZ2V0UmVzb2x2ZXIoKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBSZXNvbHZlcigpIHsKICAgICAgICAgICAgcHVibGljIENsYXNzIGNsYXNz\nRm9yTmFtZShTdHJpbmcgbmFtZSwgU3RyaW5nW10gaW1wb3J0cykgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGN0eC5jbGFzc0Zvck5hbWUobmFtZSwgaW1w\nb3J0cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBGaWx0\nZXJMaXN0ZW5lciBnZXRGaWx0ZXJMaXN0ZW5lcihTdHJpbmcgdGFnKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gY3R4LmdldEZpbHRlckxpc3RlbmVyKHRh\nZyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBBZ2dyZWdh\ndGVMaXN0ZW5lciBnZXRBZ2dyZWdhdGVMaXN0ZW5lcihTdHJpbmcgdGFnKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gY3R4LmdldEFnZ3JlZ2F0ZUxpc3Rl\nbmVyKHRhZyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBP\ncGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGN0eC5nZXRTdG9yZUNvbnRleHQoKS5nZXRD\nb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBRdWVyeUNvbnRleHQgZ2V0UXVlcnlDb250ZXh0KCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGN0eDsKICAgICAgICAgICAgfQogICAgICAgIH07\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBkaXJlY3Qgc2V0dGluZyBv\nZiBwYXJzZWQgc3RhdGUgZm9yIGZhY2FkZXMgdGhhdCBkbyBwYXJzaW5nLgog\nICAgICogVGhlIGZhY2FkZSBzaG91bGQgY2FsbCB0aGlzIG1ldGhvZCB0d2lj\nZTogb25jZSB3aXRoIHRoZSBxdWVyeSBzdHJpbmcsCiAgICAgKiBhbmQgYWdh\naW4gd2l0aCB0aGUgcGFyc2VkIHN0YXRlLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBzZXRRdWVyeShPYmplY3QgcXVlcnkpIHsKICAgICAgICBfcGFy\nc2VkID0gcXVlcnk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\ncHVibGljIEZpbHRlckxpc3RlbmVyIGdldEZpbHRlckxpc3RlbmVyKFN0cmlu\nZyB0YWcpIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9saXN0ZW5l\ncnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChfbGlzdGVuZXJzW2ld\nLmdldFRhZygpLmVxdWFscyh0YWcpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIF9saXN0ZW5lcnNbaV07CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBuZXdDb21waWxhdGlvbigpIHsKICAgICAgICBp\nZiAoX3BhcnNlZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3BhcnNl\nZDsKICAgICAgICByZXR1cm4gX3BhcnNlci5wYXJzZShjdHguZ2V0UXVlcnlT\ndHJpbmcoKSwgdGhpcyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcG9wdWxh\ndGVGcm9tQ29tcGlsYXRpb24oT2JqZWN0IGNvbXApIHsKICAgICAgICBfcGFy\nc2VyLnBvcHVsYXRlKGNvbXAsIHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGludmFsaWRhdGVDb21waWxhdGlvbigpIHsKICAgICAgICBfcGFyc2Vk\nID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0lu\nTWVtb3J5RXhlY3V0aW9uKCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIHB1YmxpYyBFeGVjdXRvciBuZXdJbk1lbW9yeUV4ZWN1dG9yKENs\nYXNzTWV0YURhdGEgbWV0YSwgYm9vbGVhbiBzdWJzKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBJbk1lbW9yeUV4ZWN1dG9yKHRoaXMsIG1ldGEsIHN1YnMsIF9w\nYXJzZXIsCiAgICAgICAgICAgIGN0eC5nZXRDb21waWxhdGlvbigpKTsKICAg\nIH0KCiAgICBwdWJsaWMgRXhlY3V0b3IgbmV3RGF0YVN0b3JlRXhlY3V0b3Io\nQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1YnMpIHsKICAgICAgICBy\nZXR1cm4gbmV3IERhdGFTdG9yZUV4ZWN1dG9yKHRoaXMsIG1ldGEsIHN1YnMs\nIF9wYXJzZXIsCiAgICAgICAgICAgIGN0eC5nZXRDb21waWxhdGlvbigpKTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE1l\ndGhvZHMgZm9yIE92ZXJyaWRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIEV4ZWN1dGUgdGhlIGdpdmVuIGV4cHJlc3Np\nb24gYWdhaW5zdCB0aGUgZ2l2ZW4gY2FuZGlkYXRlIGV4dGVudC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZXggY3VycmVudCBleGVjdXRvcgogICAgICogQHBh\ncmFtIGJhc2UgdGhlIGJhc2UgdHlwZSB0aGUgcXVlcnkgc2hvdWxkIG1hdGNo\nCiAgICAgKiBAcGFyYW0gdHlwZXMgdGhlIGluZGVwZW5kZW50IGNhbmRpZGF0\nZSB0eXBlcwogICAgICogQHBhcmFtIHN1YmNsYXNzZXMgdHJ1ZSBpZiBzdWJj\nbGFzc2VzIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0cwogICAg\nICogQHBhcmFtIGZhY3RzIHRoZSBleHByZXNzaW9uIGZhY3RvcnkgdXNlZCB0\nbyBidWlsZCB0aGUgcXVlcnkgZm9yCiAgICAgKiBlYWNoIGJhc2UgdHlwZQog\nICAgICogQHBhcmFtIHBhcnNlZCB0aGUgcGFyc2VkIHF1ZXJ5IHZhbHVlcwog\nICAgICogQHBhcmFtIHBhcmFtcyBwYXJhbWV0ZXIgdmFsdWVzLCBvciBlbXB0\neSBhcnJheQogICAgICogQHBhcmFtIHJhbmdlIHJlc3VsdCByYW5nZQogICAg\nICogQHJldHVybiBhIHByb3ZpZGVyIGZvciBtYXRjaGluZyBvYmplY3RzCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHRPYmplY3RQcm92aWRlciBleGVj\ndXRlUXVlcnkoRXhlY3V0b3IgZXgsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBi\nYXNlLCBDbGFzc01ldGFEYXRhW10gdHlwZXMsIGJvb2xlYW4gc3ViY2xhc3Nl\ncywKICAgICAgICBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLCBRdWVyeUV4\ncHJlc3Npb25zW10gcGFyc2VkLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAg\nUmFuZ2UgcmFuZ2UpIHsKICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUgdGhl\nIGdpdmVuIGV4cHJlc3Npb24gYWdhaW5zdCB0aGUgZ2l2ZW4gY2FuZGlkYXRl\nIGV4dGVudAogICAgICogYW5kIGRlbGV0ZSB0aGUgaW5zdGFuY2VzLgogICAg\nICoKICAgICAqIEBwYXJhbSBleCBjdXJyZW50IGV4ZWN1dG9yCiAgICAgKiBA\ncGFyYW0gYmFzZSB0aGUgYmFzZSB0eXBlIHRoZSBxdWVyeSBzaG91bGQgbWF0\nY2gKICAgICAqIEBwYXJhbSB0eXBlcyB0aGUgaW5kZXBlbmRlbnQgY2FuZGlk\nYXRlIHR5cGVzCiAgICAgKiBAcGFyYW0gc3ViY2xhc3NlcyB0cnVlIGlmIHN1\nYmNsYXNzZXMgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHRzCiAg\nICAgKiBAcGFyYW0gZmFjdHMgdGhlIGV4cHJlc3Npb24gZmFjdG9yeSB1c2Vk\nIHRvIGJ1aWxkIHRoZSBxdWVyeSBmb3IKICAgICAqIGVhY2ggYmFzZSB0eXBl\nCiAgICAgKiBAcGFyYW0gcGFyc2VkIHRoZSBwYXJzZWQgcXVlcnkgdmFsdWVz\nCiAgICAgKiBAcGFyYW0gcGFyYW1zIHBhcmFtZXRlciB2YWx1ZXMsIG9yIGVt\ncHR5IGFycmF5CiAgICAgKiBAcmV0dXJuIGEgbnVtYmVyIGluZGljYXRpbmcg\ndGhlIG51bWJlciBvZiBpbnN0YW5jZXMgZGVsZXRlZCwKICAgICAqIG9yIG51\nbGwgdG8gZXhlY3V0ZSB0aGUgZGVsZXRlIGluIG1lbW9yeQogICAgICovCiAg\nICBwcm90ZWN0ZWQgTnVtYmVyIGV4ZWN1dGVEZWxldGUoRXhlY3V0b3IgZXgs\nIENsYXNzTWV0YURhdGEgYmFzZSwKICAgICAgICBDbGFzc01ldGFEYXRhW10g\ndHlwZXMsIGJvb2xlYW4gc3ViY2xhc3NlcywgRXhwcmVzc2lvbkZhY3Rvcnlb\nXSBmYWN0cywKICAgICAgICBRdWVyeUV4cHJlc3Npb25zW10gcGFyc2VkLCBP\nYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEV4ZWN1dGUgdGhlIGdpdmVuIGV4cHJlc3Npb24g\nYWdhaW5zdCB0aGUgZ2l2ZW4gY2FuZGlkYXRlIGV4dGVudAogICAgICogYW5k\nIHVwZGF0ZXMgdGhlIGluc3RhbmNlcy4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZXggY3VycmVudCBleGVjdXRvcgogICAgICogQHBhcmFtIGJhc2UgdGhlIGJh\nc2UgdHlwZSB0aGUgcXVlcnkgc2hvdWxkIG1hdGNoCiAgICAgKiBAcGFyYW0g\ndHlwZXMgdGhlIGluZGVwZW5kZW50IGNhbmRpZGF0ZSB0eXBlcwogICAgICog\nQHBhcmFtIHN1YmNsYXNzZXMgdHJ1ZSBpZiBzdWJjbGFzc2VzIHNob3VsZCBi\nZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0cwogICAgICogQHBhcmFtIGZhY3Rz\nIHRoZSBleHByZXNzaW9uIGZhY3RvcnkgdXNlZCB0byBidWlsZCB0aGUgcXVl\ncnkgZm9yCiAgICAgKiBlYWNoIGJhc2UgdHlwZQogICAgICogQHBhcmFtIHBh\ncnNlZCB0aGUgcGFyc2VkIHF1ZXJ5IHZhbHVlcwogICAgICogQHBhcmFtIHBh\ncmFtcyBwYXJhbWV0ZXIgdmFsdWVzLCBvciBlbXB0eSBhcnJheQogICAgICog\nQHJldHVybiBhIG51bWJlciBpbmRpY2F0aW5nIHRoZSBudW1iZXIgb2YgaW5z\ndGFuY2VzIHVwZGF0ZWQsCiAgICAgKiBvciBudWxsIHRvIGV4ZWN1dGUgdGhl\nIHVwZGF0ZSBpbiBtZW1vcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBOdW1i\nZXIgZXhlY3V0ZVVwZGF0ZShFeGVjdXRvciBleCwgQ2xhc3NNZXRhRGF0YSBi\nYXNlLAogICAgICAgIENsYXNzTWV0YURhdGFbXSB0eXBlcywgYm9vbGVhbiBz\ndWJjbGFzc2VzLCBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLAogICAgICAg\nIFF1ZXJ5RXhwcmVzc2lvbnNbXSBwYXJzZWQsIE9iamVjdFtdIHBhcmFtcykg\newogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBjb21tYW5kcyB0aGF0IHdpbGwgYmUgc2VudCB0byB0aGUg\nZGF0YXN0b3JlIGluIG9yZGVyCiAgICAgKiB0byBleGVjdXRlIHRoZSBxdWVy\neSwgdHlwaWNhbGx5IGluIHRoZSBkYXRhYmFzZSdzIG5hdGl2ZSBsYW5ndWFn\nZS4KICAgICAqCiAgICAgKiBAcGFyYW0gYmFzZSB0aGUgYmFzZSB0eXBlIHRo\nZSBxdWVyeSBzaG91bGQgbWF0Y2gKICAgICAqIEBwYXJhbSB0eXBlcyB0aGUg\naW5kZXBlbmRlbnQgY2FuZGlkYXRlIHR5cGVzCiAgICAgKiBAcGFyYW0gc3Vi\nY2xhc3NlcyB0cnVlIGlmIHN1YmNsYXNzZXMgc2hvdWxkIGJlIGluY2x1ZGVk\nIGluIHRoZSByZXN1bHRzCiAgICAgKiBAcGFyYW0gZmFjdHMgdGhlIGV4cHJl\nc3Npb24gZmFjdG9yeSB1c2VkIHRvIGJ1aWxkIHRoZSBxdWVyeSBmb3IKICAg\nICAqIGVhY2ggYmFzZSB0eXBlCiAgICAgKiBAcGFyYW0gcGFyc2VkIHRoZSBw\nYXJzZWQgcXVlcnkgdmFsdWVzCiAgICAgKiBAcGFyYW0gcGFyYW1zIHBhcmFt\nZXRlciB2YWx1ZXMsIG9yIGVtcHR5IGFycmF5CiAgICAgKiBAcGFyYW0gcmFu\nZ2UgcmVzdWx0IHJhbmdlCiAgICAgKiBAcmV0dXJuIGEgdGV4dHVhbCBkZXNj\ncmlwdGlvbiBvZiB0aGUgcXVlcnkgdG8gZXhlY3V0ZQogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhDbGFzc01l\ndGFEYXRhIGJhc2UsCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIHR5cGVzLCBi\nb29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMs\nCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIHBhcnNlZCwgT2JqZWN0W10g\ncGFyYW1zLCBSYW5nZSByYW5nZSkgewogICAgICAgIHJldHVybiBTdG9yZVF1\nZXJ5LkVNUFRZX1NUUklOR1M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGFzc2lnbmFibGUgdHlwZXMgZm9yIHRoZSBnaXZlbiBtZXRhZGF0\nYSB3aG9zZSBleHByZXNzaW9uCiAgICAgKiB0cmVlcyBtdXN0IGJlIGNvbXBp\nbGVkIGluZGVwZW5kZW50bHkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFz\nc01ldGFEYXRhW10gZ2V0SW5kZXBlbmRlbnRFeHByZXNzaW9uQ2FuZGlkYXRl\ncwogICAgICAgIChDbGFzc01ldGFEYXRhIHR5cGUsIGJvb2xlYW4gc3ViY2xh\nc3NlcykgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YVtdeyB0\neXBlIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4ge0BsaW5r\nIEV4cHJlc3Npb25GYWN0b3J5fSB0byB1c2UgdG8gY3JlYXRlIGFuIGV4cHJl\nc3Npb24gdG8KICAgICAqIGJlIGV4ZWN1dGVkIGFnYWluc3QgYW4gZXh0ZW50\nLiBFYWNoIGZhY3Rvcnkgd2lsbCBiZSB1c2VkIHRvIGNvbXBpbGUKICAgICAq\nIG9uZSBmaWx0ZXIgb25seS4gVGhlIGZhY3RvcnkgbXVzdCBiZSBjYWNoYWJs\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEV4cHJlc3Npb25GYWN0b3J5IGdl\ndEV4cHJlc3Npb25GYWN0b3J5KENsYXNzTWV0YURhdGEgdHlwZSkgewogICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgfQoK\nICAgIC8qKgogICAgICogUHJvdmlkZXMgc3VwcG9ydCBmb3IgcXVlcmllcyB0\naGF0IGhvbGQgcXVlcnkgaW5mb3JtYXRpb24KICAgICAqIGluIGEge0BsaW5r\nIFF1ZXJ5RXhwcmVzc2lvbnN9IGluc3RhbmNlLgogICAgICoKICAgICAqIEBh\ndXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RFeHByZXNzaW9uRXhlY3V0\nb3IKICAgICAgICBleHRlbmRzIEFic3RyYWN0RXhlY3V0b3IKICAgICAgICBp\nbXBsZW1lbnRzIEV4ZWN1dG9yIHsKCiAgICAgICAgLyoqCiAgICAgICAgICog\nUmV0dXJuIHRoZSBwYXJzZWQgcXVlcnkgZXhwcmVzc2lvbnMgZm9yIG91ciBj\nYW5kaWRhdGUgdHlwZXMuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVk\nIGFic3RyYWN0IFF1ZXJ5RXhwcmVzc2lvbnNbXSBnZXRRdWVyeUV4cHJlc3Np\nb25zKCk7CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgcXVl\ncnkgZXhwcmVzc2lvbnMgZm9yIG9uZSBjYW5kaWRhdGUgdHlwZSwgb3IgZGll\nIGlmIG5vbmUuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBRdWVyeUV4\ncHJlc3Npb25zIGFzc2VydFF1ZXJ5RXhwcmVzc2lvbigpIHsKICAgICAgICAg\nICAgUXVlcnlFeHByZXNzaW9uc1tdIGV4cCA9IGdldFF1ZXJ5RXhwcmVzc2lv\nbnMoKTsKICAgICAgICAgICAgaWYgKGV4cCA9PSBudWxsIHx8IGV4cC5sZW5n\ndGggPCAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgibm8tZXhwcmVzc2lvbnMiKSk7CgogICAg\nICAgICAgICByZXR1cm4gZXhwWzBdOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogVGhyb3cgcHJvcGVyIGV4Y2VwdGlvbiBpZiBnaXZlbiB2\nYWx1ZSBpcyBhIGNvbGxlY3Rpb24vbWFwL2FycmF5LgogICAgICAgICAqLwog\nICAgICAgIHByb3RlY3RlZCB2b2lkIGFzc2VydE5vdENvbnRhaW5lcihWYWx1\nZSB2YWwsIFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICAvLyB2YXJpYWJs\nZXMgcmVwcmVzZW50IGNvbnRhaW5lciBlbGVtZW50cywgbm90IHRoZSBjb250\nYWluZXIgaXRzZWxmCiAgICAgICAgICAgIGlmICh2YWwuaXNWYXJpYWJsZSgp\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgQ2xhc3Mg\ndHlwZTsKICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFBhdGgpIHsK\nICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gKChQYXRoKSB2\nYWwpLmxhc3QoKTsKICAgICAgICAgICAgICAgIHR5cGUgPSAoZm1kID09IG51\nbGwpID8gdmFsLmdldFR5cGUoKSA6IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsK\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICB0eXBlID0gdmFs\nLmdldFR5cGUoKTsKCiAgICAgICAgICAgIHN3aXRjaCAoSmF2YVR5cGVzLmdl\ndFR5cGVDb2RlKHR5cGUpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNP\nTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImNvbnRhaW5lci1wcm9qZWN0aW9uIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgcS5nZXRDb250ZXh0KCkuZ2V0UXVlcnlTdHJpbmcoKSkp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZmlu\nYWwgdm9pZCB2YWxpZGF0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAg\nUXVlcnlFeHByZXNzaW9ucyBleHBzID0gYXNzZXJ0UXVlcnlFeHByZXNzaW9u\nKCk7ICAgIAogICAgICAgICAgICBWYWxpZGF0ZUdyb3VwaW5nRXhwcmVzc2lv\nblZpc2l0b3IudmFsaWRhdGUocS5nZXRDb250ZXh0KCksIGV4cHMpOyAKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGdldFJhbmdlKFN0b3JlUXVl\ncnkgcSwgT2JqZWN0W10gcGFyYW1zLCBSYW5nZSByYW5nZSkgewogICAgICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMgPSBhc3NlcnRRdWVyeUV4cHJl\nc3Npb24oKTsKICAgICAgICAgICAgaWYgKGV4cHMucmFuZ2UubGVuZ3RoID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAo\nZXhwcy5yYW5nZS5sZW5ndGggPT0gMiAKICAgICAgICAgICAgICAgICYmIGV4\ncHMucmFuZ2VbMF0gaW5zdGFuY2VvZiBDb25zdGFudAogICAgICAgICAgICAg\nICAgJiYgZXhwcy5yYW5nZVsxXSBpbnN0YW5jZW9mIENvbnN0YW50KSB7CiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJhbmdl\nLnN0YXJ0ID0gKChOdW1iZXIpICgoQ29uc3RhbnQpIGV4cHMucmFuZ2VbMF0p\nLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRWYWx1ZShwYXJhbXMpKS5s\nb25nVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICByYW5nZS5lbmQgPSAo\nKE51bWJlcikgKChDb25zdGFudCkgZXhwcy5yYW5nZVsxXSkuCiAgICAgICAg\nICAgICAgICAgICAgICAgIGdldFZhbHVlKHBhcmFtcykpLmxvbmdWYWx1ZSgp\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKENsYXNzQ2FzdEV4Y2VwdGlvbiBjY2UpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBmYWxsIHRocm91Z2ggdG8gZXhjZXB0aW9uIGJlbG93\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChOdWxsUG9pbnRlckV4Y2VwdGlv\nbiBucGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBmYWxsIHRocm91Z2gg\ndG8gZXhjZXB0aW9uIGJlbG93CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm9ubHktcmFuZ2UtY29uc3RhbnRzIiwKICAgICAgICAgICAgICAg\nIHEuZ2V0Q29udGV4dCgpLmdldFF1ZXJ5U3RyaW5nKCkpKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBmaW5hbCBDbGFzcyBnZXRSZXN1bHRDbGFzcyhT\ndG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIGFzc2VydFF1ZXJ5\nRXhwcmVzc2lvbigpLnJlc3VsdENsYXNzOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGZpbmFsIGJvb2xlYW5bXSBnZXRBc2NlbmRpbmcoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NlcnRRdWVyeUV4cHJlc3Np\nb24oKS5hc2NlbmRpbmc7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZmlu\nYWwgU3RyaW5nIGdldEFsaWFzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gYXNzZXJ0UXVlcnlFeHByZXNzaW9uKCkuYWxpYXM7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgZmluYWwgU3RyaW5nW10gZ2V0UHJvamVj\ndGlvbkFsaWFzZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVy\nbiBhc3NlcnRRdWVyeUV4cHJlc3Npb24oKS5wcm9qZWN0aW9uQWxpYXNlczsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBmaW5hbCBpbnQgZ2V0T3BlcmF0\naW9uKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gYXNzZXJ0\nUXVlcnlFeHByZXNzaW9uKCkub3BlcmF0aW9uOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNBZ2dyZWdhdGUoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NlcnRRdWVyeUV4cHJlc3Np\nb24oKS5pc0FnZ3JlZ2F0ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGZpbmFsIGJvb2xlYW4gaGFzR3JvdXBpbmcoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBhc3NlcnRRdWVyeUV4cHJlc3Npb24oKS5ncm91\ncGluZy5sZW5ndGggPiAwOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGZp\nbmFsIExpbmtlZE1hcCBnZXRQYXJhbWV0ZXJUeXBlcyhTdG9yZVF1ZXJ5IHEp\nIHsKICAgICAgICAgICAgcmV0dXJuIGFzc2VydFF1ZXJ5RXhwcmVzc2lvbigp\nLnBhcmFtZXRlclR5cGVzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGZp\nbmFsIE1hcCBnZXRVcGRhdGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gYXNzZXJ0UXVlcnlFeHByZXNzaW9uKCkudXBkYXRlczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBmaW5hbCBDbGFzc01ldGFEYXRhW10g\nZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAg\nICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMgPSBnZXRRdWVyeUV4cHJl\nc3Npb25zKCk7CiAgICAgICAgICAgIGlmIChleHBzLmxlbmd0aCA9PSAxKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGV4cHNbMF0uYWNjZXNzUGF0aDsKCiAg\nICAgICAgICAgIExpc3QgbWV0YXMgPSBudWxsOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGV4cHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICBtZXRhcyA9IEZpbHRlcnMuYWRkQWNjZXNzUGF0aE1ldGFEYXRhcyht\nZXRhcywKICAgICAgICAgICAgICAgICAgICBleHBzW2ldLmFjY2Vzc1BhdGgp\nOwogICAgICAgICAgICBpZiAobWV0YXMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVNUFRZX01FVEFTOwogICAgICAgICAg\nICByZXR1cm4gKENsYXNzTWV0YURhdGFbXSkgbWV0YXMudG9BcnJheQogICAg\nICAgICAgICAgICAgKG5ldyBDbGFzc01ldGFEYXRhW21ldGFzLnNpemUoKV0p\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNQYWNraW5n\nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBUaHJvd3MgYW4gZXhj\nZXB0aW9uIGlmIHNlbGVjdCBvciBoYXZpbmcgY2xhdXNlcyBjb250YWluIAog\nICAgICAgICAqIG5vbi1hZ2dyZWdhdGUsIG5vbi1ncm91cGVkIHBhdGhzLgog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFZhbGlk\nYXRlR3JvdXBpbmdFeHByZXNzaW9uVmlzaXRvciAKICAgICAgICAgICAgZXh0\nZW5kcyBBYnN0cmFjdEV4cHJlc3Npb25WaXNpdG9yIHsKCiAgICAgICAgICAg\nIHByaXZhdGUgZmluYWwgUXVlcnlDb250ZXh0IF9jdHg7CiAgICAgICAgICAg\nIHByaXZhdGUgYm9vbGVhbiBfZ3JvdXBpbmcgPSBmYWxzZTsKICAgICAgICAg\nICAgcHJpdmF0ZSBTZXQgX2dyb3VwZWQgPSBudWxsOwogICAgICAgICAgICBw\ncml2YXRlIFZhbHVlIF9hZ2cgPSBudWxsOwoKICAgICAgICAgICAgLyoqCiAg\nICAgICAgICAgICAqIFRocm93IHByb3BlciBleGNlcHRpb24gaWYgcXVlcnkg\nZG9lcyBub3QgbWVldCB2YWxpZGF0aW9uLgogICAgICAgICAgICAgKi8KICAg\nICAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIHZhbGlkYXRlKFF1ZXJ5Q29u\ndGV4dCBjdHgsIAogICAgICAgICAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBl\neHBzKSB7CiAgICAgICAgICAgICAgICBpZiAoZXhwcy5ncm91cGluZy5sZW5n\ndGggPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAg\nICAgICAgICAgVmFsaWRhdGVHcm91cGluZ0V4cHJlc3Npb25WaXNpdG9yIHZp\nc2l0b3IgPSAKICAgICAgICAgICAgICAgICAgICBuZXcgVmFsaWRhdGVHcm91\ncGluZ0V4cHJlc3Npb25WaXNpdG9yKGN0eCk7CiAgICAgICAgICAgICAgICB2\naXNpdG9yLl9ncm91cGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGV4cHMuZ3JvdXBpbmcubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICAgICAgZXhwcy5ncm91cGluZ1tpXS5hY2NlcHRWaXNp\ndCh2aXNpdG9yKTsKICAgICAgICAgICAgICAgIHZpc2l0b3IuX2dyb3VwaW5n\nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoZXhwcy5oYXZpbmcgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBleHBzLmhhdmluZy5hY2NlcHRW\naXNpdCh2aXNpdG9yKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgICAgICBleHBzLnByb2plY3Rpb25zW2ldLmFjY2VwdFZpc2l0KHZp\nc2l0b3IpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgVmFs\naWRhdGVHcm91cGluZ0V4cHJlc3Npb25WaXNpdG9yKFF1ZXJ5Q29udGV4dCBj\ndHgpIHsKICAgICAgICAgICAgICAgIF9jdHggPSBjdHg7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGVudGVyKFZhbHVlIHZhbCkg\newogICAgICAgICAgICAgICAgaWYgKF9ncm91cGluZykgewogICAgICAgICAg\nICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQYXRoKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChfZ3JvdXBlZCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgX2dyb3VwZWQgPSBuZXcgSGFzaFNldCgp\nOwogICAgICAgICAgICAgICAgICAgICAgICBfZ3JvdXBlZC5hZGQodmFsKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2Ug\naWYgKF9hZ2cgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmICh2\nYWwuaXNBZ2dyZWdhdGUoKSkgCiAgICAgICAgICAgICAgICAgICAgICAgIF9h\nZ2cgPSB2YWw7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsIGlu\nc3RhbmNlb2YgUGF0aCAKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKF9n\ncm91cGVkID09IG51bGwgfHwgIV9ncm91cGVkLmNvbnRhaW5zKHZhbCkpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtZ3JvdXBpbmciLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX2N0eC5nZXRDYW5kaWRhdGVUeXBlKCksIF9jdHguZ2V0\nUXVlcnlTdHJpbmcoKSkpOyAKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGV4aXQoVmFsdWUgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAo\ndmFsID09IF9hZ2cpCiAgICAgICAgICAgICAgICAgICAgX2FnZyA9IG51bGw7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSdW5zIHRoZSBleHByZXNzaW9uIHF1ZXJ5IGluIG1lbW9yeS4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgSW5NZW1vcnlFeGVjdXRvcgog\nICAgICAgIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNzaW9uRXhlY3V0b3IKICAg\nICAgICBpbXBsZW1lbnRzIEV4ZWN1dG9yLCBTZXJpYWxpemFibGUgewoKICAg\nICAgICBwcml2YXRlIGZpbmFsIENsYXNzTWV0YURhdGEgX21ldGE7CiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9zdWJzOwogICAgICAgIHByaXZh\ndGUgZmluYWwgSW5NZW1vcnlFeHByZXNzaW9uRmFjdG9yeSBfZmFjdG9yeTsK\nICAgICAgICBwcml2YXRlIGZpbmFsIFF1ZXJ5RXhwcmVzc2lvbnNbXSBfZXhw\nczsKICAgICAgICBwcml2YXRlIGZpbmFsIENsYXNzW10gX3Byb2pUeXBlczsK\nCiAgICAgICAgcHVibGljIEluTWVtb3J5RXhlY3V0b3IoRXhwcmVzc2lvblN0\nb3JlUXVlcnkgcSwKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBjYW5kaWRh\ndGUsIGJvb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICAgICAgRXhwcmVzc2lv\nblBhcnNlciBwYXJzZXIsIE9iamVjdCBwYXJzZWQpIHsKICAgICAgICAgICAg\nX21ldGEgPSBjYW5kaWRhdGU7CiAgICAgICAgICAgIF9zdWJzID0gc3ViY2xh\nc3NlczsKICAgICAgICAgICAgX2ZhY3RvcnkgPSBuZXcgSW5NZW1vcnlFeHBy\nZXNzaW9uRmFjdG9yeSgpOwoKICAgICAgICAgICAgX2V4cHMgPSBuZXcgUXVl\ncnlFeHByZXNzaW9uc1tdIHsKICAgICAgICAgICAgICAgIHBhcnNlci5ldmFs\nKHBhcnNlZCwgcSwgX2ZhY3RvcnksIF9tZXRhKQogICAgICAgICAgICB9Owog\nICAgICAgICAgICBpZiAoX2V4cHNbMF0ucHJvamVjdGlvbnMubGVuZ3RoID09\nIDApCiAgICAgICAgICAgICAgICBfcHJvalR5cGVzID0gU3RvcmVRdWVyeS5F\nTVBUWV9DTEFTU0VTOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgIEFzc2VydE5vVmFyaWFibGVzRXhwcmVzc2lvblZpc2l0b3Igbm92YXJz\nID0gbmV3CiAgICAgICAgICAgICAgICAgICAgQXNzZXJ0Tm9WYXJpYWJsZXNF\neHByZXNzaW9uVmlzaXRvcihxLmdldENvbnRleHQoKSk7CiAgICAgICAgICAg\nICAgICBfcHJvalR5cGVzID0gbmV3IENsYXNzW19leHBzWzBdLnByb2plY3Rp\nb25zLmxlbmd0aF07CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IF9leHBzWzBdLnByb2plY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICAgICAgX3Byb2pUeXBlc1tpXSA9IF9leHBzWzBdLnByb2pl\nY3Rpb25zW2ldLmdldFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICBhc3Nl\ncnROb3RDb250YWluZXIoX2V4cHNbMF0ucHJvamVjdGlvbnNbaV0sIHEpOwog\nICAgICAgICAgICAgICAgICAgIF9leHBzWzBdLnByb2plY3Rpb25zW2ldLmFj\nY2VwdFZpc2l0KG5vdmFycyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9leHBzWzBdLmdyb3VwaW5n\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIF9leHBzWzBdLmdy\nb3VwaW5nW2ldLmFjY2VwdFZpc2l0KG5vdmFycyk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBRdWVyeUV4cHJlc3Npb25z\nW10gZ2V0UXVlcnlFeHByZXNzaW9ucygpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9leHBzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJlc3VsdE9iamVj\ndFByb3ZpZGVyIGV4ZWN1dGVRdWVyeShTdG9yZVF1ZXJ5IHEsCiAgICAgICAg\nICAgIE9iamVjdFtdIHBhcmFtcywgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAg\nICAgLy8gZXhlY3V0ZSBpbiBtZW1vcnkgZm9yIGNhbmRpZGF0ZSBjb2xsZWN0\naW9uOwogICAgICAgICAgICAvLyBhbHNvIGV4ZWN1dGUgaW4gbWVtb3J5IGZv\nciB0cmFuc2FjdGlvbmFsIGV4dGVudHMKICAgICAgICAgICAgQ29sbGVjdGlv\nbiBjb2xsID0gcS5nZXRDb250ZXh0KCkuZ2V0Q2FuZGlkYXRlQ29sbGVjdGlv\nbigpOwogICAgICAgICAgICBJdGVyYXRvciBpdHI7CiAgICAgICAgICAgIGlm\nIChjb2xsICE9IG51bGwpCiAgICAgICAgICAgICAgICBpdHIgPSBjb2xsLml0\nZXJhdG9yKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGl0\nciA9IHEuZ2V0Q29udGV4dCgpLmdldFN0b3JlQ29udGV4dCgpLgogICAgICAg\nICAgICAgICAgICAgIGV4dGVudEl0ZXJhdG9yKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwgX3N1YnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHEuZ2V0\nQ29udGV4dCgpLmdldEZldGNoQ29uZmlndXJhdGlvbigpLAogICAgICAgICAg\nICAgICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRJZ25vcmVDaGFuZ2Vz\nKCkpOwoKICAgICAgICAgICAgLy8gZmluZCBtYXRjaGluZyBvYmplY3RzCiAg\nICAgICAgICAgIExpc3QgcmVzdWx0cyA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHEuZ2V0Q29udGV4dCgpLmdl\ndFN0b3JlQ29udGV4dCgpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgICAgIHdoaWxlIChpdHIu\naGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqID0gaXRyLm5l\neHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2ZhY3RvcnkubWF0Y2hl\ncyhfZXhwc1swXSwgX21ldGEsIF9zdWJzLCBvYmosIGN0eCwKICAgICAgICAg\nICAgICAgICAgICAgICAgcGFyYW1zKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgcmVzdWx0cy5hZGQob2JqKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIEltcGxIZWxwZXIuY2xvc2UoaXRyKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gZ3JvdXAgcmVzdWx0cwogICAgICAgICAgICByZXN1bHRzID0g\nX2ZhY3RvcnkuZ3JvdXAoX2V4cHNbMF0sIHJlc3VsdHMsIGN0eCwgcGFyYW1z\nKTsKCiAgICAgICAgICAgIC8vIGFwcGx5IGhhdmluZyB0byBmaWx0ZXIgZ3Jv\ndXBzCiAgICAgICAgICAgIGlmIChfZXhwc1swXS5oYXZpbmcgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgTGlzdCBtYXRjaGVzID0gbmV3IEFycmF5TGlz\ndChyZXN1bHRzLnNpemUoKSk7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9u\nIGM7CiAgICAgICAgICAgICAgICBpdHIgPSByZXN1bHRzLml0ZXJhdG9yKCk7\nCiAgICAgICAgICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGMgPSAoQ29sbGVjdGlvbikgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoX2ZhY3RvcnkubWF0Y2hlcyhfZXhw\nc1swXSwgYywgY3R4LCBwYXJhbXMpKQogICAgICAgICAgICAgICAgICAgICAg\nICBtYXRjaGVzLmFkZChjKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIHJlc3VsdHMgPSBtYXRjaGVzOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBhcHBseSBwcm9qZWN0aW9ucywgb3JkZXIgcmVzdWx0cywg\nYW5kIGZpbHRlciBkdXBsaWNhdGVzCiAgICAgICAgICAgIHJlc3VsdHMgPSBf\nZmFjdG9yeS5wcm9qZWN0KF9leHBzWzBdLCByZXN1bHRzLCBjdHgsIHBhcmFt\ncyk7CiAgICAgICAgICAgIHJlc3VsdHMgPSBfZmFjdG9yeS5vcmRlcihfZXhw\nc1swXSwgcmVzdWx0cywgY3R4LCBwYXJhbXMpOwogICAgICAgICAgICByZXN1\nbHRzID0gX2ZhY3RvcnkuZGlzdGluY3QoX2V4cHNbMF0sIGNvbGwgPT0gbnVs\nbCwgcmVzdWx0cyk7CgogICAgICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRl\nciByb3AgPSBuZXcgTGlzdFJlc3VsdE9iamVjdFByb3ZpZGVyKHJlc3VsdHMp\nOwogICAgICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gMCB8fCByYW5nZS5l\nbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgICAgICByb3AgPSBu\nZXcgUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIHJhbmdlLnN0YXJ0\nLHJhbmdlLmVuZCk7CiAgICAgICAgICAgIHJldHVybiByb3A7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9u\ncyhTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAg\nUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgLy8gaW4gbWVtb3J5IHF1ZXJp\nZXMgaGF2ZSBubyBkYXRhc3RvcmUgYWN0aW9ucyB0byBwZXJmb3JtCiAgICAg\nICAgICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVNUFRZX1NUUklOR1M7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldE9yZGVyaW5nVmFsdWUo\nU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAgICAgIE9i\namVjdCByZXN1bHRPYmplY3QsIGludCBvcmRlckluZGV4KSB7CiAgICAgICAg\nICAgIC8vIGlmIHRoaXMgaXMgYSBwcm9qZWN0aW9uLCB0aGVuIHdlIGhhdmUg\ndG8gb3JkZXIgb24gc29tZXRoaW5nCiAgICAgICAgICAgIC8vIHdlIHNlbGVj\ndGVkCiAgICAgICAgICAgIGlmIChfZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5n\ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcgb3JkZXJpbmcgPSBf\nZXhwc1swXS5vcmRlcmluZ0NsYXVzZXNbb3JkZXJJbmRleF07CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9leHBzWzBdLnByb2plY3Rp\nb25DbGF1c2VzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlm\nIChvcmRlcmluZy5lcXVhbHMoX2V4cHNbMF0ucHJvamVjdGlvbkNsYXVzZXNb\naV0pKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChPYmplY3Rb\nXSkgcmVzdWx0T2JqZWN0KVtpXTsKCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAg\nICAgICAgICAgKCJtZXJnZWQtb3JkZXItd2l0aC1yZXN1bHQiLCBxLmdldENv\nbnRleHQoKS5nZXRMYW5ndWFnZSgpLAogICAgICAgICAgICAgICAgICAgICAg\nICBxLmdldENvbnRleHQoKS5nZXRRdWVyeVN0cmluZygpLCBvcmRlcmluZykp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB1c2UgdGhlIHBhcnNl\nZCBvcmRlcmluZyBleHByZXNzaW9uIHRvIGV4dHJhY3QgdGhlIG9yZGVyaW5n\nIHZhbHVlCiAgICAgICAgICAgIFZhbCB2YWwgPSAoVmFsKSBfZXhwc1swXS5v\ncmRlcmluZ1tvcmRlckluZGV4XTsKICAgICAgICAgICAgcmV0dXJuIHZhbC5l\ndmFsdWF0ZShyZXN1bHRPYmplY3QsIHJlc3VsdE9iamVjdCwgcS5nZXRDb250\nZXh0KCkuCiAgICAgICAgICAgICAgICBnZXRTdG9yZUNvbnRleHQoKSwgcGFy\nYW1zKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBDbGFzc1tdIGdldFBy\nb2plY3Rpb25UeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9wcm9qVHlwZXM7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBUaHJvd3MgYW4gZXhjZXB0aW9uIGlmIGEgdmFyaWFibGUgaXMgZm91\nbmQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nQXNzZXJ0Tm9WYXJpYWJsZXNFeHByZXNzaW9uVmlzaXRvciAKICAgICAgICAg\nICAgZXh0ZW5kcyBBYnN0cmFjdEV4cHJlc3Npb25WaXNpdG9yIHsKCiAgICAg\nICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlDb250ZXh0IF9jdHg7CgogICAg\nICAgICAgICBwdWJsaWMgQXNzZXJ0Tm9WYXJpYWJsZXNFeHByZXNzaW9uVmlz\naXRvcihRdWVyeUNvbnRleHQgY3R4KSB7CiAgICAgICAgICAgICAgICBfY3R4\nID0gY3R4OwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBlbnRlcihWYWx1ZSB2YWwpIHsKICAgICAgICAgICAgICAgIGlmICghdmFs\nLmlzVmFyaWFibGUoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24o\nX2xvYy5nZXQoImlubWVtLWFnZy1wcm9qLXZhciIsIAogICAgICAgICAgICAg\nICAgICAgIF9jdHguZ2V0Q2FuZGlkYXRlVHlwZSgpLCBfY3R4LmdldFF1ZXJ5\nU3RyaW5nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBEYXRhU3RvcmVFeGVjdXRvciBleGVjdXRlcyB0\naGUgcXVlcnkgYWdhaW5zdCB0aGUKICAgICAqIGltcGxlbWVudGF0aW9uJ3Mg\nb3ZlcnJpZGRlbiB7QGxpbmsgI2V4ZWN1dGVRdWVyeX0gbWV0aG9kLgogICAg\nICoKICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRGF0YVN0b3JlRXhlY3V0b3IKICAg\nICAgICBleHRlbmRzIEFic3RyYWN0RXhwcmVzc2lvbkV4ZWN1dG9yCiAgICAg\nICAgaW1wbGVtZW50cyBFeGVjdXRvciwgU2VyaWFsaXphYmxlIHsKCiAgICAg\nICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgICAgIHByaXZh\ndGUgQ2xhc3NNZXRhRGF0YVtdIF9tZXRhczsKICAgICAgICBwcml2YXRlIGJv\nb2xlYW4gX3N1YnM7CiAgICAgICAgcHJpdmF0ZSBFeHByZXNzaW9uUGFyc2Vy\nIF9wYXJzZXI7CiAgICAgICAgcHJpdmF0ZSBFeHByZXNzaW9uRmFjdG9yeVtd\nIF9mYWN0czsKICAgICAgICBwcml2YXRlIFF1ZXJ5RXhwcmVzc2lvbnNbXSBf\nZXhwczsKICAgICAgICBwcml2YXRlIENsYXNzW10gX3Byb2pUeXBlczsKICAg\nICAgICBwcml2YXRlIFZhbHVlW10gX2luTWVtT3JkZXJpbmc7CgogICAgICAg\nIHB1YmxpYyBEYXRhU3RvcmVFeGVjdXRvcihFeHByZXNzaW9uU3RvcmVRdWVy\neSBxLAogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4g\nc3ViY2xhc3NlcywKICAgICAgICAgICAgRXhwcmVzc2lvblBhcnNlciBwYXJz\nZXIsIE9iamVjdCBwYXJzZWQpIHsKICAgICAgICAgICAgX21ldGFzID0gcS5n\nZXRJbmRlcGVuZGVudEV4cHJlc3Npb25DYW5kaWRhdGVzKG1ldGEsIHN1YmNs\nYXNzZXMpOwogICAgICAgICAgICBpZiAoX21ldGFzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoInF1ZXJ5LXVubWFwcGVkIiwgbWV0YSkpOwogICAgICAgICAgICBfbWV0\nYSA9IG1ldGE7CiAgICAgICAgICAgIF9zdWJzID0gc3ViY2xhc3NlczsKICAg\nICAgICAgICAgX3BhcnNlciA9IHBhcnNlcjsKCiAgICAgICAgICAgIF9mYWN0\ncyA9IG5ldyBFeHByZXNzaW9uRmFjdG9yeVtfbWV0YXMubGVuZ3RoXTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZmFjdHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICBfZmFjdHNbaV0gPSBxLmdldEV4cHJlc3Np\nb25GYWN0b3J5KF9tZXRhc1tpXSk7CgogICAgICAgICAgICBfZXhwcyA9IG5l\ndyBRdWVyeUV4cHJlc3Npb25zW19tZXRhcy5sZW5ndGhdOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IF9leHBzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICAgICAgX2V4cHNbaV0gPSBwYXJzZXIuZXZhbChwYXJzZWQsIHEs\nIF9mYWN0c1tpXSwgX21ldGFzW2ldKTsKCiAgICAgICAgICAgIGlmIChfZXhw\nc1swXS5wcm9qZWN0aW9ucy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAg\nIF9wcm9qVHlwZXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX0NMQVNTRVM7CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgX3Byb2pUeXBlcyA9IG5l\ndyBDbGFzc1tfZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5ndGhdOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhwc1swXS5wcm9qZWN0\naW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGFzc2Vy\ndE5vdENvbnRhaW5lcihfZXhwc1swXS5wcm9qZWN0aW9uc1tpXSwgcSk7CiAg\nICAgICAgICAgICAgICAgICAgX3Byb2pUeXBlc1tpXSA9IF9leHBzWzBdLnBy\nb2plY3Rpb25zW2ldLmdldFR5cGUoKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFF1ZXJ5\nRXhwcmVzc2lvbnNbXSBnZXRRdWVyeUV4cHJlc3Npb25zKCkgewogICAgICAg\nICAgICByZXR1cm4gX2V4cHM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZVF1ZXJ5KFN0b3JlUXVlcnkg\ncSwKICAgICAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBSYW5nZSByYW5nZSkg\newogICAgICAgICAgICByYW5nZS5scnMgJj0gIWlzQWdncmVnYXRlKHEpICYm\nICFoYXNHcm91cGluZyhxKTsKICAgICAgICAgICAgcmV0dXJuICgoRXhwcmVz\nc2lvblN0b3JlUXVlcnkpIHEpLmV4ZWN1dGVRdWVyeSh0aGlzLCBfbWV0YSwg\nX21ldGFzLAogICAgICAgICAgICAgICAgX3N1YnMsIF9mYWN0cywgX2V4cHMs\nIHBhcmFtcywgcmFuZ2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE51\nbWJlciBleGVjdXRlRGVsZXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFy\nYW1zKSB7CiAgICAgICAgICAgIE51bWJlciBudW0gPSAoKEV4cHJlc3Npb25T\ndG9yZVF1ZXJ5KSBxKS5leGVjdXRlRGVsZXRlKHRoaXMsIF9tZXRhLAogICAg\nICAgICAgICAgICAgX21ldGFzLCBfc3VicywgX2ZhY3RzLCBfZXhwcywgcGFy\nYW1zKTsKICAgICAgICAgICAgaWYgKG51bSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIHEuZ2V0Q29udGV4dCgpLmRlbGV0ZUluTWVtb3J5KHEs\nIHRoaXMsIHBhcmFtcyk7CiAgICAgICAgICAgIHJldHVybiBudW07CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgTnVtYmVyIGV4ZWN1dGVVcGRhdGUoU3Rv\ncmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICAgICAgTnVt\nYmVyIG51bSA9ICgoRXhwcmVzc2lvblN0b3JlUXVlcnkpIHEpLmV4ZWN1dGVV\ncGRhdGUodGhpcywgX21ldGEsCiAgICAgICAgICAgICAgICBfbWV0YXMsIF9z\ndWJzLCBfZmFjdHMsIF9leHBzLCBwYXJhbXMpOwogICAgICAgICAgICBpZiAo\nbnVtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gcS5nZXRDb250\nZXh0KCkudXBkYXRlSW5NZW1vcnkocSwgdGhpcywgcGFyYW1zKTsKICAgICAg\nICAgICAgcmV0dXJuIG51bTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKFN0b3JlUXVlcnkgcSwgT2Jq\nZWN0W10gcGFyYW1zLAogICAgICAgICAgICBSYW5nZSByYW5nZSkgewogICAg\nICAgICAgICByZXR1cm4gKChFeHByZXNzaW9uU3RvcmVRdWVyeSkgcSkuZ2V0\nRGF0YVN0b3JlQWN0aW9ucyhfbWV0YSwKICAgICAgICAgICAgICAgIF9tZXRh\ncywgX3N1YnMsIF9mYWN0cywgX2V4cHMsIHBhcmFtcywgcmFuZ2UpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRlcmluZ1ZhbHVl\nKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBP\nYmplY3QgcmVzdWx0T2JqZWN0LCBpbnQgb3JkZXJJbmRleCkgewogICAgICAg\nICAgICAvLyBpZiB0aGlzIGlzIGEgcHJvamVjdGlvbiwgdGhlbiB3ZSBoYXZl\nIHRvIG9yZGVyIG9uIHNvbWV0aGluZwogICAgICAgICAgICAvLyB3ZSBzZWxl\nY3RlZAogICAgICAgICAgICBpZiAoX2V4cHNbMF0ucHJvamVjdGlvbnMubGVu\nZ3RoID4gMCkgewogICAgICAgICAgICAgICAgU3RyaW5nIG9yZGVyaW5nID0g\nX2V4cHNbMF0ub3JkZXJpbmdDbGF1c2VzW29yZGVySW5kZXhdOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhwc1swXS5wcm9qZWN0\naW9uQ2xhdXNlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBp\nZiAob3JkZXJpbmcuZXF1YWxzKF9leHBzWzBdLnByb2plY3Rpb25DbGF1c2Vz\nW2ldKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoT2JqZWN0\nW10pIHJlc3VsdE9iamVjdClbaV07CgogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAg\nICAgICAgICAgICgibWVyZ2VkLW9yZGVyLXdpdGgtcmVzdWx0IiwgcS5nZXRD\nb250ZXh0KCkuZ2V0TGFuZ3VhZ2UoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgcS5nZXRDb250ZXh0KCkuZ2V0UXVlcnlTdHJpbmcoKSwgb3JkZXJpbmcp\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbmVlZCB0byBwYXJz\nZSBvcmRlcmluZ3M/CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykg\newogICAgICAgICAgICAgICAgaWYgKF9pbk1lbU9yZGVyaW5nID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBFeHByZXNzaW9uRmFjdG9yeSBmYWN0\nb3J5ID0gbmV3IEluTWVtb3J5RXhwcmVzc2lvbkZhY3RvcnkoKTsKICAgICAg\nICAgICAgICAgICAgICBfaW5NZW1PcmRlcmluZyA9IF9wYXJzZXIuZXZhbChf\nZXhwc1swXS5vcmRlcmluZ0NsYXVzZXMsCiAgICAgICAgICAgICAgICAgICAg\nICAgIChFeHByZXNzaW9uU3RvcmVRdWVyeSkgcSwgZmFjdG9yeSwgX21ldGEp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF9pbk1l\nbU9yZGVyaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2luTWVt\nT3JkZXJpbmcgPSBfZXhwc1swXS5vcmRlcmluZzsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gdXNlIHRoZSBwYXJzZWQgb3JkZXJpbmcgZXhwcmVz\nc2lvbiB0byBleHRyYWN0IHRoZSBvcmRlcmluZyB2YWx1ZQogICAgICAgICAg\nICBWYWwgdmFsID0gKFZhbCkgX2luTWVtT3JkZXJpbmdbb3JkZXJJbmRleF07\nCiAgICAgICAgICAgIHJldHVybiB2YWwuZXZhbHVhdGUocmVzdWx0T2JqZWN0\nLCByZXN1bHRPYmplY3QsCiAgICAgICAgICAgICAgICBxLmdldENvbnRleHQo\nKS5nZXRTdG9yZUNvbnRleHQoKSwgcGFyYW1zKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBDbGFzc1tdIGdldFByb2plY3Rpb25UeXBlcyhTdG9yZVF1\nZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9wcm9qVHlwZXM7CgkJfQoJ\nfQp9Cg==\n","encoding":"base64"}

